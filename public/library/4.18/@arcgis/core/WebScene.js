/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
import{_ as e}from"./chunks/tslib.es6.js";import"./chunks/ArrayPool.js";import"./chunks/object.js";import"./chunks/deprecate.js";import{clone as t}from"./core/lang.js";import"./config.js";import{L as r,i}from"./chunks/Logger.js";import"./chunks/string.js";import"./chunks/metadata.js";import{property as s}from"./core/accessorSupport/decorators/property.js";import"./core/Accessor.js";import"./chunks/PropertyOrigin.js";import"./core/scheduling.js";import{debounce as o,reject as a,resolve as n,all as p,eachAlways as l}from"./core/promiseUtils.js";import"./chunks/Message.js";import c from"./core/Error.js";import"./chunks/compilerUtils.js";import"./chunks/ensureType.js";import{subclass as u}from"./core/accessorSupport/decorators/subclass.js";import"./chunks/Evented.js";import h from"./core/Collection.js";import"./chunks/collectionUtils.js";import{a as m,r as d}from"./chunks/JSONSupport.js";import{a as y}from"./chunks/Promise.js";import{L as w}from"./chunks/Loadable.js";import"./chunks/asyncUtils.js";import{l as g}from"./chunks/loadAll.js";import{urlToObject as f,addQueryParameter as v}from"./core/urlUtils.js";import"./core/accessorSupport/decorators/cast.js";import"./chunks/jsonMap.js";import"./chunks/enumeration.js";import{r as b}from"./chunks/reader.js";import{w as j}from"./chunks/writer.js";import"./chunks/multiOriginJSONSupportUtils.js";import"./chunks/resourceExtension.js";import"./chunks/persistableUrlUtils.js";import S,{h as I}from"./geometry/SpatialReference.js";import"./chunks/locale.js";import"./chunks/number.js";import"./intl.js";import{version as A}from"./kernel.js";import"./request.js";import"./chunks/assets.js";import"./geometry/Geometry.js";import"./geometry/Point.js";import"./chunks/Ellipsoid.js";import"./geometry/support/webMercatorUtils.js";import _ from"./geometry/Extent.js";import"./portal/PortalQueryParams.js";import"./portal/PortalQueryResult.js";import"./portal/PortalFolder.js";import"./portal/PortalGroup.js";import"./portal/PortalUser.js";import k from"./portal/Portal.js";import"./portal/PortalItemResource.js";import"./portal/PortalRating.js";import U from"./portal/PortalItem.js";import"./Basemap.js";import"./chunks/writeUtils.js";import"./chunks/mathUtils2.js";import"./chunks/vec3f64.js";import"./chunks/common.js";import"./chunks/vec3.js";import"./chunks/mathUtils.js";import"./Camera.js";import"./chunks/colorUtils.js";import"./Color.js";import"./chunks/zmUtils.js";import"./geometry/Multipoint.js";import"./geometry/Polygon.js";import"./chunks/extentUtils.js";import"./geometry/Polyline.js";import"./chunks/typeUtils.js";import{fromJSON as R}from"./geometry/support/jsonUtils.js";import"./geometry.js";import"./layers/support/CodedValueDomain.js";import"./layers/support/Domain.js";import"./layers/support/InheritedDomain.js";import"./layers/support/RangeDomain.js";import"./chunks/domains.js";import"./chunks/arcadeOnDemand.js";import"./layers/support/fieldUtils.js";import"./chunks/Identifiable.js";import"./chunks/screenUtils.js";import"./chunks/opacityUtils.js";import"./chunks/materialUtils.js";import"./Ground.js";import L from"./core/Handles.js";import"./chunks/CollectionFlattener.js";import"./chunks/basemapUtils.js";import M from"./Map.js";import"./layers/Layer.js";import"./chunks/TablesMixin.js";import"./chunks/unitUtils.js";import"./chunks/lengthUtils.js";import"./chunks/timeUtils.js";import"./TimeExtent.js";import P from"./Viewpoint.js";import"./chunks/ReadOnlyMultiOriginJSONSupport.js";import{M as O,a as V}from"./chunks/MultiOriginJSONSupport.js";import{u as E}from"./chunks/originUtils.js";import"./chunks/arcgisLayerUrl.js";import{g as C}from"./chunks/thumbnailUtils.js";import"./webdoc/applicationProperties/Search.js";import"./chunks/fieldType.js";import"./webdoc/applicationProperties/SearchLayerField.js";import"./webdoc/applicationProperties/SearchLayer.js";import"./webdoc/applicationProperties/SearchTableField.js";import"./webdoc/applicationProperties/SearchTable.js";import"./webdoc/applicationProperties/Viewing.js";import"./chunks/Thumbnail2.js";import{V as T}from"./chunks/Version.js";import G from"./geometry/HeightModelInfo.js";import"./chunks/mat4.js";import"./chunks/pe.js";import"./chunks/aaBoundingRect.js";import"./chunks/geodesicConstants.js";import"./geometry/support/GeographicTransformationStep.js";import"./geometry/support/GeographicTransformation.js";import{canProjectWithoutEngine as N}from"./geometry/projection.js";import{v as x}from"./chunks/heightModelInfoUtils.js";import{i as F}from"./chunks/spatialReferenceSupport.js";import"./chunks/resourceUtils.js";import{s as W}from"./chunks/saveUtils.js";import J from"./webscene/ApplicationProperties.js";import"./webscene/Lighting.js";import"./webscene/background/Background.js";import"./webscene/background/ColorBackground.js";import B from"./webscene/Environment.js";import $ from"./webscene/InitialViewProperties.js";import"./chunks/OperationalLayer.js";import"./chunks/ElevationInfo.js";import"./chunks/unitConversionUtils.js";import"./chunks/commonProperties2.js";import"./webscene/Slide.js";import q from"./webscene/Presentation.js";var K;let D=K=class extends m{constructor(e){super(e)}clone(){return new K({name:this.name,path:this.path,title:this.title})}};e([s({type:String,json:{write:!0}})],D.prototype,"name",void 0),e([s({type:String,json:{write:!0}})],D.prototype,"path",void 0),e([s({type:String,json:{write:!0}})],D.prototype,"title",void 0),D=K=e([u("esri.webscene.TransportationNetwork")],D);var H=D;class z extends T{constructor(e,t){super(e,t,"webscene")}get supportsGround(){return this.since(1,8)}get supportsVisibleElevationLayersInSlides(){return this.lessThan(1,8)}}const Q=r.getLogger("esri.WebScene"),X=new z(1,22);let Y=class extends(w.LoadableMixin(y(O(M)))){constructor(e){super(e),this._handles=new L,this.applicationProperties=null,this.clippingArea=null,this.clippingEnabled=!1,this.heightModelInfo=null,this.sourceVersion=null,this.supportsHeightModelInfo=!0,this.transportationNetworks=null,this.presentation=new q,this.initialViewProperties=new $,this.portalItem=null,this.resourceInfo=null,this.debouncedSaveOperations=o((async(e,t,r)=>{switch(e){case 0:return this._saveImpl(t);case 1:return this._saveAsImpl(r,t)}})),this.resourceReferences={portalItem:null,paths:[]},this.authoringApp=null,this.authoringAppVersion=null,this._isAuthoringAppSetByUser=!1,this._isAuthoringAppVersionSetByUser=!1}initialize(){if(this.when().catch((e=>{Q.error("#load()","Failed to load web scene",e)})),this.resourceInfo){let e;try{e=this._validateJSON(this.resourceInfo)}catch(e){return void this.addResolvingPromise(a(e))}this.read(e),this.addResolvingPromise(this._validateSpatialReference()),this.addResolvingPromise(this._validateHeightModelInfo())}this._handles.add(this.allLayers.on("change",(()=>this._scheduleLayersIdGC())))}destroy(){this._unscheduleLayersIdGC(),this._handles.destroy(),this.presentation&&this.presentation.destroy();const e=this.portalItem;this.portalItem=null,null==e||e.destroy()}writeClippingArea(e,t){t.clippingArea||(t.clippingArea={}),t.clippingArea.geometry=e.toJSON()}readClippingEnabled(e,t){return!!t.clippingArea&&!!t.clippingArea.clip}writeClippingEnabled(e,t){this.clippingArea&&(t.clippingArea||(t.clippingArea={}),t.clippingArea.clip=e)}writeLayers(e,t,r,i){const s={...i,layerContainerType:"operational-layers"},o=e.map((e=>this.verifyWriteLayer(e,i)?e.write(null,s):null)).filter((e=>!!e));t[r]=o.toArray()}verifyWriteLayer(e,t){return"write"in e||(t&&t.messages&&t.messages.push(new c("layer:unsupported",`Layers (${e.title}, ${e.id}) of type '${e.declaredClass}' cannot be persisted in web scenes`,{layer:e})),!1)}readSourceVersion(e,t){const[r,i]=t.version.split(".");return new z(parseInt(r,10),parseInt(i,10))}writeSourceVersion(e,t,r){t[r]=`${X.major}.${X.minor}`}get thumbnailUrl(){return this.portalItem&&this.portalItem.thumbnailUrl||null}set thumbnailUrl(e){e?this._override("thumbnailUrl",e):(this._clearOverride("thumbnailUrl"),this.clear("thumbnailUrl","user"))}set authoringApp(e){this._isAuthoringAppSetByUser=!0,this._set("authoringApp",e)}writeAuthoringApp(e,t){e&&this._isAuthoringAppSetByUser?t.authoringApp=e:t.authoringApp="ArcGIS API for JavaScript"}set authoringAppVersion(e){this._isAuthoringAppVersionSetByUser=!0,this._set("authoringAppVersion",e)}writeAuthoringAppVersion(e,t){e&&this._isAuthoringAppVersionSetByUser?t.authoringAppVersion=e:t.authoringAppVersion=A}writeGround(e,t,r,i){t[r]=e?e.write(null,i):{transparency:0,layers:[]}}readInitialViewProperties(e,t){const r={};return t.initialState&&t.initialState.environment&&(r.environment=B.fromJSON(t.initialState.environment)),t.spatialReference?r.spatialReference=S.fromJSON(t.spatialReference):r.spatialReference=S.WebMercator,r.viewingMode=t.viewingMode||"global",t.initialState&&t.initialState.viewpoint&&(r.viewpoint=P.fromJSON(t.initialState.viewpoint)),new $(r)}get spatialReference(){var e,t;return null!=(e=null==(t=this.initialViewProperties)?void 0:t.spatialReference)?e:S.WebMercator}get viewingMode(){var e,t;return null!=(e=null==(t=this.initialViewProperties)?void 0:t.viewingMode)?e:"global"}load(e){return this.addResolvingPromise(this._loadFromSource()),n(this)}loadAll(){return g(this,(e=>{const t=this.presentation&&this.presentation.slides;e(this.ground,this.basemap,this.layers,t&&t.map((e=>e.basemap)))}))}read(e,t){t={...t,origin:"web-scene"};const r=this._isAuthoringAppVersionSetByUser,i=this._isAuthoringAppSetByUser;if(d(this,e,(t=>super.read(e,t)),t),i||(this._isAuthoringAppSetByUser=!1),r||(this._isAuthoringAppVersionSetByUser=!1),e.baseMap&&Array.isArray(e.baseMap.elevationLayers)&&this.sourceVersion.supportsVisibleElevationLayersInSlides){const t=e.baseMap.elevationLayers.map((e=>({id:e.id}))),r=this.presentation.slides,i=(e,t)=>e.visibleLayers.some((e=>e.id===t)),s=t.filter((e=>!r.some((t=>i(t,e.id)))));r.forEach((e=>{e.visibleLayers.addMany(s)}))}}_writeBasemapElevationLayers(e){const r=e.ground&&e.ground.layers;!e.baseMap&&r&&r.length&&(e.baseMap={title:"Basemap",baseMapLayers:[]}),e.baseMap&&(e.baseMap.elevationLayers=t(r))}write(e,t){var r;if("loaded"!==this.loadStatus){const e=new c("webscene:not-loaded","Web scene must be loaded before it can be serialized");throw Q.error("#toJSON()","Web scene must be loaded before it can be serialized",this.loadError||this.loadStatus),e}this._runLayersIdGC();const i=!(null!=(r=t)&&r.messages);t={messages:[],...t,origin:"web-scene"};const s=super.write(e,t);if(i){const e=t.messages.filter((e=>"web-document-write:property-required"===e.name));if(e.length){const t=new c("web-document:property-required","One or more properties that are required in the webscene JSON are missing, see details for the specific errors",{errors:e});throw Q.error("#toJSON()","One or more properties that are required in the webscene JSON are missing",e),t}}return this._writeBasemapElevationLayers(s),s}async save(e){return this.debouncedSaveOperations(0,e)}async _saveImpl(e){this.portalItem||(Q.error("save(): requires the .portalItem property to be set"),await a(new c("webscene:portal-item-not-set","Portal item to save to has not been set on the WebScene"))),"Web Scene"!==this.portalItem.type&&await a(new c("webscene:portal-item-wrong-type",'Portal item needs to have type "Web Scene"'));const t=this._updateFromPromise;await this._ensureLoadBeforeSave();const r=this._enableVerifyItemRelativeUrls({origin:"web-scene",url:this.portalItem.itemUrl&&f(this.portalItem.itemUrl),messages:[],portal:this.portalItem.portal||k.getDefault(),portalItem:this.portalItem,writtenProperties:[],blockedRelativeUrls:[],resources:{toAdd:[],toUpdate:[],toKeep:[],pendingOperations:[]}}),i=this.write(null,r);return await p(r.resources.pendingOperations),await this._verifySave(i,r,e),this._updateTypeKeywords(this.portalItem),await this.portalItem.update({data:i}),await W(this.resourceReferences,r,null),E(r),t&&await t,await this._saveThumbnail(),this.portalItem}async saveAs(e,t){return this.debouncedSaveOperations(1,t,e)}async _saveAsImpl(e,t){let r=U.from(e);r||(Q.error("saveAs(portalItem): requires a portal item parameter"),await a(new c("webscene:portal-item-required","saveAs requires a portal item to save to"))),r.id&&(r=r.clone(),r.id=null);const i=r.portal||k.getDefault();await this._ensureLoadBeforeSave(),r.type="Web Scene",r.portal=i;const s=this._enableVerifyItemRelativeUrls({origin:"web-scene",url:null,messages:[],portal:i,portalItem:r,writtenProperties:[],blockedRelativeUrls:[],resources:{toAdd:[],toUpdate:[],toKeep:[],pendingOperations:[]}}),o=this.write(null,s);await p(s.resources.pendingOperations),await this._verifySaveAs(o,s,t);const n=this.thumbnailUrl,l=!this._isOverridden("thumbnailUrl");return this._updateTypeKeywords(r),await i._signIn(),await i.user.addItem({item:r,folder:t&&t.folder,data:o}),await W(this.resourceReferences,s,null),this.portalItem=r,V.prototype.read.call(this,{version:o.version,authoringApp:o.authoringApp,authoringAppVersion:o.authoringAppVersion},{name:"web-scene",ignoreDefaults:!0,url:r.itemUrl&&f(r.itemUrl)}),E(s),n&&(this.thumbnailUrl=l?v(n,"w","8192"):n),s.portalItem=r,await this._saveThumbnail(),r}async _saveThumbnail(){this._isOverridden("thumbnailUrl")&&(await this.portalItem.updateThumbnail({thumbnail:this.thumbnailUrl}),this._clearOverride("thumbnailUrl"),this.clear("thumbnailUrl","user"))}_verifySave(e,t,r,i=!1){if(!I(this.spatialReference))return a(new c("webscene:unsupported-spatial-reference","Webscenes using spatial reference systems from Mars or Moon can not be saved currently."));let s,o=t.messages.filter((e=>"error"===e.type)).map((e=>new c(e.name,e.message,e.details)));t.blockedRelativeUrls&&(o=o.concat(t.blockedRelativeUrls.map((e=>new c("url:unsupported",`Relative url '${e}' is not supported in Web Scene`))))),r&&r.ignoreUnsupported&&(o=o.filter((e=>"layer:unsupported"!==e.name&&"symbol:unsupported"!==e.name&&"symbol-layer:unsupported"!==e.name&&"property:unsupported"!==e.name&&"url:unsupported"!==e.name&&"scenemodification:unsupported"!==e.name))),null!=r&&r.requiredPropertyChecksDisabled&&(o=o.filter((e=>"web-document-write:property-required"!==e.name)));const p=r&&r.strictSchemaValidationEnabled;return s=p?import("./chunks/schemaValidator.js").then((t=>{const r=t.validate(e);if(r.length>0){const e=`webscene did not validate:\n${r.join("\n")}`;Q.error(`${i?"saveAs":"save"}(): ${e}`)}return r.map((e=>new c("webscene:schema-validation",e)))})).then((e=>{if(p&&e.length>0){throw function(e){return new c("webscene:schema-validation","Failed to save webscene due to schema validation errors. See 'details.errors' for more detailed information",{errors:e})}(e.concat(o))}return o})):n(o),s.then((e=>{if(e.length>0)return a(new c("webscene:save","Failed to save webscene due to unsupported or invalid content. See 'details.errors' for more detailed information",{errors:e}))}))}_verifySaveAs(e,t,r){return this.canSaveAs(t)?a(new c("webscene:failed-to-copy-embedded-resources","Copying of embedded resources is currently not supported")):this._verifySave(e,t,r,!0)}verifySaveAs(e){const t=this._enableVerifyItemRelativeUrls({origin:"web-scene",messages:[]}),r=this.write(null,t);return this._verifySaveAs(r,t,e)}canSaveAs(e){return e||(e=this._enableVerifyItemRelativeUrls({origin:"web-scene",messages:[]}),this.write(null,e)),e.verifyItemRelativeUrls&&e.verifyItemRelativeUrls.writtenUrls.length>0}async updateFrom(e,t={}){const r=this._updateFromInternal(e,t);this._updateFromPromise=r,await r;this._updateFromPromise===r&&(this._updateFromPromise=null)}async _updateFromInternal(e,t={}){await e.whenReady(),!t.environmentExcluded&&e.environment&&(this.initialViewProperties.environment=B.prototype.clone.apply(e.environment)),!t.viewpointExcluded&&e.viewpoint&&(this.initialViewProperties.viewpoint=e.viewpoint.clone()),this.initialViewProperties.spatialReference=e.spatialReference.clone(),this.initialViewProperties.viewingMode=e.viewingMode,e.clippingArea?e.clippingArea!==this.clippingArea&&(this.clippingArea=e.clippingArea.clone(),this.clippingEnabled=!0):this.clippingEnabled=!1,e.heightModelInfo&&(this.heightModelInfo=e.heightModelInfo.clone()),e.map===this&&e.allLayerViews.forEach((e=>{e.layer.visible=e.visible})),(!1===t.thumbnailExcluded||null==t.thumbnailExcluded&&!t.viewpointExcluded)&&await this._updateFromThumbnail(e,t.thumbnailSize||void 0)}async _updateFromThumbnail(e,t){const r=C(e,t),i=await e.takeScreenshot({format:"jpg",width:r.width,height:r.height,disableDecorations:!0});this.thumbnailUrl=i.dataUrl}_loadFromSource(){return this.resourceInfo?this._loadFromJSON(this.resourceInfo,{origin:"web-scene"}):this.portalItem&&this.portalItem.id?this._loadFromItem(this.portalItem):this._loadObjectsWithLayers()}_readAndLoadFromJSON(e,t){const r=this._validateJSON(e);return this.read(r,t),this._loadFromJSON(r,t)}_extractOperationalLayers(e){const t=[];if(!this.sourceVersion.supportsGround&&e.baseMap&&Array.isArray(e.baseMap.elevationLayers))for(const r of e.baseMap.elevationLayers)t.push(r);const r=[],i=e=>(e.layers&&(e.layers=e.layers.filter(i)),"ArcGISTiledElevationServiceLayer"!==e.layerType||(this.sourceVersion.supportsGround||r.push(e),!1));return{operationalLayers:e.operationalLayers?e.operationalLayers.filter(i):[],operationalElevationLayers:r,basemapElevationLayers:t}}_loadFromJSON(e,t){const r=new h;return this._validateSpatialReference().then((()=>this._validateHeightModelInfo())).then((()=>import("./chunks/layersCreator.js"))).then((({populateOperationalLayers:i})=>{const{operationalLayers:s,operationalElevationLayers:o,basemapElevationLayers:a}=this._extractOperationalLayers(e),n=[],p={context:{...t,layerContainerType:"operational-layers"}};if(this.portalItem&&(p.context.portal=this.portalItem.portal||k.getDefault()),a.length>0){const e={...p,context:{...p.context,layerContainerType:"ground"}};e.defaultLayerType="ArcGISTiledElevationServiceLayer",n.push(i(this.ground.layers,a,e))}if(o.length>0){const e={...p,context:{...p.context,layerContainerType:"ground"}};e.defaultLayerType="ArcGISTiledElevationServiceLayer",n.push(i(r,o,e))}return s&&s.length>0&&n.push(i(this.layers,s,p)),l(n).then((()=>{}))})).then((()=>this._loadObjectsWithLayers())).then((()=>{this.ground.layers.addMany(r)}))}async _ensureLoadBeforeSave(){await this.load(),await this._loadObjectsWithLayers();const e=[];for(const t of this.allLayers.items)if("beforeSave"in t&&"function"==typeof t.beforeSave){const r=t.beforeSave();r&&e.push(r)}await l(e)}async _loadObjectsWithLayers(){const e=[];this.ground&&e.push(this.ground.load()),this.basemap&&e.push(this.basemap.load()),this.presentation.slides.forEach((t=>{t.basemap&&e.push(t.basemap.load())})),await l(e)}async _loadFromItem(e){if(await e.load().catch((e=>{throw new c("webscene:load-portal-item","Failed to load portal item",{error:e})})),"Web Scene"!==e.type)throw new c("webscene:invalid-portal-item","Invalid portal item type '${type}', expected 'Web Scene'",{type:e.type});const t=await e.fetchData();this.resourceInfo=t;const r={origin:"web-scene",url:f(e.itemUrl),portal:e.portal||k.getDefault(),portalItem:e,readResourcePaths:[]};await this._readAndLoadFromJSON(t,r),this.resourceReferences={portalItem:e,paths:r.readResourcePaths}}_validateSpatialReference(){const e=this.initialViewProperties,t=this._sceneSpatialReference;let r;if("local"!==e.viewingMode){if(!F(t,"global"))return a(new c("webscene:unsupported-spatial-reference","Unsupported spatial reference (${spatialReference.wkid}) in global mode, only Web Mercator, WGS84 GCS or CGCS2000 are supported",{spatialReference:t,viewingMode:e.viewingMode}));r=e=>!e||N(e,t)}else{if(!F(t,"local"))return a(new c("webscene:unsupported-spatial-reference","Unsupported spatial reference (${spatialReference.wkid}) in local mode, only projected coordinate systems are supported",{spatialReference:t,viewingMode:e.viewingMode}));r=e=>!e||e.equals(t)}const s=e=>e&&(i(e.camera)&&e.camera.position&&e.camera.position.spatialReference||i(e.targetGeometry)&&e.targetGeometry.spatialReference),o=e.viewpoint,p=s(o);if(p&&!r(p))return a(new c("webscene:incompatible-camera-spatial-reference","Camera spatial reference (${cameraSpatialReference.wkid}) is incompatible with the scene spatial reference (${sceneSpatialReference.wkid})",{cameraSpatialReference:p,sceneSpatialReference:t,viewingMode:e.viewingMode}));const l=this.presentation.slides.find((e=>!r(s(e.viewpoint))));if(l){const r=s(l.viewpoint);return a(new c("webscene:incompatible-slide-spatial-reference","Slide spatial reference (${slideSpatialReference.wkid}) is incompatible with the scene spatial reference (${sceneSpatialReference.wkid})",{slideSpatialReference:r,sceneSpatialReference:t,viewingMode:e.viewingMode}))}return n()}_validateHeightModelInfo(){const e=this._sceneSpatialReference,t=x(this.heightModelInfo,e);return t?a(t):n()}_validateJSON(e){const t=z.parse(e.version||"","webscene");return X.validate(t),e.version=`${t.major}.${t.minor}`,1===t.major&&t.minor<=2&&(e.spatialReference=S.WebMercator.toJSON()),e}_updateTypeKeywords(e){"local"===this.initialViewProperties.viewingMode?e.typeKeywords?-1===e.typeKeywords.indexOf("ViewingMode-Local")&&e.typeKeywords.push("ViewingMode-Local"):e.typeKeywords=["ViewingMode-Local"]:"global"===this.initialViewProperties.viewingMode&&e.typeKeywords&&(e.typeKeywords=e.typeKeywords.filter((e=>"ViewingMode-Local"!==e))),e.typeKeywords&&(e.typeKeywords=e.typeKeywords.filter(((e,t,r)=>r.indexOf(e)===t)))}get _sceneSpatialReference(){return this.initialViewProperties.spatialReference||S.WebMercator}get _verifyItemRelativeRootPath(){return this.portalItem&&this.portalItem.itemUrl?f(this.portalItem.itemUrl).path:null}_enableVerifyItemRelativeUrls(e){const t=this._verifyItemRelativeRootPath;return t&&(e.verifyItemRelativeUrls={rootPath:t,writtenUrls:[]}),e}_unscheduleLayersIdGC(){this._layersIdGCTimeoutId&&(clearTimeout(this._layersIdGCTimeoutId),this._layersIdGCTimeoutId=0)}_scheduleLayersIdGC(){this._unscheduleLayersIdGC(),this._layersIdGCTimeoutId=setTimeout((()=>{this._layersIdGCTimeoutId=0,this._runLayersIdGC()}),3e3)}_runLayersIdGC(){this._unscheduleLayersIdGC();const e=this.applicationProperties&&this.applicationProperties.viewing&&this.applicationProperties.viewing.search,t=e=>!!this.allLayers.find((t=>t.id===e));e&&e.layers&&(e.layers=e.layers.filter((e=>t(e.id))));const r=this.presentation&&this.presentation.slides;r&&r.forEach((e=>{e.visibleLayers&&(e.visibleLayers=e.visibleLayers.filter((e=>t(e.id))))}))}static fromJSON(e){if(!e)throw new c("webscene:empty-resource","Expected a JSON resource but got nothing");return new this({resourceInfo:e})}};Y.VERSION=X,e([s({type:J,json:{write:!0}})],Y.prototype,"applicationProperties",void 0),e([s({json:{read:{source:"baseMap"},write:{target:"baseMap"}}})],Y.prototype,"basemap",void 0),e([s({type:_,json:{read:{source:"clippingArea.geometry",reader:R},write:{target:"clippingArea.geometry"}}})],Y.prototype,"clippingArea",void 0),e([j("clippingArea")],Y.prototype,"writeClippingArea",null),e([s({type:Boolean,json:{write:{target:"clippingArea.clip"}}})],Y.prototype,"clippingEnabled",void 0),e([b("clippingEnabled",["clippingArea"])],Y.prototype,"readClippingEnabled",null),e([j("clippingEnabled")],Y.prototype,"writeClippingEnabled",null),e([s({type:G,json:{write:!0}})],Y.prototype,"heightModelInfo",void 0),e([s({json:{write:{target:"operationalLayers",ignoreOrigin:!0}}})],Y.prototype,"layers",void 0),e([j("layers")],Y.prototype,"writeLayers",null),e([s({readOnly:!0,type:z,json:{type:(()=>{const e=[],t=X.major;for(let r=8;r<=X.minor;r++)e.push(`${t}.${r}`);return e})(),write:{ignoreOrigin:!0,target:"version",isRequired:!0,overridePolicy:()=>({enabled:!0,allowNull:!0,ignoreOrigin:!0})}}})],Y.prototype,"sourceVersion",void 0),e([b("sourceVersion",["version"])],Y.prototype,"readSourceVersion",null),e([j("sourceVersion")],Y.prototype,"writeSourceVersion",null),e([s({json:{read:!1,write:!1}})],Y.prototype,"tables",void 0),e([s({dependsOn:["portalItem.thumbnailUrl"]})],Y.prototype,"thumbnailUrl",null),e([s({type:String,json:{write:{allowNull:!0,ignoreOrigin:!0}}})],Y.prototype,"authoringApp",null),e([j("authoringApp")],Y.prototype,"writeAuthoringApp",null),e([s({type:String,json:{write:{allowNull:!0,ignoreOrigin:!0}}})],Y.prototype,"authoringAppVersion",null),e([j("authoringAppVersion")],Y.prototype,"writeAuthoringAppVersion",null),e([s({json:{write:{isRequired:!0,allowNull:!0,ignoreOrigin:!0,enabled:!0}}})],Y.prototype,"ground",void 0),e([j("ground")],Y.prototype,"writeGround",null),e([s({type:h.ofType(H),json:{write:!0}})],Y.prototype,"transportationNetworks",void 0),e([s({type:q,nonNullable:!0,json:{write:{ignoreOrigin:!0,writer:(e,t,r,i)=>{if(e.slides&&e.slides.length>0){const r={...i,isPresentation:!0};t.presentation=e.write(null,r)}}}}})],Y.prototype,"presentation",void 0),e([s({type:$,nonNullable:!0,json:{write:{target:"initialState",isRequired:!0,ignoreOrigin:!0},default:()=>new $({viewingMode:"global",spatialReference:S.WebMercator})}})],Y.prototype,"initialViewProperties",void 0),e([b("initialViewProperties",["initialState.environment","spatialReference","viewingMode","initialState.viewpoint"])],Y.prototype,"readInitialViewProperties",null),e([s({type:S,dependsOn:["initialViewProperties.spatialReference"],json:{read:!1,write:{isRequired:!0,ignoreOrigin:!0}}})],Y.prototype,"spatialReference",null),e([s({type:["local","global"],dependsOn:["initialViewProperties.viewingMode"],json:{read:!1,write:{isRequired:!0,ignoreOrigin:!0}}})],Y.prototype,"viewingMode",null),e([s({type:U})],Y.prototype,"portalItem",void 0),e([s()],Y.prototype,"resourceInfo",void 0),Y=e([u("esri.WebScene")],Y);var Z=Y;export default Z;
