/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
import{_ as t}from"../../chunks/tslib.es6.js";import"../../chunks/ArrayPool.js";import"../../chunks/object.js";import"../../chunks/deprecate.js";import{clone as s}from"../../core/lang.js";import"../../config.js";import{i as e,b as o}from"../../chunks/Logger.js";import"../../chunks/string.js";import"../../chunks/metadata.js";import{property as r}from"../../core/accessorSupport/decorators/property.js";import"../../core/Accessor.js";import"../../chunks/PropertyOrigin.js";import{e as i}from"../../core/scheduling.js";import"../../core/promiseUtils.js";import"../../chunks/Message.js";import"../../core/Error.js";import"../../chunks/compilerUtils.js";import"../../chunks/ensureType.js";import{subclass as n}from"../../core/accessorSupport/decorators/subclass.js";import"../../chunks/Evented.js";import"../../core/Collection.js";import"../../chunks/collectionUtils.js";import"../../chunks/JSONSupport.js";import"../../chunks/Promise.js";import"../../chunks/Loadable.js";import"../../core/urlUtils.js";import"../../core/accessorSupport/decorators/aliasOf.js";import"../../core/accessorSupport/decorators/cast.js";import"../../chunks/jsonMap.js";import"../../chunks/enumeration.js";import"../../chunks/reader.js";import"../../chunks/writer.js";import"../../chunks/resourceExtension.js";import"../../chunks/persistableUrlUtils.js";import{j as a}from"../../geometry/SpatialReference.js";import"../../chunks/locale.js";import"../../chunks/number.js";import"../../intl.js";import"../../kernel.js";import"../../request.js";import"../../chunks/assets.js";import"../../geometry/Geometry.js";import p from"../../geometry/Point.js";import"../../chunks/Ellipsoid.js";import"../../geometry/support/webMercatorUtils.js";import"../../geometry/Extent.js";import"../../portal/PortalQueryParams.js";import"../../portal/PortalQueryResult.js";import"../../portal/PortalFolder.js";import"../../portal/PortalGroup.js";import"../../portal/PortalUser.js";import"../../portal/Portal.js";import"../../chunks/mathUtils2.js";import{c as l}from"../../chunks/vec3f64.js";import"../../chunks/common.js";import{s as m,d as h,c,n as u,e as d,w as j}from"../../chunks/vec3.js";import"../../chunks/mathUtils.js";import"../../chunks/colorUtils.js";import"../../Color.js";import"../../chunks/zmUtils.js";import y from"../../geometry/Multipoint.js";import g,{u as f,i as k,c as v}from"../../geometry/Polygon.js";import"../../chunks/extentUtils.js";import w from"../../geometry/Polyline.js";import"../../chunks/typeUtils.js";import"../../geometry/support/jsonUtils.js";import"../../geometry.js";import"../../layers/support/CodedValueDomain.js";import"../../layers/support/Domain.js";import"../../layers/support/InheritedDomain.js";import"../../layers/support/RangeDomain.js";import"../../chunks/domains.js";import"../../chunks/arcadeOnDemand.js";import"../../layers/support/fieldUtils.js";import"../../popup/content/Content.js";import"../../popup/content/AttachmentsContent.js";import"../../popup/content/CustomContent.js";import"../../chunks/date.js";import"../../popup/support/FieldInfoFormat.js";import"../../popup/FieldInfo.js";import"../../popup/content/FieldsContent.js";import"../../chunks/MediaInfo.js";import"../../popup/content/support/ChartMediaInfoValueSeries.js";import"../../popup/content/support/ChartMediaInfoValue.js";import"../../chunks/chartMediaInfoUtils.js";import"../../popup/content/BarChartMediaInfo.js";import"../../popup/content/ColumnChartMediaInfo.js";import"../../popup/content/support/ImageMediaInfoValue.js";import"../../popup/content/ImageMediaInfo.js";import"../../popup/content/LineChartMediaInfo.js";import"../../popup/content/PieChartMediaInfo.js";import"../../popup/content/MediaContent.js";import"../../popup/content/TextContent.js";import"../../popup/content.js";import"../../popup/ExpressionInfo.js";import"../../popup/LayerOptions.js";import"../../popup/support/RelatedRecordsInfoFieldOrder.js";import"../../popup/RelatedRecordsInfo.js";import"../../chunks/Identifiable.js";import"../../support/actions/ActionBase.js";import"../../support/actions/ActionButton.js";import"../../support/actions/ActionToggle.js";import"../../PopupTemplate.js";import"../../symbols/Symbol.js";import"../../symbols/CIMSymbol.js";import"../../symbols/Symbol3DLayer.js";import"../../chunks/screenUtils.js";import"../../chunks/opacityUtils.js";import"../../chunks/materialUtils.js";import"../../symbols/edges/Edges3D.js";import"../../symbols/edges/SketchEdges3D.js";import"../../symbols/edges/SolidEdges3D.js";import"../../chunks/utils.js";import"../../chunks/Symbol3DMaterial.js";import"../../symbols/ExtrudeSymbol3DLayer.js";import"../../symbols/LineSymbol.js";import"../../symbols/LineSymbolMarker.js";import"../../symbols/SimpleLineSymbol.js";import"../../symbols/FillSymbol.js";import"../../symbols/patterns/StylePattern3D.js";import"../../symbols/FillSymbol3DLayer.js";import"../../chunks/colors.js";import"../../chunks/Symbol3DOutline.js";import"../../symbols/Font.js";import"../../symbols/IconSymbol3DLayer.js";import"../../symbols/LineSymbol3DLayer.js";import"../../symbols/ObjectSymbol3DLayer.js";import"../../symbols/PathSymbol3DLayer.js";import"../../symbols/TextSymbol3DLayer.js";import"../../symbols/WaterSymbol3DLayer.js";import"../../symbols/Symbol3D.js";import"../../chunks/Thumbnail.js";import"../../symbols/callouts/Callout3D.js";import"../../symbols/callouts/LineCallout3D.js";import"../../chunks/Symbol3DVerticalOffset.js";import"../../symbols/LabelSymbol3D.js";import"../../symbols/LineSymbol3D.js";import"../../symbols/MarkerSymbol.js";import"../../symbols/MeshSymbol3D.js";import"../../chunks/urlUtils.js";import"../../symbols/PictureFillSymbol.js";import"../../symbols/PictureMarkerSymbol.js";import"../../symbols/PointSymbol3D.js";import"../../symbols/PolygonSymbol3D.js";import"../../symbols/SimpleFillSymbol.js";import"../../symbols/SimpleMarkerSymbol.js";import"../../symbols/TextSymbol.js";import"../../symbols/WebStyleSymbol.js";import"../../symbols/support/jsonUtils.js";import"../../chunks/uid.js";import"../../Graphic.js";import _ from"../../core/Handles.js";import"../../layers/Layer.js";import{a as x}from"../../chunks/unitUtils.js";import"../../chunks/lengthUtils.js";import"../../geometry/support/normalizeUtils.js";import"../../chunks/timeUtils.js";import"../../TimeExtent.js";import"../../core/watchUtils.js";import"../../chunks/fieldType.js";import"../../chunks/mat4.js";import"../../chunks/pe.js";import"../../chunks/aaBoundingRect.js";import"../../chunks/geodesicConstants.js";import"../../geometry/support/GeographicTransformationStep.js";import"../../geometry/support/GeographicTransformation.js";import"../../geometry/projection.js";import"../../chunks/unitConversionUtils.js";import"../../core/HandleOwner.js";import"../../chunks/_commonjsHelpers.js";import"../../geometry/support/geodesicUtils.js";import b from"../../geometry/Circle.js";import"../../chunks/geometryEngineBase.js";import"../../chunks/hydrated.js";import{simplify as S,distance as T}from"../../geometry/geometryEngine.js";import"../../chunks/vec4f64.js";import{b as M}from"../../chunks/quatf64.js";import"../../chunks/mat3.js";import"../../chunks/BufferView.js";import"../../chunks/vec2.js";import"../../chunks/vec4.js";import{r as P,i as C}from"../../chunks/quat.js";import"../../chunks/domUtils.js";import"../../chunks/widgetUtils.js";import"../../chunks/projector.js";import"../../chunks/accessibleHandler.js";import"../../chunks/messageBundle.js";import"../../chunks/renderable.js";import"../../chunks/vmEvent.js";import"../../chunks/index.js";import"../../widgets/support/widget.js";import"../../widgets/Widget.js";import"../../chunks/zscale.js";import"../../chunks/queryZScale.js";import"../../layers/support/Field.js";import"../../tasks/support/FeatureSet.js";import"../../chunks/DataLayerSource.js";import"../../tasks/support/AttachmentQuery.js";import"../../tasks/support/Query.js";import"../../tasks/support/StatisticDefinition.js";import"../../tasks/support/RelationshipQuery.js";import"../../tasks/Task.js";import"../../chunks/OptimizedGeometry.js";import"../../chunks/featureConversionUtils.js";import"../../tasks/QueryTask.js";import"../../chunks/pbf.js";import"../../chunks/pbfQueryUtils.js";import"../../chunks/query.js";import"../../layers/support/AttachmentInfo.js";import"../../chunks/aaBoundingBox.js";import"../../chunks/Queue.js";import{V as U}from"../../chunks/InputManager.js";import"../../chunks/interactiveToolUtils.js";import"../../chunks/throttle.js";import"../../widgets/Attachments.js";import"../../widgets/Attachments/AttachmentsViewModel.js";import"../../widgets/Feature/FeatureViewModel.js";import"../../widgets/Feature.js";import"../../chunks/AnchorElementViewModel.js";import"../../widgets/Spinner/SpinnerViewModel.js";import"../../widgets/Popup.js";import"../../chunks/layerViewUtils.js";import"../../chunks/actions.js";import"../../chunks/GoTo.js";import"../../widgets/Popup/PopupViewModel.js";import{c as D}from"../../chunks/screenUtils2.js";import"../../chunks/quantizationUtils.js";import{b as I}from"../../chunks/mat2d.js";import"../../chunks/dehydratedFeatures.js";import"../../chunks/ElevationProvider.js";import{c as R,a as L}from"../../chunks/mat2df64.js";import"../../chunks/vec2f64.js";import"../../chunks/requestImageUtils.js";import"../../chunks/PiUtils.glsl.js";import"../../chunks/Program.js";import"../../chunks/isWebGL2Context.js";import"../../chunks/glUtil.js";import"../../chunks/InterleavedLayout.js";import"../../chunks/mat4f32.js";import"../../chunks/vec3f32.js";import"../../chunks/geometryUtils.js";import"../../chunks/ColorMaterial.js";import"../../chunks/Util.js";import"../../chunks/Geometry.js";import"../../chunks/VertexArrayObject.js";import"../../chunks/sdfPrimitives.js";import"../../chunks/Object3D.js";import"../../chunks/DefaultTextureUnits.js";import"../../chunks/GLMaterialTexture.js";import"../../chunks/VerticalOffset.glsl.js";import"../../chunks/elevationAlignmentUtils.js";import"../../chunks/RenderingContext.js";import"../../chunks/CameraSpace.glsl.js";import"../../chunks/Texture.js";import"../../chunks/vec4f32.js";import H from"./DrawAction.js";import{K as O,V,C as F,D as A}from"../../chunks/Keys.js";import{D as E}from"../../chunks/DrawTool.js";import"../../chunks/elevationInfoUtils.js";import"../../chunks/InteractiveToolBase.js";import"../../chunks/RightAngleQuadVisualElement.js";import"../../chunks/LaserLineRenderer.js";function W(t,s,o=null){return e(o)?[t,s,o]:[t,s]}function z(t,s,o=null){return e(o)?{x:t,y:s,z:o}:{x:t,y:s}}class B{constructor(t){this.spatialReference=t}mapToLocalMultiple(t){return t.map((t=>this.mapToLocal(t)))}get doUnnormalization(){return!1}}class Z extends B{constructor(t,s,e=null){super(s),this.defaultZ=e,this.transform=R(),this.transformInv=R(),this.transform=L(t),I(this.transformInv,this.transform)}makeMapPoint(t,s){return W(t,s,this.defaultZ)}mapToLocal(t){return z(this.transform[0]*t[0]+this.transform[2]*t[1]+this.transform[4],this.transform[1]*t[0]+this.transform[3]*t[1]+this.transform[5])}localToMap(t){return W(this.transformInv[0]*t.x+this.transformInv[2]*t.y+this.transformInv[4],this.transformInv[1]*t.x+this.transformInv[3]*t.y+this.transformInv[5],this.defaultZ)}}class G extends B{constructor(t,s){super(t.spatialReference),this.view=t,this.defaultZ=null,this.pWS=l(),this.tangentFrameUpWS=l(),this.tangentFrameRightWS=l(),this.tangentFrameForwardWS=l(),this.localFrameRightWS=l(),this.localFrameUpWS=l(),this.worldToLocalTransform=M(),this.localToWorldTransform=M(),this.scale=1,this.scale=t.resolution,this.referenceMapPoint=s,this.defaultZ=s.hasZ?s.z:null;const e=t.state.camera.viewRight;this.view.renderCoordsHelper.toRenderCoords(this.referenceMapPoint,this.pWS),this.view.renderCoordsHelper.worldBasisAtPosition(this.pWS,0,this.tangentFrameRightWS),this.view.renderCoordsHelper.worldBasisAtPosition(this.pWS,1,this.tangentFrameUpWS),this.view.renderCoordsHelper.worldBasisAtPosition(this.pWS,2,this.tangentFrameForwardWS);const o=l();m(o,this.tangentFrameForwardWS,h(e,this.tangentFrameForwardWS)),c(this.localFrameRightWS,e,o),u(this.localFrameRightWS,this.localFrameRightWS),d(this.localFrameUpWS,this.tangentFrameForwardWS,this.localFrameRightWS),P(this.worldToLocalTransform,this.localFrameRightWS,this.tangentFrameRightWS),C(this.localToWorldTransform,this.worldToLocalTransform)}get doUnnormalization(){return"global"===this.view.viewingMode}makeMapPoint(t,s){return W(t,s,this.defaultZ)}mapToLocal(t){const s=l();this.view.renderCoordsHelper.toRenderCoords(new p({x:t[0],y:t[1],spatialReference:this.spatialReference}),s),j(s,s,this.worldToLocalTransform);const e=this.view.renderCoordsHelper.fromRenderCoords(s,this.view.spatialReference);return z(e.x/this.scale,e.y/this.scale)}localToMap(t){const s=l();this.view.renderCoordsHelper.toRenderCoords(new p({x:t.x*this.scale,y:t.y*this.scale,spatialReference:this.spatialReference}),s),j(s,s,this.localToWorldTransform);const e=this.view.renderCoordsHelper.fromRenderCoords(s,this.view.spatialReference);return W(e.x,e.y,this.defaultZ)}}function Q(t,s){if("2d"===t.type)return new Z(t.state.transform,t.spatialReference,s.length>2?s[2]:null);if("3d"===t.type){const e=s.length>2?new p({x:s[0],y:s[1],z:s[2],spatialReference:t.spatialReference}):new p({x:s[0],y:s[1],spatialReference:t.spatialReference});return new G(t,e)}return null}function q(t,s){const e=new p({x:t[0],y:t[1],spatialReference:s});return t.length>2&&(e.z=t[2]),e}function K(t,s){return new y({points:t,spatialReference:s})}function J(t,s,e){const o=new w({paths:t,spatialReference:s});return e&&f(o),o}function N(t,e,o,r=!0){const n=s(t);n.forEach((t=>{const s=t[0],e=t[t.length-1];i(s,e)&&1!==t.length||t.push(t[0])}));let p=new g({rings:n,spatialReference:e});return p.rings.forEach((t=>{k(t,!1,!1)||t.reverse()})),o&&f(p),r&&p.isSelfIntersecting&&a(e)&&(p=S(p)),p}function X(t,s,e){const o=s.mapToLocalMultiple(t),r=[],i={x:o[0].x,y:o[0].y},n=o[1].x,a=o[1].y,p=Math.round(n-i.x),l=Math.round(a-i.y),m=Math.max(Math.abs(p),Math.abs(l));if(e){const t={x:i.x+m,y:i.y+m},s={x:i.x-m,y:i.y-m};r.push(z(t.x,s.y),z(s.x,s.y),z(s.x,t.y),z(t.x,t.y))}else{const t={x:p>0?i.x+m:i.x-m,y:l>0?i.y+m:i.y-m};r.push(z(i.x,i.y),z(t.x,i.y),z(t.x,t.y),z(i.x,t.y))}return N([r.map((t=>s.localToMap(t)))],s.spatialReference,s.doUnnormalization,!0)}function Y(t,s,e){let o=s.mapToLocalMultiple(t);if(1===o.length){const t=48,s=o[0];o=[z(s.x-t,s.y+t),z(s.x+t,s.y-t),z(s.x+t,s.y-t),z(s.x-t,s.y+t)]}const r=[],i={x:o[0].x,y:o[0].y},n={x:o[1].x,y:o[1].y};if(e){const t=Math.round(n.x-i.x),s=Math.round(n.y-i.y);r.push(z(i.x-t,i.y-s),z(n.x,i.y-s),z(n.x,n.y),z(i.x-t,n.y))}else r.push(z(i.x,i.y),z(n.x,i.y),z(n.x,n.y),z(i.x,n.y));return N([r.map((t=>s.localToMap(t)))],s.spatialReference,s.doUnnormalization,!0)}function $(t,s,e,o){const r=s.mapToLocalMultiple(t);let i=null,n=null;if(e)i=r[0],n=r[1];else{const t=r[0],s=r[1],e=Math.round(s.x-t.x),o=Math.round(s.y-t.y),a=Math.max(Math.abs(e),Math.abs(o));i=z(e>0?t.x+a/2:t.x-a/2,o>0?t.y+a/2:t.y-a/2),n=z(Math.abs(e)>Math.abs(o)?i.x-a/2:i.x,Math.abs(e)>Math.abs(o)?i.y:i.y-a/2)}const p=s.localToMap(i),l=s.localToMap(n);s.doUnnormalization&&v([[p,l]],s.spatialReference);const m=q(p,s.spatialReference),h=q(l,s.spatialReference),c=x(s.spatialReference);let u=0;if(a(s.spatialReference))u=c*T(m,h,null);else{const t=i.x-n.x,s=i.y-n.y;u=c*Math.sqrt(t*t+s*s)*(o||1)}const d=new b({center:m,radius:u,radiusUnit:"meters",spatialReference:s.spatialReference});return N(d.rings,d.spatialReference,!1)}function tt(t,s,e){const o=s.mapToLocalMultiple(t),r=o[0],i=o[1],n=Math.round(i.x-r.x),a=Math.round(i.y-r.y),p=z(e?r.x:r.x+n/2,e?r.y:r.y+a/2),l=e?n:n/2,m=e?a:a/2,h=[],c=2*Math.PI/60;for(let t=0;t<60;t++){const s=Math.cos(t*c),e=Math.sin(t*c),o=z(l*s+p.x,m*e+p.y);h.push(o)}return h.push(h[0]),N([h.map((t=>s.localToMap(t)))],s.spatialReference,s.doUnnormalization,!1)}let st=class extends H{constructor(t){super(t),this._isDragging=!1,this._panEnabled=!1,this._cursorScreenPoint=null,this._viewHandles=new _,this._cursorVertexAdded=!1,this._activePointerId=null,this.viewAlignedCoordinateSystem=null,this.mode="freehand",this.vertices=[]}initialize(){"2d"===this.view.type?this._addViewHandles():this._addDrawTool(this.view)}destroy(){"2d"===this.view.type?(this._removeViewHandles(),this._viewHandles.destroy()):this._removeDrawTool(),this.emit("destroy")}complete(){"2d"===this.view.type?this._completeDrawing():this._drawTool.completeCreateOperation()}getGeometryZValue(){return this.vertices.length>0&&this.vertices[0].length>2?this.vertices[0][2]:this._get("defaultZ")}_addViewHandles(){this._removeViewHandles(),"click"===this.mode?this._viewHandles.add(this._getClickModeViewHandles()):this._viewHandles.add(this._getDragModeViewHandles())}_getDragModeViewHandles(){return[this.view.on("immediate-click",(t=>{if(t.stopPropagation(),t.mapPoint&&!this._panEnabled){const s=this.getCoordsFromScreenPoint(D(t));e(s)&&(this._set("vertices",[s]),this._drawCompleteHandler(t))}}),U.TOOL),this.view.on("pointer-down",(t=>{this._shouldHandlePointerEvent(t)&&(this._panEnabled||(this._cursorScreenPoint=D(t),this._set("vertices",[]),this._activePointerId=t.pointerId,this._vertexAddHandler(t),this._isDragging=!1,"touch"===t.pointerType&&this._cursorUpdateHandler(t)))}),U.TOOL),this.view.on("pointer-move",(t=>{this._cursorScreenPoint=D(t),o(this._activePointerId)&&"touch"!==t.pointerType&&0===this.vertices.length&&this._cursorUpdateHandler(t)}),U.TOOL),this.view.on("pointer-drag",(t=>{this._shouldHandlePointerEvent(t)&&(this._isDragging=!0,this._cursorScreenPoint=D(t),this._cursorUpdateHandler(t))}),U.TOOL),this.view.on("pointer-up",(t=>{this._shouldHandlePointerEvent(t)&&(this._activePointerId=null,this._popCursorVertex(),this._isDragging&&!this._panEnabled&&(this._vertexAddHandler(t),this._drawCompleteHandler(t)),this._isDragging=!1)}),U.TOOL),this.view.on("key-down",(t=>{t.key===O.drawCompleteKey&&this._cursorScreenPoint?this._drawCompleteHandler(t):t.key===O.panKey&&(this._panEnabled=!0)}),U.TOOL),this.view.on("key-up",(t=>{t.key===O.panKey&&(this._panEnabled=!1)}),U.TOOL),this.view.on("drag",(t=>{e(this._activePointerId)&&t.stopPropagation()}),U.TOOL),this.view.on("drag",["Shift"],(t=>{t.stopPropagation()}),U.TOOL)]}_getClickModeViewHandles(){return[this.view.on("immediate-click",(t=>{t.stopPropagation()}),U.TOOL),this.view.on("pointer-down",(t=>{this._cursorScreenPoint=D(t),this._activePointerId=t.pointerId,this._isDragging=!1,"touch"===t.pointerType&&this._cursorUpdateHandler(t)}),U.TOOL),this.view.on("pointer-move",(t=>{this._cursorScreenPoint=D(t),o(this._activePointerId)&&"touch"!==t.pointerType&&this._cursorUpdateHandler(t)}),U.TOOL),this.view.on("pointer-drag",(t=>{this._shouldHandlePointerEvent(t)&&(this._isDragging=!0)}),U.TOOL),this.view.on("pointer-up",(t=>{this._shouldHandlePointerEvent(t)&&(this._activePointerId=null,this._isDragging||this._vertexAddHandler(t),2!==this.vertices.length||this._isDragging||this._drawCompleteHandler(t),this._isDragging=!1)}),U.TOOL),this.view.on("key-down",(t=>{t.key===O.vertexAddKey&&this._cursorScreenPoint&&(this._vertexAddHandler(t),2===this.vertices.length&&this._drawCompleteHandler(t)),t.key===O.drawCompleteKey&&this._cursorScreenPoint&&2===this.vertices.length&&this._drawCompleteHandler(t)}),U.TOOL)]}_removeViewHandles(){this._viewHandles.removeAll()}_addDrawTool(t){this._drawTool=new E({view:t,elevationInfo:this.elevationInfo,hasZ:this.hasZ,geometryType:"segment",mode:this.mode}),this.view.toolViewManager.tools.push(this._drawTool),this.view.activeTool=this._drawTool,this._drawTool.on("vertex-add",(t=>{1===t.vertices.length&&this.emit("vertex-add",new V(this.view,null,t.vertices[0].vertexIndex,this._drawTool.getVertexCoords()))})),this._drawTool.on("cursor-update",(t=>{1===t.vertices.length&&this.emit("cursor-update",new F(this.view,null,t.vertices[0].vertexIndex,this._drawTool.getVertexCoords()))})),this._drawTool.on("complete",(t=>{this.emit("draw-complete",new A(null,this._drawTool.getVertexCoords())),this._removeDrawTool()}))}_removeDrawTool(){e(this._drawTool)&&(this.view.tools.remove(this._drawTool),this._drawTool.destroy(),this._drawTool=null)}_addVertex(t,s){if(this._popCursorVertex(),this.isDuplicateVertex(this.vertices,t))return;this.vertices.push(t),1===this.vertices.length&&(this.viewAlignedCoordinateSystem=Q(this.view,this.vertices[0]));const e=this.vertices.indexOf(t),o=new V(this.view,s,e,this.vertices);this.emit("vertex-add",o)}_updateCursor(t,s){let o=null;e(t)&&(o=this._pushCursorVertex(t));const r=new F(this.view,s,o,this.vertices);this.emit("cursor-update",r)}_completeDrawing(t){if(this._activePointerId=null,this._popCursorVertex(),this._isDragging=!1,this._cursorScreenPoint=null,this.vertices.length<1)return;const s=new A(t,this.vertices);this.emit("draw-complete",s),s.defaultPrevented||this._removeViewHandles()}_pushCursorVertex(t){return this._popCursorVertex(),this.vertices.push(t),this._cursorVertexAdded=!0,this.vertices.length-1}_popCursorVertex(){this._cursorVertexAdded&&(this.vertices.pop(),this._cursorVertexAdded=!1)}_shouldHandlePointerEvent(t){return function(t){return"mouse"!==t.pointerType||0===t.button}(t)&&(o(this._activePointerId)||this._activePointerId===t.pointerId)}_vertexAddHandler(t){const s=this.getCoordsFromScreenPoint(this._cursorScreenPoint);e(s)&&this._addVertex(s,t.native)}_cursorUpdateHandler(t){const s=this.getCoordsFromScreenPoint(this._cursorScreenPoint);this._updateCursor(s,t.native)}_drawCompleteHandler(t){this._completeDrawing(t.native)}};t([r({type:["freehand","click"]})],st.prototype,"mode",void 0),t([r({readOnly:!0})],st.prototype,"vertices",void 0),st=t([n("esri/views/2d/engine/markup/SegmentDrawAction")],st);export{st as SegmentDrawAction,J as a,N as b,K as c,$ as d,X as e,Y as f,tt as g,Q as h,z as m};
