/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
import{_ as t}from"../chunks/tslib.es6.js";import"../chunks/ArrayPool.js";import"../chunks/object.js";import"../chunks/deprecate.js";import"../core/lang.js";import"../config.js";import"../chunks/Logger.js";import"../chunks/string.js";import"../chunks/metadata.js";import{property as r}from"../core/accessorSupport/decorators/property.js";import"../core/Accessor.js";import"../chunks/PropertyOrigin.js";import"../core/scheduling.js";import{resolve as e,all as o,reject as s}from"../core/promiseUtils.js";import"../chunks/Message.js";import l from"../core/Error.js";import"../chunks/ensureType.js";import{subclass as i}from"../core/accessorSupport/decorators/subclass.js";import{a as n}from"../chunks/JSONSupport.js";import"../core/urlUtils.js";import"../core/accessorSupport/decorators/cast.js";import"../chunks/jsonMap.js";import"../chunks/reader.js";import"../chunks/writer.js";import"../chunks/resourceExtension.js";import"../geometry/SpatialReference.js";import"../geometry/Geometry.js";import"../geometry/Point.js";import"../chunks/Ellipsoid.js";import"../geometry/support/webMercatorUtils.js";import"../geometry/Extent.js";import"./PortalQueryParams.js";import p from"./PortalFolder.js";import u from"./PortalGroup.js";var a;let d=a=class extends n{constructor(...t){super(...t),this.access=null,this.created=null,this.culture=null,this.description=null,this.email=null,this.fullName=null,this.modified=null,this.orgId=null,this.portal=null,this.preferredView=null,this.privileges=null,this.region=null,this.role=null,this.roleId=null,this.sourceJSON=null,this.units=null,this.username=null,this.userType=null}get thumbnailUrl(){const t=this.url,r=this.thumbnail;return t&&r?this.portal._normalizeUrl(`${t}/info/${r}?f=json`):null}get userContentUrl(){const t=this.get("portal.restUrl");return t?`${t}/content/users/${this.username}`:null}get url(){const t=this.get("portal.restUrl");return t?`${t}/community/users/${this.username}`:null}addItem(t){const r=t&&t.item,e=t&&t.data,o=t&&t.folder,s={method:"post"};r&&(s.query=r.createPostQuery(),null!=e&&("string"==typeof e?s.query.text=e:"object"==typeof e&&(s.query.text=JSON.stringify(e))));let l=this.userContentUrl;return o&&(l+="/"+("string"==typeof o?o:o.id)),this.portal._request(l+"/addItem",s).then((t=>(r.id=t.id,r.portal=this.portal,r.loaded?r.reload():r.load())))}deleteItem(t){let r=this.userContentUrl;return t.ownerFolder&&(r+="/"+t.ownerFolder),this.portal._request(r+`/items/${t.id}/delete`,{method:"post"}).then((()=>{t.id=null,t.portal=null}))}deleteItems(t){const r=this.userContentUrl+"/deleteItems",o=t.map((t=>t.id));if(o.length){const e={method:"post",query:{items:o.join(",")}};return this.portal._request(r,e).then((()=>{t.forEach((t=>{t.id=null,t.portal=null}))}))}return e(void 0)}fetchFolders(){return this.portal._request(this.userContentUrl,{query:{num:1}}).then((t=>{let r;return r=t&&t.folders?t.folders.map((t=>{const r=p.fromJSON(t);return r.portal=this.portal,r})):[],r}))}fetchGroups(){return this.portal._request(this.url).then((t=>{let r;return r=t&&t.groups?t.groups.map((t=>{const r=u.fromJSON(t);return r.portal=this.portal,r})):[],r}))}fetchItems(t){t||(t={});let r,e=this.userContentUrl;return t.folder&&(e+="/"+t.folder.id),import("./PortalItem.js").then((({default:o})=>{r=o;const s={folders:!1,num:t.num||10,start:t.start||1,sortField:t.sortField||"created",sortOrder:t.sortOrder||"asc"};return this.portal._request(e,{query:s})})).then((t=>{let e;return t&&t.items?(e=t.items.map((t=>{const e=r.fromJSON(t);return e.portal=this.portal,e})),o(e.map((t=>t.load()))).catch((t=>t)).then((()=>({items:e,nextStart:t.nextStart,total:t.total})))):{items:[],nextStart:-1,total:0}}))}fetchTags(){return this.portal._request(this.url+"/tags").then((t=>t.tags))}getThumbnailUrl(t){let r=this.thumbnailUrl;return r&&t&&(r+=`&w=${t}`),r}queryFavorites(t){return this.favGroupId?(this._favGroup||(this._favGroup=new u({id:this.favGroupId,portal:this.portal})),this._favGroup.queryItems(t)):s(new l("internal:unknown","Unknown internal error",{internalError:"Unknown favGroupId"}))}toJSON(){throw new l("internal:not-yet-implemented","PortalGroup.toJSON is not yet implemented")}static fromJSON(t){if(!t)return null;if(t.declaredClass)throw new Error("JSON object is already hydrated");const r=new a;return r.sourceJSON=t,r.read(t),r}};t([r()],d.prototype,"access",void 0),t([r({type:Date})],d.prototype,"created",void 0),t([r()],d.prototype,"culture",void 0),t([r()],d.prototype,"description",void 0),t([r()],d.prototype,"email",void 0),t([r()],d.prototype,"favGroupId",void 0),t([r()],d.prototype,"fullName",void 0),t([r({type:Date})],d.prototype,"modified",void 0),t([r()],d.prototype,"orgId",void 0),t([r()],d.prototype,"portal",void 0),t([r()],d.prototype,"preferredView",void 0),t([r()],d.prototype,"privileges",void 0),t([r()],d.prototype,"region",void 0),t([r()],d.prototype,"role",void 0),t([r()],d.prototype,"roleId",void 0),t([r()],d.prototype,"sourceJSON",void 0),t([r()],d.prototype,"thumbnail",void 0),t([r({dependsOn:["url","thumbnail","portal.credential.token"],readOnly:!0})],d.prototype,"thumbnailUrl",null),t([r()],d.prototype,"units",void 0),t([r({dependsOn:["portal.restUrl"],readOnly:!0})],d.prototype,"userContentUrl",null),t([r({dependsOn:["portal.restUrl"],readOnly:!0})],d.prototype,"url",null),t([r()],d.prototype,"username",void 0),t([r()],d.prototype,"userType",void 0),d=a=t([i("esri.portal.PortalUser")],d);var m=d;export default m;
