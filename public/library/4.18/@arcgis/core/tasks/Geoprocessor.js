/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
import{_ as t}from"../chunks/tslib.es6.js";import"../chunks/ArrayPool.js";import"../chunks/object.js";import"../chunks/deprecate.js";import"../core/lang.js";import"../config.js";import"../chunks/Logger.js";import"../chunks/string.js";import"../chunks/metadata.js";import{property as e}from"../core/accessorSupport/decorators/property.js";import"../core/Accessor.js";import"../chunks/PropertyOrigin.js";import"../core/scheduling.js";import{create as o,onAbort as s,createAbortError as r}from"../core/promiseUtils.js";import"../chunks/Message.js";import"../core/Error.js";import{n as i}from"../chunks/compilerUtils.js";import"../chunks/ensureType.js";import{subclass as p}from"../core/accessorSupport/decorators/subclass.js";import"../chunks/Evented.js";import"../core/Collection.js";import"../chunks/collectionUtils.js";import"../chunks/JSONSupport.js";import"../chunks/Promise.js";import"../chunks/Loadable.js";import"../core/urlUtils.js";import"../core/accessorSupport/decorators/aliasOf.js";import"../core/accessorSupport/decorators/cast.js";import"../chunks/jsonMap.js";import"../chunks/enumeration.js";import"../chunks/reader.js";import"../chunks/writer.js";import"../chunks/resourceExtension.js";import"../chunks/persistableUrlUtils.js";import a from"../geometry/SpatialReference.js";import"../chunks/locale.js";import"../chunks/number.js";import"../intl.js";import"../kernel.js";import l from"../request.js";import"../chunks/assets.js";import"../geometry/Geometry.js";import"../geometry/Point.js";import"../chunks/Ellipsoid.js";import"../geometry/support/webMercatorUtils.js";import m from"../geometry/Extent.js";import"../portal/PortalQueryParams.js";import"../portal/PortalQueryResult.js";import"../portal/PortalFolder.js";import"../portal/PortalGroup.js";import"../portal/PortalUser.js";import"../portal/Portal.js";import"../chunks/mathUtils2.js";import"../chunks/colorUtils.js";import"../Color.js";import"../chunks/zmUtils.js";import"../geometry/Multipoint.js";import"../geometry/Polygon.js";import"../chunks/extentUtils.js";import"../geometry/Polyline.js";import"../chunks/typeUtils.js";import"../geometry/support/jsonUtils.js";import"../geometry.js";import"../layers/support/CodedValueDomain.js";import"../layers/support/Domain.js";import"../layers/support/InheritedDomain.js";import"../layers/support/RangeDomain.js";import"../chunks/domains.js";import"../chunks/arcadeOnDemand.js";import"../layers/support/fieldUtils.js";import"../popup/content/Content.js";import"../popup/content/AttachmentsContent.js";import"../popup/content/CustomContent.js";import"../chunks/date.js";import"../popup/support/FieldInfoFormat.js";import"../popup/FieldInfo.js";import"../popup/content/FieldsContent.js";import"../chunks/MediaInfo.js";import"../popup/content/support/ChartMediaInfoValueSeries.js";import"../popup/content/support/ChartMediaInfoValue.js";import"../chunks/chartMediaInfoUtils.js";import"../popup/content/BarChartMediaInfo.js";import"../popup/content/ColumnChartMediaInfo.js";import"../popup/content/support/ImageMediaInfoValue.js";import"../popup/content/ImageMediaInfo.js";import"../popup/content/LineChartMediaInfo.js";import"../popup/content/PieChartMediaInfo.js";import"../popup/content/MediaContent.js";import"../popup/content/TextContent.js";import"../popup/content.js";import"../popup/ExpressionInfo.js";import"../popup/LayerOptions.js";import"../popup/support/RelatedRecordsInfoFieldOrder.js";import"../popup/RelatedRecordsInfo.js";import"../chunks/Identifiable.js";import"../support/actions/ActionBase.js";import"../support/actions/ActionButton.js";import"../support/actions/ActionToggle.js";import"../PopupTemplate.js";import"../symbols/Symbol.js";import"../symbols/CIMSymbol.js";import"../symbols/Symbol3DLayer.js";import"../chunks/screenUtils.js";import"../chunks/opacityUtils.js";import"../chunks/materialUtils.js";import"../symbols/edges/Edges3D.js";import"../symbols/edges/SketchEdges3D.js";import"../symbols/edges/SolidEdges3D.js";import"../chunks/utils.js";import"../chunks/Symbol3DMaterial.js";import"../symbols/ExtrudeSymbol3DLayer.js";import"../symbols/LineSymbol.js";import"../symbols/LineSymbolMarker.js";import"../symbols/SimpleLineSymbol.js";import"../symbols/FillSymbol.js";import"../symbols/patterns/StylePattern3D.js";import"../symbols/FillSymbol3DLayer.js";import"../chunks/colors.js";import"../chunks/Symbol3DOutline.js";import"../symbols/Font.js";import"../symbols/IconSymbol3DLayer.js";import"../symbols/LineSymbol3DLayer.js";import"../symbols/ObjectSymbol3DLayer.js";import"../symbols/PathSymbol3DLayer.js";import"../symbols/TextSymbol3DLayer.js";import"../symbols/WaterSymbol3DLayer.js";import"../symbols/Symbol3D.js";import"../chunks/Thumbnail.js";import"../symbols/callouts/Callout3D.js";import"../symbols/callouts/LineCallout3D.js";import"../chunks/Symbol3DVerticalOffset.js";import"../symbols/LabelSymbol3D.js";import"../symbols/LineSymbol3D.js";import"../symbols/MarkerSymbol.js";import"../symbols/MeshSymbol3D.js";import"../chunks/urlUtils.js";import"../symbols/PictureFillSymbol.js";import"../symbols/PictureMarkerSymbol.js";import"../symbols/PointSymbol3D.js";import"../symbols/PolygonSymbol3D.js";import"../symbols/SimpleFillSymbol.js";import"../symbols/SimpleMarkerSymbol.js";import"../symbols/TextSymbol.js";import"../symbols/WebStyleSymbol.js";import"../symbols/support/jsonUtils.js";import"../chunks/uid.js";import"../Graphic.js";import{normalizeCentralMeridian as n}from"../geometry/support/normalizeUtils.js";import"../chunks/fieldType.js";import u from"../layers/support/Field.js";import c from"./support/FeatureSet.js";import j from"./Task.js";import y from"../layers/support/MapImage.js";import h from"./support/GPMessage.js";import b from"./support/DataFile.js";import d from"./support/JobInfo.js";import S from"./support/LinearUnit.js";import f from"./support/ParameterValue.js";import k from"./support/RasterData.js";let g=class extends j{constructor(t){super(t),this._timers=new Map,this.outSpatialReference=null,this.processExtent=null,this.processSpatialReference=null,this.returnFeatureCollection=!1,this.returnM=!1,this.returnZ=!1}destroy(){this._timers.forEach((t=>{clearInterval(t)}))}cancelJob(t,e){const{path:o}=this.parsedUrl,s={...this.requestOptions,...e,query:{f:"json"}};this._clearTimer(t);return l(`${o}/jobs/${t}/cancel`,s).then((t=>d.fromJSON(t.data)))}checkJobStatus(t,e){const{path:o}=this.parsedUrl,s={...this.requestOptions,...e,query:{f:"json"}};return l(`${o}/jobs/${t}`,s).then((t=>d.fromJSON(t.data)))}execute(t,e){return this._constructRequest("execute",t,e).then((t=>{const e=t.data.results||[],o=t.data.messages||[];return{results:e.map(this._decode),messages:o.map((t=>h.fromJSON(t)))}}))}getResultData(t,e,o){const{returnFeatureCollection:s,returnM:r,returnZ:i,outSpatialReference:p,parsedUrl:a}=this,{path:m}=a,n={returnFeatureCollection:s||void 0,returnM:r||void 0,returnZ:i||void 0,outSR:p,returnType:"data",f:"json"},u=this._gpEncode(n,null),c={...this.requestOptions,...o,query:u};return l(`${m}/jobs/${t}/results/${e}`,c).then((t=>this._decode(t.data)))}getResultImage(t,e,o,s){const{path:r}=this.parsedUrl,i={...o.toJSON(),f:"json"},p=this._gpEncode(i),a={...this.requestOptions,...s,query:p};return l(`${r}/jobs/${t}/results/${e}`,a).then((t=>this._decode(t.data)))}async getResultMapImageLayer(t){const{path:e}=this.parsedUrl,o=e.indexOf("/GPServer/"),s=`${e.substring(0,o)}/MapServer/jobs/${t}`;return new(0,(await import("../layers/MapImageLayer.js")).default)({url:s})}submitJob(t,e){return this._constructRequest("submitJob",t,e).then((t=>d.fromJSON(t.data)))}waitForJobCompletion(t,e={}){const{interval:p=1e3,signal:a,statusCallback:l}=e;return o(((e,o)=>{s(a,(()=>{this._clearTimer(t),o(r())})),this._clearTimer(t);const m=setInterval((()=>{this._timers.has(t)||o(r()),this._getJobStatus(t,this.requestOptions).then((s=>{const{jobStatus:r}=s;switch(r){case"job-succeeded":this._clearTimer(t),e(s);break;case"job-submitted":case"job-executing":case"job-waiting":case"job-new":l&&l(s);break;case"job-cancelled":case"job-cancelling":case"job-deleted":case"job-deleting":case"job-timed-out":case"job-failed":this._clearTimer(t),o(s);break;default:i(r)}}))}),p);this._timers.set(t,m)}))}_clearTimer(t){this._timers.has(t)&&(clearInterval(this._timers.get(t)),this._timers.delete(t))}_constructRequest(t,e,o){const s={},r={},i=[];return this._collectGeometries(e,i,s),n(i).then((i=>{const{outSpatialReference:p,parsedUrl:a,processExtent:m,processSpatialReference:n,returnFeatureCollection:u,returnM:c,returnZ:j}=this,{path:y}=a;for(const t in s){const e=s[t];r[t]=i.slice(e[0],e[1])}const h=p?p.wkid||p:null,b=n?n.wkid||n:null,d="execute"===t?{returnFeatureCollection:u||void 0,returnM:c||void 0,returnZ:j||void 0}:null,S={...m?{context:{extent:m,outSR:h,processSR:b}}:{"env:outSR":h,"env:processSR":b},...e,...d,f:"json"},f=this._gpEncode(S,null,r),k={...this.requestOptions,...o,query:f};return l(`${y}/${t}`,k)}))}_collectGeometries(t,e,o){for(const s in t){const r=t[s];if(r&&"object"==typeof r&&r instanceof c){const{features:t}=r;o[s]=[e.length,e.length+t.length],t.forEach((t=>{e.push(t.geometry)}))}}}_decode(t){const e=t.dataType,o=f.fromJSON(t);switch(e){case"GPBoolean":case"GPDouble":case"GPLong":case"GPString":return o;case"GPDate":o.value=new Date(o.value);break;case"GPDataFile":o.value=b.fromJSON(o.value);break;case"GPLinearUnit":o.value=S.fromJSON(o.value);break;case"GPFeatureRecordSetLayer":case"GPRecordSet":{const e=t.value.url;o.value=e?b.fromJSON(o.value):c.fromJSON(o.value);break}case"GPRasterData":case"GPRasterDataLayer":{const e=t.value.mapImage;o.value=e?y.fromJSON(e):k.fromJSON(o.value);break}case"GPField":o.value=u.fromJSON(o.value);break;case"GPMultiValue:GPBoolean":case"GPMultiValue:GPDouble":case"GPMultiValue:GPLong":case"GPMultiValue:GPString":return o;case"GPMultiValue:GPDate":{const t=o.value;o.value=t.map((t=>new Date(t)));break}case"GPMultiValue:GPDataFile":o.value=o.value.map((t=>b.fromJSON(t)));break;case"GPMultiValue:GPLinearUnit":o.value=o.value.map((t=>S.fromJSON(t)));break;case"GPMultiValue:GPFeatureRecordSetLayer":case"GPMultiValue:GPRecordSet":o.value=o.value.map((t=>c.fromJSON(t)));break;case"GPMultiValue:GPRasterData":case"GPMultiValue:GPRasterDataLayer":o.value=o.value.map((t=>t?y.fromJSON(t):k.fromJSON(o.value)));break;case"GPMultiValue:GPField":o.value=o.value.map((t=>u.fromJSON(t)))}return o}_gpEncode(t,e,o){for(const e in t){const o=t[e];Array.isArray(o)?t[e]=JSON.stringify(o.map((t=>this._gpEncode({item:t},!0).item),this)):o instanceof Date&&(t[e]=o.getTime())}return this._encode(t,e,o)}_getJobStatus(t,e){const{path:o}=this.parsedUrl,s=`${o}/jobs/${t}`,r={...this.requestOptions,...e,query:{f:"json"}};return l(s,r).then((t=>d.fromJSON(t.data)))}};t([e({type:a})],g.prototype,"outSpatialReference",void 0),t([e({type:m})],g.prototype,"processExtent",void 0),t([e({type:a})],g.prototype,"processSpatialReference",void 0),t([e({nonNullable:!0})],g.prototype,"returnFeatureCollection",void 0),t([e({nonNullable:!0})],g.prototype,"returnM",void 0),t([e({nonNullable:!0})],g.prototype,"returnZ",void 0),g=t([p("esri/tasks/Geoprocessor")],g);var P=g;export default P;
