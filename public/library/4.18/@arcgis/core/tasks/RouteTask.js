/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
import{_ as r}from"../chunks/tslib.es6.js";import"../chunks/ArrayPool.js";import"../chunks/object.js";import"../chunks/deprecate.js";import"../core/lang.js";import"../config.js";import"../chunks/Logger.js";import"../chunks/string.js";import"../chunks/metadata.js";import{property as s}from"../core/accessorSupport/decorators/property.js";import"../core/Accessor.js";import"../chunks/PropertyOrigin.js";import"../core/scheduling.js";import{resolve as o}from"../core/promiseUtils.js";import"../chunks/Message.js";import"../core/Error.js";import"../chunks/ensureType.js";import{subclass as t}from"../core/accessorSupport/decorators/subclass.js";import"../chunks/Evented.js";import"../core/Collection.js";import"../chunks/collectionUtils.js";import{a as e}from"../chunks/JSONSupport.js";import"../chunks/Promise.js";import"../chunks/Loadable.js";import"../core/urlUtils.js";import"../core/accessorSupport/decorators/aliasOf.js";import"../core/accessorSupport/decorators/cast.js";import"../chunks/jsonMap.js";import"../chunks/enumeration.js";import{r as i}from"../chunks/reader.js";import"../chunks/writer.js";import"../chunks/resourceExtension.js";import"../chunks/persistableUrlUtils.js";import"../geometry/SpatialReference.js";import"../chunks/locale.js";import"../chunks/number.js";import"../intl.js";import"../kernel.js";import p from"../request.js";import"../chunks/assets.js";import"../geometry/Geometry.js";import"../geometry/Point.js";import"../chunks/Ellipsoid.js";import"../geometry/support/webMercatorUtils.js";import"../geometry/Extent.js";import"../portal/PortalQueryParams.js";import"../portal/PortalQueryResult.js";import"../portal/PortalFolder.js";import"../portal/PortalGroup.js";import"../portal/PortalUser.js";import"../portal/Portal.js";import"../chunks/mathUtils2.js";import"../chunks/colorUtils.js";import"../Color.js";import"../chunks/zmUtils.js";import"../geometry/Multipoint.js";import"../geometry/Polygon.js";import"../chunks/extentUtils.js";import"../geometry/Polyline.js";import"../chunks/typeUtils.js";import"../geometry/support/jsonUtils.js";import"../geometry.js";import"../layers/support/CodedValueDomain.js";import"../layers/support/Domain.js";import"../layers/support/InheritedDomain.js";import"../layers/support/RangeDomain.js";import"../chunks/domains.js";import"../chunks/arcadeOnDemand.js";import"../layers/support/fieldUtils.js";import"../popup/content/Content.js";import"../popup/content/AttachmentsContent.js";import"../popup/content/CustomContent.js";import"../chunks/date.js";import"../popup/support/FieldInfoFormat.js";import"../popup/FieldInfo.js";import"../popup/content/FieldsContent.js";import"../chunks/MediaInfo.js";import"../popup/content/support/ChartMediaInfoValueSeries.js";import"../popup/content/support/ChartMediaInfoValue.js";import"../chunks/chartMediaInfoUtils.js";import"../popup/content/BarChartMediaInfo.js";import"../popup/content/ColumnChartMediaInfo.js";import"../popup/content/support/ImageMediaInfoValue.js";import"../popup/content/ImageMediaInfo.js";import"../popup/content/LineChartMediaInfo.js";import"../popup/content/PieChartMediaInfo.js";import"../popup/content/MediaContent.js";import"../popup/content/TextContent.js";import"../popup/content.js";import"../popup/ExpressionInfo.js";import"../popup/LayerOptions.js";import"../popup/support/RelatedRecordsInfoFieldOrder.js";import"../popup/RelatedRecordsInfo.js";import"../chunks/Identifiable.js";import"../support/actions/ActionBase.js";import"../support/actions/ActionButton.js";import"../support/actions/ActionToggle.js";import"../PopupTemplate.js";import"../symbols/Symbol.js";import"../symbols/CIMSymbol.js";import"../symbols/Symbol3DLayer.js";import"../chunks/screenUtils.js";import"../chunks/opacityUtils.js";import"../chunks/materialUtils.js";import"../symbols/edges/Edges3D.js";import"../symbols/edges/SketchEdges3D.js";import"../symbols/edges/SolidEdges3D.js";import"../chunks/utils.js";import"../chunks/Symbol3DMaterial.js";import"../symbols/ExtrudeSymbol3DLayer.js";import"../symbols/LineSymbol.js";import"../symbols/LineSymbolMarker.js";import"../symbols/SimpleLineSymbol.js";import"../symbols/FillSymbol.js";import"../symbols/patterns/StylePattern3D.js";import"../symbols/FillSymbol3DLayer.js";import"../chunks/colors.js";import"../chunks/Symbol3DOutline.js";import"../symbols/Font.js";import"../symbols/IconSymbol3DLayer.js";import"../symbols/LineSymbol3DLayer.js";import"../symbols/ObjectSymbol3DLayer.js";import"../symbols/PathSymbol3DLayer.js";import"../symbols/TextSymbol3DLayer.js";import"../symbols/WaterSymbol3DLayer.js";import"../symbols/Symbol3D.js";import"../chunks/Thumbnail.js";import"../symbols/callouts/Callout3D.js";import"../symbols/callouts/LineCallout3D.js";import"../chunks/Symbol3DVerticalOffset.js";import"../symbols/LabelSymbol3D.js";import"../symbols/LineSymbol3D.js";import"../symbols/MarkerSymbol.js";import"../symbols/MeshSymbol3D.js";import"../chunks/urlUtils.js";import"../symbols/PictureFillSymbol.js";import"../symbols/PictureMarkerSymbol.js";import"../symbols/PointSymbol3D.js";import"../symbols/PolygonSymbol3D.js";import"../symbols/SimpleFillSymbol.js";import"../symbols/SimpleMarkerSymbol.js";import"../symbols/TextSymbol.js";import"../symbols/WebStyleSymbol.js";import"../symbols/support/jsonUtils.js";import"../chunks/uid.js";import m from"../Graphic.js";import{normalizeCentralMeridian as n}from"../geometry/support/normalizeUtils.js";import"../chunks/fieldType.js";import"../layers/support/Field.js";import l from"./support/FeatureSet.js";import a from"./Task.js";import{N as u,c}from"../chunks/NAServiceDescription.js";import"./support/DirectionsFeatureSet.js";import"./support/GPMessage.js";import j from"./support/NAMessage.js";import y from"./support/RouteResult.js";function h(r){return r&&l.fromJSON(r).features.map((r=>r))}let b=class extends e{constructor(r){super(r),this.barriers=null,this.messages=null,this.pointBarriers=null,this.polylineBarriers=null,this.polygonBarriers=null,this.routeResults=null}readPointBarriers(r,s){return h(s.barriers||s.pointBarriers)}readPolylineBarriers(r){return h(r)}readPolygonBarriers(r){return h(r)}};r([s({aliasOf:"pointBarriers"})],b.prototype,"barriers",void 0),r([s({type:[j]})],b.prototype,"messages",void 0),r([s({type:[m]})],b.prototype,"pointBarriers",void 0),r([i("pointBarriers",["barriers","pointBarriers"])],b.prototype,"readPointBarriers",null),r([s({type:[m]})],b.prototype,"polylineBarriers",void 0),r([i("polylineBarriers")],b.prototype,"readPolylineBarriers",null),r([s({type:[m]})],b.prototype,"polygonBarriers",void 0),r([i("polygonBarriers")],b.prototype,"readPolygonBarriers",null),r([s({type:[y]})],b.prototype,"routeResults",void 0),b=r([t("esri.tasks.support.RouteResultsContainer")],b);var d=b;const f=c({accumulateAttributes:{name:"accumulateAttributeNames"},attributeParameterValues:!0,directionsTimeAttribute:{name:"directionsTimeAttributeName"},impedanceAttribute:{name:"impedanceAttributeName"},outSpatialReference:{name:"outSR",getter:r=>r.outSpatialReference.wkid},pointBarriers:{name:"barriers"},polylineBarriers:!0,polygonBarriers:!0,restrictionAttributes:{name:"restrictionAttributeNames"},stops:!0,travelMode:!0});let k=class extends(u(a)){constructor(r){super(r)}solve(r,s){const t=[],e=[],i={},m={};return r.stops&&r.stops.features&&this._collectGeometries(r.stops.features,e,"stops.features",i),r.pointBarriers&&r.pointBarriers.features&&this._collectGeometries(r.pointBarriers.features,e,"pointBarriers.features",i),r.polylineBarriers&&r.polylineBarriers.features&&this._collectGeometries(r.polylineBarriers.features,e,"polylineBarriers.features",i),r.polygonBarriers&&r.polygonBarriers.features&&this._collectGeometries(r.polygonBarriers.features,e,"polygonBarriers.features",i),n(e).then((r=>{for(const s in i){const o=i[s];t.push(s),m[s]=r.slice(o[0],o[1])}return this._isInputGeometryZAware(m,t)?this.getServiceDescription():o({dontCheck:!0})})).then((o=>{("dontCheck"in o?o.dontCheck:o.hasZ)||this._dropZValuesOffInputGeometry(m,t);for(const s in m)m[s].forEach(((o,t)=>{r.get(s)[t].geometry=o}));let e={query:{...this.parsedUrl.query,f:"json",...f.toQueryParams(r)}};(this.requestOptions||s)&&(e={...this.requestOptions,...s,...e});const{path:i}=this.parsedUrl,n="/solve",l=i.endsWith(n)?i:i+n;return p(l,e)})).then((r=>this._handleSolveResponse(r)))}_collectGeometries(r,s,o,t){t[o]=[s.length,s.length+r.length],r.forEach((r=>{s.push(r.geometry)}))}_handleSolveResponse(r){const s=[],o=[],{directions:t=[],routes:{features:e=[],spatialReference:i=null}={},stops:{features:p=[],spatialReference:m=null}={},barriers:n,polygonBarriers:l,polylineBarriers:a,messages:u}=r.data,c="esri.tasks.RouteTask.NULL_ROUTE_NAME";let j,y,h=!0;const b=e&&i||p&&m||n&&n.spatialReference||l&&l.spatialReference||a&&a.spatialReference;t.forEach((r=>{s.push(j=r.routeName),o[j]={directions:r}})),e.forEach((r=>{-1===s.indexOf(j=r.attributes.Name)&&(s.push(j),o[j]={}),r.geometry&&(r.geometry.spatialReference=b),o[j].route=r})),p.forEach((r=>{y=r.attributes,-1===s.indexOf(j=y.RouteName||c)&&(s.push(j),o[j]={}),j!==c&&(h=!1),r.geometry&&(r.geometry.spatialReference=b),null==o[j].stops&&(o[j].stops=[]),o[j].stops.push(r)})),p.length>0&&!0===h&&(o[s[0]].stops=o[c].stops,delete o[c],s.splice(s.indexOf(c),1));const f=s.map((r=>(o[r].routeName=r===c?null:r,o[r])));return d.fromJSON({routeResults:f,pointBarriers:n,polygonBarriers:l,polylineBarriers:a,messages:u})}};k=r([t("esri.tasks.RouteTask")],k);var g=k;export default g;
