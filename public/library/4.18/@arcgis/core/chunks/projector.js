/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
import{r as e}from"./widgetUtils.js";const t="http://www.w3.org/2000/svg",r=[];let o=(e,t)=>{const r={};return Object.keys(e).forEach((t=>{r[t]=e[t]})),t&&Object.keys(t).forEach((e=>{r[e]=t[e]})),r};const n=(e,t)=>e.vnodeSelector===t.vnodeSelector&&(e.properties&&t.properties?e.properties.key===t.properties.key&&e.properties.bind===t.properties.bind:!e.properties&&!t.properties),s=e=>{if("string"!=typeof e)throw new Error("Style values must be strings")},i=(e,t,r)=>{if(""!==t.vnodeSelector)for(let o=r;o<e.length;o++)if(n(e[o],t))return o;return-1},p=(e,t,r,o)=>{const s=e[t];if(""===s.vnodeSelector)return;const i=s.properties;if(!(i?void 0===i.key?i.bind:i.key:void 0))for(let i=0;i<e.length;i++)if(i!==t){const t=e[i];if(n(t,s))throw new Error(`${r.vnodeSelector} had a ${s.vnodeSelector} child ${"added"===o?o:"removed"}, but there is now more than one. You must add unique key properties to make them distinguishable.`)}},d=e=>{if(e.properties){const t=e.properties.enterAnimation;t&&t(e.domNode,e.properties)}},l=[];let c=!1;const a=e=>{(e.children||[]).forEach(a),e.properties&&e.properties.afterRemoved&&e.properties.afterRemoved.apply(e.properties.bind||e.properties,[e.domNode])},f=()=>{c=!1,l.forEach(a),l.length=0},u=e=>{l.push(e),c||(c=!0,"undefined"!=typeof window&&"requestIdleCallback"in window?window.requestIdleCallback(f,{timeout:16}):setTimeout(f,16))},h=e=>{const t=e.domNode;if(e.properties){const r=e.properties.exitAnimation;if(r){t.style.pointerEvents="none";const o=()=>{t.parentNode&&(t.parentNode.removeChild(t),u(e))};return void r(t,o,e.properties)}}t.parentNode&&(t.parentNode.removeChild(t),u(e))},v=(r,o,n)=>{if(!o)return;const i=n.eventHandlerInterceptor,p=Object.keys(o),d=p.length;for(let l=0;l<d;l++){const d=p[l];let c=o[d];if("className"===d)throw new Error('Property "className" is not supported, use "class".');if("class"===d)N(r,c,!0);else if("classes"===d){const e=Object.keys(c),t=e.length;for(let o=0;o<t;o++){const t=e[o];c[t]&&r.classList.add(t)}}else if("styles"===d){const e=Object.keys(c),t=e.length;for(let o=0;o<t;o++){const t=e[o],i=c[t];i&&(s(i),n.styleApplyer(r,t,i))}}else if("key"!==d&&null!=c){const s=typeof c;"function"===s?0===d.lastIndexOf("on",0)&&(i&&(c=i(d,c,r,o)),"oninput"===d&&function(){const e=c;c=function(t){e.apply(this,[t]),t.target["oninput-value"]=t.target.value}}(),r[d]=c):n.namespace===t?"href"===d?r.setAttributeNS("http://www.w3.org/1999/xlink",d,c):r.setAttribute(d,c):"string"===s&&"value"!==d?"innerHTML"===d?r[d]=e.sanitize(c):r.setAttribute(d,c):r[d]=c}}};let m,y=(e,t,r)=>{((e,t,r)=>{if(t)for(const o of t)g(o,e,void 0,r)})(e,t.children,r),t.text&&(e.textContent=t.text),v(e,t.properties,r),t.properties&&t.properties.afterCreate&&t.properties.afterCreate.apply(t.properties.bind||t.properties,[e,r,t.vnodeSelector,t.properties,t.children])},g=(e,r,n,s)=>{let i,p=0;const d=e.vnodeSelector,l=r.ownerDocument;if(""===d)i=e.domNode=l.createTextNode(e.text),void 0!==n?r.insertBefore(i,n):r.appendChild(i);else{for(let c=0;c<=d.length;++c){const a=d.charAt(c);if(c===d.length||"."===a||"#"===a){const a=d.charAt(p-1),f=d.slice(p,c);"."===a?i.classList.add(f):"#"===a?i.id=f:("svg"===f&&(s=o(s,{namespace:t})),void 0!==s.namespace?i=e.domNode=l.createElementNS(s.namespace,f):(i=e.domNode=e.domNode||l.createElement(f),"input"===f&&e.properties&&void 0!==e.properties.type&&i.setAttribute("type",e.properties.type)),void 0!==n?r.insertBefore(i,n):i.parentNode!==r&&r.appendChild(i)),p=c+1}}y(i,e,s)}};const N=(e,t,r)=>{t&&t.split(" ").forEach((t=>{t&&e.classList.toggle(t,r)}))};m=(l,c,a)=>{const f=l.domNode;let u=!1;if(l===c)return!1;let v=!1;if(""===c.vnodeSelector){if(c.text!==l.text){const e=f.ownerDocument.createTextNode(c.text);return f.parentNode.replaceChild(e,f),c.domNode=e,u=!0,u}c.domNode=f}else 0===c.vnodeSelector.lastIndexOf("svg",0)&&(a=o(a,{namespace:t})),l.text!==c.text&&(v=!0,void 0===c.text?f.removeChild(f.firstChild):f.textContent=c.text),c.domNode=f,v=((e,t,o,s,l)=>{if(o===s)return!1;s=s||r;const c=(o=o||r).length,a=s.length;let f,u=0,v=0,y=!1;for(;v<a;){const r=u<c?o[u]:void 0,a=s[v];if(void 0!==r&&n(r,a))y=m(r,a,l)||y,u++;else{const r=i(o,a,u+1);if(r>=0){for(f=u;f<r;f++)h(o[f]),p(o,f,e,"removed");y=m(o[r],a,l)||y,u=r+1}else g(a,t,u<c?o[u].domNode:void 0,l),d(a),p(s,v,e,"added")}v++}if(c>u)for(f=u;f<c;f++)h(o[f]),p(o,f,e,"removed");return y})(c,f,l.children,c.children,a)||v,v=((r,o,n,i)=>{if(!n)return;let p=!1;const d=Object.keys(n),l=d.length;for(let c=0;c<l;c++){const l=d[c];let a=n[l];const f=o[l];if("class"===l)f!==a&&(N(r,f,!1),N(r,a,!0));else if("classes"===l){const e=r.classList,t=Object.keys(a),o=t.length;for(let r=0;r<o;r++){const o=t[r],n=!!a[o];n!==!!f[o]&&(p=!0,n?e.add(o):e.remove(o))}}else if("styles"===l){const e=Object.keys(a),t=e.length;for(let o=0;o<t;o++){const t=e[o],n=a[t];n!==f[t]&&(p=!0,n?(s(n),i.styleApplyer(r,t,n)):i.styleApplyer(r,t,""))}}else if(a||"string"!=typeof f||(a=""),"value"===l){const e=r[l];e!==a&&(r["oninput-value"]?e===r["oninput-value"]:a!==f)&&(r[l]=a,r["oninput-value"]=void 0),a!==f&&(p=!0)}else if(a!==f){const o=typeof a;"function"===o&&i.eventHandlerInterceptor||(i.namespace===t?"href"===l?r.setAttributeNS("http://www.w3.org/1999/xlink",l,a):r.setAttribute(l,a):"string"===o?"innerHTML"===l?r[l]=e.sanitize(a):"role"===l&&""===a?r.removeAttribute(l):r.setAttribute(l,a):r[l]!==a&&(r[l]=a),p=!0)}}return p})(f,l.properties,c.properties,a)||v,c.properties&&c.properties.afterUpdate&&c.properties.afterUpdate.apply(c.properties.bind||c.properties,[f,a,c.vnodeSelector,c.properties,c.children]);return v&&c.properties&&c.properties.updateAnimation&&c.properties.updateAnimation(f,c.properties,l.properties),u};let w=(e,t)=>({getLastRender:()=>e,update:r=>{if(e.vnodeSelector!==r.vnodeSelector)throw new Error("The selector for the root VNode may not be changed. (consider using dom.merge and add one extra level to the virtual DOM)");const o=e;e=r,m(o,r,t)},domNode:e.domNode});const b={namespace:void 0,performanceLogger:()=>{},eventHandlerInterceptor:void 0,styleApplyer:(e,t,r)=>{e.style[t]=r}};let x=e=>o(b,e),A=(e,t,r)=>(r=x(r),g(t,e,void 0,r),w(t,r)),k=(e,t,r)=>(r=x(r),g(t,e.parentNode,e,r),w(t,r)),S=(e,t,r)=>(r=x(r),t.domNode=e,y(e,t,r),w(t,r)),E=(e,t,r)=>(r=x(r),g(t,e.parentNode,e,r),e.parentNode.removeChild(e),w(t,r));const C=(e,t)=>{const r=[];for(;e!==t;)r.push(e),e=e.parentNode;return r};let O;O=Array.prototype.find?(e,t)=>e.find(t):(e,t)=>e.filter(t)[0];const L=(e,t)=>{let r=e;return t.forEach((e=>{r=r&&r.children?O(r.children,(t=>t.domNode===e)):void 0})),r},j=(e,t,r)=>{const o=function(o){r("domEvent",o);const n=t(),s=C(o.currentTarget,n.domNode);s.reverse();const i=L(n.getLastRender(),s);let p;return e.scheduleRender(),i&&(p=i.properties[`on${o.type}`].apply(i.properties.bind||this,arguments)),r("domEventProcessed",o),p};return()=>o};let I=e=>{let t;const r=x(e),o=r.performanceLogger;let n,s=!0,i=!1;const p=[],d=[],l=(e,n,s)=>{let i;r.eventHandlerInterceptor=j(t,(()=>i),o),i=e(n,s(),r),p.push(i),d.push(s)},c=()=>{if(n=void 0,s){s=!1,o("renderStart",void 0);for(let e=0;e<p.length;e++){const t=d[e]();o("rendered",void 0),p[e].update(t),o("patched",void 0)}o("renderDone",void 0),s=!0}};return t={renderNow:c,scheduleRender:()=>{n||i||(n=requestAnimationFrame(c))},stop:()=>{n&&(cancelAnimationFrame(n),n=void 0),i=!0},resume:()=>{i=!1,s=!0,t.scheduleRender()},append:(e,t)=>{l(A,e,t)},insertBefore:(e,t)=>{l(k,e,t)},merge:(e,t)=>{l(S,e,t)},replace:(e,t)=>{l(E,e,t)},detach:e=>{for(let t=0;t<d.length;t++)if(d[t]===e)return d.splice(t,1),p.splice(t,1)[0];throw new Error("renderFunction was not found")}},t};export{I as c};
