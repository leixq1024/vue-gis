/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
import{_ as t}from"./tslib.es6.js";import"./object.js";import{mixin as e,clone as r}from"../core/lang.js";import"./Logger.js";import{property as i}from"../core/accessorSupport/decorators/property.js";import o from"../core/Accessor.js";import"./ensureType.js";import{subclass as s}from"../core/accessorSupport/decorators/subclass.js";import"../core/urlUtils.js";import"./resourceExtension.js";import{c as n}from"./vec3f64.js";import{f as a,a as l,s as h}from"./vec3.js";import{d as c,b as d,f as p}from"./screenUtils.js";import{w as u,x as f,c as x,y as m,a as y}from"./unitUtils.js";import{d as g,a as v,g as b,s as S,n as w,l as T,b as C,f as _}from"./vec2.js";import"./projector.js";import{f as j,e as P,c as k,g as R,d as A,h as z}from"../widgets/Attachments.js";const U=(t,e,r)=>{for(let i=0,o=e.length;i<o;i++){let o=e[i];Array.isArray(o)?U(t,o,r):null!=o&&!1!==o&&("string"==typeof o&&(o={vnodeSelector:"",properties:void 0,children:void 0,text:o.toString(),domNode:null}),r.push(o))}};function $(t,e,r){if(Array.isArray(e))r=e,e=void 0;else if(e&&("string"==typeof e||e.hasOwnProperty("vnodeSelector"))||r&&("string"==typeof r||r.hasOwnProperty("vnodeSelector")))throw new Error("h called with invalid arguments");let i,o;return r&&1===r.length&&"string"==typeof r[0]?i=r[0]:r&&(o=[],U(t,r,o),0===o.length&&(o=void 0)),{vnodeSelector:t,properties:e,children:o,text:""===i?void 0:i,domNode:null}}let X=class extends o{constructor(t){super(t),this.startX=0,this.startY=0,this.endX=0,this.endY=0,this.width=1,this.color=[0,0,0,.5],this.visible=!0}get startPosition(){return[this.startX,this.startY]}set startPosition(t){this._set("startX",t[0]),this._set("startY",t[1])}get endPosition(){return[this.endX,this.endY]}set endPosition(t){this._set("endX",t[0]),this._set("endY",t[1])}get strokeStyle(){const t=this.color;return`rgba(${t[0]}, ${t[1]}, ${t[2]}, ${t[3]})`}get lineCap(){return"round"}render(){const{height:t,left:e,top:r,width:i,x1:o,x2:s,y1:n,y2:a}=this.calculateCoordinates(Y),l=`stroke: ${this.strokeStyle}; stroke-width: ${this.width}; stroke-linecap: ${this.lineCap};`;return $("div",{classes:{"esri-line-overlay-item":!0},styles:{left:e+"px",top:r+"px",width:i+"px",height:t+"px",visibility:this.visible?"visible":"hidden"}},[$("svg",{width:i,height:t},[$("line",{x1:o,y1:n,x2:s,y2:a,style:l})])])}renderCanvas(t){if(!this.visible)return;t.strokeStyle=this.strokeStyle,t.lineWidth=this.width,t.lineCap=this.lineCap;const e=this.calculateCoordinates(Y);t.beginPath(),t.moveTo(e.left+e.x1,e.top+e.y1),t.lineTo(e.left+e.x2,e.top+e.y2),t.stroke()}calculateCoordinates(t){const e=Math.min(this.startX,this.endX),r=Math.max(this.startX,this.endX),i=Math.min(this.startY,this.endY),o=Math.max(this.startY,this.endY),s=this.width;return t.left=e-s,t.top=i-s,t.width=r-e+2*s,t.height=Math.max(20,o-i+2*s),t.x1=this.startX-e+s,t.y1=this.startY-i+s,t.x2=this.endX-e+s,t.y2=this.endY-i+s,t}};t([i()],X.prototype,"startX",void 0),t([i()],X.prototype,"startY",void 0),t([i()],X.prototype,"endX",void 0),t([i()],X.prototype,"endY",void 0),t([i({dependsOn:["startX","startY"]})],X.prototype,"startPosition",null),t([i({dependsOn:["endX","endY"]})],X.prototype,"endPosition",null),t([i()],X.prototype,"width",void 0),t([i()],X.prototype,"color",void 0),t([i()],X.prototype,"visible",void 0),t([i({readOnly:!0,dependsOn:["color"]})],X.prototype,"strokeStyle",null),X=t([s("esri.views.overlay.LineOverlayItem")],X);const Y={left:0,top:0,width:0,height:0,x1:0,y1:0,x2:0,y2:0};var M=X;const B={bottom:"esri-text-overlay-item-anchor-bottom","bottom-right":"esri-text-overlay-item-anchor-bottom-right","bottom-left":"esri-text-overlay-item-anchor-bottom-left",top:"esri-text-overlay-item-anchor-top","top-right":"esri-text-overlay-item-anchor-top-right","top-left":"esri-text-overlay-item-anchor-top-left",center:"esri-text-overlay-item-anchor-center",right:"esri-text-overlay-item-anchor-right",left:"esri-text-overlay-item-anchor-left"};let E=class extends o{constructor(t){super(t),this.x=0,this.y=0,this.text="-",this.fontSize=14,this.anchor="center",this.visible=!0,this.backgroundColor="rgba(0, 0, 0, 0.6)",this.textColor="white",this.textShadowColor=[0,0,0],this.textShadowSize=1}get position(){return[this.x,this.y]}set position(t){this._set("x",t[0]),this._set("y",t[1])}get padding(){return.5*this.fontSize}render(){return $("div",{classes:this._cssClasses(),styles:{left:Math.floor(this.x)+"px",top:Math.floor(this.y)+"px",visibility:this.visible?"visible":"hidden",fontSize:this.fontSize+"px",backgroundColor:this.backgroundColor,color:this.textColor,padding:this.padding+"px",borderRadius:this.padding+"px",textShadow:`0 0 ${this.textShadowSize}px rgb(${this.textShadowColor[0]}, ${this.textShadowColor[1]}, ${this.textShadowColor[2]})`}},[this.text])}renderCanvas(t){if(!this.visible)return;const e=t.font.replace(/^(.*?)px/,"");t.font=`${this.fontSize}px ${e}`;const r=this.padding,i=this.padding,o=t.measureText(this.text).width,s=this.fontSize,n=O[this.anchor];t.textAlign="center",t.textBaseline="middle";const a=o+2*r,l=s+2*r,h=this.x+n.x*a,c=this.y+n.y*l;this.roundedRect(t,h,c,a,l,i),t.fillStyle=this.backgroundColor,t.fill();const d=this.x+(n.x+.5)*a,p=this.y+(n.y+.5)*l;this._renderTextShadow(t,this.text,d,p),t.fillStyle=this.textColor,t.fillText(this.text,d,p)}_renderTextShadow(t,e,r,i){t.lineJoin="miter",t.fillStyle=`rgba(${this.textShadowColor[0]}, ${this.textShadowColor[1]}, ${this.textShadowColor[2]}, ${1/q.length})`;const o=this.textShadowSize;for(const[s,n]of q)t.fillText(e,r+o*s,i+o*n)}roundedRect(t,e,r,i,o,s){t.beginPath(),t.moveTo(e,r+s),t.arcTo(e,r,e+s,r,s),t.lineTo(e+i-s,r),t.arcTo(e+i,r,e+i,r+s,s),t.lineTo(e+i,r+o-s),t.arcTo(e+i,r+o,e+i-s,r+o,s),t.lineTo(e+s,r+o),t.arcTo(e,r+o,e,r+o-s,s),t.closePath()}_cssClasses(){const t={"esri-text-overlay-item":!0};for(const e in B)t[B[e]]=this.anchor===e;return t}};t([i()],E.prototype,"x",void 0),t([i()],E.prototype,"y",void 0),t([i({dependsOn:["x","y"]})],E.prototype,"position",null),t([i()],E.prototype,"text",void 0),t([i()],E.prototype,"fontSize",void 0),t([i()],E.prototype,"anchor",void 0),t([i()],E.prototype,"visible",void 0),t([i({dependsOn:["fontSize"]})],E.prototype,"padding",null),E=t([s("esri.views.overlay.TextOverlayItem")],E);const O={bottom:{x:-.5,y:-1,textAlign:"center",textBaseline:"bottom"},"bottom-left":{x:0,y:-1,textAlign:"left",textBaseline:"bottom"},"bottom-right":{x:-1,y:-1,textAlign:"right",textBaseline:"bottom"},center:{x:-.5,y:-.5,textAlign:"center",textBaseline:"middle"},left:{x:0,y:-.5,textAlign:"left",textBaseline:"middle"},right:{x:-1,y:-.5,textAlign:"right",textBaseline:"middle"},top:{x:-.5,y:0,textAlign:"center",textBaseline:"top"},"top-left":{x:0,y:0,textAlign:"left",textBaseline:"top"},"top-right":{x:-1,y:0,textAlign:"right",textBaseline:"top"}},q=[];{const t=16;for(let e=0;e<360;e+=360/t)q.push([Math.cos(Math.PI*e/180),Math.sin(Math.PI*e/180)])}var D=E;function N(t,i){const o=e({},t),s=r(i);return e(o,s),o}function I(t,e,r,i){for(;t.length<e;)t.push(r());if(i)for(;t.length>e;){i(t.pop())}else t.length=e}function F(t,e){if(a(e,0,0,0),t.length>0){for(let r=0;r<t.length;++r)l(e,e,t[r]);h(e,e,1/t.length)}}function L(t,e,r,i){i.projectToRenderScreen(t,G),i.projectToRenderScreen(e,V),v(r,Z,K),b(r,r)}function H(t,e,r){const i=r.state.camera;r.renderCoordsHelper.toRenderCoords(t,Q),i.projectToRenderScreen(Q,W),r.state.camera.renderToScreen(W,e)}function J(t,e,r){return H(t,tt,r),H(e,et,r),g(tt,et)}const Q=n(),W=c(),G=c(),K=G,V=c(),Z=V,tt=d(),et=d();function rt(t){switch(t){case"top":return"bottom";case"right":return"left";case"bottom":return"top";case"left":return"right"}}function it(t,e,r){const i=function(t,e,r){return t.projectToRenderScreen(e,ht),!(ht[2]<0||ht[2]>1||(t.renderToScreen(ht,r),0))}(r,e,ct);return i&&t.updatePosition(ct,null),i}function ot(t,e,r,i,o){const s=function(t,e,r,i,o,s){if(!e)return!1;L(e.start,e.end,nt,t),S(lt,-nt[1],nt[0]);let n=!1;switch(i){case"top":n=lt[1]<0;break;case"bottom":n=lt[1]>0;break;case"left":n=lt[0]>0;break;case"right":n=lt[0]<0}if(n&&w(lt,lt),0===T(lt))switch(i){case"top":lt[1]=1;break;case"bottom":lt[1]=-1;break;case"left":lt[0]=-1;break;case"right":lt[0]=1}return t.projectToRenderScreen(e.origin,ht),!(ht[2]<0||ht[2]>1||(t.renderToScreen(ht,o),C(lt,lt,r*t.pixelRatio),_(lt,lt,ht),t.renderToScreen(lt,s),0))}(o,e,r,i,ct,dt);return s&&t.updatePosition(ct,dt),s}function st(t,e,r,i,o){const s=function(t,e,r,i,o,s){return!(!e||!r||(L(e.end,e.start,nt,t),L(r.start,r.end,at,t),_(lt,nt,at),w(lt,lt),b(lt,lt),t.projectToRenderScreen(e.end,ht),ht[2]<0||ht[2]>1||(t.renderToScreen(ht,o),C(lt,lt,i*t.pixelRatio),_(lt,lt,ht),t.renderToScreen(lt,s),0)))}(o,e,r,i,ct,dt);return s&&t.updatePosition(ct,dt),s}const nt=p(),at=p(),lt=p(),ht=c(),ct=d(),dt=d();class pt{constructor(t,e){this.measure=u(e),this.value=t,this.unit=e}get isBaseUnit(){return f(this.unit)}toUnit(t){return new pt(x(this.value,this.unit,t),t)}toBaseUnit(){return this.toUnit(m(this.unit))}}function ut(t,e,r,i=2,o="abbr"){return j(t,e.toUnit(r).value,r,i,o)}function ft(t,e,r=2,i="abbr"){if("length"!==e.measure)throw new Error("quantity is not a length");return A(t,e.value,e.unit,r,i)}function xt(t,e,r=2,i="abbr"){if("length"!==e.measure)throw new Error("quantity is not a length");return z(t,e.value,e.unit,r,i)}function mt(t,e,r=2,i="abbr"){if("length"!==e.measure)throw new Error("quantity is not a length");return k(t,e.value,e.unit,r,i)}function yt(t,e,r=2,i="abbr"){if("length"!==e.measure)throw new Error("quantity is not a length");return R(t,e.value,e.unit,r,i)}function gt(t){if("angle"!==t.measure)throw new Error("quantity is not an angle");return P(t.value,t.unit)}class vt{constructor(t=null){this.spatialReference=t,this._updateNormalizationFactors}get spatialReference(){return this._spatialReference}set spatialReference(t){t!==this._spatialReference&&(this._spatialReference=t,this._updateNormalizationFactors())}normalizeDistance(t){return t*this._metersPerDistanceUnit}normalizeElevation(t){return t*this._metersPerElevationUnit}normalizeArea(t){return t*this._squareMetersPerAreaUnit}_updateNormalizationFactors(){this._metersPerDistanceUnit=y(this._spatialReference,1),this._metersPerElevationUnit=y(this._spatialReference,1),this._squareMetersPerAreaUnit=this._metersPerDistanceUnit*this._metersPerDistanceUnit}}export{M as L,pt as Q,D as T,vt as U,it as a,st as b,N as c,ot as d,rt as e,ut as f,gt as g,mt as h,yt as i,ft as j,xt as k,F as m,J as p,I as r,L as s};
