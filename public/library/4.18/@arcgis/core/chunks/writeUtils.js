/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
import{g as e}from"./object.js";import{clone as n}from"../core/lang.js";import{i as t}from"./Logger.js";import r from"../core/Error.js";import{n as o}from"../core/accessorSupport/decorators/subclass.js";const i=new Set(["bing-maps","open-street-map","tile","unknown","unsupported","vector-tile","web-tile"]),l=new Set(["csv","feature","geo-rss","group","kml","tile","unknown","unsupported","vector-tile","web-tile"]);function a(e){return!("feature"!==e.type||e.url||!e.source||"memory"!==e.source.type)}function s(e,n){if(n.restrictedWebMapWriting){const r=function(e){return"basemap"===e.layerContainerType?i:"operational-layers"===e.layerContainerType?l:null}(n);return!t(r)||r.has(e.type)&&!a(e)}return!0}function c(n,t){if(function(n,t){if(a(n)){const r=e("featureCollection.layers",t),i=r&&r[0]&&r[0].layerDefinition;i&&("maxScale"in n&&(i.maxScale=o(n.maxScale)),"minScale"in n&&(i.minScale=o(n.minScale)))}else"group"!==n.type&&("maxScale"in n&&(t.maxScale=o(n.maxScale)),"minScale"in n&&(t.minScale=o(n.minScale)))}(n,t),"blendMode"in n&&(t.blendMode=n.blendMode,"normal"===t.blendMode&&delete t.blendMode),t.opacity=o(n.opacity),t.title=n.title||"Layer",t.visibility=n.visible,"legendEnabled"in n&&"wmts"!==n.type)if(a(n)){const e=t.featureCollection;e&&(e.showLegend=n.legendEnabled)}else t.showLegend=n.legendEnabled}function u(e,o,i){if(!("write"in e)||!e.write)return i&&i.messages&&i.messages.push(new r("layer:unsupported",`Layers (${e.title}, ${e.id}) of type '${e.declaredClass}' cannot be persisted`,{layer:e})),null;if(s(e,i)){const n={};return e.write(n,i)?n:null}return t(o)&&c(e,o=n(o)),o}export{u as g};
