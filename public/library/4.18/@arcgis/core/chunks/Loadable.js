/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
import{_ as o}from"./tslib.es6.js";import{property as t}from"../core/accessorSupport/decorators/property.js";import{onAbortOrThrow as s,createAbortController as r,onAbort as e}from"../core/promiseUtils.js";import l from"../core/Error.js";import{subclass as a,W as d}from"../core/accessorSupport/decorators/subclass.js";import{E as n}from"./Promise.js";const i=n=>{let i=class extends n{constructor(...o){super(...o),this._loadController=null,this.loadError=null,this.loadStatus="not-loaded",this._set("loadWarnings",[]),this.addResolvingPromise(new Promise((o=>{const t=this.load.bind(this);this.load=a=>{const d=new Promise(((o,t)=>{const r=s(a,t);this.destroyed&&t(new l("load:instance-destroyed",`Instance of '${this.declaredClass||this.constructor.name}' is already destroyed`,{instance:this})),this._promiseProps.when(o,t).finally((()=>{r&&r.remove()}))}));if("not-loaded"===this.loadStatus){this._set("loadStatus","loading");const o=this._loadController=r();t({signal:o.signal}),e(o.signal,(()=>{this._promiseProps.abort()}))}return o(),d}}))),this.when((()=>{this._set("loadStatus","loaded"),this._loadController=null}),(o=>{this._set("loadStatus","failed"),this._set("loadError",o),this._loadController=null}))}get loaded(){return"loaded"===this.loadStatus}get loadWarnings(){return this._get("loadWarnings")}load(){return null}cancelLoad(){var o;return this.isFulfilled()||(this._set("loadError",new l("load:cancelled","Cancelled")),null==(o=this._loadController)||o.abort()),this}};return o([t({readOnly:!0,dependsOn:["loadStatus"]})],i.prototype,"loaded",null),o([t({readOnly:!0})],i.prototype,"loadError",void 0),o([t()],i.prototype,"loadStatus",void 0),o([t({type:[d],readOnly:!0})],i.prototype,"loadWarnings",null),i=o([a("esri.core.Loadable")],i),i};let c=class extends(i(n)){};c=o([a("esri.core.Loadable")],c),function(o){o.LoadableMixin=i,o.isLoadable=function(o){return!(!o||!o.load)}}(c||(c={}));var u=c;export{u as L};
