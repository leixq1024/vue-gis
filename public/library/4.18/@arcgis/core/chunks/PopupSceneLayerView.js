/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
import{_ as e}from"./tslib.es6.js";import"./object.js";import{i as r}from"./Logger.js";import"../core/accessorSupport/decorators/property.js";import{reject as s,resolve as t}from"../core/promiseUtils.js";import o from"../core/Error.js";import"./ensureType.js";import{subclass as p}from"../core/accessorSupport/decorators/subclass.js";import"../core/urlUtils.js";import"./resourceExtension.js";import{unpackFieldNames as a,populateMissingFields as i}from"../layers/support/fieldUtils.js";import{g as c,a as u}from"./popupUtils.js";const n=n=>{let l=class extends n{_validateFetchPopupFeatures(e){const{layer:r}=this,{popupEnabled:s}=r;if(!s)return new o("scenelayerview3d:fetchPopupFeatures","Popups are disabled",{layer:r});return c(r,e)?void 0:new o("scenelayerview3d:fetchPopupFeatures","Layer does not define a popup template",{layer:r})}async prepareFetchPopupFeatures(e){}async fetchPopupFeatures(e,o){const p=this._validateFetchPopupFeatures(o);if(p)return s(p);const n=r(o)?o.clientGraphics:null;if(!n||0===n.length)return t([]);const l=[],h=[],y="scene"===this.layer.type&&r(this.layer.associatedLayer)?this.layer.associatedLayer:this.layer,m=a(this.layer.fields,await u(y,c(this.layer,o)));await this.prepareFetchPopupFeatures(m);const d=new Set;for(const e of n)i(m,e,d)?h.push(e):l.push(e);return 0===h.length?t(l):this.whenGraphicAttributes(h,[...d]).catch((()=>h)).then((e=>l.concat(e)))}};return l=e([p("esri.views.3d.layers.support.PopupSceneLayerView")],l),l};export{n as P};
