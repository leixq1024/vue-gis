/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
import{n as t}from"./mathUtils2.js";function n(n,o,i){const u=n.byteLength/(4*o),s=new Uint32Array(n,0,u*o);let c=new Uint32Array(u);const a=i&&i.minReduction||0,h=i&&i.originalIndices||null,g=i&&i.componentOffsets||null;let y=0;if(g)for(let t=0;t<g.length-1;t++){const n=g[t+1]-g[t];n>y&&(y=n)}else y=u;const U=Math.floor(1.1*y)+1;(null==f||f.length<2*U)&&(f=new Uint32Array(t(2*U)));for(let t=0;t<2*U;t++)f[t]=0;let w=0;const A=!!g&&!!h,m=A?h.length:u,b=A?new Uint32Array(h.length):null,d=1.96;let p=0!==a?Math.ceil(4*d*d/(a*a)*a*(1-a)):m,M=1,q=g?g[1]:m;for(let t=0;t<m;t++){if(t===p){const n=1-w/t;if(n+d*Math.sqrt(n*(1-n)/t)<a)return null;p*=2}if(t===q){for(let t=0;t<2*U;t++)f[t]=0;if(h)for(let t=g[M-1];t<g[M];t++)b[t]=c[h[t]];q=g[++M]}const n=A?h[t]:t,r=n*o,i=l(s,r,o);let u=i%U,y=w;for(;0!==f[2*u+1];){if(f[2*u]===i){const t=f[2*u+1]-1;if(e(s,r,t*o,o)){y=c[t];break}}u++,u>=U&&(u-=U)}y===w&&(f[2*u]=i,f[2*u+1]=n+1,w++),c[n]=y}if(0!==a&&1-w/u<a)return null;if(A){for(let t=g[M-1];t<b.length;t++)b[t]=c[h[t]];c=b}const j=new Uint32Array(o*w);w=0;for(let t=0;t<m;t++)if(c[t]===w){r(s,(A?h[t]:t)*o,j,w*o,o),w++}if(h&&!A){const t=new Uint32Array(h.length);for(let n=0;n<t.length;n++)t[n]=c[h[n]];c=t}return{buffer:j.buffer,indices:c,uniqueCount:w}}function e(t,n,e,r){for(let l=0;l<r;l++)if(t[n+l]!==t[e+l])return!1;return!0}function r(t,n,e,r,l){for(let f=0;f<l;f++)e[r+f]=t[n+f]}function l(t,n,e){let r=0;for(let l=0;l<e;l++)r=t[n+l]+r|0,r=r+(r<<11)+(r>>>2)|0;return r>>>0}let f=null;export{n as d};
