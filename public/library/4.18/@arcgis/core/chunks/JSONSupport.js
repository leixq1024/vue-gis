/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
import{_ as r}from"./tslib.es6.js";import{L as e}from"./Logger.js";import{g as t,m as o}from"./metadata.js";import{v as s,e as n}from"../core/accessorSupport/decorators/property.js";import i from"../core/Accessor.js";import{n as a,i as c}from"./PropertyOrigin.js";import{e as u}from"../core/scheduling.js";import{all as f}from"../core/promiseUtils.js";import l from"../core/Error.js";import{o as d,a as p,b as g,subclass as m}from"../core/accessorSupport/decorators/subclass.js";function O(r,e,t){if(!r||!r.read||!1===r.read.enabled||!r.read.source)return!1;const o=r.read.source;if("string"==typeof o){if(o===e)return!0;if(o.indexOf(".")>-1&&0===o.indexOf(e)&&n(o,t))return!0}else for(const r of o){if(r===e)return!0;if(r.indexOf(".")>-1&&0===r.indexOf(e)&&n(r,t))return!0}return!1}function w(r,e,t,o,s){let n=d(e[t],s);(function(r){return r&&(!r.read||!1!==r.read.enabled&&!r.read.source)})(n)&&(r[t]=!0);for(const i of Object.getOwnPropertyNames(e))n=d(e[i],s),O(n,t,o)&&(r[i]=!0)}function y(r,e,t,o){const s=t.metadatas,n=p(s[e],"any",o),i=n&&n.default;if(void 0===i)return;const a="function"==typeof i?i.call(r,e,o):i;void 0!==a&&t.set(e,a)}const N={origin:"service"};function j(r,e,o=N){if(!e||"object"!=typeof e)return;const n=t(r),i=n.metadatas,a={};for(const r of Object.getOwnPropertyNames(e))w(a,i,r,e,o);n.setDefaultOrigin(o.origin);for(const t of Object.getOwnPropertyNames(a)){const a=d(i[t],o).read,c=a&&a.source;let u;u=c&&"string"==typeof c?s(e,c):e[t],a&&a.reader&&(u=a.reader.call(r,u,e,o)),void 0!==u&&n.set(t,u)}if(!o||!o.ignoreDefaults)for(const e of Object.getOwnPropertyNames(i))a[e]||y(r,e,n,o);n.setDefaultOrigin("user")}function h(r,e,t,o=N){var s;const n={...o,messages:[]};t(n),null==(s=n.messages)||s.forEach((e=>{"warning"!==e.type||r.loaded?o&&o.messages&&o.messages.push(e):r.loadWarnings.push(e)}))}const v=e.getLogger("esri.core.accessorSupport.write");function S(r,e,t,o,s){var n,i;const a={};return null==(n=e.write)||null==(i=n.writer)||i.call(r,o,a,t,s),a}function b(r,e,t,o,s,n){if(!o||!o.write)return!1;const i=r.get(t);if(!s&&o.write.overridePolicy){const e=o.write.overridePolicy.call(r,i,t,n);void 0!==e&&(s=e)}if(s||(s=o.write),!s||!1===s.enabled)return!1;if((null===i&&!s.allowNull||void 0===i)&&s.isRequired){const e=new l("web-document-write:property-required",`Missing value for required property '${t}' on '${r.declaredClass}'`,{propertyName:t,target:r});return e&&n&&n.messages?n.messages.push(e):e&&!n&&v.error(e.name,e.message),!1}if(void 0===i)return!1;if(null===i&&!s.allowNull)return!1;if(function(r,e,t,o,s){const n=o.default;if(void 0===n)return!1;if(null!=o.defaultEquals)return o.defaultEquals(s);if("function"==typeof n){if(Array.isArray(s)){const o=n.call(r,e,t);return u(o,s)}return!1}return n===s}(r,t,n,o,i))return!1;if(void 0!==o.default)return!0;if(!s.ignoreOrigin&&n&&n.origin){if(e.store.originOf(t)<a(n.origin))return!1}return!0}function J(r,e,o,s){const n=t(r),i=n.metadatas,a=g(i[e],s);return!!a&&b(r,n,e,a,o,s)}function P(r,e,s){if(r&&"function"==typeof r.toJSON&&(!r.toJSON.isDefaultToJSON||!r.write))return o(e,r.toJSON());const n=t(r),i=n.metadatas;for(const t in i){const a=g(i[t],s);if(!b(r,n,t,a,void 0,s))continue;const u=r.get(t),l=S(r,a,a.write&&"string"==typeof a.write.target?a.write.target:t,u,s);Object.keys(l).length>0&&(e=o(e,l),s&&s.resources&&s.resources.pendingOperations&&s.resources.pendingOperations.length&&f(s.resources.pendingOperations).then((()=>o(e,l))),s&&s.writtenProperties&&s.writtenProperties.push({target:r,propName:t,oldOrigin:c(n.store.originOf(t)),newOrigin:s.origin}))}return e}const x=e=>{let t=class extends e{constructor(...r){super(...r)}read(r,e){j(this,r,e)}write(r={},e){return P(this,r,e)}toJSON(r){return this.write({},r)}static fromJSON(r,e){return q.call(this,r,e)}};return t=r([m("esri.core.JSONSupport")],t),t.prototype.toJSON.isDefaultToJSON=!0,t};function q(r,e){if(!r)return null;if(r.declaredClass)throw new Error("JSON object is already hydrated");const t=new this;return t.read(r,e),t}let D=class extends(x(i)){};D=r([m("esri.core.JSONSupport")],D);export{x as J,D as a,j as b,J as c,h as r,P as w};
