/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
import{_ as r}from"./chunks/tslib.es6.js";import"./chunks/ArrayPool.js";import"./chunks/object.js";import"./chunks/deprecate.js";import{clone as e}from"./core/lang.js";import"./config.js";import{L as t}from"./chunks/Logger.js";import"./chunks/string.js";import"./chunks/metadata.js";import{property as o}from"./core/accessorSupport/decorators/property.js";import"./core/Accessor.js";import"./chunks/PropertyOrigin.js";import"./core/scheduling.js";import{resolve as s,throwIfAborted as n,eachAlways as a}from"./core/promiseUtils.js";import"./chunks/Message.js";import i from"./core/Error.js";import{t as l}from"./chunks/compilerUtils.js";import{I as c}from"./chunks/ensureType.js";import{subclass as p}from"./core/accessorSupport/decorators/subclass.js";import"./chunks/Evented.js";import u from"./core/Collection.js";import{r as y}from"./chunks/collectionUtils.js";import{a as m,J as h}from"./chunks/JSONSupport.js";import"./chunks/Promise.js";import{L as d}from"./chunks/Loadable.js";import"./chunks/asyncUtils.js";import{l as f}from"./chunks/loadAll.js";import"./core/urlUtils.js";import"./chunks/jsonMap.js";import{e as j}from"./chunks/enumeration.js";import{w as g}from"./chunks/writer.js";import"./chunks/resourceExtension.js";import"./chunks/mathUtils2.js";import"./chunks/colorUtils.js";import v from"./Color.js";import{t as k,o as w}from"./chunks/opacityUtils.js";var C;let I=C=class extends m{constructor(r){super(r),this.type="none"}clone(){return new C({type:this.type})}};var S;r([j({none:"none",stayAbove:"stay-above"})],I.prototype,"type",void 0),I=C=r([p("esri.ground.NavigationConstraint")],I);const A=t.getLogger("esri.Ground");let L=S=class extends(h(d)){constructor(r){super(r),this.opacity=1,this.surfaceColor=null,this.navigationConstraint=null,this.layers=new u;const e=r=>{r.parent&&r.parent!==this&&"remove"in r.parent&&r.parent.remove(r),r.parent=this,"elevation"!==r.type&&"base-elevation"!==r.type&&A.error(`Layer '${r.title}, id:${r.id}' of type '${r.type}' is not supported as a ground layer and will therefore be ignored. Only layers of type 'elevation' are supported.`)};this.layers.on("after-add",(r=>e(r.item))),this.layers.on("after-remove",(r=>{r.item.parent=null}))}initialize(){this.when().catch((r=>{A.error("#load()","Failed to load ground",r)})),this.resourceInfo&&this.read(this.resourceInfo.data,this.resourceInfo.context)}destroy(){const r=this.layers.removeAll();for(const e of r)e.destroy();this.layers.destroy()}normalizeCtorArgs(r){return r&&"resourceInfo"in r&&(this._set("resourceInfo",r.resourceInfo),delete(r={...r}).resourceInfo),r}set layers(r){this._set("layers",y(r,this._get("layers")))}writeLayers(r,e,t,o){const s=[];r?(o={...o,layerContainerType:"ground"},r.forEach((r=>{if("write"in r){const e={};l(r)().write(e,o)&&s.push(e)}else o&&o.messages&&o.messages.push(new i("layer:unsupported",`Layers (${r.title}, ${r.id}) of type '${r.declaredClass}' cannot be persisted in the ground`,{layer:r}))})),e.layers=s):e.layers=s}load(r){return this.addResolvingPromise(this._loadFromSource(r)),s(this)}loadAll(){return f(this,(r=>{r(this.layers)}))}async queryElevation(r,e){await this.load({signal:null==e?void 0:e.signal});const{ElevationQuery:t}=await import("./chunks/ElevationQuery.js");n(e);const o=new t,s=this.layers.filter(b).toArray();return o.queryAll(s,r,e)}async createElevationSampler(r,e){await this.load({signal:null==e?void 0:e.signal});const{ElevationQuery:t}=await import("./chunks/ElevationQuery.js");n(e);const o=new t,s=this.layers.filter(b).toArray();return o.createSamplerAll(s,r,e)}clone(){const r={opacity:this.opacity,surfaceColor:e(this.surfaceColor),navigationConstraint:e(this.navigationConstraint),layers:this.layers.slice()};return this.loaded&&(r.loadStatus="loaded"),new S({resourceInfo:this.resourceInfo}).set(r)}read(r,e){this.resourceInfo||this._set("resourceInfo",{data:r,context:e}),super.read(r,e)}_loadFromSource(r){const e=this.resourceInfo;return e?this._loadLayersFromJSON(e.data,e.context,r):s(null)}_loadLayersFromJSON(r,e,t){const o=e&&e.origin||"web-scene",s=e&&e.portal||null,i=e&&e.url||null;return import("./chunks/layersCreator.js").then((({populateOperationalLayers:e})=>{n(t);const l=[];if(r.layers&&Array.isArray(r.layers)){const t={context:{origin:o,url:i,portal:s,layerContainerType:"ground"},defaultLayerType:"ArcGISTiledElevationServiceLayer"};l.push(e(this.layers,r.layers,t))}return a(l)})).then((()=>{}))}};function b(r){return"elevation"===r.type||function(r){return r&&"createElevationSampler"in r}(r)}r([o({json:{read:!1}})],L.prototype,"layers",null),r([g("layers")],L.prototype,"writeLayers",null),r([o({readOnly:!0})],L.prototype,"resourceInfo",void 0),r([o({type:Number,nonNullable:!0,range:{min:0,max:1},json:{type:c,read:{reader:k,source:"transparency"},write:{writer:(r,e)=>{e.transparency=w(r)},target:"transparency"}}})],L.prototype,"opacity",void 0),r([o({type:v,json:{type:[c],write:(r,e)=>{e.surfaceColor=r.toJSON().slice(0,3)}}})],L.prototype,"surfaceColor",void 0),r([o({type:I,json:{write:!0}})],L.prototype,"navigationConstraint",void 0),L=S=r([p("esri.Ground")],L);var E=L;export default E;
