/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
import{_ as t}from"../chunks/tslib.es6.js";import"../chunks/ArrayPool.js";import"../chunks/object.js";import"../chunks/deprecate.js";import"../core/lang.js";import"../config.js";import{b as e}from"../chunks/Logger.js";import{r as i}from"../chunks/string.js";import"../chunks/metadata.js";import{property as n}from"../core/accessorSupport/decorators/property.js";import"../core/Accessor.js";import"../chunks/PropertyOrigin.js";import"../core/scheduling.js";import"../core/promiseUtils.js";import"../chunks/Message.js";import"../core/Error.js";import"../chunks/ensureType.js";import{subclass as s}from"../core/accessorSupport/decorators/subclass.js";import"../chunks/JSONSupport.js";import"../core/urlUtils.js";import"../core/accessorSupport/decorators/cast.js";import"../chunks/reader.js";import"../chunks/writer.js";import"../chunks/resourceExtension.js";import r,{g as m}from"./SpatialReference.js";import a from"./Geometry.js";import o from"./Point.js";import"../chunks/Ellipsoid.js";import{canProject as h,geographicToWebMercator as x,webMercatorToGeographic as c}from"./support/webMercatorUtils.js";const l=[0,0];function u(t,e){return d(t,e.x,e.y,e.z)}function p(t,e){if(!e.points||e.points.length)return!1;for(const i of e.points)if(!f(t,i))return!1;return!0}function f(t,e){return d(t,e[0],e[1])}function y(t,e){return d(t,e[0],e[1],e[2])}function d(t,e,i,n){return e>=t.xmin&&e<=t.xmax&&i>=t.ymin&&i<=t.ymax&&(null==n||!t.hasZ||n>=t.zmin&&n<=t.zmax)}function z(t,e){return l[1]=e.y,l[0]=e.x,g(t,l)}function g(t,e){return function(t,e){if(!t)return!1;if(function(t){return!Array.isArray(t[0][0])}(t))return M(!1,t,e);let i=!1;for(let n=0,s=t.length;n<s;n++)i=M(i,t[n],e);return i}(t.rings,e)}function M(t,e,i){const[n,s]=i;let r=t,m=0;for(let t=0,i=e.length;t<i;t++){m++,m===i&&(m=0);const[a,o]=e[t],[h,x]=e[m];(o<s&&x>=s||x<s&&o>=s)&&a+(s-o)/(x-o)*(h-a)<n&&(r=!r)}return r}function j(t,e){return u(t,e)}function w(t,e){const i=t.hasZ&&e.hasZ;let n,s,r;if(t.xmin<=e.xmin){if(n=e.xmin,t.xmax<n)return!1}else if(n=t.xmin,e.xmax<n)return!1;if(t.ymin<=e.ymin){if(s=e.ymin,t.ymax<s)return!1}else if(s=t.ymin,e.ymax<s)return!1;if(i&&e.hasZ)if(t.zmin<=e.zmin){if(r=e.zmin,t.zmax<r)return!1}else if(r=t.zmin,e.zmax<r)return!1;return!0}function b(t,e){const{points:i,hasZ:n}=e,s=n?y:f;for(const e of i)if(s(t,e))return!0;return!1}const v=[0,0],R=[0,0],Z=[0,0],k=[0,0],O=[v,R,Z,k],_=[[Z,v],[v,R],[R,k],[k,Z]];function N(t,e){v[0]=t.xmin,v[1]=t.ymax,R[0]=t.xmax,R[1]=t.ymax,Z[0]=t.xmin,Z[1]=t.ymin,k[0]=t.xmax,k[1]=t.ymin;for(const t of O)if(g(e,t))return!0;for(const i of e.rings){if(!i.length)continue;let e=i[0];if(f(t,e))return!0;for(let n=1;n<i.length;n++){const s=i[n];if(f(t,s)||C(e,s,_))return!0;e=s}}return!1}function P(t,e){v[0]=t.xmin,v[1]=t.ymax,R[0]=t.xmax,R[1]=t.ymax,Z[0]=t.xmin,Z[1]=t.ymin,k[0]=t.xmax,k[1]=t.ymin;const i=e.paths;for(const e of i){if(!i.length)continue;let n=e[0];if(f(t,n))return!0;for(let i=1;i<e.length;i++){const s=e[i];if(f(t,s)||C(n,s,_))return!0;n=s}}return!1}const S=[0,0];function I(t){for(let e=0;e<t.length;e++){const i=t[e];for(let n=0;n<i.length-1;n++){const s=i[n],r=i[n+1];for(let i=e+1;i<t.length;i++)for(let e=0;e<t[i].length-1;e++){const n=t[i][e],m=t[i][e+1];if(G(s,r,n,m,S)&&!(S[0]===s[0]&&S[1]===s[1]||S[0]===n[0]&&S[1]===n[1]||S[0]===r[0]&&S[1]===r[1]||S[0]===m[0]&&S[1]===m[1]))return!0}}const n=i.length;if(!(n<=4))for(let t=0;t<n-3;t++){let e=n-1;0===t&&(e=n-2);const s=i[t],r=i[t+1];for(let n=t+2;n<e;n++){const t=i[n],e=i[n+1];if(G(s,r,t,e,S)&&!(S[0]===s[0]&&S[1]===s[1]||S[0]===t[0]&&S[1]===t[1]||S[0]===r[0]&&S[1]===r[1]||S[0]===e[0]&&S[1]===e[1]))return!0}}}return!1}function C(t,e,i){for(let n=0;n<i.length;n++)if(G(t,e,i[n][0],i[n][1]))return!0;return!1}function G(t,e,i,n,s){const[r,m]=t,[a,o]=e,[h,x]=i,[c,l]=n,u=c-h,p=r-h,f=a-r,y=l-x,d=m-x,z=o-m,g=y*f-u*z;if(0===g)return!1;const M=(u*d-y*p)/g,j=(f*d-z*p)/g;return M>=0&&M<=1&&j>=0&&j<=1&&(s&&(s[0]=r+M*(a-r),s[1]=m+M*(o-m)),!0)}function A(t){switch(t){case"esriGeometryEnvelope":case"extent":return w;case"esriGeometryMultipoint":case"multipoint":return b;case"esriGeometryPoint":case"point":return j;case"esriGeometryPolygon":case"polygon":return N;case"esriGeometryPolyline":case"polyline":return P;case"mesh":return w}}var W;function T(t,e,i){return null==e?i:null==i?e:t(e,i)}let E=W=class extends a{constructor(...t){super(...t),this.type="extent",this.xmin=0,this.ymin=0,this.mmin=void 0,this.zmin=void 0,this.xmax=0,this.ymax=0,this.mmax=void 0,this.zmax=void 0}normalizeCtorArgs(t,e,i,n,s){return!(m=t)||"esri.geometry.SpatialReference"!==m.declaredClass&&null==m.wkid?"object"==typeof t?(t.spatialReference=null==t.spatialReference?r.WGS84:t.spatialReference,t):{xmin:t,ymin:e,xmax:i,ymax:n,spatialReference:null==s?r.WGS84:s}:{spatialReference:t,xmin:0,ymin:0,xmax:0,ymax:0};var m}static fromBounds(t,e){return new W({xmin:t[0],ymin:t[1],xmax:t[2],ymax:t[3],spatialReference:e})}get center(){const t=new o({x:.5*(this.xmin+this.xmax),y:.5*(this.ymin+this.ymax),spatialReference:this.spatialReference});return this.hasZ&&(t.z=.5*(this.zmin+this.zmax)),this.hasM&&(t.m=.5*(this.mmin+this.mmax)),t}get extent(){return this.clone()}get hasM(){return null!=this.mmin&&null!=this.mmax}get hasZ(){return null!=this.zmin&&null!=this.zmax}get height(){return Math.abs(this.ymax-this.ymin)}get width(){return Math.abs(this.xmax-this.xmin)}centerAt(t){const e=this.center;return null!=t.z&&this.hasZ?this.offset(t.x-e.x,t.y-e.y,t.z-e.z):this.offset(t.x-e.x,t.y-e.y)}clone(){const t=new W;return t.xmin=this.xmin,t.ymin=this.ymin,t.xmax=this.xmax,t.ymax=this.ymax,t.spatialReference=this.spatialReference,null!=this.zmin&&(t.zmin=this.zmin,t.zmax=this.zmax),null!=this.mmin&&(t.mmin=this.mmin,t.mmax=this.mmax),t}contains(t){if(!t)return!1;const e=this.spatialReference,i=t.spatialReference;return e&&i&&!e.equals(i)&&h(e,i)&&(t=e.isWebMercator?x(t):c(t,!0)),"point"===t.type?u(this,t):"extent"===t.type&&function(t,e){const{xmin:i,ymin:n,zmin:s,xmax:r,ymax:m,zmax:a}=e;return t.hasZ&&e.hasZ?d(t,i,n,s)&&d(t,i,m,s)&&d(t,r,m,s)&&d(t,r,n,s)&&d(t,i,n,a)&&d(t,i,m,a)&&d(t,r,m,a)&&d(t,r,n,a):d(t,i,n)&&d(t,i,m)&&d(t,r,m)&&d(t,r,n)}(this,t)}equals(t){if(!t)return!1;const e=this.spatialReference,i=t.spatialReference;return e&&i&&!e.equals(i)&&h(e,i)&&(t=e.isWebMercator?x(t):c(t,!0)),this.xmin===t.xmin&&this.ymin===t.ymin&&this.zmin===t.zmin&&this.mmin===t.mmin&&this.xmax===t.xmax&&this.ymax===t.ymax&&this.zmax===t.zmax&&this.mmax===t.mmax}expand(t){const e=.5*(1-t),i=this.width*e,n=this.height*e;if(this.xmin+=i,this.ymin+=n,this.xmax-=i,this.ymax-=n,this.hasZ){const t=(this.zmax-this.zmin)*e;this.zmin+=t,this.zmax-=t}if(this.hasM){const t=(this.mmax-this.mmin)*e;this.mmin+=t,this.mmax-=t}return this}intersects(t){if(e(t))return!1;"mesh"===t.type&&(t=t.extent);const i=this.spatialReference,n=t.spatialReference;i&&n&&!i.equals(n)&&h(i,n)&&(t=i.isWebMercator?x(t):c(t,!0));return A(t.type)(this,t)}normalize(){const t=this._normalize(!1,!0);return Array.isArray(t)?t:[t]}offset(t,e,i){return this.xmin+=t,this.ymin+=e,this.xmax+=t,this.ymax+=e,null!=i&&(this.zmin+=i,this.zmax+=i),this}shiftCentralMeridian(){return this._normalize(!0)}union(t){return this.xmin=Math.min(this.xmin,t.xmin),this.ymin=Math.min(this.ymin,t.ymin),this.xmax=Math.max(this.xmax,t.xmax),this.ymax=Math.max(this.ymax,t.ymax),(this.hasZ||t.hasZ)&&(this.zmin=T(Math.min,this.zmin,t.zmin),this.zmax=T(Math.max,this.zmax,t.zmax)),(this.hasM||t.hasM)&&(this.mmin=T(Math.min,this.mmin,t.mmin),this.mmax=T(Math.max,this.mmax,t.mmax)),this}intersection(t){return this.intersects(t)?(this.xmin=Math.max(this.xmin,t.xmin),this.ymin=Math.max(this.ymin,t.ymin),this.xmax=Math.min(this.xmax,t.xmax),this.ymax=Math.min(this.ymax,t.ymax),(this.hasZ||t.hasZ)&&(this.zmin=T(Math.max,this.zmin,t.zmin),this.zmax=T(Math.min,this.zmax,t.zmax)),(this.hasM||t.hasM)&&(this.mmin=T(Math.max,this.mmin,t.mmin),this.mmax=T(Math.min,this.mmax,t.mmax)),this):null}toJSON(t){return this.write(null,t)}_shiftCM(t=m(this.spatialReference)){if(!t||!this.spatialReference)return this;const e=this.spatialReference,n=this._getCM(t);if(n){const s=e.isWebMercator?c(n):n;this.xmin-=n.x,this.xmax-=n.x,e.isWebMercator||(s.x=this._normalizeX(s.x,t).x),this.spatialReference=new r(i(e.isWGS84?t.altTemplate:t.wkTemplate,{Central_Meridian:s.x}))}return this}_getCM(t){let e=null;const[i,n]=t.valid,s=this.xmin,r=this.xmax;return s>=i&&s<=n&&(r>=i&&r<=n)||(e=this.center),e}_normalize(t,e,i){const n=this.spatialReference;if(!n)return this;if(!(i=i||m(n)))return this;const s=this._getParts(i).map((t=>t.extent));if(s.length<2)return s[0]||this;if(s.length>2)return t?this._shiftCM(i):this.set({xmin:i.valid[0],xmax:i.valid[1]});if(t)return this._shiftCM(i);if(e)return s;let r=!0,a=!0;return s.forEach((t=>{t.hasZ||(r=!1),t.hasM||(a=!1)})),{rings:s.map((t=>{const e=[[t.xmin,t.ymin],[t.xmin,t.ymax],[t.xmax,t.ymax],[t.xmax,t.ymin],[t.xmin,t.ymin]];if(r){const i=(t.zmax-t.zmin)/2;for(let t=0;t<e.length;t++)e[t].push(i)}if(a){const i=(t.mmax-t.mmin)/2;for(let t=0;t<e.length;t++)e[t].push(i)}return e})),hasZ:r,hasM:a,spatialReference:n}}_getParts(t){let e=this.cache._parts;if(!e){e=[];const{ymin:i,ymax:n,spatialReference:s}=this,r=this.width,a=this.xmin,o=this.xmax;let h;t=t||m(s);const[x,c]=t.valid;h=this._normalizeX(this.xmin,t);const l=h.x,u=h.frameId;h=this._normalizeX(this.xmax,t);const p=h.x,f=h.frameId,y=l===p&&r>0;if(r>2*c){const t=new W(a<o?l:p,i,c,n,s),r=new W(x,i,a<o?p:l,n,s),m=new W(0,i,c,n,s),h=new W(x,i,0,n,s),y=[],d=[];t.contains(m)&&y.push(u),t.contains(h)&&d.push(u),r.contains(m)&&y.push(f),r.contains(h)&&d.push(f);for(let t=u+1;t<f;t++)y.push(t),d.push(t);e.push({extent:t,frameIds:[u]},{extent:r,frameIds:[f]},{extent:m,frameIds:y},{extent:h,frameIds:d})}else l>p||y?e.push({extent:new W(l,i,c,n,s),frameIds:[u]},{extent:new W(x,i,p,n,s),frameIds:[f]}):e.push({extent:new W(l,i,p,n,s),frameIds:[u]});this.cache._parts=e}const i=this.hasZ,n=this.hasM;if(i||n){const t={};i&&(t.zmin=this.zmin,t.zmax=this.zmax),n&&(t.mmin=this.mmin,t.mmax=this.mmax);for(let i=0;i<e.length;i++)e[i].extent.set(t)}return e}_normalizeX(t,e){const[i,n]=e.valid,s=2*n;let r,m=0;return t>n?(r=Math.ceil(Math.abs(t-n)/s),t-=r*s,m=r):t<i&&(r=Math.ceil(Math.abs(t-i)/s),t+=r*s,m=-r),{x:t,frameId:m}}};t([n({dependsOn:["xmin","ymin","zmin","mmin","xmax","ymax","zmax","mmax","spatialReference"],autoTracked:!1})],E.prototype,"cache",void 0),t([n({readOnly:!0,dependsOn:["cache"],autoTracked:!1})],E.prototype,"center",null),t([n({readOnly:!0,dependsOn:["cache"],autoTracked:!1})],E.prototype,"extent",null),t([n({readOnly:!0,dependsOn:["mmin","mmax"],json:{write:{enabled:!1,overridePolicy:null}}})],E.prototype,"hasM",null),t([n({readOnly:!0,dependsOn:["zmin","zmax"],json:{write:{enabled:!1,overridePolicy:null}}})],E.prototype,"hasZ",null),t([n({readOnly:!0,dependsOn:["ymin","ymax"]})],E.prototype,"height",null),t([n({readOnly:!0,dependsOn:["xmin","xmax"]})],E.prototype,"width",null),t([n({type:Number,json:{type:[Number,String],write:{enabled:!0,allowNull:!0}}})],E.prototype,"xmin",void 0),t([n({type:Number,json:{write:!0}})],E.prototype,"ymin",void 0),t([n({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasM}}}}})],E.prototype,"mmin",void 0),t([n({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasZ}}}}})],E.prototype,"zmin",void 0),t([n({type:Number,json:{write:!0}})],E.prototype,"xmax",void 0),t([n({type:Number,json:{write:!0}})],E.prototype,"ymax",void 0),t([n({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasM}}}}})],E.prototype,"mmax",void 0),t([n({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasZ}}}}})],E.prototype,"zmax",void 0),E=W=t([s("esri.geometry.Extent")],E),E.prototype.toJSON.isDefaultToJSON=!0;var q=E;export default q;export{P as a,p as b,y as c,u as e,A as g,I as i,z as p,G as s};
