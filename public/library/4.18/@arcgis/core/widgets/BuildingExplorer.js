/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
import{_ as e}from"../chunks/tslib.es6.js";import"../chunks/ArrayPool.js";import"../chunks/object.js";import"../chunks/deprecate.js";import"../core/lang.js";import"../config.js";import{b as s,i,u as t}from"../chunks/Logger.js";import"../chunks/string.js";import"../chunks/metadata.js";import{property as o}from"../core/accessorSupport/decorators/property.js";import"../core/Accessor.js";import"../chunks/PropertyOrigin.js";import"../core/scheduling.js";import{o as r}from"../core/promiseUtils.js";import"../chunks/Message.js";import"../core/Error.js";import"../chunks/compilerUtils.js";import"../chunks/ensureType.js";import{subclass as l}from"../core/accessorSupport/decorators/subclass.js";import"../chunks/Evented.js";import"../core/Collection.js";import"../chunks/collectionUtils.js";import"../chunks/JSONSupport.js";import"../chunks/Promise.js";import"../chunks/Loadable.js";import"../chunks/asyncUtils.js";import"../chunks/loadAll.js";import"../core/urlUtils.js";import{aliasOf as n}from"../core/accessorSupport/decorators/aliasOf.js";import{cast as a}from"../core/accessorSupport/decorators/cast.js";import"../chunks/jsonMap.js";import"../chunks/enumeration.js";import"../chunks/reader.js";import"../chunks/shared.js";import"../chunks/writer.js";import"../chunks/multiOriginJSONSupportUtils.js";import"../chunks/resourceExtension.js";import"../chunks/persistableUrlUtils.js";import"../geometry/SpatialReference.js";import"../chunks/locale.js";import"../chunks/number.js";import"../intl.js";import"../kernel.js";import"../request.js";import"../chunks/assets.js";import"../geometry/Geometry.js";import"../geometry/Point.js";import"../chunks/Ellipsoid.js";import"../geometry/support/webMercatorUtils.js";import"../geometry/Extent.js";import"../portal/PortalQueryParams.js";import"../portal/PortalQueryResult.js";import"../portal/PortalFolder.js";import"../portal/PortalGroup.js";import"../portal/PortalUser.js";import"../portal/Portal.js";import"../portal/PortalItemResource.js";import"../portal/PortalRating.js";import"../portal/PortalItem.js";import{c as p}from"../chunks/mathUtils2.js";import"../chunks/colorUtils.js";import"../Color.js";import"../chunks/zmUtils.js";import"../geometry/Multipoint.js";import"../geometry/Polygon.js";import"../chunks/extentUtils.js";import"../geometry/Polyline.js";import"../chunks/typeUtils.js";import"../geometry/support/jsonUtils.js";import"../geometry.js";import"../layers/support/CodedValueDomain.js";import"../layers/support/Domain.js";import"../layers/support/InheritedDomain.js";import"../layers/support/RangeDomain.js";import"../chunks/domains.js";import"../chunks/arcadeOnDemand.js";import"../layers/support/fieldUtils.js";import"../popup/content/Content.js";import"../popup/content/AttachmentsContent.js";import"../popup/content/CustomContent.js";import"../chunks/date.js";import"../popup/support/FieldInfoFormat.js";import"../popup/FieldInfo.js";import"../popup/content/FieldsContent.js";import"../chunks/MediaInfo.js";import"../popup/content/support/ChartMediaInfoValueSeries.js";import"../popup/content/support/ChartMediaInfoValue.js";import"../chunks/chartMediaInfoUtils.js";import"../popup/content/BarChartMediaInfo.js";import"../popup/content/ColumnChartMediaInfo.js";import"../popup/content/support/ImageMediaInfoValue.js";import"../popup/content/ImageMediaInfo.js";import"../popup/content/LineChartMediaInfo.js";import"../popup/content/PieChartMediaInfo.js";import"../popup/content/MediaContent.js";import"../popup/content/TextContent.js";import"../popup/content.js";import"../popup/ExpressionInfo.js";import"../popup/LayerOptions.js";import"../popup/support/RelatedRecordsInfoFieldOrder.js";import"../popup/RelatedRecordsInfo.js";import"../chunks/Identifiable.js";import"../support/actions/ActionBase.js";import"../support/actions/ActionButton.js";import"../support/actions/ActionToggle.js";import"../PopupTemplate.js";import"../symbols/Symbol.js";import"../symbols/CIMSymbol.js";import"../symbols/Symbol3DLayer.js";import"../chunks/screenUtils.js";import"../chunks/opacityUtils.js";import"../chunks/materialUtils.js";import"../symbols/edges/Edges3D.js";import"../symbols/edges/SketchEdges3D.js";import"../symbols/edges/SolidEdges3D.js";import"../chunks/utils.js";import"../chunks/Symbol3DMaterial.js";import"../symbols/ExtrudeSymbol3DLayer.js";import"../symbols/LineSymbol.js";import"../symbols/LineSymbolMarker.js";import"../symbols/SimpleLineSymbol.js";import"../symbols/FillSymbol.js";import"../symbols/patterns/StylePattern3D.js";import"../symbols/FillSymbol3DLayer.js";import"../chunks/colors.js";import"../chunks/Symbol3DOutline.js";import"../symbols/Font.js";import"../symbols/IconSymbol3DLayer.js";import"../symbols/LineSymbol3DLayer.js";import"../symbols/ObjectSymbol3DLayer.js";import"../symbols/PathSymbol3DLayer.js";import"../symbols/TextSymbol3DLayer.js";import"../symbols/WaterSymbol3DLayer.js";import"../symbols/Symbol3D.js";import"../chunks/Thumbnail.js";import"../symbols/callouts/Callout3D.js";import"../symbols/callouts/LineCallout3D.js";import"../chunks/Symbol3DVerticalOffset.js";import"../symbols/LabelSymbol3D.js";import"../symbols/LineSymbol3D.js";import"../symbols/MarkerSymbol.js";import"../symbols/MeshSymbol3D.js";import"../chunks/urlUtils.js";import"../symbols/PictureFillSymbol.js";import"../symbols/PictureMarkerSymbol.js";import"../symbols/PointSymbol3D.js";import"../symbols/PolygonSymbol3D.js";import"../symbols/SimpleFillSymbol.js";import"../symbols/SimpleMarkerSymbol.js";import"../symbols/TextSymbol.js";import"../symbols/WebStyleSymbol.js";import"../symbols/support/jsonUtils.js";import"../chunks/uid.js";import"../Graphic.js";import h from"../core/Handles.js";import"../chunks/CollectionFlattener.js";import"../layers/Layer.js";import"../chunks/LegendOptions.js";import"../renderers/support/AuthoringInfo.js";import"../renderers/support/AuthoringInfoVisualVariable.js";import"../tasks/support/ColorRamp.js";import"../tasks/support/AlgorithmicColorRamp.js";import"../tasks/support/MultipartColorRamp.js";import"../chunks/colorRamps.js";import"../renderers/Renderer.js";import"../renderers/visualVariables/VisualVariable.js";import"../renderers/visualVariables/support/ColorStop.js";import"../renderers/visualVariables/ColorVariable.js";import"../renderers/visualVariables/support/OpacityStop.js";import"../renderers/visualVariables/OpacityVariable.js";import"../renderers/visualVariables/RotationVariable.js";import"../renderers/visualVariables/support/SizeStop.js";import"../renderers/visualVariables/SizeVariable.js";import"../chunks/sizeVariableUtils.js";import"../chunks/unitUtils.js";import"../chunks/lengthUtils.js";import"../chunks/visualVariableUtils.js";import"../chunks/VisualVariablesMixin.js";import"../renderers/support/ClassBreakInfo.js";import"../chunks/commonProperties.js";import"../renderers/ClassBreaksRenderer.js";import"../chunks/diffUtils.js";import"../renderers/support/UniqueValueInfo.js";import"../chunks/devEnvironmentUtils.js";import"../chunks/styleUtils.js";import"../renderers/UniqueValueRenderer.js";import"../chunks/MemCache.js";import"../chunks/LRUCache.js";import"../renderers/DictionaryRenderer.js";import"../renderers/support/AttributeColorInfo.js";import"../renderers/DotDensityRenderer.js";import"../renderers/support/HeatmapColorStop.js";import"../renderers/HeatmapRenderer.js";import"../renderers/SimpleRenderer.js";import"../renderers/support/jsonUtils.js";import"../chunks/timeUtils.js";import"../TimeExtent.js";import"../TimeInterval.js";import"../chunks/ReadOnlyMultiOriginJSONSupport.js";import"../chunks/MultiOriginJSONSupport.js";import{on as d,init as c}from"../core/watchUtils.js";import"../chunks/originUtils.js";import"../chunks/arcgisLayerUrl.js";import"../chunks/fieldType.js";import"../geometry/HeightModelInfo.js";import"../chunks/resourceUtils.js";import"../chunks/saveUtils.js";import"../chunks/OperationalLayer.js";import"../chunks/ElevationInfo.js";import"../chunks/unitConversionUtils.js";import"../chunks/commonProperties2.js";import"../core/workers/Connection.js";import"../chunks/Scheduler.js";import"../core/workers/workers.js";import"../form/ExpressionInfo.js";import"../form/elements/FieldElement.js";import"../form/support/elements.js";import"../form/elements/inputs/Input.js";import"../form/elements/support/inputs.js";import"../form/elements/inputs/DateTimePickerInput.js";import"../form/elements/inputs/TextInput.js";import"../form/elements/inputs/TextAreaInput.js";import"../form/elements/inputs/TextBoxInput.js";import"../form/elements/GroupElement.js";import"../form/FormTemplate.js";import"../chunks/domUtils.js";import{i as u,s as m}from"../chunks/widgetUtils.js";import"../chunks/projector.js";import{m as v}from"../chunks/messageBundle.js";import{r as g}from"../chunks/renderable.js";import{j as _}from"../chunks/index.js";import y from"./Widget.js";import"../chunks/zscale.js";import"../chunks/queryZScale.js";import"../layers/support/Field.js";import"../tasks/support/FeatureSet.js";import"../layers/FeatureLayer.js";import"../chunks/ArcGISService.js";import"../chunks/BlendLayer.js";import"../chunks/CustomParametersMixin.js";import"../chunks/PortalLayer.js";import"../chunks/RefreshableLayer.js";import"../chunks/ScaleRangeLayer.js";import"../layers/support/TimeInfo.js";import"../chunks/TemporalLayer.js";import"../layers/support/FeatureReductionSelection.js";import"../layers/support/FeatureReductionCluster.js";import"../chunks/labelUtils.js";import"../layers/support/LabelClass.js";import"../chunks/defaultsJSON.js";import"../chunks/defaults.js";import"../chunks/featureReductionUtils.js";import"../layers/support/FeatureTemplate.js";import"../layers/support/FeatureType.js";import"../chunks/fieldProperties.js";import"../layers/support/FieldsIndex.js";import"../chunks/labelingInfo.js";import"../layers/support/Relationship.js";import"../chunks/DataLayerSource.js";import"../chunks/styleUtils2.js";import"../support/popupUtils.js";import"../tasks/support/AttachmentQuery.js";import"../tasks/support/Query.js";import"../tasks/support/StatisticDefinition.js";import"../tasks/support/RelationshipQuery.js";import"../layers/buildingSublayers/BuildingSublayer.js";import"../chunks/capabilities.js";import"../chunks/I3SLayerDefinitions.js";import"../layers/buildingSublayers/BuildingComponentSublayer.js";import"../layers/buildingSublayers/BuildingGroupSublayer.js";import"../chunks/SceneService.js";import"../layers/support/BuildingFilter.js";import"../chunks/BuildingFilterBlock.js";import"../layers/support/BuildingSummaryStatistics.js";import"../chunks/FetchAssociatedFeatureLayer.js";import"../layers/BuildingSceneLayer.js";import"../chunks/filterUtils.js";import b,{L as j,B as k}from"./BuildingExplorer/BuildingExplorerViewModel.js";import w from"./BuildingExplorer/BuildingLevel.js";import L from"./BuildingExplorer/BuildingPhase.js";var C;const f={expand:"expand",collapse:"collapse",hideSublayer:"hideSublayer",showSublayer:"showSublayer"},M="esri-building-disciplines-tree-node",P={base:`${M}`,root:`${M}--root`,leaf:`${M}--leaf`,label:`${M}__label`,checkbox:`${M}__checkbox`,checkboxChecked:`${M}__checkbox--checked esri-icon-check-mark`,checkboxIndeterminate:`${M}__checkbox--indeterminate esri-icon-minus`,collapseToggle:`${M}__collapse-toggle esri-icon-right`,collapseToggleCollapsed:`${M}__collapse-toggle--collapsed`,children:`${M}__children`,level:e=>`${M}--level-${e}`};let S=C=class extends y{constructor(e){super(e),this.messages=f,this.toggleSiblingsVisibility=!1,this._childWidgets=[],this._updateChildWidgets=()=>{this._destroyChildWidgets(),this._childWidgets=this.node.children.toArray().reverse().map((e=>new C({node:e,messages:this.messages,toggleSiblingsVisibility:this.toggleSiblingsVisibility})))}}initialize(){this.own(d(this,"node.children","after-changes",this._updateChildWidgets,this._updateChildWidgets,this._updateChildWidgets),this.watch(["messages","toggleSiblingsVisibility"],this._updateChildWidgets))}destroy(){this._destroyChildWidgets()}render(){const e=this.node,s=e.isRoot,i=e.isLeaf;return e.isDiscipline&&i?[]:_("div",{key:e.id,class:this.classes(P.base,P.level(e.level),{[P.root]:s,[P.leaf]:i}),bind:this,onkeydown:this._onKeydown,tabIndex:i?null:0,role:"treeitem","aria-expanded":e.collapsed?"false":"true"},_("label",{bind:this,class:P.label,onclick:this._onCheckboxToggle},this._renderCollapseToggle(),this._renderCheckbox(),_("span",null,e.title)),this._renderChildren(e))}_renderCheckbox(){var e,s;const i=this.node.visible,t=!0===i,o=null===i,r=t?null==(e=this.messages)?void 0:e.hideSublayer:null==(s=this.messages)?void 0:s.showSublayer;return _("button",{bind:this,class:this.classes(P.checkbox,{[P.checkboxChecked]:t,[P.checkboxIndeterminate]:o}),onclick:this._onCheckboxToggle,role:"checkbox","aria-checked":t?"true":"false","aria-label":r,title:r,type:"button"})}_renderCollapseToggle(){var e,s;if(!this.node.hasChildren)return[];const i=this.node.collapsed,t=i?null==(e=this.messages)?void 0:e.expand:null==(s=this.messages)?void 0:s.collapse;return _("div",{bind:this,class:this.classes(P.collapseToggle,{[P.collapseToggleCollapsed]:i}),onclick:this._onCollapseToggle,"aria-label":t,title:t})}_renderChildren(e){return!e.hasChildren||e.collapsed?[]:_("div",{class:P.children},this._childWidgets.map((e=>e.render())))}_onKeydown(e){switch(e.key){case"Space":case"Enter":if(!e.target.classList.contains(P.base))return;e.stopPropagation(),this.node.toggleVisibility();break;case"ArrowLeft":e.stopPropagation(),this.node.toggleCollapsed(!u());break;case"ArrowRight":e.stopPropagation(),this.node.toggleCollapsed(!!u())}}_onCheckboxToggle(e){e.preventDefault(),e.stopPropagation();(e.metaKey||e.ctrlKey)&&this.toggleSiblingsVisibility?this.node.toggleAllSiblingsVisibility():this.node.toggleVisibility()}_onCollapseToggle(e){e.preventDefault(),e.stopPropagation(),this.node.toggleCollapsed()}_destroyChildWidgets(){this._childWidgets.forEach((e=>e.destroy())),this._childWidgets=[]}};e([o({type:j}),g(["node.hasChildren","node.isDiscipline","node.level","node.title","node.visible"])],S.prototype,"node",void 0),e([o(),g()],S.prototype,"messages",void 0),e([o({nonNullable:!0})],S.prototype,"toggleSiblingsVisibility",void 0),e([o(),g()],S.prototype,"_childWidgets",void 0),S=C=e([l("esri.widgets.BuildingExplorer.BuildingDisciplinesTree.BuildingDisciplinesNode")],S);var E=S;const x={expand:"expand",collapse:"collapse",hideSublayer:"hideSublayer",showSublayer:"showSublayer"},V={base:"esri-building-disciplines-tree"};let D=class extends y{constructor(e){super(e),this._defaultViewModel=new k,this.viewModel=this._defaultViewModel,this.messages=x,this.toggleSiblingsVisibility=!1,this._childWidgets=[],this._updateChildWidgets=()=>{this._destroyChildWidgets(),this.viewModel&&(this._childWidgets=this.viewModel.root.children.toArray().reverse().map((e=>new E({node:e,messages:this.messages,toggleSiblingsVisibility:this.toggleSiblingsVisibility}))))}}initialize(){this.own(d(this,"viewModel.root.children","after-changes",this._updateChildWidgets,this._updateChildWidgets,this._updateChildWidgets),c(this,["messages","toggleSiblingsVisibility"],this._updateChildWidgets))}destroy(){this._destroyChildWidgets(),this.viewModel!==this._defaultViewModel&&this._defaultViewModel.destroy()}render(){return _("div",{role:"tree",class:V.base},this._childWidgets.map((e=>e.render())))}_destroyChildWidgets(){this._childWidgets.forEach((e=>e.destroy())),this._childWidgets=[]}};e([o({type:k}),g()],D.prototype,"viewModel",void 0),e([o(),g()],D.prototype,"messages",void 0),e([o({nonNullable:!0}),g()],D.prototype,"toggleSiblingsVisibility",void 0),e([o(),g()],D.prototype,"_childWidgets",void 0),D=e([l("esri.widgets.BuildingExplorer.BuildingDisciplinesTree.BuildingDisciplinesTree")],D);var I=D;var T=Object.freeze({__proto__:null,LEVEL_HOVERED_EXTRA_HEIGHT:30,LEVEL_HOVERED_EXTRA_WIDTH:20,ALPHA_LEVEL_DEPENDENCY_FACTOR:30,ALPHA_SPREAD_FACTOR:10,LEVELS_PADDING:20,LEVELS_MARGIN_FACTOR:2,LEVELS_POINTER_ADJUSTMENT:.035,LEVEL_WIDTH_MIN:30,LEVEL_HEIGHT_DEFAULT:14,LEVEL_WIDTH_MAX:80,LEVEL_WIDTH_NOMINATOR:100,LEVEL_WIDTH_CONSTANT:40});const W="esri-building-level-picker-label",A={iconClose:"esri-icon-close",base:`${W}`,active:`${W}--active`,hover:`${W}--hover`,empty:`${W}--empty`,clearButton:`${W}__clear-button`};let U=class extends y{constructor(e,s){super(e,s),this.level=null,this.active=!1,this.hovering=!1,this.messages={clearLevel:"",selectLevel:""},this.onClear=()=>{}}render(){if(s(this.level))return _("div",{class:A.empty,title:this.messages.selectLevel},this.messages.selectLevel);const e=this.messages.clearLevel;return _("div",{bind:this,class:this.classes(A.base,{[A.active]:this.active,[A.hover]:this.hovering}),onclick:this.onClear,title:e,"aria-label":e},_("span",null,this.level),_("button",{bind:this,class:this.classes(A.clearButton,A.iconClose),disabled:!this.active,onclick:this.onClear,type:"button"}))}};e([o(),g()],U.prototype,"level",void 0),e([o({nonNullable:!0}),g()],U.prototype,"active",void 0),e([o({nonNullable:!0}),g()],U.prototype,"hovering",void 0),e([o(),g()],U.prototype,"messages",void 0),e([o({nonNullable:!0})],U.prototype,"onClear",void 0),U=e([l("esri.widgets.BuildingExplorer.BuildingLevelPicker.Label")],U);const R="esri-building-level-picker-item",B="esri-building-level-picker-item__base",$="esri-building-level-picker-item--hover",H="esri-building-level-picker-item--active";let O=class extends y{constructor(e,s){super(e,s),this.active=!1,this.hovering=!1,this.width=0,this.height=0,this.onSelect=()=>{},this.onFocus=()=>{},this.onBlur=()=>{},this._baseElement=null}render(){return _("div",{key:this,bind:this,class:this.classes(R,{[H]:this.active,[$]:this.hovering}),styles:{height:`${this.height}px`}},this._renderBase())}focus(){s(this._baseElement)||this._baseElement.focus()}_renderBase(){const e=this.width,s=.8*this.width;return _("div",{class:B,styles:{width:`${Math.round(e)}px`,height:`${Math.round(e)}px`}},_("button",{bind:this,class:"rect",styles:{width:`${Math.round(s)}px`,height:`${Math.round(s)}px`},onclick:this.onSelect,onfocus:this.onFocus,onblur:this.onBlur,afterCreate:m,"data-node-ref":"_baseElement","aria-label":this.label,title:this.label,tabIndex:-1,type:"button"}))}};e([o({nonNullable:!0}),g()],O.prototype,"level",void 0),e([o(),g()],O.prototype,"label",void 0),e([o({nonNullable:!0}),g()],O.prototype,"active",void 0),e([o({nonNullable:!0}),g()],O.prototype,"hovering",void 0),e([o({nonNullable:!0}),g()],O.prototype,"width",void 0),e([o({nonNullable:!0}),g()],O.prototype,"height",void 0),e([o({nonNullable:!0})],O.prototype,"onSelect",void 0),e([o({nonNullable:!0})],O.prototype,"onFocus",void 0),e([o({nonNullable:!0})],O.prototype,"onBlur",void 0),O=e([l("esri.widgets.BuildingExplorer.BuildingLevelPicker.LevelItem")],O);const F={selectLevel:"selectLevel",clearLevel:"clearLevel",nextLevel:"nextLevel",previousLevel:"previousLevel",currentLevel:"{{value}}"},N="esri-building-level-picker",z={container:N,noLevel:`${N}--no-level`,animateLevel:`${N}--animate-level`,levelsContainer:`${N}__levels-container`,innerLevelsContainer:`${N}__inner-levels-container`,labelContainer:`${N}__label-container`,arrowUp:`${N}__arrow-up`,arrowDown:`${N}__arrow-down`};let G=class extends y{constructor(e,s){super(e,s),this._defaultViewModel=new w,this.viewModel=this._defaultViewModel,this.messages=F,this._levelHandles=new h,this._levelEventHandles=new h,this._levelWidgets=[],this._labelWidget=new U({onClear:()=>this.viewModel.clear()}),this._hoveredLevel=null,this._expandedLevelsHeight=void 0,this._normalizedPointerPosition=0,this._hovering=!1,this._containerPosTop=null,this._levelsContainer=null,this._onPointerUp=()=>{window.getSelection().removeAllRanges(),i(this._hoveredLevel)&&(this.viewModel.enabled&&this._hoveredLevel===this.viewModel.value?this.viewModel.clear():this.viewModel.select(this._hoveredLevel))},this._onPointerEnter=()=>{var e;!this._hovering&&i(this._levelsContainer)&&(this._hovering=!0,this._containerPosTop=null!=(e=this._levelsContainer.getBoundingClientRect().top)?e:0)},this._onPointerLeave=()=>{this._hovering&&(this._normalizedPointerPosition=0,this._hoveredLevel=null,this._hovering=!1)},this._onPointerMove=e=>{if(!this._hovering)return!1;if(window.getSelection().removeAllRanges(),i(this._containerPosTop)){const s=this._containerPosTop,i=40,t=this._expandedLevelsMargin;let o=this._levelsHeight,r=s+i+t;const l=this._levelHeight/2;r+=l,o-=l;let n=(e.clientY-r)/o;n+=.035,this._normalizedPointerPosition=n}return!1}}postInitialize(){this.own(c(this,"_levelsContainer",(()=>this._onContainerChange())),c(this,"_levels",(()=>this._createLevelWidgets())),c(this,"messages",(()=>this._labelWidget.messages=this.messages)))}destroy(){this._levelHandles.destroy(),this._levelEventHandles.destroy(),this._levelWidgets.forEach((e=>e.destroy())),this._labelWidget.destroy(),this.viewModel!==this._defaultViewModel&&this._defaultViewModel.destroy()}get _levelsHeight(){return Math.round(this._levelHeight*this._numLevels)}get _expandedLevelsMargin(){return Math.round((this._expandedLevelsHeight-this._levelsHeight)/2)}get _levelWidth(){const{LEVEL_WIDTH_NOMINATOR:e,LEVEL_WIDTH_CONSTANT:s}=T,i=e/Math.sqrt(this._numLevels)+s;return Math.round(p(i,30,80))}get _levelHeight(){const e=28/Math.sqrt(this._numLevels);return Math.round(p(e,2,14))}get _gaussianFactor(){const e=this._numLevels;return e/Math.log(30*e)*10}get _levelClosestToPointer(){if(!this._hovering)return null;const e=this._numLevels-1,s=this._normalizedPointerPosition;return e>=0&&i(s)?this._levels[Math.round((1-s)*e)]:null}render(){const e=this._levelWidgets.length,s=e>1?this._levelWidgets.map((e=>e.render())):null,i=this._levelsHeight,t=i+80;return _("div",{bind:this,key:this,class:this.classes("esri-widget",z.container,{[z.animateLevel]:!this._hovering,[z.noLevel]:e<2}),onkeydown:this._onKeyDown},this._renderLabelContainer(),_("div",{bind:this,class:z.levelsContainer,styles:{height:`${t}px`,marginTop:"-20px",marginBottom:"-20px"},onfocus:this._onFocus,afterCreate:m,"data-node-ref":"_levelsContainer"},_("div",{styles:{height:`${i}px`,margin:20-this._expandedLevelsMargin+"px 0 0 0"},class:z.innerLevelsContainer},s)))}_renderLabelContainer(){const e=this.messages.previousLevel,s=this.messages.nextLevel;return _("div",{class:z.labelContainer,tabIndex:0},_("button",{bind:this,class:z.arrowUp,disabled:!this.viewModel.hasNext,onclick:this._onArrowUpClick,"aria-label":s,title:s,type:"button"}),this._labelWidget.render(),_("button",{bind:this,class:z.arrowDown,disabled:!this.viewModel.hasPrevious,onclick:this._onArrowDownClick,"aria-label":e,title:e,type:"button"}))}_updateComponents(){const e=this.viewModel.enabled?this.viewModel.value:null,s=i(this._hoveredLevel)?this._hoveredLevel:e;this._levelWidgets.forEach((s=>{var t,o;const r=this.viewModel.getValueLabel(s.level);s.label=i(r)?r:null==(t=this.messages)||null==(o=t.currentLevel)?void 0:o.replace("{{level}}",String(s.level)),s.active=s.level===e,s.hovering=s.level===this._hoveredLevel})),this._labelWidget.level=s,this._labelWidget.active=s===e,this._labelWidget.hovering=i(this._hoveredLevel)}_onWidthChange(){this._levelWidgets.forEach((e=>{e.width=this._levelWidth}))}_createLevelWidgets(){this._levelWidgets.forEach((e=>e.destroy())),this._levelWidgets=this._levels.map((e=>new O({level:e,onSelect:()=>this._onLevelToggle(e)}))),this._levelHandles.removeAll(),this._levelHandles.add([c(this,["messages","viewModel.value","viewModel.enabled","_hoveredLevel","_hovering"],(()=>this._updateComponents())),c(this,["_normalizedPointerPosition","_hovering"],(()=>this._onPointerPositionChange())),c(this,"_width",(()=>this._onWidthChange()))])}_onContainerChange(){const e=this._levelsContainer;i(e)&&(this._levelEventHandles.removeAll(),this._levelEventHandles.add([r(e,"pointerenter",this._onPointerEnter),r(e,"pointerover",this._onPointerEnter),r(e,"pointerleave",this._onPointerLeave),r(e,"pointerup",this._onPointerUp),r(e,"pointermove",this._onPointerMove)]))}_onKeyDown(e){switch(e.key){case"ArrowDown":case"ArrowLeft":e.preventDefault(),e.stopPropagation(),this.viewModel.previous(),this._focusCurrentLevel();break;case"ArrowUp":case"ArrowRight":e.preventDefault(),e.stopPropagation(),this.viewModel.next(),this._focusCurrentLevel()}}_focusCurrentLevel(){const e=this._levelWidgets.find((e=>e.level===this.viewModel.value));e&&e.focus()}_onFocus(){this._hoveredLevel=this._levels.length>0?this._levels[0]:null}_onLevelToggle(e){this.viewModel.enabled&&this.viewModel.value===e?this.viewModel.clear():this.viewModel.select(e)}_onArrowUpClick(){this.viewModel.next()}_onArrowDownClick(){this.viewModel.previous()}_onPointerPositionChange(){let e=0;this._levelWidgets.forEach(((s,i)=>{const{width:t,height:o}=this._getLevelWidgetSize(i);s.height=o,s.width=t,e+=o})),this._hoveredLevel=this._levelClosestToPointer;const s=this._expandedLevelsHeight;(null==s||Math.abs(s-e)>30)&&(this._expandedLevelsHeight=e)}_getLevelWidgetSize(e){const s={width:this._levelWidth,height:this._levelHeight};if(this._hovering){const i=this._getGaussianFactor(e,this._normalizedPointerPosition);s.width+=20*i,s.height+=30*i}return s}_getGaussianFactor(e,s){const i=this._numLevels-1,t=(i-e)/i,o=this._gaussianFactor*(t-s);return Math.exp(-(o**2))}};e([o({type:w}),g(["viewModel.hasNext","viewModel.hasPrevious"])],G.prototype,"viewModel",void 0),e([o()],G.prototype,"messages",void 0),e([o(),g()],G.prototype,"_levelWidgets",void 0),e([o(),g()],G.prototype,"_labelWidget",void 0),e([o(),g()],G.prototype,"_hoveredLevel",void 0),e([n("viewModel.allowedValues"),g()],G.prototype,"_levels",void 0),e([n("_levels.length"),g()],G.prototype,"_numLevels",void 0),e([o({readOnly:!0,dependsOn:["_numLevels","_levelHeight"]}),g()],G.prototype,"_levelsHeight",null),e([o(),g()],G.prototype,"_expandedLevelsHeight",void 0),e([o({readOnly:!0,dependsOn:["_expandedLevelsHeight","_levelsHeight"]}),g()],G.prototype,"_expandedLevelsMargin",null),e([o({readOnly:!0,dependsOn:["_numLevels"]})],G.prototype,"_levelWidth",null),e([o({readOnly:!0,dependsOn:["_numLevels"]})],G.prototype,"_levelHeight",null),e([o({readOnly:!0,dependsOn:["_numLevels"]})],G.prototype,"_gaussianFactor",null),e([o({readOnly:!0,dependsOn:["_levels","_numLevels","_hovering","_normalizedPointerPosition"]})],G.prototype,"_levelClosestToPointer",null),e([o({type:Number,range:{min:0,max:1}}),g()],G.prototype,"_normalizedPointerPosition",void 0),e([o()],G.prototype,"_hovering",void 0),e([o()],G.prototype,"_containerPosTop",void 0),e([o()],G.prototype,"_levelsContainer",void 0),G=e([l("esri.widgets.BuildingExplorer.BuildingLevelPicker.BuildingLevelPicker")],G);var K=G;const q={nextPhase:"nextPhase",previousPhase:"previousPhase",currentPhase:"{{value}}"},J="esri-building-phase-picker",Q={container:`${J}`,phasesContainer:`${J}__phases-container`,phase:`${J}__phase`,phaseActive:`${J}__phase--active`,phaseCurrent:`${J}__phase--current`,divider:`${J}__divider`,dividerActive:`${J}__divider--active`,arrowLeft:`${J}__arrow-left`,arrowRight:`${J}__arrow-right`};let X=class extends y{constructor(e,s){super(e,s),this._defaultViewModel=new L,this.viewModel=this._defaultViewModel,this.messages=q,this._phasesContainer=null,this._shouldScrollCurrentPhaseIntoView=!0,this._shouldFocusCurrentPhase=!1}initialize(){this.own(this.watch(["_currentPhase","_container"],(()=>{this._shouldScrollCurrentPhaseIntoView=!0})))}destroy(){this.viewModel!==this._defaultViewModel&&this._defaultViewModel.destroy()}get _currentPhase(){return this.viewModel.enabled?this.viewModel.value:null}render(){if(this._phases.length<2)return _("div",null);const e=u(),s=this.messages.previousPhase,i=this.messages.nextPhase;return _("div",{bind:this,key:this,class:this.classes("esri-widget",Q.container),onkeydown:this._onKeyDown},_("button",{bind:this,class:e?Q.arrowRight:Q.arrowLeft,disabled:!this.viewModel.hasPrevious,onclick:this._onArrowLeftClick,"aria-label":s,title:s,type:"button"}),_("div",{bind:this,class:Q.phasesContainer,afterCreate:m,"data-node-ref":"_phasesContainer",afterUpdate:this._onPhasesContainerAfterUpdate},this._renderPhaseButtons()),_("button",{bind:this,class:e?Q.arrowLeft:Q.arrowRight,disabled:!this.viewModel.hasNext,onclick:this._onArrowRightClick,"aria-label":i,title:i,type:"button"}))}_renderPhaseButtons(){const e=this._phases,s=[];for(let t=0;t<e.length;++t){const o=e[t],r={phase:o,active:!!i(this._currentPhase)&&o<=this._currentPhase,current:!!i(this._currentPhase)&&o===this._currentPhase};t>0&&s.push(this._renderDivider(r)),s.push(this._renderPhaseButton(r))}return s}_renderPhaseButton({phase:e,active:s,current:i}){const o=t(this.viewModel.getValueLabel(e));return _("button",{key:`phase-${e}`,class:this.classes(Q.phase,{[Q.phaseActive]:s,[Q.phaseCurrent]:i}),"aria-label":o,title:o,onclick:()=>this.viewModel.select(e),type:"button"},e)}_renderDivider({phase:e,active:s}){return _("div",{key:`phase-divider-${e}`,class:this.classes(Q.divider,{[Q.dividerActive]:s})})}_onKeyDown(e){switch(e.key){case"ArrowDown":case"ArrowLeft":e.stopPropagation(),e.preventDefault(),this.viewModel.previous(),this._shouldFocusCurrentPhase=!0;break;case"ArrowUp":case"ArrowRight":e.stopPropagation(),e.preventDefault(),this.viewModel.next(),this._shouldFocusCurrentPhase=!0}}_onArrowLeftClick(){this.viewModel.previous()}_onArrowRightClick(){this.viewModel.next()}_onPhasesContainerAfterUpdate(){if(s(this._phasesContainer))return;const e=this._phasesContainer.querySelector(`.${Q.phaseCurrent}`);if(!s(e)){if(this._shouldScrollCurrentPhaseIntoView){const s=this._phasesContainer.offsetWidth,i=e.offsetLeft,t=e.offsetWidth;this._phasesContainer.scrollLeft=-s/2+i-t/2,this._shouldScrollCurrentPhaseIntoView=!1}this._shouldFocusCurrentPhase&&(e.focus(),this._shouldFocusCurrentPhase=!1)}}};e([o({type:L}),g(["viewModel.layers.length","viewModel.hasNext","viewModel.hasPrevious"])],X.prototype,"viewModel",void 0),e([o(),g()],X.prototype,"messages",void 0),e([n("viewModel.allowedValues"),g()],X.prototype,"_phases",void 0),e([o({readOnly:!0,dependsOn:["viewModel.enabled","viewModel.value"]}),g()],X.prototype,"_currentPhase",null),e([o()],X.prototype,"_phasesContainer",void 0),X=e([l("esri.widgets.BuildingExplorer.BuildingPhasePicker.BuildingPhasePicker")],X);var Y=X;const Z={levels:!0,phases:!0,disciplines:!0},ee="esri-building-explorer",se={esriWidget:"esri-widget",esriWidgetDisabled:"esri-widget--disabled",esriHeading:"esri-widget__heading",esriIconLoadingIndicator:"esri-icon-loading-indicator",esriRotating:"esri-rotating",widgetIcon:"esri-icon-organization",base:`${ee} esri-widget--panel`,panelError:`${ee}__panel--error`,loadingContainer:`${ee}__loading-container`,content:`${ee}__content`,section:`${ee}__section`,levels:`${ee}__levels`,phases:`${ee}__phases`,disciplines:`${ee}__disciplines`};let ie=class extends y{constructor(e,s){super(e,s),this._defaultViewModel=new b,this.viewModel=this._defaultViewModel,this.view=null,this.layers=null,this.visibleElements={...Z},this.iconClass=se.widgetIcon,this.label=void 0,this.messages=null,this.messagesCommon=null,this.toggleSiblingsVisibility=!1,this._handles=new h,this._levelPicker=new K,this._phasePicker=new Y,this._disciplinesTree=new I}initialize(){this._handles.add([c(this,"viewModel.level",(()=>{this._levelPicker.viewModel=this.viewModel.level})),c(this,"viewModel.phase",(()=>{this._phasePicker.viewModel=this.viewModel.phase})),c(this,"viewModel.disciplines",(()=>{this._disciplinesTree.viewModel=this.viewModel.disciplines})),c(this,"messages",(()=>{var e,s,i;this._levelPicker.messages=null==(e=this.messages)?void 0:e.level,this._phasePicker.messages=null==(s=this.messages)?void 0:s.phase,this._disciplinesTree.messages=null==(i=this.messages)?void 0:i.disciplines})),c(this,"toggleSiblingsVisibility",(()=>{this._disciplinesTree.toggleSiblingsVisibility=this.toggleSiblingsVisibility}))])}destroy(){this._handles.destroy(),this._levelPicker.destroy(),this._phasePicker.destroy(),this._disciplinesTree.destroy(),this.viewModel!==this._defaultViewModel&&this._defaultViewModel.destroy()}_castVisibleElements(e){return{...Z,...e}}render(){const e="disabled"===this.viewModel.state||!this.viewModel.isSupported;return _("div",{key:this,class:this.classes(se.esriWidget,se.base,{[se.esriWidgetDisabled]:e}),"aria-label":this.messages.widgetLabel},this._renderContent())}_renderContent(){if(!this.viewModel.isSupported)return _("p",{class:se.panelError},this.messages.unsupported);if(!this.viewModel.layers.length)return _("p",{class:se.panelError},this.messages.noData);switch(this.viewModel.state){case"loading":return this._renderLoadingIndicator();case"ready":return _("div",{key:"content",class:se.content},this._renderLevelPickerSection(),this._renderPhasePickerSection(),this._renderDisciplinesSection());case"failed":return _("p",{class:se.panelError},this.messages.failed);default:return null}}_renderLoadingIndicator(){return _("div",{key:"loading-container",role:"presentation",class:se.loadingContainer,"aria-label":this.messagesCommon.loading,title:this.messagesCommon.loading},_("span",{"aria-hidden":"true",class:this.classes(se.esriIconLoadingIndicator,se.esriRotating)}))}_renderLevelPickerSection(){const e=this.viewModel.level,s="ready"===e.state,i=e.allowedValues.length>1;return this.visibleElements.levels&&s&&i?_("div",{key:"levels",class:this.classes(se.section,se.levels)},_("h4",{class:se.esriHeading},this.messages.level.title),this._levelPicker.render()):[]}_renderPhasePickerSection(){const e=this.viewModel.phase,s="ready"===e.state,i=e.allowedValues.length>1;return this.visibleElements.phases&&s&&i?_("div",{key:"phases",class:this.classes(se.section,se.phases)},_("h4",{class:se.esriHeading},this.messages.phase.title),this._phasePicker.render()):[]}_renderDisciplinesSection(){const e=this.viewModel.disciplines,s="ready"===e.state,i=e.root.hasChildren;return this.visibleElements.disciplines&&s&&i?_("div",{key:"disciplines",class:this.classes(se.section,se.disciplines)},_("h4",{class:se.esriHeading},this.messages.disciplines.title),this._disciplinesTree.render()):[]}};e([o({type:b}),g(["state","level.state","phase.state","disciplines.state"])],ie.prototype,"viewModel",void 0),e([n("viewModel.view"),g()],ie.prototype,"view",void 0),e([n("viewModel.layers")],ie.prototype,"layers",void 0),e([o(),g()],ie.prototype,"visibleElements",void 0),e([a("visibleElements")],ie.prototype,"_castVisibleElements",null),e([o()],ie.prototype,"iconClass",void 0),e([n("messages.widgetLabel",{overridable:!0})],ie.prototype,"label",void 0),e([o(),g(),v("esri/widgets/BuildingExplorer/t9n/BuildingExplorer")],ie.prototype,"messages",void 0),e([o(),g(),v("esri/t9n/common")],ie.prototype,"messagesCommon",void 0),e([o({nonNullable:!0}),g()],ie.prototype,"toggleSiblingsVisibility",void 0),e([o(),g()],ie.prototype,"_levelPicker",void 0),e([o(),g()],ie.prototype,"_phasePicker",void 0),e([o(),g()],ie.prototype,"_disciplinesTree",void 0),ie=e([l("esri.widgets.BuildingExplorer")],ie);var te=ie;export default te;
