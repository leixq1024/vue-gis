/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
import{_ as e}from"../chunks/tslib.es6.js";import"../chunks/ArrayPool.js";import"../chunks/object.js";import"../chunks/deprecate.js";import"../core/lang.js";import"../config.js";import{L as t}from"../chunks/Logger.js";import"../chunks/string.js";import"../chunks/metadata.js";import{property as s}from"../core/accessorSupport/decorators/property.js";import"../core/Accessor.js";import"../chunks/PropertyOrigin.js";import"../core/scheduling.js";import{debounce as r,isAbortError as o,eachAlways as i}from"../core/promiseUtils.js";import"../chunks/Message.js";import"../core/Error.js";import"../chunks/ensureType.js";import{subclass as n}from"../core/accessorSupport/decorators/subclass.js";import{E as a}from"../chunks/Evented.js";import l from"../core/Collection.js";import{a as c}from"../chunks/Promise.js";import"../core/urlUtils.js";import{cast as d}from"../core/accessorSupport/decorators/cast.js";import"../chunks/jsonMap.js";import"../chunks/resourceExtension.js";import{o as h}from"../chunks/locale.js";import"../chunks/number.js";import{fetchMessageBundle as p}from"../intl.js";import"../kernel.js";import"../request.js";import"../chunks/assets.js";import m from"../core/Handles.js";import{init as u,whenOnce as _}from"../core/watchUtils.js";import{b as j}from"../chunks/domUtils.js";import{c as g}from"../chunks/widgetUtils.js";import{c as y}from"../chunks/projector.js";const f=t.getLogger("esri.widgets.Widget");let v=0;const k="esri-icon-checkbox-unchecked",w=y();let b=class extends(c(a.EventedAccessor)){constructor(e,t){super(e,t),this._attached=!1,this._internalHandles=new m,this._projector=w,this.domNode=null,this.iconClass=k,this.label=this.declaredClass.split(".").pop(),this.visible=!0,this._loadLocale=r((async()=>{this._messageBundleProps&&this._messageBundleProps.length&&await i(this._messageBundleProps.map((async({bundlePath:e,propertyName:t})=>{this[t]=await p(e)}))).then((e=>{for(const t of e)t.error&&f.error("widget-intl:locale-error",this.declaredClass,t.error)})),await this.loadLocale()}));const s="esri-widget-uid-"+Date.now().toString(16),o=this.render.bind(this);let n=!1;this.render=()=>{if(!n||this.destroyed)return null;const e=o();return e.properties?e.properties.key||(e.properties.key=s):e.properties={key:s},e},this.addResolvingPromise(this._resourcesFetch=this.beforeFirstRender().then((()=>{n=!0,this._postInitialize()})))}normalizeCtorArgs(e,t){const s={...e};return t&&(s.container=t),s}postInitialize(){}beforeFirstRender(){return this._loadLocale().catch((e=>{if(!o(e))throw e}))}async loadLocale(){}destroy(){this.destroyed||(this.viewModel&&(this.viewModel.destroy(),this.viewModel=null),this._detach(this.container),this._set("container",null),this._internalHandles.destroy(),this._emitter.clear(),this.render=()=>null,this._projector=null)}set container(e){this._get("container")||this._set("container",e)}castContainer(e){return j(e)}get id(){return this._get("id")||this.get("container.id")||Date.now().toString(16)+"-widget-"+v++}set id(e){e&&this._set("id",e)}get renderable(){return this._resourcesFetch}render(){throw new Error("not implemented")}scheduleRender(){this.destroyed||this._projector.scheduleRender()}classes(...e){return g.apply(this,e)}own(e){arguments.length>1&&(e=Array.prototype.slice.call(arguments)),this._internalHandles.add(e)}renderNow(){this._projector.renderNow()}_postInitialize(){var e,t;this.destroyed||(null!=(e=this._renderableProps)&&e.length&&this._internalHandles.add(this._renderableProps.map((e=>u(this,e,(function(t,s){if(l.isCollection(s)&&this._internalHandles.remove(`${this.declaredClass}:${e}-collection-change-event-listener`),l.isCollection(t)){const s=t.on("change",(()=>this.scheduleRender()));this._internalHandles.add(s,`${this.declaredClass}:${e}-collection-change-event-listener`)}this.scheduleRender()}))))),null!=(t=this._delegatedEventNames)&&t.length&&this._internalHandles.add(u(this,"viewModel",((e,t)=>{t&&this._internalHandles.remove("delegated-events"),e&&this._internalHandles.add(this._delegatedEventNames.map((t=>e.on(t,(e=>{this.emit(t,e)})))),"delegated-events")}))),this.postInitialize(),this._internalHandles.add(h((async()=>{await this._loadLocale().catch((e=>{if(!o(e))throw e})),this.scheduleRender()}))),this._internalHandles.add(_(this,"container",(async e=>{this.destroyed||this._attach(e)}))))}_attach(e){e&&(this._projector.merge(e,this.render),this._attached=!0)}_detach(e){e&&this._attached&&(this._projector.detach(this.render),e.parentNode&&e.parentNode.removeChild(e),this._attached=!1)}};e([s({value:null})],b.prototype,"container",null),e([d("container")],b.prototype,"castContainer",null),e([s({aliasOf:"container"})],b.prototype,"domNode",void 0),e([s()],b.prototype,"iconClass",void 0),e([s({dependsOn:["container"]})],b.prototype,"id",null),e([s()],b.prototype,"label",void 0),e([s()],b.prototype,"renderable",null),e([s()],b.prototype,"viewModel",void 0),e([s()],b.prototype,"visible",void 0),b=e([n("esri.widgets.Widget")],b);var C=b;export default C;
