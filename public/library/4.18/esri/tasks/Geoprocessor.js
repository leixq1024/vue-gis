// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.18/esri/copyright.txt for details.
//>>built
define("require ../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/has ../core/compilerUtils ../core/Logger ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/property ../core/jsonMap ../core/accessorSupport/decorators/subclass ../core/urlUtils ../core/uuid ../portal/support/resourceExtension ../core/promiseUtils ../geometry/SpatialReference ../geometry/Extent ../request ../geometry/support/normalizeUtils ../layers/support/Field ./support/FeatureSet ./Task ./support/GPMessage ../layers/support/MapImage ./support/DataFile ./support/JobInfo ./support/LinearUnit ./support/ParameterValue ./support/RasterData".split(" "),
function(H,I,m,k,J,U,V,q,W,K,X,Y,Z,v,A,L,r,M,B,x,N,O,C,y,w,D,P,E){k=function(F){function z(a){a=F.call(this,a)||this;a._timers=new Map;a.outSpatialReference=null;a.processExtent=null;a.processSpatialReference=null;a.returnFeatureCollection=!1;a.returnM=!1;a.returnZ=!1;return a}I._inheritsLoose(z,F);var f=z.prototype;f.destroy=function(){this._timers.forEach(a=>{clearInterval(a)})};f.cancelJob=function(a,d){const {path:b}=this.parsedUrl;d={...this.requestOptions,...d,query:{f:"json"}};this._clearTimer(a);
return r(`${b}/jobs/${a}/cancel`,d).then(c=>w.fromJSON(c.data))};f.checkJobStatus=function(a,d){const {path:b}=this.parsedUrl;return r(`${b}/jobs/${a}`,{...this.requestOptions,...d,query:{f:"json"}}).then(c=>w.fromJSON(c.data))};f.execute=function(a,d){return this._constructRequest("execute",a,d).then(b=>{const c=b.data.messages||[];return{results:(b.data.results||[]).map(this._decode),messages:c.map(e=>O.fromJSON(e))}})};f.getResultData=function(a,d,b){const {returnFeatureCollection:c,returnM:e,
returnZ:g,outSpatialReference:h,parsedUrl:n}=this,{path:l}=n,p=this._gpEncode({returnFeatureCollection:c||void 0,returnM:e||void 0,returnZ:g||void 0,outSR:h,returnType:"data",f:"json"},null);return r(`${l}/jobs/${a}/results/${d}`,{...this.requestOptions,...b,query:p}).then(t=>this._decode(t.data))};f.getResultImage=function(a,d,b,c){const {path:e}=this.parsedUrl;b={...b.toJSON(),f:"json"};b=this._gpEncode(b);return r(`${e}/jobs/${a}/results/${d}`,{...this.requestOptions,...c,query:b}).then(g=>this._decode(g.data))};
f.getResultMapImageLayer=async function(a){const {path:d}=this.parsedUrl,b=d.indexOf("/GPServer/");a=`${d.substring(0,b)}/MapServer/jobs/${a}`;return new (await new Promise(function(c,e){H(["../layers/MapImageLayer"],function(g){c(Object.freeze({__proto__:null,"default":g}))},e)})).default({url:a})};f.submitJob=function(a,d){return this._constructRequest("submitJob",a,d).then(b=>w.fromJSON(b.data))};f.waitForJobCompletion=function(a,d={}){const {interval:b=1E3,signal:c,statusCallback:e}=d;return v.create((g,
h)=>{v.onAbort(c,()=>{this._clearTimer(a);h(v.createAbortError())});this._clearTimer(a);const n=setInterval(()=>{this._timers.has(a)||h(v.createAbortError());this._getJobStatus(a,this.requestOptions).then(l=>{const {jobStatus:p}=l;switch(p){case "job-succeeded":this._clearTimer(a);g(l);break;case "job-submitted":case "job-executing":case "job-waiting":case "job-new":e&&e(l);break;case "job-cancelled":case "job-cancelling":case "job-deleted":case "job-deleting":case "job-timed-out":case "job-failed":this._clearTimer(a);
h(l);break;default:J.neverReached(p)}})},b);this._timers.set(a,n)})};f._clearTimer=function(a){this._timers.has(a)&&(clearInterval(this._timers.get(a)),this._timers.delete(a))};f._constructRequest=function(a,d,b){const c={},e={},g=[];this._collectGeometries(d,g,c);return M.normalizeCentralMeridian(g).then(h=>{const {outSpatialReference:n,parsedUrl:l,processExtent:p,processSpatialReference:t,returnFeatureCollection:Q,returnM:R,returnZ:S}=this,{path:T}=l;for(var u in c){const G=c[u];e[u]=h.slice(G[0],
G[1])}h=n?n.wkid||n:null;u=t?t.wkid||t:null;h=this._gpEncode({...p?{context:{extent:p,outSR:h,processSR:u}}:{"env:outSR":h,"env:processSR":u},...d,..."execute"===a?{returnFeatureCollection:Q||void 0,returnM:R||void 0,returnZ:S||void 0}:null,f:"json"},null,e);return r(`${T}/${a}`,{...this.requestOptions,...b,query:h})})};f._collectGeometries=function(a,d,b){for(const e in a){var c=a[e];c&&"object"===typeof c&&c instanceof x&&({features:c}=c,b[e]=[d.length,d.length+c.length],c.forEach(g=>{d.push(g.geometry)}))}};
f._decode=function(a){const d=a.dataType,b=P.fromJSON(a);switch(d){case "GPDate":b.value=new Date(b.value);break;case "GPDataFile":b.value=y.fromJSON(b.value);break;case "GPLinearUnit":b.value=D.fromJSON(b.value);break;case "GPFeatureRecordSetLayer":case "GPRecordSet":b.value=a.value.url?y.fromJSON(b.value):x.fromJSON(b.value);break;case "GPRasterData":case "GPRasterDataLayer":a=a.value.mapImage;b.value=a?C.fromJSON(a):E.fromJSON(b.value);break;case "GPField":b.value=B.fromJSON(b.value);break;case "GPMultiValue:GPDate":b.value=
b.value.map(c=>new Date(c));break;case "GPMultiValue:GPDataFile":b.value=b.value.map(c=>y.fromJSON(c));break;case "GPMultiValue:GPLinearUnit":b.value=b.value.map(c=>D.fromJSON(c));break;case "GPMultiValue:GPFeatureRecordSetLayer":case "GPMultiValue:GPRecordSet":b.value=b.value.map(c=>x.fromJSON(c));break;case "GPMultiValue:GPRasterData":case "GPMultiValue:GPRasterDataLayer":b.value=b.value.map(c=>c?C.fromJSON(c):E.fromJSON(b.value));break;case "GPMultiValue:GPField":b.value=b.value.map(c=>B.fromJSON(c))}return b};
f._gpEncode=function(a,d,b){for(const c in a){const e=a[c];Array.isArray(e)?a[c]=JSON.stringify(e.map(g=>this._gpEncode({item:g},!0).item,this)):e instanceof Date&&(a[c]=e.getTime())}return this._encode(a,d,b)};f._getJobStatus=function(a,d){const {path:b}=this.parsedUrl;return r(`${b}/jobs/${a}`,{...this.requestOptions,...d,query:{f:"json"}}).then(c=>w.fromJSON(c.data))};return z}(N);m.__decorate([q.property({type:A})],k.prototype,"outSpatialReference",void 0);m.__decorate([q.property({type:L})],
k.prototype,"processExtent",void 0);m.__decorate([q.property({type:A})],k.prototype,"processSpatialReference",void 0);m.__decorate([q.property({nonNullable:!0})],k.prototype,"returnFeatureCollection",void 0);m.__decorate([q.property({nonNullable:!0})],k.prototype,"returnM",void 0);m.__decorate([q.property({nonNullable:!0})],k.prototype,"returnZ",void 0);return k=m.__decorate([K.subclass("esri/tasks/Geoprocessor")],k)});