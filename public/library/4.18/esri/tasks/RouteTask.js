// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.18/esri/copyright.txt for details.
//>>built
define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/has ../core/Logger ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/property ../core/jsonMap ../core/accessorSupport/decorators/subclass ../core/urlUtils ../core/uuid ../portal/support/resourceExtension ../core/promiseUtils ../request ../geometry/support/normalizeUtils ./Task ../core/queryUtils ./mixins/NAServiceDescription ./support/RouteResultsContainer".split(" "),function(y,z,r,K,L,M,N,A,O,P,Q,B,C,D,E,
F,G,H){const I=F.createQueryParamsHelper({accumulateAttributes:{name:"accumulateAttributeNames"},attributeParameterValues:!0,directionsTimeAttribute:{name:"directionsTimeAttributeName"},impedanceAttribute:{name:"impedanceAttributeName"},outSpatialReference:{name:"outSR",getter:q=>q.outSpatialReference.wkid},pointBarriers:{name:"barriers"},polylineBarriers:!0,polygonBarriers:!0,restrictionAttributes:{name:"restrictionAttributeNames"},stops:!0,travelMode:!0});r=function(q){function t(a){return q.call(this,
a)||this}y._inheritsLoose(t,q);var u=t.prototype;u.solve=function(a,d){const b=[],k=[],g={},m={};a.stops&&a.stops.features&&this._collectGeometries(a.stops.features,k,"stops.features",g);a.pointBarriers&&a.pointBarriers.features&&this._collectGeometries(a.pointBarriers.features,k,"pointBarriers.features",g);a.polylineBarriers&&a.polylineBarriers.features&&this._collectGeometries(a.polylineBarriers.features,k,"polylineBarriers.features",g);a.polygonBarriers&&a.polygonBarriers.features&&this._collectGeometries(a.polygonBarriers.features,
k,"polygonBarriers.features",g);return D.normalizeCentralMeridian(k).then(e=>{for(const h in g){const l=g[h];b.push(h);m[h]=e.slice(l[0],l[1])}return this._isInputGeometryZAware(m,b)?this.getServiceDescription():B.resolve({dontCheck:!0})}).then(e=>{("dontCheck"in e?e.dontCheck:e.hasZ)||this._dropZValuesOffInputGeometry(m,b);for(const l in m)m[l].forEach((n,p)=>{a.get(l)[p].geometry=n});e={query:{...this.parsedUrl.query,f:"json",...I.toQueryParams(a)}};if(this.requestOptions||d)e={...this.requestOptions,
...d,...e};var {path:h}=this.parsedUrl;h=h.endsWith("/solve")?h:h+"/solve";return C(h,e)}).then(e=>this._handleSolveResponse(e))};u._collectGeometries=function(a,d,b,k){k[b]=[d.length,d.length+a.length];a.forEach(g=>{d.push(g.geometry)})};u._handleSolveResponse=function(a){const d=[],b=[],{directions:k=[],routes:{features:g=[],spatialReference:m=null}={},stops:{features:e=[],spatialReference:h=null}={},barriers:l,polygonBarriers:n,polylineBarriers:p,messages:J}=a.data;let v=!0,f,w;const x=g&&m||e&&
h||l&&l.spatialReference||n&&n.spatialReference||p&&p.spatialReference;k.forEach(c=>{d.push(f=c.routeName);b[f]={directions:c}});g.forEach(c=>{-1===d.indexOf(f=c.attributes.Name)&&(d.push(f),b[f]={});c.geometry&&(c.geometry.spatialReference=x);b[f].route=c});e.forEach(c=>{w=c.attributes;-1===d.indexOf(f=w.RouteName||"esri.tasks.RouteTask.NULL_ROUTE_NAME")&&(d.push(f),b[f]={});"esri.tasks.RouteTask.NULL_ROUTE_NAME"!==f&&(v=!1);c.geometry&&(c.geometry.spatialReference=x);null==b[f].stops&&(b[f].stops=
[]);b[f].stops.push(c)});0<e.length&&!0===v&&(b[d[0]].stops=b["esri.tasks.RouteTask.NULL_ROUTE_NAME"].stops,delete b["esri.tasks.RouteTask.NULL_ROUTE_NAME"],d.splice(d.indexOf("esri.tasks.RouteTask.NULL_ROUTE_NAME"),1));a=d.map(c=>{b[c].routeName="esri.tasks.RouteTask.NULL_ROUTE_NAME"===c?null:c;return b[c]});return H.fromJSON({routeResults:a,pointBarriers:l,polygonBarriers:n,polylineBarriers:p,messages:J})};return t}(G.NAServiceDescriptionMixin(E));return r=z.__decorate([A.subclass("esri.tasks.RouteTask")],
r)});