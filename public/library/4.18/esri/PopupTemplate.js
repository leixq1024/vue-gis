// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.18/esri/copyright.txt for details.
//>>built
define("./chunks/_rollupPluginBabelHelpers ./chunks/tslib.es6 ./core/has ./core/lang ./core/Logger ./core/accessorSupport/ensureType ./core/accessorSupport/decorators/property ./core/accessorSupport/decorators/cast ./core/jsonMap ./core/accessorSupport/decorators/reader ./core/accessorSupport/decorators/subclass ./core/accessorSupport/decorators/writer ./core/urlUtils ./core/uuid ./portal/support/resourceExtension ./core/promiseUtils ./core/JSONSupport ./core/Collection ./layers/support/fieldUtils ./popup/content/Content ./popup/content/AttachmentsContent ./popup/content/CustomContent ./popup/FieldInfo ./popup/content/FieldsContent ./popup/content/support/mediaInfoTypes ./popup/content/MediaContent ./popup/content/TextContent ./popup/content ./popup/ExpressionInfo ./popup/LayerOptions ./popup/RelatedRecordsInfo ./support/actions/ActionBase ./support/actions/ActionButton ./support/actions/ActionToggle".split(" "),
function(C,g,x,m,f,D,l,E,Y,F,G,n,Z,aa,ba,y,H,p,z,I,q,J,K,r,L,t,u,M,N,O,P,Q,R,S){var v;x=p.ofType({key:"type",defaultKeyValue:"button",base:Q,typeMap:{button:R,toggle:S}});const T={base:I,key:"type",typeMap:{media:t,custom:J,text:u,attachments:q,fields:r}},U=f.getLogger("esri.PopupTemplate"),V=["attachments","fields","media","text"];f=v=function(A){function w(){var a=A.apply(this,arguments)||this;a.actions=null;a.content="";a.expressionInfos=null;a.fieldInfos=null;a.layerOptions=null;a.lastEditInfoEnabled=
!0;a.outFields=null;a.overwriteActions=!1;a.returnGeometry=!1;a.title="";a.relatedRecordsInfo=null;return a}C._inheritsLoose(w,A);var d=w.prototype;d.castContent=function(a){if(Array.isArray(a))return a.map(b=>D.ensureOneOfType(T,b));if("string"===typeof a||"function"===typeof a||a instanceof HTMLElement||y.isPromiseLike(a))return a;U.error("content error","unsupported content value",{value:a});return null};d.readContent=function(a,b){({popupElements:a}=b);return Array.isArray(a)&&0<a.length?this._readPopupInfoElements(b):
this._readPopupInfo(b)};d.writeContent=function(a,b){"string"===typeof a?b.description=a:Array.isArray(a)&&(b.popupElements=a.filter(c=>-1!==V.indexOf(c.type)).map(c=>c&&c.toJSON()),b.popupElements.forEach(c=>{"attachments"===c.type?this._writeAttachmentContent(b):"media"===c.type?this._writeMediaContent(c,b):"text"===c.type&&this._writeTextContent(c,b)}))};d.writeFieldInfos=function(a,b){var {content:c}=this;c=Array.isArray(c)?c:null;if(a){const e=c?c.some(h=>"fields"===h.type&&(!h.fieldInfos||0===
h.fieldInfos.length)):!1;b.fieldInfos=a.filter(Boolean).map(h=>{h=h.toJSON();e||(h.visible=!1);return h})}if(c)for(const e of c)"fields"===e.type&&this._writeFieldsContent(e,b)};d.writeLayerOptions=function(a,b){b.layerOptions=!a||null===a.showNoDataRecords&&null===a.returnTopmostRaster?null:a.toJSON()};d.writeTitle=function(a,b){b.title=a||""};d.clone=function(){var {actions:a}=this;a=a?m.clone(a.toArray()):[];return new v({actions:a,content:Array.isArray(this.content)?m.clone(this.content):this.content,
expressionInfos:Array.isArray(this.expressionInfos)?m.clone(this.expressionInfos):null,fieldInfos:Array.isArray(this.fieldInfos)?m.clone(this.fieldInfos):null,layerOptions:this.layerOptions?m.clone(this.layerOptions):null,lastEditInfoEnabled:this.lastEditInfoEnabled,outFields:Array.isArray(this.outFields)?m.clone(this.outFields):null,overwriteActions:this.overwriteActions,returnGeometry:this.returnGeometry,title:this.title,relatedRecordsInfo:this.relatedRecordsInfo?m.clone(this.relatedRecordsInfo):
null})};d.collectRequiredFields=async function(a,b){await this._collectExpressionInfoFields(a,b,this.expressionInfos);z.collectFields(a,b,[...this.outFields||[],...this._getActionsFields(this.actions),...this._getTitleFields(this.title),...this._getContentFields(this.content)])};d.getRequiredFields=async function(a){const b=new Set;await this.collectRequiredFields(b,a);return[...b].sort()};d._writeFieldsContent=function(a,b){Array.isArray(a.fieldInfos)&&a.fieldInfos.length&&(a=m.clone(a.fieldInfos),
Array.isArray(b.fieldInfos)?a.forEach(c=>{const e=b.fieldInfos.find(h=>h.fieldName.toLowerCase()===c.fieldName.toLowerCase());e?e.visible=!0:b.fieldInfos.push(c)}):b.fieldInfos=a)};d._writeAttachmentContent=function(a){a.showAttachments||(a.showAttachments=!0)};d._writeTextContent=function(a,b){!b.description&&a.text&&(b.description=a.text)};d._writeMediaContent=function(a,b){Array.isArray(a.mediaInfos)&&a.mediaInfos.length&&(a=m.clone(a.mediaInfos),Array.isArray(b.mediaInfos)?b.mediaInfos=[...b.mediaInfos,
...a]:b.mediaInfos=a)};d._readPopupInfoElements=function({description:a,mediaInfos:b,popupElements:c}){var e=!1,h=!1;return c.map(k=>{if("media"===k.type)return k.mediaInfos||!b||h||(k.mediaInfos=b,h=!0),t.fromJSON(k);if("text"===k.type)return k.text||!a||e||(k.text=a,e=!0),u.fromJSON(k);if("attachments"===k.type)return q.fromJSON(k);if("fields"===k.type)return r.fromJSON(k)}).filter(Boolean)};d._readPopupInfo=function({description:a,mediaInfos:b,showAttachments:c}){const e=[];a?e.push(new u({text:a})):
e.push(new r);Array.isArray(b)&&b.length&&e.push(t.fromJSON({mediaInfos:b}));c&&e.push(q.fromJSON({displayType:"list"}));return e.length?e:a};d._getContentElementFields=function(a){if(!a||"attachments"===a.type)return[];if("custom"===a.type)return a.outFields||[];if("fields"===a.type)return this._getFieldInfoFields(a.fieldInfos||this.fieldInfos);if("media"===a.type)return(a.mediaInfos||[]).reduce((b,c)=>[...b,...this._getMediaInfoFields(c)],[]);if("text"===a.type)return this._extractFieldNames(a.text)};
d._getMediaInfoFields=function(a){const {caption:b,title:c,value:e}=a,{fields:h=[],normalizeField:k,tooltipField:B,sourceURL:W,linkURL:X}=e||{};a=[...this._extractFieldNames(c),...this._extractFieldNames(b),...this._extractFieldNames(W),...this._extractFieldNames(X),...h];k&&a.push(k);B&&a.push(B);return a};d._getContentFields=function(a){return"string"===typeof a?this._extractFieldNames(a):Array.isArray(a)?a.reduce((b,c)=>[...b,...this._getContentElementFields(c)],[]):[]};d._collectExpressionInfoFields=
async function(a,b,c){c&&await y.all(c.map(e=>z.collectArcadeFieldNames(a,b,e.expression)))};d._getFieldInfoFields=function(a){return a?a.filter(b=>"undefined"===typeof b.visible?!0:!!b.visible).map(b=>b.fieldName).filter(b=>-1===b.indexOf("relationships/")&&-1===b.indexOf("expression/")):[]};d._getActionsFields=function(a){return a?a.toArray().reduce((b,c)=>[...b,...this._getActionFields(c)],[]):[]};d._getActionFields=function(a){const {className:b,title:c,type:e}=a;a="button"===e||"toggle"===e?
a.image:"";return[...this._extractFieldNames(c),...this._extractFieldNames(b),...this._extractFieldNames(a)]};d._getTitleFields=function(a){return"string"===typeof a?this._extractFieldNames(a):[]};d._extractFieldNames=function(a){if(!a||"string"!==typeof a)return[];a=a.match(/{[^}]*}/g);if(!a)return[];const b=/\{(\w+):.+\}/;return(a=a.filter(c=>!(0===c.indexOf("{relationships/")||0===c.indexOf("{expression/"))).map(c=>c.replace(b,"{$1}")))?a.map(c=>c.slice(1,-1)):[]};return w}(H.JSONSupport);g.__decorate([l.property({type:x})],
f.prototype,"actions",void 0);g.__decorate([l.property()],f.prototype,"content",void 0);g.__decorate([E.cast("content")],f.prototype,"castContent",null);g.__decorate([F.reader("content",["description","popupElements","mediaInfos","showAttachments"])],f.prototype,"readContent",null);g.__decorate([n.writer("content",{popupElements:{type:p.ofType(M.persistableTypes)},showAttachments:{type:Boolean},mediaInfos:{type:p.ofType(L.types)},description:{type:String}})],f.prototype,"writeContent",null);g.__decorate([l.property({type:[N],
json:{write:!0}})],f.prototype,"expressionInfos",void 0);g.__decorate([l.property({type:[K]})],f.prototype,"fieldInfos",void 0);g.__decorate([n.writer("fieldInfos")],f.prototype,"writeFieldInfos",null);g.__decorate([l.property({type:O})],f.prototype,"layerOptions",void 0);g.__decorate([n.writer("layerOptions")],f.prototype,"writeLayerOptions",null);g.__decorate([l.property({type:Boolean,json:{read:{source:"showLastEditInfo"},write:{target:"showLastEditInfo"},default:!0}})],f.prototype,"lastEditInfoEnabled",
void 0);g.__decorate([l.property()],f.prototype,"outFields",void 0);g.__decorate([l.property()],f.prototype,"overwriteActions",void 0);g.__decorate([l.property()],f.prototype,"returnGeometry",void 0);g.__decorate([l.property({json:{type:String}})],f.prototype,"title",void 0);g.__decorate([n.writer("title")],f.prototype,"writeTitle",null);g.__decorate([l.property({type:P,json:{write:!0}})],f.prototype,"relatedRecordsInfo",void 0);return f=v=g.__decorate([G.subclass("esri.PopupTemplate")],f)});