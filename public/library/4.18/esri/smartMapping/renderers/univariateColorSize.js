// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.18/esri/copyright.txt for details.
//>>built
define("exports ../../core/maybe ../../core/Error ../../symbols/support/Symbol3DMaterial ../../renderers/support/AuthoringInfo ../../renderers/visualVariables/support/SizeStop ../../renderers/support/ClassBreakInfo ../../symbols/support/cimSymbolUtils ../support/utils ../support/adapters/support/layerUtils ./support/utils ./color ./size ../symbology/support/aboveAndBelowUtils".split(" "),function(t,w,m,F,G,p,x,H,y,u,v,I,z,J){async function K(a){var b,c;if(!(a&&a.layer&&(a.field||a.valueExpression||
a.sqlExpression)))throw new m("univariate-colorsize-visual-variables:missing-parameters","'layer' and 'field', 'valueExpression' or 'sqlExpression' parameters are required");if(a.valueExpression&&!a.sqlExpression&&!a.view)throw new m("univariate-colorsize-visual-variables:missing-parameters","View is required when 'valueExpression' is specified");if("above-and-below"===a.theme&&null!=(b=a.sizeOptions)&&b.sizeOptimizationEnabled)throw new m("univariate-colorsize-visual-variables:invalid-parameters",
"sizeOptimizationEnabled cannot be true for 'above-and-below' theme");a={...a};const e=[0,2,1,3];b=u.createLayerAdapter(a.layer,e);a.layer=b;a.theme=a.theme||null!=(c=a.colorOptions)&&c.theme?a.theme:"high-to-low";if("90-10"===a.theme)throw new m("univariate-colorsize-visual-variables:not-supported","Only 'high-to-low', 'above-and-below', 'above', 'below' themes are supported.");if(!b)throw new m("univariate-colorsize-visual-variables:invalid-parameters","'layer' must be one of these types: "+u.getLayerTypeLabels(e).join(", "));
c=w.isSome(a.signal)?{signal:a.signal}:null;await b.load(c);c=await y.getFieldsList({field:a.field,normalizationField:a.normalizationField,valueExpression:a.valueExpression});if(c=v.verifyBasicFieldValidity(b,c,"univariate-colorsize-visual-variables:invalid-parameters"))throw c;return a}function L(a,b){var c;a={...a};const {sizeOptions:e,theme:h}=a,d=a.legendOptions||(null==(c=a.sizeOptions)?void 0:c.legendOptions);delete a.sizeOptions;delete a.colorOptions;return{...a,...e,statistics:b||a.statistics,
theme:"above-and-below"===h?null:h,legendOptions:d}}function M(a,b){var c;a={...a};const e=a.colorOptions,h=a.theme||(null==e?void 0:e.theme),d=a.legendOptions||(null==(c=a.colorOptions)?void 0:c.legendOptions);delete a.sizeOptions;delete a.colorOptions;return{...a,...e,statistics:b||a.statistics,theme:h,legendOptions:d}}async function N(a){var b;if(!(a&&a.layer&&(a.field||a.valueExpression||a.sqlExpression)))throw new m("univariate-colorsize-continuous-renderer:missing-parameters","'layer' and 'field', 'valueExpression' or 'sqlExpression' parameters are required");
if(a.valueExpression&&!a.sqlExpression&&!a.view)throw new m("univariate-colorsize-continuous-renderer:missing-parameters","View is required when 'valueExpression' is specified");a={...a};a.symbolType=a.symbolType||"2d";a.colorOptions||(a.colorOptions={});a.colorOptions.isContinuous=null!=(b=a.colorOptions.isContinuous)?b:!1;var c=[0,2,1,3];b=u.createLayerAdapter(a.layer,c);a.layer=b;if(!b)throw new m("univariate-colorsize-continuous-renderer:invalid-parameters","'layer' must be one of these types: "+
u.getLayerTypeLabels(c).join(", "));c=w.isSome(a.signal)?{signal:a.signal}:null;await b.load(c);if("above-and-below"===a.theme&&a.symbolOptions){if(-1<a.symbolType.indexOf("3d-volumetric"))throw new m("univariate-colorsize-continuous-renderer:invalid-parameters","'symbolOptions' is applicable for '2d' and '3d-flat' 'symbolType' only");if("point"!==b.geometryType&&"polygon"!==b.geometryType)throw new m("univariate-colorsize-continuous-renderer:invalid-parameters","'symbolOptions' only apply to layers with 'point' or 'polygon' geometryType");
}c=await y.getFieldsList({field:a.field,normalizationField:a.normalizationField,valueExpression:a.valueExpression});if(b=v.verifyBasicFieldValidity(b,c,"univariate-colorsize-continuous-renderer:invalid-parameters"))throw b;return a}function O(a){a={...a};const b={...a.sizeOptions};delete a.sizeOptions;delete a.colorOptions;delete b.sizeOptimizationEnabled;return{...a,...b}}function A(a,b){"type"in a&&"cim"===a.type?H.applyCIMSymbolColor(a,b):"type"in a&&-1<a.type.indexOf("3d")?a.symbolLayers.forEach(c=>
{"material"in c&&"color"in c.material&&(c.material?c.material.color=b:c.material=new F["default"]({color:b}))}):"color"in a&&(a.color=b)}function B(a,b,c=!0){var e;const h=null==b?void 0:null==(e=b.authoringInfo)?void 0:e.clone();e=b.size.visualVariables.map(d=>d.clone());c?e.push(b.color.visualVariable.clone()):h.visualVariables=h.visualVariables.filter(d=>"size"===d.type);e.push(...a.visualVariables.filter(d=>"target"in d&&"outline"===d.target).map(d=>d.clone()));a.authoringInfo=h;a.visualVariables=
e}function P(a,b){const c=a[0];a=a[1];const e=Math.round((a-c)/2)+c;return[new p({value:b[0],size:a}),new p({value:b[1],size:e}),new p({value:b[2],size:c}),new p({value:b[3],size:e}),new p({value:b[4],size:a})]}function Q(a,b,c,e){a=a.filter(g=>"width-and-depth"!==g.axis&&!g.target)[0];const h="number"===typeof(null==a?void 0:a.minSize)?null==a?void 0:a.minSize:null,d="number"===typeof(null==a?void 0:a.maxSize)?null==a?void 0:a.maxSize:null;if(null!=(null==a?void 0:a.minDataValue)&&null!=h&&null!=
d)if(e)if("above-and-below"===e){a.minDataValue=null;a.maxDataValue=null;a.minSize=null;a.maxSize=null;const g=v.createStopValuesForAboveBelow(c);a.stops=P([h,d],g);b.stops.forEach((k,l)=>k.value=g[l])}else{const {minDataValue:g,maxDataValue:k}=a,l=v.createDefaultStopValues(g,k,5);b.stops.forEach((f,n)=>f.value=l[n]);a.minDataValue=l[0];a.maxDataValue=l[l.length-1]}else a.minDataValue=b.stops[0].value,a.maxDataValue=b.stops[b.stops.length-1].value}async function C(a){var b=await K(a),c=await I.createVisualVariable(M(b));
const {visualVariable:e,statistics:h}=c;var d=await z.createVisualVariables(L(b,h)),g=d.visualVariables;Q(g,e,h,b.theme);a=d.basemapId;var k=d.basemapTheme,l=c.defaultValuesUsed,f={visualVariable:e,colorScheme:c.colorScheme};g={visualVariables:g,sizeScheme:d.sizeScheme};{const {theme:n,minValue:q,maxValue:r}=b;b=c.authoringInfo.visualVariables[0].clone();d=d.authoringInfo.visualVariables[0].clone();const {min:R,max:S}=c.statistics;"above-and-below"===n&&(c=c.visualVariable.stops,b.minSliderValue=
d.minSliderValue=null!=q?q:c[0].value,b.maxSliderValue=d.maxSliderValue=null!=r?r:c[c.length-1].value,d.theme="above-and-below");c=new G({type:"univariate-color-size",univariateTheme:n,statistics:"above-and-below"===n?{min:R,max:S}:null,visualVariables:[b,d]})}return{basemapId:a,basemapTheme:k,statistics:h,defaultValuesUsed:l,color:f,size:g,authoringInfo:c}}async function D(a){var b;a=await N(a);const {renderer:c,statistics:e,defaultValuesUsed:h}=await z.createContinuousRenderer(O(a));var d={...a};
var g=d.symbolType,k=-1<g.indexOf("3d-volumetric");delete d.symbolType;delete d.defaultSymbolEnabled;if(d.worldScale=k)d.sizeOptions={...d.sizeOptions},d.sizeOptions.axis="3d-volumetric-uniform"===g?"all":"height";d.statistics=e;d=await C(d);if("above-and-below"===a.theme){var l,f=a.symbolOptions,n=a.layer;g=null!=f&&f.symbols?"custom":null==f?void 0:f.symbolStyle;k=null==(l=a.colorOptions)?void 0:l.isContinuous;B(c,d,k);if(g||!k){({stops:l}=d.size.visualVariables[0]);n=n.geometryType;!(null!=f&&
f.symbolStyle||null!=f&&f.symbols)||"point"!==n&&"polygon"!==n?(f=c.classBreakInfos[0].symbol,f={above:f.clone(),below:f.clone()}):f=f.symbols||J.getAboveAndBelowSymbols(f.symbolStyle);const {above:q,below:r}=f;k||(k=d.color.colorScheme.colors,f=k[0],A(q,k[k.length-1]),A(r,f));c.classBreakInfos=[new x({minValue:-E,maxValue:l[2].value,symbol:r}),new x({minValue:l[2].value,maxValue:E,symbol:q})];g&&(c.authoringInfo.univariateSymbolStyle=g)}}else B(c,d);return{renderer:c,statistics:e,defaultValuesUsed:h,
color:null!=(b=a.colorOptions)&&b.isContinuous||"above-and-below"!==a.theme?d.color:null,size:d.size,basemapId:d.basemapId,basemapTheme:d.basemapTheme}}const E=Math.pow(2,53)-1;t.createContinuousRenderer=async function(a){return D(a)};t.createRenderer=D;t.createVisualVariables=C;Object.defineProperty(t,"__esModule",{value:!0})});