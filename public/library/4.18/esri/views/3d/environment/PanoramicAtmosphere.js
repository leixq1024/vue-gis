// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.18/esri/copyright.txt for details.
//>>built
define("../../../chunks/_rollupPluginBabelHelpers ../../../core/Logger ../../../core/promiseUtils ../../../chunks/mat4 ../../../chunks/mat4f64 ../../../support/requestImageUtils ../webgl-engine/lib/DefaultVertexAttributeLocations ./SimpleAtmosphereTechnique ./resources/SimpleAtmosphereTexture ../support/buffer/glUtil ../support/buffer/InterleavedLayout ../webgl-engine/core/shaderLibrary/util/View.glsl ../webgl-engine/lib/Util ../webgl-engine/lib/GeometryUtil ../../webgl/BufferObject ../../webgl/Texture ../../webgl/Util ../../webgl/VertexArrayObject".split(" "),
function(t,h,k,u,v,w,x,n,y,z,A,B,p,C,D,E,F,G){const H=h.getLogger("esri.views.3d.environment.PanoramicAtmosphere");h=function(){function l(c,b){this.slot=14;this._readyResolver=k.createResolver();this._readyController=k.createAbortController();this.view=c;this._techniqueRepository=b;this._atmosphereTechniqueConfig=new n.SimpleAtmosphereTechniqueConfiguration}var e=l.prototype;e.destroy=function(){this._readyResolver.reject();this._texture&&(this._texture.dispose(),this._texture=null);this._readyController&&
(this._readyController.abort(),this._readyController=null)};e.when=function(){return this._readyResolver.promise};e.initializeRenderContext=function(c){const b=c.rctx;this._atmosphereTechniqueConfig.geometry=1;this._atmosphereTechnique=this._techniqueRepository.acquireAndReleaseExisting(n.SimpleAtmosphereTechnique,this._atmosphereTechniqueConfig,this._atmosphereTechnique);this._vao=this._createVertexArrayObject(b);this._vaoCount=F.vertexCount(this._vao,"geometry");w.requestImage(y,{signal:this._readyController.signal}).then(a=>
{this._texture=new E(c.rctx,{pixelFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9729,flipped:!0},a);c.requestRender();this._readyController=null;this._readyResolver.resolve()}).catch(a=>{k.isAbortError(a)||H.error("Unable to initialize atmosphere: image request failed",a);this._readyResolver.reject()})};e.uninitializeRenderContext=function(){this.destroy()};e.render=function(c){if(c.slot!==this.slot||0!==c.pass)return!1;const b=c.rctx,a=this._atmosphereTechnique.program;b.bindProgram(a);this._atmosphereTechnique.bindPipelineState(b);
b.bindTexture(this._texture,0);a.setUniform1i("tex",0);B.View.bindProjectionMatrix(a,c.camera.projectionMatrix);var d=q;u.copy(d,c.camera.viewMatrix);d[12]=0;d[13]=0;d[14]=0;d[15]=1;a.setUniformMatrix4fv("view",q);a.setUniform4f("color",1,1,1,1);c.scenelightingData.setLightDirectionUniform(a);b.bindVAO(this._vao);a.assertCompatibleVertexAttributeLocations(this._vao);b.drawArrays(4,0,this._vaoCount);return!0};e._createVertexArrayObject=function(c){var b=C.createPolySphereGeometry(1,2,!1);const a=b.indices[p.VertexAttrConstants.POSITION];
for(var d=0;d<a.length;d+=3){var g=a[d];a[d]=a[d+2];a[d+2]=g}b=b.vertexAttributes[p.VertexAttrConstants.POSITION].data;d=r.createBuffer(a.length);g=d.position;for(let f=0;f<a.length;++f){const m=3*a[f];g.set(f,0,b[m]);g.set(f,1,b[m+1]);g.set(f,2,b[m+2])}return new G(c,x.Default3D,{geometry:z.glLayout(r)},{geometry:D.createVertex(c,35044,d.buffer)})};t._createClass(l,[{key:"canRender",get:function(){return null!=this._texture}}]);return l}();const q=v.create(),r=A.newLayout().vec3f("position");return h});