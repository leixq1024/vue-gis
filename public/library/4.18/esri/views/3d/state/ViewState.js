// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.18/esri/copyright.txt for details.
//>>built
define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/has ../../../core/maybe ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/property ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../core/urlUtils ../../../core/uuid ../../../portal/support/resourceExtension ../../../core/accessorSupport/watch ../../../core/Accessor ../../../core/Evented ../../../chunks/vec3f64 ../../../geometry/projectionEllipsoid ../../ViewAnimation ./Constraints ../webgl-engine/lib/Camera ./controllers/CameraController ./controllers/AnimationController ../support/PropertiesPool".split(" "),
function(n,c,d,u,E,F,f,G,v,H,I,J,w,x,y,k,z,A,B,g,l,C,p){d=function(q){function m(){var a=q.call(this)||this;a._propertiesPool=new p.PropertiesPool({camera:g},n._assertThisInitialized(a));a._lastSeenCameraProjectionValues=new g;a.events=new y;a.mode=1;a._cameraChanged=!1;a.updateQueue=[];a.processingUpdates=!1;return a}n._inheritsLoose(m,q);var h=m.prototype;h.exit=function(){this.cameraController=null;this._propertiesPool.destroy();this._propertiesPool=new p.PropertiesPool({camera:g},this)};h.init=
function(a,b){this._set("mode",a);this._set("spatialReference",b);1===this.mode?(a=z.getReferenceEllipsoid(b).radius,a=new g(k.fromValues(4*a,0,0),k.fromValues(a,0,0),k.fromValues(0,0,1))):a=new g(k.fromValues(0,0,100),k.fromValues(0,0,0),k.fromValues(0,1,0));this.camera=a;this._set("constraints",new B["default"]({mode:this.mode}))};h.switchCameraController=function(a){this.cameraController=a;return a.state!==l.State.Rejected};h.stopActiveCameraController=function(){return this.cameraController&&
!this.cameraController.stopController()?!1:!0};h.updateCamera=function(a){this.updateQueue.push(a);this.processUpdateQueue()};h.processUpdateQueue=function(){if(0!==this.updateQueue.length&&!this.processingUpdates){this.processingUpdates=!0;var a=this.updateQueue.shift();e.copyFrom(this._get("camera"));a(e);this.camera=e;this.processingUpdates=!1;this.processUpdateQueue()}};h.cameraProjectionChanged=function(a,b){return a.fov!==b.fov||a.fullViewport[0]!==b.fullViewport[0]||a.fullViewport[1]!==b.fullViewport[1]||
a.fullViewport[2]!==b.fullViewport[2]||a.fullViewport[3]!==b.fullViewport[3]||a.padding[0]!==b.padding[0]||a.padding[1]!==b.padding[1]||a.padding[2]!==b.padding[2]||a.padding[3]!==b.padding[3]?!0:!1};n._createClass(m,[{key:"animation",get:function(){return this.cameraController instanceof C.AnimationController&&u.isSome(this.cameraController.viewAnimation)?this.cameraController.viewAnimation:null}},{key:"camera",get:function(){return this._get("camera")},set:function(a){a!==e&&e.copyFrom(a);e.markViewDirty();
e.computeUp(this.mode);r.camera=e;this.events.emit("before-camera-change",r);a=this._get("camera");this.cameraProjectionChanged(this._lastSeenCameraProjectionValues,e)&&(this._lastSeenCameraProjectionValues.copyFrom(e),t.camera=this._lastSeenCameraProjectionValues,this.events.emit("camera-projection-changed",t));if(!a||!a.equals(e))if(this._set("camera",this._propertiesPool.get("camera").copyFrom(e)),this._cameraChanged=!a||!a.almostEquals(e)){const b=w.afterDispatch(()=>{this._cameraChanged=!1;b.remove()})
}}},{key:"isGlobal",get:function(){return!this.isLocal}},{key:"isLocal",get:function(){return 2===this.mode}},{key:"navigating",get:function(){return!(!this.cameraController||!this.cameraController.isInteractive)}},{key:"stationary",get:function(){return!this._cameraChanged&&!this.navigating}},{key:"cameraController",get:function(){return this._get("cameraController")},set:function(a){this.stopActiveCameraController()?(a&&(a.watch("state",b=>{if(b===l.State.Finished||b===l.State.Stopped)this._set("cameraController",
null),this.updateCamera(D=>a.onControllerEnd(D))},!0),a.onControllerStart(this.camera)),this._set("cameraController",a)):a&&(a.state=l.State.Rejected)}}]);return m}(x);c.__decorate([f.property({readOnly:!0,type:A,dependsOn:["cameraController"]})],d.prototype,"animation",null);c.__decorate([f.property({type:g})],d.prototype,"camera",null);c.__decorate([f.property({readOnly:!0})],d.prototype,"constraints",void 0);c.__decorate([f.property({readOnly:!0})],d.prototype,"events",void 0);c.__decorate([f.property({readOnly:!0,
dependsOn:["isLocal"]})],d.prototype,"isGlobal",null);c.__decorate([f.property({readOnly:!0,dependsOn:["mode"]})],d.prototype,"isLocal",null);c.__decorate([f.property({readOnly:!0})],d.prototype,"mode",void 0);c.__decorate([f.property({constructOnly:!0})],d.prototype,"spatialReference",void 0);c.__decorate([f.property({readOnly:!0,dependsOn:["cameraController"]})],d.prototype,"navigating",null);c.__decorate([f.property({readOnly:!0,dependsOn:["navigating","_cameraChanged"]})],d.prototype,"stationary",
null);c.__decorate([f.property()],d.prototype,"_cameraChanged",void 0);c.__decorate([f.property()],d.prototype,"cameraController",null);c=d=c.__decorate([v.subclass("esri.views.3d.state.ViewState")],d);const e=new g,r={camera:null},t={camera:null};return c});