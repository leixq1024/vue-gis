// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.18/esri/copyright.txt for details.
//>>built
define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/has ../../../core/maybe ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/property ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../core/urlUtils ../../../core/uuid ../../../portal/support/resourceExtension ../../../core/Accessor ../../../chunks/vec3f64 ../../../chunks/vec3 ./lighting/Lightsources ./lib/GeometryRecord ./lib/AutoDisposable ./parts/Model ./parts/RenderView".split(" "),
function(e,q,f,D,x,E,F,g,G,y,H,I,J,z,n,r,p,A,t,B,C){function u(h){return"function"===typeof h.addParentStage&&"function"===typeof h.removeParentStage}var k;e.Stage=k=function(h){function l(a){a=h.call(this,a)||this;a.model=new B.Model;a._viewContent=[];a._mainLightDirection=n.fromValues(0,1,0);return a}q._inheritsLoose(l,h);var c=l.prototype;c.initialize=function(){this._set("renderView",new C.RenderView(this));this.setLighting({lights:[new p.MainLight(n.fromValues(.7,.7,.7)),new p.AmbientLight(n.fromValues(.3,
.3,.3))],groundLightingFactor:.5,globalFactor:.5})};c.destroy=function(){A.pool.prune(0);this.dispose()};c.setLighting=function(a){r.set(this._mainLightDirection,0,0,0);for(const b of a.lights)if(b instanceof p.MainLight){r.negate(this._mainLightDirection,b.direction);break}this._lighting=a;this.renderView.setNeedsRender()};c.stopAnimationsAtTime=function(a){this.getAll(3).forEach(b=>{x.applySome(b.animation,d=>d.stopAtTime(a))});this.renderView.setNeedsRender()};c.add=function(a,b){this.model.add(a,
b);u(b)&&b.addParentStage(this);this.renderView.setNeedsRender()};c.remove=function(a,b){this.renderView.setNeedsRender();a=this.model.remove(a,b);u(a)&&a.removeParentStage(this);return a};c.notifyDirty=function(a,b,d){this.destroyed||(this.model.notifyDirty(a,b,d),this.renderView.setNeedsRender())};c.processDirty=function(){const a=this.model.getDirtySet();if(a.hasDirtyGeometryRecords()){k.DebugSettings.logDirtySet&&console.log("Dirty set: "+this.model.getDirtySet().formatDebugInfo());var b=a.commitLayers(this._viewContent);
0<b[0].length+b[1].length+b[2].length&&this.renderView.modify(b[0],b[1],b[2]);k.DebugSettings.logDirtySet&&(console.log("RGs add: "+b[0].map(d=>d.uniqueName)),console.log("RGs remove: "+b[1].map(d=>d.uniqueName)));a.commit();this.renderView.setNeedsRender()}};c.processDirtyLayer=function(a){a=this.model.getDirtySet().commitLayers([a]);0<a[0].length+a[1].length+a[2].length&&this.renderView.modify(a[0],a[1],a[2]);this.renderView.setNeedsRender()};c.getContent=function(a,b){return this.model.get(a,b)};
c.getAll=function(a){return this.model.getAll(a)};c.getCount=function(a){return this.model.getAll(a).size};c.getCamera=function(){return this.renderView.getCamera()};c.setCamera=function(a){this.renderView.setCamera(a)};c.getLayers=function(){return this.model.getAll(0)};c.getViewContent=function(){return this._viewContent.slice(0)};c.addToViewContent=function(a){const b=[];for(let d=0;d<a.length;d++)-1===this._viewContent.indexOf(a[d])&&b.push(a[d]);0<a.length&&(this.processDirty(),a=this.model.getDirtySet().getResidentRenderGeometriesFilteredByLayers(b),
this.renderView.modify(a,[],[]),this._viewContent.push.apply(this._viewContent,b))};c.removeFromViewContent=function(a){this.processDirty();const b=this.model.getDirtySet(),d=this._viewContent,v=[];for(let m=0;m<a.length;m++){const w=d.indexOf(a[m]);-1<w&&(d[w]=d[d.length-1],d.pop(),v.push(a[m]))}a=b.getResidentRenderGeometriesFilteredByLayers(v);this.renderView.modify([],a,[])};c.addRenderPlugin=function(a,b){"intersect"in b&&this.sceneIntersectionHelper.addIntersectionHandler(b);this.renderView.renderPlugins.add(a,
b)};c.removeRenderPlugin=function(a){"intersect"in a&&this.sceneIntersectionHelper.removeIntersectionHandler(a);this.renderView.renderPlugins.remove(a)};q._createClass(l,[{key:"dirty",get:function(){return this.model.getDirtySet().hasDirtyGeometryRecords()}},{key:"mainLightDirection",get:function(){return this._mainLightDirection}},{key:"lighting",get:function(){return this._lighting}},{key:"performanceInfo",get:function(){return{renderView:this.renderView.performanceInfo,model:this.model.getStats()}}}]);
return l}(t.AutoDisposableMixin(z));e.Stage.DebugSettings={endFrameContentValidation:!1,logDirtySet:!1};f.__decorate([g.property({constructOnly:!0})],e.Stage.prototype,"scheduler",void 0);f.__decorate([g.property({constructOnly:!0})],e.Stage.prototype,"options",void 0);f.__decorate([g.property({constructOnly:!0})],e.Stage.prototype,"sceneIntersectionHelper",void 0);f.__decorate([g.property({constructOnly:!0})],e.Stage.prototype,"viewingMode",void 0);f.__decorate([g.property({constructOnly:!0})],e.Stage.prototype,
"container",void 0);f.__decorate([t.autoDispose(),g.property()],e.Stage.prototype,"renderView",void 0);e.Stage=k=f.__decorate([y.subclass("esri.views.3d.webgl-engine.Stage")],e.Stage);Object.defineProperty(e,"__esModule",{value:!0})});