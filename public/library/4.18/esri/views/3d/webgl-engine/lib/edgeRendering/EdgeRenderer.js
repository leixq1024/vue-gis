// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.18/esri/copyright.txt for details.
//>>built
define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/maybe ../../../../../core/PooledArray ../../../../../core/mathUtils ../../../../../chunks/vec3f64 ../../../../../chunks/vec3 ../../../../../chunks/mat3 ../../../../../chunks/mat3f32 ../../core/shaderLibrary/Slice.glsl ../../core/shaderLibrary/util/DoublePrecision.glsl ../../core/shaderLibrary/attributes/VertexPosition.glsl ../../collections/Component/Material/ComponentTechnique ../../core/util/TwoVectorPosition ./EdgeShaderTechnique".split(" "),
function(g,u,v,h,w,x,m,k,y,q,z,A,B,C,n){const D={type:"uber",slicePlaneEnabled:!1,sliceHighlightDisabled:!1,strokesTexture:null,legacy:!0};let E=function(){function e(){this._value=0}var d=e.prototype;d.increment=function(){this._value++};d.decrement=function(){this._value--};u._createClass(e,[{key:"value",get:function(){return this._value}}]);return e}();const F={solid:0,sketch:1,uber:2};let H=function(){function e(b,a,c){this.rctx=b;this.shaderTechniqueRepository=a;this.config=new n.EdgeShaderTechnique.Configuration;
this.technique=null;this.refCount=new E;this.renderables=new Set;this.sortedRenderables={[1]:{[1]:new h,[2]:new h},[2]:{[1]:new h,[2]:new h}};this.renderablesDirty=!1;this.settings={...D,...c};this.key=e.getKey(this.settings.type,this.settings.slicePlaneEnabled,this.settings.legacy);this.writerSettings={variants:this.settings.strokesTexture.variants};this.config.legacy=this.settings.legacy;this.config.mode=F[this.settings.type];this.config.silhouette=!1;this.config.antialiasing=!!this.rctx.capabilities.blendMinMax;
this.config.slicePlaneEnabled=this.settings.slicePlaneEnabled;this.config.doublePrecisionRequiresObfuscation=z.doublePrecisionRequiresObfuscation(b)}var d=e.prototype;d.dispose=function(){this.technique&&(this.shaderTechniqueRepository.release(this.technique),this.technique=null)};d.addRenderable=function(b){this.renderables.add(b);this.renderablesDirty=!0};d.removeRenderable=function(b){this.renderables.delete(b);this.renderablesDirty=!0};d.setRenderablesDirty=function(){this.renderablesDirty=!0};
d.forEachRenderable=function(b,a){this.renderablesDirty&&this.sortRenderables();this.sortedRenderables[a][1].forAll(b);this.sortedRenderables[a][2].forAll(b)};d.bindRegularEdges=function(b,a){this.config.silhouette=!1;this.technique=this.shaderTechniqueRepository.acquireAndReleaseExisting(n.EdgeShaderTechnique,this.config,this.technique);this.technique.bindPass(this.rctx,{bindParameters:b,edgeRenderParameters:a});this.rctx.setPipelineState(this.technique.pipeline);this.rctx.bindProgram(this.technique.program)};
d.bindSilhouetteEdges=function(b,a){this.config.silhouette=!0;this.technique=this.shaderTechniqueRepository.acquireAndReleaseExisting(n.EdgeShaderTechnique,this.config,this.technique);this.technique.bindPass(this.rctx,{bindParameters:b,edgeRenderParameters:a});this.rctx.setPipelineState(this.technique.pipeline);this.rctx.bindProgram(this.technique.program)};d.renderRegularEdges=function(b,a,c){this.render(this.technique.program,b,b.regular.vao,a,c)};d.renderSilhouetteEdges=function(b,a,c){this.render(this.technique.program,
b,b.silhouette.vao,a,c)};d.render=function(b,a,c,l,p){this.setUniforms(b,a,l);this.rctx.bindVAO(c);this.rctx.capabilities.instancing.drawArraysInstanced(6,0,4,p)};d.setUniforms=function(b,a,c){a.components.buffer.textureBuffer.bind(b,r);if("origin"in a.transform)b.setUniformMatrix4fv("uView",c.localViewMatrixForEdges),b.setUniformMatrix4fv("uModel",a.transform.modelMatrix),q.Slice.bindUniforms(b,this.settings,c.slicePlane,a.transform.origin.vec3);else{const l=new C.TwoVectorPosition(a.transform.position),
p=k.transpose(t,k.invert(t,a.transform.rotationScale)),f=new B.ComponentDrawParameters;m.copy(f.worldFromModel_TL,l.low);m.copy(f.worldFromModel_TH,l.high);k.copy(f.worldFromModel_RS,a.transform.rotationScale);k.copy(f.transformNormal_GlobalFromModel,p);A.VertexPosition.bindModelTransform(b,f);b.setUniformMatrix3fv("uTransformNormal_GlobalFromModel",f.transformNormal_GlobalFromModel);a=c.camera.viewInverseTransposeMatrix;a=m.set(G,a[3],a[7],a[11]);q.Slice.bindUniforms(b,this.settings,c.slicePlane,
a)}"uber"!==this.settings.type&&"sketch"!==this.settings.type||this.setSketchUniforms(b);b.setUniform1f("uWorldLineRadiusPerDistance",Math.tan(c.camera.fovY/2)/(c.camera.fullViewport[3]/2))};d.setSketchUniforms=function(b){const a=this.settings.strokesTexture,c=a.texture;v.isNone(c)||(this.rctx.bindTexture(c,0),b.setUniform1i("uStrokesTexture",0),b.setUniform2f("uStrokesTextureScale",1/c.descriptor.width,1/c.descriptor.height),b.setUniform1f("uStrokesLog2Resolution",w.log2(a.resolution)),b.setUniform1f("uStrokesNormalizationScale",
a.normalizationScale),b.setUniform1f("uStrokesAmplitude",a.amplitude),b.setUniform1f("uStrokeVariants",a.variants))};d.sortRenderables=function(){this.renderablesDirty=!1;this.sortedRenderables[1][1].clear();this.sortedRenderables[1][2].clear();this.sortedRenderables[2][1].clear();this.sortedRenderables[2][2].clear();this.renderables.forEach(a=>{0!==a.objectTransparency&&0!==a.edgeTransparency&&this.sortedRenderables[a.objectTransparency][a.edgeTransparency].push(a)});const b=(a,c)=>"origin"in a.transform&&
"origin"in c.transform?a.transform.origin.id<c.transform.origin.id?-1:a.transform.origin.id>c.transform.origin.id?1:0:0;this.sortedRenderables[1][1].sort(b);this.sortedRenderables[1][2].sort(b);this.sortedRenderables[2][1].sort(b);this.sortedRenderables[2][2].sort(b)};e.getKey=function(b,a,c){return`edges-t:${b}:${a}:${c}`};return e}();const r={texName:"uComponentDataTex",invDimName:"uComponentDataTexInvDim",unit:2},t=y.create(),G=x.create();g.EXTENSION_LENGTH_OFFSET=128;g.EdgeRenderer=H;g.LINE_WIDTH_FRACTION_FACTOR=
8;g.componentDataBindParameters=r;Object.defineProperty(g,"__esModule",{value:!0})});