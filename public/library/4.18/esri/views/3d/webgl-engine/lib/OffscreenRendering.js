// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.18/esri/copyright.txt for details.
//>>built
define(["exports","../../../../chunks/_rollupPluginBabelHelpers","./RenderTargetHelper"],function(l,m,n){let r=function(){function h(a,c){this._rctx=a;this._compositingHelper=c;this._currentRenderTarget=0;this.dimensions={width:4,height:4};this._needLastFrameColorTexture=!1;this._background={type:"color",color:[0,0,0,1]};a=this.renderTargetHelper=new n.RenderTargetHelper(this._rctx);this.mainColorTarget0=a.registerColorTarget({name:"mainColorTarget0"});this.mainColorTarget1=a.registerColorTarget({name:"mainColorTarget1"});
this.frontFaceTarget=a.registerColorTarget({name:"frontFaceTarget"});this.colorFloatTarget=a.registerColorTarget({name:"colorFloatTarget",dataType:5126,samplingMode:9728});this.alphaFloatTarget=a.registerColorTarget({name:"alphaFloatTarget",dataType:5126,samplingMode:9728});this.mainDepth=a.registerDepthTarget({name:"mainDepth"});this.linearDepth=a.registerColorTarget({name:"linearDepth",samplingMode:9728});this.normal=a.registerColorTarget({name:"normal"});this.highlight=a.registerColorTarget({name:"highlight",
dataType:32819});this.hudVisibility=a.registerColorTarget({name:"hudVisibility",dataType:32819});this.tmpColor=a.registerColorTarget({name:"tmpColor"});this.tmpDepth=a.registerDepthTarget({name:"tmpDepth"});this.hudColor=a.registerColorTarget({name:"hudColor"})}var b=h.prototype;b.dispose=function(){this.renderTargetHelper.dispose()};b.getFramebuffer=function(a,c){return this.renderTargetHelper.getFramebuffer(this.dimensions,a,c)};b.advanceCurrentRenderTarget=function(){this._currentRenderTarget=
0===this._currentRenderTarget&&this._needLastFrameColorTexture?1:0};b.initializeFrame=function(a){const c=this._rctx;this.dimensions.width=a.fullWidth;this.dimensions.height=a.fullHeight;this.bindTarget(this.currentColorTarget,this.mainDepth);c.setClearStencil(0);a=this._background.color;c.setClearColor(a[0]*a[3],a[1]*a[3],a[2]*a[3],a[3]);c.clearSafe(17664)};b.composite=function(){this._compositingHelper.composite(this.colorTexture,0)};b.renderTmpAndCompositeToMain=function(a,c){this.renderToTargets(a,
this.tmpColor,this.mainDepth,p);this._compositingHelper.composite(this.getColorTexture(this.tmpColor),c)};b.renderHUDVisibility=function(a){this.renderToTargets(a,this.hudVisibility,this.mainDepth,q)};b.compositeTransparentTerrainOntoHUDVisibility=function(){this.renderToTargets(()=>{this._compositingHelper.compositeSpecial(this.getColorTexture(this.tmpColor),2)},this.hudVisibility,this.mainDepth)};b.renderOITPass=function(a,c,e){let d,f;switch(c){case 0:d=this.colorFloatTarget;f=[0,0,0,0];break;
case 1:d=this.alphaFloatTarget;f=[1,1,1,1];break;case 2:d=this.frontFaceTarget,f=[0,0,0,0]}e?this.renderToTargets(a,d,this.tmpDepth,f,!0,!0):this.renderToTargets(a,d,this.mainDepth,f,!1)};b.compositeTransparentTerrainOntoMain=function(){this.bindFramebuffer();this._compositingHelper.composite(this.getColorTexture(this.tmpColor),2)};b.compositeOccludedOntoMain=function(a){this.bindFramebuffer();this._compositingHelper.composite(this.getColorTexture(this.tmpColor),2,a)};b.compositeTransparentOntoOpaque=
function(a){a?(this.bindTarget(this.hudColor,this.tmpDepth),this._rctx.setClearColor(0,0,0,1E-13),this._rctx.clearSafe(16384,255)):this.bindFramebuffer();this._compositingHelper.compositeTransparent(this.getColorTexture(this.colorFloatTarget),this.getColorTexture(this.alphaFloatTarget),this.getColorTexture(this.frontFaceTarget))};b.bindFramebuffer=function(){this._rctx.bindFramebuffer(this.framebuffer)};b.renderDepthDetached=function(a){this.bindTarget(this.currentColorTarget);a();this.bindTarget(this.currentColorTarget,
this.mainDepth)};b.disposeTarget=function(a){this.renderTargetHelper.disposeTargetResource(a)};b.renderToTargets=function(a,c,e,d,f,g){const k=this._rctx;c=this.bindTarget(c,e);e=0;d&&(k.setClearColor(d[0],d[1],d[2],Math.max(1E-13,d[3])),e|=16384);f&&(e|=256);g&&(e|=1024);e&&k.clearSafe(e,!0===g?255:!1===g?0:g);a();k.gl.flush();this.bindTarget(this.currentColorTarget,this.mainDepth);return c};b.bindTarget=function(a,c){a=this.renderTargetHelper.getFramebuffer(this.dimensions,a,c);this._rctx.bindFramebuffer(a);
return a};b.getColorTexture=function(a){return this.renderTargetHelper.getColorTexture(a,this.dimensions)};b.getGpuMemoryUsage=function(){let a=0;this.renderTargetHelper&&(a+=this.renderTargetHelper.getGpuMemoryUsage());return a};m._createClass(h,[{key:"width",get:function(){return this.dimensions.width}},{key:"height",get:function(){return this.dimensions.height}},{key:"background",set:function(a){this._background=a},get:function(){return this._background}},{key:"currentColorTarget",get:function(){return 0===
this._currentRenderTarget?this.mainColorTarget0:this.mainColorTarget1}},{key:"previousColorTarget",get:function(){return 0===this._currentRenderTarget?this.mainColorTarget1:this.mainColorTarget0}},{key:"currentRenderTarget",get:function(){return this._currentRenderTarget}},{key:"framebuffer",get:function(){return this.getFramebuffer(this.currentColorTarget,this.mainDepth)}},{key:"colorTexture",get:function(){return this.renderTargetHelper.getAllocatedColorTexture(this.currentColorTarget)}},{key:"depthTexture",
get:function(){return this.renderTargetHelper.getAllocatedDepthTexture(this.mainDepth)}},{key:"linearDepthTexture",get:function(){return this.renderTargetHelper.getAllocatedColorTexture(this.linearDepth)}},{key:"lastFrameColorTexture",get:function(){return this.renderTargetHelper.getAllocatedColorTexture(this.previousColorTarget)}},{key:"normalTexture",get:function(){return this.renderTargetHelper.getAllocatedColorTexture(this.normal)}},{key:"highlightTexture",get:function(){return this.renderTargetHelper.getAllocatedColorTexture(this.highlight)}},
{key:"hudVisibilityTexture",get:function(){return this.getColorTexture(this.hudVisibility)}},{key:"tmpColorTexture",get:function(){return this.getColorTexture(this.tmpColor)}},{key:"hudColorTexture",get:function(){return this.getColorTexture(this.hudColor)}},{key:"mainColorTexture",get:function(){return this.getColorTexture(this.currentColorTarget)}},{key:"needLastFrameColorTexture",set:function(a){!a&&this._needLastFrameColorTexture&&(this._currentRenderTarget=0,this.disposeTarget(this.mainColorTarget1));
this._needLastFrameColorTexture=a},get:function(){return this._needLastFrameColorTexture}}]);return h}();const p=[0,0,0,0],q=[0,1,0,1];l.OffscreenRendering=r;Object.defineProperty(l,"__esModule",{value:!0})});