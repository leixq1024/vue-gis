// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.18/esri/copyright.txt for details.
//>>built
define(["../../../../chunks/_rollupPluginBabelHelpers","../../../../core/Evented","../../../../chunks/vec3f64","./IdGen","./Octree"],function(l,f,h,m,n){f=function(k){function g(a,b,e){var d=k.call(this)||this;d._parentStages=new Map;d._objects=new Set;d.id=g._idGen.gen(a);d.apiLayerUid=e;d.name=a;b=b||{};d.group=b.group||"";d.isVisible=null!=b.isVisible?b.isVisible:!0;d.isPickable=null!=b.isPickable?b.isPickable:!0;d.isSliceable=!1;d.translation=b.translation?h.clone(b.translation):h.create();return d}
l._inheritsLoose(g,k);var c=g.prototype;c.addParentStage=function(a){if(!this._parentStages.has(a)){const b=this.on("dirty",e=>{a.notifyDirty(e.origin,e.dirtyType,e.subObject)});this._parentStages.set(a,b)}};c.removeParentStage=function(a){const b=this._parentStages.get(a);b&&(b.remove(),this._parentStages.delete(a));this.invalidateSpatialQueryAccelerator()};c.getName=function(){return this.name};c.getGroup=function(){return this.group};c.getTranslation=function(){return this.translation};c.getObjectIds=
function(){return Array.from(this._objects,a=>a.id)};c.getObjects=function(){return[...this._objects]};c.addObject=function(a){this._objects.add(a);a.parentLayer=this;this.notifyDirty("layerObjectAdded",a);this._octree&&this._octree.add(a)};c.hasObject=function(a){return this._objects.has(a)};c.removeObject=function(a){if(!this._objects.delete(a))return!1;a.parentLayer=null;this.notifyDirty("layerObjectRemoved",a);this._octree&&this._octree.remove(a);return!0};c.notifyObjectBBChanged=function(a,b){this._octree&&
this._octree.update(a,b)};c.getSpatialQueryAccelerator=function(){!this._octree&&50<this._objects.size&&this._createOctree();return this._octree};c.shaderTransformationChanged=function(){this.notifyDirty("shaderTransformationChanged",null)};c.invalidateSpatialQueryAccelerator=function(){this._octree&&(this._octree.destroy(),this._octree=null)};c.notifyDirty=function(a,b,e,d){this.emit("dirty",{origin:d||this,dirtyType:a,subObject:b})};c._createOctree=function(){this._octree=new n({getRadius:a=>a.getBSRadius(),
getCenter:a=>a.getCenter()});this._octree.add([...this._objects])};return g}(f);f._idGen=new m.IdGen;return f});