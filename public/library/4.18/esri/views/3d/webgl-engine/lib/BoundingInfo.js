// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.18/esri/copyright.txt for details.
//>>built
define(["../../../../core/PooledArray","../../../../chunks/vec3f64","../../../../chunks/vec3","./Util"],function(B,q,t,r){let y=function(){function l(c,d,a,b){this.primitiveIndices=c;this._numIndexPerPrimitive=d;this.indices=a;this._position=b;this.center=q.create();r.assert(1<=c.length);r.assert(0===a.length%this._numIndexPerPrimitive);r.assert(a.length>=c.length*this._numIndexPerPrimitive);r.assert(3===this._position.size||4===this._position.size);const {data:e,offsetIdx:p,strideIdx:k}=this._position;
d=0;var g=c.length;b=p+k*a[this._numIndexPerPrimitive*c[d]];l.tmpIndices.clear();l.tmpIndices.push(b);this.bbMin=q.fromValues(e[b],e[b+1],e[b+2]);for(this.bbMax=q.clone(this.bbMin);d<g;++d){var f=this._numIndexPerPrimitive*c[d];for(var m=0;m<this._numIndexPerPrimitive;++m){b=p+k*a[f+m];l.tmpIndices.push(b);let h=e[b];this.bbMin[0]=Math.min(h,this.bbMin[0]);this.bbMax[0]=Math.max(h,this.bbMax[0]);h=e[b+1];this.bbMin[1]=Math.min(h,this.bbMin[1]);this.bbMax[1]=Math.max(h,this.bbMax[1]);h=e[b+2];this.bbMin[2]=
Math.min(h,this.bbMin[2]);this.bbMax[2]=Math.max(h,this.bbMax[2])}}t.lerp(this.center,this.bbMin,this.bbMax,.5);this.bsRadius=.5*Math.max(Math.max(this.bbMax[0]-this.bbMin[0],this.bbMax[1]-this.bbMin[1]),this.bbMax[2]-this.bbMin[2]);c=this.bsRadius*this.bsRadius;for(d=0;d<l.tmpIndices.length;++d)b=l.tmpIndices.data[d],a=e[b]-this.center[0],g=e[b+1]-this.center[1],b=e[b+2]-this.center[2],f=a*a+g*g+b*b,f<=c||(f=Math.sqrt(f),m=.5*(f-this.bsRadius),this.bsRadius+=m,c=this.bsRadius*this.bsRadius,f=m/f,
this.center[0]+=a*f,this.center[1]+=g*f,this.center[2]+=b*f);l.tmpIndices.clear()}var n=l.prototype;n.getCenter=function(){return this.center};n.getBSRadius=function(){return this.bsRadius};n.getBBMin=function(){return this.bbMin};n.getBBMax=function(){return this.bbMax};n.getPrimitiveIndices=function(){return this.primitiveIndices};n.getIndices=function(){return this.indices};n.getPosition=function(){return this._position};n.getChildren=function(){if(this._children)return this._children;if(1<t.squaredDistance(this.bbMin,
this.bbMax)){var c=t.lerp(q.create(),this.bbMin,this.bbMax,.5),d=this.primitiveIndices.length;const p=new Uint8Array(d),k=Array(8);for(var a=0;8>a;++a)k[a]=0;const {data:g,offsetIdx:f,strideIdx:m}=this._position;for(a=0;a<d;++a){var b=0;const h=this._numIndexPerPrimitive*this.primitiveIndices[a];var e=f+m*this.indices[h];let u=g[e],v=g[e+1],w=g[e+2];for(let x=1;x<this._numIndexPerPrimitive;++x){e=f+m*this.indices[h+x];const z=g[e],A=g[e+1];e=g[e+2];z<u&&(u=z);A<v&&(v=A);e<w&&(w=e)}u<c[0]&&(b|=1);
v<c[1]&&(b|=2);w<c[2]&&(b|=4);p[a]=b;++k[b]}c=0;for(a=0;8>a;++a)0<k[a]&&++c;if(2>c)return;c=Array(8);for(a=0;8>a;++a)c[a]=0<k[a]?new Uint32Array(k[a]):void 0;for(a=0;8>a;++a)k[a]=0;for(a=0;a<d;++a)b=p[a],c[b][k[b]++]=this.primitiveIndices[a];this._children=Array(8);for(d=0;8>d;++d)void 0!==c[d]&&(this._children[d]=new l(c[d],this._numIndexPerPrimitive,this.indices,this._position))}return this._children};return l}();(y||(y={})).tmpIndices=new B({deallocator:null});return y});