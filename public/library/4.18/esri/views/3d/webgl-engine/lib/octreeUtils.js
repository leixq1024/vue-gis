// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.18/esri/copyright.txt for details.
//>>built
define(["exports","../../../../chunks/vec3f64","./Octree"],function(h,k,l){function m(c,b=!1){const a=c instanceof l?c.root:c;let d;d={};c instanceof l&&b&&(d.center=k.clone(c.center),d.size=c.size);0<a.terminals.length&&(d.terminals=a.terminals.map(e=>e.id));null!==a.residents&&0<a.residents.length&&(d.residents=a.residents.map(e=>e.id));null===a.residents&&a.children.forEach(function(e,f){e&&(d["child"+f]=m(e))});return d}function n(c,b,a,d,e){for(let f=0;3>f;f++)if(c[f]<a[f]||c[f]>d[f])throw Error("[Octree Validation] Object is not within node bounds");
c=.25*(d[0]-a[0]);if(e&&b<c)throw Error("[Octree Validation] Object is too small to be a terminal");if(!e&&b>c)throw Error("[Octree Validation] Object is too large to be a resident");}function p(c,b,a){a=a||c;a[0]=c[0]+b;a[1]=c[1]+b;a[2]=c[2]+b;return a}h.assert=function(c,b){c.forEachNode((a,d,e)=>{const f=p(d,-e/2,k.create()),q=p(d,e/2,k.create());a.terminals.forAll(g=>n(b.getCenter(g),b.getRadius(g),f,q,!0));if(null!==a.residents){if(a.residents.length>c.maximumObjectsPerNode)throw Error("[Octree Validation] Number of objects "+
a.residents.length+" exceeds maximum allowed ("+c.maximumObjectsPerNode+")");a.residents.forAll(g=>n(b.getCenter(g),b.getRadius(g),f,q,!1))}let r=!1;a.children.forEach(g=>{if(g&&(r=!0,null!==a.residents))throw Error("[Octree Validation] Node has residents and children");});if(!r&&(null===a.residents||0===a.residents.length)&&0===a.terminals.length)throw Error("[Octree Validation] dangling empty node");return!0});return!0};h.debugDump=m;h.stats=function(c){const b={numNodes:0,numObjects:0,numTerminals:0,
numResidents:0,numOutsiders:0,numInnerNodes:0,numTerminalNodes:0,maximumDepth:0,maxNumTerminals:0,maxNumResidents:0,maxNumObjects:0};c.forEachNode((a,d,e)=>{null===a.residents?b.numInnerNodes++:b.numTerminalNodes++;b.numTerminals+=a.terminals.length;b.maxNumTerminals=Math.max(a.terminals.length,b.maxNumTerminals);d=a.terminals.length;null!==a.residents&&(b.numResidents+=a.residents.length,b.maxNumResidents=Math.max(a.residents.length,b.maxNumResidents),d+=a.residents.length);b.maxNumObjects=Math.max(d,
b.maxNumObjects);b.maximumDepth=Math.max(b.maximumDepth,Math.round(Math.log(c.size/e)*Math.LOG2E));return!0});b.numObjects=b.numOutsiders+b.numTerminals+b.numResidents;b.numNodes=b.numInnerNodes+b.numTerminalNodes;return b};Object.defineProperty(h,"__esModule",{value:!0})});