// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.18/esri/copyright.txt for details.
//>>built
define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../core/mathUtils ../../../../core/screenUtils ../../../../chunks/vec3f64 ../../../../chunks/vec3 ../../../../chunks/mat4 ../../../../geometry/support/aaBoundingRect ../../../../chunks/mat3f64 ../../../../chunks/mat4f64 ../../../../chunks/vec2f64 ../../../../chunks/mat3 ../../../../chunks/vec2 ../../support/buffer/InterleavedLayout ../lib/geometryDataUtils ../lib/Util ./renderers/utils ../lib/screenSizePerspectiveUtils ../../../../core/libs/gl-matrix-2/types/mat4 ../lib/GLMaterialTexture ./internal/MaterialUtil ../lib/Material ./internal/bufferWriterUtils ../../../../chunks/HUDMaterial.glsl ../shaders/HUDMaterialTechnique".split(" "),
function(S,J,da,N,ea,D,l,fa,ha,T,U,V,W,ia,ja,ka,h,la,K,ma,L,na,X,H,Y,M){function oa(r,q,f,a=pa){ia.copy(a,r.anchorPos);a[0]*=-q[0];a[1]*=-q[1];a[0]+=r.screenOffset[0]*f;a[1]+=r.screenOffset[1]*f;return a}function Z(r,q,f,a,c,d,b,g){q=q-c-(0<g[0]?a[0]*g[0]:0);let e=q+a[0]+2*c;f=f-c-(0<g[1]?a[1]*g[1]:0);c=f+a[1]+2*c;b.textureIsSignedDistanceField&&(b=b.distanceFieldBoundingBox,q+=a[0]*b[0],f+=a[1]*b[1],e-=a[0]*(1-b[2]),c-=a[1]*(1-b[3]),q-=d,e+=d,f-=d,c+=d);return r[0]>q&&r[0]<e&&r[1]>f&&r[1]<c}let xa=
function(r){function q(a,c){a=r.call(this,c,a,qa)||this;a.techniqueConfig=new M.HUDMaterialTechniqueConfiguration;return a}J._inheritsLoose(q,r);var f=q.prototype;f.getTechniqueConfig=function(a,c){this.techniqueConfig.output=a;this.techniqueConfig.slicePlaneEnabled=this.params.slicePlaneEnabled;this.techniqueConfig.verticalOffset=!!this.params.verticalOffset;this.techniqueConfig.screenSizePerspective=!!this.params.screenSizePerspective;this.techniqueConfig.screenCenterOffsetUnitsEnabled="screen"===
this.params.centerOffsetUnits?1:0;this.techniqueConfig.polygonOffsetEnabled=this.params.polygonOffset;this.techniqueConfig.isDraped=this.params.isDraped;this.techniqueConfig.occlusionTestEnabled=this.params.occlusionTest;this.techniqueConfig.pixelSnappingEnabled=this.params.pixelSnappingEnabled;this.techniqueConfig.sdf=this.params.textureIsSignedDistanceField;this.techniqueConfig.vvSize=!!this.params.vvSizeEnabled;this.techniqueConfig.vvColor=!!this.params.vvColorEnabled;0===a&&(this.techniqueConfig.debugDrawBorder=
!!this.params.debugDrawBorder);4===a&&(this.techniqueConfig.binaryHighlightOcclusion=this.params.binaryHighlightOcclusion);this.techniqueConfig.depthEnabled=this.params.depthEnabled;this.techniqueConfig.transparencyPassType=c?c.transparencyPassType:3;return this.techniqueConfig};f.intersect=function(a,c,d,b,g,e,m,n,k){k?this.intersectDrapedHudGeometry(a,e,m,n):this.intersectHudGeometry(a,c,d,b,m,n)};f.intersectDrapedHudGeometry=function(a,c,d,b){const g=a.getAttribute(h.VertexAttrConstants.POSITION),
e=a.getAttribute(h.VertexAttrConstants.SIZE),m=this.params,n=Y.calculateAnchorPosForRendering(m);let k=1;var t=1;b&&(t=b(aa),k=t[0],t=t[5]);k*=a.screenToWorldRatio;t*=a.screenToWorldRatio;b=2*a.screenToWorldRatio;for(let u=0;u<g.data.length/g.size;u++){var w=u*g.size;const E=g.data[w];w=g.data[w+1];const A=u*e.size;B[0]=e.data[A]*k;B[1]=e.data[A+1]*t;let x;m.textureIsSignedDistanceField&&(x=m.outlineSize*a.screenToWorldRatio/2);Z(c,E,w,B,b,x,m,n)&&d()}};f.intersectHudGeometry=function(a,c,d,b,g,e){if(b.options.selectionMode&&
b.options.hud&&!la.isInstanceHidden(c)){var m=a.data;a=this.params;var n=c=1;W.fromMat4(O,d);if(e){n=e(aa);c=n[0];n=n[5];{e=O;var k=e[0],t=e[1],w=e[2],u=e[3],E=e[4],A=e[5],x=e[6],p=e[7],y=e[8],C=1/Math.sqrt(k*k+t*t+w*w);const G=1/Math.sqrt(u*u+E*E+A*A),P=1/Math.sqrt(x*x+p*p+y*y);e[0]=k*C;e[1]=t*C;e[2]=w*C;e[3]=u*G;e[4]=E*G;e[5]=A*G;e[6]=x*P;e[7]=p*P;e[8]=y*P}}e=m.getVertexAttr()[h.VertexAttrConstants.POSITION];k=m.getVertexAttr()[h.VertexAttrConstants.SIZE];t=m.getVertexAttr()[h.VertexAttrConstants.NORMAL];
m=m.getVertexAttr()[h.VertexAttrConstants.AUXPOS1];h.assert(3<=e.size);w=b.point;u=b.camera;E=Y.calculateAnchorPosForRendering(a);c*=u.pixelRatio;n*=u.pixelRatio;A="screen"===this.params.centerOffsetUnits;for(x=0;x<e.data.length/e.size;x++)if(p=x*e.size,l.set(v,e.data[p],e.data[p+1],e.data[p+2]),l.transformMat4(v,v,d),p=x*k.size,B[0]=k.data[p]*c,B[1]=k.data[p+1]*n,l.transformMat4(v,v,u.viewMatrix),p=x*m.size,l.set(z,m.data[p+0],m.data[p+1],m.data[p+2]),A||(v[0]+=z[0],v[1]+=z[1],0!==z[2]&&(p=z[2],
l.normalize(z,v),l.subtract(v,v,l.scale(z,z,p)))),p=x*t.size,l.set(I,t.data[p],t.data[p+1],t.data[p+2]),this.normalAndViewAngle(I,O,u,Q),this.applyVerticalOffsetTransformationView(v,Q,u,R),u.applyProjection(v,F),-1<F[0]){p=Math.floor(F[0])+this.params.screenOffset[0];y=Math.floor(F[1])+this.params.screenOffset[1];A&&(p+=z[0],0!==z[1]&&(y+=K.applyScaleFactor(z[1],R.factorAlignment)));K.applyPrecomputedScaleFactor(B,R.factor,B);C=1*u.pixelRatio;let G;a.textureIsSignedDistanceField&&(G=a.outlineSize*
u.pixelRatio/2);Z(w,p,y,B,C,G,a,E)&&(y=b.ray,l.transformMat4(ba,v,fa.invert(ra,u.viewMatrix)),F[0]=w[0],F[1]=w[1],u.unprojectFromRenderScreen(F,v)&&(p=D.create(),l.copy(p,y.direction),C=1/l.length(p),l.scale(p,p,C),y=l.distance(y.origin,v)*C,g(y,p,-1,1,!0,ba)))}}};f.computeAttachmentOrigin=function(a,c){a=a.data;var d="getVertexAttr"in a?a.getVertexAttr():"vertexAttr"in a?a.vertexAttr:null;if(!d)return null;const b=h.VertexAttrConstants.POSITION;d=d[b];a="getIndices"in a?a.getIndices(b):"indices"in
a?a.indices[b]:null;return ka.computeAttachmentOriginPoints(d,a,c)};f.createBufferWriter=function(){return new sa(this)};f.normalAndViewAngle=function(a,c,d,b){ma.isMat4(c)&&(c=W.fromMat4(ta,c));l.transformMat3(b.normal,a,c);l.transformMat4(b.normal,b.normal,d.viewInverseTransposeMatrix);b.cosAngle=l.dot(ca,ua);return b};f.updateScaleInfo=function(a,c,d){const b=this.params;b.screenSizePerspective?K.precomputeScaleFactor(d,c,b.screenSizePerspective,a.factor):(a.factor.scale=1,a.factor.factor=0,a.factor.minPixelSize=
0,a.factor.paddingPixels=0);b.screenSizePerspectiveAlignment?K.precomputeScaleFactor(d,c,b.screenSizePerspectiveAlignment,a.factorAlignment):(a.factorAlignment.factor=a.factor.factor,a.factorAlignment.scale=a.factor.scale,a.factorAlignment.minPixelSize=a.factor.minPixelSize,a.factorAlignment.paddingPixels=a.factor.paddingPixels)};f.applyShaderOffsetsView=function(a,c,d,b,g,e,m){c=this.normalAndViewAngle(c,d,g,Q);this.applyVerticalGroundOffsetView(a,c,g,m);this.applyVerticalOffsetTransformationView(m,
c,g,e);this.applyPolygonOffsetView(m,c,b[3],g,m);this.applyCenterOffsetView(m,b,m);return m};f.applyShaderOffsetsNDC=function(a,c,d,b,g){this.applyCenterOffsetNDC(a,c,d,b);da.isSome(g)&&l.copy(g,b);this.applyPolygonOffsetNDC(b,c,d,b);return b};f.applyPolygonOffsetView=function(a,c,d,b,g){var e=b.aboveGround?1:-1;d=N.sign(d);0===d&&(d=e);e*=d;if(0>=this.params.shaderPolygonOffset)return l.copy(g,a);c=N.clamp(Math.abs(c.cosAngle),.01,1);b=1-Math.sqrt(1-c*c)/c/b.viewport[2];0<e?l.scale(g,a,b):l.scale(g,
a,1/b);return g};f.applyVerticalGroundOffsetView=function(a,c,d,b){const g=l.length(a),e=d.aboveGround?1:-1;d=.5*d.computeRenderPixelSizeAtDist(g);c=l.scale(v,c.normal,e*d);l.add(b,a,c);return b};f.applyVerticalOffsetTransformationView=function(a,c,d,b){const g=this.params;if(!g.verticalOffset||!g.verticalOffset.screenLength){if(g.screenSizePerspective||g.screenSizePerspectiveAlignment){var e=l.length(a);this.updateScaleInfo(b,e,c.cosAngle)}else b.factor.scale=1,b.factorAlignment.scale=1;return a}e=
l.length(a);d=na.verticalOffsetAtDistance(d,e,g.verticalOffset,c.cosAngle,g.screenSizePerspectiveAlignment||g.screenSizePerspective);this.updateScaleInfo(b,e,c.cosAngle);l.scale(c.normal,c.normal,d);return l.add(a,a,c.normal)};f.applyCenterOffsetView=function(a,c,d){const b="screen"!==this.params.centerOffsetUnits;d!==a&&l.copy(d,a);b&&(d[0]+=c[0],d[1]+=c[1],c[2]&&(l.normalize(I,d),l.add(d,d,l.scale(I,I,c[2]))));return d};f.applyCenterOffsetNDC=function(a,c,d,b){const g="screen"!==this.params.centerOffsetUnits;
b!==a&&l.copy(b,a);g||(b[0]+=c[0]/d.fullWidth*2,b[1]+=c[1]/d.fullHeight*2);return b};f.applyPolygonOffsetNDC=function(a,c,d,b){const g=this.params.shaderPolygonOffset;a!==b&&l.copy(b,a);g&&(a=d.aboveGround?1:-1,c=a*N.sign(c[3]),b[2]-=(c||a)*g);return b};f.getGLMaterial=function(a){if(0===a.output||7===a.output)return new va(a);if(4===a.output)return new wa(a)};f.calculateRelativeScreenBounds=function(a,c,d=ha.create()){oa(this.params,a,c,d);d[2]=d[0]+a[0];d[3]=d[1]+a[1];return d};return q}(X.Material);
L=function(r){function q(a){a=r.call(this,{...a,...a.material.params})||this;a.updateParameters();return a}J._inheritsLoose(q,r);var f=q.prototype;f.beginSlot=function(a){return a===(this.material.params.drawInSecondSlot?19:18)};f.updateParameters=function(a){this.updateTexture(this.material.params.textureId);this.selectProgram(a)};f.selectProgram=function(a){this.technique=this.techniqueRep.acquireAndReleaseExisting(M.HUDMaterialTechnique,this.material.getTechniqueConfig(this.output,a),this.technique)};
f.ensureParameters=function(a){this.updateParameters(a)};f.bind=function(a,c){a.bindProgram(this.technique.program);this.bindTexture(a,this.technique.program);this.bindTextureScale(a,this.technique.program);this.technique.bindPass(a,this.material.params,c)};return q}(L);let va=function(r){function q(a){a=r.call(this,a)||this;a.isOcclusionSlot=!1;return a}J._inheritsLoose(q,r);var f=q.prototype;f.beginSlot=function(a){const c=this.material.params.drawInSecondSlot?19:18;if(this.material.params.occlusionTest)return this.isOcclusionSlot=
12===a,12===a||a===c;this.isOcclusionSlot=!1;return a===c};f.getTechnique=function(){return this.isOcclusionSlot?this.occlusionTechnique:this.technique};f.selectProgram=function(a){this.technique=this.techniqueRep.acquireAndReleaseExisting(M.HUDMaterialTechnique,this.material.getTechniqueConfig(this.output,a),this.technique);this.occlusionTechnique=this.techniqueRep.acquireAndReleaseExisting(M.HUDMaterialTechnique,this.material.getTechniqueConfig(6,a),this.occlusionTechnique)};f.bind=function(a,c){const d=
this.getTechnique();a.bindProgram(d.program);this.isOcclusionSlot||(this.bindTexture(a,d.program),this.bindTextureScale(a,d.program));d.bindPass(a,this.material.params,c)};return q}(L),wa=function(r){function q(f){return r.call(this,{...f,output:4})||this}J._inheritsLoose(q,r);return q}(L);const R={factor:{scale:0,factor:0,minPixelSize:0,paddingPixels:0},factorAlignment:{scale:0,factor:0,minPixelSize:0,paddingPixels:0}},pa=V.create(),v=D.create(),I=D.create(),F=ea.createRenderScreenPointArray3(),
ca=D.create(),ba=D.create(),O=T.create(),ta=T.create(),ra=U.create(),z=D.create(),Q={normal:ca,cosAngle:0},aa=U.create(),B=[0,0],ua=D.fromValues(0,0,1),qa={texCoordScale:[1,1],occlusionTest:!0,binaryHighlightOcclusion:!0,drawInSecondSlot:!1,color:[1,1,1,1],outlineColor:[1,1,1,1],outlineSize:0,textureIsSignedDistanceField:!1,distanceFieldBoundingBox:null,vvSizeEnabled:!1,vvSizeMinSize:[1,1,1],vvSizeMaxSize:[100,100,100],vvSizeOffset:[0,0,0],vvSizeFactor:[1,1,1],vvColorEnabled:!1,vvColorValues:[0,0,
0,0,0,0,0,0],vvColorColors:[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],screenOffset:[0,0],verticalOffset:null,screenSizePerspective:null,screenSizePerspectiveAlignment:null,slicePlaneEnabled:!1,anchorPos:V.fromValues(.5,.5),shaderPolygonOffset:1E-5,polygonOffset:!1,textureId:null,centerOffsetUnits:"world",depthEnabled:!0,pixelSnappingEnabled:!0,debugDrawBorder:!1,isDraped:!1,...X.materialParametersDefaults},ya=ja.newLayout().vec3f(h.VertexAttrConstants.POSITION).vec3f(h.VertexAttrConstants.NORMAL).vec2f(h.VertexAttrConstants.UV0).vec4u8(h.VertexAttrConstants.COLOR).vec2f(h.VertexAttrConstants.SIZE).vec4f(h.VertexAttrConstants.AUXPOS1).vec4f(h.VertexAttrConstants.AUXPOS2);
let sa=function(){function r(f){this.material=f;this.vertexBufferLayout=ya}var q=r.prototype;q.allocate=function(f){return this.vertexBufferLayout.createBuffer(f)};q.elementCount=function(f){return 6*f.indices[h.VertexAttrConstants.POSITION].length};q.write=function(f,a,c,d){H.writePosition(a.indices[h.VertexAttrConstants.POSITION],a.vertexAttr[h.VertexAttrConstants.POSITION].data,f.transformation,c.position,d,6);H.writeNormal(a.indices[h.VertexAttrConstants.NORMAL],a.vertexAttr[h.VertexAttrConstants.NORMAL].data,
f.invTranspTransformation,c.normal,d,6);var b=a.vertexAttr[h.VertexAttrConstants.UV0].data;if(null==b||4>b.length){b=this.material.params;var g=f=0;var e=b.texCoordScale[0];b=b.texCoordScale[1]}else f=b[0],g=b[1],e=b[2],b=b[3];e=Math.min(1.99999,e+1);b=Math.min(1.99999,b+1);var m=a.indices[h.VertexAttrConstants.POSITION].length,n=c.uv0,k=d;for(var t=0;t<m;++t)n.set(k,0,f),n.set(k,1,g),k+=1,n.set(k,0,e),n.set(k,1,g),k+=1,n.set(k,0,e),n.set(k,1,b),k+=1,n.set(k,0,e),n.set(k,1,b),k+=1,n.set(k,0,f),n.set(k,
1,b),k+=1,n.set(k,0,f),n.set(k,1,g),k+=1;H.writeColor(a.indices[h.VertexAttrConstants.COLOR],a.vertexAttr[h.VertexAttrConstants.COLOR].data,4,c.color,d,6);f=a.indices[h.VertexAttrConstants.SIZE];g=a.vertexAttr[h.VertexAttrConstants.SIZE].data;e=f.length;b=c.size;m=d;for(n=0;n<e;++n){k=g[2*f[n]];t=g[2*f[n]+1];for(let w=0;6>w;++w)b.set(m,0,k),b.set(m,1,t),m+=1}a.indices[h.VertexAttrConstants.AUXPOS1]&&a.vertexAttr[h.VertexAttrConstants.AUXPOS1]&&H.writeBufferVec4(a.indices[h.VertexAttrConstants.AUXPOS1],
a.vertexAttr[h.VertexAttrConstants.AUXPOS1].data,c.auxpos1,d,6);a.indices[h.VertexAttrConstants.AUXPOS2]&&a.vertexAttr[h.VertexAttrConstants.AUXPOS2]&&H.writeBufferVec4(a.indices[h.VertexAttrConstants.AUXPOS2],a.vertexAttr[h.VertexAttrConstants.AUXPOS2].data,c.auxpos2,d,6)};return r}();S.HUDMaterial=xa;Object.defineProperty(S,"__esModule",{value:!0})});