// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.18/esri/copyright.txt for details.
//>>built
define("exports ../../../../../core/maybe ../../../../../core/mathUtils ../../../../../chunks/vec3f64 ../../../../../chunks/vec3 ../../../../../geometry/support/aaBoundingBox ../../lib/Util ../renderers/utils ../../lib/screenSizePerspectiveUtils".split(" "),function(z,L,S,I,G,M,T,ea,fa){function U(a,b,c,d,k,e){var f=V(b,c,ha);M.setMin(J,a.getBBMin());M.setMax(J,a.getBBMax());L.isSome(k)&&k.applyToAabb(J);if(W(J,b,f,d)){f=a.getPrimitiveIndices();const m=a.getIndices(),w=a.getPosition(),y=f?f.length:
m.length/3;if(1E3<y&&(a=a.getChildren(),void 0!==a)){for(f=0;8>f;++f)void 0!==a[f]&&U(a[f],b,c,d,k,e);return}N(b,c,0,y,m,w,f,k,e)}}function N(a,b,c,d,k,e,f,m,w){if(f){{const {data:t,offsetIdx:F,strideIdx:O}=e;e=a[0];var y=a[1];a=a[2];var u=b[0]-e,B=b[1]-y;for(b=b[2]-a;c<d;++c){var C=f[c],g=3*C,h=F+O*k[g++],q=t[h++],n=t[h++],l=t[h];h=F+O*k[g++];var r=t[h++],x=t[h++],p=t[h];h=F+O*k[g];g=t[h++];var v=t[h++];h=t[h];L.isSome(m)&&([q,n,l]=m.applyToVertex(q,n,l,c),[r,x,p]=m.applyToVertex(r,x,p,c),[g,v,h]=
m.applyToVertex(g,v,h,c));r-=q;x-=n;p-=l;g-=q;v-=n;h-=l;var D=B*h-v*b,H=b*g-h*u;const X=u*v-g*B;var A=r*D+x*H+p*X;if(!(Math.abs(A)<=Y)){q=e-q;n=y-n;l=a-l;D=q*D+n*H+l*X;if(0<A){if(0>D||D>A)continue}else if(0<D||D<A)continue;H=n*p-x*l;l=l*r-p*q;n=q*x-r*n;q=u*H+B*l+b*n;if(0<A){if(0>q||D+q>A)continue}else if(0<q||D+q<A)continue;l=(g*H+v*l+h*n)/A;0<=l&&(r=P(r,x,p,g,v,h,Z),w(l,r,C))}}}}else{var {data:E,offsetIdx:Q,strideIdx:R}=e;f=a[0];e=a[1];y=a[2];a=b[0]-f;u=b[1]-e;B=b[2]-y;for(let t=c,F=3*c;t<d;++t)if(g=
Q+R*k[F++],n=E[g++],l=E[g++],p=E[g],g=Q+R*k[F++],b=E[g++],c=E[g++],C=E[g],g=Q+R*k[F++],r=E[g++],x=E[g++],g=E[g],L.isSome(m)&&([n,l,p]=m.applyToVertex(n,l,p,t),[b,c,C]=m.applyToVertex(b,c,C,t),[r,x,g]=m.applyToVertex(r,x,g,t)),b-=n,c-=l,C-=p,r-=n,x-=l,g-=p,h=u*g-x*B,q=B*r-g*a,A=a*x-r*u,v=b*h+c*q+C*A,!(Math.abs(v)<=Y)){n=f-n;l=e-l;p=y-p;h=n*h+l*q+p*A;if(0<v){if(0>h||h>v)continue}else if(0<h||h<v)continue;q=l*C-c*p;p=p*b-C*n;l=n*c-b*l;n=a*q+u*p+B*l;if(0<v){if(0>n||h+n>v)continue}else if(0<n||h+n<v)continue;
p=(r*q+x*p+g*l)/v;0<=p&&(b=P(b,c,C,r,x,g,Z),w(p,b,t))}}}function P(a,b,c,d,k,e,f){G.set(aa,a,b,c);G.set(ba,d,k,e);G.cross(f,aa,ba);G.normalize(f,f);return f}function V(a,b,c){return G.set(c,1/(b[0]-a[0]),1/(b[1]-a[1]),1/(b[2]-a[2]))}function W(a,b,c,d){return ca(a,b,c,d,Infinity)}function ca(a,b,c,d,k){var e=(a[0]-d-b[0])*c[0],f=(a[3]+d-b[0])*c[0];let m=Math.min(e,f);e=Math.max(e,f);f=(a[1]-d-b[1])*c[1];const w=(a[4]+d-b[1])*c[1];e=Math.min(e,Math.max(f,w));if(0>e)return!1;m=Math.max(m,Math.min(f,
w));if(m>e)return!1;f=(a[2]-d-b[2])*c[2];a=(a[5]+d-b[2])*c[2];e=Math.min(e,Math.max(f,a));if(0>e)return!1;m=Math.max(m,Math.min(f,a));return m>e?!1:m<k}function da(a,b){b=b?da(b):{};for(const c in a){let d=a[c];d&&d.forEach&&(d=ia(d));null==d&&c in b||(b[c]=d)}return b}function ia(a){const b=[];a.forEach(c=>b.push(c));return b}const J=M.create(),K=T.VertexAttrConstants,ha=I.create(),Y=2**-52,Z=I.create(),aa=I.create(),ba=I.create();z.bindScreenSizePerspective=function(a,b,c){if(a){var d=a.parameters;
b.setUniform4f(c,d.divisor,d.offset,d.minPixelSize,a.paddingPixelsOverride)}};z.colorMixModes={multiply:1,ignore:2,replace:3,tint:4};z.computeInvDir=V;z.computeNormal=P;z.copyParameters=da;z.intersectAabbInvDir=W;z.intersectAabbInvDirBefore=ca;z.intersectDrapedRenderLineGeometry=function(a,b,c,d,k){if(b.options.selectionMode){b=a.getAttribute(K.POSITION).data;var e=a.getAttribute(K.SIZE),f=c[0];c=c[1];a=(((e&&e.data[0])+d)/2+4)*a.screenToWorldRatio;d=Number.MAX_VALUE;for(e=0;e<b.length-5;e+=3){var m=
b[e],w=b[e+1],y=f-m,u=c-w;m=b[e+3]-m;w=b[e+4]-w;const B=S.clamp((m*y+w*u)/(m*m+w*w),0,1);y=m*B-y;u=w*B-u;u=y*y+u*u;u<d&&(d=u)}d<a*a&&k()}};z.intersectTriangleGeometry=function(a,b,c,d,k,e,f){b=ea.isInstanceHidden(b);c=c.tolerance;b||(a.boundingInfo?(T.assert("triangle"===a.data.primitiveType),U(a.boundingInfo,d,k,c,e,f)):(c=a.getIndices(K.POSITION),a=a.getAttribute(K.POSITION),N(d,k,0,c.length/3,c,a,void 0,e,f)))};z.intersectTriangles=N;z.updateParameters=function(a,b){let c=!1;for(const d in b){const k=
b[d];void 0!==k&&(c=!0,Array.isArray(k)?a[d]=k.slice():a[d]=k)}return c};z.verticalOffsetAtDistance=function(a,b,c,d,k){let e=(c.screenLength||0)*a.pixelRatio;k&&(e=fa.scale(e,d,b,k));return S.glClamp(e*Math.tan(.5*a.fovY)/(.5*a.fullHeight)*b,c.minWorldLength||0,null!=c.maxWorldLength?c.maxWorldLength:Infinity)};Object.defineProperty(z,"__esModule",{value:!0})});