// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.18/esri/copyright.txt for details.
//>>built
define(["exports","../../../support/buffer/BufferView","../../lib/Util"],function(q,r,n){function H(l,b,a,g,c){const d=a.typedBuffer;a=a.typedBufferStride;const e=l.length;g*=a;if(null==c||1===c)for(c=0;c<e;++c){var f=2*l[c];d[g]=b[f];d[g+1]=b[f+1];g+=a}else for(f=0;f<e;++f){const h=2*l[f];for(let k=0;k<c;++k)d[g]=b[h],d[g+1]=b[h+1],g+=a}}function D(l,b,a,g,c){const d=a.typedBuffer;a=a.typedBufferStride;const e=l.length;g*=a;if(null==c||1===c)for(c=0;c<e;++c){var f=3*l[c];d[g]=b[f];d[g+1]=b[f+1];
d[g+2]=b[f+2];g+=a}else for(f=0;f<e;++f){const h=3*l[f];for(let k=0;k<c;++k)d[g]=b[h],d[g+1]=b[h+1],d[g+2]=b[h+2],g+=a}}function E(l,b,a,g,c){const d=a.typedBuffer;a=a.typedBufferStride;const e=l.length;g*=a;if(null==c||1===c)for(c=0;c<e;++c){var f=4*l[c];d[g]=b[f];d[g+1]=b[f+1];d[g+2]=b[f+2];d[g+3]=b[f+3];g+=a}else for(f=0;f<e;++f){const h=4*l[f];for(let k=0;k<c;++k)d[g]=b[h],d[g+1]=b[h+1],d[g+2]=b[h+2],d[g+3]=b[h+3],g+=a}}function v(l,b,a,g,c,d){if(a){const p=g.typedBuffer;g=g.typedBufferStride;
const u=l.length;c*=g;if(null==d||1===d)for(d=0;d<u;++d){var e=3*l[d],f=b[e],h=b[e+1];e=b[e+2];p[c]=a[0]*f+a[4]*h+a[8]*e+a[12];p[c+1]=a[1]*f+a[5]*h+a[9]*e+a[13];p[c+2]=a[2]*f+a[6]*h+a[10]*e+a[14];c+=g}else for(f=0;f<u;++f){h=3*l[f];var k=b[h],m=b[h+1];const t=b[h+2];h=a[0]*k+a[4]*m+a[8]*t+a[12];e=a[1]*k+a[5]*m+a[9]*t+a[13];k=a[2]*k+a[6]*m+a[10]*t+a[14];for(m=0;m<d;++m)p[c]=h,p[c+1]=e,p[c+2]=k,c+=g}}else D(l,b,g,c,d)}function I(l,b,a,g,c,d){if(a){const p=g.typedBuffer;g=g.typedBufferStride;const u=
l.length,t=a[0],w=a[1],x=a[2],y=a[4],z=a[5],A=a[6],B=a[8],C=a[9];a=a[10];const J=1E-5<Math.abs(1-t*t+y*y+B*B)||1E-5<Math.abs(1-w*w+z*z+C*C)||1E-5<Math.abs(1-x*x+A*A+a*a);c*=g;if(null==d||1===d)for(d=0;d<u;++d){var e=3*l[d],f=b[e],h=b[e+1],k=b[e+2];e=t*f+y*h+B*k;var m=w*f+z*h+C*k;f=x*f+A*h+a*k;J&&(h=e*e+m*m+f*f,.999999>h&&1E-6<h&&(h=Math.sqrt(h),e/=h,m/=h,f/=h));p[c+0]=e;p[c+1]=m;p[c+2]=f;c+=g}else for(e=0;e<u;++e){m=3*l[e];h=b[m];k=b[m+1];const F=b[m+2];m=t*h+y*k+B*F;f=w*h+z*k+C*F;h=x*h+A*k+a*F;J&&
(k=m*m+f*f+h*h,.999999>k&&1E-6<k&&(k=Math.sqrt(k),m/=k,f/=k,h/=k));for(k=0;k<d;++k)p[c+0]=m,p[c+1]=f,p[c+2]=h,c+=g}}else D(l,b,g,c,d)}function G(l,b,a,g,c,d){const e=g.typedBuffer;g=g.typedBufferStride;const f=l.length;c*=g;if(null==d||1===d)if(4===a)for(d=0;d<f;++d)a=4*l[d],e[c]=b[a],e[c+1]=b[a+1],e[c+2]=b[a+2],e[c+3]=b[a+3],c+=g;else{if(3===a)for(d=0;d<f;++d)a=3*l[d],e[c]=b[a],e[c+1]=b[a+1],e[c+2]=b[a+2],e[c+3]=255,c+=g}else if(4===a)for(a=0;a<f;++a){var h=4*l[a];for(var k=0;k<d;++k)e[c]=b[h],e[c+
1]=b[h+1],e[c+2]=b[h+2],e[c+3]=b[h+3],c+=g}else if(3===a)for(a=0;a<f;++a)for(h=3*l[a],k=0;k<d;++k)e[c]=b[h],e[c+1]=b[h+1],e[c+2]=b[h+2],e[c+3]=255,c+=g}q.writeBufferMat3f=function(l,b,a,g){const c=a.typedBuffer;a=a.typedBufferStride;const d=l.length;g*=a;for(let e=0;e<d;++e){const f=9*l[e];for(let h=0;9>h;++h)c[g+h]=b[f+h];g+=a}};q.writeBufferMat4f=function(l,b,a,g){const c=a.typedBuffer;a=a.typedBufferStride;const d=l.length;g*=a;for(let e=0;e<d;++e){const f=16*l[e];for(let h=0;16>h;++h)c[g+h]=b[f+
h];g+=a}};q.writeBufferVec2=H;q.writeBufferVec3=D;q.writeBufferVec4=E;q.writeColor=G;q.writeDefaultAttributes=function(l,b,a,g,c,d){for(const f of b.fieldNames){b=l.vertexAttr[f];const h=l.indices[f];if(b&&h)switch(f){case n.VertexAttrConstants.POSITION:n.assert(3===b.size);var e=c.getField(f,r.BufferViewVec3f);e&&v(h,b.data,a,e,d);break;case n.VertexAttrConstants.NORMAL:n.assert(3===b.size);(e=c.getField(f,r.BufferViewVec3f))&&I(h,b.data,g,e,d);break;case n.VertexAttrConstants.UV0:n.assert(2===b.size);
(e=c.getField(f,r.BufferViewVec2f))&&H(h,b.data,e,d);break;case n.VertexAttrConstants.UVMAPSPACE:n.assert(4===b.size);(e=c.getField(f,r.BufferViewVec4f))&&E(h,b.data,e,d);break;case n.VertexAttrConstants.MEANVERTEXPOSITION:n.assert(3===b.size);(e=c.getField(f,r.BufferViewVec3f))&&v(h,b.data,a,e,d);break;case n.VertexAttrConstants.BOUND1:case n.VertexAttrConstants.BOUND2:case n.VertexAttrConstants.BOUND3:n.assert(3===b.size);(e=c.getField(f,r.BufferViewVec3f))&&v(h,b.data,a,e,d);break;case n.VertexAttrConstants.COLOR:n.assert(3===
b.size||4===b.size);(e=c.getField(f,r.BufferViewVec4u8))&&G(h,b.data,b.size,e,d);break;case n.VertexAttrConstants.SYMBOLCOLOR:n.assert(3===b.size||4===b.size);(e=c.getField(f,r.BufferViewVec4u8))&&G(h,b.data,b.size,e,d);break;case n.VertexAttrConstants.TANGENT:n.assert(4===b.size),(e=c.getField(f,r.BufferViewVec4f))&&E(h,b.data,e,d)}}};q.writeMultipliedColor=function(l,b,a,g,c,d,e){const f=c.typedBuffer;c=c.typedBufferStride;const h=l.length;d*=c;if(null==e||1===e)if(4===a)for(e=0;e<h;++e)a=4*l[e],
f[d]=b[a]*g[0],f[d+1]=b[a+1]*g[1],f[d+2]=b[a+2]*g[2],f[d+3]=b[a+3]*g[3],d+=c;else{if(3===a)for(e=255*g[3],a=0;a<h;++a){var k=3*l[a];f[d]=b[k]*g[0];f[d+1]=b[k+1]*g[1];f[d+2]=b[k+2]*g[2];f[d+3]=e;d+=c}}else if(4===a)for(a=0;a<h;++a){k=4*l[a];for(var m=0;m<e;++m)f[d]=b[k]*g[0],f[d+1]=b[k+1]*g[1],f[d+2]=b[k+2]*g[2],f[d+3]=b[k+3]*g[3],d+=c}else if(3===a)for(a=255*g[3],k=0;k<h;++k){m=3*l[k];for(let p=0;p<e;++p)f[d]=b[m]*g[0],f[d+1]=b[m+1]*g[1],f[d+2]=b[m+2]*g[2],f[d+3]=a,d+=c}};q.writeNormal=I;q.writePosition=
v;Object.defineProperty(q,"__esModule",{value:!0})});