// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.18/esri/copyright.txt for details.
//>>built
define("exports ../../support/mathUtils ../lib/Util ../lib/localOrigin ../lib/RenderGeometry ../lib/ModelDirtySet".split(" "),function(l,n,k,p,q,r){const f=k.assert,t=k.logWithBase;k=function(){function m(){this.dirtySet=new r(this);this._id2origin={};this._content=Array(5);for(let a=0;5>a;++a)this._content[a]=new Map}var e=m.prototype;e.getAll=function(a){a=this._content[a];f(void 0!==a);return a};e.get=function(a,b){return this.getAll(a).get(b)};e.add=function(a,b){const c=this._content[a];f(void 0!==
c);const d=b.id;f(!c.has(d),"Model/Stage already contains object to be added");c.set(d,b);0===a&&this.notifyDirty(b,"layerAdded")};e.remove=function(a,b){const c=this._content[a];f(void 0!==c);const d=c.get(b);f(void 0!==d,"Model/Stage doesn't contain object to be removed");c.delete(b);4===a&&d.unload();0===a&&this.notifyDirty(d,"layerRemoved");return d};e.getDirtySet=function(){return this.dirtySet};e.notifyDirty=function(a,b,c){this.dirtySet.handleUpdate(a,b,c)};e.getOrigin=function(a,b,c=10){var d=
0;b=b*c/1E4;1<b&&(d=Math.ceil(t(b,2)));b=1E4*Math.pow(2,d);c=Math.round(a[0]/b);const h=Math.round(a[1]/b);a=Math.round(a[2]/b);d=d+"_"+c+"_"+h+"_"+a;let g=this._id2origin[d];null==g&&(g=p.fromValues(c*b,h*b,a*b,d),this._id2origin[d]=g);return g};e.getGeometryRenderGeometries=function(a,b,c){const d=b.geometry,h=a.getCombinedStaticTransformation(b),g=n.maxScale(h),u=b.origin;a=new q(d.data,d.boundingInfo,b.material,h,b.shaderTransformation,g,a.castShadow);a.uniqueName=b.id;a.origin=u||this.getOrigin(a.center,
a.bsRadius);a.instanceParameters=b.instanceParameters;c.push(a)};e.updateRenderGeometryTransformation=function(a,b,c){a=a.getCombinedStaticTransformation(b,c.transformation);c.updateTransformation(a);a=this.getOrigin(c.center,c.bsRadius);return c.origin!==a};e.getStats=function(){const a={};for(let b=0;5>b;++b)a[b]=this.getAll(b).size;return{contentTypes:a,dirtySet:this.dirtySet.formatDebugInfo()}};e.validateObject=function(a){a=a.geometryRecords;for(let b=0;b<a.length;++b){const c=a[b];f(null!=this.get(2,
c.geometry.id));f(null!=this.get(3,c.material.id))}};e.validateLayer=function(a){a=a.getObjects();for(let b=0;b<a.length;++b){const c=this.get(1,a[b].id);f(null!=c)}};return m}();l.Model=k;Object.defineProperty(l,"__esModule",{value:!0})});