// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.18/esri/copyright.txt for details.
//>>built
define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/maybe","../../../../core/scheduling"],function(l,n,g,p){let r=function(){function m(a){this.view=a;this._currentFrameStartTime=this._preRenderFrameTaskHandle=null;this._numFadingNodes=0}var h=m.prototype;h.stopNodeFading=function(a){null!=a.lodCrossfadeProgress&&(this._numFadingNodes--,a.lodCrossfadeProgress=null,0===this._numFadingNodes&&(null!=this._preRenderFrameTaskHandle&&(this._preRenderFrameTaskHandle=g.removeMaybe(this._preRenderFrameTaskHandle)),
this.view.notifyLODUpdate(),this.view.notifyUpdate()))};h._startNodeFading=function(a,b,e){0===this._numFadingNodes&&(this._preRenderFrameTaskHandle=p.addFrameTask({preRender:d=>this._updateAllNodeFading(d)}),this.view.notifyLODUpdate());null==a.lodCrossfadeProgress&&(this._numFadingNodes++,this.view.notifyUpdate());a.lodCrossfadeSignedDuration=e;a.lodCrossfadeProgress=b};h._updateAllNodeFading=function(a){const b=this.view.nodeCrossfadingEnabled;this.view.foreachCrossfadeNode((e,d)=>{if(g.isSome(d)&&
g.isSome(d.lodCrossfadeProgress)){const c=d.lodCrossfadeSignedDuration,k=d.lodCrossfadeProgress+Math.abs(a.deltaTime/c),f=!b||1<=k||0===c,q=(0<c?this.view.fullOpacity:0)-(f?0:0<c?1:-1)*(1-k);f?(this.stopNodeFading(d),0>c&&this.view.markNodeToRemove(e)):d.lodCrossfadeProgress=k;this.view.setNodeOpacityByIndex(e,q)}});this.view.removeMarkedNodes()};h.stopAllNodeFading=function(){this.view.foreachCrossfadeNode((a,b)=>{g.isSome(b)&&g.isSome(b.lodCrossfadeProgress)&&(this.stopNodeFading(b),b=b.lodCrossfadeSignedDuration,
0>b&&this.view.markNodeToRemove(a),this.view.setNodeOpacityByIndex(a,0<b?this.view.fullOpacity:0))});this.view.removeMarkedNodes()};h.fadeNode=function(a,b,e,d){null==this._currentFrameStartTime&&(this._currentFrameStartTime=Date.now());var c=this.view;const k=c.nodeCrossfadingEnabled,f=0===e?c.fullOpacity:0;d=k?d?0===e?c.lodCrossfadeinDuration:c.lodCrossfadeoutDuration:c.lodCrossfadeUncoveredDuration:0;c=this.view.getNodeOpacityByIndex(a);k&&c!==f&&0<d?this._startNodeFading(b,1-Math.abs(f-c),(0===
e?1:-1)*d):(this.stopNodeFading(b),this.view.setNodeOpacityByIndex(a,f),0!==f&&1!==e||this.view.removeNode(a))};h.isNodeFullyFadedIn=function(a){const b=this.view.getNodeCrossfadeMetaData(a);return g.isSome(b)&&null==b.lodCrossfadeProgress&&this.view.getNodeOpacityByIndex(a)===this.view.fullOpacity};n._createClass(m,[{key:"updating",get:function(){return 0<this._numFadingNodes}}]);return m}();l.I3SCrossfadeHelper=r;l.NodeCrossfadeMetaData=function(){this.lodCrossfadeSignedDuration=0};Object.defineProperty(l,
"__esModule",{value:!0})});