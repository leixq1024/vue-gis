// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.18/esri/copyright.txt for details.
//>>built
define("../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/has ../../../../core/Logger ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/property ../../../../core/jsonMap ../../../../core/accessorSupport/decorators/subclass ../../../../core/urlUtils ../../../../core/uuid ../../../../portal/support/resourceExtension ../../../../core/promiseUtils ../../../../core/Accessor ../../../../core/Collection ../../../../Graphic ../../../../core/Handles ../../../../layers/Layer ../../../../core/accessorSupport/diffUtils ../../../../core/watchUtils ../../../../tasks/support/Query ../../../support/WatchUpdatingTracking ../../../../layers/graphics/hydratedFeatures ./graphicUtils ./constants ./Graphics3DCore ./Graphics3DScaleVisibility ./Graphics3DElevationAlignment ./Graphics3DObjectStates".split(" "),
function(l,e,c,I,J,g,K,r,L,M,N,m,t,u,n,v,w,x,y,z,A,B,C,D,E,F,G,H){c=function(p){function h(a){a=p.call(this,a)||this;a.graphicsCore=null;a.elevationAlignment=new G;a.watchUpdatingTracking=new A.WatchUpdatingTracking;a.handles=new v;a.suspendResumeExtent=null;return a}l._inheritsLoose(h,p);var d=h.prototype;d.normalizeCtorArgs=function(a){let b=null;a.scaleVisibilityEnabled&&(a={...a},delete a.scaleVisibilityEnabled,b=new F);const f=new E.Graphics3DCore({owner:a.owner,layer:a.layer,preferredUpdatePolicy:0,
graphicSymbolSupported:!0});return{...a,graphicsCore:f,scaleVisibility:b}};d.initialize=function(){this.scaleVisibility&&"minScale"in this.layer&&this.watchUpdatingTracking.add(this.layer,"scaleRangeId",()=>this.scaleVisibility.layerMinMaxScaleChangeHandler());this.elevationAlignment&&"elevationInfo"in this.layer&&this.watchUpdatingTracking.add(this.layer,"elevationInfo",(a,b)=>{x.diff(a,b)&&this.watchUpdatingTracking.addPromise(this.graphicsCore.elevationInfoChange())})};d.setup=async function(){const a=
(b,f,k)=>this.graphicsCore.spatialIndex.queryGraphicUIDsInExtent(b,f,k);this.elevationAlignment.setup(this.owner,a,this.graphicsCore,this.view.elevationProvider);this.scaleVisibility&&"minScale"in this.layer&&this.scaleVisibility.setup(this.owner,this.layer,a,this.graphicsCore,this.owner.view.basemapTerrain);this._set("objectStates",new H.Graphics3DObjectStates(this.graphicsCore));try{await this.graphicsCore.setup({elevationAlignment:this.elevationAlignment,scaleVisibility:this.scaleVisibility,objectStates:this.objectStates})}catch(b){if(m.isAbortError(b))return;
throw b;}this.destroyed||(this.handles.add(this.view.watch("clippingArea",()=>this.updateClippingExtent(),!0)),this.updateClippingExtent(),this.setupSuspendResumeExtent(),this.graphicsCore.startCreateGraphics())};d.destroy=function(){this.handles&&(this.handles.destroy(),this.handles=null);this.watchUpdatingTracking.destroy();this.elevationAlignment&&(this.elevationAlignment.destroy(),this._set("elevationAlignment",null));this.scaleVisibility&&(this.scaleVisibility.destroy(),this._set("scaleVisibility",
null));this.objectStates&&(this.objectStates.destroy(),this._set("objectStates",null));this.graphicsCore&&(this.graphicsCore.destroy(),this._set("graphicsCore",null))};d.getGraphicFromGraphicUid=function(a){if(this.owner.loadedGraphics){const b=this.owner.loadedGraphics.find(f=>f.uid===a);if(b)return B.hydrateGraphic(b,this.layer instanceof w?this.layer:null)}};d.whenGraphicBounds=function(a,b){return this.graphicsCore?this.graphicsCore.whenGraphicBounds(a,b):m.reject()};d.computeAttachmentOrigin=
function(a,b){return this.graphicsCore?this.graphicsCore.computeAttachmentOrigin(a,b):null};d.getSymbolLayerSize=function(a,b){return this.graphicsCore?this.graphicsCore.getSymbolLayerSize(a,b):null};d.maskOccludee=function(a){const {set:b,handle:f}=this.objectStates.acquireSet(1,null);this.objectStates.setUid(b,a.uid);return f};d.highlight=function(a){if(a instanceof z)return q;if("number"===typeof a||a instanceof n)return this.highlight([a]);a instanceof u&&(a=a.toArray());if(Array.isArray(a)&&
0<a.length){if(a[0]instanceof n){a=a.map(k=>k.uid);const {set:b,handle:f}=this.objectStates.acquireSet(0,null);this.objectStates.setUids(b,a);return f}if("number"===typeof a[0]){const {set:b,handle:f}=this.objectStates.acquireSet(0,null);this.objectStates.setObjectIds(b,a);return f}}return q};d.updateClippingExtent=function(){this.graphicsCore.setClippingExtent(this.view.clippingArea,this.view.spatialReference)&&this.graphicsCore.recreateAllGraphics()};d.updateSuspendResumeExtent=function(){this.suspendResumeExtent=
C.enlargeExtent(this.graphicsCore.computedExtent,this.suspendResumeExtent,D.SUSPEND_RESUME_EXTENT_OPTIMISM,this.graphicsCore.extentPadding);this.scaleVisibility.setExtent(this.suspendResumeExtent)};d.setupSuspendResumeExtent=function(){this.scaleVisibility&&(y.init(this.graphicsCore,"computedExtent",a=>this.updateSuspendResumeExtent(),!0),this.graphicsCore.watch("extentPadding",a=>this.updateSuspendResumeExtent()))};l._createClass(h,[{key:"suspended",get:function(){return!(!this.scaleVisibility||
!this.scaleVisibility.suspended)}},{key:"updating",get:function(){return!!(this.graphicsCore&&this.graphicsCore.updating||this.scaleVisibility&&this.scaleVisibility.updating||this.watchUpdatingTracking&&this.watchUpdatingTracking.updating)}}]);return h}(t);e.__decorate([g.property({constructOnly:!0})],c.prototype,"owner",void 0);e.__decorate([g.property({constructOnly:!0})],c.prototype,"layer",void 0);e.__decorate([g.property({readOnly:!0,aliasOf:"owner.view"})],c.prototype,"view",void 0);e.__decorate([g.property({constructOnly:!0})],
c.prototype,"graphicsCore",void 0);e.__decorate([g.property({constructOnly:!0})],c.prototype,"scaleVisibility",void 0);e.__decorate([g.property({readOnly:!0})],c.prototype,"elevationAlignment",void 0);e.__decorate([g.property({readOnly:!0})],c.prototype,"objectStates",void 0);e.__decorate([g.property({readOnly:!0})],c.prototype,"watchUpdatingTracking",void 0);e.__decorate([g.property({readOnly:!0,dependsOn:["scaleVisibility.suspended"]})],c.prototype,"suspended",null);e.__decorate([g.property({readOnly:!0,
dependsOn:["graphicsCore.updating","scaleVisibility.updating","watchUpdatingTracking.updating"]})],c.prototype,"updating",null);c=e.__decorate([r.subclass("esri.views.3d.layers.graphics.Graphics3DGraphicLikeLayerView")],c);const q={remove(){},pause(){},resume(){}};return c});