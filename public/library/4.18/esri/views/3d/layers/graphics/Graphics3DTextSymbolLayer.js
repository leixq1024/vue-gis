// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.18/esri/copyright.txt for details.
//>>built
define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../core/Error ../../../../core/ObjectPool ../../../../core/screenUtils ../../../../symbols/callouts/calloutUtils ../../../../chunks/vec2f64 ../../webgl-engine/lib/GeometryData ../../webgl-engine/lib/GeometryUtil ../../webgl-engine/materials/HUDMaterial ./graphicUtils ./elevationAlignmentUtils ./ElevationAligners ./ElevationContext ./Graphics3DObject3DGraphicLayer ../../webgl-engine/lib/Geometry ./Graphics3DSymbolLayer ./pointUtils ../../webgl-engine/lib/TextRenderParameters ../../webgl-engine/lib/TextTexture".split(" "),
function(v,E,k,F,G,H,I,J,K,A,B,w,x,L,M,N,O,t,u,P,Q){function C(n,r,f){n&&n.forEach(a=>{const b=r(a);k.isSome(b)&&f(b,a.graphic)})}const R=[0,0,1];t=function(n){function r(a,b,h,c){a=n.call(this,a,b,h,c)||this;a._geometryDataPool=new G(K.GeometryData,(g,d,e)=>{const p=d.translation;e=k.isSome(e)?[e.displayWidth,e.displayHeight]:[0,0];d=d.centerOffset;0===g.indexCount?A.createPointGeometry(R,p,null,e,d,[0,0],null,g):A.updatePointGeometry(null,p,null,e,d,null,null,g)});a._elevationOptions={supportsOffsetAdjustment:!0,
supportsOnTheGround:!1};a.ensureDrapedStatus(!1);return a}E._inheritsLoose(r,n);var f=r.prototype;f.doLoad=async function(){if(!this._drivenProperties.size){const a=w.validateSymbolLayerSize(this.symbolLayer.size);if(a)throw new F("graphics3dtextsymbollayer:invalid-size",a);}this._createTextRenderParameters()};f._createTextRenderParameters=function(){this._textRenderParameters=P.TextRenderParameters.fromSymbol(this.symbolLayer,this._context.layerView.view.pixelRatio)};f.destroy=function(){n.prototype.destroy.call(this);
this._geometryDataPool.destroy()};f.createGraphics3DGraphic=function(a){a=a.graphic;const b=u.placePointOnGeometry(a.geometry);if(k.isNone(b))return this.logger.warn(`unsupported geometry type for text symbol: ${a.geometry.type}`),null;const h=this.symbolLayer.text;if(!h)return null;const c=I.isCalloutSupport(this.symbol)&&this.symbol.hasVisibleVerticalOffset()?this.symbol:null;return this._createAs3DShape(a,b,h,c)};f.onRemoveGraphic=function(a){this._geometryDataPool.release(a.stageObject.geometries[0].data)};
f.createLabel=function(a,b,h,c){a=a.graphic;const g=u.placePointOnGeometry(a.geometry);if(k.isNone(g))return this.logger.warn(`unsupported geometry type for label: ${a.geometry.type}`),null;const d=b.text;return!d||/^\s+$/.test(d)?null:this._createAs3DShape(a,g,d,b,b,h,c)};f.setGraphicElevationContext=function(a,b,h=0){a=n.prototype.setGraphicElevationContext.call(this,a,b);a.addOffsetRenderUnits(h);return a};f.layerOpacityChanged=function(){this.logger.warn("layer opacity change not yet implemented in Graphics3DTextSymbolLayer");
return!1};f.layerElevationInfoChanged=function(a,b){C(a,b,(h,c)=>{this.updateGraphicElevationContext(c,h)});return x.SymbolUpdateType.UPDATE};f.slicePlaneEnabledChanged=function(a,b){C(a,b,h=>{for(const c of h.stageObject.geometryRecords)c.material.setParameterValues({slicePlaneEnabled:this._context.slicePlaneEnabled})});return!0};f.physicalBasedRenderingChanged=function(){return!0};f.pixelRatioChanged=function(){return!1};f.updateGraphicElevationContext=function(a,b){this.setGraphicElevationContext(a,
b.elevationContext,b.metadata.elevationOffset);b.needsElevationUpdates=x.needsElevationUpdates2D(b.elevationContext.mode)||"absolute-height"===b.elevationContext.mode};f._defaultElevationInfoNoZ=function(){return S};f._createAs3DShape=function(a,b,h,c,g=T,d,e){const p=this.setGraphicElevationContext(a,new M.ElevationContext,g.elevationOffset);var m=this._context.layer.id+"_label_"+a.uid;const U="polyline"===k.get(a.geometry,"type");var y=a.uid;a=this._context.stage.renderView.renderingContext;var l=
w.namedAnchorToHUDMaterialAnchorPos[g.anchor in w.namedAnchorToHUDMaterialAnchorPos?g.anchor:"center"];a=k.isNone(e)?new Q(a,h,this._textRenderParameters,m):null;l={occlusionTest:!0,screenOffset:g.screenOffset,anchorPos:l,polygonOffset:!0,color:[1,1,1,1],centerOffsetUnits:g.centerOffsetUnits,debugDrawBorder:g.debugDrawBorder,drawInSecondSlot:!0};k.isSome(a)&&(l.textureId=a.id,l.texCoordScale=a.texcoordScale);k.isSome(e)&&(l.textureId=e.textureId);if(k.isSome(c)&&k.isSome(c.verticalOffset)){const {screenLength:q,
minWorldLength:z,maxWorldLength:D}=c.verticalOffset;l.verticalOffset={screenLength:H.pt2px(q),minWorldLength:z||0,maxWorldLength:null!=D?D:Infinity}}if(this._context.screenSizePerspectiveEnabled){const {screenSizePerspectiveSettings:q,screenSizePerspectiveSettingsLabels:z}=this._context.sharedResources;l.screenSizePerspective=z.overridePadding(this._textRenderParameters.haloSize);l.screenSizePerspectiveAlignment=q}U&&(l.shaderPolygonOffset=1E-4);l.slicePlaneEnabled=this._context.slicePlaneEnabled;
c=null;k.isSome(d)?(e=JSON.stringify(l),c=d.getMaterial(e),null==c&&(c=new B.HUDMaterial(l,m),d.addMaterial(e,c))):c=new B.HUDMaterial(l,m);c=[c];e=this._geometryDataPool.acquire(g,a);e=[new O(e,m)];m=u.createStageObjectForHUD(this._context,b,e,c,null,null,p,m,this._context.layer.uid,y);if(null===m)return null;y=L.perObjectElevationAligner;d=new N(this,m.object,e,k.isNone(d)?c:null,k.isSome(a)?[a]:null,y,p);d.alignedSampledElevation=m.sampledElevation;d.needsElevationUpdates=x.needsElevationUpdates2D(p.mode)||
"absolute-height"===p.mode;const {displayWidth:V,displayHeight:W}=k.isSome(a)?a:g;d.getScreenSize=(q=J.create())=>{q[0]=V;q[1]=W;return q};d.metadata={labelText:h,elevationOffset:g.elevationOffset};u.extendPointGraphicElevationContext(d,b,this._context.elevationProvider);return d};return r}(t.Graphics3DSymbolLayer);const S={mode:"relative-to-ground",offset:0},T={text:null,translation:[0,0,0],elevationOffset:0,centerOffset:[0,0,0,1],screenOffset:[0,0],anchor:"center",verticalOffset:null,centerOffsetUnits:null,
debugDrawBorder:!1,displayWidth:0,displayHeight:0};v.Graphics3DTextSymbolLayer=t;v.default=t;Object.defineProperty(v,"__esModule",{value:!0})});