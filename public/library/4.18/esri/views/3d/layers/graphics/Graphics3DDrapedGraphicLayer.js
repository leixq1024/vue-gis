// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.18/esri/copyright.txt for details.
//>>built
define(["../../../../chunks/vec3f64","../../../../chunks/vec3","../../../../geometry/support/aaBoundingRect","../../../../geometry/support/aaBoundingBox","./graphicUtils"],function(m,q,r,g,t){let u=function(){function n(a,b,e){this.graphics3DSymbolLayer=a;this.renderGeometries=b;this.boundingBox=e;this.type="draped";this.stage=null;this._addedToStage=this._visible=!1;this._layerView=null;this.isElevationSource=!1}var d=n.prototype;d.initialize=function(a,b,e){this.stage=a;this._layerView=e;this._overlayRenderer=
this._layerView.view.basemapTerrain.overlayManager.renderer};d.setVisibility=function(a){if(null!=this.stage&&this._visible!==a)if((this._visible=a)&&!this._addedToStage)this._addedToStage=!0,this._overlayRenderer.addGeometries(this.renderGeometries,this._layerView,1);else if(a||this._addedToStage){for(const b of this.renderGeometries)b.instanceParameters.visible=this._visible;this._overlayRenderer.updateGeometries(this.renderGeometries,this._layerView,1)}};d.destroy=function(){this.stage&&this._addedToStage&&
this._overlayRenderer.removeGeometries(this.renderGeometries,this._layerView,4);this._visible=this._addedToStage=!1;this.stage=null};d.getBSRadius=function(){return this.renderGeometries.reduce((a,b)=>Math.max(a,b.bsRadius),0)};d.getCenterObjectSpace=function(a=m.create()){return q.set(a,0,0,0)};d.getBoundingBoxObjectSpace=function(a=g.create()){return g.empty(a)};d.addObjectState=function(a,b){0===a&&(this.renderGeometries.forEach(e=>{const l=e.addHighlight();b.addRenderGeometry(e,l,this)}),this._addedToStage&&
this._overlayRenderer.updateHighlights(this.renderGeometries,this._layerView))};d.removeObjectState=function(a){this.renderGeometries.forEach(b=>{a.removeRenderGeometry(b)})};d.removeRenderGeometryObjectState=function(a,b){a.removeHighlight(b);this._addedToStage&&this._overlayRenderer.updateHighlights(this.renderGeometries,this._layerView)};d.computeAttachmentOrigin=function(a){for(const b of this.renderGeometries)b.computeAttachmentOrigin(k)&&(a.draped.origin[0]+=k[0],a.draped.origin[1]+=k[1],a.draped.num++)};
d.getProjectedBoundingBox=async function(a,b,e,l,c){g.empty(c);for(let h=0;h<this.renderGeometries.length;h++)this._getRenderGeometryProjectedBoundingRect(this.renderGeometries[h],a,p,e),g.expandWithRect(c,p);if(b){g.center(c,k);let h;a=t.demResolutionForBoundingBox(c,b);try{h=await b.service.queryElevation(k[0],k[1],l,a,"ground")}catch(v){h=null}null!=h&&(c[2]=Math.min(c[2],h),c[5]=Math.max(c[5],h))}return c};d._getRenderGeometryProjectedBoundingRect=function(a,b,e,l){if(this.boundingBox)g.set(f,
this.boundingBox);else{const c=a.center;a=a.bsRadius;f[0]=c[0]-a;f[1]=c[1]-a;f[2]=c[2]-a;f[3]=c[0]+a;f[4]=c[1]+a;f[5]=c[2]+a}b(f,0,2);this.calculateRelativeScreenBounds&&l.push({location:g.center(f),screenSpaceBoundingRect:this.calculateRelativeScreenBounds()});return g.toRect(f,e)};return n}();const p=r.create(),f=g.create(),k=m.create();return u});