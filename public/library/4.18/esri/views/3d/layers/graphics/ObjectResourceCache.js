// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.18/esri/copyright.txt for details.
//>>built
define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../core/handleUtils ../../../../core/promiseUtils ../../../../core/Handles ../../glTF/DefaultLoadingContext ../../glTF/loader ./wosrLoader".split(" "),function(m,u,n,v,d,w,x,y,z){let A=function(){function g(){this.gltfCache=new Map;this.wosrCache=new Map;this.evictHandles=new w}var h=g.prototype;h.loadGLTF=function(b,a){return this.fromCache(this.gltfCache,`gltf:${b}`,c=>y.load(new x.DefaultLoadingContext(c.streamDataRequester),
b,c),a)};h.loadWOSR=function(b,a){return this.fromCache(this.wosrCache,`wosr:${b}:${a.disableTextures}`,c=>z.load(b,c),a)};h.destroy=function(){this.evictHandles.destroy();this.gltfCache.clear();this.wosrCache.clear()};h.fromCache=function(b,a,c,p){return d.create((t,k)=>{if(d.isAborted(p))k(d.createAbortError());else{var l=d.onAbort(p,()=>{this.remove(b,a);k(d.createAbortError())}),e=b.get(a);if(e)this.evictHandles.remove(a),e.refCount++,e.item.then(t,k);else{e=d.createAbortController();var q={refCount:1,
abortController:e,item:c({...p,signal:e.signal}).then(f=>{q.abortController=null;f.remove=()=>this.remove(b,a);return f})};b.set(a,q);q.item.then(f=>{n.isSome(l)&&l.remove();t(f)},f=>{n.isSome(l)&&l.remove();k(f)})}}})};h.remove=function(b,a){const c=b.get(a);c&&(c.refCount--,0===c.refCount&&this.evictHandles.add(v.timeoutHandle(()=>{b.delete(a);n.isSome(c.abortController)&&c.abortController.abort()},r),a))};u._createClass(g,[{key:"size",get:function(){return this.wosrCache.size+this.gltfCache.size}}]);
return g}(),r=1E4;m.ObjectResourceCache=A;m.test={overrideEvictDelay(g){r=g;return{remove(){r=1E4}}}};Object.defineProperty(m,"__esModule",{value:!0})});