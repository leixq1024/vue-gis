// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.18/esri/copyright.txt for details.
//>>built
define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/has ../../../core/maybe ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/property ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../core/urlUtils ../../../core/uuid ../../../portal/support/resourceExtension ../../../core/promiseUtils ../../../core/watchUtils ./graphics/graphicUtils ./LayerView3D ../../layers/LayerView ./support/projectExtentUtils ./graphics/Graphics3DFrustumVisibility ./graphics/Graphics3DGraphicLikeLayerView".split(" "),
function(m,e,d,n,y,z,f,A,p,B,C,D,q,h,r,t,u,v,w,x){d=function(k){function g(){var a=k.apply(this,arguments)||this;a.frustumVisibility=new w;a.slicePlaneEnabled=!1;a.drapeSourceType=1;a.suspendResumeExtent=null;a.fullExtentInLocalViewSpatialReference=null;return a}m._inheritsLoose(g,k);var c=g.prototype;c.initialize=function(){this._set("graphics3d",new x({owner:this,layer:this.layer,scaleVisibilityEnabled:!0}));this.graphics3d.setup();this.frustumVisibility.setup(this);this.setupSuspendResumeExtent();
this.updatingHandles.add(this,"fullOpacity",()=>this.graphics3d.graphicsCore.opacityChange());this.handles.add(this.layer.on("graphic-update",b=>this.graphics3d.graphicsCore.graphicUpdateHandler(b)));const a=v.toViewIfLocal(this).then(b=>{this.fullExtentInLocalViewSpatialReference=b});a&&this.addResolvingPromise(a);this.handles.add(h.whenTrueOnce(this.view,"basemapTerrain.ready",()=>this.notifyChange("updating")))};c.destroy=function(){this.frustumVisibility&&(this.frustumVisibility.destroy(),this._set("frustumVisibility",
null));this.graphics3d&&(this.graphics3d.destroy(),this._set("graphics3d",null))};c.fetchPopupFeatures=async function(a,b){return n.isSome(b)?b.clientGraphics:null};c.notifyGraphicUpdate=function(a,b){this.graphics3d.graphicsCore.notifyGraphicUpdate(a,b)};c.getGraphicFromGraphicUid=function(a){return this.graphics3d.getGraphicFromGraphicUid(a)};c.whenGraphicBounds=function(a,b){return this.graphics3d.whenGraphicBounds(a,b)};c.computeAttachmentOrigin=function(a,b){return this.graphics3d?this.graphics3d.graphicsCore.computeAttachmentOrigin(a,
b):null};c.getSymbolLayerSize=function(a,b){return this.graphics3d.getSymbolLayerSize(a,b)};c.queryGraphics=function(){return q.resolve(this.loadedGraphics)};c.maskOccludee=function(a){return this.graphics3d.maskOccludee(a)};c.highlight=function(a){return this.graphics3d.highlight(a)};c.canResume=function(){var a;return k.prototype.canResume.call(this)&&!(null!=(a=this.graphics3d)&&a.suspended)};c.isUpdating=function(){return!(!(this.graphics3d&&this.graphics3d.updating||this.frustumVisibility&&this.frustumVisibility.updating)&&
this.view&&this.view.basemapTerrain&&this.view.basemapTerrain.ready)};c.setupSuspendResumeExtent=function(){const a=()=>{this.suspendResumeExtent=r.enlargeExtent(this.graphics3d.graphicsCore.computedExtent,this.suspendResumeExtent,1.2,this.graphics3d.graphicsCore.extentPadding);this.frustumVisibility.setExtent(this.suspendResumeExtent)};h.init(this.graphics3d.graphicsCore,"computedExtent",()=>a(),!0);h.watch(this.graphics3d.graphicsCore,"extentPadding",()=>a(),!0)};m._createClass(g,[{key:"legendEnabled",
get:function(){return this.canResume()&&!this.frustumVisibility.suspended}},{key:"suspendInfo",get:function(){var a,b;const l={};null!=(a=this.graphics3d.scaleVisibility)&&a.suspended&&(l.outsideScaleRange=!0);l.outsideOfView=null!=(b=this.frustumVisibility)&&b.suspended?!0:!1;return l}},{key:"graphics3DGraphics",get:function(){return this.graphics3d.graphicsCore.graphics3DGraphics}},{key:"graphics3DGraphicsByObjectID",get:function(){return this.graphics3d?this.graphics3d.graphicsCore.graphics3DGraphicsByObjectID:
null}},{key:"symbolUpdateType",get:function(){return this.graphics3d.graphicsCore.symbolUpdateType}},{key:"performanceInfo",get:function(){return{displayedNumberOfFeatures:this.loadedGraphics.length,maximumNumberOfFeatures:-1,totalNumberOfFeatures:-1,nodes:0,core:null,updating:this.updating,elevationUpdating:this.graphics3d.elevationAlignment.updating,visibilityFrustum:!this.frustumVisibility.suspended}}}]);return g}(t.LayerView3D(u));e.__decorate([f.property({aliasOf:"layer.graphics"})],d.prototype,
"loadedGraphics",void 0);e.__decorate([f.property({readOnly:!0,dependsOn:["graphics3d.suspended"]})],d.prototype,"suspended",void 0);e.__decorate([f.property({readOnly:!0,dependsOn:["graphics3d.suspended","frustumVisibility.suspended"]})],d.prototype,"legendEnabled",null);e.__decorate([f.property({readOnly:!0,dependsOn:["frustumVisibility.updating","graphics3d.updating","view.basemapTerrain.ready"]})],d.prototype,"updating",void 0);e.__decorate([f.property()],d.prototype,"layer",void 0);e.__decorate([f.property({readOnly:!0})],
d.prototype,"frustumVisibility",void 0);e.__decorate([f.property({readOnly:!0})],d.prototype,"graphics3d",void 0);e.__decorate([f.property({type:Boolean})],d.prototype,"slicePlaneEnabled",void 0);e.__decorate([f.property({readOnly:!0,dependsOn:["graphics3d.scaleVisibility.suspended","frustumVisibility.suspended"]})],d.prototype,"suspendInfo",null);return d=e.__decorate([p.subclass("esri.views.3d.layers.GraphicsLayerView3D")],d)});