// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.18/esri/copyright.txt for details.
//>>built
define("exports ../../../../geometry/SpatialReference ../../../../chunks/vec3f64 ../../../../chunks/vec3 ../../../../geometry/projection ../../../../chunks/mat4f64 ../../../../chunks/vec2f64 ../../../../chunks/vec2 ../../support/buffer/BufferView ../../../../chunks/plane ../../webgl-engine/materials/PatternMaterial".split(" "),function(x,G,l,b,M,N,z,A,O,B,P){function C(r,c,a,g,q,u,n){b.set(r,c*q[0]+a*u[0]+g*n[0],c*q[1]+a*u[1]+g*n[1],c*q[2]+a*u[2]+g*n[2])}const D=l.create(),f=l.create(),H=B.create(),
h=l.create(),e=l.create(),v=l.create(),d=z.create(),t=z.create(),m=z.create(),I=l.create(),J=l.create(),K=l.create(),p=N.create(),E=l.create(),F=l.create(),L=l.create(),y=l.create();x.createMapSpaceUVCoords=function(r,c,a,g,q,u,n=1){b.set(h,1,0,0);b.set(e,0,1,0);b.set(v,0,0,1);b.set(y,0,0,0);for(var k=0;k<c.count-1;k++)c.getVec(k,f),b.add(y,y,f);b.scale(D,y,1/(c.count-1));k=c.count-1;if(k=B.fromManyPointsSampleAt(c,H,0,Math.floor(k/3),Math.floor(2/3*k))){a.basisMatrixAtPosition(D,p);b.set(E,p[0],
p[1],p[2]);b.set(F,p[4],p[5],p[6]);b.set(L,p[8],p[9],p[10]);a=B.normal(H);0>b.dot(a,L)&&b.scale(a,a,-1);b.copy(v,a);k=b.dot(a,F);var w=b.dot(a,E);Math.abs(k)<Math.abs(w)?(b.scaleAndAdd(h,E,a,-w),b.normalize(h,h),b.cross(e,h,a),b.normalize(e,e),b.scale(e,e,-1)):(b.scaleAndAdd(e,F,a,-k),b.normalize(e,e),b.cross(h,e,a),b.normalize(h,h))}A.set(d,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY);A.set(t,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(a=0;a<c.count;a++)c.getVec(a,f),k=b.dot(h,f),
w=b.dot(e,f),d[0]=Math.min(d[0],k),d[1]=Math.min(d[1],w),t[0]=Math.max(t[0],k),t[1]=Math.max(t[1],w);a=b.dot(v,D);C(I,d[0],d[1],a,h,e,v);C(J,t[0],d[1],a,h,e,v);C(K,d[0],t[1],a,h,e,v);a=d[1]%n;m[0]=d[0]-d[0]%n;m[1]=d[1]-a;for(a=0;a<c.count;a++)c.getVec(a,f),r.setValues(a,(b.dot(h,f)-m[0])/n,(b.dot(e,f)-m[1])/n,m[0]/n,m[1]/n),g&&q&&u&&(g.setVec(a,I),q.setVec(a,J),u.setVec(a,K))};x.createMapSpaceUVCoordsDraped=function(r,c,a,g=1){if(a.isGeographic){const q=new Float64Array(c.typedBuffer.length);M.projectBuffer(c.typedBuffer,
a,0,q,G.WebMercator,0,c.count);c=O.BufferViewVec3f64.fromTypedArray(q);a=G.WebMercator}A.set(d,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY);for(a=0;a<c.count;a++)c.getVec(a,f),d[0]=Math.min(d[0],f[0]),d[1]=Math.min(d[1],f[1]);a=d[1]%g;m[0]=d[0]-d[0]%g;m[1]=d[1]-a;for(a=0;a<c.count;a++)c.getVec(a,f),r.setValues(a,(f[0]-m[0])/g,(f[1]-m[1])/g,m[0]/g,m[1]/g)};x.requiresUVUpdates=function(r){return r.material instanceof P.PatternMaterial&&!r.material.params.draped};Object.defineProperty(x,"__esModule",
{value:!0})});