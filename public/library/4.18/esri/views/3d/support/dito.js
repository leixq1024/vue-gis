// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.18/esri/copyright.txt for details.
//>>built
define(["exports"],function(ia){function M(a,b,c,g,e,f){if(!(1E-6>b[0]*b[0]+b[1]*b[1]+b[2]*b[2]))for(A(ja,c,b),A(ka,g,b),A(la,e,b),P(a,b,m),Q[1]=m[0],R[1]=m[1],Y[1]=R[1]-Q[1],c=[c,g,e],g=[ja,ka,la],e=0;3>e;++e){P(a,c[e],m);Q[0]=m[0];R[0]=m[1];P(a,g[e],m);Q[2]=m[0];R[2]=m[1];Y[0]=R[0]-Q[0];Y[2]=R[2]-Q[2];const d=ea(Y);d<f.quality&&(v(f.b0,c[e]),v(f.b1,b),v(f.b2,g[e]),f.quality=d)}}function P(a,b,c){const {data:g,offsetIdx:e,strideIdx:f}=a;c[0]=Number.POSITIVE_INFINITY;c[1]=Number.NEGATIVE_INFINITY;
for(a=e;a<g.length;a+=f){const d=g[a]*b[0]+g[a+1]*b[1]+g[a+2]*b[2];c[0]=Math.min(c[0],d);c[1]=Math.max(c[1],d)}}function ma(a,b,c){v(c.center,a);N(c.halfSize,b,.5);c.quaternion[0]=0;c.quaternion[1]=0;c.quaternion[2]=0;c.quaternion[3]=1}function na(a,b,c,g,e,f){P(a,b,m);e[0]=m[0];f[0]=m[1];P(a,c,m);e[1]=m[0];f[1]=m[1];P(a,g,m);e[2]=m[0];f[2]=m[1]}function oa(a,b,c,g,e,f,d){H[0]=a[0];H[1]=a[1];H[2]=a[2];H[3]=b[0];H[4]=b[1];H[5]=b[2];H[6]=c[0];H[7]=c[1];H[8]=c[2];var l=d.quaternion,h=H,k=h[0]+h[4]+h[8];
if(0<k)k=Math.sqrt(k+1),l[3]=.5*k,k=.5/k,l[0]=(h[5]-h[7])*k,l[1]=(h[6]-h[2])*k,l[2]=(h[1]-h[3])*k;else{k=0;h[4]>h[0]&&(k=1);h[8]>h[3*k+k]&&(k=2);const y=(k+1)%3,p=(k+2)%3;let t=Math.sqrt(h[3*k+k]-h[3*y+y]-h[3*p+p]+1);l[k]=.5*t;t=.5/t;l[3]=(h[3*y+p]-h[3*p+y])*t;l[y]=(h[3*y+k]+h[3*k+y])*t;l[p]=(h[3*p+k]+h[3*k+p])*t}Z(S,g,e);N(S,S,.5);N(d.center,a,S[0]);N(aa,b,S[1]);Z(d.center,d.center,aa);N(aa,c,S[2]);Z(d.center,d.center,aa);N(d.halfSize,f,.5)}function ea(a){return a[0]*a[1]+a[0]*a[2]+a[1]*a[2]}function Z(a,
b,c){a[0]=b[0]+c[0];a[1]=b[1]+c[1];a[2]=b[2]+c[2]}function B(a,b,c){a[0]=b[0]-c[0];a[1]=b[1]-c[1];a[2]=b[2]-c[2]}function N(a,b,c){a[0]=b[0]*c;a[1]=b[1]*c;a[2]=b[2]*c}function v(a,b,c=0){a[0]=b[c+0];a[1]=b[c+1];a[2]=b[c+2]}function A(a,b,c){const g=b[0],e=b[1];b=b[2];const f=c[0],d=c[1];c=c[2];a[0]=e*c-b*d;a[1]=b*f-g*c;a[2]=g*d-e*f}function n(a,b){var c=b[0]*b[0]+b[1]*b[1]+b[2]*b[2];0<c&&(c=1/Math.sqrt(c),a[0]=b[0]*c,a[1]=b[1]*c,a[2]=b[2]*c)}function fa(a,b){const c=b[0]-a[0],g=b[1]-a[1];a=b[2]-a[2];
return c*c+g*g+a*a}const W=[0,0,0],ba=[0,0,0],O=[0,0,0],I=[0,0,0],C=[0,0,0],D=[0,0,0],E=[0,0,0],J=[0,0,0],K=[0,0,0],L=[0,0,0],F=[0,0,0],m=[0,0],ja=[0,0,0],ka=[0,0,0],la=[0,0,0],R=[0,0,0],Q=[0,0,0],Y=[0,0,0],ha=[0,0,0],w=[0,0,0],T=[0,0,0],X=[0,0,0],U=[0,0,0],V=[0,0,0],pa=[0,0,0],aa=[0,0,0],H=[1,0,0,0,1,0,0,0,1],S=[0,0,0];let qa=function(a){this.minVert=Array(7);this.maxVert=Array(7);this.buffer=new ArrayBuffer(448);var b=0;this.minProj=new Float64Array(this.buffer,b,7);b+=56;this.maxProj=new Float64Array(this.buffer,
b,7);b+=56;for(var c=0;7>c;++c)this.minVert[c]=new Float64Array(this.buffer,b,3),b+=24;for(c=0;7>c;++c)this.maxVert[c]=new Float64Array(this.buffer,b,3),b+=24;for(b=0;7>b;++b)this.minProj[b]=Number.POSITIVE_INFINITY,this.maxProj[b]=Number.NEGATIVE_INFINITY;b=Array(7);c=Array(7);const {data:g,offsetIdx:e,strideIdx:f}=a;for(a=e;a<g.length;a+=f){var d=g[a];d<this.minProj[0]&&(this.minProj[0]=d,b[0]=a);d>this.maxProj[0]&&(this.maxProj[0]=d,c[0]=a);d=g[a+1];d<this.minProj[1]&&(this.minProj[1]=d,b[1]=a);
d>this.maxProj[1]&&(this.maxProj[1]=d,c[1]=a);d=g[a+2];d<this.minProj[2]&&(this.minProj[2]=d,b[2]=a);d>this.maxProj[2]&&(this.maxProj[2]=d,c[2]=a);d=g[a]+g[a+1]+g[a+2];d<this.minProj[3]&&(this.minProj[3]=d,b[3]=a);d>this.maxProj[3]&&(this.maxProj[3]=d,c[3]=a);d=g[a]+g[a+1]-g[a+2];d<this.minProj[4]&&(this.minProj[4]=d,b[4]=a);d>this.maxProj[4]&&(this.maxProj[4]=d,c[4]=a);d=g[a]-g[a+1]+g[a+2];d<this.minProj[5]&&(this.minProj[5]=d,b[5]=a);d>this.maxProj[5]&&(this.maxProj[5]=d,c[5]=a);d=g[a]-g[a+1]-g[a+
2];d<this.minProj[6]&&(this.minProj[6]=d,b[6]=a);d>this.maxProj[6]&&(this.maxProj[6]=d,c[6]=a)}for(a=0;7>a;++a)d=b[a],v(this.minVert[a],g,d),d=c[a],v(this.maxVert[a],g,d)},ra=function(){this.b0=[1,0,0];this.b1=[0,1,0];this.b2=[0,0,1];this.quality=0};ia.computeOBB=function(a,b){const {data:c,strideIdx:g}=a;var e=c.length/g;if(!(0>=e)){var f=new qa(a);Z(W,f.minProj,f.maxProj);N(W,W,.5);B(ba,f.maxProj,f.minProj);var d=ea(ba),l=new ra;l.quality=d;14>e&&(a={data:new Float64Array(f.buffer,112,42),size:3,
offsetIdx:0,strideIdx:3});var h=[0,0,0],k=[0,0,0],y=[0,0,0];e=[0,0,0];var p=[0,0,0],t=[0,0,0],q=[0,0,0];var x=a;var z=fa(f.maxVert[0],f.minVert[0]),u=0;for(var G=1;7>G;++G){const r=fa(f.maxVert[G],f.minVert[G]);r>z&&(z=r,u=G)}v(h,f.minVert[u]);v(k,f.maxVert[u]);if(1E-6>fa(h,k))x=1;else{B(e,h,k);n(e,e);{const {data:r,offsetIdx:ca,strideIdx:da}=x;f=Number.NEGATIVE_INFINITY;z=0;for(u=ca;u<r.length;u+=da)F[0]=r[u]-h[0],F[1]=r[u+1]-h[1],F[2]=r[u+2]-h[2],G=e[0]*F[0]+e[1]*F[1]+e[2]*F[2],G=F[0]*F[0]+F[1]*
F[1]+F[2]*F[2]-G*G/(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]),G>f&&(f=G,z=u);v(y,r,z)}1E-6>f?x=2:(B(p,k,y),n(p,p),B(t,y,h),n(t,t),A(q,p,e),n(q,q),M(x,q,e,p,t,l),x=0)}switch(x){case 1:ma(W,ba,b);return;case 2:d=a;v(w,e);Math.abs(e[0])>Math.abs(e[1])&&Math.abs(e[0])>Math.abs(e[2])?w[0]=0:Math.abs(e[1])>Math.abs(e[2])?w[1]=0:w[2]=0;1E-6>w[0]*w[0]+w[1]*w[1]+w[2]*w[2]&&(w[0]=w[1]=w[2]=1);A(T,e,w);n(T,T);A(X,e,T);n(X,X);na(d,e,T,X,U,V);B(pa,V,U);oa(e,T,X,U,V,pa,b);return}x=a;{f=m;const {data:r,offsetIdx:ca,strideIdx:da}=
x;v(I,r,ca);v(O,I);f[0]=ha[0]*q[0]+ha[1]*q[1]+ha[2]*q[2];f[1]=f[0];for(z=ca+da;z<r.length;z+=da)u=r[z]*q[0]+r[z+1]*q[1]+r[z+2]*q[2],u<f[0]&&(f[0]=u,v(I,r,z)),u>f[1]&&(f[1]=u,v(O,r,z))}q=h[0]*q[0]+h[1]*q[1]+h[2]*q[2];m[1]-1E-6<=q&&(O[0]=void 0);m[0]+1E-6>=q&&(I[0]=void 0);void 0!==O[0]&&(B(C,O,h),n(C,C),B(D,O,k),n(D,D),B(E,O,y),n(E,E),A(J,D,e),n(J,J),A(K,E,p),n(K,K),A(L,C,t),n(L,L),M(x,J,e,D,C,l),M(x,K,p,E,D,l),M(x,L,t,C,E,l));void 0!==I[0]&&(B(C,I,h),n(C,C),B(D,I,k),n(D,D),B(E,I,y),n(E,E),A(J,D,e),
n(J,J),A(K,E,p),n(K,K),A(L,C,t),n(L,L),M(x,J,e,D,C,l),M(x,K,p,E,D,l),M(x,L,t,C,E,l));na(a,l.b0,l.b1,l.b2,U,V);a=[0,0,0];B(a,V,U);l.quality=ea(a);l.quality<d?oa(l.b0,l.b1,l.b2,U,V,a,b):ma(W,ba,b)}};Object.defineProperty(ia,"__esModule",{value:!0})});