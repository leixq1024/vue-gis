// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.18/esri/copyright.txt for details.
//>>built
define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../core/screenUtils ../../../../chunks/vec3f64 ../../../../core/Handles ../../../../chunks/vec2 ./VisualElement ../../../overlay/LineOverlayItem ../../../overlay/TextOverlayItem ../measurementTools/support/viewUtils".split(" "),function(t,u,v,h,y,z,k,q,A,B,C){q=function(w){function n(a){var b=w.call(this,a.view)||this;b._handles=new z;b._textItem=null;b._calloutItem=null;b._showCallout=!0;b._showText=!0;b._geometry=
null;b._text=null;b._fontSize=14;b._distance=25;b._anchor="right";b.applyProps(a);return b}u._inheritsLoose(n,w);var g=n.prototype;g._updateLabelPosition=function(){if(this.attached&&v.isSome(this.geometry)&&this.view._stage)switch(this.geometry.type){case "point":this._computeLabelPositionFromPoint(this.geometry,e)?(this._textItem.position=[e[0],e[1]],this._textItem.anchor="center",this._showText=!0):this._showText=!1;this._showCallout=!1;break;case "euclidean":case "geodesic":if(this._computeLabelPositionFromSegment(this.geometry,
this._distance,this._anchor,e,f)){const a=f[0]-e[0],b=f[1]-e[1];this._textItem.position=[f[0],f[1]];this._textItem.anchor=Math.abs(a)>Math.abs(b)?0<a?"left":"right":0<b?"top":"bottom";this._textItem.visible=this.visible;this._calloutItem.startPosition=[e[0],e[1]];this._calloutItem.endPosition=[f[0],f[1]];this._showCallout=this._showText=!0}else this._showCallout=this._showText=!1}this.updateVisibility(this.visible)};g._computeLabelPositionFromPoint=function(a,b){this.view.renderCoordsHelper.toRenderCoords(a,
p);a=this.view._stage.getCamera();a.projectToRenderScreen(p,d);if(0>d[2]||1<d[2])return!1;a.renderToScreen(d,b);return!0};g._computeLabelPositionFromSegment=function(a,b,x,D,E){if(!a)return!1;const l=this.view._stage.getCamera();C.screenSpaceTangent(a.startRenderSpace,a.endRenderSpace,r,l);k.set(c,-r[1],r[0]);let m=!1;switch(x){case "top":m=0>c[1];break;case "bottom":m=0<c[1];break;case "left":m=0<c[0];break;case "right":m=0>c[0]}m&&k.negate(c,c);if(0===k.length(c))switch(x){case "top":c[1]=1;break;
case "bottom":c[1]=-1;break;case "left":c[0]=-1;break;case "right":c[0]=1}a.eval(.5,p);l.projectToRenderScreen(p,d);if(0>d[2]||1<d[2])return!1;l.renderToScreen(d,D);k.scale(c,c,b*l.pixelRatio);k.add(c,c,d);l.renderToScreen(c,E);return!0};g.createResources=function(){this._textItem=new B({visible:!0});this._textItem.text=v.unwrap(this._text);this._textItem.fontSize=this._fontSize;this._calloutItem=new A({visible:!0,width:2});this._updateLabelPosition();this.view.overlay.items.addMany([this._textItem,
this._calloutItem]);this._handles.add(this.view.state.watch("camera",()=>{this._updateLabelPosition()}))};g.destroyResources=function(){this.view.overlay&&!this.view.overlay.destroyed&&this.view.overlay.items.removeMany([this._textItem,this._calloutItem]);this._handles.removeAll()};g.updateVisibility=function(a){this._textItem.visible=this._showText&&a;this._calloutItem.visible=this._showCallout&&a};u._createClass(n,[{key:"geometry",get:function(){return this._geometry},set:function(a){this._geometry=
a;this._updateLabelPosition()}},{key:"textItem",get:function(){return this._textItem}},{key:"text",get:function(){return this._text},set:function(a){this._text=a;this.attached&&(this._textItem.text=this._text)}},{key:"fontSize",get:function(){return this._fontSize},set:function(a){this._fontSize=a;this.attached&&(this._textItem.fontSize=this._fontSize)}},{key:"distance",get:function(){return this._distance},set:function(a){this._distance!==a&&(this._distance=a,this._updateLabelPosition())}},{key:"anchor",
get:function(){return this._anchor},set:function(a){this._anchor!==a&&(this._anchor=a,this._updateLabelPosition())}}]);return n}(q.VisualElement);const r=h.createRenderScreenPointArray(),c=h.createRenderScreenPointArray(),p=y.create(),d=h.createRenderScreenPointArray3(),e=h.createScreenPointArray(),f=h.createScreenPointArray();t.LabelVisualElement=q;Object.defineProperty(t,"__esModule",{value:!0})});