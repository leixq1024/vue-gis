// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.18/esri/copyright.txt for details.
//>>built
define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../core/Evented ../../../../chunks/vec3f64 ../../../../chunks/vec3 ../../../../geometry/projection ../../../../chunks/vec4 ../../../../geometry/support/aaBoundingBox ../../../../layers/graphics/dehydratedFeatures ../../webgl-engine/lib/geometryDataUtils ../../layers/graphics/ElevationContext ../../webgl-engine/lib/Geometry ../../webgl-engine/shaders/RibbonLineTechnique ../../webgl-engine/materials/RibbonLineMaterial ../../webgl-engine/lib/RenderGeometry ../../layers/graphics/lineUtils ../../../../chunks/vec4f32 ./LaserlineVisualElement ./VisualElementResources ./DrapedVisualElementResources".split(" "),
function(t,x,f,y,u,l,z,k,m,A,B,C,D,E,v,F,n,q,G,H,I){let K=function(){function r(a){this.view=null;this._attachmentOrigin=A.makeDehydratedPoint(0,0,0,null);this._attachmentOriginDirty=!0;this.events=new y;this._isDraped=!1;this._geometry=null;this._width=1;this._color=q.fromValues(1,0,1,1);this._innerWidth=0;this._innerColor=q.fromValues(1,1,1,1);this._stippleOffColor=this._stipplePattern=null;this._falloff=0;this._laserlineStyle=this._elevationInfo=null;this._laserlineEnabled=!1;this._renderOccluded=
8;this.resources=new H.VisualElementResources({view:a.view,createResources:b=>this.createResources(b),recreateGeometry:(b,e)=>{b.geometries.length=0;this.recreateGeometry(e,b.material,b.geometries);return b.geometries}});this._attachmentOrigin.spatialReference=a.view.spatialReference;this.drapedResources=new I.DrapedVisualElementResources({view:a.view,createResources:()=>this.createDrapedResources(),recreateGeometry:b=>{b.geometries=this.createRenderGeometriesDraped(b.material);this.attachmentOriginChanged()}});
let c=!0;this._laserline=new G.LaserlineVisualElement({view:a.view});for(const b in a)b in this?"attached"===b?c=a[b]:this[b]=a[b]:console.error("Cannot set unknown property",b);this.attached=c}var g=r.prototype;g.destroy=function(){this.resources.destroy();this.drapedResources.destroy();this._laserline.destroy()};g.updateAttached=function(a){this.resources.attached=!this.isDraped&&a;this.drapedResources.attached=this.isDraped&&a;this._laserline.attached=this.laserlineAttached;this.attached&&this.attachmentOriginChanged()};
g.updateMaterial=function(){f.isSome(this.resources.resources)&&this.resources.resources.material.setParameterValues(this.materialParameters);f.isSome(this.drapedResources.resources)&&this.drapedResources.resources.material.setParameterValues(this.materialParameters)};g.recreateGeometry=function(a,c,b){const e=this.createRenderGeometries();for(const d of e)a.addGeometry(d,c),b.push(d);this.attachmentOriginChanged()};g.attachmentOriginChanged=function(){this._attachmentOriginDirty=!0;this.events.emit("attachment-origin-changed")};
g.createResources=function(a){const c=new v.RibbonLineMaterial(this.materialParameters,"lineVisualElement"),b=[];this.recreateGeometry(a,c,b);return{material:c,geometries:b,forEach:e=>{e(c);b.forEach(e)}}};g.createDrapedResources=function(){const a=new v.RibbonLineMaterial(this.materialParameters,"lineVisualElement"),c=this.createRenderGeometriesDraped(a);return{material:a,geometries:c}};g.createRenderGeometriesDraped=function(a){var c=this.geometry;if(f.isNone(c))return[];var b=n.geometryToRenderInfoDraped(c,
this.view.basemapTerrain.spatialReference);c=[];for(const {position:e}of b.lines){b=new F(n.createGeometryData({attributeData:{position:e},removeDuplicateStartEnd:this.isClosed?1:0}));b.material=a;const d=m.empty(J);m.expandWithBuffer(d,e);l.set(b.center,.5*(d[0]+d[3]),.5*(d[1]+d[4]),0);b.bsRadius=.5*Math.sqrt((d[3]-d[0])*(d[3]-d[0])+(d[4]-d[1])*(d[4]-d[1]));c.push(b)}return c};g.calculateMapBounds=function(a){if(f.isNone(this.resources.resources))return!1;const c=this.view.renderCoordsHelper;for(const b of this.resources.resources.geometries){const e=
b.data.getAttribute("position"),d=e.data,p=new Float64Array(d.length);z.projectBuffer(e.data,c.spatialReference,0,p,this.view.spatialReference,0,d.length/3);m.expandWithBuffer(a,p)}return!0};g.createRenderGeometries=function(){var a=this.geometry;if(f.isNone(a))return[];var c=n.geometryToRenderInfo(a,this.view.elevationProvider,this.view.renderCoordsHelper,C.ElevationContext.fromElevationInfo(this.elevationInfo));a=[];const b=[];for(const {position:e,mapPosition:d}of c.lines)c=n.createGeometryData({attributeData:{position:e,
mapPosition:d},removeDuplicateStartEnd:this.isClosed?1:0}),a.push(new D(c,"geometryOutlineVisualElement")),b.push(e);this._laserline.pathVerticalPlane=b;return a};x._createClass(r,[{key:"isDraped",get:function(){return this._isDraped},set:function(a){a!==this._isDraped&&(this._isDraped=a,this.updateAttached(this.attached),this._laserline.attached=this.laserlineAttached)}},{key:"laserlineAttached",get:function(){return this.attached&&this.visible&&f.isSome(this._laserlineStyle)&&!this.isDraped&&this.laserlineEnabled}},
{key:"visible",get:function(){return this.resources.visible},set:function(a){this.resources.visible=a;this.drapedResources.visible=a;this._laserline.attached=this.laserlineAttached}},{key:"attached",get:function(){return this.resources.attached||this.drapedResources.attached},set:function(a){this.updateAttached(a)}},{key:"geometry",get:function(){return this._geometry},set:function(a){this._geometry=a;this.resources.recreateGeometry();this.drapedResources.recreateGeometry()}},{key:"width",get:function(){return this._width},
set:function(a){a!==this._width&&(this._width=a,this.updateMaterial())}},{key:"color",get:function(){return this._color},set:function(a){k.exactEquals(a,this._color)||(k.copy(this._color,a),this.updateMaterial())}},{key:"innerWidth",get:function(){return this._innerWidth},set:function(a){a!==this._innerWidth&&(this._innerWidth=a,this.updateMaterial())}},{key:"innerColor",get:function(){return this._innerColor},set:function(a){k.exactEquals(a,this._innerColor)||(k.copy(this._innerColor,a),this.updateMaterial())}},
{key:"stipplePattern",get:function(){return this._stipplePattern},set:function(a){const c=f.isSome(a)!==f.isSome(this._stipplePattern);this._stipplePattern=a;c?this.resources.recreate():this.updateMaterial()}},{key:"stippleOffColor",get:function(){return this._stippleOffColor},set:function(a){a&&this._stippleOffColor&&k.exactEquals(a,this._stippleOffColor)||(this._stippleOffColor=a?q.clone(a):null,this.updateMaterial())}},{key:"falloff",get:function(){return this._falloff},set:function(a){a!==this._falloff&&
(this._falloff=a,this.updateMaterial())}},{key:"elevationInfo",get:function(){return this._elevationInfo},set:function(a){this._elevationInfo=a;this.resources.recreateGeometry()}},{key:"laserlineStyle",get:function(){return this._laserlineStyle},set:function(a){this._laserlineStyle=a;this._laserline.attached=this.laserlineAttached;f.isSome(a)&&(this._laserline.style=a)}},{key:"laserlineEnabled",get:function(){return this._laserlineEnabled},set:function(a){this._laserlineEnabled!==a&&(this._laserlineEnabled=
a,this._laserline.attached=this.laserlineAttached)}},{key:"renderOccluded",get:function(){return this._renderOccluded},set:function(a){a!==this._renderOccluded&&(this._renderOccluded=a,this.updateMaterial())}},{key:"attachmentOrigin",get:function(){if(!this._attachmentOriginDirty)return this._attachmentOrigin;var a=f.isSome(this.resources.resources)?this.resources.resources.geometries:null;if(!a||0===a.length)return null;l.set(h,0,0,0);const c=E.RibbonVertexAttributeConstants.POSITION;let b=0;for(const e of a){a=
e.getAttribute(c);const d=e.getIndices(c),p=f.unwrap(this.resources.resources).material.isClosed(a.data,d);B.computeAttachmentOriginLines(a,d,p,w)&&(l.add(h,h,w),b++)}if(0===b)return null;l.scale(h,h,1/b);this.view.renderCoordsHelper.fromRenderCoords(h,this._attachmentOrigin);this._attachmentOriginDirty=!1;return this._attachmentOrigin}},{key:"isClosed",get:function(){return f.isSome(this.geometry)&&"polygon"===this.geometry.type}},{key:"materialParameters",get:function(){return{width:this._width,
color:this._color,stippleOffColor:this._stippleOffColor,stipplePattern:this._stipplePattern,isClosed:this.isClosed,falloff:this._falloff,innerColor:this._innerColor,innerWidth:this._innerWidth,join:"round",stippleIntegerRepeats:!0,polygonOffset:!0,renderOccluded:this.normalizedRenderOccluded}}},{key:"normalizedRenderOccluded",get:function(){return this.isDraped&&8===this._renderOccluded?4:this._renderOccluded}}]);return r}();const J=m.create(),w=u.create(),h=u.create();t.OutlineVisualElement=K;Object.defineProperty(t,
"__esModule",{value:!0})});