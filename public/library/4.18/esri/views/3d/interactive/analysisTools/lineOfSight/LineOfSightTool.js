// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.18/esri/copyright.txt for details.
//>>built
define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/has ../../../../../core/maybe ../../../../../core/Logger ../../../../../core/accessorSupport/ensureType ../../../../../core/accessorSupport/decorators/property ../../../../../core/jsonMap ../../../../../core/accessorSupport/decorators/subclass ../../../../../core/urlUtils ../../../../../core/uuid ../../../../../portal/support/resourceExtension ../../../../../geometry/Point ../../../../../core/Collection ../../../../../Color ../../../../../core/screenUtils ../../../../../chunks/vec3f64 ../../../../../chunks/vec3 ../../../../../core/Handles ../../../../../core/watchUtils ../../../../support/Scheduler ../../../../../chunks/mat4f64 ../../../../../layers/graphics/dehydratedFeatures ../../../support/stack ../../../../../chunks/ray ../../../support/geometryUtils ../../../webgl-engine/lib/Object3D ../../../webgl-engine/lib/Intersector ../../../webgl-engine/lib/Layer ../../../terrain/tileUtils ../../../../interactive/dragEventPipeline ../../../support/LaserLineRenderer ../../../../interactive/InteractiveToolBase ./lineOfSightToolConfig ./lineOfSightToolUtils ../../../../../widgets/LineOfSight/LineOfSightTarget".split(" "),
function(n,J,w,da,g,ea,fa,y,ha,Q,ia,ja,ka,D,K,L,R,t,f,M,A,p,S,T,U,C,N,V,W,X,Y,Z,aa,ba,O,q,G){const H=K.ofType(G);n.LineOfSightTool=function(P){function E(a){a=P.call(this,a)||this;a.deferCreation=!0;a.observer=null;a.targets=new H;a.configuration=null;a.updating=!1;a._handles=new M;a._manipulatorHandles=new M;a._observer=null;a._tracker=null;a._analyses=new K;a._screenPixelSize=0;a._grabbedManipulator=null;a._showTracker=!0;return a}J._inheritsLoose(E,P);var e=E.prototype;e.initialize=function(){var a=
A.init(this,"state",d=>{switch(d){case "created":this.complete();break;default:this.create()}},!0),b=this.configuration=new O.Configuration;this._intersector=new W.Intersector(this.view.state.mode);this._intersector.options.hud=!1;this._intersector.options.store=0;this._engineLayer=new X("line-of-sight-analysis",{isPickable:!1});const c=this.view._stage;c.addToViewContent([this._engineLayer.id]);c.add(0,this._engineLayer);this._createEngineResources();this._observer={location:null,intersection:null,
manipulator:this._addManipulator({size:b.observerManipulatorSize,color:b.observerManipulatorColor,visible:!1})};this._tracker=this._createLineOfSightAnalysis(new G({location:new D}));this._tracker.point.manipulator.available=!1;this._tracker.point.manipulator.interactive=!1;b=this._handles;b.add([a,this.view.state.watch("camera",()=>this._onCameraChange()),this.view.watch("map.ground.opacity",(d,m)=>this._onGroundOpacityChange(d,m)),A.init(this.view,"slicePlane",()=>this._onSlicePlaneChange()),A.init(this,
"observer",d=>this._onObserverChange(d),!0),A.on(this,"targets","change",d=>this._onTargetCollectionChange(d),d=>this._onTargetsChange(d),null,!0),A.watch(this.configuration,"laserLineEnabled laserLineGlowColor laserLineGlowWidth laserLineInnerColor laserLineInnerWidth laserLineGlobalAlpha lineOfSightInnerWidth lineOfSightOuterWidth lineOfSightVisibleInnerColor lineOfSightVisibleOuterColor lineOfSightOccludedInnerColor lineOfSightOccludedOuterColor lineOfSightUndefinedInnerColor lineOfSightUndefinedOuterColor lineOfSightUndefinedStipplePattern lineOfSightUndefinedStipplePatternOffColor".split(" "),
()=>this._createEngineResources()),A.watch(this.configuration,["observerManipulatorSize","observerManipulatorColor"],()=>this._recreateManipulator(this._observer)),A.watch(this.configuration,["targetManipulatorSize","targetManipulatorVisibleColor","targetManipulatorOccludedColor","targetManipulatorUndefinedColor"],()=>this._analyses.forEach(d=>this._recreateManipulator(d.point)))]);(a=this.view.pointsOfInterest)&&b.add([a.contentGeometryUpdates.events.on("request-update",()=>this._onContentChange()),
this.view.elevationProvider.on("elevation-change",()=>this._onContentChange())]);if(a=this.view.resourceController&&this.view.resourceController.scheduler)this._frameTask=a.registerTask(p.Task.LINE_OF_SIGHT_TOOL,d=>this._updateAnalyses(d),()=>this.updating),b.add(this._frameTask);this.continue()};e.destroy=function(){this.detach();this._handles.destroy();this._handles=null;this._manipulatorHandles.destroy();this._manipulatorHandles=null;this.manipulators.remove(this._observer.manipulator);this._destroyLineOfSightAnalysis(this._tracker);
this._analyses.forEach(b=>{this._destroyLineOfSightAnalysis(b)});const a=this.view._stage;a.removeFromViewContent([this._engineLayer.id]);a.remove(0,this._engineLayer.id);this._removeEngineResources();this._engineLayer=null;a.removeRenderPlugin(this._engineResources.laserLineRenderer);this.observer=this._intersector=this._engineResources=this._engineResources.laserLineRenderer=null;this._set("targets",null)};e.continue=function(){this.view.activeTool=this;this._showTracker=!0;this._updateTrackerVisibility()};
e.stop=function(){this._showTracker=!1;this._setDirty(p.Task.LINE_OF_SIGHT_TOOL_INTERACTIVE);this._updateTrackerVisibility()};e.onInputEvent=function(a){switch(a.type){case "immediate-double-click":this._doubleClickHandler(a);break;case "key-down":this._keyDownHandler(a);break;case "pointer-move":this._pointerMoveHandler(a)}};e.onInputEventAfter=function(a){switch(a.type){case "immediate-click":this._clickHandler(a)}};e._setDirty=function(a){this.updating?a===p.Task.LINE_OF_SIGHT_TOOL_INTERACTIVE&&
this._frameTask&&(this._frameTask.task=a):(this._set("updating",!0),this._frameTask&&(this._frameTask.task=a))};e._updateTrackerVisibility=function(){this._tracker.shouldRender=this._showTracker&&!this.manipulators.some(a=>a.manipulator.focused);this._updateLaserLineRenderer()};e._manipulatorFocusChanged=function(){this._updateTrackerVisibility();this.notifyChange("cursor")};e._addManipulator=function(a){const b=q.createSphereManipulator(this.view,a);this._manipulatorHandles.add([this._createManipulatorDragPipeline(b),
b.events.on("focus-changed",()=>this._manipulatorFocusChanged()),b.events.on("grab-changed",c=>this._manipulatorGrabChanged(b,c)),b.events.on("immediate-click",c=>c.stopPropagation())],b);this.manipulators.add(b);return b};e._removeManipulator=function(a){this.manipulators.remove(a);this._manipulatorHandles.remove(a)};e._recreateManipulator=function(a){const b=this.configuration,c=a.manipulator;this._removeManipulator(c);a.manipulator=this._addManipulator(a===this._observer?{size:b.observerManipulatorSize,
color:b.observerManipulatorColor,visible:c.available}:{size:b.targetManipulatorSize,customColor1:b.targetManipulatorVisibleColor,customColor2:b.targetManipulatorOccludedColor,customColor3:b.targetManipulatorUndefinedColor});a.manipulator.location=c.location;this._setDirty(p.Task.LINE_OF_SIGHT_TOOL_INTERACTIVE)};e._screenToIntersection=function(){return a=>{const b=this._getScreenPointIntersection(a.screenEnd);return g.isNone(b)?null:{...a,intersection:b}}};e._createManipulatorDragPipeline=function(a){return Z.createManipulatorDragEventPipeline(a,
(b,c,d)=>{c.next(this._screenToIntersection()).next(a===this._observer.manipulator?this._updateObserverDragStep():this._updateAnalysisDragStep(a)).next(()=>this._updateLaserLineRenderer());d.next(a===this._observer.manipulator?this._cancelObserverDragStep():this._cancelAnalysisDragStep(a)).next(()=>this._updateLaserLineRenderer())})};e._updateObserverDragStep=function(){return a=>{this.observer=a.intersection.point;this._observer.intersection=a.intersection;return a}};e._cancelObserverDragStep=function(){const a=
g.isSome(this.observer)?this.observer.clone():null,b=this._observer.intersection;return c=>{this.observer=a;this._observer.intersection=b;return c}};e._updateAnalysisDragStep=function(a){return b=>{const c=this._analyses.find(d=>d.point.manipulator===a);c.target.location=b.intersection.point;c.point.intersection=b.intersection;return b}};e._cancelAnalysisDragStep=function(a){const b=this._analyses.find(m=>m.point.manipulator===a),c=g.isSome(b.target.location)?b.target.location.clone():null,d=b.point.intersection;
return m=>{b.target.location=c;b.point.intersection=d;return m}};e._updateLaserLineRenderer=function(){const a=this._engineResources.laserLineRenderer;if(this.configuration.laserLineEnabled){var b=g.isSome(this._grabbedManipulator)?this._grabbedManipulator:this._tracker.shouldRender&&this.observer?this._tracker.point.manipulator:null;this.configuration.laserLineEnabled&&g.isSome(b)?(a.heightManifoldEnabled=!0,a.heightManifoldTarget=b.renderLocation,b!==this._observer.manipulator?(a.lineVerticalPlaneEnabled=
!0,a.lineVerticalPlaneSegment=N.lineSegment.fromPoints(this._observer.manipulator.renderLocation,b.renderLocation,ca)):a.lineVerticalPlaneEnabled=!1):(a.heightManifoldEnabled=!1,a.lineVerticalPlaneEnabled=!1)}else a.heightManifoldEnabled=!1,a.lineVerticalPlaneEnabled=!1};e._createLaserLineRenderer=function(){const a=this.configuration;return new aa.LaserLineRenderer(this.view.renderCoordsHelper,{glowColor:L.toUnitRGB(a.laserLineGlowColor),glowWidth:a.laserLineGlowWidth,innerColor:L.toUnitRGB(a.laserLineInnerColor),
innerWidth:a.laserLineInnerWidth,globalAlpha:a.laserLineGlobalAlpha})};e._removeEngineResources=function(){const a=this.view._stage;a.remove(3,this._engineResources.visibleLineMaterialInner.id);a.remove(3,this._engineResources.visibleLineMaterialOuter.id);a.remove(3,this._engineResources.occludedLineMaterialInner.id);a.remove(3,this._engineResources.occludedLineMaterialOuter.id);a.remove(3,this._engineResources.undefinedLineMaterialInner.id);a.remove(3,this._engineResources.undefinedLineMaterialOuter.id)};
e._createEngineResources=function(){const a=this.view._stage,b=this.configuration;this._engineResources&&(this._removeEngineResources(),a.removeRenderPlugin(this._engineResources.laserLineRenderer));this._engineResources={laserLineRenderer:this._createLaserLineRenderer(),visibleLineMaterialInner:q.createPolylineMaterial(b.lineOfSightInnerWidth,b.lineOfSightVisibleInnerColor),visibleLineMaterialOuter:q.createPolylineMaterial(b.lineOfSightOuterWidth,b.lineOfSightVisibleOuterColor),occludedLineMaterialInner:q.createPolylineMaterial(b.lineOfSightInnerWidth,
b.lineOfSightOccludedInnerColor),occludedLineMaterialOuter:q.createPolylineMaterial(b.lineOfSightOuterWidth,b.lineOfSightOccludedOuterColor),undefinedLineMaterialInner:q.createPolylineMaterial(b.lineOfSightInnerWidth,b.lineOfSightUndefinedInnerColor),undefinedLineMaterialOuter:q.createPolylineMaterial(b.lineOfSightOuterWidth,b.lineOfSightUndefinedOuterColor)};a.addRenderPlugin(this._engineResources.laserLineRenderer.renderSlots,this._engineResources.laserLineRenderer);a.add(3,this._engineResources.visibleLineMaterialInner);
a.add(3,this._engineResources.visibleLineMaterialOuter);a.add(3,this._engineResources.occludedLineMaterialInner);a.add(3,this._engineResources.occludedLineMaterialOuter);a.add(3,this._engineResources.undefinedLineMaterialInner);a.add(3,this._engineResources.undefinedLineMaterialOuter);this._setDirty(p.Task.LINE_OF_SIGHT_TOOL_INTERACTIVE)};e._onObserverChange=function(a){g.isNone(a)?(this._observer.manipulator.available=!1,this.targets.removeAll()):(this._observer.location=a,this._observer.intersection=
null,this._observer.manipulator.available=!0,this._observer.manipulator.location=a,this._tracker.point.manipulator.location=a,this._analyses.forEach(b=>{b.isDirty=!0;b.isValid=!1}),this._setDirty(p.Task.LINE_OF_SIGHT_TOOL_INTERACTIVE))};e._onTargetsChange=function(a){this._analyses.forEach(b=>{this._destroyLineOfSightAnalysis(b)});this._analyses.removeAll();a.items&&this._onTargetCollectionChange({target:a,added:a.items,removed:[],moved:[]})};e._onTargetCollectionChange=function(a){a.added.forEach(b=>
{if(!this._analyses.some(c=>c.target===b)){const c=this._createLineOfSightAnalysis(b);this._analyses.add(c)}this._setDirty(p.Task.LINE_OF_SIGHT_TOOL_INTERACTIVE)});a.removed.forEach(b=>{const c=this._analyses.find(d=>d.point.location===b.location);this._destroyLineOfSightAnalysis(c);this._analyses.remove(c)})};e._onTargetLocationChange=function(a,b){a.isValid=!1;a.point.location=b;a.point.intersection=null;a.point.manipulator.location=b;a.isDirty=!0;this._setDirty(p.Task.LINE_OF_SIGHT_TOOL_INTERACTIVE)};
e._onGroundOpacityChange=function(a,b){!this._analyses.length||1!==a&&1!==b||a===b||(this._setDirty(p.Task.LINE_OF_SIGHT_TOOL),this._analyses.forEach(c=>c.isDirty=!0))};e._onContentChange=function(){this._analyses.forEach(a=>{a.isDirty=!0;a.shouldIntersect=!0});this._setDirty(p.Task.LINE_OF_SIGHT_TOOL)};e._onCameraChange=function(){if(this._analyses.length){var a=!1;if(g.isSome(this.observer)){this.view.renderCoordsHelper.toRenderCoords(this.observer,x);const b=this.view.state.camera.computeScreenPixelSizeAt(x);
a=a||.1<Math.abs((b-this._screenPixelSize)/this._screenPixelSize)}this._analyses.some(b=>!b.isValid)&&(a=!0);a&&(this._setDirty(p.Task.LINE_OF_SIGHT_TOOL),this._analyses.forEach(b=>b.isDirty=!0))}};e._onSlicePlaneChange=function(){this._analyses.length&&(this._setDirty(p.Task.LINE_OF_SIGHT_TOOL_INTERACTIVE),this._analyses.forEach(a=>a.isDirty=!0))};e._addPointFromClickEvent=function(a){a=this._getScreenPointIntersection(a);if(!g.isNone(a)&&!g.isNone(a.point))if(this.observer){const b=new G({location:a.point}),
c=this._createLineOfSightAnalysis(b);this._analyses.add(c);c.point.intersection=a;this.targets.add(b)}else this.observer=a.point,this._observer.intersection=a};e._clickHandler=function(a){this._showTracker&&(this._addPointFromClickEvent({x:a.x,y:a.y}),a.stopPropagation())};e._doubleClickHandler=function(a){this._showTracker&&(this.stop(),a.stopPropagation())};e._keyDownHandler=function(a){this._showTracker&&"Escape"===a.key&&(this.stop(),a.stopPropagation())};e._pointerMoveHandler=function(a){this._showTracker&&
(a=this._getScreenPointIntersection({x:a.x,y:a.y}),g.isSome(a)&&g.isSome(a.point)&&(this._tracker.point.manipulator.location=a.point,this._tracker.isDirty=!0,this._updateLaserLineRenderer(),this._setDirty(p.Task.LINE_OF_SIGHT_TOOL_INTERACTIVE)))};e._getScreenPointIntersection=function(a){a=R.screenPointObjectToArray(a,U.sv2d.get());a=C.fromScreen(this.view.state.camera,a,F);return this._getRayIntersection(a)};e._getRayIntersection=function(a){if(g.isNone(a))return null;this.view.sceneIntersectionHelper.intersectToolIntersectorRay(a,
this._intersector);var b=this._intersector.results.min;if(!b||!b.getIntersectionPoint(x))return null;const c=new D;this.view.renderCoordsHelper.fromRenderCoords(x,c,this.view.spatialReference);const d=t.create();f.copy(d,b.normal);var m=0<f.dot(d,a.direction)?-1:1;f.scale(d,d,m);const k=b.toGraphic(this.view);if(g.isSome(k)){m=k.layer;const v=k.sourceLayer;if(v)switch(v.type){case "scene":b=T.getObjectId(k,v.objectIdField);break;case "integrated-mesh":b=b.target;b=`${b.metadata.nodeIndex}/${b.metadata.componentIndex}`;
break;default:b=k.uid}else b=k.uid;return{type:"Graphic",id:`${m.uid}/${b}`,ray:C.copy(a),normal:d,point:c}}return"TerrainRenderer"===b.intersector?{type:"Terrain",id:b.target.metadata.tile.lij.slice(),ray:C.copy(a),normal:d,point:c}:null};e._createLineOfSightAnalysis=function(a){const b=this.configuration,c={isValid:!1,isDirty:!0,shouldRender:!0,shouldIntersect:!1,point:{location:a.location,manipulator:this._addManipulator({size:b.targetManipulatorSize,customColor1:b.targetManipulatorVisibleColor,
customColor2:b.targetManipulatorOccludedColor,customColor3:b.targetManipulatorUndefinedColor}),intersection:null},isTargetVisible:!1,hasIntersection:!1,target:a,targetHandle:null,engine:{points:{observer:t.create(),target:t.create(),intersection:t.create(),intersectionObserver:t.create(),intersectionTarget:t.create()},visualization:new V}};g.isSome(a.location)&&(c.point.manipulator.location=a.location);c.targetHandle=A.init(a,"location",d=>this._onTargetLocationChange(c,d),!0);this.manipulators.add(c.point.manipulator);
this.view._stage.add(1,c.engine.visualization);this._engineLayer.addObject(c.engine.visualization);return c};e._destroyLineOfSightAnalysis=function(a){a.targetHandle.remove();this.manipulators.remove(a.point.manipulator);this.view._stage.remove(1,a.engine.visualization.id);this._engineLayer.removeObject(a.engine.visualization)};e._canComputeAnalysis=function(a){if(g.isNone(this.observer)||g.isNone(a.point)||g.isNone(a.point.location))return!1;this.view.renderCoordsHelper.toRenderCoords(this.observer,
x);const b=this.view.frustum.intersectsPoint(x);this.view.renderCoordsHelper.toRenderCoords(a.point.location,x);a=this.view.frustum.intersectsPoint(x);return b&&a};e._manipulatorGrabChanged=function(a,b){switch(b.action){case "start":this._grabbedManipulator=a;break;case "end":this._grabbedManipulator===a&&(this._grabbedManipulator=null)}this._updateTrackerVisibility()};e._canUpdateFromIntersectionResult=function(a,b){return g.isNone(a)||!b||a.type!==b.type?!1:"Terrain"===a.type?(a=a.id,b=b.id,a[0]===
b[0]&&a[1]===b[1]&&a[2]===b[2]||Y.tilesAreRelated(a,b)):"Graphic"===a.type||"I3S"===a.type?a.id===b.id:!1};e._updateFromIntersectionResult=function(a){if("Terrain"===a.type&&g.isSome(a.point)){this.view.renderCoordsHelper.toRenderCoords(a.point,l);this.view.renderCoordsHelper.worldUpAtPosition(l,h);var b=this.view.basemapTerrain.elevationBounds;var c=this.view.renderCoordsHelper.getAltitude(l);b=b?Math.abs(b.max-b.min)/Math.abs(c):100;c=0<c?1:-1;f.normalize(h,h);f.scale(h,h,c*b);f.add(r,l,h);C.fromPoints(r,
l,F);c=this._getRayIntersection(F)}else c=this._getRayIntersection(a.ray);return this._canUpdateFromIntersectionResult(c,a)?c.point:null};e._updateAnalyses=function(a){if(this.observer){if(this._analyses.some(c=>c.shouldIntersect)){var b=this._observer.intersection;b=b&&this._updateFromIntersectionResult(b);g.isSome(b)&&(this._observer.manipulator.location=b)}this._set("updating",this._updateAnalysis(this._tracker,"tracker")||this._analyses.items.some((c,d)=>this._updateAnalysis(c,`${d}`,a)))}else this._set("updating",
!1)};e._updateAnalysis=function(a,b,c){if(!a.shouldRender)return a.engine.visualization.removeAllGeometries(),a.isDirty=!1;if(!a.isDirty)return!1;if(a.shouldIntersect){var d=a.point.intersection;d=d&&this._updateFromIntersectionResult(d);g.isSome(d)&&(a.point.manipulator.location=d);a.shouldIntersect=!1}this.view.renderCoordsHelper.toRenderCoords(a.point.manipulator.location,a.engine.points.target);this.view.renderCoordsHelper.toRenderCoords(this._observer.manipulator.location,a.engine.points.observer);
var m="tracker"===b?!0:this._canComputeAnalysis(a);d=a.engine;var k=d.points.observer;const v=d.points.target;this._screenPixelSize=this.view.state.camera.computeScreenPixelSizeAt(k);this._observer.intersection?f.copy(h,this._observer.intersection.normal):f.subtract(h,v,k);var I=this._screenPixelSize;f.normalize(h,h);f.scale(h,h,Math.min(I,1));f.add(r,k,h);a.point.intersection?f.copy(h,a.point.intersection.normal):f.subtract(h,k,v);I=this.view.state.camera.computeScreenPixelSizeAt(v);f.normalize(h,
h);f.scale(h,h,Math.min(I,1));f.add(l,v,h);m?(m=C.fromPoints(r,l,F),this.view.sceneIntersectionHelper.intersectToolIntersectorRay(m,this._intersector),a.hasIntersection=this._intersector.results.min?this._intersector.results.min.getIntersectionPoint(u):!1,a.isTargetVisible=!0,a.hasIntersection&&(f.copy(d.points.intersection,u),f.copy(d.points.intersectionObserver,r),f.copy(d.points.intersectionTarget,l),this.view.renderCoordsHelper.fromRenderCoords(d.points.intersection,x,this.view.spatialReference),
m=1-f.dist(l,v)/f.dist(k,v),a.isTargetVisible=f.dist(k,d.points.intersection)>=m*f.dist(k,v)),a.isValid=!0,k=new D(x,this.view.spatialReference),a.target.intersectedLocation=a.isTargetVisible?null:k,a.target.intersectedGraphic=a.isTargetVisible?null:this._intersector.results.min.toGraphic(this.view),a.target.visible=a.hasIntersection?a.isTargetVisible:!1):a.isValid?(f.copy(u,d.points.intersection),k=f.dist(a.engine.points.intersectionObserver,d.points.intersection)/f.dist(a.engine.points.intersectionObserver,
a.engine.points.intersectionTarget),f.sub(B,r,a.engine.points.intersectionObserver),f.scale(B,B,1-k),f.add(u,u,B),f.sub(B,l,a.engine.points.intersectionTarget),f.scale(B,B,k),f.add(u,u,B)):(a.hasIntersection=!1,a.target.intersectedLocation=null,a.target.intersectedGraphic=null,a.target.visible=void 0);z[12]=d.points.observer[0];z[13]=d.points.observer[1];z[14]=d.points.observer[2];f.subtract(r,r,d.points.observer);f.subtract(l,l,d.points.observer);f.subtract(u,u,d.points.observer);a.engine.visualization.removeAllGeometries();
a.isValid?(a.point.manipulator.state=a.isTargetVisible?16:32,a.engine.visualization.addGeometry(q.createPolylineGeometry(r,a.isTargetVisible?l:u,`${b}-visible-inner`),this._engineResources.visibleLineMaterialInner,z),a.isTargetVisible?a.engine.visualization.addGeometry(q.createPolylineGeometry(r,a.isTargetVisible?l:u,`${b}-visible-outer`),this._engineResources.visibleLineMaterialOuter,z):(a.engine.visualization.addGeometry(q.createPolylineGeometry(u,l,`${b}-occluded-inner`),this._engineResources.occludedLineMaterialInner,
z),a.engine.visualization.addGeometry(q.createPolylineGeometry(r,l,`${b}-occluded-outer`),this._engineResources.occludedLineMaterialOuter,z))):(a.point.manipulator.state=64,a.engine.visualization.addGeometry(q.createPolylineGeometry(r,l,`${b}-observer-inner`),this._engineResources.undefinedLineMaterialInner,z),a.engine.visualization.addGeometry(q.createPolylineGeometry(r,l,`${b}-observer-inner`),this._engineResources.undefinedLineMaterialOuter,z));a.isDirty=!1;return c?(c.madeProgress(),c.done):!1};
J._createClass(E,[{key:"state",get:function(){return this._showTracker?"creating":this.observer?"created":"ready"}},{key:"cursor",get:function(){return this.manipulators.some(({manipulator:a})=>a.focused)?null:this._showTracker?"crosshair":null}},{key:"isSupported",get:function(){return"3d"===this.get("view.type")}}]);return E}(ba.InteractiveToolBase);w.__decorate([y.property({constructOnly:!0})],n.LineOfSightTool.prototype,"view",void 0);w.__decorate([y.property({dependsOn:["_showTracker","observer"],
readOnly:!0})],n.LineOfSightTool.prototype,"state",null);w.__decorate([y.property({readOnly:!0,dependsOn:["_showTracker"]})],n.LineOfSightTool.prototype,"cursor",null);w.__decorate([y.property({dependsOn:["view.type"],readOnly:!0})],n.LineOfSightTool.prototype,"isSupported",null);w.__decorate([y.property({type:D})],n.LineOfSightTool.prototype,"observer",void 0);w.__decorate([y.property({type:H,nonNullable:!0})],n.LineOfSightTool.prototype,"targets",void 0);w.__decorate([y.property({type:O.Configuration})],
n.LineOfSightTool.prototype,"configuration",void 0);w.__decorate([y.property({readOnly:!0})],n.LineOfSightTool.prototype,"updating",void 0);w.__decorate([y.property()],n.LineOfSightTool.prototype,"_showTracker",void 0);n.LineOfSightTool=w.__decorate([Q.subclass("esri.views.3d.interactive.analysisTools.lineOfSight.LineOfSightTool")],n.LineOfSightTool);const x=t.create(),r=t.create(),l=t.create(),u=t.create(),h=t.create(),F=C.create(),B=t.create(),z=S.create(),ca=N.lineSegment.create();n.LineOfSightTargetCollection=
H;Object.defineProperty(n,"__esModule",{value:!0})});