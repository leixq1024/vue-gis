// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.18/esri/copyright.txt for details.
//>>built
define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/has ../../../../../core/maybe ../../../../../core/Logger ../../../../../core/accessorSupport/ensureType ../../../../../core/handleUtils ../../../../../core/accessorSupport/decorators/property ../../../../../core/jsonMap ../../../../../core/accessorSupport/decorators/subclass ../../../../../core/urlUtils ../../../../../core/uuid ../../../../../portal/support/resourceExtension ../../../../../core/Evented ../../../../../chunks/vec3 ../../../../../core/Handles ../../../../../core/watchUtils ../../../../../support/elevationInfoUtils ../../../../../layers/graphics/dehydratedFeatures ../../../support/stack ../../../webgl-engine/lib/GeometryUtil ../../../webgl-engine/lib/Geometry ../editGeometry/EditGeometry ../editGeometry/EditGeometryHelper ../../../../interactive/dragEventPipeline ../../../../interactive/snapping/SnappingAlgorithm ../../../../interactive/snapping/SnappingEngine ../dragEventPipeline3D ../../Manipulator3D ../../manipulatorUtils ../manipulatorUtils ../settings ../../visualElements/OutlineVisualElement ../../../layers/graphics/GraphicState ../visualElementUtils ../manipulations/config ../manipulations/moveUtils ../manipulations/MoveManipulation ../manipulations/MoveXYGraphicManipulation".split(" "),
function(r,x,y,da,g,ea,fa,O,E,ha,P,ia,ja,ka,Q,F,K,L,G,H,R,z,A,S,T,B,M,U,V,W,q,I,k,X,Y,Z,aa,ba,J,ca){function C(p){return"vertex"===p.handle.type}r.ReshapeOperation=function(p){function t(a){var b=p.call(this,a)||this;b._vertexManipulatorMaterial=q.createManipulatorMaterial(k.settings.colorToVec4(k.settings.reshapeManipulators.vertex.color),k.settings.reshapeManipulators.vertex.renderOccluded);b._vertexManipulatorOutlineMaterial=q.createManipulatorOutlineMaterial(k.settings.colorToVec4(k.settings.reshapeManipulators.vertex.outlineColor),
k.settings.reshapeManipulators.vertex.renderOccluded);b._vertexManipulatorHoverOutlineMaterial=q.createManipulatorOutlineMaterial(k.settings.colorToVec4(k.settings.reshapeManipulators.vertex.hoverOutlineColor),k.settings.reshapeManipulators.vertex.renderOccluded);b._edgeManipulatorMaterial=q.createManipulatorMaterial(k.settings.colorToVec4(k.settings.reshapeManipulators.edge.color),k.settings.reshapeManipulators.edge.renderOccluded);b._edgeManipulatorOutlineMaterial=q.createManipulatorOutlineMaterial(k.settings.colorToVec4(k.settings.reshapeManipulators.edge.outlineColor),
k.settings.reshapeManipulators.edge.renderOccluded);b._selectedManipulatorMaterial=q.createManipulatorMaterial(k.settings.colorToVec4(k.settings.reshapeManipulators.selected.color),k.settings.reshapeManipulators.selected.renderOccluded);b._selectedManipulatorOutlineMaterial=q.createManipulatorOutlineMaterial(k.settings.colorToVec4(k.settings.reshapeManipulators.selected.outlineColor),k.settings.reshapeManipulators.selected.renderOccluded);b._selectedManipulatorHoverOutlineMaterial=q.createManipulatorOutlineMaterial(k.settings.colorToVec4(k.settings.reshapeManipulators.selected.hoverOutlineColor),
k.settings.reshapeManipulators.selected.renderOccluded);b._selectedIndex=0;b._vertexManipulatorGeometry=null;b._vertexManipulatorOutlineGeometry=null;b._edgeManipulatorGeometry=null;b._edgeManipulatorOutlineGeometry=null;b._handles=new K;b._manipulatorHandles=new K;b._manipulatorInfos=[];b._reshapeHelper=null;b._graphicMoveManipulation=null;b._moveManipulation=null;b._numGrabbing=0;b._numDragging=0;b._reshapeEventState=0;b._outlineVisualElement=null;b.tool=null;b.outputGeometry=null;b._vertexLaserLineVisualElement=
null;b.snappingEngine=new U.SnappingEngine(a.tool.snappingOptions);return b}x._inheritsLoose(t,p);var h=t.prototype;h.initialize=function(){const a=new Y.GraphicState({graphic:this.graphic});this._graphicState=a;this._handles.add([a.watch("displaying",b=>{for(const c of this._manipulatorInfos)c.manipulator.available=b}),this.view.trackGraphicState(a)])};h.destroy=function(){this._clear();this._handles.destroy();this.snappingEngine.destroy()};h.removeSelectedVertices=function(){const a=this._manipulatorInfos.filter(b=>
b.manipulator.selected&&"vertex"===b.handle.type);this._removeVertices(a)};h.manipulatorSelectionChanged=function(){this.emit("manipulators-changed")};h._clear=function(){this._moveManipulation=g.destroyMaybe(this._moveManipulation);this._graphicMoveManipulation=g.destroyMaybe(this._graphicMoveManipulation);this._manipulatorHandles.removeAll();this.manipulators.removeAll();this._manipulatorInfos=[];this._reshapeHelper=null;this._numDragging=this._numGrabbing=0};h._recreateManipulators=function(a=
this.inputGeometry){this._clear();if(!g.isNone(a)){this._reshapeHelper=new N(S.EditGeometry.fromGeometry(a,this.view.viewingMode),a.type);a=G.getGraphicEffectiveElevationInfo(this.graphic);for(const b of this._reshapeHelper.data.components){for(const c of b.vertices)this._createPerVertexManipulator(c,a);for(const c of b.edges)this._createPerVertexManipulator(c,a)}this._createGraphicMoveManipulators(a)}};h._perGraphicManipulatorDragAction=function(a,b){if("end"!==b.action){var c=[],d=this._manipulatorInfos.some(e=>
"vertex"===e.handle.type&&e.manipulator.selected);d=1===a&&d;a=g.unwrap(this._reshapeHelper);for(var f of this._manipulatorInfos)"vertex"!==f.handle.type||f.manipulator.grabbing||d&&!f.manipulator.selected||(g.unwrap(a).moveVertices([f.handle],b.mapDeltaX,b.mapDeltaY,b.mapDeltaZ),c.push(f.handle.pos),this._updateManipulatorPosition(f));if(0!==c.length){f=0;for(const e of this._manipulatorInfos)"vertex"===e.handle.type&&f++;this.outputGeometry=a.geometry;c.length===f?(this._updateEventState(1),this.destroyed||
this.emit("move",{type:"move",dx:b.screenDeltaX,dy:b.screenDeltaY,mover:this.graphic})):(this._updateEventState(2),this.destroyed||this.emit("reshape",{type:"reshape",mover:this.graphic}))}}};h.isMultiVertexSelection=function(){let a=0;for(const b of this._manipulatorInfos)C(b)&&b.manipulator.selected&&a++;return 1<a};h._perVertexManipulatorDragAction=function(a){this._updateEventState(2);if(!this.destroyed){var b=a.mapDeltaX,c=a.mapDeltaY,d=a.mapDeltaZ;if(b||c||d){var f=[];for(const e of this._manipulatorInfos)C(e)&&
(e.manipulator.selected&&!e.manipulator.grabbing||e===a.info)&&f.push(e);a=g.unwrap(this._reshapeHelper);for(const e of f)a.moveVertices([e.handle],b,c,d);this.outputGeometry=a.geometry;for(const e of f)this._updateManipulatorPosition(e);this.emit("reshape",{type:"reshape",mover:this.graphic})}}};h._updateEventState=function(a){if(a===this._reshapeEventState)return!1;switch(a){case 0:if(0!==this._numGrabbing||0!==this._numDragging)return!1;switch(this._reshapeEventState){case 1:this.emit("move",{type:"move-stop",
dx:0,dy:0,mover:this.graphic});break;case 2:this.emit("reshape",{type:"reshape-stop",mover:this.graphic})}break;case 1:switch(this._reshapeEventState){case 0:this.emit("move",{type:"move-start",dx:0,dy:0,mover:this.graphic});break;case 2:this.emit("reshape",{type:"reshape-stop",mover:this.graphic}),this.destroyed||this.emit("move",{type:"move-start",dx:0,dy:0,mover:this.graphic})}break;case 2:switch(this._reshapeEventState){case 0:this.emit("reshape",{type:"reshape-start",mover:this.graphic});break;
case 1:this.emit("move",{type:"move-stop",dx:0,dy:0,mover:this.graphic}),this.destroyed||this.emit("reshape",{type:"reshape-start",mover:this.graphic})}}if(this.destroyed)return!1;const b=this._reshapeEventState!==a;this._reshapeEventState=a;return b};h._createGraphicMoveManipulators=function(a){this._graphicMoveManipulation=new ca.MoveXYGraphicManipulation({tool:this.tool,view:this.view,graphicState:this._graphicState});this.enableMoveGraphic?this._manipulatorHandles.add(this._graphicMoveManipulation.createDragPipeline((d,
f,e)=>{f.next(m=>this._trackNumDragging(m)).next(m=>{this._perGraphicManipulatorDragAction(0,m)});e.next(this._cancelDragOperation())})):this._graphicMoveManipulation.forEachManipulator(d=>{d.grabbable=!1;d.cursor=null});this._graphicMoveManipulation.forEachManipulator(d=>this._manipulatorHandles.add([this._watchAndUpdateGrabState(d,!1),d.events.on("immediate-click",f=>{this._manipulatorInfos.some(e=>e.manipulator.selected)?this._clearSelection():this.emit("immediate-click");f.stopPropagation()})]));
this._moveManipulation=new J.MoveManipulation({tool:this.tool,view:this.view,xyAvailable:!0,xyAxisAvailable:!0,zAvailable:this.enableZ&&I.canMoveZ(this.graphic),snapToScene:!1,radius:J.MoveManipulation.radiusForSymbol(this.graphic.symbol)});this._moveManipulation.forEachManipulator(d=>{this._handles.add([this._watchAndUpdateGrabState(d,!1),d.events.on("immediate-click",f=>{this._moveManipulation.zManipulation.hasManipulator(d)||this._manipulatorInfos.some(e=>e.manipulator.selected)||this.emit("immediate-click");
f.stopPropagation()})])});this._moveManipulation.elevationInfo={mode:"absolute-height",offset:0};var b=g.unwrap(this.graphic.geometry).spatialReference;let c=null;this._handles.add([this._moveManipulation.createDragPipeline((d,f,e,m)=>{f.next(l=>this._trackNumDragging(l)).next(l=>{if("start"===l.action){var u=this._manipulatorInfos.filter(D=>C(D)&&D.manipulator.selected);1===l.manipulatorType&&1===u.length&&(u=u[0].handle,c=new M.SnappingContext(g.unwrap(this._reshapeHelper),this.view,a,m,u))}g.isSome(c)&&
(l.mapEnd=this.snappingEngine.snap(l.mapEnd,c));"end"===l.action&&(this.snappingEngine.doneSnapping(),c=null);return l}).next(B.addMapDelta()).next(l=>{this._perGraphicManipulatorDragAction(1,l)});e.next(this._cancelDragOperation())},a,b),L.init(this._graphicState,"displaying",()=>{this._updateMoveManipulationPosition()}),this._graphicState.on("changed",()=>this._updateMoveManipulationPosition()),L.init(this._graphicState,"isDraped",()=>{this._graphicState.isDraped?this._handles.add(this.view.elevationProvider.on("elevation-change",
()=>this._updateMoveManipulationPosition()),"align-move-manipulation"):this._handles.remove("align-move-manipulation")})]);this._updateMoveManipulationPosition();b=Z.createVisualElements({view:this.view,graphic:this.graphic,forEachManipulator:d=>{if(!this.destroyed){g.isSome(this._graphicMoveManipulation)&&this._graphicMoveManipulation.forEachManipulator(d);for(const f of this._manipulatorInfos)d(f.manipulator,1);this._moveManipulation.forEachManipulator(d)}},onManipulatorsChanged:d=>this.on("manipulators-changed",
d)});this._outlineVisualElement=b.visualElement instanceof X.OutlineVisualElement?b.visualElement:null;g.isSome(this._outlineVisualElement)&&this._manipulatorHandles.add([this._outlineVisualElement.events.on("attachment-origin-changed",()=>{this._graphicState.isDraped||this._updateMoveManipulationPosition()}),this._graphicState.watch("isDraped",()=>this._updateMoveManipulationPosition())]);this._manipulatorHandles.add(b)};h._createPerVertexManipulator=function(a,b=G.getGraphicEffectiveElevationInfo(this.graphic)){if(g.isNone(this._vertexManipulatorGeometry)||
g.isNone(this._vertexManipulatorOutlineGeometry)){var c=k.settings.reshapeManipulators.vertex,d=c.size/2,f=d+c.collisionPadding;this._vertexManipulatorGeometry=new A(z.createSphereGeometry(d/f,16,16),"reshape-manipulator");this._vertexManipulatorOutlineGeometry=new A(z.createSphereGeometry((d+c.outlineSize)/f,16,16),"reshape-manipulator-outline")}if(g.isNone(this._edgeManipulatorGeometry)||g.isNone(this._edgeManipulatorOutlineGeometry))c=k.settings.reshapeManipulators.edge,d=c.size/2,f=d+c.collisionPadding,
this._edgeManipulatorGeometry=new A(z.createSphereGeometry(d/f,16,16),"reshape-manipulator"),this._edgeManipulatorOutlineGeometry=new A(z.createSphereGeometry((d+c.outlineSize)/f,16,16),"reshape-manipulator-outline");c=new W.Manipulator3D({view:this.view,renderObjects:[{geometry:this._vertexManipulatorGeometry,material:this._vertexManipulatorMaterial,stateMask:n.Vertex|4},{geometry:this._vertexManipulatorOutlineGeometry,material:this._vertexManipulatorOutlineMaterial,stateMask:n.Vertex|5},{geometry:this._vertexManipulatorOutlineGeometry,
material:this._vertexManipulatorHoverOutlineMaterial,stateMask:n.Vertex|6},{geometry:this._edgeManipulatorGeometry,material:this._vertexManipulatorMaterial,stateMask:n.Edge|6},{geometry:this._vertexManipulatorOutlineGeometry,material:this._vertexManipulatorHoverOutlineMaterial,stateMask:n.Edge|6},{geometry:this._edgeManipulatorGeometry,material:this._edgeManipulatorMaterial,stateMask:n.Edge|5},{geometry:this._edgeManipulatorOutlineGeometry,material:this._edgeManipulatorOutlineMaterial,stateMask:n.Edge|
5},{geometry:this._vertexManipulatorGeometry,material:this._selectedManipulatorMaterial,stateMask:8},{geometry:this._vertexManipulatorOutlineGeometry,material:this._selectedManipulatorOutlineMaterial,stateMask:9},{geometry:this._vertexManipulatorOutlineGeometry,material:this._selectedManipulatorHoverOutlineMaterial,stateMask:10}],elevationInfo:b,focusMultiplier:1,touchMultiplier:1,available:!(!this.graphic.visible||!this.graphic.layer.visible)});this._setTypeSpecificManipulatorSettings(c,a,b);const e=
"edge"===a.type?{manipulator:c,handle:a,locationUpdateHandle:null,type:"edge",selectedIndex:0}:{manipulator:c,handle:a,type:"vertex",selectedIndex:0};this._manipulatorInfos.push(e);this.manipulators.add(c);this._updateManipulatorPosition(e);"edge"===e.type&&(a=this._getManipulatorInfoFromHandle(e.handle.left).manipulator.events.on("location-update",()=>this._updateManipulatorPosition(e)),d=this._getManipulatorInfoFromHandle(e.handle.right).manipulator.events.on("location-update",()=>this._updateManipulatorPosition(e)),
e.locationUpdateHandle=O.handlesGroup([a,d]),this._manipulatorHandles.add(e.locationUpdateHandle,c));this._manipulatorHandles.add(this._watchAndUpdateGrabState(c,!0),c);a=B.createManipulatorDragEventPipeline(c,(m,l,u,D)=>{l.next(v=>this._trackNumDragging(v)).next(v=>"edge"===e.handle.type?{...v,info:this._splitEdgeManipulator(e)}:{...v,info:e}).next(B.dragAtLocation(this.view,m.elevationAlignedLocation)).next(V.screenToMapXYForGraphicAtLocation(this.view,this.graphic,m.elevationAlignedLocation,m.location.spatialReference)).next(this._snapDrag(b,
D)).next(B.addMapDelta()).next(v=>{this._perVertexManipulatorDragAction(v)});u.next(this._cancelDragOperation())});this._manipulatorHandles.add(a,c);this._manipulatorHandles.add([c.events.on("immediate-click",m=>this._manipulatorClickCallback(m,e)),c.events.on("select-changed",()=>{e.selectedIndex=++this._selectedIndex;this._updateMoveManipulationPosition()})]);this.emit("manipulators-changed");return c};h._snapDrag=function(a,b){let c=null;const d=g.unwrap(this._reshapeHelper);return f=>{"start"===
f.action&&(this.isMultiVertexSelection()||(c={context:new M.SnappingContext(d,this.view,a,b,f.info.handle),originalPos:d.data.coordinateHelper.createDehydratedPoint(f.info.handle.pos)}));if(g.isSome(c)){var e={...c.originalPos};e.x+=f.mapEnd.x-f.mapStart.x;e.y+=f.mapEnd.y-f.mapStart.y;e=this.snappingEngine.snap(e,c.context);f.mapEnd.x=e.x+(f.mapStart.x-c.originalPos.x);f.mapEnd.y=e.y+(f.mapStart.y-c.originalPos.y)}"end"===f.action&&(this.snappingEngine.doneSnapping(),c=null);return f}};h._trackNumDragging=
function(a){switch(a.action){case "start":this._numDragging++;break;case "end":this._numDragging--}return a};h._cancelDragOperation=function(){const a=g.isSome(this._reshapeHelper)?this._reshapeHelper.geometry.clone():null;return()=>{this._numDragging--;this.outputGeometry=this.inputGeometry=a;this.snappingEngine.doneSnapping();switch(this._reshapeEventState){case 1:this.emit("move",{type:"move",dx:0,dy:0,mover:this.graphic});break;case 2:this.emit("reshape",{type:"reshape",mover:this.graphic})}this.destroyed||
this._updateEventState(0)}};h._setTypeSpecificManipulatorSettings=function(a,b,c){switch(b.type){case "vertex":a.state=n.Vertex;a.selectable=!0;a.cursor="move";a.collisionPriority=2;a.radius=k.settings.reshapeManipulators.vertex.size/2+k.settings.reshapeManipulators.vertex.collisionPadding;a.elevationInfo=c;break;case "edge":a.state=n.Edge,a.selectable=!1,a.cursor="copy",a.collisionPriority=-1,a.radius=k.settings.reshapeManipulators.edge.size/2+k.settings.reshapeManipulators.edge.collisionPadding,
a.elevationInfo="on-the-ground"===c.mode?c:{mode:"absolute-height",offset:0}}};h._watchAndUpdateGrabState=function(a,b){return a.events.on("grab-changed",c=>{if("start"===c.action)b&&this._updateSelection(a),this._numGrabbing++;else if(this._numGrabbing--,this._updateEventState(0),this.destroyed)return;this._moveManipulation.interactive=!this._numGrabbing})};h._clearSelection=function(){for(const a of this._manipulatorInfos)a.manipulator.grabbing||(a.manipulator.selected=!1)};h._updateSelection=function(a){a.grabbing&&
!a.selected&&a.selectable&&(this._clearSelection(),a.selected=!0,this.emit("manipulators-changed"))};h._removeManipulator=function(a){a&&(this._manipulatorHandles.remove(a.manipulator),this._manipulatorInfos.splice(this._manipulatorInfos.indexOf(a),1),this.manipulators.remove(a.manipulator),this.emit("manipulators-changed"))};h._getManipulatorInfoFromHandle=function(a){if(a)for(const b of this._manipulatorInfos)if(a===b.handle)return b;return null};h._updateManipulatorPosition=function(a){if(a){var b=
g.unwrap(this._reshapeHelper);if("vertex"===a.handle.type)a.manipulator.location=b.data.coordinateHelper.toPoint(a.handle.pos,w),a.manipulator.grabbing&&g.isSome(this._vertexLaserLineVisualElement)&&(this._vertexLaserLineVisualElement.visualElement.intersectsWorldUpAtLocation=a.manipulator.renderLocation);else if("edge"===a.handle.type){var c=this._getManipulatorInfoFromHandle(a.handle.left).manipulator,d=this._getManipulatorInfoFromHandle(a.handle.right).manipulator;g.isSome(a.manipulator.elevationInfo)&&
"on-the-ground"===a.manipulator.elevationInfo.mode?(c=c.location,d=d.location,a.manipulator.location=H.makeDehydratedPoint(c.x+.5*(d.x-c.x),c.y+.5*(d.y-c.y),c.hasZ&&d.hasZ?0:void 0,b.geometry.spatialReference)):(c=c.elevationAlignedLocation,d=d.elevationAlignedLocation,a.manipulator.elevationAlignedLocation=H.makeDehydratedPoint(c.x+.5*(d.x-c.x),c.y+.5*(d.y-c.y),c.hasZ&&d.hasZ?c.z+.5*(d.z-c.z):void 0,b.geometry.spatialReference))}}};h._splitEdgeManipulator=function(a){var b=g.unwrap(this._reshapeHelper);
const c=g.unwrap(b.splitEdge(a.handle,.5).createdVertex);a.locationUpdateHandle.remove();a.locationUpdateHandle=void 0;a.handle=c;a.type="vertex";var d=G.getGraphicEffectiveElevationInfo(this.graphic);this._setTypeSpecificManipulatorSettings(a.manipulator,a.handle,d);c.left&&this._createPerVertexManipulator(c.left);c.right&&this._createPerVertexManipulator(c.right);this.outputGeometry=b.geometry;this._updateManipulatorPosition(a);this._updateSelection(a.manipulator);d=this._updateEventState(2);const f=
b.data.coordinateHelper.toArray(a.handle.pos);b=b.data.components.indexOf(c.component);this.emit("vertex-add",{type:"vertex-add",vertices:[{coordinates:f,componentIndex:b,vertexIndex:g.unwrap(c.index)}],added:f});d&&this._updateEventState(0);return a};h._updateMoveManipulationPosition=function(){const a=R.sv3d.get();F.set(a,0,0,0);let b=0,c=!1;var d=null;let f=null;for(var e of this._manipulatorInfos)if(C(e))if(e.manipulator.selected)if(b++,F.add(a,a,e.manipulator.renderLocation),g.isNone(d)||e.selectedIndex>
d.selectedIndex)f=d,d=e;else{if(g.isNone(f)||e.selectedIndex>f.selectedIndex)f=e}else c=!0;0!==b?(e=this._graphicState.displaying,this._moveManipulation.xyManipulation.available=e,this._moveManipulation.xyAxisManipulation.available=e,this._moveManipulation.zManipulation.available=e&&this.enableZ&&I.canMoveZ(this.graphic),this._moveManipulation.xyAxisManipulation.orthogonalAvailable=e&&1!==b):(e=this._graphicState.displaying&&this.enableMoveGraphic,this._moveManipulation.xyManipulation.available=e,
this._moveManipulation.xyAxisManipulation.available=e,this._moveManipulation.xyAxisManipulation.orthogonalAvailable=e,this._moveManipulation.zManipulation.available=e&&this.enableZ&&I.canMoveZ(this.graphic));if(0!==b){e=0;if(g.isSome(d)){const m=d.handle.pos,l=g.isSome(f)?f.handle.pos:d.handle.left&&d.handle.left.left?d.handle.left.left.pos:null;d=!g.isSome(f)&&d.handle.right&&d.handle.right.right?d.handle.right.right.pos:null;l&&d?this._moveManipulation.xyAxisManipulation.available=!1:l?e=Math.atan2(m[1]-
l[1],m[0]-l[0])+Math.PI/2:d&&(e=Math.atan2(d[1]-m[1],d[0]-m[0])+Math.PI/2)}this._moveManipulation.angle=e;this._moveManipulation.radius=aa.DISC_RADIUS_SMALL}else this._moveManipulation.angleDeferred=()=>ba.primaryShapeOrientation(g.unwrap(this.graphic.geometry)),this._moveManipulation.radius=J.MoveManipulation.radiusForSymbol(this.graphic.symbol);0!==b&&c?(F.scale(a,a,1/b),w.spatialReference=g.unwrap(this._reshapeHelper).geometry.spatialReference,w.hasZ=!0,this.view.renderCoordsHelper.fromRenderCoords(a,
w),this._moveManipulation.elevationAlignedLocation=w):g.isSome(this._outlineVisualElement)&&!this._graphicState.isDraped&&g.isSome(this._outlineVisualElement.attachmentOrigin)?this._moveManipulation.elevationAlignedLocation=this._outlineVisualElement.attachmentOrigin:q.placeAtGraphic(this.view,this._moveManipulation,this.graphic)};h._removeVertices=function(a){var b=[];const c=g.unwrap(this._reshapeHelper);for(var d of a)"vertex"===d.handle.type&&c.canRemoveVertex()&&(b.push(d.handle),this._removeManipulator(d),
this._removeManipulator(this._getManipulatorInfoFromHandle(d.handle.left)),this._removeManipulator(this._getManipulatorInfoFromHandle(d.handle.right)),(a=g.unwrap(c.removeVertices([d.handle]).removedVertices[0].createdEdge))&&this._createPerVertexManipulator(a));if(0<b.length&&(b=b.map(f=>{const e=c.data.components.indexOf(f.component);return{coordinates:c.data.coordinateHelper.toArray(f.pos),componentIndex:e,vertexIndex:g.unwrap(f.index)}}),this.outputGeometry=c.geometry,d=this._updateEventState(2),
!this.destroyed&&(this.emit("vertex-remove",{type:"vertex-remove",removed:b.map(f=>f.coordinates),vertices:b}),!this.destroyed))){if(d&&(this._updateEventState(0),this.destroyed))return;this._updateMoveManipulationPosition()}};h._manipulatorClickCallback=function(a,b){a.shiftKey||this._clearSelection();"vertex"===b.handle.type&&(b.manipulator.selected=!b.manipulator.selected);"vertex"===b.handle.type&&2===a.button&&this._removeVertices([b]);"edge"===b.handle.type&&0===a.button&&this._splitEdgeManipulator(b);
a.stopPropagation()};x._createClass(t,[{key:"inputGeometry",get:function(){return g.isSome(this._reshapeHelper)?this._reshapeHelper.geometry:null},set:function(a){this._recreateManipulators(a)}},{key:"manipulators",get:function(){return this.tool.manipulators}},{key:"view",get:function(){return this.tool.view}},{key:"graphic",get:function(){return this.tool.graphic}},{key:"enableZ",get:function(){return this.tool.enableZ}},{key:"enableMoveGraphic",get:function(){return this.tool.enableMoveGraphic}}]);
return t}(Q.EventedAccessor);y.__decorate([E.property({constructOnly:!0})],r.ReshapeOperation.prototype,"tool",void 0);y.__decorate([E.property()],r.ReshapeOperation.prototype,"inputGeometry",null);y.__decorate([E.property()],r.ReshapeOperation.prototype,"outputGeometry",void 0);r.ReshapeOperation=y.__decorate([P.subclass("esri.views.3d.interactive.editingTools.graphicReshape3D.ReshapeOperation")],r.ReshapeOperation);const w=H.makeDehydratedPoint(0,0,null,null);var n;(function(p){p.Vertex=16;p.Edge=
32})(n||(n={}));let N=function(p){function t(h,a){h=p.call(this,h,a)||this;h.type=a;h._geometry=null;return h}x._inheritsLoose(t,p);x._createClass(t,[{key:"geometry",get:function(){if(this._dirty){switch(this.type){case "polyline":this._geometry=this.data.toPolyline();break;case "polygon":this._geometry=this.data.toPolygon()}this._dirty=!1}return this._geometry}}]);return t}(T.EditGeometryHelper);r.ReshapeGeometryHelper=N;Object.defineProperty(r,"__esModule",{value:!0})});