// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.18/esri/copyright.txt for details.
//>>built
define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/maybe ../../../../../core/handleUtils ../../../../../core/Evented ../../../../../Color ../../../../../chunks/vec3f64 ../../../../../chunks/vec3 ../../../../../core/Handles ../../../../../chunks/mat4 ../../../../../chunks/mat4f64 ../../../../../support/elevationInfoUtils ../../../support/stack ../../../webgl-engine/lib/GeometryUtil ../../../webgl-engine/lib/Geometry ../../../webgl-engine/materials/ColorMaterial ../../../../interactive/dragEventPipeline ../dragEventPipeline3D ../../Manipulator3D ../settings ./config ./Manipulation ./moveUtils".split(" "),
function(t,u,y,z,A,B,v,p,C,e,D,E,g,w,F,G,m,H,I,J,l,q,K){q=function(x){function n(a){var b=x.call(this)||this;b._handles=new C;b._arrowManipulatorInfos=[];b._opaqueMaterial=b.createMaterial();b._transparentMaterial=b.createMaterial(.5);b._angle=0;b._scale=1;b._radius=l.DISC_RADIUS;b._updateAfterDrag=!1;b.events=new A;b._tool=a.tool;b._view=a.view;null!=a.radius&&(b._radius=a.radius);b._createManipulators();b.forEachManipulator(c=>b._tool.manipulators.add(c));return b}u._inheritsLoose(n,x);var h=n.prototype;
h.destroy=function(){this.forEachManipulator(a=>{this._tool.manipulators.remove(a);a.destroy()});this._handles.removeAll();this._view=this._tool=null;this._arrowManipulatorInfos.length=0};h.forEachManipulator=function(a){this._arrowManipulatorInfos.map(({manipulator:b})=>a(b,1))};h.createGraphicDragPipeline=function(a,b){const c=a.graphic,f=E.getGraphicEffectiveElevationInfo(c),d=y.unwrap(c.geometry).spatialReference;return K.createGraphicMoveDragPipeline(a,b,k=>this.createDragPipeline(k,f,d))};h.createDragPipeline=
function(a,b,c){return z.handlesGroup(this._arrowManipulatorInfos.map(({manipulator:f},d)=>m.createManipulatorDragEventPipeline(f,(k,r,L,M,N)=>{r=r.next(O=>({...O,manipulatorType:1})).next(m.dragAtLocation(this._view,k.elevationAlignedLocation)).next(H.screenToMapXYAtLocation(this._view,k.elevationAlignedLocation,b,c)).next(m.constrainToMapAxis(k.location,this.angle+(d+1)*Math.PI*.5)).next(m.addScreenDelta());a(k,r,L,M,N)})))};h._updateManipulators=function(){for(let a=0;a<this._arrowManipulatorInfos.length;a++)this._updateArrowManipulator(this._arrowManipulatorInfos[a],
a);this._updateManipulatorTransform()};h._updateArrowManipulator=function({manipulator:a,transform:b},c){const f=this._radius/l.DISC_RADIUS;var d=l.DISC_TRANSLATE_ARROW_SIZE*f;const k=Math.sqrt(d*d*3/4);d=w.createExtrudedTriangle(k,d/2,d/2,l.DISC_HEIGHT);w.transformInPlace(d,e.fromTranslation(g.sm4d.get(),p.set(g.sv3d.get(),0,-k/3,0)));d=new F(d,"move-xy-axis-arrow");a.renderObjects=[{geometry:d,material:this._opaqueMaterial,stateMask:2},{geometry:d,material:this._transparentMaterial,stateMask:1}];
a.radius=k/3*2.4;a=e.identity(g.sm4d.get());e.fromZRotation(a,c*Math.PI/2);c=e.identity(g.sm4d.get());e.fromTranslation(c,p.set(g.sv3d.get(),0,l.DISC_TRANSLATE_ARROW_OFFSET*f,0));e.multiply(b,a,c)};h._createManipulators=function(){for(let a=0;4>a;a++){const b=this._createArrowManipulator(a);this._arrowManipulatorInfos.push(b)}this._updateManipulatorTransform()};h._updateManipulatorTransform=function(){var a=this.angle,b=e.identity(g.sm4d.get());e.rotate(b,b,a,v.fromValues(0,0,1));const c=e.fromScaling(g.sm4d.get(),
p.set(g.sv3d.get(),this.displayScale,this.displayScale,this.displayScale));a=e.identity(g.sm4d.get());e.multiply(a,c,b);for(const f of this._arrowManipulatorInfos)b=e.multiply(g.sm4d.get(),a,f.transform),f.manipulator.modelTransform=b};h._createArrowManipulator=function(a){const b=new I.Manipulator3D({view:this._view,autoScaleRenderObjects:!1,worldOriented:!0,focusMultiplier:1,touchMultiplier:1,collisionType:{type:"disc",direction:v.fromValues(0,0,1)}}),c={manipulator:b,transform:D.create()};this._updateArrowManipulator(c,
a);this._handles.add(b.events.on("drag",f=>{this._updateAfterDrag&&"end"===f.action&&!this.dragging&&(this._updateManipulatorTransform(),this._updateAfterDrag=!1)}));return c};h.createMaterial=function(a=1){const b=B.toUnitRGBA(J.colors.main);b[3]*=a;return new G.ColorMaterial({color:b,transparent:1!==a,cullFace:2,renderOccluded:2},"graphic-transform")};u._createClass(n,[{key:"orthogonalAvailable",set:function(a){this._arrowManipulatorInfos[1].manipulator.available=a;this._arrowManipulatorInfos[3].manipulator.available=
a}},{key:"angle",get:function(){return this._angle},set:function(a){this._angle=a;this.dragging?this._updateAfterDrag=!0:this._updateManipulatorTransform()}},{key:"displayScale",get:function(){return this._scale},set:function(a){this._scale=a;this._updateManipulatorTransform()}},{key:"radius",get:function(){return this._radius},set:function(a){this._radius!==a&&(this._radius=a,this._updateManipulators())}},{key:"test",get:function(){return{arrowManipulators:this._arrowManipulatorInfos.map(({manipulator:a})=>
a)}}}]);return n}(q.Manipulation);t.MoveXYAxisManipulation=q;Object.defineProperty(t,"__esModule",{value:!0})});