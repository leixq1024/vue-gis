// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.18/esri/copyright.txt for details.
//>>built
define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/has ../../../../../core/maybe ../../../../../core/Logger ../../../../../core/accessorSupport/ensureType ../../../../../core/accessorSupport/decorators/property ../../../../../core/jsonMap ../../../../../core/accessorSupport/decorators/subclass ../../../../../core/urlUtils ../../../../../core/uuid ../../../../../portal/support/resourceExtension ../../../../../core/Evented ../../../../../Graphic ../../../../../layers/GraphicsLayer ../../../../../support/elevationInfoUtils ./drawSurfaces ./DrawOperation ../../../../interactive/InteractiveToolBase ../../../../interactive/snapping/SnappingOptions ../../../../draw/support/createUtils ../settings ../../visualElements/OutlineVisualElement ../../visualElements/VerticesVisualElement".split(" "),
function(f,u,g,H,e,I,J,h,K,x,L,M,N,y,v,z,A,B,C,D,E,l,n,F,w){function G(p){switch(p){case "point":case "polyline":case "polygon":return p;case "circle":case "rectangle":return"segment";default:return null}}f.DrawGraphicTool=function(p){function t(a){a=p.call(this,a)||this;a.drawOperation=null;a._createGraphic=null;a._outlineVisualElement=null;a._verticesVisualElement=null;a._stagedVerticesVisualElement=null;a.hasZ=!0;a.defaultZ=0;a.elevationInfo=null;a.snapToScene=!1;a.snappingOptions=new E.SnappingOptions;
a.mode=null;a.geometryType=null;a.type="draw-3d";return a}u._inheritsLoose(t,p);var d=t.prototype;d.initialize=function(){const a=e.unwrapOr(this.elevationInfo,{mode:this.hasZ?"absolute-height":"on-the-ground",offset:0});this._internalGraphicsLayer=new z({elevationInfo:a});this.view.map.layers.add(this._internalGraphicsLayer);this.drawOperation=new C.DrawOperation({view:this.view,manipulators:this.manipulators,geometryType:G(this.geometryType),drawingMode:this.mode,hasZ:this.hasZ,defaultZ:this.defaultZ,
snapToSceneEnabled:this.snapToScene,snappingDrawSurface:new B.SceneDrawSurface(this.view,a,[this._internalGraphicsLayer]),hasM:!1,elevationInfo:a,snappingOptions:this.snappingOptions});this.drawOperation.on("vertex-add",c=>this.onVertexAdd(c));this.drawOperation.on("vertex-remove",c=>this.onVertexRemove(c));this.drawOperation.on("vertex-update",c=>this.onVertexUpdate(c));this.drawOperation.on("cursor-update",c=>this.onCursorUpdate(c));this.drawOperation.on("complete",c=>this.onComplete(c))};d.destroy=
function(){this.drawOperation.destroy();this.drawOperation=null;this._destroyAllVisualisations();this.view.map.remove(this._internalGraphicsLayer);this._set("view",null)};d.onInputEvent=function(a){this.drawOperation.onInputEvent(a)};d._getCreateGeometry=function(a,c=!1){if(null==this.drawOperation)return null;var b=e.isSome(a)?a:this.drawOperation.hasStagedVertex?this.drawOperation.numVertices-1:null;a=this.drawOperation.vertices;if(0===a.length)return null;const q=this.drawOperation.spatialReference;
var k=a.slice(),m=[];e.isSome(b)&&(k.splice(b,1),m.push(a[b]));b={regularVertices:null,stagedVertices:null,full:null,outline:null};const r="3d"===this.view.type&&"global"===this.view.viewingMode;switch(this.geometryType){case "point":b.regularVertices=k;b.stagedVertices=m;b.full=this.drawOperation.coordinateHelper.createPointFromArray(a[0]);break;case "polyline":b.regularVertices=k;b.stagedVertices=m;0<a.length&&(b.full=l.createPolyline([a],q,r));break;case "polygon":b.regularVertices=k;b.stagedVertices=
m;0<a.length&&(b.full=l.createPolygon([a],q,r,!0));break;case "circle":0<a.length&&(k=l.createViewAlignedCoordinateSystem(this.view,a[0]),1===a.length&&c?(c=a[0],m=k.makeMapPoint(c[0]+48*this.view.resolution,c[1]),b.full=l.createCircle([c,m],k,!0)):2===a.length&&(b.full=this.forceUniformSize?l.createCircle(a,k,this.centered):l.createEllipse(a,k,this.centered)));break;case "rectangle":0<a.length&&(k=l.createViewAlignedCoordinateSystem(this.view,a[0]),1===a.length&&c?(c=a[0],m=k.makeMapPoint(c[0]+48*
this.view.resolution,c[1]),b.full=l.createSquare([c,m],k,!0)):2===a.length&&(b.full=this.forceUniformSize?l.createSquare(a,k,this.centered):l.createRectangle(a,k,this.centered)));break;default:return null}switch(this.geometryType){case "polyline":1<a.length&&(b.outline=l.createPolyline([a],q,r));break;case "polygon":1<a.length&&(b.outline=l.createPolygon([a],q,r));break;case "circle":case "rectangle":e.isSome(b.full)&&"polygon"===b.full.type&&(b.outline=l.createPolygon(b.full.rings,q,r))}return b};
d._destroyAllVisualisations=function(){this._destroyCreateGraphic();this._destroyOutlineVisualElement();this._destroyVerticesVisualElement();this._destroyStagedVerticesVisualElement()};d._destroyCreateGraphic=function(){e.isSome(this._createGraphic)&&(this._internalGraphicsLayer.remove(this._createGraphic),this._createGraphic.destroy(),this._createGraphic=null)};d._destroyOutlineVisualElement=function(){e.isSome(this._outlineVisualElement)&&(this._outlineVisualElement.destroy(),this._outlineVisualElement=
null)};d._destroyVerticesVisualElement=function(){e.isSome(this._verticesVisualElement)&&(this._verticesVisualElement.destroy(),this._verticesVisualElement=null)};d._destroyStagedVerticesVisualElement=function(){e.isSome(this._stagedVerticesVisualElement)&&(this._stagedVerticesVisualElement.destroy(),this._stagedVerticesVisualElement=null)};d._updateCreateGraphic=function(a=null){a=this._getCreateGeometry(a);if(e.isNone(a))this._destroyAllVisualisations();else{var c=this._internalGraphicsLayer.elevationInfo,
b="on-the-ground"===A.getEffectiveElevationMode(this.hasZ,c);e.isSome(a.outline)?e.isNone(this._outlineVisualElement)?(this._outlineVisualElement=new F.OutlineVisualElement({view:this.view,geometry:a.outline,elevationInfo:e.unwrap(c),isDraped:b,attached:!1}),n.settings.visualElements.lineGraphics.outline.apply(this._outlineVisualElement),n.settings.visualElements.lineGraphics.shadowStyle.apply(this._outlineVisualElement),this._outlineVisualElement.attached=!0,this._outlineVisualElement.laserlineEnabled=
!0):this._outlineVisualElement.geometry=a.outline:this._destroyOutlineVisualElement();e.isSome(a.regularVertices)?e.isNone(this._verticesVisualElement)?(this._verticesVisualElement=new w.VerticesVisualElement({view:this.view,spatialReference:this.view.spatialReference,vertices:a.regularVertices,elevationInfo:e.unwrap(this._internalGraphicsLayer.elevationInfo),renderOccluded:n.settings.reshapeManipulators.vertex.renderOccluded,attached:!1}),this._verticesVisualElement.attached=!0):this._verticesVisualElement.vertices=
a.regularVertices:this._destroyVerticesVisualElement();e.isSome(a.stagedVertices)?e.isNone(this._stagedVerticesVisualElement)?(this._stagedVerticesVisualElement=new w.VerticesVisualElement({view:this.view,spatialReference:this.view.spatialReference,vertices:a.stagedVertices,elevationInfo:e.unwrap(this._internalGraphicsLayer.elevationInfo),renderOccluded:n.settings.reshapeManipulators.vertex.renderOccluded,attached:!1}),this._stagedVerticesVisualElement.color=n.settings.colorToVec4(n.settings.reshapeManipulators.selected.color),
this._stagedVerticesVisualElement.attached=!0):this._stagedVerticesVisualElement.vertices=a.stagedVertices:this._destroyStagedVerticesVisualElement();e.isSome(a.full)?e.isNone(this._createGraphic)?(this._createGraphic=new v({geometry:a.full,symbol:this.createGraphicSymbol}),this._internalGraphicsLayer.add(this._createGraphic),this.view.maskOccludee(this._createGraphic),this.notifyChange("createGraphic")):this._createGraphic.geometry=a.full:this._destroyCreateGraphic()}};d.reset=function(){};d.redo=
function(){this.drawOperation.redo()};d.undo=function(){this.drawOperation.undo()};d.completeCreateOperation=function(){this.drawOperation.complete()};d.activate=function(){};d.deactivate=function(){this.drawOperation.isCompleted||this.drawOperation.cancel()};d.getVertexCoords=function(){return this.drawOperation.vertices};d.onVertexAdd=function(a){this._updateCreateGraphic();this.emit("vertex-add",a)};d.onVertexRemove=function(a){this._updateCreateGraphic();this.emit("vertex-remove",a)};d.onVertexUpdate=
function(a){this._updateCreateGraphic();this.emit("vertex-update",a)};d.onCursorUpdate=function(a){this._updateCreateGraphic(1===a.vertices.length?a.vertices[0].vertexIndex:null);this.emit("cursor-update",a)};d.onComplete=function(a){this._updateCreateGraphic();let c=null;if(this.drawOperation.isCompleted){const b=this._getCreateGeometry(null,!0);e.isSome(b)&&(c=new v({geometry:b.full,symbol:this.createGraphicSymbol}))}this.emit("complete",{graphic:c,...a})};u._createClass(t,[{key:"createGraphic",
get:function(){return this._createGraphic}},{key:"enabled",set:function(a){this.drawOperation.interactive=a;this._set("enabled",a)}},{key:"centered",set:function(a){this._set("centered",a);this._updateCreateGraphic()}},{key:"forceUniformSize",set:function(a){this._set("forceUniformSize",a);this._updateCreateGraphic()}},{key:"canRedo",get:function(){return this.drawOperation.canRedo}},{key:"canUndo",get:function(){return this.drawOperation.canUndo}}]);return t}(y.EventedMixin(D.InteractiveToolBase));
g.__decorate([h.property({constructOnly:!0,nonNullable:!0})],f.DrawGraphicTool.prototype,"view",void 0);g.__decorate([h.property()],f.DrawGraphicTool.prototype,"createGraphicSymbol",void 0);g.__decorate([h.property()],f.DrawGraphicTool.prototype,"createGraphic",null);g.__decorate([h.property({value:!0})],f.DrawGraphicTool.prototype,"enabled",null);g.__decorate([h.property({value:!0})],f.DrawGraphicTool.prototype,"centered",null);g.__decorate([h.property({value:!0})],f.DrawGraphicTool.prototype,"forceUniformSize",
null);g.__decorate([h.property({constructOnly:!0})],f.DrawGraphicTool.prototype,"hasZ",void 0);g.__decorate([h.property({nonNullable:!0})],f.DrawGraphicTool.prototype,"defaultZ",void 0);g.__decorate([h.property({constructOnly:!0})],f.DrawGraphicTool.prototype,"elevationInfo",void 0);g.__decorate([h.property()],f.DrawGraphicTool.prototype,"snapToScene",void 0);g.__decorate([h.property()],f.DrawGraphicTool.prototype,"snappingOptions",void 0);g.__decorate([h.property({constructOnly:!0})],f.DrawGraphicTool.prototype,
"mode",void 0);g.__decorate([h.property({constructOnly:!0})],f.DrawGraphicTool.prototype,"geometryType",void 0);g.__decorate([h.property({readOnly:!0})],f.DrawGraphicTool.prototype,"type",void 0);f.DrawGraphicTool=g.__decorate([x.subclass("esri.views.3d.interactive.editingTools.draw3D.DrawTool")],f.DrawGraphicTool);Object.defineProperty(f,"__esModule",{value:!0})});