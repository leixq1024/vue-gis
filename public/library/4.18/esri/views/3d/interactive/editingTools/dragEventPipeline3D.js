// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.18/esri/copyright.txt for details.
//>>built
define("exports ../../../../core/maybe ../../../../geometry/Point ../../../../geometry ../../../../core/mathUtils ../../../../core/screenUtils ../../../../chunks/vec3f64 ../../../../chunks/vec3 ../../../../geometry/projection ../../../../support/elevationInfoUtils ../../support/stack ../../support/geometryUtils ../../webgl-engine/lib/intersectorUtils ../../webgl-engine/lib/Intersector ../../../interactive/dragEventPipeline".split(" "),function(n,k,u,N,H,q,r,l,v,w,x,t,y,I,J){function z(a,b){const c=
r.create(),d=r.create();let f=!1;return e=>{if("start"===e.action){var g=q.screenPointObjectToArray(e.screenStart,q.castScreenPointArray(x.sv2d.get()));g=t.ray.fromScreen(a.state.camera,g,A);k.isSome(g)&&(f=t.plane.intersectRay(b,g,c))}if(!f)return null;g=q.screenPointObjectToArray(e.screenEnd,q.castScreenPointArray(x.sv2d.get()));g=t.ray.fromScreen(a.state.camera,g,A);return k.isNone(g)?null:t.plane.intersectRay(b,g,d)?{...e,renderStart:c,renderEnd:d,plane:b,ray:g}:null}}function B(a,b,c,d=null){let f=
null;return e=>{if("start"===e.action&&(f=a.sceneIntersectionHelper.intersectElevationFromScreen(q.createScreenPointArray(e.screenStart.x,e.screenStart.y),b,c),k.isSome(f)&&k.isSome(d)&&!v.projectPoint(f,f,d))||k.isNone(f))return null;const g=a.sceneIntersectionHelper.intersectElevationFromScreen(q.createScreenPointArray(e.screenEnd.x,e.screenEnd.y),b,c);return k.isSome(g)?k.isSome(d)&&!v.projectPoint(g,g,d)?null:{...e,mapStart:f,mapEnd:g}:null}}function C(a,b,c,d=null){b=w.getZForElevationMode(b,
a,c);return B(a,c,b,d)}function D(a,b,c,d=null){return C(a,c,w.getGraphicEffectiveElevationInfo(b),d)}function K(a,b){const c=L,d=M,f=t.plane.create();a.renderCoordsHelper.worldUpAtPosition(b,c);a=l.cross(f,c,l.subtract(d,b,a.state.camera.eye));l.cross(a,a,c);return t.plane.fromPositionAndNormal(b,a,f)}function E(a,b){const c=r.create(),d=l.length(b);a.renderCoordsHelper.worldUpAtPosition(b,c);const f=r.create(),e=r.create(),g=h=>{l.subtract(h,h,b);t.vector.projectPoint(c,h,h);"global"===a.viewingMode&&
l.length(h)*H.sign(l.dot(c,h))<-d+.001&&l.subtract(h,l.scale(h,c,.001),b);l.add(h,h,b);return h};return h=>{h.renderStart=g(l.copy(f,h.renderStart));h.renderEnd=g(l.copy(e,h.renderEnd));return h}}function F(a,b){const c=a.renderCoordsHelper;return d=>{const f=c.fromRenderCoords(d.renderStart,new u,b),e=c.fromRenderCoords(d.renderEnd,new u,b);return k.isSome(f)&&k.isSome(e)?{...d,mapStart:f,mapEnd:e}:null}}const L=r.create(),M=r.create(),A=t.ray.create();n.convertToMapCoordinates=F;n.hideManipulatorWhileDragging=
function(a){let b=null;return c=>{switch(c.action){case "start":b=a.disableDisplay();break;case "end":case "cancel":k.isSome(b)&&(b.remove(),b=null)}return c}};n.projectToWorldUp=E;n.screenToMap3D=function(a,b=null){let c=null;const d=new I.Intersector(a.state.mode);d.options.selectionMode=!0;d.options.store=0;const f=q.createScreenPointArray(),e={requiresGroundFeedback:!0,enableDraped:!0,exclude:new Set},g=r.create(),h=k.unwrapOr(b,a.spatialReference),G=m=>{a.map.ground&&1>a.map.ground.opacity?e.exclude.add(y.TERRAIN_ID):
e.exclude.delete(y.TERRAIN_ID);a.sceneIntersectionHelper.intersectIntersectorScreen(q.screenPointObjectToArray(m,f),d,e);m=d.results.min;if(m.getIntersectionPoint(g))m="TerrainRenderer"===m.intersector?0:1;else if(d.results.ground.getIntersectionPoint(g))m=0;else return null;const p=new u({spatialReference:h});a.renderCoordsHelper.fromRenderCoords(g,p);return{location:p,surfaceType:m}};return m=>{if("start"===m.action){var p=G(m.screenStart);c=k.isSome(p)?p.location:null}if(k.isNone(c))return null;
p=G(m.screenEnd);return k.isSome(p)?{...m,mapStart:c,mapEnd:p.location,surfaceType:p.surfaceType}:null}};n.screenToMapXY=B;n.screenToMapXYAtLocation=C;n.screenToMapXYForGraphic=function(a,b,c,d){a=b.toMap(a.screenStart,{include:[c]});return k.isSome(a)?D(b,c,a,d):null};n.screenToMapXYForGraphicAtLocation=D;n.screenToRenderPlane=z;n.screenToZConstrained=function(a,b,c){let d=null;const f=new J.EventPipeline;f.next(z(a,K(a,b))).next(E(a,b)).next(F(a,c)).next(e=>{e.mapEnd.x=e.mapStart.x;e.mapEnd.y=e.mapStart.y;
d=e});return e=>{d=null;f.execute(e);return d}};Object.defineProperty(n,"__esModule",{value:!0})});