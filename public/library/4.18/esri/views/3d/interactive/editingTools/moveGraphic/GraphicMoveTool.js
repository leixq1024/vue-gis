// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.18/esri/copyright.txt for details.
//>>built
define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/has ../../../../../core/maybe ../../../../../core/Logger ../../../../../core/accessorSupport/ensureType ../../../../../core/handleUtils ../../../../../core/accessorSupport/decorators/property ../../../../../core/jsonMap ../../../../../core/accessorSupport/decorators/subclass ../../../../../core/urlUtils ../../../../../core/uuid ../../../../../portal/support/resourceExtension ../../../../../core/Evented ../../../../../core/Collection ../../../../../core/Handles ../../../../../support/elevationInfoUtils ../../../../../layers/graphics/dehydratedFeatures ../../../../interactive/dragEventPipeline ../../../../interactive/InteractiveToolBase ../../manipulatorUtils ./isSupportedGraphic ../manipulatorUtils ../../visualElements/OutlineVisualElement ../../../layers/graphics/GraphicState ../visualElementUtils ../manipulations/config ../manipulations/moveUtils ../manipulations/MoveManipulation ../manipulations/MoveXYGraphicManipulation".split(" "),
function(k,v,p,U,w,V,W,E,r,X,F,Y,Z,aa,G,H,x,I,J,y,K,L,M,N,z,O,P,Q,R,A,S){let B=function(l){this.allGraphics=l;this.type="graphic-move-start"},C=function(l,n,h){this.dx=l;this.dy=n;this.allGraphics=h;this.type="graphic-move"},t=function(l){this.allGraphics=l;this.type="graphic-move-stop"};k.GraphicMoveTool=function(l){function n(a){a=l.call(this,a)||this;a.graphics=new H;a.enableZ=!0;a.type="move-3d";a._toolHandles=new x;a._handles=new x;return a}v._inheritsLoose(n,l);var h=n.prototype;h.initialize=
function(){this._toolHandles.add([this.graphics.on("change",()=>this._refreshManipulators())]);this._refreshManipulators()};h.destroy=function(){this._handles.destroy();this._handles=null;this._toolHandles.destroy();this._toolHandles=null;this.graphics.removeAll();this._set("view",null)};h.reset=function(){};h._refreshManipulators=function(){this._handles.removeAll();this._moveManipulation&&this._moveManipulation.destroy();this.manipulators.removeAll();const a=this.graphics.toArray().filter(b=>0===
M.isSupportedGraphic(b)).map(b=>new T(b));a.length&&(this.createManipulators(a),this.createVisualElements(a),this._handles.add(a.map(b=>this.view.trackGraphicState(b.state))),this.updateMoveManipulation(a))};h.createManipulators=function(a){for(const b of a){const g=b.state;b.manipulationXY=new S.MoveXYGraphicManipulation({tool:this,view:this.view,graphicState:g});b.manipulationXY.forEachManipulator(f=>this._handles.add(f.events.on("immediate-click",d=>{this.emit("immediate-click",{...d,graphic:g.graphic});
d.stopPropagation()})));this._handles.add(b.manipulationXY.createDragPipeline((f,d,c)=>this.buildDragEventPipeline(f,d,c,a)))}this.createMoveManipulation(a)};h.createMoveManipulation=function(a){const b=new A.MoveManipulation({tool:this,view:this.view,snapToScene:!1,xyAvailable:!0,xyAxisAvailable:!0,zAvailable:!0,radius:1===a.length?A.MoveManipulation.radiusForSymbol(a[0].graphic.symbol):Q.DISC_RADIUS});this._moveManipulation=b;b.elevationInfo={mode:"absolute-height",offset:0};b.forEachManipulator(d=>
{this._handles.add(d.events.on("immediate-click",c=>{b.zManipulation.hasManipulator(d)||1!==this.graphics.length||this.emit("immediate-click",{...c,graphic:this.graphics.getItemAt(0)});c.stopPropagation()}))});const g=()=>this.updateMoveManipulation(a);for(const d of a)this._handles.add([d.state.on("changed",g),d.state.watch("displaying",g)]);const f=a[a.length-1];this._handles.add(f.state.on("changed",()=>this.updateMoveManipulationAngle(f)));this._handles.add(b.createDragPipeline((d,c,q)=>{this.buildDragEventPipeline(d,
c,q,a)},I.getGraphicEffectiveElevationInfo(f.graphic),w.unwrap(f.graphic.geometry).spatialReference));this.updateMoveManipulationAngle(f)};h.createVisualElements=function(a){for(const b of a){const g=P.createVisualElements({view:this.view,graphic:b.graphic,forEachManipulator:f=>{b.manipulationXY.forEachManipulator(f);this._moveManipulation.forEachManipulator(f)},onManipulatorsChanged:()=>E.makeHandle()});b.geometryRepresentation=g.visualElement;b.geometryRepresentation instanceof z.OutlineVisualElement&&
this._handles.add([b.geometryRepresentation.events.on("attachment-origin-changed",()=>{b.state.isDraped||this.updateMoveManipulation(a)}),b.state.watch("isDraped",()=>this.updateMoveManipulation(a))]);this._handles.add(g)}};h.updateMoveManipulationAngle=function(a){this._moveManipulation.angleDeferred=()=>R.primaryShapeOrientation(a.graphic.geometry)};h.updateMoveManipulation=function(a){const b=J.makeDehydratedPoint(0,0,0,this.view.spatialReference);let g=0,f=!1;const d=this._moveManipulation;for(const c of a)c.state.displaying&&
(a=c.state.graphic,this.enableZ&&N.canMoveZ(a)&&(f=!0),a=c.geometryRepresentation instanceof z.OutlineVisualElement&&!c.state.isDraped?c.geometryRepresentation.attachmentOrigin:L.getGraphicAttachmentOrigin(this.view,a),w.isSome(a)&&(b.x+=a.x,b.y+=a.y,b.z+=a.z,g++));0<g?(b.x/=g,b.y/=g,b.z/=g,d.location=b,d.xyManipulation.available=!0,d.xyAxisManipulation.available=!0,d.zManipulation.available=f):d.available=!1};h.buildDragEventPipeline=function(a,b,g,f){const d=[],c=[];let q=null,u=null;const D=()=>
{for(const e of d)e.dragging=!1;d.length=0;c.length=0;u=q=null;this._moveManipulation.interactive=!0};b.next(e=>{if("start"===e.action){d.length=0;c.length=0;for(const m of f)m.dragging||!m.manipulationXY.hasManipulator(a)&&m.manipulationXY.grabbing||(d.push(m),c.push(m.graphic),m.dragging=!0);if(0!==c.length&&(this._moveManipulation.interactive=!1,q=y.dragGraphicMany(c),u=y.resetGraphicMany(c),this.emit("graphic-move-start",new B(c)),this.destroyed))return null}return 0!==c.length?e:null}).next(e=>
q(e)).next(e=>{switch(e.action){case "start":case "update":if(e.translationX||e.translationY||e.translationZ){const m=this.view.toScreen(e.mapStart);e=this.view.toScreen(e.mapEnd);this.emit("graphic-move",new C(e.x-m.x,e.y-m.y,c));if(this.destroyed)return null}break;case "end":this.emit("graphic-move-stop",new t(c));if(this.destroyed)return null;D()}});g.next(e=>u(e)).next(()=>{this.emit("graphic-move-stop",new t(c));if(this.destroyed)return null;D()})};return n}(G.EventedMixin(K.InteractiveToolBase));
p.__decorate([r.property({constructOnly:!0,nonNullable:!0})],k.GraphicMoveTool.prototype,"view",void 0);p.__decorate([r.property({readOnly:!0})],k.GraphicMoveTool.prototype,"graphics",void 0);p.__decorate([r.property({constructOnly:!0,nonNullable:!0})],k.GraphicMoveTool.prototype,"enableZ",void 0);p.__decorate([r.property({readOnly:!0})],k.GraphicMoveTool.prototype,"type",void 0);k.GraphicMoveTool=p.__decorate([F.subclass("esri.views.3d.interactive.editingTools.graphicMove3D.GraphicMoveTool")],k.GraphicMoveTool);
let T=function(){function l(n){this.manipulationXY=this.geometryRepresentation=this.state=null;this.dragging=!1;this.state=new O.GraphicState({graphic:n})}v._createClass(l,[{key:"graphic",get:function(){return this.state.graphic}}]);return l}();k.GraphicMoveEvent=C;k.GraphicMoveStartEvent=B;k.GraphicMoveStopEvent=t;Object.defineProperty(k,"__esModule",{value:!0})});