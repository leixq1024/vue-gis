// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.18/esri/copyright.txt for details.
//>>built
define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../../../../../core/maybe","../../../../../core/Evented","./EditGeometry"],function(l,q,g,n,k){n=function(h){function f(a,c){var d=h.call(this)||this;d.data=a;d.type=c;d._dirty=!0;d._geometry=null;return d}q._inheritsLoose(f,h);var b=f.prototype;b.splitEdge=function(a,c){a=new r(this,a,c);this.data.apply(a);this._dirty=!0;return a};b.moveVertices=function(a,c,d,e){let m=null;this.data.lastOperation instanceof p&&this.data.lastOperation.canAccumulate(a)?
(m=this.data.lastOperation,m.accumulate(c,d,e)):(m=new p(this,a,c,d,e),this.data.apply(m));this._dirty=!0;return m};b.removeVertices=function(a){let c=0;switch(this.type){case "point":c=1;break;case "polyline":c=2;break;case "polygon":c=3}a=new t(this,a,c);this.data.apply(a);this._dirty=!0;return a};b.appendVertex=function(a){if(0===this.data.components.length)return null;a=new u(this,this.data.components[0],a);this.data.apply(a);this._dirty=!0;return a};b.canRemoveVertex=function(){let a=0;switch(this.type){case "point":a=
1;break;case "polyline":a=2;break;case "polygon":a=3}return this.data.components[0].vertices.length>a};b.undo=function(){this.data.undo();this._dirty=!0};b.redo=function(){this.data.redo();this._dirty=!0};q._createClass(f,[{key:"canUndo",get:function(){return this.data.canUndo}},{key:"canRedo",get:function(){return this.data.canRedo}},{key:"geometry",get:function(){if(this._dirty){switch(this.type){case "point":this._geometry=this.data.toPoint();break;case "polyline":this._geometry=this.data.toPolyline();
break;case "polygon":this._geometry=this.data.toPolygon()}this._dirty=!1}return this._geometry}}]);return f}(n);let r=function(){function h(b,a,c){this.helper=b;this.edge=a;this.t=c;this.right=this.left=this.createdVertex=null}var f=h.prototype;f.apply=function(){let b="redo";const a=this.edge,c=a.component,d=a.component.data,e=a.left,m=a.right;c.edges.splice(c.edges.indexOf(a),1);g.isNone(this.createdVertex)&&(b="apply",this.createdVertex=new k.Vertex(a.component));c.vertices.push(this.createdVertex);
this.createdVertex.pos=d.coordinateHelper.lerp(a.left.pos,a.right.pos,this.t,d.coordinateHelper.createNew());g.isNone(this.left)&&(this.left=new k.Edge(c,e,this.createdVertex));this.left.left.left?c.edges.push(this.left):c.edges.unshift(this.left);e.right=this.left;g.isNone(this.right)&&(this.right=new k.Edge(c,this.createdVertex,m));c.edges.push(this.right);m.left=this.right;c.updateVertexIndex(this.createdVertex,e.index+1);this.helper.emit("vertex-add",{type:"vertex-add",vertices:[this.createdVertex],
operation:b})};f.undo=function(){if(g.isNone(this.createdVertex)||g.isNone(this.left)||g.isNone(this.right))return null;const b=this.edge,a=b.component,c=this.createdVertex.left.left,d=this.createdVertex.right.right;a.vertices.splice(a.vertices.indexOf(this.createdVertex),1);a.edges.splice(a.edges.indexOf(this.left),1);a.edges.splice(a.edges.indexOf(this.right),1);this.edge.left.left?a.edges.push(this.edge):a.edges.unshift(this.edge);c.right=b;d.left=b;a.updateVertexIndex(c,c.index);this.helper.emit("vertex-remove",
{type:"vertex-remove",vertices:[this.createdVertex],operation:"undo"})};return h}(),p=function(){function h(b,a,c,d,e){this.helper=b;this.applied=!1;this.vertices=a;this.dx=c;this.dy=d;this.dz=e}var f=h.prototype;f.apply=function(){this.vertices.forEach(b=>{this.helper.data.coordinateHelper.addDelta(b.pos,this.dx,this.dy,this.dz)});this.helper.data.components.forEach(b=>{b.unnormalizeVertexPositions()});this.helper.emit("vertex-update",{type:"vertex-update",vertices:this.vertices,operation:this.applied?
"redo":"apply"});this.applied=!0};f.undo=function(){this.vertices.forEach(b=>{this.helper.data.coordinateHelper.addDelta(b.pos,-this.dx,-this.dy,-this.dz)});this.helper.emit("vertex-update",{type:"vertex-update",vertices:this.vertices,operation:"undo"})};f.canAccumulate=function(b){if(b.length!==this.vertices.length)return!1;for(let a=0;a<b.length;++a)if(b[a]!==this.vertices[a])return!1;return!0};f.accumulate=function(b,a,c){this.vertices.forEach(d=>{this.helper.data.coordinateHelper.addDelta(d.pos,
b,a,c)});this.dx+=b;this.dy+=a;this.dz+=c;this.helper.emit("vertex-update",{type:"vertex-update",vertices:this.vertices,operation:"apply"})};return h}(),t=function(){function h(b,a,c=0){this.helper=b;this.removedVertices=null;this._minNumberOfVertices=0;this.vertices=a;this._minNumberOfVertices=c}var f=h.prototype;f.apply=function(){let b="redo";null==this.removedVertices?(this.removedVertices=[],this.vertices.forEach(a=>{a=this._removeVertex(a);g.isSome(a)&&this.removedVertices.push(a)}),b="apply"):
this.removedVertices.forEach(a=>{this._redoRemoveVertex(a)});this.helper.emit("vertex-remove",{type:"vertex-remove",vertices:this.vertices,operation:b})};f.undo=function(){this.removedVertices.forEach(b=>{this._undoRemoveVertex(b)});this.helper.emit("vertex-add",{type:"vertex-add",vertices:this.vertices,operation:"undo"})};f._removeVertex=function(b){const a=b.component;if(a.vertices.length<=this._minNumberOfVertices)return null;const c={removedVertex:b,createdEdge:null},d=b.left,e=b.right;a.vertices.splice(a.vertices.indexOf(b),
1);d&&(a.edges.splice(a.edges.indexOf(d),1),d.left.right=null);e&&(a.edges.splice(a.edges.indexOf(e),1),e.right.left=null);0===b.index&&e&&0<this.vertices.length&&a.swapVertices(a.vertices.indexOf(e.right),0);d&&e&&(c.createdEdge=new k.Edge(a,d.left,e.right),a.edges.push(c.createdEdge));e&&a.updateVertexIndex(e.right,e.right.index-1);return c};f._redoRemoveVertex=function(b){console.warn("redo remove vertex not implemented yet")};f._undoRemoveVertex=function(b){const a=b.removedVertex,c=b.removedVertex.component,
d=a.left,e=a.right;b.createdEdge&&c.edges.splice(c.edges.indexOf(b.createdEdge),1);c.vertices.push(a);d&&(c.edges.push(d),d.left.right=d);e&&(c.edges.push(e),e.right.left=e);c.updateVertexIndex(a,a.index)};return h}(),u=function(){function h(b,a,c){this.helper=b;this.component=a;this.pos=c;this.right=this.left=this.originalEdge=this.addedVertex=null}var f=h.prototype;f.apply=function(){let b="redo";g.isNone(this.addedVertex)&&(b="apply",this.addedVertex=new k.Vertex(this.component));if(0===this.component.vertices.length)this.component.vertices.push(this.addedVertex),
this.addedVertex.pos=this.pos,this.addedVertex.index=0;else{const a=g.unwrap(this.component.findEndVertex());let c=null;a.right&&(this.originalEdge=a.right,c=this.originalEdge.right,this.component.edges.splice(this.component.edges.indexOf(this.originalEdge),1));this.component.vertices.push(this.addedVertex);this.addedVertex.pos=this.pos;g.isNone(this.left)&&(this.left=new k.Edge(this.component,a,this.addedVertex));this.component.edges.push(this.left);a.right=this.left;g.isSome(this.originalEdge)&&
g.isSome(c)&&(g.isNone(this.right)&&(this.right=new k.Edge(this.component,this.addedVertex,c)),this.component.edges.push(this.right),c.left=this.right);this.component.updateVertexIndex(this.addedVertex,a.index+1)}this.helper.emit("vertex-add",{type:"vertex-add",vertices:[this.addedVertex],operation:b})};f.undo=function(){if(g.isNone(this.addedVertex))return null;this.component.vertices.splice(this.component.vertices.indexOf(this.addedVertex),1);g.isSome(this.left)&&(this.component.edges.splice(this.component.edges.indexOf(this.left),
1),this.left.left.right=null);g.isSome(this.right)&&(this.component.edges.splice(this.component.edges.indexOf(this.right),1),this.right.right.left=null);g.isSome(this.originalEdge)&&(this.component.edges.push(this.originalEdge),this.originalEdge.left.right=this.originalEdge,this.originalEdge.right.left=this.originalEdge);g.isSome(this.left)?this.component.updateVertexIndex(this.left.left,this.left.left.index):this.component.updateVertexIndex(this.addedVertex,0);this.helper.emit("vertex-remove",{type:"vertex-remove",
vertices:[this.addedVertex],operation:"undo"})};return h}();l.Component=k.Component;l.Edge=k.Edge;l.EditGeometry=k.EditGeometry;l.Vertex=k.Vertex;l.AppendVertexOperation=u;l.EditGeometryHelper=n;l.RemoveVerticesOperation=t;l.SplitEdgeOperation=r;l.UpdateVerticesOperation=p;Object.defineProperty(l,"__esModule",{value:!0})});