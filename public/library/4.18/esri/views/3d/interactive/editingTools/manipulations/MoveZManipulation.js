// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.18/esri/copyright.txt for details.
//>>built
define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/maybe ../../../../../core/Evented ../../../../../core/mathUtils ../../../../../chunks/vec3f64 ../../../../../chunks/vec3 ../../../../../core/Handles ../../../../../core/colorUtils ../../../../../chunks/mat4 ../../../../../chunks/mat4f64 ../../../webgl-engine/lib/GeometryUtil ../../../webgl-engine/lib/Geometry ../../../../interactive/dragEventPipeline ../dragEventPipeline3D ../../Manipulator3D ../../manipulatorUtils ../settings ./config ./Manipulation ./moveUtils".split(" "),
function(z,A,I,J,K,p,m,L,M,w,N,B,C,D,O,P,t,l,x,y,Q){y=function(E){function u(a){var b=E.call(this)||this;b._handles=new L;b._radius=x.DISC_RADIUS;b.events=new J;b._tool=a.tool;b._view=a.view;null!=a.radius&&(b._radius=a.radius);b.createManipulator();b.forEachManipulator(e=>b._tool.manipulators.add(e));return b}A._inheritsLoose(u,E);var q=u.prototype;q.destroy=function(){this._handles.destroy();this.forEachManipulator(a=>{this._tool.manipulators.remove(a);a.destroy()})};q.forEachManipulator=function(a){a(this._manipulator,
0)};q.createGraphicDragPipeline=function(a,b){const e=I.unwrap(a.graphic.geometry).spatialReference;return Q.createGraphicMoveDragPipeline(a,b,c=>this.createDragPipeline(c,e))};q.createDragPipeline=function(a,b){const e=this._view;return D.createManipulatorDragEventPipeline(this._manipulator,(c,f,k,g,d)=>{f=f.next(v=>({...v,manipulatorType:0})).next(O.screenToZConstrained(e,c.renderLocation,b)).next(D.addScreenDelta());a(c,f,k,g,d)})};q.updateManipulator=function(){var a=this._radius/x.DISC_RADIUS;
const b=l.settings.zManipulator.height*a;var e=l.settings.zManipulator.coneHeight*a;const c=l.settings.zManipulator.coneWidth*a;a*=l.settings.zManipulator.width;var f=[p.fromValues(0,0,0),p.fromValues(0,0,b)];f=new C(B.createTubeGeometry(f,a/2,16,!1),"move-z");var k=B.createConeGeometry(e,c/2,16,!1);k=new C(k);e=[p.fromValues(0,0,0),p.fromValues(0,0,b+e)];const g=(n=>{const h=N.create();w.translate(h,h,[0,0,b]);w.rotateX(h,h,Math.PI/2);n&&(n=1+2*n/c,w.scale(h,h,[n,n,n]));return h})(0);var d=(n,h)=>
{h=M.darken(l.settings.zManipulator.color,h);return[h.r/255,h.g/255,h.b/255,l.settings.zManipulator.color.a*n]};const v=t.createManipulatorMaterial(d(1,.25),1),F=t.createManipulatorMaterial(d(1,0),1),G=t.createManipulatorMaterial(d(.7,0),l.settings.zManipulator.renderOccluded);d=t.createManipulatorMaterial(d(.85,0),l.settings.zManipulator.renderOccluded);this._manipulator.renderObjects=[{geometry:k,transform:g,material:v,stateMask:1},{geometry:f,material:v,stateMask:1},{geometry:k,transform:g,material:F,
stateMask:2},{geometry:f,material:F,stateMask:2},{geometry:k,transform:g,material:G,stateMask:1},{geometry:f,material:G,stateMask:1},{geometry:k,transform:g,material:d,stateMask:2},{geometry:f,material:d,stateMask:2}];this._manipulator.radius=a/2+2;this._manipulator.collisionType={type:"line",paths:[e]}};q.createManipulator=function(){const a=new P.Manipulator3D({view:this._view,autoScaleRenderObjects:!1,worldSized:!1,selectable:!1,cursor:"ns-resize",elevationInfo:this.elevationInfo,worldOriented:!0,
collisionPriority:1.6});a.applyObjectTransform=b=>{var e=this._view.state.camera,c=H;this._view.renderCoordsHelper.toRenderCoords(this._manipulator.elevationAlignedLocation,c);const f=m.dist(e.eye,c),k=e.computeRenderPixelSizeAtDist(f);var g=m.subtract(r,c,e.eye);m.normalize(g,g);var d=R;this._view.renderCoordsHelper.worldUpAtPosition(H,d);c=Math.abs(m.dot(g,d));g=m.cross(r,g,d);d=m.cross(r,g,d);c=K.clamp(c,.01,1);e=1-Math.sqrt(1-c*c)/c/e.fullWidth;c=this._radius/x.DISC_RADIUS*l.settings.zManipulator.width;
m.scale(d,m.normalize(d,d),(1/e-1)*f+k*c);b[12]-=r[0];b[13]-=r[1];b[14]-=r[2]};this._manipulator=a;this.updateManipulator()};A._createClass(u,[{key:"radius",get:function(){return this._radius},set:function(a){a!==this._radius&&(this._radius=a,this.updateManipulator())}}]);return u}(y.Manipulation);const H=p.create(),r=p.create(),R=p.create();z.MoveZManipulation=y;Object.defineProperty(z,"__esModule",{value:!0})});