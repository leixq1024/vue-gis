// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.18/esri/copyright.txt for details.
//>>built
define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/has ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/property ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../core/urlUtils ../../../core/uuid ../../../portal/support/resourceExtension ../../../core/Accessor ../../../geometry/support/webMercatorUtils ../../../core/Handles ../../../core/watchUtils ../../../geometry/support/aaBoundingRect ../../../layers/support/layerUtils ./TerrainConst ./terrainUtils".split(" "),
function(n,r,e,d,E,F,l,G,u,H,I,J,A,w,B,C,h,D,x,y){function z(c,b){c&&!c.spatialReference.equals(b)&&(c=w.canProject(c.spatialReference,b)?w.project(c,b):null);return c}d=function(c){function b(a){a=c.call(this,a)||this;a._handles=new B;return a}r._inheritsLoose(b,c);var f=b.prototype;f.initialize=function(){this._handles.add([this.layerViews.on("change",()=>this.notifyChange("stencilEnabledExtents"))])};f.destroy=function(){this._handles.destroy();this._handles=null};f._computeStencilEnabledExtents=
function(a,g){const k=[];for(const p of a.items)a=p.layer,"IntegratedMeshLayer"===a.operationalLayerType&&null!=g&&(a=z(a.fullExtent,g),null!=a&&k.push(h.fromExtent(a)));return k};r._createClass(b,[{key:"layerViewsExtent",get:function(){return this._computeLayerViewsExtent()}},{key:"tiledLayersExtent",get:function(){return this._computeTiledLayersExtent()}},{key:"stencilEnabledExtents",get:function(){return this._computeStencilEnabledExtents(this.layerViews,this.spatialReference)}},{key:"spatialReference",
set:function(a){this.tilingScheme||this._set("spatialReference",a)}},{key:"tilingScheme",set:function(a){this._set("tilingScheme",a);this._set("spatialReference",a.spatialReference)}}]);return b}(A);e.__decorate([l.property({readOnly:!0,dependsOn:[],autoTracked:!1})],d.prototype,"layerViewsExtent",null);e.__decorate([l.property({readOnly:!0,dependsOn:["spatialReference","tilingScheme"],autoTracked:!1})],d.prototype,"tiledLayersExtent",null);e.__decorate([l.property({readOnly:!0,dependsOn:["spatialReference"],
autoTracked:!1})],d.prototype,"stencilEnabledExtents",null);e.__decorate([l.property()],d.prototype,"spatialReference",null);e.__decorate([l.property()],d.prototype,"tilingScheme",null);e.__decorate([l.property()],d.prototype,"defaultTiledLayersExtent",void 0);e.__decorate([l.property({constructOnly:!0})],d.prototype,"layers",void 0);e.__decorate([l.property({constructOnly:!0})],d.prototype,"layerViews",void 0);d=e.__decorate([u.subclass("esri.views.3d.terrain.SurfaceExtentHelperBase")],d);n.SurfaceExtentHelperGlobal=
function(c){function b(){return c.apply(this,arguments)||this}r._inheritsLoose(b,c);var f=b.prototype;f._computeLayerViewsExtent=function(){return this._getGlobalExtent()};f._computeTiledLayersExtent=function(){return this._getGlobalExtent()};f._getGlobalExtent=function(){return this.spatialReference.isWebMercator?x.WEBMERCATOR_WORLD_EXTENT:x.GEOGRAPHIC_WORLD_EXTENT};return b}(d);e.__decorate([l.property({dependsOn:["spatialReference"]})],n.SurfaceExtentHelperGlobal.prototype,"layerViewsExtent",void 0);
n.SurfaceExtentHelperGlobal=e.__decorate([u.subclass("esri.views.3d.terrain.SurfaceExtentHelperGlobal")],n.SurfaceExtentHelperGlobal);n.SurfaceExtentHelperLocal=function(c){function b(){return c.apply(this,arguments)||this}r._inheritsLoose(b,c);var f=b.prototype;f.initialize=function(){this._handles.add([this.layers.on("change",a=>this._handleLayersChanged(a)),this.layerViews.on("change",()=>this.notifyChange("layerViewsExtent"))])};f._handleLayersChanged=function(a){for(const g of a.removed)this._handles.remove(g.uid);
for(const g of a.added)this._handles.add(C.init(g,"loaded",()=>this.notifyChange("tiledLayersExtent")),g.uid)};f._computeLayerViewsExtent=function(){const a=h.empty(),g=this.spatialReference;this.layerViews.forEach(m=>{m.isResolved()&&(m=z("fullExtentInLocalViewSpatialReference"in m&&m.fullExtentInLocalViewSpatialReference||m.layer.fullExtent,g))&&h.expand(a,m)});const k=h.allFinite(a)?a:null,p=this._get("layerViewsExtent");return h.equals(k,p)?p:k};f._computeTiledLayersExtent=function(){const a=
this.tilingScheme;if(!a)return null;const g=this.spatialReference,k=h.empty();this.layers.forEach(function(t){if(t.loaded&&D.isTiledLayer(t)){const {tileInfo:v,fullExtent:q}=y.getTiledLayerInfo(t,g,2);v&&y.isProjectableRasterLayer(t)&&q?h.expand(k,q):v&&a.compatibleWith(v)&&q&&q.spatialReference.equals(g)&&h.expand(k,q)}});this.defaultTiledLayersExtent&&h.expand(k,this.defaultTiledLayersExtent);const p=h.allFinite(k)?k:null,m=this._get("tiledLayersExtent");return h.equals(p,m)?m:p};return b}(d);n.SurfaceExtentHelperLocal=
e.__decorate([u.subclass("esri.views.3d.terrain.SurfaceExtentHelperLocal")],n.SurfaceExtentHelperLocal);Object.defineProperty(n,"__esModule",{value:!0})});