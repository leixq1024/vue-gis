// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.18/esri/copyright.txt for details.
//>>built
define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/has ../../core/maybe ../../core/Logger ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/property ../../core/jsonMap ../../core/accessorSupport/decorators/subclass ../../core/Error ../../core/urlUtils ../../core/uuid ../../portal/support/resourceExtension ../../core/promiseUtils ../../support/arcadeOnDemand ../../renderers/support/clickToleranceUtils ./support/popupUtils".split(" "),
function(r,A,h,F,t,G,H,l,I,B,C,J,K,L,m,D,E,u){r.MapImageLayerView=c=>{c=function(n){function p(){return n.apply(this,arguments)||this}A._inheritsLoose(p,n);var q=p.prototype;q.fetchPopupFeatures=async function(d,e){var {layer:f}=this;if(!d)return m.reject(new C("mapimagelayerview:fetchPopupFeatures","Nothing to fetch without area",{layer:f}));const v=this.get("view.scale"),w=[],x=async a=>{var b=0===a.minScale||v<=a.minScale;const g=0===a.maxScale||v>=a.maxScale;a.visible&&b&&g&&(a.sublayers?a.sublayers.forEach(x):
a.popupEnabled&&(b=u.getFetchPopupTemplate(a,{...e,defaultPopupTemplateEnabled:!1}),t.isSome(b)&&w.push({sublayer:a,popupTemplate:b})))};f=f.sublayers.toArray().map(x);await m.all(f);f=w.map(async({sublayer:a,popupTemplate:b})=>{await a.load().catch(()=>{});const g=a.createQuery();var k=t.isSome(e)?e.event:null;k=E.calculateTolerance({renderer:a.renderer,event:k});const y=this.createFetchPopupFeaturesQueryGeometry(d,k);g.geometry=y;g.outFields=await u.getRequiredFields(a,b);const z=await this._loadArcadeModules(b);
z&&z.arcadeUtils.hasGeometryOperations(b)||(g.maxAllowableOffset=y.width/k);return(await a.queryFeatures(g)).features});return(await m.eachAlways(f)).reduce((a,b)=>b.value?[...a,...b.value]:a,[]).filter(a=>null!=a)};q.canResume=function(){var d,e;return!n.prototype.canResume.call(this)||null!=(d=this.imageParameters)&&null!=(e=d.timeExtent)&&e.isEmpty?!1:!0};q._loadArcadeModules=function(d){if(d.get("expressionInfos.length"))return D.loadArcade()};return p}(c);h.__decorate([l.property()],c.prototype,
"imageParameters",void 0);h.__decorate([l.property()],c.prototype,"layer",void 0);h.__decorate([l.property({dependsOn:["imageParameters.timeExtent"]})],c.prototype,"suspended",void 0);return c=h.__decorate([B.subclass("esri.views.layers.MapImageLayerView")],c)};Object.defineProperty(r,"__esModule",{value:!0})});