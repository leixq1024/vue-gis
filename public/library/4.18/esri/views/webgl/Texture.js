// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.18/esri/copyright.txt for details.
//>>built
define(["../../chunks/_rollupPluginBabelHelpers","../../core/maybe","../../core/mathUtils"],function(q,n,p){let r=0;return function(){function g(a,b,f=null){this._glName=this._context=null;this.id=r++;this._descriptor=void 0;this._wrapModeDirty=this._samplingModeDirty=!1;this._boundToUnits=new Set;a.instanceCounter.increment(0,this);this._context=a;this._descriptor={target:3553,samplingMode:9729,wrapMode:10497,flipped:!1,hasMipmap:!1,isOpaque:!1,unpackAlignment:4,preMultiplyAlpha:!1,...b};this.setData(f)}
var l=g.prototype;l.dispose=function(){if(this._context&&this._context.gl){if(this._glName){const a=this._context.gl;this._boundToUnits.forEach(b=>{this._context.bindTexture(null,b)});a.deleteTexture(this._glName);this._glName=null}this._context.instanceCounter.decrement(0,this);this._context=null}};l.release=function(){this.dispose()};l.resize=function(a,b){const f=this._descriptor;if(f.width!==a||f.height!==b)f.width=a,f.height=b,this.setData(null)};l.setData=function(a){if(this._context&&this._context.gl){var b=
this._context.gl;this._glName||(this._glName=b.createTexture());void 0===a&&(a=null);null===a&&(this._descriptor.width=this._descriptor.width||4,this._descriptor.height=this._descriptor.height||4);var f=this._context.getBoundTexture(0);this._context.bindTexture(this,0);var c=this._descriptor;g._validateTexture(c);b.pixelStorei(b.UNPACK_ALIGNMENT,c.unpackAlignment);b.pixelStorei(b.UNPACK_FLIP_Y_WEBGL,c.flipped?1:0);b.pixelStorei(b.UNPACK_PREMULTIPLY_ALPHA_WEBGL,c.preMultiplyAlpha?1:0);var h=c.pixelFormat,
k=c.internalFormat?c.internalFormat:h;if(a instanceof ImageData||a instanceof HTMLImageElement||a instanceof HTMLCanvasElement||a instanceof HTMLVideoElement){var e=a.width,d=a.height;a instanceof HTMLVideoElement&&(e=a.videoWidth,d=a.videoHeight);c.width&&c.height&&console.assert(e===c.width&&d===c.height);b.texImage2D(b.TEXTURE_2D,0,k,h,c.dataType,a);c.hasMipmap&&this.generateMipmap();void 0===c.width&&(c.width=e);void 0===c.height&&(c.height=d)}else{null!=c.width&&null!=c.height||console.error("Width and height must be specified!");
b.DEPTH24_STENCIL8&&k===b.DEPTH_STENCIL&&(k=b.DEPTH24_STENCIL8);e=c.width;d=c.height;var m=a;if(n.isSome(m)&&"type"in m&&"compressed"===m.type)for(h=Math.round(Math.log(Math.max(e,d))/Math.LN2)+1,c.hasMipmap=c.hasMipmap&&h===a.levels.length,h=0;;++h){b.compressedTexImage2D(b.TEXTURE_2D,h,k,e,d,0,a.levels[Math.min(h,a.levels.length-1)]);if(1===e&&1===d||!c.hasMipmap)break;e=Math.max(1,e>>1);d=Math.max(1,d>>1)}else if(n.isSome(a))b.texImage2D(b.TEXTURE_2D,0,k,e,d,0,h,c.dataType,a),c.hasMipmap&&this.generateMipmap();
else for(a=0;;++a){b.texImage2D(b.TEXTURE_2D,a,k,e,d,0,h,c.dataType,null);if(1===e&&1===d||!c.hasMipmap)break;e=Math.max(1,e>>1);d=Math.max(1,d>>1)}}g._applySamplingMode(b,this._descriptor);g._applyWrapMode(b,this._descriptor);g._applyAnisotropicFilteringParameters(this._context,this._descriptor);this._context.bindTexture(f,0)}};l.updateData=function(a,b,f,c,h,k){k||console.error("An attempt to use uninitialized data!");this._glName||console.error("An attempt to update uninitialized texture!");const e=
this._context.gl,d=this._descriptor,m=this._context.getBoundTexture(0);this._context.bindTexture(this,0);(0>b||0>f||c>d.width||h>d.height||b+c>d.width||f+h>d.height)&&console.error("An attempt to update out of bounds of the texture!");e.pixelStorei(e.UNPACK_ALIGNMENT,d.unpackAlignment);e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,d.flipped?1:0);e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,d.preMultiplyAlpha?1:0);k instanceof ImageData||k instanceof HTMLImageElement||k instanceof HTMLCanvasElement||k instanceof
HTMLVideoElement?e.texSubImage2D(e.TEXTURE_2D,a,b,f,d.pixelFormat,d.dataType,k):e.texSubImage2D(e.TEXTURE_2D,a,b,f,c,h,d.pixelFormat,d.dataType,k);this._context.bindTexture(m,0)};l.generateMipmap=function(){var a=this._descriptor;a.hasMipmap||(this._samplingModeDirty=a.hasMipmap=!0,g._validateTexture(a));9729===a.samplingMode?(this._samplingModeDirty=!0,a.samplingMode=9985):9728===a.samplingMode&&(this._samplingModeDirty=!0,a.samplingMode=9984);a=this._context.getBoundTexture(0);this._context.bindTexture(this,
0);const b=this._context.gl;b.generateMipmap(b.TEXTURE_2D);this._context.bindTexture(a,0)};l.setSamplingMode=function(a){a!==this._descriptor.samplingMode&&(this._descriptor.samplingMode=a,g._validateTexture(this._descriptor),this._samplingModeDirty=!0)};l.setWrapMode=function(a){a!==this._descriptor.wrapMode&&(this._descriptor.wrapMode=a,g._validateTexture(this._descriptor),this._wrapModeDirty=!0)};l.applyChanges=function(){const a=this._context.gl,b=this._descriptor;this._samplingModeDirty&&(g._applySamplingMode(a,
b),this._samplingModeDirty=!1);this._wrapModeDirty&&(g._applyWrapMode(a,b),this._wrapModeDirty=!1)};l.setBoundToUnit=function(a,b){b?this._boundToUnits.add(a):this._boundToUnits.delete(a)};g._validateTexture=function(a){(0>a.width||0>a.height)&&console.error("Negative dimension parameters are not allowed!");p.isPowerOfTwo(a.width)&&p.isPowerOfTwo(a.height)||("number"===typeof a.wrapMode?33071!==a.wrapMode&&console.error("Non-power-of-two textures must have a wrap mode of CLAMP_TO_EDGE!"):(33071!==
a.wrapMode.s||33071!==a.wrapMode.t)&&console.error("Non-power-of-two textures must have a wrap mode of CLAMP_TO_EDGE!"),a.hasMipmap&&console.error("Mipmapping requires power-of-two textures!"))};g._applySamplingMode=function(a,b){let f=b.samplingMode,c=b.samplingMode;if(9985===f||9987===f)f=9729,b.hasMipmap||(c=9729);else if(9984===f||9986===f)f=9728,b.hasMipmap||(c=9728);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,f);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,c)};g._applyWrapMode=function(a,
b){"number"===typeof b.wrapMode?(a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,b.wrapMode),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,b.wrapMode)):(a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,b.wrapMode.s),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,b.wrapMode.t))};g._applyAnisotropicFilteringParameters=function(a,b){if(null!=b.maxAnisotropy){var f=a.capabilities.textureFilterAnisotropic;f&&(a=a.gl,a.texParameterf(a.TEXTURE_2D,f.TEXTURE_MAX_ANISOTROPY,b.maxAnisotropy))}};q._createClass(g,[{key:"glName",
get:function(){return this._glName}},{key:"descriptor",get:function(){return this._descriptor}}]);return g}()});