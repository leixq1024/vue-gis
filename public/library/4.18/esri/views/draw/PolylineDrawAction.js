// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.18/esri/copyright.txt for details.
//>>built
define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/has ../../core/maybe ../../core/Logger ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/property ../../core/jsonMap ../../core/accessorSupport/decorators/subclass ../../core/urlUtils ../../core/uuid ../../portal/support/resourceExtension ../../core/Handles ../input/InputManager ../support/screenUtils ./DrawAction ./input/DrawEvents ./input/Keys ./DrawingMode ../3d/interactive/editingTools/draw/DrawTool".split(" "),
function(g,t,l,A,h,B,C,n,D,w,E,F,G,x,f,q,y,e,k,u,z){g.PolylineDrawAction=function(v){function p(a){a=v.call(this,a)||this;a._cursorScreenPoint=null;a._panEnabled=!1;a._cursorVertexAdded=!1;a._popVertexOnPointerMove=!1;a._addVertexOnPointerUp=!1;a._activePointerId=null;a._viewHandles=new x;a.mode=u.defaultDrawingMode;a.vertices=[];return a}t._inheritsLoose(p,v);var d=p.prototype;d.initialize=function(){"2d"===this.view.type?this._addViewHandles():this._addDrawTool(this.view)};d.destroy=function(){"2d"===
this.view.type?(this._removeViewHandles(),this._viewHandles.destroy()):this._removeDrawTool();this.emit("destroy")};d.addVertex=function(a,b){this.vertices.splice(b,0,a);this.history.push({vertex:a,vertexIndex:b,undo:()=>this._undoVertexAdd(null,b),redo:()=>this._redoVertexAdd(null,a,b)});this._set("redoHistory",[]);const c=new e.VertexAddEvent(this.view,null,b,this.vertices);this.emit("vertex-add",c);c.defaultPrevented&&(this._popVertexOnPointerMove=!0,this.history.pop())};d.removeVertex=function(a){const b=
this.vertices.splice(a,1)[0];this.history.push({vertex:b,vertexIndex:a,undo:()=>this._undoVertexRemove(null,b,a),redo:()=>this._redoVertexRemove(null,a)});this._set("redoHistory",[]);this.emit("vertex-remove",new e.VertexRemoveEvent(this.view,null,a,this.vertices))};d.updateVertex=function(a,b){const c=this.vertices[b];this.vertices[b]=a;this.history.push({vertex:a,vertexIndex:b,undo:()=>this._undoVertexUpdate(null,c,b),redo:()=>this._redoVertexUpdate(null,a,b)});this._set("redoHistory",[]);this.emit("vertex-update",
new e.VertexUpdateEvent(this.view,null,b,this.vertices))};d.complete=function(){"2d"===this.view.type?this._completeDrawing():this._drawTool.completeCreateOperation()};d._addViewHandles=function(){this._removeViewHandles();this._viewHandles.add([this.view.on("click",a=>{a.stopPropagation()},f.ViewEventPriorities.TOOL),this.view.on("pointer-down",a=>{this._shouldHandlePointerEvent(a)&&!this._panEnabled&&(this._activePointerId=a.pointerId,this._addVertexOnPointerUp=!0,this._cursorScreenPoint=q.createScreenPointFromEvent(a),
"touch"===a.pointerType&&this._updateCursor(a.native))},f.ViewEventPriorities.TOOL),this.view.on("pointer-move",a=>{this._popVertexOnPointerMove&&(this.vertices.pop(),this._popVertexOnPointerMove=!1);this._cursorScreenPoint=q.createScreenPointFromEvent(a);"touch"!==a.pointerType&&this._updateCursor(a.native)},f.ViewEventPriorities.TOOL),this.view.on("pointer-drag",a=>{this._shouldHandlePointerEvent(a)&&(this._cursorScreenPoint=q.createScreenPointFromEvent(a),this._dragEnabled&&!this._panEnabled?this._vertexAddHandler(a):
this._addVertexOnPointerUp=!1)},f.ViewEventPriorities.TOOL),this.view.on("pointer-up",a=>{this._shouldHandlePointerEvent(a)&&(this._activePointerId=null,this._addVertexOnPointerUp?this._clickEnabled?this._vertexAddHandler(a):(1===this.vertices.length&&this.vertices.pop(),this._drawCompleteHandler(a)):this._updateCursor(a.native,"touch"===a.pointerType))},f.ViewEventPriorities.TOOL),this.view.on("drag",a=>{this._dragEnabled&&h.isSome(this._activePointerId)&&!this._panEnabled&&a.stopPropagation()},
f.ViewEventPriorities.TOOL),this.view.on("drag",["Shift"],a=>{a.stopPropagation()},f.ViewEventPriorities.TOOL),this.view.on("double-click",a=>{a.stopPropagation();this._drawCompleteHandler(a)},f.ViewEventPriorities.TOOL),this.view.on("double-click",["Control"],a=>{a.stopPropagation();this._drawCompleteHandler(a)},f.ViewEventPriorities.TOOL),this.view.on("key-down",a=>{const {key:b,repeat:c}=a;b===k.KEYS.vertexAddKey&&!c&&this._cursorScreenPoint?(a.stopPropagation(),this._vertexAddHandler(a)):b===
k.KEYS.drawCompleteKey&&!c&&this._cursorScreenPoint&&1<this.vertices.length?(a.stopPropagation(),this._vertexAddHandler(a),this._drawCompleteHandler(a)):b!==k.KEYS.undoKey||this.interactiveUndoDisabled||c?b!==k.KEYS.redoKey||this.interactiveUndoDisabled||c?b!==k.KEYS.panKey||c||(a.stopPropagation(),this._panEnabled=!0):(a.stopPropagation(),this.redo()):(a.stopPropagation(),this.undo())},f.ViewEventPriorities.TOOL),this.view.on("key-up",a=>{a.key===k.KEYS.panKey&&(a.stopPropagation(),this._panEnabled=
!1)},f.ViewEventPriorities.TOOL)])};d._removeViewHandles=function(){this._viewHandles.removeAll()};d._addDrawTool=function(a){this._drawTool=new z.DrawTool({view:a,elevationInfo:this.elevationInfo,hasZ:this.hasZ,geometryType:"polyline",mode:this.mode});this.view.toolViewManager.tools.push(this._drawTool);this.view.activeTool=this._drawTool;this._drawTool.on("vertex-add",b=>{1===b.vertices.length&&this.emit("vertex-add",new e.VertexAddEvent(this.view,null,b.vertices[0].vertexIndex,this._drawTool.getVertexCoords()))});
this._drawTool.on("cursor-update",b=>{1===b.vertices.length&&this.emit("cursor-update",new e.CursorUpdateEvent(this.view,null,b.vertices[0].vertexIndex,this._drawTool.getVertexCoords()))});this._drawTool.on("complete",b=>{this.emit("draw-complete",new e.DrawCompleteEvent(null,this._drawTool.getVertexCoords()));this._removeDrawTool()})};d._removeDrawTool=function(){h.isSome(this._drawTool)&&(this.view.tools.remove(this._drawTool),this._drawTool=h.destroyMaybe(this._drawTool))};d._addVertex=function(a,
b){this._popCursorVertex();if(!this.isDuplicateVertex(this.vertices,a)){this.vertices.push(a);var c=this.vertices.length-1;this.history.push({vertex:a,vertexIndex:c,undo:()=>this._undoVertexAdd(b,c),redo:()=>this._redoVertexAdd(b,a,c)});this._set("redoHistory",[]);var m=new e.VertexAddEvent(this.view,b,c,this.vertices);this.emit("vertex-add",m);m.defaultPrevented&&(this._popVertexOnPointerMove=!0,this.history.pop())}};d._updateCursor=function(a,b=!1){this._popCursorVertex();if(this._cursorScreenPoint){var c=
null,m=null,r=this.getCoordsAndPointFromScreenPoint(this._cursorScreenPoint);h.isSome(r)&&(c=r.mapPoint,b||(m=this._pushCursorVertex(r.vertex)));a=new e.CursorUpdateEvent(this.view,a,m,this.vertices,c);this.emit("cursor-update",a)}};d._completeDrawing=function(a){this._activePointerId=null;this._popCursorVertex();2>this.vertices.length||(a=new e.DrawCompleteEvent(a,this.vertices),this.emit("draw-complete",a),a.defaultPrevented||this._removeViewHandles())};d._undoVertexAdd=function(a,b){this.vertices.splice(b,
1);this.emit("undo",new e.VertexRemoveEvent(this.view,a,b,this.vertices))};d._redoVertexAdd=function(a,b,c){this.vertices.splice(c,0,b);this.emit("redo",new e.VertexAddEvent(this.view,a,c,this.vertices))};d._undoVertexRemove=function(a,b,c){this.vertices.splice(c,0,b);this.emit("undo",new e.VertexAddEvent(this.view,a,c,this.vertices))};d._redoVertexRemove=function(a,b){this.vertices.splice(b,1);this.emit("redo",new e.VertexRemoveEvent(this.view,a,b,this.vertices))};d._undoVertexUpdate=function(a,
b,c){this.vertices[c]=b;this.emit("undo",new e.VertexUpdateEvent(this.view,a,c,this.vertices))};d._redoVertexUpdate=function(a,b,c){this.vertices[c]=b;this.emit("redo",new e.VertexUpdateEvent(this.view,a,c,this.vertices))};d._pushCursorVertex=function(a){this._popCursorVertex();this.vertices.push(a);this._cursorVertexAdded=!0;return this.vertices.length-1};d._popCursorVertex=function(){this._cursorVertexAdded&&(this.vertices.pop(),this._cursorVertexAdded=!1)};d._shouldHandlePointerEvent=function(a){return("mouse"!==
a.pointerType||0===a.button)&&(h.isNone(this._activePointerId)||this._activePointerId===a.pointerId)};d._vertexAddHandler=function(a){if(this._cursorVertexAdded)this._addVertex(this.vertices[this.vertices.length-1],a.native);else{const b=this.getCoordsFromScreenPoint(this._cursorScreenPoint);h.isSome(b)&&this._addVertex(b,a.native)}};d._drawCompleteHandler=function(a){this._completeDrawing(a.native)};t._createClass(p,[{key:"_clickEnabled",get:function(){return"click"===this.mode||"hybrid"===this.mode}},
{key:"_dragEnabled",get:function(){return"freehand"===this.mode||"hybrid"===this.mode}}]);return p}(y);l.__decorate([n.property({dependsOn:["mode"]})],g.PolylineDrawAction.prototype,"_clickEnabled",null);l.__decorate([n.property({dependsOn:["mode"]})],g.PolylineDrawAction.prototype,"_dragEnabled",null);l.__decorate([n.property({type:u.drawingModes})],g.PolylineDrawAction.prototype,"mode",void 0);l.__decorate([n.property({readOnly:!0})],g.PolylineDrawAction.prototype,"vertices",void 0);g.PolylineDrawAction=
l.__decorate([w.subclass("esri.views.draw.PolylineDrawAction")],g.PolylineDrawAction);Object.defineProperty(g,"__esModule",{value:!0})});