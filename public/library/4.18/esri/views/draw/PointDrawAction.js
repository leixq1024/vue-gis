// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.18/esri/copyright.txt for details.
//>>built
define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/has ../../core/maybe ../../core/Logger ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/property ../../core/jsonMap ../../core/accessorSupport/decorators/subclass ../../core/urlUtils ../../core/uuid ../../portal/support/resourceExtension ../../core/Handles ../input/InputManager ../support/screenUtils ../input/recognizers/PointerClickHoldAndDrag ./DrawAction ./input/DrawEvents ./input/Keys ../3d/interactive/editingTools/draw/DrawTool".split(" "),
function(e,n,k,x,d,y,z,p,A,q,B,C,D,r,f,l,t,u,g,v,w){e.PointDrawAction=function(m){function h(a){a=m.call(this,a)||this;a._clickDelay=t.DefaultParameters.maximumClickDelay;a._cursorMoved=!1;a._cursorScreenPoint=null;a._pointerDownEvent=null;a._viewHandles=new r;a.coordinates=[];return a}n._inheritsLoose(h,m);var c=h.prototype;c.initialize=function(){"2d"===this.view.type?this._addViewHandles():this._addDrawTool(this.view)};c.destroy=function(){"2d"===this.view.type?(this._removeViewHandles(),this._viewHandles.destroy()):
this._removeDrawTool();this.emit("destroy")};c.complete=function(){if("2d"===this.view.type){if(this._cursorScreenPoint){const a=this.getCoordsFromScreenPoint(this._cursorScreenPoint);d.isSome(a)&&(this._set("coordinates",a),this._completeDrawing())}}else this._drawTool.completeCreateOperation()};c._addViewHandles=function(){this._removeViewHandles();this._viewHandles.add([this.view.on("click",a=>{a.stopPropagation();const b=this.getCoordsFromScreenPoint(a.screenPoint);d.isSome(b)&&(this._set("coordinates",
b),this._drawCompleteHandler(a))},f.ViewEventPriorities.TOOL),this.view.on("pointer-down",a=>{this._pointerDownEvent=a;this._cursorMoved=!1},f.ViewEventPriorities.TOOL),this.view.on("pointer-move",a=>{this._cursorMoved=!0;this._cursorScreenPoint=l.createScreenPointFromEvent(a);this._cursorUpdateHandler(a)},f.ViewEventPriorities.TOOL),this.view.on("pointer-up",a=>{if(this._pointerDownEvent&&!this._cursorMoved&&a.timestamp-this._pointerDownEvent.timestamp>this._clickDelay){this._cursorScreenPoint=l.createScreenPointFromEvent(a);
const b=this.getCoordsFromScreenPoint(this._cursorScreenPoint);d.isSome(b)&&(this._set("coordinates",b),this._drawCompleteHandler(a))}},f.ViewEventPriorities.TOOL),this.view.on("key-down",a=>{if(a.key===v.KEYS.drawCompleteKey&&this._cursorScreenPoint){const b=this.getCoordsFromScreenPoint(this._cursorScreenPoint);d.isSome(b)&&(this._set("coordinates",b),this._drawCompleteHandler(a))}},f.ViewEventPriorities.TOOL)])};c._removeViewHandles=function(){this._viewHandles.removeAll()};c._addDrawTool=function(a){this._drawTool=
new w.DrawTool({view:a,elevationInfo:this.elevationInfo,hasZ:this.hasZ,geometryType:"point",mode:"click"});this.view.toolViewManager.tools.push(this._drawTool);this.view.activeTool=this._drawTool;this._drawTool.on("cursor-update",b=>{1===b.vertices.length&&this.emit("cursor-update",new g.CursorUpdateEvent(this.view,null,b.vertices[0].vertexIndex,this._drawTool.getVertexCoords()))});this._drawTool.on("complete",b=>{this.emit("draw-complete",new g.DrawCompleteEvent(null,this._drawTool.getVertexCoords()));
this._removeDrawTool()})};c._removeDrawTool=function(){d.isSome(this._drawTool)&&(this.view.tools.remove(this._drawTool),this._drawTool.destroy(),this._drawTool=null)};c._updateCursor=function(a,b){d.isSome(a)?this.emit("cursor-update",new g.CursorUpdateEvent(this.view,b,0,[a])):this.emit("cursor-update",new g.CursorUpdateEvent(this.view,b,null,null))};c._completeDrawing=function(a){this._cursorMoved=!1;this._pointerDownEvent=null;a=new g.DrawCompleteEvent(a,[this.coordinates]);this.emit("draw-complete",
a);a.defaultPrevented||this._removeViewHandles()};c._cursorUpdateHandler=function(a){this._updateCursor(this.getCoordsFromScreenPoint(this._cursorScreenPoint),a.native)};c._drawCompleteHandler=function(a){this._completeDrawing(a.native)};return h}(u);k.__decorate([p.property({readOnly:!0})],e.PointDrawAction.prototype,"coordinates",void 0);e.PointDrawAction=k.__decorate([q.subclass("esri.views.draw.PointDrawAction")],e.PointDrawAction);Object.defineProperty(e,"__esModule",{value:!0})});