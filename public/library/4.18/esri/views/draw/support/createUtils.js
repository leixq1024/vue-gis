// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.18/esri/copyright.txt for details.
//>>built
define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/lang ../../../core/maybe ../../../core/arrayUtils ../../../geometry/support/spatialReferenceUtils ../../../geometry/Point ../../../geometry/Multipoint ../../../geometry/support/coordsUtils ../../../geometry/Polygon ../../../geometry/Polyline ../../../geometry ../../../chunks/vec3f64 ../../../chunks/vec3 ../../../core/unitUtils ../../../chunks/quatf64 ../../../geometry/Circle ../../../geometry/geometryEngine ../../../chunks/quat ../../../chunks/mat2d ../../../chunks/mat2df64".split(" "),
function(k,t,F,y,G,z,p,H,u,I,J,v,m,n,K,A,L,B,C,M,w){function q(a,e,f=null){return y.isSome(f)?[a,e,f]:[a,e]}function g(a,e,f=null){return y.isSome(f)?{x:a,y:e,z:f}:{x:a,y:e}}function x(a,e){e=new p({x:a[0],y:a[1],spatialReference:e});2<a.length&&(e.z=a[2]);return e}function r(a,e,f,c=!0){a=F.clone(a);a.forEach(b=>{G.equals(b[0],b[b.length-1])&&1!==b.length||b.push(b[0])});a=new I({rings:a,spatialReference:e});a.rings.forEach(b=>{u.isClockwise(b,!1,!1)||b.reverse()});f&&u.unnormalizeGeometryOnDatelineCrossing(a);
c&&a.isSelfIntersecting&&z.isValid(e)&&(a=B.simplify(a));return a}v=function(){function a(e){this.spatialReference=e}a.prototype.mapToLocalMultiple=function(e){return e.map(f=>this.mapToLocal(f))};t._createClass(a,[{key:"doUnnormalization",get:function(){return!1}}]);return a}();let D=function(a){function e(c,b,d=null){b=a.call(this,b)||this;b.defaultZ=d;b.transform=w.create();b.transformInv=w.create();b.transform=w.clone(c);M.invert(b.transformInv,b.transform);return b}t._inheritsLoose(e,a);var f=
e.prototype;f.makeMapPoint=function(c,b){return q(c,b,this.defaultZ)};f.mapToLocal=function(c){return g(this.transform[0]*c[0]+this.transform[2]*c[1]+this.transform[4],this.transform[1]*c[0]+this.transform[3]*c[1]+this.transform[5])};f.localToMap=function(c){return q(this.transformInv[0]*c.x+this.transformInv[2]*c.y+this.transformInv[4],this.transformInv[1]*c.x+this.transformInv[3]*c.y+this.transformInv[5],this.defaultZ)};return e}(v),E=function(a){function e(c,b){var d=a.call(this,c.spatialReference)||
this;d.view=c;d.defaultZ=null;d.pWS=m.create();d.tangentFrameUpWS=m.create();d.tangentFrameRightWS=m.create();d.tangentFrameForwardWS=m.create();d.localFrameRightWS=m.create();d.localFrameUpWS=m.create();d.worldToLocalTransform=A.create();d.localToWorldTransform=A.create();d.scale=1;d.scale=c.resolution;d.referenceMapPoint=b;d.defaultZ=b.hasZ?b.z:null;c=c.state.camera.viewRight;d.view.renderCoordsHelper.toRenderCoords(d.referenceMapPoint,d.pWS);d.view.renderCoordsHelper.worldBasisAtPosition(d.pWS,
0,d.tangentFrameRightWS);d.view.renderCoordsHelper.worldBasisAtPosition(d.pWS,1,d.tangentFrameUpWS);d.view.renderCoordsHelper.worldBasisAtPosition(d.pWS,2,d.tangentFrameForwardWS);b=m.create();n.scale(b,d.tangentFrameForwardWS,n.dot(c,d.tangentFrameForwardWS));n.subtract(d.localFrameRightWS,c,b);n.normalize(d.localFrameRightWS,d.localFrameRightWS);n.cross(d.localFrameUpWS,d.tangentFrameForwardWS,d.localFrameRightWS);C.rotationTo(d.worldToLocalTransform,d.localFrameRightWS,d.tangentFrameRightWS);C.invert(d.localToWorldTransform,
d.worldToLocalTransform);return d}t._inheritsLoose(e,a);var f=e.prototype;f.makeMapPoint=function(c,b){return q(c,b,this.defaultZ)};f.mapToLocal=function(c){const b=m.create();this.view.renderCoordsHelper.toRenderCoords(new p({x:c[0],y:c[1],spatialReference:this.spatialReference}),b);n.transformQuat(b,b,this.worldToLocalTransform);c=this.view.renderCoordsHelper.fromRenderCoords(b,this.view.spatialReference);return g(c.x/this.scale,c.y/this.scale)};f.localToMap=function(c){const b=m.create();this.view.renderCoordsHelper.toRenderCoords(new p({x:c.x*
this.scale,y:c.y*this.scale,spatialReference:this.spatialReference}),b);n.transformQuat(b,b,this.localToWorldTransform);c=this.view.renderCoordsHelper.fromRenderCoords(b,this.view.spatialReference);return q(c.x,c.y,this.defaultZ)};t._createClass(e,[{key:"doUnnormalization",get:function(){return"global"===this.view.viewingMode}}]);return e}(v);k.AffineCoordinateSystem=D;k.SceneViewCoordinateSystem=E;k.SurfaceCoordinateSystem=v;k.createCircle=function(a,e,f,c){var b=e.mapToLocalMultiple(a),d=a=null;
f?(a=b[0],d=b[1]):(a=b[0],f=b[1],d=Math.round(f.x-a.x),f=Math.round(f.y-a.y),b=Math.max(Math.abs(d),Math.abs(f)),a=g(0<d?a.x+b/2:a.x-b/2,0<f?a.y+b/2:a.y-b/2),d=g(Math.abs(d)>Math.abs(f)?a.x-b/2:a.x,Math.abs(d)>Math.abs(f)?a.y:a.y-b/2));f=e.localToMap(a);b=e.localToMap(d);e.doUnnormalization&&u.unnormalizeVerticesOnDatelineCrossing([[f,b]],e.spatialReference);f=x(f,e.spatialReference);var h=x(b,e.spatialReference);b=K.getMetersPerUnitForSR(e.spatialReference);let l=0;z.isValid(e.spatialReference)?
l=b*B.distance(f,h,null):(h=a.x-d.x,a=a.y-d.y,l=b*Math.sqrt(h*h+a*a)*(c||1));e=new L({center:f,radius:l,radiusUnit:"meters",spatialReference:e.spatialReference});return r(e.rings,e.spatialReference,!1)};k.createEllipse=function(a,e,f){var c=e.mapToLocalMultiple(a);a=c[0];var b=c[1];c=Math.round(b.x-a.x);b=Math.round(b.y-a.y);a=g(f?a.x:a.x+c/2,f?a.y:a.y+b/2);c=f?c:c/2;f=f?b:b/2;b=[];const d=2*Math.PI/60;for(let h=0;60>h;h++){const l=g(c*Math.cos(h*d)+a.x,f*Math.sin(h*d)+a.y);b.push(l)}b.push(b[0]);
return r([b.map(h=>e.localToMap(h))],e.spatialReference,e.doUnnormalization,!1)};k.createMultipoint=function(a,e){return new H({points:a,spatialReference:e})};k.createPoint=x;k.createPolygon=r;k.createPolyline=function(a,e,f){a=new J({paths:a,spatialReference:e});f&&u.unnormalizeGeometryOnDatelineCrossing(a);return a};k.createRectangle=function(a,e,f){var c=e.mapToLocalMultiple(a);1===c.length&&(a=c[0],c=[g(a.x-48,a.y+48),g(a.x+48,a.y-48),g(a.x+48,a.y-48),g(a.x-48,a.y+48)]);a=[];var b=c[0].x,d=c[0].y,
h=c[1].x;c=c[1].y;if(f){f=Math.round(h-b);const l=Math.round(c-d);a.push(g(b-f,d-l),g(h,d-l),g(h,c),g(b-f,c))}else a.push(g(b,d),g(h,d),g(h,c),g(b,c));return r([a.map(l=>e.localToMap(l))],e.spatialReference,e.doUnnormalization,!0)};k.createSquare=function(a,e,f){var c=e.mapToLocalMultiple(a);a=[];var b=c[0].x,d=c[0].y,h=Math.round(c[1].x-b);const l=Math.round(c[1].y-d);c=Math.max(Math.abs(h),Math.abs(l));f?(f=b+c,h=d+c,b-=c,d-=c,a.push(g(f,d),g(b,d),g(b,h),g(f,h))):(f=0<h?b+c:b-c,c=0<l?d+c:d-c,a.push(g(b,
d),g(f,d),g(f,c),g(b,c)));return r([a.map(N=>e.localToMap(N))],e.spatialReference,e.doUnnormalization,!0)};k.createViewAlignedCoordinateSystem=function(a,e){return"2d"===a.type?new D(a.state.transform,a.spatialReference,2<e.length?e[2]:null):"3d"===a.type?(e=2<e.length?new p({x:e[0],y:e[1],z:e[2],spatialReference:a.spatialReference}):new p({x:e[0],y:e[1],spatialReference:a.spatialReference}),new E(a,e)):null};k.makeMapPoint=q;k.makeSurfacePoint=g;Object.defineProperty(k,"__esModule",{value:!0})});