// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.18/esri/copyright.txt for details.
//>>built
define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/has ../../core/maybe ../../core/Logger ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/property ../../core/jsonMap ../../core/accessorSupport/decorators/subclass ../../core/urlUtils ../../core/uuid ../../portal/support/resourceExtension ../../core/Handles ../input/InputManager ../support/screenUtils ./DrawAction ./input/DrawEvents ./input/Keys ../3d/interactive/editingTools/draw/DrawTool ./support/createUtils".split(" "),
function(f,r,l,y,e,z,A,n,B,t,C,D,E,u,d,g,v,h,k,w,x){f.SegmentDrawAction=function(p){function m(a){a=p.call(this,a)||this;a._isDragging=!1;a._panEnabled=!1;a._cursorScreenPoint=null;a._viewHandles=new u;a._cursorVertexAdded=!1;a._activePointerId=null;a.viewAlignedCoordinateSystem=null;a.mode="freehand";a.vertices=[];return a}r._inheritsLoose(m,p);var c=m.prototype;c.initialize=function(){"2d"===this.view.type?this._addViewHandles():this._addDrawTool(this.view)};c.destroy=function(){"2d"===this.view.type?
(this._removeViewHandles(),this._viewHandles.destroy()):this._removeDrawTool();this.emit("destroy")};c.complete=function(){"2d"===this.view.type?this._completeDrawing():this._drawTool.completeCreateOperation()};c.getGeometryZValue=function(){return 0<this.vertices.length&&2<this.vertices[0].length?this.vertices[0][2]:this._get("defaultZ")};c._addViewHandles=function(){this._removeViewHandles();"click"===this.mode?this._viewHandles.add(this._getClickModeViewHandles()):this._viewHandles.add(this._getDragModeViewHandles())};
c._getDragModeViewHandles=function(){return[this.view.on("immediate-click",a=>{a.stopPropagation();if(a.mapPoint&&!this._panEnabled){const b=this.getCoordsFromScreenPoint(g.createScreenPointFromEvent(a));e.isSome(b)&&(this._set("vertices",[b]),this._drawCompleteHandler(a))}},d.ViewEventPriorities.TOOL),this.view.on("pointer-down",a=>{this._shouldHandlePointerEvent(a)&&!this._panEnabled&&(this._cursorScreenPoint=g.createScreenPointFromEvent(a),this._set("vertices",[]),this._activePointerId=a.pointerId,
this._vertexAddHandler(a),this._isDragging=!1,"touch"===a.pointerType&&this._cursorUpdateHandler(a))},d.ViewEventPriorities.TOOL),this.view.on("pointer-move",a=>{this._cursorScreenPoint=g.createScreenPointFromEvent(a);e.isNone(this._activePointerId)&&"touch"!==a.pointerType&&0===this.vertices.length&&this._cursorUpdateHandler(a)},d.ViewEventPriorities.TOOL),this.view.on("pointer-drag",a=>{this._shouldHandlePointerEvent(a)&&(this._isDragging=!0,this._cursorScreenPoint=g.createScreenPointFromEvent(a),
this._cursorUpdateHandler(a))},d.ViewEventPriorities.TOOL),this.view.on("pointer-up",a=>{this._shouldHandlePointerEvent(a)&&(this._activePointerId=null,this._popCursorVertex(),this._isDragging&&!this._panEnabled&&(this._vertexAddHandler(a),this._drawCompleteHandler(a)),this._isDragging=!1)},d.ViewEventPriorities.TOOL),this.view.on("key-down",a=>{a.key===k.KEYS.drawCompleteKey&&this._cursorScreenPoint?this._drawCompleteHandler(a):a.key===k.KEYS.panKey&&(this._panEnabled=!0)},d.ViewEventPriorities.TOOL),
this.view.on("key-up",a=>{a.key===k.KEYS.panKey&&(this._panEnabled=!1)},d.ViewEventPriorities.TOOL),this.view.on("drag",a=>{e.isSome(this._activePointerId)&&a.stopPropagation()},d.ViewEventPriorities.TOOL),this.view.on("drag",["Shift"],a=>{a.stopPropagation()},d.ViewEventPriorities.TOOL)]};c._getClickModeViewHandles=function(){return[this.view.on("immediate-click",a=>{a.stopPropagation()},d.ViewEventPriorities.TOOL),this.view.on("pointer-down",a=>{this._cursorScreenPoint=g.createScreenPointFromEvent(a);
this._activePointerId=a.pointerId;this._isDragging=!1;"touch"===a.pointerType&&this._cursorUpdateHandler(a)},d.ViewEventPriorities.TOOL),this.view.on("pointer-move",a=>{this._cursorScreenPoint=g.createScreenPointFromEvent(a);e.isNone(this._activePointerId)&&"touch"!==a.pointerType&&this._cursorUpdateHandler(a)},d.ViewEventPriorities.TOOL),this.view.on("pointer-drag",a=>{this._shouldHandlePointerEvent(a)&&(this._isDragging=!0)},d.ViewEventPriorities.TOOL),this.view.on("pointer-up",a=>{this._shouldHandlePointerEvent(a)&&
(this._activePointerId=null,this._isDragging||this._vertexAddHandler(a),2!==this.vertices.length||this._isDragging||this._drawCompleteHandler(a),this._isDragging=!1)},d.ViewEventPriorities.TOOL),this.view.on("key-down",a=>{a.key===k.KEYS.vertexAddKey&&this._cursorScreenPoint&&(this._vertexAddHandler(a),2===this.vertices.length&&this._drawCompleteHandler(a));a.key===k.KEYS.drawCompleteKey&&this._cursorScreenPoint&&2===this.vertices.length&&this._drawCompleteHandler(a)},d.ViewEventPriorities.TOOL)]};
c._removeViewHandles=function(){this._viewHandles.removeAll()};c._addDrawTool=function(a){this._drawTool=new w.DrawTool({view:a,elevationInfo:this.elevationInfo,hasZ:this.hasZ,geometryType:"segment",mode:this.mode});this.view.toolViewManager.tools.push(this._drawTool);this.view.activeTool=this._drawTool;this._drawTool.on("vertex-add",b=>{1===b.vertices.length&&this.emit("vertex-add",new h.VertexAddEvent(this.view,null,b.vertices[0].vertexIndex,this._drawTool.getVertexCoords()))});this._drawTool.on("cursor-update",
b=>{1===b.vertices.length&&this.emit("cursor-update",new h.CursorUpdateEvent(this.view,null,b.vertices[0].vertexIndex,this._drawTool.getVertexCoords()))});this._drawTool.on("complete",b=>{this.emit("draw-complete",new h.DrawCompleteEvent(null,this._drawTool.getVertexCoords()));this._removeDrawTool()})};c._removeDrawTool=function(){e.isSome(this._drawTool)&&(this.view.tools.remove(this._drawTool),this._drawTool.destroy(),this._drawTool=null)};c._addVertex=function(a,b){this._popCursorVertex();this.isDuplicateVertex(this.vertices,
a)||(this.vertices.push(a),1===this.vertices.length&&(this.viewAlignedCoordinateSystem=x.createViewAlignedCoordinateSystem(this.view,this.vertices[0])),a=this.vertices.indexOf(a),b=new h.VertexAddEvent(this.view,b,a,this.vertices),this.emit("vertex-add",b))};c._updateCursor=function(a,b){let q=null;e.isSome(a)&&(q=this._pushCursorVertex(a));a=new h.CursorUpdateEvent(this.view,b,q,this.vertices);this.emit("cursor-update",a)};c._completeDrawing=function(a){this._activePointerId=null;this._popCursorVertex();
this._isDragging=!1;this._cursorScreenPoint=null;1>this.vertices.length||(a=new h.DrawCompleteEvent(a,this.vertices),this.emit("draw-complete",a),a.defaultPrevented||this._removeViewHandles())};c._pushCursorVertex=function(a){this._popCursorVertex();this.vertices.push(a);this._cursorVertexAdded=!0;return this.vertices.length-1};c._popCursorVertex=function(){this._cursorVertexAdded&&(this.vertices.pop(),this._cursorVertexAdded=!1)};c._shouldHandlePointerEvent=function(a){return("mouse"!==a.pointerType||
0===a.button)&&(e.isNone(this._activePointerId)||this._activePointerId===a.pointerId)};c._vertexAddHandler=function(a){const b=this.getCoordsFromScreenPoint(this._cursorScreenPoint);e.isSome(b)&&this._addVertex(b,a.native)};c._cursorUpdateHandler=function(a){const b=this.getCoordsFromScreenPoint(this._cursorScreenPoint);this._updateCursor(b,a.native)};c._drawCompleteHandler=function(a){this._completeDrawing(a.native)};return m}(v);l.__decorate([n.property({type:["freehand","click"]})],f.SegmentDrawAction.prototype,
"mode",void 0);l.__decorate([n.property({readOnly:!0})],f.SegmentDrawAction.prototype,"vertices",void 0);f.SegmentDrawAction=l.__decorate([t.subclass("esri/views/2d/engine/markup/SegmentDrawAction")],f.SegmentDrawAction);Object.defineProperty(f,"__esModule",{value:!0})});