// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.18/esri/copyright.txt for details.
//>>built
define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/Logger ../../../../../core/Error ../../../../../core/promiseUtils ./BaseFeatureSource".split(" "),function(r,v,m,w,k,x){const y=m.getLogger("esri.views.2d.layers.features.sources.FeatureSource");m=function(t){function n(a){return t.call(this,a)||this}v._inheritsLoose(n,t);var u=n.prototype;u._fetchDataTile=async function(a){const c=this._subscriptions.get(a.key.id);let d=!1,p=0,f=0;const h=(e,b)=>{f--;k.throwIfAborted(c);
const g=e.reader;e=e.query;g.exceededTransferLimit?(b={tile:a,id:a.id,features:g,end:d&&0===f},c.requests.done.push({request:b,query:e}),this._onRequest(b,"new")):(d=!0,b={tile:a,id:a.id,features:g,end:0===f},c.requests.done.push({request:b,query:e}),this._onRequest(b,"new"))};let q=0,z=0;for(;!d&&20>z++;){let e;for(let b=0;b<q+1;b++){const g=p++;f++;e=this._fetchDataTilePage(a,g,c).then(l=>l&&h(l,g)).catch(l=>{d=!0;k.isAbortError(l)||(y.error(new w("mapview-query-error","Encountered error when fetching tile",
{tile:a,error:l})),this._onRequest({tile:a,id:a.id,features:null,end:d},"new"))})}await e;k.throwIfAborted(c);q=Math.min(q+2,6)}};u._fetchDataTilePage=async function(a,c,d){const p=this._sourceQueryInfo,f=this._createQuery(a,{start:8E3*c,num:8E3,maxRecordCountFactor:3,returnExceededLimitFeatures:!0,quantizationParameters:a.getQuantizationParameters()});try{const h=await this._queue.push({tile:a,query:f,signal:d.signal,depth:c});k.throwIfAborted(d);return h?p!==this._sourceQueryInfo?this._fetchDataTilePage(a,
c,d):{reader:h,query:f}:null}catch(h){return k.throwIfNotAbortError(h),null}};return n}(x.BaseFeatureSource);r.PagedFeatureSource=m;Object.defineProperty(r,"__esModule",{value:!0})});