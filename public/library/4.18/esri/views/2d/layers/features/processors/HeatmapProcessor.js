// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.18/esri/copyright.txt for details.
//>>built
define("../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/has ../../../../../core/maybe ../../../../../core/Logger ../../../../../core/accessorSupport/ensureType ../../../../../core/accessorSupport/decorators/property ../../../../../core/jsonMap ../../../../../core/accessorSupport/decorators/subclass ../../../../../core/urlUtils ../../../../../core/uuid ../../../../../portal/support/resourceExtension ../../../../../core/accessorSupport/diffUtils ../../../../../renderers/support/heatmapUtils ./BaseProcessor".split(" "),
function(p,q,e,l,w,x,y,z,r,A,B,C,t,u,v){e=function(m){function f(){var b=m.apply(this,arguments)||this;b.type="heatmap";b._tileKeyToFeatureSets=new Map;return b}p._inheritsLoose(f,m);var c=f.prototype;c.initialize=function(){this.handles.add([this.tileStore.on("update",this.onTileUpdate.bind(this))])};c.update=async function(b,a){a=a.schema.processors[0];"heatmap"===a.type&&t.diff(this._schema,a)&&(b.mesh=!0,this._schema=a)};c.onTileUpdate=function(b){for(const a of b.removed)this._tileKeyToFeatureSets.delete(a.key.id)};
c.onTileData=async function(b,a,g){this._tileKeyToFeatureSets.has(b.key.id)&&"replace"!==a.type||this._tileKeyToFeatureSets.set(b.key.id,new Map);const h=this._tileKeyToFeatureSets.get(b.key.id);l.isSome(a.addOrUpdate)&&h.set(a.addOrUpdate.instance,a);let k=a.end;h.forEach(d=>k=k||d.end);if(k){var n=[];h.forEach(d=>{l.isSome(d.addOrUpdate)&&n.push(d.addOrUpdate)});a=u.calculateHeatmapIntensityInfoReaders(n,this._schema.mesh,512,512);return this.remoteClient.invoke("tileRenderer.onTileData",{tileKey:b.key.id,
intensityInfo:a},{...g,transferList:[a.matrix]})}};c.onTileError=function(b,a,g){return this.remoteClient.invoke("tileRenderer.onTileError",{tileKey:b.id,error:a},g)};return f}(v);return e=q.__decorate([r.subclass("esri.views.2d.layers.features.processors.HeatmapProcessor")],e)});