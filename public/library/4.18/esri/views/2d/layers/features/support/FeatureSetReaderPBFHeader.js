// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.18/esri/copyright.txt for details.
//>>built
define(["exports","../../../../../core/Error","../../../../../tasks/operations/pbfFeatureServiceParser"],function(l,w,q){let r=function(){function a(){this.hasFeatures=!1;this.fieldIndexMap=new Map;this.objectIdFieldIndex=this.featureCount=this.fieldCount=0;this.dateFields=new Set;this.offsets={attributes:[],geometry:[]};this.centroid=[]}var f=a.prototype;f.hasFieldIndex=function(h){return this.fieldIndexMap.has(h)};f.isDateField=function(h){return this.dateFields.has(h)};f.getFieldIndex=function(h){return this.fieldIndexMap.get(h)};
return a}();l.FeatureSetHeader=r;l.parseHeader=function(a,f){const h=a.pos(),b=new r;let k=0,g=0,t=null,u=null,v=null,m=!1;for(;a.next();)switch(a.tag()){case 1:t=a.getString();break;case 3:u=a.getString();break;case 12:v=a.processMessage(q.parseTransform);break;case 9:b.exceededTransferLimit=a.getBool();b.exceededTransferLimit&&(b.offsets.geometry=new Int32Array(8E3),b.centroid=new Int32Array(16E3));break;case 13:var d=a;var e=d.getLength();e=d.pos()+e;for(var c={name:"",isDate:!1};d.pos()<e&&d.next();)switch(d.tag()){case 1:c.name=
d.getString();break;case 2:"esriFieldTypeDate"===q.parseFieldType(d.getEnum())&&(c.isDate=!0);break;default:d.skip()}d=c;e=d.name.toLowerCase().trim();c=k++;b.fieldIndexMap.set(d.name,c);b.fieldIndexMap.set(e,c);d.isDate&&(b.dateFields.add(d.name),b.dateFields.add(e));break;case 15:d=a.getLength();d=a.pos()+d;b.exceededTransferLimit||(e=b.centroid,b.offsets.geometry.push(0),e.push(268435455),e.push(268435455));!m&&b.exceededTransferLimit&&(m=!0,b.offsets.attributes=new Uint32Array(8E3*k));for(e=g*
k;a.pos()<d&&a.next();)switch(a.tag()){case 1:m?b.offsets.attributes[e++]=a.pos():b.offsets.attributes.push(a.pos());c=a.getLength();a.skipLen(c);break;case 2:if(f)for(c=a.getLength(),c=a.pos()+c;a.pos()<c&&a.next();)switch(a.tag()){case 3:a.getUInt32();var n=a.getSInt32(),p=a.getSInt32();b.centroid[2*g]=n;b.centroid[2*g+1]=p;break;default:a.skip()}else b.offsets.geometry[g]=a.pos(),c=a.getLength(),a.skipLen(c);break;case 4:c=a.getLength();for(c=a.pos()+c;a.pos()<c&&a.next();)switch(a.tag()){case 3:a.getUInt32();
n=a.getSInt32();p=a.getSInt32();b.centroid[2*g]=n;b.centroid[2*g+1]=p;break;default:a.skip()}break;default:a.skip()}g++;b.hasFeatures=!0;break;default:a.skip()}f=t||u;if(!f)throw new w("FeatureSet has no objectId or globalId field name");b.featureCount=g;b.fieldCount=k;b.objectIdFieldIndex=b.getFieldIndex(f);b.transform=v;b.displayIds=new Uint32Array(b.featureCount);b.groupIds=new Uint16Array(b.featureCount);a.move(h);return b};Object.defineProperty(l,"__esModule",{value:!0})});