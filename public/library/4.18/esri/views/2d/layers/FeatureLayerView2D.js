// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.18/esri/copyright.txt for details.
//>>built
require({cache:{"esri/AggregateGraphic":function(){define("./chunks/_rollupPluginBabelHelpers ./chunks/tslib.es6 ./core/has ./core/Logger ./core/accessorSupport/ensureType ./core/accessorSupport/decorators/property ./core/jsonMap ./core/accessorSupport/decorators/subclass ./core/urlUtils ./core/uuid ./portal/support/resourceExtension ./Graphic".split(" "),function(u,h,e,B,d,l,m,g,k,w,r,q){var D;e=D=function(x){function v(){var b=x.apply(this,arguments)||this;b.isAggregate=!0;return b}u._inheritsLoose(v,
x);var y=v.prototype;y.getEffectivePopupTemplate=function(b){return this.popupTemplate?this.popupTemplate:(b=this.sourceLayer&&this.sourceLayer.featureReduction)&&"popupTemplate"in b&&b.popupEnabled?b.popupTemplate:null};y.getObjectId=function(){return this.objectId};y.clone=function(){return new D({objectId:this.objectId,...this.cloneProperties()})};return v}(q);h.__decorate([l.property({type:Boolean})],e.prototype,"isAggregate",void 0);h.__decorate([l.property({type:Number,json:{read:!0}})],e.prototype,
"objectId",void 0);return e=D=h.__decorate([g.subclass("esri.AggregateGraphic")],e)})},"esri/renderers/support/clickToleranceUtils":function(){define(["exports"],function(u){function h(d,l){return l?"xoffset"in l&&l.xoffset?Math.max(d,Math.abs(l.xoffset)):"yoffset"in l&&l.yoffset?Math.max(d,Math.abs(l.yoffset||0)):d:d}function e(d,l){if("number"===typeof d)return d;if(d&&d.stops&&d.stops.length){{d=d.stops;let m=l=0;for(let g=0;g<d.length;g++){const k=d[g].size;"number"===typeof k&&(l+=k,m++)}d=l/
m}return d}return l}function B(d,l){if(!l)return d;l=l.filter(k=>"size"===k.type).map(k=>{const {maxSize:w,minSize:r}=k;return(e(w,d)+e(r,d))/2});let m=0;const g=l.length;if(0===g)return d;for(let k=0;k<g;k++)m+=l[k];return Math.max(Math.floor(m/g),d)}u.calculateTolerance=function(d){const l=d&&d.renderer;d="touch"===(d&&d.event&&d.event.pointerType)?9:6;if(!l)return d;d="visualVariables"in l?B(d,l.visualVariables):d;if("simple"===l.type)return h(d,l.symbol);if("unique-value"===l.type){let m=d;l.uniqueValueInfos.forEach(g=>
{m=h(m,g.symbol)});return m}if("class-breaks"===l.type){let m=d;l.classBreakInfos.forEach(g=>{m=h(m,g.symbol)});return m}return d};Object.defineProperty(u,"__esModule",{value:!0})})},"esri/views/support/drapedUtils":function(){define("exports ../../core/maybe ../../geometry/Extent ../../geometry ../../core/unitUtils ../../renderers/support/clickToleranceUtils".split(" "),function(u,h,e,B,d,l){function m(k,w,r,q=new e){let D;if("2d"===r.type)D=w*r.resolution;else if("3d"===r.type){var x=r.overlayPixelSizeInMapUnits(k),
v=r.basemapSpatialReference;D=h.isSome(v)&&!v.equals(r.spatialReference)?d.getMetersPerUnitForSR(v)/d.getMetersPerUnitForSR(r.spatialReference):w*x}w=k.x-D;x=k.y-D;v=k.x+D;k=k.y+D;({spatialReference:r}=r);q.xmin=Math.min(w,v);q.ymin=Math.min(x,k);q.xmax=Math.max(w,v);q.ymax=Math.max(x,k);q.spatialReference=r;return q}const g=new e;u.createQueryGeometry=m;u.intersectsDrapedGeometry=function(k,w,r){k=r.toMap(k);if(h.isNone(k))return!1;const q=l.calculateTolerance();return m(k,q,r,g).intersects(w)};
Object.defineProperty(u,"__esModule",{value:!0})})},"esri/views/layers/support/FeatureFilter":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/has ../../../core/lang ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/property ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../core/accessorSupport/decorators/writer ../../../core/urlUtils ../../../core/uuid ../../../portal/support/resourceExtension ../../../core/JSONSupport ../../../geometry/support/jsonUtils ../../../geometry ../../../TimeExtent ../../../tasks/support/Query".split(" "),
function(u,h,e,B,d,l,m,g,k,w,r,q,D,x,v,y,b,f){var t;e=new g.JSONMap({esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"envelope-intersects",esriSpatialRelIndexIntersects:"index-intersects",esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:"relation"});g=new g.JSONMap({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",
esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});x=t=function(C){function K(E){E=C.call(this,E)||this;E.where=null;E.geometry=null;E.spatialRelationship="intersects";E.hiddenIds=new Set;E.distance=void 0;E.objectIds=null;E.units=null;E.timeExtent=null;E.enabled=!1;return E}u._inheritsLoose(K,C);var J=K.prototype;J.writeWhere=function(E,S){S.where=E||"1\x3d1"};J.enable=function(){this._set("enabled",!0)};
J.createQuery=function(E={}){const {where:S,geometry:G,spatialRelationship:M,timeExtent:H,objectIds:I,units:n,distance:A}=this;return new f({geometry:B.clone(G),objectIds:B.clone(I),spatialRelationship:M,timeExtent:B.clone(H),where:S,units:n,distance:A,...E})};J.clone=function(){const {where:E,geometry:S,spatialRelationship:G,hiddenIds:M,timeExtent:H,objectIds:I,units:n,distance:A}=this,L=new Set;M.forEach(R=>L.add(R));return new t({geometry:B.clone(S),hiddenIds:L,objectIds:B.clone(I),spatialRelationship:G,
timeExtent:B.clone(H),where:E,units:n,distance:A})};return K}(x.JSONSupport);h.__decorate([m.property({type:String})],x.prototype,"where",void 0);h.__decorate([w.writer("where")],x.prototype,"writeWhere",null);h.__decorate([m.property({types:y.geometryTypes,json:{read:v.fromJSON,write:!0}})],x.prototype,"geometry",void 0);h.__decorate([m.property({type:String,json:{read:{source:"spatialRel",reader:e.read},write:{target:"spatialRel",writer:e.write}}})],x.prototype,"spatialRelationship",void 0);h.__decorate([m.property({json:{write:(C,
K,J)=>K[J]=Array.from(C),read:C=>new Set(C)}})],x.prototype,"hiddenIds",void 0);h.__decorate([m.property({type:Number,json:{write:{overridePolicy(C){return{enabled:0<C}}}}})],x.prototype,"distance",void 0);h.__decorate([m.property({type:[Number],json:{write:!0}})],x.prototype,"objectIds",void 0);h.__decorate([m.property({type:String,json:{read:g.read,write:{writer:g.write,overridePolicy(C){return{enabled:C&&0<this.distance}}}}})],x.prototype,"units",void 0);h.__decorate([m.property({type:b,json:{write:!0}})],
x.prototype,"timeExtent",void 0);h.__decorate([m.property({readOnly:!0})],x.prototype,"enabled",void 0);return x=t=h.__decorate([k.subclass("esri.views.layers.support.FeatureFilter")],x)})},"esri/views/layers/support/FeatureEffect":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/has ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/property ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../core/urlUtils ../../../core/uuid ../../../portal/support/resourceExtension ../../../core/JSONSupport ./FeatureFilter".split(" "),
function(u,h,e,B,d,l,m,g,k,w,r,q,D){var x;e=x=function(v){function y(){var b=v.apply(this,arguments)||this;b.filter=null;b.includedEffect=null;b.excludedEffect=null;b.excludedLabelsVisible=!1;return b}u._inheritsLoose(y,v);y.prototype.clone=function(){return new x({filter:this.filter&&this.filter.clone(),includedEffect:this.includedEffect,excludedEffect:this.excludedEffect,excludedLabelsVisible:this.excludedLabelsVisible})};return y}(q.JSONSupport);h.__decorate([l.property({type:D,json:{write:!0}})],
e.prototype,"filter",void 0);h.__decorate([l.property({json:{write:!0}})],e.prototype,"includedEffect",void 0);h.__decorate([l.property({json:{write:!0}})],e.prototype,"excludedEffect",void 0);h.__decorate([l.property({type:Boolean,json:{write:!0}})],e.prototype,"excludedLabelsVisible",void 0);return e=x=h.__decorate([g.subclass("esri.views.layers.support.FeatureEffect")],e)})},"esri/views/layers/FeatureLayerView":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/has ../../core/maybe ../../core/Logger ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/property ../../core/jsonMap ../../core/accessorSupport/decorators/subclass ../../core/Error ../../core/urlUtils ../../core/uuid ../../portal/support/resourceExtension ../../core/promiseUtils ../../support/arcadeOnDemand ../../layers/support/fieldUtils ../../core/watchUtils ../../layers/support/commonProperties ../../tasks/support/Query ./support/FeatureFilter ./support/FeatureEffect ./support/popupUtils".split(" "),
function(u,h,e,B,d,l,m,g,k,w,r,q,D,x,v,y,b,f,t,C,K,J,E){const S=l.getLogger("esri.views.layers.FeatureLayerView");u.FeatureLayerView=G=>{G=function(M){function H(...n){n=M.call(this,...n)||this;n._updatingRequiredFieldsPromise=null;n.effect=null;n.filter=null;n.timeExtent=null;n.layer=null;n.requiredFields=[];n.view=null;return n}h._inheritsLoose(H,M);var I=H.prototype;I.initialize=function(){f.init(this,"layer.renderer layer.labelingInfo layer.elevationInfo.featureExpressionInfo layer.displayField filter effect layer.timeInfo timeExtent".split(" "),
()=>this._handleRequiredFieldsChange(),!0)};I.highlight=function(n){throw Error("missing implementation");};I.createQuery=function(){var n={outFields:["*"],returnGeometry:!0,outSpatialReference:this.view.spatialReference};n=d.isSome(this.filter)?this.filter.createQuery(n):new C(n);d.isSome(this.timeExtent)&&(n.timeExtent=d.isSome(n.timeExtent)?n.timeExtent.intersection(this.timeExtent):this.timeExtent.clone());return n};I.queryFeatures=function(n,A){throw Error("missing implementation");};I.queryObjectIds=
function(n,A){throw Error("missing implementation");};I.queryFeatureCount=function(n,A){throw Error("missing implementation");};I.queryExtent=function(n,A){throw Error("missing implementation");};I._loadArcadeModules=function(n){if(n.get("expressionInfos.length"))return y.loadArcade()};I._handleRequiredFieldsChange=function(){const n=this._updateRequiredFields();this._set("_updatingRequiredFieldsPromise",n);n.then(()=>{this._updatingRequiredFieldsPromise===n&&this._set("_updatingRequiredFieldsPromise",
null)})};I._updateRequiredFields=async function(){if(this.layer&&this.view){var n="3d"===this.view.type,{layer:A,layer:{fields:L,objectIdField:R,renderer:U,displayField:V}}=this,T=A.featureReduction,P=new Set;T=await v.eachAlways([U?U.collectRequiredFields(P,L):null,b.collectLabelingFields(P,A),n?b.collectElevationFields(P,A):null,d.isSome(this.filter)?b.collectFilterFields(P,A,this.filter):null,this.effect?b.collectFilterFields(P,A,this.effect.filter):null,T?b.collectFeatureReductionFields(P,A,T):
null]);A.timeInfo&&this.timeExtent&&b.collectFields(P,A.fields,[A.timeInfo.startField,A.timeInfo.endField]);for(const ca of T)ca.error&&S.error(ca.error);b.collectField(P,L,R);n&&V&&b.collectField(P,L,V);n=Array.from(P).sort();this._set("requiredFields",n)}};I.validateFetchPopupFeatures=function(n){const {layer:A,layer:{popupEnabled:L}}=this;if(!L)return new r("featurelayerview:fetchPopupFeatures","Popups are disabled",{layer:A});if(!E.getFetchPopupTemplate(this.layer,n))return new r("featurelayerview:fetchPopupFeatures",
"Layer does not define a popup template",{layer:A})};I.fetchClientPopupFeatures=async function(n){const A=d.isSome(n)?n.clientGraphics:null;if(!A||0===A.length)return v.resolve([]);const L=[],R=[],{layer:U}=this;var V=E.getFetchPopupTemplate(U,n);if(!d.isSome(V))return v.resolve([]);var T=await this._loadArcadeModules(V);V=T&&T.arcadeUtils.hasGeometryOperations(V);n=await this.createPopupQuery(n);T=b.unpackFieldNames(U.fields,n.outFields);for(const P of A)V||!b.featureHasFields(T,P)?R.push(P):L.push(P);
if("stream"===U.type||0===R.length)return v.resolve(L);n.objectIds=R.map(P=>P.attributes[U.objectIdField]);return U.queryFeatures(n).then(P=>L.concat(P.features)).catch(()=>R)};I.createPopupQuery=async function(n){var A=this.layer;const L=A.createQuery();n=E.getFetchPopupTemplate(A,n);var R=d.isSome(n)&&await this._loadArcadeModules(n);R=d.isSome(n)&&R&&R.arcadeUtils.hasGeometryOperations(n);A=!("point"!==A.geometryType&&!R);L.returnGeometry=A;L.returnZ=A;L.returnM=A;L.outFields=await E.getRequiredFields(this.layer,
n);L.outSpatialReference=this.view.spatialReference;return L};I.canResume=function(){return!M.prototype.canResume.call(this)||d.isSome(this.timeExtent)&&this.timeExtent.isEmpty?!1:!0};h._createClass(H,[{key:"availableFields",get:function(){const {layer:n,layer:{fields:A},requiredFields:L}=this;return"outFields"in n&&n.outFields?b.fixFields(A,[...b.unpackFieldNames(A,n.outFields),...L]):b.fixFields(A,L)}},{key:"maximumNumberOfFeatures",get:function(){return 0},set:function(n){S.error("#maximumNumberOfFeatures\x3d",
"Setting maximum number of features is not supported")}},{key:"maximumNumberOfFeaturesExceeded",get:function(){return!1}}]);return H}(G);e.__decorate([g.property()],G.prototype,"_updatingRequiredFieldsPromise",void 0);e.__decorate([g.property({readOnly:!0,dependsOn:["layer.outFields?","requiredFields"]})],G.prototype,"availableFields",null);e.__decorate([g.property({type:J})],G.prototype,"effect",void 0);e.__decorate([g.property({type:K})],G.prototype,"filter",void 0);e.__decorate([g.property(t.combinedViewLayerTimeExtentProperty)],
G.prototype,"timeExtent",void 0);e.__decorate([g.property()],G.prototype,"layer",void 0);e.__decorate([g.property({type:Number})],G.prototype,"maximumNumberOfFeatures",null);e.__decorate([g.property({readOnly:!0,type:Boolean})],G.prototype,"maximumNumberOfFeaturesExceeded",null);e.__decorate([g.property({readOnly:!0})],G.prototype,"requiredFields",void 0);e.__decorate([g.property({dependsOn:["timeExtent"]})],G.prototype,"suspended",void 0);e.__decorate([g.property()],G.prototype,"view",void 0);return G=
e.__decorate([w.subclass("esri.views.layers.FeatureLayerView")],G)};Object.defineProperty(u,"__esModule",{value:!0})})},"esri/views/layers/support/popupUtils":function(){define(["exports","../../../core/maybe","../../../layers/support/fieldUtils"],function(u,h,e){u.getFetchPopupTemplate=function(B,d){return B.popupTemplate?B.popupTemplate:h.isSome(d)&&d.defaultPopupTemplateEnabled&&h.isSome(B.defaultPopupTemplate)?B.defaultPopupTemplate:null};u.getRequiredFields=async function(B,d=B.popupTemplate){if(!h.isSome(d))return[];
const l=await d.getRequiredFields(B.fields);({lastEditInfoEnabled:d}=d);const {objectIdField:m,typeIdField:g,globalIdField:k,relationships:w}=B;if(l.includes("*"))return["*"];d=d?await e.getFeatureEditFields(B):[];const r=e.fixFields(B.fields,[...l,...d]);g&&r.push(g);r&&m&&e.hasField(B.fields,m)&&-1===r.indexOf(m)&&r.push(m);r&&k&&e.hasField(B.fields,k)&&-1===r.indexOf(k)&&r.push(k);w&&w.forEach(q=>{({keyField:q}=q);r&&q&&e.hasField(B.fields,q)&&-1===r.indexOf(q)&&r.push(q)});return r};Object.defineProperty(u,
"__esModule",{value:!0})})},"esri/views/2d/layers/LayerView2D":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/has ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/property ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../core/urlUtils ../../../core/uuid ../../../portal/support/resourceExtension ../../../core/Collection ../../../core/collectionUtils ../../../core/watchUtils ../../layers/support/ClipArea ../../layers/support/ClipRect ../engine/Container ../../layers/support/Geometry ../../layers/support/Path".split(" "),
function(u,h,e,B,d,l,m,g,k,w,r,q,D,x,v,y,b,f,t,C){const K=D.ofType({key:"type",base:y,typeMap:{rect:b,path:C,geometry:t}});u.LayerView2DMixin=J=>{J=function(E){function S(){var M=E.apply(this,arguments)||this;M.clips=new K;M.moving=!1;M.attached=!1;M.lastUpdateId=-1;M.updateRequested=!1;return M}h._inheritsLoose(S,E);var G=S.prototype;G.initialize=function(){var M;this.container||(this.container=new f.Container);this.container.fadeTransitionEnabled=!0;this.container.opacity=0;this.container.clips=
this.clips;this.handles.add([v.init(this,"suspended",H=>{this.container&&(this.container.visible=!H);this.view&&!H&&this.updateRequested&&this.view.requestUpdate()},!0),v.init(this,["layer.opacity","container"],()=>{if(this.container){var H,I;this.container.opacity=null!=(H=null==(I=this.layer)?void 0:I.opacity)?H:1}},!0),v.init(this,["layer.blendMode"],H=>{this.container&&(this.container.blendMode=H)},!0),v.init(this,["layer.effect"],H=>{this.container&&(this.container.effect=H)},!0),this.clips.on("change",
()=>{this.container.clips=this.clips;this.notifyChange("clips")})]);null!=(M=this.view)&&M.whenLayerView?this.view.whenLayerView(this.layer).then(H=>{H!==this||this.attached||this.destroyed||(this.attach(),this.requestUpdate(),this.attached=!0)},()=>{}):this.when().then(()=>{this.attached||this.destroyed||(this.attach(),this.requestUpdate(),this.attached=!0)},()=>{})};G.destroy=function(){this.attached&&(this.detach(),this.attached=!1);this.handles.remove("initialize");this.updateRequested=!1};G.isVisibleAtScale=
function(M){var H=!0,I=this.layer;const n=I.minScale;I=I.maxScale;if(null!=n&&null!=I){H=!n;let A=!I;!H&&M<=n&&(H=!0);!A&&M>=I&&(A=!0);H=H&&A}return H};G.requestUpdate=function(){this.updateRequested||(this.updateRequested=!0,this.suspended||this.view.requestUpdate())};G.processUpdate=function(M){this.isFulfilled()&&!this.isResolved()?this.updateRequested=!1:(this._set("updateParameters",M),this.updateRequested&&!this.suspended&&(this.updateRequested=!1,this.update(M)))};G.isUpdating=function(){return!1};
G.isRendering=function(){return!1};G.canResume=function(){return E.prototype.canResume.call(this)?this.isVisibleAtScale(this.view.scale):!1};h._createClass(S,[{key:"updating",get:function(){return!this.attached||!this.suspended&&(this.updateRequested||this.isUpdating())}}]);return S}(J);e.__decorate([m.property({type:K,set(E){E=x.referenceSetter(E,this._get("clips"),K);this._set("clips",E)}})],J.prototype,"clips",void 0);e.__decorate([m.property()],J.prototype,"moving",void 0);e.__decorate([m.property()],
J.prototype,"attached",void 0);e.__decorate([m.property()],J.prototype,"container",void 0);e.__decorate([m.property({dependsOn:["view.scale","layer.minScale","layer.maxScale"]})],J.prototype,"suspended",void 0);e.__decorate([m.property({readOnly:!0})],J.prototype,"updateParameters",void 0);e.__decorate([m.property()],J.prototype,"updateRequested",void 0);e.__decorate([m.property({dependsOn:["attached","updateRequested","suspended"]})],J.prototype,"updating",null);e.__decorate([m.property()],J.prototype,
"view",void 0);return J=e.__decorate([k.subclass("esri.views.2d.layers.LayerView2D")],J)};Object.defineProperty(u,"__esModule",{value:!0})})},"esri/views/layers/support/ClipArea":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/has ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/property ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../core/urlUtils ../../../core/uuid ../../../portal/support/resourceExtension ../../../core/JSONSupport".split(" "),
function(u,h,e,B,d,l,m,g,k,w,r,q){e=function(D){function x(){return D.apply(this,arguments)||this}u._inheritsLoose(x,D);return x}(q.JSONSupport);return e=h.__decorate([g.subclass("esri.views.layers.support.ClipArea")],e)})},"esri/views/layers/support/ClipRect":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/has ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/property ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../core/urlUtils ../../../core/uuid ../../../portal/support/resourceExtension ./ClipArea".split(" "),
function(u,h,e,B,d,l,m,g,k,w,r,q){var D;e=D=function(x){function v(){var y=x.apply(this,arguments)||this;y.type="rect";y.left=null;y.right=null;y.top=null;y.bottom=null;return y}u._inheritsLoose(v,x);v.prototype.clone=function(){return new D({left:this.left,right:this.right,top:this.top,bottom:this.bottom})};u._createClass(v,[{key:"version",get:function(){return(this._get("version")||0)+1}}]);return v}(q);h.__decorate([l.property({type:[Number,String],json:{write:!0}})],e.prototype,"left",void 0);
h.__decorate([l.property({type:[Number,String],json:{write:!0}})],e.prototype,"right",void 0);h.__decorate([l.property({type:[Number,String],json:{write:!0}})],e.prototype,"top",void 0);h.__decorate([l.property({type:[Number,String],json:{write:!0}})],e.prototype,"bottom",void 0);h.__decorate([l.property({readOnly:!0,dependsOn:["left","right","top","bottom"]})],e.prototype,"version",null);return e=D=h.__decorate([g.subclass("esri.views.layers.support.ClipRect")],e)})},"esri/views/layers/support/Geometry":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/has ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/property ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../core/urlUtils ../../../core/uuid ../../../portal/support/resourceExtension ../../../geometry/Geometry ../../../geometry/Extent ../../../geometry/Polygon ../../../geometry/support/jsonUtils ../../../geometry ./ClipArea".split(" "),
function(u,h,e,B,d,l,m,g,k,w,r,q,D,x,v,y,b){var f;e={base:q,key:"type",typeMap:{extent:D,polygon:x}};b=f=function(t){function C(){var K=t.apply(this,arguments)||this;K.type="geometry";K.geometry=null;return K}u._inheritsLoose(C,t);C.prototype.clone=function(){return new f({geometry:this.geometry.clone()})};u._createClass(C,[{key:"version",get:function(){return(this._get("version")||0)+1}}]);return C}(b);h.__decorate([l.property({types:e,json:{read:v.fromJSON,write:!0}})],b.prototype,"geometry",void 0);
h.__decorate([l.property({readOnly:!0,dependsOn:["geometry"]})],b.prototype,"version",null);return b=f=h.__decorate([g.subclass("esri.views.layers.support.Geometry")],b)})},"esri/views/layers/support/Path":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/has ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/property ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../core/urlUtils ../../../core/uuid ../../../portal/support/resourceExtension ./ClipArea".split(" "),
function(u,h,e,B,d,l,m,g,k,w,r,q){e=function(D){function x(){var v=D.apply(this,arguments)||this;v.type="path";v.path=[];return v}u._inheritsLoose(x,D);u._createClass(x,[{key:"version",get:function(){return(this._get("version")||0)+1}}]);return x}(q);h.__decorate([l.property({type:[[[Number]]],json:{write:!0}})],e.prototype,"path",void 0);h.__decorate([l.property({readOnly:!0,dependsOn:["path"]})],e.prototype,"version",null);return e=h.__decorate([g.subclass("esri.views.layers.support.Path")],e)})},
"esri/views/2d/layers/features/tileRenderers":function(){define(["require","exports"],function(u,h){h.createOrReuseTileRenderer=async function(e,B){if(!e)return null;switch(e.type){case "class-breaks":case "simple":case "unique-value":case "dot-density":case "dictionary":return new (await new Promise(function(d,l){u(["./tileRenderers/SymbolTileRenderer"],function(m){d(Object.freeze({__proto__:null,"default":m}))},l)})).default(B);case "heatmap":return new (await new Promise(function(d,l){u(["./tileRenderers/HeatmapTileRenderer"],
function(m){d(Object.freeze({__proto__:null,"default":m}))},l)})).default(B)}};Object.defineProperty(h,"__esModule",{value:!0})})},"esri/views/2d/layers/features/support/pixelBuffering":function(){define("exports ../../../../../core/promiseUtils ../../../../../core/screenUtils ../../../engine/webgl/definitions ../../../../../symbols/cim/Rect ../../../../../symbols/cim/CIMSymbolHelper ../../graphics/graphicsUtils".split(" "),function(u,h,e,B,d,l,m){function g(b){if(!("visualVariables"in b&&b.hasVisualVariables("size")))return 0;
b=b.getVisualVariablesForType("size");if(!b[0])return 0;b=b[0];if("stops"===b.transformationType)return b.stops.map(f=>f.size).reduce(D,0);if("clamped-linear"===b.transformationType)return"number"===typeof b.maxSize?b.maxSize:b.maxSize.stops.map(f=>f.size).reduce(D,0);if("real-world-size"===b.transformationType)return 30}function k(b,f){return null==b?f:b}async function w(b,f){if("simple-marker"===b.type)return f=Math.max(k(b.size,12),f),q(b)+.707*f;if("picture-marker"===b.type){var t=Math.max(k(b.height,
12),f);f=k(b.width,12)*(t/k(b.height,12))/2;t/=2;return q(b)+Math.sqrt(f*f+t*t)}if("text"===b.type){if(t=b.text&&b.text.length){f=[];for(let C=0;C<t;C++)f.push({...y,code:b.text.charCodeAt(C)});f={glyphMosaicItems:f}}else f={glyphMosaicItems:[y]};m.getTextSymbolSize(v,b.toJSON(),f);return Math.max(Math.abs(v[0]),Math.abs(v[1]))+Math.max(v[2],v[3])}return"simple-line"===b.type?(t=Math.max(k(b.width,.75),f)/2,b.marker?Math.max(6*b.width,2*f):t):"simple-fill"===b.type||"picture-fill"===b.type?Math.max(null==
b.outline?0:k(b.outline.width,0),f)/2:"cim"===b.type?(b=l.CIMSymbolHelper.getEnvelope(b.data))?Math.sqrt(b.width*b.width+b.height*b.height):0:"web-style"===b.type?w(await b.fetchCIMSymbol(),f):0}async function r(b,f){return b.type in x?Math.min(await w(b,f),75):0}function q(b){const f=k(b.xoffset,0);b=k(b.yoffset,0);return Math.sqrt(f*f+b*b)}function D(b,f){return Math.max(b,f)}const x={"simple-marker":1,"picture-marker":1,text:0,"simple-line":0,"simple-fill":0,"picture-fill":0,cim:1,"web-style":1},
v=[0,0,0,0],y={sdf:!0,code:99,metrics:B.AVERAGE_GLYPH_MOSAIC_ITEM.metrics,rect:new d(0,0,24,24),page:0,textureBinding:2};u.computePxBuffer=async function(b,f,t){if(!b||t&&"cluster"===t.type)return 0;if("heatmap"===b.type)return Math.round(3*b.blurRadius);if("dot-density"===b.type)return 0;if("dictionary"===b.type)return"esriGeometryPoint"===f||"esriGeometryMultipoint"===f?100:200;f=b.getSymbols();b=g(b);t=[];for(var C of f)t.push(r(C,b));C=await h.all(t);return e.pt2px(C.reduce(D,0))};Object.defineProperty(u,
"__esModule",{value:!0})})},"esri/views/2d/layers/support/FeatureLayerProxy":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/has ../../../../core/Logger ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/property ../../../../core/jsonMap ../../../../core/accessorSupport/decorators/subclass ../../../../core/urlUtils ../../../../core/uuid ../../../../portal/support/resourceExtension ../../../../core/promiseUtils ../../../../core/Promise ../../../../core/workers/workers".split(" "),
function(u,h,e,B,d,l,m,g,k,w,r,q,D,x){e=function(v){function y(f){f=v.call(this,f)||this;f._startupResolver=q.createResolver();f.isReady=!1;return f}u._inheritsLoose(y,v);var b=y.prototype;b.initialize=function(){this._controller=q.createAbortController();this.addResolvingPromise(this._startWorker(this._controller.signal))};b.destroy=function(){this._controller.abort();this._connection&&this._connection.close()};b.startup=async function(f,t,C){await this.when();var K=this._controller.signal;K=Array.isArray(C.source)?
{transferList:C.source,signal:K}:void 0;f=f.tileInfo.toJSON();await this._connection.invoke("startup",{service:C,config:t,tileInfo:f},K);this._startupResolver.resolve();this._set("isReady",!0)};b.updateTiles=async function(f){await this._startupResolver.promise;return q.ignoreAbortErrors(this._connection.invoke("updateTiles",f))};b.update=async function(f,t){f={config:f,pause:t};await this._startupResolver.promise;return this._connection.invoke("update",f)};b.invalidate=async function(f){await this._startupResolver.promise;
return this._connection.invoke("invalidate",f)};b.resume=async function(){await this._startupResolver.promise;return q.ignoreAbortErrors(this._connection.invoke("controller.resume"))};b.setHighlight=async function(f){await this._startupResolver.promise;return q.ignoreAbortErrors(this._connection.invoke("controller.setHighlight",f))};b.refresh=async function(){await this._startupResolver.promise;return q.ignoreAbortErrors(this._connection.invoke("controller.refresh"))};b.setViewState=async function(f){await this._startupResolver.promise;
return q.ignoreAbortErrors(this._connection.invoke("setViewState",f.toJSON()))};b.queryFeatures=async function(f,t){await this._startupResolver.promise;return this._connection.invoke("controller.queryFeatures",f.toJSON(),t)};b.queryObjectIds=async function(f,t){await this._startupResolver.promise;return this._connection.invoke("controller.queryObjectIds",f.toJSON(),t)};b.queryFeatureCount=async function(f,t){await this._startupResolver.promise;return this._connection.invoke("controller.queryFeatureCount",
f.toJSON(),t)};b.queryExtent=async function(f,t){return this._connection.invoke("controller.queryExtent",f.toJSON(),t)};b.queryLatestObservations=async function(f,t){await this._startupResolver.promise;return this._connection.invoke("controller.queryLatestObservations",f.toJSON(),t)};b.queryStatistics=async function(f){await this._startupResolver.promise;return this._connection.invoke("controller.queryStatistics",f)};b.getObjectId=async function(f){await this._startupResolver.promise;return this._connection.invoke("controller.getObjectId",
f)};b.getDisplayId=async function(f){await this._startupResolver.promise;return this._connection.invoke("controller.getDisplayId",f)};b.getFeature=async function(f){await this._startupResolver.promise;return this._connection.invoke("controller.getFeature",f)};b.getAggregate=async function(f){await this._startupResolver.promise;return this._connection.invoke("controller.getAggregate",f)};b.getAggregateValueRanges=async function(){await this._startupResolver.promise;return this._connection.invoke("controller.getAggregateValueRanges")};
b.mapValidDisplayIds=async function(f){await this._startupResolver.promise;return this._connection.invoke("controller.mapValidDisplayIds",f)};b.onEdits=async function(f){await this._startupResolver.promise;const {addedFeatures:t,deletedFeatures:C,updatedFeatures:K}=f;return q.ignoreAbortErrors(this._connection.invoke("controller.onEdits",{addedFeatures:t,deletedFeatures:C,updatedFeatures:K}))};b.enableEvent=async function(f,t){await this._startupResolver.promise;return q.ignoreAbortErrors(this._connection.invoke("controller.enableEvent",
{name:f,value:t}))};b._startWorker=async function(f){try{this._connection=await x.open("Pipeline",{client:this.client,strategy:"dedicated",signal:f})}catch(t){q.throwIfNotAbortError(t)}};u._createClass(y,[{key:"tileRenderer",set:function(f){this.client.tileRenderer=f}},{key:"closed",get:function(){return this._connection.closed}}]);return y}(D.EsriPromise);h.__decorate([l.property()],e.prototype,"isReady",void 0);h.__decorate([l.property()],e.prototype,"client",void 0);h.__decorate([l.property()],
e.prototype,"tileRenderer",null);return e=h.__decorate([g.subclass("esri.views.2d.layers.support.FeatureLayerProxy")],e)})},"esri/views/2d/tiling/TileManager":function(){define(["exports","../../../core/maybe","./TileKey","./TileCoverage"],function(u,h,e,B){let d=function(){function l(g){this._tiles=new Map;this.buffer=0;this.acquireTile=g.acquireTile;this.releaseTile=g.releaseTile;this.tileInfoView=g.tileInfoView;this.buffer=g.buffer}var m=l.prototype;m.destroy=function(){};m.clear=function(){this._tiles.forEach(g=>
this._releaseTile(g))};m.tileKeys=function(){const g=[];this._tiles.forEach((k,w)=>g.push(w));return g};m.update=function(g){g=this.tileInfoView.getTileCoverage(g.state,this.buffer,"closest");const {spans:k,lodInfo:w}=g,{level:r}=w,q=[],D=[],x=new Set,v=new Set;for(const {row:y,colFrom:b,colTo:f}of k)for(let t=b;t<=f;t++){const C=e.getId(r,y,w.normalizeCol(t),w.getWorldForColumn(t)),K=this._getOrAcquireTile(q,C);x.add(C);K.isReady?K.visible=!0:v.add(K.key)}v.forEach(y=>this._addPlaceholders(x,y));
this._tiles.forEach(y=>{x.has(y.key.id)||(D.push(y.key.id),this._releaseTile(y))});B.pool.release(g);return{hasMissingTiles:0<v.size,added:q,removed:D}};m._getOrAcquireTile=function(g,k){if(!this._tiles.has(k)){const w=this.acquireTile(new e(k));g.push(k);this._tiles.set(k,w);w.visible=!1}return this._tiles.get(k)};m._getTile=function(g){return this._tiles.get(g)};m._releaseTile=function(g){this._tiles.delete(g.key.id);this.releaseTile(g)};m._addPlaceholders=function(g,k){const w=this._addPlaceholderChildren(g,
k);1E-6>Math.abs(1-w)||this._addPlaceholderParent(g,k)||(this._getTile(k.id).visible=!0)};m._addPlaceholderChildren=function(g,k){let w=0;this._tiles.forEach(r=>{w+=this._addPlaceholderChild(g,r,k)});return w};m._addPlaceholderChild=function(g,k,w){if(k.key.level<=w.level||!k.hasData||!w.contains(k.key))return 0;k.visible=!0;g.add(k.key.id);return 1/(1<<2*(k.key.level-w.level))};m._addPlaceholderParent=function(g,k){k=k.getParentKey();let w=0,r=null;for(;h.isSome(k);){if(g.has(k.id))return!0;const q=
this._getTile(k.id);if(null!=q&&q.isReady)return q.visible=!0,g.add(q.key.id),!0;null!=q&&q.hasData&&q.patchCount>w&&(w=q.patchCount,r=q);k=k.getParentKey()}return r?(r.visible=!0,g.add(r.key.id),!0):!1};return l}();u.TileManager=d;Object.defineProperty(u,"__esModule",{value:!0})})},"*noref":1}});
define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/has ../../../core/lang ../../../core/maybe ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/property ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../core/Error ../../../core/urlUtils ../../../core/uuid ../../../portal/support/resourceExtension ../../../core/arrayUtils ../../../core/promiseUtils ../../../geometry/Extent ../../../geometry ../../../core/Collection ../../../Graphic ../../../AggregateGraphic ../../../core/watchUtils ../../../tasks/support/FeatureSet ../../../tasks/support/Query ../../layers/RefreshableLayerView ../engine/webgl/definitions ../../webgl/capabilities ../../layers/LayerView ../../../renderers/support/clickToleranceUtils ../../support/drapedUtils ./support/clusterUtils ../../layers/effects/EffectList ./support/util ./features/schemaUtils ../../layers/support/FeatureFilter ../../layers/support/FeatureEffect ../../layers/FeatureLayerView ./LayerView2D ./features/tileRenderers ./features/support/pixelBuffering ./support/FeatureLayerProxy ../tiling/TileManager".split(" "),function(u,
h,e,B,d,l,m,g,k,w,r,q,D,x,v,y,b,f,t,C,K,J,E,S,G,M,H,I,n,A,L,R,U,V,T,P,ca,ea,fa,ha,ia,ja){function ka(Z){return Z&&"openPorts"in Z}function la(Z){const {capabilities:ba,collectionId:z,source:{layerDefinition:a},url:c}=Z;return{capabilities:ba,collectionId:z,url:c,layerDefinition:a}}const Y=l.getLogger("esri.views.2d.layers.FeatureLayerView2D");e=function(Z){function ba(){var a=Z.apply(this,arguments)||this;a._pipelineIsUpdating=!0;a._updatingPipelineConfig=!1;a._onGoingEdits=0;a._isRefreshing=!1;a._viewStateId=
-1;a._visibilityOverrides=new Set;a._effect=null;a._highlightIds=new Map;a._lastPixelBuffer=0;a.filter=null;a.effectLists={included:new R["default"],excluded:new R["default"]};a.doRefresh=y.debounce(async()=>{a._onGoingEdits=0;a.isUpdating()&&await J.whenFalseOnce(u._assertThisInitialized(a),"updating");try{a._set("_isRefreshing",!0),a._lockGPUUploads(),await a._proxy.refresh(),a._unlockGPUUploads(),a._set("_isRefreshing",!1)}catch(c){y.isAbortError(c)||Y.error(c)}});a._doUpdate=y.debounce(async()=>
{if(!a.destroyed&&a._hasRequiredSupport(a.layer)){a._set("_updatingPipelineConfig",!0);await J.whenFalseOnce(u._assertThisInitialized(a),"_isRefreshing");var {effect:c,filter:p}=u._assertThisInitialized(a);await a._updateRequiredFields();if(!a.destroyed){var {renderer:F}=a._getEffectiveRenderer();a._set("_effectiveRenderer",F);var N={renderer:a.layer.renderer,spatialReference:a.layer.spatialReference,timeExtent:a.layer.timeExtent,definitionExpression:a.layer.definitionExpression,featureReduction:a.layer.featureReduction,
fields:a.layer.fields,geometryType:a.layer.geometryType,historicMoment:"feature"===a.layer.type?a.layer.historicMoment:null,labelsVisible:a.layer.labelsVisible,labelingInfo:a.layer.labelingInfo,availableFields:a.availableFields,effect:a.effect,filter:a.filter,gdbVersion:"feature"===a.layer.type?a.layer.gdbVersion:null,pixelBuffer:0},Q=U.toJSONGeometryType(a.layer.geometryType);Q=await ha.computePxBuffer(F,Q,a.layer.featureReduction);N=a._createConfiguration(N,p,c);a._lastPixelBuffer=0===Q?0:Math.max(Q,
a._lastPixelBuffer);N.schema.source.pixelBuffer=a._lastPixelBuffer;Q=a._createTileRendererHash(F);if(!a.destroyed){if(Q!==a._tileRendererHash){await a._initTileRenderer(F);if(a.destroyed)return;var W=await a._createServiceOptions();if(a.destroyed)return;a.effects.forEach(O=>d.isSome(O)&&d.isSome(O.filter)&&O.filter.enable());a.tileRenderer.onConfigUpdate(F);await a._proxy.startup(a.view.featuresTilingScheme,N,W);await a._proxy.updateTiles({added:a._tileStrategy.tileKeys(),removed:[]});if(a.destroyed)return;
a.hasHighlight()&&await a._proxy.setHighlight(Array.from(a._highlightIds.keys()));if(a.destroyed)return;await a._onceTilesUpdated();if(a.destroyed)return;a.tileRenderer.onConfigUpdate(F)}else{N=await a._proxy.update(N,!0);if(a.destroyed)return;if(N.queryFilter){a._lockGPUUploads();try{await a._proxy.invalidate(N)}catch(O){y.isAbortError(O)||Y.error(O)}if(a.destroyed)return;a._unlockGPUUploads()}else{try{await a._proxy.invalidate({...N,mesh:!1})}catch(O){y.isAbortError(O)||Y.error(O)}if(a.destroyed)return;
if(N.mesh){a._lockGPUUploads();try{await a._proxy.invalidate({mesh:!0,targets:{aggregate:null==(W=N.targets)?void 0:W.aggregate}})}catch(O){y.isAbortError(O)||Y.error(O)}a._unlockGPUUploads()}}if(a.destroyed)return;a._proxy.resume();a.effects.forEach(O=>d.isSome(O)&&d.isSome(O.filter)&&O.filter.enable());a.tileRenderer.onConfigUpdate(F);a._forceAttributeTextureUpload()}a._tileRendererHash=Q;a.tileRenderer.invalidateLabels();a.requestUpdate()}}}});a._updateHighlight=y.debounce(async()=>a._proxy.setHighlight(Array.from(a._highlightIds.keys())));
return a}u._inheritsLoose(ba,Z);var z=ba.prototype;z.destroy=function(){var a,c;null==(a=this._proxy)?void 0:a.destroy();d.andThen(this._updateClusterSizeTask,p=>p.remove());null==(c=this.tileRenderer)?void 0:c.destroy()};z.initialize=function(){this.addResolvingPromise(this._initProxy());this.handles.add([this.on("valueRangesChanged",a=>{this._set("_aggregateValueRanges",a.valueRanges)}),J.init(this,"effect",a=>{this.effectLists.included.effect=null==a?void 0:a.includedEffect}),J.init(this,"effect",
a=>{this.effectLists.excluded.effect=null==a?void 0:a.excludedEffect})])};z._initProxy=async function(){if("stream"!==this.layer.type&&"ogc-feature"!==this.layer.type&&this.layer.isTable)throw new r("featurelayerview:table-not-supported","table feature layer can't be displayed",{layer:this.layer});this._proxy&&this._proxy.destroy();const a=this._createClientOptions();this._set("_proxy",new ia({client:a}));return this._proxy.when()};z.highlight=function(a){let c;a instanceof C?c=[a.getObjectId()]:
"number"===typeof a?c=[a]:t.isCollection(a)?c=a.map(p=>p&&p.getAttribute(this.layer.objectIdField)).toArray():Array.isArray(a)&&0<a.length&&(c="number"===typeof a[0]?a:a.map(p=>p&&p.getAttribute(this.layer.objectIdField)));if(!c||!c.length)return{remove:()=>{}};c=c.filter(p=>null!=p);this._addHighlight(c);return{remove:()=>this._removeHighlight(c)}};z.hasHighlight=function(){return!!this._highlightIds.size};z.hitTest=function(a,c){return this._hitTest(a,c)};z.queryStatistics=function(){return this._proxy.queryStatistics()};
z.queryFeatures=function(a,c){return this.queryFeaturesJSON(a,c).then(p=>{p=E.fromJSON(p);p.features.forEach(F=>{F.layer=this.layer;F.sourceLayer=this.layer});return p})};z.queryFeaturesJSON=function(a,c){return this._proxy.queryFeatures(this._cleanUpQuery(a),c)};z.queryObjectIds=function(a,c){return this._proxy.queryObjectIds(this._cleanUpQuery(a),c)};z.queryFeatureCount=function(a,c){return this._proxy.queryFeatureCount(this._cleanUpQuery(a),c)};z.queryExtent=function(a,c){return this._proxy.queryExtent(this._cleanUpQuery(a),
c).then(p=>({count:p.count,extent:b.fromJSON(p.extent)}))};z.setVisibility=function(a,c){c?this._visibilityOverrides.delete(a):this._visibilityOverrides.add(a);this._update()};z.update=function(a){if(this._tileStrategy&&this.tileRenderer){var {hasMissingTiles:c,added:p,removed:F}=this._tileStrategy.update(a);(p.length||F.length)&&this._proxy.updateTiles({added:p,removed:F});c&&this.requestUpdate();({state:a}=a);this._viewStateId!==a.id&&(this._proxy.setViewState(a),this._viewStateId=a.id);this.notifyChange("updating")}};
z.attach=function(){this.view.timeline.record(`${this.layer.title} (FeatureLayer) Attach`);this._tileStrategy=new ja.TileManager({acquireTile:a=>this._acquireTile(a),releaseTile:a=>this._releaseTile(a),tileInfoView:this.view.featuresTilingScheme,buffer:0});this.handles.add(J.init(this,"renderingConfigHash",()=>this._update()),"attach");"stream"!==this.layer.type&&this.handles.add(this.layer.on("edits",async a=>{this._set("_onGoingEdits",this._onGoingEdits+1);await this._proxy.onEdits(a);this._set("_onGoingEdits",
Math.max(0,this._onGoingEdits-1))}),"attach")};z.detach=function(){this.container.removeAllChildren();this.handles.remove("attach");this._updatingPipelineConfig=!1;this.tileRenderer&&(this.tileRenderer.uninstall(this.container),this.tileRenderer=null);this._tileStrategy&&(this._tileStrategy.destroy(),this._tileStrategy=null);this._tileRendererHash=null};z.moveStart=function(){this.requestUpdate()};z.viewChange=function(){this.requestUpdate()};z.moveEnd=function(){this.requestUpdate()};z.fetchPopupFeatures=
async function(a,c){if(d.isSome(c)&&c.clientGraphics.length){var p=c.clientGraphics[0];if(p instanceof K)return[p]}if(p=this.validateFetchPopupFeatures(c))throw p;if(d.isSome(c)&&0===c.clientGraphics.length)return[];p=this.fetchClientPopupFeatures(c);if(!a)return p;a=this._fetchServicePopupFeatures(a,c);return y.eachAlwaysValues([p,a]).then(v.flatten)};z._fetchServicePopupFeatures=async function(a,c){if("stream"===this.layer.type)return[];const p=await this.createPopupQuery(c),{layer:F}=this;var {renderer:N}=
F;const Q=d.isSome(c)?c.event:null;N=n.calculateTolerance({renderer:N,event:Q});p.geometry=this.createFetchPopupFeaturesQueryGeometry(a,N);const W=new Set,{objectIdField:O}=F;if(a=d.isSome(c)?c.clientGraphics:null)for(const aa of a)W.add(aa.attributes[O]);return F.queryFeatures(p).then(aa=>aa.features.filter(X=>!W.has(X.attributes[O])))};z.createFetchPopupFeaturesQueryGeometry=function(a,c){return A.createQueryGeometry(a,c,this.view)};z.isUpdating=function(){return null!=this.layer.renderer&&(null!=
this._updatingRequiredFieldsPromise||null==this.tileRenderer||!this._proxy||!this._proxy.isReady||this._pipelineIsUpdating||this._updatingPipelineConfig||this.tileRenderer.updating||0<this._onGoingEdits)};z._createClientOptions=function(){return{setUpdating:a=>{this._set("_pipelineIsUpdating",a)},emitEvent:a=>{this.emit(a.name,a.event)}}};z._createServiceOptions=async function(){const a=this.layer;if("stream"===a.type)return null;const {capabilities:c,objectIdField:p}=a,F=a.fields.map(da=>da.toJSON()),
N=a.fullExtent&&a.fullExtent.toJSON(),Q=U.toJSONGeometryType(a.geometryType),W=a.timeInfo&&a.timeInfo.toJSON()||null,O=a.spatialReference?a.spatialReference.toJSON():null,aa="feature"===a.type?a.customParameters:null;let X;"ogc-feature"===a.type?X=la(a):ka(a.source)?X=await a.source.openPorts():a.parsedUrl&&(X=B.clone(a.parsedUrl),"dynamicDataSource"in a&&a.dynamicDataSource&&(X.query={layer:JSON.stringify({source:a.dynamicDataSource})}));return{type:"on-demand",maxRecordCount:c.query.maxRecordCount,
tileMaxRecordCount:c.query.tileMaxRecordCount,capabilities:c,fields:F,fullExtent:N,geometryType:Q,objectIdField:p,source:X,timeInfo:W,spatialReference:O,customParameters:aa}};z._createMemoryServiceOptions=async function(a){a=await a.openPorts();return{...this._createServiceOptions(),type:"memory",source:a}};z._cleanUpQuery=function(a){a=S.from(a)||this.createQuery();a.outSpatialReference||(a.outSpatialReference=this.view.spatialReference);return a};z._createUpdateClusterSizeTask=function(a,c){return this.watch("_aggregateValueRanges",
async p=>{this._updateClusterEffectiveRendererSizeVariable(a,c,p);if(!this._updatingPipelineConfig)this.tileRenderer.onConfigUpdate(this._effectiveRenderer)})};z._updateClusterEffectiveRendererSizeVariable=async function(a,c,p){if(a.dynamicClusterSize&&"visualVariables"in a&&a.visualVariables){var F=L.findSizeVV(a.visualVariables);d.isSome(F)&&"cluster_count"===F.field&&(F=a.visualVariables.indexOf(F),a.visualVariables[F]=L.createClusterCountSizeVariable(c,p),a=a.clone(),a.dynamicClusterSize=!0,this._set("_effectiveRenderer",
a))}};z._getEffectiveRenderer=function(){var a=this.layer.renderer;const c=this.layer.featureReduction;d.isSome(this._updateClusterSizeTask)&&(this._updateClusterSizeTask.remove(),this._updateClusterSizeTask=null);if(c&&"cluster"===c.type&&L.isClusterCompatibleRenderer(a)){const p=[];a=L.createClusterRenderer(p,a,c,this._aggregateValueRanges);d.andThen(this._updateClusterSizeTask,F=>F.remove());this._updateClusterSizeTask=this._createUpdateClusterSizeTask(a,c);return{renderer:a,aggregateFields:p,
featureReduction:c}}return{renderer:a,aggregateFields:[],featureReduction:null}};z._acquireTile=function(a){a=this.tileRenderer.acquireTile(a);a.once("attach",()=>{this.requestUpdate()});return a};z._releaseTile=function(a){this.tileRenderer.releaseTile(a)};z._initTileRenderer=async function(a){const c=await fa.createOrReuseTileRenderer(a,{layerView:this,tileInfoView:this.view.featuresTilingScheme,layer:this.layer});this.tileRenderer&&(this._tileStrategy.clear(),this.tileRenderer.uninstall(this.container),
this.tileRenderer.destroy(),this.tileRenderer=null);if(this.destroyed)return null;this._proxy.tileRenderer=c;this._set("tileRenderer",c);this.tileRenderer.install(this.container);this.tileRenderer.onConfigUpdate(a);this.requestUpdate();return this.tileRenderer};z._createTileRendererHash=function(a){return`${"heatmap"===a.type?"heatmap":"symbol"}.${"dot-density"===a.type}`};z._createFeatureDataHash=function(a,c,p){a=a.getAttributeHash();c=JSON.stringify(c);p=d.isSome(p)&&JSON.stringify(p.filter);const F=
JSON.stringify(this.timeExtent);let N="";this._visibilityOverrides.forEach(Q=>N+=Q);return`${a}.${c}.${p}.${F}.${N}`};z._injectOverrides=function(a){var c=d.isSome(a)?a.timeExtent:null;c=d.isSome(this.timeExtent)&&d.isSome(c)?this.timeExtent.intersection(c):this.timeExtent||c;if(!this._visibilityOverrides.size&&!c)return a;a=d.isSome(a)&&a.clone()||new T;a.hiddenIds=this._visibilityOverrides;a.timeExtent=c;return a};z._createConfiguration=function(a,c,p){const F="feature"===this.layer.type&&this.layer.historicMoment?
this.layer.historicMoment.getTime():void 0,N="feature"===this.layer.type?this.layer.gdbVersion:void 0,Q=Array(M.MAX_FILTERS);c=this._injectOverrides(c);Q[0]=d.isSome(c)?c.toJSON():null;Q[1]=d.isSome(p)&&p.filter?p.filter.toJSON():null;a=V.createSchema(a);if(d.isNone(a))return null;p=H();return{definitionExpression:this.layer.definitionExpression,availableFields:this.availableFields,gdbVersion:N,historicMoment:F,devicePixelRatio:window.devicePixelRatio||1,filters:Q,schema:a,supportsTextureFloat:p.supportsTextureFloat,
maxTextureSize:p.maxTextureSize}};z._hasRequiredSupport=function(a){var c;return"dot-density"!==(null==(c=a.renderer)?void 0:c.type)||H().supportsTextureFloat?!0:(Y.error(new r("webgl-missing-extension","Missing WebGL extension OES_Texture_Float which is required for DotDensity")),!1)};z._onceTilesUpdated=function(){this.requestUpdate();return J.whenFalseOnce(this,"_pipelineIsUpdating",!1)};z._lockGPUUploads=function(){this.tileRenderer&&this.tileRenderer.lockGPUUploads()};z._unlockGPUUploads=function(){this.tileRenderer&&
this.tileRenderer.unlockGPUUploads()};z._forceAttributeTextureUpload=function(){this.tileRenderer&&this.tileRenderer.forceAttributeTextureUpload()};z._update=function(){this.view.timeline.begin(`${this.layer.title} (FeatureLayer) Initial Pipeline Config`);const a=this._doUpdate();this._updatingPromise=a;const c=()=>{a===this._updatingPromise&&this._set("_updatingPipelineConfig",!1);this.view&&this.view.timeline.end(`${this.layer.title} (FeatureLayer) Initial Pipeline Config`)};a.then(c).catch(p=>
{y.isAbortError(p)||Y.error(p);c()})};z._addHighlight=function(a){for(const c of a)this._highlightIds.has(c)?(a=this._highlightIds.get(c),this._highlightIds.set(c,a+1)):this._highlightIds.set(c,1);this._updateHighlight().catch(c=>{y.isAbortError(c)||Y.error(c)})};z._removeHighlight=function(a){for(const c of a)this._highlightIds.has(c)&&(a=this._highlightIds.get(c)-1,0===a?this._highlightIds.delete(c):this._highlightIds.set(c,a));this._updateHighlight().catch(c=>{y.isAbortError(c)||Y.error(c)})};
z._createHittestResult=function(a){a.layer=this.layer;a.sourceLayer=this.layer;d.isSome(a.geometry)&&(a.geometry.spatialReference=this.view.spatialReference);return a};z._hitTest=async function(a,c){if(this.suspended||!this.tileRenderer)return null;a=await this.tileRenderer.hitTest(a,c);if(0===a.length)return await y.after(1),null;a=a[0];if(1!==(a&2147483648)>>>31)return a=await this._proxy.getFeature(a),d.andThen(a,p=>this._createHittestResult(C.fromJSON(p)));a=await this._proxy.getAggregate(a);
return d.isNone(a)?null:d.isSome(a.referenceId)?(a=await this._proxy.getFeature(a.referenceId),d.andThen(a,p=>this._createHittestResult(C.fromJSON(p)))):this._createHittestResult(K.fromJSON(a))};u._createClass(ba,[{key:"labelsVisible",get:function(){return!this.suspended&&this.layer.labelingInfo&&this.layer.labelsVisible}},{key:"effect",get:function(){return d.unwrapOr(this._effect,null)},set:function(a){const c=this._effect;d.isSome(c)&&d.isSome(c.filter)&&c.filter.enabled&&d.isSome(a)&&d.isSome(a.filter)&&
a.filter.enable();this._effect=a;this.notifyChange("effect")}},{key:"effects",get:function(){return this.effect&&[this.effect]||[]}},{key:"renderingConfigHash",get:function(){if(!this.layer)return null;const a=this.availableFields,c=this.layer,{definitionExpression:p,renderer:F,labelingInfo:N}=c,Q="feature"===c.type?c.gdbVersion:void 0,W="feature"===c.type&&c.historicMoment?c.historicMoment.getTime():void 0,{timeExtent:O}=this,aa="stream"===c.type?`${JSON.stringify(c.geometryDefinition)}${c.definitionExpression}`:
null,X=JSON.stringify(this.clips),da=c.featureReduction&&c.featureReduction.toJSON();return JSON.stringify({filterHash:d.isSome(this.filter)&&this.filter.toJSON(),effectHash:d.isSome(this.effect)&&this.effect.toJSON(),streamFilter:aa,gdbVersion:Q,definitionExpression:p,historicMoment:W,availableFields:a,renderer:F,labelingInfo:c.labelsVisible&&N,timeExtent:O,clipsHash:X,featureReduction:da})}},{key:"hasEffects",get:function(){return this.effectLists.included.hasEffects||this.effectLists.excluded.hasEffects}}]);
return ba}(ca.FeatureLayerView(G.RefreshableLayerView(ea.LayerView2DMixin(I))));h.__decorate([g.property()],e.prototype,"_proxy",void 0);h.__decorate([g.property()],e.prototype,"_pipelineIsUpdating",void 0);h.__decorate([g.property()],e.prototype,"_updatingPipelineConfig",void 0);h.__decorate([g.property()],e.prototype,"_effectiveRenderer",void 0);h.__decorate([g.property()],e.prototype,"_aggregateValueRanges",void 0);h.__decorate([g.property()],e.prototype,"_onGoingEdits",void 0);h.__decorate([g.property()],
e.prototype,"_isRefreshing",void 0);h.__decorate([g.property({dependsOn:["suspended","layer.labelingInfo","layer.labelsVisible"]})],e.prototype,"labelsVisible",null);h.__decorate([g.property({type:T})],e.prototype,"filter",void 0);h.__decorate([g.property({type:P})],e.prototype,"effect",null);h.__decorate([g.property({readOnly:!0,dependsOn:["effect"]})],e.prototype,"effects",null);h.__decorate([g.property({dependsOn:"layer.renderer layer.outFields layer.definitionExpression layer.gdbVersion? layer.geometryDefinition? layer.historicMoment? layer.labelingInfo layer.labelsVisible layer.featureReduction filter effect timeExtent clips".split(" ")})],
e.prototype,"renderingConfigHash",null);h.__decorate([g.property()],e.prototype,"tileRenderer",void 0);h.__decorate([g.property({dependsOn:"layer.renderer tileRenderer tileRenderer.updating _updatingPipelineConfig _pipelineIsUpdating _updatingRequiredFieldsPromise _proxy _proxy.isReady? _onGoingEdits".split(" ")})],e.prototype,"updating",void 0);return e=h.__decorate([w.subclass("esri.views.2d.layers.FeatureLayerView2D")],e)});