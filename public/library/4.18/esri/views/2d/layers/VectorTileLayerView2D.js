// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.18/esri/copyright.txt for details.
//>>built
require({cache:{"esri/views/2d/engine/vectorTiles/style/StyleRepository":function(){define(["../../../../../core/has","./StyleLayer"],function(y,B){return function(){function u(k,f){this.backgroundBucketIds=[];this._uidToLayer=new Map;this._layerByName={};this._runningId=0;k.layers||(k.layers=[]);this.version=parseFloat(k.version);this.sprite=f?f.spriteUrl:k.sprite;this.glyphs=f?f.glyphsUrl:k.glyphs;if(this.layers=k.layers.map((p,h,e)=>this._create(p,h,e)))for(f=0;f<this.layers.length;f++)k=this.layers[f],
this._layerByName[k.id.toLowerCase()]=k,this._uidToLayer.set(k.uid,k),0===k.type&&this.backgroundBucketIds.push(k.id);this._identifyRefLayers()}var A=u.prototype;A.isPainterDataDriven=function(k){return(k=this._layerByName[k.toLowerCase()])?k.isPainterDataDriven():!1};A.getStyleLayerId=function(k){return k>=this.layers.length?null:this.layers[k].id};A.getStyleLayerByUID=function(k){k=this._uidToLayer.get(k);return null!=k?k:null};A.getStyleLayerIndex=function(k){return(k=this._layerByName[k.toLowerCase()])?
this.layers.indexOf(k):-1};A.setStyleLayer=function(k,f){if(k&&k.id){f&&f>=this.layers.length&&(f=this.layers.length-1);var p=!0,h;if(h=this._layerByName[k.id.toLowerCase()]){const e=this.layers.indexOf(h);f||(f=e);f===e?(p=!1,h=u._recreateLayer(k,h),this.layers[f]=h):(this.layers.splice(e,1),h=this._create(k,f,this.layers),this.layers.splice(f,0,h))}else h=this._create(k,f,this.layers),!f||f>=this.layers.length?this.layers.push(h):this.layers.splice(f,0,h);this._layerByName[k.id.toLowerCase()]=h;
this._uidToLayer.set(h.uid,h);p&&this._recomputeZValues();this._identifyRefLayers()}};A.getStyleLayer=function(k){return(k=this._layerByName[k.toLowerCase()])?{type:k.typeName,id:k.id,source:k.source,"source-layer":k.sourceLayer,minzoom:k.minzoom,maxzoom:k.maxzoom,filter:k.filter,layout:k.layout,paint:k.paint}:null};A.deleteStyleLayer=function(k){const f=this._layerByName[k.toLowerCase()];f&&(delete this._layerByName[k.toLowerCase()],this._uidToLayer.delete(f.uid),k=this.layers.indexOf(f),this.layers.splice(k,
1),this._recomputeZValues(),this._identifyRefLayers())};A.getLayerById=function(k){return this._layerByName[k.toLowerCase()]};A.getLayoutProperties=function(k){return(k=this._layerByName[k.toLowerCase()])?k.layout:null};A.getPaintProperties=function(k){return(k=this._layerByName[k.toLowerCase()])?k.paint:null};A.setPaintProperties=function(k,f){k=this._layerByName[k.toLowerCase()];if(!k)return"";f=u._recreateLayer({type:k.typeName,id:k.id,source:k.source,"source-layer":k.sourceLayer,minzoom:k.minzoom,
maxzoom:k.maxzoom,filter:k.filter,layout:k.layout,paint:f},k);const p=this.layers.indexOf(k);this.layers[p]=f;this._layerByName[k.id.toLowerCase()]=f;this._uidToLayer.set(k.uid,f);return k.id};A.setLayoutProperties=function(k,f){k=this._layerByName[k.toLowerCase()];if(!k)return"";f=u._recreateLayer({type:k.typeName,id:k.id,source:k.source,"source-layer":k.sourceLayer,minzoom:k.minzoom,maxzoom:k.maxzoom,filter:k.filter,layout:f,paint:k.paint},k);const p=this.layers.indexOf(k);this.layers[p]=f;this._layerByName[k.id.toLowerCase()]=
f;this._uidToLayer.set(k.uid,f);return k.id};A.setStyleLayerVisibility=function(k,f){if(k=this._layerByName[k.toLowerCase()]){var p=k.layout||{};p.visibility=f;f=u._recreateLayer({type:k.typeName,id:k.id,source:k.source,"source-layer":k.sourceLayer,minzoom:k.minzoom,maxzoom:k.maxzoom,filter:k.filter,layout:p,paint:k.paint},k);p=this.layers.indexOf(k);this.layers[p]=f;this._layerByName[k.id.toLowerCase()]=f;this._uidToLayer.set(k.uid,f)}};A.getStyleLayerVisibility=function(k){var f;k=this._layerByName[k.toLowerCase()];
if(!k)return"none";k=k.layout;return null!=(f=null==k?void 0:k.visibility)?f:"visible"};A._recomputeZValues=function(){const k=this.layers,f=1/(k.length+1);for(let p=0;p<k.length;p++)k[p].z=1-(1+p)*f};A._identifyRefLayers=function(){const k=[],f=[];let p=0;for(const b of this.layers){if(1===b.type){var h=b,e=b.source+"|"+b.sourceLayer;e+="|"+JSON.stringify(b.layout&&b.layout.visibility);e+="|"+JSON.stringify(b.minzoom);e+="|"+JSON.stringify(b.maxzoom);e+="|"+JSON.stringify(b.filter);if(h.hasDataDrivenFill||
h.hasDataDrivenOutline)e+="|"+JSON.stringify(p);k.push({key:e,layer:b})}2===b.type&&(h=b,e=b.source+"|"+b.sourceLayer,e+="|"+JSON.stringify(b.layout&&b.layout.visibility),e+="|"+JSON.stringify(b.minzoom),e+="|"+JSON.stringify(b.maxzoom),e+="|"+JSON.stringify(b.filter),e+="|"+JSON.stringify(b.layout&&b.layout["line-cap"]),e+="|"+JSON.stringify(b.layout&&b.layout["line-join"]),h.hasDataDrivenLine&&(e+="|"+JSON.stringify(p)),f.push({key:e,layer:b}));++p}this._assignRefLayers(k);this._assignRefLayers(f)};
A._assignRefLayers=function(k){k.sort((e,b)=>e.key<b.key?-1:e.key>b.key?1:0);let f,p;const h=k.length;for(let e=0;e<h;e++){const b=k[e];if(b.key===f)b.layer.refLayerId=p;else if(f=b.key,p=b.layer.id,1===b.layer.type&&!b.layer.getPaintProperty("fill-outline-color"))for(let d=e+1;d<h;d++){const r=k[d];if(r.key===f){if(r.layer.getPaintProperty("fill-outline-color")){k[e]=r;k[d]=b;p=r.layer.id;break}}else break}}};A._create=function(k,f,p){f=1-1/(p.length+1)*(1+f);p=this._runningId++;switch(k.type){case "background":return new B.BackgroundStyleLayer(0,
k,f,p);case "fill":return new B.FillStyleLayer(1,k,f,p);case "line":return new B.LineStyleLayer(2,k,f,p);case "symbol":return new B.SymbolStyleLayer(3,k,f,p);case "raster":throw Error("Unsupported vector tile raster layer");case "circle":return new B.CircleStyleLayer(4,k,f,p)}throw Error("Unknown vector tile layer");};u._recreateLayer=function(k,f){switch(k.type){case "background":return new B.BackgroundStyleLayer(0,k,f.z,f.uid);case "fill":return new B.FillStyleLayer(1,k,f.z,f.uid);case "line":return new B.LineStyleLayer(2,
k,f.z,f.uid);case "symbol":return new B.SymbolStyleLayer(3,k,f.z,f.uid);case "raster":throw Error("Unsupported vector tile raster layer");case "circle":return new B.CircleStyleLayer(4,k,f.z,f.uid)}};return u}()})},"esri/views/2d/engine/vectorTiles/style/StyleLayer":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ./Filter ./StyleDefinition ./StyleProperty ../../webgl/definitions".split(" "),function(y,B,u,A,k,f){let p=function(){function q(c,g,m,v){this.type=c;this.typeName=
g.type;this.id=g.id;this.source=g.source;this.sourceLayer=g["source-layer"];this.minzoom=g.minzoom;this.maxzoom=g.maxzoom;this.filter=g.filter;this.layout=g.layout;this.paint=g.paint;this.z=m;this.uid=v;switch(c){case 0:this._layoutDefinition=A.StyleDefinition.backgroundLayoutDefinition;this._paintDefinition=A.StyleDefinition.backgroundPaintDefinition;break;case 1:this._layoutDefinition=A.StyleDefinition.fillLayoutDefinition;this._paintDefinition=A.StyleDefinition.fillPaintDefinition;break;case 2:this._layoutDefinition=
A.StyleDefinition.lineLayoutDefinition;this._paintDefinition=A.StyleDefinition.linePaintDefinition;break;case 3:this._layoutDefinition=A.StyleDefinition.symbolLayoutDefinition;this._paintDefinition=A.StyleDefinition.symbolPaintDefinition;break;case 4:this._layoutDefinition=A.StyleDefinition.circleLayoutDefinition,this._paintDefinition=A.StyleDefinition.circlePaintDefinition}this._layoutProperties=this._parseLayout(this.layout);this._paintProperties=this._parsePaint(this.paint)}var l=q.prototype;l.getFeatureFilter=
function(){return void 0!==this._featureFilter?this._featureFilter:this._featureFilter=u.createFilter(this.filter)};l.getLayoutProperty=function(c){return this._layoutProperties[c]};l.getPaintProperty=function(c){return this._paintProperties[c]};l.getLayoutValue=function(c,g,m){let v;const z=this._layoutProperties[c];z&&(v=z.getValue(g,m));const D=this._layoutDefinition[c];void 0===v&&(v=D["default"]);"enum"===D.type?v=D.values.indexOf(v):"array"===D.type&&"enum"===D.value&&(v=v.map(E=>D.values.indexOf(E)));
return v};l.getPaintValue=function(c,g,m){let v;const z=this._paintProperties[c];z&&(v=z.getValue(g,m));c=this._paintDefinition[c];void 0===v&&(v=c["default"]);"enum"===c.type&&(v=c.values.indexOf(v));return v};l.isPainterDataDriven=function(){const c=this._paintProperties;if(c)for(const g in c)if(c[g].isDataDriven)return!0;return!1};l._parseLayout=function(c){const g={};for(const m in c){const v=this._layoutDefinition[m];v&&(g[m]=new k(v,c[m]))}return g};l._parsePaint=function(c){const g={};for(const m in c){const v=
this._paintDefinition[m];v&&(g[m]=new k(v,c[m]))}return g};return q}(),h=function(q){function l(c,g,m,v){return q.call(this,c,g,m,v)||this}B._inheritsLoose(l,q);return l}(p),e=function(q){function l(c,g,m,v){c=q.call(this,c,g,m,v)||this;g=c.getPaintProperty("fill-color");c.hasDataDrivenColor=g?g.isDataDriven:!1;g=c.getPaintProperty("fill-opacity");c.hasDataDrivenOpacity=g?g.isDataDriven:!1;c.hasDataDrivenFill=c.hasDataDrivenColor||c.hasDataDrivenOpacity;g=c.getPaintProperty("fill-outline-color");
c.outlineUsesFillColor=!g;c.hasDataDrivenOutlineColor=g?g.isDataDriven:!1;c.hasDataDrivenOutline=(g?c.hasDataDrivenOutlineColor:c.hasDataDrivenColor)||c.hasDataDrivenOpacity;return c}B._inheritsLoose(l,q);return l}(p),b=function(q){function l(c,g,m,v){c=q.call(this,c,g,m,v)||this;m=c.getPaintProperty("line-color");c.hasDataDrivenColor=m?m.isDataDriven:!1;m=c.getPaintProperty("line-opacity");c.hasDataDrivenOpacity=m?m.isDataDriven:!1;m=c.getPaintProperty("line-width");c.hasDataDrivenWidth=m?m.isDataDriven:
!1;c.hasDataDrivenLine=c.hasDataDrivenColor||c.hasDataDrivenOpacity||c.hasDataDrivenWidth;g=g.paint["line-width"];g||(g=A.StyleDefinition.linePaintDefinition["line-width"].default);c.isThinLine=!c.hasDataDrivenWidth&&"number"===typeof g&&g<f.THIN_LINE_THRESHOLD;return c}B._inheritsLoose(l,q);return l}(p),d=function(q){function l(c,g,m,v){c=q.call(this,c,g,m,v)||this;g=c.getPaintProperty("icon-color");c.hasDataDrivenIconColor=g?g.isDataDriven:!1;g=c.getPaintProperty("icon-opacity");c.hasDataDrivenIconOpacity=
g?g.isDataDriven:!1;g=c.getLayoutProperty("icon-size");c.hasDataDrivenIconSize=g?g.isDataDriven:!1;c.hasDataDrivenIcon=c.hasDataDrivenIconColor||c.hasDataDrivenIconOpacity||c.hasDataDrivenIconSize;g=c.getPaintProperty("text-color");c.hasDataDrivenTextColor=g?g.isDataDriven:!1;g=c.getPaintProperty("text-opacity");c.hasDataDrivenTextOpacity=g?g.isDataDriven:!1;g=c.getLayoutProperty("text-size");c.hasDataDrivenTextSize=g?g.isDataDriven:!1;c.hasDataDrivenText=c.hasDataDrivenTextColor||c.hasDataDrivenTextOpacity||
c.hasDataDrivenTextSize;return c}B._inheritsLoose(l,q);return l}(p),r=function(q){function l(c,g,m,v){c=q.call(this,c,g,m,v)||this;g=c.getPaintProperty("circle-radius");c.hasDataDrivenRadius=g?g.isDataDriven:!1;g=c.getPaintProperty("circle-color");c.hasDataDrivenColor=g?g.isDataDriven:!1;g=c.getPaintProperty("circle-opacity");c.hasDataDrivenOpacity=g?g.isDataDriven:!1;g=c.getPaintProperty("circle-stroke-width");c.hasDataDrivenStrokeWidth=g?g.isDataDriven:!1;g=c.getPaintProperty("circle-stroke-color");
c.hasDataDrivenStrokeColor=g?g.isDataDriven:!1;g=c.getPaintProperty("circle-stroke-opacity");c.hasDataDrivenStrokeOpacity=g?g.isDataDriven:!1;g=c.getPaintProperty("circle-blur");c.hasDataDrivenBlur=g?g.isDataDriven:!1;return c}B._inheritsLoose(l,q);return l}(p);y.BackgroundStyleLayer=h;y.CircleStyleLayer=r;y.FillStyleLayer=e;y.IconLayout=function(q,l,c,g){this.allowOverlap=q.getLayoutValue("icon-allow-overlap",l,g);this.anchor=q.getLayoutValue("icon-anchor",l,g);this.ignorePlacement=q.getLayoutValue("icon-ignore-placement",
l,g);this.keepUpright=q.getLayoutValue("icon-keep-upright",l,g);this.offset=q.getLayoutValue("icon-offset",l,g);this.optional=q.getLayoutValue("icon-optional",l,g);this.padding=q.getLayoutValue("icon-padding",l,g);this.rotate=q.getLayoutValue("icon-rotate",l,g);this.rotationAlignment=q.getLayoutValue("icon-rotation-alignment",l,g);this.size=q.getLayoutValue("icon-size",l,g);2===this.rotationAlignment&&(this.rotationAlignment=c?0:1)};y.LineStyleLayer=b;y.StyleLayer=p;y.SymbolStyleLayer=d;y.TextLayout=
function(q,l,c,g){this.allowOverlap=q.getLayoutValue("text-allow-overlap",l,g);this.anchor=q.getLayoutValue("text-anchor",l,g);this.fontArray=q.getLayoutValue("text-font",l,g);this.ignorePlacement=q.getLayoutValue("text-ignore-placement",l,g);this.justify=q.getLayoutValue("text-justify",l,g);this.keepUpright=q.getLayoutValue("text-keep-upright",l,g);this.letterSpacing=q.getLayoutValue("text-letter-spacing",l,g);this.lineHeight=q.getLayoutValue("text-line-height",l,g);this.maxAngle=q.getLayoutValue("text-max-angle",
l,g);this.maxWidth=q.getLayoutValue("text-max-width",l,g);this.offset=q.getLayoutValue("text-offset",l,g);this.optional=q.getLayoutValue("text-optional",l,g);this.padding=q.getLayoutValue("text-padding",l,g);this.rotate=q.getLayoutValue("text-rotate",l,g);this.rotationAlignment=q.getLayoutValue("text-rotation-alignment",l,g);this.size=q.getLayoutValue("text-size",l,g);this.transform=q.getLayoutValue("text-transform",l,g);this.writingMode=q.getLayoutValue("text-writing-mode",l,g);2===this.rotationAlignment&&
(this.rotationAlignment=c?0:1)};Object.defineProperty(y,"__esModule",{value:!0})})},"esri/views/2d/engine/vectorTiles/style/Filter":function(){define(["../../../../../chunks/expression"],function(y){return function(){function B(u){this._expression=u}B.prototype.filter=function(u,A){if(!this._expression)return!0;try{return this._expression.evaluate(u,A)}catch(k){return console.log(k.message),!0}};B.createFilter=function(u){if(!u)return null;this.isLegacyFilter(u)&&(u=this.convertLegacyFilter(u));try{const A=
y.createExpression(u);return new B(A)}catch(A){return console.log(A.message),null}};B.isLegacyFilter=function(u){if(!Array.isArray(u)||0===u.length)return!0;switch(u[0]){case "\x3d\x3d":case "!\x3d":case "\x3e":case "\x3c":case "\x3e\x3d":case "\x3c\x3d":return 3===u.length&&"string"===typeof u[1]&&!Array.isArray(u[2]);case "in":return 3<=u.length&&"string"===typeof u[1]&&!Array.isArray(u[2]);case "!in":return!0;case "any":case "all":for(let A=1;A<u.length;A++)if(!this.isLegacyFilter(u[1]))return!1;
return!0;case "none":return!0;case "has":return 2===u.length&&("$id"===u[1]||"$type"===u[1]);case "!has":return!0;default:return!1}};B.convertLegacyFilter=function(u){if(!Array.isArray(u)||0===u.length)return!0;const A=u[0];if(1===u.length)return"any"!==A;switch(A){case "\x3d\x3d":return B.convertComparison("\x3d\x3d",u[1],u[2]);case "!\x3d":return B.negate(B.convertComparison("\x3d\x3d",u[1],u[2]));case "\x3e":case "\x3c":case "\x3e\x3d":case "\x3c\x3d":return B.convertComparison(A,u[1],u[2]);case "in":return B.convertIn(u[1],
u.slice(2));case "!in":return B.negate(B.convertIn(u[1],u.slice(2)));case "any":case "all":case "none":return B.convertCombining(A,u.slice(1));case "has":return B.convertHas(u[1]);case "!has":return B.negate(B.convertHas(u[1]));default:throw Error("Unexpected legacy filter.");}};B.convertComparison=function(u,A,k){switch(A){case "$type":return[u,["geometry-type"],k];case "$id":return[u,["id"],k];default:return[u,["get",A],k]}};B.convertIn=function(u,A){switch(u){case "$type":return["in",["geometry-type"],
["literal",A]];case "$id":return["in",["id"],["literal",A]];default:return["in",["get",u],["literal",A]]}};B.convertHas=function(u){switch(u){case "$type":return!0;case "$id":return["has-id"];default:return["has",u]}};B.convertCombining=function(u,A){return[u].concat(A.map(this.convertLegacyFilter))};B.negate=function(u){return["!",u]};return B}()})},"esri/chunks/expression":function(){define("exports ./_rollupPluginBabelHelpers ../Color ../views/2d/engine/vectorTiles/expression/data ../views/2d/unitBezier ../views/2d/engine/vectorTiles/GeometryUtils".split(" "),
function(y,B,u,A,k,f){function p(n){return n>Ka?Math.pow(n,1/3):n/qa+X}function h(n){return n>fa?n*n*n:qa*(n-X)}function e(n){return 255*(.0031308>=n?12.92*n:1.055*Math.pow(n,1/2.4)-.055)}function b(n){n/=255;return.04045>=n?n/12.92:Math.pow((n+.055)/1.055,2.4)}function d(n){var a=b(n.r);const t=b(n.g),x=b(n.b),H=p((.4124564*a+.3575761*t+.1804375*x)/.95047),S=p(.2126729*a+.7151522*t+.072175*x);a=p((.0193339*a+.119192*t+.9503041*x)/1.08883);return{l:116*S-16,a:500*(H-S),b:200*(S-a),alpha:n.a}}function r(n){let a=
(n.l+16)/116,t=isNaN(n.a)?a:a+n.a/500,x=isNaN(n.b)?a:a-n.b/200;a=1*h(a);t=.95047*h(t);x=1.08883*h(x);return new u([e(3.2404542*t-1.5371385*a-.4985314*x),e(-.969266*t+1.8760108*a+.041556*x),e(.0556434*t-.2040259*a+1.0572252*x),n.alpha])}function q(n,a,t){return{l:f.interpolate(n.l,a.l,t),a:f.interpolate(n.a,a.a,t),b:f.interpolate(n.b,a.b,t),alpha:f.interpolate(n.alpha,a.alpha,t)}}function l(n){const {l:a,a:t,b:x}=d(n),H=Math.atan2(x,t)*La;return{h:0>H?H+360:H,c:Math.sqrt(t*t+x*x),l:a,alpha:n.a}}function c(n){const a=
n.h*Ma,t=n.c;return r({l:n.l,a:Math.cos(a)*t,b:Math.sin(a)*t,alpha:n.alpha})}function g(n,a,t){{var x=n.h;const H=a.h-x;x+=t*(180<H||-180>H?H-360*Math.round(H/360):H)}return{h:x,c:f.interpolate(n.c,a.c,t),l:f.interpolate(n.l,a.l,t),alpha:f.interpolate(n.alpha,a.alpha,t)}}function m(n,a){return{kind:"array",itemType:n,n:a}}function v(n){if("array"===n.kind){const a=v(n.itemType);return"number"===typeof n.n?`array<${a}, ${n.n}>`:"value"===n.itemType.kind?"array":`array<${a}>`}return n.kind}function z(n){if(null===
n)return pa;if("string"===typeof n)return ca;if("boolean"===typeof n)return da;if("number"===typeof n)return ea;if(n instanceof u)return ja;if(Array.isArray(n)){let a;for(const t of n){const x=z(t);if(a){if(a!==x){a=ka;break}}else a=x}return m(a||ka,n.length)}return la}function D(n,a){if("error"===n.kind)return null;if("array"===a.kind){if("array"===n.kind&&(0===n.n&&"value"===n.itemType.kind||!D(n.itemType,a.itemType))&&("number"!==typeof a.n||a.n===n.n))return null}else{if(a.kind===n.kind)return null;
if("value"===a.kind)for(const t of Na)if(!D(t,n))return null}return`Expected ${v(a)} but found ${v(n)} instead.`}function E(n){const a=typeof n;return null===n?"":"string"===a||"number"===a||"boolean"===a?String(n):n instanceof u?n.toString():JSON.stringify(n)}function w(n){if(null===n||"string"===typeof n||"boolean"===typeof n||"number"===typeof n)n=["literal",n];if(!Array.isArray(n)||0===n.length)throw Error("Expression must be a non empty array");const a=n[0];if("string"!==typeof a)throw Error("First element of expression must be a string");
const t=ra[a];if(void 0===t)throw Error(`Invalid expression operator "${a}"`);if(!t)throw Error(`Unimplemented expression operator "${a}"`);return t.parse(n)}let F=function(){function n(a){this.args=a}n.parse=function(a){if(4!==a.length)throw Error('"rgb" expects 3 arguments.');a=a.slice(1).map(t=>w(t));return new n(a)};n.prototype.evaluate=function(a,t){const x=this.args[1].evaluate(a,t),H=this.args[2].evaluate(a,t);a=this.args[3].evaluate(a,t);return`rgb(${Math.round(x)},${Math.round(H)},${Math.round(a)})`};
return n}(),J=function(){function n(a){this.args=a}n.parse=function(a){if(5!==a.length)throw Error('"rgba" expects 4 arguments.');a=a.slice(1).map(t=>w(t));return new F(a)};n.prototype.evaluate=function(a,t){const x=this.args[1].evaluate(a,t),H=this.args[2].evaluate(a,t),S=this.args[3].evaluate(a,t);a=this.args[4].evaluate(a,t);return`rgb(${Math.round(x)},${Math.round(H)},${Math.round(S)},${a})`};return n}(),L=function(){function n(a){this.color=a}n.parse=function(a){if(2!==a.length)throw Error('"to-rgba" expects 1 argument.');
a=w(a[1]);return new n(a)};n.prototype.evaluate=function(a,t){return(new u(this.color.evaluate(a,t))).toRgba()};return n}(),I=function(){function n(a,t,x){this.lhs=a;this.rhs=t;this.compare=x}n.parse=function(a,t){if(3!==a.length&&4!==a.length)throw Error(`"${a[0]}" expects 2 or 3 arguments`);if(4===a.length)throw Error(`"${a[0]}" collator not supported`);return new n(w(a[1]),w(a[2]),t)};n.prototype.evaluate=function(a,t){return this.compare(this.lhs.evaluate(a,t),this.rhs.evaluate(a,t))};return n}(),
K=function(n){function a(){return n.apply(this,arguments)||this}B._inheritsLoose(a,n);a.parse=function(t){return I.parse(t,(x,H)=>x===H)};return a}(I),G=function(n){function a(){return n.apply(this,arguments)||this}B._inheritsLoose(a,n);a.parse=function(t){return I.parse(t,(x,H)=>x!==H)};return a}(I),M=function(n){function a(){return n.apply(this,arguments)||this}B._inheritsLoose(a,n);a.parse=function(t){return I.parse(t,(x,H)=>x<H)};return a}(I),Q=function(n){function a(){return n.apply(this,arguments)||
this}B._inheritsLoose(a,n);a.parse=function(t){return I.parse(t,(x,H)=>x<=H)};return a}(I),R=function(n){function a(){return n.apply(this,arguments)||this}B._inheritsLoose(a,n);a.parse=function(t){return I.parse(t,(x,H)=>x>H)};return a}(I),O=function(n){function a(){return n.apply(this,arguments)||this}B._inheritsLoose(a,n);a.parse=function(t){return I.parse(t,(x,H)=>x>=H)};return a}(I),C=function(){function n(a){this.arg=a}n.parse=function(a){if(2!==a.length)throw Error('"!" expects 1 argument');
return new n(w(a[1]))};n.prototype.evaluate=function(a,t){return!this.arg.evaluate(a,t)};return n}(),N=function(){function n(a){this.args=a}n.parse=function(a){const t=[];for(let x=1;x<a.length;x++)t.push(w(a[x]));return new n(t)};n.prototype.evaluate=function(a,t){for(const x of this.args)if(!x.evaluate(a,t))return!1;return!0};return n}(),P=function(){function n(a){this.args=a}n.parse=function(a){const t=[];for(let x=1;x<a.length;x++)t.push(w(a[x]));return new n(t)};n.prototype.evaluate=function(a,
t){for(const x of this.args)if(x.evaluate(a,t))return!0;return!1};return n}(),T=function(){function n(a){this.args=a}n.parse=function(a){const t=[];for(let x=1;x<a.length;x++)t.push(w(a[x]));return new n(t)};n.prototype.evaluate=function(a,t){for(const x of this.args)if(x.evaluate(a,t))return!1;return!0};return n}(),Y=function(){function n(a,t){this.args=a;this.fallback=t}n.parse=function(a){if(4>a.length)throw Error('"case" expects at least 3 arguments');if(1===a.length%2)throw Error('"case" expects an odd number of arguments');
const t=[];for(let x=1;x<a.length-1;x+=2)t.push({condition:w(a[x]),output:w(a[x+1])});return new n(t,w(a[a.length-1]))};n.prototype.evaluate=function(a,t){for(const x of this.args)if(x.condition.evaluate(a,t))return x.output.evaluate(a,t);return this.fallback.evaluate(a,t)};return n}(),aa=function(){function n(a){this.args=a}n.parse=function(a){if(2>a.length)throw Error('"coalesce" expects at least 1 argument');const t=[];for(let x=1;x<a.length;x++)t.push(w(a[x]));return new n(t)};n.prototype.evaluate=
function(a,t){for(const x of this.args){const H=x.evaluate(a,t);if(null!==H)return H}return null};return n}(),U=function(){function n(a,t,x,H){this.input=a;this.labels=t;this.outputs=x;this.fallback=H}n.parse=function(a){if(3>a.length)throw Error('"match" expects at least 3 arguments');if(0===a.length%2)throw Error('"case" expects an even number of arguments');const t=w(a[1]),x=[],H={};let S;for(let ba=2;ba<a.length-1;ba+=2){var W=a[ba];Array.isArray(W)||(W=[W]);for(const ma of W){W=typeof ma;if("string"!==
W&&"number"!==W)throw Error('"match" requires string or number literal as labels');if(!S)S=W;else if(W!==S)throw Error('"match" requires labels to have the same type');H[ma]=x.length}x.push(w(a[ba+1]))}return new n(t,H,x,w(a[a.length-1]))};n.prototype.evaluate=function(a,t){const x=this.input.evaluate(a,t);return(this.outputs[this.labels[x]]||this.fallback).evaluate(a,t)};return n}();const X=4/29,fa=6/29,qa=3*fa*fa,Ka=fa*fa*fa,Ma=Math.PI/180,La=180/Math.PI;let na=function(){function n(a,t,x,H){this.operator=
a;this.input=t;this.stops=x;this.interpolation=H}n.parse=function(a){if(5>a.length)throw Error(`"${a[0]}" expects at least 4 arguments.`);const t=a[1];if(!Array.isArray(t)||0===t.length)throw Error(`"${a[0]}" expects an interpolation type expression.`);switch(t[0]){case "linear":break;case "exponential":if("number"!==typeof t[1])throw Error(`"${a[0]}" expects a numeric base for exponential interpolation.`);break;case "cubic-bezier":if(5!==t.length)throw Error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.");
for(var x=1;5>x;x++){var H=t[x];if("number"!==typeof H||0>H||1<H)throw Error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.");}break;default:throw Error(`"${a[0]}" unknown interpolation type "${t[0]}".`);}if(1!==a.length%2)throw Error(`"${a[0]}" expects an even number of arguments.`);x=w(a[2]);H=[];for(let S=3;S<a.length;S+=2){const W=a[S];if("number"!==typeof W)throw Error(`"${a[0]}" requires stop inputs as literal numbers.`);if(H.length&&H[H.length-1][0]>=
W)throw Error(`"${a[0]}" requires strictly ascending stop inputs.`);H.push([W,w(a[S+1])])}return new n(a[0],x,H,t)};n.prototype.evaluate=function(a,t){const x=this.stops;if(1===x.length)return x[0][1].evaluate(a,t);var H=this.input.evaluate(a,t);if(H<=x[0][0])return x[0][1].evaluate(a,t);if(H>=x[x.length-1][0])return x[x.length-1][1].evaluate(a,t);let S=0;for(;++S<x.length&&!(H<x[S][0]););const W=n.interpolationRatio(this.interpolation,H,x[S-1][0],x[S][0]);H=x[S-1][1].evaluate(a,t);const ba=x[S][1].evaluate(a,
t);return"interpolate"===this.operator?Array.isArray(H)?H.map((ma,Oa)=>f.interpolate(ma,ba[Oa],W)):f.interpolate(H,ba,W):"interpolate-hcl"===this.operator?c(g(l(H),l(ba),W)):r(q(d(H),d(ba),W))};n.interpolationRatio=function(a,t,x,H){let S=0;"exponential"===a[0]?S=n.exponentialInterpolationRatio(t,a[1],x,H):"linear"===a[0]?S=n.exponentialInterpolationRatio(t,1,x,H):"cubic-bezier"===a[0]&&(S=k.unitBezier(a[1],a[2],a[3],a[4])(n.exponentialInterpolationRatio(t,1,x,H),1E-5));return S};n.exponentialInterpolationRatio=
function(a,t,x,H){H-=x;if(0===H)return 0;a-=x;return 1===t?a/H:(Math.pow(t,a)-1)/(Math.pow(t,H)-1)};return n}(),sa=function(){function n(a,t){this.input=a;this.stops=t}n.parse=function(a){if(5>a.length)throw Error('"step" expects at least 4 arguments.');if(1!==a.length%2)throw Error('"step" expects an even number of arguments.');const t=w(a[1]),x=[];x.push([-Infinity,w(a[2])]);for(let H=3;H<a.length;H+=2){const S=a[H];if("number"!==typeof S)throw Error('"step" requires stop inputs as literal numbers.');
if(x.length&&x[x.length-1][0]>=S)throw Error('"step" requires strictly ascending stop inputs.');x.push([S,w(a[H+1])])}return new n(t,x)};n.prototype.evaluate=function(a,t){const x=this.stops;if(1===x.length)return x[0][1].evaluate(a,t);const H=this.input.evaluate(a,t);let S=0;for(;++S<x.length&&!(H<x[S][0]););return this.stops[S-1][1].evaluate(a,t)};return n}(),ta=function(){function n(a,t){this.index=a;this.array=t}n.parse=function(a){if(3!==a.length)throw Error('"at" expects 2 arguments.');const t=
w(a[1]);a=w(a[2]);return new n(t,a)};n.prototype.evaluate=function(a,t){const x=this.index.evaluate(a,t);a=this.array.evaluate(a,t);if(0>x||x>=a.length)throw Error('"at" index out of bounds.');if(x!==Math.floor(x))throw Error('"at" index must be an integer.');return a[x]};return n}(),ua=function(){function n(a,t){this.key=a;this.obj=t}n.parse=function(a){let t;switch(a.length){case 2:return t=w(a[1]),new n(t);case 3:return t=w(a[1]),a=w(a[2]),new n(t,a);default:throw Error('"get" expects 1 or 2 arguments');
}};n.prototype.evaluate=function(a,t){const x=this.key.evaluate(a,t);return this.obj?this.obj.evaluate(a,t)[x]:a.values[x]};return n}(),va=function(){function n(a,t){this.key=a;this.obj=t}n.parse=function(a){let t;switch(a.length){case 2:return t=w(a[1]),new n(t);case 3:return t=w(a[1]),a=w(a[2]),new n(t,a);default:throw Error('"has" expects 1 or 2 arguments');}};n.prototype.evaluate=function(a,t){const x=this.key.evaluate(a,t);return this.obj?(a=this.obj.evaluate(a,t),x in a):void 0!==a.values[x]};
return n}(),wa=function(){function n(a,t){this.key=a;this.vals=t}n.parse=function(a){if(3!==a.length)throw Error('"in" expects 2 arguments');return new n(w(a[1]),w(a[2]))};n.prototype.evaluate=function(a,t){const x=this.key.evaluate(a,t);return-1!==this.vals.evaluate(a,t).indexOf(x)};return n}(),xa=function(){function n(a,t,x){this.item=a;this.array=t;this.from=x}n.parse=function(a){if(3>a.length||4<a.length)throw Error('"index-of" expects 3 or 4 arguments.');const t=w(a[1]),x=w(a[2]);return 4===
a.length?(a=w(a[3]),new n(t,x,a)):new n(t,x)};n.prototype.evaluate=function(a,t){const x=this.item.evaluate(a,t),H=this.array.evaluate(a,t);if(this.from){a=this.from.evaluate(a,t);if(a!==Math.floor(a))throw Error('"index-of" index must be an integer.');return H.indexOf(x,a)}return H.indexOf(x)};return n}(),ya=function(){function n(a){this.arg=a}n.parse=function(a){if(2!==a.length)throw Error('"length" expects 2 arguments.');a=w(a[1]);return new n(a)};n.prototype.evaluate=function(a,t){a=this.arg.evaluate(a,
t);if("string"===typeof a||Array.isArray(a))return a.length;throw Error('"length" expects string or array.');};return n}(),za=function(){function n(a,t,x){this.array=a;this.from=t;this.to=x}n.parse=function(a){if(3>a.length||4<a.length)throw Error('"slice" expects 2 or 3 arguments.');const t=w(a[1]),x=w(a[2]);return 4===a.length?(a=w(a[3]),new n(t,x,a)):new n(t,x)};n.prototype.evaluate=function(a,t){const x=this.array.evaluate(a,t),H=this.from.evaluate(a,t);if(0>H||H>=x.length)throw Error('"slice" index out of bounds.');
if(H!==Math.floor(H))throw Error('"slice" index must be an integer.');if(this.to){a=this.to.evaluate(a,t);if(0>a||a>=x.length)throw Error('"slice" index out of bounds.');if(a!==Math.floor(a))throw Error('"slice" index must be an integer.');return x.slice(H,a)}return x.slice(H)};return n}(),Aa=function(){function n(){}n.parse=function(a){if(1!==a.length)throw Error('"has-id" expects no arguments');return new n};n.prototype.evaluate=function(a,t){return void 0!==a.id};return n}(),Z=function(){function n(a,
t){this.args=a;this.calculate=t}n.parse=function(a,t){a=a.slice(1).map(x=>w(x));return new n(a,t)};n.prototype.evaluate=function(a,t){let x;this.args&&(x=this.args.map(H=>H.evaluate(a,t)));return this.calculate(x)};return n}(),Ba=function(n){function a(){return n.apply(this,arguments)||this}B._inheritsLoose(a,n);a.parse=function(t){switch(t.length){case 2:return Z.parse(t,x=>-x[0]);case 3:return Z.parse(t,x=>x[0]-x[1]);default:throw Error('"-" expects 1 or 2 arguments');}};return a}(Z),Ca=function(n){function a(){return n.apply(this,
arguments)||this}B._inheritsLoose(a,n);a.parse=function(t){return Z.parse(t,x=>{let H=1;for(const S of x)H*=S;return H})};return a}(Z),Da=function(n){function a(){return n.apply(this,arguments)||this}B._inheritsLoose(a,n);a.parse=function(t){if(3===t.length)return Z.parse(t,x=>x[0]/x[1]);throw Error('"/" expects 2 arguments');};return a}(Z),Ea=function(n){function a(){return n.apply(this,arguments)||this}B._inheritsLoose(a,n);a.parse=function(t){if(3===t.length)return Z.parse(t,x=>x[0]%x[1]);throw Error('"%" expects 2 arguments');
};return a}(Z),Fa=function(n){function a(){return n.apply(this,arguments)||this}B._inheritsLoose(a,n);a.parse=function(t){if(3===t.length)return Z.parse(t,x=>Math.pow(x[0],x[1]));throw Error('"^" expects 1 or 2 arguments');};return a}(Z),Ga=function(n){function a(){return n.apply(this,arguments)||this}B._inheritsLoose(a,n);a.parse=function(t){return Z.parse(t,x=>{let H=0;for(const S of x)H+=S;return H})};return a}(Z),V=function(){function n(a,t){this.args=a;this.calculate=t}n.parse=function(a){const t=
a.slice(1).map(x=>w(x));return new n(t,n.ops[a[0]])};n.prototype.evaluate=function(a,t){let x;this.args&&(x=this.args.map(H=>H.evaluate(a,t)));return this.calculate(x)};return n}();V.ops={abs:n=>Math.abs(n[0]),acos:n=>Math.acos(n[0]),asin:n=>Math.asin(n[0]),atan:n=>Math.atan(n[0]),ceil:n=>Math.ceil(n[0]),cos:n=>Math.cos(n[0]),e:()=>Math.E,floor:n=>Math.floor(n[0]),ln:n=>Math.log(n[0]),ln2:()=>Math.LN2,log10:n=>Math.log(n[0])/Math.LN10,log2:n=>Math.log(n[0])/Math.LN2,max:n=>Math.max(...n),min:n=>Math.min(...n),
pi:()=>Math.PI,round:n=>Math.round(n[0]),sin:n=>Math.sin(n[0]),sqrt:n=>Math.sqrt(n[0]),tan:n=>Math.tan(n[0])};let Ha=function(){function n(a){this.args=a}n.parse=function(a){return new n(a.slice(1).map(t=>w(t)))};n.prototype.evaluate=function(a,t){return this.args.map(x=>x.evaluate(a,t)).join("")};return n}(),oa=function(){function n(a,t){this.arg=a;this.calculate=t}n.parse=function(a){if(2!==a.length)throw Error(`${a[0]} expects 1 argument.`);const t=w(a[1]);return new n(t,n.ops[a[0]])};n.prototype.evaluate=
function(a,t){return this.calculate(this.arg.evaluate(a,t))};return n}();oa.ops={downcase:n=>n.toLowerCase(),upcase:n=>n.toUpperCase()};const pa={kind:"null"},ea={kind:"number"},ca={kind:"string"},da={kind:"boolean"},ja={kind:"color"},la={kind:"object"},ka={kind:"value"},Na=[pa,ea,ca,da,ja,la,m(ka)];let ha=function(){function n(a,t){this.type=a;this.args=t}n.parse=function(a){var t=a[0];if(2>a.length)throw Error(`${t} expects at least one argument.`);let x=1,H;if("array"===t){if(2<a.length){switch(a[1]){case "string":H=
ca;break;case "number":H=ea;break;case "boolean":H=da;break;default:throw Error('"array" type argument must be string, number or boolean');}x++}else H=ka;if(3<a.length){var S=a[2];if(null!==S&&("number"!==typeof S||0>S||S!==Math.floor(S)))throw Error('"array" length argument must be a positive integer literal');x++}H=m(H,S)}else switch(t){case "string":H=ca;break;case "number":H=ea;break;case "boolean":H=da;break;case "object":H=la}for(t=[];x<a.length;x++)S=w(a[x]),t.push(S);return new n(H,t)};n.prototype.evaluate=
function(a,t){for(const x of this.args){const H=x.evaluate(a,t);if(!D(z(H),this.type))return H}return null};return n}(),ia=function(){function n(a,t){this.type=a;this.args=t}n.parse=function(a){var t=a[0];if("to-boolean"===t||"to-string"===t){if(2!==a.length)throw Error(`${t} expects one argument.`);}else if(2>a.length)throw Error(`${t} expects at least one argument.`);t=n.types[t];const x=[];for(let H=1;H<a.length;H++){const S=w(a[H]);x.push(S)}return new n(t,x)};n.prototype.evaluate=function(a,
t){if(this.type===da)return!!this.args[0].evaluate(a,t);if(this.type===ca)return E(this.args[0].evaluate(a,t));if(this.type===ea){for(var x of this.args){var H=x.evaluate(a,t);if(null===H)return 0;H=Number(H);if(!isNaN(H))return H}return null}if(this.type===ja){for(H of this.args){x=H.evaluate(a,t);if(x instanceof u)return x;if("string"===typeof x)return u.fromString(x);if(Array.isArray(x)&&(3===x.length||4===x.length))return u.fromArray(x)}return null}};return n}();ia.types={"to-boolean":da,"to-color":ja,
"to-number":ea,"to-string":ca};let Ia=function(){function n(a){this.val=a}n.parse=function(a){if(2!==a.length)throw Error('"literal" expects 1 argument');return new n(a[1])};n.prototype.evaluate=function(a,t){return this.val};return n}(),Ja=function(){function n(a){this.arg=a}n.parse=function(a){if(2!==a.length)throw Error('"typeof" expects 1 argument');return new n(w(a[1]))};n.prototype.evaluate=function(a,t){return v(z(this.arg.evaluate(a,t)))};return n}();const ra={array:ha,"boolean":ha,collator:null,
format:null,literal:Ia,image:null,number:ha,"number-format":null,object:ha,string:ha,"to-boolean":ia,"to-color":ia,"to-number":ia,"to-string":ia,"typeof":Ja,accumulated:null,"feature-state":null,"geometry-type":A.GeomType,id:A.ID,"line-progress":null,properties:A.Properties,at:ta,get:ua,has:va,"in":wa,"index-of":xa,length:ya,slice:za,"!":C,"!\x3d":G,"\x3c":M,"\x3c\x3d":Q,"\x3d\x3d":K,"\x3e":R,"\x3e\x3d":O,all:N,any:P,"case":Y,coalesce:aa,match:U,within:null,interpolate:na,"interpolate-hcl":na,"interpolate-lab":na,
step:sa,let:null,"var":null,concat:Ha,downcase:oa,"is-supported-script":null,"resolved-locale":null,upcase:oa,rgb:F,rgba:J,"to-rgba":L,"-":Ba,"*":Ca,"/":Da,"%":Ea,"^":Fa,"+":Ga,abs:V,acos:V,asin:V,atan:V,ceil:V,cos:V,e:V,floor:V,ln:V,ln2:V,log10:V,log2:V,max:V,min:V,pi:V,round:V,sin:V,sqrt:V,tan:V,zoom:A.Zoom,"heatmap-density":null,"has-id":Aa,none:T};y.ALL=N;y.ANY=P;y.Add=Ga;y.Assert=ha;y.At=ta;y.BooleanType=da;y.Calculate=V;y.Case=Y;y.Coalesce=aa;y.Coerce=ia;y.ColorType=ja;y.Concat=Ha;y.Div=Da;
y.EQ=K;y.ErrorType={kind:"error"};y.GE=O;y.GT=R;y.Get=ua;y.Has=va;y.HasID=Aa;y.In=wa;y.IndexOf=xa;y.Interpolate=na;y.LE=Q;y.LT=M;y.Length=ya;y.Literal=Ia;y.Match=U;y.Mod=Ea;y.Mul=Ca;y.NE=G;y.NONE=T;y.NOT=C;y.NullType=pa;y.NumberType=ea;y.ObjectType=la;y.Pow=Fa;y.Rgb=F;y.Rgba=J;y.Slice=za;y.Step=sa;y.String=oa;y.StringType=ca;y.Sub=Ba;y.ToRgba=L;y.TypeOf=Ja;y.ValueType=ka;y.array=m;y.createExpression=w;y.ops=ra;y.typeToString=v;y.valueToString=E})},"esri/views/2d/engine/vectorTiles/expression/data":function(){define(["exports"],
function(y){let B=function(){function f(){}f.parse=function(p){if(1<p.length)throw Error('"id" does not expect arguments');return new f};f.prototype.evaluate=function(p,h){return p.id};return f}(),u=function(){function f(){}f.parse=function(p){if(1<p.length)throw Error('"geometry-type" does not expect arguments');return new f};f.prototype.evaluate=function(p,h){switch(p.type){case 0:return"Unknown";case 1:return"Point";case 2:return"LineString";case 3:return"Polygon"}};return f}(),A=function(){function f(){}
f.parse=function(p){if(1<p.length)throw Error('"properties" does not expect arguments');return new f};f.prototype.evaluate=function(p,h){return p.values};return f}(),k=function(){function f(){}f.parse=function(p){if(1<p.length)throw Error('"zoom" does not expect arguments');return new f};f.prototype.evaluate=function(p,h){return h};return f}();y.GeomType=u;y.ID=B;y.Properties=A;y.Zoom=k;Object.defineProperty(y,"__esModule",{value:!0})})},"esri/views/2d/engine/vectorTiles/GeometryUtils":function(){define(["exports"],
function(y){function B(h,e){h%=e;return 0<=h?h:h+e}const u=Number.POSITIVE_INFINITY,A=Math.PI,k=128/A,f=256/360,p=1/Math.LN2;y.C_256_TO_RAD=A/128;y.C_2PI=2*A;y.C_DEG_TO_256=f;y.C_DEG_TO_RAD=A/180;y.C_INFINITY=u;y.C_PI=A;y.C_PI_BY_2=A/2;y.C_RAD_TO_256=k;y.C_SQRT2=1.414213562;y.C_SQRT2_INV=1/1.414213562;y.between=function(h,e,b){return h>=e&&h<=b||h>=b&&h<=e};y.degToByte=function(h){return B(h*f,256)};y.interpolate=function(h,e,b){return h*(1-b)+e*b};y.log2=function(h){return Math.log(h)*p};y.positiveMod=
B;y.radToByte=function(h){return B(h*k,256)};y.sqr=function(h){return h*h};Object.defineProperty(y,"__esModule",{value:!0})})},"esri/views/2d/engine/vectorTiles/style/StyleDefinition":function(){define(["exports"],function(y){let B=function(){};B.backgroundLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:"visible"}};B.fillLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:"visible"}};B.lineLayoutDefinition={visibility:{type:"enum",values:["visible",
"none"],default:"visible"},"line-cap":{type:"enum",values:["butt","round","square"],default:"butt"},"line-join":{type:"enum",values:["bevel","round","miter"],default:"miter"},"line-miter-limit":{type:"number",default:2},"line-round-limit":{type:"number",default:1.05}};B.symbolLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:"visible"},"symbol-avoid-edges":{type:"boolean",default:!1},"symbol-placement":{type:"enum",values:["point","line","line-center"],default:"point"},"symbol-sort-key":{type:"number",
default:-1},"symbol-spacing":{type:"number",minimum:1,default:250},"icon-allow-overlap":{type:"boolean",default:!1},"icon-anchor":{type:"enum",values:"center left right top bottom top-left top-right bottom-left bottom-right".split(" "),default:"center"},"icon-ignore-placement":{type:"boolean",default:!1},"icon-image":{type:"string"},"icon-keep-upright":{type:"boolean",default:!1},"icon-offset":{type:"array",value:"number",length:2,default:[0,0]},"icon-optional":{type:"boolean",default:!1},"icon-padding":{type:"number",
minimum:0,default:2},"icon-rotate":{type:"number",default:0},"icon-rotation-alignment":{type:"enum",values:["map","viewport","auto"],default:"auto"},"icon-size":{type:"number",minimum:0,default:1},"text-allow-overlap":{type:"boolean",default:!1},"text-anchor":{type:"enum",values:"center left right top bottom top-left top-right bottom-left bottom-right".split(" "),default:"center"},"text-field":{type:"string"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"]},
"text-ignore-placement":{type:"boolean",default:!1},"text-justify":{type:"enum",values:["auto","left","center","right"],default:"center"},"text-keep-upright":{type:"boolean",default:!0},"text-letter-spacing":{type:"number",default:0},"text-line-height":{type:"number",default:1.2},"text-max-angle":{type:"number",minimum:0,default:45},"text-max-width":{type:"number",minimum:0,default:10},"text-offset":{type:"array",value:"number",length:2,default:[0,0]},"text-optional":{type:"boolean",default:!1},"text-padding":{type:"number",
minimum:0,default:2},"text-rotate":{type:"number",default:0},"text-rotation-alignment":{type:"enum",values:["map","viewport","auto"],default:"auto"},"text-size":{type:"number",minimum:0,default:16},"text-transform":{type:"enum",values:["none","uppercase","lowercase"],default:"none"},"text-writing-mode":{type:"array",value:"enum",values:["horizontal","vertical"],default:["horizontal"]}};B.circleLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:"visible"}};B.backgroundPaintDefinition=
{"background-color":{type:"color",default:[0,0,0,1]},"background-opacity":{type:"number",minimum:0,maximum:1,default:1},"background-pattern":{type:"string"}};B.fillPaintDefinition={"fill-antialias":{type:"boolean",default:!0},"fill-color":{type:"color",default:[0,0,0,1]},"fill-opacity":{type:"number",minimum:0,maximum:1,default:1},"fill-outline-color":{type:"color",default:[0,0,0,0]},"fill-pattern":{type:"string"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0]},"fill-translate-anchor":{type:"enum",
values:["map","viewport"],default:"map"}};B.linePaintDefinition={"line-blur":{type:"number",minimum:0,default:0},"line-color":{type:"color",default:[0,0,0,1]},"line-dasharray":{type:"array",value:"number",default:[]},"line-gap-width":{type:"number",minimum:0,default:0},"line-offset":{type:"number",default:0},"line-opacity":{type:"number",minimum:0,maximum:1,default:1},"line-pattern":{type:"string"},"line-translate":{type:"array",value:"number",length:2,default:[0,0]},"line-translate-anchor":{type:"enum",
values:["map","viewport"],default:"map"},"line-width":{type:"number",minimum:0,default:1}};B.symbolPaintDefinition={"icon-color":{type:"color",default:[0,0,0,1]},"icon-halo-blur":{type:"number",minimum:0,default:0},"icon-halo-color":{type:"color",default:[0,0,0,0]},"icon-halo-width":{type:"number",minimum:0,default:0},"icon-opacity":{type:"number",minimum:0,maximum:1,default:1},"icon-translate":{type:"array",value:"number",length:2,default:[0,0]},"icon-translate-anchor":{type:"enum",values:["map",
"viewport"],default:"map"},"text-color":{type:"color",default:[0,0,0,1]},"text-halo-blur":{type:"number",minimum:0,default:0},"text-halo-color":{type:"color",default:[0,0,0,0]},"text-halo-width":{type:"number",minimum:0,default:0},"text-opacity":{type:"number",minimum:0,maximum:1,default:1},"text-translate":{type:"array",value:"number",length:2,default:[0,0]},"text-translate-anchor":{type:"enum",values:["map","viewport"],default:"map"}};B.rasterPaintDefinition={"raster-opacity":{type:"number",minimum:0,
maximum:1,default:1},"raster-hue-rotate":{type:"number",default:0},"raster-brightness-min":{type:"number",minimum:0,maximum:1,default:0},"raster-brightness-max":{type:"number",minimum:0,maximum:1,default:1},"raster-saturation":{type:"number",minimum:-1,maximum:1,default:0},"raster-contrast":{type:"number",minimum:-1,maximum:1,default:0},"raster-fade-duration":{type:"number",minimum:0,default:300}};B.circlePaintDefinition={"circle-blur":{type:"number",minimum:0,default:0},"circle-color":{type:"color",
default:[0,0,0,1]},"circle-opacity":{type:"number",minimum:0,maximum:1,default:1},"circle-radius":{type:"number",minimum:0,default:5},"circle-stroke-color":{type:"color",default:[0,0,0,1]},"circle-stroke-opacity":{type:"number",minimum:0,maximum:1,default:1},"circle-stroke-width":{type:"number",minimum:0,default:0},"circle-translate":{type:"array",value:"number",length:2,default:[0,0]},"circle-translate-anchor":{type:"enum",values:["map","viewport"],default:"map"}};y.StyleDefinition=B;Object.defineProperty(y,
"__esModule",{value:!0})})},"esri/views/2d/engine/vectorTiles/style/StyleProperty":function(){define(["../../../../../Color","../../../../../chunks/expression","../GeometryUtils"],function(y,B,u){return function(){function A(f,p){this.isDataDriven=!1;let h;switch(f.type){case "number":h=!0;break;case "color":h=!0;p=A._parseColor(p);break;case "array":h="number"===f.value;break;default:h=!1}null==p&&(p=f.default);if(Array.isArray(p)&&0<p.length&&B.ops[p[0]])try{var e=B.createExpression(p);this.getValue=
this._buildExpression(e,f);this.isDataDriven=!0}catch(b){console.log(b.message),this.getValue=this._buildSimple(f.default)}else{h&&"interval"===p.type&&(h=!1);if(e=p&&p.stops&&0<p.stops.length)for(const b of p.stops)b[1]=this._validate(b[1],f);if(this.isDataDriven=p?!!p.property:!1)if(void 0!==p.default&&(p.default=this._validate(p.default,f)),e)switch(p.type){case "identity":this.getValue=this._buildIdentity(p,f);break;case "categorical":this.getValue=this._buildCategorical(p,f);break;default:this.getValue=
h?this._buildInterpolate(p,f):this._buildInterval(p,f)}else this.getValue=this._buildIdentity(p,f);else e?this.getValue=h?this._buildZoomInterpolate(p):this._buildZoomInterval(p):(p=this._validate(p,f),this.getValue=this._buildSimple(p))}}var k=A.prototype;k._validate=function(f,p){if("number"===p.type){if(f<p.minimum)return p.minimum;if(f>p.maximum)return p.maximum}return f};k._buildSimple=function(f){return()=>f};k._buildExpression=function(f,p){return(h,e)=>{try{let b=f.evaluate(e,h);"color"===
p.type&&(b=A._parseColor(b));return void 0===b?p.default:this._validate(b,p)}catch(b){return console.log(b.message),p.default}}};k._buildIdentity=function(f,p){return(h,e)=>{let b;e&&(b=e.values[f.property],"color"===p.type&&(b=A._parseColor(b)));void 0===b&&(b=f.default);return void 0!==b?this._validate(b,p):p.default}};k._buildCategorical=function(f,p){return(h,e)=>{let b;e&&(b=e.values[f.property]);b=this._categorical(b,f.stops);return void 0!==b?b:void 0!==f.default?f.default:p.default}};k._buildInterval=
function(f,p){return(h,e)=>{let b;e&&(b=e.values[f.property]);return"number"===typeof b?this._interval(b,f.stops):void 0!==f.default?f.default:p.default}};k._buildInterpolate=function(f,p){return(h,e)=>{let b;e&&(b=e.values[f.property]);return"number"===typeof b?this._interpolate(b,f.stops,f.base||1):void 0!==f.default?f.default:p.default}};k._buildZoomInterpolate=function(f){return p=>this._interpolate(p,f.stops,f.base||1)};k._buildZoomInterval=function(f){return p=>this._interval(p,f.stops)};k._categorical=
function(f,p){const h=p.length;for(let e=0;e<h;e++)if(p[e][0]===f)return p[e][1]};k._interval=function(f,p){const h=p.length;let e=0;for(let b=0;b<h;b++)if(p[b][0]<=f)e=b;else break;return p[e][1]};k._interpolate=function(f,p,h){const e=p.length;for(let r=0;r<e;r++){const q=p[r];if(q[0]<=f)var b=q;else{var d=q;break}}if(b&&d){p=d[0]-b[0];f-=b[0];h=1===h?f/p:(Math.pow(h,f)-1)/(Math.pow(h,p)-1);if(Array.isArray(b[1])){b=b[1];d=d[1];f=[];for(p=0;p<b.length;p++)f.push(u.interpolate(b[p],d[p],h));return f}return u.interpolate(b[1],
d[1],h)}if(b)return b[1];if(d)return d[1]};A._isEmpty=function(f){for(const p in f)if(f.hasOwnProperty(p))return!1;return!0};A._parseColor=function(f){if(Array.isArray(f))return f;if("string"===typeof f){if(f=new y(f),!this._isEmpty(f))return y.toUnitRGBA(f)}else return f&&f.default&&(f.default=A._parseColor(f.default)),f&&f.stops&&(f.stops=f.stops.map(p=>[p[0],A._parseColor(p[1])])),f};return A}()})},"esri/views/2d/engine/vectorTiles/VectorTile":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/mat3 ../../../../chunks/mat3f32 ./decluttering/config ./RenderBucket ../webgl/TiledDisplayObject".split(" "),
function(y,B,u,A,k,f,p){p=function(h){function e(d,r,q,l){q=h.call(this,d,q,l,[4096,4096])||this;q._referenced=0;q._hasSymbolBuckets=!1;q._memoryUsedByLayerData=0;q.layerData=new Map;q.layerCount=0;q.status="loading";q.allSymbolsFadingOut=!1;q.lastOpacityUpdate=0;q.symbols=new Map;q.isCoverage=!1;q.neededForCoverage=!1;q.decluttered=!1;q.invalidating=!1;q.parentTile=null;q.childrenTiles=new Set;q._processed=!1;q._referenced=1;q.styleRepository=r;q.id=d.id;q.transforms.tileUnitsToPixels=A.create();
return q}B._inheritsLoose(e,h);var b=e.prototype;b.setData=function(d){this.changeDataImpl(d);this.requestRender();this.ready();this.invalidating=!1;this._processed=!0};b.deleteLayerData=function(d){let r=!1;for(const q of d)this.layerData.has(q)&&(d=this.layerData.get(q),this._memoryUsedByLayerData-=d.memoryUsed,3===d.type&&this.symbols.has(q)&&(this.symbols.delete(q),r=!0),d.destroy(),this.layerData.delete(q),this.layerCount--);r&&this.emit("symbols-changed");this.requestRender()};b.processed=function(){return this._processed};
b.hasData=function(){return 0<this.layerCount};b.dispose=function(){e._destroyRenderBuckets(this.layerData);this.layerData=null;this._memoryUsedByLayerData=this.layerCount=0;this.destroy()};b.release=function(){return 0===--this._referenced?(this.dispose(),this.stage=null,!0):!1};b.reference=function(){++this._referenced};b.getMemoryUsage=function(){return this._memoryUsedByLayerData/(this._referenced||1)};b.changeDataImpl=function(d){let r=!1;if(d){d=this._createRenderBuckets(d);for(const [q,l]of d)this.layerData.has(q)&&
(d=this.layerData.get(q),this._memoryUsedByLayerData-=l.memoryUsed,d.destroy(),this.layerData.delete(q),this.layerCount--),3===l.type&&(this.symbols.set(q,l.symbols),r=!0),this._memoryUsedByLayerData+=l.memoryUsed,this.layerData.set(q,l),this.layerCount++}this._hasSymbolBuckets=!1;for(const [,q]of this.layerData)3===q.type&&(this._hasSymbolBuckets=!0);r&&this.emit("symbols-changed")};b.attachWithContext=function(d){this.stage={context:d,trashDisplayObject(r){r.processDetach()},untrashDisplayObject(){return!1}}};
b.setTransform=function(d,r){h.prototype.setTransform.call(this,d,r);var q=r/(d.resolution*d.pixelRatio);r=this.size[0]/this.coordRange[0]*q;q*=this.size[1]/this.coordRange[1];const l=[0,0];d.toScreen(l,this.coords);const c=this.transforms.tileUnitsToPixels;u.identity(c);u.translate(c,c,l);u.rotate(c,c,Math.PI*d.rotation/180);u.scale(c,c,[r,q,1])};e._destroyRenderBuckets=function(d){const r=new Set;d.forEach(q=>{r.has(q)||(q.destroy(),r.add(q))});d.clear()};b._createRenderBuckets=function(d){const r=
new Map,q=new Map;for(const l of d){d=this._deserializeBucket(l,q);for(const c of d.layerUIDs)r.set(c,d)}return r};b._deserializeBucket=function(d,r){let q=r.get(d);if(q)return q;switch((new Uint32Array(d))[0]){case 1:q=new f.FillRenderBucket(d);break;case 2:q=new f.LineRenderBucket(d);break;case 3:q=new f.SymbolRenderBucket(d,this);break;case 4:q=new f.CircleRenderBucket(d)}r.set(d,q);return q};B._createClass(e,[{key:"hasSymbolBuckets",get:function(){return this._hasSymbolBuckets}},{key:"isFading",
get:function(){return this._hasSymbolBuckets&&performance.now()-this.lastOpacityUpdate<k.FADE_DURATION}},{key:"isHoldingForFade",get:function(){return this._hasSymbolBuckets&&(!this.allSymbolsFadingOut||performance.now()-this.lastOpacityUpdate<k.FADE_DURATION)}},{key:"wasRequested",get:function(){return"errored"===this.status||"loaded"===this.status||"reloading"===this.status}},{key:"referenced",get:function(){return this._referenced}}]);return e}(p.TiledDisplayObject);y.VectorTile=p;Object.defineProperty(y,
"__esModule",{value:!0})})},"esri/views/2d/engine/vectorTiles/RenderBucket":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../webgl/Program ../../../webgl/BufferObject ../../../webgl/Texture ../../../webgl/VertexArrayObject ../../../webgl/Renderbuffer ../../../webgl/FramebufferObject ../../../webgl/ProgramCache ../../../webgl/RenderingContext ../../../webgl/ShaderCompiler ./decluttering/util".split(" "),function(y,B,u,A,k,f,p,h,e,b,d,r,q){A=function(){function l(g){this.layerUIDs=
[];this.isDestroyed=!1;this.data=g;this.memoryUsed=g.byteLength;let m=1;g=new Uint32Array(g);this.layerUIDs=[];const v=g[m++];for(let z=0;z<v;z++)this.layerUIDs[z]=g[m++];this.bufferDataOffset=m}var c=l.prototype;c.destroy=function(){this.isDestroyed||(this.doDestroy(),this.isDestroyed=!0)};c.prepareForRendering=function(g,m){u.isNone(this.data)||(this.doPrepareForRendering(g,m,this.data,this.bufferDataOffset),this.data=null)};B._createClass(l,[{key:"isPreparedForRendering",get:function(){return u.isNone(this.data)}},
{key:"offset",get:function(){return this.bufferDataOffset}}]);return l}();f=function(l){function c(m){var v=l.call(this,m)||this;v.type=2;v.lineIndexStart=0;v.lineIndexCount=0;let z=v.bufferDataOffset;m=new Uint32Array(m);v.lineIndexStart=m[z++];v.lineIndexCount=m[z++];v.isLineDataDriven=!!m[z++];v.bufferDataOffset=z;return v}B._inheritsLoose(c,l);var g=c.prototype;g.hasData=function(){return 0<this.lineIndexCount};g.triangleCount=function(){return this.lineIndexCount/3};g.doDestroy=function(){u.isSome(this.lineVertexArrayObject)&&
this.lineVertexArrayObject.dispose();u.isSome(this.lineVertexBuffer)&&this.lineVertexBuffer.dispose();u.isSome(this.lineIndexBuffer)&&this.lineIndexBuffer.dispose();this.lineIndexBuffer=this.lineVertexBuffer=this.lineVertexArrayObject=null;this.memoryUsed=0};g.doPrepareForRendering=function(m,v,z,D){z=new Uint32Array(z);var E=new Int32Array(z.buffer);const w=z[D++];this.lineVertexBuffer=k.createVertex(m,35044,new Int32Array(E.buffer,4*D,w));D+=w;E=z[D++];this.lineIndexBuffer=k.createIndex(m,35044,
new Uint32Array(z.buffer,4*D,E));D+=E;this.lineVertexArrayObject=new p(m,v.getProgramAttributes(3),this.isLineDataDriven?c.lineVertexAttributesDD:c.lineVertexAttributes,{geometry:this.lineVertexBuffer},this.lineIndexBuffer)};return c}(A);f.lineVertexAttributes={geometry:[{name:"a_pos",count:2,type:5122,offset:0,stride:12,normalized:!1,divisor:0},{name:"a_offsetAndNormal",count:4,type:5120,offset:4,stride:12,normalized:!1,divisor:0},{name:"a_accumulatedDistance",count:2,type:5123,offset:8,stride:12,
normalized:!1,divisor:0}]};f.lineVertexAttributesDD={geometry:[{name:"a_pos",count:2,type:5122,offset:0,stride:20,normalized:!1,divisor:0},{name:"a_offsetAndNormal",count:4,type:5120,offset:4,stride:20,normalized:!1,divisor:0},{name:"a_accumulatedDistance",count:2,type:5122,offset:8,stride:20,normalized:!1,divisor:0},{name:"a_color",count:4,type:5121,offset:12,stride:20,normalized:!0,divisor:0},{name:"a_width",count:1,type:5126,offset:16,stride:20,normalized:!1,divisor:0}]};h=function(l){function c(m){var v=
l.call(this,m)||this;v.type=1;v.fillIndexStart=0;v.fillIndexCount=0;v.outlineIndexStart=0;v.outlineIndexCount=0;let z=v.bufferDataOffset;m=new Uint32Array(m);v.fillIndexStart=m[z++];v.fillIndexCount=m[z++];v.outlineIndexStart=m[z++];v.outlineIndexCount=m[z++];v.isFillDataDriven=!!m[z++];v.isOutlineDataDriven=!!m[z++];v.bufferDataOffset=z;return v}B._inheritsLoose(c,l);var g=c.prototype;g.hasData=function(){return 0<this.fillIndexCount||0<this.outlineIndexCount};g.triangleCount=function(){return(this.fillIndexCount+
this.outlineIndexCount)/3};g.doDestroy=function(){u.isSome(this.fillVertexArrayObject)&&this.fillVertexArrayObject.dispose();u.isSome(this.fillVertexBuffer)&&this.fillVertexBuffer.dispose();u.isSome(this.fillIndexBuffer)&&this.fillIndexBuffer.dispose();this.fillIndexBuffer=this.fillVertexBuffer=this.fillVertexArrayObject=null;u.isSome(this.outlineVertexArrayObject)&&this.outlineVertexArrayObject.dispose();u.isSome(this.outlineVertexBuffer)&&this.outlineVertexBuffer.dispose();u.isSome(this.outlineIndexBuffer)&&
this.outlineIndexBuffer.dispose();this.outlineIndexBuffer=this.outlineVertexBuffer=this.outlineVertexArrayObject=null;this.memoryUsed=0};g.doPrepareForRendering=function(m,v,z,D){z=new Uint32Array(z);var E=new Int32Array(z.buffer),w=z[D++];this.fillVertexBuffer=k.createVertex(m,35044,new Int32Array(E.buffer,4*D,w));D+=w;w=z[D++];this.fillIndexBuffer=k.createIndex(m,35044,new Uint32Array(z.buffer,4*D,w));D+=w;w=z[D++];this.outlineVertexBuffer=k.createVertex(m,35044,new Int32Array(E.buffer,4*D,w));
D+=w;E=z[D++];this.outlineIndexBuffer=k.createIndex(m,35044,new Uint32Array(z.buffer,4*D,E));D+=E;this.fillVertexArrayObject=new p(m,v.getProgramAttributes(1),this.isFillDataDriven?c.fillVertexAttributesDD:c.fillVertexAttributes,{geometry:this.fillVertexBuffer},this.fillIndexBuffer);this.outlineVertexArrayObject=new p(m,v.getProgramAttributes(2),this.isOutlineDataDriven?c.outlineVertexAttributesDD:c.outlineVertexAttributes,{geometry:this.outlineVertexBuffer},this.outlineIndexBuffer)};return c}(A);
h.fillVertexAttributes={geometry:[{name:"a_pos",count:2,type:5122,offset:0,stride:4,normalized:!1,divisor:0}]};h.fillVertexAttributesDD={geometry:[{name:"a_pos",count:2,type:5122,offset:0,stride:8,normalized:!1,divisor:0},{name:"a_color",count:4,type:5121,offset:4,stride:8,normalized:!0,divisor:0}]};h.outlineVertexAttributes={geometry:[{name:"a_pos",count:2,type:5122,offset:0,stride:8,normalized:!1,divisor:0},{name:"a_offset",count:2,type:5120,offset:4,stride:8,normalized:!1,divisor:0},{name:"a_xnormal",
count:2,type:5120,offset:6,stride:8,normalized:!1,divisor:0}]};h.outlineVertexAttributesDD={geometry:[{name:"a_pos",count:2,type:5122,offset:0,stride:12,normalized:!1,divisor:0},{name:"a_offset",count:2,type:5120,offset:4,stride:12,normalized:!1,divisor:0},{name:"a_xnormal",count:2,type:5120,offset:6,stride:12,normalized:!1,divisor:0},{name:"a_color",count:4,type:5121,offset:8,stride:12,normalized:!0,divisor:0}]};e=function(l){function c(m,v){var z=l.call(this,m)||this;z.type=3;z.iconPerPageElementsMap=
new Map;z.glyphPerPageElementsMap=new Map;z.symbolInstances=[];z.isIconSDF=!1;z.opacityChanged=!1;z.lastOpacityUpdate=0;z.symbols=[];let D=z.bufferDataOffset;const E=new Uint32Array(m),w=new Int32Array(m);m=new Float32Array(m);z.isIconSDF=!!E[D++];z.isIconDataDriven=!!E[D++];z.isTextDataDriven=!!E[D++];var F=E[D++];for(var J=0;J<F;J++){var L=E[D++],I=E[D++],K=E[D++];z.iconPerPageElementsMap.set(L,[I,K])}F=E[D++];for(J=0;J<F;J++)L=E[D++],I=E[D++],K=E[D++],z.glyphPerPageElementsMap.set(L,[I,K]);F=E[D++];
J=E[D++];z.iconOpacity=new Int32Array(F);z.textOpacity=new Int32Array(J);D=q.deserializeSymbols(E,w,m,D,z.symbols,v);z.bufferDataOffset=D;return z}B._inheritsLoose(c,l);var g=c.prototype;g.hasData=function(){return 0<this.iconPerPageElementsMap.size||0<this.glyphPerPageElementsMap.size};g.triangleCount=function(){let m=0;this.iconPerPageElementsMap.forEach(v=>{m+=v[1]});this.glyphPerPageElementsMap.forEach(v=>{m+=v[1]});return m/3};g.doDestroy=function(){u.isSome(this.iconVertexArrayObject)&&this.iconVertexArrayObject.dispose();
u.isSome(this.iconVertexBuffer)&&this.iconVertexBuffer.dispose();u.isSome(this.iconOpacityBuffer)&&this.iconOpacityBuffer.dispose();u.isSome(this.iconIndexBuffer)&&this.iconIndexBuffer.dispose();this.iconIndexBuffer=this.iconOpacityBuffer=this.iconVertexBuffer=this.iconVertexArrayObject=null;u.isSome(this.textVertexArrayObject)&&this.textVertexArrayObject.dispose();u.isSome(this.textVertexBuffer)&&this.textVertexBuffer.dispose();u.isSome(this.textOpacityBuffer)&&this.textOpacityBuffer.dispose();u.isSome(this.textIndexBuffer)&&
this.textIndexBuffer.dispose();this.textIndexBuffer=this.textOpacityBuffer=this.textVertexBuffer=this.textVertexArrayObject=null;this.memoryUsed=0};g.updateOpacityInfo=function(){if(this.opacityChanged){this.opacityChanged=!1;var m=u.unwrap(this.iconOpacity),v=u.unwrap(this.iconOpacityBuffer);0<m.length&&m.byteLength===v.size&&v.setSubData(m);m=u.unwrap(this.textOpacity);v=u.unwrap(this.textOpacityBuffer);0<m.length&&m.byteLength===v.size&&v.setSubData(m)}};g.doPrepareForRendering=function(m,v,z,
D){z=new Uint32Array(z);var E=new Int32Array(z.buffer),w=z[D++];this.iconVertexBuffer=k.createVertex(m,35044,new Int32Array(E.buffer,4*D,w));D+=w;w=z[D++];this.iconIndexBuffer=k.createIndex(m,35044,new Uint32Array(z.buffer,4*D,w));D+=w;w=z[D++];this.textVertexBuffer=k.createVertex(m,35044,new Int32Array(E.buffer,4*D,w));D+=w;E=z[D++];this.textIndexBuffer=k.createIndex(m,35044,new Uint32Array(z.buffer,4*D,E));D+=E;this.iconOpacityBuffer=k.createVertex(m,35044,u.unwrap(this.iconOpacity).buffer);this.textOpacityBuffer=
k.createVertex(m,35044,u.unwrap(this.textOpacity).buffer);this.iconVertexArrayObject=new p(m,v.getProgramAttributes(4),this.isIconDataDriven?c.vertexAttributesDD:c.vertexAttributes,{geometry:this.iconVertexBuffer,opacity:this.iconOpacityBuffer},this.iconIndexBuffer);this.textVertexArrayObject=new p(m,v.getProgramAttributes(6),this.isTextDataDriven?c.vertexAttributesDD:c.vertexAttributes,{geometry:this.textVertexBuffer,opacity:this.textOpacityBuffer},this.textIndexBuffer)};return c}(A);e.vertexAttributes=
{geometry:[{name:"a_pos",count:2,type:5122,offset:0,stride:16,normalized:!1,divisor:0},{name:"a_vertexOffset",count:2,type:5122,offset:4,stride:16,normalized:!1,divisor:0},{name:"a_texAngleRange",count:4,type:5121,offset:8,stride:16,normalized:!1,divisor:0},{name:"a_levelInfo",count:4,type:5121,offset:12,stride:16,normalized:!1,divisor:0}],opacity:[{name:"a_opacityInfo",count:1,type:5121,offset:0,stride:1,normalized:!1,divisor:0}]};e.vertexAttributesDD={geometry:[{name:"a_pos",count:2,type:5122,offset:0,
stride:24,normalized:!1,divisor:0},{name:"a_vertexOffset",count:2,type:5122,offset:4,stride:24,normalized:!1,divisor:0},{name:"a_texAngleRange",count:4,type:5121,offset:8,stride:24,normalized:!1,divisor:0},{name:"a_levelInfo",count:4,type:5121,offset:12,stride:24,normalized:!1,divisor:0},{name:"a_color",count:4,type:5121,offset:16,stride:24,normalized:!0,divisor:0},{name:"a_size",count:1,type:5126,offset:20,stride:24,normalized:!1,divisor:0}],opacity:[{name:"a_opacityInfo",count:1,type:5121,offset:0,
stride:1,normalized:!1,divisor:0}]};b=function(l){function c(m){var v=l.call(this,m)||this;v.type=4;v.circleIndexStart=0;v.circleIndexCount=0;let z=v.bufferDataOffset;m=new Uint32Array(m);v.circleIndexStart=m[z++];v.circleIndexCount=m[z++];v.bufferDataOffset=z;return v}B._inheritsLoose(c,l);var g=c.prototype;g.hasData=function(){return 0<this.circleIndexCount};g.triangleCount=function(){return this.circleIndexCount/3};g.doDestroy=function(){u.isSome(this.circleVertexArrayObject)&&this.circleVertexArrayObject.dispose();
u.isSome(this.circleVertexBuffer)&&this.circleVertexBuffer.dispose();u.isSome(this.circleIndexBuffer)&&this.circleIndexBuffer.dispose();this.circleIndexBuffer=this.circleVertexBuffer=this.circleVertexArrayObject=null;this.memoryUsed=0};g.doPrepareForRendering=function(m,v,z,D){z=new Uint32Array(z);var E=new Int32Array(z.buffer);const w=z[D++];this.circleVertexBuffer=k.createVertex(m,35044,new Int32Array(E.buffer,4*D,w));D+=w;E=z[D++];this.circleIndexBuffer=k.createIndex(m,35044,new Uint32Array(z.buffer,
4*D,E));D+=E;this.circleVertexArrayObject=new p(m,v.getProgramAttributes(5),c.circleVertexAttributes,{geometry:this.circleVertexBuffer},this.circleIndexBuffer)};return c}(A);b.circleVertexAttributes={geometry:[{name:"a_pos",count:2,type:5122,offset:0,stride:16,normalized:!1,divisor:0},{name:"a_color",count:4,type:5121,offset:4,stride:16,normalized:!0,divisor:0},{name:"a_stroke_color",count:4,type:5121,offset:8,stride:16,normalized:!0,divisor:0},{name:"a_data",count:4,type:5121,offset:12,stride:16,
normalized:!1,divisor:0}]};y.CircleRenderBucket=b;y.FillRenderBucket=h;y.LineRenderBucket=f;y.RenderBucketBase=A;y.SymbolRenderBucket=e;Object.defineProperty(y,"__esModule",{value:!0})})},"esri/views/2d/engine/vectorTiles/decluttering/util":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../../../../../core/maybe","./core"],function(y,B,u,A){let k=function(e){this.tile=e;this.parent=null;this.children=new Set},f=function(){function e(){this.nodes=new Map;this.roots=
new Set}var b=e.prototype;b.create=function(d){const r=new k(d);let q;const l=[];this.nodes.forEach(c=>{this._canConnectDirectly(r,c)&&l.push(c);!q&&this._canConnectDirectly(c,r)&&(q=c)});if(q){for(const c of l)q.children.delete(c),r.children.add(c),c.parent=r;q.children.add(r);r.parent=q}else{this.roots.add(r);for(const c of l)r.children.add(c),c.parent=r,this.roots.delete(c)}this.nodes.set(d.key.id,r);return r};b.destroy=function(d){u.isSome(d.parent)?(d.parent.children.delete(d),d.children.forEach(r=>
{u.isSome(d.parent)&&d.parent.children.add(r)})):this.roots.delete(d);d.children.forEach(r=>{(r.parent=d.parent)||this.roots.add(r)});this.nodes.delete(d.tile.key.id)};b.clear=function(){this.roots.clear();this.nodes.clear()};b._canConnectDirectly=function(d,r){let {level:q,row:l,col:c}=r.tile.key;for({world:r}=r.tile.key;0<q;){q--;l>>=1;c>>=1;if(d.tile.key.level===q&&d.tile.key.row===l&&d.tile.key.col===c&&d.tile.key.world===r)return!0;if(this.nodes.has(`${q}/${l}/${c}/${r}`))break}return!1};return e}(),
p=function(){function e(){this._tileGraph=new f;this._tileArray=null}var b=e.prototype;b.has=function(d){return"string"===typeof d?this._tileGraph.nodes.has(d):this._tileGraph.nodes.has(d.key.id)};b.getAll=function(){this._tileArray||(this._tileArray=[],this._tileGraph.nodes.forEach(d=>{this._tileArray.push(d.tile)}));return this._tileArray};b.getRoots=function(){const d=[];this._tileGraph.roots.forEach(r=>{d.push(r.tile)});return d};b.getParent=function(d){d=this._tileGraph.nodes.get("string"===
typeof d?d:d.key.id);return u.isSome(d.parent)&&d.parent.tile};b.getChildren=function(d){const r=[];this._tileGraph.nodes.get("string"===typeof d?d:d.key.id).children.forEach(q=>{r.push(q.tile)});return r};b.get=function(d){return this._tileGraph.nodes.get(d).tile};b.removeKey=function(d){d=this._tileGraph.nodes.get(d);this._tileGraph.destroy(d);this._tileArray=null};b.forEach=function(d){this._tileGraph.nodes.forEach((r,q)=>d(r.tile,q))};b.add=function(d){this._tileGraph.create(d);this._tileArray=
null};b.remove=function(d){d=this._tileGraph.nodes.get(d.key.id);this._tileGraph.destroy(d);this._tileArray=null};b.clear=function(){this._tileGraph.clear();this._tileArray=[]};return e}(),h=function(){function e(d,r,q){this._rows=Math.ceil(r/q);this._columns=Math.ceil(d/q);this._cellSize=q;this.cells=Array(this._rows);for(d=0;d<this._rows;d++)for(this.cells[d]=Array(this._columns),r=0;r<this._columns;r++)this.cells[d][r]=[]}var b=e.prototype;b.getCell=function(d,r){r=Math.min(Math.max(Math.floor(r/
this._cellSize),0),this._rows-1);d=Math.min(Math.max(Math.floor(d/this._cellSize),0),this._columns-1);return this.cells[r]&&this.cells[r][d]||null};b.getCellSpan=function(d,r,q,l){return[Math.min(Math.max(Math.floor(d/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(r/this._cellSize),0),this.rows-1),Math.min(Math.max(Math.floor(q/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(l/this._cellSize),0),this.rows-1)]};B._createClass(e,[{key:"cellSize",get:function(){return this._cellSize}},
{key:"columns",get:function(){return this._columns}},{key:"rows",get:function(){return this._rows}}]);return e}();y.GridIndex=h;y.TileForest=p;y.TileGraph=f;y.TileNode=k;y.deserializeSymbols=function(e,b,d,r,q,l){const c=b[r++];for(let v=0;v<c;v++){const z=new A.VTLSymbol(l);z.xTile=b[r++];z.yTile=b[r++];z.hash=b[r++];z.priority=b[r++];var g=b[r++];for(var m=0;m<g;m++){const D=b[r++],E=b[r++],w=b[r++],F=b[r++],J=!!b[r++],L=b[r++],I=d[r++],K=d[r++],G=b[r++],M=b[r++];z.colliders.push({xTile:D,yTile:E,
dxPixels:w,dyPixels:F,hard:J,partIndex:L,width:G,height:M,minLod:I,maxLod:K})}g=e[r++];for(m=0;m<g;m++)z.textVertexRanges.push([e[r++],e[r++]]);g=e[r++];for(m=0;m<g;m++)z.iconVertexRanges.push([e[r++],e[r++]]);q.push(z)}return r};y.tileCoordChange=function(e,b,d,r,q,l){d-=q;if(0<=d)return(b>>d)+(r-(l<<d))*(e>>d);d=-d;return b-(l-(r<<d))*(e>>d)<<d};y.writeOpacityToBuffers=function(e,b,d){for(const [v,z]of e.symbols){{var r=e,q=b,l=d,c=z;const D=r.layerData.get(v);if(3===D.type){for(const E of c){c=
E.unique;var g=void 0;if(E.selectedForRendering){var m=c.parts[0];g=m.startOpacity;m=m.targetOpacity;r.allSymbolsFadingOut=r.allSymbolsFadingOut&&0===m;g=l?Math.floor(127*g)|m<<7:m?255:0;g|=g<<24|g<<16|g<<8}else g=0;for(const [w,F]of E.iconVertexRanges)for(m=w;m<w+F;m+=4)D.iconOpacity[m/4]=g;E.selectedForRendering?(g=c.parts[1],c=g.startOpacity,g=g.targetOpacity,r.allSymbolsFadingOut=r.allSymbolsFadingOut&&0===g,c=l?Math.floor(127*c)|g<<7:g?255:0,g=c<<24|c<<16|c<<8|c):g=0;for(const [w,F]of E.textVertexRanges)for(c=
w;c<w+F;c+=4)D.textOpacity[c/4]=g}D.lastOpacityUpdate=q;D.opacityChanged=!0}}}};Object.defineProperty(y,"__esModule",{value:!0})})},"esri/views/2d/engine/vectorTiles/decluttering/core":function(){define(["exports"],function(y){y.VTLSymbol=function(B){this.hash=this.yTile=this.xTile=0;this.priority=1;this.colliders=[];this.textVertexRanges=[];this.iconVertexRanges=[];this.tile=B};y.VTLUniqueSymbol=function(){this.tileSymbols=[];this.parts=[{startTime:0,startOpacity:0,targetOpacity:0,show:!1},{startTime:0,
startOpacity:0,targetOpacity:0,show:!1}];this.show=!1};Object.defineProperty(y,"__esModule",{value:!0})})},"esri/views/2d/layers/LayerView2D":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/has ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/property ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../core/urlUtils ../../../core/uuid ../../../portal/support/resourceExtension ../../../core/Collection ../../../core/collectionUtils ../../../core/watchUtils ../../layers/support/ClipArea ../../layers/support/ClipRect ../engine/Container ../../layers/support/Geometry ../../layers/support/Path".split(" "),
function(y,B,u,A,k,f,p,h,e,b,d,r,q,l,c,g,m,v,z,D){const E=q.ofType({key:"type",base:g,typeMap:{rect:m,path:D,geometry:z}});y.LayerView2DMixin=w=>{w=function(F){function J(){var I=F.apply(this,arguments)||this;I.clips=new E;I.moving=!1;I.attached=!1;I.lastUpdateId=-1;I.updateRequested=!1;return I}B._inheritsLoose(J,F);var L=J.prototype;L.initialize=function(){var I;this.container||(this.container=new v.Container);this.container.fadeTransitionEnabled=!0;this.container.opacity=0;this.container.clips=
this.clips;this.handles.add([c.init(this,"suspended",K=>{this.container&&(this.container.visible=!K);this.view&&!K&&this.updateRequested&&this.view.requestUpdate()},!0),c.init(this,["layer.opacity","container"],()=>{if(this.container){var K,G;this.container.opacity=null!=(K=null==(G=this.layer)?void 0:G.opacity)?K:1}},!0),c.init(this,["layer.blendMode"],K=>{this.container&&(this.container.blendMode=K)},!0),c.init(this,["layer.effect"],K=>{this.container&&(this.container.effect=K)},!0),this.clips.on("change",
()=>{this.container.clips=this.clips;this.notifyChange("clips")})]);null!=(I=this.view)&&I.whenLayerView?this.view.whenLayerView(this.layer).then(K=>{K!==this||this.attached||this.destroyed||(this.attach(),this.requestUpdate(),this.attached=!0)},()=>{}):this.when().then(()=>{this.attached||this.destroyed||(this.attach(),this.requestUpdate(),this.attached=!0)},()=>{})};L.destroy=function(){this.attached&&(this.detach(),this.attached=!1);this.handles.remove("initialize");this.updateRequested=!1};L.isVisibleAtScale=
function(I){var K=!0,G=this.layer;const M=G.minScale;G=G.maxScale;if(null!=M&&null!=G){K=!M;let Q=!G;!K&&I<=M&&(K=!0);!Q&&I>=G&&(Q=!0);K=K&&Q}return K};L.requestUpdate=function(){this.updateRequested||(this.updateRequested=!0,this.suspended||this.view.requestUpdate())};L.processUpdate=function(I){this.isFulfilled()&&!this.isResolved()?this.updateRequested=!1:(this._set("updateParameters",I),this.updateRequested&&!this.suspended&&(this.updateRequested=!1,this.update(I)))};L.isUpdating=function(){return!1};
L.isRendering=function(){return!1};L.canResume=function(){return F.prototype.canResume.call(this)?this.isVisibleAtScale(this.view.scale):!1};B._createClass(J,[{key:"updating",get:function(){return!this.attached||!this.suspended&&(this.updateRequested||this.isUpdating())}}]);return J}(w);u.__decorate([p.property({type:E,set(F){F=l.referenceSetter(F,this._get("clips"),E);this._set("clips",F)}})],w.prototype,"clips",void 0);u.__decorate([p.property()],w.prototype,"moving",void 0);u.__decorate([p.property()],
w.prototype,"attached",void 0);u.__decorate([p.property()],w.prototype,"container",void 0);u.__decorate([p.property({dependsOn:["view.scale","layer.minScale","layer.maxScale"]})],w.prototype,"suspended",void 0);u.__decorate([p.property({readOnly:!0})],w.prototype,"updateParameters",void 0);u.__decorate([p.property()],w.prototype,"updateRequested",void 0);u.__decorate([p.property({dependsOn:["attached","updateRequested","suspended"]})],w.prototype,"updating",null);u.__decorate([p.property()],w.prototype,
"view",void 0);return w=u.__decorate([e.subclass("esri.views.2d.layers.LayerView2D")],w)};Object.defineProperty(y,"__esModule",{value:!0})})},"esri/views/layers/support/ClipArea":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/has ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/property ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../core/urlUtils ../../../core/uuid ../../../portal/support/resourceExtension ../../../core/JSONSupport".split(" "),
function(y,B,u,A,k,f,p,h,e,b,d,r){u=function(q){function l(){return q.apply(this,arguments)||this}y._inheritsLoose(l,q);return l}(r.JSONSupport);return u=B.__decorate([h.subclass("esri.views.layers.support.ClipArea")],u)})},"esri/views/layers/support/ClipRect":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/has ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/property ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../core/urlUtils ../../../core/uuid ../../../portal/support/resourceExtension ./ClipArea".split(" "),
function(y,B,u,A,k,f,p,h,e,b,d,r){var q;u=q=function(l){function c(){var g=l.apply(this,arguments)||this;g.type="rect";g.left=null;g.right=null;g.top=null;g.bottom=null;return g}y._inheritsLoose(c,l);c.prototype.clone=function(){return new q({left:this.left,right:this.right,top:this.top,bottom:this.bottom})};y._createClass(c,[{key:"version",get:function(){return(this._get("version")||0)+1}}]);return c}(r);B.__decorate([f.property({type:[Number,String],json:{write:!0}})],u.prototype,"left",void 0);
B.__decorate([f.property({type:[Number,String],json:{write:!0}})],u.prototype,"right",void 0);B.__decorate([f.property({type:[Number,String],json:{write:!0}})],u.prototype,"top",void 0);B.__decorate([f.property({type:[Number,String],json:{write:!0}})],u.prototype,"bottom",void 0);B.__decorate([f.property({readOnly:!0,dependsOn:["left","right","top","bottom"]})],u.prototype,"version",null);return u=q=B.__decorate([h.subclass("esri.views.layers.support.ClipRect")],u)})},"esri/views/layers/support/Geometry":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/has ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/property ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../core/urlUtils ../../../core/uuid ../../../portal/support/resourceExtension ../../../geometry/Geometry ../../../geometry/Extent ../../../geometry/Polygon ../../../geometry/support/jsonUtils ../../../geometry ./ClipArea".split(" "),
function(y,B,u,A,k,f,p,h,e,b,d,r,q,l,c,g,m){var v;u={base:r,key:"type",typeMap:{extent:q,polygon:l}};m=v=function(z){function D(){var E=z.apply(this,arguments)||this;E.type="geometry";E.geometry=null;return E}y._inheritsLoose(D,z);D.prototype.clone=function(){return new v({geometry:this.geometry.clone()})};y._createClass(D,[{key:"version",get:function(){return(this._get("version")||0)+1}}]);return D}(m);B.__decorate([f.property({types:u,json:{read:c.fromJSON,write:!0}})],m.prototype,"geometry",void 0);
B.__decorate([f.property({readOnly:!0,dependsOn:["geometry"]})],m.prototype,"version",null);return m=v=B.__decorate([h.subclass("esri.views.layers.support.Geometry")],m)})},"esri/views/layers/support/Path":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/has ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/property ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../core/urlUtils ../../../core/uuid ../../../portal/support/resourceExtension ./ClipArea".split(" "),
function(y,B,u,A,k,f,p,h,e,b,d,r){u=function(q){function l(){var c=q.apply(this,arguments)||this;c.type="path";c.path=[];return c}y._inheritsLoose(l,q);y._createClass(l,[{key:"version",get:function(){return(this._get("version")||0)+1}}]);return l}(r);B.__decorate([f.property({type:[[[Number]]],json:{write:!0}})],u.prototype,"path",void 0);B.__decorate([f.property({readOnly:!0,dependsOn:["path"]})],u.prototype,"version",null);return u=B.__decorate([h.subclass("esri.views.layers.support.Path")],u)})},
"esri/views/2d/engine/vectorTiles/TileHandler":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/has ../../../../core/maybe ../../../../core/promiseUtils ../../../../request ../../../../core/MemCache ../../../../core/ItemCache ../../../../geometry/support/aaBoundingRect ../../../../core/workers/workers ../../tiling/TileKey ./TileIndex ./VectorTile ./GlyphMosaic ./GlyphSource ./SpriteMosaic ./decluttering/debugging".split(" "),function(y,B,u,A,k,f,p,h,e,b,d,r,
q,l,c,g,m){const v=new h(10),z=new Map;h=function(){function D(w,F,J,L){this._vectorTileLayer=w;this._styleRepository=F;this.devicePixelRatio=J;this._memCache=L;this._connection=this._glyphMosaic=this._spriteMosaic=null;this._ongoingTileRequests=new Map;this._ongoingRequestToController=new Map}var E=D.prototype;E.destroy=function(){this._ongoingTileRequests&&this.abortAll();this._connection&&(this._connection.close(),this._connection=null);this._vectorTileLayer=this._styleRepository=null;this._spriteMosaic&&
(this._spriteMosaic=null);this._glyphMosaic&&(this._glyphMosaic=null)};E.start=async function(w){const F=this._vectorTileLayer;var J=F.sourceNameToSource;const L=[];for(const I in J)L.push(this._fetchTileMap(J[I],w));this._spriteSourcePromise=this._vectorTileLayer.loadSpriteSource(this.devicePixelRatio,w);this._spriteSourcePromise.then(I=>{this._spriteMosaic=new g(1024,1024,250);this._spriteMosaic.setSpriteSource(I)});J=new c(this._styleRepository.glyphs);this._glyphMosaic=new l(1024,1024,J);this._broadcastPromise=
b.open("WorkerTileHandler",{client:this,scheduler:w.scheduler,signal:w.signal}).then(I=>{this._connection=I;return k.all(this._connection.broadcast("setStyle",{style:F.currentStyleInfo.style,vectorTileLayerMaxBuffers:u("vectortilelayer-max-buffers")},w))});return k.all(L)};E.updateStyle=async function(w){await this._broadcastPromise;return this._broadcastPromise=k.create((F,J)=>{k.all(this._connection.broadcast("updateStyle",w)).then(F,J)})};E.setStyle=async function(w,F){await this._broadcastPromise;
this._styleRepository=w;const J=this._vectorTileLayer.sourceNameToSource,L=[];for(const I in J)L.push(this._fetchTileMap(J[I],null));this._spriteSourcePromise=this._vectorTileLayer.loadSpriteSource(this.devicePixelRatio,null);this._spriteSourcePromise.then(I=>{this._spriteMosaic=new g(1024,1024,250);this._spriteMosaic.setSpriteSource(I)});w=new c(w.glyphs);this._glyphMosaic=new l(1024,1024,w);this._broadcastPromise=k.create((I,K)=>{k.all(this._connection.broadcast("setStyle",{style:F,vectorTileLayerMaxBuffers:u("vectortilelayer-max-buffers")})).then(I,
K)});L.push(this._broadcastPromise);return k.all(L)};E.getVectorTile=function(w,F,J,L){const I=new d(w,F,J,0);return A.isSome(this._memCache)&&(w=this._memCache.get(I.id),A.isSome(w))?(w.reference(),k.resolve(w)):this._getVectorTileData(I).then(K=>{k.throwIfAborted(L);if(A.isSome(this._memCache)){var G=this._memCache.get(I.id);if(A.isSome(G))return G.reference(),G}if(!this._vectorTileLayer)return null;G=this._vectorTileLayer.tileInfo.getTileBounds(e.create(),I);G=new q.VectorTile(I,this._styleRepository,
G,[512,512]);K&&K.tileData?(G.setData(K.tileData),A.isSome(this._memCache)&&(G.reference(),K=G.getMemoryUsage(),0<K&&this._memCache.put(G.key.id,G,K*G.referenced,p.MIN_PRIORITY))):G.setData(null);return G})};E.releaseVectorTile=function(w){A.isNone(this._memCache)||w.release()||this._memCache.updateSize(w.key.id,w,w.getMemoryUsage()*w.referenced)};E.fetchTileData=function(w,F){return this._getRefKeys(w,F).then(J=>{const L=this._vectorTileLayer.sourceNameToSource,I=[];for(const K in L)I.push(K);return this._getSourcesData(I,
J,F)})};E.parseTileData=function(w,F){const J=w&&w.data;if(!J)return k.resolve(null);const {sourceName2DataAndRefKey:L,transferList:I}=J;return 0===Object.keys(L).length?k.resolve(null):this._broadcastPromise.then(()=>this._connection.getAvailableClient().then(K=>K.invoke("createTileAndParse",{key:w.key.id,sourceName2DataAndRefKey:L,styleLayerUIDs:w.styleLayerUIDs},{...F,transferList:I}).then(G=>{if(u("esri-vector-tiles-debug")){const M={};for(const Q in L)M[Q]=L[Q].refKey;return{tileData:G,refKeys:M}}return{tileData:G}})))};
E.abortAll=function(){this._ongoingRequestToController.forEach(w=>w.abort());this._ongoingRequestToController.clear();this._ongoingTileRequests.clear()};E.getSprites=async function(w){await this._spriteSourcePromise;return this._spriteMosaic.getSpriteItems(w)};E.getGlyphs=function(w){return this._glyphMosaic.getGlyphItems(w.font,w.codePoints)};E.perfReport=function({key:w,milliseconds:F}){m.perfAdd(w,F,"ms")};E._getTilePayload=async function(w,F,J){w=d.pool.acquire(w.id);const L=this._vectorTileLayer.sourceNameToSource[F].getSourceTileUrl(w.level,
w.row,w.col);d.pool.release(w);try{return{protobuff:(await f(L,{responseType:"array-buffer",...J})).data,sourceName:F}}catch(I){if(k.isAbortError(I))throw I;return{protobuff:null,sourceName:F}}};E._fetchTileMap=async function(w,F){if(w.capabilities.operations.supportsTileMap&&w.tileIndex)return k.resolve();if(w.tileMapURL){var J=v.get(w.tileMapURL);if(J)w.tileIndex=J;else if(z.has(w.tileMapURL))try{var L=await z.get(w.tileMapURL);w.tileIndex=new r(L.data)}catch(I){if(k.isAbortError(I))throw I;}else{F=
f(w.tileMapURL,F);z.set(w.tileMapURL,F);try{L=await F,z.delete(w.tileMapURL),v.put(w.tileMapURL,w.tileIndex),w.tileIndex=new r(L.data)}catch(I){if(z.delete(w.tileMapURL),k.isAbortError(I))throw I;}}}};E._getRefKeys=function(w,F){const J=this._vectorTileLayer.sourceNameToSource,L=[];for(const I in J){const K=J[I].getRefKey(w,F);L.push(K)}return k.eachAlways(L)};E._getSourcesData=function(w,F,J){const L=[];for(let I=0;I<F.length;I++)if(null==F[I].value||null==w[I])L.push(null);else{const K=this._getTilePayload(F[I].value,
w[I],J);L.push(K)}return k.eachAlways(L).then(I=>{const K={},G=[];for(let M=0;M<I.length;M++)I[M].value&&I[M].value&&I[M].value.protobuff&&0<I[M].value.protobuff.byteLength&&(K[I[M].value.sourceName]={refKey:F[M].value.id,protobuff:I[M].value.protobuff},G.push(I[M].value.protobuff));return{sourceName2DataAndRefKey:K,transferList:G}})};E._getVectorTileData=function(w){const F=w.id;if(this._ongoingTileRequests.has(F))return this._ongoingTileRequests.get(F);const J=new AbortController;w=this._getParsedVectorTileData(w,
{signal:J.signal}).then(L=>{this._ongoingTileRequests.delete(F);this._ongoingRequestToController.delete(F);return L}).catch(()=>{this._ongoingTileRequests.delete(F);this._ongoingRequestToController.delete(F);return null});this._ongoingTileRequests.set(F,w);this._ongoingRequestToController.set(F,J);return w};E._getParsedVectorTileData=function(w,F){return this.fetchTileData(w,F).then(J=>this.parseTileData({key:w,data:J},F))};B._createClass(D,[{key:"spriteMosaic",get:function(){return this._spriteSourcePromise.then(()=>
this._spriteMosaic)}},{key:"glyphMosaic",get:function(){return this._glyphMosaic}},{key:"updating",get:function(){return 0<this._ongoingTileRequests.size}}]);return D}();y.TileHandler=h;Object.defineProperty(y,"__esModule",{value:!0})})},"esri/core/ItemCache":function(){define(["./MemCache"],function(y){return function(){function B(A,k){this._storage=new y.MemCacheStorage;this._storage.maxSize=A;k&&this._storage.registerRemoveFunc("",k)}var u=B.prototype;u.put=function(A,k){this._storage.put(A,k,
1,1)};u.pop=function(A){return this._storage.pop(A)};u.get=function(A){return this._storage.get(A)};u.clear=function(){this._storage.clearAll()};u.destroy=function(){this._storage.clearAll()};return B}()})},"esri/views/2d/engine/vectorTiles/TileIndex":function(){define(["../../../../core/promiseUtils","../../../../layers/support/TilemapCache","../../tiling/TileKey"],function(y,B,u){return function(){function A(f){if(f instanceof B.TilemapCache)this._tilemapCache=f;else if(f&&"index"in f)this._tilemap=
f.index;else throw Error("Invalid tilemap!");}var k=A.prototype;k.dataKey=function(f,p){if(this._tilemapCache){const {level:h,row:e,col:b}=f,d=new u(f);return this._tilemapCache.fetchAvailabilityUpsample(h,e,b,d,p).then(()=>{d.world=f.world;return d}).catch(r=>{if(y.isAbortError(r))throw r;return null})}return this._getIndexedDataKey(f)};k.forEach=function(f,p,h,e,b){this._callback=b;this._maxLevel=p+f;this._forEach(this._tilemap,p,h,e)};k._forEach=function(f,p,h,e){0!==f&&(this._callback(p,h,e),
p!==this._maxLevel&&"object"===typeof f&&(this._forEach(f[0],p+1,2*h,2*e),this._forEach(f[1],p+1,2*h,2*e+1),this._forEach(f[2],p+1,2*h+1,2*e),this._forEach(f[3],p+1,2*h+1,2*e+1)))};k._getIndexedDataKey=function(f){const p=[f];if(0>f.level||0>f.row||0>f.col||0<f.row>>f.level||0<f.col>>f.level)return y.resolve(null);for(;0!==f.level;)f=new u(f.level-1,f.row>>1,f.col>>1,f.world),p.push(f);f=this._tilemap;let h=p.pop(),e,b;if(1===f)return y.resolve(h);for(;p.length;)if(e=p.pop(),b=(e.col&1)+((e.row&1)<<
1),f){if(0===f[b]){h=null;break}if(1===f[b]){h=e;break}h=e;f=f[b]}return y.resolve(h)};return A}()})},"esri/layers/support/TilemapCache":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/has ../../core/Logger ../../core/accessorSupport/decorators/property ../../core/accessorSupport/decorators/cast ../../core/jsonMap ../../core/accessorSupport/decorators/subclass ../../core/Error ../../core/urlUtils ../../core/uuid ../../portal/support/resourceExtension ../../core/PooledArray ../../core/promiseUtils ../../core/scheduling ../../core/Accessor ../../request ../../core/Handles ../../core/LRUCache ../../core/watchUtils ./Tilemap".split(" "),
function(y,B,u,A,k,f,p,h,e,b,d,r,q,l,c,g,m,v,z,D,E,w){var F;const J=k.getLogger("esri.layers.support.TilemapCache");y.TilemapCache=F=function(L){function I(G){G=L.call(this,G)||this;G._handles=new z;G._pendingTilemapRequests={};G._availableLevels={};G.levels=5;G.cacheByteSize=2097152;G.request=v;G._prefetchingEnabled=!0;return G}B._inheritsLoose(I,L);var K=I.prototype;K.initialize=function(){this._tilemapCache=new D(this.cacheByteSize);this._handles.add([this.watch(["layer.parsedUrl","layer.tileServers?"],
()=>this._initializeTilemapDefinition()),E.init(this,"layer.tileInfo.lods",G=>this._initializeAvailableLevels(G),!0)]);this._initializeTilemapDefinition()};K.destroy=function(){this._handles&&(this._handles.destroy(),this._handles=null)};K.castLevels=function(G){return 2>=G?(J.error("Minimum levels for Tilemap is 3, but got ",G),3):G};K.fetchTilemap=function(G,M,Q,R){if(!this._availableLevels[G])return c.reject(new b("tilemap-cache:level-unavailable",`Level ${G} is unavailable in the service`));const O=
this._tmpTilemapDefinition;if(G=this._tilemapFromCache(G,M,Q,O))return c.resolve(G);const C=R&&R.signal;R={...R,signal:null};return c.create((N,P)=>{c.onAbort(C,()=>P(c.createAbortError()));const T=w.tilemapDefinitionId(O);let Y=this._pendingTilemapRequests[T];if(!Y){Y=w.Tilemap.fromDefinition(O,R).then(U=>{this._tilemapCache.put(T,U,U.byteSize);return U});const aa=()=>delete this._pendingTilemapRequests[T];this._pendingTilemapRequests[T]=Y;Y.then(aa,aa)}Y.then(N,P)})};K.getAvailability=function(G,
M,Q){return this._availableLevels[G]?(G=this._tilemapFromCache(G,M,Q,this._tmpTilemapDefinition))?G.getAvailability(M,Q):"unknown":"unavailable"};K.getAvailabilityUpsample=function(G,M,Q,R){R.level=G;R.row=M;R.col=Q;G=this.layer.tileInfo;for(G.updateTileInfo(R);;)if(M=this.getAvailability(R.level,R.row,R.col),"unavailable"===M){if(!G.upsampleTile(R))return"unavailable"}else return M};K.fetchAvailability=function(G,M,Q,R){return this._availableLevels[G]?this.fetchTilemap(G,M,Q,R).catch(O=>O).then(O=>
{if(O instanceof w.Tilemap)return O=O.getAvailability(M,Q),"unavailable"===O?c.reject(new b("tile-map:tile-unavailable","Tile is not available",{level:G,row:M,col:Q})):O;if(c.isAbortError(O))throw O;return"unknown"}):c.reject(new b("tilemap-cache:level-unavailable",`Level ${G} is unavailable in the service`))};K.fetchAvailabilityUpsample=function(G,M,Q,R,O){R.level=G;R.row=M;R.col=Q;const C=this.layer.tileInfo;C.updateTileInfo(R);const N=this.fetchAvailability(G,M,Q,O).catch(P=>{if(c.isAbortError(P))throw P;
if(C.upsampleTile(R))return this.fetchAvailabilityUpsample(R.level,R.row,R.col,R);throw P;});this._fetchAvailabilityUpsamplePrefetch(R.id,G,M,Q,O,N);return N};K._fetchAvailabilityUpsamplePrefetch=async function(G,M,Q,R,O,C){if(this._prefetchingEnabled){var N=`prefetch-${G}`;if(!this._handles.has(N)){var P=c.createAbortController();C.then(()=>P.abort(),()=>P.abort());var T=!1;this._handles.add({remove(){T||(T=!0,P.abort())}},N);await g.waitTicks(10,P.signal).catch(()=>{});T||(T=!0,this._handles.remove(N));
if(!c.isAborted(P))for(G={id:G,level:M,row:Q,col:R},O={...O,signal:P.signal},M=this.layer.tileInfo,Q=0;F._prefetches.length<F._maxPrefetch&&M.upsampleTile(G);++Q){const Y=this.fetchAvailability(G.level,G.row,G.col,O);F._prefetches.push(Y);R=()=>{F._prefetches.removeUnordered(Y)};Y.then(R,R)}}}};K._initializeTilemapDefinition=function(){if(this.layer.parsedUrl){var G=this.layer.parsedUrl,M=G.query;this._tilemapCache.clear();this._tmpTilemapDefinition={service:{url:G.path,query:M?d.objectToQuery(M):
null,tileServers:this.layer.tileServers,request:this.request,type:this.layer.type},width:this.size,height:this.size,level:0,row:0,col:0}}};K._tilemapFromCache=function(G,M,Q,R){R.level=G;R.row=M-M%this.size;R.col=Q-Q%this.size;G=w.tilemapDefinitionId(R);return this._tilemapCache.get(G)};K._initializeAvailableLevels=function(G){this._availableLevels={};G&&G.forEach(M=>this._availableLevels[M.level]=!0)};B._createClass(I,[{key:"size",get:function(){return 1<<this.levels}},{key:"test",get:function(){const G=
this;return{get prefetchingEnabled(){return G._prefetchingEnabled},set prefetchingEnabled(M){G._prefetchingEnabled=M},hasTilemap(M,Q,R){return!!G._tilemapFromCache(M,Q,R,G._tmpTilemapDefinition)}}}}]);return I}(m);y.TilemapCache._maxPrefetch=4;y.TilemapCache._prefetches=new l({initialSize:F._maxPrefetch});u.__decorate([f.property({constructOnly:!0,type:Number})],y.TilemapCache.prototype,"levels",void 0);u.__decorate([p.cast("levels")],y.TilemapCache.prototype,"castLevels",null);u.__decorate([f.property({readOnly:!0,
dependsOn:["levels"],type:Number})],y.TilemapCache.prototype,"size",null);u.__decorate([f.property({constructOnly:!0,type:Number})],y.TilemapCache.prototype,"cacheByteSize",void 0);u.__decorate([f.property({constructOnly:!0})],y.TilemapCache.prototype,"layer",void 0);u.__decorate([f.property({constructOnly:!0})],y.TilemapCache.prototype,"request",void 0);y.TilemapCache=F=u.__decorate([e.subclass("esri.layers.support.TilemapCache")],y.TilemapCache);Object.defineProperty(y,"__esModule",{value:!0})})},
"esri/layers/support/Tilemap":function(){define(["exports","../../core/lang","../../core/Error","../../core/arrayUtils","../../request"],function(y,B,u,A,k){function f(h){if("vector-tile"===h.service.type)var e=`${h.service.url}/tilemap/${h.level}/${h.row}/${h.col}/${h.width}/${h.height}`;else e=h.service.tileServers,e=`${e&&e.length?e[h.row%e.length]:h.service.url}/tilemap/${h.level}/${h.row}/${h.col}/${h.width}/${h.height}`;(h=h.service.query)&&(e=`${e}?${h}`);return e}let p=function(){function h(){this.location=
{left:0,top:0,width:0,height:0};this._allAvailability="unknown";this.byteSize=40}var e=h.prototype;e.getAvailability=function(b,d){if("unknown"!==this._allAvailability)return this._allAvailability;b=(b-this.location.top)*this.location.width+(d-this.location.left);d=b>>3;const r=this._tileAvailabilityBitSet;return 0>d||d>r.length?"unknown":r[d]&1<<b%8?"available":"unavailable"};e._updateFromData=function(b){let d=!0,r=!0;const q=new Uint8Array(Math.ceil(this.location.width*this.location.height/8));
let l=0;for(let c=0;c<b.length;c++){const g=c%8;b[c]?(r=!1,q[l]|=1<<g):d=!1;7===g&&++l}r?this._allAvailability="unavailable":d?this._allAvailability="available":(this._allAvailability="unknown",this._tileAvailabilityBitSet=q,this.byteSize+=q.length)};h.fromDefinition=function(b,d){const r=b.service.request||k,{row:q,col:l,width:c,height:g}=b,m={query:{f:"json"}};d=d?{...m,...d}:m;return r(f(b),d).then(v=>v.data).catch(v=>{if(v&&v.details&&422===v.details.httpStatus)return{location:{top:q,left:l,width:c,
height:g},valid:!0,data:A.constant(c*g,0)};throw v;}).then(v=>{if(v.location&&(v.location.top!==q||v.location.left!==l||v.location.width!==c||v.location.height!==g))throw new u("tilemap:location-mismatch","Tilemap response for different location than requested",{response:v,definition:{top:q,left:l,width:c,height:g}});return h.fromJSON(v)})};h.fromJSON=function(b){h.validateJSON(b);const d=new h;d.location=Object.freeze(B.clone(b.location));d._updateFromData(b.data);return Object.freeze(d)};h.validateJSON=
function(b){if(!b||!b.location)throw new u("tilemap:missing-location","Location missing from tilemap response");if(!1===b.valid)throw new u("tilemap:invalid","Tilemap response was marked as invalid");if(!b.data)throw new u("tilemap:missing-data","Data missing from tilemap response");if(!Array.isArray(b.data))throw new u("tilemap:data-mismatch","Data must be an array of numbers");if(b.data.length!==b.location.width*b.location.height)throw new u("tilemap:data-mismatch","Number of data items does not match width/height of tilemap");
};return h}();y.Tilemap=p;y.default=p;y.tilemapDefinitionId=function(h){return`${h.level}/${h.row}/${h.col}/${h.width}/${h.height}`};y.tilemapDefinitionUrl=f;Object.defineProperty(y,"__esModule",{value:!0})})},"esri/views/2d/engine/vectorTiles/GlyphMosaic":function(){define("../../../../core/has ../../../../core/promiseUtils ../../../webgl/Program ../../../webgl/BufferObject ../../../webgl/Texture ../../../webgl/VertexArrayObject ../../../webgl/Renderbuffer ../../../webgl/FramebufferObject ../../../webgl/ProgramCache ../../../webgl/RenderingContext ../../../webgl/ShaderCompiler ../webgl/Rect ./RectangleBinPack".split(" "),
function(y,B,u,A,k,f,p,h,e,b,d,r,q){return function(){function l(g,m,v){this.height=this.width=0;this._dirties=[];this._glyphData=[];this._currentPage=0;this._glyphIndex={};this._textures=[];this._rangePromises=new Map;this.width=g;this.height=m;this._glyphSource=v;this._binPack=new q(g-4,m-4);this._glyphData.push(new Uint8Array(g*m));this._dirties.push(!0);this._textures.push(void 0)}var c=l.prototype;c.getGlyphItems=function(g,m){const v=[],z=this._glyphSource,D=new Set,E=1/256;for(const F of m)D.add(Math.floor(F*
E));const w=[];D.forEach(F=>{if(256>=F){const J=g+F;this._rangePromises.has(J)?w.push(this._rangePromises.get(J)):(F=z.getRange(g,F).then(()=>{this._rangePromises["delete"](J)},()=>{this._rangePromises["delete"](J)}),this._rangePromises.set(J,F),w.push(F))}});return B.all(w).then(()=>{let F=this._glyphIndex[g];F||(F={},this._glyphIndex[g]=F);for(const G of m){var J=F[G];if(J){v[G]={sdf:!0,rect:J.rect,metrics:J.metrics,page:J.page,code:G};continue}var L=z.getGlyph(g,G);if(!L||!L.metrics)continue;J=
L.metrics;let M;if(0===J.width)M=new r(0,0,0,0);else{const Q=J.width+6,R=J.height+6;var I=Q%4?4-Q%4:4,K=R%4?4-R%4:4;1===I&&(I=5);1===K&&(K=5);M=this._binPack.allocate(Q+I,R+K);M.isEmpty&&(this._dirties[this._currentPage]||(this._glyphData[this._currentPage]=null),this._currentPage=this._glyphData.length,this._glyphData.push(new Uint8Array(this.width*this.height)),this._dirties.push(!0),this._textures.push(void 0),this._binPack=new q(this.width-4,this.height-4),M=this._binPack.allocate(Q+I,R+K));I=
this._glyphData[this._currentPage];L=L.bitmap;let O;if(L)for(let C=0;C<R;C++){K=Q*C;O=this.width*(M.y+C+1)+M.x;for(let N=0;N<Q;N++)I[O+N+1]=L[K+N]}}F[G]={rect:M,metrics:J,tileIDs:null,page:this._currentPage};v[G]={sdf:!0,rect:M,metrics:J,page:this._currentPage,code:G};this._dirties[this._currentPage]=!0}return v})};c.removeGlyphs=function(g){for(const m in this._glyphIndex){const v=this._glyphIndex[m];if(!v)continue;let z;for(const D in v)if(z=v[D],z.tileIDs["delete"](g),0===z.tileIDs.size){const E=
this._glyphData[z.page],w=z.rect;let F,J;for(let L=0;L<w.height;L++)for(F=this.width*(w.y+L)+w.x,J=0;J<w.width;J++)E[F+J]=0;delete v[D];this._dirties[z.page]=!0}}};c.bind=function(g,m,v,z=0){this._textures[v]||(this._textures[v]=new k(g,{pixelFormat:6406,dataType:5121,width:this.width,height:this.height},new Uint8Array(this.width*this.height)));const D=this._textures[v];D.setSamplingMode(m);this._dirties[v]&&D.setData(this._glyphData[v]);g.bindTexture(D,z);this._dirties[v]=!1};c.dispose=function(){this._binPack=
null;for(const g of this._textures)g&&g.dispose();this._textures.length=0};return l}()})},"esri/views/2d/engine/vectorTiles/RectangleBinPack":function(){define(["../../../../chunks/_rollupPluginBabelHelpers","../webgl/Rect"],function(y,B){return function(){function u(k,f){this._height=this._width=0;this._free=[];this._width=k;this._height=f;this._free.push(new B(0,0,k,f))}var A=u.prototype;A.allocate=function(k,f){if(k>this._width||f>this._height)return new B;let p=null,h=-1;for(let e=0;e<this._free.length;++e){const b=
this._free[e];k<=b.width&&f<=b.height&&(null===p||b.y<=p.y&&b.x<=p.x)&&(p=b,h=e)}if(null===p)return new B;this._free.splice(h,1);p.width<p.height?(p.width>k&&this._free.push(new B(p.x+k,p.y,p.width-k,f)),p.height>f&&this._free.push(new B(p.x,p.y+f,p.width,p.height-f))):(p.width>k&&this._free.push(new B(p.x+k,p.y,p.width-k,p.height)),p.height>f&&this._free.push(new B(p.x,p.y+f,k,p.height-f)));return new B(p.x,p.y,k,f)};A.release=function(k){for(let f=0;f<this._free.length;++f){const p=this._free[f];
if(p.y===k.y&&p.height===k.height&&p.x+p.width===k.x)p.width+=k.width;else if(p.x===k.x&&p.width===k.width&&p.y+p.height===k.y)p.height+=k.height;else if(k.y===p.y&&k.height===p.height&&k.x+k.width===p.x)p.x=k.x,p.width+=k.width;else if(k.x===p.x&&k.width===p.width&&k.y+k.height===p.y)p.y=k.y,p.height+=k.height;else continue;this._free.splice(f,1);this.release(k)}this._free.push(k)};y._createClass(u,[{key:"width",get:function(){return this._width}},{key:"height",get:function(){return this._height}}]);
return u}()})},"esri/views/2d/engine/vectorTiles/GlyphSource":function(){define(["../../../../core/has","../../../../core/promiseUtils","../../../../request","../../../../core/pbf"],function(y,B,u,A){let k=function(){function p(e){this._metrics=[];this._bitmaps=[];if(e)for(;e.next();)switch(e.tag()){case 1:{const b=e.getMessage();for(;b.next();)switch(b.tag()){case 3:{const d=b.getMessage();let r,q,l,c,g,m,v;for(;d.next();)switch(d.tag()){case 1:r=d.getUInt32();break;case 2:q=d.getBytes();break;case 3:l=
d.getUInt32();break;case 4:c=d.getUInt32();break;case 5:g=d.getSInt32();break;case 6:m=d.getSInt32();break;case 7:v=d.getUInt32();break;default:d.skip()}d.release();r&&(this._metrics[r]={width:l,height:c,left:g,top:m,advance:v},this._bitmaps[r]=q);break}default:b.skip()}b.release();break}default:e.skip()}}var h=p.prototype;h.getMetrics=function(e){return this._metrics[e]};h.getBitmap=function(e){return this._bitmaps[e]};return p}(),f=function(){function p(){this._ranges=[]}var h=p.prototype;h.getRange=
function(e){return this._ranges[e]};h.addRange=function(e,b){this._ranges[e]=b};return p}();return function(){function p(e){this._glyphInfo={};this._baseURL=e}var h=p.prototype;h.getRange=function(e,b){const d=this._getFontStack(e);if(d.getRange(b))return B.resolve();const r=256*b,q=r+255;e=this._baseURL.replace("{fontstack}",e).replace("{range}",r+"-"+q);return u(e,{responseType:"array-buffer"}).then(l=>{d.addRange(b,new k(new A(new Uint8Array(l.data),new DataView(l.data))))}).catch(()=>{d.addRange(b,
new k)})};h.getGlyph=function(e,b){if(e=this._getFontStack(e)){var d=Math.floor(b/256);if(!(256<d)&&(e=e.getRange(d)))return{metrics:e.getMetrics(b),bitmap:e.getBitmap(b)}}};h._getFontStack=function(e){let b=this._glyphInfo[e];b||(b=this._glyphInfo[e]=new f);return b};return p}()})},"esri/views/2d/engine/vectorTiles/SpriteMosaic":function(){define("../../../webgl/Program ../../../webgl/BufferObject ../../../webgl/Texture ../../../webgl/VertexArrayObject ../../../webgl/Renderbuffer ../../../webgl/FramebufferObject ../../../webgl/ProgramCache ../../../webgl/RenderingContext ../../../webgl/ShaderCompiler ../webgl/Rect ./RectangleBinPack".split(" "),
function(y,B,u,A,k,f,p,h,e,b,d){return function(){function r(l,c,g=0){this._size=[];this._mosaicsData=[];this._textures=[];this._dirties=[];this._pageHeight=this._pageWidth=this._currentPage=this._maxItemSize=0;this._mosaicRects={};this.pixelRatio=1;(0>=l||0>=c)&&console.error("Sprites mosaic defaultWidth and defaultHeight must be greater than zero!");this._pageWidth=l;this._pageHeight=c;0<g&&(this._maxItemSize=g);this._binPack=new d(l-4,c-4)}var q=r.prototype;q.getWidth=function(l){return l>=this._size.length?
-1:this._size[l][0]};q.getHeight=function(l){return l>=this._size.length?-1:this._size[l][1]};q.setSpriteSource=function(l){this.dispose();this.pixelRatio=l.devicePixelRatio;if(0===this._mosaicsData.length){this._binPack=new d(this._pageWidth-4,this._pageHeight-4);const c=new Uint32Array(Math.floor(this._pageWidth)*Math.floor(this._pageHeight));this._mosaicsData[0]=c;this._dirties.push(!0);this._size.push([this._pageWidth,this._pageHeight]);this._textures.push(void 0)}this._sprites=l};q.getSpriteItem=
function(l,c=!1){var g=this._mosaicRects[l];if(g)return g;if(!this._sprites||"loaded"!==this._sprites.loadStatus)return null;g=this._sprites.getSpriteInfo(l);if(!g||!g.width||!g.height||0>g.width||0>g.height)return null;const m=g.width,v=g.height,[z,D,E]=this._allocateImage(m,v);if(0>=z.width)return null;this._copy(z,g,D,E,c);g={rect:z,width:m,height:v,sdf:g.sdf,simplePattern:!1,pixelRatio:g.pixelRatio,page:D};return this._mosaicRects[l]=g};q.preloadSpriteItems=function(){for(const l of this._sprites.spriteNames)this.getSpriteItem(l,
!0)};q.getSpriteItems=function(l){const c={};for(const g of l)c[g]=this.getSpriteItem(g);return c};q.getMosaicItemPosition=function(l,c){c=(l=this.getSpriteItem(l,c))&&l.rect;if(!c)return null;c.width=l.width;c.height=l.height;const g=this._size[l.page];return{size:[l.width,l.height],tl:[(c.x+2)/g[0],(c.y+2)/g[1]],br:[(c.x+2+l.width)/g[0],(c.y+2+l.height)/g[1]],page:l.page}};q.bind=function(l,c,g=0,m=0){this._textures[g]||(this._textures[g]=new u(l,{pixelFormat:6408,dataType:5121,wrapMode:33071,width:this._size[g][0],
height:this._size[g][1]},new Uint8Array(this._mosaicsData[g].buffer)));const v=this._textures[g];v.setSamplingMode(c);this._dirties[g]&&v.setData(new Uint8Array(this._mosaicsData[g].buffer));l.bindTexture(v,m);this._dirties[g]=!1};r._copyBits=function(l,c,g,m,v,z,D,E,w,F,J){let L=m*c+g;D=E*z+D;if(J)for(D-=z,J=-1;J<=F;J++,L=((J+F)%F+m)*c+g,D+=z)for(E=-1;E<=w;E++)v[D+E]=l[L+(E+w)%w];else for(g=0;g<F;g++){for(m=0;m<w;m++)v[D+m]=l[L+m];L+=c;D+=z}};q._copy=function(l,c,g,m,v,z){if(this._sprites&&"loaded"===
this._sprites.loadStatus&&!(g>=this._mosaicsData.length)){var D=new Uint32Array(z?z.buffer:this._sprites.image.buffer),E=this._mosaicsData[g];E&&D||console.error("Source or target images are uninitialized!");r._copyBits(D,z?c.width:this._sprites.width,c.x,c.y,E,m[0],l.x+2,l.y+2,c.width,c.height,v);this._dirties[g]=!0}};q._allocateImage=function(l,c){l+=2;c+=2;var g=Math.max(l,c);if(this._maxItemSize&&this._maxItemSize<g)return g=new b(0,0,l,c),this._mosaicsData.push(new Uint32Array(l*c)),this._dirties.push(!0),
this._size.push([l,c]),this._textures.push(void 0),[g,this._mosaicsData.length-1,[l,c]];g=l%4?4-l%4:4;let m=c%4?4-c%4:4;1===g&&(g=5);1===m&&(m=5);g=this._binPack.allocate(l+g,c+m);return 0>=g.width?(this._dirties[this._currentPage]||(this._mosaicsData[this._currentPage]=null),this._currentPage=this._mosaicsData.length,this._mosaicsData.push(new Uint32Array(this._pageWidth*this._pageHeight)),this._dirties.push(!0),this._size.push([this._pageWidth,this._pageHeight]),this._textures.push(void 0),this._binPack=
new d(this._pageWidth-4,this._pageHeight-4),this._allocateImage(l,c)):[g,this._currentPage,[this._pageWidth,this._pageHeight]]};q.dispose=function(){this._binPack=null;this._mosaicRects={};for(const l of this._textures)l&&l.dispose();this._textures.length=0};return r}()})},"esri/views/2d/engine/vectorTiles/decluttering/debugging":function(){define(["exports"],function(y){function B(u,A){return`${Math.round(10*u)/10}${A}`}y.drawColliders=function(u,A){const k=window.COLLISION_XRAY;for(let q=0;q<A.length;++q){const l=
!A[q].unique.show;if(k||!l)for(const c of A[q].colliders){if(!c.enabled)continue;var f=!A[q].unique.parts[c.partIndex].show;if(!k&&f)continue;var p=c.xScreen,h=c.yScreen;const g=c.dxScreen,m=c.dyScreen;u.globalAlpha=l||f?.2:1;f=u;var e=p-1,b=h-1;f.fillStyle="green";f.fillRect(e,b,3,3);f=u;e=p+g;b=h+m;var d=c.width,r=c.height;f.strokeStyle="red";f.strokeRect(e,b,d,r);f=u;p=p+g-1;h=h+m-1;f.fillStyle="blue";f.fillRect(p,h,3,3);u.globalAlpha=1}}};y.drawGridIndex=function(u,A){u.strokeStyle="black";const k=
A.cellSize,f=A.rows,p=A.columns;for(let h=0;h<f;h++){const e=A.cells[h],b=h*k,d=(h+1)*k;for(let r=0;r<p;r++){const q=e[r],l=r*k;u.strokeRect(l,b,(r+1)*k-l,d-b);u.fillText(`cells:${q.length}`,l+4,b+12)}}};y.perfAdd=function(u,A,k){if(window.PERFORMANCE_RECORDING_STORAGE){var f=window.PERFORMANCE_RECORDING_STORAGE;f.perf=f.perf||{};f=f.perf;f[u]=f[u]||{start:null,time:0,min:void 0,max:void 0,samples:[],unit:k};f[u].time+=A;f[u].samples.push(A);if(null==f[u].min||A<f[u].min)f[u].min=A;if(null==f[u].max||
A>f[u].max)f[u].max=A}};y.perfClear=function(){window.PERFORMANCE_RECORDING_STORAGE&&(window.PERFORMANCE_RECORDING_STORAGE.perf={})};y.perfElement=function(u){if(!window.PERFORMANCE_RECORDING_STORAGE){var A=document.createElement("div");A.innerHTML="No recorded data is present because performance recording is disabled.";return A}A=document.createElement("div");var k=window.PERFORMANCE_RECORDING_STORAGE.perf;var f='\x3ctable style\x3d"border-collapse: collapse;"\x3e'+`<tr style="text-weight: bold; border-bottom: 1px solid "${u}";"><td>Name</td><td>Total</td><td>Runs</td><td>Average</td><td>Min</td><td>Distribution</td><td>Max</td><td>Histogram (${50} bins)</td></tr>`;
const p=[];for(var h in k)p.push({name:h,value:k[h].time/k[h].samples.length,sortkey:k[h].max});p.sort((l,c)=>-(l.sortkey-c.sortkey));h=p.map(l=>l.name);for(var e of h)f+="\x3ctr\x3e",f+=`<td>${e}</td>`,f+=`<td>${B(k[e].time,k[e].unit)}</td>`,f+=`<td>${k[e].samples.length}</td>`,f+=`<td>${B(k[e].time/k[e].samples.length,k[e].unit)}</td>`,f+=`<td style="text-align: right;">${B(k[e].min,k[e].unit)}</td>`,f+="\x3ctd data-distribution\x3d'1'\x3e\x3c/td\x3e",f+=`<td>${B(k[e].max,k[e].unit)}</td>`,f+="\x3ctd data-histogram\x3d'1'\x3e\x3c/td\x3e",
f+="\x3c/tr\x3e";A.innerHTML=f+"\x3ctable\x3e";f=A.querySelectorAll("td[data-distribution\x3d'1']");e=A.querySelectorAll("td[data-histogram\x3d'1']");for(let l=0;l<f.length;l++){let c=f[l];var b=document.createElement("canvas");b.height=10;b.width=100;var d=b.getContext("2d");d.strokeStyle=u;d.beginPath();d.moveTo(0,5);d.lineTo(100,5);if(k[h[l]].max>k[h[l]].min+.001)for(const g of k[h[l]].samples){var r=(g-k[h[l]].min)/(k[h[l]].max-k[h[l]].min);d.moveTo(100*r,3);d.lineTo(100*r,7)}d.stroke();d.strokeRect((p[l].value-
k[h[l]].min)/(k[h[l]].max-k[h[l]].min)*100-2,0,4,9);c.appendChild(b);c=e[l];{b=Array(50);for(d=0;d<b.length;d++)b[d]=0;for(const m of k[h[l]].samples)d=(m-k[h[l]].min)/(k[h[l]].max-k[h[l]].min),b[1===d?b.length-1:Math.floor(d*b.length)]++;d=document.createElement("canvas");d.height=30;d.width=120;r=d.getContext("2d");r.strokeStyle=u;r.fillStyle=u;let g=0;for(var q=0;q<b.length;q++)g=Math.max(g,b[q]);for(q=0;q<b.length;q++){const m=b[q];r.fillRect(q*d.width/b.length,d.height*(1-m/g),d.width/b.length,
m/g*d.height)}r.beginPath();r.moveTo(0,d.height);r.lineTo(d.width,d.height);r.stroke();c.appendChild(d)}}u=A.querySelectorAll("td");for(k=0;k<u.length;k++)u[k].style.padding="5px";return A};Object.defineProperty(y,"__esModule",{value:!0})})},"esri/views/2d/engine/vectorTiles/TileManager":function(){define(["exports","../../../../core/maybe","../../../../core/LRUCache","../../tiling/TileKey","../../tiling/TileCoverage"],function(y,B,u,A,k){const f=(h,e)=>h+1/(1<<2*e);let p=function(){function h(b,
d){this._tiles=new Map;this._tileCache=new u(40,r=>r.dispose());this._viewSize=[0,0];this._visibleTiles=new Map;this.acquireTile=b.acquireTile;this.releaseTile=b.releaseTile;this.tileInfoView=b.tileInfoView;this._container=d}var e=h.prototype;e.destroy=function(){this._tiles.clear();this._tiles=null;this._tileCache.clear();this._tileCache=null};e.update=function(b){this._updateCacheSize(b);const d=this.tileInfoView;b=d.getTileCoverage(b.state,0,"smallest");const {spans:r,lodInfo:q}=b,{level:l}=q,
c=new Set,g=new Set;for(const {row:v,colFrom:z,colTo:D}of r)for(let E=z;E<=D;E++){const w=A.getId(l,v,q.normalizeCol(E),q.getWorldForColumn(E)),F=this._getOrAcquireTile(w);c.add(w);F.processed()?this._addToContainer(F):g.add(new A(w))}for(const [v,z]of this._tiles)z.isCoverage=c.has(v);for(var m of g)this._findPlaceholdersForMissingTiles(m,c);m=!1;for(const [v,z]of this._tiles)z.neededForCoverage=c.has(v),z.neededForCoverage||z.isHoldingForFade&&d.intersects(b,z.key)&&c.add(v),z.isFading&&(m=!0);
for(const [v]of this._tiles)c.has(v)||this._releaseTile(v);k.pool.release(b);return!m};e.clear=function(){this._tiles.clear();this._tileCache.clear();this._visibleTiles.clear()};e.clearCache=function(){this._tileCache.clear()};e._findPlaceholdersForMissingTiles=function(b,d){var r=[];for(const [,q]of this._tiles)this._addPlaceholderChild(r,q,b,d);r=r.reduce(f,0);1E-6>Math.abs(1-r)||this._addPlaceholderParent(b.id,d)};e._addPlaceholderChild=function(b,d,r,q){if(!(d.key.level<=r.level)&&d.hasData()){{var l=
d.key;const c=l.level-r.level;l=r.row===l.row>>c&&r.col===l.col>>c&&r.world===l.world}l&&(this._addToContainer(d),q.add(d.id),b.push(d.key.level-r.level))}};e._addPlaceholderParent=function(b,d){for(;;){{const [q,l,c,g]=b.split("/");b=parseInt(q,10);b=0===b?null:`${b-1}/${parseInt(l,10)>>1}/${parseInt(c,10)>>1}/${parseInt(g,10)}`}if(!b||d.has(b))break;const r=this._getTile(b);if(r&&r.hasData()){this._addToContainer(r);d.add(r.id);break}}};e._getOrAcquireTile=function(b){let d=this._tiles.get(b);if(d)return d;
(d=this._tileCache.pop(b))||(d=this.acquireTile(new A(b)));this._tiles.set(b,d);return d};e._getTile=function(b){let d=this._tiles.get(b);if(d)return d;(d=this._tileCache.pop(b))&&this._tiles.set(b,d);return d};e._releaseTile=function(b){const d=this._tiles.get(b);this.releaseTile(d);this._removeFromContainer(d);this._tiles.delete(b);d.hasData()?this._tileCache.put(b,d,1):d.dispose()};e._addToContainer=function(b){let d;const r=[],q=this._container;if(!q.contains(b)){var l=this._visibleTiles;for(const [,
c]of l)this._canConnectDirectly(b,c)&&r.push(c),B.isNone(d)&&this._canConnectDirectly(c,b)&&(d=c);if(B.isSome(d)){for(const c of r)d.childrenTiles.delete(c),b.childrenTiles.add(c),c.parentTile=b;d.childrenTiles.add(b);b.parentTile=d}else for(const c of r)b.childrenTiles.add(c),c.parentTile=b;l.set(b.id,b);q.addChild(b)}};e._removeFromContainer=function(b){this._visibleTiles.delete(b.id);this._container.removeChild(b);if(B.isSome(b.parentTile)){b.parentTile.childrenTiles.delete(b);for(const d of b.childrenTiles)B.isSome(b.parentTile)&&
b.parentTile.childrenTiles.add(d)}for(const d of b.childrenTiles)d.parentTile=b.parentTile;b.parentTile=null;b.childrenTiles.clear()};e._canConnectDirectly=function(b,d){b=b.key;let {level:r,row:q,col:l,world:c}=d.key;for(d=this._visibleTiles;0<r;){r--;q>>=1;l>>=1;if(b.level===r&&b.row===q&&b.col===l&&b.world===c)return!0;if(d.has(`${r}/${q}/${l}/${c}`))break}return!1};e._updateCacheSize=function(b){b=b.state.size;if(b[0]!==this._viewSize[0]||b[1]!==this._viewSize[1]){var d=Math.ceil(b[0]/512)+1,
r=Math.ceil(b[1]/512)+1;this._viewSize[0]=b[0];this._viewSize[1]=b[1];this._tileCache.maxSize=5*d*r}};return h}();y.TileManager=p;Object.defineProperty(y,"__esModule",{value:!0})})},"esri/views/2d/engine/vectorTiles/VectorTileContainer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../core/promiseUtils ../../../../geometry/support/aaBoundingRect ../../tiling/TileKey ../../tiling/TileCoverage ../webgl/TiledDisplayObject ../webgl/enums ../webgl/TileContainer ./decluttering/debugging ./decluttering/SymbolFader".split(" "),
function(y,B,u,A,k,f,p,h,e,b,d,r){function q(l,c){if(l){const g=l.getLayoutProperty("visibility");if(!g||"none"!==g.getValue()&&(void 0===l.minzoom||l.minzoom<c+1E-6)&&(void 0===l.maxzoom||l.maxzoom>=c-1E-6))return!0}return!1}b=function(l){function c(m){m=l.call(this,m)||this;m._backgroundTiles=[];m._pointToCallbacks=new Map;m._fading=!1;return m}B._inheritsLoose(c,l);var g=c.prototype;g.destroy=function(){this.children.forEach(m=>m.destroy());this.removeAllChildren();this._spriteMosaic&&(this._spriteMosaic.dispose(),
this._spriteMosaic=null);this._glyphMosaic&&(this._glyphMosaic.dispose(),this._glyphMosaic=null);u.isSome(this._symbolFader)&&(this._symbolFader.clear(),this._symbolFader=null);this._styleRepository=null;this._backgroundTiles=[];this._pointToCallbacks.clear()};g.setStyleResources=function(m,v,z){this._spriteMosaic=m;this._glyphMosaic=v;this._styleRepository=z;u.isNone(this._symbolFader)&&(m=new r.SymbolFader(this._styleRepository,this.children),m.on("fade-start",()=>{this.emit("fade-start");this._fading=
!0;this.requestRender()}),m.on("fade-complete",()=>{this.emit("fade-complete");this._fading=!1;this.requestRender()}),this._symbolFader=m);u.unwrap(this._symbolFader).styleRepository=z};g.deleteStyleLayers=function(m){u.isSome(this._symbolFader)&&this._symbolFader.deleteStyleLayers(m)};g.hitTest=async function(m,v){m=[m,v];v=A.createResolver();this._pointToCallbacks.set(m,v);this.requestRender();return v.promise};g.enterTileInvalidation=function(){for(const m of this.children)m.invalidating=!0};g.createRenderParams=
function(m){return{...l.prototype.createRenderParams.call(this,m),renderPass:null,styleLayer:null,styleLayerUID:-1,glyphMosaic:this._glyphMosaic,spriteMosaic:this._spriteMosaic,hasClipping:!!this._clippingInfos}};g.doRender=function(m){!this.visible||m.drawPhase!==e.WGLDrawPhase.MAP&&m.drawPhase!==e.WGLDrawPhase.DEBUG||void 0===this._spriteMosaic||l.prototype.doRender.call(this,m)};g.addChild=function(m){l.prototype.addChild.call(this,m);u.isSome(this._symbolFader)?this._symbolFader.addTile(m):m.decluttered=
!0;this.requestRender();return m};g.removeChild=function(m){u.isSome(this._symbolFader)&&this._symbolFader.removeTile(m);this.requestRender();return l.prototype.removeChild.call(this,m)};g.renderChildren=function(m){if(m.drawPhase===e.WGLDrawPhase.DEBUG)l.prototype.renderChildren.call(this,m);else if(this._doRender(m),0<this._pointToCallbacks.size){const {context:v}=m,z=v.getBoundFramebufferObject();m.drawPhase=e.WGLDrawPhase.HITTEST;const D=m.painter.effects.hittest;D.bind(m);this._doRender(m);D.draw(m,
this._pointToCallbacks);v.bindFramebuffer(z)}};g.removeAllChildren=function(){for(let m=0;m<this.children.length;m++){const v=this.children[m];u.isSome(this._symbolFader)&&this._symbolFader.removeTile(v);v.dispose()}l.prototype.removeAllChildren.call(this)};g.getStencilTarget=function(){return this.children.filter(m=>m.neededForCoverage&&m.hasData())};g.restartDeclutter=function(){u.isSome(this._symbolFader)&&this._symbolFader.restartDeclutter()};g._doRender=function(m){var {context:v}=m,z=this._styleRepository;
if(z){var D=z.layers,E=!0;m.drawPhase===e.WGLDrawPhase.HITTEST&&(E=!1);0<z.backgroundBucketIds.length&&(m.renderPass="background",this._renderBackgroundLayers(m,z.backgroundBucketIds));l.prototype.renderChildren.call(this,m);if((z=this.children.filter(I=>I.visible&&I.hasData()))&&0!==z.length){for(var w of z)w.triangleCount=0;v.setStencilWriteMask(0);v.setColorMask(!0,!0,!0,!0);v.setStencilOp(7680,7680,7681);v.setStencilTestEnabled(!0);v.setBlendingEnabled(!1);v.setDepthTestEnabled(!0);v.setDepthWriteEnabled(!0);
v.setDepthFunction(515);v.setClearDepth(1);v.clear(v.gl.DEPTH_BUFFER_BIT);m.renderPass="opaque";for(w=D.length-1;0<=w;w--)this._renderStyleLayer(D[w],m,z);v.setDepthWriteEnabled(!1);v.setBlendingEnabled(E);v.setBlendFunctionSeparate(1,771,1,771);m.renderPass="translucent";for(E=0;E<D.length;E++)this._renderStyleLayer(D[E],m,z);v.setDepthTestEnabled(!1);m.renderPass="symbol";for(E=0;E<D.length;E++)this._renderStyleLayer(D[E],m,z);v.bindVAO();v.setStencilTestEnabled(!0);v.setBlendingEnabled(!0);if(m.drawPhase===
e.WGLDrawPhase.MAP&&(this._fade(m.displayLevel,m.state),(m=window.COLLISION_DEBUG_CTX)&&u.isSome(this._symbolFader)&&(m.clearRect(0,0,m.canvas.width,m.canvas.height),!this._fading||window.COLLISION_XRAY)))for(const I of this.children)if(I.symbols){const K=[];I.symbols.forEach(G=>{K.push(...G)});if(window.COLLISION_SHOW_GRID){var F,J,L;(v=null==(F=this._symbolFader)?void 0:null==(J=F._symbolDeclutterer)?void 0:null==(L=J._collisionJob)?void 0:L._gridIndex)&&d.drawGridIndex(m,v)}d.drawColliders(m,K)}}}};
g._fade=function(m,v){u.isSome(this._symbolFader)&&(this._symbolFader.update(m,v)||this.requestRender())};g._renderStyleLayer=function(m,v,z){const {painter:D,renderPass:E}=v;if(void 0!==m){var w=m.getLayoutProperty("visibility");if(!w||"none"!==w.getValue()){switch(m.type){case 0:return;case 1:if("opaque"!==E&&"translucent"!==v.renderPass)return;var F="vtlFill";break;case 2:if("translucent"!==E)return;F="vtlLine";break;case 4:if("symbol"!==E)return;F="vtlCircle";break;case 3:if("symbol"!==E)return;
F="vtlSymbol"}z=3===m.type?z.filter(J=>J.decluttered):z.filter(J=>J.neededForCoverage);if("vtlSymbol"!==F&&(w=v.displayLevel,0===z.length||void 0!==m.minzoom&&m.minzoom>=w+1E-6||void 0!==m.maxzoom&&m.maxzoom<w-1E-6))return;w=m.uid;v.styleLayerUID=w;v.styleLayer=m;for(const J of z)if(J.layerData.has(w)){D.renderObjects(v,z,F);break}}}};g._renderBackgroundLayers=function(m,v){const {context:z,displayLevel:D,painter:E,state:w}=m,F=this._styleRepository;var J=!1;for(var L of v)if(q(F.getLayerById(L),
D)){J=!0;break}if(J){J=this._tileInfoView.getTileCoverage(m.state,0,"smallest");var {spans:I,lodInfo:K}=J,{level:G}=K,M=k.create();L=[];if(this._renderPasses){var Q=this._renderPasses[0];u.isSome(this._clippingInfos)&&(Q.brushes[0].prepareState(m,this._clippingInfos[0]),Q.brushes[0].drawMany(m,this._clippingInfos))}Q=this._backgroundTiles;var R=0;for(const {row:C,colFrom:N,colTo:P}of I)for(let T=N;T<=P;T++){if(R<Q.length){var O=Q[R];O.key.set(G,C,K.normalizeCol(T),K.getWorldForColumn(T));this._tileInfoView.getTileBounds(M,
O.key,!1);O.bounds=M;O.coords[0]=M[0];O.coords[1]=M[3]}else O=new f(G,C,K.normalizeCol(T),K.getWorldForColumn(T)),O=new h.TiledDisplayObject(O,this._tileInfoView.getTileBounds(k.create(),O),[512,512],[4096,4096]),Q.push(O);O.setTransform(w,this._tileInfoView.getTileResolution(O.key));L.push(O);R++}z.setStencilWriteMask(0);z.setColorMask(!0,!0,!0,!0);z.setStencilOp(7680,7680,7681);z.setStencilFunction(514,0,255);G=!0;m.drawPhase===e.WGLDrawPhase.HITTEST&&(G=!1);z.setStencilTestEnabled(G);for(const C of v)v=
F.getLayerById(C),q(v,D)&&(m.styleLayerUID=v.uid,m.styleLayer=v,E.renderObjects(m,L,"vtlBackground"));p.pool.release(J)}};return c}(b["default"]);y.VectorTileContainer=b;Object.defineProperty(y,"__esModule",{value:!0})})},"esri/views/2d/engine/vectorTiles/decluttering/SymbolFader":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/maybe ../../../../../core/Evented ./config ./core ./util ./jobs ./SymbolDeclutterer ./SymbolRepository".split(" "),function(y,
B,u,A,k,f,p,h,e,b){A=function(d){function r(l,c){var g=d.call(this)||this;g.styleRepository=l;g._tileToHandle=new Map;g._viewState={scale:0,rotation:0,center:[0,0],size:[0,0]};g._declutterViewState={scale:0,rotation:0,center:[0,0],size:[0,0]};g._completed=!1;g._symbolRepository=new b.SymbolRepository(4096,c,()=>new f.VTLUniqueSymbol);g._symbolDeclutterer=new e.SymbolDeclutterer(c,g._symbolRepository,(m,v,z)=>new h.CollisionJob(m,v,z,g.styleRepository,g._zoom,g._viewState.rotation),(m,v)=>{m.allSymbolsFadingOut=
!0;m.lastOpacityUpdate=v;p.writeOpacityToBuffers(m,v,!0);m.decluttered=!0;m.requestRender()},(m,v)=>g.styleRepository.getStyleLayerByUID(m.styleLayerUID).z-g.styleRepository.getStyleLayerByUID(v.styleLayerUID).z,m=>(m=g.styleRepository.getStyleLayerByUID(m).getLayoutProperty("visibility"))&&"none"===m.getValue()?!1:!0);return g}B._inheritsLoose(r,d);var q=r.prototype;q.addTile=function(l){l.decluttered=!1;this._tileToHandle.set(l,l.on("symbols-changed",()=>{this._symbolRepository.add(l);this.restartDeclutter()}));
this._symbolRepository.add(l);this.restartDeclutter()};q.removeTile=function(l){const c=this._tileToHandle.get(l);c&&(this._symbolRepository.removeTile(l),this.restartDeclutter(),c.remove(),this._tileToHandle.delete(l))};q.update=function(l,c){this._zoom=l;this._viewState={scale:c.scale,rotation:c.rotation,center:[c.center[0],c.center[1]],size:[c.size[0],c.size[1]]};this._continueDeclutter();return this._completed};q.restartDeclutter=function(){this._completed=!1;this._symbolDeclutterer.restart();
this._notifyUnstable()};q.clear=function(){this._completed=!1;this._symbolRepository=null;this._symbolDeclutterer.restart();this._tileToHandle.forEach(l=>l.remove());this._tileToHandle.clear()};q.deleteStyleLayers=function(l){this._symbolRepository.deleteStyleLayers(l)};q._continueDeclutter=function(){if(!this._completed||this.stale)this._symbolDeclutterer.running||(this._declutterZoom=this._zoom,this._declutterViewState.center[0]=this._viewState.center[0],this._declutterViewState.center[1]=this._viewState.center[1],
this._declutterViewState.rotation=this._viewState.rotation,this._declutterViewState.scale=this._viewState.scale,this._declutterViewState.size[0]=this._viewState.size[0],this._declutterViewState.size[1]=this._viewState.size[1],this._symbolDeclutterer.restart()),this._symbolDeclutterer.setScreenSize(this._viewState.size[0],this._viewState.size[1]),(this._completed=this._symbolDeclutterer.continue(k.DECLUTTER_BUDGET))&&this._scheduleNotifyStable()};q._scheduleNotifyStable=function(){u.isSome(this._stableNotificationHandle)&&
clearTimeout(this._stableNotificationHandle);this._stableNotificationHandle=setTimeout(()=>{this._stableNotificationHandle=null;this.emit("fade-complete")},1.5*k.FADE_DURATION)};q._notifyUnstable=function(){u.isSome(this._stableNotificationHandle)&&(clearTimeout(this._stableNotificationHandle),this._stableNotificationHandle=null);this.emit("fade-start")};B._createClass(r,[{key:"stale",get:function(){return this._zoom!==this._declutterZoom||this._viewState.size[0]!==this._declutterViewState.size[0]||
this._viewState.size[1]!==this._declutterViewState.size[1]||this._viewState.scale!==this._declutterViewState.scale||this._viewState.rotation!==this._declutterViewState.rotation}}]);return r}(A);y.SymbolFader=A;Object.defineProperty(y,"__esModule",{value:!0})})},"esri/views/2d/engine/vectorTiles/decluttering/jobs":function(){define(["exports","../../../../../chunks/mat3f32","./config","./util"],function(y,B,u,A){let k=function(){function f(h,e,b,d,r,q){this._symbols=h;this._styleRepository=d;this._zoom=
r;this._currentSymbolCursor=this._currentLayerCursor=0;this._styleProps=new Map;this._allNeededMatrices=new Map;this._gridIndex=new A.GridIndex(e,b,u.COLLISION_GRID_CELL_SIZE);this._si=Math.sin(Math.PI*q/180);this._co=Math.cos(Math.PI*q/180);for(const l of h)for(const c of l.symbols)this._allNeededMatrices.has(c.tile)||this._allNeededMatrices.set(c.tile,B.clone(c.tile.transforms.tileUnitsToPixels))}var p=f.prototype;p.work=function(h){const e=this._gridIndex,b=performance.now();for(;this._currentLayerCursor<
this._symbols.length;this._currentLayerCursor++,this._currentSymbolCursor=0){const E=this._symbols[this._currentLayerCursor],w=this._getProperties(E.styleLayerUID);for(;this._currentSymbolCursor<E.symbols.length;this._currentSymbolCursor++){if(99===this._currentSymbolCursor%100&&performance.now()-b>h)return!1;var d=E.symbols[this._currentSymbolCursor];if(!d.unique.show)continue;{var r=d,q=this._si,l=this._co,c=this._allNeededMatrices.get(d.tile),g=this._zoom;const {iconRotationAlignment:K,textRotationAlignment:G,
iconTranslate:M,iconTranslateAnchor:Q,textTranslate:R,textTranslateAnchor:O}=w;var m=0;for(const C of r.colliders){const [N,P]=0===C.partIndex?M:R;var v=0===C.partIndex?Q:O,z=C.minLod<=g&&g<=C.maxLod;m+=z?0:1;C.enabled=z;C.xScreen=C.xTile*c[0]+C.yTile*c[3]+c[6];C.yScreen=C.xTile*c[1]+C.yTile*c[4]+c[7];0===v?(C.xScreen+=l*N-q*P,C.yScreen+=q*N+l*P):(C.xScreen+=N,C.yScreen+=P);1===(0===C.partIndex?K:G)?(C.dxScreen=C.dxPixels,C.dyScreen=C.dyPixels):(C.dxScreen=l*(C.dxPixels+C.width/2)-q*(C.dyPixels+C.height/
2)-C.width/2,C.dyScreen=q*(C.dxPixels+C.width/2)+l*(C.dyPixels+C.height/2)-C.height/2)}0<r.colliders.length&&m===r.colliders.length&&(r.unique.show=!1)}r=d.unique;if(!r.show)continue;const {iconAllowOverlap:F,iconIgnorePlacement:J,textAllowOverlap:L,textIgnorePlacement:I}=w;for(const K of d.colliders)if(K.enabled&&(q=r.parts[K.partIndex],q.show)){if(l=!(K.partIndex?L:F))a:{l=K.xScreen+K.dxScreen;c=K.yScreen+K.dyScreen;g=l+K.width;m=c+K.height;const [G,M,Q,R]=e.getCellSpan(l,c,g,m);for(v=M;v<=R;v++)for(z=
G;z<=Q;z++){var D=e.cells[v][z];for(const O of D){D=O.xScreen+O.dxScreen;const C=O.yScreen+O.dyScreen,N=D+O.width,P=C+O.height;if(!(g<D||l>N||m<C||c>P)){l=!0;break a}}}l=!1}l&&(K.hard?r.show=!1:q.show=!1)}if(r.show)for(const K of d.colliders){if(!K.enabled)continue;if(K.partIndex?I:J)continue;if(!r.parts[K.partIndex].show)continue;d=K.xScreen+K.dxScreen;q=K.yScreen+K.dyScreen;const [G,M,Q,R]=this._gridIndex.getCellSpan(d,q,d+K.width,q+K.height);for(d=M;d<=R;d++)for(q=G;q<=Q;q++)this._gridIndex.cells[d][q].push(K)}}}return!0};
p._getProperties=function(h){var e=this._styleProps.get(h);if(e)return e;e=this._zoom;const b=this._styleRepository.getStyleLayerByUID(h);var d=0!==b.getLayoutValue("symbol-placement",e);let r=b.getLayoutValue("icon-rotation-alignment",e);2===r&&(r=d?0:1);let q=b.getLayoutValue("text-rotation-alignment",e);2===q&&(q=d?0:1);d=b.getPaintValue("icon-translate",e);const l=b.getPaintValue("icon-translate-anchor",e),c=b.getPaintValue("text-translate",e),g=b.getPaintValue("text-translate-anchor",e);e={iconAllowOverlap:b.getLayoutValue("icon-allow-overlap",
e),iconIgnorePlacement:b.getLayoutValue("icon-ignore-placement",e),textAllowOverlap:b.getLayoutValue("text-allow-overlap",e),textIgnorePlacement:b.getLayoutValue("text-ignore-placement",e),iconRotationAlignment:r,textRotationAlignment:q,iconTranslateAnchor:l,iconTranslate:d,textTranslateAnchor:g,textTranslate:c};this._styleProps.set(h,e);return e};return f}();y.CollisionJob=k;Object.defineProperty(y,"__esModule",{value:!0})})},"esri/views/2d/engine/vectorTiles/decluttering/SymbolDeclutterer":function(){define(["exports",
"../../../../../chunks/_rollupPluginBabelHelpers","./config"],function(y,B,u){function A(f,p){if(f.priority-p.priority)return f.priority-p.priority;const h=f.tile.key,e=p.tile.key;return h.world-e.world?h.world-e.world:h.level-e.level?h.level-e.level:h.row-e.row?h.row-e.row:h.col-e.col?h.col-e.col:f.xTile-p.xTile?f.xTile-p.xTile:f.yTile-p.yTile}let k=function(){function f(h,e,b,d,r,q){this._visibleTiles=h;this._symbolRepository=e;this._createCollisionJob=b;this._assignTileSymbolsOpacity=d;this._symbolLayerSorter=
r;this._isLayerVisible=q;this._selectionJob=null;this._selectionJobCompleted=!1;this._collisionJob=null;this._collisionJobCompleted=!1;this._opacityJob=null;this._opacityJobCompleted=!1;this._running=!0}var p=f.prototype;p.setScreenSize=function(h,e){this._screenWidth===h&&this._screenHeight===e||this.restart();this._screenWidth=h;this._screenHeight=e};p.restart=function(){this._selectionJob=null;this._selectionJobCompleted=!1;this._collisionJob=null;this._collisionJobCompleted=!1;this._opacityJob=
null;this._opacityJobCompleted=!1;this._running=!0};p.continue=function(h){this._selectionJob||(this._selectionJob=this._createSelectionJob());if(!this._selectionJobCompleted){var e=performance.now();if(!this._selectionJob.work(h))return!1;this._selectionJobCompleted=!0;h=Math.max(0,h-(performance.now()-e));if(0===h)return!1}this._collisionJob||(this._collisionJob=this._createCollisionJob(this._selectionJob.sortedSymbols,this._screenWidth,this._screenHeight));if(!this._collisionJobCompleted){e=performance.now();
if(!this._collisionJob.work(h))return!1;this._collisionJobCompleted=!0;h=Math.max(0,h-(performance.now()-e));if(0===h)return!1}this._opacityJob||(this._opacityJob=this._createOpacityJob());if(!this._opacityJobCompleted){e=performance.now();if(!this._opacityJob.work(h))return!1;this._opacityJobCompleted=!0;h=Math.max(0,h-(performance.now()-e));if(0===h)return!1}this._running=!1;return!0};p._createSelectionJob=function(){const h=this._symbolRepository.uniqueSymbols,e=[];let b=0,d=0;const r=this._isLayerVisible,
q=this._symbolLayerSorter;return{work:function(l){const c=performance.now();for(;d<h.length;d++,b=0){const m=h[d];var g=m.styleLayerUID;if(!r(g)){e[d]||(e[d]={styleLayerUID:g,symbols:[]});continue}e[d]=e[d]||{styleLayerUID:g,symbols:[]};const v=e[d];for(;b<m.uniqueSymbols.length;b++){g=m.uniqueSymbols[b];if(99===b%100&&performance.now()-c>l)return!1;let z=null,D=!1,E=!1;for(const w of g.tileSymbols)if(w.selectedForRendering=!1,!E||!D){const F=w.tile;if(!z||F.isCoverage||F.neededForCoverage&&!D){z=
w;if(F.neededForCoverage||F.isCoverage)E=!0;F.isCoverage&&(D=!0)}}z.selectedForRendering=!0;if(E){v.symbols.push(z);g.show=!0;for(const w of g.parts)w.show=!0}else g.show=!1}}for(const m of e)m.symbols.sort(A);return!0},get sortedSymbols(){return e.sort(q)}}};p._createOpacityJob=function(){function h(r,q){var l=r.symbols;for(const [,g]of l){var c=g;l=q;for(const m of c){c=m.unique;for(const v of c.parts)v.startOpacity+=(l-v.startTime)/u.FADE_DURATION*(.5<v.targetOpacity?1:-1),v.startOpacity=Math.min(Math.max(v.startOpacity,
0),1),v.startTime=l,v.targetOpacity=c.show&&v.show?1:0}}e(r,q);for(const g of r.childrenTiles)h(g,q)}const e=this._assignTileSymbolsOpacity,b=this._visibleTiles;let d=0;return{work(r){const q=performance.now();for(;d<b.length;d++){if(performance.now()-q>r)return!1;const l=b[d];if(l.parentTile)continue;const c=performance.now();h(l,c)}return!0}}};B._createClass(f,[{key:"running",get:function(){return this._running}}]);return f}();y.SymbolDeclutterer=k;Object.defineProperty(y,"__esModule",{value:!0})})},
"esri/views/2d/engine/vectorTiles/decluttering/SymbolRepository":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../../../../../core/maybe","./util"],function(y,B,u,A){let k=function(){function f(h,e,b){this.tileCoordRange=h;this._visibleTiles=e;this._createUnique=b;this._tiles=new Map;this._uniqueSymbolsReferences=new Map}var p=f.prototype;p.add=function(h,e){this._uniqueSymbolLayerArray=null;let b=this._tiles.get(h.id);b||(b={symbols:new Map},this._tiles.set(h.id,
b));var d=new Map;if(e)for(var r of e)b.symbols.has(r)&&(d.set(r,b.symbols.get(r)),b.symbols.delete(r));else for(var [q]of h.layerData)b.symbols.has(q)&&(d.set(q,b.symbols.get(q)),b.symbols.delete(q));this._removeSymbols(d);e=h.symbols;d=new Map;for(const [l,c]of e)if(r=c.length,32<=r){q=this.tileCoordRange;do q/=2,r/=4;while(8<r&&64<q);r=new A.GridIndex(this.tileCoordRange,this.tileCoordRange,q);d.set(l,{flat:c,index:r});b.symbols.set(l,{flat:c,index:r});for(const g of c)r.getCell(g.xTile,g.yTile).push(g)}else d.set(l,
{flat:c}),b.symbols.set(l,{flat:c});this._addSymbols(h.key,e)};p.deleteStyleLayers=function(h){this._uniqueSymbolLayerArray=null;for(const [e,b]of this._tiles){const d=new Map;for(const r of h)b.symbols.has(r)&&(d.set(r,b.symbols.get(r)),b.symbols.delete(r));this._removeSymbols(d);0===b.symbols.size&&this._tiles.delete(e)}};p.removeTile=function(h){this._uniqueSymbolLayerArray=null;const e=this._tiles.get(h.id);if(e){var b=new Map;for(const [d]of h.symbols)e.symbols.has(d)&&(b.set(d,e.symbols.get(d)),
e.symbols.delete(d));this._removeSymbols(b);0===e.symbols.size&&this._tiles.delete(h.id)}};p._removeSymbols=function(h){for(const [b,{flat:d}]of h)for(const r of d){h=r.unique;var e=h.tileSymbols;const q=e.length-1;for(let l=0;l<q;l++)if(e[l]===r){e[l]=e[q];break}e.length=q;0===q&&(e=this._uniqueSymbolsReferences.get(b),e.delete(h),0===e.size&&this._uniqueSymbolsReferences.delete(b));r.unique=null}};p._addSymbols=function(h,e){if(0!==e.size){var b=this._visibleTiles;for(const d of b)d.parentTile||
d.key.world!==h.world||d.key.level===h.level&&!d.key.equals(h)||this._matchSymbols(d,h,e);for(const [d,r]of e)for(const q of r)u.isNone(q.unique)&&(h=this._createUnique(),q.unique=h,h.tileSymbols.push(q),e=this._uniqueSymbolsReferences.get(d),e||(e=new Set,this._uniqueSymbolsReferences.set(d,e)),e.add(h))}};p._matchSymbols=function(h,e,b){if(h.key.level>e.level){var d=h.key.level-e.level;if(h.key.row>>d!==e.row||h.key.col>>d!==e.col)return}if(e.level>h.key.level&&(d=e.level-h.key.level,e.row>>d!==
h.key.row||e.col>>d!==h.key.col))return;if(e.equals(h.key))for(var r of h.childrenTiles)this._matchSymbols(r,e,b);else{r=new Map;for(const [c,g]of b){var q=[];for(const v of g)b=A.tileCoordChange(this.tileCoordRange,v.xTile,e.level,e.col,h.key.level,h.key.col),d=A.tileCoordChange(this.tileCoordRange,v.yTile,e.level,e.row,h.key.level,h.key.row),0<=b&&b<this.tileCoordRange&&0<=d&&d<this.tileCoordRange&&q.push({symbol:v,xTransformed:b,yTransformed:d});b=[];d=h.key.level<e.level?1:1<<h.key.level-e.level;
const m=this._tiles.get(h.id).symbols.get(c);if(m){const v=m.flat;for(const z of q){var l=!1;let D;const E=z.xTransformed,w=z.yTransformed;D=u.isSome(m.index)?m.index.getCell(E,w):v;q=z.symbol;const F=q.hash;for(const J of D)if(F===J.hash&&Math.abs(E-J.xTile)<=d&&Math.abs(w-J.yTile)<=d){l=J.unique;q.unique=l;l.tileSymbols.push(q);l=!0;break}l||b.push(q)}}0<b.length&&r.set(c,b)}for(const c of h.childrenTiles)this._matchSymbols(c,e,r)}};p._createUniqueSymbolLayerArray=function(){var h=this._uniqueSymbolsReferences;
const e=Array(h.size);let b=0;for(const [d,r]of h){const q=Array(r.size);h=0;for(const l of r)q[h++]=l;e[b]={styleLayerUID:d,uniqueSymbols:q};b++}return e};B._createClass(f,[{key:"uniqueSymbols",get:function(){u.isNone(this._uniqueSymbolLayerArray)&&(this._uniqueSymbolLayerArray=this._createUniqueSymbolLayerArray());return this._uniqueSymbolLayerArray}}]);return f}();y.SymbolRepository=k;Object.defineProperty(y,"__esModule",{value:!0})})},"esri/views/2d/tiling/TileInfoViewPOT":function(){define(["../../../chunks/_rollupPluginBabelHelpers",
"../../../layers/support/TileInfo","./TileKey","./TileInfoView"],function(y,B,u,A){return function(k){function f(){var h=k.apply(this,arguments)||this;h._fullCacheLodInfos=null;h._levelByScale={};return h}y._inheritsLoose(f,k);var p=f.prototype;p.getTileParentId=function(h){h=u.pool.acquire(h);const e=0===h.level?null:u.getId(h.level-1,h.row>>1,h.col>>1,h.world);u.pool.release(h);return e};p.getTileCoverage=function(h,e,b){h=k.prototype.getTileCoverage.call(this,h,e,b);if(!h)return h;const d=1<<h.lodInfo.level;
h.spans=h.spans.filter(r=>0<=r.row&&r.row<d);return h};p.scaleToLevel=function(h){this._fullCacheLodInfos||this._initializeFullCacheLODs(this._lodInfos);if(this._levelByScale[h])return this._levelByScale[h];{var e=this._fullCacheLodInfos;if(h>e[0].scale)return e[0].level;let b;for(let d=0;d<e.length-1;d++)if(b=e[d+1],h>b.scale)return e=e[d],e.level+(e.scale-h)/(e.scale-b.scale);return e[e.length-1].level}};p._initializeFullCacheLODs=function(h){h=0===h[0].level?h.map(e=>({level:e.level,resolution:e.resolution,
scale:e.scale})):B.create({size:this.tileInfo.size[0],spatialReference:this.tileInfo.spatialReference}).lods.map(e=>({level:e.level,resolution:e.resolution,scale:e.scale}));for(let e=0;e<h.length;e++)this._levelByScale[h[e].scale]=h[e].level;this._fullCacheLodInfos=h};return f}(A)})},"*noref":1}});
define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/has ../../../core/maybe ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/property ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../core/Error ../../../core/urlUtils ../../../core/uuid ../../../portal/support/resourceExtension ../../../core/promiseUtils ../../../Graphic ../../../core/Handles ../../../core/accessorSupport/diffUtils ../../../geometry/support/aaBoundingRect ../engine/vectorTiles/style/StyleRepository ../tiling/TileQueue ../engine/vectorTiles/VectorTile ../../layers/LayerView ./LayerView2D ../engine/vectorTiles/TileHandler ../engine/vectorTiles/TileManager ../engine/vectorTiles/VectorTileContainer ../tiling/TileInfoViewPOT".split(" "),function(y,
B,u,A,k,f,p,h,e,b,d,r,q,l,c,g,m,v,z,D,E,w,F,J,L,I,K){function G(Q){if(A.isNone(Q))return 0;switch(Q.type){case "partial":return Object.keys(Q.diff).length;case "complete":return Math.max(Object.keys(Q.oldValue).length,Object.keys(Q.newValue).length);case "collection":return Object.keys(Q.added).length+Object.keys(Q.changed).length+Object.keys(Q.removed).length}}const M=k.getLogger("esri.views.2d.layers.VectorTileLayerView2D");u=function(Q){function R(){var C=Q.apply(this,arguments)||this;C._styleChanges=
[];C._handles=new g;C._fetchQueue=null;C._parseQueue=null;C._isTileHandlerReady=!1;C.fading=!1;return C}y._inheritsLoose(R,Q);var O=R.prototype;O.initialize=function(){const C=this.layer.tileInfo;if((C&&C.spatialReference).equals(this.view.spatialReference)){var {style:N,spriteUrl:P,glyphsUrl:T}=this.layer.currentStyleInfo;this._styleRepository=new z(N,{spriteUrl:P,glyphsUrl:T});this._tileInfoView=new K(this.layer.tileInfo,this.layer.fullExtent);this._vectorTileContainer=new I.VectorTileContainer(this._tileInfoView);
this._tileHandler=new J.TileHandler(this.layer,this._styleRepository,window.devicePixelRatio||1,null);this.container.addChild(this._vectorTileContainer);this.handles.add([this._vectorTileContainer.on("fade-start",()=>{this.fading=!0}),this._vectorTileContainer.on("fade-complete",()=>{this.fading=!1;this.requestUpdate()})])}else this.addResolvingPromise(l.reject(new b("layerview:spatial-reference-incompatible","The spatial reference of this layer does not meet the requirements of the view",{layer:this.layer})))};
O.destroy=function(){var C;this._stop();this.container.removeAllChildren();this._vectorTileContainer&&(this._vectorTileContainer.destroy(),this._vectorTileContainer=null);null==(C=this._tileHandler)?void 0:C.destroy();this._tileHandler=null};O.hitTest=async function(C,N){if(this.suspended||!this._tileHandlerPromise)return null;await this._tileHandlerPromise;C=await this._vectorTileContainer.hitTest(C,N);if(!C||0===C.length)return null;C=C[0]-1;var P=this._styleRepository;N=P.getStyleLayerByUID(C);
if(!N)return null;P=P.getStyleLayerIndex(N.id);C=new c({attributes:{layerId:P,layerName:N.id,layerUID:C}});C.layer=this.layer;C.sourceLayer=this.layer;return C};O.update=function(C){this._tileHandlerPromise&&this._isTileHandlerReady&&(C.pixelRatio!==this._tileHandler.devicePixelRatio?(this._start(),this._tileHandler.devicePixelRatio=C.pixelRatio):0<this._styleChanges.length?this._tileHandlerPromise=this._applyStyleChanges():(this._fetchQueue.pause(),this._parseQueue.pause(),this._fetchQueue.state=
C.state,this._parseQueue.state=C.state,this._tileManager.update(C)||this.requestUpdate(),this._parseQueue.resume(),this._fetchQueue.resume()))};O.attach=function(){this._start();this._handles.add([this.layer.on("paint-change",C=>{if(C.isDataDriven)this._styleChanges.push({type:0,data:C}),this.notifyChange("updating"),this.requestUpdate();else{const P=this._styleRepository;var N=P.getLayerById(C.layerName);N&&(N=3===N.type,P.setPaintProperties(C.layerName,C.paint),N&&this._vectorTileContainer.restartDeclutter(),
this._vectorTileContainer.requestRender())}}),this.layer.on("layout-change",C=>{const N=this._styleRepository,P=N.getLayerById(C.layer);if(P){var T=m.diff(P.layout,C.layout);A.isNone(T)||(m.hasDiff(T,"visibility")&&1===G(T)?(N.setLayoutProperties(C.layer,C.layout),3===P.type&&this._vectorTileContainer.restartDeclutter(),this._vectorTileContainer.requestRender()):(this._styleChanges.push({type:1,data:C}),this.notifyChange("updating"),this.requestUpdate()))}}),this.layer.on("style-layer-visibility-change",
C=>{const N=this._styleRepository,P=N.getLayerById(C.layer);P&&(N.setStyleLayerVisibility(C.layer,C.visibility),3===P.type&&this._vectorTileContainer.restartDeclutter(),this._vectorTileContainer.requestRender())}),this.layer.on("style-layer-change",C=>{this._styleChanges.push({type:2,data:C});this.notifyChange("updating");this.requestUpdate()}),this.layer.on("delete-style-layer",C=>{this._styleChanges.push({type:3,data:C});this.notifyChange("updating");this.requestUpdate()}),this.layer.on("load-style",
()=>this._loadStyle())])};O.detach=function(){this._stop();this._handles.removeAll()};O.moveStart=function(){this.requestUpdate()};O.viewChange=function(){this.requestUpdate()};O.moveEnd=function(){this.requestUpdate()};O.canResume=function(){let C=Q.prototype.canResume.call(this);var N=this.layer;if(C&&N.currentStyleInfo){const P=this.view.scale;(N=N.currentStyleInfo)&&N.layerDefinition&&(N=N.layerDefinition,N.minScale&&N.minScale<P&&(C=!1),N.maxScale&&N.maxScale>P&&(C=!1))}return C};O.isUpdating=
function(){const C=this._vectorTileContainer.children;return!this._isTileHandlerReady||!this._fetchQueue||!this._parseQueue||this._fetchQueue.updating||this._parseQueue.updating||0<C.length&&0<C.filter(N=>N.invalidating).length||this.fading};O.acquireTile=function(C){const N=this._createVectorTile(C);this._tileHandlerPromise.then(()=>{this._fetchQueue.push(N.key).then(P=>this._parseQueue.push({key:N.key,data:P})).then(P=>{N.once("attach",()=>this.requestUpdate());P&&(N.setData(P.tileData),this.requestUpdate(),
this.notifyChange("updating"))}).catch(P=>{this.notifyChange("updating");l.isAbortError(P)||M.error(P)})});return N};O.releaseTile=function(C){C=C.key.id;this._fetchQueue.abort(C);this._parseQueue.abort(C);this.requestUpdate()};O._start=function(){this._stop();this._tileManager=new L.TileManager({acquireTile:P=>this.acquireTile(P),releaseTile:P=>this.releaseTile(P),tileInfoView:this._tileInfoView},this._vectorTileContainer);if(this.layer.currentStyleInfo){var C=new AbortController,N=this._tileHandler.start({signal:C.signal}).then(()=>
{this._fetchQueue=new D({tileInfoView:this._tileInfoView,process:(P,T)=>this._getTileData(P,T),concurrency:15});this._parseQueue=new D({tileInfoView:this._tileInfoView,process:(P,T)=>this._parseTileData(P,T),concurrency:8});this.requestUpdate();this._isTileHandlerReady=!0});this._tileHandler.spriteMosaic.then(P=>{this._vectorTileContainer.setStyleResources(P,this._tileHandler.glyphMosaic,this._styleRepository);this.requestUpdate()});this._tileHandlerAbortController=C;this._tileHandlerPromise=N}};
O._stop=function(){if(this._tileHandlerAbortController&&this._vectorTileContainer){var C=this._tileHandlerAbortController;C&&C.abort();this._tileHandlerPromise=null;this._isTileHandlerReady=!1;this._fetchQueue&&(this._fetchQueue.destroy(),this._fetchQueue=null);this._parseQueue&&(this._parseQueue.destroy(),this._parseQueue=null);this._tileManager&&(this._tileManager.destroy(),this._tileManager=null);this._vectorTileContainer.removeAllChildren()}};O._getTileData=async function(C,N){C=await this._tileHandler.fetchTileData(C,
N);this.notifyChange("updating");return C};O._parseTileData=async function(C,N){return this._tileHandler.parseTileData(C,N)};O._applyStyleChanges=async function(){this._isTileHandlerReady=!1;this._fetchQueue.pause();this._parseQueue.pause();this._fetchQueue.clear();this._parseQueue.clear();this._tileManager.clearCache();var C=this._styleChanges;try{await this._tileHandler.updateStyle(C)}catch(U){M.error("error applying vector-tiles style update",U.message),this._fetchQueue.resume(),this._parseQueue.resume(),
this._isTileHandlerReady=!0}const N=this._styleRepository,P=[];C.forEach(U=>{3===U.type&&(U=N.getLayerById(U.data.layerName))&&P.push(U.uid)});const T=[];let Y;C.forEach(U=>{const X=U.data;switch(U.type){case 0:N.setPaintProperties(X.layer,X.paint);Y=X.layer;break;case 1:N.setLayoutProperties(X.layer,X.layout);Y=X.layer;break;case 3:N.deleteStyleLayer(X.layerName);return;case 2:N.setStyleLayer(X.layer,X.index),Y=X.layer.id}(U=N.getLayerById(Y))&&T.push(U.uid)});C=this._vectorTileContainer.children;
if(0<P.length){this._vectorTileContainer.deleteStyleLayers(P);for(var aa of C)aa.deleteLayerData(P)}this._fetchQueue.resume();this._parseQueue.resume();if(0<T.length){aa=[];for(const U of C)C=this._fetchQueue.push(U.key).then(X=>this._parseQueue.push({key:U.key,data:X,styleLayerUIDs:T})).then(X=>U.setData(X.tileData)),aa.push(C);await l.all(aa)}this._styleChanges=[];this._isTileHandlerReady=!0;this.notifyChange("updating");this.requestUpdate()};O._loadStyle=async function(){const {style:C,spriteUrl:N,
glyphsUrl:P}=this.layer.currentStyleInfo;this._isTileHandlerReady=!1;this._fetchQueue.pause();this._parseQueue.pause();this._fetchQueue.clear();this._parseQueue.clear();this.notifyChange("updating");this._styleRepository=new z(C,{spriteUrl:N,glyphsUrl:P});this._vectorTileContainer.destroy();this._tileManager.clear();this._tileHandlerAbortController.abort();this._tileHandlerAbortController=l.createAbortController();var {signal:T}=this._tileHandlerAbortController;this._tileHandlerPromise=this._tileHandler.setStyle(this._styleRepository,
C);await this._tileHandlerPromise;T.aborted||(T=await this._tileHandler.spriteMosaic,this._vectorTileContainer.setStyleResources(T,this._tileHandler.glyphMosaic,this._styleRepository));this._fetchQueue.resume();this._parseQueue.resume();this._isTileHandlerReady=!0;this.notifyChange("updating");this.requestUpdate()};O._createVectorTile=function(C){const N=this._tileInfoView.getTileBounds(v.create(),C);return new E.VectorTile(C,this._styleRepository,N,[512,512])};return R}(F.LayerView2DMixin(w));B.__decorate([p.property()],
u.prototype,"_fetchQueue",void 0);B.__decorate([p.property()],u.prototype,"_parseQueue",void 0);B.__decorate([p.property()],u.prototype,"_isTileHandlerReady",void 0);B.__decorate([p.property({dependsOn:["view.scale","layer.currentStyleInfo"]})],u.prototype,"suspended",void 0);B.__decorate([p.property()],u.prototype,"fading",void 0);B.__decorate([p.property({dependsOn:["_isTileHandlerPromiseFulfilled","_parseQueue.updating","_parseQueue.updating","fading"]})],u.prototype,"updating",void 0);return u=
B.__decorate([e.subclass("esri.views.2d.layers.VectorTileLayerView2D")],u)});