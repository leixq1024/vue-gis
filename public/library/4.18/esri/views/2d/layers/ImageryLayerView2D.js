// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.18/esri/copyright.txt for details.
//>>built
require({cache:{"esri/views/layers/ImageryLayerView":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/has ../../core/maybe ../../core/Logger ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/property ../../core/jsonMap ../../core/accessorSupport/decorators/subclass ../../core/Error ../../core/urlUtils ../../core/uuid ../../portal/support/resourceExtension ../../core/promiseUtils ../../geometry/Point ../../layers/support/commonProperties ../../tasks/support/Query ./support/popupUtils".split(" "),
function(B,y,w,F,I,A,E,H,L,N,K,D,b,h,f,l,r,v,t){B.ImageryLayerView=m=>{m=function(a){function c(){var g=a.apply(this,arguments)||this;g.view=null;return g}y._inheritsLoose(c,a);var e=c.prototype;e.fetchPopupFeatures=async function(g,k){const {layer:d}=this;if(!g)return f.reject(new K("imagerylayerview:fetchPopupFeatures","Nothing to fetch without area",{layer:d}));var {popupEnabled:n}=d;k=t.getFetchPopupTemplate(d,k);if(!n||!I.isSome(k))throw new K("imagerylayerview:fetchPopupFeatures","Missing required popupTemplate or popupEnabled",
{popupEnabled:n,popupTemplate:k});const p=await k.getRequiredFields();n=new v;n.geometry=g;n.outFields=p;n.outSpatialReference=g.spatialReference;g=this.view.resolution;g="2d"===this.view.type?new l(g,g,this.view.spatialReference):new l(.5*g,.5*g,this.view.spatialReference);const {returnTopmostRaster:q,showNoDataRecords:u}=k.layerOptions||{returnTopmostRaster:!0,showNoDataRecords:!1};return d.queryVisibleRasters(n,{returnDomainValues:!0,returnTopmostRaster:q,pixelSize:g,showNoDataRecords:u}).then(z=>
z)};e.canResume=function(){var g;return!a.prototype.canResume.call(this)||null!=(g=this.timeExtent)&&g.isEmpty?!1:!0};return c}(m);w.__decorate([H.property()],m.prototype,"layer",void 0);w.__decorate([H.property({dependsOn:["timeExtent"]})],m.prototype,"suspended",void 0);w.__decorate([H.property(r.combinedViewLayerTimeExtentProperty)],m.prototype,"timeExtent",void 0);w.__decorate([H.property()],m.prototype,"view",void 0);return m=w.__decorate([N.subclass("esri.views.layers.ImageryLayerView")],m)};
Object.defineProperty(B,"__esModule",{value:!0})})},"esri/views/layers/support/popupUtils":function(){define(["exports","../../../core/maybe","../../../layers/support/fieldUtils"],function(B,y,w){B.getFetchPopupTemplate=function(F,I){return F.popupTemplate?F.popupTemplate:y.isSome(I)&&I.defaultPopupTemplateEnabled&&y.isSome(F.defaultPopupTemplate)?F.defaultPopupTemplate:null};B.getRequiredFields=async function(F,I=F.popupTemplate){if(!y.isSome(I))return[];const A=await I.getRequiredFields(F.fields);
({lastEditInfoEnabled:I}=I);const {objectIdField:E,typeIdField:H,globalIdField:L,relationships:N}=F;if(A.includes("*"))return["*"];I=I?await w.getFeatureEditFields(F):[];const K=w.fixFields(F.fields,[...A,...I]);H&&K.push(H);K&&E&&w.hasField(F.fields,E)&&-1===K.indexOf(E)&&K.push(E);K&&L&&w.hasField(F.fields,L)&&-1===K.indexOf(L)&&K.push(L);N&&N.forEach(D=>{({keyField:D}=D);K&&D&&w.hasField(F.fields,D)&&-1===K.indexOf(D)&&K.push(D)});return K};Object.defineProperty(B,"__esModule",{value:!0})})},"esri/views/2d/layers/LayerView2D":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/has ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/property ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../core/urlUtils ../../../core/uuid ../../../portal/support/resourceExtension ../../../core/Collection ../../../core/collectionUtils ../../../core/watchUtils ../../layers/support/ClipArea ../../layers/support/ClipRect ../engine/Container ../../layers/support/Geometry ../../layers/support/Path".split(" "),
function(B,y,w,F,I,A,E,H,L,N,K,D,b,h,f,l,r,v,t,m){const a=b.ofType({key:"type",base:l,typeMap:{rect:r,path:m,geometry:t}});B.LayerView2DMixin=c=>{c=function(e){function g(){var d=e.apply(this,arguments)||this;d.clips=new a;d.moving=!1;d.attached=!1;d.lastUpdateId=-1;d.updateRequested=!1;return d}y._inheritsLoose(g,e);var k=g.prototype;k.initialize=function(){var d;this.container||(this.container=new v.Container);this.container.fadeTransitionEnabled=!0;this.container.opacity=0;this.container.clips=
this.clips;this.handles.add([f.init(this,"suspended",n=>{this.container&&(this.container.visible=!n);this.view&&!n&&this.updateRequested&&this.view.requestUpdate()},!0),f.init(this,["layer.opacity","container"],()=>{if(this.container){var n,p;this.container.opacity=null!=(n=null==(p=this.layer)?void 0:p.opacity)?n:1}},!0),f.init(this,["layer.blendMode"],n=>{this.container&&(this.container.blendMode=n)},!0),f.init(this,["layer.effect"],n=>{this.container&&(this.container.effect=n)},!0),this.clips.on("change",
()=>{this.container.clips=this.clips;this.notifyChange("clips")})]);null!=(d=this.view)&&d.whenLayerView?this.view.whenLayerView(this.layer).then(n=>{n!==this||this.attached||this.destroyed||(this.attach(),this.requestUpdate(),this.attached=!0)},()=>{}):this.when().then(()=>{this.attached||this.destroyed||(this.attach(),this.requestUpdate(),this.attached=!0)},()=>{})};k.destroy=function(){this.attached&&(this.detach(),this.attached=!1);this.handles.remove("initialize");this.updateRequested=!1};k.isVisibleAtScale=
function(d){var n=!0,p=this.layer;const q=p.minScale;p=p.maxScale;if(null!=q&&null!=p){n=!q;let u=!p;!n&&d<=q&&(n=!0);!u&&d>=p&&(u=!0);n=n&&u}return n};k.requestUpdate=function(){this.updateRequested||(this.updateRequested=!0,this.suspended||this.view.requestUpdate())};k.processUpdate=function(d){this.isFulfilled()&&!this.isResolved()?this.updateRequested=!1:(this._set("updateParameters",d),this.updateRequested&&!this.suspended&&(this.updateRequested=!1,this.update(d)))};k.isUpdating=function(){return!1};
k.isRendering=function(){return!1};k.canResume=function(){return e.prototype.canResume.call(this)?this.isVisibleAtScale(this.view.scale):!1};y._createClass(g,[{key:"updating",get:function(){return!this.attached||!this.suspended&&(this.updateRequested||this.isUpdating())}}]);return g}(c);w.__decorate([E.property({type:a,set(e){e=h.referenceSetter(e,this._get("clips"),a);this._set("clips",e)}})],c.prototype,"clips",void 0);w.__decorate([E.property()],c.prototype,"moving",void 0);w.__decorate([E.property()],
c.prototype,"attached",void 0);w.__decorate([E.property()],c.prototype,"container",void 0);w.__decorate([E.property({dependsOn:["view.scale","layer.minScale","layer.maxScale"]})],c.prototype,"suspended",void 0);w.__decorate([E.property({readOnly:!0})],c.prototype,"updateParameters",void 0);w.__decorate([E.property()],c.prototype,"updateRequested",void 0);w.__decorate([E.property({dependsOn:["attached","updateRequested","suspended"]})],c.prototype,"updating",null);w.__decorate([E.property()],c.prototype,
"view",void 0);return c=w.__decorate([L.subclass("esri.views.2d.layers.LayerView2D")],c)};Object.defineProperty(B,"__esModule",{value:!0})})},"esri/views/layers/support/ClipArea":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/has ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/property ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../core/urlUtils ../../../core/uuid ../../../portal/support/resourceExtension ../../../core/JSONSupport".split(" "),
function(B,y,w,F,I,A,E,H,L,N,K,D){w=function(b){function h(){return b.apply(this,arguments)||this}B._inheritsLoose(h,b);return h}(D.JSONSupport);return w=y.__decorate([H.subclass("esri.views.layers.support.ClipArea")],w)})},"esri/views/layers/support/ClipRect":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/has ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/property ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../core/urlUtils ../../../core/uuid ../../../portal/support/resourceExtension ./ClipArea".split(" "),
function(B,y,w,F,I,A,E,H,L,N,K,D){var b;w=b=function(h){function f(){var l=h.apply(this,arguments)||this;l.type="rect";l.left=null;l.right=null;l.top=null;l.bottom=null;return l}B._inheritsLoose(f,h);f.prototype.clone=function(){return new b({left:this.left,right:this.right,top:this.top,bottom:this.bottom})};B._createClass(f,[{key:"version",get:function(){return(this._get("version")||0)+1}}]);return f}(D);y.__decorate([A.property({type:[Number,String],json:{write:!0}})],w.prototype,"left",void 0);
y.__decorate([A.property({type:[Number,String],json:{write:!0}})],w.prototype,"right",void 0);y.__decorate([A.property({type:[Number,String],json:{write:!0}})],w.prototype,"top",void 0);y.__decorate([A.property({type:[Number,String],json:{write:!0}})],w.prototype,"bottom",void 0);y.__decorate([A.property({readOnly:!0,dependsOn:["left","right","top","bottom"]})],w.prototype,"version",null);return w=b=y.__decorate([H.subclass("esri.views.layers.support.ClipRect")],w)})},"esri/views/layers/support/Geometry":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/has ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/property ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../core/urlUtils ../../../core/uuid ../../../portal/support/resourceExtension ../../../geometry/Geometry ../../../geometry/Extent ../../../geometry/Polygon ../../../geometry/support/jsonUtils ../../../geometry ./ClipArea".split(" "),
function(B,y,w,F,I,A,E,H,L,N,K,D,b,h,f,l,r){var v;w={base:D,key:"type",typeMap:{extent:b,polygon:h}};r=v=function(t){function m(){var a=t.apply(this,arguments)||this;a.type="geometry";a.geometry=null;return a}B._inheritsLoose(m,t);m.prototype.clone=function(){return new v({geometry:this.geometry.clone()})};B._createClass(m,[{key:"version",get:function(){return(this._get("version")||0)+1}}]);return m}(r);y.__decorate([A.property({types:w,json:{read:f.fromJSON,write:!0}})],r.prototype,"geometry",void 0);
y.__decorate([A.property({readOnly:!0,dependsOn:["geometry"]})],r.prototype,"version",null);return r=v=y.__decorate([H.subclass("esri.views.layers.support.Geometry")],r)})},"esri/views/layers/support/Path":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/has ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/property ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../core/urlUtils ../../../core/uuid ../../../portal/support/resourceExtension ./ClipArea".split(" "),
function(B,y,w,F,I,A,E,H,L,N,K,D){w=function(b){function h(){var f=b.apply(this,arguments)||this;f.type="path";f.path=[];return f}B._inheritsLoose(h,b);B._createClass(h,[{key:"version",get:function(){return(this._get("version")||0)+1}}]);return h}(D);y.__decorate([A.property({type:[[[Number]]],json:{write:!0}})],w.prototype,"path",void 0);y.__decorate([A.property({readOnly:!0,dependsOn:["path"]})],w.prototype,"version",null);return w=y.__decorate([H.subclass("esri.views.layers.support.Path")],w)})},
"esri/views/2d/layers/imagery/ImageryGraphicsView2D":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/has ../../../../core/Logger ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/decorators/enumeration ../../../../core/accessorSupport/decorators/subclass ../../../../core/urlUtils ../../../../core/uuid ../../../../portal/support/resourceExtension ../../../../core/promiseUtils ../../../../geometry/Extent ../../../../core/screenUtils ../../../../Graphic ../../../../support/GraphicsCollection ../../../layers/LayerView ../../engine/Container ../graphics/GraphicsView2D ../LayerView2D".split(" "),
function(B,y,w,F,I,A,E,H,L,N,K,D,b,h,f,l,r,v,t,m){const a=F.getLogger("esri.views.2d.layers.imagery.ImageryGraphicsView2D");w=function(c){function e(){var k=c.apply(this,arguments)||this;k.container=new v.Container;k._graphicsView=null;k.type="Graphics";k._graphics=new l["default"];k._updateGraphics=D.debounce(async(d,n)=>{if(d.stationary){var p=d.state,q=new b({xmin:p.extent.xmin,ymin:p.extent.ymin,xmax:p.extent.xmax,ymax:p.extent.ymax,spatialReference:p.spatialReference}),u=d.state.size[0],z=d.state.size[1];
p={};p.timeExtent=k.timeExtent;p.requestAsImageElement=!1;p.signal=n;n=k._getVectorFieldExportParams({extent:q,width:u,height:z});p=await k.layer.fetchImage(n.extent,n.width,n.height,p);q=k.layer.renderer;if("vector-field"===q.type){k._pixelData={extent:n.extent,pixelBlock:p.pixelData.pixelBlock};const x=await q.getGraphicsFromPixelData(p.pixelData,"vector-uv"===k.layer.rasterInfo.dataType);k._graphicsView.update(d);await D.after(0).then(()=>{k._graphics.set("items",x)})}}});return k}B._inheritsLoose(e,
c);var g=e.prototype;g.update=function(k){this._updateGraphics(k).catch(d=>{D.isAbortError(d)||a.error(d)})};g.hitTest=function(k,d){if(this.suspended)return D.resolve(null);k=this.view.toMap(h.createScreenPoint(k,d));return D.resolve(new f({attributes:{},geometry:k,layer:this.layer}))};g.attach=function(){this._graphicsView=new t({view:this.view,graphics:this._graphics,requestUpdateCallback:()=>this.requestUpdate()})};g.detach=function(){this._graphics.destroy();this._graphicsView.destroy();this.container.removeChild(this._graphicsView.container);
this._graphicsView=null};g.moveStart=function(){};g.viewChange=function(){};g.moveEnd=function(){};g.install=function(k){this.container.addChild(this._graphicsView.container);k.addChild(this.container)};g.uninstall=function(k){this.container.removeChild(this._graphicsView.container);k.removeChild(this.container)};g.isUpdating=function(){return this._graphicsView.updating||this.updateRequested};g.getPixelData=function(){return this.updating?null:this._pixelData};g.redraw=function(){};g._getVectorFieldExportParams=
function(k){var d,n;let {extent:p,width:q,height:u}=k;const z=this.layer;k=null==(d=z.fullExtent)?void 0:d.xmin;d=null==(n=z.fullExtent)?void 0:n.ymax;if("vector-field"===z.renderer.type)var x=z.renderer.symbolTileSize;x=Math.max(x||0,30);q=Math.ceil(1/x*q);u=Math.ceil(1/x*u);n=(p.xmax-p.xmin)/q;x=(p.ymax-p.ymin)/u;p.xmin=k+Math.floor((p.xmin-k)/n)*n;p.xmax=k+Math.ceil((p.xmax-k)/n)*n;p.ymin=d+Math.floor((p.ymin-d)/x)*x;p.ymax=d+Math.ceil((p.ymax-d)/x)*x;return{extent:p,width:q,height:u}};B._createClass(e,
[{key:"updating",get:function(){var k;return null==(k=this._graphicsView)?void 0:k.updating}}]);return e}(m.LayerView2DMixin(r));y.__decorate([A.property()],w.prototype,"container",void 0);y.__decorate([A.property()],w.prototype,"layer",void 0);y.__decorate([A.property()],w.prototype,"timeExtent",void 0);y.__decorate([A.property({dependsOn:["_graphicsView.updating"]})],w.prototype,"updating",null);y.__decorate([A.property()],w.prototype,"_graphicsView",void 0);y.__decorate([E.enumeration({graphics:"Graphics"})],
w.prototype,"type",void 0);return w=y.__decorate([H.subclass("esri.views.2d.layers.imagery.ImageryGraphicsView2D")],w)})},"esri/views/2d/layers/imagery/ImageryView2D":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/has ../../../../core/Logger ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/decorators/enumeration ../../../../core/accessorSupport/decorators/subclass ../../../../core/urlUtils ../../../../core/uuid ../../../../portal/support/resourceExtension ../../../../core/promiseUtils ../../../../core/screenUtils ../../../../Graphic ../../../../layers/support/rasterFunctions/pixelUtils ../../../layers/LayerView ../../engine/Container ../../engine/ImageryBitmapSource ../../engine/BitmapContainer ../LayerView2D ../support/ExportStrategy".split(" "),
function(B,y,w,F,I,A,E,H,L,N,K,D,b,h,f,l,r,v,t,m,a){const c=F.getLogger("esri.views.2d.layers.imagery.ImageryView2D");w=function(e){function g(){var d=e.apply(this,arguments)||this;d.container=new r.Container;d.type="Imagery";d._bitmapView=null;return d}B._inheritsLoose(g,e);var k=g.prototype;k.update=function(d){this.strategy.update(d).catch(n=>{D.isAbortError(n)||c.error(n)})};k.detach=function(){this.strategy.destroy();this._bitmapView.removeAllChildren();this.container.removeAllChildren()};k.hitTest=
function(d,n){if(this.suspended)return D.resolve(null);d=this.view.toMap(b.createScreenPoint(d,n));return D.resolve(new h({attributes:{},geometry:d,layer:this.layer}))};k.attach=function(){const d=10<=this.layer.version,n=10.1<=this.layer.version?this.layer.imageMaxHeight:2048,p=10.1<=this.layer.version?this.layer.imageMaxWidth:2048;this._bitmapView=new t.BitmapContainer;this.strategy=new a({container:this._bitmapView,imageNormalizationSupported:d,imageMaxHeight:n,imageMaxWidth:p,fetchSource:this._fetchImage.bind(this),
requestUpdate:()=>this.requestUpdate()})};k.moveStart=function(){};k.viewChange=function(){};k.moveEnd=function(){};k.install=function(d){this.container.addChild(this._bitmapView);d.addChild(this.container)};k.uninstall=function(d){this.container.removeChild(this._bitmapView);d.removeChild(this.container)};k.redraw=function(){this.strategy.updateExports(d=>{d.source instanceof HTMLImageElement?d.requestRender():this.layer.applyRenderer({pixelBlock:d.source.pixelBlock}).then(n=>{const p=d.source;p.pixelBlock=
n.pixelBlock;p.filter=q=>this.layer.applyFilter(q);this.container.requestRender()})})};k.isUpdating=function(){return this.strategy.updating||this.updateRequested};k.getPixelData=function(){if(this.updating)return null;var d=this.strategy.container.children;if(1===d.length&&d[0].source)return{extent:d[0].source.extent,pixelBlock:d[0].source.originalPixelBlock};if(1<d.length){const n=this.view.extent;d=d.map(p=>p.source).filter(p=>p.extent&&p.extent.intersects(n)).map(p=>({extent:p.extent,pixelBlock:p.originalPixelBlock}));
return(d=f.mosaicPixelData(d,n))?{extent:d.extent,pixelBlock:d.pixelBlock}:null}return null};k._fetchImage=function(d,n,p,q){q=q||{};q.timeExtent=this.timeExtent;q.requestAsImageElement=!0;return this.layer.fetchImage(d,n,p,q).then(u=>u.imageElement?u.imageElement:this.layer.applyRenderer(u.pixelData,{signal:q.signal}).then(z=>{z=new v(z.pixelBlock,z.extent.clone(),u.pixelData.pixelBlock);z.filter=x=>this.layer.applyFilter(x);return z}))};B._createClass(g,[{key:"updating",get:function(){var d;return null==
(d=this.strategy)?void 0:d.updating}}]);return g}(m.LayerView2DMixin(l));y.__decorate([A.property()],w.prototype,"container",void 0);y.__decorate([A.property()],w.prototype,"layer",void 0);y.__decorate([A.property()],w.prototype,"strategy",void 0);y.__decorate([A.property()],w.prototype,"timeExtent",void 0);y.__decorate([A.property({dependsOn:["strategy.updating"]})],w.prototype,"updating",null);y.__decorate([E.enumeration({imagery:"Imagery"})],w.prototype,"type",void 0);return w=y.__decorate([H.subclass("esri.views.2d.layers.imagery.ImageryView2D")],
w)})},"esri/layers/support/rasterFunctions/pixelUtils":function(){define(["exports","../PixelBlock"],function(B,y){function w(b,h){b=Math.min(Math.max(b,-100),100);h=Math.min(Math.max(h,-100),100);let f,l;const r=new Uint8Array(256);for(f=0;256>f;f++)0<b&&100>b?l=(200*f-25500+510*h)/(2*(100-b))+128:0>=b&&-100<b?l=(200*f-25500+510*h)*(100+b)/2E4+128:100===b?(l=200*f-25500+256*(100-b)+510*h,l=0<l?255:0):-100===b&&(l=128),r[f]=255<l?255:0>l?0:l;return r}function F(b,h,f,l,r,v,t,m){return{xmin:r<=f*b?
0:r<f*b+b?r-f*b:b,ymin:v<=l*h?0:v<l*h+h?v-l*h:h,xmax:r+t<=f*b?0:r+t<f*b+b?r+t-f*b:b,ymax:v+m<=l*h?0:v+m<l*h+h?v+m-l*h:h}}function I(b,h,f,l){var r=b.filter(O=>D(O))[0];if(null==r)return null;const v=l?l.width:h.width;l=l?l.height:h.height;const t=r.width,m=r.height,a=h.width/t;h=h.height/m;const c=f?f.x:0;f=f?f.y:0;const e=r.pixelType;var g=y.getPixelArrayConstructor(e);const k=r.pixels.length;r=[];let d,n;var p;let q,u,z,x,C,G,J;for(u=0;u<k;u++){n=new g(v*l);for(z=0;z<h;z++)for(x=0;x<a;x++)if(p=
b[z*a+x])for(d=p.pixels[u],J=F(t,m,x,z,c,f,v,l),C=J.ymin;C<J.ymax;C++)for(p=(z*m+C-f)*v+(x*t-c),q=C*t,G=J.xmin;G<J.xmax;G++)n[p+G]=d[q+G];r.push(n)}let M;if(b.some(O=>null==O||O.mask&&0<O.mask.length))for(M=new Uint8Array(v*l),z=0;z<h;z++)for(x=0;x<a;x++)if(g=(p=b[z*a+x])?p.mask:null,J=F(t,m,x,z,c,f,v,l),g)for(C=J.ymin;C<J.ymax;C++)for(p=(z*m+C-f)*v+(x*t-c),q=C*t,G=J.xmin;G<J.xmax;G++)M[p+G]=g[q+G];else if(p)for(C=J.ymin;C<J.ymax;C++)for(p=(z*m+C-f)*v+(x*t-c),q=C*t,G=J.xmin;G<J.xmax;G++)M[p+G]=1;
else for(C=J.ymin;C<J.ymax;C++)for(p=(z*m+C-f)*v+(x*t-c),q=C*t,G=J.xmin;G<J.xmax;G++)M[p+G]=0;b=new y({width:v,height:l,pixels:r,pixelType:e,mask:M});b.updateStatistics();return b}function A(b){if(!D(b))return null;const h=b.clone(),{width:f,height:l,pixels:r,mask:v}=b;var t=r[0];b=h.pixels[0];for(let c=2;c<l-1;c++){const e=new Map;for(var m=c-2;m<c+2;m++)for(var a=0;4>a;a++){const g=m*f+a;L(e,t[g],v?v[g]:1)}b[c*f]=E(e);b[c*f+1]=b[c*f+2]=b[c*f];for(m=3;m<f-1;m++)a=(c-2)*f+m+1,L(e,t[a],v?v[a]:1),a=
(c-1)*f+m+1,L(e,t[a],v?v[a]:1),a=c*f+m+1,L(e,t[a],v?v[a]:1),a=(c+1)*f+m+1,L(e,t[a],v?v[a]:1),a=(c-2)*f+m-3,H(e,t[a],v?v[a]:1),a=(c-1)*f+m-3,H(e,t[a],v?v[a]:1),a=c*f+m-3,H(e,t[a],v?v[a]:1),a=(c+1)*f+m-3,H(e,t[a],v?v[a]:1),b[c*f+m]=E(e);b[c*f+m+1]=b[c*f+m]}for(t=0;t<f;t++)b[t]=b[f+t]=b[2*f+t],b[(l-1)*f+t]=b[(l-2)*f+t];h.updateStatistics();return h}function E(b){if(0===b.size)return 0;let h=0,f=-1,l=0;const r=b.keys();let v=r.next();for(;!v.done;)l=b.get(v.value),l>h&&(f=v.value,h=l),v=r.next();return f}
function H(b,h,f){0!==f&&(f=b.get(h),1===f?b.delete(h):b.set(h,f-1))}function L(b,h,f){0!==f&&b.set(h,b.has(h)?b.get(h)+1:1)}function N(b,h,f){let {x:l,y:r}=h;const {width:v,height:t}=f;if(0===l&&0===r&&t===b.height&&v===b.width)return b;const {width:m,height:a}=b;h=Math.max(0,r);const c=Math.max(0,l),e=Math.min(l+v,m),g=Math.min(r+t,a);if(0>e||0>g||!D(b))return null;l=Math.max(0,-l);r=Math.max(0,-r);const {pixels:k,mask:d}=b;var n=v*t,p=k.length;const q=[];for(var u=0;u<p;u++){var z=k[u],x=y.createEmptyBand(b.pixelType,
n);for(let C=h;C<g;C++){const G=C*m;let J=(C+r-h)*v+l;for(let M=c;M<e;M++)x[J++]=z[G+M]}q.push(x)}n=new Uint8Array(n);for(p=h;p<g;p++)for(u=p*m,z=(p+r-h)*v+l,x=c;x<e;x++)n[z++]=d?d[u+x]:1;b=new y({width:f.width,height:f.height,pixelType:b.pixelType,pixels:q,mask:n});b.updateStatistics();return b}function K(b,h=!0){if(!D(b))return null;const {pixels:f,width:l,height:r,mask:v,pixelType:t}=b;b=[];const m=Math.round(l/2),a=Math.round(r/2),c=r-1,e=l-1;for(var g=0;g<f.length;g++){var k=f[g],d=y.createEmptyBand(t,
m*a),n=0;for(var p=0;p<r;p+=2)for(var q=0;q<l;q+=2){var u=k[p*l+q];if(h){var z=q===e?u:k[p*l+q+1];const x=p===c?u:k[p*l+q+l],C=q===e?x:p===c?z:k[p*l+q+l+1];d[n++]=(u+z+x+C)/4}else d[n++]=u}b.push(d)}g=null;if(v)for(g=new Uint8Array(m*a),k=0,d=0;d<r;d+=2)for(n=0;n<l;n+=2)p=v[d*l+n],h?(q=n===e?p:v[d*l+n+1],u=d===c?p:v[d*l+n+l],z=n===e?u:d===c?q:v[d*l+n+l+1],g[k++]=p*q*u*z?1:0):g[k++]=p;return new y({width:m,height:a,pixelType:t,pixels:b,mask:g})}const D=function(b){return b&&"esri.layers.support.PixelBlock"===
b.declaredClass&&b.pixels&&0<b.pixels.length};B.approximateTransform=function(b,h,f,l,r="nearest"){if(!D(b))return null;"majority"===r&&(b=A(b));const {pixels:v,mask:t,pixelType:m}=b,a=b.width;var c=b.height;b=y.getPixelArrayConstructor(m);var e=v.length;const {width:g,height:k}=h;h=l.cols;var d=l.rows;const n=Math.ceil(g/h),p=Math.ceil(k/d);l=!1;for(var q=0;q<f.length;q+=3)-1===f[q]&&-1===f[q+1]&&-1===f[q+2]&&(l=!0);let u,z,x,C,G,J;const M=new Float32Array(g*k),O=new Float32Array(g*k);q=0;let R,
S;const V="majority"===r?0:.5;for(let T=0;T<p;T++)for(let U=0;U<n;U++){u=12*(T*n+U);r=f[u];z=f[u+1];x=f[u+2];C=f[u+3];G=f[u+4];J=f[u+5];for(var P=0;P<d;P++){q=(T*d+P)*g+U*h;S=(P+.5)/d;for(var Q=0;Q<P;Q++)R=(Q+.5)/h,M[q+Q]=Math.round((r*R+z*S+x)*a-V),O[q+Q]=Math.round((C*R+G*S+J)*c-V)}u+=6;r=f[u];z=f[u+1];x=f[u+2];C=f[u+3];G=f[u+4];J=f[u+5];for(P=0;P<d;P++)for(q=(T*d+P)*g+U*h,S=(P+.5)/d,Q=P;Q<h;Q++)R=(Q+.5)/h,M[q+Q]=Math.round((r*R+z*S+x)*a-V),O[q+Q]=Math.round((C*R+G*S+J)*c-V)}f=(T,U)=>{for(let W=
0;W<k;W++){u=W*g;for(let X=0;X<g;X++)T[u]=0>M[u]||0>O[u]?0:U[M[u]+O[u]*a],u++}};c=[];for(d=0;d<e;d++)h=new b(g*k),f(h,v[d]),c.push(h);b=new y({width:g,height:k,pixelType:m,pixels:c});if(t)b.mask=new Uint8Array(g*k),f(b.mask,t);else if(l)for(b.mask=new Uint8Array(g*k),e=0;e<g*k;e++)b.mask[e]=0>M[e]||0>O[e]?0:1;b.updateStatistics();return b};B.clip=N;B.colorize=function(b,h){if(!D(b)||!h&&(h.indexedColormap||h.indexed2DColormap))return b;const f=b.clone();var l=f.pixels;let r=f.mask;const v=f.width*
f.height;if(1!==l.length)return b;const {indexedColormap:t,indexed2DColormap:m,offset:a,alphaSpecified:c}=h;h=t.length-1;b=0;l=l[0];const e=new Uint8Array(l.length),g=new Uint8Array(l.length),k=new Uint8Array(l.length);let d=0;if(t)if(r)for(b=0;b<v;b++)r[b]&&(d=4*(l[b]-a),d<a||d>h?r[b]=0:(e[b]=t[d],g[b]=t[d+1],k[b]=t[d+2],r[b]=t[d+3]));else{r=new Uint8Array(v);for(b=0;b<v;b++)d=4*(l[b]-a),d<a||d>h?r[b]=0:(e[b]=t[d],g[b]=t[d+1],k[b]=t[d+2],r[b]=t[d+3]);f.mask=r}else if(r)for(b=0;b<v;b++)r[b]&&(h=m[l[b]],
e[b]=h[0],g[b]=h[1],k[b]=h[2],r[b]=h[3]);else{r=new Uint8Array(v);for(b=0;b<v;b++)h=m[l[b]],e[b]=h[0],g[b]=h[1],k[b]=h[2],r[b]=h[3];f.mask=r}f.pixels=[e,g,k];f.statistics=null;f.pixelType="u8";f.maskIsAlpha=c;return f};B.createColormapLUT=function(b){if(b){var h=b.colormap;if(h&&0!==h.length){h=h.sort((c,e)=>c[0]-e[0]);var f=0;0>h[0][0]&&(f=h[0][0]);var l=Math.max(256,h[h.length-1][0]-f+1),r=new Uint8Array(4*l),v=[],t=0,m=0,a=5===h[0].length;if(65536<l)return h.forEach(c=>{v[c[0]-f]=a?c.slice(1):
c.slice(1).concat([255])}),{indexed2DColormap:v,offset:f,alphaSpecified:a};if(b.fillUnspecified)for(b=h[m],t=b[0]-f;t<l;t++)r[4*t]=b[1],r[4*t+1]=b[2],r[4*t+2]=b[3],r[4*t+3]=a?b[4]:255,t===b[0]-f&&(b=m===h.length-1?b:h[++m]);else for(t=0;t<h.length;t++)b=h[t],m=4*(b[0]-f),r[m]=b[1],r[m+1]=b[2],r[m+2]=b[3],r[m+3]=a?b[4]:255;return{indexedColormap:r,offset:f,alphaSpecified:a}}}};B.createContrastBrightnessLUT=w;B.createStretchLUT=function(b){const {minCutOff:h,maxCutOff:f,gamma:l,pixelType:r}=b,v=b.outMin||
0,t=b.outMax||255;if(-1===["u8","u16","s8","s16"].indexOf(r))return null;const m=h.length;let a;let c=0;"s8"===r?c=-127:"s16"===r&&(c=-32767);let e=256;-1<["u16","s16"].indexOf(r)&&(e=65536);const g=[],k=t-v;for(a=0;a<m;a++)g[a]=f[a]-h[a];var d=l&&l.length>=m;const n=[];if(d)for(a=0;a<m;a++)n[a]=1<l[a]?2<l[a]?6.5+Math.pow(l[a]-2,2.5):6.5+100*Math.pow(2-l[a],4):1;let p;const q=[];let u,z,x;if(d)for(a=0;a<m;a++){x=[];for(d=0;d<e;d++)u=d+c,p=(u-h[a])/g[a],z=1,1<l[a]&&(z-=Math.pow(1/k,p*n[a])),x[d]=u<
f[a]&&u>h[a]?Math.floor(z*k*Math.pow(p,1/l[a]))+v:u>=f[a]?t:v;q[a]=x}else for(a=0;a<m;a++){x=[];for(d=0;d<e;d++)u=d+c,x[d]=u<=h[a]?v:u>=f[a]?t:Math.floor((u-h[a])/g[a]*k)+v;q[a]=x}if(null!=b.contrastOffset)for(b=w(b.contrastOffset,b.brightnessOffset),a=0;a<m;a++)for(x=q[a],d=0;d<e;d++)x[d]=b[x[d]];return{lut:q,offset:c}};B.estimateStatisticsFromHistograms=function(b){const h=[];for(let v=0;v<b.length;v++){const {min:t,max:m,size:a,counts:c}=b[v];let e=0;var f=0;for(var l=0;l<a;l++)e+=c[l],f+=l*c[l];
f/=e;l=0;for(var r=0;r<a;r++)l+=c[r]*Math.pow(r-f,2);r=(m-t)/a;h.push({min:t,max:m,avg:(f+.5)*r+t,stddev:Math.sqrt(l/(e-1))*r})}return h};B.estimateStatisticsHistograms=function(b){if(!D(b))return null;b.statistics||b.updateStatistics();const {pixels:h,mask:f,pixelType:l,statistics:r}=b;b=b.width*b.height;const v=h.length;let t,m;let a;var c;const e=[],g=[];for(a=0;a<v;a++){var k=new Uint32Array(256);var d=h[a];if("u8"===l)if(t=-.5,m=255.5,f)for(c=0;c<b;c++)f[c]&&k[d[c]]++;else for(c=0;c<b;c++)k[d[c]]++;
else{t=r[a].minValue;m=r[a].maxValue;var n=(m-t)/256;var p=new Uint32Array(257);if(f)for(c=0;c<b;c++)f[c]&&p[Math.floor((d[c]-t)/n)]++;else for(c=0;c<b;c++)p[Math.floor((d[c]-t)/n)]++;for(c=0;255>c;c++)k[c]=p[c];k[255]=p[255]+p[256]}e.push({min:t,max:m,size:256,counts:k});for(c=d=p=n=0;256>c;c++)n+=k[c],p+=c*k[c];p/=n;for(c=0;256>c;c++)d+=k[c]*Math.pow(c-p,2);k=Math.sqrt(d/(n-1));n=(m-t)/256;c=(p+.5)*n+t;k*=n;g.push({min:t,max:m,avg:c,stddev:k})}return{statistics:g,histograms:e}};B.extractBands=function(b,
h){if(!h||!D(b))return b;const f=b.pixels.length;return h&&h.some(l=>l>=f)||1===f&&1===h.length&&0===h[0]||f===h.length&&!h.some((l,r)=>l!==r)?b:new y({pixelType:b.pixelType,width:b.width,height:b.height,mask:b.mask,validPixelCount:b.validPixelCount,maskIsAlpha:b.maskIsAlpha,pixels:h.map(l=>b.pixels[l]),statistics:b.statistics&&h.map(l=>b.statistics[l])})};B.getClipBounds=F;B.lookupPixels=function(b,h){if(!D(b))return null;const {pixels:f,mask:l}=b,r=b.width*b.height,v=f.length;let t=h.lut;({offset:h}=
h);let m,a;t&&1===t[0].length&&(t=f.map(()=>t));const c=[];let e,g,k;if(h)if(null==l)for(m=0;m<v;m++){e=f[m];g=t[m];k=new Uint8Array(r);for(a=0;a<r;a++)k[a]=g[e[a]-h];c.push(k)}else for(m=0;m<v;m++){e=f[m];g=t[m];k=new Uint8Array(r);for(a=0;a<r;a++)l[a]&&(k[a]=g[e[a]-h]);c.push(k)}else if(null==l)for(m=0;m<v;m++){e=f[m];g=t[m];k=new Uint8Array(r);for(a=0;a<r;a++)k[a]=g[e[a]];c.push(k)}else for(m=0;m<v;m++){e=f[m];g=t[m];k=new Uint8Array(r);for(a=0;a<r;a++)l[a]&&(k[a]=g[e[a]]);c.push(k)}b=new y({width:b.width,
height:b.height,pixels:c,mask:l,pixelType:"u8"});b.updateStatistics();return b};B.mosaic=I;B.mosaicPixelData=function(b,h){if(!b||0===b.length)return null;var f=b.filter(g=>g.pixelBlock)[0];if(!f)return null;var l=(f.extent.xmax-f.extent.xmin)/f.pixelBlock.width;const r=(f.extent.ymax-f.extent.ymin)/f.pixelBlock.height,v=.01*Math.min(l,r),t=b.sort((g,k)=>Math.abs(g.extent.ymax-k.extent.ymax)>v?k.extent.ymax-g.extent.ymax:Math.abs(g.extent.xmin-k.extent.xmin)>v?g.extent.xmin-k.extent.xmin:0);var m=
Math.min.apply(null,t.map(g=>g.extent.xmin));const a=Math.min.apply(null,t.map(g=>g.extent.ymin)),c=Math.max.apply(null,t.map(g=>g.extent.xmax)),e=Math.max.apply(null,t.map(g=>g.extent.ymax));b={x:Math.round((h.xmin-m)/l),y:Math.round((e-h.ymax)/r)};m={width:Math.round((c-m)/l),height:Math.round((e-a)/r)};l={width:Math.round((h.xmax-h.xmin)/l),height:Math.round((h.ymax-h.ymin)/r)};if(Math.round(m.width/f.pixelBlock.width)*Math.round(m.height/f.pixelBlock.height)!==t.length||0>b.x||0>b.y||m.width<
l.width||m.height<l.height)return null;f=t.map(g=>g.pixelBlock);f=I(f,m,b,l);return{extent:h,pixelBlock:f}};B.remapColor=function(b,h){if(!D(b))return null;b=b.clone();var {pixels:f}=b;const l=b.width*b.height,r=h.length,v=Math.floor(r/2),t=h[Math.floor(v)];f=f[0];let m,a,c,e,g,k,d=!1;const n=new Uint8Array(l),p=new Uint8Array(l),q=new Uint8Array(l);let u=b.mask;const z=4===h[0].mappedColor.length;u||(u=new Uint8Array(l),u.fill(z?255:1),b.mask=u);for(g=0;g<l;g++)if(u[g]){m=f[g];d=!1;k=v;a=t;c=0;for(e=
r-1;1<e-c;){if(m===a.value){d=!0;break}m>a.value?c=k:e=k;k=Math.floor((c+e)/2);a=h[Math.floor(k)]}d||(m===h[c].value?(a=h[c],d=!0):m===h[e].value?(a=h[e],d=!0):m<h[c].value?(d=!1,a=null):m>h[c].value&&(m<h[e].value?(a=h[c],d=!0):e===r-1?(d=!1,a=null):(a=h[e],d=!0)));d?(n[g]=a.mappedColor[0],p[g]=a.mappedColor[1],q[g]=a.mappedColor[2],u[g]=a.mappedColor[3]):n[g]=p[g]=q[g]=u[g]=0}b.pixels=[n,p,q];b.mask=u;b.pixelType="u8";b.maskIsAlpha=z;return b};B.resampleByMajority=A;B.setValidBoundary=function(b,
h,f){if(!D(b))return null;const {width:l,height:r}=b,v=h.x;h=h.y;const t=f.width+v;f=f.height+h;if(0>v||0>h||t>l||f>r||0===v&&0===h&&t===l&&f===r)return b;b.mask||(b.mask=new Uint8Array(l*r));const m=b.mask;for(let a=0;a<r;a++){const c=a*l;for(let e=0;e<l;e++)m[c+e]=a<h||a>=f||e<v||e>=t?0:1}b.updateStatistics();return b};B.split=function(b,h,f){if(!D(b))return null;const {width:l,height:r}=h;let {width:v,height:t}=b;const m=new Map,a={x:0,y:0};f=null==f?1:1+f;for(let c=0;c<f;c++){const e=Math.ceil(v/
l),g=Math.ceil(t/r);for(let k=0;k<g;k++){a.y=k*r;for(let d=0;d<e;d++){a.x=d*l;const n=N(b,a,h);m.set(`${c}/${k}/${d}`,n)}}c<f-1&&(b=K(b));v=Math.round(v/2);t=Math.round(t/2)}return m};B.stretch=function(b,h){if(!D(b))return null;b=b.clone();const {pixels:f,mask:l}=b,{minCutOff:r,maxCutOff:v,gamma:t}=h,m=h.outMin||0;h=h.outMax||255;const a=b.width*b.height,c=f.length;let e;let g,k,d;const n=h-m,p=[];for(e=0;e<c;e++)p[e]=v[e]-r[e];var q=t&&t.length>=c;const u=[];if(q)for(e=0;e<c;e++)u[e]=1<t[e]?2<t[e]?
6.5+Math.pow(t[e]-2,2.5):6.5+100*Math.pow(2-t[e],4):1;if(q)if(null!=l)for(q=0;q<a;q++){if(l[q])for(e=0;e<c;e++)g=f[e][q],d=(g-r[e])/p[e],k=1,1<t[e]&&(k-=Math.pow(1/n,d*u[e])),f[e][q]=g<v[e]&&g>r[e]?Math.floor(k*n*Math.pow(d,1/t[e]))+m:g>=v[e]?h:m}else for(q=0;q<a;q++)for(e=0;e<c;e++)g=f[e][q],d=(g-r[e])/p[e],k=1,1<t[e]&&(k-=Math.pow(1/n,d*u[e])),f[e][q]=g<v[e]&&g>r[e]?Math.floor(k*n*Math.pow(d,1/t[e]))+m:g>=v[e]?h:m;else if(null!=l)for(q=0;q<a;q++){if(l[q])for(e=0;e<c;e++)g=f[e][q],f[e][q]=g<v[e]&&
g>r[e]?Math.floor((g-r[e])/p[e]*n)+m:g>=v[e]?h:m}else for(q=0;q<a;q++)for(e=0;e<c;e++)g=f[e][q],f[e][q]=g<v[e]&&g>r[e]?Math.floor((g-r[e])/p[e]*n)+m:g>=v[e]?h:m;b.pixelType="u8";b.updateStatistics();return b};Object.defineProperty(B,"__esModule",{value:!0})})},"esri/layers/support/PixelBlock":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/has ../../core/lang ../../core/maybe ../../core/Logger ../../core/accessorSupport/decorators/property ../../core/accessorSupport/decorators/cast ../../core/jsonMap ../../core/accessorSupport/decorators/subclass ../../core/Error ../../core/urlUtils ../../core/uuid ../../portal/support/resourceExtension ../../core/JSONSupport".split(" "),
function(B,y,w,F,I,A,E,H,L,N,K,D,b,h,f){var l;const r=A.getLogger("esri.layers.support.PixelBlock");w=l=function(v){function t(a){a=v.call(this,a)||this;a.width=null;a.height=null;a.pixelType="f32";a.validPixelCount=null;a.mask=null;a.maskIsAlpha=!1;a.pixels=null;a.statistics=null;return a}B._inheritsLoose(t,v);t.createEmptyBand=function(a,c){return new (l.getPixelArrayConstructor(a))(c)};t.getPixelArrayConstructor=function(a){let c;switch(a){case "u1":case "u2":case "u4":case "u8":c=Uint8Array;break;
case "u16":c=Uint16Array;break;case "u32":c=Uint32Array;break;case "s8":c=Int8Array;break;case "s16":c=Int16Array;break;case "s32":c=Int32Array;break;case "u32":c=Uint32Array;break;case "f32":c=Float32Array;break;case "f64":c=Float64Array;break;case "c64":case "c128":case "unknown":c=Float32Array}return c};var m=t.prototype;m.castPixelType=function(a){if(!a)return"f32";a=a.toLowerCase();-1<["u1","u2","u4"].indexOf(a)?a="u8":-1==="unknown u8 s8 u16 s16 u32 s32 f32 f64".split(" ").indexOf(a)&&(a="f32");
return a};m.getPlaneCount=function(){return this.pixels&&this.pixels.length};m.addData=function(a){if(!a.pixels||a.pixels.length!==this.width*this.height)throw new K("pixelblock:invalid-or-missing-pixels","add data requires valid pixels array that has same length defined by pixel block width * height");this.pixels||(this.pixels=[]);this.statistics||(this.statistics=[]);this.pixels.push(a.pixels);this.statistics.push(a.statistics||{minValue:null,maxValue:null})};m.getAsRGBA=function(){const a=new ArrayBuffer(this.width*
this.height*4);switch(this.pixelType){case "s8":case "s16":case "u16":case "s32":case "u32":case "f32":case "f64":this._fillFromNon8Bit(a);break;default:this._fillFrom8Bit(a)}return new Uint8ClampedArray(a)};m.getAsRGBAFloat=function(){const a=new Float32Array(this.width*this.height*4);this._fillFrom32Bit(a);return a};m.updateStatistics=function(){this.statistics=this.pixels.map(e=>this._calculateBandStatistics(e,this.mask));const a=this.mask;let c=0;if(a)for(let e=0;e<a.length;e++)a[e]&&c++;else c=
this.width*this.height;this.validPixelCount=c};m.clamp=function(a){if(a&&"f64"!==a&&"f32"!==a){switch(a){case "u8":var c=[0,255];break;case "u16":c=[0,65535];break;case "u32":c=[0,4294967295];break;case "s8":c=[-128,127];break;case "s16":c=[-32768,32767];break;case "s32":c=[-2147483648,2147483647];break;default:c=[-3.4*1E39,3.4*1E39]}var [e,g]=c;c=this.pixels;var k=this.width*this.height,d=c.length,n=[];for(let z=0;z<d;z++){var p=l.createEmptyBand(a,k);var q=c[z];for(let x=0;x<k;x++){var u=q[x];p[x]=
u>g?g:u<e?e:u}n.push(p)}this.pixels=n;this.pixelType=a}};m.extractBands=function(a){if(I.isNone(a)||0===a.length||null==this.pixels||0===this.pixels.length)return this;var c=this.pixels.length;const e=a.some(g=>g>=this.pixels.length);c=c===a.length&&!a.some((g,k)=>g!==k);return e||c?this:new l({pixelType:this.pixelType,width:this.width,height:this.height,mask:this.mask,validPixelCount:this.validPixelCount,maskIsAlpha:this.maskIsAlpha,pixels:a.map(g=>this.pixels[g]),statistics:this.statistics&&a.map(g=>
this.statistics[g])})};m.clone=function(){const a=new l({width:this.width,height:this.height,pixelType:this.pixelType,maskIsAlpha:this.maskIsAlpha,validPixelCount:this.validPixelCount});this.mask&&(a.mask=this.mask instanceof Uint8Array?new Uint8Array(this.mask):this.mask.slice(0));let c;const e=l.getPixelArrayConstructor(this.pixelType);if(this.pixels&&0<this.pixels.length){a.pixels=[];const g=this.pixels[0].slice;for(c=0;c<this.pixels.length;c++)a.pixels[c]=g?this.pixels[c].slice(0,this.pixels[c].length):
new e(this.pixels[c])}if(this.statistics)for(a.statistics=[],c=0;c<this.statistics.length;c++)a.statistics[c]=F.clone(this.statistics[c]);return a};m._fillFrom8Bit=function(a){const {mask:c,maskIsAlpha:e,pixels:g}=this;if(a&&g&&g.length){var k,d;var n=k=d=g[0];3<=g.length?(k=g[1],d=g[2]):2===g.length&&(k=g[1]);var p=new Uint32Array(a),q=this.width*this.height;if(n.length!==q)r.error("getAsRGBA()","Unable to convert to RGBA. The pixelblock is invalid.");else if(c&&c.length===q)if(e)for(a=0;a<q;a++)c[a]&&
(p[a]=c[a]<<24|d[a]<<16|k[a]<<8|n[a]);else for(a=0;a<q;a++)c[a]&&(p[a]=-16777216|d[a]<<16|k[a]<<8|n[a]);else for(a=0;a<q;a++)p[a]=-16777216|d[a]<<16|k[a]<<8|n[a]}else r.error("getAsRGBA()","Unable to convert to RGBA. The input pixel block is empty.")};m._fillFromNon8Bit=function(a){const {pixels:c,mask:e,statistics:g}=this;if(a&&c&&c.length){var k=this.pixelType,d=1,n=0;d=1;g&&0<g.length?(n=g.map(x=>x.minValue).reduce((x,C)=>Math.min(x,C)),d=g.map(x=>x.maxValue-x.minValue).reduce((x,C)=>Math.max(x,
C)),d=255/d):(d=255,"s8"===k?(n=-128,d=127):"u16"===k?d=65535:"s16"===k?(n=-32768,d=32767):"u32"===k?d=4294967295:"s32"===k?(n=-2147483648,d=2147483647):"f32"===k?(n=-3.4*1E39,d=3.4*1E39):"f64"===k&&(n=-Number.MAX_VALUE,d=Number.MAX_VALUE),d=255/(d-n));a=new Uint32Array(a);k=this.width*this.height;var p,q,u;var z=p=q=c[0];if(z.length!==k)return r.error("getAsRGBA()","Unable to convert to RGBA. The pixelblock is invalid.");if(2<=c.length)if(p=c[1],3<=c.length&&(q=c[2]),e&&e.length===k)for(u=0;u<k;u++)e[u]&&
(a[u]=-16777216|(q[u]-n)*d<<16|(p[u]-n)*d<<8|(z[u]-n)*d);else for(u=0;u<k;u++)a[u]=-16777216|(q[u]-n)*d<<16|(p[u]-n)*d<<8|(z[u]-n)*d;else if(e&&e.length===k)for(u=0;u<k;u++)p=(z[u]-n)*d,e[u]&&(a[u]=-16777216|p<<16|p<<8|p);else for(u=0;u<k;u++)p=(z[u]-n)*d,a[u]=-16777216|p<<16|p<<8|p}else r.error("getAsRGBA()","Unable to convert to RGBA. The input pixel block is empty.")};m._fillFrom32Bit=function(a){const {pixels:c,mask:e}=this;if(!a||!c||!c.length)return r.error("getAsRGBAFloat()","Unable to convert to RGBA. The input pixel block is empty.");
let g,k,d,n;g=k=d=c[0];3<=c.length?(k=c[1],d=c[2]):2===c.length&&(k=c[1]);const p=this.width*this.height;if(g.length!==p)return r.error("getAsRGBAFloat()","Unable to convert to RGBA. The pixelblock is invalid.");let q=0;if(e&&e.length===p)for(n=0;n<p;n++)a[q++]=g[n],a[q++]=k[n],a[q++]=d[n],a[q++]=e[n]&1;else for(n=0;n<p;n++)a[q++]=g[n],a[q++]=k[n],a[q++]=d[n],a[q++]=1};m._calculateBandStatistics=function(a,c){let e=Infinity,g=-Infinity;const k=a.length;let d,n=0;if(c)for(d=0;d<k;d++)c[d]&&(n=a[d],
e=n<e?n:e,g=n>g?n:g);else for(d=0;d<k;d++)n=a[d],e=n<e?n:e,g=n>g?n:g;return{minValue:e,maxValue:g}};return t}(f.JSONSupport);y.__decorate([E.property({json:{write:!0}})],w.prototype,"width",void 0);y.__decorate([E.property({json:{write:!0}})],w.prototype,"height",void 0);y.__decorate([E.property({json:{write:!0}})],w.prototype,"pixelType",void 0);y.__decorate([H.cast("pixelType")],w.prototype,"castPixelType",null);y.__decorate([E.property({json:{write:!0}})],w.prototype,"validPixelCount",void 0);
y.__decorate([E.property({json:{write:!0}})],w.prototype,"mask",void 0);y.__decorate([E.property({json:{write:!0}})],w.prototype,"maskIsAlpha",void 0);y.__decorate([E.property({json:{write:!0}})],w.prototype,"pixels",void 0);y.__decorate([E.property({json:{write:!0}})],w.prototype,"statistics",void 0);return w=l=y.__decorate([N.subclass("esri.layers.support.PixelBlock")],w)})},"esri/views/2d/layers/support/ExportStrategy":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/has ../../../../core/Logger ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/property ../../../../core/jsonMap ../../../../core/accessorSupport/decorators/subclass ../../../../core/urlUtils ../../../../core/uuid ../../../../portal/support/resourceExtension ../../../../core/promiseUtils ../../../../core/Accessor ../../../../geometry/support/spatialReferenceUtils ../../../../geometry/Extent ../../../../geometry/support/aaBoundingRect ../../../../layers/support/TileInfo ../../tiling/TileKey ../../tiling/TileInfoView ../../viewStateUtils ../../engine/Bitmap".split(" "),
function(B,y,w,F,I,A,E,H,L,N,K,D,b,h,f,l,r,v,t,m,a){const c=l.create(),e=[0,0],g=new v(0,0,0,0);w=function(k){function d(p){var q=k.call(this,p)||this;q._imagePromise=null;q.hidpi=!1;q.imageMaxWidth=2048;q.imageMaxHeight=2048;q.imageRotationSupported=!1;q.imageNormalizationSupported=!1;q.update=D.debounce(async(u,z)=>{const x=u.state;var C=h.getInfo(x.spatialReference);const G=q.hidpi?u.pixelRatio:1;if(u.stationary&&!q.destroyed){q.imageRotationSupported?(e[0]=x.size[0],e[1]=x.size[1]):m.getOuterSize(e,
x);u=C&&(x.extent.xmin<C.valid[0]||x.extent.xmax>C.valid[1]);u=!q.imageNormalizationSupported&&u;C=q.imageRotationSupported?x.rotation:0;if(Math.floor(e[0]*G)>q.imageMaxWidth||Math.floor(e[1]*G)>q.imageMaxHeight||u){let J=Math.min(q.imageMaxWidth,q.imageMaxHeight);u&&(J=Math.min(x.worldScreenWidth,J));q._imagePromise=q._tiledExport(x,J,C,G,z)}else q._imagePromise=q._singleExport(x,e,C,G,z);return q._imagePromise.then(async J=>{q._imagePromise=null;await Promise.all(J.map(M=>{q.container.addChild(M);
return M.fadeIn()}));for(const M of q.container.children)J.includes(M)||M.fadeOut().then(()=>{q.container.removeChild(M)})}).catch(J=>{q._imagePromise=null;throw J;})}},5E3);return q}B._inheritsLoose(d,k);var n=d.prototype;n.destroy=function(){};n.updateExports=function(p){for(const q of this.container.children){if(!q.visible||!q.stage)break;p(q)?console.error("ExportStrategy.updateExports doesn't support promise yet"):(q.invalidateTexture(),q.requestRender())}};n._export=function(p,q,u,z,x,C){return D.resolve().then(()=>
this.fetchSource(p,Math.floor(q*x),Math.floor(u*x),{rotation:z,pixelRatio:x,signal:C})).then(G=>{G=new a.Bitmap(G);G.x=p.xmin;G.y=p.ymax;G.resolution=p.width/q;G.rotation=z;G.pixelRatio=x;return G})};n._singleExport=function(p,q,u,z,x){m.getBBox(c,p.center,p.resolution,q);p=new f(c[0],c[1],c[2],c[3],p.spatialReference);return this._export(p,q[0],q[1],u,z,x).then(C=>[C])};n._tiledExport=function(p,q,u,z,x){var C=r.create({size:q,spatialReference:p.spatialReference,scales:[p.scale]});const G=new t(C);
C=G.getTileCoverage(p);if(!C)return null;const J=[];C.forEach((M,O,R,S)=>{g.set(M,O,R,S);G.getTileBounds(c,g);M=new f(c[0],c[1],c[2],c[3],p.spatialReference);J.push(this._export(M,q,q,u,z,x))});return D.all(J)};B._createClass(d,[{key:"updating",get:function(){return null!==this._imagePromise}}]);return d}(b);y.__decorate([A.property()],w.prototype,"_imagePromise",void 0);y.__decorate([A.property()],w.prototype,"container",void 0);y.__decorate([A.property()],w.prototype,"fetchSource",void 0);y.__decorate([A.property()],
w.prototype,"hidpi",void 0);y.__decorate([A.property()],w.prototype,"imageMaxWidth",void 0);y.__decorate([A.property()],w.prototype,"imageMaxHeight",void 0);y.__decorate([A.property()],w.prototype,"imageRotationSupported",void 0);y.__decorate([A.property()],w.prototype,"imageNormalizationSupported",void 0);y.__decorate([A.property()],w.prototype,"requestUpdate",void 0);y.__decorate([A.property({dependsOn:["_imagePromise"]})],w.prototype,"updating",null);return w=y.__decorate([H.subclass("esri.views.2d.layers.support.ExportStrategy")],
w)})},"esri/views/2d/viewStateUtils":function(){define(["exports"],function(B){const y=Math.PI/180;B.bboxIntersects=function(w,F){const [I,A,E,H]=w,[L,N,K,D]=F;return!(I>K||E<L||A>D||H<N)};B.getBBox=function(w,F,I,A){const [E,H]=F,[L,N]=A;F=.5*I;w[0]=E-F*L;w[1]=H-F*N;w[2]=E+F*L;w[3]=H+F*N;return w};B.getOuterSize=function(w,F){var I=F.rotation*y;const A=Math.abs(Math.cos(I));I=Math.abs(Math.sin(I));const [E,H]=F.size;w[0]=Math.round(H*I+E*A);w[1]=Math.round(H*A+E*I);return w};B.snapToPixel=function(w,
F,I){const {resolution:A,size:E}=I;w[0]=A*(Math.round(F[0]/A)+E[0]%2*.5);w[1]=A*(Math.round(F[1]/A)+E[1]%2*.5);return w};Object.defineProperty(B,"__esModule",{value:!0})})},"*noref":1}});
define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/has ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/property ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../core/urlUtils ../../../core/uuid ../../../portal/support/resourceExtension ../../../core/promiseUtils ../../../core/watchUtils ../../layers/RefreshableLayerView ../../layers/LayerView ../../layers/ImageryLayerView ./LayerView2D ./imagery/ImageryGraphicsView2D ./imagery/ImageryView2D".split(" "),function(B,
y,w,F,I,A,E,H,L,N,K,D,b,h,f,l,r,v,t){w=function(m){function a(){var e=m.apply(this,arguments)||this;e._exportImageVersion=-1;return e}B._inheritsLoose(a,m);var c=a.prototype;c.hitTest=function(e,g){return this.suspended||!this.subview?D.resolve(null):this.subview.hitTest(e,g)};c.update=function(e){var g;null==(g=this.subview)?void 0:g.update(e)};c.attach=function(){this.layer.increaseRasterJobHandlerUsage();this._setSubView();this.handles.add([b.init(this,"layer.exportImageServiceParameters.version",
e=>{this._exportImageVersion!==e&&(this._exportImageVersion=e,this.requestUpdate())}),this.watch("timeExtent",()=>{this.subview.timeExtent=this.timeExtent;this.requestUpdate()}),this.layer.on("redraw",()=>this.subview.redraw()),b.watch(this.layer,"renderer",()=>this._setSubView())],"imagerylayerview-update")};c.detach=function(){this.layer.decreaseRasterJobHandlerUsage();this.subview.destroy();this.handles.remove("imagerylayerview-update");this._exportImageVersion=-1};c.moveStart=function(){};c.viewChange=
function(){};c.moveEnd=function(){this.requestUpdate()};c.doRefresh=async function(){this.requestUpdate()};c.isUpdating=function(){return!this.subview||this.subview.isUpdating()};c._setSubView=function(){var e;let g="Imagery";"vector-field"===(null==(e=this.layer.renderer)?void 0:e.type)&&"lerc"===this.layer.format&&(g="Graphics");if(!this.subview||this.subview.type!==g){var k,d;null==(k=this.subview)?void 0:k.uninstall(this.container);null==(d=this.subview)?void 0:d.destroy();this.subview="Imagery"===
g?new t({layer:this.layer,view:this.view}):new v({layer:this.layer,view:this.view});this.subview.attach();this.subview.install(this.container)}this.requestUpdate()};B._createClass(a,[{key:"pixelData",get:function(){return this.updating?null:this.subview.getPixelData()}},{key:"updating",get:function(){return!(this.subview&&!this.subview.updating)}}]);return a}(l.ImageryLayerView(h.RefreshableLayerView(r.LayerView2DMixin(f))));y.__decorate([A.property({dependsOn:["updating"]})],w.prototype,"pixelData",
null);y.__decorate([A.property({readOnly:!0,dependsOn:["subview.updating"]})],w.prototype,"updating",null);y.__decorate([A.property()],w.prototype,"subview",void 0);return w=y.__decorate([H.subclass("esri.views.2d.layers.ImageryLayerView2D")],w)});