// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.18/esri/copyright.txt for details.
//>>built
define("../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/has ../../../../core/Logger ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/decorators/enumeration ../../../../core/accessorSupport/decorators/subclass ../../../../core/urlUtils ../../../../core/uuid ../../../../portal/support/resourceExtension ../../../../core/promiseUtils ../../../../core/screenUtils ../../../../Graphic ../../../../layers/support/rasterFunctions/pixelUtils ../../../layers/LayerView ../../engine/Container ../../engine/ImageryBitmapSource ../../engine/BitmapContainer ../LayerView2D ../support/ExportStrategy".split(" "),
function(p,g,e,r,G,h,t,u,H,I,J,n,v,w,x,y,z,A,B,C,D){const E=r.getLogger("esri.views.2d.layers.imagery.ImageryView2D");e=function(q){function l(){var a=q.apply(this,arguments)||this;a.container=new z.Container;a.type="Imagery";a._bitmapView=null;return a}p._inheritsLoose(l,q);var c=l.prototype;c.update=function(a){this.strategy.update(a).catch(d=>{n.isAbortError(d)||E.error(d)})};c.detach=function(){this.strategy.destroy();this._bitmapView.removeAllChildren();this.container.removeAllChildren()};c.hitTest=
function(a,d){if(this.suspended)return n.resolve(null);a=this.view.toMap(v.createScreenPoint(a,d));return n.resolve(new w({attributes:{},geometry:a,layer:this.layer}))};c.attach=function(){const a=10<=this.layer.version,d=10.1<=this.layer.version?this.layer.imageMaxHeight:2048,b=10.1<=this.layer.version?this.layer.imageMaxWidth:2048;this._bitmapView=new B.BitmapContainer;this.strategy=new D({container:this._bitmapView,imageNormalizationSupported:a,imageMaxHeight:d,imageMaxWidth:b,fetchSource:this._fetchImage.bind(this),
requestUpdate:()=>this.requestUpdate()})};c.moveStart=function(){};c.viewChange=function(){};c.moveEnd=function(){};c.install=function(a){this.container.addChild(this._bitmapView);a.addChild(this.container)};c.uninstall=function(a){this.container.removeChild(this._bitmapView);a.removeChild(this.container)};c.redraw=function(){this.strategy.updateExports(a=>{a.source instanceof HTMLImageElement?a.requestRender():this.layer.applyRenderer({pixelBlock:a.source.pixelBlock}).then(d=>{const b=a.source;b.pixelBlock=
d.pixelBlock;b.filter=f=>this.layer.applyFilter(f);this.container.requestRender()})})};c.isUpdating=function(){return this.strategy.updating||this.updateRequested};c.getPixelData=function(){if(this.updating)return null;var a=this.strategy.container.children;if(1===a.length&&a[0].source)return{extent:a[0].source.extent,pixelBlock:a[0].source.originalPixelBlock};if(1<a.length){const d=this.view.extent;a=a.map(b=>b.source).filter(b=>b.extent&&b.extent.intersects(d)).map(b=>({extent:b.extent,pixelBlock:b.originalPixelBlock}));
return(a=x.mosaicPixelData(a,d))?{extent:a.extent,pixelBlock:a.pixelBlock}:null}return null};c._fetchImage=function(a,d,b,f){f=f||{};f.timeExtent=this.timeExtent;f.requestAsImageElement=!0;return this.layer.fetchImage(a,d,b,f).then(m=>m.imageElement?m.imageElement:this.layer.applyRenderer(m.pixelData,{signal:f.signal}).then(k=>{k=new A(k.pixelBlock,k.extent.clone(),m.pixelData.pixelBlock);k.filter=F=>this.layer.applyFilter(F);return k}))};p._createClass(l,[{key:"updating",get:function(){var a;return null==
(a=this.strategy)?void 0:a.updating}}]);return l}(C.LayerView2DMixin(y));g.__decorate([h.property()],e.prototype,"container",void 0);g.__decorate([h.property()],e.prototype,"layer",void 0);g.__decorate([h.property()],e.prototype,"strategy",void 0);g.__decorate([h.property()],e.prototype,"timeExtent",void 0);g.__decorate([h.property({dependsOn:["strategy.updating"]})],e.prototype,"updating",null);g.__decorate([t.enumeration({imagery:"Imagery"})],e.prototype,"type",void 0);return e=g.__decorate([u.subclass("esri.views.2d.layers.imagery.ImageryView2D")],
e)});