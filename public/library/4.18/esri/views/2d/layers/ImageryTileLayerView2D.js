// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.18/esri/copyright.txt for details.
//>>built
require({cache:{"esri/layers/support/PixelBlock":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/has ../../core/lang ../../core/maybe ../../core/Logger ../../core/accessorSupport/decorators/property ../../core/accessorSupport/decorators/cast ../../core/jsonMap ../../core/accessorSupport/decorators/subclass ../../core/Error ../../core/urlUtils ../../core/uuid ../../portal/support/resourceExtension ../../core/JSONSupport".split(" "),function(C,D,u,G,y,E,I,
H,F,B,w,A,a,g,b){var e;const h=E.getLogger("esri.layers.support.PixelBlock");u=e=function(m){function n(c){c=m.call(this,c)||this;c.width=null;c.height=null;c.pixelType="f32";c.validPixelCount=null;c.mask=null;c.maskIsAlpha=!1;c.pixels=null;c.statistics=null;return c}C._inheritsLoose(n,m);n.createEmptyBand=function(c,f){return new (e.getPixelArrayConstructor(c))(f)};n.getPixelArrayConstructor=function(c){let f;switch(c){case "u1":case "u2":case "u4":case "u8":f=Uint8Array;break;case "u16":f=Uint16Array;
break;case "u32":f=Uint32Array;break;case "s8":f=Int8Array;break;case "s16":f=Int16Array;break;case "s32":f=Int32Array;break;case "u32":f=Uint32Array;break;case "f32":f=Float32Array;break;case "f64":f=Float64Array;break;case "c64":case "c128":case "unknown":f=Float32Array}return f};var p=n.prototype;p.castPixelType=function(c){if(!c)return"f32";c=c.toLowerCase();-1<["u1","u2","u4"].indexOf(c)?c="u8":-1==="unknown u8 s8 u16 s16 u32 s32 f32 f64".split(" ").indexOf(c)&&(c="f32");return c};p.getPlaneCount=
function(){return this.pixels&&this.pixels.length};p.addData=function(c){if(!c.pixels||c.pixels.length!==this.width*this.height)throw new w("pixelblock:invalid-or-missing-pixels","add data requires valid pixels array that has same length defined by pixel block width * height");this.pixels||(this.pixels=[]);this.statistics||(this.statistics=[]);this.pixels.push(c.pixels);this.statistics.push(c.statistics||{minValue:null,maxValue:null})};p.getAsRGBA=function(){const c=new ArrayBuffer(this.width*this.height*
4);switch(this.pixelType){case "s8":case "s16":case "u16":case "s32":case "u32":case "f32":case "f64":this._fillFromNon8Bit(c);break;default:this._fillFrom8Bit(c)}return new Uint8ClampedArray(c)};p.getAsRGBAFloat=function(){const c=new Float32Array(this.width*this.height*4);this._fillFrom32Bit(c);return c};p.updateStatistics=function(){this.statistics=this.pixels.map(d=>this._calculateBandStatistics(d,this.mask));const c=this.mask;let f=0;if(c)for(let d=0;d<c.length;d++)c[d]&&f++;else f=this.width*
this.height;this.validPixelCount=f};p.clamp=function(c){if(c&&"f64"!==c&&"f32"!==c){switch(c){case "u8":var f=[0,255];break;case "u16":f=[0,65535];break;case "u32":f=[0,4294967295];break;case "s8":f=[-128,127];break;case "s16":f=[-32768,32767];break;case "s32":f=[-2147483648,2147483647];break;default:f=[-3.4*1E39,3.4*1E39]}var [d,k]=f;f=this.pixels;var q=this.width*this.height,l=f.length,r=[];for(let L=0;L<l;L++){var v=e.createEmptyBand(c,q);var x=f[L];for(let K=0;K<q;K++){var z=x[K];v[K]=z>k?k:z<
d?d:z}r.push(v)}this.pixels=r;this.pixelType=c}};p.extractBands=function(c){if(y.isNone(c)||0===c.length||null==this.pixels||0===this.pixels.length)return this;var f=this.pixels.length;const d=c.some(k=>k>=this.pixels.length);f=f===c.length&&!c.some((k,q)=>k!==q);return d||f?this:new e({pixelType:this.pixelType,width:this.width,height:this.height,mask:this.mask,validPixelCount:this.validPixelCount,maskIsAlpha:this.maskIsAlpha,pixels:c.map(k=>this.pixels[k]),statistics:this.statistics&&c.map(k=>this.statistics[k])})};
p.clone=function(){const c=new e({width:this.width,height:this.height,pixelType:this.pixelType,maskIsAlpha:this.maskIsAlpha,validPixelCount:this.validPixelCount});this.mask&&(c.mask=this.mask instanceof Uint8Array?new Uint8Array(this.mask):this.mask.slice(0));let f;const d=e.getPixelArrayConstructor(this.pixelType);if(this.pixels&&0<this.pixels.length){c.pixels=[];const k=this.pixels[0].slice;for(f=0;f<this.pixels.length;f++)c.pixels[f]=k?this.pixels[f].slice(0,this.pixels[f].length):new d(this.pixels[f])}if(this.statistics)for(c.statistics=
[],f=0;f<this.statistics.length;f++)c.statistics[f]=G.clone(this.statistics[f]);return c};p._fillFrom8Bit=function(c){const {mask:f,maskIsAlpha:d,pixels:k}=this;if(c&&k&&k.length){var q,l;var r=q=l=k[0];3<=k.length?(q=k[1],l=k[2]):2===k.length&&(q=k[1]);var v=new Uint32Array(c),x=this.width*this.height;if(r.length!==x)h.error("getAsRGBA()","Unable to convert to RGBA. The pixelblock is invalid.");else if(f&&f.length===x)if(d)for(c=0;c<x;c++)f[c]&&(v[c]=f[c]<<24|l[c]<<16|q[c]<<8|r[c]);else for(c=0;c<
x;c++)f[c]&&(v[c]=-16777216|l[c]<<16|q[c]<<8|r[c]);else for(c=0;c<x;c++)v[c]=-16777216|l[c]<<16|q[c]<<8|r[c]}else h.error("getAsRGBA()","Unable to convert to RGBA. The input pixel block is empty.")};p._fillFromNon8Bit=function(c){const {pixels:f,mask:d,statistics:k}=this;if(c&&f&&f.length){var q=this.pixelType,l=1,r=0;l=1;k&&0<k.length?(r=k.map(K=>K.minValue).reduce((K,M)=>Math.min(K,M)),l=k.map(K=>K.maxValue-K.minValue).reduce((K,M)=>Math.max(K,M)),l=255/l):(l=255,"s8"===q?(r=-128,l=127):"u16"===
q?l=65535:"s16"===q?(r=-32768,l=32767):"u32"===q?l=4294967295:"s32"===q?(r=-2147483648,l=2147483647):"f32"===q?(r=-3.4*1E39,l=3.4*1E39):"f64"===q&&(r=-Number.MAX_VALUE,l=Number.MAX_VALUE),l=255/(l-r));c=new Uint32Array(c);q=this.width*this.height;var v,x,z;var L=v=x=f[0];if(L.length!==q)return h.error("getAsRGBA()","Unable to convert to RGBA. The pixelblock is invalid.");if(2<=f.length)if(v=f[1],3<=f.length&&(x=f[2]),d&&d.length===q)for(z=0;z<q;z++)d[z]&&(c[z]=-16777216|(x[z]-r)*l<<16|(v[z]-r)*l<<
8|(L[z]-r)*l);else for(z=0;z<q;z++)c[z]=-16777216|(x[z]-r)*l<<16|(v[z]-r)*l<<8|(L[z]-r)*l;else if(d&&d.length===q)for(z=0;z<q;z++)v=(L[z]-r)*l,d[z]&&(c[z]=-16777216|v<<16|v<<8|v);else for(z=0;z<q;z++)v=(L[z]-r)*l,c[z]=-16777216|v<<16|v<<8|v}else h.error("getAsRGBA()","Unable to convert to RGBA. The input pixel block is empty.")};p._fillFrom32Bit=function(c){const {pixels:f,mask:d}=this;if(!c||!f||!f.length)return h.error("getAsRGBAFloat()","Unable to convert to RGBA. The input pixel block is empty.");
let k,q,l,r;k=q=l=f[0];3<=f.length?(q=f[1],l=f[2]):2===f.length&&(q=f[1]);const v=this.width*this.height;if(k.length!==v)return h.error("getAsRGBAFloat()","Unable to convert to RGBA. The pixelblock is invalid.");let x=0;if(d&&d.length===v)for(r=0;r<v;r++)c[x++]=k[r],c[x++]=q[r],c[x++]=l[r],c[x++]=d[r]&1;else for(r=0;r<v;r++)c[x++]=k[r],c[x++]=q[r],c[x++]=l[r],c[x++]=1};p._calculateBandStatistics=function(c,f){let d=Infinity,k=-Infinity;const q=c.length;let l,r=0;if(f)for(l=0;l<q;l++)f[l]&&(r=c[l],
d=r<d?r:d,k=r>k?r:k);else for(l=0;l<q;l++)r=c[l],d=r<d?r:d,k=r>k?r:k;return{minValue:d,maxValue:k}};return n}(b.JSONSupport);D.__decorate([I.property({json:{write:!0}})],u.prototype,"width",void 0);D.__decorate([I.property({json:{write:!0}})],u.prototype,"height",void 0);D.__decorate([I.property({json:{write:!0}})],u.prototype,"pixelType",void 0);D.__decorate([H.cast("pixelType")],u.prototype,"castPixelType",null);D.__decorate([I.property({json:{write:!0}})],u.prototype,"validPixelCount",void 0);
D.__decorate([I.property({json:{write:!0}})],u.prototype,"mask",void 0);D.__decorate([I.property({json:{write:!0}})],u.prototype,"maskIsAlpha",void 0);D.__decorate([I.property({json:{write:!0}})],u.prototype,"pixels",void 0);D.__decorate([I.property({json:{write:!0}})],u.prototype,"statistics",void 0);return u=e=D.__decorate([B.subclass("esri.layers.support.PixelBlock")],u)})},"esri/layers/support/rasterFunctions/pixelUtils":function(){define(["exports","../PixelBlock"],function(C,D){function u(a,
g){a=Math.min(Math.max(a,-100),100);g=Math.min(Math.max(g,-100),100);let b,e;const h=new Uint8Array(256);for(b=0;256>b;b++)0<a&&100>a?e=(200*b-25500+510*g)/(2*(100-a))+128:0>=a&&-100<a?e=(200*b-25500+510*g)*(100+a)/2E4+128:100===a?(e=200*b-25500+256*(100-a)+510*g,e=0<e?255:0):-100===a&&(e=128),h[b]=255<e?255:0>e?0:e;return h}function G(a,g,b,e,h,m,n,p){return{xmin:h<=b*a?0:h<b*a+a?h-b*a:a,ymin:m<=e*g?0:m<e*g+g?m-e*g:g,xmax:h+n<=b*a?0:h+n<b*a+a?h+n-b*a:a,ymax:m+p<=e*g?0:m+p<e*g+g?m+p-e*g:g}}function y(a,
g,b,e){var h=a.filter(O=>A(O))[0];if(null==h)return null;const m=e?e.width:g.width;e=e?e.height:g.height;const n=h.width,p=h.height,c=g.width/n;g=g.height/p;const f=b?b.x:0;b=b?b.y:0;const d=h.pixelType;var k=D.getPixelArrayConstructor(d);const q=h.pixels.length;h=[];let l,r;var v;let x,z,L,K,M,S,P;for(z=0;z<q;z++){r=new k(m*e);for(L=0;L<g;L++)for(K=0;K<c;K++)if(v=a[L*c+K])for(l=v.pixels[z],P=G(n,p,K,L,f,b,m,e),M=P.ymin;M<P.ymax;M++)for(v=(L*p+M-b)*m+(K*n-f),x=M*n,S=P.xmin;S<P.xmax;S++)r[v+S]=l[x+
S];h.push(r)}let Q;if(a.some(O=>null==O||O.mask&&0<O.mask.length))for(Q=new Uint8Array(m*e),L=0;L<g;L++)for(K=0;K<c;K++)if(k=(v=a[L*c+K])?v.mask:null,P=G(n,p,K,L,f,b,m,e),k)for(M=P.ymin;M<P.ymax;M++)for(v=(L*p+M-b)*m+(K*n-f),x=M*n,S=P.xmin;S<P.xmax;S++)Q[v+S]=k[x+S];else if(v)for(M=P.ymin;M<P.ymax;M++)for(v=(L*p+M-b)*m+(K*n-f),x=M*n,S=P.xmin;S<P.xmax;S++)Q[v+S]=1;else for(M=P.ymin;M<P.ymax;M++)for(v=(L*p+M-b)*m+(K*n-f),x=M*n,S=P.xmin;S<P.xmax;S++)Q[v+S]=0;a=new D({width:m,height:e,pixels:h,pixelType:d,
mask:Q});a.updateStatistics();return a}function E(a){if(!A(a))return null;const g=a.clone(),{width:b,height:e,pixels:h,mask:m}=a;var n=h[0];a=g.pixels[0];for(let f=2;f<e-1;f++){const d=new Map;for(var p=f-2;p<f+2;p++)for(var c=0;4>c;c++){const k=p*b+c;F(d,n[k],m?m[k]:1)}a[f*b]=I(d);a[f*b+1]=a[f*b+2]=a[f*b];for(p=3;p<b-1;p++)c=(f-2)*b+p+1,F(d,n[c],m?m[c]:1),c=(f-1)*b+p+1,F(d,n[c],m?m[c]:1),c=f*b+p+1,F(d,n[c],m?m[c]:1),c=(f+1)*b+p+1,F(d,n[c],m?m[c]:1),c=(f-2)*b+p-3,H(d,n[c],m?m[c]:1),c=(f-1)*b+p-3,
H(d,n[c],m?m[c]:1),c=f*b+p-3,H(d,n[c],m?m[c]:1),c=(f+1)*b+p-3,H(d,n[c],m?m[c]:1),a[f*b+p]=I(d);a[f*b+p+1]=a[f*b+p]}for(n=0;n<b;n++)a[n]=a[b+n]=a[2*b+n],a[(e-1)*b+n]=a[(e-2)*b+n];g.updateStatistics();return g}function I(a){if(0===a.size)return 0;let g=0,b=-1,e=0;const h=a.keys();let m=h.next();for(;!m.done;)e=a.get(m.value),e>g&&(b=m.value,g=e),m=h.next();return b}function H(a,g,b){0!==b&&(b=a.get(g),1===b?a.delete(g):a.set(g,b-1))}function F(a,g,b){0!==b&&a.set(g,a.has(g)?a.get(g)+1:1)}function B(a,
g,b){let {x:e,y:h}=g;const {width:m,height:n}=b;if(0===e&&0===h&&n===a.height&&m===a.width)return a;const {width:p,height:c}=a;g=Math.max(0,h);const f=Math.max(0,e),d=Math.min(e+m,p),k=Math.min(h+n,c);if(0>d||0>k||!A(a))return null;e=Math.max(0,-e);h=Math.max(0,-h);const {pixels:q,mask:l}=a;var r=m*n,v=q.length;const x=[];for(var z=0;z<v;z++){var L=q[z],K=D.createEmptyBand(a.pixelType,r);for(let M=g;M<k;M++){const S=M*p;let P=(M+h-g)*m+e;for(let Q=f;Q<d;Q++)K[P++]=L[S+Q]}x.push(K)}r=new Uint8Array(r);
for(v=g;v<k;v++)for(z=v*p,L=(v+h-g)*m+e,K=f;K<d;K++)r[L++]=l?l[z+K]:1;a=new D({width:b.width,height:b.height,pixelType:a.pixelType,pixels:x,mask:r});a.updateStatistics();return a}function w(a,g=!0){if(!A(a))return null;const {pixels:b,width:e,height:h,mask:m,pixelType:n}=a;a=[];const p=Math.round(e/2),c=Math.round(h/2),f=h-1,d=e-1;for(var k=0;k<b.length;k++){var q=b[k],l=D.createEmptyBand(n,p*c),r=0;for(var v=0;v<h;v+=2)for(var x=0;x<e;x+=2){var z=q[v*e+x];if(g){var L=x===d?z:q[v*e+x+1];const K=v===
f?z:q[v*e+x+e],M=x===d?K:v===f?L:q[v*e+x+e+1];l[r++]=(z+L+K+M)/4}else l[r++]=z}a.push(l)}k=null;if(m)for(k=new Uint8Array(p*c),q=0,l=0;l<h;l+=2)for(r=0;r<e;r+=2)v=m[l*e+r],g?(x=r===d?v:m[l*e+r+1],z=l===f?v:m[l*e+r+e],L=r===d?z:l===f?x:m[l*e+r+e+1],k[q++]=v*x*z*L?1:0):k[q++]=v;return new D({width:p,height:c,pixelType:n,pixels:a,mask:k})}const A=function(a){return a&&"esri.layers.support.PixelBlock"===a.declaredClass&&a.pixels&&0<a.pixels.length};C.approximateTransform=function(a,g,b,e,h="nearest"){if(!A(a))return null;
"majority"===h&&(a=E(a));const {pixels:m,mask:n,pixelType:p}=a,c=a.width;var f=a.height;a=D.getPixelArrayConstructor(p);var d=m.length;const {width:k,height:q}=g;g=e.cols;var l=e.rows;const r=Math.ceil(k/g),v=Math.ceil(q/l);e=!1;for(var x=0;x<b.length;x+=3)-1===b[x]&&-1===b[x+1]&&-1===b[x+2]&&(e=!0);let z,L,K,M,S,P;const Q=new Float32Array(k*q),O=new Float32Array(k*q);x=0;let U,R;const t="majority"===h?0:.5;for(let T=0;T<v;T++)for(let V=0;V<r;V++){z=12*(T*r+V);h=b[z];L=b[z+1];K=b[z+2];M=b[z+3];S=
b[z+4];P=b[z+5];for(var J=0;J<l;J++){x=(T*l+J)*k+V*g;R=(J+.5)/l;for(var N=0;N<J;N++)U=(N+.5)/g,Q[x+N]=Math.round((h*U+L*R+K)*c-t),O[x+N]=Math.round((M*U+S*R+P)*f-t)}z+=6;h=b[z];L=b[z+1];K=b[z+2];M=b[z+3];S=b[z+4];P=b[z+5];for(J=0;J<l;J++)for(x=(T*l+J)*k+V*g,R=(J+.5)/l,N=J;N<g;N++)U=(N+.5)/g,Q[x+N]=Math.round((h*U+L*R+K)*c-t),O[x+N]=Math.round((M*U+S*R+P)*f-t)}b=(T,V)=>{for(let X=0;X<q;X++){z=X*k;for(let W=0;W<k;W++)T[z]=0>Q[z]||0>O[z]?0:V[Q[z]+O[z]*c],z++}};f=[];for(l=0;l<d;l++)g=new a(k*q),b(g,m[l]),
f.push(g);a=new D({width:k,height:q,pixelType:p,pixels:f});if(n)a.mask=new Uint8Array(k*q),b(a.mask,n);else if(e)for(a.mask=new Uint8Array(k*q),d=0;d<k*q;d++)a.mask[d]=0>Q[d]||0>O[d]?0:1;a.updateStatistics();return a};C.clip=B;C.colorize=function(a,g){if(!A(a)||!g&&(g.indexedColormap||g.indexed2DColormap))return a;const b=a.clone();var e=b.pixels;let h=b.mask;const m=b.width*b.height;if(1!==e.length)return a;const {indexedColormap:n,indexed2DColormap:p,offset:c,alphaSpecified:f}=g;g=n.length-1;a=
0;e=e[0];const d=new Uint8Array(e.length),k=new Uint8Array(e.length),q=new Uint8Array(e.length);let l=0;if(n)if(h)for(a=0;a<m;a++)h[a]&&(l=4*(e[a]-c),l<c||l>g?h[a]=0:(d[a]=n[l],k[a]=n[l+1],q[a]=n[l+2],h[a]=n[l+3]));else{h=new Uint8Array(m);for(a=0;a<m;a++)l=4*(e[a]-c),l<c||l>g?h[a]=0:(d[a]=n[l],k[a]=n[l+1],q[a]=n[l+2],h[a]=n[l+3]);b.mask=h}else if(h)for(a=0;a<m;a++)h[a]&&(g=p[e[a]],d[a]=g[0],k[a]=g[1],q[a]=g[2],h[a]=g[3]);else{h=new Uint8Array(m);for(a=0;a<m;a++)g=p[e[a]],d[a]=g[0],k[a]=g[1],q[a]=
g[2],h[a]=g[3];b.mask=h}b.pixels=[d,k,q];b.statistics=null;b.pixelType="u8";b.maskIsAlpha=f;return b};C.createColormapLUT=function(a){if(a){var g=a.colormap;if(g&&0!==g.length){g=g.sort((f,d)=>f[0]-d[0]);var b=0;0>g[0][0]&&(b=g[0][0]);var e=Math.max(256,g[g.length-1][0]-b+1),h=new Uint8Array(4*e),m=[],n=0,p=0,c=5===g[0].length;if(65536<e)return g.forEach(f=>{m[f[0]-b]=c?f.slice(1):f.slice(1).concat([255])}),{indexed2DColormap:m,offset:b,alphaSpecified:c};if(a.fillUnspecified)for(a=g[p],n=a[0]-b;n<
e;n++)h[4*n]=a[1],h[4*n+1]=a[2],h[4*n+2]=a[3],h[4*n+3]=c?a[4]:255,n===a[0]-b&&(a=p===g.length-1?a:g[++p]);else for(n=0;n<g.length;n++)a=g[n],p=4*(a[0]-b),h[p]=a[1],h[p+1]=a[2],h[p+2]=a[3],h[p+3]=c?a[4]:255;return{indexedColormap:h,offset:b,alphaSpecified:c}}}};C.createContrastBrightnessLUT=u;C.createStretchLUT=function(a){const {minCutOff:g,maxCutOff:b,gamma:e,pixelType:h}=a,m=a.outMin||0,n=a.outMax||255;if(-1===["u8","u16","s8","s16"].indexOf(h))return null;const p=g.length;let c;let f=0;"s8"===
h?f=-127:"s16"===h&&(f=-32767);let d=256;-1<["u16","s16"].indexOf(h)&&(d=65536);const k=[],q=n-m;for(c=0;c<p;c++)k[c]=b[c]-g[c];var l=e&&e.length>=p;const r=[];if(l)for(c=0;c<p;c++)r[c]=1<e[c]?2<e[c]?6.5+Math.pow(e[c]-2,2.5):6.5+100*Math.pow(2-e[c],4):1;let v;const x=[];let z,L,K;if(l)for(c=0;c<p;c++){K=[];for(l=0;l<d;l++)z=l+f,v=(z-g[c])/k[c],L=1,1<e[c]&&(L-=Math.pow(1/q,v*r[c])),K[l]=z<b[c]&&z>g[c]?Math.floor(L*q*Math.pow(v,1/e[c]))+m:z>=b[c]?n:m;x[c]=K}else for(c=0;c<p;c++){K=[];for(l=0;l<d;l++)z=
l+f,K[l]=z<=g[c]?m:z>=b[c]?n:Math.floor((z-g[c])/k[c]*q)+m;x[c]=K}if(null!=a.contrastOffset)for(a=u(a.contrastOffset,a.brightnessOffset),c=0;c<p;c++)for(K=x[c],l=0;l<d;l++)K[l]=a[K[l]];return{lut:x,offset:f}};C.estimateStatisticsFromHistograms=function(a){const g=[];for(let m=0;m<a.length;m++){const {min:n,max:p,size:c,counts:f}=a[m];let d=0;var b=0;for(var e=0;e<c;e++)d+=f[e],b+=e*f[e];b/=d;e=0;for(var h=0;h<c;h++)e+=f[h]*Math.pow(h-b,2);h=(p-n)/c;g.push({min:n,max:p,avg:(b+.5)*h+n,stddev:Math.sqrt(e/
(d-1))*h})}return g};C.estimateStatisticsHistograms=function(a){if(!A(a))return null;a.statistics||a.updateStatistics();const {pixels:g,mask:b,pixelType:e,statistics:h}=a;a=a.width*a.height;const m=g.length;let n,p;let c;var f;const d=[],k=[];for(c=0;c<m;c++){var q=new Uint32Array(256);var l=g[c];if("u8"===e)if(n=-.5,p=255.5,b)for(f=0;f<a;f++)b[f]&&q[l[f]]++;else for(f=0;f<a;f++)q[l[f]]++;else{n=h[c].minValue;p=h[c].maxValue;var r=(p-n)/256;var v=new Uint32Array(257);if(b)for(f=0;f<a;f++)b[f]&&v[Math.floor((l[f]-
n)/r)]++;else for(f=0;f<a;f++)v[Math.floor((l[f]-n)/r)]++;for(f=0;255>f;f++)q[f]=v[f];q[255]=v[255]+v[256]}d.push({min:n,max:p,size:256,counts:q});for(f=l=v=r=0;256>f;f++)r+=q[f],v+=f*q[f];v/=r;for(f=0;256>f;f++)l+=q[f]*Math.pow(f-v,2);q=Math.sqrt(l/(r-1));r=(p-n)/256;f=(v+.5)*r+n;q*=r;k.push({min:n,max:p,avg:f,stddev:q})}return{statistics:k,histograms:d}};C.extractBands=function(a,g){if(!g||!A(a))return a;const b=a.pixels.length;return g&&g.some(e=>e>=b)||1===b&&1===g.length&&0===g[0]||b===g.length&&
!g.some((e,h)=>e!==h)?a:new D({pixelType:a.pixelType,width:a.width,height:a.height,mask:a.mask,validPixelCount:a.validPixelCount,maskIsAlpha:a.maskIsAlpha,pixels:g.map(e=>a.pixels[e]),statistics:a.statistics&&g.map(e=>a.statistics[e])})};C.getClipBounds=G;C.lookupPixels=function(a,g){if(!A(a))return null;const {pixels:b,mask:e}=a,h=a.width*a.height,m=b.length;let n=g.lut;({offset:g}=g);let p,c;n&&1===n[0].length&&(n=b.map(()=>n));const f=[];let d,k,q;if(g)if(null==e)for(p=0;p<m;p++){d=b[p];k=n[p];
q=new Uint8Array(h);for(c=0;c<h;c++)q[c]=k[d[c]-g];f.push(q)}else for(p=0;p<m;p++){d=b[p];k=n[p];q=new Uint8Array(h);for(c=0;c<h;c++)e[c]&&(q[c]=k[d[c]-g]);f.push(q)}else if(null==e)for(p=0;p<m;p++){d=b[p];k=n[p];q=new Uint8Array(h);for(c=0;c<h;c++)q[c]=k[d[c]];f.push(q)}else for(p=0;p<m;p++){d=b[p];k=n[p];q=new Uint8Array(h);for(c=0;c<h;c++)e[c]&&(q[c]=k[d[c]]);f.push(q)}a=new D({width:a.width,height:a.height,pixels:f,mask:e,pixelType:"u8"});a.updateStatistics();return a};C.mosaic=y;C.mosaicPixelData=
function(a,g){if(!a||0===a.length)return null;var b=a.filter(k=>k.pixelBlock)[0];if(!b)return null;var e=(b.extent.xmax-b.extent.xmin)/b.pixelBlock.width;const h=(b.extent.ymax-b.extent.ymin)/b.pixelBlock.height,m=.01*Math.min(e,h),n=a.sort((k,q)=>Math.abs(k.extent.ymax-q.extent.ymax)>m?q.extent.ymax-k.extent.ymax:Math.abs(k.extent.xmin-q.extent.xmin)>m?k.extent.xmin-q.extent.xmin:0);var p=Math.min.apply(null,n.map(k=>k.extent.xmin));const c=Math.min.apply(null,n.map(k=>k.extent.ymin)),f=Math.max.apply(null,
n.map(k=>k.extent.xmax)),d=Math.max.apply(null,n.map(k=>k.extent.ymax));a={x:Math.round((g.xmin-p)/e),y:Math.round((d-g.ymax)/h)};p={width:Math.round((f-p)/e),height:Math.round((d-c)/h)};e={width:Math.round((g.xmax-g.xmin)/e),height:Math.round((g.ymax-g.ymin)/h)};if(Math.round(p.width/b.pixelBlock.width)*Math.round(p.height/b.pixelBlock.height)!==n.length||0>a.x||0>a.y||p.width<e.width||p.height<e.height)return null;b=n.map(k=>k.pixelBlock);b=y(b,p,a,e);return{extent:g,pixelBlock:b}};C.remapColor=
function(a,g){if(!A(a))return null;a=a.clone();var {pixels:b}=a;const e=a.width*a.height,h=g.length,m=Math.floor(h/2),n=g[Math.floor(m)];b=b[0];let p,c,f,d,k,q,l=!1;const r=new Uint8Array(e),v=new Uint8Array(e),x=new Uint8Array(e);let z=a.mask;const L=4===g[0].mappedColor.length;z||(z=new Uint8Array(e),z.fill(L?255:1),a.mask=z);for(k=0;k<e;k++)if(z[k]){p=b[k];l=!1;q=m;c=n;f=0;for(d=h-1;1<d-f;){if(p===c.value){l=!0;break}p>c.value?f=q:d=q;q=Math.floor((f+d)/2);c=g[Math.floor(q)]}l||(p===g[f].value?
(c=g[f],l=!0):p===g[d].value?(c=g[d],l=!0):p<g[f].value?(l=!1,c=null):p>g[f].value&&(p<g[d].value?(c=g[f],l=!0):d===h-1?(l=!1,c=null):(c=g[d],l=!0)));l?(r[k]=c.mappedColor[0],v[k]=c.mappedColor[1],x[k]=c.mappedColor[2],z[k]=c.mappedColor[3]):r[k]=v[k]=x[k]=z[k]=0}a.pixels=[r,v,x];a.mask=z;a.pixelType="u8";a.maskIsAlpha=L;return a};C.resampleByMajority=E;C.setValidBoundary=function(a,g,b){if(!A(a))return null;const {width:e,height:h}=a,m=g.x;g=g.y;const n=b.width+m;b=b.height+g;if(0>m||0>g||n>e||b>
h||0===m&&0===g&&n===e&&b===h)return a;a.mask||(a.mask=new Uint8Array(e*h));const p=a.mask;for(let c=0;c<h;c++){const f=c*e;for(let d=0;d<e;d++)p[f+d]=c<g||c>=b||d<m||d>=n?0:1}a.updateStatistics();return a};C.split=function(a,g,b){if(!A(a))return null;const {width:e,height:h}=g;let {width:m,height:n}=a;const p=new Map,c={x:0,y:0};b=null==b?1:1+b;for(let f=0;f<b;f++){const d=Math.ceil(m/e),k=Math.ceil(n/h);for(let q=0;q<k;q++){c.y=q*h;for(let l=0;l<d;l++){c.x=l*e;const r=B(a,c,g);p.set(`${f}/${q}/${l}`,
r)}}f<b-1&&(a=w(a));m=Math.round(m/2);n=Math.round(n/2)}return p};C.stretch=function(a,g){if(!A(a))return null;a=a.clone();const {pixels:b,mask:e}=a,{minCutOff:h,maxCutOff:m,gamma:n}=g,p=g.outMin||0;g=g.outMax||255;const c=a.width*a.height,f=b.length;let d;let k,q,l;const r=g-p,v=[];for(d=0;d<f;d++)v[d]=m[d]-h[d];var x=n&&n.length>=f;const z=[];if(x)for(d=0;d<f;d++)z[d]=1<n[d]?2<n[d]?6.5+Math.pow(n[d]-2,2.5):6.5+100*Math.pow(2-n[d],4):1;if(x)if(null!=e)for(x=0;x<c;x++){if(e[x])for(d=0;d<f;d++)k=b[d][x],
l=(k-h[d])/v[d],q=1,1<n[d]&&(q-=Math.pow(1/r,l*z[d])),b[d][x]=k<m[d]&&k>h[d]?Math.floor(q*r*Math.pow(l,1/n[d]))+p:k>=m[d]?g:p}else for(x=0;x<c;x++)for(d=0;d<f;d++)k=b[d][x],l=(k-h[d])/v[d],q=1,1<n[d]&&(q-=Math.pow(1/r,l*z[d])),b[d][x]=k<m[d]&&k>h[d]?Math.floor(q*r*Math.pow(l,1/n[d]))+p:k>=m[d]?g:p;else if(null!=e)for(x=0;x<c;x++){if(e[x])for(d=0;d<f;d++)k=b[d][x],b[d][x]=k<m[d]&&k>h[d]?Math.floor((k-h[d])/v[d]*r)+p:k>=m[d]?g:p}else for(x=0;x<c;x++)for(d=0;d<f;d++)k=b[d][x],b[d][x]=k<m[d]&&k>h[d]?
Math.floor((k-h[d])/v[d]*r)+p:k>=m[d]?g:p;a.pixelType="u8";a.updateStatistics();return a};Object.defineProperty(C,"__esModule",{value:!0})})},"esri/layers/support/rasterFunctions/rasterProjectionHelper":function(){define("exports ../../../core/Error ../../../geometry/support/spatialReferenceUtils ../../../geometry/support/webMercatorUtils ../../../geometry/Point ../../../geometry/Extent ../../../geometry ../../../core/unitUtils ../../../geometry/projection".split(" "),function(C,D,u,G,y,E,I,H,F){function B(b,
e,h,m=null){if(b.spatialReference.equals(e))return b;const n=g(b.spatialReference,e);if(n&&!F.isLoaded())throw new D("rasterprojectionhelper-projectResolution","projection engine is not loaded");h=h.center;b=new E({xmin:h.x-b.x/2,xmax:h.x+b.x/2,ymin:h.y-b.y/2,ymax:h.y+b.y/2,spatialReference:b.spatialReference});e=n?F.project(b,e,m):G.project(b,e);return null==e?null:{x:e.xmax-e.xmin,y:e.ymax-e.ymin}}function w(b,e=.01){return H.getMetersPerUnitForSR(b)?e/H.getMetersPerUnitForSR(b):0}function A(b,
e,h=null,m=!0){const n=b.spatialReference;if(n.equals(e))return b;const p=g(n,e);if(p&&!F.isLoaded())throw new D("rasterprojectionhelper-projectResolution","projection engine is not loaded");if((h=p?F.project(b,e,h):G.project(b,e))&&m&&e.isGeographic){var c,f;const [d,k]=n.isWebMercator?u.getInfo(n).origin:null!=(c=null==(f=u.getInfo(n))?void 0:f.valid)?c:[];(e=w(n))&&null!=d&&null!=k&&(Math.abs(b.x-d)<e&&5E-4>Math.abs(180-h.x)?h.x-=360:Math.abs(b.x-k)<e&&5E-4>Math.abs(180+h.x)&&(h.x+=360))}return h}
function a(b,e,h=null,m=!0){var n,p,c,f;const d=b.spatialReference;if(d.equals(e))return b;var k=g(d,e);if(k&&!F.isLoaded())throw new D("rasterprojectionhelper-projectExtent","projection engine is not loaded");k=k?F.project(b,e,h):G.project(b,e);let [q,l]=null!=(n=null==(p=u.getInfo(d))?void 0:p.origin)?n:[];k&&m&&d.isWebMercator&&e.isGeographic&&null!=q&&null!=l&&(.001>Math.abs(b.xmin-q)&&1E3<Math.abs(l-b.xmax)&&5E-4>Math.abs(180-k.xmax)&&(k.xmin=-180,m=[],m.push(new y(b.xmax,b.ymin,d)),m.push(new y(b.xmax,
(b.ymin+b.ymax)/2,d)),m.push(new y(b.xmax,b.ymax,d)),m=m.map(r=>A(r,e,h)).filter(r=>!isNaN(null==r?void 0:r.x)).map(r=>r.x),k.xmax=Math.max.apply(null,m)),.001>Math.abs(b.xmax-l)&&1E3<Math.abs(q-b.xmin)&&5E-4>Math.abs(180+k.xmin)&&(k.xmax=180,m=[],m.push(new y(b.xmin,b.ymin,d)),m.push(new y(b.xmin,(b.ymin+b.ymax)/2,d)),m.push(new y(b.xmin,b.ymax,d)),b=m.map(r=>A(r,e,h)).filter(r=>!isNaN(null==r?void 0:r.x)).map(r=>r.x),k.xmin=Math.min.apply(null,b)));[q,l]=e.isWebMercator?u.getInfo(e).origin:null!=
(c=null==(f=u.getInfo(e))?void 0:f.valid)?c:[];(c=w(e))&&null!=q&&null!=l&&(Math.abs(k.xmin-q)<c&&(k.xmin=q),Math.abs(k.xmax-l)<c&&(k.xmax=l));return k}const g=function(b,e){const h=(b.isWGS84||b.isWebMercator)&&(e.isWGS84||e.isWebMercator);return!(b.equals(e)||h)};C.computeProjectedScales=function(b,e,h=512,m=!0){const {extent:n,spatialReference:p,pixelSize:c}=b,f=B(new y({x:c.x,y:c.y,spatialReference:p}),e,n);if(null==f)return{projectedPixelSize:null,scales:null,srcResolutions:null};var d=(f.x+
f.y)/2,k=H.getMetersPerUnitForSR(e);d=d*k*96*39.37;h=e.isGeographic?512/h*2.958287637958547E8:512/h*5.91657527591555E8;let q=!1;m&&(e.isGeographic||e.isWebMercator)&&(m=a(n,e),q=0>m.xmin*m.xmax);m=d;if(q)m=h,b=m/(96*k*39.37),e=B(new y({x:b,y:b,spatialReference:e}),p,n);else{e={x:c.x,y:c.y};b=Math.ceil(Math.log(Math.min(b.width,b.height)/32)/Math.LN2);for(k=0;m<.5005*h&&k<b;)k++,m*=2,e.x*=2,e.y*=2;1.001>=Math.max(m,h)/Math.min(m,h)&&(m=h)}b=[];h=[];for(d=Math.min(70.5310735,d)/1.001;m>=d;)b.push(m),
h.push({x:e.x,y:e.y}),m/=2,e.x/=2,e.y/=2;return{projectedPixelSize:f,scales:b,srcResolutions:h}};C.defaultGridSpacing=32;C.getProjectionOffsetGrid=function(b,e,h,m=null,n=null,p=!1,c=[32,32]){var f,d;if(g(b.spatialReference,e.spatialReference)&&!F.isLoaded())throw new D("rasterprojectionhelper-projectResolution","projection engine is not loaded");if(!(b&&e&&h))return null;const {xmin:k,ymin:q,xmax:l,ymax:r}=b;var v=b.spatialReference,x=e.spatialReference;const [z,L]=null!=(f=null==(d=u.getInfo(v))?
void 0:d.valid)?f:[];var K=c[0]*h.x,M=c[1]*h.y;h=Math.ceil((l-k)/K-.1)+1;f=Math.ceil((r-q)/M-.1)+1;d=[];b=!1;for(var S=0;S<h;S++){var P=[];for(var Q=0;Q<f;Q++){var O=new y({x:k+K*S,y:r-M*Q,spatialReference:v});O=A(O,x,m);n&&(O=n.inverseTransform(O));P.push(O);0<S&&p&&O&&U[Q]&&null!=z&&O.x<U[Q].x&&(O.x+=L-z);O?(d.push((O.x-e.xmin)/(e.xmax-e.xmin)),d.push((e.ymax-O.y)/(e.ymax-e.ymin))):(d.push(NaN),d.push(NaN),b=!0)}var U=P}e=[Math.abs((d[0]+d[4]+d[4*h]+d[4*h+4])/4-d[2*f+2]),Math.abs((d[1]+d[5]+d[4*
f+1]+d[4*f+5])/4-d[2*f+3])];m=new Float32Array((h-1)*(f-1)*12);n=new Float32Array([-0,-1,1,-1,1,-0,1,-0,-0]);p=new Float32Array([-1,1,0,0,-1,1,1,0,0]);for(U=0;U<h-1;U++){for(v=0;v<f-1;v++){Q=U*f*2+2*v;M=d[Q];x=d[Q+1];var R=d[Q+2],t=d[Q+3];Q+=2*f;S=d[Q];K=d[Q+1];P=d[Q+2];Q=d[Q+3];O=0;let J=12*(v*(h-1)+U);for(let N=0;3>N;N++)m[J++]=n[O++]*M+n[O++]*R+n[O++]*P;O=0;for(R=0;3>R;R++)m[J++]=n[O++]*x+n[O++]*t+n[O++]*Q;O=0;for(t=0;3>t;t++)m[J++]=p[O++]*M+p[O++]*S+p[O++]*P;O=0;for(M=0;3>M;M++)m[J++]=p[O++]*
x+p[O++]*K+p[O++]*Q}if(b)for(v=0;v<m.length;v++)isNaN(m[v])&&(m[v]=-1)}return{offsets:d,error:e,coefficients:m,spacing:c,size:[h-1,f-1]}};C.load=async function(){if(F.isLoaded()||!F.isSupported())return null;await F.load()};C.projectExtent=a;C.projectPoint=A;C.projectResolution=B;C.snapPyramid=function(b,e,h){var m=Math.log(b.x/e.pixelSize.x)/Math.LN2;const n=Math.log(b.y/e.pixelSize.y)/Math.LN2;b=e.storageInfo.maximumPyramidLevel||0;h="down"===h?Math.floor(Math.min(m,n)):"up"===h?Math.ceil(Math.max(m,
n)):Math.round((m+n)/2);m=!1;0>h?h=0:h>b&&(m=h>b+3,h=b);b=Math.pow(2,h);e=new y({x:b*e.nativePixelSize.x,y:b*e.nativePixelSize.y,spatialReference:e.spatialReference});return{pyramidLevel:h,pyramidResolution:e,excessiveReading:m}};Object.defineProperty(C,"__esModule",{value:!0})})},"esri/layers/support/rasterDatasets/RawBlockCache":function(){define("exports ../../../core/maybe ../../../geometry/Point ../../../geometry ./EphemeralBlockCache ../rasterFunctions/rasterProjectionHelper".split(" "),function(C,
D,u,G,y,E){function I(B,w){if(!H.has(B))return null;B=H.get(B);return null==B[w]?null:B[w]}const H=new Map,F=new y;C.decreaseRefCount=function(B,w,A){if(!H.has(B))return null==w?F.decreaseRefCount(B,A):0;const a=H.get(B);if(null==a[w])return F.decreaseRefCount(B,A);w=a[w].cache;if(w.has(A)){B=w.get(A);B.refCount--;if(0===B.refCount){w.delete(A);for(w=0;w<a.length;w++)a[w]&&a[w].cache.has(A)&&a[w].cache.delete(A);B.controller&&B.controller.abort()}return B.refCount}return 0};C.deleteBlock=function(B,
w,A){if(H.has(B)){var a=H.get(B);null==a[w]?F.deleteBlock(B,A):a[w].cache.delete(A)}else null==w&&F.deleteBlock(B,A)};C.deleteRaster=function(B){H.delete(B)};C.getBlock=function(B,w,A){if(!H.has(B))return null==w?F.getBlock(B,A):null;var a=H.get(B);if(null==a[w]){for(w=0;w<a.length;w++)if(a[w]&&a[w].cache.has(A))return A=a[w].cache.get(A),A.refCount++,A.block;return F.getBlock(B,A)}B=a[w].cache;if(B.has(A))return A=B.get(A),A.refCount++,A.block;for(let g=0;g<a.length;g++)if(g!==w&&a[g]&&a[g]&&a[g].cache.has(A))return a=
a[g].cache.get(A),a.refCount++,B.set(A,a),a.block;return null};C.getRasterId=function(B,w){return null==w?B:`${B}?sliceId=${w}`};C.putBlock=function(B,w,A,a,g=null){if(H.has(B)){var b=H.get(B);if(null==b[w])F.putBlock(B,A,a,g);else{var e={refCount:1,block:a,isResolved:!1,isRejected:!1,controller:g};a.then(()=>e.isResolved=!0).catch(()=>e.isRejected=!0);b[w].cache.set(A,e)}}else null==w&&F.putBlock(B,A,a,g)};C.register=function(B,w){w={extent:null,rasterInfo:w,cache:new Map};if(H.has(B))return B=H.get(B),
B.push(w),B.length-1;H.set(B,[w]);return 0};C.unregister=function(B,w){H.has(B)&&(H.get(B)[w]=null)};C.update=function(B,w,A,a,g,b,e=null){B=I(B,w);w=B.extent;const {cache:h,rasterInfo:m}=B;if(!w||w.xmin!==A.xmin||w.xmax!==A.xmax||w.ymin!==A.ymin||w.ymax!==A.ymax){w=A.clone().normalize();var {spatialReference:n,transform:p}=m,c=new Set;for(let r=0;r<w.length;r++){var f=w[r];if(f.xmax-f.xmin<=a||f.ymax-f.ymin<=a)continue;var d=E.projectExtent(f,n,e);D.isSome(p)&&(d=p.inverseTransform(d));var k=new u({x:a,
y:a,spatialReference:f.spatialReference});if(null===g&&(g=E.projectResolution(k,n,f,e),!g))return;const {pyramidLevel:v,pyramidResolution:x,excessiveReading:z}=E.snapPyramid(g,m,b||"closest");if(z)return;({storageInfo:f}=m);var {origin:q}=f;k=Math.max(0,Math.floor((d.xmin-q.x)/x.x));q=Math.max(0,Math.floor((q.y-d.ymax)/x.y));const L=0<v?f.pyramidBlockWidth:f.blockWidth,K=0<v?f.pyramidBlockHeight:f.blockHeight;f=Math.max(0,Math.floor(k/L)-1);var l=Math.max(0,Math.floor(q/K)-1);k=Math.floor((k+Math.ceil((d.xmax-
d.xmin)/x.x-.1)-1)/L)+1;d=Math.floor((q+Math.ceil((d.ymax-d.ymin)/x.y-.1)-1)/K)+1;for(q=l;q<=d;q++)for(l=f;l<=k;l++)c.add(`${v}/${q}/${l}`)}h.forEach((r,v)=>{c.has(v)||(r=h.get(v),(null==r||r.isResolved||r.isRejected)&&h.delete(v))});B.extent={xmin:A.xmin,ymin:A.ymin,xmax:A.xmax,ymax:A.ymax}}};Object.defineProperty(C,"__esModule",{value:!0})})},"esri/layers/support/rasterDatasets/EphemeralBlockCache":function(){define(function(){return function(){function C(u=15E3,G=5E3){this._timer=null;this._cachedBlocks=
new Map;this._size=-1;this._duration=u;this._interval=Math.min(u,G)}var D=C.prototype;D.decreaseRefCount=function(u,G){u=u+"/"+G;G=this._cachedBlocks;if(G.has(u)){const y=G.get(u);y.refCount--;0>=y.refCount&&(G.delete(u),y.controller&&y.controller.abort());return y.refCount}return 0};D.getBlock=function(u,G){u=u+"/"+G;G=this._cachedBlocks;if(G.has(u)){const y=G.get(u);y.ts=Date.now();y.refCount++;G.delete(u);G.set(u,y);return y.block}return null};D.putBlock=function(u,G,y,E=null){const I=this._cachedBlocks;
u=u+"/"+G;I.has(u)?(y=I.get(u),y.ts=Date.now(),y.refCount++):I.set(u,{block:y,ts:Date.now(),refCount:1,controller:E});this.trim();this.updateTimer()};D.deleteBlock=function(u,G){const y=this._cachedBlocks;u=u+"/"+G;y.has(u)&&y.delete(u)};D.updateMaxSize=function(u){this._size=u;this.trim()};D.empty=function(){this._cachedBlocks.clear();this.clearTimer()};D.getCurrentSize=function(){return this._cachedBlocks.size};D.updateTimer=function(){if(null==this._timer){var u=this._cachedBlocks;this._timer=
setInterval(()=>{const G=Array.from(u),y=Date.now();for(let E=0;E<G.length;E++)if(G[E][1].ts<=y-this._duration)u.delete(G[E][0]);else break;0===u.size&&this.clearTimer()},this._interval)}};D.trim=function(){const u=this._cachedBlocks;if(!(-1===this._size||this._size>=u.size)){var G=Array.from(u);for(let y=0;y<G.length-this._size;y++)u.delete(G[y][0])}};D.clearTimer=function(){null!=this._timer&&(clearInterval(this._timer),this._timer=null)};return C}()})},"esri/views/support/drapedUtils":function(){define("exports ../../core/maybe ../../geometry/Extent ../../geometry ../../core/unitUtils ../../renderers/support/clickToleranceUtils".split(" "),
function(C,D,u,G,y,E){function I(F,B,w,A=new u){let a;if("2d"===w.type)a=B*w.resolution;else if("3d"===w.type){var g=w.overlayPixelSizeInMapUnits(F),b=w.basemapSpatialReference;a=D.isSome(b)&&!b.equals(w.spatialReference)?y.getMetersPerUnitForSR(b)/y.getMetersPerUnitForSR(w.spatialReference):B*g}B=F.x-a;g=F.y-a;b=F.x+a;F=F.y+a;({spatialReference:w}=w);A.xmin=Math.min(B,b);A.ymin=Math.min(g,F);A.xmax=Math.max(B,b);A.ymax=Math.max(g,F);A.spatialReference=w;return A}const H=new u;C.createQueryGeometry=
I;C.intersectsDrapedGeometry=function(F,B,w){F=w.toMap(F);if(D.isNone(F))return!1;const A=E.calculateTolerance();return I(F,A,w,H).intersects(B)};Object.defineProperty(C,"__esModule",{value:!0})})},"esri/renderers/support/clickToleranceUtils":function(){define(["exports"],function(C){function D(y,E){return E?"xoffset"in E&&E.xoffset?Math.max(y,Math.abs(E.xoffset)):"yoffset"in E&&E.yoffset?Math.max(y,Math.abs(E.yoffset||0)):y:y}function u(y,E){if("number"===typeof y)return y;if(y&&y.stops&&y.stops.length){{y=
y.stops;let I=E=0;for(let H=0;H<y.length;H++){const F=y[H].size;"number"===typeof F&&(E+=F,I++)}y=E/I}return y}return E}function G(y,E){if(!E)return y;E=E.filter(F=>"size"===F.type).map(F=>{const {maxSize:B,minSize:w}=F;return(u(B,y)+u(w,y))/2});let I=0;const H=E.length;if(0===H)return y;for(let F=0;F<H;F++)I+=E[F];return Math.max(Math.floor(I/H),y)}C.calculateTolerance=function(y){const E=y&&y.renderer;y="touch"===(y&&y.event&&y.event.pointerType)?9:6;if(!E)return y;y="visualVariables"in E?G(y,E.visualVariables):
y;if("simple"===E.type)return D(y,E.symbol);if("unique-value"===E.type){let I=y;E.uniqueValueInfos.forEach(H=>{I=D(I,H.symbol)});return I}if("class-breaks"===E.type){let I=y;E.classBreakInfos.forEach(H=>{I=D(I,H.symbol)});return I}return y};Object.defineProperty(C,"__esModule",{value:!0})})},"esri/views/layers/ImageryTileLayerView":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/has ../../core/maybe ../../core/Logger ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/property ../../core/jsonMap ../../core/accessorSupport/decorators/subclass ../../core/Error ../../core/urlUtils ../../core/uuid ../../portal/support/resourceExtension ../../core/promiseUtils ../../Graphic ../../layers/support/rasterFunctions/rasterProjectionHelper ./support/popupUtils".split(" "),
function(C,D,u,G,y,E,I,H,F,B,w,A,a,g,b,e,h,m){C.ImageryTileLayerView=n=>{n=function(p){function c(){var d=p.apply(this,arguments)||this;d._rasterFieldPrefix="Raster.";d.layer=null;d.view=null;d.fullExtent=null;d.tileInfo=null;d.datumTransformation=null;return d}D._inheritsLoose(c,p);var f=c.prototype;f.fetchPopupFeatures=async function(d,k){const {layer:q}=this;if(!d)return b.reject(new w("imageryTileLayerView:fetchPopupFeatures","Nothing to fetch without area",{layer:q}));var {popupEnabled:l}=q;
k=m.getFetchPopupTemplate(q,k);if(!l||!y.isSome(k))throw new w("imageryTileLayerView:fetchPopupFeatures","Missing required popupTemplate or popupEnabled",{popupEnabled:l,popupTemplate:k});l=[];({value:d}=await q.identify(d));if(d){var r,v;const z=d.join(", ");d={ObjectId:0};d["Raster.ServicePixelValue"]=this._formatAttributeValue(z,"Raster.ServicePixelValue");if((k=null==(r=q.rasterInfo)?void 0:null==(v=r.attributeTable)?void 0:v.features)&&0<k.length&&(r=k.filter(L=>String(L.attributes.value||L.attributes.Value||
L.attributes.VALUE)===z),0<r.length&&(r=r[0])))for(var x in r.attributes)r.attributes.hasOwnProperty(x)&&(v=this._rasterFieldPrefix+x,d[v]=this._formatAttributeValue(r.attributes[x],v));x=new e(this.fullExtent.clone(),null,d);x.layer=q;x.sourceLayer=x.layer;l.push(x)}return l};f.updateFullExtent=function(){var d=this.layer.tileInfo;let k;d&&d.spatialReference||(k=new w("layerview:tiling-information-missing","The layer doesn't provide tiling information",{layer:this.layer}));d=h.projectExtent(this.layer.fullExtent,
this.view.spatialReference,this.datumTransformation);null==d&&(k=new w("layerview:projection-not-supported","The layer extent cannot be projected to the view's spatial reference",{layer:this.layer}));this._set("fullExtent",d);return k?b.reject(k):b.resolve()};f._formatAttributeValue=function(d,k){if("string"===typeof d&&(k=(k=this._getFieldInfo(this.layer.popupTemplate&&this.layer.popupTemplate.fieldInfos,k))&&k.format)){let q,l;return-1<d.trim().indexOf(",")?(q=",",l=q+" ",this._formatDelimitedString(d,
q,l,k)):-1<d.trim().indexOf(" ")?(q=l=" ",this._formatDelimitedString(d,q,l,k)):this._formatNumberFromString(d,k)}return d};f._getFieldInfo=function(d,k){if(d&&d.length&&k){var q=k.toLowerCase(),l=void 0;d.some(r=>!r.fieldName||r.fieldName.toLowerCase()!==q&&r.fieldName.toLowerCase()!==q.replace(/ /g,"_")?!1:(l=r,!0));return l}};f._formatDelimitedString=function(d,k,q,l){return d&&k&&q&&l?d.trim().split(k).map(r=>this._formatNumberFromString(r,l)).join(q):d};f._formatNumberFromString=function(d,k){if(!d||
!k)return d;const q=Number(d);return isNaN(q)?d:k.format(q)};D._createClass(c,[{key:"hasTilingEffects",get:function(){return this.layer.renderer&&"dynamicRangeAdjustment"in this.layer.renderer&&this.layer.renderer.dynamicRangeAdjustment}}]);return c}(n);u.__decorate([H.property()],n.prototype,"layer",void 0);u.__decorate([H.property()],n.prototype,"view",void 0);u.__decorate([H.property()],n.prototype,"fullExtent",void 0);u.__decorate([H.property()],n.prototype,"tileInfo",void 0);u.__decorate([H.property({readOnly:!0,
dependsOn:["layer.renderer"]})],n.prototype,"hasTilingEffects",null);return n=u.__decorate([B.subclass("esri.views.layers.ImageryTileLayerView")],n)};Object.defineProperty(C,"__esModule",{value:!0})})},"esri/views/layers/support/popupUtils":function(){define(["exports","../../../core/maybe","../../../layers/support/fieldUtils"],function(C,D,u){C.getFetchPopupTemplate=function(G,y){return G.popupTemplate?G.popupTemplate:D.isSome(y)&&y.defaultPopupTemplateEnabled&&D.isSome(G.defaultPopupTemplate)?G.defaultPopupTemplate:
null};C.getRequiredFields=async function(G,y=G.popupTemplate){if(!D.isSome(y))return[];const E=await y.getRequiredFields(G.fields);({lastEditInfoEnabled:y}=y);const {objectIdField:I,typeIdField:H,globalIdField:F,relationships:B}=G;if(E.includes("*"))return["*"];y=y?await u.getFeatureEditFields(G):[];const w=u.fixFields(G.fields,[...E,...y]);H&&w.push(H);w&&I&&u.hasField(G.fields,I)&&-1===w.indexOf(I)&&w.push(I);w&&F&&u.hasField(G.fields,F)&&-1===w.indexOf(F)&&w.push(F);B&&B.forEach(A=>{({keyField:A}=
A);w&&A&&u.hasField(G.fields,A)&&-1===w.indexOf(A)&&w.push(A)});return w};Object.defineProperty(C,"__esModule",{value:!0})})},"esri/views/2d/engine/RasterTileContainer":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../geometry/support/aaBoundingRect ./webgl/enums ./brushes ./webgl/TileContainer ./RasterTile".split(" "),function(C,D,u,G,y,E,I){E=function(H){function F(){return H.apply(this,arguments)||this}D._inheritsLoose(F,H);var B=F.prototype;B.createTile=function(w){const A=
this._tileInfoView.getTileBounds(u.create(),w);return new I.RasterTile(w,A,this._tileInfoView.tileInfo.size)};B.destroyTile=function(){};B.prepareRenderPasses=function(w){const A=w.registerRenderPass({name:"bitmap (tile)",brushes:[y.brushes.raster],target:()=>this.children.map(a=>a.bitmap),drawPhase:G.WGLDrawPhase.MAP});return[...H.prototype.prepareRenderPasses.call(this,w),A]};B.doRender=function(w){this.visible&&w.drawPhase===G.WGLDrawPhase.MAP&&H.prototype.doRender.call(this,w)};return F}(E["default"]);
C.RasterTileContainer=E;Object.defineProperty(C,"__esModule",{value:!0})})},"esri/views/2d/engine/RasterTile":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","./webgl/TiledDisplayObject","./RasterBitmap"],function(C,D,u,G){u=function(y){function E(H,F,B,w=null){var A=y.call(this,H,F,B)||this;A.bitmap=new G.RasterBitmap(w,null,null);A.bitmap.coordScale=B;A.bitmap.once("isReady",()=>A.ready());return A}D._inheritsLoose(E,y);var I=E.prototype;I.getMemoryUsage=function(){return this.bitmap.getMemoryUsage()};
I.setTransform=function(H,F){y.prototype.setTransform.call(this,H,F);this.bitmap.transforms.dvs=this.transforms.dvs};I.release=function(){this.destroy();this.stage=this.bitmap=null;return!0};I.onAttach=function(){this.bitmap.stage=this.stage};I.onDetach=function(){this.bitmap.stage=null};D._createClass(E,[{key:"stencilRef",set:function(H){this.bitmap.stencilRef=H},get:function(){return this.bitmap.stencilRef}}]);return E}(u.TiledDisplayObject);C.RasterTile=u;Object.defineProperty(C,"__esModule",{value:!0})})},
"esri/views/2d/engine/RasterBitmap":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/maybe ../../../chunks/mat3 ../../../layers/support/rasterFunctions/pixelUtils ../../../chunks/mat3f32 ../../../chunks/vec2f32 ./DisplayObject ../../webgl/rasterUtils".split(" "),function(C,D,u,G,y,E,I,H,F){const B={bandCount:3,outMin:0,outMax:1,minCutOff:[0,0,0],maxCutOff:[255,255,255],factor:[1/255,1/255,1/255],useGamma:!1,gamma:[1,1,1],gammaCorrection:[1,1,1],colormap:null,colormapOffset:null,
type:"stretch"};H=function(w){function A(g=null,b=null,e=null){var h=w.call(this)||this;h._textureInvalidated=!0;h._memoryUsed=null;h._supportsBilinear=!0;h.stencilRef=0;h.coordScale=[1,1];h._symbolizerParameters=null;h.height=null;h.isRendereredSource=!1;h.pixelRatio=1;h.resolution=0;h.rotation=0;h._source=null;h.rawPixelData=null;h._suspended=!1;h._bandIds=null;h._interpolation=null;h._transformGrid=null;h.width=null;h.x=0;h.y=0;h.transforms={dvs:E.create()};h.source=g;h.transformGrid=b;h.interpolation=
e;return h}D._inheritsLoose(A,w);var a=A.prototype;a.invalidateTexture=function(){this._textureInvalidated||(this._textureInvalidated=!0,this.requestRender())};a.setTransform=function(g){const b=G.identity(this.transforms.dvs),[e,h]=g.toScreenNoRotation([0,0],this.x,this.y);var m=this.resolution/this.pixelRatio/g.resolution;const n=m*this.width;m*=this.height;const p=Math.PI*this.rotation/180;G.translate(b,b,I.fromValues(e,h));G.translate(b,b,I.fromValues(n/2,m/2));G.rotate(b,b,-p);G.translate(b,
b,I.fromValues(-n/2,-m/2));G.scaleByVec2(b,b,I.fromValues(n,m));G.multiply(this.transforms.dvs,g.displayViewMat3,b)};a.getTextures=function(){if(!this._rasterTexture)return null;const g=[],b=[];this._transformGridTexture&&(b.push(this._transformGridTexture),g.push("u_transformGrid"));this._rasterTexture&&(b.push(this._rasterTexture),g.push("u_image"));this._colormapTexture&&(b.push(this._colormapTexture),g.push("u_colormap"));return{names:g,textures:b}};a.getMemoryUsage=function(){if(u.isNone(this._memoryUsed)){const g=
this.getTextures();if(null==g)return 0;this._memoryUsed=g.textures.map(b=>b.descriptor.width*b.descriptor.height*4).reduce((b,e)=>b+e)}return this._memoryUsed};a.onAttach=function(){this.invalidateTexture()};a.onDetach=function(){this.invalidateTexture()};a.updateTexture=function({context:g}){if(this.stage)this._textureInvalidated&&(this._textureInvalidated=!1,b=(b=this.source)&&b.pixels&&0<b.pixels.length,this._createOrDestroyRasterTexture(g),this._rasterTexture&&(b?(this._updateColormapTexture(g),
this.transformGrid&&!this._transformGridTexture&&(this._transformGridTexture=F.createTransformTexture(g,this.transformGrid))):this._rasterTexture.setData(null)),this.suspended||(this.ready(),this.requestRender()));else{var b,e,h;null==(b=this._rasterTexture)?void 0:b.dispose();null==(e=this._transformGridTexture)?void 0:e.dispose();null==(h=this._colormapTexture)?void 0:h.dispose();this._colormapTexture=this._transformGridTexture=this._rasterTextureBandIds=this._rasterTexture=null}};a._createOrDestroyRasterTexture=
function(g){var b,e;const h=this.source?y.extractBands(this.source,this.bandIds):null;if(h&&h.pixels&&0<h.pixels.length){var m=null==this._rasterTextureBandIds&&null==this.bandIds||this._rasterTextureBandIds&&this.bandIds&&this._rasterTextureBandIds.join("")===this.bandIds.join("");if(this._rasterTexture){if(m)return;this._rasterTexture.dispose();this._rasterTexture=this._rasterTextureBandIds=null}m=this.interpolation||"nearest";var n=this.isRendereredSource||!(null!=(b=g.capabilities.textureFloat)&&
b.textureFloat);this._rasterTexture=F.createRasterTexture(g,h,m,n);this._supportsBilinear=null==(e=g.capabilities.textureFloat)?void 0:e.textureFloatLinear;this._rasterTextureBandIds=this.bandIds}else this._rasterTexture&&(this._rasterTexture.dispose(),this._rasterTexture=this._rasterTextureBandIds=null)};a._updateColormapTexture=function(g){const b=this._colormap,e=this.symbolizerParameters.colormap;if(!e)this._colormapTexture&&(this._colormapTexture.dispose(),this._colormapTexture=null),this._colormap=
null;else if(!b)this._colormapTexture=F.createColormapTexture(g,e),this._colormap=e;else if(e.length!==b.length||e.some((h,m)=>h!==b[m]))this._colormapTexture&&(this._colormapTexture.dispose(),this._colormapTexture=null),this._colormapTexture=F.createColormapTexture(g,e),this._colormap=e};D._createClass(A,[{key:"symbolizerParameters",get:function(){return this._symbolizerParameters||B},set:function(g){this._symbolizerParameters=g}},{key:"source",get:function(){return this._source},set:function(g){this._source=
g;this._rasterTexture&&(this._rasterTexture.dispose(),this._memoryUsed=this._rasterTextureBandIds=this._rasterTexture=null)}},{key:"suspended",get:function(){return this._suspended},set:function(g){this._suspended&&!g&&this.stage&&(this.ready(),this.requestRender());this._suspended=g}},{key:"bandIds",get:function(){return this._bandIds},set:function(g){this._bandIds=g;this.invalidateTexture()}},{key:"interpolation",get:function(){return this._interpolation},set:function(g){this._interpolation=g;this._rasterTexture&&
this._rasterTexture.setSamplingMode(!this._supportsBilinear||"bilinear"!==g&&"cubic"!==g?9728:9729)}},{key:"transformGrid",get:function(){return this._transformGrid},set:function(g){this._transformGrid=g;this._transformGridTexture&&(this._transformGridTexture.dispose(),this._memoryUsed=this._transformGridTexture=null)}}]);return A}(H.DisplayObject);C.RasterBitmap=H;Object.defineProperty(C,"__esModule",{value:!0})})},"esri/views/2d/layers/LayerView2D":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/has ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/property ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../core/urlUtils ../../../core/uuid ../../../portal/support/resourceExtension ../../../core/Collection ../../../core/collectionUtils ../../../core/watchUtils ../../layers/support/ClipArea ../../layers/support/ClipRect ../engine/Container ../../layers/support/Geometry ../../layers/support/Path".split(" "),
function(C,D,u,G,y,E,I,H,F,B,w,A,a,g,b,e,h,m,n,p){const c=a.ofType({key:"type",base:e,typeMap:{rect:h,path:p,geometry:n}});C.LayerView2DMixin=f=>{f=function(d){function k(){var l=d.apply(this,arguments)||this;l.clips=new c;l.moving=!1;l.attached=!1;l.lastUpdateId=-1;l.updateRequested=!1;return l}D._inheritsLoose(k,d);var q=k.prototype;q.initialize=function(){var l;this.container||(this.container=new m.Container);this.container.fadeTransitionEnabled=!0;this.container.opacity=0;this.container.clips=
this.clips;this.handles.add([b.init(this,"suspended",r=>{this.container&&(this.container.visible=!r);this.view&&!r&&this.updateRequested&&this.view.requestUpdate()},!0),b.init(this,["layer.opacity","container"],()=>{if(this.container){var r,v;this.container.opacity=null!=(r=null==(v=this.layer)?void 0:v.opacity)?r:1}},!0),b.init(this,["layer.blendMode"],r=>{this.container&&(this.container.blendMode=r)},!0),b.init(this,["layer.effect"],r=>{this.container&&(this.container.effect=r)},!0),this.clips.on("change",
()=>{this.container.clips=this.clips;this.notifyChange("clips")})]);null!=(l=this.view)&&l.whenLayerView?this.view.whenLayerView(this.layer).then(r=>{r!==this||this.attached||this.destroyed||(this.attach(),this.requestUpdate(),this.attached=!0)},()=>{}):this.when().then(()=>{this.attached||this.destroyed||(this.attach(),this.requestUpdate(),this.attached=!0)},()=>{})};q.destroy=function(){this.attached&&(this.detach(),this.attached=!1);this.handles.remove("initialize");this.updateRequested=!1};q.isVisibleAtScale=
function(l){var r=!0,v=this.layer;const x=v.minScale;v=v.maxScale;if(null!=x&&null!=v){r=!x;let z=!v;!r&&l<=x&&(r=!0);!z&&l>=v&&(z=!0);r=r&&z}return r};q.requestUpdate=function(){this.updateRequested||(this.updateRequested=!0,this.suspended||this.view.requestUpdate())};q.processUpdate=function(l){this.isFulfilled()&&!this.isResolved()?this.updateRequested=!1:(this._set("updateParameters",l),this.updateRequested&&!this.suspended&&(this.updateRequested=!1,this.update(l)))};q.isUpdating=function(){return!1};
q.isRendering=function(){return!1};q.canResume=function(){return d.prototype.canResume.call(this)?this.isVisibleAtScale(this.view.scale):!1};D._createClass(k,[{key:"updating",get:function(){return!this.attached||!this.suspended&&(this.updateRequested||this.isUpdating())}}]);return k}(f);u.__decorate([I.property({type:c,set(d){d=g.referenceSetter(d,this._get("clips"),c);this._set("clips",d)}})],f.prototype,"clips",void 0);u.__decorate([I.property()],f.prototype,"moving",void 0);u.__decorate([I.property()],
f.prototype,"attached",void 0);u.__decorate([I.property()],f.prototype,"container",void 0);u.__decorate([I.property({dependsOn:["view.scale","layer.minScale","layer.maxScale"]})],f.prototype,"suspended",void 0);u.__decorate([I.property({readOnly:!0})],f.prototype,"updateParameters",void 0);u.__decorate([I.property()],f.prototype,"updateRequested",void 0);u.__decorate([I.property({dependsOn:["attached","updateRequested","suspended"]})],f.prototype,"updating",null);u.__decorate([I.property()],f.prototype,
"view",void 0);return f=u.__decorate([F.subclass("esri.views.2d.layers.LayerView2D")],f)};Object.defineProperty(C,"__esModule",{value:!0})})},"esri/views/layers/support/ClipArea":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/has ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/property ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../core/urlUtils ../../../core/uuid ../../../portal/support/resourceExtension ../../../core/JSONSupport".split(" "),
function(C,D,u,G,y,E,I,H,F,B,w,A){u=function(a){function g(){return a.apply(this,arguments)||this}C._inheritsLoose(g,a);return g}(A.JSONSupport);return u=D.__decorate([H.subclass("esri.views.layers.support.ClipArea")],u)})},"esri/views/layers/support/ClipRect":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/has ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/property ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../core/urlUtils ../../../core/uuid ../../../portal/support/resourceExtension ./ClipArea".split(" "),
function(C,D,u,G,y,E,I,H,F,B,w,A){var a;u=a=function(g){function b(){var e=g.apply(this,arguments)||this;e.type="rect";e.left=null;e.right=null;e.top=null;e.bottom=null;return e}C._inheritsLoose(b,g);b.prototype.clone=function(){return new a({left:this.left,right:this.right,top:this.top,bottom:this.bottom})};C._createClass(b,[{key:"version",get:function(){return(this._get("version")||0)+1}}]);return b}(A);D.__decorate([E.property({type:[Number,String],json:{write:!0}})],u.prototype,"left",void 0);
D.__decorate([E.property({type:[Number,String],json:{write:!0}})],u.prototype,"right",void 0);D.__decorate([E.property({type:[Number,String],json:{write:!0}})],u.prototype,"top",void 0);D.__decorate([E.property({type:[Number,String],json:{write:!0}})],u.prototype,"bottom",void 0);D.__decorate([E.property({readOnly:!0,dependsOn:["left","right","top","bottom"]})],u.prototype,"version",null);return u=a=D.__decorate([H.subclass("esri.views.layers.support.ClipRect")],u)})},"esri/views/layers/support/Geometry":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/has ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/property ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../core/urlUtils ../../../core/uuid ../../../portal/support/resourceExtension ../../../geometry/Geometry ../../../geometry/Extent ../../../geometry/Polygon ../../../geometry/support/jsonUtils ../../../geometry ./ClipArea".split(" "),
function(C,D,u,G,y,E,I,H,F,B,w,A,a,g,b,e,h){var m;u={base:A,key:"type",typeMap:{extent:a,polygon:g}};h=m=function(n){function p(){var c=n.apply(this,arguments)||this;c.type="geometry";c.geometry=null;return c}C._inheritsLoose(p,n);p.prototype.clone=function(){return new m({geometry:this.geometry.clone()})};C._createClass(p,[{key:"version",get:function(){return(this._get("version")||0)+1}}]);return p}(h);D.__decorate([E.property({types:u,json:{read:b.fromJSON,write:!0}})],h.prototype,"geometry",void 0);
D.__decorate([E.property({readOnly:!0,dependsOn:["geometry"]})],h.prototype,"version",null);return h=m=D.__decorate([H.subclass("esri.views.layers.support.Geometry")],h)})},"esri/views/layers/support/Path":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/has ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/property ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../core/urlUtils ../../../core/uuid ../../../portal/support/resourceExtension ./ClipArea".split(" "),
function(C,D,u,G,y,E,I,H,F,B,w,A){u=function(a){function g(){var b=a.apply(this,arguments)||this;b.type="path";b.path=[];return b}C._inheritsLoose(g,a);C._createClass(g,[{key:"version",get:function(){return(this._get("version")||0)+1}}]);return g}(A);D.__decorate([E.property({type:[[[Number]]],json:{write:!0}})],u.prototype,"path",void 0);D.__decorate([E.property({readOnly:!0,dependsOn:["path"]})],u.prototype,"version",null);return u=D.__decorate([H.subclass("esri.views.layers.support.Path")],u)})},
"*noref":1}});
define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/has ../../../core/maybe ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/property ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../core/urlUtils ../../../core/uuid ../../../portal/support/resourceExtension ../../../core/promiseUtils ../../../geometry/Point ../../../geometry/Extent ../../../geometry ../../../core/screenUtils ../../../Graphic ../../../layers/support/PixelBlock ../../../core/watchUtils ../../../layers/support/TileInfo ../../../layers/support/rasterFunctions/pixelUtils ../../../layers/support/rasterFunctions/rasterProjectionHelper ../../../layers/support/rasterDatasets/RawBlockCache ../../layers/RefreshableLayerView ../../webgl/capabilities ../tiling/TileInfoView ../tiling/TileQueue ../tiling/TileStrategy ../../layers/LayerView ../../support/drapedUtils ../../layers/ImageryTileLayerView ../engine/RasterTileContainer ./LayerView2D".split(" "),function(C,
D,u,G,y,E,I,H,F,B,w,A,a,g,b,e,h,m,n,p,c,f,d,k,q,l,r,v,x,z,L,K,M,S){const P=y.getLogger("esri.views.2d.layers.ImageryTileLayerView2D"),Q=[0,0];u=function(O){function U(){var t=O.apply(this,arguments)||this;t._tileStrategy=null;t._tileInfoView=null;t._fetchQueue=null;t._blockCacheRegistryUrl=null;t._blockCacheRegistryId=null;t._bitmapView=null;t._emptyTilePixelBlock=null;t._srcResolutions=null;t._previousLOD=null;t._needBlockCacheUpdate=!1;t._globalSymbolizerParams=null;t._symbolizerParams=null;t._abortController=
null;t._globalUpdateRequested=!1;t.useWebGLForProcessing=!0;t.datumTransformation=null;t._redrawDebounced=a.debounce(J=>t._redrawImage(J),2E3);return t}C._inheritsLoose(U,O);var R=U.prototype;R.initialize=function(){const t=this.updateFullExtent();this.addResolvingPromise(t)};R.hitTest=function(t,J){if(this.suspended)return a.resolve(null);t=this.view.toMap(h.createScreenPoint(t,J));return a.resolve(new m({attributes:{},geometry:t}))};R.update=function(t){this._fetchQueue.pause();this._fetchQueue.state=
t.state;this._tileStrategy.update(t);this._fetchQueue.resume();const {extent:J,resolution:N,scale:T}=t.state;t=this._tileInfoView.getClosestInfoForScale(T);if(this.layer.raster){var V;if(!this.useProgressiveUpdate||this._needBlockCacheUpdate){const X=this._srcResolutions[t.level],W=J.toJSON?J:b.fromJSON(J);k.update(this._blockCacheRegistryUrl,this._blockCacheRegistryId,W,N,X,this.layer.raster.ioConfig.sampling)}this._needBlockCacheUpdate=!1;(null==(V=this._previousLOD)?void 0:V.level)!==t.level&&
(this._previousLOD=t,null!=this._symbolizerParams&&this._updateSymbolizerParams())}this.notifyChange("updating")};R.attach=function(){this.layer.increaseRasterJobHandlerUsage();l().supportsTextureFloat||(this.useWebGLForProcessing=!1);this.layer.raster&&(this.layer.raster.ioConfig.allowPartialFill=!0);this._initializeTileInfo();this._tileInfoView=new r(this.tileInfo,this.fullExtent);this._fetchQueue=new v({tileInfoView:this._tileInfoView,concurrency:10,process:(t,J)=>this.fetchTile(t,J)});this._tileStrategy=
new x({cachePolicy:this.useProgressiveUpdate?"keep":"purge",resampling:!1,acquireTile:t=>this.acquireTile(t),releaseTile:t=>this.releaseTile(t),cacheSize:this.useProgressiveUpdate?40:0,tileInfoView:this._tileInfoView});this._bitmapView=new M.RasterTileContainer(this._tileInfoView);this.container.addChild(this._bitmapView);this.handles.add([p.watch(this,["layer.bandIds","layer.renderer"],()=>this._redrawDebounced().catch(t=>{a.isAbortError(t)||P.error(t)})),p.watch(this,["layer.interpolation"],(t,
J)=>{"majority"!==t&&"majority"!==J||!this._canUseMajorityInterpolationOnDataSource()?this._redrawDebounced().catch(N=>{a.isAbortError(N)||P.error(N)}):this.refreshDebounced()}),p.watch(this,["layer.multidimensionalDefinition"],this.refreshDebounced)],"attach");this._updateBlockCacheRegistry()};R.detach=function(){this.handles.remove("attach");this.layer.decreaseRasterJobHandlerUsage();this._tileStrategy.destroy();this._fetchQueue.clear();this.container.removeAllChildren();this._fetchQueue=this._tileStrategy=
this._tileInfoView=null;k.unregister(this._blockCacheRegistryUrl,this._blockCacheRegistryId)};R.moveStart=function(){this.requestUpdate()};R.viewChange=function(){this.requestUpdate()};R.moveEnd=function(){if(this.hasTilingEffects||!this.useProgressiveUpdate)this._abortController&&this._abortController.abort(),this._abortController=a.createAbortController(),0===this._fetchQueue.length&&this._redrawImage(this._abortController.signal).then(()=>{this._globalUpdateRequested=!1;this.requestUpdate()});
this.requestUpdate()};R.createFetchPopupFeaturesQueryGeometry=function(t,J){return L.createQueryGeometry(t,J,this.view)};R.doRefresh=async function(){this.updateRequested||this.suspended||(this._updateSymbolizerParams(),this._updateBlockCacheRegistry(),this._fetchQueue.reset(),this._tileStrategy.tiles.forEach(t=>this._enqueueTileFetch(t)),this.notifyChange("updating"))};R.isUpdating=function(){return 0<this._fetchQueue.length||this._globalUpdateRequested};R.acquireTile=function(t){t=this._bitmapView.createTile(t);
const J=t.bitmap;[J.x,J.y]=this._tileInfoView.getTileCoords(Q,t.key);J.resolution=this._tileInfoView.getTileResolution(t.key);[J.width,J.height]=this._tileInfoView.tileInfo.size;this._enqueueTileFetch(t);this.requestUpdate();this._needBlockCacheUpdate=!0;this._globalUpdateRequested=this.hasTilingEffects||!this.useProgressiveUpdate;return t};R.releaseTile=function(t){this._fetchQueue.abort(t.key.id);this._bitmapView.removeChild(t);t.once("detach",()=>{t.destroy();this.requestUpdate()});this.requestUpdate()};
R.fetchTile=function(t,J){J=!G.isNone(J)&&J.signal;const N=this._canUseWebGLForProcessing();J={tileInfo:this.tileInfo,signal:G.unwrap(J),registryId:this._blockCacheRegistryId,requestRawData:N,srcResolution:this._srcResolutions[t.level],datumTransformation:this.datumTransformation,interpolation:N?"nearest":this.layer.interpolation};return this.layer.fetchTile(t.level,t.row,t.col,J)};R._canUseWebGLForProcessing=function(){return this.useWebGLForProcessing&&this.layer.symbolizer.canRenderInWebGL&&!("majority"===
this.layer.interpolation&&this._canUseMajorityInterpolationOnDataSource())};R._initializeTileInfo=function(){var t=this.view.spatialReference;const J=new g({x:this.fullExtent.xmin,y:this.fullExtent.ymax,spatialReference:t}),{scales:N,srcResolutions:T}=d.computeProjectedScales(this.layer.rasterInfo,t);t=c.create({spatialReference:t,size:512,scales:N});if(0===t.origin.x||t.origin.x>J.x)t.origin=J;this._set("tileInfo",t);this._srcResolutions=null!=T?T:[]};R._enqueueTileFetch=async function(t,J){if(!this._fetchQueue.has(t.key.id)){try{const N=
await this._fetchQueue.push(t.key),{bandIds:T}=this.layer;let V=!this.useProgressiveUpdate||this.hasTilingEffects&&!this._globalSymbolizerParams;if(this._globalUpdateRequested&&!this.moving&&0===this._fetchQueue.length){V=!1;try{await this._redrawImage(this._abortController&&this._abortController.signal)}catch(W){a.isAbortError(W)&&P.error(W)}this._globalUpdateRequested=!1}const X=this._canUseWebGLForProcessing();X&&!this.hasTilingEffects&&null==this._symbolizerParams&&this._updateSymbolizerParams();
if(N&&N.pixelBlock){if(X)t.bitmap.source=N.pixelBlock,t.bitmap.isRendereredSource=!1;else{const W={extent:N.extent,pixelBlock:N.pixelBlock},Y=await this.layer.applyRenderer(W,this.hasTilingEffects&&this._globalSymbolizerParams&&"stretch"===this._globalSymbolizerParams.type?this._globalSymbolizerParams:null);t.bitmap.rawPixelData=W;t.bitmap.source=Y;t.bitmap.isRendereredSource=!0}t.bitmap.symbolizerParameters=X?this._globalSymbolizerParams||this._symbolizerParams:null;t.bitmap.transformGrid=!t.bitmap.transformGrid&&
X?N.transformGrid:null}else{const W=this._createEmptyTilePixelBlock();t.bitmap.source=W;t.bitmap.symbolizerParameters=X?this._symbolizerParams:null;t.bitmap.transformGrid=null}t.bitmap.bandIds=T;t.bitmap.width=this._tileInfoView.tileInfo.size[0];t.bitmap.height=this._tileInfoView.tileInfo.size[1];t.bitmap.interpolation=this._getLayerInterpolation();t.bitmap.suspended=V;t.bitmap.invalidateTexture();t.once("attach",()=>this.requestUpdate());this._bitmapView.addChild(t)}catch(N){a.isAbortError(N)||P.error(N)}this.requestUpdate()}};
R._redrawImage=async function(t){this.layer.updateRenderer();this.hasTilingEffects?await this._updateGlobalSymbolizerParams(t):(this._updateSymbolizerParams(),this._globalSymbolizerParams=null);const {bandIds:J}=this.layer;t=this._bitmapView.children.map(async N=>{const T=this._canUseWebGLForProcessing();T?N.bitmap.isRendereredSource=!1:(N.bitmap.source=await this.layer.applyRenderer(N.bitmap.rawPixelData,this.hasTilingEffects&&this._globalSymbolizerParams&&"stretch"===this._globalSymbolizerParams.type?
this._globalSymbolizerParams:null),N.bitmap.isRendereredSource=!0);N.bitmap.symbolizerParameters=T?this._globalSymbolizerParams||this._symbolizerParams:null;N.bitmap.bandIds=J;N.bitmap.interpolation=this._getLayerInterpolation();N.bitmap.suspended=!1});await a.eachAlways(t);this.container.requestRender()};R._createEmptyTilePixelBlock=function(){if(!this._emptyTilePixelBlock){const t=this._tileInfoView.tileInfo.size[0],J=this._tileInfoView.tileInfo.size[1];this._emptyTilePixelBlock=new n({width:t,
height:J,pixels:[new Uint8Array(t*J)],mask:new Uint8Array(t*J),pixelType:"u8"})}return this._emptyTilePixelBlock};R._updateGlobalSymbolizerParams=async function(t){(t=await this.layer.fetchPixels(this.view.extent,this.view.width,this.view.height,{srcResolution:this._srcResolutions[this._previousLOD.level],registryId:this._blockCacheRegistryId,signal:t}))&&t.pixelBlock&&(t=this.layer.symbolizer.generateWebGLParameters({pixelBlock:f.extractBands(t.pixelBlock,this.layer.bandIds),isGCS:this.view.spatialReference.isGeographic,
resolution:{x:this._previousLOD.resolution,y:this._previousLOD.resolution},bandIds:this.layer.bandIds}),!this._canUseWebGLForProcessing()&&t&&"stretch"===t.type&&this.layer.renderer&&"raster-stretch"===this.layer.renderer.type&&(t.factor=t.factor.map(J=>255*J),t.outMin=Math.round(255*t.outMin),t.outMax=Math.round(255*t.outMax)),this._globalSymbolizerParams=t)};R._updateSymbolizerParams=function(){this._symbolizerParams=this.layer.symbolizer.generateWebGLParameters({pixelBlock:null,isGCS:this.view.spatialReference.isGeographic,
resolution:{x:this._previousLOD.resolution,y:this._previousLOD.resolution},bandIds:this.layer.bandIds})};R._updateBlockCacheRegistry=function(){const {url:t,rasterInfo:J,multidimensionalDefinition:N,raster:T}=this.layer;var V=null!=J&&J.multidimensionalInfo?T.getSliceIndex(N):null;V=k.getRasterId(t,V);V!==this._blockCacheRegistryUrl&&(null==this._blockCacheRegistryUrl&&k.unregister(this._blockCacheRegistryUrl,this._blockCacheRegistryId),this._blockCacheRegistryId=k.register(V,this.layer.raster.rasterInfo),
this._blockCacheRegistryUrl=V)};R._canUseMajorityInterpolationOnDataSource=function(){const {bandCount:t,attributeTable:J,colormap:N,pixelType:T}=this.layer.rasterInfo;return 1===t&&(null!=J||null!=N||"u8"===T||"s8"===T)};R._getLayerInterpolation=function(){const t=this.layer.renderer.type;return"raster-colormap"===t||"unique-value"===t||"class-breaks"===t?"nearest":this.layer.interpolation};C._createClass(U,[{key:"useProgressiveUpdate",get:function(){return null==this._get("useProgressiveUpdate")?
!0:this._get("useProgressiveUpdate")},set:function(t){this._tileStrategy&&this.useProgressiveUpdate!==t&&(this._tileStrategy.destroy(),this._bitmapView.removeAllChildren(),this._tileStrategy=new x({cachePolicy:t?"keep":"purge",resampling:!1,acquireTile:J=>this.acquireTile(J),releaseTile:J=>this.releaseTile(J),cacheSize:t?40:0,tileInfoView:this._tileInfoView}),this._set("useProgressiveUpdate",t),this.requestUpdate())}}]);return U}(K.ImageryTileLayerView(q.RefreshableLayerView(S.LayerView2DMixin(z))));
D.__decorate([I.property()],u.prototype,"useProgressiveUpdate",null);return u=D.__decorate([F.subclass("esri.views.2d.layers.ImageryTileLayerView2D")],u)});