// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.18/esri/copyright.txt for details.
//>>built
define("exports ../../../../core/has ../../../../core/maybe ../../../../geometry/support/spatialReferenceUtils ../../../../geometry/SpatialReference ../../../../geometry/support/intersects ../../../../geometry/support/boundsUtils ../../../../geometry/support/jsonUtils ../../../../core/screenUtils ../../../../geometry/support/normalizeUtils ../../../../geometry/support/aaBoundingRect ../../../../chunks/vec2 ../../../../chunks/mat2d ../../../../chunks/mat2df32 ../../../../chunks/vec2f32 ../../engine/webgl/alignmentUtils ../../engine/webgl/mesh/templates/shapingUtils ../../engine/webgl/util/BidiText ../../../../symbols/cim/CIMSymbolHelper".split(" "),
function(v,na,da,O,F,P,Q,y,n,R,ea,l,q,fa,w,S,ha,ia,T){function U(a,b,d,c,g,e){let f,h;var k=n.pt2px(d.xoffset);const t=n.pt2px(d.yoffset),p=z*d.angle;e*=z;switch(d.type){case "esriSMS":f=h=n.pt2px(d.size);break;case "esriPMS":f=n.pt2px(d.width),h=n.pt2px(d.height)}.04>g&&(c=.04*c/g);d=q.identity(J);q.translate(d,d,l.set(m,a,b));q.rotate(d,d,e-p);q.scale(d,d,l.set(m,c,-c));q.translate(d,d,l.set(m,k,-t));a=[0,0];l.transformMat2d(a,l.set(m,-.5*f,-.5*h),d);b=[0,0];l.transformMat2d(b,l.set(m,-.5*f,.5*
h),d);c=[0,0];l.transformMat2d(c,l.set(m,.5*f,-.5*h),d);k=[0,0];l.transformMat2d(k,l.set(m,.5*f,.5*h),d);return{rings:[[a,c,k,b,a]]}}function V(a,b,d,c,g,e){var f=T.CIMSymbolHelper.getEnvelope(d.data);if(!f)return null;.04>g&&(c=.04*c/g);g=n.pt2px(f.width);var h=n.pt2px(f.height);d=n.pt2px(f.x);f=n.pt2px(f.y);const k=0*z,t=z*e;e=q.identity(J);q.translate(e,e,l.set(m,a,b));q.rotate(e,e,t-k);q.scale(e,e,l.set(m,c,c));a=[0,0];l.transformMat2d(a,l.set(m,d,f+h),e);b=[0,0];l.transformMat2d(b,l.set(m,d,
f),e);c=[0,0];l.transformMat2d(c,l.set(m,d+g,f+h),e);h=[0,0];l.transformMat2d(h,l.set(m,d+g,f),e);return{rings:[[a,c,h,b,a]]}}function W(a,b,d,c,g,e){var f=n.pt2px(d.xoffset),h=n.pt2px(d.yoffset);d=z*d.angle;const k=z*e;e=q.identity(J);q.translate(e,e,l.set(m,a,b));q.rotate(e,e,k);q.scale(e,e,l.set(m,g,-g));a=c[0]+c[2]/2;b=c[1]+c[3]/2;q.translate(e,e,l.set(m,f,-h));q.translate(e,e,l.set(m,a,b));q.rotate(e,e,d);q.translate(e,e,l.set(m,-a,-b));f=[0,0];l.transformMat2d(f,l.set(m,c[0],c[1]),e);h=[0,0];
l.transformMat2d(h,l.set(m,c[0],c[1]+c[3]),e);d=[0,0];l.transformMat2d(d,l.set(m,c[0]+c[2],c[1]),e);a=[0,0];l.transformMat2d(a,l.set(m,c[0]+c[2],c[1]+c[3]),e);return{rings:[[f,d,a,h,f]]}}function X(a){switch(a.symbol.type){case "esriSFS":case "esriPFS":return(a=a.symbol.outline)?a.width:0;case "esriSLS":return n.pt2px(a.symbol.width);case "esriSMS":return n.pt2px(a.symbol.size);case "esriPMS":return n.pt2px(Math.max(a.symbol.width,a.symbol.height));case "esriTS":{const b=[0,0,0,0];K(b,a.symbol,a.mosaicItem);
return Math.max(b[2],b[3])+Math.max(Math.abs(b[0]),Math.abs(b[1]))}case "expanded-cim":return a=T.CIMSymbolHelper.getEnvelope(a.symbol.data),n.pt2px(Math.sqrt(a.width*a.width+a.height*a.height));case "composite-symbol":return a.symbol.layers.length?X({symbol:a.symbol.layers[a.symbol.layers.length-1],mosaicItem:null}):0;default:return 0}}function K(a,b,d){if(!d||0===d.glyphMosaicItems.length)return a;const c=ia.bidiText(b.text)[1];b=ha.shapeGlyphs(d.glyphMosaicItems,c,{scale:n.pt2px(b.font.size)/24,
angle:b.angle,xOffset:b.xoffset,yOffset:b.yoffset,hAlign:S.getXAnchorDirection(b.horizontalAlignment||"center"),vAlign:S.getYAnchorDirection(b.verticalAlignment||"baseline"),maxLineWidth:Math.max(32,Math.min(b.lineWidth||512,512)),lineHeight:30*Math.max(.25,Math.min(b.lineHeight||1,4)),decoration:b.font.decoration||"none",isCIM:!1}).bounds;a[0]=n.pt2px(b.x-b.halfWidth);a[1]=n.pt2px(b.y-b.halfHeight);a[2]=n.pt2px(b.width);a[3]=n.pt2px(b.height);return a}function C(a,b){return Math.ceil((a-b)/(2*b))}
function ja(a,b){var d=y.isPolygon(a)?a.rings:a.paths;for(const c of d)for(const g of c)g[0]+=b;return a}function ka(a,b){if(!b)return a;const d=la(a,b).map(c=>c.extent);return 2>d.length?d[0]||a:2<d.length?(a.xmin=b.valid[0],a.xmax=b.valid[1],a):{rings:d.map(c=>[[c.xmin,c.ymin],[c.xmin,c.ymax],[c.xmax,c.ymax],[c.xmax,c.ymin],[c.xmin,c.ymin]])}}function la(a,b){const d=[],{ymin:c,ymax:g}=a;var e=a.xmax-a.xmin,f=a.xmin,h=a.xmax;const [k,t]=b.valid;var p=Y(a.xmin,b);var r=p.x;const u=p.frameId;p=Y(a.xmax,
b);a=p.x;p=p.frameId;b=r===a&&0<e;if(e>2*t){e={xmin:f<h?r:a,ymin:c,xmax:t,ymax:g};f={xmin:k,ymin:c,xmax:f<h?a:r,ymax:g};h={xmin:0,ymin:c,xmax:t,ymax:g};r={xmin:k,ymin:c,xmax:0,ymax:g};a=[];b=[];G(e,h)&&a.push(u);G(e,r)&&b.push(u);G(f,h)&&a.push(p);G(f,r)&&b.push(p);for(let x=u+1;x<p;x++)a.push(x),b.push(x);d.push({extent:e,frameIds:[u]},{extent:f,frameIds:[p]},{extent:h,frameIds:a},{extent:r,frameIds:b})}else r>a||b?d.push({extent:{xmin:r,ymin:c,xmax:t,ymax:g},frameIds:[u]},{extent:{xmin:k,ymin:c,
xmax:a,ymax:g},frameIds:[p]}):d.push({extent:{xmin:r,ymin:c,xmax:a,ymax:g},frameIds:[u]});return d}function Y(a,b){const [d,c]=b.valid;b=2*c;var g=0;a>c?(g=Math.ceil(Math.abs(a-c)/b),a-=g*b):a<d&&(g=Math.ceil(Math.abs(a-d)/b),a+=g*b,g=-g);return{x:a,frameId:g}}function G(a,b){const {xmin:d,ymin:c,xmax:g,ymax:e}=b;return H(a,d,c)&&H(a,d,e)&&H(a,g,e)&&H(a,g,c)}function H(a,b,d){return b>=a.xmin&&b<=a.xmax&&d>=a.ymin&&d<=a.ymax?!0:!1}function Z(a,b,d){if(Array.isArray(a)){var c=a[0];c>b?(d=C(c,b),a[0]=
c+-2*d*b):c<d&&(b=C(c,d),a[0]=c+-2*b*d)}else c=a.x,c>b?(d=C(c,b),a.x+=-2*d*b):c<d&&(b=C(c,d),a.x+=-2*b*d);return a}const z=Math.PI/180,J=fa.create(),m=w.create(),D=ea.create(),L=w.create(),aa=w.create(),ba=w.create(),E=w.create(),M=w.create(),ca=w.create(),N=w.create(),I={102100:{maxX:2.0037508342788905E7,minX:-2.0037508342788905E7,plus180Line:{paths:[[[2.0037508342788905E7,-2.0037508342788905E7],[2.0037508342788905E7,2.0037508342788905E7]]],spatialReference:F.WebMercator},minus180Line:{paths:[[[-2.0037508342788905E7,
-2.0037508342788905E7],[-2.0037508342788905E7,2.0037508342788905E7]]],spatialReference:F.WebMercator}},4326:{maxX:180,minX:-180,plus180Line:{paths:[[[180,-180],[180,180]]],spatialReference:F.WGS84},minus180Line:{paths:[[[-180,-180],[-180,180]]],spatialReference:F.WGS84}}};let ma=function(){function a(){}a.prototype.cut=function(b,d){let c;if(b.rings)this.closed=!0,c=b.rings,this.minPts=4;else if(b.paths)this.closed=!1,c=b.paths,this.minPts=2;else return null;const g=c.length;d*=-2;for(let e=0;e<g;e++){const f=
c[e];if(f&&f.length>=this.minPts){const h=[];for(const k of f)h.push([k[0]+d,k[1]]);c.push(h)}}this.closed?b.rings=c:b.paths=c;return b};return a}();v.getBounds=function(a,b,d,c,g,e,f){if(!c||!d.symbol)return a[0]=a[1]=a[2]=a[3]=0,b[0]=b[1]=b[2]=b[3]=0,a;if(y.isPoint(c)){var h=c.x;const t=c.y;"esriTS"===d.symbol.type&&0===b[2]&&0===b[3]&&K(b,d.symbol,d.mosaicItem);c=h;h=t;d=d.symbol;switch(d.type){case "esriSMS":case "esriPMS":var k=U(c,h,d,g,e,0);break;case "esriTS":k=W(c,h,d,b,g,0);break;case "cim":case "CIMSymbolReference":case "expanded-cim":k=
V(c,h,d,g,e,0)}b=0;for(g=0;g<k.rings[0].length-1;g++)d=k.rings[0][g],d=(c-d[0])*(c-d[0])+(h-d[1])*(h-d[1]),b=Math.max(b,d);b=Math.sqrt(b);k=R.normalizeMapX(c-b,f);c=R.normalizeMapX(c+b,f);if(k>c&&(f=O.getInfo(f))){const [p,r]=f.valid;k=p;c=r}a[0]=k;a[1]=h-b;a[2]=c;a[3]=h+b}else Q.getBoundsXY(a,c),f=b[0],0===f&&(f=X(d),b[0]=f),f=g*f/2,a[0]-=f,a[1]-=f,a[2]+=f,a[3]+=f;return a};v.getCIMMarkerBounds=V;v.getMarkerSymbolBounds=U;v.getTextSymbolBounds=W;v.getTextSymbolSize=K;v.graphicGeometryToNumber=function(a){switch(da.unwrap(a.geometry).type){case "polyline":return 1;
case "polygon":case "extent":return 2}return 0};v.isMarkerSymbol=function(a){return"simple-marker"===a||"picture-marker"===a||"text"===a};v.isPointOnPolyline=function(a,b,d,c){l.set(ba,b,d);a=a.paths;let g,e,f,h,k,t,p,r=Infinity;for(let x=0;x<a.length;x++){const A=a[x];if(!(2>A.length))for(let B=1;B<A.length;B++){var u=A[B-1][0];e=A[B-1][1];g=A[B][0];f=A[B][1];h=Math.min(u,g)-c;k=Math.min(e,f)-c;t=Math.max(u,g)+c;p=Math.max(e,f)+c;b<h||b>t||d<k||d>p||(l.set(L,u,e),l.set(aa,g,f),l.subtract(E,aa,L),
l.subtract(M,L,ba),l.scale(ca,E,l.dot(E,M)/l.dot(E,E)),l.subtract(N,M,ca),u=l.dot(N,N),r>u&&(r=u))}}return Math.sqrt(r)<=c};v.normalizeCentralMeridian=function(a){let b,d;let c=null;if(!a)return null;if("mesh"===a.type)return a.toJSON();var g=a.spatialReference;var e=O.getInfo(g);if(!e)return a.toJSON();var f=g.isWebMercator?102100:4326;b=I[f].maxX;d=I[f].minX;g=I[f].plus180Line;f=I[f].minus180Line;let h;var k=a.toJSON();y.isPoint(k)?h=Z(k,b,d):y.isMultipoint(k)?(k.points=k.points.map(t=>Z(t,b,d)),
h=k):y.isExtent(k)?h=ka(k,e):y.isPolygon(k)||y.isPolyline(k)?(Q.getBoundsXY(D,k),a={xmin:D[0],ymin:D[1],xmax:D[2],ymax:D[3]},e=2*C(a.xmin,d)*b,k=0===e?k:ja(k,e),a.xmin+=e,a.xmax+=e,P.extentIntersectsPolyline(a,g)&&a.xmax!==b?c=k:P.extentIntersectsPolyline(a,f)&&a.xmin!==d?c=k:h=k):h=a.clone();return null!==c?(new ma).cut(c,b):h};Object.defineProperty(v,"__esModule",{value:!0})});