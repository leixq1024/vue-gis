// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.18/esri/copyright.txt for details.
//>>built
define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/has ../../core/Logger ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/property ../../core/jsonMap ../../core/accessorSupport/decorators/subclass ../../core/Error ../../core/urlUtils ../../core/uuid ../../portal/support/resourceExtension ../../core/Accessor ../../core/HandleOwner ../../core/throttle ./engine/webgl/collisions/CollisionEngine ./engine/webgl/collisions/LayerViewSorter".split(" "),
function(h,e,d,m,x,f,y,n,p,z,A,B,q,r,t,u,v){const w=m.getLogger("esri.views.2d.layers.labels.LabelManager");d=function(k){function g(a){a=k.call(this,a)||this;a._applyVisibilityPassThrottled=t.throttle(a._applyVisibilityPass,64,h._assertThisInitialized(a));a.lastUpdateId=-1;a.updateRequested=!1;a.view=null;return a}h._inheritsLoose(g,k);var c=g.prototype;c.initialize=function(){this.collisionEngine=new u.CollisionEngine(this.view.featuresTilingScheme);this._layerViewSorter=new v.LayerViewSorter((a,
b)=>{this.collisionEngine.registerLayerView(a,b);(b=a.tileRenderer)&&b.forEachTile(l=>{l.isDirty=!0;this.addTile(a,l)});this.requestUpdate()},a=>{this.collisionEngine.unregisterLayerView(a);this.requestUpdate()});this.handles.add(this.view.allLayerViews.on("change",a=>{this._layerViewSorter.update(a)}))};c.destroy=function(){this._layerViewSorter.destroy();this.collisionEngine=this._layerViewSorter=null;this._applyVisibilityPassThrottled.remove();this._applyVisibilityPassThrottled=null};c.update=
function(a){this._applyVisibilityPassThrottled(a)};c.viewChange=function(){this.requestUpdate()};c.requestUpdate=function(){this.updateRequested||(this.updateRequested=!0,this.view.requestUpdate())};c.processUpdate=function(a){this._set("updateParameters",a);this.updateRequested&&(this.updateRequested=!1,this.update(a))};c.addTile=function(a,b){this.collisionEngine.addTile(a,b)};c.removeTile=function(a,b){this.collisionEngine.removeTile(a,b)};c._applyVisibilityPass=function(a){try{const b=this.view.featuresTilingScheme.getClosestInfoForScale(a.state.scale).level;
this.collisionEngine.run(a,b)}catch(b){w.error(new p("mapview-labeling","Encountered an error during label decluttering",b))}};h._createClass(g,[{key:"updating",get:function(){return this.updateRequested}}]);return g}(r.HandleOwnerMixin(q));e.__decorate([f.property()],d.prototype,"updateRequested",void 0);e.__decorate([f.property({readOnly:!0})],d.prototype,"updateParameters",void 0);e.__decorate([f.property({dependsOn:["updateRequested"]})],d.prototype,"updating",null);e.__decorate([f.property()],
d.prototype,"view",void 0);return d=e.__decorate([n.subclass("esri.views.2d.layers.labels.LabelManager")],d)});