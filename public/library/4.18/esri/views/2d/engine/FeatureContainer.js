// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.18/esri/copyright.txt for details.
//>>built
define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/promiseUtils ../../../geometry/support/aaBoundingRect ../../../core/Queue ./webgl/TileData ./webgl/WGLTile ./webgl/AttributeStoreView ./webgl/TileContainer ./webgl/WGLRendererInfo".split(" "),function(l,n,m,p,q,r,t,u,g,v){g=function(f){function h(a){a=f.call(this,a)||this;a._rendererInfo=new v.WGLRendererInfo;a._materialItemsRequestQueue=new q;a.attributeView=new u.AttributeStoreView;return a}n._inheritsLoose(h,f);var c=h.prototype;
c.destroy=function(){this.removeAllChildren();this.children.forEach(a=>a.destroy());this.attributeView.destroy();this._materialItemsRequestQueue.clear()};c.setRendererInfo=function(a,b,d){this._rendererInfo.setInfo(a,b,d);this.requestRender()};c.getMaterialItems=async function(a,b){if(!a||0===a.length)return null;const d=m.createResolver();this._materialItemsRequestQueue.push({items:a,abortOptions:b,resolver:d});this.requestRender();return d.promise};c.onTileData=function(a,b){if(b.addOrUpdate&&"tileDisplayData"in
b.addOrUpdate)a.setData(b);else{const d=b.addOrUpdate&&r.TileData.decode(b.addOrUpdate);a.setData({...b,addOrUpdate:d})}this.contains(a)||this.addChild(a);this.requestRender()};c.onTileError=function(a){a.clear();this.contains(a)||this.addChild(a)};c.doRender=function(a){a.context.capabilities.textureFloat;a.context.capabilities.vao;if(0<this._materialItemsRequestQueue.length){let b=this._materialItemsRequestQueue.pop();for(;b;)this._processMaterialItemRequest(a,b),b=this._materialItemsRequestQueue.pop()}f.prototype.doRender.call(this,
a)};c.renderChildren=function(a){for(const b of this.children)b.commitChanges(a);this._rendererInfo.update(a.state);f.prototype.renderChildren.call(this,a)};c.createTile=function(a){const b=this._tileInfoView.getTileBounds(p.create(),a);return new t.WGLTile(a,b)};c.destroyTile=function(a){this.removeChild(a);a.destroy()};c.createRenderParams=function(a){return{...f.prototype.createRenderParams.call(this,a),rendererInfo:this._rendererInfo,attributeView:this.attributeView}};c._processMaterialItemRequest=
function(a,{items:b,abortOptions:d,resolver:k}){const {painter:w,pixelRatio:x}=a;a=b.map(e=>w.textureManager.rasterizeItem(e.symbol,x,e.glyphIds,d));m.all(a).then(e=>{this.stage?(e=e.map((y,z)=>({id:b[z].id,mosaicItem:y})),k.resolve(e)):k.reject()},k.reject)};return h}(g["default"]);l.FeatureContainer=g;Object.defineProperty(l,"__esModule",{value:!0})});