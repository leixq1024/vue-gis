// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.18/esri/copyright.txt for details.
//>>built
define(["exports","../webgl/Rect","./ScriptUtils"],function(z,B,E){let F=function(){function u(a,g,c,d,e,f,h){this._glyphItems=a;this._maxWidth=g;this._lineHeight=c;this._letterSpacing=d;this._hAnchor=e;this._vAnchor=f;this._justify=h}var C=u.prototype;C.getShaping=function(a,g,c){const d=this._letterSpacing,e=this._lineHeight;var f=this._justify;const h=this._maxWidth,b=[];var k=0;let m=0,q=0;var l=0;let n=-1,r=0,v=-1;const D=a.length;for(let p=0;p<D;p++){const w=a.charCodeAt(p);var x=c&&E.hasVerticalOrientation(w);
if(10===w){if(p===D-1)continue;n>=l&&(k=b[n],r=Math.max(k.x+k.glyphMosaicItem.metrics.advance,r),f&&this._applyJustification(b,l,n),l=b.length);m=g?m-e:m+e;k=0;++q;continue}let A;for(const y of this._glyphItems)if(A=y[w])break;if(A){b.push({codePoint:w,x:k,y:m,vertical:x,glyphMosaicItem:A});k+=A.metrics.advance+d;if(0<h&&k>h&&0<=v){x=v+1;const y=b[x].x;r=Math.max(y,r);for(let t=x;t<b.length;t++)b[t].y=g?b[t].y-e:b[t].y+e,b[t].x-=y;f&&this._applyJustification(b,l,v);m=g?m-e:m+e;k-=y;++q;l=x;v=-1}++n;
32===w&&(v=b.length-1)}}n>=l&&(a=b[n],r=Math.max(r,a.x+a.glyphMosaicItem.metrics.advance),f&&this._applyJustification(b,l,n));if(0<b.length){f=(f-this._hAnchor)*r;l=(-this._vAnchor*(q+1)+.5)*e;g&&q&&(l+=q*e);for(const p of b)p.x+=f,p.y+=l}return b};u.getTextBox=function(a,g){if(!a.length)return null;let c=Infinity,d=Infinity,e=0,f=0;for(const h of a){a=h.x;const b=h.y-17,k=a+h.glyphMosaicItem.metrics.advance,m=b+g;c=Math.min(c,a);e=Math.max(e,k);d=Math.min(d,b);f=Math.max(f,m)}return{x:c,y:d,width:e-
c,height:f-d}};u.getBox=function(a){if(!a.length)return null;let g=Infinity,c=Infinity,d=0,e=0;for(const f of a){const {height:h,left:b,top:k,width:m}=f.glyphMosaicItem.metrics;a=f.x;const q=f.y-(h-Math.abs(k)),l=a+m+b,n=q+h;g=Math.min(g,a);d=Math.max(d,l);c=Math.min(c,q);e=Math.max(e,n)}return{x:g,y:c,width:d-g,height:e-c}};u.addDecoration=function(a,g){var c=a.length;if(0!==c){var d=a[0].x+a[0].glyphMosaicItem.metrics.left,e=a[0].y;for(let f=1;f<c;f++){const h=a[f];if(h.y!==e){const b=a[f-1].x+
a[f-1].glyphMosaicItem.metrics.left+a[f-1].glyphMosaicItem.metrics.width;a.push({codePoint:0,x:d,y:e+g-3,vertical:!1,glyphMosaicItem:{sdf:!0,rect:new B(4,0,4,8),metrics:{width:b-d,height:8,left:0,top:0,advance:0},page:0,code:0}});e=h.y;d=h.x+h.glyphMosaicItem.metrics.left}}c=a[c-1].x+a[c-1].glyphMosaicItem.metrics.left+a[c-1].glyphMosaicItem.metrics.width;a.push({codePoint:0,x:d,y:e+g-3,vertical:!1,glyphMosaicItem:{sdf:!0,rect:new B(4,0,4,8),metrics:{width:c-d,height:8,left:0,top:0,advance:0},page:0,
code:0}})}};C._applyJustification=function(a,g,c){var d=a[c];for(d=(d.x+(d.vertical?24:d.glyphMosaicItem.metrics.advance))*this._justify;g<=c;g++)a[g].x-=d};return u}();z.SDF_GLYPH_BASELINE=17;z.SDF_GLYPH_SIZE=24;z.TextShaping=F;Object.defineProperty(z,"__esModule",{value:!0})});