// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.18/esri/copyright.txt for details.
//>>built
define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/mat3 ../../../../chunks/mat3f32 ./decluttering/config ./RenderBucket ../webgl/TiledDisplayObject".split(" "),function(n,p,h,r,q,k,l){l=function(m){function g(b,c,a,e){a=m.call(this,b,a,e,[4096,4096])||this;a._referenced=0;a._hasSymbolBuckets=!1;a._memoryUsedByLayerData=0;a.layerData=new Map;a.layerCount=0;a.status="loading";a.allSymbolsFadingOut=!1;a.lastOpacityUpdate=0;a.symbols=new Map;a.isCoverage=!1;a.neededForCoverage=
!1;a.decluttered=!1;a.invalidating=!1;a.parentTile=null;a.childrenTiles=new Set;a._processed=!1;a._referenced=1;a.styleRepository=c;a.id=b.id;a.transforms.tileUnitsToPixels=r.create();return a}p._inheritsLoose(g,m);var d=g.prototype;d.setData=function(b){this.changeDataImpl(b);this.requestRender();this.ready();this.invalidating=!1;this._processed=!0};d.deleteLayerData=function(b){let c=!1;for(const a of b)this.layerData.has(a)&&(b=this.layerData.get(a),this._memoryUsedByLayerData-=b.memoryUsed,3===
b.type&&this.symbols.has(a)&&(this.symbols.delete(a),c=!0),b.destroy(),this.layerData.delete(a),this.layerCount--);c&&this.emit("symbols-changed");this.requestRender()};d.processed=function(){return this._processed};d.hasData=function(){return 0<this.layerCount};d.dispose=function(){g._destroyRenderBuckets(this.layerData);this.layerData=null;this._memoryUsedByLayerData=this.layerCount=0;this.destroy()};d.release=function(){return 0===--this._referenced?(this.dispose(),this.stage=null,!0):!1};d.reference=
function(){++this._referenced};d.getMemoryUsage=function(){return this._memoryUsedByLayerData/(this._referenced||1)};d.changeDataImpl=function(b){let c=!1;if(b){b=this._createRenderBuckets(b);for(const [a,e]of b)this.layerData.has(a)&&(b=this.layerData.get(a),this._memoryUsedByLayerData-=e.memoryUsed,b.destroy(),this.layerData.delete(a),this.layerCount--),3===e.type&&(this.symbols.set(a,e.symbols),c=!0),this._memoryUsedByLayerData+=e.memoryUsed,this.layerData.set(a,e),this.layerCount++}this._hasSymbolBuckets=
!1;for(const [,a]of this.layerData)3===a.type&&(this._hasSymbolBuckets=!0);c&&this.emit("symbols-changed")};d.attachWithContext=function(b){this.stage={context:b,trashDisplayObject(c){c.processDetach()},untrashDisplayObject(){return!1}}};d.setTransform=function(b,c){m.prototype.setTransform.call(this,b,c);var a=c/(b.resolution*b.pixelRatio);c=this.size[0]/this.coordRange[0]*a;a*=this.size[1]/this.coordRange[1];const e=[0,0];b.toScreen(e,this.coords);const f=this.transforms.tileUnitsToPixels;h.identity(f);
h.translate(f,f,e);h.rotate(f,f,Math.PI*b.rotation/180);h.scale(f,f,[c,a,1])};g._destroyRenderBuckets=function(b){const c=new Set;b.forEach(a=>{c.has(a)||(a.destroy(),c.add(a))});b.clear()};d._createRenderBuckets=function(b){const c=new Map,a=new Map;for(const e of b){b=this._deserializeBucket(e,a);for(const f of b.layerUIDs)c.set(f,b)}return c};d._deserializeBucket=function(b,c){let a=c.get(b);if(a)return a;switch((new Uint32Array(b))[0]){case 1:a=new k.FillRenderBucket(b);break;case 2:a=new k.LineRenderBucket(b);
break;case 3:a=new k.SymbolRenderBucket(b,this);break;case 4:a=new k.CircleRenderBucket(b)}c.set(b,a);return a};p._createClass(g,[{key:"hasSymbolBuckets",get:function(){return this._hasSymbolBuckets}},{key:"isFading",get:function(){return this._hasSymbolBuckets&&performance.now()-this.lastOpacityUpdate<q.FADE_DURATION}},{key:"isHoldingForFade",get:function(){return this._hasSymbolBuckets&&(!this.allSymbolsFadingOut||performance.now()-this.lastOpacityUpdate<q.FADE_DURATION)}},{key:"wasRequested",get:function(){return"errored"===
this.status||"loaded"===this.status||"reloading"===this.status}},{key:"referenced",get:function(){return this._referenced}}]);return g}(l.TiledDisplayObject);n.VectorTile=l;Object.defineProperty(n,"__esModule",{value:!0})});