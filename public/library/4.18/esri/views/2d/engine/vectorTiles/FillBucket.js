// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.18/esri/copyright.txt for details.
//>>built
define("../../../../chunks/_rollupPluginBabelHelpers ../../../../core/ArrayPool ../../../../core/libs/earcut/earcut ../webgl/Geometry ../webgl/mesh/Tesselator ./BaseBucket".split(" "),function(C,D,E,A,G,H){const z=new G;return function(F){function w(b,a,c,d,l,f){a=F.call(this,b,a)||this;a.type=1;if(b.hasDataDrivenFill!==c.isDataDriven())throw Error("incompatible fill buffer");if(b.hasDataDrivenOutline!==l.isDataDriven())throw Error("incompatible outline buffer");a._fillVertexBuffer=c;a._fillIndexBuffer=
d;a._outlineVertexBuffer=l;a._outlineIndexBuffer=f;return a}C._inheritsLoose(w,F);var x=w.prototype;x.processFeatures=function(b){this._fillIndexStart=3*this._fillIndexBuffer.index;this._fillIndexCount=0;this._outlineIndexStart=3*this._outlineIndexBuffer.index;this._outlineIndexCount=0;const a=this.layer,c=this.zoom,d=a.hasDataDrivenFill,l=a.hasDataDrivenOutline;b&&b.setExtent(this.layerExtent);const f=a.getPaintValue("fill-pattern",c);let e=a.getPaintValue("fill-antialias",c)&&void 0===f,k=[1,1,
1,1],p=[1,1,1,1],n=1;if(a.outlineUsesFillColor){if(e&&!a.hasDataDrivenOpacity){var q=a.getPaintValue("fill-opacity",c),g=a.getPaintValue("fill-opacity",c+1);1>q&&1>g&&(e=!1)}e&&!a.hasDataDrivenColor&&(q=a.getPaintValue("fill-color",c),g=a.getPaintValue("fill-color",c+1),1>q[3]&&1>g[3]&&(e=!1))}for(const h of this._features){!f&&a.hasDataDrivenColor&&(k=a.getPaintValue("fill-color",c,h));a.hasDataDrivenOpacity&&(n=a.getPaintValue("fill-opacity",c,h));!f&&a.hasDataDrivenOutlineColor&&(p=a.getPaintValue("fill-outline-color",
c,h));let m;d&&(m={color:k,opacity:n});let r;l&&(r={color:a.outlineUsesFillColor?k:p,opacity:n});q=h.getGeometry(b);this._processFeature(q,e,a.outlineUsesFillColor,m,r,null==b?void 0:b.validateTessellation)}};x.serialize=function(){var b=12+this.layerUIDs.length;b+=this._fillVertexBuffer.array.length;b+=this._fillIndexBuffer.array.length;b+=this._outlineVertexBuffer.array.length;b+=this._outlineIndexBuffer.array.length;let a=0;b=new Uint32Array(b);var c=new Int32Array(b.buffer);b[a++]=this.type;b[a++]=
this.layerUIDs.length;for(var d=0;d<this.layerUIDs.length;d++)b[a++]=this.layerUIDs[d];b[a++]=this._fillIndexStart;b[a++]=this._fillIndexCount;b[a++]=this._outlineIndexStart;b[a++]=this._outlineIndexCount;b[a++]=this._fillVertexBuffer.isDataDriven()?1:0;b[a++]=this._outlineVertexBuffer.isDataDriven()?1:0;b[a++]=this._fillVertexBuffer.array.length;for(d=0;d<this._fillVertexBuffer.array.length;d++)c[a++]=this._fillVertexBuffer.array[d];b[a++]=this._fillIndexBuffer.array.length;for(d=0;d<this._fillIndexBuffer.array.length;d++)b[a++]=
this._fillIndexBuffer.array[d];b[a++]=this._outlineVertexBuffer.array.length;for(d=0;d<this._outlineVertexBuffer.array.length;d++)c[a++]=this._outlineVertexBuffer.array[d];b[a++]=this._outlineIndexBuffer.array.length;for(c=0;c<this._outlineIndexBuffer.array.length;c++)b[a++]=this._outlineIndexBuffer.array[c];return b.buffer};x._processFeature=function(b,a,c,d,l,f){if(b){var e=b.length;if(a&&(!c||!l||1===l.color[3]*l.opacity))for(a=0;a<e;a++)this._processOutline(b[a],l);for(l=0;l<e;l++)if(a=w._area(b[l]),
128<a){void 0!==k&&this._processFill(b,k,d,f);var k=[l]}else-128>a&&void 0!==k&&k.push(l);void 0!==k&&this._processFill(b,k,d,f)}};x._processOutline=function(b,a){const c=this._outlineVertexBuffer,d=this._outlineIndexBuffer,l=d.index;var f;let e,k;const p=new A.Point(0,0),n=new A.Point(0,0),q=new A.Point(0,0);let g=-1,h=-1;var m=-1;let r=-1,y=-1,B=!1,t=b.length;if(!(2>t)){var v=b[0];for(f=b[t-1];t&&f.isEqual(v);)--t,f=b[t-1];if(!(2>t-0)){for(v=0;v<t;++v){0===v?(f=b[t-1],e=b[0],k=b[1],p.assignSub(e,
f),p.normalize(),p.rightPerpendicular()):(f=e,e=k,k=v!==t-1?b[v+1]:b[0],p.assign(n));f=this._isClipEdge(f,e);-1===r&&(B=f);n.assignSub(k,e);n.normalize();n.rightPerpendicular();m=p.x*n.y-p.y*n.x;q.assignAdd(p,n);q.normalize();var u=-q.x*-p.x+-q.y*-p.y;u=Math.abs(0!==u?1/u:1);8<u&&(u=8);0<=m?(m=c.add(e.x,e.y,p.x,p.y,0,1,a),-1===r&&(r=m),0<=g&&0<=h&&0<=m&&!f&&d.add(g,h,m),h=c.add(e.x,e.y,u*-q.x,u*-q.y,0,-1,a),-1===y&&(y=h),0<=g&&0<=h&&0<=m&&!f&&d.add(g,h,m),g=h,h=m,m=c.add(e.x,e.y,q.x,q.y,0,1,a),0<=
g&&0<=h&&0<=m&&!f&&d.add(g,h,m),h=c.add(e.x,e.y,n.x,n.y,0,1,a)):(m=c.add(e.x,e.y,u*q.x,u*q.y,0,1,a),-1===r&&(r=m),0<=g&&0<=h&&0<=m&&!f&&d.add(g,h,m),h=c.add(e.x,e.y,-p.x,-p.y,0,-1,a),-1===y&&(y=h),0<=g&&0<=h&&0<=m&&!f&&d.add(g,h,m),g=h,h=m,m=c.add(e.x,e.y,-q.x,-q.y,0,-1,a),0<=g&&0<=h&&0<=m&&!f&&d.add(g,h,m),g=c.add(e.x,e.y,-n.x,-n.y,0,-1,a));0<=g&&0<=h&&0<=m&&!f&&d.add(g,h,m)}0<=g&&0<=h&&0<=r&&!B&&d.add(g,h,r);0<=g&&0<=r&&0<=y&&!B&&d.add(g,y,r);this._outlineIndexCount+=3*(d.index-l)}}};x._processFill=
function(b,a,c,d){var l;1<a.length&&(l=[]);var f=0;for(var e of a)0!==f&&l.push(f),f+=b[e].length;e=2*f;f=D.acquire();for(var k of a){var p=b[k];const q=p.length;for(let g=0;g<q;++g)f.push(p[g].x,p[g].y)}k=E.earcut(f,l,2);if(d&&0<E.deviation(f,l,2,k)){d=[];e=[];z.beginPolygon(d,e);for(var n of a)if(a=b[n],!(3>a.length)){z.beginContour();for(l=0;l<a.length;++l)k=a[l].x,p=a[l].y,k=[k,p,0],z.addVertex(k,k);z.endContour()}z.endPolygon();if(0<e.length){b=this._fillVertexBuffer.index;for(n=0;n<d.length;)this._fillVertexBuffer.add(d[n++],
d[n++],c);for(c=0;c<e.length;)this._fillIndexBuffer.add(b+e[c+0],b+e[c+1],b+e[c+2]),c+=3;this._fillIndexCount+=e.length}}else if(b=k.length,0<b){n=this._fillVertexBuffer.index;for(a=0;a<e;)this._fillVertexBuffer.add(f[a++],f[a++],c);for(c=0;c<b;)this._fillIndexBuffer.add(n+k[c++],n+k[c++],n+k[c++]);this._fillIndexCount+=b}D.release(f)};x._isClipEdge=function(b,a){return b.x===a.x?-64>=b.x||4160<=b.x:b.y===a.y?-64>=b.y||4160<=b.y:!1};w._area=function(b){let a=0;const c=b.length-1;for(let d=0;d<c;d++)a+=
(b[d].x-b[d+1].x)*(b[d].y+b[d+1].y);a+=(b[c].x-b[0].x)*(b[c].y+b[0].y);return.5*a};C._createClass(w,[{key:"fillIndexStart",get:function(){return this._fillIndexStart}},{key:"fillIndexCount",get:function(){return this._fillIndexCount}},{key:"outlineIndexStart",get:function(){return this._outlineIndexStart}},{key:"outlineIndexCount",get:function(){return this._outlineIndexCount}}]);return w}(H)});