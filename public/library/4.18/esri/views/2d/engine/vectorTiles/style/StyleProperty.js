// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.18/esri/copyright.txt for details.
//>>built
define(["../../../../../Color","../../../../../chunks/expression","../GeometryUtils"],function(m,n,p){return function(){function g(b,a){this.isDataDriven=!1;let e;switch(b.type){case "number":e=!0;break;case "color":e=!0;a=g._parseColor(a);break;case "array":e="number"===b.value;break;default:e=!1}null==a&&(a=b.default);if(Array.isArray(a)&&0<a.length&&n.ops[a[0]])try{var d=n.createExpression(a);this.getValue=this._buildExpression(d,b);this.isDataDriven=!0}catch(c){console.log(c.message),this.getValue=
this._buildSimple(b.default)}else{e&&"interval"===a.type&&(e=!1);if(d=a&&a.stops&&0<a.stops.length)for(const c of a.stops)c[1]=this._validate(c[1],b);if(this.isDataDriven=a?!!a.property:!1)if(void 0!==a.default&&(a.default=this._validate(a.default,b)),d)switch(a.type){case "identity":this.getValue=this._buildIdentity(a,b);break;case "categorical":this.getValue=this._buildCategorical(a,b);break;default:this.getValue=e?this._buildInterpolate(a,b):this._buildInterval(a,b)}else this.getValue=this._buildIdentity(a,
b);else d?this.getValue=e?this._buildZoomInterpolate(a):this._buildZoomInterval(a):(a=this._validate(a,b),this.getValue=this._buildSimple(a))}}var f=g.prototype;f._validate=function(b,a){if("number"===a.type){if(b<a.minimum)return a.minimum;if(b>a.maximum)return a.maximum}return b};f._buildSimple=function(b){return()=>b};f._buildExpression=function(b,a){return(e,d)=>{try{let c=b.evaluate(d,e);"color"===a.type&&(c=g._parseColor(c));return void 0===c?a.default:this._validate(c,a)}catch(c){return console.log(c.message),
a.default}}};f._buildIdentity=function(b,a){return(e,d)=>{let c;d&&(c=d.values[b.property],"color"===a.type&&(c=g._parseColor(c)));void 0===c&&(c=b.default);return void 0!==c?this._validate(c,a):a.default}};f._buildCategorical=function(b,a){return(e,d)=>{let c;d&&(c=d.values[b.property]);c=this._categorical(c,b.stops);return void 0!==c?c:void 0!==b.default?b.default:a.default}};f._buildInterval=function(b,a){return(e,d)=>{let c;d&&(c=d.values[b.property]);return"number"===typeof c?this._interval(c,
b.stops):void 0!==b.default?b.default:a.default}};f._buildInterpolate=function(b,a){return(e,d)=>{let c;d&&(c=d.values[b.property]);return"number"===typeof c?this._interpolate(c,b.stops,b.base||1):void 0!==b.default?b.default:a.default}};f._buildZoomInterpolate=function(b){return a=>this._interpolate(a,b.stops,b.base||1)};f._buildZoomInterval=function(b){return a=>this._interval(a,b.stops)};f._categorical=function(b,a){const e=a.length;for(let d=0;d<e;d++)if(a[d][0]===b)return a[d][1]};f._interval=
function(b,a){const e=a.length;let d=0;for(let c=0;c<e;c++)if(a[c][0]<=b)d=c;else break;return a[d][1]};f._interpolate=function(b,a,e){const d=a.length;for(let k=0;k<d;k++){const l=a[k];if(l[0]<=b)var c=l;else{var h=l;break}}if(c&&h){a=h[0]-c[0];b-=c[0];e=1===e?b/a:(Math.pow(e,b)-1)/(Math.pow(e,a)-1);if(Array.isArray(c[1])){c=c[1];h=h[1];b=[];for(a=0;a<c.length;a++)b.push(p.interpolate(c[a],h[a],e));return b}return p.interpolate(c[1],h[1],e)}if(c)return c[1];if(h)return h[1]};g._isEmpty=function(b){for(const a in b)if(b.hasOwnProperty(a))return!1;
return!0};g._parseColor=function(b){if(Array.isArray(b))return b;if("string"===typeof b){if(b=new m(b),!this._isEmpty(b))return m.toUnitRGBA(b)}else return b&&b.default&&(b.default=g._parseColor(b.default)),b&&b.stops&&(b.stops=b.stops.map(a=>[a[0],g._parseColor(a[1])])),b};return g}()});