// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.18/esri/copyright.txt for details.
//>>built
define("../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/RandomLCG ../definitions ../../../../webgl/Program ../../../../webgl/BufferObject ../../../../webgl/Texture ../../../../webgl/VertexArrayObject ../../../../webgl/Renderbuffer ../../../../webgl/FramebufferObject ../../../../webgl/ProgramCache ../../../../webgl/RenderingContext ../../../../webgl/ShaderCompiler ../enums ../materialKey/MaterialKey ../Utils ./WGLGeometryBrush".split(" "),function(r,t,k,E,F,u,G,H,I,J,K,L,v,w,x,
y){return function(m){function l(){var b=m.apply(this,arguments)||this;b._dotTextureSize=0;b._dotTextures=null;b._dotSamplers=new Int32Array([k.TEXTURE_BINDING_RENDERER_0,k.TEXTURE_BINDING_RENDERER_1]);return b}r._inheritsLoose(l,m);var g=l.prototype;g.dispose=function(){this._disposeTextures()};g.getGeometryType=function(){return v.WGLGeometryType.FILL};g.drawGeometry=function(b,c,a,e,d){const {context:h,painter:n,rendererInfo:f,requiredLevel:p}=b,{indexCount:z,indexFrom:A,materialKey:B}=a;a=w.FillMaterialKey.load(B);
const {bufferLayouts:C,attributes:q}=x.createProgramDescriptor(a.data,{geometry:[{location:0,name:"a_pos",count:2,type:5122},{location:1,name:"a_id",count:4,type:5121},...a.dotDensity?[]:[{location:2,name:"a_color",count:4,type:5121,normalized:!0},{location:3,name:"a_tlbr",count:4,type:5123},{location:4,name:"a_aux1",count:4,type:5121},{location:5,name:"a_aux2",count:2,type:5123},{location:6,name:"a_aux3",count:4,type:5121}],...a.dotDensity?[{location:2,name:"a_inverseArea",count:1,type:5126}]:[]]});
d=n.materialManager.getMaterialProgram(b,a,"materials/fill",q,d);e=this._getVAO(h,C,q,e);h.bindProgram(d);h.bindVAO(e);this._setSharedUniforms(d,b,c);a.textureBinding&&(n.textureManager.bindTextures(h,d,a),d.setUniform1f("u_zoomFactor",1/Math.pow(2,p-c.key.level)/b.pixelRatio));a.vvColor&&(d.setUniform1fv("u_vvColorValues",f.vvColorValues),d.setUniform4fv("u_vvColors",f.vvColors));a.vvOpacity&&(d.setUniform1fv("u_vvOpacityValues",f.vvOpacityValues),d.setUniform1fv("u_vvOpacities",f.vvOpacities));
if(a.dotDensity){e=k.TILE_SIZE/f.ddDotSize;a=e*window.devicePixelRatio*e*window.devicePixelRatio;c=1/Math.pow(2,p-c.key.level);const D=1/c*(1/c);b=f.ddDotScale?b.state.scale/f.ddDotScale:1;d.setUniform1f("u_tileZoomFactor",c);d.setUniform1f("u_tileDotsOverArea",a/(k.TILE_SIZE*window.devicePixelRatio*k.TILE_SIZE*window.devicePixelRatio));d.setUniformMatrix4fv("u_dotColors",f.ddColors);d.setUniform4fv("u_isActive",f.ddActiveDots);d.setUniform4fv("u_dotBackgroundColor",f.ddBackgroundColor);d.setUniform1f("u_dotValue",
Math.max(1,f.ddDotValue*b*D));this._bindDotDensityTextures(h,d,f,e)}h.drawElements(4,z,5125,Uint32Array.BYTES_PER_ELEMENT*A);h.bindVAO(null)};g._disposeTextures=function(){if(this._dotTextures){for(let b=0;b<this._dotTextures.length;b++)this._dotTextures[b].dispose();this._dotTextures=null}};g._bindDotDensityTextures=function(b,c,a,e){a=this._createDotDensityTextures(b,e,a.ddSeed);c.setUniform1iv("u_dotTextures",this._dotSamplers);for(c=0;c<a.length;c++)b.bindTexture(a[c],this._dotSamplers[c])};g._createDotDensityTextures=
function(b,c,a){if(this._dotTextureSize!==c||this._seed!==a)this._disposeTextures(),this._dotTextureSize=c,this._seed=a;null===this._dotTextures&&(a=new t(a),this._dotTextures=[this._allocDotDensityTexture(b,c,a),this._allocDotDensityTexture(b,c,a)]);return this._dotTextures};g._allocDotDensityTexture=function(b,c,a){const e=new Float32Array(c*c*4);for(let d=0;d<e.length;d++)e[d]=a.getFloat();return new u(b,{wrapMode:10497,pixelFormat:6408,dataType:5126,samplingMode:9728,width:c,height:c},e)};return l}(y)});