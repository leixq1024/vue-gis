// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.18/esri/copyright.txt for details.
//>>built
define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../definitions ../../../../../chunks/mat3f32 ../../../../webgl/Program ../../../../webgl/BufferObject ../../../../webgl/Texture ../../../../webgl/VertexArrayObject ../../../../webgl/Renderbuffer ../../../../webgl/FramebufferObject ../../../../webgl/programUtils ../../../../webgl/ProgramCache ../../../../webgl/RenderingContext ../../../../webgl/ShaderCompiler ../../../../../chunks/vec4f32 ../number ../enums ./WGLBrush ../../vectorTiles/shaders/Programs".split(" "),
function(t,A,n,B,u,C,L,D,M,N,E,O,P,Q,F,G,H,I,v){u=function(w){function p(){var a=w.apply(this,arguments)||this;a._color=F.fromValues(1,0,0,1);a._patternMatrix=B.create();a._programOptions={id:!1,pattern:!1};return a}A._inheritsLoose(p,w);var q=p.prototype;q.dispose=function(){this._program&&(this._program.dispose(),this._program=null);this._vao&&(this._vao.dispose(),this._vao=null)};q.drawMany=function(a,f){const {context:c,styleLayerUID:J}=a;this._loadWGLResources(c);const h=a.displayLevel;var e=
a.styleLayer,b=a.painter.getVectorTileProgramCache();const k=e.getPaintValue("background-color",h),x=e.getPaintValue("background-opacity",h),y=e.getPaintValue("background-pattern",h),l=void 0!==y,m=k[3]*x,z=a.spriteMosaic;let d;const K=(window.devicePixelRatio|1)>n.VTL_HIGH_RES_CUTOFF?2:1;a=a.drawPhase===H.WGLDrawPhase.HITTEST;const r=this._programOptions;r.id=a;r.pattern=l;b=b.getProgram(0,(a?1:0)<<1|(l?1:0),r);c.bindVAO(this._vao);c.bindProgram(b);if(l){d=z.getMosaicItemPosition(y,!0);if(!d)return;
b.setUniform1f("u_opacity",x);b.setUniform2f("u_pattern_tl",d.tl[0],d.tl[1]);b.setUniform2f("u_pattern_br",d.br[0],d.br[1]);b.setUniform1i("u_texture",n.VTL_TEXTURE_BINDING_UNIT_SPRITES);z.bind(c,9729,d.page,n.VTL_TEXTURE_BINDING_UNIT_SPRITES)}else this._color[0]=m*k[0],this._color[1]=m*k[1],this._color[2]=m*k[2],this._color[3]=m,b.setUniform4fv("u_color",this._color);b.setUniform1f("u_depth",e.z||0);a&&(e=G.u32to4Xu8(J+1),b.setUniform4fv("u_id",e));for(const g of f)b.setUniform1f("u_coord_range",
g.coordRange[0]),b.setUniformMatrix3fv("u_dvsMat3",g.transforms.dvs),l&&(f=K*g.size[0]*Math.max(Math.pow(2,Math.round(h)-g.key.level),1),e=f/d.size[1],this._patternMatrix[0]=f/d.size[0],this._patternMatrix[4]=e,b.setUniformMatrix3fv("u_pattern_matrix",this._patternMatrix)),c.setStencilFunction(514,g.stencilRef,255),c.drawArrays(5,0,4)};q._loadWGLResources=function(a){if(!this._program||!this._vao){var f=E.createProgram(a,v.background);if(f){var c=new Int8Array([0,0,1,0,0,1,1,1]);c=C.createVertex(a,
35044,c);a=new D(a,v.background.attributes,{geometry:[{name:"a_pos",count:2,type:5120,offset:0,stride:2,normalized:!1,divisor:0}]},{geometry:c});this._program=f;this._vao=a}}};return p}(I);t.WGLBrushVTLBackground=u;Object.defineProperty(t,"__esModule",{value:!0})});