// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.18/esri/copyright.txt for details.
//>>built
define("../../../../../../chunks/_rollupPluginBabelHelpers ../../../../../../core/mathUtils ../../../../../../core/screenUtils ../../definitions ../../number ../../materialKey/MaterialKey ../../color ../../GeometryUtils ../../util/Result ./util ./WGLBaseFillTemplate ./WGLDynamicMeshTemplate".split(" "),function(B,u,m,v,n,C,w,x,D,g,E,F){return function(y){function p(a){var e=y.call(this,a)||this;if(g.isFunction(a.color))e._dynamicPropertyMap.set("_fillColor",(b,f,d)=>(b=a.color(b,f,d))&&w.premultiplyAlphaRGBA(b)||
0);else{const b=a.color;e.fillColor=b&&w.premultiplyAlphaRGBA(b)||0}let q=0;g.isFunction(a.height)||(q=a.height||0);e._dynamicPropertyMap.set("_height",(b,f,d)=>g.isFunction(a.height)?a.height(b,f,d):q);let k=0;g.isFunction(a.offsetX)||(k=m.pt2px(a.offsetX||0)+128,255<k&&(k=255));e._dynamicPropertyMap.set("_offsetX",(b,f,d)=>g.isFunction(a.offsetX)?(b=m.pt2px(a.offsetX(b,f,d))+128,255<b&&(b=255),b):k);let h=1;g.isFunction(a.scaleX)||(h=a.scaleX||1);e._dynamicPropertyMap.set("_scaleX",(b,f,d)=>g.isFunction(a.scaleX)?
a.scaleX(b,f,d):h);let c=0;g.isFunction(a.offsetY)||(c=m.pt2px(-a.offsetY||0)+128,255<c&&(c=255));e._dynamicPropertyMap.set("_offsetY",(b,f,d)=>g.isFunction(a.offsetY)?(b=m.pt2px(-a.offsetY(b,f,d))+128,255<b&&(b=255),b):c);let l=0;g.isFunction(a.angle)||(l=x.radToByte(a.angle)||0);e._dynamicPropertyMap.set("_angle",(b,f,d)=>g.isFunction(a.angle)?x.radToByte(a.angle(b,f,d)):l);e.effects=a.effects;e._cimFillLayer=a;e._fillMaterialKey=C.FillMaterialKey.load(a.materialKey);return e}B._inheritsLoose(p,
y);p.fromCIMFill=function(a){return new p(a)};p.prototype.bindFeature=function(a,e,q){const k=a.readLegacyFeature();this._dynamicPropertyMap.forEach((l,b)=>{this[b]=l(k,e,q)});a=this._fillMaterialKey;var h=this._materialCache,c=this._cimFillLayer;this.aux3=n.i8888to32(0,0,this._angle,c.colorLocked?1:0);c=c.materialHash;c=c(k,e,q);c=h.get(c);h=null;c&&D.ok(c.spriteMosaicItem)&&(h=c.spriteMosaicItem);if(h){const {rect:l,width:b,height:f}=h;c=l.x+v.SPRITE_PADDING;const d=l.y+v.SPRITE_PADDING,z=c+b,A=
d+f;let r=u.nextHighestPowerOfTwo(m.pt2px(this._height));255<r?r=255:0>=r&&(r=u.nextHighestPowerOfTwo(A-d));let t=u.nextHighestPowerOfTwo(m.pt2px(this._height/f*b||0));255<t?t=255:0>=t&&(t=u.nextHighestPowerOfTwo(z-c));const G=this._scaleX;this.tl=n.i1616to32(c,d);this.br=n.i1616to32(z,A);this.aux1=n.i8888to32(t,r,this._offsetX,this._offsetY);this.aux2=n.i1616to32(128*G,128);a.sdf=h.sdf;a.pattern=!0;a.textureBinding=h.textureBinding}else this.aux2=this.aux1=this.br=this.tl=0,a.sdf=!1,a.pattern=!1,
a.textureBinding=0;this._materialKey=a.data};return p}(E(F))});