// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.18/esri/copyright.txt for details.
//>>built
define("exports ../../../../../../chunks/_rollupPluginBabelHelpers ../../../../../../core/has ../../../../../../core/maybe ../../../../../../core/promiseUtils ../../definitions ../../enums ../MeshData ../VertexVector ../templates/WGLLabelTemplate ../templates/WGLMarkerTemplate ../templates/WGLTemplateStore".split(" "),function(v,z,w,r,x,y,l,A,p,B,C,q){w=function(){function t(a,b,c){this._isDD=!1;this._geometryType=a;this._idField=b;this._templateStore=c}var m=t.prototype;m.update=function(a,b){this._isDD=
"simple"===a.mesh.matcher.type&&a.mesh.matcher.isDotDensity;r.isSome(a.mesh.labels)&&this._setLabelTemplates(a.mesh.labels,b)};m._setLabelTemplates=function(a,b){this._labelTemplates=a.map(c=>B.fromLabelClass(c,b))};m.createMeshData=function(a){const b=Array(5),c=this._labelTemplates&&0<this._labelTemplates.length,d="esriGeometryPolyline"===this._geometryType?y.HEURISTIC_GLYPHS_PER_LINE:y.HEURISTIC_GLYPHS_PER_FEATURE;b[l.WGLGeometryType.MARKER]=new p.VertexVectors(l.WGLGeometryType.MARKER,4*a);b[l.WGLGeometryType.FILL]=
new p.VertexVectors(l.WGLGeometryType.FILL,a,this._isDD);b[l.WGLGeometryType.LINE]=new p.VertexVectors(l.WGLGeometryType.LINE,a);b[l.WGLGeometryType.TEXT]=new p.VertexVectors(l.WGLGeometryType.TEXT,4*a);b[l.WGLGeometryType.LABEL]=new p.VertexVectors(l.WGLGeometryType.LABEL,c?4*d:0);return new A.MeshData(b,{features:a,records:a,metrics:0})};m.analyze=async function(a,b,c,d,h){if(!x.isAborted(h)){var e;"dictionary"===b.type&&(e=await b.analyze(this._idField,a.copy(),c,d,h));for(var g=0;a.next();){var f=
void 0;f=e?e[g++]:b.match(this._idField,a,this._geometryType,c,d);a.setGroupId(f);if(q.isDynamicId(f)){f=this._templateStore.getDynamicTemplateGroup(f);for(const k of f)k&&k.analyze&&k.analyze(this._templateStore,a,c,d)}}return this._templateStore.finalize(h)}};m.analyzeGraphics=async function(a,b,c,d,h){if(!x.isAborted(h)){a=a.getCursor();for(b&&await b.analyze(this._idField,a.copy(),c,d,h);a.next();){let e=a.getGroupId();if(null==e||-1===e)e=b.match(this._idField,a,a.geometryType,c,d),a.setGroupId(e);
if(q.isDynamicId(e)){const g=this._templateStore.getDynamicTemplateGroup(e);for(const f of g)f&&f.analyze&&f.analyze(this._templateStore,a,c,d)}a.setGroupId(e)}return this._templateStore.finalize(h)}};m.writeGraphic=function(a,b){var c=b.getGroupId();const d=b.getDisplayId(),h=this._templateStore.getTemplateGroup(c),e=b.geometryType;if(null!=d){if(q.isDynamicId(c))for(const g of h)g.bindFeature(b,null,null);if(h){a.writeDisplayObject(d,b.readGraphic().insertAfter);for(const g of h)g&&(c=a.get(g.geometryType),
g.writeMesh(a,c,b,e,d))}}};m.writeCursor=function(a,b,c,d,h,e){const g=b.getGroupId(),f=b.getDisplayId();var k=this._templateStore.getTemplateGroup(g);if(null!=f&&k){a.writeDisplayObject(f,0);if(q.isDynamicId(g))for(const u of k)u.bindFeature(b,c,d);for(var n of k)c=a.get(n.geometryType),!n.needsPixelBuffer&&b.hasFilter()||n.writeMesh(a,c,b,this._geometryType,f);n=a.hasDisplayRecords();r.isSome(e)&&n&&(k=e&&this._findLabelRef(k),this._writeLabels(a,b,f,e,k,h));a.endDisplayObject()}};m._findLabelRef=
function(a){for(const b of a)if(b instanceof C)return b;return null};m._writeLabels=function(a,b,c,d,h,e){for(const g of d)if(r.isSome(g)&&g){const {glyphs:f,rtl:k,index:n}=g;d=this._labelTemplates[n];const u=a.get(d.geometryType);d.bindReferenceTemplate(h);d.bindTextInfo(f,k);d.writeMesh(a,u,b,this._geometryType,c,e)}};z._createClass(t,[{key:"templates",get:function(){return this._templateStore}}]);return t}();v.WGLMeshFactory=w;Object.defineProperty(v,"__esModule",{value:!0})});