// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.18/esri/copyright.txt for details.
//>>built
define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/maybe ../definitions ../../../../../chunks/mat3f32 ../../../../../chunks/vec4f32 ../number ../enums ./WGLBrush".split(" "),function(F,L,G,z,M,H,N,A,B){const I=1/65536,J=[1,1,1,1];B=function(K){function C(){var c=K.apply(this,arguments)||this;c._color=H.create();c._outlineColor=H.create();c._fillProgramOptions={id:!1,dd:!1,pattern:!1};c._outlineProgramOptions={id:!1,dd:!1};c._patternMatrix=M.create();return c}L._inheritsLoose(C,
K);var x=C.prototype;x.dispose=function(){};x.drawMany=function(c,n){const {displayLevel:b,drawPhase:g,renderPass:q,styleLayerUID:r}=c,a=c.styleLayer,k=a.getPaintValue("fill-pattern",b);var e=a.hasDataDrivenColor?J:a.getPaintValue("fill-color",b);const f=a.hasDataDrivenOpacity?1:a.getPaintValue("fill-opacity",b);var h=f*e[3];const u=void 0!==k||1>h||a.hasDataDrivenFill;if(!u||"opaque"!==q){this._color[0]=h*e[0];this._color[1]=h*e[1];this._color[2]=h*e[2];this._color[3]=h;var t;g===A.WGLDrawPhase.HITTEST&&
(t=N.u32to4Xu8(r+1));e=a.getPaintValue("fill-translate",b);h=a.getPaintValue("fill-translate-anchor",b);this._drawFill(c,r,a,n,e,h,k,u,t);this._drawOutline(c,r,a,n,e,h,k,t,f)}};x._drawFill=function(c,n,b,g,q,r,a,k,e){const {context:f,displayLevel:h,drawPhase:u,pixelRatio:t,renderPass:D,spriteMosaic:v,state:l}=c;if(k||"translucent"!==D){k=void 0!==a;var w=t>z.VTL_HIGH_RES_CUTOFF?2:1,d=b.hasDataDrivenFill;c=c.painter.getVectorTileProgramCache();var E=u===A.WGLDrawPhase.HITTEST,y=this._fillProgramOptions;
y.id=E;y.dd=d;y.pattern=k;d=c.getProgram(1,(E?1:0)<<2|(d?1:0)<<1|(k?1:0),y);f.bindProgram(d);if(k){var p=v.getMosaicItemPosition(a,!0);if(!p){f.bindProgram();return}d.setUniform2f("u_pattern_tl",p.tl[0],p.tl[1]);d.setUniform2f("u_pattern_br",p.br[0],p.br[1]);d.setUniform1i("u_texture",z.VTL_TEXTURE_BINDING_UNIT_SPRITES);v.bind(f,9729,p.page,z.VTL_TEXTURE_BINDING_UNIT_SPRITES)}d.setUniformMatrix3fv("u_displayMat3",1===r?l.displayMat3:l.displayViewMat3);d.setUniform2fv("u_fillTranslation",q);d.setUniform1f("u_depth",
b.z+I);d.setUniform4fv("u_color",this._color);E&&d.setUniform4fv("u_id",e);for(const m of g)m.layerData.has(n)&&(b=m.layerData.get(n),b.prepareForRendering(f,c),g=b.fillVertexArrayObject,G.isNone(g)||(f.bindVAO(g),d.setUniformMatrix3fv("u_dvsMat3",m.transforms.dvs),k&&(g=m.coordRange[0]/(w*m.size[0]*Math.max(Math.pow(2,Math.round(h)-m.key.level),1)),q=1/(p.size[1]*g),this._patternMatrix[0]=1/(p.size[0]*g),this._patternMatrix[4]=q,d.setUniformMatrix3fv("u_pattern_matrix",this._patternMatrix)),f.setStencilFunction(514,
m.stencilRef,255),f.drawElements(4,b.fillIndexCount,5125,Uint32Array.BYTES_PER_ELEMENT*b.fillIndexStart),m.triangleCount+=b.fillIndexCount/3))}};x._drawOutline=function(c,n,b,g,q,r,a,k,e){const {context:f,displayLevel:h,drawPhase:u,renderPass:t,pixelRatio:D,state:v}=c;if("opaque"!==t&&(a=void 0!==a,b.getPaintValue("fill-antialias",h)&&!a||b.hasDataDrivenOutlineColor)){c=c.painter.getVectorTileProgramCache();a=b.hasDataDrivenOutline;if(b.outlineUsesFillColor){if(1!==this._color[3])return;this._outlineColor[0]=
this._color[0];this._outlineColor[1]=this._color[1];this._outlineColor[2]=this._color[2];this._outlineColor[3]=this._color[3]}else{var l=b.hasDataDrivenOutlineColor?J:b.getPaintValue("fill-outline-color",h);e*=l[3];this._outlineColor[0]=e*l[0];this._outlineColor[1]=e*l[1];this._outlineColor[2]=e*l[2];this._outlineColor[3]=e}e=.75/D;l=u===A.WGLDrawPhase.HITTEST;var w=this._outlineProgramOptions;w.id=l;w.dd=a;a=c.getProgram(2,(l?1:0)<<1|(a?1:0),w);f.bindProgram(a);a.setUniformMatrix3fv("u_displayMat3",
1===r?v.displayMat3:v.displayViewMat3);a.setUniform2fv("u_fillTranslation",q);a.setUniform1f("u_depth",b.z+I);a.setUniform1f("u_outline_width",e);a.setUniform4fv("u_color",this._outlineColor);l&&a.setUniform4fv("u_id",k);for(const d of g)d.layerData.has(n)&&(b=d.layerData.get(n),b.prepareForRendering(f,c),g=b.outlineVertexArrayObject,G.isNone(g)||(f.bindVAO(g),a.setUniformMatrix3fv("u_dvsMat3",d.transforms.dvs),f.setStencilFunction(514,d.stencilRef,255),f.drawElements(4,b.outlineIndexCount,5125,Uint32Array.BYTES_PER_ELEMENT*
b.outlineIndexStart),d.triangleCount+=b.outlineIndexCount/3))}};return C}(B);F.WGLBrushVTLFill=B;Object.defineProperty(F,"__esModule",{value:!0})});