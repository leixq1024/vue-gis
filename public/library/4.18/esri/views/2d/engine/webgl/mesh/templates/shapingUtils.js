// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.18/esri/copyright.txt for details.
//>>built
define("exports ../../../../../../chunks/_rollupPluginBabelHelpers ../../../../../../chunks/vec2 ../../../../../../chunks/mat2d ../../../../../../chunks/mat2df32 ../../../../../../chunks/vec2f32 ../../alignmentUtils ../../number ../../Rect ../../collisions/BoundingBox".split(" "),function(z,G,y,n,w,H,K,u,L,A){const M=Math.PI/180;let F=function(){function k(a,d,c,b){this._rotationT=w.create();this.minZoom=this._yBounds=this._xBounds=0;this.maxZoom=255;const e=c.rect,f=new Float32Array(8);a*=b;d*=b;
const m=c.code?e.width*b:c.metrics.width,h=c.code?e.height*b:c.metrics.height;f[0]=a;f[1]=d;f[2]=a+m;f[3]=d;f[4]=a;f[5]=d+h;f[6]=a+m;f[7]=d+h;this._data=f;this._setTextureCoords(e);this._scale=b;this._mosaic=c;this.x=a;this.y=d}var g=k.prototype;g.setTransform=function(a){this._T=a;this._offsets=null};g._setOffsets=function(a){this._offsets||(this._offsets={upperLeft:0,upperRight:0,lowerLeft:0,lowerRight:0});const d=this._offsets,c=new Float32Array(8),b=n.multiply(w.create(),this._rotationT,this._T);
w.transformMany(c,a,b);d.upperLeft=u.i1616to32(8*c[0],8*c[1]);d.upperRight=u.i1616to32(8*c[2],8*c[3]);d.lowerLeft=u.i1616to32(8*c[4],8*c[5]);d.lowerRight=u.i1616to32(8*c[6],8*c[7])};g._setTextureCoords=function({x:a,y:d,width:c,height:b}){this._texcoords={upperLeft:u.i1616to32(a,d),upperRight:u.i1616to32(a+c,d),lowerLeft:u.i1616to32(a,d+b),lowerRight:u.i1616to32(a+c,d+b)}};G._createClass(k,[{key:"width",get:function(){return this._mosaic.metrics.width*this._scale}},{key:"mosaic",get:function(){return this._mosaic}},
{key:"angle",set:function(a){this._angle=a;n.identity(this._rotationT);n.rotate(this._rotationT,this._rotationT,-a);this._setOffsets(this._data)},get:function(){return this._angle}},{key:"xTopLeft",get:function(){return this._data[0]}},{key:"yTopLeft",get:function(){return this._data[1]}},{key:"xBottomRight",get:function(){return this._data[6]}},{key:"yBottomRight",get:function(){return this._data[7]}},{key:"texcoords",get:function(){return this._texcoords}},{key:"textureBinding",get:function(){return this._mosaic.textureBinding}},
{key:"offsets",get:function(){this._offsets||this._setOffsets(this._data);return this._offsets}},{key:"char",get:function(){return String.fromCharCode(this._mosaic.code)}},{key:"code",get:function(){return this._mosaic.code}},{key:"bounds",get:function(){const {height:a,width:d}=this._mosaic.metrics;var c=d*this._scale,b=Math.abs(a)*this._scale,e=new Float32Array(8);e[0]=this.x;e[1]=this.y;e[2]=this.x+c;e[3]=this.y;e[4]=this.x;e[5]=this.y+b;e[6]=this.x+c;e[7]=this.y+b;c=n.multiply(w.create(),this._rotationT,
this._T);w.transformMany(e,e,c);b=c=Infinity;let f=0;var m=0;for(let h=0;4>h;h++){const l=e[2*h],q=e[2*h+1];c=Math.min(c,l);b=Math.min(b,q);f=Math.max(f,l);m=Math.max(m,q)}e=f-c;m-=b;return new A(c+e/2,b+m/2,e,m)}}]);return k}();const N=(k,g)=>({code:0,page:0,sdf:!0,rect:new L(0,0,11,8),textureBinding:g,metrics:{advance:0,height:4,width:k,left:0,top:0}});let I=function(){function k(a,d,c){this._rotation=0;this._decorate(a,d,c);this.glyphs=a;this.bounds=this._createBounds(a);this.isMultiline=1<d.length;
this._hasRotation=0!==c.angle;this._T=this._createGlyphTransform(this.bounds,c);for(const b of a)b.setTransform(this._T)}var g=k.prototype;g.setRotation=function(a){if(0!==a||0!==this._rotation){this._rotation=a;var d=this._T;a=n.fromRotation(w.create(),a);n.multiply(d,a,d);for(const c of this.glyphs)c.setTransform(this._T)}};g._decorate=function(a,d,c){if(c.decoration&&"none"!==c.decoration&&a.length){var b=c.scale;c="underline"===c.decoration?30:20;var e=a[0].textureBinding;for(const f of d)a.push(new F(f.startX*
b,f.startY*b+c*b,N((f.width+f.glyphWidthEnd)*b,e),1))}};g._createBounds=function(a){let d=Infinity,c=Infinity,b=0;var e=0;for(const f of a)d=Math.min(d,f.xTopLeft),c=Math.min(c,f.yTopLeft),b=Math.max(b,f.xTopLeft+f.width),e=Math.max(e,f.yBottomRight);a=b-d;e-=c;return new A(d+a/2,c+e/2,a,e)};g._createGlyphTransform=function(a,d){const c=M*d.angle,b=w.create(),e=H.create();n.translate(b,b,y.set(e,d.xOffset,-d.yOffset));d.isCIM?n.rotate(b,b,c):(n.translate(b,b,y.set(e,a.x,a.y)),n.rotate(b,b,c),n.translate(b,
b,y.set(e,-a.x,-a.y)));return b};G._createClass(k,[{key:"boundsT",get:function(){var a=this.bounds;const d=y.set(H.create(),a.x,a.y);y.transformMat2d(d,d,this._T);return this._hasRotation?(a=Math.max(a.width,a.height),new A(d[0],d[1],a,a)):new A(d[0],d[1],a.width,a.height)}}]);return k}(),B=function(k,g,a,d,c,b){this.startY=this.startX=this.glyphWidthEnd=0;this.start=Math.max(0,Math.min(g,a));this.end=Math.max(0,Math.max(g,a));this.end<k.length&&(this.glyphWidthEnd=k[this.end].metrics.width);this.width=
d;this.yMin=c;this.yMax=b};z.ShapedGlyph=F;z.ShapingInfo=I;z.shapeGlyphs=function(k,g,a){const d=a.scale,c=[];{var b=[];var e=1/a.scale*a.maxLineWidth;var f=g?k.length-1:0;var m=g?-1:k.length;g=g?-1:1;var h=f,l=0,q=0;let p=h,v=p,C=0,r=Infinity,t=0;for(;h!==m;){const {code:D,metrics:x}=k[h];var E=Math.abs(x.top);10!==D&&32!==D&&(r=Math.min(r,E),t=Math.max(t,E+x.height));10===D?(h!==f&&(b.push(new B(k,p,h-g,l,r,t)),r=Infinity,t=0),l=0,p=h+g,v=h+g,q=0):32===D?(v=h+g,q=0,C=x.advance,l+=x.advance):(l>
e&&(v!==p?(E=v-2*g,l-=C,b.push(new B(k,p,E,l-q,r,t)),r=Infinity,t=0,p=v,l=q):(b.push(new B(k,p,h-g,l,r,t)),r=Infinity,t=0,v=p=h,l=0)),l+=x.advance,q+=x.advance);h+=g}e=new B(k,p,h-g,l,r,t);0<=e.start&&e.end<k.length&&b.push(e)}for(e=0;e<b.length;e++);e=f=b[0].yMin;f=b[b.length-1].yMax+a.lineHeight*(b.length-1)+("underline"===a.decoration?4:0)-f;const {vAlign:J,hAlign:O}=a;m=J===K.VAlign.Baseline?1:0;e=(1-m)*-e+f/2*(m?0:J-1)+-26*(m?1:0);for(f=0;f<b.length;f++){const {start:p,end:v,width:C}=b[f];m=
C/2*(O+1)*-1-3;g=f*a.lineHeight+e-3;b[f].startX=m;b[f].startY=g;for(h=p;h<=v;h++)l=k[h],10!==l.code&&(q=new F(m+l.metrics.left,g-l.metrics.top,l,d),m+=l.metrics.advance,c.push(q))}return new I(c,b,a)};Object.defineProperty(z,"__esModule",{value:!0})});