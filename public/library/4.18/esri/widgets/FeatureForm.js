// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.18/esri/copyright.txt for details.
//>>built
define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/has ../core/Logger ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/property ../core/accessorSupport/decorators/aliasOf ../core/jsonMap ../core/accessorSupport/decorators/subclass ../core/urlUtils ../core/uuid ../portal/support/resourceExtension ../layers/support/domains ../layers/support/fieldUtils ../intl/locale ../intl ../intl/moment ./support/widgetUtils ./support/decorators/messageBundle ./support/decorators/renderable ./support/decorators/vmEvent ../chunks/index ./Widget ./FeatureForm/FeatureFormViewModel".split(" "),
function(r,p,n,N,O,x,t,P,D,Q,R,S,E,F,G,T,H,U,I,w,J,h,K,L){n=function(C){function z(a,b){a=C.call(this,a,b)||this;a._activeDateEdit=null;a._activeInputName=null;a._fieldFocusNeeded=!1;a._moment=null;a._userUpdatedInputFieldNames=new Set;a.description=null;a.feature=null;a.fieldConfig=null;a.formTemplate=null;a.groupDisplay="all";a.label=void 0;a.layer=null;a.messages=null;a.strict=null;a.title=null;a.viewModel=new L;a._handleFormKeyDown=a._handleFormKeyDown.bind(r._assertThisInitialized(a));a._handleInputBlur=
a._handleInputBlur.bind(r._assertThisInitialized(a));a._handleInputFocus=a._handleInputFocus.bind(r._assertThisInitialized(a));a._handleNumberInputMouseDown=a._handleNumberInputMouseDown.bind(r._assertThisInitialized(a));a._handleInputKeyDown=a._handleInputKeyDown.bind(r._assertThisInitialized(a));a._handleOptionChange=a._handleOptionChange.bind(r._assertThisInitialized(a));a._handleGroupClick=a._handleGroupClick.bind(r._assertThisInitialized(a));a._handleSubmit=a._handleSubmit.bind(r._assertThisInitialized(a));
a._afterScrollerCreateOrUpdate=a._afterScrollerCreateOrUpdate.bind(r._assertThisInitialized(a));return a}r._inheritsLoose(z,C);var e=z.prototype;e.loadLocale=async function(){this._moment=await H.loadMoment()};e.initialize=function(){this.own(this.watch("feature",()=>{const a=this._getFocusableInput("forward");this._activeInputName=a&&a.name;this._userUpdatedInputFieldNames.clear();this._fieldFocusNeeded=!0}),this.on("submit",a=>{if(0<a.invalid.length){const [b]=a.invalid;a.invalid.forEach(c=>this._userUpdatedInputFieldNames.add(c));
this._activeInputName=b;this._fieldFocusNeeded=!0;this.scheduleRender()}}))};e.destroy=function(){this._userUpdatedInputFieldNames.clear();this._userUpdatedInputFieldNames=null};e.getValues=function(){return null};e.submit=function(){return null};e.render=function(){const {state:a}=this.viewModel;return h.jsx("div",{class:this.classes("esri-feature-form","esri-widget","esri-widget--panel")},"ready"===a?this.renderForm():null)};e.renderForm=function(){var a=this.title?h.jsx("h2",{class:"esri-widget__heading",
key:"title"},this.title):null;const b=this.description?h.jsx("p",{class:"esri-feature-form__description-text",key:"description"},this.description):null;a=a||b?h.jsx("div",{class:"esri-feature-form__form-header"},a,b):null;return h.jsx("form",{class:"esri-feature-form__form",novalidate:!0,onsubmit:this._handleSubmit,onkeydown:this._handleFormKeyDown},a,this.renderFields())};e.renderFields=function(){const {viewModel:{inputFields:a}}=this;return a.map((b,c)=>b&&b.inputFields?this.renderGroup(b,c):this.renderLabeledField(b))};
e.renderGroup=function(a,b){const {description:c,label:d,inputFields:g,state:l}=a;var f=this.viewModel.findField(this._activeInputName);f=!(!f||f.group!==a);const m=`${this.id}_group_${b}`,k=`${this.id}_group-label_${b}`,q=`${this.id}_group-description_${b}`,A=c?h.jsx("p",{class:this.classes("esri-feature-form__group-description","esri-feature-form__description-text"),id:q},c):null,u="sequential"===this.groupDisplay,v=u?f:"expanded"===l,B=v?"esri-icon-up":"esri-icon-down";return h.jsx("fieldset",
{"aria-expanded":v.toString(),"aria-labelledby":k,"aria-describedby":c?q:"",class:this.classes("esri-feature-form__group",u?"esri-feature-form__group--sequential":null,v?null:"esri-feature-form__group--collapsed",f?"esri-feature-form__group--active":null),"data-group":a,id:m,key:b,onclick:this._handleGroupClick},h.jsx("button",{role:u?"presentation":void 0,class:"esri-feature-form__group-header",type:"button",tabIndex:u?-1:0},h.jsx("div",{class:"esri-feature-form__group-title"},h.jsx("h4",{class:this.classes("esri-feature-form__group-label",
"esri-widget__heading"),id:k},d),A),u?null:h.jsx("span",{class:this.classes(B,"esri-feature-form__group-toggle-icon")})),g.map(y=>this.renderLabeledField(y)))};e._getFocusableInput=function(a,b){var c=this.viewModel._allInputFields;c="forward"===a?c:c.slice().reverse();b?b&&b.inputFields?a=c.indexOf(b.inputFields[0]):(this._isFieldInClosedCollapsibleGroup(b)?({inputFields:b}=b.group,a="forward"===a?b[b.length-1]:b[0]):a=b,a=c.indexOf(a)+1):a=0;for(;a<c.length;a++)if(b=c[a],b.visible&&b.editable)return b;
return null};e.renderLabeledField=function(a){const {label:b,layer:c,type:d}=a;return h.jsx("label",{key:`${c.id}-${a.name}`,class:"esri-feature-form__label"},[b,"unsupported"!==d?this.renderInputField(a):this.renderUnsupportedField(a),this.renderAuxiliaryText(a)])};e.renderInputField=function(a){var {viewModel:b}=this;const {domain:c,editable:d,name:g,type:l}=a;b=b.getValue(g);const f=!d,m=this.getCommonInputProps(a);return c&&"coded-value"===c.type&&!f?this.renderSelectInputField(b,c.codedValues.map(({code:k,
name:q})=>({value:k,name:q})),m):"text"===l&&"text-area"===a.editorType||"rich-text"===a.editorType?h.jsx("textarea",Object.assign({},m)):"datetime-picker"===a.editorType||"date"===l?this.renderDateInputField(b,m):h.jsx("input",Object.assign({type:"text"===l?"text":"number"},m))};e.renderDateInputField=function(a,b){const {date:c,time:d}=this._formatDate(0);var g=`${this.id}-${b.key}`;const l=`${g}-date`;g=`${g}-time`;const f=b["data-field"],{includeTime:m}=f,{date:k,time:q}=this._formatDate(a);return h.jsx("div",
{key:`${b.key}-date`,class:"esri-feature-form__date-input-container"},h.jsx("div",{class:this.classes("esri-feature-form__date-input-part",m?null:"esri-feature-form__date-input-part--lone")},h.jsx("input",Object.assign({"aria-label":f.label,"aria-describedby":l,type:"text"},b,{"data-date-part":"date",class:this.classes(b.class,"esri-feature-form__input--date"),value:k})),h.jsx("div",{class:"esri-feature-form__date-format-hint",id:l},c)),m?h.jsx("div",{class:"esri-feature-form__date-input-part",key:"time-input"},
h.jsx("input",Object.assign({"aria-describedby":g,"aria-label":f.label,type:"text"},b,{"data-date-part":"time",class:this.classes(b.class,"esri-feature-form__input--time"),value:q})),h.jsx("div",{class:"esri-feature-form__date-format-hint",id:g},d)):null)};e.renderUnsupportedField=function(a){a=this.viewModel.getValue(a.name);return h.jsx("input",{class:this.classes("esri-input","esri-feature-form__input","esri-feature-form__input--disabled"),disabled:!0,type:"text",value:`${a}`})};e.renderSelectInputField=
function(a,b,c){let d=!1;b=b.map(g=>{g.value===a&&(d=!0);return h.jsx("option",{value:`${g.value}`,key:g.name},g.name)});null==a||""===a||d||b.unshift(h.jsx("option",{value:`${a}`,key:"outlier-option"},a));c["data-field"].required||b.unshift(h.jsx("option",{value:"",key:"empty-option"},this.messages.empty));return h.jsx("select",Object.assign({},c,{class:this.classes(c.class,"esri-select"),onchange:this._handleOptionChange}),b)};e.renderAuxiliaryText=function(a){if(this._userUpdatedInputFieldNames.has(a.name)&&
!a.valid)return h.jsx("div",{key:"error-message"},h.jsx("span",{class:this.classes("esri-feature-form__input-icon--invalid","esri-icon-notice-triangle")}),h.jsx("div",{class:"esri-feature-form__field-error-message"},a.errorMessage));if(a.description)return h.jsx("div",{key:"description",class:"esri-feature-form__description-text"},a.description)};e.getCommonInputProps=function(a){const {groupDisplay:b,viewModel:c}=this,{editable:d,group:g,hint:l,maxLength:f,minLength:m,name:k,required:q,type:A,valid:u}=
a,v=c.getValue(k),B=this._userUpdatedInputFieldNames.has(k),y=!d,M="all"===b&&"collapsed"===(null==g?void 0:g.state);return{afterCreate:this._afterScrollerCreateOrUpdate,afterUpdate:this._afterScrollerCreateOrUpdate,"aria-invalid":u?"false":"true","class":this.classes("esri-input","esri-feature-form__input",y?"esri-feature-form__input--disabled":null,B&&!u?"esri-feature-form__input--invalid":null),key:k,minlength:-1<m?`${m}`:"",maxlength:-1<f?`${f}`:"",...this._getNumberFieldConstraints(a),disabled:y,
value:null==v?"":`${v}`,"data-field":a,onfocus:this._handleInputFocus,onblur:this._handleInputBlur,onkeydown:this._handleInputKeyDown,onmousedown:"number"===A?this._handleNumberInputMouseDown:null,required:q,tabIndex:M?-1:0,title:l}};e._isFieldInClosedCollapsibleGroup=function(a){var b;return"all"===this.groupDisplay&&!(a&&a.inputFields)&&"collapsed"===(null==a?void 0:null==(b=a.group)?void 0:b.state)};e._handleNumberInputMouseDown=function({target:a}){a.disabled||a.focus();this.scheduleRender()};
e._getNumberFieldConstraints=function(a){return(a=E.getDomainRange(a.domain)||F.getFieldRange(a.field))&&a.max!==Number.MAX_VALUE&&a.min!==Number.MIN_VALUE?a:{min:null,max:null}};e._afterScrollerCreateOrUpdate=function(a){const b=a["data-field"],c=this.viewModel.findField(this._activeInputName);b.editable&&this._fieldFocusNeeded&&c===b&&(this._fieldFocusNeeded=!1,a.focus())};e._handleInputFocus=function(a){this._activeInputName=a.target["data-field"].name};e._handleInputBlur=function(a){var b=a.target;
const c=b["data-field"],d=(a=a.relatedTarget)&&a["data-field"];this._syncDateEditsBeforeValueCommit(b);d&&"date"===c.type&&"date"===d.type&&c.field===d.field?""!==b.value&&""===a.value&&(b=a.getAttribute("data-date-part"),a.value=this._formatDate(Date.now())[b]):(this._commitValue(b),this.scheduleRender())};e._commitValue=function(a){var b=a["data-field"];if(this._activeDateEdit){const {date:d,time:g}=this._activeDateEdit;var c=this._getDateEditValue(b,"date");b=this._getDateEditValue(b,"time");const l=
""===c||""===b;if(d){const {input:f}=d;f.value=l?"":c}g&&({input:c}=g,c.value=l?"":b);this._activeDateEdit=null;if(d&&g){this._updateDateFieldValue(d.input,g.input);return}}this._updateFieldValue(a)};e._getDateEditValue=function(a,b){var c=this._activeDateEdit[b];if(c){var {value:d}=c;return""===d?"":(c=this._parseDate(c.value,b))?this._formatDate(c.getTime())[b]:this._formatDate(a.value)[b]}};e._handleInputKeyDown=function(a){const {key:b,altKey:c,ctrlKey:d,metaKey:g,shiftKey:l}=a;var f=a.target,
m=f["data-field"];if("Tab"===b){var k=l?"backward":"forward",q=f.getAttribute("data-date-part");this._syncDateEditsBeforeValueCommit(f);"backward"===k&&"time"===q||"forward"===k&&"date"===q&&m.includeTime||(this._commitValue(f),f=this.viewModel.findField(m.name),k=this._getFocusableInput(k,f),f=f.group===(null==k?void 0:k.group),this._activeInputName=null==k?void 0:k.name,k&&("sequential"===this.groupDisplay||f)?(a.preventDefault(),this._fieldFocusNeeded=!0):this.renderNow())}else"Enter"!==b?({type:f}=
m.field,k="single"===f||"double"===f,"integer"!==f&&"small-integer"!==f&&!k||c||d||g||1!==b.length||(f=Number(b),m=["-","+"],q=["e","."],k=k?[...m,...q]:m,isNaN(f)&&-1===k.indexOf(b)&&a.preventDefault())):this._isFieldInClosedCollapsibleGroup(m)?m.group.state="expanded":(this._updateFieldValue(a.target),this.scheduleRender())};e._syncDateEditsBeforeValueCommit=function(a){if("date"===a["data-field"].type){var b=a.getAttribute("data-date-part");this._activeDateEdit={...this._activeDateEdit,[b]:{value:a.value,
input:a}}}};e._updateFieldValue=function(a){const b=a["data-field"];this.viewModel.setValue(b.name,this._parseValue(a));this._userUpdatedInputFieldNames.add(b.name)};e._updateDateFieldValue=function(a,b){const c=a["data-field"];this.viewModel.setValue(c.name,this._parseDateTimeValue(a,b));this._userUpdatedInputFieldNames.add(c.name)};e._parseValue=function(a){var b=a["data-field"],c=a.value,{type:d}=b;if("number"===d)return parseFloat(c);if("date"===d){if(!c)return null;d=Number(c);if(!isNaN(d))return d;
a=a.getAttribute("data-date-part");d=this._parseDate(c,a);if(!d)return null;c=this._moment;d=c(d);var g=b.domain;const l=c();let f=l;g&&"range"===g.type&&(g=c(g.maxValue),l.isAfter(g)||(f=g));b=this.viewModel.getValue(b.name);b=c(null!=b?b:f);"date"===a?(d.hour(b.hour()),d.minutes(b.minutes()),d.seconds(b.seconds())):(d.date(b.date()),d.month(b.month()),d.year(b.year()));return d.valueOf()}return c};e._parseDateTimeValue=function(a,b){a=a.value;b=b.value;if(!a||!b)return null;a=this._parseDate(a,
"date");b=this._parseDate(b,"time");if(!a||!b)return null;a=this._moment(a);b=this._moment(b);a.hour(b.hour());a.minutes(b.minutes());a.seconds(b.seconds());return a.valueOf()};e._handleOptionChange=function(a){this._updateFieldValue(a.target);this.scheduleRender()};e._handleGroupClick=function(a){var b;const c=a.currentTarget["data-group"],d="expanded"===c.state,g="sequential"===this.groupDisplay;if(!d||a.target.closest(".esri-feature-form__group-header")){this._activeInputName=null==(b=this._getFocusableInput("forward",
c))?void 0:b.name;if(g){a=a.target.closest(".esri-feature-form__group-header");if(d&&!a)return;this.viewModel.inputFields.forEach(l=>{l&&l.inputFields&&l!==c&&(l.state="collapsed")})}c.state=d?"collapsed":"expanded";this._fieldFocusNeeded=g;this.scheduleRender()}};e._handleSubmit=function(a){a.preventDefault()};e._handleFormKeyDown=function(a){"Enter"===a.key&&this.viewModel.submit()};e._formatDate=function(a){if(null==a)return{date:"",time:""};a=this._moment(a);return{date:a.format("L"),time:a.format("LTS")}};
e._parseDate=function(a,b){if(null==a||""===a)return null;a=this._moment(a,"date"===b?"L":"LTS",G.getLocale(),!1);return a.isValid()?a.toDate():null};return z}(K);p.__decorate([t.aliasOf("viewModel.description"),w.renderable()],n.prototype,"description",void 0);p.__decorate([t.aliasOf("viewModel.feature")],n.prototype,"feature",void 0);p.__decorate([t.aliasOf("viewModel.fieldConfig")],n.prototype,"fieldConfig",void 0);p.__decorate([t.aliasOf("viewModel.formTemplate")],n.prototype,"formTemplate",void 0);
p.__decorate([x.property(),w.renderable()],n.prototype,"groupDisplay",void 0);p.__decorate([x.property({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],n.prototype,"label",void 0);p.__decorate([t.aliasOf("viewModel.layer")],n.prototype,"layer",void 0);p.__decorate([x.property(),w.renderable(),I.messageBundle("esri/widgets/FeatureForm/t9n/FeatureForm")],n.prototype,"messages",void 0);p.__decorate([t.aliasOf("viewModel.strict")],n.prototype,"strict",void 0);p.__decorate([t.aliasOf("viewModel.title"),
w.renderable()],n.prototype,"title",void 0);p.__decorate([x.property(),w.renderable(["viewModel.inputFields","viewModel.state"]),J.vmEvent(["value-change","submit"])],n.prototype,"viewModel",void 0);p.__decorate([t.aliasOf("viewModel.getValues")],n.prototype,"getValues",null);p.__decorate([t.aliasOf("viewModel.submit")],n.prototype,"submit",null);return n=p.__decorate([D.subclass("esri.widgets.FeatureForm")],n)});