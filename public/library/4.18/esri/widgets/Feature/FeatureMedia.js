// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.18/esri/copyright.txt for details.
//>>built
define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/has ../../core/Logger ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/property ../../core/accessorSupport/decorators/aliasOf ../../core/jsonMap ../../core/accessorSupport/decorators/subclass ../../core/urlUtils ../../core/uuid ../../portal/support/resourceExtension ../../core/events ../../core/watchUtils ../support/widgetUtils ../support/decorators/messageBundle ../support/decorators/renderable ../../chunks/index ../Widget ./support/featureUtils ./FeatureMedia/FeatureMediaViewModel ../support/chartUtils".split(" "),
function(A,p,m,J,K,v,q,L,B,M,N,O,C,D,r,E,w,n,F,G,x,y){m=function(z){function t(a,b){a=z.call(this,a,b)||this;a._refreshTimer=null;a._refreshIntervalInfo=null;a.attributes=null;a.activeMediaInfoIndex=null;a.fieldInfoMap=null;a.layer=null;a.mediaInfos=null;a.popupTemplate=null;a.relatedInfos=null;a.viewModel=new x;a.messages=null;return a}A._inheritsLoose(t,z);var g=t.prototype;g.initialize=function(){this.own(D.init(this,["viewModel.activeMediaInfo","viewModel.activeMediaInfoIndex"],()=>this._setupMediaRefreshTimer()))};
g.destroy=function(){this._clearMediaRefreshTimer()};g.render=function(){return n.jsx("div",{bind:this,class:"esri-feature-media",onkeyup:this._handleMediaKeyup},this.renderMedia())};g.renderMedia=function(){const {formattedMediaInfoCount:a}=this.viewModel;return a?n.jsx("div",{key:"media-element-container",class:"esri-feature-media__container"},this.renderMediaPageButton("previous"),this.renderMediaInfo(),this.renderMediaPageButton("next")):null};g.renderImageMediaInfo=function(a){var {_refreshIntervalInfo:b}=
this;const {activeMediaInfoIndex:h,formattedMediaInfoCount:k}=this.viewModel,{value:e,refreshInterval:f,altText:d,title:c,type:l}=a,{sourceURL:H,linkURL:u}=e;a=G.shouldOpenInNewTab(u)?"_blank":"_self";const I="_blank"===a?"noreferrer":"";b=f?b:null;b=n.jsx("img",{alt:d||c,key:`media-${l}-${h}-${k}-${b?b.timestamp:0}`,src:b?b.sourceURL:H});return(a=u?n.jsx("a",{title:c,href:u,rel:I,target:a},b):null)?a:b};g.renderChartMediaInfo=function(a){const {activeMediaInfoIndex:b,formattedMediaInfoCount:h}=this.viewModel;
return n.jsx("div",{key:`media-${a.type}-${b}-${h}`,bind:this,class:"esri-feature-media__chart",afterCreate:this._getChartDependencies})};g.renderMediaInfoType=function(){const {activeMediaInfo:a}=this.viewModel;return a?"image"===a.type?this.renderImageMediaInfo(a):-1!==a.type.indexOf("chart")?this.renderChartMediaInfo(a):null:null};g.renderMediaInfo=function(){var {activeMediaInfo:a}=this.viewModel;const b=a.title?n.jsx("div",{key:"media-title",class:"esri-feature-media__item-title",innerHTML:a.title}):
null;a=a.caption?n.jsx("div",{key:"media-caption",class:"esri-feature-media__item-caption",innerHTML:a.caption}):null;return n.jsx("div",{key:"media-container",class:"esri-feature-media__item-container"},b,a,n.jsx("div",{key:"media-item-container",class:"esri-feature-media__item"},this.renderMediaInfoType()))};g.renderMediaPageButton=function(a){if(2>this.viewModel.formattedMediaInfoCount)return null;const b=(a="previous"===a)?this.messages.previous:this.messages.next,h=a?this.classes("esri-feature-media__button",
"esri-feature-media__previous"):this.classes("esri-feature-media__button","esri-feature-media__next"),k=a?this.classes("esri-feature-media__icon","esri-feature-media__previous-icon","esri-icon-left-triangle-arrow"):this.classes("esri-feature-media__icon","esri-feature-media__next-icon","esri-icon-right-triangle-arrow"),e=a?this.classes("esri-feature-media__icon","esri-feature-media__previous-icon--rtl","esri-icon-right-triangle-arrow"):this.classes("esri-feature-media__icon","esri-feature-media__next-icon--rtl",
"esri-icon-left-triangle-arrow");return n.jsx("button",{type:"button",key:a?"media-previous":"media-next",title:b,"aria-label":b,tabIndex:0,class:h,bind:this,onclick:a?this._previous:this._next},n.jsx("span",{"aria-hidden":"true",class:k}),n.jsx("span",{"aria-hidden":"true",class:e}))};g._next=function(){this.viewModel.next()};g._previous=function(){this.viewModel.previous()};g._getChartDependencies=async function(a){const b=await y.loadChartsModule(),{activeMediaInfo:h}=this.viewModel;this._renderChart({chartDiv:a,
mediaInfo:h,chartsModule:b})};g._handleMediaKeyup=function(a){const b=C.eventKey(a);"ArrowLeft"===b&&(a.stopPropagation(),this.viewModel.previous());"ArrowRight"===b&&(a.stopPropagation(),this.viewModel.next())};g._renderChart=function(a){const {chartsModule:b,chartDiv:h,mediaInfo:k}=a,{value:e,type:f}=k,{am4core:d}=b,c=y.getColorSet(d);r.isDarkTheme()&&d.useTheme(b.am4themes_dark);d.useTheme(b.am4themes_animated);d.useTheme(function(l){l instanceof d.ColorSet&&c&&(l.list=c)});a="pie-chart"===f?this._createPieChart(a):
this._createXYChart(a);h.setAttribute("aria-label",k.altText||k.title);a.data=e.series.map(l=>({tooltip:l.tooltip,value:l.value})).filter(l=>"pie-chart"===f?0<l.value:!0)};g._customizeChartTooltip=function(a,b){a.label.wrap=!0;a.label.maxWidth=200;a.autoTextColor=!1;a.getFillFromObject=!1;a.label.fill=b.color("#ffffff");a.background.fill=b.color({r:0,g:0,b:0,a:.7})};g._createPieChart=function(a){const {chartDiv:b,chartsModule:h}=a,{am4core:k,am4charts:e}=h;a=k.create(b,e.PieChart);a.rtl=r.isRTL();
const f=a.series.push(new e.PieSeries);f.labels.template.disabled=!0;f.ticks.template.disabled=!0;f.dataFields.value="value";f.dataFields.category="tooltip";this._customizeChartTooltip(f.tooltip,k);return a};g._getMinSeriesValue=function(a){let b=0;a.forEach(h=>b=Math.min(h.value,b));return b};g._createColumnChart=function(a,b){const {chartsModule:h,mediaInfo:k}=b;({value:b}=k);const {am4core:e,am4charts:f}=h,d=a.xAxes.push(new f.CategoryAxis);d.dataFields.category="tooltip";d.renderer.labels.template.disabled=
!0;this._customizeChartTooltip(d.tooltip,e);d.tooltip.events.on("sizechanged",()=>{d.tooltip.dy=-d.tooltip.contentHeight});var c=a.yAxes.push(new f.ValueAxis);const l=c.renderer.labels.template;c.renderer.minLabelPosition=.05;c.renderer.maxLabelPosition=.95;c.min=this._getMinSeriesValue(b.series);this._customizeChartTooltip(c.tooltip,e);l.wrap=!0;c=a.series.push(new f.ColumnSeries);c.dataFields.valueY="value";c.dataFields.categoryX="tooltip";a.cursor=new f.XYCursor;15<b.series.length&&(a.scrollbarX=
new e.Scrollbar)};g._createBarChart=function(a,b){const {chartsModule:h,mediaInfo:k}=b;({value:b}=k);const {am4core:e,am4charts:f}=h,d=a.yAxes.push(new f.CategoryAxis);d.dataFields.category="tooltip";d.renderer.inversed=!0;d.renderer.labels.template.disabled=!0;this._customizeChartTooltip(d.tooltip,e);d.tooltip.events.on("sizechanged",()=>{d.tooltip.dx=d.tooltip.contentWidth});var c=a.xAxes.push(new f.ValueAxis);const l=c.renderer.labels.template;c.renderer.minLabelPosition=.05;c.renderer.maxLabelPosition=
.95;c.min=this._getMinSeriesValue(b.series);this._customizeChartTooltip(c.tooltip,e);l.wrap=!0;c=a.series.push(new f.ColumnSeries);c.dataFields.valueX="value";c.dataFields.categoryY="tooltip";a.cursor=new f.XYCursor;15<b.series.length&&(a.scrollbarY=new e.Scrollbar)};g._createLineChart=function(a,b){const {chartsModule:h,mediaInfo:k}=b;({value:b}=k);const {am4core:e,am4charts:f}=h,d=a.xAxes.push(new f.CategoryAxis);d.dataFields.category="tooltip";d.renderer.labels.template.disabled=!0;this._customizeChartTooltip(d.tooltip,
e);d.tooltip.events.on("sizechanged",()=>{d.tooltip.dy=-d.tooltip.contentHeight});var c=a.yAxes.push(new f.ValueAxis);const l=c.renderer.labels.template;c.renderer.minLabelPosition=.05;c.renderer.maxLabelPosition=.95;c.min=this._getMinSeriesValue(b.series);this._customizeChartTooltip(c.tooltip,e);l.wrap=!0;c=a.series.push(new f.LineSeries);c.dataFields.categoryX="tooltip";c.dataFields.valueY="value";a.cursor=new f.XYCursor;15<b.series.length&&(a.scrollbarX=new e.Scrollbar)};g._createXYChart=function(a){const {chartDiv:b,
chartsModule:h,mediaInfo:k}=a,{type:e}=k,{am4core:f,am4charts:d}=h,c=f.create(b,d.XYChart);c.rtl=r.isRTL();"column-chart"===e&&this._createColumnChart(c,a);"bar-chart"===e&&this._createBarChart(c,a);"line-chart"===e&&this._createLineChart(c,a);return c};g._clearMediaRefreshTimer=function(){const {_refreshTimer:a}=this;a&&(clearTimeout(a),this._refreshTimer=null)};g._updateMediaInfoTimestamp=function(a){const b=Date.now();this._refreshIntervalInfo={timestamp:b,sourceURL:this._getImageSource(a,b)};
this.scheduleRender()};g._setupMediaRefreshTimer=function(){this._clearMediaRefreshTimer();const {activeMediaInfo:a}=this.viewModel;a&&"image"===a.type&&a.refreshInterval&&this._setRefreshTimeout(a)};g._setRefreshTimeout=function(a){const {refreshInterval:b,value:h}=a;b&&(a=6E4*b,this._updateMediaInfoTimestamp(h.sourceURL),this._refreshTimer=setInterval(()=>{this._updateMediaInfoTimestamp(h.sourceURL)},a))};g._getImageSource=function(a,b){const h=-1!==a.indexOf("?")?"\x26":"?",[k,e=""]=a.split("#");
return`${k}${h}timestamp=${b}${e?"#":""}${e}`};return t}(F);p.__decorate([q.aliasOf("viewModel.attributes")],m.prototype,"attributes",void 0);p.__decorate([q.aliasOf("viewModel.activeMediaInfoIndex")],m.prototype,"activeMediaInfoIndex",void 0);p.__decorate([q.aliasOf("viewModel.fieldInfoMap")],m.prototype,"fieldInfoMap",void 0);p.__decorate([q.aliasOf("viewModel.layer")],m.prototype,"layer",void 0);p.__decorate([q.aliasOf("viewModel.mediaInfos")],m.prototype,"mediaInfos",void 0);p.__decorate([q.aliasOf("viewModel.popupTemplate")],
m.prototype,"popupTemplate",void 0);p.__decorate([q.aliasOf("viewModel.relatedInfos")],m.prototype,"relatedInfos",void 0);p.__decorate([v.property({type:x}),w.renderable(["viewModel.formattedMediaInfos","viewModel.activeMediaInfoIndex","viewModel.activeMediaInfo"])],m.prototype,"viewModel",void 0);p.__decorate([v.property(),w.renderable(),E.messageBundle("esri/widgets/Feature/t9n/Feature")],m.prototype,"messages",void 0);return m=p.__decorate([B.subclass("esri.widgets.Feature.FeatureMedia")],m)});