// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.18/esri/copyright.txt for details.
//>>built
define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/has ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/property ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../core/urlUtils ../../../core/uuid ../../../portal/support/resourceExtension ../../../core/Accessor ../../../popup/FieldInfo ../../../popup/content/support/ChartMediaInfoValueSeries ../support/featureUtils ../support/relatedFeatureUtils".split(" "),
function(A,p,m,G,H,q,I,C,J,K,L,D,E,F,g,x){m=function(B){function y(a){a=B.call(this,a)||this;a.activeMediaInfoIndex=0;a.attributes=null;a.fieldInfoMap=null;a.formattedAttributes=null;a.layer=null;a.mediaInfos=null;a.popupTemplate=null;a.relatedInfos=null;return a}A._inheritsLoose(y,B);var r=y.prototype;r.setActiveMedia=function(a){this._setContentElementMedia(a)};r.next=function(){this._pageContentElementMedia(1)};r.previous=function(){this._pageContentElementMedia(-1)};r._setContentElementMedia=
function(a){const {formattedMediaInfoCount:c}=this;this.activeMediaInfoIndex=(a+c)%c};r._pageContentElementMedia=function(a){const {activeMediaInfoIndex:c}=this;this._setContentElementMedia(c+a)};r._formatMediaInfos=function(){const {attributes:a,mediaInfos:c,formattedAttributes:d,fieldInfoMap:k,layer:f}=this,l={...d,...a};return null==c?void 0:c.map(b=>{if(!b)return null;var e=b.title?g.processFieldsInLinks(b.title,l,f):"";b.title=e?g.substituteAttributes({formattedAttributes:d,template:e,fieldInfoMap:k}):
"";e=b.caption?g.processFieldsInLinks(b.caption,l,f):"";b.caption=e?g.substituteAttributes({formattedAttributes:d,template:e,fieldInfoMap:k}):"";e=b.altText?g.processFieldsInLinks(b.altText,l,f):"";b.altText=e?g.substituteAttributes({formattedAttributes:d,template:e,fieldInfoMap:k}):"";return"image"===b.type?({value:e}=b,this._setImageValue({value:e,formattedAttributes:d,layer:f}),b.value.sourceURL?b:void 0):"pie-chart"===b.type||"line-chart"===b.type||"column-chart"===b.type||"bar-chart"===b.type?
({value:e}=b,this._setChartValue({value:e,chartType:b.type,attributes:a,formattedAttributes:d,layer:f}),b):null}).filter(Boolean)};r._setImageValue=function(a){const {fieldInfoMap:c}=this,{value:d,formattedAttributes:k,layer:f}=a,{linkURL:l,sourceURL:b}=d;b&&(a=g.fixTokens(b,f),d.sourceURL=g.substituteAttributes({formattedAttributes:k,template:a,fieldInfoMap:c}));l&&(a=g.fixTokens(l,f),d.linkURL=g.substituteAttributes({formattedAttributes:k,template:a,fieldInfoMap:c}))};r._setChartValue=function(a){const {value:c,
attributes:d,formattedAttributes:k,chartType:f,layer:l}=a,{popupTemplate:b,relatedInfos:e}=this,{fields:n,normalizeField:v}=c;c.fields=g.getFixedFieldNames(n,l);v&&(c.normalizeField=g.getFixedFieldName(v,l));if(n.some(h=>!!(null!=k[h]||g.isRelatedField(h)&&e.size))){var u=null==b?void 0:b.fieldInfos;n.forEach(h=>{g.isRelatedField(h)?c.series=[...c.series,...this._getRelatedChartInfos({fieldInfos:u,fieldName:h,formattedAttributes:k,chartType:f,value:c})]:(h=this._getChartOption({value:c,attributes:d,
chartType:f,formattedAttributes:k,fieldName:h,fieldInfos:u}),c.series.push(h))})}};r._getRelatedChartInfos=function(a){var c;const {fieldInfos:d,fieldName:k,formattedAttributes:f,chartType:l,value:b}=a,e=[];a=x.getRelatedFieldInfo(k);const {layerId:n,fieldName:v}=a;a=null==(c=this.relatedInfos)?void 0:c.get(n.toString());if(!a)return e;const {relatedFeatures:u,relation:h}=a;if(!h||!u)return e;({cardinality:c}=h);u.forEach(z=>{const {attributes:t}=z;t&&Object.keys(t).forEach(w=>{w===v&&e.push(this._getChartOption({value:b,
attributes:t,formattedAttributes:f,fieldName:k,chartType:l,relatedFieldName:w,fieldInfos:d}))})});return"one-to-many"===c||"many-to-many"===c?e:[e[0]]};r._getTooltip=function({label:a,value:c,chartType:d}){return"pie-chart"===d?a:`${a}: ${c}`};r._getChartOption=function(a){const {value:c,attributes:d,formattedAttributes:k,fieldName:f,relatedFieldName:l,fieldInfos:b,chartType:e}=a;var {layer:n}=this;const {normalizeField:v,tooltipField:u}=c;var h=v?g.isRelatedField(v)?d[x.getRelatedFieldInfo(v).fieldName]:
d[v]:null;a=l&&void 0!==d[l]?d[l]:void 0!==d[f]?d[f]:k[f];const z=void 0===a?null:a&&h?a/h:a;a=new F({value:z});if(g.isRelatedField(f)){var t=x.getRelatedFieldInfo(f);var w=x.getRelatedFieldInfo(u);w=w?w.fieldName:null;n=g.formatValueToFieldInfo(z,{fieldInfos:b,fieldName:l,layer:n,preventPlacesFormatting:!!h});t=t?t.label||t.fieldName:l;a.tooltip=this._getTooltip({label:w&&void 0!==d[w]?d[w]:t,value:n,chartType:e});return a}h=g.getFieldInfo(b,f);n=g.getFixedFieldName(f,n);h=u&&void 0!==k[u]?k[u]:
g.getFieldInfoLabel(h||new E({fieldName:n}),null==(t=this.popupTemplate)?void 0:t.expressionInfos);a.tooltip=this._getTooltip({label:h,value:k[n],chartType:e});return a};A._createClass(y,[{key:"activeMediaInfo",get:function(){return this.formattedMediaInfos[this.activeMediaInfoIndex]||null}},{key:"formattedMediaInfos",get:function(){return this._formatMediaInfos()||[]}},{key:"formattedMediaInfoCount",get:function(){return this.formattedMediaInfos.length}}]);return y}(D);p.__decorate([q.property()],
m.prototype,"activeMediaInfoIndex",void 0);p.__decorate([q.property({readOnly:!0,dependsOn:["formattedMediaInfos","activeMediaInfoIndex"]})],m.prototype,"activeMediaInfo",null);p.__decorate([q.property()],m.prototype,"attributes",void 0);p.__decorate([q.property()],m.prototype,"fieldInfoMap",void 0);p.__decorate([q.property()],m.prototype,"formattedAttributes",void 0);p.__decorate([q.property({readOnly:!0,dependsOn:"attributes fieldInfoMap formattedAttributes mediaInfos popupTemplate layer relatedInfos".split(" ")})],
m.prototype,"formattedMediaInfos",null);p.__decorate([q.property()],m.prototype,"layer",void 0);p.__decorate([q.property({readOnly:!0,dependsOn:["formattedMediaInfos"]})],m.prototype,"formattedMediaInfoCount",null);p.__decorate([q.property()],m.prototype,"mediaInfos",void 0);p.__decorate([q.property()],m.prototype,"popupTemplate",void 0);p.__decorate([q.property()],m.prototype,"relatedInfos",void 0);return m=p.__decorate([C.subclass("esri.widgets.Feature.FeatureMedia.FeatureMediaViewModel")],m)});