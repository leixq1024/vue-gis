// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.18/esri/copyright.txt for details.
//>>built
define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/has ../../../core/maybe ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/decorators/aliasOf ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../core/urlUtils ../../../core/uuid ../../../portal/support/resourceExtension ../../../core/events ../../../core/mathUtils ../../../core/Handles ../../../core/watchUtils ../../support/widgetUtils ../../support/decorators/renderable ../../../chunks/index ../../Widget ../BuildingLevel ../../../chunks/constants ./Label ./LevelItem".split(" "),
function(v,e,d,p,I,J,g,w,K,C,L,M,N,t,x,y,q,D,l,r,E,z,h,F,G){const H={selectLevel:"selectLevel",clearLevel:"clearLevel",nextLevel:"nextLevel",previousLevel:"previousLevel",currentLevel:"{{value}}"};d=function(A){function u(b,c){var a=A.call(this,b,c)||this;a._defaultViewModel=new z;a.viewModel=a._defaultViewModel;a.messages=H;a._levelHandles=new y;a._levelEventHandles=new y;a._levelWidgets=[];a._labelWidget=new F.Label({onClear:()=>a.viewModel.clear()});a._hoveredLevel=null;a._expandedLevelsHeight=
void 0;a._normalizedPointerPosition=0;a._hovering=!1;a._containerPosTop=null;a._levelsContainer=null;a._onPointerUp=()=>{window.getSelection().removeAllRanges();p.isSome(a._hoveredLevel)&&(a.viewModel.enabled&&a._hoveredLevel===a.viewModel.value?a.viewModel.clear():a.viewModel.select(a._hoveredLevel))};a._onPointerEnter=()=>{var k;!a._hovering&&p.isSome(a._levelsContainer)&&(a._hovering=!0,a._containerPosTop=null!=(k=a._levelsContainer.getBoundingClientRect().top)?k:0)};a._onPointerLeave=()=>{a._hovering&&
(a._normalizedPointerPosition=0,a._hoveredLevel=null,a._hovering=!1)};a._onPointerMove=k=>{if(!a._hovering)return!1;window.getSelection().removeAllRanges();if(p.isSome(a._containerPosTop)){let m=a._levelsHeight,n=a._containerPosTop+h.LEVELS_PADDING*h.LEVELS_MARGIN_FACTOR+a._expandedLevelsMargin;const B=a._levelHeight/2;n+=B;m-=B;k=(k.clientY-n)/m;k+=h.LEVELS_POINTER_ADJUSTMENT;a._normalizedPointerPosition=k}return!1};return a}v._inheritsLoose(u,A);var f=u.prototype;f.postInitialize=function(){this.own(q.init(this,
"_levelsContainer",()=>this._onContainerChange()),q.init(this,"_levels",()=>this._createLevelWidgets()),q.init(this,"messages",()=>this._labelWidget.messages=this.messages))};f.destroy=function(){this._levelHandles.destroy();this._levelEventHandles.destroy();this._levelWidgets.forEach(b=>b.destroy());this._labelWidget.destroy();this.viewModel!==this._defaultViewModel&&this._defaultViewModel.destroy()};f.render=function(){const b=this._levelWidgets.length,c=1<b?this._levelWidgets.map(n=>n.render()):
null;var a=h.LEVELS_PADDING*h.LEVELS_MARGIN_FACTOR;const k=-a/h.LEVELS_MARGIN_FACTOR,m=this._levelsHeight;a=m+2*a;return r.jsx("div",{bind:this,key:this,class:this.classes("esri-widget","esri-building-level-picker",{["esri-building-level-picker--animate-level"]:!this._hovering,["esri-building-level-picker--no-level"]:2>b}),onkeydown:this._onKeyDown},this._renderLabelContainer(),r.jsx("div",{bind:this,class:"esri-building-level-picker__levels-container",styles:{height:`${a}px`,marginTop:`${k}px`,marginBottom:`${k}px`},
onfocus:this._onFocus,afterCreate:D.storeNode,"data-node-ref":"_levelsContainer"},r.jsx("div",{styles:{height:`${m}px`,margin:`${h.LEVELS_PADDING-this._expandedLevelsMargin}px 0 0 0`},class:"esri-building-level-picker__inner-levels-container"},c)))};f._renderLabelContainer=function(){const b=this.messages.previousLevel,c=this.messages.nextLevel;return r.jsx("div",{class:"esri-building-level-picker__label-container",tabIndex:0},r.jsx("button",{bind:this,class:"esri-building-level-picker__arrow-up",
disabled:!this.viewModel.hasNext,onclick:this._onArrowUpClick,"aria-label":c,title:c,type:"button"}),this._labelWidget.render(),r.jsx("button",{bind:this,class:"esri-building-level-picker__arrow-down",disabled:!this.viewModel.hasPrevious,onclick:this._onArrowDownClick,"aria-label":b,title:b,type:"button"}))};f._updateComponents=function(){const b=this.viewModel.enabled?this.viewModel.value:null,c=p.isSome(this._hoveredLevel)?this._hoveredLevel:b;this._levelWidgets.forEach(a=>{var k,m;const n=this.viewModel.getValueLabel(a.level);
a.label=p.isSome(n)?n:null==(k=this.messages)?void 0:null==(m=k.currentLevel)?void 0:m.replace("{{level}}",String(a.level));a.active=a.level===b;a.hovering=a.level===this._hoveredLevel});this._labelWidget.level=c;this._labelWidget.active=c===b;this._labelWidget.hovering=p.isSome(this._hoveredLevel)};f._onWidthChange=function(){this._levelWidgets.forEach(b=>{b.width=this._levelWidth})};f._createLevelWidgets=function(){this._levelWidgets.forEach(b=>b.destroy());this._levelWidgets=this._levels.map(b=>
new G.LevelItem({level:b,onSelect:()=>this._onLevelToggle(b)}));this._levelHandles.removeAll();this._levelHandles.add([q.init(this,["messages","viewModel.value","viewModel.enabled","_hoveredLevel","_hovering"],()=>this._updateComponents()),q.init(this,["_normalizedPointerPosition","_hovering"],()=>this._onPointerPositionChange()),q.init(this,"_width",()=>this._onWidthChange())])};f._onContainerChange=function(){const b=this._levelsContainer;p.isSome(b)&&(this._levelEventHandles.removeAll(),this._levelEventHandles.add([t.on(b,
"pointerenter",this._onPointerEnter),t.on(b,"pointerover",this._onPointerEnter),t.on(b,"pointerleave",this._onPointerLeave),t.on(b,"pointerup",this._onPointerUp),t.on(b,"pointermove",this._onPointerMove)]))};f._onKeyDown=function(b){switch(b.key){case "ArrowDown":case "ArrowLeft":b.preventDefault();b.stopPropagation();this.viewModel.previous();this._focusCurrentLevel();break;case "ArrowUp":case "ArrowRight":b.preventDefault(),b.stopPropagation(),this.viewModel.next(),this._focusCurrentLevel()}};f._focusCurrentLevel=
function(){const b=this._levelWidgets.find(c=>c.level===this.viewModel.value);b&&b.focus()};f._onFocus=function(){this._hoveredLevel=0<this._levels.length?this._levels[0]:null};f._onLevelToggle=function(b){this.viewModel.enabled&&this.viewModel.value===b?this.viewModel.clear():this.viewModel.select(b)};f._onArrowUpClick=function(){this.viewModel.next()};f._onArrowDownClick=function(){this.viewModel.previous()};f._onPointerPositionChange=function(){let b=0;this._levelWidgets.forEach((a,k)=>{const {width:m,
height:n}=this._getLevelWidgetSize(k);a.height=n;a.width=m;b+=n});this._hoveredLevel=this._levelClosestToPointer;const c=this._expandedLevelsHeight;if(null==c||30<Math.abs(c-b))this._expandedLevelsHeight=b};f._getLevelWidgetSize=function(b){const c={width:this._levelWidth,height:this._levelHeight};this._hovering&&(b=this._getGaussianFactor(b,this._normalizedPointerPosition),c.width+=h.LEVEL_HOVERED_EXTRA_WIDTH*b,c.height+=h.LEVEL_HOVERED_EXTRA_HEIGHT*b);return c};f._getGaussianFactor=function(b,c){const a=
this._numLevels-1;return Math.exp(-((this._gaussianFactor*((a-b)/a-c))**2))};v._createClass(u,[{key:"_levelsHeight",get:function(){return Math.round(this._levelHeight*this._numLevels)}},{key:"_expandedLevelsMargin",get:function(){return Math.round((this._expandedLevelsHeight-this._levelsHeight)/2)}},{key:"_levelWidth",get:function(){const {LEVEL_WIDTH_NOMINATOR:b,LEVEL_WIDTH_CONSTANT:c}=h.constants;return Math.round(x.clamp(b/Math.sqrt(this._numLevels)+c,h.LEVEL_WIDTH_MIN,h.LEVEL_WIDTH_MAX))}},{key:"_levelHeight",
get:function(){const b=h.LEVEL_HEIGHT_DEFAULT;return Math.round(x.clamp(2*b/Math.sqrt(this._numLevels),2,b))}},{key:"_gaussianFactor",get:function(){const b=this._numLevels;return b/Math.log(h.ALPHA_LEVEL_DEPENDENCY_FACTOR*b)*h.ALPHA_SPREAD_FACTOR}},{key:"_levelClosestToPointer",get:function(){if(!this._hovering)return null;const b=this._numLevels-1,c=this._normalizedPointerPosition;return 0<=b&&p.isSome(c)?this._levels[Math.round((1-c)*b)]:null}}]);return u}(E);e.__decorate([g.property({type:z}),
l.renderable(["viewModel.hasNext","viewModel.hasPrevious"])],d.prototype,"viewModel",void 0);e.__decorate([g.property()],d.prototype,"messages",void 0);e.__decorate([g.property(),l.renderable()],d.prototype,"_levelWidgets",void 0);e.__decorate([g.property(),l.renderable()],d.prototype,"_labelWidget",void 0);e.__decorate([g.property(),l.renderable()],d.prototype,"_hoveredLevel",void 0);e.__decorate([w.aliasOf("viewModel.allowedValues"),l.renderable()],d.prototype,"_levels",void 0);e.__decorate([w.aliasOf("_levels.length"),
l.renderable()],d.prototype,"_numLevels",void 0);e.__decorate([g.property({readOnly:!0,dependsOn:["_numLevels","_levelHeight"]}),l.renderable()],d.prototype,"_levelsHeight",null);e.__decorate([g.property(),l.renderable()],d.prototype,"_expandedLevelsHeight",void 0);e.__decorate([g.property({readOnly:!0,dependsOn:["_expandedLevelsHeight","_levelsHeight"]}),l.renderable()],d.prototype,"_expandedLevelsMargin",null);e.__decorate([g.property({readOnly:!0,dependsOn:["_numLevels"]})],d.prototype,"_levelWidth",
null);e.__decorate([g.property({readOnly:!0,dependsOn:["_numLevels"]})],d.prototype,"_levelHeight",null);e.__decorate([g.property({readOnly:!0,dependsOn:["_numLevels"]})],d.prototype,"_gaussianFactor",null);e.__decorate([g.property({readOnly:!0,dependsOn:["_levels","_numLevels","_hovering","_normalizedPointerPosition"]})],d.prototype,"_levelClosestToPointer",null);e.__decorate([g.property({type:Number,range:{min:0,max:1}}),l.renderable()],d.prototype,"_normalizedPointerPosition",void 0);e.__decorate([g.property()],
d.prototype,"_hovering",void 0);e.__decorate([g.property()],d.prototype,"_containerPosTop",void 0);e.__decorate([g.property()],d.prototype,"_levelsContainer",void 0);return d=e.__decorate([C.subclass("esri.widgets.BuildingExplorer.BuildingLevelPicker.BuildingLevelPicker")],d)});