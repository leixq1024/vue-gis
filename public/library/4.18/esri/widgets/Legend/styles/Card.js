// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.18/esri/copyright.txt for details.
//>>built
define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/has ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/property ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../core/urlUtils ../../../core/uuid ../../../portal/support/resourceExtension ../../../core/screenUtils ../../../intl/substitute ../../../intl ../../../core/Handles ../../support/widgetUtils ../../support/decorators/accessibleHandler ../../support/decorators/messageBundle ../../support/decorators/renderable ../../../chunks/index ../../Widget ../../../symbols/support/svgUtils ./support/utils ../support/styleUtils".split(" "),
function(G,t,q,N,O,w,P,H,Q,R,S,B,I,T,J,U,K,C,z,e,L,M,u,p){const x=window.devicePixelRatio;q=function(D){function A(a,d){a=D.call(this,a,d)||this;a._handles=new J;a._hasIndicators=!1;a._selectedSectionName=null;a._sectionNames=[];a._sectionMap=new Map;a.activeLayerInfos=null;a.layout="stack";a.messages=null;a.messagesCommon=null;a.type="card";a.view=null;return a}G._inheritsLoose(A,D);var n=A.prototype;n.initialize=function(){this.own([this.watch("activeLayerInfos",a=>{this._handles.removeAll();this._watchForSectionChanges(a)})])};
n.destroy=function(){this._handles.destroy();this._handles=null};n.render=function(){this._hasIndicators="auto"===this.layout&&768>=this.view.container.clientWidth||"stack"===this.layout;var a=this.activeLayerInfos;a=a&&a.toArray().map(c=>this._renderLegendForLayer(c)).filter(c=>!!c);this._hasIndicators?this._selectedSectionName&&-1!==this._sectionNames.indexOf(this._selectedSectionName)||(this._selectedSectionName=this._sectionNames&&this._sectionNames[0]):this._selectedSectionName=null;const d=
this._sectionNames.length;var b=this._sectionNames.map((c,h)=>{h=I.substitute(this.messagesCommon.pagination.pageText,{index:h+1,total:d});return e.jsx("div",{key:c,"aria-label":h,title:h,tabIndex:0,onclick:this._selectSection,onkeydown:this._selectSection,bind:this,class:this.classes("esri-legend--card__carousel-indicator",{["esri-legend--card__carousel-indicator--activated"]:this._selectedSectionName===c}),"data-section-name":c})});b=this._hasIndicators&&1<d?e.jsx("div",{class:"esri-legend--card__carousel-indicator-container",
key:"carousel-navigation"},b):null;a=this._hasIndicators?this._sectionMap.get(this._selectedSectionName):a&&a.length?a:null;return e.jsx("div",{class:this.classes("esri-legend--card",{["esri-legend--stacked"]:this._hasIndicators})},b,a?a:e.jsx("div",{class:"esri-legend--card__message"},this.messages.noLegend))};n._selectSection=function(a){if(a=a.target.getAttribute("data-section-name"))this._selectedSectionName=a};n._watchForSectionChanges=function(a){this._generateSectionNames();a&&(a.forEach(d=>
{const b=`activeLayerInfo-${d.layer.uid}-version-change`;this._handles.remove(b);this._watchForSectionChanges(d.children);this._handles.add(d.watch("version",()=>this._generateSectionNames()),b)}),this._handles.remove("activeLayerInfos-collection-change"),this._handles.add(a.on("change",()=>this._watchForSectionChanges(a)),"activeLayerInfos-collection-change"))};n._generateSectionNames=function(){this._sectionNames.length=0;this.activeLayerInfos&&this.activeLayerInfos.forEach(this._generateSectionNamesForActiveLayerInfo,
this)};n._generateSectionNamesForActiveLayerInfo=function(a){a.children.forEach(this._generateSectionNamesForActiveLayerInfo,this);a.legendElements&&a.legendElements.forEach((d,b)=>{this._sectionNames.push(`${"esri-legend--card__"}${a.layer.uid}-type-${d.type}-${b}`)})};n._renderLegendForLayer=function(a){if(!a.ready)return null;if(a.children.length){var d=a.children.map(b=>this._renderLegendForLayer(b)).toArray();return e.jsx("div",{key:a.layer.uid,class:this.classes("esri-legend--card__service",
"esri-legend--card__group-layer")},e.jsx("div",{class:"esri-legend--card__service-caption-container"},a.title),d)}{if((d=a.legendElements)&&!d.length)return null;const b=d.some(c=>"relationship-ramp"===c.type);d=d.map((c,h)=>this._renderLegendForElement(c,a,h,b)).filter(c=>!!c);return d.length?e.jsx("div",{key:a.layer.uid,class:this.classes("esri-legend--card__service",{["esri-legend--card__group-layer-child"]:!!a.parent})},e.jsx("div",{class:"esri-legend--card__service-caption-container"},e.jsx("div",
{class:"esri-legend--card__service-caption-text"},a.title)),e.jsx("div",{class:"esri-legend--card__service-content"},d)):null}};n._renderLegendForElement=function(a,d,b,c=!1){const h="color-ramp"===a.type,l="opacity-ramp"===a.type;var f="size-ramp"===a.type;const g=d.layer;var k=a.title,m=null;"string"===typeof k?m=k:k&&(m=p.getTitle(this.messages,k,h||l),m=k.title?`${k.title} (${m})`:m);b=`${"esri-legend--card__"}${g.uid}-type-${a.type}-${b}`;k=this._hasIndicators?e.jsx("div",null,e.jsx("h3",{class:this.classes("esri-widget__heading",
"esri-legend--card__carousel-title")},d.title),e.jsx("h4",{class:this.classes("esri-widget__heading","esri-legend--card__layer-caption")},m)):m?e.jsx("h4",{class:this.classes("esri-widget__heading","esri-legend--card__layer-caption")},m):null;m=null;"symbol-table"===a.type?(f=a.infos.map((r,v)=>this._renderLegendForElementInfo(r,d,a.legendType,v)).filter(r=>!!r),f.length&&(m=e.jsx("div",{key:b,class:"esri-legend--card__section"},k,e.jsx("div",{class:this.classes({["esri-legend--card__label-container"]:!(f[0].properties.classes&&
f[0].properties.classes["esri-legend--card__symbol-row"])&&!c,["esri-legend--card__relationship-label-container"]:c})},f)))):"color-ramp"===a.type||"opacity-ramp"===a.type||"heatmap-ramp"===a.type?m=e.jsx("div",{key:b,class:"esri-legend--card__section"},k,this._renderLegendForRamp(a,g.opacity)):f?m=e.jsx("div",{key:b,class:"esri-legend--card__section"},k,this._renderSizeRamp(a,g.opacity)):"relationship-ramp"===a.type?m=e.jsx("div",{key:b,class:this.classes("esri-legend--card__section","esri-legend--card__relationship-section")},
k,u.renderRelationshipRamp(a,this.id,g.opacity)):"univariate-above-and-below-ramp"===a.type&&(m=e.jsx("div",{key:b,class:"esri-legend--card__section"},k,this._renderUnivariateAboveAndBelowRamp(a,g.opacity)));if(!m)return null;this._sectionMap.set(b,m);return m};n._renderUnivariateAboveAndBelowRamp=function(a,d){const {sizeRampElement:b,colorRampElement:c}=u.getUnivariateAboveAndBelowRampElements(a,d,"horizontal");a=u.getUnivariateAboveAndBelowSizeRampSize(b,"full","horizontal");var h=u.getUnivariateAboveAndBelowColorRampSize(b,
"above","horizontal"),l=u.getUnivariateAboveAndBelowColorRampSize(b,"below","horizontal");h=u.getUnivariateAboveAndBelowColorRampPreview(c,{width:h,height:12,rampAlignment:"horizontal",opacity:d,type:"above"});d=u.getUnivariateAboveAndBelowColorRampPreview(c,{width:l,height:12,rampAlignment:"horizontal",opacity:d,type:"below"});var f=u.getUnivariateAboveAndBelowColorRampMargin(b,"card");l=b.infos.map(g=>g.label).map((g,k)=>0===k||4===k?e.jsx("div",{key:k},g):null);f={marginTop:"3px",marginLeft:`${f}px`,
display:"flex"};a={width:`${a}px`,display:"flex",flexDirection:"row",justifyContent:"space-between"};return e.jsx("div",{class:"esri-legend--card__layer-row",key:"size-ramp-preview",styles:{display:"flex",flexDirection:"column"}},e.jsx("div",{class:this.classes("esri-legend--card__symbol-container","esri-legend__size-ramp--horizontal"),styles:{display:"flex",flexDirection:"row"}},b.infos.map((g,k)=>e.jsx("div",{key:k,class:"esri-legend--card__symbol",bind:g.preview,afterCreate:p.attachToNode}))),
h?e.jsx("div",{class:"esri-univariate-above-and-below-ramp__color--card",styles:f,key:"color-ramp-preview"},e.jsx("div",{bind:h,afterCreate:p.attachToNode}),e.jsx("div",{bind:d,afterCreate:p.attachToNode})):null,e.jsx("div",{class:"esri-legend__layer-cell esri-legend__layer-cell--info"},e.jsx("div",{class:"esri-legend__ramp-labels",styles:a},l)))};n._renderLegendForElementInfo=function(a,d,b,c){var h=d.layer;if(a.type)return this._renderLegendForElement(a,d,c);d=p.isImageryStretchedLegend(h,b);if(a.preview){var l;
if(-1===a.symbol.type.indexOf("simple-fill")){if(!a.label)return e.jsx("div",{key:c,bind:a.preview,afterCreate:p.attachToNode});var f={["esri-legend--card__symbol-cell"]:this._hasIndicators};return e.jsx("div",{key:c,class:this.classes("esri-legend--card__layer-row",{["esri-legend--card__symbol-row"]:this._hasIndicators})},e.jsx("div",{class:this.classes(f),bind:a.preview,afterCreate:p.attachToNode}),e.jsx("div",{class:this.classes("esri-legend--card__image-label",{["esri-legend--card__label-cell"]:this._hasIndicators})},
p.getTitle(this.messages,a.label,!1)||""))}let g=b=d=255,k=0,m=255,r=255,v=255,y=0;const E=a.symbol.color&&a.symbol.color.a,F=a.symbol.outline&&a.symbol.outline.color&&a.symbol.outline.color.a;E&&(d=a.symbol.color.r,b=a.symbol.color.g,g=a.symbol.color.b,k=a.symbol.color.a*h.opacity);F&&(m=a.symbol.outline.color.r,r=a.symbol.outline.color.g,v=a.symbol.outline.color.b,y=a.symbol.outline.color.a*h.opacity);f=(h=null!=(f=null==(l=a.symbol.color)?void 0:l.isBright)?f:!0)?"rgba(255, 255, 255, .6)":"rgba(0, 0, 0, .6)";
return e.jsx("div",{key:c,class:"esri-legend--card__layer-row"},e.jsx("div",{class:"esri-legend--card__label-element",styles:{background:E?`rgba(${d}, ${b}, ${g}, ${k})`:"none",color:h?"black":"white",textShadow:`-1px -1px 0 ${f},
                                              1px -1px 0 ${f},
                                              -1px 1px 0 ${f},
                                              1px 1px 0 ${f}`,border:F?`1px solid rgba(${m}, ${r}, ${v}, ${y})`:"none"}}," ",a.label," "))}if(a.src)return f=this._renderImage(a,h,d),e.jsx("div",{key:c,class:"esri-legend--card__layer-row"},f,e.jsx("div",{class:"esri-legend--card__image-label"},a.label||""))};n._renderImage=function(a,d,b){const {label:c,src:h,opacity:l}=a;b={["esri-legend--card__imagery-layer-image--stretched"]:b,["esri-legend--card__symbol"]:!b};d={opacity:`${null!=l?l:d.opacity}`};
return e.jsx("img",{alt:p.getTitle(this.messages,c,!1),src:h,border:0,width:a.width,height:a.height,class:this.classes(b),styles:d})};n._renderSizeRampLines=function(a){a=a.infos;var d=a[0],b=a[a.length-1],c=d.symbol;a=this._hasIndicators;d=B.pt2px(d.size+d.outlineSize)*x;b=B.pt2px(b.size+b.outlineSize)*x;const h=a?d:d+50*x,l=a?d/2+50*x:d;var f;c?-1<c.type.indexOf("3d")?(f=c.symbolLayers&&c.symbolLayers.length)?(f=c.symbolLayers.getItemAt(f-1).get("resource.primitive"),f="triangle"===f||"cone"===
f||"tetrahedron"===f):f=void 0:f="triangle"===c.style:f=void 0;if(c)if(-1<c.type.indexOf("3d")){var g=c.symbolLayers&&c.symbolLayers.length;g?(c=c.symbolLayers.getItemAt(g-1),c=c.resource&&c.resource.primitive,c="circle"===c||"cross"===c||"kite"===c||"sphere"===c||"cube"===c||"diamond"===c):c=void 0}else c=c.style,c="circle"===c||"diamond"===c||"cross"===c;else c=void 0;g=document.createElement("canvas");g.width=h;g.height=l;g.style.width=`${g.width/x}px`;g.style.height=`${g.height/x}px`;const k=
g.getContext("2d");if(a){k.beginPath();var m=h/2-b/2;k.moveTo(0,0);k.lineTo(m,l);m=h/2+b/2;k.moveTo(h,0);k.lineTo(m,l)}else k.beginPath(),k.moveTo(0,l/2-b/2),k.lineTo(h,0),k.moveTo(0,l/2+b/2),k.lineTo(h,l);k.strokeStyle="#ddd";k.stroke();return e.jsx("div",{bind:g,afterCreate:p.attachToNode,styles:a?{display:"flex",marginTop:`-${f?0:c?d/2:0}px`,marginBottom:`-${f?b:c?b/2:0}px`}:{display:"flex",marginRight:`-${f?0:c?d/2:0}px`,marginLeft:`-${f?0:c?b/2:0}px`}})};n._renderSizeRamp=function(a,d){var b=
a.infos;const c=b[0].label,h=b[b.length-1].label;let l=b[0].preview;b=b[b.length-1].preview;const f=this._hasIndicators,g={"flex-direction":f?"column":"row-reverse"};l&&(l=l.cloneNode(!0),l.style.display="flex");b&&(b=b.cloneNode(!0),b.style.display="flex");d={opacity:null!=d?`${d}`:""};return e.jsx("div",{class:this.classes("esri-legend--card__layer-row",{["esri-legend--card__size-ramp-row"]:f})},e.jsx("div",{class:"esri-legend--card__ramp-label"},f?c:h),e.jsx("div",{class:"esri-legend--card__size-ramp-container",
styles:g},e.jsx("div",{bind:l,afterCreate:p.attachToNode,class:"esri-legend--card__size-ramp-preview",styles:d}),this._renderSizeRampLines(a),e.jsx("div",{bind:b,afterCreate:p.attachToNode,class:"esri-legend--card__size-ramp-container",styles:d})),e.jsx("div",{class:"esri-legend--card__ramp-label"},f?h:c))};n._renderLegendForRamp=function(a,d){var b=a.infos;const c="heatmap-ramp"===a.type,h=b.length-1;var l=2<h&&!c?25*h:100;const f=l+20,g=b.slice(0).reverse();g.forEach((v,y)=>{v.offset=c?v.ratio:
y/h});const k=g.length-1;a=(a=0!==g.length%2&&g[g.length/2|0])&&e.jsx("div",{class:"esri-legend--card__interval-separators-container"},e.jsx("div",{class:"esri-legend--card__interval-separator"},"|"),e.jsx("div",{class:"esri-legend--card__ramp-label"},a.label));const m=b[b.length-1].label;b=b[0].label;let r=null;null!=d&&(r=`opacity: ${d}`);d=M.renderSVG([[{shape:{type:"path",path:"M0 12.5 L10 0 L10 25 Z"},fill:g[0].color,stroke:{width:0}},{shape:{type:"rect",x:10,y:0,width:l,height:25},fill:{type:"linear",
x1:10,y1:0,x2:l+10,y2:0,colors:g},stroke:{width:0}},{shape:{type:"path",path:`M${l+10} 0 L${f} ${12.5} L${l+10} ${25} Z`},fill:g[k].color,stroke:{width:0}}]],f,25);({messages:l}=this);return e.jsx("div",{class:"esri-legend--card__layer-row"},e.jsx("div",{class:"esri-legend--card__ramp-label"},c?l[m]:m),e.jsx("div",{class:"esri-legend--card__symbol-container"},e.jsx("div",{style:r},d),a),e.jsx("div",{class:"esri-legend--card__ramp-label"},c?l[b]:b))};return A}(L);t.__decorate([z.renderable(),w.property()],
q.prototype,"activeLayerInfos",void 0);t.__decorate([w.property()],q.prototype,"layout",void 0);t.__decorate([w.property(),z.renderable(),C.messageBundle("esri/widgets/Legend/t9n/Legend")],q.prototype,"messages",void 0);t.__decorate([w.property(),z.renderable(),C.messageBundle("esri/t9n/common")],q.prototype,"messagesCommon",void 0);t.__decorate([w.property({readOnly:!0})],q.prototype,"type",void 0);t.__decorate([w.property()],q.prototype,"view",void 0);t.__decorate([K.accessibleHandler()],q.prototype,
"_selectSection",null);return q=t.__decorate([H.subclass("esri.widgets.Legend.styles.Card")],q)});