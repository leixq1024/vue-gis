// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.18/esri/copyright.txt for details.
//>>built
define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/global ../core/has ../core/Logger ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/property ../core/accessorSupport/decorators/aliasOf ../core/jsonMap ../core/accessorSupport/decorators/subclass ../core/urlUtils ../core/uuid ../portal/support/resourceExtension ../core/events ./support/widgetUtils ./support/decorators/accessibleHandler ./support/decorators/messageBundle ./support/decorators/renderable ../chunks/index ./Widget ./CoordinateConversion/support/Conversion ./CoordinateConversion/CoordinateConversionViewModel".split(" "),
function(w,l,x,k,E,J,t,p,K,F,L,M,N,G,y,r,z,n,c,H,A,B){const C=E.getLogger("esri.widgets.CoordinateConversion");k=function(D){function u(a,b){a=D.call(this,a,b)||this;a._popupMessage=null;a._popupId=null;a._coordinateInput=null;a._badInput=!1;a._goToEnabled=!1;a._conversionFormat=null;a._settingsFormat=null;a._previewConversion=null;a._expanded=!1;a._popupVisible=!1;a._settingsVisible=!1;a._inputVisible=!1;a.conversions=null;a.currentLocation=null;a.formats=null;a.goToOverride=null;a.label=void 0;
a.messages=null;a.messagesCommon=null;a.mode=null;a.orientation="auto";a.requestDelay=null;a.view=null;a.viewModel=new B;return a}w._inheritsLoose(u,D);var e=u.prototype;e.reverseConvert=function(a,b){return this.viewModel.reverseConvert(a,b)};e.render=function(){const a=this.get("viewModel.state"),b="disabled"===a?c.jsx("div",{key:"esri-coordinate__no-basemap"},this.messages.noBasemap):null,d=!b&&this._inputVisible?this._renderInputForm():null,g=!b&&this._settingsVisible?this._renderSettings():null,
h=b||d||g?null:this._renderConversionsView(),f=this._popupVisible?this._renderPopup():null;return c.jsx("div",{class:this.classes("esri-coordinate-conversion esri-widget",{["esri-coordinate-conversion--capture-mode"]:"capture"===this.mode,["esri-disabled"]:"loading"===a,["esri-coordinate-conversion--no-basemap"]:"disabled"===a})},f,b,h,g,d)};e._addConversion=function(a){a=a.target;const b=a["data-index"],d=new A({format:a.options[a.options.selectedIndex]["data-format"]});a.options.selectedIndex=0;
0<=b&&this.conversions.removeAt(b);this.conversions.add(d,b)};e._findSettingsFormat=function(){return this._settingsFormat||this.conversions.reduceRight((a,b)=>{b=b.format;return b.get("hasDisplayProperties")?b:a},null)||this.formats.find(a=>a.hasDisplayProperties)};e._hidePopup=function(){this._popupId&&(clearTimeout(this._popupId),this._popupId=null);this._popupVisible=!1;this._popupMessage=null;this.scheduleRender()};e._onConvertComplete=function(){this._inputVisible=!1;this._coordinateInput.value=
""};e._onCopy=function(a){const b=a.currentTarget["data-conversion"].displayCoordinate;"clipboardData"in x?x.clipboardData.setData("text",b):a.clipboardData.setData("text/plain",b);this._showPopup(this.messages.copySuccessMessage);a.preventDefault()};e._processUserInput=function(a){a=G.eventKey(a);const b=this.viewModel;"Enter"!==a&&a?this._badInput&&(this._badInput=!1):this._reverseConvert(this._coordinateInput.value,this._coordinateInput["data-format"]).then(d=>{"capture"===this.mode?b.resume():
this.mode="capture";this.currentLocation=d;b.setLocation(d);this._onConvertComplete()}).catch(d=>{C.error(d);this._showPopup(this.messages.invalidCoordinate);this._badInput=!0})};e._reverseConvert=function(a,b){const d=this.viewModel;return b.reverseConvert(a).then(g=>{this._goToEnabled&&d.goToLocation(g).catch(h=>{C.warn(h);this._showPopup(this.messages.locationOffBasemap)});return g})};e._setInputFormat=function(a){a=a.target;this._conversionFormat=a[a.options.selectedIndex]["data-format"]};e._setPreviewConversion=
function(){const a=this._findSettingsFormat(),b=this.viewModel;if(a){const d=this.conversions.find(g=>g.format===a);this._previewConversion=new A({format:a,position:{location:this.currentLocation,coordinate:d&&d.position.coordinate}});this._previewConversion.position.coordinate||b.previewConversion(this._previewConversion)}};e._setSettingsFormat=function(a){a=a.target;this._settingsFormat=a[a.options.selectedIndex]["data-format"];this._setPreviewConversion()};e._showPopup=function(a,b=2500){this._popupMessage=
a;this._popupVisible?clearTimeout(this._popupId):this._popupVisible=!0;this.scheduleRender();this._popupId=setTimeout(()=>{this._popupId=null;this._hidePopup()},b)};e._toggleGoTo=function(){this._goToEnabled=!this._goToEnabled};e._updateCurrentPattern=function(a){a.stopPropagation();a=a.target;const b=this._findSettingsFormat();b&&(b.currentPattern=a.value)};e._renderConversion=function(a,b){const {messages:d}=this,g=`${this.id}__list-item-${b}`,h=`${a.format.name} ${d.conversionOutputSuffix}`;var f=
0===b;const m=f||this._expanded,q=f?this._renderFirstConversion(a):this._renderTools(b,a,g);f=f&&!a.displayCoordinate?d.noLocation:a.displayCoordinate;f=c.jsx("div",{"aria-label":f,class:"esri-coordinate-conversion__display","data-conversion":a,role:"listitem",tabindex:"0",title:f},f);const v=this._renderOptions(this.formats.filter(I=>I!==a.format));return m?c.jsx("li",{"aria-label":h,class:"esri-coordinate-conversion__row",id:g,key:a,role:"group",title:h,tabindex:"0"},c.jsx("select",{"aria-controls":g,
"aria-label":d.selectFormat,class:this.classes("esri-select","esri-coordinate-conversion__select-row"),bind:this,"data-index":b,onchange:this._addConversion,title:d.selectFormat},c.jsx("option",{"aria-label":a.format.name,selected:!0,title:a.format.name},a.format.name.toUpperCase()),v),f,q):null};e._renderCopyButton=function(a){return c.jsx("li",{"aria-label":this.messagesCommon.copy,bind:this,class:this.classes("esri-widget--button","esri-coordinate-conversion__row-button"),"data-conversion":a,onclick:this._copyCoordinateOutput,
onkeydown:this._copyCoordinateOutput,oncopy:this._onCopy,role:"button",tabindex:"0",title:this.messagesCommon.copy},c.jsx("span",{"aria-hidden":"true",class:"esri-icon-duplicate"}))};e._renderFirstConversion=function(a){var b=this.id;const d={["esri-icon-down"]:!this._expanded,["esri-icon-up"]:this._expanded},{messages:g,messagesCommon:h}=this,f="live"===this.mode?g.captureMode:g.liveMode,m=this._expanded?h.collapse:h.expand;a=a.displayCoordinate&&"capture"===this.mode?this._renderCopyButton(a):null;
b=this.multipleConversions?c.jsx("li",{"aria-controls":`${b}__${"esri-coordinate-conversion__conversion-list"}`,"aria-label":m,bind:this,class:"esri-widget--button",key:"esri-coordinate-conversion__expand-button",onclick:this._toggleExpand,onkeydown:this._toggleExpand,role:"button",tabindex:"0",title:m},c.jsx("span",{"aria-hidden":"true",class:this.classes(d)})):c.jsx("li",{"aria-label":f,bind:this,class:this.classes("esri-widget--button","esri-coordinate-conversion__mode-toggle"),key:"esri-coordinate-conversion__mode-toggle",
onclick:this._toggleMode,onkeydown:this._toggleMode,role:"button",tabindex:"0",title:f},c.jsx("span",{"aria-hidden":"true",class:"esri-icon-map-pin"}));return c.jsx("ul",{class:"esri-coordinate-conversion__tools"},a,b)};e._renderInputForm=function(){const a=this._conversionFormat||this.conversions.getItemAt(0).format;var b=this.formats.findIndex(q=>q.name===a.name),d=this.id;const g=`${d}__${"esri-coordinate-conversion__input-coordinate"}`;d=`${d}__${"esri-coordinate-conversion__input-coordinate"}__header`;
b=this._renderOptions(this.formats,!0,b);const h={["esri-coordinate-conversion__input-coordinate--rejected"]:this._badInput},{messages:f,messagesCommon:m}=this;return c.jsx("div",{"aria-labelledby":d,class:"esri-coordinate-conversion__input-form",key:"esri-coordinate-conversion__input-form",role:"search"},c.jsx("div",{class:"esri-coordinate-conversion__heading"},c.jsx("div",{"aria-label":m.back,bind:this,class:this.classes("esri-widget--button","esri-coordinate-conversion__back-button"),onclick:this._toggleInputVisibility,
onkeydown:this._toggleInputVisibility,role:"button",tabindex:"0",title:m.back},this._renderBackIcon()),c.jsx("h4",{class:"esri-widget__heading",id:d},f.inputCoordTitle)),c.jsx("div",{class:"esri-coordinate-conversion__input-group"},c.jsx("select",{"aria-controls":g,"aria-label":f.selectFormat,bind:this,class:this.classes("esri-select","esri-coordinate-conversion__select-row"),onchange:this._setInputFormat,title:f.selectFormat},b),c.jsx("input",{afterCreate:y.storeNode,"aria-labelledby":d,"aria-required":"true",
bind:this,class:this.classes("esri-coordinate-conversion__input-coordinate","esri-input",h),"data-format":a,"data-node-ref":"_coordinateInput",id:g,onkeydown:this._processUserInput,placeholder:f.inputCoordTitle,role:"textbox",spellcheck:!1,title:f.inputCoordTitle,type:"text"})),c.jsx("div",{class:"esri-coordinate-conversion__input-group"},c.jsx("label",{"aria-label":f.goTo},c.jsx("input",{bind:this,checked:this._goToEnabled,onclick:this._toggleGoTo,title:f.goTo,type:"checkbox"}),f.goTo),c.jsx("button",
{"aria-label":f.convert,bind:this,class:this.classes("esri-coordinate-conversion__button","esri-button"),onclick:this._processUserInput,title:f.convert,type:"button"},f.convert)))};e._renderConversionsView=function(){const a=`${this.id}__${"esri-coordinate-conversion__conversion-list"}`;var b=this._renderPrimaryTools();const d=this._renderOptions(this.formats),g=this.conversions.map((f,m)=>this._renderConversion(f,m)).toArray(),{messages:h}=this;b=this._expanded?c.jsx("div",{class:"esri-coordinate-conversion__row"},
c.jsx("select",{"aria-controls":a,"aria-label":h.addConversion,bind:this,class:this.classes("esri-select","esri-coordinate-conversion__select-primary"),onchange:this._addConversion,title:h.addConversion},c.jsx("option",{disabled:!0,selected:!0,value:""},h.addConversion),d),b):null;return c.jsx("div",{class:this.classes("esri-coordinate-conversion__conversions-view",{["esri-coordinate-conversion__conversions-view--expanded"]:this._expanded,["esri-coordinate-conversion__conversions-view--expand-up"]:"expand-up"===
this.orientation,["esri-coordinate-conversion__conversions-view--expand-down"]:"expand-down"===this.orientation}),key:"esri-coordinate-conversion__main-view"},c.jsx("ul",{"aria-expanded":this._expanded?"true":"false",class:"esri-coordinate-conversion__conversion-list",id:a},g),b)};e._renderOptions=function(a,b,d){const g=this.conversions.getItemAt(0);return a.map((h,f)=>{const m=b||!g?!1:g.format.name===h.name||this.conversions.map(q=>q.format.name).includes(h.name);return c.jsx("option",{"aria-label":h.name,
"data-format":h,disabled:m,key:h.name,selected:f===d,value:h.name},h.name.toUpperCase())}).toArray()};e._renderPopup=function(){return c.jsx("div",{class:"esri-coordinate-conversion__popup",role:"alert"},this._popupMessage)};e._renderPrimaryTools=function(){const {messages:a}=this,b="live"===this.mode?a.captureMode:a.liveMode;return c.jsx("ul",{class:"esri-coordinate-conversion__tools"},c.jsx("li",{bind:this,class:"esri-widget--button",onclick:this._toggleInputVisibility,onkeydown:this._toggleInputVisibility,
role:"button",tabindex:"0",title:a.inputCoordTitle},c.jsx("span",{"aria-hidden":"true",class:"esri-icon-edit"})),c.jsx("li",{bind:this,class:this.classes("esri-widget--button","esri-coordinate-conversion__mode-toggle"),onclick:this._toggleMode,onkeydown:this._toggleMode,role:"button",tabindex:"0",title:b},c.jsx("span",{"aria-hidden":"true",class:"esri-icon-map-pin"})),c.jsx("li",{bind:this,class:"esri-widget--button",onclick:this._toggleSettingsVisibility,onkeydown:this._toggleSettingsVisibility,
role:"button",tabindex:"0",title:a.settingsTitle},c.jsx("span",{"aria-hidden":"true",class:"esri-icon-settings2"})))};e._renderSettings=function(){var a=this.id;const b=`${a}__${"esri-coordinate-conversion__pattern-input"}`,d=`${a}__${"esri-coordinate-conversion__pattern-input"}__header`;a=`${a}__${"esri-coordinate-conversion__preview-coordinate"}`;var g=this.formats.filter(v=>v.hasDisplayProperties),h=this._findSettingsFormat();const f=g.indexOf(h);g=this._renderOptions(g,!0,f);h=h.get("currentPattern");
const {messages:m,messagesCommon:q}=this;return c.jsx("div",{"aria-labelledby":d,class:"esri-coordinate__settings",key:"esri-coordinate-conversion__settings"},c.jsx("div",{class:"esri-coordinate-conversion__heading"},c.jsx("div",{bind:this,class:this.classes("esri-widget--button","esri-coordinate-conversion__back-button"),onclick:this._toggleSettingsVisibility,onkeydown:this._toggleSettingsVisibility,role:"button",tabindex:"0",title:q.back},this._renderBackIcon()),c.jsx("h4",{class:"esri-widget__heading",
id:d},m.settingsTitle)),c.jsx("div",{class:"esri-coordinate-conversion__settings-group"},c.jsx("label",{for:b},m.changeCoordinateDisplay),c.jsx("select",{"aria-label":m.selectFormat,class:"esri-select",bind:this,onchange:this._setSettingsFormat,title:m.selectFormat},g),c.jsx("div",{class:"esri-coordinate-conversion__settings-group-horizontal"},c.jsx("input",{"aria-controls":a,bind:this,class:this.classes("esri-coordinate-conversion__pattern-input","esri-input"),id:b,oninput:this._updateCurrentPattern,
spellcheck:!1,title:m.changeCoordinateDisplay,type:"text",value:h}),c.jsx("div",{"aria-controls":b,bind:this,class:"esri-widget--button",onclick:this._setDefaultPattern,onkeydown:this._setDefaultPattern,role:"button",tabindex:"0",title:m.defaultPattern},c.jsx("span",{"aria-hidden":"true",class:"esri-icon-refresh"})))),c.jsx("div",{class:"esri-coordinate-conversion__settings-group"},c.jsx("label",null,q.preview,c.jsx("div",{class:"esri-coordinate-conversion__preview-coordinate",id:a,tabindex:"0"},
this._previewConversion.displayCoordinate))))};e._renderBackIcon=function(){return c.jsx("span",{"aria-hidden":"true",class:y.isRTL()?"esri-icon-right-arrow":"esri-icon-left-arrow"})};e._renderTools=function(a,b,d){b=b.displayCoordinate&&"capture"===this.mode?this._renderCopyButton(b):null;const {messages:g}=this;return c.jsx("ul",{class:"esri-coordinate-conversion__tools",role:"listitem"},b,c.jsx("li",{"aria-controls":d,"aria-label":g.removeConversion,bind:this,class:this.classes("esri-widget--button",
"esri-coordinate-conversion__row-button"),"data-index":a,key:`${d}__${"esri-widget--button"}`,onclick:this._removeConversion,onkeydown:this._removeConversion,tabindex:"0",role:"button",title:g.removeConversion},c.jsx("span",{"aria-hidden":"true",class:"esri-icon-close"})))};e._copyCoordinateOutput=function(a){a=a.target;if(!("createTextRange"in document.body)){const b=window.getSelection(),d=document.createRange();d.selectNodeContents(a);b.removeAllRanges();b.addRange(d)}document.execCommand("copy")};
e._removeConversion=function(a){this.conversions.removeAt(a.currentTarget["data-index"])};e._setDefaultPattern=function(a){a.stopPropagation();if(a=this._findSettingsFormat())a.currentPattern=a.get("defaultPattern")};e._toggleExpand=function(){this._expanded=!this._expanded};e._toggleInputVisibility=function(){this._inputVisible=!this._inputVisible;this._popupVisible&&this._hidePopup();this._inputVisible?this.viewModel.pause():this.viewModel.resume()};e._toggleMode=function(){this.mode="live"===this.mode?
"capture":"live"};e._toggleSettingsVisibility=function(){this._settingsVisible=!this._settingsVisible;this._popupVisible&&this._hidePopup();this._settingsVisible?(this._setPreviewConversion(),this.viewModel.pause()):this.viewModel.resume()};w._createClass(u,[{key:"multipleConversions",set:function(a){!1===a&&(this._expanded=!1,this.conversions.splice(1,this.conversions.length-1));this._set("multipleConversions",a)},get:function(){const a=this._get("multipleConversions");return"boolean"===typeof a?
a:!0}}]);return u}(H);l.__decorate([p.aliasOf("viewModel.conversions")],k.prototype,"conversions",void 0);l.__decorate([p.aliasOf("viewModel.currentLocation"),n.renderable()],k.prototype,"currentLocation",void 0);l.__decorate([p.aliasOf("viewModel.formats"),n.renderable()],k.prototype,"formats",void 0);l.__decorate([p.aliasOf("viewModel.goToOverride")],k.prototype,"goToOverride",void 0);l.__decorate([t.property({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],k.prototype,"label",void 0);
l.__decorate([t.property(),n.renderable(),z.messageBundle("esri/widgets/CoordinateConversion/t9n/CoordinateConversion")],k.prototype,"messages",void 0);l.__decorate([t.property(),n.renderable(),z.messageBundle("esri/t9n/common")],k.prototype,"messagesCommon",void 0);l.__decorate([p.aliasOf("viewModel.mode"),n.renderable()],k.prototype,"mode",void 0);l.__decorate([t.property(),n.renderable()],k.prototype,"orientation",void 0);l.__decorate([p.aliasOf("viewModel.requestDelay")],k.prototype,"requestDelay",
void 0);l.__decorate([t.property(),n.renderable()],k.prototype,"multipleConversions",null);l.__decorate([p.aliasOf("viewModel.locationSymbol")],k.prototype,"locationSymbol",void 0);l.__decorate([p.aliasOf("viewModel.view"),n.renderable()],k.prototype,"view",void 0);l.__decorate([t.property({type:B}),n.renderable(["viewModel.state","viewModel.waitingForConversions"])],k.prototype,"viewModel",void 0);l.__decorate([r.accessibleHandler()],k.prototype,"_copyCoordinateOutput",null);l.__decorate([r.accessibleHandler()],
k.prototype,"_removeConversion",null);l.__decorate([r.accessibleHandler()],k.prototype,"_setDefaultPattern",null);l.__decorate([r.accessibleHandler()],k.prototype,"_toggleExpand",null);l.__decorate([r.accessibleHandler()],k.prototype,"_toggleInputVisibility",null);l.__decorate([r.accessibleHandler()],k.prototype,"_toggleMode",null);l.__decorate([r.accessibleHandler()],k.prototype,"_toggleSettingsVisibility",null);return k=l.__decorate([F.subclass("esri.widgets.CoordinateConversion")],k)});