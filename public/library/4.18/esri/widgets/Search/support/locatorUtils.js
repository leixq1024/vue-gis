// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.18/esri/copyright.txt for details.
//>>built
define("exports ../../../core/maybe ../../../core/promiseUtils ../../../geometry/Polygon ../../../Graphic ./geometryUtils".split(" "),function(t,x,u,A,B,v){function C(b,c){const {source:a,spatialReference:d,location:f,sourceIndex:g,view:l}=b,{locator:p,zoomScale:h,defaultZoomScale:m}=a,e=l&&l.scale;b=c&&c.signal;d&&(p.outSpatialReference=d);return p.locationToAddress({location:f},{signal:b}).then(n=>y([n],{sourceIndex:g,scale:e,view:l,zoomScale:h,defaultZoomScale:m}))}function z(b,c){const {filter:a,
withinViewEnabled:d}=b;b=c&&c.extent;return(c=v.createExtentFromGeometry(a&&a.geometry,c,c&&c.scale))||(d&&b?b:void 0)}function D(b,c){const {source:a,suggestResult:d,spatialReference:f,view:g,maxResults:l,sourceIndex:p}=b,h=a&&a.zoomScale,m=a&&a.defaultZoomScale;if(!d.text.trim())return u.resolve();b=`${!d.key&&a.prefix?a.prefix:""}${d.text}${!d.key&&a.suffix?a.suffix:""}`;const e={},{locator:n}=a,r=g&&g.scale,k=z(a,g);c=c&&c.signal;if(!n)return u.resolve();a.categories&&(e.categories=a.categories);
a.locationType&&(e.locationType=a.locationType);f&&(n.outSpatialReference=f);const w=g&&g.get("extent.center");w&&(e.location=w);e.maxLocations=l;k&&(e.searchExtent=x.unwrap(k));a.countryCode&&(e.countryCode=a.countryCode);const {key:q}=d;q&&(e.magicKey=q);e.address={};e.address[a.singleLineFieldName||"Single Line Input"]=b;a.outFields&&(e.outFields=a.outFields);return n.addressToLocations(e,{signal:c}).then(E=>y(E,{key:q,scale:r,sourceIndex:p,view:g,zoomScale:h,defaultZoomScale:m}))}function F(b,
c){return b.map(a=>({text:a.text,key:a.magicKey,sourceIndex:c}))}function y(b,c){return b.map(a=>{{const {key:g,scale:l,sourceIndex:p,view:h,zoomScale:m,defaultZoomScale:e}=c,{attributes:n,extent:r,location:k,address:w}=a;a=new B({geometry:k,attributes:n});var d=r||k,f=v.createExtentFromGeometry(d,h,l);d="number"===typeof m?v.scaleExtent(f,h,m):"number"===typeof e&&"point"===d.type?v.scaleExtent(f,h,e):f;f=k?`${k.x},${k.y}`:"";f=w||f;const q=a.clone();x.isSome(d)&&(q.geometry=A.fromExtent(d));a={extent:d,
feature:a,target:q,key:g,name:f,sourceIndex:p}}return a})}t.getResults=function(b,c){return b.location?C(b,c):D(b,c)};t.getSuggestions=function(b,c){const {source:a,spatialReference:d,view:f,suggestTerm:g,maxSuggestions:l,sourceIndex:p}=b;b={};const {locator:h}=a,m=z(a,f);c=c&&c.signal;if(!h)return u.resolve();a.categories&&(b.categories=a.categories);h.outSpatialReference=d;const e=f&&f.get("extent.center");e&&(b.location=e);if(!g.trim())return u.resolve();const {prefix:n="",suffix:r=""}=a;b.text=
`${n}${g}${r}`;m&&(b.searchExtent=x.unwrap(m));b.maxSuggestions=l;a.countryCode&&(b.countryCode=a.countryCode);return h.suggestLocations(b,{signal:c}).then(k=>F(k,p))};t.isArcGISWorldGeocoder=function(b){return b?/(?:arcgis\.com\/arcgis\/rest\/services\/world\/geocodeserver).*/gi.test(b)||/(?:\/servers\/[\da-z\.-]+\/rest\/services\/world\/geocodeserver).*/gi.test(b):!1};Object.defineProperty(t,"__esModule",{value:!0})});