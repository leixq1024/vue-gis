// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.18/esri/copyright.txt for details.
//>>built
define("exports ../../../core/maybe ../../../core/handleUtils ../../../core/arrayUtils ../../../core/events ../../../core/promiseUtils ../../../intl/substitute ../../../intl ../../../core/unitFormatUtils ../../support/widgetUtils ../../support/chartUtils ./intlUtils ./constants".split(" "),function(v,g,r,w,x,A,B,U,t,q,C,D,u){function E(a){a=new a.am4charts.XYCursor;a.trackable=!0;a.lineY.disabled=!0;return a}function F(a,{am4core:b}){a=a.amChart.zoomOutButton.background;a.fill=b.color("#0079c1");
a.states.getKey("hover").properties.fill=b.color("#00598e");a.states.getKey("down").properties.fill=b.color("#00598e")}function G({amChart:{tooltip:a}},{am4core:b}){a.zIndex=-1;a.pointerOrientation="down";a.getFillFromObject=!1;a.label.fill=b.color("#323232");a.background.cornerRadius=0;a.background.stroke=null;a.background.fill=b.color("#ffffff");q.isRTL()&&(a.label.textAlign="middle")}function H(a,b){({am4core:b}=b);const {xAxis:c}=a;c.numberFormatter=y(a,"distance");c.strictMinMax=!0;c.title.visible=
!1;a=c.renderer;a.line.visible=!1;a.minGridDistance=80;a.maxLabelPosition=.98;a.fontWeight="400";a.fontSize=10;const d=a.labels.template;d.fontSize=8;d.fontWeight="400";d.paddingTop=5;d.horizontalCenter="left";d.paddingLeft=0;const e=a.grid.template;e.strokeOpacity=1;e.stroke=b.color("#e0e0e0");q.isRTL()&&(a.inversed=!0,c.tooltip.label.textAlign="middle",d.textAlign="middle")}function I(a,b){({am4core:b}=b);var {yAxis:c}=a;c.numberFormatter=y(a,"elevation");c.title.visible=!1;c.cursorTooltipEnabled=
!1;c.strictMinMax=!1;c.extraMax=.02;c.extraMin=.02;a=c.renderer;a.line.visible=!1;a.minGridDistance=30;a.maxLabelPosition=.98;a.fontWeight="400";a.fontSize=10;c=a.labels.template;c.fontSize=8;c.fontWeight="400";c.paddingRight=5;c.verticalCenter="bottom";c.paddingBottom=0;const d=a.grid.template;d.strokeOpacity=1;d.stroke=b.color("#e0e0e0");q.isRTL()&&(a.opposite=!0,c.textAlign="middle")}function J(a,b,{data:c,elevationUnitsPerPixel:d,messages:e}){var {amChart:h}=b;h.tooltip.hide();h=b.data!==c;const l=
b.elevationUnitsPerPixel!==d;b.data=c;b.elevationUnitsPerPixel=d;b.messages=e;h&&K(b);(h||l)&&L(b);h&&M(a,b)}function K({xAxis:a,data:b}){if(!g.isNone(b)){var c=0;for(const e of b.lines){var d;b=g.unwrapOr(e.samples,[]);b=null==(d=w.last(b))?void 0:d.distance;g.isSome(b)&&b>c&&(c=b)}a.min=0;a.max=c;a.invalidateLabels()}}function L({yAxis:a,data:b,elevationUnitsPerPixel:c}){if(!g.isNone(b)){var d=g.applySome(b.statistics,e=>e.minElevation);b=g.applySome(b.statistics,e=>e.maxElevation);g.isSome(c)&&
g.isSome(d)&&g.isSome(b)?(c=Math.max(0,c-(b-d))/2,a.min=Math.round(d-c),a.max=Math.round(b+c)):(a.min=void 0,a.max=void 0);a.invalidateLabels()}}function M(a,b){const {amChart:c,data:d}=b;if(g.isNone(d)||0===d.lines.length)c.series.clear();else{var e=new Map,h=new Set(c.series.values),l=d.lines.length;for(let k=0;k<l;k++){const m=d.lines[k];let f=b.series.get(m.id);f?(g.applySome(f.fill,p=>h.delete(p)),h.delete(f.line)):(f=N(a,m),g.applySome(f.fill,p=>c.series.push(p)),c.series.push(f.line));e.set(f.id,
f);const n=l-k-1;g.applySome(f.fill,p=>p.zIndex=n);f.line.zIndex=l+n;O(a,f,m)}b.series=e;for(const k of h)c.series.removeValue(k)}}function O(a,{line:b,fill:c},d){const {r:e,g:h,b:l,a:k}=d.color,m=a.am4core.color({r:e,g:h,b:l,a:k}),f=g.unwrapOr(d.samples,[]),n=0<f.length;b.data=f;b.stroke=m;b.visible=n;g.applySome(c,p=>{p.data=f;p.visible=n;p.fill=m.lighten(.9)})}function N(a,{id:b,showFill:c}){({am4charts:a}=a);a=new a.LineSeries;a.id=`${"line"}-${b}`;a.showOnInit=!1;a.simplifiedProcessing=!0;a.connect=
!1;a.strokeWidth=1.5;a.fillOpacity=0;a.dataFields.valueX="distance";a.dataFields.valueY="elevation";let d=null;c&&(d=a.clone(),d.id=`${"fill"}-${b}`,d.strokeWidth=0,d.fillOpacity=1);return{id:b,line:a,fill:d}}function P(a,b){const {amChart:c,xAxis:d,yAxis:e}=a,h=c.cursor,l=h.events.on("cursorpositionchanged",()=>{const m=d.toAxisPosition(h.xPosition),f=e.toAxisPosition(h.yPosition);b(m,f)}),k=x.on(c.chartContainer.htmlContainer,["mouseleave","pointerleave"],()=>{b(null,null)});return r.makeHandle(()=>
{l.dispose();k.remove()})}function Q(a){const {amChart:b,xAxis:c}=a,d=b.cursor.events.on("cursorpositionchanged",()=>{if(1===g.applySome(a.data,l=>l.progress)){var e=b.tooltip,h=R(a);g.isSome(h)?(e.text=h.text,e.pointTo(h.point,!0),e.show()):e.hide();c.tooltip.text=S(a);c.showTooltip()}});return r.makeHandle(()=>d.dispose())}function T({amChart:a,xAxis:b}){return x.on(a.chartContainer.htmlContainer,["mouseleave","pointerleave"],()=>{a.tooltip.hide();b.hideTooltip()})}function R(a){const {amChart:b,
yAxis:c,data:d,messages:e}=a;if(g.isNone(d)||g.isNone(e))return null;var h=d.effectiveUnits.elevation;const l=[];let k=null;for(var m of d.lines){var f=z(a,m);f=g.applySome(f,n=>n.elevation);if(g.isNone(k)||g.isSome(f)&&f>k)k=f;f=B.substitute(e.chartTooltip,{name:D.getTranslatedLineTitle(m,e),elevation:g.isSome(f)?t.formatDecimal(e,f,h,u.FORMAT_PRECISION):u.NOT_AVAILABLE});l.push(`[${m.color.toHex()}]\u25cf[/] ${f}`)}if(g.isNone(k))return null;a=b.cursor;h=c.measuredHeight;m=h+b.pixelPaddingTop;return{text:l.join("\n"),
point:{x:a.point.x+a.parent.pixelX+b.pixelPaddingLeft,y:m-c.valueToPosition(k)*h-10}}}function S(a){const {data:b,messages:c}=a;if(g.isNone(b)||g.isNone(c))return"";const d=b.lines[0];a=d?z(a,d):null;return g.isSome(a)?t.formatDecimal(c,a.distance,b.effectiveUnits.distance,u.FORMAT_PRECISION):"-"}function y(a,b){const c=a.xAxis.numberFormatter.clone();c.format=(d,e,h)=>{const {messages:l,data:k}=a;return g.isSome(l)&&g.isSome(k)&&"string"!==typeof d?t.formatDecimal(l,d,k.effectiveUnits[b],h):""};
return c}function z({amChart:a,xAxis:b},c){c=g.unwrapOr(c.samples,[]);if(0===c.length)return null;a=b.toAxisPosition(a.cursor.xPosition);b=b.positionToValue(a);return w.binaryFindClosest(c,b,d=>d.distance)}v.createChart=async function(a){const b=await C.loadChartsModule();A.throwIfAborted(a.abortOptions);const {am4core:c,am4charts:d}=b;c.options.minPolylineStep=2;c.options.autoSetClassName=!0;const e=c.create(a.container,d.XYChart);q.isRTL()?(e.rtl=!0,e.padding(20,-10,0,1)):e.padding(20,1,0,-10);
e.cursor=E(b);var h=e.plotContainer.background;h.strokeWidth=1;h.strokeOpacity=1;h.stroke=c.color("#e0e0e0");h=e.xAxes.push(new d.ValueAxis);const l=e.yAxes.push(new d.ValueAxis),k={params:a,amChart:e,xAxis:h,yAxis:l,series:new Map,data:null,elevationUnitsPerPixel:null,messages:null};F(k,b);G(k,b);H(k,b);I(k,b);const m=[P(k,a.onCursorPositionChange),Q(k),T(k)];let f=null;return{...k,update(n){if(n.data!==k.data||n.messages!==k.messages)g.isSome(f)&&(clearTimeout(f),f=null),f=setTimeout(()=>{f=null;
J(b,k,n)})},destroy(){g.isSome(f)&&(clearTimeout(f),f=null);r.handlesGroup(m).remove();e.dispose()}}};Object.defineProperty(v,"__esModule",{value:!0})});