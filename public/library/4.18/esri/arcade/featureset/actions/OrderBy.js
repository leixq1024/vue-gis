// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.18/esri/copyright.txt for details.
//>>built
define("../../../chunks/_rollupPluginBabelHelpers ../../../core/promiseUtils ../../../chunks/languageUtils ../support/IdSet ../support/FeatureSet ../support/OrderbyClause".split(" "),function(u,n,p,q,r,v){return function(t){function l(a){var b=t.call(this,a)||this;b._orderbyclause=null;b.declaredClass="esri.arcade.featureset.actions.OrderBy";b._maxProcessing=100;b._orderbyclause=a.orderbyclause;b._parent=a.parentfeatureset;return b}u._inheritsLoose(l,t);var g=l.prototype;g._getSet=function(a){return null===
this._wset?this._ensureLoaded().then(()=>this._getFilteredSet("",null,null,this._orderbyclause,a)).then(b=>{this._checkCancelled(a);return this._wset=b}):n.resolve(this._wset)};g.manualOrderSet=function(a,b){return this.getIdColumnDictionary(a,[],-1,b).then(c=>{this._orderbyclause.order(c);const d=new q([],[],!0,null);for(let e=0;e<c.length;e++)d._known.push(c[e].id);return d})};g.getIdColumnDictionary=function(a,b,c,d){if(c<a._known.length-1){var e=this._maxQueryRate();if("GETPAGES"===a._known[c+
1])return p.tick(this._parent._expandPagedSet(a,e,0,0,d)).then(()=>this.getIdColumnDictionary(a,b,c,d));e=c+1;const f=[];for(;e<a._known.length&&"GETPAGES"!==a._known[e];)f.push(a._known[e]),e++;c+=f.length;return p.tick(this._parent._getFeatureBatch(f,d)).then(h=>{this._checkCancelled(d);for(const m of h)b.push({id:m.attributes[this.objectIdField],feature:m});return this.getIdColumnDictionary(a,b,c,d)})}return 0<a._candidates.length?p.tick(this._refineSetBlock(a,this._maxProcessingRate(),d)).then(()=>
{this._checkCancelled(d);return this.getIdColumnDictionary(a,b,c,d)}):n.resolve(b)};g._isInFeatureSet=function(a){return this._parent._isInFeatureSet(a)};g._getFeatures=function(a,b,c,d){return this._parent._getFeatures(a,b,c,d)};g._featureFromCache=function(a){if(void 0===this._featureCache[a]){const b=this._parent._featureFromCache(a);return void 0===b?void 0:null===b?null:this._featureCache[a]=b}return this._featureCache[a]};g._fetchAndRefineFeatures=function(){return n.reject(Error("Fetch and Refine should not be called in this featureset"))};
g._getFilteredSet=function(a,b,c,d,e){return this._ensureLoaded().then(()=>this._parent._getFilteredSet(a,b,c,null===d?this._orderbyclause:d,e)).then(f=>{this._checkCancelled(e);let h;h=new q(f._candidates.slice(0),f._known.slice(0),f._ordered,this._clonePageDefinition(f.pagesDefinition));let m=!0;0<f._candidates.length&&(m=!1);return!1===h._ordered?this.manualOrderSet(h,e).then(k=>{!1!==m||null===b&&null===c||(k=new q(k._candidates.slice(0).concat(k._known.slice(0)),[],k._ordered,this._clonePageDefinition(k.pagesDefinition)));
return k}):h})};l.registerAction=function(){r._featuresetFunctions.orderBy=function(a){return""===a?this:new l({parentfeatureset:this,orderbyclause:new v(a)})}};return l}(r)});