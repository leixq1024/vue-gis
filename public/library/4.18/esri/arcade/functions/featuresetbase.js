// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.18/esri/copyright.txt for details.
//>>built
define("exports ../../core/promiseUtils ../../chunks/languageUtils ../Dictionary ../ArcadePortal ../../layers/support/Field ../featureset/support/shared ../Feature ./fieldStats ../featureSetCollection ../../core/sql/WhereClause ../featureset/support/sqlUtils ../featureset/actions/AttributeFilter ../featureset/actions/Adapted ../featureset/support/OrderbyClause ../featureset/actions/OrderBy ../featureset/sources/Empty ../featureset/actions/Top ../../layers/FeatureLayer ../featureset/sources/FeatureLayerMemory ../featureSetUtils".split(" "),
function(T,A,d,C,M,H,N,L,O,U,z,V,W,v,aa,ba,ca,da,P,ea,B){function fa(c,f,p,b){if(1===b.length){if(d.isArray(b[0]))return O.calculateStat(c,b[0],-1);if(d.isImmutableArray(b[0]))return O.calculateStat(c,b[0].toArray(),-1)}return O.calculateStat(c,b,-1)}function Q(c,f,p){const b=c.getVariables();if(0<b.length){const n=[];for(let a=0;a<b.length;a++)n.push(f.evaluateIdentifier(p,{name:b[a]}));return A.all(n).then(a=>{const g={};for(let q=0;q<b.length;q++)g[b[q]]=a[q];c.parameters=g;return c})}return A.resolve(c)}
function r(c,f,p=null){for(const b in c)if(b.toLowerCase()===f.toLowerCase())return c[b];return p}function X(c){if(null===c)return null;const f={type:r(c,"type",""),name:r(c,"name","")};if("range"===f.type)f.range=r(c,"range",[]);else{f.codedValues=[];for(const p of r(c,"codedValues",[]))f.codedValues.push({name:r(p,"name",""),code:r(p,"code",null)})}return f}function R(c){if(null===c)return null;const f={},p=r(c,"wkt",null);null!==p&&(f.wkt=p);c=r(c,"wkid",null);null!==c&&(f.wkid=c);return f}function Y(c){if(null===
c)return null;const f={hasZ:r(c,"hasz",!1),hasM:r(c,"hasm",!1)};var p=r(c,"spatialreference",null);p&&(f.spatialReference=R(p));p=r(c,"x",null);if(null!==p)return f.x=p,f.y=r(c,"y",null),f;p=r(c,"rings",null);if(null!==p)return f.rings=p,f;p=r(c,"paths",null);if(null!==p)return f.paths=p,f;p=r(c,"points",null);if(null!==p)return f.points=p,f;for(const b of"xmin xmax ymin ymax zmin zmax mmin mmax".split(" "))p=r(c,b,null),null!==p&&(f[b]=p);return f}T.registerFunctions=function(c){"async"===c.mode&&
(c.functions.getuser=function(f,p){return c.standardFunctionAsync(f,p,(b,n,a)=>{d.pcCheck(a,1,2);let g=d.defaultUndefined(a[1],""),q=!0===g;g=!0===g||!1===g?"":d.toString(g);if(a[0]instanceof M)return b=null,f.services&&f.services.portal&&(b=f.services.portal),b=B.getPortal(a[0],b),B.lookupUser(b,g,q).then(l=>{if(l){l=JSON.parse(JSON.stringify(l));for(const e of["lastLogin","created","modified"])void 0!==l[e]&&null!==l[e]&&(l[e]=new Date(l[e]));return C.convertObjectToArcadeDictionary(l)}return null});
let m=null;d.isFeatureSet(a[0])&&(m=a[0]);if(m)return q=!1,g?null:m.load().then(()=>m.getOwningSystemUrl()).then(l=>{if(!l)return g?null:m.getIdentityUser().then(k=>k?C.convertObjectToArcadeDictionary({username:k}):null);let e=null;f.services&&f.services.portal&&(e=f.services.portal);e=B.getPortal(new M(l),e);return B.lookupUser(e,g,q).then(k=>{if(k){k=JSON.parse(JSON.stringify(k));for(const h of["lastLogin","created","modified"])void 0!==k[h]&&null!==k[h]&&(k[h]=new Date(k[h]));return C.convertObjectToArcadeDictionary(k)}return null})});
throw Error("Invalid Parameter");})},c.signatures.push({name:"getuser",min:"1",max:"2"}),c.functions.featuresetbyid=function(f,p){return c.standardFunctionAsync(f,p,(b,n,a)=>{d.pcCheck(a,2,4);if(a[0]instanceof U){b=d.toString(a[1]);n=d.defaultUndefined(a[2],null);const g=d.toBoolean(d.defaultUndefined(a[3],!0));null===n&&(n=["*"]);if(!1===d.isArray(n))throw Error("Invalid Parameter");return a[0].featureSetById(b,g,n)}throw Error("Invalid Parameter");})},c.signatures.push({name:"featuresetbyid",min:"2",
max:"4"}),c.functions.featuresetbyportalitem=function(f,p){return c.standardFunctionAsync(f,p,(b,n,a)=>{d.pcCheck(a,2,5);if(null===a[0])throw Error("Portal is required");if(a[0]instanceof M){b=d.toString(a[1]);n=d.toString(a[2]);var g=d.defaultUndefined(a[3],null);const q=d.toBoolean(d.defaultUndefined(a[4],!0));null===g&&(g=["*"]);if(!1===d.isArray(g))throw Error("Invalid Parameter");let m=null;f.services&&f.services.portal&&(m=f.services.portal);m=B.getPortal(a[0],m);return B.constructFeatureSetFromPortalItem(b,
n,f.spatialReference,g,q,m,f.lrucache)}if(!1===d.isString(a[0]))throw Error("Portal is required");b=d.toString(a[0]);n=d.toString(a[1]);g=d.defaultUndefined(a[2],null);a=d.toBoolean(d.defaultUndefined(a[3],!0));null===g&&(g=["*"]);if(!1===d.isArray(g))throw Error("Invalid Parameter");if(f.services&&f.services.portal)return B.constructFeatureSetFromPortalItem(b,n,f.spatialReference,g,a,f.services.portal,f.lrucache);throw Error("Portal is required");})},c.signatures.push({name:"featuresetbyportalitem",
min:"2",max:"5"}),c.functions.featuresetbyname=function(f,p){return c.standardFunctionAsync(f,p,(b,n,a)=>{d.pcCheck(a,2,4);if(a[0]instanceof U){b=d.toString(a[1]);n=d.defaultUndefined(a[2],null);const g=d.toBoolean(d.defaultUndefined(a[3],!0));null===n&&(n=["*"]);if(!1===d.isArray(n))throw Error("Invalid Parameter");return a[0].featureSetByName(b,g,n)}throw Error("Invalid Parameter");})},c.signatures.push({name:"featuresetbyname",min:"2",max:"4"}),c.functions.featureset=function(f,p){return c.standardFunction(f,
p,(b,n,a)=>{d.pcCheck(a,1,1);n=a[0];b={layerDefinition:{geometryType:"",objectIdField:"",globalIdField:"",typeIdField:"",fields:[]},featureSet:{geometryType:"",features:[]}};if(d.isString(n))n=JSON.parse(n),void 0!==n.layerDefinition?(b.layerDefinition=n.layerDefinition,b.featureSet=n.featureSet,n.layerDefinition.spatialReference&&(b.layerDefinition.spatialReference=n.layerDefinition.spatialReference)):(b.featureSet.features=n.features,b.featureSet.geometryType=n.geometryType,b.layerDefinition.geometryType=
b.featureSet.geometryType,b.layerDefinition.objectIdField=n.objectIdFieldName,b.layerDefinition.typeIdField=n.typeIdFieldName,b.layerDefinition.globalIdField=n.globalIdFieldName,b.layerDefinition.fields=n.fields,n.spatialReference&&(b.layerDefinition.spatialReference=n.spatialReference));else if(a[0]instanceof C)if(n=JSON.parse(a[0].castToText()),a=r(n,"layerdefinition"),null!==a){b.layerDefinition.geometryType=r(a,"geometrytype","");b.featureSet.geometryType=b.layerDefinition.geometryType;b.layerDefinition.globalIdField=
r(a,"globalidfield","");b.layerDefinition.objectIdField=r(a,"objectidfield","");b.layerDefinition.typeIdField=r(a,"typeidfield","");var g=r(a,"spatialreference",null);g&&(b.layerDefinition.spatialReference=R(g));for(const h of r(a,"fields",[]))g={name:r(h,"name",""),alias:r(h,"alias",""),type:r(h,"type",""),nullable:r(h,"nullable",!0),editable:r(h,"editable",!0),length:r(h,"length",null),domain:X(r(h,"domain"))},b.layerDefinition.fields.push(g);var q=r(n,"featureset",null);if(q){g={};for(var m of b.layerDefinition.fields)g[m.name.toLowerCase()]=
m.name;for(var l of r(q,"features",[])){q={};m=r(l,"attributes",{});for(var e in m)q[g[e.toLowerCase()]]=m[e];b.featureSet.features.push({attributes:q,geometry:Y(r(l,"geometry",null))})}}}else{b.layerDefinition.geometryType=r(n,"geometrytype","");b.featureSet.geometryType=b.layerDefinition.geometryType;b.layerDefinition.objectIdField=r(n,"objectidfieldname","");b.layerDefinition.typeIdField=r(n,"typeidfieldname","");if(l=r(n,"spatialreference",null))b.layerDefinition.spatialReference=R(l);for(const h of r(n,
"fields",[]))l={name:r(h,"name",""),alias:r(h,"alias",""),type:r(h,"type",""),nullable:r(h,"nullable",!0),editable:r(h,"editable",!0),length:r(h,"length",null),domain:X(r(h,"domain"))},b.layerDefinition.fields.push(l);l={};for(const h of b.layerDefinition.fields)l[h.name.toLowerCase()]=h.name;for(g of r(n,"features",[])){e={};m=r(g,"attributes",{});for(q in m)e[l[q.toLowerCase()]]=m[q];b.featureSet.features.push({attributes:e,geometry:Y(r(g,"geometry",null))})}}else throw Error("Invalid Parameter");
if(b.layerDefinition&&b.featureSet){b:{l=" esriGeometryPoint esriGeometryPolyline esriGeometryPolygon esriGeometryMultipoint esriGeometryEnvelope".split(" ");for(k of l)if(k===b.layerDefinition.geometryType){var k=!0;break b}k=!1}k=!1===k||null===b.layerDefinition.objectIdField||""===b.layerDefinition.objectIdField||!1===d.isArray(b.layerDefinition.fields)||!1===d.isArray(b.featureSet.features)?!1:!0}else k=!1;if(!1===k)throw Error("Invalid Parameter");return ea.create(b,f.spatialReference)})},c.signatures.push({name:"featureset",
min:"1",max:"1"}),c.functions.filter=function(f,p){return c.standardFunctionAsync(f,p,(b,n,a)=>{d.pcCheck(a,2,2);return d.isFeatureSet(a[0])?a[0].load().then(g=>{const q=z.WhereClause.create(a[1],g.getFieldsIndex()),m=q.getVariables();if(0<m.length){g=[];for(let l=0;l<m.length;l++)g.push(c.evaluateIdentifier(f,{name:m[l]}));return A.all(g).then(l=>{const e={};for(let k=0;k<m.length;k++)e[m[k]]=l[k];q.parameters=e;return new W({parentfeatureset:a[0],whereclause:q})})}return A.resolve(new W({parentfeatureset:a[0],
whereclause:q}))}):c.failDefferred("Filter cannot accept this parameter type")})},c.signatures.push({name:"filter",min:"2",max:"2"}),c.functions.orderby=function(f,p){return c.standardFunctionAsync(f,p,(b,n,a)=>{d.pcCheck(a,2,2);return d.isFeatureSet(a[0])?(b=new aa(a[1]),A.resolve(new ba({parentfeatureset:a[0],orderbyclause:b}))):c.failDefferred("Order cannot accept this parameter type")})},c.signatures.push({name:"orderby",min:"2",max:"2"}),c.functions.top=function(f,p){return c.standardFunctionAsync(f,
p,(b,n,a)=>{d.pcCheck(a,2,2);return d.isFeatureSet(a[0])?A.resolve(new da({parentfeatureset:a[0],topnum:a[1]})):d.isArray(a[0])?d.toNumber(a[1])>=a[0].length?a[0].slice(0):a[0].slice(0,d.toNumber(a[1])):d.isImmutableArray(a[0])?d.toNumber(a[1])>=a[0].length()?a[0].slice(0):a[0].slice(0,d.toNumber(a[1])):c.failDefferred("Top cannot accept this parameter type")})},c.signatures.push({name:"top",min:"2",max:"2"}),c.functions.first=function(f,p){return c.standardFunctionAsync(f,p,(b,n,a)=>{d.pcCheck(a,
1,1);return d.isFeatureSet(a[0])?a[0].first(b.abortSignal).then(g=>{if(null!==g){const q=L.createFromGraphicLikeObject(g.geometry,g.attributes,a[0]);q._underlyingGraphic=g;g=q}return g}):d.isArray(a[0])?0===a[0].length?A.resolve(null):A.resolve(a[0][0]):d.isImmutableArray(a[0])?0===a[0].length()?A.resolve(null):A.resolve(a[0].get(0)):null})},c.signatures.push({name:"first",min:"1",max:"1"}),c.functions.attachments=function(f,p){return c.standardFunctionAsync(f,p,(b,n,a)=>{d.pcCheck(a,1,2);var g=-1,
q=-1,m=null;if(1<a.length)if(a[1]instanceof C)a[1].hasField("minsize")&&(g=d.toNumber(a[1].field("minsize"))),a[1].hasField("maxsize")&&(q=d.toNumber(a[1].field("maxsize"))),a[1].hasField("types")&&(b=d.toStringArray(a[1].field("types"),!1),0<b.length&&(m=b));else if(null!==a[1])throw Error("Invalid Parameter");if(a[0]instanceof L){let l=a[0]._layer;l instanceof P&&(l=B.constructFeatureSet(l,f.spatialReference,["*"],!0,f.lrucache));return null===l||!1===d.isFeatureSet(l)?[]:l.load().then(()=>l.queryAttachments(a[0].field(l.objectIdField),
g,q,m))}if(null===a[0])return[];throw Error("Invalid Parameter");})},c.signatures.push({name:"attachments",min:"1",max:"2"}),c.functions.featuresetbyrelationshipname=function(f,p){return c.standardFunctionAsync(f,p,(b,n,a)=>{d.pcCheck(a,2,4);const g=a[0],q=d.toString(a[1]);let m=d.defaultUndefined(a[2],null);const l=d.toBoolean(d.defaultUndefined(a[3],!0));null===m&&(m=["*"]);if(!1===d.isArray(m))throw Error("Invalid Parameter");if(null===a[0])return null;if(!(a[0]instanceof L))throw Error("Invalid Parameter");
b=g._layer;b instanceof P&&(b=B.constructFeatureSet(b,f.spatialReference,["*"],!0,f.lrucache));return null===b||!1===d.isFeatureSet(b)?null:b.load().then(e=>{const k=e.relationshipMetaData().filter(x=>x.name===q);if(0===k.length)return null;if(void 0!==k[0].relationshipTableId&&null!==k[0].relationshipTableId&&-1<k[0].relationshipTableId)return B.constructFeatureSetFromRelationship(e,k[0],g.field(e.objectIdField),e.spatialReference,m,l,f.lrucache);let h=e.serviceUrl();if(!h)return null;h="/"===h.charAt(h.length-
1)?h+k[0].relatedTableId.toString():h+"/"+k[0].relatedTableId.toString();return B.constructFeatureSetFromUrl(h,e.spatialReference,m,l,f.lrucache).then(x=>x.load().then(()=>x.relationshipMetaData()).then(t=>{t=t.filter(y=>y.id===k[0].id);if(!1===g.hasField(k[0].keyField)||null===g.field(k[0].keyField))return e.getFeatureByObjectId(g.field(e.objectIdField),[k[0].keyField]).then(y=>{if(y){const G=z.WhereClause.create(t[0].keyField+"\x3d @id",x.getFieldsIndex());G.parameters={id:y.attributes[k[0].keyField]};
return x.filter(G)}return new ca({parentfeatureset:x})});const w=z.WhereClause.create(t[0].keyField+"\x3d @id",x.getFieldsIndex());w.parameters={id:g.field(k[0].keyField)};return x.filter(w)}))})})},c.signatures.push({name:"featuresetbyrelationshipname",min:"2",max:"4"}),c.functions.featuresetbyassociation=function(f,p){return c.standardFunctionAsync(f,p,(b,n,a)=>{d.pcCheck(a,2,3);const g=a[0],q=d.toString(d.defaultUndefined(a[1],"")).toLowerCase(),m=d.isString(a[2])?d.toString(a[2]):null;if(null===
a[0])return null;if(!(a[0]instanceof L))throw Error("Invalid Parameter");let l=g._layer;l instanceof P&&(l=B.constructFeatureSet(l,f.spatialReference,["*"],!0,f.lrucache));return null===l||!1===d.isFeatureSet(l)?null:l.load().then(()=>{const e=l.serviceUrl();return B.constructAssociationMetaDataFeatureSetFromUrl(e,f.spatialReference)}).then(e=>{var k=null,h=null;let x=!1;if(null!==m&&""!==m&&void 0!==m){for(var t of e.terminals)t.terminalName===m&&(h=t.terminalId);null===h&&(x=!0)}var w=e.associations.getFieldsIndex();
t=w.get("TOGLOBALID").name;const y=w.get("FROMGLOBALID").name,G=w.get("TOTERMINALID").name,S=w.get("FROMTERMINALID").name,I=w.get("FROMNETWORKSOURCEID").name,J=w.get("TONETWORKSOURCEID").name;var E=w.get("ASSOCIATIONTYPE").name;const ha=w.get("ISCONTENTVISIBLE").name,ia=w.get("OBJECTID").name;for(var K of l.fields)if("global-id"===K.type){k=g.field(K.name);break}let F=null;K=new v.SqlExpressionAdapted(new H({name:"percentalong",alias:"percentalong",type:"double"}),z.WhereClause.create("0",e.associations.getFieldsIndex()));
let Z=new v.SqlExpressionAdapted(new H({name:"side",alias:"side",type:"string"}),z.WhereClause.create("''",e.associations.getFieldsIndex()));var u={};for(var D in e.lkp)u[D]=e.lkp[D].sourceId;D=new v.StringToCodeAdapted(new H({name:"classname",alias:"classname",type:"string"}),null,u);u="";switch(q){case "midspan":u=`((${t}='${k}') OR ( ${y}='${k}')) AND (${E} IN (5))`;D.codefield=z.WhereClause.create(`CASE WHEN (${t}='${k}') THEN ${I} ELSE ${J} END`,e.associations.getFieldsIndex());h=N.cloneField(v.AdaptedFeatureSet.findField(e.associations.fields,
y));h.name="globalid";h.alias="globalid";F=new v.SqlExpressionAdapted(h,z.WhereClause.create(`CASE WHEN (${y}='${k}') THEN ${t} ELSE ${y} END`,e.associations.getFieldsIndex()));K=4<=e.unVersion?new v.OriginalField(v.AdaptedFeatureSet.findField(e.associations.fields,w.get("PERCENTALONG").name)):new v.SqlExpressionAdapted(new H({name:"percentalong",alias:"percentalong",type:"double"}),z.WhereClause.create("0",e.associations.getFieldsIndex()));break;case "junctionedge":u=`((${t}='${k}') OR ( ${y}='${k}')) AND (${E} IN (4,6))`;
D.codefield=z.WhereClause.create(`CASE WHEN (${t}='${k}') THEN ${I} ELSE ${J} END`,e.associations.getFieldsIndex());h=N.cloneField(v.AdaptedFeatureSet.findField(e.associations.fields,y));h.name="globalid";h.alias="globalid";F=new v.SqlExpressionAdapted(h,z.WhereClause.create(`CASE WHEN (${y}='${k}') THEN ${t} ELSE ${y} END`,e.associations.getFieldsIndex()));Z=new v.SqlExpressionAdapted(new H({name:"side",alias:"side",type:"string"}),z.WhereClause.create(`CASE WHEN (${E}=4) THEN 'from' ELSE 'to' END`,
e.associations.getFieldsIndex()));break;case "connected":w=`${t}='@T'`;E=`${y}='@T'`;null!==h&&(w+=` AND ${G}=@A`,E+=` AND ${S}=@A`);u="(("+w+") OR ("+E+"))";u=d.multiReplace(u,"@T",k);w=d.multiReplace(w,"@T",k);null!==h&&(w=d.multiReplace(w,"@A",h.toString()),u=d.multiReplace(u,"@A",h.toString()));D.codefield=z.WhereClause.create("CASE WHEN "+w+` THEN ${I} ELSE ${J} END`,e.associations.getFieldsIndex());k=N.cloneField(v.AdaptedFeatureSet.findField(e.associations.fields,y));k.name="globalid";k.alias=
"globalid";F=new v.SqlExpressionAdapted(k,z.WhereClause.create("CASE WHEN "+w+` THEN ${y} ELSE ${t} END`,e.associations.getFieldsIndex()));break;case "container":u=`${t}='${k}' AND ${E} = 2`,null!==h&&(u+=` AND ${G} = `+h.toString()),D.codefield=I,u="( "+u+" )",F=new v.FieldRename(v.AdaptedFeatureSet.findField(e.associations.fields,y),"globalid","globalid");case "content":u=`(${y}='${k}' AND ${E} = 2)`;null!==h&&(u+=` AND ${S} = `+h.toString());D.codefield=J;u="( "+u+" )";F=new v.FieldRename(v.AdaptedFeatureSet.findField(e.associations.fields,
t),"globalid","globalid");break;case "structure":u=`(${t}='${k}' AND ${E} = 3)`;null!==h&&(u+=` AND ${G} = `+h.toString());D.codefield=I;u="( "+u+" )";F=new v.FieldRename(v.AdaptedFeatureSet.findField(e.associations.fields,y),"globalid","globalId");break;case "attached":u=`(${y}='${k}' AND ${E} = 3)`;null!==h&&(u+=` AND ${S} = `+h.toString());D.codefield=J;u="( "+u+" )";F=new v.FieldRename(v.AdaptedFeatureSet.findField(e.associations.fields,t),"globalid","globalId");break;default:throw Error("Invalid Parameter");
}x&&(u="1 \x3c\x3e 1");return new v.AdaptedFeatureSet({parentfeatureset:e.associations,adaptedFields:[new v.OriginalField(v.AdaptedFeatureSet.findField(e.associations.fields,ia)),new v.OriginalField(v.AdaptedFeatureSet.findField(e.associations.fields,ha)),F,Z,D,K],extraFilter:u?z.WhereClause.create(u,e.associations.getFieldsIndex()):null})})})},c.signatures.push({name:"featuresetbyassociation",min:"2",max:"6"}),c.functions.groupby=function(f,p){return c.standardFunctionAsync(f,p,(b,n,a)=>{d.pcCheck(a,
3,3);return d.isFeatureSet(a[0])?a[0].load().then(g=>{const q=[],m=[];var l=!1,e=[];if(d.isString(a[1]))e.push(a[1]);else if(a[1]instanceof C)e.push(a[1]);else if(d.isArray(a[1]))e=a[1];else if(d.isImmutableArray(a[1]))e=a[1].toArray();else return c.failDefferred("Illegal Value: GroupBy");for(var k of e)if(d.isString(k)){e=z.WhereClause.create(d.toString(k),g.getFieldsIndex());var h=!0===V.isSingleField(e)?d.toString(k):"%%%%FIELDNAME";q.push({name:h,expression:e});"%%%%FIELDNAME"===h&&(l=!0)}else if(k instanceof
C){e=k.hasField("name")?k.field("name"):"%%%%FIELDNAME";h=k.hasField("expression")?k.field("expression"):"";"%%%%FIELDNAME"===e&&(l=!0);if(!e)return c.failDefferred("Illegal Value: GroupBy");q.push({name:e,expression:z.WhereClause.create(h?h:e,g.getFieldsIndex())})}else return c.failDefferred("Illegal Value: GroupBy");e=[];if(d.isString(a[2]))e.push(a[2]);else if(d.isArray(a[2]))e=a[2];else if(d.isImmutableArray(a[2]))e=a[2].toArray();else if(a[2]instanceof C)e.push(a[2]);else return c.failDefferred("Illegal Value: GroupBy");
for(const t of e)if(t instanceof C){k=t.hasField("name")?t.field("name"):"";e=t.hasField("statistic")?t.field("statistic"):"";h=t.hasField("expression")?t.field("expression"):"";if(!k||!e||!h)return c.failDefferred("Illegal Value: GroupBy");m.push({name:k,statistic:e.toLowerCase(),expression:z.WhereClause.create(h,g.getFieldsIndex())})}else return c.failDefferred("Illegal Value: GroupBy");if(l){l={};for(const t of g.fields)l[t.name.toLowerCase()]=1;for(const t of q)"%%%%FIELDNAME"!==t.name&&(l[t.name.toLowerCase()]=
1);for(const t of m)"%%%%FIELDNAME"!==t.name&&(l[t.name.toLowerCase()]=1);g=0;for(var x of q)if("%%%%FIELDNAME"===x.name){for(;1===l["field_"+g.toString()];)g++;l["field_"+g.toString()]=1;x.name="FIELD_"+g.toString()}}x=[];for(const t of q)x.push(Q(t.expression,c,f));for(const t of m)x.push(Q(t.expression,c,f));return 0<x.length?A.all(x).then(()=>A.resolve(a[0].groupby(q,m))):A.resolve(a[0].groupby(q,m))}):c.failDefferred("Illegal Value: GroupBy")})},c.signatures.push({name:"groupby",min:"3",max:"3"}),
c.functions.distinct=function(f,p){return c.standardFunctionAsync(f,p,(b,n,a)=>d.isFeatureSet(a[0])?(d.pcCheck(a,2,2),a[0].load().then(g=>{const q=[];var m=[];if(d.isString(a[1]))m.push(a[1]);else if(a[1]instanceof C)m.push(a[1]);else if(d.isArray(a[1]))m=a[1];else if(d.isImmutableArray(a[1]))m=a[1].toArray();else return c.failDefferred("Illegal Value: GroupBy");var l=!1;for(const h of m)if(d.isString(h)){m=z.WhereClause.create(d.toString(h),g.getFieldsIndex());var e=!0===V.isSingleField(m)?d.toString(h):
"%%%%FIELDNAME";q.push({name:e,expression:m});"%%%%FIELDNAME"===e&&(l=!0)}else if(h instanceof C){m=h.hasField("name")?h.field("name"):"%%%%FIELDNAME";e=h.hasField("expression")?h.field("expression"):"";"%%%%FIELDNAME"===m&&(l=!0);if(!m)return c.failDefferred("Illegal Value: GroupBy");q.push({name:m,expression:z.WhereClause.create(e?e:m,g.getFieldsIndex())})}else return c.failDefferred("Illegal Value: GroupBy");if(l){l={};for(const h of g.fields)l[h.name.toLowerCase()]=1;for(const h of q)"%%%%FIELDNAME"!==
h.name&&(l[h.name.toLowerCase()]=1);g=0;for(var k of q)if("%%%%FIELDNAME"===k.name){for(;1===l["field_"+g.toString()];)g++;l["field_"+g.toString()]=1;k.name="FIELD_"+g.toString()}}k=[];for(const h of q)k.push(Q(h.expression,c,f));return 0<k.length?A.all(k).then(()=>A.resolve(a[0].groupby(q,[]))):A.resolve(a[0].groupby(q,[]))})):fa("distinct",b,n,a))})};Object.defineProperty(T,"__esModule",{value:!0})});