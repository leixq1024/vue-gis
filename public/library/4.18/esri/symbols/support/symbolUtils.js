// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.18/esri/copyright.txt for details.
//>>built
define("require exports ../../core/has ../../core/maybe ../../support/arcadeOnDemand ./utils".split(" "),function(r,t,B,p,x,u){async function v(a,b){switch(a.type){case "web-style":var {previewWebStyleSymbol:c}=await new Promise(function(d,f){r(["./previewWebStyleSymbol"],d,f)});return c(a,v,b);case "label-3d":case "line-3d":case "mesh-3d":case "point-3d":case "polygon-3d":return{previewSymbol3D:c}=await new Promise(function(d,f){r(["./previewSymbol3D"],d,f)}),c(a,b);case "simple-marker":case "simple-line":case "simple-fill":case "picture-marker":case "picture-fill":case "text":return{previewSymbol2D:c}=
await new Promise(function(d,f){r(["./previewSymbol2D"],d,f)}),c(a,b);case "cim":return{previewCIMSymbol:c}=await new Promise(function(d,f){r(["./previewCIMSymbol"],d,f)}),c(a,b)}}function w(a){return a&&"opacity"in a?a.opacity*w(a.parent):1}let q=null;t.getDisplayedSymbol=async function(a,b){if(a){var c=w(a.layer||a.sourceLayer);if(p.isSome(a.symbol)&&(!p.isSome(b)||!0!==b.ignoreGraphicSymbol))return a="web-style"===a.symbol.type?await a.symbol.fetchSymbol(p.isSome(b)?b.abortOptions:null):a.symbol.clone(),
u.applyColorToSymbol(a,null,c),a;var d=p.isSome(b)&&b.renderer||a.get("layer.renderer")||a.get("sourceLayer.renderer"),f=await d.getSymbolAsync(a);if(f){f="web-style"===f.type?await f.fetchSymbol(p.isSome(b)?b.abortOptions:null):f.clone();if(!("visualVariables"in d)||"visualVariables"in d&&!d.visualVariables||"visualVariables"in d&&d.visualVariables&&!d.visualVariables.length)return f;d.arcadeRequiredForVisualVariables&&(p.isNone(b)||p.isNone(b.arcade))&&(b={...p.unwrap(b)},b.arcade=await x.loadArcade());
var m=await new Promise(function(g,n){r(["../../renderers/visualVariables/support/visualVariableUtils"],g,n)}),l=[],e=[],k=[],h=[];for(const g of d.visualVariables)switch(g.type){case "color":l.push(g);break;case "opacity":e.push(g);break;case "rotation":h.push(g);break;case "size":g.target||k.push(g)}d=(d=!!l.length&&l[l.length-1])?m.getColor(d,a,b):null;e=(e=!!e.length&&e[e.length-1])?m.getOpacity(e,a,b):null;null!=c&&(e=null!=e?e*c:c);u.applyColorToSymbol(f,d,e);k.length&&(c=m.getAllSizes(k,a,
b),await u.applySizesToSymbol(f,c));for(const g of h)u.applyRotationToSymbol(f,m.getRotationAngle(g,a,b),g.axis);return f}}};t.renderColorRampPreviewHTML=function(a,b={}){const c="horizontal"===b.align,{width:d=c?75:24,height:f=c?24:75,gradient:m=!0}=b;b=window.devicePixelRatio;var l=d*b,e=f*b;b=document.createElement("canvas");b.width=l;b.height=e;b.style.width=`${d}px`;b.style.height=`${f}px`;const k=b.getContext("2d");var h=c?l:0,g=c?0:e;if(m){const n=k.createLinearGradient(0,0,h,g),y=1/(a.length-
1);a.forEach((z,A)=>n.addColorStop(A*y,z.toString()));k.fillStyle=n;k.fillRect(0,0,l,e)}else{l=c?l/a.length:l;e=c?e:e/a.length;g=h=0;for(const n of a)k.fillStyle=n.toString(),k.fillRect(h,g,l,e),h=c?h+l:0,g=c?0:g+e}a=document.createElement("div");a.style.width=`${d}px`;a.style.height=`${f}px`;a.appendChild(b);return a};t.renderDotDensityPreviewHTML=function(a,b,c){const {backgroundColor:d,outline:f,dotSize:m}=a;c=c&&c.swatchSize||22;const l=Math.round(c*c/Math.pow(m,2)*.8),e=window.devicePixelRatio;
a=document.createElement("canvas");const k=c*e;a.width=k;a.height=k;a.style.width=`${a.width/e}px`;a.style.height=`${a.height/e}px`;const h=a.getContext("2d");d&&(h.fillStyle=d.toCss(!0),h.fillRect(0,0,k,k),h.fill());h.fillStyle=b.toCss(!0);if(q&&q.length/2===l)for(b=0;b<2*l;b+=2)h.fillRect(q[b],q[b+1],m*e,m*e),h.fill();else for(q=[],b=0;b<2*l;b+=2){const g=Math.floor(Math.random()*(k-0+1)),n=Math.floor(Math.random()*(k-0+1));q.push(g,n);h.fillRect(g,n,m*e,m*e);h.fill()}f&&(f.color&&(h.strokeStyle=
f.color.toCss(!0)),h.lineWidth=f.width,h.strokeRect(0,0,k,k));c=new Image(c,c);c.src=a.toDataURL();return c};t.renderPreviewHTML=v;Object.defineProperty(t,"__esModule",{value:!0})});