// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.18/esri/copyright.txt for details.
//>>built
define("exports ../../core/has ../../core/maybe ../../core/Logger ../../core/Error ../../core/promiseUtils ../../core/screenUtils ./IconSymbol3DLayerResource ../../assets ./ObjectSymbol3DLayerResource ../../core/colorUtils ./styleUtils ./gfxUtils ./utils ./previewUtils ./renderUtils".split(" "),function(A,da,y,R,I,x,w,S,J,T,K,U,L,M,u,B){function z(a){const b=a.outline;var c=y.isSome(a.material)?a.material.color:null;c=y.isSome(c)?c.toRgba().toString():null;if(y.isNone(b))return"fill"===a.type&&"255,255,255,1"===
c?{color:"#bdc3c7",width:.75}:null;a=w.pt2px(b.size)||0;return{color:"rgba("+(y.isSome(b.color)?b.color.toRgba():"255,255,255,1")+")",width:Math.min(a,80)}}function V(a,b){var c=b&&b.resource;c=c&&c.href;return a.thumbnail&&a.thumbnail.url?x.resolve(a.thumbnail.url):c&&"object"!==b.type?x.resolve(M.getIconHref(a,b)):a.styleOrigin&&(a.styleOrigin.styleName||a.styleOrigin.styleUrl)?U.resolveWebStyleSymbol(a.styleOrigin,{portal:a.styleOrigin.portal},"webRef").catch(e=>e).then(e=>e&&e.thumbnail&&e.thumbnail.url||
N):x.resolve(N)}function G(a,b=1){const c=a.a;a=K.toHSV(a);const {r:e,g:r,b:v}=K.toRGB({h:a.h,s:a.s/b,v:100-(100-a.v)/b});return[e,r,v,c]}function C(a){return"water"===a.type?y.isNone(a.color)?null:a.color:y.isNone(a.material)||y.isNone(a.material.color)?null:a.material.color}function g(a,b=0){a=C(a);if(!a)return b=u.adjustColorComponentBrightness(L.defaultThematicColor.r,b),[b,b,b,100];a=a.toRgba();for(let c=0;3>c;c++)a[c]=u.adjustColorComponentBrightness(a[c],b);return a}async function O(a,b){a=
a.style;return"none"===a?null:{type:"pattern",x:0,y:0,src:await L.getPatternUrlWithColor(`${W}${a}.png`,b.toCss(!0)),width:5,height:5}}function P(a){return a.outline?z(a):{color:"rgba(0, 0, 0, 1)",width:1.5}}function Q(a,b){a=C(a);if(!a)return null;let c;c="rgba("+(u.adjustColorComponentBrightness(a.r,b)+",");c+=u.adjustColorComponentBrightness(a.g,b)+",";c+=u.adjustColorComponentBrightness(a.b,b)+",";return c+a.a+");"}function H(a,b){b=Q(a,b);if(!b)return{};a=Math.min(a.size?w.pt2px(a.size):.75,
80);return{color:b,width:a}}function D(a,b,c){c*=.75;return{type:"linear",x1:c?.25*c:0,y1:c?.5*c:0,x2:c||4,y2:c?.5*c:4,colors:[{color:a,offset:0},{color:b,offset:1}]}}function X(a){const b=a.depth,c=a.height;return(a=a.width)&&b&&c&&a===b&&a<c}function Y(a,b,c){const e=[];if(!a)return e;switch(a.type){case "icon":switch(a.resource&&a.resource.primitive||S.defaultPrimitive){case "circle":e.push({shape:{type:"circle",cx:0,cy:0,r:.5*b},fill:g(a,0),stroke:z(a)});break;case "square":e.push({shape:{type:"path",
path:[{command:"M",values:[0,b]},{command:"L",values:[0,0]},{command:"L",values:[b,0]},{command:"L",values:[b,b]},{command:"Z",values:[]}]},fill:g(a,0),stroke:z(a)});break;case "triangle":e.push({shape:{type:"path",path:[{command:"M",values:[0,b]},{command:"L",values:[.5*b,0]},{command:"L",values:[b,b]},{command:"Z",values:[]}]},fill:g(a,0),stroke:z(a)});break;case "cross":e.push({shape:{type:"path",path:[{command:"M",values:[.5*b,0]},{command:"L",values:[.5*b,b]},{command:"M",values:[0,.5*b]},{command:"L",
values:[b,.5*b]}]},stroke:P(a)});break;case "x":e.push({shape:{type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[b,b]},{command:"M",values:[b,0]},{command:"L",values:[0,b]}]},stroke:P(a)});break;case "kite":e.push({shape:{type:"path",path:[{command:"M",values:[0,.5*b]},{command:"L",values:[.5*b,0]},{command:"L",values:[b,.5*b]},{command:"L",values:[.5*b,b]},{command:"Z",values:[]}]},fill:g(a,0),stroke:z(a)})}break;case "object":switch(a.resource&&a.resource.primitive||T.defaultPrimitive){case "cone":var r=
g(a,0);a=g(a,-.6);a=D(r,a,c?20:b);b=u.getConeShapes(b,c);e.push({shape:b[0],fill:a});e.push({shape:b[1],fill:a});break;case "inverted-cone":c=g(a,0);a=g(a,-.6);a=D(c,a,b);b=u.getInvertedConeShapes(b);e.push({shape:b[0],fill:a});e.push({shape:b[1],fill:c});break;case "cube":b=u.getCubeShapes(b,c);e.push({shape:b[0],fill:g(a,0)});e.push({shape:b[1],fill:g(a,-.3)});e.push({shape:b[2],fill:g(a,-.5)});break;case "cylinder":{r=g(a,0);const v=g(a,-.6);r=D(r,v,c?20:b);b=u.getCylinderShapes(b,c);e.push({shape:b[0],
fill:r});e.push({shape:b[1],fill:r});e.push({shape:b[2],fill:g(a,0)});break}case "diamond":b=u.getDiamondShapes(b);e.push({shape:b[0],fill:g(a,-.3)});e.push({shape:b[1],fill:g(a,0)});e.push({shape:b[2],fill:g(a,-.3)});e.push({shape:b[3],fill:g(a,-.7)});break;case "sphere":c=g(a,0);a=g(a,-.6);a=D(c,a);a.x1=0;a.y1=0;a.x2=.25*b;a.y2=.25*b;e.push({shape:{type:"circle",cx:0,cy:0,r:.5*b},fill:a});break;case "tetrahedron":b=u.getTetrahedronShapes(b),e.push({shape:b[0],fill:g(a,-.3)}),e.push({shape:b[1],
fill:g(a,0)}),e.push({shape:b[2],fill:g(a,-.6)})}}return e}function Z(a,b){const c=b&&b.size?w.pt2px(b.size):null,e=b&&b.maxSize?w.pt2px(b.maxSize):null,r=b&&b.disableUpsampling,v=a.symbolLayers,p=[];let m=0,q=0;const d=v.getItemAt(v.length-1);let l;d&&"icon"===d.type&&(l=d.size&&w.pt2px(d.size));v.forEach(f=>{if("icon"===f.type||"object"===f.type){var k="icon"===f.type?f.size&&w.pt2px(f.size):0,h=c||k?Math.ceil(Math.min(c||k,e||120)):22;if(f&&f.resource&&f.resource.href){var t=V(a,f).then(function(n){const E=
f.get("material.color");var F="icon"===f.type?"multiply":"tint";return B.tintImageWithColor(n,h,E,F,r)}).then(function(n){const E=n.width,F=n.height;m=Math.max(m,E);q=Math.max(q,F);return[{shape:{type:"image",x:0,y:0,width:E,height:F,src:n.url},fill:null,stroke:null}]});p.push(t)}else{let n=h;"icon"===f.type&&l&&c&&(n=k/l*h);k="tall"===(null==b?void 0:b.symbolConfig)||(null==b?void 0:null==(t=b.symbolConfig)?void 0:t.isTall)||("object"===f.type?X(f):!1);m=Math.max(m,k?20:n);q=Math.max(q,n);p.push(x.resolve(Y(f,
n,k)))}}});return x.eachAlways(p).then(function(f){const k=[];f.forEach(function(h){h.value?k.push(h.value):h.error&&aa.warn("error while building swatchInfo!",h.error)});return B.renderSymbol(k,[m,q],{node:b&&b.node,scale:!1,opacity:b&&b.opacity})})}function ba(a,b){const c=a.symbolLayers,e=[];a=M.isVolumetricSymbol(a);const r=b&&b.size?w.pt2px(b.size):null,v=(b&&b.maxSize?w.pt2px(b.maxSize):null)||80;let p=0,m=0,q;c.forEach((d,l)=>{if(d&&("line"===d.type||"path"===d.type)){var f=[];switch(d.type){case "line":var k=
H(d,0),h=k&&k.width||0;0===l&&(q=h);d=Math.min(r||h,v);l=0===l?d:r?h/q*d:d;h=20<l?2*l:40;m=Math.max(m,l);p=Math.max(p,h);k.width=l;f.push({shape:{type:"path",path:[{command:"M",values:[0,.5*m]},{command:"L",values:[p,.5*m]}]},stroke:k});break;case "path":k=Math.min(r||22,v);l=g(d,0);h=g(d,-.2);var t=Q(d,-.4);t=t?{color:t,width:1}:{};if("quad"===d.profile){const n=d.width||d.size;d=d.height||d.size;d=u.getPathSymbolShapes(n&&d?n/d:1);t={...t,join:"bevel"};f.push({shape:d[0],fill:h,stroke:t});f.push({shape:d[1],
fill:h,stroke:t});f.push({shape:d[2],fill:l,stroke:t})}else f.push({shape:u.shapes.pathSymbol3DLayer[0],fill:h,stroke:t}),f.push({shape:u.shapes.pathSymbol3DLayer[1],fill:l,stroke:t});p=m=Math.max(m,k)}e.push(f)}});return x.resolve(B.renderSymbol(e,[p,m],{node:b&&b.node,scale:a,opacity:b&&b.opacity}))}async function ca(a,b){const c="mesh-3d"===a.type;a=a.symbolLayers;var e=b&&b.size?w.pt2px(b.size):null;const r=b&&b.maxSize?w.pt2px(b.maxSize):null;e=e||22;const v=[];let p=0,m=0;var q=!1;for(let t=
0;t<a.length;t++){var d=a.getItemAt(t);const n=[];if(!c||"fill"===d.type){var l=u.shapes.fill[0];switch(d.type){case "fill":var f=z(d);q=Math.min(e,r||120);p=Math.max(p,q);m=Math.max(m,q);q=!0;var k=g(d,0),h="pattern"in d&&d.pattern;d=C(d);!c&&y.isSome(h)&&"style"===h.type&&"solid"!==h.style&&d&&(k=await O(h,d));n.push({shape:l,fill:k,stroke:f});break;case "line":d={stroke:H(d,0),shape:l};p=Math.max(p,22);m=Math.max(m,22);n.push(d);break;case "extrude":l={join:"round",...H(d,-.4)};f=g(d,0);d=g(d,
-.2);k=Math.min(e,r||120);h=u.getExtrudeSymbolShapes(k);l.width=1;n.push({shape:h[0],fill:d,stroke:l});n.push({shape:h[1],fill:d,stroke:l});n.push({shape:h[2],fill:f,stroke:l});d=22*.7+.5*k;p=Math.max(p,22);m=Math.max(m,d);break;case "water":q=C(d),d=G(q),l=G(q,2),f=G(q,3),k=u.getWaterSymbolShapes(),q=!0,n.push({shape:k[0],fill:d}),n.push({shape:k[1],fill:l}),n.push({shape:k[2],fill:f}),d=Math.min(e,r||120),p=Math.max(p,d),m=Math.max(m,d)}v.push(n)}}return x.resolve(B.renderSymbol(v,[p,m],{node:b&&
b.node,scale:q,opacity:b&&b.opacity}))}const W=J.getAssetUrl("esri/symbols/patterns/"),N=J.getAssetUrl("esri/images/Legend/legend3dsymboldefault.png"),aa=R.getLogger("esri.symbols.support.previewSymbol3D");A.getPatternDescriptor=O;A.getSymbolLayerFill=g;A.previewSymbol3D=function(a,b){if(0===a.symbolLayers.length)return x.reject(new I("symbolPreview: renderPreviewHTML3D","No symbolLayers in the symbol."));let c=null;switch(a.type){case "point-3d":c=Z(a,b);break;case "line-3d":c=ba(a,b);break;case "polygon-3d":case "mesh-3d":c=
ca(a,b)}return c?c:x.reject(new I("symbolPreview: swatchInfo3D","symbol not supported."))};Object.defineProperty(A,"__esModule",{value:!0})});