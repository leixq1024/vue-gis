// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.18/esri/copyright.txt for details.
//>>built
define("exports ../../core/Error ../../core/urlUtils ../../chunks/persistableUrlUtils ../../core/promiseUtils ../../request ../../portal/PortalQueryParams ../../portal/Portal ./StyleOrigin ./Thumbnail ../../chunks/symbols ../../core/devEnvironmentUtils ../../support/featureFlags".split(" "),function(m,n,h,w,q,D,E,F,x,y,r,t,G){function H(a,b){return u(a,b).then(c=>({data:c.data,baseUrl:h.removeFile(a),styleUrl:a}))}function I(a,b,c){b=b.portal||F.getDefault();let d;const e=`${b.url} - ${b.user&&b.user.username} - ${a}`;
v[e]||(v[e]=J(a,b,c).then(f=>{d=f;return f.fetchData()}).then(f=>({data:f,baseUrl:d.itemUrl,styleName:a})));return v[e]}function J(a,b,c){return b.load(c).then(()=>{const d=new E({disableExtraQuery:!0,query:`owner:${"esri_en"} AND type:${"Style"} AND typekeywords:"${a}"`});return b.queryItems(d,c)}).then(({results:d})=>{let e=null;const f=a.toLowerCase();if(d&&Array.isArray(d))for(const k of d)if(k.typeKeywords.some(l=>l.toLowerCase()===f)&&"Style"===k.type&&"esri_en"===k.owner){e=k;break}if(!e)throw new n("symbolstyleutils:style-not-found",
`The style '${a}' could not be found`,{styleName:a});return e.load(c)})}function z(a,b,c){return a.styleUrl?H(a.styleUrl,c):a.styleName?I(a.styleName,b,c):q.reject(new n("symbolstyleutils:style-url-and-name-missing","Either styleUrl or styleName is required to resolve a style"))}function A(a,b,c,d,e){var f=a.data;const k={portal:c.portal,url:h.urlToObject(a.baseUrl),origin:"portal-item"};f=f.items.find(g=>g.name===b);if(!f)return q.reject(new n("symbolstyleutils:symbol-name-not-found",`The symbol name '${b}' could not be found`,
{symbolName:b}));let l=w.fromJSON(K(f,d),k),p=f.thumbnail&&f.thumbnail.href;const B=f.thumbnail&&f.thumbnail.imageData;t.isDevEnvironment()&&(l=t.adjustStaticAGOUrl(l),p=t.adjustStaticAGOUrl(p));const L={portal:c.portal,url:h.urlToObject(h.removeFile(l)),origin:"portal-item"};return u(l,e).then(g=>{g="cimRef"===d?C(g.data):g.data;if((g=r.fromJSON(g,L))&&r.isSymbol3D(g)){if(p){const M=w.fromJSON(p,k);g.thumbnail=new y["default"]({url:M})}else B&&(g.thumbnail=new y["default"]({url:`data:image/png;base64,${B}`}));
a.styleUrl?g.styleOrigin=new x({portal:c.portal,styleUrl:a.styleUrl,name:b}):a.styleName&&(g.styleOrigin=new x({portal:c.portal,styleName:a.styleName,name:b}))}return g})}function C(a){return null===a||"CIMSymbolReference"===a.type?a:{type:"CIMSymbolReference",symbol:a}}function K(a,b){if("cimRef"===b)return a.cimRef;if(a.formatInfos&&!G.enableWebStyleForceWOSR())for(const c of a.formatInfos)if("gltf"===c.type)return c.href;return a.webRef}function N(a,b,c){const d="https://cdn.arcgis.com/sharing/rest/content/items/220936cc6ed342c9937abd8f180e7d1e/resources/styles/cim/{SymbolName}.json?f\x3djson".replace(/\{SymbolName\}/gi,
a.name);return u(d,c).then(e=>{e=C(e.data);return r.fromJSON(e,{portal:b.portal,url:h.urlToObject(h.removeFile(d)),origin:"portal-item"})})}function u(a,b){b={responseType:"json",query:{f:"json"},...b};return D(h.normalize(a),b)}const v={};m.fetchStyle=z;m.fetchSymbolFromStyle=A;m.resolveWebStyleSymbol=function(a,b,c,d){return a.name?a.styleName&&"Esri2DPointSymbolsStyle"===a.styleName?N(a,b,d):z(a,b,d).then(e=>A(e,a.name,b,c,d)):q.reject(new n("symbolstyleutils:style-symbol-reference-name-missing",
"Missing name in style symbol reference"))};m.styleNameFromItem=function(a){for(const b of a.typeKeywords)if(/^Esri.*Style$/.test(b)&&"Esri Style"!==b)return b};Object.defineProperty(m,"__esModule",{value:!0})});