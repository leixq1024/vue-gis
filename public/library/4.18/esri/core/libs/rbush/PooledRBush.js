// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.18/esri/copyright.txt for details.
//>>built
define("exports ../../../chunks/_rollupPluginBabelHelpers ../../maybe ../../arrayUtils ../../PooledArray ../../../chunks/quickselect".split(" "),function(x,D,E,F,q,P){function t(g,e){u(g,0,g.children.length,e,g)}function u(g,e,b,a,c){c||(c=new y([]));c.minX=Infinity;c.minY=Infinity;c.maxX=-Infinity;c.maxY=-Infinity;for(let d=e,f;d<b;d++)f=g.children[d],v(c,g.leaf?a(f):f);return c}function v(g,e){g.minX=Math.min(g.minX,e.minX);g.minY=Math.min(g.minY,e.minY);g.maxX=Math.max(g.maxX,e.maxX);g.maxY=Math.max(g.maxY,
e.maxY)}function K(g,e){return g.minX-e.minX}function L(g,e){return g.minY-e.minY}function G(g){return(g.maxX-g.minX)*(g.maxY-g.minY)}function z(g){return g.maxX-g.minX+(g.maxY-g.minY)}function H(g,e){return g.minX<=e.minX&&g.minY<=e.minY&&e.maxX<=g.maxX&&e.maxY<=g.maxY}function A(g,e){return e.minX<=g.maxX&&e.minY<=g.maxY&&e.maxX>=g.minX&&e.maxY>=g.minY}function M(g,e,b,a,c){for(e=[e,b];e.length;){b=E.assumeNonNull(e.pop());const d=E.assumeNonNull(e.pop());if(b-d<=a)continue;const f=d+Math.ceil((b-
d)/a/2)*a;P.quickselect(g,f,d,b,c);e.push(d,f,f,b)}}let N=function(){function g(b=9,a){this.compareMinX=K;this.compareMinY=L;this.toBBox=function(c){return c};this._maxEntries=Math.max(4,b||9);this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries));a&&("function"===typeof a?this.toBBox=a:this._initFormat(a));this.clear()}var e=g.prototype;e.destroy=function(){this.clear();r.prune();B.prune();n.prune();C.prune()};e.all=function(b){this._all(this.data,b)};e.search=function(b,a){let c=this.data;
const d=this.toBBox;if(A(b,c))for(r.clear();c;){for(let f=0,h=c.children.length;f<h;f++){const k=c.children[f],l=c.leaf?d(k):k;A(b,l)&&(c.leaf?a(k):H(b,l)?this._all(k,a):r.push(k))}c=r.pop()}};e.collides=function(b){let a=this.data;const c=this.toBBox;if(!A(b,a))return!1;for(r.clear();a;){for(let d=0,f=a.children.length;d<f;d++){const h=a.children[d],k=a.leaf?c(h):h;if(A(b,k)){if(a.leaf||H(b,k))return!0;r.push(h)}}a=r.pop()}return!1};e.load=function(b,a=b.length){if(!a)return this;if(a<this._minEntries){for(let c=
0,d=a;c<d;c++)this.insert(b[c]);return this}b=this._build(b.slice(0,a),0,a-1,0);this.data.children.length?this.data.height===b.height?this._splitRoot(this.data,b):(this.data.height<b.height&&(a=this.data,this.data=b,b=a),this._insert(b,this.data.height-b.height-1,!0)):this.data=b;return this};e.insert=function(b){b&&this._insert(b,this.data.height-1);return this};e.clear=function(){this.data=new y([]);return this};e.remove=function(b){if(!b)return this;let a=this.data,c=null,d=0,f=!1,h;const k=this.toBBox(b);
n.clear();for(C.clear();a||0<n.length;){if(!a){var l;a=E.assumeNonNull(n.pop());c=n.data[n.length-1];d=null!=(l=C.pop())?l:0;f=!0}if(a.leaf&&(h=F.indexOf(a.children,b,a.children.length,a.indexHint),-1!==h)){a.children.splice(h,1);n.push(a);this._condense(n);break}f||a.leaf||!H(a,k)?c?(d++,a=c.children[d],f=!1):a=null:(n.push(a),C.push(d),d=0,c=a,a=a.children[0])}return this};e.toJSON=function(){return this.data};e.fromJSON=function(b){this.data=b;return this};e._all=function(b,a){for(B.clear();b;){var c;
if(!0===b.leaf)for(const d of b.children)a(d);else B.pushArray(b.children);b=null!=(c=B.pop())?c:null}};e._build=function(b,a,c,d){var f=c-a+1,h=this._maxEntries;if(f<=h)return b=new y(b.slice(a,c+1)),t(b,this.toBBox),b;d||(d=Math.ceil(Math.log(f)/Math.log(h)),h=Math.ceil(f/Math.pow(h,d-1)));const k=new I([]);k.height=d;f=Math.ceil(f/h);h=f*Math.ceil(Math.sqrt(h));for(M(b,a,c,h,this.compareMinX);a<=c;a+=h){const l=Math.min(a+h-1,c);M(b,a,l,f,this.compareMinY);for(let m=a;m<=l;m+=f)k.children.push(this._build(b,
m,Math.min(m+f-1,l),d-1))}t(k,this.toBBox);return k};e._chooseSubtree=function(b,a,c,d){for(;;){d.push(a);if(!0===a.leaf||d.length-1===c)break;let f=Infinity,h=Infinity,k=void 0;for(let l=0,m=a.children.length;l<m;l++){const p=a.children[l],w=G(p),J=(Math.max(p.maxX,b.maxX)-Math.min(p.minX,b.minX))*(Math.max(p.maxY,b.maxY)-Math.min(p.minY,b.minY))-w;J<h?(h=J,f=w<f?w:f,k=p):J===h&&w<f&&(f=w,k=p)}a=k||a.children[0]}return a};e._insert=function(b,a,c){var d=this.toBBox;c=c?b:d(b);n.clear();d=this._chooseSubtree(c,
this.data,a,n);d.children.push(b);for(v(d,c);0<=a;)if(n.data[a].children.length>this._maxEntries)this._split(n,a),a--;else break;this._adjustParentBBoxes(c,n,a)};e._split=function(b,a){const c=b.data[a];var d=c.children.length;const f=this._minEntries;this._chooseSplitAxis(c,f,d);(d=this._chooseSplitIndex(c,f,d))?(d=c.children.splice(d,c.children.length-d),d=c.leaf?new y(d):new I(d),d.height=c.height,t(c,this.toBBox),t(d,this.toBBox),a?b.data[a-1].children.push(d):this._splitRoot(c,d)):console.log("  Error: assertion failed at PooledRBush._split: no valid split index")};
e._splitRoot=function(b,a){this.data=new I([b,a]);this.data.height=b.height+1;t(this.data,this.toBBox)};e._chooseSplitIndex=function(b,a,c){let d,f,h=void 0;d=f=Infinity;for(let l=a;l<=c-a;l++){var k=u(b,0,l,this.toBBox);const m=u(b,l,c,this.toBBox),p=Math.max(0,Math.min(k.maxX,m.maxX)-Math.max(k.minX,m.minX))*Math.max(0,Math.min(k.maxY,m.maxY)-Math.max(k.minY,m.minY));k=G(k)+G(m);p<d?(d=p,h=l,f=k<f?k:f):p===d&&k<f&&(f=k,h=l)}return h};e._chooseSplitAxis=function(b,a,c){const d=b.leaf?this.compareMinX:
K,f=b.leaf?this.compareMinY:L,h=this._allDistMargin(b,a,c,d);a=this._allDistMargin(b,a,c,f);h<a&&b.children.sort(d)};e._allDistMargin=function(b,a,c,d){b.children.sort(d);d=this.toBBox;var f=u(b,0,a,d);const h=u(b,c-a,c,d);let k=z(f)+z(h);for(let l=a;l<c-a;l++){const m=b.children[l];v(f,b.leaf?d(m):m);k+=z(f)}for(c=c-a-1;c>=a;c--)f=b.children[c],v(h,b.leaf?d(f):f),k+=z(h);return k};e._adjustParentBBoxes=function(b,a,c){for(;0<=c;c--)v(a.data[c],b)};e._condense=function(b){for(let a=b.length-1;0<=
a;a--){const c=b.data[a];if(0===c.children.length)if(0<a){const d=b.data[a-1],f=d.children;f.splice(F.indexOf(f,c,f.length,d.indexHint),1)}else this.clear();else t(c,this.toBBox)}};e._initFormat=function(b){const a=["return a"," - b",";"];this.compareMinX=new Function("a","b",a.join(b[0]));this.compareMinY=new Function("a","b",a.join(b[1]));this.toBBox=new Function("a","return {minX: a"+b[0]+", minY: a"+b[1]+", maxX: a"+b[2]+", maxY: a"+b[3]+"};")};return g}();const r=new q,B=new q,n=new q,C=new q({deallocator:void 0});
q=function(){this.minY=this.minX=Infinity;this.maxY=this.maxX=-Infinity};let O=function(g){function e(){var b=g.apply(this,arguments)||this;b.height=1;b.indexHint=new F.PositionHint;return b}D._inheritsLoose(e,g);return e}(q),y=function(g){function e(b){var a=g.call(this)||this;a.children=b;a.leaf=!0;return a}D._inheritsLoose(e,g);return e}(O),I=function(g){function e(b){var a=g.call(this)||this;a.children=b;a.leaf=!1;return a}D._inheritsLoose(e,g);return e}(O);x.BBox=q;x.PooledRBush=N;x.default=
N;Object.defineProperty(x,"__esModule",{value:!0})});