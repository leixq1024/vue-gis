// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.18/esri/copyright.txt for details.
//>>built
define("exports ./maybe ./nextTick ./PerformanceSampler ./PooledArray ./promiseUtils".split(" "),function(d,G,v,w,x,p){function H(a=performance.now()){c.rafId=null;0<f.length&&(c.rafId=q());c.executeFrameTasks(a)}function q(){return c.requestNextFrame?c.requestNextFrame(y):y()}function z(){f.forAll(a=>{a.removed&&m.push(a)});f.removeUnorderedMany(m.data,m.length);m.clear()}function A(){for(;r.length;){const a=G.assumeNonNull(r.shift());a.isActive&&a.callback()}c.willDispatch=!1}function y(){return requestAnimationFrame(H)}
let I=function(a){this.phases=a;this.paused=!1;this.ticks=-1;this.removed=!1},J=function(){function a(b){this.callback=b;this.isActive=!0}a.prototype.remove=function(){this.isActive=!1};return a}(),h=-1,t=0;const k={time:0,deltaTime:0,elapsedFrameTime:0,frameDuration:0},u=["prepare","preRender","render","postRender","update"],r=[],f=new x;let B=function(){function a(e){this._task=e}var b=a.prototype;b.remove=function(){this._task.removed=!0};b.pause=function(){this._task.paused=!0};b.resume=function(){this._task.paused=
!1};return a}();const c={frameTasks:f,rafId:null,requestNextFrame:null,willDispatch:!1,clearFrameTasks:function(a=!1){f.forAll(b=>{b.removed=!0});a&&z()},dispatch:A,executeFrameTasks:function(a=performance.now()){0>h&&(h=a);const b=a-h,e=0<t?t:1E3/60,n=Math.max(0,b-e);h=a;const K=performance.now();for(let l=0;l<u.length;l++){const L=performance.now(),C=u[l];f.forAll(g=>{var D;g.paused||g.removed||(0===l&&g.ticks++,g.phases[C]&&(k.time=a,k.deltaTime=0===g.ticks?0:b,k.elapsedFrameTime=performance.now()-
a,k.frameDuration=e-n,null==(D=g.phases[C])?void 0:D.call(g,k)))});E[l].record(performance.now()-L)}z();F.record(performance.now()-K)}},m=new x,E=u.map(a=>new w(a)),F=new w("total");d.FrameTaskHandle=B;d.addFrameTask=function(a){a=new I(a);f.push(a);c.rafId||(h=-1,c.rafId=q());return new B(a)};d.debug=c;d.performanceInfo=E;d.performanceTotal=F;d.requestNextFrame=q;d.schedule=function(a){a=new J(a);r.push(a);c.willDispatch||(c.willDispatch=!0,v(A));return a};d.setFrameDuration=function(a){t=Math.max(0,
a)};d.waitTicks=function(a=1,b){const e=p.createResolver(),n=()=>{p.isAborted(b)?e.reject(p.createAbortError()):0===a?e():(--a,v(()=>n()))};n();return e.promise};Object.defineProperty(d,"__esModule",{value:!0})});