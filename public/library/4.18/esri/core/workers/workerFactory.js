// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.18/esri/copyright.txt for details.
//>>built
define("exports ../has ../../config ../Logger ../urlUtils ../promiseUtils ../../intl/locale ../../request ../../intl ./utils ./loaderConfig ./WorkerFallback".split(" "),function(q,c,f,w,l,x,r,B,C,t,m,g){async function u(a){return x.create(v=>{function h(e){if(e=t.receiveMessage(e))switch(e.type){case y:e=a;if(null!=f["default"]){var b={...f};delete b["default"];b=JSON.parse(JSON.stringify(b))}else b=JSON.parse(JSON.stringify(f));b.assetsPath=l.makeAbsolute(b.assetsPath);b.locale=r.getLocale();b.has=
{"csp-restrictions":c("csp-restrictions"),"esri-2d-debug":!1,"esri-2d-update-debug":c("esri-2d-update-debug"),"esri-atomics":c("esri-atomics"),"esri-secure-context":c("esri-secure-context"),"esri-shared-array-buffer":c("esri-shared-array-buffer"),"esri-tiles-debug":c("esri-tiles-debug"),"esri-workers-arraybuffer-transfer":c("esri-workers-arraybuffer-transfer"),"host-webworker":1};b.workers.loaderUrl?b.workers.loaderUrl=l.makeAbsolute(b.workers.loaderUrl):m.DEFAULT_LOADER_URL&&(b.workers.loaderUrl=
m.DEFAULT_LOADER_URL);b.workers.workerPath=b.workers.workerPath?l.makeAbsolute(b.workers.workerPath):"esri/core/workers/RemoteClient";var d=f.workers.loaderConfig;d=m["default"]({baseUrl:null==d?void 0:d.baseUrl,locale:r.getLocale(),has:{"csp-restrictions":c("csp-restrictions"),"dojo-test-sniff":0,"host-webworker":1,...null==d?void 0:d.has},map:{...null==d?void 0:d.map},paths:{...null==d?void 0:d.paths},packages:(null==d?void 0:d.packages)||[]});e.postMessage({type:z,configure:{esriConfig:b,loaderConfig:d}});
break;case A:a.removeEventListener("message",h),a.removeEventListener("error",k),v(a)}}function k(e){e.preventDefault();a.removeEventListener("message",h);a.removeEventListener("error",k);n.warn("Failed to create Worker. Fallback to execute module in main thread",e);a=new g;a.addEventListener("message",h);a.addEventListener("error",k)}a.addEventListener("message",h);a.addEventListener("error",k)})}const n=w.getLogger("esri.core.workers");c.add("esri-workers-arraybuffer-transfer",!c("safari")||12<=
c("safari"));const {CONFIGURED:A,CONFIGURE:z,HANDSHAKE:y}=t.MessageType;let p;try{p=URL.createObjectURL(new Blob(['var esriConfig,workerPath,globalId\x3d0,outgoing\x3dnew Map,configured\x3d!1,HANDSHAKE\x3d0,CONFIGURE\x3d1,CONFIGURED\x3d2,OPEN\x3d3,OPENED\x3d4,RESPONSE\x3d5,INVOKE\x3d6,ABORT\x3d7;function createAbortError(){var e\x3dnew Error("Aborted");return e.name\x3d"AbortError",e}function receiveMessage(e){return e\x26\x26e.data?"string"\x3d\x3dtypeof e.data?JSON.parse(e.data):e.data:null}function invokeStaticMessage(e,r,t){var o\x3dt\x26\x26t.signal,n\x3dglobalId++;return new Promise((function(t,a){if(o){if(o.aborted)return a(createAbortError());o.addEventListener("abort",(function(){outgoing.get(n)\x26\x26(outgoing.delete(n),self.postMessage({type:ABORT,jobId:n}),a(createAbortError()))}))}outgoing.set(n,{resolve:t,reject:a}),self.postMessage({type:INVOKE,jobId:n,methodName:e,abortable:null!\x3do,data:r})}))}function messageHandler(e){var r\x3dreceiveMessage(e);if(r){var t\x3dr.jobId;switch(r.type){case CONFIGURE:var o\x3dr.configure;if(configured)return;configured\x3d!0,esriConfig\x3do.esriConfig,workerPath\x3desriConfig.workers.workerPath,self.dojoConfig\x3do.loaderConfig,esriConfig.workers.loaderUrl\x26\x26(self.importScripts(esriConfig.workers.loaderUrl),"function"\x3d\x3dtypeof require\x26\x26"function"\x3d\x3dtypeof require.config\x26\x26require.config(o.loaderConfig)),self.postMessage({type:CONFIGURED});break;case OPEN:var n;function a(e){var r\x3dn.connect(e);self.postMessage({type:OPENED,jobId:t,data:r},[r])}"function"\x3d\x3dtypeof define\x26\x26define.amd?require([workerPath],(function(e){(n\x3de.default||e).loadWorker(r.modulePath).then((function(e){return e||new Promise((function(e){require([r.modulePath],e)}))})).then(a)})):"System"in self\x26\x26"function"\x3d\x3dtypeof System.import?System.import(workerPath).then((function(e){return(n\x3de.default).loadWorker(r.modulePath)})).then((function(e){return e||System.import(r.modulePath)})).then(a):(self.RemoteClient||importScripts(workerPath),(n\x3dself.RemoteClient.default||self.RemoteClient).loadWorker(r.modulePath).then(a));break;case RESPONSE:if(outgoing.has(t)){var i\x3doutgoing.get(t);outgoing.delete(t),r.error?i.reject(JSON.parse(r.error)):i.resolve(r.data)}}}}self.addEventListener("message",messageHandler),self.postMessage({type:HANDSHAKE});'],
{type:"text/javascript"}))}catch(a){}q.createWorker=async function(){if(!c("esri-workers"))return u(new g);let a;if(p)try{a=new Worker(p)}catch(v){n.warn("Failed to create Worker. Fallback to execute module in main thread",event),a=new g}else n.warn("Failed to create Worker. Fallback to execute module in main thread",event),a=new g;return u(a)};Object.defineProperty(q,"__esModule",{value:!0})});