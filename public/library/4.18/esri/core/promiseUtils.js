// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.18/esri/copyright.txt for details.
//>>built
define("exports ./maybe ./Logger ./Error ./clock ./events".split(" "),function(f,m,J,C,K,D){function E(a){return Promise.all(a)}function n(a){return new Promise((b,c)=>{try{a(b,c)}catch(d){Promise.resolve().then(()=>c(d))}})}function p(a="Aborted"){return new C("AbortError",a)}function t(){return new AbortController}function F(a){if(G(a))throw p();}function u(a){return m.isSome(a)?"aborted"in a?a:a.signal:a}function G(a){a=u(a);return m.isSome(a)&&a.aborted}function v(a,b){a=u(a);if(!m.isNone(a))if(a.aborted)b();
else return D.once(a,"abort",()=>b())}function H(a,b){const c=u(b);return m.isNone(c)?a:n((d,e)=>{let g=v(b,()=>e(p()));const h=()=>g=m.removeMaybe(g);a.then(h,h);a.then(d,e)})}function r(a){return a&&"AbortError"===a.name}function y(){let a=null;const b=n((c,d)=>{a={promise:void 0,resolve:c,reject:d}});a.promise=b;return a}function z(a,b){if(a){if("function"!==typeof a.forEach){const d=Object.keys(a);b=d.map(e=>a[e]);return z(b).then(e=>{const g={};d.forEach((h,k)=>g[h]=e[k]);return g})}var c=w;
return H(n(d=>{const e=[];let g=a.length;0===g&&d(e);a.forEach(h=>{const k={promise:h||c(h)};e.push(k);k.promise.then(l=>{k.value=l}).catch(l=>{k.error=l}).then(()=>{--g;0===g&&d(e)})})}),b)}}function w(a){return Promise.resolve(a)}function I(a,b,c){const d=t();v(c,()=>d.abort());return n((e,g)=>{let h=setTimeout(()=>{h=0;e(b)},a);v(d,()=>{h&&(clearTimeout(h),g(p()))})})}function A(a){return a&&"object"===typeof a&&"then"in a&&"function"===typeof a.then?a:w(a)}const L=J.getLogger("esri");f.after=
I;f.all=E;f.always=function(a,b){return a.then(b,b)};f.create=n;f.createAbortController=t;f.createAbortError=p;f.createDeferred=y;f.createResolver=function(){let a,b;const c=n((e,g)=>{a=e;b=g}),d=e=>{a(e)};d.resolve=e=>a(e);d.reject=e=>b(e);d.timeout=(e,g)=>K["default"].setTimeout(()=>d.reject(g),e);d.promise=c;return d};f.createTask=function(a){let b=t();a=a(b.signal);let c={promise:a,finished:!1,abort:()=>{b&&(b.abort(),b=null)}};const d=()=>{c&&(c.finished=!0,c=null);b=null};a.then(d,d);return c};
f.debounce=function(a,b=-1){let c,d,e,g,h=null;const k=(...l)=>{if(c){d=l;g&&g.reject(p());g=y();l=m.assumeNonNull(g.promise);if(h){var x=h;h=null;x.abort()}return l}e=g||y();g=null;if(0<b){const q=t(),M=c=A(a(...l,q.signal));I(b).then(()=>{c===M&&(g?q.abort():h=q)})}else c=1,c=A(a(...l));l=()=>{const q=d;d=e=c=h=null;null!=q&&k(...q)};x=c;const B=e;x.then(l,l);x.then(B.resolve,B.reject);return m.assumeNonNull(B.promise)};return k};f.eachAlways=z;f.eachAlwaysValues=function(a){return z(a).then(b=>
b.filter(c=>!!c.value).map(c=>c.value))};f.filter=function(a,b){const c=a.slice();return E(a.map((d,e)=>b(d,e))).then(d=>c.filter((e,g)=>d[g]))};f.first=function(a){return a&&a.length?n((b,c)=>{for(const d of a)d.then(b,c)}):w()};f.ignoreAbortErrors=function(a){return a.catch(b=>{if(!r(b))throw b;})};f.isAbortError=r;f.isAborted=G;f.isPromiseLike=function(a){return a&&"function"===typeof a.then};f.isThenable=function(a){return a&&"function"===typeof a.then};f.logOnError=function(a,b=L){return a.catch(c=>
{r(c)||b.error(c)})};f.onAbort=v;f.onAbortOrThrow=function(a,b){a=u(a);if(!m.isNone(a))return F(a),D.once(a,"abort",()=>b(p()))};f.reject=function(a){return Promise.reject(a)};f.resolve=w;f.throwIfAbortError=function(a){if(r(a))throw a;};f.throwIfAborted=F;f.throwIfNotAbortError=function(a){if(!r(a))throw a;};f.timeout=function(a,b,c,d){const e=c&&"abort"in c?c:null;null!=d||e||(d=c);let g=setTimeout(()=>{g=0;e&&e.abort()},b);const h=()=>{throw d||new C("promiseUtils:timeout","The wrapped promise did not resolve within "+
b+" ms");};return a.then(k=>{if(0===g)throw h();clearTimeout(g);return k},k=>{clearTimeout(g);throw 0===g?h():k;})};f.when=A;f.whenOrAbort=H;Object.defineProperty(f,"__esModule",{value:!0})});