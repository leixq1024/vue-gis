// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.18/esri/copyright.txt for details.
//>>built
/*
 tabbable 5.1.4
 @license MIT, https://github.com/focus-trap/tabbable/blob/master/LICENSE
 focus-trap 6.2.2
 @license MIT, https://github.com/focus-trap/focus-trap/blob/master/LICENSE
*/
require({cache:{"esri/identity/IdentityManagerBase":function(){define("exports ../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/global ../core/has ../core/lang ../core/object ../config ../core/string ../core/Logger ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/property ../core/jsonMap ../core/accessorSupport/decorators/subclass ../core/Error ../core/urlUtils ../core/uuid ../portal/support/resourceExtension ../core/events ../core/promiseUtils ../core/Evented ../kernel ../request ../core/cookie ./IdentityForm ./IdentityModal ./OAuthCredential ./OAuthInfo ./ServerInfo".split(" "),
function(z,v,n,D,w,p,G,R,fa,ka,la,M,P,N,y,t,ha,ia,U,K,J,H,S,X,Y,O,ba,ca,Z){const V={},aa=Q=>{const h=(new t.Url(Q.owningSystemUrl)).host;Q=(new t.Url(Q.server)).host;const f=/.+\.arcgis\.com$/i;return f.test(h)&&f.test(Q)},da=(Q,h)=>!!(aa(Q)&&h&&h.some(f=>f.test(Q.server)));z.IdentityManagerBase=function(Q){function h(){var a=Q.call(this)||this;a._portalConfig=D.esriGeowConfig;a.serverInfos=[];a.oAuthInfos=[];a.credentials=[];a._soReqs=[];a._xoReqs=[];a._portals=[];a.defaultOAuthInfo=null;a.defaultTokenValidity=
60;a.dialog=null;a.formConstructor=Y;a.tokenValidity=null;a.signInPage=null;a.useSignInPage=!0;a.normalizeWebTierAuth=!1;a._busy=null;a._rejectOnPersistedPageShow=!1;a._oAuthHash=null;a._gwTokenUrl="/sharing/rest/generateToken";a._agsRest="/rest/services";a._agsPortal=/\/sharing(\/|$)/i;a._agsAdmin=/(https?:\/\/[^\/]+\/[^\/]+)\/admin\/?(\/.*)?$/i;a._adminSvcs=/\/rest\/admin\/services(\/|$)/i;a._gwDomains=[{regex:/^https?:\/\/www\.arcgis\.com/i,customBaseUrl:"maps.arcgis.com",tokenServiceUrl:"https://www.arcgis.com/sharing/rest/generateToken"},
{regex:/^https?:\/\/(?:dev|[a-z\d-]+\.mapsdev)\.arcgis\.com/i,customBaseUrl:"mapsdev.arcgis.com",tokenServiceUrl:"https://dev.arcgis.com/sharing/rest/generateToken"},{regex:/^https?:\/\/(?:devext|[a-z\d-]+\.mapsdevext)\.arcgis\.com/i,customBaseUrl:"mapsdevext.arcgis.com",tokenServiceUrl:"https://devext.arcgis.com/sharing/rest/generateToken"},{regex:/^https?:\/\/(?:qaext|[a-z\d-]+\.mapsqa)\.arcgis\.com/i,customBaseUrl:"mapsqa.arcgis.com",tokenServiceUrl:"https://qaext.arcgis.com/sharing/rest/generateToken"},
{regex:/^https?:\/\/[a-z\d-]+\.maps\.arcgis\.com/i,customBaseUrl:"maps.arcgis.com",tokenServiceUrl:"https://www.arcgis.com/sharing/rest/generateToken"}];a._legacyFed=[];a._regexSDirUrl=/http.+\/rest\/services\/?/gi;a._regexServerType=/(\/(FeatureServer|GPServer|GeoDataServer|GeocodeServer|GeoenrichmentServer|GeometryServer|GlobeServer|ImageServer|MapServer|MobileServer|NAServer|NetworkDiagramServer|ParcelFabricServer|RelationalCatalogServer|SceneServer|StreamServer|UtilityNetworkServer|ValidationServer|VectorTileServer|VersionManagementServer)).*/gi;
a._gwUser=/http.+\/users\/([^\/]+)\/?.*/i;a._gwItem=/http.+\/items\/([^\/]+)\/?.*/i;a._gwGroup=/http.+\/groups\/([^\/]+)\/?.*/i;a._rePortalTokenSvc=/\/sharing(\/rest)?\/generatetoken/i;a._createDefaultOAuthInfo=!0;a._hasTestedIfAppIsOnPortal=!1;a._getOAuthHash();window.addEventListener("pageshow",b=>{a._pageShowHandler(b)});return a}v._inheritsLoose(h,Q);var f=h.prototype;f.registerServers=function(a){const b=this.serverInfos;b?(a=a.filter(c=>!this.findServerInfo(c.server)),this.serverInfos=b.concat(a)):
this.serverInfos=a;a.forEach(c=>{c.owningSystemUrl&&this._portals.push(c.owningSystemUrl);c.hasPortal&&this._portals.push(c.server)})};f.registerOAuthInfos=function(a){const b=this.oAuthInfos;b?(a=a.filter(c=>!this.findOAuthInfo(c.portalUrl)),this.oAuthInfos=b.concat(a)):this.oAuthInfos=a};f.registerToken=function(a){a={...a};const b=this._sanitizeUrl(a.server),c=this._isServerRsrc(b);let d=this.findServerInfo(b),e=!0,m;d||(d=new Z,d.server=this._getServerInstanceRoot(b),c?d.hasServer=!0:(d.tokenServiceUrl=
this._getTokenSvcUrl(b),d.hasPortal=!0),this.registerServers([d]));(m=this._findCredential(b))?(delete a.server,p.mixin(m,a),e=!1):(m=new z.Credential({userId:a.userId,server:d.server,token:a.token,expires:a.expires,ssl:a.ssl,scope:c?"server":"portal"}),m.resources=[b],this.credentials.push(m));m.emitTokenChange(!1);e||m.refreshServerTokens()};f.toJSON=function(){return p.fixJson({serverInfos:this.serverInfos.map(a=>a.toJSON()),oAuthInfos:this.oAuthInfos.map(a=>a.toJSON()),credentials:this.credentials.map(a=>
a.toJSON())})};f.initialize=function(a){if(a){"string"===typeof a&&(a=JSON.parse(a));var b=a.serverInfos,c=a.oAuthInfos;a=a.credentials;if(b){const d=[];b.forEach(e=>{e.server&&e.tokenServiceUrl&&d.push(e.declaredClass?e:new Z(e))});d.length&&this.registerServers(d)}if(c){const d=[];c.forEach(e=>{e.appId&&d.push(e.declaredClass?e:new ca(e))});d.length&&this.registerOAuthInfos(d)}a&&a.forEach(d=>{d.server&&d.token&&d.expires&&d.expires>Date.now()&&(d=d.declaredClass?d:new z.Credential(d),d.emitTokenChange(),
this.credentials.push(d))})}};f.findServerInfo=function(a){let b;a=this._sanitizeUrl(a);for(const c of this.serverInfos)if(this._hasSameServerInstance(c.server,a)){b=c;break}return b};f.findOAuthInfo=function(a){let b;a=this._sanitizeUrl(a);for(const c of this.oAuthInfos)if(this._hasSameServerInstance(c.portalUrl,a)){b=c;break}return b};f.findCredential=function(a,b){let c,d;a=this._sanitizeUrl(a);d=this._isServerRsrc(a)?"server":"portal";if(b)for(const e of this.credentials){if(this._hasSameServerInstance(e.server,
a)&&b===e.userId&&e.scope===d){c=e;break}}else for(const e of this.credentials)if(this._hasSameServerInstance(e.server,a)&&-1!==this._getIdenticalSvcIdx(a,e)&&e.scope===d){c=e;break}return c};f.getCredential=function(a,b){let c=!0;if(b){var d=!!b.token;var e=b.error;c=!1!==b.prompt}b={...b};a=this._sanitizeUrl(a);const m=K.createAbortController(),k=K.createResolver();if(b.signal)K.onAbort(b.signal,()=>{m.abort()});K.onAbort(m,()=>{k.reject(new y("identity-manager:user-aborted","ABORTED"))});if(K.isAborted(m))return k.promise;
b.signal=m.signal;const x=this._isAdminResource(a);var g=d&&this._doPortalSignIn(a)?this._getEsriAuthCookie():null;if((d=d?this.findCredential(a):null)&&e&&e.details&&498===e.details.httpStatus)d.destroy(),g&&g.token===b.token&&(X.writeCookie("esri_auth",null,{expires:-1,path:"/",domain:document.domain}),window.location.hostname.endsWith(".arcgis.com")&&X.writeCookie("esri_auth",null,{expires:-1,path:"/",domain:"arcgis.com"}));else if(g||d)return a=new y("identity-manager:not-authorized","You are currently signed in as: '"+
(g&&g.email||d&&d.userId)+"'. You do not have access to this resource: "+a,{error:e}),k.reject(a),k.promise;if(e=this._findCredential(a,b))return k.resolve(e),k.promise;e=this.findServerInfo(a);if(e)!e.hasServer&&this._isServerRsrc(a)&&(e._restInfoPms=this._getTokenSvcUrl(a),e.hasServer=!0);else{g=this._getTokenSvcUrl(a);if(!g)return a=new y("identity-manager:unknown-resource","Unknown resource - could not find token service endpoint."),k.reject(a),k.promise;e=new Z;e.server=this._getServerInstanceRoot(a);
"string"===typeof g?(e.tokenServiceUrl=g,e.hasPortal=!0):(e._restInfoPms=g,e.hasServer=!0);this.registerServers([e])}c&&e.hasPortal&&void 0===e._selfReq&&!this._findOAuthInfo(a)&&(e._selfReq={owningTenant:b&&b.owningTenant,selfDfd:this._getPortalSelf(e.tokenServiceUrl.replace(this._rePortalTokenSvc,"/sharing/rest/portals/self"),a)});return this._enqueue(a,e,b,k,x)};f.getResourceName=function(a){return this._isRESTService(a)?a.replace(this._regexSDirUrl,"").replace(this._regexServerType,"")||"":this._gwUser.test(a)&&
a.replace(this._gwUser,"$1")||this._gwItem.test(a)&&a.replace(this._gwItem,"$1")||this._gwGroup.test(a)&&a.replace(this._gwGroup,"$1")||""};f.generateToken=function(a,b,c){const d=this._rePortalTokenSvc.test(a.tokenServiceUrl),e=new t.Url(window.location.href.toLowerCase()),m=this._getEsriAuthCookie();var k=a.shortLivedTokenValidity;let x,g,l,A,q,C,E,r;b&&(r=this.tokenValidity||k||this.defaultTokenValidity,r>k&&0<k&&(r=k));c&&(g=c.isAdmin,l=c.serverUrl,A=c.token,C=c.signal,E=c.ssl,a.customParameters=
c.customParameters);g?k=a.adminTokenServiceUrl:(k=a.tokenServiceUrl,q=new t.Url(k.toLowerCase()),m&&(x=(x=m.auth_tier)&&x.toLowerCase()),("web"===x||a.webTierAuth)&&c&&c.serverUrl&&!E&&"http"===e.scheme&&(t.hasSameOrigin(e.uri,k,!0)||"https"===q.scheme&&e.host===q.host&&"7080"===e.port&&"7443"===q.port)&&(k=k.replace(/^https:/i,"http:").replace(/:7443/i,":7080")));c=p.mixin({query:p.mixin({request:"getToken",username:b&&b.username,password:b&&b.password,serverUrl:l,token:A,expiration:r,referer:g||
d?window.location.host:null,client:g?"referer":null,f:"json"},a.customParameters),method:"post",authMode:"anonymous",useProxy:this._useProxy(a,c),signal:C},c&&c.ioArgs);d||(c.withCredentials=!1);return S(k,c).then(B=>{B=B.data;if(!B||!B.token)return new y("identity-manager:authentication-failed","Unable to generate token");const F=a.server;V[F]||(V[F]={});b&&(V[F][b.username]=b.password);B.validity=r;return B})};f.isBusy=function(){return!!this._busy};f.checkSignInStatus=function(a){return this.checkAppAccess(a,
"").then(b=>b.credential)};f.checkAppAccess=function(a,b,c){let d=!1;return this.getCredential(a,{prompt:!1}).then(e=>{let m;const k={f:"json"};if("portal"===e.scope)if(b&&(this._doPortalSignIn(a,!0)||c&&c.force))m=e.server+"/sharing/rest/oauth2/validateAppAccess",k.client_id=b;else if(e.token)m=e.server+"/sharing/rest";else return{credential:e};else if(e.token)m=e.server+"/rest/services";else return{credential:e};e.token&&(k.token=e.token);return S(m,{query:k,authMode:"anonymous"}).then(x=>{if(!1===
x.data.valid)throw new y("identity-manager:not-authorized",`You are currently signed in as: '${e.userId}'.`,x.data);d=!!x.data.viewOnlyUserTypeApp;return{credential:e}}).catch(x=>{if("identity-manager:not-authorized"===x.name)throw x;x=x.details&&x.details.httpStatus;if(498===x)throw e.destroy(),new y("identity-manager:not-authenticated","User is not signed in.");if(400===x)throw new y("identity-manager:invalid-request");return{credential:e}})}).then(e=>({credential:e.credential,viewOnly:d}))};f.setOAuthResponseHash=
function(a){var b;const c=this._oAuthDfd;this._oAuthDfd=null;if(c&&a)if(clearInterval(this._oAuthIntervalId),null==(b=this._oAuthOnHashHandle)?void 0:b.remove(),"#"===a.charAt(0)&&(a=a.substring(1)),a=t.queryToObject(a),a.error)b="access_denied"===a.error,a=new y(b?"identity-manager:user-aborted":"identity-manager:authentication-failed",b?"ABORTED":"OAuth: "+a.error+" - "+a.error_description),c.reject(a);else{b=c.oinfo_;const d=b._oAuthCred,e=new z.Credential({userId:a.username,server:c.sinfo_.server,
token:a.access_token,expires:Date.now()+1E3*Number(a.expires_in),ssl:"true"===a.ssl,_oAuthCred:d});b.userId=e.userId;d.storage=a.persist?window.localStorage:window.sessionStorage;d.token=e.token;d.expires=e.expires;d.userId=e.userId;d.ssl=e.ssl;d.save();c.resolve(e)}};f.setRedirectionHandler=function(a){this._redirectFunc=a};f.setOAuthRedirectionHandler=function(a){this._oAuthRedirectFunc=a};f.setProtocolErrorHandler=function(a){this._protocolFunc=a};f.signIn=function(a,b,c={}){const d=K.createResolver(),
e=()=>{var A,q,C,E,r;null==(A=x)?void 0:A.remove();null==(q=g)?void 0:q.remove();null==(C=l)?void 0:C.remove();null==(E=k)?void 0:E.destroy();null==(r=this.dialog)?void 0:r.destroy();this.dialog=k=x=g=l=null},m=()=>{e();this._oAuthDfd=null;d.reject(new y("identity-manager:user-aborted","ABORTED"))};if(c.signal)K.onAbort(c.signal,()=>{m()});let k=new this.formConstructor;k.resource=this.getResourceName(a);k.server=b.server;this.dialog=new O;this.dialog.content=k;this.dialog.open=!0;this.emit("dialog-create");
let x=k.on("cancel",m),g=this.dialog.watch("open",m),l=k.on("submit",A=>{this.generateToken(b,A,{isAdmin:c.isAdmin,signal:c.signal}).then(q=>{e();q=new z.Credential({userId:A.username,server:b.server,token:q.token,expires:null!=q.expires?Number(q.expires):null,ssl:!!q.ssl,isAdmin:c.isAdmin,validity:q.validity});d.resolve(q)}).catch(q=>{k.error=q;k.signingIn=!1})});return d.promise};f.oAuthSignIn=function(a,b,c,d){const e=this._oAuthDfd=K.createResolver();if(null!=d&&d.signal)K.onAbort(d.signal,()=>
{const q=this._oAuthDfd&&this._oAuthDfd.oAuthWin_;q&&!q.closed?q.close():this.dialog&&k()});e.resUrl_=a;e.sinfo_=b;e.oinfo_=c;d=!d||!1!==d.oAuthPopupConfirmation;if(!c.popup||!d)return this._doOAuthSignIn(a,b,c),e.promise;const m=new this.formConstructor;m.oAuthPrompt=!0;m.server=b.server;this.dialog=new O;this.dialog.content=m;this.dialog.open=!0;this.emit("dialog-create");const k=()=>{A();this._oAuthDfd=null;e.reject(new y("identity-manager:user-aborted","ABORTED"))},x=m.on("cancel",k),g=this.dialog.watch("open",
k),l=m.on("submit",()=>{A();this._doOAuthSignIn(a,b,c)}),A=()=>{x.remove();g.remove();l.remove();m.destroy();this.dialog.destroy();this.dialog=null};return e.promise};f.destroyCredentials=function(){this.credentials&&this.credentials.slice().forEach(a=>{a.destroy()});this.emit("credentials-destroy")};f._getOAuthHash=function(){var a=window.location.hash;if(a){"#"===a.charAt(0)&&(a=a.substring(1));a=t.queryToObject(a);let b=!1;a.access_token&&a.expires_in&&a.state&&a.hasOwnProperty("username")?(a.state=
JSON.parse(a.state),this._oAuthHash=a,b=!0):a.error&&a.error_description&&(console.log("IdentityManager OAuth Error: ",a.error," - ",a.error_description),"access_denied"===a.error&&(b=!0));b&&(window.location.hash="object"===typeof a.state&&a.state.hash||"")}};f._pageShowHandler=function(a){a.persisted&&this.isBusy()&&this._rejectOnPersistedPageShow&&(a=new y("identity-manager:user-aborted","ABORTED"),this._errbackFunc(a))};f._findCredential=function(a,b){let c=-1,d,e,m;const k=b&&b.token;b=b&&b.resource;
const x=this._isServerRsrc(a)?"server":"portal",g=this.credentials.filter(l=>this._hasSameServerInstance(l.server,a)&&l.scope===x);a=b||a;if(g.length)if(1===g.length)if(b=g[0],e=(d=(m=this.findServerInfo(b.server))&&m.owningSystemUrl)&&this.findCredential(d,b.userId),c=this._getIdenticalSvcIdx(a,b),k)-1!==c&&(b.resources.splice(c,1),this._removeResource(a,e));else return-1===c&&b.resources.push(a),this._addResource(a,e),b;else{let l,A;g.some(q=>{A=this._getIdenticalSvcIdx(a,q);return-1!==A?(l=q,e=
(d=(m=this.findServerInfo(l.server))&&m.owningSystemUrl)&&this.findCredential(d,l.userId),c=A,!0):!1});if(k)l&&(l.resources.splice(c,1),this._removeResource(a,e));else if(l)return this._addResource(a,e),l}};f._findOAuthInfo=function(a){let b=this.findOAuthInfo(a);if(!b)for(const c of this.oAuthInfos)if(this._isIdProvider(c.portalUrl,a)){b=c;break}return b};f._addResource=function(a,b){b&&-1===this._getIdenticalSvcIdx(a,b)&&b.resources.push(a)};f._removeResource=function(a,b){let c=-1;b&&(c=this._getIdenticalSvcIdx(a,
b),-1<c&&b.resources.splice(c,1))};f._useProxy=function(a,b){return b&&b.isAdmin&&!t.hasSameOrigin(a.adminTokenServiceUrl,window.location.href)||!this._isPortalDomain(a.tokenServiceUrl)&&"10.1"===String(a.currentVersion)&&!t.hasSameOrigin(a.tokenServiceUrl,window.location.href)};f._getOrigin=function(a){a=new t.Url(a);return a.scheme+"://"+a.host+(null!=a.port?":"+a.port:"")};f._getServerInstanceRoot=function(a){const b=a.toLowerCase();let c=b.indexOf(this._agsRest);-1===c&&this._isAdminResource(a)&&
(c=this._agsAdmin.test(a)?a.replace(this._agsAdmin,"$1").length:a.search(this._adminSvcs));-1===c&&(c=b.indexOf("/sharing"));-1===c&&"/"===b.substr(-1)&&(c=b.length-1);return-1<c?a.substring(0,c):a};f._hasSameServerInstance=function(a,b){"/"===a.substr(-1)&&(a=a.slice(0,-1));a=a.toLowerCase();b=this._getServerInstanceRoot(b).toLowerCase();a=this._normalizeAGOLorgDomain(a);b=this._normalizeAGOLorgDomain(b);a=a.substr(a.indexOf(":"));b=b.substr(b.indexOf(":"));return a===b};f._normalizeAGOLorgDomain=
function(a){const b=/^https?:\/\/(?:cdn|[a-z\d-]+\.maps)\.arcgis\.com/i,c=/^https?:\/\/(?:cdndev|[a-z\d-]+\.mapsdevext)\.arcgis\.com/i,d=/^https?:\/\/(?:cdnqa|[a-z\d-]+\.mapsqa)\.arcgis\.com/i;b.test(a)?a=a.replace(b,"https://www.arcgis.com"):c.test(a)?a=a.replace(c,"https://devext.arcgis.com"):d.test(a)&&(a=a.replace(d,"https://qaext.arcgis.com"));return a};f._sanitizeUrl=function(a){const b=(R.request.proxyUrl||"").toLowerCase(),c=b?a.toLowerCase().indexOf(b+"?"):-1;-1!==c&&(a=a.substring(c+b.length+
1));a=t.normalize(a);return t.urlToObject(a).path};f._isRESTService=function(a){return-1<a.indexOf(this._agsRest)};f._isAdminResource=function(a){return this._agsAdmin.test(a)||this._adminSvcs.test(a)};f._isServerRsrc=function(a){return this._isRESTService(a)||this._isAdminResource(a)};f._isIdenticalService=function(a,b){if(this._isRESTService(a)&&this._isRESTService(b)){a=this._getSuffix(a).toLowerCase();b=this._getSuffix(b).toLowerCase();var c=a===b;c||(c=/(.*)\/(MapServer|FeatureServer).*/gi,c=
a.replace(c,"$1")===b.replace(c,"$1"))}else this._isAdminResource(a)&&this._isAdminResource(b)?c=!0:this._isServerRsrc(a)||this._isServerRsrc(b)||!this._isPortalDomain(a)||(c=!0);return c};f._isPortalDomain=function(a){const b=new t.Url(a.toLowerCase());a=this._portalConfig;let c=this._gwDomains.some(d=>d.regex.test(b.uri));!c&&a&&(c=this._hasSameServerInstance(this._getServerInstanceRoot(a.restBaseUrl),b.uri));c||R.portalUrl&&(c=t.hasSameOrigin(b,R.portalUrl,!0));c||(c=this._portals.some(d=>this._hasSameServerInstance(d,
b.uri)));return c=c||this._agsPortal.test(b.path)};f._isIdProvider=function(a,b){let c=-1,d=-1;this._gwDomains.forEach((m,k)=>{-1===c&&m.regex.test(a)&&(c=k);-1===d&&m.regex.test(b)&&(d=k)});let e=!1;if(-1<c&&-1<d)if(0===c||4===c){if(0===d||4===d)e=!0}else if(1===c){if(1===d||2===d)e=!0}else 2===c?2===d&&(e=!0):3===c&&3===d&&(e=!0);if(!e){const m=this.findServerInfo(b),k=m&&m.owningSystemUrl;k&&aa(m)&&this._isPortalDomain(k)&&this._isIdProvider(a,k)&&(e=!0)}return e};f._getIdenticalSvcIdx=function(a,
b){let c=-1;for(let d=0;d<b.resources.length;d++)if(this._isIdenticalService(a,b.resources[d])){c=d;break}return c};f._getSuffix=function(a){return a.replace(this._regexSDirUrl,"").replace(this._regexServerType,"$1")};f._getTokenSvcUrl=function(a){if(this._isRESTService(a)||this._isAdminResource(a)){var b=this._getServerInstanceRoot(a);var c=b+"/admin/generateToken";a=b+"/rest/info";b=S(a,{query:{f:"json"}}).then(d=>d.data);return{adminUrl:c,promise:b}}if(this._isPortalDomain(a)){let d="";this._gwDomains.some(e=>
{e.regex.test(a)&&(d=e.tokenServiceUrl);return!!d});d||this._portals.some(e=>{this._hasSameServerInstance(e,a)&&(d=e+this._gwTokenUrl);return!!d});d||(c=a.toLowerCase().indexOf("/sharing"),-1!==c&&(d=a.substring(0,c)+this._gwTokenUrl));d||(d=this._getOrigin(a)+this._gwTokenUrl);d&&(c=(new t.Url(a)).port,/^http:\/\//i.test(a)&&"7080"===c&&(d=d.replace(/:7080/i,":7443")),d=d.replace(/http:/i,"https:"));return d}if(-1!==a.toLowerCase().indexOf("premium.arcgisonline.com"))return"https://premium.arcgisonline.com/server/tokens"};
f._exchangeToken=function(a,b,c){return S(`${a}/sharing/rest/oauth2/exchangeToken`,{authMode:"anonymous",method:"post",query:{f:"json",client_id:b,token:c}}).then(d=>d.data.token)};f._getPortalSelf=function(a,b){let c;this._gwDomains.some(d=>{d.regex.test(a)&&(c=d.customBaseUrl);return!!c});if(c)return K.resolve({allSSL:!0,currentVersion:"4.4",customBaseUrl:c,portalMode:"multitenant",supportsOAuth:!0});"https:"===window.location.protocol?a=a.replace(/^http:/i,"https:").replace(/:7080/i,":7443"):/^http:/i.test(b)&&
(a=a.replace(/^https:/i,"http:").replace(/:7443/i,":7080"));return S(a,{query:{f:"json"},authMode:"anonymous",withCredentials:!0}).then(d=>d.data)};f._hasPortalSession=function(){return!!this._getEsriAuthCookie()};f._getEsriAuthCookie=function(){let a=null;if(navigator.cookieEnabled){var b=this._getAllCookies("esri_auth");let c;for(let d=0;d<b.length;d++){const e=JSON.parse(b[d]);if(e.portalApp){a=e;break}c?c.push(e):c=[e]}if(!a&&c)for(const d of c)if(d.urlKey&&window.location.hostname===`${d.urlKey.toLowerCase()}.${d.customBaseUrl}`){a=
d;break}}a&&(b=null,a.expires&&("number"===typeof a.expires?b=a.expires:"string"===typeof a.expires&&(b=Date.parse(a.expires)),isNaN(b)&&(b=null),a.expires=b),b&&b<Date.now()&&(a=null));return a};f._getAllCookies=function(a){const b=[];if(a=document.cookie.match(new RegExp("(?:^|; )"+fa.escapeRegExpString(a)+"\x3d([^;]*)","g")))for(let c=0;c<a.length;c++){let d=a[c];const e=d.indexOf("\x3d");-1<e&&(d=d.substring(e+1),b.push(decodeURIComponent(d)))}return b};f._doPortalSignIn=function(a,b){if(navigator.cookieEnabled){const c=
this._getEsriAuthCookie(),d=this._portalConfig,e=window.location.href,m=this.findServerInfo(a);if((b||this.useSignInPage)&&(d||this._isPortalDomain(e)||c)&&(m?m.hasPortal||m.owningSystemUrl&&this._isPortalDomain(m.owningSystemUrl):this._isPortalDomain(a))&&(this._isIdProvider(e,a)||d&&(this._hasSameServerInstance(this._getServerInstanceRoot(d.restBaseUrl),a)||this._isIdProvider(d.restBaseUrl,a))||t.hasSameOrigin(e,a,!0)))return!0}return!1};f._canUsePortalSignInWorkflow=function(a){return this._doPortalSignIn(a)&&
(window===window.top||this._hasPortalSession())};f._checkProtocol=function(a,b,c,d){let e=!0;d=d?b.adminTokenServiceUrl:b.tokenServiceUrl;0===d.trim().toLowerCase().indexOf("https:")&&0!==window.location.href.toLowerCase().indexOf("https:")&&t.getProxyRule(d)&&(e=this._protocolFunc?!!this._protocolFunc({resourceUrl:a,serverInfo:b}):!1,e||(a=new y("identity-manager:aborted","Aborted the Sign-In process to avoid sending password over insecure connection."),c(a)));return e};f._enqueue=function(a,b,c,
d,e,m){d||(d=K.createResolver());d.resUrl_=a;d.sinfo_=b;d.options_=c;d.admin_=e;d.refresh_=m;this._busy?this._hasSameServerInstance(this._getServerInstanceRoot(a),this._busy.resUrl_)?(this._oAuthDfd&&this._oAuthDfd.oAuthWin_&&this._oAuthDfd.oAuthWin_.focus(),this._soReqs.push(d)):this._xoReqs.push(d):this._doSignIn(d);return d.promise};f._doSignIn=function(a){this._busy=a;this._rejectOnPersistedPageShow=!1;const b=g=>{var l=a.options_&&a.options_.resource;const A=a.resUrl_,q=a.refresh_;let C=!1;-1===
this.credentials.indexOf(g)&&(q&&-1!==this.credentials.indexOf(q)?(q.userId=g.userId,q.token=g.token,q.expires=g.expires,q.validity=g.validity,q.ssl=g.ssl,q.creationTime=g.creationTime,C=!0,g=q):this.credentials.push(g));g.resources||(g.resources=[]);g.resources.push(l||A);g.scope=this._isServerRsrc(A)?"server":"portal";g.emitTokenChange();l=this._soReqs;const E={};this._soReqs=[];l.forEach(r=>{if(!this._isIdenticalService(A,r.resUrl_)){const B=this._getSuffix(r.resUrl_);E[B]||(E[B]=!0,g.resources.push(r.resUrl_))}});
a.resolve(g);l.forEach(r=>{this._hasSameServerInstance(this._getServerInstanceRoot(A),r.resUrl_)?r.resolve(g):this._soReqs.push(r)});this._busy=a.resUrl_=a.sinfo_=a.refresh_=null;C||this.emit("credential-create",{credential:g});this._soReqs.length?this._doSignIn(this._soReqs.shift()):this._xoReqs.length&&this._doSignIn(this._xoReqs.shift())},c=g=>{a.reject(g);this._busy=a.resUrl_=a.sinfo_=a.refresh_=null;this._soReqs.length?this._doSignIn(this._soReqs.shift()):this._xoReqs.length&&this._doSignIn(this._xoReqs.shift())},
d=(g,l,A,q)=>{var C=a.sinfo_,E=!a.options_||!1!==a.options_.prompt,r=C.hasPortal&&this._findOAuthInfo(a.resUrl_);let B;if(this._canUsePortalSignInWorkflow(a.resUrl_))l=this._getEsriAuthCookie(),g=this._portalConfig,l?(C.webTierAuth||"web"!==(l.auth_tier&&l.auth_tier.toLowerCase())||(C.webTierAuth=!0),B=new z.Credential({userId:l.email,server:C.server,token:C.webTierAuth?null:l.token,expires:l.expires}),B.token?a._pendingDfd=this._exchangeToken(B.server,r?r.appId:"arcgisonline",B.token).then(F=>{B.token=
F;b(B)}).catch(()=>{b(B)}):b(B)):E?(r="",E=window.location.href,r=this.signInPage?this.signInPage:g?g.baseUrl+g.signin:this._isIdProvider(E,a.resUrl_)?this._getOrigin(E)+"/home/signin.html":C.tokenServiceUrl.replace(this._rePortalTokenSvc,"")+"/home/signin.html",r=r.replace(/http:/i,"https:"),g&&!1===g.useSSL&&(r=r.replace(/https:/i,"http:")),0===E.toLowerCase().replace("https","http").indexOf(r.toLowerCase().replace("https","http"))?(C=new y("identity-manager:unexpected-error","Cannot redirect to Sign-In page from within Sign-In page. URL of the resource that triggered this workflow: "+
a.resUrl_),c(C)):(this._rejectOnPersistedPageShow=!0,this._redirectFunc?this._redirectFunc({signInPage:r,returnUrlParamName:"returnUrl",returnUrl:E,resourceUrl:a.resUrl_,serverInfo:C}):window.location.href=r+"?returnUrl\x3d"+encodeURIComponent(E))):(C=new y("identity-manager:not-authenticated","User is not signed in."),c(C));else if(g)b(new z.Credential({userId:g,server:C.server,token:A,expires:null!=q?Number(q):null,ssl:!!l}));else if(r){let F=r._oAuthCred;F||(g=new ba(r,window.localStorage),l=new ba(r,
window.sessionStorage),g.isValid()&&l.isValid()?g.expires>l.expires?(F=g,l.destroy()):(F=l,g.destroy()):F=g.isValid()?g:l,r._oAuthCred=F);F.isValid()?(B=new z.Credential({userId:F.userId,server:C.server,token:F.token,expires:F.expires,ssl:F.ssl,_oAuthCred:F}),r.appId!==F.appId&&this._doPortalSignIn(a.resUrl_,!0)?a._pendingDfd=this._exchangeToken(B.server,r.appId,B.token).then(ja=>{B.token=ja;F.token=ja;F.save();b(B)}).catch(()=>{b(B)}):b(B)):this._oAuthHash&&this._oAuthHash.state.portalUrl===r.portalUrl?
(E=this._oAuthHash,B=new z.Credential({userId:E.username,server:C.server,token:E.access_token,expires:Date.now()+1E3*Number(E.expires_in),ssl:"true"===E.ssl,oAuthState:E.state,_oAuthCred:F}),r.userId=B.userId,F.storage=E.persist?window.localStorage:window.sessionStorage,F.token=B.token,F.expires=B.expires,F.userId=B.userId,F.ssl=B.ssl,F.save(),this._oAuthHash=null,b(B)):E?a._pendingDfd=this.oAuthSignIn(a.resUrl_,C,r,a.options_).then(b,c):(C=new y("identity-manager:not-authenticated","User is not signed in."),
c(C))}else E?this._checkProtocol(a.resUrl_,C,c,a.admin_)&&(r=a.options_,a.admin_&&(r=r||{},r.isAdmin=!0),a._pendingDfd=this.signIn(a.resUrl_,C,r).then(b,c)):(C=new y("identity-manager:not-authenticated","User is not signed in."),c(C))},e=()=>{const g=a.sinfo_;var l=g.owningSystemUrl;const A=a.options_;let q,C,E,r;A&&(q=A.token,C=A.error,E=A.prompt);r=this._findCredential(l,{token:q,resource:a.resUrl_});if(!r)for(const B of this.credentials)if(this._isIdProvider(l,B.server)){r=B;break}r?(l=this.findCredential(a.resUrl_,
r.userId))?b(l):da(g,this._legacyFed)?(l=r.toJSON(),l.server=g.server,l.resources=null,b(new z.Credential(l))):(a._pendingDfd=this.generateToken(this.findServerInfo(r.server),null,{serverUrl:a.resUrl_,token:r.token,signal:a.options_.signal,ssl:r.ssl})).then(B=>{b(new z.Credential({userId:r.userId,server:g.server,token:B.token,expires:null!=B.expires?Number(B.expires):null,ssl:!!B.ssl,isAdmin:a.admin_,validity:B.validity}))},c):(this._busy=null,q&&(a.options_.token=null),(a._pendingDfd=this.getCredential(l.replace(/\/?$/,
"/sharing"),{resource:a.resUrl_,owningTenant:g.owningTenant,signal:a.options_.signal,token:q,error:C,prompt:E})).then(()=>{this._enqueue(a.resUrl_,a.sinfo_,a.options_,a,a.admin_)},B=>{c(B)}))};this._errbackFunc=c;const m=a.sinfo_.owningSystemUrl,k=this._isServerRsrc(a.resUrl_),x=a.sinfo_._restInfoPms;x?x.promise.then(g=>{const l=a.sinfo_;l._restInfoPms&&(l.adminTokenServiceUrl=l._restInfoPms.adminUrl,l._restInfoPms=null,l.tokenServiceUrl=G.getDeepValue("authInfo.tokenServicesUrl",g)||G.getDeepValue("authInfo.tokenServiceUrl",
g)||G.getDeepValue("tokenServiceUrl",g),l.shortLivedTokenValidity=G.getDeepValue("authInfo.shortLivedTokenValidity",g),l.currentVersion=g.currentVersion,l.owningTenant=g.owningTenant,(g=l.owningSystemUrl=g.owningSystemUrl)&&this._portals.push(g));k&&l.owningSystemUrl?e():d()},()=>{a.sinfo_._restInfoPms=null;const g=new y("identity-manager:server-identification-failed","Unknown resource - could not find token service endpoint.");c(g)}):k&&m?e():a.sinfo_._selfReq?a.sinfo_._selfReq.selfDfd.then(g=>{const l=
{};let A,q,C,E;g&&(A=g.user&&g.user.username,l.username=A,l.allSSL=g.allSSL,q=g.supportsOAuth,C=g.currentVersion,"multitenant"===g.portalMode&&(E=g.customBaseUrl));a.sinfo_.webTierAuth=!!A;return A&&this.normalizeWebTierAuth?this.generateToken(a.sinfo_,null,{ssl:l.allSSL}).catch(()=>null).then(r=>{l.portalToken=r&&r.token;l.tokenExpiration=r&&r.expires;return l}):!A&&q&&4.4<=parseFloat(C)&&!this._canUsePortalSignInWorkflow(a.resUrl_)?this._generateOAuthInfo({portalUrl:a.sinfo_.server,customBaseUrl:E,
owningTenant:a.sinfo_._selfReq.owningTenant}).catch(()=>null).then(()=>l):l}).catch(()=>null).then(g=>{a.sinfo_._selfReq=null;g?d(g.username,g.allSSL,g.portalToken,g.tokenExpiration):d()}):d()};f._generateOAuthInfo=function(a){let b,c=a.portalUrl;const d=a.customBaseUrl,e=a.owningTenant;if(a=!this.defaultOAuthInfo&&this._createDefaultOAuthInfo&&!this._hasTestedIfAppIsOnPortal){b=window.location.href;let m=b.indexOf("?");-1<m&&(b=b.slice(0,m));m=b.search(/\/(apps|home)\//);b=-1<m?b.slice(0,m):null}a&&
b?(this._hasTestedIfAppIsOnPortal=!0,a=S(b+"/sharing/rest",{query:{f:"json"}}).then(()=>{this.defaultOAuthInfo=new ca({appId:"arcgisonline",popup:!0,popupCallbackUrl:b+"/home/oauth-callback.html"})})):a=K.resolve();return a.then(()=>{if(this.defaultOAuthInfo)return c=c.replace(/^http:/i,"https:"),S(c+"/sharing/rest/oauth2/validateRedirectUri",{query:{accountId:e,client_id:this.defaultOAuthInfo.appId,redirect_uri:t.makeAbsolute(this.defaultOAuthInfo.popupCallbackUrl),f:"json"}}).then(m=>{if(m.data.valid){const k=
this.defaultOAuthInfo.clone();k.portalUrl=m.data.urlKey&&d?"https://"+m.data.urlKey.toLowerCase()+"."+d:c;this.oAuthInfos.push(k)}})})};f._doOAuthSignIn=function(a,b,c){var d={portalUrl:c.portalUrl};!c.popup&&c.preserveUrlHash&&window.location.hash&&(d.hash=window.location.hash);d={client_id:c.appId,response_type:"token",state:JSON.stringify(d),expiration:c.expiration,locale:c.locale,redirect_uri:c.popup?t.makeAbsolute(c.popupCallbackUrl):window.location.href.replace(/#.*$/,"")};c.forceLogin&&(d.force_login=
!0);c.forceUserId&&c.userId&&(d.prepopulatedusername=c.userId);const e=c.portalUrl.replace(/^http:/i,"https:")+"/sharing/oauth2/authorize",m=e+"?"+t.objectToQuery(d);if(c.popup){const k=window.open(m,"esriJSAPIOAuth",c.popupWindowFeatures);k?(k.focus(),this._oAuthDfd.oAuthWin_=k,this._oAuthIntervalId=setInterval(()=>{if(k.closed){clearInterval(this._oAuthIntervalId);this._oAuthOnHashHandle.remove();const x=this._oAuthDfd;if(x){const g=new y("identity-manager:user-aborted","ABORTED");x.reject(g)}}},
500),this._oAuthOnHashHandle=U.on(D,"arcgis:auth:hash",x=>{this.setOAuthResponseHash(x.detail)})):(a=new y("identity-manager:popup-blocked","ABORTED"),this._oAuthDfd.reject(a))}else this._rejectOnPersistedPageShow=!0,this._oAuthRedirectFunc?this._oAuthRedirectFunc({authorizeParams:d,authorizeUrl:e,resourceUrl:a,serverInfo:b,oAuthInfo:c}):window.location.href=m};return h}(J);z.IdentityManagerBase=n.__decorate([N.subclass("esri.identity.IdentityManagerBase")],z.IdentityManagerBase);z.Credential=function(Q){function h(a){var b=
Q.call(this,a)||this;b._oAuthCred=null;b.tokenRefreshBuffer=2;a&&a._oAuthCred&&(b._oAuthCred=a._oAuthCred);return b}v._inheritsLoose(h,Q);var f=h.prototype;f.initialize=function(){this.resources=this.resources||[];null==this.creationTime&&(this.creationTime=Date.now())};f.refreshToken=function(){const a=H.id.findServerInfo(this.server),b=a&&a.owningSystemUrl,c=!!b&&"server"===this.scope,d=c&&da(a,H.id._legacyFed);var e=a.webTierAuth;const m=e&&H.id.normalizeWebTierAuth;var k=V[this.server];k=k&&k[this.userId];
let x=this.resources&&this.resources[0],g=c&&H.id.findServerInfo(b),l={username:this.userId,password:k},A;if(!e||m)if(c&&!g&&H.id.serverInfos.some(q=>{H.id._isIdProvider(b,q.server)&&(g=q);return!!g}),e=g&&H.id.findCredential(g.server,this.userId),!c||e)if(d)e.refreshToken();else{if(c)A={serverUrl:x,token:e&&e.token,ssl:e&&e.ssl};else if(m)l=null,A={ssl:this.ssl};else if(k)this.isAdmin&&(A={isAdmin:!0});else{let q;x&&(x=H.id._sanitizeUrl(x),this._enqueued=1,q=H.id._enqueue(x,a,null,null,this.isAdmin,
this),q.then(()=>{this._enqueued=0;this.refreshServerTokens()}).catch(()=>{this._enqueued=0}));return q}return H.id.generateToken(c?g:a,c?null:l,A).then(q=>{this.token=q.token;this.expires=null!=q.expires?Number(q.expires):null;this.creationTime=Date.now();this.validity=q.validity;this.emitTokenChange();this.refreshServerTokens()}).catch(()=>{})}};f.refreshServerTokens=function(){"portal"===this.scope&&H.id.credentials.forEach(a=>{const b=H.id.findServerInfo(a.server),c=b&&b.owningSystemUrl;a!==this&&
a.userId===this.userId&&c&&"server"===a.scope&&(H.id._hasSameServerInstance(this.server,c)||H.id._isIdProvider(c,this.server))&&(da(b,H.id._legacyFed)?(a.token=this.token,a.expires=this.expires,a.creationTime=this.creationTime,a.validity=this.validity,a.emitTokenChange()):a.refreshToken())})};f.emitTokenChange=function(a){clearTimeout(this._refreshTimer);var b=this.server&&H.id.findServerInfo(this.server);const c=(b=b&&b.owningSystemUrl)&&H.id.findServerInfo(b);!1===a||b&&"portal"!==this.scope&&(!c||
!c.webTierAuth||H.id.normalizeWebTierAuth)||null==this.expires&&null==this.validity||this._startRefreshTimer();this.emit("token-change")};f.destroy=function(){this.userId=this.server=this.token=this.expires=this.validity=this.resources=this.creationTime=null;this._oAuthCred&&(this._oAuthCred.destroy(),this._oAuthCred=null);const a=H.id.credentials.indexOf(this);-1<a&&H.id.credentials.splice(a,1);this.emitTokenChange();this.emit("destroy")};f.toJSON=function(){const a=p.fixJson({userId:this.userId,
server:this.server,token:this.token,expires:this.expires,validity:this.validity,ssl:this.ssl,isAdmin:this.isAdmin,creationTime:this.creationTime,scope:this.scope}),b=this.resources;b&&0<b.length&&(a.resources=b.slice());return a};f._startRefreshTimer=function(){clearTimeout(this._refreshTimer);const a=6E4*this.tokenRefreshBuffer;let b=(this.validity?this.creationTime+6E4*this.validity:this.expires)-Date.now();0>b&&(b=0);this._refreshTimer=setTimeout(this.refreshToken.bind(this),b>a?b-a:b)};return h}(J.EventedAccessor);
n.__decorate([M.property()],z.Credential.prototype,"creationTime",void 0);n.__decorate([M.property()],z.Credential.prototype,"expires",void 0);n.__decorate([M.property()],z.Credential.prototype,"isAdmin",void 0);n.__decorate([M.property()],z.Credential.prototype,"oAuthState",void 0);n.__decorate([M.property()],z.Credential.prototype,"resources",void 0);n.__decorate([M.property()],z.Credential.prototype,"scope",void 0);n.__decorate([M.property()],z.Credential.prototype,"server",void 0);n.__decorate([M.property()],
z.Credential.prototype,"ssl",void 0);n.__decorate([M.property()],z.Credential.prototype,"token",void 0);n.__decorate([M.property()],z.Credential.prototype,"tokenRefreshBuffer",void 0);n.__decorate([M.property()],z.Credential.prototype,"userId",void 0);n.__decorate([M.property()],z.Credential.prototype,"validity",void 0);z.Credential=n.__decorate([N.subclass("esri.identity.Credential")],z.Credential);Object.defineProperty(z,"__esModule",{value:!0})})},"esri/core/cookie":function(){define(["exports",
"./maybe"],function(z,v){z.writeCookie=function(n,D,w={}){let p=v.assumeNonNull(w.expires);if("number"===typeof p){const G=new Date;G.setTime(G.getTime()+864E5*p);p=w.expires=G}"string"!==typeof p&&(w.expires=p.toUTCString());n=n+"\x3d"+encodeURIComponent(D);for(const G in w)n+="; "+G,D=w[G],!0!==D&&(n+="\x3d"+D);document.cookie=n};Object.defineProperty(z,"__esModule",{value:!0})})},"esri/identity/IdentityForm":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/has ../core/Logger ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/property ../core/jsonMap ../core/accessorSupport/decorators/subclass ../core/urlUtils ../core/uuid ../portal/support/resourceExtension ../intl/substitute ../widgets/support/widgetUtils ../widgets/support/decorators/messageBundle ../widgets/support/decorators/renderable ../chunks/index ../widgets/Widget".split(" "),
function(z,v,n,D,w,p,G,R,fa,ka,la,M,P,N,y,t,ha){n=function(ia){function U(J,H){J=ia.call(this,J,H)||this;J._usernameInputNode=null;J._passwordInputNode=null;J.messages=null;J.signingIn=!1;J.server=null;J.resource=null;J.error=null;J.oAuthPrompt=!1;return J}z._inheritsLoose(U,ia);var K=U.prototype;K.render=function(){const {error:J,server:H,resource:S,signingIn:X,oAuthPrompt:Y,messages:O}=this,ba=t.jsx("div",{class:"esri-identity-form__group"},M.substitute(Y?O.oAuthInfo:O.info,{server:/\.arcgis\.com/i.test(H)?
"ArcGIS Online":H,resource:`(${S||O.lblItem})`})),ca=Y?null:t.jsx("div",{class:"esri-identity-form__group"},t.jsx("label",{class:"esri-identity-form__label"},O.lblUser,t.jsx("input",{value:"",required:!0,autocomplete:"off",spellcheck:!1,type:"text",bind:this,afterCreate:P.storeNode,"data-node-ref":"_usernameInputNode",class:"esri-input"}))),Z=Y?null:t.jsx("div",{class:"esri-identity-form__group"},t.jsx("label",{class:"esri-identity-form__label"},O.lblPwd,t.jsx("input",{value:"",required:!0,type:"password",
bind:this,afterCreate:P.storeNode,"data-node-ref":"_passwordInputNode",class:"esri-input"}))),V=t.jsx("div",{class:this.classes("esri-identity-form__group","esri-identity-form__footer")},t.jsx("input",{type:"submit",disabled:!!X,value:X?O.lblSigning:O.lblOk,class:"esri-button"}),t.jsx("input",{type:"button",value:O.lblCancel,bind:this,onclick:this._cancel,class:this.classes("esri-button","esri-button--secondary")})),aa=J?t.jsx("div",null,J.details&&J.details.httpStatus?O.invalidUser:O.noAuthService):
null;return t.jsx("form",{class:"esri-identity-form",bind:this,onsubmit:this._submit},ba,aa,ca,Z,V)};K._cancel=function(){this._set("signingIn",!1);this._usernameInputNode&&(this._usernameInputNode.value="");this._passwordInputNode&&(this._passwordInputNode.value="");this.emit("cancel")};K._submit=function(J){J.preventDefault();this._set("signingIn",!0);this.emit("submit",this.oAuthPrompt?{}:{username:this._usernameInputNode&&this._usernameInputNode.value,password:this._passwordInputNode&&this._passwordInputNode.value})};
return U}(ha);v.__decorate([p.property(),y.renderable(),N.messageBundle("esri/identity/t9n/identity")],n.prototype,"messages",void 0);v.__decorate([p.property(),y.renderable()],n.prototype,"signingIn",void 0);v.__decorate([p.property(),y.renderable()],n.prototype,"server",void 0);v.__decorate([p.property(),y.renderable()],n.prototype,"resource",void 0);v.__decorate([p.property(),y.renderable()],n.prototype,"error",void 0);v.__decorate([p.property(),y.renderable()],n.prototype,"oAuthPrompt",void 0);
return n=v.__decorate([R.subclass("esri.identity.IdentityForm")],n)})},"esri/identity/IdentityModal":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/has ../core/Logger ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/property ../core/jsonMap ../core/accessorSupport/decorators/subclass ../core/urlUtils ../core/uuid ../portal/support/resourceExtension ../widgets/support/decorators/messageBundle ../widgets/support/decorators/renderable ../chunks/index ../widgets/support/widget ../widgets/Widget".split(" "),
function(z,v,n,D,w,p,G,R,fa,ka,la,M,P,N,y,t){function ha(h,f){var a=Object.keys(h);if(Object.getOwnPropertySymbols){var b=Object.getOwnPropertySymbols(h);f&&(b=b.filter(function(c){return Object.getOwnPropertyDescriptor(h,c).enumerable}));a.push.apply(a,b)}return a}function ia(h){for(var f=1;f<arguments.length;f++){var a=null!=arguments[f]?arguments[f]:{};f%2?ha(Object(a),!0).forEach(function(b){var c=a[b];b in h?Object.defineProperty(h,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):h[b]=
c}):Object.getOwnPropertyDescriptors?Object.defineProperties(h,Object.getOwnPropertyDescriptors(a)):ha(Object(a)).forEach(function(b){Object.defineProperty(h,b,Object.getOwnPropertyDescriptor(a,b))})}return h}n='input select textarea a[href] button [tabindex] audio[controls] video[controls] [contenteditable]:not([contenteditable\x3d"false"]) details\x3esummary:first-of-type details'.split(" ");var U=n.join(","),K="undefined"===typeof Element?function(){}:Element.prototype.matches||Element.prototype.msMatchesSelector||
Element.prototype.webkitMatchesSelector,J=function(h,f,a){var b=Array.prototype.slice.apply(h.querySelectorAll(U));f&&K.call(h,U)&&b.unshift(h);return b=b.filter(a)},H=function(h){var f=parseInt(h.getAttribute("tabindex"),10);return isNaN(f)?"true"===h.contentEditable||("AUDIO"===h.nodeName||"VIDEO"===h.nodeName||"DETAILS"===h.nodeName)&&null===h.getAttribute("tabindex")?0:h.tabIndex:f},S=function(h,f){return h.tabIndex===f.tabIndex?h.documentOrder-f.documentOrder:h.tabIndex-f.tabIndex},X=function(h){return"DETAILS"===
h.tagName&&Array.prototype.slice.apply(h.children).some(function(f){return"SUMMARY"===f.tagName})},Y=function(h){if("hidden"===getComputedStyle(h).visibility)return!0;var f=K.call(h,"details\x3esummary:first-of-type")?h.parentElement:h;if(K.call(f,"details:not([open]) *"))return!0;for(;h;){if("none"===getComputedStyle(h).display)return!0;h=h.parentElement}return!1},O=function(h){var f;(f=h.disabled)||(f="INPUT"===h.tagName&&"hidden"===h.type);return f||Y(h)||X(h)?!1:!0},ba=function(h){var f;if(!(f=
!O(h))&&(f="INPUT"===h.tagName&&"radio"===h.type)){if(h.name){f=(h.form||h.ownerDocument).querySelectorAll('input[type\x3d"radio"][name\x3d"'+h.name+'"]');b:{for(var a=0;a<f.length;a++)if(f[a].checked&&f[a].form===h.form){f=f[a];break b}f=void 0}f=!f||f===h}else f=!0;f=!f}return f||0>H(h)?!1:!0},ca=function(h,f){f=f||{};var a=[],b=[];J(h,f.includeContainer,ba).forEach(function(c,d){var e=H(c);0===e?a.push(c):b.push({documentOrder:d,tabIndex:e,node:c})});return b.sort(S).map(function(c){return c.node}).concat(a)},
Z=n.concat("iframe").join(","),V=function(h){if(!h)throw Error("No node provided");return!1===K.call(h,Z)?!1:O(h)},aa,da=function(){var h=[];return{activateTrap:function(f){if(0<h.length){var a=h[h.length-1];a!==f&&a.pause()}a=h.indexOf(f);-1!==a&&h.splice(a,1);h.push(f)},deactivateTrap:function(f){f=h.indexOf(f);-1!==f&&h.splice(f,1);0<h.length&&h[h.length-1].unpause()}}}(),Q=function(h,f){var a=document,b=ia({returnFocusOnDeactivate:!0,escapeDeactivates:!0,delayInitialFocus:!0},f),c=[],d=[],e=null,
m=null,k=!1,x=!1,g=function(L){return c.some(function(u){return u.contains(L)})},l=function(L){var u=b[L];if(!u)return null;var I=u;if("string"===typeof u&&(I=a.querySelector(u),!I))throw Error("`".concat(L,"` refers to no known node"));if("function"===typeof u&&(I=u(),!I))throw Error("`".concat(L,"` did not return a node"));return I},A=function(){var L=null!==l("initialFocus")?l("initialFocus"):g(a.activeElement)?a.activeElement:(L=d[0])&&L.firstTabbableNode||l("fallbackFocus");if(!L)throw Error("Your focus-trap needs to have at least one focusable element");
return L},q=function(){d=c.map(function(L){L=ca(L);if(0<L.length)return{firstTabbableNode:L[0],lastTabbableNode:L[L.length-1]}}).filter(function(L){return!!L});if(0>=d.length&&!l("fallbackFocus"))throw Error("Your focus-trap must have at least one container with at least one tabbable node in it at all times");},C=function I(u){u!==a.activeElement&&(u&&u.focus?(u.focus({preventScroll:!!b.preventScroll}),m=u,u.tagName&&"input"===u.tagName.toLowerCase()&&"function"===typeof u.select&&u.select()):I(A()))},
E=function(u){g(u.target)||(b.clickOutsideDeactivates?W.deactivate({returnFocus:b.returnFocusOnDeactivate&&!V(u.target)}):b.allowOutsideClick&&("boolean"===typeof b.allowOutsideClick?b.allowOutsideClick:b.allowOutsideClick(u))||u.preventDefault())},r=function(u){var I=g(u.target);I||u.target instanceof Document?I&&(m=u.target):(u.stopImmediatePropagation(),C(m||A()))},B=function(u){q();var I=null;if(0<d.length)if(u.shiftKey){var T=d.findIndex(function(ea){return u.target===ea.firstTabbableNode});
0<=T&&(I=d[0===T?d.length-1:T-1].lastTabbableNode)}else T=d.findIndex(function(ea){return u.target===ea.lastTabbableNode}),0<=T&&(I=d[T===d.length-1?0:T+1].firstTabbableNode);else I=l("fallbackFocus");I&&(u.preventDefault(),C(I))},F=function(u){!1===b.escapeDeactivates||"Escape"!==u.key&&"Esc"!==u.key&&27!==u.keyCode?"Tab"!==u.key&&9!==u.keyCode||B(u):(u.preventDefault(),W.deactivate())},ja=function(u){b.clickOutsideDeactivates||g(u.target)||b.allowOutsideClick&&("boolean"===typeof b.allowOutsideClick?
b.allowOutsideClick:b.allowOutsideClick(u))||(u.preventDefault(),u.stopImmediatePropagation())},ma=function(){if(k)return da.activateTrap(W),aa=b.delayInitialFocus?setTimeout(function(){C(A())},0):C(A()),a.addEventListener("focusin",r,!0),a.addEventListener("mousedown",E,{capture:!0,passive:!1}),a.addEventListener("touchstart",E,{capture:!0,passive:!1}),a.addEventListener("click",ja,{capture:!0,passive:!1}),a.addEventListener("keydown",F,{capture:!0,passive:!1}),W},na=function(){if(k)return a.removeEventListener("focusin",
r,!0),a.removeEventListener("mousedown",E,!0),a.removeEventListener("touchstart",E,!0),a.removeEventListener("click",ja,!0),a.removeEventListener("keydown",F,!0),W};var W={activate:function(u){if(k)return this;q();k=!0;x=!1;e=a.activeElement;(u=u&&u.onActivate?u.onActivate:b.onActivate)&&u();ma();return this},deactivate:function(u){if(!k)return this;clearTimeout(aa);na();x=k=!1;da.deactivateTrap(W);var I=u&&void 0!==u.onDeactivate?u.onDeactivate:b.onDeactivate;I&&I();(u&&void 0!==u.returnFocus?u.returnFocus:
b.returnFocusOnDeactivate)&&setTimeout(function(){var T=e,ea=l("setReturnFocus");C(ea?ea:T)},0);return this},pause:function(){if(x||!k)return this;x=!0;na();return this},unpause:function(){if(!x||!k)return this;x=!1;q();ma();return this},updateContainerElements:function(u){c=[].concat(u).filter(Boolean).map(function(I){return"string"===typeof I?a.querySelector(I):I});k&&q();return this}};W.updateContainerElements(h);return W};t=function(h){function f(b,c){var d=h.call(this,b,c)||this;d.container=
document.createElement("div");d.content=null;d.open=!1;d._close=()=>{d.open=!1};document.body.appendChild(d.container);d.own(d.watch("open",()=>d._toggleFocusTrap()));return d}z._inheritsLoose(f,h);var a=f.prototype;a.destroy=function(){this._destroyFocusTrap()};a.render=function(){var b=this.id;const {open:c,content:d,title:e,messages:m}=this;var k=c&&!!d;const x={["esri-identity-modal--open"]:k,["esri-identity-modal--closed"]:!k},g=N.jsx("button",{class:"esri-identity-modal__close-button","aria-label":m.close,
title:m.close,bind:this,onclick:this._close},N.jsx("span",{"aria-hidden":"true",class:"esri-icon-close"})),l=`${b}_title`;b=`${b}_content`;const A=e?N.jsx("h1",{id:l,class:"esri-identity-modal__title"},e):null;k=k?N.jsx("div",{bind:this,class:"esri-identity-modal__dialog",role:"dialog","aria-labelledby":l,"aria-describedby":b,afterCreate:this._createFocusTrap},g,A,this._renderContent(b)):null;return N.jsx("div",{tabIndex:-1,class:this.classes("esri-identity-modal",x)},k)};a._destroyFocusTrap=function(){var b;
null==(b=this._focusTrap)?void 0:b.deactivate({onDeactivate:null});this._focusTrap=null};a._toggleFocusTrap=function(){const {_focusTrap:b,open:c}=this;b&&(c?b.activate():b.deactivate())};a._createFocusTrap=function(b){this._destroyFocusTrap();requestAnimationFrame(()=>{this._focusTrap=Q(b,{initialFocus:"input",onDeactivate:this._close});this._toggleFocusTrap()})};a._renderContent=function(b){const c=this.content;return"string"===typeof c?N.jsx("div",{class:"esri-identity-modal__content",id:b,innerHTML:c}):
y.isWidget(c)?N.jsx("div",{class:"esri-identity-modal__content",id:b},c.render()):c instanceof HTMLElement?N.jsx("div",{class:"esri-identity-modal__content",id:b,bind:c,afterCreate:this._attachToNode}):null};a._attachToNode=function(b){b.appendChild(this)};return f}(t);v.__decorate([p.property({readOnly:!0})],t.prototype,"container",void 0);v.__decorate([p.property(),P.renderable()],t.prototype,"content",void 0);v.__decorate([p.property(),P.renderable()],t.prototype,"open",void 0);v.__decorate([p.property(),
P.renderable(),M.messageBundle("esri/t9n/common")],t.prototype,"messages",void 0);v.__decorate([p.property({aliasOf:"messages.auth.signIn"}),P.renderable()],t.prototype,"title",void 0);return t=v.__decorate([R.subclass("esri.identity.IdentityModal")],t)})},"esri/identity/OAuthCredential":function(){define(function(){let z=function(){function v(D,w){this.userId=this.token=this.ssl=this.expires=this.appId=this.storage=this.oAuthInfo=null;this.oAuthInfo=D;this.storage=w;this._init()}var n=v.prototype;
n.isValid=function(){let D=!1;if(this.oAuthInfo&&this.token&&this.userId){const w=Date.now();this.expires>w&&(this.expires-w)/1E3>60*this.oAuthInfo.minTimeUntilExpiration&&(D=!0)}return D};n.save=function(){if(this.storage){var D=this._load(),w=this.oAuthInfo;if(w&&w.authNamespace&&w.portalUrl){let p=D[w.authNamespace];p||(p=D[w.authNamespace]={});p[w.portalUrl]={appId:this.appId=w.appId,expires:this.expires,ssl:this.ssl,token:this.token,userId:this.userId};try{this.storage.setItem("esriJSAPIOAuth",
JSON.stringify(D))}catch(G){console.log(G)}}}};n.destroy=function(){const D=this._load(),w=this.oAuthInfo;if(w&&w.appId&&w.portalUrl&&this.token&&this.expires>Date.now()){var p=w.portalUrl.replace(/^http:/i,"https:")+"/sharing/rest/oauth2/revokeToken";const G=new FormData;G.append("f","json");G.append("auth_token",this.token);G.append("client_id",w.appId);G.append("token_type_hint","access_token");if("function"===typeof navigator.sendBeacon)navigator.sendBeacon(p,G);else{const R=new XMLHttpRequest;
R.open("POST",p);R.send(G)}}if(w&&w.authNamespace&&w.portalUrl&&this.storage&&(p=D[w.authNamespace])){delete p[w.portalUrl];try{this.storage.setItem("esriJSAPIOAuth",JSON.stringify(D))}catch(G){console.log(G)}}w&&(this.oAuthInfo=w._oAuthCred=null)};n._init=function(){var D=this._load();const w=this.oAuthInfo;w&&w.authNamespace&&w.portalUrl&&(D=D[w.authNamespace])&&(D=D[w.portalUrl])&&(this.appId=D.appId,this.expires=D.expires,this.ssl=D.ssl,this.token=D.token,this.userId=D.userId)};n._load=function(){let D=
{};if(this.storage){const w=this.storage.getItem("esriJSAPIOAuth");if(w)try{D=JSON.parse(w)}catch(p){console.log(p)}}return D};return v}();z.prototype.declaredClass="esri.identity.OAuthCredential";return z})},"esri/identity/OAuthInfo":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/has ../core/Logger ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/property ../core/jsonMap ../core/accessorSupport/decorators/subclass ../core/urlUtils ../core/uuid ../portal/support/resourceExtension ../core/JSONSupport".split(" "),
function(z,v,n,D,w,p,G,R,fa,ka,la,M){var P;n=P=function(N){function y(t){t=N.call(this,t)||this;t._oAuthCred=null;t.appId=null;t.authNamespace="/";t.expiration=20160;t.forceLogin=!1;t.forceUserId=!1;t.locale=null;t.minTimeUntilExpiration=30;t.popup=!1;t.popupCallbackUrl="oauth-callback.html";t.popupWindowFeatures="height\x3d490,width\x3d800,resizable,scrollbars,status";t.portalUrl="https://www.arcgis.com";t.preserveUrlHash=!1;t.userId=null;return t}z._inheritsLoose(y,N);y.prototype.clone=function(){return P.fromJSON(this.toJSON())};
return y}(M.JSONSupport);v.__decorate([p.property({json:{write:!0}})],n.prototype,"appId",void 0);v.__decorate([p.property({json:{write:!0}})],n.prototype,"authNamespace",void 0);v.__decorate([p.property({json:{write:!0}})],n.prototype,"expiration",void 0);v.__decorate([p.property({json:{write:!0}})],n.prototype,"forceLogin",void 0);v.__decorate([p.property({json:{write:!0}})],n.prototype,"forceUserId",void 0);v.__decorate([p.property({json:{write:!0}})],n.prototype,"locale",void 0);v.__decorate([p.property({json:{write:!0}})],
n.prototype,"minTimeUntilExpiration",void 0);v.__decorate([p.property({json:{write:!0}})],n.prototype,"popup",void 0);v.__decorate([p.property({json:{write:!0}})],n.prototype,"popupCallbackUrl",void 0);v.__decorate([p.property({json:{write:!0}})],n.prototype,"popupWindowFeatures",void 0);v.__decorate([p.property({json:{write:!0}})],n.prototype,"portalUrl",void 0);v.__decorate([p.property({json:{write:!0}})],n.prototype,"preserveUrlHash",void 0);v.__decorate([p.property({json:{write:!0}})],n.prototype,
"userId",void 0);return n=P=v.__decorate([R.subclass("esri.identity.OAuthInfo")],n)})},"esri/identity/ServerInfo":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/has ../core/Logger ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/property ../core/jsonMap ../core/accessorSupport/decorators/subclass ../core/urlUtils ../core/uuid ../portal/support/resourceExtension ../core/JSONSupport".split(" "),function(z,v,n,D,w,p,G,R,fa,ka,la,M){n=function(P){function N(y){y=
P.call(this,y)||this;y.adminTokenServiceUrl=null;y.currentVersion=null;y.hasPortal=null;y.hasServer=null;y.owningSystemUrl=null;y.owningTenant=null;y.server=null;y.shortLivedTokenValidity=null;y.tokenServiceUrl=null;y.webTierAuth=null;return y}z._inheritsLoose(N,P);return N}(M.JSONSupport);v.__decorate([p.property({json:{write:!0}})],n.prototype,"adminTokenServiceUrl",void 0);v.__decorate([p.property({json:{write:!0}})],n.prototype,"currentVersion",void 0);v.__decorate([p.property({json:{write:!0}})],
n.prototype,"hasPortal",void 0);v.__decorate([p.property({json:{write:!0}})],n.prototype,"hasServer",void 0);v.__decorate([p.property({json:{write:!0}})],n.prototype,"owningSystemUrl",void 0);v.__decorate([p.property({json:{write:!0}})],n.prototype,"owningTenant",void 0);v.__decorate([p.property({json:{write:!0}})],n.prototype,"server",void 0);v.__decorate([p.property({json:{write:!0}})],n.prototype,"shortLivedTokenValidity",void 0);v.__decorate([p.property({json:{write:!0}})],n.prototype,"tokenServiceUrl",
void 0);v.__decorate([p.property({json:{write:!0}})],n.prototype,"webTierAuth",void 0);return n=v.__decorate([R.subclass("esri.identity.ServerInfo")],n)})},"*noref":1}});
define(["../chunks/_rollupPluginBabelHelpers","../chunks/tslib.es6","../core/accessorSupport/decorators/subclass","../kernel","./IdentityManagerBase"],function(z,v,n,D,w){w=function(p){function G(){return p.apply(this,arguments)||this}z._inheritsLoose(G,p);return G}(w.IdentityManagerBase);w=v.__decorate([n.subclass("esri.identity.IdentityManager")],w);v=new w;D.setId(v);return v});