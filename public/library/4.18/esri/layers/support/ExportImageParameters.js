// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.18/esri/copyright.txt for details.
//>>built
define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/has ../../core/Logger ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/property ../../core/jsonMap ../../core/accessorSupport/decorators/subclass ../../core/urlUtils ../../core/uuid ../../portal/support/resourceExtension ../../core/Accessor ./commonProperties ../../core/HandleOwner ./sublayerUtils ../../views/View".split(" "),function(c,l,d,z,A,B,e,C,p,D,E,F,q,r,t,u,v){const w={visible:"visibleSublayers",
definitionExpression:"layerDefs",labelingInfo:"hasDynamicLayers",labelsVisible:"hasDynamicLayers",opacity:"hasDynamicLayers",minScale:"visibleSublayers",maxScale:"visibleSublayers",renderer:"hasDynamicLayers",source:"hasDynamicLayers"};c.ExportImageParameters=function(m){function k(){var a=m.apply(this,arguments)||this;a._scale=null;a.view=null;return a}l._inheritsLoose(k,m);var n=k.prototype;n.destroy=function(){this.layer=this.view=null};n.toJSON=function(){var a=this.layer;a={dpi:a.dpi,format:a.imageFormat,
transparent:a.imageTransparency,gdbVersion:a.gdbVersion||null};this.hasDynamicLayers&&this.dynamicLayers?a.dynamicLayers=this.dynamicLayers:a={...a,layers:this.layers,layerDefs:this.layerDefs};return a};l._createClass(k,[{key:"dynamicLayers",get:function(){if(!this.hasDynamicLayers)return null;const a=this.visibleSublayers.map(b=>b.toExportImageJSON());return a.length?JSON.stringify(a):null}},{key:"hasDynamicLayers",get:function(){return this.layer&&u.isExportDynamic(this.visibleSublayers,this.layer.serviceSublayers,
this.layer)}},{key:"layer",set:function(a){this._get("layer")!==a&&(this._set("layer",a),this.handles.remove("layer"),a&&this.handles.add([a.allSublayers.on("change",()=>this.notifyChange("visibleSublayers")),a.on("sublayer-update",b=>this.notifyChange(w[b.propertyName]))],"layer"))}},{key:"layers",get:function(){const a=this.visibleSublayers;return a?a.length?"show:"+a.map(b=>b.id).join(","):"show:-1":null}},{key:"layerDefs",get:function(){const a=this.visibleSublayers.filter(b=>null!=b.definitionExpression);
return a.length?JSON.stringify(a.reduce((b,g)=>{b[g.id]=g.definitionExpression;return b},{})):null}},{key:"scale",get:function(){return null!=this._scale?this._scale:this.view&&this.view.scale||0},set:function(a){this.view||(this._scale=a,this.notifyChange("scale"))}},{key:"version",get:function(){this.layers;this.layerDefs;this.dynamicLayers;this.timeExtent;const a=this.layer;a&&(a.dpi,a.imageFormat,a.imageTransparency,a.gdbVersion);return(this._get("version")||0)+1},set:function(a){this._set("version",
a)}},{key:"visibleSublayers",get:function(){const a=[];if(!this.layer)return a;var b=this.layer.sublayers;const g=f=>{const h=this.scale,x=0===f.minScale||h<=f.minScale,y=0===f.maxScale||h>=f.maxScale;f.visible&&(0===h||x&&y)&&(f.sublayers?f.sublayers.forEach(g):a.unshift(f))};b&&b.forEach(g);b=this._get("visibleSublayers");return!b||b.length!==a.length||b.some((f,h)=>a[h]!==f)?a:b}}]);return k}(t.HandleOwnerMixin(q));d.__decorate([e.property({readOnly:!0,dependsOn:["hasDynamicLayers","visibleSublayers"]})],
c.ExportImageParameters.prototype,"dynamicLayers",null);d.__decorate([e.property({readOnly:!0,dependsOn:["visibleSublayers","layer.serviceSublayers","layer.capabilities"]})],c.ExportImageParameters.prototype,"hasDynamicLayers",null);d.__decorate([e.property()],c.ExportImageParameters.prototype,"layer",null);d.__decorate([e.property({readOnly:!0,dependsOn:["visibleSublayers"]})],c.ExportImageParameters.prototype,"layers",null);d.__decorate([e.property({readOnly:!0,dependsOn:["visibleSublayers"]})],
c.ExportImageParameters.prototype,"layerDefs",null);d.__decorate([e.property({type:Number,dependsOn:["view.scale"]})],c.ExportImageParameters.prototype,"scale",null);d.__decorate([e.property(r.combinedViewLayerTimeExtentProperty)],c.ExportImageParameters.prototype,"timeExtent",void 0);d.__decorate([e.property({dependsOn:"layers layerDefs dynamicLayers layer.dpi layer.imageFormat layer.imageTransparency layer.gdbVersion timeExtent".split(" ")})],c.ExportImageParameters.prototype,"version",null);d.__decorate([e.property({type:v})],
c.ExportImageParameters.prototype,"view",void 0);d.__decorate([e.property({readOnly:!0,dependsOn:["layer.sublayers","scale"]})],c.ExportImageParameters.prototype,"visibleSublayers",null);c.ExportImageParameters=d.__decorate([p.subclass("esri.layers.mixins.ExportImageParameters")],c.ExportImageParameters);Object.defineProperty(c,"__esModule",{value:!0})});