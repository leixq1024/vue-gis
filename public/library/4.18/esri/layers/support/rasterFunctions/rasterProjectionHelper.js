// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.18/esri/copyright.txt for details.
//>>built
define("exports ../../../core/Error ../../../geometry/support/spatialReferenceUtils ../../../geometry/support/webMercatorUtils ../../../geometry/Point ../../../geometry/Extent ../../../geometry ../../../core/unitUtils ../../../geometry/projection".split(" "),function(v,C,z,K,t,R,T,L,u){function M(a,b,c,d=null){if(a.spatialReference.equals(b))return a;const f=D(a.spatialReference,b);if(f&&!u.isLoaded())throw new C("rasterprojectionhelper-projectResolution","projection engine is not loaded");c=c.center;
a=new R({xmin:c.x-a.x/2,xmax:c.x+a.x/2,ymin:c.y-a.y/2,ymax:c.y+a.y/2,spatialReference:a.spatialReference});b=f?u.project(a,b,d):K.project(a,b);return null==b?null:{x:b.xmax-b.xmin,y:b.ymax-b.ymin}}function N(a,b=.01){return L.getMetersPerUnitForSR(a)?b/L.getMetersPerUnitForSR(a):0}function E(a,b,c=null,d=!0){const f=a.spatialReference;if(f.equals(b))return a;const m=D(f,b);if(m&&!u.isLoaded())throw new C("rasterprojectionhelper-projectResolution","projection engine is not loaded");if((c=m?u.project(a,
b,c):K.project(a,b))&&d&&b.isGeographic){var n,k;const [e,h]=f.isWebMercator?z.getInfo(f).origin:null!=(n=null==(k=z.getInfo(f))?void 0:k.valid)?n:[];(b=N(f))&&null!=e&&null!=h&&(Math.abs(a.x-e)<b&&5E-4>Math.abs(180-c.x)?c.x-=360:Math.abs(a.x-h)<b&&5E-4>Math.abs(180+c.x)&&(c.x+=360))}return c}function O(a,b,c=null,d=!0){var f,m,n,k;const e=a.spatialReference;if(e.equals(b))return a;var h=D(e,b);if(h&&!u.isLoaded())throw new C("rasterprojectionhelper-projectExtent","projection engine is not loaded");
h=h?u.project(a,b,c):K.project(a,b);let [q,w]=null!=(f=null==(m=z.getInfo(e))?void 0:m.origin)?f:[];h&&d&&e.isWebMercator&&b.isGeographic&&null!=q&&null!=w&&(.001>Math.abs(a.xmin-q)&&1E3<Math.abs(w-a.xmax)&&5E-4>Math.abs(180-h.xmax)&&(h.xmin=-180,d=[],d.push(new t(a.xmax,a.ymin,e)),d.push(new t(a.xmax,(a.ymin+a.ymax)/2,e)),d.push(new t(a.xmax,a.ymax,e)),d=d.map(p=>E(p,b,c)).filter(p=>!isNaN(null==p?void 0:p.x)).map(p=>p.x),h.xmax=Math.max.apply(null,d)),.001>Math.abs(a.xmax-w)&&1E3<Math.abs(q-a.xmin)&&
5E-4>Math.abs(180+h.xmin)&&(h.xmax=180,d=[],d.push(new t(a.xmin,a.ymin,e)),d.push(new t(a.xmin,(a.ymin+a.ymax)/2,e)),d.push(new t(a.xmin,a.ymax,e)),a=d.map(p=>E(p,b,c)).filter(p=>!isNaN(null==p?void 0:p.x)).map(p=>p.x),h.xmin=Math.min.apply(null,a)));[q,w]=b.isWebMercator?z.getInfo(b).origin:null!=(n=null==(k=z.getInfo(b))?void 0:k.valid)?n:[];(n=N(b))&&null!=q&&null!=w&&(Math.abs(h.xmin-q)<n&&(h.xmin=q),Math.abs(h.xmax-w)<n&&(h.xmax=w));return h}const D=function(a,b){const c=(a.isWGS84||a.isWebMercator)&&
(b.isWGS84||b.isWebMercator);return!(a.equals(b)||c)};v.computeProjectedScales=function(a,b,c=512,d=!0){const {extent:f,spatialReference:m,pixelSize:n}=a,k=M(new t({x:n.x,y:n.y,spatialReference:m}),b,f);if(null==k)return{projectedPixelSize:null,scales:null,srcResolutions:null};var e=(k.x+k.y)/2,h=L.getMetersPerUnitForSR(b);e=e*h*96*39.37;c=b.isGeographic?512/c*2.958287637958547E8:512/c*5.91657527591555E8;let q=!1;d&&(b.isGeographic||b.isWebMercator)&&(d=O(f,b),q=0>d.xmin*d.xmax);d=e;if(q)d=c,a=d/
(96*h*39.37),b=M(new t({x:a,y:a,spatialReference:b}),m,f);else{b={x:n.x,y:n.y};a=Math.ceil(Math.log(Math.min(a.width,a.height)/32)/Math.LN2);for(h=0;d<.5005*c&&h<a;)h++,d*=2,b.x*=2,b.y*=2;1.001>=Math.max(d,c)/Math.min(d,c)&&(d=c)}a=[];c=[];for(e=Math.min(70.5310735,e)/1.001;d>=e;)a.push(d),c.push({x:b.x,y:b.y}),d/=2,b.x/=2,b.y/=2;return{projectedPixelSize:k,scales:a,srcResolutions:c}};v.defaultGridSpacing=32;v.getProjectionOffsetGrid=function(a,b,c,d=null,f=null,m=!1,n=[32,32]){var k,e;if(D(a.spatialReference,
b.spatialReference)&&!u.isLoaded())throw new C("rasterprojectionhelper-projectResolution","projection engine is not loaded");if(!(a&&b&&c))return null;const {xmin:h,ymin:q,xmax:w,ymax:p}=a;var r=a.spatialReference,F=b.spatialReference;const [P,S]=null!=(k=null==(e=z.getInfo(r))?void 0:e.valid)?k:[];var G=n[0]*c.x,x=n[1]*c.y;c=Math.ceil((w-h)/G-.1)+1;k=Math.ceil((p-q)/x-.1)+1;e=[];a=!1;for(var A=0;A<c;A++){var B=[];for(var l=0;l<k;l++){var g=new t({x:h+G*A,y:p-x*l,spatialReference:r});g=E(g,F,d);f&&
(g=f.inverseTransform(g));B.push(g);0<A&&m&&g&&y[l]&&null!=P&&g.x<y[l].x&&(g.x+=S-P);g?(e.push((g.x-b.xmin)/(b.xmax-b.xmin)),e.push((b.ymax-g.y)/(b.ymax-b.ymin))):(e.push(NaN),e.push(NaN),a=!0)}var y=B}b=[Math.abs((e[0]+e[4]+e[4*c]+e[4*c+4])/4-e[2*k+2]),Math.abs((e[1]+e[5]+e[4*k+1]+e[4*k+5])/4-e[2*k+3])];d=new Float32Array((c-1)*(k-1)*12);f=new Float32Array([-0,-1,1,-1,1,-0,1,-0,-0]);m=new Float32Array([-1,1,0,0,-1,1,1,0,0]);for(y=0;y<c-1;y++){for(r=0;r<k-1;r++){l=y*k*2+2*r;x=e[l];F=e[l+1];var H=
e[l+2],I=e[l+3];l+=2*k;A=e[l];G=e[l+1];B=e[l+2];l=e[l+3];g=0;let J=12*(r*(c-1)+y);for(let Q=0;3>Q;Q++)d[J++]=f[g++]*x+f[g++]*H+f[g++]*B;g=0;for(H=0;3>H;H++)d[J++]=f[g++]*F+f[g++]*I+f[g++]*l;g=0;for(I=0;3>I;I++)d[J++]=m[g++]*x+m[g++]*A+m[g++]*B;g=0;for(x=0;3>x;x++)d[J++]=m[g++]*F+m[g++]*G+m[g++]*l}if(a)for(r=0;r<d.length;r++)isNaN(d[r])&&(d[r]=-1)}return{offsets:e,error:b,coefficients:d,spacing:n,size:[c-1,k-1]}};v.load=async function(){if(u.isLoaded()||!u.isSupported())return null;await u.load()};
v.projectExtent=O;v.projectPoint=E;v.projectResolution=M;v.snapPyramid=function(a,b,c){var d=Math.log(a.x/b.pixelSize.x)/Math.LN2;const f=Math.log(a.y/b.pixelSize.y)/Math.LN2;a=b.storageInfo.maximumPyramidLevel||0;c="down"===c?Math.floor(Math.min(d,f)):"up"===c?Math.ceil(Math.max(d,f)):Math.round((d+f)/2);d=!1;0>c?c=0:c>a&&(d=c>a+3,c=a);a=Math.pow(2,c);b=new t({x:a*b.nativePixelSize.x,y:a*b.nativePixelSize.y,spatialReference:b.spatialReference});return{pyramidLevel:c,pyramidResolution:b,excessiveReading:d}};
Object.defineProperty(v,"__esModule",{value:!0})});