// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.18/esri/copyright.txt for details.
//>>built
define(["exports","../PixelBlock"],function(B,H){function R(a,c){a=Math.min(Math.max(a,-100),100);c=Math.min(Math.max(c,-100),100);let b,e;const k=new Uint8Array(256);for(b=0;256>b;b++)0<a&&100>a?e=(200*b-25500+510*c)/(2*(100-a))+128:0>=a&&-100<a?e=(200*b-25500+510*c)*(100+a)/2E4+128:100===a?(e=200*b-25500+256*(100-a)+510*c,e=0<e?255:0):-100===a&&(e=128),k[b]=255<e?255:0>e?0:e;return k}function P(a,c,b,e,k,n,l,h){return{xmin:k<=b*a?0:k<b*a+a?k-b*a:a,ymin:n<=e*c?0:n<e*c+c?n-e*c:c,xmax:k+l<=b*a?0:k+
l<b*a+a?k+l-b*a:a,ymax:n+h<=e*c?0:n+h<e*c+c?n+h-e*c:c}}function S(a,c,b,e){var k=a.filter(E=>D(E))[0];if(null==k)return null;const n=e?e.width:c.width;e=e?e.height:c.height;const l=k.width,h=k.height,d=c.width/l;c=c.height/h;const g=b?b.x:0;b=b?b.y:0;const f=k.pixelType;var m=H.getPixelArrayConstructor(f);const q=k.pixels.length;k=[];let p,v;var u;let r,t,x,w,y,z,A;for(t=0;t<q;t++){v=new m(n*e);for(x=0;x<c;x++)for(w=0;w<d;w++)if(u=a[x*d+w])for(p=u.pixels[t],A=P(l,h,w,x,g,b,n,e),y=A.ymin;y<A.ymax;y++)for(u=
(x*h+y-b)*n+(w*l-g),r=y*l,z=A.xmin;z<A.xmax;z++)v[u+z]=p[r+z];k.push(v)}let C;if(a.some(E=>null==E||E.mask&&0<E.mask.length))for(C=new Uint8Array(n*e),x=0;x<c;x++)for(w=0;w<d;w++)if(m=(u=a[x*d+w])?u.mask:null,A=P(l,h,w,x,g,b,n,e),m)for(y=A.ymin;y<A.ymax;y++)for(u=(x*h+y-b)*n+(w*l-g),r=y*l,z=A.xmin;z<A.xmax;z++)C[u+z]=m[r+z];else if(u)for(y=A.ymin;y<A.ymax;y++)for(u=(x*h+y-b)*n+(w*l-g),r=y*l,z=A.xmin;z<A.xmax;z++)C[u+z]=1;else for(y=A.ymin;y<A.ymax;y++)for(u=(x*h+y-b)*n+(w*l-g),r=y*l,z=A.xmin;z<A.xmax;z++)C[u+
z]=0;a=new H({width:n,height:e,pixels:k,pixelType:f,mask:C});a.updateStatistics();return a}function T(a){if(!D(a))return null;const c=a.clone(),{width:b,height:e,pixels:k,mask:n}=a;var l=k[0];a=c.pixels[0];for(let g=2;g<e-1;g++){const f=new Map;for(var h=g-2;h<g+2;h++)for(var d=0;4>d;d++){const m=h*b+d;M(f,l[m],n?n[m]:1)}a[g*b]=U(f);a[g*b+1]=a[g*b+2]=a[g*b];for(h=3;h<b-1;h++)d=(g-2)*b+h+1,M(f,l[d],n?n[d]:1),d=(g-1)*b+h+1,M(f,l[d],n?n[d]:1),d=g*b+h+1,M(f,l[d],n?n[d]:1),d=(g+1)*b+h+1,M(f,l[d],n?n[d]:
1),d=(g-2)*b+h-3,N(f,l[d],n?n[d]:1),d=(g-1)*b+h-3,N(f,l[d],n?n[d]:1),d=g*b+h-3,N(f,l[d],n?n[d]:1),d=(g+1)*b+h-3,N(f,l[d],n?n[d]:1),a[g*b+h]=U(f);a[g*b+h+1]=a[g*b+h]}for(l=0;l<b;l++)a[l]=a[b+l]=a[2*b+l],a[(e-1)*b+l]=a[(e-2)*b+l];c.updateStatistics();return c}function U(a){if(0===a.size)return 0;let c=0,b=-1,e=0;const k=a.keys();let n=k.next();for(;!n.done;)e=a.get(n.value),e>c&&(b=n.value,c=e),n=k.next();return b}function N(a,c,b){0!==b&&(b=a.get(c),1===b?a.delete(c):a.set(c,b-1))}function M(a,c,b){0!==
b&&a.set(c,a.has(c)?a.get(c)+1:1)}function V(a,c,b){let {x:e,y:k}=c;const {width:n,height:l}=b;if(0===e&&0===k&&l===a.height&&n===a.width)return a;const {width:h,height:d}=a;c=Math.max(0,k);const g=Math.max(0,e),f=Math.min(e+n,h),m=Math.min(k+l,d);if(0>f||0>m||!D(a))return null;e=Math.max(0,-e);k=Math.max(0,-k);const {pixels:q,mask:p}=a;var v=n*l,u=q.length;const r=[];for(var t=0;t<u;t++){var x=q[t],w=H.createEmptyBand(a.pixelType,v);for(let y=c;y<m;y++){const z=y*h;let A=(y+k-c)*n+e;for(let C=g;C<
f;C++)w[A++]=x[z+C]}r.push(w)}v=new Uint8Array(v);for(u=c;u<m;u++)for(t=u*h,x=(u+k-c)*n+e,w=g;w<f;w++)v[x++]=p?p[t+w]:1;a=new H({width:b.width,height:b.height,pixelType:a.pixelType,pixels:r,mask:v});a.updateStatistics();return a}function X(a,c=!0){if(!D(a))return null;const {pixels:b,width:e,height:k,mask:n,pixelType:l}=a;a=[];const h=Math.round(e/2),d=Math.round(k/2),g=k-1,f=e-1;for(var m=0;m<b.length;m++){var q=b[m],p=H.createEmptyBand(l,h*d),v=0;for(var u=0;u<k;u+=2)for(var r=0;r<e;r+=2){var t=
q[u*e+r];if(c){var x=r===f?t:q[u*e+r+1];const w=u===g?t:q[u*e+r+e],y=r===f?w:u===g?x:q[u*e+r+e+1];p[v++]=(t+x+w+y)/4}else p[v++]=t}a.push(p)}m=null;if(n)for(m=new Uint8Array(h*d),q=0,p=0;p<k;p+=2)for(v=0;v<e;v+=2)u=n[p*e+v],c?(r=v===f?u:n[p*e+v+1],t=p===g?u:n[p*e+v+e],x=v===f?t:p===g?r:n[p*e+v+e+1],m[q++]=u*r*t*x?1:0):m[q++]=u;return new H({width:h,height:d,pixelType:l,pixels:a,mask:m})}const D=function(a){return a&&"esri.layers.support.PixelBlock"===a.declaredClass&&a.pixels&&0<a.pixels.length};
B.approximateTransform=function(a,c,b,e,k="nearest"){if(!D(a))return null;"majority"===k&&(a=T(a));const {pixels:n,mask:l,pixelType:h}=a,d=a.width;var g=a.height;a=H.getPixelArrayConstructor(h);var f=n.length;const {width:m,height:q}=c;c=e.cols;var p=e.rows;const v=Math.ceil(m/c),u=Math.ceil(q/p);e=!1;for(var r=0;r<b.length;r+=3)-1===b[r]&&-1===b[r+1]&&-1===b[r+2]&&(e=!0);let t,x,w,y,z,A;const C=new Float32Array(m*q),E=new Float32Array(m*q);r=0;let K,L;const O="majority"===k?0:.5;for(let I=0;I<u;I++)for(let J=
0;J<v;J++){t=12*(I*v+J);k=b[t];x=b[t+1];w=b[t+2];y=b[t+3];z=b[t+4];A=b[t+5];for(var F=0;F<p;F++){r=(I*p+F)*m+J*c;L=(F+.5)/p;for(var G=0;G<F;G++)K=(G+.5)/c,C[r+G]=Math.round((k*K+x*L+w)*d-O),E[r+G]=Math.round((y*K+z*L+A)*g-O)}t+=6;k=b[t];x=b[t+1];w=b[t+2];y=b[t+3];z=b[t+4];A=b[t+5];for(F=0;F<p;F++)for(r=(I*p+F)*m+J*c,L=(F+.5)/p,G=F;G<c;G++)K=(G+.5)/c,C[r+G]=Math.round((k*K+x*L+w)*d-O),E[r+G]=Math.round((y*K+z*L+A)*g-O)}b=(I,J)=>{for(let Q=0;Q<q;Q++){t=Q*m;for(let W=0;W<m;W++)I[t]=0>C[t]||0>E[t]?0:
J[C[t]+E[t]*d],t++}};g=[];for(p=0;p<f;p++)c=new a(m*q),b(c,n[p]),g.push(c);a=new H({width:m,height:q,pixelType:h,pixels:g});if(l)a.mask=new Uint8Array(m*q),b(a.mask,l);else if(e)for(a.mask=new Uint8Array(m*q),f=0;f<m*q;f++)a.mask[f]=0>C[f]||0>E[f]?0:1;a.updateStatistics();return a};B.clip=V;B.colorize=function(a,c){if(!D(a)||!c&&(c.indexedColormap||c.indexed2DColormap))return a;const b=a.clone();var e=b.pixels;let k=b.mask;const n=b.width*b.height;if(1!==e.length)return a;const {indexedColormap:l,
indexed2DColormap:h,offset:d,alphaSpecified:g}=c;c=l.length-1;a=0;e=e[0];const f=new Uint8Array(e.length),m=new Uint8Array(e.length),q=new Uint8Array(e.length);let p=0;if(l)if(k)for(a=0;a<n;a++)k[a]&&(p=4*(e[a]-d),p<d||p>c?k[a]=0:(f[a]=l[p],m[a]=l[p+1],q[a]=l[p+2],k[a]=l[p+3]));else{k=new Uint8Array(n);for(a=0;a<n;a++)p=4*(e[a]-d),p<d||p>c?k[a]=0:(f[a]=l[p],m[a]=l[p+1],q[a]=l[p+2],k[a]=l[p+3]);b.mask=k}else if(k)for(a=0;a<n;a++)k[a]&&(c=h[e[a]],f[a]=c[0],m[a]=c[1],q[a]=c[2],k[a]=c[3]);else{k=new Uint8Array(n);
for(a=0;a<n;a++)c=h[e[a]],f[a]=c[0],m[a]=c[1],q[a]=c[2],k[a]=c[3];b.mask=k}b.pixels=[f,m,q];b.statistics=null;b.pixelType="u8";b.maskIsAlpha=g;return b};B.createColormapLUT=function(a){if(a){var c=a.colormap;if(c&&0!==c.length){c=c.sort((g,f)=>g[0]-f[0]);var b=0;0>c[0][0]&&(b=c[0][0]);var e=Math.max(256,c[c.length-1][0]-b+1),k=new Uint8Array(4*e),n=[],l=0,h=0,d=5===c[0].length;if(65536<e)return c.forEach(g=>{n[g[0]-b]=d?g.slice(1):g.slice(1).concat([255])}),{indexed2DColormap:n,offset:b,alphaSpecified:d};
if(a.fillUnspecified)for(a=c[h],l=a[0]-b;l<e;l++)k[4*l]=a[1],k[4*l+1]=a[2],k[4*l+2]=a[3],k[4*l+3]=d?a[4]:255,l===a[0]-b&&(a=h===c.length-1?a:c[++h]);else for(l=0;l<c.length;l++)a=c[l],h=4*(a[0]-b),k[h]=a[1],k[h+1]=a[2],k[h+2]=a[3],k[h+3]=d?a[4]:255;return{indexedColormap:k,offset:b,alphaSpecified:d}}}};B.createContrastBrightnessLUT=R;B.createStretchLUT=function(a){const {minCutOff:c,maxCutOff:b,gamma:e,pixelType:k}=a,n=a.outMin||0,l=a.outMax||255;if(-1===["u8","u16","s8","s16"].indexOf(k))return null;
const h=c.length;let d;let g=0;"s8"===k?g=-127:"s16"===k&&(g=-32767);let f=256;-1<["u16","s16"].indexOf(k)&&(f=65536);const m=[],q=l-n;for(d=0;d<h;d++)m[d]=b[d]-c[d];var p=e&&e.length>=h;const v=[];if(p)for(d=0;d<h;d++)v[d]=1<e[d]?2<e[d]?6.5+Math.pow(e[d]-2,2.5):6.5+100*Math.pow(2-e[d],4):1;let u;const r=[];let t,x,w;if(p)for(d=0;d<h;d++){w=[];for(p=0;p<f;p++)t=p+g,u=(t-c[d])/m[d],x=1,1<e[d]&&(x-=Math.pow(1/q,u*v[d])),w[p]=t<b[d]&&t>c[d]?Math.floor(x*q*Math.pow(u,1/e[d]))+n:t>=b[d]?l:n;r[d]=w}else for(d=
0;d<h;d++){w=[];for(p=0;p<f;p++)t=p+g,w[p]=t<=c[d]?n:t>=b[d]?l:Math.floor((t-c[d])/m[d]*q)+n;r[d]=w}if(null!=a.contrastOffset)for(a=R(a.contrastOffset,a.brightnessOffset),d=0;d<h;d++)for(w=r[d],p=0;p<f;p++)w[p]=a[w[p]];return{lut:r,offset:g}};B.estimateStatisticsFromHistograms=function(a){const c=[];for(let n=0;n<a.length;n++){const {min:l,max:h,size:d,counts:g}=a[n];let f=0;var b=0;for(var e=0;e<d;e++)f+=g[e],b+=e*g[e];b/=f;e=0;for(var k=0;k<d;k++)e+=g[k]*Math.pow(k-b,2);k=(h-l)/d;c.push({min:l,
max:h,avg:(b+.5)*k+l,stddev:Math.sqrt(e/(f-1))*k})}return c};B.estimateStatisticsHistograms=function(a){if(!D(a))return null;a.statistics||a.updateStatistics();const {pixels:c,mask:b,pixelType:e,statistics:k}=a;a=a.width*a.height;const n=c.length;let l,h;let d;var g;const f=[],m=[];for(d=0;d<n;d++){var q=new Uint32Array(256);var p=c[d];if("u8"===e)if(l=-.5,h=255.5,b)for(g=0;g<a;g++)b[g]&&q[p[g]]++;else for(g=0;g<a;g++)q[p[g]]++;else{l=k[d].minValue;h=k[d].maxValue;var v=(h-l)/256;var u=new Uint32Array(257);
if(b)for(g=0;g<a;g++)b[g]&&u[Math.floor((p[g]-l)/v)]++;else for(g=0;g<a;g++)u[Math.floor((p[g]-l)/v)]++;for(g=0;255>g;g++)q[g]=u[g];q[255]=u[255]+u[256]}f.push({min:l,max:h,size:256,counts:q});for(g=p=u=v=0;256>g;g++)v+=q[g],u+=g*q[g];u/=v;for(g=0;256>g;g++)p+=q[g]*Math.pow(g-u,2);q=Math.sqrt(p/(v-1));v=(h-l)/256;g=(u+.5)*v+l;q*=v;m.push({min:l,max:h,avg:g,stddev:q})}return{statistics:m,histograms:f}};B.extractBands=function(a,c){if(!c||!D(a))return a;const b=a.pixels.length;return c&&c.some(e=>e>=
b)||1===b&&1===c.length&&0===c[0]||b===c.length&&!c.some((e,k)=>e!==k)?a:new H({pixelType:a.pixelType,width:a.width,height:a.height,mask:a.mask,validPixelCount:a.validPixelCount,maskIsAlpha:a.maskIsAlpha,pixels:c.map(e=>a.pixels[e]),statistics:a.statistics&&c.map(e=>a.statistics[e])})};B.getClipBounds=P;B.lookupPixels=function(a,c){if(!D(a))return null;const {pixels:b,mask:e}=a,k=a.width*a.height,n=b.length;let l=c.lut;({offset:c}=c);let h,d;l&&1===l[0].length&&(l=b.map(()=>l));const g=[];let f,m,
q;if(c)if(null==e)for(h=0;h<n;h++){f=b[h];m=l[h];q=new Uint8Array(k);for(d=0;d<k;d++)q[d]=m[f[d]-c];g.push(q)}else for(h=0;h<n;h++){f=b[h];m=l[h];q=new Uint8Array(k);for(d=0;d<k;d++)e[d]&&(q[d]=m[f[d]-c]);g.push(q)}else if(null==e)for(h=0;h<n;h++){f=b[h];m=l[h];q=new Uint8Array(k);for(d=0;d<k;d++)q[d]=m[f[d]];g.push(q)}else for(h=0;h<n;h++){f=b[h];m=l[h];q=new Uint8Array(k);for(d=0;d<k;d++)e[d]&&(q[d]=m[f[d]]);g.push(q)}a=new H({width:a.width,height:a.height,pixels:g,mask:e,pixelType:"u8"});a.updateStatistics();
return a};B.mosaic=S;B.mosaicPixelData=function(a,c){if(!a||0===a.length)return null;var b=a.filter(m=>m.pixelBlock)[0];if(!b)return null;var e=(b.extent.xmax-b.extent.xmin)/b.pixelBlock.width;const k=(b.extent.ymax-b.extent.ymin)/b.pixelBlock.height,n=.01*Math.min(e,k),l=a.sort((m,q)=>Math.abs(m.extent.ymax-q.extent.ymax)>n?q.extent.ymax-m.extent.ymax:Math.abs(m.extent.xmin-q.extent.xmin)>n?m.extent.xmin-q.extent.xmin:0);var h=Math.min.apply(null,l.map(m=>m.extent.xmin));const d=Math.min.apply(null,
l.map(m=>m.extent.ymin)),g=Math.max.apply(null,l.map(m=>m.extent.xmax)),f=Math.max.apply(null,l.map(m=>m.extent.ymax));a={x:Math.round((c.xmin-h)/e),y:Math.round((f-c.ymax)/k)};h={width:Math.round((g-h)/e),height:Math.round((f-d)/k)};e={width:Math.round((c.xmax-c.xmin)/e),height:Math.round((c.ymax-c.ymin)/k)};if(Math.round(h.width/b.pixelBlock.width)*Math.round(h.height/b.pixelBlock.height)!==l.length||0>a.x||0>a.y||h.width<e.width||h.height<e.height)return null;b=l.map(m=>m.pixelBlock);b=S(b,h,a,
e);return{extent:c,pixelBlock:b}};B.remapColor=function(a,c){if(!D(a))return null;a=a.clone();var {pixels:b}=a;const e=a.width*a.height,k=c.length,n=Math.floor(k/2),l=c[Math.floor(n)];b=b[0];let h,d,g,f,m,q,p=!1;const v=new Uint8Array(e),u=new Uint8Array(e),r=new Uint8Array(e);let t=a.mask;const x=4===c[0].mappedColor.length;t||(t=new Uint8Array(e),t.fill(x?255:1),a.mask=t);for(m=0;m<e;m++)if(t[m]){h=b[m];p=!1;q=n;d=l;g=0;for(f=k-1;1<f-g;){if(h===d.value){p=!0;break}h>d.value?g=q:f=q;q=Math.floor((g+
f)/2);d=c[Math.floor(q)]}p||(h===c[g].value?(d=c[g],p=!0):h===c[f].value?(d=c[f],p=!0):h<c[g].value?(p=!1,d=null):h>c[g].value&&(h<c[f].value?(d=c[g],p=!0):f===k-1?(p=!1,d=null):(d=c[f],p=!0)));p?(v[m]=d.mappedColor[0],u[m]=d.mappedColor[1],r[m]=d.mappedColor[2],t[m]=d.mappedColor[3]):v[m]=u[m]=r[m]=t[m]=0}a.pixels=[v,u,r];a.mask=t;a.pixelType="u8";a.maskIsAlpha=x;return a};B.resampleByMajority=T;B.setValidBoundary=function(a,c,b){if(!D(a))return null;const {width:e,height:k}=a,n=c.x;c=c.y;const l=
b.width+n;b=b.height+c;if(0>n||0>c||l>e||b>k||0===n&&0===c&&l===e&&b===k)return a;a.mask||(a.mask=new Uint8Array(e*k));const h=a.mask;for(let d=0;d<k;d++){const g=d*e;for(let f=0;f<e;f++)h[g+f]=d<c||d>=b||f<n||f>=l?0:1}a.updateStatistics();return a};B.split=function(a,c,b){if(!D(a))return null;const {width:e,height:k}=c;let {width:n,height:l}=a;const h=new Map,d={x:0,y:0};b=null==b?1:1+b;for(let g=0;g<b;g++){const f=Math.ceil(n/e),m=Math.ceil(l/k);for(let q=0;q<m;q++){d.y=q*k;for(let p=0;p<f;p++){d.x=
p*e;const v=V(a,d,c);h.set(`${g}/${q}/${p}`,v)}}g<b-1&&(a=X(a));n=Math.round(n/2);l=Math.round(l/2)}return h};B.stretch=function(a,c){if(!D(a))return null;a=a.clone();const {pixels:b,mask:e}=a,{minCutOff:k,maxCutOff:n,gamma:l}=c,h=c.outMin||0;c=c.outMax||255;const d=a.width*a.height,g=b.length;let f;let m,q,p;const v=c-h,u=[];for(f=0;f<g;f++)u[f]=n[f]-k[f];var r=l&&l.length>=g;const t=[];if(r)for(f=0;f<g;f++)t[f]=1<l[f]?2<l[f]?6.5+Math.pow(l[f]-2,2.5):6.5+100*Math.pow(2-l[f],4):1;if(r)if(null!=e)for(r=
0;r<d;r++){if(e[r])for(f=0;f<g;f++)m=b[f][r],p=(m-k[f])/u[f],q=1,1<l[f]&&(q-=Math.pow(1/v,p*t[f])),b[f][r]=m<n[f]&&m>k[f]?Math.floor(q*v*Math.pow(p,1/l[f]))+h:m>=n[f]?c:h}else for(r=0;r<d;r++)for(f=0;f<g;f++)m=b[f][r],p=(m-k[f])/u[f],q=1,1<l[f]&&(q-=Math.pow(1/v,p*t[f])),b[f][r]=m<n[f]&&m>k[f]?Math.floor(q*v*Math.pow(p,1/l[f]))+h:m>=n[f]?c:h;else if(null!=e)for(r=0;r<d;r++){if(e[r])for(f=0;f<g;f++)m=b[f][r],b[f][r]=m<n[f]&&m>k[f]?Math.floor((m-k[f])/u[f]*v)+h:m>=n[f]?c:h}else for(r=0;r<d;r++)for(f=
0;f<g;f++)m=b[f][r],b[f][r]=m<n[f]&&m>k[f]?Math.floor((m-k[f])/u[f]*v)+h:m>=n[f]?c:h;a.pixelType="u8";a.updateStatistics();return a};Object.defineProperty(B,"__esModule",{value:!0})});