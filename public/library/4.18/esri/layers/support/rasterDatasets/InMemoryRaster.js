// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.18/esri/copyright.txt for details.
//>>built
define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/has ../../../core/maybe ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/property ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../core/Error ../../../core/urlUtils ../../../core/uuid ../../../portal/support/resourceExtension ../../../core/promiseUtils ../../../geometry/SpatialReference ../../../geometry/Extent ../../../geometry ../RasterInfo ../rasterFunctions/pixelUtils ./BaseRaster".split(" "),
function(x,l,e,t,I,J,u,K,y,z,L,M,N,f,A,B,O,C,v,D){e=function(w){function m(){var a=w.apply(this,arguments)||this;a.datasetFormat="MEMORY";return a}x._inheritsLoose(m,w);var n=m.prototype;n.open=async function(a){var b;await this.init();const {pixelBlock:d,statistics:c,histograms:p,name:g,keyProperties:h,nativeExtent:E,transform:F}=this.data,{width:q,height:r,pixelType:G}=d,k=this.data.extent||new B({xmin:-.5,ymin:.5,xmax:q-.5,ymax:r-.5,spatialReference:new A({wkid:3857})}),H=null!=(b=this.data.isPseudoSpatialReference)?
b:!this.data.extent;b=new C({width:q,height:r,pixelType:G,extent:k,nativeExtent:E,transform:F,pixelSize:{x:k.width/q,y:k.height/r},spatialReference:k.spatialReference,bandCount:3,keyProperties:h||{},statistics:c,isPseudoSpatialReference:H,histograms:p});this.createRemoteDatasetStorageInfo(b,512,512);this._set("rasterInfo",b);this.updateTileInfo();await this._buildInMemoryRaster(d,{width:512,height:512},a);this.datasetName=g;this.url="/InMemory/"+g};n.fetchRawTile=function(a,b,d,c){a=this._pixelBlockTiles.get(`${a}/${b}/${d}`);
return f.resolve(a)};n._buildInMemoryRaster=async function(a,b,d){var c=this.rasterInfo.storageInfo.maximumPyramidLevel;const p=this.rasterJobHandler?this.rasterJobHandler.split({pixelBlock:a,tileSize:b,maximumPyramidLevel:c},d):f.resolve(v.split(a,b,c));b=t.isSome(this.rasterInfo.statistics);c=t.isSome(this.rasterInfo.histograms);a=b&&c?f.resolve({statistics:null,histograms:null}):this.rasterJobHandler?this.rasterJobHandler.estimateStatisticsHistograms({pixelBlock:a},d):f.resolve(v.estimateStatisticsHistograms(a));
a=await f.eachAlways([p,a]);if(!a[0].value&&a[1].value)throw new z("inmemory-raster:open","failed to build in memory raster");this._pixelBlockTiles=a[0].value;if(!b){var g;this.rasterInfo.statistics=null==(g=a[1].value)?void 0:g.statistics}if(c){var h;this.rasterInfo.histograms=null==(h=a[1].value)?void 0:h.histograms}};return m}(D);l.__decorate([u.property({type:String,json:{write:!0}})],e.prototype,"datasetFormat",void 0);l.__decorate([u.property()],e.prototype,"data",void 0);return e=l.__decorate([y.subclass("esri.layers.support.rasterDatasets.InMemoryRaster")],
e)});