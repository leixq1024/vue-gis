// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.18/esri/copyright.txt for details.
//>>built
define(["exports","../../../geometry/SpatialReference","../../../geometry","./xmlUtilities","../rasterTransforms/PolynomialTransform"],function(p,n,A,e,w){function q(c,d){if(!c||!d)return null;const b=[];for(let a=0;a<c.length;a++)b.push(c[a]),b.push(d[a]);return b}function x(c){var d,b=e.getElement(c,"GeodataXform");c=e.getElementNumericValue(b,"SpatialReference/WKID")||e.getElementValue(b,"SpatialReference/WKT");c=r(c);if("typens:PolynomialXform"!==b.getAttribute("xsi:type"))return{spatialReference:c,
transform:null};var a=null!=(d=e.getElementNumericValue(b,"PolynomialOrder"))?d:1,f=e.getElementNumericValues(b,"CoeffX/Double");const g=e.getElementNumericValues(b,"CoeffY/Double");d=e.getElementNumericValues(b,"InverseCoeffX/Double");b=e.getElementNumericValues(b,"InverseCoeffY/Double");f=q(f,g);b=q(d,b);a=new w({polynomialOrder:a,forwardCoefficients:f,inverseCoefficients:b});return{spatialReference:c,transform:a}}function y(c){var d;const b=e.getElementNumericValue(c,"NoDataValue");var a=e.getElement(c,
"Histograms/HistItem");const f=e.getElementNumericValue(a,"HistMin"),g=e.getElementNumericValue(a,"HistMax"),z=e.getElementNumericValue(a,"BucketCount");a=null==(d=e.getElementValue(a,"HistCounts"))?void 0:d.split("|").map(h=>Number(h));let k,l,t,u;e.getElements(c,"Metadata/MDI").forEach(h=>{var v;const m=Number(null!=(v=h.textContent)?v:h.nodeValue);switch(h.getAttribute("key").toUpperCase()){case "STATISTICS_MINIMUM":k=m;break;case "STATISTICS_MAXIMUM":l=m;break;case "STATISTICS_MEAN":t=m;break;
case "STATISTICS_STDDEV":u=m}});c=e.getElementNumericValue(c,"Metadata/SourceBandIndex");return{noDataValue:b,histogram:null!=a&&a.length&&null!=k&&null!=l?{min:f,max:g,size:z||a.length,counts:a}:null,sourceBandIndex:c,statistics:null!=k&&null!=l?{min:k,max:l,avg:t,stddev:u}:null}}function r(c){if(!c)return null;var d=Number(c);if(!isNaN(d)&&0!==d)return new n({wkid:d});d=c.replace(/\]/g,"[").replace(/"/g,"").split("[").map(b=>b.trim()).filter(b=>""!==b);d=d[d.length-1].split(",");return"EPSG"!==
d[0]||(d=Number(d[1]),isNaN(d)||0===d)?new n({wkt:c}):new n({wkid:d})}p.parsePAMInfo=function(c){var d;if("pamdataset"!==(null==c?void 0:null==(d=c.documentElement.tagName)?void 0:d.toLowerCase()))return{};const b={spatialReference:null,transform:null,metadata:{},rasterBands:[],statistics:null,histograms:null};c.documentElement.childNodes.forEach(a=>{if(1===a.nodeType)if(e.isSameTagIgnoreNS(a,"SRS"))b.spatialReference||(a=e.getElementValue(a),b.spatialReference=r(a));else if(e.isSameTagIgnoreNS(a,
"Metadata"))if("xml:ESRI"===a.getAttribute("domain")){const {spatialReference:f,transform:g}=x(a);b.transform=g;b.spatialReference||(b.spatialReference=f)}else e.getElements(a,"MDI").forEach(f=>b.metadata[f.getAttribute("key")]=e.getElementValue(f));else e.isSameTagIgnoreNS(a,"PAMRasterBand")&&(a=y(a),null!=a.sourceBandIndex&&null==b.rasterBands[a.sourceBandIndex]?b.rasterBands[a.sourceBandIndex]=a:b.rasterBands.push(a))});if(c=b.rasterBands)b.statistics=c[0].statistics?c.map(a=>a.statistics):null,
b.histograms=c[0].histogram?c.map(a=>a.histogram):null;return b};Object.defineProperty(p,"__esModule",{value:!0})});