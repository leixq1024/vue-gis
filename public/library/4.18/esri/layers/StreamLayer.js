// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.18/esri/copyright.txt for details.
//>>built
define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/global ../core/has ../core/maybe ../core/Logger ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/property ../core/jsonMap ../core/accessorSupport/decorators/reader ../core/accessorSupport/extensions/serializableProperty/reader ../core/accessorSupport/decorators/subclass ../core/accessorSupport/decorators/writer ../core/Error ../core/urlUtils ../core/uuid ../portal/support/resourceExtension ../core/promiseUtils ../geometry/SpatialReference ../geometry/Extent ../geometry ./support/fieldUtils ../PopupTemplate ../request ../chunks/symbols ./Layer ../renderers/Renderer ../renderers/ClassBreaksRenderer ../renderers/UniqueValueRenderer ../renderers/DictionaryRenderer ../renderers/DotDensityRenderer ../renderers/HeatmapRenderer ../renderers/SimpleRenderer ../renderers/support/types ../renderers/support/jsonUtils ../core/MultiOriginJSONSupport ../symbols/support/ElevationInfo ./support/commonProperties ./mixins/OperationalLayer ./support/Field ./support/FieldsIndex ./mixins/ArcGISService ./mixins/BlendLayer ./mixins/PortalLayer ./mixins/RefreshableLayer ./mixins/ScaleRangeLayer ./mixins/TemporalLayer ./support/LabelClass ./support/featureReductionUtils ./support/labelingInfo ../renderers/support/styleUtils ../support/popupUtils ../tasks/support/Query ./support/PurgeOptions".split(" "),
function(v,c,D,w,E,F,x,e,G,n,H,I,p,k,ha,ia,ja,y,z,J,ka,q,K,L,M,b,la,ma,N,na,oa,pa,O,A,r,P,Q,l,R,S,T,U,V,W,X,Y,Z,aa,t,ba,ca,da,ea,B){const fa=F.getLogger("esri.layers.StreamLayer");w=new G.JSONMap({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon"});b=function(C){function m(...a){a=C.call(this,...a)||this;a.copyright=null;a.definitionExpression=null;a.displayField=null;a.elevationInfo=null;a.featureReduction=null;a.fields=null;
a.geometryDefinition=null;a.geometryType=null;a.labelsVisible=!0;a.labelingInfo=null;a.legendEnabled=!0;a.maxReconnectionAttempts=0;a.maxReconnectionInterval=20;a.objectIdField=null;a.operationalLayerType="ArcGISStreamLayer";a.popupEnabled=!0;a.popupTemplate=null;a.purgeOptions=new B;a.screenSizePerspectiveEnabled=!0;a.sourceJSON=null;a.spatialReference=z.WGS84;a.type="stream";a.url=null;a.updateInterval=300;a.webSocketUrl=null;return a}v._inheritsLoose(m,C);var g=m.prototype;g.normalizeCtorArgs=
function(a,d){return"string"===typeof a?{url:a,...d}:a};g.load=function(a){"WebSocket"in D||y.reject(new k("stream-layer:websocket-unsupported","WebSocket is not supported in this browser. StreamLayer will not have real-time connection with the stream service."));const d=E.isSome(a)?a.signal:null;this.addResolvingPromise(this.loadFromPortal({supportedTypes:["Stream Service"]},a).catch(f=>f).then(()=>this._fetchService(d)));return y.resolve(this)};g.readFeatureReduction=function(a,d){return t.read(a,
d)};g.writeWebSceneFeatureReduction=function(a,d,f,h){t.writeTarget(a,d,"layerDefinition.featureReduction",h)};g.readRenderer=function(a,d,f){d=d.layerDefinition||d;if(a=d.drawingInfo&&d.drawingInfo.renderer||void 0)return(a=r.read(a,d,f)||void 0)||fa.error("Failed to create renderer",{rendererDefinition:d.drawingInfo.renderer,layer:this,context:f}),a;if(d.defaultSymbol)return d.types&&d.types.length?new N({defaultSymbol:u(d.defaultSymbol,d,f),field:d.typeIdField,uniqueValueInfos:d.types.map(h=>({id:h.id,
symbol:u(h.symbol,h,f)}))}):new O({symbol:u(d.defaultSymbol,d,f)})};g.writeRenderer=function(a,d,f,h){r.write(a,d,f,h)};g.writeWebSceneRenderer=function(a,d,f,h){r.write(a,d,"layerDefinition.drawingInfo.renderer",h)};g.createPopupTemplate=function(a){return da.createPopupTemplate(this,a)};g.createQuery=function(){const a=new ea;a.returnGeometry=!0;a.outFields=["*"];a.where=this.definitionExpression||"1\x3d1";return a};g.getFieldDomain=function(a,d){if(!this.fields)return null;let f=null;this.fields.some(h=>
{h.name===a&&(f=h.domain);return!!f});return f};g.getField=function(a){return this.fieldsIndex.get(a)};g._fetchService=async function(a){var d;if(this.webSocketUrl){var f;if(null==(f=this.timeInfo)||!f.trackIdField)throw new k("stream-layer:missing-metadata","The stream layer trackIdField must be specified.");if(!this.objectIdField)throw new k("stream-layer:missing-metadata","The stream layer objectIdField must be specified.");if(!this.fields)throw new k("stream-layer:missing-metadata","The stream layer fields must be specified.");
if(!this.geometryType)throw new k("stream-layer:missing-metadata","The stream layer geometryType must be specified.");this.url=this.webSocketUrl}else this.sourceJSON||({data:a}=await L(this.parsedUrl.path,{query:{f:"json",...this.parsedUrl.query},responseType:"json",signal:a}),this.sourceJSON=a);this.sourceJSON={...null!=(d=this.sourceJSON)?d:{},objectIdField:"__esri_stream_id__"};this.read(this.sourceJSON,{origin:"service",url:this.parsedUrl});q.fixRendererFields(this.renderer,this.fields);q.fixTimeInfoFields(this.timeInfo,
this.fields);return ca.loadStyleRenderer(this,{origin:"service"})};v._createClass(m,[{key:"defaultPopupTemplate",get:function(){return this.createPopupTemplate()}},{key:"fieldsIndex",get:function(){return new T(this.fields)}},{key:"renderer",set:function(a){q.fixRendererFields(a,this.fields);this._set("renderer",a)}}]);return m}(V.BlendLayer(Z.TemporalLayer(Y.ScaleRangeLayer(X.RefreshableLayer(U.ArcGISService(R.OperationalLayer(W.PortalLayer(P.MultiOriginJSONMixin(b)))))))));c.__decorate([e.property({type:String})],
b.prototype,"copyright",void 0);c.__decorate([e.property({readOnly:!0,dependsOn:["fields","title"]})],b.prototype,"defaultPopupTemplate",null);c.__decorate([e.property({type:String})],b.prototype,"definitionExpression",void 0);c.__decorate([e.property({type:String})],b.prototype,"displayField",void 0);c.__decorate([e.property({type:Q})],b.prototype,"elevationInfo",void 0);c.__decorate([n.reader("featureReduction",["layerDefinition.featureReduction"])],b.prototype,"readFeatureReduction",null);c.__decorate([p.writer("web-scene",
"featureReduction",{"layerDefinition.featureReduction":{types:t.webSceneFeatureReductionTypes}})],b.prototype,"writeWebSceneFeatureReduction",null);c.__decorate([e.property({type:[S]})],b.prototype,"fields",void 0);c.__decorate([e.property({readOnly:!0,dependsOn:["fields"]})],b.prototype,"fieldsIndex",null);c.__decorate([e.property({type:J})],b.prototype,"geometryDefinition",void 0);c.__decorate([e.property({type:["point","polygon","polyline","multipoint"],json:{read:{reader:w.read}}})],b.prototype,
"geometryType",void 0);c.__decorate([e.property(l.labelsVisible)],b.prototype,"labelsVisible",void 0);c.__decorate([e.property({type:[aa],json:{read:{source:"layerDefinition.drawingInfo.labelingInfo",reader:ba.reader},write:{target:"layerDefinition.drawingInfo.labelingInfo"}}})],b.prototype,"labelingInfo",void 0);c.__decorate([e.property(l.legendEnabled)],b.prototype,"legendEnabled",void 0);c.__decorate([e.property({type:["show","hide"]})],b.prototype,"listMode",void 0);c.__decorate([e.property({type:x.Integer})],
b.prototype,"maxReconnectionAttempts",void 0);c.__decorate([e.property({type:x.Integer})],b.prototype,"maxReconnectionInterval",void 0);c.__decorate([e.property({type:String})],b.prototype,"objectIdField",void 0);c.__decorate([e.property({value:"ArcGISStreamLayer",type:["ArcGISStreamLayer"]})],b.prototype,"operationalLayerType",void 0);c.__decorate([e.property(l.popupEnabled)],b.prototype,"popupEnabled",void 0);c.__decorate([e.property({type:K,json:{read:{source:"popupInfo"},write:{target:"popupInfo"}}})],
b.prototype,"popupTemplate",void 0);c.__decorate([e.property({type:B})],b.prototype,"purgeOptions",void 0);c.__decorate([e.property({types:A.rendererTypes,json:{origins:{service:{write:{target:"drawingInfo.renderer",enabled:!1}}},write:{target:"layerDefinition.drawingInfo.renderer"}}})],b.prototype,"renderer",null);c.__decorate([n.reader("service","renderer",["drawingInfo.renderer","defaultSymbol"]),n.reader("renderer",["layerDefinition.drawingInfo.renderer","layerDefinition.defaultSymbol"])],b.prototype,
"readRenderer",null);c.__decorate([p.writer("renderer")],b.prototype,"writeRenderer",null);c.__decorate([p.writer("web-scene","renderer",{"layerDefinition.drawingInfo.renderer":{types:A.webSceneRendererTypes}})],b.prototype,"writeWebSceneRenderer",null);c.__decorate([e.property(l.screenSizePerspectiveEnabled)],b.prototype,"screenSizePerspectiveEnabled",void 0);c.__decorate([e.property({type:z,json:{origins:{service:{read:{source:"spatialReference"}}}}})],b.prototype,"spatialReference",void 0);c.__decorate([e.property({json:{read:!1}})],
b.prototype,"type",void 0);c.__decorate([e.property(l.url)],b.prototype,"url",void 0);c.__decorate([e.property({type:Number})],b.prototype,"updateInterval",void 0);c.__decorate([e.property({type:String})],b.prototype,"webSocketUrl",void 0);b=c.__decorate([I.subclass("esri.layers.StreamLayer")],b);const u=H.createTypeReader({types:M.symbolTypesRenderer});return b});