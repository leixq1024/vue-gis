// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.18/esri/copyright.txt for details.
//>>built
require({cache:{"esri/geometry/support/scaleUtils":function(){define(["exports","../../core/unitUtils"],function(r,q){function b(d,p){p=q.getMetersPerUnitForSR(p);return d/(p*q.inchesPerMeter*96)}r.getExtentForScale=function(d,p){const x=d.extent;d=d.width;p=b(p,x.spatialReference);return x.clone().expand(p*d/x.width)};r.getResolutionForScale=b;r.getScale=function(d,p){p=p||d.extent;d=d.width;const x=q.getMetersPerUnitForSR(p&&p.spatialReference);return p&&d?p.width/d*x*q.inchesPerMeter*96:0};r.getScaleForResolution=
function(d,p){p=q.getMetersPerUnitForSR(p);return d*p*q.inchesPerMeter*96};Object.defineProperty(r,"__esModule",{value:!0})})},"esri/layers/mixins/ArcGISMapService":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/has ../../core/Logger ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/property ../../core/jsonMap ../../core/accessorSupport/decorators/reader ../../core/accessorSupport/decorators/subclass ../../core/urlUtils ../../core/uuid ../../portal/support/resourceExtension ../../core/promiseUtils ../../geometry/SpatialReference ../../geometry/Extent ../../request ../support/commonProperties".split(" "),
function(r,q,b,d,p,x,g,W,t,da,ia,Q,na,M,U,ba,Z,V){r.ArcGISMapService=B=>{B=function(R){function P(){var k=R.apply(this,arguments)||this;k.capabilities=void 0;k.copyright=null;k.fullExtent=null;k.legendEnabled=!0;k.spatialReference=null;k.version=null;return k}q._inheritsLoose(P,R);var h=P.prototype;h.readCapabilities=function(k,m){var v=m.capabilities&&m.capabilities.split(",").map(S=>S.toLowerCase().trim());if(!v)return{operations:{supportsQuery:!1,supportsExportMap:!1,supportsExportTiles:!1,supportsTileMap:!1},
exportMap:null,exportTiles:null};k=this.type;const z=-1!==v.indexOf("query"),J=-1!==v.indexOf("map"),n=!!m.exportTilesAllowed;v=-1!==v.indexOf("tilemap");const w="tile"!==k&&!!m.supportsDynamicLayers,y="tile"!==k&&(!m.tileInfo||w),N="tile"!==k&&(!m.tileInfo||w);return{operations:{supportsQuery:z,supportsExportMap:J,supportsExportTiles:n,supportsTileMap:v},exportMap:J?{supportsSublayersChanges:"tile"!==k,supportsDynamicLayers:w,supportsSublayerVisibility:y,supportsSublayerDefinitionExpression:N}:null,
exportTiles:n?{maxExportTilesCount:+m.maxExportTilesCount}:null}};h.readVersion=function(k,m){(k=m.currentVersion)||(k=m.hasOwnProperty("capabilities")||m.hasOwnProperty("tables")?10:m.hasOwnProperty("supportedImageFormatTypes")?9.31:9.3);return k};h.fetchSublayerInfo=async function(k,m){await this.fetchAllLayersAndTables(m);return this._allLayersAndTablesMap.get(k)};h.fetchAllLayersAndTables=async function(k){await this.load(k);this._allLayersAndTablesPromise||(this._allLayersAndTablesPromise=Z(ia.urlToObject(this.url).path+
"/layers",{responseType:"json",query:{f:"json",...this.customParameters}}).then(v=>{this._allLayersAndTablesMap=new Map;for(const z of v.data.layers)this._allLayersAndTablesMap.set(z.id,z);return{result:v.data}},v=>({error:v})));const m=await this._allLayersAndTablesPromise;M.throwIfAborted(k);if("result"in m)return m.result;throw m.error;};return P}(B);b.__decorate([g.property({readOnly:!0})],B.prototype,"capabilities",void 0);b.__decorate([t.reader("service","capabilities",["capabilities","exportTilesAllowed",
"maxExportTilesCount","supportsDynamicLayers","tileInfo"])],B.prototype,"readCapabilities",null);b.__decorate([g.property({json:{read:{source:"copyrightText"}}})],B.prototype,"copyright",void 0);b.__decorate([g.property({type:ba})],B.prototype,"fullExtent",void 0);b.__decorate([g.property({json:{origins:{service:{read:!1},"portal-item":{read:!1}}}})],B.prototype,"id",void 0);b.__decorate([g.property({type:Boolean,json:{origins:{service:{read:{enabled:!1}}},read:{source:"showLegend"},write:{target:"showLegend"}}})],
B.prototype,"legendEnabled",void 0);b.__decorate([g.property(V.popupEnabled)],B.prototype,"popupEnabled",void 0);b.__decorate([g.property({type:U})],B.prototype,"spatialReference",void 0);b.__decorate([g.property()],B.prototype,"version",void 0);b.__decorate([t.reader("version",["currentVersion","capabilities","tables","supportedImageFormatTypes"])],B.prototype,"readVersion",null);return B=b.__decorate([da.subclass("esri.layers.mixins.ArcGISMapService")],B)};Object.defineProperty(r,"__esModule",{value:!0})})},
"esri/layers/support/Sublayer":function(){define("require ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/has ../../core/lang ../../core/Logger ../../core/accessorSupport/ensureType ../../core/accessorSupport/utils ../../core/accessorSupport/decorators/property ../../core/accessorSupport/decorators/cast ../../core/jsonMap ../../core/accessorSupport/decorators/reader ../../core/accessorSupport/decorators/subclass ../../core/accessorSupport/decorators/writer ../../core/Error ../../core/urlUtils ../../core/uuid ../../core/accessorSupport/PropertyOrigin ../../portal/support/resourceExtension ../../core/promiseUtils ../../geometry/Extent ../../geometry ../../core/Collection ./fieldUtils ../../core/Identifiable ../../PopupTemplate ../../request ../../core/Loadable ../../chunks/symbols ../../renderers/Renderer ../../renderers/ClassBreaksRenderer ../../renderers/UniqueValueRenderer ../../renderers/DictionaryRenderer ../../renderers/DotDensityRenderer ../../renderers/HeatmapRenderer ../../renderers/SimpleRenderer ../../renderers/support/types ../../renderers/support/jsonUtils ../../core/MultiOriginJSONSupport ./Field ./FieldsIndex ./LabelClass ./FeatureType ./source/MapLayerSource ../../chunks/DataLayerSource ../../support/popupUtils ../../tasks/support/Query ../../core/HandleOwner".split(" "),
function(r,q,b,d,p,x,g,W,t,da,ia,Q,na,M,U,ba,Z,V,B,R,P,h,k,m,v,z,J,n,w,y,N,S,T,ja,ea,ka,fa,oa,G,la,ha,X,e,D,H,A,E,Y){function K(C){return C&&"esriSMS"===C.type}function F(C,O,l){var a;return{ignoreOrigin:!0,enabled:l?"map-image"===(null==(a=l.layer)?void 0:a.type)&&(l.writeSublayerStructure||this.originIdOf(O)>=V.nameToId(l.origin)):!1}}function aa(C,O,l){var a;return{enabled:l?"tile"===(null==(a=l.layer)?void 0:a.type)&&this._isOverridden(O):!1}}function L(C,O,l){return{ignoreOrigin:!0,enabled:l&&
l.writeSublayerStructure||!1}}function qa(C,O,l){return{ignoreOrigin:!0,enabled:l?l.writeSublayerStructure||this.originIdOf(O)>=V.nameToId(l.origin):!1}}var ra;const sa=x.getLogger("esri.layers.support.Sublayer");let ta=0;const ma=new Set;ma.add("layer");ma.add("parent");ma.add("loaded");ma.add("loadStatus");ma.add("loadError");ma.add("loadWarnings");d=ra=function(C){function O(a){a=C.call(this,a)||this;a.capabilities=void 0;a.fields=null;a.fullExtent=null;a.globalIdField=null;a.legendEnabled=!0;
a.objectIdField=null;a.popupEnabled=!0;a.popupTemplate=null;a.sourceJSON=null;a.title=null;a.typeIdField=null;a.types=null;return a}q._inheritsLoose(O,C);var l=O.prototype;l.load=async function(a){this.addResolvingPromise((async()=>{var c;if(!this.layer&&!this.url)throw new U("sublayer:missing-layer","Sublayer can't be loaded without being part of a layer",{sublayer:this});let f=null;if(!this.layer||2<this.originIdOf("url")||"data-layer"===(null==(c=this.source)?void 0:c.type))f=(await J(this.url,
{responseType:"json",query:{f:"json"},...a})).data;else{var u;c=this.id;"map-layer"===(null==(u=this.source)?void 0:u.type)&&(c=this.source.mapLayerId);f=await this.layer.fetchSublayerInfo(c,a)}f&&(this.sourceJSON=f,this.read({layerDefinition:f},{origin:"service"}))})());return this};l.readCapabilities=function(a,c){c=c.layerDefinition||c;a=(a=c.capabilities||a)?a.toLowerCase().split(",").map(f=>f.trim()):[];return{exportMap:{supportsModification:!!c.canModifyLayer},operations:{supportsQuery:-1!==
a.indexOf("query")}}};l.readGlobalIdFieldFromService=function(a,c){c=c.layerDefinition||c;if(c.globalIdField)return c.globalIdField;if(c.fields)for(const f of c.fields)if("esriFieldTypeGlobalID"===f.type)return f.name};l.writeLabelingInfo=function(a,c,f,u){a&&a.length&&(c.layerDefinition={drawingInfo:{labelingInfo:a.map(I=>I.write({},u))}})};l.readMinScale=function(a,c){return c.minScale||c.layerDefinition&&c.layerDefinition.minScale||0};l.readMaxScale=function(a,c){return c.maxScale||c.layerDefinition&&
c.layerDefinition.maxScale||0};l.readObjectIdFieldFromService=function(a,c){c=c.layerDefinition||c;if(c.objectIdField)return c.objectIdField;if(c.fields)for(const f of c.fields)if("esriFieldTypeOID"===f.type)return f.name};l.readOpacity=function(a,c){a=c.layerDefinition;return 1-.01*(null!=a.transparency?a.transparency:a.drawingInfo.transparency)};l.writeOpacity=function(a,c,f,u){c.layerDefinition={drawingInfo:{transparency:100-100*a}}};l.writeParent=function(a,c){c.parentLayerId=this.parent&&this.parent!==
this.layer?g.ensureInteger(this.parent.id):-1};l.castSublayers=function(a){return g.ensureType(k.ofType(ra),a)};l.writeSublayers=function(a,c,f){this.get("sublayers.length")&&(c[f]=this.sublayers.map(u=>u.id).toArray().reverse())};l.readTypeIdField=function(a,c){c=c.layerDefinition||c;if(a=c.typeIdField)if(c=m.getField(c.fields,a))return c.name;return null};l.writeVisible=function(a,c,f,u){c[f]=this.getAtOrigin("defaultVisibility","service")||a};l.clone=function(){const {store:a}=W.getProperties(this),
c=new ra;W.getProperties(c).store=a.clone(ma);this.url;c._lastParsedUrl=this._lastParsedUrl;return c};l.createPopupTemplate=function(a){return A.createPopupTemplate(this,a)};l.createQuery=function(){return new E({returnGeometry:!0,where:this.definitionExpression||"1\x3d1"})};l.createFeatureLayer=async function(){var a,c;if(this.hasOwnProperty("sublayers"))return null;const f=null==(a=this.layer)?void 0:a.parsedUrl;a=new (await new Promise(function(u,I){r(["../FeatureLayer"],function(ca){u(Object.freeze({__proto__:null,
"default":ca}))},I)})).default({url:f.path});f&&this.source&&("map-layer"===this.source.type?a.layerId=this.source.mapLayerId:a.dynamicDataSource=this.source);null!=this.layer.refreshInterval&&(a.refreshInterval=this.layer.refreshInterval);this.definitionExpression&&(a.definitionExpression=this.definitionExpression);2<this.originIdOf("labelingInfo")&&(a.labelingInfo=p.clone(this.labelingInfo));0<this.originIdOf("labelsVisible")&&(a.labelsVisible=this.labelsVisible);0<this.originIdOf("legendEnabled")&&
(a.legendEnabled=this.legendEnabled);0<this.originIdOf("visible")&&(a.visible=this.visible);0<this.originIdOf("minScale")&&(a.minScale=this.minScale);0<this.originIdOf("maxScale")&&(a.maxScale=this.maxScale);0<this.originIdOf("opacity")&&(a.opacity=this.opacity);0<this.originIdOf("popupTemplate")&&(a.popupTemplate=p.clone(this.popupTemplate));2<this.originIdOf("renderer")&&(a.renderer=p.clone(this.renderer));"data-layer"===(null==(c=this.source)?void 0:c.type)&&(a.dynamicDataSource=this.source.clone());
0<this.originIdOf("title")&&(a.title=this.title);"map-image"===this.layer.type&&0<this.layer.originIdOf("customParameters")&&(a.customParameters=this.layer.customParameters);"tile"===this.layer.type&&0<this.layer.originIdOf("customParameters")&&(a.customParameters=this.layer.customParameters);return a};l.getFeatureType=function(a){const {typeIdField:c,types:f}=this;if(!c||!a)return null;const u=a.attributes?a.attributes[c]:void 0;if(null==u)return null;let I=null;f.some(ca=>{const {id:pa}=ca;if(null==
pa)return!1;pa.toString()===u.toString()&&(I=ca);return!!I});return I};l.getFieldDomain=function(a,c){return(c=this.getFeatureType(c&&c.feature))&&(c=c.domains&&c.domains[a])&&"inherited"!==c.type?c:this._getLayerDomain(a)};l.queryFeatures=function(a=this.createQuery(),c){return this.load().then(()=>{if(!this.get("capabilities.operations.supportsQuery"))throw new U("Sublayer.queryFeatures","this layer doesn't support queries.");return R.all([new Promise(function(f,u){r(["../../tasks/operations/query"],
f,u)}),new Promise(function(f,u){r(["../../tasks/support/FeatureSet"],function(I){f(Object.freeze({__proto__:null,"default":I}))},u)})])}).then(([{executeQuery:f},{default:u}])=>f(this.url,E.from(a),this.layer?this.layer.spatialReference:null,{...c,query:{...this.layer.customParameters}}).then(I=>u.fromJSON(I.data))).then(f=>{f&&f.features&&f.features.forEach(u=>{u.sourceLayer=this});return f})};l.toExportImageJSON=function(){var a;const c={id:this.id,source:(null==(a=this.source)?void 0:a.toJSON())||
{mapLayerId:this.id,type:"mapLayer"}};this.definitionExpression&&(c.definitionExpression=this.definitionExpression);const f=["renderer","labelingInfo","opacity","labelsVisible"].reduce((u,I)=>{u[I]=this.originIdOf(I);return u},{});Object.keys(f).some(u=>2<f[u])&&(a=c.drawingInfo={},2<f.renderer&&(a.renderer=this.renderer?this.renderer.toJSON():null),2<f.labelsVisible&&(a.showLabels=this.labelsVisible),this.labelsVisible&&2<f.labelingInfo&&(a.labelingInfo=this.labelingInfo?this.labelingInfo.map(u=>
u.write({},{origin:"service"})):null,a.showLabels=!0),2<f.opacity&&(a.transparency=100-100*this.opacity),this._assignDefaultSymbolColors(a.renderer));return c};l._assignDefaultSymbolColors=function(a){this._forEachSimpleMarkerSymbols(a,c=>{c.color||"esriSMSX"!==c.style&&"esriSMSCross"!==c.style||(c.color=c.outline&&c.outline.color?c.outline.color:[0,0,0,0])})};l._forEachSimpleMarkerSymbols=function(a,c){if(a){const f="uniqueValueInfos"in a?a.uniqueValueInfos:"classBreakInfos"in a?a.classBreakInfos:
[];for(const u of f)K(u.symbol)&&c(u.symbol);"symbol"in a&&K(a.symbol)&&c(a.symbol);"defaultSymbol"in a&&K(a.defaultSymbol)&&c(a.defaultSymbol)}};l._setAndNotifyLayer=function(a,c){const f=this.layer,u=this._get(a);let I,ca;switch(a){case "definitionExpression":I="supportsSublayerDefinitionExpression";case "minScale":case "maxScale":case "visible":I="supportsSublayerVisibility";break;case "labelingInfo":case "labelsVisible":case "opacity":case "renderer":case "source":I="supportsDynamicLayers",ca=
"supportsModification"}const pa=W.getProperties(this).getDefaultOrigin();if("service"!==pa){if(I&&!1===this.get(`layer.capabilities.exportMap.${I}`)){this._logLockedError(a,`capability not available 'layer.capabilities.exportMap.${I}'`);return}if(ca&&!1===this.get(`capabilities.exportMap.${ca}`)){this._logLockedError(a,`capability not available 'capabilities.exportMap.${ca}'`);return}}"source"===a&&"not-loaded"!==this.loadStatus?this._logLockedError(a,"'source' can't be changed after calling sublayer.load()"):
(this._set(a,c),"service"!==pa&&u!==c&&f&&f.emit&&f.emit("sublayer-update",{propertyName:a,target:this}))};l._handleSublayersChange=function(a,c){c&&(c.forEach(f=>{f.parent=null;f.layer=null}),this.handles.removeAll());a&&(a.forEach(f=>{f.parent=this;f.layer=this.layer}),this.handles.add([a.on("after-add",({item:f})=>{f.parent=this;f.layer=this.layer}),a.on("after-remove",({item:f})=>{f.parent=null;f.layer=null}),a.on("before-changes",f=>{const u=this.get("layer.capabilities.exportMap.supportsSublayersChanges");
null==u||u||(sa.error(new U("sublayer:sublayers-non-modifiable","Sublayer can't be added, moved, or removed from the layer's sublayers",{sublayer:this,layer:this.layer})),f.preventDefault())})]))};l._logLockedError=function(a,c){sa.error(new U("sublayer:locked",`Property '${a}' can't be changed on Sublayer from the layer '${this.layer.id}'`,{reason:c,sublayer:this,layer:this.layer}))};l._getLayerDomain=function(a){return(a=this.fieldsIndex.get(a))?a.domain:null};q._createClass(O,[{key:"definitionExpression",
set:function(a){this._setAndNotifyLayer("definitionExpression",a)}},{key:"fieldsIndex",get:function(){return new ha(this.fields||[])}},{key:"id",get:function(){const a=this._get("id");return null==a?ta++:a},set:function(a){this._get("id")!==a&&(!1===this.get("layer.capabilities.exportMap.supportsDynamicLayers")?this._logLockedError("id","capability not available 'layer.capabilities.exportMap.supportsDynamicLayers'"):this._set("id",a))}},{key:"labelingInfo",set:function(a){this._setAndNotifyLayer("labelingInfo",
a)}},{key:"labelsVisible",set:function(a){this._setAndNotifyLayer("labelsVisible",a)}},{key:"layer",set:function(a){this._set("layer",a);this.sublayers&&this.sublayers.forEach(c=>c.layer=a)}},{key:"listMode",set:function(a){this._set("listMode",a)}},{key:"minScale",set:function(a){this._setAndNotifyLayer("minScale",a)}},{key:"maxScale",set:function(a){this._setAndNotifyLayer("maxScale",a)}},{key:"opacity",set:function(a){this._setAndNotifyLayer("opacity",a)}},{key:"defaultPopupTemplate",get:function(){return this.createPopupTemplate()}},
{key:"renderer",set:function(a){if(a)for(const c of a.getSymbols())if(w.isSymbol3D(c)){sa.warn("Sublayer renderer should use 2D symbols");break}this._setAndNotifyLayer("renderer",a)}},{key:"source",get:function(){return this._get("source")||new D.MapLayerSource({mapLayerId:this.id})},set:function(a){this._setAndNotifyLayer("source",a)}},{key:"sublayers",set:function(a){this._handleSublayersChange(a,this._get("sublayers"));this._set("sublayers",a)}},{key:"url",get:function(){var a,c;const f=null!=
(a=null==(c=this.layer)?void 0:c.parsedUrl)?a:this._lastParsedUrl;a=this.source;if(!f)return null;this._lastParsedUrl=f;if("map-layer"===(null==a?void 0:a.type))return`${f.path}/${a.mapLayerId}`;a={layer:JSON.stringify({source:this.source})};return`${f.path}/dynamicLayer?${ba.objectToQuery(a)}`},set:function(a){a?this._override("url",a):this._clearOverride("url")}},{key:"visible",set:function(a){this._setAndNotifyLayer("visible",a)}}]);return O}(Y.HandleOwnerMixin(G.MultiOriginJSONMixin(v.IdentifiableMixin(n))));
d.test={isMapImageLayerOverridePolicy:C=>C===L||C===F,isTileImageLayerOverridePolicy:C=>C===aa};b.__decorate([t.property({readOnly:!0})],d.prototype,"capabilities",void 0);b.__decorate([Q.reader("service","capabilities",["layerDefinition.canModifyLayer","layerDefinition.capabilities"])],d.prototype,"readCapabilities",null);b.__decorate([t.property({type:String,value:null,json:{read:{source:"layerDefinition.definitionExpression"},write:{target:"layerDefinition.definitionExpression",overridePolicy:F}}})],
d.prototype,"definitionExpression",null);b.__decorate([t.property({type:[la],json:{origins:{service:{read:{source:"layerDefinition.fields"}}}}})],d.prototype,"fields",void 0);b.__decorate([t.property({readOnly:!0,dependsOn:["fields"]})],d.prototype,"fieldsIndex",null);b.__decorate([t.property({type:P,json:{read:{source:"layerDefinition.extent"}}})],d.prototype,"fullExtent",void 0);b.__decorate([t.property({type:String})],d.prototype,"globalIdField",void 0);b.__decorate([Q.reader("service","globalIdField",
["layerDefinition.globalIdField","layerDefinition.fields"])],d.prototype,"readGlobalIdFieldFromService",null);b.__decorate([t.property({type:g.Integer,json:{write:{ignoreOrigin:!0}}})],d.prototype,"id",null);b.__decorate([t.property({value:null,type:[X],json:{read:{source:"layerDefinition.drawingInfo.labelingInfo"},write:{target:"layerDefinition.drawingInfo.labelingInfo",overridePolicy:L}}})],d.prototype,"labelingInfo",null);b.__decorate([M.writer("labelingInfo")],d.prototype,"writeLabelingInfo",
null);b.__decorate([t.property({type:Boolean,value:!0,json:{read:{source:"layerDefinition.drawingInfo.showLabels"},write:{target:"layerDefinition.drawingInfo.showLabels",overridePolicy:L}}})],d.prototype,"labelsVisible",null);b.__decorate([t.property({value:null})],d.prototype,"layer",null);b.__decorate([t.property({type:Boolean,value:!0,json:{origins:{service:{read:{enabled:!1}}},read:{source:"showLegend"},write:{target:"showLegend",overridePolicy:qa}}})],d.prototype,"legendEnabled",void 0);b.__decorate([t.property({type:["show",
"hide","hide-children"],value:"show",json:{read:!1,write:!1,origins:{"web-scene":{read:!0,write:!0}}}})],d.prototype,"listMode",null);b.__decorate([t.property({type:Number,value:0,json:{write:{overridePolicy:L}}})],d.prototype,"minScale",null);b.__decorate([Q.reader("minScale",["minScale","layerDefinition.minScale"])],d.prototype,"readMinScale",null);b.__decorate([t.property({type:Number,value:0,json:{write:{overridePolicy:L}}})],d.prototype,"maxScale",null);b.__decorate([Q.reader("maxScale",["maxScale",
"layerDefinition.maxScale"])],d.prototype,"readMaxScale",null);b.__decorate([t.property({type:String})],d.prototype,"objectIdField",void 0);b.__decorate([Q.reader("service","objectIdField",["layerDefinition.objectIdField","layerDefinition.fields"])],d.prototype,"readObjectIdFieldFromService",null);b.__decorate([t.property({type:Number,value:1,json:{write:{target:"layerDefinition.drawingInfo.transparency",overridePolicy:L}}})],d.prototype,"opacity",null);b.__decorate([Q.reader("opacity",["layerDefinition.drawingInfo.transparency",
"layerDefinition.transparency"])],d.prototype,"readOpacity",null);b.__decorate([M.writer("opacity")],d.prototype,"writeOpacity",null);b.__decorate([t.property({json:{type:g.Integer,write:{target:"parentLayerId",allowNull:!0,overridePolicy:L}}})],d.prototype,"parent",void 0);b.__decorate([M.writer("parent")],d.prototype,"writeParent",null);b.__decorate([t.property({type:Boolean,value:!0,json:{read:{source:"disablePopup",reader(C,O){return!O.disablePopup}},write:{target:"disablePopup",overridePolicy:qa,
writer(C,O,l){O[l]=!C}}}})],d.prototype,"popupEnabled",void 0);b.__decorate([t.property({type:z,json:{read:{source:"popupInfo"},write:{target:"popupInfo",overridePolicy:qa}}})],d.prototype,"popupTemplate",void 0);b.__decorate([t.property({readOnly:!0,dependsOn:["fields","title"]})],d.prototype,"defaultPopupTemplate",null);b.__decorate([t.property({types:fa.rendererTypes,value:null,json:{name:"layerDefinition.drawingInfo.renderer",write:{overridePolicy:L},origins:{"web-scene":{types:fa.webSceneRendererTypes,
name:"layerDefinition.drawingInfo.renderer",write:{overridePolicy:L}}}}})],d.prototype,"renderer",null);b.__decorate([t.property({types:{key:"type",base:null,typeMap:{"data-layer":H.DataLayerSource,"map-layer":D.MapLayerSource}},cast(C){if(C){if("mapLayerId"in C)return g.ensureClass(D.MapLayerSource,C);if("dataSource"in C)return g.ensureClass(H.DataLayerSource,C)}return C},json:{name:"layerDefinition.source",write:{overridePolicy:L}}})],d.prototype,"source",null);b.__decorate([t.property()],d.prototype,
"sourceJSON",void 0);b.__decorate([t.property({value:null,json:{type:[g.Integer],write:{target:"subLayerIds",allowNull:!0,overridePolicy:L}}})],d.prototype,"sublayers",null);b.__decorate([da.cast("sublayers")],d.prototype,"castSublayers",null);b.__decorate([M.writer("sublayers")],d.prototype,"writeSublayers",null);b.__decorate([t.property({type:String,json:{read:{source:"name"},write:{target:"name",allowNull:!0,overridePolicy:qa}}})],d.prototype,"title",void 0);b.__decorate([t.property({type:String})],
d.prototype,"typeIdField",void 0);b.__decorate([Q.reader("typeIdField",["layerDefinition.typeIdField"])],d.prototype,"readTypeIdField",null);b.__decorate([t.property({type:[e],json:{origins:{service:{read:{source:"layerDefinition.types"}}}}})],d.prototype,"types",void 0);b.__decorate([t.property({type:String,dependsOn:["layer","source"],json:{read:{source:"layerUrl"},write:{target:"layerUrl",overridePolicy:aa}}})],d.prototype,"url",null);b.__decorate([t.property({type:Boolean,value:!0,json:{read:{source:"defaultVisibility"},
write:{target:"defaultVisibility",overridePolicy:L}}})],d.prototype,"visible",null);b.__decorate([M.writer("visible")],d.prototype,"writeVisible",null);return d=ra=b.__decorate([na.subclass("esri.layers.support.Sublayer")],d)})},"esri/layers/support/sublayerUtils":function(){define(["exports"],function(r){function q(b,d){if(!b||!b.length)return!0;d=d.slice().reverse().flatten(({sublayers:g})=>g&&g.toArray().reverse()).map(g=>g.id).toArray();if(b.length>d.length)return!1;let p=0;const x=d.length;for(const {id:g}of b){for(;p<
x&&d[p]!==g;)p++;if(p>=x)return!1}return!0}r.isExportDynamic=function(b,d,p){return b.some(x=>{const g=x.source;return!(!g||"map-layer"===g.type&&g.mapLayerId===x.id&&(!g.gdbVersion||g.gdbVersion===p.gdbVersion))||2<x.originIdOf("renderer")||2<x.originIdOf("labelingInfo")||2<x.originIdOf("opacity")||2<x.originIdOf("labelsVisible")})?!0:!q(b,d)};r.isSublayerOverhaul=function(b){return!!b&&b.some(d=>null!=d.minScale||d.layerDefinition&&null!=d.layerDefinition.minScale)};r.shouldWriteSublayerStructure=
function(b,d,p){return d.flatten(({sublayers:x})=>x).length!==b.length||b.some(x=>x.originIdOf("minScale")>p||x.originIdOf("maxScale")>p||x.originIdOf("renderer")>p||x.originIdOf("labelingInfo")>p||x.originIdOf("opacity")>p||x.originIdOf("labelsVisible")>p||x.originIdOf("source")>p)?!0:!q(b,d)};Object.defineProperty(r,"__esModule",{value:!0})})},"esri/layers/mixins/SublayersOwner":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/has ../../core/Logger ../../core/accessorSupport/ensureType ../../core/accessorSupport/utils ../../core/accessorSupport/decorators/property ../../core/jsonMap ../../core/accessorSupport/decorators/subclass ../../core/Error ../../core/urlUtils ../../core/uuid ../../core/accessorSupport/PropertyOrigin ../../portal/support/resourceExtension ../../core/Collection ../../core/CollectionFlattener ../support/Sublayer ../support/sublayerUtils".split(" "),
function(r,q,b,d,p,x,g,W,t,da,ia,Q,na,M,U,ba,Z,V,B){function R(m,v){const z=[],J={};if(!m)return z;m.forEach(n=>{const w=new V;w.read(n,v);J[w.id]=w;null!=n.parentLayerId&&-1!==n.parentLayerId?(n=J[n.parentLayerId],n.sublayers||(n.sublayers=[]),n.sublayers.unshift(w)):z.unshift(w)});return z}function P(m,v){m&&m.forEach(z=>{v(z);z.sublayers&&z.sublayers.length&&P(z.sublayers,v)})}const h=p.getLogger("esri.layers.TileLayer"),k=ba.ofType(V);r.SublayersOwner=m=>{m=function(v){function z(...n){var w=
v.call(this,...n)||this;w.allSublayers=new Z({root:q._assertThisInitialized(w),rootCollectionNames:["sublayers"],getChildrenFunction(y){return y.sublayers}});w.sublayersSourceJSON={[2]:{},[3]:{},[4]:{},[5]:{}};w.watch("sublayers",(y,N)=>w._handleSublayersChange(y,N),!0);return w}q._inheritsLoose(z,v);var J=z.prototype;J.readSublayers=function(n,w){if(w&&n){var {sublayersSourceJSON:y}=this,N=M.nameToId(w.origin);if(!(2>N||(y[N]={context:w,visibleLayers:n.visibleLayers||y[N].visibleLayers,layers:n.layers||
y[N].layers},2<N))){this._set("serviceSublayers",this.createSublayersForOrigin("service").sublayers);var {sublayers:S,origin:T}=this.createSublayersForOrigin("web-document");n=g.getProperties(this);n.setDefaultOrigin(T);this._set("sublayers",new k(S));n.setDefaultOrigin("user")}}};J.findSublayerById=function(n){return this.allSublayers.find(w=>w.id===n)};J.createServiceSublayers=function(){return this.createSublayersForOrigin("service").sublayers};J.createSublayersForOrigin=function(n){const w="web-document"===
n?M.nameToId("web-map"):M.nameToId(n);let y=2;n=this.sublayersSourceJSON[2].layers;let N=this.sublayersSourceJSON[2].context,S=null;var T=[3,4,5].filter(G=>G<=w);for(var ja of T)T=this.sublayersSourceJSON[ja],B.isSublayerOverhaul(T.layers)&&(y=ja,n=T.layers,N=T.context,T.visibleLayers&&(S={visibleLayers:T.visibleLayers,context:T.context}));ja=[3,4,5].filter(G=>G>y&&G<=w);let ea=null;for(var ka of ja){const {layers:G,visibleLayers:la,context:ha}=this.sublayersSourceJSON[ka];G&&(ea={layers:G,context:ha});
la&&(S={visibleLayers:la,context:ha})}ka=R(n,N);const fa=new Map,oa=new Set;if(ea)for(const G of ea.layers)fa.set(G.id,G);if(S)for(const G of S.visibleLayers)oa.add(G);P(ka,G=>{ea&&G.read(fa.get(G.id),ea.context);S&&G.read({defaultVisibility:oa.has(G.id)},S.context)});return{origin:M.idToName(y),sublayers:new k({items:ka})}};J.read=function(n,w){v.prototype.read.call(this,n,w);this.readSublayers(n,w)};J._handleSublayersChange=function(n,w){w&&(w.forEach(y=>{y.parent=null;y.layer=null}),this.handles.remove("sublayers-owner"));
n&&(n.forEach(y=>{y.parent=this;y.layer=this}),this.handles.add([n.on("after-add",({item:y})=>{y.parent=this;y.layer=this}),n.on("after-remove",({item:y})=>{y.parent=null;y.layer=null})],"sublayers-owner"),"tile"===this.type&&this.handles.add(n.on("before-changes",y=>{h.error(new ia("tilelayer:sublayers-non-modifiable","Sublayer can't be added, moved, or removed from the layer's sublayers",{layer:this}));y.preventDefault()}),"sublayers-owner"))};return z}(m);b.__decorate([W.property({readOnly:!0})],
m.prototype,"allSublayers",void 0);b.__decorate([W.property({readOnly:!0,type:ba.ofType(V)})],m.prototype,"serviceSublayers",void 0);b.__decorate([W.property({value:null,type:k,json:{read:!1,write:{allowNull:!0,ignoreOrigin:!0}}})],m.prototype,"sublayers",void 0);b.__decorate([W.property({readOnly:!0})],m.prototype,"sublayersSourceJSON",void 0);return m=b.__decorate([da.subclass("esri.layers.mixins.SublayersOwner")],m)};r.forEachSublayer=P;Object.defineProperty(r,"__esModule",{value:!0})})},"esri/layers/support/ExportImageParameters":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/has ../../core/Logger ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/property ../../core/jsonMap ../../core/accessorSupport/decorators/subclass ../../core/urlUtils ../../core/uuid ../../portal/support/resourceExtension ../../core/Accessor ./commonProperties ../../core/HandleOwner ./sublayerUtils ../../views/View".split(" "),
function(r,q,b,d,p,x,g,W,t,da,ia,Q,na,M,U,ba,Z){const V={visible:"visibleSublayers",definitionExpression:"layerDefs",labelingInfo:"hasDynamicLayers",labelsVisible:"hasDynamicLayers",opacity:"hasDynamicLayers",minScale:"visibleSublayers",maxScale:"visibleSublayers",renderer:"hasDynamicLayers",source:"hasDynamicLayers"};r.ExportImageParameters=function(B){function R(){var h=B.apply(this,arguments)||this;h._scale=null;h.view=null;return h}q._inheritsLoose(R,B);var P=R.prototype;P.destroy=function(){this.layer=
this.view=null};P.toJSON=function(){var h=this.layer;h={dpi:h.dpi,format:h.imageFormat,transparent:h.imageTransparency,gdbVersion:h.gdbVersion||null};this.hasDynamicLayers&&this.dynamicLayers?h.dynamicLayers=this.dynamicLayers:h={...h,layers:this.layers,layerDefs:this.layerDefs};return h};q._createClass(R,[{key:"dynamicLayers",get:function(){if(!this.hasDynamicLayers)return null;const h=this.visibleSublayers.map(k=>k.toExportImageJSON());return h.length?JSON.stringify(h):null}},{key:"hasDynamicLayers",
get:function(){return this.layer&&ba.isExportDynamic(this.visibleSublayers,this.layer.serviceSublayers,this.layer)}},{key:"layer",set:function(h){this._get("layer")!==h&&(this._set("layer",h),this.handles.remove("layer"),h&&this.handles.add([h.allSublayers.on("change",()=>this.notifyChange("visibleSublayers")),h.on("sublayer-update",k=>this.notifyChange(V[k.propertyName]))],"layer"))}},{key:"layers",get:function(){const h=this.visibleSublayers;return h?h.length?"show:"+h.map(k=>k.id).join(","):"show:-1":
null}},{key:"layerDefs",get:function(){const h=this.visibleSublayers.filter(k=>null!=k.definitionExpression);return h.length?JSON.stringify(h.reduce((k,m)=>{k[m.id]=m.definitionExpression;return k},{})):null}},{key:"scale",get:function(){return null!=this._scale?this._scale:this.view&&this.view.scale||0},set:function(h){this.view||(this._scale=h,this.notifyChange("scale"))}},{key:"version",get:function(){this.layers;this.layerDefs;this.dynamicLayers;this.timeExtent;const h=this.layer;h&&(h.dpi,h.imageFormat,
h.imageTransparency,h.gdbVersion);return(this._get("version")||0)+1},set:function(h){this._set("version",h)}},{key:"visibleSublayers",get:function(){const h=[];if(!this.layer)return h;var k=this.layer.sublayers;const m=v=>{const z=this.scale,J=0===v.minScale||z<=v.minScale,n=0===v.maxScale||z>=v.maxScale;v.visible&&(0===z||J&&n)&&(v.sublayers?v.sublayers.forEach(m):h.unshift(v))};k&&k.forEach(m);k=this._get("visibleSublayers");return!k||k.length!==h.length||k.some((v,z)=>h[z]!==v)?h:k}}]);return R}(U.HandleOwnerMixin(na));
b.__decorate([g.property({readOnly:!0,dependsOn:["hasDynamicLayers","visibleSublayers"]})],r.ExportImageParameters.prototype,"dynamicLayers",null);b.__decorate([g.property({readOnly:!0,dependsOn:["visibleSublayers","layer.serviceSublayers","layer.capabilities"]})],r.ExportImageParameters.prototype,"hasDynamicLayers",null);b.__decorate([g.property()],r.ExportImageParameters.prototype,"layer",null);b.__decorate([g.property({readOnly:!0,dependsOn:["visibleSublayers"]})],r.ExportImageParameters.prototype,
"layers",null);b.__decorate([g.property({readOnly:!0,dependsOn:["visibleSublayers"]})],r.ExportImageParameters.prototype,"layerDefs",null);b.__decorate([g.property({type:Number,dependsOn:["view.scale"]})],r.ExportImageParameters.prototype,"scale",null);b.__decorate([g.property(M.combinedViewLayerTimeExtentProperty)],r.ExportImageParameters.prototype,"timeExtent",void 0);b.__decorate([g.property({dependsOn:"layers layerDefs dynamicLayers layer.dpi layer.imageFormat layer.imageTransparency layer.gdbVersion timeExtent".split(" ")})],
r.ExportImageParameters.prototype,"version",null);b.__decorate([g.property({type:Z})],r.ExportImageParameters.prototype,"view",void 0);b.__decorate([g.property({readOnly:!0,dependsOn:["layer.sublayers","scale"]})],r.ExportImageParameters.prototype,"visibleSublayers",null);r.ExportImageParameters=b.__decorate([t.subclass("esri.layers.mixins.ExportImageParameters")],r.ExportImageParameters);Object.defineProperty(r,"__esModule",{value:!0})})},"*noref":1}});
define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/has ../core/maybe ../core/Logger ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/property ../core/jsonMap ../core/accessorSupport/decorators/reader ../core/accessorSupport/decorators/subclass ../core/accessorSupport/decorators/writer ../core/Error ../core/urlUtils ../core/uuid ../core/accessorSupport/PropertyOrigin ../portal/support/resourceExtension ../core/promiseUtils ../geometry/Extent ../request ../core/loadAll ./Layer ../TimeExtent ../core/MultiOriginJSONSupport ./support/commonProperties ./mixins/OperationalLayer ./mixins/ArcGISService ./mixins/BlendLayer ./mixins/CustomParametersMixin ./mixins/PortalLayer ./mixins/RefreshableLayer ./mixins/ScaleRangeLayer ./mixins/TemporalLayer ../core/HandleOwner ../geometry/support/scaleUtils ./mixins/ArcGISMapService ./support/Sublayer ./support/sublayerUtils ./mixins/SublayersOwner ./support/ExportImageParameters".split(" "),function(r,
q,b,d,p,x,g,W,t,da,ia,Q,na,M,U,ba,Z,V,B,R,P,h,k,m,v,z,J,n,w,y,N,S,T,ja,ea,ka,fa,oa,G){b=function(la){function ha(...e){e=la.call(this,...e)||this;e.alwaysRefetch=!1;e.dpi=96;e.gdbVersion=null;e.imageFormat="png24";e.imageMaxHeight=2048;e.imageMaxWidth=2048;e.imageTransparency=!0;e.labelsVisible=!1;e.isReference=null;e.operationalLayerType="ArcGISMapServiceLayer";e.sourceJSON=null;e.sublayers=null;e.type="map-image";e.url=null;return e}r._inheritsLoose(ha,la);var X=ha.prototype;X.normalizeCtorArgs=
function(e,D){return"string"===typeof e?{url:e,...D}:e};X.load=function(e){const D=d.isSome(e)?e.signal:null;this.addResolvingPromise(this.loadFromPortal({supportedTypes:["Map Service"]},e).then(()=>this._fetchService(D),()=>this._fetchService(D)));return Z.resolve(this)};X.readImageFormat=function(e,D){return(e=D.supportedImageFormatTypes)&&-1<e.indexOf("PNG32")?"png32":"png24"};X.writeSublayers=function(e,D,H,A){if(this.loaded&&e){e=e.slice().reverse().flatten(({sublayers:F})=>F&&F.toArray().reverse()).toArray();
H=!1;if(this.capabilities&&this.capabilities.operations.supportsExportMap&&this.capabilities.exportMap.supportsDynamicLayers){const F=U.nameToId(A.origin);3===F?(H=this.createSublayersForOrigin("service").sublayers,H=fa.shouldWriteSublayerStructure(e,H,2)):3<F&&(H=this.createSublayersForOrigin("portal-item"),H=fa.shouldWriteSublayerStructure(e,H.sublayers,U.nameToId(H.origin)))}var E=[],Y={writeSublayerStructure:H,...A},K=H;e.forEach(F=>{const aa=F.write({},Y);E.push(aa);K=K||"user"===F.originOf("visible")});
E.some(F=>1<Object.keys(F).length)&&(D.layers=E);K&&(D.visibleLayers=e.filter(F=>F.visible).map(F=>F.id))}};X.createExportImageParameters=function(e,D,H,A){var E=A&&A.pixelRatio||1;e&&10<=this.version&&(e=e.clone().shiftCentralMeridian());var Y=new G.ExportImageParameters({layer:this,scale:ja.getScale({extent:e,width:D})*E});const K=Y.toJSON();Y.destroy();Y=!A||!A.rotation||10.3>this.version?{}:{rotation:-A.rotation};var F=e&&e.spatialReference;F=F.wkid||JSON.stringify(F.toJSON());K.dpi*=E;E={};if(null!=
A&&A.timeExtent){const {start:aa,end:L}=A.timeExtent.toJSON();E.time=aa&&L&&aa===L?""+aa:`${null==aa?"null":aa},${null==L?"null":L}`}else this.timeInfo&&!this.timeInfo.hasLiveData&&(E.time="null,null");return{bbox:e&&e.xmin+","+e.ymin+","+e.xmax+","+e.ymax,bboxSR:F,imageSR:F,size:D+","+H,...K,...Y,...E}};X.fetchImage=async function(e,D,H,A){const E={responseType:"image"};A&&A.timestamp&&(E.query={...E.query,_ts:A.timestamp});A&&A.signal&&(E.signal=A.signal);this.customParameters&&Object.keys(this.customParameters).length&&
(E.query={...this.customParameters,...E.query});const Y=this.parsedUrl.path+"/export";e={...this.parsedUrl.query,...this.createExportImageParameters(e,D,H,A),f:"image",_ts:this.alwaysRefetch?Date.now():null};if(null!=e.dynamicLayers&&!this.capabilities.exportMap.supportsDynamicLayers)return Z.reject(new Q("mapimagelayer:dynamiclayer-not-supported",`service ${this.url} doesn't support dynamic layers, which is required to be able to change the sublayer's order, rendering, labeling or source.`,{query:e}));
E.query=E.query?{...e,...E.query}:e;return B(Y,E).then(K=>K.data).catch(K=>{if(Z.isAbortError(K))throw K;throw new Q("mapimagelayer:image-fetch-error",`Unable to load image: ${Y}`,{error:K});})};X.fetchRecomputedExtents=async function(e={}){({data:e}=await B(this.url,{...e,query:{returnUpdates:!0,f:"json"}}));const {extent:D,fullExtent:H,timeExtent:A}=e;e=D||H;return{fullExtent:e&&V.fromJSON(e),timeExtent:A&&h.fromJSON({start:A[0],end:A[1]})}};X.loadAll=function(){return R.loadAll(this,e=>{e(this.allSublayers)})};
X._fetchService=async function(e){if(this.sourceJSON)this.read(this.sourceJSON,{origin:"service",url:this.parsedUrl});else{var {data:D,ssl:H}=await B(this.parsedUrl.path,{query:{f:"json",...this.parsedUrl.query,...this.customParameters},signal:e});H&&(this.url=this.url.replace(/^http:/i,"https:"));this.sourceJSON=D;this.read(D,{origin:"service",url:this.parsedUrl})}};return ha}(J.BlendLayer(S.TemporalLayer(N.ScaleRangeLayer(y.RefreshableLayer(oa.SublayersOwner(ea.ArcGISMapService(z.ArcGISService(v.OperationalLayer(w.PortalLayer(k.MultiOriginJSONMixin(n.CustomParametersMixin(T.HandleOwnerMixin(P)))))))))))));
q.__decorate([g.property()],b.prototype,"alwaysRefetch",void 0);q.__decorate([g.property()],b.prototype,"dpi",void 0);q.__decorate([g.property()],b.prototype,"gdbVersion",void 0);q.__decorate([g.property({json:{read:!1,write:!1}})],b.prototype,"popupEnabled",void 0);q.__decorate([g.property()],b.prototype,"imageFormat",void 0);q.__decorate([t.reader("imageFormat",["supportedImageFormatTypes"])],b.prototype,"readImageFormat",null);q.__decorate([g.property({json:{origins:{service:{read:{source:"maxImageHeight"}}}}})],
b.prototype,"imageMaxHeight",void 0);q.__decorate([g.property({json:{origins:{service:{read:{source:"maxImageWidth"}}}}})],b.prototype,"imageMaxWidth",void 0);q.__decorate([g.property()],b.prototype,"imageTransparency",void 0);q.__decorate([g.property({json:{read:!1,write:!1}})],b.prototype,"labelsVisible",void 0);q.__decorate([g.property({type:Boolean,json:{read:!1,write:{enabled:!0,overridePolicy:()=>({enabled:!1})}}})],b.prototype,"isReference",void 0);q.__decorate([g.property({type:["ArcGISMapServiceLayer"]})],
b.prototype,"operationalLayerType",void 0);q.__decorate([g.property()],b.prototype,"sourceJSON",void 0);q.__decorate([g.property({json:{write:{ignoreOrigin:!0}}})],b.prototype,"sublayers",void 0);q.__decorate([ia.writer("sublayers",{layers:{type:[ka]},visibleLayers:{type:[x.Integer]}})],b.prototype,"writeSublayers",null);q.__decorate([g.property({type:["show","hide","hide-children"]})],b.prototype,"listMode",void 0);q.__decorate([g.property({json:{read:!1},readOnly:!0,value:"map-image"})],b.prototype,
"type",void 0);q.__decorate([g.property(m.url)],b.prototype,"url",void 0);return b=q.__decorate([da.subclass("esri.layers.MapImageLayer")],b)});