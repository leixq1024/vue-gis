// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.18/esri/copyright.txt for details.
//>>built
define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/has ../../core/Logger ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/property ../../core/jsonMap ../../core/accessorSupport/decorators/reader ../../core/accessorSupport/decorators/subclass ../../core/urlUtils ../../core/uuid ../../portal/support/resourceExtension ../../core/promiseUtils ../../geometry/SpatialReference ../../geometry/Extent ../../request ../support/commonProperties".split(" "),
function(m,t,d,E,F,G,f,H,n,u,v,I,J,w,x,y,z,A){m.ArcGISMapService=c=>{c=function(p){function k(){var a=p.apply(this,arguments)||this;a.capabilities=void 0;a.copyright=null;a.fullExtent=null;a.legendEnabled=!0;a.spatialReference=null;a.version=null;return a}t._inheritsLoose(k,p);var g=k.prototype;g.readCapabilities=function(a,b){var e=b.capabilities&&b.capabilities.split(",").map(B=>B.toLowerCase().trim());if(!e)return{operations:{supportsQuery:!1,supportsExportMap:!1,supportsExportTiles:!1,supportsTileMap:!1},
exportMap:null,exportTiles:null};a=this.type;const h=-1!==e.indexOf("query"),q=-1!==e.indexOf("map"),r=!!b.exportTilesAllowed;e=-1!==e.indexOf("tilemap");const l="tile"!==a&&!!b.supportsDynamicLayers,C="tile"!==a&&(!b.tileInfo||l),D="tile"!==a&&(!b.tileInfo||l);return{operations:{supportsQuery:h,supportsExportMap:q,supportsExportTiles:r,supportsTileMap:e},exportMap:q?{supportsSublayersChanges:"tile"!==a,supportsDynamicLayers:l,supportsSublayerVisibility:C,supportsSublayerDefinitionExpression:D}:null,
exportTiles:r?{maxExportTilesCount:+b.maxExportTilesCount}:null}};g.readVersion=function(a,b){(a=b.currentVersion)||(a=b.hasOwnProperty("capabilities")||b.hasOwnProperty("tables")?10:b.hasOwnProperty("supportedImageFormatTypes")?9.31:9.3);return a};g.fetchSublayerInfo=async function(a,b){await this.fetchAllLayersAndTables(b);return this._allLayersAndTablesMap.get(a)};g.fetchAllLayersAndTables=async function(a){await this.load(a);this._allLayersAndTablesPromise||(this._allLayersAndTablesPromise=z(v.urlToObject(this.url).path+
"/layers",{responseType:"json",query:{f:"json",...this.customParameters}}).then(e=>{this._allLayersAndTablesMap=new Map;for(const h of e.data.layers)this._allLayersAndTablesMap.set(h.id,h);return{result:e.data}},e=>({error:e})));const b=await this._allLayersAndTablesPromise;w.throwIfAborted(a);if("result"in b)return b.result;throw b.error;};return k}(c);d.__decorate([f.property({readOnly:!0})],c.prototype,"capabilities",void 0);d.__decorate([n.reader("service","capabilities",["capabilities","exportTilesAllowed",
"maxExportTilesCount","supportsDynamicLayers","tileInfo"])],c.prototype,"readCapabilities",null);d.__decorate([f.property({json:{read:{source:"copyrightText"}}})],c.prototype,"copyright",void 0);d.__decorate([f.property({type:y})],c.prototype,"fullExtent",void 0);d.__decorate([f.property({json:{origins:{service:{read:!1},"portal-item":{read:!1}}}})],c.prototype,"id",void 0);d.__decorate([f.property({type:Boolean,json:{origins:{service:{read:{enabled:!1}}},read:{source:"showLegend"},write:{target:"showLegend"}}})],
c.prototype,"legendEnabled",void 0);d.__decorate([f.property(A.popupEnabled)],c.prototype,"popupEnabled",void 0);d.__decorate([f.property({type:x})],c.prototype,"spatialReference",void 0);d.__decorate([f.property()],c.prototype,"version",void 0);d.__decorate([n.reader("version",["currentVersion","capabilities","tables","supportedImageFormatTypes"])],c.prototype,"readVersion",null);return c=d.__decorate([u.subclass("esri.layers.mixins.ArcGISMapService")],c)};Object.defineProperty(m,"__esModule",{value:!0})});