// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.18/esri/copyright.txt for details.
//>>built
require({cache:{"esri/layers/mixins/ArcGISCachedService":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/has ../../core/Logger ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/property ../../core/jsonMap ../../core/accessorSupport/decorators/reader ../../core/accessorSupport/decorators/subclass ../../core/urlUtils ../../core/uuid ../../portal/support/resourceExtension ../../geometry/SpatialReference ../../geometry ../support/serviceTileInfoProperty ../support/TilemapCache".split(" "),
function(m,v,e,p,E,q,y,w,u,C,I,L,a,d,g,z,P){m.ArcGISCachedService=x=>{x=function(N){function V(){var O=N.apply(this,arguments)||this;O.copyright=null;O.minScale=0;O.maxScale=0;O.spatialReference=null;O.tileInfo=null;O.tilemapCache=null;return O}v._inheritsLoose(V,N);var R=V.prototype;R.readMinScale=function(O,B){return null!=B.minLOD&&null!=B.maxLOD?O:0};R.readMaxScale=function(O,B){return null!=B.minLOD&&null!=B.maxLOD?O:0};R.readTilemapCache=function(O,B){return B.capabilities&&-1<B.capabilities.indexOf("Tilemap")?
new P.TilemapCache({layer:this}):null};v._createClass(V,[{key:"supportsBlankTile",get:function(){return 10.2<=this.version}}]);return V}(x);e.__decorate([y.property({json:{read:{source:"copyrightText"}}})],x.prototype,"copyright",void 0);e.__decorate([y.property()],x.prototype,"minScale",void 0);e.__decorate([u.reader("service","minScale")],x.prototype,"readMinScale",null);e.__decorate([y.property()],x.prototype,"maxScale",void 0);e.__decorate([u.reader("service","maxScale")],x.prototype,"readMaxScale",
null);e.__decorate([y.property({type:d})],x.prototype,"spatialReference",void 0);e.__decorate([y.property({readOnly:!0,dependsOn:["version"]})],x.prototype,"supportsBlankTile",null);e.__decorate([y.property(z.serviceTileInfoProperty)],x.prototype,"tileInfo",void 0);e.__decorate([y.property()],x.prototype,"tilemapCache",void 0);e.__decorate([u.reader("service","tilemapCache",["capabilities"])],x.prototype,"readTilemapCache",null);e.__decorate([y.property()],x.prototype,"version",void 0);return x=e.__decorate([C.subclass("esri.layers.mixins.ArcGISCachedService")],
x)};Object.defineProperty(m,"__esModule",{value:!0})})},"esri/layers/support/serviceTileInfoProperty":function(){define(["exports","./TileInfo"],function(m,v){function e(E,q,y,w){if(!E)return null;const {minScale:u,maxScale:C,minLOD:I,maxLOD:L}=q;if(null!=I&&null!=L)return w&&w.ignoreMinMaxLOD?v.fromJSON(E):v.fromJSON({...E,lods:E.lods.filter(({level:a})=>null!=a&&a>=I&&a<=L)});if(0!==u&&0!==C){const a=u?Math.round(1E4*u)/1E4:Infinity,d=C?Math.round(1E4*C)/1E4:-Infinity;return v.fromJSON({...E,lods:E.lods.filter(g=>
{g=Math.round(1E4*g.scale)/1E4;return g<=a&&g>=d})})}return v.fromJSON(E)}const p={type:v,json:{origins:{service:{read:{source:["tileInfo","minScale","maxScale","minLOD","maxLOD"],reader:e}}}}};m.readServiceTileInfo=e;m.serviceTileInfoProperty=p;Object.defineProperty(m,"__esModule",{value:!0})})},"esri/layers/support/TileInfo":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/has ../../core/Logger ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/property ../../core/jsonMap ../../core/accessorSupport/decorators/reader ../../core/accessorSupport/decorators/subclass ../../core/accessorSupport/decorators/writer ../../core/urlUtils ../../core/uuid ../../portal/support/resourceExtension ../../core/JSONSupport ../../geometry/support/spatialReferenceUtils ../../geometry/SpatialReference ../../geometry/support/webMercatorUtils ../../geometry/Point ../../geometry ../../core/unitUtils ../../geometry/support/aaBoundingRect ./LOD".split(" "),
function(m,v,e,p,E,q,y,w,u,C,I,L,a,d,g,z,P,x,N,V,R,O){var B;e=new y.JSONMap({PNG:"png",PNG8:"png8",PNG24:"png24",PNG32:"png32",JPEG:"jpg",JPG:"jpg",DIB:"dib",TIFF:"tiff",EMF:"emf",PS:"ps",PDF:"pdf",GIF:"gif",SVG:"svg",SVGZ:"svgz",Mixed:"mixed",MIXED:"mixed",LERC:"lerc",LERC2D:"lerc2d",RAW:"raw",pbf:"pbf"});d=B=function(D){function M(f){f=D.call(this,f)||this;f.dpi=96;f.format=null;f.origin=null;f.minScale=0;f.maxScale=0;f.size=null;f.spatialReference=null;return f}m._inheritsLoose(M,D);M.create=function(f=
{size:256,spatialReference:z.WebMercator}){var b=f.resolutionFactor||1,h=f.scales;const l=f.size||256,n=f.spatialReference||z.WebMercator;if(!g.isValid(n)){b=[];if(h)for(f=0;f<h.length;f++){var A=h[f];b.push({level:f,scale:A,resolution:A})}else for(h=5E-4,f=23;0<=f;f--)b.unshift({level:f,scale:h,resolution:h}),h*=2;return new B({dpi:96,lods:b,origin:new x(0,0,n),size:[l,l],spatialReference:n})}A=g.getInfo(n);f=f.origin?new x({x:f.origin.x,y:f.origin.y,spatialReference:n}):A?new x({x:A.origin[0],y:A.origin[1],
spatialReference:n}):new x({x:0,y:0,spatialReference:n});A=1/(39.37*V.getMetersPerUnitForSR(n)*96);const S=[];if(h)for(b=0;b<h.length;b++){var U=h[b];S.push({level:b,scale:U,resolution:U*A})}else{var Q=g.isGeographic(n)?512/l*5.916575275917094E8:256/l*5.91657527591555E8;h=Math.ceil(24/b);S.push({level:0,scale:Q,resolution:Q*A});for(U=1;U<h;U++)Q/=Math.pow(2,b),S.push({level:U,scale:Q,resolution:Q*A})}return new B({dpi:96,lods:S,origin:f,size:[l,l],spatialReference:n})};var H=M.prototype;H.readOrigin=
function(f,b){return x.fromJSON({spatialReference:b.spatialReference,...f})};H.readSize=function(f,b){return[b.cols,b.rows]};H.writeSize=function(f,b){b.cols=f[0];b.rows=f[0]};H.zoomToScale=function(f){const b=this.scales;if(0>=f)return b[0];if(f>=b.length)return b[b.length-1];{const h=Math.round(f);return b[h]+(h-f)*(b[Math.round(f-.5)]-b[h])}};H.scaleToZoom=function(f){const b=this.scales,h=b.length-1;let l=0;for(;l<h;l++){const n=b[l],A=b[l+1];if(n<=f)break;if(A===f)return l+1;if(n>f&&A<f)return l+
1-(f-A)/(n-A)}return l};H.snapScale=function(f,b=.95){f=this.scaleToZoom(f);return f%Math.floor(f)>=b?this.zoomToScale(Math.ceil(f)):this.zoomToScale(Math.floor(f))};H.tileAt=function(f,b,h,l){var n=this.lodAt(f);if(!n)return null;let A;if("number"===typeof b)A=b,b=h;else{if(g.equals(b.spatialReference,this.spatialReference))A=b.x,b=b.y;else{l=P.project(b,this.spatialReference);if(!l)return null;A=l.x;b=l.y}l=h}h=n.resolution*this.size[0];n=n.resolution*this.size[1];l||(l={id:null,level:0,row:0,col:0,
extent:R.create()});l.level=f;l.row=Math.floor((this.origin.y-b)/n+.001);l.col=Math.floor((A-this.origin.x)/h+.001);this.updateTileInfo(l);return l};H.updateTileInfo=function(f){var b=this.lodAt(f.level);if(b){var h=b.resolution*this.size[0];b=b.resolution*this.size[1];f.id=`${f.level}/${f.row}/${f.col}`;f.extent||(f.extent=R.create());f.extent[0]=this.origin.x+f.col*h;f.extent[1]=this.origin.y-(f.row+1)*b;f.extent[2]=f.extent[0]+h;f.extent[3]=f.extent[1]+b}};H.upsampleTile=function(f){const b=this._upsampleLevels[f.level];
if(!b||-1===b.parentLevel)return!1;f.level=b.parentLevel;f.row=Math.floor(f.row/b.factor+.001);f.col=Math.floor(f.col/b.factor+.001);this.updateTileInfo(f);return!0};H.getTileBounds=function(f,b){var {resolution:h}=this.lodAt(b.level);const l=h*this.size[0];h*=this.size[1];f[0]=this.origin.x+b.col*l;f[1]=this.origin.y-(b.row+1)*h;f[2]=f[0]+l;f[3]=f[1]+h;return f};H.lodAt=function(f){return this._levelToLOD&&this._levelToLOD[f]||null};H.clone=function(){return B.fromJSON(this.write({}))};H._initializeUpsampleLevels=
function(){const f=this.lods;this._upsampleLevels=[];let b=null;for(let h=0;h<f.length;h++){const l=f[h];this._upsampleLevels[l.level]={parentLevel:b?b.level:-1,factor:b?b.resolution/l.resolution:0};b=l}};m._createClass(M,[{key:"isWrappable",get:function(){const {spatialReference:f,origin:b}=this;if(f&&b){const h=g.getInfo(f);return f.isWrappable&&Math.abs(h.origin[0]-b.x)<=h.dx}return!1}},{key:"lods",set:function(f){let b=0,h=0;const l=[];this._levelToLOD={};f&&(b=-Infinity,h=Infinity,f.forEach(n=>
{l.push(n.scale);b=n.scale>b?n.scale:b;h=n.scale<h?n.scale:h;this._levelToLOD[n.level]=n}));this._set("scales",l);this._set("minScale",b);this._set("maxScale",h);this._set("lods",f);this._initializeUpsampleLevels()}}]);return M}(d.JSONSupport);v.__decorate([q.property({type:Number,json:{write:!0}})],d.prototype,"compressionQuality",void 0);v.__decorate([q.property({type:Number,json:{write:!0}})],d.prototype,"dpi",void 0);v.__decorate([q.property({type:String,json:{read:e.read,write:e.write,origins:{"web-scene":{read:!1,
write:!1}}}})],d.prototype,"format",void 0);v.__decorate([q.property({readOnly:!0,dependsOn:["spatialReference","origin"]})],d.prototype,"isWrappable",null);v.__decorate([q.property({type:x,json:{write:!0}})],d.prototype,"origin",void 0);v.__decorate([w.reader("origin")],d.prototype,"readOrigin",null);v.__decorate([q.property({type:[O],value:null,json:{write:!0}})],d.prototype,"lods",null);v.__decorate([q.property({readOnly:!0})],d.prototype,"minScale",void 0);v.__decorate([q.property({readOnly:!0})],
d.prototype,"maxScale",void 0);v.__decorate([q.property({readOnly:!0})],d.prototype,"scales",void 0);v.__decorate([q.property({cast:D=>Array.isArray(D)?D:"number"===typeof D?[D,D]:[256,256]})],d.prototype,"size",void 0);v.__decorate([w.reader("size",["rows","cols"])],d.prototype,"readSize",null);v.__decorate([C.writer("size",{cols:{type:E.Integer},rows:{type:E.Integer}})],d.prototype,"writeSize",null);v.__decorate([q.property({type:z,json:{write:!0}})],d.prototype,"spatialReference",void 0);return d=
B=v.__decorate([u.subclass("esri.layers.support.TileInfo")],d)})},"esri/geometry/support/aaBoundingRect":function(){define(["exports","../../core/has","../Extent"],function(m,v,e){function p(a=L){return[a[0],a[1],a[2],a[3]]}function E(a){return a[0]>=a[2]?0:a[2]-a[0]}function q(a){return a[1]>=a[3]?0:a[3]-a[1]}function y(a,d,g){return d>=a[0]&&g>=a[1]&&d<=a[2]&&g<=a[3]}function w(a,d){a[0]=d[0];a[1]=d[1];a[2]=d[2];a[3]=d[3];return a}function u(a){return 4===a.length}function C(a,d,g){return a<d?d:
a>g?g:a}const I=[Infinity,Infinity,-Infinity,-Infinity],L=[0,0,0,0];m.NEGATIVE_INFINITY=I;m.POSITIVE_INFINITY=[-Infinity,-Infinity,Infinity,Infinity];m.UNIT=[0,0,1,1];m.ZERO=L;m.allFinite=function(a){for(let d=0;4>d;d++)if(!isFinite(a[d]))return!1;return!0};m.area=function(a){return E(a)*q(a)};m.center=function(a,d=[0,0]){d[0]=(a[0]+a[2])/2;d[1]=(a[1]+a[3])/2;return d};m.clone=function(a){return[a[0],a[1],a[2],a[3]]};m.contains=function(a,d){return d[0]>=a[0]&&d[2]<=a[2]&&d[1]>=a[1]&&d[3]<=a[3]};
m.containsPoint=function(a,d){return y(a,d[0],d[1])};m.containsPointObject=function(a,d){return y(a,d.x,d.y)};m.containsPointWithMargin=function(a,d,g){return d[0]>=a[0]-g&&d[1]>=a[1]-g&&d[0]<=a[2]+g&&d[1]<=a[3]+g};m.containsXY=y;m.create=p;m.diameter=function(a){const d=E(a);a=q(a);return Math.sqrt(d*d+a*a)};m.distance=function(a,d){const g=(a[1]+a[3])/2,z=Math.max(Math.abs(d[0]-(a[0]+a[2])/2)-E(a)/2,0);a=Math.max(Math.abs(d[1]-g)-q(a)/2,0);return Math.sqrt(z*z+a*a)};m.empty=function(a){return a?
w(a,I):p(I)};m.equals=function(a,d,g){if(null==a||null==d)return a===d;if(!u(a)||!u(d))return!1;if(g)for(let z=0;z<a.length;z++){if(!g(a[z],d[z]))return!1}else for(g=0;g<a.length;g++)if(a[g]!==d[g])return!1;return!0};m.expand=function(a,d,g=a){if("length"in d)if(u(d))g[0]=Math.min(a[0],d[0]),g[1]=Math.min(a[1],d[1]),g[2]=Math.max(a[2],d[2]),g[3]=Math.max(a[3],d[3]);else{if(2===d.length||3===d.length)g[0]=Math.min(a[0],d[0]),g[1]=Math.min(a[1],d[1]),g[2]=Math.max(a[2],d[0]),g[3]=Math.max(a[3],d[1])}else switch(d.type){case "extent":g[0]=
Math.min(a[0],d.xmin);g[1]=Math.min(a[1],d.ymin);g[2]=Math.max(a[2],d.xmax);g[3]=Math.max(a[3],d.ymax);break;case "point":g[0]=Math.min(a[0],d.x),g[1]=Math.min(a[1],d.y),g[2]=Math.max(a[2],d.x),g[3]=Math.max(a[3],d.y)}return g};m.expandPointInPlace=function(a,d){d[0]<a[0]&&(a[0]=d[0]);d[0]>a[2]&&(a[2]=d[0]);d[1]<a[1]&&(a[1]=d[1]);d[1]>a[3]&&(a[3]=d[1])};m.expandWithNestedArray=function(a,d,g=a){const z=d.length;let P=a[0],x=a[1],N=a[2];a=a[3];for(let V=0;V<z;V++){const R=d[V];P=Math.min(P,R[0]);x=
Math.min(x,R[1]);N=Math.max(N,R[0]);a=Math.max(a,R[1])}g[0]=P;g[1]=x;g[2]=N;g[3]=a;return g};m.fromExtent=function(a,d=p()){d[0]=a.xmin;d[1]=a.ymin;d[2]=a.xmax;d[3]=a.ymax;return d};m.fromValues=function(a,d,g,z,P=p()){P[0]=a;P[1]=d;P[2]=g;P[3]=z;return P};m.height=q;m.intersection=function(a,d,g=a){const z=d[0],P=d[1],x=d[2];d=d[3];g[0]=C(a[0],z,x);g[1]=C(a[1],P,d);g[2]=C(a[2],z,x);g[3]=C(a[3],P,d);return g};m.intersects=function(a,d){return Math.max(d[0],a[0])<=Math.min(d[2],a[2])&&Math.max(d[1],
a[1])<=Math.min(d[3],a[3])};m.is=u;m.isPoint=function(a){return(0===E(a)||!isFinite(a[0]))&&(0===q(a)||!isFinite(a[1]))};m.offset=function(a,d,g,z=a){z[0]=a[0]+d;z[1]=a[1]+g;z[2]=a[2]+d;z[3]=a[3]+g;return z};m.pad=function(a,d,g=a){g[0]=a[0]-d;g[1]=a[1]-d;g[2]=a[2]+d;g[3]=a[3]+d;return g};m.set=w;m.setMax=function(a,d,g=a){g[2]=d[0];g[3]=d[1];g!==a&&(g[0]=a[0],g[1]=a[1]);return a};m.setMin=function(a,d,g=a){g[0]=d[0];g[1]=d[1];g!==a&&(g[2]=a[2],g[3]=a[3]);return g};m.size=function(a,d){d[0]=a[2]-
a[0];d[1]=a[3]-a[1]};m.toExtent=function(a,d){return new e({xmin:a[0],ymin:a[1],xmax:a[2],ymax:a[3],spatialReference:d})};m.width=E;Object.defineProperty(m,"__esModule",{value:!0})})},"esri/layers/support/LOD":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/has ../../core/Logger ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/property ../../core/jsonMap ../../core/accessorSupport/decorators/subclass ../../core/urlUtils ../../core/uuid ../../portal/support/resourceExtension ../../core/JSONSupport".split(" "),
function(m,v,e,p,E,q,y,w,u,C,I,L){var a;e=a=function(d){function g(z){z=d.call(this,z)||this;z.level=0;z.levelValue=null;z.resolution=0;z.scale=0;return z}m._inheritsLoose(g,d);g.prototype.clone=function(){return new a({level:this.level,levelValue:this.levelValue,resolution:this.resolution,scale:this.scale})};return g}(L.JSONSupport);v.__decorate([q.property({type:E.Integer,json:{write:!0}})],e.prototype,"level",void 0);v.__decorate([q.property({type:String,json:{write:!0}})],e.prototype,"levelValue",
void 0);v.__decorate([q.property({type:Number,json:{write:!0}})],e.prototype,"resolution",void 0);v.__decorate([q.property({type:Number,json:{write:!0}})],e.prototype,"scale",void 0);return e=a=v.__decorate([w.subclass("esri.layers.support.LOD")],e)})},"esri/layers/support/TilemapCache":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/has ../../core/Logger ../../core/accessorSupport/decorators/property ../../core/accessorSupport/decorators/cast ../../core/jsonMap ../../core/accessorSupport/decorators/subclass ../../core/Error ../../core/urlUtils ../../core/uuid ../../portal/support/resourceExtension ../../core/PooledArray ../../core/promiseUtils ../../core/scheduling ../../core/Accessor ../../request ../../core/Handles ../../core/LRUCache ../../core/watchUtils ./Tilemap".split(" "),
function(m,v,e,p,E,q,y,w,u,C,I,L,a,d,g,z,P,x,N,V,R,O){var B;const D=E.getLogger("esri.layers.support.TilemapCache");m.TilemapCache=B=function(M){function H(b){b=M.call(this,b)||this;b._handles=new N;b._pendingTilemapRequests={};b._availableLevels={};b.levels=5;b.cacheByteSize=2097152;b.request=x;b._prefetchingEnabled=!0;return b}v._inheritsLoose(H,M);var f=H.prototype;f.initialize=function(){this._tilemapCache=new V(this.cacheByteSize);this._handles.add([this.watch(["layer.parsedUrl","layer.tileServers?"],
()=>this._initializeTilemapDefinition()),R.init(this,"layer.tileInfo.lods",b=>this._initializeAvailableLevels(b),!0)]);this._initializeTilemapDefinition()};f.destroy=function(){this._handles&&(this._handles.destroy(),this._handles=null)};f.castLevels=function(b){return 2>=b?(D.error("Minimum levels for Tilemap is 3, but got ",b),3):b};f.fetchTilemap=function(b,h,l,n){if(!this._availableLevels[b])return g.reject(new C("tilemap-cache:level-unavailable",`Level ${b} is unavailable in the service`));const A=
this._tmpTilemapDefinition;if(b=this._tilemapFromCache(b,h,l,A))return g.resolve(b);const S=n&&n.signal;n={...n,signal:null};return g.create((U,Q)=>{g.onAbort(S,()=>Q(g.createAbortError()));const Y=O.tilemapDefinitionId(A);let Z=this._pendingTilemapRequests[Y];if(!Z){Z=O.Tilemap.fromDefinition(A,n).then(J=>{this._tilemapCache.put(Y,J,J.byteSize);return J});const fa=()=>delete this._pendingTilemapRequests[Y];this._pendingTilemapRequests[Y]=Z;Z.then(fa,fa)}Z.then(U,Q)})};f.getAvailability=function(b,
h,l){return this._availableLevels[b]?(b=this._tilemapFromCache(b,h,l,this._tmpTilemapDefinition))?b.getAvailability(h,l):"unknown":"unavailable"};f.getAvailabilityUpsample=function(b,h,l,n){n.level=b;n.row=h;n.col=l;b=this.layer.tileInfo;for(b.updateTileInfo(n);;)if(h=this.getAvailability(n.level,n.row,n.col),"unavailable"===h){if(!b.upsampleTile(n))return"unavailable"}else return h};f.fetchAvailability=function(b,h,l,n){return this._availableLevels[b]?this.fetchTilemap(b,h,l,n).catch(A=>A).then(A=>
{if(A instanceof O.Tilemap)return A=A.getAvailability(h,l),"unavailable"===A?g.reject(new C("tile-map:tile-unavailable","Tile is not available",{level:b,row:h,col:l})):A;if(g.isAbortError(A))throw A;return"unknown"}):g.reject(new C("tilemap-cache:level-unavailable",`Level ${b} is unavailable in the service`))};f.fetchAvailabilityUpsample=function(b,h,l,n,A){n.level=b;n.row=h;n.col=l;const S=this.layer.tileInfo;S.updateTileInfo(n);const U=this.fetchAvailability(b,h,l,A).catch(Q=>{if(g.isAbortError(Q))throw Q;
if(S.upsampleTile(n))return this.fetchAvailabilityUpsample(n.level,n.row,n.col,n);throw Q;});this._fetchAvailabilityUpsamplePrefetch(n.id,b,h,l,A,U);return U};f._fetchAvailabilityUpsamplePrefetch=async function(b,h,l,n,A,S){if(this._prefetchingEnabled){var U=`prefetch-${b}`;if(!this._handles.has(U)){var Q=g.createAbortController();S.then(()=>Q.abort(),()=>Q.abort());var Y=!1;this._handles.add({remove(){Y||(Y=!0,Q.abort())}},U);await z.waitTicks(10,Q.signal).catch(()=>{});Y||(Y=!0,this._handles.remove(U));
if(!g.isAborted(Q))for(b={id:b,level:h,row:l,col:n},A={...A,signal:Q.signal},h=this.layer.tileInfo,l=0;B._prefetches.length<B._maxPrefetch&&h.upsampleTile(b);++l){const Z=this.fetchAvailability(b.level,b.row,b.col,A);B._prefetches.push(Z);n=()=>{B._prefetches.removeUnordered(Z)};Z.then(n,n)}}}};f._initializeTilemapDefinition=function(){if(this.layer.parsedUrl){var b=this.layer.parsedUrl,h=b.query;this._tilemapCache.clear();this._tmpTilemapDefinition={service:{url:b.path,query:h?I.objectToQuery(h):
null,tileServers:this.layer.tileServers,request:this.request,type:this.layer.type},width:this.size,height:this.size,level:0,row:0,col:0}}};f._tilemapFromCache=function(b,h,l,n){n.level=b;n.row=h-h%this.size;n.col=l-l%this.size;b=O.tilemapDefinitionId(n);return this._tilemapCache.get(b)};f._initializeAvailableLevels=function(b){this._availableLevels={};b&&b.forEach(h=>this._availableLevels[h.level]=!0)};v._createClass(H,[{key:"size",get:function(){return 1<<this.levels}},{key:"test",get:function(){const b=
this;return{get prefetchingEnabled(){return b._prefetchingEnabled},set prefetchingEnabled(h){b._prefetchingEnabled=h},hasTilemap(h,l,n){return!!b._tilemapFromCache(h,l,n,b._tmpTilemapDefinition)}}}}]);return H}(P);m.TilemapCache._maxPrefetch=4;m.TilemapCache._prefetches=new d({initialSize:B._maxPrefetch});e.__decorate([q.property({constructOnly:!0,type:Number})],m.TilemapCache.prototype,"levels",void 0);e.__decorate([y.cast("levels")],m.TilemapCache.prototype,"castLevels",null);e.__decorate([q.property({readOnly:!0,
dependsOn:["levels"],type:Number})],m.TilemapCache.prototype,"size",null);e.__decorate([q.property({constructOnly:!0,type:Number})],m.TilemapCache.prototype,"cacheByteSize",void 0);e.__decorate([q.property({constructOnly:!0})],m.TilemapCache.prototype,"layer",void 0);e.__decorate([q.property({constructOnly:!0})],m.TilemapCache.prototype,"request",void 0);m.TilemapCache=B=e.__decorate([u.subclass("esri.layers.support.TilemapCache")],m.TilemapCache);Object.defineProperty(m,"__esModule",{value:!0})})},
"esri/layers/support/Tilemap":function(){define(["exports","../../core/lang","../../core/Error","../../core/arrayUtils","../../request"],function(m,v,e,p,E){function q(w){if("vector-tile"===w.service.type)var u=`${w.service.url}/tilemap/${w.level}/${w.row}/${w.col}/${w.width}/${w.height}`;else u=w.service.tileServers,u=`${u&&u.length?u[w.row%u.length]:w.service.url}/tilemap/${w.level}/${w.row}/${w.col}/${w.width}/${w.height}`;(w=w.service.query)&&(u=`${u}?${w}`);return u}let y=function(){function w(){this.location=
{left:0,top:0,width:0,height:0};this._allAvailability="unknown";this.byteSize=40}var u=w.prototype;u.getAvailability=function(C,I){if("unknown"!==this._allAvailability)return this._allAvailability;C=(C-this.location.top)*this.location.width+(I-this.location.left);I=C>>3;const L=this._tileAvailabilityBitSet;return 0>I||I>L.length?"unknown":L[I]&1<<C%8?"available":"unavailable"};u._updateFromData=function(C){let I=!0,L=!0;const a=new Uint8Array(Math.ceil(this.location.width*this.location.height/8));
let d=0;for(let g=0;g<C.length;g++){const z=g%8;C[g]?(L=!1,a[d]|=1<<z):I=!1;7===z&&++d}L?this._allAvailability="unavailable":I?this._allAvailability="available":(this._allAvailability="unknown",this._tileAvailabilityBitSet=a,this.byteSize+=a.length)};w.fromDefinition=function(C,I){const L=C.service.request||E,{row:a,col:d,width:g,height:z}=C,P={query:{f:"json"}};I=I?{...P,...I}:P;return L(q(C),I).then(x=>x.data).catch(x=>{if(x&&x.details&&422===x.details.httpStatus)return{location:{top:a,left:d,width:g,
height:z},valid:!0,data:p.constant(g*z,0)};throw x;}).then(x=>{if(x.location&&(x.location.top!==a||x.location.left!==d||x.location.width!==g||x.location.height!==z))throw new e("tilemap:location-mismatch","Tilemap response for different location than requested",{response:x,definition:{top:a,left:d,width:g,height:z}});return w.fromJSON(x)})};w.fromJSON=function(C){w.validateJSON(C);const I=new w;I.location=Object.freeze(v.clone(C.location));I._updateFromData(C.data);return Object.freeze(I)};w.validateJSON=
function(C){if(!C||!C.location)throw new e("tilemap:missing-location","Location missing from tilemap response");if(!1===C.valid)throw new e("tilemap:invalid","Tilemap response was marked as invalid");if(!C.data)throw new e("tilemap:missing-data","Data missing from tilemap response");if(!Array.isArray(C.data))throw new e("tilemap:data-mismatch","Data must be an array of numbers");if(C.data.length!==C.location.width*C.location.height)throw new e("tilemap:data-mismatch","Number of data items does not match width/height of tilemap");
};return w}();m.Tilemap=y;m.default=y;m.tilemapDefinitionId=function(w){return`${w.level}/${w.row}/${w.col}/${w.width}/${w.height}`};m.tilemapDefinitionUrl=q;Object.defineProperty(m,"__esModule",{value:!0})})},"esri/layers/mixins/ArcGISMapService":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/has ../../core/Logger ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/property ../../core/jsonMap ../../core/accessorSupport/decorators/reader ../../core/accessorSupport/decorators/subclass ../../core/urlUtils ../../core/uuid ../../portal/support/resourceExtension ../../core/promiseUtils ../../geometry/SpatialReference ../../geometry/Extent ../../request ../support/commonProperties".split(" "),
function(m,v,e,p,E,q,y,w,u,C,I,L,a,d,g,z,P,x){m.ArcGISMapService=N=>{N=function(V){function R(){var B=V.apply(this,arguments)||this;B.capabilities=void 0;B.copyright=null;B.fullExtent=null;B.legendEnabled=!0;B.spatialReference=null;B.version=null;return B}v._inheritsLoose(R,V);var O=R.prototype;O.readCapabilities=function(B,D){var M=D.capabilities&&D.capabilities.split(",").map(A=>A.toLowerCase().trim());if(!M)return{operations:{supportsQuery:!1,supportsExportMap:!1,supportsExportTiles:!1,supportsTileMap:!1},
exportMap:null,exportTiles:null};B=this.type;const H=-1!==M.indexOf("query"),f=-1!==M.indexOf("map"),b=!!D.exportTilesAllowed;M=-1!==M.indexOf("tilemap");const h="tile"!==B&&!!D.supportsDynamicLayers,l="tile"!==B&&(!D.tileInfo||h),n="tile"!==B&&(!D.tileInfo||h);return{operations:{supportsQuery:H,supportsExportMap:f,supportsExportTiles:b,supportsTileMap:M},exportMap:f?{supportsSublayersChanges:"tile"!==B,supportsDynamicLayers:h,supportsSublayerVisibility:l,supportsSublayerDefinitionExpression:n}:null,
exportTiles:b?{maxExportTilesCount:+D.maxExportTilesCount}:null}};O.readVersion=function(B,D){(B=D.currentVersion)||(B=D.hasOwnProperty("capabilities")||D.hasOwnProperty("tables")?10:D.hasOwnProperty("supportedImageFormatTypes")?9.31:9.3);return B};O.fetchSublayerInfo=async function(B,D){await this.fetchAllLayersAndTables(D);return this._allLayersAndTablesMap.get(B)};O.fetchAllLayersAndTables=async function(B){await this.load(B);this._allLayersAndTablesPromise||(this._allLayersAndTablesPromise=P(I.urlToObject(this.url).path+
"/layers",{responseType:"json",query:{f:"json",...this.customParameters}}).then(M=>{this._allLayersAndTablesMap=new Map;for(const H of M.data.layers)this._allLayersAndTablesMap.set(H.id,H);return{result:M.data}},M=>({error:M})));const D=await this._allLayersAndTablesPromise;d.throwIfAborted(B);if("result"in D)return D.result;throw D.error;};return R}(N);e.__decorate([y.property({readOnly:!0})],N.prototype,"capabilities",void 0);e.__decorate([u.reader("service","capabilities",["capabilities","exportTilesAllowed",
"maxExportTilesCount","supportsDynamicLayers","tileInfo"])],N.prototype,"readCapabilities",null);e.__decorate([y.property({json:{read:{source:"copyrightText"}}})],N.prototype,"copyright",void 0);e.__decorate([y.property({type:z})],N.prototype,"fullExtent",void 0);e.__decorate([y.property({json:{origins:{service:{read:!1},"portal-item":{read:!1}}}})],N.prototype,"id",void 0);e.__decorate([y.property({type:Boolean,json:{origins:{service:{read:{enabled:!1}}},read:{source:"showLegend"},write:{target:"showLegend"}}})],
N.prototype,"legendEnabled",void 0);e.__decorate([y.property(x.popupEnabled)],N.prototype,"popupEnabled",void 0);e.__decorate([y.property({type:g})],N.prototype,"spatialReference",void 0);e.__decorate([y.property()],N.prototype,"version",void 0);e.__decorate([u.reader("version",["currentVersion","capabilities","tables","supportedImageFormatTypes"])],N.prototype,"readVersion",null);return N=e.__decorate([C.subclass("esri.layers.mixins.ArcGISMapService")],N)};Object.defineProperty(m,"__esModule",{value:!0})})},
"esri/layers/support/Sublayer":function(){define("require ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/has ../../core/lang ../../core/Logger ../../core/accessorSupport/ensureType ../../core/accessorSupport/utils ../../core/accessorSupport/decorators/property ../../core/accessorSupport/decorators/cast ../../core/jsonMap ../../core/accessorSupport/decorators/reader ../../core/accessorSupport/decorators/subclass ../../core/accessorSupport/decorators/writer ../../core/Error ../../core/urlUtils ../../core/uuid ../../core/accessorSupport/PropertyOrigin ../../portal/support/resourceExtension ../../core/promiseUtils ../../geometry/Extent ../../geometry ../../core/Collection ./fieldUtils ../../core/Identifiable ../../PopupTemplate ../../request ../../core/Loadable ../../chunks/symbols ../../renderers/Renderer ../../renderers/ClassBreaksRenderer ../../renderers/UniqueValueRenderer ../../renderers/DictionaryRenderer ../../renderers/DotDensityRenderer ../../renderers/HeatmapRenderer ../../renderers/SimpleRenderer ../../renderers/support/types ../../renderers/support/jsonUtils ../../core/MultiOriginJSONSupport ./Field ./FieldsIndex ./LabelClass ./FeatureType ./source/MapLayerSource ../../chunks/DataLayerSource ../../support/popupUtils ../../tasks/support/Query ../../core/HandleOwner".split(" "),
function(m,v,e,p,E,q,y,w,u,C,I,L,a,d,g,z,P,x,N,V,R,O,B,D,M,H,f,b,h,l,n,A,S,U,Q,Y,Z,fa,J,r,G,X,ba,ca,ja,da,pa,sa){function na(T){return T&&"esriSMS"===T.type}function qa(T,aa,F){var c;return{ignoreOrigin:!0,enabled:F?"map-image"===(null==(c=F.layer)?void 0:c.type)&&(F.writeSublayerStructure||this.originIdOf(aa)>=x.nameToId(F.origin)):!1}}function ra(T,aa,F){var c;return{enabled:F?"tile"===(null==(c=F.layer)?void 0:c.type)&&this._isOverridden(aa):!1}}function ea(T,aa,F){return{ignoreOrigin:!0,enabled:F&&
F.writeSublayerStructure||!1}}function la(T,aa,F){return{ignoreOrigin:!0,enabled:F?F.writeSublayerStructure||this.originIdOf(aa)>=x.nameToId(F.origin):!1}}var ma;const oa=q.getLogger("esri.layers.support.Sublayer");let ta=0;const ia=new Set;ia.add("layer");ia.add("parent");ia.add("loaded");ia.add("loadStatus");ia.add("loadError");ia.add("loadWarnings");p=ma=function(T){function aa(c){c=T.call(this,c)||this;c.capabilities=void 0;c.fields=null;c.fullExtent=null;c.globalIdField=null;c.legendEnabled=
!0;c.objectIdField=null;c.popupEnabled=!0;c.popupTemplate=null;c.sourceJSON=null;c.title=null;c.typeIdField=null;c.types=null;return c}v._inheritsLoose(aa,T);var F=aa.prototype;F.load=async function(c){this.addResolvingPromise((async()=>{var k;if(!this.layer&&!this.url)throw new g("sublayer:missing-layer","Sublayer can't be loaded without being part of a layer",{sublayer:this});let t=null;if(!this.layer||2<this.originIdOf("url")||"data-layer"===(null==(k=this.source)?void 0:k.type))t=(await f(this.url,
{responseType:"json",query:{f:"json"},...c})).data;else{var K;k=this.id;"map-layer"===(null==(K=this.source)?void 0:K.type)&&(k=this.source.mapLayerId);t=await this.layer.fetchSublayerInfo(k,c)}t&&(this.sourceJSON=t,this.read({layerDefinition:t},{origin:"service"}))})());return this};F.readCapabilities=function(c,k){k=k.layerDefinition||k;c=(c=k.capabilities||c)?c.toLowerCase().split(",").map(t=>t.trim()):[];return{exportMap:{supportsModification:!!k.canModifyLayer},operations:{supportsQuery:-1!==
c.indexOf("query")}}};F.readGlobalIdFieldFromService=function(c,k){k=k.layerDefinition||k;if(k.globalIdField)return k.globalIdField;if(k.fields)for(const t of k.fields)if("esriFieldTypeGlobalID"===t.type)return t.name};F.writeLabelingInfo=function(c,k,t,K){c&&c.length&&(k.layerDefinition={drawingInfo:{labelingInfo:c.map(W=>W.write({},K))}})};F.readMinScale=function(c,k){return k.minScale||k.layerDefinition&&k.layerDefinition.minScale||0};F.readMaxScale=function(c,k){return k.maxScale||k.layerDefinition&&
k.layerDefinition.maxScale||0};F.readObjectIdFieldFromService=function(c,k){k=k.layerDefinition||k;if(k.objectIdField)return k.objectIdField;if(k.fields)for(const t of k.fields)if("esriFieldTypeOID"===t.type)return t.name};F.readOpacity=function(c,k){c=k.layerDefinition;return 1-.01*(null!=c.transparency?c.transparency:c.drawingInfo.transparency)};F.writeOpacity=function(c,k,t,K){k.layerDefinition={drawingInfo:{transparency:100-100*c}}};F.writeParent=function(c,k){k.parentLayerId=this.parent&&this.parent!==
this.layer?y.ensureInteger(this.parent.id):-1};F.castSublayers=function(c){return y.ensureType(B.ofType(ma),c)};F.writeSublayers=function(c,k,t){this.get("sublayers.length")&&(k[t]=this.sublayers.map(K=>K.id).toArray().reverse())};F.readTypeIdField=function(c,k){k=k.layerDefinition||k;if(c=k.typeIdField)if(k=D.getField(k.fields,c))return k.name;return null};F.writeVisible=function(c,k,t,K){k[t]=this.getAtOrigin("defaultVisibility","service")||c};F.clone=function(){const {store:c}=w.getProperties(this),
k=new ma;w.getProperties(k).store=c.clone(ia);this.url;k._lastParsedUrl=this._lastParsedUrl;return k};F.createPopupTemplate=function(c){return da.createPopupTemplate(this,c)};F.createQuery=function(){return new pa({returnGeometry:!0,where:this.definitionExpression||"1\x3d1"})};F.createFeatureLayer=async function(){var c,k;if(this.hasOwnProperty("sublayers"))return null;const t=null==(c=this.layer)?void 0:c.parsedUrl;c=new (await new Promise(function(K,W){m(["../FeatureLayer"],function(ha){K(Object.freeze({__proto__:null,
"default":ha}))},W)})).default({url:t.path});t&&this.source&&("map-layer"===this.source.type?c.layerId=this.source.mapLayerId:c.dynamicDataSource=this.source);null!=this.layer.refreshInterval&&(c.refreshInterval=this.layer.refreshInterval);this.definitionExpression&&(c.definitionExpression=this.definitionExpression);2<this.originIdOf("labelingInfo")&&(c.labelingInfo=E.clone(this.labelingInfo));0<this.originIdOf("labelsVisible")&&(c.labelsVisible=this.labelsVisible);0<this.originIdOf("legendEnabled")&&
(c.legendEnabled=this.legendEnabled);0<this.originIdOf("visible")&&(c.visible=this.visible);0<this.originIdOf("minScale")&&(c.minScale=this.minScale);0<this.originIdOf("maxScale")&&(c.maxScale=this.maxScale);0<this.originIdOf("opacity")&&(c.opacity=this.opacity);0<this.originIdOf("popupTemplate")&&(c.popupTemplate=E.clone(this.popupTemplate));2<this.originIdOf("renderer")&&(c.renderer=E.clone(this.renderer));"data-layer"===(null==(k=this.source)?void 0:k.type)&&(c.dynamicDataSource=this.source.clone());
0<this.originIdOf("title")&&(c.title=this.title);"map-image"===this.layer.type&&0<this.layer.originIdOf("customParameters")&&(c.customParameters=this.layer.customParameters);"tile"===this.layer.type&&0<this.layer.originIdOf("customParameters")&&(c.customParameters=this.layer.customParameters);return c};F.getFeatureType=function(c){const {typeIdField:k,types:t}=this;if(!k||!c)return null;const K=c.attributes?c.attributes[k]:void 0;if(null==K)return null;let W=null;t.some(ha=>{const {id:ka}=ha;if(null==
ka)return!1;ka.toString()===K.toString()&&(W=ha);return!!W});return W};F.getFieldDomain=function(c,k){return(k=this.getFeatureType(k&&k.feature))&&(k=k.domains&&k.domains[c])&&"inherited"!==k.type?k:this._getLayerDomain(c)};F.queryFeatures=function(c=this.createQuery(),k){return this.load().then(()=>{if(!this.get("capabilities.operations.supportsQuery"))throw new g("Sublayer.queryFeatures","this layer doesn't support queries.");return V.all([new Promise(function(t,K){m(["../../tasks/operations/query"],
t,K)}),new Promise(function(t,K){m(["../../tasks/support/FeatureSet"],function(W){t(Object.freeze({__proto__:null,"default":W}))},K)})])}).then(([{executeQuery:t},{default:K}])=>t(this.url,pa.from(c),this.layer?this.layer.spatialReference:null,{...k,query:{...this.layer.customParameters}}).then(W=>K.fromJSON(W.data))).then(t=>{t&&t.features&&t.features.forEach(K=>{K.sourceLayer=this});return t})};F.toExportImageJSON=function(){var c;const k={id:this.id,source:(null==(c=this.source)?void 0:c.toJSON())||
{mapLayerId:this.id,type:"mapLayer"}};this.definitionExpression&&(k.definitionExpression=this.definitionExpression);const t=["renderer","labelingInfo","opacity","labelsVisible"].reduce((K,W)=>{K[W]=this.originIdOf(W);return K},{});Object.keys(t).some(K=>2<t[K])&&(c=k.drawingInfo={},2<t.renderer&&(c.renderer=this.renderer?this.renderer.toJSON():null),2<t.labelsVisible&&(c.showLabels=this.labelsVisible),this.labelsVisible&&2<t.labelingInfo&&(c.labelingInfo=this.labelingInfo?this.labelingInfo.map(K=>
K.write({},{origin:"service"})):null,c.showLabels=!0),2<t.opacity&&(c.transparency=100-100*this.opacity),this._assignDefaultSymbolColors(c.renderer));return k};F._assignDefaultSymbolColors=function(c){this._forEachSimpleMarkerSymbols(c,k=>{k.color||"esriSMSX"!==k.style&&"esriSMSCross"!==k.style||(k.color=k.outline&&k.outline.color?k.outline.color:[0,0,0,0])})};F._forEachSimpleMarkerSymbols=function(c,k){if(c){const t="uniqueValueInfos"in c?c.uniqueValueInfos:"classBreakInfos"in c?c.classBreakInfos:
[];for(const K of t)na(K.symbol)&&k(K.symbol);"symbol"in c&&na(c.symbol)&&k(c.symbol);"defaultSymbol"in c&&na(c.defaultSymbol)&&k(c.defaultSymbol)}};F._setAndNotifyLayer=function(c,k){const t=this.layer,K=this._get(c);let W,ha;switch(c){case "definitionExpression":W="supportsSublayerDefinitionExpression";case "minScale":case "maxScale":case "visible":W="supportsSublayerVisibility";break;case "labelingInfo":case "labelsVisible":case "opacity":case "renderer":case "source":W="supportsDynamicLayers",
ha="supportsModification"}const ka=w.getProperties(this).getDefaultOrigin();if("service"!==ka){if(W&&!1===this.get(`layer.capabilities.exportMap.${W}`)){this._logLockedError(c,`capability not available 'layer.capabilities.exportMap.${W}'`);return}if(ha&&!1===this.get(`capabilities.exportMap.${ha}`)){this._logLockedError(c,`capability not available 'capabilities.exportMap.${ha}'`);return}}"source"===c&&"not-loaded"!==this.loadStatus?this._logLockedError(c,"'source' can't be changed after calling sublayer.load()"):
(this._set(c,k),"service"!==ka&&K!==k&&t&&t.emit&&t.emit("sublayer-update",{propertyName:c,target:this}))};F._handleSublayersChange=function(c,k){k&&(k.forEach(t=>{t.parent=null;t.layer=null}),this.handles.removeAll());c&&(c.forEach(t=>{t.parent=this;t.layer=this.layer}),this.handles.add([c.on("after-add",({item:t})=>{t.parent=this;t.layer=this.layer}),c.on("after-remove",({item:t})=>{t.parent=null;t.layer=null}),c.on("before-changes",t=>{const K=this.get("layer.capabilities.exportMap.supportsSublayersChanges");
null==K||K||(oa.error(new g("sublayer:sublayers-non-modifiable","Sublayer can't be added, moved, or removed from the layer's sublayers",{sublayer:this,layer:this.layer})),t.preventDefault())})]))};F._logLockedError=function(c,k){oa.error(new g("sublayer:locked",`Property '${c}' can't be changed on Sublayer from the layer '${this.layer.id}'`,{reason:k,sublayer:this,layer:this.layer}))};F._getLayerDomain=function(c){return(c=this.fieldsIndex.get(c))?c.domain:null};v._createClass(aa,[{key:"definitionExpression",
set:function(c){this._setAndNotifyLayer("definitionExpression",c)}},{key:"fieldsIndex",get:function(){return new G(this.fields||[])}},{key:"id",get:function(){const c=this._get("id");return null==c?ta++:c},set:function(c){this._get("id")!==c&&(!1===this.get("layer.capabilities.exportMap.supportsDynamicLayers")?this._logLockedError("id","capability not available 'layer.capabilities.exportMap.supportsDynamicLayers'"):this._set("id",c))}},{key:"labelingInfo",set:function(c){this._setAndNotifyLayer("labelingInfo",
c)}},{key:"labelsVisible",set:function(c){this._setAndNotifyLayer("labelsVisible",c)}},{key:"layer",set:function(c){this._set("layer",c);this.sublayers&&this.sublayers.forEach(k=>k.layer=c)}},{key:"listMode",set:function(c){this._set("listMode",c)}},{key:"minScale",set:function(c){this._setAndNotifyLayer("minScale",c)}},{key:"maxScale",set:function(c){this._setAndNotifyLayer("maxScale",c)}},{key:"opacity",set:function(c){this._setAndNotifyLayer("opacity",c)}},{key:"defaultPopupTemplate",get:function(){return this.createPopupTemplate()}},
{key:"renderer",set:function(c){if(c)for(const k of c.getSymbols())if(h.isSymbol3D(k)){oa.warn("Sublayer renderer should use 2D symbols");break}this._setAndNotifyLayer("renderer",c)}},{key:"source",get:function(){return this._get("source")||new ca.MapLayerSource({mapLayerId:this.id})},set:function(c){this._setAndNotifyLayer("source",c)}},{key:"sublayers",set:function(c){this._handleSublayersChange(c,this._get("sublayers"));this._set("sublayers",c)}},{key:"url",get:function(){var c,k;const t=null!=
(c=null==(k=this.layer)?void 0:k.parsedUrl)?c:this._lastParsedUrl;c=this.source;if(!t)return null;this._lastParsedUrl=t;if("map-layer"===(null==c?void 0:c.type))return`${t.path}/${c.mapLayerId}`;c={layer:JSON.stringify({source:this.source})};return`${t.path}/dynamicLayer?${z.objectToQuery(c)}`},set:function(c){c?this._override("url",c):this._clearOverride("url")}},{key:"visible",set:function(c){this._setAndNotifyLayer("visible",c)}}]);return aa}(sa.HandleOwnerMixin(J.MultiOriginJSONMixin(M.IdentifiableMixin(b))));
p.test={isMapImageLayerOverridePolicy:T=>T===ea||T===qa,isTileImageLayerOverridePolicy:T=>T===ra};e.__decorate([u.property({readOnly:!0})],p.prototype,"capabilities",void 0);e.__decorate([L.reader("service","capabilities",["layerDefinition.canModifyLayer","layerDefinition.capabilities"])],p.prototype,"readCapabilities",null);e.__decorate([u.property({type:String,value:null,json:{read:{source:"layerDefinition.definitionExpression"},write:{target:"layerDefinition.definitionExpression",overridePolicy:qa}}})],
p.prototype,"definitionExpression",null);e.__decorate([u.property({type:[r],json:{origins:{service:{read:{source:"layerDefinition.fields"}}}}})],p.prototype,"fields",void 0);e.__decorate([u.property({readOnly:!0,dependsOn:["fields"]})],p.prototype,"fieldsIndex",null);e.__decorate([u.property({type:R,json:{read:{source:"layerDefinition.extent"}}})],p.prototype,"fullExtent",void 0);e.__decorate([u.property({type:String})],p.prototype,"globalIdField",void 0);e.__decorate([L.reader("service","globalIdField",
["layerDefinition.globalIdField","layerDefinition.fields"])],p.prototype,"readGlobalIdFieldFromService",null);e.__decorate([u.property({type:y.Integer,json:{write:{ignoreOrigin:!0}}})],p.prototype,"id",null);e.__decorate([u.property({value:null,type:[X],json:{read:{source:"layerDefinition.drawingInfo.labelingInfo"},write:{target:"layerDefinition.drawingInfo.labelingInfo",overridePolicy:ea}}})],p.prototype,"labelingInfo",null);e.__decorate([d.writer("labelingInfo")],p.prototype,"writeLabelingInfo",
null);e.__decorate([u.property({type:Boolean,value:!0,json:{read:{source:"layerDefinition.drawingInfo.showLabels"},write:{target:"layerDefinition.drawingInfo.showLabels",overridePolicy:ea}}})],p.prototype,"labelsVisible",null);e.__decorate([u.property({value:null})],p.prototype,"layer",null);e.__decorate([u.property({type:Boolean,value:!0,json:{origins:{service:{read:{enabled:!1}}},read:{source:"showLegend"},write:{target:"showLegend",overridePolicy:la}}})],p.prototype,"legendEnabled",void 0);e.__decorate([u.property({type:["show",
"hide","hide-children"],value:"show",json:{read:!1,write:!1,origins:{"web-scene":{read:!0,write:!0}}}})],p.prototype,"listMode",null);e.__decorate([u.property({type:Number,value:0,json:{write:{overridePolicy:ea}}})],p.prototype,"minScale",null);e.__decorate([L.reader("minScale",["minScale","layerDefinition.minScale"])],p.prototype,"readMinScale",null);e.__decorate([u.property({type:Number,value:0,json:{write:{overridePolicy:ea}}})],p.prototype,"maxScale",null);e.__decorate([L.reader("maxScale",["maxScale",
"layerDefinition.maxScale"])],p.prototype,"readMaxScale",null);e.__decorate([u.property({type:String})],p.prototype,"objectIdField",void 0);e.__decorate([L.reader("service","objectIdField",["layerDefinition.objectIdField","layerDefinition.fields"])],p.prototype,"readObjectIdFieldFromService",null);e.__decorate([u.property({type:Number,value:1,json:{write:{target:"layerDefinition.drawingInfo.transparency",overridePolicy:ea}}})],p.prototype,"opacity",null);e.__decorate([L.reader("opacity",["layerDefinition.drawingInfo.transparency",
"layerDefinition.transparency"])],p.prototype,"readOpacity",null);e.__decorate([d.writer("opacity")],p.prototype,"writeOpacity",null);e.__decorate([u.property({json:{type:y.Integer,write:{target:"parentLayerId",allowNull:!0,overridePolicy:ea}}})],p.prototype,"parent",void 0);e.__decorate([d.writer("parent")],p.prototype,"writeParent",null);e.__decorate([u.property({type:Boolean,value:!0,json:{read:{source:"disablePopup",reader(T,aa){return!aa.disablePopup}},write:{target:"disablePopup",overridePolicy:la,
writer(T,aa,F){aa[F]=!T}}}})],p.prototype,"popupEnabled",void 0);e.__decorate([u.property({type:H,json:{read:{source:"popupInfo"},write:{target:"popupInfo",overridePolicy:la}}})],p.prototype,"popupTemplate",void 0);e.__decorate([u.property({readOnly:!0,dependsOn:["fields","title"]})],p.prototype,"defaultPopupTemplate",null);e.__decorate([u.property({types:Z.rendererTypes,value:null,json:{name:"layerDefinition.drawingInfo.renderer",write:{overridePolicy:ea},origins:{"web-scene":{types:Z.webSceneRendererTypes,
name:"layerDefinition.drawingInfo.renderer",write:{overridePolicy:ea}}}}})],p.prototype,"renderer",null);e.__decorate([u.property({types:{key:"type",base:null,typeMap:{"data-layer":ja.DataLayerSource,"map-layer":ca.MapLayerSource}},cast(T){if(T){if("mapLayerId"in T)return y.ensureClass(ca.MapLayerSource,T);if("dataSource"in T)return y.ensureClass(ja.DataLayerSource,T)}return T},json:{name:"layerDefinition.source",write:{overridePolicy:ea}}})],p.prototype,"source",null);e.__decorate([u.property()],
p.prototype,"sourceJSON",void 0);e.__decorate([u.property({value:null,json:{type:[y.Integer],write:{target:"subLayerIds",allowNull:!0,overridePolicy:ea}}})],p.prototype,"sublayers",null);e.__decorate([C.cast("sublayers")],p.prototype,"castSublayers",null);e.__decorate([d.writer("sublayers")],p.prototype,"writeSublayers",null);e.__decorate([u.property({type:String,json:{read:{source:"name"},write:{target:"name",allowNull:!0,overridePolicy:la}}})],p.prototype,"title",void 0);e.__decorate([u.property({type:String})],
p.prototype,"typeIdField",void 0);e.__decorate([L.reader("typeIdField",["layerDefinition.typeIdField"])],p.prototype,"readTypeIdField",null);e.__decorate([u.property({type:[ba],json:{origins:{service:{read:{source:"layerDefinition.types"}}}}})],p.prototype,"types",void 0);e.__decorate([u.property({type:String,dependsOn:["layer","source"],json:{read:{source:"layerUrl"},write:{target:"layerUrl",overridePolicy:ra}}})],p.prototype,"url",null);e.__decorate([u.property({type:Boolean,value:!0,json:{read:{source:"defaultVisibility"},
write:{target:"defaultVisibility",overridePolicy:ea}}})],p.prototype,"visible",null);e.__decorate([d.writer("visible")],p.prototype,"writeVisible",null);return p=ma=e.__decorate([a.subclass("esri.layers.support.Sublayer")],p)})},"esri/layers/mixins/SublayersOwner":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/has ../../core/Logger ../../core/accessorSupport/ensureType ../../core/accessorSupport/utils ../../core/accessorSupport/decorators/property ../../core/jsonMap ../../core/accessorSupport/decorators/subclass ../../core/Error ../../core/urlUtils ../../core/uuid ../../core/accessorSupport/PropertyOrigin ../../portal/support/resourceExtension ../../core/Collection ../../core/CollectionFlattener ../support/Sublayer ../support/sublayerUtils".split(" "),
function(m,v,e,p,E,q,y,w,u,C,I,L,a,d,g,z,P,x,N){function V(D,M){const H=[],f={};if(!D)return H;D.forEach(b=>{const h=new x;h.read(b,M);f[h.id]=h;null!=b.parentLayerId&&-1!==b.parentLayerId?(b=f[b.parentLayerId],b.sublayers||(b.sublayers=[]),b.sublayers.unshift(h)):H.unshift(h)});return H}function R(D,M){D&&D.forEach(H=>{M(H);H.sublayers&&H.sublayers.length&&R(H.sublayers,M)})}const O=E.getLogger("esri.layers.TileLayer"),B=z.ofType(x);m.SublayersOwner=D=>{D=function(M){function H(...b){var h=M.call(this,
...b)||this;h.allSublayers=new P({root:v._assertThisInitialized(h),rootCollectionNames:["sublayers"],getChildrenFunction(l){return l.sublayers}});h.sublayersSourceJSON={[2]:{},[3]:{},[4]:{},[5]:{}};h.watch("sublayers",(l,n)=>h._handleSublayersChange(l,n),!0);return h}v._inheritsLoose(H,M);var f=H.prototype;f.readSublayers=function(b,h){if(h&&b){var {sublayersSourceJSON:l}=this,n=d.nameToId(h.origin);if(!(2>n||(l[n]={context:h,visibleLayers:b.visibleLayers||l[n].visibleLayers,layers:b.layers||l[n].layers},
2<n))){this._set("serviceSublayers",this.createSublayersForOrigin("service").sublayers);var {sublayers:A,origin:S}=this.createSublayersForOrigin("web-document");b=y.getProperties(this);b.setDefaultOrigin(S);this._set("sublayers",new B(A));b.setDefaultOrigin("user")}}};f.findSublayerById=function(b){return this.allSublayers.find(h=>h.id===b)};f.createServiceSublayers=function(){return this.createSublayersForOrigin("service").sublayers};f.createSublayersForOrigin=function(b){const h="web-document"===
b?d.nameToId("web-map"):d.nameToId(b);let l=2;b=this.sublayersSourceJSON[2].layers;let n=this.sublayersSourceJSON[2].context,A=null;var S=[3,4,5].filter(J=>J<=h);for(var U of S)S=this.sublayersSourceJSON[U],N.isSublayerOverhaul(S.layers)&&(l=U,b=S.layers,n=S.context,S.visibleLayers&&(A={visibleLayers:S.visibleLayers,context:S.context}));U=[3,4,5].filter(J=>J>l&&J<=h);let Q=null;for(var Y of U){const {layers:J,visibleLayers:r,context:G}=this.sublayersSourceJSON[Y];J&&(Q={layers:J,context:G});r&&(A=
{visibleLayers:r,context:G})}Y=V(b,n);const Z=new Map,fa=new Set;if(Q)for(const J of Q.layers)Z.set(J.id,J);if(A)for(const J of A.visibleLayers)fa.add(J);R(Y,J=>{Q&&J.read(Z.get(J.id),Q.context);A&&J.read({defaultVisibility:fa.has(J.id)},A.context)});return{origin:d.idToName(l),sublayers:new B({items:Y})}};f.read=function(b,h){M.prototype.read.call(this,b,h);this.readSublayers(b,h)};f._handleSublayersChange=function(b,h){h&&(h.forEach(l=>{l.parent=null;l.layer=null}),this.handles.remove("sublayers-owner"));
b&&(b.forEach(l=>{l.parent=this;l.layer=this}),this.handles.add([b.on("after-add",({item:l})=>{l.parent=this;l.layer=this}),b.on("after-remove",({item:l})=>{l.parent=null;l.layer=null})],"sublayers-owner"),"tile"===this.type&&this.handles.add(b.on("before-changes",l=>{O.error(new I("tilelayer:sublayers-non-modifiable","Sublayer can't be added, moved, or removed from the layer's sublayers",{layer:this}));l.preventDefault()}),"sublayers-owner"))};return H}(D);e.__decorate([w.property({readOnly:!0})],
D.prototype,"allSublayers",void 0);e.__decorate([w.property({readOnly:!0,type:z.ofType(x)})],D.prototype,"serviceSublayers",void 0);e.__decorate([w.property({value:null,type:B,json:{read:!1,write:{allowNull:!0,ignoreOrigin:!0}}})],D.prototype,"sublayers",void 0);e.__decorate([w.property({readOnly:!0})],D.prototype,"sublayersSourceJSON",void 0);return D=e.__decorate([C.subclass("esri.layers.mixins.SublayersOwner")],D)};m.forEachSublayer=R;Object.defineProperty(m,"__esModule",{value:!0})})},"esri/layers/support/sublayerUtils":function(){define(["exports"],
function(m){function v(e,p){if(!e||!e.length)return!0;p=p.slice().reverse().flatten(({sublayers:y})=>y&&y.toArray().reverse()).map(y=>y.id).toArray();if(e.length>p.length)return!1;let E=0;const q=p.length;for(const {id:y}of e){for(;E<q&&p[E]!==y;)E++;if(E>=q)return!1}return!0}m.isExportDynamic=function(e,p,E){return e.some(q=>{const y=q.source;return!(!y||"map-layer"===y.type&&y.mapLayerId===q.id&&(!y.gdbVersion||y.gdbVersion===E.gdbVersion))||2<q.originIdOf("renderer")||2<q.originIdOf("labelingInfo")||
2<q.originIdOf("opacity")||2<q.originIdOf("labelsVisible")})?!0:!v(e,p)};m.isSublayerOverhaul=function(e){return!!e&&e.some(p=>null!=p.minScale||p.layerDefinition&&null!=p.layerDefinition.minScale)};m.shouldWriteSublayerStructure=function(e,p,E){return p.flatten(({sublayers:q})=>q).length!==e.length||e.some(q=>q.originIdOf("minScale")>E||q.originIdOf("maxScale")>E||q.originIdOf("renderer")>E||q.originIdOf("labelingInfo")>E||q.originIdOf("opacity")>E||q.originIdOf("labelsVisible")>E||q.originIdOf("source")>
E)?!0:!v(e,p)};Object.defineProperty(m,"__esModule",{value:!0})})},"*noref":1}});
define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/has ../core/maybe ../core/Logger ../core/accessorSupport/decorators/property ../core/accessorSupport/decorators/cast ../core/jsonMap ../core/accessorSupport/decorators/reader ../core/accessorSupport/decorators/subclass ../core/accessorSupport/decorators/writer ../core/Error ../core/urlUtils ../core/uuid ../portal/support/resourceExtension ../core/promiseUtils ../geometry/SpatialReference ../geometry ../request ./Layer ../core/MultiOriginJSONSupport ./support/arcgisLayerUrl ./support/commonProperties ./mixins/OperationalLayer ./mixins/ArcGISService ./mixins/BlendLayer ./mixins/CustomParametersMixin ./mixins/PortalLayer ./mixins/RefreshableLayer ./mixins/ScaleRangeLayer ../core/HandleOwner ./mixins/ArcGISCachedService ./mixins/ArcGISMapService ./support/Sublayer ./mixins/SublayersOwner".split(" "),function(m,
v,e,p,E,q,y,w,u,C,I,L,a,d,g,z,P,x,N,V,R,O,B,D,M,H,f,b,h,l,n,A,S,U,Q){const Y="Canvas/World_Dark_Gray_Base Canvas/World_Dark_Gray_Reference Canvas/World_Light_Gray_Base Canvas/World_Light_Gray_Reference Elevation/World_Hillshade Elevation/World_Hillshade_Dark Ocean/World_Ocean_Base Ocean/World_Ocean_Reference Ocean_Basemap Reference/World_Boundaries_and_Places Reference/World_Boundaries_and_Places_Alternate Reference/World_Transportation World_Imagery World_Street_Map World_Topo_Map".split(" ");e=
function(Z){function fa(...r){r=Z.call(this,...r)||this;r.listMode="show";r.isReference=null;r.operationalLayerType="ArcGISTiledMapServiceLayer";r.resampling=!0;r.sourceJSON=null;r.spatialReference=null;r.path=null;r.sublayers=null;r.type="tile";r.url=null;return r}m._inheritsLoose(fa,Z);var J=fa.prototype;J.normalizeCtorArgs=function(r,G){return"string"===typeof r?{url:r,...G}:r};J.load=function(r){const G=p.isSome(r)?r.signal:null;this.addResolvingPromise(this.loadFromPortal({supportedTypes:["Map Service"]},
r).then(()=>this._fetchService(G),()=>this._fetchService(G)));return z.resolve(this)};J.readSpatialReference=function(r,G){return(r=r||G.tileInfo&&G.tileInfo.spatialReference)&&P.fromJSON(r)};J.writeSublayers=function(r,G,X,ba){if(this.loaded&&r){r=r.slice().reverse().flatten(({sublayers:da})=>da&&da.toArray().reverse()).toArray();var ca=[],ja={writeSublayerStructure:!1,...ba};r.forEach(da=>{da=da.write({},ja);ca.push(da)});ca.some(da=>1<Object.keys(da).length)&&(G.layers=ca)}};J.castTileServers=
function(r){return Array.isArray(r)?r.map(G=>a.urlToObject(G).path):null};J.fetchTile=function(r,G,X,ba={}){const {signal:ca,timestamp:ja}=ba;r=this.getTileUrl(r,G,X);G={responseType:"image",signal:ca};null!=ja&&(G.query={_ts:ba.timestamp});return N(r,G).then(da=>da.data)};J.getTileUrl=function(r,G,X){const ba=a.objectToQuery({...this.parsedUrl.query,blankTile:!this.tilemapCache&&this.supportsBlankTile?!1:null,...this.customParameters}),ca=this.tileServers;return`${ca&&ca.length?ca[G%ca.length]:this.parsedUrl.path}/tile/${r}/${G}/${X}${ba?
"?"+ba:""}`};J._fetchService=function(r){return z.create((G,X)=>{if(this.sourceJSON){if(null!=this.sourceJSON.bandCount&&null!=this.sourceJSON.pixelSizeX)throw new L("tile-layer:unsupported-url","use ImageryTileLayer to open a tiled image service");G({data:this.sourceJSON})}else{if(!this.parsedUrl)throw new L("tile-layer:undefined-url","layer's url is not defined");var ba=O.parse(this.parsedUrl.path);if(p.isSome(ba)&&"ImageServer"===ba.serverType)throw new L("tile-layer:unsupported-url","use ImageryTileLayer to open a tiled image service");
N(this.parsedUrl.path,{query:{f:"json",...this.parsedUrl.query,...this.customParameters},responseType:"json",signal:r}).then(G,X)}}).then(G=>{G.ssl&&(this.url=this.url.replace(/^http:/i,"https:"));this.sourceJSON=G.data;this.read(G.data,{origin:"service",url:this.parsedUrl});if(10.1===this.version&&!O.isHostedAgolService(this.url))return this._fetchServerVersion(this.url,r).then(X=>{this.read({currentVersion:X})}).catch(()=>{})})};J._fetchServerVersion=function(r,G){if(!O.isArcGISUrl(r))return z.reject();
r=r.replace(/(.*\/rest)\/.*/i,"$1")+"/info";return N(r,{query:{f:"json",...this.customParameters},responseType:"json",signal:G}).then(X=>{if(X.data&&X.data.currentVersion)return X.data.currentVersion;throw new L("tile-layer:version-not-available");})};J._getMapName=function(r){return(r=r.match(/^(?:https?:)?\/\/(server\.arcgisonline\.com|services\.arcgisonline\.com|ibasemaps-api\.arcgis\.com)\/arcgis\/rest\/services\/([^\/]+(\/[^\/]+)*)\/mapserver/i))&&r[2]};J._getDefaultAttribution=function(r){if(r){r=
r.toLowerCase();for(let X=0,ba=Y.length;X<ba;X++){var G=Y[X];if(-1<G.toLowerCase().indexOf(r))return a.makeAbsolute("//static.arcgis.com/attribution/"+G)}}};J._getDefaultTileServers=function(r){const G=-1!==r.search(/^(?:https?:)?\/\/server\.arcgisonline\.com/i),X=-1!==r.search(/^(?:https?:)?\/\/services\.arcgisonline\.com/i);return G||X?[r,r.replace(G?/server\.arcgisonline/i:/services\.arcgisonline/i,G?"services.arcgisonline":"server.arcgisonline")]:[]};m._createClass(fa,[{key:"attributionDataUrl",
get:function(){var r;const G=null==(r=this.parsedUrl)?void 0:r.path.toLowerCase();return G&&this._getDefaultAttribution(this._getMapName(G))}},{key:"tileServers",get:function(){return this._getDefaultTileServers(this.parsedUrl.path)}}]);return fa}(H.BlendLayer(Q.SublayersOwner(l.ScaleRangeLayer(h.RefreshableLayer(D.OperationalLayer(b.PortalLayer(A.ArcGISCachedService(S.ArcGISMapService(M.ArcGISService(R.MultiOriginJSONMixin(n.HandleOwnerMixin(f.CustomParametersMixin(V)))))))))))));v.__decorate([q.property({readOnly:!0,
dependsOn:["parsedUrl"]})],e.prototype,"attributionDataUrl",null);v.__decorate([q.property({type:["show","hide","hide-children"]})],e.prototype,"listMode",void 0);v.__decorate([q.property({type:Boolean,json:{read:!1,write:{enabled:!0,overridePolicy:()=>({enabled:!1})}}})],e.prototype,"isReference",void 0);v.__decorate([q.property({readOnly:!0,type:["ArcGISTiledMapServiceLayer"]})],e.prototype,"operationalLayerType",void 0);v.__decorate([q.property({type:Boolean})],e.prototype,"resampling",void 0);
v.__decorate([q.property()],e.prototype,"sourceJSON",void 0);v.__decorate([q.property({type:P})],e.prototype,"spatialReference",void 0);v.__decorate([u.reader("spatialReference",["spatialReference","tileInfo"])],e.prototype,"readSpatialReference",null);v.__decorate([q.property({type:String,json:{origins:{"web-scene":{read:!0,write:!0}},read:!1}})],e.prototype,"path",void 0);v.__decorate([q.property({readOnly:!0})],e.prototype,"sublayers",void 0);v.__decorate([I.writer("sublayers",{layers:{type:[U]}})],
e.prototype,"writeSublayers",null);v.__decorate([q.property({json:{read:!1,write:!1}})],e.prototype,"popupEnabled",void 0);v.__decorate([q.property({dependsOn:["parsedUrl"]})],e.prototype,"tileServers",null);v.__decorate([y.cast("tileServers")],e.prototype,"castTileServers",null);v.__decorate([q.property({readOnly:!0,json:{read:!1}})],e.prototype,"type",void 0);v.__decorate([q.property(B.url)],e.prototype,"url",void 0);return e=v.__decorate([C.subclass("esri.layers.TileLayer")],e)});