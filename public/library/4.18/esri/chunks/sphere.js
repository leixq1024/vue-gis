// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.18/esri/copyright.txt for details.
//>>built
define("exports ../core/has ../core/maybe ../core/Logger ../core/mathUtils ./vec3f64 ./vec3 ../views/3d/support/mathUtils ./mat4 ../core/ObjectStack ../views/3d/support/stack ./vector ./ray".split(" "),function(e,A,N,O,P,l,d,B,C,Q,h,R,p){function m(a){return a?{radius:a.radius,center:l.clone(a.center)}:{radius:1,center:l.create()}}function D(a,b){const c=S.get();c.radius=a;c.center=b||E;return c}function q(a,b=m()){return r(a.radius,a.center,b)}function r(a,b,c=m()){d.copy(c.center,b);c.radius=a;
return c}function F(a,b,c){a!==c&&d.copy(c.center,a.center);c.radius=a.radius+b;return c}function G(a,b,c){T.error("sphere.setExtent is not yet supported");return a===c?c:q(a,c)}function k(a,b,c){if(N.isNone(b))return!1;var f=d.subtract(h.sv3d.get(),b.origin,a.center),g=d.dot(b.direction,b.direction);const n=2*d.dot(b.direction,f);a=d.dot(f,f)-a.radius*a.radius;a=n*n-4*g*a;if(0>a)return!1;f=Math.sqrt(a);a=(-n-f)/(2*g);g=(-n+f)/(2*g);if(0>a||g<a&&0<g)a=g;if(0>a)return!1;c&&d.add(c,b.origin,d.scale(h.sv3d.get(),
b.direction,a));return!0}function H(a,b,c,f){b=p.fromScreenAtEye(b,c,U);return k(a,b,f)}function I(a,b){return k(a,b,null)}function J(a,b,c){if(k(a,b,c))return c;a=t(a,b,h.sv3d.get());d.add(c,b.origin,d.scale(h.sv3d.get(),b.direction,d.distance(b.origin,a)/d.length(b.direction)));return c}function t(a,b,c){const f=h.sv3d.get(),g=h.sm4d.get();d.cross(f,b.origin,b.direction);d.cross(c,f,b.origin);d.scale(c,c,1/d.length(c)*a.radius);a=u(a,b.origin);b=R.angle(b.origin,c);C.identity(g);C.rotate(g,g,b+
a,f);d.transformMat4(c,c,g);return c}function K(a,b,c){if(k(a,b,c))return c;p.closestPoint(b,a.center,c);return v(a,c,c)}function v(a,b,c){b=d.subtract(h.sv3d.get(),b,a.center);b=d.scale(h.sv3d.get(),b,a.radius/d.length(b));return d.add(c,b,a.center)}function L(a,b){b=d.subtract(h.sv3d.get(),b,a.center);b=d.squaredLength(b);return Math.sqrt(Math.abs(b-a.radius*a.radius))}function u(a,b){b=d.subtract(h.sv3d.get(),b,a.center);b=d.length(b);return P.acosClamped(a.radius/(a.radius+Math.abs(a.radius-b)))}
function w(a,b,c,f){a=d.subtract(x,b,a.center);switch(c){case 0:return c=B.cartesianToSpherical(a,x)[2],d.set(f,-Math.sin(c),Math.cos(c),0);case 1:return a=B.cartesianToSpherical(a,x),c=a[1],a=a[2],b=Math.sin(c),d.set(f,-b*Math.cos(a),-b*Math.sin(a),Math.cos(c));case 2:return d.normalize(f,a)}}function y(a,b){b=d.subtract(z,b,a.center);return d.length(b)-a.radius}function M(a,b,c,f){const g=y(a,b);a=w(a,b,2,z);c=d.scale(z,a,c-g);d.add(f,b,c);return f}const T=O.getLogger("esri.views.3d.support.geometryUtils.sphere"),
x=l.create(),S=new Q.ObjectStack(()=>({center:null,radius:0})),U=p.create(),E=l.create(),z=l.create();Object.freeze(E);A=Object.freeze({__proto__:null,create:m,wrap:D,copy:q,fromValues:r,elevate:F,setExtent:G,intersectRay:k,intersectScreen:H,intersectsRay:I,intersectRayClosestSilhouette:J,closestPointOnSilhouette:t,closestPoint:K,projectPoint:v,distanceToSilhouette:L,angleToSilhouette:u,axisAt:w,altitudeAt:y,setAltitudeAt:M});e.altitudeAt=y;e.angleToSilhouette=u;e.axisAt=w;e.closestPoint=K;e.closestPointOnSilhouette=
t;e.copy=q;e.create=m;e.distanceToSilhouette=L;e.elevate=F;e.fromValues=r;e.intersectRay=k;e.intersectRayClosestSilhouette=J;e.intersectScreen=H;e.intersectsRay=I;e.projectPoint=v;e.setAltitudeAt=M;e.setExtent=G;e.sphereModule=A;e.wrap=D});