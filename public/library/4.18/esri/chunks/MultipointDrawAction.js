// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.18/esri/copyright.txt for details.
//>>built
define("exports ./_rollupPluginBabelHelpers ./tslib.es6 ../core/has ../core/maybe ../core/Logger ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/property ../core/jsonMap ../core/accessorSupport/decorators/subclass ../core/urlUtils ../core/uuid ../portal/support/resourceExtension ../core/Handles ../views/input/InputManager ../views/support/screenUtils ../views/draw/DrawAction ../views/draw/input/DrawEvents ../views/draw/input/Keys".split(" "),function(g,r,h,x,m,y,z,t,A,u,B,C,
D,v,f,n,w,e,k){g.MultipointDrawAction=function(p){function l(a){a=p.call(this,a)||this;a._cursorMoved=!1;a._cursorScreenPoint=null;a._dragEnabled=!0;a._pointerDownEvent=null;a._viewHandles=new v;a.vertices=[];return a}r._inheritsLoose(l,p);var d=l.prototype;d.initialize=function(){this._addViewHandles()};d.destroy=function(){this._removeViewHandles();this._viewHandles.destroy();this.emit("destroy")};d.addVertex=function(a,b){isNaN(b)?(b=this.vertices.length,this.vertices.push(a)):this.vertices.splice(b,
0,a);this.history.push({vertex:a,vertexIndex:b,undo:()=>this._undoVertexAdd(null,b),redo:()=>this._redoVertexAdd(null,a,b)});this._set("redoHistory",[]);const c=new e.VertexAddEvent(this.view,null,b,this.vertices);this.emit("vertex-add",c);c.defaultPrevented&&(this._cursorMoved=!0,this.history.pop())};d.removeVertex=function(a){const b=this.vertices.splice(a,1)[0];this.history.push({vertex:b,vertexIndex:a,undo:()=>this._undoVertexRemove(null,b,a),redo:()=>this._redoVertexRemove(null,a)});this._set("redoHistory",
[]);this.emit("vertex-remove",new e.VertexRemoveEvent(this.view,null,a,this.vertices))};d.updateVertex=function(a,b){const c=this.vertices[b];this.vertices[b]=a;this.history.push({vertex:a,vertexIndex:b,undo:()=>this._undoVertexUpdate(null,c,b),redo:()=>this._redoVertexUpdate(null,a,b)});this._set("redoHistory",[]);this.emit("vertex-update",new e.VertexUpdateEvent(this.view,null,b,this.vertices))};d.complete=function(){this._completeDrawing()};d._addViewHandles=function(){this._removeViewHandles();
this._viewHandles.add([this.view.on("click",a=>{a.stopPropagation()},f.ViewEventPriorities.TOOL),this.view.on("pointer-down",a=>{this._cursorMoved&&this.vertices.pop();this._pointerDownEvent=a;this._cursorMoved=!1;this._cursorScreenPoint=n.createScreenPointFromEvent(a)},f.ViewEventPriorities.TOOL),this.view.on("pointer-move",a=>{this._cursorMoved&&this.vertices.pop();this._cursorMoved=!0;this._cursorScreenPoint=n.createScreenPointFromEvent(a);this._cursorUpdateHandler(a)},f.ViewEventPriorities.TOOL),
this.view.on("pointer-up",a=>{this._pointerDownEvent&&(this._cursorMoved?(this.vertices.pop(),this._cursorMoved=!1):(this._pointerDownEvent=null,this._vertexAddHandler(a)))},f.ViewEventPriorities.TOOL),this.view.on("drag",a=>{this._dragEnabled&&this._pointerDownEvent&&a.stopPropagation()},f.ViewEventPriorities.TOOL),this.view.on("drag",["Shift"],a=>{a.stopPropagation()},f.ViewEventPriorities.TOOL),this.view.on("double-click",a=>{a.stopPropagation();this._drawCompleteHandler(a)},f.ViewEventPriorities.TOOL),
this.view.on("double-click",["Control"],a=>{a.stopPropagation();this._drawCompleteHandler(a)},f.ViewEventPriorities.TOOL),this.view.on("key-down",a=>{a.key===k.KEYS.vertexAddKey&&!a.repeat&&this._cursorScreenPoint?(this._cursorMoved&&(this.vertices.pop(),this._cursorMoved=!1),this._vertexAddHandler(a)):a.key===k.KEYS.drawCompleteKey&&!a.repeat&&this._cursorScreenPoint?(this._cursorMoved&&(this.vertices.pop(),this._cursorMoved=!1),this._vertexAddHandler(a),this._drawCompleteHandler(a)):a.key!==k.KEYS.undoKey||
this.interactiveUndoDisabled||a.repeat?a.key!==k.KEYS.redoKey||this.interactiveUndoDisabled||a.repeat||(a.stopPropagation(),this.redo()):(a.stopPropagation(),this.undo())},f.ViewEventPriorities.TOOL)])};d._removeViewHandles=function(){this._viewHandles.removeAll()};d._addVertex=function(a,b){this.vertices.push(a);const c=this.vertices.indexOf(a);this.history.push({vertex:a,vertexIndex:c,undo:()=>this._undoVertexAdd(b,c),redo:()=>this._redoVertexAdd(b,a,c)});this._set("redoHistory",[]);const q=new e.VertexAddEvent(this.view,
b,c,this.vertices);this.emit("vertex-add",q);q.defaultPrevented&&(this._cursorMoved=!0,this.history.pop())};d._updateCursor=function(a,b){this.vertices.push(a);a=this.vertices.indexOf(a);b=new e.CursorUpdateEvent(this.view,b,a,this.vertices);this.emit("cursor-update",b)};d._completeDrawing=function(a){this._cursorMoved=!1;this._pointerDownEvent=null;1>this.vertices.length||(a=new e.DrawCompleteEvent(a,this.vertices),this.emit("draw-complete",a),a.defaultPrevented?this._cursorMoved=!0:this._removeViewHandles())};
d._undoVertexAdd=function(a,b){this.vertices.splice(b,1);this.emit("undo",new e.VertexRemoveEvent(this.view,a,b,this.vertices))};d._redoVertexAdd=function(a,b,c){this.vertices.splice(c,0,b);this.emit("redo",new e.VertexAddEvent(this.view,a,c,this.vertices))};d._undoVertexRemove=function(a,b,c){this.vertices.splice(c,0,b);this.emit("undo",new e.VertexAddEvent(this.view,a,c,this.vertices))};d._redoVertexRemove=function(a,b){this.vertices.splice(b,1);this.emit("redo",new e.VertexRemoveEvent(this.view,
a,b,this.vertices))};d._undoVertexUpdate=function(a,b,c){this.vertices[c]=b;this.emit("undo",new e.VertexUpdateEvent(this.view,a,c,this.vertices))};d._redoVertexUpdate=function(a,b,c){this.vertices[c]=b;this.emit("redo",new e.VertexUpdateEvent(this.view,a,c,this.vertices))};d._vertexAddHandler=function(a){const b=this.getCoordsFromScreenPoint(this._cursorScreenPoint);m.isSome(b)&&this._addVertex(b,a.native)};d._cursorUpdateHandler=function(a){const b=this.getCoordsFromScreenPoint(this._cursorScreenPoint);
m.isSome(b)&&this._updateCursor(b,a.native)};d._drawCompleteHandler=function(a){this._completeDrawing(a.native)};return l}(w);h.__decorate([t.property({readOnly:!0})],g.MultipointDrawAction.prototype,"vertices",void 0);g.MultipointDrawAction=h.__decorate([u.subclass("esri.views.draw.MultipointDrawAction")],g.MultipointDrawAction);h=Object.freeze({__proto__:null,get MultipointDrawAction(){return g.MultipointDrawAction}});g.MultipointDrawAction$1=h});