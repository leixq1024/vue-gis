// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.18/esri/copyright.txt for details.
//>>built
define("exports ../../config ../../core/maybe ../../core/Logger ../../core/Error ../../core/promiseUtils ./spatialReferenceUtils ../SpatialReference ./webMercatorUtils ../Polygon ../Polyline ../../tasks/geometry/cut ../../tasks/geometry/simplify".split(" "),function(x,L,E,M,N,O,C,z,A,D,u,P,Q){function y(a){return"polygon"===a.type?a.rings:a.paths}function v(a,b){return Math.ceil((a-b)/(2*b))}function F(a,b){const c=y(a);for(const e of c)for(const f of e)f[0]+=b;return a}function G(a){const b=[];let c=
0,e=0;for(let f=0;f<a.length;f++){const h=a[f];let k=null;for(let g=0;g<h.length;g++)k=h[g],b.push(k),0===g?e=c=k[0]:(c=Math.min(c,k[0]),e=Math.max(e,k[0]));k&&b.push([(c+e)/2,0])}return b}function H(a,b){if(!(a instanceof u||a instanceof D))throw R.error("straightLineDensify: the input geometry is neither polyline nor polygon"),new N("straightLineDensify: the input geometry is neither polyline nor polygon");var c=y(a);const e=[];for(const h of c){c=[];e.push(c);c.push([h[0][0],h[0][1]]);for(let k=
0;k<h.length-1;k++){const g=h[k][0],l=h[k][1],d=h[k+1][0],m=h[k+1][1];var f=Math.sqrt((d-g)*(d-g)+(m-l)*(m-l));const p=(m-l)/f,q=(d-g)/f,r=f/b;if(1<r){for(let n=1;n<=r-1;n++){const t=n*b;c.push([q*t+g,p*t+l])}f=(f+Math.floor(r-1)*b)/2;c.push([q*f+g,p*f+l])}c.push([d,m])}}return"polygon"===a.type?new D({rings:e,spatialReference:a.spatialReference}):new u({paths:e,spatialReference:a.spatialReference})}function I(a,b,c){b&&(a=H(a,1E6),a=A.webMercatorToGeographic(a,!0));c&&(a=F(a,c));return a}function J(a,
b,c){if(Array.isArray(a)){var e=a[0];e>b?(c=v(e,b),a[0]=e+-2*c*b):e<c&&(b=v(e,c),a[0]=e+-2*b*c)}else e=a.x,e>b?(c=v(e,b),a=a.clone().offset(-2*c*b,0)):e<c&&(b=v(e,c),a=a.clone().offset(-2*b*c,0));return a}function S(a,b){let c=-1;for(let e=0;e<b.cutIndexes.length;e++){const f=b.cutIndexes[e],h=b.geometries[e],k=y(h);for(let g=0;g<k.length;g++){const l=k[g];l.some(d=>{if(180>d[0])return!0;d=0;for(var m=0;m<l.length;m++){var p=l[m][0];d=p>d?p:d}d=Number(d.toFixed(9));d=-360*v(d,180);for(m=0;m<l.length;m++)p=
h.getPoint(g,m),h.setPoint(g,m,p.clone().offset(d,0));return!0})}if(f===c)if("polygon"===a[0].type)for(const g of y(h))a[f]=a[f].addRing(g);else{if("polyline"===a[0].type)for(const g of y(h))a[f]=a[f].addPath(g)}else c=f,a[f]=h}return a}async function K(a,b,c){if(!Array.isArray(a))return K([a],b);var e=b?b.url:L.geometryServiceUrl;let f,h,k;let g=0;var l=[];b=[];for(var d of a)if(E.isNone(d))b.push(d);else{if(!m){var m=d.spatialReference;var p=C.getInfo(m);var q=(f=m.isWebMercator)?102100:4326;h=
B[q].maxX;k=B[q].minX;var r=B[q].plus180Line;q=B[q].minus180Line}if(p)if("mesh"===d.type)b.push(d);else if("point"===d.type)b.push(J(d.clone(),h,k));else if("multipoint"===d.type){var n=d.clone();n.points=n.points.map(t=>J(t,h,k));b.push(n)}else if("extent"===d.type)n=d.clone()._normalize(!1,!1,p),b.push(n.rings?new D(n):n);else if(d.extent){n=d.extent;const t=2*v(n.xmin,k)*h;let w=0===t?d.clone():F(d.clone(),t);n.offset(t,0);n.intersects(r)&&n.xmax!==h?(g=n.xmax>g?n.xmax:g,w=I(w,f),l.push(w),b.push("cut")):
n.intersects(q)&&n.xmin!==k?(g=2*n.xmax*h>g?2*n.xmax*h:g,w=I(w,f,360),l.push(w),b.push("cut")):b.push(w)}else b.push(d.clone());else b.push(d)}m=v(g,h);p=-90;r=m;for(d=new u;0<m;)q=-180+360*m,d.addPath([[q,p],[q,-1*p]]),p*=-1,m--;if(0<l.length&&0<r){m=await P.cut(e,l,d,c);m=S(l,m);p=[];l=[];for(r=0;r<b.length;r++)d=b[r],"cut"!==d?l.push(d):(d=m.shift(),q=a[r],E.isSome(q)&&"polygon"===q.type&&q.rings&&1<q.rings.length&&d.rings.length>=q.rings.length?(p.push(d),l.push("simplify")):l.push(f?A.geographicToWebMercator(d):
d));if(!p.length)return l;b=await Q.simplify(e,p,c);a=[];for(c=0;c<l.length;c++)e=l[c],"simplify"!==e?a.push(e):a.push(f?A.geographicToWebMercator(b.shift()):b.shift());return a}a=[];for(c=0;c<b.length;c++)e=b[c],"cut"!==e?a.push(e):(e=l.shift(),a.push(!0===f?A.geographicToWebMercator(e):e));return O.resolve(a)}const R=M.getLogger("esri.geometry.support.normalizeUtils"),B={102100:{maxX:2.0037508342788905E7,minX:-2.0037508342788905E7,plus180Line:new u({paths:[[[2.0037508342788905E7,-2.0037508342788905E7],
[2.0037508342788905E7,2.0037508342788905E7]]],spatialReference:z.WebMercator}),minus180Line:new u({paths:[[[-2.0037508342788905E7,-2.0037508342788905E7],[-2.0037508342788905E7,2.0037508342788905E7]]],spatialReference:z.WebMercator})},4326:{maxX:180,minX:-180,plus180Line:new u({paths:[[[180,-180],[180,180]]],spatialReference:z.WGS84}),minus180Line:new u({paths:[[[-180,-180],[-180,180]]],spatialReference:z.WGS84})}};x.getDenormalizedExtent=function(a){if(!a)return null;const b=a.extent;if(!b)return null;
var c=a.spatialReference&&C.getInfo(a.spatialReference);if(!c)return b;const [e,f]=c.valid;({width:c}=b);let {xmin:h,xmax:k}=b;[h,k]=[k,h];if("extent"===a.type||0===c||c<=f||c>2*f||h<e||k>f)return b;let g;switch(a.type){case "polygon":if(1<a.rings.length)g=G(a.rings);else return b;break;case "polyline":if(1<a.paths.length)g=G(a.paths);else return b;break;case "multipoint":g=a.points}a=b.clone();for(let l=0;l<g.length;l++){let d=g[l][0];0>d?(d+=f,k=Math.max(d,k)):(d-=f,h=Math.min(d,h))}a.xmin=h;a.xmax=
k;return a.width<c?(a.xmin-=f,a.xmax-=f,a):b};x.normalizeCentralMeridian=K;x.normalizeMapX=function(a,b){if(b=C.getInfo(b)){const [c,e]=b.valid;b=e-c;if(a<c)for(;a<c;)a+=b;if(a>e)for(;a>e;)a-=b}return a};x.straightLineDensify=H;Object.defineProperty(x,"__esModule",{value:!0})});