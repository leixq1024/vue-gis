// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.31/esri/copyright.txt for details.
//>>built
define(["exports","../rest/support/ClassBreaksDefinition","../rest/support/generateRendererUtils"],function(m,K,L){function r(a){return null==a||"string"===typeof a&&!a?"\x3cNull\x3e":a}function A(a){const b=null!=a.minValue||null!=a.maxValue,c=!!a.sqlExpression&&a.supportsSQLExpression;return!(null!=a.normalizationField||null!=a.normalizationType)&&!b&&!c}function B(a){const {values:b,useSampleStdDev:c,supportsNullCount:d,outStatisticTypes:e}=a;var g=Number.POSITIVE_INFINITY;let f=Number.NEGATIVE_INFINITY,
h=null,k=null;var n=null;let q=null,l=0;const t=null==a.minValue?-Infinity:a.minValue,u=null==a.maxValue?Infinity:a.maxValue;for(const p of b)Number.isFinite(p)?p>=t&&p<=u&&(h=null===h?p:h+p,g=Math.min(g,p),f=Math.max(f,p),l++):"string"===typeof p&&l++;if(l&&null!=h){k=h/l;n=0;for(const p of b)Number.isFinite(p)&&p>=t&&p<=u&&(n+=(p-k)**2);q=c?1<l?n/(l-1):0:0<l?n/l:0;n=Math.sqrt(q)}else f=g=null;g={avg:k,count:l,max:f,min:g,stddev:n,sum:h,variance:q};d&&(g.nullcount=b.length-l);!a.percentileParams||
e?.include?.length&&!e.include.includes("median")||e?.exclude?.length&&e.exclude.includes("median")||(g.median=x(b,a.percentileParams));return g}function x(a,b){const {fieldType:c,value:d,orderBy:e,isDiscrete:g}=b,f=C(c,"desc"===e);a=[...a].filter(q=>null!=q).sort((q,l)=>f(q,l));if(0===a.length)return null;if(0>=d)return a[0];if(1<=d)return a[a.length-1];var h=(a.length-1)*d,k=Math.floor(h);b=k+1;h%=1;k=a[k];const n=a[b];return b>=a.length||g||"string"===typeof k||"string"===typeof n?k:k*(1-h)+n*
h}function C(a,b){if(a){if(M.has(a))return b?D:E;if(N.has(a))return y(b,!1);if("esriFieldTypeTimestampOffset"===a)return b?O:P;const f=y(b,!0);if("esriFieldTypeString"===a)return f;if("esriFieldTypeGUID"===a||"esriFieldTypeGlobalID"===a)return(h,k)=>f(F(h),F(k))}const c=b?1:-1,d=b?D:E,e=y(b,!0),g=b?v:w;return(f,h)=>"number"===typeof f&&"number"===typeof h?d(f,h):"string"===typeof f&&"string"===typeof h?e(f,h):g(f,h)??c}function y(a,b){if(!b)return a?Q:R;const c=a?v:w;return a?(d,e)=>{const g=c(d,
e);if(null!=g)return g;d=d.toUpperCase();e=e.toUpperCase();return d>e?-1:d<e?1:0}:(d,e)=>{const g=c(d,e);if(null!=g)return g;d=d.toUpperCase();e=e.toUpperCase();return d<e?-1:d>e?1:0}}function F(a){return a.slice(24,36)+a.slice(19,23)+a.slice(16,18)+a.slice(14,16)+a.slice(11,13)+a.slice(9,11)+a.slice(6,8)+a.slice(4,6)+a.slice(2,4)+a.slice(0,2)}function z(a){return"coded-value"!==a?.type?[]:a.codedValues.map(b=>b.code)}function G(a,b){const c=H({field:b.field,normalizationType:b.normalizationType,
normalizationField:b.normalizationField,classificationMethod:b.classificationMethod,standardDeviationInterval:b.standardDeviationInterval,breakCount:b.numClasses||5});a=S(a,b.minValue,b.maxValue);return L.createGenerateRendererClassBreaks({definition:c,values:a,normalizationTotal:b.normalizationTotal})}function S(a,b,c){const d=null==b?-Infinity:b,e=null==c?Infinity:c;return a.filter(g=>Number.isFinite(g)&&g>=d&&g<=e)}function H(a){const {breakCount:b,field:c,normalizationField:d,normalizationType:e}=
a,g=a.classificationMethod||"equal-interval";return new K({breakCount:b,classificationField:c,classificationMethod:g,normalizationField:"field"===e?d:void 0,normalizationType:e,standardDeviationInterval:"standard-deviation"===g?a.standardDeviationInterval||1:void 0,definedInterval:"defined-interval"===g?a.definedInterval:void 0})}function T(a,b){const {field:c,classificationMethod:d,standardDeviationInterval:e,normalizationType:g,normalizationField:f,normalizationTotal:h,minValue:k,maxValue:n}=b,
q=b.numBins||10;let l=b=null,t=null;d&&"equal-interval"!==d||g?({classBreaks:a}=G(a,{field:c,normalizationType:g,normalizationField:f,normalizationTotal:h,classificationMethod:d,standardDeviationInterval:e,minValue:k,maxValue:n,numClasses:q}),b=a[0].minValue,l=a[a.length-1].maxValue,t=a.map(u=>[u.minValue,u.maxValue])):(null!=k&&null!=n?(b=k,l=n):(a=B({values:a,minValue:k,maxValue:n,useSampleStdDev:!g,supportsNullCount:A({normalizationType:g,normalizationField:f,minValue:k,maxValue:n})}),b=a.min??
null,l=a.max??null),t=I(b??0,l??0,q));return{min:b,max:l,intervals:t}}function U(a,b){let c=-1;for(let d=a.length-1;0<=d;d--)if(b>=a[d][0]){c=d;break}return c}function I(a,b,c){const d=(b-a)/c,e=[];let g;for(let f=1;f<=c;f++)g=a+d,g=Number(g.toFixed(16)),e.push([a,f===c?b:g]),a=g;return e}const V=/\s*(\+|-)?((\d+(\.\d+)?)|(\.\d+))\s*/gi,M=new Set("esriFieldTypeDate esriFieldTypeInteger esriFieldTypeSmallInteger esriFieldTypeSingle esriFieldTypeDouble esriFieldTypeLong esriFieldTypeOID esriFieldTypeBigInteger".split(" ")),
N=new Set(["esriFieldTypeTimeOnly","esriFieldTypeDateOnly"]),J="min max avg stddev count sum variance nullcount median".split(" "),v=(a,b)=>null==a?null==b?0:1:null==b?-1:null,w=(a,b)=>null==a?null==b?0:-1:null==b?1:null,P=(a,b)=>w(a,b)??(a===b?0:(new Date(a)).getTime()-(new Date(b)).getTime()),O=(a,b)=>v(a,b)??(a===b?0:(new Date(b)).getTime()-(new Date(a)).getTime()),R=(a,b)=>w(a,b)??(a===b?0:a<b?-1:1),Q=(a,b)=>v(a,b)??(a===b?0:a<b?1:-1),D=(a,b)=>v(a,b)??b-a,E=(a,b)=>w(a,b)??a-b;m.calculateClassBreaks=
G;m.calculateHistogram=function(a,b){var c=T(a,b);if(null==c.min&&null==c.max)return{bins:[],minValue:c.min,maxValue:c.max,normalizationTotal:b.normalizationTotal};const d=c.intervals,e=c.min??0;c=c.max??0;const g=d.map((f,h)=>({minValue:d[h][0],maxValue:d[h][1],count:0}));for(const f of a)null!=f&&f>=e&&f<=c&&(a=U(d,f),-1<a&&g[a].count++);return{bins:g,minValue:e,maxValue:c,normalizationTotal:b.normalizationTotal}};m.calculatePercentile=x;m.calculateStatistics=B;m.calculateStringStatistics=function(a){const {outStatisticTypes:b}=
a,c=a.returnDistinct?[...(new Set(a.values))]:a.values;var d=c.filter(g=>null!=g).sort();const e=d.length;d={count:e,min:d[0],max:d[e-1]};a.supportsNullCount&&(d.nullcount=c.length-e);!a.percentileParams||b?.include?.length&&!b.include.includes("median")||b?.exclude?.length&&b.exclude.includes("median")||(d.median=x(c,a.percentileParams));return d};m.calculateUniqueValuesCount=function(a){const b={};for(let c of a){if(null==c||"string"===typeof c&&""===c.trim())c=null;null==b[c]?b[c]={count:1,data:c}:
b[c].count++}return{count:b}};m.createClassBreaksDefinition=H;m.createUVResult=function(a,b,c,d){a=a.count;const e=[];if(c&&b){c=[];var g=z(b[0]);for(const f of g)if(b[1]){g=z(b[1]);for(const h of g)if(b[2]){g=z(b[2]);for(const k of g)c.push(`${r(f)}${d}${r(h)}${d}${r(k)}`)}else c.push(`${r(f)}${d}${r(h)}`)}else c.push(f);for(const f of c)a.hasOwnProperty(f)||(a[f]={data:f,count:0})}for(const f in a)b=a[f],e.push({value:b.data,count:b.count,label:b.label});return{uniqueValueInfos:e}};m.getAttributeComparator=
C;m.getEqualIntervalBins=I;m.getNormalizedValue=function(a,b,c,d){let e=null;switch(b){case "log":0!==a&&(e=Math.log(a)*Math.LOG10E);break;case "percent-of-total":Number.isFinite(d)&&0!==d&&(e=a/d*100);break;case "field":Number.isFinite(c)&&0!==c&&(e=a/c);break;case "natural-log":0<a&&(e=Math.log(a));break;case "square-root":0<a&&(e=a**.5)}return e};m.isNullCountSupported=A;m.processNullValue=r;m.processSummaryStatisticsResult=function(a,b,c){let d;for(d in a)b?.include?.length&&!b.include.includes(d)||
b?.exclude?.length&&b.exclude.includes(d)?delete a[d]:J.includes(d)&&(Number.isFinite(a[d])||(a[d]=null));if(!c)return a;["avg","stddev","variance"].forEach(e=>{null!=a[e]&&(a[e]=Math.ceil(a[e]??0))});return a};m.resolveCBResult=function(a,b){let c=a.classBreaks;const d=c[0]?.minValue,e=c[c.length-1]?.maxValue,g="standard-deviation"===b;c=c.map(f=>{const h=f.label;f={minValue:f.minValue,maxValue:f.maxValue,label:h};if(g&&h){const k=h.match(V)?.map(n=>+n.trim())??[];2===k.length?(f.minStdDev=k[0],
f.maxStdDev=k[1],0>k[0]&&0<k[1]&&(f.hasAvg=!0)):1===k.length&&(h.includes("\x3c")?(f.minStdDev=null,f.maxStdDev=k[0]):h.includes("\x3e")&&(f.minStdDev=k[0],f.maxStdDev=null))}return f});return{minValue:d,maxValue:e,classBreakInfos:c,normalizationTotal:a.normalizationTotal}};m.statisticTypes=J;Object.defineProperty(m,Symbol.toStringTag,{value:"Module"})});