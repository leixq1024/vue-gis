// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.31/esri/copyright.txt for details.
//>>built
define(["exports","../time"],function(D,S){function H(){if(I)return t;I=1;Object.defineProperty(t,"__esModule",{value:!0});t.loop=t.conditional=t.parse=void 0;t.parse=function c(g,a){var d=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},k=3<arguments.length&&void 0!==arguments[3]?arguments[3]:d;if(Array.isArray(a))a.forEach(function(h){return c(g,h,d,k)});else if("function"===typeof a)a(g,d,k,c);else{var f=Object.keys(a)[0];Array.isArray(a[f])?(k[f]={},c(g,a[f],d,k[f])):k[f]=a[f](g,d,k,
c)}return d};t.conditional=function(g,a){return function(c,d,k,f){a(c,d,k)&&f(c,g,d,k)}};t.loop=function(g,a){return function(c,d,k,f){for(var h=[],b=c.pos;a(c,d,k);){var e={};f(c,g,d,e);if(c.pos===b)break;b=c.pos;h.push(e)}return h}};return t}function J(){if(K)return n;K=1;Object.defineProperty(n,"__esModule",{value:!0});n.readBits=n.readArray=n.readUnsigned=n.readString=n.peekBytes=n.readBytes=n.peekByte=n.readByte=n.buildStream=void 0;n.buildStream=function(a){return{data:a,pos:0}};var m=function(){return function(a){return a.data[a.pos++]}};
n.readByte=m;n.peekByte=function(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0;return function(c){return c.data[c.pos+a]}};var g=function(a){return function(c){return c.data.subarray(c.pos,c.pos+=a)}};n.readBytes=g;n.peekBytes=function(a){return function(c){return c.data.subarray(c.pos,c.pos+a)}};n.readString=function(a){return function(c){return Array.from(g(a)(c)).map(function(d){return String.fromCharCode(d)}).join("")}};n.readUnsigned=function(a){return function(c){c=g(2)(c);
return a?(c[1]<<8)+c[0]:(c[0]<<8)+c[1]}};n.readArray=function(a,c){return function(d,k,f){k="function"===typeof c?c(d,k,f):c;f=g(a);for(var h=Array(k),b=0;b<k;b++)h[b]=f(d);return h}};n.readBits=function(a){return function(c){c=m()(c);for(var d=Array(8),k=0;8>k;k++)d[7-k]=!!(c&1<<k);return Object.keys(a).reduce(function(f,h){var b=a[h];if(b.length){for(var e=b.length,l=0,p=0;p<e;p++)l+=d[b.index+p]&&Math.pow(2,e-p-1);f[h]=l}else f[h]=d[b.index];return f},{})}};return n}function T(){if(L)return G;
L=1;(function(m){Object.defineProperty(m,"__esModule",{value:!0});m["default"]=void 0;var g=H(),a=J(),c={blocks:function(b){for(var e=[],l=b.data.length,p=0,q=(0,a.readByte)()(b);0!==q&&q;q=(0,a.readByte)()(b)){if(b.pos+q>=l){l-=b.pos;e.push((0,a.readBytes)(l)(b));p+=l;break}e.push((0,a.readBytes)(q)(b));p+=q}b=new Uint8Array(p);for(l=p=0;l<e.length;l++)b.set(e[l],p),p+=e[l].length;return b}},d=(0,g.conditional)({gce:[{codes:(0,a.readBytes)(2)},{byteSize:(0,a.readByte)()},{extras:(0,a.readBits)({future:{index:0,
length:3},disposal:{index:3,length:3},userInput:{index:6},transparentColorGiven:{index:7}})},{delay:(0,a.readUnsigned)(!0)},{transparentColorIndex:(0,a.readByte)()},{terminator:(0,a.readByte)()}]},function(b){b=(0,a.peekBytes)(2)(b);return 33===b[0]&&249===b[1]}),k=(0,g.conditional)({image:[{code:(0,a.readByte)()},{descriptor:[{left:(0,a.readUnsigned)(!0)},{top:(0,a.readUnsigned)(!0)},{width:(0,a.readUnsigned)(!0)},{height:(0,a.readUnsigned)(!0)},{lct:(0,a.readBits)({exists:{index:0},interlaced:{index:1},
sort:{index:2},future:{index:3,length:2},size:{index:5,length:3}})}]},(0,g.conditional)({lct:(0,a.readArray)(3,function(b,e,l){return Math.pow(2,l.descriptor.lct.size+1)})},function(b,e,l){return l.descriptor.lct.exists}),{data:[{minCodeSize:(0,a.readByte)()},c]}]},function(b){return 44===(0,a.peekByte)()(b)}),f=(0,g.conditional)({text:[{codes:(0,a.readBytes)(2)},{blockSize:(0,a.readByte)()},{preData:function(b,e,l){return(0,a.readBytes)(l.text.blockSize)(b)}},c]},function(b){b=(0,a.peekBytes)(2)(b);
return 33===b[0]&&1===b[1]}),h=(0,g.conditional)({application:[{codes:(0,a.readBytes)(2)},{blockSize:(0,a.readByte)()},{id:function(b,e,l){return(0,a.readString)(l.blockSize)(b)}},c]},function(b){b=(0,a.peekBytes)(2)(b);return 33===b[0]&&255===b[1]});c=(0,g.conditional)({comment:[{codes:(0,a.readBytes)(2)},c]},function(b){b=(0,a.peekBytes)(2)(b);return 33===b[0]&&254===b[1]});g=[{header:[{signature:(0,a.readString)(3)},{version:(0,a.readString)(3)}]},{lsd:[{width:(0,a.readUnsigned)(!0)},{height:(0,a.readUnsigned)(!0)},
{gct:(0,a.readBits)({exists:{index:0},resolution:{index:1,length:3},sort:{index:4},size:{index:5,length:3}})},{backgroundColorIndex:(0,a.readByte)()},{pixelAspectRatio:(0,a.readByte)()}]},(0,g.conditional)({gct:(0,a.readArray)(3,function(b,e){return Math.pow(2,e.lsd.gct.size+1)})},function(b,e){return e.lsd.gct.exists}),{frames:(0,g.loop)([d,h,c,k,f],function(b){b=(0,a.peekByte)()(b);return 33===b||44===b})}];m["default"]=g})(G);return G}function U(){if(M)return y;M=1;Object.defineProperty(y,"__esModule",
{value:!0});y.deinterlace=void 0;y.deinterlace=function(m,g){for(var a=Array(m.length),c=m.length/g,d=[0,4,2,1],k=[8,8,4,2],f=0,h=0;4>h;h++)for(var b=d[h];b<c;b+=k[h]){var e=b,l=m.slice(f*g,(f+1)*g);a.splice.apply(a,[e*g,g].concat(l));f++}return a};return y}function V(){if(N)return z;N=1;Object.defineProperty(z,"__esModule",{value:!0});z.lzw=void 0;z.lzw=function(m,g,a){var c,d,k,f,h,b,e,l,p=Array(a),q=Array(4096),A=Array(4096),B=Array(4097);var w=1<<m;var W=w+1;var r=w+2;var x=-1;var v=m+1;var E=
(1<<v)-1;for(d=0;d<w;d++)q[d]=0,A[d]=d;for(k=f=c=h=b=l=e=0;k<a;){if(0===b){if(c<v){f+=g[e]<<c;c+=8;e++;continue}d=f&E;f>>=v;c-=v;if(d>r||d==W)break;if(d==w){v=m+1;E=(1<<v)-1;r=w+2;x=-1;continue}if(-1==x){B[b++]=A[d];h=x=d;continue}var X=d;d==r&&(B[b++]=h,d=x);for(;d>w;)B[b++]=A[d],d=q[d];h=A[d]&255;B[b++]=h;4096>r&&(q[r]=x,A[r]=h,r++,0===(r&E)&&4096>r&&(v++,E+=r));x=X}b--;p[l++]=B[b];k++}for(k=l;k<a;k++)p[k]=0;return p};return z}function Y(m,g){F??=document.createElement("canvas");F.width=m;F.height=
g;return F.getContext("2d",{willReadFrequently:!0})}function Z(m){C??=document.createElement("canvas");O??=C.getContext("2d",{willReadFrequently:!0});C.width=m.width;C.height=m.height;O.putImageData(m,0,0);return C}function P(m){const g=new Uint8Array(m);return!aa.some((a,c)=>a!==g[c])}var u={},G={},t={},I,n={},K,L,y={},M,z={},N,Q,R=function(){if(Q)return u;Q=1;Object.defineProperty(u,"__esModule",{value:!0});u.decompressFrames=u.decompressFrame=u.parseGIF=void 0;var m=function(f){return f&&f.__esModule?
f:{default:f}}(T()),g=H(),a=J(),c=U(),d=V();u.parseGIF=function(f){f=new Uint8Array(f);return(0,g.parse)((0,a.buildStream)(f),m["default"])};var k=function(f,h,b){if(f.image){var e=f.image,l=(0,d.lzw)(e.data.minCodeSize,e.data.blocks,e.descriptor.width*e.descriptor.height);e.descriptor.lct.interlaced&&(l=(0,c.deinterlace)(l,e.descriptor.width));l={pixels:l,dims:{top:f.image.descriptor.top,left:f.image.descriptor.left,width:f.image.descriptor.width,height:f.image.descriptor.height}};l.colorTable=e.descriptor.lct&&
e.descriptor.lct.exists?e.lct:h;f.gce&&(l.delay=10*(f.gce.delay||10),l.disposalType=f.gce.extras.disposal,f.gce.extras.transparentColorGiven&&(l.transparentIndex=f.gce.transparentColorIndex));if(b){f=l.pixels.length;h=new Uint8ClampedArray(4*f);for(b=0;b<f;b++){e=4*b;var p=l.pixels[b],q=l.colorTable[p]||[0,0,0];h[e]=q[0];h[e+1]=q[1];h[e+2]=q[2];h[e+3]=p!==l.transparentIndex?255:0}l.patch=h}return l}console.warn("gif frame does not have associated image.")};u.decompressFrame=k;u.decompressFrames=function(f,
h){return f.frames.filter(function(b){return b.image}).map(function(b){return k(b,f.gct,h)})};return u}();let F,C,O;const aa=[71,73,70];D.isAnimatedGIF=function(m){function g(){k++;d+=8;const h=c.getUint8(d++);d+=h&128?3*2**((h&7)+1):0;d++;a()}function a(){let h;for(;h=c.getUint8(d++);)d+=h}if(!P(m))return!1;const c=new DataView(m);m=c.getUint8(10);let d=13+(m&128?3*2**((m&7)+1):0),k=0;for(m=!1;!m;){switch(c.getUint8(d++)){case 33:a:{switch(c.getUint8(d++)){case 249:d++;d+=4;a();break;case 1:k++;
d++;d+=12;a();break;case 254:a();break;case 255:d++;d+=8;d+=3;a();break;default:var f=!1;break a}f=!0}if(!f)return!1;break;case 44:g();break;case 59:m=!0;break;default:return!1}if(1<k)return!0}return!1};D.isGIF=P;D.parseGif=async function(m,g){g=R.parseGIF(m);m=R.decompressFrames(g,!0);const {width:a,height:c}=g.lsd;g=Y(a,c);const d=[],k=[];let f=0;for(const e of m){var h=S.Milliseconds(e.delay||100);k.push(h);f+=h;h=new ImageData(e.patch,e.dims.width,e.dims.height);var b=Z(h);h=3===e.disposalType?
g.getImageData(e.dims.left,e.dims.top,e.dims.width,e.dims.height):void 0;g.drawImage(b,e.dims.left,e.dims.top);b=g.getImageData(0,0,a,c);d.push(b);1!==e.disposalType&&(2===e.disposalType?g.clearRect(e.dims.left,e.dims.top,e.dims.width,e.dims.height):3===e.disposalType&&g.putImageData(h,e.dims.left,e.dims.top))}return{frameCount:m.length,duration:f,frameDurations:k,getFrame:e=>d[e],width:a,height:c}};Object.defineProperty(D,Symbol.toStringTag,{value:"Module"})});