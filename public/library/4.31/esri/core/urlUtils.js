// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.31/esri/copyright.txt for details.
//>>built
define("exports ../config ./arrayUtils ./Error ./JSONSupport ./Logger ../portal/support/urlUtils ../support/base64Utils".split(" "),function(f,M,ia,ja,N,ka,A,O){function l(a){if(!a)return null;const b={path:null,query:null},c=new m(a),d=a.indexOf("?");null===c.query?b.path=a:(b.path=a.slice(0,d),b.query=I(c.query));c.fragment&&(b.hash=c.fragment,null===c.query&&(b.path=b.path.slice(0,b.path.length-(c.fragment.length+1))));return b}function I(a){var b=a.split("\x26");a={};for(const d of b){if(!d)continue;
var c=d.indexOf("\x3d");0>c?(b=decodeURIComponent(d),c=""):(b=decodeURIComponent(d.slice(0,c)),c=decodeURIComponent(d.slice(c+1)));let e=a[b];"string"===typeof e&&(e=a[b]=[e]);Array.isArray(e)?e.push(c):a[b]=c}return a}function t(a,b){return a?b&&"function"===typeof b?Object.keys(a).map(c=>encodeURIComponent(c)+"\x3d"+encodeURIComponent(b(c,a[c]))).join("\x26"):Object.keys(a).map(c=>{const d=a[c];if(null==d)return"";const e=encodeURIComponent(c)+"\x3d";return(c=b?.[c])?e+encodeURIComponent(c(d)):
Array.isArray(d)?d.map(h=>N.isSerializable(h)?e+encodeURIComponent(JSON.stringify(h)):e+encodeURIComponent(h)).join("\x26"):N.isSerializable(d)?e+encodeURIComponent(JSON.stringify(d)):e+encodeURIComponent(d)}).filter(c=>c).join("\x26"):""}function P(a=!1){let b,c=n.proxyUrl;if("string"===typeof a){if(b=Q(a),a=B(a))c=a.proxyUrl}else b=!!a;if(!c)throw ka.getLogger("esri.core.urlUtils").warn("esri/config: esriConfig.request.proxyUrl is not set."),new ja("urlUtils:proxy-not-set","esri/config: esriConfig.request.proxyUrl is not set.");
b&&C()&&(c=J(c));return l(c)}function K(a){const b=a.indexOf("?");-1!==b?(u.path=a.slice(0,b),u.query=a.slice(b+1)):(u.path=a,u.query=null);return u}function R(a){a=K(a).path;a=S(a);a=D(a,!0);return a=a.toLowerCase()}function B(a){const b=n.proxyRules;a=R(a);for(let c=0;c<b.length;c++)if(0===a.indexOf(b[c].urlPrefix))return b[c]}function p(a){a=v(a);const b=a.indexOf("/sharing");return 0<b?a.slice(0,b):a.replace(/\/+$/,"")}function E(a,b,c=!1){if(!a||!b)return!1;a=L(a);b=L(b);return!c&&a.scheme!==
b.scheme||null==a.host||null==b.host?!1:a.host.toLowerCase()===b.host.toLowerCase()&&a.port===b.port}function F(a,b=w,c){if(k(a))return c?.preserveProtocolRelative?a:"http"===g.scheme&&g.authority===T(a).slice(2)?`http:${a}`:`https:${a}`;if(!G(a)){c=U;if("/"===a[0]){var d=b.indexOf("//");d=b.indexOf("/",d+2);b=-1===d?b:b.slice(0,d)}return c(b,a)}return a}function v(a){a=a.trim();a=F(a);if(/^https?:\/\//i.test(a)){const b=K(a);a=b.path.replaceAll(/\/{2,}/g,"/");a=a.replace("/","//");b.query&&(a+=`?${b.query}`)}a=
a.replace(/^(https?:\/\/)(arcgis\.com)/i,"$1www.$2");return a=la(a)}function U(...a){var b=a.filter(ia.isSome);if(b?.length){a=[];if(q(b[0])){var c=b[0],d=c.indexOf("//");-1!==d&&(a.push(c.slice(0,d+1)),ma(b[0])&&(a[0]+="/"),b[0]=c.slice(d+2))}else"/"===b[0][0]&&a.push("");b=b.reduce((e,h)=>h?e.concat(h.split("/")):e,[]);for(c=0;c<b.length;c++)d=b[c],".."===d&&0<a.length&&".."!==a[a.length-1]?a.pop():(!d&&c===b.length-1||d&&("."!==d||0===a.length))&&a.push(d);return a.join("/")}}function T(a,b=!1){if(null==
a||V(a)||W(a))return null;var c=a.indexOf("://");if(-1===c&&k(a))c=2;else if(-1!==c)c+=3;else return null;c=a.indexOf("/",c);-1!==c&&(a=a.slice(0,c));b&&(a=D(a,!0));return a}function q(a){return k(a)||G(a)}function V(a){return null!=a&&"blob:"===a.slice(0,5)}function W(a){return null!=a&&"data:"===a.slice(0,5)}function X(a){a=x(a);return a?.isBase64?O.base64ToArrayBuffer(a.data):null}function x(a){a=a.match(na);if(!a)return null;const [,b,c,d]=a;return{mediaType:b,isBase64:!!c,data:d}}function Y(a){const b=
X(a);if(!b)return null;a=x(a);return new Blob([b],{type:a.mediaType})}function Z(a,b){if(!a)return!1;const c=document.createElement("a");if(!("download"in c))return!1;a=URL.createObjectURL(a);c.download=b;c.href=a;c.style.display="none";document.body.appendChild(c);c.click();document.body.removeChild(c);URL.revokeObjectURL(a);return!0}function k(a){return null!=a&&"/"===a[0]&&"/"===a[1]}function G(a){return null!=a&&aa.test(a)}function Q(a){return null!=a&&ba.test(a)||"https"===g.scheme&&k(a)}function oa(a){return null!=
a&&ca.test(a)||"http"===g.scheme&&k(a)}function ma(a){return null!=a&&pa.test(a)}function J(a){return k(a)?`https:${a}`:a.replace(ca,"https:")}function C(){return"https"===g.scheme}function D(a,b=!1){if(k(a))return a.slice(2);a=a.replace(aa,"");b&&1<a.length&&"/"===a[0]&&"/"===a[1]&&(a=a.slice(2));return a}function S(a){return a.endsWith("/")?a:`${a}/`}function la(a){const b=n.httpsDomains;if(!oa(a))return a;const c=a.indexOf("/",7);let d;d=-1===c?a:a.slice(0,c);d=d.toLowerCase().slice(7);if(qa.test(d))if(d.endsWith(":80"))d=
d.slice(0,-3),a=a.replace(":80","");else return a;if("http"===g.scheme&&d===g.authority&&!ra.test(a))return a;if(C()&&d===g.authority||b&&b.some(e=>d===e||d.endsWith(`.${e}`))||C()&&!B(a))a=J(a);return a}function L(a){if("string"===typeof a)return new m(F(a));a.scheme||(a.scheme=g.scheme);return a}const n=M.request,aa=/^\s*[a-z][a-z0-9-+.]*:(?![0-9])/i,ca=/^\s*http:/i,ba=/^\s*https:/i,pa=/^\s*file:/i,qa=/:\d+$/,ra=/^https?:\/\/[^/]+\.arcgis.com\/sharing(\/|$)/i,sa=RegExp("^(([^:/?#]+):)?(//([^/?#]*))?([^?#]*)(\\?([^#]*))?(#(.*))?$"),
ta=RegExp("^((([^[:]+):)?([^@]+)@)?(\\[([^\\]]+)\\]|([^[:]*))(:([0-9]+))?$");class m{constructor(a=""){this.uri=a;this.port=this.host=this.password=this.user=this.fragment=this.query=this.path=this.authority=this.scheme=null;a=this.uri.match(sa);this.scheme=a[2]||(a[1]?"":null);this.authority=a[4]||(a[3]?"":null);this.path=a[5];this.query=a[7]||(a[6]?"":null);this.fragment=a[9]||(a[8]?"":null);null!=this.authority&&(a=this.authority.match(ta),this.user=a[3]||null,this.password=a[4]||null,this.host=
a[6]||a[7],this.port=a[9]||null)}toString(){return this.uri}}const y={},da=new m(M.applicationUrl);let g=da;const ea=function(){var a=g.path;a=a.slice(0,a.lastIndexOf("/")+1);return`${`${g.scheme}://${g.host}${null!=g.port?`:${g.port}`:""}`}${a}`}();let w=ea;const u={path:"",query:""},na=/^data:(.*?)(;base64)?,(.*)$/,fa=/([^.]*)\.([^/]*)$/,ua=/(^data:image\/svg|\.svg$)/i;f.Url=m;f.addProxy=function(a,b=!1){const c=B(a);var d=void 0;if(c){var e=K(c.proxyUrl);d=e.path;e=e.query?I(e.query):null}else b&&
(e=P(a),d=e.path,e=e.query);d&&(b=l(a),a=d+"?"+b.path,(d=t({...e,...b.query}))&&(a=`${a}?${d}`));return a};f.addProxyRule=function(a){a={proxyUrl:a.proxyUrl,urlPrefix:R(a.urlPrefix)};const b=n.proxyRules,c=a.urlPrefix;let d=b.length;for(let e=0;e<b.length;e++){const h=b[e].urlPrefix;if(0===c.indexOf(h)){if(c.length===h.length)return-1;d=e;break}0===h.indexOf(c)&&(d=e+1)}b.splice(d,0,a);return d};f.addQueryParameter=function(a,b,c){a=l(a);const d=a.query||{};d[b]=String(c);return`${a.path}?${t(d)}`};
f.addQueryParameters=function(a,b){if(!b)return a;a=l(a);const c=a.query||{};for(const [d,e]of Object.entries(b))null!=e&&(c[d]=e);return(b=t(c))?`${a.path}?${b}`:a.path};f.base64UrlEncode=function(a){return O.arrayBufferToBase64(a).replaceAll("+","-").replaceAll("/","_").replace(/=+$/,"")};f.blobUrlToBlob=async function(a){return(await fetch(a)).blob()};f.changeDomain=function(a,b,c){if(!(b&&c&&a&&q(a)))return a;const d=a.indexOf("//");var e=a.indexOf("/",d+2);const h=a.indexOf(":",d+2);e=Math.min(0>
e?a.length:e,0>h?a.length:h);if(a.slice(d+2,e).toLowerCase()!==b.toLowerCase())return a;b=a.slice(0,d+2);a=a.slice(e);return`${b}${c}${a}`};f.dataComponents=x;f.dataToArrayBuffer=X;f.dataToBlob=Y;f.downloadBlobAsFile=function(a,b){Z(a,b)};f.downloadDataAsFile=function(a,b){(a=Y(a))&&Z(a,b)};f.ensureTrailingSlash=S;f.getAppBaseUrl=()=>w;f.getAppUrl=()=>g;f.getFilename=function(a,b){if(!a)return"";a=l(a).path.replace(/\/+$/,"");a=a.slice(a.lastIndexOf("/")+1);if(!b?.length)return a;b=new RegExp(`\\.(${b.join("|")})$`,
"i");return a.replace(b,"")};f.getInterceptor=function(a,b=n.interceptors){const c=d=>null==d||d instanceof RegExp&&d.test(a)||"string"===typeof d&&a.startsWith(d);if(b)for(const d of b)if(Array.isArray(d.urls)){if(d.urls.some(c))return d}else if(c(d.urls))return d;return null};f.getOrigin=T;f.getPathExtension=function(a){return null==a?null:(a=a.match(fa))?a[2]:null};f.getProxyRule=B;f.getProxyUrl=P;f.hasProtocol=G;f.hasSameCanonicalArcGISOnlinePortal=function(a,b){if(!a||!b)return!1;a=p(a);b=p(b);
a=A.parseKnownArcGISOnlineDomain(a);b=A.parseKnownArcGISOnlineDomain(b);return null!=a&&null!=b?a.portalHostname===b.portalHostname:!1};f.hasSameCanonicalPortal=function(a,b){if(!a||!b)return!1;a=p(a);b=p(b);const c=A.parseKnownArcGISOnlineDomain(a),d=A.parseKnownArcGISOnlineDomain(b);return null!=c&&null!=d?c.portalHostname===d.portalHostname:null!=c||null!=d?!1:E(a,b,!0)};f.hasSameOrigin=E;f.hasSamePortal=function(a,b){a=p(a);b=p(b);return D(a)===D(b)};f.isAbsolute=q;f.isAppHTTPS=C;f.isBlobProtocol=
V;f.isDataProtocol=W;f.isHTTPSProtocol=Q;f.isProtocolRelative=k;f.isSVG=function(a){return ua.test(a)};f.isTrustedServer=function(a){if("string"===typeof a)if(q(a))a=L(a);else return!0;if(E(a,g))return!0;const b=n.trustedServers||[];for(let d=0;d<b.length;d++){var c=b[d];y[c]||(G(c)||k(c)?y[c]=[new m(F(c))]:y[c]=[new m(`http://${c}`),new m(`https://${c}`)]);c=y[c];for(let e=0;e<c.length;e++)if(E(a,c[e]))return!0}return!1};f.join=U;f.makeAbsolute=F;f.makeData=function(a){return a.isBase64?`data:${a.mediaType};base64,${a.data}`:
`data:${a.mediaType},${a.data}`};f.makeRelative=function(a,b=w,c){if(null==a||!q(a))return a;var d=v(a),e=d.toLowerCase();b=v(b).toLowerCase().replace(/\/+$/,"");if((c=c?v(c).toLowerCase().replace(/\/+$/,""):null)&&0!==b.indexOf(c))return a;const h=(ha,va,H)=>{H=ha.indexOf(va,H);return-1===H?ha.length:H};let r=h(e,"/",e.indexOf("//")+2),z=-1;for(;e.slice(0,r+1)===b.slice(0,r)+"/";){z=r+1;if(r===e.length)break;r=h(e,"/",r+1)}if(-1===z||c&&z<c.length)return a;a=d.slice(z);d=b.slice(z-1).replaceAll(/[^/]+/g,
"").length;if(0<d)for(e=0;e<d;e++)a=`../${a}`;else a=`./${a}`;return a};f.normalize=v;f.objectToQuery=t;f.parseData=async function(a){return"string"===typeof a?x(a)??{data:a}:new Promise((b,c)=>{const d=new FileReader;d.readAsDataURL(a);d.onload=()=>b(x(d.result));d.onerror=e=>c(e)})};f.queryToObject=I;f.removeFile=function(a){let b=0;if(q(a)){var c=a.indexOf("//");-1!==c&&(b=c+2)}c=a.lastIndexOf("/");return c<b?a:a.slice(0,c+1)};f.removeQueryParameter=function(a,b){const {path:c,query:d}=l(a);if(!d)return a;
delete d[b];return(a=t(d))?`${c}?${a}`:c};f.removeQueryParameters=function(a,b){a=l(a);const c=Object.keys(a.query||{});0<c.length&&b&&b.warn("removeQueryParameters()",`Url query parameters are not supported, the following parameters have been removed: ${c.join(", ")}.`);return a.path};f.removeTrailingSlash=function(a){return a.replace(/\/+$/,"")};f.splitPathExtension=function(a){if(null==a)return null;const b=a.match(fa);return b?{path:b[1],extension:b[2]}:{path:a,extension:null}};f.test={setAppUrl:a=>
g=a,setAppBaseUrl:a=>w=a,restoreUrls:()=>{g=da;w=ea}};f.toHTTP=function(a){return k(a)?`http:${a}`:a.replace(ba,"http:")};f.toHTTPS=J;f.trustedServersUrlCache=y;f.urlToObject=l;Object.defineProperty(f,Symbol.toStringTag,{value:"Module"})});