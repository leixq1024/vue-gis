// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.31/esri/copyright.txt for details.
//>>built
define("exports ./nextTick ./PerformanceSampler ./PooledArray ./promiseUtils ./time".split(" "),function(b,x,y,z,n,d){function A(a){a=new K(a);r.push(a);k.willDispatch||(k.willDispatch=!0,x.nextTick(B));return a}function C(a){a=new L(a);f.push(a);null==g&&(t=performance.now(),g=requestAnimationFrame(u));return new D(a)}function u(){const a=performance.now();g=null;g=0<f.length?requestAnimationFrame(u):null;k.executeFrameTasks(a)}function E(){f.forAll(a=>{a.removed&&p.push(a)});f.removeUnorderedMany(p.data,
p.length);p.clear()}function B(){for(;r.length;){const a=r.shift();a.isActive&&a.callback()}k.willDispatch=!1}function F(a=1,c){const e=n.createResolver(),q=()=>{n.isAborted(c)?e.reject(n.createAbortError()):0===a?e():(--a,x.nextTick(()=>q()))};q();return e.promise}function G(a){return F(1,a)}class L{constructor(a){this.phases=a;this.paused=!1;this.ticks=-1;this.removed=!1}}class K{constructor(a){this.callback=a;this.isActive=!0}remove(){this.isActive=!1}}let t=0,v=0;const l={time:d.Milliseconds(0),
deltaTime:d.Milliseconds(0),elapsedFrameTime:d.Milliseconds(0),frameDuration:d.Milliseconds(0)},w="prepare preRender render postRender update finish".split(" "),r=[],f=new z;class D{constructor(a){this._task=a}remove(){this._task.removed=!0}pause(){this._task.paused=!0}resume(){this._task.paused=!1}}const k={frameTasks:f,willDispatch:!1,clearFrameTasks:function(a=!1){f.forAll(c=>{c.removed=!0});a&&E()},dispatch:B,executeFrameTasks:function(a){const c=d.Milliseconds(a-t);t=a;var e=0<v?v:1E3/60;const q=
Math.max(0,c-e);l.time=a;l.frameDuration=d.Milliseconds(e-q);for(let m=0;m<w.length;m++){e=performance.now();const H=w[m];f.forAll(h=>{h.paused||h.removed||(0===m&&h.ticks++,h.phases[H]&&(l.elapsedFrameTime=d.Milliseconds(performance.now()-a),l.deltaTime=0===h.ticks?d.Milliseconds(0):c,h.phases[H]?.call(h,l)))});I[m].push(performance.now()-e)}E();J.push(performance.now()-a)},reschedule:function(){null!=g&&(cancelAnimationFrame(g),g=requestAnimationFrame(u))}};let g=null;const p=new z,I=w.map(a=>new y(a)),
J=new y("total");b.FrameTaskHandle=D;b.addFrameTask=C;b.debug=k;b.performanceInfo=I;b.performanceTotal=J;b.schedule=A;b.setFrameDuration=function(a){v=Math.max(0,a)};b.waitAnimationFrame=async function(a){await G(a);await new Promise(c=>requestAnimationFrame(()=>{a?.aborted||c()}))};b.waitRender=function(){const a=n.createResolver(),c=C({postRender:()=>{c.remove();A(a)}});return a.promise};b.waitTick=G;b.waitTicks=F;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})});