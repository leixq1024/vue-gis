// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.31/esri/copyright.txt for details.
//>>built
define("exports ./arcadeEnvironment ./ArcadeModule ./ArcadeModuleLoader ./containerUtils ./Dictionary ./executionError ./Feature ./FunctionWrapper ../chunks/languageUtils ./treeAnalysis ../chunks/array ./functions/date ./functions/geomasync ./functions/geometry ./functions/maths ./functions/stats ./functions/string ../geometry/Geometry ../geometry/SpatialReference".split(" "),function(C,t,D,P,E,y,f,Q,v,e,aa,ba,ca,da,ea,fa,ha,ia,R,S){async function F(a,b){const c=[];for(let d=0;d<b.arguments.length;d++)c.push(await l(a,
b.arguments[d]));return c}async function w(a,b,c){if(!0===b.preparsed)return c(a,null,b.arguments);const d=await F(a,b);return c(a,b,d)}async function A(a,b,c){if(!0===b.preparsed)return c(a,null,b.arguments);const d=await F(a,b);return c(a,b,d)}async function l(a,b){b.breakpoint&&await b.breakpoint();try{switch(b.type){case "UpdateExpression":return await ja(a,b);case "AssignmentExpression":return await ka(a,b);case "TemplateLiteral":return await la(a,b);case "Identifier":return await G(a,b);case "MemberExpression":return await ma(a,
b);case "Literal":return b.value;case "CallExpression":return await na(a,b);case "UnaryExpression":return await oa(a,b);case "BinaryExpression":return await pa(a,b);case "LogicalExpression":return await qa(a,b);case "ArrayExpression":return await ra(a,b);case "ObjectExpression":return await sa(a,b);default:throw new f.ArcadeExecutionError(a,f.ExecutionErrorCodes.Unrecognized,b);}}catch(c){throw f.ensureArcadeExecutionError(a,b,c);}}async function u(a,b){b.breakpoint&&await b.breakpoint();try{switch(b.type){case "ImportDeclaration":return await ta(a,
b);case "ExportNamedDeclaration":return await ua(a,b);case "VariableDeclaration":return await T(a,b,0);case "BlockStatement":return await H(a,b);case "FunctionDeclaration":return await va(a,b);case "ReturnStatement":return await wa(a,b);case "IfStatement":return await xa(a,b);case "ExpressionStatement":return await ya(a,b);case "ForStatement":return await za(a,b);case "WhileStatement":return await Aa(a,b);case "ForInStatement":return await Ba(a,b);case "BreakStatement":return e.breakResult;case "EmptyStatement":return e.voidOperation;
case "ContinueStatement":return e.continueResult;default:throw new f.ArcadeExecutionError(a,f.ExecutionErrorCodes.Unrecognized,b);}}catch(c){throw f.ensureArcadeExecutionError(a,b,c);}}async function sa(a,b){const c=[];for(var d=0;d<b.properties.length;d++){var g=b.properties[d],h=await l(a,g.value);g="Identifier"===g.key.type?g.key.name:await l(a,g.key);c[d]={key:g,value:h}}d={};h=new Map;for(g=0;g<c.length;g++){const k=c[g];if(e.isFunctionParameter(k.value))throw new f.ArcadeExecutionError(a,f.ExecutionErrorCodes.NoFunctionInDictionary,
b);if(!1===e.isString(k.key))throw new f.ArcadeExecutionError(a,f.ExecutionErrorCodes.KeyMustBeString,b);let m=k.key.toString();const n=m.toLowerCase();h.has(n)?m=h.get(n):h.set(n,m);d[m]=k.value===e.voidOperation?null:k.value}a=new y(d);a.immutable=!1;return a}async function Aa(a,b){var c=!0,d=e.voidOperation;c=await l(a,b.test);if(!1===c)return e.voidOperation;if(!0!==c)throw new f.ArcadeExecutionError(a,f.ExecutionErrorCodes.BooleanConditionRequired,b);for(;!0===c;){d=await u(a,b.body);if(d===
e.breakResult)break;if(d instanceof e.ReturnResult)break;c=await l(a,b.test);if(!0!==c&&!1!==c)throw new f.ArcadeExecutionError(a,f.ExecutionErrorCodes.BooleanConditionRequired,b);}return d instanceof e.ReturnResult?d:e.voidOperation}async function Ca(a,b,c){const d=await u(a,b.body);c.lastAction=d;if(c.lastAction===e.breakResult||c.lastAction instanceof e.ReturnResult)return c.testResult=!1,c;null!==b.update&&await l(a,b.update);return c}async function Da(a,b,c){if(null!==b.test){const d=await l(a,
b.test);if(!0===a.abortSignal?.aborted)throw new f.ArcadeExecutionError(a,f.ExecutionErrorCodes.Cancelled,b);c.testResult=d;if(!1===c.testResult)return c;if(!0!==c.testResult)throw new f.ArcadeExecutionError(a,f.ExecutionErrorCodes.BooleanConditionRequired,b);}return Ca(a,b,c)}function I(a,b,c,d,g,h){try{Da(a,b,c).then(()=>{try{!0===c.testResult?(h++,100<h?(h=0,setTimeout(()=>{I(a,b,c,d,g,h)},0)):I(a,b,c,d,g,h)):c.lastAction instanceof e.ReturnResult?d(c.lastAction):d(e.voidOperation)}catch(k){g(k)}},
k=>{g(k)})}catch(k){g(k)}}async function za(a,b){try{return null!==b.init&&("VariableDeclaration"===b.init.type?await u(a,b.init):await l(a,b.init)),await new Promise((c,d)=>{I(a,b,{testResult:!0,lastAction:e.voidOperation},g=>{c(g)},g=>{d(g)},0)})}catch(c){throw c;}}function J(a,b,c,d,g,h,k,m,n,p){try{d<=h?m(e.voidOperation):(g.value="k"===k?c[h]:h,u(a,b.body).then(r=>{try{r instanceof e.ReturnResult?m(r):r===e.breakResult?m(e.voidOperation):(p++,100<p?(p=0,setTimeout(()=>{J(a,b,c,d,g,h+1,k,m,n,
p)},0)):J(a,b,c,d,g,h+1,k,m,n,p))}catch(K){n(K)}},r=>{n(r)}))}catch(r){n(r)}}function L(a,b,c,d,g,h,k,m,n){try{c.length()<=g?k(e.voidOperation):(d.value="k"===h?c.get(g):g,u(a,b.body).then(p=>{p instanceof e.ReturnResult?k(p):p===e.breakResult?k(e.voidOperation):(n++,100<n?(n=0,setTimeout(()=>{L(a,b,c,d,g+1,h,k,m,n)},0)):L(a,b,c,d,g+1,h,k,m,n))},p=>{m(p)}))}catch(p){m(p)}}function M(a,b,c,d,g,h){try{void 0===h&&(h="i"),0===c.length?d.resolve(e.voidOperation):J(a,b,c,c.length,g,0,h,k=>{d.resolve(k)},
k=>{d.reject(k)},0)}catch(k){d.reject(k)}}function Ea(a,b,c,d,g,h){try{void 0===h&&(h="i"),0===c.length()?d.resolve(e.voidOperation):L(a,b,c,g,0,h,k=>{d.resolve(k)},k=>{d.reject(k)},0)}catch(k){d.reject(k)}}function Fa(a,b,c,d,g){try{const h=c.keys();M(a,b,h,d,g,"k")}catch(h){d.reject(h)}}function N(a,b,c,d,g,h,k,m){try{a.next().then(n=>{try{if(null===n)h(e.voidOperation);else{const p=Q.createFromGraphicLikeObject(n.geometry,n.attributes,d,b.timeZone);p._underlyingGraphic=n;g.value=p;u(b,c.body).then(r=>
{try{r===e.breakResult?h(e.voidOperation):r instanceof e.ReturnResult?h(r):(m++,100<m?(m=0,setTimeout(()=>{N(a,b,c,d,g,h,k,m)},0)):N(a,b,c,d,g,h,k,m))}catch(K){k(K)}},r=>{k(r)})}}catch(p){k(p)}},n=>{k(n)})}catch(n){k(n)}}async function Ba(a,b){return new Promise((c,d)=>{l(a,b.right).then(g=>{try{("VariableDeclaration"===b.left.type?u(a,b.left):Promise.resolve()).then(()=>{try{const h=t.toSymbolId("VariableDeclaration"===b.left.type?b.left.declarations[0].id:b.left);let k=null;null!=a.localScope&&
void 0!==a.localScope[h]&&(k=a.localScope[h]);null===k&&void 0!==a.globalScope[h]&&(k=a.globalScope[h]);null===k?d(new f.ArcadeExecutionError(a,f.ExecutionErrorCodes.InvalidIdentifier,b)):e.isArray(g)||e.isString(g)?M(a,b,g,{reject:d,resolve:c},k):e.isImmutableArray(g)?Ea(a,b,g,{reject:d,resolve:c},k):g instanceof y||e.isFeature(g)?Fa(a,b,g,{reject:d,resolve:c},k):e.isFeatureSet(g)?N(g.iterator(a.abortSignal),a,b,g,k,m=>{c(m)},m=>{d(m)},0):M(a,b,[],{reject:d,resolve:c},k)}catch(h){d(h)}},d)}catch(h){d(h)}},
d)})}async function ja(a,b){var c=b.argument;if("CallExpression"===c.type)throw new f.ArcadeExecutionError(a,f.ExecutionErrorCodes.NeverReach,b);if("MemberExpression"===c.type){var d=await l(a,c.object);if(!0===c.computed)c=await l(a,c.property);else if("Identifier"===c.property.type)c=c.property.name;else throw new f.ArcadeExecutionError(a,f.ExecutionErrorCodes.Unrecognized,b);if(e.isArray(d))if(e.isNumber(c)){0>c&&(c=d.length+c);if(0>c||c>=d.length)throw new f.ArcadeExecutionError(a,f.ExecutionErrorCodes.OutOfBounds,
b);a=e.toNumber(d[c]);d[c]="++"===b.operator?a+1:a-1}else throw new f.ArcadeExecutionError(a,f.ExecutionErrorCodes.ArrayAccessorMustBeNumber,b);else if(d instanceof y){if(!1===e.isString(c))throw new f.ArcadeExecutionError(a,f.ExecutionErrorCodes.KeyAccessorMustBeString,b);if(!0===d.hasField(c))a=e.toNumber(d.field(c)),d.setField(c,"++"===b.operator?a+1:a-1);else throw new f.ArcadeExecutionError(a,f.ExecutionErrorCodes.FieldNotFound,b,{key:c});}else if(d instanceof z){if(!1===e.isString(c))throw new f.ArcadeExecutionError(a,
f.ExecutionErrorCodes.ModuleAccessorMustBeString,b);if(!0===d.hasGlobal(c))a=e.toNumber(await d.global(c)),d.setGlobal(c,"++"===b.operator?a+1:a-1);else throw new f.ArcadeExecutionError(a,f.ExecutionErrorCodes.ModuleExportNotFound,b);}else if(e.isFeature(d)){if(!1===e.isString(c))throw new f.ArcadeExecutionError(a,f.ExecutionErrorCodes.KeyAccessorMustBeString,b);if(!0===d.hasField(c))a=e.toNumber(d.field(c)),d.setField(c,"++"===b.operator?a+1:a-1);else throw new f.ArcadeExecutionError(a,f.ExecutionErrorCodes.FieldNotFound,
b,{key:c});}else{if(e.isImmutableArray(d))throw new f.ArcadeExecutionError(a,f.ExecutionErrorCodes.Immutable,b);throw new f.ArcadeExecutionError(a,f.ExecutionErrorCodes.InvalidParameter,b);}return!1===b.prefix?a:"++"===b.operator?a+1:a-1}d=t.toSymbolId(c);if(null!=a.localScope&&void 0!==a.localScope[d])return c=e.toNumber(a.localScope[d].value),a.localScope[d]={value:"++"===b.operator?c+1:c-1,valueset:!0,node:b},!1===b.prefix?c:"++"===b.operator?c+1:c-1;if(void 0!==a.globalScope[d])return c=e.toNumber(a.globalScope[d].value),
a.globalScope[d]={value:"++"===b.operator?c+1:c-1,valueset:!0,node:b},!1===b.prefix?c:"++"===b.operator?c+1:c-1;throw new f.ArcadeExecutionError(a,f.ExecutionErrorCodes.InvalidIdentifier,b);}function x(a,b,c,d,g){switch(b){case "\x3d":return a===e.voidOperation?null:a;case "/\x3d":return e.toNumber(c)/e.toNumber(a);case "*\x3d":return e.toNumber(c)*e.toNumber(a);case "-\x3d":return e.toNumber(c)-e.toNumber(a);case "+\x3d":return e.isString(c)||e.isString(a)?e.toString(c)+e.toString(a):e.toNumber(c)+
e.toNumber(a);case "%\x3d":return e.toNumber(c)%e.toNumber(a);default:throw new f.ArcadeExecutionError(g,f.ExecutionErrorCodes.UnsupportedOperator,d);}}async function ka(a,b){var c=b.left;if("MemberExpression"===c.type){var d=await l(a,c.object);if(!0===c.computed)c=await l(a,c.property);else if("Identifier"===c.property.type)c=c.property.name;else throw new f.ArcadeExecutionError(a,f.ExecutionErrorCodes.InvalidIdentifier,b);const g=await l(a,b.right);if(e.isArray(d))if(e.isNumber(c)){0>c&&(c=d.length+
c);if(0>c||c>d.length)throw new f.ArcadeExecutionError(a,f.ExecutionErrorCodes.OutOfBounds,b);if(c===d.length&&"\x3d"!==b.operator)throw new f.ArcadeExecutionError(a,f.ExecutionErrorCodes.OutOfBounds,b);d[c]=x(g,b.operator,d[c],b,a)}else throw new f.ArcadeExecutionError(a,f.ExecutionErrorCodes.ArrayAccessorMustBeNumber,b);else if(d instanceof y){if(!1===e.isString(c))throw new f.ArcadeExecutionError(a,f.ExecutionErrorCodes.KeyAccessorMustBeString,b);if(!0===d.hasField(c))d.setField(c,x(g,b.operator,
d.field(c),b,a));else{if("\x3d"!==b.operator)throw new f.ArcadeExecutionError(a,f.ExecutionErrorCodes.FieldNotFound,b,{key:c});d.setField(c,x(g,b.operator,null,b,a))}}else if(d instanceof z){if(!1===e.isString(c))throw new f.ArcadeExecutionError(a,f.ExecutionErrorCodes.KeyAccessorMustBeString,b);if(!0===d.hasGlobal(c))d.setGlobal(c,x(g,b.operator,await d.global(c),b,a));else throw new f.ArcadeExecutionError(a,f.ExecutionErrorCodes.ModuleExportNotFound,b);}else if(e.isFeature(d)){if(!1===e.isString(c))throw new f.ArcadeExecutionError(a,
f.ExecutionErrorCodes.KeyAccessorMustBeString,b);if(!0===d.hasField(c))d.setField(c,x(g,b.operator,d.field(c),b,a));else{if("\x3d"!==b.operator)throw new f.ArcadeExecutionError(a,f.ExecutionErrorCodes.FieldNotFound,b,{key:c});d.setField(c,x(g,b.operator,null,b,a))}}else{if(e.isImmutableArray(d))throw new f.ArcadeExecutionError(a,f.ExecutionErrorCodes.Immutable,b);throw new f.ArcadeExecutionError(a,f.ExecutionErrorCodes.InvalidParameter,b);}return e.voidOperation}d=t.toSymbolId(c);if(null!=a.localScope&&
void 0!==a.localScope[d])return c=await l(a,b.right),a.localScope[d]={value:x(c,b.operator,a.localScope[d].value,b,a),valueset:!0,node:b.right},e.voidOperation;if(void 0!==a.globalScope[d])return c=await l(a,b.right),a.globalScope[d]={value:x(c,b.operator,a.globalScope[d].value,b,a),valueset:!0,node:b.right},e.voidOperation;throw new f.ArcadeExecutionError(a,f.ExecutionErrorCodes.InvalidIdentifier,b);}async function ya(a,b){a=await l(a,b.expression);return a===e.voidOperation?e.voidOperation:new e.ImplicitResult(a)}
async function xa(a,b){const c=await l(a,b.test);if(!0===c)return u(a,b.consequent);if(!1===c)return null!==b.alternate?u(a,b.alternate):e.voidOperation;throw new f.ArcadeExecutionError(a,f.ExecutionErrorCodes.BooleanConditionRequired,b);}async function H(a,b){return U(a,b,0)}async function U(a,b,c){if(c>=b.body.length)return e.voidOperation;const d=await u(a,b.body[c]);return d instanceof e.ReturnResult||d===e.breakResult||d===e.continueResult||c===b.body.length-1?d:U(a,b,c+1)}async function wa(a,
b){if(null===b.argument)return new e.ReturnResult(e.voidOperation);a=await l(a,b.argument);return new e.ReturnResult(a)}async function va(a,b){const c=t.toSymbolId(b.id);a.globalScope[c]={valueset:!0,node:null,value:new Ga(b,a)};return e.voidOperation}async function ta(a,b){const c=t.toSymbolId(b.specifiers[0].local),d=a.libraryResolver.loadLibrary(c);let g;a.libraryResolver._moduleSingletons?.has(d.uri)?g=a.libraryResolver._moduleSingletons.get(d.uri):(g=new z(d),await g.loadModule(a),a.libraryResolver._moduleSingletons?.set(d.uri,
g));a.globalScope[c]={value:g,valueset:!0,node:b};return e.voidOperation}async function ua(a,b){await u(a,b.declaration);if("FunctionDeclaration"===b.declaration.type)a.exports[t.toSymbolId(b.declaration.id)]="function";else if("VariableDeclaration"===b.declaration.type)for(const c of b.declaration.declarations)a.exports[t.toSymbolId(c.id)]="variable";return e.voidOperation}async function T(a,b,c){if(c>=b.declarations.length)return e.voidOperation;await Ha(a,b.declarations[c]);if(c===b.declarations.length-
1)return e.voidOperation;await T(a,b,c+1);return e.voidOperation}async function Ha(a,b){let c=null;c=null===b.init?null:await l(a,b.init);if(null!==a.localScope){c===e.voidOperation&&(c=null);if("Identifier"!==b.id.type)throw new f.ArcadeExecutionError(a,f.ExecutionErrorCodes.InvalidIdentifier,b);var d=t.toSymbolId(b.id);null!=a.localScope&&(a.localScope[d]={value:c,valueset:!0,node:b.init})}else{if("Identifier"!==b.id.type)throw new f.ArcadeExecutionError(a,f.ExecutionErrorCodes.InvalidIdentifier,
b);d=t.toSymbolId(b.id);c===e.voidOperation&&(c=null);a.globalScope[d]={value:c,valueset:!0,node:b.init}}}async function ma(a,b){const c=await l(a,b.object);if(null===c)throw new f.ArcadeExecutionError(a,f.ExecutionErrorCodes.MemberOfNull,b);if(!1===b.computed){if("Identifier"===b.property.type){if(c instanceof y||e.isFeature(c))return c.field(b.property.name);if(c instanceof R)return E.geometryMember(c,b.property.name,a,b);if(c instanceof z){if(!c.hasGlobal(b.property.name))throw new f.ArcadeExecutionError(a,
f.ExecutionErrorCodes.InvalidIdentifier,b);return c.global(b.property.name)}}throw new f.ArcadeExecutionError(a,f.ExecutionErrorCodes.InvalidMemberAccessKey,b);}let d=await l(a,b.property);if(c instanceof y||e.isFeature(c)){if(e.isString(d))return c.field(d)}else if(c instanceof z){if(e.isString(d))return c.global(d)}else if(c instanceof R){if(e.isString(d))return E.geometryMember(c,d,a,b)}else if(e.isArray(c)){if(e.isNumber(d)&&isFinite(d)&&Math.floor(d)===d){0>d&&(d=c.length+d);if(d>=c.length||
0>d)throw new f.ArcadeExecutionError(a,f.ExecutionErrorCodes.OutOfBounds,b);return c[d]}}else if(e.isImmutableArray(c)){if(e.isNumber(d)&&isFinite(d)&&Math.floor(d)===d){0>d&&(d=c.length()+d);if(d>=c.length()||0>d)throw new f.ArcadeExecutionError(a,f.ExecutionErrorCodes.OutOfBounds,b);return c.get(d)}}else if(e.isString(c)&&e.isNumber(d)&&isFinite(d)&&Math.floor(d)===d){0>d&&(d=c.length+d);if(d>=c.length||0>d)throw new f.ArcadeExecutionError(a,f.ExecutionErrorCodes.OutOfBounds,b);return c[d]}throw new f.ArcadeExecutionError(a,
f.ExecutionErrorCodes.InvalidMemberAccessKey,b);}async function oa(a,b){const c=await l(a,b.argument);if(e.isBoolean(c)&&"!"===b.operator)return!c;if("-"===b.operator)return-1*e.toNumber(c);if("+"===b.operator)return 1*e.toNumber(c);if("~"===b.operator)return~e.toNumber(c);throw new f.ArcadeExecutionError(a,f.ExecutionErrorCodes.UnsupportedUnaryOperator,b);}async function ra(a,b){const c=[];for(var d=0;d<b.elements.length;d++)c.push(await l(a,b.elements[d]));for(d=0;d<c.length;d++){if(e.isFunctionParameter(c[d]))throw new f.ArcadeExecutionError(a,
f.ExecutionErrorCodes.NoFunctionInArray,b);c[d]===e.voidOperation&&(c[d]=null)}return c}async function pa(a,b){const c=await l(a,b.left),d=await l(a,b.right);switch(b.operator){case "|":case "\x3c\x3c":case "\x3e\x3e":case "\x3e\x3e\x3e":case "^":case "\x26":return e.binaryOperator(e.toNumber(c),e.toNumber(d),b.operator);case "\x3d\x3d":return e.equalityTest(c,d);case "!\x3d":return!e.equalityTest(c,d);case "\x3c":return e.greaterThanLessThan(c,d,b.operator);case "\x3e":return e.greaterThanLessThan(c,
d,b.operator);case "\x3c\x3d":return e.greaterThanLessThan(c,d,b.operator);case "\x3e\x3d":return e.greaterThanLessThan(c,d,b.operator);case "+":return e.isString(c)||e.isString(d)?e.toString(c)+e.toString(d):e.toNumber(c)+e.toNumber(d);case "-":return e.toNumber(c)-e.toNumber(d);case "*":return e.toNumber(c)*e.toNumber(d);case "/":return e.toNumber(c)/e.toNumber(d);case "%":return e.toNumber(c)%e.toNumber(d);default:throw new f.ArcadeExecutionError(a,f.ExecutionErrorCodes.UnsupportedOperator,b);
}}async function qa(a,b){var c=await l(a,b.left);if(e.isBoolean(c))switch(b.operator){case "||":if(!0===c)return c;c=await l(a,b.right);if(e.isBoolean(c))return c;throw new f.ArcadeExecutionError(a,f.ExecutionErrorCodes.LogicExpressionOrAnd,b);case "\x26\x26":if(!1===c)return c;c=await l(a,b.right);if(e.isBoolean(c))return c;throw new f.ArcadeExecutionError(a,f.ExecutionErrorCodes.LogicExpressionOrAnd,b);default:throw new f.ArcadeExecutionError(a,f.ExecutionErrorCodes.LogicExpressionOrAnd,b);}else throw new f.ArcadeExecutionError(a,
f.ExecutionErrorCodes.LogicalExpressionOnlyBoolean,b);}async function G(a,b){const c=t.toSymbolId(b);if(null!=a.localScope&&void 0!==a.localScope[c]){b=a.localScope[c];if(!0===b.valueset)return b.value;if(null!==b.d)return b.d;b.d=l(a,b.node);a=await b.d;b.value=a;b.valueset=!0;return a}if(void 0!==a.globalScope[c]){b=a.globalScope[c];if(!0===b.valueset)return b.value;if(null!==b.d)return b.d;b.d=l(a,b.node);a=await b.d;b.value=a;b.valueset=!0;return a}throw new f.ArcadeExecutionError(a,f.ExecutionErrorCodes.InvalidIdentifier,
b);}async function na(a,b){if("MemberExpression"===b.callee.type){var c=await l(a,b.callee.object);if(!(c instanceof z))throw new f.ArcadeExecutionError(a,f.ExecutionErrorCodes.FunctionNotFound,b);const d=!1===b.callee.computed?b.callee.property.name:await l(a,b.callee.property);if(!c.hasGlobal(d))throw new f.ArcadeExecutionError(a,f.ExecutionErrorCodes.FunctionNotFound,b);c=await c.global(d);if(!e.isFunctionParameter(c))throw new f.ArcadeExecutionError(a,f.ExecutionErrorCodes.CallNonFunction,b);
return c.call(a,b)}if("Identifier"!==b.callee.type)throw new f.ArcadeExecutionError(a,f.ExecutionErrorCodes.FunctionNotFound,b);c=t.toSymbolId(b.callee);if(null!=a.localScope&&void 0!==a.localScope[c]){c=a.localScope[c];if(e.isFunctionParameter(c.value))return c.value.call(a,b);throw new f.ArcadeExecutionError(a,f.ExecutionErrorCodes.CallNonFunction,b);}if(void 0!==a.globalScope[c]){c=a.globalScope[c];if(e.isFunctionParameter(c.value))return c.value.call(a,b);throw new f.ArcadeExecutionError(a,f.ExecutionErrorCodes.CallNonFunction,
b);}throw new f.ArcadeExecutionError(a,f.ExecutionErrorCodes.FunctionNotFound,b);}async function la(a,b){let c="",d=0;for(const g of b.quasis)if(c+=g.value?g.value.cooked:"",!1===g.tail){if(b.expressions[d]){const h=await l(a,b.expressions[d]);if(e.isFunctionParameter(h))throw new f.ArcadeExecutionError(a,f.ExecutionErrorCodes.NoFunctionInTemplateLiteral,b);c+=e.toString(h)}d++}return c}async function V(a,b,c,d){var g=await l(a,b.arguments[c]);if(e.equalityTest(g,d))return l(a,b.arguments[c+1]);g=
b.arguments.length-c;return 1===g?l(a,b.arguments[c]):2===g?null:3===g?l(a,b.arguments[c+2]):V(a,b,c+2,d)}async function W(a,b,c,d){if(!0===d)return l(a,b.arguments[c+1]);if(3===b.arguments.length-c)return l(a,b.arguments[c+2]);d=await l(a,b.arguments[c+2]);if(!1===e.isBoolean(d))throw new f.ArcadeExecutionError(a,f.ExecutionErrorCodes.ModuleExportNotFound,b.arguments[c+2]);return W(a,b,c+2,d)}async function O(a,b,c,d){const g=a.body;if(c.length!==a.params.length)throw new f.ArcadeExecutionError(b,
f.ExecutionErrorCodes.WrongNumberOfParameters,null);for(let h=0;h<c.length;h++){const k=a.params[h];"Identifier"===k.type&&null!=b.localScope&&(b.localScope[t.toSymbolId(k)]={d:null,value:c[h],valueset:!0,node:null})}a=await u(b,g);if(a instanceof e.ReturnResult)return a.value;if(a===e.breakResult)throw new f.ArcadeExecutionError(b,f.ExecutionErrorCodes.UnexpectedToken,d);if(a===e.continueResult)throw new f.ArcadeExecutionError(b,f.ExecutionErrorCodes.UnexpectedToken,d);return a instanceof e.ImplicitResult?
a.value:a}function X(a,b,c){const d=new B;if(void 0===a||null===a)a={};if(void 0===b||null===b)b={};const g=new y({newline:"\n",tab:"\t",singlequote:"'",doublequote:'"',forwardslash:"/",backwardslash:"\\"});g.immutable=!1;d.textformatting={value:g,valueset:!0,node:null};for(const h in b)d[h]={value:new v.NativeFunction(b[h]),native:!0,valueset:!0,node:null};for(const h in a)d[h]={value:e.isGraphic(a[h])?Q.createFromGraphic(a[h],c):a[h],valueset:!0,node:null};return d}function Y(a){console.log(a)}
function Z(a){const b={mode:"async",compiled:!1,functions:{},signatures:[],standardFunction:w,standardFunctionAsync:A,evaluateIdentifier:G};for(let c=0;c<a.length;c++)a[c].registerFunctions(b);for(const c in b.functions)q[c]={value:new v.NativeFunction(b.functions[c]),valueset:!0,node:null},B.prototype[c]=q[c];for(a=0;a<b.signatures.length;a++)aa.addFunctionDeclaration(b.signatures[a],"async")}class Ga extends v.ArcadeFunction{constructor(a,b){super();this.context=this.definition=null;this.definition=
a;this.context=b}createFunction(a){return(...b)=>{const c={spatialReference:this.context.spatialReference,console:this.context.console,lrucache:this.context.lrucache,timeZone:this.context.timeZone??null,exports:this.context.exports,libraryResolver:this.context.libraryResolver,interceptor:this.context.interceptor,localScope:{},depthCounter:{depth:a.depthCounter+1},globalScope:this.context.globalScope};if(64<c.depthCounter.depth)throw new f.ArcadeExecutionError(a,f.ExecutionErrorCodes.MaximumCallDepth,
null);return O(this.definition,c,b,null)}}call(a,b){return A(a,b,(c,d,g)=>{c={spatialReference:a.spatialReference,services:a.services,console:a.console,libraryResolver:a.libraryResolver,exports:a.exports,lrucache:a.lrucache,timeZone:a.timeZone??null,interceptor:a.interceptor,localScope:{},abortSignal:a.abortSignal,globalScope:a.globalScope,depthCounter:{depth:a.depthCounter.depth+1}};if(64<c.depthCounter.depth)throw new f.ArcadeExecutionError(a,f.ExecutionErrorCodes.MaximumCallDepth,b);return O(this.definition,
c,g,b)})}marshalledCall(a,b,c,d){return d(a,b,async(g,h,k)=>{g={spatialReference:a.spatialReference,globalScope:c.globalScope,depthCounter:{depth:a.depthCounter.depth+1},libraryResolver:a.libraryResolver,exports:a.exports,console:a.console,abortSignal:a.abortSignal,lrucache:a.lrucache,timeZone:a.timeZone??null,interceptor:a.interceptor,localScope:{}};k=k.map(m=>!e.isFunctionParameter(m)||m instanceof v.ScopeMarshalledFunction?m:v.wrapModuleScopedResponse(m,a,d));return v.wrapModuleScopedResponse(await O(this.definition,
g,k,b),c,d)})}}class z extends D.ArcadeModule{constructor(a){super();this.source=a}async global(a){a=this.executingContext.globalScope[a.toLowerCase()];a.valueset||(a.value=await l(this.executingContext,a.node),a.valueset=!0);if(e.isFunctionParameter(a.value)&&!(a.value instanceof v.ScopeMarshalledFunction)){const b=new v.ScopeMarshalledFunction;b.fn=a.value;b.parameterEvaluator=A;b.context=this.executingContext;a.value=b}return a.value}setGlobal(a,b){if(e.isFunctionParameter(b))throw new f.ArcadeExecutionError(null,
f.ExecutionErrorCodes.AssignModuleFunction,null);this.executingContext.globalScope[a.toLowerCase()]={value:b,valueset:!0,node:null}}hasGlobal(a){void 0===this.executingContext.exports[a]&&(a=a.toLowerCase());return void 0!==this.executingContext.exports[a]?!0:!1}async loadModule(a){let b=a.spatialReference;if(null===b||void 0===b)b=new S({wkid:102100});this.moduleScope=X({},a.customfunctions,a.timeZone);this.executingContext={spatialReference:b,services:a.services,libraryResolver:new P.ArcadeModuleLoader(a.libraryResolver._moduleSingletons,
this.source.syntax.loadedModules),exports:{},abortSignal:void 0===a.abortSignal||null===a.abortSignal?{aborted:!1}:a.abortSignal,globalScope:this.moduleScope,console:a.console??Y,lrucache:a.lrucache,timeZone:a.timeZone??null,interceptor:a.interceptor,localScope:null,depthCounter:{depth:1}};await H(this.executingContext,this.source.syntax)}}const q={};ca.registerFunctions(q,w);ia.registerFunctions(q,w);fa.registerFunctions(q,w);ea.registerFunctions(q,w);ha.registerFunctions(q,w);da.registerFunctions({functions:q,
compiled:!1,signatures:null,evaluateIdentifier:null,mode:"async",standardFunction:w,standardFunctionAsync:A});q.iif=async function(a,b){e.pcCheck(null===b.arguments?[]:b.arguments,3,3,a,b);const c=await l(a,b.arguments[0]);if(!1===e.isBoolean(c))throw new f.ArcadeExecutionError(a,f.ExecutionErrorCodes.BooleanConditionRequired,b);return c?l(a,b.arguments[1]):l(a,b.arguments[2])};q.defaultvalue=async function(a,b){e.pcCheck(null===b.arguments?[]:b.arguments,2,3,a,b);var c=await l(a,b.arguments[0]);
if(3===b.arguments.length){const d=await l(a,b.arguments[1]);c=E.getNestedOptionalValue(c,d);return null!=c&&""!==c?c:l(a,b.arguments[2])}return null==c||""===c?l(a,b.arguments[1]):c};q.decode=async function(a,b){if(2>b.arguments.length)throw new f.ArcadeExecutionError(a,f.ExecutionErrorCodes.WrongNumberOfParameters,b);if(2===b.arguments.length)return l(a,b.arguments[1]);if(0===(b.arguments.length-1)%2)throw new f.ArcadeExecutionError(a,f.ExecutionErrorCodes.WrongNumberOfParameters,b);const c=await l(a,
b.arguments[0]);return V(a,b,1,c)};q.when=async function(a,b){if(3>b.arguments.length)throw new f.ArcadeExecutionError(a,f.ExecutionErrorCodes.WrongNumberOfParameters,b);if(0===b.arguments.length%2)throw new f.ArcadeExecutionError(a,f.ExecutionErrorCodes.WrongNumberOfParameters,b);const c=await l(a,b.arguments[0]);if(!1===e.isBoolean(c))throw new f.ArcadeExecutionError(a,f.ExecutionErrorCodes.BooleanConditionRequired,b.arguments[0]);return W(a,b,0,c)};D={fixSpatialReference:e.fixSpatialReference,
parseArguments:F,standardFunction:w,standardFunctionAsync:A,evaluateIdentifier:G};for(const a in q)q[a]={value:new v.NativeFunction(q[a]),valueset:!0,node:null};const B=function(){};B.prototype=q;B.prototype.infinity={value:Number.POSITIVE_INFINITY,valueset:!0,node:null};B.prototype.pi={value:Math.PI,valueset:!0,node:null};Z([ba.ArrayFunctions]);C.executeScript=async function(a,b){let c=b.spatialReference;if(null===c||void 0===c)c=new S({wkid:102100});let d=null;a.usesModules&&(d=new P.ArcadeModuleLoader(new Map,
a.loadedModules));const g=X(b.vars,b.customfunctions,b.timeZone);b={spatialReference:c,services:b.services,exports:{},libraryResolver:d,abortSignal:void 0===b.abortSignal||null===b.abortSignal?{aborted:!1}:b.abortSignal,globalScope:g,console:b.console??Y,timeZone:b.timeZone??null,lrucache:b.lrucache,interceptor:b.interceptor,localScope:null,depthCounter:{depth:1}};a=await H(b,a);if(a instanceof e.ReturnResult||a instanceof e.ImplicitResult){a=a.value;if(a===e.voidOperation)return null;if(e.isFunctionParameter(a))throw new f.ArcadeExecutionError(b,
f.ExecutionErrorCodes.IllegalResult,null);return a}if(a===e.voidOperation)return null;if(a===e.breakResult)throw new f.ArcadeExecutionError(b,f.ExecutionErrorCodes.IllegalResult,null);if(a===e.continueResult)throw new f.ArcadeExecutionError(b,f.ExecutionErrorCodes.IllegalResult,null);throw new f.ArcadeExecutionError(b,f.ExecutionErrorCodes.NeverReach,null);};C.extend=Z;C.functionHelper=D;Object.defineProperty(C,Symbol.toStringTag,{value:"Module"})});