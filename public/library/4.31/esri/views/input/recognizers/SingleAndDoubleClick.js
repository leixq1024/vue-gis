// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.31/esri/copyright.txt for details.
//>>built
define(["exports","../../../core/clock","../../../core/maybe","../InputHandler","./support"],function(k,p,l,q,d){class r extends q.InputHandler{constructor(a=d.DefaultParameters.maximumDoubleClickDelay,b=d.DefaultParameters.maximumDoubleClickDistance,c=d.DefaultParameters.maximumDoubleTouchDelay,e=d.DefaultParameters.maximumDoubleTouchDistance,g=p.clock){super(!1);this._maximumDoubleClickDelay=a;this._maximumDoubleClickDistance=b;this._maximumDoubleTouchDelay=c;this._maximumDoubleTouchDistance=e;
this._clock=g;this._pointerState=new Map;this._click=this.registerOutgoing("click");this._doubleClick=this.registerOutgoing("double-click");this.registerIncoming("immediate-click",f=>this._handleImmediateClick(f));this.registerIncoming("pointer-down",f=>this._handlePointerDown(f))}onUninstall(){this._pointerState.forEach(a=>a.doubleClickTimer=l.removeMaybe(a.doubleClickTimer))}get hasPendingInputs(){for(const a of this._pointerState.values())if(null!=a.doubleClickTimer)return!0;return!1}_clearDoubleClickTimer(a,
b){const c=this._pointerState.get(a);c&&(c.doubleClickTimer=l.removeMaybe(c.doubleClickTimer),b&&this._click.emit(c.event.data,void 0,c.event.modifiers),this._pointerState.delete(a),this.refreshHasPendingInputs())}_doubleClickTimeoutExceeded(a){const b=this._pointerState.get(a);1===b.pointerDownCount&&this._click.emit(b.event.data,void 0,b.event.modifiers);b.doubleClickTimer=null;this._pointerState.delete(a);this.refreshHasPendingInputs()}_handleImmediateClick(a){const b=a.data;var {pointerType:c}=
b.native;const {pointerId:e,pointerType:g,button:f}=b.native;var h="mouse"===g?`${e}:${f}`:`${g}`;if(this._pointerState.has(h)){var m=this._pointerState.get(h),{data:n,modifiers:t}=m.event;c="touch"===c?this._maximumDoubleTouchDistance:this._maximumDoubleClickDistance;d.manhattanDistance(n,b)>c?(this._clearDoubleClickTimer(h,!0),this._startClick(a)):(this._clearDoubleClickTimer(h,!1),2===m.pointerDownCount&&this._doubleClick.emit(n,void 0,t))}else this._startClick(a)}_handlePointerDown(a){a=d.getPointerId(a.data);
if(a=this._pointerState.get(a))a.pointerDownCount+=1}_startClick(a){var {data:b}=a;const {native:{pointerType:c}}=b,e=d.getPointerId(b);b=this._clock.setTimeout(()=>this._doubleClickTimeoutExceeded(e),"touch"===c?this._maximumDoubleTouchDelay:this._maximumDoubleClickDelay);this._pointerState.set(e,{event:a,doubleClickTimer:b,pointerDownCount:1});this.refreshHasPendingInputs()}}k.SingleAndDoubleClick=r;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})});