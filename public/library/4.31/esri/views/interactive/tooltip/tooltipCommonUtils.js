// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.31/esri/copyright.txt for details.
//>>built
define("exports ../../../core/asyncUtils ../../../core/handleUtils ../../../core/mathUtils ../../../core/quantityUtils ../../../core/reactiveUtils ../../../core/unitUtils ../../../chunks/vec32 ../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../geometry/coordinateFormatter ../../../geometry/Point ../../../geometry/support/MeshTransform ../../../geometry/support/meshVertexSpaceUtils ../../../geometry/support/spatialReferenceUtils ../../../geometry/support/webMercatorUtils ../keybindings ../Tooltip ./fields/parsingAndFormattingUtils ../../support/angularMeasurementUtils".split(" "),
function(g,x,y,p,q,G,H,m,k,r,I,J,t,K,u,L,M,z,v){function A(b,a){const {x:e,y:c,z:d}=a,{x:f,y:h,z:l}=B(b,a.spatialReference);b=null==f||p.floatEqualUlp(f,e)?0:f-e;a=null==h||p.floatEqualUlp(h,c)?0:h-c;const n=null==l||null==d||p.floatEqualUlp(l,d)?0:l-d;return{dx:b,dy:a,dz:n}}function B(b,a){let e,c;b.geographic?(e=v.getDegreesGeographic(b.longitude.actual),c=v.getDegreesGeographic(b.latitude.actual),K.isWebMercator(a)&&(null!=e&&null!=c?[e,c]=u.lngLatToXY(e,c,w):null!=e?e=u.lngLatToXY(e,0,w)[0]:null!=
c&&(c=u.lngLatToXY(0,c,w)[1]))):(e=b.x.actual?.value,c=b.y.actual?.value);b=b.elevation.actual;a=H.verticalLengthUnitFromSpatialReference(a);a=null!=a&&null!=b?q.valueInUnit(b,a):void 0;return{x:e,y:c,z:a}}function C(b){return m.equals(b,k.UNIT_Z)?1:m.equals(b,N)?-1:null}function O(b){const a=b?.sketchOptions;if(!a)return!1;const {inputEnabled:e,visibleElements:c}=a.tooltips;return e&&!0===b.editableFields.some(({name:d})=>"x"===d||"y"===d?c.coordinates:c[d])}function D(b,a,e){if(a&&"geographic"in
a){var c=b.clipboardData?.getData("text");if(c){var d=f=>{b.stopPropagation();b.preventDefault();e?.onBeforePaste();f();e?.onAfterPaste()};if(a.geographic){const f=z.parseLatitudeLongitude(c);f&&d(()=>{a.longitude.applyValue(f.longitude);a.latitude.applyValue(f.latitude)})}else{const f=z.parseXY(c);f&&d(()=>{a.x.applyValue(f.x);a.y.applyValue(f.y)})}}}}const w=[0,0],N=m.negate(k.create(),k.UNIT_Z);g.connectPasteEvent=function(b,a){let e=null;return y.handlesGroup([b.on("paste",async c=>{e?.abort();
e=x.createTask(async()=>{r.isLoaded()||await r.load();D(c,b.info,a)})}),x.createTask(()=>r.load()),y.makeHandle(()=>e?.abort())])};g.enterInputModeIfAvailable=function(b,a){return"key-down"===b.type&&b.key===L.tooltipKeys.enterInputMode&&a&&O(a.info)?(a.enterInputMode(),b.preventDefault(),b.stopPropagation(),!0):!1};g.getXYZDeltasFromTooltipInfo=A;g.makeTooltip=function(b){const a=new M(b());a.addHandles(G.watch(()=>b(),({view:e,options:c,info:d})=>{a.view=e;void 0!==c&&(a.options=c);void 0!==d&&
(a.info=d)}));return a};g.pasteLocation=D;g.updateMeshOriginFromTooltipInfo=function(b,a,e){if(a&&t.isRelativeVertexSpace(a.vertexSpace)){var {origin:c,spatialReference:d}=a,{x:f,y:h,z:l}=B(b,d),{dx:n,dy:E,dz:F}=A(b,c);if(0!==n||0!==E||0!==F)e.onMoveStart(),a.centerAt(new I({x:f??c.x,y:h??c.y,z:l??c.z,spatialReference:d})),e.onMove(n,E,F),e.onMoveStop()}};g.updateMeshTransformFromTooltipInfo=function(b,a,e){if(a&&t.isRelativeVertexSpace(a.vertexSpace)){a=a.transform??(a.transform=new J);{var c=v.getDegreesArithmetic(b.orientation.actual);
const h=C(a.rotationAxis);if(null!=c&&null!=h){var d=a.rotationAngle,f=c*h;c=(c-d)*h;d!==f&&(e?.onRotateStart(0),a.rotationAngle=f,e?.onRotate(c),e?.onRotateStop(c))}}d=b.scale.actual?.value;f=a?Math.max(...a.scale):1;null!=d&&d!==f&&({scale:b}=a,0===f?d=k.clone(k.ONES):(d/=f,d=m.scale(k.create(),b,d)),e?.onScaleStart(b[0],b[1],b[2]),a.scale=d,e?.onScale(d[0],d[1],d[2]),e?.onScaleStop(d[0],d[1],d[2]))}};g.updateTooltipInfoFromMeshTransform=function(b,a){const e=t.isRelativeVertexSpace(a.vertexSpace),
{scale:c,orientation:d}=b;({transform:b}=a);b?(a=C(b.rotationAxis),a=null!=a?a*b.rotationAngle:null):a=0;e&&null!=a?(d.actual=q.createAngle(a,"degrees","arithmetic"),d.visible=!0):(d.actual=null,d.visible=!1);e?(c.actual=q.createScalar(b?Math.max(...b.scale):1),c.visible=!0):(c.actual=null,c.visible=!1)};Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})});