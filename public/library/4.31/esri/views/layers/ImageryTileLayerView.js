// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.31/esri/copyright.txt for details.
//>>built
define("../../chunks/tslib.es6 ../../Graphic ../../core/Error ../../core/accessorSupport/decorators/property ../../core/has ../../core/Logger ../../core/RandomLCG ../../core/accessorSupport/decorators/subclass ../../layers/support/timeSupport ../../layers/support/rasterFunctions/rasterProjectionHelper ./support/popupUtils".split(" "),function(g,t,u,h,B,C,D,v,w,m,x){return c=>{c=class extends c{constructor(){super(...arguments);this._rasterFieldPrefix="Raster.";this.tileInfo=this.layer=null}get fullExtent(){try{return this.layer.loaded?
this._getFullExtent():null}catch{return null}}get timeExtent(){return w.combineTimeExtent(this.layer,this.view?.timeExtent,this._get("timeExtent"))}get hasTilingEffects(){return!!(this.layer.renderer&&"dynamicRangeAdjustment"in this.layer.renderer&&this.layer.renderer.dynamicRangeAdjustment)}get datumTransformation(){try{return this.layer.loaded?m.getDefaultDatumTransformationForDataset(this.layer.fullExtent,this.view.spatialReference,!0):null}catch{return null}}supportsSpatialReference(b){try{return!this.layer.loaded||
!!m.projectDatasetExtent(this.layer.serviceRasterInfo,b)}catch{return!1}}async fetchPopupFeaturesAtLocation(b,d){const {layer:a}=this;if(!b)throw new u("imageryTileLayerView:fetchPopupFeatures","Nothing to fetch without area",{layer:a});var {popupEnabled:k}=a,e=x.getFetchPopupTemplate(a,d);if(!k||null==e)return[];k=[];const {value:l,magdirValue:q,processedValue:y}=await a.identify(b,{timeExtent:this.timeExtent,signal:d?.signal});d="";if(l?.length){d="imagery-tile"===a.type&&a.hasStandardTime()&&null!=
l[0]?l.map(n=>a.getStandardTimeValue(n)).join(", "):l.join(", ");b={ObjectId:0};b["Raster.ServicePixelValue"]="imagery-tile"===a.type&&"Function"===a.raster.datasetFormat?y?.join(", "):d;b["Raster.ServicePixelValue.Raw"]=d;d=a.raster?.rasterInfo??a.serviceRasterInfo;e=d?.attributeTable;if(null!=e){const {fields:n,features:z}=e,r=n.find(({name:p})=>"value"===p.toLowerCase()),A=b["Raster.ServicePixelValue"];if(e=r?z.find(p=>String(p.attributes[r.name])===A):null)for(var f in e.attributes)e.attributes.hasOwnProperty(f)&&
(b[this._rasterFieldPrefix+f]=e.attributes[f])}f=d?.dataType;if("vector-magdir"===f||"vector-uv"===f)b["Raster.Magnitude"]=q?.[0],b["Raster.Direction"]=q?.[1];f=new t({geometry:this.fullExtent?.clone(),attributes:b,layer:a,sourceLayer:a});k.push(f)}return k}_getFullExtent(){return m.projectDatasetExtent(this.layer.serviceRasterInfo,this.view.spatialReference)}};g.__decorate([h.property()],c.prototype,"fullExtent",null);g.__decorate([h.property()],c.prototype,"layer",void 0);g.__decorate([h.property({readOnly:!0})],
c.prototype,"timeExtent",null);g.__decorate([h.property()],c.prototype,"tileInfo",void 0);g.__decorate([h.property({readOnly:!0})],c.prototype,"hasTilingEffects",null);g.__decorate([h.property()],c.prototype,"datumTransformation",null);return c=g.__decorate([v.subclass("esri.views.layers.ImageryTileLayerView")],c)}});