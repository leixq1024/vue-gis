// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.31/esri/copyright.txt for details.
//>>built
require({cache:{"esri/views/2d/engine/vectorTiles/TileHandler":function(){define("exports ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/urlUtils ../../../../core/workers/workers ./enums ./GlyphMosaic ./GlyphSource ./SpriteMosaic ../../tiling/TileKey".split(" "),function(A,z,B,e,g,h,b,c,d,f){function l(n){return()=>n.abort()}class x{constructor(n,m,p,C){this._layer=n;this._styleRepository=m;this.devicePixelRatio=p;this._sourceDataMaxLOD=C;this._inputSignalEventListener=this._startOptionsInputSignal=
this._spriteSourceAbortController=this._connection=this._glyphMosaic=this._spriteMosaic=null}destroy(){this._connection?.close();this._layer=this._styleRepository=this._connection=null;this._spriteMosaic?.destroy();this._glyphMosaic=this._spriteMosaic=null;this._spriteSourceAbortController=z.abortMaybe(this._spriteSourceAbortController);this._spriteSourcePromise=null;this._inputSignalEventListener&&this._startOptionsInputSignal?.removeEventListener("abort",this._inputSignalEventListener);this._inputSignalEventListener=
this._startOptionsInputSignal=null}get spriteMosaic(){return this._spriteSourcePromise.then(()=>this._spriteMosaic)}get glyphMosaic(){return this._glyphMosaic}async start(n){this._requestSprite(n);var m=this._layer.currentStyleInfo.glyphsUrl;m=new c(m?e.addQueryParameters(m,{...this._layer.customParameters,token:this._layer.apiKey}):null);this._glyphMosaic=new b(1024,1024,m);this._broadcastPromise=g.open("WorkerTileHandler",{client:this,schedule:n.schedule,signal:n.signal}).then(p=>{this._layer&&
(this._connection?.close(),this._connection=p,this._layer&&!this._connection.closed&&(p=p.broadcast("setStyle",{style:this._layer.currentStyleInfo.style,sourceDataMaxLOD:this._sourceDataMaxLOD},n),Promise.all(p).catch(C=>B.throwIfNotAbortError(C))))})}_requestSprite(n){this._spriteSourceAbortController?.abort();const m=new AbortController;this._spriteSourceAbortController=m;const p=n?.signal;this._inputSignalEventListener&&this._startOptionsInputSignal?.removeEventListener("abort",this._inputSignalEventListener);
this._startOptionsInputSignal=null;p&&(this._inputSignalEventListener=l(m),p.addEventListener("abort",this._inputSignalEventListener,{once:!0}));const {signal:C}=m;this._spriteSourcePromise=this._layer.loadSpriteSource(this.devicePixelRatio,{...n,signal:C});this._spriteSourcePromise.then(H=>{B.throwIfAbortError(C);this._spriteMosaic=new d(1024,1024,250);this._spriteMosaic.setSpriteSource(H)})}async updateStyle(n){const m=[];for(const p of n)p.type===h.StyleUpdateType.SPRITES_CHANGED?m.push({type:h.StyleUpdateType.SPRITES_CHANGED,
data:{spriteSource:null}}):m.push(p);await this._broadcastPromise;return this._broadcastPromise=Promise.all(this._connection.broadcast("updateStyle",m))}setSpriteSource(n){const m=new d(1024,1024,250);m.setSpriteSource(n);this._spriteMosaic=m;this._spriteSourcePromise=Promise.resolve(n);this._spriteSourceAbortController=null;return m}async setStyle(n,m,p){await this._broadcastPromise;this._styleRepository=n;this._sourceDataMaxLOD=p;this._requestSprite();n=new c(this._layer.currentStyleInfo.glyphsUrl?
e.addQueryParameters(this._layer.currentStyleInfo.glyphsUrl,{...this._layer.customParameters,token:this._layer.apiKey}):null);this._glyphMosaic=new b(1024,1024,n);return this._broadcastPromise=Promise.all(this._connection.broadcast("setStyle",{style:m,sourceDataMaxLOD:this._sourceDataMaxLOD}))}async fetchTileData(n,m){n=await this._getRefKeys(n,m);return this._getSourcesData(Object.keys(this._layer.sourceNameToSource),n,m)}async fetchTilePBFs(n){const m=Object.keys(this._layer.sourceNameToSource),
p={};n=await this._getRefKeys(n,p);const C=[],H=[];for(let y=0;y<n.length;y++)if(null==n[y].value||null==m[y])H.push(null);else{const E=n[y].value,G=this._getTilePayload(E,m[y],p);G.then(K=>{C.push({...K,key:E})});H.push(G)}return Promise.all(H).then(()=>C)}async parseTileData(n,m){const p=n&&n.data;if(!p)return null;const {sourceName2DataAndRefKey:C,transferList:H}=p;return 0===Object.keys(C).length?null:this._broadcastPromise.then(()=>this._connection.invoke("createTileAndParse",{key:n.key.id,sourceName2DataAndRefKey:C,
styleLayerUIDs:n.styleLayerUIDs},{...m,transferList:H}))}async getSprites(n){await this._spriteSourcePromise;return this._spriteMosaic.getSpriteItems(n)}getGlyphs(n){return this._glyphMosaic.getGlyphItems(n.font,n.codePoints)}async _getTilePayload(n,m,p){n=f.pool.acquire(n.id);const C=this._layer.sourceNameToSource[m],{level:H,row:y,col:E}=n;f.pool.release(n);try{return{protobuff:await C.requestTile(H,y,E,p),sourceName:m}}catch(G){if(B.isAbortError(G))throw G;return{protobuff:null,sourceName:m}}}async _getRefKeys(n,
m){const p=this._layer.sourceNameToSource,C=[];for(const H in p){const y=p[H].getRefKey(n,m);C.push(y)}return B.eachAlways(C)}_getSourcesData(n,m,p){const C=[];for(let H=0;H<m.length;H++)if(null==m[H].value||null==n[H])C.push(null);else{const y=this._getTilePayload(m[H].value,n[H],p);C.push(y)}return B.eachAlways(C).then(H=>{const y={},E=[];for(let G=0;G<H.length;G++){const K=H[G].value;K&&K.protobuff&&0<K.protobuff.byteLength&&(y[K.sourceName]={refKey:m[G].value.id,protobuff:K.protobuff},E.push(K.protobuff))}return{sourceName2DataAndRefKey:y,
transferList:E}})}}A.TileHandler=x;Object.defineProperty(A,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/GlyphMosaic":function(){define(["./RectangleBinPack","../webgl/Rect","../../../webgl/enums","../../../webgl/Texture","../../../webgl/TextureDescriptor"],function(A,z,B,e,g){class h{constructor(b,c,d){this.height=this.width=0;this._dirties=[];this._glyphData=[];this._currentPage=0;this._glyphIndex={};this._textures=[];this._rangePromises=new Map;this.width=b;this.height=
c;this._glyphSource=d;this._binPack=new A(b-4,c-4);this._glyphData.push(new Uint8Array(b*c));this._dirties.push(!0);this._textures.push(void 0)}getGlyphItems(b,c){const d=[],f=this._glyphSource,l=new Set,x=1/256;for(const m of c)l.add(Math.floor(m*x));const n=[];l.forEach(m=>{const p=b+m;this._rangePromises.has(p)?n.push(this._rangePromises.get(p)):(m=f.getRange(b,m).then(()=>{this._rangePromises["delete"](p)},()=>{this._rangePromises["delete"](p)}),this._rangePromises.set(p,m),n.push(m))});return Promise.all(n).then(()=>
{let m=this._glyphIndex[b];m||(m={},this._glyphIndex[b]=m);for(const E of c){var p=m[E];if(p){d[E]={sdf:!0,rect:p.rect,metrics:p.metrics,page:p.page,code:E};continue}var C=f.getGlyph(b,E);if(!C?.metrics)continue;p=C.metrics;let G;if(0===p.width)G=new z(0,0,0,0);else{const K=p.width+6,M=p.height+6;var H=K%4?4-K%4:4,y=M%4?4-M%4:4;1===H&&(H=5);1===y&&(y=5);G=this._binPack.allocate(K+H,M+y);G.isEmpty&&(this._dirties[this._currentPage]||(this._glyphData[this._currentPage]=null),this._currentPage=this._glyphData.length,
this._glyphData.push(new Uint8Array(this.width*this.height)),this._dirties.push(!0),this._textures.push(void 0),this._binPack=new A(this.width-4,this.height-4),G=this._binPack.allocate(K+H,M+y));H=this._glyphData[this._currentPage];C=C.bitmap;let P;if(C)for(let q=0;q<M;q++){y=K*q;P=this.width*(G.y+q+1)+G.x;for(let v=0;v<K;v++)H[P+v+1]=C.at(y+v)}}m[E]={rect:G,metrics:p,tileIDs:null,page:this._currentPage};d[E]={sdf:!0,rect:G,metrics:p,page:this._currentPage,code:E};this._dirties[this._currentPage]=
!0}return d})}removeGlyphs(b){for(const c in this._glyphIndex){const d=this._glyphIndex[c];if(!d)continue;let f;for(const l in d)if(f=d[l],f.tileIDs["delete"](b),0===f.tileIDs.size){const x=this._glyphData[f.page],n=f.rect;let m,p;for(let C=0;C<n.height;C++)for(m=this.width*(n.y+C)+n.x,p=0;p<n.width;p++)x[m+p]=0;delete d[l];this._dirties[f.page]=!0}}}bind(b,c,d,f=0){if(!this._textures[d]){var l=new g.TextureDescriptor;l.pixelFormat=B.PixelFormat.ALPHA;l.wrapMode=B.TextureWrapMode.CLAMP_TO_EDGE;l.width=
this.width;l.height=this.height;this._textures[d]=new e.Texture(b,l,new Uint8Array(this.width*this.height))}l=this._textures[d];l.setSamplingMode(c);this._dirties[d]&&l.setData(this._glyphData[d]);b.bindTexture(l,f);this._dirties[d]=!1}destroy(){this.dispose()}dispose(){this._glyphData.length=0;this._binPack=null;for(const b of this._textures)b&&b.dispose();this._textures.length=0}}return h})},"esri/views/2d/engine/vectorTiles/RectangleBinPack":function(){define(["../webgl/Rect"],function(A){class z{constructor(B,
e){this._height=this._width=0;this._free=[];this._width=B;this._height=e;this._free.push(new A(0,0,B,e))}get width(){return this._width}get height(){return this._height}allocate(B,e){if(B>this._width||e>this._height)return new A;let g=null,h=-1;for(let b=0;b<this._free.length;++b){const c=this._free[b];B<=c.width&&e<=c.height&&(null===g||c.y<=g.y&&c.x<=g.x)&&(g=c,h=b)}if(null===g)return new A;this._free.splice(h,1);g.width<g.height?(g.width>B&&this._free.push(new A(g.x+B,g.y,g.width-B,e)),g.height>
e&&this._free.push(new A(g.x,g.y+e,g.width,g.height-e))):(g.width>B&&this._free.push(new A(g.x+B,g.y,g.width-B,g.height)),g.height>e&&this._free.push(new A(g.x,g.y+e,B,g.height-e)));return new A(g.x,g.y,B,e)}release(B){for(let e=0;e<this._free.length;++e){const g=this._free[e];if(g.y===B.y&&g.height===B.height&&g.x+g.width===B.x)g.width+=B.width;else if(g.x===B.x&&g.width===B.width&&g.y+g.height===B.y)g.height+=B.height;else if(B.y===g.y&&B.height===g.height&&B.x+B.width===g.x)g.x=B.x,g.width+=B.width;
else if(B.x===g.x&&B.width===g.width&&B.y+B.height===g.y)g.y=B.y,g.height+=B.height;else continue;this._free.splice(e,1);this.release(B)}this._free.push(B)}}return z})},"esri/views/2d/engine/vectorTiles/GlyphSource":function(){define(["../../../../request","../../../../core/pbf"],function(A,z){class B{constructor(b){this._metrics=[];if(b){for(var c=new Map,d=0;b.next();)switch(b.tag()){case 1:const l=b.getMessage();for(;l.next();)switch(l.tag()){case 3:var f=l.getMessage();let x,n,m,p,C,H,y;for(;f.next();)switch(f.tag()){case 1:x=
f.getUInt32();break;case 2:n=f.getBytes();break;case 3:m=f.getUInt32();break;case 4:p=f.getUInt32();break;case 5:C=f.getSInt32();break;case 6:H=f.getSInt32();break;case 7:y=f.getUInt32();break;default:f.skip()}f.release();x&&(f=n?.length??0,this._metrics[x]={width:m,height:p,left:C,top:H,advance:y,startOffset:d,length:f},c.set(x,n),d+=f);break;default:l.skip()}l.release();break;default:b.skip()}b=new Uint8Array(d);d=this._metrics;for(const [l,x]of c){const {startOffset:n,length:m}=d[l];if(x)for(c=
0;c<m;++c)b[n+c]=x[c]}this._allBitmaps=b}else this._allBitmaps=null}getMetrics(b){return this._metrics[b]}getBitmap(b){if(this._allBitmaps&&(b=this._metrics[b],void 0!==b)){var {startOffset:c,length:d}=b;if(0!==d)return new h(this._allBitmaps,c,d)}}}class e{constructor(){this._ranges=[]}get ranges(){return this._ranges}getRange(b){return this._ranges[b]}addRange(b,c){this._ranges[b]=c}}class g{constructor(b){this._glyphInfo={};this._baseURL=b}getRange(b,c){const d=this._getFontStack(b);if(d.getRange(c))return Promise.resolve();
const f=256*c,l=f+255;if(this._baseURL)return b=this._baseURL.replace("{fontstack}",b).replace("{range}",f+"-"+l),A(b,{responseType:"array-buffer"}).then(x=>{d.addRange(c,new B(new z(new Uint8Array(x.data),new DataView(x.data))))}).catch(()=>{d.addRange(c,new B)});d.addRange(c,new B);return Promise.resolve()}getGlyph(b,c){if(b=this._getFontStack(b))if(b=b.getRange(Math.floor(c/256)))return{metrics:b.getMetrics(c),bitmap:b.getBitmap(c)}}_getFontStack(b){let c=this._glyphInfo[b];c||=this._glyphInfo[b]=
new e;return c}}class h{constructor(b,c,d){this._array=b;this._start=c;this.length=d}at(b){return 0<=b&&b<this.length?this._array[this._start+b]:void 0}}return g})},"esri/views/2d/engine/vectorTiles/SpriteMosaic":function(){define("../../../../core/has ../../../../symbols/cim/rasterizingUtils ./RectangleBinPack ../webgl/Rect ../../../webgl/enums ../../../webgl/Texture ../../../webgl/TextureDescriptor".split(" "),function(A,z,B,e,g,h,b){class c{constructor(d,f,l=0){this._size=[];this._mosaicsData=
[];this._textures=[];this._dirties=[];this._pageHeight=this._pageWidth=this._currentPage=this._maxItemSize=0;this._mosaicRects={};this.pixelRatio=1;0>=f&&console.error("Sprites mosaic defaultWidth and defaultHeight must be greater than zero!");this._pageWidth=d;this._pageHeight=f;0<l&&(this._maxItemSize=l);this._binPack=new B(d-4,f-4)}destroy(){this.dispose()}dispose(){this._binPack=null;this._mosaicsData.length=0;this._mosaicRects={};for(const d of this._textures)d&&d.dispose();this._textures.length=
0}getWidth(d){return d>=this._size.length?-1:this._size[d][0]}getHeight(d){return d>=this._size.length?-1:this._size[d][1]}getPageSize(d){return d>=this._size.length?null:this._size[d]}setSpriteSource(d){this.dispose();this.pixelRatio=d.devicePixelRatio;if(0===this._mosaicsData.length){this._binPack=new B(this._pageWidth-4,this._pageHeight-4);const f=new Uint32Array(Math.floor(this._pageWidth)*Math.floor(this._pageHeight));this._mosaicsData[0]=f;this._dirties.push(!0);this._size.push([this._pageWidth,
this._pageHeight]);this._textures.push(void 0)}this._sprites=d}getSpriteItem(d,f=!1){var l=this._mosaicRects[d];if(l)return l;if(!this._sprites||"loaded"!==this._sprites.loadStatus)return null;let x;d&&d.startsWith("dasharray-")?([l,x]=this._rasterizeDash(d),f=!0):l=this._sprites.getSpriteInfo(d);if(!l?.width||!l.height||0>l.width||0>l.height)return null;const n=l.width,m=l.height,[p,C,H]=this._allocateImage(n,m);if(0>=p.width)return null;this._copy(p,l,C,H,f,x);l={type:"sprite",rect:p,width:n,height:m,
sdf:l.sdf,simplePattern:!1,rasterizationScale:l.pixelRatio,page:C};return this._mosaicRects[d]=l}getSpriteItems(d){const f={};for(const l of d)f[l.name]=this.getSpriteItem(l.name,l.repeat);return f}getMosaicItemPosition(d,f){d=this.getSpriteItem(d,f);f=d?.rect;if(!f)return null;f.width=d.width;f.height=d.height;return{tl:[f.x+2,f.y+2],br:[f.x+2+d.width,f.y+2+d.height],page:d.page}}bind(d,f,l=0,x=0){if(!(l>=this._size.length||l>=this._mosaicsData.length)){if(!this._textures[l]){var n=new b.TextureDescriptor;
n.wrapMode=g.TextureWrapMode.CLAMP_TO_EDGE;n.width=this._size[l][0];n.height=this._size[l][1];this._textures[l]=new h.Texture(d,n,new Uint8Array(this._mosaicsData[l].buffer))}n=this._textures[l];n.setSamplingMode(f);this._dirties[l]&&n.setData(new Uint8Array(this._mosaicsData[l].buffer));d.bindTexture(n,x);this._dirties[l]=!1}}static _copyBits(d,f,l,x,n,m,p,C,H,y,E){let G=x*f+l;p=C*m+p;if(E)for(p-=m,E=-1;E<=y;E++,G=((E+y)%y+x)*f+l,p+=m)for(C=-1;C<=H;C++)n[p+C]=d[G+(C+H)%H];else for(l=0;l<y;l++){for(x=
0;x<H;x++)n[p+x]=d[G+x];G+=f;p+=m}}_copy(d,f,l,x,n,m){if(this._sprites&&"loaded"===this._sprites.loadStatus&&!(l>=this._mosaicsData.length)){var p=new Uint32Array(m?m.buffer:this._sprites.image.buffer);c._copyBits(p,m?f.width:this._sprites.width,f.x,f.y,this._mosaicsData[l],x[0],d.x+2,d.y+2,f.width,f.height,n);this._dirties[l]=!0}}_allocateImage(d,f){d+=2;f+=2;var l=Math.max(d,f);if(this._maxItemSize&&this._maxItemSize<l)return l=new e(0,0,d,f),this._mosaicsData.push(new Uint32Array(d*f)),this._dirties.push(!0),
this._size.push([d,f]),this._textures.push(void 0),[l,this._mosaicsData.length-1,[d,f]];l=d%4?4-d%4:4;let x=f%4?4-f%4:4;1===l&&(l=5);1===x&&(x=5);l=this._binPack.allocate(d+l,f+x);return 0>=l.width?(this._dirties[this._currentPage]||(this._mosaicsData[this._currentPage]=null),this._currentPage=this._mosaicsData.length,this._mosaicsData.push(new Uint32Array(this._pageWidth*this._pageHeight)),this._dirties.push(!0),this._size.push([this._pageWidth,this._pageHeight]),this._textures.push(void 0),this._binPack=
new B(this._pageWidth-4,this._pageHeight-4),this._allocateImage(d,f)):[l,this._currentPage,[this._pageWidth,this._pageHeight]]}_rasterizeDash(d){var f=d.match(/\[(.*?)\]/);if(!f)return null;f=f[1].split(",").map(Number);d=d.slice(d.lastIndexOf("-")+1);const [l,x,n]=z.rasterizeDash(f,d);d=new Uint8Array(l.buffer);return[{x:0,y:0,width:x,height:n,sdf:!0,pixelRatio:1},d]}}return c})},"esri/views/2d/engine/vectorTiles/TileManager":function(){define(["exports","../../../../core/LRUCache","../../../../geometry/support/aaBoundingRect",
"../../tiling/TileCoverage","../../tiling/TileKey"],function(A,z,B,e,g){const h=(c,d)=>c+1/(1<<2*d);class b{constructor(c,d){this._tiles=new Map;this._tileCache=new z.LRUCache(40,f=>f.dispose());this._viewSize=[0,0];this._visibleTiles=new Map;this.acquireTile=c.acquireTile;this.releaseTile=c.releaseTile;this.tileInfoView=c.tileInfoView;this._container=d}destroy(){for(const c of this._tiles.values())c.dispose();this._tiles=null;this._tileCache.clear();this._tileCache=null}update(c){this._updateCacheSize(c);
const d=this.tileInfoView;c=d.getTileCoverage(c.state,0,!0,"smallest");if(!c)return!0;const {spans:f,lodInfo:l}=c,{level:x}=l,n=this._tiles,m=new Set,p=new Set;for(const {row:H,colFrom:y,colTo:E}of f)for(let G=y;G<=E;G++){const K=g.getId(x,H,l.normalizeCol(G),l.getWorldForColumn(G)),M=this._getOrAcquireTile(K);m.add(K);M.processed()?this._addToContainer(M):p.add(new g(K))}for(const [H,y]of n)y.isCoverage=m.has(H);for(var C of p)this._findPlaceholdersForMissingTiles(C,m);C=!1;for(const [H,y]of n)y.neededForCoverage=
m.has(H),y.neededForCoverage||y.isHoldingForFade&&d.intersects(c,y.key)&&m.add(H),y.isFading&&(C=!0);for(const H of this._tiles.keys())m.has(H)||this._releaseTile(H);e.pool.release(c);return!C}clear(){this._tiles.clear();this._tileCache.clear();this._visibleTiles.clear()}clearCache(){this._tileCache.clear()}getIntersectingTiles(c,d,f,l,x){const n=[0,0],m=[0,0];l.toMap(n,c-f,d+f);l.toMap(m,c+f,d-f);d=B.fromValues(Math.min(n[0],m[0]),Math.min(n[1],m[1]),Math.max(n[0],m[0]),Math.max(n[1],m[1]));f=B.create();
c=[];for(const p of this._visibleTiles.values())this.tileInfoView.getTileBounds(f,p.key),B.intersects(d,f)&&c.push(p);if(null!=x&&0<x.length){const p=new Set(c.map(C=>C.id));x=x.filter(C=>!p.has(C.tileKey.id)).map(C=>this._visibleTiles.get(C.tileKey.id)).filter(C=>void 0!==C);c.push(...x)}return c}_findPlaceholdersForMissingTiles(c,d){var f=[];for(const l of this._tiles.values())this._addPlaceholderChild(f,l,c,d);f=f.reduce(h,0);1E-6>Math.abs(1-f)||this._addPlaceholderParent(c.id,d)}_addPlaceholderChild(c,
d,f,l){if(!(d.key.level<=f.level)&&d.hasData()){var x=d.key,n=x.level-f.level;f.row===x.row>>n&&f.col===x.col>>n&&f.world===x.world&&(this._addToContainer(d),l.add(d.id),c.push(d.key.level-f.level))}}_addPlaceholderParent(c,d){const f=this._tiles;for(;;){{const [x,n,m,p]=c.split("/");c=parseInt(x,10);c=0===c?null:`${c-1}/${parseInt(n,10)>>1}/${parseInt(m,10)>>1}/${parseInt(p,10)}`}if(!c||d.has(c))break;const l=f.get(c);if(l?.hasData()){this._addToContainer(l);d.add(l.id);break}}}_getOrAcquireTile(c){let d=
this._tiles.get(c);if(d)return d;(d=this._tileCache.pop(c))||(d=this.acquireTile(new g(c)));this._tiles.set(c,d);return d}_releaseTile(c){const d=this._tiles.get(c);this.releaseTile(d);this._removeFromContainer(d);this._tiles.delete(c);d.hasData()?this._tileCache.put(c,d,1):d.dispose()}_addToContainer(c){let d;const f=[],l=this._container;if(!l.contains(c)){var x=this._visibleTiles;for(const n of x.values())this._canConnectDirectly(c,n)&&f.push(n),null==d&&this._canConnectDirectly(n,c)&&(d=n);if(null!=
d){for(const n of f)d.childrenTiles.delete(n),c.childrenTiles.add(n),n.parentTile=c;d.childrenTiles.add(c);c.parentTile=d}else for(const n of f)c.childrenTiles.add(n),n.parentTile=c;x.set(c.id,c);l.addChild(c)}}_removeFromContainer(c){this._visibleTiles.delete(c.id);this._container.removeChild(c);if(null!=c.parentTile){c.parentTile.childrenTiles.delete(c);for(const d of c.childrenTiles)null!=c.parentTile&&c.parentTile.childrenTiles.add(d)}for(const d of c.childrenTiles)d.parentTile=c.parentTile;c.parentTile=
null;c.childrenTiles.clear()}_canConnectDirectly(c,d){c=c.key;let {level:f,row:l,col:x,world:n}=d.key;for(d=this._visibleTiles;0<f;){f--;l>>=1;x>>=1;if(c.level===f&&c.row===l&&c.col===x&&c.world===n)return!0;if(d.has(`${f}/${l}/${x}/${n}`))break}return!1}_updateCacheSize(c){c=c.state.size;if(c[0]!==this._viewSize[0]||c[1]!==this._viewSize[1]){var d=Math.ceil(c[0]/512)+1,f=Math.ceil(c[1]/512)+1;this._viewSize[0]=c[0];this._viewSize[1]=c[1];this._tileCache.maxSize=5*d*f}}}A.TileManager=b;Object.defineProperty(A,
Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/VectorTile":function(){define("exports ../../../../core/has ../../../../core/libs/gl-matrix-2/math/mat3 ../../../../core/libs/gl-matrix-2/factories/mat3f32 ./enums ./RenderBucket ./decluttering/config ../webgl/TiledDisplayObject".split(" "),function(A,z,B,e,g,h,b,c){class d extends c.TiledDisplayObject{constructor(f,l,x,n,m,p,C,H=null){super(f,l,x,n,m,p,4096,4096);this.styleRepository=C;this._memCache=H;this.type="vector-tile";
this._referenced=1;this._hasSymbolBuckets=!1;this._usedMemory=256;this.layerData=new Map;this.status="loading";this.allSymbolsFadingOut=!1;this.lastOpacityUpdate=0;this.symbols=new Map;this.decluttered=this.neededForCoverage=this.isCoverage=!1;this.parentTile=null;this.childrenTiles=new Set;this.featureIndex=null;this.triangleCount=0;this._processed=!1;this.id=f.id}get hasSymbolBuckets(){return this._hasSymbolBuckets}get isFading(){return this._hasSymbolBuckets&&performance.now()-this.lastOpacityUpdate<
b.fadeDuration}get isHoldingForFade(){return this._hasSymbolBuckets&&(!this.allSymbolsFadingOut||performance.now()-this.lastOpacityUpdate<b.fadeDuration)}get wasRequested(){return"errored"===this.status||"loaded"===this.status||"reloading"===this.status}setData(f){this.changeDataImpl(f);this.requestRender();this.ready();this._processed=!0}deleteLayerData(f){let l=!1;for(const x of f)if(f=this.layerData.get(x))this._usedMemory-=f.usedMemory,f.type===g.BucketType.SYMBOL&&this.symbols.delete(x)&&(l=
!0),f.destroy(),this.layerData.delete(x);this._memCache?.updateSize(this.key.id,this,this._usedMemory);l&&(this.featureIndex?.clear(),this.emit("symbols-changed"));this.requestRender()}processed(){return this._processed}hasData(){return 0<this.layerData.size}hasFeatures(){const f=this.layerData.values();for(const l of f)if(l.hasData())return!0;return!1}dispose(){"unloaded"!==this.status&&(d._destroyRenderBuckets(this.layerData),this.layerData.clear(),this.featureIndex=null,this._usedMemory=0,this.destroy(),
this.status="unloaded")}release(){0===--this._referenced&&(this.dispose(),this.stage=null)}retain(){++this._referenced}get usedMemory(){return this._usedMemory}get usedMemoryPerReference(){return this._usedMemory/(this._referenced||1)}changeDataImpl(f){this.featureIndex?.clear();let l=!1;if(f){const {bucketsWithData:x,emptyBuckets:n}=f;f=this._createRenderBuckets(x);if(n&&0<n.byteLength){const m=new Uint32Array(n);for(const p of m)this._deleteLayerData(p)}for(const [m,p]of f)this._deleteLayerData(m),
p.type===g.BucketType.SYMBOL&&(this.symbols.set(m,p.symbols),l=!0),this._usedMemory+=p.usedMemory,this.layerData.set(m,p);this._memCache?.updateSize(this.key.id,this,this.usedMemory)}this._hasSymbolBuckets=!1;for(const x of this.layerData.values())x.type===g.BucketType.SYMBOL&&(this._hasSymbolBuckets=!0);l&&this.emit("symbols-changed")}attachWithContext(f){this.stage={context:f,trashDisplayObject(l){l.processDetach()},untrashDisplayObject(){return!1}}}setTransform(f){super.setTransform(f);var l=this.resolution/
(f.resolution*f.pixelRatio);const x=this.width/this.rangeX*l;l*=this.height/this.rangeY;const n=[0,0];f.toScreen(n,[this.x,this.y]);const m=this.transforms.tileUnitsToPixels;B.identity(m);B.translate(m,m,n);B.rotate(m,m,Math.PI*f.rotation/180);B.scale(m,m,[x,l,1])}_createTransforms(){return{displayViewScreenMat3:e.create(),tileMat3:e.create(),tileUnitsToPixels:e.create()}}static _destroyRenderBuckets(f){if(f){var l=new Set;for(const x of f.values())l.has(x)||(x.destroy(),l.add(x));f.clear()}}_createRenderBuckets(f){const l=
new Map,x=new Map;for(const n of f){f=this._deserializeBucket(n,x);for(const m of f.layerUIDs)l.set(m,f)}return l}_deserializeBucket(f,l){let x=l.get(f);if(x)return x;switch((new Uint32Array(f))[0]){case g.BucketType.FILL:x=new h.FillRenderBucket(f,this.styleRepository);break;case g.BucketType.LINE:x=new h.LineRenderBucket(f,this.styleRepository);break;case g.BucketType.SYMBOL:x=new h.SymbolRenderBucket(f,this.styleRepository,this);break;case g.BucketType.CIRCLE:x=new h.CircleRenderBucket(f,this.styleRepository)}l.set(f,
x);return x}_deleteLayerData(f){if(this.layerData.has(f)){var l=this.layerData.get(f);this._usedMemory-=l.usedMemory;l.destroy();this.layerData.delete(f)}}}A.VectorTile=d;A.tracer=null;Object.defineProperty(A,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/RenderBucket":function(){define("exports ../../../../core/maybe ../../../../core/typedArrayUtil ../../tiling/TileInfoView ../../tiling/TileKey ../../tiling/TileQueue ../../tiling/TileStrategy ./enums ./decluttering/util ../../../webgl/BufferObject ../../../webgl/enums ../../../webgl/VertexArrayObject".split(" "),
function(A,z,B,e,g,h,b,c,d,f,l,x){class n{constructor(y,E){this.layerUIDs=[];this.isDestroyed=!1;this._data=y;let G=1;y=new Uint32Array(y);this.layerUIDs=[];const K=y[G++];for(let M=0;M<K;M++)this.layerUIDs[M]=y[G++];this.bufferDataOffset=G;E&&(this.layer=E.getStyleLayerByUID(this.layerUIDs[0]))}get isPreparedForRendering(){return null==this._data}get offset(){return this.bufferDataOffset}get data(){return this._data}destroy(){this.isDestroyed||(this.doDestroy(),this._data=null,this.isDestroyed=!0)}prepareForRendering(y){null!=
this._data&&(this.doPrepareForRendering(y,this._data,this.bufferDataOffset),this._data=null)}}class m extends n{constructor(y,E){super(y,E);this.type=c.BucketType.LINE;this.lineIndexCount=this.lineIndexStart=0;y=new Uint32Array(y);E=this.bufferDataOffset;this.lineIndexStart=y[E++];this.lineIndexCount=y[E++];const G=y[E++];if(0<G){this.patternMap=new Map;for(let K=0;K<G;K++){const M=y[E++],P=y[E++],q=y[E++];this.patternMap.set(M,[P,q])}}this.bufferDataOffset=E}get usedMemory(){return(this.data?.byteLength??
0)+(this.vao?.usedMemory??0)}hasData(){return 0<this.lineIndexCount}triangleCount(){return this.lineIndexCount/3}doDestroy(){this.vao=z.disposeMaybe(this.vao)}doPrepareForRendering(y,E,G){var K=new Uint32Array(E);E=new Int32Array(K.buffer);var M=K[G++];E=f.BufferObject.createVertex(y,l.Usage.STATIC_DRAW,new Int32Array(E.buffer,4*G,M));G+=M;M=K[G++];K=f.BufferObject.createIndex(y,l.Usage.STATIC_DRAW,new Uint32Array(K.buffer,4*G,M));G+=M;G=this.layer.lineMaterial;this.vao=new x.VertexArrayObject(y,
G.getAttributeLocations(),G.getLayoutInfo(),new Map([["geometry",E]]),K)}}class p extends n{constructor(y,E){super(y,E);this.type=c.BucketType.FILL;this.outlineIndexCount=this.outlineIndexStart=this.fillIndexCount=this.fillIndexStart=0;y=new Uint32Array(y);E=this.bufferDataOffset;this.fillIndexStart=y[E++];this.fillIndexCount=y[E++];this.outlineIndexStart=y[E++];this.outlineIndexCount=y[E++];const G=y[E++];if(0<G){this.patternMap=new Map;for(let K=0;K<G;K++){const M=y[E++],P=y[E++],q=y[E++];this.patternMap.set(M,
[P,q])}}this.bufferDataOffset=E}get usedMemory(){return(this.data?.byteLength??0)+(this.fillVAO?.usedMemory??0)+(this.outlineVAO?.usedMemory??0)}hasData(){return 0<this.fillIndexCount||0<this.outlineIndexCount}triangleCount(){return(this.fillIndexCount+this.outlineIndexCount)/3}doDestroy(){this.fillVAO=z.disposeMaybe(this.fillVAO);this.outlineVAO=z.disposeMaybe(this.outlineVAO)}doPrepareForRendering(y,E,G){var K=new Uint32Array(E),M=new Int32Array(K.buffer),P=K[G++];E=f.BufferObject.createVertex(y,
l.Usage.STATIC_DRAW,new Int32Array(M.buffer,4*G,P));G+=P;var q=K[G++];P=f.BufferObject.createIndex(y,l.Usage.STATIC_DRAW,new Uint32Array(K.buffer,4*G,q));G+=q;q=K[G++];M=f.BufferObject.createVertex(y,l.Usage.STATIC_DRAW,new Int32Array(M.buffer,4*G,q));G+=q;q=K[G++];K=f.BufferObject.createIndex(y,l.Usage.STATIC_DRAW,new Uint32Array(K.buffer,4*G,q));G+=q;q=this.layer;G=q.fillMaterial;q=q.outlineMaterial;this.fillVAO=new x.VertexArrayObject(y,G.getAttributeLocations(),G.getLayoutInfo(),new Map([["geometry",
E]]),P);this.outlineVAO=new x.VertexArrayObject(y,q.getAttributeLocations(),q.getLayoutInfo(),new Map([["geometry",M]]),K)}}class C extends n{constructor(y,E,G){super(y,E);this.type=c.BucketType.SYMBOL;this.iconPerPageElementsMap=new Map;this.glyphPerPageElementsMap=new Map;this.symbolInstances=[];this.opacityChanged=this.isIconSDF=!1;this.lastOpacityUpdate=0;this.symbols=[];E=new Uint32Array(y);const K=new Int32Array(y);y=new Float32Array(y);let M=this.bufferDataOffset;this.isIconSDF=!!E[M++];var P=
E[M++],q=E[M++],v=E[M++];P=new g(P,q,v,0);q=E[M++];for(v=0;v<q;v++){var k=E[M++],t=E[M++],u=E[M++];this.iconPerPageElementsMap.set(k,[t,u])}q=E[M++];for(v=0;v<q;v++)k=E[M++],t=E[M++],u=E[M++],this.glyphPerPageElementsMap.set(k,[t,u]);q=E[M++];v=E[M++];this.iconOpacity=new Int32Array(q);this.textOpacity=new Int32Array(v);this.bufferDataOffset=M=d.deserializeSymbols(E,K,y,M,this.symbols,G,P)}get usedMemory(){return(this.data?.byteLength??0)+(this.iconVAO?.usedMemory??0)+(this.textVAO?.usedMemory??0)+
B.estimateSize(this.iconOpacity)+B.estimateSize(this.textOpacity)}hasData(){return 0<this.iconPerPageElementsMap.size||0<this.glyphPerPageElementsMap.size}triangleCount(){let y=0;for(const E of this.iconPerPageElementsMap.values())y+=E[1];for(const E of this.glyphPerPageElementsMap.values())y+=E[1];return y/3}doDestroy(){this.iconVAO=z.disposeMaybe(this.iconVAO);this.textVAO=z.disposeMaybe(this.textVAO)}updateOpacityInfo(){if(this.opacityChanged){this.opacityChanged=!1;var y=this.iconOpacity,E=this.iconVAO.vertexBuffers.get("opacity");
0<y.length&&y.byteLength===E.usedMemory&&E.setSubData(y,0,0,y.length);y=this.textOpacity;E=this.textVAO.vertexBuffers.get("opacity");0<y.length&&y.byteLength===E.usedMemory&&E.setSubData(y,0,0,y.length)}}doPrepareForRendering(y,E,G){var K=new Uint32Array(E),M=new Int32Array(K.buffer),P=K[G++];E=f.BufferObject.createVertex(y,l.Usage.STATIC_DRAW,new Int32Array(M.buffer,4*G,P));G+=P;var q=K[G++];P=f.BufferObject.createIndex(y,l.Usage.STATIC_DRAW,new Uint32Array(K.buffer,4*G,q));G+=q;q=K[G++];M=f.BufferObject.createVertex(y,
l.Usage.STATIC_DRAW,new Int32Array(M.buffer,4*G,q));G+=q;q=K[G++];K=f.BufferObject.createIndex(y,l.Usage.STATIC_DRAW,new Uint32Array(K.buffer,4*G,q));G+=q;G=f.BufferObject.createVertex(y,l.Usage.STATIC_DRAW,this.iconOpacity.buffer);q=f.BufferObject.createVertex(y,l.Usage.STATIC_DRAW,this.textOpacity.buffer);var v=this.layer;const k=v.iconMaterial;v=v.textMaterial;this.iconVAO=new x.VertexArrayObject(y,k.getAttributeLocations(),k.getLayoutInfo(),new Map([["geometry",E],["opacity",G]]),P);this.textVAO=
new x.VertexArrayObject(y,v.getAttributeLocations(),v.getLayoutInfo(),new Map([["geometry",M],["opacity",q]]),K)}}class H extends n{constructor(y,E){super(y,E);this.type=c.BucketType.CIRCLE;this.circleIndexCount=this.circleIndexStart=0;y=new Uint32Array(y);E=this.bufferDataOffset;this.circleIndexStart=y[E++];this.circleIndexCount=y[E++];this.bufferDataOffset=E}get usedMemory(){return(this.data?.byteLength??0)+(this.vao?.usedMemory??0)}hasData(){return 0<this.circleIndexCount}triangleCount(){return this.circleIndexCount/
3}doDestroy(){this.vao=z.disposeMaybe(this.vao)}doPrepareForRendering(y,E,G){var K=new Uint32Array(E);E=new Int32Array(K.buffer);var M=K[G++];E=f.BufferObject.createVertex(y,l.Usage.STATIC_DRAW,new Int32Array(E.buffer,4*G,M));G+=M;M=K[G++];K=f.BufferObject.createIndex(y,l.Usage.STATIC_DRAW,new Uint32Array(K.buffer,4*G,M));G+=M;G=this.layer.circleMaterial;this.vao=new x.VertexArrayObject(y,G.getAttributeLocations(),G.getLayoutInfo(),new Map([["geometry",E]]),K)}}A.CircleRenderBucket=H;A.FillRenderBucket=
p;A.LineRenderBucket=m;A.RenderBucketBase=n;A.SymbolRenderBucket=C;Object.defineProperty(A,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/decluttering/util":function(){define(["exports","../enums","../GeometryUtils","./core"],function(A,z,B,e){class g{constructor(h,b,c){this._rows=Math.ceil(b/c);this._columns=Math.ceil(h/c);this._cellSize=c;this.cells=Array(this._rows);for(h=0;h<this._rows;h++)for(this.cells[h]=Array(this._columns),b=0;b<this._columns;b++)this.cells[h][b]=
[]}getCell(h,b){b=Math.min(Math.max(Math.floor(b/this._cellSize),0),this._rows-1);h=Math.min(Math.max(Math.floor(h/this._cellSize),0),this._columns-1);return this.cells[b]&&this.cells[b][h]||null}getCellSpan(h,b,c,d){return[Math.min(Math.max(Math.floor(h/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(b/this._cellSize),0),this.rows-1),Math.min(Math.max(Math.floor(c/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(d/this._cellSize),0),this.rows-1)]}get cellSize(){return this._cellSize}get columns(){return this._columns}get rows(){return this._rows}}
A.GridIndex=g;A.deserializeSymbols=function(h,b,c,d,f,l,x){const n=b[d++];for(let C=0;C<n;C++){const H=new e.VTLSymbol(l,x);H.xTile=b[d++];H.yTile=b[d++];H.hash=b[d++];H.priority=b[d++];H.featureIndex=b[d++];var m=b[d++];for(var p=0;p<m;p++){const y=b[d++],E=b[d++],G=b[d++],K=b[d++],M=!!b[d++],P=b[d++],q=c[d++],v=c[d++],k=b[d++],t=b[d++];H.colliders.push({xTile:y,yTile:E,dxPixels:G,dyPixels:K,hard:M,partIndex:P,width:k,height:t,minLod:q,maxLod:v})}m=h[d++];for(p=0;p<m;p++)H.textVertexRanges.push([h[d++],
h[d++]]);m=h[d++];for(p=0;p<m;p++)H.iconVertexRanges.push([h[d++],h[d++]]);f.push(H)}return d};A.isSearchCircleOverlapingSymbol=function(h,b,c,d){var f=h.colliders;let l,x,n;for(const m of f)if(h.unique.show&&h.unique.parts[m.partIndex].show&&(f=m.xScreen-d[0]+m.dxScreen,l=m.yScreen-d[1]+m.dyScreen,x=f+m.width,n=l+m.height,B.isCircleOverlapingRect(c,b.x,b.y,f,l,x,n)))return!0;return!1};A.tileCoordChange=function(h,b,c,d,f,l){c-=f;if(0<=c)return(b>>c)+(d-(l<<c))*(h>>c);c=-c;return b-(l-(d<<c))*(h>>
c)<<c};A.writeOpacityToBuffers=function(h,b,c){for(const [p,C]of h.symbols){{var d=h,f=b,l=c,x=C;const H=d.layerData.get(p);if(H.type===z.BucketType.SYMBOL){for(const y of x){x=y.unique;var n=void 0;if(y.selectedForRendering){var m=x.parts[0];n=m.startOpacity;m=m.targetOpacity;d.allSymbolsFadingOut=d.allSymbolsFadingOut&&0===m;n=l?Math.floor(127*n)|m<<7:m?255:0;n|=n<<24|n<<16|n<<8}else n=0;for(const [E,G]of y.iconVertexRanges)for(m=E;m<E+G;m+=4)H.iconOpacity[m/4]=n;y.selectedForRendering?(n=x.parts[1],
x=n.startOpacity,n=n.targetOpacity,d.allSymbolsFadingOut=d.allSymbolsFadingOut&&0===n,x=l?Math.floor(127*x)|n<<7:n?255:0,n=x<<24|x<<16|x<<8|x):n=0;for(const [E,G]of y.textVertexRanges)for(x=E;x<E+G;x+=4)H.textOpacity[x/4]=n}H.lastOpacityUpdate=f;H.opacityChanged=!0}}}};Object.defineProperty(A,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/decluttering/core":function(){define(["exports"],function(A){class z{constructor(e,g){this.sourceTile=g;this.hash=this.yTile=this.xTile=
0;this.priority=1;this.featureIndex=0;this.colliders=[];this.textVertexRanges=[];this.iconVertexRanges=[];this.tile=e}}class B{constructor(){this.tileSymbols=[];this.parts=[{startTime:0,startOpacity:0,targetOpacity:0,show:!1},{startTime:0,startOpacity:0,targetOpacity:0,show:!1}];this.show=!1}}A.VTLSymbol=z;A.VTLUniqueSymbol=B;Object.defineProperty(A,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/VectorTileContainer":function(){define("exports ../../../../geometry/support/aaBoundingRect ../../../../layers/support/TileInfo ./decluttering/SymbolFader ./style/StyleDefinition ../webgl/enums ../webgl/RenderableTile ../webgl/TileContainer ../../tiling/TileCoverage ../../tiling/TileKey ../../../webgl/enums".split(" "),
function(A,z,B,e,g,h,b,c,d,f,l){function x(m,p){if(m){const C=m.getLayoutProperty("visibility");if(!C||C.getValue()!==g.Visibility.NONE&&(void 0===m.minzoom||m.minzoom<p+1E-6)&&(void 0===m.maxzoom||m.maxzoom>=p-1E-6))return!0}return!1}class n extends c{constructor(m){super(m);this._backgroundTiles=[];this._computeDisplayInfoView(m)}destroy(){this.removeAllChildren();this._spriteMosaic?.dispose();this._spriteMosaic=null;this._glyphMosaic?.dispose();this._glyphMosaic=null;null!=this._symbolFader&&(this._symbolFader.clear(),
this._symbolFader=null);this._styleRepository=null;this._backgroundTiles=[]}get fading(){return this._symbolFader?.fading??!1}get symbolFader(){return this._symbolFader}get symbolRepository(){return this._symbolFader?.symbolRepository}setStyleResources(m,p,C,H){this._spriteMosaic=m;this._glyphMosaic=p;this._styleRepository=C;this.tileInfoView=H;this._computeDisplayInfoView(H);null==this._symbolFader&&(this._symbolFader=new e.SymbolFader(this._styleRepository,this.children));this._symbolFader.styleRepository=
C}setSpriteMosaic(m){this._spriteMosaic?.dispose();this._spriteMosaic=m}deleteStyleLayers(m){null!=this._symbolFader&&this._symbolFader.deleteStyleLayers(m)}createRenderParams(m){return{...super.createRenderParams(m),renderPass:null,styleLayer:null,styleLayerUID:-1,glyphMosaic:this._glyphMosaic,spriteMosaic:this._spriteMosaic,hasClipping:!!this._clippingInfos}}doRender(m){!this.visible||m.drawPhase!==h.WGLDrawPhase.MAP&&m.drawPhase!==h.WGLDrawPhase.DEBUG||void 0===this._spriteMosaic||super.doRender(m)}addChild(m){super.addChild(m);
null!=this._symbolFader?this._symbolFader.addTile(m):m.decluttered=!0;this.requestRender();return m}removeChild(m){null!=this._symbolFader&&this._symbolFader.removeTile(m);this.requestRender();return super.removeChild(m)}renderChildren(m){const {drawPhase:p}=m;p===h.WGLDrawPhase.DEBUG?super.renderChildren(m):this._doRender(m)}removeAllChildren(){for(let m=0;m<this.children.length;m++){const p=this.children[m];null!=this._symbolFader&&this._symbolFader.removeTile(p);p.dispose()}super.removeAllChildren()}getStencilTarget(){return this.children.filter(m=>
m.neededForCoverage&&m.hasData())}restartDeclutter(){null!=this._symbolFader&&this._symbolFader.restartDeclutter()}_doRender(m){const {context:p,state:C}=m;var H=this._styleRepository;if(H){var y=H.layers,E=this._displayInfo.scaleToZoom(C.scale);0<H.backgroundBucketIds.length&&(m.renderPass="background",this._renderBackgroundLayers(m,H.backgroundBucketIds,E));super.renderChildren(m);m.drawPhase===h.WGLDrawPhase.MAP&&this._fade(E,C);if((H=this.children.filter(K=>K.visible&&K.hasData()))&&0!==H.length){for(var G of H)G.triangleCount=
0;p.setStencilWriteMask(0);p.setColorMask(!0,!0,!0,!0);p.setStencilOp(l.StencilOperation.KEEP,l.StencilOperation.KEEP,l.StencilOperation.REPLACE);p.setStencilTestEnabled(!0);p.setBlendingEnabled(!1);p.setDepthTestEnabled(!0);p.setDepthWriteEnabled(!0);p.setDepthFunction(l.CompareFunction.LEQUAL);p.setClearDepth(1);p.clear(p.gl.DEPTH_BUFFER_BIT);m.renderPass="opaque";for(G=y.length-1;0<=G;G--)this._renderStyleLayer(y[G],m,H);p.setDepthWriteEnabled(!1);p.setBlendingEnabled(!0);p.setBlendFunctionSeparate(l.BlendFactor.ONE,
l.BlendFactor.ONE_MINUS_SRC_ALPHA,l.BlendFactor.ONE,l.BlendFactor.ONE_MINUS_SRC_ALPHA);m.renderPass="translucent";for(G=0;G<y.length;G++)this._renderStyleLayer(y[G],m,H);p.bindVAO();p.setStencilTestEnabled(!0);p.setBlendingEnabled(!0);for(const K of H)K.debugInfo.display.triangleCount=K.triangleCount}else p.bindVAO(),p.setStencilTestEnabled(!0),p.setBlendingEnabled(!0)}}_fade(m,p){null!=this._symbolFader&&(this._symbolFader.update(m,p)||this.requestRender())}_renderStyleLayer(m,p,C){const {displayLevel:H,
painter:y,renderPass:E}=p;if(void 0!==m){var G=m.getLayoutProperty("visibility");if(!G||G.getValue()!==g.Visibility.NONE){switch(m.type){case g.StyleLayerType.BACKGROUND:return;case g.StyleLayerType.FILL:if("opaque"!==E&&"translucent"!==p.renderPass)return;var K="vtlFill";break;case g.StyleLayerType.LINE:if("translucent"!==E)return;K="vtlLine";break;case g.StyleLayerType.CIRCLE:if("translucent"!==E)return;K="vtlCircle";break;case g.StyleLayerType.SYMBOL:if("translucent"!==E)return;K="vtlSymbol"}C=
m.type===g.StyleLayerType.SYMBOL?C.filter(M=>M.decluttered):C.filter(M=>M.neededForCoverage);if("vtlSymbol"===K||!(0===C.length||void 0!==m.minzoom&&m.minzoom>=H+1E-6||void 0!==m.maxzoom&&m.maxzoom<H-1E-6)){G=m.uid;p.styleLayerUID=G;p.styleLayer=m;for(const M of C)if(M.layerData.has(G)){y.renderObjects(p,C,K);break}}}}}_renderBackgroundLayers(m,p,C){const {context:H,painter:y,state:E}=m,G=this._styleRepository;var K=!1;for(var M of p)if(G.getLayerById(M).type===g.StyleLayerType.BACKGROUND&&x(G.getLayerById(M),
C)){K=!0;break}if(K){var P=this.tileInfoView;K=P.getTileCoverage(m.state,0,!0,"smallest");var {spans:q,lodInfo:v}=K,{level:k}=v,t=z.create();M=[];if(this._renderPasses){var u=this._renderPasses[0];null!=this._clippingInfos&&(u.brushes[0].prepareState(m),u.brushes[0].drawMany(m,this._clippingInfos))}u=this._backgroundTiles;var D=0;for(const {row:L,colFrom:J,colTo:O}of q)for(let Q=J;Q<=O;Q++){if(D<u.length){var F=u[D];F.key.set(k,L,v.normalizeCol(Q),v.getWorldForColumn(Q));P.getTileBounds(t,F.key,!1);
F.x=t[0];F.y=t[3];F.resolution=P.getTileResolution(k)}else{F=new f(k,L,v.normalizeCol(Q),v.getWorldForColumn(Q));const S=P.getTileBounds(z.create(),F),X=P.getTileResolution(k);F=new b.RenderableTile(F,X,S[0],S[3],512,512,4096,4096);u.push(F)}F.setTransform(E);M.push(F);D++}H.setStencilWriteMask(0);H.setColorMask(!0,!0,!0,!0);H.setStencilOp(l.StencilOperation.KEEP,l.StencilOperation.KEEP,l.StencilOperation.REPLACE);H.setStencilFunction(l.CompareFunction.EQUAL,0,255);H.setStencilTestEnabled(!0);for(const L of p)p=
G.getLayerById(L),p.type===g.StyleLayerType.BACKGROUND&&x(p,C)&&(m.styleLayerUID=p.uid,m.styleLayer=p,y.renderObjects(m,M,"vtlBackground"));d.pool.release(K)}}_computeDisplayInfoView(m){let p=m.tileInfo.lods[0].scale;const C=Math.max(25,m.tileInfo.lods.length),H=[];for(let y=0;y<=C;y++)H.push(p),p/=2;this._displayInfo=B.create({scales:H,size:512,spatialReference:m.spatialReference,numLODs:C})}}A.VectorTileContainer=n;Object.defineProperty(A,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/decluttering/SymbolFader":function(){define("exports ../../../../../core/signal ./config ./core ./jobs ./SymbolDeclutterer ./SymbolRepository ./util ../style/StyleDefinition".split(" "),
function(A,z,B,e,g,h,b,c,d){class f{constructor(l,x){this.styleRepository=l;this._tileToHandle=new Map;this._viewState={scale:0,rotation:0,center:[0,0],size:[0,0]};this._declutterViewState={scale:0,rotation:0,center:[0,0],size:[0,0]};this._offsetFromScreenCenter=[0,0];this._completed=!1;this._fading=z.signal(!1);this._symbolRepository=new b.SymbolRepository(4096,x,()=>new e.VTLUniqueSymbol);this._symbolDeclutterer=new h.SymbolDeclutterer(x,this._symbolRepository,(n,m,p)=>this._createCollisionJob(n,
m,p),(n,m)=>{n.allSymbolsFadingOut=!0;n.lastOpacityUpdate=m;c.writeOpacityToBuffers(n,m,!0);n.decluttered=!0;n.requestRender()},(n,m)=>this.styleRepository.getStyleLayerByUID(n.styleLayerUID).z-this.styleRepository.getStyleLayerByUID(m.styleLayerUID).z,n=>{n=this.styleRepository.getStyleLayerByUID(n);return this._zoom+1E-6<n.minzoom||this._zoom-1E-6>=n.maxzoom?!1:(n=n.getLayoutProperty("visibility"))&&n.getValue()===d.Visibility.NONE?!1:!0})}get symbolRepository(){return this._symbolRepository}_createCollisionJob(l,
x,n){this.updateDecluttererViewState();return new g.CollisionJob(l,x,n,this.styleRepository,this._zoom,this._viewState.rotation)}get fading(){return this._fading.value}get decluttererOffset(){return this._offsetFromScreenCenter}addTile(l){l.decluttered=!1;this._tileToHandle.set(l,l.on("symbols-changed",()=>{this._symbolRepository.add(l);this.restartDeclutter()}));this._symbolRepository.add(l);this.restartDeclutter()}removeTile(l){const x=this._tileToHandle.get(l);x&&(this._symbolRepository.removeTile(l),
this.restartDeclutter(),x.remove(),this._tileToHandle.delete(l))}update(l,x){this._zoom=l;this._viewState={scale:x.scale,rotation:x.rotation,center:[x.center[0],x.center[1]],size:[x.size[0],x.size[1]]};l=[0,0];x.toScreen(l,x.center);const n=[0,0];x.toScreen(n,this._declutterViewState.center);this._offsetFromScreenCenter[0]=l[0]-n[0];this._offsetFromScreenCenter[1]=l[1]-n[1];this._continueDeclutter();return this._completed}restartDeclutter(){this._completed=!1;this._symbolDeclutterer.restart();this._notifyUnstable()}clear(){this._completed=
!1;this._symbolRepository=null;this._symbolDeclutterer.restart();this._tileToHandle.forEach(l=>l.remove());this._tileToHandle.clear()}get stale(){return this._zoom!==this._declutterZoom||this._viewState.size[0]!==this._declutterViewState.size[0]||this._viewState.size[1]!==this._declutterViewState.size[1]||this._viewState.scale!==this._declutterViewState.scale||this._viewState.rotation!==this._declutterViewState.rotation}deleteStyleLayers(l){this._symbolRepository.deleteStyleLayers(l)}_continueDeclutter(){if(!this._completed||
this.stale)this._symbolDeclutterer.running||(this.updateDecluttererViewState(),this._symbolDeclutterer.restart()),this._symbolDeclutterer.setScreenSize(this._viewState.size[0],this._viewState.size[1]),(this._completed=this._symbolDeclutterer.continue(B.declutterBudget))&&this._scheduleNotifyStable()}_scheduleNotifyStable(){null!=this._stableNotificationHandle&&clearTimeout(this._stableNotificationHandle);this._stableNotificationHandle=setTimeout(()=>{this._stableNotificationHandle=null;this._fading.value=
!1},1.5*B.fadeDuration)}_notifyUnstable(){null!=this._stableNotificationHandle&&(clearTimeout(this._stableNotificationHandle),this._stableNotificationHandle=null);this._fading.value=!0}updateDecluttererViewState(){this._declutterZoom=this._zoom;this._declutterViewState.center[0]=this._viewState.center[0];this._declutterViewState.center[1]=this._viewState.center[1];this._declutterViewState.rotation=this._viewState.rotation;this._declutterViewState.scale=this._viewState.scale;this._declutterViewState.size[0]=
this._viewState.size[0];this._declutterViewState.size[1]=this._viewState.size[1];this._offsetFromScreenCenter[0]=0;this._offsetFromScreenCenter[1]=0}}A.SymbolFader=f;Object.defineProperty(A,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/decluttering/jobs":function(){define(["exports","../../../../../core/libs/gl-matrix-2/factories/mat3f32","./config","./util","../style/StyleDefinition"],function(A,z,B,e,g){class h{constructor(b,c,d,f,l,x){this._symbols=b;this._styleRepository=
f;this._zoom=l;this._currentSymbolCursor=this._currentLayerCursor=0;this._styleProps=new Map;this._allNeededMatrices=new Map;this._gridIndex=new e.GridIndex(c,d,B.collisionGridCellSize);this._si=Math.sin(Math.PI*x/180);this._co=Math.cos(Math.PI*x/180);for(const n of b)for(const m of n.symbols)this._allNeededMatrices.has(m.tile)||this._allNeededMatrices.set(m.tile,z.clone(m.tile.transforms.tileUnitsToPixels))}work(b){const c=this._gridIndex,d=performance.now();for(;this._currentLayerCursor<this._symbols.length;this._currentLayerCursor++,
this._currentSymbolCursor=0){const G=this._symbols[this._currentLayerCursor],K=this._getProperties(G.styleLayerUID);for(;this._currentSymbolCursor<G.symbols.length;this._currentSymbolCursor++){if(99===this._currentSymbolCursor%100&&performance.now()-d>b)return!1;var f=G.symbols[this._currentSymbolCursor];if(!f.unique.show)continue;var l=f,x=this._si,n=this._co,m=this._allNeededMatrices.get(f.tile),p=this._zoom;const {iconRotationAlignment:M,textRotationAlignment:P,iconTranslate:q,iconTranslateAnchor:v,
textTranslate:k,textTranslateAnchor:t}=K;var C=0;for(const J of l.colliders){const [O,Q]=0===J.partIndex?q:k;var H=0===J.partIndex?v:t,y=J.minLod<=p&&p<=J.maxLod;C+=y?0:1;J.enabled=y;J.xScreen=J.xTile*m[0]+J.yTile*m[3]+m[6];J.yScreen=J.xTile*m[1]+J.yTile*m[4]+m[7];H===g.TranslateAnchor.MAP?(J.xScreen+=n*O-x*Q,J.yScreen+=x*O+n*Q):(J.xScreen+=O,J.yScreen+=Q);g.RotationAlignment.VIEWPORT===(0===J.partIndex?M:P)?(J.dxScreen=J.dxPixels,J.dyScreen=J.dyPixels):(J.dxScreen=n*(J.dxPixels+J.width/2)-x*(J.dyPixels+
J.height/2)-J.width/2,J.dyScreen=x*(J.dxPixels+J.width/2)+n*(J.dyPixels+J.height/2)-J.height/2)}0<l.colliders.length&&C===l.colliders.length&&(l.unique.show=!1);l=f.unique;if(!l.show)continue;const {iconAllowOverlap:u,iconIgnorePlacement:D,textAllowOverlap:F,textIgnorePlacement:L}=K;for(const J of f.colliders)if(J.enabled&&(x=l.parts[J.partIndex],x.show)){if(n=!(J.partIndex?F:u))a:{n=J.xScreen+J.dxScreen;m=J.yScreen+J.dyScreen;p=n+J.width;C=m+J.height;const [O,Q,S,X]=c.getCellSpan(n,m,p,C);for(H=
Q;H<=X;H++)for(y=O;y<=S;y++){var E=c.cells[H][y];for(const W of E){E=W.xScreen+W.dxScreen;const Z=W.yScreen+W.dyScreen,ca=E+W.width,Y=Z+W.height;if(!(p<E||n>ca||C<Z||m>Y)){n=!0;break a}}}n=!1}n&&(J.hard?l.show=!1:x.show=!1)}if(l.show)for(const J of f.colliders){if(!J.enabled)continue;if(J.partIndex?L:D)continue;if(!l.parts[J.partIndex].show)continue;f=J.xScreen+J.dxScreen;x=J.yScreen+J.dyScreen;const [O,Q,S,X]=this._gridIndex.getCellSpan(f,x,f+J.width,x+J.height);for(f=Q;f<=X;f++)for(x=O;x<=S;x++)this._gridIndex.cells[f][x].push(J)}}}return!0}_getProperties(b){var c=
this._styleProps.get(b);if(c)return c;c=this._zoom;const d=this._styleRepository.getStyleLayerByUID(b);var f=d.getLayoutValue("symbol-placement",c)!==g.SymbolPlacement.POINT;let l=d.getLayoutValue("icon-rotation-alignment",c);l===g.RotationAlignment.AUTO&&(l=f?g.RotationAlignment.MAP:g.RotationAlignment.VIEWPORT);let x=d.getLayoutValue("text-rotation-alignment",c);x===g.RotationAlignment.AUTO&&(x=f?g.RotationAlignment.MAP:g.RotationAlignment.VIEWPORT);f=d.getPaintValue("icon-translate",c);const n=
d.getPaintValue("icon-translate-anchor",c),m=d.getPaintValue("text-translate",c),p=d.getPaintValue("text-translate-anchor",c);c={iconAllowOverlap:d.getLayoutValue("icon-allow-overlap",c),iconIgnorePlacement:d.getLayoutValue("icon-ignore-placement",c),textAllowOverlap:d.getLayoutValue("text-allow-overlap",c),textIgnorePlacement:d.getLayoutValue("text-ignore-placement",c),iconRotationAlignment:l,textRotationAlignment:x,iconTranslateAnchor:n,iconTranslate:f,textTranslateAnchor:p,textTranslate:m};this._styleProps.set(b,
c);return c}}A.CollisionJob=h;Object.defineProperty(A,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/decluttering/SymbolDeclutterer":function(){define(["exports","./config"],function(A,z){function B(g,h){if(g.priority-h.priority)return g.priority-h.priority;const b=g.tile.key,c=h.tile.key;return b.world-c.world?b.world-c.world:b.level-c.level?b.level-c.level:b.row-c.row?b.row-c.row:b.col-c.col?b.col-c.col:g.xTile-h.xTile?g.xTile-h.xTile:g.yTile-h.yTile}class e{get running(){return this._running}constructor(g,
h,b,c,d,f){this._visibleTiles=g;this._symbolRepository=h;this._createCollisionJob=b;this._assignTileSymbolsOpacity=c;this._symbolLayerSorter=d;this._isLayerVisible=f;this._selectionJob=null;this._selectionJobCompleted=!1;this._collisionJob=null;this._collisionJobCompleted=!1;this._opacityJob=null;this._opacityJobCompleted=!1;this._running=!0}setScreenSize(g,h){this._screenWidth===g&&this._screenHeight===h||this.restart();this._screenWidth=g;this._screenHeight=h}restart(){this._selectionJob=null;this._selectionJobCompleted=
!1;this._collisionJob=null;this._collisionJobCompleted=!1;this._opacityJob=null;this._opacityJobCompleted=!1;this._running=!0}continue(g){this._selectionJob||(this._selectionJob=this._createSelectionJob());if(!this._selectionJobCompleted){var h=performance.now();if(!this._selectionJob.work(g))return!1;this._selectionJobCompleted=!0;g=Math.max(0,g-(performance.now()-h));if(0===g)return!1}this._collisionJob||(this._collisionJob=this._createCollisionJob(this._selectionJob.sortedSymbols,this._screenWidth,
this._screenHeight));if(!this._collisionJobCompleted){h=performance.now();if(!this._collisionJob.work(g))return!1;this._collisionJobCompleted=!0;g=Math.max(0,g-(performance.now()-h));if(0===g)return!1}this._opacityJob||(this._opacityJob=this._createOpacityJob());if(!this._opacityJobCompleted){h=performance.now();if(!this._opacityJob.work(g))return!1;this._opacityJobCompleted=!0;g=Math.max(0,g-(performance.now()-h));if(0===g)return!1}this._running=!1;return!0}_createSelectionJob(){const g=this._symbolRepository.uniqueSymbols;
for(let l=0;l<g.length;l++){const x=g[l];for(let n=0;n<x.uniqueSymbols.length;n++){const m=x.uniqueSymbols[n];for(const p of m.tileSymbols)p.selectedForRendering=!1}}const h=[];let b=0,c=0;const d=this._isLayerVisible,f=this._symbolLayerSorter;return{work:function(l){const x=performance.now();for(;c<g.length;c++,b=0){const m=g[c];var n=m.styleLayerUID;if(!d(n)){h[c]||(h[c]={styleLayerUID:n,symbols:[]});continue}h[c]=h[c]||{styleLayerUID:n,symbols:[]};const p=h[c];for(;b<m.uniqueSymbols.length;b++){n=
m.uniqueSymbols[b];if(99===b%100&&performance.now()-x>l)return!1;let C=null,H=!1,y=!1;for(const E of n.tileSymbols)if(!y||!H){const G=E.tile;if(!C||G.isCoverage||G.neededForCoverage&&!H){C=E;if(G.neededForCoverage||G.isCoverage)y=!0;G.isCoverage&&(H=!0)}}C.selectedForRendering=!0;if(y){p.symbols.push(C);n.show=!0;for(const E of n.parts)E.show=!0}else n.show=!1}}for(const m of h)m.symbols.sort(B);return!0},get sortedSymbols(){return h.sort(f)}}}_createOpacityJob(){function g(d,f){for(const n of d.symbols.values()){var l=
n,x=f;for(const m of l){l=m.unique;for(const p of l.parts)p.startOpacity+=(x-p.startTime)/z.fadeDuration*(.5<p.targetOpacity?1:-1),p.startOpacity=Math.min(Math.max(p.startOpacity,0),1),p.startTime=x,p.targetOpacity=l.show&&p.show?1:0}}h(d,f);for(const n of d.childrenTiles)g(n,f)}const h=this._assignTileSymbolsOpacity,b=this._visibleTiles;let c=0;return{work(d){const f=performance.now();for(;c<b.length;c++){if(performance.now()-f>d)return!1;const l=b[c];if(null!=l.parentTile)continue;const x=performance.now();
g(l,x)}return!0}}}}A.SymbolDeclutterer=e;Object.defineProperty(A,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/decluttering/SymbolRepository":function(){define(["exports","./util"],function(A,z){class B{constructor(e,g,h){this.tileCoordRange=e;this._visibleTiles=g;this._createUnique=h;this._tiles=new Map;this._uniqueSymbolsReferences=new Map}get uniqueSymbols(){null==this._uniqueSymbolLayerArray&&(this._uniqueSymbolLayerArray=this._createUniqueSymbolLayerArray());return this._uniqueSymbolLayerArray}get uniqueSymbolsReferences(){return this._uniqueSymbolsReferences}add(e,
g){this._uniqueSymbolLayerArray=null;let h=this._tiles.get(e.id);h||(h={symbols:new Map},this._tiles.set(e.id,h));var b=new Map;if(g)for(var c of g)h.symbols.has(c)&&(b.set(c,h.symbols.get(c)),h.symbols.delete(c));else for(var [d]of e.layerData)h.symbols.has(d)&&(b.set(d,h.symbols.get(d)),h.symbols.delete(d));this._removeSymbols(b);g=e.symbols;b=new Map;for(const [f,l]of g)if(c=l.length,32<=c){d=this.tileCoordRange;do d/=2,c/=4;while(8<c&&64<d);c=new z.GridIndex(this.tileCoordRange,this.tileCoordRange,
d);b.set(f,{flat:l,index:c});h.symbols.set(f,{flat:l,index:c});for(const x of l)c.getCell(x.xTile,x.yTile).push(x)}else b.set(f,{flat:l}),h.symbols.set(f,{flat:l});this._addSymbols(e.key,g)}deleteStyleLayers(e){this._uniqueSymbolLayerArray=null;for(const [g,h]of this._tiles){const b=new Map;for(const c of e)h.symbols.has(c)&&(b.set(c,h.symbols.get(c)),h.symbols.delete(c));this._removeSymbols(b);0===h.symbols.size&&this._tiles.delete(g)}}removeTile(e){this._uniqueSymbolLayerArray=null;const g=this._tiles.get(e.id);
if(g){var h=new Map;for(const [b]of e.symbols)g.symbols.has(b)&&(h.set(b,g.symbols.get(b)),g.symbols.delete(b));this._removeSymbols(h);0===g.symbols.size&&this._tiles.delete(e.id)}}querySymbols(e,g,h,b){b=[];var c=this.uniqueSymbols;for(const f of c){c=f.styleLayerUID;var d=f.uniqueSymbols;for(const l of d)(d=l.tileSymbols.find(x=>x.selectedForRendering))&&z.isSearchCircleOverlapingSymbol(d,e,g*(window.devicePixelRatio||1),h)&&b.push({vtlSymbol:d,styleLayerUID:c,tileKey:d.tile.key})}return b}_removeSymbols(e){for(const [h,
{flat:b}]of e)for(const c of b){e=c.unique;var g=e.tileSymbols;const d=g.length-1;for(let f=0;f<d;f++)if(g[f]===c){g[f]=g[d];break}g.length=d;0===d&&(g=this._uniqueSymbolsReferences.get(h),g.delete(e),0===g.size&&this._uniqueSymbolsReferences.delete(h));c.unique=null}}_addSymbols(e,g){if(0!==g.size){var h=this._visibleTiles;for(const b of h)b.parentTile||b.key.world!==e.world||b.key.level===e.level&&!b.key.equals(e)||this._matchSymbols(b,e,g);for(const [b,c]of g)for(const d of c)null==d.unique&&(e=
this._createUnique(),d.unique=e,e.tileSymbols.push(d),g=this._uniqueSymbolsReferences.get(b),g||(g=new Set,this._uniqueSymbolsReferences.set(b,g)),g.add(e))}}_matchSymbols(e,g,h){if(e.key.level>g.level){var b=e.key.level-g.level;if(e.key.row>>b!==g.row||e.key.col>>b!==g.col)return}if(g.level>e.key.level&&(b=g.level-e.key.level,g.row>>b!==e.key.row||g.col>>b!==e.key.col))return;if(g.equals(e.key))for(var c of e.childrenTiles)this._matchSymbols(c,g,h);else{c=new Map;for(const [l,x]of h){var d=[];for(const m of x)h=
z.tileCoordChange(this.tileCoordRange,m.xTile,g.level,g.col,e.key.level,e.key.col),b=z.tileCoordChange(this.tileCoordRange,m.yTile,g.level,g.row,e.key.level,e.key.row),0<=h&&h<this.tileCoordRange&&0<=b&&b<this.tileCoordRange&&d.push({symbol:m,xTransformed:h,yTransformed:b});h=[];b=(e.key.level<g.level?1:1<<e.key.level-g.level)+20;const n=this._tiles.get(e.id).symbols.get(l);if(n){const m=n.flat;for(const p of d){var f=!1;let C;const H=p.xTransformed,y=p.yTransformed;C=null!=n.index?n.index.getCell(H,
y):m;d=p.symbol;const E=d.hash;for(const G of C)if(E===G.hash&&Math.abs(H-G.xTile)<=b&&Math.abs(y-G.yTile)<=b){f=G.unique;d.unique=f;f.tileSymbols.push(d);f=!0;break}f||h.push(d)}}0<h.length&&c.set(l,h)}for(const l of e.childrenTiles)this._matchSymbols(l,g,c)}}_createUniqueSymbolLayerArray(){var e=this._uniqueSymbolsReferences;const g=Array(e.size);let h=0;for(const [b,c]of e){const d=Array(c.size);e=0;for(const f of c)d[e++]=f;g[h]={styleLayerUID:b,uniqueSymbols:d};h++}return g}}A.SymbolRepository=
B;Object.defineProperty(A,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/RenderableTile":function(){define(["exports","../../../../core/libs/gl-matrix-2/factories/mat3f32","./TiledDisplayObject"],function(A,z,B){class e extends B.TiledDisplayObject{_createTransforms(){return{displayViewScreenMat3:z.create(),tileMat3:z.create()}}}A.RenderableTile=e;Object.defineProperty(A,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/VectorTileFeatureIndex":function(){define("../../../../Graphic ../../../../core/MapUtils ../../../../core/pbf ../../../../core/libs/rbush/PooledRBush ./enums ./Feature ./GeometryUtils ./SourceLayerData ./style/StyleLayer".split(" "),
function(A,z,B,e,g,h,b,c,d){const f=(n,m)=>{const p=n.vtlSymbol.sourceTile,C=m.vtlSymbol.sourceTile;return p.level!==C.level?p.level-C.level:p.row!==C.row?p.row-C.row:p.col!==C.col?p.col-C.col:n.styleLayerUID-m.styleLayerUID};class l{constructor(n,m,p,C,H){this.tileKey=n;this._tileLayerData=m;this._styleRepository=p;this._tileHandler=C;this._parentLayer=H;this._index=null;this._tileKeyToPBF=new Map}static create(n,m,p,C,H){return new l(n,m,p,C,H)}clear(){this._index?.clear();this._tileKeyToPBF.clear()}async queryAttributes(n,
m,p,C,H){if(0===this._tileLayerData.size||!this._styleRepository||!this._tileHandler)return[];null===this._index&&(this._index=new e.PooledRBush(100,x),await this._indexLayers());const y=[];this._queryIndex(y,n,m,p,this.tileKey.level,C);H&&0<H?.length&&await this._getSymbolsAttributes(y,H);return y}async _indexLayers(){const n=this.tileKey,m=this._styleRepository.layers,p=await this._getTilePayload(n);for(const [H,y]of this._tileLayerData){const E=m[H];var C=p.find(M=>M.sourceName===E.source);if(!C)continue;
const {protobuff:G,key:K}=C;y.type!==g.BucketType.SYMBOL&&(C=1<<n.level-K.level,this._indexLayer(E,G,n.level,C,n.row-K.row*C,n.col-K.col*C))}}_indexLayer(n,m,p,C,H,y){const E=n.sourceLayer,G=n.getFeatureFilter(),K=p+1,M=b.getTileMargins(p);for(m=new B(new Uint8Array(m),new DataView(m));m.next();)switch(m.tag()){case 3:var P=m.getMessage();const t=new c(P);P.release();if(t.name!==E)continue;P=t.getData();var q=t.extent/C;const u=q*y-M,D=q*H-M,F=u+q+2*M,L=D+q+2*M,J=q/512,O=4096/q,Q=q*y;for(q*=H;P.nextTag(2);){var v=
P.getMessage();const S=new h(v,t);v.release();if(!G||G.filter(S,p)){var k=S.values||{};v=k._minzoom;k=k._maxzoom;v&&v>=10*K||k&&k<=10*p||(v=n.getFeatureInflatedBounds(S,p,t.extent,J),null==v||v[0]>F||v[1]>L||v[2]<u||v[3]<D||(v[0]=(v[0]-Q)*O,v[1]=(v[1]-q)*O,v[2]=(v[2]-Q)*O,v[3]=(v[3]-q)*O,this._index.insert(new d.IndexItem(n,S,v,O,Q,q))))}}break;default:m.skip()}}async _getSymbolsAttributes(n,m){if(!m||0===m.length)return n;var p=[];m.sort(f);let C=m[0].styleLayerUID;var H=0;for(var y=0;y<m.length;y++)C!==
m[y].styleLayerUID&&(p.push({from:H,to:y,styleLayerUID:C,sourceTileKey:m[y].vtlSymbol.sourceTile}),H=y,C=m[y].styleLayerUID);p.push({from:H,to:m.length,styleLayerUID:C,sourceTileKey:m[m.length-1].vtlSymbol.sourceTile});H=this._styleRepository.layers;y=null;let E;for(const G of p)p=await this._getTilePayload(G.sourceTileKey),E=H[G.styleLayerUID],(y=!!E&&p.find(K=>K.sourceName===E.source))&&this._addSymbolsAttributes(n,m.slice(G.from,G.to).map(K=>K.vtlSymbol),C,y);return n}_addSymbolsAttributes(n,m,
p,C){const H=this._styleRepository.layers,y=C.key,E=this.tileKey,G=1<<E.level-y.level;this._getSymbolAttributes(C.protobuff,m,p,G,E.row-y.row*G,E.col-y.col*G).forEach(K=>{const {attributes:M,tilePoint:P}=K;n.push({layerId:H[p].id,layerIndex:p,graphic:new A({attributes:M,origin:{type:"vector-tile",layerId:H[p].id,layerIndex:p,layer:this._parentLayer}}),tilePoint:P})})}_getSymbolAttributes(n,m,p,C,H,y){const E=[],G=this._styleRepository.layers;let K=0;m.sort((v,k)=>v.featureIndex-k.featureIndex);for(n=
new B(new Uint8Array(n),new DataView(n));n.next();)switch(n.tag()){case 3:var M=n.getMessage();const v=new c(M);M.release();if(v.name!==G[p].sourceLayer)continue;M=v.getData();var P=v.extent/C;const k=4096/P,t=P*y;P*=H;let u=0;for(;M.nextTag(2);){const D=M.getMessage();if(u++===m[K].featureIndex){var q=new h(D,v);const F=q.values;q=q.getGeometry();E.push({attributes:F,tilePoint:null!=q?[k*(q[0][0].x-t),k*(q[0][0].y-P)]:null});K++}D.release();if(K===m.length)return E}break;default:n.skip()}return E}_queryIndex(n,
m,p,C,H,y){const E=8*C*(window.devicePixelRatio||1);this._index?.search({minX:m-E,minY:p-E,maxX:m+E,maxY:p+E},G=>{const {layer:K,feature:M}=G;K.isIntersectingFeature(m,p,C,M,H,y,G)&&n.push({layerId:K.id,layerIndex:K.uid,tilePoint:null,graphic:new A({attributes:M.values,origin:{type:"vector-tile",layerId:G.layer.id,layerIndex:G.layer.uid,layer:this._parentLayer}})})});return n}async _getTilePayload(n){return z.getOrCreateMapValue(this._tileKeyToPBF,n.id,()=>this._tileHandler.fetchTilePBFs(n)).then(m=>
m)}}const x=n=>({minX:n.bounds[0],minY:n.bounds[1],maxX:n.bounds[2],maxY:n.bounds[3]});return l})},"esri/core/libs/rbush/PooledRBush":function(){define(["exports","../../arrayUtils","../../has","../../PooledArray","../../../chunks/quickselect"],function(A,z,B,e,g){function h(k,t){for(E.clear();k;){if(!0===k.leaf)for(const u of k.children)t(u);else E.pushArray(k.children);k=E.pop()??null}}function b(k,t){c(k,0,k.children.length,t,k)}function c(k,t,u,D,F){F||=new q([]);F.minX=Infinity;F.minY=Infinity;
F.maxX=-Infinity;F.maxY=-Infinity;for(let L=t,J;L<u;L++)J=k.children[L],d(F,k.leaf?D(J):J);return F}function d(k,t){k.minX=Math.min(k.minX,t.minX);k.minY=Math.min(k.minY,t.minY);k.maxX=Math.max(k.maxX,t.maxX);k.maxY=Math.max(k.maxY,t.maxY)}function f(k,t){return k.minX-t.minX}function l(k,t){return k.minY-t.minY}function x(k){return(k.maxX-k.minX)*(k.maxY-k.minY)}function n(k){return k.maxX-k.minX+(k.maxY-k.minY)}function m(k,t){return k.minX<=t.minX&&k.minY<=t.minY&&t.maxX<=k.maxX&&t.maxY<=k.maxY}
function p(k,t){return t.minX<=k.maxX&&t.minY<=k.maxY&&t.maxX>=k.minX&&t.maxY>=k.minY}function C(k,t,u,D,F){for(t=[t,u];t.length;){u=t.pop();const L=t.pop();if(u-L<=D)continue;const J=L+Math.ceil((u-L)/D/2)*D;g.quickselect(k,J,L,u,F);t.push(L,J,J,u)}}class H{constructor(k=9,t){this._compareMinX=f;this._compareMinY=l;this._toBBox=u=>u;this._maxEntries=Math.max(4,k||9);this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries));t&&("function"===typeof t?this._toBBox=t:this._initFormat(t));this.clear()}destroy(){this.clear();
y.prune();E.prune();G.prune();K.prune()}all(k){h(this._data,k)}search(k,t){let u=this._data;const D=this._toBBox;if(p(k,u))for(y.clear();u;){for(let F=0,L=u.children.length;F<L;F++){const J=u.children[F],O=u.leaf?D(J):J;p(k,O)&&(u.leaf?t(J):m(k,O)?h(J,t):y.push(J))}u=y.pop()}}collides(k){let t=this._data;const u=this._toBBox;if(!p(k,t))return!1;for(y.clear();t;){for(let D=0,F=t.children.length;D<F;D++){const L=t.children[D],J=t.leaf?u(L):L;if(p(k,J)){if(t.leaf||m(k,J))return!0;y.push(L)}}t=y.pop()}return!1}load(k){if(!k.length)return this;
if(k.length<this._minEntries){for(let t=0,u=k.length;t<u;t++)this.insert(k[t]);return this}k=this._build(k.slice(),0,k.length-1,0);if(this._data.children.length)if(this._data.height===k.height)this._splitRoot(this._data,k);else{if(this._data.height<k.height){const t=this._data;this._data=k;k=t}this._insert(k,this._data.height-k.height-1,!0)}else this._data=k;return this}insert(k){k&&this._insert(k,this._data.height-1);return this}clear(){this._data=new q([]);return this}remove(k){if(!k)return this;
let t=this._data,u=null,D=0,F=!1,L;const J=this._toBBox(k);G.clear();for(K.clear();t||0<G.length;){t||(t=G.pop(),u=G.data[G.length-1],D=K.pop()??0,F=!0);if(t.leaf&&(L=z.indexOf(t.children,k,t.children.length,t.indexHint),-1!==L)){t.children.splice(L,1);G.push(t);this._condense(G);break}F||t.leaf||!m(t,J)?u?(D++,t=u.children[D],F=!1):t=null:(G.push(t),K.push(D),D=0,u=t,t=t.children[0])}return this}toJSON(){return this._data}fromJSON(k){this._data=k;return this}_build(k,t,u,D){var F=u-t+1,L=this._maxEntries;
if(F<=L)return k=new q(k.slice(t,u+1)),b(k,this._toBBox),k;D||(D=Math.ceil(Math.log(F)/Math.log(L)),L=Math.ceil(F/L**(D-1)));const J=new v([]);J.height=D;F=Math.ceil(F/L);L=F*Math.ceil(Math.sqrt(L));for(C(k,t,u,L,this._compareMinX);t<=u;t+=L){const O=Math.min(t+L-1,u);C(k,t,O,F,this._compareMinY);for(let Q=t;Q<=O;Q+=F)J.children.push(this._build(k,Q,Math.min(Q+F-1,O),D-1))}b(J,this._toBBox);return J}_insert(k,t,u){var D=this._toBBox;u=u?k:D(k);G.clear();D=this._data;for(var F=t,L=G;;){L.push(D);if(!0===
D.leaf||L.length-1===F)break;let J=Infinity,O=Infinity,Q=void 0;for(let S=0,X=D.children.length;S<X;S++){const W=D.children[S],Z=x(W),ca=(Math.max(W.maxX,u.maxX)-Math.min(W.minX,u.minX))*(Math.max(W.maxY,u.maxY)-Math.min(W.minY,u.minY))-Z;ca<O?(O=ca,J=Z<J?Z:J,Q=W):ca===O&&Z<J&&(J=Z,Q=W)}D=Q||D.children[0]}D.children.push(k);for(d(D,u);0<=t;)if(G.data[t].children.length>this._maxEntries)this._split(G,t),t--;else break;for(k=G;0<=t;t--)d(k.data[t],u)}_split(k,t){const u=k.data[t];var D=u.children.length;
const F=this._minEntries;this._chooseSplitAxis(u,F,D);if(D=this._chooseSplitIndex(u,F,D))D=u.children.splice(D,u.children.length-D),D=u.leaf?new q(D):new v(D),D.height=u.height,b(u,this._toBBox),b(D,this._toBBox),t?k.data[t-1].children.push(D):this._splitRoot(u,D)}_splitRoot(k,t){this._data=new v([k,t]);this._data.height=k.height+1;b(this._data,this._toBBox)}_chooseSplitIndex(k,t,u){let D,F,L=void 0;D=F=Infinity;for(let O=t;O<=u-t;O++){var J=c(k,0,O,this._toBBox);const Q=c(k,O,u,this._toBBox),S=Math.max(0,
Math.min(J.maxX,Q.maxX)-Math.max(J.minX,Q.minX))*Math.max(0,Math.min(J.maxY,Q.maxY)-Math.max(J.minY,Q.minY));J=x(J)+x(Q);S<D?(D=S,L=O,F=J<F?J:F):S===D&&J<F&&(F=J,L=O)}return L}_chooseSplitAxis(k,t,u){const D=k.leaf?this._compareMinX:f,F=k.leaf?this._compareMinY:l,L=this._allDistMargin(k,t,u,D);t=this._allDistMargin(k,t,u,F);L<t&&k.children.sort(D)}_allDistMargin(k,t,u,D){k.children.sort(D);D=this._toBBox;var F=c(k,0,t,D);const L=c(k,u-t,u,D);let J=n(F)+n(L);for(let O=t;O<u-t;O++){const Q=k.children[O];
d(F,k.leaf?D(Q):Q);J+=n(F)}for(u=u-t-1;u>=t;u--)F=k.children[u],d(L,k.leaf?D(F):F),J+=n(L);return J}_condense(k){for(let t=k.length-1;0<=t;t--){const u=k.data[t];if(0===u.children.length)if(0<t){const D=k.data[t-1],F=D.children;F.splice(z.indexOf(F,u,F.length,D.indexHint),1)}else this.clear();else b(u,this._toBBox)}}_initFormat(k){const t=["return a"," - b",";"];this._compareMinX=new Function("a","b",t.join(k[0]));this._compareMinY=new Function("a","b",t.join(k[1]));this._toBBox=new Function("a",
"return {minX: a"+k[0]+", minY: a"+k[1]+", maxX: a"+k[2]+", maxY: a"+k[3]+"};")}}const y=new e,E=new e,G=new e,K=new e({deallocator:void 0});class M{constructor(){this.minY=this.minX=Infinity;this.maxY=this.maxX=-Infinity}}class P extends M{constructor(){super(...arguments);this.height=1;this.indexHint=new z.PositionHint}}class q extends P{constructor(k){super();this.children=k;this.leaf=!0}}class v extends P{constructor(k){super();this.children=k;this.leaf=!1}}A.BBox=M;A.PooledRBush=H;Object.defineProperty(A,
Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/Feature":function(){define(["../../../../geometry/support/TileClipper"],function(A){var z;(function(e){e[e.moveTo=1]="moveTo";e[e.lineTo=2]="lineTo";e[e.close=7]="close"})(z||={});class B{constructor(e,g,h=0){this.values={};this._geometry=void 0;this._pbfGeometry=null;this.featureIndex=h;h=g.keys;g=g.values;for(e=e.asUnsafe();e.next();)switch(e.tag()){case 1:this.id=e.getUInt64();break;case 2:const b=e.getMessage().asUnsafe(),
c=this.values;for(;!b.empty();){const d=b.getUInt32(),f=b.getUInt32();c[h[d]]=g[f]}b.release();break;case 3:this.type=e.getUInt32();break;case 4:this._pbfGeometry=e.getMessage();break;default:e.skip()}}getGeometry(e){if(void 0!==this._geometry)return this._geometry;if(!this._pbfGeometry)return null;const g=this._pbfGeometry.asUnsafe();this._pbfGeometry=null;let h,b;e?e.reset(this.type):h=[];let c=z.moveTo;var d=0;let f=0,l=0;for(;!g.empty();)switch(0===d&&(d=g.getUInt32(),c=d&7,d>>=3),d--,c){case z.moveTo:f+=
g.getSInt32();l+=g.getSInt32();e?e.moveTo(f,l):h&&(b&&h.push(b),b=[],b.push(new A.Point(f,l)));break;case z.lineTo:f+=g.getSInt32();l+=g.getSInt32();e?e.lineTo(f,l):b&&b.push(new A.Point(f,l));break;case z.close:e?e.close():b&&!b[0].equals(f,l)&&b.push(b[0].clone());break;default:throw g.release(),Error("Invalid path operation");}let x;e?x=e.result():h&&(b&&h.push(b),x=h);g.release();return this._geometry=x}}return B})},"esri/views/2d/engine/vectorTiles/SourceLayerData":function(){define(function(){class A{constructor(z){this.extent=
4096;this.keys=[];this.values=[];this._pbfLayer=z.clone();for(z=z.asUnsafe();z.next();)switch(z.tag()){case 1:this.name=z.getString();break;case 3:this.keys.push(z.getString());break;case 4:this.values.push(z.processMessage(A._parseValue));break;case 5:this.extent=z.getUInt32();break;default:z.skip()}}getData(){return this._pbfLayer}static _parseValue(z){for(;z.next();)switch(z.tag()){case 1:return z.getString();case 2:return z.getFloat();case 3:return z.getDouble();case 4:return z.getInt64();case 5:return z.getUInt64();
case 6:return z.getSInt64();case 7:return z.getBool();default:z.skip()}return null}}return A})},"esri/views/2d/engine/vectorTiles/style/StyleLayer":function(){define("exports ../../../../../geometry/support/aaBoundingRect ../enums ../GeometryUtils ../shaders/VTLBackgroundMaterial ../shaders/VTLCircleMaterial ../shaders/VTLFillMaterial ../shaders/VTLLineMaterial ../shaders/VTLSymbolMaterial ./Filter ./StyleDefinition ./StyleProperty ../../webgl/definitions".split(" "),function(A,z,B,e,g,h,b,c,d,f,
l,x,n){function m(q){q=q?.getGeometry();if(null==q)return null;let v=Infinity,k=Infinity,t=-Infinity,u=-Infinity;for(const D of q)if(D)for(const F of D)v=Math.min(v,F.x),k=Math.min(k,F.y),t=Math.max(t,F.x),u=Math.max(u,F.y);return z.fromValues(v,k,t,u)}A.CapType=void 0;(function(q){q[q.BUTT=0]="BUTT";q[q.ROUND=1]="ROUND";q[q.SQUARE=2]="SQUARE";q[q.UNKNOWN=4]="UNKNOWN"})(A.CapType||(A.CapType={}));class p{constructor(q,v,k,t,u,D){this.layer=q;this.feature=v;this.bounds=k;this.normalizationRatio=t;
this.normalizationOffsetX=u;this.normalizationOffsetY=D}}class C{constructor(q,v,k,t){this.type=q;this.typeName=v.type;this.id=v.id;this.source=v.source;this.sourceLayer=v["source-layer"];this.minzoom=v.minzoom;this.maxzoom=v.maxzoom;this.filter=v.filter;this.layout=v.layout;this.paint=v.paint;this.z=k;this.uid=t;switch(q){case l.StyleLayerType.BACKGROUND:this._layoutDefinition=l.StyleDefinition.backgroundLayoutDefinition;this._paintDefinition=l.StyleDefinition.backgroundPaintDefinition;break;case l.StyleLayerType.FILL:this._layoutDefinition=
l.StyleDefinition.fillLayoutDefinition;this._paintDefinition=l.StyleDefinition.fillPaintDefinition;break;case l.StyleLayerType.LINE:this._layoutDefinition=l.StyleDefinition.lineLayoutDefinition;this._paintDefinition=l.StyleDefinition.linePaintDefinition;break;case l.StyleLayerType.SYMBOL:this._layoutDefinition=l.StyleDefinition.symbolLayoutDefinition;this._paintDefinition=l.StyleDefinition.symbolPaintDefinition;break;case l.StyleLayerType.CIRCLE:this._layoutDefinition=l.StyleDefinition.circleLayoutDefinition,
this._paintDefinition=l.StyleDefinition.circlePaintDefinition}this._layoutProperties=this._parseLayout(this.layout);this._paintProperties=this._parsePaint(this.paint)}getFeatureFilter(){return void 0!==this._featureFilter?this._featureFilter:this._featureFilter=f.createFilter(this.filter)}getLayoutProperty(q){return this._layoutProperties[q]}getPaintProperty(q){return this._paintProperties[q]}getLayoutValue(q,v,k){let t;const u=this._layoutProperties[q];u&&(t=u.getValue(v,k));void 0===t&&(t=this._layoutDefinition[q]["default"]);
return t}getPaintValue(q,v,k){let t;const u=this._paintProperties[q];u&&(t=u.getValue(v,k));void 0===t&&(t=this._paintDefinition[q]["default"]);return t}isPainterDataDriven(){const q=this._paintProperties;if(q)for(const v in q)if(q[v].isDataDriven)return!0;return!1}isIntersectingFeature(q,v,k,t,u,D,F){return!1}getFeatureInflatedBounds(q,v,k,t){return null}_parseLayout(q){const v={};for(const k in q){const t=this._layoutDefinition[k];t&&(v[k]=new x(t,q[k]))}return v}_parsePaint(q){const v={};for(const k in q){const t=
this._paintDefinition[k];t&&(v[k]=new x(t,q[k]))}return v}computeAttributesKey(q,v,k,t){let u=0,D=0;for(const F of v){v=3;if(!F||F!==t){const {isLayout:L,isOptional:J}=k[F];v=L?this.getLayoutProperty(F):this.getPaintProperty(F);v=v?.interpolator?2:v?.isDataDriven?1:J&&!v?3:0}D|=v<<u;u+=2}return D<<3|q}}class H extends C{constructor(q,v,k,t){super(q,v,k,t);this.backgroundMaterial=new g.VTLBackgroundMaterial(this.computeAttributesKey(B.ShaderProgramType.BACKGROUND,g.VTLBackgroundMaterial.ATTRIBUTES,
g.VTLBackgroundMaterial.ATTRIBUTES_INFO))}}class y extends C{constructor(q,v,k,t){super(q,v,k,t);q=this.getPaintProperty("fill-color");v=this.getPaintProperty("fill-opacity");k=this.getPaintProperty("fill-pattern");this.hasDataDrivenColor=q?.isDataDriven;this.hasDataDrivenOpacity=v?.isDataDriven;this.hasDataDrivenFill=this.hasDataDrivenColor||this.hasDataDrivenOpacity||k?.isDataDriven;v=this.getPaintProperty("fill-outline-color");this.outlineUsesFillColor=!v;this.hasDataDrivenOutlineColor=v?.isDataDriven;
this.hasDataDrivenOutline=v?v.isDataDriven:q?q.isDataDriven:!1;this.hasDataDrivenOutline=(v?this.hasDataDrivenOutlineColor:this.hasDataDrivenColor)||this.hasDataDrivenOpacity;this.fillMaterial=new b.VTLFillMaterial(this.computeAttributesKey(B.ShaderProgramType.FILL,b.VTLFillMaterial.ATTRIBUTES,b.VTLFillMaterial.ATTRIBUTES_INFO));this.outlineMaterial=new b.VTLOutlineMaterial(this.computeAttributesKey(B.ShaderProgramType.OUTLINE,this.outlineUsesFillColor?b.VTLOutlineMaterial.ATTRIBUTES_FILL:b.VTLOutlineMaterial.ATTRIBUTES_OUTLINE,
this.outlineUsesFillColor?b.VTLOutlineMaterial.ATTRIBUTES_INFO_FILL:b.VTLOutlineMaterial.ATTRIBUTES_INFO_OUTLINE),this.outlineUsesFillColor)}getFeatureInflatedBounds(q,v,k,t){k=m(q);if(!k)return null;q=this.getPaintValue("fill-translate",v,q);t*=Math.max(q[0],q[1]);k[0]-=t;k[2]-=t;k[1]+=t;k[3]+=t;return k}isIntersectingFeature(q,v,k,t,u,D,F){const L=t.getGeometry();if(!L)return!1;const J=8/F.normalizationRatio;q=q/F.normalizationRatio+F.normalizationOffsetX;v=v/F.normalizationRatio+F.normalizationOffsetY;
t=e.translateAnchor(this.getPaintValue("fill-translate",u,t),this.getPaintValue("fill-translate-anchor",u,t),D,8);q-=J*t.x;v-=J*t.y;return e.pointInPolygon(q,v,L)?!0:e.distanceFromToPolylineWithinThreshold(q,v,L,J*k)}}class E extends C{constructor(q,v,k,t){super(q,v,k,t);q=this.getPaintProperty("line-pattern");this.lineMaterial=new c.VTLLineMaterial(this.computeAttributesKey(B.ShaderProgramType.LINE,c.VTLLineMaterial.ATTRIBUTES,c.VTLLineMaterial.ATTRIBUTES_INFO,q?"line-dasharray":""));this.hasDataDrivenLine=
this.getPaintProperty("line-blur")?.isDataDriven||this.getPaintProperty("line-color")?.isDataDriven||this.getPaintProperty("line-gap-width")?.isDataDriven||this.getPaintProperty("line-offset")?.isDataDriven||this.getPaintProperty("line-opacity")?.isDataDriven||this.getPaintProperty("line-pattern")?.isDataDriven||this.getPaintProperty("line-dasharray")?.isDataDriven||this.getLayoutProperty("line-cap")?.isDataDriven||this.getPaintProperty("line-width")?.isDataDriven;this.canUseThinTessellation=!1;!this.hasDataDrivenLine&&
(q=this.getPaintProperty("line-width"),!q||"number"===typeof q&&.5*q<n.thinLineHalfWidthThreshold)&&(q=this.getPaintProperty("line-offset"),!q||"number"===typeof q&&0===q)&&(this.canUseThinTessellation=!0)}getDashKey(q,v){switch(v){case A.CapType.BUTT:v="Butt";break;case A.CapType.ROUND:v="Round";break;case A.CapType.SQUARE:v="Square";break;default:v="Butt"}return`dasharray-[${q.toString()}]-${v}`}getFeatureInflatedBounds(q,v,k,t){k=m(q);if(!k)return null;var u=this.getPaintValue("line-translate",
v,q);u=t*Math.max(u[0],u[1]);k[0]-=u;k[2]-=u;k[1]+=u;k[3]+=u;u=t*Math.abs(this.getPaintValue("line-offset",v,q)||0);q=this.getPaintValue("line-width",v,q);t*=q/2;k[0]-=u+t;k[1]-=u+t;k[2]+=u+t;k[3]+=u+t;return k}isIntersectingFeature(q,v,k,t,u,D,F){let L=t.getGeometry();if(!L)return!1;const J=8/F.normalizationRatio;q=q/F.normalizationRatio+F.normalizationOffsetX;v=v/F.normalizationRatio+F.normalizationOffsetY;D=e.translateAnchor(this.getPaintValue("line-translate",u,t),this.getPaintValue("line-translate-anchor",
u,t),D,8);q-=J*D.x;v-=J*D.y;D=J*this.getPaintValue("line-offset",u,t)||0;0!==D&&(L=e.offsetLine(L,-D));t=this.getPaintValue("line-width",u,t);return e.distanceFromToPolylineWithinThreshold(q,v,L,J*(k+t/2))}}class G extends C{constructor(q,v,k,t){super(q,v,k,t);this.iconMaterial=new d.VTLIconMaterial(this.computeAttributesKey(B.ShaderProgramType.ICON,d.VTLIconMaterial.ATTRIBUTES,d.VTLIconMaterial.ATTRIBUTES_INFO));this.textMaterial=new d.VTLTextMaterial(this.computeAttributesKey(B.ShaderProgramType.TEXT,
d.VTLTextMaterial.ATTRIBUTES,d.VTLTextMaterial.ATTRIBUTES_INFO));this.hasDataDrivenIcon=this.getPaintProperty("icon-color")?.isDataDriven||this.getPaintProperty("icon-halo-blur")?.isDataDriven||this.getPaintProperty("icon-halo-color")?.isDataDriven||this.getPaintProperty("icon-halo-width")?.isDataDriven||this.getPaintProperty("icon-opacity")?.isDataDriven||this.getLayoutProperty("icon-size")?.isDataDriven;this.hasDataDrivenText=this.getPaintProperty("text-color")?.isDataDriven||this.getPaintProperty("text-halo-blur")?.isDataDriven||
this.getPaintProperty("text-halo-color")?.isDataDriven||this.getPaintProperty("text-halo-width")?.isDataDriven||this.getPaintProperty("text-opacity")?.isDataDriven||this.getLayoutProperty("text-size")?.isDataDriven}}class K extends C{constructor(q,v,k,t){super(q,v,k,t);this.circleMaterial=new h.VTLCircleMaterial(this.computeAttributesKey(B.ShaderProgramType.CIRCLE,h.VTLCircleMaterial.ATTRIBUTES,h.VTLCircleMaterial.ATTRIBUTES_INFO))}getFeatureInflatedBounds(q,v,k,t){k=m(q);if(!k)return null;var u=
this.getPaintValue("circle-translate",v,q);u=Math.max(u[0],u[1]);k[0]-=u;k[2]-=u;k[1]+=u;k[3]+=u;q=8*(this.getPaintValue("circle-radius",v,q)+this.getPaintValue("circle-stroke-width",v,q));t*=q/2;k[0]-=t;k[1]-=t;k[2]+=t;k[3]+=t;return k}isIntersectingFeature(q,v,k,t,u,D,F){var L=t.getGeometry();if(!L)return!1;const J=8/F.normalizationRatio;q=q/F.normalizationRatio+F.normalizationOffsetX;v=v/F.normalizationRatio+F.normalizationOffsetY;k*=J;D=e.translateAnchor(this.getPaintValue("circle-translate",
u,t),this.getPaintValue("circle-translate-anchor",u,t),D,J);t=J*(this.getPaintValue("circle-radius",u,t)+this.getPaintValue("circle-stroke-width",u,t));for(const O of L)if(O)for(const Q of O)if(L=Q.x+D.x,u=Q.y+D.y,Math.sqrt((q-L)*(q-L)+(v-u)*(v-u))-k<=t)return!0;return!1}}class M{constructor(q,v,k){this.allowOverlap=q.getLayoutValue("icon-allow-overlap",v);this.ignorePlacement=q.getLayoutValue("icon-ignore-placement",v);this.keepUpright=q.getLayoutValue("icon-keep-upright",v);this.optional=q.getLayoutValue("icon-optional",
v);this.rotationAlignment=q.getLayoutValue("icon-rotation-alignment",v);this.rotationAlignment===l.RotationAlignment.AUTO&&(this.rotationAlignment=k?l.RotationAlignment.MAP:l.RotationAlignment.VIEWPORT);k=q.getLayoutProperty("icon-anchor");k?.isDataDriven?this._anchorProp=k:this.anchor=q.getLayoutValue("icon-anchor",v);k=q.getLayoutProperty("icon-offset");k?.isDataDriven?this._offsetProp=k:this.offset=q.getLayoutValue("icon-offset",v);k=q.getLayoutProperty("icon-padding");k?.isDataDriven?this._paddingProp=
k:this.padding=q.getLayoutValue("icon-padding",v);k=q.getLayoutProperty("icon-rotate");k?.isDataDriven?this._rotateProp=k:this.rotate=q.getLayoutValue("icon-rotate",v);k=q.getLayoutProperty("icon-size");k?.isDataDriven?this._sizeProp=k:this.size=q.getLayoutValue("icon-size",v)}update(q,v){this._anchorProp&&(this.anchor=this._anchorProp.getValue(q,v));this._offsetProp&&(this.offset=this._offsetProp.getValue(q,v));this._paddingProp&&(this.padding=this._paddingProp.getValue(q,v));this._rotateProp&&(this.rotate=
this._rotateProp.getValue(q,v));this._sizeProp&&(this.size=this._sizeProp.getValue(q,v))}}class P{constructor(q,v,k){this.allowOverlap=q.getLayoutValue("text-allow-overlap",v);this.ignorePlacement=q.getLayoutValue("text-ignore-placement",v);this.keepUpright=q.getLayoutValue("text-keep-upright",v);this.optional=q.getLayoutValue("text-optional",v);this.rotationAlignment=q.getLayoutValue("text-rotation-alignment",v);this.rotationAlignment===l.RotationAlignment.AUTO&&(this.rotationAlignment=k?l.RotationAlignment.MAP:
l.RotationAlignment.VIEWPORT);k=q.getLayoutProperty("text-anchor");k?.isDataDriven?this._anchorProp=k:this.anchor=q.getLayoutValue("text-anchor",v);k=q.getLayoutProperty("text-justify");k?.isDataDriven?this._justifyProp=k:this.justify=q.getLayoutValue("text-justify",v);k=q.getLayoutProperty("text-letter-spacing");k?.isDataDriven?this._letterSpacingProp=k:this.letterSpacing=q.getLayoutValue("text-letter-spacing",v);k=q.getLayoutProperty("text-line-height");k?.isDataDriven?this._lineHeightProp=k:this.lineHeight=
q.getLayoutValue("text-line-height",v);k=q.getLayoutProperty("text-max-angle");k?.isDataDriven?this._maxAngleProp=k:this.maxAngle=q.getLayoutValue("text-max-angle",v);k=q.getLayoutProperty("text-max-width");k?.isDataDriven?this._maxWidthProp=k:this.maxWidth=q.getLayoutValue("text-max-width",v);k=q.getLayoutProperty("text-offset");k?.isDataDriven?this._offsetProp=k:this.offset=q.getLayoutValue("text-offset",v);k=q.getLayoutProperty("text-padding");k?.isDataDriven?this._paddingProp=k:this.padding=q.getLayoutValue("text-padding",
v);k=q.getLayoutProperty("text-rotate");k?.isDataDriven?this._rotateProp=k:this.rotate=q.getLayoutValue("text-rotate",v);k=q.getLayoutProperty("text-size");k?.isDataDriven?this._sizeProp=k:this.size=q.getLayoutValue("text-size",v);k=q.getLayoutProperty("text-writing-mode");k?.isDataDriven?this._writingModeProp=k:this.writingMode=q.getLayoutValue("text-writing-mode",v)}update(q,v){this._anchorProp&&(this.anchor=this._anchorProp.getValue(q,v));this._justifyProp&&(this.justify=this._justifyProp.getValue(q,
v));this._letterSpacingProp&&(this.letterSpacing=this._letterSpacingProp.getValue(q,v));this._lineHeightProp&&(this.lineHeight=this._lineHeightProp.getValue(q,v));this._maxAngleProp&&(this.maxAngle=this._maxAngleProp.getValue(q,v));this._maxWidthProp&&(this.maxWidth=this._maxWidthProp.getValue(q,v));this._offsetProp&&(this.offset=this._offsetProp.getValue(q,v));this._paddingProp&&(this.padding=this._paddingProp.getValue(q,v));this._rotateProp&&(this.rotate=this._rotateProp.getValue(q,v));this._sizeProp&&
(this.size=this._sizeProp.getValue(q,v));this._writingModeProp&&(this.writingMode=this._writingModeProp.getValue(q,v))}}A.BackgroundStyleLayer=H;A.CircleStyleLayer=K;A.FillStyleLayer=y;A.IconLayout=M;A.IndexItem=p;A.LineStyleLayer=E;A.StyleLayer=C;A.SymbolStyleLayer=G;A.TextLayout=P;Object.defineProperty(A,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/shaders/VTLBackgroundMaterial":function(){define(["exports","./VTLMaterial","../../../../webgl/enums","../../../../webgl/VertexElementDescriptor"],
function(A,z,B,e){class g extends z.VTLMaterial{constructor(h){super(h)}geometryInfo(){return g.GEOMETRY_LAYOUT}opacityInfo(){return null}attributes(){return g.ATTRIBUTES}attributesInfo(){return g.ATTRIBUTES_INFO}}g.ATTRIBUTES=[];g.GEOMETRY_LAYOUT=[new e.VertexElementDescriptor("a_pos",2,B.DataType.BYTE,0,2)];g.ATTRIBUTES_INFO={};A.VTLBackgroundMaterial=g;Object.defineProperty(A,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/shaders/VTLMaterial":function(){define(["exports",
"../MemoryBuffer","./enums","../../../../webgl/enums","../../../../webgl/VertexElementDescriptor"],function(A,z,B,e,g){class h{constructor(d){this._locations=new Map;this._key=d}get key(){return this._key}get type(){return this._key&7}defines(){return[]}getStride(){this._layout||this._buildAttributesInfo();return this._stride}getAttributeLocations(){0===this._locations.size&&this._buildAttributesInfo();return this._locations}getLayoutInfo(){this._layout||this._buildAttributesInfo();return this._layout}getEncodingInfos(){this._propertyEncodingInfo||
this._buildAttributesInfo();return this._propertyEncodingInfo}getUniforms(){this._uniforms||this._buildAttributesInfo();return this._uniforms}getShaderHeader(){this._shaderHeader||this._buildAttributesInfo();return this._shaderHeader}getShaderMain(){this._shaderMain||this._buildAttributesInfo();return this._shaderMain}setDataUniforms(d,f,l,x,n){var m=this.getUniforms();for(const p of m){const {name:C,type:H,getValue:y}=p;m=y(l,f,x,n);if(null!==m)switch(H){case "float":d.setUniform1f(C,m);break;case "vec2":d.setUniform2fv(C,
m);break;case "vec4":d.setUniform4fv(C,m)}}}encodeAttributes(d,f,l,x){const n=this.attributesInfo(),m=this.getEncodingInfos(),p=[];let C=0,H=0;for(const E of Object.keys(m)){var y=m[E];const {type:G,precisionFactor:K,isLayout:M}=n[E],P=M?l.getLayoutProperty(E):l.getPaintProperty(E),q=P.interpolator?.getInterpolationRange(f);let v=0;for(const k of y){const {offset:t,bufferElementsToAdd:u}=k;if(0<u){for(y=0;y<u;y++)p.push(0);C+=H;H=k.bufferElementsToAdd}y=x??P.getValue(q?q[v]:f,d);switch(G){case B.EncodingType.R8_SIGNED:case B.EncodingType.R8_UNSIGNED:p[C]|=
this._encodeByte(y*(K||1),8*t);break;case B.EncodingType.R16_SIGNED:case B.EncodingType.R16_UNSIGNED:p[C]|=this._encodeShort(y*(K||1),8*t);break;case B.EncodingType.R8G8_SIGNED:case B.EncodingType.R8G8_UNSIGNED:p[C]|=this._encodeByte(y*(K||1),8*t);p[C]|=this._encodeByte(y*(K||1),8*t+8);break;case B.EncodingType.R16G16_SIGNED:case B.EncodingType.R16G16_UNSIGNED:p[C]|=this._encodeShort(y*(K||1),8*t);p[C]|=this._encodeShort(y*(K||1),8*t+16);break;case B.EncodingType.R8G8B8A8_SIGNED:case B.EncodingType.R8G8B8A8_UNSIGNED:p[C]|=
this._encodeByte(y*(K||1),8*t);p[C]|=this._encodeByte(y*(K||1),8*t+8);p[C]|=this._encodeByte(y*(K||1),8*t+16);p[C]|=this._encodeByte(y*(K||1),8*t+24);break;case B.EncodingType.R8G8B8A8_COLOR:p[C]=this._encodeColor(y);break;case B.EncodingType.R16G16B16A16_DASHARRAY:case B.EncodingType.R16G16B16A16_PATTERN:this._encodePattern(C,p,y);break;default:throw Error("Unsupported encoding type");}v++}}return p}getAtributeState(d){const f=3+2*d;d=0|this._bit(f);return d|=this._bit(f+1)<<1}_buildAttributesInfo(){const d=
[],f={};var l={},x=-1;const n=this.attributesInfo();var m=this.attributes();let p=-1;for(const E of m){p++;m=this.getAtributeState(p);if(m===B.AttributeStatus.UNIFORM||m===B.AttributeStatus.UNUSED)continue;var C=n[E];const G=[];f[E]=G;C=C.type;for(let K=0;K<m;K++){const {dataType:M,bytesPerElement:P,count:q,normalized:v}=h._encodingInfo[C],k=P*q;var H=`${M}-${!0===v}`;let t=l[H],u=0;!t||4<t.count+q?(x++,t={dataIndex:x,count:0,offset:0},4!==q&&(l[H]=t),d.push({location:-1,name:"a_data_"+x,count:q,
type:M,normalized:v}),u=Math.ceil(Math.max(k/4,1))):(H=d[t.dataIndex],H.count+=q,u=Math.ceil(Math.max(H.count*P/4,1))-Math.ceil(Math.max(t.offset/4,1)));G.push({dataIndex:t.dataIndex,offset:t.offset,bufferElementsToAdd:u});t.offset+=k;t.count+=q}}for(const E of d)switch(E.type){case e.DataType.BYTE:case e.DataType.UNSIGNED_BYTE:E.count=4;break;case e.DataType.SHORT:case e.DataType.UNSIGNED_SHORT:E.count+=E.count%2}this._buildVertexBufferLayout(d);l=0;x=this._layout.get("geometry");for(var y of x)this._locations.set(y.name,
l++);if(y=this._layout.get("opacity"))for(const E of y)this._locations.set(E.name,l++);this._buildShaderInfo(d,f);this._propertyEncodingInfo=f}_buildVertexBufferLayout(d){const f=new Map,l=this.geometryInfo();let x=l[0].stride;if(0===d.length)f.set("geometry",l);else{const n=[];let m=x;for(const p of d)x+=b(p.type)*p.count;for(const p of l)n.push(new g.VertexElementDescriptor(p.name,p.count,p.type,p.offset,x,p.normalized));for(const p of d)n.push(new g.VertexElementDescriptor(p.name,p.count,p.type,
m,x,p.normalized)),m+=b(p.type)*p.count;f.set("geometry",n)}(d=this.opacityInfo())&&f.set("opacity",d);this._layout=f;this._stride=x}_buildShaderInfo(d,f){let l="\n",x="\n";const n=[];for(var m of d)l+=`attribute ${this._getType(m.count)} ${m.name};\n`;var p=this.attributes();d=this.attributesInfo();m=-1;for(const y of p){m++;const {name:E,type:G,precisionFactor:K,isLayout:M}=d[y];p=K&&1!==K?` * ${1/K}`:"";const {bytesPerElement:P,count:q}=h._encodingInfo[G];var C=v=>`a_data_${v.dataIndex}${c(q,v.offset,
P)}`;switch(this.getAtributeState(m)){case B.AttributeStatus.UNIFORM:p=this._getType(q);var H=`u_${E}`;n.push({name:H,type:p,getValue:(k,t,u,D)=>{u=M?k.getLayoutValue(y,t):k.getPaintValue(y,t);if(G===B.EncodingType.R16G16B16A16_DASHARRAY){k=k.getDashKey(u,k.getLayoutValue("line-cap",t));D=D.getMosaicItemPosition(k,!1);if(null==D)return null;const {tl:F,br:L}=D;return[F[0],L[1],L[0],F[1]]}if(G===B.EncodingType.R16G16B16A16_PATTERN){D=D.getMosaicItemPosition(u,!y.includes("line-"));if(null==D)return null;
const {tl:F,br:L}=D;return[F[0],L[1],L[0],F[1]]}return G===B.EncodingType.R8G8B8A8_COLOR?(D=u[3],[D*u[0],D*u[1],D*u[2],D]):u}});l+=`uniform ${p} ${H};\n`;x+=`${p} ${E} = ${H};\n`;break;case B.AttributeStatus.DATA_DRIVEN:H=C(f[y][0]);x+=`${this._getType(q)} ${E} = ${H}${p};\n`;break;case B.AttributeStatus.INTERPOLATED_DATA_DRIVEN:H=`u_t_${E}`;n.push({name:H,type:"float",getValue:(k,t,u,D)=>(M?k.getLayoutProperty(y):k.getPaintProperty(y)).interpolator.interpolationUniformValue(u,t)});l+=`uniform float ${H};\n`;
const v=C(f[y][0]);C=C(f[y][1]);x+=`${this._getType(q)} ${E} = mix(${v}${p}, ${C}${p}, ${H});\n`}}this._shaderHeader=l;this._shaderMain=x;this._uniforms=n}_bit(d){return(this._key&1<<d)>>d}_getType(d){switch(d){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4"}throw Error("Invalid count");}_encodeColor(d){const f=255*d[3];return z.i8888to32(d[0]*f,d[1]*f,d[2]*f,f)}_encodePattern(d,f,l){if(l?.rect){var x=l.rect,n=l.width;l=l.height;f[d]=this._encodeShort(x.x+2,0);f[d]|=
this._encodeShort(x.y+2+l,16);f[d+1]=this._encodeShort(x.x+2+n,0);f[d+1]|=this._encodeShort(x.y+2,16)}}_encodeByte(d,f){return(d&255)<<f}_encodeShort(d,f){return(d&65535)<<f}}h._encodingInfo={[B.EncodingType.R8_SIGNED]:{dataType:e.DataType.BYTE,bytesPerElement:1,count:1,normalized:!1},[B.EncodingType.R8_UNSIGNED]:{dataType:e.DataType.UNSIGNED_BYTE,bytesPerElement:1,count:1,normalized:!1},[B.EncodingType.R16_SIGNED]:{dataType:e.DataType.SHORT,bytesPerElement:2,count:1,normalized:!1},[B.EncodingType.R16_UNSIGNED]:{dataType:e.DataType.UNSIGNED_SHORT,
bytesPerElement:2,count:1,normalized:!1},[B.EncodingType.R8G8_SIGNED]:{dataType:e.DataType.BYTE,bytesPerElement:1,count:2,normalized:!1},[B.EncodingType.R8G8_UNSIGNED]:{dataType:e.DataType.UNSIGNED_BYTE,bytesPerElement:1,count:2,normalized:!1},[B.EncodingType.R16G16_SIGNED]:{dataType:e.DataType.SHORT,bytesPerElement:2,count:2,normalized:!1},[B.EncodingType.R16G16_UNSIGNED]:{dataType:e.DataType.UNSIGNED_SHORT,bytesPerElement:2,count:2,normalized:!1},[B.EncodingType.R8G8B8A8_SIGNED]:{dataType:e.DataType.BYTE,
bytesPerElement:1,count:4,normalized:!1},[B.EncodingType.R8G8B8A8_UNSIGNED]:{dataType:e.DataType.UNSIGNED_BYTE,bytesPerElement:1,count:4,normalized:!1},[B.EncodingType.R8G8B8A8_COLOR]:{dataType:e.DataType.UNSIGNED_BYTE,bytesPerElement:1,count:4,normalized:!0},[B.EncodingType.R16G16B16A16_DASHARRAY]:{dataType:e.DataType.UNSIGNED_SHORT,bytesPerElement:2,count:4,normalized:!1},[B.EncodingType.R16G16B16A16_PATTERN]:{dataType:e.DataType.UNSIGNED_SHORT,bytesPerElement:2,count:4,normalized:!1}};const b=
d=>{switch(d){case e.DataType.FLOAT:case e.DataType.INT:case e.DataType.UNSIGNED_INT:return 4;case e.DataType.SHORT:case e.DataType.UNSIGNED_SHORT:case e.DataType.HALF_FLOAT:return 2;case e.DataType.BYTE:case e.DataType.UNSIGNED_BYTE:return 1}},c=(d,f,l)=>{f/=l;if(1===d)switch(f){case 0:return".x";case 1:return".y";case 2:return".z";case 3:return".w"}else if(2===d)switch(f){case 0:return".xy";case 1:return".yz";case 2:return".zw"}else if(3===d)switch(f){case 0:return".xyz";case 1:return".yzw"}return""};
A.VTLMaterial=h;Object.defineProperty(A,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/MemoryBuffer":function(){define(["../../../../core/has"],function(A){class z{constructor(B){this._array=[];this._stride=B}get array(){return this._array}get index(){return 4*this._array.length/this._stride}get itemSize(){return this._stride}get sizeInBytes(){return 4*this._array.length}reset(){this.array.length=0}toBuffer(){return(new Uint32Array(this._array)).buffer}static i1616to32(B,
e){return 65535&B|e<<16}static i8888to32(B,e,g,h){return B&255|(e&255)<<8|(g&255)<<16|h<<24}static i8816to32(B,e,g){return B&255|(e&255)<<8|g<<16}}return z})},"esri/views/2d/engine/vectorTiles/shaders/enums":function(){define(["exports"],function(A){A.EncodingType=void 0;(function(z){z[z.R8_SIGNED=0]="R8_SIGNED";z[z.R8_UNSIGNED=1]="R8_UNSIGNED";z[z.R16_SIGNED=2]="R16_SIGNED";z[z.R16_UNSIGNED=3]="R16_UNSIGNED";z[z.R8G8_SIGNED=4]="R8G8_SIGNED";z[z.R8G8_UNSIGNED=5]="R8G8_UNSIGNED";z[z.R16G16_SIGNED=
6]="R16G16_SIGNED";z[z.R16G16_UNSIGNED=7]="R16G16_UNSIGNED";z[z.R8G8B8A8_SIGNED=8]="R8G8B8A8_SIGNED";z[z.R8G8B8A8_UNSIGNED=9]="R8G8B8A8_UNSIGNED";z[z.R8G8B8A8_COLOR=10]="R8G8B8A8_COLOR";z[z.R16G16B16A16_DASHARRAY=11]="R16G16B16A16_DASHARRAY";z[z.R16G16B16A16_PATTERN=12]="R16G16B16A16_PATTERN"})(A.EncodingType||(A.EncodingType={}));A.AttributeStatus=void 0;(function(z){z[z.UNIFORM=0]="UNIFORM";z[z.DATA_DRIVEN=1]="DATA_DRIVEN";z[z.INTERPOLATED_DATA_DRIVEN=2]="INTERPOLATED_DATA_DRIVEN";z[z.UNUSED=3]=
"UNUSED"})(A.AttributeStatus||(A.AttributeStatus={}));Object.defineProperty(A,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/shaders/VTLCircleMaterial":function(){define(["exports","./enums","./VTLMaterial","../../../../webgl/enums","../../../../webgl/VertexElementDescriptor"],function(A,z,B,e,g){class h extends B.VTLMaterial{constructor(b){super(b)}geometryInfo(){return h.GEOMETRY_LAYOUT}opacityInfo(){return null}attributes(){return h.ATTRIBUTES}attributesInfo(){return h.ATTRIBUTES_INFO}}
h.ATTRIBUTES="circle-radius circle-color circle-opacity circle-stroke-width circle-stroke-color circle-stroke-opacity circle-blur".split(" ");h.GEOMETRY_LAYOUT=[new g.VertexElementDescriptor("a_pos",2,e.DataType.SHORT,0,4)];h.ATTRIBUTES_INFO={"circle-radius":{name:"radius",type:z.EncodingType.R8_UNSIGNED},"circle-color":{name:"color",type:z.EncodingType.R8G8B8A8_COLOR},"circle-opacity":{name:"opacity",type:z.EncodingType.R8_UNSIGNED,precisionFactor:100},"circle-stroke-width":{name:"stroke_width",
type:z.EncodingType.R8_UNSIGNED,precisionFactor:4},"circle-stroke-color":{name:"stroke_color",type:z.EncodingType.R8G8B8A8_COLOR},"circle-stroke-opacity":{name:"stroke_opacity",type:z.EncodingType.R8_UNSIGNED,precisionFactor:100},"circle-blur":{name:"blur",type:z.EncodingType.R8_UNSIGNED,precisionFactor:32}};A.VTLCircleMaterial=h;Object.defineProperty(A,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/shaders/VTLFillMaterial":function(){define(["exports","./enums","./VTLMaterial",
"../../../../webgl/enums","../../../../webgl/VertexElementDescriptor"],function(A,z,B,e,g){class h extends B.VTLMaterial{constructor(c){super(c)}geometryInfo(){return h.GEOMETRY_LAYOUT}opacityInfo(){return null}attributes(){return h.ATTRIBUTES}attributesInfo(){return h.ATTRIBUTES_INFO}}h.ATTRIBUTES=["fill-color","fill-opacity","fill-pattern"];h.GEOMETRY_LAYOUT=[new g.VertexElementDescriptor("a_pos",2,e.DataType.SHORT,0,4)];h.ATTRIBUTES_INFO={"fill-color":{name:"color",type:z.EncodingType.R8G8B8A8_COLOR},
"fill-opacity":{name:"opacity",type:z.EncodingType.R8_UNSIGNED,precisionFactor:100},"fill-pattern":{name:"tlbr",type:z.EncodingType.R16G16B16A16_PATTERN,isOptional:!0}};class b extends B.VTLMaterial{constructor(c,d){super(c);this._usefillColor=d}geometryInfo(){return b.GEOMETRY_LAYOUT}opacityInfo(){return null}attributes(){return this._usefillColor?b.ATTRIBUTES_FILL:b.ATTRIBUTES_OUTLINE}attributesInfo(){return this._usefillColor?b.ATTRIBUTES_INFO_FILL:b.ATTRIBUTES_INFO_OUTLINE}}b.ATTRIBUTES_OUTLINE=
["fill-outline-color","fill-opacity"];b.ATTRIBUTES_FILL=["fill-color","fill-opacity"];b.GEOMETRY_LAYOUT=[new g.VertexElementDescriptor("a_pos",2,e.DataType.SHORT,0,8),new g.VertexElementDescriptor("a_offset",2,e.DataType.BYTE,4,8),new g.VertexElementDescriptor("a_xnormal",2,e.DataType.BYTE,6,8)];b.ATTRIBUTES_INFO_OUTLINE={"fill-outline-color":{name:"color",type:z.EncodingType.R8G8B8A8_COLOR},"fill-opacity":{name:"opacity",type:z.EncodingType.R8_UNSIGNED,precisionFactor:100}};b.ATTRIBUTES_INFO_FILL=
{"fill-color":{name:"color",type:z.EncodingType.R8G8B8A8_COLOR},"fill-opacity":{name:"opacity",type:z.EncodingType.R8_UNSIGNED,precisionFactor:100}};A.VTLFillMaterial=h;A.VTLOutlineMaterial=b;Object.defineProperty(A,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/shaders/VTLLineMaterial":function(){define(["exports","./enums","./VTLMaterial","../../../../webgl/enums","../../../../webgl/VertexElementDescriptor"],function(A,z,B,e,g){class h extends B.VTLMaterial{constructor(b){super(b)}geometryInfo(){return h.GEOMETRY_LAYOUT}opacityInfo(){return null}attributes(){return h.ATTRIBUTES}attributesInfo(){return h.ATTRIBUTES_INFO}}
h.ATTRIBUTES="line-blur line-color line-gap-width line-offset line-opacity line-width line-pattern line-dasharray".split(" ");h.GEOMETRY_LAYOUT=[new g.VertexElementDescriptor("a_pos",2,e.DataType.SHORT,0,16),new g.VertexElementDescriptor("a_extrude_offset",4,e.DataType.BYTE,4,16),new g.VertexElementDescriptor("a_dir_normal",4,e.DataType.BYTE,8,16),new g.VertexElementDescriptor("a_accumulatedDistance",2,e.DataType.UNSIGNED_SHORT,12,16)];h.ATTRIBUTES_INFO={"line-width":{name:"width",type:z.EncodingType.R8_UNSIGNED,
precisionFactor:2},"line-gap-width":{name:"gap_width",type:z.EncodingType.R8_UNSIGNED,precisionFactor:2},"line-offset":{name:"offset",type:z.EncodingType.R8_SIGNED,precisionFactor:2},"line-color":{name:"color",type:z.EncodingType.R8G8B8A8_COLOR},"line-opacity":{name:"opacity",type:z.EncodingType.R8_UNSIGNED,precisionFactor:100},"line-blur":{name:"blur",type:z.EncodingType.R8_UNSIGNED,precisionFactor:4},"line-pattern":{name:"tlbr",type:z.EncodingType.R16G16B16A16_PATTERN,isOptional:!0},"line-dasharray":{name:"tlbr",
type:z.EncodingType.R16G16B16A16_DASHARRAY,isOptional:!0}};A.VTLLineMaterial=h;Object.defineProperty(A,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/shaders/VTLSymbolMaterial":function(){define(["exports","./enums","./VTLMaterial","../../../../webgl/enums","../../../../webgl/VertexElementDescriptor"],function(A,z,B,e,g){const h=[new g.VertexElementDescriptor("a_pos",2,e.DataType.SHORT,0,16),new g.VertexElementDescriptor("a_vertexOffset",2,e.DataType.SHORT,4,16),new g.VertexElementDescriptor("a_texAngleRange",
4,e.DataType.UNSIGNED_BYTE,8,16),new g.VertexElementDescriptor("a_levelInfo",4,e.DataType.UNSIGNED_BYTE,12,16)],b=[new g.VertexElementDescriptor("a_opacityInfo",1,e.DataType.UNSIGNED_BYTE,0,1)];class c extends B.VTLMaterial{constructor(f){super(f)}geometryInfo(){return h}opacityInfo(){return b}attributes(){return c.ATTRIBUTES}attributesInfo(){return c.ATTRIBUTES_INFO}}c.ATTRIBUTES="icon-color icon-opacity icon-halo-blur icon-halo-color icon-halo-width icon-size".split(" ");c.ATTRIBUTES_INFO={"icon-color":{name:"color",
type:z.EncodingType.R8G8B8A8_COLOR},"icon-opacity":{name:"opacity",type:z.EncodingType.R8_UNSIGNED,precisionFactor:100},"icon-halo-color":{name:"halo_color",type:z.EncodingType.R8G8B8A8_COLOR},"icon-halo-width":{name:"halo_width",type:z.EncodingType.R8_UNSIGNED,precisionFactor:4},"icon-halo-blur":{name:"halo_blur",type:z.EncodingType.R8_UNSIGNED,precisionFactor:4},"icon-size":{name:"size",type:z.EncodingType.R8_UNSIGNED,precisionFactor:32,isLayout:!0}};class d extends B.VTLMaterial{constructor(f){super(f)}geometryInfo(){return h}opacityInfo(){return b}attributes(){return d.ATTRIBUTES}attributesInfo(){return d.ATTRIBUTES_INFO}}
d.ATTRIBUTES="text-color text-opacity text-halo-blur text-halo-color text-halo-width text-size".split(" ");d.ATTRIBUTES_INFO={"text-color":{name:"color",type:z.EncodingType.R8G8B8A8_COLOR},"text-opacity":{name:"opacity",type:z.EncodingType.R8_UNSIGNED,precisionFactor:100},"text-halo-color":{name:"halo_color",type:z.EncodingType.R8G8B8A8_COLOR},"text-halo-width":{name:"halo_width",type:z.EncodingType.R8_UNSIGNED,precisionFactor:4},"text-halo-blur":{name:"halo_blur",type:z.EncodingType.R8_UNSIGNED,
precisionFactor:4},"text-size":{name:"size",type:z.EncodingType.R8_UNSIGNED,isLayout:!0}};A.VTLIconMaterial=c;A.VTLTextMaterial=d;Object.defineProperty(A,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/style/Filter":function(){define(["../expression/expression","../expression/types"],function(A,z){class B{constructor(e){this._expression=e}filter(e,g){if(!this._expression)return!0;try{return this._expression.evaluate(e,g)}catch(h){return console.log(h.message),!0}}static createFilter(e){if(!e)return null;
this.isLegacyFilter(e)&&(e=this.convertLegacyFilter(e));try{const g=A.createExpression(e,null,z.booleanType);return new B(g)}catch(g){return console.log(g.message),null}}static isLegacyFilter(e){if(!Array.isArray(e)||0===e.length)return!0;switch(e[0]){case "\x3d\x3d":case "!\x3d":case "\x3e":case "\x3c":case "\x3e\x3d":case "\x3c\x3d":return 3===e.length&&"string"===typeof e[1]&&!Array.isArray(e[2]);case "in":return 3<=e.length&&"string"===typeof e[1]&&!Array.isArray(e[2]);case "!in":return!0;case "any":case "all":for(let g=
1;g<e.length;g++)if(this.isLegacyFilter(e[g]))return!0;return!1;case "none":return!0;case "has":return 2===e.length&&("$id"===e[1]||"$type"===e[1]);case "!has":return!0;default:return!1}}static convertLegacyFilter(e){if(!Array.isArray(e)||0===e.length)return!0;const g=e[0];if(1===e.length)return"any"!==g;switch(g){case "\x3d\x3d":return B.convertComparison("\x3d\x3d",e[1],e[2]);case "!\x3d":return B.negate(B.convertComparison("\x3d\x3d",e[1],e[2]));case "\x3e":case "\x3c":case "\x3e\x3d":case "\x3c\x3d":return B.convertComparison(g,
e[1],e[2]);case "in":return B.convertIn(e[1],e.slice(2));case "!in":return B.negate(B.convertIn(e[1],e.slice(2)));case "any":case "all":case "none":return B.convertCombining(g,e.slice(1));case "has":return B.convertHas(e[1]);case "!has":return B.negate(B.convertHas(e[1]));default:throw Error("Unexpected legacy filter.");}}static convertComparison(e,g,h){switch(g){case "$type":return[e,["geometry-type"],h];case "$id":return[e,["id"],h];default:return[e,["get",g],h]}}static convertIn(e,g){switch(e){case "$type":return["in",
["geometry-type"],["literal",g]];case "$id":return["in",["id"],["literal",g]];default:return["in",["get",e],["literal",g]]}}static convertHas(e){switch(e){case "$type":return!0;case "$id":return["has-id"];default:return["has",e]}}static convertCombining(e,g){return[e].concat(g.map(this.convertLegacyFilter))}static negate(e){return["!",e]}}return B})},"esri/views/2d/engine/vectorTiles/expression/expression":function(){define("exports ../../../../../Color ../../../../../core/colorUtils ../../../../../geometry/support/TileClipper ../../../unitBezier ../GeometryUtils ./types".split(" "),
function(A,z,B,e,g,h,b){function c(a,r,w){var I=typeof a;if("string"===I||"boolean"===I||"number"===I||null===a){if(w)switch(w.kind){case "string":"string"!==I&&(a=aa.toString(a));break;case "number":"number"!==I&&(a=aa.toNumber(a));break;case "color":a=aa.toColor(a)}a=["literal",a]}if(!Array.isArray(a)||0===a.length)throw Error("Expression must be a non empty array");I=a[0];if("string"!==typeof I)throw Error("First element of expression must be a string");const N=na[I];if(void 0===N)throw Error(`Invalid expression operator "${I}"`);
if(!N)throw Error(`Unimplemented expression operator "${I}"`);return N.parse(a,r,w)}class d{constructor(a){this._parent=a;this._vars={}}add(a,r){this._vars[a]=r}get(a){return this._vars[a]?this._vars[a]:this._parent?this._parent.get(a):null}}class f{constructor(){this.type=b.valueType}static parse(a){if(1<a.length)throw Error('"id" does not expect arguments');return new f}evaluate(a,r){return a?.id}}class l{constructor(){this.type=b.stringType}static parse(a){if(1<a.length)throw Error('"geometry-type" does not expect arguments');
return new l}evaluate(a,r){if(!a)return null;switch(a.type){case e.GeometryType.Point:return"Point";case e.GeometryType.LineString:return"LineString";case e.GeometryType.Polygon:return"Polygon";default:return null}}}class x{constructor(){this.type=b.objectType}static parse(a){if(1<a.length)throw Error('"properties" does not expect arguments');return new x}evaluate(a,r){return a?.values}}class n{constructor(){this.type=b.numberType}static parse(a){if(1<a.length)throw Error('"zoom" does not expect arguments');
return new n}evaluate(a,r){return r}}class m{constructor(a,r,w){this._lhs=a;this._rhs=r;this._compare=w;this.type=b.booleanType}static parse(a,r,w){if(3!==a.length&&4!==a.length)throw Error(`"${a[0]}" expects 2 or 3 arguments`);if(4===a.length)throw Error(`"${a[0]}" collator not supported`);return new m(c(a[1],r),c(a[2],r),w)}evaluate(a,r){return this._compare(this._lhs.evaluate(a,r),this._rhs.evaluate(a,r))}}class p extends m{static parse(a,r){return m.parse(a,r,(w,I)=>w===I)}}class C extends m{static parse(a,
r){return m.parse(a,r,(w,I)=>w!==I)}}class H extends m{static parse(a,r){return m.parse(a,r,(w,I)=>w<I)}}class y extends m{static parse(a,r){return m.parse(a,r,(w,I)=>w<=I)}}class E extends m{static parse(a,r){return m.parse(a,r,(w,I)=>w>I)}}class G extends m{static parse(a,r){return m.parse(a,r,(w,I)=>w>=I)}}class K{constructor(a){this._arg=a;this.type=b.booleanType}static parse(a,r){if(2!==a.length)throw Error('"!" expects 1 argument');return new K(c(a[1],r))}evaluate(a,r){return!this._arg.evaluate(a,
r)}}class M{constructor(a){this._args=a;this.type=b.booleanType}static parse(a,r){const w=[];for(let I=1;I<a.length;I++)w.push(c(a[I],r));return new M(w)}evaluate(a,r){for(const w of this._args)if(!w.evaluate(a,r))return!1;return!0}}class P{constructor(a){this._args=a;this.type=b.booleanType}static parse(a,r){const w=[];for(let I=1;I<a.length;I++)w.push(c(a[I],r));return new P(w)}evaluate(a,r){for(const w of this._args)if(w.evaluate(a,r))return!0;return!1}}class q{constructor(a){this._args=a;this.type=
b.booleanType}static parse(a,r){const w=[];for(let I=1;I<a.length;I++)w.push(c(a[I],r));return new q(w)}evaluate(a,r){for(const w of this._args)if(w.evaluate(a,r))return!1;return!0}}class v{constructor(a,r,w){this.type=a;this._args=r;this._fallback=w}static parse(a,r,w){if(4>a.length)throw Error('"case" expects at least 3 arguments');if(1===a.length%2)throw Error('"case" expects an odd number of arguments');let I;const N=[];for(let R=1;R<a.length-1;R+=2){const U=c(a[R],r),T=c(a[R+1],r,w);I||(I=T.type);
N.push({condition:U,output:T})}a=c(a[a.length-1],r,w);I||(I=a.type);return new v(I,N,a)}evaluate(a,r){for(const w of this._args)if(w.condition.evaluate(a,r))return w.output.evaluate(a,r);return this._fallback.evaluate(a,r)}}class k{constructor(a,r){this.type=a;this._args=r}static parse(a,r){if(2>a.length)throw Error('"coalesce" expects at least 1 argument');let w;const I=[];for(let N=1;N<a.length;N++){const R=c(a[N],r);w||(w=R.type);I.push(R)}return new k(w,I)}evaluate(a,r){for(const w of this._args){const I=
w.evaluate(a,r);if(null!==I)return I}return null}}class t{constructor(a,r,w,I,N){this.type=a;this._input=r;this._labels=w;this._outputs=I;this._fallback=N}static parse(a,r){if(3>a.length)throw Error('"match" expects at least 3 arguments');if(0===a.length%2)throw Error('"case" expects an even number of arguments');let w;const I=c(a[1],r),N=[],R={};let U;for(let ba=2;ba<a.length-1;ba+=2){var T=a[ba];Array.isArray(T)||(T=[T]);for(const fa of T){T=typeof fa;if("string"!==T&&"number"!==T)throw Error('"match" requires string or number literal as labels');
if(!U)U=T;else if(T!==U)throw Error('"match" requires labels to have the same type');R[fa]=N.length}T=c(a[ba+1],r);w||(w=T.type);N.push(T)}return new t(w,I,R,N,c(a[a.length-1],r))}evaluate(a,r){const w=this._input.evaluate(a,r);return(this._outputs[this._labels[w]]||this._fallback).evaluate(a,r)}}class u{constructor(a,r,w,I,N){this._operator=a;this.type=r;this.interpolation=w;this.input=I;this._stops=N}static parse(a,r,w){const I=a[0];if(5>a.length)throw Error(`"${I}" expects at least 4 arguments`);
const N=a[1];if(!Array.isArray(N)||0===N.length)throw Error(`"${N}" is not a valid interpolation`);switch(N[0]){case "linear":if(1!==N.length)throw Error("Linear interpolation cannot have parameters");break;case "exponential":if(2!==N.length||"number"!==typeof N[1])throw Error("Exponential interpolation requires one numeric argument");break;case "cubic-bezier":if(5!==N.length)throw Error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1");for(var R=1;5>R;R++){var U=
N[R];if("number"!==typeof U||0>U||1<U)throw Error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1");}break;default:throw Error(`"${a[0]}" unknown interpolation type "${N[0]}"`);}if(1!==a.length%2)throw Error(`"${I}" expects an even number of arguments`);R=c(a[2],r,b.numberType);let T;"interpolate-hcl"===I||"interpolate-lab"===I?T=b.colorType:w&&"value"!==w.kind&&(T=w);w=[];for(U=3;U<a.length;U+=2){const ba=a[U];if("number"!==typeof ba)throw Error(`"${I}" requires stop inputs as literal numbers`);
if(w.length&&w[w.length-1][0]>=ba)throw Error(`"${I}" requires strictly ascending stop inputs`);const fa=c(a[U+1],r,T);T||(T=fa.type);w.push([ba,fa])}if(T&&T!==b.colorType&&T!==b.numberType&&("array"!==T.kind||T.itemType!==b.numberType))throw Error(`"${I}" cannot interpolate type ${b.typeToString(T)}`);return new u(I,T,N,R,w)}evaluate(a,r){var w=this._stops;if(1===w.length)return w[0][1].evaluate(a,r);var I=this.input.evaluate(a,r);if(I<=w[0][0])return w[0][1].evaluate(a,r);if(I>=w[w.length-1][0])return w[w.length-
1][1].evaluate(a,r);let N=0;for(;++N<w.length&&!(I<w[N][0]););const R=u.interpolationRatio(this.interpolation,I,w[N-1][0],w[N][0]);I=w[N-1][1].evaluate(a,r);const U=w[N][1].evaluate(a,r);if("interpolate"===this._operator){if("array"===this.type.kind&&Array.isArray(I)&&Array.isArray(U))return I.map((T,ba)=>h.interpolate(T,U[ba],R));if("color"===this.type.kind&&I instanceof z&&U instanceof z)return I=new z(I),a=new z(U),new z([h.interpolate(I.r,a.r,R),h.interpolate(I.g,a.g,R),h.interpolate(I.b,a.b,
R),h.interpolate(I.a,a.a,R)]);if("number"===this.type.kind&&"number"===typeof I&&"number"===typeof U)return h.interpolate(I,U,R);throw Error(`"${this._operator}" cannot interpolate type ${b.typeToString(this.type)}`);}if("interpolate-hcl"===this._operator)return a=B.toLCH(I),r=B.toLCH(U),w=r.h-a.h,a=B.toRGB({h:a.h+R*(180<w||-180>w?w-360*Math.round(w/360):w),c:h.interpolate(a.c,r.c,R),l:h.interpolate(a.l,r.l,R)}),new z({a:h.interpolate(I.a,U.a,R),...a});if("interpolate-lab"===this._operator)return a=
B.toLAB(I),r=B.toLAB(U),a=B.toRGB({l:h.interpolate(a.l,r.l,R),a:h.interpolate(a.a,r.a,R),b:h.interpolate(a.b,r.b,R)}),new z({a:h.interpolate(I.a,U.a,R),...a});throw Error(`Unexpected operator "${this._operator}"`);}interpolationUniformValue(a,r){const w=this._stops;if(1===w.length||a>=w[w.length-1][0])return 0;let I=0;for(;++I<w.length&&!(a<w[I][0]););return u.interpolationRatio(this.interpolation,r,w[I-1][0],w[I][0])}getInterpolationRange(a){const r=this._stops;if(1===r.length)return a=r[0][0],[a,
a];var w=r[r.length-1][0];if(a>=w)return[w,w];for(w=0;++w<r.length&&!(a<r[w][0]););return[r[w-1][0],r[w][0]]}static interpolationRatio(a,r,w,I){let N=0;"linear"===a[0]?N=u._exponentialInterpolationRatio(r,1,w,I):"exponential"===a[0]?N=u._exponentialInterpolationRatio(r,a[1],w,I):"cubic-bezier"===a[0]&&(N=g.unitBezier(a[1],a[2],a[3],a[4])(u._exponentialInterpolationRatio(r,1,w,I),1E-5));0>N?N=0:1<N&&(N=1);return N}static _exponentialInterpolationRatio(a,r,w,I){I-=w;if(0===I)return 0;a-=w;return 1===
r?a/I:(r**a-1)/(r**I-1)}}class D{constructor(a,r,w){this.type=a;this._input=r;this._stops=w}static parse(a,r){if(5>a.length)throw Error('"step" expects at least 4 arguments');if(1!==a.length%2)throw Error('"step" expects an even number of arguments');const w=c(a[1],r,b.numberType);let I;const N=[];N.push([-Infinity,c(a[2],r)]);for(let R=3;R<a.length;R+=2){const U=a[R];if("number"!==typeof U)throw Error('"step" requires stop inputs as literal numbers');if(N.length&&N[N.length-1][0]>=U)throw Error('"step" requires strictly ascending stop inputs');
const T=c(a[R+1],r);I||(I=T.type);N.push([U,T])}return new D(I,w,N)}evaluate(a,r){const w=this._stops;if(1===w.length)return w[0][1].evaluate(a,r);const I=this._input.evaluate(a,r);let N=0;for(;++N<w.length&&!(I<w[N][0]););return this._stops[N-1][1].evaluate(a,r)}}class F{constructor(a,r){this.type=a;this._output=r}static parse(a,r,w){if(4>a.length)throw Error('"let" expects at least 3 arguments');if(1===a.length%2)throw Error('"let" expects an odd number of arguments');const I=new d(r);for(let N=
1;N<a.length-1;N+=2){const R=a[N];if("string"!==typeof R)throw Error(`"let" requires a string to define variable names - found ${R}`);I.add(R,c(a[N+1],r))}a=c(a[a.length-1],I,w);return new F(a.type,a)}evaluate(a,r){return this._output.evaluate(a,r)}}class L{constructor(a,r){this.type=a;this.output=r}static parse(a,r,w){if(2!==a.length||"string"!==typeof a[1])throw Error('"var" requires just one literal string argument');r=r.get(a[1]);if(!r)throw Error(`${a[1]} must be defined before being used in a "var" expression`);
return new L(w||b.valueType,r)}evaluate(a,r){return this.output.evaluate(a,r)}}class J{constructor(a,r,w){this.type=a;this._index=r;this._array=w}static parse(a,r){if(3!==a.length)throw Error('"at" expects 2 arguments');const w=c(a[1],r,b.numberType);a=c(a[2],r);return new J(a.type.itemType,w,a)}evaluate(a,r){const w=this._index.evaluate(a,r);a=this._array.evaluate(a,r);if(0>w||w>=a.length)throw Error('"at" index out of bounds');if(w!==Math.floor(w))throw Error('"at" index must be an integer');return a[w]}}
class O{constructor(a,r){this._key=a;this._obj=r;this.type=b.valueType}static parse(a,r){let w;switch(a.length){case 2:return w=c(a[1],r),new O(w);case 3:return w=c(a[1],r),a=c(a[2],r),new O(w,a);default:throw Error('"get" expects 1 or 2 arguments');}}evaluate(a,r){const w=this._key.evaluate(a,r);return this._obj?this._obj.evaluate(a,r)[w]:a?.values[w]}}class Q{constructor(a,r){this._key=a;this._obj=r;this.type=b.booleanType}static parse(a,r){let w;switch(a.length){case 2:return w=c(a[1],r),new Q(w);
case 3:return w=c(a[1],r),a=c(a[2],r),new Q(w,a);default:throw Error('"has" expects 1 or 2 arguments');}}evaluate(a,r){const w=this._key.evaluate(a,r);return this._obj?(a=this._obj.evaluate(a,r),w in a):!!a?.values[w]}}class S{constructor(a,r){this._key=a;this._vals=r;this.type=b.booleanType}static parse(a,r){if(3!==a.length)throw Error('"in" expects 2 arguments');return new S(c(a[1],r),c(a[2],r))}evaluate(a,r){const w=this._key.evaluate(a,r);return this._vals.evaluate(a,r).includes(w)}}class X{constructor(a,
r,w){this._item=a;this._array=r;this._from=w;this.type=b.numberType}static parse(a,r){if(3>a.length||4<a.length)throw Error('"index-of" expects 3 or 4 arguments');const w=c(a[1],r),I=c(a[2],r);return 4===a.length?(a=c(a[3],r,b.numberType),new X(w,I,a)):new X(w,I)}evaluate(a,r){const w=this._item.evaluate(a,r),I=this._array.evaluate(a,r);if(this._from){a=this._from.evaluate(a,r);if(a!==Math.floor(a))throw Error('"index-of" index must be an integer');return I.indexOf(w,a)}return I.indexOf(w)}}class W{constructor(a){this._arg=
a;this.type=b.numberType}static parse(a,r){if(2!==a.length)throw Error('"length" expects 2 arguments');a=c(a[1],r);return new W(a)}evaluate(a,r){a=this._arg.evaluate(a,r);if("string"===typeof a||Array.isArray(a))return a.length;throw Error('"length" expects string or array');}}class Z{constructor(a,r,w,I){this.type=a;this._array=r;this._from=w;this._to=I}static parse(a,r){if(3>a.length||4<a.length)throw Error('"slice" expects 2 or 3 arguments');const w=c(a[1],r),I=c(a[2],r,b.numberType);if(I.type!==
b.numberType)throw Error('"slice" index must return a number');if(4===a.length){a=c(a[3],r,b.numberType);if(a.type!==b.numberType)throw Error('"slice" index must return a number');return new Z(w.type,w,I,a)}return new Z(w.type,w,I)}evaluate(a,r){const w=this._array.evaluate(a,r);if(!Array.isArray(w)&&"string"!==typeof w)throw Error('"slice" input must be an array or a string');const I=this._from.evaluate(a,r);if(0>I||I>=w.length)throw Error('"slice" index out of bounds');if(I!==Math.floor(I))throw Error('"slice" index must be an integer');
if(this._to){a=this._to.evaluate(a,r);if(0>a||a>=w.length)throw Error('"slice" index out of bounds');if(a!==Math.floor(a))throw Error('"slice" index must be an integer');return w.slice(I,a)}return w.slice(I)}}class ca{constructor(){this.type=b.booleanType}static parse(a){if(1!==a.length)throw Error('"has-id" expects no arguments');return new ca}evaluate(a,r){return void 0!==a?.id}}class Y{constructor(a,r){this._args=a;this._calculate=r;this.type=b.numberType}static parse(a,r,w){a=a.slice(1).map(I=>
c(I,r));return new Y(a,w)}evaluate(a,r){let w;this._args&&(w=this._args.map(I=>I.evaluate(a,r)));return this._calculate(w)}}class oa extends Y{static parse(a,r){switch(a.length){case 2:return Y.parse(a,r,w=>-w[0]);case 3:return Y.parse(a,r,w=>w[0]-w[1]);default:throw Error('"-" expects 1 or 2 arguments');}}}class pa extends Y{static parse(a,r){return Y.parse(a,r,w=>{let I=1;for(const N of w)I*=N;return I})}}class qa extends Y{static parse(a,r){if(3===a.length)return Y.parse(a,r,w=>w[0]/w[1]);throw Error('"/" expects 2 arguments');
}}class ra extends Y{static parse(a,r){if(3===a.length)return Y.parse(a,r,w=>w[0]%w[1]);throw Error('"%" expects 2 arguments');}}class sa extends Y{static parse(a,r){if(3===a.length)return Y.parse(a,r,w=>w[0]**w[1]);throw Error('"^" expects 1 or 2 arguments');}}class ta extends Y{static parse(a,r){return Y.parse(a,r,w=>{let I=0;for(const N of w)I+=N;return I})}}class V{constructor(a,r){this._args=a;this._calculate=r;this.type=b.numberType}static parse(a,r){const w=a.slice(1).map(I=>c(I,r));return new V(w,
V.ops[a[0]])}evaluate(a,r){let w;this._args&&(w=this._args.map(I=>I.evaluate(a,r)));return this._calculate(w)}}V.ops={abs:a=>Math.abs(a[0]),acos:a=>Math.acos(a[0]),asin:a=>Math.asin(a[0]),atan:a=>Math.atan(a[0]),ceil:a=>Math.ceil(a[0]),cos:a=>Math.cos(a[0]),e:()=>Math.E,floor:a=>Math.floor(a[0]),ln:a=>Math.log(a[0]),ln2:()=>Math.LN2,log10:a=>Math.log(a[0])/Math.LN10,log2:a=>Math.log(a[0])/Math.LN2,max:a=>Math.max(...a),min:a=>Math.min(...a),pi:()=>Math.PI,round:a=>Math.round(a[0]),sin:a=>Math.sin(a[0]),
sqrt:a=>Math.sqrt(a[0]),tan:a=>Math.tan(a[0])};class ha{constructor(a){this._args=a;this.type=b.stringType}static parse(a,r){return new ha(a.slice(1).map(w=>c(w,r)))}evaluate(a,r){return this._args.map(w=>w.evaluate(a,r)).join("")}}class ea{constructor(a,r){this._arg=a;this._calculate=r;this.type=b.stringType}static parse(a,r){if(2!==a.length)throw Error(`${a[0]} expects 1 argument`);r=c(a[1],r);return new ea(r,ea.ops[a[0]])}evaluate(a,r){return this._calculate(this._arg.evaluate(a,r))}}ea.ops={downcase:a=>
a.toLowerCase(),upcase:a=>a.toUpperCase()};class ia{constructor(a){this._args=a;this.type=b.colorType}static parse(a,r){if(4!==a.length)throw Error('"rgb" expects 3 arguments');a=a.slice(1).map(w=>c(w,r));return new ia(a)}evaluate(a,r){const w=this._validate(this._args[0].evaluate(a,r)),I=this._validate(this._args[1].evaluate(a,r));a=this._validate(this._args[2].evaluate(a,r));return new z({r:w,g:I,b:a})}_validate(a){if("number"!==typeof a||0>a||255<a)throw Error(`${a}: invalid color component`);
return Math.round(a)}}class ja{constructor(a){this._args=a;this.type=b.colorType}static parse(a,r){if(5!==a.length)throw Error('"rgba" expects 4 arguments');a=a.slice(1).map(w=>c(w,r));return new ja(a)}evaluate(a,r){const w=this._validate(this._args[0].evaluate(a,r)),I=this._validate(this._args[1].evaluate(a,r)),N=this._validate(this._args[2].evaluate(a,r));a=this._validateAlpha(this._args[3].evaluate(a,r));return new z({r:w,g:I,b:N,a})}_validate(a){if("number"!==typeof a||0>a||255<a)throw Error(`${a}: invalid color component`);
return Math.round(a)}_validateAlpha(a){if("number"!==typeof a||0>a||1<a)throw Error(`${a}: invalid alpha color component`);return a}}class ka{constructor(a){this._color=a;this.type=b.arrayType(b.numberType,4)}static parse(a,r){if(2!==a.length)throw Error('"to-rgba" expects 1 argument');a=c(a[1],r);return new ka(a)}evaluate(a,r){return(new z(this._color.evaluate(a,r))).toRgba()}}class da{constructor(a,r){this.type=a;this._args=r}static parse(a,r){var w=a[0];if(2>a.length)throw Error(`${w} expects at least one argument`);
let I=1,N;if("array"===w){if(2<a.length){switch(a[1]){case "string":N=b.stringType;break;case "number":N=b.numberType;break;case "boolean":N=b.booleanType;break;default:throw Error('"array" type argument must be string, number or boolean');}I++}else N=b.valueType;if(3<a.length){var R=a[2];if(null!==R&&("number"!==typeof R||0>R||R!==Math.floor(R)))throw Error('"array" length argument must be a positive integer literal');I++}N=b.arrayType(N,R)}else switch(w){case "string":N=b.stringType;break;case "number":N=
b.numberType;break;case "boolean":N=b.booleanType;break;case "object":N=b.objectType}for(w=[];I<a.length;I++)R=c(a[I],r),w.push(R);return new da(N,w)}evaluate(a,r){let w;for(const I of this._args){const N=I.evaluate(a,r);w=b.getType(N);if(b.matchType(w,this.type))return N}throw Error(`Expected ${b.typeToString(this.type)} but got ${b.typeToString(w)}`);}}class aa{constructor(a,r){this.type=a;this._args=r}static parse(a,r){var w=a[0];const I=aa.types[w];if(I===b.booleanType||I===b.stringType){if(2!==
a.length)throw Error(`${w} expects one argument`);}else if(2>a.length)throw Error(`${w} expects at least one argument`);w=[];for(let N=1;N<a.length;N++){const R=c(a[N],r);w.push(R)}return new aa(I,w)}evaluate(a,r){if(this.type===b.booleanType)return!!this._args[0].evaluate(a,r);if(this.type===b.stringType)return b.valueToString(this._args[0].evaluate(a,r));if(this.type===b.numberType){for(const I of this._args){var w=Number(I.evaluate(a,r));if(!isNaN(w))return w}return null}if(this.type===b.colorType){for(w of this._args)try{const I=
aa.toColor(w.evaluate(a,r));if(I instanceof z)return I}catch{}return null}}static toBoolean(a){return!!a}static toString(a){return b.valueToString(a)}static toNumber(a){const r=Number(a);if(isNaN(r))throw Error(`"${a}" is not a number`);return r}static toColor(a){if(a instanceof z)return a;if("string"===typeof a){const r=z.fromString(a);if(r)return r;throw Error(`"${a}" is not a color`);}if(Array.isArray(a))return z.fromArray(a);throw Error(`"${a}" is not a color`);}}aa.types={"to-boolean":b.booleanType,
"to-color":b.colorType,"to-number":b.numberType,"to-string":b.stringType};class la{constructor(a){this._val=a;this.type=b.getType(a)}static parse(a){if(2!==a.length)throw Error('"literal" expects 1 argument');return new la(a[1])}evaluate(a,r){return this._val}}class ma{constructor(a){this._arg=a;this.type=b.stringType}static parse(a,r){if(2!==a.length)throw Error('"typeof" expects 1 argument');return new ma(c(a[1],r))}evaluate(a,r){return b.typeToString(b.getType(this._arg.evaluate(a,r)))}}const na=
{array:da,boolean:da,collator:null,format:null,image:null,literal:la,number:da,"number-format":null,object:da,string:da,"to-boolean":aa,"to-color":aa,"to-number":aa,"to-string":aa,typeof:ma,accumulated:null,"feature-state":null,"geometry-type":l,id:f,"line-progress":null,properties:x,at:J,get:O,has:Q,in:S,"index-of":X,length:W,slice:Z,"!":K,"!\x3d":C,"\x3c":H,"\x3c\x3d":y,"\x3d\x3d":p,"\x3e":E,"\x3e\x3d":G,all:M,any:P,case:v,coalesce:k,match:t,within:null,interpolate:u,"interpolate-hcl":u,"interpolate-lab":u,
step:D,let:F,var:L,concat:ha,downcase:ea,"is-supported-script":null,"resolved-locale":null,upcase:ea,rgb:ia,rgba:ja,"to-rgba":ka,"-":oa,"*":pa,"/":qa,"%":ra,"^":sa,"+":ta,abs:V,acos:V,asin:V,atan:V,ceil:V,cos:V,e:V,floor:V,ln:V,ln2:V,log10:V,log2:V,max:V,min:V,pi:V,round:V,sin:V,sqrt:V,tan:V,zoom:n,"heatmap-density":null,"has-id":ca,none:q};A.ALL=M;A.ANY=P;A.Add=ta;A.Assert=da;A.At=J;A.Calculate=V;A.Case=v;A.Coalesce=k;A.Coerce=aa;A.Concat=ha;A.Div=qa;A.EQ=p;A.GE=G;A.GT=E;A.GeomType=l;A.Get=O;A.Has=
Q;A.HasID=ca;A.ID=f;A.In=S;A.IndexOf=X;A.Interpolate=u;A.LE=y;A.LT=H;A.Length=W;A.Let=F;A.Literal=la;A.Match=t;A.Mod=ra;A.Mul=pa;A.NE=C;A.NONE=q;A.NOT=K;A.Pow=sa;A.Properties=x;A.Rgb=ia;A.Rgba=ja;A.Slice=Z;A.Step=D;A.String=ea;A.Sub=oa;A.ToRgba=ka;A.TypeOf=ma;A.Var=L;A.Zoom=n;A.createExpression=c;A.ops=na;Object.defineProperty(A,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/expression/types":function(){define(["exports","../../../../../Color"],function(A,z){function B(p,
C){return{kind:"array",itemType:p,n:C}}function e(p){if("array"===p.kind){const C=e(p.itemType);return"number"===typeof p.n?`array<${C}, ${p.n}>`:"value"===p.itemType.kind?"array":`array<${C}>`}return p.kind}function g(p){if(null===p)return b;if("string"===typeof p)return d;if("boolean"===typeof p)return f;if("number"===typeof p)return c;if(p instanceof z)return l;if(Array.isArray(p)){let C;for(const H of p){const y=g(H);if(!C)C=y;else if(C!==y){C=n;break}}return B(C||n,p.length)}return"object"===
typeof p?x:n}function h(p,C){if("array"===C.kind)return"array"===p.kind&&(0===p.n&&"value"===p.itemType.kind||h(p.itemType,C.itemType))&&("number"!==typeof C.n||C.n===p.n);if("value"===C.kind)for(const H of m)if(h(p,H))return!0;return C.kind===p.kind}const b={kind:"null"},c={kind:"number"},d={kind:"string"},f={kind:"boolean"},l={kind:"color"},x={kind:"object"},n={kind:"value"},m=[b,c,d,f,l,x,B(n)];A.arrayType=B;A.booleanType=f;A.colorType=l;A.getType=g;A.matchType=h;A.nullType=b;A.numberType=c;A.objectType=
x;A.stringType=d;A.typeToString=e;A.valueToString=function(p){if(null===p)return"";const C=typeof p;return"string"===C?p:"number"===C||"boolean"===C?String(p):p instanceof z?p.toString():JSON.stringify(p)};A.valueType=n;Object.defineProperty(A,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/style/StyleProperty":function(){define(["../../../../../Color","../GeometryUtils","../expression/expression","../expression/types"],function(A,z,B,e){class g{constructor(h,b){this.isDataDriven=
!1;this.interpolator=null;switch(h.type){case "number":var c=!0;break;case "color":c=!0;break;case "array":c="number"===h.value;break;default:c=!1}null==b&&(b=h.default);if(Array.isArray(b)&&0<b.length&&B.ops[b[0]]){c={number:e.numberType,color:e.colorType,string:e.stringType,boolean:e.booleanType,enum:e.stringType};try{var d="array"===h.type?e.arrayType(c[h.value]||e.valueType,h.length):c[h.type];const f=B.createExpression(b,null,d);this.getValue=this._buildExpression(f,h);this.isDataDriven=!0;f instanceof
B.Interpolate&&f.input instanceof B.Zoom&&(this.interpolator=f)}catch(f){console.log(f.message),this.getValue=this._buildSimple(h.default)}}else{c&&"interval"===b.type&&(c=!1);if(d=b?.stops&&0<b.stops.length)for(const f of b.stops)f[1]=this._validate(f[1],h);if(this.isDataDriven=b?!!b.property:!1)if(void 0!==b.default&&(b.default=this._validate(b.default,h)),d)switch(b.type){case "identity":this.getValue=this._buildIdentity(b,h);break;case "categorical":this.getValue=this._buildCategorical(b,h);break;
default:this.getValue=c?this._buildInterpolate(b,h):this._buildInterval(b,h)}else this.getValue=this._buildIdentity(b,h);else d?this.getValue=c?this._buildZoomInterpolate(b):this._buildZoomInterval(b):(b=this._validate(b,h),this.getValue=this._buildSimple(b))}}_validate(h,b){if("number"===b.type){if(null!=b.minimum&&h<b.minimum)return b.minimum;if(null!=b.maximum&&h>b.maximum)return b.maximum}else"color"===b.type?h=g._parseColor(h):"enum"===b.type?"string"===typeof h&&(h=b.values.indexOf(h)):"array"===
b.type&&"enum"===b.value?h=h.map(c=>"string"===typeof c?b.values.indexOf(c):c):"string"===b.type&&(h=e.valueToString(h));return h}_buildSimple(h){return()=>h}_buildExpression(h,b){return(c,d)=>{try{const f=h.evaluate(d,c);return void 0===f?b.default:this._validate(f,b)}catch(f){return console.log(f.message),b.default}}}_buildIdentity(h,b){return(c,d)=>{let f;d&&(f=d.values[h.property]);void 0!==f&&(f=this._validate(f,b));return null!=f?f:void 0!==h.default?h.default:b.default}}_buildCategorical(h,
b){return(c,d)=>{let f;d&&(f=d.values[h.property]);f=this._categorical(f,h.stops);return void 0!==f?f:void 0!==h.default?h.default:b.default}}_buildInterval(h,b){return(c,d)=>{let f;d&&(f=d.values[h.property]);return"number"===typeof f?this._interval(f,h.stops):void 0!==h.default?h.default:b.default}}_buildInterpolate(h,b){return(c,d)=>{let f;d&&(f=d.values[h.property]);return"number"===typeof f?this._interpolate(f,h.stops,h.base||1):void 0!==h.default?h.default:b.default}}_buildZoomInterpolate(h){return b=>
this._interpolate(b,h.stops,h.base||1)}_buildZoomInterval(h){return b=>this._interval(b,h.stops)}_categorical(h,b){const c=b.length;for(let d=0;d<c;d++)if(b[d][0]===h)return b[d][1]}_interval(h,b){const c=b.length;let d=0;for(let f=0;f<c;f++)if(b[f][0]<=h)d=f;else break;return b[d][1]}_interpolate(h,b,c){const d=b.length;for(let x=0;x<d;x++){const n=b[x];if(n[0]<=h)var f=n;else{var l=n;break}}if(f&&l){b=l[0]-f[0];h-=f[0];c=1===c?h/b:(c**h-1)/(c**b-1);if(Array.isArray(f[1])){f=f[1];l=l[1];h=[];for(b=
0;b<f.length;b++)h.push(z.interpolate(f[b],l[b],c));return h}return z.interpolate(f[1],l[1],c)}if(f)return f[1];if(l)return l[1]}static _isEmpty(h){for(const b in h)if(h.hasOwnProperty(b))return!1;return!0}static _parseColor(h){if(Array.isArray(h))return h;"string"===typeof h&&(h=new A(h));if(h instanceof A&&!this._isEmpty(h))return A.toUnitRGBA(h)}}return g})},"esri/views/2d/engine/vectorTiles/style/StyleRepository":function(){define(["./StyleDefinition","./StyleLayer"],function(A,z){class B{constructor(e){this._style=
e;this.backgroundBucketIds=[];this._uidToLayer=new Map;this._layerByName={};this._runningId=0;e.layers||(e.layers=[]);this.version=parseFloat(e.version);if(this.layers=e.layers.map((g,h,b)=>this._create(g,h,b)).filter(g=>!!g))for(e=0;e<this.layers.length;e++){const g=this.layers[e];this._layerByName[g.id]=g;this._uidToLayer.set(g.uid,g);g.type===A.StyleLayerType.BACKGROUND&&this.backgroundBucketIds.push(g.id)}this._identifyRefLayers()}isPainterDataDriven(e){return(e=this._layerByName[e])?e.isPainterDataDriven():
!1}getStyleLayerId(e){return e>=this.layers.length?null:this.layers[e].id}getStyleLayerByUID(e){return this._uidToLayer.get(e)??null}getStyleLayerIndex(e){return(e=this._layerByName[e])?this.layers.indexOf(e):-1}setStyleLayer(e,g){if(e?.id){var h=this._style;null!=g&&g>=this.layers.length&&(g=this.layers.length-1);var b=!0,c;if(c=this._layerByName[e.id]){const d=this.layers.indexOf(c);g||=d;g===d?(b=!1,c=B._recreateLayer(e,c),this.layers[g]=c,h.layers[g]=e):(this.layers.splice(d,1),h.layers.splice(d,
1),c=this._create(e,g,this.layers),this.layers.splice(g,0,c),h.layers.splice(g,0,e))}else c=this._create(e,g,this.layers),!g||g>=this.layers.length?(this.layers.push(c),h.layers.push(e)):(this.layers.splice(g,0,c),h.layers.splice(g,0,e));this._layerByName[e.id]=c;this._uidToLayer.set(c.uid,c);b&&this._recomputeZValues();this._identifyRefLayers()}}getStyleLayer(e){return(e=this._layerByName[e])?{type:e.typeName,id:e.id,source:e.source,"source-layer":e.sourceLayer,minzoom:e.minzoom,maxzoom:e.maxzoom,
filter:e.filter,layout:e.layout,paint:e.paint}:null}deleteStyleLayer(e){const g=this._layerByName[e];g&&(delete this._layerByName[e],this._uidToLayer.delete(g.uid),e=this.layers.indexOf(g),this.layers.splice(e,1),this._style.layers.splice(e,1),this._recomputeZValues(),this._identifyRefLayers())}getLayerById(e){return this._layerByName[e]}getLayoutProperties(e){return(e=this._layerByName[e])?e.layout:null}getPaintProperties(e){return(e=this._layerByName[e])?e.paint:null}setPaintProperties(e,g){if(e=
this._layerByName[e]){var h=B._recreateLayer({type:e.typeName,id:e.id,source:e.source,"source-layer":e.sourceLayer,minzoom:e.minzoom,maxzoom:e.maxzoom,filter:e.filter,layout:e.layout,paint:g},e),b=this.layers.indexOf(e);this.layers[b]=h;this._style.layers[b].paint=g;this._layerByName[e.id]=h;this._uidToLayer.set(e.uid,h)}}setLayoutProperties(e,g){if(e=this._layerByName[e]){var h=B._recreateLayer({type:e.typeName,id:e.id,source:e.source,"source-layer":e.sourceLayer,minzoom:e.minzoom,maxzoom:e.maxzoom,
filter:e.filter,layout:g,paint:e.paint},e),b=this.layers.indexOf(e);this.layers[b]=h;this._style.layers[b].layout=g;this._layerByName[e.id]=h;this._uidToLayer.set(e.uid,h)}}setStyleLayerVisibility(e,g){if(e=this._layerByName[e]){var h=e.layout||{};h.visibility=g;g=B._recreateLayer({type:e.typeName,id:e.id,source:e.source,"source-layer":e.sourceLayer,minzoom:e.minzoom,maxzoom:e.maxzoom,filter:e.filter,layout:h,paint:e.paint},e);var b=this.layers.indexOf(e);this.layers[b]=g;this._style.layers[b].layout=
h;this._layerByName[e.id]=g;this._uidToLayer.set(e.uid,g)}}getStyleLayerVisibility(e){return(e=this._layerByName[e])?e.layout?.visibility??"visible":"none"}_recomputeZValues(){const e=this.layers,g=1/(e.length+1);for(let h=0;h<e.length;h++)e[h].z=1-(1+h)*g}_identifyRefLayers(){const e=[],g=[];let h=0;for(const d of this.layers){const f=d.layout;if(d.type===A.StyleLayerType.FILL){var b=d,c=d.source+"|"+d.sourceLayer;c+="|"+(f?.visibility??"");c+="|"+d.minzoom;c+="|"+d.maxzoom;c+="|"+JSON.stringify(d.filter);
if(b.hasDataDrivenFill||b.hasDataDrivenOutline)c+="|"+h;e.push({key:c,layer:d})}else if(d.type===A.StyleLayerType.LINE){b=d;c=d.paint;c=null!=c&&(null!=c["line-pattern"]||null!=c["line-dasharray"]);let l=d.source+"|"+d.sourceLayer;l+="|"+(f?.visibility??"");l+="|"+d.minzoom;l+="|"+d.maxzoom;l+="|"+JSON.stringify(d.filter);l+="|"+(void 0!==f?f["line-cap"]:"");l+="|"+(void 0!==f?f["line-join"]:"");if(b.hasDataDrivenLine||c)l+="|"+h;g.push({key:l,layer:d})}++h}this._assignRefLayers(e);this._assignRefLayers(g)}_assignRefLayers(e){e.sort((f,
l)=>f.key<l.key?-1:f.key>l.key?1:0);let g,h;const b=e.length;for(let f=0;f<b;f++){const l=e[f];if(l.key===g)l.layer.refLayerId=h;else if(g=l.key,h=l.layer.id,l.layer.type===A.StyleLayerType.FILL){if(!l.layer.getPaintProperty("fill-outline-color"))for(var c=f+1;c<b;c++){var d=e[c];if(d.key===g){if(d.layer.getPaintProperty("fill-outline-color")){e[f]=d;e[c]=l;h=d.layer.id;break}}else break}}else if(l.layer.type===A.StyleLayerType.LINE)for(c=l.layer,d=f+1;d<b;d++){const x=e[d];if(x.key!==g)break;const n=
x.layer;if(c.canUseThinTessellation&&!n.canUseThinTessellation||!c.canUseThinTessellation&&(n.getPaintProperty("line-pattern")||n.getPaintProperty("line-dasharray")))c=n,e[f]=x,e[d]=l,h=x.layer.id}}}_create(e,g,h){g=1-1/(h.length+1)*(1+g);h=this._runningId++;switch(e.type){case "background":return new z.BackgroundStyleLayer(A.StyleLayerType.BACKGROUND,e,g,h);case "fill":return new z.FillStyleLayer(A.StyleLayerType.FILL,e,g,h);case "line":return new z.LineStyleLayer(A.StyleLayerType.LINE,e,g,h);case "symbol":return new z.SymbolStyleLayer(A.StyleLayerType.SYMBOL,
e,g,h);case "raster":console.warn(`Unsupported vector tile raster layer ${e.id}`);break;case "circle":return new z.CircleStyleLayer(A.StyleLayerType.CIRCLE,e,g,h)}return null}static _recreateLayer(e,g){switch(e.type){case "background":return new z.BackgroundStyleLayer(A.StyleLayerType.BACKGROUND,e,g.z,g.uid);case "fill":return new z.FillStyleLayer(A.StyleLayerType.FILL,e,g.z,g.uid);case "line":return new z.LineStyleLayer(A.StyleLayerType.LINE,e,g.z,g.uid);case "symbol":return new z.SymbolStyleLayer(A.StyleLayerType.SYMBOL,
e,g.z,g.uid);case "raster":console.warn(`Unsupported vector tile raster layer ${e.id}`);break;case "circle":return new z.CircleStyleLayer(A.StyleLayerType.CIRCLE,e,g.z,g.uid)}return null}}return B})},"esri/views/2d/layers/LayerView2D":function(){define("exports ../../../chunks/tslib.es6 ../../../core/Collection ../../../core/collectionUtils ../../../core/Error ../../../core/Logger ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ../../../linkChart/utils ../engine/Container ./support/util ../support/HighlightGroup ../support/highlightGroupUtils ../support/HighlightOptions ../../layers/support/ClipRect ../../layers/support/Geometry ../../layers/support/Path ../../support/layerViewUtils".split(" "),
function(A,z,B,e,g,h,b,c,d,f,l,x,n,m,p,C,H,y,E,G,K){const M=B.ofType({key:"type",base:null,typeMap:{rect:y,path:G,geometry:E}}),P=new (B.ofType(p.HighlightGroup));A.LayerView2DMixin=q=>{q=class extends q{constructor(){super(...arguments);this.attached=!1;this.clips=new M;this.highlights=null;this.lastUpdateId=-1;this.updateRequested=this.moving=!1;this._visibleAtCurrentScale=!0}initialize(){const v=this.view?.spatialReferenceLocked??!0;this.view?.spatialReference&&v&&!this.spatialReferenceSupported?
this.addResolvingPromise(Promise.reject(new g("layerview:spatial-reference-incompatible","The spatial reference of this layer does not meet the requirements of the view",{layer:this.layer}))):(this.container||(this.container=new n.Container),this.container.fadeTransitionEnabled=!0,this.container.visible=!1,this.container.endTransitions(),this.addHandles([b.watch(()=>this.suspended,k=>{this.container&&(this.container.visible=!k)},b.syncAndInitial),b.watch(()=>this.updateSuspended,k=>{this.view&&!k&&
this.updateRequested&&this.view.requestUpdate()},b.syncAndInitial),b.watch(()=>this.layer?.opacity??1,k=>{this.container&&(this.container.opacity=k)},b.syncAndInitial),b.watch(()=>this.layer&&"blendMode"in this.layer?this.layer.blendMode:"normal",k=>{this.container&&(this.container.blendMode=k)},b.syncAndInitial),b.watch(()=>this.layer&&"effect"in this.layer?this.layer.effect:null,k=>{this.container&&(this.container.effect=k)},b.syncAndInitial),b.watch(()=>this._mergedHighlights.items.map(k=>({name:k.name,
options:{fillColor:k.options.color,haloColor:k.options.haloColor,fillOpacity:k.options.fillOpacity,haloOpacity:k.options.haloOpacity,haloWidth:k.options.haloWidth,haloBlur:k.options.haloBlur}})),()=>{this.container.highlightGradient=m.createOrReuseHighlightGradient(this.container.highlightGradient,this._mergedHighlights.items)},b.syncAndInitial),b.watch(()=>this._mergedHighlights.items.map(k=>k.name),()=>{this._updateHighlights()}),b.on(()=>this.clips,"change",()=>{this.container&&(this.container.clips=
this.clips)},b.syncAndInitial),b.watch(()=>({scale:this.view?.scale,scaleRange:this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null}),({scale:k,scaleRange:t})=>{k=K.isInEffectiveScaleRange(t,k);k!==this._visibleAtCurrentScale&&(this._visibleAtCurrentScale=k)},b.syncAndInitial)],"constructor"),this.view?.whenLayerView?this.view.whenLayerView(this.layer).then(k=>{k===this&&this.processAttach()},()=>{}):this.when().then(()=>{this.processAttach()},()=>{}))}_updateHighlights(){}destroy(){this.processDetach();
this.updateRequested=!1}get highlightOptions(){return C.getDefaultHighlightOptions(this)}set highlightOptions(v){C.setDefaultHighlightOptions(this,v)}get _mergedHighlights(){if(!this.view)return P;if(!this.highlights)return this.view.highlights;const v=this.view.highlights.clone();for(const k of this.highlights){const t=v.find(u=>u.name===k.name);t&&(t.options=k.options)}return v}get scheduler(){return this.view.scheduler}get spatialReferenceSupported(){const v=this.view?.spatialReference;return null==
v||this.supportsSpatialReference(v)}get updating(){return this.spatialReferenceSupported&&(!this.attached||!this.suspended&&(this.updateRequested||this.isUpdating())||!!this._updatingHandles?.updating||this.container.transitioning)}get visibleAtCurrentScale(){return this._visibleAtCurrentScale}processAttach(){this.isResolved()&&!this.attached&&!this.destroyed&&this.spatialReferenceSupported&&(this.attach(),this.attached=!0,this.requestUpdate())}processDetach(){this.attached&&(this.attached=!1,this.removeHandles("attach"),
this.detach(),this.updateRequested=!1)}requestUpdate(){this.destroyed||this.updateRequested||(this.updateRequested=!0,this.updateSuspended||this.view.requestUpdate())}processUpdate(v){this.isFulfilled()&&!this.isResolved()?this.updateRequested=!1:(this._set("updateParameters",v),this.updateRequested&&!this.updateSuspended&&(this.updateRequested=!1,this.update(v)))}hitTest(v,k){return Promise.resolve(null)}supportsSpatialReference(v){return!0}canResume(){if(!this.spatialReferenceSupported)return!1;
switch(this.layer?.type){case "link-chart":case "knowledge-graph-sublayer":break;default:if(x.isLinkChartView(this.view)&&!this.view.inGeographicLayout)return!1}return super.canResume()?this.visibleAtCurrentScale:!1}getSuspendInfo(){const v=super.getSuspendInfo(),k=!this.spatialReferenceSupported;k&&(v.spatialReferenceNotSupported=k);return v}addAttachHandles(v){this.addHandles(v,"attach")}_getHighlightBits(v){v=new Set(v);let k=1,t=0;if(!this.view)return 0;const u=this._mergedHighlights;for(const {name:D}of u)v.delete(D)&&
(t=k),k<<=1;for(const D of v)h.getLogger(this).error("#highlights",`${D} was not found. Features in this group will not be highlighted.`);return t}};z.__decorate([c.property()],q.prototype,"attached",void 0);z.__decorate([c.property({type:M,set(v){v=e.referenceSetter(v,this._get("clips"),M);this._set("clips",v)}})],q.prototype,"clips",void 0);z.__decorate([c.property()],q.prototype,"container",void 0);z.__decorate([c.property({type:H})],q.prototype,"highlightOptions",null);z.__decorate([c.property({type:B.ofType(p.HighlightGroup)})],
q.prototype,"highlights",void 0);z.__decorate([c.property()],q.prototype,"_mergedHighlights",null);z.__decorate([c.property()],q.prototype,"moving",void 0);z.__decorate([c.property({readOnly:!0})],q.prototype,"spatialReferenceSupported",null);z.__decorate([c.property({readOnly:!0})],q.prototype,"updateParameters",void 0);z.__decorate([c.property()],q.prototype,"updateRequested",void 0);z.__decorate([c.property()],q.prototype,"updating",null);z.__decorate([c.property()],q.prototype,"view",void 0);
z.__decorate([c.property()],q.prototype,"_visibleAtCurrentScale",void 0);z.__decorate([c.property({readOnly:!0})],q.prototype,"visibleAtCurrentScale",null);return q=z.__decorate([l.subclass("esri.views.2d.layers.LayerView2D")],q)};Object.defineProperty(A,Symbol.toStringTag,{value:"Module"})})},"esri/linkChart/utils":function(){define(["exports"],function(A){A.isLinkChartView=function(z){return null!=z&&"object"===typeof z&&"2d"===z.type&&"linkchart"===z.view2dType};Object.defineProperty(A,Symbol.toStringTag,
{value:"Module"})})},"esri/views/layers/support/ClipRect":function(){define("../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ./ClipArea".split(" "),function(A,z,B,e,g,h,b){var c;B=c=class extends b{constructor(d){super(d);this.type="rect";this.bottom=this.top=this.right=this.left=null}clone(){return new c({left:this.left,right:this.right,top:this.top,bottom:this.bottom})}commitVersionProperties(){this.commitProperty("left");
this.commitProperty("right");this.commitProperty("top");this.commitProperty("bottom")}};A.__decorate([z.property({type:[Number,String],json:{write:!0}})],B.prototype,"left",void 0);A.__decorate([z.property({type:[Number,String],json:{write:!0}})],B.prototype,"right",void 0);A.__decorate([z.property({type:[Number,String],json:{write:!0}})],B.prototype,"top",void 0);A.__decorate([z.property({type:[Number,String],json:{write:!0}})],B.prototype,"bottom",void 0);return B=c=A.__decorate([h.subclass("esri.views.layers.support.ClipRect")],
B)})},"esri/views/layers/support/ClipArea":function(){define("../../../chunks/tslib.es6 ../../../core/JSONSupport ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass".split(" "),function(A,z,B,e,g,h,b){z=class extends z.JSONSupport{get version(){this.commitVersionProperties();return(this._get("version")||0)+1}};A.__decorate([B.property({readOnly:!0})],z.prototype,"version",null);return z=
A.__decorate([b.subclass("esri.views.layers.support.ClipArea")],z)})},"esri/views/layers/support/Geometry":function(){define("../../../chunks/tslib.es6 ../../../geometry ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ../../../geometry/Geometry ../../../geometry/support/jsonUtils ./ClipArea ../../../geometry/Extent ../../../geometry/Polygon".split(" "),function(A,z,B,e,g,h,b,c,d,f,l,
x){var n;z={base:c,key:"type",typeMap:{extent:l,polygon:x}};f=n=class extends f{constructor(m){super(m);this.type="geometry";this.geometry=null}clone(){return new n({geometry:this.geometry?.clone()??null})}commitVersionProperties(){this.commitProperty("geometry")}};A.__decorate([B.property({types:z,json:{read:d.fromJSON,write:!0}})],f.prototype,"geometry",void 0);return f=n=A.__decorate([b.subclass("esri.views.layers.support.Geometry")],f)})},"esri/views/layers/support/Path":function(){define("../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ./ClipArea".split(" "),
function(A,z,B,e,g,h,b){B=class extends b{constructor(c){super(c);this.type="path";this.path=[]}commitVersionProperties(){this.commitProperty("path")}};A.__decorate([z.property({type:[[[Number]]],json:{write:!0}})],B.prototype,"path",void 0);return B=A.__decorate([h.subclass("esri.views.layers.support.Path")],B)})},"esri/views/2d/tiling/TileInfoViewPOT":function(){define(["../../../layers/support/TileInfo","./TileInfoView","./TileKey"],function(A,z,B){class e extends z{constructor(){super(...arguments);
this._fullCacheLodInfos=null;this._levelByScale={}}getTileParentId(g){g=B.pool.acquire(g);const h=0===g.level?null:B.getId(g.level-1,g.row>>1,g.col>>1,g.world);B.pool.release(g);return h}getTileCoverage(g,h,b=!0,c){g=super.getTileCoverage(g,h,b,c);if(!g)return g;const d=1<<g.lodInfo.level;g.spans=g.spans.filter(f=>0<=f.row&&f.row<d);return g}scaleToLevel(g){this._fullCacheLodInfos||this._initializeFullCacheLODs(this._lodInfos);if(this._levelByScale[g])return this._levelByScale[g];var h=this._fullCacheLodInfos;
if(g>h[0].scale)return h[0].level;let b;for(let c=0;c<h.length-1;c++)if(b=h[c+1],g>b.scale)return h=h[c],h.level+(h.scale-g)/(h.scale-b.scale);return h[h.length-1].level}_initializeFullCacheLODs(g){g=0===g[0].level?g.map(h=>({level:h.level,resolution:h.resolution,scale:h.scale})):A.create({size:this.tileInfo.size[0],spatialReference:this.tileInfo.spatialReference}).lods.map(h=>({level:h.level,resolution:h.resolution,scale:h.scale}));for(let h=0;h<g.length;h++)this._levelByScale[g[h].scale]=g[h].level;
this._fullCacheLodInfos=g}}return e})},"esri/views/layers/RefreshableLayerView":function(){define("../../chunks/tslib.es6 ../../core/Logger ../../core/promiseUtils ../../core/reactiveUtils ../../core/has ../../core/RandomLCG ../../core/Error ../../core/accessorSupport/decorators/subclass".split(" "),function(A,z,B,e,g,h,b,c){return d=>{d=class extends d{initialize(){this.addHandles(e.on(()=>this.layer,"refresh",f=>{this.doRefresh(f.dataChanged).catch(l=>{B.isAbortError(l)||z.getLogger(this).error(l)})}),
"RefreshableLayerView")}};return d=A.__decorate([c.subclass("esri.views.layers.RefreshableLayerView")],d)}})},"*noref":1}});
define("../../../chunks/tslib.es6 ../../../core/lang ../../../core/Logger ../../../core/maybe ../../../core/promiseUtils ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/accessorSupport/decorators/subclass ../../../core/accessorSupport/diffUtils ../../../geometry/Point ../../../geometry/support/aaBoundingRect ../../../geometry/support/spatialReferenceUtils ../engine/vectorTiles/enums ../engine/vectorTiles/TileHandler ../engine/vectorTiles/TileManager ../engine/vectorTiles/VectorTile ../engine/vectorTiles/VectorTileContainer ../engine/vectorTiles/VectorTileFeatureIndex ../engine/vectorTiles/style/StyleDefinition ../engine/vectorTiles/style/StyleRepository ./LayerView2D ../tiling/TileInfoViewPOT ../tiling/TileQueue ../../layers/LayerView ../../layers/RefreshableLayerView ../../support/Scheduler".split(" "),function(A,
z,B,e,g,h,b,c,d,f,l,x,n,m,p,C,H,y,E,G,K,M,P,q,v,k){function t(u){if(null==u)return 0;switch(u.type){case "partial":return Object.keys(u.diff).length;case "complete":return Math.max(Object.keys(u.oldValue).length,Object.keys(u.newValue).length);case "collection":return Object.keys(u.added).length+Object.keys(u.changed).length+Object.keys(u.removed).length}}b=class extends v(K.LayerView2DMixin(q)){constructor(){super(...arguments);this._styleChanges=[];this._tileHandlerPromise=this._parseQueue=this._fetchQueue=
null;this._spriteSourceChanged=this._styeChanged=this._isTileHandlerReady=!1}get fading(){return this._vectorTileContainer?.fading??!1}get hasVisibleFeatures(){const u=this._vectorTileContainer.children;for(const D of u)if(D.hasFeatures())return!0;return!1}get spriteSourceChanged(){return this._spriteSourceChanged}get styleChanged(){return this._styeChanged}async hitTest(u,D){var F=this._tileHandlerPromise,L=this._vectorTileContainer?.symbolFader;if(F&&this._isTileHandlerReady&&L){await F;F=null;
var J=this._vectorTileContainer?.symbolRepository;J&&(F=J.querySymbols(D,2,L.decluttererOffset,{}));D=this._tileManager.getIntersectingTiles(D.x,D.y,2,this.view.state,F);if((!D||0===D.length)&&0===F?.length)return null;u=u.clone().normalize();L=[];J=[];for(const O of D)L.push(this._queryTile(J,u,2,this.view.state.rotation,O,F?.filter(Q=>Q.tileKey.id===O.id)));await Promise.all(L);return J}}update(u){this._tileHandlerPromise&&this._isTileHandlerReady&&(u.pixelRatio!==this._tileHandler.devicePixelRatio?
(this._start(),this._tileHandler.devicePixelRatio=u.pixelRatio):0<this._styleChanges.length?this._tileHandlerPromise=this._applyStyleChanges():(this._pauseQueues(),this._fetchQueue.state=u.state,this._parseQueue.state=u.state,this._tileManager.update(u)||this.requestUpdate(),this._resumeQueues()))}attach(){const {style:u}=this.layer.currentStyleInfo;this._styleRepository=new G(u);this._tileInfoView=new M(this.layer.tileInfo,this.layer.fullExtent);this._vectorTileContainer=new H.VectorTileContainer(this._tileInfoView);
this._tileHandler=new m.TileHandler(this.layer,this._styleRepository,window.devicePixelRatio||1,this.layer.tileInfo.lods.length-1);this.container.addChild(this._vectorTileContainer);this._start();this.addAttachHandles([this.layer.on("paint-change",D=>{this._styeChanged=!0;if(D.isDataDriven)this._styleChanges.push({type:n.StyleUpdateType.PAINTER_CHANGED,data:D}),this.requestUpdate();else{const L=this._styleRepository;var F=L.getLayerById(D.layer);F&&(F=F.type===E.StyleLayerType.SYMBOL,L.setPaintProperties(D.layer,
D.paint),F&&this._vectorTileContainer?.restartDeclutter(),this._vectorTileContainer?.requestRender())}}),this.layer.on("layout-change",D=>{const F=this._styleRepository,L=F.getLayerById(D.layer);if(L){this._styeChanged=!0;var J=d.diff(L.layout,D.layout);null!=J&&(d.hasDiff(J,"visibility")&&1===t(J)?(F.setLayoutProperties(D.layer,D.layout),L.type===E.StyleLayerType.SYMBOL&&this._vectorTileContainer?.restartDeclutter(),this._vectorTileContainer?.requestRender()):(this._styleChanges.push({type:n.StyleUpdateType.LAYOUT_CHANGED,
data:D}),this.requestUpdate()))}}),this.layer.on("style-layer-visibility-change",D=>{const F=this._styleRepository,L=F.getLayerById(D.layer);L&&(this._styeChanged=!0,F.setStyleLayerVisibility(D.layer,D.visibility),L.type===E.StyleLayerType.SYMBOL&&this._vectorTileContainer?.restartDeclutter(),this._vectorTileContainer?.requestRender())}),this.layer.on("style-layer-change",D=>{this._styleChanges.push({type:n.StyleUpdateType.LAYER_CHANGED,data:D});this._styeChanged=!0;this.requestUpdate()}),this.layer.on("delete-style-layer",
D=>{this._styleChanges.push({type:n.StyleUpdateType.LAYER_REMOVED,data:D});this._styeChanged=!0;this.requestUpdate()}),this.layer.on("load-style",()=>this._loadStyle()),this.layer.on("spriteSource-change",D=>{this._spriteSourceChanged=!0;this._styleChanges.push({type:n.StyleUpdateType.SPRITES_CHANGED,data:D});D=this._styleRepository.layers;for(const F of D)switch(F.type){case E.StyleLayerType.SYMBOL:F.getLayoutProperty("icon-image")&&this._styleChanges.push({type:n.StyleUpdateType.LAYOUT_CHANGED,
data:{layer:F.id,layout:F.layout}});break;case E.StyleLayerType.LINE:F.getPaintProperty("line-pattern")&&this._styleChanges.push({type:n.StyleUpdateType.PAINTER_CHANGED,data:{layer:F.id,paint:F.paint,isDataDriven:F.isPainterDataDriven()}});break;case E.StyleLayerType.FILL:F.getLayoutProperty("fill-pattern")&&this._styleChanges.push({type:n.StyleUpdateType.PAINTER_CHANGED,data:{layer:F.id,paint:F.paint,isDataDriven:F.isPainterDataDriven()}})}this.requestUpdate()})])}detach(){this._stop();this.container.removeAllChildren();
this._vectorTileContainer=e.destroyMaybe(this._vectorTileContainer);this._tileHandler=e.destroyMaybe(this._tileHandler)}viewChange(){this.requestUpdate()}moveEnd(){this.requestUpdate()}supportsSpatialReference(u){return x.equals(this.layer.tileInfo?.spatialReference,u)}canResume(){let u=super.canResume();const {currentStyleInfo:D}=this.layer;if(u&&D?.layerDefinition){const F=this.view.scale,{minScale:L,maxScale:J}=D.layerDefinition;D?.layerDefinition&&(L&&L<F&&(u=!1),J&&J>F&&(u=!1))}return u}isUpdating(){return this.fading}acquireTile(u){const D=
this._createVectorTile(u);this._updatingHandles.addPromise(this._fetchQueue.push(D.key).then(F=>this._parseQueue.push({key:D.key,data:F})).then(F=>{D.once("attach",()=>this.requestUpdate());D.setData(F);this.requestUpdate()}).catch(F=>{g.isAbortError(F)||B.getLogger(this).error(F)}));return D}releaseTile(u){u=u.key.id;this._fetchQueue.abort(u);this._parseQueue.abort(u);this.requestUpdate()}async doRefresh(){if(this.attached){if(this.suspended)this._tileManager.clear();else{this._isTileHandlerReady=
!1;this._pauseQueues();this._clearQueues();this._tileManager.clearCache();this._resumeQueues();var u=this._vectorTileContainer.children,D=[];try{for(const F of u){const L=this._updatingHandles.addPromise(this._fetchQueue.push(F.key).then(J=>this._parseQueue.push({key:F.key,data:J})).then(J=>F.setData(J)).finally(()=>F.featureIndex=null));D.push(L)}await Promise.all(D)}catch(F){B.getLogger(this).error("error refreshing vector-tiles layer-view",F),this._resumeQueues(),this._isTileHandlerReady=!0}this._isTileHandlerReady=
!0}this.requestUpdate()}}_start(){this._stop();this._tileManager=new p.TileManager({acquireTile:F=>this.acquireTile(F),releaseTile:F=>this.releaseTile(F),tileInfoView:this._tileInfoView},this._vectorTileContainer);if(this.layer.currentStyleInfo){var u=new AbortController,D=this._tileHandler.start({signal:u.signal}).then(()=>{this._fetchQueue=new P({tileInfoView:this._tileInfoView,process:(F,L)=>this._getTileData(F,L),concurrency:15,scheduler:this.scheduler,priority:k.TaskPriority.MAPVIEW_FETCH_QUEUE});
this._parseQueue=new P({tileInfoView:this._tileInfoView,process:(F,L)=>this._parseTileData(F,L),concurrency:8,scheduler:this.scheduler,priority:k.TaskPriority.MAPVIEW_VECTOR_TILE_PARSING_QUEUE});this.requestUpdate();this._isTileHandlerReady=!0});this._tileHandler.spriteMosaic.then(F=>{this._vectorTileContainer.setStyleResources(F,this._tileHandler.glyphMosaic,this._styleRepository,this._tileInfoView);this.requestUpdate()});this._tileHandlerAbortController=u;this._tileHandlerPromise=D}}_stop(){if(this._tileHandlerAbortController&&
this._vectorTileContainer){var u=this._tileHandlerAbortController;u&&u.abort();this._tileHandlerPromise=null;this._isTileHandlerReady=!1;this._fetchQueue=e.destroyMaybe(this._fetchQueue);this._parseQueue=e.destroyMaybe(this._parseQueue);this._tileManager=e.destroyMaybe(this._tileManager);this._vectorTileContainer.removeAllChildren()}}async _getTileData(u,D){return this._tileHandler.fetchTileData(u,D)}async _parseTileData(u,D){return this._tileHandler.parseTileData(u,D)}async _applyStyleChanges(){this._isTileHandlerReady=
!1;this._pauseQueues();this._clearQueues();this._tileManager.clearCache();var u=this._styleChanges;try{await this._tileHandler.updateStyle(u)}catch(O){B.getLogger(this).error("error applying vector-tiles style update",O.message),this._resumeQueues(),this._isTileHandlerReady=!0}const D=this._styleRepository,F=new Set;u.forEach(O=>{O.type===n.StyleUpdateType.LAYER_REMOVED&&(O=D.getLayerById(O.data.layer))&&F.add(O.uid)});const L=new Set;u.forEach(O=>{let Q;switch(O.type){case n.StyleUpdateType.PAINTER_CHANGED:D.setPaintProperties(O.data.layer,
O.data.paint);Q=O.data.layer;break;case n.StyleUpdateType.LAYOUT_CHANGED:D.setLayoutProperties(O.data.layer,O.data.layout);Q=O.data.layer;break;case n.StyleUpdateType.LAYER_REMOVED:D.deleteStyleLayer(O.data.layer);return;case n.StyleUpdateType.LAYER_CHANGED:D.setStyleLayer(O.data.layer,O.data.index);Q=O.data.layer.id;break;case n.StyleUpdateType.SPRITES_CHANGED:this._vectorTileContainer.setSpriteMosaic(this._tileHandler.setSpriteSource(O.data.spriteSource))}Q&&(O=D.getLayerById(Q))&&L.add(O.uid)});
u=this._vectorTileContainer.children;if(0<F.size){const O=Array.from(F);this._vectorTileContainer.deleteStyleLayers(O);for(var J of u)J.deleteLayerData(O)}this._resumeQueues();if(0<L.size){const O=Array.from(L);J=[];for(const Q of u)u=this._updatingHandles.addPromise(this._fetchQueue.push(Q.key).then(S=>this._parseQueue.push({key:Q.key,data:S,styleLayerUIDs:O})).then(S=>Q.setData(S)).finally(()=>Q.featureIndex=null)),J.push(u);await Promise.all(J)}this._styleChanges=[];this._isTileHandlerReady=!0;
this.requestUpdate()}async _loadStyle(){var {style:u}=this.layer.currentStyleInfo;u=z.clone(u);this._isTileHandlerReady=!1;this._pauseQueues();this._clearQueues();this._styleRepository=new G(u);this._vectorTileContainer.destroy();this._tileManager.clear();this._tileHandlerAbortController.abort();this._tileHandlerAbortController=new AbortController;var {signal:D}=this._tileHandlerAbortController;try{this._tileHandlerPromise=this._tileHandler.setStyle(this._styleRepository,u,this.layer.tileInfo.lods.length-
1),await this._tileHandlerPromise}catch(F){if(!g.isAbortError(F))throw F;}D.aborted?(this._resumeQueues(),this._isTileHandlerReady=!0,this._spriteSourceChanged=this._styeChanged=!1,this.requestUpdate()):(u=await this._tileHandler.spriteMosaic,D=this._vectorTileContainer,this._tileInfoView=new M(this.layer.tileInfo,this.layer.fullExtent),D.setStyleResources(u,this._tileHandler.glyphMosaic,this._styleRepository,this._tileInfoView),this._tileManager=new p.TileManager({acquireTile:F=>this.acquireTile(F),
releaseTile:F=>this.releaseTile(F),tileInfoView:this._tileInfoView},this._vectorTileContainer),this._resumeQueues(),this._isTileHandlerReady=!0,this.requestUpdate(),this._spriteSourceChanged=this._styeChanged=!1)}_createVectorTile(u){const D=this._tileInfoView.getTileBounds(l.create(),u),F=this._tileInfoView.getTileResolution(u.level);return new C.VectorTile(u,F,D[0],D[3],512,512,this._styleRepository)}async _queryTile(u,D,F,L,J,O){if(0!==J.layerData.size){var Q=this._ensureTileIndex(J),S=this._tileInfoView.getTileBounds(l.create(),
J.key,!0);F=await Q.queryAttributes((D.x-S[0])/(S[2]-S[0])*4096,4096*(1-(D.y-S[1])/(S[3]-S[1])),F,L,O);for(const X of F)X.graphic.geometry=this._tileToMapPoint(X.tilePoint,J.transforms.tileUnitsToPixels),u.push({type:"graphic",layer:this.layer,graphic:X.graphic,mapPoint:D.clone()});u.sort((X,W)=>W.graphic.origin.layerIndex-X.graphic.origin.layerIndex)}}_tileToMapPoint(u,D){if(!u)return null;const F=this.view.state,L=[0,0];F.toMap(L,[u[0]*D[0]+u[1]*D[3]+D[6],u[0]*D[1]+u[1]*D[4]+D[7]]);return new f({x:L[0],
y:L[1],spatialReference:F.spatialReference})}_ensureTileIndex(u){let D=u.featureIndex;D||(D=y.create(u.key,u.layerData,this._styleRepository,this._tileHandler,this.layer),u.featureIndex=D);return D}_pauseQueues(){this._fetchQueue.pause();this._parseQueue.pause()}_resumeQueues(){this._fetchQueue.resume();this._parseQueue.resume()}_clearQueues(){this._fetchQueue.clear();this._parseQueue.clear()}};A.__decorate([h.property()],b.prototype,"_isTileHandlerReady",void 0);return b=A.__decorate([c.subclass("esri.views.2d.layers.VectorTileLayerView2D")],
b)});