// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.31/esri/copyright.txt for details.
//>>built
require({cache:{"esri/views/2d/engine/flow/FlowView2D":function(){define("../../../../chunks/tslib.es6 ../../../../Graphic ../../../../core/Accessor ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/Logger ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ./createFlowStyle ./dataUtils ./FlowContainer ./FlowStrategy".split(" "),function(p,y,D,G,F,N,z,u,S,W,J,n,A){D=class extends D{constructor(){super(...arguments);
this._loadImagery=(M,q,t,r,B)=>J.loadImagery(this.layer,M,q,t,r,B);this._createFlowMesh=(M,q,t,r)=>this.layer.createFlowMesh({meshType:M,flowData:t,simulationSettings:q},{signal:r});this.attached=!1;this.type="flow";this.timeExtent=null;this.redrawOrRefetch=async()=>{this._updateVisualization()}}get updating(){return!this.attached||this._strategy.updating}attach(){const {layer:M}=this,q=()=>{this._loadImagery=(t,r,B,R,a)=>J.loadImagery(M,t,r,B,R,a);this._updateVisualization()};"multidimensionalDefinition"in
M?this.addHandles(G.watch(()=>M.multidimensionalDefinition,q)):this.addHandles([G.watch(()=>M.mosaicRule,q),G.watch(()=>M.rasterFunction,q),G.watch(()=>M.definitionExpression,q)]);this.container=new n;this._strategy=new A({flowContainer:this.container});this._updateVisualization()}detach(){this._strategy.destroy();this.container?.removeAllChildren();this.container=null;this.removeHandles()}update(M){M.stationary?this._strategy.update(M):this.layerView.requestUpdate()}hitTest(M){return new y({attributes:{},
geometry:M.clone(),layer:this.layer})}moveEnd(){}async doRefresh(){}_updateVisualization(){var M=this.layer.renderer;null!=M&&"flow"===M.type&&(M=W(M,{loadImagery:this._loadImagery,createFlowMesh:this._createFlowMesh,timeExtent:this.timeExtent}),this.container.flowStyle=M,this.layerView.requestUpdate())}};p.__decorate([F.property()],D.prototype,"_strategy",void 0);p.__decorate([F.property()],D.prototype,"attached",void 0);p.__decorate([F.property()],D.prototype,"container",void 0);p.__decorate([F.property()],
D.prototype,"layer",void 0);p.__decorate([F.property()],D.prototype,"layerView",void 0);p.__decorate([F.property()],D.prototype,"type",void 0);p.__decorate([F.property()],D.prototype,"updating",null);p.__decorate([F.property()],D.prototype,"timeExtent",void 0);return D=p.__decorate([S.subclass("esri.views.2d.engine.flow.FlowView2D")],D)})},"esri/views/2d/engine/flow/createFlowStyle":function(){define(["./utils","./styles/Imagery","./styles/Particles","./styles/Stack","./styles/Streamlines"],function(p,
y,D,G,F){return function(N,z){const {flowSpeed:u,trailLength:S}=N,W=p.getFlowSimulationSettings(N);let J=null;const n={opacity:p.getOpacity(N),size:p.getSize(N)};let A=p.getColor(N);"none"===N.background?n.color=A:("constant"===A.kind&&(A={kind:"ramp",stops:[0,1],values:[0,0,0,1,A.value[0],A.value[1],A.value[2],A.value[3]],count:2}),J=new y.Imagery({loadImagery:z.loadImagery,timeExtent:z.timeExtent,color:A,opacity:{kind:"constant",value:[1]}}),n.color=p.getForegroundColor());z={loadImagery:z.loadImagery,
createFlowMesh:z.createFlowMesh,simulationSettings:W,timeExtent:z.timeExtent,trailLength:S,flowSpeed:u,featheringSize:1,featheringOffset:.5,introFade:!0,fadeToZero:!0,decayRate:2.3,color:n.color,opacity:n.opacity,size:n.size};N="butt"===N.trailCap||4>=p.getMax(p.getSize(N))?new F(z):new D.Particles(z);return null!=J?new G.Stack([J,N]):N}})},"esri/views/2d/engine/flow/utils":function(){define(["exports","../../../../core/screenUtils"],function(p,y){function D(u){return"constant"===u.kind?u.value[0]:
u.values[u.values.length-1]}function G(u){u=u.toRgba();return[u[0]/255,u[1]/255,u[2]/255,u[3]]}function F(u){if(!u.hasVisualVariables("size"))return{kind:"constant",value:[y.pt2px(u.trailWidth)]};const S=u.getVisualVariablesForType("size")[0];u=[];const W=[];if(S.stops){for(J of S.stops)u.push(J.value),W.push(y.pt2px(J.size));var J=S.stops.length}else u.push(S.minDataValue,S.maxDataValue),W.push(y.pt2px(S.minSize),y.pt2px(S.maxSize)),J=2;return{kind:"ramp",stops:u,values:W,count:J}}function N(u,S,
W,J){switch(S){case "int":u.setUniform1iv(W,J);break;case "float":u.setUniform1fv(W,J);break;case "vec2":u.setUniform2fv(W,J);break;case "vec3":u.setUniform3fv(W,J);break;case "vec4":u.setUniform4fv(W,J)}}function z(u,S){return u===S?!0:null!=u&&null!=S?u.equals(S):!1}p.areStreamlinesCompatible=function(u,S){var W=u.simulationSettings,J=S.simulationSettings;let n;n=(n=(n=(n=(n=(n=(n=(n=(n=(n=(n=W.collisions===J.collisions)&&W.density===J.density)&&W.interpolate===J.interpolate)&&W.lineCollisionWidth===
J.lineCollisionWidth)&&W.lineSpacing===J.lineSpacing)&&W.maxTurnAngle===J.maxTurnAngle)&&W.minSpeedThreshold===J.minSpeedThreshold)&&W.segmentLength===J.segmentLength)&&W.smoothing===J.smoothing)&&W.velocityScale===J.velocityScale)&&W.verticesPerLine===J.verticesPerLine;return n&&z(u.timeExtent,S.timeExtent)?W=(W=(W=(W=(W=u.loadImagery===S.loadImagery)&&u.createFlowMesh===S.createFlowMesh)&&u.color.kind===S.color.kind)&&u.opacity.kind===S.opacity.kind)&&u.size.kind===S.size.kind:!1};p.getColor=function(u){if(!u.hasVisualVariables("color"))return{kind:"constant",
value:G(u.color)};u=u.getVisualVariablesForType("color")[0];const S=[],W=[];for(const J of u.stops)S.push(J.value),Array.prototype.push.apply(W,G(J.color));return{kind:"ramp",stops:S,values:W,count:u.stops.length}};p.getFlowSimulationSettings=function(u){var S=F(u);S=D(S);const W=Math.max(S/2,5),J=Math.round(y.pt2px(u.maxPathLength)/W)+1,{density:n}=u;return{smoothing:y.pt2px(u.smoothing),interpolate:!0,velocityScale:"flow-from"===u.flowRepresentation?1:-1,verticesPerLine:J,minSpeedThreshold:.001,
segmentLength:W,maxTurnAngle:1,collisions:!0,lineCollisionWidth:S,lineSpacing:10,density:n}};p.getForegroundColor=function(u){return{kind:"constant",value:[.1,.1,.1,1]}};p.getMax=D;p.getOpacity=function(u){if(!u.hasVisualVariables("opacity"))return{kind:"constant",value:[1]};u=u.getVisualVariablesForType("opacity")[0];const S=[],W=[];for(const J of u.stops)S.push(J.value),W.push(J.opacity);return{kind:"ramp",stops:S,values:W,count:u.stops.length}};p.getSize=F;p.setUniform=N;p.setUniforms=function(u,
S,W,J){"constant"===J.kind?N(u,W,`u_${S}`,J.value):(N(u,"float",`u_${S}_stops`,J.stops),N(u,W,`u_${S}_values`,J.values),u.setUniform1i(`u_${S}_count`,J.count))};p.timeExtentsEqual=z;p.toRgba=G;Object.defineProperty(p,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/flow/styles/Imagery":function(){define("exports ../../../../../core/promiseUtils ../utils ../../../../webgl/BufferObject ../../../../webgl/enums ../../../../webgl/Texture ../../../../webgl/TextureDescriptor ../../../../webgl/VertexArrayObject ../../../../webgl/VertexElementDescriptor".split(" "),
function(p,y,D,G,F,N,z,u,S){class W{constructor(q){this._params=q;this.animated=!1}isCompatible(q){if(!(q instanceof W&&D.timeExtentsEqual(this._params.timeExtent,q._params.timeExtent)))return!1;let t;return t=(t=(t=this._params.loadImagery===q._params.loadImagery)&&this._params.color.kind===q._params.color.kind)&&this._params.opacity.kind===q._params.opacity.kind}async load(q,t){const {extent:r,size:B}=q;y.throwIfAborted(t);q=await this._params.loadImagery(r,B[0],B[1],this._params.timeExtent,t);
return new M(q,{color:this._params.color,opacity:this._params.opacity})}render(q,t,r){({context:q}=q);const {program:B}=r;q.setFaceCullingEnabled(!1);q.setBlendingEnabled(!0);q.setBlendFunction(F.BlendFactor.ONE,F.BlendFactor.ONE_MINUS_SRC_ALPHA);q.useProgram(B);B.setUniformMatrix3fv("u_dvsMat3",t.dvsMat3);q.bindTexture(r.texture,0);B.setUniform1i("u_texture",0);B.setUniform1f("u_Min",r.min);B.setUniform1f("u_Max",r.max);D.setUniforms(B,"color","vec4",this._params.color);D.setUniforms(B,"opacity",
"float",this._params.opacity);q.bindVAO(r.vertexArray);q.drawArrays(F.PrimitiveType.TRIANGLE_STRIP,0,4)}}const J=new Map;J.set("a_position",0);J.set("a_texcoord",1);const n=new Map([["geometry",[new S.VertexElementDescriptor("a_position",2,F.DataType.UNSIGNED_SHORT,0,8),new S.VertexElementDescriptor("a_texcoord",2,F.DataType.UNSIGNED_SHORT,4,8)]]]),A={vsPath:"raster/flow/imagery",fsPath:"raster/flow/imagery",attributes:J};class M{constructor(q,t){this._flowData=q;this._values=t}attach(q){var {context:t}=
q;const {width:r,height:B}=this._flowData;var R=G.BufferObject.createVertex(t,F.Usage.STATIC_DRAW,new Uint16Array([0,0,0,1,r,0,1,1,0,B,0,0,r,B,1,0]));R=new Map([["geometry",R]]);R=new u.VertexArrayObject(t,J,n,R);var a=[];"ramp"===this._values.color.kind&&a.push("vvColor");"ramp"===this._values.opacity.kind&&a.push("vvOpacity");q=q.painter.materialManager.getProgram(A,a);a=1E6;let b=-1E6;for(var d=0;d<B;d++)for(var g=0;g<r;g++)if(0!==this._flowData.mask[d*r+g]){var c=this._flowData.data[2*(d*r+g)],
f=this._flowData.data[2*(d*r+g)+1];c=Math.sqrt(c*c+f*f);a=Math.min(a,c);b=Math.max(b,c)}d=new Uint8Array(4*r*B);for(g=0;g<B;g++)for(c=0;c<r;c++)if(0!==this._flowData.mask[g*r+c]){f=this._flowData.data[2*(g*r+c)];const h=this._flowData.data[2*(g*r+c)+1];d[4*(g*r+c)]=(Math.sqrt(f*f+h*h)-a)/(b-a)*255;d[4*(g*r+c)+1]=0;d[4*(g*r+c)+2]=0;d[4*(g*r+c)+3]=255}else d[4*(g*r+c)]=0,d[4*(g*r+c)+1]=0,d[4*(g*r+c)+2]=0,d[4*(g*r+c)+3]=0;g=new z.TextureDescriptor;g.internalFormat=F.PixelFormat.RGBA;g.wrapMode=F.TextureWrapMode.CLAMP_TO_EDGE;
g.flipped=!0;g.width=r;g.height=B;t=new N.Texture(t,g,d);this.vertexArray=R;this.program=q;this.texture=t;this.min=a;this.max=b;this._flowData=null}detach(){this.vertexArray.dispose();this.texture.dispose()}get ready(){return this.program.compiled}}p.Imagery=W;p.ImageryResources=M;Object.defineProperty(p,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/flow/styles/Particles":function(){define("exports ../../../../../core/promiseUtils ../utils ../../../../webgl/BufferObject ../../../../webgl/enums ../../../../webgl/VertexArrayObject ../../../../webgl/VertexElementDescriptor".split(" "),
function(p,y,D,G,F,N,z){class u{constructor(A){this._params=A}get animated(){return 0<this._params.flowSpeed}isCompatible(A){return A instanceof u?D.areStreamlinesCompatible(this._params,A._params):!1}async load(A,M){const {extent:q,size:t}=A;y.throwIfAborted(M);A=await this._params.loadImagery(q,t[0],t[1],this._params.timeExtent,M);const {vertexData:r,indexData:B}=await this._params.createFlowMesh("Particles",this._params.simulationSettings,A,M);return new n(r,B,{color:this._params.color,opacity:this._params.opacity,
size:this._params.size})}render(A,M,q){({context:A}=A);const {program:t}=q;A.setFaceCullingEnabled(!1);A.setBlendingEnabled(!0);A.setBlendFunction(F.BlendFactor.ONE,F.BlendFactor.ONE_MINUS_SRC_ALPHA);A.useProgram(t);t.setUniform1f("u_time",M.time);t.setUniform1f("u_trailLength",this._params.trailLength);t.setUniform1f("u_flowSpeed",this._params.flowSpeed);t.setUniform1f("u_featheringSize",this._params.featheringSize);t.setUniform1f("u_featheringOffset",this._params.featheringOffset);t.setUniform1f("u_introFade",
this._params.introFade?1:0);t.setUniform1f("u_fadeToZero",this._params.fadeToZero?1:0);t.setUniform1f("u_decayRate",this._params.decayRate);t.setUniformMatrix3fv("u_dvsMat3",M.dvsMat3);t.setUniformMatrix3fv("u_displayViewMat3",M.displayViewMat3);D.setUniforms(t,"color","vec4",this._params.color);D.setUniforms(t,"opacity","float",this._params.opacity);D.setUniforms(t,"size","float",this._params.size);A.bindVAO(q.vertexArray);A.drawElements(F.PrimitiveType.TRIANGLES,q.indexCount,F.DataType.UNSIGNED_INT,
0)}}const S=new Map;S.set("a_xyts0",0);S.set("a_xyts1",1);S.set("a_typeIdDurationSeed",2);S.set("a_extrudeInfo",3);const W=new Map([["geometry",[new z.VertexElementDescriptor("a_xyts0",4,F.DataType.FLOAT,0,64),new z.VertexElementDescriptor("a_xyts1",4,F.DataType.FLOAT,16,64),new z.VertexElementDescriptor("a_typeIdDurationSeed",4,F.DataType.FLOAT,32,64),new z.VertexElementDescriptor("a_extrudeInfo",4,F.DataType.FLOAT,48,64)]]]),J={vsPath:"raster/flow/particles",fsPath:"raster/flow/particles",attributes:S};
class n{constructor(A,M,q){this._vertexData=A;this._indexData=M;this._values=q}attach(A){var {context:M}=A,q=G.BufferObject.createVertex(M,F.Usage.STATIC_DRAW,this._vertexData),t=G.BufferObject.createIndex(M,F.Usage.STATIC_DRAW,this._indexData);q=new Map([["geometry",q]]);M=new N.VertexArrayObject(M,S,W,q,t);t=[];"ramp"===this._values.color.kind&&t.push("vvColor");"ramp"===this._values.opacity.kind&&t.push("vvOpacity");"ramp"===this._values.size.kind&&t.push("vvSize");A=A.painter.materialManager.getProgram(J,
t);this.vertexArray=M;this.program=A;this.indexCount=this._indexData.length;this._indexData=this._vertexData=null}detach(){this.vertexArray.dispose()}get ready(){return this.program.compiled}}p.Particles=u;p.ParticlesResources=n;Object.defineProperty(p,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/flow/styles/Stack":function(){define(["exports"],function(p){class y{constructor(G){this._styles=G}get animated(){return this._styles.reduce((G,F)=>G||F.animated,!1)}isCompatible(G){if(!(G instanceof
y)||this._styles.length!==G._styles.length)return!1;const F=this._styles.length;for(let N=0;N<F;N++)if(!this._styles[N].isCompatible(G._styles[N]))return!1;return!0}async load(G,F){const N=await Promise.all(this._styles.map(z=>z.load(G,F)));return new D(N)}render(G,F,N){for(let z=0;z<this._styles.length;z++)this._styles[z].render(G,F,N.resources[z])}}class D{constructor(G){this.resources=G}attach(G){for(const F of this.resources)F.attach(G)}detach(){for(const G of this.resources)G.detach()}get ready(){return this.resources.reduce((G,
F)=>G&&F.ready,!0)}}p.Stack=y;p.StackResources=D;Object.defineProperty(p,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/flow/styles/Streamlines":function(){define("../../../../../core/promiseUtils ../utils ../../../../webgl/BufferObject ../../../../webgl/enums ../../../../webgl/VertexArrayObject ../../../../webgl/VertexElementDescriptor".split(" "),function(p,y,D,G,F,N){class z{constructor(n){this._params=n}get animated(){return 0<this._params.flowSpeed}isCompatible(n){return n instanceof
z?y.areStreamlinesCompatible(this._params,n._params):!1}async load(n,A){const {extent:M,size:q}=n;p.throwIfAborted(A);n=await this._params.loadImagery(M,q[0],q[1],this._params.timeExtent,A);const {vertexData:t,indexData:r}=await this._params.createFlowMesh("Streamlines",this._params.simulationSettings,n,A);return new J(t,r,{color:this._params.color,opacity:this._params.opacity,size:this._params.size})}render(n,A,M){({context:n}=n);const {program:q}=M;n.setFaceCullingEnabled(!1);n.setBlendingEnabled(!0);
n.setBlendFunction(G.BlendFactor.ONE,G.BlendFactor.ONE_MINUS_SRC_ALPHA);n.useProgram(q);q.setUniform1f("u_time",A.time);q.setUniform1f("u_trailLength",this._params.trailLength);q.setUniform1f("u_flowSpeed",this._params.flowSpeed);q.setUniform1f("u_featheringSize",this._params.featheringSize);q.setUniform1f("u_featheringOffset",this._params.featheringOffset);q.setUniform1f("u_introFade",this._params.introFade?1:0);q.setUniform1f("u_fadeToZero",this._params.fadeToZero?1:0);q.setUniform1f("u_decayRate",
this._params.decayRate);q.setUniformMatrix3fv("u_dvsMat3",A.dvsMat3);q.setUniformMatrix3fv("u_displayViewMat3",A.displayViewMat3);y.setUniforms(q,"color","vec4",this._params.color);y.setUniforms(q,"opacity","float",this._params.opacity);y.setUniforms(q,"size","float",this._params.size);n.bindVAO(M.vertexArray);n.drawElements(G.PrimitiveType.TRIANGLES,M.indexCount,G.DataType.UNSIGNED_INT,0)}}const u=new Map;u.set("a_positionAndSide",0);u.set("a_timeInfo",1);u.set("a_extrude",2);u.set("a_speed",3);
const S=new Map([["geometry",[new N.VertexElementDescriptor("a_positionAndSide",3,G.DataType.FLOAT,0,36),new N.VertexElementDescriptor("a_timeInfo",3,G.DataType.FLOAT,12,36),new N.VertexElementDescriptor("a_extrude",2,G.DataType.FLOAT,24,36),new N.VertexElementDescriptor("a_speed",1,G.DataType.FLOAT,32,36)]]]),W={vsPath:"raster/flow/streamlines",fsPath:"raster/flow/streamlines",attributes:u};class J{constructor(n,A,M){this._vertexData=n;this._indexData=A;this._values=M}attach(n){var {context:A}=n,
M=D.BufferObject.createVertex(A,G.Usage.STATIC_DRAW,this._vertexData),q=D.BufferObject.createIndex(A,G.Usage.STATIC_DRAW,this._indexData);M=new Map([["geometry",M]]);A=new F.VertexArrayObject(A,u,S,M,q);q=[];"ramp"===this._values.color.kind&&q.push("vvColor");"ramp"===this._values.opacity.kind&&q.push("vvOpacity");"ramp"===this._values.size.kind&&q.push("vvSize");n=n.painter.materialManager.getProgram(W,q);this.vertexArray=A;this.program=n;this.indexCount=this._indexData.length;this._indexData=this._vertexData=
null}detach(){this.vertexArray.dispose()}get ready(){return this.program.compiled}}return z})},"esri/views/2d/engine/flow/dataUtils":function(){define("exports ../../../../geometry ../../../../core/has ../../../../core/Logger ../../../../core/mathUtils ../../../../core/promiseUtils ../../../../core/RandomLCG ../../../../geometry/support/spatialReferenceUtils ../../../../geometry/Extent".split(" "),function(p,y,D,G,F,N,z,u,S){function W(a,b){const d=A(b.data,b.width,b.height,a.smoothing);return a.interpolate?
(g,c)=>{const f=Math.floor(g),h=Math.floor(c);if(0>f||f>=b.width||0>h||h>=b.height)return[0,0];g-=f;c-=h;const k=f<b.width-1?f+1:f,m=h<b.height-1?h+1:h;return[(d[2*(h*b.width+f)]*(1-c)+d[2*(m*b.width+f)]*c)*(1-g)+(d[2*(h*b.width+k)]*(1-c)+d[2*(m*b.width+k)]*c)*g,(d[2*(h*b.width+f)+1]*(1-c)+d[2*(m*b.width+f)+1]*c)*(1-g)+(d[2*(h*b.width+k)+1]*(1-c)+d[2*(m*b.width+k)+1]*c)*g]}:(g,c)=>{g=Math.round(g);c=Math.round(c);return 0>g||g>=b.width||0>c||c>=b.height?[0,0]:[d[2*(c*b.width+g)],d[2*(c*b.width+g)+
1]]}}function J(a,b,d,g,c,f,h,k,m){const v=[];let x=0,[C,H]=b(d,g);C*=a.velocityScale;H*=a.velocityScale;v.push({x:d,y:g,t:x,speed:Math.sqrt(C*C+H*H)});for(let U=0;U<a.verticesPerLine;U++){let [O,Y]=b(d,g);O*=a.velocityScale;Y*=a.velocityScale;const X=Math.sqrt(O*O+Y*Y);if(X<a.minSpeedThreshold)break;const ba=O/X,aa=Y/X;d+=ba*a.segmentLength;g+=aa*a.segmentLength;x+=a.segmentLength/X;if(Math.acos(ba*E+aa*P)>a.maxTurnAngle)break;if(a.collisions){var E=Math.round(d*m);var P=Math.round(g*m);if(0>E||
E>h-1||0>P||P>k-1)break;const Z=f[P*h+E];if(-1!==Z&&Z!==c)break;f[P*h+E]=c}v.push({x:d,y:g,t:x,speed:X});E=ba;P=aa}return v}function n(a,b,d,g){const c=[],f=new z,h=1/Math.max(a.lineCollisionWidth,1),k=Math.round(d*h),m=Math.round(g*h),v=new Int32Array(k*m);for(var x=0;x<v.length;x++)v[x]=-1;x=[];for(let C=0;C<g;C+=a.lineSpacing)for(let H=0;H<d;H+=a.lineSpacing)x.push({x:H,y:C,sort:f.getFloat()});x.sort((C,H)=>C.sort-H.sort);for(const {x:C,y:H}of x)f.getFloat()<a.density&&(d=J(a,b,C,H,c.length,v,
k,m,h),2>d.length||c.push(d));return c}function A(a,b,d,g){if(0===g)return a;const c=Math.round(3*g),f=Array(2*c+1);var h=0;for(var k=-c;k<=c;k++){var m=Math.exp(-k*k/(g*g));f[k+c]=m;h+=m}for(g=-c;g<=c;g++)f[g+c]/=h;h=new Float32Array(a.length);for(g=0;g<d;g++)for(k=0;k<b;k++){var v=m=0;for(var x=-c;x<=c;x++)if(!(0>k+x||k+x>=b)){var C=f[x+c];m+=C*a[2*(g*b+(k+x))];v+=C*a[2*(g*b+(k+x))+1]}h[2*(g*b+k)]=m;h[2*(g*b+k)+1]=v}a=new Float32Array(a.length);for(g=0;g<b;g++)for(k=0;k<d;k++){v=m=0;for(x=-c;x<=
c;x++)0>k+x||k+x>=d||(C=f[x+c],m+=C*h[2*((k+x)*b+g)],v+=C*h[2*((k+x)*b+g)+1]);a[2*(k*b+g)]=m;a[2*(k*b+g)+1]=v}return a}function M(a,b){const d=new z;var g=a.reduce((k,m)=>k+m.length,0);g=new Float32Array(4*g);const c=Array(a.length);let f=0,h=0;for(const k of a){a=f;for(const m of k)g[4*f]=m.x,g[4*f+1]=m.y,g[4*f+2]=m.t,g[4*f+3]=m.speed,f++;c[h++]={startVertex:a,numberOfVertices:k.length,totalTime:k[k.length-1].t,timeSeed:b?d.getFloat():0}}return{lineVertices:g,lineDescriptors:c}}function q(a,b){function d(E,
P,U,O,Y,X,ba,aa){const Z=9*m;let da=0;k[Z+da++]=E;k[Z+da++]=P;k[Z+da++]=1;k[Z+da++]=U;k[Z+da++]=X;k[Z+da++]=ba;k[Z+da++]=O/2;k[Z+da++]=Y/2;k[Z+da++]=aa;m++;k[Z+da++]=E;k[Z+da++]=P;k[Z+da++]=-1;k[Z+da++]=U;k[Z+da++]=X;k[Z+da++]=ba;k[Z+da++]=-O/2;k[Z+da++]=-Y/2;k[Z+da++]=aa;m++}const {lineVertices:g,lineDescriptors:c}=a;var f=a=0;for(var h of c)a+=2*h.numberOfVertices,f+=6*(h.numberOfVertices-1);const k=new Float32Array(9*a);h=new Uint32Array(f);let m=0;a=0;for(const E of c){const {totalTime:P,timeSeed:U}=
E;let O=f=null,Y=null;var v=null,x=null,C=null;for(let X=0;X<E.numberOfVertices;X++){v=g[4*(E.startVertex+X)];const ba=g[4*(E.startVertex+X)+1],aa=g[4*(E.startVertex+X)+2],Z=g[4*(E.startVertex+X)+3];let da=null,ka=null;var H=null;let ja=null;0<X&&(da=v-f,ka=ba-O,H=Math.sqrt(da*da+ka*ka),da/=H,ka/=H,1<X?(x=da+x,C=ka+C,H=Math.sqrt(x*x+C*C),x/=H,C/=H,H=Math.min(1/(x*da+C*ka),b),x*=H,C*=H,H=-C,ja=x):(H=-ka,ja=da),null!==H&&null!==ja&&(d(f,O,Y,H,ja,P,U,Z),h[a++]=m-2,h[a++]=m,h[a++]=m-1,h[a++]=m,h[a++]=
m+1,h[a++]=m-1));f=v;O=ba;Y=aa;x=da;C=ka;v=Z}d(f,O,Y,-C,x,P,U,v)}return{vertexData:k,indexData:h}}function t(a){function b(qa,e){var l=aa+da,w=Z+ka,I=Math.sqrt(l*l+w*w);l/=I;w/=I;var V=aa*l+Z*w,K=da+ja,T=ka+na;I=Math.sqrt(K*K+T*T);K/=I;T/=I;var Q=da*K+ka*T;I=H;var L=E,ea=P,ca=U;w=-(w/V);l/=V;V=O;var fa=Y,ha=X,ia=ba;T=-(T/Q);K/=Q;Q=16*x;let la=0;for(const oa of[1,2])for(const pa of[1,2,3,4])m[Q+la++]=I,m[Q+la++]=L,m[Q+la++]=ea,m[Q+la++]=ca,m[Q+la++]=V,m[Q+la++]=fa,m[Q+la++]=ha,m[Q+la++]=ia,m[Q+la++]=
oa,m[Q+la++]=pa,m[Q+la++]=qa,m[Q+la++]=e,m[Q+la++]=w/2,m[Q+la++]=l/2,m[Q+la++]=T/2,m[Q+la++]=K/2,x++;v[C++]=x-8;v[C++]=x-7;v[C++]=x-6;v[C++]=x-7;v[C++]=x-5;v[C++]=x-6;v[C++]=x-4;v[C++]=x-3;v[C++]=x-2;v[C++]=x-3;v[C++]=x-1;v[C++]=x-2}function d(qa,e,l,w,I,V){aa=da;Z=ka;da=ja;ka=na;null==aa&&null==Z&&(aa=da,Z=ka);if(null!=O&&null!=Y){ja=qa-O;na=e-Y;const K=Math.sqrt(ja*ja+na*na);ja/=K;na/=K}null!=aa&&null!=Z&&b(I,V);H=O;E=Y;P=X;U=ba;O=qa;Y=e;X=l;ba=w}function g(qa,e){aa=da;Z=ka;da=ja;ka=na;null==aa&&
null==Z&&(aa=da,Z=ka);null!=aa&&null!=Z&&b(qa,e)}const {lineVertices:c,lineDescriptors:f}=a;let h=a=0;for(var k of f){const qa=k.numberOfVertices-1;a+=8*qa;h+=12*qa}const m=new Float32Array(16*a),v=new Uint32Array(h);let x=0,C=0,H,E,P,U,O,Y,X,ba,aa,Z,da,ka,ja,na;for(const qa of f){na=ja=ka=da=Z=aa=ba=X=Y=O=U=P=E=H=null;const {totalTime:e,timeSeed:l}=qa;for(k=0;k<qa.numberOfVertices;k++)d(c[4*(qa.startVertex+k)],c[4*(qa.startVertex+k)+1],c[4*(qa.startVertex+k)+2],c[4*(qa.startVertex+k)+3],e,l);g(e,
l)}return{vertexData:m,indexData:v}}function r(a,b){const d=b.pixels,{width:g,height:c}=b,f=new Float32Array(g*c*2),h=b.mask||new Uint8Array(g*c*2);b.mask||h.fill(255);if("vector-uv"===a)for(a=0;a<g*c;a++)f[2*a]=d[0][a],f[2*a+1]=-d[1][a];else if("vector-magdir"===a)for(a=0;a<g*c;a++){b=d[0][a];const k=F.deg2rad(d[1][a]),m=Math.sin(k-Math.PI/2);f[2*a]=Math.cos(k-Math.PI/2)*b;f[2*a+1]=m*b}return{data:f,mask:h,width:g,height:c}}async function B(a,b,d,g,c,f){const h={requestProjectedLocalDirections:!0,
signal:f};null!=c&&(h.timeExtent=c);if("imagery"===a.type)return await a.load({signal:f}),c=a.rasterInfo.dataType,a=await a.fetchImage(b,d,g,h),null==a?.pixelData?.pixelBlock?{data:new Float32Array(d*g*2),mask:new Uint8Array(d*g),width:d,height:g}:r(c,a.pixelData.pixelBlock);await a.load({signal:f});c=a.serviceRasterInfo.dataType;a=await a.fetchPixels(b,d,g,h);return null==a?.pixelBlock?{data:new Float32Array(d*g*2),mask:new Uint8Array(d*g),width:d,height:g}:r(c,a.pixelBlock)}const R=()=>G.getLogger("esri.views.2d.engine.flow.dataUtils");
p.createAnimatedLinesData=M;p.createFlowMesh=async function(a,b,d,g){const c=performance.now();var f=W(b,d);const h=performance.now();d=n(b,f,d.width,d.height);b=performance.now();f=M(d,!0);d=performance.now();a="Streamlines"===a?q(f,10):t(f);f=performance.now();D("esri-2d-profiler")&&(R().info("I.1","_createFlowFieldFromData (ms)",Math.round(h-c)),R().info("I.2","_getStreamlines (ms)",Math.round(b-h)),R().info("I.3","createAnimatedLinesData (ms)",Math.round(d-b)),R().info("I.4","create{Streamlines|Particles}Mesh (ms)",
Math.round(f-d)),R().info("I.5","createFlowMesh (ms)",Math.round(f-c)),R().info("I.6","Mesh size (bytes)",a.vertexData.buffer.byteLength+a.indexData.buffer.byteLength));await Promise.resolve();N.throwIfAborted(g);return a};p.createParticlesMesh=t;p.createStreamlinesMesh=q;p.loadImagery=async function(a,b,d,g,c,f){const h=performance.now();var k=u.getInfo(b.spatialReference);if(!k)return d=await B(a,b,d,g,c,f),D("esri-2d-profiler")&&R().info("I.7","loadImagery, early exit (ms)",Math.round(performance.now()-
h)),D("esri-2d-profiler")&&R().info("I.9","Number of parts",1),d;const [m,v]=k.valid,x=Math.ceil(b.width/(v-m)),C=b.width/x,H=Math.round(d/x);let E=b.xmin;const P=[];k=performance.now();for(let U=0;U<x;U++){const O=new S({xmin:E,xmax:E+C,ymin:b.ymin,ymax:b.ymax,spatialReference:b.spatialReference});P.push(B(a,O,H,g,c,f));E+=C}a=await Promise.all(P);D("esri-2d-profiler")&&R().info("I.8","All calls to _fetchPart (ms)",Math.round(performance.now()-k));D("esri-2d-profiler")&&R().info("I.9","Number of parts",
a.length);g={data:new Float32Array(d*g*2),mask:new Uint8Array(d*g),width:d,height:g};b=0;for(const U of a){for(a=0;a<U.height;a++)for(c=0;c<U.width;c++)b+c>=d||(g.data[2*(a*d+b+c)]=U.data[2*(a*U.width+c)],g.data[2*(a*d+b+c)+1]=U.data[2*(a*U.width+c)+1],g.mask[a*d+b+c]=U.mask[a*U.width+c]);b+=U.width}D("esri-2d-profiler")&&R().info("I.10","loadImagery, general exit (ms)",Math.round(performance.now()-h));return g};Object.defineProperty(p,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/flow/FlowContainer":function(){define(["./BrushFlow",
"../webgl/enums","../webgl/WGLContainer"],function(p,y,D){class G extends D{constructor(){super(...arguments);this.flowStyle=null}doRender(F){super.doRender(F)}prepareRenderPasses(F){const N=F.registerRenderPass({name:"flow",brushes:[p],target:()=>this.children,drawPhase:y.WGLDrawPhase.MAP});return[...super.prepareRenderPasses(F),N]}}return G})},"esri/views/2d/engine/flow/BrushFlow":function(){define(["../../../../core/libs/gl-matrix-2/factories/mat3f32","../webgl/brushes/WGLBrush","../../../webgl/enums"],
function(p,y,D){class G extends y{constructor(){super(...arguments);this._visualState={time:0,dvsMat3:p.create(),displayViewMat3:p.create()}}dispose(){}prepareState(F){({context:F}=F);F.setColorMask(!0,!0,!0,!0);F.setStencilFunction(D.CompareFunction.EQUAL,0,255)}draw(F,N){const {requestRender:z,allowDelayedRender:u}=F,{displayData:S}=N;if(null!=S&&("loaded"===S.state.name&&S.attach(F),"attached"===S.state.name)){var W=S.state.resources;u&&!W.ready&&null!=z?z():(this._visualState.time=F.time/1E3,
this._visualState.dvsMat3=N.transforms.displayViewScreenMat3,this._visualState.displayViewMat3=F.state.displayViewMat3,S.flowStyle.render(F,this._visualState,W),S.flowStyle.animated&&null!=z&&z())}}}return G})},"esri/views/2d/engine/flow/FlowStrategy":function(){define("../../../../chunks/tslib.es6 ../../../../geometry ../../../../core/Accessor ../../../../core/Logger ../../../../core/mathUtils ../../../../core/promiseUtils ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ../../../../geometry/Point ./FlowDisplayData ./FlowDisplayObject ../../../../geometry/Extent".split(" "),
function(p,y,D,G,F,N,z,u,S,W,J,n,A,M){function q(t,r){const B=new J({x:(t.xmax+t.xmin)/2,y:(t.ymax+t.ymin)/2,spatialReference:t.spatialReference});var R=t.xmax-t.xmin;const a=t.ymax-t.ymin,b=Math.abs(Math.cos(F.deg2rad(r))),d=Math.abs(Math.sin(F.deg2rad(r)));r=b*R+d*a;R=d*R+b*a;t=new M({xmin:B.x-r/2,ymin:B.y-R/2,xmax:B.x+r/2,ymax:B.y+R/2,spatialReference:t.spatialReference});t.centerAt(B);return t}y=class extends D{constructor(t){super(t);this._flowDisplayObject=new A.FlowDisplayObject;this._loading=
null}initialize(){this.flowContainer.addChild(this._flowDisplayObject)}destroy(){this._clear();this.flowContainer.removeAllChildren()}get updating(){return null!=this._loading}update(t){var {flowStyle:r}=this.flowContainer;if(null==r)this._clear();else{var {extent:B,rotation:R,resolution:a,pixelRatio:b}=t.state;t=q(B,R);t.expand(1.15);r=new n(r,t,[Math.round((t.xmax-t.xmin)/a),Math.round((t.ymax-t.ymin)/a)],b);if(null!=this._loading){if(this._loading.update(r))return;this._loading.detach();this._loading=
null}null!=this._flowDisplayObject.displayData&&this._flowDisplayObject.displayData.update(r)||(r.load().then(()=>{this._flowDisplayObject.clear();this._flowDisplayObject.displayData=this._loading;this._loading=null},d=>{N.isAbortError(d)||(G.getLogger(this).error("A resource failed to load.",d),this._loading=null)}),this._loading=r)}}_clear(){this._flowDisplayObject.clear();null!=this._loading&&(this._loading.detach(),this._loading=null)}};p.__decorate([z.property()],y.prototype,"_loading",void 0);
p.__decorate([z.property()],y.prototype,"flowContainer",void 0);p.__decorate([z.property()],y.prototype,"updating",null);return y=p.__decorate([W.subclass("esri.views.2d.engine.flow.FlowStrategy")],y)})},"esri/views/2d/engine/flow/FlowDisplayData":function(){define(["../../../../core/Logger"],function(p){class y{constructor(D,G,F,N){this.state={name:"created"};this.flowStyle=D;this.extent=G;this.size=F;this.pixelRatio=N}async load(){const D=new AbortController;this.state={name:"loading",abortController:D};
this.state={name:"loaded",resources:await this.flowStyle.load({extent:this.extent,size:this.size,pixelRatio:this.pixelRatio},D.signal)}}attach(D){if("loaded"!==this.state.name)p.getLogger("esri.views.2d.engine.flow.FlowDisplayData").error("Only loaded resources can be attached.");else{var G=this.state.resources;G.attach(D);this.state={name:"attached",resources:G}}}detach(){"loading"===this.state.name?(this.state.abortController.abort(),this.state={name:"detached"}):"attached"===this.state.name&&(this.state.resources.detach(),
this.state={name:"detached"})}update(D){if(!this.flowStyle.isCompatible(D.flowStyle)||!this.extent.equals(D.extent)||this.size[0]!==D.size[0]||this.size[1]!==D.size[1]||this.pixelRatio!==D.pixelRatio)return!1;this.flowStyle=D.flowStyle;return!0}}return y})},"esri/views/2d/engine/flow/FlowDisplayObject":function(){define(["exports","../../../../core/mathUtils","../../../../core/libs/gl-matrix-2/math/mat3","../../../../core/libs/gl-matrix-2/factories/mat3f32","../DisplayObject"],function(p,y,D,G,F){class N extends F.DisplayObject{constructor(){super(...arguments);
this._displayData=null}get displayData(){return this._displayData}set displayData(z){this._displayData=z;this.requestRender()}clear(){null!=this._displayData&&(this._displayData.detach(),this._displayData=null,this.requestRender())}setTransform(z){var {displayData:u}=this;if(null!=u){var S=[0,0];z.toScreen(S,[u.extent.xmin,u.extent.ymax]);u=(u.extent.xmax-u.extent.xmin)/u.size[0]/z.resolution;var W=y.deg2rad(z.rotation),{displayViewScreenMat3:J}=this.transforms;D.fromTranslation(J,[-1,1,0]);D.scale(J,
J,[2/(z.size[0]*z.pixelRatio),-2/(z.size[1]*z.pixelRatio),1]);D.translate(J,J,[S[0],S[1],0]);D.rotate(J,J,W);D.scale(J,J,[u*z.pixelRatio,u*z.pixelRatio,1])}}_createTransforms(){return{displayViewScreenMat3:G.create()}}}p.FlowDisplayObject=N;Object.defineProperty(p,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/LayerView2D":function(){define("exports ../../../chunks/tslib.es6 ../../../core/Collection ../../../core/collectionUtils ../../../core/Error ../../../core/Logger ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ../../../linkChart/utils ../engine/Container ./support/util ../support/HighlightGroup ../support/highlightGroupUtils ../support/HighlightOptions ../../layers/support/ClipRect ../../layers/support/Geometry ../../layers/support/Path ../../support/layerViewUtils".split(" "),
function(p,y,D,G,F,N,z,u,S,W,J,n,A,M,q,t,r,B,R,a,b){const d=D.ofType({key:"type",base:null,typeMap:{rect:B,path:a,geometry:R}}),g=new (D.ofType(q.HighlightGroup));p.LayerView2DMixin=c=>{c=class extends c{constructor(){super(...arguments);this.attached=!1;this.clips=new d;this.highlights=null;this.lastUpdateId=-1;this.updateRequested=this.moving=!1;this._visibleAtCurrentScale=!0}initialize(){const f=this.view?.spatialReferenceLocked??!0;this.view?.spatialReference&&f&&!this.spatialReferenceSupported?
this.addResolvingPromise(Promise.reject(new F("layerview:spatial-reference-incompatible","The spatial reference of this layer does not meet the requirements of the view",{layer:this.layer}))):(this.container||(this.container=new A.Container),this.container.fadeTransitionEnabled=!0,this.container.visible=!1,this.container.endTransitions(),this.addHandles([z.watch(()=>this.suspended,h=>{this.container&&(this.container.visible=!h)},z.syncAndInitial),z.watch(()=>this.updateSuspended,h=>{this.view&&!h&&
this.updateRequested&&this.view.requestUpdate()},z.syncAndInitial),z.watch(()=>this.layer?.opacity??1,h=>{this.container&&(this.container.opacity=h)},z.syncAndInitial),z.watch(()=>this.layer&&"blendMode"in this.layer?this.layer.blendMode:"normal",h=>{this.container&&(this.container.blendMode=h)},z.syncAndInitial),z.watch(()=>this.layer&&"effect"in this.layer?this.layer.effect:null,h=>{this.container&&(this.container.effect=h)},z.syncAndInitial),z.watch(()=>this._mergedHighlights.items.map(h=>({name:h.name,
options:{fillColor:h.options.color,haloColor:h.options.haloColor,fillOpacity:h.options.fillOpacity,haloOpacity:h.options.haloOpacity,haloWidth:h.options.haloWidth,haloBlur:h.options.haloBlur}})),()=>{this.container.highlightGradient=M.createOrReuseHighlightGradient(this.container.highlightGradient,this._mergedHighlights.items)},z.syncAndInitial),z.watch(()=>this._mergedHighlights.items.map(h=>h.name),()=>{this._updateHighlights()}),z.on(()=>this.clips,"change",()=>{this.container&&(this.container.clips=
this.clips)},z.syncAndInitial),z.watch(()=>({scale:this.view?.scale,scaleRange:this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null}),({scale:h,scaleRange:k})=>{h=b.isInEffectiveScaleRange(k,h);h!==this._visibleAtCurrentScale&&(this._visibleAtCurrentScale=h)},z.syncAndInitial)],"constructor"),this.view?.whenLayerView?this.view.whenLayerView(this.layer).then(h=>{h===this&&this.processAttach()},()=>{}):this.when().then(()=>{this.processAttach()},()=>{}))}_updateHighlights(){}destroy(){this.processDetach();
this.updateRequested=!1}get highlightOptions(){return t.getDefaultHighlightOptions(this)}set highlightOptions(f){t.setDefaultHighlightOptions(this,f)}get _mergedHighlights(){if(!this.view)return g;if(!this.highlights)return this.view.highlights;const f=this.view.highlights.clone();for(const h of this.highlights){const k=f.find(m=>m.name===h.name);k&&(k.options=h.options)}return f}get scheduler(){return this.view.scheduler}get spatialReferenceSupported(){const f=this.view?.spatialReference;return null==
f||this.supportsSpatialReference(f)}get updating(){return this.spatialReferenceSupported&&(!this.attached||!this.suspended&&(this.updateRequested||this.isUpdating())||!!this._updatingHandles?.updating||this.container.transitioning)}get visibleAtCurrentScale(){return this._visibleAtCurrentScale}processAttach(){this.isResolved()&&!this.attached&&!this.destroyed&&this.spatialReferenceSupported&&(this.attach(),this.attached=!0,this.requestUpdate())}processDetach(){this.attached&&(this.attached=!1,this.removeHandles("attach"),
this.detach(),this.updateRequested=!1)}requestUpdate(){this.destroyed||this.updateRequested||(this.updateRequested=!0,this.updateSuspended||this.view.requestUpdate())}processUpdate(f){this.isFulfilled()&&!this.isResolved()?this.updateRequested=!1:(this._set("updateParameters",f),this.updateRequested&&!this.updateSuspended&&(this.updateRequested=!1,this.update(f)))}hitTest(f,h){return Promise.resolve(null)}supportsSpatialReference(f){return!0}canResume(){if(!this.spatialReferenceSupported)return!1;
switch(this.layer?.type){case "link-chart":case "knowledge-graph-sublayer":break;default:if(n.isLinkChartView(this.view)&&!this.view.inGeographicLayout)return!1}return super.canResume()?this.visibleAtCurrentScale:!1}getSuspendInfo(){const f=super.getSuspendInfo(),h=!this.spatialReferenceSupported;h&&(f.spatialReferenceNotSupported=h);return f}addAttachHandles(f){this.addHandles(f,"attach")}_getHighlightBits(f){f=new Set(f);let h=1,k=0;if(!this.view)return 0;const m=this._mergedHighlights;for(const {name:v}of m)f.delete(v)&&
(k=h),h<<=1;for(const v of f)N.getLogger(this).error("#highlights",`${v} was not found. Features in this group will not be highlighted.`);return k}};y.__decorate([u.property()],c.prototype,"attached",void 0);y.__decorate([u.property({type:d,set(f){f=G.referenceSetter(f,this._get("clips"),d);this._set("clips",f)}})],c.prototype,"clips",void 0);y.__decorate([u.property()],c.prototype,"container",void 0);y.__decorate([u.property({type:r})],c.prototype,"highlightOptions",null);y.__decorate([u.property({type:D.ofType(q.HighlightGroup)})],
c.prototype,"highlights",void 0);y.__decorate([u.property()],c.prototype,"_mergedHighlights",null);y.__decorate([u.property()],c.prototype,"moving",void 0);y.__decorate([u.property({readOnly:!0})],c.prototype,"spatialReferenceSupported",null);y.__decorate([u.property({readOnly:!0})],c.prototype,"updateParameters",void 0);y.__decorate([u.property()],c.prototype,"updateRequested",void 0);y.__decorate([u.property()],c.prototype,"updating",null);y.__decorate([u.property()],c.prototype,"view",void 0);
y.__decorate([u.property()],c.prototype,"_visibleAtCurrentScale",void 0);y.__decorate([u.property({readOnly:!0})],c.prototype,"visibleAtCurrentScale",null);return c=y.__decorate([J.subclass("esri.views.2d.layers.LayerView2D")],c)};Object.defineProperty(p,Symbol.toStringTag,{value:"Module"})})},"esri/linkChart/utils":function(){define(["exports"],function(p){p.isLinkChartView=function(y){return null!=y&&"object"===typeof y&&"2d"===y.type&&"linkchart"===y.view2dType};Object.defineProperty(p,Symbol.toStringTag,
{value:"Module"})})},"esri/views/layers/support/ClipRect":function(){define("../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ./ClipArea".split(" "),function(p,y,D,G,F,N,z){var u;D=u=class extends z{constructor(S){super(S);this.type="rect";this.bottom=this.top=this.right=this.left=null}clone(){return new u({left:this.left,right:this.right,top:this.top,bottom:this.bottom})}commitVersionProperties(){this.commitProperty("left");
this.commitProperty("right");this.commitProperty("top");this.commitProperty("bottom")}};p.__decorate([y.property({type:[Number,String],json:{write:!0}})],D.prototype,"left",void 0);p.__decorate([y.property({type:[Number,String],json:{write:!0}})],D.prototype,"right",void 0);p.__decorate([y.property({type:[Number,String],json:{write:!0}})],D.prototype,"top",void 0);p.__decorate([y.property({type:[Number,String],json:{write:!0}})],D.prototype,"bottom",void 0);return D=u=p.__decorate([N.subclass("esri.views.layers.support.ClipRect")],
D)})},"esri/views/layers/support/ClipArea":function(){define("../../../chunks/tslib.es6 ../../../core/JSONSupport ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass".split(" "),function(p,y,D,G,F,N,z){y=class extends y.JSONSupport{get version(){this.commitVersionProperties();return(this._get("version")||0)+1}};p.__decorate([D.property({readOnly:!0})],y.prototype,"version",null);return y=
p.__decorate([z.subclass("esri.views.layers.support.ClipArea")],y)})},"esri/views/layers/support/Geometry":function(){define("../../../chunks/tslib.es6 ../../../geometry ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ../../../geometry/Geometry ../../../geometry/support/jsonUtils ./ClipArea ../../../geometry/Extent ../../../geometry/Polygon".split(" "),function(p,y,D,G,F,N,z,u,S,W,J,
n){var A;y={base:u,key:"type",typeMap:{extent:J,polygon:n}};W=A=class extends W{constructor(M){super(M);this.type="geometry";this.geometry=null}clone(){return new A({geometry:this.geometry?.clone()??null})}commitVersionProperties(){this.commitProperty("geometry")}};p.__decorate([D.property({types:y,json:{read:S.fromJSON,write:!0}})],W.prototype,"geometry",void 0);return W=A=p.__decorate([z.subclass("esri.views.layers.support.Geometry")],W)})},"esri/views/layers/support/Path":function(){define("../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ./ClipArea".split(" "),
function(p,y,D,G,F,N,z){D=class extends z{constructor(u){super(u);this.type="path";this.path=[]}commitVersionProperties(){this.commitProperty("path")}};p.__decorate([y.property({type:[[[Number]]],json:{write:!0}})],D.prototype,"path",void 0);return D=p.__decorate([N.subclass("esri.views.layers.support.Path")],D)})},"esri/views/2d/layers/graphics/HighlightGraphicContainer":function(){define("../../../../chunks/tslib.es6 ../../../../core/Logger ../../../../core/has ../../../../core/RandomLCG ../../../../core/Error ../../../../core/accessorSupport/decorators/subclass ../../engine/webgl/enums ./AGraphicContainer ../support/util".split(" "),
function(p,y,D,G,F,N,z,u,S){y=class extends u.AGraphicContainer{get hasHighlight(){return this.children.some(W=>W.hasData)}renderChildren(W){this.attributeView.update();W.drawPhase===z.WGLDrawPhase.HIGHLIGHT&&this.children.some(J=>J.hasData)&&(super.renderChildren(W),W.context.setColorMask(!0,!0,!0,!0),S.renderHighlight(W,!0,J=>{this._renderChildren(J,z.FeatureSelection.All)},0))}};return y=p.__decorate([N.subclass("esri.views.2d.layers.graphics.HighlightGraphicContainer")],y)})},"esri/views/2d/layers/imagery/ImageryView2D":function(){define("../../../../chunks/tslib.es6 ../../../../Graphic ../../../../core/Accessor ../../../../core/Logger ../../../../core/promiseUtils ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ../../../../layers/support/rasterFunctions/pixelUtils ../../engine/BitmapContainer ../../engine/Container ../../engine/ImageryBitmapSource ../support/ExportStrategy".split(" "),
function(p,y,D,G,F,N,z,u,S,W,J,n,A,M){D=class extends D{constructor(){super(...arguments);this.attached=!1;this.container=new n.Container;this.updateRequested=!1;this.type="imagery";this._bitmapView=new J.BitmapContainer}destroy(){this.attached&&(this.detach(),this.attached=!1);this.updateRequested=!1}get updating(){return!this.attached||this.isUpdating()}update(q){this.strategy.update(q).catch(t=>{F.isAbortError(t)||G.getLogger(this).error(t)})}hitTest(q){return new y({attributes:{},geometry:q.clone(),
layer:this.layer})}attach(){this.container.addChild(this._bitmapView);this.strategy=new M({container:this._bitmapView,imageNormalizationSupported:10<=this.layer.version,imageMaxHeight:10.1<=this.layer.version?this.layer.imageMaxHeight:2048,imageMaxWidth:10.1<=this.layer.version?this.layer.imageMaxWidth:2048,fetchSource:this._fetchImage.bind(this),requestUpdate:()=>this.requestUpdate()})}detach(){this.strategy.destroy();this._bitmapView.removeAllChildren();this.container.removeAllChildren();this.updateRequested=
!1}redraw(){this.strategy.updateExports(async q=>{const {source:t}=q;if(t&&!(t instanceof ImageBitmap)){var r=await this.layer.applyRenderer({extent:t.extent,pixelBlock:t.originalPixelBlock??t.pixelBlock});t.filter=B=>this.layer.pixelFilter?this.layer.applyFilter(B):{...r,extent:t.extent}}}).catch(q=>{F.isAbortError(q)||G.getLogger(this).error(q)})}requestUpdate(){this.updateRequested||(this.updateRequested=!0,this.view.requestUpdate())}isUpdating(){return this.strategy.updating||this.updateRequested}getPixelData(){if(this.updating)return null;
var q=this.strategy.bitmaps;if(1===q.length&&q[0].source)return{extent:q[0].source.extent,pixelBlock:q[0].source.originalPixelBlock};if(1<q.length){const t=this.view.extent;q=q.map(r=>r.source).filter(r=>r.extent&&r.extent.intersects(t)).map(r=>({extent:r.extent,pixelBlock:r.originalPixelBlock}));q=W.mosaicPixelData(q,t);return null!=q?{extent:q.extent,pixelBlock:q.pixelBlock}:null}return null}async _fetchImage(q,t,r,B){B=B||{};B.timeExtent=this.timeExtent;B.requestAsImageElement=!0;B.returnImageBitmap=
!0;q=await this.layer.fetchImage(q,t,r,B);if(q.imageBitmap)return q.imageBitmap;B=await this.layer.applyRenderer(q.pixelData,{signal:B.signal});B=new A(B.pixelBlock,B.extent?.clone(),q.pixelData.pixelBlock);B.filter=R=>this.layer.applyFilter(R);return B}};p.__decorate([N.property()],D.prototype,"attached",void 0);p.__decorate([N.property()],D.prototype,"container",void 0);p.__decorate([N.property()],D.prototype,"layer",void 0);p.__decorate([N.property()],D.prototype,"strategy",void 0);p.__decorate([N.property()],
D.prototype,"timeExtent",void 0);p.__decorate([N.property()],D.prototype,"view",void 0);p.__decorate([N.property()],D.prototype,"updateRequested",void 0);p.__decorate([N.property()],D.prototype,"updating",null);p.__decorate([N.property()],D.prototype,"type",void 0);return D=p.__decorate([S.subclass("esri.views.2d.layers.imagery.ImageryView2D")],D)})},"esri/layers/support/rasterFunctions/pixelUtils":function(){define(["exports","../PixelBlock","../rasterFormats/pixelRangeUtils"],function(p,y,D){function G(a){return null!=
a&&"esri.layers.support.PixelBlock"===a.declaredClass&&a.pixels&&0<a.pixels.length}function F(a,b,d,g,c){const f=a.length;c=y.createEmptyBand(c,f);if(b)for(let h=0;h<f;h++)b[h]&&(c[h]=d[a[h]-g]);else for(b=0;b<f;b++)c[b]=d[a[b]-g];return c}function N(a,b,d,g){const c=null!=d&&2<=d.length?new Set(d):null;d=1===d?.length?d[0]:null;const f=!!b?.length;for(let h=0;h<a.length;h++)if(g[h]){const k=a[h];if(f){let m=!1;for(let v=0;v<b.length;v+=2)if(k>=b[v]&&k<=b[v+1]){m=!0;break}m||(g[h]=0)}g[h]&&(k===d||
c?.has(k))&&(g[h]=0)}}function z(a,b){const d=a[0].length;for(let g=0;g<d;g++)if(b[g]){let c=!1;for(let f=0;f<a.length;f++)if(a[f][g]){c=!0;break}c||(b[g]=0)}}function u(a,b){const d=a[0].length;for(let g=0;g<d;g++)if(b[g]){let c=!1;for(let f=0;f<a.length;f++)if(0===a[f][g]){c=!0;break}c&&(b[g]=0)}}function S(a,b,d,g,c,f,h,k){return{xmin:c<=d*a?0:c<d*a+a?c-d*a:a,ymin:f<=g*b?0:f<g*b+b?f-g*b:b,xmax:c+h<=d*a?0:c+h<d*a+a?c+h-d*a:a,ymax:f+k<=g*b?0:f+k<g*b+b?f+k-g*b:b}}function W(a,b,d,g,c,f){const {width:h,
height:k}=d.block,{x:m,y:v}=d.offset,{width:x,height:C}=d.mosaic;d=S(h,k,g,c,m,v,x,C);let H=0;var E=0;if(f){var P=f.hasGCSSShiftTransform?360:f.halfWorldWidth??0,U=h*f.resolutionX;const O=f.startX+g*U;O<P&&O+U>P?E=f.rightPadding:O>=P&&(H=f.leftMargin-f.rightPadding,E=0)}d.xmax-=E;if("number"===typeof b)for(f=d.ymin;f<d.ymax;f++)for(E=(c*k+f-v)*x+(g*h-m)+H,P=d.xmin;P<d.xmax;P++)a[E+P]=b;else for(f=d.ymin;f<d.ymax;f++)for(E=(c*k+f-v)*x+(g*h-m)+H,P=f*h,U=d.xmin;U<d.xmax;U++)a[E+U]=b[P+U]}function J(a,
b,d={}){const {clipOffset:g,clipSize:c,alignmentInfo:f,blockWidths:h}=d;if(h)return n(a,b,{blockWidths:h});var k=a.find(ba=>G(ba));if(null==k)return null;d=c?c.width:b.width;const m=c?c.height:b.height;var v=k.width,x=k.height;const C=b.width/v,H=b.height/x;b={offset:g||{x:0,y:0},mosaic:c||b,block:{width:v,height:x}};v=k.pixelType;var E=y.getPixelArrayConstructor(v);k=k.pixels.length;x=[];for(var P=0;P<k;P++){var U=new E(d*m);for(var O=0;O<H;O++)for(var Y=0;Y<C;Y++){var X=a[O*C+Y];G(X)&&(X=X.pixels[P],
W(U,X,b,Y,O,f))}x.push(U)}E=a.some(ba=>null==ba||null!=ba.mask&&0<ba.mask.length);U=a.some(ba=>ba?.bandMasks&&1<ba.bandMasks.length);E=E?new Uint8Array(d*m):void 0;U=U?[]:void 0;if(E){for(P=0;P<H;P++)for(O=0;O<C;O++)Y=a[P*C+O],X=null!=Y?Y.mask:null,null!=X?W(E,X,b,O,P,f):Y?W(E,255,b,O,P,f):W(E,0,b,O,P,f);if(U)for(P=0;P<k;P++){O=new Uint8Array(d*m);for(Y=0;Y<H;Y++)for(X=0;X<C;X++){const ba=a[Y*C+X],aa=ba?.bandMasks?.[P]??ba?.mask;null!=aa?W(O,aa,b,X,Y,f):ba?W(O,255,b,X,Y,f):W(O,0,b,X,Y,f)}U.push(O)}}a=
new y({width:d,height:m,pixels:x,pixelType:v,bandMasks:U,mask:E});a.updateStatistics();return a}function n(a,b,d){const g=a.find(O=>null!=O);if(null==g)return null;var c=a.some(O=>null!=O?!!O.mask:!0);const {width:f,height:h}=b;b=c?new Uint8Array(f*h):null;({blockWidths:d}=d);const k=[],m=g.getPlaneCount(),v=y.getPixelArrayConstructor(g.pixelType);if(c)for(let O=0,Y=0;O<a.length;Y+=d[O],O++)if(c=a[O],G(c)){var x=c.mask;for(var C=0;C<h;C++)for(var H=0;H<d[O];H++)b[C*f+H+Y]=null==x?255:x[C*c.width+
H]}x=(c=a.some(O=>O?.bandMasks&&1<O.bandMasks.length))?[]:void 0;C=f*h;for(H=0;H<m;H++){const O=new v(C),Y=c?new Uint8Array(C):void 0;for(let X=0,ba=0;X<a.length;ba+=d[X],X++){const aa=a[X];if(G(aa)){var E=aa.pixels[H];if(null!=E){for(var P=0;P<h;P++)for(var U=0;U<d[X];U++)O[P*f+U+ba]=E[P*aa.width+U];if(Y)for(E=aa.bandMasks?.[H]??aa.mask,P=0;P<h;P++)for(U=0;U<d[X];U++)Y[P*f+U+ba]=E?E[P*aa.width+U]:255}}}k.push(O);x&&Y&&x.push(Y)}a=new y({width:f,height:h,mask:b,bandMasks:x,pixels:k,pixelType:g.pixelType});
a.updateStatistics();return a}function A(a){if(!G(a))return null;const b=a.clone(),{width:d,height:g,pixels:c}=a;var f=c[0];const h=b.pixels[0];a=a.mask;for(let v=2;v<g-1;v++){const x=new Map;for(var k=v-2;k<v+2;k++)for(var m=0;4>m;m++){const C=k*d+m;t(x,f[C],a?a[C]:1)}h[v*d]=M(x);h[v*d+1]=h[v*d+2]=h[v*d];for(k=3;k<d-1;k++)m=(v-2)*d+k+1,t(x,f[m],a?a[m]:1),m=(v-1)*d+k+1,t(x,f[m],a?a[m]:1),m=v*d+k+1,t(x,f[m],a?a[m]:1),m=(v+1)*d+k+1,t(x,f[m],a?a[m]:1),m=(v-2)*d+k-3,q(x,f[m],a?a[m]:1),m=(v-1)*d+k-3,q(x,
f[m],a?a[m]:1),m=v*d+k-3,q(x,f[m],a?a[m]:1),m=(v+1)*d+k-3,q(x,f[m],a?a[m]:1),h[v*d+k]=M(x);h[v*d+k+1]=h[v*d+k]}for(f=0;f<d;f++)h[f]=h[d+f]=h[2*d+f],h[(g-1)*d+f]=h[(g-2)*d+f];b.updateStatistics();return b}function M(a){if(0===a.size)return 0;let b=0,d=-1,g=0;const c=a.keys();let f=c.next();for(;!f.done;)g=a.get(f.value),g>b&&(d=f.value,b=g),f=c.next();return d}function q(a,b,d){0!==d&&(d=a.get(b),1===d?a.delete(b):a.set(b,d-1))}function t(a,b,d){0!==d&&a.set(b,a.has(b)?a.get(b)+1:1)}function r(a,b,
d){let {x:g,y:c}=b;const {width:f,height:h}=d;if(0===g&&0===c&&h===a.height&&f===a.width)return a;const {width:k,height:m}=a;b=Math.max(0,c);const v=Math.max(0,g),x=Math.min(g+f,k),C=Math.min(c+h,m);if(0>x||0>C||!G(a))return null;g=Math.max(0,-g);c=Math.max(0,-c);var {pixels:H}=a,E=f*h,P=H.length;const U=[];for(var O=0;O<P;O++){var Y=H[O],X=y.createEmptyBand(a.pixelType,E);for(let ba=b;ba<C;ba++){const aa=ba*k;let Z=(ba+c-b)*f+g;for(let da=v;da<x;da++)X[Z++]=Y[aa+da]}U.push(X)}H=new Uint8Array(E);
E=a.mask;for(P=b;P<C;P++)for(O=P*k,Y=(P+c-b)*f+g,X=v;X<x;X++)H[Y++]=E?E[O+X]:1;a=new y({width:d.width,height:d.height,pixelType:a.pixelType,pixels:U,mask:H});a.updateStatistics();return a}function B(a,b=!0){if(!G(a))return null;const {pixels:d,width:g,height:c,mask:f,pixelType:h}=a;a=[];const k=Math.round(g/2),m=Math.round(c/2),v=c-1,x=g-1;for(var C=0;C<d.length;C++){var H=d[C],E=y.createEmptyBand(h,k*m),P=0;for(var U=0;U<c;U+=2)for(var O=0;O<g;O+=2){var Y=H[U*g+O];if(b){var X=O===x?Y:H[U*g+O+1];
const ba=U===v?Y:H[U*g+O+g],aa=O===x?ba:U===v?X:H[U*g+O+g+1];E[P++]=(Y+X+ba+aa)/4}else E[P++]=Y}a.push(E)}C=null;if(null!=f)for(C=new Uint8Array(k*m),H=0,E=0;E<c;E+=2)for(P=0;P<g;P+=2)U=f[E*g+P],b?(O=P===x?U:f[E*g+P+1],Y=E===v?U:f[E*g+P+g],X=P===x?Y:E===v?O:f[E*g+P+g+1],C[H++]=U*O*Y*X?1:0):C[H++]=U;return new y({width:k,height:m,pixelType:h,pixels:a,mask:C})}function R(a,b,d,g,c=0){const {width:f,height:h}=a,{width:k,height:m}=b;a=g.cols;g=g.rows;b=Math.ceil(k/a-.1/a);const v=Math.ceil(m/g-.1/g);
let x,C,H,E,P;const U=b*a;var O=U*v*g;const Y=new Float32Array(O),X=new Float32Array(O),ba=new Uint32Array(O),aa=new Uint32Array(O);let Z=0,da,ka;for(let qa=0;qa<v;qa++)for(let e=0;e<b;e++){var ja=12*(qa*b+e);O=d[ja];x=d[ja+1];C=d[ja+2];H=d[ja+3];E=d[ja+4];P=d[ja+5];for(var na=0;na<g;na++){Z=(qa*g+na)*U+e*a;ka=(na+.5)/g;for(let l=0;l<na;l++)da=(l+.5)/a,Y[Z+l]=(O*da+x*ka+C)*f+c,X[Z+l]=(H*da+E*ka+P)*h+c,ba[Z+l]=Math.floor(Y[Z+l]),aa[Z+l]=Math.floor(X[Z+l])}ja+=6;O=d[ja];x=d[ja+1];C=d[ja+2];H=d[ja+3];
E=d[ja+4];P=d[ja+5];for(ja=0;ja<g;ja++)for(Z=(qa*g+ja)*U+e*a,ka=(ja+.5)/g,na=ja;na<a;na++)da=(na+.5)/a,Y[Z+na]=(O*da+x*ka+C)*f+c,X[Z+na]=(H*da+E*ka+P)*h+c,ba[Z+na]=Math.floor(Y[Z+na]),aa[Z+na]=Math.floor(X[Z+na])}return{offsets_x:Y,offsets_y:X,offsets_xi:ba,offsets_yi:aa,gridWidth:U}}p.NoDataInterpretation=void 0;(function(a){a[a.matchAny=0]="matchAny";a[a.matchAll=1]="matchAll"})(p.NoDataInterpretation||(p.NoDataInterpretation={}));p.MissingBandAction=void 0;(function(a){a[a.bestMatch=0]="bestMatch";
a[a.fail=1]="fail"})(p.MissingBandAction||(p.MissingBandAction={}));p.approximateTransform=function(a,b,d,g,c="nearest"){if(!G(a))return null;"majority"===c&&(a=A(a));const {pixels:f,mask:h,bandMasks:k,pixelType:m}=a,v=a.width;var x=a.height;const C=y.getPixelArrayConstructor(m),H=f.length,{width:E,height:P}=b;a=!1;for(var U=0;U<d.length;U+=3)-1===d[U]&&-1===d[U+1]&&-1===d[U+2]&&(a=!0);const {offsets_x:O,offsets_y:Y,offsets_xi:X,offsets_yi:ba,gridWidth:aa}=R({width:v,height:x},b,d,g,"majority"===
c?.5:0);let Z;b=(ka,ja,na,qa)=>{const e=ka instanceof Float32Array||ka instanceof Float64Array?0:.5;for(let l=0;l<P;l++){Z=l*aa;for(let w=0;w<E;w++){if(0>O[Z]||0>Y[Z])ka[l*E+w]=0;else if(qa)ka[l*E+w]=ja[X[Z]+ba[Z]*v];else{const I=Math.floor(O[Z]),V=Math.floor(Y[Z]),K=Math.ceil(O[Z]),T=Math.ceil(Y[Z]),Q=O[Z]-I,L=Y[Z]-V;ka[l*E+w]=!na||na[I+V*v]&&na[K+V*v]&&na[I+T*v]&&na[K+T*v]?(1-L)*((1-Q)*ja[I+V*v]+Q*ja[K+V*v])+L*((1-Q)*ja[I+T*v]+Q*ja[K+T*v])+e:ja[X[Z]+ba[Z]*v]}Z++}}};d=[];g=k?.length===H;x=[];for(U=
0;U<H;U++){if(g){var da=new Uint8Array(E*P);b(da,k[U],k[U],!0);x.push(da)}da=new C(E*P);b(da,f[U],g?k[U]:h,"nearest"===c||"majority"===c);d.push(da)}c=new y({width:E,height:P,pixelType:m,pixels:d,bandMasks:g?x:void 0});if(null!=h)c.mask=new Uint8Array(E*P),b(c.mask,h,h,!0);else if(a)for(c.mask=new Uint8Array(E*P),a=0;a<E*P;a++)c.mask[a]=0>O[a]||0>Y[a]?0:1;c.updateStatistics();return c};p.clip=r;p.clipTile=function(a){const {pixelBlock:b,tileSize:d,level:g,row:c,col:f,useBilinear:h}=a;if(!G(b))return null;
const {width:k,height:m}=d;var v=2**g;a=v*k;v*=m;a=r(b,{y:c*v,x:f*a},{width:a,height:v});if(!a)return null;for(v=g;0<v;v--)a=B(a,h);return a};p.colorize=function(a,b){if(!G(a)||!b||!b.indexedColormap&&!b.indexed2DColormap)return a;const d=a.clone();var g=d.pixels;let c=d.mask;const f=d.width*d.height;if(1!==g.length)return a;const {indexedColormap:h,indexed2DColormap:k,offset:m,alphaSpecified:v}=b;a=0;g=g[0];b=new Uint8Array(g.length);const x=new Uint8Array(g.length),C=new Uint8Array(g.length);var H=
0;if(h){const E=h.length-1;if(null!=c)for(a=0;a<f;a++)c[a]&&(H=4*(g[a]-m),H<m||H>E?c[a]=0:(b[a]=h[H],x[a]=h[H+1],C[a]=h[H+2],c[a]=h[H+3]));else{c=new Uint8Array(f);for(a=0;a<f;a++)H=4*(g[a]-m),H<m||H>E?c[a]=0:(b[a]=h[H],x[a]=h[H+1],C[a]=h[H+2],c[a]=h[H+3]);d.mask=c}}else if(k)if(null!=c)for(a=0;a<f;a++)c[a]&&(H=k[g[a]],b[a]=H[0],x[a]=H[1],C[a]=H[2],c[a]=H[3]);else{c=new Uint8Array(f);for(a=0;a<f;a++)H=k[g[a]],b[a]=H[0],x[a]=H[1],C[a]=H[2],c[a]=H[3];d.mask=c}d.pixels=[b,x,C];d.statistics=null;d.pixelType=
"u8";d.maskIsAlpha=v;return d};p.compositeBands=function(a){if(!a?.length||a.some(m=>!G(m)))return null;if(1===a.length)return a[0]?.clone()??null;const {width:b,height:d,pixelType:g}=a[0];if(a.some(m=>m.width!==b||m.height!==d))return null;const c=a.map(({mask:m})=>m).filter(m=>null!=m);let f=null;c.length&&(f=new Uint8Array(b*d),f.set(c[0]),1<c.length&&u(c.slice(1),f));const h=[];a.forEach(({pixels:m})=>h.push(...m));const k=[];a.map(({statistics:m})=>m).filter(m=>m?.length).forEach(m=>k.push(...m));
return new y({pixelType:g,width:b,height:d,mask:f,pixels:h,statistics:k.length?k:null})};p.createColormapLUT=function(a){if(a){var b=a.colormap;if(b&&0!==b.length){b=b.sort((v,x)=>v[0]-x[0]);var d=0;0>b[0][0]&&(d=b[0][0]);var g=Math.max(256,b[b.length-1][0]-d+1),c=new Uint8Array(4*g),f=[],h=0,k=0,m=5===b[0].length;if(65536<g)return b.forEach(v=>{f[v[0]-d]=m?v.slice(1):v.slice(1).concat([255])}),{indexed2DColormap:f,offset:d,alphaSpecified:m};if(a.fillUnspecified)for(a=b[k],h=a[0]-d;h<g;h++)c[4*h]=
a[1],c[4*h+1]=a[2],c[4*h+2]=a[3],c[4*h+3]=m?a[4]:255,h===a[0]-d&&(a=k===b.length-1?a:b[++k]);else for(h=0;h<b.length;h++)a=b[h],k=4*(a[0]-d),c[k]=a[1],c[k+1]=a[2],c[k+2]=a[3],c[k+3]=m?a[4]:255;return{indexedColormap:c,offset:d,alphaSpecified:m}}}};p.createMaskLUT=function(a,b,d){if("u8"!==a&&"s8"!==a&&"u16"!==a&&"s16"!==a)return null;var g=a.includes("16")?65536:256;a=a.includes("s")?-g/2:0;g=new Uint8Array(g);if(b)for(let f=0;f<b.length;f++){var c=Math.ceil(b[2*f]-a);const h=Math.floor(b[2*f+1]-
a);for(;c<=h;c++)g[c]=255}else g.fill(255);if(d)for(b=0;b<d.length;b++)g[d[b]-a]=0;return{lut:g,offset:a}};p.createRemapLUT=function(a){const {srcPixelType:b,inputRanges:d,outputValues:g,allowUnmatched:c,noDataRanges:f,isLastInputRangeInclusive:h,outputPixelType:k}=a;if("u8"!==b&&"s8"!==b&&"u16"!==b&&"s16"!==b)return null;var m=b.includes("16")?65536:256;a=b.includes("s")?-m/2:0;const v=y.createEmptyBand(k,m);m=new Uint8Array(m);c&&m.fill(255);const [x,C]=D.getPixelValueRange(k);if(d?.length&&g?.length){var H=
d.map(O=>O-1E-6);H[0]=d[0];h&&(H[H.length-1]=d[d.length-1]);for(var E=0;E<H.length;E++){var P=g[E]>C?C:g[E]<x?x:g[E],U=Math.ceil(H[2*E]-a);const O=Math.floor(H[2*E+1]-a);for(;U<=O;U++)v[U]=P,m[U]=255}}if(f?.length)for(H=0;H<f.length;H++)for(P=Math.ceil(f[2*H]-a),E=Math.floor(f[2*H+1]-a);P<=E;P++)m[P]=0;return{lut:v,offset:a,mask:m}};p.extractBands=function(a,b){return b?.length&&G(a)?a.extractBands(b):a};p.getClipBounds=S;p.getLocalArithmeticNorthRotations=function(a,b){const {coefficients:d,spacing:g}=
b,{offsets_x:c,offsets_y:f,gridWidth:h}=R(a,a,d,{rows:g[0],cols:g[1]}),{width:k,height:m}=a;a=new Float32Array(k*m);b=180/Math.PI;for(let C=0;C<m;C++)for(let H=0;H<k;H++){var v=C*h+H,x=0===C?v:v-h;const E=C===m-1?v:v+h;v=c[x]-c[E];x=f[E]-f[x];isNaN(v)||isNaN(x)?a[C*k+H]=90:(x=Math.atan2(x,v)*b,x=(360+x)%360,a[C*k+H]=x)}return a};p.interpolateOffsets=R;p.isValidPixelBlock=G;p.lookupBandValues=F;p.lookupPixels=function(a,b){if(!G(a))return null;const {pixels:d,mask:g}=a,c=d.length;let f=b.lut;const {offset:h}=
b;f&&1===f[0].length&&(f=d.map(()=>f));const k=[];b=b.outputPixelType||"u8";for(let m=0;m<c;m++){const v=F(d[m],g,f[m],h||0,b);k.push(v)}a=new y({width:a.width,height:a.height,pixels:k,mask:g,pixelType:b});a.updateStatistics();return a};p.mask=function(a,b){if(!G(a))return null;const {width:d,height:g,pixels:c}=a;var f=d*g;const h=new Uint8Array(f);a.mask?h.set(a.mask):h.fill(255);a=c.length;const {includedRanges:k,noDataValues:m,outputPixelType:v,matchAll:x,lookups:C}=b;if(C){f=[];for(b=0;b<a;b++){var H=
C[b];H=F(c[b],h,H.lut,H.offset||0,"u8");f.push(H)}1===f.length?h.set(f[0]):x?z(f,h):u(f,h)}else if(x){b=[];for(H=0;H<a;H++){const E=new Uint8Array(f);E.set(h);N(c[H],k?.slice(2*H,2*H+2),m?.[H],E);b.push(E)}1===b.length?h.set(b[0]):z(b,h)}else for(f=0;f<a;f++)N(c[f],k?.slice(2*f,2*f+2),m?.[f],h);return new y({width:d,height:g,pixelType:v,pixels:c,mask:h})};p.maxMapSizeGpu=6;p.mosaic=J;p.mosaicPixelData=function(a,b){if(!a||0===a.length)return null;var d=a.find(C=>C.pixelBlock);if(null==d?.pixelBlock)return null;
var g=(d.extent.xmax-d.extent.xmin)/d.pixelBlock.width;const c=(d.extent.ymax-d.extent.ymin)/d.pixelBlock.height,f=.01*Math.min(g,c),h=a.sort((C,H)=>Math.abs(C.extent.ymax-H.extent.ymax)>f?H.extent.ymax-C.extent.ymax:Math.abs(C.extent.xmin-H.extent.xmin)>f?C.extent.xmin-H.extent.xmin:0);var k=Math.min.apply(null,h.map(C=>C.extent.xmin));const m=Math.min.apply(null,h.map(C=>C.extent.ymin)),v=Math.max.apply(null,h.map(C=>C.extent.xmax)),x=Math.max.apply(null,h.map(C=>C.extent.ymax));a={x:Math.round((b.xmin-
k)/g),y:Math.round((x-b.ymax)/c)};k={width:Math.round((v-k)/g),height:Math.round((x-m)/c)};g={width:Math.round((b.xmax-b.xmin)/g),height:Math.round((b.ymax-b.ymin)/c)};if(Math.round(k.width/d.pixelBlock.width)*Math.round(k.height/d.pixelBlock.height)!==h.length||0>a.x||0>a.y||k.width<g.width||k.height<g.height)return null;d=h.map(C=>C.pixelBlock);d=J(d,k,{clipOffset:a,clipSize:g});return{extent:b,pixelBlock:d}};p.remap=function(a,b){if(!G(a))return null;const {width:d,height:g}=a,{inputRanges:c,outputValues:f,
outputPixelType:h,noDataRanges:k,allowUnmatched:m,isLastInputRangeInclusive:v}=b;b=a.pixels[0];const x=y.createEmptyBand(h,b.length),C=a.mask,H=new Uint8Array(d*g);C?H.set(C):H.fill(255);const E=a.pixelType.startsWith("f")?1E-6:0;a=c.map(Z=>Z-E);a[0]=c[0];a[a.length-1]=c[c.length-1]+(v?1E-6:0);var P=c.length/2;const [U,O]=D.getPixelValueRange(h);for(var Y=0;Y<g;Y++)for(var X=0;X<d;X++){var ba=Y*d+X;if(H[ba]){var aa=b[ba];let Z=!1;for(let da=P-1;0<=da;da--)if(aa===a[2*da]||aa>a[2*da]&&aa<a[2*da+1]){x[ba]=
f[da];Z=!0;break}Z||(m?x[ba]=aa>O?O:aa<U?U:aa:H[ba]=0)}}if(a=k?.length)for(P=0;P<g;P++)for(Y=0;Y<d;Y++)if(X=P*d+Y,!C||C[X])for(ba=b[X],aa=0;aa<a;aa+=2)if(ba>=k[aa]&&ba<=k[aa+1]){x[X]=0;H[X]=0;break}return new y({width:d,height:g,pixelType:h,pixels:[x],mask:H})};p.remapColor=function(a,b){if(!G(a))return null;a=a.clone();var {pixels:d}=a;const g=a.width*a.height,c=b.length,f=Math.floor(c/2),h=b[Math.floor(f)];d=d[0];let k,m,v,x,C,H,E=!1;const P=new Uint8Array(g),U=new Uint8Array(g),O=new Uint8Array(g);
let Y=a.mask;const X=4===b[0].mappedColor.length;Y||(Y=new Uint8Array(g),Y.fill(X?255:1),a.mask=Y);for(C=0;C<g;C++)if(Y[C]){k=d[C];E=!1;H=f;m=h;v=0;for(x=c-1;1<x-v;){if(k===m.value){E=!0;break}k>m.value?v=H:x=H;H=Math.floor((v+x)/2);m=b[Math.floor(H)]}E||(k===b[v].value?(m=b[v],E=!0):k===b[x].value?(m=b[x],E=!0):k<b[v].value?(E=!1,m=null):k>b[v].value&&(k<b[x].value?(m=b[v],E=!0):x===c-1?(E=!1,m=null):(m=b[x],E=!0)));E?(P[C]=m.mappedColor[0],U[C]=m.mappedColor[1],O[C]=m.mappedColor[2],Y[C]=m.mappedColor[3]):
P[C]=U[C]=O[C]=Y[C]=0}a.pixels=[P,U,O];a.mask=Y;a.pixelType="u8";a.maskIsAlpha=X;return a};p.resampleByMajority=A;p.setValidBoundary=function(a,b,d){if(!G(a))return null;const {width:g,height:c}=a,f=b.x;b=b.y;const h=d.width+f;d=d.height+b;if(0>f||0>b||h>g||d>c||0===f&&0===b&&h===g&&d===c)return a;a.mask||(a.mask=new Uint8Array(g*c));const k=a.mask;for(let m=0;m<c;m++){const v=m*g;for(let x=0;x<g;x++)k[v+x]=m<b||m>=d||x<f||x>=h?0:1}a.updateStatistics();return a};p.split=function(a,b,d=0,g=!0){if(!G(a))return null;
const {width:c,height:f}=b;let {width:h,height:k}=a;const m=new Map,v={x:0,y:0};d=1+d;for(let x=0;x<d;x++){const C=Math.ceil(h/c),H=Math.ceil(k/f);for(let E=0;E<H;E++){v.y=E*f;for(let P=0;P<C;P++){v.x=P*c;const U=r(a,v,b);m.set(`${x}/${E}/${P}`,U)}}x<d-1&&(a=B(a,g));h=Math.round(h/2);k=Math.round(k/2)}return m};Object.defineProperty(p,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/PixelBlock":function(){define("../../chunks/tslib.es6 ../../core/Error ../../core/JSONSupport ../../core/lang ../../core/Logger ../../core/accessorSupport/decorators/property ../../core/accessorSupport/decorators/cast ../../core/accessorSupport/decorators/subclass ./SimpleBandStatistics ./rasterFormats/pixelRangeUtils".split(" "),
function(p,y,D,G,F,N,z,u,S,W){var J;D=J=class extends D.JSONSupport{static createEmptyBand(n,A){return new (J.getPixelArrayConstructor(n))(A)}static combineBandMasks(n){if(2>n.length)return n[0];const A=n[0].length,M=(new Uint8Array(A)).fill(255);for(let q=0;q<n.length;q++){const t=n[q];for(let r=0;r<A;r++)t[r]||(M[r]=0)}return M}static getPixelArrayConstructor(n){let A;switch(n){case "u1":case "u2":case "u4":case "u8":A=Uint8Array;break;case "u16":A=Uint16Array;break;case "u32":A=Uint32Array;break;
case "s8":A=Int8Array;break;case "s16":A=Int16Array;break;case "s32":A=Int32Array;break;case "f32":A=Float32Array;break;case "f64":A=Float64Array;break;case "c64":case "c128":case "unknown":A=Float32Array}return A}constructor(n){super(n);this.height=this.width=null;this.pixelType="f32";this.mask=this.validPixelCount=null;this.premultiplyAlpha=this.maskIsAlpha=!1;this.statistics=null;this.depthCount=1}castPixelType(n){if(!n)return"f32";n=n.toLowerCase();["u1","u2","u4"].includes(n)?n="u8":"unknown u8 s8 u16 s16 u32 s32 f32 f64".split(" ").includes(n)||
(n="f32");return n}getPlaneCount(){return this.pixels?.length}addData(n){if(!n.pixels||n.pixels.length!==this.width*this.height)throw new y("pixelblock:invalid-or-missing-pixels","add data requires valid pixels array that has same length defined by pixel block width * height");this.pixels||(this.pixels=[]);this.statistics||(this.statistics=[]);this.pixels.push(n.pixels);this.statistics.push(n.statistics??new S.SimpleBandStatistics)}getAsRGBA(){const n=new ArrayBuffer(this.width*this.height*4);switch(this.pixelType){case "s8":case "s16":case "u16":case "s32":case "u32":case "f32":case "f64":this._fillFromNon8Bit(n);
break;default:this._fillFrom8Bit(n)}return new Uint8ClampedArray(n)}getAsRGBAFloat(){const n=new Float32Array(this.width*this.height*4);this._fillFrom32Bit(n);return n}updateStatistics(){if(this.pixels){this.statistics=this.pixels.map(M=>{var q=this.mask;let t=Infinity,r=-Infinity;const B=M.length;let R,a=0;if(null!=q)for(R=0;R<B;R++)q[R]&&(a=M[R],t=a<t?a:t,r=a>r?a:r);else for(R=0;R<B;R++)a=M[R],t=a<t?a:t,r=a>r?a:r;return new S.SimpleBandStatistics(t,r)});var n=this.mask,A=0;if(null!=n)for(let M=
0;M<n.length;M++)n[M]&&A++;else A=this.width*this.height;this.validPixelCount=A}}clamp(n){if(n&&"f64"!==n&&"f32"!==n&&this.pixels){var [A,M]=W.getPixelValueRange(n),q=this.pixels,t=this.width*this.height,r=q.length,B=[];for(let d=0;d<r;d++){var R=J.createEmptyBand(n,t);var a=q[d];for(let g=0;g<t;g++){var b=a[g];R[g]=b>M?M:b<A?A:b}B.push(R)}this.pixels=B;this.pixelType=n}}extractBands(n){const {pixels:A,statistics:M}=this;if(null==n||0===n.length||!A||0===A.length)return this;var q=A.length;const t=
n.some(d=>d>=A.length),r=q===n.length&&!n.some((d,g)=>d!==g);if(t||r)return this;q=this.bandMasks?.length===q?n.map(d=>this.bandMasks[d]):void 0;let {mask:B,validPixelCount:R}=this;const {width:a,height:b}=this;q?.length&&(B=J.combineBandMasks(q),R=B.filter(d=>!!d).length);return new J({pixelType:this.pixelType,width:a,height:b,mask:B,bandMasks:q,validPixelCount:R,maskIsAlpha:this.maskIsAlpha,pixels:n.map(d=>A[d]),statistics:M&&n.map(d=>M[d])})}clone(){const n=new J({width:this.width,height:this.height,
pixelType:this.pixelType,maskIsAlpha:this.maskIsAlpha,validPixelCount:this.validPixelCount});null!=this.mask&&(n.mask=new Uint8Array(this.mask));this.bandMasks&&(n.bandMasks=this.bandMasks.map(q=>new Uint8Array(q)));let A;const M=J.getPixelArrayConstructor(this.pixelType);if(this.pixels&&0<this.pixels.length){n.pixels=[];const q=!!this.pixels[0].slice;for(A=0;A<this.pixels.length;A++)n.pixels[A]=q?this.pixels[A].slice():new M(this.pixels[A])}if(this.statistics)for(n.statistics=[],A=0;A<this.statistics.length;A++)n.statistics[A]=
G.clone(this.statistics[A]);n.premultiplyAlpha=this.premultiplyAlpha;return n}_fillFrom8Bit(n){const {mask:A,maskIsAlpha:M,premultiplyAlpha:q,pixels:t}=this;if(n&&t?.length){var r,B;var R=r=B=t[0];3<=t.length?(r=t[1],B=t[2]):2===t.length&&(r=t[1]);var a=new Uint32Array(n),b=this.width*this.height;if(R.length!==b)F.getLogger(this).error("getAsRGBA()","Unable to convert to RGBA. The pixelblock is invalid.");else if(null!=A&&A.length===b)if(M)for(n=0;n<b;n++){const d=A[n];if(d){const g=d/255;a[n]=q?
d<<24|B[n]*g<<16|r[n]*g<<8|R[n]*g:d<<24|B[n]<<16|r[n]<<8|R[n]}}else for(n=0;n<b;n++)A[n]&&(a[n]=-16777216|B[n]<<16|r[n]<<8|R[n]);else for(n=0;n<b;n++)a[n]=-16777216|B[n]<<16|r[n]<<8|R[n]}else F.getLogger(this).error("getAsRGBA()","Unable to convert to RGBA. The input pixel block is empty.")}_fillFromNon8Bit(n){const {pixels:A,mask:M,statistics:q}=this;if(n&&A?.length){var t=this.pixelType,r=1,B=0;r=1;if(q&&0<q.length){for(var R of q)null!=R.minValue&&(B=Math.min(B,R.minValue)),null!=R.maxValue&&null!=
R.minValue&&(r=Math.max(r,R.maxValue-R.minValue));r=255/r}else r=255,"s8"===t?(B=-128,r=127):"u16"===t?r=65535:"s16"===t?(B=-32768,r=32767):"u32"===t?r=4294967295:"s32"===t?(B=-2147483648,r=2147483647):"f32"===t?(B=-3.4*1E39,r=3.4*1E39):"f64"===t&&(B=-Number.MAX_VALUE,r=Number.MAX_VALUE),r=255/(r-B);n=new Uint32Array(n);t=this.width*this.height;var a,b,d;R=a=b=A[0];if(R.length!==t)return F.getLogger(this).error("getAsRGBA()","Unable to convert to RGBA. The pixelblock is invalid.");if(2<=A.length)if(a=
A[1],3<=A.length&&(b=A[2]),null!=M&&M.length===t)for(d=0;d<t;d++)M[d]&&(n[d]=-16777216|(b[d]-B)*r<<16|(a[d]-B)*r<<8|(R[d]-B)*r);else for(d=0;d<t;d++)n[d]=-16777216|(b[d]-B)*r<<16|(a[d]-B)*r<<8|(R[d]-B)*r;else if(null!=M&&M.length===t)for(d=0;d<t;d++)a=(R[d]-B)*r,M[d]&&(n[d]=-16777216|a<<16|a<<8|a);else for(d=0;d<t;d++)a=(R[d]-B)*r,n[d]=-16777216|a<<16|a<<8|a}else F.getLogger(this).error("getAsRGBA()","Unable to convert to RGBA. The input pixel block is empty.")}_fillFrom32Bit(n){const {pixels:A,mask:M}=
this;if(!n||!A?.length)return F.getLogger(this).error("getAsRGBAFloat()","Unable to convert to RGBA. The input pixel block is empty.");let q,t,r,B;q=t=r=A[0];3<=A.length?(t=A[1],r=A[2]):2===A.length&&(t=A[1]);const R=this.width*this.height;if(q.length!==R)return F.getLogger(this).error("getAsRGBAFloat()","Unable to convert to RGBA. The pixelblock is invalid.");let a=0;if(null!=M&&M.length===R)for(B=0;B<R;B++)n[a++]=q[B],n[a++]=t[B],n[a++]=r[B],n[a++]=M[B]&1;else for(B=0;B<R;B++)n[a++]=q[B],n[a++]=
t[B],n[a++]=r[B],n[a++]=1}};p.__decorate([N.property({json:{write:!0}})],D.prototype,"width",void 0);p.__decorate([N.property({json:{write:!0}})],D.prototype,"height",void 0);p.__decorate([N.property({json:{write:!0}})],D.prototype,"pixelType",void 0);p.__decorate([z.cast("pixelType")],D.prototype,"castPixelType",null);p.__decorate([N.property({json:{write:!0}})],D.prototype,"validPixelCount",void 0);p.__decorate([N.property({json:{write:!0}})],D.prototype,"mask",void 0);p.__decorate([N.property({json:{write:!0}})],
D.prototype,"maskIsAlpha",void 0);p.__decorate([N.property({json:{write:!0}})],D.prototype,"pixels",void 0);p.__decorate([N.property()],D.prototype,"premultiplyAlpha",void 0);p.__decorate([N.property({json:{write:!0}})],D.prototype,"statistics",void 0);p.__decorate([N.property({json:{write:!0}})],D.prototype,"depthCount",void 0);p.__decorate([N.property({json:{write:!0}})],D.prototype,"noDataValues",void 0);p.__decorate([N.property({json:{write:!0}})],D.prototype,"bandMasks",void 0);return D=J=p.__decorate([u.subclass("esri.layers.support.PixelBlock")],
D)})},"esri/layers/support/SimpleBandStatistics":function(){define(["exports"],function(p){class y{constructor(D=null,G=null,F=null){this.minValue=D;this.maxValue=G;this.noDataValue=F}}p.SimpleBandStatistics=y;Object.defineProperty(p,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/rasterFormats/pixelRangeUtils":function(){define(["exports"],function(p){function y(F){return G[F]??[-3.4028234663852886E38,3.4028234663852886E38]}function D(F){return(F?.startsWith("s")||F?.startsWith("u"))??
!1}const G={u1:[0,1],u2:[0,3],u4:[0,15],u8:[0,255],s8:[-128,127],u16:[0,65535],s16:[-32768,32767],u32:[0,4294967295],s32:[-2147483648,2147483647],f32:[-3.4028234663852886E38,3.4028234663852886E38],f64:[-Number.MAX_VALUE,Number.MAX_VALUE],unknown:void 0,c64:void 0,c128:void 0};p.clipBandToPixelTypeRange=function(F,N,z,u){let [S,W]=y(z);var J=D(z);J&&(S-=1E-5,W+=1E-5);if(J)if(z.startsWith("u")){const [n,A]=[S,W];for(z=0;z<N.length;z++)N[z]&&(J=F[z],J<n||J>A?N[z]=0:u[z]=J+.5<<0)}else{const [n,A]=[S,
W];for(z=0;z<N.length;z++)N[z]&&(J=F[z],J<n||J>A?N[z]=0:u[z]=J+(0<J?.5:-.5)<<0)}else{const [n,A]=[S,W];for(z=0;z<N.length;z++)N[z]&&(J=F[z],J<n||J>A?N[z]=0:u[z]=J)}};p.convertNoDataToMask=function(F,N,z){if(!(F.depthCount&&1<F.depthCount)){var {pixels:u,statistics:S,pixelType:W}=F,J=u[0].length,n=F.bandMasks??[];J=F.mask??(new Uint8Array(J)).fill(255);var A="f32"===W||"f64"===W,M=y(W),q=!1;for(let B=0;B<u.length;B++){const R="number"===typeof N?N:N[B];if(null==R)continue;var t=S?.[B]?.maxValue??M[1];
if((S?.[B]?.minValue??M[0])>R+Number.EPSILON||t<R-Number.EPSILON)continue;t=n[B]||J.slice();const a=u[B];var r=z?.customFloatTolerance;if(A&&0!==r){r||=9.999999E37<=Math.abs(R)?2E-7*Math.abs(R):"f32"===W?2**-23:Number.EPSILON;for(let b=0;b<a.length;b++)t[b]&&Math.abs(a[b]-R)<r&&(a[b]=0,t[b]=0,J[b]=0,q=!0)}else for(r=0;r<a.length;r++)t[r]&&a[r]===R&&(a[r]=0,t[r]=0,J[r]=0,q=!0);n[B]=t}q&&(F.bandMasks=F.bandMasks||1<F.pixels.length?n:null,F.mask=J);q&&"updateStatistics"in F&&F.updateStatistics()}};p.fixNaN=
function(F,N){for(let z=0;z<N.length;z++)N[z]&&isNaN(F[z])&&(N[z]=0,F[z]=0)};p.getIntegerPixelType=function(F,N){return null==F||null==N?"s32":0>F?-128<=F&&128>N?"s8":-32768<=F&&32768>N?"s16":"s32":256>N?"u8":65536>N?"u16":"u32"};p.getPixelValueRange=y;p.isIntegerPixelType=D;Object.defineProperty(p,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/support/ExportStrategy":function(){define("../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/has ../../../../core/promiseUtils ../../../../core/accessorSupport/decorators/property ../../../../core/Logger ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ../../../../geometry/support/aaBoundingRect ../../../../geometry/support/spatialReferenceUtils ../../../../layers/support/TileInfo ../../viewStateUtils ../../engine/Bitmap ../../tiling/TileInfoView ../../tiling/TileKey".split(" "),
function(p,y,D,G,F,N,z,u,S,W,J,n,A,M,q){const t=S.create(),r=[0,0],B=new q(0,0,0,0);y=class extends y{constructor(R){super(R);this._imagePromise=null;this.bitmaps=[];this.hidpi=!1;this.imageMaxHeight=this.imageMaxWidth=2048;this.imageNormalizationSupported=this.imageRotationSupported=!1;this.update=G.debounce(async(a,b)=>{G.throwIfAborted(b);if(a.stationary&&!this.destroyed){var d=a.state,g=W.getInfo(d.spatialReference);a=this.hidpi?a.pixelRatio:1;var c=0<d.worldScreenWidth,f=c&&this.imageNormalizationSupported&&
d.worldScreenWidth<d.size[0],h=Math.round((this.imageMaxWidth??0)/a),k=Math.round((this.imageMaxHeight??0)/a);f?(r[0]=d.worldScreenWidth,r[1]=d.size[1]):this.imageRotationSupported?(r[0]=d.size[0],r[1]=d.size[1]):n.getOuterSize(r,d);g=g&&(d.extent.xmin<g.valid[0]||d.extent.xmax>g.valid[1]);g=!this.imageNormalizationSupported&&g;var m=!(Math.floor(r[0])>h||Math.floor(r[1])>k)&&!g,v=this.imageRotationSupported?d.rotation:0;g=this.container.children.slice();m?this._imagePromise=this._singleExport(d,
r,f?d.paddedViewState.center:d.center,d.resolution,v,a,b):(f=Math.min(h,k),c&&(f=Math.min(d.worldScreenWidth,f),f=Math.round(d.worldScreenWidth/Math.ceil(d.worldScreenWidth/f))),this._imagePromise=this._tiledExport(d,f,a,b));try{const x=await this._imagePromise??[];G.throwIfAborted(b);b=[];this._imagePromise=null;if(!this.destroyed){this.bitmaps=x;for(const C of g)x.includes(C)||b.push(C.fadeOut().then(()=>{C.remove();C.destroy()}));for(const C of x)b.push(C.fadeIn());await Promise.all(b)}}catch(x){this._imagePromise=
null,G.throwIfAbortError(x)}}},5E3);this.updateExports=G.debounce(async a=>{const b=[];for(const d of this.container.children){if(!d.visible||!d.stage)return;b.push(a(d).then(()=>{d.invalidateTexture();d.requestRender()}))}this._imagePromise=G.eachAlways(b).then(()=>this._imagePromise=null);await this._imagePromise})}destroy(){this.bitmaps.forEach(R=>R.destroy());this.bitmaps=[]}get updating(){return!this.destroyed&&null!==this._imagePromise}async _export(R,a,b,d,g,c){b=await this.fetchSource(R,Math.floor(a*
g),Math.floor(b*g),{rotation:d,pixelRatio:g,signal:c});G.throwIfAborted(c);const f=new A.Bitmap(null,!0);f.x=R.xmin;f.y=R.ymax;f.resolution=R.width/a;f.rotation=d;f.pixelRatio=g;f.opacity=0;this.container.addChild(f);await f.setSourceAsync(b,c);G.throwIfAborted(c);return f}async _singleExport(R,a,b,d,g,c,f){n.getBBox(t,b,d,a);R=S.toExtent(t,R.spatialReference);return[await this._export(R,a[0],a[1],g,c,f)]}_tiledExport(R,a,b,d){var g=J.create({size:a,spatialReference:R.spatialReference,scales:[R.scale]});
const c=new M(g);g=c.getTileCoverage(R);if(!g)return null;const f=[];g.forEach((h,k,m,v)=>{B.set(h,k,m,0);c.getTileBounds(t,B);const x=S.toExtent(t,R.spatialReference);f.push(this._export(x,a,a,0,b,d).then(C=>{0!==v&&(B.set(h,k,m,v),c.getTileBounds(t,B),C.x=t[0],C.y=t[3]);return C}))});return Promise.all(f)}};p.__decorate([F.property()],y.prototype,"_imagePromise",void 0);p.__decorate([F.property()],y.prototype,"bitmaps",void 0);p.__decorate([F.property()],y.prototype,"container",void 0);p.__decorate([F.property()],
y.prototype,"fetchSource",void 0);p.__decorate([F.property()],y.prototype,"hidpi",void 0);p.__decorate([F.property()],y.prototype,"imageMaxWidth",void 0);p.__decorate([F.property()],y.prototype,"imageMaxHeight",void 0);p.__decorate([F.property()],y.prototype,"imageRotationSupported",void 0);p.__decorate([F.property()],y.prototype,"imageNormalizationSupported",void 0);p.__decorate([F.property()],y.prototype,"requestUpdate",void 0);p.__decorate([F.property()],y.prototype,"updating",null);return y=p.__decorate([u.subclass("esri.views.2d.layers.support.ExportStrategy")],
y)})},"esri/views/2d/viewStateUtils":function(){define(["exports"],function(p){const y=Math.PI/180;p.getBBox=function(D,G,F,N){const [z,u]=G,[S,W]=N;G=.5*F;D[0]=z-G*S;D[1]=u-G*W;D[2]=z+G*S;D[3]=u+G*W;return D};p.getOuterSize=function(D,G){var F=G.rotation*y;const N=Math.abs(Math.cos(F));F=Math.abs(Math.sin(F));const [z,u]=G.size;D[0]=Math.round(u*F+z*N);D[1]=Math.round(u*N+z*F);return D};Object.defineProperty(p,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/imagery/VectorFieldView2D":function(){define("../../../../chunks/tslib.es6 ../../../../Graphic ../../../../request ../../../../core/Accessor ../../../../core/Logger ../../../../core/promiseUtils ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ../../../../geometry/Extent ../../../../geometry/support/spatialReferenceUtils ../../../../layers/support/rasterFunctions/rasterProjectionHelper ../../../../layers/support/rasterFunctions/vectorFieldUtils ../../engine/imagery/RasterVFContainer ./ImageryVFStrategy".split(" "),
function(p,y,D,G,F,N,z,u,S,W,J,n,A,M,q,t,r){G=class extends G{constructor(){super(...arguments);this.attached=!1;this.container=new t.RasterVFContainer;this.type="imageryVF";this._dataParameters={exportParametersVersion:0,bbox:"",symbolTileSize:0,time:""};this._fetchpixels=async(B,R,a,b)=>{const d=await this._projectFullExtentPromise,{symbolTileSize:g}=this.layer.renderer,{extent:c,width:f,height:h}=q.snapImageToSymbolTile(B,R,a,g,d);if(null!=d&&!d.intersects(B))return{extent:c,pixelBlock:null};B=
{bbox:`${c.xmin}, ${c.ymin}, ${c.xmax}, ${c.ymax}`,exportParametersVersion:this.layer.exportImageServiceParameters.version,symbolTileSize:g,time:JSON.stringify(this.timeExtent||"")};if(this._canReuseVectorFieldData(B)&&(R=this.getPixelData(),null!=R&&`${R.extent.xmin}, ${R.extent.ymin}, ${R.extent.xmax}, ${R.extent.ymax}`===B.bbox))return R;({pixelData:b}=await this.layer.fetchImage(c,f,h,{timeExtent:this.timeExtent,requestAsImageElement:!1,signal:b}));this._dataParameters=B;b=b?.pixelBlock;if(null==
b)return{extent:c,pixelBlock:null};b="vector-uv"===this.layer.rasterInfo.dataType?q.convertVectorFieldData(b,"vector-uv"):b;return{extent:c,pixelBlock:b}}}get updating(){return!this.attached||this._strategy.updating}attach(){this._projectFullExtentPromise=this._getProjectedFullExtent(this.view.spatialReference);this._strategy=new r({container:this.container,fetchPixels:this._fetchpixels});this.addHandles(z.watch(()=>this.layer.renderer,B=>this._updateSymbolizerParams(B),z.syncAndInitial),"attach")}detach(){this._strategy.destroy();
this.container.children.forEach(B=>B.destroy());this.container.removeAllChildren();this.removeHandles("attach");this._strategy=this.container=this._projectFullExtentPromise=null}getPixelData(){const B=this.container.children[0]?.rawPixelData;if(this.updating||!B)return null;const {extent:R,pixelBlock:a}=B;return{extent:R,pixelBlock:a}}hitTest(B){return new y({attributes:{},geometry:B.clone(),layer:this.layer})}update(B){this._strategy.update(B,this._symbolizerParams).catch(R=>{N.isAbortError(R)||
F.getLogger(this).error(R)})}redraw(){const {renderer:B}=this.layer;B&&(this._updateSymbolizerParams(B),this._strategy.redraw(this._symbolizerParams))}_canReuseVectorFieldData(B){const R=this._dataParameters.time===B.time,a=this._dataParameters.symbolTileSize===B.symbolTileSize,b=this._dataParameters.bbox===B.bbox;return this._dataParameters.exportParametersVersion===B.exportParametersVersion&&R&&a&&b}async _getProjectedFullExtent(B){try{return M.projectExtent(this.layer.fullExtent,B)}catch(R){try{const a=
(await D(this.layer.url,{query:{option:"footprints",outSR:A.srToRESTValue(B),f:"json"}})).data.featureCollection.layers[0].layerDefinition.extent;return a?n.fromJSON(a):null}catch{return null}}}_updateSymbolizerParams(B){"vector-field"===B.type&&(this._symbolizerParams=this.layer.symbolizer.generateWebGLParameters({pixelBlock:null}))}};p.__decorate([u.property()],G.prototype,"attached",void 0);p.__decorate([u.property()],G.prototype,"container",void 0);p.__decorate([u.property()],G.prototype,"layer",
void 0);p.__decorate([u.property()],G.prototype,"timeExtent",void 0);p.__decorate([u.property()],G.prototype,"type",void 0);p.__decorate([u.property()],G.prototype,"view",void 0);p.__decorate([u.property()],G.prototype,"updating",null);return G=p.__decorate([J.subclass("esri.views.2d.layers.imagery.VectorFieldView2D")],G)})},"esri/layers/support/rasterFunctions/rasterProjectionHelper":function(){define("require exports ../../../geometry ../../../core/arrayUtils ../../../core/Error ../../../core/unitUtils ../../../chunks/pe ../../../geometry/projection ../../../geometry/support/spatialReferenceUtils ../../../geometry/Extent ../../../geometry/Polygon ../../../geometry/Point ../../../geometry/SpatialReference".split(" "),
function(p,y,D,G,F,N,z,u,S,W,J,n,A){function M(e,l,w){return!u.canProjectWithoutEngine(e,l,w)}function q(e,l,w){if((e=M(e,l,w))&&!u.isLoaded())throw new F("rasterprojectionhelper-project","projection engine is not loaded");return e}function t(e,l,w){q(e.spatialReference,l);return w?u.getTransformation(l,e.spatialReference,e):u.getTransformation(e.spatialReference,l,e)}function r(e,l,w){l=N.getMetersPerUnitForSR(l)/N.getMetersPerUnitForSR(w);return{x:e.x*l,y:e.y*l}}function B(e,l,w){const {spatialReference:I}=
w;if(!I||!l||I.equals(l))return e;if(I.isGeographic&&l.isGeographic)return r(e,I,l);q(I,l);if(!qa)throw new F("raster-projection-helper:project-dataset-resolution","geometry engine is not loaded");let {x:V,y:K}=e;var T=N.getMetersPerUnitForSR(I),Q=(V+K)/2*T;T=1;30<Q&&(T=30/Q,V*=T,K*=T);Q=256*V/2;var L=256*K/2;const {x:ea,y:ca}=w.center;w=[];for(var fa=0;256>=fa;fa++)w.push([ea-Q,ca-L+fa*K]);for(fa=1;256>=fa;fa++)w.push([ea-Q+fa*V,ca+L]);for(fa=1;256>=fa;fa++)w.push([ea+Q,ca+L-fa*K]);for(fa=1;256>
fa;fa++)w.push([ea+Q-fa*V,ca-L]);w.push(w[0]);Q=new J({rings:[w],spatialReference:I});L=u.project(Q,l);if(!L)return r(e,I,l);Q=L.extent;w=E(l);if(null==Q||null!=w&&Q.width>=w)return r(e,I,l);e=qa.planarArea(L);e=Math.sqrt(e/(V*K*65536))/T;T={x:Q.width/T/256,y:Q.height/T/256};e={x:V*e,y:K*e};l=T.x*T.y;return.1>Math.abs(l-e.x*e.y)/l?T:e}function R(e,l=.01){return N.getMetersPerUnitForSR(e)?l/N.getMetersPerUnitForSR(e):0}function a(e,l,w=null,I=!0){const V=e.spatialReference;if(V.equals(l))return e;
q(V,l,w);w=u.project(e,l,w);if(!I||!w)return w;b([e],[w],V,l);return w}function b(e,l,w,I){const V=P(w,!0),K=P(I,!0);w=R(w,500);I=R(I,500);if(w&&null!=V&&null!=K)for(let T=0;T<e.length;T++){const Q=l[T];if(!Q)continue;const {x:L}=e[T],{x:ea}=Q;ea>=K[1]-I&&Math.abs(L-V[0])<w?Q.x-=K[1]-K[0]:ea<=K[0]+I&&Math.abs(L-V[1])<w&&(Q.x+=K[1]-K[0])}}function d(e){const {inSR:l,outSR:w,datumTransformation:I,preferPE:V}=e;if(l.equals(w))return{points:e}=k(e,null),e;if(l.isWebMercator&&w.isWGS84||l.isWGS84&&w.isWebMercator){const {cols:L,
rows:ea,xres:ca,yres:fa,usePixelCenter:ha,inSR:ia,outSR:la}=e;let {xmin:oa,ymax:pa}=e;ha&&(oa+=ca/2,pa-=fa/2);e=[];const ma=[];var K=Math.max(L,ea);for(var T=0;T<K;T++){var Q=u.project(new n({x:oa+ca*Math.min(L,T),y:pa-fa*Math.min(ea,T),spatialReference:ia}),la);T<=L&&e.push(Q.x);T<=ea&&ma.push(Q.y)}K=[];for(T=0;T<L;T++)for(Q=0;Q<ea;Q++)K.push([e[T],ma[Q]]);return K}return q(l,w,I)&&V&&(l.isGeographic||null!=f(l))?c(e):g(e)}function g(e){var {points:l}=k(e,null);const {inSR:w,outSR:I,datumTransformation:V}=
e;e=l.map(K=>new n(K[0],K[1],w));l=u.project(e,I,V);V&&b(e,l,w,I);return l.map(K=>K?[K.x,K.y]:[NaN,NaN])}function c(e){const {inSR:l,outSR:w,datumTransformation:I}=e;var V=f(l);const {points:K,mask:T}=k(e,V);l.isGeographic||(e=l.wkid?z.PeFactory.coordsys(l.wkid):z.PeFactory.fromString(l.isGeographic?z.PeDefs.PE_TYPE_GEOGCS:z.PeDefs.PE_TYPE_PROJCS,l.wkt2||l.wkt),z.PeCSTransformations.projToGeog(e,K.length,K));if(null!=I&&I.steps.length){var Q;w.isGeographic&&(Q=K.map(([L])=>179.9955<L?1:-179.9955>
L?-1:0));I.steps.forEach(L=>{const ea=L.wkid?z.PeFactory.geogtran(L.wkid):z.PeFactory.fromString(z.PeDefs.PE_TYPE_GEOGTRAN,L.wkt);z.PeGTTransformations.geogToGeog(ea,K.length,K,null,L.isInverse?z.PeDefs.PE_TRANSFORM_2_TO_1:z.PeDefs.PE_TRANSFORM_1_TO_2)});if(Q)for(e=0;e<K.length;e++){V=Q[e];const L=K[e][0],ea=179.9955<L?1:-179.9955>L?-1:0;V&&ea&&V!==ea&&(K[e][0]=0<V?L+360:L-360)}}w.isGeographic||(Q=f(w,!0),m(K,null!=Q&&Q.isEnvelope?[Q.bbox[1],Q.bbox[3]]:[-90,90]),Q=w.wkid?z.PeFactory.coordsys(w.wkid):
z.PeFactory.fromString(w.isGeographic?z.PeDefs.PE_TYPE_GEOGCS:z.PeDefs.PE_TYPE_PROJCS,w.wkt2||w.wkt),z.PeCSTransformations.geogToProj(Q,K.length,K));Q=K;if(T&&K.length!==T.length){Q=[];for(let L=0,ea=0;L<T.length;L++)T[L]?Q.push(K[ea++]):Q.push([NaN,NaN])}return Q}function f(e,l=!1){var w=e.wkid||e.wkt2||e.wkt;if(!w||e.isGeographic)return null;w=String(w);if(ja.has(w))return w=ja.get(w),l?w?.gcs:w?.pcs;var I=e.wkid?z.PeFactory.coordsys(e.wkid):z.PeFactory.fromString(e.isGeographic?z.PeDefs.PE_TYPE_GEOGCS:
z.PeDefs.PE_TYPE_PROJCS,e.wkt2||e.wkt);e=R(e,1E-4);e=h(I,e);I=h(I,0,!0);ja.set(w,{pcs:e,gcs:I});return l?I:e}function h(e,l=0,w=!1){var I=z.PePCSInfo.generate(e),V=w?e.horizonGcsGenerate():e.horizonPcsGenerate();if(!I||!V?.length)return null;e=!1;var K=V.find(ca=>1===ca.getInclusive()&&1===ca.getKind());if(!K){K=V.find(ca=>1===ca.getInclusive()&&0===ca.getKind());if(!K)return null;e=!0}w=w?0:(2===I.getNorthPoleLocation()?1:0)|(2===I.getSouthPoleLocation()?2:0);I=I.isPannableRectangle();K=K.getCoord();
if(e)return{isEnvelope:e,isPannable:I,vertices:K,coef:null,bbox:[K[0][0]-l,K[0][1]-l,K[1][0]+l,K[1][1]+l],poleLocation:w};l=0;e=[];let [T,Q]=K[0],[L,ea]=K[0];for(let ca=0,fa=K.length;ca<fa;ca++){l++;l===fa&&(l=0);const [ha,ia]=K[ca],[la,oa]=K[l];if(oa===ia)e.push([ha,la,ia,oa,2]);else{V=(la-ha)/(oa-ia||1E-4);const pa=ha-V*ia;ia<oa?e.push([V,pa,ia,oa,0]):e.push([V,pa,oa,ia,1])}T=T<ha?T:ha;Q=Q<ia?Q:ia;L=L>ha?L:ha;ea=ea>ia?ea:ia}return{isEnvelope:!1,isPannable:I,vertices:K,coef:e,bbox:[T,Q,L,ea],poleLocation:w}}
function k(e,l){const w=[],{cols:I,rows:V,xres:K,yres:T,usePixelCenter:Q}=e;let {xmin:L,ymax:ea}=e;Q&&(L+=K/2,ea-=T/2);if(null==l){for(e=0;e<I;e++)for(l=0;l<V;l++)w.push([L+K*e,ea-T*l]);return{points:w}}e=new Uint8Array(I*V);if(l.isEnvelope){const {bbox:[pa,ma,sa,ta]}=l;for(let ua=0,va=0;ua<I;ua++){var ca=L+K*ua,fa=l.isPannable||ca>=pa&&ca<=sa;for(var ha=0;ha<V;ha++,va++){var ia=ea-T*ha;fa&&ia>=ma&&ia<=ta&&(w.push([ca,ia]),e[va]=1)}}return{points:w,mask:e}}ca=l.coef;l=[];for(fa=0;fa<V;fa++){var la=
ea-T*fa;ha=[];ia=[];for(var oa=0;oa<ca.length;oa++){const [pa,ma,sa,ta,ua]=ca[oa];la===sa&&sa===ta?(ha.push(pa),ha.push(ma),ia.push(2),ia.push(2)):la>=sa&&la<=ta&&(ha.push(pa*la+ma),ia.push(ua))}la=ha;if(2<ha.length){oa=2===ia[0]?0:ia[0];let pa=ha[0];la=[];for(let ma=1;ma<ia.length;ma++)if(2!==ia[ma]||ma===ia.length-1)ia[ma]!==oa&&(la.push(0===oa?Math.min(pa,ha[ma-1]):Math.max(pa,ha[ma-1])),oa=ia[ma],pa=ha[ma]),ma===ia.length-1&&la.push(0===ia[ma]?Math.min(pa,ha[ma]):Math.max(pa,ha[ma]));la.sort((ma,
sa)=>ma-sa)}else ha[0]>ha[1]&&(la=[ha[1],ha[0]]);l.push(la)}for(let pa=0,ma=0;pa<I;pa++)for(ca=L+K*pa,fa=0;fa<V;fa++,ma++)if(ha=ea-T*fa,ia=l[fa],2===ia.length)ca>=ia[0]&&ca<=ia[1]&&(w.push([ca,ha]),e[ma]=1);else if(2<ia.length){la=!1;for(oa=0;oa<ia.length;oa+=2)if(ca>=ia[oa]&&ca<=ia[oa+1]){la=!0;break}la&&(w.push([ca,ha]),e[ma]=1)}return{points:w,mask:e}}function m(e,l){const [w,I]=l;for(l=0;l<e.length;l++){const V=e[l][1];if(V<w||V>I)e[l]=[NaN,NaN]}}function v(e,l){const w=E(e[0].spatialReference);
if(2>e.length||null==w)return e[0];l=l??R(e[0].spatialReference);e=e.filter(Q=>Q.width>l);if(1===e.length)return e[0];let {xmin:I,xmax:V,ymin:K,ymax:T}=e[0];for(let Q=1;Q<e.length;Q++){const L=e[Q];V=L.xmax+w*Q;K=Math.min(K,L.ymin);T=Math.max(T,L.ymax)}return new W({xmin:I,xmax:V,ymin:K,ymax:T,spatialReference:e[0].spatialReference})}function x(e,l,w=null,I=!0){var V=e.spatialReference;if(V.equals(l))return e;var K=O(e);const T=E(V,!0);var Q=E(l);if(0===K||null==T||null==Q)return K=H(e,l,w,I),null==
T&&null!=Q&&Math.abs(K.width-Q)<R(l)&&u.isLoaded()&&(V=f(V),null!=V&&V.poleLocation===Z.None&&e.width<(V.bbox[2]-V.bbox[0])/2)?C(e,l)||K:K;Q=e.clone().normalize();if(1===Q.length&&e.xmax<T&&e.xmax-T/2>R(V)){const {xmin:L,xmax:ea}=e;for(let ca=0;ca<=K;ca++)Q[ca]=new W({xmin:0===ca?L:-T/2,xmax:ca===K?ea-T*ca:T/2,ymin:e.ymin,ymax:e.ymax,spatialReference:V})}e=Q.map(L=>H(L,l,w,I));return v(e.filter(G.isSome))}function C(e,l){const w=E(l);if(null==w)return null;let {xmin:I,ymin:V,xmax:K,ymax:T}=e;var Q=
e.spatialReference;e=new J({spatialReference:Q,rings:[[[I,V],[K,V],[K,T],[I,T],[I,V]]]});e=u.project(e,l);if(2!==e.rings.length||!e.rings[0].length||!e.rings[1].length)return null;({rings:e}=e);Q=R(Q);l=new W({spatialReference:l});for(let L=0;2>L;L++){I=K=e[L][0][0];V=T=e[L][0][1];for(let ea=0;ea<e[L].length;ea++)I=I>e[L][ea][0]?e[L][ea][0]:I,K=K<e[L][ea][0]?e[L][ea][0]:K,V=V>e[L][ea][1]?e[L][ea][1]:V,T=T<e[L][ea][1]?e[L][ea][1]:T;if(0===L)l.ymin=V,l.ymax=T,l.xmin=I,l.xmax=K;else if(l.ymin=Math.min(l.ymin,
V),l.ymax=Math.max(l.ymax,T),Math.abs(K-w/2)<Q)l.xmin=I,l.xmax+=w;else if(Math.abs(I+w/2)<Q)l.xmax=K+w;else return null}return l}function H(e,l,w=null,I=!0,V=!0){const K=e.spatialReference;if(K.equals(l)||!l)return e;q(K,l,w);const T=u.project(e,l,w);if(V&&l.isWebMercator&&T&&(T.ymax=Math.min(2.0037508342787E7,T.ymax),T.ymin=Math.max(-2.0037508342787E7,T.ymin),T.ymin>=T.ymax))return null;if(!I||!T)return T;var Q=P(K,!0);I=P(l,!0);if(null==Q||null==I)return T;V=R(K,.001);const L=R(K,500);var ea=R(l,
.001);if(Math.abs(T.xmin-I[0])<ea&&Math.abs(T.xmax-I[1])<ea){ea=Math.abs(e.xmin-Q[0]);Q=Math.abs(Q[1]-e.xmax);if(ea<V&&Q>L){T.xmin=I[0];var ca=[];ca.push(new n(e.xmax,e.ymin,K));ca.push(new n(e.xmax,(e.ymin+e.ymax)/2,K));ca.push(new n(e.xmax,e.ymax,K));ca=ca.map(fa=>a(fa,l,w)).filter(fa=>!isNaN(fa?.x)).map(fa=>fa.x);T.xmax=Math.max.apply(null,ca)}Q<V&&ea>L&&(T.xmax=I[1],I=[],I.push(new n(e.xmin,e.ymin,K)),I.push(new n(e.xmin,(e.ymin+e.ymax)/2,K)),I.push(new n(e.xmin,e.ymax,K)),e=I.map(fa=>a(fa,l,
w)).filter(fa=>!isNaN(fa?.x)).map(fa=>fa.x),T.xmin=Math.min.apply(null,e))}else e=R(l,.001),Math.abs(T.xmin-I[0])<e&&(T.xmin=I[0]),Math.abs(T.xmax-I[1])<e&&(T.xmax=I[1]);return T}function E(e,l=!1){return e?e.isWebMercator?2*(l?2.0037508342787E7:2.0037508342788905E7):e.wkid&&e.isGeographic?360:2*ka[e.wkid]||null:null}function P(e,l=!1){if(e.isGeographic)return[-180,180];e=E(e,l);return null!=e?[-e/2,e/2]:null}function U(e,l,w,I){e=(e-l)/w;0!==e-Math.floor(e)?e=Math.floor(e):I&&--e;return e}function O(e,
l=!1){var w=E(e.spatialReference);if(null==w)return 0;const I=l?0:-(w/2),V=R(e.spatialReference),K=!l&&Math.abs(e.xmin+w/2)<V?-w/2:e.xmin;e=U(!l&&Math.abs(e.xmax-w/2)<V?w/2:e.xmax,I,w,!0);w=U(K,I,w,!1);return e-w}function Y(e){const {projectedExtent:l,srcBufferExtent:w,pixelSize:I,datumTransformation:V,rasterTransform:K}=e;var T=l.spatialReference;const Q=w.spatialReference;var L=q(T,Q);const {xmin:ea,ymin:ca,xmax:fa,ymax:ha}=l,ia=E(Q),la=null!=ia&&(e.hasWrapAround||"gcs-shift"===K?.type);e=e.spacing||
[32,32];var oa=e[0]*I.x,pa=e[1]*I.y;const ma=1===e[0],sa=Math.ceil((fa-ea)/oa-.1/e[0])+(ma?0:1),ta=Math.ceil((ha-ca)/pa-.1/e[1])+(ma?0:1);oa=d({cols:sa,rows:ta,xmin:ea,ymax:ha,xres:oa,yres:pa,inSR:T,outSR:Q,datumTransformation:V,preferPE:4>=e[0],usePixelCenter:ma});pa=[];let ua,va=0;const za=ma?-1:NaN,{xmin:Aa,xmax:ya,ymax:Ba,width:Ca,height:Da}=w,Ea=R(Q,500),Fa=null!=ia&&0<Aa&&ya>ia/2;var wa=!1;L&&(wa=f(T),wa=null!=wa&&0<wa.poleLocation);for(T=0;T<sa;T++){L=[];for(let xa=0;xa<ta;xa++){var ra=oa[T*
ta+xa];la&&ra[0]>ya&&ra[0]>ia/2-Ea?ra[0]-=ia:la&&0===T&&0>ra[0]&&Fa&&!K&&(ra[0]+=ia);!ra||isNaN(ra[0])||isNaN(ra[1])?(pa.push(za),pa.push(za),L.push(null),va++):(K&&(ra=K.inverseTransform(new n({x:ra[0],y:ra[1],spatialReference:Q})),ra=[ra.x,ra.y]),L.push(ra),0<T&&la&&ua[xa]&&ra[0]<ua[xa][0]&&(ra[0]+=ia,wa&&ra[0]>ya&&ra[0]>ia&&(ra[0]-=ia)),pa.push((ra[0]-Aa)/Ca),pa.push((Ba-ra[1])/Da))}ua=L}return{offsets:pa,error:null,coefficients:null,outofBoundPointCount:va,spacing:e,size:ma?[sa,ta]:[sa-1,ta-1]}}
function X(e,l,w){const {cols:I,rows:V}=l;l=new Float32Array((I-1)*(V-1)*12);const K=new Float32Array([-0,-1,1,-1,1,-0,1,-0,-0]),T=new Float32Array([-1,1,0,0,-1,1,1,0,0]);for(let ha=0;ha<I-1;ha++){for(var Q=0;Q<V-1;Q++){var L=ha*V*2+2*Q,ea=e[L];const ia=e[L+1];var ca=e[L+2],fa=e[L+3];L+=2*V;const la=e[L],oa=e[L+1],pa=e[L+2];L=e[L+3];let ma=0,sa=12*(Q*(I-1)+ha);for(let ta=0;3>ta;ta++)l[sa++]=K[ma++]*ea+K[ma++]*ca+K[ma++]*pa;ma=0;for(ca=0;3>ca;ca++)l[sa++]=K[ma++]*ia+K[ma++]*fa+K[ma++]*L;ma=0;for(fa=
0;3>fa;fa++)l[sa++]=T[ma++]*ea+T[ma++]*la+T[ma++]*pa;ma=0;for(ea=0;3>ea;ea++)l[sa++]=T[ma++]*ia+T[ma++]*oa+T[ma++]*L}if(w)for(Q=0;Q<l.length;Q++)isNaN(l[Q])&&(l[Q]=-1)}return l}function ba(e,l){e=e.clone().normalize();return 1===e.length?e[0]:v(e,l)}function aa(e,l){const {pixelSize:w,extent:I}=e;e=t(I,l,!1);const V=ba(I,(w.x+w.y)/16);return x(V,l,e)}var Z;(function(e){e[e.None=0]="None";e[e.North=1]="North";e[e.South=2]="South";e[e.Both=3]="Both"})(Z||={});const da=(e,l,w,I=0)=>{if(1===w[0])return[0,
0];var V=1,K=-1,T=1,Q=-1;for(var L=0;L<e.length;L+=2)isNaN(e[L])||(V=V>e[L]?e[L]:V,K=K>e[L]?K:e[L],T=T>e[L+1]?e[L+1]:T,Q=Q>e[L+1]?Q:e[L+1]);const {cols:ea,rows:ca}=l;l=(K-V)/ea/w[0];w=(Q-T)/ca/w[1];I*=2;T=0;Q=!1;V=[0,0];for(K=0;K<ea-3;K++){for(L=0;L<ca-3;L++){var fa=K*ca*2+2*L;const ha=Math.abs(((e[fa]+e[fa+4]+e[fa+4*ca]+e[fa+4*ca+4])/4-e[fa+2*ca+2])/l);fa=Math.abs(((e[fa+1]+e[fa+5]+e[fa+4*ca+1]+e[fa+4*ca+5])/4-e[fa+2*ca+3])/w);ha+fa>T&&(T=ha+fa,V=[ha,fa]);if(I&&T>I){Q=!0;break}}if(Q)break}return V},
ka={3395:2.0037508342789244E7,3410:1.7334193943686873E7,3857:2.0037508342788905E7,3975:1.7367530445161372E7,4087:2.0037508342789244E7,4088:2.0015108787169147E7,6933:1.7367530445161372E7,32662:2.0037508342789244E7,53001:2.001508679602057E7,53002:1.000754339801029E7,53003:2.001508679602057E7,53004:2.001508679602057E7,53016:1.4152803599503474E7,53017:1.7333573624304302E7,53034:2.001508679602057E7,53079:2.0015114352186374E7,53080:2.0015114352186374E7,54001:2.0037508342789244E7,54002:1.0018754171394624E7,
54003:2.0037508342789244E7,54004:2.0037508342789244E7,54016:1.4168658027268292E7,54017:1.736753044516137E7,54034:2.0037508342789244E7,54079:2.0037508342789244E7,54080:2.0037508342789244E7,54100:2.0037508342789244E7,54101:2.0037508342789244E7},ja=new Map,na=new Map;let qa=null;y.computeProjectedScales=function(e,l,w){var I=w?.tileSize??512,V=w?.alignGlobalDatasetWithAGOL??!0,K=!!w?.limitToSrcResolution;const {extent:T,spatialReference:Q,pixelSize:L}=e;w=B(L,l,T);if(null==w)return{projectedPixelSize:null,
scales:null,srcResolutions:null,isCustomTilingScheme:!1};const ea=(w.x+w.y)/2,ca=N.getMetersPerUnitForSR(l);var fa=ea*ca*96*39.37,ha=l.isGeographic?256/I*2.958287637958547E8:256/I*5.91657527591555E8,ia="vector-magdir"===e.dataType||"vector-uv"===e.dataType,la=aa(e,l),oa=Math.min(Math.ceil(Math.log(Math.min(e.width,e.height)/32)/Math.LN2),Math.ceil(Math.log(ha/2/fa)/Math.LN2));if(!ia&&V&&(l.isGeographic||l.isWebMercator)&&(V=E(l),ia=0<O(la)||null!=V&&la.width>V/4,!ia&&null!=V)){ia=-1;if(3>oa)ia=2**
oa*ea*I;else if(e.storageInfo){const {maximumPyramidLevel:pa=0,pyramidScalingFactor:ma=2}=e.storageInfo;ia=ma**pa*ea*I}I=Math.ceil(V/ia);ia=1===I||2===I&&V/2-la.xmax<ia}I=fa;la=Math.min(2,Math.max(1.414,e.storageInfo?.pyramidScalingFactor||2));if(ia)I=ha,ha=l.isGeographic?1.341104507446289E-6:.29858214164761665,oa=96*ha*ca*39.37,e=aa(e,new A({wkid:l.isGeographic?4326:3857})),e=B({x:ha,y:ha},Q,e),e.x*=I/oa,e.y*=I/oa;else{e={x:L.x,y:L.y};for(l=0;I<.5005*ha&&l<oa;)l++,I*=la,e.x*=la,e.y*=la;1.001>=Math.max(I,
ha)/Math.min(I,ha)&&(I=ha)}l=[I];ha=[{x:e.x,y:e.y}];for(fa=Math.min(70.5310735,fa)/1.001;I>=fa;)I/=la,e.x/=la,e.y/=la,l.push(I),ha.push({x:e.x,y:e.y});if(K){const pa=.001*L.x;K=ha.findIndex(ma=>ma.x>=L.x-pa&&ma.x<=L.x+pa);-1<K?(ha.length=K+1,l.length=K+1):(K=ha.findIndex(ma=>ma.x<=L.x+pa),0<K&&(ha.length=K,l.length=K))}return{projectedPixelSize:w,scales:l,srcResolutions:ha,isCustomTilingScheme:!ia}};y.defaultGridSpacing=32;y.defaultProjectionToleranceInPixels=4;y.getDefaultDatumTransformationForDataset=
t;y.getProjectedGridPoints=d;y.getProjectionOffsetGrid=function(e){var l=e.isAdaptive&&null==e.spacing;let w=e.spacing||[32,32],I=Y(e);var V={cols:I.size[0]+1,rows:I.size[1]+1};const K=0<I.outofBoundPointCount&&I.outofBoundPointCount<I.offsets.length/2;let T=I.outofBoundPointCount===I.offsets.length/2||l&&K?[0,0]:da(I.offsets,V,w,4);const Q=(T[0]+T[1])/2;var L=e.projectedExtent.spatialReference;const ea=e.srcBufferExtent.spatialReference;l&&(K||4<Q)&&(M(L,ea,e.datumTransformation)&&(L.isGeographic||
null!=f(L)),w=[4,4],I=Y({...e,spacing:w}),V={cols:I.size[0]+1,rows:I.size[1]+1},T=da(I.offsets,V,w,4));I.error=T;1<w[0]&&(I.coefficients=X(I.offsets,V,K));!e.includeGCSGrid||L.isGeographic||L.isWebMercator||(ea.isGeographic?I.gcsGrid={offsets:I.offsets,coefficients:I.coefficients,spacing:w}:(l=f(L),null==l||l.isEnvelope||(L&&!L.isGeographic&&(l=String(L.wkid||L.wkt2||L.wkt),na.has(l)?L=na.get(l):(L=(L.wkid?z.PeFactory.coordsys(L.wkid):z.PeFactory.fromString(z.PeDefs.PE_TYPE_PROJCS,L.wkt2||L.wkt)).getGeogcs().getCode(),
na.set(l,L)),L=new A({wkid:L})),L=x(e.projectedExtent,L),{offsets:e}=Y({...e,srcBufferExtent:L,spacing:w}),V=X(e,V,K),I.gcsGrid={offsets:e,coefficients:V,spacing:w})));return I};y.getRasterDatasetAlignmentInfo=function(e){const l=e.storageInfo.origin.x;var w=E(e.spatialReference,!0);if(null==w)return{originX:l,halfWorldWidth:null,pyramidsInfo:null};const I=w/2,{nativePixelSize:V,storageInfo:K,extent:T}=e,{maximumPyramidLevel:Q,blockWidth:L,pyramidScalingFactor:ea}=K;let ca=V.x;const fa=[];e=null!=
e.transform&&"gcs-shift"===e.transform.type;const ha=l+(e?0:I);w=e?w-l:I-l;for(let ia=0;ia<=Q;ia++){const la=(T.xmax-l)/ca/L,oa=w/ca/L;fa.push({resolutionX:ca,blockWidth:L,datasetColumnCount:0===la-Math.floor(la)?la:Math.ceil(la),worldColumnCountFromOrigin:0===oa-Math.floor(oa)?oa:Math.ceil(oa),leftMargin:Math.round(ha/ca)%L,rightPadding:(L-Math.round(w/ca)%L)%L,originColumnOffset:Math.floor(ha/ca/L)});ca*=ea}return{originX:l,halfWorldWidth:I,pyramidsInfo:fa,hasGCSSShiftTransform:e}};y.getWorldWidth=
E;y.getWorldWrapCount=O;y.load=async function(){qa&&u.isLoaded()||(u.isLoaded()||await u.load(),qa=await new Promise((e,l)=>p(["../../../geometry/geometryEngine"],e,l)))};y.minimumGridSpacing=4;y.projectDatasetExtent=aa;y.projectDatasetResolution=B;y.projectExtent=x;y.projectPoint=a;y.projectPolygon=function(e,l,w){if("extent"===e.type){const {xmin:I,ymin:V,xmax:K,ymax:T,spatialReference:Q}=e;e=new J({rings:[[[I,T],[K,T],[K,V],[I,V],[I,T]]],spatialReference:Q})}if(e.spatialReference.equals(l))return e;
q(e.spatialReference,l,w);return u.project(e,l,w)};y.projectResolution=function(e,l,w,I=null){const V=e.spatialReference;if(!V||!l||V.equals(l))return e;q(V,l,I);w=w.center;w=new W({xmin:w.x-e.x/2,xmax:w.x+e.x/2,ymin:w.y-e.y/2,ymax:w.y+e.y/2,spatialReference:V});I=u.project(w,l,I);w=E(l);return null==I||null!=w&&I.width>=w?r(e,V,l):{x:I.width,y:I.height}};y.requirePE=M;y.shiftExtent=function(e){var {spatialReference:l}=e;l=S.getInfo(l);if(!l)return e;const [w,I]=l.valid;l=I-w;let V=0;e.xmin<w?V=Math.ceil((w-
e.xmin)/l):e.xmin>I&&(V=-Math.ceil((e.xmin-I)/l));return new W({spatialReference:e.spatialReference,xmin:e.xmin+V*l,ymin:e.ymin,xmax:e.xmax+V*l,ymax:e.ymax})};y.snapExtent=ba;y.snapPyramid=function(e,l,w){const {storageInfo:I,pixelSize:V}=l;var K=0;let T=!1;var {pyramidResolutions:Q}=I,L="mixed"===I.tileInfo.format?.toLowerCase()?Math.max(1,Math.min(3,I.tileInfo.dpi/96)):1;L=(e.x+e.y)/2/L;if(null!=Q&&Q.length){e=Q[Q.length-1];e=(e.x+e.y)/2;var ea=(V.x+V.y)/2;if(L<=ea)K=0;else if(L>=e)K=Q.length,T=
8<L/e;else{e=ea;for(let ca=1;ca<=Q.length;ca++){ea=(Q[ca-1].x+Q[ca-1].y)/2;if(L<=ea){L===ea?K=ca:"down"===w?(K=ca-1,T=8<L/e):K="up"===w?ca:L-e>ea-L||2<L/e?ca:ca-1;break}e=ea}}w=0===K?V:Q[K-1];T&&(Q=Math.min(w.x,w.y),L=N.getMetersPerUnitForSR(l.spatialReference),19567<Q*L&&(T=!1));return{pyramidLevel:K,pyramidResolution:new n({x:w.x,y:w.y,spatialReference:l.spatialReference}),excessiveReading:T}}K=Math.log(e.x/V.x)/Math.LN2;L=Math.log(e.y/V.y)/Math.LN2;Q=l.storageInfo.maximumPyramidLevel||0;K="down"===
w?Math.floor(Math.min(K,L)):"up"===w?Math.ceil(Math.max(K,L)):Math.round((K+L)/2);0>K?K=0:K>Q&&(T=K>Q+3,K=Q);w=2**K;l=new n({x:w*l.nativePixelSize.x,y:w*l.nativePixelSize.y,spatialReference:l.spatialReference});return{pyramidLevel:K,pyramidResolution:l,excessiveReading:T}};Object.defineProperty(y,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/rasterFunctions/vectorFieldUtils":function(){define(["exports","../../../core/jsonMap","../PixelBlock","./pixelUtils"],function(p,y,D,G){function F(c,
f){return t.get(c)/t.get(f)||1}function N(c,f="geographic"){const [h,k]=c;c=Math.sqrt(h*h+k*k);let m=Math.atan2(k,h)*r;m=(360+m)%360;"geographic"===f&&(m=(450-m)%360);return[c,m]}function z(c,f="geographic"){let h=c[1];"geographic"===f&&(h=(450-h)%360);h%=360;c=c[0];return[c*Math.cos(h/r),c*Math.sin(h/r)]}function u(c,f,h="geographic",k=1){if(!G.isValidPixelBlock(c))return c;const {pixels:m,width:v,height:x}=c;var C=v*x;const H=m[0],E=m[1],P=c.pixelType.startsWith("f")?c.pixelType:"f32",U=D.createEmptyBand(P,
C);C=D.createEmptyBand(P,C);let O=0;for(let Y=0;Y<x;Y++)for(let X=0;X<v;X++)"vector-uv"===f?([U[O],C[O]]=N([H[O],E[O]],h),U[O]*=k):([U[O],C[O]]=z([H[O],E[O]],h),U[O]*=k,C[O]*=k),O++;c=new D({pixelType:P,width:c.width,height:c.height,mask:c.mask,validPixelCount:c.validPixelCount,maskIsAlpha:c.maskIsAlpha,pixels:[U,C]});c.updateStatistics();return c}function S(c=0,f=0,h=Math.PI,k=!0){k&&(h=(2*Math.PI-h)%(2*Math.PI));k=k?-1:1;const m=-7*k,v=-2*k,x=-16*k,[C,H]=J(0,f+13*k,h,21.75),[E,P]=J(c-5.5,f+m,h,
21.75),[U,O]=J(c+5.5,f+m,h,21.75),[Y,X]=J(c-1.5,f+v,h,21.75),[ba,aa]=J(c+1.5,f+v,h,21.75),[Z,da]=J(c-1.5,f+x,h,21.75),[ka,ja]=J(c+1.5,f+x,h,21.75);return[C,H,E,P,Y,X,ba,aa,U,O,Z,da,ka,ja]}function W(c=0,f=Math.PI,h=!0){h&&(f=(2*Math.PI-f)%(2*Math.PI));var k=h?-1:1,m=5*k;const v=20*k,x=25*k;k*=2;const C=h?1:-1;h=5*C;let [H,E]=[0+h,0-v],[P,U]=[H+2*C,E],[O,Y]=[P-0*C,U+k],[X,ba]=[0-h,0-x],[aa,Z]=[X+0*C,ba-k],da=Math.ceil(c/5),ka=Math.floor(da/10);da-=8*ka;c=[];const ja=[];for(let T=0;T<da/2;T++,ka--){0>=
ka&&1===da%2&&T===(da-1)/2&&(X=0,aa=X+0*C,ba=(ba+E)/2,Z=ba-k);const [Q,L]=J(X,ba,f,45);if(0<ka){const [ea,ca]=J(P,ba,f,45),[fa,ha]=J(H,E,f,45);c.push(ea);c.push(ca);c.push(Q);c.push(L);c.push(fa);c.push(ha)}else{const [ea,ca]=J(P,U,f,45),[fa,ha]=J(O,Y,f,45),[ia,la]=J(aa,Z,f,45);ja.push(Q);ja.push(L);ja.push(ia);ja.push(la);ja.push(fa);ja.push(ha);ja.push(ea);ja.push(ca)}ba+=m;E+=m;U+=m;Y+=m;Z+=m}const [na,qa]=J(0+h,0+v,f,45);m=7*C;const [e,l]=J(0+m,0+v,f,45),[w,I]=J(0+h,0-x,f,45),[V,K]=J(0+m,0-x,
f,45);return{pennants:c,barbs:ja,shaft:[na,qa,e,l,w,I,V,K]}}function J(c,f,h,k=1){return[Math.sqrt(c*c+f*f)/k,(2*Math.PI+(2*Math.PI+Math.atan2(f,c))%(2*Math.PI)-h)%(2*Math.PI)]}function n(c,f,h,k){h=F(k||"knots",h);for(k=1;k<f.length;k++)if(k===f.length-1){if(c<f[k]*h)break}else if(c<=f[k]*h)break;return Math.min(k-1,f.length-2)}function A(c,f,h,k,m){let v=0;switch(f){case "beaufort_kn":v=n(c,a,"knots",h);break;case "beaufort_km":v=n(c,a,"kilometer-per-hour",h);break;case "beaufort_ft":v=n(c,a,"feet-per-second",
h);break;case "beaufort_m":v=n(c,a,"meter-per-second",h);break;case "classified_arrow":v=n(c,m??[],k,h);break;case "ocean_current_m":v=n(c,b,"meter-per-second",h);break;case "ocean_current_kn":v=n(c,d,"knots",h)}return v}function M(c,f){const {style:h,inputUnit:k,outputUnit:m,breakValues:v}=f,x=B.fromJSON(k),C=B.fromJSON(m);let H=0,E=0;const {width:P,height:U,mask:O}=c,Y=c.pixels[0];c=c.pixels[1];var X=null!=O?O.filter(Z=>0<Z).length:P*U;const ba=new Float32Array(42*X);X=new Uint32Array(15*X);f=f.invertDirection?
S(0,0,0,!1):R;for(let Z=0;Z<U;Z++)for(let da=0;da<P;da++){var aa=Z*P+da;if(!O||O[Z*P+da]){const ka=(c[aa]+360)%360/180*Math.PI,ja=A(Y[aa],h,x,C,v);for(let na=0;na<f.length;na+=2)ba[H++]=(da+.5)/P,ba[H++]=(Z+.5)/U,ba[H++]=f[na],ba[H++]=f[na+1]+ka,ba[H++]=ja,ba[H++]=Y[aa];aa=7*(H/42-1);X[E++]=aa;X[E++]=aa+1;X[E++]=aa+2;X[E++]=aa+0;X[E++]=aa+4;X[E++]=aa+3;X[E++]=aa+0;X[E++]=aa+2;X[E++]=aa+3;X[E++]=aa+2;X[E++]=aa+5;X[E++]=aa+3;X[E++]=aa+5;X[E++]=aa+6;X[E++]=aa+3}}return{vertexData:ba,indexData:X}}function q(c,
f){let h=0,k=0;const {width:m,height:v,mask:x}=c;c=c.pixels[0];const C=[],H=[];var E=B.fromJSON(f.inputUnit);E=F(E,"knots");f="wind_speed"===f.style?5:Number.MAX_VALUE;for(let U=0;U<v;U++)for(let O=0;O<m;O++){var P=c[U*m+O]*E;if((!x||x[U*m+O])&&P<f){for(let Y=0;4>Y;Y++)C[h++]=(O+.5)/m,C[h++]=(U+.5)/v,C[h++]=2>Y?-.5:.5,C[h++]=0===Y%2?-.5:.5,C[h++]=0,C[h++]=P;P=4*(h/24-1);H[k++]=P;H[k++]=P+1;H[k++]=P+2;H[k++]=P+1;H[k++]=P+2;H[k++]=P+3}}return{vertexData:new Float32Array(C),indexData:new Uint32Array(H)}}
const t=new Map;t.set("meter-per-second",1);t.set("kilometer-per-hour",.277778);t.set("knots",.514444);t.set("feet-per-second",.3048);t.set("mile-per-hour",.44704);const r=180/Math.PI,B=new y.JSONMap({esriMetersPerSecond:"meter-per-second",esriKilometersPerHour:"kilometer-per-hour",esriKnots:"knots",esriFeetPerSecond:"feet-per-second",esriMilesPerHour:"mile-per-hour"}),R=S(0,0,0),a=[0,1,3,6,10,16,21,27,33,40,47,55,63],b=[0,.5,1,1.5,2],d=[0,.25,.5,1,1.5,2,2.5,3,3.5,4],g=[];p.convertToLocalDirections=
function(c,f,h,k="geographic"){if(!G.isValidPixelBlock(c)||null==h)return c;c="vector-magdir"===f?c.clone():u(c,f);const m=c.pixels[1];for(let v=0;v<m.length;v++)m[v]="geographic"===k?(m[v]+h[v]+270)%360:(m[v]+360-h[v])%360;return"vector-magdir"===f?c:u(c,"vector-magdir")};p.convertVectorFieldData=u;p.convertVectorFieldUnit=function(c,f,h=1){if(1===h||!G.isValidPixelBlock(c))return c;c=c.clone();const {pixels:k,width:m,height:v}=c,x=k[0],C=k[1];let H=0;for(let E=0;E<v;E++)for(let P=0;P<m;P++)"vector-uv"===
f?(x[H]*=h,C[H]*=h):x[H]*=h,H++;c.updateStatistics();return c};p.createVFMesh=function(c,f){if("simple_scalar"===f.style)f=q(c,f);else if("wind_speed"===f.style){if(0===g.length)for(var h=0;30>h;h++)g.push(W(5*h,0,!f.invertDirection));f=B.fromJSON(f.inputUnit);f=F(f,"knots");const {width:x,height:C,mask:H}=c;h=c.pixels[0];c=c.pixels[1];const E=[],P=[];let U=0,O=0;for(let Y=0;Y<C;Y++)for(let X=0;X<x;X++){var k=Y*x+X,m=h[k]*f;if((!H||H[Y*x+X])&&5<=m){const ba=(c[k]+360)%360/180*Math.PI,{pennants:aa,
barbs:Z,shaft:da}=g[Math.min(Math.floor(m/5),29)];if(0===aa.length+Z.length)continue;k=E.length/6;const ka=(X+.5)/x,ja=(Y+.5)/C;for(var v=0;v<aa.length;v+=2)E[U++]=ka,E[U++]=ja,E[U++]=aa[v],E[U++]=aa[v+1]+ba,E[U++]=0,E[U++]=m;for(v=0;v<Z.length;v+=2)E[U++]=ka,E[U++]=ja,E[U++]=Z[v],E[U++]=Z[v+1]+ba,E[U++]=0,E[U++]=m;for(v=0;v<da.length;v+=2)E[U++]=ka,E[U++]=ja,E[U++]=da[v],E[U++]=da[v+1]+ba,E[U++]=0,E[U++]=m;for(m=0;m<aa.length/6;m++)P[O++]=k,P[O++]=k+1,P[O++]=k+2,k+=3;for(m=0;m<Z.length/8;m++)P[O++]=
k,P[O++]=k+1,P[O++]=k+2,P[O++]=k+1,P[O++]=k+2,P[O++]=k+3,k+=4;P[O++]=k+0;P[O++]=k+1;P[O++]=k+2;P[O++]=k+1;P[O++]=k+3;P[O++]=k+2;k+=4}}f={vertexData:new Float32Array(E),indexData:new Uint32Array(P)}}else f=M(c,f);return f};p.createVFMeshScalar=q;p.getUnitConversionFactor=F;p.sampleVectorField=function(c,f,h,k=[0,0],m=.5){const {width:v,height:x,mask:C}=c,[H,E]=c.pixels,[P,U]=k;c=Math.round((v-P)/h);k=Math.round((x-U)/h);var O=c*k;const Y=new Float32Array(O),X=new Float32Array(O);O=new Uint8Array(O);
f="vector-uv"===f;for(let aa=0;aa<k;aa++)for(let Z=0;Z<c;Z++){let da=0;const ka=aa*c+Z,ja=Math.max(0,aa*h+U),na=Math.max(0,Z*h+P),qa=Math.min(x,ja+h),e=Math.min(v,na+h);for(let l=ja;l<qa;l++)for(let w=na;w<e;w++){var ba=l*v+w;if(!C||C[ba]){da++;ba=f?[H[ba],E[ba]]:[H[ba],(360+E[ba])%360];const [I,V]=f?ba:z(ba);Y[ka]+=I;X[ka]+=V}}if(da>=(qa-ja)*(e-na)*(1-m)){O[ka]=1;const [l,w]=N([Y[ka]/da,X[ka]/da]);Y[ka]=l;X[ka]=w}else O[ka]=0,Y[ka]=0,X[ka]=0}h=new D({width:c,height:k,pixels:[Y,X],mask:O});h.updateStatistics();
return h};p.snapImageToSymbolTile=function(c,f,h,k,m){if(null==m||!m.spatialReference.equals(c.spatialReference))return{extent:c,width:Math.round(f/k),height:Math.round(h/k),resolution:c.width/f};const v=m.xmin;m=m.ymax;f=(c.xmax-c.xmin)/f*k;h=(c.ymax-c.ymin)/h*k;c.xmin=v+Math.floor((c.xmin-v)/f)*f;c.xmax=v+Math.ceil((c.xmax-v)/f)*f;c.ymin=m+Math.floor((c.ymin-m)/h)*h;c.ymax=m+Math.ceil((c.ymax-m)/h)*h;return{extent:c,width:Math.round(c.width/f),height:Math.round(c.height/h),resolution:(f+h)/2}};
p.unitKebabDict=B;p.uvComponentToVector=N;Object.defineProperty(p,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/imagery/RasterVFContainer":function(){define(["exports","./BrushVectorField","../webgl/enums","../webgl/WGLContainer"],function(p,y,D,G){class F extends G{constructor(){super(...arguments);this.symbolTypes=["triangle"]}prepareRenderPasses(N){const z=N.registerRenderPass({name:"imagery (vf)",brushes:[y],target:()=>this.children,drawPhase:D.WGLDrawPhase.MAP});return[...super.prepareRenderPasses(N),
z]}doRender(N){this.visible&&N.drawPhase===D.WGLDrawPhase.MAP&&this.symbolTypes.forEach(z=>{N.renderPass=z;super.doRender(N)})}}p.RasterVFContainer=F;Object.defineProperty(p,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/imagery/BrushVectorField":function(){define(["../webgl/brushes/WGLBrush","../../../webgl/enums"],function(p,y){const D=new Float32Array([.27058823529411763,.4588235294117647,.7098039215686275,1,.396078431372549,.5372549019607843,.7215686274509804,1,.5176470588235295,
.6196078431372549,.7294117647058823,1,.6352941176470588,.7058823529411765,.7411764705882353,1,.7529411764705882,.8,.7450980392156863,1,.8705882352941177,.8901960784313725,.7490196078431373,1,1,1,.7490196078431373,1,1,.8627450980392157,.6313725490196078,1,.9803921568627451,.7254901960784313,.5176470588235295,1,.9607843137254902,.596078431372549,.4117647058823529,1,.9294117647058824,.4588235294117647,.3176470588235294,1,.9098039215686274,.08235294117647059,.08235294117647059,1]),G=new Float32Array([0,
92/255,230/255,1]),F={beaufort_ft:D,beaufort_m:D,beaufort_km:D,beaufort_mi:D,beaufort_kn:new Float32Array([.1568627450980392,.5725490196078431,.7803921568627451,1,.34901960784313724,.6352941176470588,.7294117647058823,1,.5058823529411764,.7019607843137254,.6705882352941176,1,.6274509803921569,.7607843137254902,.6078431372549019,1,.7490196078431373,.8313725490196079,.5411764705882353,1,.8549019607843137,.9019607843137255,.4666666666666667,1,.9803921568627451,.9803921568627451,.39215686274509803,1,
.9882352941176471,.8352941176470589,.3254901960784314,1,.9882352941176471,.7019607843137254,.4,1,.9803921568627451,.5529411764705883,.20392156862745098,1,.9686274509803922,.43137254901960786,.16470588235294117,1,.9411764705882353,.2784313725490196,.11372549019607843,1]),classified_arrow:new Float32Array([.2196078431372549,.6588235294117647,0,1,.5450980392156862,1.2117647058823529,0,1,1,1,0,1,1,.5019607843137255,0,1,1,0,0,1]),ocean_current_m:new Float32Array([.3058823529411765,.10196078431372549,.6,
1,.7019607843137254,.10588235294117647,.10196078431372549,1,.792156862745098,.5019607843137255,.10196078431372549,1,.6941176470588235,.6941176470588235,.6941176470588235,1]),ocean_current_kn:new Float32Array([0,0,0,1,0,.1450980392156863,.39215686274509803,1,.3058823529411765,.10196078431372549,.6,1,.592156862745098,0,.39215686274509803,1,.7019607843137254,.10588235294117647,.10196078431372549,1,.6941176470588235,.3058823529411765,.10196078431372549,1,.792156862745098,.5019607843137255,.10196078431372549,
1,.6941176470588235,.7019607843137254,.20392156862745098,1,.6941176470588235,.6941176470588235,.6941176470588235,1]),simple_scalar:G,single_arrow:G,wind_speed:new Float32Array([0,0,0,1])},N=[0,20];class z extends p{constructor(){super(...arguments);this._desc={magdir:{vsPath:"raster/magdir",fsPath:"raster/magdir",attributes:new Map([["a_pos",0],["a_offset",1],["a_vv",2]])},scalar:{vsPath:"raster/scalar",fsPath:"raster/scalar",attributes:new Map([["a_pos",0],["a_offset",1],["a_vv",2]])}}}dispose(){}prepareState({context:u}){u.setBlendingEnabled(!0);
u.setBlendFunctionSeparate(y.BlendFactor.ONE,y.BlendFactor.ONE_MINUS_SRC_ALPHA,y.BlendFactor.ONE,y.BlendFactor.ONE_MINUS_SRC_ALPHA);u.setColorMask(!0,!0,!0,!0);u.setStencilWriteMask(0);u.setStencilTestEnabled(!0);u.setStencilOp(y.StencilOperation.KEEP,y.StencilOperation.KEEP,y.StencilOperation.REPLACE)}draw(u,S){if(null!=S.source&&0!==S.source.validPixelCount){var {context:W,timeline:J}=u;J.begin(this.name);W.setStencilFunction(y.CompareFunction.EQUAL,S.stencilRef,255);S.updateVectorFieldVAO(u);if("scalar"===
u.renderPass){var n=S.vaoData.scalar;n&&this._drawScalars(u,S,n.vao,n.elementCount)}else(n=S.vaoData.magdir)&&this._drawTriangles(u,S,n.vao,n.elementCount);J.end(this.name)}}_drawTriangles(u,S,W,J){const {context:n,painter:A,requestRender:M,allowDelayedRender:q}=u,{symbolizerParameters:t}=S;var r=t.dataRange?["dataRange"]:[];"geographic"===t.rotationType&&r.push("rotationGeographic");r=A.materialManager.getProgram(this._desc.magdir,r);if(q&&null!=M&&!r.compiled)M();else{n.useProgram(r);var {coordScale:B,
opacity:R,transforms:a}=S;r.setUniform2fv("u_coordScale",B);r.setUniform1f("u_opacity",R);r.setUniformMatrix3fv("u_dvsMat3",a.displayViewScreenMat3);var {style:b,dataRange:d,rotation:g,symbolPercentRange:c}=t;r.setUniform4fv("u_colors",F[b]);r.setUniform2fv("u_dataRange",d||N);r.setUniform1f("u_rotation",g);r.setUniform2fv("u_symbolPercentRange",c);u=this._getSymbolSize(u,S);r.setUniform2fv("u_symbolSize",u);n.bindVAO(W);n.drawElements(y.PrimitiveType.TRIANGLES,J,y.DataType.UNSIGNED_INT,0)}}_drawScalars(u,
S,W,J){const {context:n,painter:A,requestRender:M,allowDelayedRender:q}=u,{symbolizerParameters:t}=S;var r=[];"wind_speed"===t.style?r.push("innerCircle"):t.dataRange&&r.push("dataRange");"geographic"===t.rotationType&&r.push("rotationGeographic");r=A.materialManager.getProgram(this._desc.scalar,r);if(q&&null!=M&&!r.compiled)M();else{n.useProgram(r);var {coordScale:B,opacity:R,transforms:a}=S;r.setUniform2fv("u_coordScale",B);r.setUniform1f("u_opacity",R);r.setUniformMatrix3fv("u_dvsMat3",a.displayViewScreenMat3);
var {dataRange:b,symbolPercentRange:d}=t;r.setUniform2fv("u_dataRange",b||N);r.setUniform2fv("u_symbolPercentRange",d);u=this._getSymbolSize(u,S);r.setUniform2fv("u_symbolSize",u);n.bindVAO(W);n.drawElements(y.PrimitiveType.TRIANGLES,J,y.DataType.UNSIGNED_INT,0)}}_getSymbolSize(u,S){u=S.key?2**(u.displayLevel-S.key.level):S.resolution/u.state.resolution;const {symbolTileSize:W}=S.symbolizerParameters;return[W/(Math.round((S.width-S.offset[0])/W)*W)/u,W/(Math.round((S.height-S.offset[1])/W)*W)/u]}}
return z})},"esri/views/2d/layers/imagery/ImageryVFStrategy":function(){define("../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Logger ../../../../core/promiseUtils ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ../../../../geometry/Extent ../../engine/imagery/RasterVFDisplayObject".split(" "),function(p,y,D,G,F,N,z,u,S,W){y=class extends y{constructor(J){super(J);this._loading=
null;this.update=G.debounce((n,A)=>this._update(n,A).catch(M=>{G.isAbortError(M)||D.getLogger(this).error(M)}))}get updating(){return!!this._loading}redraw(J){if(this.container.children.length){var n=this.container.children[0];n.symbolizerParameters=J;n.invalidateVAO();this.container.symbolTypes="wind_speed"===J.style?["scalar","triangle"]:"simple_scalar"===J.style?["scalar"]:["triangle"];this.container.requestRender()}}async _update(J,n,A){if(J.stationary){var {extent:M,spatialReference:q}=J.state,
t=new S({xmin:M.xmin,ymin:M.ymin,xmax:M.xmax,ymax:M.ymax,spatialReference:q}),[r,B]=J.state.size;this._loading=this.fetchPixels(t,r,B,A);A=await this._loading;this._addToDisplay(A,n,J.state);this._loading=null}}_addToDisplay(J,n,A){if(null==J.pixelBlock)this.container.children.forEach(r=>r.destroy()),this.container.removeAllChildren();else{var {extent:M,pixelBlock:q}=J,t=new W.RasterVFDisplayObject(q);t.offset=[0,0];t.symbolizerParameters=n;t.rawPixelData=J;t.invalidateVAO();t.x=M.xmin;t.y=M.ymax;
t.pixelRatio=A.pixelRatio;t.rotation=A.rotation;t.resolution=A.resolution;t.width=q.width*n.symbolTileSize;t.height=q.height*n.symbolTileSize;this.container.children.forEach(r=>r.destroy());this.container.removeAllChildren();this.container.symbolTypes="wind_speed"===n.style?["scalar","triangle"]:"simple_scalar"===n.style?["scalar"]:["triangle"];this.container.addChild(t)}}};p.__decorate([F.property()],y.prototype,"fetchPixels",void 0);p.__decorate([F.property()],y.prototype,"container",void 0);p.__decorate([F.property()],
y.prototype,"_loading",void 0);p.__decorate([F.property()],y.prototype,"updating",null);return y=p.__decorate([u.subclass("esri.views.2d.layers.imagery.ImageryVFStrategy")],y)})},"esri/views/2d/engine/imagery/RasterVFDisplayObject":function(){define("exports ../../../../core/has ../../../../core/libs/gl-matrix-2/math/mat3 ../../../../core/libs/gl-matrix-2/factories/mat3f32 ../../../../core/libs/gl-matrix-2/factories/vec2f32 ../../../../layers/support/rasterFunctions/vectorFieldUtils ../DisplayObject ../webgl/Utils ../../../webgl/BufferObject ../../../webgl/enums ../../../webgl/VertexArrayObject".split(" "),
function(p,y,D,G,F,N,z,u,S,W,J){class n extends z.DisplayObject{constructor(A=null){super();this._symbolizerParameters=this._source=null;this._vaoInvalidated=!0;this.coordScale=[1,1];this.offset=this.key=this.height=null;this.stencilRef=0;this.resolution=null;this.pixelRatio=1;this.rotation=this.y=this.x=0;this.width=this.vaoData=this.rawPixelData=null;this.source=A}destroy(){null!=this.vaoData&&(this.vaoData.magdir?.vao.dispose(),this.vaoData.scalar?.vao.dispose(),this.vaoData=null)}get symbolizerParameters(){return this._symbolizerParameters}set symbolizerParameters(A){JSON.stringify(this._symbolizerParameters)!==
JSON.stringify(A)&&(this._symbolizerParameters=A,this.invalidateVAO())}get source(){return this._source}set source(A){this._source=A;this.invalidateVAO()}invalidateVAO(){this._vaoInvalidated||null==this.vaoData||(this.vaoData.magdir?.vao.dispose(),this.vaoData.scalar?.vao.dispose(),this.vaoData=null,this._vaoInvalidated=!0,this.requestRender())}updateVectorFieldVAO(A){if(this._vaoInvalidated){this._vaoInvalidated=!1;if(null!=this.source&&null==this.vaoData){var {style:M}=this.symbolizerParameters;
switch(M){case "beaufort_ft":case "beaufort_km":case "beaufort_kn":case "beaufort_m":case "beaufort_mi":case "classified_arrow":case "ocean_current_kn":case "ocean_current_m":case "single_arrow":M=N.createVFMesh(this.source,this.symbolizerParameters);this.vaoData={magdir:this._createVectorFieldVAO(A.context,M)};break;case "simple_scalar":M=N.createVFMeshScalar(this.source,this.symbolizerParameters);this.vaoData={scalar:this._createVectorFieldVAO(A.context,M)};break;case "wind_speed":M=N.createVFMesh(this.source,
this.symbolizerParameters);M=this._createVectorFieldVAO(A.context,M);const q=N.createVFMeshScalar(this.source,this.symbolizerParameters);A=this._createVectorFieldVAO(A.context,q);this.vaoData={magdir:M,scalar:A}}}this.ready();this.requestRender()}}_createTransforms(){return{displayViewScreenMat3:G.create()}}setTransform(A){const M=D.identity(this.transforms.displayViewScreenMat3),[q,t]=A.toScreenNoRotation([0,0],[this.x,this.y]);var r=this.resolution/this.pixelRatio/A.resolution;const B=r*this.width;
r*=this.height;const R=Math.PI*this.rotation/180;D.translate(M,M,F.fromValues(q,t));D.translate(M,M,F.fromValues(B/2,r/2));D.rotate(M,M,-R);D.translate(M,M,F.fromValues(-B/2,-r/2));D.scaleByVec2(M,M,F.fromValues(B,r));D.multiply(this.transforms.displayViewScreenMat3,A.displayViewMat3,M)}onAttach(){this.invalidateVAO()}onDetach(){this.invalidateVAO()}_createVectorFieldVAO(A,M){const {vertexData:q,indexData:t}=M;M=S.BufferObject.createVertex(A,W.Usage.STATIC_DRAW,new Float32Array(q));const r=S.BufferObject.createIndex(A,
W.Usage.STATIC_DRAW,new Uint32Array(t)),B=u.createProgramDescriptor("vector-field",{geometry:[{location:0,name:"a_pos",count:2,type:W.DataType.FLOAT,normalized:!1},{location:1,name:"a_offset",count:2,type:W.DataType.FLOAT,normalized:!1},{location:2,name:"a_vv",count:2,type:W.DataType.FLOAT,normalized:!1}]});return{vao:new J.VertexArrayObject(A,B.attributes,B.bufferLayouts,new Map([["geometry",M]]),r),elementCount:t.length}}}p.RasterVFDisplayObject=n;Object.defineProperty(p,Symbol.toStringTag,{value:"Module"})})},
"esri/views/layers/ImageryLayerView":function(){define("../../chunks/tslib.es6 ../../core/Error ../../core/promiseUtils ../../core/accessorSupport/decorators/property ../../core/has ../../core/Logger ../../core/RandomLCG ../../core/accessorSupport/decorators/subclass ../../geometry/Point ../../layers/support/timeSupport ../../rest/support/Query ./support/popupUtils".split(" "),function(p,y,D,G,F,N,z,u,S,W,J,n){return A=>{A=class extends A{constructor(){super(...arguments);this.view=null}get timeExtent(){return W.combineTimeExtent(this.layer,
this.view?.timeExtent,this._get("timeExtent"))}async fetchPopupFeaturesAtLocation(M,q){const {layer:t}=this;if(!M)throw new y("imagerylayerview:fetchPopupFeatures","Nothing to fetch without area",{layer:t});var {popupEnabled:r}=t;const B=n.getFetchPopupTemplate(t,q);if(!r||null==B)return[];const R=await B.getRequiredFields();D.throwIfAborted(q);r=new J;r.timeExtent=this.timeExtent;r.geometry=M;r.outFields=R;r.outSpatialReference=M.spatialReference;const {resolution:a,spatialReference:b}=this.view;
M="2d"===this.view.type?new S(a,a,b):new S(.5*a,.5*a,b);const {returnTopmostRaster:d,showNoDataRecords:g}=B.layerOptions||{returnTopmostRaster:!0,showNoDataRecords:!1};return t.queryVisibleRasters(r,{returnDomainValues:!0,returnTopmostRaster:d,pixelSize:M,showNoDataRecords:g,signal:q?.signal}).then(c=>c)}canResume(){return!super.canResume()||this.timeExtent?.isEmpty?!1:!0}};p.__decorate([G.property()],A.prototype,"layer",void 0);p.__decorate([G.property()],A.prototype,"suspended",void 0);p.__decorate([G.property({readOnly:!0})],
A.prototype,"timeExtent",null);p.__decorate([G.property()],A.prototype,"view",void 0);return A=p.__decorate([u.subclass("esri.views.layers.ImageryLayerView")],A)}})},"esri/layers/support/timeSupport":function(){define(["exports","../../support/timeUtils"],function(p,y){p.combineTimeExtent=function(D,G,F){if(null==D?.timeInfo)return null;const {datesInUnknownTimezone:N=!1,timeOffset:z,useViewTime:u}=D;D=D.timeExtent;N&&(D=y.toLocalTimeExtent(D));G=u?G&&D?G.intersection(D):G||D:D;if(!G||G.isEmpty||
G.isAllTime)return G;z&&(G=G.offset(-z.value,z.unit));N&&(G=y.toUTCTimeExtent(G));return G.equals(F)?F:G};Object.defineProperty(p,Symbol.toStringTag,{value:"Module"})})},"esri/support/timeUtils":function(){define("exports ../core/arrayUtils ../core/deprecate ../core/lang ../core/Logger ../core/timeUtils ../time/TimeExtent ../webmap/utils ../webscene/utils".split(" "),function(p,y,D,G,F,N,z,u,S){function W(q){return void 0!==q.timeInfo}async function J(q,t){return q.widgets?.timeSlider?.fullTimeExtent??
n(q.allLayers,t)}async function n(q,t){if(0===q.length)return z.allTime;await Promise.all(q.map(a=>a.load({signal:t})));var r=q.filter(W),B=q.filter(a=>!W(a)&&null!=a.visibilityTimeExtent);if(0===r.length&&0===B.length)return z.allTime;q=[];const R=[];for(const a of r)"feature"!==a?.type&&"map-image"!==a?.type||!a.timeInfo?.hasLiveData?R.push(a):q.push(a);r=a=>null==a||a.isAllTime;B=[...R.map(a=>{const b=a.timeInfo?.fullTimeExtent;({visibilityTimeExtent:a}=a);return b?.intersection(a)??a}),...B.map(a=>
a.visibilityTimeExtent)];if(B.some(r))return z.allTime;q=q.map(async a=>{const b=(await a.fetchRecomputedExtents({signal:t}))?.timeExtent??a.timeInfo?.fullTimeExtent;({visibilityTimeExtent:a}=a);return b?.intersection(a)??a});q=(await Promise.allSettled(q)).map(a=>"fulfilled"===a.status?a.value:null);if(q.some(r))return z.allTime;q=[...q,...B].filter(y.isSome);return 0===q.length?z.allTime:q.reduce((a,b)=>a.union(b))}function A(q,t){q=q.currentTimeExtent;if(!q)return null;const {start:r,end:B}=q;
q=r??B??null;switch(t){case "time-window":return new z({start:r,end:B});case "cumulative-from-start":return new z({start:null,end:q});case "cumulative-from-end":return new z({start:q,end:null});case "instant":return new z({start:q,end:q})}}async function M(q,t){if(!u.isWebMap(q)&&!S.isWebScene(q))return null;await q.load({signal:t});var r=q?.widgets?.timeSlider;if(!r)return null;q=await J(q,t);t=r.loop;var B=r.numThumbs??2;var R=r.currentTimeExtent;if(R){const {start:b,end:d}=R;B=null!=b&&null!=d&&
b.getTime()===d.getTime()?"instant":2===B?"time-window":null==b||0===b.getTime()?"cumulative-from-start":"cumulative-from-end"}else B=2===B?"time-window":"cumulative-from-start";R=r.stopDelay??2E3;{const {numStops:b,stopInterval:d,stops:g}=r;var a=g?{dates:G.clone(g)}:d?{interval:d.clone()}:{count:b??5}}r=A(r,B);return{fullTimeExtent:q,loop:t,mode:B,playRate:R,stops:a,timeExtent:r}}p.getTimeExtentFromLayers=n;p.getTimeSliderSettingsFromWebDocument=M;p.getTimeSliderSettingsFromWebMap=async function(q,
t){D.deprecatedFunction(F.getLogger("esri.support.timeUtils.getTimeSliderSettingsFromWebMap"),"`timeUtils.getTimeSliderSettingsFromWebMap` is deprecated in favor of 'timeUtils.getTimeSliderSettingsFromWebDocument'",{replacement:"timeUtils.getTimeSliderSettingsFromWebDocument",version:"4.30",see:"https://developers.arcgis.com/javascript/latest/api-reference/esri-support-timeUtils.html#getTimeSliderSettingsFromWebDocument",warnOnce:!0});return null!=q&&u.isWebMap(q)?await M(q,t):null};p.toLocalTimeExtent=
function(q){if(!q)return q;const {start:t,end:r}=q;return new z({start:null!=t?N.offsetDate(t,t.getTimezoneOffset(),"minutes"):t,end:null!=r?N.offsetDate(r,r.getTimezoneOffset(),"minutes"):r})};p.toUTCTimeExtent=function(q){if(!q)return q;const {start:t,end:r}=q;return new z({start:null!=t?N.offsetDate(t,-t.getTimezoneOffset(),"minutes"):t,end:null!=r?N.offsetDate(r,-r.getTimezoneOffset(),"minutes"):r})};Object.defineProperty(p,Symbol.toStringTag,{value:"Module"})})},"esri/webscene/utils":function(){define(["exports",
"../support/tagSymbols"],function(p,y){p.isWebScene=function(D){return null!=D&&"object"===typeof D&&y.WebSceneTag in D};Object.defineProperty(p,Symbol.toStringTag,{value:"Module"})})},"esri/support/tagSymbols":function(){define(["exports"],function(p){const y=Symbol("WebScene");p.WebSceneTag=y;Object.defineProperty(p,Symbol.toStringTag,{value:"Module"})})},"esri/views/layers/support/popupUtils":function(){define(["exports","../../../layers/support/fieldUtils"],function(p,y){function D(G,F){return G.popupTemplate?
G.popupTemplate:null!=F&&F.defaultPopupTemplateEnabled&&null!=G.defaultPopupTemplate?G.defaultPopupTemplate:null}p.getFetchPopupTemplate=D;p.getRequiredFields=async function(G,F=G.popupTemplate){if(null==F)return[];const N=await F.getRequiredFields(G.fieldsIndex);({lastEditInfoEnabled:F}=F);const {objectIdField:z,typeIdField:u,globalIdField:S,relationships:W}=G;if(N.includes("*"))return["*"];F=F?y.getFeatureEditFields(G):[];const J=y.fixFields(G.fieldsIndex,[...N,...F]);u&&J.push(u);J&&z&&G.fieldsIndex?.has(z)&&
!J.includes(z)&&J.push(z);J&&S&&G.fieldsIndex?.has(S)&&!J.includes(S)&&J.push(S);W&&W.forEach(n=>{({keyField:n}=n);J&&n&&G.fieldsIndex?.has(n)&&!J.includes(n)&&J.push(n)});return J};p.hasPopupTemplate=function(G,F){return null!=D(G,{defaultPopupTemplateEnabled:F})};Object.defineProperty(p,Symbol.toStringTag,{value:"Module"})})},"esri/views/layers/RefreshableLayerView":function(){define("../../chunks/tslib.es6 ../../core/Logger ../../core/promiseUtils ../../core/reactiveUtils ../../core/has ../../core/RandomLCG ../../core/Error ../../core/accessorSupport/decorators/subclass".split(" "),
function(p,y,D,G,F,N,z,u){return S=>{S=class extends S{initialize(){this.addHandles(G.on(()=>this.layer,"refresh",W=>{this.doRefresh(W.dataChanged).catch(J=>{D.isAbortError(J)||y.getLogger(this).error(J)})}),"RefreshableLayerView")}};return S=p.__decorate([u.subclass("esri.views.layers.RefreshableLayerView")],S)}})},"*noref":1}});
define("../../../chunks/tslib.es6 ../../../Graphic ../../../core/Collection ../../../core/handleUtils ../../../core/has ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ../../../support/GraphicsCollection ../engine/flow/FlowView2D ./LayerView2D ./graphics/GraphicsView2D ./graphics/HighlightGraphicContainer ./imagery/ImageryView2D ./imagery/VectorFieldView2D ../../layers/ImageryLayerView ../../layers/LayerView ../../layers/RefreshableLayerView".split(" "),function(p,
y,D,G,F,N,z,u,S,W,J,n,A,M,q,t,r,B,R,a){u=class extends B(a(A.LayerView2DMixin(R))){constructor(){super(...arguments);this._exportImageVersion=-1;this._highlightGraphics=new J.GraphicsCollection;this._highlightView=void 0;this.subview=this.layer=null}get pixelData(){const {subview:b}=this;return this.updating||!b?null:"getPixelData"in b?b.getPixelData():null}update(b){this.subview?.update(b)}attach(){this.layer.increaseRasterJobHandlerUsage();this._setSubView();this.view&&(this._highlightView=new M({view:this.view,
graphics:this._highlightGraphics,requestUpdateCallback:()=>this.requestUpdate(),container:new q(this.view.featuresTilingScheme)}),this.container.addChild(this._highlightView.container));this.addAttachHandles([N.watch(()=>this.layer.exportImageServiceParameters.version,b=>{b&&this._exportImageVersion!==b&&(this._exportImageVersion=b,this.requestUpdate())},N.sync),N.watch(()=>this.timeExtent,b=>{const {subview:d}=this;d&&(d.timeExtent=b,"redraw"in d?this.requestUpdate():d.redrawOrRefetch())},N.sync),
this.layer.on("redraw",()=>{const {subview:b}=this;b&&("redraw"in b?b.redraw():b.redrawOrRefetch())}),N.watch(()=>this.layer.renderer,()=>this._setSubView())])}detach(){this.layer.decreaseRasterJobHandlerUsage();this.container.removeAllChildren();this._detachSubview(this.subview);this.subview?.destroy();this.subview=null;this._highlightView?.destroy();this._exportImageVersion=-1}viewChange(){}moveEnd(){this.requestUpdate()}highlight(b,d){if(!((Array.isArray(b)?b[0]:D.isCollection(b)?b.at(0):b)instanceof
y))return G.makeHandle();let g=[];Array.isArray(b)||D.isCollection(b)?g=b.map(c=>c.clone()):b instanceof y&&(g=[b.clone()]);this._highlightGraphics.addMany(g);return G.makeHandle(()=>this._highlightGraphics.removeMany(g))}async doRefresh(){this.requestUpdate()}isUpdating(){const b=!this.subview||this.subview.updating||!!this._highlightView?.updating;F("esri-2d-log-updating")&&console.log(`Updating ImageryLayerView2D (${this.layer.id}): ${b}\n-> subview ${!this.subview||this.subview.updating}\n-> higlightView ${this._highlightView?.updating}\n`);
return b}_setSubView(){if(this.view){var b=this.layer.renderer?.type,d="imagery";"vector-field"===b?d="imageryVF":"flow"===b&&(d="flow");if(this.subview){({type:b}=this.subview);if(b===d){this._attachSubview(this.subview);"flow"===b?this.subview.redrawOrRefetch():"imagery"===b&&"lerc"===this.layer.format?this.subview.redraw():this.requestUpdate();return}this._detachSubview(this.subview);this.subview?.destroy()}this.subview="imagery"===d?new t({layer:this.layer,view:this.view,timeExtent:this.timeExtent}):
"imageryVF"===d?new r({layer:this.layer,view:this.view,timeExtent:this.timeExtent}):new n({layer:this.layer,layerView:this});this._attachSubview(this.subview);this.requestUpdate()}}_attachSubview(b){b&&!b.attached&&(b.attach(),b.attached=!0,this.container.addChildAt(b.container,0))}_detachSubview(b){b?.attached&&(this.container.removeChild(b.container),b.detach(),b.attached=!1)}};p.__decorate([z.property()],u.prototype,"pixelData",null);p.__decorate([z.property()],u.prototype,"subview",void 0);return u=
p.__decorate([W.subclass("esri.views.2d.layers.ImageryLayerView2D")],u)});