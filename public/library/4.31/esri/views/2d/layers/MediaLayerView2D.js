// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.31/esri/copyright.txt for details.
//>>built
require({cache:{"esri/layers/support/MediaElementView":function(){define("exports ../../chunks/tslib.es6 ../../core/Accessor ../../core/accessorSupport/decorators/property ../../core/has ../../core/Logger ../../core/RandomLCG ../../core/accessorSupport/decorators/subclass ../../geometry/Polygon ../../geometry/projection ../../geometry/support/aaBoundingRect ../../geometry/support/normalizeUtilsSync".split(" "),function(e,a,g,q,z,A,n,b,y,r,t,f){e.MediaElementView=class extends g{constructor(h){super(h)}get bounds(){const h=
this.coords;return null==h?.extent?null:t.fromExtent(h.extent)}get coords(){return r.projectOrLoad(this.element.georeference?.coords,this.spatialReference).geometry}get normalizedCoords(){return y.fromJSON(f.normalizeCentralMeridianSync(this.coords))}get normalizedBounds(){const h=null!=this.normalizedCoords?this.normalizedCoords.extent:null;return null!=h?t.fromExtent(h):null}};a.__decorate([q.property()],e.MediaElementView.prototype,"spatialReference",void 0);a.__decorate([q.property()],e.MediaElementView.prototype,
"element",void 0);a.__decorate([q.property()],e.MediaElementView.prototype,"bounds",null);a.__decorate([q.property()],e.MediaElementView.prototype,"coords",null);a.__decorate([q.property()],e.MediaElementView.prototype,"normalizedCoords",null);a.__decorate([q.property()],e.MediaElementView.prototype,"normalizedBounds",null);e.MediaElementView=a.__decorate([b.subclass("esri.layers.support.MediaElementView")],e.MediaElementView);Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/Overlay":function(){define("../../../../core/Error ../../../../core/events ../../../../core/Handles ../../../../core/Logger ../../../../core/maybe ../../../../core/perspectiveUtils ../../../../core/reactiveUtils ../../../../core/libs/gl-matrix-2/factories/mat3f64 ../../../../core/libs/gl-matrix-2/math/vec2 ../../../../core/libs/gl-matrix-2/factories/vec2f64 ../../../../symbols/cim/enums ../DisplayObject ./animatedFormats/utils ../../../webgl/enums ../../../webgl/Texture ../../../webgl/TextureDescriptor".split(" "),
function(e,a,g,q,z,A,n,b,y,r,t,f,h,w,E,C){function H(l){return l?{type:"CIMAnimatedSymbolProperties",...l,playAnimation:l.playing,repeatType:l.repeatType?K[l.repeatType]:void 0}:{type:"CIMAnimatedSymbolProperties"}}const I=[1,1],F=b.create(),K={none:t.AnimatedSymbolRepeatType.None,loop:t.AnimatedSymbolRepeatType.Loop,oscillate:t.AnimatedSymbolRepeatType.Oscillate};class B extends f.DisplayObject{constructor(l){super();this.elementView=l;this.isWrapAround=!1;this.wrapAroundShift=0;this.perspectiveTransform=
r.create();this._handles=new g;this._vertices=new Float32Array(8);this._indices=new Uint16Array([0,0,0,1,1,0,1,1,1,1,0,0,0,0,0,1,1,0,1,1]);this._handles.add([n.watch(()=>this.elementView.element.opacity,u=>this.opacity=u,n.initial),n.watch(()=>[this.elementView.coords],()=>{this.requestRender()},n.initial),n.watch(()=>["animationOptions"in this.elementView.element&&this.elementView.element.animationOptions],()=>{this._handles.remove("play");this.texture=z.disposeMaybe(this.texture);this.requestRender()},
n.initial),n.when(()=>this.elementView.element.loaded,()=>{const u=this.elementView.element;this.ready();"video"===u.type&&null!=u.content&&(this._handles.add([a.on(u.content,"play",()=>this.requestRender()),a.on(u.content,"loadeddata",()=>this.requestRender()),a.on(u.content,"loaded",()=>this.requestRender())]),"requestVideoFrameCallback"in u.content?u.content.requestVideoFrameCallback(()=>this.requestRender()):this._handles.add([a.on(u.content,"seeked",()=>this.requestRender())]),this.requestRender())},
n.initial)]);l.element.load().catch(u=>{q.getLogger("esri.views.2d.layers.MediaLayerView2D").error(new e("element-load-error","Element cannot be displayed",{element:l,error:u}))})}getMesh(l){throw Error("Method not implemented.");}destroy(){this._handles.destroy();this.texture=z.disposeMaybe(this.texture)}get textureSize(){return I}get dvsMat3(){return this.parent.dvsMat3}beforeRender(l){const {context:u}=l,d=this.elementView.element.content;if(null!=d){var m=d instanceof HTMLImageElement;const x=
d instanceof HTMLVideoElement;var k=m?d.naturalWidth:x?d.videoWidth:d.width;m=m?d.naturalHeight:x?d.videoHeight:d.height;this._updatePerspectiveTransform(k,m);if(this.texture)x&&(this.texture.setData(d),this.texture.generateMipmap(),"requestVideoFrameCallback"in d?d.requestVideoFrameCallback(()=>this.requestRender()):d.paused||this.requestRender());else{const D=new C.TextureDescriptor;D.wrapMode=w.TextureWrapMode.CLAMP_TO_EDGE;D.preMultiplyAlpha=!0;D.width=k;D.height=m;"getFrame"in d?(k=J=>{this.texture?
this.texture.setData(J):this.texture=new E.Texture(u,D,J);this.requestRender()},"animationOptions"in this.elementView.element&&this._handles.add(h.play(d,H(this.elementView.element.animationOptions),null,k),"play")):this.texture=new E.Texture(u,D,d);this.texture.generateMipmap();x&&("requestVideoFrameCallback"in d?d.requestVideoFrameCallback(()=>this.requestRender()):d.paused||this.requestRender())}}super.beforeRender(l)}_createTransforms(){return null}draw(l,u){this.isReady&&null!=this.texture?u.render(l,
{transform:{dvs:this.dvsMat3},config:{perspective:this.perspectiveTransform,texSize:I,wrapAroundShift:this.wrapAroundShift,isWrapAround:this.isWrapAround,opacity:this.opacity,texture:{texture:this.texture,unit:0}},position:this._vertices,tex:this._indices}):this.requestRender()}updateDrawCoords(l,u,d,m){const {coords:k,bounds:x}=this.elementView;if(null!=k&&null!=x){var [D,J,P,Q]=k.rings[0];d=this._vertices;var {x:M,y:R}=l;d.set([J[0]-M,J[1]-R,D[0]-M,D[1]-R,P[0]-M,P[1]-R,Q[0]-M,Q[1]-R]);l=u;if(m){const [V,
,W]=x,{worldWidth:U,xBounds:Z}=m,[X,Y]=Z;V<X&&W>X?l=U:W>Y&&V<Y&&(l=-U)}this.wrapAroundShift=l;this.isWrapAround=0!==l}}_updatePerspectiveTransform(l,u){const d=this._vertices;A.getProjectiveTransform(F,[0,0,l,0,0,u,l,u],[d[0],d[1],d[4],d[5],d[2],d[3],d[6],d[7]]);y.set(this.perspectiveTransform,F[6]/F[8]*l,F[7]/F[8]*u)}}return B})},"esri/core/perspectiveUtils":function(){define("exports ./libs/gl-matrix-2/math/mat3 ./libs/gl-matrix-2/factories/mat3f64 ./libs/gl-matrix-2/math/vec2 ../chunks/vec32 ./libs/gl-matrix-2/factories/vec3f64".split(" "),
function(e,a,g,q,z,A){function n(f,h,w,E,C,H,I,F,K){a.set(f,h,E,H,w,C,I,1,1,1);z.set(b,F,K,1);a.adjoint(y,f);const [B,l,u]=z.transformMat3(b,b,a.transpose(y,y));a.set(y,B,0,0,0,l,0,0,0,u);return a.multiply(f,y,f)}const b=A.create(),y=g.create(),r=g.create(),t=g.create();e.getProjectiveTransform=function(f,h,w){n(r,h[0],h[1],h[2],h[3],h[4],h[5],h[6],h[7]);n(t,w[0],w[1],w[2],w[3],w[4],w[5],w[6],w[7]);a.multiply(f,a.adjoint(r,r),t);0!==f[8]&&(f[0]/=f[8],f[1]/=f[8],f[2]/=f[8],f[3]/=f[8],f[4]/=f[8],f[5]/=
f[8],f[6]/=f[8],f[7]/=f[8],f[8]/=f[8]);return f};e.transformProjective=function(f,h,w){z.set(b,h[0],h[1],1);z.transformMat3(b,b,a.transpose(y,w));return 0===b[2]?q.set(f,b[0],b[1]):q.set(f,b[0]/b[2],b[1]/b[2])};Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/OverlayContainer":function(){define("../../../../core/libs/gl-matrix-2/math/common ../../../../core/libs/gl-matrix-2/math/mat3 ../../../../core/libs/gl-matrix-2/factories/mat3f32 ../../../../core/libs/gl-matrix-2/factories/vec2f32 ../../../../core/libs/gl-matrix-2/factories/vec3f32 ../../../../geometry/support/normalizeUtils ../../../../geometry/support/spatialReferenceUtils ../../viewpointUtils ./enums ./WGLContainer ./shaderGraph/techniques/overlay/OverlayTechnique".split(" "),
function(e,a,g,q,z,A,n,b,y,r,t){class f extends r{constructor(){super(...arguments);this._viewStateId=-1;this._dvsMat3=g.create();this._overlayTechnique=new t.OverlayTechnique}get dvsMat3(){return this._dvsMat3}beforeRender(h){this._updateMatrices(h);this._updateOverlays(h,this.children);for(const w of this.children)w.beforeRender(h)}doRender(h){if(h.drawPhase===y.WGLDrawPhase.MAP&&this.visible){super.doRender(h);var w=this._overlayTechnique;for(const E of this.children)E.draw(h,w)}}onDetach(){this._overlayTechnique.shutdown()}_updateMatrices(h){var {state:w}=
h;const {id:E,size:C,pixelRatio:H,resolution:I,rotation:F,viewpoint:K,displayMat3:B}=w;if(this._viewStateId!==E){h=e.toRadian(F);var l=H*C[0],u=H*C[1];this._localOrigin=K.targetGeometry.clone();var {x:d,y:m}=this._localOrigin;w=A.normalizeMapX(d,w.spatialReference);this._localOrigin.x=w;this._localOrigin.y=m;w=I*l;var k=I*u,x=a.identity(this._dvsMat3);a.multiply(x,x,B);a.translate(x,x,q.fromValues(l/2,u/2));a.scale(x,x,z.fromValues(l/w,-u/k,1));a.rotate(x,x,-h);this._viewStateId=E}}_updateOverlays(h,
w){({state:h}=h);const {rotation:E,spatialReference:C,worldScreenWidth:H,size:I,viewpoint:F}=h,K=this._localOrigin;let B=0;var l=n.getInfo(C);if(l&&C.isWrappable){var u=I[0];var d=I[1],m=e.toRadian(E);m=Math.round(u*Math.abs(Math.cos(m))+d*Math.abs(Math.sin(m)));const [x,D]=l.valid;l=b.getWorldWidth(C);const {x:J,y:P}=F.targetGeometry;u=[0,0];h.toScreen(u,[J,P]);d=[0,0];m=m>H?.5*H:.5*m;var k=Math.floor((J+.5*l)/l);const Q=x+k*l;k=D+k*l;const M=[u[0]+m,0];h.toMap(d,M);d[0]>k&&(B=l);M[0]=u[0]-m;h.toMap(d,
M);d[0]<Q&&(B=-l);u={worldWidth:l,xBounds:[x,D]}}for(const x of w)x.updateDrawCoords(K,B,C,u)}}return f})},"esri/views/2d/engine/webgl/shaderGraph/techniques/overlay/OverlayTechnique":function(){define("exports ../../../../../../../core/maybe ../../../meshing/Mesh ../../utils ../Technique ../TechniqueType ../shaders/OverlayShader ../../../../../../webgl/enums".split(" "),function(e,a,g,q,z,A,n,b){class y extends z.Technique{constructor(){super(...arguments);this.type=A.TechniqueType.Overlay;this._mesh=
null;this.shaders={overlay:new n.OverlayShader}}render(r,t){const {context:f,painter:h}=r;r=this._getMesh(r,t);h.setPipelineState(q.simplePipelineState);const {isWrapAround:w,wrapAroundShift:E}=t.config,C={...t.config,wrapAroundShift:0};t={shader:this.shaders.overlay,uniforms:{transform:t.transform,config:C},defines:null,optionalAttributes:null,useComputeBuffer:!1};h.setPipelineState({...q.simplePipelineState,stencil:{write:!1,test:{compare:b.CompareFunction.EQUAL,op:{fail:b.StencilOperation.KEEP,
zFail:b.StencilOperation.KEEP,zPass:b.StencilOperation.REPLACE},ref:0,mask:255}}});h.submitDrawMeshUntyped(f,t,r);w&&(C.wrapAroundShift=E,h.submitDrawMeshUntyped(f,t,r))}shutdown(){a.destroyMaybe(this._mesh)}_getMesh(r,t){({context:r}=r);if(this._mesh){r=this._mesh.vertexBuffers.get("positions");if(!r)throw Error("Buffer not found");r.setData(t.position)}else this._mesh=new g.Mesh(r,{vertex:{positions:t.position,uvs:t.tex},index:null!=t.index?{index:t.index}:void 0,groups:[{attributes:[{name:"pos",
count:2,type:b.DataType.FLOAT,location:0,vertex:"positions",stride:8,offset:0},{name:"tex",count:2,type:b.DataType.UNSIGNED_SHORT,location:1,vertex:"uvs",stride:4,offset:0}],index:null!=t.index?"index":void 0,primitive:b.PrimitiveType.TRIANGLE_STRIP}],parts:[{group:0,start:0,count:null!=t.index?t.index.length:t.position.length/2}]});return this._mesh}}e.OverlayTechnique=y;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/OverlayShader":function(){define(["exports",
"../../../../../../../chunks/tslib.es6","../../GraphShaderModule","../../graph/glsl"],function(e,a,g,q){class z extends g.VertexInput{}a.__decorate([g.location(0,q.Vec2)],z.prototype,"pos",void 0);a.__decorate([g.location(1,q.Vec2)],z.prototype,"uv",void 0);class A extends g.FragmentInput{}class n extends g.UniformGroup{}a.__decorate([g.uniform(q.Mat3)],n.prototype,"dvs",void 0);class b extends g.UniformGroup{}a.__decorate([g.uniform(q.Vec2)],b.prototype,"perspective",void 0);a.__decorate([g.uniform(q.Vec2)],
b.prototype,"texSize",void 0);a.__decorate([g.uniform(q.Float)],b.prototype,"wrapAroundShift",void 0);a.__decorate([g.uniform(q.Float)],b.prototype,"opacity",void 0);a.__decorate([g.uniform(q.Sampler2D)],b.prototype,"texture",void 0);class y extends g.GraphShaderModule{vertex(r){const t=r.uv.divide(this.config.texSize);var f=(new q.Float(1)).add(q.dot(t,this.config.perspective));r=new q.Vec3(r.pos.add(new q.Vec2(this.config.wrapAroundShift,0)),1);r=this.transform.dvs.multiply(r);f=new q.Vec4(r.xy.multiply(f),
0,f);return{uv:t,glPosition:f}}fragment(r){r=q.texture2D(this.config.texture,r.uv).multiply(this.config.opacity);const t=new g.FragmentOutput;t.glFragColor=r;return t}}a.__decorate([g.uniform(n)],y.prototype,"transform",void 0);a.__decorate([g.uniform(b)],y.prototype,"config",void 0);a.__decorate([a.__param(0,g.input(z))],y.prototype,"vertex",null);a.__decorate([a.__param(0,g.input(A))],y.prototype,"fragment",null);e.OverlayShader=y;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},
"esri/views/2d/layers/LayerView2D":function(){define("exports ../../../chunks/tslib.es6 ../../../core/Collection ../../../core/collectionUtils ../../../core/Error ../../../core/Logger ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ../../../linkChart/utils ../engine/Container ./support/util ../support/HighlightGroup ../support/highlightGroupUtils ../support/HighlightOptions ../../layers/support/ClipRect ../../layers/support/Geometry ../../layers/support/Path ../../support/layerViewUtils".split(" "),
function(e,a,g,q,z,A,n,b,y,r,t,f,h,w,E,C,H,I,F,K,B){const l=g.ofType({key:"type",base:null,typeMap:{rect:I,path:K,geometry:F}}),u=new (g.ofType(E.HighlightGroup));e.LayerView2DMixin=d=>{d=class extends d{constructor(){super(...arguments);this.attached=!1;this.clips=new l;this.highlights=null;this.lastUpdateId=-1;this.updateRequested=this.moving=!1;this._visibleAtCurrentScale=!0}initialize(){const m=this.view?.spatialReferenceLocked??!0;this.view?.spatialReference&&m&&!this.spatialReferenceSupported?
this.addResolvingPromise(Promise.reject(new z("layerview:spatial-reference-incompatible","The spatial reference of this layer does not meet the requirements of the view",{layer:this.layer}))):(this.container||(this.container=new h.Container),this.container.fadeTransitionEnabled=!0,this.container.visible=!1,this.container.endTransitions(),this.addHandles([n.watch(()=>this.suspended,k=>{this.container&&(this.container.visible=!k)},n.syncAndInitial),n.watch(()=>this.updateSuspended,k=>{this.view&&!k&&
this.updateRequested&&this.view.requestUpdate()},n.syncAndInitial),n.watch(()=>this.layer?.opacity??1,k=>{this.container&&(this.container.opacity=k)},n.syncAndInitial),n.watch(()=>this.layer&&"blendMode"in this.layer?this.layer.blendMode:"normal",k=>{this.container&&(this.container.blendMode=k)},n.syncAndInitial),n.watch(()=>this.layer&&"effect"in this.layer?this.layer.effect:null,k=>{this.container&&(this.container.effect=k)},n.syncAndInitial),n.watch(()=>this._mergedHighlights.items.map(k=>({name:k.name,
options:{fillColor:k.options.color,haloColor:k.options.haloColor,fillOpacity:k.options.fillOpacity,haloOpacity:k.options.haloOpacity,haloWidth:k.options.haloWidth,haloBlur:k.options.haloBlur}})),()=>{this.container.highlightGradient=w.createOrReuseHighlightGradient(this.container.highlightGradient,this._mergedHighlights.items)},n.syncAndInitial),n.watch(()=>this._mergedHighlights.items.map(k=>k.name),()=>{this._updateHighlights()}),n.on(()=>this.clips,"change",()=>{this.container&&(this.container.clips=
this.clips)},n.syncAndInitial),n.watch(()=>({scale:this.view?.scale,scaleRange:this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null}),({scale:k,scaleRange:x})=>{k=B.isInEffectiveScaleRange(x,k);k!==this._visibleAtCurrentScale&&(this._visibleAtCurrentScale=k)},n.syncAndInitial)],"constructor"),this.view?.whenLayerView?this.view.whenLayerView(this.layer).then(k=>{k===this&&this.processAttach()},()=>{}):this.when().then(()=>{this.processAttach()},()=>{}))}_updateHighlights(){}destroy(){this.processDetach();
this.updateRequested=!1}get highlightOptions(){return C.getDefaultHighlightOptions(this)}set highlightOptions(m){C.setDefaultHighlightOptions(this,m)}get _mergedHighlights(){if(!this.view)return u;if(!this.highlights)return this.view.highlights;const m=this.view.highlights.clone();for(const k of this.highlights){const x=m.find(D=>D.name===k.name);x&&(x.options=k.options)}return m}get scheduler(){return this.view.scheduler}get spatialReferenceSupported(){const m=this.view?.spatialReference;return null==
m||this.supportsSpatialReference(m)}get updating(){return this.spatialReferenceSupported&&(!this.attached||!this.suspended&&(this.updateRequested||this.isUpdating())||!!this._updatingHandles?.updating||this.container.transitioning)}get visibleAtCurrentScale(){return this._visibleAtCurrentScale}processAttach(){this.isResolved()&&!this.attached&&!this.destroyed&&this.spatialReferenceSupported&&(this.attach(),this.attached=!0,this.requestUpdate())}processDetach(){this.attached&&(this.attached=!1,this.removeHandles("attach"),
this.detach(),this.updateRequested=!1)}requestUpdate(){this.destroyed||this.updateRequested||(this.updateRequested=!0,this.updateSuspended||this.view.requestUpdate())}processUpdate(m){this.isFulfilled()&&!this.isResolved()?this.updateRequested=!1:(this._set("updateParameters",m),this.updateRequested&&!this.updateSuspended&&(this.updateRequested=!1,this.update(m)))}hitTest(m,k){return Promise.resolve(null)}supportsSpatialReference(m){return!0}canResume(){if(!this.spatialReferenceSupported)return!1;
switch(this.layer?.type){case "link-chart":case "knowledge-graph-sublayer":break;default:if(f.isLinkChartView(this.view)&&!this.view.inGeographicLayout)return!1}return super.canResume()?this.visibleAtCurrentScale:!1}getSuspendInfo(){const m=super.getSuspendInfo(),k=!this.spatialReferenceSupported;k&&(m.spatialReferenceNotSupported=k);return m}addAttachHandles(m){this.addHandles(m,"attach")}_getHighlightBits(m){m=new Set(m);let k=1,x=0;if(!this.view)return 0;const D=this._mergedHighlights;for(const {name:J}of D)m.delete(J)&&
(x=k),k<<=1;for(const J of m)A.getLogger(this).error("#highlights",`${J} was not found. Features in this group will not be highlighted.`);return x}};a.__decorate([b.property()],d.prototype,"attached",void 0);a.__decorate([b.property({type:l,set(m){m=q.referenceSetter(m,this._get("clips"),l);this._set("clips",m)}})],d.prototype,"clips",void 0);a.__decorate([b.property()],d.prototype,"container",void 0);a.__decorate([b.property({type:H})],d.prototype,"highlightOptions",null);a.__decorate([b.property({type:g.ofType(E.HighlightGroup)})],
d.prototype,"highlights",void 0);a.__decorate([b.property()],d.prototype,"_mergedHighlights",null);a.__decorate([b.property()],d.prototype,"moving",void 0);a.__decorate([b.property({readOnly:!0})],d.prototype,"spatialReferenceSupported",null);a.__decorate([b.property({readOnly:!0})],d.prototype,"updateParameters",void 0);a.__decorate([b.property()],d.prototype,"updateRequested",void 0);a.__decorate([b.property()],d.prototype,"updating",null);a.__decorate([b.property()],d.prototype,"view",void 0);
a.__decorate([b.property()],d.prototype,"_visibleAtCurrentScale",void 0);a.__decorate([b.property({readOnly:!0})],d.prototype,"visibleAtCurrentScale",null);return d=a.__decorate([t.subclass("esri.views.2d.layers.LayerView2D")],d)};Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/linkChart/utils":function(){define(["exports"],function(e){e.isLinkChartView=function(a){return null!=a&&"object"===typeof a&&"2d"===a.type&&"linkchart"===a.view2dType};Object.defineProperty(e,Symbol.toStringTag,
{value:"Module"})})},"esri/views/layers/support/ClipRect":function(){define("../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ./ClipArea".split(" "),function(e,a,g,q,z,A,n){var b;g=b=class extends n{constructor(y){super(y);this.type="rect";this.bottom=this.top=this.right=this.left=null}clone(){return new b({left:this.left,right:this.right,top:this.top,bottom:this.bottom})}commitVersionProperties(){this.commitProperty("left");
this.commitProperty("right");this.commitProperty("top");this.commitProperty("bottom")}};e.__decorate([a.property({type:[Number,String],json:{write:!0}})],g.prototype,"left",void 0);e.__decorate([a.property({type:[Number,String],json:{write:!0}})],g.prototype,"right",void 0);e.__decorate([a.property({type:[Number,String],json:{write:!0}})],g.prototype,"top",void 0);e.__decorate([a.property({type:[Number,String],json:{write:!0}})],g.prototype,"bottom",void 0);return g=b=e.__decorate([A.subclass("esri.views.layers.support.ClipRect")],
g)})},"esri/views/layers/support/ClipArea":function(){define("../../../chunks/tslib.es6 ../../../core/JSONSupport ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass".split(" "),function(e,a,g,q,z,A,n){a=class extends a.JSONSupport{get version(){this.commitVersionProperties();return(this._get("version")||0)+1}};e.__decorate([g.property({readOnly:!0})],a.prototype,"version",null);return a=
e.__decorate([n.subclass("esri.views.layers.support.ClipArea")],a)})},"esri/views/layers/support/Geometry":function(){define("../../../chunks/tslib.es6 ../../../geometry ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ../../../geometry/Geometry ../../../geometry/support/jsonUtils ./ClipArea ../../../geometry/Extent ../../../geometry/Polygon".split(" "),function(e,a,g,q,z,A,n,b,y,r,t,
f){var h;a={base:b,key:"type",typeMap:{extent:t,polygon:f}};r=h=class extends r{constructor(w){super(w);this.type="geometry";this.geometry=null}clone(){return new h({geometry:this.geometry?.clone()??null})}commitVersionProperties(){this.commitProperty("geometry")}};e.__decorate([g.property({types:a,json:{read:y.fromJSON,write:!0}})],r.prototype,"geometry",void 0);return r=h=e.__decorate([n.subclass("esri.views.layers.support.Geometry")],r)})},"esri/views/layers/support/Path":function(){define("../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ./ClipArea".split(" "),
function(e,a,g,q,z,A,n){g=class extends n{constructor(b){super(b);this.type="path";this.path=[]}commitVersionProperties(){this.commitProperty("path")}};e.__decorate([a.property({type:[[[Number]]],json:{write:!0}})],g.prototype,"path",void 0);return g=e.__decorate([A.subclass("esri.views.layers.support.Path")],g)})},"esri/views/layers/MediaLayerView":function(){define("../../chunks/tslib.es6 ../../core/accessorSupport/decorators/property ../../core/has ../../core/Logger ../../core/RandomLCG ../../core/accessorSupport/decorators/subclass ../3d/layers/support/MediaLayerInteractionOptions".split(" "),
function(e,a,g,q,z,A,n){return b=>{b=class extends b{constructor(...y){super(...y);this.layer=null;this.interactive=!1;this.interactionOptions=new n.MediaLayerInteractionOptions;this.selectedElement=null}};e.__decorate([a.property()],b.prototype,"layer",void 0);e.__decorate([a.property()],b.prototype,"interactive",void 0);e.__decorate([a.property()],b.prototype,"interactionOptions",void 0);e.__decorate([a.property()],b.prototype,"selectedElement",void 0);return b=e.__decorate([A.subclass("esri.views.layers.MediaLayerView")],
b)}})},"esri/views/3d/layers/support/MediaLayerInteractionOptions":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/Logger ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass".split(" "),function(e,a,g,q,z,A,n,b){e.MediaLayerInteractionOptions=class extends g{constructor(){super(...arguments);this.tool="transform"}};a.__decorate([q.property()],e.MediaLayerInteractionOptions.prototype,
"tool",void 0);e.MediaLayerInteractionOptions=a.__decorate([b.subclass("esri.views.3d.layers.support.MediaLayerInteractionOptions")],e.MediaLayerInteractionOptions);Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"*noref":1}});
define("require ../../../chunks/tslib.es6 ../../../geometry ../../../Graphic ../../../renderers/ClassBreaksRenderer ../../../renderers/DictionaryRenderer ../../../renderers/DotDensityRenderer ../../../renderers/HeatmapRenderer ../../../renderers/PieChartRenderer ../../../renderers/Renderer ../../../renderers/SimpleRenderer ../../../renderers/UniqueValueRenderer ../../../renderers/support/jsonUtils ../../../core/Logger ../../../symbols ../../../core/Collection ../../../core/Error ../../../core/has ../../../core/MapUtils ../../../core/promiseUtils ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ../../../geometry/support/aaBoundingRect ../../../geometry/support/contains ../../../geometry/support/intersectsBase ../../../layers/support/MediaElementView ../../../core/scheduling ../../../core/accessorSupport/tracking/Flags ../../../core/colorUtils ../../../config ../../../symbols/cim/defaultCIMValues ../../../symbols/cim/enums ../../../core/floatRGBA ../../../geometry/Extent ../../../geometry/Geometry ../../../geometry/Multipoint ../../../geometry/Point ../../../geometry/Polygon ../../../geometry/Polyline ../engine/webgl/definitions ../engine/webgl/animations/instructions ../../../symbols/Font ../../../core/ObjectPool ../../../geometry/support/Axis ../../../geometry/support/spatialReferenceUtils ../../../geometry/support/TileClipper ../../../symbols/cim/effects/EffectAddControlPoints ../../../symbols/cim/effects/EffectArrow ../../../symbols/cim/effects/EffectBuffer ../../../symbols/cim/effects/EffectControlMeasureLine ../../../symbols/cim/effects/EffectCut ../../../symbols/cim/effects/EffectDashes ../../../symbols/cim/effects/EffectDonut ../../../symbols/cim/effects/EffectJog ../../../symbols/cim/effects/EffectMove ../../../symbols/cim/effects/EffectOffset ../../../symbols/cim/effects/EffectReverse ../../../symbols/cim/effects/EffectRotate ../../../symbols/cim/effects/EffectScale ../../../symbols/cim/effects/EffectWave ../../../symbols/cim/placements/PlacementAlongLineSameSize ../../../symbols/cim/placements/PlacementAtExtremities ../../../symbols/cim/placements/PlacementAtRatioPositions ../../../symbols/cim/placements/PlacementInsidePolygon ../../../symbols/cim/placements/PlacementOnLine ../../../symbols/cim/placements/PlacementOnVertices ../../../symbols/cim/placements/PlacementPolygonCenter ../../../core/mathUtils ../../../core/libs/gl-matrix-2/factories/vec2f32 ../engine/webgl/alignmentUtils ../../../symbols/support/defaults ../../../symbols/cim/OverrideHelper ../../../layers/effects/EffectView ../../../core/Evented ../engine/transitions/FadeTransition ../engine/webgl/enums ../engine/webgl/brushes/BrushBitmap ../../../core/libs/gl-matrix-2/factories/vec4f32 ../../webgl/checkWebGLError ../../webgl/enums ../../webgl/FramebufferObject ../../webgl/GLObjectType ../../webgl/Texture ../engine/webgl/shaders/BackgroundPrograms ../engine/webgl/DefaultVertexAttributeLayouts ../engine/webgl/AFeatureTile ../engine/webgl/DisplayEntity ../engine/webgl/shaderGraph/techniques/featureTechniqueUtils ../engine/webgl/number ../engine/webgl/PooledUint32Array ../engine/webgl/shaders/TileInfoPrograms ../engine/vectorTiles/style/StyleDefinition ../engine/vectorTiles/enums ../engine/webgl/shaders/BitBlitPrograms ../../../request ../../../core/urlUtils ../../../core/pbf ../engine/webgl/shaders/StencilPrograms ../engine/webgl/shaderGraph/techniques/TechniqueType ../engine/webgl/shaderGraph/techniques/shaders/BlendShader ../engine/webgl/shaderGraph/techniques/shaders/OpacityShader ../engine/webgl/shaders/HighlightPrograms ../engine/webgl/meshing/SimpleMesh ../engine/webgl/Profiler ../engine/webgl/shaderGraph/techniques/TechniqueRegistry ../../../Color ../engine/webgl/shaderGraph/techniques/shaders/constants ../engine/webgl/shaderGraph/techniques/dotDensity/DotDensityMeshWriter ../engine/webgl/shaderGraph/techniques/fill/ComplexFillMeshWriter ../engine/webgl/shaderGraph/techniques/fill/ComplexOutlineFillMeshWriter ../engine/webgl/shaderGraph/techniques/fill/FillMeshWriter ../engine/webgl/shaderGraph/techniques/fill/OutlineFillMeshWriter ../engine/webgl/shaderGraph/techniques/fill/PatternFillMeshWriter ../engine/webgl/shaderGraph/techniques/fill/PatternOutlineFillMeshWriter ../engine/webgl/shaderGraph/techniques/heatmap/HeatmapMeshWriter ../../../geometry/support/aaBoundingBox ../engine/webgl/shaderGraph/techniques/text/TextMeshWriter ../engine/webgl/shaderGraph/techniques/line/LineMeshWriter ../engine/webgl/shaderGraph/techniques/line/TexturedLineMeshWriter ../engine/webgl/shaderGraph/techniques/markers/MarkerMeshWriter ../engine/webgl/shaderGraph/techniques/pieChart/PieChartMeshWriter ../../webgl/renderState ../../3d/webgl-engine/core/shaderModules/interfaces ../../webgl/testSVGPremultipliedAlpha ../LabelManager ./graphics/GraphicsView2D ../../../chunks/earcut ../../../core/libs/gl-matrix-2/factories/vec3f32 ../../../geometry/support/normalizeUtilsCommon ../../../geometry/SpatialReference ../../../geometry/support/Ellipsoid ../../../kernel ./support/util ../navigation/MapViewNavigation ../../../core/asyncUtils ../../../core/support/UpdatingHandles ../engine/webgl/shaderGraph/techniques/shaders/MagnifierShader ../../../core/unitUtils ../../../geometry/ellipsoidUtils ../../../chunks/pe ../../../geometry/projection/projectors ../engine/webgl/shaderGraph/techniques/shaders/GridShader ../../../geometry/support/geodesicConstants ../tiling/TileInfoView ../tiling/TileKey ../tiling/TileQueue ../tiling/TileStrategy ../engine/webgl/Overlay ../engine/webgl/OverlayContainer ./LayerView2D ../../layers/LayerView ../../layers/MediaLayerView ../../support/Scheduler".split(" "),function(e,
a,g,q,z,A,n,b,y,r,t,f,h,w,E,C,H,I,F,K,B,l,u,d,m,k,x,D,J,P,Q,M,R,V,W,U,Z,X,Y,ma,na,oa,pa,qa,ra,sa,ta,ua,va,wa,xa,ya,za,Aa,Ba,Ca,Da,Ea,Fa,Ga,Ha,Ia,Ja,Ka,La,Ma,Na,Oa,Pa,Qa,Ra,Sa,Ta,Ua,Va,Wa,Xa,Ya,Za,$a,ab,bb,cb,db,eb,fb,gb,hb,ib,jb,kb,lb,mb,nb,ob,pb,qb,rb,sb,tb,ub,vb,wb,xb,yb,zb,Ab,Bb,Cb,Db,Eb,Fb,Gb,Hb,Ib,Jb,Kb,Lb,Mb,Nb,Ob,Pb,Qb,Rb,Sb,Tb,Ub,Vb,Wb,Xb,Yb,Zb,$b,ac,bc,cc,dc,ec,fc,gc,hc,ic,jc,kc,lc,mc,nc,ca,da,ea,fa,ha,ia,ja,ka){function aa(c,p,v){c.getTileBounds(L,p.key,!0);S.xmin=L[0];S.ymin=L[1];S.xmax=
L[2];S.ymax=L[3];return x.extentIntersectsPolygon(S,v)}let T=class extends ha.LayerView2DMixin(ja(ia)){constructor(){super(...arguments);this._tileStrategy=this._fetchQueue=this._overlayContainer=null;this._elementReferences=new Map;this.layer=this._interaction=this._debugGraphicsView=null;this.elements=new C}initialize(){this.addHandles([B.watch(()=>[this.interactive,this.suspended],async()=>{if(this.interactive&&!this._interaction){const {MediaLayerInteraction:c}=await new Promise((p,v)=>e(["./support/MediaLayerInteraction"],
p,v));this._interaction=new c({view:this.view,layer:this.layer});this.selectedElement!==this._interaction.selectedElement&&(this._interaction.selectedElement=this.selectedElement);this.interactionOptions!==this._interaction.options&&(this._interaction.options=this.interactionOptions)}this._interaction&&(this._interaction.enabled=!this.suspended&&this.interactive)},B.syncAndInitial),B.watch(()=>this.interactionOptions,c=>{this._interaction&&(this._interaction.options=c)},B.syncAndInitial),B.watch(()=>
this.selectedElement,c=>{this._interaction&&(this._interaction.selectedElement=c)},B.syncAndInitial)])}attach(){this.addAttachHandles([B.on(()=>this.layer.effectiveSource,"refresh",()=>{this._tileStrategy.refresh(c=>this._updateTile(c));this.requestUpdate()}),B.on(()=>this.layer.effectiveSource,"change",({element:c})=>this._elementUpdateHandler(c))]);this._overlayContainer=new fa;this.container.addChild(this._overlayContainer);this._fetchQueue=new ca({tileInfoView:this.view.featuresTilingScheme,concurrency:10,
process:(c,p)=>this._queryElements(c,p),scheduler:this.scheduler,priority:ka.TaskPriority.MAPVIEW_FETCH_QUEUE});this._tileStrategy=new da({cachePolicy:"purge",resampling:!0,acquireTile:c=>this._acquireTile(c),releaseTile:c=>this._releaseTile(c),tileInfoView:this.view.featuresTilingScheme});this.requestUpdate()}detach(){this.elements.removeAll();this._tileStrategy.destroy();this._fetchQueue.destroy();this._overlayContainer.removeAllChildren();this.container.removeAllChildren();this._elementReferences.clear();
this._debugGraphicsView?.destroy()}supportsSpatialReference(c){return!0}viewChange(){this.requestUpdate()}moveEnd(){this.requestUpdate()}update(c){this._tileStrategy.update(c);this._debugGraphicsView?.update(c)}async hitTest(c,p){p=[];var v=c.normalize();v=[v.x,v.y];for(const {elementView:{normalizedCoords:G,element:O}}of this._elementReferences.values())null!=G&&k.ringsContainsCoords(G.rings,v)&&p.push({type:"media",element:O,layer:this.layer,mapPoint:c,sourcePoint:O.toSource(c)});return p.reverse()}canResume(){return null!=
this.layer.source&&super.canResume()}async doRefresh(){this._fetchQueue.reset();this._tileStrategy.refresh(c=>this._updateTile(c))}_acquireTile(c){c=new la(c.clone());this._updateTile(c);return c}_updateTile(c){this._updatingHandles.addPromise(this._fetchQueue.push(c.key).then(p=>{const [v,G]=c.setElements(p);this._referenceElements(c,v);this._dereferenceElements(c,G);this.requestUpdate()},p=>{K.isAbortError(p)||w.getLogger(this).error(p)}))}_releaseTile(c){this._fetchQueue.abort(c.key.id);c.elements&&
this._dereferenceElements(c,c.elements);this.requestUpdate()}async _queryElements(c,p){const v=this.layer.effectiveSource;if(null==v)return[];this.view.featuresTilingScheme.getTileBounds(L,c,!0);c=new U({xmin:L[0],ymin:L[1],xmax:L[2],ymax:L[3],spatialReference:this.view.spatialReference});return v.queryElements(c,p)}_referenceElements(c,p){if(null!=this.layer.source)for(const v of p)this._referenceElement(c,v)}_referenceElement(c,p){F.getOrCreateMapValue(this._elementReferences,p.uid,()=>{const v=
new D.MediaElementView({element:p,spatialReference:this.view.spatialReference}),G=new ea(v);this._overlayContainer.addChild(G);this.elements.add(p);this._updatingHandles.addPromise(p.load().catch(O=>{w.getLogger("esri.views.2d.layers.MediaLayerView2D").error(new H("element-load-error","Element cannot be displayed",{element:p,error:O}))}));return{debugGraphic:null,elementView:v,overlay:G,tiles:new Set}}).tiles.add(c)}_dereferenceElements(c,p){for(const v of p)this._dereferenceElement(c,v)}_dereferenceElement(c,
p){const v=this._elementReferences.get(p.uid);v.tiles.delete(c);v.tiles.size||(this._overlayContainer.removeChild(v.overlay),v.overlay.destroy(),v.elementView.destroy(),this._elementReferences.delete(p.uid),this.elements.remove(p),this._debugGraphicsView?.graphics.remove(v.debugGraphic))}_elementUpdateHandler(c){var p=this._elementReferences.get(c.uid);if(p){const O=p.elementView.normalizedCoords;if(null==O)this._overlayContainer.removeChild(p.overlay),p.overlay.destroy(),p.elementView.destroy(),
this._elementReferences.delete(c.uid),this.elements.remove(c),this._debugGraphicsView?.graphics.remove(p.debugGraphic);else{var v=[],G=[];for(const N of this._tileStrategy.tiles){const ba=aa(this.view.featuresTilingScheme,N,O);p.tiles.has(N)?ba||G.push(N):ba&&v.push(N)}for(const N of v)this._referenceElement(N,c);for(const N of G)this._dereferenceElement(N,c);p=this._elementReferences.get(c.uid);p?.debugGraphic&&(p.debugGraphic.geometry=p.elementView.normalizedCoords,this._debugGraphicsView.graphicUpdateHandler({graphic:p.debugGraphic,
property:"geometry"}))}}else if(p=(new D.MediaElementView({element:c,spatialReference:this.view.spatialReference})).normalizedCoords,null!=p)for(v of this._tileStrategy.tiles)aa(this.view.featuresTilingScheme,v,p)&&this._referenceElement(v,c)}};a.__decorate([l.property()],T.prototype,"layer",void 0);a.__decorate([l.property({readOnly:!0})],T.prototype,"elements",void 0);T=a.__decorate([d.subclass("esri.views.2d.layers.MediaLayerView2D")],T);const L=m.create(),S={xmin:0,ymin:0,xmax:0,ymax:0};class la{constructor(c){this.key=
c;this.elements=null;this.isReady=!1;this.visible=!0}setElements(c){const p=[],v=new Set(this.elements);this.elements=c;for(const G of c)v.has(G)?v.delete(G):p.push(G);this.isReady=!0;return[p,Array.from(v)]}destroy(){}}return T});