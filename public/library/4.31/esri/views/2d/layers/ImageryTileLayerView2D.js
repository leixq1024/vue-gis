// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.31/esri/copyright.txt for details.
//>>built
require({cache:{"esri/layers/support/rasterDatasets/multidimensionalUtils":function(){define(["exports","../../../core/arrayUtils","../DimensionalDefinition"],function(q,C,g){function l(h,m,u){const D=m.shift();0===u.length&&u.push({sliceId:-1,multidimensionalDefinition:[]});const I=u.length;for(let a=0;a<I;a++){const e=u.shift().multidimensionalDefinition;D.values?.forEach(c=>{u.push({sliceId:-1,multidimensionalDefinition:[...e,{variableName:h,dimensionName:D.name,values:[c]}]})})}m.length&&l(h,
m,u)}function v(h,m){return Array.isArray(h)?m[0]===m[1]?h[0]===m[0]||h[1]===m[0]:h[0]>=m[0]&&h[0]<=m[1]&&h[1]>=m[0]&&h[1]<=m[1]:h>=m[0]&&h<=m[1]}function x(h,m){return h[0]<=m[0]&&h[1]>=m[0]||h[0]<=m[1]&&h[1]>=m[1]||h[0]>=m[0]&&h[1]<=m[1]}function z(h){return 1===h.length?[h[0],h[0]]:[h[0],h[h.length-1]]}function A(h,m,u){if(!m?.subsetDefinitions?.length)return h;if(u){const {variables:I}=m;if(I.length&&!I.includes(u))return null;m=m.subsetDefinitions.find(a=>a.dimensionName===h.name&&a.variableName===
u);if(!m?.values?.length)return h;m=z(m.values)}else m=m.dimensions.find(({name:I})=>I===h.name)?.extent;const D=m;if(!D?.length)return h;m=h.values.filter(I=>v(I,D));return{...h,extent:[...D],values:m}}function y(h,m,u){if(!m?.subsetDefinitions?.length)return!1;const {variables:D}=m;if(D.length&&h.some(({variableName:I})=>I&&!D.includes(I)))return!0;for(let I=0;I<h.length;I++){const a=h[I],e=m.subsetDefinitions.find(c=>(""===a.variableName||c.variableName===a.variableName)&&c.dimensionName===a.dimensionName);
if(e?.values.length){const c=z(e.values);if(!a.isSlice&&2===a.values.length&&!Array.isArray(a.values[0])&&a.values[0]!==a.values[1]&&u){if(!x(a.values,c))return!0}else if(a.values.some(r=>!v(r,c)))return!0}}return!1}function E(h,m){var u=h.dimensions.find(({name:e})=>"StdTime"===e);if(null==u||null==m.start&&null==m.end)return m;m=m.clone();const {start:D,end:I}=m.toJSON(),a=D===I?[D]:null!=D&&null!=I?[D,I]:[D??I];if(2===a.length&&u?.extent.length&&(a[0]=Math.max(a[0],u.extent[0]),a[1]=Math.min(a[1],
u.extent[1]??u.extent[0]),a[1]<a[0]))return null;u=new g({variableName:"",dimensionName:"StdTime",isSlice:1===a.length,values:a});if(y([u],h,!0))return null;m.start=new Date(a[0]);m.end=new Date(a[1]??a[0]);return m}function n(h,m={}){const {multidimensionalInfo:u,keyProperties:D}=h;if(null==u)return null;const {variableName:I,multidimensionalSubset:a,multidimensionalDefinition:e}=m;h=null!=e?e[0]?.variableName:null;const c=I||h||D?.DefaultVariable;({variables:h}=u);a?.variables?.length&&(h=h.filter(({name:r})=>
a.variables.includes(r)));return c?h.find(({name:r})=>r===c)??h[0]:h[0]}function b(h,m){var {values:u}=m;if(u?.length){m=Array.isArray(u[0]);var D=Array.isArray(h);return m!==D?-1:m&&D?u.findIndex(a=>a[0]===h[0]&&a[1]===h[1]):u.indexOf(h)}({extent:D}=m);if(Array.isArray(h)||!D||h<D[0]||h>D[1])return-1;u=m.interval||1;if("ISO8601"!==m.unit)return Math.round((h-D[0])/u);D=D[0];let I=-1;switch(m.intervalUnit?.toLowerCase()||"days"){case "seconds":I=Math.round((h-D)/1E3/u);break;case "minutes":I=Math.round((h-
D)/6E4/u);break;case "hours":I=Math.round((h-D)/36E5/u);break;case "days":I=Math.round((h-D)/864E5/u);break;case "months":m=(new Date(h)).getUTCFullYear()-(new Date(D)).getUTCFullYear();u=(new Date(D)).getUTCMonth();D=(new Date(h)).getUTCMonth();I=0===m?D-u:D+11-u+12*(m-1);break;case "years":I=Math.round(((new Date(h)).getUTCFullYear()-(new Date(D)).getUTCFullYear())/u);break;case "decades":I=Math.round(((new Date(h)).getUTCFullYear()-(new Date(D)).getUTCFullYear())/10/u)}return I}function t(h){var m=
h.values?.length;if(m)return m;const {extent:u,unit:D}=h;m=h.interval||1;var I=u?u[1]-u[0]:0;if("ISO8601"!==D)return Math.round(I/m);switch(h.intervalUnit?.toLowerCase()??"seconds"){case "seconds":m=Math.round(I/1E3/m);break;case "minutes":m=Math.round(I/6E4/m);break;case "hours":m=Math.round(I/36E5/m);break;case "days":m=Math.round(I/864E5/m);break;case "months":u?(h=(new Date(u[1])).getUTCFullYear()-(new Date(u[0])).getUTCFullYear(),m=(new Date(u[0])).getUTCMonth(),I=(new Date(u[1])).getUTCMonth(),
m=0===h?I-m+1:I+11-m+12*(h-1)+1):m=0;break;case "years":m=u?Math.round(((new Date(u[1])).getUTCFullYear()-(new Date(u[0])).getUTCFullYear())/m):0;break;case "decades":m=u?Math.round(((new Date(u[1])).getUTCFullYear()-(new Date(u[0])).getUTCFullYear())/10/m):0;break;default:m=0}return m}function H(h,m,u,D){const I=[];let a=h;for(h=new Date(h);a<=m;)switch(I.push(a),D){case "decades":h.setUTCFullYear(h.getUTCFullYear()+10*u);a=h.getTime();break;case "years":h.setUTCFullYear(h.getUTCFullYear()+u);a=
h.getTime();break;case "months":h.setUTCMonth(h.getUTCMonth()+u);a=h.getTime();break;case "days":a+=864E5*u;break;case "hours":a+=36E5*u;break;case "minutes":a+=6E4*u;break;case "seconds":a+=1E3*u}1===I.length?I[1]=m:I[I.length-1]=m;return I}q.createSlices=function(h,m){const u=[];let D=0;(m?h.variables.filter(I=>I.name.toLowerCase()===m.toLowerCase()):[...h.variables].sort((I,a)=>I.name>a.name?1:-1)).forEach(I=>{const a=[],e=[...I.dimensions].sort((c,r)=>c.name>r.name?-1:1);l(I.name,e,a);a.forEach(c=>
{u.push({...c,sliceId:D++})})});return u};q.getDefaultMultidimensionalDefinition=function(h,m={}){var u=n(h,m);if(!u)return null;h=[];const {dimensions:D,name:I}=u;if(0===D.length)return[new g({variableName:I,dimensionName:"",values:[],isSlice:!0})];for(u=0;u<D.length;u++){const a=A(D[u],m.multidimensionalSubset,I);if(!a)return null;const {values:e,extent:c}=a;let r=e?.[0]??c?.[0];"stdz"===a.name.toLowerCase()&&!a.hasRanges&&c&&Math.abs(c[1])<=Math.abs(c[0])&&(r=e?.length?e[e.length-1]:c[1]);h.push(new g({variableName:I,
dimensionName:a.name,values:[r],isSlice:m.useRangeForRangedDimensionInfo?!!a.hasRanges:!0}))}return h};q.getDefaultVariableInfo=n;q.getDimensionValues=function(h){if(2!==h.extent?.length||!h.interval)return[];const {extent:[m,u],interval:D}=h;if("ISO8601"===h.unit)return h=h.intervalUnit?.toLowerCase()??"days","decades years months days hours minutes seconds".split(" ").includes(h)?H(m,u,D,h):[];const I=Math.round((u-m)/D);return Array.from({length:I},(a,e)=>e===I-1?u:m+e*D)};q.getSliceIds=function(h,
m,u){let D=h;m&&(m=[...m].sort((I,a)=>I.dimensionName<a.dimensionName?-1:1),m.forEach(({dimensionName:I,values:a,isSlice:e})=>{a.length&&(D=D.filter(c=>{c=c.multidimensionalDefinition.find(d=>d.dimensionName===I);if(null==c)return!1;const r=c.values[0];return"number"===typeof r?"number"===typeof a[0]?a.includes(r):a.some(d=>d[0]<=r&&d[1]>=r):"number"===typeof a[0]?a.some(d=>r[0]<=d&&r[1]>=d):e?a.some(d=>d[0]===r[0]&&d[0]===r[1]):a.some(d=>d[0]>=r[0]&&d[0]<=r[1]||d[1]>=r[0]&&d[1]<=r[1]||d[0]<r[0]&&
d[1]>r[1])}))}));if(D.length&&null!=u?.start&&null!=u.end){const I=u.start.getTime(),a=u.end.getTime(),e=D[0].multidimensionalDefinition.findIndex(c=>"StdTime"===c.dimensionName);-1<e&&(D=D.filter(c=>{c=c.multidimensionalDefinition[e].values[0];return I<=c&&a>=c}))}return D.map(I=>I.sliceId)};q.getSliceIndex=function(h,m){let u=0;var D=h[0].variableName;m=[...m.variables].sort((a,e)=>a.name>e.name?1:-1);for(var I=0;I<m.length;I++){const a=m[I],e=[...a.dimensions].sort((c,r)=>c.name>r.name?-1:1);if(a.name!==
D)u+=e.map(c=>t(c)).reduce((c,r)=>c*r);else{D=e.map(c=>t(c));m=e.length;for(let c=0;c<m;c++){I=h.find(r=>r.dimensionName===e[c].name);if(null==I)return null;I=b(I.values[0],e[c]);if(-1===I)return null;D.shift();u=c===m-1?u+I:u+I*D.reduce((r,d)=>r*d)}break}}return u};q.getSubsetVariablesFromMdInfo=function(h,m){if(null==m||null==h)return null;m=m.variables.map(u=>({...u}));h?.variables?.length&&(m=m.filter(({name:u})=>h.variables.includes(u)),m.forEach(u=>{u.dimensions=u.dimensions.map(D=>A(D,h,u.name)).filter(C.isSome)}));
return m};q.getTimeDimensionValues=H;q.hasExcludedVariableOrDimension=y;q.intersectMultimensionalSubset=function(h,m){if(null==h)return{isOutside:!1};const {geometry:u,timeExtent:D,multidimensionalDefinition:I}=m;m=null;if(null!=D&&(m=E(h,D),null==m))return{isOutside:!0};const {areaOfInterest:a}=h;if(a&&u){const e="point"===u.type?u:"extent"===u.type?u.center:"polygon"===u.type?u.centroid:null;if(e&&!a.contains(e))return{isOutside:!0}}return null!=I&&I.length&&y(I,h,!0)?{isOutside:!0}:{isOutside:!1,
intersection:{geometry:u,timeExtent:m,multidimensionalDefinition:I}}};q.isMultiSliceOrRangeDefinition=function(h){return h?.length?h.some(m=>{if(null==m.values)return!0;const u=m.values.length;return 0===u||1<u||!m.isSlice&&Array.isArray(m.values[0])}):!1};Object.defineProperty(q,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/DimensionalDefinition":function(){define("../../chunks/tslib.es6 ../../core/JSONSupport ../../core/lang ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass".split(" "),
function(q,C,g,l,v,x){var z;C=z=class extends C.JSONSupport{constructor(A){super(A);this.dimensionName=this.variableName=null;this.values=[];this.isSlice=!1}clone(){return new z({variableName:this.variableName,dimensionName:this.dimensionName,values:g.clone(this.values),isSlice:this.isSlice})}};q.__decorate([l.property({type:String,json:{write:!0}})],C.prototype,"variableName",void 0);q.__decorate([l.property({type:String,json:{write:!0}})],C.prototype,"dimensionName",void 0);q.__decorate([l.property({type:v.types.array(v.types.oneOf([v.types.native(Number),
v.types.array(v.types.native(Number))])),json:{write:!0}})],C.prototype,"values",void 0);q.__decorate([l.property({type:Boolean,json:{write:!0}})],C.prototype,"isSlice",void 0);return C=z=q.__decorate([x.subclass("esri.layers.support.DimensionalDefinition")],C)})},"esri/views/2d/engine/flow/FlowView2D":function(){define("../../../../chunks/tslib.es6 ../../../../Graphic ../../../../core/Accessor ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/Logger ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ./createFlowStyle ./dataUtils ./FlowContainer ./FlowStrategy".split(" "),
function(q,C,g,l,v,x,z,A,y,E,n,b,t){g=class extends g{constructor(){super(...arguments);this._loadImagery=(H,h,m,u,D)=>n.loadImagery(this.layer,H,h,m,u,D);this._createFlowMesh=(H,h,m,u)=>this.layer.createFlowMesh({meshType:H,flowData:m,simulationSettings:h},{signal:u});this.attached=!1;this.type="flow";this.timeExtent=null;this.redrawOrRefetch=async()=>{this._updateVisualization()}}get updating(){return!this.attached||this._strategy.updating}attach(){const {layer:H}=this,h=()=>{this._loadImagery=
(m,u,D,I,a)=>n.loadImagery(H,m,u,D,I,a);this._updateVisualization()};"multidimensionalDefinition"in H?this.addHandles(l.watch(()=>H.multidimensionalDefinition,h)):this.addHandles([l.watch(()=>H.mosaicRule,h),l.watch(()=>H.rasterFunction,h),l.watch(()=>H.definitionExpression,h)]);this.container=new b;this._strategy=new t({flowContainer:this.container});this._updateVisualization()}detach(){this._strategy.destroy();this.container?.removeAllChildren();this.container=null;this.removeHandles()}update(H){H.stationary?
this._strategy.update(H):this.layerView.requestUpdate()}hitTest(H){return new C({attributes:{},geometry:H.clone(),layer:this.layer})}moveEnd(){}async doRefresh(){}_updateVisualization(){var H=this.layer.renderer;null!=H&&"flow"===H.type&&(H=E(H,{loadImagery:this._loadImagery,createFlowMesh:this._createFlowMesh,timeExtent:this.timeExtent}),this.container.flowStyle=H,this.layerView.requestUpdate())}};q.__decorate([v.property()],g.prototype,"_strategy",void 0);q.__decorate([v.property()],g.prototype,
"attached",void 0);q.__decorate([v.property()],g.prototype,"container",void 0);q.__decorate([v.property()],g.prototype,"layer",void 0);q.__decorate([v.property()],g.prototype,"layerView",void 0);q.__decorate([v.property()],g.prototype,"type",void 0);q.__decorate([v.property()],g.prototype,"updating",null);q.__decorate([v.property()],g.prototype,"timeExtent",void 0);return g=q.__decorate([y.subclass("esri.views.2d.engine.flow.FlowView2D")],g)})},"esri/views/2d/engine/flow/createFlowStyle":function(){define(["./utils",
"./styles/Imagery","./styles/Particles","./styles/Stack","./styles/Streamlines"],function(q,C,g,l,v){return function(x,z){const {flowSpeed:A,trailLength:y}=x,E=q.getFlowSimulationSettings(x);let n=null;const b={opacity:q.getOpacity(x),size:q.getSize(x)};let t=q.getColor(x);"none"===x.background?b.color=t:("constant"===t.kind&&(t={kind:"ramp",stops:[0,1],values:[0,0,0,1,t.value[0],t.value[1],t.value[2],t.value[3]],count:2}),n=new C.Imagery({loadImagery:z.loadImagery,timeExtent:z.timeExtent,color:t,
opacity:{kind:"constant",value:[1]}}),b.color=q.getForegroundColor());z={loadImagery:z.loadImagery,createFlowMesh:z.createFlowMesh,simulationSettings:E,timeExtent:z.timeExtent,trailLength:y,flowSpeed:A,featheringSize:1,featheringOffset:.5,introFade:!0,fadeToZero:!0,decayRate:2.3,color:b.color,opacity:b.opacity,size:b.size};x="butt"===x.trailCap||4>=q.getMax(q.getSize(x))?new v(z):new g.Particles(z);return null!=n?new l.Stack([n,x]):x}})},"esri/views/2d/engine/flow/utils":function(){define(["exports",
"../../../../core/screenUtils"],function(q,C){function g(A){return"constant"===A.kind?A.value[0]:A.values[A.values.length-1]}function l(A){A=A.toRgba();return[A[0]/255,A[1]/255,A[2]/255,A[3]]}function v(A){if(!A.hasVisualVariables("size"))return{kind:"constant",value:[C.pt2px(A.trailWidth)]};const y=A.getVisualVariablesForType("size")[0];A=[];const E=[];if(y.stops){for(n of y.stops)A.push(n.value),E.push(C.pt2px(n.size));var n=y.stops.length}else A.push(y.minDataValue,y.maxDataValue),E.push(C.pt2px(y.minSize),
C.pt2px(y.maxSize)),n=2;return{kind:"ramp",stops:A,values:E,count:n}}function x(A,y,E,n){switch(y){case "int":A.setUniform1iv(E,n);break;case "float":A.setUniform1fv(E,n);break;case "vec2":A.setUniform2fv(E,n);break;case "vec3":A.setUniform3fv(E,n);break;case "vec4":A.setUniform4fv(E,n)}}function z(A,y){return A===y?!0:null!=A&&null!=y?A.equals(y):!1}q.areStreamlinesCompatible=function(A,y){var E=A.simulationSettings,n=y.simulationSettings;let b;b=(b=(b=(b=(b=(b=(b=(b=(b=(b=(b=E.collisions===n.collisions)&&
E.density===n.density)&&E.interpolate===n.interpolate)&&E.lineCollisionWidth===n.lineCollisionWidth)&&E.lineSpacing===n.lineSpacing)&&E.maxTurnAngle===n.maxTurnAngle)&&E.minSpeedThreshold===n.minSpeedThreshold)&&E.segmentLength===n.segmentLength)&&E.smoothing===n.smoothing)&&E.velocityScale===n.velocityScale)&&E.verticesPerLine===n.verticesPerLine;return b&&z(A.timeExtent,y.timeExtent)?E=(E=(E=(E=(E=A.loadImagery===y.loadImagery)&&A.createFlowMesh===y.createFlowMesh)&&A.color.kind===y.color.kind)&&
A.opacity.kind===y.opacity.kind)&&A.size.kind===y.size.kind:!1};q.getColor=function(A){if(!A.hasVisualVariables("color"))return{kind:"constant",value:l(A.color)};A=A.getVisualVariablesForType("color")[0];const y=[],E=[];for(const n of A.stops)y.push(n.value),Array.prototype.push.apply(E,l(n.color));return{kind:"ramp",stops:y,values:E,count:A.stops.length}};q.getFlowSimulationSettings=function(A){var y=v(A);y=g(y);const E=Math.max(y/2,5),n=Math.round(C.pt2px(A.maxPathLength)/E)+1,{density:b}=A;return{smoothing:C.pt2px(A.smoothing),
interpolate:!0,velocityScale:"flow-from"===A.flowRepresentation?1:-1,verticesPerLine:n,minSpeedThreshold:.001,segmentLength:E,maxTurnAngle:1,collisions:!0,lineCollisionWidth:y,lineSpacing:10,density:b}};q.getForegroundColor=function(A){return{kind:"constant",value:[.1,.1,.1,1]}};q.getMax=g;q.getOpacity=function(A){if(!A.hasVisualVariables("opacity"))return{kind:"constant",value:[1]};A=A.getVisualVariablesForType("opacity")[0];const y=[],E=[];for(const n of A.stops)y.push(n.value),E.push(n.opacity);
return{kind:"ramp",stops:y,values:E,count:A.stops.length}};q.getSize=v;q.setUniform=x;q.setUniforms=function(A,y,E,n){"constant"===n.kind?x(A,E,`u_${y}`,n.value):(x(A,"float",`u_${y}_stops`,n.stops),x(A,E,`u_${y}_values`,n.values),A.setUniform1i(`u_${y}_count`,n.count))};q.timeExtentsEqual=z;q.toRgba=l;Object.defineProperty(q,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/flow/styles/Imagery":function(){define("exports ../../../../../core/promiseUtils ../utils ../../../../webgl/BufferObject ../../../../webgl/enums ../../../../webgl/Texture ../../../../webgl/TextureDescriptor ../../../../webgl/VertexArrayObject ../../../../webgl/VertexElementDescriptor".split(" "),
function(q,C,g,l,v,x,z,A,y){class E{constructor(h){this._params=h;this.animated=!1}isCompatible(h){if(!(h instanceof E&&g.timeExtentsEqual(this._params.timeExtent,h._params.timeExtent)))return!1;let m;return m=(m=(m=this._params.loadImagery===h._params.loadImagery)&&this._params.color.kind===h._params.color.kind)&&this._params.opacity.kind===h._params.opacity.kind}async load(h,m){const {extent:u,size:D}=h;C.throwIfAborted(m);h=await this._params.loadImagery(u,D[0],D[1],this._params.timeExtent,m);
return new H(h,{color:this._params.color,opacity:this._params.opacity})}render(h,m,u){({context:h}=h);const {program:D}=u;h.setFaceCullingEnabled(!1);h.setBlendingEnabled(!0);h.setBlendFunction(v.BlendFactor.ONE,v.BlendFactor.ONE_MINUS_SRC_ALPHA);h.useProgram(D);D.setUniformMatrix3fv("u_dvsMat3",m.dvsMat3);h.bindTexture(u.texture,0);D.setUniform1i("u_texture",0);D.setUniform1f("u_Min",u.min);D.setUniform1f("u_Max",u.max);g.setUniforms(D,"color","vec4",this._params.color);g.setUniforms(D,"opacity",
"float",this._params.opacity);h.bindVAO(u.vertexArray);h.drawArrays(v.PrimitiveType.TRIANGLE_STRIP,0,4)}}const n=new Map;n.set("a_position",0);n.set("a_texcoord",1);const b=new Map([["geometry",[new y.VertexElementDescriptor("a_position",2,v.DataType.UNSIGNED_SHORT,0,8),new y.VertexElementDescriptor("a_texcoord",2,v.DataType.UNSIGNED_SHORT,4,8)]]]),t={vsPath:"raster/flow/imagery",fsPath:"raster/flow/imagery",attributes:n};class H{constructor(h,m){this._flowData=h;this._values=m}attach(h){var {context:m}=
h;const {width:u,height:D}=this._flowData;var I=l.BufferObject.createVertex(m,v.Usage.STATIC_DRAW,new Uint16Array([0,0,0,1,u,0,1,1,0,D,0,0,u,D,1,0]));I=new Map([["geometry",I]]);I=new A.VertexArrayObject(m,n,b,I);var a=[];"ramp"===this._values.color.kind&&a.push("vvColor");"ramp"===this._values.opacity.kind&&a.push("vvOpacity");h=h.painter.materialManager.getProgram(t,a);a=1E6;let e=-1E6;for(var c=0;c<D;c++)for(var r=0;r<u;r++)if(0!==this._flowData.mask[c*u+r]){var d=this._flowData.data[2*(c*u+r)],
p=this._flowData.data[2*(c*u+r)+1];d=Math.sqrt(d*d+p*p);a=Math.min(a,d);e=Math.max(e,d)}c=new Uint8Array(4*u*D);for(r=0;r<D;r++)for(d=0;d<u;d++)if(0!==this._flowData.mask[r*u+d]){p=this._flowData.data[2*(r*u+d)];const w=this._flowData.data[2*(r*u+d)+1];c[4*(r*u+d)]=(Math.sqrt(p*p+w*w)-a)/(e-a)*255;c[4*(r*u+d)+1]=0;c[4*(r*u+d)+2]=0;c[4*(r*u+d)+3]=255}else c[4*(r*u+d)]=0,c[4*(r*u+d)+1]=0,c[4*(r*u+d)+2]=0,c[4*(r*u+d)+3]=0;r=new z.TextureDescriptor;r.internalFormat=v.PixelFormat.RGBA;r.wrapMode=v.TextureWrapMode.CLAMP_TO_EDGE;
r.flipped=!0;r.width=u;r.height=D;m=new x.Texture(m,r,c);this.vertexArray=I;this.program=h;this.texture=m;this.min=a;this.max=e;this._flowData=null}detach(){this.vertexArray.dispose();this.texture.dispose()}get ready(){return this.program.compiled}}q.Imagery=E;q.ImageryResources=H;Object.defineProperty(q,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/flow/styles/Particles":function(){define("exports ../../../../../core/promiseUtils ../utils ../../../../webgl/BufferObject ../../../../webgl/enums ../../../../webgl/VertexArrayObject ../../../../webgl/VertexElementDescriptor".split(" "),
function(q,C,g,l,v,x,z){class A{constructor(t){this._params=t}get animated(){return 0<this._params.flowSpeed}isCompatible(t){return t instanceof A?g.areStreamlinesCompatible(this._params,t._params):!1}async load(t,H){const {extent:h,size:m}=t;C.throwIfAborted(H);t=await this._params.loadImagery(h,m[0],m[1],this._params.timeExtent,H);const {vertexData:u,indexData:D}=await this._params.createFlowMesh("Particles",this._params.simulationSettings,t,H);return new b(u,D,{color:this._params.color,opacity:this._params.opacity,
size:this._params.size})}render(t,H,h){({context:t}=t);const {program:m}=h;t.setFaceCullingEnabled(!1);t.setBlendingEnabled(!0);t.setBlendFunction(v.BlendFactor.ONE,v.BlendFactor.ONE_MINUS_SRC_ALPHA);t.useProgram(m);m.setUniform1f("u_time",H.time);m.setUniform1f("u_trailLength",this._params.trailLength);m.setUniform1f("u_flowSpeed",this._params.flowSpeed);m.setUniform1f("u_featheringSize",this._params.featheringSize);m.setUniform1f("u_featheringOffset",this._params.featheringOffset);m.setUniform1f("u_introFade",
this._params.introFade?1:0);m.setUniform1f("u_fadeToZero",this._params.fadeToZero?1:0);m.setUniform1f("u_decayRate",this._params.decayRate);m.setUniformMatrix3fv("u_dvsMat3",H.dvsMat3);m.setUniformMatrix3fv("u_displayViewMat3",H.displayViewMat3);g.setUniforms(m,"color","vec4",this._params.color);g.setUniforms(m,"opacity","float",this._params.opacity);g.setUniforms(m,"size","float",this._params.size);t.bindVAO(h.vertexArray);t.drawElements(v.PrimitiveType.TRIANGLES,h.indexCount,v.DataType.UNSIGNED_INT,
0)}}const y=new Map;y.set("a_xyts0",0);y.set("a_xyts1",1);y.set("a_typeIdDurationSeed",2);y.set("a_extrudeInfo",3);const E=new Map([["geometry",[new z.VertexElementDescriptor("a_xyts0",4,v.DataType.FLOAT,0,64),new z.VertexElementDescriptor("a_xyts1",4,v.DataType.FLOAT,16,64),new z.VertexElementDescriptor("a_typeIdDurationSeed",4,v.DataType.FLOAT,32,64),new z.VertexElementDescriptor("a_extrudeInfo",4,v.DataType.FLOAT,48,64)]]]),n={vsPath:"raster/flow/particles",fsPath:"raster/flow/particles",attributes:y};
class b{constructor(t,H,h){this._vertexData=t;this._indexData=H;this._values=h}attach(t){var {context:H}=t,h=l.BufferObject.createVertex(H,v.Usage.STATIC_DRAW,this._vertexData),m=l.BufferObject.createIndex(H,v.Usage.STATIC_DRAW,this._indexData);h=new Map([["geometry",h]]);H=new x.VertexArrayObject(H,y,E,h,m);m=[];"ramp"===this._values.color.kind&&m.push("vvColor");"ramp"===this._values.opacity.kind&&m.push("vvOpacity");"ramp"===this._values.size.kind&&m.push("vvSize");t=t.painter.materialManager.getProgram(n,
m);this.vertexArray=H;this.program=t;this.indexCount=this._indexData.length;this._indexData=this._vertexData=null}detach(){this.vertexArray.dispose()}get ready(){return this.program.compiled}}q.Particles=A;q.ParticlesResources=b;Object.defineProperty(q,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/flow/styles/Stack":function(){define(["exports"],function(q){class C{constructor(l){this._styles=l}get animated(){return this._styles.reduce((l,v)=>l||v.animated,!1)}isCompatible(l){if(!(l instanceof
C)||this._styles.length!==l._styles.length)return!1;const v=this._styles.length;for(let x=0;x<v;x++)if(!this._styles[x].isCompatible(l._styles[x]))return!1;return!0}async load(l,v){const x=await Promise.all(this._styles.map(z=>z.load(l,v)));return new g(x)}render(l,v,x){for(let z=0;z<this._styles.length;z++)this._styles[z].render(l,v,x.resources[z])}}class g{constructor(l){this.resources=l}attach(l){for(const v of this.resources)v.attach(l)}detach(){for(const l of this.resources)l.detach()}get ready(){return this.resources.reduce((l,
v)=>l&&v.ready,!0)}}q.Stack=C;q.StackResources=g;Object.defineProperty(q,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/flow/styles/Streamlines":function(){define("../../../../../core/promiseUtils ../utils ../../../../webgl/BufferObject ../../../../webgl/enums ../../../../webgl/VertexArrayObject ../../../../webgl/VertexElementDescriptor".split(" "),function(q,C,g,l,v,x){class z{constructor(b){this._params=b}get animated(){return 0<this._params.flowSpeed}isCompatible(b){return b instanceof
z?C.areStreamlinesCompatible(this._params,b._params):!1}async load(b,t){const {extent:H,size:h}=b;q.throwIfAborted(t);b=await this._params.loadImagery(H,h[0],h[1],this._params.timeExtent,t);const {vertexData:m,indexData:u}=await this._params.createFlowMesh("Streamlines",this._params.simulationSettings,b,t);return new n(m,u,{color:this._params.color,opacity:this._params.opacity,size:this._params.size})}render(b,t,H){({context:b}=b);const {program:h}=H;b.setFaceCullingEnabled(!1);b.setBlendingEnabled(!0);
b.setBlendFunction(l.BlendFactor.ONE,l.BlendFactor.ONE_MINUS_SRC_ALPHA);b.useProgram(h);h.setUniform1f("u_time",t.time);h.setUniform1f("u_trailLength",this._params.trailLength);h.setUniform1f("u_flowSpeed",this._params.flowSpeed);h.setUniform1f("u_featheringSize",this._params.featheringSize);h.setUniform1f("u_featheringOffset",this._params.featheringOffset);h.setUniform1f("u_introFade",this._params.introFade?1:0);h.setUniform1f("u_fadeToZero",this._params.fadeToZero?1:0);h.setUniform1f("u_decayRate",
this._params.decayRate);h.setUniformMatrix3fv("u_dvsMat3",t.dvsMat3);h.setUniformMatrix3fv("u_displayViewMat3",t.displayViewMat3);C.setUniforms(h,"color","vec4",this._params.color);C.setUniforms(h,"opacity","float",this._params.opacity);C.setUniforms(h,"size","float",this._params.size);b.bindVAO(H.vertexArray);b.drawElements(l.PrimitiveType.TRIANGLES,H.indexCount,l.DataType.UNSIGNED_INT,0)}}const A=new Map;A.set("a_positionAndSide",0);A.set("a_timeInfo",1);A.set("a_extrude",2);A.set("a_speed",3);
const y=new Map([["geometry",[new x.VertexElementDescriptor("a_positionAndSide",3,l.DataType.FLOAT,0,36),new x.VertexElementDescriptor("a_timeInfo",3,l.DataType.FLOAT,12,36),new x.VertexElementDescriptor("a_extrude",2,l.DataType.FLOAT,24,36),new x.VertexElementDescriptor("a_speed",1,l.DataType.FLOAT,32,36)]]]),E={vsPath:"raster/flow/streamlines",fsPath:"raster/flow/streamlines",attributes:A};class n{constructor(b,t,H){this._vertexData=b;this._indexData=t;this._values=H}attach(b){var {context:t}=b,
H=g.BufferObject.createVertex(t,l.Usage.STATIC_DRAW,this._vertexData),h=g.BufferObject.createIndex(t,l.Usage.STATIC_DRAW,this._indexData);H=new Map([["geometry",H]]);t=new v.VertexArrayObject(t,A,y,H,h);h=[];"ramp"===this._values.color.kind&&h.push("vvColor");"ramp"===this._values.opacity.kind&&h.push("vvOpacity");"ramp"===this._values.size.kind&&h.push("vvSize");b=b.painter.materialManager.getProgram(E,h);this.vertexArray=t;this.program=b;this.indexCount=this._indexData.length;this._indexData=this._vertexData=
null}detach(){this.vertexArray.dispose()}get ready(){return this.program.compiled}}return z})},"esri/views/2d/engine/flow/dataUtils":function(){define("exports ../../../../geometry ../../../../core/has ../../../../core/Logger ../../../../core/mathUtils ../../../../core/promiseUtils ../../../../core/RandomLCG ../../../../geometry/support/spatialReferenceUtils ../../../../geometry/Extent".split(" "),function(q,C,g,l,v,x,z,A,y){function E(a,e){const c=t(e.data,e.width,e.height,a.smoothing);return a.interpolate?
(r,d)=>{const p=Math.floor(r),w=Math.floor(d);if(0>p||p>=e.width||0>w||w>=e.height)return[0,0];r-=p;d-=w;const f=p<e.width-1?p+1:p,B=w<e.height-1?w+1:w;return[(c[2*(w*e.width+p)]*(1-d)+c[2*(B*e.width+p)]*d)*(1-r)+(c[2*(w*e.width+f)]*(1-d)+c[2*(B*e.width+f)]*d)*r,(c[2*(w*e.width+p)+1]*(1-d)+c[2*(B*e.width+p)+1]*d)*(1-r)+(c[2*(w*e.width+f)+1]*(1-d)+c[2*(B*e.width+f)+1]*d)*r]}:(r,d)=>{r=Math.round(r);d=Math.round(d);return 0>r||r>=e.width||0>d||d>=e.height?[0,0]:[c[2*(d*e.width+r)],c[2*(d*e.width+r)+
1]]}}function n(a,e,c,r,d,p,w,f,B){const F=[];let J=0,[K,L]=e(c,r);K*=a.velocityScale;L*=a.velocityScale;F.push({x:c,y:r,t:J,speed:Math.sqrt(K*K+L*L)});for(let T=0;T<a.verticesPerLine;T++){let [S,Y]=e(c,r);S*=a.velocityScale;Y*=a.velocityScale;const X=Math.sqrt(S*S+Y*Y);if(X<a.minSpeedThreshold)break;const ba=S/X,aa=Y/X;c+=ba*a.segmentLength;r+=aa*a.segmentLength;J+=a.segmentLength/X;if(Math.acos(ba*N+aa*R)>a.maxTurnAngle)break;if(a.collisions){var N=Math.round(c*B);var R=Math.round(r*B);if(0>N||
N>w-1||0>R||R>f-1)break;const Z=p[R*w+N];if(-1!==Z&&Z!==d)break;p[R*w+N]=d}F.push({x:c,y:r,t:J,speed:X});N=ba;R=aa}return F}function b(a,e,c,r){const d=[],p=new z,w=1/Math.max(a.lineCollisionWidth,1),f=Math.round(c*w),B=Math.round(r*w),F=new Int32Array(f*B);for(var J=0;J<F.length;J++)F[J]=-1;J=[];for(let K=0;K<r;K+=a.lineSpacing)for(let L=0;L<c;L+=a.lineSpacing)J.push({x:L,y:K,sort:p.getFloat()});J.sort((K,L)=>K.sort-L.sort);for(const {x:K,y:L}of J)p.getFloat()<a.density&&(c=n(a,e,K,L,d.length,F,
f,B,w),2>c.length||d.push(c));return d}function t(a,e,c,r){if(0===r)return a;const d=Math.round(3*r),p=Array(2*d+1);var w=0;for(var f=-d;f<=d;f++){var B=Math.exp(-f*f/(r*r));p[f+d]=B;w+=B}for(r=-d;r<=d;r++)p[r+d]/=w;w=new Float32Array(a.length);for(r=0;r<c;r++)for(f=0;f<e;f++){var F=B=0;for(var J=-d;J<=d;J++)if(!(0>f+J||f+J>=e)){var K=p[J+d];B+=K*a[2*(r*e+(f+J))];F+=K*a[2*(r*e+(f+J))+1]}w[2*(r*e+f)]=B;w[2*(r*e+f)+1]=F}a=new Float32Array(a.length);for(r=0;r<e;r++)for(f=0;f<c;f++){F=B=0;for(J=-d;J<=
d;J++)0>f+J||f+J>=c||(K=p[J+d],B+=K*w[2*((f+J)*e+r)],F+=K*w[2*((f+J)*e+r)+1]);a[2*(f*e+r)]=B;a[2*(f*e+r)+1]=F}return a}function H(a,e){const c=new z;var r=a.reduce((f,B)=>f+B.length,0);r=new Float32Array(4*r);const d=Array(a.length);let p=0,w=0;for(const f of a){a=p;for(const B of f)r[4*p]=B.x,r[4*p+1]=B.y,r[4*p+2]=B.t,r[4*p+3]=B.speed,p++;d[w++]={startVertex:a,numberOfVertices:f.length,totalTime:f[f.length-1].t,timeSeed:e?c.getFloat():0}}return{lineVertices:r,lineDescriptors:d}}function h(a,e){function c(N,
R,T,S,Y,X,ba,aa){const Z=9*B;let da=0;f[Z+da++]=N;f[Z+da++]=R;f[Z+da++]=1;f[Z+da++]=T;f[Z+da++]=X;f[Z+da++]=ba;f[Z+da++]=S/2;f[Z+da++]=Y/2;f[Z+da++]=aa;B++;f[Z+da++]=N;f[Z+da++]=R;f[Z+da++]=-1;f[Z+da++]=T;f[Z+da++]=X;f[Z+da++]=ba;f[Z+da++]=-S/2;f[Z+da++]=-Y/2;f[Z+da++]=aa;B++}const {lineVertices:r,lineDescriptors:d}=a;var p=a=0;for(var w of d)a+=2*w.numberOfVertices,p+=6*(w.numberOfVertices-1);const f=new Float32Array(9*a);w=new Uint32Array(p);let B=0;a=0;for(const N of d){const {totalTime:R,timeSeed:T}=
N;let S=p=null,Y=null;var F=null,J=null,K=null;for(let X=0;X<N.numberOfVertices;X++){F=r[4*(N.startVertex+X)];const ba=r[4*(N.startVertex+X)+1],aa=r[4*(N.startVertex+X)+2],Z=r[4*(N.startVertex+X)+3];let da=null,ka=null;var L=null;let ja=null;0<X&&(da=F-p,ka=ba-S,L=Math.sqrt(da*da+ka*ka),da/=L,ka/=L,1<X?(J=da+J,K=ka+K,L=Math.sqrt(J*J+K*K),J/=L,K/=L,L=Math.min(1/(J*da+K*ka),e),J*=L,K*=L,L=-K,ja=J):(L=-ka,ja=da),null!==L&&null!==ja&&(c(p,S,Y,L,ja,R,T,Z),w[a++]=B-2,w[a++]=B,w[a++]=B-1,w[a++]=B,w[a++]=
B+1,w[a++]=B-1));p=F;S=ba;Y=aa;J=da;K=ka;F=Z}c(p,S,Y,-K,J,R,T,F)}return{vertexData:f,indexData:w}}function m(a){function e(qa,k){var G=aa+da,M=Z+ka,O=Math.sqrt(G*G+M*M);G/=O;M/=O;var W=aa*G+Z*M,P=da+ja,V=ka+na;O=Math.sqrt(P*P+V*V);P/=O;V/=O;var U=da*P+ka*V;O=L;var Q=N,ea=R,ca=T;M=-(M/W);G/=W;W=S;var fa=Y,ha=X,ia=ba;V=-(V/U);P/=U;U=16*J;let la=0;for(const oa of[1,2])for(const pa of[1,2,3,4])B[U+la++]=O,B[U+la++]=Q,B[U+la++]=ea,B[U+la++]=ca,B[U+la++]=W,B[U+la++]=fa,B[U+la++]=ha,B[U+la++]=ia,B[U+la++]=
oa,B[U+la++]=pa,B[U+la++]=qa,B[U+la++]=k,B[U+la++]=M/2,B[U+la++]=G/2,B[U+la++]=V/2,B[U+la++]=P/2,J++;F[K++]=J-8;F[K++]=J-7;F[K++]=J-6;F[K++]=J-7;F[K++]=J-5;F[K++]=J-6;F[K++]=J-4;F[K++]=J-3;F[K++]=J-2;F[K++]=J-3;F[K++]=J-1;F[K++]=J-2}function c(qa,k,G,M,O,W){aa=da;Z=ka;da=ja;ka=na;null==aa&&null==Z&&(aa=da,Z=ka);if(null!=S&&null!=Y){ja=qa-S;na=k-Y;const P=Math.sqrt(ja*ja+na*na);ja/=P;na/=P}null!=aa&&null!=Z&&e(O,W);L=S;N=Y;R=X;T=ba;S=qa;Y=k;X=G;ba=M}function r(qa,k){aa=da;Z=ka;da=ja;ka=na;null==aa&&
null==Z&&(aa=da,Z=ka);null!=aa&&null!=Z&&e(qa,k)}const {lineVertices:d,lineDescriptors:p}=a;let w=a=0;for(var f of p){const qa=f.numberOfVertices-1;a+=8*qa;w+=12*qa}const B=new Float32Array(16*a),F=new Uint32Array(w);let J=0,K=0,L,N,R,T,S,Y,X,ba,aa,Z,da,ka,ja,na;for(const qa of p){na=ja=ka=da=Z=aa=ba=X=Y=S=T=R=N=L=null;const {totalTime:k,timeSeed:G}=qa;for(f=0;f<qa.numberOfVertices;f++)c(d[4*(qa.startVertex+f)],d[4*(qa.startVertex+f)+1],d[4*(qa.startVertex+f)+2],d[4*(qa.startVertex+f)+3],k,G);r(k,
G)}return{vertexData:B,indexData:F}}function u(a,e){const c=e.pixels,{width:r,height:d}=e,p=new Float32Array(r*d*2),w=e.mask||new Uint8Array(r*d*2);e.mask||w.fill(255);if("vector-uv"===a)for(a=0;a<r*d;a++)p[2*a]=c[0][a],p[2*a+1]=-c[1][a];else if("vector-magdir"===a)for(a=0;a<r*d;a++){e=c[0][a];const f=v.deg2rad(c[1][a]),B=Math.sin(f-Math.PI/2);p[2*a]=Math.cos(f-Math.PI/2)*e;p[2*a+1]=B*e}return{data:p,mask:w,width:r,height:d}}async function D(a,e,c,r,d,p){const w={requestProjectedLocalDirections:!0,
signal:p};null!=d&&(w.timeExtent=d);if("imagery"===a.type)return await a.load({signal:p}),d=a.rasterInfo.dataType,a=await a.fetchImage(e,c,r,w),null==a?.pixelData?.pixelBlock?{data:new Float32Array(c*r*2),mask:new Uint8Array(c*r),width:c,height:r}:u(d,a.pixelData.pixelBlock);await a.load({signal:p});d=a.serviceRasterInfo.dataType;a=await a.fetchPixels(e,c,r,w);return null==a?.pixelBlock?{data:new Float32Array(c*r*2),mask:new Uint8Array(c*r),width:c,height:r}:u(d,a.pixelBlock)}const I=()=>l.getLogger("esri.views.2d.engine.flow.dataUtils");
q.createAnimatedLinesData=H;q.createFlowMesh=async function(a,e,c,r){const d=performance.now();var p=E(e,c);const w=performance.now();c=b(e,p,c.width,c.height);e=performance.now();p=H(c,!0);c=performance.now();a="Streamlines"===a?h(p,10):m(p);p=performance.now();g("esri-2d-profiler")&&(I().info("I.1","_createFlowFieldFromData (ms)",Math.round(w-d)),I().info("I.2","_getStreamlines (ms)",Math.round(e-w)),I().info("I.3","createAnimatedLinesData (ms)",Math.round(c-e)),I().info("I.4","create{Streamlines|Particles}Mesh (ms)",
Math.round(p-c)),I().info("I.5","createFlowMesh (ms)",Math.round(p-d)),I().info("I.6","Mesh size (bytes)",a.vertexData.buffer.byteLength+a.indexData.buffer.byteLength));await Promise.resolve();x.throwIfAborted(r);return a};q.createParticlesMesh=m;q.createStreamlinesMesh=h;q.loadImagery=async function(a,e,c,r,d,p){const w=performance.now();var f=A.getInfo(e.spatialReference);if(!f)return c=await D(a,e,c,r,d,p),g("esri-2d-profiler")&&I().info("I.7","loadImagery, early exit (ms)",Math.round(performance.now()-
w)),g("esri-2d-profiler")&&I().info("I.9","Number of parts",1),c;const [B,F]=f.valid,J=Math.ceil(e.width/(F-B)),K=e.width/J,L=Math.round(c/J);let N=e.xmin;const R=[];f=performance.now();for(let T=0;T<J;T++){const S=new y({xmin:N,xmax:N+K,ymin:e.ymin,ymax:e.ymax,spatialReference:e.spatialReference});R.push(D(a,S,L,r,d,p));N+=K}a=await Promise.all(R);g("esri-2d-profiler")&&I().info("I.8","All calls to _fetchPart (ms)",Math.round(performance.now()-f));g("esri-2d-profiler")&&I().info("I.9","Number of parts",
a.length);r={data:new Float32Array(c*r*2),mask:new Uint8Array(c*r),width:c,height:r};e=0;for(const T of a){for(a=0;a<T.height;a++)for(d=0;d<T.width;d++)e+d>=c||(r.data[2*(a*c+e+d)]=T.data[2*(a*T.width+d)],r.data[2*(a*c+e+d)+1]=T.data[2*(a*T.width+d)+1],r.mask[a*c+e+d]=T.mask[a*T.width+d]);e+=T.width}g("esri-2d-profiler")&&I().info("I.10","loadImagery, general exit (ms)",Math.round(performance.now()-w));return r};Object.defineProperty(q,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/flow/FlowContainer":function(){define(["./BrushFlow",
"../webgl/enums","../webgl/WGLContainer"],function(q,C,g){class l extends g{constructor(){super(...arguments);this.flowStyle=null}doRender(v){super.doRender(v)}prepareRenderPasses(v){const x=v.registerRenderPass({name:"flow",brushes:[q],target:()=>this.children,drawPhase:C.WGLDrawPhase.MAP});return[...super.prepareRenderPasses(v),x]}}return l})},"esri/views/2d/engine/flow/BrushFlow":function(){define(["../../../../core/libs/gl-matrix-2/factories/mat3f32","../webgl/brushes/WGLBrush","../../../webgl/enums"],
function(q,C,g){class l extends C{constructor(){super(...arguments);this._visualState={time:0,dvsMat3:q.create(),displayViewMat3:q.create()}}dispose(){}prepareState(v){({context:v}=v);v.setColorMask(!0,!0,!0,!0);v.setStencilFunction(g.CompareFunction.EQUAL,0,255)}draw(v,x){const {requestRender:z,allowDelayedRender:A}=v,{displayData:y}=x;if(null!=y&&("loaded"===y.state.name&&y.attach(v),"attached"===y.state.name)){var E=y.state.resources;A&&!E.ready&&null!=z?z():(this._visualState.time=v.time/1E3,
this._visualState.dvsMat3=x.transforms.displayViewScreenMat3,this._visualState.displayViewMat3=v.state.displayViewMat3,y.flowStyle.render(v,this._visualState,E),y.flowStyle.animated&&null!=z&&z())}}}return l})},"esri/views/2d/engine/flow/FlowStrategy":function(){define("../../../../chunks/tslib.es6 ../../../../geometry ../../../../core/Accessor ../../../../core/Logger ../../../../core/mathUtils ../../../../core/promiseUtils ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ../../../../geometry/Point ./FlowDisplayData ./FlowDisplayObject ../../../../geometry/Extent".split(" "),
function(q,C,g,l,v,x,z,A,y,E,n,b,t,H){function h(m,u){const D=new n({x:(m.xmax+m.xmin)/2,y:(m.ymax+m.ymin)/2,spatialReference:m.spatialReference});var I=m.xmax-m.xmin;const a=m.ymax-m.ymin,e=Math.abs(Math.cos(v.deg2rad(u))),c=Math.abs(Math.sin(v.deg2rad(u)));u=e*I+c*a;I=c*I+e*a;m=new H({xmin:D.x-u/2,ymin:D.y-I/2,xmax:D.x+u/2,ymax:D.y+I/2,spatialReference:m.spatialReference});m.centerAt(D);return m}C=class extends g{constructor(m){super(m);this._flowDisplayObject=new t.FlowDisplayObject;this._loading=
null}initialize(){this.flowContainer.addChild(this._flowDisplayObject)}destroy(){this._clear();this.flowContainer.removeAllChildren()}get updating(){return null!=this._loading}update(m){var {flowStyle:u}=this.flowContainer;if(null==u)this._clear();else{var {extent:D,rotation:I,resolution:a,pixelRatio:e}=m.state;m=h(D,I);m.expand(1.15);u=new b(u,m,[Math.round((m.xmax-m.xmin)/a),Math.round((m.ymax-m.ymin)/a)],e);if(null!=this._loading){if(this._loading.update(u))return;this._loading.detach();this._loading=
null}null!=this._flowDisplayObject.displayData&&this._flowDisplayObject.displayData.update(u)||(u.load().then(()=>{this._flowDisplayObject.clear();this._flowDisplayObject.displayData=this._loading;this._loading=null},c=>{x.isAbortError(c)||(l.getLogger(this).error("A resource failed to load.",c),this._loading=null)}),this._loading=u)}}_clear(){this._flowDisplayObject.clear();null!=this._loading&&(this._loading.detach(),this._loading=null)}};q.__decorate([z.property()],C.prototype,"_loading",void 0);
q.__decorate([z.property()],C.prototype,"flowContainer",void 0);q.__decorate([z.property()],C.prototype,"updating",null);return C=q.__decorate([E.subclass("esri.views.2d.engine.flow.FlowStrategy")],C)})},"esri/views/2d/engine/flow/FlowDisplayData":function(){define(["../../../../core/Logger"],function(q){class C{constructor(g,l,v,x){this.state={name:"created"};this.flowStyle=g;this.extent=l;this.size=v;this.pixelRatio=x}async load(){const g=new AbortController;this.state={name:"loading",abortController:g};
this.state={name:"loaded",resources:await this.flowStyle.load({extent:this.extent,size:this.size,pixelRatio:this.pixelRatio},g.signal)}}attach(g){if("loaded"!==this.state.name)q.getLogger("esri.views.2d.engine.flow.FlowDisplayData").error("Only loaded resources can be attached.");else{var l=this.state.resources;l.attach(g);this.state={name:"attached",resources:l}}}detach(){"loading"===this.state.name?(this.state.abortController.abort(),this.state={name:"detached"}):"attached"===this.state.name&&(this.state.resources.detach(),
this.state={name:"detached"})}update(g){if(!this.flowStyle.isCompatible(g.flowStyle)||!this.extent.equals(g.extent)||this.size[0]!==g.size[0]||this.size[1]!==g.size[1]||this.pixelRatio!==g.pixelRatio)return!1;this.flowStyle=g.flowStyle;return!0}}return C})},"esri/views/2d/engine/flow/FlowDisplayObject":function(){define(["exports","../../../../core/mathUtils","../../../../core/libs/gl-matrix-2/math/mat3","../../../../core/libs/gl-matrix-2/factories/mat3f32","../DisplayObject"],function(q,C,g,l,v){class x extends v.DisplayObject{constructor(){super(...arguments);
this._displayData=null}get displayData(){return this._displayData}set displayData(z){this._displayData=z;this.requestRender()}clear(){null!=this._displayData&&(this._displayData.detach(),this._displayData=null,this.requestRender())}setTransform(z){var {displayData:A}=this;if(null!=A){var y=[0,0];z.toScreen(y,[A.extent.xmin,A.extent.ymax]);A=(A.extent.xmax-A.extent.xmin)/A.size[0]/z.resolution;var E=C.deg2rad(z.rotation),{displayViewScreenMat3:n}=this.transforms;g.fromTranslation(n,[-1,1,0]);g.scale(n,
n,[2/(z.size[0]*z.pixelRatio),-2/(z.size[1]*z.pixelRatio),1]);g.translate(n,n,[y[0],y[1],0]);g.rotate(n,n,E);g.scale(n,n,[A*z.pixelRatio,A*z.pixelRatio,1])}}_createTransforms(){return{displayViewScreenMat3:l.create()}}}q.FlowDisplayObject=x;Object.defineProperty(q,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/LayerView2D":function(){define("exports ../../../chunks/tslib.es6 ../../../core/Collection ../../../core/collectionUtils ../../../core/Error ../../../core/Logger ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ../../../linkChart/utils ../engine/Container ./support/util ../support/HighlightGroup ../support/highlightGroupUtils ../support/HighlightOptions ../../layers/support/ClipRect ../../layers/support/Geometry ../../layers/support/Path ../../support/layerViewUtils".split(" "),
function(q,C,g,l,v,x,z,A,y,E,n,b,t,H,h,m,u,D,I,a,e){const c=g.ofType({key:"type",base:null,typeMap:{rect:D,path:a,geometry:I}}),r=new (g.ofType(h.HighlightGroup));q.LayerView2DMixin=d=>{d=class extends d{constructor(){super(...arguments);this.attached=!1;this.clips=new c;this.highlights=null;this.lastUpdateId=-1;this.updateRequested=this.moving=!1;this._visibleAtCurrentScale=!0}initialize(){const p=this.view?.spatialReferenceLocked??!0;this.view?.spatialReference&&p&&!this.spatialReferenceSupported?
this.addResolvingPromise(Promise.reject(new v("layerview:spatial-reference-incompatible","The spatial reference of this layer does not meet the requirements of the view",{layer:this.layer}))):(this.container||(this.container=new t.Container),this.container.fadeTransitionEnabled=!0,this.container.visible=!1,this.container.endTransitions(),this.addHandles([z.watch(()=>this.suspended,w=>{this.container&&(this.container.visible=!w)},z.syncAndInitial),z.watch(()=>this.updateSuspended,w=>{this.view&&!w&&
this.updateRequested&&this.view.requestUpdate()},z.syncAndInitial),z.watch(()=>this.layer?.opacity??1,w=>{this.container&&(this.container.opacity=w)},z.syncAndInitial),z.watch(()=>this.layer&&"blendMode"in this.layer?this.layer.blendMode:"normal",w=>{this.container&&(this.container.blendMode=w)},z.syncAndInitial),z.watch(()=>this.layer&&"effect"in this.layer?this.layer.effect:null,w=>{this.container&&(this.container.effect=w)},z.syncAndInitial),z.watch(()=>this._mergedHighlights.items.map(w=>({name:w.name,
options:{fillColor:w.options.color,haloColor:w.options.haloColor,fillOpacity:w.options.fillOpacity,haloOpacity:w.options.haloOpacity,haloWidth:w.options.haloWidth,haloBlur:w.options.haloBlur}})),()=>{this.container.highlightGradient=H.createOrReuseHighlightGradient(this.container.highlightGradient,this._mergedHighlights.items)},z.syncAndInitial),z.watch(()=>this._mergedHighlights.items.map(w=>w.name),()=>{this._updateHighlights()}),z.on(()=>this.clips,"change",()=>{this.container&&(this.container.clips=
this.clips)},z.syncAndInitial),z.watch(()=>({scale:this.view?.scale,scaleRange:this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null}),({scale:w,scaleRange:f})=>{w=e.isInEffectiveScaleRange(f,w);w!==this._visibleAtCurrentScale&&(this._visibleAtCurrentScale=w)},z.syncAndInitial)],"constructor"),this.view?.whenLayerView?this.view.whenLayerView(this.layer).then(w=>{w===this&&this.processAttach()},()=>{}):this.when().then(()=>{this.processAttach()},()=>{}))}_updateHighlights(){}destroy(){this.processDetach();
this.updateRequested=!1}get highlightOptions(){return m.getDefaultHighlightOptions(this)}set highlightOptions(p){m.setDefaultHighlightOptions(this,p)}get _mergedHighlights(){if(!this.view)return r;if(!this.highlights)return this.view.highlights;const p=this.view.highlights.clone();for(const w of this.highlights){const f=p.find(B=>B.name===w.name);f&&(f.options=w.options)}return p}get scheduler(){return this.view.scheduler}get spatialReferenceSupported(){const p=this.view?.spatialReference;return null==
p||this.supportsSpatialReference(p)}get updating(){return this.spatialReferenceSupported&&(!this.attached||!this.suspended&&(this.updateRequested||this.isUpdating())||!!this._updatingHandles?.updating||this.container.transitioning)}get visibleAtCurrentScale(){return this._visibleAtCurrentScale}processAttach(){this.isResolved()&&!this.attached&&!this.destroyed&&this.spatialReferenceSupported&&(this.attach(),this.attached=!0,this.requestUpdate())}processDetach(){this.attached&&(this.attached=!1,this.removeHandles("attach"),
this.detach(),this.updateRequested=!1)}requestUpdate(){this.destroyed||this.updateRequested||(this.updateRequested=!0,this.updateSuspended||this.view.requestUpdate())}processUpdate(p){this.isFulfilled()&&!this.isResolved()?this.updateRequested=!1:(this._set("updateParameters",p),this.updateRequested&&!this.updateSuspended&&(this.updateRequested=!1,this.update(p)))}hitTest(p,w){return Promise.resolve(null)}supportsSpatialReference(p){return!0}canResume(){if(!this.spatialReferenceSupported)return!1;
switch(this.layer?.type){case "link-chart":case "knowledge-graph-sublayer":break;default:if(b.isLinkChartView(this.view)&&!this.view.inGeographicLayout)return!1}return super.canResume()?this.visibleAtCurrentScale:!1}getSuspendInfo(){const p=super.getSuspendInfo(),w=!this.spatialReferenceSupported;w&&(p.spatialReferenceNotSupported=w);return p}addAttachHandles(p){this.addHandles(p,"attach")}_getHighlightBits(p){p=new Set(p);let w=1,f=0;if(!this.view)return 0;const B=this._mergedHighlights;for(const {name:F}of B)p.delete(F)&&
(f=w),w<<=1;for(const F of p)x.getLogger(this).error("#highlights",`${F} was not found. Features in this group will not be highlighted.`);return f}};C.__decorate([A.property()],d.prototype,"attached",void 0);C.__decorate([A.property({type:c,set(p){p=l.referenceSetter(p,this._get("clips"),c);this._set("clips",p)}})],d.prototype,"clips",void 0);C.__decorate([A.property()],d.prototype,"container",void 0);C.__decorate([A.property({type:u})],d.prototype,"highlightOptions",null);C.__decorate([A.property({type:g.ofType(h.HighlightGroup)})],
d.prototype,"highlights",void 0);C.__decorate([A.property()],d.prototype,"_mergedHighlights",null);C.__decorate([A.property()],d.prototype,"moving",void 0);C.__decorate([A.property({readOnly:!0})],d.prototype,"spatialReferenceSupported",null);C.__decorate([A.property({readOnly:!0})],d.prototype,"updateParameters",void 0);C.__decorate([A.property()],d.prototype,"updateRequested",void 0);C.__decorate([A.property()],d.prototype,"updating",null);C.__decorate([A.property()],d.prototype,"view",void 0);
C.__decorate([A.property()],d.prototype,"_visibleAtCurrentScale",void 0);C.__decorate([A.property({readOnly:!0})],d.prototype,"visibleAtCurrentScale",null);return d=C.__decorate([n.subclass("esri.views.2d.layers.LayerView2D")],d)};Object.defineProperty(q,Symbol.toStringTag,{value:"Module"})})},"esri/linkChart/utils":function(){define(["exports"],function(q){q.isLinkChartView=function(C){return null!=C&&"object"===typeof C&&"2d"===C.type&&"linkchart"===C.view2dType};Object.defineProperty(q,Symbol.toStringTag,
{value:"Module"})})},"esri/views/layers/support/ClipRect":function(){define("../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ./ClipArea".split(" "),function(q,C,g,l,v,x,z){var A;g=A=class extends z{constructor(y){super(y);this.type="rect";this.bottom=this.top=this.right=this.left=null}clone(){return new A({left:this.left,right:this.right,top:this.top,bottom:this.bottom})}commitVersionProperties(){this.commitProperty("left");
this.commitProperty("right");this.commitProperty("top");this.commitProperty("bottom")}};q.__decorate([C.property({type:[Number,String],json:{write:!0}})],g.prototype,"left",void 0);q.__decorate([C.property({type:[Number,String],json:{write:!0}})],g.prototype,"right",void 0);q.__decorate([C.property({type:[Number,String],json:{write:!0}})],g.prototype,"top",void 0);q.__decorate([C.property({type:[Number,String],json:{write:!0}})],g.prototype,"bottom",void 0);return g=A=q.__decorate([x.subclass("esri.views.layers.support.ClipRect")],
g)})},"esri/views/layers/support/ClipArea":function(){define("../../../chunks/tslib.es6 ../../../core/JSONSupport ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass".split(" "),function(q,C,g,l,v,x,z){C=class extends C.JSONSupport{get version(){this.commitVersionProperties();return(this._get("version")||0)+1}};q.__decorate([g.property({readOnly:!0})],C.prototype,"version",null);return C=
q.__decorate([z.subclass("esri.views.layers.support.ClipArea")],C)})},"esri/views/layers/support/Geometry":function(){define("../../../chunks/tslib.es6 ../../../geometry ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ../../../geometry/Geometry ../../../geometry/support/jsonUtils ./ClipArea ../../../geometry/Extent ../../../geometry/Polygon".split(" "),function(q,C,g,l,v,x,z,A,y,E,n,
b){var t;C={base:A,key:"type",typeMap:{extent:n,polygon:b}};E=t=class extends E{constructor(H){super(H);this.type="geometry";this.geometry=null}clone(){return new t({geometry:this.geometry?.clone()??null})}commitVersionProperties(){this.commitProperty("geometry")}};q.__decorate([g.property({types:C,json:{read:y.fromJSON,write:!0}})],E.prototype,"geometry",void 0);return E=t=q.__decorate([z.subclass("esri.views.layers.support.Geometry")],E)})},"esri/views/layers/support/Path":function(){define("../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ./ClipArea".split(" "),
function(q,C,g,l,v,x,z){g=class extends z{constructor(A){super(A);this.type="path";this.path=[]}commitVersionProperties(){this.commitProperty("path")}};q.__decorate([C.property({type:[[[Number]]],json:{write:!0}})],g.prototype,"path",void 0);return g=q.__decorate([x.subclass("esri.views.layers.support.Path")],g)})},"esri/views/2d/layers/imagery/ImageryTileView2D":function(){define("../../../../chunks/tslib.es6 ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/Logger ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ../../engine/imagery/RasterTileContainer ./BaseImageryTileSubView2D ../support/util ../../../layers/support/Geometry".split(" "),
function(q,C,g,l,v,x,z,A,y,E){g=class extends A.BaseImageryTileSubView2D{constructor(){super(...arguments);this.type="raster"}attach(){super.attach();this.container=new z.RasterTileContainer(this._tileInfoView);this.container.isCustomTilingScheme=this._isCustomTilingScheme;this.updateRasterFunctionParameters()}detach(){super.detach();this.container.removeAllChildren();this.container=null}canUseWebGLForProcessing(){const {symbolizer:n}=this.layer;var b=n.lookup?.colormapLut?.indexedColormap;b=b&&b.length>
this._maxIndexedColormapSize;return this.useWebGLForProcessing&&n.canRenderInWebGL&&!b&&!("majority"===this.layer.interpolation&&y.canUseMajorityInterpolationOnDataSource(this.layer))}fetchTile(n,b){return this.layer.fetchTile(n.level,n.row,n.col,b)}updateRasterFunctionParameters(){const {clips:n,view:b}=this.layerView;null!=this._geometry&&n.remove(this._geometry);const {raster:t,type:H}=this.layer;if("Function"===t.datasetFormat){var h=t.getClippingGeometry(b.spatialReference);h&&(h=new E({geometry:h}),
n.add(h),this._geometry=h)}({container:h}=this);if("Function"!==t.datasetFormat||"wcs"===H)h.rasterFunctionChain=null,h.children.forEach(r=>{({bitmap:r}=r);r&&(r.suspended=!0,r.processed=!1,r.projected&&(r.invalidateTexture(),r.rasterTexture=null))}),this._rasterFunctionState="na";else{var m=this._rasterFunctionState,{rasterFunction:u,primaryRasters:D}=t,I=u.supportsGPU&&(!D||1>=D.rasters.length),a=I?u.flatWebGLFunctionChain:null,{renderer:e}=this.layer;I=!I||!a?.functions.length||"raster-stretch"===
e?.type&&e.dynamicRangeAdjustment||!this.canUseWebGLForProcessing();h.rasterFunctionChain=I?null:a;var c=null==u?"na":h.rasterFunctionChain?"gpu":"cpu";h.children.forEach(r=>{({bitmap:r}=r);r&&(r.suspended=m!==c,r.processed=!1,r.processedTexture=null)});this._rasterFunctionState=c}}async updateTileSource(n,b){const t=this._getBandIds(),H=this._getLayerInterpolation(),h=this.canUseWebGLForProcessing(),{source:m,globalSymbolizerParams:u,suspended:D,coords:I,resolution:a}=b;b=this.layerView.hasTilingEffects?
u:b.symbolizerParams;({bitmap:n}=n);[n.x,n.y]=I;n.resolution=a;if(null!=m?.pixelBlock){var e={extent:m.extent,pixelBlock:m.pixelBlock,srcPixelSize:m.srcTilePixelSize};n.rawPixelData=e;h?(n.source=m.pixelBlock,n.isRendereredSource=!1):(e=await this.layer.applyRenderer(e,"stretch"===u?.type?u:void 0),n.source=e,n.isRendereredSource=!0);n.symbolizerParameters=h?b:null;n.transformGrid=h?m.transformGrid:null}else e=this.createEmptyTilePixelBlock(),n.source=e,n.symbolizerParameters=h?b:null,n.transformGrid=
null;n.bandIds=h?t:null;n.width=this._tileInfoView.tileInfo.size[0];n.height=this._tileInfoView.tileInfo.size[1];n.interpolation=H;n.suspended=D;n.invalidateTexture()}async updateTileSymbolizerParameters(n,b){const {local:t,global:H}=b;b=this._getBandIds();const h=this._getLayerInterpolation(),m=this.canUseWebGLForProcessing();({bitmap:n}=n);const {rawPixelData:u}=n;m||null==u?(n.isRendereredSource&&null!=u&&(n.source=u.pixelBlock),n.isRendereredSource=!1):(n.source=await this.layer.applyRenderer(u,
"stretch"===H?.type?H:void 0),n.isRendereredSource=!0);n.symbolizerParameters=m?this.layerView.hasTilingEffects?H:t:null;n.bandIds=m?b:null;n.interpolation=h;n.suspended=!1}_getLayerInterpolation(){const {interpolation:n,renderer:b}=this.layer;if(!b)return n;const t=b.type;return"raster-colormap"===t||"unique-value"===t?"nearest":"raster-stretch"===b.type&&null!=b.colorRamp?"bilinear"===n||"cubic"===n?"bilinear":"nearest":n}};q.__decorate([C.property()],g.prototype,"container",void 0);q.__decorate([C.property()],
g.prototype,"layer",void 0);q.__decorate([C.property()],g.prototype,"type",void 0);return g=q.__decorate([x.subclass("esri.views.2d.layers.imagery.ImageryTileView2D")],g)})},"esri/views/2d/engine/imagery/RasterTileContainer":function(){define("exports ../../../../geometry/support/aaBoundingRect ../../viewpointUtils ./BrushRasterBitmap ./RasterTile ../webgl/enums ../webgl/TileContainer".split(" "),function(q,C,g,l,v,x,z){class A extends z{constructor(){super(...arguments);this.isCustomTilingScheme=
!1}createTile(y){const E=this._getTileBounds(y),[n,b]=this.tileInfoView.tileInfo.size,t=this.tileInfoView.getTileResolution(y.level);return new v.RasterTile(y,t,E[0],E[3],n,b)}prepareRenderPasses(y){const E=y.registerRenderPass({name:"imagery (tile)",brushes:[l],target:()=>this.children.map(n=>n.bitmap),drawPhase:x.WGLDrawPhase.MAP});return[...super.prepareRenderPasses(y),E]}doRender(y){if(this.visible&&y.drawPhase===x.WGLDrawPhase.MAP){var {rasterFunctionChain:E}=this;if(E){if(!E.hasFocalFunction){const [n,
b]=this.tileInfoView.tileInfo.size;y.renderPass="raster";y.rasterFunction={name:"Reproject",parameters:{targetImageSize:[n,b],requireNNEdge:E.isSourceSingleBand},pixelType:"f32",id:0,isNoopProcess:!1};super.doRender(y)}if(E?.functions.length){const {functions:n,hasBranches:b}=E;for(E=0;E<n.length;E++){const t=n[E];"Constant"!==t.name&&"Identity"!==t.name&&(y.renderPass="raster",y.rasterFunction=t,y.hasBranches=b,super.doRender(y))}}y.rasterFunction=null;y.renderPass="bitmap"}else y.renderPass="raster-bitmap";
super.doRender(y)}}_getTileBounds(y){const E=this.tileInfoView.getTileBounds(C.create(),y);if(this.isCustomTilingScheme&&y.world){const {tileInfo:b}=this.tileInfoView,t=g.getWorldWidth(b.spatialReference);if(t){var n=b.lodAt(y.level);if(!n)return E;({resolution:n}=n);n*=b.size[0];E[0]=t*y.world+b.origin.x+y.col*n;E[2]=E[0]+n}}return E}}q.RasterTileContainer=A;Object.defineProperty(q,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/imagery/BrushRasterBitmap":function(){define("../../../../core/maybe ./RasterBitmap ./colorizer/rasterColorizer ./processor/rasterProcessor ../webgl/definitions ../webgl/VertexStream ../webgl/brushes/WGLBrush ../../../webgl/enums ../../../webgl/FramebufferObject ../../../webgl/rasterUtils".split(" "),
function(q,C,g,l,v,x,z,A,y,E){class n extends z{constructor(){super(...arguments);this.name="raster";this._quad=null;this._rendererUniformInfos=new Map;this._fbo=null}dispose(){q.disposeMaybe(this._quad);q.disposeMaybe(this._fbo)}prepareState(b){const {context:t,renderPass:H}=b;b="raster"===H;t.setBlendingEnabled(!b);t.setBlendFunctionSeparate(A.BlendFactor.ONE,A.BlendFactor.ONE_MINUS_SRC_ALPHA,A.BlendFactor.ONE,A.BlendFactor.ONE_MINUS_SRC_ALPHA);t.setColorMask(!0,!0,!0,!0);t.setStencilWriteMask(0);
t.setStencilTestEnabled(!b)}draw(b,t){if(C.hasSource(t)&&!t.suspended){var {renderPass:H}=b;if("raster-bitmap"===H)this._drawBitmap(b,t);else{if("raster"===H)return this._process(b,t);this._drawBitmap(b,t,!0)}}}_process(b,t){var {rasterFunction:H}=b;H="Reproject"===H.name;if(!(H?t.rasterTexture&&t.projected:t.processed)){var {timeline:h,context:m}=b;h.begin(this.name);var u=m.getBoundFramebufferObject(),D=m.getViewport();H||(t.processedTexture=q.disposeMaybe(t.processedTexture));m.setStencilFunction(A.CompareFunction.EQUAL,
t.stencilRef,255);t.updateTexture(b);this._initQuad(m);var [I,a]=t.getRasterTextureSize(H),{isStandardRasterTileSize:e,fbo:c}=this._getRasterFBO(m,I,a);l.process(b,this._quad,c,t);e||c.dispose();m.bindFramebuffer(u);m.setViewport(D.x,D.y,D.width,D.height);h.end(this.name)}}_drawBitmap(b,t,H=!1){const {timeline:h,context:m}=b;h.begin(this.name);m.setStencilFunction(A.CompareFunction.EQUAL,t.stencilRef,255);t.updateTexture(b);if(H&&!t.processedTexture){t.updateProcessedTexture();if(!t.processedTexture){h.end(this.name);
return}t.processed=!0}this._initBitmapCommonUniforms(t);var u=t.symbolizerParameters.type;const D=g.getColorizer(u),{requestRender:I,allowDelayedRender:a}=b,{defines:e,program:c}=D.createProgram(b,t,t.projected&&H);a&&null!=I&&!c.compiled?I():(m.useProgram(c),u=this._getUniformInfos(u,m,c,e),this._quad||(this._quad=new x(m,[0,0,1,0,0,1,1,1])),D.bindTextureAndUniforms(b,c,t,u,H),this._quad.draw(),h.end(this.name))}_initBitmapCommonUniforms(b){if(!b.commonUniforms){const t=E.getBasicGridUniforms(1,
[0,0]),{transformGrid:H,width:h,height:m}=b,u=E.getCommonUniforms(H,[h,m],[b.source.width,b.source.height],1,!1);b.commonUniforms={...t,...u,u_coordScale:b.coordScale}}}_getRasterFBO(b,t,H){const h=t===v.tileSize&&H===v.tileSize;return h?(this._fbo||(this._fbo=this._createNewFBO(b,t,H)),{isStandardRasterTileSize:h,fbo:this._fbo}):{isStandardRasterTileSize:h,fbo:this._createNewFBO(b,t,H)}}_createNewFBO(b,t,H){t=l.createTextureDescriptor(t,H);return new y.FramebufferObject(b,t)}_initQuad(b){this._quad||
(this._quad=new x(b,[0,0,1,0,0,1,1,1]))}_getUniformInfos(b,t,H,h){b=0<h.length?b+"-"+h.join("-"):b;if(this._rendererUniformInfos.has(b))return this._rendererUniformInfos.get(b);t=E.getUniformLocationInfos(t,H);this._rendererUniformInfos.set(b,t);return t}}return n})},"esri/views/2d/engine/imagery/RasterBitmap":function(){define("exports ../../../../core/maybe ../../../../core/libs/gl-matrix-2/math/mat3 ../../../../core/libs/gl-matrix-2/factories/mat3f32 ../../../../core/libs/gl-matrix-2/factories/vec2f32 ../DisplayObject ../../../webgl/enums ../../../webgl/rasterUtils".split(" "),
function(q,C,g,l,v,x,z,A){const y={bandCount:3,outMin:0,outMax:1,minCutOff:[0,0,0],maxCutOff:[255,255,255],factor:[1/255,1/255,1/255],useGamma:!1,gamma:[1,1,1],gammaCorrection:[1,1,1],colormap:null,colormapOffset:null,stretchType:"none",type:"stretch"};class E extends x.DisplayObject{constructor(b=null,t=null,H=null){super();this._colormapTextureInvalidated=this._textureInvalidated=!0;this._colormap=this._colormapTexture=this._transformGridTexture=this._rasterTextureBandIds=this._rasterTexture=null;
this._supportsBilinearTexture=!0;this._processedTexture=null;this.functionTextures=[];this.projected=!1;this.stencilRef=0;this.coordScale=[1,1];this._processed=!1;this.height=this._symbolizerParameters=null;this.isRendereredSource=!1;this.pixelRatio=1;this.rotation=this.resolution=0;this.rawPixelData=this._source=null;this._suspended=!1;this.width=this._transformGrid=this._interpolation=this._bandIds=null;this.y=this.x=0;this.source=b;this.transformGrid=t;this.interpolation=H}destroy(){this._disposeTextures()}get processedTexture(){return this._processedTexture}set processedTexture(b){this._processedTexture!==
b&&(this._disposeTextures(!0),this._processedTexture=b)}get rasterTexture(){return this._rasterTexture}set rasterTexture(b){this._rasterTexture!==b&&(this._rasterTexture?.dispose(),this._rasterTexture=b);null==b&&(this.projected=!1)}get processed(){return this._processed}set processed(b){this._processed=b;b||(C.disposeMaybe(this.processedTexture),this.invalidateTexture())}get symbolizerParameters(){return this._symbolizerParameters||y}set symbolizerParameters(b){this._symbolizerParameters!==b&&(this._symbolizerParameters=
b,this._colormapTextureInvalidated=!0,this.commonUniforms=null)}get source(){return this._source}set source(b){this._source!==b&&(this._source=b,this._rasterTexture&&(this._rasterTexture.dispose(),this._rasterTextureBandIds=this._rasterTexture=null),this.commonUniforms=null,this.projected=!1,this.invalidateTexture())}get suspended(){return this._suspended}set suspended(b){this._suspended&&!b&&this.stage&&(this.ready(),this.requestRender());this._suspended=b}get bandIds(){return this._bandIds}set bandIds(b){this._bandIds=
b;this._isBandIdsChanged(b)&&(this.projected=!1,this.invalidateTexture())}get interpolation(){return this._interpolation||"nearest"}set interpolation(b){this._interpolation=b;this._rasterTexture&&this._rasterTexture.setSamplingMode("bilinear"===this._getTextureSamplingMethod(b||"nearest")?z.TextureSamplingMode.LINEAR:z.TextureSamplingMode.NEAREST)}get transformGrid(){return this._transformGrid}set transformGrid(b){this._transformGrid!==b&&(this._transformGrid=b,this._transformGridTexture=C.disposeMaybe(this._transformGridTexture))}invalidateTexture(){this._textureInvalidated||
(this._textureInvalidated=!0,this.requestRender())}getRasterTextureSize(b=!1){b=b||this.projected;return[b?this.width:this.source?.width||this.width,b?this.height:this.source?.height||this.height]}getRasterCellSize(){const b=this.rawPixelData?.srcPixelSize,{projected:t,resolution:H}=this;return b&&!t?[b.x,b.y]:[H,H]}_createTransforms(){return{displayViewScreenMat3:l.create()}}setTransform(b){const t=g.identity(this.transforms.displayViewScreenMat3),[H,h]=b.toScreenNoRotation([0,0],[this.x,this.y]);
var m=this.resolution/this.pixelRatio/b.resolution;const u=m*this.width;m*=this.height;const D=Math.PI*this.rotation/180;g.translate(t,t,v.fromValues(H,h));g.translate(t,t,v.fromValues(u/2,m/2));g.rotate(t,t,-D);g.translate(t,t,v.fromValues(-u/2,-m/2));g.scaleByVec2(t,t,v.fromValues(u,m));g.multiply(this.transforms.displayViewScreenMat3,b.displayViewMat3,t)}getTextures({forProcessing:b=!1,useProcessedTexture:t=!1}={}){const H=t?this._processedTexture??this._rasterTexture:this._rasterTexture,h=[],
m=[];if(!H)return{names:h,textures:m};this._transformGridTexture&&!this.projected&&(m.push(this._transformGridTexture),h.push("u_transformGrid"));if(t)return m.push(H),h.push("u_image"),this._colormapTexture&&(m.push(this._colormapTexture),h.push("u_colormap")),{names:h,textures:m};m.push(H);h.push("u_image");this._colormapTexture&&!b&&(m.push(this._colormapTexture),h.push("u_colormap"));return{names:h,textures:m}}onAttach(){this.invalidateTexture()}onDetach(){this.invalidateTexture()}updateTexture({context:b}){if(this.stage){var t=
this._isValidSource(this.source);t&&this._colormapTextureInvalidated&&(this._colormapTextureInvalidated=!1,this._updateColormapTexture(b));this._textureInvalidated&&(this._textureInvalidated=!1,this._createOrDestroyRasterTexture(b),this._rasterTexture&&(t?this.transformGrid&&!this._transformGridTexture&&(this._transformGridTexture=A.createTransformTexture(b,this.transformGrid)):this._rasterTexture.setData(null)),this.suspended||(this.ready(),this.requestRender()))}else this._disposeTextures()}updateProcessedTexture(){const {functionTextures:b}=
this;0!==b.length&&(this.processedTexture=b.shift(),b.forEach(t=>t?.dispose()),b.length=0)}_createOrDestroyRasterTexture(b){const t=this.source?.extractBands(this.bandIds);if(this._isValidSource(t)){var H=!this._isBandIdsChanged(this.bandIds);if(this._rasterTexture){if(H)return;this._rasterTexture.dispose();this._rasterTexture=this._rasterTextureBandIds=null}this._supportsBilinearTexture=!!b.capabilities.textureFloatLinear;H=this._getTextureSamplingMethod(this.interpolation);this._rasterTexture=A.createRasterTexture(b,
t,H,this.isRendereredSource);this._processed=this.projected=!1;this._rasterTextureBandIds=this.bandIds?[...this.bandIds]:null}else this._rasterTexture&&(this._rasterTexture.dispose(),this._rasterTexture=this._rasterTextureBandIds=null)}_isBandIdsChanged(b){const t=this._rasterTextureBandIds;return!(null==t&&null==b||t&&b&&t.join("")===b.join(""))}_isValidSource(b){return null!=b&&0<b.pixels?.length}_getTextureSamplingMethod(b){var {type:t}=this.symbolizerParameters;t="lut"===t&&!this.symbolizerParameters.isClassBreaks||
"hillshade"===t||"stretch"===t&&1===this.symbolizerParameters.bandCount;return!this._supportsBilinearTexture||t||"bilinear"!==b&&"cubic"!==b?"nearest":"bilinear"}_updateColormapTexture(b){const t=this._colormap,H=this.symbolizerParameters.colormap;if(!H)this._colormapTexture&&(this._colormapTexture.dispose(),this._colormapTexture=null),this._colormap=null;else if(!t)this._colormapTexture=A.createColormapTexture(b,H),this._colormap=H;else if(H.length!==t.length||H.some((h,m)=>h!==t[m]))this._colormapTexture&&
(this._colormapTexture.dispose(),this._colormapTexture=null),this._colormapTexture=A.createColormapTexture(b,H),this._colormap=H}_disposeTextures(b=!1){!this._transformGridTexture||b&&!this.projected||(this._transformGridTexture.dispose(),this._transformGridTexture=null);!b&&this._colormapTexture&&(this._colormapTexture.dispose(),this._colormap=this._colormapTexture=null,this._colormapTextureInvalidated=!0);!b&&this._rasterTexture&&(this._rasterTexture.dispose(),this._rasterTextureBandIds=this._rasterTexture=
null);this._processedTexture&&(this._processedTexture.dispose(),this._processedTexture=null)}}class n extends E{get source(){return this._source}}q.RasterBitmap=E;q.RasterBitmapWithSource=n;q.hasSource=function(b){return null!=b.source};Object.defineProperty(q,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/rasterUtils":function(){define(["exports","../../core/libs/gl-matrix-2/factories/vec2f64","./enums","./Texture","./TextureDescriptor"],function(q,C,g,l,v){q.createColormapTexture=function(x,
z){const A=new v.TextureDescriptor;A.internalFormat=g.PixelFormat.RGBA;A.width=z.length/4;A.height=1;A.samplingMode=g.TextureSamplingMode.NEAREST;A.wrapMode=g.TextureWrapMode.CLAMP_TO_EDGE;return new l.Texture(x,A,z)};q.createRasterTexture=function(x,z,A="nearest",y=!1){const E=(y=!(y&&"u8"===z.pixelType))?g.PixelType.FLOAT:g.PixelType.UNSIGNED_BYTE,n=null==z.pixels||0===z.pixels.length?null:y?z.getAsRGBAFloat():z.getAsRGBA(),b=x.capabilities.textureFloatLinear,t=new v.TextureDescriptor;t.width=z.width;
t.height=z.height;t.internalFormat=y?g.SizedPixelFormat.RGBA32F:g.PixelFormat.RGBA;t.samplingMode=!b||"bilinear"!==A&&"cubic"!==A?g.TextureSamplingMode.NEAREST:g.TextureSamplingMode.LINEAR;t.dataType=E;t.wrapMode=g.TextureWrapMode.CLAMP_TO_EDGE;return new l.Texture(x,t,n)};q.createTransformTexture=function(x,z){const {spacing:A,offsets:y,coefficients:E,size:[n,b]}=z;var t=1<A[0];z=new v.TextureDescriptor;z.width=t?4*n:n;z.height=b;z.internalFormat=g.SizedPixelFormat.RGBA32F;z.dataType=g.PixelType.FLOAT;
z.samplingMode=g.TextureSamplingMode.NEAREST;z.wrapMode=g.TextureWrapMode.CLAMP_TO_EDGE;const H=new Float32Array(t?n*b*16:2*y.length);if(t&&null!=E)for(let h=0,m=0;h<E.length;h++)H[m++]=E[h],2===h%3&&(H[m++]=1);else for(t=0;t<b;t++)for(let h=0;h<n;h++){const m=4*(t*n+h),u=2*(h*b+t);H[m]=y[u];H[m+1]=y[u+1];H[m+3]=-1===y[u]?0:1}return new l.Texture(x,z,H)};q.getBasicGridUniforms=function(x,z){return{u_scale:x,u_offset:z}};q.getColormapUniforms=function(x,z){return{u_colormapOffset:z||0,u_colormapMaxIndex:x?
x.length/4-1:0}};q.getCommonUniforms=function(x,z,A,y=1,E=!0){return{u_flipY:E,u_applyTransform:!!x,u_opacity:y,u_transformSpacing:x?x.spacing:C.ZEROS,u_transformGridSize:x?x.size:C.ZEROS,u_targetImageSize:z,u_srcImageSize:A}};q.getShadedReliefUniforms=function(x){return{u_hillshadeType:x.hillshadeType,u_sinZcosAs:x.sinZcosAs,u_sinZsinAs:x.sinZsinAs,u_cosZs:x.cosZs,u_weights:x.weights,u_factor:x.factor,u_minValue:x.minValue,u_maxValue:x.maxValue}};q.getStretchUniforms=function(x){return{u_bandCount:x.bandCount,
u_minOutput:x.outMin,u_maxOutput:x.outMax,u_minCutOff:x.minCutOff,u_maxCutOff:x.maxCutOff,u_factor:x.factor,u_useGamma:x.useGamma,u_gamma:x.gamma,u_gammaCorrection:x.gammaCorrection}};q.getUniformLocationInfos=function(x,z){x=x.gl;z=z.glName;const A=new Map;if(null==z)return A;const y=x.getProgramParameter(z,x.ACTIVE_UNIFORMS);let E;for(let n=0;n<y;n++)(E=x.getActiveUniform(z,n))&&A.set(E.name,{location:x.getUniformLocation(z,E.name),info:E});return A};q.setTextures=function(x,z,A,y){A.length===y.length&&
(y.some(E=>null==E)||A.some(E=>null==E)||A.forEach((E,n)=>{z.setUniform1i(E,n);x.bindTexture(y[n],n)}))};q.setUniforms=function(x,z,A){Object.keys(A).forEach(y=>{var E=z.get(y)||z.get(y+"[0]");if(E){var n=A[y];if(null!==E&&null!=n)switch({info:E}=E,E.type){case g.UniformType.FLOAT:1<E.size?x.setUniform1fv(y,n):x.setUniform1f(y,n);break;case g.UniformType.FLOAT_VEC2:x.setUniform2fv(y,n);break;case g.UniformType.FLOAT_VEC3:x.setUniform3fv(y,n);break;case g.UniformType.FLOAT_VEC4:x.setUniform4fv(y,n);
break;case g.UniformType.FLOAT_MAT3:x.setUniformMatrix3fv(y,n);break;case g.UniformType.FLOAT_MAT4:x.setUniformMatrix4fv(y,n);break;case g.UniformType.INT:1<E.size?x.setUniform1iv(y,n):x.setUniform1i(y,n);break;case g.UniformType.BOOL:x.setUniform1i(y,n?1:0);break;case g.UniformType.INT_VEC2:case g.UniformType.BOOL_VEC2:x.setUniform2iv(y,n);break;case g.UniformType.INT_VEC3:case g.UniformType.BOOL_VEC3:x.setUniform3iv(y,n);break;case g.UniformType.INT_VEC4:case g.UniformType.BOOL_VEC4:x.setUniform4iv(y,
n)}}})};Object.defineProperty(q,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/imagery/colorizer/rasterColorizer":function(){define(["exports","./lut","./shadedrelief","./stretch"],function(q,C,g,l){const v=new Map;v.set("lut",C);v.set("hillshade",g);v.set("stretch",l);q.getColorizer=function(x){return v.get(x)};Object.defineProperty(q,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/imagery/colorizer/lut":function(){define(["./utils","../../../../webgl/rasterUtils"],function(q,
C){const g={vsPath:"raster/common",fsPath:"raster/lut",attributes:new Map([["a_position",0],["a_texcoord",1]])};return{createProgram:function(l,v,x){v=x?[]:q.getProjectionDefines(v.transformGrid);l=l.painter.materialManager.getProgram(g,v);return{defines:v,program:l}},bindTextureAndUniforms:function(l,v,x,z,A=!1){const {names:y,textures:E}=x.getTextures({useProcessedTexture:A});C.setTextures(l.context,v,y,E);C.setUniforms(v,z,x.commonUniforms);v.setUniformMatrix3fv("u_dvsMat3",x.transforms.displayViewScreenMat3);
const {colormap:n,colormapOffset:b}=x.symbolizerParameters;l=C.getColormapUniforms(n,b);C.setUniforms(v,z,l)}}})},"esri/views/2d/engine/imagery/colorizer/utils":function(){define(["exports"],function(q){q.getInterpolationDefines=function(C,g,l){l=!l.capabilities.textureFloatLinear;const v=[];"cubic"===C?v.push("bicubic"):"bilinear"===C&&(g?(v.push("bilinear"),v.push("nnedge")):l&&v.push("bilinear"));return v};q.getProjectionDefines=function(C){const g=[];C&&(g.push("applyProjection"),1===C.spacing[0]&&
g.push("lookupProjection"));return g};Object.defineProperty(q,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/imagery/colorizer/shadedrelief":function(){define(["./utils","../../../../webgl/rasterUtils"],function(q,C){const g={vsPath:"raster/common",fsPath:"raster/hillshade",attributes:new Map([["a_position",0],["a_texcoord",1]])};return{createProgram:function(l,v,x){const {colormap:z}=v.symbolizerParameters;x=x?[]:q.getProjectionDefines(v.transformGrid);v=q.getInterpolationDefines(v.interpolation,
!0,l.context);v=[...x,...v];null!=z&&v.push("applyColormap");l=l.painter.materialManager.getProgram(g,v);return{defines:v,program:l}},bindTextureAndUniforms:function(l,v,x,z,A=!1){const {names:y,textures:E}=x.getTextures({useProcessedTexture:A});C.setTextures(l.context,v,y,E);C.setUniforms(v,z,x.commonUniforms);v.setUniformMatrix3fv("u_dvsMat3",x.transforms.displayViewScreenMat3);l=x.symbolizerParameters;const {colormap:n,colormapOffset:b}=l;null!=n&&(x=C.getColormapUniforms(n,b),C.setUniforms(v,
z,x));l=C.getShadedReliefUniforms(l);C.setUniforms(v,z,{...l,u_scaling:1})}}})},"esri/views/2d/engine/imagery/colorizer/stretch":function(){define(["./utils","../../../../webgl/rasterUtils"],function(q,C){const g={vsPath:"raster/common",fsPath:"raster/stretch",attributes:new Map([["a_position",0],["a_texcoord",1]])};return{createProgram:function(l,v,x){const {colormap:z,bandCount:A}=v.symbolizerParameters;var y=x?[]:q.getProjectionDefines(v.transformGrid);const E=q.getInterpolationDefines(v.interpolation,
1===A,l.context);y=[...y,...E];v.isRendereredSource&&!x?y.push("noop"):null!=z&&y.push("applyColormap");l=l.painter.materialManager.getProgram(g,y);return{defines:y,program:l}},bindTextureAndUniforms:function(l,v,x,z,A=!1){const {names:y,textures:E}=x.getTextures({useProcessedTexture:A});C.setTextures(l.context,v,y,E);C.setUniforms(v,z,x.commonUniforms);v.setUniformMatrix3fv("u_dvsMat3",x.transforms.displayViewScreenMat3);l=x.symbolizerParameters;const {colormap:n,colormapOffset:b}=l;null!=n&&(x=
C.getColormapUniforms(n,b),C.setUniforms(v,z,x));l=C.getStretchUniforms(l);C.setUniforms(v,z,l)}}})},"esri/views/2d/engine/imagery/processor/rasterProcessor":function(){define("exports ./aspectProcessor ./bandArithmeticProcessor ./colormapToRGBProcessor ./compositeBandProcessor ./computeChangeProcessor ./contrastProcessor ./convolutionProcessor ./curvatureProcessor ./extractBandProcessor ./focalStatisticsProcessor ./grayscaleProcessor ./hillshadeProcessor ./localProcessor ./maskProcessor ./ndviProcessor ./remapProcessor ./reprojectProcessor ./slopeProcessor ./stretchProcessor ../../../../webgl/enums ../../../../webgl/Texture ../../../../webgl/TextureDescriptor".split(" "),
function(q,C,g,l,v,x,z,A,y,E,n,b,t,H,h,m,u,D,I,a,e,c,r){function d(w,f){const B=new r.TextureDescriptor;B.width=w;B.height=f;B.internalFormat=e.SizedPixelFormat.RGBA32F;B.samplingMode=e.TextureSamplingMode.NEAREST;B.dataType=e.PixelType.FLOAT;B.isImmutable=!0;B.wrapMode=e.TextureWrapMode.CLAMP_TO_EDGE;return B}const p=new Map;p.set("arithmetic",H);p.set("aspect",C);p.set("bandarithmetic",g);p.set("colormaptorgb",l);p.set("computechange",x);p.set("compositeband",v);p.set("convolution",A);p.set("contrastbrightness",
z);p.set("curvature",y);p.set("extractband",E);p.set("statistics",n);p.set("grayscale",b);p.set("hillshade",t);p.set("shadedrelief",t);p.set("local",H);p.set("mask",h);p.set("ndvi",m);p.set("remap",u);p.set("slope",I);p.set("stretch",a);q.createTextureDescriptor=d;q.process=function(w,f,B,F){const J=w.rasterFunction.name.toLowerCase();var K="reproject"===J?D:p.get(J.toLowerCase());if(null!=K){{const {context:T,requestRender:S,allowDelayedRender:Y}=w;var L=K.createProgram(w,F);Y&&null!=S&&!L.compiled?
(S(),L=null):(T.bindFramebuffer(B),T.setViewport(0,0,B.width,B.height),T.useProgram(L))}if(L){K.bindTextureAndUniforms(w,L,F);({interpolation:K}=F);"reproject"===J&&(F.interpolation="nearest");f.draw();var [N,R]=F.getRasterTextureSize("reproject"===J);f=d(N,R);f=new c.Texture(w.context,f);B.copyToTexture(0,0,N,R,0,0,f);"reproject"===J?(F.rasterTexture=f,F.projected=!0,F.interpolation=K):F.functionTextures[w.hasBranches?w.rasterFunction.id:0]=f}}};Object.defineProperty(q,Symbol.toStringTag,{value:"Module"})})},
"esri/views/2d/engine/imagery/processor/aspectProcessor":function(){define(["./utils"],function(q){const C={vsPath:"raster/rfx/vs",fsPath:"raster/rfx/aspect",attributes:new Map([["a_position",0],["a_texcoord",1]])};return{createProgram:function(g,l){return g.painter.materialManager.getProgram(C,[])},bindTextureAndUniforms:function(g,l,v){q.setSingleImageTextures(g,l,v);q.setCoordsAndTransforms(l);g=v.getRasterTextureSize();l.setUniform2fv("u_srcImageSize",g);v=v.getRasterCellSize();l.setUniform2fv("u_cellSize",
v)}}})},"esri/views/2d/engine/imagery/processor/utils":function(){define(["exports","../../../../webgl/rasterUtils"],function(q,C){function g(x,z,A,y){const {context:E,rasterFunction:n,hasBranches:b}=x;({raster:x}=n.parameters);x=[A.functionTextures[b?x?.id??-1:0]??A.rasterTexture];const t=["u_image"];y&&(y=C.createColormapTexture(E,y),A.functionTextures[100]=y,x.push(y),t.push("u_colormap"));C.setTextures(E,z,t,x)}const l=[1,1],v=[2,0,0,0,2,0,-1,-1,0];q.setCoordsAndTransforms=function(x){x.setUniform2fv("u_coordScale",
l);x.setUniformMatrix3fv("u_dvsMat3",v)};q.setMultipleImageTextures=function(x,z,A){var {rasters:y}=x.rasterFunction.parameters;if(y){if(2>y.length)return g(x,z,A);var E=y.filter(n=>"Constant"!==n.name).map(n=>null!=n.id&&"Identity"!==n.name?A.functionTextures[n.id]:A.rasterTexture);C.setTextures(x.context,z,["u_image","u_image1","u_image2"].slice(0,E.length),E);if(E.length!==y.length)if(2===y.length)E=y.findIndex(n=>"Constant"===n.name),x=0===E?[0,1,0,1,0,0,0,0,0]:[1,0,0,0,1,0,0,0,0],{value:y}=y[E].parameters,
z.setUniform1f("u_image1Const",y),z.setUniformMatrix3fv("u_imageSwap",x);else if(3===y.length){const n=[];y.forEach((b,t)=>"Constant"===b.name&&n.push(t));1===n.length?({value:y}=y[n[0]].parameters,z.setUniform1f("u_image1Const",y),z.setUniformMatrix3fv("u_imageSwap",0===n[0]?[0,1,0,0,0,1,1,0,0]:1===n[0]?[1,0,0,0,0,1,0,1,0]:[1,0,0,0,1,0,0,0,1])):2===n.length&&({value:x}=y[n[0]].parameters,z.setUniform1f("u_image1Const",x),{value:x}=y[n[1]].parameters,z.setUniform1f("u_image2Const",x),y=y.findIndex(b=>
"Constant"!==b.name),z.setUniformMatrix3fv("u_imageSwap",0===y?[1,0,0,0,1,0,0,0,1]:1===y?[0,1,0,1,0,0,0,0,1]:[0,0,1,1,0,0,0,1,0]))}}};q.setSingleImageTextures=g;Object.defineProperty(q,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/imagery/processor/bandArithmeticProcessor":function(){define(["./utils"],function(q){const C={vsPath:"raster/rfx/vs",fsPath:"raster/rfx/bandarithmetic",attributes:new Map([["a_position",0],["a_texcoord",1]])};return{createProgram:function(g,l){const {painter:v,
rasterFunction:x}=g,{indexType:z,isOutputRounded:A}=x.parameters;g=[z];A&&g.push("roundOutput");return v.materialManager.getProgram(C,g)},bindTextureAndUniforms:function(g,l,v){q.setSingleImageTextures(g,l,v);q.setCoordsAndTransforms(l);const {bandIndexMat3:x,adjustments:z}=g.rasterFunction.parameters;l.setUniformMatrix3fv("u_bandIndexMat3",x);l.setUniform1fv("u_adjustments",z)}}})},"esri/views/2d/engine/imagery/processor/colormapToRGBProcessor":function(){define(["./utils"],function(q){const C={vsPath:"raster/rfx/vs",
fsPath:"raster/rfx/colormap2rgb",attributes:new Map([["a_position",0],["a_texcoord",1]])};return{createProgram:function(g){({painter:g}=g);return g.materialManager.getProgram(C,[])},bindTextureAndUniforms:function(g,l,v){const {indexedColormap:x,offset:z}=g.rasterFunction.parameters;q.setSingleImageTextures(g,l,v,x);q.setCoordsAndTransforms(l);l.setUniform1f("u_colormapOffset",z);l.setUniform1f("u_colormapMaxIndex",x.length/4-1)}}})},"esri/views/2d/engine/imagery/processor/compositeBandProcessor":function(){define(["./utils"],
function(q){const C={vsPath:"raster/rfx/vs",fsPath:"raster/rfx/compositeband",attributes:new Map([["a_position",0],["a_texcoord",1]])};return{createProgram:function(g,l){l=g.rasterFunction.parameters.rasters.filter(x=>"Constant"===x.name);const v=[];l.length&&(v.push("oneConstant"),2===l.length&&v.push("twoConstant"));return g.painter.materialManager.getProgram(C,v)},bindTextureAndUniforms:function(g,l,v){q.setMultipleImageTextures(g,l,v);q.setCoordsAndTransforms(l)}}})},"esri/views/2d/engine/imagery/processor/computeChangeProcessor":function(){define(["./utils"],
function(q){const C={vsPath:"raster/rfx/vs",fsPath:"raster/rfx/computechange",attributes:new Map([["a_position",0],["a_texcoord",1]])};return{createProgram:function(g){const {painter:l,rasterFunction:v}=g,{method:x,rasters:z,isOutputRounded:A}=v.parameters;g=[x.includes("-")?x.slice(0,x.indexOf("-")):x];z.filter(y=>"Constant"===y.name).length&&g.push("oneConstant");A&&g.push("roundOutput");return l.materialManager.getProgram(C,g)},bindTextureAndUniforms:function(g,l,v){q.setMultipleImageTextures(g,
l,v);q.setCoordsAndTransforms(l);({domainRange:g}=g.rasterFunction.parameters);l.setUniform2fv("u_domainRange",g)}}})},"esri/views/2d/engine/imagery/processor/contrastProcessor":function(){define(["./utils"],function(q){const C={vsPath:"raster/rfx/vs",fsPath:"raster/rfx/contrast",attributes:new Map([["a_position",0],["a_texcoord",1]])};return{createProgram:function(g,l){return g.painter.materialManager.getProgram(C,[])},bindTextureAndUniforms:function(g,l,v){q.setSingleImageTextures(g,l,v);q.setCoordsAndTransforms(l);
const {contrastOffset:x,brightnessOffset:z}=g.rasterFunction.parameters;l.setUniform1f("u_contrastOffset",x);l.setUniform1f("u_brightnessOffset",z)}}})},"esri/views/2d/engine/imagery/processor/convolutionProcessor":function(){define(["./utils"],function(q){const C={vsPath:"raster/rfx/vs",fsPath:"raster/rfx/convolution",attributes:new Map([["a_position",0],["a_texcoord",1]])};return{createProgram:function(g,l){const {painter:v,rasterFunction:x}=g,{kernelRows:z,kernelCols:A}=x.parameters;return v.materialManager.getProgram(C,
[{name:"rows",value:z},{name:"cols",value:A}])},bindTextureAndUniforms:function(g,l,v){q.setSingleImageTextures(g,l,v);q.setCoordsAndTransforms(l);l.setUniform2fv("u_srcImageSize",[v.width,v.height]);const {kernel:x,clampRange:z}=g.rasterFunction.parameters;l.setUniform1fv("u_kernel",x);l.setUniform2fv("u_clampRange",z)}}})},"esri/views/2d/engine/imagery/processor/curvatureProcessor":function(){define(["./utils"],function(q){const C={vsPath:"raster/rfx/vs",fsPath:"raster/rfx/curvature",attributes:new Map([["a_position",
0],["a_texcoord",1]])};return{createProgram:function(g,l){const {painter:v,rasterFunction:x}=g;({curvatureType:g}=x.parameters);return v.materialManager.getProgram(C,[g])},bindTextureAndUniforms:function(g,l,v){q.setSingleImageTextures(g,l,v);q.setCoordsAndTransforms(l);const x=v.getRasterTextureSize();l.setUniform2fv("u_srcImageSize",x);({zFactor:g}=g.rasterFunction.parameters);v=v.getRasterCellSize();l.setUniform1f("u_zlFactor",200*g/v[0]/v[1])}}})},"esri/views/2d/engine/imagery/processor/extractBandProcessor":function(){define(["./utils"],
function(q){const C={vsPath:"raster/rfx/vs",fsPath:"raster/rfx/extractband",attributes:new Map([["a_position",0],["a_texcoord",1]])};return{createProgram:function(g,l){return g.painter.materialManager.getProgram(C,[])},bindTextureAndUniforms:function(g,l,v){q.setSingleImageTextures(g,l,v);q.setCoordsAndTransforms(l);({bandIndexMat3:g}=g.rasterFunction.parameters);l.setUniformMatrix3fv("u_bandIndexMat3",g)}}})},"esri/views/2d/engine/imagery/processor/focalStatisticsProcessor":function(){define(["./utils"],
function(q){const C={vsPath:"raster/rfx/vs",fsPath:"raster/rfx/focalstatistics",attributes:new Map([["a_position",0],["a_texcoord",1]])};return{createProgram:function(g,l){const {painter:v,rasterFunction:x}=g,{kernelRows:z,kernelCols:A,fillNoDataOnly:y,statisticsType:E}=x.parameters;g=[{name:"rows",value:z},{name:"cols",value:A},E];y&&g.push("fill");return v.materialManager.getProgram(C,g)},bindTextureAndUniforms:function(g,l,v){q.setSingleImageTextures(g,l,v);q.setCoordsAndTransforms(l);l.setUniform2fv("u_srcImageSize",
[v.width,v.height]);({clampRange:g}=g.rasterFunction.parameters);l.setUniform2fv("u_clampRange",g)}}})},"esri/views/2d/engine/imagery/processor/grayscaleProcessor":function(){define(["./utils"],function(q){const C={vsPath:"raster/rfx/vs",fsPath:"raster/rfx/grayscale",attributes:new Map([["a_position",0],["a_texcoord",1]])};return{createProgram:function(g,l){return g.painter.materialManager.getProgram(C,[])},bindTextureAndUniforms:function(g,l,v){q.setSingleImageTextures(g,l,v);q.setCoordsAndTransforms(l);
({weights:g}=g.rasterFunction.parameters);l.setUniform3fv("u_weights",g)}}})},"esri/views/2d/engine/imagery/processor/hillshadeProcessor":function(){define(["./utils"],function(q){const C={vsPath:"raster/rfx/vs",fsPath:"raster/hillshade",attributes:new Map([["a_position",0],["a_texcoord",1]])};return{createProgram:function(g,l){({indexedColormap:l}=g.rasterFunction.parameters);const v=[];l?.length&&v.push("applyColormap");return g.painter.materialManager.getProgram(C,v)},bindTextureAndUniforms:function(g,
l,v){const x=g.rasterFunction.parameters,{indexedColormap:z}=x;q.setSingleImageTextures(g,l,v,z);q.setCoordsAndTransforms(l);g=v.getRasterTextureSize();l.setUniform2fv("u_srcImageSize",g);var A=v.getRasterCellSize();l.setUniform2fv("u_cellSize",A);({pixelSizeFactor:v}=x);if(0===v)l.setUniform2fv("u_factor",[x.factor[0]/A[0],x.factor[1]/A[1]]);else{const {zFactor:y,pixelSizePower:E,gcsFactor:n}=x;g=A[0]*n;A=A[1]*n;l.setUniform2fv("u_factor",[(y+g**E*v)/(8*g),(y+A**E*v)/(8*A)])}l.setUniform1i("u_hillshadeType",
x.hillshadeType);l.setUniform1fv("u_sinZcosAs",x.sinZcosAs);l.setUniform1fv("u_sinZsinAs",x.sinZsinAs);l.setUniform1fv("u_cosZs",x.cosZs);l.setUniform1fv("u_weights",x.weights);l.setUniform1f("u_opacity",1);l.setUniform1i("u_flipY",0);l.setUniform1f("u_scaling",255);l.setUniform1f("u_minValue",x.minValue);l.setUniform1f("u_maxValue",x.maxValue);z&&(l.setUniform1f("u_colormapOffset",x.offset),l.setUniform1f("u_colormapMaxIndex",z.length/4-1))}}})},"esri/views/2d/engine/imagery/processor/localProcessor":function(){define(["./utils"],
function(q){const C={vsPath:"raster/rfx/vs",fsPath:"raster/rfx/local",attributes:new Map([["a_position",0],["a_texcoord",1]])};return{createProgram:function(g){const {painter:l,rasterFunction:v}=g,{imageCount:x,operationName:z,rasters:A,isOutputRounded:y}=v.parameters;g=[z.toLowerCase()];2===x&&g.push("twoImages");const E=A.filter(n=>"Constant"===n.name);E.length&&(g.push("oneConstant"),2===E.length&&g.push("twoConstant"));y&&g.push("roundOutput");return l.materialManager.getProgram(C,g)},bindTextureAndUniforms:function(g,
l,v){q.setMultipleImageTextures(g,l,v);q.setCoordsAndTransforms(l);({domainRange:g}=g.rasterFunction.parameters);l.setUniform2fv("u_domainRange",g)}}})},"esri/views/2d/engine/imagery/processor/maskProcessor":function(){define(["./utils"],function(q){const C={vsPath:"raster/rfx/vs",fsPath:"raster/rfx/mask",attributes:new Map([["a_position",0],["a_texcoord",1]])};return{createProgram:function(g,l){const {painter:v,rasterFunction:x}=g;return v.materialManager.getProgram(C,1<x.parameters.bandCount?["multiBand"]:
[])},bindTextureAndUniforms:function(g,l,v){q.setSingleImageTextures(g,l,v);q.setCoordsAndTransforms(l);const {includedRanges:x,noDataValues:z}=g.rasterFunction.parameters;l.setUniform1fv("u_includedRanges",x);l.setUniform1fv("u_noDataValues",z)}}})},"esri/views/2d/engine/imagery/processor/ndviProcessor":function(){define(["./utils"],function(q){const C={vsPath:"raster/rfx/vs",fsPath:"raster/rfx/ndvi",attributes:new Map([["a_position",0],["a_texcoord",1]])};return{createProgram:function(g,l){const {painter:v,
rasterFunction:x}=g;return v.materialManager.getProgram(C,x.parameters.scaled?["scaled"]:[])},bindTextureAndUniforms:function(g,l,v){q.setSingleImageTextures(g,l,v);q.setCoordsAndTransforms(l);({bandIndexMat3:g}=g.rasterFunction.parameters);l.setUniformMatrix3fv("u_bandIndexMat3",g)}}})},"esri/views/2d/engine/imagery/processor/remapProcessor":function(){define(["./utils"],function(q){const C={vsPath:"raster/rfx/vs",fsPath:"raster/rfx/remap",attributes:new Map([["a_position",0],["a_texcoord",1]])};
return{createProgram:function(g,l){return g.painter.materialManager.getProgram(C,[])},bindTextureAndUniforms:function(g,l,v){q.setSingleImageTextures(g,l,v);q.setCoordsAndTransforms(l);const {noDataRanges:x,rangeMaps:z,allowUnmatched:A,clampRange:y}=g.rasterFunction.parameters;l.setUniform1fv("u_noDataRanges",x);l.setUniform1fv("u_rangeMaps",z);l.setUniform1f("u_unmatchMask",A?1:0);l.setUniform2fv("u_clampRange",y)}}})},"esri/views/2d/engine/imagery/processor/reprojectProcessor":function(){define(["../../../../../core/libs/gl-matrix-2/factories/vec2f64",
"../../../../webgl/rasterUtils"],function(q,C){const g={vsPath:"raster/common",fsPath:"raster/reproject",attributes:new Map([["a_position",0],["a_texcoord",1]])};return{createProgram:function(l,v){const {painter:x}=l,z=[],{interpolation:A,transformGrid:y}=v;l=l.rasterFunction?.parameters;"cubic"===A?z.push("bicubic"):"bilinear"===A&&(z.push("bilinear"),l?.requireNNEdge&&z.push("nnedge"));y&&(z.push("applyProjection"),1===y.spacing[0]&&z.push("lookupProjection"));return x.materialManager.getProgram(g,
z)},bindTextureAndUniforms:function(l,v,x){const {names:z,textures:A}=x.getTextures({forProcessing:!0});C.setTextures(l.context,v,z,A);v.setUniform1f("u_scale",1);v.setUniform2fv("u_offset",[0,0]);v.setUniform2fv("u_coordScale",[1,1]);v.setUniformMatrix3fv("u_dvsMat3",[2,0,0,0,2,0,-1,-1,0]);v.setUniform1i("u_flipY",0);v.setUniform1f("u_opacity",1);const {width:y,height:E,source:n,transformGrid:b}=x;v.setUniform2fv("u_srcImageSize",[n.width,n.height]);v.setUniform2fv("u_targetImageSize",[y,E]);v.setUniform2fv("u_transformSpacing",
b?b.spacing:q.ZEROS);v.setUniform2fv("u_transformGridSize",b?b.size:q.ZEROS)}}})},"esri/views/2d/engine/imagery/processor/slopeProcessor":function(){define(["./utils"],function(q){const C={vsPath:"raster/rfx/vs",fsPath:"raster/rfx/slope",attributes:new Map([["a_position",0],["a_texcoord",1]])};return{createProgram:function(g,l){const {painter:v,rasterFunction:x}=g,{slopeType:z,isOutputRounded:A}=x.parameters;g=[];"percent-rise"===z&&g.push("percentRise");A&&g.push("roundOutput");return v.materialManager.getProgram(C,
g)},bindTextureAndUniforms:function(g,l,v){q.setSingleImageTextures(g,l,v);q.setCoordsAndTransforms(l);const x=v.getRasterTextureSize();l.setUniform2fv("u_srcImageSize",x);v=v.getRasterCellSize();l.setUniform2fv("u_cellSize",v);const {zFactor:z,slopeType:A,pixelSizePower:y,pixelSizeFactor:E}=g.rasterFunction.parameters;l.setUniform1f("u_zFactor",z);l.setUniform1f("u_pixelSizePower","adjusted"===A?y:0);l.setUniform1f("u_pixelSizeFactor","adjusted"===A?E:0)}}})},"esri/views/2d/engine/imagery/processor/stretchProcessor":function(){define(["./utils"],
function(q){const C={vsPath:"raster/rfx/vs",fsPath:"raster/rfx/stretch",attributes:new Map([["a_position",0],["a_texcoord",1]])};return{createProgram:function(g,l){const {useGamma:v,bandCount:x,isOutputRounded:z}=g.rasterFunction.parameters;l=[];v&&l.push("useGamma");1<x&&l.push("multiBand");z&&l.push("roundOutput");return g.painter.materialManager.getProgram(C,l)},bindTextureAndUniforms:function(g,l,v){q.setSingleImageTextures(g,l,v);q.setCoordsAndTransforms(l);const {width:x,height:z}=v;g=g.rasterFunction.parameters;
l.setUniform2fv("u_srcImageSize",[x,z]);l.setUniform1f("u_minOutput",g.outMin);l.setUniform1f("u_maxOutput",g.outMax);l.setUniform1fv("u_factor",g.factor);l.setUniform1fv("u_minCutOff",g.minCutOff);l.setUniform1fv("u_maxCutOff",g.maxCutOff);l.setUniform1fv("u_gamma",g.gamma);l.setUniform1fv("u_gammaCorrection",g.gammaCorrection)}}})},"esri/views/2d/engine/imagery/RasterTile":function(){define(["exports","../../../../core/libs/gl-matrix-2/factories/mat3f32","./RasterBitmap","../webgl/TiledDisplayObject"],
function(q,C,g,l){class v extends l.TiledDisplayObject{constructor(x,z,A,y,E,n,b=null){super(x,z,A,y,E,n);this.bitmap=null;this.bitmap=new g.RasterBitmap(b,null,null);this.bitmap.coordScale=[E,n];this.bitmap.once("isReady",()=>this.ready())}destroy(){super.destroy();this.bitmap.destroy();this.stage=this.bitmap=null}set stencilRef(x){this.bitmap.stencilRef=x}get stencilRef(){return this.bitmap.stencilRef}setTransform(x){super.setTransform(x);this.bitmap.transforms.displayViewScreenMat3=this.transforms.displayViewScreenMat3}_createTransforms(){return{displayViewScreenMat3:C.create(),
tileMat3:C.create()}}onAttach(){this.bitmap.stage=this.stage}onDetach(){this.bitmap.stage=null}}q.RasterTile=v;Object.defineProperty(q,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/imagery/BaseImageryTileSubView2D":function(){define("exports ../../../../chunks/tslib.es6 ../../../../geometry ../../../../core/Accessor ../../../../core/Logger ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ../../../../core/support/UpdatingHandles ../../../../geometry/Point ../../../../layers/support/PixelBlock ../../../../layers/support/TileInfo ../../../../layers/support/rasterDatasets/RawBlockCache ../../../../layers/support/rasterFunctions/rasterProjectionHelper ../../tiling/TileInfoView ../../tiling/TileKey ../../tiling/TileQueue ../../tiling/TileStrategy ../../engine/webgl/definitions ../../../support/Scheduler ../../../webgl/capabilities ../../../../geometry/Extent".split(" "),
function(q,C,g,l,v,x,z,A,y,E,n,b,t,H,h,m,u,D,I,a,e,c,r,d,p){const w=[0,0];q.BaseImageryTileSubView2D=class extends l{constructor(){super(...arguments);this._updatingHandles=new b.UpdatingHandles;this._blockCacheRegistryId=this._blockCacheRegistryUrl=this._fetchQueue=this._tileInfoView=this._tileStrategy=this._emptyTilePixelBlock=null;this._srcResolutions=[];this.previousLOD=null;this._needBlockCacheUpdate=!1;this._abortController=this._symbolizerParams=this._globalSymbolizerParams=null;this._isCustomTilingScheme=
!1;this._maxIndexedColormapSize=0;this._rasterFunctionState="na";this.attached=this._globalUpdateRequested=!1;this.timeExtent=null;this.redrawOrRefetch=z.debounce(async(f={})=>{const B=this._rasterFunctionState;f.reprocess&&(await this._updatingHandles.addPromise(this.layer.updateRasterFunction()),this.updateRasterFunctionParameters());if(this.previousLOD&&!this.layerView.suspended){var F=this._rasterFunctionState,{type:J}=this;return f.refetch||"raster"!==J&&f.reprocess||"cpu"===F||"cpu"===B?this._updatingHandles.addPromise(this.doRefresh()):
this._updatingHandles.addPromise(this._redrawImage(f.signal))}})}destroy(){this._updatingHandles.destroy()}get useWebGLForProcessing(){return this._get("useWebGLForProcessing")??!0}set useWebGLForProcessing(f){this._set("useWebGLForProcessing",f)}get useProgressiveUpdate(){return this._get("useProgressiveUpdate")??!0}set useProgressiveUpdate(f){if(this._tileStrategy&&this.useProgressiveUpdate!==f){this._tileStrategy.destroy();this.container.removeAllChildren();const B=this._getCacheSize(f);this._tileStrategy=
new e({cachePolicy:"purge",acquireTile:F=>this.acquireTile(F),releaseTile:F=>this.releaseTile(F),cacheSize:B,tileInfoView:this._tileInfoView});this._set("useProgressiveUpdate",f);this.layerView.requestUpdate()}}update(f){this._fetchQueue.pause();this._fetchQueue.state=f.state;this._tileStrategy.update(f);this._fetchQueue.resume();const {extent:B,resolution:F,scale:J}=f.state;f=this._tileInfoView.getClosestInfoForScale(J);if(this.layer.raster){if(!this.useProgressiveUpdate||this._needBlockCacheUpdate){const K=
this._srcResolutions[f.level],L=B.toJSON?B:p.fromJSON(B);m.update(this._blockCacheRegistryUrl,this._blockCacheRegistryId,L,F,K,this.layer.raster.ioConfig.sampling)}this._needBlockCacheUpdate=!1;this.previousLOD?.level!==f.level&&(this.previousLOD=f,null==this._symbolizerParams||this.layerView.hasTilingEffects||this._updateSymbolizerParams(),this._tileStrategy.updateCacheSize(0))}}moveEnd(){if(this.layerView.hasTilingEffects||!this.useProgressiveUpdate)this._abortController&&this._abortController.abort(),
this._abortController=new AbortController,0===this._fetchQueue.length&&this._redrawImage(this._abortController.signal).then(()=>{this._globalUpdateRequested=!1;this.layerView.requestUpdate()});const f=this._getCacheSize(this.useProgressiveUpdate);this._tileStrategy.updateCacheSize(f);this.layerView.requestUpdate()}get updating(){return this._globalUpdateRequested||this._updatingHandles?.updating}attach(){this._maxIndexedColormapSize=4*(d.getWebGLCapabilities().maxTextureSize||4096);this._initializeTileInfo();
this._tileInfoView=new D(this.layerView.tileInfo,this.layerView.fullExtent);var f=this._computeFetchConcurrency();this._fetchQueue=new a({tileInfoView:this._tileInfoView,concurrency:f,process:(B,F)=>this._fetchTile(B,F),priority:r.TaskPriority.MAPVIEW_FETCH_QUEUE,scheduler:this.scheduler});f=this._getCacheSize(this.useProgressiveUpdate);this._tileStrategy=new e({cachePolicy:"purge",acquireTile:B=>this.acquireTile(B),releaseTile:B=>this.releaseTile(B),cacheSize:f,tileInfoView:this._tileInfoView});
this._updateBlockCacheRegistry()}detach(){this._tileStrategy.destroy();this._fetchQueue.clear();this.container.removeAllChildren();this._fetchQueue=this._tileStrategy=this._tileInfoView=null;m.unregister(this._blockCacheRegistryUrl,this._blockCacheRegistryId);this._blockCacheRegistryUrl=this._blockCacheRegistryId=null}acquireTile(f){f=this.container.createTile(f);this._updatingHandles.addPromise(this._enqueueTileFetch(f));this.layerView.requestUpdate();this._needBlockCacheUpdate=!0;this._globalUpdateRequested=
this.layerView.hasTilingEffects||!this.useProgressiveUpdate;return f}releaseTile(f){this._fetchQueue.abort(f.key.id);this.container.removeChild(f);f.once("detach",()=>{f.destroy();this.layerView.requestUpdate()});this.layerView.requestUpdate()}createEmptyTilePixelBlock(f=null){const B=null==f||f.join(",")===this._tileInfoView.tileInfo.size.join(",");if(B&&null!=this._emptyTilePixelBlock)return this._emptyTilePixelBlock;f=f||this._tileInfoView.tileInfo.size;const [F,J]=f;f=new H({width:F,height:J,
pixels:[new Uint8Array(F*J)],mask:new Uint8Array(F*J),pixelType:"u8"});B&&(this._emptyTilePixelBlock=f);return f}_getBandIds(){if(!("rasterFunctionChain"in this.container&&this.container.rasterFunctionChain))return this.layer.bandIds;const {bandIds:f,raster:B}=this.layer,F="rasterFunction"in B?B.rasterFunction.rawInputBandIds:null;return f?.length&&F?.length&&1!==B.rasterInfo.bandCount?f.map(J=>F[Math.min(J,F.length-1)]):f||F}updateRasterFunctionParameters(){}_fetchTile(f,B){B=this._getFetchOptions(f.level,
B.signal);return this.fetchTile(f,B)}_getFetchOptions(f,B){const F=this.canUseWebGLForProcessing(),{layerView:J}=this,{tileInfo:K}=J,L=!K.isWrappable&&null!=u.getWorldWidth(J.view.spatialReference);return{allowPartialFill:!0,datumTransformation:J.datumTransformation,interpolation:F?"nearest":this.layer.interpolation,registryId:this._blockCacheRegistryId,requestRawData:F&&this.layer.raster.hasUniqueSourceStorageInfo,skipRasterFunction:"raster"===this.type&&null!=this.container.rasterFunctionChain,
signal:B,srcResolution:this._srcResolutions[f],timeExtent:J.timeExtent,tileInfo:K,disableWrapAround:L}}_getCacheSize(f){return f?40:0}_initializeTileInfo(){const {layerView:f}=this;var B=f.view.spatialReference;if(this._canUseLayerLODs()){const {origin:S,lods:Y}=this.layer.tileInfo;var F=Y.map(({scale:X})=>X);B=h.create({spatialReference:B,size:c.tileSize,scales:F,origin:S});f.set("tileInfo",B);this._srcResolutions=Y.map(({resolution:X})=>({x:X,y:X}))}else{var {scales:J,srcResolutions:K,isCustomTilingScheme:L}=
u.computeProjectedScales(this.layer.serviceRasterInfo,B,{tileSize:c.tileSize,alignGlobalDatasetWithAGOL:!0,limitToSrcResolution:!1});F=h.create({spatialReference:B,size:c.tileSize,scales:J});var N=0===F.origin.x;x.assertIsSome(f.fullExtent);var {xmin:R,ymax:T}=f.fullExtent;if(N||L&&F.origin.x>R)F.origin=new t({x:R,y:T,spatialReference:B});this._isCustomTilingScheme=L;f.set("tileInfo",F);this._srcResolutions=K??[]}}_canUseLayerLODs(){const {layer:f,layerView:B}=this;if("Map"!==f.raster.tileType)return!1;
const {lods:F}=f.tileInfo,J=B.view.constraints?.effectiveLODs;return J?.length===F.length&&J.every(({scale:K},L)=>.001>Math.abs(K-F[L].scale))}_computeFetchConcurrency(){var {blockBoundary:f}=this.layer.serviceRasterInfo.storageInfo;f=f[f.length-1];return 64<(f.maxCol-f.minCol+1)*(f.maxRow-f.minRow+1)?2:10}async _enqueueTileFetch(f,B){if(!this._fetchQueue.has(f.key.id)){try{const F=await this._fetchQueue.push(f.key),J=this._getBandIds();let K=!this.useProgressiveUpdate||this.layerView.hasTilingEffects&&
!this._globalSymbolizerParams;if(this._globalUpdateRequested&&!this.layerView.moving&&0===this._fetchQueue.length){K=!1;try{await this._redrawImage(this._abortController?.signal)}catch(R){z.isAbortError(R)&&v.getLogger(this).error(R)}this._globalUpdateRequested=!1}!this.canUseWebGLForProcessing()&&"rasterVF"!==this.type||this.layerView.hasTilingEffects||null!=this._symbolizerParams||this._updateSymbolizerParams();const L=this._tileInfoView.getTileCoords(w,f.key),N=this._tileInfoView.getTileResolution(f.key);
await this.updateTileSource(f,{source:F,symbolizerParams:this._symbolizerParams,globalSymbolizerParams:this._globalSymbolizerParams,suspended:K,bandIds:J,coords:L,resolution:N});f.once("attach",()=>this.layerView.requestUpdate());this.container.addChild(f)}catch(F){z.isAbortError(F)||v.getLogger(this).error(F)}this.layerView.requestUpdate()}}async _redrawImage(f){0!==this.container.children.length&&(await this.layer.updateRenderer(),this.layerView.hasTilingEffects?await this._updateGlobalSymbolizerParams(f):
(this._updateSymbolizerParams(),this._globalSymbolizerParams=null),f=this.container.children.map(async B=>this.updateTileSymbolizerParameters(B,{local:this._symbolizerParams,global:this._globalSymbolizerParams})),await Promise.allSettled(f),this.container.requestRender())}async _updateGlobalSymbolizerParams(f){f=this._getFetchOptions(this.previousLOD.level,f);f=await this.layer.fetchPixels(this.layerView.view.extent,this.layerView.view.width,this.layerView.view.height,{...f,interpolation:"nearest",
requestRawData:!1,skipRasterFunction:!1});if(f?.pixelBlock){var {resolution:B}=this.previousLOD,F=this._getBandIds();f=this.layer.symbolizer.generateWebGLParameters({pixelBlock:f.pixelBlock.extractBands(F),isGCS:this.layerView.view.spatialReference.isGeographic,resolution:{x:B,y:B},bandIds:F});!this.canUseWebGLForProcessing()&&f&&"stretch"===f.type&&this.layer.renderer&&"raster-stretch"===this.layer.renderer.type&&(f.factor=f.factor.map(J=>255*J),f.outMin=Math.round(255*f.outMin),f.outMax=Math.round(255*
f.outMax));this._globalSymbolizerParams=f}}_updateSymbolizerParams(){const {resolution:f}=this.previousLOD,B=this._getBandIds();this._symbolizerParams=this.layer.symbolizer.generateWebGLParameters({pixelBlock:null,isGCS:this.layerView.view.spatialReference.isGeographic,resolution:{x:f,y:f},bandIds:B})}_updateBlockCacheRegistry(f=!1){const {layer:B,layerView:F}=this,{raster:J}=B;var {multidimensionalDefinition:K}=B.normalizeRasterFetchOptions({multidimensionalDefinition:B.multidimensionalDefinition,
timeExtent:F.timeExtent});K=J.rasterInfo.multidimensionalInfo?J.getSliceIndex(K):null;K=m.getRasterId(J.rasterId,K);if(K!==this._blockCacheRegistryUrl){null!=this._blockCacheRegistryUrl&&m.unregister(this._blockCacheRegistryUrl,this._blockCacheRegistryId);this._blockCacheRegistryId=m.register(K,J.rasterInfo);if(f){({view:f}=F);const L=this._tileInfoView.getClosestInfoForScale(f.scale);m.update(K,this._blockCacheRegistryId,f.extent,f.resolution,this._srcResolutions[L.level],J.ioConfig.sampling)}this._blockCacheRegistryUrl=
K}}async doRefresh(){if(this.attached&&this.previousLOD&&!this.layerView.suspended){await this.layer.updateRenderer();this.layerView.hasTilingEffects||this._updateSymbolizerParams();this._updateBlockCacheRegistry(!0);this._fetchQueue.reset();var f=[];this._globalUpdateRequested=this.layerView.hasTilingEffects||!this.useProgressiveUpdate;this._tileStrategy.refresh(B=>f.push(this._enqueueTileFetch(B)));await this._updatingHandles.addPromise(Promise.allSettled(f))}}};C.__decorate([A.property()],q.BaseImageryTileSubView2D.prototype,
"_globalUpdateRequested",void 0);C.__decorate([A.property()],q.BaseImageryTileSubView2D.prototype,"attached",void 0);C.__decorate([A.property()],q.BaseImageryTileSubView2D.prototype,"container",void 0);C.__decorate([A.property()],q.BaseImageryTileSubView2D.prototype,"layer",void 0);C.__decorate([A.property()],q.BaseImageryTileSubView2D.prototype,"layerView",void 0);C.__decorate([A.property()],q.BaseImageryTileSubView2D.prototype,"scheduler",void 0);C.__decorate([A.property()],q.BaseImageryTileSubView2D.prototype,
"type",void 0);C.__decorate([A.property()],q.BaseImageryTileSubView2D.prototype,"useWebGLForProcessing",null);C.__decorate([A.property()],q.BaseImageryTileSubView2D.prototype,"useProgressiveUpdate",null);C.__decorate([A.property()],q.BaseImageryTileSubView2D.prototype,"timeExtent",void 0);C.__decorate([A.property()],q.BaseImageryTileSubView2D.prototype,"updating",null);q.BaseImageryTileSubView2D=C.__decorate([n.subclass("esri.views.2d.layers.imagery.BaseImageryTileSubView2D")],q.BaseImageryTileSubView2D);
Object.defineProperty(q,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/PixelBlock":function(){define("../../chunks/tslib.es6 ../../core/Error ../../core/JSONSupport ../../core/lang ../../core/Logger ../../core/accessorSupport/decorators/property ../../core/accessorSupport/decorators/cast ../../core/accessorSupport/decorators/subclass ./SimpleBandStatistics ./rasterFormats/pixelRangeUtils".split(" "),function(q,C,g,l,v,x,z,A,y,E){var n;g=n=class extends g.JSONSupport{static createEmptyBand(b,
t){return new (n.getPixelArrayConstructor(b))(t)}static combineBandMasks(b){if(2>b.length)return b[0];const t=b[0].length,H=(new Uint8Array(t)).fill(255);for(let h=0;h<b.length;h++){const m=b[h];for(let u=0;u<t;u++)m[u]||(H[u]=0)}return H}static getPixelArrayConstructor(b){let t;switch(b){case "u1":case "u2":case "u4":case "u8":t=Uint8Array;break;case "u16":t=Uint16Array;break;case "u32":t=Uint32Array;break;case "s8":t=Int8Array;break;case "s16":t=Int16Array;break;case "s32":t=Int32Array;break;case "f32":t=
Float32Array;break;case "f64":t=Float64Array;break;case "c64":case "c128":case "unknown":t=Float32Array}return t}constructor(b){super(b);this.height=this.width=null;this.pixelType="f32";this.mask=this.validPixelCount=null;this.premultiplyAlpha=this.maskIsAlpha=!1;this.statistics=null;this.depthCount=1}castPixelType(b){if(!b)return"f32";b=b.toLowerCase();["u1","u2","u4"].includes(b)?b="u8":"unknown u8 s8 u16 s16 u32 s32 f32 f64".split(" ").includes(b)||(b="f32");return b}getPlaneCount(){return this.pixels?.length}addData(b){if(!b.pixels||
b.pixels.length!==this.width*this.height)throw new C("pixelblock:invalid-or-missing-pixels","add data requires valid pixels array that has same length defined by pixel block width * height");this.pixels||(this.pixels=[]);this.statistics||(this.statistics=[]);this.pixels.push(b.pixels);this.statistics.push(b.statistics??new y.SimpleBandStatistics)}getAsRGBA(){const b=new ArrayBuffer(this.width*this.height*4);switch(this.pixelType){case "s8":case "s16":case "u16":case "s32":case "u32":case "f32":case "f64":this._fillFromNon8Bit(b);
break;default:this._fillFrom8Bit(b)}return new Uint8ClampedArray(b)}getAsRGBAFloat(){const b=new Float32Array(this.width*this.height*4);this._fillFrom32Bit(b);return b}updateStatistics(){if(this.pixels){this.statistics=this.pixels.map(H=>{var h=this.mask;let m=Infinity,u=-Infinity;const D=H.length;let I,a=0;if(null!=h)for(I=0;I<D;I++)h[I]&&(a=H[I],m=a<m?a:m,u=a>u?a:u);else for(I=0;I<D;I++)a=H[I],m=a<m?a:m,u=a>u?a:u;return new y.SimpleBandStatistics(m,u)});var b=this.mask,t=0;if(null!=b)for(let H=
0;H<b.length;H++)b[H]&&t++;else t=this.width*this.height;this.validPixelCount=t}}clamp(b){if(b&&"f64"!==b&&"f32"!==b&&this.pixels){var [t,H]=E.getPixelValueRange(b),h=this.pixels,m=this.width*this.height,u=h.length,D=[];for(let c=0;c<u;c++){var I=n.createEmptyBand(b,m);var a=h[c];for(let r=0;r<m;r++){var e=a[r];I[r]=e>H?H:e<t?t:e}D.push(I)}this.pixels=D;this.pixelType=b}}extractBands(b){const {pixels:t,statistics:H}=this;if(null==b||0===b.length||!t||0===t.length)return this;var h=t.length;const m=
b.some(c=>c>=t.length),u=h===b.length&&!b.some((c,r)=>c!==r);if(m||u)return this;h=this.bandMasks?.length===h?b.map(c=>this.bandMasks[c]):void 0;let {mask:D,validPixelCount:I}=this;const {width:a,height:e}=this;h?.length&&(D=n.combineBandMasks(h),I=D.filter(c=>!!c).length);return new n({pixelType:this.pixelType,width:a,height:e,mask:D,bandMasks:h,validPixelCount:I,maskIsAlpha:this.maskIsAlpha,pixels:b.map(c=>t[c]),statistics:H&&b.map(c=>H[c])})}clone(){const b=new n({width:this.width,height:this.height,
pixelType:this.pixelType,maskIsAlpha:this.maskIsAlpha,validPixelCount:this.validPixelCount});null!=this.mask&&(b.mask=new Uint8Array(this.mask));this.bandMasks&&(b.bandMasks=this.bandMasks.map(h=>new Uint8Array(h)));let t;const H=n.getPixelArrayConstructor(this.pixelType);if(this.pixels&&0<this.pixels.length){b.pixels=[];const h=!!this.pixels[0].slice;for(t=0;t<this.pixels.length;t++)b.pixels[t]=h?this.pixels[t].slice():new H(this.pixels[t])}if(this.statistics)for(b.statistics=[],t=0;t<this.statistics.length;t++)b.statistics[t]=
l.clone(this.statistics[t]);b.premultiplyAlpha=this.premultiplyAlpha;return b}_fillFrom8Bit(b){const {mask:t,maskIsAlpha:H,premultiplyAlpha:h,pixels:m}=this;if(b&&m?.length){var u,D;var I=u=D=m[0];3<=m.length?(u=m[1],D=m[2]):2===m.length&&(u=m[1]);var a=new Uint32Array(b),e=this.width*this.height;if(I.length!==e)v.getLogger(this).error("getAsRGBA()","Unable to convert to RGBA. The pixelblock is invalid.");else if(null!=t&&t.length===e)if(H)for(b=0;b<e;b++){const c=t[b];if(c){const r=c/255;a[b]=h?
c<<24|D[b]*r<<16|u[b]*r<<8|I[b]*r:c<<24|D[b]<<16|u[b]<<8|I[b]}}else for(b=0;b<e;b++)t[b]&&(a[b]=-16777216|D[b]<<16|u[b]<<8|I[b]);else for(b=0;b<e;b++)a[b]=-16777216|D[b]<<16|u[b]<<8|I[b]}else v.getLogger(this).error("getAsRGBA()","Unable to convert to RGBA. The input pixel block is empty.")}_fillFromNon8Bit(b){const {pixels:t,mask:H,statistics:h}=this;if(b&&t?.length){var m=this.pixelType,u=1,D=0;u=1;if(h&&0<h.length){for(var I of h)null!=I.minValue&&(D=Math.min(D,I.minValue)),null!=I.maxValue&&null!=
I.minValue&&(u=Math.max(u,I.maxValue-I.minValue));u=255/u}else u=255,"s8"===m?(D=-128,u=127):"u16"===m?u=65535:"s16"===m?(D=-32768,u=32767):"u32"===m?u=4294967295:"s32"===m?(D=-2147483648,u=2147483647):"f32"===m?(D=-3.4*1E39,u=3.4*1E39):"f64"===m&&(D=-Number.MAX_VALUE,u=Number.MAX_VALUE),u=255/(u-D);b=new Uint32Array(b);m=this.width*this.height;var a,e,c;I=a=e=t[0];if(I.length!==m)return v.getLogger(this).error("getAsRGBA()","Unable to convert to RGBA. The pixelblock is invalid.");if(2<=t.length)if(a=
t[1],3<=t.length&&(e=t[2]),null!=H&&H.length===m)for(c=0;c<m;c++)H[c]&&(b[c]=-16777216|(e[c]-D)*u<<16|(a[c]-D)*u<<8|(I[c]-D)*u);else for(c=0;c<m;c++)b[c]=-16777216|(e[c]-D)*u<<16|(a[c]-D)*u<<8|(I[c]-D)*u;else if(null!=H&&H.length===m)for(c=0;c<m;c++)a=(I[c]-D)*u,H[c]&&(b[c]=-16777216|a<<16|a<<8|a);else for(c=0;c<m;c++)a=(I[c]-D)*u,b[c]=-16777216|a<<16|a<<8|a}else v.getLogger(this).error("getAsRGBA()","Unable to convert to RGBA. The input pixel block is empty.")}_fillFrom32Bit(b){const {pixels:t,mask:H}=
this;if(!b||!t?.length)return v.getLogger(this).error("getAsRGBAFloat()","Unable to convert to RGBA. The input pixel block is empty.");let h,m,u,D;h=m=u=t[0];3<=t.length?(m=t[1],u=t[2]):2===t.length&&(m=t[1]);const I=this.width*this.height;if(h.length!==I)return v.getLogger(this).error("getAsRGBAFloat()","Unable to convert to RGBA. The pixelblock is invalid.");let a=0;if(null!=H&&H.length===I)for(D=0;D<I;D++)b[a++]=h[D],b[a++]=m[D],b[a++]=u[D],b[a++]=H[D]&1;else for(D=0;D<I;D++)b[a++]=h[D],b[a++]=
m[D],b[a++]=u[D],b[a++]=1}};q.__decorate([x.property({json:{write:!0}})],g.prototype,"width",void 0);q.__decorate([x.property({json:{write:!0}})],g.prototype,"height",void 0);q.__decorate([x.property({json:{write:!0}})],g.prototype,"pixelType",void 0);q.__decorate([z.cast("pixelType")],g.prototype,"castPixelType",null);q.__decorate([x.property({json:{write:!0}})],g.prototype,"validPixelCount",void 0);q.__decorate([x.property({json:{write:!0}})],g.prototype,"mask",void 0);q.__decorate([x.property({json:{write:!0}})],
g.prototype,"maskIsAlpha",void 0);q.__decorate([x.property({json:{write:!0}})],g.prototype,"pixels",void 0);q.__decorate([x.property()],g.prototype,"premultiplyAlpha",void 0);q.__decorate([x.property({json:{write:!0}})],g.prototype,"statistics",void 0);q.__decorate([x.property({json:{write:!0}})],g.prototype,"depthCount",void 0);q.__decorate([x.property({json:{write:!0}})],g.prototype,"noDataValues",void 0);q.__decorate([x.property({json:{write:!0}})],g.prototype,"bandMasks",void 0);return g=n=q.__decorate([A.subclass("esri.layers.support.PixelBlock")],
g)})},"esri/layers/support/SimpleBandStatistics":function(){define(["exports"],function(q){class C{constructor(g=null,l=null,v=null){this.minValue=g;this.maxValue=l;this.noDataValue=v}}q.SimpleBandStatistics=C;Object.defineProperty(q,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/rasterFormats/pixelRangeUtils":function(){define(["exports"],function(q){function C(v){return l[v]??[-3.4028234663852886E38,3.4028234663852886E38]}function g(v){return(v?.startsWith("s")||v?.startsWith("u"))??
!1}const l={u1:[0,1],u2:[0,3],u4:[0,15],u8:[0,255],s8:[-128,127],u16:[0,65535],s16:[-32768,32767],u32:[0,4294967295],s32:[-2147483648,2147483647],f32:[-3.4028234663852886E38,3.4028234663852886E38],f64:[-Number.MAX_VALUE,Number.MAX_VALUE],unknown:void 0,c64:void 0,c128:void 0};q.clipBandToPixelTypeRange=function(v,x,z,A){let [y,E]=C(z);var n=g(z);n&&(y-=1E-5,E+=1E-5);if(n)if(z.startsWith("u")){const [b,t]=[y,E];for(z=0;z<x.length;z++)x[z]&&(n=v[z],n<b||n>t?x[z]=0:A[z]=n+.5<<0)}else{const [b,t]=[y,
E];for(z=0;z<x.length;z++)x[z]&&(n=v[z],n<b||n>t?x[z]=0:A[z]=n+(0<n?.5:-.5)<<0)}else{const [b,t]=[y,E];for(z=0;z<x.length;z++)x[z]&&(n=v[z],n<b||n>t?x[z]=0:A[z]=n)}};q.convertNoDataToMask=function(v,x,z){if(!(v.depthCount&&1<v.depthCount)){var {pixels:A,statistics:y,pixelType:E}=v,n=A[0].length,b=v.bandMasks??[];n=v.mask??(new Uint8Array(n)).fill(255);var t="f32"===E||"f64"===E,H=C(E),h=!1;for(let D=0;D<A.length;D++){const I="number"===typeof x?x:x[D];if(null==I)continue;var m=y?.[D]?.maxValue??H[1];
if((y?.[D]?.minValue??H[0])>I+Number.EPSILON||m<I-Number.EPSILON)continue;m=b[D]||n.slice();const a=A[D];var u=z?.customFloatTolerance;if(t&&0!==u){u||=9.999999E37<=Math.abs(I)?2E-7*Math.abs(I):"f32"===E?2**-23:Number.EPSILON;for(let e=0;e<a.length;e++)m[e]&&Math.abs(a[e]-I)<u&&(a[e]=0,m[e]=0,n[e]=0,h=!0)}else for(u=0;u<a.length;u++)m[u]&&a[u]===I&&(a[u]=0,m[u]=0,n[u]=0,h=!0);b[D]=m}h&&(v.bandMasks=v.bandMasks||1<v.pixels.length?b:null,v.mask=n);h&&"updateStatistics"in v&&v.updateStatistics()}};q.fixNaN=
function(v,x){for(let z=0;z<x.length;z++)x[z]&&isNaN(v[z])&&(x[z]=0,v[z]=0)};q.getIntegerPixelType=function(v,x){return null==v||null==x?"s32":0>v?-128<=v&&128>x?"s8":-32768<=v&&32768>x?"s16":"s32":256>x?"u8":65536>x?"u16":"u32"};q.getPixelValueRange=C;q.isIntegerPixelType=g;Object.defineProperty(q,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/rasterDatasets/RawBlockCache":function(){define(["exports","../../../geometry","./EphemeralBlockCache","../rasterFunctions/rasterProjectionHelper",
"../../../geometry/Point"],function(q,C,g,l,v){function x(y,E){return(y=z.get(y))?y[E]??null:null}const z=new Map,A=new g;q.decreaseRefCount=function(y,E,n){const b=z.get(y);if(!b)return null==E?A.decreaseRefCount(y,n):0;if(null==E||null==b[E])return A.decreaseRefCount(y,n);E=b[E]?.cache;y=E?.get(n);if(E&&y){y.refCount--;if(0===y.refCount){E.delete(n);for(E=0;E<b.length;E++)b[E]?.cache.delete(n);y.controller&&y.controller.abort()}return y.refCount}return 0};q.deleteBlock=function(y,E,n){const b=z.get(y);
b?null==E||null==b[E]?A.deleteBlock(y,n):b[E]?.cache.delete(n):null==E&&A.deleteBlock(y,n)};q.deleteRaster=function(y){z.delete(y)};q.getBlock=function(y,E,n){const b=z.get(y);if(!b)return null==E?A.getBlock(y,n):null;if(null==E||null==b[E]){for(E=0;E<b.length;E++){var t=b[E]?.cache.get(n);if(t)return t.refCount++,t.block}return A.getBlock(y,n)}if(y=b[E]?.cache.get(n))return y.refCount++,y.block;for(y=0;y<b.length;y++){if(y===E||!b[y])continue;t=b[y]?.cache;const H=t?.get(n);if(t&&H)return H.refCount++,
t.set(n,H),H.block}return null};q.getRasterId=function(y,E){return null==E?y:`${y}?sliceId=${E}`};q.putBlock=function(y,E,n,b,t=null){const H=z.get(y);if(H)if(null==E||null==H[E])A.putBlock(y,n,b,t);else{var h={refCount:1,block:b,isResolved:!1,isRejected:!1,controller:t};b.then(()=>h.isResolved=!0).catch(()=>h.isRejected=!0);H[E]?.cache.set(n,h)}else null==E&&A.putBlock(y,n,b,t)};q.register=function(y,E){E={extent:null,rasterInfo:E,cache:new Map};const n=z.get(y);if(n)return n.push(E),n.length-1;
z.set(y,[E]);return 0};q.unregister=function(y,E){const n=z.get(y);n&&(n[E]=null,n.some(b=>null!=b)||z.delete(y))};q.update=function(y,E,n,b,t,H,h=null){if(y=x(y,E)){E=y.extent;var {cache:m,rasterInfo:u}=y;if(!E||E.xmin!==n.xmin||E.xmax!==n.xmax||E.ymin!==n.ymin||E.ymax!==n.ymax){b=b??0;E=n.clone().normalize();var {spatialReference:D,transform:I}=u,a=new Set;for(let w=0;w<E.length;w++){var e=E[w];if(e.xmax-e.xmin<=b||e.ymax-e.ymin<=b)continue;var c=l.projectExtent(e,D,h);null!=I&&(c=I.inverseTransform(c));
var r=new v({x:b,y:b,spatialReference:e.spatialReference});if(null==t&&(t=l.projectResolution(r,D,e,h),!t))return;const {pyramidLevel:f,pyramidResolution:B,excessiveReading:F}=l.snapPyramid(t,u,H||"closest");if(F)return;({storageInfo:e}=u);var {origin:d}=e;r=Math.max(0,Math.floor((c.xmin-d.x)/B.x));d=Math.max(0,Math.floor((d.y-c.ymax)/B.y));const J=0<f?e.pyramidBlockWidth:e.blockWidth,K=0<f?e.pyramidBlockHeight:e.blockHeight;e=Math.max(0,Math.floor(r/J)-1);var p=Math.max(0,Math.floor(d/K)-1);r=Math.floor((r+
Math.ceil((c.xmax-c.xmin)/B.x-.1)-1)/J)+1;c=Math.floor((d+Math.ceil((c.ymax-c.ymin)/B.y-.1)-1)/K)+1;for(d=p;d<=c;d++)for(p=e;p<=r;p++)a.add(`${f}/${d}/${p}`)}m.forEach((w,f)=>{a.has(f)||(w=m.get(f),(null==w||w.isResolved||w.isRejected)&&m.delete(f))});y.extent={xmin:n.xmin,ymin:n.ymin,xmax:n.xmax,ymax:n.ymax}}}};Object.defineProperty(q,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/rasterDatasets/EphemeralBlockCache":function(){define(function(){class q{constructor(C=15E3,g=5E3){this._timer=
null;this._cachedBlocks=new Map;this._size=-1;this._duration=C;this._interval=Math.min(C,g)}decreaseRefCount(C,g){C=C+"/"+g;g=this._cachedBlocks;if(g.has(C)){const l=g.get(C);l.refCount--;0>=l.refCount&&(g.delete(C),l.controller&&l.controller.abort());return l.refCount}return 0}getBlock(C,g){C=C+"/"+g;g=this._cachedBlocks;if(g.has(C)){const l=g.get(C);l.ts=Date.now();l.refCount++;g.delete(C);g.set(C,l);return l.block}return null}putBlock(C,g,l,v){const x=this._cachedBlocks;C=C+"/"+g;x.has(C)?(l=x.get(C),
l.ts=Date.now(),l.refCount++):x.set(C,{block:l,ts:Date.now(),refCount:1,controller:v});this._trim();this._updateTimer()}deleteBlock(C,g){const l=this._cachedBlocks;C=C+"/"+g;l.has(C)&&l.delete(C)}updateMaxSize(C){this._size=C;this._trim()}empty(){this._cachedBlocks.clear();this._clearTimer()}getCurrentSize(){return this._cachedBlocks.size}_updateTimer(){if(null==this._timer){var C=this._cachedBlocks;this._timer=setInterval(()=>{const g=Array.from(C),l=Date.now();for(let v=0;v<g.length;v++)if(g[v][1].ts<=
l-this._duration)C.delete(g[v][0]);else break;0===C.size&&this._clearTimer()},this._interval)}}_trim(){const C=this._cachedBlocks;if(!(-1===this._size||this._size>=C.size)){var g=Array.from(C);for(let l=0;l<g.length-this._size;l++)C.delete(g[l][0])}}_clearTimer(){null!=this._timer&&(clearInterval(this._timer),this._timer=null)}}return q})},"esri/layers/support/rasterFunctions/rasterProjectionHelper":function(){define("require exports ../../../geometry ../../../core/arrayUtils ../../../core/Error ../../../core/unitUtils ../../../chunks/pe ../../../geometry/projection ../../../geometry/support/spatialReferenceUtils ../../../geometry/Extent ../../../geometry/Polygon ../../../geometry/Point ../../../geometry/SpatialReference".split(" "),
function(q,C,g,l,v,x,z,A,y,E,n,b,t){function H(k,G,M){return!A.canProjectWithoutEngine(k,G,M)}function h(k,G,M){if((k=H(k,G,M))&&!A.isLoaded())throw new v("rasterprojectionhelper-project","projection engine is not loaded");return k}function m(k,G,M){h(k.spatialReference,G);return M?A.getTransformation(G,k.spatialReference,k):A.getTransformation(k.spatialReference,G,k)}function u(k,G,M){G=x.getMetersPerUnitForSR(G)/x.getMetersPerUnitForSR(M);return{x:k.x*G,y:k.y*G}}function D(k,G,M){const {spatialReference:O}=
M;if(!O||!G||O.equals(G))return k;if(O.isGeographic&&G.isGeographic)return u(k,O,G);h(O,G);if(!qa)throw new v("raster-projection-helper:project-dataset-resolution","geometry engine is not loaded");let {x:W,y:P}=k;var V=x.getMetersPerUnitForSR(O),U=(W+P)/2*V;V=1;30<U&&(V=30/U,W*=V,P*=V);U=256*W/2;var Q=256*P/2;const {x:ea,y:ca}=M.center;M=[];for(var fa=0;256>=fa;fa++)M.push([ea-U,ca-Q+fa*P]);for(fa=1;256>=fa;fa++)M.push([ea-U+fa*W,ca+Q]);for(fa=1;256>=fa;fa++)M.push([ea+U,ca+Q-fa*P]);for(fa=1;256>
fa;fa++)M.push([ea+U-fa*W,ca-Q]);M.push(M[0]);U=new n({rings:[M],spatialReference:O});Q=A.project(U,G);if(!Q)return u(k,O,G);U=Q.extent;M=N(G);if(null==U||null!=M&&U.width>=M)return u(k,O,G);k=qa.planarArea(Q);k=Math.sqrt(k/(W*P*65536))/V;V={x:U.width/V/256,y:U.height/V/256};k={x:W*k,y:P*k};G=V.x*V.y;return.1>Math.abs(G-k.x*k.y)/G?V:k}function I(k,G=.01){return x.getMetersPerUnitForSR(k)?G/x.getMetersPerUnitForSR(k):0}function a(k,G,M=null,O=!0){const W=k.spatialReference;if(W.equals(G))return k;
h(W,G,M);M=A.project(k,G,M);if(!O||!M)return M;e([k],[M],W,G);return M}function e(k,G,M,O){const W=R(M,!0),P=R(O,!0);M=I(M,500);O=I(O,500);if(M&&null!=W&&null!=P)for(let V=0;V<k.length;V++){const U=G[V];if(!U)continue;const {x:Q}=k[V],{x:ea}=U;ea>=P[1]-O&&Math.abs(Q-W[0])<M?U.x-=P[1]-P[0]:ea<=P[0]+O&&Math.abs(Q-W[1])<M&&(U.x+=P[1]-P[0])}}function c(k){const {inSR:G,outSR:M,datumTransformation:O,preferPE:W}=k;if(G.equals(M))return{points:k}=f(k,null),k;if(G.isWebMercator&&M.isWGS84||G.isWGS84&&M.isWebMercator){const {cols:Q,
rows:ea,xres:ca,yres:fa,usePixelCenter:ha,inSR:ia,outSR:la}=k;let {xmin:oa,ymax:pa}=k;ha&&(oa+=ca/2,pa-=fa/2);k=[];const ma=[];var P=Math.max(Q,ea);for(var V=0;V<P;V++){var U=A.project(new b({x:oa+ca*Math.min(Q,V),y:pa-fa*Math.min(ea,V),spatialReference:ia}),la);V<=Q&&k.push(U.x);V<=ea&&ma.push(U.y)}P=[];for(V=0;V<Q;V++)for(U=0;U<ea;U++)P.push([k[V],ma[U]]);return P}return h(G,M,O)&&W&&(G.isGeographic||null!=p(G))?d(k):r(k)}function r(k){var {points:G}=f(k,null);const {inSR:M,outSR:O,datumTransformation:W}=
k;k=G.map(P=>new b(P[0],P[1],M));G=A.project(k,O,W);W&&e(k,G,M,O);return G.map(P=>P?[P.x,P.y]:[NaN,NaN])}function d(k){const {inSR:G,outSR:M,datumTransformation:O}=k;var W=p(G);const {points:P,mask:V}=f(k,W);G.isGeographic||(k=G.wkid?z.PeFactory.coordsys(G.wkid):z.PeFactory.fromString(G.isGeographic?z.PeDefs.PE_TYPE_GEOGCS:z.PeDefs.PE_TYPE_PROJCS,G.wkt2||G.wkt),z.PeCSTransformations.projToGeog(k,P.length,P));if(null!=O&&O.steps.length){var U;M.isGeographic&&(U=P.map(([Q])=>179.9955<Q?1:-179.9955>
Q?-1:0));O.steps.forEach(Q=>{const ea=Q.wkid?z.PeFactory.geogtran(Q.wkid):z.PeFactory.fromString(z.PeDefs.PE_TYPE_GEOGTRAN,Q.wkt);z.PeGTTransformations.geogToGeog(ea,P.length,P,null,Q.isInverse?z.PeDefs.PE_TRANSFORM_2_TO_1:z.PeDefs.PE_TRANSFORM_1_TO_2)});if(U)for(k=0;k<P.length;k++){W=U[k];const Q=P[k][0],ea=179.9955<Q?1:-179.9955>Q?-1:0;W&&ea&&W!==ea&&(P[k][0]=0<W?Q+360:Q-360)}}M.isGeographic||(U=p(M,!0),B(P,null!=U&&U.isEnvelope?[U.bbox[1],U.bbox[3]]:[-90,90]),U=M.wkid?z.PeFactory.coordsys(M.wkid):
z.PeFactory.fromString(M.isGeographic?z.PeDefs.PE_TYPE_GEOGCS:z.PeDefs.PE_TYPE_PROJCS,M.wkt2||M.wkt),z.PeCSTransformations.geogToProj(U,P.length,P));U=P;if(V&&P.length!==V.length){U=[];for(let Q=0,ea=0;Q<V.length;Q++)V[Q]?U.push(P[ea++]):U.push([NaN,NaN])}return U}function p(k,G=!1){var M=k.wkid||k.wkt2||k.wkt;if(!M||k.isGeographic)return null;M=String(M);if(ja.has(M))return M=ja.get(M),G?M?.gcs:M?.pcs;var O=k.wkid?z.PeFactory.coordsys(k.wkid):z.PeFactory.fromString(k.isGeographic?z.PeDefs.PE_TYPE_GEOGCS:
z.PeDefs.PE_TYPE_PROJCS,k.wkt2||k.wkt);k=I(k,1E-4);k=w(O,k);O=w(O,0,!0);ja.set(M,{pcs:k,gcs:O});return G?O:k}function w(k,G=0,M=!1){var O=z.PePCSInfo.generate(k),W=M?k.horizonGcsGenerate():k.horizonPcsGenerate();if(!O||!W?.length)return null;k=!1;var P=W.find(ca=>1===ca.getInclusive()&&1===ca.getKind());if(!P){P=W.find(ca=>1===ca.getInclusive()&&0===ca.getKind());if(!P)return null;k=!0}M=M?0:(2===O.getNorthPoleLocation()?1:0)|(2===O.getSouthPoleLocation()?2:0);O=O.isPannableRectangle();P=P.getCoord();
if(k)return{isEnvelope:k,isPannable:O,vertices:P,coef:null,bbox:[P[0][0]-G,P[0][1]-G,P[1][0]+G,P[1][1]+G],poleLocation:M};G=0;k=[];let [V,U]=P[0],[Q,ea]=P[0];for(let ca=0,fa=P.length;ca<fa;ca++){G++;G===fa&&(G=0);const [ha,ia]=P[ca],[la,oa]=P[G];if(oa===ia)k.push([ha,la,ia,oa,2]);else{W=(la-ha)/(oa-ia||1E-4);const pa=ha-W*ia;ia<oa?k.push([W,pa,ia,oa,0]):k.push([W,pa,oa,ia,1])}V=V<ha?V:ha;U=U<ia?U:ia;Q=Q>ha?Q:ha;ea=ea>ia?ea:ia}return{isEnvelope:!1,isPannable:O,vertices:P,coef:k,bbox:[V,U,Q,ea],poleLocation:M}}
function f(k,G){const M=[],{cols:O,rows:W,xres:P,yres:V,usePixelCenter:U}=k;let {xmin:Q,ymax:ea}=k;U&&(Q+=P/2,ea-=V/2);if(null==G){for(k=0;k<O;k++)for(G=0;G<W;G++)M.push([Q+P*k,ea-V*G]);return{points:M}}k=new Uint8Array(O*W);if(G.isEnvelope){const {bbox:[pa,ma,sa,ta]}=G;for(let ua=0,va=0;ua<O;ua++){var ca=Q+P*ua,fa=G.isPannable||ca>=pa&&ca<=sa;for(var ha=0;ha<W;ha++,va++){var ia=ea-V*ha;fa&&ia>=ma&&ia<=ta&&(M.push([ca,ia]),k[va]=1)}}return{points:M,mask:k}}ca=G.coef;G=[];for(fa=0;fa<W;fa++){var la=
ea-V*fa;ha=[];ia=[];for(var oa=0;oa<ca.length;oa++){const [pa,ma,sa,ta,ua]=ca[oa];la===sa&&sa===ta?(ha.push(pa),ha.push(ma),ia.push(2),ia.push(2)):la>=sa&&la<=ta&&(ha.push(pa*la+ma),ia.push(ua))}la=ha;if(2<ha.length){oa=2===ia[0]?0:ia[0];let pa=ha[0];la=[];for(let ma=1;ma<ia.length;ma++)if(2!==ia[ma]||ma===ia.length-1)ia[ma]!==oa&&(la.push(0===oa?Math.min(pa,ha[ma-1]):Math.max(pa,ha[ma-1])),oa=ia[ma],pa=ha[ma]),ma===ia.length-1&&la.push(0===ia[ma]?Math.min(pa,ha[ma]):Math.max(pa,ha[ma]));la.sort((ma,
sa)=>ma-sa)}else ha[0]>ha[1]&&(la=[ha[1],ha[0]]);G.push(la)}for(let pa=0,ma=0;pa<O;pa++)for(ca=Q+P*pa,fa=0;fa<W;fa++,ma++)if(ha=ea-V*fa,ia=G[fa],2===ia.length)ca>=ia[0]&&ca<=ia[1]&&(M.push([ca,ha]),k[ma]=1);else if(2<ia.length){la=!1;for(oa=0;oa<ia.length;oa+=2)if(ca>=ia[oa]&&ca<=ia[oa+1]){la=!0;break}la&&(M.push([ca,ha]),k[ma]=1)}return{points:M,mask:k}}function B(k,G){const [M,O]=G;for(G=0;G<k.length;G++){const W=k[G][1];if(W<M||W>O)k[G]=[NaN,NaN]}}function F(k,G){const M=N(k[0].spatialReference);
if(2>k.length||null==M)return k[0];G=G??I(k[0].spatialReference);k=k.filter(U=>U.width>G);if(1===k.length)return k[0];let {xmin:O,xmax:W,ymin:P,ymax:V}=k[0];for(let U=1;U<k.length;U++){const Q=k[U];W=Q.xmax+M*U;P=Math.min(P,Q.ymin);V=Math.max(V,Q.ymax)}return new E({xmin:O,xmax:W,ymin:P,ymax:V,spatialReference:k[0].spatialReference})}function J(k,G,M=null,O=!0){var W=k.spatialReference;if(W.equals(G))return k;var P=S(k);const V=N(W,!0);var U=N(G);if(0===P||null==V||null==U)return P=L(k,G,M,O),null==
V&&null!=U&&Math.abs(P.width-U)<I(G)&&A.isLoaded()&&(W=p(W),null!=W&&W.poleLocation===Z.None&&k.width<(W.bbox[2]-W.bbox[0])/2)?K(k,G)||P:P;U=k.clone().normalize();if(1===U.length&&k.xmax<V&&k.xmax-V/2>I(W)){const {xmin:Q,xmax:ea}=k;for(let ca=0;ca<=P;ca++)U[ca]=new E({xmin:0===ca?Q:-V/2,xmax:ca===P?ea-V*ca:V/2,ymin:k.ymin,ymax:k.ymax,spatialReference:W})}k=U.map(Q=>L(Q,G,M,O));return F(k.filter(l.isSome))}function K(k,G){const M=N(G);if(null==M)return null;let {xmin:O,ymin:W,xmax:P,ymax:V}=k;var U=
k.spatialReference;k=new n({spatialReference:U,rings:[[[O,W],[P,W],[P,V],[O,V],[O,W]]]});k=A.project(k,G);if(2!==k.rings.length||!k.rings[0].length||!k.rings[1].length)return null;({rings:k}=k);U=I(U);G=new E({spatialReference:G});for(let Q=0;2>Q;Q++){O=P=k[Q][0][0];W=V=k[Q][0][1];for(let ea=0;ea<k[Q].length;ea++)O=O>k[Q][ea][0]?k[Q][ea][0]:O,P=P<k[Q][ea][0]?k[Q][ea][0]:P,W=W>k[Q][ea][1]?k[Q][ea][1]:W,V=V<k[Q][ea][1]?k[Q][ea][1]:V;if(0===Q)G.ymin=W,G.ymax=V,G.xmin=O,G.xmax=P;else if(G.ymin=Math.min(G.ymin,
W),G.ymax=Math.max(G.ymax,V),Math.abs(P-M/2)<U)G.xmin=O,G.xmax+=M;else if(Math.abs(O+M/2)<U)G.xmax=P+M;else return null}return G}function L(k,G,M=null,O=!0,W=!0){const P=k.spatialReference;if(P.equals(G)||!G)return k;h(P,G,M);const V=A.project(k,G,M);if(W&&G.isWebMercator&&V&&(V.ymax=Math.min(2.0037508342787E7,V.ymax),V.ymin=Math.max(-2.0037508342787E7,V.ymin),V.ymin>=V.ymax))return null;if(!O||!V)return V;var U=R(P,!0);O=R(G,!0);if(null==U||null==O)return V;W=I(P,.001);const Q=I(P,500);var ea=I(G,
.001);if(Math.abs(V.xmin-O[0])<ea&&Math.abs(V.xmax-O[1])<ea){ea=Math.abs(k.xmin-U[0]);U=Math.abs(U[1]-k.xmax);if(ea<W&&U>Q){V.xmin=O[0];var ca=[];ca.push(new b(k.xmax,k.ymin,P));ca.push(new b(k.xmax,(k.ymin+k.ymax)/2,P));ca.push(new b(k.xmax,k.ymax,P));ca=ca.map(fa=>a(fa,G,M)).filter(fa=>!isNaN(fa?.x)).map(fa=>fa.x);V.xmax=Math.max.apply(null,ca)}U<W&&ea>Q&&(V.xmax=O[1],O=[],O.push(new b(k.xmin,k.ymin,P)),O.push(new b(k.xmin,(k.ymin+k.ymax)/2,P)),O.push(new b(k.xmin,k.ymax,P)),k=O.map(fa=>a(fa,G,
M)).filter(fa=>!isNaN(fa?.x)).map(fa=>fa.x),V.xmin=Math.min.apply(null,k))}else k=I(G,.001),Math.abs(V.xmin-O[0])<k&&(V.xmin=O[0]),Math.abs(V.xmax-O[1])<k&&(V.xmax=O[1]);return V}function N(k,G=!1){return k?k.isWebMercator?2*(G?2.0037508342787E7:2.0037508342788905E7):k.wkid&&k.isGeographic?360:2*ka[k.wkid]||null:null}function R(k,G=!1){if(k.isGeographic)return[-180,180];k=N(k,G);return null!=k?[-k/2,k/2]:null}function T(k,G,M,O){k=(k-G)/M;0!==k-Math.floor(k)?k=Math.floor(k):O&&--k;return k}function S(k,
G=!1){var M=N(k.spatialReference);if(null==M)return 0;const O=G?0:-(M/2),W=I(k.spatialReference),P=!G&&Math.abs(k.xmin+M/2)<W?-M/2:k.xmin;k=T(!G&&Math.abs(k.xmax-M/2)<W?M/2:k.xmax,O,M,!0);M=T(P,O,M,!1);return k-M}function Y(k){const {projectedExtent:G,srcBufferExtent:M,pixelSize:O,datumTransformation:W,rasterTransform:P}=k;var V=G.spatialReference;const U=M.spatialReference;var Q=h(V,U);const {xmin:ea,ymin:ca,xmax:fa,ymax:ha}=G,ia=N(U),la=null!=ia&&(k.hasWrapAround||"gcs-shift"===P?.type);k=k.spacing||
[32,32];var oa=k[0]*O.x,pa=k[1]*O.y;const ma=1===k[0],sa=Math.ceil((fa-ea)/oa-.1/k[0])+(ma?0:1),ta=Math.ceil((ha-ca)/pa-.1/k[1])+(ma?0:1);oa=c({cols:sa,rows:ta,xmin:ea,ymax:ha,xres:oa,yres:pa,inSR:V,outSR:U,datumTransformation:W,preferPE:4>=k[0],usePixelCenter:ma});pa=[];let ua,va=0;const za=ma?-1:NaN,{xmin:Aa,xmax:ya,ymax:Ba,width:Ca,height:Da}=M,Ea=I(U,500),Fa=null!=ia&&0<Aa&&ya>ia/2;var wa=!1;Q&&(wa=p(V),wa=null!=wa&&0<wa.poleLocation);for(V=0;V<sa;V++){Q=[];for(let xa=0;xa<ta;xa++){var ra=oa[V*
ta+xa];la&&ra[0]>ya&&ra[0]>ia/2-Ea?ra[0]-=ia:la&&0===V&&0>ra[0]&&Fa&&!P&&(ra[0]+=ia);!ra||isNaN(ra[0])||isNaN(ra[1])?(pa.push(za),pa.push(za),Q.push(null),va++):(P&&(ra=P.inverseTransform(new b({x:ra[0],y:ra[1],spatialReference:U})),ra=[ra.x,ra.y]),Q.push(ra),0<V&&la&&ua[xa]&&ra[0]<ua[xa][0]&&(ra[0]+=ia,wa&&ra[0]>ya&&ra[0]>ia&&(ra[0]-=ia)),pa.push((ra[0]-Aa)/Ca),pa.push((Ba-ra[1])/Da))}ua=Q}return{offsets:pa,error:null,coefficients:null,outofBoundPointCount:va,spacing:k,size:ma?[sa,ta]:[sa-1,ta-1]}}
function X(k,G,M){const {cols:O,rows:W}=G;G=new Float32Array((O-1)*(W-1)*12);const P=new Float32Array([-0,-1,1,-1,1,-0,1,-0,-0]),V=new Float32Array([-1,1,0,0,-1,1,1,0,0]);for(let ha=0;ha<O-1;ha++){for(var U=0;U<W-1;U++){var Q=ha*W*2+2*U,ea=k[Q];const ia=k[Q+1];var ca=k[Q+2],fa=k[Q+3];Q+=2*W;const la=k[Q],oa=k[Q+1],pa=k[Q+2];Q=k[Q+3];let ma=0,sa=12*(U*(O-1)+ha);for(let ta=0;3>ta;ta++)G[sa++]=P[ma++]*ea+P[ma++]*ca+P[ma++]*pa;ma=0;for(ca=0;3>ca;ca++)G[sa++]=P[ma++]*ia+P[ma++]*fa+P[ma++]*Q;ma=0;for(fa=
0;3>fa;fa++)G[sa++]=V[ma++]*ea+V[ma++]*la+V[ma++]*pa;ma=0;for(ea=0;3>ea;ea++)G[sa++]=V[ma++]*ia+V[ma++]*oa+V[ma++]*Q}if(M)for(U=0;U<G.length;U++)isNaN(G[U])&&(G[U]=-1)}return G}function ba(k,G){k=k.clone().normalize();return 1===k.length?k[0]:F(k,G)}function aa(k,G){const {pixelSize:M,extent:O}=k;k=m(O,G,!1);const W=ba(O,(M.x+M.y)/16);return J(W,G,k)}var Z;(function(k){k[k.None=0]="None";k[k.North=1]="North";k[k.South=2]="South";k[k.Both=3]="Both"})(Z||={});const da=(k,G,M,O=0)=>{if(1===M[0])return[0,
0];var W=1,P=-1,V=1,U=-1;for(var Q=0;Q<k.length;Q+=2)isNaN(k[Q])||(W=W>k[Q]?k[Q]:W,P=P>k[Q]?P:k[Q],V=V>k[Q+1]?k[Q+1]:V,U=U>k[Q+1]?U:k[Q+1]);const {cols:ea,rows:ca}=G;G=(P-W)/ea/M[0];M=(U-V)/ca/M[1];O*=2;V=0;U=!1;W=[0,0];for(P=0;P<ea-3;P++){for(Q=0;Q<ca-3;Q++){var fa=P*ca*2+2*Q;const ha=Math.abs(((k[fa]+k[fa+4]+k[fa+4*ca]+k[fa+4*ca+4])/4-k[fa+2*ca+2])/G);fa=Math.abs(((k[fa+1]+k[fa+5]+k[fa+4*ca+1]+k[fa+4*ca+5])/4-k[fa+2*ca+3])/M);ha+fa>V&&(V=ha+fa,W=[ha,fa]);if(O&&V>O){U=!0;break}}if(U)break}return W},
ka={3395:2.0037508342789244E7,3410:1.7334193943686873E7,3857:2.0037508342788905E7,3975:1.7367530445161372E7,4087:2.0037508342789244E7,4088:2.0015108787169147E7,6933:1.7367530445161372E7,32662:2.0037508342789244E7,53001:2.001508679602057E7,53002:1.000754339801029E7,53003:2.001508679602057E7,53004:2.001508679602057E7,53016:1.4152803599503474E7,53017:1.7333573624304302E7,53034:2.001508679602057E7,53079:2.0015114352186374E7,53080:2.0015114352186374E7,54001:2.0037508342789244E7,54002:1.0018754171394624E7,
54003:2.0037508342789244E7,54004:2.0037508342789244E7,54016:1.4168658027268292E7,54017:1.736753044516137E7,54034:2.0037508342789244E7,54079:2.0037508342789244E7,54080:2.0037508342789244E7,54100:2.0037508342789244E7,54101:2.0037508342789244E7},ja=new Map,na=new Map;let qa=null;C.computeProjectedScales=function(k,G,M){var O=M?.tileSize??512,W=M?.alignGlobalDatasetWithAGOL??!0,P=!!M?.limitToSrcResolution;const {extent:V,spatialReference:U,pixelSize:Q}=k;M=D(Q,G,V);if(null==M)return{projectedPixelSize:null,
scales:null,srcResolutions:null,isCustomTilingScheme:!1};const ea=(M.x+M.y)/2,ca=x.getMetersPerUnitForSR(G);var fa=ea*ca*96*39.37,ha=G.isGeographic?256/O*2.958287637958547E8:256/O*5.91657527591555E8,ia="vector-magdir"===k.dataType||"vector-uv"===k.dataType,la=aa(k,G),oa=Math.min(Math.ceil(Math.log(Math.min(k.width,k.height)/32)/Math.LN2),Math.ceil(Math.log(ha/2/fa)/Math.LN2));if(!ia&&W&&(G.isGeographic||G.isWebMercator)&&(W=N(G),ia=0<S(la)||null!=W&&la.width>W/4,!ia&&null!=W)){ia=-1;if(3>oa)ia=2**
oa*ea*O;else if(k.storageInfo){const {maximumPyramidLevel:pa=0,pyramidScalingFactor:ma=2}=k.storageInfo;ia=ma**pa*ea*O}O=Math.ceil(W/ia);ia=1===O||2===O&&W/2-la.xmax<ia}O=fa;la=Math.min(2,Math.max(1.414,k.storageInfo?.pyramidScalingFactor||2));if(ia)O=ha,ha=G.isGeographic?1.341104507446289E-6:.29858214164761665,oa=96*ha*ca*39.37,k=aa(k,new t({wkid:G.isGeographic?4326:3857})),k=D({x:ha,y:ha},U,k),k.x*=O/oa,k.y*=O/oa;else{k={x:Q.x,y:Q.y};for(G=0;O<.5005*ha&&G<oa;)G++,O*=la,k.x*=la,k.y*=la;1.001>=Math.max(O,
ha)/Math.min(O,ha)&&(O=ha)}G=[O];ha=[{x:k.x,y:k.y}];for(fa=Math.min(70.5310735,fa)/1.001;O>=fa;)O/=la,k.x/=la,k.y/=la,G.push(O),ha.push({x:k.x,y:k.y});if(P){const pa=.001*Q.x;P=ha.findIndex(ma=>ma.x>=Q.x-pa&&ma.x<=Q.x+pa);-1<P?(ha.length=P+1,G.length=P+1):(P=ha.findIndex(ma=>ma.x<=Q.x+pa),0<P&&(ha.length=P,G.length=P))}return{projectedPixelSize:M,scales:G,srcResolutions:ha,isCustomTilingScheme:!ia}};C.defaultGridSpacing=32;C.defaultProjectionToleranceInPixels=4;C.getDefaultDatumTransformationForDataset=
m;C.getProjectedGridPoints=c;C.getProjectionOffsetGrid=function(k){var G=k.isAdaptive&&null==k.spacing;let M=k.spacing||[32,32],O=Y(k);var W={cols:O.size[0]+1,rows:O.size[1]+1};const P=0<O.outofBoundPointCount&&O.outofBoundPointCount<O.offsets.length/2;let V=O.outofBoundPointCount===O.offsets.length/2||G&&P?[0,0]:da(O.offsets,W,M,4);const U=(V[0]+V[1])/2;var Q=k.projectedExtent.spatialReference;const ea=k.srcBufferExtent.spatialReference;G&&(P||4<U)&&(H(Q,ea,k.datumTransformation)&&(Q.isGeographic||
null!=p(Q)),M=[4,4],O=Y({...k,spacing:M}),W={cols:O.size[0]+1,rows:O.size[1]+1},V=da(O.offsets,W,M,4));O.error=V;1<M[0]&&(O.coefficients=X(O.offsets,W,P));!k.includeGCSGrid||Q.isGeographic||Q.isWebMercator||(ea.isGeographic?O.gcsGrid={offsets:O.offsets,coefficients:O.coefficients,spacing:M}:(G=p(Q),null==G||G.isEnvelope||(Q&&!Q.isGeographic&&(G=String(Q.wkid||Q.wkt2||Q.wkt),na.has(G)?Q=na.get(G):(Q=(Q.wkid?z.PeFactory.coordsys(Q.wkid):z.PeFactory.fromString(z.PeDefs.PE_TYPE_PROJCS,Q.wkt2||Q.wkt)).getGeogcs().getCode(),
na.set(G,Q)),Q=new t({wkid:Q})),Q=J(k.projectedExtent,Q),{offsets:k}=Y({...k,srcBufferExtent:Q,spacing:M}),W=X(k,W,P),O.gcsGrid={offsets:k,coefficients:W,spacing:M})));return O};C.getRasterDatasetAlignmentInfo=function(k){const G=k.storageInfo.origin.x;var M=N(k.spatialReference,!0);if(null==M)return{originX:G,halfWorldWidth:null,pyramidsInfo:null};const O=M/2,{nativePixelSize:W,storageInfo:P,extent:V}=k,{maximumPyramidLevel:U,blockWidth:Q,pyramidScalingFactor:ea}=P;let ca=W.x;const fa=[];k=null!=
k.transform&&"gcs-shift"===k.transform.type;const ha=G+(k?0:O);M=k?M-G:O-G;for(let ia=0;ia<=U;ia++){const la=(V.xmax-G)/ca/Q,oa=M/ca/Q;fa.push({resolutionX:ca,blockWidth:Q,datasetColumnCount:0===la-Math.floor(la)?la:Math.ceil(la),worldColumnCountFromOrigin:0===oa-Math.floor(oa)?oa:Math.ceil(oa),leftMargin:Math.round(ha/ca)%Q,rightPadding:(Q-Math.round(M/ca)%Q)%Q,originColumnOffset:Math.floor(ha/ca/Q)});ca*=ea}return{originX:G,halfWorldWidth:O,pyramidsInfo:fa,hasGCSSShiftTransform:k}};C.getWorldWidth=
N;C.getWorldWrapCount=S;C.load=async function(){qa&&A.isLoaded()||(A.isLoaded()||await A.load(),qa=await new Promise((k,G)=>q(["../../../geometry/geometryEngine"],k,G)))};C.minimumGridSpacing=4;C.projectDatasetExtent=aa;C.projectDatasetResolution=D;C.projectExtent=J;C.projectPoint=a;C.projectPolygon=function(k,G,M){if("extent"===k.type){const {xmin:O,ymin:W,xmax:P,ymax:V,spatialReference:U}=k;k=new n({rings:[[[O,V],[P,V],[P,W],[O,W],[O,V]]],spatialReference:U})}if(k.spatialReference.equals(G))return k;
h(k.spatialReference,G,M);return A.project(k,G,M)};C.projectResolution=function(k,G,M,O=null){const W=k.spatialReference;if(!W||!G||W.equals(G))return k;h(W,G,O);M=M.center;M=new E({xmin:M.x-k.x/2,xmax:M.x+k.x/2,ymin:M.y-k.y/2,ymax:M.y+k.y/2,spatialReference:W});O=A.project(M,G,O);M=N(G);return null==O||null!=M&&O.width>=M?u(k,W,G):{x:O.width,y:O.height}};C.requirePE=H;C.shiftExtent=function(k){var {spatialReference:G}=k;G=y.getInfo(G);if(!G)return k;const [M,O]=G.valid;G=O-M;let W=0;k.xmin<M?W=Math.ceil((M-
k.xmin)/G):k.xmin>O&&(W=-Math.ceil((k.xmin-O)/G));return new E({spatialReference:k.spatialReference,xmin:k.xmin+W*G,ymin:k.ymin,xmax:k.xmax+W*G,ymax:k.ymax})};C.snapExtent=ba;C.snapPyramid=function(k,G,M){const {storageInfo:O,pixelSize:W}=G;var P=0;let V=!1;var {pyramidResolutions:U}=O,Q="mixed"===O.tileInfo.format?.toLowerCase()?Math.max(1,Math.min(3,O.tileInfo.dpi/96)):1;Q=(k.x+k.y)/2/Q;if(null!=U&&U.length){k=U[U.length-1];k=(k.x+k.y)/2;var ea=(W.x+W.y)/2;if(Q<=ea)P=0;else if(Q>=k)P=U.length,V=
8<Q/k;else{k=ea;for(let ca=1;ca<=U.length;ca++){ea=(U[ca-1].x+U[ca-1].y)/2;if(Q<=ea){Q===ea?P=ca:"down"===M?(P=ca-1,V=8<Q/k):P="up"===M?ca:Q-k>ea-Q||2<Q/k?ca:ca-1;break}k=ea}}M=0===P?W:U[P-1];V&&(U=Math.min(M.x,M.y),Q=x.getMetersPerUnitForSR(G.spatialReference),19567<U*Q&&(V=!1));return{pyramidLevel:P,pyramidResolution:new b({x:M.x,y:M.y,spatialReference:G.spatialReference}),excessiveReading:V}}P=Math.log(k.x/W.x)/Math.LN2;Q=Math.log(k.y/W.y)/Math.LN2;U=G.storageInfo.maximumPyramidLevel||0;P="down"===
M?Math.floor(Math.min(P,Q)):"up"===M?Math.ceil(Math.max(P,Q)):Math.round((P+Q)/2);0>P?P=0:P>U&&(V=P>U+3,P=U);M=2**P;G=new b({x:M*G.nativePixelSize.x,y:M*G.nativePixelSize.y,spatialReference:G.spatialReference});return{pyramidLevel:P,pyramidResolution:G,excessiveReading:V}};Object.defineProperty(C,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/imagery/VectorFieldTileView2D":function(){define("../../../../chunks/tslib.es6 ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/Logger ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ../../../../layers/support/rasterFunctions/vectorFieldUtils ../../engine/imagery/RasterVFTileContainer ./BaseImageryTileSubView2D".split(" "),
function(q,C,g,l,v,x,z,A,y,E){l=class extends E.BaseImageryTileSubView2D{constructor(){super(...arguments);this._handle=null;this.type="rasterVF"}canUseWebGLForProcessing(){return!1}async fetchTile(n,b){b={...b,interpolation:"nearest",requestProjectedLocalDirections:!0};n=await this.layer.fetchTile(n.level,n.row,n.col,b);"vector-magdir"===this.layer.serviceRasterInfo?.dataType&&n?.pixelBlock&&(n.pixelBlock=await this.layer.convertVectorFieldData(n.pixelBlock,b));return n}updateTileSource(n,b){const t=
b.symbolizerParams,{tileData:H}=n;H.key=n.key;H.width=this._tileInfoView.tileInfo.size[0];H.height=this._tileInfoView.tileInfo.size[1];({symbolTileSize:n}=t);({source:b}=b);H.offset=this._getTileSymbolOffset(H.key,n);null!=b?.pixelBlock?(H.rawPixelData={extent:b.extent,pixelBlock:b.pixelBlock},H.symbolizerParameters=t,H.source=this._sampleVectorFieldData(b.pixelBlock,t,H.offset)):(b=this.createEmptyTilePixelBlock([Math.round((this._tileInfoView.tileInfo.size[0]-H.offset[0])/n),Math.round((this._tileInfoView.tileInfo.size[1]-
H.offset[1])/n)]),H.source=b,H.symbolizerParameters=t);H.invalidateVAO();return Promise.resolve()}updateTileSymbolizerParameters(n,b){var t=b.local;({symbolTileSize:b}=t);({tileData:n}=n);n.offset=this._getTileSymbolOffset(n.key,b);const H=n.symbolizerParameters.symbolTileSize;n.symbolizerParameters=t;t=n.rawPixelData?.pixelBlock;null!=t&&H!==b&&(n.source=this._sampleVectorFieldData(t,n.symbolizerParameters,n.offset));return Promise.resolve()}attach(){super.attach();this.container=new y.RasterVFTileContainer(this._tileInfoView);
this.container.isCustomTilingScheme=this._isCustomTilingScheme;this._updateSymbolType(this.layer.renderer);this._handle=C.watch(()=>this.layer.renderer,n=>this._updateSymbolType(n))}detach(){super.detach();this.container.removeAllChildren();this._handle?.remove();this.container=this._handle=null}_getTileSymbolOffset(n,b){const t=n.col*this._tileInfoView.tileInfo.size[0]%b;n=n.row*this._tileInfoView.tileInfo.size[1]%b;return[t>b/2?b-t:-t,n>b/2?b-n:-n]}_sampleVectorFieldData(n,b,t){({symbolTileSize:b}=
b);return A.sampleVectorField(n,"vector-uv",b,t)}_updateSymbolType(n){"vector-field"===n.type&&(this.container.symbolTypes="wind-barb"===n.style?["scalar","triangle"]:"simple-scalar"===n.style?["scalar"]:["triangle"])}};q.__decorate([g.property()],l.prototype,"container",void 0);q.__decorate([g.property()],l.prototype,"layer",void 0);q.__decorate([g.property()],l.prototype,"type",void 0);return l=q.__decorate([z.subclass("esri.views.2d.layers.imagery.VectorFieldTileView2D")],l)})},"esri/layers/support/rasterFunctions/vectorFieldUtils":function(){define(["exports",
"../../../core/jsonMap","../PixelBlock","./pixelUtils"],function(q,C,g,l){function v(d,p){return m.get(d)/m.get(p)||1}function x(d,p="geographic"){const [w,f]=d;d=Math.sqrt(w*w+f*f);let B=Math.atan2(f,w)*u;B=(360+B)%360;"geographic"===p&&(B=(450-B)%360);return[d,B]}function z(d,p="geographic"){let w=d[1];"geographic"===p&&(w=(450-w)%360);w%=360;d=d[0];return[d*Math.cos(w/u),d*Math.sin(w/u)]}function A(d,p,w="geographic",f=1){if(!l.isValidPixelBlock(d))return d;const {pixels:B,width:F,height:J}=d;
var K=F*J;const L=B[0],N=B[1],R=d.pixelType.startsWith("f")?d.pixelType:"f32",T=g.createEmptyBand(R,K);K=g.createEmptyBand(R,K);let S=0;for(let Y=0;Y<J;Y++)for(let X=0;X<F;X++)"vector-uv"===p?([T[S],K[S]]=x([L[S],N[S]],w),T[S]*=f):([T[S],K[S]]=z([L[S],N[S]],w),T[S]*=f,K[S]*=f),S++;d=new g({pixelType:R,width:d.width,height:d.height,mask:d.mask,validPixelCount:d.validPixelCount,maskIsAlpha:d.maskIsAlpha,pixels:[T,K]});d.updateStatistics();return d}function y(d=0,p=0,w=Math.PI,f=!0){f&&(w=(2*Math.PI-
w)%(2*Math.PI));f=f?-1:1;const B=-7*f,F=-2*f,J=-16*f,[K,L]=n(0,p+13*f,w,21.75),[N,R]=n(d-5.5,p+B,w,21.75),[T,S]=n(d+5.5,p+B,w,21.75),[Y,X]=n(d-1.5,p+F,w,21.75),[ba,aa]=n(d+1.5,p+F,w,21.75),[Z,da]=n(d-1.5,p+J,w,21.75),[ka,ja]=n(d+1.5,p+J,w,21.75);return[K,L,N,R,Y,X,ba,aa,T,S,Z,da,ka,ja]}function E(d=0,p=Math.PI,w=!0){w&&(p=(2*Math.PI-p)%(2*Math.PI));var f=w?-1:1,B=5*f;const F=20*f,J=25*f;f*=2;const K=w?1:-1;w=5*K;let [L,N]=[0+w,0-F],[R,T]=[L+2*K,N],[S,Y]=[R-0*K,T+f],[X,ba]=[0-w,0-J],[aa,Z]=[X+0*K,
ba-f],da=Math.ceil(d/5),ka=Math.floor(da/10);da-=8*ka;d=[];const ja=[];for(let V=0;V<da/2;V++,ka--){0>=ka&&1===da%2&&V===(da-1)/2&&(X=0,aa=X+0*K,ba=(ba+N)/2,Z=ba-f);const [U,Q]=n(X,ba,p,45);if(0<ka){const [ea,ca]=n(R,ba,p,45),[fa,ha]=n(L,N,p,45);d.push(ea);d.push(ca);d.push(U);d.push(Q);d.push(fa);d.push(ha)}else{const [ea,ca]=n(R,T,p,45),[fa,ha]=n(S,Y,p,45),[ia,la]=n(aa,Z,p,45);ja.push(U);ja.push(Q);ja.push(ia);ja.push(la);ja.push(fa);ja.push(ha);ja.push(ea);ja.push(ca)}ba+=B;N+=B;T+=B;Y+=B;Z+=B}const [na,
qa]=n(0+w,0+F,p,45);B=7*K;const [k,G]=n(0+B,0+F,p,45),[M,O]=n(0+w,0-J,p,45),[W,P]=n(0+B,0-J,p,45);return{pennants:d,barbs:ja,shaft:[na,qa,k,G,M,O,W,P]}}function n(d,p,w,f=1){return[Math.sqrt(d*d+p*p)/f,(2*Math.PI+(2*Math.PI+Math.atan2(p,d))%(2*Math.PI)-w)%(2*Math.PI)]}function b(d,p,w,f){w=v(f||"knots",w);for(f=1;f<p.length;f++)if(f===p.length-1){if(d<p[f]*w)break}else if(d<=p[f]*w)break;return Math.min(f-1,p.length-2)}function t(d,p,w,f,B){let F=0;switch(p){case "beaufort_kn":F=b(d,a,"knots",w);
break;case "beaufort_km":F=b(d,a,"kilometer-per-hour",w);break;case "beaufort_ft":F=b(d,a,"feet-per-second",w);break;case "beaufort_m":F=b(d,a,"meter-per-second",w);break;case "classified_arrow":F=b(d,B??[],f,w);break;case "ocean_current_m":F=b(d,e,"meter-per-second",w);break;case "ocean_current_kn":F=b(d,c,"knots",w)}return F}function H(d,p){const {style:w,inputUnit:f,outputUnit:B,breakValues:F}=p,J=D.fromJSON(f),K=D.fromJSON(B);let L=0,N=0;const {width:R,height:T,mask:S}=d,Y=d.pixels[0];d=d.pixels[1];
var X=null!=S?S.filter(Z=>0<Z).length:R*T;const ba=new Float32Array(42*X);X=new Uint32Array(15*X);p=p.invertDirection?y(0,0,0,!1):I;for(let Z=0;Z<T;Z++)for(let da=0;da<R;da++){var aa=Z*R+da;if(!S||S[Z*R+da]){const ka=(d[aa]+360)%360/180*Math.PI,ja=t(Y[aa],w,J,K,F);for(let na=0;na<p.length;na+=2)ba[L++]=(da+.5)/R,ba[L++]=(Z+.5)/T,ba[L++]=p[na],ba[L++]=p[na+1]+ka,ba[L++]=ja,ba[L++]=Y[aa];aa=7*(L/42-1);X[N++]=aa;X[N++]=aa+1;X[N++]=aa+2;X[N++]=aa+0;X[N++]=aa+4;X[N++]=aa+3;X[N++]=aa+0;X[N++]=aa+2;X[N++]=
aa+3;X[N++]=aa+2;X[N++]=aa+5;X[N++]=aa+3;X[N++]=aa+5;X[N++]=aa+6;X[N++]=aa+3}}return{vertexData:ba,indexData:X}}function h(d,p){let w=0,f=0;const {width:B,height:F,mask:J}=d;d=d.pixels[0];const K=[],L=[];var N=D.fromJSON(p.inputUnit);N=v(N,"knots");p="wind_speed"===p.style?5:Number.MAX_VALUE;for(let T=0;T<F;T++)for(let S=0;S<B;S++){var R=d[T*B+S]*N;if((!J||J[T*B+S])&&R<p){for(let Y=0;4>Y;Y++)K[w++]=(S+.5)/B,K[w++]=(T+.5)/F,K[w++]=2>Y?-.5:.5,K[w++]=0===Y%2?-.5:.5,K[w++]=0,K[w++]=R;R=4*(w/24-1);L[f++]=
R;L[f++]=R+1;L[f++]=R+2;L[f++]=R+1;L[f++]=R+2;L[f++]=R+3}}return{vertexData:new Float32Array(K),indexData:new Uint32Array(L)}}const m=new Map;m.set("meter-per-second",1);m.set("kilometer-per-hour",.277778);m.set("knots",.514444);m.set("feet-per-second",.3048);m.set("mile-per-hour",.44704);const u=180/Math.PI,D=new C.JSONMap({esriMetersPerSecond:"meter-per-second",esriKilometersPerHour:"kilometer-per-hour",esriKnots:"knots",esriFeetPerSecond:"feet-per-second",esriMilesPerHour:"mile-per-hour"}),I=y(0,
0,0),a=[0,1,3,6,10,16,21,27,33,40,47,55,63],e=[0,.5,1,1.5,2],c=[0,.25,.5,1,1.5,2,2.5,3,3.5,4],r=[];q.convertToLocalDirections=function(d,p,w,f="geographic"){if(!l.isValidPixelBlock(d)||null==w)return d;d="vector-magdir"===p?d.clone():A(d,p);const B=d.pixels[1];for(let F=0;F<B.length;F++)B[F]="geographic"===f?(B[F]+w[F]+270)%360:(B[F]+360-w[F])%360;return"vector-magdir"===p?d:A(d,"vector-magdir")};q.convertVectorFieldData=A;q.convertVectorFieldUnit=function(d,p,w=1){if(1===w||!l.isValidPixelBlock(d))return d;
d=d.clone();const {pixels:f,width:B,height:F}=d,J=f[0],K=f[1];let L=0;for(let N=0;N<F;N++)for(let R=0;R<B;R++)"vector-uv"===p?(J[L]*=w,K[L]*=w):J[L]*=w,L++;d.updateStatistics();return d};q.createVFMesh=function(d,p){if("simple_scalar"===p.style)p=h(d,p);else if("wind_speed"===p.style){if(0===r.length)for(var w=0;30>w;w++)r.push(E(5*w,0,!p.invertDirection));p=D.fromJSON(p.inputUnit);p=v(p,"knots");const {width:J,height:K,mask:L}=d;w=d.pixels[0];d=d.pixels[1];const N=[],R=[];let T=0,S=0;for(let Y=0;Y<
K;Y++)for(let X=0;X<J;X++){var f=Y*J+X,B=w[f]*p;if((!L||L[Y*J+X])&&5<=B){const ba=(d[f]+360)%360/180*Math.PI,{pennants:aa,barbs:Z,shaft:da}=r[Math.min(Math.floor(B/5),29)];if(0===aa.length+Z.length)continue;f=N.length/6;const ka=(X+.5)/J,ja=(Y+.5)/K;for(var F=0;F<aa.length;F+=2)N[T++]=ka,N[T++]=ja,N[T++]=aa[F],N[T++]=aa[F+1]+ba,N[T++]=0,N[T++]=B;for(F=0;F<Z.length;F+=2)N[T++]=ka,N[T++]=ja,N[T++]=Z[F],N[T++]=Z[F+1]+ba,N[T++]=0,N[T++]=B;for(F=0;F<da.length;F+=2)N[T++]=ka,N[T++]=ja,N[T++]=da[F],N[T++]=
da[F+1]+ba,N[T++]=0,N[T++]=B;for(B=0;B<aa.length/6;B++)R[S++]=f,R[S++]=f+1,R[S++]=f+2,f+=3;for(B=0;B<Z.length/8;B++)R[S++]=f,R[S++]=f+1,R[S++]=f+2,R[S++]=f+1,R[S++]=f+2,R[S++]=f+3,f+=4;R[S++]=f+0;R[S++]=f+1;R[S++]=f+2;R[S++]=f+1;R[S++]=f+3;R[S++]=f+2;f+=4}}p={vertexData:new Float32Array(N),indexData:new Uint32Array(R)}}else p=H(d,p);return p};q.createVFMeshScalar=h;q.getUnitConversionFactor=v;q.sampleVectorField=function(d,p,w,f=[0,0],B=.5){const {width:F,height:J,mask:K}=d,[L,N]=d.pixels,[R,T]=f;
d=Math.round((F-R)/w);f=Math.round((J-T)/w);var S=d*f;const Y=new Float32Array(S),X=new Float32Array(S);S=new Uint8Array(S);p="vector-uv"===p;for(let aa=0;aa<f;aa++)for(let Z=0;Z<d;Z++){let da=0;const ka=aa*d+Z,ja=Math.max(0,aa*w+T),na=Math.max(0,Z*w+R),qa=Math.min(J,ja+w),k=Math.min(F,na+w);for(let G=ja;G<qa;G++)for(let M=na;M<k;M++){var ba=G*F+M;if(!K||K[ba]){da++;ba=p?[L[ba],N[ba]]:[L[ba],(360+N[ba])%360];const [O,W]=p?ba:z(ba);Y[ka]+=O;X[ka]+=W}}if(da>=(qa-ja)*(k-na)*(1-B)){S[ka]=1;const [G,M]=
x([Y[ka]/da,X[ka]/da]);Y[ka]=G;X[ka]=M}else S[ka]=0,Y[ka]=0,X[ka]=0}w=new g({width:d,height:f,pixels:[Y,X],mask:S});w.updateStatistics();return w};q.snapImageToSymbolTile=function(d,p,w,f,B){if(null==B||!B.spatialReference.equals(d.spatialReference))return{extent:d,width:Math.round(p/f),height:Math.round(w/f),resolution:d.width/p};const F=B.xmin;B=B.ymax;p=(d.xmax-d.xmin)/p*f;w=(d.ymax-d.ymin)/w*f;d.xmin=F+Math.floor((d.xmin-F)/p)*p;d.xmax=F+Math.ceil((d.xmax-F)/p)*p;d.ymin=B+Math.floor((d.ymin-B)/
w)*w;d.ymax=B+Math.ceil((d.ymax-B)/w)*w;return{extent:d,width:Math.round(d.width/p),height:Math.round(d.height/w),resolution:(p+w)/2}};q.unitKebabDict=D;q.uvComponentToVector=x;Object.defineProperty(q,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/rasterFunctions/pixelUtils":function(){define(["exports","../PixelBlock","../rasterFormats/pixelRangeUtils"],function(q,C,g){function l(a){return null!=a&&"esri.layers.support.PixelBlock"===a.declaredClass&&a.pixels&&0<a.pixels.length}function v(a,
e,c,r,d){const p=a.length;d=C.createEmptyBand(d,p);if(e)for(let w=0;w<p;w++)e[w]&&(d[w]=c[a[w]-r]);else for(e=0;e<p;e++)d[e]=c[a[e]-r];return d}function x(a,e,c,r){const d=null!=c&&2<=c.length?new Set(c):null;c=1===c?.length?c[0]:null;const p=!!e?.length;for(let w=0;w<a.length;w++)if(r[w]){const f=a[w];if(p){let B=!1;for(let F=0;F<e.length;F+=2)if(f>=e[F]&&f<=e[F+1]){B=!0;break}B||(r[w]=0)}r[w]&&(f===c||d?.has(f))&&(r[w]=0)}}function z(a,e){const c=a[0].length;for(let r=0;r<c;r++)if(e[r]){let d=!1;
for(let p=0;p<a.length;p++)if(a[p][r]){d=!0;break}d||(e[r]=0)}}function A(a,e){const c=a[0].length;for(let r=0;r<c;r++)if(e[r]){let d=!1;for(let p=0;p<a.length;p++)if(0===a[p][r]){d=!0;break}d&&(e[r]=0)}}function y(a,e,c,r,d,p,w,f){return{xmin:d<=c*a?0:d<c*a+a?d-c*a:a,ymin:p<=r*e?0:p<r*e+e?p-r*e:e,xmax:d+w<=c*a?0:d+w<c*a+a?d+w-c*a:a,ymax:p+f<=r*e?0:p+f<r*e+e?p+f-r*e:e}}function E(a,e,c,r,d,p){const {width:w,height:f}=c.block,{x:B,y:F}=c.offset,{width:J,height:K}=c.mosaic;c=y(w,f,r,d,B,F,J,K);let L=
0;var N=0;if(p){var R=p.hasGCSSShiftTransform?360:p.halfWorldWidth??0,T=w*p.resolutionX;const S=p.startX+r*T;S<R&&S+T>R?N=p.rightPadding:S>=R&&(L=p.leftMargin-p.rightPadding,N=0)}c.xmax-=N;if("number"===typeof e)for(p=c.ymin;p<c.ymax;p++)for(N=(d*f+p-F)*J+(r*w-B)+L,R=c.xmin;R<c.xmax;R++)a[N+R]=e;else for(p=c.ymin;p<c.ymax;p++)for(N=(d*f+p-F)*J+(r*w-B)+L,R=p*w,T=c.xmin;T<c.xmax;T++)a[N+T]=e[R+T]}function n(a,e,c={}){const {clipOffset:r,clipSize:d,alignmentInfo:p,blockWidths:w}=c;if(w)return b(a,e,
{blockWidths:w});var f=a.find(ba=>l(ba));if(null==f)return null;c=d?d.width:e.width;const B=d?d.height:e.height;var F=f.width,J=f.height;const K=e.width/F,L=e.height/J;e={offset:r||{x:0,y:0},mosaic:d||e,block:{width:F,height:J}};F=f.pixelType;var N=C.getPixelArrayConstructor(F);f=f.pixels.length;J=[];for(var R=0;R<f;R++){var T=new N(c*B);for(var S=0;S<L;S++)for(var Y=0;Y<K;Y++){var X=a[S*K+Y];l(X)&&(X=X.pixels[R],E(T,X,e,Y,S,p))}J.push(T)}N=a.some(ba=>null==ba||null!=ba.mask&&0<ba.mask.length);T=
a.some(ba=>ba?.bandMasks&&1<ba.bandMasks.length);N=N?new Uint8Array(c*B):void 0;T=T?[]:void 0;if(N){for(R=0;R<L;R++)for(S=0;S<K;S++)Y=a[R*K+S],X=null!=Y?Y.mask:null,null!=X?E(N,X,e,S,R,p):Y?E(N,255,e,S,R,p):E(N,0,e,S,R,p);if(T)for(R=0;R<f;R++){S=new Uint8Array(c*B);for(Y=0;Y<L;Y++)for(X=0;X<K;X++){const ba=a[Y*K+X],aa=ba?.bandMasks?.[R]??ba?.mask;null!=aa?E(S,aa,e,X,Y,p):ba?E(S,255,e,X,Y,p):E(S,0,e,X,Y,p)}T.push(S)}}a=new C({width:c,height:B,pixels:J,pixelType:F,bandMasks:T,mask:N});a.updateStatistics();
return a}function b(a,e,c){const r=a.find(S=>null!=S);if(null==r)return null;var d=a.some(S=>null!=S?!!S.mask:!0);const {width:p,height:w}=e;e=d?new Uint8Array(p*w):null;({blockWidths:c}=c);const f=[],B=r.getPlaneCount(),F=C.getPixelArrayConstructor(r.pixelType);if(d)for(let S=0,Y=0;S<a.length;Y+=c[S],S++)if(d=a[S],l(d)){var J=d.mask;for(var K=0;K<w;K++)for(var L=0;L<c[S];L++)e[K*p+L+Y]=null==J?255:J[K*d.width+L]}J=(d=a.some(S=>S?.bandMasks&&1<S.bandMasks.length))?[]:void 0;K=p*w;for(L=0;L<B;L++){const S=
new F(K),Y=d?new Uint8Array(K):void 0;for(let X=0,ba=0;X<a.length;ba+=c[X],X++){const aa=a[X];if(l(aa)){var N=aa.pixels[L];if(null!=N){for(var R=0;R<w;R++)for(var T=0;T<c[X];T++)S[R*p+T+ba]=N[R*aa.width+T];if(Y)for(N=aa.bandMasks?.[L]??aa.mask,R=0;R<w;R++)for(T=0;T<c[X];T++)Y[R*p+T+ba]=N?N[R*aa.width+T]:255}}}f.push(S);J&&Y&&J.push(Y)}a=new C({width:p,height:w,mask:e,bandMasks:J,pixels:f,pixelType:r.pixelType});a.updateStatistics();return a}function t(a){if(!l(a))return null;const e=a.clone(),{width:c,
height:r,pixels:d}=a;var p=d[0];const w=e.pixels[0];a=a.mask;for(let F=2;F<r-1;F++){const J=new Map;for(var f=F-2;f<F+2;f++)for(var B=0;4>B;B++){const K=f*c+B;m(J,p[K],a?a[K]:1)}w[F*c]=H(J);w[F*c+1]=w[F*c+2]=w[F*c];for(f=3;f<c-1;f++)B=(F-2)*c+f+1,m(J,p[B],a?a[B]:1),B=(F-1)*c+f+1,m(J,p[B],a?a[B]:1),B=F*c+f+1,m(J,p[B],a?a[B]:1),B=(F+1)*c+f+1,m(J,p[B],a?a[B]:1),B=(F-2)*c+f-3,h(J,p[B],a?a[B]:1),B=(F-1)*c+f-3,h(J,p[B],a?a[B]:1),B=F*c+f-3,h(J,p[B],a?a[B]:1),B=(F+1)*c+f-3,h(J,p[B],a?a[B]:1),w[F*c+f]=H(J);
w[F*c+f+1]=w[F*c+f]}for(p=0;p<c;p++)w[p]=w[c+p]=w[2*c+p],w[(r-1)*c+p]=w[(r-2)*c+p];e.updateStatistics();return e}function H(a){if(0===a.size)return 0;let e=0,c=-1,r=0;const d=a.keys();let p=d.next();for(;!p.done;)r=a.get(p.value),r>e&&(c=p.value,e=r),p=d.next();return c}function h(a,e,c){0!==c&&(c=a.get(e),1===c?a.delete(e):a.set(e,c-1))}function m(a,e,c){0!==c&&a.set(e,a.has(e)?a.get(e)+1:1)}function u(a,e,c){let {x:r,y:d}=e;const {width:p,height:w}=c;if(0===r&&0===d&&w===a.height&&p===a.width)return a;
const {width:f,height:B}=a;e=Math.max(0,d);const F=Math.max(0,r),J=Math.min(r+p,f),K=Math.min(d+w,B);if(0>J||0>K||!l(a))return null;r=Math.max(0,-r);d=Math.max(0,-d);var {pixels:L}=a,N=p*w,R=L.length;const T=[];for(var S=0;S<R;S++){var Y=L[S],X=C.createEmptyBand(a.pixelType,N);for(let ba=e;ba<K;ba++){const aa=ba*f;let Z=(ba+d-e)*p+r;for(let da=F;da<J;da++)X[Z++]=Y[aa+da]}T.push(X)}L=new Uint8Array(N);N=a.mask;for(R=e;R<K;R++)for(S=R*f,Y=(R+d-e)*p+r,X=F;X<J;X++)L[Y++]=N?N[S+X]:1;a=new C({width:c.width,
height:c.height,pixelType:a.pixelType,pixels:T,mask:L});a.updateStatistics();return a}function D(a,e=!0){if(!l(a))return null;const {pixels:c,width:r,height:d,mask:p,pixelType:w}=a;a=[];const f=Math.round(r/2),B=Math.round(d/2),F=d-1,J=r-1;for(var K=0;K<c.length;K++){var L=c[K],N=C.createEmptyBand(w,f*B),R=0;for(var T=0;T<d;T+=2)for(var S=0;S<r;S+=2){var Y=L[T*r+S];if(e){var X=S===J?Y:L[T*r+S+1];const ba=T===F?Y:L[T*r+S+r],aa=S===J?ba:T===F?X:L[T*r+S+r+1];N[R++]=(Y+X+ba+aa)/4}else N[R++]=Y}a.push(N)}K=
null;if(null!=p)for(K=new Uint8Array(f*B),L=0,N=0;N<d;N+=2)for(R=0;R<r;R+=2)T=p[N*r+R],e?(S=R===J?T:p[N*r+R+1],Y=N===F?T:p[N*r+R+r],X=R===J?Y:N===F?S:p[N*r+R+r+1],K[L++]=T*S*Y*X?1:0):K[L++]=T;return new C({width:f,height:B,pixelType:w,pixels:a,mask:K})}function I(a,e,c,r,d=0){const {width:p,height:w}=a,{width:f,height:B}=e;a=r.cols;r=r.rows;e=Math.ceil(f/a-.1/a);const F=Math.ceil(B/r-.1/r);let J,K,L,N,R;const T=e*a;var S=T*F*r;const Y=new Float32Array(S),X=new Float32Array(S),ba=new Uint32Array(S),
aa=new Uint32Array(S);let Z=0,da,ka;for(let qa=0;qa<F;qa++)for(let k=0;k<e;k++){var ja=12*(qa*e+k);S=c[ja];J=c[ja+1];K=c[ja+2];L=c[ja+3];N=c[ja+4];R=c[ja+5];for(var na=0;na<r;na++){Z=(qa*r+na)*T+k*a;ka=(na+.5)/r;for(let G=0;G<na;G++)da=(G+.5)/a,Y[Z+G]=(S*da+J*ka+K)*p+d,X[Z+G]=(L*da+N*ka+R)*w+d,ba[Z+G]=Math.floor(Y[Z+G]),aa[Z+G]=Math.floor(X[Z+G])}ja+=6;S=c[ja];J=c[ja+1];K=c[ja+2];L=c[ja+3];N=c[ja+4];R=c[ja+5];for(ja=0;ja<r;ja++)for(Z=(qa*r+ja)*T+k*a,ka=(ja+.5)/r,na=ja;na<a;na++)da=(na+.5)/a,Y[Z+na]=
(S*da+J*ka+K)*p+d,X[Z+na]=(L*da+N*ka+R)*w+d,ba[Z+na]=Math.floor(Y[Z+na]),aa[Z+na]=Math.floor(X[Z+na])}return{offsets_x:Y,offsets_y:X,offsets_xi:ba,offsets_yi:aa,gridWidth:T}}q.NoDataInterpretation=void 0;(function(a){a[a.matchAny=0]="matchAny";a[a.matchAll=1]="matchAll"})(q.NoDataInterpretation||(q.NoDataInterpretation={}));q.MissingBandAction=void 0;(function(a){a[a.bestMatch=0]="bestMatch";a[a.fail=1]="fail"})(q.MissingBandAction||(q.MissingBandAction={}));q.approximateTransform=function(a,e,c,
r,d="nearest"){if(!l(a))return null;"majority"===d&&(a=t(a));const {pixels:p,mask:w,bandMasks:f,pixelType:B}=a,F=a.width;var J=a.height;const K=C.getPixelArrayConstructor(B),L=p.length,{width:N,height:R}=e;a=!1;for(var T=0;T<c.length;T+=3)-1===c[T]&&-1===c[T+1]&&-1===c[T+2]&&(a=!0);const {offsets_x:S,offsets_y:Y,offsets_xi:X,offsets_yi:ba,gridWidth:aa}=I({width:F,height:J},e,c,r,"majority"===d?.5:0);let Z;e=(ka,ja,na,qa)=>{const k=ka instanceof Float32Array||ka instanceof Float64Array?0:.5;for(let G=
0;G<R;G++){Z=G*aa;for(let M=0;M<N;M++){if(0>S[Z]||0>Y[Z])ka[G*N+M]=0;else if(qa)ka[G*N+M]=ja[X[Z]+ba[Z]*F];else{const O=Math.floor(S[Z]),W=Math.floor(Y[Z]),P=Math.ceil(S[Z]),V=Math.ceil(Y[Z]),U=S[Z]-O,Q=Y[Z]-W;ka[G*N+M]=!na||na[O+W*F]&&na[P+W*F]&&na[O+V*F]&&na[P+V*F]?(1-Q)*((1-U)*ja[O+W*F]+U*ja[P+W*F])+Q*((1-U)*ja[O+V*F]+U*ja[P+V*F])+k:ja[X[Z]+ba[Z]*F]}Z++}}};c=[];r=f?.length===L;J=[];for(T=0;T<L;T++){if(r){var da=new Uint8Array(N*R);e(da,f[T],f[T],!0);J.push(da)}da=new K(N*R);e(da,p[T],r?f[T]:w,
"nearest"===d||"majority"===d);c.push(da)}d=new C({width:N,height:R,pixelType:B,pixels:c,bandMasks:r?J:void 0});if(null!=w)d.mask=new Uint8Array(N*R),e(d.mask,w,w,!0);else if(a)for(d.mask=new Uint8Array(N*R),a=0;a<N*R;a++)d.mask[a]=0>S[a]||0>Y[a]?0:1;d.updateStatistics();return d};q.clip=u;q.clipTile=function(a){const {pixelBlock:e,tileSize:c,level:r,row:d,col:p,useBilinear:w}=a;if(!l(e))return null;const {width:f,height:B}=c;var F=2**r;a=F*f;F*=B;a=u(e,{y:d*F,x:p*a},{width:a,height:F});if(!a)return null;
for(F=r;0<F;F--)a=D(a,w);return a};q.colorize=function(a,e){if(!l(a)||!e||!e.indexedColormap&&!e.indexed2DColormap)return a;const c=a.clone();var r=c.pixels;let d=c.mask;const p=c.width*c.height;if(1!==r.length)return a;const {indexedColormap:w,indexed2DColormap:f,offset:B,alphaSpecified:F}=e;a=0;r=r[0];e=new Uint8Array(r.length);const J=new Uint8Array(r.length),K=new Uint8Array(r.length);var L=0;if(w){const N=w.length-1;if(null!=d)for(a=0;a<p;a++)d[a]&&(L=4*(r[a]-B),L<B||L>N?d[a]=0:(e[a]=w[L],J[a]=
w[L+1],K[a]=w[L+2],d[a]=w[L+3]));else{d=new Uint8Array(p);for(a=0;a<p;a++)L=4*(r[a]-B),L<B||L>N?d[a]=0:(e[a]=w[L],J[a]=w[L+1],K[a]=w[L+2],d[a]=w[L+3]);c.mask=d}}else if(f)if(null!=d)for(a=0;a<p;a++)d[a]&&(L=f[r[a]],e[a]=L[0],J[a]=L[1],K[a]=L[2],d[a]=L[3]);else{d=new Uint8Array(p);for(a=0;a<p;a++)L=f[r[a]],e[a]=L[0],J[a]=L[1],K[a]=L[2],d[a]=L[3];c.mask=d}c.pixels=[e,J,K];c.statistics=null;c.pixelType="u8";c.maskIsAlpha=F;return c};q.compositeBands=function(a){if(!a?.length||a.some(B=>!l(B)))return null;
if(1===a.length)return a[0]?.clone()??null;const {width:e,height:c,pixelType:r}=a[0];if(a.some(B=>B.width!==e||B.height!==c))return null;const d=a.map(({mask:B})=>B).filter(B=>null!=B);let p=null;d.length&&(p=new Uint8Array(e*c),p.set(d[0]),1<d.length&&A(d.slice(1),p));const w=[];a.forEach(({pixels:B})=>w.push(...B));const f=[];a.map(({statistics:B})=>B).filter(B=>B?.length).forEach(B=>f.push(...B));return new C({pixelType:r,width:e,height:c,mask:p,pixels:w,statistics:f.length?f:null})};q.createColormapLUT=
function(a){if(a){var e=a.colormap;if(e&&0!==e.length){e=e.sort((F,J)=>F[0]-J[0]);var c=0;0>e[0][0]&&(c=e[0][0]);var r=Math.max(256,e[e.length-1][0]-c+1),d=new Uint8Array(4*r),p=[],w=0,f=0,B=5===e[0].length;if(65536<r)return e.forEach(F=>{p[F[0]-c]=B?F.slice(1):F.slice(1).concat([255])}),{indexed2DColormap:p,offset:c,alphaSpecified:B};if(a.fillUnspecified)for(a=e[f],w=a[0]-c;w<r;w++)d[4*w]=a[1],d[4*w+1]=a[2],d[4*w+2]=a[3],d[4*w+3]=B?a[4]:255,w===a[0]-c&&(a=f===e.length-1?a:e[++f]);else for(w=0;w<
e.length;w++)a=e[w],f=4*(a[0]-c),d[f]=a[1],d[f+1]=a[2],d[f+2]=a[3],d[f+3]=B?a[4]:255;return{indexedColormap:d,offset:c,alphaSpecified:B}}}};q.createMaskLUT=function(a,e,c){if("u8"!==a&&"s8"!==a&&"u16"!==a&&"s16"!==a)return null;var r=a.includes("16")?65536:256;a=a.includes("s")?-r/2:0;r=new Uint8Array(r);if(e)for(let p=0;p<e.length;p++){var d=Math.ceil(e[2*p]-a);const w=Math.floor(e[2*p+1]-a);for(;d<=w;d++)r[d]=255}else r.fill(255);if(c)for(e=0;e<c.length;e++)r[c[e]-a]=0;return{lut:r,offset:a}};q.createRemapLUT=
function(a){const {srcPixelType:e,inputRanges:c,outputValues:r,allowUnmatched:d,noDataRanges:p,isLastInputRangeInclusive:w,outputPixelType:f}=a;if("u8"!==e&&"s8"!==e&&"u16"!==e&&"s16"!==e)return null;var B=e.includes("16")?65536:256;a=e.includes("s")?-B/2:0;const F=C.createEmptyBand(f,B);B=new Uint8Array(B);d&&B.fill(255);const [J,K]=g.getPixelValueRange(f);if(c?.length&&r?.length){var L=c.map(S=>S-1E-6);L[0]=c[0];w&&(L[L.length-1]=c[c.length-1]);for(var N=0;N<L.length;N++){var R=r[N]>K?K:r[N]<J?
J:r[N],T=Math.ceil(L[2*N]-a);const S=Math.floor(L[2*N+1]-a);for(;T<=S;T++)F[T]=R,B[T]=255}}if(p?.length)for(L=0;L<p.length;L++)for(R=Math.ceil(p[2*L]-a),N=Math.floor(p[2*L+1]-a);R<=N;R++)B[R]=0;return{lut:F,offset:a,mask:B}};q.extractBands=function(a,e){return e?.length&&l(a)?a.extractBands(e):a};q.getClipBounds=y;q.getLocalArithmeticNorthRotations=function(a,e){const {coefficients:c,spacing:r}=e,{offsets_x:d,offsets_y:p,gridWidth:w}=I(a,a,c,{rows:r[0],cols:r[1]}),{width:f,height:B}=a;a=new Float32Array(f*
B);e=180/Math.PI;for(let K=0;K<B;K++)for(let L=0;L<f;L++){var F=K*w+L,J=0===K?F:F-w;const N=K===B-1?F:F+w;F=d[J]-d[N];J=p[N]-p[J];isNaN(F)||isNaN(J)?a[K*f+L]=90:(J=Math.atan2(J,F)*e,J=(360+J)%360,a[K*f+L]=J)}return a};q.interpolateOffsets=I;q.isValidPixelBlock=l;q.lookupBandValues=v;q.lookupPixels=function(a,e){if(!l(a))return null;const {pixels:c,mask:r}=a,d=c.length;let p=e.lut;const {offset:w}=e;p&&1===p[0].length&&(p=c.map(()=>p));const f=[];e=e.outputPixelType||"u8";for(let B=0;B<d;B++){const F=
v(c[B],r,p[B],w||0,e);f.push(F)}a=new C({width:a.width,height:a.height,pixels:f,mask:r,pixelType:e});a.updateStatistics();return a};q.mask=function(a,e){if(!l(a))return null;const {width:c,height:r,pixels:d}=a;var p=c*r;const w=new Uint8Array(p);a.mask?w.set(a.mask):w.fill(255);a=d.length;const {includedRanges:f,noDataValues:B,outputPixelType:F,matchAll:J,lookups:K}=e;if(K){p=[];for(e=0;e<a;e++){var L=K[e];L=v(d[e],w,L.lut,L.offset||0,"u8");p.push(L)}1===p.length?w.set(p[0]):J?z(p,w):A(p,w)}else if(J){e=
[];for(L=0;L<a;L++){const N=new Uint8Array(p);N.set(w);x(d[L],f?.slice(2*L,2*L+2),B?.[L],N);e.push(N)}1===e.length?w.set(e[0]):z(e,w)}else for(p=0;p<a;p++)x(d[p],f?.slice(2*p,2*p+2),B?.[p],w);return new C({width:c,height:r,pixelType:F,pixels:d,mask:w})};q.maxMapSizeGpu=6;q.mosaic=n;q.mosaicPixelData=function(a,e){if(!a||0===a.length)return null;var c=a.find(K=>K.pixelBlock);if(null==c?.pixelBlock)return null;var r=(c.extent.xmax-c.extent.xmin)/c.pixelBlock.width;const d=(c.extent.ymax-c.extent.ymin)/
c.pixelBlock.height,p=.01*Math.min(r,d),w=a.sort((K,L)=>Math.abs(K.extent.ymax-L.extent.ymax)>p?L.extent.ymax-K.extent.ymax:Math.abs(K.extent.xmin-L.extent.xmin)>p?K.extent.xmin-L.extent.xmin:0);var f=Math.min.apply(null,w.map(K=>K.extent.xmin));const B=Math.min.apply(null,w.map(K=>K.extent.ymin)),F=Math.max.apply(null,w.map(K=>K.extent.xmax)),J=Math.max.apply(null,w.map(K=>K.extent.ymax));a={x:Math.round((e.xmin-f)/r),y:Math.round((J-e.ymax)/d)};f={width:Math.round((F-f)/r),height:Math.round((J-
B)/d)};r={width:Math.round((e.xmax-e.xmin)/r),height:Math.round((e.ymax-e.ymin)/d)};if(Math.round(f.width/c.pixelBlock.width)*Math.round(f.height/c.pixelBlock.height)!==w.length||0>a.x||0>a.y||f.width<r.width||f.height<r.height)return null;c=w.map(K=>K.pixelBlock);c=n(c,f,{clipOffset:a,clipSize:r});return{extent:e,pixelBlock:c}};q.remap=function(a,e){if(!l(a))return null;const {width:c,height:r}=a,{inputRanges:d,outputValues:p,outputPixelType:w,noDataRanges:f,allowUnmatched:B,isLastInputRangeInclusive:F}=
e;e=a.pixels[0];const J=C.createEmptyBand(w,e.length),K=a.mask,L=new Uint8Array(c*r);K?L.set(K):L.fill(255);const N=a.pixelType.startsWith("f")?1E-6:0;a=d.map(Z=>Z-N);a[0]=d[0];a[a.length-1]=d[d.length-1]+(F?1E-6:0);var R=d.length/2;const [T,S]=g.getPixelValueRange(w);for(var Y=0;Y<r;Y++)for(var X=0;X<c;X++){var ba=Y*c+X;if(L[ba]){var aa=e[ba];let Z=!1;for(let da=R-1;0<=da;da--)if(aa===a[2*da]||aa>a[2*da]&&aa<a[2*da+1]){J[ba]=p[da];Z=!0;break}Z||(B?J[ba]=aa>S?S:aa<T?T:aa:L[ba]=0)}}if(a=f?.length)for(R=
0;R<r;R++)for(Y=0;Y<c;Y++)if(X=R*c+Y,!K||K[X])for(ba=e[X],aa=0;aa<a;aa+=2)if(ba>=f[aa]&&ba<=f[aa+1]){J[X]=0;L[X]=0;break}return new C({width:c,height:r,pixelType:w,pixels:[J],mask:L})};q.remapColor=function(a,e){if(!l(a))return null;a=a.clone();var {pixels:c}=a;const r=a.width*a.height,d=e.length,p=Math.floor(d/2),w=e[Math.floor(p)];c=c[0];let f,B,F,J,K,L,N=!1;const R=new Uint8Array(r),T=new Uint8Array(r),S=new Uint8Array(r);let Y=a.mask;const X=4===e[0].mappedColor.length;Y||(Y=new Uint8Array(r),
Y.fill(X?255:1),a.mask=Y);for(K=0;K<r;K++)if(Y[K]){f=c[K];N=!1;L=p;B=w;F=0;for(J=d-1;1<J-F;){if(f===B.value){N=!0;break}f>B.value?F=L:J=L;L=Math.floor((F+J)/2);B=e[Math.floor(L)]}N||(f===e[F].value?(B=e[F],N=!0):f===e[J].value?(B=e[J],N=!0):f<e[F].value?(N=!1,B=null):f>e[F].value&&(f<e[J].value?(B=e[F],N=!0):J===d-1?(N=!1,B=null):(B=e[J],N=!0)));N?(R[K]=B.mappedColor[0],T[K]=B.mappedColor[1],S[K]=B.mappedColor[2],Y[K]=B.mappedColor[3]):R[K]=T[K]=S[K]=Y[K]=0}a.pixels=[R,T,S];a.mask=Y;a.pixelType="u8";
a.maskIsAlpha=X;return a};q.resampleByMajority=t;q.setValidBoundary=function(a,e,c){if(!l(a))return null;const {width:r,height:d}=a,p=e.x;e=e.y;const w=c.width+p;c=c.height+e;if(0>p||0>e||w>r||c>d||0===p&&0===e&&w===r&&c===d)return a;a.mask||(a.mask=new Uint8Array(r*d));const f=a.mask;for(let B=0;B<d;B++){const F=B*r;for(let J=0;J<r;J++)f[F+J]=B<e||B>=c||J<p||J>=w?0:1}a.updateStatistics();return a};q.split=function(a,e,c=0,r=!0){if(!l(a))return null;const {width:d,height:p}=e;let {width:w,height:f}=
a;const B=new Map,F={x:0,y:0};c=1+c;for(let J=0;J<c;J++){const K=Math.ceil(w/d),L=Math.ceil(f/p);for(let N=0;N<L;N++){F.y=N*p;for(let R=0;R<K;R++){F.x=R*d;const T=u(a,F,e);B.set(`${J}/${N}/${R}`,T)}}J<c-1&&(a=D(a,r));w=Math.round(w/2);f=Math.round(f/2)}return B};Object.defineProperty(q,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/imagery/RasterVFTileContainer":function(){define("exports ../../../../geometry/support/aaBoundingRect ./BrushVectorField ./RasterVFTile ../webgl/enums ../webgl/TileContainer".split(" "),
function(q,C,g,l,v,x){class z extends x{constructor(){super(...arguments);this.isCustomTilingScheme=!1;this.symbolTypes=["triangle"]}createTile(A){const y=this.tileInfoView.getTileBounds(C.create(),A),[E,n]=this.tileInfoView.tileInfo.size,b=this.tileInfoView.getTileResolution(A.level);return new l.RasterVFTile(A,b,y[0],y[3],E,n)}prepareRenderPasses(A){const y=A.registerRenderPass({name:"imagery (vf tile)",brushes:[g],target:()=>this.children.map(E=>E.tileData),drawPhase:v.WGLDrawPhase.MAP});return[...super.prepareRenderPasses(A),
y]}doRender(A){this.visible&&A.drawPhase===v.WGLDrawPhase.MAP&&this.symbolTypes.forEach(y=>{A.renderPass=y;super.doRender(A)})}}q.RasterVFTileContainer=z;Object.defineProperty(q,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/imagery/BrushVectorField":function(){define(["../webgl/brushes/WGLBrush","../../../webgl/enums"],function(q,C){const g=new Float32Array([.27058823529411763,.4588235294117647,.7098039215686275,1,.396078431372549,.5372549019607843,.7215686274509804,1,.5176470588235295,
.6196078431372549,.7294117647058823,1,.6352941176470588,.7058823529411765,.7411764705882353,1,.7529411764705882,.8,.7450980392156863,1,.8705882352941177,.8901960784313725,.7490196078431373,1,1,1,.7490196078431373,1,1,.8627450980392157,.6313725490196078,1,.9803921568627451,.7254901960784313,.5176470588235295,1,.9607843137254902,.596078431372549,.4117647058823529,1,.9294117647058824,.4588235294117647,.3176470588235294,1,.9098039215686274,.08235294117647059,.08235294117647059,1]),l=new Float32Array([0,
92/255,230/255,1]),v={beaufort_ft:g,beaufort_m:g,beaufort_km:g,beaufort_mi:g,beaufort_kn:new Float32Array([.1568627450980392,.5725490196078431,.7803921568627451,1,.34901960784313724,.6352941176470588,.7294117647058823,1,.5058823529411764,.7019607843137254,.6705882352941176,1,.6274509803921569,.7607843137254902,.6078431372549019,1,.7490196078431373,.8313725490196079,.5411764705882353,1,.8549019607843137,.9019607843137255,.4666666666666667,1,.9803921568627451,.9803921568627451,.39215686274509803,1,
.9882352941176471,.8352941176470589,.3254901960784314,1,.9882352941176471,.7019607843137254,.4,1,.9803921568627451,.5529411764705883,.20392156862745098,1,.9686274509803922,.43137254901960786,.16470588235294117,1,.9411764705882353,.2784313725490196,.11372549019607843,1]),classified_arrow:new Float32Array([.2196078431372549,.6588235294117647,0,1,.5450980392156862,1.2117647058823529,0,1,1,1,0,1,1,.5019607843137255,0,1,1,0,0,1]),ocean_current_m:new Float32Array([.3058823529411765,.10196078431372549,.6,
1,.7019607843137254,.10588235294117647,.10196078431372549,1,.792156862745098,.5019607843137255,.10196078431372549,1,.6941176470588235,.6941176470588235,.6941176470588235,1]),ocean_current_kn:new Float32Array([0,0,0,1,0,.1450980392156863,.39215686274509803,1,.3058823529411765,.10196078431372549,.6,1,.592156862745098,0,.39215686274509803,1,.7019607843137254,.10588235294117647,.10196078431372549,1,.6941176470588235,.3058823529411765,.10196078431372549,1,.792156862745098,.5019607843137255,.10196078431372549,
1,.6941176470588235,.7019607843137254,.20392156862745098,1,.6941176470588235,.6941176470588235,.6941176470588235,1]),simple_scalar:l,single_arrow:l,wind_speed:new Float32Array([0,0,0,1])},x=[0,20];class z extends q{constructor(){super(...arguments);this._desc={magdir:{vsPath:"raster/magdir",fsPath:"raster/magdir",attributes:new Map([["a_pos",0],["a_offset",1],["a_vv",2]])},scalar:{vsPath:"raster/scalar",fsPath:"raster/scalar",attributes:new Map([["a_pos",0],["a_offset",1],["a_vv",2]])}}}dispose(){}prepareState({context:A}){A.setBlendingEnabled(!0);
A.setBlendFunctionSeparate(C.BlendFactor.ONE,C.BlendFactor.ONE_MINUS_SRC_ALPHA,C.BlendFactor.ONE,C.BlendFactor.ONE_MINUS_SRC_ALPHA);A.setColorMask(!0,!0,!0,!0);A.setStencilWriteMask(0);A.setStencilTestEnabled(!0);A.setStencilOp(C.StencilOperation.KEEP,C.StencilOperation.KEEP,C.StencilOperation.REPLACE)}draw(A,y){if(null!=y.source&&0!==y.source.validPixelCount){var {context:E,timeline:n}=A;n.begin(this.name);E.setStencilFunction(C.CompareFunction.EQUAL,y.stencilRef,255);y.updateVectorFieldVAO(A);if("scalar"===
A.renderPass){var b=y.vaoData.scalar;b&&this._drawScalars(A,y,b.vao,b.elementCount)}else(b=y.vaoData.magdir)&&this._drawTriangles(A,y,b.vao,b.elementCount);n.end(this.name)}}_drawTriangles(A,y,E,n){const {context:b,painter:t,requestRender:H,allowDelayedRender:h}=A,{symbolizerParameters:m}=y;var u=m.dataRange?["dataRange"]:[];"geographic"===m.rotationType&&u.push("rotationGeographic");u=t.materialManager.getProgram(this._desc.magdir,u);if(h&&null!=H&&!u.compiled)H();else{b.useProgram(u);var {coordScale:D,
opacity:I,transforms:a}=y;u.setUniform2fv("u_coordScale",D);u.setUniform1f("u_opacity",I);u.setUniformMatrix3fv("u_dvsMat3",a.displayViewScreenMat3);var {style:e,dataRange:c,rotation:r,symbolPercentRange:d}=m;u.setUniform4fv("u_colors",v[e]);u.setUniform2fv("u_dataRange",c||x);u.setUniform1f("u_rotation",r);u.setUniform2fv("u_symbolPercentRange",d);A=this._getSymbolSize(A,y);u.setUniform2fv("u_symbolSize",A);b.bindVAO(E);b.drawElements(C.PrimitiveType.TRIANGLES,n,C.DataType.UNSIGNED_INT,0)}}_drawScalars(A,
y,E,n){const {context:b,painter:t,requestRender:H,allowDelayedRender:h}=A,{symbolizerParameters:m}=y;var u=[];"wind_speed"===m.style?u.push("innerCircle"):m.dataRange&&u.push("dataRange");"geographic"===m.rotationType&&u.push("rotationGeographic");u=t.materialManager.getProgram(this._desc.scalar,u);if(h&&null!=H&&!u.compiled)H();else{b.useProgram(u);var {coordScale:D,opacity:I,transforms:a}=y;u.setUniform2fv("u_coordScale",D);u.setUniform1f("u_opacity",I);u.setUniformMatrix3fv("u_dvsMat3",a.displayViewScreenMat3);
var {dataRange:e,symbolPercentRange:c}=m;u.setUniform2fv("u_dataRange",e||x);u.setUniform2fv("u_symbolPercentRange",c);A=this._getSymbolSize(A,y);u.setUniform2fv("u_symbolSize",A);b.bindVAO(E);b.drawElements(C.PrimitiveType.TRIANGLES,n,C.DataType.UNSIGNED_INT,0)}}_getSymbolSize(A,y){A=y.key?2**(A.displayLevel-y.key.level):y.resolution/A.state.resolution;const {symbolTileSize:E}=y.symbolizerParameters;return[E/(Math.round((y.width-y.offset[0])/E)*E)/A,E/(Math.round((y.height-y.offset[1])/E)*E)/A]}}
return z})},"esri/views/2d/engine/imagery/RasterVFTile":function(){define(["exports","../../../../core/libs/gl-matrix-2/math/mat3","../../../../core/libs/gl-matrix-2/factories/mat3f32","./RasterVFDisplayObject","../webgl/TiledDisplayObject"],function(q,C,g,l,v){class x extends v.TiledDisplayObject{constructor(z,A,y,E,n,b,t=null){super(z,A,y,E,n,b);this.tileData=new l.RasterVFDisplayObject(t);this.tileData.coordScale=[n,b];this.tileData.once("isReady",()=>this.ready())}destroy(){super.destroy();this.tileData.destroy();
this.stage=this.tileData=null}set stencilRef(z){this.tileData.stencilRef=z}get stencilRef(){return this.tileData.stencilRef}_createTransforms(){return{displayViewScreenMat3:g.create(),tileMat3:g.create()}}setTransform(z){super.setTransform(z);const A=this.resolution/(z.resolution*z.pixelRatio),y=this.transforms.tileMat3,[E,n]=this.tileData.offset,[b,t]=z.toScreenNoRotation([0,0],[this.x+E*this.resolution,this.y-n*this.resolution]),{symbolTileSize:H}=this.tileData.symbolizerParameters;C.set(y,Math.round((this.width-
this.tileData.offset[0])/H)*H/this.rangeX*A,0,0,0,Math.round((this.height-this.tileData.offset[1])/H)*H/this.rangeY*A,0,b,t,1);C.multiply(this.transforms.displayViewScreenMat3,z.displayViewMat3,y);this.tileData.transforms.displayViewScreenMat3=this.transforms.displayViewScreenMat3}onAttach(){this.tileData.stage=this.stage}onDetach(){this.tileData.stage=null}}q.RasterVFTile=x;Object.defineProperty(q,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/imagery/RasterVFDisplayObject":function(){define("exports ../../../../core/has ../../../../core/libs/gl-matrix-2/math/mat3 ../../../../core/libs/gl-matrix-2/factories/mat3f32 ../../../../core/libs/gl-matrix-2/factories/vec2f32 ../../../../layers/support/rasterFunctions/vectorFieldUtils ../DisplayObject ../webgl/Utils ../../../webgl/BufferObject ../../../webgl/enums ../../../webgl/VertexArrayObject".split(" "),
function(q,C,g,l,v,x,z,A,y,E,n){class b extends z.DisplayObject{constructor(t=null){super();this._symbolizerParameters=this._source=null;this._vaoInvalidated=!0;this.coordScale=[1,1];this.offset=this.key=this.height=null;this.stencilRef=0;this.resolution=null;this.pixelRatio=1;this.rotation=this.y=this.x=0;this.width=this.vaoData=this.rawPixelData=null;this.source=t}destroy(){null!=this.vaoData&&(this.vaoData.magdir?.vao.dispose(),this.vaoData.scalar?.vao.dispose(),this.vaoData=null)}get symbolizerParameters(){return this._symbolizerParameters}set symbolizerParameters(t){JSON.stringify(this._symbolizerParameters)!==
JSON.stringify(t)&&(this._symbolizerParameters=t,this.invalidateVAO())}get source(){return this._source}set source(t){this._source=t;this.invalidateVAO()}invalidateVAO(){this._vaoInvalidated||null==this.vaoData||(this.vaoData.magdir?.vao.dispose(),this.vaoData.scalar?.vao.dispose(),this.vaoData=null,this._vaoInvalidated=!0,this.requestRender())}updateVectorFieldVAO(t){if(this._vaoInvalidated){this._vaoInvalidated=!1;if(null!=this.source&&null==this.vaoData){var {style:H}=this.symbolizerParameters;
switch(H){case "beaufort_ft":case "beaufort_km":case "beaufort_kn":case "beaufort_m":case "beaufort_mi":case "classified_arrow":case "ocean_current_kn":case "ocean_current_m":case "single_arrow":H=x.createVFMesh(this.source,this.symbolizerParameters);this.vaoData={magdir:this._createVectorFieldVAO(t.context,H)};break;case "simple_scalar":H=x.createVFMeshScalar(this.source,this.symbolizerParameters);this.vaoData={scalar:this._createVectorFieldVAO(t.context,H)};break;case "wind_speed":H=x.createVFMesh(this.source,
this.symbolizerParameters);H=this._createVectorFieldVAO(t.context,H);const h=x.createVFMeshScalar(this.source,this.symbolizerParameters);t=this._createVectorFieldVAO(t.context,h);this.vaoData={magdir:H,scalar:t}}}this.ready();this.requestRender()}}_createTransforms(){return{displayViewScreenMat3:l.create()}}setTransform(t){const H=g.identity(this.transforms.displayViewScreenMat3),[h,m]=t.toScreenNoRotation([0,0],[this.x,this.y]);var u=this.resolution/this.pixelRatio/t.resolution;const D=u*this.width;
u*=this.height;const I=Math.PI*this.rotation/180;g.translate(H,H,v.fromValues(h,m));g.translate(H,H,v.fromValues(D/2,u/2));g.rotate(H,H,-I);g.translate(H,H,v.fromValues(-D/2,-u/2));g.scaleByVec2(H,H,v.fromValues(D,u));g.multiply(this.transforms.displayViewScreenMat3,t.displayViewMat3,H)}onAttach(){this.invalidateVAO()}onDetach(){this.invalidateVAO()}_createVectorFieldVAO(t,H){const {vertexData:h,indexData:m}=H;H=y.BufferObject.createVertex(t,E.Usage.STATIC_DRAW,new Float32Array(h));const u=y.BufferObject.createIndex(t,
E.Usage.STATIC_DRAW,new Uint32Array(m)),D=A.createProgramDescriptor("vector-field",{geometry:[{location:0,name:"a_pos",count:2,type:E.DataType.FLOAT,normalized:!1},{location:1,name:"a_offset",count:2,type:E.DataType.FLOAT,normalized:!1},{location:2,name:"a_vv",count:2,type:E.DataType.FLOAT,normalized:!1}]});return{vao:new n.VertexArrayObject(t,D.attributes,D.bufferLayouts,new Map([["geometry",H]]),u),elementCount:m.length}}}q.RasterVFDisplayObject=b;Object.defineProperty(q,Symbol.toStringTag,{value:"Module"})})},
"esri/views/layers/ImageryTileLayerView":function(){define("../../chunks/tslib.es6 ../../Graphic ../../core/Error ../../core/accessorSupport/decorators/property ../../core/has ../../core/Logger ../../core/RandomLCG ../../core/accessorSupport/decorators/subclass ../../layers/support/timeSupport ../../layers/support/rasterFunctions/rasterProjectionHelper ./support/popupUtils".split(" "),function(q,C,g,l,v,x,z,A,y,E,n){return b=>{b=class extends b{constructor(){super(...arguments);this._rasterFieldPrefix=
"Raster.";this.tileInfo=this.layer=null}get fullExtent(){try{return this.layer.loaded?this._getFullExtent():null}catch{return null}}get timeExtent(){return y.combineTimeExtent(this.layer,this.view?.timeExtent,this._get("timeExtent"))}get hasTilingEffects(){return!!(this.layer.renderer&&"dynamicRangeAdjustment"in this.layer.renderer&&this.layer.renderer.dynamicRangeAdjustment)}get datumTransformation(){try{return this.layer.loaded?E.getDefaultDatumTransformationForDataset(this.layer.fullExtent,this.view.spatialReference,
!0):null}catch{return null}}supportsSpatialReference(t){try{return!this.layer.loaded||!!E.projectDatasetExtent(this.layer.serviceRasterInfo,t)}catch{return!1}}async fetchPopupFeaturesAtLocation(t,H){const {layer:h}=this;if(!t)throw new g("imageryTileLayerView:fetchPopupFeatures","Nothing to fetch without area",{layer:h});var {popupEnabled:m}=h,u=n.getFetchPopupTemplate(h,H);if(!m||null==u)return[];m=[];const {value:D,magdirValue:I,processedValue:a}=await h.identify(t,{timeExtent:this.timeExtent,signal:H?.signal});
H="";if(D?.length){H="imagery-tile"===h.type&&h.hasStandardTime()&&null!=D[0]?D.map(c=>h.getStandardTimeValue(c)).join(", "):D.join(", ");t={ObjectId:0};t["Raster.ServicePixelValue"]="imagery-tile"===h.type&&"Function"===h.raster.datasetFormat?a?.join(", "):H;t["Raster.ServicePixelValue.Raw"]=H;H=h.raster?.rasterInfo??h.serviceRasterInfo;u=H?.attributeTable;if(null!=u){const {fields:c,features:r}=u,d=c.find(({name:w})=>"value"===w.toLowerCase()),p=t["Raster.ServicePixelValue"];if(u=d?r.find(w=>String(w.attributes[d.name])===
p):null)for(var e in u.attributes)u.attributes.hasOwnProperty(e)&&(t[this._rasterFieldPrefix+e]=u.attributes[e])}e=H?.dataType;if("vector-magdir"===e||"vector-uv"===e)t["Raster.Magnitude"]=I?.[0],t["Raster.Direction"]=I?.[1];e=new C({geometry:this.fullExtent?.clone(),attributes:t,layer:h,sourceLayer:h});m.push(e)}return m}_getFullExtent(){return E.projectDatasetExtent(this.layer.serviceRasterInfo,this.view.spatialReference)}};q.__decorate([l.property()],b.prototype,"fullExtent",null);q.__decorate([l.property()],
b.prototype,"layer",void 0);q.__decorate([l.property({readOnly:!0})],b.prototype,"timeExtent",null);q.__decorate([l.property()],b.prototype,"tileInfo",void 0);q.__decorate([l.property({readOnly:!0})],b.prototype,"hasTilingEffects",null);q.__decorate([l.property()],b.prototype,"datumTransformation",null);return b=q.__decorate([A.subclass("esri.views.layers.ImageryTileLayerView")],b)}})},"esri/layers/support/timeSupport":function(){define(["exports","../../support/timeUtils"],function(q,C){q.combineTimeExtent=
function(g,l,v){if(null==g?.timeInfo)return null;const {datesInUnknownTimezone:x=!1,timeOffset:z,useViewTime:A}=g;g=g.timeExtent;x&&(g=C.toLocalTimeExtent(g));l=A?l&&g?l.intersection(g):l||g:g;if(!l||l.isEmpty||l.isAllTime)return l;z&&(l=l.offset(-z.value,z.unit));x&&(l=C.toUTCTimeExtent(l));return l.equals(v)?v:l};Object.defineProperty(q,Symbol.toStringTag,{value:"Module"})})},"esri/support/timeUtils":function(){define("exports ../core/arrayUtils ../core/deprecate ../core/lang ../core/Logger ../core/timeUtils ../time/TimeExtent ../webmap/utils ../webscene/utils".split(" "),
function(q,C,g,l,v,x,z,A,y){function E(h){return void 0!==h.timeInfo}async function n(h,m){return h.widgets?.timeSlider?.fullTimeExtent??b(h.allLayers,m)}async function b(h,m){if(0===h.length)return z.allTime;await Promise.all(h.map(a=>a.load({signal:m})));var u=h.filter(E),D=h.filter(a=>!E(a)&&null!=a.visibilityTimeExtent);if(0===u.length&&0===D.length)return z.allTime;h=[];const I=[];for(const a of u)"feature"!==a?.type&&"map-image"!==a?.type||!a.timeInfo?.hasLiveData?I.push(a):h.push(a);u=a=>null==
a||a.isAllTime;D=[...I.map(a=>{const e=a.timeInfo?.fullTimeExtent;({visibilityTimeExtent:a}=a);return e?.intersection(a)??a}),...D.map(a=>a.visibilityTimeExtent)];if(D.some(u))return z.allTime;h=h.map(async a=>{const e=(await a.fetchRecomputedExtents({signal:m}))?.timeExtent??a.timeInfo?.fullTimeExtent;({visibilityTimeExtent:a}=a);return e?.intersection(a)??a});h=(await Promise.allSettled(h)).map(a=>"fulfilled"===a.status?a.value:null);if(h.some(u))return z.allTime;h=[...h,...D].filter(C.isSome);
return 0===h.length?z.allTime:h.reduce((a,e)=>a.union(e))}function t(h,m){h=h.currentTimeExtent;if(!h)return null;const {start:u,end:D}=h;h=u??D??null;switch(m){case "time-window":return new z({start:u,end:D});case "cumulative-from-start":return new z({start:null,end:h});case "cumulative-from-end":return new z({start:h,end:null});case "instant":return new z({start:h,end:h})}}async function H(h,m){if(!A.isWebMap(h)&&!y.isWebScene(h))return null;await h.load({signal:m});var u=h?.widgets?.timeSlider;
if(!u)return null;h=await n(h,m);m=u.loop;var D=u.numThumbs??2;var I=u.currentTimeExtent;if(I){const {start:e,end:c}=I;D=null!=e&&null!=c&&e.getTime()===c.getTime()?"instant":2===D?"time-window":null==e||0===e.getTime()?"cumulative-from-start":"cumulative-from-end"}else D=2===D?"time-window":"cumulative-from-start";I=u.stopDelay??2E3;{const {numStops:e,stopInterval:c,stops:r}=u;var a=r?{dates:l.clone(r)}:c?{interval:c.clone()}:{count:e??5}}u=t(u,D);return{fullTimeExtent:h,loop:m,mode:D,playRate:I,
stops:a,timeExtent:u}}q.getTimeExtentFromLayers=b;q.getTimeSliderSettingsFromWebDocument=H;q.getTimeSliderSettingsFromWebMap=async function(h,m){g.deprecatedFunction(v.getLogger("esri.support.timeUtils.getTimeSliderSettingsFromWebMap"),"`timeUtils.getTimeSliderSettingsFromWebMap` is deprecated in favor of 'timeUtils.getTimeSliderSettingsFromWebDocument'",{replacement:"timeUtils.getTimeSliderSettingsFromWebDocument",version:"4.30",see:"https://developers.arcgis.com/javascript/latest/api-reference/esri-support-timeUtils.html#getTimeSliderSettingsFromWebDocument",
warnOnce:!0});return null!=h&&A.isWebMap(h)?await H(h,m):null};q.toLocalTimeExtent=function(h){if(!h)return h;const {start:m,end:u}=h;return new z({start:null!=m?x.offsetDate(m,m.getTimezoneOffset(),"minutes"):m,end:null!=u?x.offsetDate(u,u.getTimezoneOffset(),"minutes"):u})};q.toUTCTimeExtent=function(h){if(!h)return h;const {start:m,end:u}=h;return new z({start:null!=m?x.offsetDate(m,-m.getTimezoneOffset(),"minutes"):m,end:null!=u?x.offsetDate(u,-u.getTimezoneOffset(),"minutes"):u})};Object.defineProperty(q,
Symbol.toStringTag,{value:"Module"})})},"esri/webscene/utils":function(){define(["exports","../support/tagSymbols"],function(q,C){q.isWebScene=function(g){return null!=g&&"object"===typeof g&&C.WebSceneTag in g};Object.defineProperty(q,Symbol.toStringTag,{value:"Module"})})},"esri/support/tagSymbols":function(){define(["exports"],function(q){const C=Symbol("WebScene");q.WebSceneTag=C;Object.defineProperty(q,Symbol.toStringTag,{value:"Module"})})},"esri/views/layers/support/popupUtils":function(){define(["exports",
"../../../layers/support/fieldUtils"],function(q,C){function g(l,v){return l.popupTemplate?l.popupTemplate:null!=v&&v.defaultPopupTemplateEnabled&&null!=l.defaultPopupTemplate?l.defaultPopupTemplate:null}q.getFetchPopupTemplate=g;q.getRequiredFields=async function(l,v=l.popupTemplate){if(null==v)return[];const x=await v.getRequiredFields(l.fieldsIndex);({lastEditInfoEnabled:v}=v);const {objectIdField:z,typeIdField:A,globalIdField:y,relationships:E}=l;if(x.includes("*"))return["*"];v=v?C.getFeatureEditFields(l):
[];const n=C.fixFields(l.fieldsIndex,[...x,...v]);A&&n.push(A);n&&z&&l.fieldsIndex?.has(z)&&!n.includes(z)&&n.push(z);n&&y&&l.fieldsIndex?.has(y)&&!n.includes(y)&&n.push(y);E&&E.forEach(b=>{({keyField:b}=b);n&&b&&l.fieldsIndex?.has(b)&&!n.includes(b)&&n.push(b)});return n};q.hasPopupTemplate=function(l,v){return null!=g(l,{defaultPopupTemplateEnabled:v})};Object.defineProperty(q,Symbol.toStringTag,{value:"Module"})})},"esri/views/layers/RefreshableLayerView":function(){define("../../chunks/tslib.es6 ../../core/Logger ../../core/promiseUtils ../../core/reactiveUtils ../../core/has ../../core/RandomLCG ../../core/Error ../../core/accessorSupport/decorators/subclass".split(" "),
function(q,C,g,l,v,x,z,A){return y=>{y=class extends y{initialize(){this.addHandles(l.on(()=>this.layer,"refresh",E=>{this.doRefresh(E.dataChanged).catch(n=>{g.isAbortError(n)||C.getLogger(this).error(n)})}),"RefreshableLayerView")}};return y=q.__decorate([A.subclass("esri.views.layers.RefreshableLayerView")],y)}})},"*noref":1}});
define("../../../chunks/tslib.es6 ../../../core/Logger ../../../core/promiseUtils ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ../../../layers/support/rasterDatasets/multidimensionalUtils ../engine/flow/FlowView2D ./LayerView2D ./imagery/ImageryTileView2D ./imagery/VectorFieldTileView2D ./support/util ../../layers/ImageryTileLayerView ../../layers/LayerView ../../layers/RefreshableLayerView".split(" "),function(q,
C,g,l,v,x,z,A,y,E,n,b,t,H,h,m,u){x=class extends h(u(n.LayerView2DMixin(m))){constructor(){super(...arguments);this._useProgressiveUpdate=this._useWebGLForProcessing=!0;this.subview=null}get useWebGLForProcessing(){return this._useWebGLForProcessing}set useWebGLForProcessing(D){this._useWebGLForProcessing=D;this.subview&&"useWebGLForProcessing"in this.subview&&(this.subview.useWebGLForProcessing=D)}get useProgressiveUpdate(){return this._useWebGLForProcessing}set useProgressiveUpdate(D){this._useProgressiveUpdate=
D;this.subview&&"useProgressiveUpdate"in this.subview&&(this.subview.useProgressiveUpdate=D)}get displayParameters(){const {layer:D}=this,I=this._get("displayParameters");return D.renderer?{bandIds:D.bandIds,renderer:D.renderer,interpolation:D.interpolation,multidimensionalDefinition:D.multidimensionalDefinition,rasterFunction:"imagery-tile"===D.type?D.rasterFunction:null}:I}update(D){this.subview?.update(D);this.notifyChange("updating")}isUpdating(){return!this.subview||this.subview.updating}attach(){this.layer.increaseRasterJobHandlerUsage();
this._updateSubview();this.addAttachHandles([l.watch(()=>this.displayParameters,(D,I)=>{const a=D.interpolation!==I?.interpolation&&("majority"===D.interpolation||"majority"===I?.interpolation)&&H.canUseMajorityInterpolationOnDataSource(this.layer),e=D.renderer!==I?.renderer&&this._getSubviewType(I?.renderer)!==this._getSubviewType(D.renderer);e&&this._updateSubview();const c=D.rasterFunction!==I?.rasterFunction,r=c&&!this._useWebGLForProcessing;this.subview.redrawOrRefetch({refetch:D.multidimensionalDefinition!==
I?.multidimensionalDefinition||a||e||r,reprocess:c}).catch(d=>{g.isAbortError(d)||C.getLogger(this).error(d)});this.notifyChange("updating")}),l.watch(()=>this.layer.multidimensionalSubset??null,(D,I)=>{const {multidimensionalDefinition:a}=this.layer;null!=a&&y.hasExcludedVariableOrDimension(a,D)!==y.hasExcludedVariableOrDimension(a,I)&&(this.subview.redrawOrRefetch({refetch:!0}).catch(e=>{g.isAbortError(e)||C.getLogger(this).error(e)}),this.notifyChange("updating"))},l.sync),l.watch(()=>this.timeExtent,
()=>{this.subview.timeExtent=this.timeExtent;this.subview.redrawOrRefetch({refetch:!0}).catch(D=>{g.isAbortError(D)||C.getLogger(this).error(D)})},l.initial)])}detach(){this.layer.decreaseRasterJobHandlerUsage();this._detachSubview(this.subview);this.subview?.destroy();this.subview=null}viewChange(){this.requestUpdate()}moveEnd(){this.subview.moveEnd()}doRefresh(){return this.subview?this.subview.doRefresh():Promise.resolve()}_updateSubview(){var {renderer:D}=this.layer;if(D){D=this._getSubviewType(D);
if(this.subview){if(this.subview.type===D){this._attachSubview(this.subview);return}this._detachSubview(this.subview);this.subview?.destroy();this.subview=null}var {layer:I}=this;D="rasterVF"===D?new t({layer:I,layerView:this,scheduler:this.scheduler}):"flow"===D?new E({layer:I,layerView:this,scheduler:this.scheduler}):new b({layer:I,layerView:this,scheduler:this.scheduler});"useWebGLForProcessing"in D&&(D.useWebGLForProcessing=this._useWebGLForProcessing);"useProgressiveUpdate"in D&&(D.useProgressiveUpdate=
this._useProgressiveUpdate);"previousLOD"in D&&({subview:I}=this,D.previousLOD=I&&"previousLOD"in I?I.previousLOD:null);this._attachSubview(D);this.subview=D;this.requestUpdate()}}_attachSubview(D){D&&!D.attached&&(D.attach(),D.attached=!0,this.container.addChildAt(D.container,0))}_detachSubview(D){D?.attached&&(this.container.removeChild(D.container),D.detach(),D.attached=!1)}_getSubviewType(D){D=D?.type;return"vector-field"===D?"rasterVF":"flow"===D?"flow":"raster"}};q.__decorate([v.property()],
x.prototype,"subview",void 0);q.__decorate([v.property()],x.prototype,"useWebGLForProcessing",null);q.__decorate([v.property()],x.prototype,"useProgressiveUpdate",null);q.__decorate([v.property({readOnly:!0})],x.prototype,"displayParameters",null);return x=q.__decorate([A.subclass("esri.views.2d.layers.ImageryTileLayerView2D")],x)});