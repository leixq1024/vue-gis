// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.31/esri/copyright.txt for details.
//>>built
require({cache:{"esri/views/2d/layers/BitmapTileLayerView2D":function(){define("exports ../../../chunks/tslib.es6 ../../../core/Logger ../../../core/has ../../../core/RandomLCG ../../../core/Error ../../../core/accessorSupport/decorators/subclass ../engine/BitmapTileContainer".split(" "),function(c,p,l,g,k,q,h,m){c.BitmapTileLayerView2D=x=>{x=class extends x{attach(){this.view.timeline.record(`${this.layer.title} (BitmapTileLayer) Attach`);this._bitmapView=new m.BitmapTileContainer(this._tileInfoView);
this.container.addChild(this._bitmapView)}detach(){this.container.removeChild(this._bitmapView);this._bitmapView?.removeAllChildren();this._bitmapView=null}};return x=p.__decorate([h.subclass("esri.views.2d.layers.BitmapTileLayerView2D")],x)};Object.defineProperty(c,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/LayerView2D":function(){define("exports ../../../chunks/tslib.es6 ../../../core/Collection ../../../core/collectionUtils ../../../core/Error ../../../core/Logger ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ../../../linkChart/utils ../engine/Container ./support/util ../support/HighlightGroup ../support/highlightGroupUtils ../support/HighlightOptions ../../layers/support/ClipRect ../../layers/support/Geometry ../../layers/support/Path ../../support/layerViewUtils".split(" "),
function(c,p,l,g,k,q,h,m,x,r,d,f,t,n,u,z,B,A,L,P,Z){const ha=l.ofType({key:"type",base:null,typeMap:{rect:A,path:P,geometry:L}}),fa=new (l.ofType(u.HighlightGroup));c.LayerView2DMixin=C=>{C=class extends C{constructor(){super(...arguments);this.attached=!1;this.clips=new ha;this.highlights=null;this.lastUpdateId=-1;this.updateRequested=this.moving=!1;this._visibleAtCurrentScale=!0}initialize(){const O=this.view?.spatialReferenceLocked??!0;this.view?.spatialReference&&O&&!this.spatialReferenceSupported?
this.addResolvingPromise(Promise.reject(new k("layerview:spatial-reference-incompatible","The spatial reference of this layer does not meet the requirements of the view",{layer:this.layer}))):(this.container||(this.container=new t.Container),this.container.fadeTransitionEnabled=!0,this.container.visible=!1,this.container.endTransitions(),this.addHandles([h.watch(()=>this.suspended,G=>{this.container&&(this.container.visible=!G)},h.syncAndInitial),h.watch(()=>this.updateSuspended,G=>{this.view&&!G&&
this.updateRequested&&this.view.requestUpdate()},h.syncAndInitial),h.watch(()=>this.layer?.opacity??1,G=>{this.container&&(this.container.opacity=G)},h.syncAndInitial),h.watch(()=>this.layer&&"blendMode"in this.layer?this.layer.blendMode:"normal",G=>{this.container&&(this.container.blendMode=G)},h.syncAndInitial),h.watch(()=>this.layer&&"effect"in this.layer?this.layer.effect:null,G=>{this.container&&(this.container.effect=G)},h.syncAndInitial),h.watch(()=>this._mergedHighlights.items.map(G=>({name:G.name,
options:{fillColor:G.options.color,haloColor:G.options.haloColor,fillOpacity:G.options.fillOpacity,haloOpacity:G.options.haloOpacity,haloWidth:G.options.haloWidth,haloBlur:G.options.haloBlur}})),()=>{this.container.highlightGradient=n.createOrReuseHighlightGradient(this.container.highlightGradient,this._mergedHighlights.items)},h.syncAndInitial),h.watch(()=>this._mergedHighlights.items.map(G=>G.name),()=>{this._updateHighlights()}),h.on(()=>this.clips,"change",()=>{this.container&&(this.container.clips=
this.clips)},h.syncAndInitial),h.watch(()=>({scale:this.view?.scale,scaleRange:this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null}),({scale:G,scaleRange:aa})=>{G=Z.isInEffectiveScaleRange(aa,G);G!==this._visibleAtCurrentScale&&(this._visibleAtCurrentScale=G)},h.syncAndInitial)],"constructor"),this.view?.whenLayerView?this.view.whenLayerView(this.layer).then(G=>{G===this&&this.processAttach()},()=>{}):this.when().then(()=>{this.processAttach()},()=>{}))}_updateHighlights(){}destroy(){this.processDetach();
this.updateRequested=!1}get highlightOptions(){return z.getDefaultHighlightOptions(this)}set highlightOptions(O){z.setDefaultHighlightOptions(this,O)}get _mergedHighlights(){if(!this.view)return fa;if(!this.highlights)return this.view.highlights;const O=this.view.highlights.clone();for(const G of this.highlights){const aa=O.find(la=>la.name===G.name);aa&&(aa.options=G.options)}return O}get scheduler(){return this.view.scheduler}get spatialReferenceSupported(){const O=this.view?.spatialReference;return null==
O||this.supportsSpatialReference(O)}get updating(){return this.spatialReferenceSupported&&(!this.attached||!this.suspended&&(this.updateRequested||this.isUpdating())||!!this._updatingHandles?.updating||this.container.transitioning)}get visibleAtCurrentScale(){return this._visibleAtCurrentScale}processAttach(){this.isResolved()&&!this.attached&&!this.destroyed&&this.spatialReferenceSupported&&(this.attach(),this.attached=!0,this.requestUpdate())}processDetach(){this.attached&&(this.attached=!1,this.removeHandles("attach"),
this.detach(),this.updateRequested=!1)}requestUpdate(){this.destroyed||this.updateRequested||(this.updateRequested=!0,this.updateSuspended||this.view.requestUpdate())}processUpdate(O){this.isFulfilled()&&!this.isResolved()?this.updateRequested=!1:(this._set("updateParameters",O),this.updateRequested&&!this.updateSuspended&&(this.updateRequested=!1,this.update(O)))}hitTest(O,G){return Promise.resolve(null)}supportsSpatialReference(O){return!0}canResume(){if(!this.spatialReferenceSupported)return!1;
switch(this.layer?.type){case "link-chart":case "knowledge-graph-sublayer":break;default:if(f.isLinkChartView(this.view)&&!this.view.inGeographicLayout)return!1}return super.canResume()?this.visibleAtCurrentScale:!1}getSuspendInfo(){const O=super.getSuspendInfo(),G=!this.spatialReferenceSupported;G&&(O.spatialReferenceNotSupported=G);return O}addAttachHandles(O){this.addHandles(O,"attach")}_getHighlightBits(O){O=new Set(O);let G=1,aa=0;if(!this.view)return 0;const la=this._mergedHighlights;for(const {name:ia}of la)O.delete(ia)&&
(aa=G),G<<=1;for(const ia of O)q.getLogger(this).error("#highlights",`${ia} was not found. Features in this group will not be highlighted.`);return aa}};p.__decorate([m.property()],C.prototype,"attached",void 0);p.__decorate([m.property({type:ha,set(O){O=g.referenceSetter(O,this._get("clips"),ha);this._set("clips",O)}})],C.prototype,"clips",void 0);p.__decorate([m.property()],C.prototype,"container",void 0);p.__decorate([m.property({type:B})],C.prototype,"highlightOptions",null);p.__decorate([m.property({type:l.ofType(u.HighlightGroup)})],
C.prototype,"highlights",void 0);p.__decorate([m.property()],C.prototype,"_mergedHighlights",null);p.__decorate([m.property()],C.prototype,"moving",void 0);p.__decorate([m.property({readOnly:!0})],C.prototype,"spatialReferenceSupported",null);p.__decorate([m.property({readOnly:!0})],C.prototype,"updateParameters",void 0);p.__decorate([m.property()],C.prototype,"updateRequested",void 0);p.__decorate([m.property()],C.prototype,"updating",null);p.__decorate([m.property()],C.prototype,"view",void 0);
p.__decorate([m.property()],C.prototype,"_visibleAtCurrentScale",void 0);p.__decorate([m.property({readOnly:!0})],C.prototype,"visibleAtCurrentScale",null);return C=p.__decorate([d.subclass("esri.views.2d.layers.LayerView2D")],C)};Object.defineProperty(c,Symbol.toStringTag,{value:"Module"})})},"esri/linkChart/utils":function(){define(["exports"],function(c){c.isLinkChartView=function(p){return null!=p&&"object"===typeof p&&"2d"===p.type&&"linkchart"===p.view2dType};Object.defineProperty(c,Symbol.toStringTag,
{value:"Module"})})},"esri/views/layers/support/ClipRect":function(){define("../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ./ClipArea".split(" "),function(c,p,l,g,k,q,h){var m;l=m=class extends h{constructor(x){super(x);this.type="rect";this.bottom=this.top=this.right=this.left=null}clone(){return new m({left:this.left,right:this.right,top:this.top,bottom:this.bottom})}commitVersionProperties(){this.commitProperty("left");
this.commitProperty("right");this.commitProperty("top");this.commitProperty("bottom")}};c.__decorate([p.property({type:[Number,String],json:{write:!0}})],l.prototype,"left",void 0);c.__decorate([p.property({type:[Number,String],json:{write:!0}})],l.prototype,"right",void 0);c.__decorate([p.property({type:[Number,String],json:{write:!0}})],l.prototype,"top",void 0);c.__decorate([p.property({type:[Number,String],json:{write:!0}})],l.prototype,"bottom",void 0);return l=m=c.__decorate([q.subclass("esri.views.layers.support.ClipRect")],
l)})},"esri/views/layers/support/ClipArea":function(){define("../../../chunks/tslib.es6 ../../../core/JSONSupport ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass".split(" "),function(c,p,l,g,k,q,h){p=class extends p.JSONSupport{get version(){this.commitVersionProperties();return(this._get("version")||0)+1}};c.__decorate([l.property({readOnly:!0})],p.prototype,"version",null);return p=
c.__decorate([h.subclass("esri.views.layers.support.ClipArea")],p)})},"esri/views/layers/support/Geometry":function(){define("../../../chunks/tslib.es6 ../../../geometry ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ../../../geometry/Geometry ../../../geometry/support/jsonUtils ./ClipArea ../../../geometry/Extent ../../../geometry/Polygon".split(" "),function(c,p,l,g,k,q,h,m,x,r,d,
f){var t;p={base:m,key:"type",typeMap:{extent:d,polygon:f}};r=t=class extends r{constructor(n){super(n);this.type="geometry";this.geometry=null}clone(){return new t({geometry:this.geometry?.clone()??null})}commitVersionProperties(){this.commitProperty("geometry")}};c.__decorate([l.property({types:p,json:{read:x.fromJSON,write:!0}})],r.prototype,"geometry",void 0);return r=t=c.__decorate([h.subclass("esri.views.layers.support.Geometry")],r)})},"esri/views/layers/support/Path":function(){define("../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ./ClipArea".split(" "),
function(c,p,l,g,k,q,h){l=class extends h{constructor(m){super(m);this.type="path";this.path=[]}commitVersionProperties(){this.commitProperty("path")}};c.__decorate([p.property({type:[[[Number]]],json:{write:!0}})],l.prototype,"path",void 0);return l=c.__decorate([q.subclass("esri.views.layers.support.Path")],l)})},"esri/views/2d/layers/graphics/HighlightGraphicContainer":function(){define("../../../../chunks/tslib.es6 ../../../../core/Logger ../../../../core/has ../../../../core/RandomLCG ../../../../core/Error ../../../../core/accessorSupport/decorators/subclass ../../engine/webgl/enums ./AGraphicContainer ../support/util".split(" "),
function(c,p,l,g,k,q,h,m,x){p=class extends m.AGraphicContainer{get hasHighlight(){return this.children.some(r=>r.hasData)}renderChildren(r){this.attributeView.update();r.drawPhase===h.WGLDrawPhase.HIGHLIGHT&&this.children.some(d=>d.hasData)&&(super.renderChildren(r),r.context.setColorMask(!0,!0,!0,!0),x.renderHighlight(r,!0,d=>{this._renderChildren(d,h.FeatureSelection.All)},0))}};return p=c.__decorate([q.subclass("esri.views.2d.layers.graphics.HighlightGraphicContainer")],p)})},"esri/views/2d/layers/support/imageUtils":function(){define(["exports"],
function(c){function p(l){const g=document.createElement("canvas");[g.width,g.height]=l;return g}c.createBlankImage=p;c.resampleImage=function(l,g,k,q){if(k.level===q.level)return g;const h=l.tileInfo.size;var m=l.getTileResolution(k.level),x=l.getTileResolution(q.level),r=l.getLODInfoAt(q.level),d=r.getXForColumn(q.col);q=r.getYForRow(q.row);r=l.getLODInfoAt(k.level);l=r.getXForColumn(k.col);const f=r.getYForRow(k.row);r=(g instanceof HTMLImageElement?g.naturalWidth:g.width)/h[0];k=(g instanceof
HTMLImageElement?g.naturalHeight:g.height)/h[1];d=Math.round((d-l)/m*r);q=Math.round(-(q-f)/m*k);l=Math.round(x/m*h[0]*r);m=Math.round(x/m*h[1]*k);x=p(h);x.getContext("2d").drawImage(g,d,q,l,m,0,0,h[0],h[1]);return x};Object.defineProperty(c,Symbol.toStringTag,{value:"Module"})})},"esri/views/layers/RefreshableLayerView":function(){define("../../chunks/tslib.es6 ../../core/Logger ../../core/promiseUtils ../../core/reactiveUtils ../../core/has ../../core/RandomLCG ../../core/Error ../../core/accessorSupport/decorators/subclass".split(" "),
function(c,p,l,g,k,q,h,m){return x=>{x=class extends x{initialize(){this.addHandles(g.on(()=>this.layer,"refresh",r=>{this.doRefresh(r.dataChanged).catch(d=>{l.isAbortError(d)||p.getLogger(this).error(d)})}),"RefreshableLayerView")}};return x=c.__decorate([m.subclass("esri.views.layers.RefreshableLayerView")],x)}})},"esri/views/layers/support/MapServiceLayerViewHelper":function(){define("require exports ../../../chunks/tslib.es6 ../../../chunks/languageUtils ../../../core/Accessor ../../../core/arrayUtils ../../../core/Collection ../../../core/Error ../../../core/handleUtils ../../../core/has ../../../core/MapUtils ../../../core/promiseUtils ../../../core/reactiveUtils ../../../core/sql ../../../core/unitUtils ../../../core/accessorSupport/decorators/property ../../../core/Logger ../../../core/accessorSupport/decorators/subclass ../../../geometry/Extent ../../../geometry/support/scaleUtils ../../../layers/support/fieldUtils ../../../layers/support/floorFilterUtils ../../../renderers/support/clickToleranceUtils ../../../rest/identify ../../../rest/support/IdentifyParameters ../../../support/arcadeOnDemand ../../../symbols/SimpleMarkerSymbol ../../3d/layers/support/highlightUtils ./popupUtils".split(" "),
function(c,p,l,g,k,q,h,m,x,r,d,f,t,n,u,z,B,A,L,P,Z,ha,fa,C,O,G,aa,la,ia){function pa(y,D,J){const K=[];if(!y)return K;const M=F=>{var E=0===F.minScale||D<=F.minScale;const Q=0===F.maxScale||D>=F.maxScale;F.visible&&E&&Q&&(F.sublayers?F.sublayers.forEach(M):F.popupEnabled&&(E=ia.getFetchPopupTemplate(F,{...J,defaultPopupTemplateEnabled:!1}),null!=E&&K.unshift({sublayer:F,popupTemplate:E})))};y.map(M);return K}function ta(y){return y.expressionInfos?.length||Array.isArray(y.content)&&y.content.some(D=>
"expression"===D.type)?G.loadArcade():Promise.resolve()}async function va(y,D){if(y.capabilities?.operations?.supportsQuery)return!0;try{return await Promise.any(D.map(({sublayer:J})=>J.load().then(()=>J.capabilities.operations.supportsQuery)))}catch{return!1}}async function X(y,D,J){const K=y.renderer;K&&"defaultSymbol"in K&&!K.defaultSymbol&&(D=K.valueExpression?await Promise.all(D.map(M=>K.getSymbolAsync(M,J).then(F=>F?M:null))).then(M=>M.filter(F=>null!=F)):D.filter(M=>null!=K.getSymbol(M)));
return D}let W=null;p.MapServiceLayerViewHelper=class extends k{constructor(y){super(y);this._featuresResolutions=new WeakMap;this.highlightGraphicUpdated=this.highlightGraphics=null;this.updateHighlightedFeatures=f.debounce(async D=>{this.destroyed||this.updatingHandles.addPromise(this._updateHighlightedFeaturesGeometries(D).catch(()=>{}))})}initialize(){const y=D=>{this.updatingHandles.addPromise(this._updateHighlightedFeaturesSymbols(D).catch(()=>{}));this.updateHighlightedFeatures(this._highlightGeometriesResolution)};
this.addHandles([t.on(()=>this.highlightGraphics,"change",D=>y(D.added),{onListenerAdd:D=>y(D)})])}async fetchPopupFeaturesAtLocation(y,D){const {layerView:{layer:J,view:{scale:K}}}=this;if(!y)throw new m("fetchPopupFeatures:invalid-area","Nothing to fetch without area",{layer:J});const M=pa(J.sublayers,K,D);if(!M.length)return[];const F=await va(J,M);if(!((J.capabilities?.operations?.supportsIdentify??!0)&&10.5<=J.version||F))throw new m("fetchPopupFeatures:not-supported","query operation is disabled for this service",
{layer:J});return F?this._fetchPopupFeaturesUsingQueries(y,M,D):this._fetchPopupFeaturesUsingIdentify(y,M,D)}clearHighlights(){this.highlightGraphics?.removeAll()}highlight(y){const D=this.highlightGraphics;if(!y||!D)return la.emptyHighlightHandle;let J=g.isGraphic(y)?[y]:h.isCollection(y)?y.toArray():Array.isArray(y)?y:[];J=J?.filter(q.isSome);if(0===(J?.length??0))return la.emptyHighlightHandle;for(const K of J)({sourceLayer:y}=K),null!=y&&"geometryType"in y&&"point"===y.geometryType&&(K.visible=
!1);D.addMany(J);return x.makeHandle(()=>D.removeMany(J??[]))}async _updateHighlightedFeaturesSymbols(y){const {layerView:{view:D},highlightGraphics:J,highlightGraphicUpdated:K}=this;if(J&&K)for(const M of y){const F=M.sourceLayer&&"renderer"in M.sourceLayer&&M.sourceLayer.renderer;M.sourceLayer&&"geometryType"in M.sourceLayer&&"point"===M.sourceLayer.geometryType&&F&&"getSymbolAsync"in F&&F.getSymbolAsync(M).then(async E=>{E||=new aa;let Q=null;const U="visualVariables"in F?F.visualVariables?.find(T=>
"size"===T.type):void 0;U&&(W||(W=(await new Promise((T,da)=>c(["../../../renderers/visualVariables/support/visualVariableUtils"],T,da))).getSize),Q=W(U,M,{view:D.type,scale:D.scale,shape:"simple-marker"===E.type?E.style:null}));Q||="width"in E&&"height"in E&&null!=E.width&&null!=E.height?Math.max(E.width,E.height):"size"in E?E.size:16;J.includes(M)&&(M.symbol=new aa({style:"square",size:Q,xoffset:"xoffset"in E?E.xoffset:0,yoffset:"yoffset"in E?E.yoffset:0}),K(M,"symbol"),M.visible=!0)})}}async _updateHighlightedFeaturesGeometries(y){const {layerView:{layer:D,
view:J},highlightGraphics:K,highlightGraphicUpdated:M}=this;this._highlightGeometriesResolution=y;if(M&&K?.length&&D.capabilities.operations.supportsQuery){var F=this._getTargetResolution(y);y=new Map;for(var E of K)(!this._featuresResolutions.has(E)||this._featuresResolutions.get(E)>F)&&d.getOrCreateMapValue(y,E.sourceLayer,()=>new Map).set(E.getObjectId(),E);E=Array.from(y,([Q,U])=>{const T=Q.createQuery();T.objectIds=[...U.keys()];T.outFields=[Q.objectIdField];T.returnGeometry=!0;T.maxAllowableOffset=
F;T.outSpatialReference=J.spatialReference;return Q.queryFeatures(T)});E=await Promise.all(E);if(!this.destroyed)for(const {features:Q}of E)for(const U of Q)(E=y.get(U.sourceLayer).get(U.getObjectId()))&&K.includes(E)&&(E.geometry=U.geometry,M(E,"geometry"),this._featuresResolutions.set(E,F))}}_getTargetResolution(y){const D=y*u.getMetersPerUnitForSR(this.layerView.view.spatialReference),J=D/16;return 10>=J?0:y/D*J}async _fetchPopupFeaturesUsingIdentify(y,D,J){y=await this._createIdentifyParameters(y,
D,J);if(null==y)return[];({results:J}=await C.identify(this.layerView.layer.parsedUrl,y,J));return J.map(K=>K.feature)}async _createIdentifyParameters(y,D,J){const {floors:K,layer:M,timeExtent:F,view:{spatialReference:E,scale:Q}}=this.layerView;if(!D.length)return null;await Promise.all(D.map(({sublayer:ja})=>ja.load(J).catch(()=>{})));D=Math.min(r("mapservice-popup-identify-max-tolerance"),M.allSublayers.reduce((ja,S)=>S.renderer?fa.calculateTolerance({renderer:S.renderer,pointerType:J?.pointerType}):
ja,2));var U=this.createFetchPopupFeaturesQueryGeometry(y,D);const T=P.getResolutionForScale(Q,E),da=Math.round(U.width/T);U=new L({xmin:U.center.x-T*da,ymin:U.center.y-T*da,xmax:U.center.x+T*da,ymax:U.center.y+T*da,spatialReference:U.spatialReference});return new O({floors:K,gdbVersion:"gdbVersion"in M?M.gdbVersion:void 0,geometry:y,height:da,layerOption:"popup",mapExtent:U,returnGeometry:!0,spatialReference:E,sublayers:M.sublayers,timeExtent:F,tolerance:D,width:da})}async _fetchPopupFeaturesUsingQueries(y,
D,J){const {layerView:{floors:K,timeExtent:M}}=this;D=D.map(async({sublayer:F,popupTemplate:E})=>{await F.load(J).catch(()=>{});if(F.capabilities&&!F.capabilities.operations.supportsQuery)return[];var Q=F.createQuery(),U=fa.calculateTolerance({renderer:F.renderer,pointerType:J?.pointerType}),T=this.createFetchPopupFeaturesQueryGeometry(y,U),da=new Set;const [ja]=await Promise.all([ia.getRequiredFields(F,E),F.renderer?.collectRequiredFields(da,F.fieldsIndex)]);f.throwIfAborted(J);Z.collectFields(da,
F.fieldsIndex,ja);da=Array.from(da).sort();Q.geometry=T;Q.outFields=da;Q.timeExtent=M;da=ha.getLayerFloorFilterClause(K,F);Q.where=n.sqlAnd(Q.where,da);U=this._getTargetResolution(T.width/U);T=await ta(E);f.throwIfAborted(J);E="point"===F.geometryType||T&&T.arcadeUtils.hasGeometryOperations(E);E||(Q.maxAllowableOffset=U);({features:Q}=await F.queryFeatures(Q,J));E=E?0:U;Q=await X(F,Q,J);for(const S of Q)this._featuresResolutions.set(S,E);return Q});return(await Promise.allSettled(D)).reduce((F,E)=>
"fulfilled"===E.status?[...F,...E.value]:F,[]).filter(q.isSome)}};l.__decorate([z.property({constructOnly:!0})],p.MapServiceLayerViewHelper.prototype,"createFetchPopupFeaturesQueryGeometry",void 0);l.__decorate([z.property({constructOnly:!0})],p.MapServiceLayerViewHelper.prototype,"layerView",void 0);l.__decorate([z.property({constructOnly:!0})],p.MapServiceLayerViewHelper.prototype,"highlightGraphics",void 0);l.__decorate([z.property({constructOnly:!0})],p.MapServiceLayerViewHelper.prototype,"highlightGraphicUpdated",
void 0);l.__decorate([z.property({constructOnly:!0})],p.MapServiceLayerViewHelper.prototype,"updatingHandles",void 0);p.MapServiceLayerViewHelper=l.__decorate([A.subclass("esri.views.layers.support.MapServiceLayerViewHelper")],p.MapServiceLayerViewHelper);p.collectPopupProviders=pa;p.isMapServiceLayerView=function(y,D){return"tile"===D.type||"map-image"===D.type};Object.defineProperty(p,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/languageUtils":function(){define("exports ../config ../kernel ../arcade/ArcadeDate ../arcade/ArcadeModule ../arcade/executionError ../arcade/FunctionWrapper ../arcade/ImmutableArray ../arcade/ImmutablePathArray ../arcade/ImmutablePointArray ../arcade/featureset/support/shared ../core/number ../core/sql/DateOnly ../core/sql/TimeOnly ../geometry/Extent ../geometry/Geometry ../geometry/Multipoint ../geometry/Point ../geometry/Polygon ../geometry/Polyline ../geometry/SpatialReference ../geometry/support/coordsUtils ../geometry/support/jsonUtils ../intl/locale ../rest/support/Query ./datetime".split(" "),
function(c,p,l,g,k,q,h,m,x,r,d,f,t,n,u,z,B,A,L,P,Z,ha,fa,C,O,G){function aa(a,b,e){return""===b||null===b||void 0===b||b===e||b===e?a:a=a.split(b).join(e)}function la(a){return a instanceof h.ArcadeFunction}function ia(a){return a instanceof k.ArcadeModule}function pa(a){return X(a)||y(a)||S(a)||ba(a)||ca(a)||W(a)||null===a||a===ea||"number"===typeof a?!0:!1}function ta(a,b){return void 0===a?b:a}function va(a){return null==a?"":K(a)||ja(a)?"Array":S(a)?"Date":ca(a)?"Time":ba(a)?"DateOnly":X(a)?"String":
W(a)?"Boolean":y(a)?"Number":"esri.arcade.Attachment"===a?.declaredClass?"Attachment":"esri.arcade.Portal"===a?.declaredClass?"Portal":"esri.arcade.Dictionary"===a?.declaredClass?"Dictionary":da(a)?"KnowledgeGraph":a instanceof k.ArcadeModule?"Module":M(a)?"Feature":a instanceof A?"Point":a instanceof L?"Polygon":a instanceof P?"Polyline":a instanceof B?"Multipoint":a instanceof u?"Extent":la(a)?"Function":Q(a)?"FeatureSet":T(a)?"FeatureSetCollection":a===ea?"":"number"===typeof a&&isNaN(a)?"Number":
"Unrecognized Type"}function X(a){return"string"===typeof a||a instanceof String}function W(a){return"boolean"===typeof a}function y(a){return"number"===typeof a}function D(a){return"number"===typeof a&&isFinite(a)&&Math.floor(a)===a}function J(a){return a instanceof z}function K(a){return Array.isArray(a)}function M(a){return"esri.arcade.Feature"===a?.arcadeDeclaredClass?!0:!1}function F(a){return"esri.Graphic"===a?.declaredClass}function E(a){return a instanceof O}function Q(a){return"esri.arcade.featureset.support.FeatureSet"===
a?.declaredRootClass}function U(a){return"esri.arcade.Dictionary"===a?.declaredClass}function T(a){return"esri.arcade.featureSetCollection"===a?.declaredRootClass}function da(a){return"esri.rest.knowledgeGraph.KnowledgeGraph"===a?.declaredClass}function ja(a){return a instanceof m}function S(a){return a instanceof g.ArcadeDate}function ba(a){return a instanceof t.DateOnly}function ca(a){return a instanceof n.TimeOnly}function Da(a){return null!=a&&"object"===typeof a}function ya(a){return a instanceof
Date}function Sa(a,b,e,w,v){if(a.length<b||a.length>e)throw new q.ArcadeExecutionError(w,q.ExecutionErrorCodes.WrongNumberOfParameters,v);}function Ta(a){return 0>a?-Math.round(-a):Math.round(a)}function Ea(a,b){if(!isNaN(a)){if(void 0===b||null===b||""===b)return a.toString();b=aa(b,"\u2030","");b=aa(b,"\u00a4","");return f.format(a,{pattern:b})}return a.toString()}function za(a,b){return void 0===b||null===b||""===b?a.toISOString(!0):a.toFormat(Ja(b),{locale:C.getLocale(),numberingSystem:"latn"})}
function Ja(a,b=!1){a=a.replaceAll(/LTS|LT|L{1,4}|l{1,4}/g,"[$\x26]");let e="";const w=/(\[[^[]*\])|(\\)?([Hh]mm(ss)?|Mo|M{1,4}|Do|DDDo|D{1,4}|d{2,4}|do?|w[o|w]?|W[o|W]?|Qo?|N{1,5}|YYYYYY|YYYYY|YYYY|YY|y{2,4}|yo?|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|kk?|mm?|ss?|S{1,9}|x|X|zz?|Z{1,5}|.)/g;for(const v of a.match(w)||[])switch(v){case "D":e+="d";break;case "DD":e+="dd";break;case "DDD":e+="o";break;case "d":e+="c";break;case "ddd":e+="ccc";break;case "dddd":e+="cccc";break;case "M":e+="L";break;case "MM":e+=
"LL";break;case "MMM":e+="LLL";break;case "MMMM":e+="LLLL";break;case "YY":e+="yy";break;case "Y":case "YYYY":e+="yyyy";break;case "Q":e+="q";break;case "Z":e+="Z";break;case "ZZ":e+="ZZ";break;case "ZZZ":e+="ZZZ";break;case "ZZZZ":e=b?e+"[ZZZZ]":e+"ZZZZ";break;case "ZZZZZ":e=b?e+"[ZZZZZ]":e+"ZZZZZ";break;case "S":e+="'S'";break;case "SS":e+="'SS'";break;case "SSS":e+="u";break;case "A":case "a":e+="a";break;case "m":case "mm":case "h":case "hh":case "H":case "HH":case "s":case "ss":case "X":case "x":e+=
v;break;default:e=2<=v.length&&"["===v.slice(0,1)&&"]"===v.slice(-1)?e+`'${v.slice(1,-1)}'`:e+`'${v}'`}return e}function N(a,b,e){switch(e){case "\x3e":return a>b;case "\x3c":return a<b;case "\x3e\x3d":return a>=b;case "\x3c\x3d":return a<=b}return!1}function Ua(a,b,e){if(null===a){if(null===b||b===ea)return N(null,null,e);if(y(b))return N(0,b,e);if(X(b)||W(b))return N(0,Y(b),e);if(S(b))return N(0,b.toNumber(),e);if(ca(b)||ba(b))return N(a,b.toNumber(),e)}if(a===ea){if(null===b||b===ea)return N(null,
null,e);if(y(b))return N(0,b,e);if(X(b)||W(b))return N(0,Y(b),e);if(S(b))return N(0,b.toNumber(),e);if(ca(b)||ba(b))return N(a,b.toNumber(),e)}else if(y(a)){if(y(b))return N(a,b,e);if(W(b))return N(a,Y(b),e);if(null===b||b===ea)return N(a,0,e);if(X(b))return N(a,Y(b),e);if(S(b)||ca(b)||ba(b))return N(a,b.toNumber(),e)}else if(X(a)){if(X(b))return N(qa(a),qa(b),e);if(S(b)||ca(b)||ba(b))return N(Y(a),b.toNumber(),e);if(y(b))return N(Y(a),b,e);if(null===b||b===ea)return N(Y(a),0,e);if(W(b))return N(Y(a),
Y(b),e)}else if(S(a)){if(S(b))return a.timeZone!==b.timeZone&&(a.isUnknownTimeZone?a=g.ArcadeDate.arcadeDateAndZoneToArcadeDate(a,b.timeZone):b.isUnknownTimeZone&&(b=g.ArcadeDate.arcadeDateAndZoneToArcadeDate(b,a.timeZone))),N(a.toNumber(),b.toNumber(),e);if(null===b||b===ea)return N(a.toNumber(),0,e);if(y(b))return N(a.toNumber(),b,e);if(W(b)||X(b))return N(a.toNumber(),Y(b),e);if(ca(b))throw new q.ArcadeExecutionError(null,q.ExecutionErrorCodes.CannotCompareDateAndTime,null);if(ba(b))return N(a.toNumber(),
b.toNumber(),e)}else if(W(a)){if(W(b))return N(a,b,e);if(y(b))return N(Y(a),Y(b),e);if(S(b)||ca(b)||ba(b))return N(Y(a),b.toNumber(),e);if(null===b||b===ea)return N(Y(a),0,e);if(X(b))return N(Y(a),Y(b),e)}else if(ba(a)){if(S(b))return N(a.toNumber(),b.toNumber(),e);if(null===b||b===ea)return N(a.toNumber(),0,e);if(y(b))return N(a.toNumber(),b,e);if(W(b)||X(b))return N(a.toNumber(),Y(b),e);if(ca(b))throw new q.ArcadeExecutionError(null,q.ExecutionErrorCodes.CannotCompareDateAndTime,null);if(ba(b))return N(a.toNumber(),
b.toNumber(),e)}else if(ca(a)){if(S(b))throw new q.ArcadeExecutionError(null,q.ExecutionErrorCodes.CannotCompareDateAndTime,null);if(null===b||b===ea)return N(a.toNumber(),0,e);if(y(b))return N(a.toNumber(),b,e);if(W(b)||X(b))return N(a.toNumber(),Y(b),e);if(ca(b))return N(a.toNumber(),b.toNumber(),e);if(ba(b))throw new q.ArcadeExecutionError(null,q.ExecutionErrorCodes.CannotCompareDateAndTime,null);}return!Ka(a,b)||"\x3c\x3d"!==e&&"\x3e\x3d"!==e?!1:!0}function Ka(a,b){if(a===b||null===a&&b===ea||
null===b&&a===ea)return!0;if(S(a)&&S(b)||ca(a)&&ca(b)||ba(a)&&ba(b))return a.equals(b);if(a instanceof x||a instanceof r)return a.equalityTest(b);if(a instanceof A&&b instanceof A){const e=a.cache._arcadeCacheId,w=b.cache._arcadeCacheId;if(void 0!==e&&null!==e)return e===w}return Da(a)&&Da(b)&&(a._arcadeCacheId===b._arcadeCacheId&&void 0!==a._arcadeCacheId&&null!==a._arcadeCacheId||a._underlyingGraphic===b._underlyingGraphic&&void 0!==a._underlyingGraphic&&null!==a._underlyingGraphic)?!0:!1}function qa(a,
b){if(X(a))return a;if(null===a)return"";if(y(a))return Ea(a,b);if(W(a))return a.toString();if(S(a))return za(a,b);if(ca(a)||ba(a))return a.toFormat(b);if(a instanceof z)return JSON.stringify(a.toJSON());if(K(a)){b=[];for(var e=0;e<a.length;e++)b[e]=Fa(a[e]);return"["+b.join(",")+"]"}if(a instanceof m){b=[];for(e=0;e<a.length();e++)b[e]=Fa(a.get(e));return"["+b.join(",")+"]"}return null!==a&&"object"===typeof a&&void 0!==a.castToText?a.castToText():la(a)?"object, Function":a===ea?"":ia(a)?"object, Module":
""}function Va(a){const b=[];if(!K(a))return null;if(a instanceof m){for(var e=0;e<a.length();e++)b[e]=Y(a.get(e));return b}for(e=0;e<a.length;e++)b[e]=Y(a[e]);return b}function La(a,b,e=!1){if(X(a))return a;if(null===a)return"";if(y(a))return Ea(a,b);if(W(a))return a.toString();if(S(a))return za(a,b);if(ca(a)||ba(a))return a.toFormat(b);if(a instanceof z)return a instanceof u?'{"xmin":'+a.xmin.toString()+',"ymin":'+a.ymin.toString()+","+(a.hasZ?'"zmin":'+a.zmin.toString()+",":"")+(a.hasM?'"mmin":'+
a.mmin.toString()+",":"")+'"xmax":'+a.xmax.toString()+',"ymax":'+a.ymax.toString()+","+(a.hasZ?'"zmax":'+a.zmax.toString()+",":"")+(a.hasM?'"mmax":'+a.mmax.toString()+",":"")+'"spatialReference":'+Ga(a.spatialReference)+"}":Ga(a.toJSON(),(v,H)=>v.key===H.key?0:"spatialReference"===v.key?1:"spatialReference"===H.key||v.key<H.key?-1:v.key>H.key?1:0);if(K(a)){b=[];for(var w=0;w<a.length;w++)b[w]=Fa(a[w],e);return"["+b.join(",")+"]"}if(a instanceof m){b=[];for(w=0;w<a.length();w++)b[w]=Fa(a.get(w),e);
return"["+b.join(",")+"]"}return null!==a&&"object"===typeof a&&void 0!==a.castToText?a.castToText(e):la(a)?"object, Function":a===ea?"":ia(a)?"object, Module":""}function Fa(a,b=!1){return null===a?"null":W(a)||y(a)||X(a)?JSON.stringify(a):a instanceof z||a instanceof m||Array.isArray(a)?La(a,null,b):S(a)?b?JSON.stringify(a.getTime()):JSON.stringify(za(a,"")):ca(a)||ba(a)?JSON.stringify(a.toString()):null!==a&&"object"===typeof a&&void 0!==a.castToText?a.castToText(b):"null"}function Y(a,b){return y(a)?
a:null===a||""===a?0:S(a)||ba(a)||ca(a)?NaN:W(a)?a?1:0:K(a)||""===a||void 0===a?NaN:void 0!==b&&X(a)?(b=aa(b,"\u2030",""),b=aa(b,"\u00a4",""),f.parse(a,{pattern:b})):a===ea?0:Number(a)}function Wa(a,b){if(S(a))return a;if(X(a)){a:{const w=/ (\d\d)/;var e=g.createDateTimeZone(b);e=G.DateTime.fromISO(a,{zone:e});if(e.isValid)b=e;else{if(w.test(a)&&(a=a.replace(w,"T$1"),e=G.DateTime.fromISO(a,{zone:b}),e.isValid)){b=e;break a}b=null}}if(b)return g.ArcadeDate.dateTimeToArcadeDate(b)}return null}function Xa(a){return W(a)?
a:X(a)?(a=a.toLowerCase(),"true"===a?!0:!1):y(a)?0===a||isNaN(a)?!1:!0:!1}function Ya(a,b){(a=JSON.parse(a))&&!a.spatialReference&&(a.spatialReference=b);return fa.fromJSON(a)}function Za(a,b){if(null==a)return null;if(null===a.spatialReference||void 0===a.spatialReference)a.spatialReference=b;return a}function $a(a){if(null===a)return null;if(a instanceof A)return"NaN"===a.x||null===a.x||isNaN(a.x)?null:a;if(a instanceof L){if(0===a.rings.length)return null;for(const b of a.rings)if(0<b.length)return a;
return null}if(a instanceof P){if(0===a.paths.length)return null;for(const b of a.paths)if(0<b.length)return a;return null}return a instanceof B?0===a.points.length?null:a:a instanceof u?"NaN"===a.xmin||null===a.xmin||isNaN(a.xmin)?null:a:null}function Ma(a,b){if(!a||!a.domain)return b;let e=null,w=null;if(S(b))e=b.toNumber();else if(ba(b))e=b.toString();else if(ca(b))e=b.toStorageString();else if("string"===a.field.type||"esriFieldTypeString"===a.field.type)e=qa(b);else{if(null===b||void 0===b)return null;
if(""===b)return b;e=Y(b)}for(let v=0;v<a.domain.codedValues.length;v++){const H=a.domain.codedValues[v];H.code===e&&(w=H)}return null===w?qa(b):w.name}function Na(a,b){if(!a||!a.domain)return b;let e=null;const w=qa(b);for(let v=0;v<a.domain.codedValues.length;v++){const H=a.domain.codedValues[v];H.name===w&&(e=H)}return null===e?b:e.code}function Aa(a,b,e=null,w=null){if(!b||!b.fields)return null;let v=null;for(var H=0;H<b.fields.length;H++){var R=b.fields[H];R.name.toLowerCase()===a.toString().toLowerCase()&&
(v=R)}if(null===v)throw new q.ArcadeExecutionError(null,q.ExecutionErrorCodes.FieldNotFound,null,{key:a});let na,ka;H=b.typeIdField;let oa="id";R=b.types;b.subtypeField&&(H=b.subtypeField,oa="code",R=b.subtypes??[]);if(null===w&&e&&H)w=e.hasField(H)?e.field(H):null;else if(H&&null!==w){let ra=!1;for(const ua of R||[])if(w===ua[oa]){ra=!0;break}if(!ra)for(const ua of R||[])if(w===ua.name){w=ua[oa];ra=!0;break}ra||(w=null,e&&H&&(w=e.hasField(H)?e.field(H):null))}null!==w&&void 0!==w&&R.some(ra=>ra[oa]===
w?((na=ra.domains?.[v.name])&&"inherited"===na.type&&(na=ab(v.name,b),ka=!0),!0):!1);ka||na||(na=ab(a,b));return{field:v,domain:na}}function ab(a,b){let e;b.fields.some(w=>{w.name.toLowerCase()===a.toLowerCase()&&(e=w.domain);return!!e});return e}function Ga(a,b){b||={};"function"===typeof b&&(b={cmp:b});const e="boolean"===typeof b.cycles?b.cycles:!1,w=b.cmp&&function(H){return function(R){return function(na,ka){return H({key:na,value:R[na]},{key:ka,value:R[ka]})}}}(b.cmp),v=[];return function na(R){R?.toJSON&&
"function"===typeof R.toJSON&&(R=R.toJSON());if(void 0!==R){if("number"===typeof R)return isFinite(R)?""+R:"null";if("object"!==typeof R)return JSON.stringify(R);var ka;if(Array.isArray(R)){var oa="[";for(ka=0;ka<R.length;ka++)ka&&(oa+=","),oa+=na(R[ka])||"null";return oa+"]"}if(null===R)return"null";if(v.includes(R)){if(e)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON");}var ra=v.push(R)-1,ua=Object.keys(R).sort(w?.(R));oa="";for(ka=0;ka<ua.length;ka++){const bb=
ua[ka],cb=na(R[bb]);cb&&(oa&&(oa+=","),oa+=JSON.stringify(bb)+":"+cb)}v.splice(ra,1);return"{"+oa+"}"}}(a)}function db(a){if(null===a)return null;const b=[];for(const e of a)e?.arcadeDeclaredClass&&"esri.arcade.Feature"===e.arcadeDeclaredClass?b.push(e.geometry()):b.push(e);return b}function wa(a,b){if(b instanceof A)a.push(b.hasZ?b.hasM?[b.x,b.y,b.z,b.m]:[b.x,b.y,b.z]:[b.x,b.y]);else throw new q.ArcadeExecutionError(null,q.ExecutionErrorCodes.InvalidParameter,null);}function eb(a,b){if(K(a)||ja(a)){let e=
!1,w=!1,v=[];if(K(a)){for(const H of a)wa(v,H);0<v.length&&(b=a[0].spatialReference,e=a[0].hasZ,w=a[0].hasM)}else if(a instanceof r)v=a._elements,0<v.length&&(e=a._hasZ,w=a._hasM,b=a.get(0).spatialReference);else if(ja(a)){for(const H of a.toArray())wa(v,H);0<v.length&&(b=a.get(0).spatialReference,e=!0===a.get(0).hasZ,w=!0===a.get(0).hasM)}else throw new q.ArcadeExecutionError(null,q.ExecutionErrorCodes.InvalidParameter,null);if(0===v.length)return null;ha.isClockwise(v)||(v=v.slice().reverse());
return new L({rings:[v],spatialReference:b,hasZ:e,hasM:w})}return a}function fb(a,b){if(K(a)||ja(a)){let e=!1,w=!1,v=[];if(K(a)){for(const H of a)wa(v,H);0<v.length&&(b=a[0].spatialReference,e=!0===a[0].hasZ,w=!0===a[0].hasM)}else if(a instanceof r)v=a._elements,0<v.length&&(e=a._hasZ,w=a._hasM,b=a.get(0).spatialReference);else if(ja(a)){for(const H of a.toArray())wa(v,H);0<v.length&&(b=a.get(0).spatialReference,e=!0===a.get(0).hasZ,w=!0===a.get(0).hasM)}return 0===v.length?null:new P({paths:[v],
spatialReference:b,hasZ:e,hasM:w})}return a}function gb(a,b){if(K(a)||ja(a)){let e=!1,w=!1,v=[];if(K(a)){for(const H of a)wa(v,H);0<v.length&&(b=a[0].spatialReference,e=!0===a[0].hasZ,w=!0===a[0].hasM)}else if(a instanceof r)v=a._elements,0<v.length&&(e=a._hasZ,w=a._hasM,b=a.get(0).spatialReference);else if(ja(a)){for(const H of a.toArray())wa(v,H);0<v.length&&(b=a.get(0).spatialReference,e=!0===a.get(0).hasZ,w=!0===a.get(0).hasM)}return 0===v.length?null:new B({points:v,spatialReference:b,hasZ:e,
hasM:w})}return a}function hb(a,b=!1){const e=[];if(null===a)return e;if(!0===K(a)){for(var w=0;w<a.length;w++){var v=qa(a[w]);""===v&&!0!==b||e.push(v)}return e}if(a instanceof m){for(w=0;w<a.length();w++)v=qa(a.get(w)),""===v&&!0!==b||e.push(v);return e}return pa(a)?(a=qa(a),""===a&&!0!==b||e.push(a),e):[]}function ib(a){Oa++;return 0===Oa%100?(Oa=0,new Promise(b=>{setTimeout(()=>{b(a)},0)})):a}function jb(a,b,e){switch(e){case "\x26":return a&b;case "|":return a|b;case "^":return a^b;case "\x3c\x3c":return a<<
b;case "\x3e\x3e":return a>>b;case "\x3e\x3e\x3e":return a>>>b}}function xa(a,b=null){if(null!=a){if(W(a)||y(a)||X(a))return a;if(a instanceof z)return!0===b?.keepGeometryType?a:a.toJSON();if(a instanceof m)return a.toArray().map(e=>xa(e,b));if(Array.isArray(a))return a.map(e=>xa(e,b));if(ya(a))return a;if(S(a))return a.toJSDate();if(ca(a))return a.toString();if(ba(a))return a.toJSDate();if(null!==a&&"object"===typeof a&&void 0!==a.castAsJson)return a.castAsJson(b)}return null}async function xb(a,
b,e,w,v){a=await Pa(a,b,e);v[w]=a}async function Pa(a,b=null,e=null){a instanceof m&&(a=a.toArray());if(null!=a){if(pa(a)||a instanceof z||ya(a)||S(a))return xa(a,e);if(Array.isArray(a)){const w=[],v=[];for(const H of a)null===H||pa(H)||H instanceof z||ya(H)||S(H)?v.push(xa(H,e)):(v.push(null),w.push(xb(H,b,e,v.length-1,v)));0<w.length&&await Promise.all(w);return v}if(null!==a&&"object"===typeof a&&void 0!==a.castAsJsonAsync)return a.castAsJsonAsync(b,e)}return null}function Ba(a){return Qa(a)?a.parent:
a}function Qa(a){return a&&"declaredClass"in a&&"esri.layers.support.SubtypeSublayer"===a.declaredClass}function kb(a){return a&&"declaredClass"in a&&"esri.layers.SubtypeGroupLayer"===a.declaredClass}function lb(a,b,e){const w=Ba(a.fullSchema());return null!==w&&w.fields?Aa(b,w,a,e):null}function mb(a){a=Ba(a.fullSchema());return null!==a&&a.fields?a.subtypeField?{subtypeField:a.subtypeField,subtypes:a.subtypes?a.subtypes.map(b=>({name:b.name,code:b.code})):[]}:a.typeIdField?{subtypeField:a.typeIdField,
subtypes:a.types?a.types.map(b=>({name:b.name,code:b.id})):[]}:null:null}function nb(a,b,e,w){const v=Ba(a.fullSchema());if(null===v||!v.fields)return null;w=Aa(b,v,a,w);if(void 0===e)try{e=a.field(b)}catch(H){return null}return Ma(w,e)}function ob(a,b,e,w){const v=Ba(a.fullSchema());if(null===v||!v.fields)return null;if(void 0===e){try{e=a.field(b)}catch(H){return null}return e}a=Aa(b,v,a,w);return Na(a,e)}function pb(a){return a?.timeZone??"system"}function qb(a){a=Ba(a.fullSchema());if(null===
a||!a.fields)return null;const b=[];for(const e of a.fields)b.push(d.esriFieldToJson(e));return{objectIdField:a.objectIdField,globalIdField:a.globalIdField??"",geometryType:void 0===d.layerGeometryEsriRestConstants[a.geometryType]?"":d.layerGeometryEsriRestConstants[a.geometryType],fields:b}}function rb(a,b){"system"===a&&(a=g.ArcadeDate.systemTimeZoneCanonicalName);return{version:"1.28",engineVersion:l.version,timeZone:a,spatialReference:b instanceof Z?b.toJSON():b,application:p.applicationName??
"",engine:"web",locale:C.getLocale()}}class sb{constructor(a){this.value=a}}class tb{constructor(a){this.value=a}}const ea={type:"VOID"},ub=Symbol("BREAK"),vb=Symbol("CONTINUE");let Oa=0;const yb=Object.freeze(Object.defineProperty({__proto__:null,ImplicitResult:tb,ReturnResult:sb,absRound:Ta,arcadeVersion:"1.28",autoCastArrayOfPointsToMultiPoint:gb,autoCastArrayOfPointsToPolygon:eb,autoCastArrayOfPointsToPolyline:fb,autoCastFeatureToGeometry:db,binaryOperator:jb,breakResult:ub,castAsJson:xa,castAsJsonAsync:Pa,
continueResult:vb,defaultExecutingContext:rb,defaultTimeZone:pb,defaultUndefined:ta,equalityTest:Ka,featureDomainCodeLookup:ob,featureDomainValueLookup:nb,featureFullDomain:lb,featureSchema:qb,featureSubtypes:mb,fixNullGeometry:$a,fixSpatialReference:Za,formatDate:za,formatNumber:Ea,getDomain:Aa,getDomainCode:Na,getDomainValue:Ma,getType:va,greaterThanLessThan:Ua,isArray:K,isBoolean:W,isDate:S,isDateOnly:ba,isDictionary:U,isFeature:M,isFeatureSet:Q,isFeatureSetCollection:T,isFunctionParameter:la,
isGeometry:J,isGraphic:F,isImmutableArray:ja,isInteger:D,isJsDate:ya,isKnowledgeGraph:da,isModule:ia,isNumber:y,isObject:Da,isQuery:E,isSimpleType:pa,isString:X,isSubtypeGrouplayer:kb,isSubtypeSublayer:Qa,isTime:ca,multiReplace:aa,parseGeometryFromJson:Ya,pcCheck:Sa,stableStringify:Ga,standardiseDateFormat:Ja,tick:ib,toBoolean:Xa,toDate:Wa,toNumber:Y,toNumberArray:Va,toString:qa,toStringArray:hb,toStringExplicit:La,voidOperation:ea},Symbol.toStringTag,{value:"Module"}));c.ImplicitResult=tb;c.ReturnResult=
sb;c.absRound=Ta;c.arcadeVersion="1.28";c.autoCastArrayOfPointsToMultiPoint=gb;c.autoCastArrayOfPointsToPolygon=eb;c.autoCastArrayOfPointsToPolyline=fb;c.autoCastFeatureToGeometry=db;c.binaryOperator=jb;c.breakResult=ub;c.castAsJson=xa;c.castAsJsonAsync=Pa;c.continueResult=vb;c.defaultExecutingContext=rb;c.defaultTimeZone=pb;c.defaultUndefined=ta;c.equalityTest=Ka;c.featureDomainCodeLookup=ob;c.featureDomainValueLookup=nb;c.featureFullDomain=lb;c.featureSchema=qb;c.featureSubtypes=mb;c.fixNullGeometry=
$a;c.fixSpatialReference=Za;c.formatDate=za;c.formatNumber=Ea;c.getDomain=Aa;c.getDomainCode=Na;c.getDomainValue=Ma;c.getType=va;c.greaterThanLessThan=Ua;c.isArray=K;c.isBoolean=W;c.isDate=S;c.isDateOnly=ba;c.isDictionary=U;c.isFeature=M;c.isFeatureSet=Q;c.isFeatureSetCollection=T;c.isFunctionParameter=la;c.isGeometry=J;c.isGraphic=F;c.isImmutableArray=ja;c.isInteger=D;c.isJsDate=ya;c.isKnowledgeGraph=da;c.isModule=ia;c.isNumber=y;c.isObject=Da;c.isQuery=E;c.isSimpleType=pa;c.isString=X;c.isSubtypeGrouplayer=
kb;c.isSubtypeSublayer=Qa;c.isTime=ca;c.lc=yb;c.multiReplace=aa;c.parseGeometryFromJson=Ya;c.pcCheck=Sa;c.stableStringify=Ga;c.standardiseDateFormat=Ja;c.tick=ib;c.toBoolean=Xa;c.toDate=Wa;c.toNumber=Y;c.toNumberArray=Va;c.toString=qa;c.toStringArray=hb;c.toStringExplicit=La;c.voidOperation=ea})},"esri/arcade/ArcadeModule":function(){define(["exports"],function(c){class p{}c.ArcadeModule=p;Object.defineProperty(c,Symbol.toStringTag,{value:"Module"})})},"esri/arcade/executionError":function(){define(["exports",
"../core/string"],function(c,p){function l(f){return f&&f.loc?`Line : ${f.loc.start?.line}, ${f.loc.start?.column}: `:""}c.ExecutionErrorCodes=void 0;(function(f){f.AsyncNotEnabled="AsyncNotEnabled";f.ModulesNotSupported="ModulesNotSupported";f.CircularModules="CircularModules";f.CannotCompareDateAndTime="CannotCompareDateAndTime";f.NeverReach="NeverReach";f.UnsupportedHashType="UnsupportedHashType";f.InvalidParameter="InvalidParameter";f.FeatureSetDoesNotHaveSubtypes="FeatureSetDoesNotHaveSubtypes";
f.UnexpectedToken="UnexpectedToken";f.Unrecognized="Unrecognized";f.UnrecognizedType="UnrecognizedType";f.MaximumCallDepth="MaximumCallDepth";f.BooleanConditionRequired="BooleanConditionRequired";f.TypeNotAllowedInFeature="TypeNotAllowedInFeature";f.KeyMustBeString="KeyMustBeString";f.WrongNumberOfParameters="WrongNumberOfParameters";f.CallNonFunction="CallNonFunction";f.NoFunctionInTemplateLiteral="NoFunctionInTemplateLiteral";f.NoFunctionInDictionary="NoFunctionInDictionary";f.NoFunctionInArray=
"NoFunctionInArray";f.AssignModuleFunction="AssignModuleFunction";f.LogicExpressionOrAnd="LogicExpressionOrAnd";f.LogicalExpressionOnlyBoolean="LogicalExpressionOnlyBoolean";f.FunctionNotFound="FunctionNotFound";f.InvalidMemberAccessKey="InvalidMemberAccessKey";f.UnsupportedUnaryOperator="UnsupportUnaryOperator";f.InvalidIdentifier="InvalidIdentifier";f.MemberOfNull="MemberOfNull";f.UnsupportedOperator="UnsupportedOperator";f.Cancelled="Cancelled";f.ModuleAccessorMustBeString="ModuleAccessorMustBeString";
f.ModuleExportNotFound="ModuleExportNotFound";f.Immutable="Immutable";f.OutOfBounds="OutOfBounds";f.IllegalResult="IllegalResult";f.FieldNotFound="FieldNotFound";f.PortalRequired="PortalRequired";f.LogicError="LogicError";f.ArrayAccessorMustBeNumber="ArrayAccessMustBeNumber";f.KeyAccessorMustBeString="KeyAccessorMustBeString";f.WrongSpatialReference="WrongSpatialReference";f.CannotChangeTimeZoneTime="CannotChangeTimeZoneTime";f.CannotChangeTimeZoneDateOnly="CannotChangeTimeZoneDateOnly"})(c.ExecutionErrorCodes||
(c.ExecutionErrorCodes={}));const g={[c.ExecutionErrorCodes.TypeNotAllowedInFeature]:"Feature attributes only support dates, numbers, strings, guids.",[c.ExecutionErrorCodes.LogicError]:"Logic error - {reason}",[c.ExecutionErrorCodes.CannotCompareDateAndTime]:"Cannot compare date or dateonly with timeonly types",[c.ExecutionErrorCodes.NeverReach]:"Encountered unreachable logic",[c.ExecutionErrorCodes.AsyncNotEnabled]:"Async Arcade must be enabled for this script",[c.ExecutionErrorCodes.ModuleAccessorMustBeString]:"Module accessor must be a string",
[c.ExecutionErrorCodes.ModuleExportNotFound]:"Module has no export with provided identifier",[c.ExecutionErrorCodes.ModulesNotSupported]:"Current profile does not support modules",[c.ExecutionErrorCodes.ArrayAccessorMustBeNumber]:"Array accessor must be a number",[c.ExecutionErrorCodes.FunctionNotFound]:"Function not found",[c.ExecutionErrorCodes.FieldNotFound]:"Key not found - {key}",[c.ExecutionErrorCodes.CircularModules]:"Circular module dependencies are not allowed",[c.ExecutionErrorCodes.Cancelled]:"Execution cancelled",
[c.ExecutionErrorCodes.UnsupportedHashType]:"Type not supported in hash function",[c.ExecutionErrorCodes.IllegalResult]:"Value is not a supported return type",[c.ExecutionErrorCodes.PortalRequired]:"Portal is required",[c.ExecutionErrorCodes.InvalidParameter]:"Invalid parameter",[c.ExecutionErrorCodes.WrongNumberOfParameters]:"Call with wrong number of parameters",[c.ExecutionErrorCodes.Unrecognized]:"Unrecognized code structure",[c.ExecutionErrorCodes.UnrecognizedType]:"Unrecognized type",[c.ExecutionErrorCodes.WrongSpatialReference]:"Cannot work with geometry in this spatial reference. It is different to the execution spatial reference",
[c.ExecutionErrorCodes.BooleanConditionRequired]:"Conditions must use booleans",[c.ExecutionErrorCodes.NoFunctionInDictionary]:"Dictionaries cannot contain functions.",[c.ExecutionErrorCodes.NoFunctionInArray]:"Arrays cannot contain functions.",[c.ExecutionErrorCodes.NoFunctionInTemplateLiteral]:"Template Literals do not expect functions by value.",[c.ExecutionErrorCodes.KeyAccessorMustBeString]:"Accessor must be a string",[c.ExecutionErrorCodes.KeyMustBeString]:"Object keys must be a string",[c.ExecutionErrorCodes.Immutable]:"Object is immutable",
[c.ExecutionErrorCodes.UnexpectedToken]:"Unexpected token",[c.ExecutionErrorCodes.MemberOfNull]:"Cannot access property of null object",[c.ExecutionErrorCodes.MaximumCallDepth]:"Exceeded maximum function depth",[c.ExecutionErrorCodes.OutOfBounds]:"Out of bounds",[c.ExecutionErrorCodes.InvalidIdentifier]:"Identifier not recognized",[c.ExecutionErrorCodes.CallNonFunction]:"Expression is not a function",[c.ExecutionErrorCodes.InvalidMemberAccessKey]:"Cannot access value using a key of this type",[c.ExecutionErrorCodes.AssignModuleFunction]:"Cannot assign function to module variable",
[c.ExecutionErrorCodes.UnsupportedUnaryOperator]:"Unsupported unary operator",[c.ExecutionErrorCodes.UnsupportedOperator]:"Unsupported operator",[c.ExecutionErrorCodes.LogicalExpressionOnlyBoolean]:"Logical expressions must be boolean",[c.ExecutionErrorCodes.LogicExpressionOrAnd]:"Logical expression can only be combined with || or \x26\x26",[c.ExecutionErrorCodes.CannotChangeTimeZoneTime]:"Cannot change the timezone of a Time",[c.ExecutionErrorCodes.CannotChangeTimeZoneDateOnly]:"Cannot change the timezone of a DateOnly",
[c.ExecutionErrorCodes.FeatureSetDoesNotHaveSubtypes]:"FeatureSet does not have subtypes"};class k extends Error{constructor(...f){super(...f)}}class q extends k{constructor(f,t){super(l(t)+f.message,{cause:f});this.loc=null;Error.captureStackTrace&&Error.captureStackTrace(this,q);t?.loc&&(this.loc=t.loc)}}class h extends Error{constructor(f,t,n,u){super("Execution error - "+l(n)+p.replace(g[t],u));this.loc=null;this.declaredRootClass="esri.arcade.arcadeexecutionerror";Error.captureStackTrace&&Error.captureStackTrace(this,
h);n?.loc&&(this.loc=n.loc)}}class m extends Error{constructor(f,t,n,u){super("Compilation error - "+l(n)+p.replace(g[t],u));this.loc=null;this.declaredRootClass="esri.arcade.arcadecompilationerror";Error.captureStackTrace&&Error.captureStackTrace(this,m);n?.loc&&(this.loc=n.loc)}}class x extends Error{constructor(){super("Uncompilable code structures");this.declaredRootClass="esri.arcade.arcadeuncompilableerror";Error.captureStackTrace&&Error.captureStackTrace(this,x)}}c.ModuleErrorCodes=void 0;
(function(f){f.UnrecognizedUri="UnrecognizedUri";f.UnsupportedUriProtocol="UnsupportedUriProtocol"})(c.ModuleErrorCodes||(c.ModuleErrorCodes={}));const r={[c.ModuleErrorCodes.UnrecognizedUri]:"Unrecognized uri - {uri}",[c.ModuleErrorCodes.UnsupportedUriProtocol]:"Unrecognized uri protocol"};class d extends Error{constructor(f,t){super(p.replace(r[f],t));this.declaredRootClass="esri.arcade.arcademoduleerror";Error.captureStackTrace&&Error.captureStackTrace(this,d)}}c.ArcadeCompilationError=m;c.ArcadeExecutionError=
h;c.ArcadeUncompilableError=x;c.ErrorWithCause=k;c.LocatableArcadeExecutionError=q;c.ModuleError=d;c.ensureArcadeExecutionError=function(f,t,n){return"esri.arcade.arcadeexecutionerror"===n.declaredRootClass||"esri.arcade.arcadecompilationerror"===n.declaredRootClass?null===n.loc&&t?.loc?new q(n,{cause:n}):n:t?.loc?new q(n,{cause:n}):n};c.executionErrorMessages=g;c.moduleErrorMessages=r;c.parsingValidationMessage=function(f,t,n){return"Parsing error - "+l(f)+p.replace(g[t],n)};Object.defineProperty(c,
Symbol.toStringTag,{value:"Module"})})},"esri/arcade/FunctionWrapper":function(){define(["exports","../core/promiseUtils"],function(c,p){function l(h,m,x){if(h instanceof g&&!(h instanceof q)){const r=new q;r.fn=h;r.parameterEvaluator=x;r.context=m;return r}return h}class g{constructor(){}}class k extends g{constructor(h){super();this.fn=h}createFunction(h){return(...m)=>this.fn(h,{preparsed:!0,arguments:m})}call(h,m){return this.fn(h,m)}marshalledCall(h,m,x,r){return r(h,m,(d,f,t)=>{t=t.map(n=>n instanceof
g&&!(n instanceof q)?l(n,h,r):n);d=this.call(x,{args:t});return p.isPromiseLike(d)?d.then(n=>l(n,x,r)):d})}}class q extends g{constructor(){super(...arguments);this.context=this.fn=null}createFunction(h){return this.fn.createFunction(this.context)}call(h,m){return this.fn.marshalledCall(h,m,this.context,this.parameterEvaluator)}marshalledCall(h,m,x){return this.fn.marshalledCall(h,m,this.context,this.parameterEvaluator)}}c.ArcadeFunction=g;c.NativeFunction=k;c.ScopeMarshalledFunction=q;c.wrapModuleScopedResponse=
l;Object.defineProperty(c,Symbol.toStringTag,{value:"Module"})})},"esri/arcade/ImmutableArray":function(){define(function(){class c{constructor(p=[]){this._elements=p}length(){return this._elements.length}get(p){return this._elements[p]}toArray(){return this.slice()}slice(p=0,l=this.length()){const g=[];for(;p<l;p++)g.push(this.get(p));return g}}return c})},"esri/arcade/ImmutablePathArray":function(){define(["./ImmutableArray","./ImmutablePointArray"],function(c,p){class l extends c{constructor(g,
k,q,h,m){super(g);this._lazyPath=[];this._hasM=this._hasZ=!1;this._hasZ=q;this._hasM=h;this._spRef=k;this._cacheId=m}get(g){if(void 0===this._lazyPath[g]){const k=this._elements[g];if(void 0===k)return;this._lazyPath[g]=new p(k,this._spRef,this._hasZ,this._hasM,this._cacheId,g)}return this._lazyPath[g]}equalityTest(g){return g===this?!0:null===g||!1===g instanceof l?!1:g.getUniqueHash()===this.getUniqueHash()}getUniqueHash(){return this._cacheId.toString()}}return l})},"esri/arcade/ImmutablePointArray":function(){define(["./ImmutableArray",
"../geometry/Point"],function(c,p){class l extends c{constructor(g,k,q,h,m,x){super(g);this._lazyPt=[];this._hasM=this._hasZ=!1;this._spRef=k;this._hasZ=q;this._hasM=h;this._cacheId=m;this._partId=x}get(g){if(void 0===this._lazyPt[g]){var k=this._elements[g];if(void 0===k)return;const q=this._hasZ,h=this._hasM;k=q&&!h?new p(k[0],k[1],k[2],void 0,this._spRef):h&&!q?new p(k[0],k[1],void 0,k[2],this._spRef):q&&h?new p(k[0],k[1],k[2],k[3],this._spRef):new p(k[0],k[1],this._spRef);k.cache._arcadeCacheId=
this._cacheId.toString()+"-"+this._partId.toString()+"-"+g.toString();this._lazyPt[g]=k}return this._lazyPt[g]}equalityTest(g){return g===this?!0:null===g||!1===g instanceof l?!1:g.getUniqueHash()===this.getUniqueHash()}getUniqueHash(){return this._cacheId.toString()+"-"+this._partId.toString()}}return l})},"esri/arcade/featureset/support/shared":function(){define("exports ../../ArcadeDate ../../../core/sql/DateOnly ../../../core/sql/TimeOnly ../../../geometry/Extent ../../../layers/support/Field ../../../chunks/datetime".split(" "),
function(c,p,l,g,k,q,h){function m(d){return d instanceof Date}function x(d){return d instanceof p.ArcadeDate}function r(d){switch(d.type){case "catalog":case "csv":case "feature":case "geojson":case "oriented-imagery":case "subtype-group":case "wfs":return!0;default:return!1}}c.FeatureServiceDatabaseType=void 0;(function(d){d[d.Standardised=0]="Standardised";d[d.StandardisedNoInterval=1]="StandardisedNoInterval";d[d.SqlServer=2]="SqlServer";d[d.Oracle=3]="Oracle";d[d.Postgres=4]="Postgres";d[d.PGDB=
5]="PGDB";d[d.FILEGDB=6]="FILEGDB";d[d.NotEvaluated=7]="NotEvaluated"})(c.FeatureServiceDatabaseType||(c.FeatureServiceDatabaseType={}));c.IdState=void 0;(function(d){d[d.InFeatureSet=0]="InFeatureSet";d[d.NotInFeatureSet=1]="NotInFeatureSet";d[d.Unknown=2]="Unknown"})(c.IdState||(c.IdState={}));c.callback=function(d,f){return function(){try{d.apply(null,arguments)}catch(t){f.reject(t)}}};c.cloneAttributes=function(d){const f={};for(const t in d)f[t]=d[t];return f};c.cloneField=function(d){return q.fromJSON(d.toJSON())};
c.convertLinearUnitsToCode=function(d){if(null==d)return null;if("number"===typeof d||"number"===typeof d)return d;switch(d.toLowerCase()){case "meters":case "meter":return 9001;case "miles":case "mile":return 9093;case "kilometers":case "kilometer":case "km":return 9036}return null};c.convertSquareUnitsToCode=function(d){if(null==d)return null;if("number"===typeof d)return d;switch(d.toLowerCase()){case "meters":case "meter":return 109404;case "miles":case "mile":return 109439;case "kilometers":case "kilometer":case "km":return 109414}return null};
c.defaultMaxRecords=1E3;c.equalityTest=function(d,f){return d===f?!0:(m(d)||x(d))&&(m(f)||x(f))?d.getTime()===f.getTime():!1};c.errback=function(d){return function(f){d.reject(f)}};c.esriFieldToJson=function(d){return d.toJSON?d.toJSON():d};c.extractServiceUrl=function(d){if(void 0===d)return"";d=d.replace(/\/featureserver\/[0-9]*/i,"/FeatureServer");d=d.replace(/\/mapserver\/[0-9]*/i,"/MapServer");return d=d.split("?")[0]};c.isArcadeDate=x;c.isArcadeDateOnly=function(d){return d instanceof l.DateOnly};
c.isArcadeTime=function(d){return d instanceof g.TimeOnly};c.isArray=function(d){return Array.isArray(d)};c.isBoolean=function(d){return"boolean"===typeof d};c.isDate=m;c.isLuxonDate=function(d){return d instanceof h.DateTime};c.isNumber=function(d){return"number"===typeof d};c.isString=function(d){return"string"===typeof d||d instanceof String};c.isSupportedLayer=function(d){switch(d.type){case "catalog-footprint":case "subtype-sublayer":return!0;default:return r(d)}};c.isSupportedSourceLayer=r;
c.layerFieldEsriConstants={"small-integer":"esriFieldTypeSmallInteger",integer:"esriFieldTypeInteger",long:"esriFieldTypeLong",single:"esriFieldTypeSingle",double:"esriFieldTypeDouble",string:"esriFieldTypeString",date:"esriFieldTypeDate","date-only":"esriFieldTypeDateOnly","time-only":"esriFieldTypeTimeOnly","timestamp-offset":"esriFieldTypeTimestampOffset",oid:"esriFieldTypeOID",geometry:"esriFieldTypeGeometry",blob:"esriFieldTypeBlob",raster:"esriFieldTypeRaster",guid:"esriFieldTypeGUID","global-id":"esriFieldTypeGlobalID",
xml:"esriFieldTypeXML","big-integer":"esriFieldTypeBigInteger",esriFieldTypeSmallInteger:"esriFieldTypeSmallInteger",esriFieldTypeInteger:"esriFieldTypeInteger",esriFieldTypeLong:"esriFieldTypeLong",esriFieldTypeSingle:"esriFieldTypeSingle",esriFieldTypeDouble:"esriFieldTypeDouble",esriFieldTypeString:"esriFieldTypeString",esriFieldTypeDate:"esriFieldTypeDate",esriFieldTypeDateOnly:"esriFieldTypeDateOnly",esriFieldTypeTimeOnly:"esriFieldTypeTimeOnly",esriFieldTypeTimestampOffset:"esriFieldTypeTimestampOffset",
esriFieldTypeOID:"esriFieldTypeOID",esriFieldTypeGeometry:"esriFieldTypeGeometry",esriFieldTypeBlob:"esriFieldTypeBlob",esriFieldTypeRaster:"esriFieldTypeRaster",esriFieldTypeGUID:"esriFieldTypeGUID",esriFieldTypeGlobalID:"esriFieldTypeGlobalID",esriFieldTypeXML:"esriFieldTypeXML",esriFieldTypeBigInteger:"esriFieldTypeBigInteger"};c.layerGeometryEsriConstants={point:"point",polygon:"polygon",polyline:"polyline",multipoint:"multipoint",extent:"extent",esriGeometryPoint:"point",esriGeometryPolygon:"polygon",
esriGeometryPolyline:"polyline",esriGeometryMultipoint:"multipoint",esriGeometryEnvelope:"extent",envelope:"extent"};c.layerGeometryEsriRestConstants={point:"esriGeometryPoint",polygon:"esriGeometryPolygon",polyline:"esriGeometryPolyline",multipoint:"esriGeometryMultipoint",extent:"esriGeometryEnvelope",esriGeometryPoint:"esriGeometryPoint",esriGeometryPolygon:"esriGeometryPolygon",esriGeometryPolyline:"esriGeometryPolyline",esriGeometryMultipoint:"esriGeometryMultipoint",esriGeometryEnvelope:"esriGeometryEnvelope",
envelope:"esriGeometryEnvelope"};c.sameGeomType=function(d,f){return d===f||"point"===d&&"esriGeometryPoint"===f||"polyline"===d&&"esriGeometryPolyline"===f||"polygon"===d&&"esriGeometryPolygon"===f||"extent"===d&&"esriGeometryEnvelope"===f||"multipoint"===d&&"esriGeometryMultipoint"===f||"point"===f&&"esriGeometryPoint"===d||"polyline"===f&&"esriGeometryPolyline"===d||"polygon"===f&&"esriGeometryPolygon"===d||"extent"===f&&"esriGeometryEnvelope"===d||"multipoint"===f&&"esriGeometryMultipoint"===
d?!0:!1};c.shapeExtent=function(d){if(null==d)return null;switch(d.type){case "polygon":case "multipoint":case "polyline":return d.extent;case "point":return new k({xmin:d.x,ymin:d.y,xmax:d.x,ymax:d.y,spatialReference:d.spatialReference});case "extent":return d}return null};c.stableStringify=function(d,f){f||={};"function"===typeof f&&(f={cmp:f});const t="boolean"===typeof f.cycles?f.cycles:!1,n=f.cmp&&function(z){return function(B){return function(A,L){return z({key:A,value:B[A]},{key:L,value:B[L]})}}}(f.cmp),
u=[];return function A(B){B?.toJSON&&"function"===typeof B.toJSON&&(B=B.toJSON());if(void 0!==B){if("number"===typeof B)return isFinite(B)?""+B:"null";if("object"!==typeof B)return JSON.stringify(B);var L;if(Array.isArray(B)){var P="[";for(L=0;L<B.length;L++)L&&(P+=","),P+=A(B[L])||"null";return P+"]"}if(null===B)return"null";if(u.includes(B)){if(t)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON");}var Z=u.push(B)-1,ha=Object.keys(B).sort(n?.(B));P="";
for(L=0;L<ha.length;L++){const fa=ha[L],C=A(B[fa]);C&&(P&&(P+=","),P+=JSON.stringify(fa)+":"+C)}u.splice(Z,1);return"{"+P+"}"}}(d)};c.toEsriGeometryType=function(d){switch(d){case "point":return"esriGeometryPoint";case "polygon":return"esriGeometryPolygon";case "multipoint":return"esriGeometryMultipoint";case "polyline":return"esriGeometryPolyline";default:return"esriGeometryPoint"}};Object.defineProperty(c,Symbol.toStringTag,{value:"Module"})})},"esri/core/number":function(){define(["exports","./string",
"../intl/locale"],function(c,p,l){function g(d=l.getLocale()){d=d.toLowerCase();let f=d in m;if(!f){const z=d.split("-");1<z.length&&z[0]in m&&(d=z[0],f=!0);f||(d="en")}const [t,n,u="#,##0.###"]=m[d];return{decimal:t,group:n,pattern:u}}function k(d){d=d||{};var f=g(d.locale);const t=d.pattern||f.pattern,n=f.group,u=f.decimal;let z=1;if(t.includes("%"))z/=100;else if(t.includes("\u2030"))z/=1E3;else if(t.includes("\u00a4"))throw Error("currency notation not supported");f=t.split(";");1===f.length&&
f.push("-"+f[0]);return{regexp:r(f,B=>{B="(?:"+p.escapeRegExpString(B,".")+")";return B.replace(x,A=>{const L={signed:!1,separator:d.strict?n:[n,""],fractional:d.fractional,decimal:u,exponent:!1};A=A.split(".");let P=d.places;1===A.length&&1!==z&&(A[1]="###");1===A.length||0===P?L.fractional=!1:(void 0===P&&(P=d.pattern?A[1].lastIndexOf("0")+1:Infinity),P&&null==d.fractional&&(L.fractional=!0),!d.places&&+P<A[1].length&&(P+=","+A[1].length),L.places=P);A=A[0].split(",");1<A.length&&(L.groupSize=A.pop().length,
1<A.length&&(L.groupSize2=A.pop().length));return"("+q(L)+")"})},!0).replaceAll(/[\xa0 ]/g,"[\\s\\xa0]"),group:n,decimal:u,factor:z}}function q(d){d=d||{};"places"in d||(d.places=Infinity);"string"!==typeof d.decimal&&(d.decimal=".");"fractional"in d&&!String(d.places).startsWith("0")||(d.fractional=[!0,!1]);"exponent"in d||(d.exponent=[!0,!1]);"eSigned"in d||(d.eSigned=[!0,!1]);var f=h(d);const t=r(d.fractional,u=>{let z="";u&&0!==d.places&&(z="\\"+d.decimal,z=Infinity===d.places?"(?:"+z+"\\d+)?":
z+("\\d{"+d.places+"}"));return z},!0),n=r(d.exponent,u=>u?"([eE]"+h({signed:d.eSigned})+")":"");f+=t;t&&(f="(?:(?:"+f+")|(?:"+t+"))");return f+n}function h(d){d=d||{};"signed"in d||(d.signed=[!0,!1]);"separator"in d?"groupSize"in d||(d.groupSize=3):d.separator="";const f=r(d.signed,n=>n?"[-+]":"",!0),t=r(d.separator,n=>{if(!n)return"(?:\\d+)";n=p.escapeRegExpString(n);" "===n?n="\\s":"\u00a0"===n&&(n="\\s\\xa0");const u=d.groupSize,z=d.groupSize2;return z?(n="(?:0|[1-9]\\d{0,"+(z-1)+"}(?:["+n+"]\\d{"+
z+"})*["+n+"]\\d{"+u+"})",0<u-z?"(?:"+n+"|(?:0|[1-9]\\d{0,"+(u-1)+"}))":n):"(?:0|[1-9]\\d{0,"+(u-1)+"}(?:["+n+"]\\d{"+u+"})*)"},!0);return f+t}const m={ar:[".",","],bg:[",","\u00a0"],bs:[",","."],ca:[",","."],cs:[",","\u00a0"],da:[",","."],de:[",","."],"de-ch":[".","\u2019"],el:[",","."],en:[".",","],"en-au":[".",","],es:[",","."],"es-mx":[".",","],et:[",","\u00a0"],fi:[",","\u00a0"],fr:[",","\u202f"],"fr-ch":[",","\u202f"],he:[".",","],hi:[".",",","#,##,##0.###"],hr:[",","."],hu:[",","\u00a0"],id:[",",
"."],it:[",","."],"it-ch":[".","\u2019"],ja:[".",","],ko:[".",","],lt:[",","\u00a0"],lv:[",","\u00a0"],mk:[",","."],nb:[",","\u00a0"],nl:[",","."],pl:[",","\u00a0"],pt:[",","."],"pt-pt":[",","\u00a0"],ro:[",","."],ru:[",","\u00a0"],sk:[",","\u00a0"],sl:[",","."],sr:[",","."],sv:[",","\u00a0"],th:[".",","],tr:[",","."],uk:[",","\u00a0"],vi:[",","."],zh:[".",","]},x=/[#0,]*[#0](?:\.0*#*)?/,r=(d,f,t)=>{if(!Array.isArray(d))return f(d);const n=[];for(let u=0;u<d.length;u++)n.push(f(d[u]));d=n.join("|");
return"("+(t?"?:":"")+d+")"};c._parseInfo=k;c.format=function(d,f){f={...f};var t=g(f.locale);f.customs=t;t=f.pattern||t.pattern;if(isNaN(d)||Infinity===Math.abs(d))return null;var n=d;var u=f||{};var z=u.customs.group,B=u.customs.decimal;t=t.split(";");d=t[0];f=t[0>n?1:0]||"-"+d;if(f.includes("%"))n*=100;else if(f.includes("\u2030"))n*=1E3;else{if(f.includes("\u00a4"))throw Error("currency notation not supported");if(f.includes("E"))throw Error("exponential notation not supported");}t=x;var A=d.match(t);
if(!A)throw Error("unable to find a number expression in pattern: "+f);!1===u.fractional&&(u.places=0);d=f.replace;A=A[0];u=u={decimal:B,group:z,places:u.places,round:u.round};!0===u.places&&(u.places=0);Infinity===u.places&&(u.places=6);B=A.split(".");var L="string"===typeof u.places&&u.places.indexOf(",");A=u.places;L?A=u.places.slice(L+1):0<=+A||(A=(B[1]||[]).length);0>u.round||(n=Number(n.toFixed(Number(A))));z=String(Math.abs(n)).split(".");n=z[1]||"";B[1]||u.places?(L&&(u.places=u.places.slice(0,
Math.max(0,L))),L=void 0!==u.places?u.places:B[1]&&B[1].lastIndexOf("0")+1,+L>n.length&&(z[1]=n.padEnd(Number(L),"0")),+A<n.length&&(z[1]=n.slice(0,Math.max(0,Number(A))))):z[1]&&z.pop();n=B[0].replace(",","");A=n.indexOf("0");-1!==A&&(A=n.length-A,A>z[0].length&&(z[0]=z[0].padStart(A,"0")),n.includes("#")||(z[0]=z[0].slice(-A)));n=B[0].lastIndexOf(",");let P;if(-1!==n){var Z=B[0].length-n-1;B=B[0].slice(0,n);n=B.lastIndexOf(",");-1!==n&&(P=B.length-n-1)}B=[];for(n=z[0];n;)A=n.length-Z,B.push(0<A?
n.slice(Math.max(0,A)):n),n=0<A?n.slice(0,A):"",P&&(Z=P,P=void 0);z[0]=B.reverse().join(u.group||",");Z=z.join(u.decimal||".");return d.call(f,t,Z)};c.getCustoms=g;c.parse=function(d,f){f=k(f);d=(new RegExp("^"+f.regexp+"$")).exec(d);if(!d)return NaN;let t=d[1];if(!d[1]){if(!d[2])return NaN;t=d[2];f.factor*=-1}t=t.replaceAll(new RegExp("["+f.group+"\\s\\xa0]","g"),"").replace(f.decimal,".");return Number(t)*f.factor};c.regexp=function(d){return k(d).regexp};Object.defineProperty(c,Symbol.toStringTag,
{value:"Module"})})},"esri/layers/support/floorFilterUtils":function(){define(["exports"],function(c){function p(l,g){if(!l?.length)return null;l=l.filter(k=>""!==k).map(k=>`'${k}'`);l.push("''");return`${g} IN (${l.join(",")}) OR ${g} IS NULL`}c.getFloorFilterClause=function(l){const g=l.layer;return"floorInfo"in g&&g.floorInfo?.floorField&&"floors"in l.view?p(l.view.floors,g.floorInfo.floorField):null};c.getLayerFloorFilterClause=function(l,g){return"floorInfo"in g&&g.floorInfo?.floorField?p(l,
g.floorInfo.floorField):null};Object.defineProperty(c,Symbol.toStringTag,{value:"Module"})})},"esri/renderers/support/clickToleranceUtils":function(){define(["exports"],function(c){function p(k,q){return q?"xoffset"in q&&q.xoffset?Math.max(k,Math.abs(q.xoffset)):"yoffset"in q&&q.yoffset?Math.max(k,Math.abs(q.yoffset||0)):k:k}function l(k,q){if("number"===typeof k)return k;if(k?.stops?.length){k=k.stops;let h=q=0;for(let m=0;m<k.length;m++){const x=k[m].size;"number"===typeof x&&(q+=x,h++)}return q/
h}return q}function g(k,q){if(!q)return k;q=q.filter(x=>"size"===x.type).map(x=>{const {maxSize:r,minSize:d}=x;return(l(r,k)+l(d,k))/2});let h=0;const m=q.length;if(0===m)return k;for(let x=0;x<m;x++)h+=q[x];return Math.max(Math.floor(h/m),k)}c.calculateTolerance=function(k){const q=k?.renderer;k="touch"===k?.pointerType?9:6;if(!q)return k;k="visualVariables"in q?g(k,q.visualVariables):k;if("simple"===q.type)return p(k,q.symbol);if("unique-value"===q.type){let h=k;q.uniqueValueInfos?.forEach(m=>{h=
p(h,m.symbol)});return h}if("class-breaks"===q.type){let h=k;q.classBreakInfos.forEach(m=>{h=p(h,m.symbol)});return h}return k};Object.defineProperty(c,Symbol.toStringTag,{value:"Module"})})},"esri/rest/identify":function(){define("exports ../request ../geometry/support/normalizeUtils ./utils ./operations/identify ./support/IdentifyParameters ./support/IdentifyResult".split(" "),function(c,p,l,g,k,q,h){function m(d){d=d.data;d.results=d.results||[];d.exceededTransferLimit=!!d.exceededTransferLimit;
d.results=d.results.map(f=>h.fromJSON(f));return d}function x(d){return d=q.from(d)}function r(d,f){function t(u){n.set(u.id,u);u.sublayers&&u.sublayers.forEach(t)}if(!f?.length)return d;const n=new Map;f.forEach(t);for(const u of d.results)u.feature.sourceLayer=n.get(u.layerId);return d}c.identify=async function(d,f,t){f=x(f);const n=f.geometry?[f.geometry]:[],u=g.parseUrl(d);u.path+="/identify";return l.normalizeCentralMeridian(n).then(z=>{z=k.identifyToIdentifyRESTParameters(f,{geometry:z?.[0]});
z=g.encode({...u.query,f:"json",...z});z=g.asValidOptions(z,t);return p(u.path,z).then(m).then(B=>r(B,f.sublayers))})};Object.defineProperty(c,Symbol.toStringTag,{value:"Module"})})},"esri/rest/operations/identify":function(){define("exports ../../core/sql ../../geometry/support/jsonUtils ../../geometry/support/scaleUtils ../../geometry/support/spatialReferenceUtils ../../layers/support/floorFilterUtils ../../layers/support/sublayerUtils".split(" "),function(c,p,l,g,k,q,h){function m(r){const {mapExtent:d,
floors:f,width:t,sublayers:n,layerIds:u,layerOption:z,gdbVersion:B}=r;var A=n?.find(C=>null!=C.layer)?.layer?.serviceSublayers;const L="popup"===z;r={};const P=g.getScale({extent:d,width:t,spatialReference:d?.spatialReference}),Z=[],ha=C=>{const O=0===P,G=0===C.minScale||P<=C.minScale,aa=0===C.maxScale||P>=C.maxScale;C.visible&&(O||G&&aa)&&(C.sublayers?C.sublayers.forEach(ha):!1!==u?.includes(C.id)&&(!L||C.popupTemplate&&C.popupEnabled)&&Z.unshift(C))};n?.forEach(ha);if(n&&!Z.length)r.layerIds=[];
else{A=h.isExportDynamic(Z,A,B);var fa=Z.map(C=>{const O=q.getLayerFloorFilterClause(f,C);return C.toExportImageJSON(O)});if(A)r.dynamicLayers=JSON.stringify(fa);else if(n?(A=Z.map(({id:C})=>C),u&&(A=A.filter(C=>u.includes(C))),r.layerIds=A):u?.length&&(r.layerIds=u),A=x(f,Z),null!=A&&A.length){fa={};for(const C of A)C.definitionExpression&&(fa[C.id]=C.definitionExpression);Object.keys(fa).length&&(r.layerDefs=JSON.stringify(fa))}}return r}function x(r,d){const f=!!r?.length;d=d.filter(t=>null!=t.definitionExpression||
f&&null!=t.floorInfo);return d.length?d.map(t=>{var n=q.getLayerFloorFilterClause(r,t);n=p.sqlAnd(n,t.definitionExpression);return{id:t.id,definitionExpression:n??void 0}}):null}c.identifyToIdentifyRESTParameters=function(r,d){const {dpi:f,gdbVersion:t,geometry:n,geometryPrecision:u,height:z,historicMoment:B,layerOption:A,mapExtent:L,maxAllowableOffset:P,returnFieldName:Z,returnGeometry:ha,returnUnformattedValues:fa,returnZ:C,spatialReference:O,timeExtent:G,tolerance:aa,width:la}=r.toJSON(),{dynamicLayers:ia,
layerDefs:pa,layerIds:ta}=m(r);r={historicMoment:B,geometryPrecision:u,maxAllowableOffset:P,returnFieldName:Z,returnGeometry:ha,returnUnformattedValues:fa,returnZ:C,tolerance:aa};d=(null!=d?.geometry?d.geometry:null)?.toJSON()||n;r.imageDisplay=`${la},${z},${f}`;t&&(r.gdbVersion=t);d&&(delete d.spatialReference,r.geometry=JSON.stringify(d),r.geometryType=l.getJsonType(d));if(d=O??d?.spatialReference??L?.spatialReference)r.sr=k.srToRESTValue(d);r.time=G?[G.start,G.end].join():null;if(L){const {xmin:va,
ymin:X,xmax:W,ymax:y}=L;r.mapExtent=`${va},${X},${W},${y}`}pa&&(r.layerDefs=pa);ia&&!pa&&(r.dynamicLayers=ia);r.layers="popup"===A?"visible":A;ta&&!ia&&(r.layers+=`:${ta.join(",")}`);return r};c.toDynamicLayersJSON=m;Object.defineProperty(c,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/sublayerUtils":function(){define(["exports","../../core/accessorSupport/PropertyOrigin"],function(c,p){function l(g,k){if(!g?.length||null==k)return!0;k=k.slice().reverse().flatten(({sublayers:m})=>m&&
m.toArray().reverse()).map(m=>m.id).toArray();if(g.length>k.length)return!1;let q=0;const h=k.length;for(const {id:m}of g){for(;q<h&&k[q]!==m;)q++;if(q>=h)return!1}return!0}c.isExportDynamic=function(g,k,q){return g.some(h=>{var m=h.source;m=!m||"map-layer"===m.type&&m.mapLayerId===h.id&&(null==m.gdbVersion||m.gdbVersion===q);h.commitProperty("renderer");h.commitProperty("labelingInfo");h.commitProperty("opacity");h.commitProperty("labelsVisible");return!m||h.originIdOf("renderer")>p.OriginId.SERVICE||
h.originIdOf("labelingInfo")>p.OriginId.SERVICE||h.originIdOf("opacity")>p.OriginId.SERVICE||h.originIdOf("labelsVisible")>p.OriginId.SERVICE})?!0:!l(g,k)};c.isSublayerOverhaul=function(g){return!!g&&g.some(k=>null!=k.minScale||null!=k.layerDefinition?.minScale)};c.shouldWriteSublayerStructure=function(g,k,q){return k.flatten(({sublayers:h})=>h).length!==g.length||g.some(h=>h.originIdOf("minScale")>q||h.originIdOf("maxScale")>q||h.originIdOf("renderer")>q||h.originIdOf("labelingInfo")>q||h.originIdOf("opacity")>
q||h.originIdOf("labelsVisible")>q||h.originIdOf("source")>q)?!0:!l(g,k)};Object.defineProperty(c,Symbol.toStringTag,{value:"Module"})})},"esri/rest/support/IdentifyParameters":function(){define("../../chunks/tslib.es6 ../../geometry ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/RandomLCG ../../core/has ../../core/accessorSupport/decorators/subclass ../../core/accessorSupport/decorators/writer ../../geometry/support/jsonUtils ../../time/TimeExtent ../../geometry/Extent ../../geometry/SpatialReference".split(" "),
function(c,p,l,g,k,q,h,m,x,r,d,f,t){var n;l=n=class extends l.JSONSupport{static from(u){return k.ensureClass(n,u)}constructor(u){super(u);this.dpi=96;this.geometryPrecision=this.geometry=this.gdbVersion=this.floors=null;this.height=400;this.layerIds=this.historicMoment=null;this.layerOption="top";this.maxAllowableOffset=this.mapExtent=null;this.returnFieldName=!0;this.returnM=this.returnGeometry=!1;this.returnUnformattedValues=!0;this.returnZ=!1;this.tolerance=this.timeExtent=this.sublayers=this.spatialReference=
null;this.width=400}writeHistoricMoment(u,z){z.historicMoment=u&&u.getTime()}};c.__decorate([g.property({type:Number,json:{write:!0}})],l.prototype,"dpi",void 0);c.__decorate([g.property()],l.prototype,"floors",void 0);c.__decorate([g.property({type:String,json:{write:!0}})],l.prototype,"gdbVersion",void 0);c.__decorate([g.property({types:p.geometryTypes,json:{read:r.fromJSON,write:!0}})],l.prototype,"geometry",void 0);c.__decorate([g.property({type:Number,json:{write:!0}})],l.prototype,"geometryPrecision",
void 0);c.__decorate([g.property({type:Number,json:{write:!0}})],l.prototype,"height",void 0);c.__decorate([g.property({type:Date})],l.prototype,"historicMoment",void 0);c.__decorate([x.writer("historicMoment")],l.prototype,"writeHistoricMoment",null);c.__decorate([g.property({type:[Number],json:{write:!0}})],l.prototype,"layerIds",void 0);c.__decorate([g.property({type:["top","visible","all","popup"],json:{write:!0}})],l.prototype,"layerOption",void 0);c.__decorate([g.property({type:f,json:{write:!0}})],
l.prototype,"mapExtent",void 0);c.__decorate([g.property({type:Number,json:{write:!0}})],l.prototype,"maxAllowableOffset",void 0);c.__decorate([g.property({type:Boolean,json:{write:!0}})],l.prototype,"returnFieldName",void 0);c.__decorate([g.property({type:Boolean,json:{write:!0}})],l.prototype,"returnGeometry",void 0);c.__decorate([g.property({type:Boolean,json:{write:!0}})],l.prototype,"returnM",void 0);c.__decorate([g.property({type:Boolean,json:{write:!0}})],l.prototype,"returnUnformattedValues",
void 0);c.__decorate([g.property({type:Boolean,json:{write:!0}})],l.prototype,"returnZ",void 0);c.__decorate([g.property({type:t,json:{write:!0}})],l.prototype,"spatialReference",void 0);c.__decorate([g.property()],l.prototype,"sublayers",void 0);c.__decorate([g.property({type:d,json:{write:!0}})],l.prototype,"timeExtent",void 0);c.__decorate([g.property({type:Number,json:{write:!0}})],l.prototype,"tolerance",void 0);c.__decorate([g.property({type:Number,json:{write:!0}})],l.prototype,"width",void 0);
return l=n=c.__decorate([m.subclass("esri.rest.support.IdentifyParameters")],l)})},"esri/rest/support/IdentifyResult":function(){define("../../chunks/tslib.es6 ../../geometry ../../Graphic ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/has ../../core/Logger ../../core/RandomLCG ../../core/accessorSupport/decorators/reader ../../core/accessorSupport/decorators/subclass ../../core/accessorSupport/decorators/writer ../../geometry/support/typeUtils".split(" "),function(c,
p,l,g,k,q,h,m,x,r,d,f){p=class extends g.JSONSupport{constructor(t){super(t);this.layerName=this.layerId=this.feature=this.displayFieldName=null}readFeature(t,n){return l.fromJSON({attributes:{...n.attributes},geometry:{...n.geometry}})}writeFeature(t,n){if(t){var {attributes:u,geometry:z}=t;u&&(n.attributes={...u});null!=z&&(n.geometry=z.toJSON(),n.geometryType=f.typeKebabDictionary.toJSON(z.type))}}};c.__decorate([k.property({type:String,json:{write:!0}})],p.prototype,"displayFieldName",void 0);
c.__decorate([k.property({type:l})],p.prototype,"feature",void 0);c.__decorate([x.reader("feature",["attributes","geometry"])],p.prototype,"readFeature",null);c.__decorate([d.writer("feature")],p.prototype,"writeFeature",null);c.__decorate([k.property({type:Number,json:{write:!0}})],p.prototype,"layerId",void 0);c.__decorate([k.property({type:String,json:{write:!0}})],p.prototype,"layerName",void 0);return p=c.__decorate([r.subclass("esri.rest.support.IdentifyResult")],p)})},"esri/views/3d/layers/support/highlightUtils":function(){define(["exports",
"../../../../chunks/languageUtils","../../../../core/Collection","../../../../core/handleUtils"],function(c,p,l,g){function k(h){return"number"===typeof h||"string"===typeof h}const q=[];g=g.makeHandle();c.emptyHighlightHandle=g;c.isObjectId=k;c.normalizeHighlightTargetExceptQuery=function(h){return k(h)||p.isGraphic(h)?[h]:l.isCollection(h)?h.toArray():Array.isArray(h)?h:q};Object.defineProperty(c,Symbol.toStringTag,{value:"Module"})})},"esri/views/layers/support/popupUtils":function(){define(["exports",
"../../../layers/support/fieldUtils"],function(c,p){function l(g,k){return g.popupTemplate?g.popupTemplate:null!=k&&k.defaultPopupTemplateEnabled&&null!=g.defaultPopupTemplate?g.defaultPopupTemplate:null}c.getFetchPopupTemplate=l;c.getRequiredFields=async function(g,k=g.popupTemplate){if(null==k)return[];const q=await k.getRequiredFields(g.fieldsIndex);({lastEditInfoEnabled:k}=k);const {objectIdField:h,typeIdField:m,globalIdField:x,relationships:r}=g;if(q.includes("*"))return["*"];k=k?p.getFeatureEditFields(g):
[];const d=p.fixFields(g.fieldsIndex,[...q,...k]);m&&d.push(m);d&&h&&g.fieldsIndex?.has(h)&&!d.includes(h)&&d.push(h);d&&x&&g.fieldsIndex?.has(x)&&!d.includes(x)&&d.push(x);r&&r.forEach(f=>{({keyField:f}=f);d&&f&&g.fieldsIndex?.has(f)&&!d.includes(f)&&d.push(f)});return d};c.hasPopupTemplate=function(g,k){return null!=l(g,{defaultPopupTemplateEnabled:k})};Object.defineProperty(c,Symbol.toStringTag,{value:"Module"})})},"esri/views/support/drapedUtils":function(){define(["exports","../../geometry",
"../../core/unitUtils","../../renderers/support/clickToleranceUtils","../../geometry/Extent"],function(c,p,l,g,k){function q(m,x,r,d=new k){let f=0;if("2d"===r.type)f=x*(r.resolution??0);else if("3d"===r.type){var t=r.overlayPixelSizeInMapUnits(m),n=r.basemapSpatialReference;f=null==n||n.equals(r.spatialReference)?x*t:l.getMetersPerUnitForSR(n)/l.getMetersPerUnitForSR(r.spatialReference)}x=m.x-f;t=m.y-f;n=m.x+f;m=m.y+f;({spatialReference:r}=r);d.xmin=Math.min(x,n);d.ymin=Math.min(t,m);d.xmax=Math.max(x,
n);d.ymax=Math.max(t,m);d.spatialReference=r;return d}const h=new k;c.createQueryGeometry=q;c.intersectsDrapedGeometry=function(m,x,r){m=r.toMap(m);if(null==m)return!1;const d=g.calculateTolerance();return q(m,d,r,h).intersects(x)};Object.defineProperty(c,Symbol.toStringTag,{value:"Module"})})},"*noref":1}});
define("../../../chunks/tslib.es6 ../../../core/handleUtils ../../../core/Logger ../../../core/promiseUtils ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ../../../geometry/support/spatialReferenceUtils ../../../support/GraphicsCollection ../../../core/Error ../../../core/scheduling ../../../core/accessorSupport/tracking/Flags ../../../core/colorUtils ../../../config ../../../symbols/cim/defaultCIMValues ../../../symbols/cim/enums ../../../core/floatRGBA ../../../geometry/Extent ../../../geometry/Geometry ../../../geometry/Multipoint ../../../geometry/Point ../../../geometry/Polygon ../../../geometry/Polyline ../engine/webgl/definitions ../engine/webgl/animations/instructions ../../../core/mathUtils ../../../symbols/Font ../../../core/ObjectPool ../../../geometry/support/Axis ../../../geometry/support/TileClipper ../../../symbols/cim/effects/EffectAddControlPoints ../../../symbols/cim/effects/EffectArrow ../../../symbols/cim/effects/EffectBuffer ../../../symbols/cim/effects/EffectControlMeasureLine ../../../symbols/cim/effects/EffectCut ../../../symbols/cim/effects/EffectDashes ../../../symbols/cim/effects/EffectDonut ../../../symbols/cim/effects/EffectJog ../../../symbols/cim/effects/EffectMove ../../../symbols/cim/effects/EffectOffset ../../../symbols/cim/effects/EffectReverse ../../../symbols/cim/effects/EffectRotate ../../../symbols/cim/effects/EffectScale ../../../symbols/cim/effects/EffectWave ../../../symbols/cim/placements/PlacementAlongLineSameSize ../../../symbols/cim/placements/PlacementAtExtremities ../../../symbols/cim/placements/PlacementAtRatioPositions ../../../symbols/cim/placements/PlacementInsidePolygon ../../../symbols/cim/placements/PlacementOnLine ../../../symbols/cim/placements/PlacementOnVertices ../../../symbols/cim/placements/PlacementPolygonCenter ../../../core/libs/gl-matrix-2/factories/vec2f32 ../engine/webgl/alignmentUtils ../../../symbols/support/defaults ../../../symbols/cim/OverrideHelper ../../../layers/effects/EffectView ../../../core/Evented ../engine/transitions/FadeTransition ../engine/webgl/enums ../engine/webgl/brushes/BrushBitmap ../../../core/libs/gl-matrix-2/factories/vec4f32 ../../webgl/checkWebGLError ../../webgl/enums ../../webgl/FramebufferObject ../../webgl/GLObjectType ../../webgl/Texture ../engine/webgl/shaders/BackgroundPrograms ../engine/webgl/DefaultVertexAttributeLayouts ../engine/webgl/AFeatureTile ../engine/webgl/DisplayEntity ../engine/webgl/shaderGraph/techniques/featureTechniqueUtils ../engine/webgl/number ../engine/webgl/PooledUint32Array ../engine/webgl/shaders/TileInfoPrograms ../engine/vectorTiles/style/StyleDefinition ../engine/vectorTiles/enums ../engine/webgl/shaders/BitBlitPrograms ../../../request ../../../core/urlUtils ../../../core/pbf ../engine/webgl/shaders/StencilPrograms ../engine/webgl/shaderGraph/techniques/TechniqueType ../engine/webgl/shaderGraph/techniques/shaders/BlendShader ../engine/webgl/shaderGraph/techniques/shaders/OpacityShader ../engine/webgl/shaders/HighlightPrograms ../engine/webgl/meshing/SimpleMesh ../engine/webgl/Profiler ../engine/webgl/shaderGraph/techniques/TechniqueRegistry ../../../Color ../engine/webgl/shaderGraph/techniques/shaders/constants ../engine/webgl/shaderGraph/techniques/dotDensity/DotDensityMeshWriter ../engine/webgl/shaderGraph/techniques/fill/ComplexFillMeshWriter ../engine/webgl/shaderGraph/techniques/fill/ComplexOutlineFillMeshWriter ../engine/webgl/shaderGraph/techniques/fill/FillMeshWriter ../engine/webgl/shaderGraph/techniques/fill/OutlineFillMeshWriter ../engine/webgl/shaderGraph/techniques/fill/PatternFillMeshWriter ../engine/webgl/shaderGraph/techniques/fill/PatternOutlineFillMeshWriter ../engine/webgl/shaderGraph/techniques/heatmap/HeatmapMeshWriter ../../../geometry/support/aaBoundingBox ../engine/webgl/shaderGraph/techniques/text/TextMeshWriter ../engine/webgl/shaderGraph/techniques/line/LineMeshWriter ../engine/webgl/shaderGraph/techniques/line/TexturedLineMeshWriter ../engine/webgl/shaderGraph/techniques/markers/MarkerMeshWriter ../engine/webgl/shaderGraph/techniques/pieChart/PieChartMeshWriter ../../webgl/renderState ../../3d/webgl-engine/core/shaderModules/interfaces ../../webgl/testSVGPremultipliedAlpha ../LabelManager ./graphics/GraphicsView2D ../../../core/asyncUtils ../../../core/Collection ../../../core/accessorSupport/watch ../../../core/accessorSupport/tracking/SimpleTrackingTarget ../../../chunks/earcut ../../../core/libs/gl-matrix-2/factories/vec3f32 ../../../geometry/support/normalizeUtilsCommon ../../../geometry/SpatialReference ../../../geometry/support/Ellipsoid ../../../geometry ../../../kernel ./support/util ../navigation/MapViewNavigation ../../../core/support/UpdatingHandles ../engine/webgl/shaderGraph/techniques/shaders/MagnifierShader ../../../core/unitUtils ../../../geometry/ellipsoidUtils ../../../chunks/pe ../../../geometry/projection/projectors ../engine/webgl/shaderGraph/techniques/shaders/GridShader ../../../geometry/support/geodesicConstants ./BitmapTileLayerView2D ./LayerView2D ./graphics/HighlightGraphicContainer ./support/imageUtils ../tiling/TileInfoView ../tiling/TileKey ../tiling/TileQueue ../tiling/TileStrategy ../../layers/LayerView ../../layers/RefreshableLayerView ../../layers/support/MapServiceLayerViewHelper ../../support/drapedUtils ../../support/Scheduler".split(" "),function(c,
p,l,g,k,q,h,m,x,r,d,f,t,n,u,z,B,A,L,P,Z,ha,fa,C,O,G,aa,la,ia,pa,ta,va,X,W,y,D,J,K,M,F,E,Q,U,T,da,ja,S,ba,ca,Da,ya,Sa,Ta,Ea,za,Ja,N,Ua,Ka,qa,Va,La,Fa,Y,Wa,Xa,Ya,Za,$a,Ma,Na,Aa,ab,Ga,db,wa,eb,fb,gb,hb,ib,jb,xa,xb,Pa,Ba,Qa,kb,lb,mb,nb,ob,pb,qb,rb,sb,tb,ea,ub,vb,Oa,yb,a,b,e,w,v,H,R,na,ka,oa,ra,ua,bb,cb,Mb,Nb,Ob,Pb,Qb,Rb,Sb,Tb,Ub,Vb,Wb,Xb,Yb,Zb,$b,Bb,Cb,Db,Ha,Eb,zb,Fb,Gb,Hb,Ib,Ab,Jb,Kb){const Lb=[0,0];let Ra=class extends Ib(Bb.BitmapTileLayerView2D(Cb.LayerView2DMixin(Hb))){constructor(){super(...arguments);
this._fetchQueue=null;this._highlightGraphics=new r.GraphicsCollection;this.layer=this._tileStrategy=this._popupHighlightHelper=this._highlightView=null}get resampling(){return!("resampling"in this.layer)||!1!==this.layer.resampling}get tilemapCache(){return"tilemapCache"in this.layer?this.layer.tilemapCache:null}update(I){this._fetchQueue.pause();this._fetchQueue.state=I.state;this._tileStrategy.update(I);this._fetchQueue.resume();this._highlightView?.processUpdate(I)}attach(){const I="tileServers"in
this.layer?this.layer.tileServers:null,V=this.tilemapCache;this._tileInfoView=new Eb(this.layer.tileInfo,this.layer.fullExtent,V?.effectiveMinLOD,V?.effectiveMaxLOD);this._fetchQueue=new Fb({tileInfoView:this._tileInfoView,concurrency:I&&10*I.length||10,process:(ma,sa)=>this.fetchTile(ma,sa),scheduler:this.scheduler,priority:Kb.TaskPriority.MAPVIEW_FETCH_QUEUE});this._tileStrategy=new Gb({cachePolicy:"keep",resampling:this.resampling,acquireTile:ma=>this.acquireTile(ma),releaseTile:ma=>this.releaseTile(ma),
tileInfoView:this._tileInfoView});if(Ab.isMapServiceLayerView(this,this.layer)){const ma=this._highlightView=new na({view:this.view,graphics:this._highlightGraphics,requestUpdateCallback:()=>this.requestUpdate(),container:new Db(this.view.featuresTilingScheme),defaultPointSymbolEnabled:!1});this.container.addChild(this._highlightView.container);this._popupHighlightHelper=new Ab.MapServiceLayerViewHelper({createFetchPopupFeaturesQueryGeometry:(sa,Ca)=>Jb.createQueryGeometry(sa,Ca,this.view),highlightGraphics:this._highlightGraphics,
highlightGraphicUpdated:(sa,Ca)=>{ma.graphicUpdateHandler({graphic:sa,property:Ca})},layerView:this,updatingHandles:this._updatingHandles})}this.requestUpdate();this.addAttachHandles(this._updatingHandles.add(()=>this.resampling,()=>{this.doRefresh()}));super.attach()}detach(){super.detach();this._tileStrategy.destroy();this._fetchQueue.clear();this.container.removeAllChildren();this._popupHighlightHelper?.destroy();this._highlightView?.destroy();this._fetchQueue=this._tileStrategy=this._tileInfoView=
this._popupHighlightHelper=null}async fetchPopupFeaturesAtLocation(I,V){return this._popupHighlightHelper?this._popupHighlightHelper.fetchPopupFeaturesAtLocation(I,V):[]}highlight(I){return this._popupHighlightHelper?this._popupHighlightHelper.highlight(I):p.makeHandle()}viewChange(){this.requestUpdate()}moveEnd(){this.requestUpdate()}supportsSpatialReference(I){return x.equals(this.layer.tileInfo?.spatialReference,I)}async doRefresh(){this.attached&&(this.suspended?(this._tileStrategy.clear(),this.requestUpdate()):
(this._fetchQueue.reset(),this._tileStrategy.refresh(I=>this._updatingHandles.addPromise(this._enqueueTileFetch(I)))))}acquireTile(I){I=this._bitmapView.createTile(I);const V=I.bitmap;[V.x,V.y]=this._tileInfoView.getTileCoords(Lb,I.key);V.resolution=this._tileInfoView.getTileResolution(I.key);[V.width,V.height]=this._tileInfoView.tileInfo.size;this._updatingHandles.addPromise(this._enqueueTileFetch(I));this._bitmapView.addChild(I);this.requestUpdate();return I}releaseTile(I){this._fetchQueue.abort(I.key.id);
this._bitmapView.removeChild(I);I.once("detach",()=>I.destroy());this.requestUpdate()}async fetchTile(I,V={}){var ma=this.tilemapCache;const {signal:sa,resamplingLevel:Ca=0}=V;if(!ma)try{return await this._fetchImage(I,sa)}catch(Ia){if(!g.isAbortError(Ia)&&!this.resampling)return Ha.createBlankImage(this._tileInfoView.tileInfo.size);if(3>Ca&&(ma=this._tileInfoView.getTileParentId(I.id)))return ma=new zb(ma),V=await this.fetchTile(ma,{...V,resamplingLevel:Ca+1}),Ha.resampleImage(this._tileInfoView,
V,ma,I);throw Ia;}V=new zb(0,0,0,0);let wb;try{await ma.fetchAvailabilityUpsample(I.level,I.row,I.col,V,{signal:sa});if(!this.resampling&&V.level!==I.level)return Ha.createBlankImage(this._tileInfoView.tileInfo.size);wb=await this._fetchImage(V,sa)}catch(Ia){if(g.isAbortError(Ia))throw Ia;return Ha.createBlankImage(this._tileInfoView.tileInfo.size)}return this.resampling?Ha.resampleImage(this._tileInfoView,wb,V,I):wb}async _enqueueTileFetch(I){if(!this._fetchQueue.has(I.key.id)){try{const V=await this._fetchQueue.push(I.key);
I.bitmap.source=V;I.bitmap.width=this._tileInfoView.tileInfo.size[0];I.bitmap.height=this._tileInfoView.tileInfo.size[1];I.once("attach",()=>this.requestUpdate())}catch(V){g.isAbortError(V)||l.getLogger(this).error(V)}this.requestUpdate()}}async _fetchImage(I,V){return this.layer.fetchImageBitmapTile(I.level,I.row,I.col,{signal:V})}};c.__decorate([k.property()],Ra.prototype,"resampling",null);c.__decorate([k.property()],Ra.prototype,"tilemapCache",null);return Ra=c.__decorate([m.subclass("esri.views.2d.layers.TileLayerView2D")],
Ra)});