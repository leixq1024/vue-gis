// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.31/esri/copyright.txt for details.
//>>built
define("exports ../../../../../../../symbols/cim/CIMSymbolHelper ../../../../../../../symbols/cim/defaultCIMValues ../../../../../../../symbols/cim/enums ../../../../../engine/webgl/shaderGraph/techniques/TechniqueRegistry ../VisualVariablesSchema ./utils".split(" "),function(n,I,J,K,r,v,L){function z(b){return b.minScale||b.maxScale?{minScale:b.minScale??0,maxScale:b.maxScale??0}:null}function m(b){if(null==b)return null;if(Array.isArray(b)){const [a,e,k,l]=b;return[a,e,k,255*l]}return"string"===
typeof b?b:{...b,defaultValue:m(b?.defaultValue)}}function A(b,a,e,k){return a.animationParams?[b.createMeshInfo({pixelDimensions:a.pixelDimensions,texelDimensions:a.texelDimensions,effects:a.effects?{type:"cim-effect-infos",effectInfos:a.effects}:null,sprite:a.spriteRasterizationParam,animations:a.animationParams,scaleInfo:k.scaleInfo,scaleSymbolsProportionally:a.scaleSymbolsProportionally,strokeWidth:a.outlineWidth,isMapAligned:a.alignment===K.Alignment.MAP,colorLocked:a.colorLocked,isStroke:a.isStroke,
baseSize:a.baseSize,referenceSize:a.referenceSize,angleToLine:a.markerPlacement?a.markerPlacement.placement&&"angleToLine"in a.markerPlacement.placement&&a.markerPlacement.placement.angleToLine:!1,sizeRatio:a.sizeRatio})]:[]}function B(b,a,e,{scaleInfo:k,scaleExpression:l}){const g=L.hasSizeVVUniform(e);return[b.createMeshInfo({size:a.size,scaleX:a.scaleX,anchorX:a.anchorPoint.x,anchorY:a.anchorPoint.y,angle:a.rotation,color:m(a.color)??[0,0,0,0],colorLocked:a.colorLocked,frameHeight:a.frameHeight,
widthRatio:a.widthRatio,scaleInfo:k,offsetX:a.offsetX,offsetY:a.offsetY,outlineColor:m(a.outlineColor)??[0,0,0,0],outlineSize:a.outlineWidth,referenceSize:a.referenceSize||J.defaultCIMValues.CIMVectorMarker.size,rotateClockwise:a.rotateClockwise,scaleFactor:l??1,sizeRatio:a.sizeRatio,alignment:a.alignment,isAbsoluteAnchorPoint:a.isAbsoluteAnchorPoint,scaleSymbolsProportionally:a.scaleSymbolsProportionally,sprite:a.spriteRasterizationParam,hasSizeVV:g,placement:a.markerPlacement,effects:a.effects?
{type:"cim-effect-infos",effectInfos:a.effects}:null,transforms:a.transform,minPixelBuffer:v.getMaxSizeVVSize(e)})]}function C(b,a,{scaleInfo:e}){return[b.createMeshInfo({color:m(a.color)??[0,0,0,0],scaleInfo:e,effects:a.effects?{type:"cim-effect-infos",effectInfos:a.effects}:null})]}function D(b,a,e,{scaleInfo:k}){if(!a.spriteRasterizationParam)throw Error("InternalError: Sprite should always be defined");e=!!a.hasUnresolvedReplacementColor&&(!e||a.colorLocked);e=a.sampleAlphaOnly&&!e;const l=a.spriteRasterizationParam;
return[b.createMeshInfo({color:m(a.color)??[0,0,0,0],height:a.height,aspectRatio:a.scaleX,offsetX:a.offsetX,offsetY:a.offsetY,scaleX:1,scaleY:1,angle:a.angle,applyRandomOffset:a.applyRandomOffset,sampleAlphaOnly:e,scaleProportionally:"CIMHatchFill"===l.resource.type,sprite:l,scaleInfo:k,effects:a.effects?{type:"cim-effect-infos",effectInfos:a.effects}:null})]}function E(b,a,{scaleInfo:e}){return{color:m(b.color)??[0,0,0,0],width:b.width,referenceWidth:b.referenceWidth,capType:b.cap,joinType:b.join,
miterLimit:b.miterLimit,scaleInfo:e,hasSizeVV:a,effects:b.effects?{type:"cim-effect-infos",effectInfos:b.effects}:null}}function F(b,a,e,k){if(a.spriteRasterizationParam)throw Error("InternalError: Sprite should not be defined");a=E(a,e,k);return[b.createMeshInfo(a)]}function G(b,a,e,k){const {spriteRasterizationParam:l,scaleDash:g,sampleAlphaOnly:t}=a;if(!l)throw Error("InternalError: Sprite should be defined");return[b.createMeshInfo({...E(a,e,k),offsetAlongLine:a.offsetAlongLine??0,shouldScaleDash:g??
!1,shouldSampleAlphaOnly:t,isSDF:"CIMPictureStroke"!==l.resource.type,sprite:l})]}function H(b,a,e,{scaleInfo:k,scaleExpression:l}){return[b.createMeshInfo({boxBackgroundColor:m(a.backgroundColor),boxBorderLineColor:m(a.borderLineColor),boxBorderLineSize:a.borderLineWidth??0,color:m(a.color)??[0,0,0,0],offsetX:a.offsetX,offsetY:a.offsetY,postAngle:a.angle,fontSize:a.size,referenceSize:a.referenceSize,decoration:a.decoration,haloColor:m(a.haloColor)??[0,0,0,0],haloSize:a.haloSize??0,outlineColor:m(a.outlineColor)??
[0,0,0,0],outlineSize:a.outlineSize,lineWidth:a.lineWidth||512,lineHeightRatio:1,horizontalAlignment:a.horizontalAlignment??"center",verticalAlignment:a.verticalAlignment??"baseline",useCIMAngleBehavior:!1,glyphs:a.textRasterizationParam,scaleInfo:k,effects:a.effects?{type:"cim-effect-infos",effectInfos:a.effects}:null,placement:a.markerPlacement,transforms:a.transform,scaleFactor:l??1,minPixelBuffer:v.getMaxSizeVVSize(e),repeatLabel:null,repeatLabelDistance:null,allowOverrun:null,labelPosition:null})]}
n.createAnimatedMarkerMeshInfos=A;n.createComplexFillMeshInfos=D;n.createComplexMarkerMeshInfos=B;n.createComplexSimpleFillMeshInfos=C;n.createComplexSimpleLineMeshInfos=F;n.createComplexSymbolInstances=async function(b,a){const {cimResourceManager:e,cimAnalyzer:k,scaleExpression:l}=a.schemaOptions;await Promise.all(I.CIMSymbolHelper.fetchResources(b.symbol,e,[]));var g=k.analyzeSymbolReference(b,!1);b={scaleInfo:z(b),scaleExpression:l};const t=[];for(const w of g)switch(w.type){case "marker":g=t;
var u=g.push;{var d=w;var h=b;const {uniforms:f,schemaOptions:x}=a;var {store:c}=x,p=d.isOutline?{...v.noVisualVariables,visualVariableSizeScaleStops:f.visualVariableSizeOutlineScaleStops}:{visualVariableColor:f.visualVariableColor,visualVariableOpacity:f.visualVariableOpacity,visualVariableSizeMinMaxValue:f.visualVariableSizeMinMaxValue,visualVariableSizeScaleStops:f.visualVariableSizeScaleStops,visualVariableSizeStops:f.visualVariableSizeStops,visualVariableSizeUnitValue:f.visualVariableSizeUnitValue,
visualVariableRotation:f.visualVariableRotation};d.animationParams?(c=c.ensureInstance(r.Techniques.animatedMarker,{uniforms:p,optionalAttributes:{zoomRange:!0}}),d=A(c,d,v.noVisualVariables,h)):(c=c.ensureInstance(r.Techniques.marker,{uniforms:p,optionalAttributes:{zoomRange:!!h.scaleInfo}}),d=B(c,d,f,h))}u.call(g,...d);break;case "fill":g=t;u=g.push;a:{h=w;c=a;d=b;if(!h.spriteRasterizationParam){const {uniforms:y,schemaOptions:M}=c;({store:c}=M);c=c.ensureInstance(r.Techniques.fill,{uniforms:{visualVariableColor:h.colorLocked?
null:y.visualVariableColor,visualVariableOpacity:y.visualVariableOpacity},optionalAttributes:{zoomRange:!!d.scaleInfo}});d=C(c,h,d);break a}const {uniforms:f,schemaOptions:x}=c;({store:c}=x);c=c.ensureInstance(r.Techniques.complexFill,{uniforms:{visualVariableColor:h.colorLocked?null:f.visualVariableColor,visualVariableOpacity:f.visualVariableOpacity},optionalAttributes:{zoomRange:!!d.scaleInfo}});d=D(c,h,null!=f.visualVariableColor,d)}u.call(g,...d);break;case "line":g=t;u=g.push;{d=w;h=b;const {uniforms:f,
schemaOptions:x}=a;({store:p}=x);c=d.isOutline?{...v.noVisualVariables,visualVariableSizeScaleStops:f.visualVariableSizeOutlineScaleStops}:{visualVariableColor:d.colorLocked?null:f.visualVariableColor,visualVariableOpacity:f.visualVariableOpacity,visualVariableSizeMinMaxValue:f.visualVariableSizeMinMaxValue,visualVariableSizeScaleStops:f.visualVariableSizeScaleStops,visualVariableSizeStops:f.visualVariableSizeStops,visualVariableSizeUnitValue:f.visualVariableSizeUnitValue};const y={uniforms:c,optionalAttributes:{zoomRange:!!h.scaleInfo}};
c=!!(c.visualVariableSizeMinMaxValue||c.visualVariableSizeScaleStops||c.visualVariableSizeStops||c.visualVariableSizeUnitValue);d.spriteRasterizationParam?(p=p.ensureInstance(r.Techniques.texturedLine,y),d=G(p,d,c,h)):(p=p.ensureInstance(r.Techniques.line,y),d=F(p,d,c,h))}u.call(g,...d);break;case "text":g=t;u=g.push;d=w;h=b;const {uniforms:q,schemaOptions:N}=a;({store:c}=N);c=c.ensureInstance(r.Techniques.text,{uniforms:{visualVariableColor:d.colorLocked?null:q.visualVariableColor,visualVariableOpacity:q.visualVariableOpacity,
visualVariableRotation:q.visualVariableRotation,visualVariableSizeMinMaxValue:q.visualVariableSizeMinMaxValue,visualVariableSizeScaleStops:q.visualVariableSizeScaleStops,visualVariableSizeStops:q.visualVariableSizeStops,visualVariableSizeUnitValue:q.visualVariableSizeUnitValue},optionalAttributes:{zoomRange:!!h.scaleInfo,referenceSymbol:!1,clipAngle:!1}});d=H(c,d,q,h);u.call(g,...d)}return t};n.createComplexTextMeshInfos=H;n.createComplexTexturedLineMeshInfos=G;n.getScaleInfo=z;Object.defineProperty(n,
Symbol.toStringTag,{value:"Module"})});