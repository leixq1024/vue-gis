// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.31/esri/copyright.txt for details.
//>>built
require({cache:{"esri/core/screenUtils":function(){define(["exports"],function(b){function q(k){return k?72*k/96:0}function n(k=0,l=0){return{x:k,y:l}}const g=/^-?(\d+(\.\d+)?)\s*((px)|(pt))?$/i;b.castRenderScreenPointArray=function(k){return k};b.castRenderScreenPointArray3=function(k){return k};b.castScreenPointArray=function(k){return k};b.cloneScreenPoint=function(k){return k?n(k.x,k.y):null};b.createRenderScreenPoint=function(k=0,l=0){return{x:k,y:l}};b.createRenderScreenPointArray=function(k=
0,l=0){return[k,l]};b.createRenderScreenPointArray3=function(k=0,l=0,a=0){return[k,l,a]};b.createScreenPoint=n;b.createScreenPointArray=function(k=0,l=0){return[k,l]};b.pt2px=function(k){return k?k/72*96:0};b.px2pt=q;b.screenPointArrayToObject=function(k,l){return l?(l.x=k[0],l.y=k[1],l):{x:k[0],y:k[1]}};b.screenPointObjectToArray=function(k,l){return l?(l[0]=k.x,l[1]=k.y,2<l.length&&(l[2]=0),l):[k.x,k.y]};b.toPt=function(k){if("string"===typeof k){var l=k.match(g);if(l){var a=Number(l[1]);l=l[3]&&
l[3].toLowerCase();k="-"===k.charAt(0);a="px"===l?q(a):a;return k?-a:a}console.warn("screenUtils.toPt: input not recognized!");return null}return k};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/TileInfo":function(){define("../../chunks/tslib.es6 ../../core/jsonMap ../../core/JSONSupport ../../core/unitUtils ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/RandomLCG ../../core/has ../../core/accessorSupport/decorators/reader ../../core/accessorSupport/decorators/subclass ../../core/accessorSupport/decorators/writer ../../geometry/Point ../../geometry/SpatialReference ../../geometry/support/aaBoundingRect ../../geometry/support/spatialReferenceUtils ../../geometry/support/webMercatorUtils ./LOD ./TileKey".split(" "),
function(b,q,n,g,k,l,a,f,d,c,e,h,x,m,p,t,w,r){var y;q=new q.JSONMap({PNG:"png",PNG8:"png8",PNG24:"png24",PNG32:"png32",JPEG:"jpg",JPG:"jpg",DIB:"dib",TIFF:"tiff",EMF:"emf",PS:"ps",PDF:"pdf",GIF:"gif",SVG:"svg",SVGZ:"svgz",Mixed:"mixed",MIXED:"mixed",LERC:"lerc",LERC2D:"lerc2d",RAW:"raw",pbf:"pbf"});n=y=class extends n.JSONSupport{static create(z={}){const {resolutionFactor:u=1,scales:v,size:A=256,spatialReference:B=x.WebMercator,numLODs:F=24}=z;if(!p.isValid(B)){z=[];if(v)for(var H=0;H<v.length;H++){var J=
v[H];z.push(new w({level:H,scale:J,resolution:J}))}else for(H=5E-4,J=F-1;0<=J;J--)z.unshift(new w({level:J,scale:H,resolution:H})),H*=2;return new y({dpi:96,lods:z,origin:new h(0,0,B),size:[A,A],spatialReference:B})}H=p.getInfo(B);z=z.origin?new h({x:z.origin.x,y:z.origin.y,spatialReference:B}):H?new h({x:H.origin[0],y:H.origin[1],spatialReference:B}):new h({x:0,y:0,spatialReference:B});H=1/(39.37*g.getMetersPerUnitForSR(B)*96);J=[];if(v)for(var E=0;E<v.length;E++){var K=v[E];J.push(new w({level:E,
scale:K,resolution:K*H}))}else{var C=p.isGeographic(B)?512/A*5.916575275917094E8:256/A*5.91657527591555E8;E=Math.ceil(F/u);J.push(new w({level:0,scale:C,resolution:C*H}));for(K=1;K<E;K++)C/=2**u,J.push(new w({level:K,scale:C,resolution:C*H}))}return new y({dpi:96,lods:J,origin:z,size:[A,A],spatialReference:B})}constructor(z){super(z);this.dpi=96;this.spatialReference=this.size=this.origin=this.format=null}get isWrappable(){const {spatialReference:z,origin:u}=this;if(z&&u){const v=p.getInfo(z);return z.isWrappable&&
!!v&&Math.abs(v.origin[0]-u.x)<=v.dx}return!1}readOrigin(z,u){return h.fromJSON({spatialReference:u.spatialReference,...z})}set lods(z){const u=[],v=this._levelToLOD={};z&&z.forEach(A=>{u.push(A.scale);v[A.level]=A});this._set("scales",u);this._set("lods",z);this._initializeUpsampleLevels()}readSize(z,u){return[u.cols,u.rows]}writeSize(z,u){u.cols=z[0];u.rows=z[1]}zoomToScale(z){const u=this.scales;if(0>=z)return u[0];if(z>=u.length-1)return u[u.length-1];const v=Math.floor(z);return u[v]/(u[v]/u[v+
1])**(z-v)}scaleToZoom(z){const u=this.scales,v=u.length-1;let A=0;for(;A<v;A++){const B=u[A],F=u[A+1];if(B<=z)break;if(F===z)return A+1;if(B>z&&F<z)return A+Math.log(B/z)/Math.log(B/F)}return A}tileAt(z,u,v,A){var B=this.lodAt(z);if(!B)return null;let F;if("number"===typeof u)F=u,u=v;else{if(p.equals(u.spatialReference,this.spatialReference))F=u.x,u=u.y;else{A=t.project(u,this.spatialReference);if(null==A)return null;F=A.x;u=A.y}A=v}v=B.resolution*this.size[0];B=B.resolution*this.size[1];A||=new r.TileKey(null,
0,0,0,m.create());A.level=z;A.row=Math.floor((this.origin.y-u)/B+.001);A.col=Math.floor((F-this.origin.x)/v+.001);this.updateTileInfo(A);return A}updateTileInfo(z,u=y.ExtrapolateOptions.NONE){var v=this.lodAt(z.level);v||u!==y.ExtrapolateOptions.POWER_OF_TWO||(u=this.lods[this.lods.length-1],u.level<z.level&&(v=u));if(v){var A=z.level-v.level;u=v.resolution*this.size[0]/2**A;v=v.resolution*this.size[1]/2**A;z.id=`${z.level}/${z.row}/${z.col}`;z.extent||(z.extent=m.create());z.extent[0]=this.origin.x+
z.col*u;z.extent[1]=this.origin.y-(z.row+1)*v;z.extent[2]=z.extent[0]+u;z.extent[3]=z.extent[1]+v}}upsampleTile(z){const u=this._upsampleLevels[z.level];if(!u||-1===u.parentLevel)return!1;z.level=u.parentLevel;z.row=Math.floor(z.row/u.factor+.001);z.col=Math.floor(z.col/u.factor+.001);this.updateTileInfo(z);return!0}getTileBounds(z,u){var v=this.lodAt(u.level);if(null==v)return null;var {resolution:A}=v;v=A*this.size[0];A*=this.size[1];z[0]=this.origin.x+u.col*v;z[1]=this.origin.y-(u.row+1)*A;z[2]=
z[0]+v;z[3]=z[1]+A;return z}lodAt(z){return this._levelToLOD?.[z]??null}clone(){return y.fromJSON(this.write({}))}getCompatibleForVTL(z){if(this.size[0]!==this.size[1]||256===this.size[0]&&512===z)return null;const u=(512===this.size[0]&&256===z?-1:0)+(this.spatialReference.isGeographic?1:0);if(this.size[0]===z&&0===u)return this;const v=[],A=this.lods.length-u;for(let B=0;B<A;B++){const F=B+u,{scale:H,resolution:J}=0<=F?this.lods[F]:{scale:2*this.lods[0].scale,resolution:2*this.lods[0].resolution};
v.push(new w({level:B,scale:H,resolution:J}))}return new y({size:[z,z],dpi:this.dpi,format:this.format,compressionQuality:this.compressionQuality,origin:this.origin,spatialReference:this.spatialReference,lods:v})}_initializeUpsampleLevels(){const z=this.lods;this._upsampleLevels=[];let u=null;for(let v=0;v<z.length;v++){const A=z[v];this._upsampleLevels[A.level]={parentLevel:u?u.level:-1,factor:u?u.resolution/A.resolution:0};u=A}}};b.__decorate([k.property({type:Number,json:{write:!0}})],n.prototype,
"compressionQuality",void 0);b.__decorate([k.property({type:Number,json:{write:!0}})],n.prototype,"dpi",void 0);b.__decorate([k.property({type:String,json:{read:q.read,write:q.write,origins:{"web-scene":{read:!1,write:!1}}}})],n.prototype,"format",void 0);b.__decorate([k.property({readOnly:!0})],n.prototype,"isWrappable",null);b.__decorate([k.property({type:h,json:{write:!0}})],n.prototype,"origin",void 0);b.__decorate([d.reader("origin")],n.prototype,"readOrigin",null);b.__decorate([k.property({type:[w],
value:null,json:{write:!0}})],n.prototype,"lods",null);b.__decorate([k.property({readOnly:!0})],n.prototype,"scales",void 0);b.__decorate([k.property({cast:z=>Array.isArray(z)?z:"number"===typeof z?[z,z]:[256,256]})],n.prototype,"size",void 0);b.__decorate([d.reader("size",["rows","cols"])],n.prototype,"readSize",null);b.__decorate([e.writer("size",{cols:{type:l.Integer},rows:{type:l.Integer}})],n.prototype,"writeSize",null);b.__decorate([k.property({type:x,json:{write:!0}})],n.prototype,"spatialReference",
void 0);n=y=b.__decorate([c.subclass("esri.layers.support.TileInfo")],n);(function(z){z=z.ExtrapolateOptions||(z.ExtrapolateOptions={});z[z.NONE=0]="NONE";z[z.POWER_OF_TWO=1]="POWER_OF_TWO"})(n||={});return n})},"esri/layers/support/LOD":function(){define("../../chunks/tslib.es6 ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/RandomLCG ../../core/has ../../core/accessorSupport/decorators/subclass".split(" "),function(b,q,n,g,k,
l,a){var f;q=f=class extends q.JSONSupport{constructor(d){super(d);this.cols=null;this.level=0;this.origin=this.levelValue=null;this.resolution=0;this.rows=null;this.scale=0}clone(){return new f({cols:this.cols,level:this.level,levelValue:this.levelValue,resolution:this.resolution,rows:this.rows,scale:this.scale})}};b.__decorate([n.property({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],q.prototype,"cols",void 0);b.__decorate([n.property({type:g.Integer,
json:{write:!0}})],q.prototype,"level",void 0);b.__decorate([n.property({type:String,json:{write:!0}})],q.prototype,"levelValue",void 0);b.__decorate([n.property({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],q.prototype,"origin",void 0);b.__decorate([n.property({type:Number,json:{write:!0}})],q.prototype,"resolution",void 0);b.__decorate([n.property({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],q.prototype,
"rows",void 0);b.__decorate([n.property({type:Number,json:{write:!0}})],q.prototype,"scale",void 0);return q=f=b.__decorate([a.subclass("esri.layers.support.LOD")],q)})},"esri/layers/support/TileKey":function(){define(["exports"],function(b){class q{constructor(n,g,k,l,a){this.id=n;this.level=g;this.row=k;this.col=l;this.extent=a}}b.TileKey=q;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/tiling/TileInfoView":function(){define(["../../../geometry/support/spatialReferenceUtils",
"./LODInfo","./TileCoverage","./TileKey","./TileSpan"],function(b,q,n,g,k){const l=new g("0/0/0/0");class a{static create(c,e){c[1]>e[1]&&([c,e]=[e,c]);const [h,x]=c,[m,p]=e;c=m-h;e=p-x;e=0!==e?c/e:0;const t=(Math.ceil(x)-x)*e,w=(Math.floor(x)-x)*e;return new a(h,Math.floor(x),Math.ceil(p),e,0>c?t:w,0>c?w:t,0>c?m:h,0>c?h:m)}constructor(c,e,h,x,m,p,t,w){this.x=c;this.ymin=e;this.ymax=h;this.invM=x;this.leftAdjust=m;this.rightAdjust=p;this.leftBound=t;this.rightBound=w}incrRow(){this.x+=this.invM}getLeftCol(){return Math.max(this.x+
this.leftAdjust,this.leftBound)}getRightCol(){return Math.min(this.x+this.rightAdjust,this.rightBound)}}const f=[[0,0],[0,0],[0,0],[0,0]];class d{constructor(c,e=null,h=c.lods[0].level,x=c.lods[c.lods.length-1].level){this.tileInfo=c;this.fullExtent=e;this.scales=[];this._infoByScale={};this._infoByLevel={};const m=c.lods.filter(t=>t.level>=h&&t.level<=x);this.minScale=m[0].scale;this.maxScale=m[m.length-1].scale;const p=this._lodInfos=m.map(t=>q.create(c,t,e));m.forEach((t,w)=>{this._infoByLevel[t.level]=
p[w];this._infoByScale[t.scale]=p[w];this.scales[w]=t.scale},this);this._wrap=c.isWrappable}get spatialReference(){return this.tileInfo.spatialReference}getLODInfoAt(c){return this._infoByLevel["number"===typeof c?c:c.level]}getTileBounds(c,e,h=!1){l.set(e);return(e=this._infoByLevel[l.level])?e.getTileBounds(c,l,h):c}getTileCoords(c,e,h=!1){l.set(e);return(e=this._infoByLevel[l.level])?e.getTileCoords(c,l,h):c}getTileCoverage(c,e=192,h=!0,x="closest"){if(!h&&(c.scale>this.minScale||c.scale<this.maxScale))return null;
h="closest"===x?this.getClosestInfoForScale(c.scale):this.getSmallestInfoForScale(c.scale);x=n.pool.acquire(h);const m=this._wrap;var p=Infinity;let t=-Infinity;const w=x.spans;f[0][0]=f[0][1]=f[1][1]=f[3][0]=-e;f[1][0]=f[2][0]=c.size[0]+e;f[2][1]=f[3][1]=c.size[1]+e;for(r of f)c.toMap(r,r),r[0]=h.getColumnForX(r[0]),r[1]=h.getRowForY(r[1]);c=[];var r=3;for(e=0;4>e;e++)f[e][1]===f[r][1]?r=e:(r=a.create(f[e],f[r]),p=Math.min(r.ymin,p),t=Math.max(r.ymax,t),void 0===c[r.ymin]&&(c[r.ymin]=[]),c[r.ymin].push(r),
r=e);if(null==p||null==t||100<t-p)return null;for(e=[];p<t;){null!=c[p]&&(e=e.concat(c[p]));r=Infinity;var y=-Infinity;for(var z=e.length-1;0<=z;z--){var u=e[z];r=Math.min(r,u.getLeftCol());y=Math.max(y,u.getRightCol())}r=Math.floor(r);y=Math.floor(y);if(p>=h.first[1]&&p<=h.last[1])if(m)if(h.size[0]<h.worldSize[0])for(z=Math.floor(y/h.worldSize[0]),u=Math.floor(r/h.worldSize[0]);u<=z;u++)w.push(new k(p,Math.max(h.getFirstColumnForWorld(u),r),Math.min(h.getLastColumnForWorld(u),y)));else w.push(new k(p,
r,y));else r>h.last[0]||y<h.first[0]||(r=Math.max(r,h.first[0]),y=Math.min(y,h.last[0]),w.push(new k(p,r,y)));p+=1;for(r=e.length-1;0<=r;r--)y=e[r],y.ymax>=p?y.incrRow():e.splice(r,1)}return x}getTileParentId(c){l.set(c);c=this._lodInfos.indexOf(this._infoByLevel[l.level])-1;if(0>c)return null;this._getTileIdAtLOD(l,this._lodInfos[c],l);return l.id}getTileResolution(c){return(c=this._infoByLevel["object"===typeof c?c.level:c])?c.resolution:-1}getTileScale(c){return(c=this._infoByLevel[c.level])?c.scale:
-1}intersects(c,e){l.set(e);e=this._infoByLevel[l.level];const h=c.lodInfo;if(h.resolution>e.resolution){this._getTileIdAtLOD(l,h,l);var x=h.denormalizeCol(l.col,l.world);for(var m of c.spans)if(m.row===l.row&&m.colFrom<=x&&m.colTo>=x)return!0}if(h.resolution<e.resolution){const [t,w,r,y]=c.spans.reduce((z,u)=>{z[0]=Math.min(z[0],u.row);z[1]=Math.max(z[1],u.row);z[2]=Math.min(z[2],u.colFrom);z[3]=Math.max(z[3],u.colTo);return z},[Infinity,-Infinity,Infinity,-Infinity]);x=e.denormalizeCol(l.col,l.world);
c=h.getColumnForX(e.getXForColumn(x));m=h.getRowForY(e.getYForRow(l.row));x=h.getColumnForX(e.getXForColumn(x+1))-1;e=h.getRowForY(e.getYForRow(l.row+1))-1;return!(c>y||x<r||m>w||e<t)}const p=h.denormalizeCol(l.col,l.world);return c.spans.some(t=>t.row===l.row&&t.colFrom<=p&&t.colTo>=p)}normalizeBounds(c,e,h){c[0]=e[0];c[1]=e[1];c[2]=e[2];c[3]=e[3];this._wrap&&(e=b.getInfo(this.tileInfo.spatialReference),h=-h*(e.valid[1]-e.valid[0]),c[0]+=h,c[2]+=h);return c}getSmallestInfoForScale(c){const e=this.scales;
if(this._infoByScale[c])return this._infoByScale[c];if(c>e[0])return this._infoByScale[e[0]];for(let h=1;h<e.length-1;h++)if(c>e[h]+1E-6)return this._infoByScale[e[h-1]];return this._infoByScale[e[e.length-1]]}getClosestInfoForScale(c){const e=this.scales;if(this._infoByScale[c])return this._infoByScale[c];c=e.reduce((h,x)=>Math.abs(x-c)<Math.abs(h-c)?x:h,e[0]);return this._infoByScale[c]}scaleToLevel(c){const e=this.scales;if(this._infoByScale[c])return this._infoByScale[c].level;for(let h=e.length-
1;0<=h;h--)if(c<e[h])return h===e.length-1?this._infoByScale[e[e.length-1]].level:this._infoByScale[e[h]].level+(e[h]-c)/(e[h]-e[h+1]);return this._infoByScale[e[0]].level}scaleToZoom(c){return this.tileInfo.scaleToZoom(c)}zoomToScale(c){return this.tileInfo.zoomToScale(c)}_getTileIdAtLOD(c,e,h){const x=this._infoByLevel[h.level];c.set(h);if(e.resolution<x.resolution)return null;if(e.resolution===x.resolution)return c;c.level=e.level;c.col=Math.floor(h.col*x.resolution/e.resolution+.01);c.row=Math.floor(h.row*
x.resolution/e.resolution+.01);return c}}return d})},"esri/views/2d/tiling/LODInfo":function(){define(["../../../geometry/support/spatialReferenceUtils","./TileKey"],function(b,q){function n(l,a,f){l[0]=a;l[1]=f;return l}const g=new q("0/0/0/0");class k{static create(l,a,f=null){const d=b.getInfo(l.spatialReference),c=a.origin||[l.origin.x,l.origin.y],e=[l.size[0]*a.resolution,l.size[1]*a.resolution],h=[-Infinity,-Infinity],x=[Infinity,Infinity],m=[Infinity,Infinity];null!=f&&(n(h,Math.max(0,Math.floor((f.xmin-
c[0])/e[0])),Math.max(0,Math.floor((c[1]-f.ymax)/e[1]))),n(x,Math.max(0,Math.floor((f.xmax-c[0])/e[0])),Math.max(0,Math.floor((c[1]-f.ymin)/e[1]))),n(m,x[0]-h[0]+1,x[1]-h[1]+1));const {cols:p,rows:t}=a;!f&&p&&t&&(n(h,p[0],t[0]),n(x,p[1],t[1]),n(m,p[1]-p[0]+1,t[1]-t[0]+1));let w,r;l.isWrappable?(l=[Math.ceil(Math.round((d.valid[1]-d.valid[0])/a.resolution)/l.size[0]),m[1]],f=!0,w=d.origin,r=d.valid):(l=m,f=!1);return new k(a.level,a.resolution,a.scale,c,h,x,m,e,l,f,w,r)}constructor(l,a,f,d,c,e,h,x,
m,p,t,w){this.level=l;this.resolution=a;this.scale=f;this.origin=d;this.first=c;this.last=e;this.size=h;this.norm=x;this.worldSize=m;this.wrap=p;this._spatialReferenceOrigin=t;this._spatialReferenceValid=w}normalizeCol(l){if(!this.wrap)return l;const a=this.worldSize[0];return 0>l?a-1-Math.abs((l+1)%a):l%a}normalizeKey(l){if(this.wrap){var a=this.worldSize[0],f=l.col;0>f?(l.col=f+a,--l.world):f>=a&&(l.col=f-a,l.world+=1)}}denormalizeCol(l,a){return this.wrap?this.worldSize[0]*a+l:l}getWorldForColumn(l){return this.wrap?
Math.floor(l/this.worldSize[0]):0}getFirstColumnForWorld(l){return l*this.worldSize[0]+this.first[0]}getLastColumnForWorld(l){return l*this.worldSize[0]+this.first[0]+this.size[0]-1}getColumnForX(l){return(l-this.origin[0])/this.norm[0]}getXForColumn(l){const a=this.origin[0]+l*this.norm[0],f=this._spatialReferenceOrigin,d=this._spatialReferenceValid;return this.wrap&&f&&d?a===f[0]?d[0]:this.origin[0]===f[0]&&l===this.worldSize[0]?d[1]:a:a}getRowForY(l){return(this.origin[1]-l)/this.norm[1]}getYForRow(l){return this.origin[1]-
l*this.norm[1]}getTileBounds(l,a,f=!1){g.set(a);var d=f?g.col:this.denormalizeCol(g.col,g.world),c=g.row;a=this.getXForColumn(d);f=this.getYForRow(c+1);d=this.getXForColumn(d+1);c=this.getYForRow(c);l[0]=a;l[1]=f;l[2]=d;l[3]=c;return l}getTileCoords(l,a,f=!1){g.set(a);a=f?g.col:this.denormalizeCol(g.col,g.world);Array.isArray(l)?n(l,this.getXForColumn(a),this.getYForRow(g.row)):(l.x=this.getXForColumn(a),l.y=this.getYForRow(g.row));return l}}return k})},"esri/views/2d/tiling/TileKey":function(){define(["../../../core/ObjectPool"],
function(b){class q{static getId(n,g,k,l){return"object"===typeof n?`${n.level}/${n.row}/${n.col}/${n.world}`:`${n}/${g}/${k}/${l}`}constructor(n,g,k,l){this.set(n,g,k,l)}get key(){return this}get id(){return this.toString()}get normalizedId(){return`${this.level}/${this.row}/${this.col}`}set id(n){this.set(n)}get hash(){return(this.world&3)<<30|(this.col&4095)<<22|(this.row&4095)<<8|this.level&63}acquire(n,g,k,l){this.set(n,g,k,l)}contains(n){const g=n.level-this.level;return 0<=g&&this.row===n.row>>
g&&this.col===n.col>>g&&this.world===n.world}containsChild(n){const g=n.level-this.level;return 0<g&&this.row===n.row>>g&&this.col===n.col>>g&&this.world===n.world}equals(n){return this.level===n.level&&this.row===n.row&&this.col===n.col&&this.world===n.world}clone(){return new q(this)}release(){this.world=this.col=this.row=this.level=0}set(n,g,k,l){if(null==n)this.world=this.col=this.row=this.level=0;else if("object"===typeof n)this.level=n.level||0,this.row=n.row||0,this.col=n.col||0,this.world=
n.world||0;else if("string"===typeof n){const [a,f,d,c]=n.split("/");this.level=parseFloat(a);this.row=parseFloat(f);this.col=parseFloat(d);this.world=parseFloat(c)}else this.level=+n,this.row=+g,this.col=+k,this.world=+l||0;return this}toString(){return`${this.level}/${this.row}/${this.col}/${this.world}`}getParentKey(){return 0>=this.level?null:new q(this.level-1,this.row>>1,this.col>>1,this.world)}getNormalizedNeighbor(n,g,k){const l=this.clone();l.col+=n;l.row+=g;k.normalizeKey(l);return l}getChildKeys(){const n=
this.level+1,g=this.row<<1,k=this.col<<1,l=this.world;return[new q(n,g,k,l),new q(n,g,k+1,l),new q(n,g+1,k,l),new q(n,g+1,k+1,l)]}compareRowMajor(n){return this.row<n.row?-1:this.row>n.row?1:this.col<n.col?-1:this.col>n.col?1:0}}q.pool=new b(q,null,null,25,50);return q})},"esri/views/2d/tiling/TileCoverage":function(){define(["../../../core/ObjectPool","./TileKey"],function(b,q){class n{constructor(){this.spans=[]}acquire(g){this.lodInfo=g}release(){this.lodInfo=null;this.spans.length=0}*keys(){const g=
this.lodInfo;for(const {row:k,colFrom:l,colTo:a}of this.spans)for(let f=l;f<=a;f++){const d=g.getWorldForColumn(f);yield new q(g.level,k,g.normalizeCol(f),d)}}forEach(g,k){const {spans:l,lodInfo:a}=this,{level:f}=a;if(0!==l.length)for(const {row:d,colFrom:c,colTo:e}of l)for(let h=c;h<=e;h++)g.call(k,f,d,a.normalizeCol(h),a.getWorldForColumn(h))}}n.pool=new b(n);return n})},"esri/views/2d/tiling/TileSpan":function(){define(function(){class b{constructor(q,n,g){this.row=q;this.colFrom=n;this.colTo=
g}}return b})},"esri/views/2d/tiling/TileQueue":function(){define("../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/MapUtils ../../../core/maybe ../../../core/SetUtils ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ../../../core/libs/gl-matrix-2/math/vec2 ../../support/QueueProcessor".split(" "),function(b,q,n,g,k,l,a,f,d,c,e,h){const x=[0,0];q=class extends q{constructor(m){super(m);
this._keyToItem=new Map;this._tilesByScale=new Map;this.concurrency=6}initialize(){const {concurrency:m,process:p,scheduler:t,priority:w}=this;this._queue=new h.QueueProcessor({concurrency:m,scheduler:t,priority:w,process:(r,y)=>{r=this._keyToItem.get(r);return p(r,{signal:y})},peeker:r=>this._peek(r)})}destroy(){this.clear();this._queue=g.destroyMaybe(this._queue)}get length(){return this._queue?this._queue.length:0}abort(m){this._queue.abort("string"===typeof m?m:m.id)}clear(){this._queue.clear();
this._keyToItem.clear();this._tilesByScale.clear()}has(m){return"string"===typeof m?this._keyToItem.has(m):this._keyToItem.has(m.id)}pause(){this._queue.pause()}push(m){const p=m.key.id;if(this._queue.has(p))return this._queue.get(p);const t=this._queue.push(p),w=this.tileInfoView.getTileScale(m.key),r=n.getOrCreateMapValue(this._tilesByScale,w,()=>new Set),y=()=>{r.delete(m.key);0===r.size&&this._tilesByScale.delete(w);this._keyToItem.delete(p)};r.add(m.key);this._keyToItem.set(p,m);t.then(y,y);
return t}reset(){this._queue.reset()}resume(){this._queue.resume()}_peek(m){if(!this.state)return m.values().next().value;const p=new Set;for(var t of m)p.add(this._keyToItem.get(t).key);t=this.state.scale;let w=Number.POSITIVE_INFINITY,r;for(const [y,z]of this._tilesByScale)if(k.someSet(z,u=>p.has(u))){const u=Math.abs(y-t);u<w&&(r=z,w=u)}return this._getClosestTileKey(r,m).id}_getClosestTileKey(m,p){const t=this.tileInfoView,w=this.state.center;let r=Number.POSITIVE_INFINITY,y;for(const z of m)p.has(z.id)&&
(t.getTileCoords(x,z),m=e.distance(x,w),m<r&&(r=m,y=z));return y}};b.__decorate([l.property({constructOnly:!0})],q.prototype,"concurrency",void 0);b.__decorate([l.property({constructOnly:!0})],q.prototype,"priority",void 0);b.__decorate([l.property({constructOnly:!0})],q.prototype,"process",void 0);b.__decorate([l.property({constructOnly:!0})],q.prototype,"scheduler",void 0);b.__decorate([l.property()],q.prototype,"state",void 0);b.__decorate([l.property({constructOnly:!0})],q.prototype,"tileInfoView",
void 0);return q=b.__decorate([c.subclass("esri.views.2d.tiling.TileQueue")],q)})},"esri/core/libs/gl-matrix-2/math/vec2":function(){define(["exports","./common"],function(b,q){function n(R,Z){R[0]=Z[0];R[1]=Z[1];return R}function g(R,Z,da){R[0]=Z;R[1]=da;return R}function k(R,Z,da){R[0]=Z[0]+da[0];R[1]=Z[1]+da[1];return R}function l(R,Z,da){R[0]=Z[0]-da[0];R[1]=Z[1]-da[1];return R}function a(R,Z,da){R[0]=Z[0]*da[0];R[1]=Z[1]*da[1];return R}function f(R,Z,da){R[0]=Z[0]/da[0];R[1]=Z[1]/da[1];return R}
function d(R,Z){R[0]=Math.ceil(Z[0]);R[1]=Math.ceil(Z[1]);return R}function c(R,Z){R[0]=Math.floor(Z[0]);R[1]=Math.floor(Z[1]);return R}function e(R,Z,da){R[0]=Math.min(Z[0],da[0]);R[1]=Math.min(Z[1],da[1]);return R}function h(R,Z,da){R[0]=Math.max(Z[0],da[0]);R[1]=Math.max(Z[1],da[1]);return R}function x(R,Z){R[0]=Math.round(Z[0]);R[1]=Math.round(Z[1]);return R}function m(R,Z,da){R[0]=Z[0]*da;R[1]=Z[1]*da;return R}function p(R,Z,da,ja){R[0]=Z[0]+da[0]*ja;R[1]=Z[1]+da[1]*ja;return R}function t(R,
Z){const da=Z[0]-R[0];R=Z[1]-R[1];return Math.sqrt(da*da+R*R)}function w(R,Z){const da=Z[0]-R[0];R=Z[1]-R[1];return da*da+R*R}function r(R){const Z=R[0];R=R[1];return Math.sqrt(Z*Z+R*R)}function y(R){const Z=R[0];R=R[1];return Z*Z+R*R}function z(R,Z){R[0]=-Z[0];R[1]=-Z[1];return R}function u(R,Z){R[0]=1/Z[0];R[1]=1/Z[1];return R}function v(R,Z){var da=Z[0];const ja=Z[1];da=da*da+ja*ja;0<da&&(da=1/Math.sqrt(da),R[0]=Z[0]*da,R[1]=Z[1]*da);return R}function A(R,Z){return R[0]*Z[0]+R[1]*Z[1]}function B(R,
Z,da){Z=Z[0]*da[1]-Z[1]*da[0];R[0]=R[1]=0;R[2]=Z;return R}function F(R,Z,da,ja){const W=Z[0];Z=Z[1];R[0]=W+ja*(da[0]-W);R[1]=Z+ja*(da[1]-Z);return R}function H(R,Z=1){const da=2*q.RANDOM()*Math.PI;R[0]=Math.cos(da)*Z;R[1]=Math.sin(da)*Z;return R}function J(R,Z,da){const ja=Z[0];Z=Z[1];R[0]=da[0]*ja+da[2]*Z;R[1]=da[1]*ja+da[3]*Z;return R}function E(R,Z,da){const ja=Z[0];Z=Z[1];R[0]=da[0]*ja+da[2]*Z+da[4];R[1]=da[1]*ja+da[3]*Z+da[5];return R}function K(R,Z,da){const ja=Z[0];Z=Z[1];R[0]=da[0]*ja+da[3]*
Z+da[6];R[1]=da[1]*ja+da[4]*Z+da[7];return R}function C(R,Z,da){const ja=Z[0];Z=Z[1];R[0]=da[0]*ja+da[4]*Z+da[12];R[1]=da[1]*ja+da[5]*Z+da[13];return R}function D(R,Z,da,ja){const W=Z[0]-da[0];Z=Z[1]-da[1];const aa=Math.sin(ja);ja=Math.cos(ja);R[0]=W*ja-Z*aa+da[0];R[1]=W*aa+Z*ja+da[1];return R}function G(R,Z){var da=R[0];R=R[1];const ja=Z[0];Z=Z[1];let W=da*da+R*R;0<W&&(W=1/Math.sqrt(W));let aa=ja*ja+Z*Z;0<aa&&(aa=1/Math.sqrt(aa));da=(da*ja+R*Z)*W*aa;return 1<da?0:-1>da?Math.PI:Math.acos(da)}function N(R){return"vec2("+
R[0]+", "+R[1]+")"}function Y(R,Z){return R[0]===Z[0]&&R[1]===Z[1]}function ca(R,Z){const da=R[0];R=R[1];const ja=Z[0];Z=Z[1];const W=q.getEpsilon();return Math.abs(da-ja)<=W*Math.max(1,Math.abs(da),Math.abs(ja))&&Math.abs(R-Z)<=W*Math.max(1,Math.abs(R),Math.abs(Z))}function ka(R,Z,da,ja,W){let aa=Z[0]-da[0];da=Z[1]-da[1];W=(ja[0]*aa+ja[1]*da)*(W-1);aa=ja[0]*W;da=ja[1]*W;R[0]=Z[0]+aa;R[1]=Z[1]+da;return R}const Q=Object.freeze(Object.defineProperty({__proto__:null,add:k,angle:G,ceil:d,copy:n,cross:B,
dist:t,distance:t,div:f,divide:f,dot:A,equals:ca,exactEquals:Y,floor:c,inverse:u,len:r,length:r,lerp:F,max:h,min:e,mul:a,multiply:a,negate:z,normalize:v,projectAndScale:ka,random:H,rotate:D,round:x,scale:m,scaleAndAdd:p,set:g,sqrDist:w,sqrLen:y,squaredDistance:w,squaredLength:y,str:N,sub:l,subtract:l,transformMat2:J,transformMat2d:E,transformMat3:K,transformMat4:C},Symbol.toStringTag,{value:"Module"}));b.add=k;b.angle=G;b.ceil=d;b.copy=n;b.cross=B;b.dist=t;b.distance=t;b.div=f;b.divide=f;b.dot=A;
b.equals=ca;b.exactEquals=Y;b.floor=c;b.inverse=u;b.len=r;b.length=r;b.lerp=F;b.max=h;b.min=e;b.mul=a;b.multiply=a;b.negate=z;b.normalize=v;b.projectAndScale=ka;b.random=H;b.rotate=D;b.round=x;b.scale=m;b.scaleAndAdd=p;b.set=g;b.sqrDist=w;b.sqrLen=y;b.squaredDistance=w;b.squaredLength=y;b.str=N;b.sub=l;b.subtract=l;b.transformMat2=J;b.transformMat2d=E;b.transformMat3=K;b.transformMat4=C;b.vec2=Q;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/support/QueueProcessor":function(){define("exports ../../core/has ../../core/maybe ../../core/promiseUtils ../../core/Queue ../../core/ReactiveMap ../../core/scheduling ../../core/signal".split(" "),
function(b,q,n,g,k,l,a,f){class d{constructor(e,h){this.item=e;this.controller=h;this.promise=null}}class c{constructor(e){this._task=this._schedule=null;this._deferreds=new l;this._controllers=new l;this._processingItems=new l;this._pausedSignal=f.signal(!1);this.concurrency=1;e.concurrency&&(this.concurrency=e.concurrency);this._queue=new k(e.peeker);this.process=e.process;const h=e.scheduler;e.priority&&h&&(this._task=h.registerTask(e.priority,this))}destroy(){this.clear();this._schedule=n.removeMaybe(this._schedule);
this._task=n.removeMaybe(this._task)}get updating(){return!!this._task?.updating||this.running}get length(){return this._processingItems.size+this._queue.length}abort(e){(e=this._controllers.get(e))&&e.abort()}clear(){this._queue.clear();const e=[];this._controllers.forEach(h=>e.push(h));this._controllers.clear();e.forEach(h=>h.abort());this._processingItems.clear();this._cancelNext()}forEach(e){this._deferreds.forEach((h,x)=>e(x))}get(e){return(e=this._deferreds.get(e))?e.promise:void 0}isOngoing(e){return this._processingItems.has(e)}has(e){return this._deferreds.has(e)}pause(){this._pausedSignal.value||
(this._pausedSignal.value=!0,this._cancelNext())}push(e,h){const x=this.get(e);if(x)return x;const m=new AbortController;let p=null;h&&(p=g.onAbort(h,()=>m.abort()));const t=()=>{w.remove();null!=p&&p.remove();this._removeItem(e);this._queue.remove(e);this._scheduleNext()},w=g.onAbortOrThrow(m.signal,()=>{const y=this._processingItems.get(e);y&&y.controller.abort();t();r.reject(g.createAbortError())}),r=g.createResolver();this._deferreds.set(e,r);this._controllers.set(e,m);r.promise.then(t,t);this._queue.push(e);
this._scheduleNext();return r.promise}last(){return this._queue.last()}lastPromise(){const e=this.last();return e?this.get(e):null}peek(){return this._queue.peek()}popLast(){const e=this._queue.popLast();e&&(this._deferreds.get(e)?.reject(g.createAbortError()),this._removeItem(e));return e}reset(){const e=Array.from(this._processingItems.values());this._processingItems.clear();for(const h of e)this._queue.push(h.item),h.controller.abort();this._scheduleNext()}resume(){this._pausedSignal.value&&(this._pausedSignal.value=
!1,this._scheduleNext())}takeAll(){const e=[];for(;this._queue.length;)e.push(this._queue.pop());this.clear();return e}get running(){return!this._pausedSignal.value&&0<this._queue.length&&this._processingItems.size<this.concurrency}runTask(e){for(;!e.done&&0<this._queue.length&&this._processingItems.size<this.concurrency;)this._process(this._queue.pop()),e.madeProgress()}_removeItem(e){this._deferreds.delete(e);this._controllers.delete(e);this._processingItems.delete(e)}_scheduleNext(){this._task||
this._pausedSignal.value||this._schedule||(this._schedule=a.schedule(()=>{this._schedule=null;this._next()}))}_next(){for(;0<this._queue.length&&this._processingItems.size<this.concurrency;)this._process(this._queue.pop())}_cancelNext(){this._schedule&&(this._schedule.remove(),this._schedule=null)}_processResult(e,h){this._canProcessFulfillment(e)&&(this._scheduleNext(),this._deferreds.get(e.item).resolve(h))}_processError(e,h){this._canProcessFulfillment(e)&&(this._scheduleNext(),this._deferreds.get(e.item).reject(h))}_canProcessFulfillment(e){return this._deferreds.get(e.item)&&
this._processingItems.get(e.item)===e?!0:!1}_process(e){if(null!=e){var h=new AbortController,x=new d(e,h);this._processingItems.set(e,x);try{var m=this.process(e,h.signal)}catch(p){this._processError(x,p)}g.isPromiseLike(m)?(x.promise=m,m.then(p=>this._processResult(x,p),p=>this._processError(x,p))):this._processResult(x,m)}}get test(){}}b.QueueProcessor=c;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/core/Queue":function(){define(["./accessorSupport/tracking","./accessorSupport/tracking/SimpleObservable"],
function(b,q){class n{constructor(g=k=>k.values().next().value){this._peeker=g;this._observable=new q.SimpleObservable;this._items=new Set}get length(){b.trackAccess(this._observable);return this._items.size}clear(){0!==this.length&&(this._items.clear(),this._observable.notify())}last(){if(0!==this.length){for(var g of this._items);return g}}peek(){if(0!==this.length)return this._peeker(this._items)}push(g){this.contains(g)||(this._items.add(g),this._observable.notify())}contains(g){b.trackAccess(this._observable);
return this._items.has(g)}pop(){if(0!==this.length){var g=this.peek();this._items.delete(g);this._observable.notify();return g}}popLast(){if(0!==this.length){var g=this.last();this._items.delete(g);this._observable.notify();return g}}remove(g){this.contains(g)&&(this._items.delete(g),this._observable.notify())}filter(g){const k=this.length;this._items.forEach(l=>{g(l)||this._items.delete(l)});k!==this._items.size&&this._observable.notify();return this}*[Symbol.iterator](){b.trackAccess(this._observable);
yield*this._items}}return n})},"esri/core/ReactiveMap":function(){define(["./accessorSupport/tracking","./accessorSupport/tracking/SimpleObservable"],function(b,q){class n{constructor(g){this._observable=new q.SimpleObservable;this._map=new Map(g)}get size(){b.trackAccess(this._observable);return this._map.size}clear(){0<this._map.size&&(this._map.clear(),this._observable.notify())}delete(g){(g=this._map.delete(g))&&this._observable.notify();return g}entries(){b.trackAccess(this._observable);return this._map.entries()}forEach(g,
k){b.trackAccess(this._observable);this._map.forEach((l,a)=>g.call(k,l,a,this),k)}get(g){b.trackAccess(this._observable);return this._map.get(g)}has(g){b.trackAccess(this._observable);return this._map.has(g)}keys(){b.trackAccess(this._observable);return this._map.keys()}set(g,k){this._map.set(g,k);this._observable.notify();return this}values(){b.trackAccess(this._observable);return this._map.values()}[Symbol.iterator](){b.trackAccess(this._observable);return this._map[Symbol.iterator]()}get [Symbol.toStringTag](){return this._map[Symbol.toStringTag]}}
return n})},"esri/core/signal":function(){define(["exports","./lang","./accessorSupport/tracking","./accessorSupport/tracking/SimpleObservable"],function(b,q,n,g){class k{constructor(l,a){this._observable=new g.SimpleObservable;this._value=l;this._equalityFunction=a}get value(){n.trackAccess(this._observable);return this._value}set value(l){this._equalityFunction(l,this._value)||(this._value=l,this._observable.notify())}mutate(l){l(this._value);this._observable.notify()}}b.signal=function(l,a=q.equalsShallow){return new k(l,
a)};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/tiling/TileStrategy":function(){define(["../../../geometry/support/aaBoundingRect","./TileCache","./TileCoverage","./TileKey"],function(b,q,n,g){const k=new g(0,0,0,0),l=new Map,a=[],f=[];class d{constructor(c){this._previousScale=Number.POSITIVE_INFINITY;this.cachePolicy="keep";this.coveragePolicy="closest";this.resampling=!0;this.tileIndex=new Map;this.tiles=[];this.buffer=192;this.acquireTile=c.acquireTile;this.releaseTile=
c.releaseTile;this.tileInfoView=c.tileInfoView;null!=c.resampling&&(this.resampling=c.resampling);c.cachePolicy&&(this.cachePolicy=c.cachePolicy);c.coveragePolicy&&(this.coveragePolicy=c.coveragePolicy);null!=c.buffer&&(this.buffer=c.buffer);c.cacheSize&&(this._tileCache=new q(c.cacheSize,this.tileInfoView,e=>{this.releaseTile(e)}))}destroy(){this.tileIndex.clear()}update(c){const {resampling:e,tileIndex:h}=this,{scale:x,center:m,resolution:p}=c.state,{minScale:t,maxScale:w}=this.tileInfoView,r=!c.stationary&&
x>this._previousScale;this._previousScale=x;if(!e&&(x>t||x<w))this.tiles.length=0,this.clear();else if(c=this.tileInfoView.getTileCoverage(c.state,this.buffer,this.resampling,this.coveragePolicy)){var {spans:y,lodInfo:z}=c,{level:u}=z;this.tiles.length=0;h.forEach(F=>F.visible=!0);var v=0,A=0;if(0<y.length)for(const {row:F,colFrom:H,colTo:J}of y)for(var B=H;B<=J;B++){v++;const E=k.set(u,F,z.normalizeCol(B),z.getWorldForColumn(B)).id;let K=h.get(E);if(K)K.isReady?(l.set(E,K),A++):r||this._addParentTile(E,
l);else{if(this._tileCache?.has(E)){if(K=this._tileCache.pop(E),this.tileIndex.set(E,K),K.isReady){l.set(E,K);A++;continue}}else K=this.acquireTile(k),this.tileIndex.set(E,K);r||this._addParentTile(E,l)}}v=A===v;for(const [F,H]of h)l.has(F)||(k.set(F),A=this.tileInfoView.intersects(c,k),B="purge"===this.cachePolicy?k.level!==u:k.level>u,!A||!r&&v?!B&&A||a.push(H):H.isReady?B&&"purge"===this.cachePolicy&&this._hasReadyAncestor(k,u)?a.push(H):f.push(H):B&&a.push(H));for(const F of f)F.isReady&&l.set(F.key.id,
F);for(const F of a)this._tileCache?this._tileCache.add(F):this.releaseTile(F),h.delete(F.key.id);for(const F of l.values())this.tiles.push(F);for(const F of h.values())l.has(F.key.id)||(F.visible=!1);this._tileCache?.prune(u,m,p);n.pool.release(c);f.length=0;a.length=0;l.clear()}else this.tiles.length=0,this.clear()}clear(){const {tileIndex:c}=this;for(const e of c.values())this.releaseTile(e);c.clear()}refresh(c){for(const e of this.tileIndex.values())c(e);this._tileCache?.clear()}updateCacheSize(c){this._tileCache&&
(this._tileCache.maxSize=c)}_addParentTile(c,e){let h=null;for(;;){c=this.tileInfoView.getTileParentId(c);if(!c)break;if(this.tileIndex.has(c)){if(h=this.tileIndex.get(c),h?.isReady){e.has(h.key.id)||e.set(h.key.id,h);break}}else if(this._tileCache?.has(c)&&(h=this._tileCache.pop(c),this.tileIndex.set(c,h),h?.isReady)){e.has(h.key.id)||e.set(h.key.id,h);break}}}_hasReadyAncestor(c,e){const h=b.create();this.tileInfoView.getTileBounds(h,c,!0);for(const x of this.tileIndex.values())if(x.isReady&&x.key.level>=
e&&x.key.level<c.level){const m=b.create();this.tileInfoView.getTileBounds(m,x.key,!0);if(b.contains(m,h))return!0}return!1}}return d})},"esri/views/2d/tiling/TileCache":function(){define(["../../../core/libs/gl-matrix-2/math/vec2"],function(b){class q{constructor(n,g,k){this.maxSize=n;this._tileInfoView=g;this._removedFunc=k;this._tilePerId=new Map;this._tileKeysPerLevel=[]}clear(){this._tilePerId.clear();this._tileKeysPerLevel=[]}has(n){return this._tilePerId.has(n)}get(n){return this._tilePerId.get(n)}pop(n){const g=
this._tilePerId.get(n);if(g){var k=this._tileKeysPerLevel[g.key.level];this._tilePerId["delete"](n);for(let l=0;l<k.length;l++)if(k[l].id===n){k.splice(l,1);break}g.visible=!0;return g}}add(n){n.visible=!1;const g=n.key,k=g.id;this._tilePerId.has(k)||(this._tilePerId.set(k,n),n=g.level,this._tileKeysPerLevel[n]||(this._tileKeysPerLevel[n]=[]),this._tileKeysPerLevel[n].push(g))}prune(n,g,k){let l=this._tilePerId.size;if(!(l<=this.maxSize)){for(var a=this._tileKeysPerLevel.length-1;l>this.maxSize&&
0<=a;)a!==n&&(l=this._pruneAroundCenterTile(l,g,k,a)),a--;l>this.maxSize&&(l=this._pruneAroundCenterTile(l,g,k,n))}}_pruneAroundCenterTile(n,g,k,l){l=this._tileKeysPerLevel[l];if(!l||0===l.length)return n;const {size:a,origin:f}=this._tileInfoView.tileInfo,d=k*a[0],c=k*a[1],e=[0,0],h=[0,0];for(l.sort((x,m)=>{e[0]=f.x+d*(x.col+.5);e[1]=f.y-c*(x.row+.5);h[0]=f.x+d*(m.col+.5);h[1]=f.y-c*(m.row+.5);return b.squaredDistance(e,g)-b.squaredDistance(h,g)});0<l.length&&(k=l.pop(),this._removeTile(k.id),n--,
n!==this.maxSize););return n}_removeTile(n){const g=this._tilePerId.get(n);this._removedFunc&&g&&this._removedFunc(g);this._tilePerId["delete"](n)}}return q})},"esri/views/2d/layers/features/PipelineConnectionHandlers":function(){define(["exports","../../../../core/workers/utils"],function(b,q){class n{constructor(g){this._client=g;this.layerView=this._client.createInvokeProxy("");this.container=this._client.createInvokeProxy("container");this._eventLog=this._client.createInvokeProxy("eventLog")}onEvent(g){q.ignoreConnectionErrors(this._eventLog.onEvent(g))}}
b.PipelineConnectionHandlers=n;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/Processor":function(){define("../../../../core/has ../../../../core/maybe ../../../../core/object ../../../../core/promiseUtils ../../../../core/accessorSupport/diffUtils ../../../../core/workers/utils ../../../../geometry/SpatialReference ../../engine/webgl/mesh/MultiTileMeshData ../../engine/webgl/mesh/factories/FeatureMeshFactory ../../engine/webgl/mesh/factories/ResourceProxy ../../engine/webgl/shaderGraph/techniques/mesh/MeshWriterRegistry ../../engine/webgl/util/MatcherContext ./ProcessorTileMessageQueue ./processor/BinningStrategy ./processor/ClusterStrategy ./processor/FeatureUpdateStrategy ./support/AttributeStore ./support/ComputedAttributeStorage".split(" "),
function(b,q,n,g,k,l,a,f,d,c,e,h,x,m,p,t,w,r){class y{constructor(z,u){this._connection=z;this._source=u;this._version=1;this._registry=new e.MeshWriterRegistry;this._proxy=new c.ResourceProxy({fetch:(v,A)=>this._connection.layerView.fetch(v,A),fetchDictionary:(v,A)=>this._connection.layerView.fetchDictionary(v,A)});this._attributeStore=new w.AttributeStore({isLocal:!1,update:v=>l.ignoreConnectionErrors(this._connection.container.updateAttributeView(v))})}destroy(){this._proxy.destroy();this._strategy?.destroy();
this._attributeStore.destroy()}get aggregateQueryEngine(){return this._strategy?.aggregateQueryEngine}getDisplayFeatures(z){return this._strategy?this._strategy.getDisplayFeatures(z):{features:[],aggregates:[]}}getDisplayIds(z){const u={};if(!this._strategy)return u;this._strategy.displayMap(z,v=>v,(v,A,B)=>{u[B]=v});return u}getFeatureObjectIdsForAggregate(z){return this._strategy?this._strategy.getFeatureObjectIdsForAggregate(z):[]}onSubscribe(z){this._strategy?.onSubscribe(z)}onUnsubscribe(z){this._strategy?.onUnsubscribe(z)}async update(z,
u,v,A,B){z=z.processor;var F=n.notDeepEqual(this._schema?.storage,z.storage);const H=n.notDeepEqual(this._schema?.mesh.properties,z.mesh.properties),J=n.notDeepEqual(this._schema?.mesh.factory,z.mesh.factory),E=n.notDeepEqual(this._schema?.mesh.strategy,z.mesh.strategy),K=H||J||E;if(F||K||A){b("esri-2d-update-debug")&&console.debug(`Version[${this._version}] SymbolProcessor.update`,{changes:k.diff(this._schema,z),schema:z});this._schema=z;F=a.fromJSON(this._source.service.outSpatialReference);var C=
new r.ComputedAttributeStorage({fields:this._source.metadata.fieldsIndex,spatialReference:F});await this._attributeStore.update(z.storage,C,this._source.metadata,F,u);this._strategy?.invalidateAttributeData();if(A||K){(E||H)&&await this._updateStrategy(z.mesh.strategy,F,B,z.mesh.properties.timeZone);this._updateSortKey(C,"sortKey"in z.mesh.properties?z.mesh.properties.sortKey:null);v=new h.MatcherContext(C,this._proxy,v,this._registry);if(J||"dictionary"===z.mesh.factory.symbology.type)this._factory=
await d.FeatureMeshFactory.create(v,z.mesh.factory);this._invalidate();this._version=u;return this._connection.container.updateRenderState(this._version)}}}async applyLocalEdit(z){if(this._strategy){z=this._strategy.applyLocalEdit(z);for await(const u of z)try{await this._process(u)}catch(v){}}}async updateChunks(){this._strategy?.beforeUpdateChunks();await this._doUpdateChunks();this._strategy?.afterUpdateChunks()}async removeChunks(z){this._strategy?.removeChunks(z);this._attributeStore.incrementDisplayIdGeneration()}updateHighlight({highlights:z}){if(this._strategy){var u=
this._strategy.displayMap(z,({objectId:v})=>v,(v,{highlightFlags:A},B)=>({objectId:B,displayId:v,highlightFlags:A}));this._attributeStore.setHighlight(u,z)}else this._attributeStore.setHighlight(z.map(({objectId:v,highlightFlags:A})=>({objectId:v,highlightFlags:A,displayId:-1})),z)}async _doUpdateChunks(){if(this._strategy){var z=this._strategy.updateChunks(),u=[],v=new Map;for await(const A of z)z=v.get(A.id),null==z&&(z=new x.ProcessorTileMessageQueue({concurrency:16,process:B=>this._process(B)}),
v.set(A.id,z)),z=z.push(A).catch(B=>g.throwIfNotAbortError(B)),u.push(z);try{await Promise.all(u)}catch(A){}b("esri-2d-update-debug")&&console.log("SendUpdates");this._attributeStore.sendUpdates();b("esri-2d-update-debug")&&console.log("SendUpdates.await")}}async _updateStrategy(z,u,v,A){this._strategy?.destroy();switch(z.type){case "feature":this._strategy=new t.FeatureUpdateStrategy(this._source,this._attributeStore,A);break;case "binning":this._strategy=await m.BinningStrategy.create(z,u,this._source,
this._attributeStore,A);break;case "cluster":this._strategy=await p.ClusterStrategy.create(this._connection,z,u,this._source,this._attributeStore,A)}for(const B of v)this._strategy.onSubscribe(B)}async _updateSortKey(z,u){this._sortInfo=q.destroyMaybe(this._sortInfo?.computed);null!=u&&(z=u.byRenderer?null:await z.createComputedField(u),this._sortInfo={...u,computed:z})}_invalidate(){this._strategy&&this._strategy.invalidate()}async _process(z){const u=z.subscription;b("esri-2d-update-debug")&&console.debug(`Version[${this._version}] Tile[${u.tile.key.id}, end=${z.end}] Processor._process`);
await this._fetchResources(z);g.throwIfAborted(u.signal);var v=await this._write(z,u.tile.createArcadeEvaluationOptions(this._schema?.mesh.properties.timeZone)),A=u.tile.tileInfoView.getLODInfoAt(u.tile.key);const {message:B,transferList:F}=v.serialize(A);v={objectIdMap:null,inner:z.createMessage(B,this._version,this._attributeStore.epoch)};if(this._schema?.mesh.properties.returnMeshObjectId&&(v.objectIdMap={},A=z.reader?.getCursor()))for(;A.next();)v.objectIdMap[A.getDisplayId()]=A.getObjectId();
g.throwIfAborted(u.signal);await this._connection.container.onMessage(v,{signal:u.signal,transferList:F});this._attributeStore.sendUpdates();b("esri-2d-update-debug")&&console.debug(`Version[${this._version}] Tile[${u.tile.key.id}, end=${z.end}] Processor._process.await`)}async _fetchResources(z){await this._fetchMatcherResources(z);await this._fetchWriterResources(z)}async _fetchMatcherResources(z){if(z.reader)return this._factory.enqueueMatcherRequests(this._proxy,z.reader)}async _fetchWriterResources(z){if(z.reader){var u=
z.reader.getCursor();for(z=z.subscription.tile.createArcadeEvaluationOptions(this._schema.mesh.properties.timeZone);u.next();)this._factory.enqueueWriterRequests(this._proxy,u,z);await this._proxy.fetchEnqueuedResources()}}async _write(z,u){const v=z.subscription.tile;z=z.reader?.getCursor();var A=z?.getSize()??0;A=new f.MultiTileMeshData(v.key,this._strategy.enablePixelBuffering,v.tileInfoView.tileInfo.isWrappable,v.tileInfoView.tileInfo.spatialReference.isWGS84,A);if(!z)return A;const B=v.createArcadeEvaluationOptions(this._schema.mesh.properties.timeZone);
for(;z.next();){const F=this._getSortKeyValue(z,u);A.entityStart(z.getDisplayId(),F);this._factory.write(A,this._proxy,z,B,v.level);A.entityEnd()}return A}_getSortKeyValue(z,u){if(!this._sortInfo)return 0;const {computed:v,order:A,byRenderer:B}=this._sortInfo;z=B?this._factory.getSortKey(z,u):v?.read(z,u);return null==z||isNaN(z)?0:z*("asc"===A?-1:1)}}return y})},"esri/core/accessorSupport/diffUtils":function(){define(["exports","../Accessor","../Collection","./utils"],function(b,q,n,g){function k(x){return x instanceof
n?Object.keys(x.items):x instanceof q?g.getProperties(x).keys():x?Object.keys(x):[]}function l(x,m){return x instanceof n?x.items[m]:x[m]}function a(x,m){return Array.isArray(x)&&Array.isArray(m)?x.length!==m.length:!1}function f(x){return x?x.declaredClass:null}function d(x,m){const p=x.diff;if(p&&"function"===typeof p)return p(x,m);const t=k(x),w=k(m);if(0!==t.length||0!==w.length){if(!t.length||!w.length||a(x,m))return{type:"complete",oldValue:x,newValue:m};var r=w.filter(u=>!t.includes(u)),y=
t.filter(u=>!w.includes(u));y=t.filter(u=>w.includes(u)&&l(x,u)!==l(m,u)).concat(r,y).sort();if((r=f(x))&&h.has(r)&&y.length)return{type:"complete",oldValue:x,newValue:m};var z;r=x instanceof q&&m instanceof q;for(const u of y){y=l(x,u);const v=l(m,u);if((r||"function"!==typeof y&&"function"!==typeof v)&&y!==v&&(null!=y||null!=v)){if(p&&p[u]&&"function"===typeof p[u])y=p[u]?.(y,v);else if(y instanceof Date&&v instanceof Date){if(y.getTime()===v.getTime())continue;y={type:"complete",oldValue:y,newValue:v}}else y=
"object"===typeof y&&"object"===typeof v&&f(y)===f(v)?d(y,v):{type:"complete",oldValue:y,newValue:v};null!=y&&(null!=z?z.diff[u]=y:z={type:"partial",diff:{[u]:y}})}}return z}}function c(x,m){if(null==x)return!1;m=m.split(".");for(const p of m){if("complete"===x.type)break;if("partial"===x.type){if(x=x.diff[p],!x)return!1}else return!1}return!0}function e(x){if(null==x)return!0;switch(x.type){case "complete":return!1;case "collection":for(const m of x.added)if(!e(m))return!1;for(const m of x.removed)if(!e(m))return!1;
for(const m of x.changed)if(!e(m))return!1;return!0;case "partial":for(const m in x.diff)if(!e(x.diff[m]))return!1;return!0}}const h=new Set(["esri.Color","esri.portal.Portal","esri.symbols.support.Symbol3DAnchorPosition2D","esri.symbols.support.Symbol3DAnchorPosition3D"]);b.diff=function(x,m){if("function"!==typeof x&&"function"!==typeof m&&(null!=x||null!=m))return null==x||null==m||"object"===typeof x&&"object"===typeof m&&f(x)!==f(m)?{type:"complete",oldValue:x,newValue:m}:d(x,m)};b.hasDiff=c;
b.hasDiffAny=function(x,m){for(const p of m)if(c(x,p))return!0;return!1};b.hasRootDiff=function(x,m){return c(x,m)};b.hasRootDiffOnly=function(x,m){return x?"partial"===x.type?(x=Object.keys(x.diff),1===x.length&&x[0]===m):!1:!1};b.isEmpty=e;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/mesh/MultiTileMeshData":function(){define("exports ../../../tiling/TileInfoView ../../../tiling/TileKey ../../../tiling/TileQueue ../../../tiling/TileStrategy ../definitions ./MeshData".split(" "),
function(b,q,n,g,k,l,a){function f(e){switch(e){case 1:case 8:case 32:return-1;case 2:case 64:return 0;case 4:case 16:case 128:return 1}}function d(e){switch(e){case 1:case 2:case 4:return-1;case 8:case 16:return 0;case 32:case 64:case 128:return 1}}class c{constructor(e,h,x,m,p=0){this.tileKey=e;this._bufferingEnabled=h;this._sizeHint=p;this._meshes={self:new a.MeshData(this.id,this._sizeHint),neighbors:[]};this._currentEntityOverlaps=this._currentRecordOverlaps=0;this._copyBufferedDataIntoSelf=
x&&this._bufferingEnabled&&e.level===(m?1:0)}get id(){return this.tileKey.id}vertexCount(){return this._meshes.self.vertexCount()}indexCount(){return this._meshes.self.indexCount()}indexEnsureSize(e){this._meshes.self.indexEnsureSize(e)}entityStart(e,h=e){this._currentEntityOverlaps=0;this._meshes.self.entityStart(e,h)}entityRecordCount(){return this._meshes.self.entityRecordCount()}entityEnd(){this._meshes.self.entityEnd();if(this._bufferingEnabled&&!this._copyBufferedDataIntoSelf)for(let e=0;8>
e;e++)this._currentEntityOverlaps&1<<e&&this._meshes.neighbors[e].entityEnd()}recordStart(e,h,x){this._currentRecordOverlaps=0;this._meshes.self.recordStart(e,h,x)}recordEnd(e){return(e=this._meshes.self.recordEnd(this._currentRecordOverlaps))&&0!==this._currentRecordOverlaps?(this._copyIntoNeighbors(),this._currentEntityOverlaps|=this._currentRecordOverlaps,!0):e}recordBounds(e,h,x,m){this._bufferingEnabled&&this._addOverlap(e,h,x,m)}recordCount(){return this._meshes.self.recordCount()}metricStart(e){this._meshes.self.metricStart(e)}metricBoxWrite(e){this._meshes.self.metricBoxWrite(e)}metricEnd(){this._meshes.self.metricEnd()}vertexWrite(e){this._meshes.self.vertexWrite(e)}vertexWriteF32(e){this._meshes.self.vertexWriteF32(e)}vertexWriteRegion(e){this._meshes.self.vertexWriteRegion(e)}indexWrite(e){this._meshes.self.indexWrite(e)}serialize(e){const h=
{message:[],transferList:[]},x=this._meshes.self.serialize();h.message.push({tileId:this.tileKey.id,...x.message});h.transferList.push(...x.transferList);this._meshes.neighbors.forEach((m,p)=>{m=m.serialize();var t=1<<p;p=f(t);t=d(t);p=(new n(this.tileKey)).getNormalizedNeighbor(p,t,e);h.message.push({tileId:p.id,...m.message});h.transferList.push(...m.transferList)});return h}_addOverlap(e,h,x,m){x=Math.min(l.tileSize/2,x);m=Math.min(l.tileSize/2,m);this._currentRecordOverlaps|=255^((e<0+x?148:e>=
l.tileSize-x?41:189)|(h<0+m?224:h>=l.tileSize-m?7:231))}_copyIntoNeighbors(){for(let x=0;8>x;x++){var e=1<<x;if(this._currentRecordOverlaps&e){if(this._copyBufferedDataIntoSelf){var h=-f(e)*l.tileSize;e=-d(e)*l.tileSize;if(0!==e)continue;this._meshes.self.copyLast(h,e);continue}this._meshes.neighbors[x]||(this._meshes.neighbors[x]=new a.MeshData(e,Math.floor(this._sizeHint/16)));h=this._meshes.neighbors[x];const m=-f(e)*l.tileSize;e=-d(e)*l.tileSize;h.copyLastFrom(this._meshes.self,m,e)}}}}b.MultiTileMeshData=
c;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/mesh/MeshData":function(){define(["exports","../DisplayEntity","../DisplayRecord","./VertexDataWriter","../util/Writer"],function(b,q,n,g,k){class l{constructor(a,f=0){this._id=a;this._sizeHint=f;this._entitySortKeyIndex=this._entityIdIndex=this._entityCountOffset=this._entityRecordCountOffset=0;this._didEntityStart=!1;this._instanceIdToVertexData=new Map;this._recordVertexCount=this._recordVertexStart=this._recordIndexCount=
this._recordIndexStart=0;this._current={metric:null,writer:null,start:0,sortKey:0,instanceId:0,layoutHash:0,indexStart:0,vertexStart:0,textureKey:0,metricBoxLenPointer:0};this._entities=new k(Uint32Array,this._sizeHint*q.byteSizeHint);this._entityCountOffset=this._entities.push(0)}get id(){return this._id}serialize(){const a=[],f=[],d=this._entities.buffer();for(const c of this._instanceIdToVertexData.values())f.push(c.serialize(a));return{message:{data:f,entities:d},transferList:a}}vertexCount(){return this._current.writer?.vertexCount??
0}indexCount(){return this._current.writer?.indexCount??0}vertexEnsureSize(a){this._current.writer.vertexEnsureSize(a)}indexEnsureSize(a){this._current.writer.indexEnsureSize(a)}vertexWrite(a){this._current.writer.writeVertex(a)}vertexWriteRegion(a){this._current.writer.writeVertexRegion(a)}vertexWriteF32(a){this._current.writer.writeVertexF32(a)}recordBounds(a,f,d,c){}indexWrite(a){this._current.writer.writeIndex(a)}metricStart(a){this._current.metric=a}metricEnd(){this._current.metric.bounds.length&&
this._current.writer.writeMetric(this._current.metric)}metricBoxWrite(a){this._current.metric.bounds.push(a)}entityStart(a,f=a){this._entityIdIndex=this._entities.push(a);this._entitySortKeyIndex=this._entities.writeF32(f);this._entityRecordCountOffset=this._entities.push(0);this._didEntityStart=!0}entityRecordCount(){return this._entities.getValue(this._entityRecordCountOffset)}entityEnd(){this._didEntityStart&&(0===this.entityRecordCount()?this._entities.seek(this._entityIdIndex):this._entities.incr(this._entityCountOffset),
this._didEntityStart=!1)}recordCount(){return this._entities.getValue(this._entityRecordCountOffset)}recordStart(a,f,d=0){this._current.writer=this._getVertexWriter(a,f);this._current.indexStart=this._current.writer.indexCount;this._current.vertexStart=this._current.writer.vertexCount;this._current.instanceId=a;this._current.layoutHash=f.hash;this._current.textureKey=d}recordEnd(a=0){const f=this._current.vertexStart,d=this._current.writer.vertexCount-f;if(!d)return!1;const c=this._current.indexStart,
e=this._current.writer.indexCount-c;this._recordIndexStart=c;this._recordIndexCount=e;this._recordVertexStart=f;this._recordVertexCount=d;this._entities.incr(this._entityRecordCountOffset);n.write(this._entities,this._current.instanceId,this._current.textureKey,c,e,f,d,a);return!0}copyLast(a,f){var d=this._recordVertexStart+this._recordVertexCount;this._entities.incr(this._entityRecordCountOffset);n.write(this._entities,this._current.instanceId,this._current.textureKey,this._recordIndexStart+this._recordIndexCount,
this._recordIndexCount,d,this._recordVertexCount,0);var c=this._current.writer.indexWriter;const e=this._current.writer.vertexWriter;var h=this._recordIndexStart+this._recordIndexCount,x=this._recordVertexCount;for(var m=this._recordIndexStart;m!==h;m++){const p=c.getValue(m);c.push(p+x)}c=this._current.writer.layout.stride/Uint32Array.BYTES_PER_ELEMENT;x=this._recordVertexStart*c;for(h=(this._recordVertexStart+this._recordVertexCount)*c;x!==h;x++)m=e.getValue(x),e.push(m);h=this._current.writer.layout.position;
x=h.packPrecisionFactor??1;h=h.offset/Uint32Array.BYTES_PER_ELEMENT;a*=x;f*=x;for(d*=c;d<=e.length;d+=c)e.i1616Add(d+h,a,f)}copyLastFrom(a,f,d){var c=a._entities.getValue(a._entityIdIndex),e=this._entities.getValue(this._entityIdIndex);c!==e&&(e=a._entities.getValueF32(a._entitySortKeyIndex),this.entityStart(c,e));this.recordStart(a._current.instanceId,a._current.writer.layout,a._current.textureKey);c=this._current.writer.layout.stride/Uint32Array.BYTES_PER_ELEMENT;var h=this._current.vertexStart,
x=a._current.vertexStart-h;const m=this._current.writer.indexWriter;e=this._current.writer.vertexWriter;const p=a._current.writer.indexWriter;var t=a._current.writer.vertexWriter;for(let w=a._current.indexStart;w!==p.length;w++){const r=p.getValue(w);m.push(r-x)}for(a=a._current.vertexStart*c;a!==t.length;a++)x=t.getValue(a),e.push(x);a=this._current.writer.layout.position;t=a.packPrecisionFactor??1;a=a.offset/Uint32Array.BYTES_PER_ELEMENT;f*=t;d*=t;for(h*=c;h<=e.length;h+=c)e.i1616Add(h+a,f,d);this.recordEnd()}_getVertexWriter(a,
f){const d=this._instanceIdToVertexData;d.has(a)||d.set(a,new g.VertexDataWriter(a,f,this._sizeHint));return d.get(a)}}b.MeshData=l;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/DisplayEntity":function(){define(["./DisplayRecord","./util/serializationUtils"],function(b,q){class n{constructor(g,k){this.id=g;this.sortKey=k;this.records=[]}serialize(g){g.push(this.id);g.writeF32(this.sortKey);q.serializeList(g,this.records);return g}static deserialize(g){var k=
g.readInt32();const l=g.readF32();k=new n(k,l);k.records=q.deserializeList(g,b)??[];return k}}n.byteSizeHint=2*Uint32Array.BYTES_PER_ELEMENT+b.byteSizeHint;return n})},"esri/views/2d/engine/webgl/DisplayRecord":function(){define(function(){class b{constructor(q,n,g,k,l,a,f){this.instanceId=q;this.textureKey=n;this.indexStart=g;this.indexCount=k;this.vertexStart=l;this.vertexCount=a;this.overlaps=f}updateBaseOffsets(q){this.vertexStart+=q.vertexFrom;this.indexStart+=q.indexFrom}clone(){return new b(this.instanceId,
this.textureKey,this.indexStart,this.indexCount,this.vertexStart,this.vertexCount,this.overlaps)}static write(q,n,g,k,l,a,f,d){q.push(n);q.push(g);q.push(k);q.push(l);q.push(a);q.push(f);q.push(d)}serialize(q){q.push(this.instanceId);q.push(this.textureKey);q.push(this.indexStart);q.push(this.indexCount);q.push(this.vertexStart);q.push(this.vertexCount);q.push(this.overlaps);return q}static deserialize(q){const n=q.readInt32(),g=q.readInt32(),k=q.readInt32(),l=q.readInt32(),a=q.readInt32(),f=q.readInt32();
q=q.readInt32();return new b(n,g,k,l,a,f,q)}}b.byteSizeHint=7*Uint32Array.BYTES_PER_ELEMENT;return b})},"esri/views/2d/engine/webgl/util/serializationUtils":function(){define(["exports"],function(b){b.deserializeList=function(q,n,g){var k=q.readInt32();k=Array(k);for(let l=0;l<k.length;l++)k[l]=n.deserialize(q,g);return k};b.serializeList=function(q,n){if(null===n)q.push(0);else{q.push(n.length);for(const g of n)g.serialize(q);return q}};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},
"esri/views/2d/engine/webgl/mesh/VertexDataWriter":function(){define(["exports","../util/Writer"],function(b,q){class n{constructor(g,k,l=0){const a=6*l*Uint32Array.BYTES_PER_ELEMENT;l=4*l*k.stride;const f=k.stride/4,d=k.attributes.find(c=>"pos"===c.name||"position"===c.name);if(!d)throw Error("InternalError: Unable to find position attribute");this.layout={...k,position:d};this._indices=new q(Uint32Array,a);this._vertices=new q(Uint32Array,l);this._metrics=new q(Uint32Array,0);this._metricCountOffset=
this._metrics.push(0);this._strideInt=f;this._instanceId=g}serialize(g){const k=this._indices.buffer(),l=this._vertices.buffer(),a=this._metrics.length?this._metrics.buffer():null;g.push(k,l);return{instanceId:this._instanceId,layout:this.layout,indices:k,vertices:l,metrics:a}}get strideInt(){return this._strideInt}get vertexCount(){return this._vertices.length/this._strideInt}get indexCount(){return this._indices.length}get indexWriter(){return this._indices}get vertexWriter(){return this._vertices}get metricWriter(){return this._metrics}vertexEnsureSize(g){this._vertices.ensureSize(g)}indexEnsureSize(g){this._indices.ensureSize(g)}writeIndex(g){this._indices.push(g)}writeVertex(g){this._vertices.push(g)}writeVertexRegion(g){this._vertices.writeRegion(g)}writeVertexF32(g){this._vertices.writeF32(g)}writeMetric(g){this._metrics.incr(this._metricCountOffset);
g.serialize(this._metrics)}}b.VertexDataWriter=n;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/util/Writer":function(){define(function(){class b{get length(){return this._pos}constructor(q,n){this._pos=0;n=n?this._roundToNearest(n,q.BYTES_PER_ELEMENT):40;this._array=new ArrayBuffer(n);this._buffer=new q(this._array);this._ctor=q;this._i16View=new Int16Array(this._array)}_roundToNearest(q,n){q=Math.round(q);return 1===n?q:q+(n-q%n)}_ensureSize(q){if(this._pos+
q>=this._buffer.length){q=this._roundToNearest(1.25*(this._array.byteLength+q*this._buffer.BYTES_PER_ELEMENT),this._buffer.BYTES_PER_ELEMENT);q=new ArrayBuffer(q);const n=new this._ctor(q);n.set(this._buffer,0);this._array=q;this._buffer=n;this._i16View=new Int16Array(this._array)}}ensureSize(q){this._ensureSize(q)}writeF32(q){this._ensureSize(1);const n=this._pos;(new Float32Array(this._array,4*this._pos,1))[0]=q;this._pos++;return n}push(q){this._ensureSize(1);const n=this._pos;this._buffer[this._pos++]=
q;return n}writeFixed(q){this._buffer[this._pos++]=q}setValue(q,n){this._buffer[q]=n}i1616Add(q,n,g){this._i16View[2*q]+=n;this._i16View[2*q+1]+=g}getValue(q){return this._buffer[q]}getValueF32(q){return(new Float32Array(this._array,4*q,1))[0]}incr(q){if(this._buffer.length<q)throw Error("Increment index overflows the target buffer");this._buffer[q]++}decr(q){this._buffer[q]--}writeRegion(q){this._ensureSize(q.length);const n=this._pos;this._buffer.set(q,this._pos);this._pos+=q.length;return n}writeManyFrom(q,
n,g){for(this._ensureSize(g-n);n!==g;n++)this.writeFixed(q._buffer[n])}buffer(){const q=this._array.slice(0,4*this._pos);this.destroy();return q}toArray(){return[...this._buffer]}seek(q){this._pos=q}destroy(){this._buffer=this._array=null}}return b})},"esri/views/2d/engine/webgl/mesh/factories/FeatureMeshFactory":function(){define(["exports","./MeshFactory","../../util/createMatcher"],function(b,q,n){class g extends q.AMeshFactory{static async create(k,l){const a=await n.createMatcher(k,l.symbology);
k=l.labels?await n.createMatcher(k,l.labels):null;return new g(a,k)}constructor(k,l){super();this._symbology=k;this._labels=l}destroy(){}async enqueueMatcherRequests(k,l){await Promise.all([this._symbology.fetchResources(k,l),this._labels?.fetchResources(k,l)])}enqueueWriterRequests(k,l,a){var f=this._symbology.match(l,a);if(f){for(const d of f)d.enqueueRequest(k,l,a);if(this._labels&&(f=this._labels.match(l,a)))for(const d of f)d.enqueueRequest(k,l,a)}}write(k,l,a,f,d){const c=this._symbology.match(a,
f);if(c){for(var e of c)e.write(k,l,a,f,d);if(1<=k.entityRecordCount()&&this._labels&&(e=this._labels.match(a,f)))for(const h of e)h.setReferences(c),h.write(k,l,a,f,d)}}getSortKey(k,l){return this._symbology.getSortKey(k,l)}}b.FeatureMeshFactory=g;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/mesh/factories/MeshFactory":function(){define(["exports"],function(b){class q{}b.AMeshFactory=q;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},
"esri/views/2d/engine/webgl/util/createMatcher":function(){define("exports ./DictionaryMatcher ./IntervalMatcher ./LabelMatcher ./MapMatcher ./Matcher".split(" "),function(b,q,n,g,k,l){async function a(c,e){switch(e.type){case "simple":case "heatmap":case "dot-density":case "pie-chart":return l.FeatureMatcher.from(c,e);case "interval":return n.IntervalMatcher.fromIntervalSchema(c,e);case "dictionary":return q.DictionaryMatcher.fromDictionaryRenderer(c,e);case "label":return g.LabelMatcher.fromLabelSchema(c,
e);case "map":return k.MapMatcher.fromMatcherSchema(c,e);case "subtype":return f.fromSubtypes(c,e);case "cluster":return d.fromClusterSchema(c,e);default:throw Error("Impl");}}class f extends l.FeatureMatcher{constructor(c,e){super();this._subMatchers=c;this._subtypeField=e}static async fromSubtypes(c,e){const h=new Map,x=[];for(const m in e.renderers){const p=parseInt(m,10),t=a(c,e.renderers[m]).then(w=>h.set(p,w));x.push(t)}await Promise.all(x);return new f(h,e.subtypeField)}match(c,e){var h=c.readAttribute(this._subtypeField);
return(h=this._subMatchers.get(h))?h.match(c,e):null}}class d extends l.FeatureMatcher{static async fromClusterSchema(c,e){const [h,x]=await Promise.all([a(c,e.feature),a(c,e.cluster)]);return new d(h,x)}constructor(c,e){super();this._featureMatcher=c;this._clusterMatcher=e}match(c,e){return 1===c.readAttribute("cluster_count")?this._featureMatcher.match(c,e):this._clusterMatcher.match(c,e)}}b.ClusterMatcher=d;b.SubtypeMatcher=f;b.createMatcher=a;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},
"esri/views/2d/engine/webgl/util/DictionaryMatcher":function(){define(["exports","./Matcher"],function(b,q){class n extends q.FeatureMatcher{static async fromDictionaryRenderer(g,k){return new n(g,k)}constructor(g,k){super();this._context=g;this._schema=k;this._hashToGroup=new Map}get fieldMap(){return this._schema.fieldMap}async fetchResources(g,k){k=k.getCursor();const l=[];for(;k.next();)l.push(this._updateMeshWriterGroup(g,k));await Promise.all(l)}match(g,k){g=g.getAttributeHash();return this._hashToGroup.get(g)}async _updateMeshWriterGroup(g,
k){const l=k.readLegacyFeatureForDisplay();k=k.getAttributeHash();!this._hashToGroup.has(k)&&(this._hashToGroup.set(k,null),g=await g.fetchDictionaryResourceImmediate({type:"dictionary-request",feature:l}))&&(g=await this._context.createMeshWriters(g.meshes),this._hashToGroup.set(k,g))}}b.DictionaryMatcher=n;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/util/Matcher":function(){define(["exports"],function(b){class q{constructor(){this._backgroundFillResult=
this._defaultResult=null}static async from(n,g){const k=new q;k.setDefault(await n.createMeshWriters(g.meshes));return k}size(){return 1}getDefault(){return this._defaultResult}setDefault(n){this._defaultResult=n}getBackgroundFill(){return this._backgroundFillResult}setBackgroundFill(n){this._backgroundFillResult=n}match(n,g){return(n=this.doMatch(n,g)||this.getDefault())&&0<n.length&&(g=this.getBackgroundFill())?[...g,...n]:n}getSortKey(n,g){return 0}doMatch(n,g){return null}async fetchResources(n,
g){}}b.FeatureMatcher=q;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/util/IntervalMatcher":function(){define(["exports","./Matcher"],function(b,q){class n extends q.FeatureMatcher{constructor(g,k){super();this._intervals=[];this._isMaxInclusive=k;this._field=g}static async fromIntervalSchema(g,k){var l=await g.storage.createComputedField(k);const a=new n(l,k.isMaxInclusive);await Promise.all(k.intervals.map(async f=>{const d=await g.createMeshWriters(f.meshes);
a.add(f,d)}));l=await g.createMeshWriters(k.defaultSymbol);a.setDefault(l);k=await g.createMeshWriters(k.backgroundFill);a.setBackgroundFill(k);return a}add(g,k){this._intervals.push({interval:g,result:k});this._intervals.sort((l,a)=>l.interval.min-a.interval.min)}size(){return super.size()+this._intervals.length}doMatch(g,k){g=this._field?.read(g,k);if(null==g||isNaN(g)||Infinity===g||-Infinity===g)return null;for(k=0;k<this._intervals.length;k++){const {interval:l,result:a}=this._intervals[k],f=
this._isMaxInclusive?g<=l.max:g<l.max;if(g>=l.min&&f)return a}return null}}b.IntervalMatcher=n;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/util/LabelMatcher":function(){define(["exports","./Matcher"],function(b,q){class n extends q.FeatureMatcher{static async fromLabelSchema(g,k){k=k.classes.map(async l=>{const a=await g.createMeshWriters(l.meshes);return{minScale:l.minScale,maxScale:l.maxScale,meshes:a,expression:null,where:await g.storage.createWhereClause(l.where)}});
k=await Promise.all(k);return new n(k)}constructor(g){super();this._labels=g}match(g,k){if(!this._labels.length)return null;k=this._getLabels(k.$view.scale);const l=[];for(const a of k)a.where&&!a.where(g)||l.push(...a.meshes);return l}_getLabels(g){return this._labels.filter(k=>this._validForTileScale(k,g))}_validForTileScale(g,k){return(!g.minScale||g.minScale>=k-k/4)&&(!g.maxScale||g.maxScale<=k+k/2)}}b.LabelMatcher=n;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/util/MapMatcher":function(){define(["exports",
"./Matcher"],function(b,q){class n extends q.FeatureMatcher{constructor(g,k){super();this._defaultSymbolSortKey=0;this._nullResult=null;this._resultsMap=new Map;this._fields=[];this._fields=g;this._separator=k||""}static async fromMatcherSchema(g,k){var l=k.expression?[g.storage.createComputedField({expression:k.expression})]:[k.field?g.storage.createComputedField({field:k.field}):null,k.field2?g.storage.createComputedField({field:k.field2}):null,k.field3?g.storage.createComputedField({field:k.field3}):
null];l=(await Promise.all(l)).filter(f=>!!f);const a=new n(l,k.fieldDelimiter);l=await g.createMeshWriters(k.defaultSymbol);a.setDefault(l);l=await g.createMeshWriters(k.backgroundFill);a.setBackgroundFill(l);await Promise.all(k.map.map(async(f,d)=>{const c=await g.createMeshWriters(f.symbol);"\x3cNull\x3e"===f.value?a.setNullResult(c):a.add(f.value,c,d+1)}));return a}setNullResult(g){this._nullResult=g}getSortKey(g,k){g=this._getValueFromFields(g,k);return null==g||""===g||"\x3cNull\x3e"===g?0:
(g=this._resultsMap.get(g.toString()))?g.sortKey:this._defaultSymbolSortKey}add(g,k,l){this._resultsMap.set(g.toString(),{meshWriters:k,sortKey:l});this._defaultSymbolSortKey=Math.max(this._defaultSymbolSortKey,l+1)}size(){return super.size()+this._resultsMap.size}doMatch(g,k){g=this._getValueFromFields(g,k);return null===this._nullResult||null!=g&&""!==g&&"\x3cNull\x3e"!==g?null==g?null:this._resultsMap.get(g.toString())?.meshWriters:this._nullResult}_getValueFromFields(g,k){const l=[];for(const a of this._fields){const f=
a.read(g,k);null==f||""===f?l.push("\x3cNull\x3e"):l.push(f)}return l.join(this._separator)}}b.MapMatcher=n;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/mesh/factories/ResourceProxy":function(){define(["exports","../../../../../../core/string","../../Utils","../../shaderGraph/techniques/mesh/AResourceProxy"],function(b,q,n,g){class k extends g.AResourceProxy{constructor(l){super();this._fetcher=l;this._controller=new AbortController;this._pendingIds=
new Set;this._pendingRequests=[];this._resourceIdToResource=new Map}destroy(){this._controller.abort()}get _abortOptions(){return{signal:this._controller.signal}}enqueueRequest(l){var a=n.discardUrlIfHasUrlHash(l.resource);a=q.numericHash(JSON.stringify(a));if(this._pendingIds.has(a))return a;this._pendingIds.add(a);this._pendingRequests.push({...l,resourceId:a});return a}async fetchEnqueuedResources(){const l=this._pendingRequests;this._pendingIds.clear();this._pendingRequests=[];const a=await this._fetcher.fetch(l,
this._abortOptions);for(let f=0;f<a.length;f++)this._resourceIdToResource.set(l[f].resourceId,a[f])}async fetchResourceImmediate(l){l=await this._fetcher.fetch([l],this._abortOptions);if(1!==l.length)throw Error("FeaturePipelineResourceProxy: failed to fetch resources");return l[0]}async fetchDictionaryResourceImmediate(l){l=await this._fetcher.fetchDictionary([l],this._abortOptions);if(1!==l.length)throw Error("FeaturePipelineResourceProxy: failed to fetch dictionary resources");return l[0]}getResource(l){return this._resourceIdToResource.get(l)}}
b.ResourceProxy=k;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/Utils":function(){define("exports ../../../../core/Error ../../../../core/Logger ../../../../symbols/cim/enums ../../../../core/RandomLCG ../../../../core/has ../../../webgl/checkWebGLError ../../../webgl/enums ../../../webgl/FramebufferObject ../../../webgl/GLObjectType ../../../webgl/getDataTypeBytes ../../../webgl/Texture ../../../webgl/TextureDescriptor ../../../webgl/VertexElementDescriptor".split(" "),
function(b,q,n,g,k,l,a,f,d,c,e,h,x,m){function p(y){const z=new Map;for(const u in y){let v=0;z.set(u,y[u].map(A=>{const B=new m.VertexElementDescriptor(A.name,A.count,A.type,v,0,A.normalized||!1);v+=A.count*e.getDataTypeBytes(A.type);return B}));z.get(u).forEach(A=>A.stride=v)}return z}const t=()=>n.getLogger("esri.views.2d.engine.webgl.Utils"),w=y=>{const z={};y.forEach((u,v)=>z[v]=u?.length?u[0].stride:0);return z},r=new Map;b.charCodes=function(y){const z=[];for(let u=0;u<y.length;u++)z.push(y.charCodeAt(u));
return z};b.createAttributeLayout=p;b.createProgramDescriptor=(y,z)=>{if(!r.has(y)){const u=p(z),v=w(u),A=new Map;for(const B in z)for(const F of z[B])A.set(F.name,F.location);r.set(y,{strides:v,bufferLayouts:u,attributes:A})}return r.get(y)};b.createTexture=function(y,z,u){const v=new x.TextureDescriptor(z.width,z.height);v.dataType=z.dataType;z.depth&&(v.depth=z.depth);z.flipped&&(v.flipped=z.flipped);z.hasMipmap&&(v.hasMipmap=z.hasMipmap);v.internalFormat=z.internalFormat;z.isImmutable&&(v.isImmutable=
z.isImmutable);z.isOpaque&&(v.isOpaque=z.isOpaque);z.maxAnisotropy&&(v.maxAnisotropy=z.maxAnisotropy);v.pixelFormat=z.pixelFormat;z.preMultiplyAlpha&&(v.preMultiplyAlpha=z.preMultiplyAlpha);z.samplingMode&&(v.samplingMode=z.samplingMode);z.target&&(v.target=z.target);v.uniform=z.uniform;z.unpackAlignment&&(v.unpackAlignment=z.unpackAlignment);z.wrapMode&&(v.wrapMode=z.wrapMode);return new h.Texture(y,v,u)};b.discardUrlIfHasUrlHash=function(y){return"url"in y&&"urlHash"in y?{...y,url:""}:y};b.getCapType=
function(y){switch(y){case "butt":return g.CapType.BUTT;case "round":return g.CapType.ROUND;case "square":return g.CapType.SQUARE;default:return t().error(new q("mapview-invalid-type",`Cap type ${y} is not a valid option. Defaulting to round`)),g.CapType.ROUND}};b.getJoinType=function(y){switch(y){case "miter":return g.JoinType.MITER;case "bevel":return g.JoinType.BEVEL;case "round":return g.JoinType.ROUND;default:return t().error(new q("mapview-invalid-type",`Join type ${y} is not a valid option. Defaulting to round`)),
g.JoinType.ROUND}};b.getPixelArrayCtor=function(y){switch(y){case f.PixelType.UNSIGNED_BYTE:return Uint8Array;case f.PixelType.UNSIGNED_SHORT_4_4_4_4:return Uint16Array;case f.PixelType.FLOAT:return Float32Array;default:t().error(new q("webgl-utils",`Unable to handle type ${y}`))}};b.getPixelBytes=function(y){switch(y){case f.PixelType.UNSIGNED_BYTE:return 1;case f.PixelType.UNSIGNED_SHORT_4_4_4_4:return 2;case f.PixelType.FLOAT:return 4;default:t().error(new q("webgl-utils",`Unable to handle type ${y}`))}};
b.isSVGImage=y=>y.includes("data:image/svg+xml");b.isValidSVG=y=>{if(!y)return!1;y=y.trim();return/^[mzlhvcsqta]\s*[-+.0-9][^mlhvzcsqta]+/i.test(y)&&/[\dz]$/i.test(y)&&4<y.length?!0:!1};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/checkWebGLError":function(){define(["exports","../../core/Error","../../core/has","../../core/Logger"],function(b,q,n,g){function k(a,f){switch(f){case a.INVALID_ENUM:return"Invalid Enum. An unacceptable value has been specified for an enumerated argument.";
case a.INVALID_VALUE:return"Invalid Value. A numeric argument is out of range.";case a.INVALID_OPERATION:return"Invalid Operation. The specified command is not allowed for the current state.";case a.INVALID_FRAMEBUFFER_OPERATION:return"Invalid Framebuffer operation. The currently bound framebuffer is not framebuffer complete when trying to render to or to read from it.";case a.OUT_OF_MEMORY:return"Out of memory. Not enough memory is left to execute the command.";case a.CONTEXT_LOST_WEBGL:return"WebGL context has been lost";
default:return"Unknown error"}}const l=!!n("enable-feature:webgl-debug");b.checkWebGLError=function(a){if(l){var f=a.getError();f&&(a=k(a,f),f=Error().stack,g.getLogger("esri.views.webgl.checkWebGLError").error(new q("webgl-error","WebGL error occurred",{message:a,stack:f})))}};b.hasFeatureFlagWebGLDebug=l;b.webglDebugEnabled=function(){return l};b.webglValidateShadersEnabled=function(){return l};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/FramebufferObject":function(){define("exports ../../core/has ../../core/Logger ../../core/maybe ./BufferObject ./checkWebGLError ./enums ./GLObjectType ./Renderbuffer ./Texture".split(" "),
function(b,q,n,g,k,l,a,f,d,c){function e(p){return null!=p&&"type"in p&&p.type===f.GLObjectType.Texture}function h(p,t){const w=Math.max(p.width,p.height);return w>t?(n.getLogger("esri.views.webgl.FramebufferObject").warn(`Resizing FBO attachment size ${p.width}x${p.height} to device limit ${t}`),t/=w,p.width=Math.round(p.width*t),p.height=Math.round(p.height*t),!1):!0}function x(p){return p.descriptor.target===a.TextureType.TEXTURE_CUBE_MAP?a.TextureType.TEXTURE_CUBE_MAP_POSITIVE_X:a.TextureType.TEXTURE_2D}
class m{constructor(p,t,w=null){this._context=p;this._glName=null;this._colorAttachments=new Map;this._depthStencilTexture=this._depthStencilBuffer=null;this._initialized=!1;p.instanceCounter.increment(a.ResourceType.FramebufferObject,this);p=e(t)?t:new c.Texture(this._context,t);this._colorAttachments.set(a.ColorAttachment.COLOR_ATTACHMENT0,p);this._validateTextureDescriptor(p.descriptor);this._validateColorAttachmentPoint(a.ColorAttachment.COLOR_ATTACHMENT0);null!=w&&(e(w)||null!=w&&"pixelFormat"in
w?(this._depthStencilTexture=e(w)?w:new c.Texture(this._context,w),this._validateTextureDescriptor(this._depthStencilTexture.descriptor)):(this._depthStencilBuffer=w=null!=w&&"type"in w&&w.type===f.GLObjectType.RenderBuffer?w:new d.Renderbuffer(this._context,w),this._validateRenderBufferDescriptor(w.descriptor)))}dispose(){if(0!==this._colorAttachments.size||this._glName){var p=this._context.getBoundFramebufferObject();this._colorAttachments.forEach((t,w)=>this.detachColorTexture(w)?.dispose());this.detachDepthStencilBuffer()?.dispose();
this.detachDepthStencilTexture()?.dispose();this._glName&&(this._context.gl.deleteFramebuffer(this._glName),this._glName=null);this._context.bindFramebuffer(p);this._context.instanceCounter.decrement(a.ResourceType.FramebufferObject,this)}}get glName(){return this._glName}get colorTexture(){return this._colorAttachments.get(a.ColorAttachment.COLOR_ATTACHMENT0)}get depthStencil(){return this._depthStencilTexture||this._depthStencilBuffer}get depthStencilTexture(){return this._depthStencilTexture}get width(){return this._colorAttachments.get(a.ColorAttachment.COLOR_ATTACHMENT0)?.descriptor?.width??
0}get height(){return this._colorAttachments.get(a.ColorAttachment.COLOR_ATTACHMENT0)?.descriptor?.height??0}get usedMemory(){return[...this._colorAttachments].reduce((p,[,t])=>p+t.usedMemory,this.depthStencil?.usedMemory??0)}getColorTexture(p){return(p=this._colorAttachments.get(p))&&e(p)?p:null}get colorAttachments(){return[...this._colorAttachments.keys()]}attachColorTexture(p,t=a.ColorAttachment.COLOR_ATTACHMENT0){p&&(this._validateColorAttachmentPoint(t),this._validateTextureDescriptor(p.descriptor),
this.detachColorTexture(t)?.dispose(),this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(p.glName,t)),this._colorAttachments.set(t,p))}detachColorTexture(p=a.ColorAttachment.COLOR_ATTACHMENT0){const t=this._colorAttachments.get(p);if(t){if(this._initialized){const w=this._context.getBoundFramebufferObject();this._context.bindFramebuffer(this);this._framebufferTexture2D(null,p);this._context.bindFramebuffer(w)}this._colorAttachments.delete(p);return t}}setColorTextureTarget(p,
t=a.ColorAttachment.COLOR_ATTACHMENT0){const w=this._colorAttachments.get(t);w&&this._framebufferTexture2D(w.glName,t,p)}attachDepthStencil(p){if(p)switch(p.type){case f.GLObjectType.Texture:return this._attachDepthStencilTexture(p);case f.GLObjectType.RenderBuffer:return this._attachDepthStencilBuffer(p)}}_attachDepthStencilTexture(p){if(null!=p){var t=p.descriptor;t.pixelFormat!==a.PixelFormat.DEPTH_STENCIL&&t.pixelFormat!==a.PixelFormat.DEPTH24_STENCIL8&&console.error("Depth/Stencil texture must have a pixel type of DEPTH_STENCIL!");
t.dataType!==a.PixelType.UNSIGNED_INT_24_8&&console.error("Depth/Stencil texture must have data type of UNSIGNED_INT_24_8!");this._validateTextureDescriptor(t);this._disposeDepthStencilAttachments();this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(p.glName,a.DepthStencilAttachment));this._depthStencilTexture?.dispose();this._depthStencilTexture=p}}detachDepthStencilTexture(){const p=this._depthStencilTexture;if(p&&this._initialized){const t=this._context.getBoundFramebufferObject();
this._context.bindFramebuffer(this);this._framebufferTexture2D(null,a.DepthStencilAttachment);this._context.bindFramebuffer(t)}this._depthStencilTexture=null;return p}_attachDepthStencilBuffer(p){if(null!=p){var t=p.descriptor;this._validateRenderBufferDescriptor(t);this._disposeDepthStencilAttachments();if(this._initialized){this._context.bindFramebuffer(this);const w=this._context.gl;t=this._getGLAttachmentPoint(t);w.framebufferRenderbuffer(a.FramebufferTarget.FRAMEBUFFER,t,w.RENDERBUFFER,p.glName)}this._depthStencilBuffer=
p}}detachDepthStencilBuffer(){const p=this._depthStencilBuffer;if(p&&this._initialized){const t=this._context.getBoundFramebufferObject();this._context.bindFramebuffer(this);const w=this._context.gl,r=this._getGLAttachmentPoint(p.descriptor);w.framebufferRenderbuffer(a.FramebufferTarget.FRAMEBUFFER,r,w.RENDERBUFFER,null);this._context.bindFramebuffer(t)}this._depthStencilBuffer=null;return p}copyToTexture(p,t,w,r,y,z,u){(0>p||0>t||0>y||0>z)&&console.error("Offsets cannot be negative!");(0>=w||0>=
r)&&console.error("Copy width and height must be greater than zero!");var v=u.descriptor;u.descriptor.target!==a.TextureType.TEXTURE_2D&&console.error("Texture target must be TEXTURE_2D!");(null==v?.width||null==v?.height||p+w>this.width||t+r>this.height||y+w>v.width||z+r>v.height)&&console.error("Bad dimensions, the current input values will attempt to read or copy out of bounds!");v=this._context;u=v.bindTexture(u,c.Texture.TEXTURE_UNIT_FOR_UPDATES);v.setActiveTexture(c.Texture.TEXTURE_UNIT_FOR_UPDATES);
v.bindFramebuffer(this);v.gl.copyTexSubImage2D(a.TextureType.TEXTURE_2D,0,y,z,p,t,w,r);v.bindTexture(u,c.Texture.TEXTURE_UNIT_FOR_UPDATES)}readPixels(p,t,w,r,y,z,u){(0>=w||0>=r)&&console.error("Copy width and height must be greater than zero!");u||console.error("Target memory is not initialized!");this._context.bindFramebuffer(this);this._context.gl.readPixels(p,t,w,r,y,z,u)}async readPixelsAsync(p,t,w,r,y,z,u){const {gl:v}=this._context,A=k.BufferObject.createPixelPack(this._context,a.Usage.STREAM_READ,
u.byteLength);this._context.bindBuffer(A);const B=this._context.getBoundFramebufferObject();this._context.bindFramebuffer(this);v.readPixels(p,t,w,r,y,z,0);this._context.unbindBuffer(a.BufferType.PIXEL_PACK_BUFFER);this._context.bindFramebuffer(B);await A.getSubDataAsync(u);A.dispose()}resize(p,t){if(this.width!==p||this.height!==t){var w={width:p,height:t};h(w,this._context.parameters.maxTextureSize);this._colorAttachments.forEach(r=>r.resize(w.width,w.height));this._depthStencilTexture?.resize(w.width,
w.height);this._initialized&&(h(w,this._context.parameters.maxRenderbufferSize),this._depthStencilBuffer?.resize(w.width,w.height),this._context.getBoundFramebufferObject()===this&&this._context.bindFramebuffer(null),this._initialized=!1)}}initializeAndBind(p=a.FramebufferTarget.FRAMEBUFFER){const t=this._context.gl;if(this._initialized)t.bindFramebuffer(p,this.glName);else{this._glName&&t.deleteFramebuffer(this._glName);var w=t.createFramebuffer();t.bindFramebuffer(p,w);this._colorAttachments.forEach((r,
y)=>this._framebufferTexture2D(r.glName,y,x(r),p));if(this._depthStencilBuffer){const r=this._getGLAttachmentPoint(this._depthStencilBuffer.descriptor);t.framebufferRenderbuffer(p,r,t.RENDERBUFFER,this._depthStencilBuffer.glName)}else this._depthStencilTexture&&this._framebufferTexture2D(this._depthStencilTexture.glName,t.DEPTH_STENCIL_ATTACHMENT,x(this._depthStencilTexture),p);l.webglDebugEnabled()&&t.checkFramebufferStatus(p)!==t.FRAMEBUFFER_COMPLETE&&console.error("Framebuffer is incomplete!");
this._glName=w;this._initialized=!0}}_framebufferTexture2D(p,t=a.ColorAttachment.COLOR_ATTACHMENT0,w=a.TextureType.TEXTURE_2D,r=a.FramebufferTarget.FRAMEBUFFER,y=0){this._context.gl.framebufferTexture2D(r,t,w,p,y)}_disposeDepthStencilAttachments(){const p=this._context.gl;if(this._depthStencilBuffer){if(this._initialized){this._context.bindFramebuffer(this);const t=this._getGLAttachmentPoint(this._depthStencilBuffer.descriptor);p.framebufferRenderbuffer(a.FramebufferTarget.FRAMEBUFFER,t,p.RENDERBUFFER,
null)}this._depthStencilBuffer=g.disposeMaybe(this._depthStencilBuffer)}this._depthStencilTexture&&(this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,p.DEPTH_STENCIL_ATTACHMENT)),this._depthStencilTexture=g.disposeMaybe(this._depthStencilTexture))}_validateTextureDescriptor(p){p.target!==a.TextureType.TEXTURE_2D&&p.target!==a.TextureType.TEXTURE_CUBE_MAP&&console.error("Texture type must be TEXTURE_2D or TEXTURE_CUBE_MAP!");h(p,this._context.parameters.maxTextureSize);
this._validateBufferDimensions(p)}_validateRenderBufferDescriptor(p){h(p,this._context.parameters.maxRenderbufferSize);this._validateBufferDimensions(p)}_validateBufferDimensions(p){0>=p.width&&(p.width=this.width);0>=p.height&&(p.height=this.height);0<this.width&&0<this.height&&(this.width!==p.width||this.height!==p.height)&&console.error("Attachment size must match framebuffer size!")}_getGLAttachmentPoint(p){switch(p.internalFormat){case a.RenderbufferFormat.DEPTH_COMPONENT16:case a.RenderbufferFormat.DEPTH_COMPONENT24:case a.RenderbufferFormat.DEPTH_COMPONENT32F:return this._context.gl.DEPTH_ATTACHMENT;
case a.RenderbufferFormat.DEPTH24_STENCIL8:case a.RenderbufferFormat.DEPTH32F_STENCIL8:case a.RenderbufferFormat.DEPTH_STENCIL:return this._context.gl.DEPTH_STENCIL_ATTACHMENT;case a.RenderbufferFormat.STENCIL_INDEX8:return this._context.gl.STENCIL_ATTACHMENT}}_validateColorAttachmentPoint(p){if(-1===m._MAX_COLOR_ATTACHMENTS){const {gl:t}=this._context;m._MAX_COLOR_ATTACHMENTS=t.getParameter(t.MAX_COLOR_ATTACHMENTS)}p-=a.ColorAttachment.COLOR_ATTACHMENT0;p+1>m._MAX_COLOR_ATTACHMENTS&&n.getLogger("esri.views.webgl.FrameBufferObject").error("esri.FrameBufferObject",
`illegal attachment point for color attachment: ${p+1}. Implementation supports up to ${m._MAX_COLOR_ATTACHMENTS} color attachments`)}}m._MAX_COLOR_ATTACHMENTS=-1;b.FramebufferObject=m;b.ensureAttachmentMaxSize=h;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/BufferObject":function(){define("exports ../../core/arrayUtils ../../core/has ../../core/Logger ../../core/typedArrayUtil ./checkWebGLError ./enums".split(" "),function(b,q,n,g,k,l,a){class f{static createIndex(d,
c,e){return new f(d,a.BufferType.ELEMENT_ARRAY_BUFFER,c,e)}static createVertex(d,c,e){return new f(d,a.BufferType.ARRAY_BUFFER,c,e)}static createUniform(d,c,e){return new f(d,a.BufferType.UNIFORM_BUFFER,c,e)}static createPixelPack(d,c=a.Usage.STREAM_READ,e){d=new f(d,a.BufferType.PIXEL_PACK_BUFFER,c);e&&d.setSize(e);return d}static createPixelUnpack(d,c=a.Usage.STREAM_DRAW,e){return new f(d,a.BufferType.PIXEL_UNPACK_BUFFER,c,e)}static createTransformFeedback(d,c=a.Usage.STATIC_DRAW,e){d=new f(d,a.BufferType.TRANSFORM_FEEDBACK_BUFFER,
c);d.setSize(e);return d}constructor(d,c,e,h){this._context=d;this.bufferType=c;this.usage=e;this._glName=null;this._size=-1;this._indexType=void 0;d.instanceCounter.increment(a.ResourceType.BufferObject,this);this._glName=this._context.gl.createBuffer();l.checkWebGLError(this._context.gl);h&&this.setData(h)}get glName(){return this._glName}get size(){return this._size}get indexType(){return this._indexType}get usedMemory(){if(this.bufferType===a.BufferType.ELEMENT_ARRAY_BUFFER){if(this._indexType===
a.DataType.UNSIGNED_INT)return 4*this._size;if(this._indexType===a.DataType.UNSIGNED_SHORT)return 2*this._size}return this._size}get _isVAOAware(){return this.bufferType===a.BufferType.ELEMENT_ARRAY_BUFFER||this.bufferType===a.BufferType.ARRAY_BUFFER}dispose(){this._context?.gl?(this._glName&&(this._context.gl.deleteBuffer(this._glName),this._glName=null),this._context.instanceCounter.decrement(a.ResourceType.BufferObject,this),this._context=null):this._glName&&g.getLogger("esri.views.webgl.BufferObject").warn("Leaked WebGL buffer object")}setSize(d,
c=null){if(this.bufferType===a.BufferType.ELEMENT_ARRAY_BUFFER&&null!=c)switch(this._indexType=c,c){case a.DataType.UNSIGNED_SHORT:d*=2;break;case a.DataType.UNSIGNED_INT:d*=4}this._setBufferData(d)}setData(d){if(d){var c=d.byteLength;this.bufferType===a.BufferType.ELEMENT_ARRAY_BUFFER&&(k.isUint8Array(d)?this._indexType=a.DataType.UNSIGNED_BYTE:k.isUint16Array(d)?(c/=2,this._indexType=a.DataType.UNSIGNED_SHORT):k.isUint32Array(d)&&(c/=4,this._indexType=a.DataType.UNSIGNED_INT));this._setBufferData(c,
d)}}_setBufferData(d,c=null){this._size=d;const e=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null);this._context.bindBuffer(this);const h=this._context.gl;null!=c?h.bufferData(this.bufferType,c,this.usage):h.bufferData(this.bufferType,d,this.usage);l.checkWebGLError(h);this._isVAOAware&&this._context.bindVAO(e)}setSubData(d,c,e,h){if(d){var x=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null);this._context.bindBuffer(this);var {gl:m}=this._context;m.bufferSubData(this.bufferType,
c*d.BYTES_PER_ELEMENT,d,e,h-e);l.checkWebGLError(m);this._isVAOAware&&this._context.bindVAO(x)}}getSubData(d,c=0,e,h){if(!(0>e||0>h)){var x=q.isArrayLike(d)?d.BYTES_PER_ELEMENT:1;x*((e??0)+(h??0))>d.byteLength||(c+x*(h??0)>this.usedMemory&&g.getLogger("esri.views.webgl.BufferObject").warn("Potential problem getting subdata: requested data exceeds buffer size!"),x=this._context.gl,this.bufferType===a.BufferType.TRANSFORM_FEEDBACK_BUFFER?(this._context.bindBuffer(this,a.BufferType.TRANSFORM_FEEDBACK_BUFFER),
x.getBufferSubData(a.BufferType.TRANSFORM_FEEDBACK_BUFFER,c,d,e,h),this._context.unbindBuffer(a.BufferType.TRANSFORM_FEEDBACK_BUFFER)):(this._context.bindBuffer(this,a.BufferType.COPY_READ_BUFFER),x.getBufferSubData(a.BufferType.COPY_READ_BUFFER,c,d,e,h),this._context.unbindBuffer(a.BufferType.COPY_READ_BUFFER)))}}async getSubDataAsync(d,c=0,e,h){await this._context.clientWaitAsync();this.getSubData(d,c,e,h)}}b.BufferObject=f;b.tracer=null;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},
"esri/views/webgl/GLObjectType":function(){define(["exports"],function(b){b.GLObjectType=void 0;var q=b.GLObjectType||(b.GLObjectType={});q[q.Texture=0]="Texture";q[q.RenderBuffer=1]="RenderBuffer";Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/Renderbuffer":function(){define(["exports","./enums","./GLObjectType","./RenderbufferDescriptor"],function(b,q,n,g){class k{constructor(l,a){this._context=l;this._descriptor=a;this.type=n.GLObjectType.RenderBuffer;this._context.instanceCounter.increment(q.ResourceType.Renderbuffer,
this);l=this._context.gl;this.glName=l.createRenderbuffer();this._context.bindRenderbuffer(this);const {width:f,height:d,internalFormat:c,multisampled:e}=a;e?l.renderbufferStorageMultisample(l.RENDERBUFFER,this.samples,c,f,d):l.renderbufferStorage(l.RENDERBUFFER,c,f,d);this._context.bindRenderbuffer(null)}get descriptor(){return this._descriptor}get samples(){const l=this._descriptor.samples,a=this._context.parameters.maxSamples;return l?Math.min(l,a):a}get usedMemory(){return g.estimateMemory(this._descriptor)}resize(l,
a){const f=this._descriptor;if(f.width!==l||f.height!==a)f.width=l,f.height=a,l=this._context.gl,this._context.bindRenderbuffer(this),f.multisampled?l.renderbufferStorageMultisample(l.RENDERBUFFER,this.samples,f.internalFormat,f.width,f.height):l.renderbufferStorage(l.RENDERBUFFER,f.internalFormat,f.width,f.height),this._context.bindRenderbuffer(null)}dispose(){this._context&&(this._context.gl.deleteRenderbuffer(this.glName),this._context.instanceCounter.decrement(q.ResourceType.Renderbuffer,this),
this._context=null)}}b.Renderbuffer=k;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/RenderbufferDescriptor":function(){define(["exports","./Util"],function(b,q){class n{constructor(g,k,l=k){this.internalFormat=g;this.width=k;this.height=l;this.multisampled=!1;this.samples=1}}b.RenderbufferDescriptor=n;b.estimateMemory=function(g){return 0>=g.width||0>=g.height||null==g.internalFormat?0:g.width*g.height*q.getBytesPerElementFormat(g.internalFormat)};Object.defineProperty(b,
Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/Util":function(){define(["exports","../../core/has","./checkWebGLError","./enums","./getDataTypeBytes"],function(b,q,n,g,k){function l(f){f=f.gl;switch(f.getError()){case f.NO_ERROR:return null;case f.INVALID_ENUM:return"An unacceptable value has been specified for an enumerated argument";case f.INVALID_VALUE:return"An unacceptable value has been specified for an argument";case f.INVALID_OPERATION:return"The specified command is not allowed for the current state";
case f.INVALID_FRAMEBUFFER_OPERATION:return"The currently bound framebuffer is not framebuffer complete";case f.OUT_OF_MEMORY:return"Not enough memory is left to execute the command";case f.CONTEXT_LOST_WEBGL:return"WebGL context is lost"}return"Unknown error"}function a(f){return f[0].stride}b.bindVertexBufferLayout=function(f,d,c,e,h=0){const x=f.gl;f.bindBuffer(c);for(const p of e)if(e=d.get(p.name),null==e)console.warn(`There is no location for vertex attribute '${p.name}' defined.`);else{c=h*
p.stride;if(4>=p.count)x.vertexAttribPointer(e,p.count,p.type,p.normalized,p.stride,p.offset+c),x.enableVertexAttribArray(e),0<p.divisor&&f.gl.vertexAttribDivisor(e,p.divisor);else if(9===p.count)for(var m=0;3>m;m++)x.vertexAttribPointer(e+m,3,p.type,p.normalized,p.stride,p.offset+12*m+c),x.enableVertexAttribArray(e+m),0<p.divisor&&f.gl.vertexAttribDivisor(e+m,p.divisor);else if(16===p.count)for(m=0;4>m;m++)x.vertexAttribPointer(e+m,4,p.type,p.normalized,p.stride,p.offset+16*m+c),x.enableVertexAttribArray(e+
m),0<p.divisor&&f.gl?.vertexAttribDivisor(e+m,p.divisor);else console.error("Unsupported vertex attribute element count: "+p.count);if(n.webglDebugEnabled()){e=l(f);m=k.getDataTypeBytes(p.type);const t=p.offset;m=Math.round(m/t)!==m/t?`. Offset not a multiple of stride. DataType requires ${m} bytes, but descriptor has an offset of ${t}`:"";e&&console.error(`Unable to bind vertex attribute "${p.name}" with baseInstanceOffset ${c}${m}:`,e,p)}}};b.getBytesPerElementFormat=function(f){switch(f){case g.PixelFormat.ALPHA:case g.PixelFormat.LUMINANCE:case g.PixelFormat.RED:case g.PixelFormat.RED_INTEGER:case g.SizedPixelFormat.R8:case g.SizedPixelFormat.R8I:case g.SizedPixelFormat.R8UI:case g.SizedPixelFormat.R8_SNORM:case g.RenderbufferFormat.STENCIL_INDEX8:return 1;
case g.PixelFormat.LUMINANCE_ALPHA:case g.PixelFormat.RG:case g.PixelFormat.RG_INTEGER:case g.SizedPixelFormat.RGBA4:case g.SizedPixelFormat.R16F:case g.SizedPixelFormat.R16I:case g.SizedPixelFormat.R16UI:case g.SizedPixelFormat.RG8:case g.SizedPixelFormat.RG8I:case g.SizedPixelFormat.RG8UI:case g.SizedPixelFormat.RG8_SNORM:case g.SizedPixelFormat.RGB565:case g.SizedPixelFormat.RGB5_A1:case g.RenderbufferFormat.DEPTH_COMPONENT16:return 2;case g.PixelFormat.DEPTH_COMPONENT:case g.PixelFormat.RGB:case g.PixelFormat.RGB_INTEGER:case g.SizedPixelFormat.RGB8:case g.SizedPixelFormat.RGB8I:case g.SizedPixelFormat.RGB8UI:case g.SizedPixelFormat.RGB8_SNORM:case g.SizedPixelFormat.SRGB8:case g.RenderbufferFormat.DEPTH_COMPONENT24:return 3;
case g.PixelFormat.DEPTH_STENCIL:case g.PixelFormat.DEPTH24_STENCIL8:case g.PixelFormat.RGBA:case g.PixelFormat.RGBA_INTEGER:case g.SizedPixelFormat.RGBA8:case g.SizedPixelFormat.R32F:case g.SizedPixelFormat.R11F_G11F_B10F:case g.SizedPixelFormat.RG16F:case g.SizedPixelFormat.R32I:case g.SizedPixelFormat.R32UI:case g.SizedPixelFormat.RG16I:case g.SizedPixelFormat.RG16UI:case g.SizedPixelFormat.RGBA8I:case g.SizedPixelFormat.RGBA8UI:case g.SizedPixelFormat.RGBA8_SNORM:case g.SizedPixelFormat.SRGB8_ALPHA8:case g.SizedPixelFormat.RGB9_E5:case g.SizedPixelFormat.RGB10_A2UI:case g.SizedPixelFormat.RGB10_A2:case g.RenderbufferFormat.DEPTH_STENCIL:case g.RenderbufferFormat.DEPTH_COMPONENT32F:case g.RenderbufferFormat.DEPTH24_STENCIL8:return 4;
case g.RenderbufferFormat.DEPTH32F_STENCIL8:return 5;case g.SizedPixelFormat.RGB16F:case g.SizedPixelFormat.RGB16I:case g.SizedPixelFormat.RGB16UI:return 6;case g.SizedPixelFormat.RG32F:case g.SizedPixelFormat.RG32I:case g.SizedPixelFormat.RG32UI:case g.SizedPixelFormat.RGBA16F:case g.SizedPixelFormat.RGBA16I:case g.SizedPixelFormat.RGBA16UI:return 8;case g.SizedPixelFormat.RGB32F:case g.SizedPixelFormat.RGB32I:case g.SizedPixelFormat.RGB32UI:return 12;case g.SizedPixelFormat.RGBA32F:case g.SizedPixelFormat.RGBA32I:case g.SizedPixelFormat.RGBA32UI:return 16;
case g.CompressedTextureFormat.COMPRESSED_RGB_S3TC_DXT1_EXT:case g.CompressedTextureFormat.COMPRESSED_RGBA_S3TC_DXT1_EXT:return.5;case g.CompressedTextureFormat.COMPRESSED_RGBA_S3TC_DXT3_EXT:case g.CompressedTextureFormat.COMPRESSED_RGBA_S3TC_DXT5_EXT:return 1;case g.CompressedTextureFormat.COMPRESSED_R11_EAC:case g.CompressedTextureFormat.COMPRESSED_SIGNED_R11_EAC:case g.CompressedTextureFormat.COMPRESSED_RGB8_ETC2:case g.CompressedTextureFormat.COMPRESSED_SRGB8_ETC2:case g.CompressedTextureFormat.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:case g.CompressedTextureFormat.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:return.5;
case g.CompressedTextureFormat.COMPRESSED_RG11_EAC:case g.CompressedTextureFormat.COMPRESSED_SIGNED_RG11_EAC:case g.CompressedTextureFormat.COMPRESSED_RGBA8_ETC2_EAC:case g.CompressedTextureFormat.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:return 1}return 0};b.getErrorString=l;b.getStride=a;b.unbindVertexBufferLayout=function(f,d,c,e){const h=f.gl;f.bindBuffer(c);for(const x of e)if(c=d.get(x.name),4>=x.count)h.disableVertexAttribArray(c),x.divisor&&0<x.divisor&&f.gl?.vertexAttribDivisor(c,0);else if(9===x.count)for(e=
0;3>e;e++)h.disableVertexAttribArray(c+e),x.divisor&&0<x.divisor&&f.gl?.vertexAttribDivisor(c+e,0);else if(16===x.count)for(e=0;4>e;e++)h.disableVertexAttribArray(c+e),x.divisor&&0<x.divisor&&f.gl?.vertexAttribDivisor(c+e,0);else console.error("Unsupported vertex attribute element count: "+x.count);f.unbindBuffer(g.BufferType.ARRAY_BUFFER)};b.vertexCount=function(f,d){return(f.vertexBuffers.get(d)?.usedMemory??0)/a(f.layout.get(d))};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},
"esri/views/webgl/getDataTypeBytes":function(){define(["exports","./enums"],function(b,q){b.getDataTypeBytes=function(n){switch(n){case q.DataType.BYTE:case q.DataType.UNSIGNED_BYTE:return 1;case q.DataType.SHORT:case q.DataType.UNSIGNED_SHORT:case q.DataType.HALF_FLOAT:return 2;case q.DataType.FLOAT:case q.DataType.INT:case q.DataType.UNSIGNED_INT:return 4}};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/Texture":function(){define("exports ../../core/Error ../../core/has ./checkWebGLError ./enums ./GLObjectType ./TextureDescriptor ./ValidatedTextureDescriptor".split(" "),
function(b,q,n,g,k,l,a,f){function d(w){(null!=w.width&&0>w.width||null!=w.height&&0>w.height||null!=w.depth&&0>w.depth)&&console.error("Negative dimension parameters are not allowed!")}function c(w,r){let y=r.samplingMode,z=r.samplingMode;if(y===k.TextureSamplingMode.LINEAR_MIPMAP_NEAREST||y===k.TextureSamplingMode.LINEAR_MIPMAP_LINEAR)y=k.TextureSamplingMode.LINEAR,r.hasMipmap||(z=k.TextureSamplingMode.LINEAR);else if(y===k.TextureSamplingMode.NEAREST_MIPMAP_NEAREST||y===k.TextureSamplingMode.NEAREST_MIPMAP_LINEAR)y=
k.TextureSamplingMode.NEAREST,r.hasMipmap||(z=k.TextureSamplingMode.NEAREST);w.texParameteri(r.target,w.TEXTURE_MAG_FILTER,y);w.texParameteri(r.target,w.TEXTURE_MIN_FILTER,z)}function e(w,r){"number"===typeof r.wrapMode?(w.texParameteri(r.target,w.TEXTURE_WRAP_S,r.wrapMode),w.texParameteri(r.target,w.TEXTURE_WRAP_T,r.wrapMode)):(w.texParameteri(r.target,w.TEXTURE_WRAP_S,r.wrapMode.s),w.texParameteri(r.target,w.TEXTURE_WRAP_T,r.wrapMode.t))}function h(w,r){const y=w.capabilities.textureFilterAnisotropic;
y&&w.gl.texParameterf(r.target,y.TEXTURE_MAX_ANISOTROPY,r.maxAnisotropy??1)}function x(w){return null!=w&&"type"in w&&"compressed"===w.type}function m(w){return null!=w&&!x(w)&&!(null!=w&&"byteLength"in w)}function p(w){return w===k.TextureType.TEXTURE_3D||w===k.TextureType.TEXTURE_2D_ARRAY}function t(w,r,y,z=1){r=Math.max(r,y);w===k.TextureType.TEXTURE_3D&&(r=Math.max(r,z));return Math.round(Math.log(r)/Math.LN2)+1}n=class w{constructor(r,y=null,z=null){this.type=l.GLObjectType.Texture;this._glName=
null;this._wasImmutablyAllocated=this._wrapModeDirty=this._samplingModeDirty=!1;if("context"in r)this._descriptor=r,z=y;else{r=f.ValidatedTextureDescriptor.validate(r,y);if(!r)throw new q("Texture descriptor invalid");this._descriptor=r}this._descriptor.target===k.TextureType.TEXTURE_CUBE_MAP?this._setDataCubeMap(z):this.setData(z)}get glName(){return this._glName}get descriptor(){return this._descriptor}get usedMemory(){return a.estimateMemory(this._descriptor)}get isDirty(){return this._samplingModeDirty||
this._wrapModeDirty}dispose(){this._glName&&this._descriptor.context.instanceCounter.decrement(k.ResourceType.Texture,this);this._descriptor.context.gl&&this._glName&&(this._descriptor.context.unbindTexture(this),this._descriptor.context.gl.deleteTexture(this._glName),this._glName=null)}release(){this.dispose()}resize(r,y){const z=this._descriptor;if(z.width!==r||z.height!==y){if(this._wasImmutablyAllocated)throw new q("Immutable textures can't be resized!");z.width=r;z.height=y;this._descriptor.target===
k.TextureType.TEXTURE_CUBE_MAP?this._setDataCubeMap(null):this.setData(null)}}_setDataCubeMap(r=null){for(let y=k.TextureType.TEXTURE_CUBE_MAP_POSITIVE_X;y<=k.TextureType.TEXTURE_CUBE_MAP_NEGATIVE_Z;y++)this._setData(r,y)}setData(r){this._setData(r)}_setData(r,y){const z=this._descriptor.context?.gl;if(z){g.checkWebGLError(z);this._glName||(this._glName=z.createTexture())&&this._descriptor.context.instanceCounter.increment(k.ResourceType.Texture,this);var u=this._descriptor,v=y??u.target,A=p(v);y=
this._descriptor.context.bindTexture(this,w.TEXTURE_UNIT_FOR_UPDATES);this._descriptor.context.setActiveTexture(w.TEXTURE_UNIT_FOR_UPDATES);d(u);this._configurePixelStorage();g.checkWebGLError(z);var B=this._deriveInternalFormat();if(m(r)){let F="width"in r?r.width:r.codedWidth,H="height"in r?r.height:r.codedHeight;r instanceof HTMLVideoElement&&(F=r.videoWidth,H=r.videoHeight);u.isImmutable&&!this._wasImmutablyAllocated&&this._texStorage(v,B,u.hasMipmap,F,H,1);this._texImage(v,0,B,F,H,1,r);g.checkWebGLError(z);
u.hasMipmap&&(this.generateMipmap(),g.checkWebGLError(z));u.width||(u.width=F);u.height||(u.height=H);A&&!u.depth&&(u.depth=1)}else{const {width:F,height:H,depth:J}=u;if(null==F||null==H)throw new q("Width and height must be specified!");if(A&&null==J)throw new q("Depth must be specified!");u.isImmutable&&!this._wasImmutablyAllocated&&this._texStorage(v,B,u.hasMipmap,F,H,J);if(x(r)){const E=r.levels;r=t(v,F,H,J);r=Math.min(r-1,E.length-1);z.texParameteri(u.target,this._descriptor.context.gl.TEXTURE_MAX_LEVEL,
r);if(!(B in k.CompressedTextureFormat))throw new q("Attempting to use compressed data with an uncompressed format!");this._forEachMipmapLevel((K,C,D,G)=>{this._compressedTexImage(v,K,B,C,D,G,E[Math.min(K,E.length-1)])},r)}else this._texImage(v,0,B,F,H,J,r),g.checkWebGLError(z),u.hasMipmap&&this.generateMipmap()}c(z,this._descriptor);e(z,this._descriptor);h(this._descriptor.context,this._descriptor);g.checkWebGLError(z);this._descriptor.context.bindTexture(y,w.TEXTURE_UNIT_FOR_UPDATES)}}updateData(r,
y,z,u,v,A,B=0){A||console.error("An attempt to use uninitialized data!");this._glName||console.error("An attempt to update uninitialized texture!");var F=this._descriptor;const H=this._deriveInternalFormat(),{context:J,pixelFormat:E,dataType:K,target:C,isImmutable:D}=F;if(D&&!this._wasImmutablyAllocated)throw new q("Cannot update immutable texture before allocation!");const G=J.bindTexture(this,w.TEXTURE_UNIT_FOR_UPDATES,!0);(0>y||0>z||y+u>F.width||z+v>F.height)&&console.error("An attempt to update out of bounds of the texture!");
this._configurePixelStorage();({gl:F}=J);B&&F.pixelStorei(F.UNPACK_SKIP_ROWS,B);m(A)?F.texSubImage2D(C,r,y,z,u,v,E,K,A):x(A)?F.compressedTexSubImage2D(C,r,y,z,u,v,H,A.levels[r]):F.texSubImage2D(C,r,y,z,u,v,E,K,A);B&&F.pixelStorei(F.UNPACK_SKIP_ROWS,0);J.bindTexture(G,w.TEXTURE_UNIT_FOR_UPDATES)}updateData3D(r,y,z,u,v,A,B,F){F||console.error("An attempt to use uninitialized data!");this._glName||console.error("An attempt to update uninitialized texture!");var H=this._descriptor;const J=this._deriveInternalFormat(),
{context:E,pixelFormat:K,dataType:C,isImmutable:D,target:G}=H;if(D&&!this._wasImmutablyAllocated)throw new q("Cannot update immutable texture before allocation!");p(G)||console.warn("Attempting to set 3D texture data on a non-3D texture");const N=E.bindTexture(this,w.TEXTURE_UNIT_FOR_UPDATES);E.setActiveTexture(w.TEXTURE_UNIT_FOR_UPDATES);(0>y||0>z||0>u||y+v>H.width||z+A>H.height||u+B>H.depth)&&console.error("An attempt to update out of bounds of the texture!");this._configurePixelStorage();({gl:H}=
E);x(F)?(F=F.levels[r],H.compressedTexSubImage3D(G,r,y,z,u,v,A,B,J,F)):H.texSubImage3D(G,r,y,z,u,v,A,B,K,C,F);E.bindTexture(N,w.TEXTURE_UNIT_FOR_UPDATES)}generateMipmap(){const r=this._descriptor;if(!r.hasMipmap){if(this._wasImmutablyAllocated)throw new q("Cannot add mipmaps to immutable texture after allocation");this._samplingModeDirty=r.hasMipmap=!0;d(r)}r.samplingMode===k.TextureSamplingMode.LINEAR?(this._samplingModeDirty=!0,r.samplingMode=k.TextureSamplingMode.LINEAR_MIPMAP_NEAREST):r.samplingMode===
k.TextureSamplingMode.NEAREST&&(this._samplingModeDirty=!0,r.samplingMode=k.TextureSamplingMode.NEAREST_MIPMAP_NEAREST);const y=this._descriptor.context.bindTexture(this,w.TEXTURE_UNIT_FOR_UPDATES);this._descriptor.context.setActiveTexture(w.TEXTURE_UNIT_FOR_UPDATES);this._descriptor.context.gl.generateMipmap(r.target);this._descriptor.context.bindTexture(y,w.TEXTURE_UNIT_FOR_UPDATES)}clearMipmap(){const r=this._descriptor;if(r.hasMipmap){if(this._wasImmutablyAllocated)throw new q("Cannot delete mipmaps to immutable texture after allocation");
r.hasMipmap=!1;this._samplingModeDirty=!0;d(r)}r.samplingMode===k.TextureSamplingMode.LINEAR_MIPMAP_NEAREST?(this._samplingModeDirty=!0,r.samplingMode=k.TextureSamplingMode.LINEAR):r.samplingMode===k.TextureSamplingMode.NEAREST_MIPMAP_NEAREST&&(this._samplingModeDirty=!0,r.samplingMode=k.TextureSamplingMode.NEAREST)}setSamplingMode(r){r!==this._descriptor.samplingMode&&(this._descriptor.samplingMode=r,this._samplingModeDirty=!0)}setWrapMode(r){r!==this._descriptor.wrapMode&&(this._descriptor.wrapMode=
r,d(this._descriptor),this._wrapModeDirty=!0)}applyChanges(){const r=this._descriptor,y=r.context.gl;this._samplingModeDirty&&(c(y,r),this._samplingModeDirty=!1);this._wrapModeDirty&&(e(y,r),this._wrapModeDirty=!1)}_deriveInternalFormat(){if(null!=this._descriptor.internalFormat)return this._descriptor.internalFormat===k.PixelFormat.DEPTH_STENCIL&&(this._descriptor.internalFormat=k.PixelFormat.DEPTH24_STENCIL8),this._descriptor.internalFormat;switch(this._descriptor.dataType){case k.PixelType.FLOAT:switch(this._descriptor.pixelFormat){case k.PixelFormat.RGBA:return this._descriptor.internalFormat=
k.SizedPixelFormat.RGBA32F;case k.PixelFormat.RGB:return this._descriptor.internalFormat=k.SizedPixelFormat.RGB32F;default:throw new q("Unable to derive format");}case k.PixelType.UNSIGNED_BYTE:switch(this._descriptor.pixelFormat){case k.PixelFormat.RGBA:return this._descriptor.internalFormat=k.SizedPixelFormat.RGBA8;case k.PixelFormat.RGB:return this._descriptor.internalFormat=k.SizedPixelFormat.RGB8}}return this._descriptor.internalFormat=this._descriptor.pixelFormat===k.PixelFormat.DEPTH_STENCIL?
k.PixelFormat.DEPTH24_STENCIL8:this._descriptor.pixelFormat}_configurePixelStorage(){const r=this._descriptor.context.gl,{unpackAlignment:y,flipped:z,preMultiplyAlpha:u}=this._descriptor;r.pixelStorei(r.UNPACK_ALIGNMENT,y);r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,z?1:0);r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,u?1:0)}_texStorage(r,y,z,u,v,A){const {gl:B}=this._descriptor.context;if(!(y in k.SizedPixelFormat))throw new q("Immutable textures must have a sized internal format");if(this._descriptor.isImmutable){z=
z?t(r,u,v,A):1;if(p(r)){if(null==A)throw new q("Missing depth dimension for 3D texture upload");B.texStorage3D(r,z,y,u,v,A)}else B.texStorage2D(r,z,y,u,v);this._wasImmutablyAllocated=!0}}_texImage(r,y,z,u,v,A,B){const F=this._descriptor.context.gl,H=p(r),{isImmutable:J,pixelFormat:E,dataType:K}=this._descriptor;if(J){if(null!=B)if(H){if(null==A)throw new q("Missing depth dimension for 3D texture upload");F.texSubImage3D(r,y,0,0,0,u,v,A,E,K,B)}else F.texSubImage2D(r,y,0,0,u,v,E,K,B)}else if(H){if(null==
A)throw new q("Missing depth dimension for 3D texture upload");F.texImage3D(r,y,z,u,v,A,0,E,K,B)}else F.texImage2D(r,y,z,u,v,0,E,K,B)}_compressedTexImage(r,y,z,u,v,A,B){const F=this._descriptor.context.gl,H=p(r);if(this._descriptor.isImmutable){if(null!=B)if(H){if(null==A)throw new q("Missing depth dimension for 3D texture upload");F.compressedTexSubImage3D(r,y,0,0,0,u,v,A,z,B)}else F.compressedTexSubImage2D(r,y,0,0,u,v,z,B)}else if(H){if(null==A)throw new q("Missing depth dimension for 3D texture upload");
F.compressedTexImage3D(r,y,z,u,v,A,0,B)}else F.compressedTexImage2D(r,y,z,u,v,0,B)}_forEachMipmapLevel(r,y=Infinity){let {width:z,height:u,depth:v,hasMipmap:A,target:B}=this._descriptor;const F=B===k.TextureType.TEXTURE_3D;if(null==z||null==u||F&&null==v)throw new q("Missing texture dimensions for mipmap calculation");for(let H=0;;++H){r(H,z,u,v);if(!A||1===z&&1===u&&(!F||1===v)||H>=y)break;z=Math.max(1,z>>1);u=Math.max(1,u>>1);F&&(v=Math.max(1,v>>1))}}};n.TEXTURE_UNIT_FOR_UPDATES=0;b.Texture=n;b.tracer=
null;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/TextureDescriptor":function(){define(["exports","./enums","./Util"],function(b,q,n){class g{constructor(k=0,l=k){this.width=k;this.height=l;this.target=q.TextureType.TEXTURE_2D;this.pixelFormat=q.PixelFormat.RGBA;this.dataType=q.PixelType.UNSIGNED_BYTE;this.samplingMode=q.TextureSamplingMode.LINEAR;this.wrapMode=q.TextureWrapMode.REPEAT;this.maxAnisotropy=1;this.isOpaque=this.hasMipmap=this.flipped=!1;this.unpackAlignment=
4;this.preMultiplyAlpha=!1;this.depth=1;this.isImmutable=!1}}b.TextureDescriptor=g;b.estimateMemory=function(k){return 0>=k.width||0>=k.height?0:Math.round(k.width*k.height*(k.hasMipmap?4/3:1)*(null==k.internalFormat?4:n.getBytesPerElementFormat(k.internalFormat))*(k.target===q.TextureType.TEXTURE_CUBE_MAP?6:1))};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/ValidatedTextureDescriptor":function(){define(["exports","./enums","./TextureDescriptor"],function(b,q,n){class g extends n.TextureDescriptor{constructor(k,
l){super();this.context=k;Object.assign(this,l);switch(this.internalFormat){case q.SizedPixelFormat.R16F:case q.SizedPixelFormat.R16I:case q.SizedPixelFormat.R16UI:case q.SizedPixelFormat.R32F:case q.SizedPixelFormat.R32I:case q.SizedPixelFormat.R32UI:case q.SizedPixelFormat.R8_SNORM:case q.SizedPixelFormat.R8:case q.SizedPixelFormat.R8I:case q.SizedPixelFormat.R8UI:this.pixelFormat=q.PixelFormat.RED}}static validate(k,l){return new g(k,l)}}b.ValidatedTextureDescriptor=g;Object.defineProperty(b,Symbol.toStringTag,
{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/mesh/AResourceProxy":function(){define(["exports"],function(b){class q{}b.AResourceProxy=q;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/mesh/MeshWriterRegistry":function(){define("exports ../TechniqueType ../animated/AnimatedMarkerMeshWriter ../dotDensity/DotDensityMeshWriter ../fill/ComplexFillMeshWriter ../fill/ComplexOutlineFillMeshWriter ../fill/FillMeshWriter ../fill/OutlineFillMeshWriter ../fill/PatternFillMeshWriter ../fill/PatternOutlineFillMeshWriter ../heatmap/HeatmapMeshWriter ../labels/LabelMeshWriter ../line/LineMeshWriter ../line/TexturedLineMeshWriter ../markers/MarkerMeshWriter ./MeshWriterInputEvaluator ../pieChart/PieChartMeshWriter ../text/TextMeshWriter".split(" "),
function(b,q,n,g,k,l,a,f,d,c,e,h,x,m,p,t,w,r){class y{async createMeshWriter(z,u,v,A){const B=this._getMeshWriter(A.techniqueType);z=await t.MeshWriterInputEvaluator.create(z,u,A.inputParams);v=new B(A.id,z,A.optionalAttributes,v);await v.loadDependencies();return v}_getMeshWriter(z){switch(z){case q.TechniqueType.Fill:return a.FillMeshWriter;case q.TechniqueType.DotDensity:return g.DotDensityMeshWriter;case q.TechniqueType.ComplexFill:return k.ComplexFillMeshWriter;case q.TechniqueType.PatternFill:return d.PatternFillMeshWriter;
case q.TechniqueType.OutlineFill:return f.OutlineFillMeshWriter;case q.TechniqueType.PatternOutlineFill:return c.PatternOutlineFillMeshWriter;case q.TechniqueType.ComplexOutlineFill:return l.ComplexOutlineFillMeshWriter;case q.TechniqueType.Marker:return p.MarkerMeshWriter;case q.TechniqueType.PieChart:return w.PieChartMeshWriter;case q.TechniqueType.Text:return r.TextMeshWriter;case q.TechniqueType.Line:return x.LineMeshWriter;case q.TechniqueType.TexturedLine:return m.TexturedLineMeshWriter;case q.TechniqueType.Heatmap:return e.HeatmapMeshWriter;
case q.TechniqueType.Label:return h.LabelMeshWriter;case q.TechniqueType.AnimatedMarker:return n.AnimatedMarkerMeshWriter;default:throw Error("Internal Error: Mesh writer not in the registry");}}}b.MeshWriterRegistry=y;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/TechniqueType":function(){define(["exports"],function(b){b.TechniqueType=void 0;var q=b.TechniqueType||(b.TechniqueType={});q[q.AnimatedMarker=0]="AnimatedMarker";q[q.Blend=
1]="Blend";q[q.ComplexFill=2]="ComplexFill";q[q.ComplexOutlineFill=3]="ComplexOutlineFill";q[q.DotDensity=4]="DotDensity";q[q.Fill=5]="Fill";q[q.Grid=6]="Grid";q[q.Heatmap=7]="Heatmap";q[q.Label=8]="Label";q[q.Line=9]="Line";q[q.Magnifier=10]="Magnifier";q[q.Marker=11]="Marker";q[q.OutlineFill=12]="OutlineFill";q[q.Overlay=13]="Overlay";q[q.PatternFill=14]="PatternFill";q[q.PatternOutlineFill=15]="PatternOutlineFill";q[q.PieChart=16]="PieChart";q[q.Test=17]="Test";q[q.Text=18]="Text";q[q.TexturedLine=
19]="TexturedLine";Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/animated/AnimatedMarkerMeshWriter":function(){define("exports ../../../../../../../core/screenUtils ../../../definitions ./AnimatedMeshWriter ../fill/meshWriterUtils ../shaders/constants ../../../../../../webgl/enums".split(" "),function(b,q,n,g,k,l,a){class f extends g.AAnimatedMeshWriter{get vertexSpec(){return{createComputedParams:d=>{let {pixelDimensions:c,texelDimensions:e,
baseSize:h,referenceSize:x,strokeWidth:m,sizeRatio:p}=d;c||=d.sprite.sdf?[0,0]:[d.sprite.width,d.sprite.height];e||=d.sprite.sdf?[0,0]:c;h=q.pt2px(h);x=q.pt2px(x);m=q.pt2px(m);return{...d,pixelDimensions:c,texelDimensions:e,baseSize:h,referenceSize:x,strokeWidth:m,sdfDecodeCoeff:(d.sprite.sdfDecodeCoeff??1)*p}},optionalAttributes:{zoomRange:{type:a.DataType.SHORT,count:2,packPrecisionFactor:n.minMaxZoomPrecisionFactor,pack:({scaleInfo:d},{tileInfo:c})=>k.getMinMaxZoom(d,c)}},attributes:{id:{type:a.DataType.UNSIGNED_BYTE,
count:3,pack:"id"},bitset:{type:a.DataType.UNSIGNED_BYTE,count:1,pack:g.packAnimatedBitset},pos:{type:a.DataType.SHORT,count:2,pack:"position",packPrecisionFactor:1},offset:{type:a.DataType.FLOAT,count:2,packAlternating:{count:4,pack:d=>{d=d.texelDimensions;return[[-.5*d[0],-.5*d[1]],[.5*d[0],-.5*d[1]],[-.5*d[0],.5*d[1]],[.5*d[0],.5*d[1]]]}}},uv:{type:a.DataType.SHORT,count:2,packPrecisionFactor:1,packAlternating:{count:4,packTessellation:({texXmax:d,texXmin:c,texYmax:e,texYmin:h})=>[[c,h],[d,h],
[c,e],[d,e]]}},animationPointerAndBaseSizeAndReferenceSize:{type:a.DataType.UNSIGNED_SHORT,count:4,packPrecisionFactor:1,pack:({animations:d,baseSize:c,referenceSize:e})=>[d.dataColumn,d.dataRow,c,e]},sizing:{type:a.DataType.UNSIGNED_SHORT,count:4,packPrecisionFactor:8,pack:({strokeWidth:d,pixelDimensions:c,baseSize:e,sprite:h,sizeRatio:x})=>[c[0],c[1],d,h.sdfDecodeCoeff*Math.max(e*h.width/h.height,e)*x]},angle:{type:a.DataType.BYTE,count:1,packTessellation:({angle:d})=>d}}}}_write(d,c){var {textureBinding:e}=
this.evaluatedMeshParams.sprite;d.recordStart(this.instanceId,this.attributeLayout,e);const h=c.getDisplayId();if("esriGeometryPolygon"===c.geometryType){c=c.readCentroidForDisplay();if(!c)return;const [x,m]=c.coords;this._writeQuad(d,h,x,m)}else if("esriGeometryPoint"===c.geometryType)e=c.readXForDisplay(),c=c.readYForDisplay(),this._writeQuad(d,h,e,c);else if(c=c.readGeometryForDisplay())if({angleToLine:e}=this.evaluatedMeshParams,e){let x=!0,m=null,p=null;c.forEachVertex((t,w)=>{if(null!=m&&null!=
p){const r=Math.atan2(w-p,t-m)/l.c256ToRad;x&&(this._writeQuad(d,h,m,p,r),x=!1);this._writeQuad(d,h,t,w,r)}m=t;p=w})}else c.forEachVertex((x,m)=>{this._writeQuad(d,h,x,m)});d.recordEnd()}_writeQuad(d,c,e,h,x=0){var {rect:m}=this.evaluatedMeshParams.sprite,p=m.x+2;const t=m.y+2,w=m.x+m.width-2,r=m.y+m.height-2;m=d.vertexCount();d.recordBounds(e,h,64,64);x={texXmin:p,texYmin:t,texXmax:w,texYmax:r,angle:x};for(p=0;4>p;p++)this._writeVertex(d,c,e,h,x);d.indexEnsureSize(6);d.indexWrite(m);d.indexWrite(m+
1);d.indexWrite(m+2);d.indexWrite(m+1);d.indexWrite(m+3);d.indexWrite(m+2)}}b.AnimatedMarkerMeshWriter=f;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/animated/AnimatedMeshWriter":function(){define(["exports","../fill/meshWriterUtils","../markers/markerConstants","../mesh/MeshWriter"],function(b,q,n,g){class k extends g.MeshWriter{}b.AAnimatedMeshWriter=k;b.packAnimatedBitset=function(l){const {sprite:a,isMapAligned:f,colorLocked:d,
scaleSymbolsProportionally:c,isStroke:e}=l;l=0;f&&(l|=q.getBitMask(n.MarkerConstants.bitset.isMapAligned));d&&(l|=q.getBitMask(n.MarkerConstants.bitset.colorLocked));a.sdf&&(l|=q.getBitMask(n.MarkerConstants.bitset.isSDF));c&&(l|=q.getBitMask(n.MarkerConstants.bitset.scaleSymbolsProportionally));e&&(l|=q.getBitMask(n.MarkerConstants.bitset.isStroke));return l};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/fill/meshWriterUtils":function(){define(["exports",
"../../../../../../../Color","../../../../../../../core/Error","../../../../../../../core/Logger","../../../../../../../symbols/cim/enums"],function(b,q,n,g,k){b.getBitMask=function(l){return 1<<l};b.getMinMaxZoom=function(l,a){const f=!!l?.minScale&&a.scaleToZoom(l.minScale)||0;l=!!l?.maxScale&&a.scaleToZoom(l.maxScale)||100;return[f,l]};b.packBitset=function(l){let a=0;for(const [f,d]of l)d&&(a|=1<<f);return a};b.packByteSqrt=function(l,a){return Math.round(Math.min(Math.sqrt(l*a),255))};b.packRounded=
function(l,a){return Math.round(l*a)/a};b.processColorInput=function(l){if(!l)return[0,0,0,0];if("string"===typeof l){const e=q.fromString(l);if(!e)return g.getLogger("esri.views.2d.engine.webgl.shaderGraph.techniques.meshWriterUtils").errorOnce(new n("mapview:mesh-processing","Unable to parse string into color",{color:l})),[0,0,0,0];l=e.toArray()}const [a,f,d,c]=l;return[c/255*a,c/255*f,c/255*d,c]};b.processLineCapInput=function(l){switch(l){case "butt":case k.LineCapStyle.Butt:return k.CapType.BUTT;
case "round":case k.LineCapStyle.Round:return k.CapType.ROUND;case "square":case k.LineCapStyle.Square:return k.CapType.SQUARE}};b.processLineJoinInput=function(l){switch(l){case "bevel":case k.LineJoinStyle.Bevel:return k.JoinType.BEVEL;case "miter":case k.LineJoinStyle.Miter:return k.JoinType.MITER;case "round":case k.LineJoinStyle.Round:return k.JoinType.ROUND}};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/markers/markerConstants":function(){define(["exports"],
function(b){b.MarkerConstants={bitset:{isSDF:0,isMapAligned:1,scaleSymbolsProportionally:2,overrideOutlineColor:3,colorLocked:4,isStroke:5}};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/mesh/MeshWriter":function(){define(["exports","../../../../../../../geometry/GeometryCursor","../../../../../../../symbols/cim/effects/CIMEffectHelper","./loadGeometryEngine","./MeshWriterVertexPack"],function(b,q,n,g,k){class l{constructor(a,f,
d,c){this._instanceId=a;this._evaluator=f;this._enabledOptionalAttributes=d;this._viewParams=c;this._evaluator.evaluator=e=>this.vertexSpec.createComputedParams(e)}get _vertexPack(){if(!this._cachedVertexPack){const a=k.MeshWriterVertexPack.fromVertexSpec(this.vertexSpec,this._enabledOptionalAttributes);this._evaluator.hasDynamicProperties||a.pack(this._evaluator.evaluatedMeshParams,this._viewParams);this._cachedVertexPack=a}return this._cachedVertexPack}get evaluatedMeshParams(){return this._evaluator.evaluatedMeshParams}get hasEffects(){return!!this.evaluatedMeshParams.effects}get instanceId(){return this._instanceId}get attributeLayout(){return this._vertexPack.attributeLayout}setReferences(a){this._references=
a}getBoundsInfo(){return null}getTileInfo(){return this._viewParams.tileInfo}async loadDependencies(){var a;a:{if(a=this._evaluator.inputMeshParams.effects?.effectInfos)for(const f of a)switch(f.effect.type){case "CIMGeometricEffectBuffer":case "CIMGeometricEffectOffset":case "CIMGeometricEffectDonut":a=!0;break a}a=!1}a&&await g.loadGeometryEngine()}enqueueRequest(a,f,d){this._evaluator.hasDynamicProperties&&this._evaluator.enqueueRequest(a,f,d)}write(a,f,d,c,e){this.ensurePacked(f,d,c);if((f=this.evaluatedMeshParams.effects)&&
0!==f.length){if(c=d.readGeometryForDisplay()?.clone()){c=q.GeometryCursor.fromOptimizedCIM(c,d.geometryType);var h=g.getGeometryEngine();c.invertY();for(f=n.CIMEffectHelper.executeEffects(f,c,a.id||"",h);c=f.next();)c.invertY(),this._write(a,d,c,e)}}else this._write(a,d,void 0,e)}ensurePacked(a,f,d){this._evaluator.hasDynamicProperties&&(a=this._evaluator.evaluateMeshParams(a,f,d),this._vertexPack.pack(a,this._viewParams))}_writeVertex(a,f,d,c,e){this._vertexPack.writeVertex(a,f,d,c,this.evaluatedMeshParams,
e)}}b.MeshWriter=l;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/GeometryCursor":function(){define(["exports","../core/lang","./geometryCursorCollectUtils","./support/jsonUtils","../layers/graphics/OptimizedGeometry"],function(b,q,n,g,k){function l(h){if(g.isPolygon(h))h=[h.rings,"esriGeometryPolygon"];else if(g.isPolyline(h))h=[h.paths,"esriGeometryPolyline"];else if(g.isMultipoint(h))h=[[h.points],"esriGeometryMultipoint"];else if(g.isExtent(h))h=[[[[h.xmin,h.ymin],
[h.xmin,h.ymax],[h.xmax,h.ymax],[h.xmax,h.ymin],[h.xmin,h.ymin]]],"esriGeometryEnvelope"];else if(g.isPoint(h)){const x=[h.x,h.y];h.z&&x.push(h.z);h.m&&x.push(h.m);h=[[[x]],"esriGeometryPoint"]}else h=[[],"esriGeometryPolyline"];return h}class a{static fromOptimized(h,x,m=!1,p=!1,t=1){return(new f).initialize(h,x,m,p,t)}static fromJSON(h,x=!1,m=!1){const [p,t]=l(h);return(new d).initialize(p,t,x,m,1)}static fromOptimizedCIM(h,x,m=!1,p=!1,t=1){return(new c).initialize(h,x,m,p,t)}static fromJSONCIM(h,
x=!1,m=!1,p=1){const [t,w]=l(h);return(new e).initialize(t,w,x,m,p)}static fromFeatureSetReader(h){const x=h.readGeometryForDisplay();h=h.geometryType;return x&&h?this.fromOptimized(x,h):null}static fromFeatureSetReaderCIM(h){const x=h.readGeometryForDisplay();h=h.geometryType;return x&&h?this.fromOptimizedCIM(x,h):null}static createEmptyOptimized(h,x=!1,m=!1,p=1){return(new f).initialize(new k,h,x,m,p)}static createEmptyJSON(h,x=!1,m=!1){return(new d).initialize([],h,x,m,1)}static createEmptyOptimizedCIM(h,
x=!1,m=!1,p=1){return(new c).initialize(new k,h,x,m,p)}static createEmptyJSONCIM(h,x=!1,m=!1,p=1){return(new e).initialize([],h,x,m,p)}asJSON(){const h=n.collectMultipath(this);return"esriGeometryEnvelope"===this.geometryType?{xmin:h[0][0][0],ymin:h[0][0][1],xmax:h[0][2][0],ymax:h[0][2][1]}:"esriGeometryMultipoint"===this.geometryType?{points:h.flat()}:"esriGeometryPoint"===this.geometryType?{x:h[0][0][0],y:h[0][0][1]}:"esriGeometryPolygon"===this.geometryType?{rings:h}:{paths:h}}getCurrentRingArea(){if(3>
this.pathSize)return 0;let h=0,x,m;this.seekPathStart();if(!this.nextPoint())return 0;x=this.x;m=this.y;const p=x,t=m;for(;this.nextPoint();)h+=(x-this.x)*(m+this.y),x=this.x,m=this.y;return-.5*(h+(x-p)*(m+t))}invertY(){this.yFactor*=-1}}class f extends a{constructor(){super(...arguments);this._end=-1}initialize(h,x,m,p,t){this.hasZ=m;this.hasM=p;this.geometryType=x;this._stride=2+Number(m)+Number(p);this._geometry=h;this._pathIndex=-1;this._pathOffset=0;this._pointOffset=-this._stride;this._end=
-1;this.yFactor=t;return this}reset(){this.initialize(this._geometry,this.geometryType,this.hasZ,this.hasM,this.yFactor)}seekPath(h){if(0<=h&&h<this.totalSize){if(this._pathIndex<h)for(;this._pathIndex<h&&this.nextPath(););else if(this._pathIndex>h)for(;this._pathIndex>h&&this.prevPath(););return!0}return!1}seekPathStart(){this._pointOffset=this._pathOffset-this._stride}seekPathEnd(){this._pointOffset=this._end}seekInPath(h){h=this._pathOffset+h*this._stride;return 0<=h&&h<this._end?(this._pointOffset=
h,!0):!1}nextPoint(){return(this._pointOffset+=this._stride)<this._end}prevPoint(){return(this._pointOffset-=this._stride)>=this._pathOffset}nextPath(){if(this.pathIndex>=this.totalSize-1)return!1;0<=this._pathIndex&&(this._pathOffset+=this._stride*this.pathSize);this._pathIndex++;this._pointOffset=this._pathOffset-this._stride;this._end=this._pointOffset+this._stride+this._stride*this.pathSize;return!0}prevPath(){if(0>=this.pathIndex)return!1;this._pathIndex--;this._end=this._pathOffset;this._pathOffset-=
this._stride*this.pathSize;this._pointOffset=this._pathOffset-this._stride;return!0}getCurrentPath(){const h=this._end,x=this._geometry.coords,m=this._pathOffset;return(new f).initialize(new k([this.pathSize],x.slice(m,h)),this.geometryType,this.hasZ,this.hasM,this.yFactor)}pathLength(){const h=this._end,x=this._stride,m=this._geometry.coords;let p=0;for(let t=this._pathOffset+x;t<h;t+=x){const w=m[t]-m[t-x],r=m[t+1]-m[t-x+1];p+=Math.sqrt(w*w+r*r)}return p}startPath(){this._geometry.lengths.push(0)}pushPath(h){this.startPath();
this.pushPoints(h)}pushPoint(h){for(let x=0;x<this._stride;++x)this._geometry.coords.push(h[x]);this._geometry.lengths[this.totalSize-1]++}pushXY(h,x){this._geometry.coords.push(h,x);this._geometry.lengths[this.totalSize-1]++}pushPoints(h){for(const x of h)for(let m=0;m<this._stride;++m)this._geometry.coords.push(x[m]);this._geometry.lengths[this.totalSize-1]+=h.length}pushCursor(h){h=h.asOptimized();this._geometry.coords.push(...h.coords);this._geometry.lengths.push(...h.lengths)}asOptimized(){const h=
this._geometry.clone();if(1!==this.yFactor)for(let x=1;x<h.coords.length;x+=this._stride)h.coords[x]*=this.yFactor;"esriGeometryPoint"===this.geometryType&&(h.lengths.length=0);return h}isClosed(){const h=this._geometry.coords,x=this._pathOffset,m=this._end-this._stride;for(let p=0;p<this._stride;p++)if(h[x+p]!==h[m+p])return!1;return!0}clone(){return(new f).initialize(this._geometry.clone(),this.geometryType,this.hasZ,this.hasM,this.yFactor)}get totalPoints(){return this._geometry.isPoint?1:this._geometry.lengths.reduce((h,
x)=>h+x)}get pathSize(){const {lengths:h}=this._geometry;return this._geometry.isPoint?1:0>this._pathIndex||this._pathIndex>h.length-1?0:h[this._pathIndex]}get totalSize(){return this._geometry.isPoint?1:this._geometry.lengths.length}get x(){return this._geometry.coords[this._pointOffset]}set x(h){this._geometry.coords[this._pointOffset]=h}get y(){return this.yFactor*this._geometry.coords[this._pointOffset+1]}set y(h){this._geometry.coords[this._pointOffset+1]=this.yFactor*h}get z(){return this._geometry.coords[this._pointOffset+
2]}set z(h){this._geometry.coords[this._pointOffset+2]=h}get m(){return this._geometry.coords[this._pointOffset+(this.hasZ?3:2)]}set m(h){this._geometry.coords[this._pointOffset+3]=h}get pathIndex(){return this._pathIndex}get _coordIndex(){return this._pointOffset/this._stride}}class d extends a{initialize(h,x,m,p,t){this._paths=h;this.geometryType=x;this.hasZ=m;this.hasM=p;this._pathIndex=this._pointIndex=-1;this.yFactor=t;this._mIndex=this.hasZ?3:2;return this}reset(){this._pathIndex=this._pointIndex=
-1}seekPath(h){this._pathIndex=h;this._pointIndex=-1;return 0<=h&&h<this.totalSize?(this._currentPath=this._paths[h],!0):!1}seekPathStart(){this._pointIndex=-1}seekPathEnd(){this._pointIndex=this._currentPath.length}seekInPath(h){return 0<=h&&h<this._currentPath.length?(this._pointIndex=h,this._currentPoint=this._currentPath[this._pointIndex],!0):!1}nextPoint(){this._currentPoint=this._currentPath[++this._pointIndex];return this._pointIndex<this._currentPath.length}prevPoint(){this._currentPoint=
this._currentPath[--this._pointIndex];return 0<=this._pointIndex}nextPath(){this._pointIndex=-1;this._currentPath=this._paths[++this._pathIndex];return this._pathIndex<this.totalSize}prevPath(){return 0<this.pathIndex?(this._pointIndex=-1,this._pathIndex--,this._currentPath=this._paths[this._pathIndex],!0):!1}pathLength(){const h=this._currentPath.length,x=this._currentPath;let m=0;for(let t=1;t<h;t++){var p=x[t-1];const w=x[t],r=w[0]-p[0];p=w[1]-p[1];m+=Math.sqrt(r*r+p*p)}return m}startPath(){this._paths.push([])}getCurrentPath(){return(new d).initialize([this._currentPath],
this.geometryType,this.hasZ,this.hasM,this.yFactor)}pushPath(h){this._paths.push(h)}pushPoint(h){this._paths[this.totalSize-1].push(h)}pushXY(h,x){this._paths[this.totalSize-1].push([h,x])}pushPoints(h){this._paths[this.totalSize-1].push(...h)}pushCursor(h){h=n.collectMultipath(h);for(const x of h)this.pushPath(x)}asOptimized(){const h=new k;if("esriGeometryPoint"===this.geometryType)h.coords.push(...this._paths[0][0]),h.lengths.length=0;else for(const x of this._paths){for(const m of x)h.coords.push(m[0]),
h.coords.push(m[1]*this.yFactor),this.hasZ&&h.coords.push(m[2]),this.hasM&&h.coords.push(m[this._mIndex]);h.lengths.push(x.length)}return h}isClosed(){const h=this._currentPath[0],x=this._currentPath[this._currentPath.length-1];for(let m=0;m<h.length;m++)if(h[m]!==x[m])return!1;return!0}clone(){return(new d).initialize(q.clone(this._paths),this.geometryType,this.hasZ,this.hasM,this.yFactor)}get totalPoints(){return this._paths.map(h=>h.length).reduce((h,x)=>h+x)}get pathSize(){return 0>this._pathIndex||
this._pathIndex>this.totalSize-1?-1:this._paths[this._pathIndex].length}get totalSize(){return this._paths.length}get x(){return this._currentPoint[0]}set x(h){this._currentPoint[0]=h}get y(){return this.yFactor*this._currentPoint[1]}set y(h){this._currentPoint[1]=this.yFactor*h}get z(){return this._currentPoint[2]}set z(h){this._currentPoint[2]=h}get m(){return this._currentPoint[this._mIndex]}set m(h){this._currentPoint[this._mIndex]=h}get pathIndex(){return this._pathIndex}}class c extends f{initialize(h,
x,m,p,t){super.initialize(h,x,m,p,t);this._controlPoints||(this._controlPoints=this._controlPoints=Array(this.totalSize).fill(void 0).map(w=>new Set));return this}startPath(){super.startPath();this._controlPoints.push(new Set)}clone(){const h=(new c).initialize(this._geometry.clone(),this.geometryType,this.hasZ,this.hasM,this.yFactor);h._controlPoints=this._controlPoints;return h}setControlPoint(){this._controlPoints[this.pathIndex].add(this._coordIndex)}getControlPoint(){return this._controlPoints[this.pathIndex].has(this._coordIndex)}setControlPointAt(h){this._controlPoints[this.pathIndex].add(h)}getControlPointAt(h){return this._controlPoints[this.pathIndex].has(h)}}
class e extends d{initialize(h,x,m,p,t){return super.initialize(h,x,m,p,t)}clone(){return(new e).initialize(q.clone(this._paths),this.geometryType,this.hasZ,this.hasM,this.yFactor)}setControlPoint(){this._paths[this.pathIndex][this._pointIndex][4]=1}getControlPoint(){return 1===this._paths[this.pathIndex][this._pointIndex][4]}setControlPointAt(h){this._paths[this.pathIndex][h][4]=1}getControlPointAt(h){return 1===this._paths[this.pathIndex][h][4]}}b.GeometryCursor=a;Object.defineProperty(b,Symbol.toStringTag,
{value:"Module"})})},"esri/layers/graphics/OptimizedGeometry":function(){define(function(){class b{constructor(q=[],n=[]){this.lengths=q??[];this.coords=n??[]}static fromJSON(q){return new b(q.lengths,q.coords)}static fromRect(q){const [n,g,k,l]=q;q=k-n;const a=l-g;return new b([5],[n,g,q,0,0,a,-q,0,0,-a])}get isPoint(){return 0===this.lengths.length&&2<=this.coords.length}get maxLength(){return Math.max(...this.lengths)}get size(){return this.lengths.reduce((q,n)=>q+n)}forEachVertex(q){let n=0;this.lengths.length||
q(this.coords[0],this.coords[1]);for(let g=0;g<this.lengths.length;g++){const k=this.lengths[g];for(let l=0;l<k;l++)q(this.coords[2*(l+n)],this.coords[2*(l+n)+1]);n+=k}}deltaDecode(){const q=this.clone(),{coords:n,lengths:g}=q;let k=0;for(const l of g){for(let a=1;a<l;a++)n[2*(k+a)]+=n[2*(k+a)-2],n[2*(k+a)+1]+=n[2*(k+a)-1];k+=l}return q}clone(q){if(0===this.lengths.length)return new b([],[this.coords[0],this.coords[1]]);var n=2*(0===this.lengths.length?1:this.lengths.reduce((g,k)=>g+k));n=this.coords.slice(0,
n);return q?(q.set(n),new b(this.lengths,q)):new b(Array.from(this.lengths),Array.from(n))}}return b})},"esri/symbols/cim/effects/CIMEffectHelper":function(){define("exports ../../../geometry/GeometryCursor ../../../geometry/geometryCursorCollectUtils ../CIMEffects ../CIMOperators ../CIMSymbolHelper".split(" "),function(b,q,n,g,k,l){const a=96/72;class f{static executeEffects(d,c,e,h){const x=l.getEffectsInflateSize(d);c=new g.SimpleEffectCursor(c);for(const m of d)(d=k.getEffectOperator(m))&&(c=
d.execute(c,m,a,e,h,x));return c}static applyEffects(d,c,e){if(!d)return c;var h=l.getEffectsInflateSize(d);c=new g.SimpleEffectCursor(q.GeometryCursor.fromJSONCIM(c));for(var x of d)(d=k.getEffectOperator(x))&&(c=d.execute(c,x,1,null,e,h));h=[];for(x=null;e=c.next();)h.push(...n.collectMultipath(e)),x=e.geometryType;return 0===h.length||null===x?null:"esriGeometryPolygon"===x?{rings:h}:{paths:h}}}b.CIMEffectHelper=f;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/CIMEffects":function(){define(["exports",
"../../geometry/GeometryCursor","../../geometry/support/TileClipper"],function(b,q,n){let g;class k{constructor(l){this._geometry=l}next(){const l=this._geometry;this._geometry=null;return l}}b.SimpleEffectCursor=k;b.clipCursorToTileExtent=function(l,a){g||=new n.TileClipper(0,0,0,1);var f="esriGeometryPolygon"===l.geometryType;const d=f?3:2;g.reset(f?n.GeometryType.Polygon:n.GeometryType.LineString);g.setPixelMargin(a+1);g.setExtent(512);let c;for(;l.nextPath();)if(!(l.pathSize<d)){l.nextPoint();
a=l.x;c=-l.y;for(g.moveTo(a,c);l.nextPoint();)a=l.x,c=-l.y,g.lineTo(a,c);f&&g.close()}if(f=g.result(!1)){l=q.GeometryCursor.createEmptyOptimizedCIM(l.geometryType);for(const e of f){l.startPath();for(const h of e)l.pushXY(h.x,-h.y)}l.reset();return l}return null};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/CIMOperators":function(){define("exports ./effects/EffectAddControlPoints ./effects/EffectArrow ./effects/EffectBuffer ./effects/EffectControlMeasureLine ./effects/EffectCut ./effects/EffectDashes ./effects/EffectDonut ./effects/EffectJog ./effects/EffectMove ./effects/EffectOffset ./effects/EffectReverse ./effects/EffectRotate ./effects/EffectScale ./effects/EffectWave ./placements/PlacementAlongLineSameSize ./placements/PlacementAtExtremities ./placements/PlacementAtRatioPositions ./placements/PlacementInsidePolygon ./placements/PlacementOnLine ./placements/PlacementOnVertices ./placements/PlacementPolygonCenter".split(" "),
function(b,q,n,g,k,l,a,f,d,c,e,h,x,m,p,t,w,r,y,z,u,v){b.getEffectOperator=function(A){if(!A)return null;switch(A.type){case "CIMGeometricEffectAddControlPoints":return q.EffectAddControlPoints.local();case "CIMGeometricEffectArrow":return n.EffectArrow.local();case "CIMGeometricEffectBuffer":return g.EffectBuffer.local();case "CIMGeometricEffectControlMeasureLine":return k.EffectControlMeasureLine.local();case "CIMGeometricEffectCut":return l.EffectCut.local();case "CIMGeometricEffectDashes":return a.EffectDashes.local();
case "CIMGeometricEffectDonut":return f.EffectDonut.local();case "CIMGeometricEffectJog":return d.EffectJog.local();case "CIMGeometricEffectMove":return c.EffectMove.local();case "CIMGeometricEffectOffset":return e.EffectOffset.local();case "CIMGeometricEffectReverse":return h.EffectReverse.local();case "CIMGeometricEffectRotate":return x.EffectRotate.local();case "CIMGeometricEffectScale":return m.EffectScale.local();case "CIMGeometricEffectWave":return p.EffectWave.local()}return null};b.getPlacementOperator=
function(A){if(!A)return null;switch(A.type){case "CIMMarkerPlacementAlongLineSameSize":return t.PlacementAlongLineSameSize.local();case "CIMMarkerPlacementAtExtremities":return w.PlacementAtExtremities.local();case "CIMMarkerPlacementAtRatioPositions":return r.PlacementAtRatioPositions.local();case "CIMMarkerPlacementInsidePolygon":return y.PlacementInsidePolygon.local();case "CIMMarkerPlacementOnLine":return z.PlacementOnLine.local();case "CIMMarkerPlacementOnVertices":return u.PlacementOnVertices.local();
case "CIMMarkerPlacementPolygonCenter":return v.PlacementPolygonCenter.local()}return null};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/effects/EffectAddControlPoints":function(){define(["exports"],function(b){class q{static local(){null===q.instance&&(q.instance=new q);return q.instance}execute(g,k,l,a,f){return new n(g,k,l)}}q.instance=null;class n{constructor(g,k,l){this._inputGeometries=g;this._angleTolerance=void 0!==k.angleTolerance?k.angleTolerance:120;
this._maxCosAngle=Math.cos((1-Math.abs(this._angleTolerance)/180)*Math.PI)}next(){let g=this._inputGeometries.next();for(;g;){if("esriGeometryPolygon"===g.geometryType)this._isClosed=!0;else if("esriGeometryPolyline"===g.geometryType)this._isClosed=!1;else if("esriGeometryEnvelope"===g.geometryType){if(this._maxCosAngle)return g;this._isClosed=!0}else{g=this._inputGeometries.next();continue}for(;g.nextPath();)this._processPath(g);g.reset();return g}return null}_processPath(g){if(g.nextPoint()){const k=
g.x,l=g.y;let a=k,f=l,d=g.pathSize,c=0,e=0,h=0,x=0,m=0,p=0;this._isClosed&&++d;for(let t=1;g.nextPoint()||t<d;++t){let w,r;this._isClosed&&t===d-1?(w=k,r=l):(w=g.x,r=g.y);const y=w-a,z=r-f,u=Math.sqrt(y*y+z*z);1<t&&0<u&&0<h&&(c*y+e*z)/u/h<=this._maxCosAngle&&g.setControlPointAt(t-1);1===t&&(x=y,m=z,p=u);0<u&&(a=w,f=r,c=y,e=z,h=u)}this._isClosed&&0<h&&0<p&&(c*x+e*m)/p/h<=this._maxCosAngle&&g.setControlPointAt(0)}}}b.EffectAddControlPoints=q;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},
"esri/symbols/cim/effects/EffectArrow":function(){define("exports ../../../geometry/GeometryCursor ../../../geometry/geometryCursorCollectUtils ../CIMCursor ../CurveHelper ../enums".split(" "),function(b,q,n,g,k,l){const a=l.GeometricEffectArrowType.OpenEnded;class f{static local(){null===f.instance&&(f.instance=new f);return f.instance}execute(c,e,h,x,m){return new d(c,e,h)}}f.instance=null;class d extends g.PathEffectCursor{constructor(c,e,h){super(c,!1,!0);this._curveHelper=new k.CurveHelper;this._width=
(void 0!==e.width?e.width:5)*h;this._arrowType=void 0!==e.geometricEffectArrowType?e.geometricEffectArrowType:void 0!==e.arrowType?e.arrowType:a;this._offsetFlattenError=k.pixelTolerance*h}processPath(c){const e=q.GeometryCursor.createEmptyOptimizedCIM(c.geometryType);switch(this._arrowType){default:this._constructSimpleArrow(e,c,!0);break;case l.GeometricEffectArrowType.Block:this._constructSimpleArrow(e,c,!1);break;case l.GeometricEffectArrowType.Crossed:this._constructCrossedArrow(e,c)}return e}_constructSimpleArrow(c,
e,h){var x=e.pathLength(),m=this._width;x<2*m&&(m=x/2);var p=this._curveHelper.getSubCurve(e,0,x-m);if(p&&p.nextPath()&&(p.seekPathStart(),x=m/2,!this._curveHelper.isEmpty(p)&&(p=n.collectPath(p),m=this._constructOffset(p,-x)))&&(p=this._constructOffset(p,x))){var t=this._constructArrowBasePoint(m,-x/2);t&&(x=this._constructArrowBasePoint(p,x/2))&&(e.seekInPath(e.pathSize-1),e=[e.x,e.y],c.pushPath(p),c.nextPath(),c.nextPoint(),c.setControlPoint(),c.pushPoint(x),c.nextPoint(),c.setControlPoint(),c.pushPoint(e),
c.nextPoint(),c.setControlPoint(),c.pushPoint(t),c.nextPoint(),c.setControlPoint(),c.pushPoints(m.reverse()),c.setControlPoint(),h||(c.setControlPointAt(0),c.setControlPointAt(c.pathSize-1),c.pushPoint(p[0])),c.reset())}}_constructCrossedArrow(c,e){var h=e.pathLength(),x=this._width;h<3.732050807568877*x&&(x=h/3.732050807568877);e.seekPathStart();var m=this._curveHelper.getSubCurve(e,0,h-2.732050807568877*x);if(m){m.nextPath();var p=x/2;if(!this._curveHelper.isEmpty(m)){var t=n.collectPath(m);if(m=
this._constructOffset(t,p))if(t=this._constructOffset(t,-p))if(h=this._curveHelper.getSubCurve(e,0,h-x))if(h.nextPath(),!this._curveHelper.isEmpty(h)&&(h=n.collectPath(h),x=this._constructOffset(h,p))){var w=this._constructOffset(h,-p);if(w&&(h=x[x.length-1],x=this._constructArrowBasePoint(x,p/2))){var r=w[w.length-1];if(p=this._constructArrowBasePoint(w,-p/2))e.seekInPath(e.pathSize-1),e=[e.x,e.y],c.pushPath(m),c.nextPath(),c.nextPoint(),c.setControlPoint(),c.pushPoint(r),c.nextPoint(),c.setControlPoint(),
c.pushPoint(p),c.nextPoint(),c.setControlPoint(),c.pushPoint(e),c.nextPoint(),c.setControlPoint(),c.pushPoint(x),c.nextPoint(),c.setControlPoint(),c.pushPoint(h),c.nextPoint(),c.setControlPoint(),c.pushPoints(t.reverse()),c.nextPoint(),c.setControlPoint(),c.reset()}}}}}_constructOffset(c,e){return this._curveHelper.offset(c,e,l.GeometricEffectOffsetMethod.Rounded,4,this._offsetFlattenError)}_constructArrowBasePoint(c,e){if(!c||2>c.length)return null;var h=c[c.length-2];c=c[c.length-1];h=[c[0]-h[0],
c[1]-h[1]];this._curveHelper.normalize(h);return[c[0]+h[1]*e,c[1]-h[0]*e]}}b.EffectArrow=f;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/CIMCursor":function(){define(["exports","./CIMPlacements"],function(b,q){class n{constructor(k,l=!0,a=!0,f=0){this.isClosed=!1;this.geometryCursor=null;this.geometryCursor=!l&&"esriGeometryPolygon"===k.geometryType||!a&&"esriGeometryPolyline"===k.geometryType?null:k;this.geomUnitsPerPoint=f;this.iteratePath=this.iterateMultiPath=
!1;this.internalPlacement=new q.Placement}next(){if(!this.geometryCursor)return null;const k=this.processMultiPath(this.geometryCursor);this.iterateMultiPath&&k||(this.geometryCursor=null);return k}processMultiPath(k){for(;this.iteratePath||k.pathIndex<k.totalSize-1;){this.iteratePath||k.nextPath();this.iterateMultiPath=!0;const l=this.processPath(k);if(l)return l}this.iterateMultiPath=!1;return null}}class g{constructor(k,l,a,f=0){this.isClosed=!1;this.inputGeometries=k;this.acceptPolygon=l;this.acceptPolyline=
a;this.geomUnitsPerPoint=f;this.iteratePath=!1;this.multiPathCursor=null}next(){for(;;){if(!this.multiPathCursor){for(var k=this.inputGeometries.next();k&&!(this.isClosed=this.acceptPolygon&&"esriGeometryPolygon"===k.geometryType||"esriGeometryEnvelope"===k.geometryType,this.multiPathCursor=k);)k=this.inputGeometries.next();if(!this.multiPathCursor)return null}for(;this.iteratePath||this.multiPathCursor.nextPath();)if(this.multiPathCursor.seekPathStart(),k=this.processPath(this.multiPathCursor))return k;
this.multiPathCursor=null}}}b.PathEffectCursor=g;b.PathTransformationCursor=n;b.getId=function(k){return k[4]};b.setId=function(k,l){k[4]=l};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/CIMPlacements":function(){define(["exports"],function(b){class q{constructor(){this.setIdentity()}getAngle(){if(null==this.rz||0===this.rz&&1!==this.rzCos&&0!==this.rzSin)this.rz=Math.atan2(this.rzSin,this.rzCos);return this.rz}setIdentity(){this.tz=this.ty=this.tx=0;this.s=1;this.rz=
this.ry=this.rx=0;this.rzCos=1;this.rzSin=0}setTranslate(g,k){this.tx=g;this.ty=k}setTranslateZ(g){this.tz=g}setRotateCS(g,k){this.rz=void 0;this.rzCos=g;this.rzSin=k}setRotate(g){this.rz=g;this.rzSin=this.rzCos=void 0}setRotateY(g){this.ry=g}setScale(g){this.s=g}setMeasure(g){this.m=g}}class n{next(){return null}}b.EmptyPlacementCursor=n;b.Placement=q;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/CurveHelper":function(){define(["exports","../../geometry/GeometryCursor",
"./enums"],function(b,q,n){class g{constructor(k,l){}isEmpty(k){if(!k.nextPoint())return!0;let l,a,f,d;l=k.x;for(a=k.y;k.nextPoint();l=a,a=d)if(f=k.x,d=k.y,f!==l||d!==a)return k.seekPathStart(),!1;k.seekPathStart();return!0}normalize(k){const l=Math.sqrt(k[0]*k[0]+k[1]*k[1]);0!==l&&(k[0]/=l,k[1]/=l)}getLength(k,l,a,f){k=a-k;l=f-l;return Math.sqrt(k*k+l*l)}getSegLength(k){const [[l,a],[f,d]]=k;return this.getLength(l,a,f,d)}getCoord2D(k,l,a,f,d){return[k+(a-k)*d,l+(f-l)*d]}getSegCoord2D(k,l){const [[a,
f],[d,c]]=k;return this.getCoord2D(a,f,d,c,l)}getAngle(k,l,a,f,d){return Math.atan2(f-l,a-k)}getAngleCS(k,l,a,f,d){k=a-k;l=f-l;f=Math.sqrt(k*k+l*l);return 0<f?[k/f,l/f]:[1,0]}getSegAngleCS(k,l){const [[a,f],[d,c]]=k;return this.getAngleCS(a,f,d,c,l)}cut(k,l,a,f,d,c){d=0>=d?[k,l]:this.getCoord2D(k,l,a,f,d);k=1<=c?[a,f]:this.getCoord2D(k,l,a,f,c);return[d,k]}getSubCurve(k,l,a){const f=q.GeometryCursor.createEmptyOptimizedCIM("esriGeometryPolyline");return this.appendSubCurve(f,k,l,a)?f:null}appendSubCurve(k,
l,a,f){k.startPath();l.seekPathStart();let d=0;var c=!0;if(!l.nextPoint())return!1;var e=l.x;let h=l.y;for(;l.nextPoint();){const x=this.getLength(e,h,l.x,l.y);if(0!==x){if(c){if(d+x>a){const m=(a-d)/x;let p=1;c=!1;d+x>=f&&(p=(f-d)/x,c=!0);(e=this.cut(e,h,l.x,l.y,m,p))&&k.pushPoints(e);if(c)break;c=!1}}else{if(d+x>f){(l=this.cut(e,h,l.x,l.y,0,(f-d)/x))&&k.pushPoint(l[1]);break}k.pushXY(l.x,l.y)}d+=x}e=l.x;h=l.y}return!0}getCIMPointAlong(k,l){if(!k.nextPoint())return null;let a=0,f,d,c,e;f=k.x;for(d=
k.y;k.nextPoint();f=c,d=e){c=k.x;e=k.y;const h=this.getLength(f,d,c,e);if(0!==h){if(a+h>l)return this.getCoord2D(f,d,c,e,(l-a)/h);a+=h}}return null}offset(k,l,a,f,d){if(!k||2>k.length)return null;var c=0,e=k[c++];for(d=c;c<k.length;){var h=k[c];if(h[0]!==e[0]||h[1]!==e[1])c!==d&&(k[d]=k[c]),e=k[d++];c++}(c=k[0][0]===k[d-1][0]&&k[0][1]===k[d-1][1])&&--d;if(d<(c?3:2))return null;h=[];e=c?k[d-1]:null;let x=k[0];for(let r=0;r<d;r++){const y=r===d-1?c?k[0]:null:k[r+1];if(e)if(y){var m=[y[0]-x[0],y[1]-
x[1]];this.normalize(m);var p=[x[0]-e[0],x[1]-e[1]];this.normalize(p);var t=p[0]*m[1]-p[1]*m[0],w=p[0]*m[0]+p[1]*m[1];if(0===t&&1===w){x=y;continue}if(0<=t===0>=l)1>w&&(m=[m[0]-p[0],m[1]-p[1]],this.normalize(m),p=Math.sqrt((1+w)/2),p>1/f&&(p=-Math.abs(l)/p,h.push([x[0]-m[0]*p,x[1]-m[1]*p])));else switch(a){case n.GeometricEffectOffsetMethod.Mitered:if(e=Math.sqrt((1+w)/2),0<e&&1/e<f){m=[m[0]-p[0],m[1]-p[1]];this.normalize(m);p=Math.abs(l)/e;h.push([x[0]-m[0]*p,x[1]-m[1]*p]);break}case n.GeometricEffectOffsetMethod.Bevelled:h.push([x[0]+
p[1]*l,x[1]-p[0]*l]);h.push([x[0]+m[1]*l,x[1]-m[0]*l]);break;case n.GeometricEffectOffsetMethod.Rounded:if(1>w){h.push([x[0]+p[1]*l,x[1]-p[0]*l]);e=Math.floor(2.5*(1-w));if(0<e){t=w=1/e;for(let z=1;z<e;z++,t+=w){const u=[p[1]*(1-t)+m[1]*t,-p[0]*(1-t)-m[0]*t];this.normalize(u);h.push([x[0]+u[0]*l,x[1]+u[1]*l])}}h.push([x[0]+m[1]*l,x[1]-m[0]*l])}break;default:0>t?(h.push([x[0]+(p[1]+p[0])*l,x[1]+(p[1]-p[0])*l]),h.push([x[0]+(m[1]-m[0])*l,x[1]-(m[0]+m[1])*l])):(e=Math.sqrt((1+Math.abs(w))/2),m=[m[0]-
p[0],m[1]-p[1]],this.normalize(m),p=l/e,h.push([x[0]-m[0]*p,x[1]-m[1]*p]))}}else m=[x[0]-e[0],x[1]-e[1]],this.normalize(m),h.push([x[0]+m[1]*l,x[1]-m[0]*l]);else m=[y[0]-x[0],y[1]-x[1]],this.normalize(m),h.push([x[0]+m[1]*l,x[1]-m[0]*l]);e=x;x=y}if(h.length<(c?3:2))return null;c&&h.push([h[0][0],h[0][1]]);return h}}b.CurveHelper=g;b.pixelTolerance=.03;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/effects/EffectBuffer":function(){define("exports ../../../geometry ../../../geometry/GeometryCursor ../../../geometry/geometryCursorCollectUtils ../CIMEffects ../CurveHelper ../enums ../../../geometry/SpatialReference".split(" "),
function(b,q,n,g,k,l,a,f){class d{static local(){null===d.instance&&(d.instance=new d);return d.instance}execute(e,h,x,m,p,t){return new c(e,h,x,m,p,t)}}d.instance=null;class c{constructor(e,h,x,m,p,t){this._inputGeometries=e;this._tileKey=m;this._geometryEngine=p;this._curveHelper=new l.CurveHelper;this._size=(void 0!==h.size?h.size:1)*x;this._maxInflateSize=t*x;this._offsetFlattenError=l.pixelTolerance*x}next(){for(var e;e=this._inputGeometries.next();){if(0===this._size)return e;if("esriGeometryEnvelope"===
e.geometryType)if(0<this._size){var h=n.GeometryCursor.createEmptyOptimizedCIM(e.geometryType),x=g.collectMultipath(e)[0];if(x=this._curveHelper.offset(x,this._size,a.GeometricEffectOffsetMethod.Rounded,4,this._offsetFlattenError))return h.pushPath(x),h}else if(0>this._size&&(h=e.asJSON(),0<Math.min(h.xmax-h.xmin,h.ymax-h.ymin)+2*this._size))return n.GeometryCursor.fromJSONCIM({xmin:h.xmin-this._size,xmax:h.xmax+this._size,ymin:h.ymin-this._size,ymax:h.ymax+this._size});h=this._geometryEngine;if(null==
h)break;if(e=this._tileKey?k.clipCursorToTileExtent(e,this._maxInflateSize):e)return(e=h.buffer(f.WebMercator,e.asJSON(),this._size,1))?n.GeometryCursor.fromJSONCIM(e):null}return null}}b.EffectBuffer=d;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/effects/EffectControlMeasureLine":function(){define("exports ../../../geometry/GeometryCursor ../../../geometry/geometryCursorCollectUtils ../../../geometry/support/coordsUtils ../CIMCursor ../enums".split(" "),function(b,
q,n,g,k,l){class a{static local(){null===a.instance&&(a.instance=new a);return a.instance}execute(d,c,e,h,x){return new f(d,c,e)}}a.instance=null;class f{constructor(d,c,e){this._defaultPointSize=20;this._inputGeometries=d;this._geomUnitsPerPoint=e;this._rule=c.rule??l.GeometricEffectControlMeasureLineRule.FullGeometry;this._defaultSize=this._defaultPointSize*e}next(){for(var d;d=this._inputGeometries.next();)if(d=this._processGeom(n.collectMultipath(d)),d?.length)return q.GeometryCursor.fromJSONCIM({paths:d});
return null}_clone(d){return[d[0],d[1]]}_mid(d,c){return[(d[0]+c[0])/2,(d[1]+c[1])/2]}_mix(d,c,e,h){return[d[0]*c+e[0]*h,d[1]*c+e[1]*h]}_add(d,c){return[d[0]+c[0],d[1]+c[1]]}_add2(d,c,e){return[d[0]+c,d[1]+e]}_sub(d,c){return[d[0]-c[0],d[1]-c[1]]}_dist(d,c){return Math.sqrt((d[0]-c[0])*(d[0]-c[0])+(d[1]-c[1])*(d[1]-c[1]))}_norm(d){return Math.sqrt(d[0]*d[0]+d[1]*d[1])}_normalize(d,c=1){c/=this._norm(d);d[0]*=c;d[1]*=c}_leftPerpendicular(d){const c=d[0];d[0]=-d[1];d[1]=c}_leftPerp(d){return[-d[1],
d[0]]}_rightPerpendicular(d){const c=-d[0];d[0]=d[1];d[1]=c}_rightPerp(d){return[d[1],-d[0]]}_dotProduct(d,c){return d[0]*c[0]+d[1]*c[1]}_crossProduct(d,c){return d[0]*c[1]-d[1]*c[0]}_rotateDirect(d,c,e){const h=d[0]*e+d[1]*c;d[0]=d[0]*c-d[1]*e;d[1]=h}_makeCtrlPt(d){d=[d[0],d[1]];k.setId(d,1);return d}_addAngledTicks(d,c,e,h){const x=this._sub(e,c);this._normalize(x);var m=this._crossProduct(x,this._sub(h,c));h=0<m?this._rightPerp(x):this._leftPerp(x);m=Math.abs(m)/2;const p=[];p.push([c[0]+(h[0]-
x[0])*m,c[1]+(h[1]-x[1])*m]);p.push(c);p.push(e);p.push([e[0]+(h[0]+x[0])*m,e[1]+(h[1]+x[1])*m]);d.push(p)}_addBezier2(d,c,e,h,x){if(0===x--)d.push(h);else{var m=this._mid(c,e);e=this._mid(e,h);var p=this._mid(m,e);this._addBezier2(d,c,m,p,x);this._addBezier2(d,p,e,h,x)}}_addBezier3(d,c,e,h,x,m){if(0===m--)d.push(x);else{var p=this._mid(c,e),t=this._mid(e,h);h=this._mid(h,x);e=this._mid(p,t);t=this._mid(t,h);var w=this._mid(e,t);this._addBezier3(d,c,p,e,w,m);this._addBezier3(d,w,t,h,x,m)}}_add90DegArc(d,
c,e,h,x){h=x??0<this._crossProduct(this._sub(e,c),this._sub(h,c));x=this._mid(c,e);const m=this._sub(x,c);h?this._leftPerpendicular(m):this._rightPerpendicular(m);x[0]+=m[0];x[1]+=m[1];this._addBezier3(d,c,this._mix(c,.33333,x,.66667),this._mix(e,.33333,x,.66667),e,4)}_addArrow(d,c,e){var h=c[0],x=c[1],m=c[c.length-1],p=this._sub(h,x),t=this._norm(p);this._normalize(p);const w=Math.abs(this._crossProduct(p,this._sub(m,x)));m=this._dotProduct(p,this._sub(m,x));m<.05*t?m=.05*t:m>.95*t&&(m=.95*t);t=
.5*w;var r=this._leftPerp(p);m=[x[0]+p[0]*m,x[1]+p[1]*m];var y=c.length-1;x=[];x.push(e?[-r[0],-r[1]]:r);var z=[-p[0],-p[1]];for(e=1;e<y-1;e++){p=this._sub(c[e+1],c[e]);this._normalize(p);var u=this._dotProduct(p,z);r=this._crossProduct(p,z);u=Math.sqrt((1+u)/2);z=this._sub(p,z);this._normalize(z);z[0]/=u;z[1]/=u;x.push(0>r?[-z[0],-z[1]]:z);z=p}x.push(this._rightPerp(z));for(y=x.length-1;0<y;y--)d.push([c[y][0]+x[y][0]*t,c[y][1]+x[y][1]*t]);d.push([m[0]+x[0][0]*t,m[1]+x[0][1]*t]);d.push([m[0]+x[0][0]*
w,m[1]+x[0][1]*w]);d.push(h);d.push([m[0]-x[0][0]*w,m[1]-x[0][1]*w]);d.push([m[0]-x[0][0]*t,m[1]-x[0][1]*t]);for(h=1;h<x.length;h++)d.push([c[h][0]-x[h][0]*t,c[h][1]-x[h][1]*t])}_addDash(d,c,e){const h=this._norm(e)/7;this._normalize(e);let x=[];for(let m=0;7>=m;m++)x.push([c[0]+e[0]*m*h,c[1]+e[1]*m*h]),m&1&&(d.push(x),x=[])}_cp2(d,c,e){return 2<=d.length?d[1]:this._add2(d[0],c*this._defaultSize,e*this._defaultSize)}_cp3(d,c,e,h){if(3<=d.length)return d[2];e=this._mix(d[0],1-e,c,e);d=this._sub(c,
d[0]);this._normalize(d);this._rightPerpendicular(d);return[e[0]+d[0]*h*this._defaultSize,e[1]+d[1]*h*this._defaultSize]}_arrowPath(d){if(2<d.length)return d;const c=d[0];d=this._cp2(d,-4,0);const e=this._sub(c,d);this._normalize(e);const h=this._rightPerp(e);return[c,d,[c[0]+(h[0]-e[0])*this._defaultSize,c[1]+(h[1]-e[1])*this._defaultSize]]}_arrowLastSeg(d){var c=d[0];const e=this._cp2(d,-4,0);if(3<=d.length)c=d[d.length-1];else{d=this._sub(c,e);this._normalize(d);const h=this._rightPerp(d);c=[c[0]+
(h[0]-d[0])*this._defaultSize,c[1]+(h[1]-d[1])*this._defaultSize]}return[e,c]}_processGeom(d){if(!d)return null;const c=[];for(const e of d){const h=1<e.length&&g.getPathLength(e)<this._defaultSize;if(!e||0===e.length||h)continue;const x=e.length;let m=e[0];switch(this._rule){case l.GeometricEffectControlMeasureLineRule.PerpendicularFromFirstSegment:const p=this._cp2(e,0,-1),t=this._cp3(e,p,.5,4),w=[];w.push(t);w.push(this._mid(m,p));c.push(w);break;case l.GeometricEffectControlMeasureLineRule.ReversedFirstSegment:const r=
this._cp2(e,0,-1);c.push([r,m]);break;case l.GeometricEffectControlMeasureLineRule.PerpendicularToSecondSegment:if(3>e.length)return[];const y=this._cp2(e,-4,1),z=this._cp3(e,y,.882353,-1.94),u=[];u.push(this._mid(y,z));u.push(m);c.push(u);break;case l.GeometricEffectControlMeasureLineRule.SecondSegmentWithTicks:if(3>e.length)return[];const v=this._cp2(e,-4,1),A=this._cp3(e,v,.882353,-1.94),B=this._sub(A,v);let F;F=0<this._crossProduct(B,this._sub(m,v))?this._rightPerp(B):this._leftPerp(B);const H=
[];H.push([v[0]+(F[0]-B[0])/3,v[1]+(F[1]-B[1])/3]);H.push(v);H.push(A);H.push([A[0]+(F[0]+B[0])/3,A[1]+(F[1]+B[1])/3]);c.push(H);break;case l.GeometricEffectControlMeasureLineRule.DoublePerpendicular:const J=this._cp2(e,0,-1),E=this._cp3(e,J,.5,3),K=this._mid(m,J),C=this._sub(K,E);this._normalize(C);const D=this._crossProduct(C,this._sub(m,E));this._leftPerpendicular(C);const G=[];G.push(m);G.push([E[0]+C[0]*D,E[1]+C[1]*D]);c.push(G);const N=[];N.push([E[0]-C[0]*D,E[1]-C[1]*D]);N.push(J);c.push(N);
break;case l.GeometricEffectControlMeasureLineRule.OppositeToFirstSegment:const Y=this._cp2(e,0,-1),ca=this._cp3(e,Y,.5,3),ka=this._mid(m,Y),Q=this._sub(ka,ca);this._normalize(Q);const R=this._crossProduct(Q,this._sub(m,ca));this._leftPerpendicular(Q);const Z=[];Z.push([ca[0]+Q[0]*R,ca[1]+Q[1]*R]);Z.push([ca[0]-Q[0]*R,ca[1]-Q[1]*R]);c.push(Z);break;case l.GeometricEffectControlMeasureLineRule.TriplePerpendicular:const da=this._cp2(e,0,-1),ja=this._cp3(e,da,.5,4),W=this._mid(m,da),aa=this._sub(W,ja);
this._normalize(aa);const ia=this._crossProduct(aa,this._sub(m,ja));this._leftPerpendicular(aa);const qa=[];qa.push([ja[0]+aa[0]*ia*.8,ja[1]+aa[1]*ia*.8]);qa.push([W[0]+.8*(m[0]-W[0]),W[1]+.8*(m[1]-W[1])]);c.push(qa);c.push([ja,W]);const sa=[];sa.push([ja[0]-aa[0]*ia*.8,ja[1]-aa[1]*ia*.8]);sa.push([W[0]+.8*(da[0]-W[0]),W[1]+.8*(da[1]-W[1])]);c.push(sa);break;case l.GeometricEffectControlMeasureLineRule.HalfCircleFirstSegment:const ya=this._cp2(e,0,-1),va=this._cp3(e,ya,.5,4),wa=this._mid(m,ya);let M=
this._sub(ya,m);const L=Math.cos(Math.PI/18),T=Math.sin(Math.PI/18),ha=Math.sqrt((1+L)/2),oa=Math.sqrt((1-L)/2),S=[];let X;0<this._crossProduct(M,this._sub(va,m))?(S.push(m),M=this._sub(m,wa),X=ya):(S.push(ya),M=this._sub(ya,wa),X=m);this._rotateDirect(M,ha,oa);M[0]/=ha;M[1]/=ha;for(let Ga=1;18>=Ga;Ga++)S.push(this._add(wa,M)),this._rotateDirect(M,L,T);S.push(X);c.push(S);break;case l.GeometricEffectControlMeasureLineRule.HalfCircleSecondSegment:const ba=this._cp2(e,0,-1),la=this._cp3(e,ba,1,-1);
let pa=this._sub(m,ba);this._normalize(pa);const O=this._crossProduct(pa,this._sub(la,ba))/2;this._leftPerpendicular(pa);const ea=[ba[0]+pa[0]*O,ba[1]+pa[1]*O];pa=this._sub(ba,ea);const na=Math.cos(Math.PI/18);let ra=Math.sin(Math.PI/18);0<O&&(ra=-ra);const Aa=[ba];for(let Ga=1;18>=Ga;Ga++)this._rotateDirect(pa,na,ra),Aa.push(this._add(ea,pa));c.push(Aa);break;case l.GeometricEffectControlMeasureLineRule.HalfCircleExtended:const za=this._cp2(e,0,-2),Ba=this._cp3(e,za,1,-1);let Ha;if(4<=x)Ha=e[3];
else{const Ga=this._sub(m,za);Ha=this._add(Ba,Ga)}const Ea=this._dist(za,Ba)/2/.75,Ia=this._sub(za,m);this._normalize(Ia,Ea);const Ja=this._sub(Ba,Ha);this._normalize(Ja,Ea);c.push([Ha,Ba]);const Fa=[this._clone(Ba)];this._addBezier3(Fa,Ba,this._add(Ba,Ja),this._add(za,Ia),za,4);Fa.push(m);c.push(Fa);break;case l.GeometricEffectControlMeasureLineRule.OpenCircle:const Ma=this._cp2(e,-2,0),Ua=this._sub(Ma,m),hb=Math.cos(Math.PI/18),ib=-Math.sin(Math.PI/18),Za=[Ma];for(let Ga=1;33>=Ga;Ga++)this._rotateDirect(Ua,
hb,ib),Za.push(this._add(m,Ua));c.push(Za);break;case l.GeometricEffectControlMeasureLineRule.CoverageEdgesWithTicks:const Oa=this._cp2(e,0,-1);let Pa;if(3<=x)Pa=e[2];else{const Ga=this._sub(Oa,m),Ra=this._leftPerp(Ga);Pa=[m[0]+Ra[0]-.25*Ga[0],m[1]+Ra[1]-.25*Ga[1]]}let ua;if(4<=x)ua=e[3];else{const Ga=this._mid(m,Oa),Ra=this._sub(m,Oa);this._normalize(Ra);this._leftPerpendicular(Ra);const db=this._crossProduct(Ra,this._sub(Pa,Ga));this._rightPerpendicular(Ra);ua=[Pa[0]+Ra[0]*db*2,Pa[1]+Ra[1]*db*2]}const ob=
this._sub(Oa,m);let Hb,Na;Hb=0<this._crossProduct(ob,this._sub(Pa,m))?this._rightPerp(ob):this._leftPerp(ob);Na=[];Na.push(Pa);Na.push(m);Na.push([m[0]+(Hb[0]-ob[0])/3,m[1]+(Hb[1]-ob[1])/3]);c.push(Na);Hb=0<this._crossProduct(ob,this._sub(ua,Oa))?this._rightPerp(ob):this._leftPerp(ob);Na=[];Na.push([Oa[0]+(Hb[0]+ob[0])/3,Oa[1]+(Hb[1]+ob[1])/3]);Na.push(Oa);Na.push(ua);c.push(Na);break;case l.GeometricEffectControlMeasureLineRule.GapExtentWithDoubleTicks:const Yb=this._cp2(e,0,2),I=this._cp3(e,Yb,
0,1);let nd;if(4<=x)nd=e[3];else{const Ga=this._sub(Yb,m);nd=this._add(I,Ga)}this._addAngledTicks(c,m,Yb,this._mid(I,nd));this._addAngledTicks(c,I,nd,this._mid(m,Yb));break;case l.GeometricEffectControlMeasureLineRule.GapExtentMidline:const od=this._cp2(e,2,0),Od=this._cp3(e,od,0,1);let Pd;if(4<=x)Pd=e[3];else{const Ga=this._sub(od,m);Pd=this._add(Od,Ga)}const Qd=[];Qd.push(this._mid(m,Od));Qd.push(this._mid(od,Pd));c.push(Qd);break;case l.GeometricEffectControlMeasureLineRule.Chevron:const Rd=this._cp2(e,
-1,-1);let Sd;if(3<=x)Sd=e[2];else{const Ga=this._sub(Rd,m);this._leftPerpendicular(Ga);Sd=this._add(m,Ga)}c.push([Rd,this._makeCtrlPt(m),Sd]);break;case l.GeometricEffectControlMeasureLineRule.PerpendicularWithArc:const hc=this._cp2(e,0,-2),Td=this._cp3(e,hc,.5,-1),mb=this._sub(hc,m),yb=this._norm(mb);mb[0]/=yb;mb[1]/=yb;const ic=this._crossProduct(mb,this._sub(Td,m));let jc=this._dotProduct(mb,this._sub(Td,m));jc<.05*yb?jc=.05*yb:jc>.95*yb&&(jc=.95*yb);const Kc=[m[0]+mb[0]*jc,m[1]+mb[1]*jc];let lb=
this._leftPerp(mb),wc=[];wc.push([Kc[0]-lb[0]*ic,Kc[1]-lb[1]*ic]);wc.push([Kc[0]+lb[0]*ic,Kc[1]+lb[1]*ic]);c.push(wc);if(4<=x){const Ga=e[3];let Ra=this._dotProduct(mb,this._sub(Ga,m));Ra<.1*yb?Ra=.1*yb:Ra>.9*yb&&(Ra=.9*yb);const db=[m[0]+mb[0]*Ra,m[1]+mb[1]*Ra],qb=this._crossProduct(mb,this._sub(Ga,m)),Ud=[];Ud.push([db[0]-lb[0]*qb,db[1]-lb[1]*qb]);Ud.push([db[0]+lb[0]*qb,db[1]+lb[1]*qb]);c.push(Ud)}const Fe=[hc[0]+lb[0]*ic,hc[1]+lb[1]*ic];lb=this._sub(hc,Fe);const qf=Math.cos(Math.PI/18);let Vd=
Math.sin(Math.PI/18);0>ic&&(Vd=-Vd);wc=[m,hc];for(let Ga=1;9>=Ga;Ga++)this._rotateDirect(lb,qf,Vd),wc.push(this._add(Fe,lb));c.push(wc);break;case l.GeometricEffectControlMeasureLineRule.ClosedHalfCircle:const Wd=this._cp2(e,2,0),Ge=this._mid(m,Wd),He=this._sub(Wd,Ge),rf=Math.cos(Math.PI/18),sf=Math.sin(Math.PI/18),Ie=[m,Wd];for(let Ga=1;18>=Ga;Ga++)this._rotateDirect(He,rf,sf),Ie.push(this._add(Ge,He));c.push(Ie);break;case l.GeometricEffectControlMeasureLineRule.TripleParallelExtended:const kc=
this._cp2(e,0,-2),Xd=this._cp3(e,kc,1,-2),lc=this._mid(m,kc),Ib=this._sub(Xd,kc);this._normalize(Ib);const Je=Math.abs(this._crossProduct(Ib,this._sub(lc,kc)))/2,xc=this._dist(kc,Xd),Ke=[kc,m];Ke.push([m[0]+Ib[0]*xc*.5,m[1]+Ib[1]*xc*.5]);c.push(Ke);const yc=[];yc.push([lc[0]-Ib[0]*Je,lc[1]-Ib[1]*Je]);yc.push([lc[0]+Ib[0]*xc*.375,lc[1]+Ib[1]*xc*.375]);k.setId(yc[yc.length-1],1);yc.push([lc[0]+Ib[0]*xc*.75,lc[1]+Ib[1]*xc*.75]);c.push(yc);c.push([kc,Xd]);break;case l.GeometricEffectControlMeasureLineRule.ParallelWithTicks:const Lc=
this._cp2(e,3,0),Yd=this._cp3(e,Lc,.5,-1),Mc=this._sub(Yd,Lc);this._normalize(Mc);const Le=this._crossProduct(Mc,this._sub(Yd,m));this._leftPerpendicular(Mc);this._addAngledTicks(c,m,Lc,Yd);this._addAngledTicks(c,this._mix(m,1,Mc,Le),this._mix(Lc,1,Mc,Le),this._mid(m,Lc));break;case l.GeometricEffectControlMeasureLineRule.Parallel:const Nc=this._cp2(e,3,0),tf=this._cp3(e,Nc,.5,-1),Zd=this._sub(Nc,m);this._normalize(Zd);const pd=this._leftPerp(Zd),qd=this._crossProduct(Zd,this._sub(tf,m));let Oc=[m,
Nc];c.push(Oc);Oc=[];Oc.push([m[0]+pd[0]*qd,m[1]+pd[1]*qd]);Oc.push([Nc[0]+pd[0]*qd,Nc[1]+pd[1]*qd]);c.push(Oc);break;case l.GeometricEffectControlMeasureLineRule.PerpendicularToFirstSegment:const $d=this._cp2(e,3,0),uf=this._cp3(e,$d,.5,-1),rd=this._mid(m,$d),mc=this._sub($d,m);this._normalize(mc);const sd=this._crossProduct(mc,this._sub(uf,m));this._leftPerpendicular(mc);const ae=[];ae.push([rd[0]-mc[0]*sd*.25,rd[1]-mc[1]*sd*.25]);ae.push([rd[0]+mc[0]*sd*1.25,rd[1]+mc[1]*sd*1.25]);c.push(ae);break;
case l.GeometricEffectControlMeasureLineRule.ParallelOffset:const zc=this._cp2(e,3,0),vf=this._cp3(e,zc,.5,-1),zb=this._sub(zc,m);this._normalize(zb);const Zb=this._crossProduct(zb,this._sub(vf,m));this._leftPerpendicular(zb);const be=[];be.push([m[0]-zb[0]*Zb,m[1]-zb[1]*Zb]);be.push([zc[0]-zb[0]*Zb,zc[1]-zb[1]*Zb]);c.push(be);const ce=[];ce.push([m[0]+zb[0]*Zb,m[1]+zb[1]*Zb]);ce.push([zc[0]+zb[0]*Zb,zc[1]+zb[1]*Zb]);c.push(ce);break;case l.GeometricEffectControlMeasureLineRule.OffsetOpposite:const td=
this._cp2(e,3,0),wf=this._cp3(e,td,.5,-1),nc=this._sub(td,m);this._normalize(nc);const ud=this._crossProduct(nc,this._sub(wf,m));this._leftPerpendicular(nc);const de=[];de.push([m[0]-nc[0]*ud,m[1]-nc[1]*ud]);de.push([td[0]-nc[0]*ud,td[1]-nc[1]*ud]);c.push(de);break;case l.GeometricEffectControlMeasureLineRule.OffsetSame:const vd=this._cp2(e,3,0),xf=this._cp3(e,vd,.5,-1),oc=this._sub(vd,m);this._normalize(oc);const wd=this._crossProduct(oc,this._sub(xf,m));this._leftPerpendicular(oc);const ee=[];ee.push([m[0]+
oc[0]*wd,m[1]+oc[1]*wd]);ee.push([vd[0]+oc[0]*wd,vd[1]+oc[1]*wd]);c.push(ee);break;case l.GeometricEffectControlMeasureLineRule.CircleWithArc:let Qb=this._cp2(e,3,0);const fe=this._cp3(e,Qb,.5,-1);let Rb,xd;if(4<=x)Rb=e[3],xd=0<this._crossProduct(this._sub(Rb,Qb),this._sub(fe,Qb));else{Rb=Qb;xd=0<this._crossProduct(this._sub(Rb,m),this._sub(fe,m));const Ga=24*this._geomUnitsPerPoint,Ra=this._sub(Rb,m);this._normalize(Ra,Ga);const db=Math.sqrt(2)/2;this._rotateDirect(Ra,db,xd?db:-db);Qb=this._add(m,
Ra)}const Me=this._sub(Qb,m),yf=Math.cos(Math.PI/18),Ne=Math.sin(Math.PI/18),Pc=[Qb];for(let Ga=1;36>=Ga;Ga++)this._rotateDirect(Me,yf,Ne),Pc.push(this._add(m,Me));this._add90DegArc(Pc,Qb,Rb,fe,xd);k.setId(Pc[Pc.length-8],1);c.push(Pc);break;case l.GeometricEffectControlMeasureLineRule.DoubleJog:let Sb=this._cp2(e,-3,1),pc=this._cp3(e,Sb,-1,-.5),Tb;if(4<=x)Tb=e[3];else{const Ga=m;m=Sb;Tb=pc;const Ra=this._dist(m,Ga),db=this._dist(Tb,Ga);let qb=30*this._geomUnitsPerPoint;.5*Ra<qb&&(qb=.5*Ra);.5*db<
qb&&(qb=.5*db);Sb=this._mix(m,qb/Ra,Ga,(Ra-qb)/Ra);pc=this._mix(Tb,qb/db,Ga,(db-qb)/db)}const Oe=this._mid(m,Sb),ge=this._mid(Tb,pc),zf=this._dist(m,Sb),Af=this._dist(pc,Tb);let yd=Math.min(zf,Af)/8;yd=Math.min(yd,24*this._geomUnitsPerPoint);const $b=Math.cos(Math.PI/4);let rb=this._sub(m,Sb);this._normalize(rb,yd);0<this._crossProduct(rb,this._sub(Tb,Sb))?this._rotateDirect(rb,$b,-$b):this._rotateDirect(rb,$b,$b);let Ab=[];Ab.push(Sb);Ab.push(this._add(Oe,rb));Ab.push(this._sub(Oe,rb));Ab.push(m);
c.push(Ab);rb=this._sub(Tb,pc);this._normalize(rb,yd);0>this._crossProduct(rb,this._sub(m,pc))?this._rotateDirect(rb,$b,$b):this._rotateDirect(rb,$b,-$b);Ab=[];Ab.push(pc);Ab.push(this._add(ge,rb));Ab.push(this._sub(ge,rb));Ab.push(Tb);c.push(Ab);break;case l.GeometricEffectControlMeasureLineRule.PerpendicularOffset:const zd=this._cp2(e,-4,1),Pe=this._cp3(e,zd,.882353,-1.94),ac=this._sub(Pe,zd);0<this._crossProduct(ac,this._sub(m,zd))?this._rightPerpendicular(ac):this._leftPerpendicular(ac);const Bf=
[ac[0]/8,ac[1]/8],Cf=this._sub(this._mid(zd,Pe),Bf);c.push([Cf,m]);break;case l.GeometricEffectControlMeasureLineRule.LineExcludingLastSegment:const Qe=this._arrowPath(e),Re=[];let he=Qe.length-2;for(;he--;)Re.push(Qe[he]);c.push(Re);break;case l.GeometricEffectControlMeasureLineRule.MultivertexArrow:const Df=this._arrowPath(e),Se=[];this._addArrow(Se,Df,!1);c.push(Se);break;case l.GeometricEffectControlMeasureLineRule.CrossedArrow:const Te=this._arrowPath(e),Ue=[];this._addArrow(Ue,Te,!0);c.push(Ue);
break;case l.GeometricEffectControlMeasureLineRule.ChevronArrow:const [Ac,ie]=this._arrowLastSeg(e),Bc=10*this._geomUnitsPerPoint,Bb=this._sub(m,Ac),Ad=this._norm(Bb);this._normalize(Bb);const Bd=this._crossProduct(Bb,this._sub(ie,Ac));let Cc=this._dotProduct(Bb,this._sub(ie,Ac));Cc<.05*Ad?Cc=.05*Ad:Cc>.95*Ad-Bc&&(Cc=.95*Ad-Bc);const Cd=[Ac[0]+Bb[0]*Cc,Ac[1]+Bb[1]*Cc],Dd=this._leftPerp(Bb),Ed=[];Ed.push([Cd[0]+Dd[0]*Bd+Bb[0]*Bc,Cd[1]+Dd[1]*Bd+Bb[1]*Bc]);Ed.push(m);Ed.push([Cd[0]-Dd[0]*Bd+Bb[0]*Bc,
Cd[1]-Dd[1]*Bd+Bb[1]*Bc]);c.push(Ed);break;case l.GeometricEffectControlMeasureLineRule.ChevronArrowOffset:const [Qc,Ve]=this._arrowLastSeg(e),Cb=this._sub(m,Qc),Fd=this._norm(Cb);this._normalize(Cb);const Gd=this._crossProduct(Cb,this._sub(Ve,Qc));let Dc=this._dotProduct(Cb,this._sub(Ve,Qc));Dc<.05*Fd?Dc=.05*Fd:Dc>.95*Fd&&(Dc=.95*Fd);const Rc=[Qc[0]+Cb[0]*Dc,Qc[1]+Cb[1]*Dc];this._leftPerpendicular(Cb);const Hd=[];Hd.push([Rc[0]+Cb[0]*Gd*.5,Rc[1]+Cb[1]*Gd*.5]);Hd.push(this._mid(Rc,m));Hd.push([Rc[0]-
Cb[0]*Gd*.5,Rc[1]-Cb[1]*Gd*.5]);c.push(Hd);break;case l.GeometricEffectControlMeasureLineRule.PartialFirstSegment:const [Sc,Ef]=this._arrowLastSeg(e),Tc=this._sub(m,Sc),Id=this._norm(Tc);this._normalize(Tc);let Ec=this._dotProduct(Tc,this._sub(Ef,Sc));Ec<.05*Id?Ec=.05*Id:Ec>.95*Id&&(Ec=.95*Id);c.push([Sc,[Sc[0]+Tc[0]*Ec,Sc[1]+Tc[1]*Ec]]);break;case l.GeometricEffectControlMeasureLineRule.Arch:const je=this._cp2(e,0,-1),Jd=this._cp3(e,je,.5,1),We=this._sub(m,je),Ff=this._mix(Jd,1,We,.55),Gf=this._mix(Jd,
1,We,-.55),ke=[m];this._addBezier2(ke,m,Ff,Jd,4);this._addBezier2(ke,Jd,Gf,je,4);c.push(ke);break;case l.GeometricEffectControlMeasureLineRule.CurvedParallelTicks:const bc=this._cp2(e,-4,1),Uc=this._cp3(e,bc,.882353,-1.94),qc=this._sub(Uc,bc);0<this._crossProduct(qc,this._sub(m,bc))?this._rightPerpendicular(qc):this._leftPerpendicular(qc);const le=[qc[0]/8,qc[1]/8],Xe=this._sub(this._mid(bc,Uc),le),Hf=this._sub(this._mix(bc,.75,Uc,.25),le),If=this._sub(this._mix(bc,.25,Uc,.75),le),Kd=[bc];this._addBezier2(Kd,
bc,Hf,Xe,3);this._addBezier2(Kd,Xe,If,Uc,3);c.push(Kd);for(let Ga=0;8>Ga;Ga++){const Ra=Kd[2*Ga+1],db=[this._clone(Ra)];db.push(this._add(Ra,[qc[0]/4,qc[1]/4]));c.push(db)}break;case l.GeometricEffectControlMeasureLineRule.Arc90Degrees:const me=this._cp2(e,0,-1),Jf=this._cp3(e,me,.5,1),Ye=[me];this._add90DegArc(Ye,me,m,Jf);c.push(Ye);break;case l.GeometricEffectControlMeasureLineRule.TipWithPerpendicularAndTicks:const [ne,Ze]=this._arrowLastSeg(e),Fc=10*this._geomUnitsPerPoint,Db=this._sub(m,ne),
Vc=this._norm(Db);this._normalize(Db);let Jb=this._crossProduct(Db,this._sub(Ze,ne)),Wc=this._dotProduct(Db,this._sub(Ze,ne));Wc<.05*Vc?Wc=.05*Vc:Wc>.95*Vc-Fc&&(Wc=.95*Vc-Fc);const cc=this._leftPerp(Db),Ub=[m[0]-Db[0]*Fc,m[1]-Db[1]*Fc],dc=.5*Math.max(Vc-Wc-Fc,Fc);Jb=Math.abs(Jb);const Xc=[];Xc.push([Ub[0]+cc[0]*(Jb+dc)-Db[0]*dc,Ub[1]+cc[1]*(Jb+dc)-Db[1]*dc]);Xc.push([Ub[0]+cc[0]*Jb,Ub[1]+cc[1]*Jb]);Xc.push([Ub[0]-cc[0]*Jb,Ub[1]-cc[1]*Jb]);Xc.push([Ub[0]-cc[0]*(Jb+dc)-Db[0]*dc,Ub[1]-cc[1]*(Jb+dc)-
Db[1]*dc]);c.push(Xc);c.push([Ub,m]);break;case l.GeometricEffectControlMeasureLineRule.ConcentricCircles:const $e=this._cp2(e,1,0),Kf=this._cp3(e,$e,2,0),oe=Math.cos(Math.PI/18),pe=Math.sin(Math.PI/18);let Gc=this._dist($e,m),Kb=[Gc,0],P=[];for(let Ga=0;36>=Ga;Ga++)P.push(this._add(m,Kb)),this._rotateDirect(Kb,oe,pe);c.push(P);if(4<=x){P=[];Gc=this._dist(e[3],m);Kb=[Gc,0];for(let Ga=0;36>=Ga;Ga++)P.push(this._add(m,Kb)),0===Ga&&(P.push(this._add(m,Kb)),k.setId(P[1],1)),this._rotateDirect(Kb,oe,pe);
c.push(P)}P=[];Gc=this._dist(Kf,m);Kb=[Gc,0];for(let Ga=0;36>=Ga;Ga++)P.push(this._add(m,Kb)),this._rotateDirect(Kb,oe,pe);c.push(P);break;case l.GeometricEffectControlMeasureLineRule.DoubleJogArrow:m=this._arrowPath(e)[0];const [xa,rc]=this._arrowLastSeg(e),Va=this._sub(m,xa),sc=this._norm(Va);this._normalize(Va);const ta=Math.abs(this._crossProduct(Va,this._sub(rc,m)));let vb=Math.abs(this._dotProduct(Va,this._sub(rc,m)));vb<.05*sc?vb=.05*sc:vb>.95*sc&&(vb=.95*sc);const U=Math.max(ta,vb),V=this._leftPerp(Va);
let fa=[];const ma=[m[0]-Va[0]*vb*.5+V[0]*ta*.5,m[1]-Va[1]*vb*.5+V[1]*ta*.5];fa.push([ma[0],ma[1]]);ma[0]+=Va[0]*U*.5+V[0]*U*.4;ma[1]+=Va[1]*U*.5+V[1]*U*.4;fa.push([ma[0],ma[1]]);ma[0]-=V[0]*U*.25;ma[1]-=V[1]*U*.25;fa.push([ma[0],ma[1]]);ma[0]+=Va[0]*U*.5+V[0]*U*.4;ma[1]+=Va[1]*U*.5+V[1]*U*.4;fa.push([ma[0],ma[1]]);c.push(fa);fa=[];ma[0]=m[0]-Va[0]*vb*.5-V[0]*ta*.5;ma[1]=m[1]-Va[1]*vb*.5-V[1]*ta*.5;fa.push([ma[0],ma[1]]);ma[0]+=Va[0]*U*.5-V[0]*U*.4;ma[1]+=Va[1]*U*.5-V[1]*U*.4;fa.push([ma[0],ma[1]]);
ma[0]+=V[0]*U*.25;ma[1]+=V[1]*U*.25;fa.push([ma[0],ma[1]]);ma[0]+=Va[0]*U*.5-V[0]*U*.4;ma[1]+=Va[1]*U*.5-V[1]*U*.4;fa.push([ma[0],ma[1]]);c.push(fa);break;case l.GeometricEffectControlMeasureLineRule.LinkedChevrons:const Ca=this._cp2(e,-5,0),Da=this._cp3(e,Ca,-.2,1),Ka=this._sub(m,Ca);this._normalize(Ka);const Sa=this._leftPerp(Ka),eb=Math.abs(this._crossProduct(Ka,this._sub(Da,Ca)));c.push([Ca,m]);const jb=[];jb.push([m[0]-Ka[0]*eb+Sa[0]*eb,m[1]-Ka[1]*eb+Sa[1]*eb]);jb.push(m);jb.push([m[0]-Ka[0]*
eb-Sa[0]*eb,m[1]-Ka[1]*eb-Sa[1]*eb]);c.push(jb);this._addDash(c,Ca,[-Ka[0]*eb+Sa[0]*eb,-Ka[1]*eb+Sa[1]*eb]);this._addDash(c,Ca,[-Ka[0]*eb-Sa[0]*eb,-Ka[1]*eb-Sa[1]*eb]);break;case l.GeometricEffectControlMeasureLineRule.SegmentThenHalfCircle:const Eb=this._cp2(e,2,0),Yc=this._cp3(e,Eb,1.5,0);let Hc;Hc=4<=x?e[3]:this._cp3(e,Eb,1.25,-.5);const sb=this._sub(Eb,m);this._normalize(sb);const ec=.5*this._dist(Eb,Yc),Ic=0<this._crossProduct(sb,this._sub(Hc,m)),Zc=Math.cos(Math.PI/18);let tc=Math.sin(Math.PI/
18);Ic&&(tc=-tc);const af=[m,Eb];sb[0]*=ec;sb[1]*=ec;const Lf=this._add(Eb,sb);sb[0]=-sb[0];sb[1]=-sb[1];for(let Ga=1;18>=Ga;Ga++)this._rotateDirect(sb,Zc,tc),af.push(this._add(Lf,sb));c.push(af);break;case l.GeometricEffectControlMeasureLineRule.LineWithStraightTicks:const Vb=this._cp2(e,-2,1),uc=this._cp3(e,Vb,-1,-.5),Fb=this._sub(uc,Vb);this._normalize(Fb);const bf=this._dotProduct(Fb,this._sub(Vb,m)),Ld=this._dotProduct(Fb,this._sub(uc,m));let tb=[m];tb.push([m[0]+Fb[0]*bf,m[1]+Fb[1]*bf]);tb.push(Vb);
c.push(tb);tb=[m];tb.push([m[0]+Fb[0]*Ld,m[1]+Fb[1]*Ld]);tb.push(uc);c.push(tb);break;case l.GeometricEffectControlMeasureLineRule.DoubleCurve:const Lb=this._cp2(e,-5,-1),ub=this._cp3(e,Lb,2,0),$c=Math.atan2(1,5),$a=Math.cos($c),Md=Math.sin($c),pb=this._sub(Lb,m),Mb=this._dist(m,Lb);this._normalize(pb);this._rotateDirect(pb,$a,-Md);const Wb=[m];Wb.push([m[0]+pb[0]*Mb*.5,m[1]+pb[1]*Mb*.5]);k.setId(Wb[1],1);Wb.push([m[0]+pb[0]*Mb*.8,m[1]+pb[1]*Mb*.8]);this._addBezier2(Wb,Wb[2],[m[0]+pb[0]*Mb,m[1]+pb[1]*
Mb],Lb,3);const Jc=this._sub(ub,Lb),Nd=this._dist(Lb,ub);this._normalize(Jc);this._rotateDirect(Jc,$a,-Md);this._addBezier2(Wb,Lb,[ub[0]-Jc[0]*Nd,ub[1]-Jc[1]*Nd],[ub[0]-Jc[0]*Nd*.8,ub[1]-Jc[1]*Nd*.8],3);Wb.push(ub);c.push(Wb);break;case l.GeometricEffectControlMeasureLineRule.ParallelWithTicksByWidth:const Nb=this._cp2(e,0,-1),Mf=this._cp3(e,Nb,.5,3),kb=this._sub(Nb,m);this._normalize(kb);const wb=this._crossProduct(kb,this._sub(Mf,m));this._leftPerpendicular(kb);0<wb?(this._addAngledTicks(c,m,[m[0]+
kb[0]*wb,m[1]+kb[1]*wb],Nb),this._addAngledTicks(c,Nb,[Nb[0]+kb[0]*wb,Nb[1]+kb[1]*wb],m)):(this._addAngledTicks(c,[m[0]+kb[0]*wb,m[1]+kb[1]*wb],m,Nb),this._addAngledTicks(c,[Nb[0]+kb[0]*wb,Nb[1]+kb[1]*wb],m,Nb));break;case l.GeometricEffectControlMeasureLineRule.EnclosingRoundedRectangle:const Qa=this._cp2(e,3,-2),Wa=[Math.min(m[0],Qa[0]),Math.max(m[1],Qa[1])],La=[Math.max(m[0],Qa[0]),Math.min(m[1],Qa[1])],ad=La[0]-Wa[0],fb=Math.min(ad,Wa[1]-La[1])/10,xb=[];xb.push([Wa[0]+fb+.75*(ad-2*fb),Wa[1]]);
xb.push([La[0]-fb,Wa[1]]);this._add90DegArc(xb,[La[0]-fb,Wa[1]],[La[0],Wa[1]-fb],[La[0],Wa[1]]);xb.push([La[0],La[1]+fb]);this._add90DegArc(xb,[La[0],La[1]+fb],[La[0]-fb,La[1]],La);xb.push([Wa[0]+fb,La[1]]);this._add90DegArc(xb,[Wa[0]+fb,La[1]],[Wa[0],La[1]+fb],[Wa[0],La[1]]);xb.push([Wa[0],Wa[1]-fb]);this._add90DegArc(xb,[Wa[0],Wa[1]-fb],[Wa[0]+fb,Wa[1]],Wa);xb.push([Wa[0]+fb+.75*(ad-2*fb),Wa[1]]);break;default:c.push(e)}}return c}}b.EffectControlMeasureLine=a;Object.defineProperty(b,Symbol.toStringTag,
{value:"Module"})})},"esri/symbols/cim/effects/EffectCut":function(){define(["exports","../../../geometry/GeometryCursor","../CIMCursor","../CurveHelper"],function(b,q,n,g){class k{static local(){null===k.instance&&(k.instance=new k);return k.instance}execute(a,f,d,c,e){return new l(a,f,d)}}k.instance=null;class l extends n.PathEffectCursor{constructor(a,f,d){super(a,!0,!0);this._curveHelper=new g.CurveHelper;this._beginCut=(void 0!==f.beginCut?f.beginCut:1)*d;this._endCut=(void 0!==f.endCut?f.endCut:
1)*d;this._middleCut=(void 0!==f.middleCut?f.middleCut:0)*d;this._invert=void 0!==f.invert?f.invert:!1;0>this._beginCut&&(this._beginCut=0);0>this._endCut&&(this._endCut=0);0>this._middleCut&&(this._middleCut=0)}processPath(a){const {_beginCut:f,_endCut:d,_middleCut:c}=this,e=a.pathLength(),h=q.GeometryCursor.createEmptyOptimizedCIM("esriGeometryPolyline");if(!this._invert)if(0===f&&0===d&&0===c)for(h.startPath();a.nextPoint();)h.pushXY(a.x,a.y);else f+d+c<e&&(0===c?this._curveHelper.appendSubCurve(h,
a,f,e-d):(this._curveHelper.appendSubCurve(h,a,f,.5*(e-c)),this._curveHelper.appendSubCurve(h,a,.5*(e+c),e-d)));else if(0!==f||0!==d||0!==c)if(f+d+c>=e)for(h.startPath();a.nextPoint();)h.pushXY(a.x,a.y);else this._curveHelper.appendSubCurve(h,a,0,f),this._curveHelper.appendSubCurve(h,a,.5*(e-c),.5*(e+c)),this._curveHelper.appendSubCurve(h,a,e-d,d);return 0===h.totalSize?null:h}}b.EffectCut=k;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/effects/EffectDashes":function(){define("exports ../../../geometry/GeometryCursor ../../../geometry/geometryCursorCollectUtils ../CIMCursor ../enums ../GeometryWalker ../utils".split(" "),
function(b,q,n,g,k,l,a){class f{static local(){null===f.instance&&(f.instance=new f);return f.instance}execute(c,e,h,x,m){return new d(c,e,h)}}f.instance=null;class d extends g.PathEffectCursor{constructor(c,e,h){super(c,!0,!0);this._firstCurve=null;this._walker=new l.GeometryWalker;this._walker.updateTolerance(h);this._endings=e.lineDashEnding;this._customDashPos=-(e.offsetAlongLine??0)*h;this._offsetAtEnd=(e.customEndingOffset??0)*h;c=a.normalizeDashEffectTemplate(e).dashTemplate;null==c&&(c=[]);
c.length%2&&(c=[...c,...c]);this._pattern=new l.DashPattern;this._pattern.init(c,!0);this._pattern.scale(h)}processPath(c){if(0===this._pattern.length())return this.iteratePath=!1,c=n.collectPath(c),q.GeometryCursor.fromJSONCIM({paths:[c]});if(!this.iteratePath){var e=!0;switch(this._endings){default:this._pattern.extPtGap=0;break;case k.LineDashEnding.FullPattern:this.isClosed||(this._pattern.extPtGap=.5*this._pattern.firstValue());break;case k.LineDashEnding.FullGap:this.isClosed||(this._pattern.extPtGap=
.5*this._pattern.lastValue());break;case k.LineDashEnding.NoConstraint:this.isClosed||(e=!1);break;case k.LineDashEnding.Custom:this.isClosed||(this._pattern.extPtGap=.5*this._offsetAtEnd)}var h=c.pathLength();if(this._pattern.isEmpty()||h<.1*this._pattern.length()||!this._walker.init(c,this._pattern,e))return c=n.collectPath(c),q.GeometryCursor.fromJSONCIM({paths:[c]})}if(this.iteratePath)c=this._pattern.nextValue();else{switch(this._endings){default:e=.5*this._pattern.firstValue();break;case k.LineDashEnding.HalfGap:e=
.5*-this._pattern.lastValue();break;case k.LineDashEnding.FullGap:e=-this._pattern.lastValue();break;case k.LineDashEnding.FullPattern:e=0;break;case k.LineDashEnding.NoConstraint:case k.LineDashEnding.Custom:e=-this._customDashPos}c=e/this._pattern.length();c-=Math.floor(c);e=c*this._pattern.length();this._pattern.reset();c=this._pattern.nextValue();for(h=!1;e>=c;)e-=c,c=this._pattern.nextValue(),h=!h;c-=e;h?(this._walker.nextPosition(c),c=this._pattern.nextValue()):this.isClosed&&(this._firstCurve=
this._walker.nextCurve(c),c=this._pattern.nextValue(),this._walker.nextPosition(c),c=this._pattern.nextValue())}if(e=this._walker.nextCurve(c))if(this._walker.isPathEnd()){if(this.iteratePath=!1,this._firstCurve){for(this._firstCurve.nextPath();this._firstCurve.nextPoint();)e.pushXY(this._firstCurve.x,this._firstCurve.y);this._firstCurve=null}}else c=this._pattern.nextValue(),!this._walker.nextPosition(c)||this._walker.isPathEnd()?(this.iteratePath=!1,this._firstCurve&&(e.pushCursor(this._firstCurve),
this._firstCurve=null)):this.iteratePath=!0;else this.iteratePath=!1,e=this._firstCurve,this._firstCurve=null;e?.reset();return e}}b.EffectDashes=f;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/GeometryWalker":function(){define(["exports","../../geometry/GeometryCursor","./CurveHelper"],function(b,q,n){class g{constructor(){this._values=[];this._currentValue=this._length=this.ctrlPtGap=this.extPtGap=0}isEmpty(){return 0===this._values.length}size(){return this._values.length}init(f,
d,c=!0){this._setEmpty();if(!f||0===f.length)return!1;for(let e=0;e<f.length;e++){let h=Math.abs(f[e]);c&&1E-7>h&&(h=1E-7);this._values.push(h);this._length+=h}d&&f.length&1&&(this._length*=2);if(0===this._length)return!1;this.ctrlPtGap=this.extPtGap=0;this._currentValue=-1;return!0}scale(f){const d=this._values?this._values.length:0;for(let c=0;c<d;++c)this._values[c]*=f;this._length*=f;this.extPtGap*=f;this.ctrlPtGap*=f}addValue(f){this._length+=f;this._values.push(f)}firstValue(){return this._values[0]}lastValue(){return this._values[this._values.length-
1]}nextValue(){this._currentValue++;this._currentValue===this._values.length&&(this._currentValue=0);return this._values[this._currentValue]}reset(){this._currentValue=-1}length(){return this._length}_setEmpty(){this.extPtGap=this.ctrlPtGap=this._length=0;this._currentValue=-1;this._values.length=0}}class k{constructor(){this.pt=null;this.sa=this.ca=0}}b.EndType=void 0;(function(f){f[f.FAIL=0]="FAIL";f[f.END=1]="END";f[f.CONTINUE=2]="CONTINUE"})(b.EndType||(b.EndType={}));class l{constructor(){this.reset()}reset(){this.segment=
null;this.abscissa=this.segmentLength=0;this.isPartEnd=this.isPathEnd=!1}isValid(){return null!==this.segment}copyTo(f){f.segment=this.segment;f.segmentLength=this.segmentLength;f.abscissa=this.abscissa;f.isPathEnd=this.isPathEnd;f.isPartEnd=this.isPartEnd}}class a extends n.CurveHelper{constructor(f=0,d=!1){super(f,d);this._tolerance=n.pixelTolerance;this._currentPosition=new l}updateTolerance(f){this._tolerance=n.pixelTolerance*f}init(f,d,c=!0){c?(this._patternLength=d.length(),this._partExtPtGap=
d.extPtGap,this._partCtrlPtGap=d.ctrlPtGap):this._partCtrlPtGap=this._partExtPtGap=this._patternLength=0;this._currentPosition.reset();this._partSegCount=0;this._pathCursor=f;this._seg=-1;return this._setPosAtNextPart()}curPositionIsValid(){return this._currentPosition.isValid()}nextPosition(f,d=b.EndType.FAIL){const c=new l;if(!this._nextPosition(f,c,null,d))return!1;c.copyTo(this._currentPosition);return!0}curPointAndAngle(f){f.pt=this._getPoint(this._currentPosition);const [d,c]=this._getAngleCS(this._currentPosition);
f.ca=d;f.sa=c}nextPointAndAngle(f,d,c=b.EndType.FAIL){const e=new l;if(!this._nextPosition(f,e,null,c))return!1;e.copyTo(this._currentPosition);d.pt=this._getPoint(e);const [h,x]=this._getAngleCS(e);d.ca=h;d.sa=x;return!0}nextCurve(f){if(0===f)return null;const d=q.GeometryCursor.createEmptyOptimizedCIM("esriGeometryPolyline");d.startPath();d.nextPath();const c=new l;if(!this._nextPosition(f,c,d,b.EndType.END))return null;c.copyTo(this._currentPosition);return d}isPathEnd(){return this._currentPosition.isPathEnd}getPathEnd(){return this._currentPosition.segment[1]}getPt(f){this._pathCursor.seekInPath(f);
return[this._pathCursor.x,this._pathCursor.y]}getSeg(f){const d=this.getPt(f);f=this.getPt(f+1);return[d,f]}_nextPosition(f,d,c,e){if(this._currentPosition.isPathEnd)return!1;var h=this._currentPosition.abscissa;0<this._currentPosition.segmentLength&&(h/=this._currentPosition.segmentLength);for(this._currentPosition.copyTo(d);d.abscissa+f*this._partLengthRatio>d.segmentLength+this._tolerance;)if(c&&(0===c.pathSize&&(0===h?(h=d.segment[0],c.pushXY(h[0],h[1])):c.pushPoint(this.getSegCoord2D(d.segment,
h))),h=d.segment[1],c.pushXY(h[0],h[1])),h=0,f-=(d.segmentLength-d.abscissa)/this._partLengthRatio,this._partSegCount)d.segment=this._nextSegment(),d.segmentLength=this.getSegLength(d.segment),d.abscissa=0,this._partSegCount--;else{if(!this._setPosAtNextPart()){if(e===b.EndType.FAIL)return!1;d.segmentLength=this.getSegLength(d.segment);d.isPartEnd=!0;e===b.EndType.END?(d.abscissa=d.segmentLength,d.isPathEnd=!0):d.abscissa=d.segmentLength+f;return!0}this._currentPosition.copyTo(d)}d.abscissa+=f*this._partLengthRatio;
c&&(0===c.pathSize&&(0===h?c.pushPoint(d.segment[0]):c.pushPoint(this.getSegCoord2D(d.segment,h))),f=d.abscissa/d.segmentLength,1===f?c.pushPoint(d.segment[1]):c.pushPoint(this.getSegCoord2D(d.segment,f)));!this._partSegCount&&Math.abs(d.abscissa-d.segmentLength)<this._tolerance&&(d.isPathEnd=this._partIsLast,d.isPartEnd=!0);return!0}_getPoint(f){return this.getSegCoord2D(this._currentPosition.segment,0>=f.segmentLength?0:f.abscissa/f.segmentLength)}_getAngleCS(f){return this.getSegAngleCS(this._currentPosition.segment,
0>=f.segmentLength?0:f.abscissa/f.segmentLength)}_setPosAtNextPart(){for(;this._partSegCount;)this._hasNextSegment()&&this._nextSegment(),this._partSegCount--;if(!this._hasNextSegment())return!1;this._partLength=0;this._partIsLast=!0;for(this._partSegCount=0;this._hasNextSegment();)if(this._partLength+=this.getSegLength(this._nextSegment()),this._partSegCount++,this._pathCursor.getControlPointAt(this._getEndPointIndex())){this._partIsLast=!this._hasNextSegment();break}for(var f=this._partSegCount;f;)this._previousSegment(),
--f;this._currentPosition.segment=this._nextSegment();this._currentPosition.segmentLength=this.getSegLength(this._currentPosition.segment);this._currentPosition.abscissa=0;this._currentPosition.isPathEnd=this._currentPosition.isPartEnd=!1;--this._partSegCount;f=this._getStartPointIndex();this._ctrlPtBegin=this._pathCursor.getControlPointAt(f);f=f+this._partSegCount+1;f>=this._pathCursor.pathSize&&(f=0);this._ctrlPtEnd=this._pathCursor.getControlPointAt(f);if(0<this._patternLength){f=this._ctrlPtBegin?
this._partCtrlPtGap:this._partExtPtGap;const d=this._ctrlPtEnd?this._partCtrlPtGap:this._partExtPtGap;let c=Math.round((this._partLength-(f+d))/this._patternLength);0>=c&&(c=0<f+d?0:1);this._partLengthRatio=this._partLength/(f+d+c*this._patternLength);.01>this._partLengthRatio&&(this._partLengthRatio=1)}else this._partLengthRatio=1;return!0}_hasNextSegment(){return this._seg<this._pathCursor.pathSize-2}_previousSegment(){return this.getSeg(--this._seg)}_nextSegment(){return this.getSeg(++this._seg)}_getStartPointIndex(){return this._seg}_getEndPointIndex(){return this._seg+
1}}b.DashPattern=g;b.GeometryWalker=a;b.Pos=k;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/utils":function(){define(["require","exports","./defaultCIMValues"],function(b,q,n){function g(u){return"function"===typeof u}function k(u){let v=u.length;for(;v--;)if(!" /-,\n".includes(u.charAt(v)))return!1;return!0}function l(u,v){"string"!==typeof u&&(u=String(u));switch(v){case "LowerCase":return u.toLowerCase();case "Allcaps":return u.toUpperCase();default:return u}}
function a(u){return u?[u[0],u[1],u[2],u[3]/255]:[0,0,0,0]}function f(u){return null!=u&&("CIMMarkerPlacementAlongLineRandomSize"===u.type||"CIMMarkerPlacementAlongLineSameSize"===u.type||"CIMMarkerPlacementAlongLineVariableSize"===u.type||"CIMMarkerPlacementAtExtremities"===u.type||"CIMMarkerPlacementAtMeasuredUnits"===u.type||"CIMMarkerPlacementAtRatioPositions"===u.type||"CIMMarkerPlacementOnLine"===u.type||"CIMMarkerPlacementOnVertices"===u.type)}function d(u){if(!u)return null;switch(u.type){case "CIMPolygonSymbol":if(u.symbolLayers)for(const v of u.symbolLayers)if(u=
d(v),null!=u)return u;break;case "CIMTextSymbol":return d(u.symbol);case "CIMSolidFill":return u.color}return null}function c(u){if(u)switch(u.type){case "CIMPolygonSymbol":case "CIMLineSymbol":if(u=u.symbolLayers)for(const v of u)if(u=c(v),null!=u)return u;break;case "CIMTextSymbol":return c(u.symbol);case "CIMSolidStroke":return u.color}}function e(u){if(u)switch(u.type){case "CIMPolygonSymbol":case "CIMLineSymbol":if(u.symbolLayers)for(const v of u.symbolLayers)if(u=e(v),void 0!==u)return u;break;
case "CIMTextSymbol":return e(u.symbol);case "CIMSolidStroke":case "CIMGradientStroke":case "CIMPictureStroke":return u.width}}function h(u){return u?u.charAt(0).toLowerCase()+u.slice(1):u}function x(u){if(null==u)return!1;if(Array.isArray(u))return u.every(v=>x(v));switch(typeof u){case "string":return!!u;case "number":return!isNaN(u)}}function m(u,v){if("color"===v||"outlinecolor"===v||"backgroundcolor"===v||"borderlinecolor"===v||"tintcolor"===v)return[...n.defaultCIMColor[v]];const A=n.defaultCIMValues[u];
if(!A)throw Error(`InternalError: default value for type ${u}.`);return A[v]}function p(u){return u.split(" ").map(v=>Number(v))}function t(u){return"string"===typeof u?p(u):u}function w(u){if(null==u)return"Normal";switch(u.type){case "CIMTextSymbol":return u.textCase??"Normal";case "CIMPointSymbol":case "CIMLineSymbol":case "CIMPolygonSymbol":var v=u.symbolLayers;if(!v)break;for(var A of v)if("CIMVectorMarker"===A.type)return w(A);break;case "CIMVectorMarker":if(A=u.markerGraphics)for(v of A)if(v.symbol)return w(v.symbol)}return"Normal"}
function r(u,v){return null!==v?(v=v.get(u))?v.name:u:u}function y(u,v,A,B,F){return(A=A*Math.PI/180)?(Math.sin(A)*u+Math.cos(A)*v)*B+F:v*B+F}function z(u,v,A,B,F){return(A=A*Math.PI/180)?(Math.cos(A)*u-Math.sin(A)*v)*B+F:u*B+F}q.adjustTextCase=l;q.analyzeTextParts=function(u,v){const A=[];var B=0;let F=-1;do F=u.indexOf("[",B),F>=B&&(F>B&&(B=u.slice(B,F),A.push([B,null,k(B)])),B=F+1,F=u.indexOf("]",B),F>=B&&(F>B&&(B=u.slice(B,F),(B=v[B])&&A.push([null,B,!1])),B=F+1));while(-1!==F);B<u.length&&(u=
u.slice(B),A.push([u,null,k(u)]));return A};q.applyParentTransform=function(u,v,A,B,F,H,J=!0){const {infos:E}=H;H=1;let K=0;var C=0,D=0;let G=1;for(const {absoluteAnchorPoint:N,offsetX:Y,offsetY:ca,rotation:ka,size:Q,frameHeight:R,rotateClockWise:Z,scaleSymbolsProportionally:da}of E)G=N?1:H,C=z(Y,ca,K,G,C),D=y(Y,ca,K,G,D),R&&(da||J)&&(H*=Q/R),K=Z?K-ka:K+ka;J=z(B,F,K,G,C);B=y(B,F,K,G,D);return{size:u*H,rotation:A?K-v:K+v,offsetX:J,offsetY:B}};q.assignTextValuesFromFeature=function(u,v,A,B){let F="",
H=null;for(const J of v){const [E,K,C]=J;if(E)C?H=E:(H&&(F+=H,H=null),F+=E);else if(v=K,null!=A&&(v=r(K,A)),v=u.attributes[v])H&&(F+=H,H=null),F+=v}return l(F,B)};q.attributesToFields=function(u){return(u?Object.keys(u):[]).map(v=>({name:v,alias:v,type:"string"===typeof u[v]?"esriFieldTypeString":"esriFieldTypeDouble"}))};q.colorToArray=function(u){return[u.r,u.g,u.b,u.a]};q.evaluateValueOrFunction=function(u,v,A,B){return g(u)?u(v,A,B):u};q.fromCIMFontDecoration=function(u){return u.underline?"underline":
u.strikethrough?"line-through":"none"};q.fromCIMFontStyle=function(u){let v="normal",A="normal";u&&(u=u.toLowerCase(),u.includes("italic")?v="italic":u.includes("oblique")&&(v="oblique"),u.includes("bold")?A="bold":u.includes("light")&&(A="lighter"));return{style:v,weight:A}};q.fromCIMHorizontalAlignment=function(u){switch(u){default:return"left";case "Right":return"right";case "Center":return"center";case "Justify":return"center"}};q.fromCIMVerticalAlignment=function(u){switch(u){default:return"top";
case "Center":return"middle";case "Baseline":return"baseline";case "Bottom":return"bottom"}};q.getDefaultCIMValue=m;q.getEnum=(u,v)=>null==u?v:u;q.getFieldName=r;q.getFillColor=d;q.getFontStyle=function(u){if(!u)return"normal";switch(u.toLowerCase()){case "italic":return"italic";case "oblique":return"oblique";default:return"normal"}};q.getFontWeight=function(u){if(!u)return"normal";switch(u.toLowerCase()){case "bold":return"bold";case "bolder":return"bolder";case "lighter":return"lighter";default:return"normal"}};
q.getNumericValue=(u,v=0)=>null==u||isNaN(u)?v:u;q.getProcessParam=function(u,v,A){const B="Color"===A||"TintColor"===A||"ToColor"===A,F="Rotation"===A||"Angle"===A||"ToRotation"===A;let H=v[h(A)];null!=H&&(B?H=[H[0]/255,H[1]/255,H[2]/255,H[3]/255]:F&&(H*=Math.PI/180));null==H&&(H=m(v.type,A.toLowerCase()),null!=H&&(B?H=[H[0]/255,H[1]/255,H[2]/255,H[3]]:F&&(H*=Math.PI/180)));null!=v.primitiveName&&(u=u[v.primitiveName],null!=u&&(u=u[A],null!=u&&("string"===typeof u||"number"===typeof u||Array.isArray(u)?
(H=u,null!=H&&(B?H=[H[0]/255,H[1]/255,H[2]/255,H[3]/255]:F&&(H*=Math.PI/180))):(H={valueExpressionInfo:u,defaultValue:H},null!=H&&(B?H={type:"Process",op:"ArcadeColor",value:H}:F&&(H={type:"Process",op:"Divide",left:H,right:180/Math.PI}))))));if(null==H)throw Error(`Failed to derive a value or an expression for "${A}".`);return H};q.getSize=function(u){if(u)switch(u.type){case "CIMTextSymbol":return u.height;case "CIMPointSymbol":var v=0;if(u.symbolLayers)for(var A of u.symbolLayers)if(A)switch(A.type){case "CIMCharacterMarker":case "CIMPictureMarker":case "CIMVectorMarker":case "CIMObjectMarker3D":case "CIMglTFMarker3D":u=
A.size??n.defaultCIMValues.CIMVectorMarker.size,u>v&&(v=u)}return v;case "CIMLineSymbol":case "CIMPolygonSymbol":A=0;if(u.symbolLayers)for(v of u.symbolLayers)if(v)switch(v.type){case "CIMSolidStroke":case "CIMPictureStroke":case "CIMGradientStroke":u=v.width;null!=u&&u>A&&(A=u);break;case "CIMCharacterMarker":case "CIMPictureMarker":case "CIMVectorMarker":case "CIMObjectMarker3D":case "CIMglTFMarker3D":v.markerPlacement&&f(v.markerPlacement)&&(u=v.size??n.defaultCIMValues.CIMVectorMarker.size,u>
A&&(A=u));break;case "CIMPictureFill":u=v.height,null!=u&&u>A&&(A=u)}return A}};q.getStrokeColor=c;q.getStrokeWidth=e;q.getTextCasing=w;q.getTintColor=u=>u.tintColor?a(u.tintColor):[255,255,255,1];q.getValue=(u,v)=>null!=u?u:v;q.importGeometryEngine=function(){return new Promise((u,v)=>b(["../../geometry/geometryEngineJSON"],u,v))};q.isCIMFill=function(u){return null!=u&&("CIMGradientFill"===u.type||"CIMHatchFill"===u.type||"CIMPictureFill"===u.type||"CIMSolidFill"===u.type||"CIMWaterFill"===u.type)};
q.isCIMMarker=function(u){return"CIMVectorMarker"===u.type||"CIMPictureMarker"===u.type||"CIMBarChartMarker"===u.type||"CIMCharacterMarker"===u.type||"CIMPieChartMarker"===u.type||"CIMStackedBarChartMarker"===u.type};q.isCIMMarkerStrokePlacement=f;q.isCIMStroke=function(u){return"CIMGradientStroke"===u.type||"CIMPictureStroke"===u.type||"CIMSolidStroke"===u.type};q.isFeatureValueFn=g;q.isGeometryEngineRequired=u=>{if(!u)return!1;for(const v of u)switch(v.type){case "CIMGeometricEffectBuffer":case "CIMGeometricEffectOffset":case "CIMGeometricEffectDonut":return!0}return!1};
q.isSVGImage=u=>u.includes("data:image/svg+xml");q.isValidCIMValue=x;q.mapCIMSymbolToGeometryType=function(u){if(!u)return null;switch(u.type){case "CIMPointSymbol":case "CIMTextSymbol":return"esriGeometryPoint";case "CIMLineSymbol":return"esriGeometryPolyline";case "CIMPolygonSymbol":return"esriGeometryPolygon";default:return null}};q.normalizeAlpha=a;q.normalizeDashEffectTemplate=function(u){u?.dashTemplate&&(u.dashTemplate=t(u.dashTemplate));return u};q.normalizeDashTemplate=t;q.normalizePrimitiveOverrideProps=
function(u){return u.map(v=>({...v,propertyName:h(v.propertyName)}))};q.parseDashTemplate=p;q.resampleHermite=function(u,v,A,B,F,H,J=!0){const E=v/F;A/=H;const K=Math.ceil(E/2),C=Math.ceil(A/2);for(let N=0;N<H;N++)for(let Y=0;Y<F;Y++){const ca=4*(Y+(J?H-N-1:N)*F);var D=0;let ka=0,Q=0,R=0,Z=0,da=0,ja=0;const W=(N+.5)*A;for(let aa=Math.floor(N*A);aa<(N+1)*A;aa++){var G=Math.abs(W-(aa+.5))/C;const ia=(Y+.5)*E;G*=G;for(let qa=Math.floor(Y*E);qa<(Y+1)*E;qa++){let sa=Math.abs(ia-(qa+.5))/K;D=Math.sqrt(G+
sa*sa);-1<=D&&1>=D&&(D=2*D*D*D-3*D*D+1,0<D&&(sa=4*(qa+aa*v),ja+=D*u[sa+3],Q+=D,255>u[sa+3]&&(D=D*u[sa+3]/250),R+=D*u[sa],Z+=D*u[sa+1],da+=D*u[sa+2],ka+=D))}}B[ca]=R/ka;B[ca+1]=Z/ka;B[ca+2]=da/ka;B[ca+3]=ja/Q}};q.toCIMSymbolJSON=function(u){return u.data?.symbol??null};q.toLowerCaseProps=function(u){const v={};for(const A in u){const B=u[A];v[h(A)]=B}return v};q.uncapitalize=h;Object.defineProperty(q,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/defaultCIMValues":function(){define(["exports",
"./enums"],function(b,q){q={CIMVectorMarker:{scalesymbolsproportionally:!1,respectframe:!0,anchorpointunits:"Relative",offsetx:0,offsety:0,rotateclockwise:!1,rotation:0,size:10,enable:!0,colorlocked:!1},CIMPictureMarker:{scalex:1,texturefilter:"Draft",anchorpointunits:"Relative",offsetx:0,offsety:0,rotateclockwise:!1,rotation:0,size:10,enable:!0,colorlocked:!1},CIMTextSymbol:{angle:0,anglex:0,angley:0,halosize:1,height:10,horizontalalignment:"Left",kerning:!0,letterspacing:0,letterwidth:100,ligatures:!0,
linegap:0,offsetx:0,offsety:0,strikethrough:!1,textcase:"Normal",textstring:"",underline:!1,verticalalignment:"Bottom",enable:!0,colorlocked:!1},CIMSolidStroke:{capstyle:"Round",joinstyle:"Round",miterlimit:4,width:4,enable:!0,colorlocked:!1},CIMPictureStroke:{texturefilter:"Draft",capstyle:"Round",joinstyle:"Round",miterlimit:4,width:4,enable:!0,colorlocked:!1},CIMGradientStroke:{capstyle:"Round",joinstyle:"Round",miterlimit:4,width:4,enable:!0,colorlocked:!1},CIMSolidFill:{enable:!0,colorlocked:!1},
CIMPictureFill:{offsetx:0,offsety:0,rotation:0,scalex:1,height:10,texturefilter:"Draft",enable:!0,colorlocked:!1},CIMHatchFill:{offsetx:0,offsety:0,rotation:0,separation:4,enable:!0,colorlocked:!1},CIMGeometricEffectAddControlPoints:{angletolerance:120},CIMGeometricEffectArrow:{arrowtype:"OpenEnded",width:5},CIMGeometricEffectBuffer:{size:1},CIMGeometricEffectCut:{begincut:1,endcut:1,middlecut:0,invert:!1},CIMGeometricEffectDashes:{customendingoffset:0,linedashending:"NoConstraint",offsetalongline:0},
CIMGeometricEffectDonut:{method:"Mitered",option:"Accurate",width:2},CIMGeometricEffectJog:{angle:225,length:20,position:50},CIMGeometricEffectControlMeasureLine:{rule:"FullGeometry"},CIMGeometricEffectMove:{offsetx:1,offsety:-1},CIMGeometricEffectOffset:{method:"Square",offset:1,option:"Fast"},CIMGeometricEffectRotate:{angle:15},CIMGeometricEffectScale:{xscalefactor:1.15,yscalefactor:1.15},CIMGeometricEffectWave:{amplitude:2,period:3,seed:1,waveform:"Sinus"},CIMMarkerPlacementAlongLine:{customendingoffset:0,
endings:"WithHalfGap",offsetalongline:0,placeperpart:!0,angletoline:!0,offset:0},CIMMarkerPlacementAtExtremities:{extremityplacement:"Both",offsetalongline:0,angletoline:!0,offset:0},CIMMarkerPlacementAtRatioPositions:{beginposition:0,endposition:0,flipfirst:!0,angletoline:!0,offset:0},CIMMarkerPlacementInsidePolygon:{gridangle:0,gridtype:"Fixed",offsetx:0,offsety:0,randomness:100,seed:0,shiftoddrows:!1,stepx:16,stepy:16,clipping:"ClipAtBoundary"},CIMMarkerPlacementOnLine:{relativeto:"LineMiddle",
startpointoffset:0,angletoline:!0,offset:0},CIMMarkerPlacementOnVertices:{placeperpart:!0,placeoncontrolpoints:!0,placeonendpoints:!0,placeonregularvertices:!0,angletoline:!0,offset:0},CIMMarkerPlacementPolygonCenter:{method:"OnPolygon",offsetx:0,offsety:0,clipatboundary:!1},CIMAnimatedSymbolProperties:{playanimation:!1,reverseanimation:!1,randomizestarttime:!1,randomizestartseed:0,starttimeoffset:0,duration:3,endingduration:3,useendingduration:!1,repeattype:q.AnimatedSymbolRepeatType.Loop,repeatdelay:0,
easing:q.AnimatedSymbolEasingType.Linear},CIMSymbolAnimationSize:{tosize:10},CIMSymbolAnimationScale:{scalefactor:1},CIMSymbolAnimationColor:{tocolor:[255,255,255,1]},CIMSymbolAnimationTransparency:{totransparency:0},CIMSymbolAnimationRotation:{torotation:0},CIMSymbolAnimationOffset:{offsetx:0,offsety:0}};b.defaultCIMColor={color:[128,128,128,1],outlinecolor:[0,0,0,1],backgroundcolor:[128,128,128,1],borderlinecolor:[0,0,0,1],tintcolor:[255,255,255,1]};b.defaultCIMValues=q;Object.defineProperty(b,
Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/effects/EffectDonut":function(){define("exports ../../../geometry ../../../geometry/GeometryCursor ../CIMEffects ../enums ../../../geometry/SpatialReference".split(" "),function(b,q,n,g,k,l){class a{static local(){null===a.instance&&(a.instance=new a);return a.instance}execute(d,c,e,h,x,m){return new f(d,c,e,h,x,m)}}a.instance=null;class f{constructor(d,c,e,h,x,m){this._inputGeometries=d;this._tileKey=h;this._geometryEngine=x;this._maxInflateSize=
m*e;this._width=(void 0!==c.width?c.width:2)*e;this._option=c.option}next(){for(var d;d=this._inputGeometries.next();){if("esriGeometryEnvelope"===d.geometryType&&0<this._width){var c=d.asJSON();return 0>Math.min(c.xmax-c.xmin,c.ymax-c.ymin)-2*this._width?d:n.GeometryCursor.fromJSONCIM({paths:[[[c.xmin+this._width,c.ymin+this._width],[c.xmax-this._width,c.ymin+this._width],[c.xmax-this._width,c.ymax-this._width],[c.xmin+this._width,c.ymax-this._width],[c.xmin+this._width,c.ymin+this._width]],[[c.xmin,
c.ymin],[c.xmin,c.ymax],[c.xmax,c.ymax],[c.xmax,c.ymin],[c.xmin,c.ymin]]]})}if("esriGeometryPolygon"===d.geometryType){if(0===this._width)return d.clone();var e=this._geometryEngine;if(null==e)break;if(d=this._tileKey?g.clipCursorToTileExtent(d,this._maxInflateSize):d.clone()){if(e=e.buffer(l.WebMercator,d.asJSON(),-this._width,1))for(c of e.rings)if(c){d.startPath();for(const h of c.reverse())d.pushXY(h[0],d.yFactor*h[1])}return d}}}return null}}b.EffectDonut=a;Object.defineProperty(b,Symbol.toStringTag,
{value:"Module"})})},"esri/symbols/cim/effects/EffectJog":function(){define(["exports","../../../geometry/GeometryCursor","../CIMCursor","../CurveHelper"],function(b,q,n,g){class k{static local(){null===k.instance&&(k.instance=new k);return k.instance}execute(a,f,d,c,e){return new l(a,f,d)}}k.instance=null;class l extends n.PathEffectCursor{constructor(a,f,d){super(a,!1,!0);this._curveHelper=new g.CurveHelper;this._length=(void 0!==f.length?f.length:20)*d;this._angle=void 0!==f.angle?f.angle:225;
this._position=void 0!==f.position?f.position:50;0>this._length&&(this._length=-this._length);20>this._position&&(this._position=20);80<this._position&&(this._position=80);this._mirror=!1}processPath(a){const f=q.GeometryCursor.createEmptyOptimizedCIM("esriGeometryPolyline");if(this._curveHelper.isEmpty(a))return null;a.seekInPath(0);const d=a.x,c=a.y;a.seekInPath(a.pathSize-1);const e=a.x;a=a.y;this._curveHelper.normalize([e-d,a-c]);const h=d+(e-d)*this._position/100,x=c+(a-c)*this._position/100,
m=Math.cos((90-this._angle)/180*Math.PI);let p=Math.sin((90-this._angle)/180*Math.PI);this._mirror&&(p=-p);this._mirror=!this._mirror;f.pushPath([[d,c],[h-this._length/2*m,x-this._length/2*p],[h+this._length/2*m,x+this._length/2*p],[e,a]]);return f}}b.EffectJog=k;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/effects/EffectMove":function(){define(["exports"],function(b){class q{static local(){null===q.instance&&(q.instance=new q);return q.instance}execute(g,k,l,
a,f){return new n(g,k,l)}}q.instance=null;class n{constructor(g,k,l){this._inputGeometries=g;this._offsetX=void 0!==k.offsetX?k.offsetX*l:0;this._offsetY=void 0!==k.offsetY?k.offsetY*l:0}next(){let g=this._inputGeometries.next();for(;g;){if(0<g.totalSize)return this._move(g.clone(),this._offsetX,this._offsetY);g=this._inputGeometries.next()}return null}_move(g,k,l){for(;g.nextPath();)for(;g.nextPoint();)g.x+=k,g.y+=l;g.reset();return g}}b.EffectMove=q;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},
"esri/symbols/cim/effects/EffectOffset":function(){define("exports ../../../geometry ../../../geometry/GeometryCursor ../../../geometry/geometryCursorCollectUtils ../../../geometry/support/jsonUtils ../CIMEffects ../CurveHelper ../enums ../../../geometry/SpatialReference".split(" "),function(b,q,n,g,k,l,a,f,d){class c{static local(){null===c.instance&&(c.instance=new c);return c.instance}execute(h,x,m,p,t,w){return new e(h,x,m,p,t,w)}}c.instance=null;class e{constructor(h,x,m,p,t,w){this._inputGeometries=
h;this._tileKey=p;this._geometryEngine=t;this._curveHelper=new a.CurveHelper;this._offset=(x.offset??1)*m;this._method=x.method;this._maxInflateSize=Math.max(Math.abs(w*m),10);this._option=x.option;this._offsetFlattenError=a.pixelTolerance*m}next(){for(var h;h=this._inputGeometries.next();){if(0===this._offset)return h.clone();if("esriGeometryEnvelope"===h.geometryType){if(this._method===f.GeometricEffectOffsetMethod.Rounded&&0<this._offset){var x=g.collectPath(h);if(x=this._curveHelper.offset(x,
-this._offset,this._method,4,this._offsetFlattenError))return h=n.GeometryCursor.createEmptyOptimizedCIM(h.geometryType),h.pushPath(x),h;break}x=h.asJSON();if(k.isExtent(x)&&0<Math.min(x.xmax-x.xmin,x.ymax-x.ymin)+2*this._offset)return n.GeometryCursor.fromJSONCIM({xmin:x.xmin-this._offset,xmax:x.xmax+this._offset,ymin:x.ymin-this._offset,ymax:x.ymax+this._offset})}x=this._geometryEngine;if(null!=x&&(h=this._tileKey?l.clipCursorToTileExtent(h,this._maxInflateSize):h.clone()))return(h=x.offset(d.WebMercator,
h.asJSON(),-this._offset,1,this._method,4,this._offsetFlattenError))?n.GeometryCursor.fromJSONCIM(h):null}return null}}b.EffectOffset=c;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/effects/EffectReverse":function(){define(["exports"],function(b){class q{static local(){null===q.instance&&(q.instance=new q);return q.instance}execute(g,k,l,a,f){return new n(g,k,l)}}q.instance=null;class n{constructor(g,k,l){this._inputGeometries=g;this._reverse=void 0!==k.reverse?
k.reverse:!0}next(){for(var g=this._inputGeometries.next();g;){if(!this._reverse)return g;if("esriGeometryPolyline"===g.geometryType){for(g=g.clone();g.nextPath();)for(let k=0;k<g.pathSize/2;k++){g.seekInPath(k);const l=g.x,a=g.y;g.seekInPath(g.pathSize-k-1);const f=g.x,d=g.y;g.x=l;g.y=a;g.seekInPath(k);g.x=f;g.y=d}g.reset();return g}g=this._inputGeometries.next()}return null}}b.EffectReverse=q;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/effects/EffectRotate":function(){define(["exports",
"../../../geometry/support/boundsUtils"],function(b,q){class n{static local(){null===n.instance&&(n.instance=new n);return n.instance}execute(k,l,a,f,d){return new g(k,l,a)}}n.instance=null;class g{constructor(k,l,a){this._inputGeometries=k;this._rotateAngle=void 0!==l.angle?l.angle*Math.PI/180:0}next(){let k=this._inputGeometries.next();for(;k;){if(0===this._rotateAngle||"esriGeometryPoint"===k.geometryType)return k;if(0<k.totalSize){var l=q.getCursorBoundsXY(k);const a=(l[2]+l[0])/2;l=(l[3]+l[1])/
2;k.reset();return this._rotate(k.clone(),a,l)}k=this._inputGeometries.next()}return null}_rotate(k,l,a){const f=Math.cos(this._rotateAngle),d=Math.sin(this._rotateAngle);for(;k.nextPath();)for(;k.nextPoint();){const c=k.x-l,e=k.y-a;k.x=l+c*f-e*d;k.y=a+c*d+e*f}k.reset();return k}}b.EffectRotate=n;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/effects/EffectScale":function(){define(["exports","../../../geometry/support/boundsUtils"],function(b,q){class n{static local(){null===
n.instance&&(n.instance=new n);return n.instance}execute(k,l,a,f,d){return new g(k,l,a)}}n.instance=null;class g{constructor(k,l,a){this._inputGeometries=k;this._xFactor=void 0!==l.xScaleFactor?l.xScaleFactor:1.15;this._yFactor=void 0!==l.yScaleFactor?l.yScaleFactor:1.15}next(){const k=this._inputGeometries.next();if(k){if(1===this._xFactor&&1===this._yFactor||"esriGeometryPoint"===k.geometryType)return k;if(0<k.totalSize){var l=q.getCursorBoundsXY(k);const a=(l[2]+l[0])/2;l=(l[3]+l[1])/2;k.reset();
return this._scaleCursor(k.clone(),a,l)}}return null}_scaleCursor(k,l,a){for(;k.nextPath();)for(;k.nextPoint();)k.x=l+(k.x-l)*this._xFactor,k.y=a+(k.y-a)*this._yFactor;k.reset();return k}}b.EffectScale=n;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/effects/EffectWave":function(){define(["exports","../../../geometry/GeometryCursor","../enums","../GeometryWalker"],function(b,q,n,g){class k{static local(){null===k.instance&&(k.instance=new k);return k.instance}execute(a,
f,d,c,e){return new l(a,f,d)}}k.instance=null;class l{constructor(a,f,d){this._inputGeometries=a;this._height=(void 0!==f.amplitude?f.amplitude:2)*d;this._period=(void 0!==f.period?f.period:3)*d;this._style=f.waveform;0>=this._height&&(this._height=Math.abs(this._height));0>=this._period&&(this._period=Math.abs(this._period));this._pattern=new g.DashPattern;this._pattern.addValue(this._period);this._pattern.addValue(this._period);this._walker=new g.GeometryWalker;this._walker.updateTolerance(d)}next(){for(var a=
this._inputGeometries.next();a;){if(0===this._height||0===this._period||(a=this._processGeom(a)))return a;a=this._inputGeometries.next()}return null}_processGeom(a){const f=q.GeometryCursor.createEmptyOptimizedCIM(a.geometryType);for(;a.nextPath();){f.startPath();const d=a.pathLength();if(this._walker.init(a,this._pattern))switch(this._style){default:this._constructCurve(f,d,!1);break;case n.GeometricEffectWaveform.Square:this._constructSquare(f,d);break;case n.GeometricEffectWaveform.Triangle:this._constructTriangle(f,
d);break;case n.GeometricEffectWaveform.Random:this._constructCurve(f,d,!0)}else for(;a.nextPoint();)f.pushXY(a.x,a.y)}return f}_constructCurve(a,f,d){var c=Math.round(f/this._period);0===c&&(c=1);const e=this._period/16,h=1/(16*c+1);f=2*Math.PI*f/(f/c);c=2*Math.PI*Math.random();const x=2*Math.PI*Math.random(),m=2*Math.PI*Math.random(),p=.75-Math.random()/2,t=.75-Math.random()/2,w=new g.Pos;this._walker.curPointAndAngle(w);a.pushPoint(w.pt);let r=0;for(;;)if(this._walker.nextPointAndAngle(e,w)){const y=
r;r+=h;let z;if(d){const u=this._height/2*(1+.3*Math.sin(p*f*y+c));z=u*Math.sin(f*y+x);z+=u*Math.sin(t*f*y+m);z/=2}else z=.5*this._height*Math.sin(.5*f*y);a.pushXY(w.pt[0]-z*w.sa,w.pt[1]+z*w.ca)}else{a.pushPoint(this._walker.getPathEnd());break}}_constructSquare(a,f){Math.round(f/this._period);for(f=!0;;){let d=!1;if(this._walker.curPositionIsValid()){const c=new g.Pos;this._walker.curPointAndAngle(c);const e=new g.Pos;if(this._walker.nextPointAndAngle(this._period,e)){const h=new g.Pos;this._walker.nextPointAndAngle(this._period,
h)&&(f?(a.pushPoint(c.pt),f=!1):a.pushPoint(c.pt),a.pushXY(c.pt[0]-this._height/2*c.sa,c.pt[1]+this._height/2*c.ca),a.pushXY(e.pt[0]-this._height/2*e.sa,e.pt[1]+this._height/2*e.ca),a.pushXY(e.pt[0]+this._height/2*e.sa,e.pt[1]-this._height/2*e.ca),a.pushXY(h.pt[0]+this._height/2*h.sa,h.pt[1]-this._height/2*h.ca),d=!0)}}if(!d){a.pushPoint(this._walker.getPathEnd());break}}}_constructTriangle(a,f){Math.round(f/this._period);for(f=!0;;){let d=!1;if(this._walker.curPositionIsValid()){const c=new g.Pos;
this._walker.curPointAndAngle(c);const e=new g.Pos;if(this._walker.nextPointAndAngle(this._period/2,e)){const h=new g.Pos;this._walker.nextPointAndAngle(this._period,h)&&(this._walker.nextPosition(this._period/2)&&(f?(a.pushPoint(c.pt),f=!1):a.pushPoint(c.pt),a.pushXY(e.pt[0]-this._height/2*e.sa,e.pt[1]+this._height/2*e.ca),a.pushXY(h.pt[0]+this._height/2*h.sa,h.pt[1]-this._height/2*h.ca)),d=!0)}}if(!d){a.pushPoint(this._walker.getPathEnd());break}}}}b.EffectWave=k;Object.defineProperty(b,Symbol.toStringTag,
{value:"Module"})})},"esri/symbols/cim/placements/PlacementAlongLineSameSize":function(){define(["exports","../CIMCursor","../enums","../GeometryWalker"],function(b,q,n,g){class k{static local(){null===k.instance&&(k.instance=new k);return k.instance}execute(a,f,d,c,e){return new l(a,f,d)}}k.instance=null;class l extends q.PathTransformationCursor{constructor(a,f,d){super(a);this._geometryWalker=new g.GeometryWalker;this._geometryWalker.updateTolerance(d);this._angleToLine=f.angleToLine??!0;this._offset=
(f.offset?f.offset:0)*d;this._originalEndings=f.endings;this._offsetAtEnd=(f.customEndingOffset?f.customEndingOffset:0)*d;this._position=-(f.offsetAlongLine?f.offsetAlongLine:0)*d;this._pattern=new g.DashPattern;this._pattern.init(f.placementTemplate,!1);this._pattern.scale(d);this._endings=this._originalEndings}processPath(a){if(this._pattern.isEmpty())return null;if(this.iteratePath)var f=this._pattern.nextValue();else{this._endings=this._originalEndings===n.PlacementEndings.WithFullGap&&this.isClosed?
n.PlacementEndings.WithMarkers:this._originalEndings;this._pattern.extPtGap=0;let d=!0;switch(this._endings){case n.PlacementEndings.NoConstraint:f=-this._position;f=this._adjustPosition(f);d=!1;break;default:f=-this._pattern.lastValue()/2;break;case n.PlacementEndings.WithFullGap:f=-this._pattern.lastValue();this._pattern.extPtGap=this._pattern.lastValue();break;case n.PlacementEndings.WithMarkers:f=0;break;case n.PlacementEndings.Custom:f=-this._position,f=this._adjustPosition(f),this._pattern.extPtGap=
.5*this._offsetAtEnd}if(!this._geometryWalker.init(a,this._pattern,d))return null;this._pattern.reset();for(a=0;f>a;)f-=a,a=this._pattern.nextValue();f=a-f;this.iteratePath=!0}a=new g.Pos;if(!this._geometryWalker.nextPointAndAngle(f,a)||this._endings===n.PlacementEndings.WithFullGap&&this._geometryWalker.isPathEnd())return this.iteratePath=!1,null;if(this._endings===n.PlacementEndings.WithMarkers&&this._geometryWalker.isPathEnd()&&(this.iteratePath=!1,this.isClosed))return null;this.internalPlacement.setTranslate(a.pt[0]-
this._offset*a.sa,a.pt[1]+this._offset*a.ca);this._angleToLine&&this.internalPlacement.setRotateCS(a.ca,a.sa);return this.internalPlacement}_adjustPosition(a){a/=this._pattern.length();a-=Math.floor(a);return a*this._pattern.length()}}b.PlacementAlongLineSameSize=k;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/placements/PlacementAtExtremities":function(){define(["exports","../CIMCursor","../CurveHelper","../enums"],function(b,q,n,g){class k{static local(){null===
k.instance&&(k.instance=new k);return k.instance}execute(a,f,d,c,e){return new l(a,f,d)}}k.instance=null;class l extends q.PathTransformationCursor{constructor(a,f,d){super(a,!1,!0);this._curveHelper=new n.CurveHelper;this._placePerPart=f.placePerPart??!1;this._angleToLine=void 0!==f.angleToLine?f.angleToLine:!0;this._offset=void 0!==f.offset?f.offset*d:0;this._type=f.extremityPlacement;this._position=void 0!==f.offsetAlongLine?f.offsetAlongLine*d:0;this._beginProcessed=!1}processMultiPath(a){return this._placePerPart?
super.processMultiPath(a):this.processPath(a)}processPath(a){let f;switch(this._type){default:this._beginProcessed?(f=this._atExtremities(a,this._position,!1),this.iteratePath=this.iterateMultiPath=this._beginProcessed=!1):(f=this._atExtremities(a,this._position,!0),this.iteratePath=this.iterateMultiPath=this._beginProcessed=!0);break;case g.ExtremityPlacement.JustBegin:f=this._atExtremities(a,this._position,!0);break;case g.ExtremityPlacement.JustEnd:f=this._atExtremities(a,this._position,!1);case g.ExtremityPlacement.None:}return f}_atExtremities(a,
f,d){this._placePerPart||(d?a.seekPath(0):a.seekPath(a.totalSize-1));d||a.seekPathEnd();if(d?a.nextPoint():a.prevPoint()){let c=0,[e,h]=[0,0],[x,m]=[a.x,a.y];for(;d?a.nextPoint():a.prevPoint();){e=x;h=m;x=a.x;m=a.y;const p=this._curveHelper.getLength(e,h,x,m);if(c+p>f){a=(f-c)/p;const [t,w]=this._curveHelper.getAngleCS(e,h,x,m,a);a=this._curveHelper.getCoord2D(e,h,x,m,a);this.internalPlacement.setTranslate(a[0]-this._offset*w,a[1]+this._offset*t);this._angleToLine&&this.internalPlacement.setRotateCS(-t,
-w);return this.internalPlacement}c+=p}}return null}}b.PlacementAtExtremities=k;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/placements/PlacementAtRatioPositions":function(){define(["exports","../CIMCursor","../GeometryWalker"],function(b,q,n){class g{static local(){null===g.instance&&(g.instance=new g);return g.instance}execute(l,a,f,d,c){return new k(l,a,f)}}g.instance=null;class k extends q.PathTransformationCursor{constructor(l,a,f){super(l);this._walker=new n.GeometryWalker;
this._walker.updateTolerance(f);this._angleToLine=void 0!==a.angleToLine?a.angleToLine:!0;this._offset=void 0!==a.offset?a.offset*f:0;this._beginGap=void 0!==a.beginPosition?a.beginPosition*f:0;this._endGap=void 0!==a.endPosition?a.endPosition*f:0;this._flipFirst=void 0!==a.flipFirst?a.flipFirst:!0;this._pattern=new n.DashPattern;this._pattern.init(a.positionArray,!1,!1);this._subPathLen=0;this._posCount=this._pattern.size();this._isFirst=!0;this._prevPos=0}processPath(l){if(this._pattern.isEmpty())return null;
if(this.iteratePath){l=this._pattern.nextValue()*this._subPathLen;var a=this._beginGap+l;l=a-this._prevPos;this._prevPos=a}else{this._posCount=this._pattern.size();this._isFirst=!0;this._prevPos=0;this._subPathLen=l.pathLength()-this._beginGap-this._endGap;if(0>this._subPathLen)return this.iteratePath=!1,null;if(!this._walker.init(l,this._pattern,!1))return null;this._pattern.reset();l=this._pattern.nextValue()*this._subPathLen;a=this._beginGap+l;l=a-this._prevPos;this._prevPos=a;this.iteratePath=
!0}a=new n.Pos;if(!this._walker.nextPointAndAngle(l,a,n.EndType.END))return this.iteratePath=!1,null;this.internalPlacement.setTranslate(a.pt[0]-this._offset*a.sa,a.pt[1]+this._offset*a.ca);l=this._isFirst&&this._flipFirst;let f;this._angleToLine?(f=a.ca,a=a.sa):(f=1,a=0);l&&(f=-f,a=-a);this.internalPlacement.setRotateCS(f,a);this._isFirst=!1;this._posCount--;0===this._posCount&&(this.iteratePath=!1);return this.internalPlacement}}b.PlacementAtRatioPositions=g;Object.defineProperty(b,Symbol.toStringTag,
{value:"Module"})})},"esri/symbols/cim/placements/PlacementInsidePolygon":function(){define(["exports","../../../core/RandomLCG","../CIMPlacements","../enums"],function(b,q,n,g){class k{static local(){null===k.instance&&(k.instance=new k);return k.instance}execute(a,f,d,c,e){return new l(a,f,d,c,e)}}k.instance=null;class l{constructor(a,f,d,c,e){this._currentY=this._currentX=this._yMax=this._yMin=this._xMax=this._xMin=0;this._accelerationMap=null;this._testInsidePolygon=!1;this._verticalSubdivision=
!0;this._stepX=Math.abs(f.stepX??16)*d;this._stepY=Math.abs(f.stepY??16)*d;this._stepX=Math.round(128*this._stepX)/128;this._stepY=Math.round(128*this._stepY)/128;if(0!==this._stepX&&0!==this._stepY){this._gridType=f.gridType??g.PlacementGridType.Fixed;if(this._gridType===g.PlacementGridType.Random)this._randomLCG=new q(1*(f.seed??13)),this._randomness=(f.randomness??100)/100,this._gridAngle=0,this._shiftOddRows=!1,this._cosAngle=1,this._offsetY=this._offsetX=this._sinAngle=0,this._buildRandomValues();
else{this._randomness=0;this._gridAngle=f.gridAngle??0;this._shiftOddRows=f.shiftOddRows??!1;this._offsetX=(f.offsetX??0)*d;this._offsetY=(f.offsetY??0)*d;this._cosAngle=Math.cos(this._gridAngle/180*Math.PI);this._sinAngle=-Math.sin(this._gridAngle/180*Math.PI);if(this._stepX)if(0>this._offsetX)for(;this._offsetX<-.5*this._stepX;)this._offsetX+=this._stepX;else for(;this._offsetX>=.5*this._stepX;)this._offsetX-=this._stepX;if(this._stepY)if(0>this._offsetY)for(;this._offsetY<-.5*this._stepY;)this._offsetY+=
this._stepY;else for(;this._offsetY>=.5*this._stepY;)this._offsetY-=this._stepY}this._graphicOriginY=this._graphicOriginX=0;if(null!=c){const [h,x,m,p]=c.split("/");f=parseFloat(h);d=parseFloat(x);c=parseFloat(m);this._graphicOriginX=512*-(parseFloat(p)*2**f+c);this._graphicOriginY=512*d;this._testInsidePolygon=!0}this._internalPlacement=new n.Placement;this._calculateMinMax(a);this._geometryCursor=a}}next(){return this._geometryCursor?this._nextInside():null}_buildRandomValues(){if(!l._randValues){l._randValues=
[];for(let a=0;24>a;a++)for(let f=0;24>f;f++)l._randValues.push(this._randomLCG.getFloat()),l._randValues.push(this._randomLCG.getFloat())}}_calculateMinMax(a){this._yMax=this._yMin=this._xMax=this._xMin=0;let f,d,c,e,h,x,m,p;f=d=m=h=Number.MAX_VALUE;c=e=p=x=-Number.MAX_VALUE;var t=1!==this._cosAngle;for(a.reset();a.nextPath();)for(;a.nextPoint();){var w=a.x;var r=a.y;var y=w-this._graphicOriginX-this._offsetX;var z=r-this._graphicOriginY-this._offsetY;if(t){var u=this._cosAngle*y-this._sinAngle*
z;y=this._sinAngle*y+this._cosAngle*z}else u=y,y=z;f=Math.min(f,u);c=Math.max(c,u);d=Math.min(d,y);e=Math.max(e,y);h=Math.min(h,r);x=Math.max(x,r);m=Math.min(m,w);p=Math.max(p,w)}h=h!==Number.MAX_VALUE?h:-512-this._stepY;x=x!==-Number.MAX_VALUE?x:this._stepY;m=m!==Number.MAX_VALUE?m:-this._stepX;p=p!==-Number.MAX_VALUE?p:512+this._stepX;this._polygonMin=(this._verticalSubdivision=x-h>=p-m)?h:m;if(this._testInsidePolygon){u=0-this._graphicOriginX-this._offsetX-this._stepX;r=512-this._graphicOriginX-
this._offsetX+this._stepX;w=-512-this._graphicOriginY-this._offsetY-this._stepY;y=0-this._graphicOriginY-this._offsetY+this._stepY;if(t){t=[[u,w],[u,y],[r,w],[r,y]];u=w=Number.MAX_VALUE;r=y=-Number.MAX_VALUE;for(const v of t)t=this._cosAngle*v[0]-this._sinAngle*v[1],z=this._sinAngle*v[0]+this._cosAngle*v[1],u=Math.min(u,t),r=Math.max(r,t),w=Math.min(w,z),y=Math.max(y,z)}f=f!==Number.MAX_VALUE?Math.max(f,u):u;d=d!==Number.MAX_VALUE?Math.max(d,w):w;c=c!==-Number.MAX_VALUE?Math.min(c,r):r;e=e!==-Number.MAX_VALUE?
Math.min(e,y):y}this._xMin=Math.round(f/this._stepX);this._xMax=Math.round(c/this._stepX);this._yMin=Math.round(d/this._stepY);this._yMax=Math.round(e/this._stepY);this._currentX=this._xMax+1;this._currentY=this._yMin-1;this._buildAccelerationMap(a,m,p,h,x)}_buildAccelerationMap(a,f,d,c,e){a.reset();const h=new Map,x=this._verticalSubdivision;d=x?e-c:d-f;e=Math.ceil(d/10);if(!(1>=e)){d=Math.floor(d/e);e++;this._delta=d;var m,p;if(x){e=-512-2*this._stepY;var t=2*this._stepY;var w=c}else e=-2*this._stepX,
t=512+2*this._stepX,w=f;for(;a.nextPath();)if(!(2>a.pathSize)&&a.nextPoint()){var r=a.x;for(m=a.y;a.nextPoint();r=f,m=c){f=a.x;c=a.y;if(x){if(m===c||m<e&&c<e||m>t&&c>t)continue;var y=Math.min(m,c);var z=Math.max(m,c)}else{if(r===f||r<e&&f<e||r>t&&f>t)continue;y=Math.min(r,f);z=Math.max(r,f)}for(;y<z;){var u=p=Math.floor((y-w)/d),v=r,A=m,B=f,F=c,H=h;let J=H.get(u);J||(J=[],H.set(u,J));J.push([[v,A],[B,F]]);y+=d}y=Math.floor((z-w)/d);y>p&&(z=f,u=c,v=h,A=v.get(y),A||(A=[],v.set(y,A)),A.push([[r,m],[z,
u]]))}}this._accelerationMap=h}}_nextInside(){for(;;){if(this._currentX>this._xMax){this._currentY++;if(this._currentY>this._yMax)return null;this._currentX=this._xMin;this._shiftOddRows&&this._currentY%2&&this._currentX--}var a=this._currentX*this._stepX+this._offsetX;this._shiftOddRows&&this._currentY%2&&(a+=.5*this._stepX);const f=this._currentY*this._stepY+this._offsetY;this._currentX++;let d;if(this._gridType===g.PlacementGridType.Random){const c=(this._currentX%24+24)%24,e=(this._currentY%24+
24)%24;d=this._graphicOriginX+a+this._stepX*this._randomness*(.5-l._randValues[24*e+c])*2/3;a=this._graphicOriginY+f+this._stepY*this._randomness*(.5-l._randValues[24*e+c+1])*2/3}else d=this._graphicOriginX+this._cosAngle*a+this._sinAngle*f,a=this._graphicOriginY-this._sinAngle*a+this._cosAngle*f;if(!this._testInsidePolygon||this._isInsidePolygon(d,a,this._geometryCursor))return this._internalPlacement.setTranslate(d,a),this._internalPlacement}}_isInsidePolygon(a,f,d){if(null==this._accelerationMap){var c=
0,e;let m;a+=1E-6;f+=1E-6;for(d.reset();d.nextPath();)if(d.nextPoint()){var h=d.x;for(e=d.y;d.nextPoint();h=x,e=m){var x=d.x;m=d.y;e>f!==m>f&&(0<(x-h)*(f-e)-(m-e)*(a-h)?c++:c--)}}return 0!==c}a+=1E-6;f+=1E-6;d=this._verticalSubdivision;e=this._accelerationMap.get(Math.floor(((d?f:a)-this._polygonMin)/this._delta));if(!e)return!1;h=0;for(c of e){e=c[0];x=c[1];if(d){if(e[1]>f===x[1]>f)continue;e=(x[0]-e[0])*(f-e[1])-(x[1]-e[1])*(a-e[0])}else{if(e[0]>a===x[0]>a)continue;e=(x[1]-e[1])*(a-e[0])-(x[0]-
e[0])*(f-e[1])}0<e?h++:h--}return 0!==h}}b.PlacementInsidePolygon=k;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/placements/PlacementOnLine":function(){define(["exports","../CIMCursor","../CurveHelper","../enums"],function(b,q,n,g){class k{static local(){null===k.instance&&(k.instance=new k);return k.instance}execute(a,f,d,c,e){return new l(a,f,d)}}k.instance=null;class l extends q.PathTransformationCursor{constructor(a,f,d){super(a);this._curveHelper=new n.CurveHelper;
this._angleToLine=void 0!==f.angleToLine?f.angleToLine:!0;this._offset=void 0!==f.offset?f.offset*d:0;this._relativeTo=f.relativeTo;this._position=void 0!==f.startPointOffset?f.startPointOffset*d:0;this._epsilon=.001*d}processPath(a){var f=this._position;if(this._relativeTo===g.PlacementOnLineRelativeTo.SegmentMidpoint){this.iteratePath||(this.iteratePath=!0);if(a.nextPoint()){let [d,c]=[a.x,a.y],[e,h]=[0,0];for(;a.nextPoint();){e=a.x;h=a.y;f=this._curveHelper.getLength(d,c,e,h);if(f<this._epsilon){d=
e;c=h;continue}a=.5+this._position/f;const [x,m]=this._curveHelper.getAngleCS(d,c,e,h,a);a=this._curveHelper.getCoord2D(d,c,e,h,a);this.internalPlacement.setTranslate(a[0]-this._offset*m,a[1]+this._offset*x);this._angleToLine&&this.internalPlacement.setRotateCS(x,m);return this.internalPlacement}}this.iteratePath=!1;return null}return this.onLine(a,f,this._relativeTo===g.PlacementOnLineRelativeTo.LineEnd)}onLine(a,f,d){let c=!1;switch(this._relativeTo){default:a.seekPathStart();f=a.pathLength()/2+
f;break;case g.PlacementOnLineRelativeTo.LineBeginning:break;case g.PlacementOnLineRelativeTo.LineEnd:c=!0}d?a.seekPathEnd():a.seekPathStart();let e=0;if(d?a.prevPoint():a.nextPoint()){let [h,x]=[a.x,a.y],[m,p]=[0,0];for(;d?a.prevPoint():a.nextPoint();){m=a.x;p=a.y;const t=this._curveHelper.getLength(h,x,m,p);if(e+t>f){a=(f-e)/t;const [w,r]=this._curveHelper.getAngleCS(h,x,m,p,a);a=this._curveHelper.getCoord2D(h,x,m,p,a);d=c?-this._offset:this._offset;this.internalPlacement.setTranslate(a[0]-d*r,
a[1]+d*w);this._angleToLine&&(c?this.internalPlacement.setRotateCS(-w,-r):this.internalPlacement.setRotateCS(w,r));return this.internalPlacement}h=m;x=p;e+=t}}return null}}b.PlacementOnLine=k;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/placements/PlacementOnVertices":function(){define(["exports","../CIMCursor","../CurveHelper"],function(b,q,n){function g(a,f){const d=Math.PI;for(;Math.abs(f-a)>d+2E-15;)f=f-a>d?f-2*d:f+2*d;return(a+f)/2}class k{static local(){null===
k.instance&&(k.instance=new k);return k.instance}execute(a,f,d,c,e){return new l(a,f,d)}}k.instance=null;class l extends q.PathTransformationCursor{constructor(a,f,d){super(a);this._curveHelper=new n.CurveHelper;this._angleToLine=void 0!==f.angleToLine?f.angleToLine:!0;this._offset=void 0!==f.offset?f.offset*d:0;this._endPoints=void 0!==f.placeOnEndPoints?f.placeOnEndPoints:!0;this._controlPoints=void 0!==f.placeOnControlPoints?f.placeOnControlPoints:!0;this._regularVertices=void 0!==f.placeOnRegularVertices?
f.placeOnRegularVertices:!0;this._tags=[];this._tagIterator=0}processPath(a){this.iteratePath||(this._preparePath(a),this.iteratePath=!0);if(this._tagIterator>=this._tags.length)return this._tagIterator=this._tags.length=0,this.iteratePath=!1,null;a=this._tags[this._tagIterator];this._angleToLine&&this.internalPlacement.setRotate(a[2]);let f=a[0],d=a[1];if(0!==this._offset){const c=Math.cos(a[2]);f-=this._offset*Math.sin(a[2]);d+=this._offset*c}this.internalPlacement.setTranslate(f,d);this._tagIterator++;
return this.internalPlacement}_preparePath(a){this._tagIterator=this._tags.length=0;a.seekPathStart();const f=a.isClosed();let d=0,c=!1,e=0,h=0;a.seekPathStart();if(a.nextPoint()){let x=a.x,m=a.y,p=a.getControlPoint(),t=!0,w=a.nextPoint();for(;w;){const r=a.x,y=a.y,z=a.getControlPoint();if(this._angleToLine||0!==this._offset)e=this._curveHelper.getAngle(x,m,r,y,0);t?(t=!1,f?(d=e,c=p):(this._endPoints||this._controlPoints&&p)&&this._tags.push([x,m,e])):p?this._controlPoints&&this._tags.push([x,m,g(h,
e)]):this._regularVertices&&this._tags.push([x,m,g(h,e)]);if(this._angleToLine||0!==this._offset)h=this._curveHelper.getAngle(x,m,r,y,1);(w=a.nextPoint())||(f?z||c?this._controlPoints&&this._tags.push([r,y,g(h,d)]):this._regularVertices&&this._tags.push([r,y,g(h,d)]):(this._endPoints||this._controlPoints&&z)&&this._tags.push([r,y,h]));x=r;m=y;p=z}}this._tagIterator=0}}b.PlacementOnVertices=k;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/placements/PlacementPolygonCenter":function(){define("exports ../../../geometry/support/boundsUtils ../../../geometry/support/centroid ../../../geometry/support/labelPoint ../CIMPlacements ../enums".split(" "),
function(b,q,n,g,k,l){class a{static local(){null===a.instance&&(a.instance=new a);return a.instance}execute(d,c,e,h,x){return new f(d,c,e)}}a.instance=null;class f{constructor(d,c,e){this._geometryCursor=d;this._offsetX=void 0!==c.offsetX?c.offsetX*e:0;this._offsetY=void 0!==c.offsetY?c.offsetY*e:0;this._method=void 0!==c.method?c.method:l.PlacementPolygonCenterMethod.OnPolygon;this._placementPerPart=void 0!==c.placePerPart?c.placePerPart:!1;this._internalPlacement=new k.Placement}next(){const d=
this._geometryCursor;if(!d)return null;if(this._placementPerPart){for(;d.nextPath();)if(!(0>d.getCurrentRingArea()))return this._polygonCenter(d.getCurrentPath());this._geometryCursor=null}else return this._geometryCursor=null,this._polygonCenter(d);return null}_polygonCenter(d){let c=!1;switch(this._method){case l.PlacementPolygonCenterMethod.CenterOfMass:if(d=n.weightedAreaCentroid(d))this._internalPlacement.setTranslate(d[0]+this._offsetX,d[1]+this._offsetY),c=!0;break;case l.PlacementPolygonCenterMethod.BoundingBoxCenter:if(d=
q.getCursorBoundsXY(d))this._internalPlacement.setTranslate((d[2]+d[0])/2+this._offsetX,(d[3]+d[1])/2+this._offsetY),c=!0;break;default:d=g.getLabelPoint(d),null!==d&&(this._internalPlacement.setTranslate(d[0]+this._offsetX,d[1]+this._offsetY),c=!0)}return c?this._internalPlacement:null}}b.PlacementPolygonCenter=a;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/labelPoint":function(){define("exports ../../core/PriorityQueue ./aaBoundingRect ./boundsUtils ./centroid ./coordsUtils ./intersectsBase".split(" "),
function(b,q,n,g,k,l,a){function f(p,t){let w=0,r,y,z,u;for(t.reset();t.nextPath()&&t.nextPoint();)for(r=t.x,y=t.y;t.nextPoint();r=z,y=u)z=t.x,u=t.y,y>p[1]!==u>p[1]&&(0<(z-r)*(p[1]-y)-(u-y)*(p[0]-r)?w++:w--);return 0!==w}function d(p,t,w){if(w&&f(p,t))return{coord:p,distance:0};w=Infinity;let r=0,y=0;var z=[0,0];let u=[0,0];const v=[0,0];for(t.reset();t.nextPath()&&t.nextPoint();)if(!(2>t.pathSize))for(z[0]=t.x,z[1]=t.y;t.nextPoint();z=u)u=[t.x,t.y],l.projectPointOnLineSeg(v,p,z,u),z=h(p,v),z<w&&
(w=z,r=v[0],y=v[1]);return{coord:[r,y],distance:Math.sqrt(w)}}function c(p,t,w,r){w=[t,0];let y=Infinity,z=Infinity,u=!1,v=!1;t=[[t,r[1]-1],[t,r[3]+1]];r=[0,0];const A=[0,0],B=[0,0],F=[[0,0],[0,0]],H=n.create();for(p.reset();p.nextPath()&&p.nextPoint();)if(!(2>p.pathSize))for(F[0][0]=p.x,F[0][1]=p.y;p.nextPoint();F[0][0]=F[1][0],F[0][1]=F[1][1]){F[1][0]=p.x;F[1][1]=p.y;a:{var J=H;var E=F;if(2>E.length){J=null;break a}J||=n.create();const [C,D]=E[0],[G,N]=E[1];J[0]=Math.min(C,G);J[1]=Math.min(D,N);
J[2]=Math.max(C,G);J[3]=Math.max(D,N)}if(null!==J){A[0]=t[0][0];A[1]=t[0][1];B[0]=t[1][0];B[1]=t[1][1];a:{J=H;E=A;var K=B;let C=e(E,J),D=e(K,J);const G=J[0],N=J[1],Y=J[2],ca=J[3];if(C&D){J=0;break a}if(!(C|D)){J=4;break a}const ka=(C?1:0)|(D?2:0);do{const Q=K[0]-E[0],R=K[1]-E[1];if(Q>R)C&3?(C&1?(E[1]+=R*(G-E[0])/Q,E[0]=G):(E[1]+=R*(Y-E[0])/Q,E[0]=Y),C=e(E,J)):D&3?(D&1?(K[1]+=R*(G-K[0])/Q,K[0]=G):(K[1]+=R*(Y-K[0])/Q,K[0]=Y),D=e(K,J)):C?(C&4?(E[0]+=Q*(N-E[1])/R,E[1]=N):(E[0]+=Q*(ca-E[1])/R,E[1]=ca),
C=e(E,J)):(D&4?(K[0]+=Q*(N-K[1])/R,K[1]=N):(K[0]+=Q*(ca-K[1])/R,K[1]=ca),D=e(K,J));else if(C&12?(C&4?(E[0]+=Q*(N-E[1])/R,E[1]=N):(E[0]+=Q*(ca-E[1])/R,E[1]=ca),C=e(E,J)):D&12?(D&4?(K[0]+=Q*(N-K[1])/R,K[1]=N):(K[0]+=Q*(ca-K[1])/R,K[1]=ca),D=e(K,J)):C?(C&1?(E[1]+=R*(G-E[0])/Q,E[0]=G):(E[1]+=R*(Y-E[0])/Q,E[0]=Y),C=e(E,J)):(D&1?(K[1]+=R*(G-K[0])/Q,K[0]=G):(K[1]+=R*(Y-K[0])/Q,K[0]=Y),D=e(K,J)),C&D){J=0;break a}}while(C|D);J=ka}0!==J&&a.segmentIntersects(t[0],t[1],F[0],F[1],r)&&(J=r[1],y>z?J<y&&(y=J,u=!0):
J<z&&(z=J,v=!0))}}u&&v?w[1]=(y+z)/2:w[0]=w[1]=NaN;return w}function e(p,t){return(p[0]<t[0]?1:0)|(p[0]>t[2]?1:0)<<1|(p[1]<t[1]?1:0)<<2|(p[1]>t[3]?1:0)<<3}function h(p,t){return(p[0]-t[0])*(p[0]-t[0])+(p[1]-t[1])*(p[1]-t[1])}function x(p,t){if(p<t)return-1;if(p>t)return 1;if(p===t)return 0;p=isNaN(p);t=isNaN(t);return p<t?-1:p>t?1:0}class m{constructor(p,t,w,r){this.x=p;this.y=t;this.cellSize=w;this.distancefromCellCenter=l.distanceFromPointToPolygon(p,t,r);this.maxDistanceToPolygon=this.distancefromCellCenter+
this.cellSize*Math.SQRT2}}b.getLabelPoint=function(p){if(0===p.totalSize)return null;var t=g.getCursorBoundsXY(p);if(!t)return null;var w=8.8818E-14*(Math.abs(t[0])+Math.abs(t[2])+Math.abs(t[1])+Math.abs(t[3])+1),r=0,y=0;p.reset();for(var z=0;p.nextPath();z++){var u=p.getCurrentRingArea();u>y&&(y=u,r=z)}p.seekPath(r);if(0===p.pathSize)return null;p.seekPathStart();u=g.getCursorPathBounds(p);if(Math.abs(y)<=2*w*w)return[(u[0]+u[2])/2,(u[1]+u[3])/2];p.seekPathStart();var v=k.ringCentroidCursorXY(p,
n.create());if(null===v)return null;if(4>p.totalPoints)return v;y=[[NaN,NaN],[NaN,NaN],[NaN,NaN],[NaN,NaN]];r=[NaN,NaN,NaN,NaN];z=[NaN,NaN,NaN,NaN];var A=!1,B=d(v,p,!0);0===B.distance&&(A=!0,y[0][0]=v[0],y[0][1]=v[1],B=d(v,p,!1));r[0]=B.distance;z[0]=0;var F=[NaN,NaN];let H=!1,J=.25,E=-1;B=NaN;do{B=NaN;var K=u[0];y[1]=c(p,K+(u[2]-K)*J,w,t);isNaN(y[1][0])||isNaN(y[1][1])||(B=d(y[1],p,!1),B=B.distance);if(!isNaN(B)&&B>w&&f(y[1],p))H=!0,r[1]=B,z[1]=h(y[1],v);else if(!isNaN(B)&&B>E&&(E=B,F[0]=y[1][0],
F[1]=y[1][1]),J-=.01,.1>J)if(0<=E)H=!0,r[1]=E,y[1][0]=F[0],y[1][1]=F[1],z[1]=h(y[1],v);else break}while(!H);H=!1;J=.5;E=-1;K=.01;let C=1;do{B=NaN;var D=u[0];y[2]=c(p,D+(u[2]-D)*J,w,t);isNaN(y[2][0])||isNaN(y[2][1])||(B=d(y[2],p,!1),B=B.distance);if(!isNaN(B)&&B>w&&f(y[2],p))H=!0,r[2]=B,z[2]=h(y[2],v);else if(!isNaN(B)&&B>E)E=B,F[0]=y[2][0],F[1]=y[2][1];else if(B>E&&(E=B,F[0]=y[2][0],F[1]=y[2][1]),J=.5+K*C,K+=.01,C*=-1,.3>J||.7<J)if(0<=E)H=!0,r[2]=E,y[2][0]=F[0],y[2][1]=F[1],z[2]=h(y[2],v);else break}while(!H);
H=!1;J=.75;E=-1;do if(B=NaN,K=u[0],y[3]=c(p,K+(u[2]-K)*J,w,t),isNaN(y[3][0])||isNaN(y[3][1])||(B=d(y[3],p,!1),B=B.distance),!isNaN(B)&&B>w&&f(y[3],p))H=!0,r[3]=B,z[3]=h(y[3],v);else if(B>E&&(E=B,F[0]=y[3][0],F[1]=y[3][1]),J+=.01,.9<J)if(0<=E)H=!0,r[3]=E,y[3][0]=F[0],y[3][1]=F[1],z[3]=h(y[3],v);else break;while(!H);p=[0,1,2,3];t=A?0:1;for(u=t;4>u;u++)for(A=t;3>A;A++)v=z[A],F=z[A+1],0<x(v,F)&&(w=p[A],p[A]=p[A+1],p[A+1]=w,z[A]=F,z[A+1]=v);z=t;for(u=w=0;4>t;t++){switch(t){case 0:u=2*r[p[t]];break;case 1:u=
1.66666666*r[p[t]];break;case 2:u=1.33333333*r[p[t]];break;case 3:u=r[p[t]]}u>w&&(w=u,z=p[t])}return y[z]};b.getPolylabelPoint=function(p){if(!p.nextPath()||!p.pathSize)return null;var t=g.getCursorPathBounds(p),w=t[2]-t[0],r=t[3]-t[1];if(0===w||0===r)return[t[0]+w/2,t[1]+r/2];const y=Math.max(Math.min(w,r)/100,1),z=new q((A,B)=>B.maxDistanceToPolygon-A.maxDistanceToPolygon);r=Math.min(w,r);w=r/2;let u=0,v=0;for(u=t[0];u<t[2];u+=r)for(v=t[1];v<t[3];v+=r)z.enqueue(new m(u+w,v+w,w,p));p.reset();p.nextPath();
t=k.ringsCentroidCursor(p);if(null===t)return null;for(t=new m(t[0],t[1],0,p);0<z.size;)r=z.dequeue(),r.distancefromCellCenter>t.distancefromCellCenter&&(t=r),r.maxDistanceToPolygon-t.distancefromCellCenter<=y||(w=r.cellSize/2,z.enqueue(new m(r.x-w,r.y-w,w,p)),z.enqueue(new m(r.x+w,r.y-w,w,p)),z.enqueue(new m(r.x-w,r.y+w,w,p)),z.enqueue(new m(r.x+w,r.y+w,w,p)));return[t.x,t.y]};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/core/PriorityQueue":function(){define(function(){class b{constructor(n=
q){this._data=[];this._compare=n}get size(){return this._data.length}enqueue(n){if(null!=n){var {_data:g,_compare:k}=this;g.push(n);n=g.length-1>>>0;for(var l=g[n];0<n;){const a=n-1>>1,f=g[a];if(0>=k(f,l))g[a]=l,g[n]=f,n=a;else break}}}dequeue(){const {_data:n,_compare:g}=this,k=n[0];var l=n.pop();if(0===n.length)return k;n[0]=l;l=0;const a=n.length,f=n[0];let d;let c=null;for(;;){var e=2*l+1;const h=2*l+2;c=null;e<a&&(d=n[e],0<g(d,f)&&(c=e));h<a&&(e=n[h],null===c&&0>=g(e,f)||null!==c&&0>=g(e,d))&&
(c=h);if(null===c)break;n[l]=n[c];n[c]=f;l=c}return k}}const q=(n,g)=>n<g?-1:n>g?1:0;return b})},"esri/symbols/cim/CIMSymbolHelper":function(){define("exports ../../core/BidiText ../../core/has ../../core/lang ../../core/Logger ../../core/RandomLCG ../../core/screenUtils ../../geometry/support/aaBoundingRect ../../geometry/support/boundsUtils ../Font ./CIMPlacements ./CIMSymbolDrawHelper ./defaultCIMValues ./enums ./utils ../support/defaults ../../views/2d/engine/vectorTiles/GeometryUtils ../../views/2d/engine/webgl/definitions ../../views/2d/engine/webgl/mesh/templates/shapingUtils ../../views/2d/layers/graphics/graphicsUtils".split(" "),
function(b,q,n,g,k,l,a,f,d,c,e,h,x,m,p,t,w,r,y,z){function u(W,aa,ia){switch(aa.type){case "CIMSymbolReference":return u(W,aa.symbol,ia);case "CIMPointSymbol":null==ia&&(ia={x:0,y:0});W.drawSymbol(aa,ia);break;case "CIMLineSymbol":null==ia&&(ia={paths:[[[0,0],[10,0]]]});W.drawSymbol(aa,ia);break;case "CIMPolygonSymbol":null==ia&&(ia={rings:[[[0,0],[0,10],[10,10],[10,0],[0,0]]]});W.drawSymbol(aa,ia);break;case "CIMTextSymbol":W.drawSymbol(aa,{x:0,y:0});break;case "CIMVectorMarker":ia=new e.Placement,
W.drawMarker(aa,ia)}return W.envelope()}function v(W){if(!W)return 0;switch(W.type){case "CIMMarkerPlacementAlongLineSameSize":return Math.abs(W.offset);case "CIMMarkerPlacementAlongLineRandomSize":return Math.abs(W.offset);case "CIMMarkerPlacementAtExtremities":return Math.abs(W.offset);case "CIMMarkerPlacementAtMeasuredUnits":return Math.abs(W.offset);case "CIMMarkerPlacementAtRatioPositions":return Math.abs(W.offset);case "CIMMarkerPlacementInsidePolygon":return 0;case "CIMMarkerPlacementOnLine":return Math.abs(W.offset);
case "CIMMarkerPlacementOnVertices":return Math.abs(W.offset);case "CIMMarkerPlacementPolygonCenter":return 0;default:return 0}}function A(W){if(!W)return 0;switch(W.type){case "CIMGeometricEffectArrow":return Math.abs(.5*W.width);case "CIMGeometricEffectBuffer":return Math.abs(W.size);case "CIMGeometricEffectControlMeasureLine":return 500;case "CIMGeometricEffectExtension":return Math.abs(W.length);case "CIMGeometricEffectJog":return Math.abs(.5*W.length);case "CIMGeometricEffectMove":return Math.max(Math.abs(p.getNumericValue(W.offsetX)),
Math.abs(p.getNumericValue(W.offsetY)));case "CIMGeometricEffectOffset":return Math.abs(W.offset);case "CIMGeometricEffectOffsetTangent":return Math.abs(W.offset);case "CIMGeometricEffectRadial":return Math.abs(W.length);case "CIMGeometricEffectRegularPolygon":return Math.abs(W.radius);case "CIMGeometricEffectRotate":return 0;case "CIMGeometricEffectScale":return 0;case "CIMGeometricEffectTaperedPolygon":return.5*Math.max(Math.abs(W.fromWidth),Math.abs(W.toWidth));case "CIMGeometricEffectWave":return Math.abs(W.amplitude);
case "CIMGeometricEffectDonut":return Math.abs(W.width);default:return 0}}function B(W){if(!W)return 0;let aa=0;for(const ia of W)aa+=A(ia);return aa}function F(W,aa){if(W)switch(W.type){case "CIMPointSymbol":case "CIMLineSymbol":case "CIMPolygonSymbol":if(W=W.symbolLayers)for(const ia of W)switch(aa(ia),ia.type){case "CIMVectorMarker":if(W=ia.markerGraphics)for(const qa of W)qa&&(W=qa.symbol)&&F(W,aa)}}}function H(W,aa,ia){W.effects&&null==aa.geometryEngine&&(aa.geometryEnginePromise?ia.push(aa.geometryEnginePromise):
p.isGeometryEngineRequired(W.effects)&&(aa.geometryEnginePromise=p.importGeometryEngine(),ia.push(aa.geometryEnginePromise),aa.geometryEnginePromise.then(qa=>aa.geometryEngine=qa)))}function J(W){if(!W)return null;let aa=null;const {cap:ia,color:qa,join:sa,miterLimit:ya,style:va,width:wa}=W;"solid"!==va&&"none"!==va&&"esriSLSSolid"!==va&&"esriSLSNull"!==va&&(aa=[{type:"CIMGeometricEffectDashes",dashTemplate:da(va,ia),lineDashEnding:"NoConstraint",scaleDash:!0,offsetAlongLine:null}]);return{type:"CIMSolidStroke",
color:"esriSLSNull"!==va&&"none"!==va?Z(qa):[0,0,0,0],capStyle:ca(ia),joinStyle:ka(sa),miterLimit:ya,width:wa,effects:aa}}const E=Math.PI,K=E/2,C=Math.PI/180,D=96/72,G=()=>k.getLogger("esri.symbols.cim.CIMSymbolHelper");class N{static getSymbolInflateSize(W,aa,ia,qa,sa){W||=[0,0,0,0];return aa?this._getInflateSize(W,aa,ia,qa,sa):W}static safeSize(W){const aa=Math.max(Math.abs(W[0]),Math.abs(W[2]));W=Math.max(Math.abs(W[1]),Math.abs(W[3]));return Math.sqrt(aa*aa+W*W)}static _vectorMarkerBounds(W,aa,
ia,qa){let sa=!0;const ya=f.create();if(aa?.markerGraphics)for(const va of aa.markerGraphics)aa=[0,0,0,0],va.geometry&&(d.getBoundsXY(ya,va.geometry),aa[0]=0,aa[1]=0,aa[2]=0,aa[3]=0,this.getSymbolInflateSize(aa,va.symbol,ia,0,qa),ya[0]+=aa[0],ya[1]+=aa[1],ya[2]+=aa[2],ya[3]+=aa[3],sa?(W[0]=ya[0],W[1]=ya[1],W[2]=ya[2],W[3]=ya[3],sa=!1):(W[0]=Math.min(W[0],ya[0]),W[1]=Math.min(W[1],ya[1]),W[2]=Math.max(W[2],ya[2]),W[3]=Math.max(W[3],ya[3])));return W}static _getInflateSize(W,aa,ia,qa,sa){return void 0!==
aa.symbolLayers?(W=this._getLayersInflateSize(W,aa.symbolLayers,ia,qa,sa),aa=B(aa.effects),0<aa&&(W[0]-=aa,W[1]-=aa,W[2]+=aa,W[3]+=aa),W):this._getTextInflatedSize(W,aa,sa)}static _getLayersInflateSize(W,aa,ia,qa,sa){let ya=!0;if(!aa)return W;for(const ha of aa)if(ha){aa=[0,0,0,0];switch(ha.type){case "CIMSolidStroke":case "CIMPictureStroke":case "CIMGradientStroke":var va=ha,wa=va.width;null!=wa&&(wa=va.capStyle===m.LineCapStyle.Square||va.joinStyle===m.LineJoinStyle.Miter?wa/1.4142135623730951:
wa/2,aa[0]=-wa,aa[1]=-wa,aa[2]=wa,aa[3]=wa);break;case "CIMCharacterMarker":case "CIMVectorMarker":case "CIMPictureMarker":va=ha;if("CIMVectorMarker"===ha.type){if(wa=ha,aa=this._vectorMarkerBounds(aa,wa,ia,sa),wa.frame){var M=(wa.frame.xmin+wa.frame.xmax)/2,L=(wa.frame.ymin+wa.frame.ymax)/2;aa[0]-=M;aa[1]-=L;aa[2]-=M;aa[3]-=L;null!=wa.size&&(wa=wa.size/(wa.frame.ymax-wa.frame.ymin),aa[0]*=wa,aa[1]*=wa,aa[2]*=wa,aa[3]*=wa)}}else"CIMPictureMarker"===ha.type?(wa=ha,L=ia.getResource(wa.url),M=1,null!=
L&&L.height&&(M=L.width/L.height),null!=va.size&&(aa=va.size/2,wa=va.size*M*wa.scaleX/2,aa=[-wa,-aa,wa,aa])):null!=va.size&&(aa=va.size/2,aa=[-aa,-aa,aa,aa]);va.anchorPoint&&("Absolute"===va.anchorPointUnits?(wa=va.anchorPoint.x,M=va.anchorPoint.y):(wa=va.anchorPoint.x*(aa[2]-aa[0]),M=va.anchorPoint.y*(aa[3]-aa[1])),wa=1.25*Math.sqrt(wa*wa+M*M),aa[0]-=wa,aa[1]-=wa,aa[2]+=wa,aa[3]+=wa);wa=p.getNumericValue(va.rotation);va.rotateClockwise&&(wa=-wa);qa&&(wa-=qa);wa&&(M=C*wa,wa=Math.cos(M),M=Math.sin(M),
L=f.create([w.cInfinity,w.cInfinity,-w.cInfinity,-w.cInfinity]),f.expandPointInPlace(L,[aa[0]*wa-aa[1]*M,aa[0]*M+aa[1]*wa]),f.expandPointInPlace(L,[aa[0]*wa-aa[3]*M,aa[0]*M+aa[3]*wa]),f.expandPointInPlace(L,[aa[2]*wa-aa[1]*M,aa[2]*M+aa[1]*wa]),f.expandPointInPlace(L,[aa[2]*wa-aa[3]*M,aa[2]*M+aa[3]*wa]),aa=L);wa=p.getNumericValue(va.offsetX);M=p.getNumericValue(va.offsetY);if(qa){var T=C*qa;L=Math.cos(T);T=Math.sin(T);const oa=wa*T+M*L;wa=wa*L-M*T;M=oa}aa[0]+=wa;aa[1]+=M;aa[2]+=wa;aa[3]+=M;va=v(va.markerPlacement);
0<va&&(aa[0]-=va,aa[1]-=va,aa[2]+=va,aa[3]+=va)}va=B(ha.effects);0<va&&(aa[0]-=va,aa[1]-=va,aa[2]+=va,aa[3]+=va);ya?(W[0]=aa[0],W[1]=aa[1],W[2]=aa[2],W[3]=aa[3],ya=!1):(W[0]=Math.min(W[0],aa[0]),W[1]=Math.min(W[1],aa[1]),W[2]=Math.max(W[2],aa[2]),W[3]=Math.max(W[3],aa[3]))}return W}static _getTextInflatedSize(W,aa,ia){var qa=z.roundPtToWholePixel(aa.height??x.defaultCIMValues.CIMTextSymbol.height);W[0]=-qa/2;W[1]=-qa/2;W[2]=qa/2;W[3]=qa/2;if(!ia)return W;ia=ia.get(aa);if(!ia||!ia.glyphMosaicItems.glyphs.length)return W;
const {lineGapType:sa,lineGap:ya}=aa,va=sa?h.lineGapType2LineHeight(sa,ya??0,qa):0,wa="CIMBackgroundCallout"===aa.callout?.type;aa=y.shapeGlyphs(ia.glyphMosaicItems,{scale:qa/r.glyphSize,angle:p.getNumericValue(aa.angle),xOffset:p.getNumericValue(aa.offsetX),yOffset:p.getNumericValue(aa.offsetY),horizontalAlignment:aa.horizontalAlignment,verticalAlignment:aa.verticalAlignment,maxLineWidth:z.getLineWidth(aa.lineWidth),lineHeight:r.magicLabelLineHeight*Math.max(.25,Math.min(va||1,4)),decoration:aa.font.decoration||
"none",useCIMAngleBehavior:!0,hasBackground:wa}).boundsT;qa=Math.sqrt(aa.width*aa.width+aa.height*aa.height);W[0]-=aa.x+qa;W[1]-=aa.y-qa;W[2]+=aa.x+qa;W[3]+=-aa.y+qa;return W}}class Y{static getEnvelope(W,aa,ia){if(!W)return null;ia=new h.EnvDrawHelper(ia);if(Array.isArray(W)){let qa;for(const sa of W)qa?qa.union(u(ia,sa,aa)):qa=u(ia,sa,aa);return qa}return u(ia,W,aa)}static getTextureAnchor(W,aa){W=this.getEnvelope(W,null,aa);if(!W)return[0,0,0];aa=W.height*D+2;return[-((W.x+.5*W.width)*D)/(W.width*
D+2),-((W.y+.5*W.height)*D)/aa,aa]}static rasterize(W,aa,ia,qa,sa=!0,ya){var va=ia||this.getEnvelope(aa,null,qa);if(!va)return[null,0,0,0,0];var wa=Math.max(va.width,va.height)*D;let M=null!=ya?Math.max(ya/wa,1):1;M*=D;ya=(va.x+.5*va.width)*M;wa=(va.y+.5*va.height)*M;W.width=va.width*M;W.height=va.height*M;ia||(W.width+=2,W.height+=2);ia=W.getContext("2d",{willReadFrequently:!0});va=h.Transformation.createScale(M,-M);va.translate(.5*W.width-ya,.5*W.height+wa);qa=new h.CanvasDrawHelper(ia,qa,va);switch(aa.type){case "CIMPointSymbol":qa.drawSymbol(aa,
{type:"point",x:0,y:0});break;case "CIMVectorMarker":va=new e.Placement,qa.drawMarker(aa,va)}aa=ia.getImageData(0,0,W.width,W.height);aa=new Uint8Array(aa.data);if(sa)for(qa=0;qa<aa.length;qa+=4)sa=aa[qa+3]/255,aa[qa]*=sa,aa[qa+1]*=sa,aa[qa+2]*=sa;return[aa,W.width,W.height,-ya/W.width,-wa/W.height]}static fromTextSymbol(W){const {text:aa}=W;return{type:"CIMPointSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,anchorPointUnits:"Relative",dominantSizeAxis3D:"Y",size:10,billboardMode3D:"FaceNearPlane",
frame:{xmin:-5,ymin:-5,xmax:5,ymax:5},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{x:0,y:0},symbol:Y.createCIMTextSymbolfromTextSymbol(W),textString:aa}],scaleSymbolsProportionally:!0,respectFrame:!0}],scaleX:1,angleAlignment:"Display"}}static fromPictureFillSymbol(W){const {height:aa,outline:ia,width:qa,xoffset:sa,xscale:ya,yoffset:va,yscale:wa}=W,M=[],L={type:"CIMPolygonSymbol",symbolLayers:M};if(ia){var T=J(ia);T&&M.push(T)}T=W.url;"esriPFS"===W.type&&W.imageData&&(T=W.imageData);W="angle"in
W?W.angle??0:0;M.push({type:"CIMPictureFill",invertBackfaceTexture:!1,scaleX:1,textureFilter:m.TextureFilter.Picture,tintColor:null,url:T,height:(aa??0)*(wa||1),width:(qa??0)*(ya||1),offsetX:p.getNumericValue(sa),offsetY:p.getNumericValue(va),rotation:p.getNumericValue(-W),colorSubstitutions:null});return L}static fromSimpleFillSymbol(W){const {color:aa,style:ia,outline:qa}=W;W=[];const sa={type:"CIMPolygonSymbol",symbolLayers:W};if(qa){var ya=J(qa);ya&&W.push(ya)}if(ia&&"solid"!==ia&&"none"!==ia&&
"esriSFSSolid"!==ia&&"esriSFSNull"!==ia){ya={type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",color:Z(aa),capStyle:m.LineCapStyle.Butt,joinStyle:m.LineJoinStyle.Miter,width:.75}]};let va=0;const wa=a.px2pt("vertical"===ia||"horizontal"===ia||"cross"===ia||"esriSFSCross"===ia||"esriSFSVertical"===ia||"esriSFSHorizontal"===ia?8:10);switch(ia){case "vertical":case "esriSFSVertical":va=90;break;case "forward-diagonal":case "esriSFSForwardDiagonal":va=-45;break;case "backward-diagonal":case "esriSFSBackwardDiagonal":va=
45;break;case "cross":case "esriSFSCross":va=0;break;case "diagonal-cross":case "esriSFSDiagonalCross":va=-45}W.push({type:"CIMHatchFill",lineSymbol:ya,offsetX:0,offsetY:0,rotation:va,separation:wa});"cross"===ia||"esriSFSCross"===ia?W.push({type:"CIMHatchFill",lineSymbol:g.clone(ya),offsetX:0,offsetY:0,rotation:90,separation:wa}):("diagonal-cross"===ia||"esriSFSDiagonalCross"===ia)&&W.push({type:"CIMHatchFill",lineSymbol:g.clone(ya),offsetX:0,offsetY:0,rotation:45,separation:wa})}else!ia||"solid"!==
ia&&"esriSFSSolid"!==ia||W.push({type:"CIMSolidFill",enable:!0,color:Z(aa)});return sa}static fromSimpleLineSymbol(W){const {cap:aa,color:ia,join:qa,marker:sa,miterLimit:ya,style:va,width:wa}=W;W=null;"solid"!==va&&"none"!==va&&"esriSLSSolid"!==va&&"esriSLSNull"!==va&&(W=[{type:"CIMGeometricEffectDashes",dashTemplate:da(va,aa),lineDashEnding:"NoConstraint",scaleDash:!0,offsetAlongLine:null}]);const M=[];if(sa){let L;switch(sa.placement){case "begin-end":L=m.ExtremityPlacement.Both;break;case "begin":L=
m.ExtremityPlacement.JustBegin;break;case "end":L=m.ExtremityPlacement.JustEnd;break;default:L=m.ExtremityPlacement.None}const T=Y.fromSimpleMarker(sa,wa,ia).symbolLayers[0];T.markerPlacement={type:"CIMMarkerPlacementAtExtremities",placePerPart:!1,angleToLine:!0,offset:0,extremityPlacement:L,offsetAlongLine:0};M.push(T)}M.push({type:"CIMSolidStroke",color:"none"!==va&&"esriSLSNull"!==va?Z(ia):[0,0,0,0],capStyle:ca(aa),joinStyle:ka(qa),miterLimit:ya,width:wa,effects:W});return{type:"CIMLineSymbol",
symbolLayers:M}}static fromPictureMarker(W){const {angle:aa,height:ia,width:qa,xoffset:sa,yoffset:ya}=W;let va=W.url;"esriPMS"===W.type&&W.imageData&&(va=W.imageData);return{type:"CIMPointSymbol",symbolLayers:[{type:"CIMPictureMarker",invertBackfaceTexture:!1,scaleX:1,textureFilter:m.TextureFilter.Picture,tintColor:null,url:va,size:ia,width:qa,offsetX:p.getNumericValue(sa),offsetY:p.getNumericValue(ya),rotation:p.getNumericValue(-aa)}]}}static createCIMTextSymbolfromTextSymbol(W){const {angle:aa,
color:ia,font:qa,haloColor:sa,haloSize:ya,horizontalAlignment:va,kerning:wa,lineWidth:M,text:L,verticalAlignment:T,xoffset:ha,yoffset:oa,backgroundColor:S,borderLineColor:X,borderLineSize:ba}=W;let la,pa,O;if(qa){var ea=qa.family;var na=qa.style;var ra=qa.weight;la=qa.size;pa=qa.decoration}W=!1;L&&(W=q.bidiText(L)[1]);if(S||ba)O={type:"CIMBackgroundCallout",margin:null,backgroundSymbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",color:Z(S)},{type:"CIMSolidStroke",color:Z(X),width:ba}]},
accentBarSymbol:null,gap:null,leaderLineSymbol:null,lineStyle:null};var Aa=m.BlockProgression.BTT,za=m.FontEffects.Normal,Ba=m.FontEncoding.Unicode;ea=ea||"Arial";b:{if(ra)switch(ra.toLowerCase()){case "bold":case "bolder":ra="bold";break b}ra=""}b:{if(na)switch(na.toLowerCase()){case "italic":case "oblique":na="italic";break b}na=""}ra=ra&&na?`${ra}-${na}`:`${ra}${na}`;return{type:"CIMTextSymbol",angle:aa,blockProgression:Aa,depth3D:1,extrapolateBaselines:!0,fontEffects:za,fontEncoding:Ba,fontFamilyName:ea,
fontStyleName:ra,fontType:m.FontType.Unspecified,haloSize:ya,height:la,hinting:m.GlyphHinting.Default,horizontalAlignment:Q(va??"center"),kerning:wa,letterWidth:100,ligatures:!0,lineGapType:"Multiple",lineWidth:M,offsetX:p.getNumericValue(ha),offsetY:p.getNumericValue(oa),strikethrough:"line-through"===pa,underline:"underline"===pa,symbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",enable:!0,color:Z(ia)}]},haloSymbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",enable:!0,
color:Z(sa)}]},shadowColor:[0,0,0,255],shadowOffsetX:1,shadowOffsetY:1,textCase:"Normal",textDirection:W?m.TextReadingDirection.RTL:m.TextReadingDirection.LTR,verticalAlignment:R(T??"baseline"),verticalGlyphOrientation:m.VerticalGlyphOrientation.Right,wordSpacing:100,billboardMode3D:m.BillBoardMode.FaceNearPlane,callout:O}}static createPictureMarkerRasterizationParam(W){const {angle:aa,height:ia,width:qa,xoffset:sa,yoffset:ya}=W;return(W=W.url??W.source?.url??W.source?.imageData)?{type:"sprite-rasterization-param",
overrides:[],resource:{type:"CIMPictureMarker",invertBackfaceTexture:!1,scaleX:1,textureFilter:m.TextureFilter.Picture,tintColor:null,url:W,size:ia,width:qa,offsetX:p.getNumericValue(sa),offsetY:p.getNumericValue(ya),rotation:p.getNumericValue(-aa)}}:null}static createPictureFillRasterizationParam(W){const {width:aa,height:ia,xoffset:qa,yoffset:sa,url:ya}=W;return ya?{type:"sprite-rasterization-param",overrides:[],resource:{type:"CIMPictureFill",scaleX:1,textureFilter:m.TextureFilter.Picture,tintColor:null,
url:ya,width:aa,height:ia,offsetX:p.getNumericValue(qa),offsetY:p.getNumericValue(sa),rotation:0}}:null}static fromSimpleMarker(W,aa,ia){var {style:qa}=W;ia=W.color??ia;if("path"===qa||"esriSMSPath"===qa){aa=[];if("outline"in W&&W.outline){var sa=W.outline;aa.push({type:"CIMSolidStroke",enable:!0,width:sa.width,color:Z(sa.color),path:W.path})}aa.push({type:"CIMSolidFill",enable:!0,color:Z(ia),path:W.path});const [L,T]=ja("square");return{type:"CIMPointSymbol",symbolLayers:[{type:"CIMVectorMarker",
enable:!0,rotation:-p.getNumericValue(W.angle),size:p.getNumericValue(W.size||6),offsetX:p.getNumericValue(W.xoffset),offsetY:p.getNumericValue(W.yoffset),scaleSymbolsProportionally:!1,frame:L,markerGraphics:[{type:"CIMMarkerGraphic",geometry:T,symbol:{type:"CIMPolygonSymbol",symbolLayers:aa}}]}]}}const ya=[];sa=W.size;let va;if("outline"in W&&W.outline&&"none"!==W.outline.style&&"esriSLSNull"!==W.outline.style){const L=W.outline,T="solid"!==L.style&&"esriSLSSolid"!==L.style;[qa,va]=T?ja(qa,W.size):
ja(qa);const ha=L.width??t.defaultPolylineSymbol2D.width;if(T){var wa=ha/W.size,M=(qa.xmax-qa.xmin)*wa/2;wa=(qa.ymax-qa.ymin)*wa/2;qa.xmin-=M;qa.xmax+=M;qa.ymin-=wa;qa.ymax+=wa;sa&&(sa+=ha)}M="cross"!==W.style&&"x"!==W.style||"dot"===W?.outline.style||"short-dot"===W?.outline.style?m.LineDashEnding.HalfGap:m.LineDashEnding.FullPattern;M=T?[{type:"CIMGeometricEffectAddControlPoints"},{type:"CIMGeometricEffectDashes",dashTemplate:da(L.style,null).map(oa=>L.width&&0<L.width?oa*L.width:oa),lineDashEnding:M,
controlPointEnding:m.LineDashEnding.FullPattern}]:void 0;ya.push({type:"CIMSolidStroke",capStyle:T?m.LineCapStyle.Round:m.LineCapStyle.Butt,enable:!0,width:ha,color:Z(L.color),effects:M})}else!aa||"line-marker"!==W.type||"cross"!==W.style&&"x"!==W.style?[qa,va]=ja(qa):([qa,va]=ja(qa),ya.push({type:"CIMSolidStroke",enable:!0,width:aa,color:Z(ia)}));ya.push({type:"CIMSolidFill",enable:!0,color:Z(ia)});ia={type:"CIMPolygonSymbol",symbolLayers:ya};return{type:"CIMPointSymbol",symbolLayers:[{type:"CIMVectorMarker",
enable:!0,rotation:p.getNumericValue(-W.angle),size:p.getNumericValue(sa||6*aa),offsetX:p.getNumericValue(W.xoffset),offsetY:p.getNumericValue(W.yoffset),scaleSymbolsProportionally:!1,frame:qa,markerGraphics:[{type:"CIMMarkerGraphic",geometry:va,symbol:ia}]}]}}static fromCIMHatchFill(W,aa){const ia=aa*(W.separation??x.defaultCIMValues.CIMHatchFill.separation),qa=ia/2;W=g.clone(W.lineSymbol);W.symbolLayers?.forEach(ya=>{switch(ya.type){case "CIMSolidStroke":null!=ya.width&&(ya.width*=aa);ya.effects?.forEach(va=>
{"CIMGeometricEffectDashes"===va.type&&(va.dashTemplate=va.dashTemplate?.map(wa=>wa*aa))});break;case "CIMVectorMarker":null!=ya.size&&(ya.size*=aa),ya=ya.markerPlacement,null!=ya&&"placementTemplate"in ya&&(ya.placementTemplate=ya.placementTemplate.map(va=>va*aa))}});for(var sa=this._getLineSymbolPeriod(W)||4;4>sa;)sa*=2;sa/=2;return{type:"CIMVectorMarker",frame:{xmin:-sa,xmax:sa,ymin:-qa,ymax:qa},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{paths:[[[-sa,0],[sa,0]]]},symbol:W}],size:ia}}static fetchResources(W,
aa,ia,qa=null){if(!W||!aa)return ia;F(W,sa=>{H(sa,aa,ia);"url"in sa&&sa.url&&ia.push(aa.fetchResource(sa.url,{signal:qa}))});return ia}static fetchFonts(W,aa,ia){if(W&&aa)if("symbolLayers"in W&&W.symbolLayers)for(const ya of W.symbolLayers){if("CIMVectorMarker"===ya.type&&ya.markerGraphics)for(const va of ya.markerGraphics)va?.symbol&&Y.fetchFonts(va.symbol,aa,ia)}else if("CIMTextSymbol"===W.type){const {fontFamilyName:ya,fontStyleName:va}=W;if(ya&&"calcitewebcoreicons"!==ya.toLowerCase()){var {style:qa,
weight:sa}=p.fromCIMFontStyle(va);W=p.fromCIMFontDecoration(W);W=new c({family:ya,style:qa,weight:sa,decoration:W});ia.push(aa.loadFont(W).catch(()=>{G().error(`Unsupported font ${ya} in CIM symbol`)}))}}}static _getLineSymbolPeriod(W){if(W){const aa=this._getEffectsRepeat(W.effects);if(aa)return aa;if(W.symbolLayers)for(const ia of W.symbolLayers)if(ia){if(W=this._getEffectsRepeat(ia.effects))return W;switch(ia.type){case "CIMCharacterMarker":case "CIMPictureMarker":case "CIMVectorMarker":case "CIMObjectMarker3D":case "CIMglTFMarker3D":if(W=
this._getPlacementRepeat(ia.markerPlacement))return W}}}return 0}static _getEffectsRepeat(W){if(W)for(var aa of W)if(aa)switch(aa.type){case "CIMGeometricEffectDashes":if((W=aa.dashTemplate)&&W.length){aa=0;for(const ia of W)aa+=ia;W.length&1&&(aa*=2);return aa}break;case "CIMGeometricEffectWave":return aa.period;default:G().error(`unsupported geometric effect type ${aa.type}`)}return 0}static _getPlacementRepeat(W){if(W)switch(W.type){case "CIMMarkerPlacementAlongLineSameSize":case "CIMMarkerPlacementAlongLineRandomSize":case "CIMMarkerPlacementAlongLineVariableSize":if((W=
W.placementTemplate)&&W.length){let aa=0;for(const ia of W)aa+=+ia;W.length&1&&(aa*=2);return aa}}return 0}static fromCIMInsidePolygon(W){var aa=W.markerPlacement;const ia={...W,markerPlacement:null,anchorPoint:null};W=Math.abs(aa.stepX);const qa=Math.abs(aa.stepY);var sa=(aa.randomness??100)/100;let ya,va;if("Random"===aa.gridType){var wa=a.px2pt(r.randomInsidePolygonTextureSize);const M=Math.max(Math.floor(wa/W),1),L=Math.max(Math.floor(wa/qa),1);wa=M*W/2;ya=L*qa/2;va=2*ya;aa=new l(aa.seed);const T=
sa*W/1.5,ha=sa*qa/1.5;sa=[];for(let oa=0;oa<M;oa++)for(let S=0;S<L;S++){const X=oa*W-wa+T*(.5-aa.getFloat()),ba=S*qa-ya+ha*(.5-aa.getFloat());sa.push({x:X,y:ba});0===oa&&sa.push({x:X+2*wa,y:ba});0===S&&sa.push({x:X,y:ba+2*ya})}}else!0===aa.shiftOddRows?(wa=W/2,ya=qa,va=2*qa,sa=[{x:-wa,y:0},{x:wa,y:0},{x:0,y:ya},{x:0,y:-ya}]):(wa=W/2,ya=qa/2,va=qa,sa=[{x:-W,y:0},{x:0,y:-qa},{x:-W,y:-qa},{x:0,y:0},{x:W,y:0},{x:0,y:qa},{x:W,y:qa},{x:-W,y:qa},{x:W,y:-qa}]);W=sa.map(M=>({type:"CIMMarkerGraphic",geometry:M,
symbol:{type:"CIMPointSymbol",symbolLayers:[ia]}}));return{type:"CIMVectorMarker",frame:{xmin:-wa,xmax:wa,ymin:-ya,ymax:ya},markerGraphics:W,size:va}}}const ca=W=>{if(!W)return m.LineCapStyle.Butt;switch(W){case "butt":return m.LineCapStyle.Butt;case "square":return m.LineCapStyle.Square;case "round":return m.LineCapStyle.Round}},ka=W=>{if(!W)return m.LineJoinStyle.Miter;switch(W){case "miter":return m.LineJoinStyle.Miter;case "round":return m.LineJoinStyle.Round;case "bevel":return m.LineJoinStyle.Bevel}},
Q=W=>{if(null==W)return"Center";switch(W){case "left":return"Left";case "right":return"Right";case "center":return"Center"}},R=W=>{if(null==W)return"Center";switch(W){case "baseline":return"Baseline";case "top":return"Top";case "middle":return"Center";case "bottom":return"Bottom"}},Z=W=>{if(!W)return[0,0,0,0];const {r:aa,g:ia,b:qa,a:sa}=W;return[aa,ia,qa,255*sa]},da=(W,aa)=>{const ia=n("safari")?.001:0;aa="butt"===aa;switch(W){case "dash":case "esriSLSDash":return aa?[4,3]:[3,4];case "dash-dot":case "esriSLSDashDot":return aa?
[4,3,1,3]:[3,4,ia,4];case "dot":case "esriSLSDot":return aa?[1,3]:[ia,4];case "long-dash":case "esriSLSLongDash":return aa?[8,3]:[7,4];case "long-dash-dot":case "esriSLSLongDashDot":return aa?[8,3,1,3]:[7,4,ia,4];case "long-dash-dot-dot":case "esriSLSDashDotDot":return aa?[8,3,1,3,1,3]:[7,4,ia,4,ia,4];case "short-dash":case "esriSLSShortDash":return aa?[4,1]:[3,2];case "short-dash-dot":case "esriSLSShortDashDot":return aa?[4,1,1,1]:[3,2,ia,2];case "short-dash-dot-dot":case "esriSLSShortDashDotDot":return aa?
[4,1,1,1,1,1]:[3,2,ia,2,ia,2];case "short-dot":case "esriSLSShortDot":return aa?[1,1]:[ia,2];case "solid":case "esriSLSSolid":case "none":return G().error("Unexpected: style does not require rasterization"),[0,0];default:return G().error(`Tried to rasterize SLS, but found an unexpected style: ${W}!`),[0,0]}},ja=(W,aa=100)=>{var ia=aa/2,qa;if("circle"===W||"esriSMSCircle"===W){var sa=Math.acos(1-.25/ia);aa=Math.ceil(E/sa/4);0===aa&&(aa=1);sa=K/aa;aa*=4;W=[];W.push([ia,0]);for(qa=1;qa<aa;qa++)W.push([ia*
Math.cos(qa*sa),-ia*Math.sin(qa*sa)]);W.push([ia,0]);sa={rings:[W]};qa={xmin:-ia,ymin:-ia,xmax:ia,ymax:ia}}else"cross"===W||"esriSMSCross"===W?(sa={paths:[[[0,ia],[0,-ia]],[[ia,0],[-ia,0]]]},qa={xmin:-ia,ymin:-ia,xmax:ia,ymax:ia}):"diamond"===W||"esriSMSDiamond"===W?(sa={rings:[[[-ia,0],[0,ia],[ia,0],[0,-ia],[-ia,0]]]},qa={xmin:-ia,ymin:-ia,xmax:ia,ymax:ia}):"square"===W||"esriSMSSquare"===W?(sa={rings:[[[-ia,-ia],[-ia,ia],[ia,ia],[ia,-ia],[-ia,-ia]]]},qa={xmin:-ia,ymin:-ia,xmax:ia,ymax:ia}):"x"===
W||"esriSMSX"===W?(sa={paths:[[[ia,ia],[-ia,-ia]],[[ia,-ia],[-ia,ia]]]},qa={xmin:-ia,ymin:-ia,xmax:ia,ymax:ia}):"triangle"===W||"esriSMSTriangle"===W?(ia=.5773502691896257*aa,W=-ia,qa=2/3*aa,aa=qa-aa,sa={rings:[[[W,aa],[0,qa],[ia,aa],[W,aa]]]},qa={xmin:W,ymin:aa,xmax:ia,ymax:qa}):"arrow"===W&&(sa={rings:[[[-50,50],[50,0],[-50,-50],[-33,-20],[-33,20],[-50,50]]]},qa={xmin:-ia,ymin:-ia,xmax:ia,ymax:ia});return[qa,sa]};b.CIMSymbolHelper=Y;b.CIMSymbolInflatedSizeHelper=N;b.capTypeToEnum=ca;b.getEffectsInflateSize=
B;b.slsDashToTemplateArray=da;b.symbolToCIM=function(W){let aa;switch(W.type){case "cim":return W.data;case "web-style":return W;case "simple-marker":W=Y.fromSimpleMarker(W);if(!W)throw Error("InternalError: Cannot convert symbol to CIM");aa=W;break;case "picture-marker":aa=Y.fromPictureMarker(W);break;case "simple-line":aa=Y.fromSimpleLineSymbol(W);break;case "simple-fill":aa=Y.fromSimpleFillSymbol(W);break;case "picture-fill":aa=Y.fromPictureFillSymbol(W);break;case "text":aa=Y.fromTextSymbol(W)}return{type:"CIMSymbolReference",
symbol:aa}};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/core/BidiText":function(){define(["exports","./BidiEngine"],function(b,q){const n=new q;b.bidiText=function(g){if(null==g)return["",!1];if(!n.hasBidiChar(g))return[g,!1];let k;k="rtl"===n.checkContextual(g)?"IDNNN":"ICNNN";return[n.bidiTransform(g,k,"VLYSN"),!0]};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/Font":function(){define("../chunks/tslib.es6 ../core/JSONSupport ../core/screenUtils ../core/accessorSupport/decorators/property ../core/accessorSupport/decorators/cast ../core/RandomLCG ../core/has ../core/accessorSupport/decorators/subclass ./support/textUtils".split(" "),
function(b,q,n,g,k,l,a,f,d){var c;q=c=class extends q.JSONSupport{constructor(e){super(e);this.decoration="none";this.family="sans-serif";this.size=9;this.weight=this.style="normal"}castSize(e){return n.toPt(e)}clone(){return new c({decoration:this.decoration,family:this.family,size:this.size,style:this.style,weight:this.weight})}hash(){return`${this.decoration}.${this.family}.${this.size}.${this.style}.${this.weight}`}};b.__decorate([g.property({type:d.fontDecorations,json:{default:"none",write:!0}})],
q.prototype,"decoration",void 0);b.__decorate([g.property({type:String,json:{write:!0}})],q.prototype,"family",void 0);b.__decorate([g.property({type:Number,json:{write:{overridePolicy(e,h,x){return{enabled:!x||!x.textSymbol3D}}}}})],q.prototype,"size",void 0);b.__decorate([k.cast("size")],q.prototype,"castSize",null);b.__decorate([g.property({type:d.fontStyles,json:{default:"normal",write:!0}})],q.prototype,"style",void 0);b.__decorate([g.property({type:d.fontWeights,json:{default:"normal",write:!0}})],
q.prototype,"weight",void 0);return q=c=b.__decorate([f.subclass("esri.symbols.Font")],q)})},"esri/symbols/support/textUtils":function(){define(["exports","../../core/mathUtils","../../core/accessorSupport/ensureType"],function(b,q,n){const g={type:Number,cast:d=>{d=n.ensureNumber(d);return 0===d?1:q.clamp(d,.1,4)},nonNullable:!0},k=["left","right","center"],l=["baseline","top","middle","bottom"],a={type:k,nonNullable:!0},f={type:l,nonNullable:!0};b.backgroundPadding=8;b.fontDecorations=["none","underline",
"line-through"];b.fontStyles=["normal","italic","oblique"];b.fontWeights=["normal","lighter","bold","bolder"];b.horizontalAlignmentProperty=a;b.horizontalAlignments=k;b.lineHeightProperty=g;b.verticalAlignmentProperty=f;b.verticalAlignments=l;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/CIMSymbolDrawHelper":function(){define("exports ../../core/fontUtils ../../core/has ../../core/lang ../../core/Logger ../../core/ObjectPool ../../core/screenUtils ../../geometry/GeometryCursor ../../geometry/support/aaBoundingRect ../../geometry/support/boundsUtils ../../geometry/support/centroid ../../geometry/support/jsonUtils ./CIMEffects ./CIMImageColorSubstitutionHelper ./CIMOperators ./CIMPlacements ./defaultCIMValues ./enums ./imageUtils ./Rect ./TextRasterizer ./utils ../../views/2d/engine/svgUtils ../../views/2d/engine/webgl/definitions ../../views/2d/engine/webgl/mesh/templates/shapingUtils ../../views/2d/layers/graphics/graphicsUtils".split(" "),
function(b,q,n,g,k,l,a,f,d,c,e,h,x,m,p,t,w,r,y,z,u,v,A,B,F,H){function J(Q,R,Z){for(const ja of R){R=ja.length;for(let W=1;W<R;W++){var da=ja[W-1];const aa=ja[W];let ia=(aa[0]-da[0])*(aa[0]-da[0])+(aa[1]-da[1])*(aa[1]-da[1]);if(0!==ia&&(ia=Math.sqrt(ia),Math.abs(((aa[0]-da[0])*(Q[1]-da[1])-(aa[1]-da[1])*(Q[0]-da[0]))/ia)<Z&&(da=((aa[0]-da[0])*(Q[0]-da[0])+(aa[1]-da[1])*(Q[1]-da[1]))/ia,da>-Z&&da<ia+Z)))return!0}}return!1}function E(Q,R=1){const Z=v.fromCIMFontDecoration(Q);var da=v.fromCIMFontStyle(Q.fontStyleName);
const ja=Q.fontFamilyName??q.defaultFontFamily,{weight:W,style:aa}=da;da=R*(Q.height||5);const ia=v.fromCIMHorizontalAlignment(Q.horizontalAlignment),qa=v.fromCIMVerticalAlignment(Q.verticalAlignment),sa=v.getFillColor(Q),ya=v.getFillColor(Q.haloSymbol),va=null!=ya?R*(Q.haloSize??0):0,wa=v.getStrokeColor(Q.symbol);R*=v.getStrokeWidth(Q.symbol)||0;var M="CIMBackgroundCallout"===Q.callout?.type?Q.callout.backgroundSymbol:null;Q=v.getFillColor(M);const L=v.getStrokeWidth(M);M=v.getStrokeColor(M);return{color:sa,
size:da,horizontalAlignment:ia,verticalAlignment:qa,font:{family:ja,style:v.getFontStyle(aa),weight:v.getFontWeight(W),decoration:Z},outline:{size:R||0,color:wa},halo:{size:va||0,color:ya,style:aa},backgroundColor:Q,borderLine:null!=L&&null!=M?{size:L,color:M}:null,pixelRatio:1,premultiplyColors:!0}}const K=Math.PI/180;class C{constructor(Q){this._t=Q}static createIdentity(){return new C([1,0,0,0,1,0])}clone(){return new C(this._t.slice())}transform(Q){const R=this._t;return[R[0]*Q[0]+R[1]*Q[1]+R[2],
R[3]*Q[0]+R[4]*Q[1]+R[5]]}static createScale(Q,R){return new C([Q,0,0,0,R,0])}scale(Q,R){const Z=this._t;Z[0]*=Q;Z[1]*=Q;Z[2]*=Q;Z[3]*=R;Z[4]*=R;Z[5]*=R;return this}scaleRatio(){return Math.sqrt(this._t[0]*this._t[0]+this._t[1]*this._t[1])}static createTranslate(Q,R){return new C([0,0,Q,0,0,R])}translate(Q,R){const Z=this._t;Z[2]+=Q;Z[5]+=R;return this}static createRotate(Q){const R=Math.cos(Q);Q=Math.sin(Q);return new C([R,-Q,0,Q,R,0])}rotate(Q){return C.multiply(this,C.createRotate(Q),this)}angle(){const Q=
this._t[0],R=this._t[3],Z=Math.sqrt(Q*Q+R*R);return[Q/Z,R/Z]}static multiply(Q,R,Z){Q=Q._t;R=R._t;const da=Q[1]*R[0]+Q[4]*R[1],ja=Q[2]*R[0]+Q[5]*R[1]+R[2],W=Q[0]*R[3]+Q[3]*R[4],aa=Q[1]*R[3]+Q[4]*R[4],ia=Q[2]*R[3]+Q[5]*R[4]+R[5],qa=Z._t;qa[0]=Q[0]*R[0]+Q[3]*R[1];qa[1]=da;qa[2]=ja;qa[3]=W;qa[4]=aa;qa[5]=ia;return Z}invert(){const Q=this._t;let R=Q[0]*Q[4]-Q[1]*Q[3];if(0===R)return new C([0,0,0,0,0,0]);R=1/R;return new C([Q[4]*R,-Q[1]*R,(Q[1]*Q[5]-Q[2]*Q[4])*R,-Q[3]*R,Q[0]*R,(Q[2]*Q[3]-Q[0]*Q[5])*R])}}
class D{constructor(Q,R){this._resourceManager=Q;this._transfos=[];this._sizeTransfos=[];this._geomUnitsPerPoint=1;this._placementPool=new l(t.Placement,void 0,void 0,100);this._earlyReturn=!1;this._mapRotation=0;this._transfos.push(R||C.createIdentity());this._sizeTransfos.push(R?R.scaleRatio():1)}setTransform(Q,R){this._transfos=[Q||C.createIdentity()];this._sizeTransfos=[R||(Q?Q.scaleRatio():1)]}setGeomUnitsPerPoint(Q){this._geomUnitsPerPoint=Q}transformPt(Q){return this._transfos[this._transfos.length-
1].transform(Q)}transformSize(Q){return Q*this._sizeTransfos[this._sizeTransfos.length-1]}reverseTransformPt(Q){return this._transfos[this._transfos.length-1].invert().transform(Q)}reverseTransformSize(Q){return Q/this._sizeTransfos[this._sizeTransfos.length-1]}reverseTransformScalar(Q){return Q/this._transfos[this._transfos.length-1].scaleRatio()}getTransformAngle(){return this._transfos[this._transfos.length-1].angle()}geomUnitsPerPoint(){return this.isEmbedded()?1:this._geomUnitsPerPoint}prevGeomUnitsPerPoint(){return 2<
this._transfos.length?1:this._geomUnitsPerPoint}isEmbedded(){return 1<this._transfos.length}back(){return this._transfos[this._transfos.length-1]}push(Q,R){R=R?Q.scaleRatio():1;C.multiply(Q,this.back(),Q);this._transfos.push(Q);this._sizeTransfos.push(this._sizeTransfos[this._sizeTransfos.length-1]*R)}pop(){this._transfos.splice(-1,1);this._sizeTransfos.splice(-1,1)}drawSymbol(Q,R,Z){if(Q)switch(Q.type){case "CIMPointSymbol":case "CIMLineSymbol":case "CIMPolygonSymbol":this.drawMultiLayerSymbol(Q,
R);break;case "CIMTextSymbol":this.drawTextSymbol(Q,R,Z)}}drawMultiLayerSymbol(Q,R){if(Q&&R){var Z=Q.symbolLayers;if(Z)if((Q=Q.effects)&&0<Q.length){if(R=this.executeEffects(Q,R))for(Q=R.next();Q;)this.drawSymbolLayers(Z,Q.asJSON()),Q=R.next()}else this.drawSymbolLayers(Z,R)}}executeEffects(Q,R){const Z=this._resourceManager.geometryEngine;R=new x.SimpleEffectCursor(f.GeometryCursor.fromJSONCIM(R));for(const da of Q)(Q=p.getEffectOperator(da))&&(R=Q.execute(R,da,this.geomUnitsPerPoint(),null,Z));
return R}drawSymbolLayers(Q,R){let Z=Q.length;for(;Z--;){const ja=Q[Z];if(ja&&!1!==ja.enable){var da=ja.effects;if(da&&0<da.length){if(da=this.executeEffects(da,R)){let W=null;for(;(W=da.next())&&(this.drawSymbolLayer(ja,W.asJSON()),!this._earlyReturn););}}else this.drawSymbolLayer(ja,R);if(this._earlyReturn)break}}}drawSymbolLayer(Q,R){switch(Q.type){case "CIMSolidFill":this.drawSolidFill(R,Q.color,Q.path);break;case "CIMHatchFill":this.drawHatchFill(R,Q);break;case "CIMPictureFill":this.drawPictureFill(R,
Q);break;case "CIMGradientFill":this.drawGradientFill(R,Q);break;case "CIMSolidStroke":this.drawSolidStroke(R,Q.color,Q.width,Q.capStyle,Q.joinStyle,Q.miterLimit,Q.path);break;case "CIMPictureStroke":this.drawPictureStroke(R,Q);break;case "CIMGradientStroke":this.drawGradientStroke(R,Q);break;case "CIMCharacterMarker":case "CIMPictureMarker":case "CIMVectorMarker":this.drawMarkerLayer(Q,R)}}drawHatchFill(Q,R){var Z=this.geomUnitsPerPoint(),da=v.getNumericValue(R.separation,w.defaultCIMValues.CIMHatchFill.separation)*
Z;var ja=v.getNumericValue(R.rotation);if(0===da)ja=null;else{0>da&&(da=-da);for(var W=0,aa=.5*da;W>aa;)W-=da;for(;W<-aa;)W+=da;var ia=d.create();c.getBoundsXY(ia,Q);ia[0]-=aa;ia[1]-=aa;ia[2]+=aa;ia[3]+=aa;for(var qa=[[ia[0],ia[1]],[ia[0],ia[3]],[ia[2],ia[3]],[ia[2],ia[1]]];180<ja;)ja-=180;for(;0>ja;)ja+=180;ia=Math.cos(ja*K);var sa=Math.sin(ja*K);ja=-da*sa;aa=da*ia;W=v.getNumericValue(R.offsetX)*Z;Z*=v.getNumericValue(R.offsetY);W=W*sa-Z*ia;var ya;var va=Z=Number.MAX_VALUE;var wa=ya=-Number.MAX_VALUE;
for(var M of qa){var L=M[0];const T=M[1];qa=ia*L+sa*T;L=-sa*L+ia*T;va=Math.min(va,qa);Z=Math.min(Z,L);wa=Math.max(wa,qa);ya=Math.max(ya,L)}Z=Math.floor(Z/da)*da;M=ia*va-sa*Z-ja*W/da;va=sa*va+ia*Z-aa*W/da;qa=ia*wa-sa*Z-ja*W/da;ia=sa*wa+ia*Z-aa*W/da;da=1+Math.round((ya-Z)/da);W=[];for(sa=0;sa<da;sa++)M+=ja,va+=aa,qa+=ja,ia+=aa,W.push([[M,va],[qa,ia]]);ja={paths:W}}ja&&(this.pushClipPath(Q),this.drawMultiLayerSymbol(R.lineSymbol,ja),this.popClipPath())}drawPictureFill(Q,R){}drawGradientFill(Q,R){}drawPictureStroke(Q,
R){}drawGradientStroke(Q,R){}drawMarkerLayer(Q,R){var Z=Q.markerPlacement;if(Z){var da=p.getPlacementOperator(Z);if(da){var ja="CIMMarkerPlacementInsidePolygon"===Z.type||"CIMMarkerPlacementPolygonCenter"===Z.type&&Z.clipAtBoundary;ja&&this.pushClipPath(R);if(R=da.execute(f.GeometryCursor.fromJSONCIM(R),Z,this.geomUnitsPerPoint(),null,this._resourceManager.geometryEngine))for(Z=null;(Z=R.next())&&(this.drawMarker(Q,Z),!this._earlyReturn););ja&&this.popClipPath()}}else{ja=this._placementPool.acquire();
if(h.isPoint(R))ja.tx=R.x,ja.ty=R.y,this.drawMarker(Q,ja);else if(h.isPolygon(R)){if(R=e.polygonCentroid(R))[ja.tx,ja.ty]=R,this.drawMarker(Q,ja)}else for(da of R.points)if(ja.tx=da[0],ja.ty=da[1],this.drawMarker(Q,ja),this._earlyReturn)break;this._placementPool.release(ja)}}drawMarker(Q,R){switch(Q.type){case "CIMCharacterMarker":case "CIMPictureMarker":this.drawPictureMarker(Q,R);break;case "CIMVectorMarker":this.drawVectorMarker(Q,R)}}drawPictureMarker(Q,R){if(Q){var Z=this._resourceManager.getResource(Q.url),
da=v.getNumericValue(Q.size,w.defaultCIMValues.CIMPictureMarker.size);if(!(null==Z||0>=da)){var ja=Z.width;Z=Z.height;if(ja&&Z){Z=ja/Z;var W=v.getNumericValue(Q.scaleX,1);ja=C.createIdentity();var aa=Q.anchorPoint;if(aa){var ia=aa.x;aa=aa.y;"Absolute"!==Q.anchorPointUnits&&(ia*=da*Z*W,aa*=da);ja.translate(-ia,-aa)}Z=v.getNumericValue(Q.rotation);Q.rotateClockwise&&(Z=-Z);this._mapRotation&&(Z+=this._mapRotation);Z&&ja.rotate(Z*K);Z=v.getNumericValue(Q.offsetX);W=v.getNumericValue(Q.offsetY);if(Z||
W){if(this._mapRotation){aa=K*this._mapRotation;ia=Math.cos(aa);aa=Math.sin(aa);const qa=Z*aa+W*ia;Z=Z*ia-W*aa;W=qa}ja.translate(Z,W)}Z=this.geomUnitsPerPoint();1!==Z&&ja.scale(Z,Z);(Z=R.getAngle())&&ja.rotate(Z);ja.translate(R.tx,R.ty);this.push(ja,!1);this.drawImage(Q,da);this.pop()}}}}drawVectorMarker(Q,R){if(Q){var Z=Q.markerGraphics;if(Z){var da=v.getNumericValue(Q.size,w.defaultCIMValues.CIMVectorMarker.size),ja=Q.frame,W=ja?ja.ymax-ja.ymin:0;W=da&&W?da/W:1;da=C.createIdentity();ja&&da.translate(.5*
-(ja.xmax+ja.xmin),.5*-(ja.ymax+ja.ymin));var aa=Q.anchorPoint;if(aa){var ia=aa.x;aa=aa.y;"Absolute"!==Q.anchorPointUnits?ja&&(ia*=ja.xmax-ja.xmin,aa*=ja.ymax-ja.ymin):(ia/=W,aa/=W);da.translate(-ia,-aa)}1!==W&&da.scale(W,W);ja=v.getNumericValue(Q.rotation);Q.rotateClockwise&&(ja=-ja);this._mapRotation&&(ja+=this._mapRotation);ja&&da.rotate(ja*K);ja=v.getNumericValue(Q.offsetX);W=v.getNumericValue(Q.offsetY);if(ja||W){if(this._mapRotation){aa=K*this._mapRotation;ia=Math.cos(aa);aa=Math.sin(aa);const qa=
ja*aa+W*ia;ja=ja*ia-W*aa;W=qa}da.translate(ja,W)}ja=this.geomUnitsPerPoint();1!==ja&&da.scale(ja,ja);(ja=R.getAngle())&&da.rotate(ja);da.translate(R.tx,R.ty);this.push(da,Q.scaleSymbolsProportionally);for(const qa of Z)if(qa?.symbol&&qa.geometry||k.getLogger("esri.symbols.cim.CIMSymbolDrawHelper").error("Invalid marker graphic",qa),Q=qa.textString,"number"===typeof Q&&(Q=Q.toString()),this.drawSymbol(qa.symbol,qa.geometry,Q),this._earlyReturn)break;this.pop()}}}drawTextSymbol(Q,R,Z){if(Q&&h.isPoint(R)&&
!(0>=v.getNumericValue(Q.height,w.defaultCIMValues.CIMTextSymbol.height))){var da=C.createIdentity(),ja=v.getNumericValue(Q.angle);(ja=-ja)&&da.rotate(ja*K);ja=v.getNumericValue(Q.offsetX);var W=v.getNumericValue(Q.offsetY);(ja||W)&&da.translate(ja,W);ja=this.geomUnitsPerPoint();1!==ja&&da.scale(ja,ja);da.translate(R.x,R.y);this.push(da,!1);this.drawText(Q,Z);this.pop()}}}class G extends D{constructor(Q,R){super(Q,R);this.reset()}reset(){this._xmin=this._ymin=Infinity;this._xmax=this._ymax=-Infinity;
this._clipCount=0}envelope(){return new z(this._xmin,this._ymin,this._xmax-this._xmin,this._ymax-this._ymin)}bounds(){return d.fromValues(this._xmin,this._ymin,this._xmax,this._ymax)}drawSolidFill(Q){!Q||0<this._clipCount||(h.isPolygon(Q)?this._processPath(Q.rings,0):h.isPolyline(Q)?this._processPath(Q.paths,0):h.isExtent(Q)?(Q=ca(Q))&&this._processPath(Q.rings,0):console.error("drawSolidFill Unexpected geometry type!"))}drawSolidStroke(Q,R,Z){!Q||0<this._clipCount||null==Z||0>=Z||(R=Math.max(.5*
this.transformSize(v.getNumericValue(Z,w.defaultCIMValues.CIMSolidStroke.width)),.25),h.isPolygon(Q)?this._processPath(Q.rings,R):h.isPolyline(Q)?this._processPath(Q.paths,R):h.isExtent(Q)?(Q=ca(Q))&&this._processPath(Q.rings,R):console.error("drawSolidStroke unexpected geometry type!"))}drawMarkerLayer(Q,R){h.isPolygon(R)&&Q.markerPlacement&&("CIMMarkerPlacementInsidePolygon"===Q.markerPlacement.type||"CIMMarkerPlacementPolygonCenter"===Q.markerPlacement.type&&Q.markerPlacement.clipAtBoundary)?this._processPath(R.rings,
0):super.drawMarkerLayer(Q,R)}drawHatchFill(Q,R){this.drawSolidFill(Q)}drawPictureFill(Q,R){this.drawSolidFill(Q)}drawGradientFill(Q,R){this.drawSolidFill(Q)}drawPictureStroke(Q,R){this.drawSolidStroke(Q,null,R.width)}drawGradientStroke(Q,R){this.drawSolidStroke(Q,null,R.width)}pushClipPath(Q){this.drawSolidFill(Q);this._clipCount++}popClipPath(){this._clipCount--}drawImage(Q,R){var {url:Z}=Q;Q=v.getNumericValue(Q.scaleX,1);let da=Q*R;var ja=R;Z=this._resourceManager.getResource(Z);null!=Z&&(ja=Z.height/
Z.width,da=Q*(R?1<ja?R:R/ja:Z.width),ja=R?1<ja?R*ja:R:Z.height);this._merge(this.transformPt([-da/2,-ja/2]),0);this._merge(this.transformPt([-da/2,ja/2]),0);this._merge(this.transformPt([da/2,-ja/2]),0);this._merge(this.transformPt([da/2,ja/2]),0)}drawText(Q,R){if(R&&0!==R.length){this._textRasterizer||(this._textRasterizer=new u);var Z=E(Q),[da,ja]=this._textRasterizer.computeTextSize(R,Z);da=a.px2pt(da);ja=a.px2pt(ja);R=this.transformSize(1)*this.reverseTransformScalar(1);da*=R;ja*=R;R=0;switch(Q.horizontalAlignment){case "Left":R=
da/2;break;case "Right":R=-da/2}Z=0;switch(Q.verticalAlignment){case "Bottom":Z=ja/2;break;case "Top":Z=-ja/2;break;case "Baseline":Z=ja/6}this._merge(this.transformPt([-da/2+R,-ja/2+Z]),0);this._merge(this.transformPt([-da/2+R,ja/2+Z]),0);this._merge(this.transformPt([da/2+R,-ja/2+Z]),0);this._merge(this.transformPt([da/2+R,ja/2+Z]),0)}}_processPath(Q,R){if(Q)for(const Z of Q)if(Q=Z?Z.length:0,1<Q){this._merge(this.transformPt(Z[0]),R);for(let da=1;da<Q;da++)this._merge(this.transformPt(Z[da]),R)}}_merge(Q,
R){Q[0]-R<this._xmin&&(this._xmin=Q[0]-R);Q[0]+R>this._xmax&&(this._xmax=Q[0]+R);Q[1]-R<this._ymin&&(this._ymin=Q[1]-R);Q[1]+R>this._ymax&&(this._ymax=Q[1]+R)}}class N extends D{constructor(){super(...arguments);this._searchPoint=[0,0];this._searchDistPoint=0;this._canvas=this._path=this._svg=this._textInfo=null}destroy(){this._svg=A.destroyHiddenSvg(this._svg);this._canvas=this._path=null}hitTest(Q,R,Z,da,ja,W){W*=a.pt2px(1);this.setTransform();this.setGeomUnitsPerPoint(W);this._searchPoint=[(Q[0]+
Q[2])/2,(Q[1]+Q[3])/2];this._searchDistPoint=(Q[2]-Q[0])/2/W;this._textInfo=da;this._mapRotation=R&&("CIMPointSymbol"===R.type&&"Map"!==R.angleAlignment||"CIMTextSymbol"===R.type)?ja:0;n("esri-mobile")||(Q=a.px2pt(B.hittestToleranceSmallSymbol*window.devicePixelRatio),da=a.px2pt(B.hittestSmallSymbolThreshold),("CIMLineSymbol"!==R?.type&&"CIMPolygonSymbol"!==R?.type||!R.symbolLayers?.some(v.isCIMFill))&&"CIMMeshSymbol"!==R?.type&&(v.getSize(R)??0)<da&&(this._searchDistPoint=Q));this._earlyReturn=!1;
this.drawSymbol(R,Z);return this._earlyReturn}executeEffects(Q,R){"CIMGeometricEffectDashes"===Q.at(-1)?.type&&(Q=Q.slice(0,-1));return super.executeEffects(Q,R)}drawSolidFill(Q,R,Z){null!=Z?this._hittestSvgPath(Q,Z,!0):this._hitTestFill(Q)}drawHatchFill(Q,R){this._hitTestFill(Q)}drawPictureFill(Q,R){this._hitTestFill(Q)}drawGradientFill(Q,R){this._hitTestFill(Q)}drawSolidStroke(Q,R,Z,da,ja,W,aa){null!=aa?this._hittestSvgPath(Q,aa,!1,Z):this._hitTestStroke(Q,Z)}drawPictureStroke(Q,R){this._hitTestStroke(Q,
R.width)}drawGradientStroke(Q,R){this._hitTestStroke(Q,R.width)}drawMarkerLayer(Q,R){Q.markerPlacement&&("CIMMarkerPlacementInsidePolygon"===Q.markerPlacement.type||"CIMMarkerPlacementPolygonCenter"===Q.markerPlacement.type&&Q.markerPlacement.clipAtBoundary)?this._hitTestFill(R):super.drawMarkerLayer(Q,R)}pushClipPath(Q){}popClipPath(){}drawImage(Q,R){var {url:Z}=Q;Q=v.getNumericValue(Q.scaleX,1);Z=this._resourceManager.getResource(Z);if(null!=Z&&0!==Z.height&&0!==R){R*=this.geomUnitsPerPoint();Q=
Z.width/Z.height*Q*R;Z=this.reverseTransformPt(this._searchPoint);var da=this._searchDistPoint;Math.abs(Z[0])<Q/2+da&&Math.abs(Z[1])<R/2+da&&(this._earlyReturn=!0)}}drawText(Q,R){if((R=this._textInfo)&&(R=R.get(Q))&&R.glyphMosaicItems.glyphs.length){var Z=H.roundPtToWholePixel(v.getNumericValue(Q.height,w.defaultCIMValues.CIMTextSymbol.height)),{lineGapType:da,lineGap:ja}=Q,W=da?ka(da,v.getNumericValue(ja),Z):0,aa="CIMBackgroundCallout"===Q.callout?.type;Q=F.shapeGlyphs(R.glyphMosaicItems,{scale:Z/
B.glyphSize,angle:0,xOffset:0,yOffset:0,horizontalAlignment:Q.horizontalAlignment,verticalAlignment:Q.verticalAlignment,maxLineWidth:H.getLineWidth(Q.lineWidth),lineHeight:B.magicLabelLineHeight*Math.max(.25,Math.min(W||1,4)),decoration:Q.font.decoration||"none",useCIMAngleBehavior:!0,hasBackground:aa});Z=this.reverseTransformPt(this._searchPoint);R=Z[0];Z=Z[1];for(const ia of Q.glyphs)if(R>ia.xTopLeft&&R<ia.xBottomRight&&Z>-ia.yBottomRight&&Z<-ia.yTopLeft){this._earlyReturn=!0;break}}}_hitTestFill(Q){let R=
null;if(h.isExtent(Q))R=[[[Q.xmin,Q.ymin],[Q.xmin,Q.ymax],[Q.xmax,Q.ymax],[Q.xmax,Q.ymin],[Q.xmin,Q.ymin]]];else if(h.isPolygon(Q))R=Q.rings;else if(h.isPolyline(Q))R=Q.paths;else return;Q=this.reverseTransformPt(this._searchPoint);let Z=0;for(var da of R){const ja=da.length;for(let W=1;W<ja;W++){const aa=da[W-1],ia=da[W];aa[1]>Q[1]!==ia[1]>Q[1]&&(0<(ia[0]-aa[0])*(Q[1]-aa[1])-(ia[1]-aa[1])*(Q[0]-aa[0])?Z++:Z--)}}0!==Z&&(this._earlyReturn=!0);this._earlyReturn||(da=this.reverseTransformScalar(this._searchDistPoint)*
this.prevGeomUnitsPerPoint(),J(Q,R,da)&&(this._earlyReturn=!0))}_getSvgPath(){if(null==this._svg||null==this._path)this._svg??(this._svg=A.createHiddenSvg()),this._path??(this._path=A.createSvgElement("path")),this._svg.appendChild(this._path);return this._path}_getCanvas(){this._canvas??(this._canvas=document.createElement("canvas"));return this._canvas}_hittestSvgPath(Q,R,Z,da){var ja=d.create();c.getBoundsXY(ja,Q);Q=ja[0];var W=ja[1],aa=ja[2]-ja[0];ja=ja[3]-ja[1];var ia=this._getSvgPath();ia.setAttribute("d",
R);const qa=ia.getBBox();aa=qa.width/aa;ia=qa.height/ja;var sa=this._getCanvas();sa.width=qa.width;sa.height=qa.height;sa=sa.getContext("2d",{willReadFrequently:!0});sa.setTransform(1,0,0,1,qa.x,-qa.y);R=new Path2D(R);Z?sa.fill(R):(sa.lineWidth=da*aa,sa.stroke(R));Z=this.reverseTransformScalar(this._searchDistPoint)*this.prevGeomUnitsPerPoint();da=this.reverseTransformPt(this._searchPoint);Q=sa.getImageData((da[0]-Q-Z)*aa,(ja-(da[1]-W)-Z)*ia,2*Z*aa,2*Z*ia).data;for(W=3;W<Q.length;W+=4)if(127.5<Q[W]){this._earlyReturn=
!0;break}}_hitTestStroke(Q,R){let Z=null;if(h.isExtent(Q))Z=[[[Q.xmin,Q.ymin],[Q.xmin,Q.ymax],[Q.xmax,Q.ymax],[Q.xmax,Q.ymin],[Q.xmin,Q.ymin]]];else if(h.isPolygon(Q))Z=Q.rings;else if(h.isPolyline(Q))Z=Q.paths;else return;Q=this.reverseTransformPt(this._searchPoint);R=v.getNumericValue(R,w.defaultCIMValues.CIMSolidStroke.width)*this.geomUnitsPerPoint();const da=this.reverseTransformScalar(this._searchDistPoint)*this.prevGeomUnitsPerPoint();J(Q,Z,R/2+da)&&(this._earlyReturn=!0)}}class Y extends D{constructor(Q,
R,Z,da){super(R,Z);this._applyAdditionalRenderProps=da;this._colorSubstitutionHelper=new m;this._ctx=Q}drawSolidFill(Q,R){if(Q){if(h.isPolygon(Q))this._buildPath(Q.rings,!0);else if(h.isPolyline(Q))this._buildPath(Q.paths,!0);else if(h.isExtent(Q))this._buildPath(ca(Q).rings,!0);else if(h.isMultipoint(Q))console.log("CanvasDrawHelper.drawSolidFill - No implementation!");else return;Q=this._ctx;Q.fillStyle="string"===typeof R?R:"rgba("+Math.round(R[0])+","+Math.round(R[1])+","+Math.round(R[2])+","+
(R[3]??255)/255+")";Q.fill("evenodd")}}drawSolidStroke(Q,R,Z,da,ja,W){if(Q&&R&&0!==Z){if(h.isPolygon(Q))this._buildPath(Q.rings,!0);else if(h.isPolyline(Q))this._buildPath(Q.paths,!1);else if(h.isExtent(Q))this._buildPath(ca(Q).rings,!0);else{console.log("CanvasDrawHelper.drawSolidStroke isn't implemented!");return}Q=this._ctx;Q.strokeStyle="string"===typeof R?R:"rgba("+Math.round(R[0])+","+Math.round(R[1])+","+Math.round(R[2])+","+(R[3]??255)/255+")";Q.lineWidth=Math.max(this.transformSize(Z),.5);
this._setCapStyle(da);this._setJoinStyle(ja);Q.miterLimit=W;Q.stroke()}}pushClipPath(Q){this._ctx.save();if(h.isPolygon(Q))this._buildPath(Q.rings,!0);else if(h.isPolyline(Q))this._buildPath(Q.paths,!0);else if(h.isExtent(Q))this._buildPath(ca(Q).rings,!0);else return;this._ctx.clip("evenodd")}popClipPath(){this._ctx.restore()}drawImage(Q,R){const {colorSubstitutions:Z,url:da,tintColor:ja}=Q;Q=v.getNumericValue(Q.scaleX,1);var W=this._resourceManager.getResource(da);if(null!=W){var aa=W.width/W.height*
R,ia=R;R||(aa=W.width,ia=W.height);var qa=v.isSVGImage(da)||"src"in W&&v.isSVGImage(W.src);R="getFrame"in W?y.getFirstFrame(W):W;Z&&(R=this._colorSubstitutionHelper.applyColorSubstitution(R,Z));this._applyAdditionalRenderProps&&!qa&&ja&&(R=this._colorSubstitutionHelper.tintImageData(R,ja));W=this.transformPt([0,0]);var [sa,ya]=this.getTransformAngle();qa=this.transformSize(1);var va=this._ctx;va.save();va.setTransform({m11:Q*qa*sa,m12:Q*qa*ya,m21:-qa*ya,m22:qa*sa,m41:W[0],m42:W[1]});va.drawImage(R,
-aa/2,-ia/2,aa,ia);va.restore()}}drawText(Q,R){if(R&&0!==R.length&&(this._textRasterizer||(this._textRasterizer=new u),Q=E(Q,this.transformSize(a.px2pt(1))),R=this._textRasterizer.rasterizeText(R,Q))){var {size:Z,anchorX:da,anchorY:ja,canvas:W}=R;R=Z[0]*(da+.5);Q=Z[1]*(ja-.5);var aa=this._ctx,ia=this.transformPt([0,0]),[qa,sa]=this.getTransformAngle();aa.save();aa.setTransform({m11:1*qa,m12:1*sa,m21:-1*sa,m22:1*qa,m41:ia[0]-1*R,m42:ia[1]+1*Q});aa.drawImage(W,0,0);aa.restore()}}drawPictureFill(Q,R){if(Q){var {colorSubstitutions:Z,
height:da,offsetX:ja,offsetY:W,rotation:aa,scaleX:ia,tintColor:qa,url:sa}=R;R=this._resourceManager.getResource(sa);if(null!=R){if(h.isPolygon(Q))this._buildPath(Q.rings,!0);else if(h.isPolyline(Q))this._buildPath(Q.paths,!0);else if(h.isExtent(Q))this._buildPath(ca(Q).rings,!0);else if(h.isMultipoint(Q))console.log("CanvasDrawHelper.drawPictureFill - No implementation!");else return;Q=this._ctx;var ya=v.isSVGImage(sa)||"src"in R&&v.isSVGImage(R.src),va="getFrame"in R?y.getFirstFrame(R):R;Z&&(va=
this._colorSubstitutionHelper.applyColorSubstitution(va,Z));if(this._applyAdditionalRenderProps){if(ya||qa&&(va=this._colorSubstitutionHelper.tintImageData(va,qa)),ya=Q.createPattern(va,"repeat"),va=this.transformSize(1),aa||=0,ja=ja?va*ja:0,W=W?va*W:0,da&&=va*da,va=da?da/R.height:1,R=ia&&da?ia*da/R.width:1,0!==aa||1!==va||1!==R||0!==ja||0!==W){const wa=new DOMMatrix;wa.rotateSelf(0,0,-aa).translateSelf(ja,W).scaleSelf(R,va,1);ya.setTransform(wa)}}else ya=Q.createPattern(va,"repeat");Q.save();Q.fillStyle=
ya;Q.fill("evenodd");Q.restore()}}}drawPictureStroke(Q,R){if(Q){var {colorSubstitutions:Z,capStyle:da,joinStyle:ja,miterLimit:W,tintColor:aa,url:ia,width:qa}=R;R=this._resourceManager.getResource(ia);if(null!=R){if(h.isPolygon(Q))var sa=Q.rings;else if(h.isPolyline(Q))sa=Q.paths;else if(h.isExtent(Q))sa=ca(Q).rings;else{h.isMultipoint(Q)&&console.log("CanvasDrawHelper.drawPictureStroke - No implementation!");return}qa||(qa=R.width);Q=v.isSVGImage(ia)||"src"in R&&v.isSVGImage(R.src);var ya="getFrame"in
R?y.getFirstFrame(R):R;Z&&(ya=this._colorSubstitutionHelper.applyColorSubstitution(ya,Z));this._applyAdditionalRenderProps&&(Q||aa&&(ya=this._colorSubstitutionHelper.tintImageData(ya,aa)));R=Math.max(this.transformSize(a.pt2px(qa)),.5);Q=R/ya.width;var va=this._ctx;ya=va.createPattern(ya,"repeat-y");va.save();this._setCapStyle(da);this._setJoinStyle(ja);void 0!==W&&(va.miterLimit=W);va.lineWidth=R;var wa;for(let oa of sa){oa=g.clone(oa);var M=wa=void 0,L=void 0;let S=M=void 0;sa=oa;for(var T=sa[0],
ha=1;ha<sa.length;)S=sa[ha][0]-T[0],M=sa[ha][1]-T[1],M=0!==S?M/S:Math.PI/2,void 0!==L&&1E-4>=M-L?(sa.splice(ha-1,1),T=wa):(wa=T,T=sa[ha],ha++),L=M;if(oa&&!(1>=oa.length))for(sa=this.transformPt(oa[0]),L=1;L<oa.length;L++)wa=this.transformPt(oa[L]),T=180/Math.PI*Math.atan2(wa[1]-sa[1],wa[0]-sa[0]),ha=new DOMMatrix,ha.translateSelf(0,sa[1]-R/2).scaleSelf(Q,Q,1).rotateSelf(0,0,90-T),ya.setTransform(ha),va.strokeStyle=ya,va.beginPath(),va.moveTo(sa[0],sa[1]),va.lineTo(wa[0],wa[1]),va.stroke(),sa=wa}va.restore()}}}_buildPath(Q,
R){const Z=this._ctx;Z.beginPath();if(Q)for(const da of Q)if(Q=da?da.length:0,1<Q){let ja=this.transformPt(da[0]);Z.moveTo(ja[0],ja[1]);for(let W=1;W<Q;W++)ja=this.transformPt(da[W]),Z.lineTo(ja[0],ja[1]);R&&Z.closePath()}}_setCapStyle(Q){switch(Q){case r.LineCapStyle.Butt:this._ctx.lineCap="butt";break;case r.LineCapStyle.Round:this._ctx.lineCap="round";break;case r.LineCapStyle.Square:this._ctx.lineCap="square"}}_setJoinStyle(Q){switch(Q){case r.LineJoinStyle.Bevel:this._ctx.lineJoin="bevel";break;
case r.LineJoinStyle.Round:this._ctx.lineJoin="round";break;case r.LineJoinStyle.Miter:this._ctx.lineJoin="miter"}}}const ca=Q=>Q?{spatialReference:Q.spatialReference,rings:[[[Q.xmin,Q.ymin],[Q.xmin,Q.ymax],[Q.xmax,Q.ymax],[Q.xmax,Q.ymin],[Q.xmin,Q.ymin]]]}:null,ka=(Q,R,Z)=>{switch(Q){case "ExtraLeading":return 1+R/Z;case "Multiple":return R;case "Exact":return R/Z}};b.CIMSymbolDrawHelper=D;b.CanvasDrawHelper=Y;b.EnvDrawHelper=G;b.HittestDrawHelper=N;b.Transformation=C;b.cDegToRad=K;b.lineGapType2LineHeight=
ka;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/core/fontUtils":function(){define(["exports","../config"],function(b,q){function n(e){if(!e)return"arial-unicode-ms";e=e.toLowerCase().split(" ").join("-");switch(e){case "serif":return"noto-serif";case "sans-serif":return"arial-unicode-ms";case "monospace":return"ubuntu-mono";case "fantasy":return"cabin-sketch";case "cursive":return"redressed";default:return e}}function g(e){const h=l(e)+a(e);return n(e.family)+(0<h.length?
h:"-regular")}function k(e){const h=l(e)+a(e);return(e.family||"arial-unicode-ms")+(0<h.length?h:"-regular")}function l(e){if(!e.weight)return"";switch(e.weight.toLowerCase()){case "bold":case "bolder":return"-bold"}return""}function a(e){if(!e.style)return"";switch(e.style.toLowerCase()){case "italic":case "oblique":return"-italic"}return""}const f=new Map,d=new Set;class c{constructor(e,h){this.fontFace=e;this.promise=h}}b.clearFonts=function(){const e=document.fonts;f.forEach(h=>{e.delete(h.fontFace)});
f.clear();d.clear()};b.defaultFontFamily="arial-unicode-ms";b.getFontFamily=n;b.getFullyQualifiedFontName=g;b.isCachedFontFace=function(e){return d.has(e)};b.loadFont=async function(e){const h=k(e),x=g(e),m=f.get(h);if(m)return m.promise;const p=new FontFace(e.family,`url('${q.fontsUrl}/woff2/${x}.${"woff2"}') format('${"woff2"}')`,{style:e.style,weight:e.weight}),t=document.fonts;if(t.has(p)&&"loading"===p.status)return p.loaded;e=p.load().then(()=>{t.add(p);return p});f.set(h,new c(p,e));d.add(p);
return e};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/CIMImageColorSubstitutionHelper":function(){define(function(){class b{applyColorSubstitution(q,n){if(!n)return q;this._rasterizationCanvas||(this._rasterizationCanvas=document.createElement("canvas"));const {width:g,height:k}=q,l=this._rasterizationCanvas,a=l.getContext("2d",{willReadFrequently:!0});q!==l&&(l.width=g,l.height=k,a.drawImage(q,0,0,g,k));q=a.getImageData(0,0,g,k).data;if(n)for(var f of n)if(f&&
f.oldColor&&4===f.oldColor.length&&f.newColor&&4===f.newColor.length){const [d,c,e,h]=f.oldColor,[x,m,p,t]=f.newColor;if(d!==x||c!==m||e!==p||h!==t)for(n=0;n<q.length;n+=4)d===q[n]&&c===q[n+1]&&e===q[n+2]&&h===q[n+3]&&(q[n]=x,q[n+1]=m,q[n+2]=p,q[n+3]=t)}f=new ImageData(q,g,k);a.putImageData(f,0,0);return l}tintImageData(q,n){if(!n||4>n.length)return q;this._rasterizationCanvas||(this._rasterizationCanvas=document.createElement("canvas"));const {width:g,height:k}=q,l=this._rasterizationCanvas,a=l.getContext("2d",
{willReadFrequently:!0});q!==l&&(l.width=g,l.height=k,a.drawImage(q,0,0,g,k));q=a.getImageData(0,0,g,k);q=new Uint8Array(q.data);n=[n[0]/255,n[1]/255,n[2]/255,n[3]/255];for(let f=0;f<q.length;f+=4)q[f]*=n[0],q[f+1]*=n[1],q[f+2]*=n[2],q[f+3]*=n[3];n=new ImageData(new Uint8ClampedArray(q.buffer),g,k);a.putImageData(n,0,0);return l}}return b})},"esri/symbols/cim/imageUtils":function(){define(["exports"],function(b){b.getFirstFrame=function(q){const n=q.getFrame(0);if(n instanceof HTMLImageElement||n instanceof
HTMLCanvasElement)return n;const g=document.createElement("canvas");g.width=q.width;g.height=q.height;q=g.getContext("2d");n instanceof ImageData?q.putImageData(n,0,0):q.drawImage(n,0,0);return g};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/Rect":function(){define(function(){class b{constructor(q=0,n=0,g=0,k=0){this.x=q;this.y=n;this.width=g;this.height=k}static fromExtent(q){return new b(q.xmin,-q.ymax,q.xmax-q.xmin,q.ymax-q.ymin)}get isEmpty(){return 0>=this.width||
0>=this.height}union(q){this.x=Math.min(this.x,q.x);this.y=Math.min(this.y,q.y);this.width=Math.max(this.width,q.width);this.height=Math.max(this.height,q.height)}}return b})},"esri/symbols/cim/TextRasterizer":function(){define(["../../core/screenUtils","../support/textUtils"],function(b,q){function n(l){return`rgba(${l.slice(0,3).toString()},${l[3]})`}function g(l,a){var f=a.font;f=`${f.style} ${f.weight} ${b.pt2px(Math.max(a.size,.5)).toFixed(1)}px ${f.family}, sans-serif`;l.font=f;l.textBaseline=
"top";switch(a.horizontalAlignment){case "left":a="left";break;case "right":a="right";break;case "center":a="center";break;default:a="left"}l.textAlign=a}class k{constructor(l){l&&(this._textRasterizationCanvas=l)}rasterizeText(l,a){this._textRasterizationCanvas||(this._textRasterizationCanvas=document.createElement("canvas"));const f=this._textRasterizationCanvas;var d=f.getContext("2d",{willReadFrequently:!0});g(d,a);this._parameters=a;this._textLines=l.split(/\r?\n/);this._lineHeight=this._computeLineHeight();
const {decoration:c,weight:e}=a.font;this._lineThroughWidthOffset=c&&"line-through"===c?.1*this._lineHeight:0;var h=(l=null!=a.backgroundColor||null!=a.borderLine)?q.backgroundPadding:0,x=this._computeTextWidth(d,a)+2*h,m=this._lineHeight*this._textLines.length+2*h;f.width=x+2*this._lineThroughWidthOffset;f.height=m;if(0===f.width||0===f.height)return f.width=f.height=1,{size:[0,0],image:new Uint32Array(0),sdf:!1,simplePattern:!1,anchorX:0,anchorY:0,canvas:f};this._renderedLineHeight=Math.round(this._lineHeight);
this._renderedOutlineSize=(a.outline.size||0)*a.pixelRatio;this._renderedHaloSize=(a.halo.size||0)*a.pixelRatio;this._renderedWidth=x;this._renderedHeight=m;this._lineThroughWidthOffset*=a.pixelRatio;x=(a.outline&&a.outline.color)??[0,0,0,0];m=a.halo&&a.halo.color?a.halo.color:[0,0,0,0];this._fillStyle=n(a.color??[0,0,0,0]);this._outlineStyle=n(x);this._haloStyle=`rgb(${m.slice(0,3).toString()})`;x=this._renderedLineHeight;m=this._renderedOutlineSize;var p=this._renderedHaloSize;d.save();d.clearRect(0,
0,f.width,f.height);g(d,a);var t=h*a.pixelRatio;h=d.textAlign;var w=this._renderedWidth-2*t,r=this._renderedHaloSize+this._renderedOutlineSize;h=("center"===h?.5*w:"right"===h?w-r:r)+t;t=p+m+t;p=0<p;w=this._lineThroughWidthOffset;r=0;if(l){d.save();l=a.borderLine?.color??[0,0,0,0];const z=2*(a.borderLine?.size??0);d.fillStyle=n(a.backgroundColor??[0,0,0,0]);d.strokeStyle=n(l);d.lineWidth=z;d.fillRect(0,0,f.width,f.height);d.strokeRect(0,0,f.width,f.height);d.restore()}p&&this._renderHalo(d,h,t,w,
r,a);0<m&&this._renderOutline(d,h,t,w,r,a);r+=t;w+=h;for(var y of this._textLines)p&&(d.globalCompositeOperation="destination-out",d.fillStyle="rgb(0, 0, 0)",d.fillText(y,w,r),d.globalCompositeOperation="source-over"),d.fillStyle=this._fillStyle,d.fillText(y,w,r),c&&"none"!==c&&this._renderDecoration(d,w,r,c,e),r+=x;d.restore();y=this._renderedWidth+2*this._lineThroughWidthOffset;l=this._renderedHeight;d=d.getImageData(0,0,y,l);d=new Uint8Array(d.data);if(a.premultiplyColors)for(m=0;m<d.length;m+=
4)x=d[m+3]/255,d[m]*=x,d[m+1]*=x,d[m+2]*=x;switch(a.horizontalAlignment){case "left":x=-.5;break;case "right":x=.5;break;default:x=0}switch(a.verticalAlignment){case "bottom":a=-.5;break;case "top":a=.5;break;case "baseline":a=-1/6;break;default:a=0}return{size:[y,l],image:new Uint32Array(d.buffer),sdf:!1,simplePattern:!1,anchorX:x,anchorY:a,canvas:f}}_renderHalo(l,a,f,d,c,e){const h=this._renderedWidth,x=this._renderedHeight;this._outlineRasterizationCanvas||(this._outlineRasterizationCanvas=document.createElement("canvas"));
this._outlineRasterizationCanvas.width=h;this._outlineRasterizationCanvas.height=x;const m=this._outlineRasterizationCanvas,p=m.getContext("2d");p.clearRect(0,0,h,x);g(p,e);const {decoration:t,weight:w}=e.font;p.fillStyle=this._haloStyle;p.strokeStyle=this._haloStyle;p.lineJoin="round";this._renderOutlineNative(p,a,f,t,w,this._renderedHaloSize+this._renderedOutlineSize);l.globalAlpha=this._parameters.halo.color[3];l.drawImage(m,0,0,h,x,d,c,h,x);l.globalAlpha=1}_renderOutline(l,a,f,d,c,e){const h=
this._renderedWidth,x=this._renderedHeight;this._outlineRasterizationCanvas||(this._outlineRasterizationCanvas=document.createElement("canvas"));this._outlineRasterizationCanvas.width=h;this._outlineRasterizationCanvas.height=x;const m=this._outlineRasterizationCanvas,p=m.getContext("2d");p.clearRect(0,0,h,x);g(p,e);const {decoration:t,weight:w}=e.font;p.fillStyle=this._outlineStyle;p.strokeStyle=this._outlineStyle;p.lineJoin="round";this._renderOutlineNative(p,a,f,t,w,this._renderedOutlineSize);
l.globalAlpha=this._parameters.outline.color[3];l.drawImage(m,0,0,h,x,d,c,h,x);l.globalAlpha=1}_renderOutlineNative(l,a,f,d,c,e){const h=this._renderedLineHeight;for(const x of this._textLines){const m=2*e;for(let p=0;5>p;p++){const t=(.6+.1*p)*m;l.lineWidth=t;l.strokeText(x,a,f);d&&"none"!==d&&this._renderDecoration(l,a,f,d,c,t)}f+=h}}computeTextSize(l,a){this._textRasterizationCanvas||(this._textRasterizationCanvas=document.createElement("canvas"));const f=this._textRasterizationCanvas;var d=f.getContext("2d");
g(d,a);this._parameters=a;this._textLines=l.split(/\r?\n/);this._lineHeight=this._computeLineHeight();l=this._computeTextWidth(d,a);d=this._lineHeight*this._textLines.length;f.width=l;f.height=d;return[l*a.pixelRatio,d*a.pixelRatio]}_computeTextWidth(l,a){let f=0;for(const d of this._textLines)f=Math.max(f,l.measureText(d).width);a=a.font;if("italic"===a.style||"oblique"===a.style||"string"===typeof a.weight&&("bold"===a.weight||"bolder"===a.weight)||"number"===typeof a.weight&&600<a.weight)f+=.3*
l.measureText("w").width;f+=2*b.pt2px(this._parameters.halo.size);return Math.round(f)}_computeLineHeightBase(){return 1.275*this._parameters.size}_computeLineHeight(){let l=this._computeLineHeightBase();const a=this._parameters.font.decoration;a&&"underline"===a&&(l*=1.3);return Math.round(l+2*b.pt2px(this._parameters.halo.size))}_renderDecoration(l,a,f,d,c,e){let h=.9*this._lineHeight;c="bold"===c?.06:"bolder"===c?.09:.04;switch(l.textAlign){case "center":a-=this._renderedWidth/2;break;case "right":a-=
this._renderedWidth}const x=l.textBaseline;if("underline"===d)switch(h=.9*this._computeLineHeightBase(),x){case "top":f+=h;break;case "middle":f+=h/2}else if("line-through"===d)switch(x){case "top":f+=h/1.5;break;case "middle":f+=h/3}d=e?1.5*e:Math.ceil(h*c);l.save();l.beginPath();l.strokeStyle=l.fillStyle;l.lineWidth=d;l.moveTo(a-this._lineThroughWidthOffset,f);l.lineTo(a+this._renderedWidth+2*this._lineThroughWidthOffset,f);l.stroke();l.restore()}}return k})},"esri/views/2d/engine/svgUtils":function(){define(["exports"],
function(b){function q(n){return document.createElementNS("http://www.w3.org/2000/svg",n)}b.createHiddenSvg=function(){const n=q("svg");n.setAttribute("style","position: absolute;");n.setAttribute("width","0");n.setAttribute("height","0");n.setAttribute("aria-hidden","true");n.setAttribute("role","presentation");document.body.appendChild(n);return n};b.createSvgElement=q;b.destroyHiddenSvg=function(n){null!=n&&document.body.removeChild(n);return null};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},
"esri/views/2d/engine/webgl/mesh/templates/shapingUtils":function(){define("exports ../../../../../../core/libs/gl-matrix-2/math/mat2d ../../../../../../core/libs/gl-matrix-2/factories/mat2df32 ../../../../../../core/libs/gl-matrix-2/math/vec2 ../../../../../../core/libs/gl-matrix-2/factories/vec2f32 ../../alignmentUtils ../../Rect ../../collisions/BoundingBox".split(" "),function(b,q,n,g,k,l,a,f){function d(m,p){m.forEach(t=>g.transformMat2d(t,t,p));return{topLeft:m[0],topRight:m[1],bottomLeft:m[2],
bottomRight:m[3]}}const c=Math.PI/180;class e{constructor(m,p,t,w){this._rotationT=n.create();this.minZoom=this._yBounds=this._xBounds=0;this.maxZoom=255;this._bounds=null;const r=t.rect,y=new Float32Array(8);m*=w;p*=w;const z=t.code?r.width*w:t.metrics.width,u=t.code?r.height*w:t.metrics.height;this.width=z;this.height=u;y[0]=m;y[1]=p;y[2]=m+z;y[3]=p;y[4]=m;y[5]=p+u;y[6]=m+z;y[7]=p+u;this._data=y;this._setTextureCoords(r);this._scale=w;this._mosaic=t;this.x=m;this.y=p;this.maxOffset=Math.max(m+z,
p+u)}get mosaic(){return this._mosaic}set angle(m){this._angle=m;q.fromRotation(this._rotationT,-m);this._setOffsets()}get angle(){return this._angle}get xTopLeft(){return this._data[0]}get yTopLeft(){return this._data[1]}get xBottomRight(){return this._data[6]}get yBottomRight(){return this._data[7]}get texcoords(){return this._texcoords}get textureBinding(){return this._mosaic.textureBinding}get offsets(){this._offsets||this._setOffsets();return this._offsets}get char(){return String.fromCharCode(this._mosaic.code)}get code(){return this._mosaic.code}get bounds(){if(!this._bounds){const {height:r,
width:y}=this._mosaic.metrics;var m=y*this._scale,p=Math.abs(r)*this._scale,t=new Float32Array(8);t[0]=this.x;t[1]=this.y;t[2]=this.x+m;t[3]=this.y;t[4]=this.x;t[5]=this.y+p;t[6]=this.x+m;t[7]=this.y+p;m=q.multiply(n.create(),this._rotationT,this._transform);n.transformMany(t,t,m);p=m=Infinity;let z=-Infinity;var w=-Infinity;for(let u=0;4>u;u++){const v=t[2*u],A=t[2*u+1];m=Math.min(m,v);p=Math.min(p,A);z=Math.max(z,v);w=Math.max(w,A)}t=z-m;w-=p;this._bounds=new f(m+t/2,p+w/2,t,w)}return this._bounds}setTransform(m){this._transform=
m;this._offsets=null}_setOffsets(){this._offsets||(this._offsets={topLeft:[0,0],topRight:[0,0],bottomLeft:[0,0],bottomRight:[0,0]});const m=q.multiply(n.create(),this._rotationT,this._transform);this._offsets.topLeft[0]=this._data[0];this._offsets.topLeft[1]=this._data[1];this._offsets.topRight[0]=this._data[2];this._offsets.topRight[1]=this._data[3];this._offsets.bottomLeft[0]=this._data[4];this._offsets.bottomLeft[1]=this._data[5];this._offsets.bottomRight[0]=this._data[6];this._offsets.bottomRight[1]=
this._data[7];g.transformMat2d(this._offsets.topLeft,this._offsets.topLeft,m);g.transformMat2d(this._offsets.topRight,this._offsets.topRight,m);g.transformMat2d(this._offsets.bottomLeft,this._offsets.bottomLeft,m);g.transformMat2d(this._offsets.bottomRight,this._offsets.bottomRight,m)}_setTextureCoords({x:m,y:p,width:t,height:w}){this._texcoords={topLeft:[m,p],topRight:[m+t,p],bottomLeft:[m,p+w],bottomRight:[m+t,p+w]}}}class h{constructor(m,p,t){this._rotation=0;this._decorate(m,p,t);this.glyphs=
m;this.bounds=this._createBounds(m);this.isMultiline=1<p.length;this._hasRotation=0!==t.angle;this._transform=this._createGlyphTransform(this.bounds,t);if((this._borderLineSizePx=t.borderLineSizePx)||t.hasBackground)[this.bounds,this.textBox]=this.shapeBackground(this._transform);for(const w of m)w.setTransform(this._transform)}setRotation(m){if(0!==m||0!==this._rotation){this._rotation=m;var p=this._transform;m=q.fromRotation(n.create(),m);q.multiply(p,m,p);for(const t of this.glyphs)t.setTransform(this._transform)}}_decorate(m,
p,t){if(t.decoration&&"none"!==t.decoration&&m.length){var w=t.scale;t="underline"===t.decoration?26:16;var r=m[0].textureBinding;for(const v of p){const A=v.startX*w,B=v.startY*w;p=m;var y=p.push;var z=(v.width+v.glyphWidthEnd)*w;var u=r;z={code:0,page:0,sdf:!0,rect:new a(0,0,11,8),textureBinding:u,metrics:{advance:0,height:4,width:z,left:0,top:0}};y.call(p,new e(A,B+t*w,z,1))}}}shapeBackground(m){const p=(1.5+(this._borderLineSizePx||0))/2;var t=this._borderLineSizePx?p:0;const {xmin:w,ymin:r,xmax:y,
ymax:z,x:u,y:v,width:A,height:B}=this.bounds,F=[w-8,r-8],H=[y+8,r-8],J=[w-8,z+8],E=[y+8,z+8],K=d([[F[0]-p,F[1]-p],[H[0]+p,H[1]-p],[F[0]+t,F[1]+t],[H[0]-t,H[1]+t]],m),C=d([[J[0]+t,J[1]-t],[E[0]-t,E[1]-t],[J[0]-p,J[1]+p],[E[0]+p,E[1]+p]],m),D=d([[F[0]-p,F[1]-p],[F[0]+t,F[1]+t],[J[0]-p,J[1]+p],[J[0]+t,J[1]-t]],m);t=d([[H[0]-t,H[1]+t],[H[0]+p,H[1]-p],[E[0]-t,E[1]-t],[E[0]+p,E[1]+p]],m);m={main:d([F,H,J,E],m),top:K,bot:C,left:D,right:t};return[new f(u,v,A+2*p,B+2*p),m]}get boundsT(){var m=this.bounds;
const p=g.set(k.create(),m.x,m.y);g.transformMat2d(p,p,this._transform);return this._hasRotation?(m=Math.max(m.width,m.height),new f(p[0],p[1],m,m)):new f(p[0],p[1],m.width,m.height)}_createBounds(m){let p=Infinity,t=Infinity,w=0;var r=0;for(const y of m)p=Math.min(p,y.xTopLeft),t=Math.min(t,y.yTopLeft),w=Math.max(w,y.xBottomRight),r=Math.max(r,y.yBottomRight);m=w-p;r-=t;return new f(p+m/2,t+r/2,m,r)}_createGlyphTransform(m,p){const t=c*p.angle,w=n.create(),r=k.create();q.translate(w,w,g.set(r,p.xOffset,
-p.yOffset));p.useCIMAngleBehavior?q.rotate(w,w,t):(q.translate(w,w,g.set(r,m.x,m.y)),q.rotate(w,w,t),q.translate(w,w,g.set(r,-m.x,-m.y)));return w}}class x{constructor(m,p,t,w,r,y){this.startY=this.startX=this.glyphWidthEnd=0;this.start=Math.max(0,Math.min(p,t));this.end=Math.max(0,Math.max(p,t));this.end<m.length&&(this.glyphWidthEnd=m[this.end].metrics.width);this.width=w;this.yMin=r;this.yMax=y}}b.ShapedGlyph=e;b.ShapingInfo=h;b.shapeGlyphs=function(m,p){const t=p.scale,w=[],{glyphs:r,isRightToLeft:y}=
m,z=[];var u=1/p.scale*p.maxLineWidth,v=y?r.length-1:0,A=y?-1:r.length,B=y?-1:1,F=v,H=0,J=0,E=F;let K=E,C=0,D=Infinity,G=0;for(;F!==A;){const {code:Y,metrics:ca}=r[F];var N=Math.abs(ca.top);10!==Y&&32!==Y&&(D=Math.min(D,N),G=Math.max(G,N+ca.height));10===Y?(F!==v&&(z.push(new x(r,E,F-B,H,Infinity===D?0:D,G)),D=Infinity,G=0),H=0,E=F+B,K=F+B,J=0):32===Y?(K=F+B,J=0,C=ca.advance,H+=ca.advance):(H>u&&(K!==E?(N=K-2*B,H-=C,z.push(new x(r,E,N,H-J,D,G)),D=Infinity,G=0,E=K,H=J):(z.push(new x(r,E,F-B,H,D,G)),
D=Infinity,G=0,K=E=F,H=0)),H+=ca.advance,J+=ca.advance);F+=B}u=new x(r,E,F-B,H,D,G);0<=u.start&&u.end<r.length&&z.push(u);if(z.length){u=0;for(v=0;v<z.length;v++)({width:A}=z[v]),u=Math.max(A,u);v=z[0].yMin;u={x:0,y:v,height:z[z.length-1].yMax+p.lineHeight*(z.length-1)+("underline"===p.decoration?4:0)-v,width:u}}else u={x:0,y:0,height:0,width:0};v=u;u=l.getXAnchorDirection(p.horizontalAlignment);A=l.getYAnchorDirection(p.verticalAlignment);B=A===l.VAlign.Baseline?1:0;v=(1-B)*-v.y+v.height/2*(B?0:
A-1)+-22*(B?1:0);for(A=0;A<z.length;A++){const {start:Y,end:ca,width:ka}=z[A];B=ka/2*(u+1)*-1-3;F=(m.isRightToLeft?z.length-1-A:A)*p.lineHeight+v-3;z[A].startX=B;z[A].startY=F;for(H=Y;H<=ca;H++)J=r[H],10!==J.code&&(E=new e(B+J.metrics.left,F-J.metrics.top,J,t),B+=J.metrics.advance,w.push(E))}return new h(w,z,p)};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/core/libs/gl-matrix-2/math/mat2d":function(){define(["exports","./common"],function(b,q){function n(B,F){B[0]=F[0];B[1]=
F[1];B[2]=F[2];B[3]=F[3];B[4]=F[4];B[5]=F[5];return B}function g(B){B[0]=1;B[1]=0;B[2]=0;B[3]=1;B[4]=0;B[5]=0;return B}function k(B,F,H,J,E,K,C){B[0]=F;B[1]=H;B[2]=J;B[3]=E;B[4]=K;B[5]=C;return B}function l(B,F){const H=F[0],J=F[1],E=F[2],K=F[3],C=F[4];F=F[5];let D=H*K-J*E;if(!D)return null;D=1/D;B[0]=K*D;B[1]=-J*D;B[2]=-E*D;B[3]=H*D;B[4]=(E*F-K*C)*D;B[5]=(J*C-H*F)*D;return B}function a(B){return B[0]*B[3]-B[1]*B[2]}function f(B,F,H){const J=F[0],E=F[1],K=F[2],C=F[3],D=F[4];F=F[5];const G=H[0],N=
H[1],Y=H[2],ca=H[3],ka=H[4];H=H[5];B[0]=J*G+K*N;B[1]=E*G+C*N;B[2]=J*Y+K*ca;B[3]=E*Y+C*ca;B[4]=J*ka+K*H+D;B[5]=E*ka+C*H+F;return B}function d(B,F,H){const J=F[0],E=F[1],K=F[2],C=F[3],D=F[4];F=F[5];const G=Math.sin(H);H=Math.cos(H);B[0]=J*H+K*G;B[1]=E*H+C*G;B[2]=J*-G+K*H;B[3]=E*-G+C*H;B[4]=D;B[5]=F;return B}function c(B,F,H){const J=F[1],E=F[2],K=F[3],C=F[4],D=F[5],G=H[0];H=H[1];B[0]=F[0]*G;B[1]=J*G;B[2]=E*H;B[3]=K*H;B[4]=C;B[5]=D;return B}function e(B,F,H){const J=F[0],E=F[1],K=F[2],C=F[3],D=F[4];
F=F[5];const G=H[0];H=H[1];B[0]=J;B[1]=E;B[2]=K;B[3]=C;B[4]=J*G+K*H+D;B[5]=E*G+C*H+F;return B}function h(B,F){const H=Math.sin(F);F=Math.cos(F);B[0]=F;B[1]=H;B[2]=-H;B[3]=F;B[4]=0;B[5]=0;return B}function x(B,F){B[0]=F[0];B[1]=0;B[2]=0;B[3]=F[1];B[4]=0;B[5]=0;return B}function m(B,F){B[0]=1;B[1]=0;B[2]=0;B[3]=1;B[4]=F[0];B[5]=F[1];return B}function p(B){return"mat2d("+B[0]+", "+B[1]+", "+B[2]+", "+B[3]+", "+B[4]+", "+B[5]+")"}function t(B){return Math.sqrt(B[0]**2+B[1]**2+B[2]**2+B[3]**2+B[4]**2+
B[5]**2+1)}function w(B,F,H){B[0]=F[0]+H[0];B[1]=F[1]+H[1];B[2]=F[2]+H[2];B[3]=F[3]+H[3];B[4]=F[4]+H[4];B[5]=F[5]+H[5];return B}function r(B,F,H){B[0]=F[0]-H[0];B[1]=F[1]-H[1];B[2]=F[2]-H[2];B[3]=F[3]-H[3];B[4]=F[4]-H[4];B[5]=F[5]-H[5];return B}function y(B,F,H){B[0]=F[0]*H;B[1]=F[1]*H;B[2]=F[2]*H;B[3]=F[3]*H;B[4]=F[4]*H;B[5]=F[5]*H;return B}function z(B,F,H,J){B[0]=F[0]+H[0]*J;B[1]=F[1]+H[1]*J;B[2]=F[2]+H[2]*J;B[3]=F[3]+H[3]*J;B[4]=F[4]+H[4]*J;B[5]=F[5]+H[5]*J;return B}function u(B,F){return B[0]===
F[0]&&B[1]===F[1]&&B[2]===F[2]&&B[3]===F[3]&&B[4]===F[4]&&B[5]===F[5]}function v(B,F){const H=B[0],J=B[1],E=B[2],K=B[3],C=B[4];B=B[5];const D=F[0],G=F[1],N=F[2],Y=F[3],ca=F[4];F=F[5];const ka=q.getEpsilon();return Math.abs(H-D)<=ka*Math.max(1,Math.abs(H),Math.abs(D))&&Math.abs(J-G)<=ka*Math.max(1,Math.abs(J),Math.abs(G))&&Math.abs(E-N)<=ka*Math.max(1,Math.abs(E),Math.abs(N))&&Math.abs(K-Y)<=ka*Math.max(1,Math.abs(K),Math.abs(Y))&&Math.abs(C-ca)<=ka*Math.max(1,Math.abs(C),Math.abs(ca))&&Math.abs(B-
F)<=ka*Math.max(1,Math.abs(B),Math.abs(F))}const A=Object.freeze(Object.defineProperty({__proto__:null,add:w,copy:n,determinant:a,equals:v,exactEquals:u,frob:t,fromRotation:h,fromScaling:x,fromTranslation:m,identity:g,invert:l,mul:f,multiply:f,multiplyScalar:y,multiplyScalarAndAdd:z,rotate:d,scale:c,set:k,str:p,sub:r,subtract:r,translate:e},Symbol.toStringTag,{value:"Module"}));b.add=w;b.copy=n;b.determinant=a;b.equals=v;b.exactEquals=u;b.frob=t;b.fromRotation=h;b.fromScaling=x;b.fromTranslation=
m;b.identity=g;b.invert=l;b.mat2d=A;b.mul=f;b.multiply=f;b.multiplyScalar=y;b.multiplyScalarAndAdd=z;b.rotate=d;b.scale=c;b.set=k;b.str=p;b.sub=r;b.subtract=r;b.translate=e;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/core/libs/gl-matrix-2/factories/mat2df32":function(){define(["exports"],function(b){function q(){const d=new Float32Array(6);d[0]=1;d[3]=1;return d}function n(d){const c=new Float32Array(6);c[0]=d[0];c[1]=d[1];c[2]=d[2];c[3]=d[3];c[4]=d[4];c[5]=d[5];return c}
function g(d,c,e,h,x,m){const p=new Float32Array(6);p[0]=d;p[1]=c;p[2]=e;p[3]=h;p[4]=x;p[5]=m;return p}function k(d,c){return new Float32Array(d,c,6)}function l(d,c,e,h){const x=c[h];c=c[h+1];d[h]=e[0]*x+e[2]*c+e[4];d[h+1]=e[1]*x+e[3]*c+e[5]}function a(d,c,e,h=0,x=0,m=2){for(x=x||c.length/m;h<x;h++)l(d,c,e,h*m)}const f=Object.freeze(Object.defineProperty({__proto__:null,clone:n,create:q,createView:k,fromValues:g,transform:l,transformMany:a},Symbol.toStringTag,{value:"Module"}));b.clone=n;b.create=
q;b.createView=k;b.fromValues=g;b.mat2df32=f;b.transform=l;b.transformMany=a;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/core/libs/gl-matrix-2/factories/vec2f32":function(){define(["exports"],function(b){function q(){return new Float32Array(2)}function n(p){const t=new Float32Array(2);t[0]=p[0];t[1]=p[1];return t}function g(p,t){const w=new Float32Array(2);w[0]=p;w[1]=t;return w}function k(p,t){return new Float32Array(p,t,2)}function l(){return q()}function a(){return g(1,
1)}function f(){return g(1,0)}function d(){return g(0,1)}const c=q(),e=a(),h=f(),x=d(),m=Object.freeze(Object.defineProperty({__proto__:null,ONES:e,UNIT_X:h,UNIT_Y:x,ZEROS:c,clone:n,create:q,createView:k,fromValues:g,ones:a,unitX:f,unitY:d,zeros:l},Symbol.toStringTag,{value:"Module"}));b.ONES=e;b.UNIT_X=h;b.UNIT_Y=x;b.ZEROS=c;b.clone=n;b.create=q;b.createView=k;b.fromValues=g;b.ones=a;b.unitX=f;b.unitY=d;b.vec2f32=m;b.zeros=l;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/alignmentUtils":function(){define(["exports",
"../../../../core/Logger"],function(b,q){b.HAlign=void 0;(function(n){n[n.Left=-1]="Left";n[n.Center=0]="Center";n[n.Right=1]="Right"})(b.HAlign||(b.HAlign={}));b.VAlign=void 0;(function(n){n[n.Top=1]="Top";n[n.Center=0]="Center";n[n.Bottom=-1]="Bottom";n[n.Baseline=2]="Baseline"})(b.VAlign||(b.VAlign={}));b.getAlignmentFromPlacement=function(n){switch(n){case "above-left":case "esriServerPointLabelPlacementAboveLeft":return["right","bottom"];case "above-center":case "above-along":case "esriServerPointLabelPlacementAboveCenter":case "esriServerLinePlacementAboveAlong":return["center",
"bottom"];case "above-right":case "esriServerPointLabelPlacementAboveRight":return["left","bottom"];case "center-left":case "esriServerPointLabelPlacementCenterLeft":return["right","middle"];case "center-center":case "center-along":case "esriServerPointLabelPlacementCenterCenter":case "esriServerLinePlacementCenterAlong":return["center","middle"];case "center-right":case "esriServerPointLabelPlacementCenterRight":return["left","middle"];case "below-left":case "esriServerPointLabelPlacementBelowLeft":return["right",
"top"];case "below-center":case "below-along":case "esriServerPointLabelPlacementBelowCenter":case "esriServerLinePlacementBelowAlong":return["center","top"];case "below-right":case "esriServerPointLabelPlacementBelowRight":return["left","top"];case "always-horizontal":case "esriServerPolygonPlacementAlwaysHorizontal":return["center","middle"];default:return console.debug(`Found invalid placement type ${n}`),["center","middle"]}};b.getJustification=function(n){switch(n){case "left":return b.HAlign.Left;
case "right":return b.HAlign.Right;case "center":return b.HAlign.Center}};b.getXAnchorDirection=function(n){if(!n)return b.HAlign.Center;switch(n){case "Left":case "left":return b.HAlign.Left;case "Right":case "right":return b.HAlign.Right;case "Justify":return q.getLogger("esri.views.2d.engine.webgl.alignmentUtils").warnOnce("Horizontal alignment 'justify' is not implemented. Falling back to 'center'."),b.HAlign.Center;case "Center":case "center":return b.HAlign.Center}};b.getXDirection=function(n){switch(n){case b.HAlign.Right:case "right":return-1;
case b.HAlign.Center:case "center":return 0;case b.HAlign.Left:case "left":return 1;default:return console.debug(`Found invalid horizontal alignment ${n}`),0}};b.getYAnchorDirection=function(n){if(!n)return b.VAlign.Center;switch(n){case "Top":case "top":return b.VAlign.Top;case "Center":case "middle":return b.VAlign.Center;case "Baseline":case "baseline":return b.VAlign.Baseline;case "Bottom":case "bottom":return b.VAlign.Bottom}};b.getYDirection=function(n){switch(n){case b.VAlign.Top:case "top":return 1;
case b.VAlign.Center:case "middle":return 0;case b.VAlign.Bottom:case b.VAlign.Baseline:case "baseline":case "bottom":return-1;default:return console.debug(`Found invalid vertical alignment ${n}`),0}};b.isMapAligned=function(n){switch(n){case "above-along":case "below-along":case "center-along":case "esriServerLinePlacementAboveAlong":case "esriServerLinePlacementBelowAlong":case "esriServerLinePlacementCenterAlong":return!0;default:return!1}};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},
"esri/views/2d/engine/webgl/collisions/BoundingBox":function(){define(["../../../../../core/libs/gl-matrix-2/factories/vec2f32"],function(b){class q{constructor(n,g,k,l){this.transformedY=this.transformedX=0;this.center=b.fromValues(n,g);this.centerT=b.create();this.halfWidth=k/2;this.halfHeight=l/2;this.width=k;this.height=l}get x(){return this.center[0]}get y(){return this.center[1]}get blX(){return this.center[0]+this.halfWidth}get blY(){return this.center[1]+this.halfHeight}get trX(){return this.center[0]-
this.halfWidth}get trY(){return this.center[1]-this.halfHeight}get xmin(){return this.x-this.halfWidth}get xmax(){return this.x+this.halfWidth}get ymin(){return this.y-this.halfHeight}get ymax(){return this.y+this.halfHeight}set x(n){this.center[0]=n}set y(n){this.center[1]=n}clone(){return new q(this.x,this.y,this.width,this.height)}serialize(n){n.writeF32(this.center[0]);n.writeF32(this.center[1]);n.push(this.width);n.push(this.height);return n}findCollisionDelta(n,g=4){return Math.log2(Math.min((n.halfWidth+
this.halfWidth+g)/Math.abs(n.centerT[0]-this.centerT[0]),(n.halfHeight+this.halfHeight+g)/Math.abs(n.centerT[1]-this.centerT[1])))}extend(n){const g=Math.min(this.xmin,n.xmin),k=Math.min(this.ymin,n.ymin),l=Math.max(this.xmax,n.xmax)-g;n=Math.max(this.ymax,n.ymax)-k;this.width=l;this.height=n;this.halfWidth=l/2;this.halfHeight=n/2;this.x=g+l/2;this.y=k+n/2}static deserialize(n){const g=n.readF32(),k=n.readF32(),l=n.readInt32();n=n.readInt32();return new q(g,k,l,n)}}return q})},"esri/views/2d/layers/graphics/graphicsUtils":function(){define("exports ../../../../core/screenUtils ../../../../geometry/Polygon ../../../../geometry/support/aaBoundingRect ../../../../geometry/support/spatialReferenceUtils ../../engine/webgl/definitions".split(" "),
function(b,q,n,g,k,l){b.getLineWidth=function(a){const f=q.px2pt(l.minTextLineWidth),d=q.px2pt(l.maxTextLineWidth);return Math.max(f,Math.min(a||d,d))};b.intersectingInternationalDateline=function(a,f){f=k.getInfo(f);if(!f)return null;const [d,c]=f.valid;return a[2]>c?[g.create([a[0],a[1],c,a[3]]),g.create([d,a[1],d+a[2]-c,a[3]])]:a[0]<d?[g.create([d,a[1],a[2],a[3]]),g.create([c-(d-a[0]),a[1],c,a[3]])]:null};b.isMarkerSymbol=function(a){return"simple-marker"===a||"picture-marker"===a||"esriSMS"===
a||"esriPMS"===a};b.isTextSymbol=function(a){return"text"===a||"esriTS"===a};b.pixelBuffer=50;b.polygonFromExtent=function(a){if(!a)return null;const {xmin:f,ymin:d,xmax:c,ymax:e,spatialReference:h}=a;return new n({rings:[[[f,d],[f,e],[c,e],[c,d],[f,d]]],spatialReference:h})};b.roundPtToWholePixel=function(a){return q.px2pt(Math.round(q.pt2px(a)))};b.tileSize=512;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/support/defaults":function(){define("exports ../../core/has ../SimpleFillSymbol ../SimpleLineSymbol ../SimpleMarkerSymbol ../TextSymbol ./defaultsJSON".split(" "),
function(b,q,n,g,k,l,a){const f=k.fromJSON(a.defaultPointSymbolJSON),d=g.fromJSON(a.defaultPolylineSymbolJSON),c=n.fromJSON(a.defaultPolygonSymbolJSON);q=l.fromJSON(a.defaultTextSymbolJSON);k=k.fromJSON(a.errorPointSymbolJSON);g=g.fromJSON(a.errorPolylineSymbolJSON);n=n.fromJSON(a.errorPolygonSymbolJSON);b.defaultPointSymbol2D=f;b.defaultPolygonSymbol2D=c;b.defaultPolylineSymbol2D=d;b.defaultTextSymbol2D=q;b.errorPointSymbol2D=k;b.errorPolygonSymbol2D=n;b.errorPolylineSymbol2D=g;b.getDefaultSymbol2D=
function(e){if(null==e)return null;switch(e.type){case "point":case "multipoint":return f;case "polyline":return d;case "polygon":case "extent":return c}return null};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/SimpleFillSymbol":function(){define("../chunks/tslib.es6 ../Color ../core/jsonMap ../core/lang ../core/accessorSupport/decorators/property ../core/has ../core/Logger ../core/accessorSupport/decorators/enumeration ../core/accessorSupport/decorators/subclass ./FillSymbol ./SimpleLineSymbol".split(" "),
function(b,q,n,g,k,l,a,f,d,c,e){var h;n=new n.JSONMap({esriSFSSolid:"solid",esriSFSNull:"none",esriSFSHorizontal:"horizontal",esriSFSVertical:"vertical",esriSFSForwardDiagonal:"forward-diagonal",esriSFSBackwardDiagonal:"backward-diagonal",esriSFSCross:"cross",esriSFSDiagonalCross:"diagonal-cross"});c=h=class extends c{constructor(...x){super(...x);this.color=new q([0,0,0,.25]);this.outline=new e;this.type="simple-fill";this.style="solid"}normalizeCtorArgs(x,m,p){if(x&&"string"!==typeof x)return x;
const t={};x&&(t.style=x);m&&(t.outline=m);p&&(t.color=p);return t}clone(){return new h({color:g.clone(this.color),outline:this.outline&&this.outline.clone(),style:this.style})}hash(){return`${super.hash()}${this.style}.${this.color&&this.color.hash()}`}};b.__decorate([k.property()],c.prototype,"color",void 0);b.__decorate([k.property()],c.prototype,"outline",void 0);b.__decorate([f.enumeration({esriSFS:"simple-fill"},{readOnly:!0})],c.prototype,"type",void 0);b.__decorate([k.property({type:n.apiValues,
json:{read:n.read,write:n.write}})],c.prototype,"style",void 0);return c=h=b.__decorate([d.subclass("esri.symbols.SimpleFillSymbol")],c)})},"esri/core/accessorSupport/decorators/enumeration":function(){define(["exports","../../jsonMap","./property"],function(b,q,n){b.enumeration=function(g,k={}){g=g instanceof q.JSONMap?g:new q.JSONMap(g,k);const {alwaysWriteDefaults:l,default:a,ignoreUnknown:f=!0,name:d,nonNullable:c,readOnly:e=!1}=k;return n.property({type:f?g.apiValues:String,json:{type:g.jsonValues,
default:a,name:d,read:e?!1:{reader:g.read},write:{writer:g.write,alwaysWriteDefaults:l}},nonNullable:c,readOnly:e})};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/FillSymbol":function(){define("../chunks/tslib.es6 ../core/accessorSupport/decorators/property ../core/has ../core/Logger ../core/RandomLCG ../core/accessorSupport/decorators/subclass ./SimpleLineSymbol ./Symbol".split(" "),function(b,q,n,g,k,l,a,f){n=class extends f{constructor(d){super(d);this.type=this.outline=
null}hash(){return`${this.type}.${this.outline?.hash()}`}};b.__decorate([q.property({types:{key:"type",base:null,defaultKeyValue:"simple-line",typeMap:{"simple-line":a}},json:{default:null,write:!0}})],n.prototype,"outline",void 0);b.__decorate([q.property({type:["simple-fill","picture-fill"],readOnly:!0})],n.prototype,"type",void 0);return n=b.__decorate([l.subclass("esri.symbols.FillSymbol")],n)})},"esri/symbols/SimpleLineSymbol":function(){define("../chunks/tslib.es6 ../core/jsonMap ../core/lang ../core/screenUtils ../core/accessorSupport/decorators/property ../core/has ../core/Logger ../core/accessorSupport/decorators/enumeration ../core/accessorSupport/decorators/subclass ./LineSymbol ./LineSymbolMarker".split(" "),
function(b,q,n,g,k,l,a,f,d,c,e){var h;q=new q.JSONMap({esriSLSSolid:"solid",esriSLSDash:"dash",esriSLSDot:"dot",esriSLSDashDot:"dash-dot",esriSLSDashDotDot:"long-dash-dot-dot",esriSLSNull:"none",esriSLSShortDash:"short-dash",esriSLSShortDot:"short-dot",esriSLSShortDashDot:"short-dash-dot",esriSLSShortDashDotDot:"short-dash-dot-dot",esriSLSLongDash:"long-dash",esriSLSLongDashDot:"long-dash-dot"});c=h=class extends c{constructor(...x){super(...x);this.type="simple-line";this.style="solid";this.join=
this.cap="round";this.marker=null;this.miterLimit=2}normalizeCtorArgs(x,m,p,t,w,r){if(x&&"string"!==typeof x)return x;const y={};null!=x&&(y.style=x);null!=m&&(y.color=m);null!=p&&(y.width=g.toPt(p));null!=t&&(y.cap=t);null!=w&&(y.join=w);null!=r&&(y.miterLimit=g.toPt(r));return y}clone(){return new h({color:n.clone(this.color),style:this.style,width:this.width,cap:this.cap,join:this.join,miterLimit:this.miterLimit,marker:this.marker?.clone()})}hash(){return`${super.hash()}.${this.color?.hash()}.${this.style}.${this.cap}.${this.join}.${this.miterLimit}.${this.marker?.hash()}`}};
b.__decorate([f.enumeration({esriSLS:"simple-line"},{readOnly:!0})],c.prototype,"type",void 0);b.__decorate([k.property({type:q.apiValues,json:{read:q.read,write:q.write}})],c.prototype,"style",void 0);b.__decorate([k.property({type:["butt","round","square"],json:{write:{overridePolicy:(x,m,p)=>({enabled:"round"!==x&&null==p?.origin})}}})],c.prototype,"cap",void 0);b.__decorate([k.property({type:["miter","round","bevel"],json:{write:{overridePolicy:(x,m,p)=>({enabled:"round"!==x&&null==p?.origin})}}})],
c.prototype,"join",void 0);b.__decorate([k.property({types:{key:"type",base:null,defaultKeyValue:"line-marker",typeMap:{"line-marker":e}},json:{write:!0,origins:{"web-scene":{write:!1}}}})],c.prototype,"marker",void 0);b.__decorate([k.property({type:Number,json:{read:!1,write:!1}})],c.prototype,"miterLimit",void 0);return c=h=b.__decorate([d.subclass("esri.symbols.SimpleLineSymbol")],c)})},"esri/symbols/LineSymbol":function(){define("../chunks/tslib.es6 ../core/screenUtils ../core/accessorSupport/decorators/property ../core/has ../core/Logger ../core/RandomLCG ../core/accessorSupport/decorators/enumeration ../core/accessorSupport/decorators/subclass ./Symbol".split(" "),
function(b,q,n,g,k,l,a,f,d){g=class extends d{constructor(c){super(c);this.type="simple-line";this.width=.75}hash(){return`${this.type}.${this.width}`}};b.__decorate([a.enumeration({esriSLS:"simple-line"},{readOnly:!0})],g.prototype,"type",void 0);b.__decorate([n.property({type:Number,cast:q.toPt,json:{write:!0}})],g.prototype,"width",void 0);return g=b.__decorate([f.subclass("esri.symbols.LineSymbol")],g)})},"esri/symbols/Symbol":function(){define("../chunks/tslib.es6 ../Color ../core/jsonMap ../core/JSONSupport ../core/accessorSupport/decorators/property ../core/has ../core/Logger ../core/RandomLCG ../core/accessorSupport/decorators/reader ../core/accessorSupport/decorators/subclass".split(" "),
function(b,q,n,g,k,l,a,f,d,c){n=new n.JSONMap({esriSMS:"simple-marker",esriPMS:"picture-marker",esriSLS:"simple-line",esriSFS:"simple-fill",esriPFS:"picture-fill",esriTS:"text",esriSHD:"shield-label-symbol",PointSymbol3D:"point-3d",LineSymbol3D:"line-3d",PolygonSymbol3D:"polygon-3d",WebStyleSymbol:"web-style",MeshSymbol3D:"mesh-3d",LabelSymbol3D:"label-3d",CIMSymbolReference:"cim"});let e=0;g=class extends g.JSONSupport{constructor(h){super(h);this.id=`sym${e++}`;this.type=null;this.color=new q([0,
0,0,1])}readColor(h){return null!=h?.[0]?[h[0],h[1],h[2],h[3]/255]:h}async collectRequiredFields(h,x){}hash(){return JSON.stringify(this.toJSON())}clone(){}};b.__decorate([k.property({type:n.apiValues,readOnly:!0,json:{read:!1,write:{ignoreOrigin:!0,writer:n.write}}})],g.prototype,"type",void 0);b.__decorate([k.property({type:q,json:{write:{allowNull:!0}}})],g.prototype,"color",void 0);b.__decorate([d.reader("color")],g.prototype,"readColor",null);return g=b.__decorate([c.subclass("esri.symbols.Symbol")],
g)})},"esri/symbols/LineSymbolMarker":function(){define("../chunks/tslib.es6 ../Color ../core/JSONSupport ../core/lang ../core/accessorSupport/decorators/property ../core/has ../core/Logger ../core/accessorSupport/decorators/enumeration ../core/accessorSupport/decorators/reader ../core/accessorSupport/decorators/subclass ../core/accessorSupport/decorators/writer ./support/lineMarkers".split(" "),function(b,q,n,g,k,l,a,f,d,c,e,h){var x;n=x=class extends n.JSONSupport{constructor(m){super(m);this.placement=
"begin-end";this.type="line-marker";this.style="arrow"}writeStyle(m,p,t,w){p[t]="web-map"===w?.origin?"arrow":m}set color(m){this._set("color",m)}readColor(m){return null!=m?.[0]?[m[0],m[1],m[2],m[3]/255]:m}writeColor(m,p,t,w){"web-map"!==w?.origin&&(p[t]=m)}clone(){return new x({color:g.clone(this.color),placement:this.placement,style:this.style})}hash(){return`${this.placement}.${this.color?.hash()}.${this.style}`}};b.__decorate([k.property({type:["begin","end","begin-end"],json:{write:!0}})],n.prototype,
"placement",void 0);b.__decorate([f.enumeration({"line-marker":"line-marker"},{readOnly:!0}),k.property({json:{origins:{"web-map":{write:!1}}}})],n.prototype,"type",void 0);b.__decorate([k.property({type:h.lineMarkerStyles})],n.prototype,"style",void 0);b.__decorate([e.writer("style")],n.prototype,"writeStyle",null);b.__decorate([k.property({type:q,value:null,json:{write:{allowNull:!0}}})],n.prototype,"color",null);b.__decorate([d.reader("color")],n.prototype,"readColor",null);b.__decorate([e.writer("color")],
n.prototype,"writeColor",null);return n=x=b.__decorate([c.subclass("esri.symbols.LineSymbolMarker")],n)})},"esri/symbols/support/lineMarkers":function(){define(["exports"],function(b){b.lineMarkerPlacements=["begin","end","begin-end"];b.lineMarkerStyles="arrow circle square diamond cross x".split(" ");Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/SimpleMarkerSymbol":function(){define("../chunks/tslib.es6 ../Color ../core/jsonMap ../core/lang ../core/screenUtils ../core/accessorSupport/decorators/property ../core/has ../core/Logger ../core/accessorSupport/decorators/enumeration ../core/accessorSupport/decorators/subclass ../core/accessorSupport/decorators/writer ./MarkerSymbol ./SimpleLineSymbol".split(" "),
function(b,q,n,g,k,l,a,f,d,c,e,h,x){var m;n=new n.JSONMap({esriSMSCircle:"circle",esriSMSSquare:"square",esriSMSCross:"cross",esriSMSX:"x",esriSMSDiamond:"diamond",esriSMSTriangle:"triangle",esriSMSPath:"path"});h=m=class extends h{constructor(...p){super(...p);this.color=new q([255,255,255,.25]);this.type="simple-marker";this.size=12;this.style="circle";this.outline=new x}normalizeCtorArgs(p,t,w,r){if(p&&"string"!==typeof p)return p;const y={};p&&(y.style=p);null!=t&&(y.size=k.toPt(t));w&&(y.outline=
w);r&&(y.color=r);return y}writeColor(p,t){p&&"x"!==this.style&&"cross"!==this.style&&(t.color=p.toJSON());null===p&&(t.color=null)}set path(p){this.style="path";this._set("path",p)}clone(){return new m({angle:this.angle,color:g.clone(this.color),outline:this.outline&&this.outline.clone(),path:this.path,size:this.size,style:this.style,xoffset:this.xoffset,yoffset:this.yoffset})}hash(){return`${super.hash()}.${this.color&&this.color.hash()}.${this.path}.${this.style}.${this.outline?.hash()}`}};b.__decorate([l.property()],
h.prototype,"color",void 0);b.__decorate([e.writer("color")],h.prototype,"writeColor",null);b.__decorate([d.enumeration({esriSMS:"simple-marker"},{readOnly:!0})],h.prototype,"type",void 0);b.__decorate([l.property()],h.prototype,"size",void 0);b.__decorate([l.property({type:n.apiValues,json:{read:n.read,write:n.write}})],h.prototype,"style",void 0);b.__decorate([l.property({type:String,json:{write:!0}})],h.prototype,"path",null);b.__decorate([l.property({types:{key:"type",base:null,defaultKeyValue:"simple-line",
typeMap:{"simple-line":x}},json:{default:null,write:!0}})],h.prototype,"outline",void 0);return h=m=b.__decorate([c.subclass("esri.symbols.SimpleMarkerSymbol")],h)})},"esri/symbols/MarkerSymbol":function(){define("../chunks/tslib.es6 ../core/screenUtils ../core/accessorSupport/decorators/property ../core/accessorSupport/ensureType ../core/RandomLCG ../core/has ../core/accessorSupport/decorators/subclass ./Symbol".split(" "),function(b,q,n,g,k,l,a,f){k=class extends f{constructor(d){super(d);this.angle=
0;this.type=null;this.yoffset=this.xoffset=0;this.size=9}hash(){return`${this.type}.${this.angle}.${this.size}.${this.xoffset}.${this.yoffset}`}};b.__decorate([n.property({type:Number,json:{read:d=>d&&-1*d,write:(d,c)=>c.angle=d&&-1*d}})],k.prototype,"angle",void 0);b.__decorate([n.property({type:["simple-marker","picture-marker"],readOnly:!0})],k.prototype,"type",void 0);b.__decorate([n.property({type:Number,cast:q.toPt,json:{write:!0}})],k.prototype,"xoffset",void 0);b.__decorate([n.property({type:Number,
cast:q.toPt,json:{write:!0}})],k.prototype,"yoffset",void 0);b.__decorate([n.property({cast:d=>"auto"===d?d:g.ensureNumber(q.toPt(d)),json:{write:!0}})],k.prototype,"size",void 0);return k=b.__decorate([a.subclass("esri.symbols.MarkerSymbol")],k)})},"esri/symbols/TextSymbol":function(){define("../chunks/tslib.es6 ../Color ../core/lang ../core/screenUtils ../core/accessorSupport/decorators/property ../core/accessorSupport/decorators/cast ../core/accessorSupport/decorators/enumeration ../core/accessorSupport/decorators/subclass ../core/accessorSupport/decorators/writer ./Font ./Symbol ./support/textUtils".split(" "),
function(b,q,n,g,k,l,a,f,d,c,e,h){var x;e=x=class extends e{constructor(...m){super(...m);this.borderLineSize=this.borderLineColor=this.backgroundColor=null;this.font=new c;this.horizontalAlignment="center";this.kerning=!0;this.rightToLeft=this.haloSize=this.haloColor=null;this.rotated=!1;this.text="";this.type="text";this.verticalAlignment="baseline";this.angle=this.yoffset=this.xoffset=0;this.width=null;this.lineWidth=192;this.lineHeight=1}normalizeCtorArgs(m,p,t){if(m&&"string"!==typeof m)return m;
const w={};m&&(w.text=m);p&&(w.font=p);t&&(w.color=t);return w}writeLineWidth(m,p,t,w){w&&"string"!==typeof w||(p[t]=m)}castLineWidth(m){return g.toPt(m)}writeLineHeight(m,p,t,w){w&&"string"!==typeof w||(p[t]=m)}clone(){return new x({angle:this.angle,backgroundColor:n.clone(this.backgroundColor),borderLineColor:n.clone(this.borderLineColor),borderLineSize:this.borderLineSize,color:n.clone(this.color),font:this.font&&this.font.clone(),haloColor:n.clone(this.haloColor),haloSize:this.haloSize,horizontalAlignment:this.horizontalAlignment,
kerning:this.kerning,lineHeight:this.lineHeight,lineWidth:this.lineWidth,rightToLeft:this.rightToLeft,rotated:this.rotated,text:this.text,verticalAlignment:this.verticalAlignment,width:this.width,xoffset:this.xoffset,yoffset:this.yoffset})}hash(){return`${this.backgroundColor?.hash()}.${this.borderLineColor}.${this.borderLineSize}.${this.color?.hash()}.${this.font&&this.font.hash()}.${this.haloColor?.hash()}.${this.haloSize}.${this.horizontalAlignment}.${this.kerning}.${this.rightToLeft}.${this.rotated}.${this.text}.${this.verticalAlignment}.${this.width}.${this.xoffset}.${this.yoffset}.${this.lineHeight}.${this.lineWidth}.${this.angle}`}};
b.__decorate([k.property({type:q,json:{write:!0}})],e.prototype,"backgroundColor",void 0);b.__decorate([k.property({type:q,json:{write:!0}})],e.prototype,"borderLineColor",void 0);b.__decorate([k.property({type:Number,json:{write:!0},cast:g.toPt})],e.prototype,"borderLineSize",void 0);b.__decorate([k.property({type:c,json:{write:!0}})],e.prototype,"font",void 0);b.__decorate([k.property({...h.horizontalAlignmentProperty,json:{write:!0}})],e.prototype,"horizontalAlignment",void 0);b.__decorate([k.property({type:Boolean,
json:{write:!0}})],e.prototype,"kerning",void 0);b.__decorate([k.property({type:q,json:{write:!0}})],e.prototype,"haloColor",void 0);b.__decorate([k.property({type:Number,cast:g.toPt,json:{write:!0}})],e.prototype,"haloSize",void 0);b.__decorate([k.property({type:Boolean,json:{write:!0}})],e.prototype,"rightToLeft",void 0);b.__decorate([k.property({type:Boolean,json:{write:!0}})],e.prototype,"rotated",void 0);b.__decorate([k.property({type:String,json:{write:!0}})],e.prototype,"text",void 0);b.__decorate([a.enumeration({esriTS:"text"},
{readOnly:!0})],e.prototype,"type",void 0);b.__decorate([k.property({...h.verticalAlignmentProperty,json:{write:!0}})],e.prototype,"verticalAlignment",void 0);b.__decorate([k.property({type:Number,cast:g.toPt,json:{write:!0}})],e.prototype,"xoffset",void 0);b.__decorate([k.property({type:Number,cast:g.toPt,json:{write:!0}})],e.prototype,"yoffset",void 0);b.__decorate([k.property({type:Number,json:{read:m=>m&&-1*m,write:(m,p)=>p.angle=m&&-1*m}})],e.prototype,"angle",void 0);b.__decorate([k.property({type:Number,
json:{write:!0}})],e.prototype,"width",void 0);b.__decorate([k.property({type:Number})],e.prototype,"lineWidth",void 0);b.__decorate([d.writer("lineWidth")],e.prototype,"writeLineWidth",null);b.__decorate([l.cast("lineWidth")],e.prototype,"castLineWidth",null);b.__decorate([k.property(h.lineHeightProperty)],e.prototype,"lineHeight",void 0);b.__decorate([d.writer("lineHeight")],e.prototype,"writeLineHeight",null);return e=x=b.__decorate([f.subclass("esri.symbols.TextSymbol")],e)})},"esri/symbols/support/defaultsJSON":function(){define(["exports"],
function(b){const q=[252,146,31,255],n={type:"esriSMS",style:"esriSMSCircle",size:6,color:q,outline:{type:"esriSLS",style:"esriSLSSolid",width:.75,color:[153,153,153,255]}},g={type:"esriSLS",style:"esriSLSSolid",width:.75,color:q};b.defaultColor=q;b.defaultOutlineColor=[153,153,153,255];b.defaultPointSymbolJSON=n;b.defaultPolygonSymbolJSON={type:"esriSFS",style:"esriSFSSolid",color:[252,146,31,196],outline:{type:"esriSLS",style:"esriSLSSolid",width:.75,color:[255,255,255,191]}};b.defaultPolylineSymbolJSON=
g;b.defaultTextSymbolJSON={type:"esriTS",color:[255,255,255,255],font:{family:"arial-unicode-ms",size:10,weight:"bold"},horizontalAlignment:"center",kerning:!0,haloColor:[0,0,0,255],haloSize:1,rotated:!1,text:"",xoffset:0,yoffset:0,angle:0};b.errorPointSymbolJSON={type:"esriSMS",style:"esriSMSCircle",color:[0,0,0,255],outline:null,size:10.5};b.errorPolygonSymbolJSON={type:"esriSFS",style:"esriSFSSolid",color:[0,0,0,255],outline:null};b.errorPolylineSymbolJSON={type:"esriSLS",style:"esriSLSSolid",
color:[0,0,0,255],width:1.5};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/mesh/loadGeometryEngine":function(){define(["require","exports"],function(b,q){let n=null;q.getGeometryEngine=function(){return n};q.loadGeometryEngine=async function(){n=await new Promise((g,k)=>b(["../../../../../../../geometry/geometryEngineJSON"],g,k))};Object.defineProperty(q,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/mesh/MeshWriterVertexPack":function(){define(["exports",
"../../../number","./AlignedVertexSpec","./dataViewUtils"],function(b,q,n,g){class k{static fromVertexSpec(l,a){l=n.AlignedVertexSpec.fromVertexSpec(l,a);return new k(l)}constructor(l){this._spec=l;this._packed=new Uint8Array(this._spec.stride*this._spec.packVertexCount);this._packedU32View=new Uint32Array(this._packed.buffer);this._dataView=new DataView(this._packed.buffer)}get attributeLayout(){return this._spec.attributeLayout}get stride(){return this._spec.stride}writeVertex(l,a,f,d,c,e){for(let m=
0;m<this._spec.packVertexCount;m++){const p=m*this._spec.stride;this._packPosition(f,d,p);this._packId(a,p);var h=this._spec.bitset;if(e){if(h.packTessellation){var x=h.packTessellation(e,c);this._pack(x,h,p)}for(const t of this._spec.standardAttributes)if(null!=t.packTessellation)h=t.packTessellation(e,c),this._pack(h,t,p);else if(t.packAlternating?.packTessellation)for(h=t.packAlternating.packTessellation(e,c),x=0;x<this._spec.packVertexCount;x++)this._pack(h[x],t,x*this._spec.stride)}}l.vertexWriteRegion(this._packedU32View)}pack(l,
a){for(const c of this._spec.standardAttributes)if(c.pack&&"string"!==typeof c.pack){var f=c.pack(l,a);for(var d=0;d<this._spec.packVertexCount;d++)this._pack(f,c,d*this._spec.stride)}else if(c.packAlternating?.pack)for(f=c.packAlternating.pack(l,a),d=0;d<this._spec.packVertexCount;d++)this._pack(f[d],c,d*this._spec.stride)}_packPosition(l,a,f){const {offset:d}=this._spec.position,c=this._spec.position.packPrecisionFactor??1;l=q.i1616to32(l*c,a*c);this._dataView.setUint32(f+d,l,!0)}_packId(l,a){l*=
this._spec.id.packPrecisionFactor??1;const f=this._dataView.getUint32(a+this._spec.id.offset,!0)&4278190080;this._dataView.setUint32(a+this._spec.id.offset,l|f,!0)}_pack(l,a,f){g.packDataView(this._dataView,l,a,f)}}b.MeshWriterVertexPack=k;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/number":function(){define(["exports"],function(b){function q(l,a,f){return Math.round(Math.max(Math.min(l,f),a))}function n(l){g[0]=l;return k[0]}const g=new Float32Array(1),
k=new Uint32Array(g.buffer);b.fromUint16=function(l){let a,f;a=(l>>10&31)-15;f=(l&1023)/1024;-15<a?f+=1:a=-14;return(l>>>15?-1:1)*2**a*f};b.i16=function(l){return q(l,-32768,32767)};b.i1616to32=function(l,a){return 65535&l|a<<16};b.i32=function(l){return q(l,-2147483648,2147483647)};b.i8=function(l){return q(l,-128,127)};b.i8816to32=function(l,a,f){return l&255|(a&255)<<8|f<<16};b.i8888to32=function(l,a,f,d){return l&255|(a&255)<<8|(f&255)<<16|d<<24};b.numTo32=function(l){return l|0};b.toFloat32=
function(l){k[0]=l;return g[0]};b.toUint16=function(l){var a=n(l);l=a>>>31;var f=a&8388607;a=(a>>>23&255)-127;if(15<a)return l<<15|31744;if(-25>a)return 0;-14>a&&(f=(f+8388608)/2**(-14-a),a=-15);var d=f/8192;f=Math.floor(d);d-=f;f=1023>f&&(.5<d||.5===d&&1===f%2)?f+1:f;return l<<15|a+15<<10|f};b.toUint32=n;b.u16=function(l){return q(l,0,65535)};b.u32=function(l){return q(l,0,4294967295)};b.u32to4Xu8=function(l){return[l&255,(l&65280)>>>8,(l&16711680)>>>16,(l&4278190080)>>>24]};b.u4u4to8=function(l,
a){return 15&l|(15&a)<<4};b.u8=function(l){return q(l,0,255)};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/mesh/AlignedVertexSpec":function(){define(["exports","../../../../../../../core/has","./utils","../../../../../../webgl/enums"],function(b,q,n,g){function k(f){switch(f){case g.DataType.BYTE:case g.DataType.UNSIGNED_BYTE:return 1;case g.DataType.SHORT:case g.DataType.UNSIGNED_SHORT:case g.DataType.HALF_FLOAT:return 2;case g.DataType.FLOAT:case g.DataType.INT:case g.DataType.UNSIGNED_INT:return 4}}
function l(f){const d=[],c=[],e=[];for(const h of f)switch(f=k(h.type)*h.count,f%2||f%4||4){case 4:d.push(h);continue;case 2:c.push(h);continue;case 1:e.push(h);continue;default:throw Error("Found unexpected dataType byte count");}d.push(...c);d.push(...e);return d}class a{static fromVertexSpec(f,d){const {attributes:c,optionalAttributes:e}=f;let h,x,m;f=[];for(var p in c){const r=c[p];"position"===r.pack?h={...r,name:p,offset:0}:"id"===r.pack?x={...r,name:p,offset:4}:"bitset"===p?m={...r,name:p,
offset:7}:f.push({...r,name:p})}for(var t in e)!0===d[t]&&f.push({...e[t],name:t});f=l(f);d=[];p=8;t=1;for(var w of f)d.push({...w,offset:p}),p+=k(w.type)*w.count,w.packAlternating&&(t=Math.max(w.packAlternating.count,t));w=Uint32Array.BYTES_PER_ELEMENT;f=p%w;return new a(h,x,m,d,p+(f?w-f:0),t)}constructor(f,d,c,e,h,x){this.position=f;this.id=d;this.bitset=c;this.standardAttributes=e;this.stride=h;this.packVertexCount=x;e.push(c);this._attributes=[f,d,c,...e]}get attributeLayout(){if(!this._attributeLayout){const f=
n.vertexLayoutHash(this._attributes);this._attributeLayout={attributes:this._attributes.map(d=>({name:d.name,count:d.count,offset:d.offset,type:d.type,packPrecisionFactor:d.packPrecisionFactor,normalized:d.normalized??!1})),hash:f,stride:this.stride}}return this._attributeLayout}}b.AlignedVertexSpec=a;b.sortByAlignment=l;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/mesh/utils":function(){define(["exports","../../../../../../../core/string"],
function(b,q){function n(g,k,l,a,f,d,c){if(g.primitiveName===k)k=a?.readWithDefault(f,d,g[l]&&c),"text"===g.type&&(k=k.toString()),g[l]=k;else if("type"in g&&null!=g.type){if(g.effects)for(const e of g.effects)n(e,k,l,a,f,d,c);switch(g.type){case "CIMPointSymbol":case "CIMLineSymbol":case "CIMPolygonSymbol":if(g.symbolLayers)for(const e of g.symbolLayers)n(e,k,l,a,f,d,c);break;case "CIMTextSymbol":g.symbol&&n(g.symbol,k,l,a,f,d,c);break;case "CIMHatchFill":g.lineSymbol&&n(g.lineSymbol,k,l,a,f,d,c);
break;case "CIMPictureMarker":case "CIMCharacterMarker":case "CIMVectorMarker":if(g.markerPlacement&&n(g.markerPlacement,k,l,a,f,d,c),"CIMVectorMarker"===g.type&&g.markerGraphics)for(const e of g.markerGraphics)n(e,k,l,a,f,d,c),n(e.symbol,k,l,a,f,d,c)}}}b.applyComputedValue=n;b.getLineClippingMargin=function(g){const k=g.width;return null!=g.effects?400:Math.max(1.25*k,8)};b.vertexLayoutHash=function(g){g=g.map(({name:k,count:l,type:a})=>`${k}.${l}.${a}`).join(",");return q.numericHash(g)};Object.defineProperty(b,
Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/mesh/dataViewUtils":function(){define(["exports","../../../number","../../../../../../webgl/enums"],function(b,q,n){b.packDataView=function(g,k,l,a){const f=l.packPrecisionFactor??1;switch(l.type){case n.DataType.BYTE:if(1===l.count)g.setInt8(a+l.offset,k*f);else for(var d=0;d<l.count;d++)g.setInt8(a+l.offset+d*Int8Array.BYTES_PER_ELEMENT,k[d]*f);break;case n.DataType.UNSIGNED_BYTE:if(1===l.count)g.setUint8(a+
l.offset,k*f);else for(d=0;d<l.count;d++)g.setUint8(a+l.offset+d*Uint8Array.BYTES_PER_ELEMENT,k[d]*f);break;case n.DataType.SHORT:if(1===l.count)g.setInt16(a+l.offset,k*f,!0);else for(d=0;d<l.count;d++)g.setInt16(a+l.offset+d*Int16Array.BYTES_PER_ELEMENT,k[d]*f,!0);break;case n.DataType.UNSIGNED_SHORT:if(1===l.count)g.setUint16(a+l.offset,k*f,!0);else for(d=0;d<l.count;d++)g.setUint16(a+l.offset+d*Uint16Array.BYTES_PER_ELEMENT,k[d]*f,!0);break;case n.DataType.INT:if(1===l.count)g.setInt32(a+l.offset,
k*f,!0);else for(d=0;d<l.count;d++)g.setInt32(a+l.offset+d*Int32Array.BYTES_PER_ELEMENT,k[d]*f,!0);break;case n.DataType.UNSIGNED_INT:if(1===l.count)g.setUint32(a+l.offset,k*f,!0);else for(d=0;d<l.count;d++)g.setUint32(a+l.offset+d*Uint32Array.BYTES_PER_ELEMENT,k[d]*f,!0);break;case n.DataType.FLOAT:if(1===l.count)g.setFloat32(a+l.offset,k*f,!0);else for(d=0;d<l.count;d++)g.setFloat32(a+l.offset+d*Float32Array.BYTES_PER_ELEMENT,k[d]*f,!0);break;case n.DataType.HALF_FLOAT:if(1===l.count)g.setUint16(a+
l.offset,q.toUint16(k*f),!0);else for(d=0;d<l.count;d++)g.setUint16(a+l.offset+d*Uint16Array.BYTES_PER_ELEMENT,q.toUint16(k[d]*f),!0)}};b.unpackDataView=function(g,k,l){switch(k.type){case n.DataType.BYTE:if(1===k.count)return g.getInt8(l+k.offset);var a=[];for(var f=0;f<k.count;f++)a.push(g.getInt8(l+k.offset+f*Int8Array.BYTES_PER_ELEMENT));return a;case n.DataType.UNSIGNED_BYTE:if(1===k.count)return g.getUint8(l+k.offset);a=[];for(f=0;f<k.count;f++)a.push(g.getUint8(l+k.offset+f*Uint8Array.BYTES_PER_ELEMENT));
return a;case n.DataType.SHORT:if(1===k.count)return g.getInt16(l+k.offset,!0);a=[];for(f=0;f<k.count;f++)a.push(g.getInt16(l+k.offset+f*Int16Array.BYTES_PER_ELEMENT,!0));return a;case n.DataType.UNSIGNED_SHORT:if(1===k.count)return g.getUint16(l+k.offset,!0);a=[];for(f=0;f<k.count;f++)a.push(g.getUint16(l+k.offset+f*Uint16Array.BYTES_PER_ELEMENT,!0));return a;case n.DataType.INT:if(1===k.count)return g.getInt32(l+k.offset,!0);a=[];for(f=0;f<k.count;f++)a.push(g.getInt32(l+k.offset+f*Int32Array.BYTES_PER_ELEMENT,
!0));return a;case n.DataType.UNSIGNED_INT:if(1===k.count)return g.getUint32(l+k.offset,!0);a=[];for(f=0;f<k.count;f++)a.push(g.getUint32(l+k.offset+f*Uint32Array.BYTES_PER_ELEMENT,!0));return a;case n.DataType.FLOAT:if(1===k.count)return g.getFloat32(l+k.offset,!0);a=[];for(f=0;f<k.count;f++)a.push(g.getFloat32(l+k.offset+f*Float32Array.BYTES_PER_ELEMENT,!0));return a;case n.DataType.HALF_FLOAT:if(1===k.count)return q.fromUint16(g.getUint16(l+k.offset,!0));a=[];for(f=0;f<k.count;f++)a.push(q.fromUint16(g.getUint16(l+
k.offset+f*Uint16Array.BYTES_PER_ELEMENT,!0)));return a}};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/constants":function(){define(["exports"],function(b){b.RotationType=void 0;var q=b.RotationType||(b.RotationType={});q[q.Geographic=0]="Geographic";q[q.Arithmatic=1]="Arithmatic";b.attrVvColor=1;b.attrVvOpacity=2;b.attrVvRotation=3;b.attrVvSize=0;b.bitsetFillRandomPatternOffset=2;b.bitsetGenericConsiderAlphaOnly=4;b.bitsetGenericLockColor=
1;b.bitsetLineIsSdf=3;b.bitsetLineScaleDash=2;b.bitsetMarkerAlignmentMap=0;b.bitsetMarkerOutlineAllowColorOverride=2;b.bitsetMarkerScaleSymbolsProportionally=3;b.bitsetTextIsBackground=0;b.bitsetTextIsMapAligned=3;b.bitsetTypeFillOutline=0;b.c256ToRad=3.14159265359/128;b.cDegToRad=3.14159265359/180;b.cRadToDeg=57.29577950560105;b.epsilon=1E-5;b.epsilonHitTest=.05;b.extrudeScalePlacementPadding=.25;b.fillPositionPrecision=1;b.magnifierBarrelFactor=1.1;b.maxFilterCount=2;b.maxRepresentableInt=16777216;
b.maxSdfDistance=8;b.nanMagicNumber=1E-30;b.offsetPrecision=.125;b.outlineScale=.2;b.placementPadding=8;b.positionPrecision=.125;b.sdfFontSize=24;b.softEdgeRatio=1;b.thinLineHalfWidth=1;b.thinLineWidthFactor=1.1;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/dotDensity/DotDensityMeshWriter":function(){define(["exports","../fill/AFillMeshWriter","../../../../../../webgl/enums"],function(b,q,n){const g={createComputedParams:l=>l,optionalAttributes:{},
attributes:{id:{type:n.DataType.UNSIGNED_BYTE,count:3,pack:"id"},bitset:{type:n.DataType.UNSIGNED_BYTE,count:1},pos:{type:n.DataType.SHORT,count:2,pack:"position",packPrecisionFactor:10},inverseArea:{type:n.DataType.FLOAT,count:1,packTessellation:({inverseArea:l})=>l}}};class k extends q.AFillMeshWriter{constructor(){super(...arguments);this.vertexSpec=g}createTesselationParams(l){return{inverseArea:1/l.readGeometryArea()}}}b.DotDensityMeshWriter=k;b.dotDensityVertexSpec=g;Object.defineProperty(b,
Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/fill/AFillMeshWriter":function(){define(["exports","../../../../../../../core/has","../../../../../../../geometry/libtess","../../../mesh/templates/templateUtils","../mesh/MeshWriter"],function(b,q,n,g,k){const l=q("featurelayer-fast-triangulation-enabled");class a extends k.MeshWriter{async loadDependencies(){await Promise.all([super.loadDependencies(),n.loadLibtess()])}_write(f,d,c){c=c?.asOptimized()??d.readGeometryForDisplay();
if(c=this._clip(c))f.recordStart(this.instanceId,this.attributeLayout),this._writeGeometry(f,d,c),f.recordEnd()}_clip(f){return f?g.clipMarshall(f,this.hasEffects?256:8):null}_writeGeometry(f,d,c){const e=100<c.maxLength,h=[],x=this.createTesselationParams(d);!e&&l&&g.triangulate(h,c)?h.length&&this._writeVertices(f,d,c.coords,x,h):(c=g.triangulateLibtess(c),this._writeVertices(f,d,c,x))}_writeVertices(f,d,c,e,h){const x=d.getDisplayId();d=f.vertexCount();const m=this.hasEffects;let p=0;if(h)for(var t of h){h=
c[2*t];var w=c[2*t+1];m&&f.recordBounds(h,w,0,0);this._writeVertex(f,x,h,w,e);p++}else for(t=0;t<c.length;t+=2)h=Math.round(c[t]),w=Math.round(c[t+1]),m&&f.recordBounds(h,w,0,0),this._writeVertex(f,x,h,w,e),p++;f.indexEnsureSize(p);for(c=0;c<p;c++)f.indexWrite(c+d)}}b.AFillMeshWriter=a;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/mesh/templates/templateUtils":function(){define("exports ../../../../../../chunks/earcut ../../../../../../geometry/libtess ../../../../../../geometry/support/TileClipper ../../../../../../layers/graphics/OptimizedGeometry ../../definitions ../bufcut".split(" "),
function(b,q,n,g,k,l,a){function f(h,x,m){let p=0;for(let t=1;t<m;t++)p+=(h[2*(x+t)]-h[2*(x+t-1)])*(h[2*(x+t)+1]+h[2*(x+t-1)+1]);return p}function d(h,x,m,p,t){let w=0;for(;m<p;m+=3){const r=2*(h[m]-t),y=2*(h[m+1]-t),z=2*(h[m+2]-t);w+=Math.abs((x[r]-x[z])*(x[y+1]-x[r+1])-(x[r]-x[y])*(x[z+1]-x[r+1]))}return w}const c=new g.TileClipper(0,0,0,1,0),e=new g.TileClipper(0,0,0,1,0);c.setExtent(l.tileSize);e.setExtent(l.tileSize);b.area=f;b.clipLinesMarshall=function(h,x){e.setPixelMargin(x);const m=-x;x=
l.tileSize+x;let p=[];var t=!1;if(!h.nextPath())return null;let w=!0;for(;w;){h.seekPathStart();const r=[];if(!h.pathSize)return null;e.reset(g.GeometryType.LineString);h.nextPoint();let y=h.x,z=h.y;if(t)e.moveTo(y,z);else{if(y<m||y>x||z<m||z>x){t=!0;continue}r.push({x:y,y:z})}let u=!1;for(;h.nextPoint();)if(y=h.x,z=h.y,t)e.lineTo(y,z);else{if(y<m||y>x||z<m||z>x){u=!0;break}r.push({x:y,y:z})}if(u)t=!0;else{if(t){if(t=e.resultWithStarts())for(const v of t)p.push(v)}else p.push({line:r,start:0});w=
h.nextPath();t=!1}}p=p.filter(r=>1<r.line.length);return 0===p.length?null:p};b.clipMarshall=function(h,x){if(null==h)return null;a:{var m=l.tileSize+128;var p=0;for(var t=0;t<h.lengths.length;t++){var w=h.lengths[t];for(var r=0;r<w;r++){const y=h.coords[2*(r+p)],z=h.coords[2*(r+p)+1];if(-128>y||y>m||-128>z||z>m){m=!0;break a}}p+=w}m=!1}if(!m)return h;c.setPixelMargin(x);c.reset(g.GeometryType.Polygon);x=0;for(m=0;m<h.lengths.length;m++){p=h.lengths[m];t=h.coords[2*(0+x)];w=h.coords[2*(0+x)+1];c.moveTo(t,
w);for(r=1;r<p;r++)t=h.coords[2*(r+x)],w=h.coords[2*(r+x)+1],c.lineTo(t,w);c.close();x+=p}m=c.result(!1);if(!m)return null;h=[];x=[];for(const y of m){m=0;for(const z of y)x.push(z.x),x.push(z.y),m++;h.push(m)}return new k(h,x)};b.triangleAreaArray=d;b.triangulate=function(h,x){const {coords:m,lengths:p}=x;x=0;for(var t=0;t<p.length;){let y=t,z=p[t];t=f(m,x,z);for(var w=[];++y<p.length;){var r=p[y];const u=f(m,x+z,r);if(!(0<u))break;t+=u;w.push(x+z);z+=r}r=h.length;a.bufcut(h,m,x,x+z,w,2,0);w=d(h,
m,r,h.length,0);t=Math.abs(t);if(1E-5<Math.abs((w-t)/Math.max(1E-7,t)))return h.length=0,!1;t=y;x+=z}return!0};b.triangulateEarcut=function(h,x,m){const {coords:p,lengths:t}=x;let w=0;for(var r=0;r<t.length;){let z=r,u=t[r];for(r=[];++z<t.length;){var y=t[z];if(!(0<f(p,w+u,y)))break;r.push(w+u-w);u+=y}y=x.coords.slice(2*w,2*(w+u));r=q.earcut(y,r,2);for(const v of r)h.push(v+m+w);r=z;w+=u}return!0};b.triangulateLibtess=function(h){const {coords:x,lengths:m}=h;({buffer:h}=n.triangulate(x,m));return h};
Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/mesh/bufcut":function(){define(["exports","../../../../../core/has"],function(b,q){function n(v,A,B,F,H,J,E){let K;B=0;for(let C=F,D=H-J;C<H;C+=J)B+=(v[D+A*J]-v[C+A*J])*(v[C+1+A*J]+v[D+1+A*J]),D=C;if(E===0<B)for(;F<H;F+=J)K=a(F+A*J,v[F+A*J],v[F+1+A*J],K);else for(H-=J;H>=F;H-=J)K=a(H+A*J,v[H+A*J],v[H+1+A*J],K);K&&t(K,K.next)&&(f(K),K=K.next);return K}function g(v,A=v){if(!v)return v;let B;do if(B=!1,v.steiner||
!t(v,v.next)&&0!==e(v.prev,v,v.next))v=v.next;else{f(v);v=A=v.prev;if(v===v.next)break;B=!0}while(B||v!==A);return A}function k(v,A,B,F,H,J,E,K){if(v){!K&&J&&(v=c(v,F,H,J));for(var C=v;v.prev!==v.next;){var D=v.prev,G=v.next;if(J)var N=l(v,F,H,J);else a:{N=v;var Y=N.prev,ca=N;const ka=N.next;if(0<=e(Y,ca,ka)){N=!1;break a}let Q=N.next.next;const R=Q;let Z=0;for(;Q!==N.prev&&(0===Z||Q!==R);){Z++;if(x(Y.x,Y.y,ca.x,ca.y,ka.x,ka.y,Q.x,Q.y)&&0<=e(Q.prev,Q,Q.next)){N=!1;break a}Q=Q.next}N=!0}if(N)A.push(D.index/
B+E),A.push(v.index/B+E),A.push(G.index/B+E),f(v),C=v=G.next;else if(v=G,v===C){if(!K)k(g(v),A,B,F,H,J,E,1);else if(1===K){K=A;C=B;D=E;G=v;do N=G.prev,Y=G.next.next,!t(N,Y)&&h(N,G,G.next,Y)&&m(N,Y)&&m(Y,N)&&(K.push(N.index/C+D),K.push(G.index/C+D),K.push(Y.index/C+D),f(G),f(G.next),G=v=Y),G=G.next;while(G!==v);v=G;k(v,A,B,F,H,J,E,2)}else if(2===K)a:{K=v;do{for(C=K.next.next;C!==K.prev;){if(D=K.index!==C.index){N=N=N=void 0;D=K;G=C;if(N=D.next.index!==G.index&&D.prev.index!==G.index){b:{N=D;do{if(N.index!==
D.index&&N.next.index!==D.index&&N.index!==G.index&&N.next.index!==G.index&&h(N,N.next,D,G)){N=!0;break b}N=N.next}while(N!==D);N=!1}N=!N}if(N=N&&m(D,G)&&m(G,D)){N=D;Y=!1;ca=(D.x+G.x)/2;G=(D.y+G.y)/2;do N.y>G!==N.next.y>G&&N.next.y!==N.y&&ca<(N.next.x-N.x)*(G-N.y)/(N.next.y-N.y)+N.x&&(Y=!Y),N=N.next;while(N!==D);N=Y}D=N}if(D){v=r(K,C);K=g(K,K.next);v=g(v,v.next);k(K,A,B,F,H,J,E,0);k(v,A,B,F,H,J,E,0);break a}C=C.next}K=K.next}while(K!==v)}break}}}}function l(v,A,B,F){const H=v.prev,J=v.next;if(0<=
e(H,v,J))return!1;const E=H.x>v.x?H.x>J.x?H.x:J.x:v.x>J.x?v.x:J.x,K=H.y>v.y?H.y>J.y?H.y:J.y:v.y>J.y?v.y:J.y,C=p(H.x<v.x?H.x<J.x?H.x:J.x:v.x<J.x?v.x:J.x,H.y<v.y?H.y<J.y?H.y:J.y:v.y<J.y?v.y:J.y,A,B,F);A=p(E,K,A,B,F);B=v.prevZ;for(F=v.nextZ;B&&B.z>=C&&F&&F.z<=A;){if(B!==v.prev&&B!==v.next&&x(H.x,H.y,v.x,v.y,J.x,J.y,B.x,B.y)&&0<=e(B.prev,B,B.next))return!1;B=B.prevZ;if(F!==v.prev&&F!==v.next&&x(H.x,H.y,v.x,v.y,J.x,J.y,F.x,F.y)&&0<=e(F.prev,F,F.next))return!1;F=F.nextZ}for(;B&&B.z>=C;){if(B!==v.prev&&
B!==v.next&&x(H.x,H.y,v.x,v.y,J.x,J.y,B.x,B.y)&&0<=e(B.prev,B,B.next))return!1;B=B.prevZ}for(;F&&F.z<=A;){if(F!==v.prev&&F!==v.next&&x(H.x,H.y,v.x,v.y,J.x,J.y,F.x,F.y)&&0<=e(F.prev,F,F.next))return!1;F=F.nextZ}return!0}function a(v,A,B,F){v=y.create(v,A,B);F?(v.next=F.next,v.prev=F,F.next.prev=v,F.next=v):(v.prev=v,v.next=v);return v}function f(v){v.next.prev=v.prev;v.prev.next=v.next;v.prevZ&&(v.prevZ.nextZ=v.nextZ);v.nextZ&&(v.nextZ.prevZ=v.prevZ)}function d(v,A){let B=A;const F=v.x,H=v.y;let J=
-Infinity,E;do{if(H<=B.y&&H>=B.next.y&&B.next.y!==B.y){var K=B.x+(H-B.y)*(B.next.x-B.x)/(B.next.y-B.y);if(K<=F&&K>J){J=K;if(K===F){if(H===B.y)return B;if(H===B.next.y)return B.next}E=B.x<B.next.x?B:B.next}}B=B.next}while(B!==A);if(!E)return null;if(F===J)return E.prev;A=E;K=E.x;const C=E.y;let D=Infinity,G;for(B=E.next;B!==A;)F>=B.x&&B.x>=K&&F!==B.x&&x(H<C?F:J,H,K,C,H<C?J:F,H,B.x,B.y)&&(G=Math.abs(H-B.y)/(F-B.x),(G<D||G===D&&B.x>E.x)&&m(B,v)&&(E=B,D=G)),B=B.next;return E}function c(v,A,B,F){for(var H;H!==
v;H=H.next){H=H||v;null===H.z&&(H.z=p(H.x,H.y,A,B,F));if(H.prev.next!==H||H.next.prev!==H)return H.prev.next=H,H.next.prev=H,c(v,A,B,F);H.prevZ=H.prev;H.nextZ=H.next}v.prevZ.nextZ=null;v.prevZ=null;a:for(B=1;;){F=v;A=v=null;let J=0;for(;F;){J++;H=F;let E=0;for(;E<B&&H;E++)H=H.nextZ;let K=B;for(;0<E||0<K&&H;){let C;0===E?(C=H,H=H.nextZ,K--):0!==K&&H?F.z<=H.z?(C=F,F=F.nextZ,E--):(C=H,H=H.nextZ,K--):(C=F,F=F.nextZ,E--);A?A.nextZ=C:v=C;C.prevZ=A;A=C}F=H}A.nextZ=null;B*=2;if(2>J)break a}return v}function e(v,
A,B){return(A.y-v.y)*(B.x-A.x)-(A.x-v.x)*(B.y-A.y)}function h(v,A,B,F){return t(v,A)&&t(B,F)||t(v,F)&&t(B,A)?!0:0<e(v,A,B)!==0<e(v,A,F)&&0<e(B,F,v)!==0<e(B,F,A)}function x(v,A,B,F,H,J,E,K){return 0<=(H-E)*(A-K)-(v-E)*(J-K)&&0<=(v-E)*(F-K)-(B-E)*(A-K)&&0<=(B-E)*(J-K)-(H-E)*(F-K)}function m(v,A){return 0>e(v.prev,v,v.next)?0<=e(v,A,v.next)&&0<=e(v,v.prev,A):0>e(v,A,v.prev)||0>e(v,v.next,A)}function p(v,A,B,F,H){v=32767*(v-B)*H;A=32767*(A-F)*H;v=(v|v<<8)&16711935;v=(v|v<<4)&252645135;v=(v|v<<2)&858993459;
A=(A|A<<8)&16711935;A=(A|A<<4)&252645135;A=(A|A<<2)&858993459;return(v|v<<1)&1431655765|((A|A<<1)&1431655765)<<1}function t(v,A){return v.x===A.x&&v.y===A.y}function w(v,A){return v.x-A.x}function r(v,A){const B=y.create(v.index,v.x,v.y),F=y.create(A.index,A.x,A.y),H=v.next,J=A.prev;v.next=A;A.prev=v;B.next=H;H.prev=B;F.next=B;B.prev=F;J.next=F;F.prev=J;return F}class y{constructor(){this.y=this.x=this.index=0;this.nextZ=this.prevZ=this.z=this.next=this.prev=null;this.steiner=!1}static create(v,A,
B){const F=u<z.length?z[u++]:new y;F.index=v;F.x=A;F.y=B;F.prev=null;F.next=null;F.z=null;F.prevZ=null;F.nextZ=null;F.steiner=!1;return F}}const z=[];let u=0;for(q=0;8096>q;q++)z.push(new y);b.bufcut=function(v,A,B,F,H,J,E){u=0;var K=(F-B)*J,C=H&&H.length;const D=C?(H[0]-B)*J:K;var G=n(A,B,F,0,D,J,!0);if(G&&G.next!==G.prev){var N;if(C){const R=[];for(let Z=0,da=H.length;Z<da;Z++){const ja=n(A,B,F,H[Z]*J,Z<da-1?H[Z+1]*J:F*J,J,!1);ja===ja.next&&(ja.steiner=!0);C=R;var Y=C.push;let W=ja,aa=ja;do{if(W.x<
aa.x||W.x===aa.x&&W.y<aa.y)aa=W;W=W.next}while(W!==ja);Y.call(C,aa)}R.sort(w);for(var ca of R)if(F=ca,H=d(F,G))F=r(H,F),g(F,F.next),G=g(H,H.next)}if(K>80*J){var ka=K=A[B*J];var Q=N=A[1+B*J];for(ca=J;ca<D;ca+=J)F=A[ca+B*J],H=A[ca+1+B*J],ka=Math.min(ka,F),Q=Math.min(Q,H),K=Math.max(K,F),N=Math.max(N,H);N=Math.max(K-ka,N-Q);N=0!==N?1/N:0}k(G,v,J,ka,Q,N,E,0)}};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/fill/ComplexFillMeshWriter":function(){define("exports ../../../../../../../core/screenUtils ../../../../vectorTiles/GeometryUtils ./meshWriterUtils ./PatternFillMeshWriter ../shaders/constants ../../../../../../webgl/enums".split(" "),
function(b,q,n,g,k,l,a){function f(h){const {sprite:x,aspectRatio:m,scaleProportionally:p}=h;var t=q.pt2px(h.height);h=0<t?t:x.height;t*=m;0>=t?t=x.width:p&&(t*=x.width/x.height);return{width:t,height:h}}function d(h){const {applyRandomOffset:x,sampleAlphaOnly:m}=h;return g.packBitset([[l.bitsetFillRandomPatternOffset,x],[l.bitsetGenericConsiderAlphaOnly,m]])}const c={createComputedParams:h=>h,optionalAttributes:k.patternFillVertexSpec.optionalAttributes,attributes:{...k.patternFillVertexSpec.attributes,
bitset:{count:1,type:a.DataType.UNSIGNED_BYTE,pack:d},width:{count:1,type:a.DataType.HALF_FLOAT,pack:h=>f(h).width},height:{count:1,type:a.DataType.HALF_FLOAT,pack:h=>f(h).height},offset:{count:2,type:a.DataType.HALF_FLOAT,pack:({offsetX:h,offsetY:x})=>[q.pt2px(h),-q.pt2px(x)]},scale:{count:2,type:a.DataType.UNSIGNED_BYTE,packPrecisionFactor:16,pack:({scaleX:h,scaleY:x})=>[h,x]},angle:{count:1,type:a.DataType.UNSIGNED_BYTE,pack:({angle:h})=>n.degToByte(h)}}};class e extends k.PatternFillMeshWriter{constructor(){super(...arguments);
this.vertexSpec=c}}b.ComplexFillMeshWriter=e;b.complexFillVertexSpec=c;b.getPatternSize=f;b.packComplexFillBitset=d;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/fill/PatternFillMeshWriter":function(){define(["exports","../../../definitions","./FillMeshWriter","../../../../../../webgl/enums"],function(b,q,n,g){const k={createComputedParams:a=>a,optionalAttributes:n.fillVertexSpec.optionalAttributes,attributes:{...n.fillVertexSpec.attributes,
tlbr:{count:4,type:g.DataType.UNSIGNED_SHORT,pack:({sprite:a})=>{const {rect:f,width:d,height:c}=a;a=f.x+q.spritePadding;const e=f.y+q.spritePadding;return[a,e,a+d,e+c]}},inverseRasterizationScale:{count:1,type:g.DataType.BYTE,packPrecisionFactor:16,pack:({sprite:a})=>1/a.rasterizationScale}}};class l extends n.FillMeshWriter{constructor(){super(...arguments);this.vertexSpec=k}_write(a,f,d){d=d?.asOptimized()??f.readGeometryForDisplay();if(d=this._clip(d))a.recordStart(this.instanceId,this.attributeLayout,
this.evaluatedMeshParams.sprite?.textureBinding),this._writeGeometry(a,f,d),a.recordEnd()}}b.PatternFillMeshWriter=l;b.patternFillVertexSpec=k;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/fill/FillMeshWriter":function(){define(["exports","../../../definitions","./AFillMeshWriter","./meshWriterUtils","../../../../../../webgl/enums"],function(b,q,n,g,k){const l={createComputedParams:f=>f,optionalAttributes:{zoomRange:{type:k.DataType.SHORT,
count:2,packPrecisionFactor:q.minMaxZoomPrecisionFactor,pack:({scaleInfo:f},{tileInfo:d})=>g.getMinMaxZoom(f,d)}},attributes:{id:{type:k.DataType.UNSIGNED_BYTE,count:3,pack:"id"},bitset:{type:k.DataType.UNSIGNED_BYTE,count:1},pos:{type:k.DataType.SHORT,count:2,pack:"position",packPrecisionFactor:10},color:{type:k.DataType.UNSIGNED_BYTE,count:4,normalized:!0,pack:({color:f})=>g.processColorInput(f)}}};class a extends n.AFillMeshWriter{constructor(){super(...arguments);this.vertexSpec=l}createTesselationParams(f){return null}}
b.FillMeshWriter=a;b.fillVertexSpec=l;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/fill/ComplexOutlineFillMeshWriter":function(){define("exports ../../../../../../../core/screenUtils ../../../../../../../geometry/GeometryCursor ./ComplexFillMeshWriter ./meshWriterUtils ./OutlineFillMeshWriter ../shaders/ComplexOutlineFillShader ../shaders/constants ../../../../../../webgl/enums".split(" "),function(b,q,n,g,k,l,a,f,d){const c=g.complexFillVertexSpec,
e={createComputedParams:p=>p,optionalAttributes:c.optionalAttributes,attributes:{...c.attributes,bitset:{type:d.DataType.UNSIGNED_BYTE,count:1,pack:p=>g.packComplexFillBitset(p)},aux1:{count:1,type:d.DataType.HALF_FLOAT,pack:p=>g.getPatternSize(p).width},aux2:{count:1,type:d.DataType.HALF_FLOAT,pack:p=>g.getPatternSize(p).height},aux3:{count:2,type:d.DataType.HALF_FLOAT,pack:({offsetX:p,offsetY:t})=>[q.pt2px(p),q.pt2px(t)]},aux4:{count:2,type:d.DataType.UNSIGNED_BYTE,pack:({scaleX:p,scaleY:t})=>[p*
a.packPrecision,t*a.packPrecision]}}},h={createComputedParams:p=>p,optionalAttributes:c.optionalAttributes,attributes:{...c.attributes,color:l.outlineFillVertexSpec_Outline.attributes.color,bitset:{type:d.DataType.UNSIGNED_BYTE,count:1,pack:p=>k.packBitset([[f.bitsetTypeFillOutline,!0]])},aux1:{count:1,type:d.DataType.HALF_FLOAT,pack:p=>q.pt2px(.5*p.width)},aux2:{count:1,type:d.DataType.HALF_FLOAT,pack:p=>q.pt2px(.5*p.referenceWidth)},aux3:{count:2,type:d.DataType.HALF_FLOAT,packTessellation:({extrusionOffsetX:p,
extrusionOffsetY:t})=>[p,t]},aux4:{count:2,type:d.DataType.UNSIGNED_BYTE,packTessellation:({normalX:p,normalY:t})=>[p*a.packPrecision+a.signedToUnsignedByte,t*a.packPrecision+a.signedToUnsignedByte]}}};class x extends l.OutlineFillOutlineMeshWriter{constructor(){super(...arguments);this.vertexSpec=h}}class m extends l.OutlineFillMeshWriter{constructor(){super(...arguments);this.vertexSpec=e}_createOutlineWriter(p,t,w,r){return new x(p,t,w,r)}_write(p,t,w){w=w?.asOptimized()??t.readGeometryForDisplay();
if(w=this._clip(w))p.recordStart(this.instanceId,this.attributeLayout,this.evaluatedMeshParams.sprite?.textureBinding),this._writeGeometry(p,t,w),this._lineMeshWriter.writeLineVertices(p,n.GeometryCursor.fromOptimizedCIM(w,"esriGeometryPolyline"),t),p.recordEnd()}ensurePacked(p,t,w){super.ensurePacked(p,t,w);this._lineMeshWriter.ensurePacked(p,t,w)}enqueueRequest(p,t,w){super.enqueueRequest(p,t,w);this._lineMeshWriter.enqueueRequest(p,t,w)}async loadDependencies(){await Promise.all([super.loadDependencies(),
this._lineMeshWriter.loadDependencies()])}}b.ComplexOutlineFillMeshWriter=m;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/fill/OutlineFillMeshWriter":function(){define("exports ../../../../../../../geometry/GeometryCursor ../../../mesh/templates/templateUtils ./FillMeshWriter ./meshWriterUtils ../line/LineMeshWriter ../mesh/utils ../shaders/constants ../../../../../../webgl/enums".split(" "),function(b,q,n,g,k,l,a,f,d){const c={createComputedParams:m=>
m,optionalAttributes:l.LineVertexSpec.optionalAttributes,attributes:{...l.LineVertexSpec.attributes,bitset:{type:d.DataType.UNSIGNED_BYTE,count:1,pack:m=>0},color:{type:d.DataType.UNSIGNED_BYTE,count:4,normalized:!0,pack:({color:m})=>k.processColorInput(m)}}},e={createComputedParams:m=>m,optionalAttributes:l.LineVertexSpec.optionalAttributes,attributes:{...l.LineVertexSpec.attributes,bitset:{type:d.DataType.UNSIGNED_BYTE,count:1,pack:m=>k.packBitset([[f.bitsetTypeFillOutline,!0]])},color:{type:d.DataType.UNSIGNED_BYTE,
count:4,normalized:!0,pack:({outlineColor:m})=>k.processColorInput(m)}}};class h extends l.LineMeshWriter{constructor(){super(...arguments);this.vertexSpec=e}}class x extends g.FillMeshWriter{constructor(m,p,t,w){super(m,p,t,w);this.vertexSpec=c;this._lineMeshWriter=this._createOutlineWriter(m,p,t,w)}_createOutlineWriter(m,p,t,w){return new h(m,p,t,w)}_write(m,p,t){t=t?.asOptimized()??p.readGeometryForDisplay();if(t=this._clip(t))m.recordStart(this.instanceId,this.attributeLayout),this._writeGeometry(m,
p,t),this._lineMeshWriter.writeLineVertices(m,q.GeometryCursor.fromOptimizedCIM(t,"esriGeometryPolyline"),p),m.recordEnd()}_clip(m){return m?n.clipMarshall(m,a.getLineClippingMargin(this.evaluatedMeshParams)):null}ensurePacked(m,p,t){super.ensurePacked(m,p,t);this._lineMeshWriter.ensurePacked(m,p,t)}enqueueRequest(m,p,t){super.enqueueRequest(m,p,t);this._lineMeshWriter.enqueueRequest(m,p,t)}async loadDependencies(){await Promise.all([super.loadDependencies(),this._lineMeshWriter.loadDependencies()])}}
b.OutlineFillMeshWriter=x;b.OutlineFillOutlineMeshWriter=h;b.outlineFillVertexSpec_Fill=c;b.outlineFillVertexSpec_Outline=e;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/line/LineMeshWriter":function(){define("exports ../../../../../../../core/screenUtils ../../../../../../../geometry/GeometryCursor ../../../definitions ../../../TurboLine ../../../mesh/templates/templateUtils ../fill/meshWriterUtils ../mesh/MeshWriter ../mesh/utils ../../../../../../webgl/enums".split(" "),
function(b,q,n,g,k,l,a,f,d,c){class e{constructor(){this.distance=this.directionY=this.directionX=this.normalY=this.normalX=this.extrusionOffsetY=this.extrusionOffsetX=0}}const h={createComputedParams:p=>p,optionalAttributes:{zoomRange:{type:c.DataType.SHORT,count:2,packPrecisionFactor:g.minMaxZoomPrecisionFactor,pack:({scaleInfo:p},{tileInfo:t})=>a.getMinMaxZoom(p,t)}},attributes:{id:{type:c.DataType.UNSIGNED_BYTE,count:3,pack:"id"},pos:{type:c.DataType.SHORT,count:2,pack:"position",packPrecisionFactor:10},
bitset:{type:c.DataType.UNSIGNED_BYTE,count:1},color:{type:c.DataType.UNSIGNED_BYTE,count:4,normalized:!0,pack:({color:p})=>a.processColorInput(p)},offset:{type:c.DataType.BYTE,count:2,packPrecisionFactor:16,packTessellation:({extrusionOffsetX:p,extrusionOffsetY:t})=>[a.packRounded(p,16),a.packRounded(t,16)]},normal:{type:c.DataType.BYTE,count:2,packPrecisionFactor:16,packTessellation:({normalX:p,normalY:t})=>[a.packRounded(p,16),a.packRounded(t,16)]},halfWidth:{type:c.DataType.HALF_FLOAT,count:1,
pack:({width:p})=>q.pt2px(.5*p)},referenceHalfWidth:{type:c.DataType.HALF_FLOAT,count:1,pack:({referenceWidth:p})=>q.pt2px(.5*p)}}};class x{constructor(){this.vertexBounds=this.vertexFrom=this.vertexCount=this.indexCount=this.bitset=this.id=0}}class m extends f.MeshWriter{constructor(p,t,w,r){super(p,t,w,r);this.vertexSpec=h;this._currentWrite=new x;this._tessellationOptions={halfWidth:0,pixelCoordRatio:1,offset:0,wrapDistance:65535,textured:!1};this._tessParams=new e;this._initializeTessellator()}writeLineVertices(p,
t,w){t=this._getLines(t);null!=t&&this._writeVertices(p,w,t)}_initializeTessellator(){this._lineTessellator=new k.LineTessellation(this._writeTesselatedVertex.bind(this),this._writeTriangle.bind(this),!0)}_write(p,t,w){(w=w??n.GeometryCursor.fromFeatureSetReaderCIM(t))&&this._writeGeometry(p,t,w)}_writeGeometry(p,t,w,r){p.recordStart(this.instanceId,this.attributeLayout,r);this.writeLineVertices(p,w,t);p.recordEnd()}_getLines(p){return l.clipLinesMarshall(p,d.getLineClippingMargin(this.evaluatedMeshParams))}_writeVertices(p,
t,w){const {_currentWrite:r,_tessellationOptions:y,evaluatedMeshParams:z}=this,{width:u,capType:v,joinType:A,miterLimit:B,hasSizeVV:F}=z,H=q.pt2px(.5*u);y.halfWidth=H;y.capType=a.processLineCapInput(v);y.joinType=a.processLineJoinInput(A);y.miterLimit=B;const J=!F;r.out=p;r.id=t.getDisplayId();r.vertexCount=0;r.indexCount=0;r.vertexFrom=p.vertexCount();r.vertexBounds=J&&H<g.thinLineHalfWidthThreshold?0:1;for(const {line:E,start:K}of w)y.initialDistance=K%65535,this._lineTessellator.tessellate(E,y,
J)}_writeTesselatedVertex(p,t,w,r,y,z,u,v,A,B,F){const {out:H,id:J,vertexBounds:E}=this._currentWrite;this.hasEffects&&H.recordBounds(p,t,E,E);this._tessParams.extrusionOffsetX=u;this._tessParams.extrusionOffsetY=v;this._tessParams.normalX=A;this._tessParams.normalY=B;this._tessParams.directionX=y;this._tessParams.directionY=z;this._tessParams.distance=F;this._writeVertex(H,J,p,t,this._tessParams);return this._currentWrite.vertexFrom+this._currentWrite.vertexCount++}_writeTriangle(p,t,w){const {out:r}=
this._currentWrite;r.indexEnsureSize(3);r.indexWrite(p);r.indexWrite(t);r.indexWrite(w);this._currentWrite.indexCount+=3}}b.LineMeshWriter=m;b.LineTessellationParams=e;b.LineVertexSpec=h;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/ComplexOutlineFillShader":function(){define("exports ../../../../../../../chunks/tslib.es6 ../../GraphShaderModule ../../graph/glsl ./AFeatureShader ./ComplexFillShader ./hittestUtils ./LineShader ./LocalTileOffset ./MosaicInfo ./OutlineFillShader ./PatternOutlineFillShader".split(" "),
function(b,q,n,g,k,l,a,f,d,c,e,h){class x extends k.FeatureVertexInput{}q.__decorate([n.location(3,g.Vec4)],x.prototype,"color",void 0);q.__decorate([n.location(4,g.Vec4)],x.prototype,"tlbr",void 0);q.__decorate([n.location(5,g.Float)],x.prototype,"angle",void 0);q.__decorate([n.location(6,g.Float)],x.prototype,"aux1",void 0);q.__decorate([n.location(7,g.Float)],x.prototype,"aux2",void 0);q.__decorate([n.location(8,g.Vec2)],x.prototype,"aux3",void 0);q.__decorate([n.location(9,g.Vec2)],x.prototype,
"aux4",void 0);q.__decorate([n.location(10,g.Vec2)],x.prototype,"zoomRange",void 0);class m extends h.PatternOutlineFillFragmentInput{}class p extends e.AOutlineFillShader{vertex(t,w){const {aux1:r,aux2:y,aux3:z,aux4:u}=t;var v={...t,width:r,height:y,offset:z,scale:u.multiply(.0625)},A={...t,halfWidth:r,referenceHalfWidth:y,offset:z,normal:u.subtract(128).multiply(.0625)};A=e.getOutlineFillVertexData(this,A);v=l.getComplexFillVertexData(this,v);const B=g.greaterThan(A.isOutline,new g.Float(.5));return{...A,
...v,...this.maybeRunHittest(t,w,B)}}fragment(t){var {isOutline:w}=t;w=g.greaterThan(w,new g.Float(.5));var r=f.getLineFragmentColor(t,this.antialiasingControls.blur);const y=l.getComplexFillFragmentColor(this,t);r=g.ifElse(w,r,y);w=g.ifElse(w,new g.Float(1/255),new g.Float(0));return this.getFragmentOutput(r,t,w)}hittest(t,w,r){return g.ifElse(r,a.failHittest(this.hittestRequest),a.hittestFill(this,t,w))}}q.__decorate([n.uniform(c.MosaicInfo)],p.prototype,"mosaicInfo",void 0);q.__decorate([n.uniform(d.LocalTileOffset)],
p.prototype,"localTileOffset",void 0);q.__decorate([q.__param(0,n.input(x)),q.__param(1,n.input(k.BaseHittestVertexInput))],p.prototype,"vertex",null);q.__decorate([q.__param(0,n.input(m))],p.prototype,"fragment",null);b.ComplexOutlineFillShader=p;b.ComplexOutlineFillVertexInput=x;b.packPrecision=16;b.signedToUnsignedByte=128;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/GraphShaderModule":function(){define("exports ../../../../../chunks/tslib.es6 ../../../../../core/has ../../../../../core/Logger ../../../../../core/string ./ShaderBuilder2D ./graph/glsl ./graph/GlslGraphWriter ./graph/ShaderGraphContext ./graph/ShaderGraphNode ./typed/TypedShaderProgram".split(" "),
function(b,q,n,g,k,l,a,f,d,c,e){function h(y,z,u){const v=y.constructor[z]??[];y.constructor.hasOwnProperty(z)||Object.defineProperty(y.constructor,z,{value:v.slice()});y.constructor[z].push(u)}n=(y,z)=>(u,v)=>{u.constructor.builtins.push({builtin:y,propertyKey:v,typeCtor:z})};class x{}x.builtins=[];q.__decorate([n("gl_VertexID",a.Int)],x.prototype,"glVertexID",void 0);class m{}class p{}p.builtins=[];q.__decorate([n("gl_FragCoord",a.Vec4)],p.prototype,"glFragCoord",void 0);q.__decorate([n("gl_PointCoord",
a.Vec2)],p.prototype,"glPointCoord",void 0);class t{}class w{constructor(){this.type="uniform-group"}get _uniforms(){return this.constructor.uniforms??[]}}class r{constructor(){this.logShader=!1;this.computeAttributes={}}get vertexInput(){const y=this._shaderModuleClass.inputs.findLast(z=>"vertex"===z.propertyKey&&0===z.parameterIndex);if(!y)throw Error("Unable to find vertex input parameter");return y}get computeInput(){return this._shaderModuleClass.inputs.findLast(y=>"vertex"===y.propertyKey&&
1===y.parameterIndex)}get fragmentInput(){const y=this._shaderModuleClass.inputs.findLast(z=>"fragment"===z.propertyKey);if(!y)throw Error("Unable to find fragment input parameter");return y}get transformFeedbackBindings(){return this.fragmentInput.inputCtor.transformFeedbackBindings??[]}get locations(){return[...this.vertexInput.inputCtor.locations,...(this.computeInput?.inputCtor.locations??[])]}get locationsMap(){const y=new Map,z=new Set;for(const u of this.locations)z.has(u.index)?g.getLogger("esri.views.2d.engine.webgl.shaderGraph.GraphShaderModule").warnOnce("mapview-rendering",
`Unable to assigned attribute ${u.propertyKey} to ${u.index}. Index already in use`,{locationsMap:y}):(y.set(u.propertyKey,u.index),z.add(u.index));return y}get locationInfo(){if(!this._locationInfo){const y=this.locationsMap,z=Array.from(y.entries()).map(([u,v])=>`${u}.${v}`).join(".");this._locationInfo={hash:k.numericHash(z),locations:y,computeAttributeMap:this.computeAttributes}}return this._locationInfo}get renamedLocationsMap(){const y=new Map;for(const z of this.locations)y.set("a_"+z.propertyKey,
z.index);return y}get optionPropertyKeys(){if(!this._optionPropertyKeys){const y=new Set;for(const z of this._options)y.add(z.propertyKey);this._optionPropertyKeys=y}return this._optionPropertyKeys}get _shaderModuleClass(){return this.constructor}get _defines(){return this._shaderModuleClass.defines??[]}get _options(){return this._shaderModuleClass.options??[]}get _uniforms(){return this._shaderModuleClass.uniforms??[]}getProgram(y,z,u,v){try{const {vertex:A,fragment:B,uniformBindings:F}=this._generateShaders(y,
z,u,v);return new e.TypedShaderProgram(A,B,this.renamedLocationsMap,this.locationInfo,F,this.transformFeedbackBindings)}catch(A){return new e.TypedShaderProgram("","",this.renamedLocationsMap,this.locationInfo,[],this.transformFeedbackBindings)}}getDebugUniformClassInfo(y){var z=this._options.find(u=>u.propertyKey===y);if(z)return{type:"option",className:z.typeCtor};z=this._uniforms.find(u=>u.propertyKey===y);if(!z)throw Error(`Unable to find uniform class type for property: ${y}`);return{type:"required",
className:z.typeCtor}}getShaderKey(y,z,u,v){const A=Object.keys(y).map(J=>`${J}.${y[J]}`).join("."),B=Object.keys(u).map(J=>`${J}.${u[J]}`).join("."),F=Object.keys(v).map(J=>`${J}.${v[J]}`).join("."),H=Object.keys(z).filter(J=>this.optionPropertyKeys.has(J)&&z[J]).join(".");return`${this.constructor.name}.${A}.${B}.${F}.${H}`}_generateShaders(y,z,u,v){const A=[];this._setDefines(u);this._setOptionalUniforms(A,z);this._setRequiredUniforms(A);z=this._hydrateVertexInput(v);v=this._injectPackPrecisionFactor(z,
y);y=(u=this._hydrateComputeInput())&&this._injectComputePackPrecisionFactor(u,y);const B=this.vertex(v,y);y=this._hydrateFragmentInput(B);v=this.fragment(y);const F=new Set;for(var H in v)c.setReachableUids(F,v[H]);H=this._getVertexInputBuiltins();H=d.ShaderGraphContext.createVertex({...z,...u},B,H,A,this.transformFeedbackBindings,F);(new f.GlslShaderWriter).write(H);z=this._getFragmentInputBuiltins(v);z.set("glPointCoord","gl_PointCoord");z=d.ShaderGraphContext.createFragment(y,v,z,A,H,this.transformFeedbackBindings);
(new f.GlslShaderWriter).write(z);z=this._createShaderBuilder(H,z);H=z.generate("vertex",!0);z=z.generate("fragment",!0);this.logShader&&(console.log(H),console.log(z));return{vertex:H,fragment:z,uniformBindings:A}}_setDefines(y){for(const z in y)this[z]=y[z]}_setOptionalUniforms(y,z){for(const u of this._options)this[u.propertyKey]=z[u.propertyKey]?this._hydrateUniformGroup(y,u):null}_setRequiredUniforms(y){for(const z of this._uniforms)this[z.propertyKey]=this._hydrateUniformGroup(y,z)}_hydrateUniformGroup(y,
z){const u=new z.typeCtor;for(const v of u._uniforms??[]){const A=new v.typeCtor,B=`u_${z.propertyKey}_${v.propertyKey}`,F=A.type,H=[z.propertyKey,v.propertyKey].join(".");if("type"in v.typeCtor&&"array"===v.typeCtor.type){const J=A;y.push({shaderModulePath:H,uniformName:B,uniformType:F,uniformArrayLength:J.size,uniformArrayElementType:J.elementType.type,uniformHydrated:A})}else y.push({shaderModulePath:H,uniformName:B,uniformType:F,uniformHydrated:A});u[v.propertyKey]=A}return u}_hydrateVertexInput(y){var z=
this.vertexInput.inputCtor;const u=z.locations.reduce((v,A)=>!1===y[A.propertyKey]?v:{...v,[A.propertyKey]:new A.typeCtor},{});for(const {propertyKey:v,typeCtor:A}of z.builtins)z=new A,u[v]=z;return u}_hydrateComputeInput(){return null==this.computeInput?null:this.computeInput.inputCtor.locations.reduce((y,z)=>({...y,[z.propertyKey]:new z.typeCtor}),{})}_injectPackPrecisionFactor(y,z){const u={};for(const v in y){const A=y[v],B=z[v];if(B){if("float"!==A.type&&"vec2"!==A.type&&"vec3"!==A.type&&"vec4"!==
A.type)throw Error(`InternalError: packPrecisionFactor requires GenType, but found ${A.type}`);u[v]=A.divide(new a.Float(B))}else u[v]=A}return u}_injectComputePackPrecisionFactor(y,z){const u={},v=new Map;for(var A in this.computeAttributes)for(var B of this.computeAttributes[A]??[])v.set(B,A);for(const F in y)if(A=y[F],B=v.get(F))if(B=z[B]){if("float"!==A.type&&"vec2"!==A.type&&"vec3"!==A.type&&"vec4"!==A.type)throw Error(`InternalError: packPrecisionFactor requires GenType, but found ${A.type}`);
u[F]=A.divide(new a.Float(B))}else u[F]=A;return u}_hydrateFragmentInput(y){const z={};for(const u in y)z[u]=y[u];for(const {propertyKey:u,typeCtor:v}of p.builtins)y=new v,z[u]=y;return z}_getVertexInputBuiltins(){const y=this.vertexInput.inputCtor,z=new Map;for(const {builtin:u,propertyKey:v}of y.builtins)z.set(v,u);return z}_getFragmentInputBuiltins(y){y=y.constructor;const z=new Map;for(const u of y.builtins??[])z.set(u.propertyKey,u.builtin);return z}_createShaderBuilder(y,z){const u=new l.ShaderBuilder2D;
this._insertDebugInfo(u);y.insertVertexShader(u);z.insertFragmentShader(u);return u}_insertDebugInfo(y){y.vertex.code.add("// DEFINES: ");y.vertex.code.add("// --------------------------------------------------------- ");for(const z of this._defines)this[z.propertyKey]?y.vertex.code.add(`//   ${z.propertyKey}: true`):y.vertex.code.add(`//   ${z.propertyKey}: false`);y.vertex.code.add("");y.vertex.code.add("// OPTIONS: ");y.vertex.code.add("// --------------------------------------------------------- ");
for(const z of this._options)this[z.propertyKey]?y.vertex.code.add(`//   ${z.propertyKey}: true`):y.vertex.code.add(`//   ${z.propertyKey}: false`)}}b.ComputeVertexInput=m;b.FragmentInput=p;b.FragmentOutput=t;b.GraphShaderModule=r;b.UniformGroup=w;b.VertexInput=x;b.builtin=y=>(z,u)=>{h(z,"builtins",{builtin:y,propertyKey:u})};b.define=(y,z)=>{h(y,"defines",{propertyKey:z})};b.input=y=>(z,u,v)=>{h(z,"inputs",{inputCtor:y,propertyKey:u,parameterIndex:v})};b.location=function(y,z){return(u,v)=>{h(u,
"locations",{typeCtor:z,propertyKey:v,parameterIndex:null,index:y})}};b.option=y=>(z,u)=>{h(z,"options",{typeCtor:y,propertyKey:u})};b.transformFeedback=function(y){return(z,u)=>{h(z,"transformFeedbackBindings",{propertyKey:u,parameterIndex:null,index:y})}};b.uniform=y=>(z,u)=>{h(z,"uniforms",{typeCtor:y,propertyKey:u})};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/ShaderBuilder2D":function(){define("exports ../../../../../core/Error ../../../../../core/has ../../../../../core/Logger ../../../../3d/webgl-engine/core/shaderTechnique/BindType ../../../../3d/webgl-engine/lib/Util".split(" "),
function(b,q,n,g,k,l){class a{constructor(){this._includedModules=new Map}include(t,w){this._includedModules.has(t)?this._includedModules.get(t):(this._includedModules.set(t,w),t(this.builder,w))}}class f extends a{constructor(){super(...arguments);this.vertex=new e;this.fragment=new e;this.attributes=new h;this.varyings=new x;this.extensions=new m;this.constants=new p}get fragmentUniforms(){return this.fragment.uniforms.entries}get builder(){return this}generate(t,w=!0){const r=this.extensions.generateSource(t),
y=this.attributes.generateSource(t),z=this.varyings.generateSource(t);var u="vertex"===t?this.vertex:this.fragment;const v=u.uniforms.generateSource(),A=u.code.generateSource();t="vertex"===t?"precision highp float;\nprecision highp sampler2D;":"#ifdef GL_FRAGMENT_PRECISION_HIGH\n  precision highp float;\n  precision highp sampler2D;\n#else\n  precision mediump float;\n  precision mediump sampler2D;\n#endif\n";u=this.constants.generateSource().concat(u.constants.generateSource());return`${w?"#version 300 es":
""}\n${r.join("\n")}\n${t}\n${u.join("\n")}\n${v.join("\n")}\n${y.join("\n")}\n${z.join("\n")}\n${A.join("\n")}`}generateBindPass(t){const w=new Map;this.vertex.uniforms.entries.forEach(z=>{const u=z.bind[k.BindType.Pass];u&&w.set(z.name,u)});this.fragment.uniforms.entries.forEach(z=>{const u=z.bind[k.BindType.Pass];u&&w.set(z.name,u)});const r=Array.from(w.values()),y=r.length;return(z,u)=>{for(let v=0;v<y;++v)r[v](t,z,u)}}generateBindDraw(t){const w=new Map;this.vertex.uniforms.entries.forEach(z=>
{const u=z.bind[k.BindType.Draw];u&&w.set(z.name,u)});this.fragment.uniforms.entries.forEach(z=>{const u=z.bind[k.BindType.Draw];u&&w.set(z.name,u)});const r=Array.from(w.values()),y=r.length;return(z,u,v)=>{for(let A=0;A<y;++A)r[A](t,v,z,u)}}}class d{constructor(){this._entries=new Map}add(...t){for(const w of t)this._add(w)}get(t){return this._entries.get(t)}_add(t){if(null==t)g.getLogger("esri.views.3d.webgl-engine.core.shaderModules.shaderBuilder").error(`Trying to add null Uniform from ${Error().stack}.`);
else{if(this._entries.has(t.name)&&!this._entries.get(t.name).equals(t))throw new q(`Duplicate uniform name ${t.name} for different uniform type`);this._entries.set(t.name,t)}}generateSource(){return Array.from(this._entries.values()).map(t=>null!=t.arraySize?`uniform ${t.type} ${t.name}[${t.arraySize}];`:`uniform ${t.type} ${t.name};`)}get entries(){return Array.from(this._entries.values())}}class c{constructor(){this._entries=[]}add(t){this._entries.push(t)}generateSource(){return this._entries}}
class e extends a{constructor(){super(...arguments);this.uniforms=new d;this.code=new c;this.constants=new p}get builder(){return this}}class h{constructor(){this._entries=[]}add(t,w){this._entries.push([t,w])}generateSource(t){return"fragment"===t?[]:this._entries.map(w=>`in ${w[1]} ${w[0]};`)}}class x{constructor(){this._entries=new Map}add(t,w){this._entries.has(t)&&l.assert(this._entries.get(t)===w);this._entries.set(t,w)}generateSource(t){const w=[];this._entries.forEach((r,y)=>w.push("vertex"===
t?`out ${r} ${y};`:`in ${r} ${y};`));return w}}class m{constructor(){this._entries=new Set}add(t){this._entries.add(t)}generateSource(t){const w="vertex"===t?m.ALLOWLIST_VERTEX:m.ALLOWLIST_FRAGMENT;return Array.from(this._entries).filter(r=>w.includes(r)).map(r=>`#extension ${r} : enable`)}}m.ALLOWLIST_FRAGMENT=["GL_EXT_shader_texture_lod","GL_OES_standard_derivatives"];m.ALLOWLIST_VERTEX=[];class p{constructor(){this._entries=new Set}add(t,w,r){let y="ERROR_CONSTRUCTOR_STRING";switch(w){case "float":y=
p._numberToFloatStr(r);break;case "int":y=p._numberToIntStr(r);break;case "bool":y=r.toString();break;case "vec2":y=`vec2(${p._numberToFloatStr(r[0])},                            ${p._numberToFloatStr(r[1])})`;break;case "vec3":y=`vec3(${p._numberToFloatStr(r[0])},                            ${p._numberToFloatStr(r[1])},                            ${p._numberToFloatStr(r[2])})`;break;case "vec4":y=`vec4(${p._numberToFloatStr(r[0])},                            ${p._numberToFloatStr(r[1])},                            ${p._numberToFloatStr(r[2])},                            ${p._numberToFloatStr(r[3])})`;
break;case "ivec2":y=`ivec2(${p._numberToIntStr(r[0])},                             ${p._numberToIntStr(r[1])})`;break;case "ivec3":y=`ivec3(${p._numberToIntStr(r[0])},                             ${p._numberToIntStr(r[1])},                             ${p._numberToIntStr(r[2])})`;break;case "ivec4":y=`ivec4(${p._numberToIntStr(r[0])},                             ${p._numberToIntStr(r[1])},                             ${p._numberToIntStr(r[2])},                             ${p._numberToIntStr(r[3])})`;
break;case "mat2":case "mat3":case "mat4":y=`${w}(${Array.prototype.map.call(r,z=>p._numberToFloatStr(z)).join(", ")})`}this._entries.add(`const ${w} ${t} = ${y};`);return this}static _numberToIntStr(t){return t.toFixed(0)}static _numberToFloatStr(t){return Number.isInteger(t)?t.toFixed(1):t.toString()}generateSource(){return Array.from(this._entries)}}b.Code=c;b.Includes=a;b.ShaderBuilder2D=f;b.Stage=e;b.Uniforms=d;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderTechnique/BindType":function(){define(["exports"],
function(b){b.BindType=void 0;var q=b.BindType||(b.BindType={});q[q.Pass=0]="Pass";q[q.Draw=1]="Draw";Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/Util":function(){define(["exports","../../../../core/libs/gl-matrix-2/factories/vec2f64","../../../../chunks/vec42","../../../../core/libs/gl-matrix-2/factories/vec4f64"],function(b,q,n,g){function k(f,d="Assertion"){if(!f)throw new a(`${d} at ${Error(d).stack}`);}const l=g.create();class a{constructor(f){this.message=
f}toString(){return`AssertException: ${this.message}`}}b.assert=k;b.isTranslationMatrix=function(f){return 1===f[0]&&0===f[1]&&0===f[2]&&0===f[3]&&0===f[4]&&1===f[5]&&0===f[6]&&0===f[7]&&0===f[8]&&0===f[9]&&1===f[10]&&0===f[11]&&1===f[15]};b.logWithBase=function(f,d){return Math.log(f)/Math.log(d)};b.project=function(f,d,c,e,h){l[0]=f[0];l[1]=f[1];l[2]=f[2];l[3]=1;n.transformMat4(l,l,d);2<h.length&&(h[2]=-l[2]);n.transformMat4(l,l,c);k(0!==l[3]);h[0]=l[0]/l[3];h[1]=l[1]/l[3];h[2]=l[2]/l[3];h[0]=(.5*
h[0]+.5)*e[2]+e[0];h[1]=(.5*h[1]+.5)*e[3]+e[1]};b.rayBoxTest=function(f,d,c,e){let h,x=(c[0]-f[0])/d[0],m=(e[0]-f[0])/d[0];x>m&&(h=x,x=m,m=h);let p=(c[1]-f[1])/d[1],t=(e[1]-f[1])/d[1];p>t&&(h=p,p=t,t=h);if(x>t||p>m)return!1;p>x&&(x=p);t<m&&(m=t);c=(c[2]-f[2])/d[2];f=(e[2]-f[2])/d[2];c>f&&(h=c,c=f,f=h);if(x>f||c>m)return!1;f<m&&(m=f);return 0>m?!1:!0};b.rayRay2D=function(f,d,c,e,h,x=q.create()){const m=(e[h]-c[h])*(d[0]-f[0])-(e[0]-c[0])*(d[h]-f[h]);if(0===m)return!1;c=((e[0]-c[0])*(f[h]-c[h])-(e[h]-
c[h])*(f[0]-c[0]))/m;x[0]=f[0]+c*(d[0]-f[0]);x[1]=f[h]+c*(d[h]-f[h]);return!0};b.setMatrixTranslation3=function(f,d,c,e){f[12]=d;f[13]=c;f[14]=e};b.verify=function(f,d){f||console.warn("Verify failed: "+(d||"")+"\n"+Error("verify").stack)};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/core/libs/gl-matrix-2/factories/vec2f64":function(){define(["exports"],function(b){function q(){return[0,0]}function n(t){return[t[0],t[1]]}function g(t,w){return[t,w]}function k(t,w=[0,0]){const r=
Math.min(2,t.length);for(let y=0;y<r;++y)w[y]=t[y];return w}function l(t,w){return new Float64Array(t,w,2)}function a(){return[0,0]}function f(){return[1,1]}function d(){return[1,0]}function c(){return[0,1]}const e=[0,0],h=[1,1],x=[1,0],m=[0,1],p=Object.freeze(Object.defineProperty({__proto__:null,ONES:h,UNIT_X:x,UNIT_Y:m,ZEROS:e,clone:n,create:q,createView:l,fromArray:k,fromValues:g,ones:f,unitX:d,unitY:c,zeros:a},Symbol.toStringTag,{value:"Module"}));b.ONES=h;b.UNIT_X=x;b.UNIT_Y=m;b.ZEROS=e;b.clone=
n;b.create=q;b.createView=l;b.fromArray=k;b.fromValues=g;b.ones=f;b.unitX=d;b.unitY=c;b.vec2f64=p;b.zeros=a;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/graph/glsl":function(){define(["exports","../../../../../../chunks/tslib.es6","./ShaderGraphNode"],function(b,q,n){function g(O){switch(O.type){case "uint":return T;case "uvec2":return b.Vec2;case "uvec3":return b.Vec3;case "uvec4":return b.Vec4;default:throw Error("Found unexpected type");
}}function k(O){switch(O.type){case "float":return b.UInt;case "vec2":return b.UVec2;case "vec3":return b.UVec3;case "vec4":return b.UVec4;default:throw Error("Found unexpected type");}}function l(O){switch(O.type){case "int":return T;case "ivec2":return b.Vec2;case "ivec3":return b.Vec3;case "ivec4":return b.Vec4;default:throw Error("Found unexpected type");}}function a(O){switch(O.type){case "float":return oa;case "vec2":return b.IVec2;case "vec3":return b.IVec3;case "vec4":return b.IVec4;default:throw Error("Found unexpected type");
}}function f(O){switch(O.type){case "bool":case "float":case "int":case "uint":return ha;case "bvec2":case "vec2":case "ivec2":case "uvec2":return b.BVec2;case "bvec3":case "vec3":case "ivec3":case "uvec3":return b.BVec3;case "bvec4":case "vec4":case "ivec4":case "uvec4":return b.BVec4;default:throw Error("Unable to handle type");}}function d(O){switch(O.type){case "float":case "int":case "uint":case "bool":case "sampler2D":return 1;case "vec2":case "ivec2":case "uvec2":case "bvec2":return 2;case "vec3":case "ivec3":case "uvec3":case "bvec3":return 3;
case "vec4":case "ivec4":case "uvec4":case "bvec4":return 4;case "mat2":return 4;case "mat3":return 9;case "mat4":return 16;case "array":return O.size*d(O.elementType)}}function c(O){const ea=[["float","vec2","vec3","vec4"],["int","ivec2","ivec3","ivec4"],["uint","uvec2","uvec3","uvec4"],["bool","bvec2","bvec3","bvec4"]];for(const na of ea)if(na.includes(O))return na.map(ra=>la[ra]);throw Error("Unable to find type family");}function e(O){return new Proxy(O,{get(ea,na){if("constructor"===na)return new Proxy(ea.constructor,
{construct(ra,Aa,za){ra=new ra(...Aa);return e(ra)}});if(na in ea)return ea[na];if("string"===typeof na)return ea=c(O.type),p(O,na,ea[na.length-1])}})}function h(O){return new Proxy(O,{construct(ea,na,ra){ea=new ea(...na);return e(ea)}})}function x(O){return new Proxy(O,{get(ea,na){if(na in ea)return ea[na];if("string"===typeof na&&(ea=parseInt(na,10),!isNaN(ea)))return p(O,`[${ea}]`,O.elementType.constructor)}})}function m(O,ea){return"number"===typeof O?new ea(O):O}function p(O,ea,na){O=new na(new n.ShaderPropertyAccessNode(ea,
O,na));O.isImplicit=!0;return O}function t(O,ea,na,ra=null){if(ra){const Aa=new ra;O=new ra(new n.ShaderFunctionNode(O,[ea,na],!0,!1,Aa));O.isImplicit=!0;return O}if("float"===ea.type||"int"===ea.type||("mat2"===ea.type||"mat3"===ea.type||"mat4"===ea.type)&&"float"!==na.type)return O=new na.constructor(new n.ShaderFunctionNode(O,[ea,na],!0,!1,na.constructor)),O.isImplicit=!0,O;O=new ea.constructor(new n.ShaderFunctionNode(O,[ea,na],!0,!1,ea.constructor));O.isImplicit=!0;return O}function w(O,ea,na=
ea.constructor){O=new na(new n.ShaderFunctionNode(O,[ea],!1,!1,na));O.isImplicit=!0;return O}function r(O,ea,na,ra=ea.constructor){O=new ra(new n.ShaderFunctionNode(O,[ea,na],!1,!1,ra));O.isImplicit=!0;return O}function y(O,ea,na,ra,Aa=ea.constructor){O=new Aa(new n.ShaderFunctionNode(O,[ea,na,ra],!1,!1,Aa));O.isImplicit=!0;return O}function z(O){return F(O,pa(-1))}function u(O,ea,na,ra){return new ea(new n.ShaderBlockNode(O,ea,na,ra))}function v(O,ea,na=0,ra=O.size){na=(new oa(na)).setMutable().setDebugName("FindIndexIterator");
O=O.get(na);ea=ea(O).setDebugName("FindIndexPredicate");return u({iter:na},oa,ea,({out:Aa,iter:za,subgraph:Ba})=>`\n${Aa} = -1;\n\nfor (; ${za} < ${ra}; ${za}++) {\n\n${Ba.body}\n\n  if (${Ba.varName}) {\n    ${Aa} = ${za};\n    break;\n  }\n\n}\n`).setDebugName("FindIndexBlock")}function A(O,ea,na=0,ra=O.size){return u({array:O},oa,null,({out:Aa,array:za})=>`\n${Aa} = -1;\nfor (int i = ${na}; i < ${ra}; i++) {\n  bool condition;\n  ${ea({array:za,i:"i",out:"condition"})}\n  if (condition) {\n    ${Aa} = i;\n    break;\n  }\n}\n`).setDebugName("GlslFindIndexBlock")}
function B(O,ea,na){ea="function"===typeof ea?ea():ea;na="function"===typeof na?na():na;O=new ea.constructor(new n.ShaderConditionNode(O,ea,na));O.isImplicit=!0;return O}function F(O,ea){return t("*",O,ea)}function H(O,ea){return t("/",O,ea)}function J(O,ea){return t("+",O,ea)}function E(O,ea){return t("-",O,ea)}function K(...O){return 1>=O.length?O[0]:O.slice(1).reduce((ea,na)=>C(ea,na),O[0])}function C(O,ea){return t("||",O,ea,ha)}function D(...O){return 1>=O.length?O[0]:O.slice(1).reduce((ea,na)=>
t("\x26\x26",ea,na,ha),O[0])}function G(O){return w("all",O,ha)}function N(O){return w("any",O,ha)}function Y(O){return w("cos",O)}function ca(O){return w("sin",O)}var ka,Q,R,Z,da,ja,W,aa,ia,qa,sa,ya,va,wa;class M extends Error{}b.FixedArray=ka=class extends n.ShaderPrimitiveNode{constructor(O,ea){super();this.elementType=O;this.size=ea;this.children=[];this.type="array"}clone(){const O=new ka(this.elementType,this.size);super.cloneInto(O);return O}get(O){return"number"===typeof O?(O=new oa(O),O.isImplicit=
!0,p(this,O,this.elementType.constructor)):p(this,O,this.elementType.constructor)}last(){return this.get(this.size-1)}first(){return this.get(0)}findIndex(O,ea,na){return v(this,O,ea,na)}glslFindIndex(O,ea,na){return A(this,O,ea,na)}static ofType(O,ea){return new Proxy(ka,{construct(na,ra){return new ka(new O,ea)}})}};b.FixedArray.type="array";b.FixedArray=ka=q.__decorate([function(O){return new Proxy(O,{construct(ea,na,ra){ea=new ea(...na);return x(ea)}})}],b.FixedArray);class L extends n.ShaderPrimitiveNode{constructor(){super(...arguments);
this.type="sampler2D";this.children=[]}clone(){const O=new L;O.children=this.children.map(n.cloneShaderNode);super.cloneInto(O);return O}}L.type="sampler2D";class T extends n.ShaderPrimitiveNode{constructor(O){super();this.type="float";this.children=[O]}clone(){const O=new T(n.cloneShaderNode(this.children[0]));super.cloneInto(O);return O}multiply(O){return"number"===typeof O?F(this,m(O,T)):F(this,O)}divide(O){return"number"===typeof O?H(this,m(O,T)):H(this,O)}add(O){return"number"===typeof O?J(this,
m(O,T)):J(this,O)}subtract(O){return"number"===typeof O?E(this,m(O,T)):E(this,O)}}T.type="float";b.Vec2=Q=class extends n.ShaderPrimitiveNode{constructor(O,ea){super();this.type="vec2";this.children=[O,ea].filter(na=>null!=na)}clone(){const O=new Q(n.cloneShaderNode(this.children[0]),n.cloneShaderNode(this.children[1]));super.cloneInto(O);return O}get 0(){return p(this,"[0]",T)}get 1(){return p(this,"[1]",T)}get 2(){throw new M;}get 3(){throw new M;}multiply(O){return F(this,"number"===typeof O?m(O,
T):O)}divide(O){return H(this,"number"===typeof O?m(O,T):O)}add(O){return J(this,"number"===typeof O?m(O,T):O)}subtract(O){return E(this,"number"===typeof O?m(O,T):O)}};b.Vec2.type="vec2";b.Vec2=Q=q.__decorate([h],b.Vec2);b.Vec3=R=class extends n.ShaderPrimitiveNode{constructor(O,ea,na){super();this.type="vec3";this.children=[O,ea,na].filter(ra=>null!=ra)}get 0(){return p(this,"[0]",T)}get 1(){return p(this,"[1]",T)}get 2(){return p(this,"[2]",T)}get 3(){throw new M;}clone(){const O=new R(n.cloneShaderNode(this.children[0]),
n.cloneShaderNode(this.children[1]),n.cloneShaderNode(this.children[2]));super.cloneInto(O);return O}multiply(O){return F(this,"number"===typeof O?m(O,T):O)}divide(O){return H(this,"number"===typeof O?m(O,T):O)}add(O){return J(this,"number"===typeof O?m(O,T):O)}subtract(O){return E(this,"number"===typeof O?m(O,T):O)}};b.Vec3.type="vec3";b.Vec3=R=q.__decorate([h],b.Vec3);b.Vec4=Z=class extends n.ShaderPrimitiveNode{constructor(O,ea,na,ra){super();this.type="vec4";this.children=[O,ea,na,ra].filter(Aa=>
null!=Aa)}clone(){const O=new Z(n.cloneShaderNode(this.children[0]),n.cloneShaderNode(this.children[1]),n.cloneShaderNode(this.children[2]),n.cloneShaderNode(this.children[3]));super.cloneInto(O);return O}get 0(){return p(this,"[0]",T)}get 1(){return p(this,"[1]",T)}get 2(){return p(this,"[2]",T)}get 3(){return p(this,"[3]",T)}multiply(O){return F(this,"number"===typeof O?m(O,T):O)}divide(O){return H(this,"number"===typeof O?m(O,T):O)}add(O){return J(this,"number"===typeof O?m(O,T):O)}subtract(O){return E(this,
"number"===typeof O?m(O,T):O)}};b.Vec4.type="vec4";b.Vec4=Z=q.__decorate([h],b.Vec4);b.UInt=da=class extends n.ShaderPrimitiveNode{constructor(O){super();this.type="uint";this.children=[O]}clone(){const O=new da(n.cloneShaderNode(this.children[0]));super.cloneInto(O);return O}};b.UInt.type="uint";b.UInt=da=q.__decorate([h],b.UInt);b.UVec2=ja=class extends n.ShaderPrimitiveNode{constructor(O,ea){super();this.type="uvec2";this.children=[O,ea].filter(na=>null!=na)}clone(){const O=new ja(n.cloneShaderNode(this.children[0]),
n.cloneShaderNode(this.children[1]));super.cloneInto(O);return O}};b.UVec2.type="uvec2";b.UVec2=ja=q.__decorate([h],b.UVec2);b.UVec3=W=class extends n.ShaderPrimitiveNode{constructor(O,ea,na){super();this.type="uvec3";this.children=[O,ea,na].filter(ra=>null!=ra)}clone(){const O=new W(n.cloneShaderNode(this.children[0]),n.cloneShaderNode(this.children[1]),n.cloneShaderNode(this.children[2]));super.cloneInto(O);return O}};b.UVec3.type="uvec3";b.UVec3=W=q.__decorate([h],b.UVec3);b.UVec4=aa=class extends n.ShaderPrimitiveNode{constructor(O,
ea,na,ra){super();this.type="uvec4";this.children=[O,ea,na,ra].filter(Aa=>null!=Aa)}clone(){const O=new aa(n.cloneShaderNode(this.children[0]),n.cloneShaderNode(this.children[1]),n.cloneShaderNode(this.children[2]),n.cloneShaderNode(this.children[3]));super.cloneInto(O);return O}};b.UVec4.type="uvec4";b.UVec4=aa=q.__decorate([h],b.UVec4);class ha extends n.ShaderPrimitiveNode{constructor(O){super();this.type="bool";this.children=[O]}and(O){return D(this,O)}or(O){return K(this,O)}clone(){const O=new ha(n.cloneShaderNode(this.children[0]));
super.cloneInto(O);return O}}ha.type="bool";b.BVec2=ia=class extends n.ShaderPrimitiveNode{constructor(O,ea){super();this.type="bvec2";this.children=[O,ea].filter(na=>null!=na)}all(){return G(this)}any(){return N(this)}clone(){const O=new ia(n.cloneShaderNode(this.children[0]),n.cloneShaderNode(this.children[1]));super.cloneInto(O);return O}};b.BVec2.type="bvec2";b.BVec2=ia=q.__decorate([h],b.BVec2);b.BVec3=qa=class extends n.ShaderPrimitiveNode{constructor(O,ea,na){super();this.type="bvec3";this.children=
[O,ea,na].filter(ra=>null!=ra)}all(){return G(this)}any(){return N(this)}clone(){const O=new qa(n.cloneShaderNode(this.children[0]),n.cloneShaderNode(this.children[1]),n.cloneShaderNode(this.children[2]));super.cloneInto(O);return O}};b.BVec3.type="bvec3";b.BVec3=qa=q.__decorate([h],b.BVec3);b.BVec4=sa=class extends n.ShaderPrimitiveNode{constructor(O,ea,na,ra){super();this.type="bvec4";this.children=[O,ea,na,ra].filter(Aa=>null!=Aa)}all(){return G(this)}any(){return N(this)}clone(){const O=new sa(n.cloneShaderNode(this.children[0]),
n.cloneShaderNode(this.children[1]),n.cloneShaderNode(this.children[2]),n.cloneShaderNode(this.children[3]));super.cloneInto(O);return O}};b.BVec4.type="bvec4";b.BVec4=sa=q.__decorate([h],b.BVec4);class oa extends n.ShaderPrimitiveNode{constructor(O){super();this.type="int";this.children=[O]}multiply(O){return F(this,m(O,oa))}add(O){return J(this,m(O,oa))}subtract(O){return E(this,m(O,oa))}divide(O){return H(this,m(O,oa))}clone(){const O=new oa(n.cloneShaderNode(this.children[0]));super.cloneInto(O);
return O}}oa.type="int";b.IVec2=ya=class extends n.ShaderPrimitiveNode{constructor(O,ea){super();this.type="ivec2";this.children=[O,ea].filter(na=>null!=na)}clone(){const O=new ya(n.cloneShaderNode(this.children[0]),n.cloneShaderNode(this.children[1]));super.cloneInto(O);return O}};b.IVec2.type="ivec2";b.IVec2=ya=q.__decorate([h],b.IVec2);b.IVec3=va=class extends n.ShaderPrimitiveNode{constructor(O,ea,na){super();this.type="ivec3";this.children=[O,ea,na].filter(ra=>null!=ra)}clone(){const O=new va(n.cloneShaderNode(this.children[0]),
n.cloneShaderNode(this.children[1]),n.cloneShaderNode(this.children[2]));super.cloneInto(O);return O}};b.IVec3.type="ivec3";b.IVec3=va=q.__decorate([h],b.IVec3);b.IVec4=wa=class extends n.ShaderPrimitiveNode{constructor(O,ea,na,ra){super();this.type="ivec4";this.children=[O,ea,na,ra].filter(Aa=>null!=Aa)}clone(){const O=new wa(n.cloneShaderNode(this.children[0]),n.cloneShaderNode(this.children[1]),n.cloneShaderNode(this.children[2]),n.cloneShaderNode(this.children[3]));super.cloneInto(O);return O}};
b.IVec4.type="ivec4";b.IVec4=wa=q.__decorate([h],b.IVec4);class S extends n.ShaderPrimitiveNode{constructor(O,ea,na,ra){super();this.type="mat2";this.children=[O,ea,na,ra]}clone(){const O=new S(n.cloneShaderNode(this.children[0]),n.cloneShaderNode(this.children[1]),n.cloneShaderNode(this.children[2]),n.cloneShaderNode(this.children[3]));super.cloneInto(O);return O}multiply(O){return F(this,O)}}S.type="mat2";class X extends n.ShaderPrimitiveNode{static identity(){return new X(1,0,0,0,1,0,0,0,1)}static fromRotation(O){const ea=
ca(O);O=Y(O);return new X(O,ea,0,z(ea),O,0,0,0,1)}constructor(O,ea,na,ra,Aa,za,Ba,Ha,Ea){super();this.type="mat3";this.children=[O,ea,na,ra,Aa,za,Ba,Ha,Ea]}add(O){return J(this,O)}multiply(O){return F(this,O)}clone(){const O=new X(n.cloneShaderNode(this.children[0]),n.cloneShaderNode(this.children[1]),n.cloneShaderNode(this.children[2]),n.cloneShaderNode(this.children[3]),n.cloneShaderNode(this.children[4]),n.cloneShaderNode(this.children[5]),n.cloneShaderNode(this.children[6]),n.cloneShaderNode(this.children[7]),
n.cloneShaderNode(this.children[8]));super.cloneInto(O);return O}}X.type="mat3";class ba extends n.ShaderPrimitiveNode{static identity(){return new ba(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)}constructor(O,ea,na,ra,Aa,za,Ba,Ha,Ea,Ia,Ja,Fa,Ma,Ua,hb,ib){super();this.type="mat4";this.children=[O,ea,na,ra,Aa,za,Ba,Ha,Ea,Ia,Ja,Fa,Ma,Ua,hb,ib]}static fromColumns(O,ea,na,ra){return new ba(O.x,O.y,O.z,O.w,ea.x,ea.y,ea.z,ea.w,na.x,na.y,na.z,na.w,ra.x,ra.y,ra.z,ra.w)}multiply(O){return F(this,O)}clone(){const O=new ba(n.cloneShaderNode(this.children[0]),
n.cloneShaderNode(this.children[1]),n.cloneShaderNode(this.children[2]),n.cloneShaderNode(this.children[3]),n.cloneShaderNode(this.children[4]),n.cloneShaderNode(this.children[5]),n.cloneShaderNode(this.children[6]),n.cloneShaderNode(this.children[7]),n.cloneShaderNode(this.children[8]),n.cloneShaderNode(this.children[9]),n.cloneShaderNode(this.children[10]),n.cloneShaderNode(this.children[11]),n.cloneShaderNode(this.children[12]),n.cloneShaderNode(this.children[13]),n.cloneShaderNode(this.children[14]),
n.cloneShaderNode(this.children[15]));super.cloneInto(O);return O}}ba.type="mat4";const la={float:T,vec2:b.Vec2,vec3:b.Vec3,vec4:b.Vec4,int:oa,ivec2:b.IVec2,ivec3:b.IVec3,ivec4:b.IVec4,uint:b.UInt,uvec2:b.UVec2,uvec3:b.UVec3,uvec4:b.UVec4,bool:ha,bvec2:b.BVec2,bvec3:b.BVec3,bvec4:b.BVec4},pa=(...O)=>new T(...O);b.Bool=ha;b.Float=T;b.Int=oa;b.Mat2=S;b.Mat3=X;b.Mat4=ba;b.Sampler2D=L;b._or=C;b.abs=function(O){return w("abs",O)};b.acos=function(O){return w("acos",O)};b.acosh=function(O){return w("acosh",
O)};b.add=J;b.all=G;b.and=D;b.any=N;b.asin=function(O){return w("asin",O)};b.asinh=function(O){return w("asinh",O)};b.atan=function(O,ea){return null==ea?w("atan",O):r("atan",O,ea,O.constructor)};b.atanh=function(O){return w("atanh",O)};b.bitAnd=function(O,ea){return t("\x26",O,ea)};b.bitOr=function(O,ea){return t("|",O,ea)};b.bitRShift=function(O,ea){return t("\x3e\x3e",O,ea)};b.bitShift=function(O,ea){return t("\x3c\x3c",O,ea)};b.bitXor=function(O,ea){return t("^",O,ea)};b.block=u;b.ceil=function(O){return w("ceil",
O)};b.clamp=function(O,ea,na){return y("clamp",O,ea,na,O.constructor)};b.cond=function(...O){var ea=O.map(([ra,Aa])=>"function"===typeof Aa?[ra,Aa()]:[ra,Aa]);O=ea[0][1].constructor;const na=ea.findIndex(ra=>!0===ra[0]);if(-1===na)throw Error("A cond must have a fallthrough case with `true`/; ");ea=ea.slice(0,na).reduceRight((ra,Aa)=>B(Aa[0],Aa[1],ra),ea[na][1]);O=new O(ea);O.isImplicit=!0;return O};b.cos=Y;b.cosh=function(O){return w("cosh",O)};b.cross=function(O,ea){return r("cross",O,ea,O.constructor)};
b.dFdx=function(O){return w("dFdX",O)};b.dFdy=function(O){return w("dFdY",O)};b.definePropertyAccess=p;b.degrees=function(O){return w("degrees",O)};b.determinant=function(O){return w("determinant",O,T)};b.distance=function(O,ea){return r("distance",O,ea,T)};b.divide=H;b.dot=function(O,ea){return r("dot",O,ea,T)};b.equal=function(O,ea){return t("\x3d\x3d",O,ea,ha)};b.equalComponent=function(O,ea){return r("equal",O,ea,f(O))};b.exp=function(O){return w("exp",O)};b.exp2=function(O){return w("exp2",O)};
b.faceforward=function(O,ea,na){return y("faceforward",O,ea,na)};b.findIndex=v;b.float=pa;b.floatBitsToInt=function(O){return w("floatBitsToInt",O,a(O))};b.floatBitsToUint=function(O){return w("floatBitsToUint",O,k(O))};b.floor=function(O){return w("floor",O)};b.fract=function(O){return w("fract",O)};b.fwidth=function(O){return w("fwidth",O)};b.getTypeElementLengthForType=d;b.glslFindIndex=A;b.greaterThan=function(O,ea){return t("\x3e",O,ea,ha)};b.greaterThanComponent=function(O,ea){return r("greaterThan",
O,ea,f(O))};b.greaterThanEqual=function(O,ea){return t("\x3e\x3d",O,ea,ha)};b.greaterThanEqualComponent=function(O,ea){return r("greaterThanEqual",O,ea,f(O))};b.ifElse=B;b.int=(...O)=>new oa(...O);b.intBitsToFloat=function(O){return w("intBitsToFloat",O,l(O))};b.intMod=function(O,ea){return t("%",O,ea)};b.inverse=function(O){return w("inverse",O,T)};b.inversesqrt=function(O){return w("inversesqrt",O)};b.isinf=function(O){return w("isinf",O,f(O))};b.isnan=function(O){return w("isnan",O,f(O))};b.length=
function(O){return w("length",O,T)};b.lessThan=function(O,ea){return t("\x3c",O,ea,ha)};b.lessThanComponent=function(O,ea){return r("lessThan",O,ea,f(O))};b.lessThanEqual=function(O,ea){return t("\x3c\x3d",O,ea,ha)};b.lessThanEqualComponent=function(O,ea){return r("lessThanEqual",O,ea,f(O))};b.log=function(O){return w("log",O)};b.log2=function(O){return w("log2",O)};b.mat2=(...O)=>new S(...O);b.mat3=(...O)=>new X(...O);b.mat4=(...O)=>new ba(...O);b.matrixCompMult=function(O,ea){return r("matrixCompMult",
O,ea)};b.max=function(O,ea){return r("max",O,ea)};b.min=function(O,ea){return r("min",O,ea)};b.mix=function(O,ea,na){return y("mix",O,ea,na)};b.mod=function(O,ea){return r("mod",O,ea)};b.modf=function(O,ea){throw Error("modf not implemented");};b.multiply=F;b.namedScope=function(O,ea){O="function"===typeof O?O():O;ea=new O.constructor((new n.ShaderScopeNode(O)).setDebugName(ea));ea.isImplicit=!0;return ea};b.negate=z;b.normalize=function(O){return w("normalize",O)};b.not=function(O){return"bool"===
O.type?w("!",O):w("not",O)};b.notEqual=function(O,ea){return t("!\x3d",O,ea,ha)};b.notEqualComponent=function(O,ea){return r("notEqual",O,ea,f(O))};b.or=K;b.outerProduct=function(O,ea){throw Error("Impl type?");};b.packHalf2x16=function(O){return w("packHalf2x16",O,b.UInt)};b.packSnorm2x16=function(O){return w("packSnorm2x16",O,b.UInt)};b.packUnorm2x16=function(O){return w("packUnorm2x16",O,b.UInt)};b.pow=function(O,ea){return r("pow",O,ea)};b.radians=function(O){return w("radians",O)};b.reflect=
function(O,ea){return r("reflect",O,ea)};b.refract=function(O,ea,na){return y("refract",O,ea,na)};b.round=function(O){return w("round",O)};b.roundEven=function(O){return w("roundEven",O)};b.sign=function(O){return w("sign",O)};b.sin=ca;b.sinh=function(O){return w("sinh",O)};b.smoothstep=function(O,ea,na){return y("smoothstep",O,ea,na)};b.sqrt=function(O){return w("sqrt",O)};b.step=function(O,ea){return r("step",O,ea,ea.constructor)};b.subtract=E;b.tan=function(O){return w("tan",O)};b.tanh=function(O){return w("tanh",
O)};b.texelFetch=function(O,ea,na){throw Error("Impl type");};b.texelFetchOffset=function(O,ea,na,ra){throw Error("Impl type");};b.texture=function(O,ea,na){throw Error("Impl type");};b.texture2D=function(O,ea){return r("texture",O,ea,b.Vec4)};b.textureGrad=function(O,ea,na,ra){throw Error("Impl type");};b.textureGradOffset=function(O,ea,na,ra,Aa){throw Error("Impl type");};b.textureLod=function(O,ea,na){throw Error("Impl type");};b.textureLodOffset=function(O,ea,na,ra){throw Error("Impl type");};
b.textureOffset=function(O,ea,na,ra){throw Error("Impl type");};b.textureProj=function(O,ea,na){throw Error("Impl type");};b.textureProjGrad=function(O,ea,na,ra){throw Error("Impl type");};b.textureProjGradOffset=function(O,ea,na,ra,Aa){throw Error("Impl type");};b.textureProjLod=function(O,ea,na){throw Error("Impl type");};b.textureProjLodOffset=function(O,ea,na,ra){throw Error("Impl type");};b.textureProjOffset=function(O,ea,na,ra){throw Error("Impl type");};b.textureSize=function(O,ea){throw Error("Impl type");
};b.transformFloatToInt=a;b.transformFloatToUInt=k;b.transformIntToFloat=l;b.transformTypeToBooleanType=f;b.transformUIntToFloat=g;b.transpose=function(O){return w("transpose",O)};b.trunc=function(O){return w("trunc",O)};b.uintBitsToFloat=function(O){return w("uintBitsToFloat",O,g(O))};b.unpackHalf2x16=function(O){return w("unpackHalf2x16",O,b.Vec2)};b.unpackSnorm2x16=function(O){return w("unpackSnorm2x16",O,b.Vec2)};b.unpackUnorm2x16=function(O){return w("unpackUnorm2x16",O,b.Vec2)};b.vec2=(...O)=>
new b.Vec2(...O);b.vec3=(...O)=>new b.Vec3(...O);b.vec4=(...O)=>new b.Vec4(...O);b.when=function(O,ea){O=new ea.constructor(new n.ShaderConditionNode(O,ea,null));O.isImplicit=!0;return O};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/graph/ShaderGraphNode":function(){define(["exports"],function(b){function q(h){return h.split(" ").map((x,m)=>0<m?x.charAt(0).toUpperCase()+x.slice(1):x).join("")}function n(h){return"object"===typeof h?h.clone():
h}class g{constructor(){this.uid=g.NodeCount++;this._debugName=null;this.isImplicit=this._isMutable=!1}get isMutable(){return this._isMutable}setMutable(){this._isMutable=!0;return this}setDebugName(h){this._debugName=h=q(h);this.isImplicit&&this.children[0]instanceof g&&this.children[0].setDebugName(h);return this}get debugInfo(){return{name:this._debugName??""}}cloneInto(h){h._debugName=this._debugName;h._isMutable=this._isMutable;h.isImplicit=this.isImplicit;h.uid=this.uid}}g.NodeCount=0;class k extends g{constructor(){super(...arguments);
this.shaderType="primitive-node"}}class l extends g{constructor(h){super();this.child=h;this.shaderType="scope-node"}get children(){return[this.child]}clone(){const h=new l(n(this.child));this.cloneInto(h);return h}}class a extends g{constructor(h){super();this.text=h;this.shaderType="text-node"}get children(){return[]}clone(){const h=new a(this.text);this.cloneInto(h);return h}}class f extends g{constructor(h,x,m){super();this.property=h;this.target=x;this.returnType=m;this.shaderType="property-access-node"}get children(){const h=
[this.target];"string"!==typeof this.property&&h.push(this.property);return h}clone(){const h=new f(this.property,n(this.target),this.returnType);this.cloneInto(h);return h}}class d extends g{constructor(h,x,m){super();this.condition=h;this.ifTrue=x;this.ifFalse=m;this.shaderType="condition-node"}get children(){return[this.condition,this.ifTrue,this.ifFalse]}clone(){var h=n(this.ifTrue);const x=this.ifFalse?n(this.ifFalse):null;h=new d(this.condition,h,x);this.cloneInto(h);return h}}class c extends g{constructor(h,
x,m,p){super();this.captureList=h;this.returnType=x;this.generator=p;this.shaderType="block-node";m&&(this.subgraph=new l(m))}get children(){return Object.keys(this.captureList).map(h=>this.captureList[h]).concat(this.subgraph??[])}clone(){var h={};for(const x in this.captureList)h[x]=n(this.captureList[x]);h=new c(h,this.returnType,this.subgraph?n(this.subgraph.child):this.subgraph,this.generator);this.cloneInto(h);return h}}class e extends g{constructor(h,x,m,p,t,w=!1){super();this.token=h;this._children=
x;this.isInfix=m;this.isPropertyAccess=p;this.returnType=t;this.isTernary=w;this.shaderType="function-node"}get children(){return this._children}clone(){const h=new e(this.token,this._children.map(n),this.isInfix,this.isPropertyAccess,this.returnType,this.isTernary);this.cloneInto(h);return h}}b.ShaderBlockNode=c;b.ShaderConditionNode=d;b.ShaderFunctionNode=e;b.ShaderNode=g;b.ShaderPrimitiveNode=k;b.ShaderPropertyAccessNode=f;b.ShaderScopeNode=l;b.ShaderTextNode=a;b.cloneShaderNode=n;b.setReachableUids=
function(h,x){const m=[];for(m.push(x);m.length;)if(x=m.pop(),"object"===typeof x&&!h.has(x.uid)){h.add(x.uid);for(const p of x.children)m.push(p)}};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/graph/GlslGraphWriter":function(){define(["exports"],function(b){function q(g,k,l){k=k.split("\n");for(const a of k)if(a.trim().length){k="";const f=l??"000";null!=l&&(k+=`/*id:${f}*/   `);g.body+=k.padEnd(14);g.body+=" ".repeat(g.indent)+a+"\n"}}class n{write(g){for(const k of g.rootOutputNodes())g.shouldPruneOutputNode(k)||
(k.variableName=this._write(g,k.node));return g}_createVarName(g,k){let l="";"boolean"!==typeof k&&"number"!==typeof k&&k.debugInfo.name&&(l=`${k.debugInfo.name}_`);return`${l}v${g.varCount++}`}_write(g,k,l=!1){if("number"===typeof k||"boolean"===typeof k)return k.toString();let a=g.getEmit(k);if(a)return a;switch(k.shaderType){case "scope-node":a=this._writeScopeNode(g,k);break;case "primitive-node":a=this._writePrimitiveNode(g,k,l);break;case "function-node":a=this._writeFunctionNode(g,k);break;
case "property-access-node":a=this._writePropertyAccessNode(g,k);break;case "text-node":a=k.text;break;case "block-node":a=this._writeBlockNode(g,k);break;case "condition-node":a=this._writeConditionNode(g,k)}g.setEmit(k,a);return a}_writeScopeNode(g,k){var l=new k.child.constructor;l.setDebugName(k.debugInfo.name);l=this._write(g,l,!0);q(g,`{ /*ScopeStart: ${k.uid} ${k.debugInfo.name}*/`);g.indent+=2;const a=this._write(g,k.child);q(g,`${l} = ${a};`);g.indent-=2;q(g,`} /*ScopeEnd: ${k.uid} ${k.debugInfo.name}*/`);
return l}_writeConditionNode(g,k){var l=new k.ifTrue.constructor;l=this._write(g,l,!0);var a=this._write(g,k.condition);q(g,`if (${a}) {`);g.indent+=2;a=g.createSubgraphContext();const f=this._write(a,k.ifTrue);g.body+=a.body;f&&q(g,`${l} = ${f};`);g.indent-=2;q(g,"}");k.ifFalse&&(q(g,"else {"),g.indent+=2,a=g.createSubgraphContext(),k=this._write(a,k.ifFalse),g.body+=a.body,k&&q(g,`${l} = ${k};`),g.indent-=2,q(g,"}"));return l}_writeBlockNode(g,k){const {captureList:l,generator:a,returnType:f}=k;
var d={};for(var c in l)if(l[c]){var e=this._write(g,l[c]);d[c]=e}c=new f;c=this._write(g,c,!0);d.out=c;k.subgraph&&(e=g.createSubgraphContext(),k=this._write(e,k.subgraph.child),d.subgraph={varName:k,body:e.body});d=a(d);q(g,"{\n");g.indent+=2;q(g,d);g.indent-=2;q(g,"}\n");return c}_writePropertyAccessNode(g,k){const l=this._write(g,k.target);return"string"===typeof k.property&&k.property.includes("[")?`${l}${k.property}`:"string"!==typeof k.property?(g=this._write(g,k.property),`${l}[${g}]`):`${l}.${k.property}`}_writeFunctionNode(g,
k){const l=k.returnType.type;if(k.isInfix){const [d,c]=k.children.map(e=>this._write(g,e));var a=this._createVarName(g,k);q(g,`${l.padEnd(5)} ${a} = ${d} ${k.token} ${c};`,k.uid);return a}a=k.children.map(d=>this._write(g,d)).join(", ");const f=this._createVarName(g,k);q(g,`${l.padEnd(5)} ${f} = ${k.token}(${a});`,k.uid);return f}_writePrimitiveNode(g,k,l=!1){var a=g.getInput(k);if(a)return a.isUsed=!0,a.variableName;a=1===k.children.length&&k.children[0]?.type===k.type;if(k.isImplicit||a)return this._write(g,
k.children[0]);a=this._createVarName(g,k);if(l)return q(g,`${k.type.padEnd(5)} ${a};`,k.uid),a;if((l=!k.debugInfo.name&&!k.isMutable)&&"float"===k.type&&"number"===typeof k.children[0])return Number.isInteger(k.children[0])?k.children[0].toFixed(1):k.children[0].toString();if(l&&"int"===k.type&&"number"===typeof k.children[0]&&Number.isInteger(k.children[0]))return k.children[0].toString();const f=k.children.map(d=>this._write(g,d)).join(", ");if("array"===k.type)return q(g,`${k.type.padEnd(5)} ${a} = [${f}];`,
k.uid),a;if(l)return`${k.type}(${f})`;q(g,`${k.type.padEnd(5)} ${a} = ${k.type}(${f});`,k.uid);return a}}b.GlslShaderWriter=n;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/graph/ShaderGraphContext":function(){define(["exports","./ShaderGraphNode"],function(b,q){class n{constructor(l,a,f){this.variableName=l;this.variableInputType=a;this.node=f;this.type="shader-input";this.isUsed=!1}clone(){return new n(this.variableName,this.variableInputType,
q.cloneShaderNode(this.node))}}class g{constructor(l,a,f){this.outVariableName=l;this.outVariableType=a;this.node=f;this.type="shader-output"}clone(){const l=new g(this.outVariableName,this.outVariableType,q.cloneShaderNode(this.node));l.variableName=this.variableName;return l}}class k{static createVertex(l,a,f,d,c,e){const h=[];for(const x in l){const m=l[x],p=f.get(x);p?h.push(new n(p,"builtin",m)):h.push(new n("a_"+x,"in",m))}for(const x of d)h.push(new n(x.uniformName,"uniform",x.uniformHydrated));
l=[];for(const x in a)f=a[x],"glPosition"===x?l.push(new g("gl_Position","builtin",f)):"glPointSize"===x?l.push(new g("gl_PointSize","builtin",f)):l.push(new g("v_"+x,"out",f));return new k(h,l,c,e)}static createFragment(l,a,f,d,c,e){const h=[];c=Array.from(c.rootOutputNodes());for(var x in l){const p=l[x];var m=f.get(x);m?h.push(new n(m,"builtin",p)):(m=c.find(t=>t.node===p))&&h.push(new n(m.outVariableName,"in",p))}for(const p of d)h.push(new n(p.uniformName,"uniform",p.uniformHydrated));l=[];for(const p in a)d=
a[p],x=f.get(p),"discard"===p?l.push(new g(null,"discard",d)):x?l.push(new g(x,"builtin",d)):l.push(new g(p,"out",d));return new k(h,l,e)}constructor(l,a,f,d){this.type="shader-graph-context";this.indent=0;this.body="";this.varCount=0;this._inputShaderTypesByNodeUid=new Map;this._nodeEmitMap=new Map;for(const c of l)this._inputShaderTypesByNodeUid.set(c.node.uid,c);this._outputShaderTypes=a;this._transformFeedbackBindings=f;this._transformFeedbackNames=new Set(f.map(c=>"v_"+c.propertyKey));this._usedInFragmentShader=
d}shouldPruneOutputNode(l){return!this._usedInFragmentShader||"builtin"===l.outVariableType||this._transformFeedbackNames.has(l.outVariableName)?!1:!this._usedInFragmentShader.has(l.node.uid)}setEmit(l,a){this._nodeEmitMap.set(l.uid,a)}getEmit(l){return this._nodeEmitMap.get(l.uid)}inputs(){return this._inputShaderTypesByNodeUid.values()}getInput(l){return this._inputShaderTypesByNodeUid.get(l.uid)}*rootOutputNodes(){for(const l of this._outputShaderTypes)yield l}*nodes(){const l=[];for(var a of this._outputShaderTypes.values())l.push(a.node);
for(;l.length;)a=l.pop(),"number"!==typeof a&&"boolean"!==typeof a&&l.push(...a.children.filter(Boolean)),yield a}*nodesOfTypeOrFunction(){for(const l of this.nodes())"number"!==typeof l&&"boolean"!==typeof l&&(yield l)}createSubgraphContext(){const l=this.clone();l.body="";l.indent=this.indent+2;l._nodeEmitMap=new Map(this._nodeEmitMap);return l}clone(){const l=new k([],this._outputShaderTypes,this._transformFeedbackBindings,this._usedInFragmentShader);l._inputShaderTypesByNodeUid=this._inputShaderTypesByNodeUid;
l.indent=this.indent;l.body=this.body;l.varCount=this.varCount;l._nodeEmitMap=this._nodeEmitMap;return l}insertVertexShader(l){l.vertex.code.add("");this._insertInputs(l,"vertex");l.vertex.code.add("");l.vertex.code.add("// OUTPUTS: ");l.vertex.code.add("// --------------------------------------------------------- ");for(const a of this.rootOutputNodes()){const f="builtin"===a.outVariableType;this.shouldPruneOutputNode(a)||(f?l.vertex.code.add(`// ${a.outVariableType.padEnd(7)} ${a.node.type.padEnd(9)} ${a.outVariableName};`):
l.vertex.code.add(`${a.outVariableType.padEnd(10)} ${a.node.type.padEnd(9)} ${a.outVariableName};`))}l.vertex.code.add("");l.vertex.code.add("void main() {");l.vertex.code.add("  "+this.body.split("\n").join("\n  "));for(const a of this.rootOutputNodes())this.shouldPruneOutputNode(a)||l.vertex.code.add("  "+`${a.outVariableName} = ${a.variableName};`);l.vertex.code.add("}")}insertFragmentShader(l){this._insertInputs(l,"fragment");l.fragment.code.add("");l.fragment.code.add("// OUTPUTS: ");l.fragment.code.add("// --------------------------------------------------------- ");
for(const a of this.rootOutputNodes())"builtin"===a.outVariableType?l.fragment.code.add(`// ${a.outVariableType.padEnd(7)} ${a.node.type.padEnd(9)} ${a.outVariableName};`):l.fragment.code.add(`${a.outVariableType.padEnd(10)} ${a.node.type.padEnd(9)} ${a.outVariableName};`);l.fragment.code.add("");l.fragment.code.add("void main() {");l.fragment.code.add("  "+this.body.split("\n").join("\n  "));for(const a of this.rootOutputNodes())"discard"===a.outVariableType?(l.fragment.code.add("  // TODO: Should ensure codegen for discard appears first in fragment shader"),
l.fragment.code.add("  "+`if (${a.variableName}) {`),l.fragment.code.add("    discard;"),l.fragment.code.add("  }"),l.fragment.code.add("  ")):l.fragment.code.add("  "+`${a.outVariableName} = ${a.variableName};`);l.fragment.code.add("}")}_insertInputs(l,a){l[a].code.add("// INPUTS: ");l[a].code.add("// --------------------------------------------------------- ");for(const f of this.inputs())f.isUsed&&"builtin"!==f.variableInputType&&("array"===f.node.type?l[a].code.add(`${f.variableInputType.padEnd(10)} ${f.node.elementType.type.padEnd(9)} ${f.variableName}[${f.node.size}];`):
l[a].code.add(`${f.variableInputType.padEnd(10)} ${f.node.type.padEnd(9)} ${f.variableName};`))}}b.ShaderGraphContext=k;b.ShaderInput=n;b.ShaderOutput=g;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/typed/TypedShaderProgram":function(){define("exports ../../../../../../core/Error ../../../../../../core/Logger ../../../../../../core/object ../../../../../../core/RandomLCG ../../../../../../core/has ../../../../../webgl/checkWebGLError ../../../../../webgl/enums ../../../../../webgl/FramebufferObject ../../../../../webgl/Program ../../../../../webgl/GLObjectType ../../../../../webgl/Texture ../../Utils".split(" "),
function(b,q,n,g,k,l,a,f,d,c,e,h,x){function m(t,w,r){const y=w.length;y!==r&&(t=new q("Invalid Uniform",`Invalid length, expected ${r} but got ${y}`,{uniformName:t,values:w}),n.getLogger("esri.views.2d.engine.webgl.shaderGraph.typed.TypedShaderProgram").errorOnce(t))}class p{constructor(t,w,r,y,z,u){this._vao=this._program=null;this._temporaryTextures=[];this.vertexShader=t;this.fragmentShader=w;this._locations=r;this._locationInfo=y;this._uniformBindings=z;this._transformFeedbackBindings=u}destroy(){this._program&&
this._program.dispose();this.cleanupTemporaryTextures()}get locations(){return this._locations}get locationInfo(){return this._locationInfo}setUniforms(t){this._uniforms=t}cleanupTemporaryTextures(){for(const t of this._temporaryTextures)t.dispose();this._temporaryTextures=[]}bind(t){const w=this._uniforms;if(!this._program){var r=new Map;for(const [z,u]of this._locations)r.set(z,u);var y=[];for(const z of this._transformFeedbackBindings??[]){const {index:u,propertyKey:v}=z;y[u]=`v_${v}`}this._program=
new c.Program(t,this.vertexShader,this.fragmentShader,r,new Map,y)}r=this._program;t.useProgram(r);for(const z of this._uniformBindings){const {shaderModulePath:u,uniformName:v,uniformType:A,uniformArrayLength:B}=z;y=g.getDeepValue(u,w);if(null==y){if("sampler2D"===A)continue;throw Error(`Failed to find uniform value for ${u}`);}switch("array"===A?z.uniformArrayElementType:A){case "sampler2D":const {unit:F,texture:H}=y;r.setUniform1i(v,F);"type"in H?t.bindTexture(H,F):(y=x.createTexture(t,H.descriptor,
H.data),t.bindTexture(y,F));break;case "int":if(!B){r.setUniform1i(v,y);break}m(z.uniformName,y,B);r.setUniform1iv(v,y);break;case "float":if(!B){r.setUniform1f(v,y);break}m(z.uniformName,y,B);r.setUniform1fv(v,y);break;case "vec2":if(!B){r.setUniform2f(v,y[0],y[1]);break}m(z.uniformName,y,B);r.setUniform2fv(v,y.flat());break;case "vec3":if(!B){r.setUniform3f(v,y[0],y[1],y[2]);break}m(z.uniformName,y,B);r.setUniform3fv(v,y.flat());break;case "vec4":if(!B){r.setUniform4f(v,y[0],y[1],y[2],y[3]);break}m(z.uniformName,
y,B);r.setUniform4fv(v,y.flat());break;case "mat3":r.setUniformMatrix3fv(v,y);break;case "mat4":r.setUniformMatrix4fv(v,y);break;default:throw Error(`Unable to set uniform for type ${A}`);}}}}b.TypedShaderProgram=p;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/Program":function(){define(["exports","../../core/has","./checkWebGLError","./enums","./ShaderTranspiler"],function(b,q,n,g,k){function l(e,h,x){e=e.gl;const m=e.createShader(h);e.shaderSource(m,x);e.compileShader(m);
n.webglValidateShadersEnabled()&&!e.getShaderParameter(m,e.COMPILE_STATUS)&&(console.error("Compile error in ".concat(h===g.ShaderType.VERTEX_SHADER?"vertex":"fragment"," shader")),console.error(e.getShaderInfoLog(m)),console.error(a(x)));return m}function a(e){let h=2;return e.replaceAll("\n",()=>{var x=h++;x=1E3<=x?x.toString():("  "+x).slice(-3);return"\n"+x+":"})}function f(e,h,x){const m=e.get(h);if(!m)return e.set(h,Array.from(x)),!0;const p=x.length;if(m.length!==p)return e.set(h,Array.from(x)),
!0;for(e=0;e<p;++e)if(h=x[e],m[e]!==h){for(m[e]=h;e<p;++e)m[e]=x[e];return!0}return!1}class d{constructor(e,h,x,m,p=new Map,t=[]){this._context=e;this._locations=m;this._uniformBlockBindings=p;this._transformFeedbackVaryings=t;this._refCount=1;this._compiled=!1;this._linesOfCode=0;this._nameToUniformLocation=new Map;this._nameToUniform1=new Map;this._nameToUniform1v=new Map;this._nameToUniform2=new Map;this._nameToUniform3=new Map;this._nameToUniform4=new Map;this._nameToUniformMatrix3=new Map;this._nameToUniformMatrix4=
new Map;e||console.error("RenderingContext isn't initialized!");0===h.length&&console.error("Shaders source should not be empty!");h=k.transpileShader(h,g.ShaderType.VERTEX_SHADER);x=k.transpileShader(x,g.ShaderType.FRAGMENT_SHADER);this._vShader=l(this._context,g.ShaderType.VERTEX_SHADER,h);this._fShader=l(this._context,g.ShaderType.FRAGMENT_SHADER,x);c.enabled&&(this._linesOfCode=h.match(/\n/g).length+x.match(/\n/g).length+2,this._context.instanceCounter.increment(g.ResourceType.LinesOfCode,this._vShader,
this._linesOfCode));this._vShader&&this._fShader||console.error("Error loading shaders!");this._context.instanceCounter.increment(g.ResourceType.Shader,this);n.webglValidateShadersEnabled()&&(this.vertexShader=h,this.fragmentShader=x);this.usedMemory=h.length+x.length;const w=this._context.gl,r=w.createProgram();w.attachShader(r,this._vShader);w.attachShader(r,this._fShader);this._locations.forEach((y,z)=>w.bindAttribLocation(r,y,z));this._transformFeedbackVaryings?.length&&w.transformFeedbackVaryings(r,
this._transformFeedbackVaryings,w.SEPARATE_ATTRIBS);w.linkProgram(r);n.webglValidateShadersEnabled()&&!w.getProgramParameter(r,w.LINK_STATUS)&&console.error("Could not link shader\n"+`validated: ${w.getProgramParameter(r,w.VALIDATE_STATUS)}`+`, gl error ${w.getError()}`+`, vertex: ${w.getShaderParameter(this._vShader,w.COMPILE_STATUS)}`+`, fragment: ${w.getShaderParameter(this._fShader,w.COMPILE_STATUS)}`+`, info log: ${w.getProgramInfoLog(r)}`+`, vertex source: ${this.vertexShader}`+`, fragment source: ${this.fragmentShader}`);
for(const [y,z]of this._uniformBlockBindings)e=w.getUniformBlockIndex(r,y),4294967295>e&&w.uniformBlockBinding(r,e,z);this._glName=r;this._context.instanceCounter.increment(g.ResourceType.Program,this)}get glName(){return this._glName}get hasGLName(){return null!=this._glName}get hasTransformFeedbackVaryings(){return!!this._transformFeedbackVaryings?.length}get compiled(){if(this._compiled)return!0;const e=this._context.gl.getExtension("KHR_parallel_shader_compile");return null==e||null==this.glName?
this._compiled=!0:this._compiled=!!this._context.gl.getProgramParameter(this.glName,e.COMPLETION_STATUS_KHR)}dispose(){if(!(0<--this._refCount)){var e=this._context.gl,h=this._context.instanceCounter;this._nameToUniformLocation.forEach(x=>x&&h.decrement(g.ResourceType.Uniform,x));this._nameToUniformLocation.clear();this._vShader&&(0<this._linesOfCode&&(h.decrement(g.ResourceType.LinesOfCode,this._vShader,this._linesOfCode),this._linesOfCode=0),e.deleteShader(this._vShader),this._vShader=null,h.decrement(g.ResourceType.Shader,
this));this._fShader&&(e.deleteShader(this._fShader),this._fShader=null);this._glName&&(e.deleteProgram(this._glName),this._glName=null,h.decrement(g.ResourceType.Program,this))}}ref(){++this._refCount}_getUniformLocation(e){var h=this._nameToUniformLocation.get(e);return void 0!==h?h:this.glName?(h=this._context.gl.getUniformLocation(this.glName,e),this._nameToUniformLocation.set(e,h),h&&this._context.instanceCounter.increment(g.ResourceType.Uniform,h),h):null}hasUniform(e){return null!=this._getUniformLocation(e)}setUniform1i(e,
h){const x=this._nameToUniform1.get(e);if(void 0===x||h!==x)this._context.gl.uniform1i(this._getUniformLocation(e),h),this._nameToUniform1.set(e,h)}setUniform1iv(e,h){f(this._nameToUniform1v,e,h)&&this._context.gl.uniform1iv(this._getUniformLocation(e),h)}setUniform2iv(e,h){f(this._nameToUniform2,e,h)&&this._context.gl.uniform2iv(this._getUniformLocation(e),h)}setUniform3iv(e,h){f(this._nameToUniform3,e,h)&&this._context.gl.uniform3iv(this._getUniformLocation(e),h)}setUniform4iv(e,h){f(this._nameToUniform4,
e,h)&&this._context.gl.uniform4iv(this._getUniformLocation(e),h)}setUniform1f(e,h){const x=this._nameToUniform1.get(e);if(void 0===x||h!==x)this._context.gl.uniform1f(this._getUniformLocation(e),h),this._nameToUniform1.set(e,h)}setUniform1fv(e,h){f(this._nameToUniform1v,e,h)&&this._context.gl.uniform1fv(this._getUniformLocation(e),h)}setUniform2f(e,h,x){const m=this._nameToUniform2.get(e);if(void 0===m)this._context.gl.uniform2f(this._getUniformLocation(e),h,x),this._nameToUniform2.set(e,[h,x]);else if(h!==
m[0]||x!==m[1])this._context.gl.uniform2f(this._getUniformLocation(e),h,x),m[0]=h,m[1]=x}setUniform2fv(e,h){f(this._nameToUniform2,e,h)&&this._context.gl.uniform2fv(this._getUniformLocation(e),h)}setUniform3f(e,h,x,m){const p=this._nameToUniform3.get(e);if(void 0===p)this._context.gl.uniform3f(this._getUniformLocation(e),h,x,m),this._nameToUniform3.set(e,[h,x,m]);else if(h!==p[0]||x!==p[1]||m!==p[2])this._context.gl.uniform3f(this._getUniformLocation(e),h,x,m),p[0]=h,p[1]=x,p[2]=m}setUniform3fv(e,
h){const x=this._getUniformLocation(e);null!=x&&f(this._nameToUniform3,e,h)&&this._context.gl.uniform3fv(x,h)}setUniform4f(e,h,x,m,p){const t=this._nameToUniform4.get(e);if(void 0===t)this._context.gl.uniform4f(this._getUniformLocation(e),h,x,m,p),this._nameToUniform4.set(e,[h,x,m,p]);else if(void 0===t||h!==t[0]||x!==t[1]||m!==t[2]||p!==t[3])this._context.gl.uniform4f(this._getUniformLocation(e),h,x,m,p),t[0]=h,t[1]=x,t[2]=m,t[3]=p}setUniform4fv(e,h){const x=this._getUniformLocation(e);null!=x&&
f(this._nameToUniform4,e,h)&&this._context.gl.uniform4fv(x,h)}setUniformMatrix3fv(e,h,x=!1){const m=this._getUniformLocation(e);null!=m&&f(this._nameToUniformMatrix3,e,h)&&this._context.gl.uniformMatrix3fv(m,x,h)}setUniformMatrix4fv(e,h,x=!1){const m=this._getUniformLocation(e);null!=m&&f(this._nameToUniformMatrix4,e,h)&&this._context.gl.uniformMatrix4fv(m,x,h)}stop(){}}const c={enabled:!1};b.Program=d;b.test=c;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/ShaderTranspiler":function(){define(["exports",
"../../core/has","./enums","./reservedWordsGLSL3","./testUtils"],function(b,q,n,g,k){function l(){function y(da){da.length&&G.push({type:t[E],data:da,position:ca,line:N,column:Y})}function z(){D=D.length?[]:D;if("/"===C&&"*"===K)return ca=J+H-1,E=0,C=K,H+1;if("/"===C&&"/"===K)return ca=J+H-1,E=1,C=K,H+1;if("#"===K)return E=2,ca=J+H,H;if(/\s/.test(K))return E=9,ca=J+H,H;ka=/\d/.test(K);Q=/[^\w_]/.test(K);ca=J+H;E=ka?4:Q?3:9999;return H}function u(){if(("\r"===K||"\n"===K)&&"\\"!==C)return y(D.join("")),
E=999,H;D.push(K);C=K;return H+1}function v(){if("."===C&&/\d/.test(K))return E=5,H;if("/"===C&&"*"===K)return E=0,H;if("/"===C&&"/"===K)return E=1,H;if("."===K&&D.length){for(;A(D););E=5;return H}if(";"===K||")"===K||"("===K){if(D.length)for(;A(D););y(K);E=999;return H+1}var da=2===D.length&&"\x3d"!==K;if(/[\w_\d\s]/.test(K)||da){for(;A(D););E=999;return H}D.push(K);C=K;return H+1}function A(da){var ja=0;do{var W=m.indexOf(da.slice(0,da.length+ja).join(""));var aa=m[W];if(-1===W){if(0<ja--+da.length)continue;
aa=da.slice(0,1).join("")}y(aa);ca+=aa.length;D=D.slice(aa.length);return D.length}while(1)}function B(){if("."===K||/[eE]/.test(K))return D.push(K),E=5,C=K,H+1;if("x"===K&&1===D.length&&"0"===D[0])return E=11,D.push(K),C=K,H+1;if(/[^\d]/.test(K))return y(D.join("")),E=999,H;D.push(K);C=K;return H+1}function F(){"f"===K&&(D.push(K),C=K,H+=1);if(/[eE]/.test(K)||"-"===K&&/[eE]/.test(C))return D.push(K),C=K,H+1;if(/[^\d]/.test(K))return y(D.join("")),E=999,H;D.push(K);C=K;return H+1}var H=0,J=0,E=999,
K,C,D=[],G=[],N=1,Y=0,ca=0,ka=!1,Q=!1,R="",Z;return function(da){G=[];if(null!==da){da=da.replace?da.replace(/\r\n/g,"\n"):da;H=0;R+=da;for(Z=R.length;K=R[H],H<Z;){da=H;switch(E){case 0:"/"===K&&"*"===C?(D.push(K),y(D.join("")),E=999):(D.push(K),C=K);H+=1;break;case 1:H=u();break;case 2:H=u();break;case 3:H=v();break;case 4:H=B();break;case 11:/[^a-fA-F0-9]/.test(K)?(y(D.join("")),E=999):(D.push(K),C=K,H+=1);break;case 5:H=F();break;case 9999:if(/[^\d\w_]/.test(K)){var ja=D.join("");E=-1<x.indexOf(ja)?
8:-1<p.indexOf(ja)?7:6;y(D.join(""));E=999}else D.push(K),C=K,H+=1;break;case 9:/[^\s]/g.test(K)?(y(D.join("")),E=999):(D.push(K),C=K,H+=1);break;case 999:H=z()}if(da!==H)switch(R[da]){case "\n":Y=0;++N;break;default:++Y}}J+=H;R=R.slice(H);return G}D.length&&y(D.join(""));E=10;y("(eof)");return G}}function a(y){return y.map(z=>"eof"!==z.type?z.data:"").join("")}function f(y,z="100",u="300 es"){const v=/^\s*#version\s+([0-9]+(\s+[a-zA-Z]+)?)\s*/;for(const A of y)if("preprocessor"===A.type){const B=
v.exec(A.data);if(B){y=B[1].replaceAll(/\s{2,}/g," ");if(y===u)return y;if(y===z)return A.data="#version "+u,z;throw Error("unknown glsl version: "+y);}}y.splice(0,0,{type:"preprocessor",data:"#version "+u},{type:"whitespace",data:"\n"});return null}function d(y,z,u,v){v=v||u;for(const A of y)if("ident"===A.type&&A.data===u)return v in z?z[v]++:z[v]=0,d(y,z,v+"_"+z[v],v);return u}function c(y,z,u="afterVersion"){const v={data:"\n",type:"whitespace"},A=F=>F<y.length?/[^\r\n]$/.test(y[F].data):!1;let B=
function(F){let H=-1,J=0,E=-1;for(let C=0;C<F.length;C++){var K=F[C];"preprocessor"===K.type&&(/#(if|ifdef|ifndef)\s+.+/.test(K.data)?++J:/#endif\s*.*/.test(K.data)&&--J);("afterVersion"===u||"afterPrecision"===u)&&"preprocessor"===K.type&&K.data.startsWith("#version")&&(E=Math.max(E,C));if("afterPrecision"===u&&"keyword"===K.type&&"precision"===K.data){a:{for(K=C;K<F.length;K++){const D=F[K];if("operator"===D.type&&";"===D.data)break a}K=null}if(null===K)throw Error("precision statement not followed by any semicolons!");
E=Math.max(E,K)}H<E&&0===J&&(H=C)}return H+1}(y);A(B-1)&&y.splice(B++,0,v);for(const F of z)y.splice(B++,0,F);A(B-1)&&A(B)&&y.splice(B,0,v)}function e(y,z,u,v="lowp"){c(y,[{type:"keyword",data:"out"},{type:"whitespace",data:" "},{type:"keyword",data:v},{type:"whitespace",data:" "},{type:"keyword",data:u},{type:"whitespace",data:" "},{type:"ident",data:z},{type:"operator",data:";"}],"afterPrecision")}function h(y,z,u,v,A="lowp"){c(y,[{type:"keyword",data:"layout"},{type:"operator",data:"("},{type:"keyword",
data:"location"},{type:"whitespace",data:" "},{type:"operator",data:"\x3d"},{type:"whitespace",data:" "},{type:"integer",data:v.toString()},{type:"operator",data:")"},{type:"whitespace",data:" "},{type:"keyword",data:"out"},{type:"whitespace",data:" "},{type:"keyword",data:A},{type:"whitespace",data:" "},{type:"keyword",data:u},{type:"whitespace",data:" "},{type:"ident",data:z},{type:"operator",data:";"}],"afterPrecision")}const x="precision highp mediump lowp attribute const uniform varying break continue do for while if else in out inout float int void bool true false discard return mat2 mat3 mat4 vec2 vec3 vec4 ivec2 ivec3 ivec4 bvec2 bvec3 bvec4 sampler1D sampler2D sampler3D samplerCube sampler1DShadow sampler2DShadow struct asm class union enum typedef template this packed goto switch default inline noinline volatile public static extern external interface long short double half fixed unsigned input output hvec2 hvec3 hvec4 dvec2 dvec3 dvec4 fvec2 fvec3 fvec4 sampler2DRect sampler3DRect sampler2DRectShadow sizeof cast namespace using".split(" "),
m="\x3c\x3c\x3d \x3e\x3e\x3d ++ -- \x3c\x3c \x3e\x3e \x3c\x3d \x3e\x3d \x3d\x3d !\x3d \x26\x26 || +\x3d -\x3d *\x3d /\x3d %\x3d \x26\x3d ^^ ^\x3d |\x3d ( ) [ ] . ! ~ * / % + - \x3c \x3e \x26 ^ | ? : \x3d , ; { }".split(" "),p="abs acos all any asin atan ceil clamp cos cross dFdx dFdy degrees distance dot equal exp exp2 faceforward floor fract gl_BackColor gl_BackLightModelProduct gl_BackLightProduct gl_BackMaterial gl_BackSecondaryColor gl_ClipPlane gl_ClipVertex gl_Color gl_DepthRange gl_DepthRangeParameters gl_EyePlaneQ gl_EyePlaneR gl_EyePlaneS gl_EyePlaneT gl_Fog gl_FogCoord gl_FogFragCoord gl_FogParameters gl_FragColor gl_FragCoord gl_FragData gl_FragDepth gl_FragDepthEXT gl_FrontColor gl_FrontFacing gl_FrontLightModelProduct gl_FrontLightProduct gl_FrontMaterial gl_FrontSecondaryColor gl_LightModel gl_LightModelParameters gl_LightModelProducts gl_LightProducts gl_LightSource gl_LightSourceParameters gl_MaterialParameters gl_MaxClipPlanes gl_MaxCombinedTextureImageUnits gl_MaxDrawBuffers gl_MaxFragmentUniformComponents gl_MaxLights gl_MaxTextureCoords gl_MaxTextureImageUnits gl_MaxTextureUnits gl_MaxVaryingFloats gl_MaxVertexAttribs gl_MaxVertexTextureImageUnits gl_MaxVertexUniformComponents gl_ModelViewMatrix gl_ModelViewMatrixInverse gl_ModelViewMatrixInverseTranspose gl_ModelViewMatrixTranspose gl_ModelViewProjectionMatrix gl_ModelViewProjectionMatrixInverse gl_ModelViewProjectionMatrixInverseTranspose gl_ModelViewProjectionMatrixTranspose gl_MultiTexCoord0 gl_MultiTexCoord1 gl_MultiTexCoord2 gl_MultiTexCoord3 gl_MultiTexCoord4 gl_MultiTexCoord5 gl_MultiTexCoord6 gl_MultiTexCoord7 gl_Normal gl_NormalMatrix gl_NormalScale gl_ObjectPlaneQ gl_ObjectPlaneR gl_ObjectPlaneS gl_ObjectPlaneT gl_Point gl_PointCoord gl_PointParameters gl_PointSize gl_Position gl_ProjectionMatrix gl_ProjectionMatrixInverse gl_ProjectionMatrixInverseTranspose gl_ProjectionMatrixTranspose gl_SecondaryColor gl_TexCoord gl_TextureEnvColor gl_TextureMatrix gl_TextureMatrixInverse gl_TextureMatrixInverseTranspose gl_TextureMatrixTranspose gl_Vertex greaterThan greaterThanEqual inversesqrt length lessThan lessThanEqual log log2 matrixCompMult max min mix mod normalize not notEqual pow radians reflect refract sign sin smoothstep sqrt step tan texture2D texture2DLod texture2DProj texture2DProjLod textureCube textureCubeLod texture2DLodEXT texture2DProjLodEXT textureCubeLodEXT texture2DGradEXT texture2DProjGradEXT textureCubeGradEXT textureSize texelFetch".split(" ");
var t="block-comment line-comment preprocessor operator integer float ident builtin keyword whitespace eof integer".split(" ");const w=new Set(["GL_OES_standard_derivatives","GL_EXT_frag_depth","GL_EXT_draw_buffers","GL_EXT_shader_texture_lod"]),r=new Map;b.transpileShader=function(y,z){if(y.startsWith("#version 300"))return y;var u=k.shaderTranspiler.enableCache?r.get(y):null;if(null!=u)return u;u=l();var v=[];v=v.concat(u(y));u=v=v.concat(u(null));if("300 es"===f(u,"100","300 es"))return y;var A=
v=null;const B={},F={};for(let K=0;K<u.length;++K){const C=u[K];switch(C.type){case "keyword":z===n.ShaderType.VERTEX_SHADER&&"attribute"===C.data?C.data="in":"varying"===C.data&&(C.data=z===n.ShaderType.VERTEX_SHADER?"out":"in");break;case "builtin":/^texture(2D|Cube)(Proj)?(Lod|Grad)?(EXT)?$/.test(C.data.trim())&&(C.data=C.data.replaceAll(/(2D|Cube|EXT)/g,""));z===n.ShaderType.FRAGMENT_SHADER&&"gl_FragColor"===C.data&&(v||(v=d(u,B,"fragColor"),e(u,v,"vec4")),C.data=v);if(z===n.ShaderType.FRAGMENT_SHADER&&
"gl_FragData"===C.data){var H=void 0;let D=void 0;var J=u,E=K+1;let G=-1;for(;E<J.length;E++){const N=J[E];if("operator"===N.type&&("["===N.data&&(D=E),"]"===N.data)){H=E;break}"integer"===N.type&&(G=parseInt(N.data,10))}D&&H&&J.splice(D,H-D+1);J=G;H=d(u,B,"fragData");h(u,H,"vec4",J,"mediump");C.data=H}else z===n.ShaderType.FRAGMENT_SHADER&&"gl_FragDepthEXT"===C.data&&(A||=d(u,B,"gl_FragDepth"),C.data=A);break;case "ident":if(g.includes(C.data)){if(J=z===n.ShaderType.VERTEX_SHADER)a:{for(J=K-1;0<=
J;J--)if(H=u[J],"whitespace"!==H.type&&"block-comment"!==H.type)if("keyword"===H.type){if("attribute"===H.data||"in"===H.data){J=!0;break a}}else break;J=!1}if(J)throw Error("attribute in vertex shader uses a name that is a reserved word in glsl 300 es");C.data in F||(F[C.data]=d(u,B,C.data));C.data=F[C.data]}}}for(z=u.length-1;0<=z;--z)v=u[z],"preprocessor"===v.type&&(A=v.data.match(/#extension\s+(.*):/),A?.[1]&&w.has(A[1].trim())&&(A=u[z+1],u.splice(z,A&&"whitespace"===A.type?2:1)),A=v.data.match(/#ifdef\s+(.*)/),
A?.[1]&&w.has(A[1].trim())&&(v.data="#if 1"),A=v.data.match(/#ifndef\s+(.*)/),A?.[1]&&w.has(A[1].trim())&&(v.data="#if 0"));u=a(u);k.shaderTranspiler.enableCache&&r.set(y,u);return u};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/reservedWordsGLSL3":function(){define(function(){return"layout centroid smooth case mat2x2 mat2x3 mat2x4 mat3x2 mat3x3 mat3x4 mat4x2 mat4x3 mat4x4 uint uvec2 uvec3 uvec4 samplerCubeShadow sampler2DArray sampler2DArrayShadow isampler2D isampler3D isamplerCube isampler2DArray usampler2D usampler3D usamplerCube usampler2DArray coherent restrict readonly writeonly resource atomic_uint noperspective patch sample subroutine common partition active filter image1D image2D image3D imageCube iimage1D iimage2D iimage3D iimageCube uimage1D uimage2D uimage3D uimageCube image1DArray image2DArray iimage1DArray iimage2DArray uimage1DArray uimage2DArray image1DShadow image2DShadow image1DArrayShadow image2DArrayShadow imageBuffer iimageBuffer uimageBuffer sampler1DArray sampler1DArrayShadow isampler1D isampler1DArray usampler1D usampler1DArray isampler2DRect usampler2DRect samplerBuffer isamplerBuffer usamplerBuffer sampler2DMS isampler2DMS usampler2DMS sampler2DMSArray isampler2DMSArray usampler2DMSArray trunc round roundEven isnan isinf floatBitsToInt floatBitsToUint intBitsToFloat uintBitsToFloat packSnorm2x16 unpackSnorm2x16 packUnorm2x16 unpackUnorm2x16 packHalf2x16 unpackHalf2x16 outerProduct transpose determinant inverse texture textureSize textureProj textureLod textureOffset texelFetch texelFetchOffset textureProjOffset textureLodOffset textureProjLod textureProjLodOffset textureGrad textureGradOffset textureProjGrad textureProjGradOffset".split(" ")})},
"esri/views/webgl/testUtils":function(){define(["exports"],function(b){b.shaderTranspiler={enableCache:!1};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/AFeatureShader":function(){define("exports ../../../../../../../chunks/tslib.es6 ../../../definitions ../../GraphShaderModule ../../graph/glsl ./EntityStorage ./ShaderHighlight ./ShaderHittest ./utils ./ViewInfo".split(" "),function(b,q,n,g,k,l,a,f,d,c){class e extends g.VertexInput{}
q.__decorate([g.location(0,k.Vec3)],e.prototype,"id",void 0);q.__decorate([g.location(1,k.Float)],e.prototype,"bitset",void 0);q.__decorate([g.location(2,k.Vec2)],e.prototype,"pos",void 0);class h extends g.ComputeVertexInput{}q.__decorate([g.location(14,k.Vec2)],h.prototype,"nextPos1",void 0);q.__decorate([g.location(15,k.Vec2)],h.prototype,"nextPos2",void 0);class x extends g.FragmentInput{}class m extends g.GraphShaderModule{clip(p,t){let w=new k.Float(0);p=this.storage.getFilterFlags(p);w=w.add(k.float(2).multiply(k.float(1).subtract(d.getFilterBit(p,
0))));this.inside?w=w.add(k.float(2).multiply(k.float(1).subtract(d.getFilterBit(p,1)))):this.outside?w=w.add(k.float(2).multiply(d.getFilterBit(p,1))):this.highlight&&(w=w.add(k.float(2).multiply(k.float(1).subtract(this._checkHighlight(p)))));null!=t&&(p=(new k.Float(1)).subtract(k.step(t.x,this.view.currentZoom)),t=k.step(t.y,this.view.currentZoom),w=w.add((new k.Float(2)).multiply(p.add(t))));return w}getFragmentOutput(p,t,w=new k.Float(1/255)){const r=new g.FragmentOutput;r.glFragColor=this._maybeWriteHittest(t)??
this._maybeHighlight(p,w)??p;return r}_maybeHighlight(p,t){return this.highlight?new k.Vec4(p.rgb,k.step(t,p.a)):null}_checkHighlight(p){let t=this._checkHighlightBit(p,0);for(let w=1;w<n.maxHighlightReasons;w++)t=t.add(this._checkHighlightBit(p,w));return k.step(new k.Float(.1),t.add(this.highlight.highlightAll))}_checkHighlightBit(p,t){return d.getHighlightBit(p,t).multiply(d.getBit(this.highlight.activeReasons,t))}maybeRunHittest(p,t,w){if(null==this.hittestRequest)return null;t=this.hittest(p,
t,w);t=k.ifElse(k.greaterThan(t,this.hittestRequest.distance),new k.Float(2),new k.Float(0));w=this.storage.getAttributeDataCoords(p.id);w=d.uvToClip(w);t=t.add(this.clip(p.id,p.zoomRange));p=new k.Vec4(new k.Float(1/255),0,0,0);return{glPointSize:new k.Float(1),glPosition:new k.Vec4(w,t,1),color:p}}_maybeWriteHittest(p){return null!=this.hittestRequest?p.color:null}}q.__decorate([g.define],m.prototype,"inside",void 0);q.__decorate([g.define],m.prototype,"outside",void 0);q.__decorate([g.option(a.ShaderHighlight)],
m.prototype,"highlight",void 0);q.__decorate([g.uniform(l.EntityStorage)],m.prototype,"storage",void 0);q.__decorate([g.uniform(c.ViewInfo)],m.prototype,"view",void 0);q.__decorate([g.option(f.ShaderHittest)],m.prototype,"hittestRequest",void 0);b.AFeatureShader=m;b.BaseHittestVertexInput=h;b.FeatureFragmentInput=x;b.FeatureVertexInput=e;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/EntityStorage":function(){define("exports ../../../../../../../chunks/tslib.es6 ../../../../../../../core/has ../../GraphShaderModule ../../graph/glsl ./utils".split(" "),
function(b,q,n,g,k,l){class a extends g.UniformGroup{getVisualVariableData(f){this._vvData||(f=this.getAttributeDataCoords(f),this._vvData=k.texture2D(this.visualVariableData,f).setDebugName("storage2"));return this._vvData}getAttributeDataCoords(f){if(!this._uv){var d=l.unpackDisplayIdTexel(f);f=this.size;var c=k.int(d.x),e=k.int(d.y).multiply(k.int(256));d=k.int(d.z).multiply(k.int(256)).multiply(k.int(256));e=k.float(c.add(e).add(d));c=k.mod(e,f);e=e.subtract(c).divide(f);this._uv=(new k.Vec2(c,
e)).add(.5).divide(f)}return this._uv}getFilterData(f){f=this.getAttributeDataCoords(f);return k.texture2D(this.filterFlags,f).setDebugName("storage0")}getAnimationData(f){f=this.getAttributeDataCoords(f);return k.texture2D(this.animation,f).setDebugName("storage1")}getVVData(f){return this.getVisualVariableData(f)}getDataDrivenData0(f){f=this.getAttributeDataCoords(f);return k.texture2D(this.dataDriven0,f).setDebugName("storage30")}getDataDrivenData1(f){f=this.getAttributeDataCoords(f);return k.texture2D(this.dataDriven1,
f).setDebugName("storage31")}getDataDrivenData2(f){f=this.getAttributeDataCoords(f);return k.texture2D(this.dataDriven2,f).setDebugName("storage32")}getGPGPUData(f){f=this.getAttributeDataCoords(f);return k.texture2D(this.gpgpu,f).setDebugName("storage4")}getLocalTimeOrigin(f){f=this.getAttributeDataCoords(f);return k.texture2D(this.localTimeOrigin,f).x.setDebugName("storage5")}getFilterFlags(f){return n("webgl-ignores-sampler-precision")?k.ceil(this.getFilterData(f).x.multiply(k.float(255))):this.getFilterData(f).x.multiply(k.float(255))}getLabelVisibility(f){f=
this.getFilterData(f).y.multiply(255);return(new k.Float(1)).subtract(f)}getAnimationValue(f){return this.getAnimationData(f).x}getSizeValue(f){return this.getVisualVariableData(f).x}getColorValue(f){return this.getVisualVariableData(f).y}getOpacityValue(f){return this.getVisualVariableData(f).z}getRotationValue(f){return this.getVisualVariableData(f).w}}q.__decorate([g.uniform(k.Sampler2D)],a.prototype,"filterFlags",void 0);q.__decorate([g.uniform(k.Sampler2D)],a.prototype,"animation",void 0);q.__decorate([g.uniform(k.Sampler2D)],
a.prototype,"gpgpu",void 0);q.__decorate([g.uniform(k.Sampler2D)],a.prototype,"localTimeOrigin",void 0);q.__decorate([g.uniform(k.Sampler2D)],a.prototype,"visualVariableData",void 0);q.__decorate([g.uniform(k.Sampler2D)],a.prototype,"dataDriven0",void 0);q.__decorate([g.uniform(k.Sampler2D)],a.prototype,"dataDriven1",void 0);q.__decorate([g.uniform(k.Sampler2D)],a.prototype,"dataDriven2",void 0);q.__decorate([g.uniform(k.Float)],a.prototype,"size",void 0);b.EntityStorage=a;Object.defineProperty(b,
Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/utils":function(){define(["exports","../../../definitions","../../graph/glsl","./constants"],function(b,q,n,g){function k(l,a){a=n.float(2**a);return n.mod(n.floor(l.divide(a)),n.float(2))}b.clipToUv=function(l){return l.multiply(.5).add(.5)};b.cross2=function(l,a){return l.x.multiply(a.y).subtract(a.x.multiply(l.y))};b.getBit=k;b.getBitBool=function(l,a){return n.greaterThan(k(l,a),n.float(.5))};b.getFilterBit=
function(l,a){return k(l,a+q.maxHighlightReasons)};b.getHighlightBit=function(l,a){return k(l,a)};b.isNan=function(l){return n.equal(l,n.float(g.nanMagicNumber))};b.max4=function(l){return n.max(n.max(n.max(l.x,l.y),l.z),l.w)};b.minusOne=function(l){return l.subtract(new n.Float(1))};b.minusScalar=function(l,a){return l.subtract(new n.Float(a))};b.norm=function(l){return n.divide(l,n.float(255))};b.oneMinus=function(l){return(new n.Float(1)).subtract(l)};b.rand=function(l){const a=n.float(12.9898),
f=n.float(78.233),d=n.float(43758.5453);l=n.dot(l,n.vec2(a,f));l=n.mod(l,n.float(3.14));return n.fract(n.sin(l).multiply(d))};b.rgba2float=function(l){const a=n.vec4(.99609375,255/65536,255/16777216,255/4294967296);return n.dot(l,a)};b.scalarMinus=function(l,a){return(new n.Float(l)).subtract(a)};b.unpackDisplayIdTexel=function(l){const a=k(l.z,7),f=n.float(1).subtract(a),d=l.xyz.subtract(n.vec3(0,0,n.float(128)));return f.multiply(l).add(a.multiply(d))};b.uvToClip=function(l){return l.multiply(2).subtract(1)};
Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/ShaderHighlight":function(){define(["exports","../../../../../../../chunks/tslib.es6","../../GraphShaderModule","../../graph/glsl"],function(b,q,n,g){class k extends n.UniformGroup{}q.__decorate([n.uniform(g.Float)],k.prototype,"activeReasons",void 0);q.__decorate([n.uniform(g.Float)],k.prototype,"highlightAll",void 0);b.ShaderHighlight=k;Object.defineProperty(b,Symbol.toStringTag,
{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/ShaderHittest":function(){define(["exports","../../../../../../../chunks/tslib.es6","../../GraphShaderModule","../../graph/glsl"],function(b,q,n,g){class k extends n.UniformGroup{}q.__decorate([n.uniform(g.Vec2)],k.prototype,"position",void 0);q.__decorate([n.uniform(g.Float)],k.prototype,"distance",void 0);q.__decorate([n.uniform(g.Float)],k.prototype,"smallSymbolDistance",void 0);q.__decorate([n.uniform(g.Float)],k.prototype,
"smallSymbolSizeThreshold",void 0);b.ShaderHittest=k;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/ViewInfo":function(){define(["exports","../../../../../../../chunks/tslib.es6","../../GraphShaderModule","../../graph/glsl"],function(b,q,n,g){class k extends n.UniformGroup{}q.__decorate([n.uniform(g.Mat3)],k.prototype,"displayViewScreenMat3",void 0);q.__decorate([n.uniform(g.Mat3)],k.prototype,"displayViewMat3",void 0);q.__decorate([n.uniform(g.Mat3)],
k.prototype,"displayMat3",void 0);q.__decorate([n.uniform(g.Mat3)],k.prototype,"viewMat3",void 0);q.__decorate([n.uniform(g.Mat3)],k.prototype,"tileMat3",void 0);q.__decorate([n.uniform(g.Float)],k.prototype,"displayZoomFactor",void 0);q.__decorate([n.uniform(g.Float)],k.prototype,"requiredZoomFactor",void 0);q.__decorate([n.uniform(g.Vec2)],k.prototype,"tileOffset",void 0);q.__decorate([n.uniform(g.Float)],k.prototype,"currentScale",void 0);q.__decorate([n.uniform(g.Float)],k.prototype,"currentZoom",
void 0);q.__decorate([n.uniform(g.Float)],k.prototype,"metersPerSRUnit",void 0);q.__decorate([n.uniform(g.Float)],k.prototype,"rotation",void 0);q.__decorate([n.uniform(g.Float)],k.prototype,"pixelRatio",void 0);b.ViewInfo=k;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/ComplexFillShader":function(){define("exports ../../../../../../../chunks/tslib.es6 ../../GraphShaderModule ../../graph/glsl ./AFeatureShader ./constants ./FillShader ./LocalTileOffset ./MosaicInfo ./utils".split(" "),
function(b,q,n,g,k,l,a,f,d,c){function e(t,w){var r=t.view.requiredZoomFactor,y=new g.Vec2(w.width,w.height),z=y.multiply(w.scale).multiply(r),u=w.angle.multiply(l.c256ToRad);const v=g.sin(u);u=g.cos(u);var A=w.id;var B=g.equal(c.getBit(w.bitset,l.bitsetFillRandomPatternOffset),g.float(1));A=c.rgba2float(new g.Vec4(A,0));B=g.ifElse(B,g.mat3(u.divide(z.x),v.divide(z.y),0,g.negate(v.divide(z.x)),u.divide(z.y),0,c.rand(g.vec2(A,0)),c.rand(g.vec2(0,A)),1),g.mat3(u.divide(z.x),v.divide(z.y),0,g.negate(v.divide(z.x)),
u.divide(z.y),0,0,0,1));y=t.localTileOffset.getPatternOffsetAtTileOrigin(y,v,u);r=r.multiply(w.scale).multiply(w.offset.subtract(y)).divide(z);z=new g.Vec3(w.pos,1);r=B.multiply(z).xy.subtract(r);z=w.tlbr.divide(t.mosaicInfo.size.xyxy);y=c.getBit(w.bitset,l.bitsetGenericConsiderAlphaOnly);null!=t.visualVariableColor&&(y=g.ifElse(c.isNan(t.storage.getColorValue(w.id)),new g.Float(0),y));return{tileTextureCoord:r,tlbr:z,sampleAlphaOnly:y}}function h(t,w){var r=g.mod(w.tileTextureCoord,new g.Float(1));
r=g.mix(w.tlbr.xy,w.tlbr.zw,r);t=g.texture2D(t.mosaicInfo.texture,r);t=g.ifElse(g.greaterThan(w.sampleAlphaOnly,new g.Float(.5)),t.aaaa,t);return w.color.multiply(t)}class x extends a.FillVertexInput{}q.__decorate([n.location(5,g.Vec4)],x.prototype,"tlbr",void 0);q.__decorate([n.location(6,g.Float)],x.prototype,"width",void 0);q.__decorate([n.location(7,g.Float)],x.prototype,"height",void 0);q.__decorate([n.location(8,g.Vec2)],x.prototype,"offset",void 0);q.__decorate([n.location(9,g.Vec2)],x.prototype,
"scale",void 0);q.__decorate([n.location(10,g.Float)],x.prototype,"angle",void 0);class m extends k.FeatureFragmentInput{}class p extends a.FillShader{vertex(t,w){return{...super.vertex(t,w),...e(this,t)}}fragment(t){const w=h(this,t);return this.getFragmentOutput(w,t,new g.Float(0))}}q.__decorate([n.uniform(d.MosaicInfo)],p.prototype,"mosaicInfo",void 0);q.__decorate([n.uniform(f.LocalTileOffset)],p.prototype,"localTileOffset",void 0);q.__decorate([q.__param(0,n.input(x)),q.__param(1,n.input(k.BaseHittestVertexInput))],
p.prototype,"vertex",null);q.__decorate([q.__param(0,n.input(m))],p.prototype,"fragment",null);b.ComplexFillFragmentInput=m;b.ComplexFillShader=p;b.ComplexFillVertexInput=x;b.getComplexFillFragmentColor=h;b.getComplexFillVertexData=e;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/FillShader":function(){define("exports ../../../../../../../chunks/tslib.es6 ../../GraphShaderModule ../../graph/glsl ./AFeatureShader ./hittestUtils ./VisualVariableColor ./VisualVariableOpacity ./vvUtils".split(" "),
function(b,q,n,g,k,l,a,f,d){class c extends k.FeatureVertexInput{}q.__decorate([n.location(3,g.Vec4)],c.prototype,"color",void 0);q.__decorate([n.location(4,g.Vec2)],c.prototype,"zoomRange",void 0);class e extends k.AFeatureShader{constructor(){super(...arguments);this.computeAttributes={pos:["nextPos1","nextPos2"]}}vertex(h,x){var m=d.getVisualVariableOpacity(this,h.id);m=d.getVisualVariableColor(this,h.id,h.color).multiply(m);const p=this.view.displayViewScreenMat3.multiply(new g.Vec3(h.pos.xy,
1)),t=this.clip(h.id,h.zoomRange);return{glPosition:new g.Vec4(p.xy,t,1),color:m,...this.maybeRunHittest(h,x,null)}}fragment(h){return this.getFragmentOutput(h.color,h,new g.Float(0))}hittest(h,x){return l.hittestFill(this,h,x)}}q.__decorate([n.option(a.VisualVariableColor)],e.prototype,"visualVariableColor",void 0);q.__decorate([n.option(f.VisualVariableOpacity)],e.prototype,"visualVariableOpacity",void 0);q.__decorate([q.__param(0,n.input(c)),q.__param(1,n.input(k.BaseHittestVertexInput))],e.prototype,
"vertex",null);q.__decorate([q.__param(0,n.input(k.FeatureFragmentInput))],e.prototype,"fragment",null);b.FillShader=e;b.FillVertexInput=c;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/hittestUtils":function(){define(["exports","../../graph/glsl","./constants","./utils"],function(b,q,n,g){function k(c,e){return q.dot(c,q.normalize(e))}function l(c,e,h){var x=h.subtract(e),m=c.subtract(e);m=k(m,x);x=q.clamp(m.divide(q.length(x)),
new q.Float(0),new q.Float(1));return q.distance(c,e.add(x.multiply(h.subtract(e))))}function a(c){c=q.abs(c);return q.step(c.x.add(c.y).add(c.z),new q.Float(1.05))}function f(c,e,h,x){const m=new q.Mat3(h.x.multiply(x.y).subtract(x.x.multiply(h.y)),x.x.multiply(e.y).subtract(e.x.multiply(x.y)),e.x.multiply(h.y).subtract(h.x.multiply(e.y)),h.y.subtract(x.y),x.y.subtract(e.y),e.y.subtract(h.y),x.x.subtract(h.x),e.x.subtract(x.x),h.x.subtract(e.x));var p=e.x.multiply(h.y.subtract(x.y));const t=h.x.multiply(x.y.subtract(e.y));
e=x.x.multiply(e.y.subtract(h.y));p=p.add(t).add(e);return(new q.Float(1)).divide(p).multiply(m.multiply(new q.Vec3(1,c)))}function d(c,e,h,x){var m=h.subtract(e);const p=x.subtract(e);m=g.cross2(m,p);m=q.and(q.lessThan(m,new q.Float(n.epsilonHitTest)),q.greaterThan(m,new q.Float(-n.epsilonHitTest)));return q.cond([q.and(q.not(m),q.equal(a(f(c.xy,e,h,x)),new q.Float(1))),new q.Float(-1)],[!0,()=>{const t=l(c,e,h),w=l(c,h,x),r=l(c,x,e);return q.min(q.min(t,w),r)}])}b.distPointSegment=l;b.distPointTriangle=
d;b.failHittest=function(c){return c.distance.add(1)};b.hittestFill=function(c,e,h){const {viewMat3:x,tileMat3:m}=c.view,p=x.multiply(m);e=p.multiply(new q.Vec3(e.pos,1));const t=p.multiply(new q.Vec3(h.nextPos1,1));h=p.multiply(new q.Vec3(h.nextPos2,1));return d(c.hittestRequest.position,e.xy,t.xy,h.xy)};b.hittestMarker=function(c,e,h){return q.distance(c,h).subtract(e)};b.inTriangle=a;b.projectScalar=k;b.xyToBarycentric=f;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/VisualVariableColor":function(){define(["exports",
"../../../../../../../chunks/tslib.es6","../../GraphShaderModule","../../graph/glsl","./utils"],function(b,q,n,g,k){class l extends n.UniformGroup{getColor(a,f,d){return g.cond([g.or(k.isNan(a),d),f],[g.lessThanEqual(a,this.values.first()),this.colors.first()],[g.greaterThanEqual(a,this.values.last()),this.colors.last()],[!0,()=>{const c=this.values.findIndex(m=>g.greaterThan(m,a));var e=this.values.get(c);const h=c.subtract(1),x=this.values.get(h);e=a.subtract(x).divide(e.subtract(x));return g.mix(this.colors.get(h),
this.colors.get(c),e)}])}}q.__decorate([n.uniform(g.FixedArray.ofType(g.Vec4,8))],l.prototype,"colors",void 0);q.__decorate([n.uniform(g.FixedArray.ofType(g.Float,8))],l.prototype,"values",void 0);b.VisualVariableColor=l;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/VisualVariableOpacity":function(){define(["exports","../../../../../../../chunks/tslib.es6","../../GraphShaderModule","../../graph/glsl","./utils"],function(b,
q,n,g,k){class l extends n.UniformGroup{getOpacity(a){return g.cond([k.isNan(a),new g.Float(1)],[g.lessThanEqual(a,this.opacityValues.first()),this.opacities.first()],[g.greaterThanEqual(a,this.opacityValues.last()),this.opacities.last()],[!0,()=>{const f=this.opacityValues.findIndex(h=>g.greaterThan(h,a));var d=this.opacityValues.get(f);const c=f.subtract(1),e=this.opacityValues.get(c);d=a.subtract(e).divide(d.subtract(e));return g.mix(this.opacities.get(c),this.opacities.get(f),d)}])}}q.__decorate([n.uniform(g.FixedArray.ofType(g.Float,
8))],l.prototype,"opacities",void 0);q.__decorate([n.uniform(g.FixedArray.ofType(g.Float,8))],l.prototype,"opacityValues",void 0);b.VisualVariableOpacity=l;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/vvUtils":function(){define(["exports","../../graph/glsl"],function(b,q){function n(g){return null!=g.visualVariableSizeMinMaxValue||null!=g.visualVariableSizeScaleStops||null!=g.visualVariableSizeStops||null!=g.visualVariableSizeUnitValue}
b.getVisualVariableAngle=function(g,k){if(null==g.visualVariableRotation)return new q.Float(0);k=g.storage.getRotationValue(k);return g.visualVariableRotation.getNormalizedAngle(k)};b.getVisualVariableColor=function(g,k,l,a=new q.Bool(!1)){if(null==g.visualVariableColor)return l;k=g.storage.getColorValue(k);return g.visualVariableColor.getColor(k,l,a)};b.getVisualVariableOpacity=function(g,k){if(null==g.visualVariableOpacity)return new q.Float(1);k=g.storage.getOpacityValue(k);return g.visualVariableOpacity.getOpacity(k)};
b.getVisualVariableRotation=function(g,k){if(null==g.visualVariableRotation)return q.Mat3.identity();k=g.storage.getRotationValue(k);return g.visualVariableRotation.getVVRotationMat3(k)};b.getVisualVariableSize=function(g,k,l){return n(g)?(k=g.storage.getSizeValue(k),g.visualVariableSizeMinMaxValue?.getSize(k,l)??g.visualVariableSizeScaleStops?.getSizeForViewScale(g.view.currentScale)??g.visualVariableSizeStops?.getSize(k,l)??g.visualVariableSizeUnitValue?.getSize(k,l)):l};b.hasVisualVariableSize=
n;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/LocalTileOffset":function(){define(["exports","../../../../../../../chunks/tslib.es6","../../GraphShaderModule","../../graph/glsl","./constants"],function(b,q,n,g,k){class l extends n.UniformGroup{getPatternOffsetAtTileOrigin(a,f=new g.Float(0),d=new g.Float(1)){var c=(new g.Vec2(k.maxRepresentableInt)).divide(a);c=a.multiply(g.fract(this.maxIntsToLocalOrigin.multiply(c))).add(this.tileOffsetFromLocalOrigin).subtract((new g.Float(.5)).multiply(a));
c=new g.Vec2(c.x.multiply(d).subtract(c.y.multiply(f)),c.x.multiply(f).add(c.y.multiply(d)));return g.mod(c,a)}}q.__decorate([n.uniform(g.Vec2)],l.prototype,"tileOffsetFromLocalOrigin",void 0);q.__decorate([n.uniform(g.Vec2)],l.prototype,"maxIntsToLocalOrigin",void 0);b.LocalTileOffset=l;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/MosaicInfo":function(){define(["exports","../../../../../../../chunks/tslib.es6","../../GraphShaderModule",
"../../graph/glsl"],function(b,q,n,g){class k extends n.UniformGroup{}q.__decorate([n.uniform(g.Vec2)],k.prototype,"size",void 0);q.__decorate([n.uniform(g.Sampler2D)],k.prototype,"texture",void 0);b.MosaicInfo=k;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/LineShader":function(){define("exports ../../../../../../../chunks/tslib.es6 ../../GraphShaderModule ../../graph/glsl ./AFeatureShader ./constants ./hittestUtils ./VisualVariableColor ./VisualVariableOpacity ./VisualVariableSizeMinMaxValue ./VisualVariableSizeScaleStops ./VisualVariableSizeStops ./VisualVariableSizeUnitValue ./vvUtils".split(" "),
function(b,q,n,g,k,l,a,f,d,c,e,h,x,m){function p(A){return g.max((new g.Float(l.thinLineWidthFactor)).multiply(g.step(A,new g.Float(l.thinLineHalfWidth))),new g.Float(1))}function t(A,B){const {halfWidth:F,normal:H}=A;A=p(F);const J=g.length(H).multiply(F);return g.clamp(A.multiply(F.subtract(J)).divide(B.add(A).subtract(new g.Float(1))),new g.Float(0),new g.Float(1))}function w(A,B){const {id:F,offset:H,pos:J,normal:E,zoomRange:K}=B,{displayViewScreenMat3:C,displayViewMat3:D}=A.view,G=m.getVisualVariableColor(A,
F,B.color),N=m.getVisualVariableOpacity(A,F);{const {id:Q,halfWidth:R,referenceHalfWidth:Z}=B;m.hasVisualVariableSize(A)?(B=(new g.Float(2)).multiply(Z),B=m.getVisualVariableSize(A,Q,B),B=(new g.Float(.5)).multiply(R.divide(g.max(Z,new g.Float(l.epsilon)))).multiply(B)):B=R}var Y=(new g.Float(.5)).multiply(A.antialiasingControls.antialiasing);Y=g.max(B.add(Y),new g.Float(.45)).add((new g.Float(.1)).multiply(Y));const ca=p(Y).multiply(Y).multiply(H);var ka=D.multiply(new g.Vec3(ca,new g.Float(0)));
ka=C.multiply(new g.Vec3(J,new g.Float(1))).add(ka);A=(new g.Float(2)).multiply(g.step(B,new g.Float(0))).add(A.clip(F,K));ka=new g.Vec4(ka.xy,A,1);A=new g.Vec4(ka.xy,A,1);return{color:G,opacity:N,halfWidth:Y,normal:E,scaledOffset:ca,scaledHalfWidth:B,glPosition:A}}function r(A,B){const {opacity:F,color:H}=A;A=t(A,B);return F.multiply(H).multiply(A)}class y extends k.FeatureVertexInput{}q.__decorate([n.location(3,g.Vec4)],y.prototype,"color",void 0);q.__decorate([n.location(4,g.Vec2)],y.prototype,
"offset",void 0);q.__decorate([n.location(5,g.Vec2)],y.prototype,"normal",void 0);q.__decorate([n.location(6,g.Float)],y.prototype,"halfWidth",void 0);q.__decorate([n.location(7,g.Float)],y.prototype,"referenceHalfWidth",void 0);q.__decorate([n.location(8,g.Vec2)],y.prototype,"zoomRange",void 0);class z extends k.FeatureFragmentInput{}class u extends n.UniformGroup{}q.__decorate([n.uniform(g.Float)],u.prototype,"antialiasing",void 0);q.__decorate([n.uniform(g.Float)],u.prototype,"blur",void 0);class v extends k.AFeatureShader{constructor(){super(...arguments);
this.computeAttributes={pos:["nextPos1","nextPos2"]}}vertex(A,B){const F=w(this,A);return{...F,...this.maybeRunHittest(A,B,F.halfWidth)}}fragment(A){const B=r(A,this.antialiasingControls.blur);return this.getFragmentOutput(B,A)}hittest(A,B,F){const {viewMat3:H,tileMat3:J}=this.view;var E=H.multiply(J);A=E.multiply(new g.Vec3(A.pos,1));const K=E.multiply(new g.Vec3(B.nextPos1,1));B=E.multiply(new g.Vec3(B.nextPos2,1));const {distance:C,smallSymbolDistance:D,smallSymbolSizeThreshold:G}=this.hittestRequest;
E=g.step(F,G.multiply(.5)).multiply(C.subtract(D));const N=this.hittestRequest.position;return g.min(a.distPointSegment(N,A.xy,K.xy),a.distPointSegment(N,A.xy,B.xy)).subtract(F).add(E)}}q.__decorate([n.uniform(u)],v.prototype,"antialiasingControls",void 0);q.__decorate([n.option(f.VisualVariableColor)],v.prototype,"visualVariableColor",void 0);q.__decorate([n.option(d.VisualVariableOpacity)],v.prototype,"visualVariableOpacity",void 0);q.__decorate([n.option(c.VisualVariableSizeMinMaxValue)],v.prototype,
"visualVariableSizeMinMaxValue",void 0);q.__decorate([n.option(e.VisualVariableSizeScaleStops)],v.prototype,"visualVariableSizeScaleStops",void 0);q.__decorate([n.option(h.VisualVariableSizeStops)],v.prototype,"visualVariableSizeStops",void 0);q.__decorate([n.option(x.VisualVariableSizeUnitValue)],v.prototype,"visualVariableSizeUnitValue",void 0);q.__decorate([q.__param(0,n.input(y)),q.__param(1,n.input(k.BaseHittestVertexInput))],v.prototype,"vertex",null);q.__decorate([q.__param(0,n.input(z))],
v.prototype,"fragment",null);b.AntialiasingControls=u;b.LineFragmentInput=z;b.LineShader=v;b.LineVertexInput=y;b.getLineAntialiasing=t;b.getLineFragmentColor=r;b.getLineVertexData=w;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/VisualVariableSizeMinMaxValue":function(){define(["exports","../../../../../../../chunks/tslib.es6","../../GraphShaderModule","../../graph/glsl","./utils"],function(b,q,n,g,k){class l extends n.UniformGroup{getSize(a,
f){const d=this.minMaxValueAndSize.xy,c=this.minMaxValueAndSize.zw;return g.ifElse(k.isNan(a),f,()=>{var e=a.subtract(d.x).divide(d.y.subtract(d.x));e=g.clamp(e,new g.Float(0),new g.Float(1));return c.x.add(e.multiply(c.y.subtract(c.x)))})}}q.__decorate([n.uniform(g.Vec4)],l.prototype,"minMaxValueAndSize",void 0);b.VisualVariableSizeMinMaxValue=l;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/VisualVariableSizeScaleStops":function(){define(["exports",
"../../../../../../../chunks/tslib.es6","../../GraphShaderModule","../../graph/glsl"],function(b,q,n,g){class k extends n.UniformGroup{getSizeForViewScale(l){return g.cond([g.lessThanEqual(l,this.values.first()),this.sizes.first()],[g.greaterThanEqual(l,this.values.last()),this.sizes.last()],[!0,()=>{const a=this.values.findIndex(e=>g.greaterThan(e,l));var f=this.values.get(a);const d=a.subtract(1),c=this.values.get(d);f=l.subtract(c).divide(f.subtract(c));return g.mix(this.sizes.get(d),this.sizes.get(a),
f)}])}}q.__decorate([n.uniform(g.FixedArray.ofType(g.Float,8))],k.prototype,"sizes",void 0);q.__decorate([n.uniform(g.FixedArray.ofType(g.Float,8))],k.prototype,"values",void 0);b.VisualVariableSizeScaleStops=k;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/VisualVariableSizeStops":function(){define(["exports","../../../../../../../chunks/tslib.es6","../../GraphShaderModule","../../graph/glsl","./utils"],function(b,q,n,g,
k){class l extends n.UniformGroup{getSize(a,f){const d=g.cond([k.isNan(a),f],[g.lessThanEqual(a,this.values.first()),this.sizes.first()],[g.greaterThanEqual(a,this.values.last()),this.sizes.last()],[!0,()=>{const c=this.values.findIndex(m=>g.greaterThan(m,a));var e=this.values.get(c);const h=c.subtract(1),x=this.values.get(h);e=a.subtract(x).divide(e.subtract(x));return g.mix(this.sizes.get(h),this.sizes.get(c),e)}]);return g.ifElse(k.isNan(d),f,d)}}q.__decorate([n.uniform(g.FixedArray.ofType(g.Float,
8))],l.prototype,"sizes",void 0);q.__decorate([n.uniform(g.FixedArray.ofType(g.Float,8))],l.prototype,"values",void 0);b.VisualVariableSizeStops=l;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/VisualVariableSizeUnitValue":function(){define(["exports","../../../../../../../chunks/tslib.es6","../../GraphShaderModule","../../graph/glsl","./utils"],function(b,q,n,g,k){class l extends n.UniformGroup{getSize(a,f){return g.ifElse(k.isNan(a),
f,a.multiply(this.unitValueToPixelsRatio))}}q.__decorate([n.uniform(g.Float)],l.prototype,"unitValueToPixelsRatio",void 0);b.VisualVariableSizeUnitValue=l;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/OutlineFillShader":function(){define("exports ../../../../../../../chunks/tslib.es6 ../../GraphShaderModule ../../graph/glsl ./AFeatureShader ./constants ./hittestUtils ./LineShader ./utils ./VisualVariableColor ./VisualVariableOpacity ./VisualVariableSizeMinMaxValue ./VisualVariableSizeScaleStops ./VisualVariableSizeStops ./VisualVariableSizeUnitValue ./vvUtils".split(" "),
function(b,q,n,g,k,l,a,f,d,c,e,h,x,m,p,t){function w(v,A,B){const {id:F,bitset:H}=A,J=d.getBit(H,l.bitsetTypeFillOutline),E=g.greaterThan(J,new g.Float(.5)),K=f.getLineVertexData(v,A),C=g.ifElse(E,K.halfWidth,new g.Float(0));var D=t.getVisualVariableOpacity(v,F),G=t.getVisualVariableColor(v,F,A.color);D=g.ifElse(E,A.color,G.multiply(D));G=v.view.displayViewScreenMat3.multiply(new g.Vec3(A.pos.xy,1));const N=v.clip(A.id);G=new g.Vec4(G.xy,N,1);G=g.ifElse(E,K.glPosition,G);v=B&&v.maybeRunHittest(A,
B,E);return{isOutline:J,color:D,opacity:new g.Float(1),halfWidth:C,normal:K.normal,glPosition:G,...v}}class r extends k.FeatureVertexInput{}q.__decorate([n.location(3,g.Vec2)],r.prototype,"offset",void 0);q.__decorate([n.location(4,g.Vec4)],r.prototype,"color",void 0);q.__decorate([n.location(5,g.Vec2)],r.prototype,"normal",void 0);q.__decorate([n.location(6,g.Float)],r.prototype,"halfWidth",void 0);q.__decorate([n.location(7,g.Float)],r.prototype,"referenceHalfWidth",void 0);q.__decorate([n.location(8,
g.Vec2)],r.prototype,"zoomRange",void 0);class y extends f.LineFragmentInput{}class z extends k.AFeatureShader{constructor(){super(...arguments);this.computeAttributes={pos:["nextPos1","nextPos2"]}}}q.__decorate([n.uniform(f.AntialiasingControls)],z.prototype,"antialiasingControls",void 0);q.__decorate([n.option(c.VisualVariableColor)],z.prototype,"visualVariableColor",void 0);q.__decorate([n.option(e.VisualVariableOpacity)],z.prototype,"visualVariableOpacity",void 0);q.__decorate([n.option(h.VisualVariableSizeMinMaxValue)],
z.prototype,"visualVariableSizeMinMaxValue",void 0);q.__decorate([n.option(x.VisualVariableSizeScaleStops)],z.prototype,"visualVariableSizeScaleStops",void 0);q.__decorate([n.option(m.VisualVariableSizeStops)],z.prototype,"visualVariableSizeStops",void 0);q.__decorate([n.option(p.VisualVariableSizeUnitValue)],z.prototype,"visualVariableSizeUnitValue",void 0);class u extends z{vertex(v,A){return w(this,v,A)}fragment(v){const {color:A,isOutline:B}=v;var F=g.greaterThan(B,new g.Float(.5)),H=f.getLineFragmentColor(v,
this.antialiasingControls.blur);H=g.ifElse(F,H,A);F=g.ifElse(F,new g.Float(1/255),new g.Float(0));return this.getFragmentOutput(H,v,F)}hittest(v,A,B){return g.ifElse(B,a.failHittest(this.hittestRequest),a.hittestFill(this,v,A))}}q.__decorate([q.__param(0,n.input(r)),q.__param(1,n.input(k.BaseHittestVertexInput))],u.prototype,"vertex",null);q.__decorate([q.__param(0,n.input(y))],u.prototype,"fragment",null);b.AOutlineFillShader=z;b.OutlineFillFragmentInput=y;b.OutlineFillShader=u;b.OutlineFillVertexInput=
r;b.getOutlineFillVertexData=w;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/PatternOutlineFillShader":function(){define("exports ../../../../../../../chunks/tslib.es6 ../../GraphShaderModule ../../graph/glsl ./AFeatureShader ./LineShader ./LocalTileOffset ./MosaicInfo ./OutlineFillShader ./PatternFillShader".split(" "),function(b,q,n,g,k,l,a,f,d,c){class e extends d.OutlineFillVertexInput{}q.__decorate([n.location(9,g.Vec4)],
e.prototype,"tlbr",void 0);q.__decorate([n.location(10,g.Float)],e.prototype,"inverseRasterizationScale",void 0);class h extends d.OutlineFillFragmentInput{}class x extends d.OutlineFillShader{vertex(m,p){return{...d.getOutlineFillVertexData(this,m,p),...c.getPatternFillVertexData(this,m)}}fragment(m){var {isOutline:p}=m;p=g.greaterThan(p,new g.Float(.5));var t=l.getLineFragmentColor(m,this.antialiasingControls.blur);const w=c.getPatternFillFragmentColor(m,this.mosaicInfo);t=g.ifElse(p,t,w);p=g.ifElse(p,
new g.Float(1/255),new g.Float(0));return this.getFragmentOutput(t,m,p)}}q.__decorate([n.uniform(f.MosaicInfo)],x.prototype,"mosaicInfo",void 0);q.__decorate([n.uniform(a.LocalTileOffset)],x.prototype,"localTileOffset",void 0);q.__decorate([q.__param(0,n.input(e)),q.__param(1,n.input(k.BaseHittestVertexInput))],x.prototype,"vertex",null);q.__decorate([q.__param(0,n.input(h))],x.prototype,"fragment",null);b.PatternOutlineFillFragmentInput=h;b.PatternOutlineFillShader=x;b.PatternOutlineFillVertexInput=
e;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/PatternFillShader":function(){define("exports ../../../../../../../chunks/tslib.es6 ../../GraphShaderModule ../../graph/glsl ./AFeatureShader ./FillShader ./LocalTileOffset ./MosaicInfo".split(" "),function(b,q,n,g,k,l,a,f){function d(m,p){var t=p.tlbr.xy,w=p.tlbr.zw,r=w.x.subtract(t.x);t=t.y.subtract(w.y);r=(new g.Vec2(r,t)).multiply(p.inverseRasterizationScale);t=r.multiply(m.view.requiredZoomFactor);
w=new g.Float(1);const y=new g.Float(0);w=new g.Mat3(w.divide(t.x),y.divide(t.y),0,g.negate(y.divide(t.x)),w.divide(t.y),0,0,0,1);r=m.localTileOffset.getPatternOffsetAtTileOrigin(r).divide(t);t=new g.Vec3(p.pos,1);r=w.multiply(t).xy.subtract(r);m=p.tlbr.divide(m.mosaicInfo.size.xyxy);return{tileTextureCoord:r,tlbr:m}}function c(m,p){var t=g.mod(m.tileTextureCoord,new g.Float(1));t=g.mix(m.tlbr.xy,m.tlbr.zw,t);p=g.texture2D(p.texture,t);return m.color.multiply(p)}class e extends l.FillVertexInput{}
q.__decorate([n.location(5,g.Vec4)],e.prototype,"tlbr",void 0);q.__decorate([n.location(6,g.Float)],e.prototype,"inverseRasterizationScale",void 0);class h extends k.FeatureFragmentInput{}class x extends l.FillShader{vertex(m,p){return{...super.vertex(m,p),...d(this,m)}}fragment(m){const p=c(m,this.mosaicInfo);return this.getFragmentOutput(p,m,new g.Float(0))}}q.__decorate([n.uniform(f.MosaicInfo)],x.prototype,"mosaicInfo",void 0);q.__decorate([n.uniform(a.LocalTileOffset)],x.prototype,"localTileOffset",
void 0);q.__decorate([q.__param(0,n.input(e)),q.__param(1,n.input(k.BaseHittestVertexInput))],x.prototype,"vertex",null);q.__decorate([q.__param(0,n.input(h))],x.prototype,"fragment",null);b.PatternFillFragmentInput=h;b.PatternFillShader=x;b.PatternFillVertexInput=e;b.getPatternFillFragmentColor=c;b.getPatternFillVertexData=d;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/fill/PatternOutlineFillMeshWriter":function(){define(["exports",
"../../../../../../../geometry/GeometryCursor","./OutlineFillMeshWriter","./PatternFillMeshWriter"],function(b,q,n,g){const k={optionalAttributes:g.patternFillVertexSpec.optionalAttributes,createComputedParams:d=>d,attributes:{...g.patternFillVertexSpec.attributes,...n.outlineFillVertexSpec_Fill.attributes}},l={optionalAttributes:g.patternFillVertexSpec.optionalAttributes,createComputedParams:d=>d,attributes:{...g.patternFillVertexSpec.attributes,...n.outlineFillVertexSpec_Outline.attributes}};class a extends n.OutlineFillOutlineMeshWriter{constructor(){super(...arguments);
this.vertexSpec=l}}class f extends n.OutlineFillMeshWriter{constructor(){super(...arguments);this.vertexSpec=k}_createOutlineWriter(d,c,e,h){return new a(d,c,e,h)}_write(d,c,e){e=e?.asOptimized()??c.readGeometryForDisplay();if(e=this._clip(e))d.recordStart(this.instanceId,this.attributeLayout,this.evaluatedMeshParams.sprite?.textureBinding),this._writeGeometry(d,c,e),this._lineMeshWriter.writeLineVertices(d,q.GeometryCursor.fromOptimizedCIM(e,"esriGeometryPolyline"),c),d.recordEnd()}ensurePacked(d,
c,e){super.ensurePacked(d,c,e);this._lineMeshWriter.ensurePacked(d,c,e)}enqueueRequest(d,c,e){super.enqueueRequest(d,c,e);this._lineMeshWriter.enqueueRequest(d,c,e)}async loadDependencies(){await Promise.all([super.loadDependencies(),this._lineMeshWriter.loadDependencies()])}}b.PatternOutlineFillMeshWriter=f;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/heatmap/HeatmapMeshWriter":function(){define(["exports","../mesh/MeshWriter",
"../../../../../../webgl/enums"],function(b,q,n){const g={createComputedParams:l=>l,optionalAttributes:{},attributes:{pos:{type:n.DataType.SHORT,count:2,pack:"position",packPrecisionFactor:10},id:{type:n.DataType.UNSIGNED_BYTE,count:3,pack:"id"},bitset:{type:n.DataType.UNSIGNED_BYTE,count:1},offset:{type:n.DataType.BYTE,count:2,packAlternating:{count:4,pack:()=>[[-1,-1],[1,-1],[-1,1],[1,1]]}}}};class k extends q.MeshWriter{constructor(){super(...arguments);this.vertexSpec=g}_write(l,a){l.recordStart(this.instanceId,
this.attributeLayout);const f=a.getDisplayId();if("esriGeometryPoint"===a.geometryType){const d=a.readXForDisplay();a=a.readYForDisplay();this._writeQuad(l,f,d,a)}else"esriGeometryMultipoint"===a.geometryType&&a.readGeometryForDisplay()?.forEachVertex((d,c)=>{0<=d&&512>=d&&0<=c&&512>=c&&this._writeQuad(l,f,d,c)});l.recordEnd()}_writeQuad(l,a,f,d){const c=l.vertexCount();this._writeVertex(l,a,f,d);l.indexWrite(c+0);l.indexWrite(c+1);l.indexWrite(c+2);l.indexWrite(c+1);l.indexWrite(c+3);l.indexWrite(c+
2)}}b.HeatmapMeshWriter=k;b.heatmapVertexSpec=g;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/labels/LabelMeshWriter":function(){define("exports ../../../../../../../core/MapUtils ../../../../../../../core/screenUtils ../../../../../../../core/libs/gl-matrix-2/math/mat2d ../../../../../../../core/libs/gl-matrix-2/factories/mat2df32 ../../../../../../../core/libs/gl-matrix-2/math/vec2 ../../../../../../../core/libs/gl-matrix-2/factories/vec2f32 ../../../../../../../core/libs/gl-matrix-2/factories/vec2f64 ../../../../../../../layers/graphics/featureConversionUtils ../../../../../../../layers/graphics/OptimizedGeometry ../../../alignmentUtils ../../../definitions ../../../DisplayId ../../../collisions/LabelMetric ../../../mesh/templates/segmentUtils ../fill/meshWriterUtils ../text/TextMeshWriter".split(" "),
function(b,q,n,g,k,l,a,f,d,c,e,h,x,m,p,t,w){function r(u,v,A){const {coords:B,lengths:F}=v;v=f.create();const H=f.create(),J=f.create(),E=f.create(),K=f.create(),C=f.create();let D=0;for(let N=0;N<F.length;N++){const Y=F[N];for(let ca=0;ca<Y;ca++){var G=2*(ca+D-1);const ka=2*(ca+D),Q=2*(ca+D+1);0<ca?l.set(v,B[G],B[G+1]):l.set(v,0,0);l.set(H,B[ka],B[ka+1]);ca<Y-1?l.set(J,B[Q],B[Q+1]):l.set(J,0,0);0===ca?l.set(E,0,0):(l.sub(E,H,v),l.normalize(E,E),l.set(E,E[1],-E[0]));ca===Y-1?l.set(K,0,0):(l.sub(K,
J,H),l.normalize(K,K),l.set(K,K[1],-K[0]));l.add(C,E,K);l.normalize(C,C);G=C[0]*K[0]+C[1]*K[1];0!==G&&l.scale(C,C,G);l.scale(C,C,A);u.coords.push(H[0]+C[0],H[1]+C[1])}u.lengths.push(Y);D+=Y}return u}const y=q.memoize(u=>{let v=0;if(0===u)return Infinity;for(;!(u%2);)v++,u/=2;return v});class z extends w.TextMeshWriter{constructor(){super(...arguments);this._zoomLevel=0}_write(u,v,A,B){this._zoomLevel=B||0;if(null!=A)throw Error("InternalError: EffectGeometry not support for LabelMeshWriter");switch(v.geometryType){case "esriGeometryPoint":A=
v.readXForDisplay();B=v.readYForDisplay();this._writePoint(u,A,B,v);break;case "esriGeometryEnvelope":case "esriGeometryPolygon":case "esriGeometryMultipoint":A=v.readCentroidForDisplay();if(!A)break;const [F,H]=A.coords;this._writePoint(u,F,H,v);break;case "esriGeometryPolyline":this._writeLines(u,v)}}_createLineLabelMetric(u,v,A,B){u=x.getDisplayIdTexel(u);return new m.LabelMetric(u,v,A,"right"===this.evaluatedMeshParams.horizontalAlignment?-1:1,"bottom"===this.evaluatedMeshParams.verticalAlignment?
-1:1,this.evaluatedMeshParams.scaleInfo?.maxScale??0,this.evaluatedMeshParams.scaleInfo?.minScale??0,B??null)}_writePoint(u,v,A,B){const F=this._getShaping();if(F){var H=B.getDisplayId(),J=e.getXAnchorDirection(this.evaluatedMeshParams.horizontalAlignment),E=e.getYAnchorDirection(this.evaluatedMeshParams.verticalAlignment),K=this.evaluatedMeshParams.scaleInfo?.maxScale??0,C=this.evaluatedMeshParams.scaleInfo?.minScale??0;B=x.getDisplayIdTexel(B.getDisplayId());var D=this._getPointReferenceBounds()||
{offsetX:0,offsetY:0,size:0};u.metricStart(new m.LabelMetric(B,v,A,J,E,K,C,D));this._writeGlyphs(u,H,v,A,F,0,D);u.metricBoxWrite(F.boundsT);u.metricEnd()}}_getPointReferenceBounds(){if(!this._references)return null;for(const u of this._references){const v=u.getBoundsInfo();if(v)return v}return null}_writeLines(u,v){const {scaleInfo:A,verticalAlignment:B}=this.evaluatedMeshParams;var F=this.evaluatedMeshParams.repeatLabelDistance||128;const H=this._getShaping("middle");if(H){var J=(E,K,C,D)=>this._placeSubdivGlyphs(E,
K,C,D);F=(H.bounds.width+F)/2;this._current={out:u,id:v.getDisplayId(),shaping:H,zoomRange:t.getMinMaxZoom(A,this.getTileInfo()),referenceBounds:this._getPointReferenceBounds()||{offsetX:0,offsetY:0,size:0},offsetDirection:null};(this._verticalPlacement="bottom"===B?"above":"top"===B?"below":null)?this._writeAboveAndBelowAlong(v,J,F):this._writeCenterAlong(v,J,F)}}_writeAboveAndBelowAlong(u,v,A){const {repeatLabel:B}=this.evaluatedMeshParams;var {shaping:F}=this._current,H=F.bounds.halfHeight;if(u=
u.readGeometryForDisplay()){var J=new c;d.generalizeOptimizedGeometry(J,u,!1,!1,"esriGeometryPolyline",1);u=r(new c,J,H);H=r(new c,J,-H);H=d.convertToGeometry(H,"esriGeometryPolyline",!1,!1);u=d.convertToGeometry(u,"esriGeometryPolyline",!1,!1);u=p.smoothPaths(u.paths,F.bounds.width);F=p.smoothPaths(H.paths,F.bounds.width);this._current.offsetDirection="above";for(const E of u)p.pathDivide(E,A,v,!!B);this._current.offsetDirection="below";for(const E of F)p.pathDivide(E,A,v,!!B)}}_writeCenterAlong(u,
v,A){const {repeatLabel:B}=this.evaluatedMeshParams,{shaping:F}=this._current;u=p.smoothPaths(u.readLegacyGeometryForDisplay().paths,F.bounds.width);for(const H of u)p.pathDivide(H,A,v,!!B)}_placeSubdivGlyphs(u,v,A,B){const {allowOverrun:F,labelPosition:H,repeatLabelDistance:J}=this.evaluatedMeshParams,E=this._current.zoomRange[0];var K=y(v),C=this._current.shaping.bounds.width/2,D=Math.sqrt(J||128)/2;A=Math.min(A,B-A);C=this._current.shaping.isMultiline?w.maxLabelZoom:Math.log2(A/(D+C/2));K=Math.max(E,
this._zoomLevel+1-(0===v?C:Math.min(K,C)));C=this._zoomLevel-K;D=this._current.shaping.bounds.width/2*2**C;this._current.shaping.isMultiline?0===v&&this._placeStraight(u,K):F&&0>C?this._placeStraightAlong(u,E):"parallel"===H?this._placeStraightAlong(u,K):"curved"===H&&this._placeCurved(u,K,D)}_placeStraight(u,v){const {out:A,id:B,shaping:F,referenceBounds:H}=this._current,{x:J,y:E}=u;A.metricStart(this._createLineLabelMetric(B,J,E));A.metricBoxWrite(F.boundsT);const K=(180/Math.PI*u.angle+180)%360;
this._writeGlyphs(A,B,J,E,F,0,H,{clipAngle:180/Math.PI*u.angle%360,mapAligned:!0,isLineLabel:!0,minZoom:v});this._writeGlyphs(A,B,J,E,F,0,H,{clipAngle:K,mapAligned:!0,isLineLabel:!0,minZoom:v});A.metricEnd()}_placeCurved(u,v,A){const {out:B,id:F}=this._current;B.metricStart(this._createLineLabelMetric(F,u.x,u.y));const H=u.clone(),J=180/Math.PI*u.angle%360,E=(180/Math.PI*u.angle+180)%360;this._verticalPlacement&&this._verticalPlacement!==this._current.offsetDirection||(this._placeFirst(H,v,1,J),this._placeBack(u,
H,v,A,1,J),this._placeForward(u,H,v,A,1,J));this._verticalPlacement&&this._verticalPlacement===this._current.offsetDirection||(this._placeFirst(H,v,0,E),this._placeBack(u,H,v,A,0,E),this._placeForward(u,H,v,A,0,E));B.metricEnd()}_placeStraightAlong(u,v){const {out:A,id:B,shaping:F,zoomRange:H,referenceBounds:J}=this._current,{boxBorderLineColor:E,boxBackgroundColor:K}=this.evaluatedMeshParams,C=u.clone(),D=180/Math.PI*u.angle%360,G=(180/Math.PI*u.angle+180)%360;var N=0<F.glyphs.length&&!(!E&&!K);
A.metricStart(this._createLineLabelMetric(B,u.x,u.y));if(N){var Y=Math.max(v,H[0],0),ca=Math.min(w.maxLabelZoom,H[1]);N=g.fromRotation(k.create(),-u.angle);Y={minZoom:Y,maxZoom:ca,clipAngle:D,mapAligned:!0,isLineLabel:!0};ca=n.pt2px(this.evaluatedMeshParams.offsetX);const Q=n.pt2px(this.evaluatedMeshParams.offsetY);if(!this._verticalPlacement||this._verticalPlacement===this._current.offsetDirection){var ka=a.fromValues(ca,-1*Q);const [R,Z]=F.shapeBackground(g.translate(k.create(),N,ka));A.recordStart(this.instanceId,
this.attributeLayout,F.glyphs[0].textureBinding);ka=2*Math.max(R.width,R.height);A.recordBounds(u.x+R.x,u.y+R.y,ka,ka);this._writeTextBox(A,B,u.x,u.y,Z,J,Y);A.recordEnd()}if(!this._verticalPlacement||this._verticalPlacement!==this._current.offsetDirection){ca=a.fromValues(ca,Q);const [R,Z]=F.shapeBackground(g.translate(k.create(),N,ca));Y.clipAngle=G;A.recordStart(this.instanceId,this.attributeLayout,F.glyphs[0].textureBinding);N=2*Math.max(R.width,R.height);A.recordBounds(u.x+R.x,u.y+R.y,N,N);this._writeTextBox(A,
B,u.x,u.y,Z,J,Y);A.recordEnd()}}this._verticalPlacement&&this._verticalPlacement!==this._current.offsetDirection||this._placeFirst(C,v,1,D,!0);this._verticalPlacement&&this._verticalPlacement===this._current.offsetDirection||this._placeFirst(C,v,0,G,!0);A.metricEnd()}_placeBack(u,v,A,B,F,H){const J=u.clone();for(u=u.backwardLength+0;J.prev()&&!(u>=B);)this._placeOnSegment(J,v,u,A,-1,F,H),u+=J.length+0}_placeForward(u,v,A,B,F,H){const J=u.clone();for(u=u.remainingLength+0;J.next()&&!(u>=B);)this._placeOnSegment(J,
v,u,A,1,F,H),u+=J.length+0}_placeFirst(u,v,A,B,F=!1){const {out:H,id:J,shaping:E,zoomRange:K,referenceBounds:C}=this._current;var D=E.glyphs;for(const G of D)D=G.x>E.bounds.x?A:1-A,D=Math.max(0,this._zoomLevel+Math.log2(Math.abs(G.x+G.width/2-E.bounds.x)/(D*u.remainingLength+(1-D)*u.backwardLength))),D=Math.max(v,F?0:D),G.maxZoom=Math.min(K[1],w.maxLabelZoom),G.angle=u.angle+(1-A)*Math.PI,G.minZoom=Math.max(K[0],D),this._writeLineGlyph(H,J,u.x,u.y,E.bounds,G,B,C,!0),(A||this._current.offsetDirection)&&
this._isVisible(G.minZoom,G.maxZoom)&&H.metricBoxWrite(G.bounds)}_placeOnSegment(u,v,A,B,F,H,J){const {out:E,id:K,shaping:C,referenceBounds:D}=this._current;var G=C.glyphs;v=u.x+u.dx/u.length*-F*A;var N=u.y+u.dy/u.length*-F*A;for(const ca of G)if((G=ca.x>C.bounds.x?H:1-H)&&1===F||!G&&-1===F){var Y=Math.abs(ca.x+ca.width/2-C.bounds.x);G=Math.max(0,this._zoomLevel+Math.log2(Y/A)-.1);Y=Math.max(B,this._zoomLevel+Math.log2(Y/(A+u.length+0)));0!==G&&(ca.angle=u.angle+(1-H)*Math.PI,ca.minZoom=Y,ca.maxZoom=
G,this._writeLineGlyph(E,K,v,N,C.bounds,ca,J,D,!0),(H||this._current.offsetDirection)&&this._isVisible(ca.minZoom,ca.maxZoom)&&E.metricBoxWrite(ca.bounds))}}_writeLineGlyph(u,v,A,B,F,H,J,E,K){const C=A+F.x,D=B+F.y;F=2*Math.max(F.width,F.height)*(this.evaluatedMeshParams.minPixelBuffer?this.evaluatedMeshParams.minPixelBuffer/this._textMeshTransformProps.fontSize:1);u.recordStart(this.instanceId,this.attributeLayout,H.textureBinding);u.recordBounds(C,D,F,F);const {texcoords:G,offsets:N}=H,{fontSize:Y,
haloSize:ca,outlineSize:ka}=this._textMeshTransformProps;this._writeQuad(u,v,A,B,{texcoords:G,offsets:N,fontSize:Y,haloSize:ca,outlineSize:ka,color:t.processColorInput(this.evaluatedMeshParams.color),isBackground:!1,referenceBounds:E,minZoom:Math.max(this._current.zoomRange[0],H.minZoom),maxZoom:Math.min(this._current.zoomRange[1],H.maxZoom),clipAngle:J,mapAligned:K,isLineLabel:!0});u.recordEnd()}_isVisible(u,v){const A=Math.floor(this._zoomLevel*h.minMaxZoomPrecisionFactor)/h.minMaxZoomPrecisionFactor;
return u<=A&&A<=v}}b.LabelMeshWriter=z;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/featureConversionUtils":function(){define("exports ../../core/Error ../../core/Logger ../../core/maybe ../../geometry/support/aaBoundingBox ../../geometry/support/aaBoundingRect ../../geometry/support/jsonUtils ./OptimizedFeature ./OptimizedFeatureSet ./OptimizedGeometry".split(" "),function(b,q,n,g,k,l,a,f,d,c){function e(S,X){return S?X?4:3:X?3:2}function h(S,X,ba,la){if(S){if(ba)return X&&
la?L:wa;if(X&&la)return M}else if(X&&la)return wa;return va}function x({scale:S,translate:X},ba){return Math.round((ba-X[0])/S[0])}function m({scale:S,translate:X},ba){return Math.round((X[1]-ba)/S[1])}function p({scale:S,translate:X},ba,la){return ba*S[la]+X[la]}function t(S){S=S.coords;return{x:S[0],y:S[1]}}function w(S,X){S.coords[0]=X.x;S.coords[1]=X.y;return S}function r(S){S=S.coords;return{x:S[0],y:S[1],z:S[2]}}function y(S,X){S.coords[0]=X.x;S.coords[1]=X.y;S.coords[2]=X.z;return S}function z(S){S=
S.coords;return{x:S[0],y:S[1],m:S[2]}}function u(S,X){S.coords[0]=X.x;S.coords[1]=X.y;S.coords[2]=X.m;return S}function v(S){S=S.coords;return{x:S[0],y:S[1],z:S[2],m:S[3]}}function A(S,X){S.coords[0]=X.x;S.coords[1]=X.y;S.coords[2]=X.z;S.coords[3]=X.m;return S}function B(S,X){return S&&X?A:S?y:X?u:w}function F(S,X,ba,la,pa){ba=B(ba,la);for(const {geometry:O,attributes:ea}of X)X=null!=O?ba(new c,O):null,S.push(new f.OptimizedFeature(X,ea,null,pa?ea[pa]:void 0));return S}function H(S,X,ba=B(null!=X.z,
null!=X.m)){return ba(S,X)}function J(S,X,ba,la){for(const {geometry:pa,attributes:O}of X)S.push({attributes:O,geometry:null!=pa?E(pa,ba,la):null});return S}function E(S,X,ba){if(null==S)return null;const la=e(X,ba),pa=[];for(let O=0;O<S.coords.length;O+=la){const ea=[];for(let na=0;na<la;na++)ea.push(S.coords[O+na]);pa.push(ea)}return X?ba?{points:pa,hasZ:X,hasM:ba}:{points:pa,hasZ:X}:ba?{points:pa,hasM:ba}:{points:pa}}function K(S,X,ba,la,pa){ba=e(ba,la);for(const {geometry:O,attributes:ea}of X)X=
null!=O?C(new c,O,ba):null,S.push(new f.OptimizedFeature(X,ea,null,pa?ea[pa]:void 0));return S}function C(S,X,ba=e(X.hasZ,X.hasM)){S.lengths[0]=X.points.length;const la=S.coords;let pa=0;for(const O of X.points)for(X=0;X<ba;X++)la[pa++]=O[X];return S}function D(S,X,ba){if(!S)return null;const la=e(X,ba),{coords:pa,lengths:O}=S;S=[];let ea=0;for(const na of O){const ra=[];for(let Aa=0;Aa<na;Aa++){const za=[];for(let Ba=0;Ba<la;Ba++)za.push(pa[ea++]);ra.push(za)}S.push(ra)}return X?ba?{paths:S,hasZ:X,
hasM:ba}:{paths:S,hasZ:X}:ba?{paths:S,hasM:ba}:{paths:S}}function G(S,X,ba,la,pa){ba=e(ba,la);for(const {geometry:O,attributes:ea,centroid:na}of X)X=null!=O?N(new c,O,ba):null,la=null!=na?H(new c,na):null,S.push(new f.OptimizedFeature(X,ea,la,pa?ea[pa]:void 0));return S}function N(S,X,ba=e(X.hasZ,X.hasM)){const {lengths:la,coords:pa}=S;let O=0;for(const ea of X.paths){for(const na of ea)for(X=0;X<ba;X++)pa[O++]=na[X];la.push(ea.length)}return S}function Y(S,X,ba){if(!S)return null;const la=e(X,ba),
{coords:pa,lengths:O}=S;S=[];let ea=0;for(const na of O){const ra=[];for(let Aa=0;Aa<na;Aa++){const za=[];for(let Ba=0;Ba<la;Ba++)za.push(pa[ea++]);ra.push(za)}S.push(ra)}return X?ba?{rings:S,hasZ:X,hasM:ba}:{rings:S,hasZ:X}:ba?{rings:S,hasM:ba}:{rings:S}}function ca(S,X,ba=X.hasZ,la=X.hasM){return ka(S,X.rings,ba,la)}function ka(S,X,ba,la){ba=e(ba,la);const {lengths:pa,coords:O}=S;la=0;ia(S);for(const ea of X){for(const na of ea)for(X=0;X<ba;X++)O[la++]=na[X];pa.push(ea.length)}return S}function Q(S,
X,ba,la,pa,O){qa(S);if(!ba){for(const ea of X)S.push(new f.OptimizedFeature(null,ea.attributes,null,O?ea.attributes[O]:void 0));return S}switch(ba){case "esriGeometryPoint":return F(S,X,la,pa,O);case "esriGeometryMultipoint":return K(S,X,la,pa,O);case "esriGeometryPolyline":return G(S,X,la,pa,O);case "esriGeometryPolygon":case "esriGeometryMultiPatch":for(const {geometry:ea,centroid:na,attributes:ra}of X)X=null!=ea?ca(new c,ea,la,pa):null,ba=O?ra[O]:void 0,null!=na?S.push(new f.OptimizedFeature(X,
ra,w(new c,na),ba)):S.push(new f.OptimizedFeature(X,ra,null,ba));break;default:sa().error("convertToFeatureSet:unknown-geometry",new q(`Unable to parse unknown geometry type '${ba}'`)),qa(S)}return S}function R(S,X,ba,la){S=S&&("coords"in S?S:S.geometry);if(null==S)return null;switch(X){case "esriGeometryPoint":return X=t,ba&&la?X=v:ba?X=r:la&&(X=z),X(S);case "esriGeometryMultipoint":return E(S,ba,la);case "esriGeometryPolyline":return D(S,ba,la);case "esriGeometryPolygon":return Y(S,ba,la);default:return sa().error("convertToGeometry:unknown-geometry",
new q(`Unable to parse unknown geometry type '${X}'`)),null}}function Z(S,X,ba,la,pa){qa(S);if(null==ba){for(const ea of X)S.push({attributes:ea.attributes});return S}switch(ba){case "esriGeometryPoint":ba=t;la&&pa?ba=v:la?ba=r:pa&&(ba=z);for(var O of X){const {geometry:ea,attributes:na}=O;la=null!=ea?ba(ea):null;S.push({attributes:na,geometry:la})}break;case "esriGeometryMultipoint":return J(S,X,la,pa);case "esriGeometryPolyline":for(const {geometry:ea,attributes:na}of X)S.push({attributes:na,geometry:null!=
ea?D(ea,la,pa):null});break;case "esriGeometryPolygon":for(const {geometry:ea,attributes:na,centroid:ra}of X)O=null!=ea?Y(ea,la,pa):null,null!=ra?(X=t(ra),S.push({attributes:na,centroid:X,geometry:O})):S.push({attributes:na,geometry:O});break;default:sa().error("convertToFeatureSet:unknown-geometry",new q(`Unable to parse unknown geometry type '${ba}'`))}return S}function da(S,X,ba,la,pa,O,ea=ba,na=la){ia(S);if(!X?.coords.length)return null;pa=ya[pa];const {coords:ra,lengths:Aa}=X;X=e(ba,la);const za=
e(ba&&ea,la&&na);ba=h(ba,la,ea,na);if(!Aa.length)return ba(S.coords,ra,0,0,x(O,ra[0]),m(O,ra[1])),ia(S,X,0),S;let Ba,Ha=0,Ea,Ia=0;for(const Ja of Aa){if(Ja<pa)continue;let Fa=0;Ea=Ia;na=la=x(O,ra[Ha]);Ba=ea=m(O,ra[Ha+1]);ba(S.coords,ra,Ea,Ha,na,Ba);Fa++;Ha+=X;Ea+=za;for(let Ma=1;Ma<Ja;Ma++,Ha+=X)if(na=x(O,ra[Ha]),Ba=m(O,ra[Ha+1]),na!==la||Ba!==ea)ba(S.coords,ra,Ea,Ha,na-la,Ba-ea),Ea+=za,Fa++,la=na,ea=Ba;Fa>=pa&&(S.lengths.push(Fa),Ia=Ea)}qa(S.coords,Ia);return S.coords.length?S:null}function ja(S,
X,ba,la,pa,O,ea){let na=la,ra=0;for(let za=O+ba;za<ea;za+=ba){var Aa=X[za];const Ba=X[za+1],Ha=X[ea],Ea=X[ea+1];let Ia=X[O],Ja=X[O+1],Fa=Ha-Ia,Ma=Ea-Ja;if(0!==Fa||0!==Ma){const Ua=((Aa-Ia)*Fa+(Ba-Ja)*Ma)/(Fa*Fa+Ma*Ma);1<Ua?(Ia=Ha,Ja=Ea):0<Ua&&(Ia+=Fa*Ua,Ja+=Ma*Ua)}Fa=Aa-Ia;Ma=Ba-Ja;Aa=Fa*Fa+Ma*Ma;Aa>na&&(ra=za,na=Aa)}na>la&&(ra-O>ba&&ja(S,X,ba,la,pa,O,ra),pa(S,X,S.length,ra,X[ra],X[ra+1]),ea-ra>ba&&ja(S,X,ba,la,pa,ra,ea))}function W(S,X,ba,la,pa){const {coords:O,lengths:ea}=X;ba=e(ba,la);if(!O.length)return S!==
X&&ia(S),S;g.assertIsSome(pa);const {originPosition:na,scale:ra,translate:Aa}=pa;pa=oa;pa.originPosition=na;la=pa.scale;la[0]=ra[0]??1;la[1]=-(ra[1]??1);la[2]=ra[2]??1;la[3]=ra[3]??1;var za=pa.translate;za[0]=Aa[0]??0;za[1]=Aa[1]??0;za[2]=Aa[2]??0;za[3]=Aa[3]??0;if(!ea.length){for(la=0;la<ba;++la)S.coords[la]=p(pa,O[la],la);S!==X&&ia(S,ba,0);return S}za=0;for(let Ha=0;Ha<ea.length;Ha++){const Ea=ea[Ha];S.lengths[Ha]=Ea;for(var Ba=0;Ba<ba;++Ba)S.coords[za+Ba]=p(pa,O[za+Ba],Ba);Ba=S.coords[za];let Ia=
S.coords[za+1];za+=ba;for(let Ja=1;Ja<Ea;Ja++,za+=ba){Ba+=O[za]*la[0];Ia+=O[za+1]*la[1];S.coords[za]=Ba;S.coords[za+1]=Ia;for(let Fa=2;Fa<ba;++Fa)S.coords[za+Fa]=p(pa,O[za+Fa],Fa)}}S!==X&&ia(S,O.length,ea.length);return S}function aa(S,X,ba,la){let pa=0,O=S[la*X],ea=S[la*(X+1)];for(let na=1;na<ba;na++){const ra=O+S[la*(X+na)],Aa=ea+S[la*(X+na)+1],za=(ra-O)*(Aa+ea);O=ra;ea=Aa;pa+=za}return.5*pa}function ia(S,X=0,ba=0){qa(S.lengths,ba);qa(S.coords,X)}function qa(S,X=0){S.length!==X&&(S.length=X)}const sa=
()=>n.getLogger("esri.layers.graphics.featureConversionUtils"),ya={esriGeometryPoint:0,esriGeometryPolyline:2,esriGeometryPolygon:3,esriGeometryMultipoint:0,esriGeometryMultiPatch:3,esriGeometryEnvelope:0},va=(S,X,ba,la,pa,O)=>{S[ba]=pa;S[ba+1]=O},wa=(S,X,ba,la,pa,O)=>{S[ba]=pa;S[ba+1]=O;S[ba+2]=X[la+2]},M=(S,X,ba,la,pa,O)=>{S[ba]=pa;S[ba+1]=O;S[ba+2]=X[la+3]},L=(S,X,ba,la,pa,O)=>{S[ba]=pa;S[ba+1]=O;S[ba+2]=X[la+2];S[ba+3]=X[la+3]},T=[],ha=[],oa={originPosition:"lowerLeft",scale:[1,1,1,1],translate:[0,
0,0,0]};b.convertFromFeature=function(S,X,ba,la,pa){T[0]=S;[S]=Q(ha,T,X,ba,la,pa);qa(T);qa(ha);return S};b.convertFromFeatureSet=function(S,X){const ba=new d,{hasM:la,hasZ:pa,features:O,objectIdFieldName:ea,spatialReference:na,geometryType:ra,exceededTransferLimit:Aa,transform:za,fields:Ba}=S;Ba&&(ba.fields=Ba);ba.geometryType=ra??null;ba.objectIdFieldName=ea??X??null;ba.spatialReference=na??null;if(!ba.objectIdFieldName)return sa().error(new q("optimized-features:invalid-objectIdFieldName","objectIdFieldName is missing")),
ba;O&&Q(ba.features,O,ra,pa,la,ba.objectIdFieldName);Aa&&(ba.exceededTransferLimit=Aa);la&&(ba.hasM=la);pa&&(ba.hasZ=pa);za&&(ba.transform=za);return ba};b.convertFromFeatures=Q;b.convertFromGeometry=function(S,X,ba){if(null==S)return null;const la=new c;"hasZ"in S&&null==X&&(X=S.hasZ);"hasM"in S&&null==ba&&(ba=S.hasM);if(a.isPoint(S))return B(null!=X?X:null!=S.z,null!=ba?ba:null!=S.m)(la,S);if(a.isPolygon(S))return ca(la,S,X,ba);if(a.isPolyline(S))return N(la,S,e(X,ba));if(a.isMultipoint(S))return C(la,
S,e(X,ba));sa().error("convertFromGeometry:unknown-geometry",new q(`Unable to parse unknown geometry type '${S}'`))};b.convertFromMultipoint=C;b.convertFromMultipointFeatures=K;b.convertFromNestedArray=ka;b.convertFromPoint=H;b.convertFromPointFeatures=F;b.convertFromPolygon=ca;b.convertFromPolyline=N;b.convertFromPolylineFeatures=G;b.convertToFeature=function(S,X,ba,la){ha[0]=S;Z(T,ha,X,ba,la);S=T[0];qa(T);qa(ha);return S};b.convertToFeatureSet=function(S){const {objectIdFieldName:X,spatialReference:ba,
transform:la,fields:pa,hasM:O,hasZ:ea,features:na,geometryType:ra,exceededTransferLimit:Aa,uniqueIdField:za,queryGeometry:Ba,queryGeometryType:Ha}=S;S=Z([],na,ra,ea,O);const Ea=R(Ba,Ha,!1,!1);S={features:S,fields:pa,geometryType:ra,objectIdFieldName:X,spatialReference:ba,uniqueIdField:za,queryGeometry:Ea};la&&(S.transform=la);Aa&&(S.exceededTransferLimit=Aa);O&&(S.hasM=O);ea&&(S.hasZ=ea);return S};b.convertToFeatures=Z;b.convertToGeometry=R;b.convertToMultipoint=E;b.convertToMultipointFeatures=J;
b.convertToPoint=function(S,X,ba){return S?X?ba?v(S):r(S):ba?z(S):t(S):null};b.convertToPolygon=Y;b.convertToPolyline=D;b.generalizeOptimizedGeometry=function(S,X,ba,la,pa,O,ea=ba,na=la){ia(S);if(!X?.coords.length)return null;pa=ya[pa];const {coords:ra,lengths:Aa}=X;X=e(ba,la);const za=e(ba&&ea,la&&na);ba=h(ba,la,ea,na);if(!Aa.length)return ba(S.coords,ra,0,0,ra[0],ra[1]),ia(S,X,0),S;la=0;O*=O;for(const Ba of Aa){if(Ba<pa){la+=Ba*X;continue}ea=S.coords.length/za;na=la;const Ha=la+(Ba-1)*X;ba(S.coords,
ra,S.coords.length,na,ra[na],ra[na+1]);ja(S.coords,ra,X,O,ba,na,Ha);ba(S.coords,ra,S.coords.length,Ha,ra[Ha],ra[Ha+1]);na=S.coords.length/za-ea;na>=pa?S.lengths.push(na):qa(S.coords,ea*za);la+=Ba*X}return S.coords.length?S:null};b.getBoundsOptimizedGeometry=function(S,X,ba,la){if(!X?.coords?.length)return null;ba=e(ba,la);let pa=la=Number.POSITIVE_INFINITY,O=Number.NEGATIVE_INFINITY,ea=Number.NEGATIVE_INFINITY;if(X&&X.coords){X=X.coords;for(let na=0;na<X.length;na+=ba){const ra=X[na],Aa=X[na+1];la=
Math.min(la,ra);O=Math.max(O,ra);pa=Math.min(pa,Aa);ea=Math.max(ea,Aa)}}k.is(S)?k.fromRectValues(S,la,pa,O,ea):l.fromValues(la,pa,O,ea,S);return S};b.getQuantizedArea=function(S,X){const {coords:ba,lengths:la}=S;let pa=S=0;for(let O=0;O<la.length;O++){const ea=la[O];pa+=aa(ba,S,ea,X);S+=ea}return Math.abs(pa)};b.getQuantizedBoundsOptimizedGeometry=function(S,X,ba,la){ba=e(ba,la);const {lengths:pa,coords:O}=X;la=X=Number.POSITIVE_INFINITY;let ea=Number.NEGATIVE_INFINITY,na=Number.NEGATIVE_INFINITY,
ra=0;for(const Aa of pa){let za=O[ra],Ba=O[ra+1];X=Math.min(za,X);la=Math.min(Ba,la);ea=Math.max(za,ea);na=Math.max(Ba,na);ra+=ba;for(let Ha=1;Ha<Aa;Ha++,ra+=ba){const Ea=O[ra],Ia=O[ra+1];za+=Ea;Ba+=Ia;0>Ea&&(X=Math.min(X,za));0<Ea&&(ea=Math.max(ea,za));0>Ia?la=Math.min(la,Ba):0<Ia&&(na=Math.max(na,Ba))}}S[0]=X;S[1]=la;S[2]=ea;S[3]=na;return S};b.getSignedQuantizedRingArea=aa;b.quantizeOptimizedFeatureSet=function(S,X){const {geometryType:ba,features:la,hasM:pa,hasZ:O}=X;if(!S)return X;for(let ea=
0;ea<la.length;ea++){const na=la[ea],ra=na.weakClone();ra.geometry=new c;da(ra.geometry,na.geometry,pa,O,ba,S);na.centroid&&(ra.centroid=new c,da(ra.centroid,na.centroid,pa,O,"esriGeometryPoint",S));la[ea]=ra}X.transform=S;return X};b.quantizeOptimizedGeometry=da;b.quantizeX=x;b.quantizeY=m;b.removeCollinearVertices=function(S,X,ba,la,pa){if(!X?.coords?.length)return null;ba=ya[ba];const {coords:O,lengths:ea}=X;X=h(la,pa,la,pa);la=e(la,pa);let na=pa=0,ra=0,Aa=0;for(const Ha of ea){na=Aa;X(S.coords,
O,na,pa,O[pa],O[pa+1]);pa+=la;var za=O[pa];let Ea=O[pa+1],Ia=za,Ja=Ea;var Ba=Ea/za;na+=la;X(S.coords,O,na,pa,Ia,Ja);pa+=la;for(let Fa=2;Fa<Ha;Fa++){za=O[pa];Ea=O[pa+1];const Ma=Ea/za,Ua=Ba===Ma||!isFinite(Ba)&&!isFinite(Ma);Ba=Ua&&isFinite(Ma)?0<=Ba&&0<=Ma||0>=Ba&&0>=Ma:0<=Ja&&0<=Ea||0>=Ja&&0>=Ea;Ua&&Ba?(Ia+=za,Ja+=Ea):(Ia=za,Ja=Ea,na+=la);X(S.coords,O,na,pa,Ia,Ja);pa+=la;Ba=Ma}na+=la;za=(na-Aa)/la;za>=ba&&(S.lengths[ra]=za,Aa=na,ra++)}S.coords.length>Aa&&(S.coords.length=Aa);S.lengths.length>ra&&
(S.lengths.length=ra);return S.coords.length&&S.lengths.length?S:null};b.removeZMValues=function(S,X,ba,la,pa,O){ia(S);S.lengths.push(...X.lengths);if(ba===pa&&la===O)for(var ea=0;ea<X.coords.length;ea++)S.coords.push(X.coords[ea]);else for(ea=e(ba,la),ba=h(ba,la,pa,O),X=X.coords,la=0;la<X.length;la+=ea)ba(S.coords,X,S.coords.length,la,X[la],X[la+1]);return S};b.unquantizeOptimizedFeatureSet=function(S){const {transform:X,features:ba,hasM:la,hasZ:pa}=S;if(!X)return S;for(const O of ba)null!=O.geometry&&
W(O.geometry,O.geometry,la,pa,X),null!=O.centroid&&W(O.centroid,O.centroid,la,pa,X);S.transform=null;return S};b.unquantizeOptimizedGeometry=W;b.unquantizeValue=p;b.unquantizeX=function(S,X){return p(S,X,0)};b.unquantizeY=function(S,X){return p(S,-X,1)};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/aaBoundingBox":function(){define(["exports","../Extent","./aaBoundingRect","./DoubleArray"],function(b,q,n,g){function k(r=t){return[r[0],r[1],r[2],r[3],r[4],r[5]]}
function l(r,y,z,u,v,A,B=k()){B[0]=r;B[1]=y;B[2]=z;B[3]=u;B[4]=v;B[5]=A;return B}function a(r,y,z,u=k()){x(u,p);f(u,r,y,z);return u}function f(r,y,z=0,u=y.length/3){let v=r[0],A=r[1],B=r[2],F=r[3],H=r[4],J=r[5];for(let E=0;E<u;E++)v=Math.min(v,y[z+3*E]),A=Math.min(A,y[z+3*E+1]),B=Math.min(B,y[z+3*E+2]),F=Math.max(F,y[z+3*E]),H=Math.max(H,y[z+3*E+1]),J=Math.max(J,y[z+3*E+2]);r[0]=v;r[1]=A;r[2]=B;r[3]=F;r[4]=H;r[5]=J}function d(r){return r[0]>=r[3]?0:r[3]-r[0]}function c(r){return r[1]>=r[4]?0:r[4]-
r[1]}function e(r){return r[2]>=r[5]?0:r[5]-r[2]}function h(r,y){return Math.max(y[0],r[0])<=Math.min(y[3],r[3])&&Math.max(y[1],r[1])<=Math.min(y[4],r[4])&&Math.max(y[2],r[2])<=Math.min(y[5],r[5])}function x(r,y){r[0]=y[0];r[1]=y[1];r[2]=y[2];r[3]=y[3];r[4]=y[4];r[5]=y[5];return r}function m(r){return 6===r.length}const p=[Infinity,Infinity,Infinity,-Infinity,-Infinity,-Infinity],t=[0,0,0,0,0,0],w=k();b.allFinite=function(r){for(let y=0;6>y;y++)if(!isFinite(r[y]))return!1;return!0};b.center=function(r,
y=[0,0,0]){y[0]=r[0]+d(r)/2;y[1]=r[1]+c(r)/2;y[2]=r[2]+e(r)/2;return y};b.contains=function(r,y){return y[0]>=r[0]&&y[1]>=r[1]&&y[2]>=r[2]&&y[3]<=r[3]&&y[4]<=r[4]&&y[5]<=r[5]};b.containsPoint=function(r,y){return y[0]>=r[0]&&y[1]>=r[1]&&y[2]>=r[2]&&y[0]<=r[3]&&y[1]<=r[4]&&y[2]<=r[5]};b.containsPointWithMargin=function(r,y,z){return y[0]>=r[0]-z&&y[1]>=r[1]-z&&y[2]>=r[2]-z&&y[0]<=r[3]+z&&y[1]<=r[4]+z&&y[2]<=r[5]+z};b.create=k;b.depth=c;b.diameter=function(r){const y=d(r),z=e(r);r=c(r);return Math.sqrt(y*
y+z*z+r*r)};b.empty=function(r){return r?x(r,p):k(p)};b.equals=function(r,y,z){if(null==r||null==y)return r===y;if(!m(r)||!m(y))return!1;if(z)for(let u=0;u<r.length;u++){if(!z(r[u],y[u]))return!1}else for(z=0;z<r.length;z++)if(r[z]!==y[z])return!1;return!0};b.expandWithAABB=function(r,y){r[0]=Math.min(r[0],y[0]);r[1]=Math.min(r[1],y[1]);r[2]=Math.min(r[2],y[2]);r[3]=Math.max(r[3],y[3]);r[4]=Math.max(r[4],y[4]);r[5]=Math.max(r[5],y[5])};b.expandWithBuffer=f;b.expandWithNestedArray=function(r,y,z){const u=
y.length;let v=r[0],A=r[1],B=r[2],F=r[3],H=r[4],J=r[5];if(z)for(z=0;z<u;z++){var E=y[z];v=Math.min(v,E[0]);A=Math.min(A,E[1]);B=Math.min(B,E[2]);F=Math.max(F,E[0]);H=Math.max(H,E[1]);J=Math.max(J,E[2])}else for(z=0;z<u;z++)E=y[z],v=Math.min(v,E[0]),A=Math.min(A,E[1]),F=Math.max(F,E[0]),H=Math.max(H,E[1]);r[0]=v;r[1]=A;r[2]=B;r[3]=F;r[4]=H;r[5]=J};b.expandWithOffset=function(r,y,z,u){r[0]=Math.min(r[0],r[0]+y);r[3]=Math.max(r[3],r[3]+y);r[1]=Math.min(r[1],r[1]+z);r[4]=Math.max(r[4],r[4]+z);r[2]=Math.min(r[2],
r[2]+u);r[5]=Math.max(r[5],r[5]+u)};b.expandWithRect=function(r,y){r[0]=Math.min(r[0],y[0]);r[1]=Math.min(r[1],y[1]);r[3]=Math.max(r[3],y[2]);r[4]=Math.max(r[4],y[3])};b.expandWithVec3=function(r,y){r[0]=Math.min(r[0],y[0]);r[1]=Math.min(r[1],y[1]);r[2]=Math.min(r[2],y[2]);r[3]=Math.max(r[3],y[0]);r[4]=Math.max(r[4],y[1]);r[5]=Math.max(r[5],y[2])};b.fromBuffer=function(r,y=k()){return a(r,0,r.length/3,y)};b.fromExtent=function(r,y=k()){y[0]=r.xmin;y[1]=r.ymin;y[2]=r.hasZ?r.zmin:-Infinity;y[3]=r.xmax;
y[4]=r.ymax;y[5]=r.hasZ?r.zmax:Infinity;return y};b.fromMinMax=function(r,y,z=k()){z[0]=r[0];z[1]=r[1];z[2]=r[2];z[3]=y[0];z[4]=y[1];z[5]=y[2];return z};b.fromRect=function(r,y){r[0]=y[0];r[1]=y[1];r[2]=Number.NEGATIVE_INFINITY;r[3]=y[2];r[4]=y[3];r[5]=Number.POSITIVE_INFINITY;return r};b.fromRectValues=function(r,y,z,u,v){r[0]=y;r[1]=z;r[2]=Number.NEGATIVE_INFINITY;r[3]=u;r[4]=v;r[5]=Number.POSITIVE_INFINITY;return r};b.fromSubBuffer=a;b.fromValues=l;b.getMax=function(r,y){y[0]=r[3];y[1]=r[4];y[2]=
r[5];return y};b.getMin=function(r,y){y[0]=r[0];y[1]=r[1];y[2]=r[2];return y};b.height=e;b.intersects=h;b.intersectsClippingArea=function(r,y){return null==y?!0:h(r,y)};b.is=m;b.isPoint=function(r){return 0===d(r)&&0===c(r)&&0===e(r)};b.maximumDimension=function(r){return Math.max(d(r),e(r),c(r))};b.negativeInfinity=p;b.offset=function(r,y,z,u,v=r){v[0]=r[0]+y;v[1]=r[1]+z;v[2]=r[2]+u;v[3]=r[3]+y;v[4]=r[4]+z;v[5]=r[5]+u;return v};b.positiveInfinity=[-Infinity,-Infinity,-Infinity,Infinity,Infinity,
Infinity];b.scale=function(r,y,z=r){const u=r[0]+d(r)/2,v=r[1]+c(r)/2,A=r[2]+e(r)/2;z[0]=u+(r[0]-u)*y;z[1]=v+(r[1]-v)*y;z[2]=A+(r[2]-A)*y;z[3]=u+(r[3]-u)*y;z[4]=v+(r[4]-v)*y;z[5]=A+(r[5]-A)*y;return z};b.set=x;b.setMax=function(r,y,z=r){z[3]=y[0];z[4]=y[1];z[5]=y[2];z!==r&&(z[0]=r[0],z[1]=r[1],z[2]=r[2]);return r};b.setMin=function(r,y,z=r){z[0]=y[0];z[1]=y[1];z[2]=y[2];z!==r&&(z[3]=r[3],z[4]=r[4],z[5]=r[5]);return z};b.size=function(r,y=[0,0,0]){y[0]=d(r);y[1]=c(r);y[2]=e(r);return y};b.toCorners=
function(r,y=g.newDoubleArray(24)){const [z,u,v,A,B,F]=r;y[0]=z;y[1]=u;y[2]=v;y[3]=z;y[4]=u;y[5]=F;y[6]=z;y[7]=B;y[8]=v;y[9]=z;y[10]=B;y[11]=F;y[12]=A;y[13]=u;y[14]=v;y[15]=A;y[16]=u;y[17]=F;y[18]=A;y[19]=B;y[20]=v;y[21]=A;y[22]=B;y[23]=F;return y};b.toExtent=function(r,y){return isFinite(r[2])||isFinite(r[5])?new q({xmin:r[0],xmax:r[3],ymin:r[1],ymax:r[4],zmin:r[2],zmax:r[5],spatialReference:y}):new q({xmin:r[0],xmax:r[3],ymin:r[1],ymax:r[4],spatialReference:y})};b.toRect=function(r,y){y||=n.create();
y[0]=r[0];y[1]=r[1];y[2]=r[3];y[3]=r[4];return y};b.width=d;b.wrap=function(r,y,z,u,v,A){return l(r,y,z,u,v,A,w)};b.zero=t;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/DoubleArray":function(){define(["exports","../../core/typedArrayUtil"],function(b,q){b.copyInto=function(n,g){for(let k=0;k<g.length;++k)n[k]=g[k];return n};b.doubleArrayFrom=function(n){return(q.isArray(n)?n.length:n.byteLength/8)<=q.nativeArrayMaxSize?Array.from(n):new Float64Array(n)};b.doubleSubArray=
function(n,g,k){return Array.isArray(n)?n.slice(g,g+k):n.subarray(g,g+k)};b.newDoubleArray=function(n,g=!1){return n<=q.nativeArrayMaxSize?g?Array(n).fill(0):Array(n):new Float64Array(n)};b.toFloat64Array=function(n){return Array.isArray(n)?new Float64Array(n):n};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/OptimizedFeature":function(){define(["exports","./OptimizedGeometry"],function(b,q){class n{constructor(k=null,l={},a,f){this.geometry=k;this.attributes=
l;this.centroid=a;this.objectId=f;this.geohashY=this.geohashX=this.displayId=0}static fromJSON(k,l){const a=k.geometry?q.fromJSON(k.geometry):null,f=k.centroid?q.fromJSON(k.centroid):null;return new n(a,k.attributes,f,k.attributes[l])}weakClone(){const k=new n(this.geometry,this.attributes,this.centroid,this.objectId);k.displayId=this.displayId;k.geohashX=this.geohashX;k.geohashY=this.geohashY;return k}clone(){var k=this.geometry?.clone();k=new n(k,{...this.attributes},this.centroid?.clone(),this.objectId);
k.displayId=this.displayId;k.geohashX=this.geohashX;k.geohashY=this.geohashY;return k}}class g extends n{}b.OptimizedFeature=n;b.OptimizedFeatureWithGeometry=g;b.hasGeometry=function(k){return!!k.geometry?.coords?.length};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/OptimizedFeatureSet":function(){define(function(){class b{constructor(){this.spatialReference=this.geometryType=this.geometryProperties=this.geohashFieldName=this.globalIdFieldName=this.objectIdFieldName=
null;this.hasM=this.hasZ=!1;this.features=[];this.fields=[];this.transform=null;this.exceededTransferLimit=!1;this.queryGeometry=this.queryGeometryType=this.uniqueIdField=null}weakClone(){const q=new b;q.objectIdFieldName=this.objectIdFieldName;q.globalIdFieldName=this.globalIdFieldName;q.geohashFieldName=this.geohashFieldName;q.geometryProperties=this.geometryProperties;q.geometryType=this.geometryType;q.spatialReference=this.spatialReference;q.hasZ=this.hasZ;q.hasM=this.hasM;q.features=this.features;
q.fields=this.fields;q.transform=this.transform;q.exceededTransferLimit=this.exceededTransferLimit;q.uniqueIdField=this.uniqueIdField;q.queryGeometry=this.queryGeometry;q.queryGeometryType=this.queryGeometryType;return q}}return b})},"esri/views/2d/engine/webgl/DisplayId":function(){define(["exports"],function(b){b.aggregateValidFiltersMask=254;b.createDisplayId=function(q,n){return((n?8388608:0)|q)>>>0};b.displayIdTexelMask=8388607;b.displayIdTypeAggregate=1;b.displayIdTypeFeature=0;b.displayIdTypeMask=
8388608;b.getDisplayIdFilterMask=q=>1===(q&8388608)>>>23?254:255;b.getDisplayIdTexel=q=>q&8388607;b.getDisplayIdType=q=>(q&8388608)>>>23;b.isAggregateId=function(q){return 1===(q&8388608)>>>23};b.nonAggregateValidFiltersMask=255;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/collisions/LabelMetric":function(){define(["exports","./BoundingBox","../util/serializationUtils"],function(b,q,n){class g{constructor(k,l,a,f,d,c,e,h,x=[]){this.entityTexel=k;this.anchorX=
l;this.anchorY=a;this.directionX=f;this.directionY=d;this.maxScale=c;this.minScale=e;this.referenceBounds=h;this.bounds=x}serialize(k){k.push(this.entityTexel);k.writeF32(this.anchorX);k.writeF32(this.anchorY);k.writeF32(this.directionX);k.writeF32(this.directionY);k.writeF32(this.maxScale);k.writeF32(this.minScale);null===this.referenceBounds?(k.writeF32(0),k.writeF32(0),k.writeF32(0)):(k.writeF32(this.referenceBounds.size),k.writeF32(this.referenceBounds.offsetX),k.writeF32(this.referenceBounds.offsetY));
n.serializeList(k,this.bounds)}static deserialize(k){const l=k.readInt32(),a=k.readF32(),f=k.readF32(),d=k.readF32(),c=k.readF32(),e=k.readF32(),h=k.readF32(),x=k.readF32(),m=k.readF32(),p=k.readF32();k=n.deserializeList(k,q)??[];return new g(l,a,f,d,c,e,h,{size:x,offsetX:m,offsetY:p},k)}}b.LabelMetric=g;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/mesh/templates/segmentUtils":function(){define(["exports","../../../../../../symbols/cim/constants"],function(b,
q){function n(c,e,h){c[0]=e[0]-h[0];c[1]=e[1]-h[1];return c}function g(c){var e=c[0];var h=c[1];e=Math.sqrt(e*e+h*h);c[0]/=e;c[1]/=e}function k(c){return c.length-1}function l(c){let e=0;for(let h=0;h<k(c);h++)e+=a(c,h);return e}function a(c,e,h=1){let [x,m]=c[e+1];[x,m]=[Math.round(x),Math.round(m)];return Math.sqrt(x*x+m*m)*h}function f(c,e,h,x,m){if(!(h<e)){var p=x.clone().seek(h/2);null!=p&&(c(p.clone(),h,m),h=(h-e)/2,p=p.seek(e/2),f(c,e,h,x,m+1),f(c,e,h,p,m+1))}}class d{constructor(c,e,h,x,m){this._segments=
c;this._index=e;this._distance=h;this._xStart=x;this._yStart=m;this._done=!1}static create(c){return new d(c,0,0,c[0][0],c[0][1])}clone(){return new d(this._segments,this._index,this._distance,this.xStart,this.yStart)}equals(c){return this._index===c._index||c._index===this._index-1&&(0===this._distance||1===c._distance)||c._index===this._index+1&&(1===this._distance||0===c._distance)}leq(c){return this._index<c._index||this._index===c._index&&this._distance<=c._distance}geq(c){return this._index>
c._index||this._index===c._index&&this._distance>=c._distance}get _segment(){return this._segments[this._index+1]}get angle(){const c=this.dy;let e=Math.acos((0*c+-1*-this.dx)/(1*this.length));0<c&&(e=2*Math.PI-e);return e}get xStart(){return this._xStart}get yStart(){return this._yStart}get x(){return this.xStart+this.distance*this.dx}get y(){return this.yStart+this.distance*this.dy}get dx(){return this._segment[0]}get dy(){return this._segment[1]}get xMidpoint(){return this.xStart+.5*this.dx}get yMidpoint(){return this.yStart+
.5*this.dy}get xEnd(){return this.xStart+this.dx}get yEnd(){return this.yStart+this.dy}get length(){const {dx:c,dy:e}=this;return Math.sqrt(c*c+e*e)}get remainingLength(){return this.length*(1-this._distance)}get backwardLength(){return this.length*this._distance}get distance(){return this._distance}get done(){return this._done}hasPrev(){return 0<=this._index-1}hasNext(){return this._index+1<k(this._segments)}next(){if(!this.hasNext())return null;this._xStart+=this.dx;this._yStart+=this.dy;this._distance=
0;this._index+=1;return this}prev(){if(!this.hasPrev())return this._done=!0,null;--this._index;this._xStart-=this.dx;this._yStart-=this.dy;this._distance=1;return this}_seekBackwards(c,e){var h=this.backwardLength;if(c<=h)return this._distance=(h-c)/this.length,this;for(h=this.backwardLength;this.prev();){if(h+this.length>c)return this._seekBackwards(c-h);h+=this.length}this._distance=0;return e?this:null}seek(c,e=!1){if(0>c)return this._seekBackwards(Math.abs(c),e);if(c<=this.remainingLength)return this._distance=
(this.backwardLength+c)/this.length,this;let h=this.remainingLength;for(;this.next();){if(h+this.length>c)return this.seek(c-h,e);h+=this.length}this._distance=1;return e?this:null}}b.SegmentCursor=d;b.pathDivide=function(c,e,h,x=!0){const m=l(c);c=d.create(c);const p=m/2;if(x){x=Math.floor(Math.max((m-e)/2,0)/e);c.seek(p-x*e);for(let t=-x;t<=x;t++)Math.abs(c.x)<q.maxTileCoordValue&&Math.abs(c.y)<q.maxTileCoordValue&&h(c.clone(),t,p+t*e,m),c.seek(e)}else c.seek(p),Math.abs(c.x)<q.maxTileCoordValue&&
Math.abs(c.y)<q.maxTileCoordValue&&h(c.clone(),0,p+0*e,m)};b.pathLength=l;b.pathSubdivide=function(c,e,h){f(h,e,l(c),d.create(c),0)};b.segmentAt=function(c,e){return c[e+1]};b.segmentCount=k;b.segmentLength=a;b.smoothPaths=function(c,e){for(let K=0;K<c.length;K++){let C=c[K];a:{var h=C,x=e;if(0>=x)break a;const D=h.length;if(3>D)break a;const G=[];var m=0;G.push(0);for(var p=1;p<D;p++){var t=h[p],w=h[p-1],r=t[0]-w[0];t=t[1]-w[1];m+=Math.sqrt(r*r+t*t);G.push(m)}x=Math.min(x,.2*m);r=[];r.push(h[0][0]);
r.push(h[0][1]);m=h[D-1][0];p=h[D-1][1];t=n([0,0],h[0],h[1]);g(t);h[0][0]+=x*t[0];h[0][1]+=x*t[1];n(t,h[D-1],h[D-2]);g(t);h[D-1][0]+=x*t[0];h[D-1][1]+=x*t[1];for(t=1;t<D;t++)G[t]+=x;G[D-1]+=x;t=.5*x;for(w=1;w<D-1;w++){let N=0,Y=0,ca=0;for(var y=w-1;0<=y&&!(G[y+1]<G[w]-t);y--){var z=t+G[y+1]-G[w],u=G[y+1]-G[y],v=G[w]-G[y]<t?1:z/u;if(1E-6>Math.abs(v))break;var A=v*v,B=v*z-.5*A*u,F=v*u/x,H=h[y+1],J=h[y][0]-H[0],E=h[y][1]-H[1];N+=F/B*(H[0]*v*z+.5*A*(z*J-u*H[0])-A*v*u*J/3);Y+=F/B*(H[1]*v*z+.5*A*(z*E-u*
H[1])-A*v*u*E/3);ca+=F}for(y=w+1;y<D&&!(G[y-1]>G[w]+t);y++){z=t-G[y-1]+G[w];u=G[y]-G[y-1];v=G[y]-G[w]<t?1:z/u;if(1E-6>Math.abs(v))break;A=v*v;B=v*z-.5*A*u;F=v*u/x;H=h[y-1];J=h[y][0]-H[0];E=h[y][1]-H[1];N+=F/B*(H[0]*v*z+.5*A*(z*J-u*H[0])-A*v*u*J/3);Y+=F/B*(H[1]*v*z+.5*A*(z*E-u*H[1])-A*v*u*E/3);ca+=F}r.push(N/ca);r.push(Y/ca)}r.push(m);r.push(p);for(let N=0,Y=0;N<D;N++)h[N][0]=r[Y++],h[N][1]=r[Y++]}h=[];h.push(C[0]);for(x=1;x<C.length;x++){const [D,G]=C[x-1],[N,Y]=C[x];h.push([N-D,Y-G])}C=c[K]=h}return c};
Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/constants":function(){define(["exports"],function(b){b.dashRadius=15.5;b.dashSdfDistanceNormalization=64;b.dashSdfRasterizationScale=4;b.maxTileCoordValue=1024;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/text/TextMeshWriter":function(){define("exports ../../../../../../../core/mathUtils ../../../../../../../core/screenUtils ../../../../../../../geometry/GeometryCursor ../../../../../../../symbols/cim/placements/CIMMarkerPlacementHelper ../../../alignmentUtils ../../../definitions ../../../mesh/templates/shapingUtils ../fill/meshWriterUtils ../mesh/loadGeometryEngine ../mesh/MeshWriter ../shaders/constants ./TextParams ../../../../../../webgl/enums".split(" "),
function(b,q,n,g,k,l,a,f,d,c,e,h,x,m){const p=[4,4];var t=[16,4];const w={topLeft:t,topRight:t,bottomLeft:t,bottomRight:t};t=[4,2];const r=[4,6],y={topLeft:t,topRight:t,bottomLeft:r,bottomRight:r},z={topLeft:t,topRight:r,bottomLeft:t,bottomRight:r},u={topLeft:r,topRight:r,bottomLeft:p,bottomRight:p},v={topLeft:p,topRight:p,bottomLeft:r,bottomRight:r},A={topLeft:r,topRight:p,bottomLeft:r,bottomRight:p},B={topLeft:p,topRight:r,bottomLeft:p,bottomRight:r},F={createComputedParams:J=>J,optionalAttributes:{zoomRange:{type:m.DataType.UNSIGNED_SHORT,
count:2,packPrecisionFactor:a.minMaxZoomPrecisionFactor,packTessellation:({minZoom:J,maxZoom:E})=>[J||0,E||28]},clipAngle:{type:m.DataType.UNSIGNED_BYTE,count:1,packTessellation:({clipAngle:J})=>Math.round(254/360*(J||0))},referenceSymbol:{type:m.DataType.BYTE,count:4,packPrecisionFactor:1,packTessellation:(J,E)=>{const K=J.isLineLabel||!J.referenceBounds,C=l.getXDirection(K?"center":E.horizontalAlignment);E=l.getYDirection(K?"middle":E.verticalAlignment);const {offsetX:D,offsetY:G,size:N}=K?{offsetX:0,
offsetY:0,size:0}:J.referenceBounds;return[n.pt2px(D),-n.pt2px(G),Math.round(n.pt2px(N)),C+1<<2|E+1]}}},attributes:{pos:{type:m.DataType.SHORT,count:2,pack:"position",packPrecisionFactor:10},id:{type:m.DataType.UNSIGNED_BYTE,count:3,pack:"id"},bitset:{type:m.DataType.UNSIGNED_BYTE,count:1,packTessellation:({isBackground:J,mapAligned:E})=>d.packBitset([[h.bitsetTextIsBackground,J],[h.bitsetTextIsMapAligned,!!E]])},offset:{type:m.DataType.SHORT,count:2,packPrecisionFactor:8,packAlternating:{count:4,
packTessellation:({offsets:J})=>{const {bottomLeft:E,bottomRight:K,topLeft:C,topRight:D}=J;return[C,D,E,K]}}},textureUV:{type:m.DataType.SHORT,count:2,packPrecisionFactor:4,packAlternating:{count:4,packTessellation:({texcoords:J})=>{const {bottomLeft:E,bottomRight:K,topLeft:C,topRight:D}=J;return[C,D,E,K]}}},color:{type:m.DataType.UNSIGNED_BYTE,count:4,normalized:!0,packTessellation:({color:J})=>J},fontSize:{type:m.DataType.UNSIGNED_SHORT,count:1,packPrecisionFactor:4,packTessellation:({fontSize:J})=>
Math.round(n.pt2px(J))},referenceSize:{type:m.DataType.UNSIGNED_BYTE,count:1,packPrecisionFactor:4,packTessellation:({fontSize:J},{referenceSize:E})=>Math.round(n.pt2px(E??J))},outlineColor:{type:m.DataType.UNSIGNED_BYTE,count:4,normalized:!0,pack:({outlineColor:J})=>d.processColorInput(J)},haloColor:{type:m.DataType.UNSIGNED_BYTE,count:4,normalized:!0,pack:({haloColor:J})=>d.processColorInput(J)},outlineAndHaloSize:{type:m.DataType.UNSIGNED_SHORT,count:2,packPrecisionFactor:4,packTessellation:({outlineSize:J,
haloSize:E})=>[Math.round(n.pt2px(J)),Math.round(n.pt2px(E))]}}};class H extends e.MeshWriter{constructor(){super(...arguments);this.vertexSpec=F;this._textMeshParamsPropsInitialized=!1}ensurePacked(J,E,K){super.ensurePacked(J,E,K);if(!this._textMeshParamsPropsInitialized||this._evaluator.hasDynamicProperties)this._textMeshTransformProps=new x.TextMeshTransformProps(this.evaluatedMeshParams),this._textMeshParamsPropsInitialized=!0}_write(J,E,K){const C=this._getShaping();if(C){var D=E.getDisplayId();
if(null!=this.evaluatedMeshParams.placement)return this._writePlacedTextMarkers(J,E,C,K);if(K?.nextPath())return K.nextPoint(),this._writeGlyphs(J,D,K.x,K.y,C,0);if("esriGeometryPolygon"===E.geometryType){E=E.readCentroidForDisplay();if(!E)return;const [G,N]=E.coords;return this._writeGlyphs(J,D,G,N,C,0)}if("esriGeometryMultipoint"===E.geometryType)E.readGeometryForDisplay()?.forEachVertex((G,N)=>this._writeGlyphs(J,D,G,N,C,0));else return K=E.readXForDisplay(),E=E.readYForDisplay(),this._writeGlyphs(J,
D,K,E,C,0)}}_writePlacedTextMarkers(J,E,K,C){if(C=C??g.GeometryCursor.fromFeatureSetReaderCIM(E))if(C=k.CIMMarkerPlacementHelper.getPlacement(C,-1,this.evaluatedMeshParams.placement,n.pt2px(1),J.id,c.getGeometryEngine())){E=E.getDisplayId();for(var D=C.next();null!=D;){const G=D.tx,N=-D.ty;D=-D.getAngle();this._writeGlyphs(J,E,G,N,K,D);D=C.next()}}}_getShaping(J){const E=this._textMeshTransformProps,K=this.evaluatedMeshParams;if(!K.glyphs?.glyphs.length)return null;const C=n.pt2px(E.fontSize),D=n.pt2px(E.offsetX),
G=n.pt2px(E.offsetY),N=q.clamp(n.pt2px(K.lineWidth),a.minTextLineWidth,a.maxTextLineWidth),Y=a.magicLabelLineHeight*q.clamp(K.lineHeightRatio,.25,4);return f.shapeGlyphs(K.glyphs,{scale:C/a.glyphSize,angle:E.postAngle,xOffset:D,yOffset:G,horizontalAlignment:K.horizontalAlignment,verticalAlignment:J||K.verticalAlignment,maxLineWidth:N,lineHeight:Y,decoration:K.decoration,borderLineSizePx:n.pt2px(K.boxBorderLineSize),hasBackground:!!K.boxBackgroundColor,useCIMAngleBehavior:K.useCIMAngleBehavior})}_writeGlyphs(J,
E,K,C,D,G,N,Y){const ca=this.evaluatedMeshParams;var ka=this._textMeshTransformProps;const Q=n.pt2px(ka.fontSize),R=ka.haloSize,Z=ka.outlineSize;var da=n.pt2px(ka.offsetX),ja=n.pt2px(ka.offsetY);const [W,aa]=d.getMinMaxZoom(ca.scaleInfo,this.getTileInfo());0!==G&&D.setRotation(G);ka=D.bounds;da=K+ka.x+da;ja=C+ka.y-ja;ka=2*Math.max(ka.width,ka.height)*(ca.minPixelBuffer?ca.minPixelBuffer/Q:1);D.textBox&&(J.recordStart(this.instanceId,this.attributeLayout,D.glyphs[0].textureBinding),J.recordBounds(da,
ja,ka,ka),this._writeTextBox(J,E,K,C,D.textBox,N,Y),J.recordEnd());for(const ia of D.glyphs){J.recordStart(this.instanceId,this.attributeLayout,ia.textureBinding);J.recordBounds(da,ja,ka,ka);const {texcoords:qa,offsets:sa}=ia;this._writeQuad(J,E,K,C,{texcoords:qa,offsets:sa,fontSize:Q,haloSize:R,outlineSize:Z,color:d.processColorInput(ca.color),isBackground:!1,referenceBounds:N,minZoom:W,maxZoom:aa,...Y});J.recordEnd()}0!==G&&D.setRotation(-G)}_writeTextBox(J,E,K,C,D,G,N){const Y=this.evaluatedMeshParams,
{fontSize:ca,haloSize:ka,outlineSize:Q}=this._textMeshTransformProps,{boxBackgroundColor:R,boxBorderLineColor:Z}=Y;G={isBackground:!0,fontSize:ca,haloSize:ka,outlineSize:Q,referenceBounds:G,...N};R&&(this._writeQuad(J,E,K,C,{texcoords:w,offsets:D.main,color:d.processColorInput(R),...G}),Z||(this._writeQuad(J,E,K,C,{texcoords:u,offsets:D.top,color:d.processColorInput(R),...G}),this._writeQuad(J,E,K,C,{texcoords:v,offsets:D.bot,color:d.processColorInput(R),...G}),this._writeQuad(J,E,K,C,{texcoords:A,
offsets:D.left,color:d.processColorInput(R),...G}),this._writeQuad(J,E,K,C,{texcoords:B,offsets:D.right,color:d.processColorInput(R),...G})));Z&&(this._writeQuad(J,E,K,C,{texcoords:y,offsets:D.top,color:d.processColorInput(Z),...G}),this._writeQuad(J,E,K,C,{texcoords:y,offsets:D.bot,color:d.processColorInput(Z),...G}),this._writeQuad(J,E,K,C,{texcoords:z,offsets:D.left,color:d.processColorInput(Z),...G}),this._writeQuad(J,E,K,C,{texcoords:z,offsets:D.right,color:d.processColorInput(Z),...G}))}_writeQuad(J,
E,K,C,D){const G=J.vertexCount();this._writeVertex(J,E,K,C,D);J.indexWrite(G+0);J.indexWrite(G+1);J.indexWrite(G+2);J.indexWrite(G+1);J.indexWrite(G+3);J.indexWrite(G+2)}}b.TextMeshWriter=H;b.TextVertexSpec=F;b.maxLabelZoom=28;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/placements/CIMMarkerPlacementHelper":function(){define(["exports","../CIMOperators"],function(b,q){class n{static getPlacement(g,k,l,a,f,d){const c=q.getPlacementOperator(l);if(!c)return null;
-1===k&&g.invertY();return c.execute(g,l,a,f,d)}}b.CIMMarkerPlacementHelper=n;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/text/TextParams":function(){define(["exports","../../../../../../../symbols/cim/utils"],function(b,q){class n{constructor(g){const {offsetX:k,offsetY:l,postAngle:a,fontSize:f,haloSize:d,outlineSize:c,scaleFactor:e,transforms:h}=g;this.offsetX=k;this.offsetY=l;this.postAngle=a;this.fontSize=Math.min(f,96);this.haloSize=
d??0;this.outlineSize=c??0;if((this.transforms=h)&&1<h.infos.length){g=q.applyParentTransform(f,a,!1,k,l,h,!1);this.fontSize=Math.min(g.size,96);const x=g.size/f;this.haloSize*=x;this.outlineSize*=x;this.postAngle=g.rotation;this.offsetX=g.offsetX;this.offsetY=g.offsetY}e&&(this.fontSize*=e,this.offsetX*=e,this.offsetY*=e)}}b.TextMeshTransformProps=n;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/line/TexturedLineMeshWriter":function(){define("exports ../../../../../../../core/screenUtils ../../../../../../../geometry/GeometryCursor ../../../../../../../symbols/cim/enums ../../../definitions ../fill/meshWriterUtils ./LineMeshWriter ../shaders/constants ../../../../../../webgl/enums".split(" "),
function(b,q,n,g,k,l,a,f,d){const c={createComputedParams:h=>h,optionalAttributes:a.LineVertexSpec.optionalAttributes,attributes:{...a.LineVertexSpec.attributes,bitset:{type:d.DataType.UNSIGNED_BYTE,count:1,pack:({shouldSampleAlphaOnly:h,shouldScaleDash:x,isSDF:m})=>l.packBitset([[f.bitsetGenericConsiderAlphaOnly,h],[f.bitsetLineScaleDash,x],[f.bitsetLineIsSdf,m]])},tlbr:{type:d.DataType.UNSIGNED_SHORT,count:4,pack:({sprite:h})=>{const {rect:x,width:m,height:p}=h;h=x.x+k.spritePadding;const t=x.y+
k.spritePadding;return[h,t,h+m,t+p]}},accumulatedDistance:{type:d.DataType.UNSIGNED_SHORT,count:1,packTessellation:({distance:h})=>h},segmentDirection:{type:d.DataType.BYTE,count:2,packPrecisionFactor:16,packTessellation:({directionX:h,directionY:x})=>[h,x]},offsetAlongLine:{type:d.DataType.HALF_FLOAT,count:1,pack:({offsetAlongLine:h})=>q.pt2px(h)},capType:{type:d.DataType.UNSIGNED_BYTE,count:1,pack:({capType:h})=>{switch(h){case g.LineCapStyle.Butt:case "butt":return 0;case g.LineCapStyle.Square:case "square":return 1;
case g.LineCapStyle.Round:case "round":return 2;default:return 0}}}}};class e extends a.LineMeshWriter{constructor(h,x,m,p){super(h,x,m,p);this.vertexSpec=c;this._tessellationOptions.textured=!0}_write(h,x,m){if(m=m??n.GeometryCursor.fromFeatureSetReaderCIM(x)){var {sprite:p}=this.evaluatedMeshParams;this._writeGeometry(h,x,m,p?.textureBinding)}}}b.TexturedLineMeshWriter=e;b.texturedLineVertexSpec=c;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/markers/MarkerMeshWriter":function(){define("exports ../../../../../../../core/screenUtils ../../../../../../../core/libs/gl-matrix-2/math/mat2d ../../../../../../../core/libs/gl-matrix-2/factories/mat2df32 ../../../../../../../core/libs/gl-matrix-2/math/vec2 ../../../../../../../geometry/GeometryCursor ../../../../../../../symbols/cim/constants ../../../../../../../symbols/cim/enums ../../../../../../../symbols/cim/placements/CIMMarkerPlacementHelper ../../../definitions ../fill/meshWriterUtils ./ComputedMarkerParams ./markerConstants ../mesh/loadGeometryEngine ../mesh/MeshWriter ../../../../../../webgl/enums".split(" "),
function(b,q,n,g,k,l,a,f,d,c,e,h,x,m,p,t){function w(v,A,B,F,H=!1){v=g.create();H=H?1:-1;n.identity(v);(A||B)&&n.translate(v,v,[A,-B]);F&&n.rotate(v,v,H*r*-F);return v}const r=3.14159265359/180,y=128/Math.PI,z={createComputedParams:v=>h.ComputedMarkerParams.from(v),optionalAttributes:{zoomRange:{type:t.DataType.SHORT,count:2,packPrecisionFactor:c.minMaxZoomPrecisionFactor,pack:({scaleInfo:v},{tileInfo:A})=>e.getMinMaxZoom(v,A)}},attributes:{pos:{type:t.DataType.SHORT,count:2,pack:"position",packPrecisionFactor:10},
id:{type:t.DataType.UNSIGNED_BYTE,count:3,pack:"id"},bitset:{type:t.DataType.UNSIGNED_BYTE,count:1,pack:({sprite:v,alignment:A,scaleSymbolsProportionally:B,overrideOutlineColor:F,colorLocked:H})=>{let J=0;v.sdf&&(J|=e.getBitMask(x.MarkerConstants.bitset.isSDF));A===f.Alignment.MAP&&(J|=e.getBitMask(x.MarkerConstants.bitset.isMapAligned));B&&(J|=e.getBitMask(x.MarkerConstants.bitset.scaleSymbolsProportionally));F&&(J|=e.getBitMask(x.MarkerConstants.bitset.overrideOutlineColor));H&&(J|=e.getBitMask(x.MarkerConstants.bitset.colorLocked));
return J}},offset:{type:t.DataType.SHORT,count:2,packPrecisionFactor:4,packAlternating:{count:4,pack:({angle:v,computedWidth:A,computedHeight:B,anchorX:F,anchorY:H,offsetX:J,offsetY:E,rotateClockwise:K})=>{v=w(0,J,E,-v,K);F=-(.5+F)*A;K=-(.5-H)*B;H=[F,K];J=[F+A,K];E=[F,K+B];A=[F+A,K+B];k.transformMat2d(H,H,v);k.transformMat2d(J,J,v);k.transformMat2d(E,E,v);k.transformMat2d(A,A,v);return[H,J,E,A]}}},textureUV:{type:t.DataType.SHORT,count:2,packPrecisionFactor:4,packAlternating:{count:4,pack:({texXmax:v,
texXmin:A,texYmax:B,texYmin:F})=>[[A,F],[v,F],[A,B],[v,B]]}},color:{type:t.DataType.UNSIGNED_BYTE,count:4,normalized:!0,pack:({color:v})=>e.processColorInput(v)},outlineColor:{type:t.DataType.UNSIGNED_BYTE,count:4,normalized:!0,pack:({outlineColor:v})=>e.processColorInput(v)},sizing:{type:t.DataType.UNSIGNED_BYTE,count:4,pack:({rawWidth:v,rawHeight:A,outlineSize:B,referenceSize:F})=>[e.packByteSqrt(Math.max(v,A),128),e.packByteSqrt(B,128),e.packByteSqrt(F,128),0]},placementAngle:{type:t.DataType.UNSIGNED_BYTE,
count:1,packTessellation:({placementAngle:v})=>{v*=y;v%=256;return Math.abs(0<=v?v:v+256)}},sdfDecodeCoeff:{type:t.DataType.UNSIGNED_SHORT,count:1,packPrecisionFactor:64,pack:({sdfDecodeCoeff:v})=>v}}};class u extends p.MeshWriter{constructor(){super(...arguments);this.vertexSpec=z}getBoundsInfo(){return this.evaluatedMeshParams.boundsInfo}_write(v,A,B){var F=this.evaluatedMeshParams.sprite?.textureBinding;const H=A.getDisplayId();v.recordStart(this.instanceId,this.attributeLayout,F);F=this.evaluatedMeshParams.minPixelBuffer;
const J=Math.max(this.evaluatedMeshParams.computedWidth,F),E=Math.max(this.evaluatedMeshParams.computedHeight,F),K=this.evaluatedMeshParams.offsetX+-this.evaluatedMeshParams.anchorX*this.evaluatedMeshParams.computedWidth,C=-this.evaluatedMeshParams.offsetY+this.evaluatedMeshParams.anchorY*this.evaluatedMeshParams.computedHeight;if(null!=this.evaluatedMeshParams.placement)this._writePlacedMarkers(v,A,B,J,E);else if(B?.nextPath())B.nextPoint(),A=B.x,B=B.y,v.recordBounds(A+K,B+C,J,E),this._writeQuad(v,
H,A,B);else if("esriGeometryPolygon"===A.geometryType){A=A.readCentroidForDisplay();if(!A)return;const [D,G]=A.coords;v.recordBounds(D+K,G+C,J,E);this._writeQuad(v,H,D,G)}else"esriGeometryPoint"===A.geometryType?(B=A.readXForDisplay(),A=A.readYForDisplay(),v.recordBounds(B+K,A+C,J,E),this._writeQuad(v,H,B,A)):A.readGeometryForDisplay()?.forEachVertex((D,G)=>{v.recordBounds(D+K,G+C,J,E);Math.abs(D)>a.maxTileCoordValue||Math.abs(G)>a.maxTileCoordValue||this._writeQuad(v,H,D,G)});v.recordEnd()}_writePlacedMarkers(v,
A,B,F,H){if(B=B??l.GeometryCursor.fromFeatureSetReaderCIM(A)?.clone())if(B=d.CIMMarkerPlacementHelper.getPlacement(B,-1,this.evaluatedMeshParams.placement,q.pt2px(1),v.id,m.getGeometryEngine())){A=A.getDisplayId();for(var J=B.next(),E=this.evaluatedMeshParams.offsetX,K=-this.evaluatedMeshParams.offsetY;null!=J;){const C=J.tx,D=-J.ty;Math.abs(C)>a.maxTileCoordValue||Math.abs(D)>a.maxTileCoordValue?J=B.next():(J=-J.getAngle(),v.recordBounds(C+E,D+K,F,H),this._writeQuad(v,A,C,D,J),J=B.next())}}}_writeQuad(v,
A,B,F,H){const J=v.vertexCount();this._writeVertex(v,A,B,F,null==H?null:{placementAngle:H});v.indexWrite(J+0);v.indexWrite(J+1);v.indexWrite(J+2);v.indexWrite(J+1);v.indexWrite(J+3);v.indexWrite(J+2)}}b.MarkerMeshWriter=u;b.MarkerVertexSpec=z;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/markers/ComputedMarkerParams":function(){define(["exports","../../../../../../../core/screenUtils","../../../../../../../symbols/cim/enums","../../../../../../../symbols/cim/utils",
"../../../definitions"],function(b,q,n,g,k){class l{static from(a){return"width"in a?this.fromSimpleMeshParams(a):this.fromComplexMeshParams(a)}static fromSimpleMeshParams(a){const f=new l(a.sprite,a.color,a.outlineColor,a.minPixelBuffer,a.placement,a.scaleInfo,a.effects),{type:d,width:c,height:e,angle:h,alignment:x,outlineSize:m,referenceSize:p,sprite:t,overrideOutlineColor:w}=a;f.rawWidth=q.pt2px(c);f.rawHeight=q.pt2px(e);f.angle=h;f.alignment=x;f.outlineSize=q.pt2px(m);f.referenceSize=q.pt2px(p);
f.overrideOutlineColor=w;f.offsetX=q.pt2px(a.offsetX);f.offsetY=q.pt2px(a.offsetY);"simple"!==d||t.sdf||(f.rawWidth=t.width,f.rawHeight=t.height);f._computeSize(a,!1);return f}static fromComplexMeshParams(a){const f=new l(a.sprite,a.color,a.outlineColor,a.minPixelBuffer,a.placement,a.scaleInfo,a.effects);let {alignment:d,transforms:c,size:e,scaleX:h,anchorX:x,anchorY:m,angle:p,colorLocked:t,frameHeight:w,widthRatio:r,offsetX:y,offsetY:z,outlineSize:u,referenceSize:v,scaleFactor:A,sizeRatio:B,isAbsoluteAnchorPoint:F,
rotateClockwise:H,scaleSymbolsProportionally:J,sprite:E}=a;if(c&&0<c.infos.length){var K=g.applyParentTransform(e,p,H,y,z,c);e=K.size;p=K.rotation;y=K.offsetX;z=K.offsetY;H=!1}A&&(e*=A,y*=A,z*=A);K=E.width/E.height*h;f.alignment=d;f.rawHeight=q.pt2px(e);f.rawWidth=f.rawHeight*K;f.referenceSize=q.pt2px(v);f.sizeRatio=B;f.sdfDecodeCoeff=(E.sdfDecodeCoeff??1)*B;f.angle=p;f.rotateClockwise=H;f.anchorX=x;f.anchorY=m;f.offsetX=q.pt2px(y);f.offsetY=q.pt2px(z);F&&e&&(f.anchorX=E.sdf?x/(e*r):x/(e*K),f.anchorY=
m/e);K=J&&w?e/w:1;f.outlineSize=0===u||isNaN(u)?0:q.pt2px(u)*K;f.scaleSymbolsProportionally=J;f.colorLocked=t;f._computeSize(a,!0);return f}constructor(a,f,d,c,e,h,x){this.sprite=a;this.color=f;this.outlineColor=d;this.minPixelBuffer=c;this.placement=e;this.scaleInfo=h;this.effects=x;this.referenceSize=this.outlineSize=this.angle=this.rawHeight=this.rawWidth=0;this.sdfDecodeCoeff=this.sizeRatio=1;this.alignment=n.Alignment.SCREEN;this.colorLocked=this.overrideOutlineColor=this.scaleSymbolsProportionally=
!1;this.offsetY=this.offsetX=this.texYmax=this.texXmax=this.texYmin=this.texXmin=this.computedHeight=this.computedWidth=this.anchorY=this.anchorX=0;this.rotateClockwise=!0}get boundsInfo(){return{size:Math.max(this.computedHeight,this.computedWidth),offsetX:this.offsetX,offsetY:this.offsetY}}_computeSize(a,f){const {sprite:d,hasSizeVV:c}=a;var e=!!d.sdf;a=d.sdfPaddingRatio??.5;const {rawWidth:h,rawHeight:x,sizeRatio:m,outlineSize:p}=this;var t=m*(e?1/(1-a):1);a=h*t;t*=x;if(e&&!c){var w=p+2;this.computedWidth=
Math.min((f&&h>x?a:h)+w,a);this.computedHeight=Math.min(x+w,t)}else this.computedWidth=a,this.computedHeight=t;f=e?Math.max(d.width,d.height)/Math.max(a,t):1;w=.5*(a-this.computedWidth)*f;var r=.5*(t-this.computedHeight)*f;f=d.rect.x+k.spritePadding+w;e=d.rect.y+k.spritePadding+r;w=f+d.width-2*w;r=e+d.height-2*r;this.texXmin=Math.floor(f);this.texYmin=Math.floor(e);this.texXmax=Math.ceil(w);this.texYmax=Math.ceil(r);this.computedWidth*=(this.texXmax-this.texXmin)/(w-f);this.computedHeight*=(this.texYmax-
this.texYmin)/(r-e);this.anchorX*=a/this.computedWidth;this.anchorY*=t/this.computedHeight}}b.ComputedMarkerParams=l;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/mesh/MeshWriterInputEvaluator":function(){define("exports ../../../../../../../core/arrayUtils ../../../../../../../core/Error ../../../../../../../core/lang ../../../../../../../core/Logger ../../../grouping ../../../animations/infos ../../../animations/utils ./utils ../../../../../layers/features/support/DictionaryValue".split(" "),
function(b,q,n,g,k,l,a,f,d,c){async function e(t,w,r=!1){const {defaultValue:y,valueExpressionInfo:z,value:u}=w;if(z){const {expression:v}=z;return(t=await t.createComputedField({expression:v},r))?{...w,computed:t,defaultValue:y}:null}return{...w,computed:new c.DictionaryValue(u),defaultValue:y}}async function h(t,w){var {valueExpressionInfo:r}=w;({expression:r}=r);return(t=await t.createComputedField({expression:r}))?{...w,computed:t}:null}function x(t){return"object"!==typeof t||null==t?!1:"valueExpressionInfo"in
t&&t.valueExpressionInfo||"type"in t&&"Process"===t.type&&"op"in t&&"Random"===t.op?!0:!1}function m(t){if(Array.isArray(t))for(const w of t)if(m(w))return!0;if("object"===typeof t){if(x(t))return!0;for(const w in t)if(m(t[w]))return!0}return!1}class p{static async create(t,w,r){const y={},z=new Map,u=new Map,v=new Map,A=new Map,B=new Map,F=new Map;for(const J in r){const E=r[J];if(null==E||"object"!==typeof E)y[J]=E;else if(Array.isArray(E)){if("object"===typeof E[0])throw Error(`InternalError: Cannot handle ${J}. Nested array params are not supported`);
y[J]=E}else if("valueExpressionInfo"in E)if(E.value)y[J]=E.value;else{var H=await h(t,E);H?(z.set(J,H),y[J]=null):y[J]=E.defaultValue}else switch(E.type){case "cim-effect-infos":if(E.effectInfos.some(K=>K.overrides.length)){u.set(J,{effects:await Promise.all(E.effectInfos.map(async K=>{const C=K.overrides.map(D=>e(t,D));return{effect:K.effect,compiledOverrides:(await Promise.all(C)).filter(q.isSome)}}))});break}y[J]=E.effectInfos.map(K=>K.effect);break;case "cim-marker-placement-param":E.overrides.length&&
v.set(J,{placementInfo:E,compiledOverrides:(await Promise.all(E.overrides.map(K=>e(t,K)))).filter(q.isSome)});y[J]=E.placement;break;case "text-rasterization-param":if(E.overrides.length){H=E.overrides.map(K=>e(t,K,E.useLegacyLabelEvaluationRules));A.set(J,{compiledOverrides:(await Promise.all(H)).filter(q.isSome),rasterizationParam:E,objectIdToResourceId:new Map});continue}y[J]=await w.fetchResourceImmediate({type:"cim-rasterization-info",resource:E.resource})??null;break;case "sprite-rasterization-param":if(E.overrides.length){H=
E.overrides.map(K=>e(t,K));A.set(J,{compiledOverrides:(await Promise.all(H)).filter(q.isSome),rasterizationParam:E,objectIdToResourceId:new Map});continue}if("animated"===E.resource.type){A.set(J,{compiledOverrides:[],rasterizationParam:E,objectIdToResourceId:new Map});continue}y[J]=await w.fetchResourceImmediate({type:"cim-rasterization-info",resource:E.resource})??null;break;case "cim-marker-transform-param":({params:H}=E);if(m(H)){const K={compiledMarkerInfos:[]};await Promise.all(H.map(async C=>
{const D={props:{}};for(const G in C)if(x(C[G])){const N=await h(t,C[G]);D.compiledExpressionMap||(D.compiledExpressionMap=new Map);const Y=D.compiledExpressionMap;N&&Y.set(G,N)}else D.props[G]=C[G];K.compiledMarkerInfos.push(D)}));B.set(J,K)}else y[J]={type:"cim-marker-transform-info",infos:H};break;case "animation-params":({params:H}=E);H=f.createParamList(H);m(H)?(H=await Promise.all(H.map(K=>f.compileAnimationParam(K,t))),F.set(J,{params:H,propertyIdToResourceId:new Map,key:J})):(H=f.fromJSON(H),
H=await w.fetchResourceImmediate({type:"animation-info",resource:H}),null!=H&&"sprite"===H.type&&(y[J]={dataRow:H.rect.y,dataColumn:H.rect.x}));break;default:y[J]=E}}return new p(r,y,z,u,v,A,B,F)}constructor(t,w,r,y,z,u,v,A){this.inputMeshParams=t;this._resolvedMeshParams=w;this._dynamicProperties=r;this._dynamicEffectProperties=y;this._dynamicPlacementProperties=z;this._dynamicAsyncProperties=u;this._dynamicTransformProperties=v;this._dynamicAsyncAnimations=A;this.evaluator=B=>B}get hasDynamicProperties(){return!!(this._dynamicProperties.size||
this._dynamicAsyncProperties.size||this._dynamicEffectProperties.size||this._dynamicTransformProperties.size||this._dynamicPlacementProperties.size||this._dynamicAsyncAnimations.size)}get evaluatedMeshParams(){this._evaluatedMeshParams||(this._evaluatedMeshParams=this.evaluator(this._resolvedMeshParams));return this._evaluatedMeshParams}enqueueRequest(t,w,r){for(var y of this._dynamicAsyncProperties.values()){var z=g.clone(y.rasterizationParam.resource);"animated"===y.rasterizationParam.resource.type&&
y.rasterizationParam.resource.randomizeStartTime&&(z.primitiveName="__RESERVED__PRIMITIVE__NAME__",z.startGroup=l.getStartGroup(w.getObjectId()||0));for(const {primitiveName:u,propertyName:v,computed:A,defaultValue:B,valueExpressionInfo:F}of y.compiledOverrides)try{d.applyComputedValue(z,"animated"===y.rasterizationParam.resource.type?z.primitiveName:u,v,A,w,r,B)}catch(H){k.getLogger("esri.views.2d.engine.webgl.shaderGraph.techniques.mesh.MeshWriterInputEvaluator").errorOnce(new n("invalid-arcade-expression",
`Encountered an error when evaluating the arcade expression '${F?.expression}' (primitive: '${u}', property: '${v}')`,H))}z=t.enqueueRequest({type:"cim-rasterization-info",resource:z});y.objectIdToResourceId.set(w.getObjectId(),z)}for(const u of this._dynamicAsyncAnimations.values())y=u.params.map(v=>f.resolveToAnimationInfo(v,w,r)).map(a.hydrate).map(v=>v.simplify()),y=f.encodeParamList(y),y=t.enqueueRequest({type:"animation-info",resource:y}),u.propertyIdToResourceId.set(w.getObjectId()+"."+u.key,
y)}evaluateMeshParams(t,w,r){for(const [u,v]of this._dynamicProperties.entries())this._resolvedMeshParams[u]=v.computed.readWithDefault(w,r,v.defaultValue);for(const [u,v]of this._dynamicPlacementProperties.entries())for(const {computed:A,defaultValue:B,propertyName:F}of v.compiledOverrides){var y=A.readWithDefault(w,r,B);v.placementInfo.placement[F]=y;this._resolvedMeshParams[u]=v.placementInfo.placement}for(const [u,v]of this._dynamicEffectProperties.entries())for(var z of v.effects){for(const {computed:A,
defaultValue:B,propertyName:F}of z.compiledOverrides)y=A.readWithDefault(w,r,B),z.effect[F]=y;this._resolvedMeshParams[u]=v.effects.map(A=>A.effect)}for(const [u,v]of this._dynamicTransformProperties.entries()){z={type:"cim-marker-transform-info",infos:[]};for(const A of v.compiledMarkerInfos){y={...A.props};if(A.compiledExpressionMap)for(const [B,F]of A.compiledExpressionMap){const H=F.computed.readWithDefault(w,r,F.defaultValue);y[B]="number"===typeof H||"boolean"===typeof H?H:F.defaultValue}z.infos.push(y)}this._resolvedMeshParams[u]=
z}for(const [u,v]of this._dynamicAsyncProperties.entries())r=v.objectIdToResourceId.get(w.getObjectId()),null!=r&&(r=t.getResource(r),this._resolvedMeshParams[u]=r);for(const [u,v]of this._dynamicAsyncAnimations.entries())r=v.propertyIdToResourceId.get(w.getObjectId()+"."+u),null!=r&&(r=t.getResource(r),this._resolvedMeshParams[u]={dataRow:r.rect.y,dataColumn:r.rect.x});this._evaluatedMeshParams=this.evaluator(this._resolvedMeshParams);return this.evaluatedMeshParams}}b.MeshWriterInputEvaluator=p;
b.hasExpression=x;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/grouping":function(){define(["exports","../../../../core/string"],function(b,q){function n(g,k){if("string"===typeof g)g=q.numericHash(g+`-seed(${k})`);else{let l=12;g^=k;do g=107*(g>>8^g)+l|0;while(0!==--l)}return(1+g/-2147483648)/2}b.getRandomValue=n;b.getStartGroup=function(g){return Math.floor(10*n(g,53290320))};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/animations/infos":function(){define(["exports",
"./instructions"],function(b,q){function n(d){return d instanceof g?d:"object"===typeof d&&"type"in d?f[d.type].hydrate(d):new k(d)}class g{constructor(d){this.inputs=d}encode(){const d=[];for(const c of this.inputs)d.push(...c.encode());d.push(...this.instructions);return d}}class k extends g{constructor(d){super([]);this.value=d}simplify(){return this}get instructions(){if(Array.isArray(this.value)){const [d,c,e,h]=this.value;return null!=h?q.instructions.vector4.encode([d,c||0,e||0,h]):q.instructions.vector3.encode([d,
c||0,e||0])}return q.instructions.scalar.encode(this.value)}}class l extends g{constructor(d,c){super([c]);this._config=d;this._parent=c}static hydrate(d){return new l(d,n(d.parent))}simplify(){if(this._config.relativeTranslation||this._config.absoluteScale)return this;var d=this._parent.simplify();if(!(d instanceof k))return this;const [c,e,h,x]=d.value,m=this._config.translation.from[0],p=this._config.translation.from[1],t=this._config.rotation.from,w=this._config.scale.from;if(m===this._config.translation.to[0]&&
p===this._config.translation.to[1]&&t===this._config.rotation.to&&w===this._config.scale.to){d=Math.sin(h);const r=Math.cos(h);return new k([r*x*m-d*x*p+c,d*x*m+r*x*p+e,h+t,x*w])}return new l(this._config,d)}get instructions(){return q.instructions.animatedTransform.encode(this._config)}}class a extends g{constructor(d,c){super([c]);this._config=d;this._parent=c}static hydrate(d){return new a(d,n(d.parent))}simplify(){const d=this._parent.simplify();if(!(d instanceof k))return this;const [c,e,h,x]=
d.value,m=this._config.color.from[0],p=this._config.color.from[1],t=this._config.color.from[2];let w=this._config.color.from[3];const r=this._config.opacity.from;return m===this._config.color.to[0]&&p===this._config.color.to[1]&&t===this._config.color.to[2]&&w===this._config.color.to[3]&&r===this._config.opacity.to?new k([c*m,e*p,h*t,x*w*r]):new a(this._config,d)}get instructions(){return q.instructions.animatedColor.encode(this._config)}}const f={AnimatedTransform:l,AnimatedColor:a};b.AAnimationInfo=
g;b.AnimatedColor=a;b.AnimatedTransform=l;b.Constant=k;b.hydrate=n;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/animations/instructions":function(){define(["exports"],function(b){function q(w){return[`float duration = clamp(${w.duration}, 0.05, 3600.0);`,`float startTimeOffset = ${w.startTimeOffset};`,`float repeatDelay = ${w.repeatDelay};`,`float timeOriginSelector = ${w.timeOriginSelector};`,`float repeatType = ${w.repeatType};`,`float easing = ${w.easing};`,
`float playAnimation = ${w.playAnimation} * (1.0 - step(0.0, -${w.duration}));`,`float reverseAnimation = ${w.reverseAnimation};`,"float time \x3d globalTime - (timeOriginSelector \x3d\x3d 1.0 ? localTimeOrigin : 0.0);","time *\x3d playAnimation;","time *\x3d 1.0 - reverseAnimation * 2.0;","float period \x3d duration + repeatDelay;","time +\x3d reverseAnimation \x3d\x3d 1.0 ? (period - startTimeOffset - 0.001) : startTimeOffset + 0.001;","float omega \x3d time / period;","float oi \x3d floor(omega);",
"omega \x3d repeatType \x3d\x3d 1.0 || repeatType \x3d\x3d 3.0 ? omega - oi : omega;","float of \x3d omega * period;","of \x3d (clamp(of, reverseAnimation * repeatDelay, period - (1.0 - reverseAnimation) * repeatDelay) - reverseAnimation * repeatDelay) / duration;","of \x3d easing \x3d\x3d 2.0 ? pow(of, 3.0) : of;","of \x3d easing \x3d\x3d 3.0 ? 1.0 - pow(1.0 - of, 3.0) : of;","of \x3d easing \x3d\x3d 4.0 ? of \x3c 0.5 ? 4.0 * pow(of, 3.0) : 1.0 - pow(-2.0 * of + 2.0, 3.0) / 2.0 : of;","bool oscillate \x3d repeatType \x3d\x3d 3.0 \x26\x26 mod(oi, 2.0) \x3d\x3d 1.0;",
`${w.out} = oscillate ? 1.0 - of : of;`]}function n(w){return[[w.duration,w.startTimeOffset,w.repeatDelay,x[w.timeOriginSelector]],[h[w.repeatType],e[w.easing],w.playAnimation,w.reverseAnimation]]}function g(w){const r=[];r.push(`float globalTime = ${w.globalTime};`);r.push(`float localTimeOrigin = ${w.localTimeOrigin};`);r.push(`vec2 pointer = ${w.animationPointer};`);r.push(`vec2 size = ${w.animationTextureSize};`);r.push("int top \x3d 0;");r.push("vec4 stack[4];");r.push("for (int counter \x3d 0; counter \x3c 40; counter++) {");
r.push(`vec4 atom0 = texture(${w.animationTexture}, (pointer + 0.5) / size);`);r.push("pointer.x +\x3d 1.0;");r.push(`vec2 pixelDimensions = ${w.pixelDimensions};`);r.push("if (false) {");for(const y in t){const z=t[y];r.push(`} else if (int(atom0.x) == ${z.opcode}) {`);for(const u of z.generateSource(w))r.push(u)}r.push("} // End if-else.");r.push("} // End for.");r.push(`${w.out} = top > 0 ? stack[top - 1] : vec4(0.0);`);return r.join("\n")}b.TimeOrigin=void 0;(function(w){w.Local="Local";w.Global=
"Global"})(b.TimeOrigin||(b.TimeOrigin={}));class k{generateSource(w){const r=[];for(let z=1;z<this.length;z++)r.push(`vec4 atom${z} = texture(${w.animationTexture}, (pointer + 0.5) / size);`),r.push("pointer.x +\x3d 1.0;");for(w=0;w<this.ins;w++)r.push("top--;"),r.push(`vec4 in${this.ins-w-1} = stack[top];`);for(w=0;w<this.outs;w++)r.push(`vec4 out${w};`);({microcode:w}=this);for(var y of w)r.push(y);for(y=0;y<this.outs;y++)r.push(`stack[top] = out${y};`),r.push("top++;"),r.push("if (top \x3e\x3d 4) { top \x3d 3; }");
return r}}let l=128;class a extends k{constructor(){super(...arguments);this.opcode=++l;this.length=1;this.outs=this.ins=0;this.microcode=["break;"]}encode(){return[[this.opcode,0,0,0]]}}class f extends k{constructor(){super(...arguments);this.opcode=++l;this.length=1;this.ins=0;this.outs=1;this.microcode=["out0 \x3d vec4(atom0.y, atom0.y, atom0.y, atom0.y);"]}encode(w){return[[this.opcode,w,0,0]]}}class d extends k{constructor(){super(...arguments);this.opcode=++l;this.length=1;this.ins=0;this.outs=
1;this.microcode=["out0 \x3d vec4(atom0.yzw, 0.0);"]}encode(w){return[[this.opcode,w[0]||0,w[1]||0,w[2]||0]]}}class c extends k{constructor(){super(...arguments);this.opcode=++l;this.length=2;this.ins=0;this.outs=1;this.microcode=["out0 \x3d atom1;"]}encode(w){return[[this.opcode,0,0,0],w]}}const e={Linear:1,EaseIn:2,EaseOut:3,EaseInOut:4},h={Loop:1,None:2,Oscillate:3},x={Local:1,Global:2};class m extends k{constructor(){super(...arguments);this.opcode=++l;this.length=10;this.outs=this.ins=1;this.microcode=
["vec2 fromTranslation \x3d atom1.xy;","vec2 toTranslation \x3d atom1.zw;","float fromRotation \x3d atom2.x;","float toRotation \x3d atom2.y;","float fromScale \x3d atom2.z;","float toScale \x3d atom2.w;","bool relativeTranslation \x3d atom9.x \x3d\x3d 1.0;","bool absoluteScale \x3d atom9.y \x3d\x3d 1.0;","vec2 translationMultiplier \x3d relativeTranslation ? pixelDimensions : vec2(1.0, 1.0);","float scaleDivisor \x3d absoluteScale ? pixelDimensions.y : 1.0;","float fTranslation;","{",...q({duration:"atom3.x",
startTimeOffset:"atom3.y",repeatDelay:"atom3.z",timeOriginSelector:"atom3.w",repeatType:"atom4.x",easing:"atom4.y",playAnimation:"atom4.z",reverseAnimation:"atom4.w",out:"fTranslation"}),"}","float fRotation;","{",...q({duration:"atom5.x",startTimeOffset:"atom5.y",repeatDelay:"atom5.z",timeOriginSelector:"atom5.w",repeatType:"atom6.x",easing:"atom6.y",playAnimation:"atom6.z",reverseAnimation:"atom6.w",out:"fRotation"}),"}","float fScale;","{",...q({duration:"atom7.x",startTimeOffset:"atom7.y",repeatDelay:"atom7.z",
timeOriginSelector:"atom7.w",repeatType:"atom8.x",easing:"atom8.y",playAnimation:"atom8.z",reverseAnimation:"atom8.w",out:"fScale"}),"}","vec2 aTranslation \x3d mix(fromTranslation, toTranslation, fTranslation);","float aRotation \x3d mix(fromRotation, toRotation, fRotation);","float aScale \x3d mix(fromScale, toScale, fScale);","vec2 pTranslation \x3d in0.xy;","float pRotation \x3d in0.z;","float pScale \x3d in0.w;","aTranslation *\x3d translationMultiplier;","aScale /\x3d scaleDivisor;","float rotation \x3d pRotation + aRotation;",
"float scale \x3d pScale * aScale;","float sin1 \x3d sin(pRotation);","float cos1 \x3d cos(pRotation);","float s1 \x3d pScale;","float x1 \x3d pTranslation.x;","float y1 \x3d pTranslation.y;","float x2 \x3d aTranslation.x;","float y2 \x3d aTranslation.y;","\n    vec2 translation \x3d vec2(\n      cos1 * s1 * x2 - sin1 * s1 * y2 + x1,\n      sin1 * s1 * x2 + cos1 * s1 * y2 + y1\n    );\n    ","out0 \x3d vec4(translation, rotation, scale);"]}encode(w){return[[this.opcode,0,0,0],[w.translation.from[0],
w.translation.from[1],w.translation.to[0],w.translation.to[1]],[w.rotation.from,w.rotation.to,w.scale.from,w.scale.to],...n(w.translation.timing),...n(w.rotation.timing),...n(w.scale.timing),[w.relativeTranslation?1:0,w.absoluteScale?1:0,0,0]]}}class p extends k{constructor(){super(...arguments);this.opcode=++l;this.length=7;this.outs=this.ins=1;this.microcode=["float fromOpacity \x3d atom0.y;","float toOpacity \x3d atom0.z;","vec4 fromColor \x3d atom1;","vec4 toColor \x3d atom2;","float fColor;",
"{",...q({duration:"atom3.x",startTimeOffset:"atom3.y",repeatDelay:"atom3.z",timeOriginSelector:"atom3.w",repeatType:"atom4.x",easing:"atom4.y",playAnimation:"atom4.z",reverseAnimation:"atom4.w",out:"fColor"}),"}","float fOpacity;","{",...q({duration:"atom5.x",startTimeOffset:"atom5.y",repeatDelay:"atom5.z",timeOriginSelector:"atom5.w",repeatType:"atom6.x",easing:"atom6.y",playAnimation:"atom6.z",reverseAnimation:"atom6.w",out:"fOpacity"}),"}","vec4 aColor \x3d mix(fromColor, toColor, fColor);","aColor.a *\x3d mix(fromOpacity, toOpacity, fOpacity);",
"vec4 pColor \x3d in0;","out0 \x3d aColor * pColor;"]}encode(w){return[[this.opcode,w.opacity.from,w.opacity.to,0],[w.color.from[0],w.color.from[1],w.color.from[2],w.color.from[3]],[w.color.to[0],w.color.to[1],w.color.to[2],w.color.to[3]],...n(w.color.timing),...n(w.opacity.timing)]}}const t={scalar:new f,vector3:new d,vector4:new c,animatedTransform:new m,animatedColor:new p,ret:new a};b.AAnimationInstruction=k;b.AnimatedColorInstruction=p;b.AnimatedTransformInstruction=m;b.RetInstruction=a;b.ScalarInstruction=
f;b.Vector3Instruction=d;b.Vector4Instruction=c;b.easingCodes=e;b.generateGetValueSource=function(w,r){return`\n    vec4 ${w}(int valueIndex) {\n      vec2 thePointer = ${r.animationPointer};\n      float jump = texture(${r.animationTexture}, (0.5 + vec2(thePointer.x + float(valueIndex), thePointer.y)) / ${r.animationTextureSize}).x;\n      thePointer = vec2(thePointer.x + jump, thePointer.y);\n      vec4 theResult;\n      ${g({...r,out:"theResult",animationPointer:"thePointer"})}\n      return theResult;\n    }\n  `};
b.generateVirtualMachineSource=g;b.getTweenFactor=q;b.instructions=t;b.repeatTypeCodes=h;b.timeOriginSelectorCodes=x;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/animations/utils":function(){define(["exports","../../../../../Color","../grouping","./infos","./instructions"],function(b,q,n,g,k){function l(c){const e=[],h=[];let x=0;for(const m of c){const p=[...m.encode(),...k.instructions.ret.encode()];e.push([x+c.length,0,0,0]);h.push(...p);x+=p.length}return[...e,
...h]}async function a(c,e){if("number"===typeof c||"string"===typeof c||"boolean"===typeof c)var h=c;else if(Array.isArray(c))h=await Promise.all(c.map(x=>a(x,e)));else if("object"===typeof c)if("valueExpressionInfo"in c)({valueExpressionInfo:h}=c),{expression:h}=h,h={...c,computed:await e.createComputedField({expression:h})};else{h={};for(const x in c)h[x]=await a(c[x],e)}return h}function f(c,e,h){function x(w){if(!("computed"in w))return w;w=w.computed.readWithDefault(e,h,[255*w.defaultValue[0],
255*w.defaultValue[1],255*w.defaultValue[2],w.defaultValue[3]]);if("string"===typeof w){const r=q.fromString(w);r&&(w=[r.r,r.g,r.b,r.a])}return w}if("number"===typeof c||"string"===typeof c||"boolean"===typeof c)var m=c;else if(Array.isArray(c))m=c.map(w=>f(w,e,h));else if("object"===typeof c)if("type"in c&&null!=c.type&&"Process"===c.type)switch(c.op){case "ArcadeColor":c=f(c.value,e,h);d(Array.isArray(c)&&4===c.length);m=[c[0]/255,c[1]/255,c[2]/255,c[3]];break;case "Transparency":c=f(c.value,e,
h);d("number"===typeof c);m=1-c/100;break;case "Divide":m=f(c.left,e,h);d("number"===typeof m);c=f(c.right,e,h);d("number"===typeof c);m/=c;break;case "Random":m=f(c.seed,e,h);var p=f(c.min,e,h);c=f(c.max,e,h);var t=e.getObjectId();t=n.getStartGroup(t||0);m=p+n.getRandomValue(t,m)*(c-p)}else if("computed"in c)m=x(c);else for(p in m={},c)m[p]=f(c[p],e,h);return m}function d(c){if(!c)throw Error("Assertion failed.");}b.assert=d;b.compileAnimationParam=a;b.createParamList=function(c){const e=[];e.push(c.transform);
e.push(c.fromColor);e.push(c.toColor);e.push(c.colorMix);e.push(c.toOpacity);e.push(c.opacityMix);return e};b.encodeParamList=l;b.fromJSON=function(c){c=c.map(e=>f(e)).map(e=>g.hydrate(e).simplify());return l(c)};b.resolveToAnimationInfo=f;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/support/DictionaryValue":function(){define(["exports","./AComputedField"],function(b,q){class n extends q.AComputedField{constructor(g){super();this._value=g}resize(g){}read(g,
k){return this._value}readWithDefault(g,k,l){return this._value}referencesScale(){return!1}referencesGeometry(){return!1}}b.DictionaryValue=n;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/support/AComputedField":function(){define(["exports"],function(b){class q{destroy(){}}b.AComputedField=q;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/pieChart/PieChartMeshWriter":function(){define(["exports",
"../../../../../../../core/screenUtils","../fill/meshWriterUtils","../mesh/MeshWriter","../../../../../../webgl/enums"],function(b,q,n,g,k){const l={createComputedParams:f=>f,optionalAttributes:{},attributes:{pos:{type:k.DataType.SHORT,count:2,packPrecisionFactor:10,pack:"position"},id:{type:k.DataType.UNSIGNED_BYTE,count:3,pack:"id"},bitset:{type:k.DataType.UNSIGNED_BYTE,count:1,pack:f=>0},offset:{type:k.DataType.SHORT,count:2,packPrecisionFactor:16,packAlternating:{count:4,pack:({size:f})=>{f=q.pt2px(f);
const d=-f/2,c=-f/2;return[[d,c],[d+f,c],[d,c+f],[d+f,c+f]]}}},texCoords:{type:k.DataType.SHORT,count:2,packPrecisionFactor:4,packAlternating:{count:4,pack:()=>[[0,1],[1,1],[0,0],[1,0]]}},size:{type:k.DataType.UNSIGNED_BYTE,count:2,pack:({size:f})=>[f,f]},referenceSize:{type:k.DataType.UNSIGNED_BYTE,count:1,pack:({size:f})=>q.pt2px(f)},zoomRange:{type:k.DataType.UNSIGNED_BYTE,count:2,pack:({scaleInfo:f},{tileInfo:d})=>n.getMinMaxZoom(f,d)}}};class a extends g.MeshWriter{constructor(){super(...arguments);
this.vertexSpec=l}_write(f,d){const c=d.getDisplayId();var e=this.evaluatedMeshParams.minPixelBuffer,h=Math.max(q.pt2px(this.evaluatedMeshParams.size),e);if("esriGeometryPoint"===d.geometryType)e=d.readXForDisplay(),d=d.readYForDisplay();else{d=d.readCentroidForDisplay();if(!d)return;e=d?.coords[0];d=d?.coords[1]}f.recordStart(this.instanceId,this.attributeLayout);f.recordBounds(e,d,h,h);h=f.vertexCount();this._writeVertex(f,c,e,d);f.indexWrite(h+0);f.indexWrite(h+1);f.indexWrite(h+2);f.indexWrite(h+
1);f.indexWrite(h+3);f.indexWrite(h+2);f.recordEnd()}}b.PieChartMeshWriter=a;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/util/MatcherContext":function(){define(["exports"],function(b){class q{constructor(n,g,k,l){this.storage=n;this.proxy=g;this.viewParams=k;this.registry=l}async createMeshWriters(n){n=n.map(g=>this.registry.createMeshWriter(this.storage,this.proxy,this.viewParams,g));return Promise.all(n)}}b.MatcherContext=q;Object.defineProperty(b,
Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/ProcessorTileMessageQueue":function(){define(["exports","../../../support/QueueProcessor"],function(b,q){class n{constructor(g){this._outstandingMessages=[];this._queue=new q.QueueProcessor({concurrency:g.concurrency,process:k=>g.process(k)})}async push(g){if(g.end)await Promise.all(this._outstandingMessages),await this._queue.push(g),this._outstandingMessages=[];else return g=this._queue.push(g),this._outstandingMessages.push(g),
g}}b.ProcessorTileMessageQueue=n;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/processor/BinningStrategy":function(){define("exports ../../../../../geometry ../../../../../layers/graphics/featureConversionUtils ../../../../../layers/graphics/OptimizedFeature ../../../../../layers/graphics/data/projectionSupport ../../../../../layers/support/FieldsIndex ../aggregation/ComputedAggregateField ./AAggregateStrategy ./AProcessorStrategy ../sources/FeatureSourceMessage ../sources/strategies/chunks/OverrideChunk ../support/ComputedAttributeStorage ../support/FeatureFilter ../support/FeatureMetadata ../support/FeatureSetReaderJSON ../../../tiling/TileKey ../../../../../geometry/SpatialReference".split(" "),
function(b,q,n,g,k,l,a,f,d,c,e,h,x,m,p,t,w){class r extends d.ASendState{constructor(z,u){super(z);this.bins=new Map;this.featureCache=new Map;this.done=!1;this._store=u}reset(){this.destroy();this.done=!1}invaldateForLocalEditDropped(){this.handledChunks.clear();this.bins.clear()}destroy(){const z=this.subscription.tile.key.level;for(const u of this.featureCache.keys())this._store.releaseDisplayIdForObjectId(`${u}.${z}`);this.bins.clear();this.featureCache.clear();this.handledChunks.clear()}get tile(){return this.subscription.tile}*featuresWorldSpace(){for(const z of this.featureCache.values()){const u=
z.clone();u.geometry&&n.unquantizeOptimizedGeometry(u.geometry,u.geometry,!1,!1,this.subscription.tile.transform);yield u}}}class y extends f.AAggregateStrategy{static async create(z,u,v,A,B){const F=new h.ComputedAttributeStorage({spatialReference:u}),H=await Promise.all(z.fields.map(async E=>a.ComputedAggregateField.create(F,E))),J=z.featureFilter?await x.create({geometryType:v.metadata.geometryType,hasM:!1,hasZ:!1,timeInfo:v.metadata.timeInfo,fieldsIndex:v.metadata.fieldsIndex,spatialReference:u,
filterJSON:z.featureFilter}):null;"geohash"===z.index.type&&await k.checkProjectionSupport(u,w.WGS84);return new y(z,J,B,H,u,v,A)}constructor(z,u,v,A,B,F,H){super(F,H,B,A);this._schema=z;this._featureFilter=u;this._timeZone=v;this._metadata=m.FeatureMetadata.createFeature({geometryType:"esriGeometryPolygon",objectIdField:"aggregateId",fieldsIndex:(new l(z.fields)).toJSON(),globalIdField:null,spatialReference:F.metadata.spatialReference,subtypeField:null,subtypes:null,timeInfo:null,timeReferenceUnknownClient:null,
typeIdField:null,types:null})}createState(z){return new r(z,this._attributeStore)}async *applyLocalEdit(z){for(const u of this._sendStates.values())u.reset(),yield new c.FeatureTileAppendMessage(u.subscription,p.FeatureSetReaderJSON.empty(this._source.metadata),!0,!1,{})}displayMap(z,u,v){z=new Map(z.map(F=>[u(F),F]));const A=[];for(const F of this._sendStates.values())for(const H of F.featuresWorldSpace()){const {objectId:J,displayId:E}=H;var B=z.get(J);null!=B&&(B=v(E,B,J),A.push(B),z.delete(J))}return A}getDisplayFeatures(z){z=
new Set(z);const u=new Set,v=[];for(const A of this._sendStates.values())for(const B of A.featuresWorldSpace())z.has(B.displayId)&&!u.has(B.objectId)&&(B.geometry&&v.push({...n.convertToFeature(B,this._metadata.geometryType,!1,!1),displayId:B.displayId}),u.add(B.objectId));return{features:[],aggregates:v}}getFeatureObjectIdsForAggregate(z){for(const u of this._sendStates.values())for(const v of u.bins.values())if(v.id===z)return Array.from(v.containedObjectIds);return[]}beforeUpdateChunks(){const z=
this._source.chunks();if(z.length){var u=!1;for(const v of z)e.isLocalEditChunk(v)&&v.lastLocalEditDropped!==this._lastHandledLocalEdit&&(this._lastHandledLocalEdit=v.lastLocalEditDropped,u=!0);if(u)for(const v of this._sendStates.values())v.invaldateForLocalEditDropped()}}async *updateChunks(){for(const z of this._sendStates.values())yield*this._update(z,this._source)}forEachAggregateWorldSpace(z){const u=new Set;for(const v of this._sendStates.values())for(const A of v.featuresWorldSpace())u.has(A.objectId)||
(z(A),u.add(A.objectId))}_createIndexOptions(z){switch(this._schema.index.type){case "geohash":return{type:"geohash",fields:this.aggregateFields,featureFilter:this._featureFilter,geohashLevel:this._schema.index.fixBinLevel,spatialReference:this.spatialReference,timeZone:this._timeZone,scale:z.scale};case "grid":const u=this._schema.index.fixedBinLevel;z=null!=u?z.tileInfoView.getLODInfoAt(u).scale:z.scale;return{type:"grid",fields:this.aggregateFields,cellSize:this._schema.index.size,featureFilter:this._featureFilter,
spatialReference:this.spatialReference,timeZone:this._timeZone,scale:z}}}async *_update(z,u){const {handledChunks:v,subscription:A,bins:B,featureCache:F}=z;var H=A.tile;if(!z.done){for(var J of u.chunks())if(!v.has(J.chunkId)){v.add(J.chunkId);var E=J.queryInfo;if("tileId"in E&&(E=new t(E.tileId),E.level!==H.level||E.world!==H.key.world))continue;J.getAggregateIndex(this._createIndexOptions(z.tile)).putBounded(B,z.tile.extent,z.tile.resolution)}H=[];J=A.tile.transform;E=A.tile.key.level;for(var K of B.values()){let C=
F.get(K.id);if(C)C.attributes=K.getAttributes();else{const D=K.getGeometry(this.spatialReference,J);C=new g.OptimizedFeature(D,K.getAttributes(),null);D||(C.centroid=K.getGeometricCentroid(this.spatialReference,J));C.objectId=K.id;C.displayId=this._attributeStore.createDisplayIdForObjectId(`${C.objectId}.${E}`);F.set(K.id,C)}H.push(C)}this.events.emit("changed");z.done=!u.updateTracking.updating;u=p.FeatureSetReaderJSON.fromOptimizedFeatures(H,this._metadata,J);K=u.getCursor();for(H=z.subscription.tile.createArcadeEvaluationOptions(this._timeZone);K.next();)this._attributeStore.setAttributeData(K.getDisplayId(),
K,H);yield new c.FeatureTileUpdateMessage(z.subscription,u,[],z.done,{})}}}b.BinningState=r;b.BinningStrategy=y;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/projectionSupport":function(){define("exports ../../../core/arrayUtils ../../../core/promiseUtils ../../../geometry/projection ../../../geometry/geometryAdapters/json ../../../geometry/support/spatialReferenceUtils ../../../geometry/support/webMercatorUtils".split(" "),function(b,q,n,g,k,l,a){function f(t,
w){if(!w)return null;if("x"in w){var r={x:0,y:0};[r.x,r.y]=t(w.x,w.y,e);null!=w.z&&(r.z=w.z);null!=w.m&&(r.m=w.m);return r}return"xmin"in w?(r={xmin:0,ymin:0,xmax:0,ymax:0},[r.xmin,r.ymin]=t(w.xmin,w.ymin,e),[r.xmax,r.ymax]=t(w.xmax,w.ymax,e),w.hasZ&&(r.zmin=w.zmin,r.zmax=w.zmax,r.hasZ=!0),w.hasM&&(r.mmin=w.mmin,r.mmax=w.mmax,r.hasM=!0),r):"rings"in w?{rings:d(w.rings,t),hasM:w.hasM,hasZ:w.hasZ}:"paths"in w?{paths:d(w.paths,t),hasM:w.hasM,hasZ:w.hasZ}:"points"in w?{points:c(w.points,t),hasM:w.hasM,
hasZ:w.hasZ}:null}function d(t,w){const r=[];for(const y of t)r.push(c(y,w));return r}function c(t,w){const r=[];for(const y of t)t=w(y[0],y[1],[0,0]),r.push(t),2<y.length&&t.push(y[2]),3<y.length&&t.push(y[3]);return r}const e=[0,0],h=f.bind(null,a.lngLatToXY),x=f.bind(null,a.xyToLngLat);class m{constructor(){this._jobs=[];this._timer=null;this._process=this._process.bind(this)}async push(t,w,r,y){if(!t?.length||!w||!r||l.equals(w,r))return t;t={geometries:t,inSpatialReference:w,outSpatialReference:r,
geographicTransformation:y,resolve:n.createResolver()};this._jobs.push(t);this._timer??(this._timer=setTimeout(this._process,10));return t.resolve.promise}_process(){this._timer=null;const t=this._jobs.shift();if(t){var {geometries:w,inSpatialReference:r,outSpatialReference:y,resolve:z,geographicTransformation:u}=t;a.canProject(r,y)?l.isWebMercator(y)?z(w.map(h)):z(w.map(x)):z(g.projectMany(k.jsonAdapter,w,r,y,u,null));0<this._jobs.length&&(this._timer=setTimeout(this._process,10))}}}const p=new m;
b.checkProjectionSupport=async function(t,w){t&&w&&(t=Array.isArray(t)?t.map(r=>null!=r.geometry?r.geometry.spatialReference:null).filter(q.isSome):[t],await g.initializeProjection(t.map(r=>({source:r,dest:w}))))};b.project=function(t,w,r,y){if(!t)return t;r||(r=w,w=t.spatialReference);return l.isValid(w)&&l.isValid(r)&&!l.equals(w,r)?a.canProject(w,r)?(t=l.isWebMercator(r)?h(t):x(t),t.spatialReference=r,t):g.projectMany(k.jsonAdapter,[t],w,r,null,y)[0]:t};b.projectMany=function(t,w,r,y){return p.push(t,
w,r,y)};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/geometryAdapters/json":function(){define(["exports"],function(b){class q{constructor(a,f,d){this.x=a;this.y=f;this.spatialReference=d;this.m=this.z=void 0}}class n{constructor(a,f,d,c){this.rings=a;this.spatialReference=f;this.hasM=this.hasZ=void 0;d&&(this.hasZ=d);c&&(this.hasM=c)}}class g{constructor(a,f,d,c){this.paths=a;this.spatialReference=f;this.hasM=this.hasZ=void 0;d&&(this.hasZ=d);c&&(this.hasM=c)}}class k{constructor(a,
f,d,c){this.points=a;this.spatialReference=f;this.hasM=this.hasZ=void 0;d&&(this.hasZ=d);c&&(this.hasM=c)}}class l{constructor(a,f,d,c,e){this.xmin=a;this.ymin=f;this.xmax=d;this.ymax=c;this.spatialReference=e;this.mmax=this.mmin=this.zmax=this.zmin=void 0}}b.jsonAdapter={convertToGEGeometry:function(a,f){return null==f?null:a.convertJSONToGeometry(f)},exportPoint:function(a,f,d){d=new q(a.getPointX(f),a.getPointY(f),d);const c=a.hasZ(f),e=a.hasM(f);c&&(d.z=a.getPointZ(f));e&&(d.m=a.getPointM(f));
return d},exportPolygon:function(a,f,d){return new n(a.exportPaths(f),d,a.hasZ(f),a.hasM(f))},exportPolyline:function(a,f,d){return new g(a.exportPaths(f),d,a.hasZ(f),a.hasM(f))},exportMultipoint:function(a,f,d){return new k(a.exportPoints(f),d,a.hasZ(f),a.hasM(f))},exportExtent:function(a,f,d){var c=a.hasZ(f);const e=a.hasM(f);d=new l(a.getXMin(f),a.getYMin(f),a.getXMax(f),a.getYMax(f),d);c&&(c=a.getZExtent(f),d.zmin=c.vmin,d.zmax=c.vmax);e&&(a=a.getMExtent(f),d.mmin=a.vmin,d.mmax=a.vmax);return d}};
Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/FieldsIndex":function(){define("../../core/Error ../../core/JSONSupport ../../core/Logger ../../core/MapUtils ../../core/sql/UnknownTimeZone ./fieldUtils ../../time/timeZoneUtils ../../chunks/datetime".split(" "),function(b,q,n,g,k,l,a,f){function d(m){return m.trim().toLowerCase()}function c(m){const p=new Map;if(!m.fields)return p;const t=!0===m.datesInUnknownTimezone,{timeInfo:w,editFieldsInfo:r}=m;var y=(w?"startField"in
w?w.startField:w.startTimeField:"")??"";const z=(w?"endField"in w?w.endField:w.endTimeField:"")??"",u="dateFieldsTimeZone"in m?m.dateFieldsTimeZone??null:m.dateFieldsTimeReference?a.fromTimeReference(m.dateFieldsTimeReference):null,v=r?"timeZone"in r?r.timeZone??u:r.dateFieldsTimeReference?a.fromTimeReference(r.dateFieldsTimeReference):u??a.utc:null,A=w?"timeZone"in w?w.timeZone??u:w.timeReference?a.fromTimeReference(w.timeReference):u:null;y=new Map([[d(r?.creationDateField??""),v],[d(r?.editDateField??
""),v],[d(y),A],[d(z),A]]);for(const {name:B,type:F}of m.fields)x.has(F)?p.set(B,a.unknown):"date"!==F&&"esriFieldTypeDate"!==F?p.set(B,null):t?p.set(B,a.unknown):(m=y.get(d(B??""))??u,p.set(B,m));return p}const e=new Map;class h{static fromJSON(m){return new h(m.fields,m.timeZoneByFieldName)}static fromLayer(m){return new h(m.fields??[],c(m))}static fromLayerJSON(m){return new h(m.fields??[],c(m))}constructor(m=[],p){this._fieldsMap=new Map;this._normalizedFieldsMap=new Map;this._dateFieldsSet=new Set;
this._numericFieldsSet=new Set;this._requiredFields=null;this.dateFields=[];this.numericFields=[];this.fields=m||[];this._timeZoneByFieldName=p?new Map(p):null;m=[];for(const t of this.fields){p=t?.name;const w=l.normalizeFieldName(p)?.toLowerCase()??"";if(p&&w){const r=d(p);this._fieldsMap.set(p,t);this._fieldsMap.set(r,t);this._normalizedFieldsMap.set(w,t);m.push(`${r}:${t.type}:${this._timeZoneByFieldName?.get(p)}`);l.isDateField(t)?(this.dateFields.push(t),this._dateFieldsSet.add(t)):l.isNumericField(t)&&
(this._numericFieldsSet.add(t),this.numericFields.push(t));l.isObjectIDField(t)||l.isGlobalIDField(t)||(t.editable=null==t.editable||!!t.editable,t.nullable=null==t.nullable||!!t.nullable)}}m.sort();this.uid=m.join()}get requiredFields(){if(!this._requiredFields){this._requiredFields=[];for(const m of this.fields)l.isObjectIDField(m)||l.isGlobalIDField(m)||m.nullable||void 0!==l.getFieldDefaultValue(m)||this._requiredFields.push(m)}return this._requiredFields}equals(m){return this.uid===m?.uid}has(m){return null!=
this.get(m)}get(m){if(m){var p=this._fieldsMap.get(m);if(p)return p;(p=this._fieldsMap.get(d(m))??this._normalizedFieldsMap.get(l.normalizeFieldName(m)?.toLowerCase()??""))&&this._fieldsMap.set(m,p);return p}}getTimeZone(m){m=this.get(m&&"string"!==typeof m?m.name:m);return m?this._timeZoneByFieldName?this._timeZoneByFieldName.get(m.name):"date"===m.type||"esriFieldTypeDate"===m.type?(n.getLogger("esri.layers.support.FieldsIndex").error(new b("getTimeZone:no-timezone-information",`no time zone information for field '${m.name}'`)),
a.utc):x.has(m.type)?a.unknown:null:null}getLuxonTimeZone(m){const p=this.getTimeZone(m);return p?p===a.unknown?k.UnknownTimeZone.instance:p===a.utc?f.FixedOffsetZone.utcInstance:g.getOrCreateMapValue(e,p,()=>f.IANAZone.create(p)):null}isDateField(m){return this._dateFieldsSet.has(this.get(m))}isTimeOnlyField(m){return l.isTimeOnlyField(this.get(m))}isNumericField(m){return this._numericFieldsSet.has(this.get(m))}normalizeFieldName(m){return this.get(m)?.name??void 0}toJSON(){return{fields:this.fields.map(m=>
q.isSerializable(m)?m.toJSON():m),timeZoneByFieldName:this._timeZoneByFieldName?Array.from(this._timeZoneByFieldName.entries()):null}}}const x=new Set("time-only date-only timestamp-offset esriFieldTypeDateOnly esriFieldTypeTimeOnly esriFieldTypeTimestampOffset".split(" "));return h})},"esri/core/sql/UnknownTimeZone":function(){define(["exports","../../chunks/datetime"],function(b,q){function n(k){return k instanceof q.Zone?k===g.instance?!0:!1:"unknown"===k?.toString().toLowerCase()?!0:!1}class g{}
g.instance=new q.IANAZone("Etc/UTC");b.UnknownTimeZone=g;b.adoptTimeZone=function(k,l){return q.DateTime.fromObject({day:k.day,year:k.year,month:k.month,hour:k.hour,minute:k.minute,second:k.second,millisecond:k.millisecond},{zone:l})};b.isUnknownTimeZone=n;b.substituteUnknownTimezone=function(k){return n(k)?g.instance:k};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/aggregation/ComputedAggregateField":function(){define(["exports","../support/DictionaryValue"],
function(b,q){class n{static async create(g,k){if("count"===k.statisticType)return g=new q.DictionaryValue(1),new n(k.name,k.alias,k.type,k.statisticType,g);g=await g.createComputedField({expression:k.onStatisticExpression?.expression,field:k.onStatisticField});return new n(k.name,k.alias,k.type,k.statisticType,g)}constructor(g,k,l,a,f){this.name=g;this.alias=k;this.type=l;this.statisticType=a;this.computed=f}}b.ComputedAggregateField=n;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},
"esri/views/2d/layers/features/processor/AAggregateStrategy":function(){define("exports ../../../../../core/Evented ../../../../../geometry/support/aaBoundingBox ../../../../../layers/graphics/featureConversionUtils ../../../../../layers/graphics/data/optimizedFeatureQueryEngineAdapter ../../../../../layers/graphics/data/QueryEngine ./AProcessorStrategy".split(" "),function(b,q,n,g,k,l,a){class f extends a.AProcessorStrategy{constructor(d,c,e,h){super(d,c);this.spatialReference=e;this.aggregateFields=
h;this.events=new q;this.featureAdapter=k.optimizedFeatureQueryEngineAdapter}get aggregateQueryEngine(){this._aggregateQueryEngine||(this._aggregateQueryEngine=new l.QueryEngine({featureStore:this,fieldsIndex:this._metadata.fieldsIndex,geometryType:this._metadata.geometryType,objectIdField:this._metadata.objectIdField,spatialReference:this.spatialReference}));return this._aggregateQueryEngine}removeChunks(d){}forEach(d){return this.forEachAggregateWorldSpace(d)}forEachInBounds(d,c){}forEachBounds(d,
c){const e=n.create();for(const h of d)(d=g.getBoundsOptimizedGeometry(e,h.geometry,!1,!1))&&c(d)}}b.AAggregateStrategy=f;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/optimizedFeatureQueryEngineAdapter":function(){define(["exports","../centroid","../OptimizedFeature","../OptimizedGeometry"],function(b,q,n,g){b.optimizedFeatureQueryEngineAdapter={getObjectId(k){return k.objectId},getAttributes(k){return k.attributes},getAttribute(k,l){return k.attributes[l]},
cloneWithGeometry(k,l){return new n.OptimizedFeature(l,k.attributes,null,k.objectId)},getGeometry(k){return k.geometry},getCentroid(k,l){null==k.centroid&&(k.centroid=q.getCentroidOptimizedGeometry(new g,k.geometry,l.hasZ,l.hasM));return k.centroid}};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/centroid":function(){define(["exports"],function(b){function q(g,k,l,a,f,d){d=f?d?4:3:d?3:2;let c=l,e=l+d,h=0,x=0,m=l=0,p=0;for(let t=0,w=a-1;t<w;t++,c+=d,e+=d){a=k[c];
const r=k[c+1],y=k[c+2],z=k[e],u=k[e+1],v=k[e+2];let A=a*u-z*r;m+=A;h+=(a+z)*A;x+=(r+u)*A;f&&(A=a*v-z*y,l+=(y+v)*A,p+=A);a<g[0]&&(g[0]=a);a>g[1]&&(g[1]=a);r<g[2]&&(g[2]=r);r>g[3]&&(g[3]=r);f&&(y<g[4]&&(g[4]=y),y>g[5]&&(g[5]=y))}0<m&&(m*=-1);0<p&&(p*=-1);if(!m)return null;g=[h,x,.5*m];f&&(g[3]=l,g[4]=.5*p);return g}function n(g,k,l,a,f){f=a?f?4:3:f?3:2;let d=k,c=k+f,e=0,h=0,x=0,m=0;for(let r=0,y=l-1;r<y;r++,d+=f,c+=f){var p=g[d];const z=g[d+1],u=g[d+2],v=g[c],A=g[c+1],B=g[c+2];if(a){var t=v-p;var w=
A-z;const F=B-u;t=Math.sqrt(t*t+w*w+F*F)}else t=v-p,w=A-z,t=Math.sqrt(t*t+w*w);t&&(e+=t,a?(p=[p+.5*(v-p),z+.5*(A-z),u+.5*(B-u)],h+=t*p[0],x+=t*p[1],m+=t*p[2]):(p=[p+.5*(v-p),z+.5*(A-z)],h+=t*p[0],x+=t*p[1]))}return 0<e?a?[h/e,x/e,m/e]:[h/e,x/e]:0<l?a?[g[k],g[k+1],g[k+2]]:[g[k],g[k+1]]:null}b.getCentroidOptimizedGeometry=function(g,k,l,a){if(!k?.lengths.length)return null;g.lengths.length&&(g.lengths.length=0);g.coords.length&&(g.coords.length=0);const f=g.coords,d=[],c=l?[Number.POSITIVE_INFINITY,
Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY]:[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY],{lengths:e,coords:h}=k;var x=l?a?4:3:a?3:2;let m=0;for(const p of e){const t=q(c,h,m,p,l,a);t&&d.push(t);m+=p*x}d.sort((p,t)=>{let w=p[2]-t[2];0===w&&l&&(w=p[4]-t[4]);return w});d.length&&(x=6*d[0][2],f[0]=d[0][0]/x,f[1]=d[0][1]/x,l&&(x=6*d[0][4],f[2]=0!==x?d[0][3]/x:0),f[0]<
c[0]||f[0]>c[1]||f[1]<c[2]||f[1]>c[3]||l&&(f[2]<c[4]||f[2]>c[5]))&&(f.length=0);if(!f.length)if(k=k.lengths[0]?n(h,0,e[0],l,a):null)f[0]=k[0],f[1]=k[1],l&&2<k.length&&(f[2]=k[2]);else return null;return g};b.lineCentroid=n;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/QueryEngine":function(){define("exports ../../../core/arrayUtils ../../../core/Error ../../../core/JSONSupport ../../../core/lang ../../../core/maybe ../../../core/promiseUtils ../../../core/unitUtils ../../../geometry/projection ../../../geometry/support/aaBoundingBox ../../../geometry/support/aaBoundingRect ../../../geometry/support/boundsUtils ../../../geometry/support/jsonUtils ../../../geometry/support/normalizeUtils ../../../geometry/support/spatialReferenceUtils ../featureConversionUtils ./attributeSupport ./geometryUtils ./projectionSupport ./QueryEngineCache ./QueryEngineCapabilities ./QueryEngineResult ./queryUtils ./queryValidationUtils ./spatialQuerySupport ./timeSupport ../../support/FieldsIndex ../../../views/support/Scheduler".split(" "),
function(b,q,n,g,k,l,a,f,d,c,e,h,x,m,p,t,w,r,y,z,u,v,A,B,F,H,J,E){function K(G){if(F.canQueryWithRBush(G)){if(x.isExtent(G))return[e.fromValues(Math.min(G.xmin,G.xmax),Math.min(G.ymin,G.ymax),Math.max(G.xmin,G.xmax),Math.max(G.ymin,G.ymax))];if(x.isPolygon(G))return G.rings.map(N=>e.fromValues(Math.min(N[0][0],N[2][0]),Math.min(N[0][1],N[2][1]),Math.max(N[0][0],N[2][0]),Math.max(N[0][1],N[2][1])))}return[h.getBoundsXY(e.create(),G)]}class C{constructor(G,N=null,Y,ca,ka){this.attributes=G;this.geometry=
Y;this.centroid=ca;this.filterFlags=ka;this.groupId=-1;this.displayId=N}}class D{constructor(G){this._cache=new z.QueryEngineCache;this._changeHandle=null;this.capabilities={query:u.queryCapabilities};this.geometryType=G.geometryType;this.hasM=!!G.hasM;this.hasZ=!!G.hasZ;this.objectIdField=G.objectIdField;this.spatialReference=G.spatialReference;this.definitionExpression=G.definitionExpression;this.featureStore=G.featureStore;this.aggregateAdapter=G.aggregateAdapter;this._changeHandle=this.featureStore.events.on("changed",
()=>this.clearCache());this.timeInfo=G.timeInfo;this.fieldsIndex=g.isSerializable(G.fieldsIndex)?G.fieldsIndex:J.fromJSON(G.fieldsIndex);this.availableFields=!G.availableFields||1===G.availableFields.length&&"*"===G.availableFields[0]?new Set(this.fieldsIndex.fields.map(N=>N.name)):new Set(G.availableFields.map(N=>this.fieldsIndex.get(N)?.name).filter(N=>null!=N));G.scheduler&&G.priority&&(this._frameTask=G.scheduler.registerTask(G.priority))}destroy(){this._frameTask=l.removeMaybe(this._frameTask);
this.clearCache();l.destroyMaybe(this._cache);this._changeHandle=l.removeMaybe(this._changeHandle)}get featureAdapter(){return this.featureStore.featureAdapter}clearCache(){this._cache.clear();this._fullExtentPromise=this._timeExtentPromise=this._allFeaturesPromise=null}async executeQuery(G,N){N=a.signalFromSignalOrOptions(N);try{return await (await this._executeQuery(G,{},N)).createQueryResponse()}catch(Y){if(Y!==A.queryEngineEmptyResult)throw Y;return(new v.QueryEngineResult([],G,this)).createQueryResponse()}}async executeQueryForCount(G=
{},N){N=a.signalFromSignalOrOptions(N);try{return(await this._executeQuery(G,{returnGeometry:!1,returnCentroid:!1,outSR:null},N)).createQueryResponseForCount()}catch(Y){if(Y!==A.queryEngineEmptyResult)throw Y;return 0}}async executeQueryForExtent(G,N){N=a.signalFromSignalOrOptions(N);const Y=G.outSR;try{const ca=await this._executeQuery(G,{returnGeometry:!0,returnCentroid:!1,outSR:null},N),ka=ca.size;if(!ka)return{count:0,extent:null};const Q=await this._getBounds(ca.items,ca.spatialReference,Y||
this.spatialReference);return{count:ka,extent:Q}}catch(ca){if(ca===A.queryEngineEmptyResult)return{count:0,extent:null};throw ca;}}async executeQueryForIds(G,N){return this.executeQueryForIdSet(G,N).then(Y=>Array.from(Y))}async executeQueryForIdSet(G,N){N=a.signalFromSignalOrOptions(N);try{const Y=await this._executeQuery(G,{returnGeometry:!0,returnCentroid:!1,outSR:null},N),ca=Y.items,ka=new Set;await this._reschedule(()=>{for(const Q of ca)ka.add(Y.featureAdapter.getObjectId(Q))},N);return ka}catch(Y){if(Y===
A.queryEngineEmptyResult)return new Set;throw Y;}}async executeQueryForSnapping(G,N){const Y=a.signalFromSignalOrOptions(N),{point:ca,distance:ka,returnEdge:Q,vertexMode:R}=G;if(!Q&&"none"===R)return{candidates:[]};let Z=k.clone(G.query);Z=await this._schedule(()=>A.normalizeQueryLike(Z,this.definitionExpression,this.spatialReference),Y);Z=await this._reschedule(()=>B.validateQuery(Z,{availableFields:this.availableFields,fieldsIndex:this.fieldsIndex,geometryType:this.geometryType,spatialReference:this.spatialReference}),
Y);(N=!p.equals(ca.spatialReference,this.spatialReference))&&await y.checkProjectionSupport(ca.spatialReference,this.spatialReference);var da="number"===typeof ka?ka:ka.x,ja="number"===typeof ka?ka:ka.y;da={xmin:ca.x-da,xmax:ca.x+da,ymin:ca.y-ja,ymax:ca.y+ja,spatialReference:ca.spatialReference};da=N?y.project(da,this.spatialReference):da;if(!da)return{candidates:[]};ja=(await m.normalizeCentralMeridian(x.fromJSON(ca),null,{signal:Y}))[0];const W=(await m.normalizeCentralMeridian(x.fromJSON(da),null,
{signal:Y}))[0];if(null==ja||null==W)return{candidates:[]};const aa=new v.QueryEngineResult(await this._reschedule(()=>this._searchFeatures(K(W.toJSON())),Y),Z,this);await this._reschedule(()=>this._executeObjectIdsQuery(aa),Y);await this._reschedule(()=>this._executeTimeQuery(aa),Y);await this._reschedule(()=>this._executeAttributesQuery(aa),Y);await this._reschedule(()=>this._executeGeometryQueryForSnapping(aa,Y),Y);ja=ja.toJSON();ja=N?y.project(ja,this.spatialReference):ja;return aa.createSnappingResponse({...G,
point:ja,distance:N?Math.max(da.xmax-da.xmin,da.ymax-da.ymin)/2:ka},ca.spatialReference)}async executeQueryForLatestObservations(G,N){N=a.signalFromSignalOrOptions(N);if(!this.timeInfo?.trackIdField)throw new n("unsupported-query","Missing timeInfo or timeInfo.trackIdField",{query:G,timeInfo:this.timeInfo});try{const Y=await this._executeQuery(G,{},N);await this._reschedule(()=>this._filterLatest(Y),N);return await Y.createQueryResponse()}catch(Y){if(Y!==A.queryEngineEmptyResult)throw Y;return(new v.QueryEngineResult([],
G,this)).createQueryResponse()}}async executeQueryForSummaryStatistics(G={},N,Y){Y=a.signalFromSignalOrOptions(Y);const {field:ca,normalizationField:ka,valueExpression:Q}=N;return(await this._executeQueryForStatistics(G,{field:ca,normalizationField:ka,valueExpression:Q},Y)).createSummaryStatisticsResponse(N)}async executeQueryForUniqueValues(G={},N,Y){Y=a.signalFromSignalOrOptions(Y);const {field:ca,field2:ka,field3:Q,valueExpression:R}=N;return(await this._executeQueryForStatistics(G,{field:ca,field2:ka,
field3:Q,valueExpression:R},Y)).createUniqueValuesResponse(N)}async executeQueryForClassBreaks(G={},N,Y){Y=a.signalFromSignalOrOptions(Y);const {field:ca,normalizationField:ka,valueExpression:Q}=N;return(await this._executeQueryForStatistics(G,{field:ca,normalizationField:ka,valueExpression:Q},Y)).createClassBreaksResponse(N)}async executeQueryForHistogram(G={},N,Y){Y=a.signalFromSignalOrOptions(Y);const {field:ca,normalizationField:ka,valueExpression:Q}=N;return(await this._executeQueryForStatistics(G,
{field:ca,normalizationField:ka,valueExpression:Q},Y)).createHistogramResponse(N)}async fetchRecomputedExtents(G){G=a.signalFromSignalOrOptions(G);this._timeExtentPromise||(this._timeExtentPromise=H.getTimeExtent(this.timeInfo,this.featureStore));const [N,Y]=await Promise.all([this._getFullExtent(),this._timeExtentPromise]);a.throwIfAborted(G);return{fullExtent:N,timeExtent:Y}}async _getBounds(G,N,Y){const ca=c.set(c.create(),c.negativeInfinity);await this.featureStore.forEachBounds(G,ka=>c.expandWithAABB(ca,
ka));G={xmin:ca[0],ymin:ca[1],xmax:ca[3],ymax:ca[4],spatialReference:r.cleanFromGeometryEngine(this.spatialReference)};this.hasZ&&isFinite(ca[2])&&isFinite(ca[5])&&(G.zmin=ca[2],G.zmax=ca[5],G.hasZ=!0);N=y.project(G,N,Y);N.spatialReference=r.cleanFromGeometryEngine(Y);0===N.xmax-N.xmin&&(Y=f.getMetersPerUnitForSR(N.spatialReference),N.xmin-=Y,N.xmax+=Y);0===N.ymax-N.ymin&&(Y=f.getMetersPerUnitForSR(N.spatialReference),N.ymin-=Y,N.ymax+=Y);this.hasZ&&null!=N.zmin&&null!=N.zmax&&0===N.zmax-N.zmin&&
(Y=f.getMetersPerUnitForSR(N.spatialReference),N.zmin-=Y,N.zmax+=Y);return N}_getFullExtent(){this._fullExtentPromise||(this._fullExtentPromise="getFullExtent"in this.featureStore&&this.featureStore.getFullExtent?Promise.resolve(this.featureStore.getFullExtent(this.spatialReference)):this._getAllFeatures().then(G=>this._getBounds(G,this.spatialReference,this.spatialReference)));return this._fullExtentPromise}async _schedule(G,N){return null!=this._frameTask?this._frameTask.schedule(G,N):G(E.noBudget)}async _reschedule(G,
N){return null!=this._frameTask?this._frameTask.reschedule(G,N):G(E.noBudget)}async _getAllFeaturesQueryEngineResult(G){return new v.QueryEngineResult(await this._getAllFeatures(),G,this)}async _getAllFeatures(){if(null==this._allFeaturesPromise){const Y=[];this._allFeaturesPromise=(async()=>{await this.featureStore.forEach(ca=>Y.push(ca))})().then(()=>Y)}const G=this._allFeaturesPromise,N=await G;return G===this._allFeaturesPromise?N.slice():this._getAllFeatures()}async _executeQuery(G,N,Y){G=k.clone(G);
G=await this._schedule(()=>A.normalizeQuery(G,this.definitionExpression,this.spatialReference),Y);G=await this._reschedule(()=>B.validateQuery(G,{availableFields:this.availableFields,fieldsIndex:this.fieldsIndex,geometryType:this.geometryType,spatialReference:this.spatialReference}),Y);G={...G,...N};const ca=await this._reschedule(()=>this._executeSceneFilterQuery(G,Y),Y),ka=await this._reschedule(()=>this._executeGeometryQuery(G,ca,Y),Y);await this._reschedule(()=>this._executeAggregateIdsQuery(ka),
Y);await this._reschedule(()=>this._executeObjectIdsQuery(ka),Y);await this._reschedule(()=>this._executeTimeQuery(ka),Y);await this._reschedule(()=>this._executeAttributesQuery(ka),Y);return ka}async _executeSceneFilterQuery(G,N){if(null==G.sceneFilter)return null;const {outSR:Y,returnGeometry:ca,returnCentroid:ka}=G;var Q=this.featureStore.featureSpatialReference,R=G.sceneFilter.geometry;const Z=null==Q||p.equals(Q,R.spatialReference)?R:y.project(R,Q);if(!Z)return null;Q=ca||ka;Q=p.isValid(Y)&&
!p.equals(this.spatialReference,Y)&&Q?async aa=>this._project(aa,Y):aa=>aa;const da=this.featureAdapter;R=await this._reschedule(()=>this._searchFeatures(K(Z)),N);if("disjoint"===G.sceneFilter.spatialRelationship){if(!R.length)return null;const aa=new Set;for(var ja of R)aa.add(da.getObjectId(ja));const ia=await this._reschedule(()=>this._getAllFeatures(),N);ja=await this._reschedule(async()=>{const qa=await F.getSpatialQueryOperator("esriSpatialRelDisjoint",Z,this.geometryType,this.hasZ,this.hasM),
sa=await this._runSpatialFilter(ia,ya=>!aa.has(da.getObjectId(ya))||qa(da.getGeometry(ya)),N);return new v.QueryEngineResult(sa,G,this)},N);return Q(ja)}if(!R.length)return new v.QueryEngineResult([],G,this);if(this._canExecuteSinglePass(Z,G))return Q(new v.QueryEngineResult(R,G,this));const W=await F.getSpatialQueryOperator("esriSpatialRelContains",Z,this.geometryType,this.hasZ,this.hasM);ja=await this._runSpatialFilter(R,aa=>W(da.getGeometry(aa)),N);return Q(new v.QueryEngineResult(ja,G,this))}async _executeGeometryQuery(G,
N,Y){if(null!=N&&0===N.items.length)return N;G=null!=N?N.query:G;const {geometry:ca,outSR:ka,spatialRel:Q,returnGeometry:R,returnCentroid:Z}=G;var da=this.featureStore.featureSpatialReference;const ja=!ca||null==da||p.equals(da,ca.spatialReference)?ca:y.project(ca,da),W=R||Z,aa=p.isValid(ka)&&!p.equals(this.spatialReference,ka),ia=null==N?this._getCacheKey(G):null;da=ia?this._cache.get(ia):null;if(null!=da)return new v.QueryEngineResult(da,G,this);da=async wa=>{aa&&W&&await this._project(wa,ka);ia&&
this._cache.put(ia,wa.items);return wa};if(!ja)return da(null!=N?N:await this._getAllFeaturesQueryEngineResult(G));const qa=this.featureAdapter;let sa=await this._reschedule(()=>this._searchFeatures(K(ca)),Y);if("esriSpatialRelDisjoint"===Q){if(!sa.length)return da(null!=N?N:await this._getAllFeaturesQueryEngineResult(G));const wa=new Set;for(var ya of sa)wa.add(qa.getObjectId(ya));const M=null!=N?N.items:await this._reschedule(()=>this._getAllFeatures(),Y);ya=await this._reschedule(async()=>{const L=
await F.getSpatialQueryOperator(Q,ja,this.geometryType,this.hasZ,this.hasM),T=await this._runSpatialFilter(M,ha=>!wa.has(qa.getObjectId(ha))||L(qa.getGeometry(ha)),Y);return new v.QueryEngineResult(T,G,this)},Y);return da(ya)}if(null!=N){const wa=new q.PositionHint;sa=sa.filter(M=>0<=q.indexOf(N.items,M,N.items.length,wa))}if(!sa.length)return da=new v.QueryEngineResult([],G,this),ia&&this._cache.put(ia,da.items),da;if(this._canExecuteSinglePass(ja,G))return da(new v.QueryEngineResult(sa,G,this));
const va=await F.getSpatialQueryOperator(Q,ja,this.geometryType,this.hasZ,this.hasM);ya=await this._runSpatialFilter(sa,wa=>va(qa.getGeometry(wa)),Y);return da(new v.QueryEngineResult(ya,G,this))}async _executeGeometryQueryForSnapping(G,N){const {query:Y}=G,{spatialRel:ca}=Y;if(G?.items?.length&&Y.geometry&&ca){var ka=await F.getSpatialQueryOperator(ca,Y.geometry,this.geometryType,this.hasZ,this.hasM);N=await this._runSpatialFilter(G.items,Q=>ka(Q.geometry),N);G.items=N}}_executeAggregateIdsQuery(G){if(0!==
G.items.length&&G.query.aggregateIds?.length&&null!=this.aggregateAdapter){var N=new Set;for(const ca of G.query.aggregateIds)this.aggregateAdapter.getFeatureObjectIds(ca).forEach(ka=>N.add(ka));var Y=this.featureAdapter.getObjectId;G.items=G.items.filter(ca=>N.has(Y(ca)))}}_executeObjectIdsQuery(G){if(0!==G.items.length&&G.query.objectIds?.length){var N=new Set(G.query.objectIds),Y=this.featureAdapter.getObjectId;G.items=G.items.filter(ca=>N.has(Y(ca)))}}_executeTimeQuery(G){if(0!==G.items.length){var N=
H.getTimeOperator(this.timeInfo,G.query.timeExtent,this.featureAdapter);null!=N&&(G.items=G.items.filter(N))}}_executeAttributesQuery(G){if(0!==G.items.length){var N=w.getWhereClause(G.query.where,this.fieldsIndex);if(N){if(!N.isStandardized)throw new TypeError("Where clause is not standardized");G.items=G.items.filter(Y=>N.testFeature(Y,this.featureAdapter))}}}async _runSpatialFilter(G,N,Y){if(!N)return G;if(null==this._frameTask)return G.filter(R=>N(R));let ca=0;const ka=[],Q=async R=>{for(;ca<
G.length;){const Z=G[ca++];N(Z)&&(ka.push(Z),R.madeProgress());R.done&&await this._reschedule(da=>Q(da),Y)}};return this._reschedule(R=>Q(R),Y).then(()=>ka)}_filterLatest(G){const {trackIdField:N,startTimeField:Y,endTimeField:ca}=this.timeInfo,ka=ca||Y,Q=new Map,R=this.featureAdapter.getAttribute;for(const Z of G.items){const da=R(Z,N),ja=R(Z,ka),W=Q.get(da);(!W||ja>R(W,ka))&&Q.set(da,Z)}G.items=Array.from(Q.values())}_getCacheKey(G){const {geometry:N,spatialRel:Y,returnGeometry:ca,returnCentroid:ka,
outSR:Q,resultType:R,cacheHint:Z}=G;if("tile"!==R&&!Z)return null;G=ca||ka;return p.isValid(Q)&&!p.equals(this.spatialReference,Q)&&G?JSON.stringify([N,Y,Q]):JSON.stringify([N,Y])}_canExecuteSinglePass(G,N){({spatialRel:N}=N);return F.canQueryWithRBush(G)&&("esriSpatialRelEnvelopeIntersects"===N||"esriGeometryPoint"===this.geometryType&&("esriSpatialRelIntersects"===N||"esriSpatialRelContains"===N))}async _project(G,N){if(!N||p.equals(this.spatialReference,N))return G;const Y=this.featureAdapter;
let ca=void 0;try{const ka=await this._getFullExtent();ca=d.getTransformation(this.spatialReference,N,ka)}catch{}N=await y.projectMany(G.items.map(ka=>r.getGeometry(this.geometryType,this.hasZ,this.hasM,Y.getGeometry(ka))),this.spatialReference,N,ca);G.items=N.map((ka,Q)=>Y.cloneWithGeometry(G.items[Q],t.convertFromGeometry(ka,this.hasZ,this.hasM)));return G}async _searchFeatures(G){const N=new Set;await Promise.all(G.map(Y=>this.featureStore.forEachInBounds(Y,ca=>N.add(ca))));G=Array.from(N.values());
N.clear();return G}async _executeQueryForStatistics(G,N,Y){G=k.clone(G);try{G=await this._schedule(()=>A.normalizeQuery(G,this.definitionExpression,this.spatialReference),Y);G=await this._reschedule(()=>B.validateStatisticsQuery(G,N,{availableFields:this.availableFields,fieldsIndex:this.fieldsIndex,geometryType:this.geometryType,spatialReference:this.spatialReference}),Y);const ca=await this._reschedule(()=>this._executeSceneFilterQuery(G,Y),Y),ka=await this._reschedule(()=>this._executeGeometryQuery(G,
ca,Y),Y);await this._reschedule(()=>this._executeAggregateIdsQuery(ka),Y);await this._reschedule(()=>this._executeObjectIdsQuery(ka),Y);await this._reschedule(()=>this._executeTimeQuery(ka),Y);await this._reschedule(()=>this._executeAttributesQuery(ka),Y);return ka}catch(ca){if(ca!==A.queryEngineEmptyResult)throw ca;return new v.QueryEngineResult([],G,this)}}}b.Feature=C;b.QueryEngine=D;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/normalizeUtils":function(){define("exports ../../config ../../core/Error ../../core/Logger ../Polygon ../Polyline ./normalizeUtilsCommon ./spatialReferenceUtils ./webMercatorUtils ../../rest/geometryService/cut ../../rest/geometryService/simplify".split(" "),
function(b,q,n,g,k,l,a,f,d,c,e){function h(y){const z=[];let u=0,v=0;for(let A=0;A<y.length;A++){const B=y[A];let F=null;for(let H=0;H<B.length;H++)F=B[H],z.push(F),0===H?v=u=F[0]:(u=Math.min(u,F[0]),v=Math.max(v,F[0]));F&&z.push([(u+v)/2,0])}return z}function x(y,z){if(!(y instanceof l||y instanceof k))throw r().error("straightLineDensify: the input geometry is neither polyline nor polygon"),new n("straightLineDensify: the input geometry is neither polyline nor polygon");var u=a.getGeometryParts(y);
const v=[];for(const B of u){u=[];v.push(u);u.push([B[0][0],B[0][1]]);for(let F=0;F<B.length-1;F++){const H=B[F][0],J=B[F][1],E=B[F+1][0],K=B[F+1][1];var A=Math.sqrt((E-H)*(E-H)+(K-J)*(K-J));const C=(K-J)/A,D=(E-H)/A,G=A/z;if(1<G){for(let N=1;N<=G-1;N++){const Y=N*z;u.push([D*Y+H,C*Y+J])}A=(A+Math.floor(G-1)*z)/2;u.push([D*A+H,C*A+J])}u.push([E,K])}}return"polygon"===y.type?new k({rings:v,spatialReference:y.spatialReference}):new l({paths:v,spatialReference:y.spatialReference})}function m(y,z,u){z&&
(y=x(y,1E6),y=d.webMercatorToGeographic(y,!0));u&&(y=a.updatePolyGeometry(y,u));return y}function p(y,z,u){if(Array.isArray(y)){var v=y[0];v>z?(u=a.offsetMagnitude(v,z),y[0]=v+-2*u*z):v<u&&(z=a.offsetMagnitude(v,u),y[0]=v+-2*z*u)}else v=y.x,v>z?(u=a.offsetMagnitude(v,z),y=y.clone().offset(-2*u*z,0)):v<u&&(z=a.offsetMagnitude(v,u),y=y.clone().offset(-2*z*u,0));return y}function t(y,z){let u=-1;for(let v=0;v<z.cutIndexes.length;v++){const A=z.cutIndexes[v],B=z.geometries[v],F=a.getGeometryParts(B);
for(let H=0;H<F.length;H++){const J=F[H];J.some(E=>{if(180>E[0])return!0;E=0;for(var K=0;K<J.length;K++){var C=J[K][0];E=C>E?C:E}E=Number(E.toFixed(9));E=-360*a.offsetMagnitude(E,180);for(K=0;K<J.length;K++)C=B.getPoint(H,K),B.setPoint(H,K,C.clone().offset(E,0));return!0})}if(A===u)if("polygon"===y[0].type)for(const H of a.getGeometryParts(B))y[A]=y[A].addRing(H);else{if("polyline"===y[0].type)for(const H of a.getGeometryParts(B))y[A]=y[A].addPath(H)}else u=A,y[A]=B}return y}async function w(y,z,
u){if(!Array.isArray(y))return w([y],z);z&&"string"!==typeof z&&r().warn("normalizeCentralMeridian()","The url object is deprecated, use the url string instead");var v="string"===typeof z?z:z?.url??q.geometryServiceUrl;let A,B,F;let H=0;var J=[];z=[];for(var E of y)if(null==E)z.push(E);else{if(!K){var K=E.spatialReference;var C=f.getInfo(K);var D=(A=K.isWebMercator)?102100:4326;B=a.cutParams[D].maxX;F=a.cutParams[D].minX;var G=a.cutParams[D].plus180Line;D=a.cutParams[D].minus180Line}if(C)if("mesh"===
E.type)z.push(E);else if("point"===E.type)z.push(p(E.clone(),B,F));else if("multipoint"===E.type){var N=E.clone();N.points=N.points.map(Y=>p(Y,B,F));z.push(N)}else if("extent"===E.type)N=E.clone()._normalize(!1,!1,C),z.push(N.rings?new k(N):N);else if(E.extent){N=E.extent;const Y=2*a.offsetMagnitude(N.xmin,F)*B;let ca=0===Y?E.clone():a.updatePolyGeometry(E.clone(),Y);N.offset(Y,0);let {xmin:ka,xmax:Q}=N;ka=Number(ka.toFixed(9));Q=Number(Q.toFixed(9));N.intersects(G)&&Q!==B?(H=Q>H?Q:H,ca=m(ca,A),J.push(ca),
z.push("cut")):N.intersects(D)&&ka!==F?(H=2*Q*B>H?2*Q*B:H,ca=m(ca,A,360),J.push(ca),z.push("cut")):z.push(ca)}else z.push(E.clone());else z.push(E)}K=a.offsetMagnitude(H,B);C=-90;G=K;for(E=new l;0<K;)D=-180+360*K,E.addPath([[D,C],[D,-1*C]]),C*=-1,K--;if(0<J.length&&0<G){K=await c.cut(v,J,E,u);K=t(J,K);C=[];J=[];for(G=0;G<z.length;G++)E=z[G],"cut"!==E?J.push(E):(E=K.shift(),D=y[G],null!=D&&"polygon"===D.type&&D.rings&&1<D.rings.length&&E.rings.length>=D.rings.length?(C.push(E),J.push("simplify")):
J.push(A?d.geographicToWebMercator(E):E));if(!C.length)return J;z=await e.simplify(v,C,u);y=[];for(u=0;u<J.length;u++)v=J[u],"simplify"!==v?y.push(v):y.push(A?d.geographicToWebMercator(z.shift()):z.shift());return y}y=[];for(u=0;u<z.length;u++)v=z[u],"cut"!==v?y.push(v):(v=J.shift(),y.push(!0===A?d.geographicToWebMercator(v):v));return y}const r=()=>g.getLogger("esri.geometry.support.normalizeUtils");b.getClosestDenormalizedXToReference=function(y,z,u){u=f.getInfo(u);if(null==u)return y;const [v,
A]=u.valid;u=2*A;let B=0,F=0;z>A?B=Math.ceil(Math.abs(z-A)/u):z<v&&(B=-Math.ceil(Math.abs(z-v)/u));y>A?F=Math.ceil(Math.abs(y-A)/u):y<v&&(F=-Math.ceil(Math.abs(y-v)/u));y+=(B-F)*u;z=y-z;z>A?y-=u:z<v&&(y+=u);return y};b.getDenormalizedExtent=function(y){if(!y)return null;const z=y.extent;if(!z)return null;var u=y.spatialReference&&f.getInfo(y.spatialReference);if(!u)return z;const [v,A]=u.valid;({width:u}=z);let {xmin:B,xmax:F}=z;[B,F]=[F,B];if("extent"===y.type||0===u||u<=A||u>2*A||B<v||F>A)return z;
let H;switch(y.type){case "polygon":if(1<y.rings.length)H=h(y.rings);else return z;break;case "polyline":if(1<y.paths.length)H=h(y.paths);else return z;break;case "multipoint":H=y.points}y=z.clone();for(let J=0;J<H.length;J++){let E=H[J][0];0>E?(E+=A,F=Math.max(E,F)):(E-=A,B=Math.min(E,B))}y.xmin=B;y.xmax=F;return y.width<u?(y.xmin-=A,y.xmax-=A,y):z};b.normalizeCentralMeridian=w;b.normalizeMapX=function(y,z){if(z=f.getInfo(z)){const [u,v]=z.valid;z=v-u;if(y<u)for(;y<u;)y+=z;if(y>v)for(;y>v;)y-=z}return y};
b.straightLineDensify=x;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/normalizeUtilsCommon":function(){define(["exports","../Polyline","../SpatialReference","./jsonUtils"],function(b,q,n,g){function k(l){return g.isPolygon(l)?l.rings:l.paths}q={102100:{maxX:2.0037508342788905E7,minX:-2.0037508342788905E7,plus180Line:new q({paths:[[[2.0037508342788905E7,-2.0037508342788905E7],[2.0037508342788905E7,2.0037508342788905E7]]],spatialReference:n.WebMercator}),minus180Line:new q({paths:[[[-2.0037508342788905E7,
-2.0037508342788905E7],[-2.0037508342788905E7,2.0037508342788905E7]]],spatialReference:n.WebMercator})},4326:{maxX:180,minX:-180,plus180Line:new q({paths:[[[180,-180],[180,180]]],spatialReference:n.WGS84}),minus180Line:new q({paths:[[[-180,-180],[-180,180]]],spatialReference:n.WGS84})}};b.cutParams=q;b.getGeometryParts=k;b.offsetMagnitude=function(l,a){return Math.ceil((l-a)/(2*a))};b.updatePolyGeometry=function(l,a){const f=k(l);for(const d of f)for(const c of d)c[0]+=a;return l};Object.defineProperty(b,
Symbol.toStringTag,{value:"Module"})})},"esri/rest/geometryService/cut":function(){define("exports ../../geometry ../../request ../../geometry/support/jsonUtils ../../geometry/support/spatialReferenceUtils ../utils".split(" "),function(b,q,n,g,k,l){b.cut=async function(a,f,d,c){a=l.parseUrl(a);const e=f[0].spatialReference;f={...c,responseType:"json",query:{...a.query,f:"json",sr:k.srToRESTValue(e),target:JSON.stringify({geometryType:g.getJsonType(f[0]),geometries:f}),cutter:JSON.stringify(d)}};f=
await n(a.path+"/cut",f);const {cutIndexes:h,geometries:x=[]}=f.data;return{cutIndexes:h,geometries:x.map(m=>{m=g.fromJSON(m);m.spatialReference=e;return m})}};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/rest/utils":function(){define("exports ../config ../kernel ../core/lang ../core/urlUtils ../support/apiKeyUtils".split(" "),function(b,q,n,g,k,l){function a(f,d,c){const e={};for(const x in f)if("declaredClass"!==x){var h=f[x];null!=h&&"function"!==typeof h&&(Array.isArray(h)?
e[x]=h.map(m=>a(m)):"object"===typeof h?h.toJSON?(h=h.toJSON(c?.[x]),e[x]=d?h:JSON.stringify(h)):e[x]=d?h:JSON.stringify(h):e[x]=h)}return e}b.asValidOptions=function(f,d){return d?{...d,query:{...(f??{}),...d.query}}:{query:f}};b.encode=a;b.getToken=function(f,d){return f?l.isApiKeyApplicable(f,d)?d||q.apiKey:n.id?.findCredential(f)?.token:null};b.parseUrl=function(f){return"string"===typeof f?k.urlToObject(f):g.clone(f)};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/rest/geometryService/simplify":function(){define("exports ../../request ../../core/urlUtils ../../geometry/support/jsonUtils ../../geometry/support/spatialReferenceUtils ./utils".split(" "),
function(b,q,n,g,k,l){b.simplify=async function(a,f,d){const c="string"===typeof a?n.urlToObject(a):a;a=f[0].spatialReference;const e=g.getJsonType(f[0]);f={...d,query:{...c.query,f:"json",sr:k.srToRESTValue(a),geometries:JSON.stringify(l.encodeGeometries(f))}};({data:f}=await q(c.path+"/simplify",f));return l.decodeGeometries(f.geometries,e,a)};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/rest/geometryService/utils":function(){define(["exports","../../geometry/support/jsonUtils"],
function(b,q){b.decodeGeometries=function(n,g,k){const l=q.getGeometryType(g);return n.map(a=>{a=l.fromJSON(a);a.spatialReference=k;return a})};b.encodeGeometries=function(n){return{geometryType:q.getJsonType(n[0]),geometries:n.map(g=>g.toJSON())}};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/attributeSupport":function(){define(["exports","../../../core/Error","../../../core/sql/WhereClauseCache","../../support/fieldType"],function(b,q,n,g){function k(m,
p,t={}){const w=l(p,m);if(!w)throw t=e.getError(p,m),new q("unsupported-query","invalid SQL expression",{expression:p,error:t});m=t.expressionName||"expression";if(t.validateStandardized&&!w.isStandardized)throw new q("unsupported-query",`${m} is not standard`,{expression:p});if(t.validateAggregate&&!w.isAggregate)throw new q("unsupported-query",`${m} does not contain a valid aggregate function`,{expression:p});return w.fieldNames}function l(m,p){return m?e.get(m,p):null}function a(m){return/\((.*?)\)/.test(m)?
m:m.split(" as ")[0]}function f(m,p,t,w={}){const r=new Map;d(r,m,p,w.allowedFieldTypes??x,t);if(r.size)throw new q("unsupported-query",`${w.expressionName??"expression"} contains invalid or missing fields`,{errors:Array.from(r.values()),query:w.query});}function d(m,p,t,w,r){r=r.includes("*")?[...t,...r.filter(y=>"*"!==y)]:r;for(const y of r)if(p.get(y))c(m,p,t,w,y);else try{const z=a(y),u=k(p,z,{validateStandardized:!0});for(const v of u)c(m,p,t,w,v)}catch(z){m.set(y,{type:"expression-error",expression:y,
error:z})}}function c(m,p,t,w,r){(p=p.get(r))?t.has(p.name)?"all"!==w&&!1===w?.has(p.type)&&m.set(r,{type:"invalid-type",fieldName:p.name,fieldType:g.kebabDict.fromJSON(p.type),allowedFieldTypes:Array.from(w,y=>g.kebabDict.fromJSON(y))}):m.set(r,{type:"missing-field",fieldName:p.name}):m.set(r,{type:"invalid-field",fieldName:r})}const e=new n.WhereClauseCache(50,500);n=new Set("esriFieldTypeOID esriFieldTypeSmallInteger esriFieldTypeBigInteger esriFieldTypeInteger esriFieldTypeSingle esriFieldTypeDouble esriFieldTypeLong".split(" "));
const h=new Set(["esriFieldTypeDate","esriFieldTypeDateOnly","esriFieldTypeTimeOnly","esriFieldTypeTimestampOffset"]),x=new Set(["esriFieldTypeString","esriFieldTypeGUID","esriFieldTypeGlobalID",...n,...h]);b.allDateAndTimeFieldTypes=h;b.getAliasFromFieldName=function(m){return m.split(" as ")[1]};b.getExpressionFromFieldName=a;b.getWhereClause=l;b.numericFieldTypes=n;b.validateFields=f;b.validateHaving=function(m,p,t,w,r){if(!t)return!0;const y=k(m,t,{validateAggregate:!0,expressionName:"having clause"});
f(m,p,y,{expressionName:"having clause",query:r});if(!l(t,m)?.getExpressions().every(z=>{const {aggregateType:u,field:v}=z,A=m.get(v)?.name;return w.some(B=>{const {onStatisticField:F,statisticType:H}=B;return m.get(F)?.name===A&&H.toLowerCase().trim()===u})}))throw new q("unsupported-query","expressions in having clause should also exist in outStatistics",{having:t});return!0};b.validateWhere=function(m,p,t,w){if(!t)return!0;t=k(m,t,{validateStandardized:!0,expressionName:"where clause"});f(m,p,
t,{expressionName:"where clause",query:w});return!0};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/core/sql/WhereClauseCache":function(){define(["exports","../LRUCache","./WhereClause"],function(b,q,n){class g{constructor(k,l){this._cache=new q.LRUCache(k);this._invalidCache=new q.LRUCache(l)}get(k,l){const a=`${l.uid}:${k}`,f=this._cache.get(a);if(f)return f;if(null!=this._invalidCache.get(a))return null;try{const d=n.WhereClause.create(k,{fieldsIndex:l});this._cache.put(a,
d);return d}catch(d){return this._invalidCache.put(a,d),null}}getError(k,l){return this._invalidCache.get(`${l.uid}:${k}`)??null}}b.WhereClauseCache=g;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/core/LRUCache":function(){define(["exports","./MemCache"],function(b,q){class n{constructor(g,k){this._storage=new q.MemCacheStorage;this.name=this.id="";this.size=0;this._storage.maxSize=g;this._storage.register(this);k&&this._storage.registerRemoveFunc("",k)}destroy(){this._storage.deregister(this);
this._storage.destroy()}put(g,k,l=1){this._storage.put(this,g,k,l,1)}pop(g){return this._storage.pop(this,g)}get(g){return this._storage.get(this,g)}clear(){this._storage.clearAll()}get maxSize(){return this._storage.maxSize}set maxSize(g){this._storage.maxSize=g}resetHitRate(){}}b.LRUCache=n;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/core/MemCache":function(){define(["exports","./PooledArray"],function(b,q){b.RemoveMode=void 0;(function(a){a[a.ALL=0]="ALL";a[a.SOME=1]=
"SOME"})(b.RemoveMode||(b.RemoveMode={}));class n{constructor(a,f,d){this.name=a;this._storage=f;this.id=`${k++}:`;this.size=0;this.maxSize=-1;this._removeFunc=!1;this._miss=this._hit=0;this._storage.register(this);d&&(this._storage.registerRemoveFunc(this.id,d),this._removeFunc=!0)}destroy(){this._storage.clear(this);this._removeFunc&&this._storage.deregisterRemoveFunc(this.id);this._storage.deregister(this);this._storage=null}get hitRate(){return this._hit/(this._hit+this._miss)}get storageSize(){return this._storage.size}getSize(a){return this._storage.getSize(this,
a)}resetHitRate(){this._hit=this._miss=0}put(a,f,d,c=0){this._storage.put(this,a,f,d,c)}pop(a){a=this._storage.pop(this,a);void 0===a?++this._miss:++this._hit;return a}get(a){a=this._storage.get(this,a);void 0===a?++this._miss:++this._hit;return a}peek(a){return this._storage.peek(this,a)}updateSize(a,f,d){this._storage.updateSize(this,a,f,d)}clear(){this._storage.clear(this)}clearAll(){this._storage.clearAll()}get performanceInfo(){return this._storage.performanceInfo}resetStats(){this._storage.resetStats()}}
class g{get size(){return this._size}constructor(a=10485760){this._maxSize=a;this._db=new Map;this._miss=this._hit=this._size=0;this._removeFuncs=new q;this._users=new q}destroy(){this.clearAll();this._removeFuncs.clear();this._users.clear();this._db=null}register(a){this._users.push(a)}deregister(a){this._users.removeUnordered(a)}registerRemoveFunc(a,f){this._removeFuncs.push([a,f])}deregisterRemoveFunc(a){this._removeFuncs.filterInPlace(f=>f[0]!==a)}get maxSize(){return this._maxSize}set maxSize(a){this._maxSize=
Math.max(a,-1);this._checkSize()}getSize(a,f){return this._db.get(a.id+f)?.size??0}put(a,f,d,c,e){f=a.id+f;const h=this._db.get(f);h&&(this._size-=h.size,a.size-=h.size,this._db.delete(f),h.entry!==d&&this._notifyRemove(f,h.entry,h.size,b.RemoveMode.ALL));c>this._maxSize?this._notifyRemove(f,d,c,b.RemoveMode.ALL):void 0===d?console.warn("Refusing to cache undefined entry "):!c||0>c?(console.warn(`Refusing to cache entry with size ${c} for key ${f}`),this._notifyRemove(f,d,0,b.RemoveMode.ALL)):(this._db.set(f,
new l(d,c,1+Math.max(e,-4)- -3)),this._size+=c,a.size+=c,this._checkSize())}updateSize(a,f,d,c){f=a.id+f;const e=this._db.get(f);if(e&&e.entry===d){this._size-=e.size;for(a.size-=e.size;c>this._maxSize;)if(c=this._notifyRemove(f,d,c,b.RemoveMode.SOME),!(null!=c&&0<c)){this._db.delete(f);return}e.size=c;this._size+=c;a.size+=c;this._checkSize()}}pop(a,f){f=a.id+f;const d=this._db.get(f);if(d)return this._size-=d.size,a.size-=d.size,this._db.delete(f),++this._hit,d.entry;++this._miss}get(a,f){f=a.id+
f;a=this._db.get(f);if(void 0===a)++this._miss;else return this._db.delete(f),a.lives=a.lifetime,this._db.set(f,a),++this._hit,a.entry}peek(a,f){(a=this._db.get(a.id+f))?++this._hit:++this._miss;return a?.entry}get performanceInfo(){const a={Size:Math.round(this._size/1048576)+"/"+Math.round(this._maxSize/1048576)+"MB","Hit rate":Math.round(100*this._getHitRate())+"%",Entries:this._db.size.toString()},f={},d=[];this._db.forEach((h,x)=>{const m=h.lifetime;d[m]=(d[m]||0)+h.size;this._users.forAll(p=>
{const {id:t,name:w}=p;x.startsWith(t)&&(f[w]=(f[w]||0)+h.size)})});const c={};this._users.forAll(h=>{const x=h.name;"hitRate"in h&&"number"===typeof h.hitRate&&!isNaN(h.hitRate)&&0<h.hitRate?(f[x]=f[x]||0,c[x]=Math.round(100*h.hitRate)+"%"):c[x]="0%"});var e=Object.keys(f);e.sort((h,x)=>f[x]-f[h]);e.forEach(h=>a[h]=Math.round(f[h]/2**20)+"MB / "+c[h]);for(e=d.length-1;0<=e;--e){const h=d[e];h&&(a["Priority "+(e+-3-1)]=Math.round(h/this._size*100)+"%")}return a}resetStats(){this._hit=this._miss=0;
this._users.forAll(a=>a.resetHitRate())}clear(a){const f=a.id;this._db.forEach((d,c)=>{c.startsWith(f)&&(this._size-=d.size,this._db.delete(c),this._notifyRemove(c,d.entry,d.size,b.RemoveMode.ALL))});a.size=0}clearAll(){this._db.forEach((a,f)=>this._notifyRemove(f,a.entry,a.size,b.RemoveMode.ALL));this._users.forAll(a=>a.size=0);this._size=0;this._db.clear()}_getHitRate(){return this._hit/(this._hit+this._miss)}_notifyRemove(a,f,d,c){let e;this._removeFuncs.some(h=>a.startsWith(h[0])?(h=h[1](f,c,
d),"number"===typeof h&&(e=h),!0):!1);return e}_checkSize(){this._users.forAll(a=>this._checkSizeLimits(a));this._checkSizeLimits()}_checkSizeLimits(a){const f=a??this;if(!(0>f.maxSize||f.size<=f.maxSize)){for(var d=a?.id,c=!0;c;){c=!1;for(const [e,h]of this._db)if(0===h.lifetime&&(!d||e.startsWith(d))){this._purgeItem(e,h,a);if(f.size<=.9*f.maxSize)return;c||=this._db.has(e)}}for(const [e,h]of this._db)if(!d||e.startsWith(d))if(this._purgeItem(e,h,a),f.size<=.9*f.maxSize)break}}_purgeItem(a,f,d=
this._users.find(c=>a.startsWith(c.id))){this._db.delete(a);if(1>=f.lives){this._size-=f.size;d&&(d.size-=f.size);const c=this._notifyRemove(a,f.entry,f.size,b.RemoveMode.SOME);null!=c&&0<c&&(this._size+=c,d&&(d.size+=c),f.lives=f.lifetime,f.size=c,this._db.set(a,f))}else--f.lives,this._db.set(a,f)}}let k=0;class l{constructor(a,f,d){this.entry=a;this.size=f;this.lives=this.lifetime=d}}b.MemCache=n;b.MemCacheStorage=g;b.MinPriority=-3;b.NoPriority=-4;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},
"esri/core/sql/WhereClause":function(){define("exports ../../arcade/ArcadeDate ../has ./AggregateFunctions ./DateOnly ./errorSupport ./sqlArithmeticUtils ./sqlCompareUtils ./sqlDateParsingUtils ./SqlInterval ./SqlTimestampOffset ./StandardizedFunctions ./TimeOnly ./WhereGrammar ../../chunks/datetime".split(" "),function(b,q,n,g,k,l,a,f,d,c,e,h,x,m,p){function t(E){return Array.isArray(E)?E:[E]}function w(E){return null!==E?!0!==E:null}function r(E,K){return null!=E&&null!=K?!0===E&&!0===K:!1===E||
!1===K?!1:null}function y(E,K){return null!=E&&null!=K?!0===E||!0===K:!0===E||!0===K?!0:null}function z(E,K,C){if(null==E)return null;C=!1;for(const D of K)if(null==D)C=null;else if(E===D){C=!0;break}else if(f.isDateOrTimeValue(E)&&f.isDateOrTimeValue(D)&&(C=f.sqlCompare(E,D,"\x3d")))break;return C}function u(E,K,C){if(null==E)return null;let D="",G=H.Normal;for(let N=0;N<K.length;N++){const Y=K.charAt(N);switch(G){case H.Normal:Y===C?G=H.Escaped:D="-[]/{}()*+?.\\^$|".includes(Y)?D+("\\"+Y):"%"===
Y?D+".*":"_"===Y?D+".":D+Y;break;case H.Escaped:D="-[]/{}()*+?.\\^$|".includes(Y)?D+("\\"+Y):D+Y,G=H.Normal}}return(new RegExp("^"+D+"$","m")).test(E)}function v(E,K,C,D){E=D.getAttribute(E,K);K=C?.get(K);return null==E||"esriFieldTypeDate"!==K?.type&&"date"!==K?.type?null==E||"esriFieldTypeDateOnly"!==K?.type&&"date-only"!==K?.type?null==E||"esriFieldTypeTimeOnly"!==K?.type&&"time-only"!==K?.type?null==E||"esriFieldTypeTimestampOffset"!==K?.type&&"timestamp-offset"!==K?.type?E:new e.SqlTimeStampOffset(E):
x.TimeOnly.fromReader(E):k.DateOnly.fromReader(E):d.convertToExecutingTimeZone(new Date(E),C?.getLuxonTimeZone(K.name)??p.FixedOffsetZone.utcInstance)}const A=new Set(["current_timestamp","current_date","current_time"]);class B{static makeBool(E){return!0===E}static featureValue(E,K,C,D){return v(E,K,C,D)}static equalsNull(E){return null===E}static applyLike(E,K,C){return u(E,K,C)}static ensureArray(E){return t(E)}static applyIn(E,K,C){return z(E,K)}static currentTimestamp(E){return d.convertToExecutingTimeZone(new Date,
E)}static currentDate(E){return k.DateOnly.fromNow(E)}static currentTime(E){E=d.convertToExecutingTimeZone(new Date,E);return x.TimeOnly.fromDateTime(E)}static makeSqlInterval(E,K,C){return c.SqlInterval.createFromValueAndQualifier(E,K,C)}static convertInterval(E){return E instanceof c.SqlInterval?E.valueInMilliseconds():E}static compare(E,K,C,D){return f.sqlCompare(K,C,E)}static calculate(E,K,C,D){return a.sqlCalculateFunction(E,K,C,D)}static evaluateTime(E){return d.parseTime(E)}static evaluateTimestamp(E,
K,C){return d.parseTimestamp(E,K,C)}static evaluateDate(E,K){return d.parseDate(E,K)}static evaluateFunction(E,K,C){return h.evaluateFunction(E,K,C)}static lookup(E,K){E=K[E];return void 0===E?null:E}static between(E,K,C){return null==E||null==K[0]||null==K[1]?null:f.sqlCompare(E,K[0],"\x3e\x3d")&&f.sqlCompare(E,K[1],"\x3c\x3d")}static notbetween(E,K,C){return null==E||null==K[0]||null==K[1]?null:f.sqlCompare(E,K[0],"\x3c")||f.sqlCompare(E,K[1],"\x3e")}static ternaryNot(E){return w(E)}static ternaryAnd(E,
K){return r(E,K)}static ternaryOr(E,K){return y(E,K)}}class F{constructor(E,K,C="UTC",D=null){this.fieldsIndex=K;this.timeZone=C;this.currentUser=D;this.parameters={};this._hasDateFunctions=void 0;this.parseTree=m.WhereGrammar.parse(E);const {isStandardized:G,isAggregate:N,currentUserRequired:Y,referencedFieldNames:ca}=this._extractExpressionInfo(K);this._referencedFieldNames=ca;this.isStandardized=G;this.isAggregate=N;this.currentUserRequired=Y}static convertValueToStorageFormat(E,K=null){if(null===
K)return d.isDate(E)?E.getTime():d.isDateTime(E)?E.toMillis():d.isTimestampOffset(E)?E.toStorageFormat():d.isTimeOnly(E)?E.toStorageString():d.isDateOnly(E)?E.toStorageFormat():E;switch(K){case "date":if(d.isDate(E))return E.getTime();if(d.isDateTime(E))return E.toMillis();if(d.isTimestampOffset(E))return E.toMilliseconds();if(d.isDateOnly(E))return E.toNumber();break;case "date-only":if(d.isDate(E))return k.DateOnly.fromDateJS(E).toString();if(d.isTimestampOffset(E))return k.DateOnly.fromSqlTimeStampOffset(E).toString();
if(d.isDateTime(E))return k.DateOnly.fromDateTime(E).toString();break;case "time-only":if(d.isDate(E))return x.TimeOnly.fromDateJS(E).toStorageString();if(d.isDateTime(E))return x.TimeOnly.fromDateTime(E).toStorageString();if(d.isTimestampOffset(E))return x.TimeOnly.fromSqlTimeStampOffset(E).toStorageString();if(d.isTimeOnly(E))return E.toStorageString();break;case "timestamp-offset":if(d.isDate(E))return e.SqlTimeStampOffset.fromJSDate(E).toStorageFormat();if(d.isDateTime(E))return e.SqlTimeStampOffset.fromDateTime(E).toStorageFormat();
if(d.isTimestampOffset(E))return E.toStorageFormat()}return E}static create(E,K={}){return new F(E,K.fieldsIndex,K.timeZone??void 0,K.currentUser)}get fieldNames(){return this._referencedFieldNames}testSet(E,K=J,C=this.currentUser){return!!this._evaluateNode(this.parseTree,null,K,E,C)}calculateValue(E,K=J,C=this.currentUser){E=this._evaluateNode(this.parseTree,E,K,null,C);return E instanceof c.SqlInterval?E.valueInMilliseconds()/864E5:E}calculateValueCompiled(E,K=J,C=this.currentUser){if(null!=this.parseTree._compiledVersion)return this.parseTree._compiledVersion(E,
this.parameters,K,this.fieldsIndex,this.timeZone,C??null);if(n("esri-csp-restrictions"))return this.calculateValue(E,K);this._compileMe();return this.parseTree._compiledVersion(E,this.parameters,K,this.fieldsIndex,this.timeZone,C??null)}testFeature(E,K=J,C=this.currentUser){return!!this._evaluateNode(this.parseTree,E,K,null,C)}testFeatureCompiled(E,K=J,C=this.currentUser){if(null!=this.parseTree._compiledVersion)return!!this.parseTree._compiledVersion(E,this.parameters,K,this.fieldsIndex,this.timeZone,
C??null);if(n("esri-csp-restrictions"))return this.testFeature(E,K);this._compileMe();return!!this.parseTree._compiledVersion(E,this.parameters,K,this.fieldsIndex,this.timeZone,C??null)}get hasDateFunctions(){if(null!=this._hasDateFunctions)return this._hasDateFunctions;this._hasDateFunctions=!1;m.visitAll(this.parseTree,E=>{"current-time"===E.type?this._hasDateFunctions=!0:"function"===E.type&&(this._hasDateFunctions=this._hasDateFunctions||A.has(E.name.toLowerCase()))});return this._hasDateFunctions}getFunctions(){const E=
new Set;m.visitAll(this.parseTree,K=>{"function"===K.type&&E.add(K.name.toLowerCase())});return Array.from(E)}getExpressions(){const E=new Map;m.visitAll(this.parseTree,K=>{if("function"===K.type){const C=K.name.toLowerCase();K=K.args.value[0];if("column-reference"===K.type){K=K.column;const D=`${C}-${K}`;E.has(D)||E.set(D,{aggregateType:C,field:K})}}});return[...E.values()]}getVariables(){const E=new Set;m.visitAll(this.parseTree,K=>{"parameter"===K.type&&E.add(K.value.toLowerCase())});return Array.from(E)}_compileMe(){const E=
"return this.convertInterval("+this.evaluateNodeToJavaScript(this.parseTree)+")";this.parseTree._compiledVersion=(new Function("feature","lookups","attributeAdapter","fieldsIndex","timeZone","currentUser",E)).bind(B)}_extractExpressionInfo(E){const K=[],C=new Set;let D=!0,G=!1,N=!1;m.visitAll(this.parseTree,Y=>{switch(Y.type){case "column-reference":var ca=E?.get(Y.column);let ka;ca?ca=ka=ca.name??"":(ka=Y.column,ca=ka.toLowerCase());C.has(ca)||(C.add(ca),K.push(ka));Y.column=ka;break;case "current-user":N=
!0;break;case "function":const {name:Q,args:R}=Y;Y=R.value.length;D&&=h.isStandardized(Q,Y);!1===G&&(G=g.isAggregate(Q,Y))}});return{referencedFieldNames:Array.from(K),isStandardized:D,isAggregate:G,currentUserRequired:N}}evaluateNodeToJavaScript(E){switch(E.type){case "interval":return"this.makeSqlInterval("+this.evaluateNodeToJavaScript(E.value)+", "+JSON.stringify(E.qualifier)+","+JSON.stringify(E.op)+")";case "case-expression":var K="";if("simple"===E.format){var C=this.evaluateNodeToJavaScript(E.operand);
K="( ";for(let D=0;D<E.clauses.length;D++)K+=" (this.compare('\x3d',"+C+","+this.evaluateNodeToJavaScript(E.clauses[D].operand)+") ? ("+this.evaluateNodeToJavaScript(E.clauses[D].value)+") : "}else for(K="( ",C=0;C<E.clauses.length;C++)K+=" this.makeBool("+this.evaluateNodeToJavaScript(E.clauses[C].operand)+")\x3d\x3d\x3dtrue ? ("+this.evaluateNodeToJavaScript(E.clauses[C].value)+") : ";K=null!==E.else?K+this.evaluateNodeToJavaScript(E.else):K+"null";return K+" )";case "parameter":return"this.lookup("+
JSON.stringify(E.value.toLowerCase())+",lookups)";case "expression-list":K="[";for(C of E.value)"["!==K&&(K+=","),K+=this.evaluateNodeToJavaScript(C);return K+"]";case "unary-expression":return"this.ternaryNot("+this.evaluateNodeToJavaScript(E.expr)+")";case "binary-expression":switch(E.operator){case "AND":return"this.ternaryAnd("+this.evaluateNodeToJavaScript(E.left)+","+this.evaluateNodeToJavaScript(E.right)+" )";case "OR":return"this.ternaryOr("+this.evaluateNodeToJavaScript(E.left)+","+this.evaluateNodeToJavaScript(E.right)+
" )";case "IS":if("null"!==E.right.type)throw new l.SqlError(l.SqlErrorCodes.UnsupportedIsRhs);return"this.equalsNull("+this.evaluateNodeToJavaScript(E.left)+")";case "ISNOT":if("null"!==E.right.type)throw new l.SqlError(l.SqlErrorCodes.UnsupportedIsRhs);return"(!(this.equalsNull("+this.evaluateNodeToJavaScript(E.left)+")))";case "IN":return"this.applyIn("+this.evaluateNodeToJavaScript(E.left)+",this.ensureArray("+this.evaluateNodeToJavaScript(E.right)+"), timeZone)";case "NOT IN":return"this.ternaryNot(this.applyIn("+
this.evaluateNodeToJavaScript(E.left)+",this.ensureArray("+this.evaluateNodeToJavaScript(E.right)+"), timeZone))";case "BETWEEN":return"this.between("+this.evaluateNodeToJavaScript(E.left)+","+this.evaluateNodeToJavaScript(E.right)+", timeZone)";case "NOTBETWEEN":return"this.notbetween("+this.evaluateNodeToJavaScript(E.left)+","+this.evaluateNodeToJavaScript(E.right)+", timeZone)";case "LIKE":return"this.applyLike("+this.evaluateNodeToJavaScript(E.left)+","+this.evaluateNodeToJavaScript(E.right)+
","+JSON.stringify(E.escape)+")";case "NOT LIKE":return"this.ternaryNot(this.applyLike("+this.evaluateNodeToJavaScript(E.left)+","+this.evaluateNodeToJavaScript(E.right)+","+JSON.stringify(E.escape)+"))";case "\x3c\x3e":case "\x3c":case "\x3e":case "\x3e\x3d":case "\x3c\x3d":case "\x3d":return"this.compare("+JSON.stringify(E.operator)+","+this.evaluateNodeToJavaScript(E.left)+","+this.evaluateNodeToJavaScript(E.right)+", timeZone)";case "*":case "-":case "+":case "/":case "||":return"this.calculate("+
JSON.stringify(E.operator)+","+this.evaluateNodeToJavaScript(E.left)+","+this.evaluateNodeToJavaScript(E.right)+", timeZone)";default:throw new l.SqlError(l.SqlErrorCodes.UnsupportedOperator,{operator:E.operator});}case "null":case "boolean":case "string":case "number":return JSON.stringify(E.value);case "time":return"this.evaluateTime("+JSON.stringify(E.value)+")";case "date":return"this.evaluateDate("+JSON.stringify(E.value)+", 'unknown')";case "timestamp":return"this.evaluateTimestamp("+JSON.stringify(E.value)+
", 'unknown')";case "current-time":return"date"===E.mode?"this.currentDate(timeZone)":"time"===E.mode?"this.currentTime(timeZone)":"this.currentTimestamp(timeZone)";case "current-user":return"currentUser";case "column-reference":return"this.featureValue(feature,"+JSON.stringify(E.column)+",fieldsIndex,attributeAdapter)";case "function":return"this.evaluateFunction("+JSON.stringify(E.name)+","+this.evaluateNodeToJavaScript(E.args)+", timeZone)"}throw new l.SqlError(l.SqlErrorCodes.UnsupportedSyntax,
{node:E.type});}_evaluateNode(E,K,C,D,G){switch(E.type){case "interval":return C=this._evaluateNode(E.value,K,C,D,G),c.SqlInterval.createFromValueAndQualifier(C,E.qualifier,E.op);case "case-expression":if("simple"===E.format){var N=this._evaluateNode(E.operand,K,C,D,G);for(var Y=0;Y<E.clauses.length;Y++)if(f.sqlCompare(N,this._evaluateNode(E.clauses[Y].operand,K,C,D,G),"\x3d",this.timeZone))return this._evaluateNode(E.clauses[Y].value,K,C,D,G)}else for(N=0;N<E.clauses.length;N++)if(!0===this._evaluateNode(E.clauses[N].operand,
K,C,D,G))return this._evaluateNode(E.clauses[N].value,K,C,D,G);return null!==E.else?this._evaluateNode(E.else,K,C,D,G):null;case "parameter":return E=this.parameters[E.value.toLowerCase()],d.isDate(E)?p.DateTime.fromJSDate(E):E instanceof q.ArcadeDate?E.toDateTime():E;case "expression-list":N=[];for(var ca of E.value)N.push(this._evaluateNode(ca,K,C,D,G));return N;case "unary-expression":return w(this._evaluateNode(E.expr,K,C,D,G));case "binary-expression":switch(E.operator){case "AND":return r(this._evaluateNode(E.left,
K,C,D,G),this._evaluateNode(E.right,K,C,D,G));case "OR":return y(this._evaluateNode(E.left,K,C,D,G),this._evaluateNode(E.right,K,C,D,G));case "IS":if("null"!==E.right.type)throw new l.SqlError(l.SqlErrorCodes.UnsupportedIsRhs);return null===this._evaluateNode(E.left,K,C,D,G);case "ISNOT":if("null"!==E.right.type)throw new l.SqlError(l.SqlErrorCodes.UnsupportedIsRhs);return null!==this._evaluateNode(E.left,K,C,D,G);case "IN":return N=t(this._evaluateNode(E.right,K,C,D,G)),z(this._evaluateNode(E.left,
K,C,D,G),N,this.timeZone);case "NOT IN":return N=t(this._evaluateNode(E.right,K,C,D,G)),w(z(this._evaluateNode(E.left,K,C,D,G),N,this.timeZone));case "BETWEEN":return N=this._evaluateNode(E.left,K,C,D,G),E=this._evaluateNode(E.right,K,C,D,G),null==N||null==E[0]||null==E[1]?null:f.sqlCompare(N,E[0],"\x3e\x3d",this.timeZone)&&f.sqlCompare(N,E[1],"\x3c\x3d",this.timeZone);case "NOTBETWEEN":return N=this._evaluateNode(E.left,K,C,D,G),E=this._evaluateNode(E.right,K,C,D,G),null==N||null==E[0]||null==E[1]?
null:f.sqlCompare(N,E[0],"\x3c",this.timeZone)||f.sqlCompare(N,E[1],"\x3e",this.timeZone);case "LIKE":return u(this._evaluateNode(E.left,K,C,D,G),this._evaluateNode(E.right,K,C,D,G),E.escape);case "NOT LIKE":return w(u(this._evaluateNode(E.left,K,C,D,G),this._evaluateNode(E.right,K,C,D,G),E.escape));case "\x3c\x3e":case "\x3c":case "\x3e":case "\x3e\x3d":case "\x3c\x3d":case "\x3d":return f.sqlCompare(this._evaluateNode(E.left,K,C,D,G),this._evaluateNode(E.right,K,C,D,G),E.operator,this.timeZone);
case "-":case "+":case "*":case "/":case "||":return a.sqlCalculateFunction(E.operator,this._evaluateNode(E.left,K,C,D,G),this._evaluateNode(E.right,K,C,D,G),this.timeZone)}case "null":case "boolean":case "string":case "number":return E.value;case "date":return E.parsedValue??(E.parsedValue=d.parseDate(E.value,"unknown")),E.parsedValue;case "timestamp":return E.parsedValue??(E.parsedValue=d.parseTimestamp(E.value,"unknown")),E.parsedValue;case "time":return d.parseTime(E.value);case "current-time":return"date"===
E.mode?B.currentDate(this.timeZone):"time"===E.mode?B.currentTime(this.timeZone):B.currentTimestamp(this.timeZone);case "current-user":return G??null;case "column-reference":return v(K,E.column,this.fieldsIndex,C);case "data-type":return E.value;case "function":if(this.isAggregate&&g.isAggregate(E.name,E.args.value.length)){K=[];for(N of E.args?.value||[]){ca=[];for(Y of D||[])ca.push(this._evaluateNode(N,Y,C,null,G));K.push(ca)}return g.aggregateFunction(E.name,K)}C=this._evaluateNode(E.args,K,C,
D,G);return h.evaluateFunction(E.name,C,this.timeZone)}throw new l.SqlError(l.SqlErrorCodes.UnsupportedSyntax,{node:E.type});}}var H;(function(E){E[E.Normal=0]="Normal";E[E.Escaped=1]="Escaped"})(H||={});const J={getAttribute(E,K){return(E&&"object"===typeof E.attributes?E.attributes:E)[K]}};b.WhereClause=F;b.defaultAttributeAdapter=J;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/arcade/ArcadeDate":function(){define(["exports","../core/string","../core/sql/UnknownTimeZone",
"../chunks/datetime"],function(b,q,n,g){function k(c,e,h){return c<e?c-e:c>h?c-h:0}function l(c,e=!0){if(c instanceof g.Zone)return c;if("system"===c.toLowerCase())return"system";if("utc"===c.toLowerCase())return"UTC";if("unknown"===c.toLowerCase())return n.UnknownTimeZone.instance;if(/^[+-]?[0-9]{1,2}([:][0-9]{2})?$/.test(c)){const h=g.FixedOffsetZone.parseSpecifier("UTC"+(c.startsWith("+")||c.startsWith("-")?"":"+")+c);if(h)return h}c=g.IANAZone.create(c);if(!c.isValid){if(e)throw new f(b.ArcadeDateErrorCodes.TimeZoneNotRecognized);
return null}return c}b.ArcadeDateErrorCodes=void 0;(b.ArcadeDateErrorCodes||(b.ArcadeDateErrorCodes={})).TimeZoneNotRecognized="TimeZoneNotRecognized";const a={[b.ArcadeDateErrorCodes.TimeZoneNotRecognized]:"Timezone identifier has not been recognized."};class f extends Error{constructor(c,e){super(q.replace(a[c],e));this.declaredRootClass="esri.arcade.arcadedate.dateerror";Error.captureStackTrace&&Error.captureStackTrace(this,f)}}class d{constructor(c){this._date=c;this.declaredRootClass="esri.arcade.arcadedate"}static fromParts(c=
0,e=1,h=1,x=0,m=0,p=0,t=0,w){if(isNaN(c)||isNaN(e)||isNaN(h)||isNaN(x)||isNaN(m)||isNaN(p)||isNaN(t))return null;const r=g.DateTime.local(c,e).daysInMonth;c=g.DateTime.fromObject({day:1>h?1:h>r?r:h,year:c,month:1>e?1:12<e?12:e,hour:0>x?0:23<x?23:x,minute:0>m?0:59<m?59:m,second:0>p?0:59<p?59:p,millisecond:0>t?0:999<t?999:t},{zone:l(w)});c=c.plus({months:k(e,1,12),days:k(h,1,r),hours:k(x,0,23),minutes:k(m,0,59),seconds:k(p,0,59),milliseconds:k(t,0,999)});return new d(c)}static get systemTimeZoneCanonicalName(){return Intl.DateTimeFormat().resolvedOptions().timeZone??
"system"}static arcadeDateAndZoneToArcadeDate(c,e){e=l(e);return c.isUnknownTimeZone||e===n.UnknownTimeZone.instance?d.fromParts(c.year,c.monthJS+1,c.day,c.hour,c.minute,c.second,c.millisecond,e):new d(c._date.setZone(e))}static dateJSToArcadeDate(c){return new d(g.DateTime.fromJSDate(c,{zone:"system"}))}static dateJSAndZoneToArcadeDate(c,e="system"){e=l(e);return new d(g.DateTime.fromJSDate(c,{zone:e}))}static unknownEpochToArcadeDate(c){return new d(g.DateTime.fromMillis(c,{zone:n.UnknownTimeZone.instance}))}static unknownDateJSToArcadeDate(c){return new d(g.DateTime.fromMillis(c.getTime(),
{zone:n.UnknownTimeZone.instance}))}static epochToArcadeDate(c,e="system"){e=l(e);return new d(g.DateTime.fromMillis(c,{zone:e}))}static dateTimeToArcadeDate(c){return new d(c)}clone(){return new d(this._date)}changeTimeZone(c){c=l(c);return d.dateTimeToArcadeDate(this._date.setZone(c))}static dateTimeAndZoneToArcadeDate(c,e){e=l(e);return c.zone===n.UnknownTimeZone.instance||e===n.UnknownTimeZone.instance?d.fromParts(c.year,c.month,c.day,c.hour,c.minute,c.second,c.millisecond,e):new d(c.setZone(e))}static nowToArcadeDate(c){c=
l(c);return new d(g.DateTime.fromJSDate(new Date,{zone:c}))}static nowUTCToArcadeDate(){return new d(g.DateTime.utc())}get isSystem(){return"system"===this.timeZone||this.timeZone===d.systemTimeZoneCanonicalName}equals(c){return this.isSystem&&c.isSystem?this.toNumber()===c.toNumber():this.isUnknownTimeZone!==c.isUnknownTimeZone?!1:this._date.equals(c._date)}get isUnknownTimeZone(){return this._date.zone===n.UnknownTimeZone.instance}get isValid(){return this._date.isValid}get hour(){return this._date.hour}get second(){return this._date.second}get day(){return this._date.day}get dayOfWeekISO(){return this._date.weekday}get dayOfWeekJS(){let c=
this._date.weekday;6<c&&(c=0);return c}get millisecond(){return this._date.millisecond}get monthISO(){return this._date.month}get weekISO(){return this._date.weekNumber}get yearISO(){return this._date.weekYear}get monthJS(){return this._date.month-1}get year(){return this._date.year}get minute(){return this._date.minute}get zone(){return this._date.zone}get timeZoneOffset(){return this.isUnknownTimeZone?0:this._date.offset}get timeZone(){if(this.isUnknownTimeZone)return"unknown";if("system"===this._date.zone.type)return"system";
const c=this.zone;return"fixed"===c.type?0===c.fixed?"UTC":c.formatOffset(0,"short"):c.name}stringify(){return JSON.stringify(this.toJSDate())}plus(c){return new d(this._date.plus(c))}diff(c,e="milliseconds"){return this._date.diff(c._date,e)[e]}toISODate(){return this._date.toISODate()}toISOString(c){return c?this._date.toISO({suppressMilliseconds:!0,includeOffset:!this.isUnknownTimeZone}):this._date.toISO({includeOffset:!this.isUnknownTimeZone})}toISOTime(c,e){return this._date.toISOTime({suppressMilliseconds:c,
includeOffset:e&&!this.isUnknownTimeZone})}toFormat(c,e){this.isUnknownTimeZone&&(c=c.replaceAll("Z",""));return this._date.toFormat(c,e)}toJSDate(){return this._date.toJSDate()}toSQLValue(){return this._date.toFormat("yyyy-LL-dd HH:mm:ss")}toSQLWithKeyword(){return`timestamp '${this.toSQLValue()}'`}toDateTime(){return this._date}toNumber(){return this._date.toMillis()}getTime(){return this._date.toMillis()}toUTC(){return new d(this._date.toUTC())}toLocal(){return new d(this._date.toLocal())}toString(){return this.toISOString(!0)}static fromReaderAsTimeStampOffset(c){if(!c)return null;
c=g.DateTime.fromISO(c,{setZone:!0});return new d(c)}}b.ArcadeDate=d;b.ArcadeDateError=f;b.arcadeDateErrorMessages=a;b.createDateTimeZone=l;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/core/sql/AggregateFunctions":function(){define("exports ./DateOnly ./errorSupport ./SqlTimestampOffset ./TimeOnly ../../chunks/datetime".split(" "),function(b,q,n,g,k,l){function a(e){if(null===e)return null;let h=0,x=0;for(let m=0;m<e.length;m++){const p=e[m];if(null!==p){if("number"!==typeof p)throw new n.SqlError(n.SqlErrorCodes.InvalidValueForAggregateFunction);
x++;h+=p}}return 0===x?null:h/e.length}function f(e,h){if(null===e)return null;let x=null,m=null;for(const p of e)e=p,e=p instanceof q.DateOnly?p.toNumber():p instanceof k.TimeOnly?p.toNumber():p instanceof l.DateTime?p.toMillis():p instanceof g.SqlTimeStampOffset?p.toMilliseconds():p,null===x?(x=p,m=e):"max"===h&&null!==m&&null!==e&&m<=e?(x=p,m=e):"min"===h&&null!==m&&null!==e&&m>=e&&(x=p,m=e);return x}function d(e){if(null===e)return null;e=e.filter(m=>null!==m);if(0===e.length)return null;const h=
a(e);if(null===h)return null;let x=0;for(const m of e){if("number"!==typeof m)throw new n.SqlError(n.SqlErrorCodes.InvalidValueForAggregateFunction);x+=(h-m)**2}return x/(e.length-1)}const c={min:{minParams:1,maxParams:1,evaluate:e=>f(e[0],"min")},max:{minParams:1,maxParams:1,evaluate:e=>f(e[0],"max")},avg:{minParams:1,maxParams:1,evaluate:e=>a(e[0])},sum:{minParams:1,maxParams:1,evaluate:e=>{e=e[0];if(null===e)e=null;else{var h=0;for(let x=0;x<e.length;x++){const m=e[x];if(null!==m){if("number"!==
typeof m)throw new n.SqlError(n.SqlErrorCodes.InvalidValueForAggregateFunction);h+=m}}e=h}return e}},stddev:{minParams:1,maxParams:1,evaluate:e=>{e=e[0];null===e?e=null:(e=d(e),e=null===e?null:Math.sqrt(e));return e}},count:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:e[0].length},var:{minParams:1,maxParams:1,evaluate:e=>d(e[0])}};b.aggregateFunction=function(e,h){const x=c[e.toLowerCase()];if(null==x)throw new n.SqlError(n.SqlErrorCodes.FunctionNotRecognized);if(h.length<x.minParams||h.length>
x.maxParams)throw new n.SqlError(n.SqlErrorCodes.InvalidParameterCount,{name:e.toUpperCase()});return x.evaluate(h)};b.isAggregate=function(e,h){e=c[e.toLowerCase()];return null!=e&&h>=e.minParams&&h<=e.maxParams};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/core/sql/DateOnly":function(){define(["exports","../../arcade/ArcadeDate","../../intl/locale","../../chunks/datetime"],function(b,q,n,g){function k(a){a=a.replaceAll(/LTS|LT|L{1,4}|l{1,4}/g,"[$\x26]");let f="";const d=
/(\[[^[]*\])|(\\)?([Hh]mm(ss)?|Mo|M{1,4}|Do|DDDo|D{1,4}|d{2,4}|do?|w[o|w]?|W[o|W]?|Qo?|N{1,5}|YYYYYY|YYYYY|YYYY|YY|y{2,4}|yo?|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|kk?|mm?|ss?|S{1,9}|x|X|zz?|ZZ?|.)/g;for(const c of a.match(d)||[])switch(c){case "D":f+="d";break;case "DD":f+="dd";break;case "DDD":f+="o";break;case "d":f+="c";break;case "ddd":f+="ccc";break;case "dddd":f+="cccc";break;case "M":f+="L";break;case "MM":f+="LL";break;case "MMM":f+="LLL";break;case "MMMM":f+="LLLL";break;case "YY":f+="yy";
break;case "Y":case "YYYY":f+="yyyy";break;case "Q":f+="q";break;case "X":case "x":f+=c;break;default:f=2<=c.length&&"["===c.slice(0,1)&&"]"===c.slice(-1)?f+`'${c.slice(1,-1)}'`:f+`'${c}'`}return f}class l{constructor(a,f,d){this._year=a;this._month=f;this._day=d;this.declaredRootClass="esri.core.sql.dateonly"}get month(){return this._month}get monthJS(){return this._month-1}get year(){return this._year}get day(){return this._day}get isValid(){return this.toDateTime("unknown").isValid}equals(a){return a instanceof
l&&a.day===this.day&&a.month===this.month&&a.year===this.year}clone(){return new l(this._year,this._month,this._day)}toDateTime(a){return g.DateTime.fromObject({day:this.day,month:this.month,year:this.year},{zone:q.createDateTimeZone(a)})}toDateTimeLuxon(a){return g.DateTime.fromObject({day:this.day,month:this.month,year:this.year},{zone:q.createDateTimeZone(a)})}toString(){return`${this.year.toString().padStart(4,"0")}-${this.month.toString().padStart(2,"0")}-${this.day.toString().padStart(2,"0")}`}toFormat(a=
null,f=!0){if(null===a||""===a)return this.toString();f&&(a=k(a));if(!a)return"";f=this.toDateTime("unknown");return q.ArcadeDate.dateTimeToArcadeDate(f).toFormat(a,{locale:n.getLocale(),numberingSystem:"latn"})}toArcadeDate(){const a=this.toDateTime("unknown");return q.ArcadeDate.dateTimeToArcadeDate(a)}toNumber(){return this.toDateTime("unknown").toMillis()}toJSDate(){return this.toDateTime("unknown").toJSDate()}toStorageFormat(){return this.toFormat("yyyy-LL-dd",!1)}toSQLValue(){return this.toFormat("yyyy-LL-dd",
!1)}toSQLWithKeyword(){return"date '"+this.toFormat("yyyy-LL-dd",!1)+"'"}plus(a,f){return l.fromDateTime(this.toUTCDateTime().plus({[a]:f}))}toUTCDateTime(){return g.DateTime.utc(this.year,this.month,this.day,0,0,0,0)}difference(a,f){switch(f.toLowerCase()){case "days":case "day":case "d":return this.toUTCDateTime().diff(a.toUTCDateTime(),"days").days;case "months":case "month":return this.toUTCDateTime().diff(a.toUTCDateTime(),"months").months;case "minutes":case "minute":case "m":return"M"===f?
this.toUTCDateTime().diff(a.toUTCDateTime(),"months").months:this.toUTCDateTime().diff(a.toUTCDateTime(),"minutes").minutes;case "seconds":case "second":case "s":return this.toUTCDateTime().diff(a.toUTCDateTime(),"seconds").seconds;case "milliseconds":case "millisecond":case "ms":return this.toUTCDateTime().diff(a.toUTCDateTime(),"milliseconds").milliseconds;case "hours":case "hour":case "h":return this.toUTCDateTime().diff(a.toUTCDateTime(),"hours").hours;case "years":case "year":case "y":return this.toUTCDateTime().diff(a.toUTCDateTime(),
"years").years;default:return this.toUTCDateTime().diff(a.toUTCDateTime(),"milliseconds").milliseconds}}static fromMilliseconds(a){a=g.DateTime.fromMillis(a,{zone:g.FixedOffsetZone.utcInstance});return a.isValid?l.fromParts(a.year,a.month,a.day):null}static fromSeconds(a){a=g.DateTime.fromSeconds(a,{zone:g.FixedOffsetZone.utcInstance});return a.isValid?l.fromParts(a.year,a.month,a.day):null}static fromReader(a){if(!a)return null;a=a.split("-");return 3!==a.length?null:new l(parseInt(a[0],10),parseInt(a[1],
10),parseInt(a[2],10))}static fromParts(a,f,d){a=new l(a,f,d);return!1===a.isValid?null:a}static fromDateJS(a){return l.fromParts(a.getFullYear(),a.getMonth()+1,a.getDay())}static fromDateTime(a){return l.fromParts(a.year,a.month,a.day)}static fromSqlTimeStampOffset(a){return this.fromDateTime(a.toDateTime())}static fromString(a,f=null){if(""===a||null===a)return null;var d=[];if(f)(f=k(f))&&d.push(f);else if(null===f||""===f)return a=g.DateTime.fromISO(a,{setZone:!0}),a.isValid?l.fromParts(a.year,
a.month,a.day):null;for(const c of d)if(d=g.DateTime.fromFormat(a,f??c),d.isValid)return new l(d.year,d.month,d.day);return null}static fromNow(a="system"){a=g.DateTime.fromJSDate(new Date).setZone(q.createDateTimeZone(a));return new l(a.year,a.month,a.day)}}b.DateOnly=l;b.standardizeDateOnlyFormat=k;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/core/sql/errorSupport":function(){define(["exports","../string"],function(b,q){b.SqlErrorCodes=void 0;(function(k){k.InvalidFunctionParameters=
"InvalidFunctionParameters";k.InvalidValueForAggregateFunction="InvalidValueForAggregateFunction";k.UnsupportedSqlFunction="UnsupportedSqlFunction";k.UnsupportedOperator="UnsupportedOperator";k.UnsupportedSyntax="UnsupportedSyntax";k.UnsupportedIsRhs="UnsupportedIsRhs";k.UnsupportedIsLhs="UnsupportedIsLhs";k.InvalidDataType="InvalidDataType";k.CannotCastValue="CannotCastValue";k.FunctionNotRecognized="FunctionNotRecognized";k.InvalidTime="InvalidTime";k.InvalidParameterCount="InvalidParameterCount";
k.InvalidTimeStamp="InvalidTimeStamp";k.InvalidDate="InvalidDate";k.InvalidOperator="InvalidOperator";k.IllegalInterval="IllegalInterval";k.YearMonthIntervals="YearMonthIntervals";k.PrimarySecondaryQualifiers="PrimarySecondaryQualifiers";k.MissingStatisticParameters="MissingStatisticParameters"})(b.SqlErrorCodes||(b.SqlErrorCodes={}));const n={[b.SqlErrorCodes.InvalidValueForAggregateFunction]:"Invalid value used in aggregate function",[b.SqlErrorCodes.MissingStatisticParameters]:"Statistic does not have 1 or 0 Parameters",
[b.SqlErrorCodes.InvalidFunctionParameters]:"Invalid parameters for call to {function}",[b.SqlErrorCodes.UnsupportedIsLhs]:"Unsupported left hand expression in is statement",[b.SqlErrorCodes.UnsupportedIsRhs]:"Unsupported right hand expression in is statement",[b.SqlErrorCodes.UnsupportedOperator]:"Unsupported operator - {operator}",[b.SqlErrorCodes.UnsupportedSyntax]:"Unsupported syntax - {node}",[b.SqlErrorCodes.UnsupportedSqlFunction]:"Sql function not found \x3d {function}",[b.SqlErrorCodes.InvalidDataType]:"Invalid sql data type",
[b.SqlErrorCodes.InvalidDate]:"Invalid date encountered",[b.SqlErrorCodes.InvalidOperator]:"Invalid operator encountered",[b.SqlErrorCodes.InvalidTime]:"Invalid time encountered",[b.SqlErrorCodes.IllegalInterval]:"Illegal interval",[b.SqlErrorCodes.FunctionNotRecognized]:"Function not recognized",[b.SqlErrorCodes.InvalidTimeStamp]:"Invalid timestamp encountered",[b.SqlErrorCodes.InvalidParameterCount]:"Invalid parameter count for call to {name}",[b.SqlErrorCodes.PrimarySecondaryQualifiers]:"Primary and Secondary SqlInterval qualifiers not supported",
[b.SqlErrorCodes.YearMonthIntervals]:"Year-Month Intervals not supported",[b.SqlErrorCodes.CannotCastValue]:"Cannot cast value to the required data type"};class g extends Error{constructor(k,l){super(q.replace(n[k],l));this.declaredRootClass="esri.arcade.featureset.support.sqlerror";Error.captureStackTrace&&Error.captureStackTrace(this,g)}}b.SqlError=g;b.sqlErrorMessages=n;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/core/sql/SqlTimestampOffset":function(){define(["exports",
"../../chunks/datetime"],function(b,q){function n(k){return Number.isNaN(k)||0===k?k:Math.trunc(k)}class g{constructor(k){this._timeStampOffset=k;this._date=null}toDateTime(){this._date??(this._date=q.DateTime.fromISO(this._timeStampOffset,{setZone:!0}));return this._date}get isValid(){return this.toDateTime().isValid}get timezoneOffsetHour(){return n(this.toDateTime().offset/60)}get timezoneOffsetMinutes(){return n(this.toDateTime().offset%60)}toMilliseconds(){return this.toDateTime().toMillis()}get hour(){return this.toDateTime().hour}get minute(){return this.toDateTime().minute}get second(){return this.toDateTime().second}get day(){return this.toDateTime().day}get month(){return this.toDateTime().month}get year(){return this.toDateTime().year}startOfDay(){return g.fromDateTime(this.toDateTime().startOf("day"))}static fromJSDate(k){return new g(q.DateTime.fromJSDate(k).toISO({includeOffset:!0}))}static fromDateTime(k){return new g(k.toISO({includeOffset:!0}))}static fromParts(k,
l,a=0,f=0,d=0,c=0,e=0,h=!1,x=0,m=0){k=`${k.toString().padStart(4,"0")}-${l.toString().padStart(2,"0")}-${a.toString().padStart(2,"0")}`;l="";10>c&&(l="0");f=`${f.toString().padStart(2,"0")}:${d.toString().padStart(2,"0")}:${l+c.toString()}`;0!==e&&(f+="."+e.toString().padStart(3,"0"));e=`${h?"-":"+"}${x.toString().padStart(2,"0")}:${m.toString().padStart(2,"0")}`;return new g(k+"T"+f+e)}toStorageFormat(){return this._timeStampOffset}toString(){return this._timeStampOffset}toSQLValue(){let k=this.toDateTime().toSQL({includeOffset:!0,
includeOffsetSpace:!0});k&&=k.replace(".000","");return k}toSQLWithKeyword(){return`timestamp '${this.toSQLValue()}'`}addMilliseconds(k){k=this.toDateTime().plus(k);return g.fromDateTime(k)}}b.SqlTimeStampOffset=g;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/core/sql/TimeOnly":function(){define(["exports","../../arcade/kernel","../../intl/locale","../../chunks/datetime"],function(b,q,n,g){function k(a){if(!a)return"";const f=/(a|A|hh?|HH?|mm?|ss?|SSS|S|.)/g;let d="";for(const c of a.match(f)||
[])switch(c){case "SSS":d+=c;break;case "A":case "a":d+="a";break;case "m":case "mm":case "h":case "hh":case "H":case "HH":case "s":case "ss":d+=c;break;default:d+=`'${c}'`}return d}class l{constructor(a,f,d,c){this._hour=a;this._minute=f;this._second=d;this._millisecond=c;this.declaredRootClass="esri.core.sql.timeonly"}get hour(){return this._hour}get minute(){return this._minute}get second(){return this._second}get millisecond(){return this._millisecond}equals(a){return a instanceof l&&a.hour===
this.hour&&a.minute===this.minute&&a.second===this.second&&a.millisecond===this.millisecond}clone(){return new l(this.hour,this.minute,this.second,this.millisecond)}isValid(){return q.isInteger(this.hour)&&q.isInteger(this.minute)&&q.isInteger(this.second)&&q.isInteger(this.millisecond)&&0<=this.hour&&24>this.hour&&0<=this.minute&&60>this.minute&&0<=this.second&&60>this.second&&0<=this.millisecond&&1E3>this.millisecond}toString(){return`${this.hour.toString().padStart(2,"0")}:${this.minute.toString().padStart(2,
"0")}:${this.second.toString().padStart(2,"0")}`+(0<this.millisecond?"."+this.millisecond.toString().padStart(3,"0"):"")}toSQLValue(){return this.toString()}toSQLWithKeyword(){return`time '${this.hour.toString().padStart(2,"0")}:${this.minute.toString().padStart(2,"0")}:${this.second.toString().padStart(2,"0")}${0<this.millisecond?"."+this.millisecond.toString().padStart(3,"0"):""}'`}toStorageString(){return`${this.hour.toString().padStart(2,"0")}:${this.minute.toString().padStart(2,"0")}:${this.second.toString().padStart(2,
"0")}`}toFormat(a=null){return null===a||""===a?this.toString():(a=k(a))?g.DateTime.local(1970,1,1,this._hour,this._minute,this._second,this._millisecond).toFormat(a,{locale:n.getLocale(),numberingSystem:"latn"}):""}toNumber(){return this.millisecond+1E3*this.second+6E4*this.minute+36E5*this.hour}static fromParts(a,f,d,c){a=new l(a,f,d,c);return a.isValid()?a:null}static fromReader(a){if(!a)return null;a=a.split(":");return 3!==a.length?null:new l(parseInt(a[0],10),parseInt(a[1],10),parseInt(a[2],
10),0)}static fromMilliseconds(a){return 864E5<a||0>a?null:new l(Math.floor(a/36E5%24),Math.floor(a/6E4%60),Math.floor(a/1E3%60),Math.floor(a%1E3))}static fromDateJS(a){return new l(a.getHours(),a.getMinutes(),a.getSeconds(),a.getMilliseconds())}static fromDateTime(a){return new l(a.hour,a.minute,a.second,a.millisecond)}static fromSqlTimeStampOffset(a){return this.fromDateTime(a.toDateTime())}static fromString(a,f=null){if(""===a||null===a)return null;const d=[];if(f)(f=k(f))&&d.push(f);else if(null===
f||""===f)d.push("HH:mm:ss"),d.push("HH:mm:ss.SSS"),d.push("hh:mm:ss a"),d.push("hh:mm:ss.SSS a"),d.push("HH:mm"),d.push("hh:mm a"),d.push("H:mm"),d.push("h:mm a"),d.push("H:mm:ss"),d.push("h:mm:ss a"),d.push("H:mm:ss.SSS"),d.push("h:mm:ss.SSS a");for(const c of d)if(f=g.DateTime.fromFormat(a,c),f.isValid)return new l(f.hour,f.minute,f.second,f.millisecond);return null}plus(a,f){switch(a){case "days":case "years":case "months":return this.clone();case "hours":case "minutes":case "seconds":case "milliseconds":return l.fromDateTime(this.toUTCDateTime().plus({[a]:f}))}return null}toUTCDateTime(){return g.DateTime.utc(1970,
1,1,this.hour,this.minute,this.second,this.millisecond)}difference(a,f){switch(f.toLowerCase()){case "days":case "day":case "d":return this.toUTCDateTime().diff(a.toUTCDateTime(),"days").days;case "months":case "month":return this.toUTCDateTime().diff(a.toUTCDateTime(),"months").months;case "minutes":case "minute":case "m":return"M"===f?this.toUTCDateTime().diff(a.toUTCDateTime(),"months").months:this.toUTCDateTime().diff(a.toUTCDateTime(),"minutes").minutes;case "seconds":case "second":case "s":return this.toUTCDateTime().diff(a.toUTCDateTime(),
"seconds").seconds;case "milliseconds":case "millisecond":case "ms":return this.toUTCDateTime().diff(a.toUTCDateTime(),"milliseconds").milliseconds;case "hours":case "hour":case "h":return this.toUTCDateTime().diff(a.toUTCDateTime(),"hours").hours;case "years":case "year":case "y":return this.toUTCDateTime().diff(a.toUTCDateTime(),"years").years;default:return this.toUTCDateTime().diff(a.toUTCDateTime(),"milliseconds").milliseconds}}}b.TimeOnly=l;b.standardizeTimeFormat=k;Object.defineProperty(b,
Symbol.toStringTag,{value:"Module"})})},"esri/arcade/kernel":function(){define(["exports","../geometry/Extent"],function(b,q){b.cloneGeometry=function(n){if(null==n)return null;const g=n.clone();void 0!==n.cache._geVersion&&(g.cache._geVersion=n.cache._geVersion);return g};b.convertLinearUnitsToCode=function(n){if(null==n)return null;if("number"===typeof n)return n;n=n.toLowerCase();n=n.replaceAll(/\s/g,"");n=n.replaceAll("-","");switch(n){case "meters":case "meter":case "m":case "squaremeters":case "squaremeter":return 9001;
case "miles":case "mile":case "squaremile":case "squaremiles":return 9093;case "kilometers":case "kilometer":case "squarekilometers":case "squarekilometer":case "km":return 9036;case "yard":case "yd":case "yards":case "squareyards":case "squareyard":return 9096;case "feet":case "ft":case "foot":case "squarefeet":case "squarefoot":return 9002;case "nmi":case "nauticalmile":case "nauticalmiles":case "squarenauticalmile":case "squarenauticalmiles":return 9030}return null};b.convertSquareUnitsToCode=
function(n){if(null==n)return null;if("number"===typeof n)return n;n=n.toLowerCase();n=n.replaceAll(/\s/g,"");n=n.replaceAll("-","");switch(n){case "meters":case "meter":case "m":case "squaremeters":case "squaremeter":return 109404;case "miles":case "mile":case "squaremile":case "squaremiles":return 109439;case "kilometers":case "kilometer":case "squarekilometers":case "squarekilometer":case "km":return 109414;case "acres":case "acre":case "ac":return 109402;case "hectares":case "hectare":case "ha":return 109401;
case "yard":case "yd":case "yards":case "squareyards":case "squareyard":return 109442;case "feet":case "ft":case "foot":case "squarefeet":case "squarefoot":return 109405;case "nmi":case "nauticalmile":case "nauticalmiles":case "squarenauticalmile":case "squarenauticalmiles":return 109409}return null};b.isInteger=function(n){return"number"===typeof n&&isFinite(n)&&Math.floor(n)===n};b.sameGeomType=function(n,g){return n===g||"point"===n&&"esriGeometryPoint"===g||"polyline"===n&&"esriGeometryPolyline"===
g||"polygon"===n&&"esriGeometryPolygon"===g||"extent"===n&&"esriGeometryEnvelope"===g||"multipoint"===n&&"esriGeometryMultipoint"===g||"point"===g&&"esriGeometryPoint"===n||"polyline"===g&&"esriGeometryPolyline"===n||"polygon"===g&&"esriGeometryPolygon"===n||"extent"===g&&"esriGeometryEnvelope"===n||"multipoint"===g&&"esriGeometryMultipoint"===n?!0:!1};b.shapeExtent=function(n){if(null==n)return null;switch(n.type){case "polygon":case "multipoint":case "polyline":return n.extent;case "point":return new q({xmin:n.x,
ymin:n.y,xmax:n.x,ymax:n.y,spatialReference:n.spatialReference});case "extent":return n}return null};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/core/sql/sqlArithmeticUtils":function(){define(["exports","./errorSupport","./sqlDateParsingUtils","./SqlInterval","./StandardizedFunctions"],function(b,q,n,g,k){function l(S,X,ba){switch(ba){case "+":return S+X;case "-":return S-X;case "*":return S*X;case "/":return S/X}throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);}function a(S,
X,ba){switch(ba){case "+":return X.plus({milliseconds:S.valueInMilliseconds()});case "-":return S.valueInMilliseconds()-X.toMillis()}throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);}function f(S,X,ba){switch(ba){case "+":return X.plus("milliseconds",S.valueInMilliseconds())}throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);}function d(S,X,ba){switch(ba){case "+":return X.plus("milliseconds",S.valueInMilliseconds())}throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);}function c(S,X,ba){switch(ba){case "+":return S.plus("milliseconds",
X.valueInMilliseconds());case "-":return S.plus("milliseconds",-1*X.valueInMilliseconds())}throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);}function e(S,X,ba){switch(ba){case "+":return X.addMilliseconds(S.valueInMilliseconds())}throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);}function h(S,X,ba){switch(ba){case "+":return g.SqlInterval.createFromMilliseconds(S.valueInMilliseconds()+X.valueInMilliseconds());case "-":return g.SqlInterval.createFromMilliseconds(S.valueInMilliseconds()-X.valueInMilliseconds());
case "*":return g.SqlInterval.createFromMilliseconds(S.valueInMilliseconds()*X.valueInMilliseconds());case "/":return g.SqlInterval.createFromMilliseconds(S.valueInMilliseconds()/X.valueInMilliseconds())}throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);}function x(S,X,ba){switch(ba){case "+":return g.SqlInterval.createFromMilliseconds(S.valueInMilliseconds()+X);case "-":return g.SqlInterval.createFromMilliseconds(S.valueInMilliseconds()-X);case "*":return g.SqlInterval.createFromMilliseconds(S.valueInMilliseconds()*
X);case "/":return g.SqlInterval.createFromMilliseconds(S.valueInMilliseconds()/X)}throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);}function m(S,X,ba){switch(ba){case "+":return g.SqlInterval.createFromMilliseconds(S+X.valueInMilliseconds());case "-":return g.SqlInterval.createFromMilliseconds(S-X.valueInMilliseconds());case "*":return g.SqlInterval.createFromMilliseconds(S*X.valueInMilliseconds());case "/":return g.SqlInterval.createFromMilliseconds(S/X.valueInMilliseconds())}throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);
}function p(S,X,ba){switch(ba){case "+":return S.plus("milliseconds",X.valueInMilliseconds());case "-":return S.plus("milliseconds",-1*X.valueInMilliseconds())}throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);}function t(S,X,ba){switch(ba){case "+":return S.plus({milliseconds:X.valueInMilliseconds()});case "-":return S.minus({milliseconds:X.valueInMilliseconds()})}throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);}function w(S,X,ba){switch(ba){case "+":return S.addMilliseconds(X.valueInMilliseconds());
case "-":return S.addMilliseconds(-1*X.valueInMilliseconds())}throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);}function r(S,X,ba){X*=864E5;switch(ba){case "+":return S.plus({milliseconds:X});case "-":return S.minus({milliseconds:X})}throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);}function y(S,X,ba){X*=864E5;switch(ba){case "+":return S.plus("milliseconds",X);case "-":return S.plus("milliseconds",-1*X)}throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);}function z(S,X,ba){X*=864E5;
switch(ba){case "+":return S.plus("milliseconds",X);case "-":return S.plus("milliseconds",-1*X)}throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);}function u(S,X,ba){throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);}function v(S,X,ba){X*=864E5;switch(ba){case "+":return S.addMilliseconds(X);case "-":return S.addMilliseconds(-1*X)}throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);}function A(S,X,ba){throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);}function B(S,X,ba){throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);
}function F(S,X,ba){throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);}function H(S,X,ba){X=parseFloat(X);if(isNaN(X))throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);return l(S,X,ba)}function J(S,X,ba){S=parseFloat(S);if(isNaN(S))throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);return l(S,X,ba)}function E(S,X,ba){switch(ba){case "+":return S+X}throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);}function K(S,X,ba){throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);}function C(S,
X,ba){throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);}function D(S,X,ba){switch(ba){case "-":return S.toDateTimeLuxon(X.zone).diff(X).as("days")}throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);}function G(S,X,ba){switch(ba){case "-":return S.toDateTimeLuxon(X.toDateTime().zone).diff(X.toDateTime()).as("days")}throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);}function N(S,X,ba){switch(ba){case "-":return S.toDateTimeLuxon("UTC").diff(X.toDateTimeLuxon("UTC")).as("days")}throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);
}function Y(S,X,ba){throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);}function ca(S,X,ba){throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);}function ka(S,X,ba){switch(ba){case "-":return S.toDateTime().diff(X.toDateTimeLuxon(S.toDateTime().zone)).as("days")}throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);}function Q(S,X,ba){switch(ba){case "-":return S.toDateTime().diff(X).as("days")}throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);}function R(S,X,ba){switch(ba){case "-":return S.toDateTime().diff(X.toDateTime()).as("days")}throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);
}function Z(S,X,ba){throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);}function da(S,X,ba){throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);}function ja(S,X,ba){throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);}function W(S,X,ba){throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);}function aa(S,X,ba){switch(ba){case "-":return S.diff(X).as("days")}throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);}function ia(S,X,ba){switch(ba){case "-":return S.diff(X.toDateTimeLuxon(S.zone)).as("days")}throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);
}function qa(S,X,ba){switch(ba){case "-":return S.diff(X.toDateTime()).as("days")}throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);}function sa(S,X,ba){throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);}function ya(S,X,ba){throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);}function va(S,X,ba){throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);}function wa(S,X,ba){throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);}function M(S,X,ba){throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);
}function L(S,X,ba){throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);}function T(S,X,ba){throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);}function ha(S,X,ba){throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);}function oa(S,X,ba){throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);}b.calculateDateOnlyAndDateOnly=N;b.calculateDateOnlyAndDateTime=D;b.calculateDateOnlyAndNumber=y;b.calculateDateOnlyAndSqlInterval=p;b.calculateDateOnlyAndString=ya;b.calculateDateOnlyAndTimeOnly=Y;b.calculateDateOnlyAndTimestamp=
G;b.calculateDateTimeAndDateOnly=ia;b.calculateDateTimeAndDateTime=aa;b.calculateDateTimeAndNumber=r;b.calculateDateTimeAndSqlInterval=t;b.calculateDateTimeAndString=wa;b.calculateDateTimeAndTimeOnly=sa;b.calculateDateTimeAndTimestamp=qa;b.calculateNumberAndDateOnly=F;b.calculateNumberAndDateTime=u;b.calculateNumberAndNumber=l;b.calculateNumberAndSqlInterval=m;b.calculateNumberAndString=H;b.calculateNumberAndTimeOnly=B;b.calculateNumberAndTimestamp=A;b.calculateSqlIntervalAndDateOnly=d;b.calculateSqlIntervalAndDateTime=
a;b.calculateSqlIntervalAndNumber=x;b.calculateSqlIntervalAndSqlInterval=h;b.calculateSqlIntervalAndString=K;b.calculateSqlIntervalAndTimeOnly=f;b.calculateSqlIntervalAndTimestamp=e;b.calculateStringAndDateOnly=T;b.calculateStringAndDateTime=ha;b.calculateStringAndNumber=J;b.calculateStringAndSqlInterval=C;b.calculateStringAndString=E;b.calculateStringAndTimeOnly=L;b.calculateStringAndTimestamp=oa;b.calculateTimeOnlyAndDateOnly=da;b.calculateTimeOnlyAndDateTime=Z;b.calculateTimeOnlyAndNumber=z;b.calculateTimeOnlyAndSqlInterval=
c;b.calculateTimeOnlyAndString=va;b.calculateTimeOnlyAndTimeOnly=W;b.calculateTimeOnlyAndTimestamp=ja;b.calculateTimestampAndDateOnly=ka;b.calculateTimestampAndDateTime=Q;b.calculateTimestampAndNumber=v;b.calculateTimestampAndSqlInterval=w;b.calculateTimestampAndString=M;b.calculateTimestampAndTimeOnly=ca;b.calculateTimestampAndTimestamp=R;b.sqlCalculateFunction=function(S,X,ba,la){if("||"===S)return k.evaluateFunction("concat",[X,ba],la);if(null===X||null===ba)return null;if(n.isNumber(X)){if(n.isNumber(ba))return l(X,
ba,S);if(n.isSqlInterval(ba))return m(X,ba,S);if(n.isTimeOnly(ba))return B();if(n.isDateOnly(ba))return F();if(n.isTimestampOffset(ba))return A();if(n.isDateTime(ba))return u();if(n.isString(ba))return H(X,ba,S)}else if(n.isDateOnly(X)){if(n.isNumber(ba))return y(X,ba,S);if(n.isSqlInterval(ba))return p(X,ba,S);if(n.isTimeOnly(ba))return Y();if(n.isDateOnly(ba))return N(X,ba,S);if(n.isTimestampOffset(ba))return G(X,ba,S);if(n.isDateTime(ba))return D(X,ba,S);if(n.isString(ba))return ya()}else if(n.isTimeOnly(X)){if(n.isNumber(ba))return z(X,
ba,S);if(n.isSqlInterval(ba))return c(X,ba,S);if(n.isTimeOnly(ba))return W();if(n.isDateOnly(ba))return da();if(n.isTimestampOffset(ba))return ja();if(n.isDateTime(ba))return Z();if(n.isString(ba))return va()}else if(n.isSqlInterval(X)){if(n.isNumber(ba))return x(X,ba,S);if(n.isSqlInterval(ba))return h(X,ba,S);if(n.isTimeOnly(ba))return f(X,ba,S);if(n.isDateOnly(ba))return d(X,ba,S);if(n.isTimestampOffset(ba))return e(X,ba,S);if(n.isDateTime(ba))return a(X,ba,S);if(n.isString(ba))return K()}else if(n.isDateTime(X)){if(n.isNumber(ba))return r(X,
ba,S);if(n.isSqlInterval(ba))return t(X,ba,S);if(n.isTimeOnly(ba))return sa();if(n.isDateOnly(ba))return ia(X,ba,S);if(n.isTimestampOffset(ba))return qa(X,ba,S);if(n.isDateTime(ba))return aa(X,ba,S);if(n.isString(ba))return wa()}else if(n.isTimestampOffset(X)){if(n.isNumber(ba))return v(X,ba,S);if(n.isSqlInterval(ba))return w(X,ba,S);if(n.isTimeOnly(ba))return ca();if(n.isDateOnly(ba))return ka(X,ba,S);if(n.isTimestampOffset(ba))return R(X,ba,S);if(n.isDateTime(ba))return Q(X,ba,S);if(n.isString(ba))return M()}else if(n.isString(X)){if(n.isNumber(ba))return J(X,
ba,S);if(n.isSqlInterval(ba))return C();if(n.isTimeOnly(ba))return L();if(n.isDateOnly(ba))return T();if(n.isTimestampOffset(ba))return oa();if(n.isDateTime(ba))return ha();if(n.isString(ba))return E(X,ba,S)}throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/core/sql/sqlDateParsingUtils":function(){define("exports ./DateOnly ./errorSupport ./SqlInterval ./SqlTimestampOffset ./TimeOnly ./UnknownTimeZone ../../chunks/datetime".split(" "),
function(b,q,n,g,k,l,a,f){function d(r,y,z){z=m.exec(r);if(null!==z){const [,u,v,A,B,F,H,J]=z;r=f.DateTime.fromObject({year:parseInt(u,10),month:parseInt(v,10),day:parseInt(A,10),hour:parseInt(B,10),minute:parseInt(F,10),second:parseInt(H,10),millisecond:J?parseInt(J.replace(".",""),10):0},{zone:a.substituteUnknownTimezone(y)});if(!1===r.isValid)throw new n.SqlError(n.SqlErrorCodes.InvalidTimeStamp);return r}z=p.exec(r);if(null!==z){const [,u,v,A,B,F,H,J,E,K,C]=z;r=k.SqlTimeStampOffset.fromParts(parseInt(u,
10),parseInt(v,10),parseInt(A,10),parseInt(B,10),parseInt(F,10),parseInt(H,10),J?parseInt(J.replace(".",""),10):0,"-"===E,parseInt(K,10),parseInt(C,10));if(!1===r.isValid)throw new n.SqlError(n.SqlErrorCodes.InvalidTimeStamp);return r}z=t.exec(r);if(null!==z){const [,u,v,A,B,F,H,J,E]=z;r=k.SqlTimeStampOffset.fromParts(parseInt(u,10),parseInt(v,10),parseInt(A,10),parseInt(B,10),parseInt(F,10),0,0,"-"===H,parseInt(J,10),parseInt(E,10));if(!1===r.isValid)throw new n.SqlError(n.SqlErrorCodes.InvalidTimeStamp);
return r}z=w.exec(r);if(null!==z){const [,u,v,A,B,F]=z;r=f.DateTime.fromObject({year:parseInt(u,10),month:parseInt(v,10),day:parseInt(A,10),hour:parseInt(B,10),minute:parseInt(F,10),second:0},{zone:a.substituteUnknownTimezone(y)});if(!1===r.isValid)throw new n.SqlError(n.SqlErrorCodes.InvalidTimeStamp);return r}z=x.exec(r);if(null!==z){const [,u,v,A]=z;r=f.DateTime.fromObject({year:parseInt(u,10),month:parseInt(v,10),day:parseInt(A,10),hour:0,minute:0,second:0},{zone:a.substituteUnknownTimezone(y)});
if(!1===r.isValid)throw new n.SqlError(n.SqlErrorCodes.InvalidTimeStamp);return r}throw new n.SqlError(n.SqlErrorCodes.InvalidTimeStamp);}const c=/^(\d{1,2}):(\d{1,2}):(\d{1,2})$/,e=/^(\d{1,2}):(\d{1,2})$/,h=/^(\d{1,2}):(\d{1,2}):(\d{1,2}).([0-9]+)$/,x=/^(\d{4})-(\d{1,2})-(\d{1,2})$/,m=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2}):(\d{1,2})(\.[0-9]+)?$/,p=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2}):(\d{1,2})(\.[0-9]+)?[ ]{0,1}(\+|-)(\d{1,2}):(\d{1,2})$/,t=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2})?[ ]{0,1}(\+|-)(\d{1,2}):(\d{1,2})$/,
w=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2})$/;b.convertToExecutingTimeZone=function(r,y){if(y instanceof f.Zone)return y===a.UnknownTimeZone.instance?f.DateTime.fromMillis(r.getTime(),{zone:a.UnknownTimeZone.instance}):f.DateTime.fromJSDate(r,{zone:y});switch(y){case "system":case "local":case null:return f.DateTime.fromJSDate(r);default:return"unknown"===y?.toLowerCase()?f.DateTime.fromMillis(r.getTime(),{zone:a.UnknownTimeZone.instance}):f.DateTime.fromJSDate(r,{zone:y})}};b.isDate=function(r){return r instanceof
Date};b.isDateOnly=function(r){return r instanceof q.DateOnly};b.isDateTime=function(r){return r instanceof f.DateTime};b.isNumber=function(r){return"number"===typeof r};b.isSqlInterval=function(r){return r instanceof g.SqlInterval};b.isString=function(r){return"string"===typeof r||r instanceof String};b.isTimeOnly=function(r){return r instanceof l.TimeOnly};b.isTimestampOffset=function(r){return r instanceof k.SqlTimeStampOffset};b.parseDate=function(r,y){const z=x.exec(r);if(null===z)try{return d(r,
y)}catch{throw new n.SqlError(n.SqlErrorCodes.InvalidDate);}const [,u,v,A]=z;r=q.DateOnly.fromParts(parseInt(u,10),parseInt(v,10),parseInt(A,10));if(null===r)throw new n.SqlError(n.SqlErrorCodes.InvalidDate);return r};b.parseTime=function(r){let y=c.exec(r);if(null!==y){const [,z,u,v]=y;r=l.TimeOnly.fromParts(parseInt(z,10),parseInt(u,10),parseInt(v,10),0);if(null!==r)return r;throw new n.SqlError(n.SqlErrorCodes.InvalidTime);}y=e.exec(r);if(null!==y){const [,z,u]=y;r=l.TimeOnly.fromParts(parseInt(z,
10),parseInt(u,10),0,0);if(null!==r)return r;throw new n.SqlError(n.SqlErrorCodes.InvalidTime);}y=h.exec(r);if(null!==y){const [,z,u,v,A]=y;r=l.TimeOnly.fromParts(parseInt(z,10),parseInt(u,10),parseInt(v,10),parseInt(A,10));if(null!==r)return r}throw new n.SqlError(n.SqlErrorCodes.InvalidTime);};b.parseTimestamp=d;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/core/sql/SqlInterval":function(){define(["exports","./errorSupport"],function(b,q){class n{constructor(){this.op="+";
this.millis=this.minute=this.year=this.month=this.hour=this.second=this.day=0}static _fixDefaults(g){if(null!==g.precision||null!==g.secondary)throw new q.SqlError(q.SqlErrorCodes.PrimarySecondaryQualifiers);}static _parseSecondsComponent(g,k){k.includes(".")?(k=k.split("."),g.second=parseFloat(k[0]),g.millis=parseInt(k[1],10)):g.second=parseFloat(k)}static createFromMilliseconds(g){const k=new n;k.second=g/1E3;return k}static createFromValueAndQualifier(g,k,l){let a=null;const f=new n;f.op="-"===
l?"-":"+";if("interval-period"===k.type){n._fixDefaults(k);l=RegExp("^[0-9]{1,}$");if("year"===k.period||"month"===k.period)throw new q.SqlError(q.SqlErrorCodes.YearMonthIntervals);if("second"===k.period)if(/^[0-9]{1,}([.]{1}[0-9]{1,}){0,1}$/.test(g))n._parseSecondsComponent(f,g);else throw new q.SqlError(q.SqlErrorCodes.IllegalInterval);else if(l.test(g))f[k.period]=parseFloat(g);else throw new q.SqlError(q.SqlErrorCodes.IllegalInterval);}else{n._fixDefaults(k.start);n._fixDefaults(k.end);if("year"===
k.start.period||"month"===k.start.period||"year"===k.end.period||"month"===k.end.period)throw new q.SqlError(q.SqlErrorCodes.YearMonthIntervals);switch(k.start.period){case "day":switch(k.end.period){case "hour":a=RegExp("^[0-9]{1,} [0-9]{1,}$");if(a.test(g))f[k.start.period]=parseFloat(g.split(" ")[0]),f[k.end.period]=parseFloat(g.split(" ")[1]);else throw new q.SqlError(q.SqlErrorCodes.IllegalInterval);break;case "minute":a=RegExp("^[0-9]{1,} [0-9]{1,2}:[0-9]{1,}$");if(a.test(g))f[k.start.period]=
parseFloat(g.split(" ")[0]),g=g.split(" ")[1].split(":"),f.hour=parseFloat(g[0]),f.minute=parseFloat(g[1]);else throw new q.SqlError(q.SqlErrorCodes.IllegalInterval);break;case "second":a=RegExp("^[0-9]{1,} [0-9]{1,2}:[0-9]{1,2}:[0-9]{1,}([.]{1}[0-9]{1,}){0,1}$");if(a.test(g))f[k.start.period]=parseFloat(g.split(" ")[0]),g=g.split(" ")[1].split(":"),f.hour=parseFloat(g[0]),f.minute=parseFloat(g[1]),n._parseSecondsComponent(f,g[2]);else throw new q.SqlError(q.SqlErrorCodes.IllegalInterval);break;default:throw new q.SqlError(q.SqlErrorCodes.IllegalInterval);
}break;case "hour":switch(k.end.period){case "minute":a=RegExp("^[0-9]{1,}:[0-9]{1,}$");if(a.test(g))f.hour=parseFloat(g.split(":")[0]),f.minute=parseFloat(g.split(":")[1]);else throw new q.SqlError(q.SqlErrorCodes.IllegalInterval);break;case "second":a=RegExp("^[0-9]{1,}:[0-9]{1,2}:[0-9]{1,}([.]{1}[0-9]{1,}){0,1}$");if(a.test(g))g=g.split(":"),f.hour=parseFloat(g[0]),f.minute=parseFloat(g[1]),n._parseSecondsComponent(f,g[2]);else throw new q.SqlError(q.SqlErrorCodes.IllegalInterval);break;default:throw new q.SqlError(q.SqlErrorCodes.IllegalInterval);
}break;case "minute":switch(k.end.period){case "second":a=RegExp("^[0-9]{1,}:[0-9]{1,}([.]{1}[0-9]{1,}){0,1}$");if(a.test(g))g=g.split(":"),f.minute=parseFloat(g[0]),n._parseSecondsComponent(f,g[1]);else throw new q.SqlError(q.SqlErrorCodes.IllegalInterval);break;default:throw new q.SqlError(q.SqlErrorCodes.IllegalInterval);}break;default:throw new q.SqlError(q.SqlErrorCodes.IllegalInterval);}}return f}valueInMilliseconds(){return("-"===this.op?-1:1)*(this.millis+1E3*this.second+6E4*this.minute+36E5*
this.hour+864E5*this.day+365/12*this.month*864E5+31536E6*this.year)}}b.SqlInterval=n;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/core/sql/StandardizedFunctions":function(){define("exports ../mathUtils ../string ./DateOnly ./errorSupport ./sqlCompareUtils ./sqlDateParsingUtils ./TimeOnly ../../chunks/datetime".split(" "),function(b,q,n,g,k,l,a,f,d){function c(w){return"string"===typeof w||w instanceof String}function e(w){return a.isDate(w)||a.isDateOnly(w)||a.isDateTime(w)||
a.isTimeOnly(w)||a.isTimestampOffset(w)?!1:!0}function h(w){return a.isDateOnly(w)||a.isTimeOnly(w)?w.toString():a.isTimestampOffset(w)?w.toSQLValue():a.isDateTime(w)?0===w.millisecond?w.toFormat("yyyy-LL-dd HH:mm:ss"):w.toSQL({includeOffset:!1}):a.isDate(w)?h(d.DateTime.fromJSDate(w)):w.toString()}function x(w){if(a.isDate(w))return g.DateOnly.fromDateJS(w);if(a.isDateTime(w))return g.DateOnly.fromParts(w.year,w.month,w.day);if(a.isDateOnly(w))return w;if(a.isTimeOnly(w))throw new k.SqlError(k.SqlErrorCodes.CannotCastValue);
if(a.isTimestampOffset(w)&&null===g.DateOnly.fromParts(w.year,w.month,w.day))throw new k.SqlError(k.SqlErrorCodes.CannotCastValue);if(c(w)&&(w=g.DateOnly.fromReader(w),null!==w&&w.isValid))return w;throw new k.SqlError(k.SqlErrorCodes.CannotCastValue);}function m(w,r,y){if(a.isDate(w))return a.convertToExecutingTimeZone(w,r);if(a.isDateTime(w))return w;if(a.isDateOnly(w))return w.toDateTimeLuxon("unknown");if(a.isTimeOnly(w))throw new k.SqlError(k.SqlErrorCodes.CannotCastValue);if(a.isTimestampOffset(w))return w;
if(c(w))return a.parseTimestamp(w,"unknown",y);throw new k.SqlError(k.SqlErrorCodes.CannotCastValue);}function p(w){if(a.isDate(w))return f.TimeOnly.fromDateJS(w);if(a.isDateTime(w))return f.TimeOnly.fromDateTime(w);if(a.isDateOnly(w))throw new k.SqlError(k.SqlErrorCodes.CannotCastValue);if(a.isTimeOnly(w))return w;if(a.isTimestampOffset(w))return f.TimeOnly.fromSqlTimeStampOffset(w);if(c(w))return a.parseTime(w);throw new k.SqlError(k.SqlErrorCodes.CannotCastValue);}const t={extract:{minParams:2,
maxParams:2,evaluate:([w,r])=>{if(null==r)return null;if(a.isDate(r))switch(w.toUpperCase()){case "SECOND":return r.getSeconds();case "MINUTE":return r.getMinutes();case "HOUR":return r.getHours();case "DAY":return r.getDate();case "MONTH":return r.getMonth()+1;case "YEAR":return r.getFullYear();case "TIMEZONE_HOUR":return 0;case "TIMEZONE_MINUTE":return 0}else if(a.isDateTime(r))switch(w.toUpperCase()){case "SECOND":return r.second;case "MINUTE":return r.minute;case "HOUR":return r.hour;case "DAY":return r.day;
case "MONTH":return r.month;case "YEAR":return r.year}else if(a.isDateOnly(r))switch(w.toUpperCase()){case "DAY":return r.day;case "MONTH":return r.month;case "YEAR":return r.year}else if(a.isTimeOnly(r))switch(w.toUpperCase()){case "SECOND":return r.second;case "MINUTE":return r.minute;case "HOUR":return r.hour}else if(a.isTimestampOffset(r))switch(w.toUpperCase()){case "SECOND":return r.second;case "MINUTE":return r.minute;case "HOUR":return r.hour;case "DAY":return r.day;case "MONTH":return r.month;
case "YEAR":return r.year;case "TIMEZONE_HOUR":return r.timezoneOffsetHour;case "TIMEZONE_MINUTE":return r.timezoneOffsetMinutes}throw new k.SqlError(k.SqlErrorCodes.InvalidFunctionParameters,{function:"EXTRACT"});}},substring:{minParams:2,maxParams:3,evaluate:w=>{if(2===w.length){const [r,y]=w;return null==r||null==y?null:r.toString().substring(y-1)}if(3===w.length){const [r,y,z]=w;return null==r||null==y||null==z?null:0>=z?"":r.toString().substring(y-1,y+z-1)}}},position:{minParams:2,maxParams:2,
evaluate:([w,r])=>null==w||null==r?null:r.indexOf(w)+1},trim:{minParams:2,maxParams:3,evaluate:w=>{var r=3===w.length,y=r?w[1]:" ";r=r?w[2]:w[1];if(null==y||null==r)return null;y=`(${n.escapeRegExpString(y)})`;switch(w[0]){case "BOTH":return r.replaceAll(new RegExp(`^${y}*|${y}*$`,"g"),"");case "LEADING":return r.replaceAll(new RegExp(`^${y}*`,"g"),"");case "TRAILING":return r.replaceAll(new RegExp(`${y}*$`,"g"),"")}throw new k.SqlError(k.SqlErrorCodes.InvalidFunctionParameters,{function:"TRIM"});
}},abs:{minParams:1,maxParams:1,evaluate:w=>null==w[0]?null:Math.abs(w[0])},ceiling:{minParams:1,maxParams:1,evaluate:w=>null==w[0]?null:Math.ceil(w[0])},floor:{minParams:1,maxParams:1,evaluate:w=>null==w[0]?null:Math.floor(w[0])},log:{minParams:1,maxParams:1,evaluate:w=>null==w[0]?null:Math.log(w[0])},log10:{minParams:1,maxParams:1,evaluate:w=>null==w[0]?null:Math.log(w[0])*Math.LOG10E},sin:{minParams:1,maxParams:1,evaluate:w=>null==w[0]?null:Math.sin(w[0])},cos:{minParams:1,maxParams:1,evaluate:w=>
null==w[0]?null:Math.cos(w[0])},tan:{minParams:1,maxParams:1,evaluate:w=>null==w[0]?null:Math.tan(w[0])},asin:{minParams:1,maxParams:1,evaluate:w=>null==w[0]?null:Math.asin(w[0])},acos:{minParams:1,maxParams:1,evaluate:w=>null==w[0]?null:Math.acos(w[0])},atan:{minParams:1,maxParams:1,evaluate:w=>null==w[0]?null:Math.atan(w[0])},sign:{minParams:1,maxParams:1,evaluate:w=>null==w[0]?null:0<w[0]?1:0>w[0]?-1:0},power:{minParams:2,maxParams:2,evaluate:w=>null==w[0]||null==w[1]?null:w[0]**w[1]},mod:{minParams:2,
maxParams:2,evaluate:w=>null==w[0]||null==w[1]?null:w[0]%w[1]},round:{minParams:1,maxParams:2,evaluate:w=>{const r=w[0];w=2===w.length?10**w[1]:1;return null==r?null:Math.round(r*w)/w}},truncate:{minParams:1,maxParams:2,evaluate:w=>null==w[0]?null:1===w.length||0===w[1]?Math.trunc(w[0]):q.decimalAdjust("trunc",w[0],-Number(w[1]))},char_length:{minParams:1,maxParams:1,evaluate:w=>c(w[0])?w[0].length:0},concat:{minParams:1,maxParams:Infinity,evaluate:w=>{let r="";for(let y=0;y<w.length;y++){if(null==
w[y])return null;r+=w[y].toString()}return r}},lower:{minParams:1,maxParams:1,evaluate:w=>null==w[0]?null:w[0].toString().toLowerCase()},upper:{minParams:1,maxParams:1,evaluate:w=>null==w[0]?null:w[0].toString().toUpperCase()},coalesce:{minParams:1,maxParams:Infinity,evaluate:w=>{for(const r of w)if(null!==r)return r;return null}},cosh:{minParams:1,maxParams:1,evaluate:w=>null==w[0]?null:Math.cosh(w[0])},sinh:{minParams:1,maxParams:1,evaluate:w=>null==w[0]?null:Math.sinh(w[0])},tanh:{minParams:1,
maxParams:1,evaluate:w=>null==w[0]?null:Math.tanh(w[0])},nullif:{minParams:2,maxParams:2,evaluate:(w,r)=>l.sqlCompare(w[0],w[1],"\x3d")?null:w[0]},cast:{minParams:2,maxParams:2,evaluate:(w,r)=>{const y=w[0];w=w[1];if(null===y)return null;switch(w.type){case "integer":if(!e(y))throw new k.SqlError(k.SqlErrorCodes.CannotCastValue);r=parseInt(y,10);if(isNaN(r))throw new k.SqlError(k.SqlErrorCodes.CannotCastValue);return r;case "smallint":if(!e(y))throw new k.SqlError(k.SqlErrorCodes.CannotCastValue);
r=parseInt(y,10);if(isNaN(r))throw new k.SqlError(k.SqlErrorCodes.CannotCastValue);if(32767<r||-32767>r)throw new k.SqlError(k.SqlErrorCodes.CannotCastValue);return r;case "float":case "real":if(!e(y))throw new k.SqlError(k.SqlErrorCodes.CannotCastValue);r=parseFloat(y);if(isNaN(r))throw new k.SqlError(k.SqlErrorCodes.CannotCastValue);return r;case "time":return p(y);case "date":return x(y);case "timestamp":return m(y,r,!0===w.withtimezone);case "varchar":r=h(y);if(r.length>w.size)throw new k.SqlError(k.SqlErrorCodes.CannotCastValue);
return r;default:throw new k.SqlError(k.SqlErrorCodes.InvalidDataType);}}}};b.evaluateFunction=function(w,r,y){const z=t[w.toLowerCase()];if(null==z)throw new k.SqlError(k.SqlErrorCodes.FunctionNotRecognized);if(r.length<z.minParams||r.length>z.maxParams)throw new k.SqlError(k.SqlErrorCodes.InvalidParameterCount,{name:w.toUpperCase()});return z.evaluate(r,y)};b.isStandardized=function(w,r){w=t[w.toLowerCase()];return null!=w&&r>=w.minParams&&r<=w.maxParams};Object.defineProperty(b,Symbol.toStringTag,
{value:"Module"})})},"esri/core/sql/sqlCompareUtils":function(){define("exports ./errorSupport ./sqlDateParsingUtils ./SqlTimestampOffset ./UnknownTimeZone ../../chunks/datetime".split(" "),function(b,q,n,g,k,l){function a(t){return n.isDateTime(t)||n.isTimestampOffset(t)?!0:!1}function f(t){return n.isDateTime(t)||n.isDateOnly(t)||n.isTimestampOffset(t)||n.isTimeOnly(t)?!0:!1}function d(t){if(n.isDateTime(t))return t.toMillis();if(n.isDateOnly(t))return t.toNumber();if(n.isTimestampOffset(t))return t.toMilliseconds();
throw new q.SqlError(q.SqlErrorCodes.InvalidDataType);}function c(t,w,r){switch(r){case "\x3c\x3e":return t!==w;case "\x3d":return t===w;case "\x3e":return t>w;case "\x3c":return t<w;case "\x3e\x3d":return t>=w;case "\x3c\x3d":return t<=w}}function e(t,w,r){const y=parseFloat(w);if(!isNaN(y))return c(t,y,r);t=t.toString();switch(r){case "\x3c\x3e":return t!==w;case "\x3d":return t===w;case "\x3e":return t>w;case "\x3c":return t<w;case "\x3e\x3d":return t>=w;case "\x3c\x3d":return t<=w}}function h(t,
w,r){const y=parseFloat(t);if(!isNaN(y))return c(y,w,r);w=w.toString();switch(r){case "\x3c\x3e":return t!==w;case "\x3d":return t===w;case "\x3e":return t>w;case "\x3c":return t<w;case "\x3e\x3d":return t>=w;case "\x3c\x3d":return t<=w}}function x(t,w,r){switch(r){case "\x3c\x3e":return t!==w;case "\x3d":return t===w;case "\x3e":return t>w;case "\x3c":return t<w;case "\x3e\x3d":return t>=w;case "\x3c\x3d":return t<=w}}function m(t,w,r){t instanceof g.SqlTimeStampOffset&&(t=t.toDateTime());w instanceof
g.SqlTimeStampOffset&&(w=w.toDateTime());t=p(t);w=p(w);switch(r){case "\x3c\x3e":return t!==w;case "\x3d":return t===w;case "\x3e":return t>w;case "\x3c":return t<w;case "\x3e\x3d":return t>=w;case "\x3c\x3d":return t<=w}}function p(t){return 321408E5*t.year+26784E5*t.month+864E5*t.day+36E5*t.hour+6E4*t.minute+1E3*t.second+t.millisecond}b.dateValueInMilliseconds=d;b.isDateOrTimeValue=f;b.isDateTimeComparableValue=a;b.sqlCompare=function(t,w,r,y){if(null==t||null==w)return null;if(n.isNumber(t)){if(n.isNumber(w))return c(t,
w,r);if(n.isString(w))return e(t,w,r);if(f(w))throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);if(n.isDateOnly(w))throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);}else if(n.isString(t)){if(n.isNumber(w))return h(t,w,r);if(n.isString(w))return x(t,w,r);if(n.isDateTime(w))throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);if(n.isDateOnly(w))throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);if(n.isTimeOnly(w))throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);if(n.isTimestampOffset(w))throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);
}else if(n.isDateTime(t)){if(a(w)){if(t instanceof l.DateTime&&k.isUnknownTimeZone(t.zone)){if(w instanceof l.DateTime&&!1===k.isUnknownTimeZone(w.zone)||w instanceof g.SqlTimeStampOffset)return m(t,w,r)}else if(w instanceof l.DateTime&&k.isUnknownTimeZone(w.zone)&&(t instanceof l.DateTime&&!1===k.isUnknownTimeZone(t.zone)||t instanceof g.SqlTimeStampOffset))return m(t,w,r);return c(d(t),d(w),r)}if(n.isString(w))throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);if(n.isDateOnly(w))return w=w.toDateTimeLuxon(t.zone),
t=t.startOf("day"),c(t.toMillis(),w.toMillis(),r);if(n.isTimeOnly(w))throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);if(n.isNumber(w))throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);}else if(n.isDateOnly(t)){if(n.isTimestampOffset(w))return t=t.toDateTimeLuxon(w.toDateTime().zone),w=w.startOfDay(),c(t.toMillis(),w.toMilliseconds(),r);if(n.isDateTime(w))return t=t.toDateTimeLuxon(w.zone),w=w.startOf("day"),c(t.toMillis(),w.toMillis(),r);if(n.isString(w))throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);
if(n.isDateOnly(w))return c(t.toNumber(),w.toNumber(),r);if(n.isTimeOnly(w))throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);if(n.isNumber(w))throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);}else if(n.isTimeOnly(t)){if(n.isTimeOnly(w))return c(t.toNumber(),w.toNumber(),r);if(n.isString(w))throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);if(n.isNumber(w))throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);if(n.isDateOnly(w))throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);if(a(w))throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);
}else if(n.isTimestampOffset(t)){if(a(w))return w instanceof l.DateTime&&k.isUnknownTimeZone(w.zone)?m(t,w,r):c(d(t),d(w),r);if(n.isString(w))throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);if(n.isDateOnly(w))return w=w.toDateTimeLuxon(t.toDateTime().zone),t=t.startOfDay(),c(t.toMilliseconds(),w.toMillis(),r);if(n.isTimeOnly(w))throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);if(n.isNumber(w))throw new q.SqlError(q.SqlErrorCodes.InvalidOperator);}switch(r){case "\x3c\x3e":return t!==w;
case "\x3d":return t===w;case "\x3e":return t>w;case "\x3c":return t<w;case "\x3e\x3d":return t>=w;case "\x3c\x3d":return t<=w}};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/core/sql/WhereGrammar":function(){define(["exports"],function(b){function q(a,f,d,c){a=Error.call(this,a);Object.setPrototypeOf&&Object.setPrototypeOf(a,q.prototype);a.expected=f;a.found=d;a.location=c;a.name="SyntaxError";return a}function n(a,f,d){d=d||" ";if(a.length>f)return a;f-=a.length;d+=d.repeat(f);
return a+d.slice(0,f)}function g(a,f){function d(){return m(xa,P)}function c(U,V){V=void 0!==V?V:m(xa,P);throw new q(U,null,null,V);}function e(U,V){return{type:"literal",text:U,ignoreCase:V}}function h(U,V,fa){return{type:"class",parts:U,inverted:V,ignoreCase:fa}}function x(U){var V=rc[U];if(!V){if(U>=rc.length)var fa=rc.length-1;else for(fa=U;!rc[--fa];);V=rc[fa];for(V={line:V.line,column:V.column};fa<U;)10===a.charCodeAt(fa)?(V.line++,V.column=1):V.column++,fa++;rc[U]=V}return V}function m(U,V,
fa){fa=x(U);var ma=x(V);return{source:nd,start:{offset:U,line:fa.line,column:fa.column},end:{offset:V,line:ma.line,column:ma.column}}}function p(U){P<Va||(P>Va&&(Va=P,sc=[]),sc.push(U))}function t(){var U=P;ua();var V=r();V!==I?(ua(),xa=U,U=V):(P=U,U=I);return U}function w(){var U;var V=P;if(Oa()!==I){ua();var fa=[];for(U=r();U!==I;){fa.push(U);var ma=U=P;var Ca=ua();var Da=Za();Da!==I?(ma=ua(),ma=Ca=[Ca,Da,ma]):(P=ma,ma=I);ma!==I?(ma=r(),ma===I?(P=U,U=I):U=ma):U=ma}U=ua();ma=Pa();ma!==I?(xa=V,V=
Na(d(),...fa)):(P=V,V=I)}else P=V,V=I;return V}function r(){var U=P;var V=y();if(V!==I){var fa=[];var ma=P;ua();var Ca=la();if(Ca!==I){ua();var Da=y();Da!==I?(xa=ma,ma={op:Ca,expr:Da,location:d()}):(P=ma,ma=I)}else P=ma,ma=I;for(;ma!==I;)fa.push(ma),ma=P,ua(),Ca=la(),Ca!==I?(ua(),Da=y(),Da!==I?(xa=ma,ma={op:Ca,expr:Da,location:d()}):(P=ma,ma=I)):(P=ma,ma=I);xa=U;U=Yb(V,fa)}else P=U,U=I;return U}function y(){var U=P;var V=z();if(V!==I){var fa=[];var ma=P;ua();var Ca=ba();if(Ca!==I){ua();var Da=z();
Da!==I?(xa=ma,ma={op:Ca,expr:Da,location:d()}):(P=ma,ma=I)}else P=ma,ma=I;for(;ma!==I;)fa.push(ma),ma=P,ua(),Ca=ba(),Ca!==I?(ua(),Da=z(),Da!==I?(xa=ma,ma={op:Ca,expr:Da,location:d()}):(P=ma,ma=I)):(P=ma,ma=I);xa=U;U=Yb(V,fa)}else P=U,U=I;return U}function z(){var U=P;var V=X();if(V===I){V=P;if(33===a.charCodeAt(P)){var fa=Pd;P++}else fa=I,0===ta&&p(zf);if(fa!==I){var ma=P;ta++;if(61===a.charCodeAt(P)){var Ca=Qd;P++}else Ca=I,0===ta&&p(Af);ta--;Ca===I?ma=void 0:(P=ma,ma=I);ma!==I?V=fa=[fa,ma]:(P=V,
V=I)}else P=V,V=I}V!==I?(fa=ua(),ma=z(),ma!==I?(xa=U,U={type:"unary-expression",location:d(),operator:"NOT",expr:ma}):(P=U,U=I)):(P=U,U=I);if(U===I){V=P;U=B();if(U!==I){fa=P;ua();ma=P;Ca=[];var Da=P;ua();var Ka=u();if(Ka!==I){ua();var Sa=B();Sa!==I?(xa=Da,Da={op:Ka,expr:Sa,location:d()}):(P=Da,Da=I)}else P=Da,Da=I;if(Da!==I)for(;Da!==I;)Ca.push(Da),Da=P,ua(),Ka=u(),Ka!==I?(ua(),Sa=B(),Sa!==I?(xa=Da,Da={op:Ka,expr:Sa,location:d()}):(P=Da,Da=I)):(P=Da,Da=I);else Ca=I;Ca!==I&&(xa=ma,Ca={type:"arithmetic",
tail:Ca});ma=Ca;if(ma===I&&(ma=P,Ca=A(),Ca!==I?(ua(),Da=w(),Da!==I?(xa=ma,ma={op:Ca,right:Da}):(P=ma,ma=I)):(P=ma,ma=I),ma===I&&(ma=P,Ca=A(),Ca!==I?(ua(),Da=ca(),Da!==I?(xa=ma,ma={op:Ca,right:Da}):(P=ma,ma=I)):(P=ma,ma=I)),ma===I)){ma=P;Ca=X();if(Ca!==I)if(ua(),Da=pa(),Da!==I){var eb=ua();Ka=P;Sa=B();if(Sa!==I){ua();var jb=ba();jb!==I?(ua(),Ca=B(),Ca!==I?(xa=Ka,Ka=Sa,Ka=Na(d(),Ka,Ca)):(P=Ka,Ka=I)):(P=Ka,Ka=I)}else P=Ka,Ka=I;Ka!==I?(xa=ma,ma={op:"NOT"+Da,right:Ka}):(P=ma,ma=I)}else P=ma,ma=I;else P=
ma,ma=I;ma===I&&(ma=P,Ca=pa(),Ca!==I?(ua(),Da=P,eb=B(),eb!==I?(Ka=ua(),Sa=ba(),Sa!==I?(ua(),jb=B(),jb!==I?(xa=Da,Da=eb,Ka=jb,Da=Na(d(),Da,Ka)):(P=Da,Da=I)):(P=Da,Da=I)):(P=Da,Da=I),Da!==I?(xa=ma,ma={op:Ca,right:Da}):(P=ma,ma=I)):(P=ma,ma=I));ma===I&&(ma=P,Ca=oa(),Ca!==I?(ua(),Da=X(),Da!==I?(ua(),Da=B(),Da!==I?(xa=ma,ma={op:Ca+"NOT",right:Da}):(P=ma,ma=I)):(P=ma,ma=I)):(P=ma,ma=I),ma===I&&(ma=P,Ca=oa(),Ca!==I?(ua(),Da=B(),Da!==I?(xa=ma,ma={op:Ca,right:Da}):(P=ma,ma=I)):(P=ma,ma=I)),ma===I&&(ma=P,Ca=
v(),Ca!==I?(ua(),Da=aa(),Da!==I?(ua(),Ka=P,Sa=a.substr(P,6),Sa.toLowerCase()===rf?P+=6:(Sa=I,0===ta&&p(Ve)),Sa!==I?(Sa=P,ta++,jb=D(),ta--,jb===I?Sa=void 0:(P=Sa,Sa=I),Sa!==I?(xa=Ka,Ka="ESCAPE"):(P=Ka,Ka=I)):(P=Ka,Ka=I),Ka!==I?(ua(),Ka=ia(),Ka!==I?(xa=ma,ma={op:Ca,right:Da,escape:Ka.value}):(P=ma,ma=I)):(P=ma,ma=I)):(P=ma,ma=I)):(P=ma,ma=I),ma===I&&(ma=P,Ca=v(),Ca!==I?(ua(),Da=aa(),Da!==I?(xa=ma,ma={op:Ca,right:Da,escape:""}):(P=ma,ma=I)):(P=ma,ma=I))))}ma!==I?fa=ma:(P=fa,fa=I);fa===I&&(fa=null);xa=
V;V=fa;""==V||void 0==V||null==V?V=U:(fa=null,V=fa="arithmetic"==V.type?Yb(U,V.tail):Hb(V.op,U,V.right,V.escape,d()))}else P=V,V=I;U=V}return U}function u(){if(a.substr(P,2)===Rd){var U=Rd;P+=2}else U=I,0===ta&&p(yd);U===I&&(62===a.charCodeAt(P)?(U=Sd,P++):(U=I,0===ta&&p($b)),U===I&&(a.substr(P,2)===hc?(U=hc,P+=2):(U=I,0===ta&&p(rb)),U===I&&(a.substr(P,2)===Td?(U=Td,P+=2):(U=I,0===ta&&p(Ab)),U===I&&(U=a.charAt(P),fe.test(U)?P++:(U=I,0===ta&&p(zd)),U===I&&(a.substr(P,2)===mb?(U=mb,P+=2):(U=I,0===ta&&
p(Pe)))))));return U}function v(){var U;var V=U=P;var fa=X();if(fa!==I){var ma=ua();var Ca=S();Ca!==I?V=fa=[fa,ma,Ca]:(P=V,V=I)}else P=V,V=I;V!==I&&(xa=U,V=V[0]+" "+V[2]);U=V;U===I&&(U=S());return U}function A(){var U;var V=U=P;var fa=X();if(fa!==I){var ma=ua();var Ca=ha();Ca!==I?V=fa=[fa,ma,Ca]:(P=V,V=I)}else P=V,V=I;V!==I&&(xa=U,V=V[0]+" "+V[2]);U=V;U===I&&(U=ha());return U}function B(){var U=P;var V=H();if(V!==I){var fa=[];var ma=P;ua();var Ca=F();if(Ca!==I){ua();var Da=H();Da!==I?(xa=ma,ma={op:Ca,
expr:Da,location:d()}):(P=ma,ma=I)}else P=ma,ma=I;for(;ma!==I;)fa.push(ma),ma=P,ua(),Ca=F(),Ca!==I?(ua(),Da=H(),Da!==I?(xa=ma,ma={op:Ca,expr:Da,location:d()}):(P=ma,ma=I)):(P=ma,ma=I);xa=U;U=Yb(V,fa)}else P=U,U=I;return U}function F(){var U=a.charAt(P);Rb.test(U)?P++:(U=I,0===ta&&p(ac));U===I&&(a.substr(P,2)===yb?(U=yb,P+=2):(U=I,0===ta&&p(Bf)));return U}function H(){var U=P;var V=E();if(V!==I){var fa=[];var ma=P;ua();var Ca=J();if(Ca!==I){ua();var Da=E();Da!==I?(xa=ma,ma={op:Ca,expr:Da,location:d()}):
(P=ma,ma=I)}else P=ma,ma=I;for(;ma!==I;)fa.push(ma),ma=P,ua(),Ca=J(),Ca!==I?(ua(),Da=E(),Da!==I?(xa=ma,ma={op:Ca,expr:Da,location:d()}):(P=ma,ma=I)):(P=ma,ma=I);xa=U;U=Yb(V,fa)}else P=U,U=I;return U}function J(){var U=a.charAt(P);xd.test(U)?P++:(U=I,0===ta&&p(Cf));return U}function E(){var U=ia();if(U===I){var V=P;var fa=P;var ma=va();if(ma!==I){var Ca=wa();if(Ca!==I){var Da=M();Da!==I?(xa=fa,fa=parseFloat(ma+Ca+Da)):(P=fa,fa=I)}else P=fa,fa=I}else P=fa,fa=I;fa===I&&(fa=P,ma=va(),ma!==I?(Ca=wa(),
Ca!==I?(xa=fa,fa=parseFloat(ma+Ca)):(P=fa,fa=I)):(P=fa,fa=I),fa===I&&(fa=P,ma=va(),ma!==I?(Ca=M(),Ca!==I?(xa=fa,fa=parseFloat(ma+Ca)):(P=fa,fa=I)):(P=fa,fa=I),fa===I&&(fa=P,ma=va(),ma!==I&&(xa=fa,ma=parseFloat(ma)),fa=ma)));var Ka=fa;if(Ka!==I){var Sa=P;ta++;var eb=C();ta--;eb===I?Sa=void 0:(P=Sa,Sa=I);Sa!==I?(xa=V,V={type:"number",location:d(),value:Ka}):(P=V,V=I)}else P=V,V=I;U=V;if(U===I){var jb=P;var Eb=P;var Yc=a.substr(P,4);Yc.toLowerCase()===qf?P+=4:(Yc=I,0===ta&&p(Cc));if(Yc!==I){var Hc=P;
ta++;var sb=D();ta--;sb===I?Hc=void 0:(P=Hc,Hc=I);Hc!==I?Eb=Yc=[Yc,Hc]:(P=Eb,Eb=I)}else P=Eb,Eb=I;var ec=Eb;ec!==I&&(xa=jb,ec={type:"boolean",location:d(),value:!0});jb=ec;if(jb===I){jb=P;var Ic=P;var Zc=a.substr(P,5);Zc.toLowerCase()===Vd?P+=5:(Zc=I,0===ta&&p(Cd));if(Zc!==I){var tc=P;ta++;var af=D();ta--;af===I?tc=void 0:(P=tc,tc=I);tc!==I?Ic=Zc=[Zc,tc]:(P=Ic,Ic=I)}else P=Ic,Ic=I;ec=Ic;ec!==I&&(xa=jb,ec={type:"boolean",location:d(),value:!1});jb=ec}U=jb;if(U===I){var Lf=P;var Vb=P;var uc=a.substr(P,
4);uc.toLowerCase()===Fe?P+=4:(uc=I,0===ta&&p(Bd));if(uc!==I){var Fb=P;ta++;var bf=D();ta--;bf===I?Fb=void 0:(P=Fb,Fb=I);Fb!==I?Vb=uc=[uc,Fb]:(P=Vb,Vb=I)}else P=Vb,Vb=I;var Ld=Vb;Ld!==I&&(xa=Lf,Ld={type:"null",location:d(),value:null});U=Ld;if(U===I){var tb=P;if(ra()!==I){ua();var Lb=aa();Lb!==I?(xa=tb,"string"===Lb.type&&!0!==/^(\d{4})-(\d{1,2})-(\d{1,2})$|^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2}):(\d{1,2})(\.[0-9]+)?$|^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2}):(\d{1,2})(\.[0-9]+)?[ ]{0,1}(\+|\-)(\d{1,2}):(\d{1,2})$|^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2})?[ ]{0,1}(\+|\-)(\d{1,2}):(\d{1,2})$|^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2})$/.test(Lb.value)&&
c("Date literal is invalid"),tb={type:"date",location:d(),value:Lb.value}):(P=tb,tb=I)}else P=tb,tb=I;U=tb;if(U===I){var ub=P;if(na()!==I){ua();var $c=aa();$c!==I?(xa=ub,"string"===$c.type&&!0!==/^(\d{4})-(\d{1,2})-(\d{1,2})$|^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2}):(\d{1,2})(\.[0-9]+)?$|^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2}):(\d{1,2})(\.[0-9]+)?[ ]{0,1}(\+|\-)(\d{1,2}):(\d{1,2})$|^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2})?[ ]{0,1}(\+|\-)(\d{1,2}):(\d{1,2})$|^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2})$/.test($c.value)&&
c("Timestamp literal is invalid"),ub={type:"timestamp",location:d(),value:$c.value}):(P=ub,ub=I)}else P=ub,ub=I;U=ub;if(U===I){var $a=P;var Md=za();if(Md!==I){ua();var pb=a.charAt(P);Rb.test(pb)?P++:(pb=I,0===ta&&p(ac));if(pb!==I){ua();var Mb=aa();if(Mb!==I){ua();var Wb=Z();if(Wb!==I){xa=$a;var Jc=pb,Nd=Mb;$a={type:"interval",location:d(),value:Nd,qualifier:Wb,op:Jc}}else P=$a,$a=I}else P=$a,$a=I}else P=$a,$a=I}else P=$a,$a=I;if($a===I)if($a=P,Md=za(),Md!==I)if(ua(),pb=aa(),pb!==I)if(ua(),Mb=Z(),
Mb!==I){xa=$a;var Nb=pb,Mf=Mb;$a={type:"interval",location:d(),value:Nb,qualifier:Mf,op:""}}else P=$a,$a=I;else P=$a,$a=I;else P=$a,$a=I;U=$a;if(U===I){var kb=P;if(Aa()!==I){ua();var wb=aa();wb!==I?(xa=kb,"string"===wb.type&&!0!==/^(\d{1,2}):(\d{1,2}):(\d{1,2})$|^(\d{1,2}):(\d{1,2})$|^(\d{1,2}):(\d{1,2}):(\d{1,2}).([0-9]+)$/.test(wb.value)&&c("Time literal is invalid"),kb={type:"time",location:d(),value:wb.value}):(P=kb,kb=I)}else P=kb,kb=I;U=kb}}}}}}}var Qa=U;if(Qa===I){var Wa=P;if(ea()!==I){ua();
var La=P;var ad=Oa();if(ad!==I){ua();var fb=R();if(fb!==I){ua();var xb=O();if(xb!==I){ua();var Ga=r();if(Ga!==I){ua();var Ra=Pa();if(Ra!==I){xa=La;var db=fb,qb=Ga;La=Na(d(),db,qb)}else P=La,La=I}else P=La,La=I}else P=La,La=I}else P=La,La=I}else P=La,La=I;if(La===I)if(La=P,ad=Oa(),ad!==I)if(ua(),fb=R(),fb!==I)if(ua(),xb=Za(),xb!==I)if(ua(),Ga=r(),Ga!==I)if(ua(),Ra=Pa(),Ra!==I){xa=La;var Ud=fb,rg=Ga;La=Na(d(),Ud,rg)}else P=La,La=I;else P=La,La=I;else P=La,La=I;else P=La,La=I;else P=La,La=I;if(La!==
I){xa=Wa;var sg=La;Wa={type:"function",location:d(),name:"extract",args:sg}}else P=Wa,Wa=I}else P=Wa,Wa=I;Qa=Wa;if(Qa===I){var bd=P;var cd=P;var Nf=a.substr(P,9);Nf.toLowerCase()===Je?P+=9:(Nf=I,0===ta&&p(Sc));if(Nf!==I){var cf=P;ta++;var tg=D();ta--;tg===I?cf=void 0:(P=cf,cf=I);cf!==I?(xa=cd,cd="SUBSTRING"):(P=cd,cd=I)}else P=cd,cd=I;if(cd!==I){ua();var Ta=P;var Of=Oa();if(Of!==I){ua();var qe=r();if(qe!==I){ua();var Pf=O();if(Pf!==I){ua();var re=r();if(re!==I){ua();var fc=P;var dd=P;var Qf=a.substr(P,
3);Qf.toLowerCase()===Ib?P+=3:(Qf=I,0===ta&&p(Hd));if(Qf!==I){var df=P;ta++;var ug=D();ta--;ug===I?df=void 0:(P=df,df=I);df!==I?(xa=dd,dd="FOR"):(P=dd,dd=I)}else P=dd,dd=I;var ef=dd;if(ef!==I){var Rf=ua();var ff=r();ff!==I?(ua(),fc=ff):(P=fc,fc=I)}else P=fc,fc=I;fc===I&&(fc=null);ef=Pa();if(ef!==I){xa=Ta;var vg=qe,wg=re,jg=fc;Ta=Na(d(),vg,wg,...(jg?[jg]:[]))}else P=Ta,Ta=I}else P=Ta,Ta=I}else P=Ta,Ta=I}else P=Ta,Ta=I}else P=Ta,Ta=I;if(Ta===I)if(Ta=P,Of=Oa(),Of!==I)if(ua(),qe=r(),qe!==I)if(ua(),Pf=
Za(),Pf!==I)if(ua(),re=r(),re!==I)if(ua(),fc=Za(),fc!==I)if(ef=ua(),Rf=r(),Rf!==I)if(ff=Pa(),ff!==I){xa=Ta;var xg=qe,yg=re,zg=Rf;Ta=Na(d(),xg,yg,zg)}else P=Ta,Ta=I;else P=Ta,Ta=I;else P=Ta,Ta=I;else P=Ta,Ta=I;else P=Ta,Ta=I;else P=Ta,Ta=I;else P=Ta,Ta=I;if(Ta!==I){xa=bd;var Ag=Ta;bd={type:"function",location:d(),name:"substring",args:Ag}}else P=bd,bd=I}else P=bd,bd=I;Qa=bd;if(Qa===I){var ed=P;var fd=P;var Sf=a.substr(P,4);Sf.toLowerCase()===Ke?P+=4:(Sf=I,0===ta&&p(Tc));if(Sf!==I){var gf=P;ta++;var Bg=
D();ta--;Bg===I?gf=void 0:(P=gf,gf=I);gf!==I?(xa=fd,fd="TRIM"):(P=fd,fd=I)}else P=fd,fd=I;if(fd!==I){ua();var ab=P;var Tf=Oa();if(Tf!==I){ua();var Uf=Q();ua();var se=r();if(se!==I){ua();var Vf=O();if(Vf!==I){ua();var kg=r();if(kg!==I){ua();var Cg=Pa();if(Cg!==I){xa=ab;var Dg=Uf,Eg=se;ab=Na(d(),Dg,Eg,kg)}else P=ab,ab=I}else P=ab,ab=I}else P=ab,ab=I}else P=ab,ab=I}else P=ab,ab=I;if(ab===I)if(ab=P,Tf=Oa(),Tf!==I)if(ua(),Uf=Q(),ua(),se=r(),se!==I)if(ua(),Vf=Pa(),Vf!==I){xa=ab;var Fg=Uf,Gg=se;ab=Na(d(),
Fg,Gg)}else P=ab,ab=I;else P=ab,ab=I;else P=ab,ab=I;if(ab!==I){xa=ed;var Hg=ab;ed={type:"function",location:d(),name:"trim",args:Hg}}else P=ed,ed=I}else P=ed,ed=I;Qa=ed;if(Qa===I){var gd=P;var hd=P;var Wf=a.substr(P,8);Wf.toLowerCase()===yc?P+=8:(Wf=I,0===ta&&p(Id));if(Wf!==I){var hf=P;ta++;var Ig=D();ta--;Ig===I?hf=void 0:(P=hf,hf=I);hf!==I?(xa=hd,hd="POSITION"):(P=hd,hd=I)}else P=hd,hd=I;if(hd!==I){ua();var Xa=P;var Xf=Oa();if(Xf!==I){ua();var te=r();if(te!==I){ua();var Yf=ha();if(Yf!==I){ua();
var ue=r();if(ue!==I){ua();var Zf=Pa();if(Zf!==I){xa=Xa;var Jg=te,Kg=ue;Xa=Na(d(),Jg,Kg)}else P=Xa,Xa=I}else P=Xa,Xa=I}else P=Xa,Xa=I}else P=Xa,Xa=I}else P=Xa,Xa=I;if(Xa===I)if(Xa=P,Xf=Oa(),Xf!==I)if(ua(),te=r(),te!==I)if(ua(),Yf=Za(),Yf!==I)if(ua(),ue=r(),ue!==I)if(ua(),Zf=Pa(),Zf!==I){xa=Xa;var Lg=te,Mg=ue;Xa=Na(d(),Lg,Mg)}else P=Xa,Xa=I;else P=Xa,Xa=I;else P=Xa,Xa=I;else P=Xa,Xa=I;else P=Xa,Xa=I;if(Xa!==I){xa=gd;var Ng=Xa;gd={type:"function",location:d(),name:"position",args:Ng}}else P=gd,gd=I}else P=
gd,gd=I;Qa=gd;if(Qa===I){var id=P;var jd=P;var $f=a.substr(P,4);$f.toLowerCase()===Zd?P+=4:($f=I,0===ta&&p(ke));if($f!==I){var jf=P;ta++;var Og=D();ta--;Og===I?jf=void 0:(P=jf,jf=I);jf!==I?(xa=jd,jd="CAST"):(P=jd,jd=I)}else P=jd,jd=I;if(jd!==I){ua();var Ya=P;var ag=Oa();if(ag!==I){ua();var ve=r();if(ve!==I){ua();var kd=P;var bg=a.substr(P,2);bg.toLowerCase()===pd?P+=2:(bg=I,0===ta&&p(bc));if(bg!==I){var kf=P;ta++;var Pg=D();ta--;Pg===I?kf=void 0:(P=kf,kf=I);kf!==I?(xa=kd,kd="AS"):(P=kd,kd=I)}else P=
kd,kd=I;var cg=kd;if(cg!==I){ua();var we=ka();if(we!==I){ua();var dg=Pa();if(dg!==I){xa=Ya;var Qg=ve,Rg=we;Ya=Na(d(),Qg,Rg)}else P=Ya,Ya=I}else P=Ya,Ya=I}else P=Ya,Ya=I}else P=Ya,Ya=I}else P=Ya,Ya=I;if(Ya===I)if(Ya=P,ag=Oa(),ag!==I)if(ua(),ve=r(),ve!==I)if(ua(),cg=Za(),cg!==I)if(ua(),we=ka(),we!==I)if(ua(),dg=Pa(),dg!==I){xa=Ya;var Sg=ve,Tg=we;Ya=Na(d(),Sg,Tg)}else P=Ya,Ya=I;else P=Ya,Ya=I;else P=Ya,Ya=I;else P=Ya,Ya=I;else P=Ya,Ya=I;if(Ya!==I){xa=id;var Ug=Ya;id={type:"function",location:d(),name:"cast",
args:Ug}}else P=id,id=I}else P=id,id=I;Qa=id;if(Qa===I){var gc;var lf=gc=P;ta++;var mf=ea();ta--;mf===I?lf=void 0:(P=lf,lf=I);if(lf!==I){var Gb=P;var xe=K();xe!==I&&(xa=Gb);Gb=xe;if(Gb===I)if(Gb=P,96===a.charCodeAt(P)?(xe=Qb,P++):(xe=I,0===ta&&p(Gc)),xe!==I){var nf=[];var Xb=a.charAt(P);ge.test(Xb)?P++:(Xb=I,0===ta&&p(Kb));if(Xb!==I)for(;Xb!==I;)nf.push(Xb),Xb=a.charAt(P),ge.test(Xb)?P++:(Xb=I,0===ta&&p(Kb));else nf=I;nf!==I?(96===a.charCodeAt(P)?(Xb=Qb,P++):(Xb=I,0===ta&&p(Gc)),Xb!==I?(xa=Gb,Gb=
nf.join("")):(P=Gb,Gb=I)):(P=Gb,Gb=I)}else P=Gb,Gb=I;mf=Gb;if(mf!==I){ua();var lg=w();if(lg!==I){xa=gc;var Vg=mf;gc={type:"function",location:d(),name:Vg,args:lg}}else P=gc,gc=I}else P=gc,gc=I}else P=gc,gc=I;Qa=gc;if(Qa===I){var gb=P;var eg=Ma();if(eg!==I){ua();var ye=r();if(ye!==I){ua();var ze=[];var bb=P;var Ob=sa();if(Ob!==I){var Ae=ua();bb=Ob}else P=bb,bb=I;for(;bb!==I;)ze.push(bb),bb=P,Ob=sa(),Ob!==I?(Ae=ua(),bb=Ob):(P=bb,bb=I);bb=Ua();if(bb!==I){xa=gb;var Wg=ye,Xg=ze;gb={type:"case-expression",
location:d(),format:"simple",operand:Wg,clauses:Xg,else:null,elseLocation:null}}else P=gb,gb=I}else P=gb,gb=I}else P=gb,gb=I;if(gb===I)if(gb=P,eg=Ma(),eg!==I)if(ua(),ye=r(),ye!==I){ua();ze=[];bb=P;Ob=sa();Ob!==I?(Ae=ua(),bb=Ob):(P=bb,bb=I);for(;bb!==I;)ze.push(bb),bb=P,Ob=sa(),Ob!==I?(Ae=ua(),bb=Ob):(P=bb,bb=I);bb=ya();if(bb!==I)if(Ob=ua(),Ae=Ua(),Ae!==I){xa=gb;var Yg=ye,Zg=ze,mg=bb;gb={type:"case-expression",location:d(),format:"simple",operand:Yg,clauses:Zg,else:mg.value,elseLocation:mg.location}}else P=
gb,gb=I;else P=gb,gb=I}else P=gb,gb=I;else P=gb,gb=I;var fg=gb;if(fg===I){var nb=P;var gg=Ma();if(gg!==I){ua();var Be=[];var cb=P;var Pb=qa();if(Pb!==I){var Ce=ua();cb=Pb}else P=cb,cb=I;for(;cb!==I;)Be.push(cb),cb=P,Pb=qa(),Pb!==I?(Ce=ua(),cb=Pb):(P=cb,cb=I);cb=Ua();if(cb!==I){xa=nb;var $g=Be;nb={type:"case-expression",location:d(),format:"searched",clauses:$g,else:null,elseLocation:null}}else P=nb,nb=I}else P=nb,nb=I;if(nb===I)if(nb=P,gg=Ma(),gg!==I){ua();Be=[];cb=P;Pb=qa();Pb!==I?(Ce=ua(),cb=Pb):
(P=cb,cb=I);for(;cb!==I;)Be.push(cb),cb=P,Pb=qa(),Pb!==I?(Ce=ua(),cb=Pb):(P=cb,cb=I);cb=ya();if(cb!==I)if(Pb=ua(),Ce=Ua(),Ce!==I){xa=nb;var ah=Be,ng=cb;nb={type:"case-expression",location:d(),format:"searched",clauses:ah,else:ng.value,elseLocation:ng.location}}else P=nb,nb=I;else P=nb,nb=I}else P=nb,nb=I;fg=nb}Qa=fg;if(Qa===I){var ld=P;var bh=P;var of;var De=P;var og=C();if(og!==I){var pg=[];for(of=G();of!==I;)pg.push(of),of=G();xa=De;De=og+pg.join("")}else P=De,De=I;var qg=De;qg!==I&&(xa=bh);var vc=
qg;if(vc!==I){xa=ld;var Ee=vc;vc=/^CURRENT_DATE$/i.test(Ee)?{type:"current-time",location:d(),mode:"date"}:/^CURRENT_TIMESTAMP$/i.test(Ee)?{type:"current-time",location:d(),mode:"timestamp"}:/^CURRENT_TIME$/i.test(Ee)?{type:"current-time",location:d(),mode:"time"}:/^CURRENT_USER$/i.test(Ee)?{type:"current-user",location:d()}:{type:"column-reference",location:d(),table:"",column:Ee}}ld=vc;if(ld===I){ld=P;var md=P;if(Y()!==I){var pf;var ch=P;var hg=[];for(pf=N();pf!==I;)hg.push(pf),pf=N();xa=ch;var dh=
hg=hg.join("");var eh=Y();eh!==I?(xa=md,md=dh):(P=md,md=I)}else P=md,md=I;vc=md;if(vc!==I){xa=ld;var fh=vc;vc={type:"column-reference",location:d(),table:"",column:fh,delimited:!0}}ld=vc}Qa=ld;if(Qa===I&&(Qa=ca(),Qa===I)){Qa=P;var gh=Oa();if(gh!==I){ua();var ig=r();if(ig!==I){ua();var hh=Pa();hh!==I?(xa=Qa,ig.paren=!0,Qa=ig):(P=Qa,Qa=I)}else P=Qa,Qa=I}else P=Qa,Qa=I}}}}}}}}}return Qa}function K(){var U;var V=P;var fa=C();if(fa!==I){var ma=[];for(U=D();U!==I;)ma.push(U),U=D();xa=V;V=fa+ma.join("")}else P=
V,V=I;return V}function C(){var U=a.charAt(P);Me.test(U)?P++:(U=I,0===ta&&p(Qe));return U}function D(){var U=a.charAt(P);yf.test(U)?P++:(U=I,0===ta&&p(Re));return U}function G(){var U=a.charAt(P);Ne.test(U)?P++:(U=I,0===ta&&p(he));return U}function N(){var U=a.charAt(P);Ne.test(U)?P++:(U=I,0===ta&&p(he));if(U===I)if(U=P,Y()!==I){var V=Y();V!==I?(xa=U,U='"'):(P=U,U=I)}else P=U,U=I;return U}function Y(){var U=a.charAt(P);Pc.test(U)?P++:(U=I,0===ta&&p(Df));return U}function ca(){var U;var V=U=P;if(64===
a.charCodeAt(P)){var fa=ic;P++}else fa=I,0===ta&&p(Se);if(fa!==I){var ma=K();ma!==I?V=fa=[fa,ma]:(P=V,V=I)}else P=V,V=I;V!==I&&(xa=U,U=V,V={type:"parameter",location:d(),value:U[1]});return V}function ka(){var U=P;var V=P;var fa=a.substr(P,7);fa.toLowerCase()===qd?P+=7:(fa=I,0===ta&&p(Uc));if(fa!==I){fa=P;ta++;var ma=D();ta--;ma===I?fa=void 0:(P=fa,fa=I);fa!==I?(xa=V,V="INTEGER"):(P=V,V=I)}else P=V,V=I;V===I&&(V=P,fa=a.substr(P,3),fa.toLowerCase()===Oc?P+=3:(fa=I,0===ta&&p(qc)),fa!==I?(fa=P,ta++,
ma=D(),ta--,ma===I?fa=void 0:(P=fa,fa=I),fa!==I?(xa=V,V="INT"):(P=V,V=I)):(P=V,V=I));V!==I&&(xa=U,V={type:"data-type",location:d(),value:{type:"integer"}});U=V;U===I&&(V=U=P,fa=a.substr(P,8),fa.toLowerCase()===$d?P+=8:(fa=I,0===ta&&p(le)),fa!==I?(fa=P,ta++,ma=D(),ta--,ma===I?fa=void 0:(P=fa,fa=I),fa!==I?(xa=V,V="SMALLINT"):(P=V,V=I)):(P=V,V=I),V!==I&&(xa=U,V={type:"data-type",location:d(),value:{type:"smallint"}}),U=V,U===I&&(V=U=P,fa=a.substr(P,5),fa.toLowerCase()===uf?P+=5:(fa=I,0===ta&&p(Xe)),
fa!==I?(fa=P,ta++,ma=D(),ta--,ma===I?fa=void 0:(P=fa,fa=I),fa!==I?(xa=V,V="FLOAT"):(P=V,V=I)):(P=V,V=I),V!==I&&(xa=U,V={type:"data-type",location:d(),value:{type:"float"}}),U=V,U===I&&(V=U=P,fa=a.substr(P,4),fa.toLowerCase()===rd?P+=4:(fa=I,0===ta&&p(Hf)),fa!==I?(fa=P,ta++,ma=D(),ta--,ma===I?fa=void 0:(P=fa,fa=I),fa!==I?(xa=V,V="REAL"):(P=V,V=I)):(P=V,V=I),V!==I&&(xa=U,V={type:"data-type",location:d(),value:{type:"real"}}),U=V,U===I&&(U=P,V=ra(),V!==I&&(xa=U,V={type:"data-type",location:d(),value:{type:"date"}}),
U=V,U===I&&(U=P,V=na(),V!==I&&(xa=U,V={type:"data-type",location:d(),value:{type:"timestamp"}}),U=V,U===I&&(U=P,V=Aa(),V!==I&&(xa=U,V={type:"data-type",location:d(),value:{type:"time"}}),U=V,U===I&&(V=U=P,fa=a.substr(P,7),fa.toLowerCase()===mc?P+=7:(fa=I,0===ta&&p(If)),fa!==I?(fa=P,ta++,ma=D(),ta--,ma===I?fa=void 0:(P=fa,fa=I),fa!==I?(xa=V,V="VARCHAR"):(P=V,V=I)):(P=V,V=I),V!==I?(ua(),V=Oa(),V!==I?(ua(),V=L(),V!==I?(ua(),fa=Pa(),fa!==I?(xa=U,U={type:"data-type",location:d(),value:{type:"varchar",
size:parseInt(V)}}):(P=U,U=I)):(P=U,U=I)):(P=U,U=I)):(P=U,U=I))))))));return U}function Q(){var U=P;var V=P;var fa=a.substr(P,7);fa.toLowerCase()===Le?P+=7:(fa=I,0===ta&&p(We));if(fa!==I){fa=P;ta++;var ma=D();ta--;ma===I?fa=void 0:(P=fa,fa=I);fa!==I?(xa=V,V="LEADING"):(P=V,V=I)}else P=V,V=I;V===I&&(V=P,fa=a.substr(P,8),fa.toLowerCase()===Nc?P+=8:(fa=I,0===ta&&p(Ff)),fa!==I?(fa=P,ta++,ma=D(),ta--,ma===I?fa=void 0:(P=fa,fa=I),fa!==I?(xa=V,V="TRAILING"):(P=V,V=I)):(P=V,V=I),V===I&&(V=P,fa=a.substr(P,
4),fa.toLowerCase()===tf?P+=4:(fa=I,0===ta&&p(Gf)),fa!==I?(fa=P,ta++,ma=D(),ta--,ma===I?fa=void 0:(P=fa,fa=I),fa!==I?(xa=V,V="BOTH"):(P=V,V=I)):(P=V,V=I)));V===I&&(V=null);xa=U;U=V;return V={type:"string",location:d(),value:null==U?"BOTH":U}}function R(){var U=P;var V=Ba();if(V===I&&(V=Ha(),V===I&&(V=Ea(),V===I&&(V=Ia(),V===I&&(V=Ja(),V===I&&(V=Fa(),V===I)))))){V=P;var fa=a.substr(P,13);fa.toLowerCase()===vf?P+=13:(fa=I,0===ta&&p(Ye));if(fa!==I){fa=P;ta++;var ma=D();ta--;ma===I?fa=void 0:(P=fa,fa=
I);fa!==I?(xa=V,V="TIMEZONE_HOUR"):(P=V,V=I)}else P=V,V=I;V===I&&(V=P,fa=a.substr(P,15),fa.toLowerCase()===zb?P+=15:(fa=I,0===ta&&p(ne)),fa!==I?(fa=P,ta++,ma=D(),ta--,ma===I?fa=void 0:(P=fa,fa=I),fa!==I?(xa=V,V="TIMEZONE_MINUTE"):(P=V,V=I)):(P=V,V=I))}V!==I&&(xa=U,U=V,V={type:"string",location:d(),value:U});return V}function Z(){var U=P;var V=P;var fa=da();if(fa!==I){ua();var ma=Oa();if(ma!==I)if(ua(),ma=W(),ma!==I){ua();var Ca=Pa();Ca!==I?(xa=V,V=fa,V={type:"interval-period",location:d(),period:V.value,
precision:ma,secondary:null}):(P=V,V=I)}else P=V,V=I;else P=V,V=I}else P=V,V=I;V===I&&(V=P,fa=da(),fa!==I&&(xa=V,V=fa,fa={type:"interval-period",location:d(),period:V.value,precision:null,secondary:null}),V=fa);if(V!==I)if(ua(),fa=P,ma=a.substr(P,2),ma.toLowerCase()===sd?P+=2:(ma=I,0===ta&&p(Kd)),ma!==I?(ma=P,ta++,Ca=D(),ta--,Ca===I?ma=void 0:(P=ma,ma=I),ma!==I?(xa=fa,fa="TO"):(P=fa,fa=I)):(P=fa,fa=I),fa!==I){ua();fa=P;ma=da();ma!==I&&(xa=fa,fa=ma,ma={type:"interval-period",location:d(),period:fa.value,
precision:null,secondary:null});fa=ma;if(fa===I){fa=P;ma=Fa();if(ma!==I)if(ua(),ma=Oa(),ma!==I)if(ua(),ma=W(),ma!==I)if(ua(),Ca=Za(),Ca!==I)if(ua(),Ca=ja(),Ca!==I){ua();var Da=Pa();Da!==I?(xa=fa,fa=ma,fa={type:"interval-period",location:d(),period:"second",precision:fa,secondary:Ca}):(P=fa,fa=I)}else P=fa,fa=I;else P=fa,fa=I;else P=fa,fa=I;else P=fa,fa=I;else P=fa,fa=I;fa===I&&(fa=P,ma=Fa(),ma!==I?(ua(),ma=Oa(),ma!==I?(ua(),ma=W(),ma!==I?(ua(),Ca=Pa(),Ca!==I?(xa=fa,fa=ma,fa={type:"interval-period",
location:d(),period:"second",precision:fa,secondary:null}):(P=fa,fa=I)):(P=fa,fa=I)):(P=fa,fa=I)):(P=fa,fa=I),fa===I&&(fa=P,ma=Fa(),ma!==I&&(xa=fa,ma={type:"interval-period",location:d(),period:"second",precision:null,secondary:null}),fa=ma))}fa!==I?(xa=U,U={type:"interval-qualifier",location:d(),start:V,end:fa}):(P=U,U=I)}else P=U,U=I;else P=U,U=I;U===I&&(U=P,fa=da(),fa!==I?(ua(),V=Oa(),V!==I?(ua(),V=ja(),V!==I?(ua(),ma=Pa(),ma!==I?(xa=U,U=fa,U={type:"interval-period",location:d(),period:U.value,
precision:V,secondary:null}):(P=U,U=I)):(P=U,U=I)):(P=U,U=I)):(P=U,U=I),U===I&&(U=P,fa=da(),fa!==I&&(xa=U,U=fa,fa={type:"interval-period",location:d(),period:U.value,precision:null,secondary:null}),U=fa,U===I&&(U=P,fa=Fa(),fa!==I?(ua(),V=Oa(),V!==I?(ua(),V=W(),V!==I?(ua(),ma=Za(),ma!==I?(ua(),fa=ja(),fa!==I?(ua(),ma=Pa(),ma!==I?(xa=U,U=V,U={type:"interval-period",location:d(),period:"second",precision:U,secondary:fa}):(P=U,U=I)):(P=U,U=I)):(P=U,U=I)):(P=U,U=I)):(P=U,U=I)):(P=U,U=I),U===I&&(U=P,fa=
Fa(),fa!==I?(ua(),V=Oa(),V!==I?(ua(),V=ja(),V!==I?(ua(),ma=Pa(),ma!==I?(xa=U,U=V,U={type:"interval-period",location:d(),period:"second",precision:U,secondary:null}):(P=U,U=I)):(P=U,U=I)):(P=U,U=I)):(P=U,U=I),U===I&&(U=P,fa=Fa(),fa!==I&&(xa=U,fa={type:"interval-period",location:d(),period:"second",precision:null,secondary:null}),U=fa)))));return U}function da(){var U=P;var V=Ea();V!==I&&(xa=U,V={type:"string",location:d(),value:"day"});U=V;U===I&&(U=P,V=Ia(),V!==I&&(xa=U,V={type:"string",location:d(),
value:"hour"}),U=V,U===I&&(U=P,V=Ja(),V!==I&&(xa=U,V={type:"string",location:d(),value:"minute"}),U=V,U===I&&(U=P,V=Ha(),V!==I&&(xa=U,V={type:"string",location:d(),value:"month"}),U=V,U===I&&(U=P,V=Ba(),V!==I&&(xa=U,V={type:"string",location:d(),value:"year"}),U=V))));return U}function ja(){var U=P;var V=L();V!==I&&(xa=U,V=parseFloat(V));return V}function W(){var U=P;var V=L();V!==I&&(xa=U,V=parseFloat(V));return V}function aa(){var U=ia();U===I&&(U=ca());return U}function ia(){var U=P;if(39===a.charCodeAt(P)){var V=
jc;P++}else V=I,0===ta&&p(Te);V===I&&(a.substr(P,2)===Kc?(V=Kc,P+=2):(V=I,0===ta&&p(Ue)));if(V!==I){V=[];var fa=P;if(a.substr(P,2)===lb){var ma=lb;P+=2}else ma=I,0===ta&&p(Ac);ma!==I&&(xa=fa,ma="'");fa=ma;fa===I&&(fa=a.charAt(P),Sb.test(fa)?P++:(fa=I,0===ta&&p(ie)));for(;fa!==I;)V.push(fa),fa=P,a.substr(P,2)===lb?(ma=lb,P+=2):(ma=I,0===ta&&p(Ac)),ma!==I&&(xa=fa,ma="'"),fa=ma,fa===I&&(fa=a.charAt(P),Sb.test(fa)?P++:(fa=I,0===ta&&p(ie)));39===a.charCodeAt(P)?(fa=jc,P++):(fa=I,0===ta&&p(Te));fa!==I?
(xa=U,U={type:"string",location:d(),value:V.join("")}):(P=U,U=I)}else P=U,U=I;return U}function qa(){var U=P;if(hb()!==I){ua();var V=r();if(V!==I){ua();var fa=ib();fa!==I?(ua(),fa=r(),fa!==I?(xa=U,U={type:"when-clause",location:d(),operand:V,value:fa}):(P=U,U=I)):(P=U,U=I)}else P=U,U=I}else P=U,U=I;return U}function sa(){var U=P;if(hb()!==I){ua();var V=r();if(V!==I){ua();var fa=ib();fa!==I?(ua(),fa=r(),fa!==I?(xa=U,U={type:"when-clause",location:d(),operand:V,value:fa}):(P=U,U=I)):(P=U,U=I)}else P=
U,U=I}else P=U,U=I;return U}function ya(){var U=P;var V=P;var fa=a.substr(P,4);fa.toLowerCase()===xf?P+=4:(fa=I,0===ta&&p(Xc));if(fa!==I){fa=P;ta++;var ma=D();ta--;ma===I?fa=void 0:(P=fa,fa=I);fa!==I?(xa=V,V="ELSE"):(P=V,V=I)}else P=V,V=I;V!==I?(ua(),V=r(),V!==I?(xa=U,U={type:"else-clause",location:d(),value:V}):(P=U,U=I)):(P=U,U=I);return U}function va(){var U=L();if(U===I){U=P;var V=a.charAt(P);Rb.test(V)?P++:(V=I,0===ta&&p(ac));if(V!==I){var fa=L();fa!==I?(xa=U,U=V[0]+fa):(P=U,U=I)}else P=U,U=
I}return U}function wa(){var U=P;if(46===a.charCodeAt(P)){var V=wc;P++}else V=I,0===ta&&p(Bc);V!==I?(V=L(),V===I&&(V=null),xa=U,U="."+(null!=V?V:"")):(P=U,U=I);return U}function M(){var U;var V=U=P;var fa=a.charAt(P);Tb.test(fa)?P++:(fa=I,0===ta&&p(Ad));fa!==I?(fa=a.charAt(P),Rb.test(fa)?P++:(fa=I,0===ta&&p(ac)),fa===I&&(fa=null),xa=V,V="e"+(null===fa?"":fa)):(P=V,V=I);V!==I?(fa=L(),fa!==I?(xa=U,U=V+fa):(P=U,U=I)):(P=U,U=I);return U}function L(){var U=P;var V=[];var fa=T();if(fa!==I)for(;fa!==I;)V.push(fa),
fa=T();else V=I;V!==I&&(xa=U,V=V.join(""));return V}function T(){var U=a.charAt(P);pc.test(U)?P++:(U=I,0===ta&&p(Bb));return U}function ha(){var U=P;var V=a.substr(P,2);V.toLowerCase()===Wd?P+=2:(V=I,0===ta&&p(Dd));if(V!==I){V=P;ta++;var fa=D();ta--;fa===I?V=void 0:(P=V,V=I);V!==I?(xa=U,U="IN"):(P=U,U=I)}else P=U,U=I;return U}function oa(){var U=P;var V=a.substr(P,2);V.toLowerCase()===Ge?P+=2:(V=I,0===ta&&p(Ed));if(V!==I){V=P;ta++;var fa=D();ta--;fa===I?V=void 0:(P=V,V=I);V!==I?(xa=U,U="IS"):(P=U,
U=I)}else P=U,U=I;return U}function S(){var U=P;var V=a.substr(P,4);V.toLowerCase()===He?P+=4:(V=I,0===ta&&p(Qc));if(V!==I){V=P;ta++;var fa=D();ta--;fa===I?V=void 0:(P=V,V=I);V!==I?(xa=U,U="LIKE"):(P=U,U=I)}else P=U,U=I;return U}function X(){var U=P;var V=a.substr(P,3);V.toLowerCase()===sf?P+=3:(V=I,0===ta&&p(Cb));if(V!==I){V=P;ta++;var fa=D();ta--;fa===I?V=void 0:(P=V,V=I);V!==I?(xa=U,U="NOT"):(P=U,U=I)}else P=U,U=I;return U}function ba(){var U=P;var V=a.substr(P,3);V.toLowerCase()===Ie?P+=3:(V=
I,0===ta&&p(Fd));if(V!==I){V=P;ta++;var fa=D();ta--;fa===I?V=void 0:(P=V,V=I);V!==I?(xa=U,U="AND"):(P=U,U=I)}else P=U,U=I;return U}function la(){var U=P;var V=a.substr(P,2);V.toLowerCase()===kc?P+=2:(V=I,0===ta&&p(Gd));if(V!==I){V=P;ta++;var fa=D();ta--;fa===I?V=void 0:(P=V,V=I);V!==I?(xa=U,U="OR"):(P=U,U=I)}else P=U,U=I;return U}function pa(){var U=P;var V=a.substr(P,7);V.toLowerCase()===Xd?P+=7:(V=I,0===ta&&p(Dc));if(V!==I){V=P;ta++;var fa=D();ta--;fa===I?V=void 0:(P=V,V=I);V!==I?(xa=U,U="BETWEEN"):
(P=U,U=I)}else P=U,U=I;return U}function O(){var U=P;var V=a.substr(P,4);V.toLowerCase()===lc?P+=4:(V=I,0===ta&&p(Rc));if(V!==I){V=P;ta++;var fa=D();ta--;fa===I?V=void 0:(P=V,V=I);V!==I?(xa=U,U="FROM"):(P=U,U=I)}else P=U,U=I;return U}function ea(){var U=P;var V=a.substr(P,7);V.toLowerCase()===xc?P+=7:(V=I,0===ta&&p(Ef));if(V!==I){V=P;ta++;var fa=D();ta--;fa===I?V=void 0:(P=V,V=I);V!==I?(xa=U,U="EXTRACT"):(P=U,U=I)}else P=U,U=I;return U}function na(){var U=P;var V=a.substr(P,9);V.toLowerCase()===Lc?
P+=9:(V=I,0===ta&&p(Ec));if(V!==I){V=P;ta++;var fa=D();ta--;fa===I?V=void 0:(P=V,V=I);V!==I?(xa=U,U="TIMESTAMP"):(P=U,U=I)}else P=U,U=I;return U}function ra(){var U=P;var V=a.substr(P,4);V.toLowerCase()===Yd?P+=4:(V=I,0===ta&&p(je));if(V!==I){V=P;ta++;var fa=D();ta--;fa===I?V=void 0:(P=V,V=I);V!==I?(xa=U,U="DATE"):(P=U,U=I)}else P=U,U=I;return U}function Aa(){var U=P;var V=a.substr(P,4);V.toLowerCase()===Mc?P+=4:(V=I,0===ta&&p(Jd));if(V!==I){V=P;ta++;var fa=D();ta--;fa===I?V=void 0:(P=V,V=I);V!==
I?(xa=U,U="TIME"):(P=U,U=I)}else P=U,U=I;return U}function za(){var U=P;var V=a.substr(P,8);V.toLowerCase()===ae?P+=8:(V=I,0===ta&&p(me));if(V!==I){V=P;ta++;var fa=D();ta--;fa===I?V=void 0:(P=V,V=I);V!==I?(xa=U,U="INTERVAL"):(P=U,U=I)}else P=U,U=I;return U}function Ba(){var U=P;var V=a.substr(P,4);V.toLowerCase()===zc?P+=4:(V=I,0===ta&&p(Jf));if(V!==I){V=P;ta++;var fa=D();ta--;fa===I?V=void 0:(P=V,V=I);V!==I?(xa=U,U="YEAR"):(P=U,U=I)}else P=U,U=I;return U}function Ha(){var U=P;var V=a.substr(P,5);
V.toLowerCase()===Zb?P+=5:(V=I,0===ta&&p(Ze));if(V!==I){V=P;ta++;var fa=D();ta--;fa===I?V=void 0:(P=V,V=I);V!==I?(xa=U,U="MONTH"):(P=U,U=I)}else P=U,U=I;return U}function Ea(){var U=P;var V=a.substr(P,3);V.toLowerCase()===be?P+=3:(V=I,0===ta&&p(Fc));if(V!==I){V=P;ta++;var fa=D();ta--;fa===I?V=void 0:(P=V,V=I);V!==I?(xa=U,U="DAY"):(P=U,U=I)}else P=U,U=I;return U}function Ia(){var U=P;var V=a.substr(P,4);V.toLowerCase()===ce?P+=4:(V=I,0===ta&&p(Db));if(V!==I){V=P;ta++;var fa=D();ta--;fa===I?V=void 0:
(P=V,V=I);V!==I?(xa=U,U="HOUR"):(P=U,U=I)}else P=U,U=I;return U}function Ja(){var U=P;var V=a.substr(P,6);V.toLowerCase()===td?P+=6:(V=I,0===ta&&p(Vc));if(V!==I){V=P;ta++;var fa=D();ta--;fa===I?V=void 0:(P=V,V=I);V!==I?(xa=U,U="MINUTE"):(P=U,U=I)}else P=U,U=I;return U}function Fa(){var U=P;var V=a.substr(P,6);V.toLowerCase()===wf?P+=6:(V=I,0===ta&&p(Jb));if(V!==I){V=P;ta++;var fa=D();ta--;fa===I?V=void 0:(P=V,V=I);V!==I?(xa=U,U="SECOND"):(P=U,U=I)}else P=U,U=I;return U}function Ma(){var U=P;var V=
a.substr(P,4);V.toLowerCase()===nc?P+=4:(V=I,0===ta&&p(Wc));if(V!==I){V=P;ta++;var fa=D();ta--;fa===I?V=void 0:(P=V,V=I);V!==I?(xa=U,U="CASE"):(P=U,U=I)}else P=U,U=I;return U}function Ua(){var U=P;var V=a.substr(P,3);V.toLowerCase()===ud?P+=3:(V=I,0===ta&&p(cc));if(V!==I){V=P;ta++;var fa=D();ta--;fa===I?V=void 0:(P=V,V=I);V!==I?(xa=U,U="END"):(P=U,U=I)}else P=U,U=I;return U}function hb(){var U=P;var V=a.substr(P,4);V.toLowerCase()===de?P+=4:(V=I,0===ta&&p(Ub));if(V!==I){V=P;ta++;var fa=D();ta--;fa===
I?V=void 0:(P=V,V=I);V!==I?(xa=U,U="WHEN"):(P=U,U=I)}else P=U,U=I;return U}function ib(){var U=P;var V=a.substr(P,4);V.toLowerCase()===vd?P+=4:(V=I,0===ta&&p(dc));if(V!==I){V=P;ta++;var fa=D();ta--;fa===I?V=void 0:(P=V,V=I);V!==I?(xa=U,U="THEN"):(P=U,U=I)}else P=U,U=I;return U}function Za(){if(44===a.charCodeAt(P)){var U=oc;P++}else U=I,0===ta&&p($e);return U}function Oa(){if(40===a.charCodeAt(P)){var U=wd;P++}else U=I,0===ta&&p(Kf);return U}function Pa(){if(41===a.charCodeAt(P)){var U=ee;P++}else U=
I,0===ta&&p(oe);return U}function ua(){var U;var V=[];for(U=ob();U!==I;)V.push(U),U=ob();return V}function ob(){var U=a.charAt(P);Oe.test(U)?P++:(U=I,0===ta&&p(pe));return U}function Hb(U,V,fa,ma,Ca){U={type:"binary-expression",location:Ca,operator:U,left:V,right:fa};void 0!==ma&&(U.escape=ma);return U}function Na(U,...V){return{type:"expression-list",location:U,value:V}}function Yb(U,V){for(const {op:fa,expr:ma,location:{end:Ca}}of V)U=Hb(fa,U,ma,void 0,{...U.location,end:Ca});return U}f=void 0!==
f?f:{};var I={},nd=f.grammarSource,od={start:t},Od=t,Pd="!",Qd="\x3d",Rd="\x3e\x3d",Sd="\x3e",hc="\x3c\x3d",Td="\x3c\x3e",mb="!\x3d",yb="||",ic="@",jc="'",Kc="N'",lb="''",wc=".",Fe="null",qf="true",Vd="false",Wd="in",Ge="is",He="like",rf="escape",sf="not",Ie="and",kc="or",Xd="between",lc="from",Ib="for",Je="substring",xc="extract",Ke="trim",yc="position",Lc="timestamp",Yd="date",Mc="time",Le="leading",Nc="trailing",tf="both",Zd="cast",pd="as",qd="integer",Oc="int",$d="smallint",uf="float",rd="real",
mc="varchar",sd="to",ae="interval",zc="year",vf="timezone_hour",zb="timezone_minute",Zb="month",be="day",ce="hour",td="minute",wf="second",nc="case",ud="end",de="when",vd="then",xf="else",oc=",",wd="(",ee=")",Qb="`",fe=/^[<-=]/,Rb=/^[+\-]/,xd=/^[*\/]/,Me=/^[A-Za-z_\x80-\uFFFF]/,yf=/^[A-Za-z0-9_]/,Ne=/^[A-Za-z0-9_.\x80-\uFFFF]/,Pc=/^["]/,Sb=/^[^']/,pc=/^[0-9]/,Tb=/^[eE]/,Oe=/^[ \t\n\r]/,ge=/^[^`]/,zf=e("!",!1),Af=e("\x3d",!1),yd=e("\x3e\x3d",!1),$b=e("\x3e",!1),rb=e("\x3c\x3d",!1),Ab=e("\x3c\x3e",
!1),zd=h([["\x3c","\x3d"]],!1,!1),Pe=e("!\x3d",!1),ac=h(["+","-"],!1,!1),Bf=e("||",!1),Cf=h(["*","/"],!1,!1),Qe=h([["A","Z"],["a","z"],"_",["\u0080","\uffff"]],!1,!1),Re=h([["A","Z"],["a","z"],["0","9"],"_"],!1,!1),he=h([["A","Z"],["a","z"],["0","9"],"_",".",["\u0080","\uffff"]],!1,!1),Df=h(['"'],!1,!1),Se=e("@",!1),Te=e("'",!1),Ue=e("N'",!1),Ac=e("''",!1),ie=h(["'"],!0,!1),Bc=e(".",!1),Bb=h([["0","9"]],!1,!1),Ad=h(["e","E"],!1,!1),Bd=e("NULL",!0),Cc=e("TRUE",!0),Cd=e("FALSE",!0),Dd=e("IN",!0),Ed=
e("IS",!0),Qc=e("LIKE",!0),Ve=e("ESCAPE",!0),Cb=e("NOT",!0),Fd=e("AND",!0),Gd=e("OR",!0),Dc=e("BETWEEN",!0),Rc=e("FROM",!0),Hd=e("FOR",!0),Sc=e("SUBSTRING",!0),Ef=e("EXTRACT",!0),Tc=e("TRIM",!0),Id=e("POSITION",!0),Ec=e("TIMESTAMP",!0),je=e("DATE",!0),Jd=e("TIME",!0),We=e("LEADING",!0),Ff=e("TRAILING",!0),Gf=e("BOTH",!0),ke=e("CAST",!0),bc=e("AS",!0),Uc=e("INTEGER",!0),qc=e("INT",!0),le=e("SMALLINT",!0),Xe=e("FLOAT",!0),Hf=e("REAL",!0),If=e("VARCHAR",!0),Kd=e("TO",!0),me=e("INTERVAL",!0),Jf=e("YEAR",
!0),Ye=e("TIMEZONE_HOUR",!0),ne=e("TIMEZONE_MINUTE",!0),Ze=e("MONTH",!0),Fc=e("DAY",!0),Db=e("HOUR",!0),Vc=e("MINUTE",!0),Jb=e("SECOND",!0),Wc=e("CASE",!0),cc=e("END",!0),Ub=e("WHEN",!0),dc=e("THEN",!0),Xc=e("ELSE",!0),$e=e(",",!1),Kf=e("(",!1),oe=e(")",!1),pe=h([" ","\t","\n","\r"],!1,!1),Gc=e("`",!1),Kb=h(["`"],!0,!1),P=f.peg$currPos|0,xa=P,rc=[{line:1,column:1}],Va=P,sc=f.peg$maxFailExpected||[],ta=f.peg$silentFails|0;if(f.startRule){if(!(f.startRule in od))throw Error("Can't start parsing from rule \""+
f.startRule+'".');Od=od[f.startRule]}var vb=Od();if(f.peg$library)return{peg$result:vb,peg$currPos:P,peg$FAILED:I,peg$maxFailExpected:sc,peg$maxFailPos:Va};if(vb!==I&&P===a.length)return vb;vb!==I&&P<a.length&&p({type:"end"});throw function(U,V,fa){return new q(q.buildMessage(U,V),U,V,fa)}(sc,Va<a.length?a.charAt(Va):null,Va<a.length?m(Va,Va+1):m(Va,Va));}function k(a,f){if(null!=a)switch(f(a),a.type){case "when-clause":k(a.operand,f);k(a.value,f);break;case "case-expression":for(const d of a.clauses)k(d,
f);"simple"===a.format&&k(a.operand,f);null!==a.else&&k(a.else,f);break;case "expression-list":for(const d of a.value)k(d,f);break;case "unary-expression":k(a.expr,f);break;case "binary-expression":k(a.left,f);k(a.right,f);break;case "function":k(a.args,f);break;case "interval":k(a.value,f);k(a.qualifier,f);break;case "interval-qualifier":k(a.start,f),k(a.end,f)}}(function(a,f){function d(){this.constructor=a}d.prototype=f.prototype;a.prototype=new d})(q,Error);q.prototype.format=function(a){var f=
"Error: "+this.message;if(this.location){var d=null,c;for(c=0;c<a.length;c++)if(a[c].source===this.location.source){d=a[c].text.split(/\r\n|\n|\r/g);break}a=this.location.start;c=this.location.source&&"function"===typeof this.location.source.offset?this.location.source.offset(a):a;var e=this.location.source+":"+c.line+":"+c.column;if(d){var h=this.location.end,x=n("",c.line.toString().length," ");d=d[a.line-1];h=(a.line===h.line?h.column:d.length+1)-a.column||1;f+="\n --\x3e "+e+"\n"+x+" |\n"+c.line+
" | "+d+"\n"+x+" | "+n("",a.column-1," ")+n("",h,"^")}else f+="\n at "+e}return f};q.buildMessage=function(a,f){function d(m){return m.charCodeAt(0).toString(16).toUpperCase()}function c(m){return m.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(p){return"\\x0"+d(p)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(p){return"\\x"+d(p)})}function e(m){return m.replace(/\\/g,"\\\\").replace(/\]/g,
"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(p){return"\\x0"+d(p)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(p){return"\\x"+d(p)})}function h(m){return x[m.type](m)}var x={literal:function(m){return'"'+c(m.text)+'"'},class:function(m){var p=m.parts.map(function(t){return Array.isArray(t)?e(t[0])+"-"+e(t[1]):e(t)});return"["+(m.inverted?"^":"")+p.join("")+"]"},any:function(){return"any character"},
end:function(){return"end of input"},other:function(m){return m.description}};return"Expected "+function(m){m=m.map(h);var p,t;m.sort();if(0<m.length){for(t=p=1;p<m.length;p++)m[p-1]!==m[p]&&(m[t]=m[p],t++);m.length=t}switch(m.length){case 1:return m[0];case 2:return m[0]+" or "+m[1];default:return m.slice(0,-1).join(", ")+", or "+m[m.length-1]}}(a)+" but "+(f?'"'+c(f)+'"':"end of input")+" found."};class l{static parse(a){return g(a)}}b.WhereGrammar=l;b.visitAll=k;Object.defineProperty(b,Symbol.toStringTag,
{value:"Module"})})},"esri/layers/support/fieldType":function(){define(["exports","../../core/jsonMap"],function(b,q){q=new q.JSONMap({esriFieldTypeSmallInteger:"small-integer",esriFieldTypeInteger:"integer",esriFieldTypeSingle:"single",esriFieldTypeDouble:"double",esriFieldTypeLong:"long",esriFieldTypeString:"string",esriFieldTypeDate:"date",esriFieldTypeOID:"oid",esriFieldTypeGeometry:"geometry",esriFieldTypeBlob:"blob",esriFieldTypeRaster:"raster",esriFieldTypeGUID:"guid",esriFieldTypeGlobalID:"global-id",
esriFieldTypeXML:"xml",esriFieldTypeBigInteger:"big-integer",esriFieldTypeDateOnly:"date-only",esriFieldTypeTimeOnly:"time-only",esriFieldTypeTimestampOffset:"timestamp-offset"});b.kebabDict=q;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/geometryUtils":function(){define(["exports","../featureConversionUtils","../OptimizedGeometry"],function(b,q,n){const g=new n,k=new n,l=new n,a={esriGeometryPoint:q.convertToPoint,esriGeometryPolyline:q.convertToPolyline,
esriGeometryPolygon:q.convertToPolygon,esriGeometryMultipoint:q.convertToMultipoint},f=(d,c)=>"_geVersion"!==d?c:void 0;b.cleanFromGeometryEngine=function(d){return d&&"_geVersion"in d?JSON.parse(JSON.stringify(d,f)):d};b.getGeometry=function(d,c,e,h,x,m,p=c,t=e){const w=c&&p,r=e&&t;h=null!=h?"coords"in h?h:h.geometry:null;if(null==h)return null;if(x)return c=q.generalizeOptimizedGeometry(k,h,c,e,d,x,p,t),m&&(c=q.quantizeOptimizedGeometry(l,c,w,r,d,m)),a[d]?.(c,w,r)??null;if(m)return m=q.quantizeOptimizedGeometry(l,
h,c,e,d,m,p,t),a[d]?.(m,w,r)??null;q.removeZMValues(g,h,c,e,p,t);return a[d]?.(g,w,r)??null};b.transformCentroid=function(d,c,e,h=d.hasZ,x=d.hasM){if(null==c)return null;const m=d.hasZ&&h,p=d.hasM&&x;return e?(d=q.quantizeOptimizedGeometry(l,c,d.hasZ,d.hasM,"esriGeometryPoint",e,h,x),q.convertToPoint(d,m,p)):q.convertToPoint(c,m,p)};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/QueryEngineCache":function(){define(["exports"],function(b){class q{constructor(){this._storage=
new Map;this._purgeInterval=5;this._sweep=()=>{this._timer=void 0;if(this._storage){var k=1E3*this._purgeInterval,l=performance.now()-k;for(const [a,f]of this._storage)if(f.time<l)this._storage.delete(a);else{0<this._storage.size&&(this._timer=setTimeout(this._sweep,k));break}}}}destroy(){this._storage?.clear();this._storage=null;clearTimeout(this._timer)}get size(){return this._storage?.size??0}put(k,l){this._storage?.set(k,new g(l));this._scheduleSweep()}get(k){if(this._storage){var l=this._storage?.get(k);
if(l)return this._storage?.delete(k),l.time=performance.now(),this._storage?.set(k,l),l.items}}clear(){this._storage?.clear()}_scheduleSweep(){this._storage&&(this._timer??(this._timer=setTimeout(this._sweep,1E3*this._purgeInterval)))}}let n=0;class g{constructor(k){this.items=k;this.time=performance.now();this.id=n++}}b.QueryEngineCache=q;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/QueryEngineCapabilities":function(){define(["exports"],function(b){b.queryCapabilities=
{supportsStatistics:!0,supportsPercentileStatistics:!0,supportsSpatialAggregationStatistics:!1,supportedSpatialAggregationStatistics:{envelope:!1,centroid:!1,convexHull:!1},supportsCentroid:!0,supportsCacheHint:!0,supportsDistance:!0,supportsDistinct:!0,supportsExtent:!0,supportsGeometryProperties:!1,supportsHavingClause:!0,supportsOrderBy:!0,supportsPagination:!0,supportsQuantization:!0,supportsQuantizationEditMode:!1,supportsQueryGeometry:!0,supportsResultType:!0,supportsSqlExpression:!0,supportsMaxRecordCountFactor:!1,
supportsStandardizedQueriesOnly:!0,supportsTopFeaturesQuery:!1,supportsQueryByAnonymous:!0,supportsQueryByOthers:!0,supportsHistoricMoment:!1,supportsFormatPBF:!1,supportsDisjointSpatialRelationship:!0,supportsDefaultSpatialReference:!1,supportsFullTextSearch:!1,supportsCompactGeometry:!1,maxRecordCountFactor:void 0,maxRecordCount:void 0,standardMaxRecordCount:void 0,tileMaxRecordCount:void 0};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/QueryEngineResult":function(){define("require exports ../../../core/lang ../../../geometry/support/centroid ../../../geometry/support/extentUtils ../../../geometry/support/quantizationUtils ../../../geometry/support/spatialReferenceUtils ./AttributesBuilder ./geometryUtils ./projectionSupport ./SnappingCandidate ../../support/fieldUtils ../../../statistics/utils".split(" "),
function(b,q,n,g,k,l,a,f,d,c,e,h,x){function m(r,y,z,u){const v=u.x-z.x;u=u.y-z.y;y=Math.min(1,Math.max(0,((y.x-z.x)*v+(y.y-z.y)*u)/(v*v+u*u)));r.x=z.x+v*y;r.y=z.y+u*y}function p(r,y){return r?y?4:3:y?3:2}class t{constructor(r,y,z){this.items=r;this.query=y;this.geometryType=z.geometryType;this.hasM=z.hasM;this.hasZ=z.hasZ;this.fieldsIndex=z.fieldsIndex;this.objectIdField=z.objectIdField;this.spatialReference=z.spatialReference;this.featureAdapter=z.featureAdapter}get size(){return this.items.length}createQueryResponseForCount(){const r=
new f(this.query,this.featureAdapter,this.fieldsIndex);if(!this.query.outStatistics)return r.countDistinctValues(this.items);const {groupByFieldsForStatistics:y,having:z,outStatistics:u}=this.query;if(!y?.length)return 1;const v=new Map,A=new Map,B=new Set;for(const J of u){var {statisticType:F}=J;F="exceedslimit"!==F?J.onStatisticField:void 0;if(!A.has(F)){var H=[];for(const E of y){const K=this._getAttributeValues(r,E,v);H.push(K)}A.set(F,this._calculateUniqueValues(H,r.returnDistinctValues))}F=
A.get(F);for(const E in F){const {data:K,items:C}=F[E];H=K.join(",");z&&!r.validateItems(C,z)||B.add(H)}}return B.size}async createQueryResponse(){let r;r=this.query.outStatistics?this.query.outStatistics.some(y=>"exceedslimit"===y.statisticType)?this._createExceedsLimitQueryResponse(this.query):await this._createStatisticsQueryResponse(this.query):this._createFeatureQueryResponse(this.query);if(this.query.returnQueryGeometry){const y=this.query.geometry;a.isValid(this.query.outSR)&&!a.equals(y.spatialReference,
this.query.outSR)?r.queryGeometry=d.cleanFromGeometryEngine({spatialReference:this.query.outSR,...c.project(y,y.spatialReference,this.query.outSR)}):r.queryGeometry=d.cleanFromGeometryEngine({spatialReference:this.query.outSR,...y})}return r}createSnappingResponse(r,y){const z=this.featureAdapter,u=p(this.hasZ,this.hasM),{point:v,mode:A}=r,B="number"===typeof r.distance?r.distance:r.distance.x,F="number"===typeof r.distance?r.distance:r.distance.y,H={candidates:[]},J="esriGeometryPolygon"===this.geometryType;
y=this._getPointCreator(A,this.spatialReference,y);const E=new w(null,0),K=new w(null,0),C={x:0,y:0,z:0};for(const Q of this.items){var D=z.getGeometry(Q);if(null==D)continue;const {coords:R,lengths:Z}=D;E.coords=R;K.coords=R;if(r.returnEdge){D=0;for(var G=0;G<Z.length;G++){var N=Z[G];for(var Y=0;Y<N;Y++,D+=u){var ca=E;ca.coordsIndex=D;if(Y!==N-1){const da=K;da.coordsIndex=D+u;const ja=C;m(C,v,ca,da);var ka=(v.x-ja.x)/B;const W=(v.y-ja.y)/F;ka=ka*ka+W*W;1>=ka&&H.candidates.push(e.makeEdgeCandidate(z.getObjectId(Q),
y(ja),Math.sqrt(ka),y(ca),y(da)))}}}}if("none"!==r.vertexMode)if(D=J?R.length-u:R.length,"all"===r.vertexMode)for(G=0;G<D;G+=u)N=E,N.coordsIndex=G,Y=(v.x-N.x)/B,ca=(v.y-N.y)/F,Y=Y*Y+ca*ca,1>=Y&&H.candidates.push(e.makeVertexCandidate(z.getObjectId(Q),y(N),Math.sqrt(Y)));else if("ends"===r.vertexMode){D=[0];J||D.push(R.length-u);for(const da of D)D=E,D.coordsIndex=da,G=(v.x-D.x)/B,N=(v.y-D.y)/F,G=G*G+N*N,1>=G&&H.candidates.push(e.makeVertexCandidate(z.getObjectId(Q),y(D),Math.sqrt(G)))}}H.candidates.sort((Q,
R)=>Q.distance-R.distance);return H}_getPointCreator(r,y,z){const u=null==z||a.equals(y,z)?A=>A:A=>c.project(A,y,z),{hasZ:v}=this;return"3d"===r?v?({x:A,y:B,z:F})=>u({x:A,y:B,z:F}):({x:A,y:B})=>u({x:A,y:B,z:0}):({x:A,y:B})=>u({x:A,y:B})}async createSummaryStatisticsResponse(r){const {field:y,valueExpression:z,normalizationField:u,normalizationType:v,normalizationTotal:A,minValue:B,maxValue:F,scale:H,timeZone:J,outStatisticTypes:E}=r;var K=this.fieldsIndex.get(y);r=h.isDateField(K)||h.isDateOnlyField(K)||
h.isTimestampOffsetField(K);const C=await this._getDataValues({field:y,valueExpression:z,normalizationField:u,normalizationType:v,normalizationTotal:A,scale:H,timeZone:J}),D=x.isNullCountSupported({normalizationType:v,normalizationField:u,minValue:B,maxValue:F}),G={value:.5,fieldType:K?.type};K=h.isStringField(K)?x.calculateStringStatistics({values:C,supportsNullCount:D,percentileParams:G,outStatisticTypes:E}):x.calculateStatistics({values:C,minValue:B,maxValue:F,useSampleStdDev:!v,supportsNullCount:D,
percentileParams:G,outStatisticTypes:E});return x.processSummaryStatisticsResult(K,E,r)}async createUniqueValuesResponse(r){const {field:y,valueExpression:z,domains:u,returnAllCodedValues:v,scale:A,timeZone:B}=r;var F=await this._getDataValues({field:y,field2:r.field2,field3:r.field3,fieldDelimiter:r.fieldDelimiter,valueExpression:z,scale:A,timeZone:B},!1);F=x.calculateUniqueValuesCount(F);return x.createUVResult(F,u,v,r.fieldDelimiter)}async createClassBreaksResponse(r){const {field:y,valueExpression:z,
normalizationField:u,normalizationType:v,normalizationTotal:A,classificationMethod:B,standardDeviationInterval:F,minValue:H,maxValue:J,numClasses:E,scale:K,timeZone:C}=r;r=await this._getDataValues({field:y,valueExpression:z,normalizationField:u,normalizationType:v,normalizationTotal:A,scale:K,timeZone:C});r=x.calculateClassBreaks(r,{field:y,normalizationField:u,normalizationType:v,normalizationTotal:A,classificationMethod:B,standardDeviationInterval:F,minValue:H,maxValue:J,numClasses:E});return x.resolveCBResult(r,
B)}async createHistogramResponse(r){const {field:y,valueExpression:z,normalizationField:u,normalizationType:v,normalizationTotal:A,classificationMethod:B,standardDeviationInterval:F,minValue:H,maxValue:J,numBins:E,scale:K,timeZone:C}=r;r=await this._getDataValues({field:y,valueExpression:z,normalizationField:u,normalizationType:v,normalizationTotal:A,scale:K,timeZone:C});return x.calculateHistogram(r,{field:y,normalizationField:u,normalizationType:v,normalizationTotal:A,classificationMethod:B,standardDeviationInterval:F,
minValue:H,maxValue:J,numBins:E})}_sortFeatures(r,y,z){if(1<r.length&&y?.length)for(const u of y.reverse()){y=u.split(" ");const v=y[0],A=this.fieldsIndex.get(v);y=y[1]?"desc"===y[1].toLowerCase():!1;const B=x.getAttributeComparator(A?.type,y);r.sort((F,H)=>{F=z(F,v,A);H=z(H,v,A);return B(F,H)})}}_createFeatureQueryResponse(r){const y=this.items,{geometryType:z,hasM:u,hasZ:v,objectIdField:A,spatialReference:B}=this,{outFields:F,outSR:H,quantizationParameters:J,resultRecordCount:E,resultOffset:K,returnZ:C,
returnM:D}=r,G=null!=E?y.length>(K||0)+E:!1,N=F&&(F.includes("*")?[...this.fieldsIndex.fields]:F.map(Y=>this.fieldsIndex.get(Y)));return{exceededTransferLimit:G,features:this._createFeatures(r,y),fields:N,geometryType:z,hasM:u&&D,hasZ:v&&C,objectIdFieldName:A,spatialReference:d.cleanFromGeometryEngine(H||B),transform:J&&l.toQuantizationTransform(J)||null}}_createFeatures(r,y){const z=new f(r,this.featureAdapter,this.fieldsIndex),{hasM:u,hasZ:v}=this,{orderByFields:A,quantizationParameters:B,returnGeometry:F,
returnCentroid:H,maxAllowableOffset:J,resultOffset:E,resultRecordCount:K,returnZ:C=!1,returnM:D=!1}=r,G=v&&C,N=u&&D;r=[];var Y=0;const ca=[...y];this._sortFeatures(ca,A,(da,ja,W)=>z.getFieldValue(da,ja,W));if(this.geometryType&&(F||H)){var ka=l.toQuantizationTransform(B)??void 0;y="esriGeometryPolygon"===this.geometryType||"esriGeometryPolyline"===this.geometryType;if(F&&!H)for(var Q of ca){var R=this.featureAdapter.getGeometry(Q),Z={attributes:z.getAttributes(Q),geometry:d.getGeometry(this.geometryType,
this.hasZ,this.hasM,R,J,ka,G,N)};y&&R&&!Z.geometry&&(Z.centroid=d.transformCentroid(this,this.featureAdapter.getCentroid(Q,this),ka));r[Y++]=Z}else if(!F&&H)for(R of ca)r[Y++]={attributes:z.getAttributes(R),centroid:d.transformCentroid(this,this.featureAdapter.getCentroid(R,this),ka)};else for(Z of ca)r[Y++]={attributes:z.getAttributes(Z),centroid:d.transformCentroid(this,this.featureAdapter.getCentroid(Z,this),ka),geometry:d.getGeometry(this.geometryType,this.hasZ,this.hasM,this.featureAdapter.getGeometry(Z),
J,ka,G,N)}}else for(ka of ca)(Q=z.getAttributes(ka))&&(r[Y++]={attributes:Q});Y=E||0;null!=K&&(r=r.slice(Y,Math.min(r.length,Y+K)));return r}_createExceedsLimitQueryResponse(r){var y=!1;let z=Number.POSITIVE_INFINITY,u=Number.POSITIVE_INFINITY;y=Number.POSITIVE_INFINITY;for(const v of r.outStatistics??[])if("exceedslimit"===v.statisticType){z=null!=v.maxPointCount?v.maxPointCount:Number.POSITIVE_INFINITY;u=null!=v.maxRecordCount?v.maxRecordCount:Number.POSITIVE_INFINITY;y=null!=v.maxVertexCount?v.maxVertexCount:
Number.POSITIVE_INFINITY;break}if("esriGeometryPoint"===this.geometryType)y=this.items.length>z;else if(this.items.length>u)y=!0;else{r=p(this.hasZ,this.hasM);const v=this.featureAdapter;y=this.items.reduce((A,B)=>{B=v.getGeometry(B);return A+(null!=B&&B.coords.length||0)},0)/r>y}return{fields:[{name:"exceedslimit",type:"esriFieldTypeInteger",alias:"exceedslimit",sqlType:"sqlTypeInteger",domain:null,defaultValue:null}],features:[{attributes:{exceedslimit:Number(y)}}]}}async _createStatisticsQueryResponse(r){var y=
{attributes:{}};const z=[],u=new Map,v=new Map,A=new Map,B=new Map,F=new f(r,this.featureAdapter,this.fieldsIndex);var H=r.outStatistics;const {groupByFieldsForStatistics:J,having:E,orderByFields:K,resultRecordCount:C}=r;r=J?.length;const D=!!r,G=D?J[0]:null,N=D&&!this.fieldsIndex.get(G);for(const R of H??[]){const {outStatisticFieldName:Z,statisticType:da}=R;H=R;const ja="exceedslimit"!==da?R.onStatisticField:void 0,W="percentile_disc"===da||"percentile_cont"===da;var Y="EnvelopeAggregate"===da||
"CentroidAggregate"===da||"ConvexHullAggregate"===da;const aa=D&&1===r&&(ja===G||N)&&"count"===da;if(D){if(!A.has(ja)){var ca=[];for(const ia of J){var ka=this._getAttributeValues(F,ia,u);ca.push(ka)}A.set(ja,this._calculateUniqueValues(ca,Y?!1:F.returnDistinctValues))}ca=A.get(ja);if(!ca)continue;ka=Object.keys(ca);for(const ia of ka){const {count:qa,data:sa,items:ya,itemPositions:va}=ca[ia];ka=sa.join(",");if(!E||F.validateItems(ya,E)){const wa=B.get(ka)||{attributes:{}};if(Y){wa.aggregateGeometries||
(wa.aggregateGeometries={});const {aggregateGeometries:L,outStatisticFieldName:T}=await this._getAggregateGeometry(H,ya);wa.aggregateGeometries[T]=L}else{var Q=null;if(aa)Q=qa;else{const L=this._getAttributeValues(F,ja,u);Q=va.map(T=>L[T]);Q=W&&"statisticParameters"in H?this._getPercentileValue(H,Q):this._getStatisticValue(H,Q,null,F.returnDistinctValues)}wa.attributes[Z]=Q}let M=0;J.forEach((L,T)=>wa.attributes[this.fieldsIndex.get(L)?L:`EXPR_${++M}`]=sa[T]);B.set(ka,wa)}}}else if(Y){y.aggregateGeometries||
(y.aggregateGeometries={});const {aggregateGeometries:ia,outStatisticFieldName:qa}=await this._getAggregateGeometry(H,this.items);y.aggregateGeometries[qa]=ia}else Y=this._getAttributeValues(F,ja,u),y.attributes[Z]=W&&"statisticParameters"in H?this._getPercentileValue(H,Y):this._getStatisticValue(H,Y,v,F.returnDistinctValues);H="min"!==da&&"max"!==da||!h.isStringField(this.fieldsIndex.get(ja))&&!this._isAnyDateField(ja)?null:this.fieldsIndex.get(ja)?.type;z.push({name:Z,alias:Z,type:H||"esriFieldTypeDouble"})}y=
D?Array.from(B.values()):[y];this._sortFeatures(y,K,(R,Z)=>R.attributes[Z]);C&&(y.length=Math.min(C,y.length));return{fields:z,features:y}}_isAnyDateField(r){r=this.fieldsIndex.get(r);return h.isDateField(r)||h.isDateOnlyField(r)||h.isTimestampOffsetField(r)||h.isTimeOnlyField(r)}async _getAggregateGeometry(r,y){const {convexHull:z,union:u}=await new Promise((C,D)=>b(["../../../geometry/geometryEngineJSON"],C,D)),{statisticType:v,outStatisticFieldName:A}=r,{featureAdapter:B,spatialReference:F,geometryType:H,
hasZ:J,hasM:E}=this;y=y.map(C=>d.getGeometry(H,J,E,B.getGeometry(C)));const K=z(F,y,!0)[0];r={aggregateGeometries:null,outStatisticFieldName:null};"EnvelopeAggregate"===v?(y=K?k.getPolygonExtent(K):k.getGeometryExtent(u(F,y)),r.aggregateGeometries={...y,spatialReference:F},r.outStatisticFieldName=A||"extent"):"CentroidAggregate"===v?(y=K?g.polygonCentroid(K):g.extentCentroid(k.getGeometryExtent(u(F,y))),r.aggregateGeometries={x:y[0],y:y[1],spatialReference:F},r.outStatisticFieldName=A||"centroid"):
"ConvexHullAggregate"===v&&(r.aggregateGeometries=K,r.outStatisticFieldName=A||"convexHull");return r}_getStatisticValue(r,y,z,u){const {onStatisticField:v,statisticType:A}=r;r=null;r=z?.has(v)?z.get(v):h.isStringField(this.fieldsIndex.get(v))||this._isAnyDateField(v)?x.calculateStringStatistics({values:y,returnDistinct:u}):x.calculateStatistics({values:u?[...(new Set(y))]:y,minValue:null,maxValue:null,useSampleStdDev:!0});z&&z.set(v,r);return r["var"===A?"variance":A]}_getPercentileValue(r,y){const {onStatisticField:z,
statisticParameters:u,statisticType:v}=r,{value:A,orderBy:B}=u;r=this.fieldsIndex.get(z);return x.calculatePercentile(y,{value:A,orderBy:B,fieldType:r?.type,isDiscrete:"percentile_disc"===v})}_getAttributeValues(r,y,z){if(z.has(y))return z.get(y);const u=this.fieldsIndex.get(y),v=this.items.map(A=>r.getFieldValue(A,y,u));z.set(y,v);return v}_calculateUniqueValues(r,y){const z={},u=this.items,v=u.length;for(let A=0;A<v;A++){const B=u[A],F=[];for(const J of r)F.push(J[A]);const H=F.join(",");null==
z[H]?z[H]={count:1,data:F,items:[B],itemPositions:[A]}:(y||z[H].count++,z[H].items.push(B),z[H].itemPositions.push(A))}return z}async _getDataValues(r,y=!0){const z=new f(this.query,this.featureAdapter,this.fieldsIndex),{valueExpression:u,scale:v,timeZone:A}=r;return u?z.getExpressionValues(this.items,u,{viewingMode:"map",scale:v,spatialReference:this.query.outSR||this.spatialReference},{geometryType:this.geometryType,hasZ:this.hasZ,hasM:this.hasM},A):z.getDataValues(this.items,n.clone(r),y)}}class w{constructor(r,
y){this.coords=r;this.coordsIndex=y}get x(){return this.coords[this.coordsIndex]}get y(){return this.coords[this.coordsIndex+1]}get z(){return this.coords[this.coordsIndex+2]}}q.QueryEngineResult=t;Object.defineProperty(q,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/quantizationUtils":function(){define(["exports","./jsonUtils"],function(b,q){function n(C){if("lowerLeft"===C.originPosition&&4===C.scale.length&&4===C.translate.length)return C;const {originPosition:D,scale:G,translate:N}=
C;C=G[1]??1;return{originPosition:"lowerLeft",scale:[G[0]??1,"lowerLeft"===D?C:-C,G[2]??1,G[3]??1],translate:[N[0]??0,N[1]??0,N[2]??0,N[3]??0]}}function g({scale:C,translate:D},G){return Math.round((G-D[0])/C[0])}function k({scale:C,translate:D},G){return Math.round((G-D[1])/C[1])}function l({scale:C,translate:D},G){return Math.round(((G??0)-D[2])/C[2])}function a({scale:C,translate:D},G){return G?Math.round((G-D[3])/C[3]):0}function f(C,D){return C&&D?F:C&&!D?A:!C&&D?B:v}function d({scale:C,translate:D},
G){return G*C[0]+D[0]}function c({scale:C,translate:D},G){return G*C[1]+D[1]}function e({scale:C,translate:D},G){return(G??0)*C[2]+D[2]}function h({scale:C,translate:D},G){return G?G*C[3]+D[3]:0}function x(C,D){return C&&D?K:C&&!D?J:!C&&D?E:H}function m(C,D,G){const N=Array(G.length);for(let Y=0;Y<G.length;Y++)N[Y]=D(C,G[Y]);return N}function p(C,D,G){let [N,Y]=G[0],ca=Math.min(N,D[0]),ka=Math.min(Y,D[1]),Q=Math.max(N,D[2]);D=Math.max(Y,D[3]);for(let R=1;R<G.length;R++){const [Z,da]=G[R];N+=Z;Y+=
da;0>Z&&(ca=Math.min(ca,N));0<Z&&(Q=Math.max(Q,N));0>da?ka=Math.min(ka,Y):0<da&&(D=Math.max(D,Y))}C[0]=ca;C[1]=ka;C[2]=Q;C[3]=D;return C}function t(C,D){if(!D.length)return null;C[0]=C[1]=Number.POSITIVE_INFINITY;C[2]=C[3]=Number.NEGATIVE_INFINITY;for(let G=0;G<D.length;G++)p(C,C,D[G]);return C}function w(C,D,G){C=n(C);D.xmin=g(C,G.xmin);D.ymin=k(C,G.ymin);D.xmax=g(C,G.xmax);D.ymax=k(C,G.ymax);G.hasZ&&(D.zmin=l(C,G.zmin),D.zmax=l(C,G.zmax));G.hasM&&(D.mmin=a(C,G.mmin),D.mmax=a(C,G.mmax));D.hasZ=G.hasZ??
!1;D.hasM=G.hasM??!1;return D}function r(C,D,G){C=n(C);D.points=f(G.hasZ,G.hasM)(C,G.points)??[];D.hasZ=G.hasZ??!1;D.hasM=G.hasM??!1;return D}function y(C,D,G){C=n(C);D.x=g(C,G.x);D.y=k(C,G.y);null!=G.z&&(D.z=l(C,G.z));null!=G.m&&(D.m=a(C,G.m));return D}function z(C,D,G){{C=n(C);var N=G.rings;const Y=[],ca=f(G.hasZ,G.hasM);for(let ka=0;ka<N.length;ka++){const Q=ca(C,N[ka]);Q&&3<=Q.length&&Y.push(Q)}C=Y.length?Y:null}if(!C)return null;D.rings=C;D.hasZ=G.hasZ??!1;D.hasM=G.hasM??!1;return D}function u(C,
D,G){{C=n(C);var N=G.paths;const Y=[],ca=f(G.hasZ,G.hasM);for(let ka=0;ka<N.length;ka++){const Q=ca(C,N[ka]);Q&&2<=Q.length&&Y.push(Q)}C=Y.length?Y:null}if(!C)return null;D.paths=C;D.hasZ=G.hasZ??!1;D.hasM=G.hasM??!1;return D}const v=(C,D)=>{const G=[];if(!D.length)return null;var N=D[0];let Y=g(C,N[0]);N=k(C,N[1]);G.push([Y,N]);for(let ca=1;ca<D.length;ca++){const [ka,Q]=D[ca],R=g(C,ka),Z=k(C,Q);R===Y&&Z===N||G.push([R-Y,Z-N]);Y=R;N=Z}return G},A=(C,D)=>{const G=[];if(!D.length)return null;var N=
D[0];let Y=g(C,N[0]),ca=k(C,N[1]);N=l(C,N[2]);G.push([Y,ca,N]);for(let ka=1;ka<D.length;ka++){const [Q,R,Z]=D[ka],da=g(C,Q),ja=k(C,R),W=l(C,Z);da===Y&&ja===ca&&W===N||G.push([da-Y,ja-ca,W]);Y=da;ca=ja;N=W}return G},B=(C,D)=>{const G=[];if(!D.length)return null;var N=D[0];let Y=g(C,N[0]),ca=k(C,N[1]);N=a(C,N[2]);G.push([Y,ca,N]);for(let ka=1;ka<D.length;ka++){const [Q,R,Z]=D[ka],da=g(C,Q),ja=k(C,R),W=a(C,Z);da===Y&&ja===ca&&W===N||G.push([da-Y,ja-ca,W]);Y=da;ca=ja;N=W}return G},F=(C,D)=>{const G=[];
if(!D.length)return null;var N=D[0];let Y=g(C,N[0]),ca=k(C,N[1]),ka=l(C,N[2]);N=a(C,N[3]);G.push([Y,ca,ka,N]);for(let Q=1;Q<D.length;Q++){const [R,Z,da,ja]=D[Q],W=g(C,R),aa=k(C,Z),ia=l(C,da),qa=a(C,ja);W===Y&&aa===ca&&ia===ka&&qa===N||G.push([W-Y,aa-ca,ia,qa]);Y=W;ca=aa;ka=ia;N=qa}return G},H=(C,D)=>{const G=Array(D.length);if(!D.length)return G;var N=D[0];let Y=d(C,N[0]);N=c(C,N[1]);G[0]=[Y,N];const {scale:ca,originPosition:ka}=C;C=ca[0];const Q="lowerLeft"===ka?ca[1]:-ca[1];for(let R=1;R<D.length;R++){const [Z,
da]=D[R];Y+=C*Z;N+=Q*da;G[R]=[Y,N]}return G},J=(C,D)=>{const G=Array(D.length);if(!D.length)return G;var N=D[0];let Y=d(C,N[0]),ca=c(C,N[1]);G[0]=[Y,ca,e(C,N[2])];const {scale:ka,originPosition:Q}=C;N=ka[0];const R="lowerLeft"===Q?ka[1]:-ka[1];for(let Z=1;Z<D.length;Z++){const [da,ja,W]=D[Z];Y+=N*da;ca+=R*ja;G[Z]=[Y,ca,e(C,W)]}return G},E=(C,D)=>{const G=Array(D.length);if(!D.length)return G;var N=D[0];let Y=d(C,N[0]),ca=c(C,N[1]);G[0]=[Y,ca,h(C,N[2])];const {scale:ka,originPosition:Q}=C;N=ka[0];
const R="lowerLeft"===Q?ka[1]:-ka[1];for(let Z=1;Z<D.length;Z++){const [da,ja,W]=D[Z];Y+=N*da;ca+=R*ja;G[Z]=[Y,ca,h(C,W)]}return G},K=(C,D)=>{const G=Array(D.length);if(!D.length)return G;var N=D[0];let Y=d(C,N[0]),ca=c(C,N[1]);G[0]=[Y,ca,e(C,N[2]),h(C,N[3])];const {scale:ka,originPosition:Q}=C;N=ka[0];const R="lowerLeft"===Q?ka[1]:-ka[1];for(let Z=1;Z<D.length;Z++){const [da,ja,W,aa]=D[Z];Y+=N*da;ca+=R*ja;G[Z]=[Y,ca,e(C,W),h(C,aa)]}return G};b.getQuantizedBoundsCoordsArray=p;b.getQuantizedBoundsCoordsArrayArray=
t;b.getQuantizedBoundsPaths=function(C){return t([0,0,0,0],C)};b.getQuantizedBoundsPoints=function(C){const D=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];return p(D,D,C)};b.getQuantizedBoundsRings=function(C){return t([0,0,0,0],C)};b.normalizeTransform=n;b.quantizeBounds=function(C,D,G){C=n(C);D[0]=g(C,G[0]);D[3]=k(C,G[1]);D[2]=g(C,G[2]);D[1]=k(C,G[3]);return D};b.quantizeCoordsArrayXY=v;b.quantizeCoordsArrayXYM=B;b.quantizeCoordsArrayXYZ=
A;b.quantizeCoordsArrayXYZM=F;b.quantizeExtent=w;b.quantizeGeometry=function(C,D){return C&&D?q.isPoint(D)?y(C,{},D):q.isPolyline(D)?u(C,{},D):q.isPolygon(D)?z(C,{},D):q.isMultipoint(D)?r(C,{},D):q.isExtent(D)?w(C,{},D):null:null};b.quantizeM=a;b.quantizeMultipoint=r;b.quantizePoint=y;b.quantizePolygon=z;b.quantizePolyline=u;b.quantizeX=g;b.quantizeY=k;b.quantizeZ=l;b.toQuantizationTransform=function(C){return C?{originPosition:"upper-left"===C.originPosition?"upperLeft":"lower-left"===C.originPosition?
"lowerLeft":C.originPosition,scale:C.tolerance?[C.tolerance,C.tolerance,1,1]:[1,1,1,1],translate:null!=C.extent?[C.extent.xmin,C.extent.ymax,C.extent.zmin??0,C.extent.mmin??0]:[0,0,0,0]}:null};b.unquantizeBounds=function(C,D,G){C=n(C);return G?(D[0]=d(C,G[0]),D[1]=c(C,G[3]),D[2]=d(C,G[2]),D[3]=c(C,G[1]),D):[d(C,D[0]),c(C,D[3]),d(C,D[2]),c(C,D[1])]};b.unquantizeCoordsArrayArray=m;b.unquantizeCoordsArrayXY=H;b.unquantizeCoordsArrayXYM=E;b.unquantizeCoordsArrayXYZ=J;b.unquantizeCoordsArrayXYZM=K;b.unquantizeExtent=
function(C,D,G,N=G.hasZ??!1,Y=G.hasM??!1){C=n(C);D.xmin=d(C,G.xmin);D.xmax=d(C,G.xmax);D.ymin=c(C,G.ymin);D.ymax=c(C,G.ymax);N&&(D.zmin=e(C,G.zmin),D.zmax=e(C,G.zmax));Y&&(D.mmin=h(C,G.mmin),D.mmax=h(C,G.mmax));D.hasZ=N;D.hasM=Y;return D};b.unquantizeM=h;b.unquantizeMultipoint=function(C,D,G,N=G?.hasZ??!1,Y=G?.hasM??!1){null!=G&&(C=n(C),D.points=x(N,Y)(C,G.points),D.hasZ=N,D.hasM=Y);return D};b.unquantizePoint=function(C,D,G,N=null!=G?.z,Y=null!=G?.m){if(null==G)return D;C=n(C);D.x=d(C,G.x);D.y=c(C,
G.y);N&&(D.z=e(C,G.z));Y&&(D.m=h(C,G.m));return D};b.unquantizePolygon=function(C,D,G,N=G?.hasZ??!1,Y=G?.hasM??!1){null!=G&&(C=n(C),D.rings=m(C,x(N,Y),G.rings),D.hasZ=N,D.hasM=Y);return D};b.unquantizePolyline=function(C,D,G,N=G?.hasZ??!1,Y=G?.hasM??!1){null!=G&&(C=n(C),D.paths=m(C,x(N,Y),G.paths),D.hasZ=N,D.hasM=Y);return D};b.unquantizeX=d;b.unquantizeY=c;b.unquantizeZ=e;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/AttributesBuilder":function(){define("./attributeSupport ./geometryUtils ../../support/fieldUtils ../../../smartMapping/statistics/support/utils ../../../statistics/utils ../../../support/arcadeOnDemand".split(" "),
function(b,q,n,g,k,l){class a{constructor(f,d,c){this._fieldDataCache=new Map;this._returnDistinctMap=new Map;this.returnDistinctValues=f.returnDistinctValues??!1;this.fieldsIndex=c;this.featureAdapter=d;if((d=f.outFields)&&!d.includes("*")){this.outFields=d;f=0;for(const h of d){var e=b.getExpressionFromFieldName(h);e=(d=this.fieldsIndex.get(e))?null:b.getWhereClause(e,c);d=d?d.name:b.getAliasFromFieldName(h)||`FIELD_EXP_${f++}`;this._fieldDataCache.set(h,{alias:d,clause:e})}}}countDistinctValues(f){if(!this.returnDistinctValues)return f.length;
f.forEach(d=>this.getAttributes(d));return this._returnDistinctMap.size}getAttributes(f){f=this._processAttributesForOutFields(f);return this._processAttributesForDistinctValues(f)}getFieldValue(f,d,c){const e=c?c.name:d;let h=null;this._fieldDataCache.has(e)?h=this._fieldDataCache.get(e)?.clause:c||(h=b.getWhereClause(d,this.fieldsIndex),this._fieldDataCache.set(e,{alias:e,clause:h}));return c?this.featureAdapter.getAttribute(f,e):h?.calculateValue(f,this.featureAdapter)}getDataValues(f,d,c=!0){const e=
d.normalizationType,h=d.normalizationTotal,x=this.fieldsIndex.get(d.field),m=n.isDateOnlyField(x)||n.isTimestampOffsetField(x),p=n.isTimeOnlyField(x);return f.map(t=>{let w=d.field&&this.getFieldValue(t,d.field,this.fieldsIndex.get(d.field));d.field2?(w=`${k.processNullValue(w)}${d.fieldDelimiter}${k.processNullValue(this.getFieldValue(t,d.field2,this.fieldsIndex.get(d.field2)))}`,d.field3&&(w=`${w}${d.fieldDelimiter}${k.processNullValue(this.getFieldValue(t,d.field3,this.fieldsIndex.get(d.field3)))}`)):
"string"===typeof w&&c&&(m?w=w?(new Date(w)).getTime():null:p&&(w=w?g.timeOnlyToMilliseconds(w):null));e&&Number.isFinite(w)&&(t="field"===e&&d.normalizationField?this.getFieldValue(t,d.normalizationField,this.fieldsIndex.get(d.normalizationField)):null,w=k.getNormalizedValue(w,e,t,h));return w})}async getExpressionValues(f,d,c,e,h){const {arcadeUtils:x}=await l.loadArcade(),m=x.hasGeometryOperations(d);m&&await x.enableGeometryOperations();const p=x.createFunction(d),t=x.getViewInfo(c),w={fields:this.fieldsIndex.fields};
return f.map(r=>{r={attributes:this.featureAdapter.getAttributes(r),layer:w,geometry:m?{...q.getGeometry(e.geometryType,e.hasZ,e.hasM,this.featureAdapter.getGeometry(r)),spatialReference:c?.spatialReference}:null};r=x.createExecContext(r,t,h);return x.executeFunction(p,r)})}validateItem(f,d){this._fieldDataCache.has(d)||this._fieldDataCache.set(d,{alias:d,clause:b.getWhereClause(d,this.fieldsIndex)});return this._fieldDataCache.get(d)?.clause?.testFeature(f,this.featureAdapter)??!1}validateItems(f,
d){this._fieldDataCache.has(d)||this._fieldDataCache.set(d,{alias:d,clause:b.getWhereClause(d,this.fieldsIndex)});return this._fieldDataCache.get(d)?.clause?.testSet(f,this.featureAdapter)??!1}_processAttributesForOutFields(f){const d=this.outFields;if(!d?.length)return this.featureAdapter.getAttributes(f);const c={};for(const e of d){const {alias:h,clause:x}=this._fieldDataCache.get(e);c[h]=x?x.calculateValue(f,this.featureAdapter):this.featureAdapter.getAttribute(f,h)}return c}_processAttributesForDistinctValues(f){if(null==
f||!this.returnDistinctValues)return f;var d=this.outFields,c=[];if(d)for(const h of d){var {alias:e}=this._fieldDataCache.get(h);c.push(f[e])}else for(e in f)c.push(f[e]);d=`${(d||["*"]).join(",")}=${c.join(",")}`;c=this._returnDistinctMap.get(d)||0;this._returnDistinctMap.set(d,++c);return 1<c?null:f}}return a})},"esri/smartMapping/statistics/support/utils":function(){define("exports ../../../geometry ../../../core/Error ../../../core/screenUtils ../../../core/timeUtils ../../../geometry/SpatialReference ../../../geometry/support/quantizationUtils ../../../geometry/support/spatialReferenceUtils ../../../layers/support/fieldUtils ../../../renderers/support/heatmapUtils ../../support/utils ../../../statistics/utils ../../../support/arcadeOnDemand ../../../geometry/Point".split(" "),
function(b,q,n,g,k,l,a,f,d,c,e,h,x,m){function p(u){u=z.exec(u);if(!u)return null;const {hh:v,mm:A,ss:B,ms:F}=u.groups;return Number(v)*k.millisecondsPerTimeUnit.hours+Number(A)*k.millisecondsPerTimeUnit.minutes+Number(B)*k.millisecondsPerTimeUnit.seconds+Number(F||0)}function t(u,v){u=null!=u?u:"";null!=v&&v&&(u=u?"("+u+") AND ("+v+")":v);return u}function w(u){const v=u.layer;return u.fields.filter(A=>!v.getField(A))}function r(u){const v=u.layer;return u.fields.filter(A=>{A=v.getFieldUsageInfo(A);
return!A||!A.supportsStatistics})}let y=null;const z=/^(?<hh>([0-1][0-9])|([2][0-3])):(?<mm>[0-5][0-9])(:(?<ss>[0-5][0-9]))?([.](?<ms>\d+))?$/;b.calculateHeatmapStats=function(u,v=18,A,B,F){const H=new Float64Array(B*F);v=Math.round(g.pt2px(v));let J=Number.POSITIVE_INFINITY,E=Number.NEGATIVE_INFINITY;A=c.createValueFunction(A);for(const {geometry:D,attributes:G}of u){const {x:N,y:Y}=D;u=Math.max(0,N-v);var K=Math.max(0,Y-v);const ca=Math.min(F,Y+v),ka=Math.min(B,N+v),Q=+A(G);for(;K<ca;K++)for(let R=
u;R<ka;R++){var C=K*B+R;const Z=c.evaluateDensityKernel(R-N,K-Y,v)*Q;C=H[C]+=Z;J=Math.min(J,C);E=Math.max(E,C)}}return{min:J,max:E}};b.getDataValues=async function(u,v,A=!0){if(!v)return[];const {field:B,field2:F,field3:H,fieldDelimiter:J,fieldInfos:E,timeZone:K}=u;var C=B&&E?.find(ja=>ja.name.toLowerCase()===B.toLowerCase());const D=C?d.isTimeOnlyField(C):!1,G=C?e.isAnyDateField(C):!1,N=u.valueExpression,Y=u.normalizationType,ca=u.normalizationField,ka=u.normalizationTotal,Q=[];C=u.viewInfoParams;
let R=null,Z=null;if(N){if(!y){const {arcadeUtils:ja}=await x.loadArcade();y=ja}y.hasGeometryOperations(N)&&await y.enableGeometryOperations();R=y.createFunction(N);Z=C?y.getViewInfo({viewingMode:C.viewingMode,scale:C.scale,spatialReference:new l(C.spatialReference)}):null}u=u.fieldInfos;const da=v[0]&&"declaredClass"in v[0]&&"esri.Graphic"===v[0].declaredClass||!u?null:{fields:u};v.forEach(ja=>{var W=ja.attributes;if(N){var aa=y.createExecContext(da?{...ja,layer:da}:ja,Z,K);aa=y.executeFunction(R,
aa)}else W&&(aa=W[B],F?(aa=`${h.processNullValue(aa)}${J}${h.processNullValue(W[F])}`,H&&(aa=`${aa}${J}${h.processNullValue(W[H])}`)):"string"===typeof aa&&A&&(G?aa=aa?(new Date(aa)).getTime():null:D&&(aa=aa?p(aa):null)));Y&&"number"===typeof aa&&isFinite(aa)&&(W=W&&parseFloat(W[ca]),aa=h.getNormalizedValue(aa,Y,W,ka));Q.push(aa)});return Q};b.getRangeExpr=function(u,v,A){v=null!=v?u+" \x3e\x3d "+v:"";u=null!=A?u+" \x3c\x3d "+A:"";A="";return(A=v&&u?t(v,u):v||u)?"("+A+")":""};b.getSQLFilterForNormalization=
function(u){const v=u.field,A=u.normalizationType;u=u.normalizationField;let B;if("field"===A)B="(NOT "+u+" \x3d 0)";else if("log"===A||"natural-log"===A||"square-root"===A)B=`(${v} > 0)`;return B};b.getSumOfAttributesExpr=function(u,v,A){const B=[],F=[],H=[],J=[],E=[];u.forEach((C,D)=>{const G=C.field?"field":"expression",N=C.field||C.valueExpression;C.field?(E.push(N),F.push(`var ${G}${D} = Number($feature["${N}"]);`)):(B.push(`function getValueForExpr${D}() {\n  ${N} \n}`),F.push(`var ${G}${D} = Number(getValueForExpr${D}());`));
A||H.push(`${G}${D} = IIf(${G}${D} < 0, 0, ${G}${D});`);J.push(`${G}${D}`)});u=B.length?null:E.reduce((C,D)=>`${C} + ${D}`);let K=null;v||A?v?A||u&&(K=`(( ${u} ) >= 0)`):u&&(K=`(( ${u} ) <> 0)`):u&&(K=`(( ${u} ) > 0)`);return{valueExpression:[B.length?B.join("\n"):"",F.join("\n"),H.join("\n"),`var total = ${J.join(" + ")};`,"return total;"].filter(Boolean).join("\n\n"),sqlExpression:u,sqlWhere:K}};b.mergeWhereClauses=t;b.quantizeFeatures=function(u,v,A,B){const F=f.isWrappable(A)?f.getInfo(A):null,
H=F?Math.round((F.valid[1]-F.valid[0])/v.scale[0]):null;return u.map(J=>{const E=new m(J.geometry);a.quantizePoint(v,E,E);if(F){var K=H??0,C=B[0];0>E.x?E.x+=K:E.x>C&&(E.x-=K)}J.geometry=E;return J})};b.timeOnlyToMilliseconds=p;b.verifyBasicFieldValidity=function(u,v,A){const B=w({layer:u,fields:v});if(B.length)return new n(A,"Unknown fields: "+B.join(", ")+". You can only use fields defined in the layer schema");u=r({layer:u,fields:v});if(u.length)return new n(A,"Unsupported fields: "+u.join(", ")+
". You can only use fields that can be fetched i.e. AdapterFieldUsageInfo.supportsStatistics must be true")};b.verifyFieldType=function(u,v,A,B){let F;v?v.name!==u.objectIdField&&B.includes(v.type)||(F=new n(A,"'field' should be one of these types: "+B.join(","))):F=new n(A,"'field' is not defined in the layer schema");return F};b.verifyFilterValidity=function(u,v){if(u&&"intersects"!==u.spatialRelationship)return new n(v,"Only 'intersects' spatialRelationship is supported for featureFilter")};b.verifyNumericField=
function(u,v,A){let B;v?v.name!==u.objectIdField&&d.isNumericField(v)||(B=new n(A,"'field' should be one of these numeric types: "+d.numericTypes.join(","))):B=new n(A,"'field' is not defined in the layer schema");return B};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/core/timeUtils":function(){define(["exports","../intl/date","../time/timeZoneUtils","../chunks/datetime"],function(b,q,n,g){function k(f,d,c){return 0===f?0:f*a[d]/a[c]}function l(f){switch(f){case "milliseconds":return"millisecond";
case "seconds":return"second";case "minutes":return"minute";case "hours":return"hour";case "days":return"day";case "weeks":return"week";case "months":return"month";case "years":return"year"}}const a={milliseconds:1,seconds:1E3,minutes:6E4,hours:36E5,days:864E5,weeks:6048E5,months:26784E5,years:31536E6,decades:31536E7,centuries:31536E8};b.convertTime=k;b.isValidDate=function(f){return f instanceof Date&&!isNaN(f.getTime())};b.makeUTCTime=function(f,d,c="milliseconds"){d=new Date(k(d,c,"milliseconds"));
d.setUTCFullYear(f.getUTCFullYear(),f.getUTCMonth(),f.getUTCDate());return d};b.mergeTimeExtents=function(f,d){return f&&d?f.intersection(d):f||d};b.millisecondsPerTimeUnit=a;b.offsetDate=function(f,d,c,e=n.system){e=new g.IANAZone(q.resolveTimeZone(e));f=g.DateTime.fromJSDate(f,{zone:e});e="decades"===c||"centuries"===c?"year":l(c);"decades"===c&&(d*=10);"centuries"===c&&(d*=100);return f.plus({[e]:d}).toJSDate()};b.offsetDateUTC=function(f,d,c="milliseconds"){f=f.getTime();d=k(d,c,"milliseconds");
return new Date(f+d)};b.resetUTCDate=function(f,d){f=new Date(f.getTime());f.setUTCFullYear(d.getFullYear(),d.getMonth(),d.getDate());return f};b.timeSinceUTCMidnight=function(f,d="milliseconds"){const c=k(f.getUTCHours(),"hours","milliseconds"),e=k(f.getUTCMinutes(),"minutes","milliseconds"),h=k(f.getUTCSeconds(),"seconds","milliseconds");f=f.getUTCMilliseconds();return k(c+e+h+f,"milliseconds",d)};b.truncateDate=function(f,d,c=n.system){c=new g.IANAZone(q.resolveTimeZone(c));f=g.DateTime.fromJSDate(f,
{zone:c});if("decades"===d||"centuries"===d)return f=f.startOf("year"),{year:c}=f,f.set({year:c-c%("decades"===d?10:100)}).toJSDate();d=l(d);return f.startOf(d).toJSDate()};b.truncateLocalTime=function(f){const d=new Date(0);d.setHours(0);d.setMinutes(0);d.setSeconds(0);d.setMilliseconds(0);d.setFullYear(f.getUTCFullYear(),f.getUTCMonth(),f.getUTCDate());return d};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/renderers/support/heatmapUtils":function(){define(["exports","../../core/mathUtils",
"../../core/screenUtils","../../chunks/vec42","../../core/libs/gl-matrix-2/factories/vec4f64"],function(b,q,n,g,k){function l(a,f,d,c){let {color:e,ratio:h}=f,{color:x,ratio:m}=d;m===h&&(1===m?h-=1E-6:m+=1E-6);f=q.clamp((c-h)/(m-h),0,1);g.lerp(a,e.toArray(),x.toArray(),f)}b.createValueFunction=function(a){return"function"===typeof a?a:a?f=>+f[a]:()=>1};b.evaluateDensityKernel=function(a,f,d){a=Math.sqrt(a**2+f**2)/d;return 1<a?0:3/(Math.PI*d**2)*(1-a**2)**2};b.gaussianBlurRadiusPxToKernelDensityRadiusPt=
function(a){return n.px2pt(2.4*a)};b.generateGradient=function(a){const f=new Uint8ClampedArray(2048);a=a.filter(({ratio:x})=>0<=x&&1>=x).sort((x,m)=>x.ratio-m.ratio).map(({color:x,ratio:m})=>({color:x,ratio:Math.max(m,.001)}));if(1>a.length)return f;let d=a[0],c=a[0],e=1;const h=k.create();for(let x=0;512>x;x++){const m=(x+.5)/512;for(;m>c.ratio&&e<a.length;)d=c,c=a[e++];l(h,d,c,m);f.set(h,4*x)}return f};b.kernelDensityRadiusPtToGaussianBlurRadiusPx=function(a){return n.pt2px(a)/2.4};b.magicKernelDensityRadiusInflationFactor=
2.4;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/smartMapping/support/utils":function(){define("exports ../../intl/date ../../layers/support/fieldUtils ../../support/arcadeOnDemand ../../support/basemapUtils ../../time/timeZoneUtils".split(" "),function(b,q,n,g,k,l){function a(m){return String(m).padStart(2,"0")}function f(m,p,t){if("date"===p||"number"===p){"number"===p&&(m=new Date(m));p=t?m.getFullYear():m.getUTCFullYear();const w=a((t?m.getMonth():m.getUTCMonth())+1),
r=a(t?m.getDate():m.getUTCDate()),y=a(t?m.getHours():m.getUTCHours()),z=a(t?m.getMinutes():m.getUTCMinutes());m=a(t?m.getSeconds():m.getUTCSeconds());m=`TIMESTAMP'${p}-${w}-${r} ${y}:${z}:${m}'`}return m}function d(m,p){if(p instanceof Date)return"date";if("number"===typeof p)return"number";if("string"===typeof p&&(m=m.getField(p),"\x3cnow\x3e"!==p.toLowerCase()&&n.isDateField(m)))return"field"}const c={light:"streets gray topo terrain oceans osm gray-vector streets-vector topo-vector streets-relief-vector streets-navigation-vector topo-3d navigation-3d streets-3d osm-3d gray-3d arcgis-light-gray arcgis-navigation arcgis-streets arcgis-streets-relief arcgis-topographic arcgis-oceans osm-standard osm-standard-relief osm-streets osm-streets-relief osm-light-gray arcgis-terrain arcgis-charted-territory arcgis-community arcgis-colored-pencil arcgis-modern-antique arcgis-midcentury arcgis-newspaper arcgis-hillshade-light".split(" "),
dark:"satellite hybrid dark-gray dark-gray-vector streets-night-vector navigation-dark-3d streets-dark-3d dark-gray-3d arcgis-imagery arcgis-imagery-standard arcgis-dark-gray arcgis-navigation-night arcgis-streets-night osm-dark-gray arcgis-nova arcgis-hillshade-dark".split(" ")},e={years:365,months:30,days:1,hours:1/24,minutes:1/1440,seconds:1/86400,milliseconds:1/864E5},h=new Set(["integer","small-integer"]);let x=null;b.castIntegerFieldToFloat=function(m){return`cast(${m} as float)`};b.dateTypes=
["date","date-only","timestamp-offset"];b.defaultBasemapGroups=c;b.defaultStatisticTypes={exclude:["median"]};b.fieldDelimiter=",";b.formatAnyDate=function(m,p){const {format:t,timeZoneOptions:w,fieldType:r}=p??{};let y;w&&({timeZone:z,timeZoneName:y}=l.getTimeZoneFormattingOptions(w.layerTimeZone,w.datesInUnknownTimezone,w.viewTimeZone,q.convertDateFormatToIntlOptions(t||"short-date-short-time"),r));if("string"===typeof m&&isNaN(Date.parse("time-only"===r?`1970-01-01T${m}Z`:m)))return m;switch(r){case "date-only":var z=
q.convertDateFormatToIntlOptions(t||"short-date");return"string"===typeof m?q.formatDateOnly(m,{...z}):q.formatDate(m,{...z,timeZone:l.utc});case "time-only":return z=q.convertDateFormatToIntlOptions(t||"short-time"),"string"===typeof m?q.formatTimeOnly(m,z):q.formatDate(m,{...z,timeZone:l.utc});case "timestamp-offset":if(!z&&"string"===typeof m&&(new Date(m)).toISOString()!==m)return m;z=(p=t||w?q.convertDateFormatToIntlOptions(t||"short-date-short-time"):void 0)?{...p,timeZone:z,timeZoneName:y}:
void 0;return"string"===typeof m?q.formatTimestamp(m,z):q.formatDate(m,z);default:return p=t||w?q.convertDateFormatToIntlOptions(t||"short-date-short-time"):void 0,q.formatDate("string"===typeof m?new Date(m):m,p?{...p,timeZone:z,timeZoneName:y}:void 0)}};b.getBasemapGroup=function(m,p=c){for(const t in p)if(p[t].includes(m))return t};b.getBasemapId=function(m,p,t=!0){let w=null;m&&("string"===typeof m?p.includes(m)&&(w=m):w=k.getWellKnownBasemapId(m));return t?w||"gray":w};b.getDateDiffSQL=function(m,
p,t,w){const {hasQueryEngine:r}=m;t=f(t,d(m,t),r);m=f(p,d(m,p),r);m=`(${t} - ${m})`;w=e[w];p="/";1>w&&(w=1/w,p="*");return{sqlExpression:1===w?m:`(${m} ${p} ${w})`,sqlWhere:null}};b.getDateType=d;b.getFieldsList=async function(m){const {field:p,field2:t,field3:w,normalizationField:r,valueExpression:y}=m;m=[];y&&(x||({arcadeUtils:m}=await g.loadArcade(),x=m),m=x.extractFieldNames(y));p&&m.push(p);t&&m.push(t);w&&m.push(w);r&&m.push(r);return m};b.getNormalizationType=function(m){let p=m.normalizationType;
p||(m.normalizationField?p="field":null!=m.normalizationTotal&&(p="percent-of-total"));return p??void 0};b.isAnyDateField=function(m){return n.isDateField(m)||n.isDateOnlyField(m)||n.isTimestampOffsetField(m)};b.isIntegerField=function(m,p){m=p&&m.getField(p);return!!m&&h.has(m.type)};b.unitValueInDays=e;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/support/basemapUtils":function(){define("exports ../Basemap ../config ../core/Collection ../core/Logger ../core/maybe ../core/urlUtils ../core/accessorSupport/ensureType ../layers/effects/utils ./basemapDefinitions".split(" "),
function(b,q,n,g,k,l,a,f,d,c){function e(C,D){let G;if("string"===typeof C){const N=C in c.esriBasemapDefinitions,Y=!N&&C.includes("/");if(!N&&!Y)return n.apiKey?J().warn(`Unable to find basemap definition for: ${C}. See available styles at https://developers.arcgis.com/rest/basemap-styles/`):(D=Object.entries(c.esriBasemapDefinitions).filter(([,ca])=>ca.classic||ca.is3d).map(([ca])=>`"${ca}"`).sort().join(", "),J().warn(`Unable to find basemap definition for: ${C}. Try one of these: ${D}`)),null;
D&&(G=D[C]);G||(G=N?q.fromId(C):new q({style:{id:C}}),D&&(D[C]=G))}else G=f.ensureType(q,C);G?.destroyed&&(J().warn("The provided basemap is already destroyed",{basemap:G}),G=null);return G}function h(C){if(E)return E(C);let D=null;C=t(C);const G=!C?.baseLayers.length;for(const Y in c.esriBasemapDefinitions){var N=z(c.esriBasemapDefinitions[Y]);N=v(C,N,{mustMatchReferences:G});if("equal"===N){D=Y;break}"base-layers-equal"===N&&(D=Y)}return D}function x(C,D){const G=new g;C.forEach(N=>{const Y=D.find(ca=>
"scene"!==ca.type&&B(r(N),r(ca)))||N;G.includes(Y)?G.push(N):G.push(Y)});return G}function m(C){if(p(C.url))return!0;if("vector-tile"===C.type)for(const D in C.sourceNameToSource)if(p(C.sourceNameToSource[D]?.sourceUrl))return!0;return!1}function p(C){if(!C)return!1;C=new a.Url(a.makeAbsolute(C));return!!C.authority&&K.test(C.authority)}function t(C){return C?!C.loaded&&C.resourceInfo?z(C.resourceInfo.data):{baseLayers:w(C.baseLayers),referenceLayers:w(C.referenceLayers)}:null}function w(C){return(g.isCollection(C)?
C.toArray():C).map(r)}function r(C){return{type:C.type,effect:"effect"in C?C.effect:void 0,url:F("urlTemplate"in C&&C.urlTemplate||C.url||"styleUrl"in C&&C.styleUrl||""),minScale:"minScale"in C&&null!=C.minScale?C.minScale:0,maxScale:"maxScale"in C&&null!=C.maxScale?C.maxScale:0,opacity:null!=C.opacity?C.opacity:1,visible:null!=C.visible?!!C.visible:!0,sublayers:"map-image"!==C.type&&"wms"!==C.type||null==C.sublayers?void 0:C.sublayers?.map(D=>({id:D.id,visible:D.visible})),activeLayerId:"wmts"===
C.type?C.activeLayer?.id:void 0}}function y(C){return C.isReference||"ArcGISSceneServiceLayer"===C.layerType}function z(C){return C?{baseLayers:u((C.baseMapLayers??[]).filter(D=>!y(D))),referenceLayers:u((C.baseMapLayers??[]).filter(D=>y(D)))}:null}function u(C){return C.map(D=>{let G;switch(D.layerType){case "VectorTileLayer":G="vector-tile";break;case "ArcGISTiledMapServiceLayer":G="tile";break;case "ArcGISSceneServiceLayer":G="scene";break;default:G="unknown"}return{type:G,effect:D.effect,url:F(D.templateUrl||
D.urlTemplate||D.styleUrl||D.url),minScale:D.minScale??0,maxScale:D.maxScale??0,opacity:D.opacity??1,visible:null!=D.visibility?!!D.visibility:!0,sublayers:void 0,activeLayerId:void 0}})}function v(C,D,G){return null!=C!==(null!=D)?"not-equal":C&&D?A(C.baseLayers,D.baseLayers)?A(C.referenceLayers,D.referenceLayers)?"equal":G.mustMatchReferences?"not-equal":"base-layers-equal":"not-equal":"equal"}function A(C,D){if(C.length!==D.length)return!1;for(let G=0;G<C.length;G++)if(!B(C[G],D[G]))return!1;return!0}
function B(C,D){if(C.type!==D.type||C.url!==D.url||C.minScale!==D.minScale||C.maxScale!==D.maxScale||C.visible!==D.visible||C.opacity!==D.opacity||!d.effectEquals(C.effect,D.effect))return!1;if(null!=C.activeLayerId||null!=D.activeLayerId)return C.activeLayerId===D.activeLayerId;if(null!=C.sublayers||null!=D.sublayers){if(null==C.sublayers||null==D.sublayers||C.sublayers.length!==D.sublayers.length)return!1;for(let G=0;G<C.sublayers.length;G++){const N=C.sublayers.at(G),Y=D.sublayers.at(G);if(N?.id!==
Y?.id||N?.visible!==Y?.visible)return!1}}return!0}function F(C){return C?a.normalize(C).replace(/^\s*https?:/i,"").toLowerCase():""}function H(C){return"portalItem"in C?C.portalItem?.thumbnailUrl:void 0}const J=()=>k.getLogger("esri.support.basemapUtils");let E;const K=/^(basemaps|ibasemaps).*-api\.arcgis\.com$/i;b.clonePreservingTiledLayers=function(C,D=null){C=e(C);if(!C)return null;C=C.clone();D&&(C.baseLayers=x(C.baseLayers,D.baseLayers),C.referenceLayers=x(C.referenceLayers,D.referenceLayers));
return C};b.contentEquals=function(C,D){if(C===D||null!=C?.portalItem?.id&&C.portalItem.id===D?.portalItem?.id)return!0;C=t(C);D=t(D);return"equal"===v(C,D,{mustMatchReferences:!0})};b.createCache=function(){return{}};b.destroyCache=function(C){for(const D in C)l.destroyMaybe(C[D]),delete C[D]};b.ensureType=e;b.findSpatialReference=function(C,D){if(null==D||null==C)return{spatialReference:null,updating:!1};if("not-loaded"===D.loadStatus)return D.load(),{spatialReference:null,updating:!0};if(D.spatialReference)return{spatialReference:D.spatialReference,
updating:!1};if(0===D.baseLayers.length)return{spatialReference:null,updating:!1};D=D.baseLayers.at(0);switch(D.loadStatus){case "not-loaded":D.load();case "loading":return{spatialReference:null,updating:!0};case "failed":return{spatialReference:null,updating:!1}}D=(("supportedSpatialReferences"in D?D.supportedSpatialReferences:null)||["tileInfo"in D?D.tileInfo?.spatialReference:D.spatialReference]).filter(Boolean);const G=C.spatialReference;return G?{spatialReference:D.find(N=>G.equals(N))??D[0]??
null,updating:!1}:{spatialReference:D[0],updating:!1}};b.getBasemapThumbnailUrl=function(C){if(!C)return null;var {thumbnailUrl:D}=C;return D?D:(D=h(C))?c.esriBasemapDefinitions[D].thumbnailUrl:l.mappedFind(C.baseLayers,H)};b.getWellKnownBasemapId=h;b.hasDeveloperBasemapLayer=function(C){return!!C?.baseLayers.concat(C.referenceLayers).some(m)};b.isBasemap3D=function(C){return"Web Scene"===C.portalItem?.type||C.referenceLayers.some(D=>"scene"===D.type)};b.isBasemapInBeta=function(C){return!!C?.portalItem?.tags?.some(D=>
"beta"===D.toLowerCase())};b.isBasemapLayer=function(C,D){return C.basemap?.referenceLayers?.some(G=>G.uid===D)||C.basemap?.baseLayers?.some(G=>G.uid===D)};b.isDeveloperBasemapLayer=m;b.overrideGetWellKnownBasemapId=function(C){E=C};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/Basemap":function(){define("require ./chunks/tslib.es6 ./request ./core/Collection ./core/collectionUtils ./core/JSONSupport ./core/lang ./core/Loadable ./core/loadAll ./core/Logger ./core/maybe ./core/promiseUtils ./core/urlUtils ./core/accessorSupport/decorators/property ./core/has ./core/accessorSupport/decorators/subclass ./core/accessorSupport/decorators/writer ./geometry/SpatialReference ./portal/Portal ./portal/PortalItem ./support/basemapDefinitions ./support/BasemapStyle ./webdoc/support/writeUtils".split(" "),
function(b,q,n,g,k,l,a,f,d,c,e,h,x,m,p,t,w,r,y,z,u,v,A){var B;let F=0;l=B=class extends l.JSONSupportMixin(f){constructor(E){super(E);this.thumbnailUrl=this.style=this.spatialReference=this.portalItem=this.id=null;this.title="Basemap";this.id=Date.now().toString(16)+"-basemap-"+F++;this.baseLayers=new g;this.referenceLayers=new g;const K=C=>{C.parent&&C.parent!==this&&"remove"in C.parent&&C.parent.remove(C);C.parent=this;"elevation"===C.type&&c.getLogger(this).error(`Layer '${C.title}, id:${C.id}' of type '${C.type}' is not supported as a basemap layer and will therefore be ignored.`)};
this.addHandles([this.baseLayers.on("after-add",C=>K(C.item)),this.referenceLayers.on("after-add",C=>K(C.item)),this.baseLayers.on("after-remove",C=>{C.item.parent=null}),this.referenceLayers.on("after-remove",C=>{C.item.parent=null})])}initialize(){this.when().catch(E=>{c.getLogger(this).error("#load()",`Failed to load basemap (title: '${this.title}', id: '${this.id}')`,E)});this.resourceInfo&&this.read(this.resourceInfo.data,this.resourceInfo.context)}destroy(){var E=this.baseLayers.toArray();for(const K of E)K.destroy();
E=this.referenceLayers.toArray();for(const K of E)K.destroy();this.baseLayers.destroy();this.referenceLayers.destroy();this.portalItem=e.destroyMaybe(this.portalItem)}normalizeCtorArgs(E){E&&"resourceInfo"in E&&(this._set("resourceInfo",E.resourceInfo),E={...E},delete E.resourceInfo);return E}set baseLayers(E){this._set("baseLayers",k.referenceSetter(E,this._get("baseLayers")))}_writeBaseLayers(E,K,C){const D=[];E&&(C={...C,layerContainerType:"basemap"},this.baseLayers.forEach(G=>{G=A.getLayerJSON(G,
C.webmap?C.webmap.getLayerJSONFromResourceInfo(G):null,C);null!=G&&D.push(G)}),this.referenceLayers.forEach(G=>{const N=A.getLayerJSON(G,C.webmap?C.webmap.getLayerJSONFromResourceInfo(G):null,C);null!=N&&("scene"!==G.type&&(N.isReference=!0),D.push(N))}));K.baseMapLayers=D}set referenceLayers(E){this._set("referenceLayers",k.referenceSetter(E,this._get("referenceLayers")))}writeTitle(E,K){K.title=E||"Basemap"}load(E){this.addResolvingPromise(this._loadFromSource(E));return Promise.resolve(this)}loadAll(){return d.loadAll(this,
E=>{E(this.baseLayers,this.referenceLayers)})}clone(){const E={id:this.id,title:this.title,portalItem:this.portalItem,baseLayers:this.baseLayers.map(K=>a.isClonable(K)?K.clone():K),referenceLayers:this.referenceLayers.map(K=>a.isClonable(K)?K.clone():K)};this.loaded&&(E.loadStatus="loaded");return(new B({resourceInfo:this.resourceInfo})).set(E)}read(E,K){this.resourceInfo||this._set("resourceInfo",{data:E,context:K});super.read(E,K)}write(E,K){E=E||{};K?.origin||(K={origin:"web-map",...K});super.write(E,
K);!this.loaded&&this.resourceInfo?.data.baseMapLayers&&(E.baseMapLayers=this.resourceInfo.data.baseMapLayers.map(C=>{C=a.clone(C);C.url&&x.isProtocolRelative(C.url)&&(C.url=`https:${C.url}`);C.templateUrl&&x.isProtocolRelative(C.templateUrl)&&(C.templateUrl=`https:${C.templateUrl}`);return C}));return E}async _loadFromSource(E){const {resourceInfo:K,portalItem:C,style:D}=this;h.throwIfAborted(E);const G=[];K?(G.push(this._loadLayersFromJSON(K.data,K.context?K.context.url:null,E)),K.data.id&&!K.data.title&&
G.push(u.getBasemapTitle(K.data.id).then(N=>{N&&this.read({title:N},K.context)}))):C?G.push(this._loadFromItem(C,E)):D&&G.push(this._loadFromStylesService(D,E));await Promise.all(G)}async _loadLayersFromJSON(E,K,C){const D=this.resourceInfo?.context,G=this.portalItem?.portal||D?.portal||null,N=J[D?.origin||""]??"web-map",{populateOperationalLayers:Y}=await new Promise((ka,Q)=>b(["./layers/support/layersCreator"],ka,Q)),ca=[];h.throwIfAborted(C);if(E.baseMapLayers&&Array.isArray(E.baseMapLayers)){K=
{context:{...D,origin:N,url:K,portal:G,layerContainerType:"basemap"},defaultLayerType:"DefaultTileLayer"};const ka=Q=>"web-scene"===N&&"ArcGISSceneServiceLayer"===Q.layerType||Q.isReference;C=Y(this.baseLayers,E.baseMapLayers.filter(Q=>!ka(Q)),K);ca.push(C);E=Y(this.referenceLayers,E.baseMapLayers.filter(ka),K);ca.push(E)}await Promise.allSettled(ca)}async _loadFromItem(E,K){const C=await (await E.load(K)).fetchData("json",K),D=x.urlToObject(E.itemUrl??"");this._set("resourceInfo",{data:C.baseMap??
{},context:{origin:H[E.type||""]??"web-map",portal:E.portal||y.getDefault(),url:D}});this.read(this.resourceInfo.data,this.resourceInfo.context);this.read({spatialReference:C.spatialReference},this.resourceInfo.context);this.read({title:E.title,thumbnailUrl:E.thumbnailUrl},{origin:"portal-item",portal:E.portal||y.getDefault(),url:D});return this._loadLayersFromJSON(this.resourceInfo.data,D,K)}async _loadFromStylesService(E,K){var C=`${E.serviceUrl}/${E.id}`;const D=(await n(C,{query:{language:E.getLanguageParamValue(),
places:E.places,worldview:E.worldview,token:E.apiKey},signal:K?.signal})).data;C=x.urlToObject(C);this._set("resourceInfo",{data:D.baseMap??{},context:{origin:"web-map",url:C}});this.read(this.resourceInfo.data,this.resourceInfo.context);this.read({spatialReference:D.spatialReference},this.resourceInfo.context);await this._loadLayersFromJSON(this.resourceInfo.data,C,K);if(E.apiKey)for(const G of[...this.baseLayers,...this.referenceLayers])"apiKey"in G&&(G.apiKey=E.apiKey)}static fromId(E){return(E=
u.esriBasemapDefinitions[E])?E.itemId?new B({portalItem:{id:E.itemId,portal:{url:"https://www.arcgis.com"}}}):B.fromJSON(E,{origin:E.is3d?"web-scene":"web-map"}):null}};q.__decorate([m.property({json:{write:{ignoreOrigin:!0,target:"baseMapLayers",writer(E,K,C,D){this._writeBaseLayers(E,K,D)}},origins:{"web-scene":{write:{ignoreOrigin:!0,target:{baseMapLayers:{type:g}},writer(E,K,C,D){this._writeBaseLayers(E,K,D)}}}}}})],l.prototype,"baseLayers",null);q.__decorate([m.property({type:String,json:{origins:{"web-scene":{write:!0}}}})],
l.prototype,"id",void 0);q.__decorate([m.property({type:z})],l.prototype,"portalItem",void 0);q.__decorate([m.property()],l.prototype,"referenceLayers",null);q.__decorate([m.property({readOnly:!0})],l.prototype,"resourceInfo",void 0);q.__decorate([m.property({type:r})],l.prototype,"spatialReference",void 0);q.__decorate([m.property({type:v})],l.prototype,"style",void 0);q.__decorate([m.property()],l.prototype,"thumbnailUrl",void 0);q.__decorate([m.property({type:String,json:{origins:{"web-scene":{write:{isRequired:!0}}}}})],
l.prototype,"title",void 0);q.__decorate([w.writer("title")],l.prototype,"writeTitle",null);l=B=q.__decorate([t.subclass("esri.Basemap")],l);const H={"Web Scene":"web-scene","Web Map":"web-map","Link Chart":"link-chart"},J={"web-scene":"web-scene","web-map":"web-map","link-chart":"link-chart"};return l})},"esri/core/collectionUtils":function(){define(["exports","./Collection"],function(b,q){b.castForReferenceSetter=function(n){return n};b.referenceSetter=function(n,g,k=q){g||=new k;if(g===n)return g;
g.removeAll();n&&(Array.isArray(n)||"items"in n&&Array.isArray(n.items))?g.addMany(n):n&&g.add(n);return g};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/core/Loadable":function(){define("../chunks/tslib.es6 ./Error ./maybe ./Promise ./promiseUtils ./Warning ./accessorSupport/decorators/property ./accessorSupport/decorators/subclass".split(" "),function(b,q,n,g,k,l,a,f){const d=c=>{c=class extends c{constructor(...e){super(...e);this.loadError=this._loadController=null;this.loadStatus=
"not-loaded";this._set("loadWarnings",[]);this.addResolvingPromise(new Promise(h=>{const x=this.load.bind(this);this.load=m=>{const p=new Promise((t,w)=>{const r=k.onAbortOrThrow(m,w);this.destroyed&&w(new q("load:instance-destroyed",`Instance of '${this.declaredClass||this.constructor.name}' is already destroyed`,{instance:this}));this.when(t,w).finally(()=>{r&&r.remove()})});if("not-loaded"===this.loadStatus){this._set("loadStatus","loading");const t=this._loadController=new AbortController;x({signal:t.signal})}h();
return p}}));this.when(()=>{this._set("loadStatus","loaded");this._loadController=null},h=>{this._set("loadStatus","failed");this._set("loadError",h);this._loadController=null})}destroy(){this._loadController&&(this._loadController=n.abortMaybe(this._loadController),this._promiseProps.abort());this._set("loadError",null);this._set("loadWarnings",[])}get loaded(){return"loaded"===this.loadStatus}get loadWarnings(){return this._get("loadWarnings")}load(){return null}cancelLoad(){if(this.isFulfilled())return this;
this._set("loadError",new q("load:cancelled","Cancelled"));this._loadController?.abort();this._promiseProps.abort();return this}};b.__decorate([a.property({readOnly:!0})],c.prototype,"loaded",null);b.__decorate([a.property({readOnly:!0})],c.prototype,"loadError",void 0);b.__decorate([a.property({clonable:!1})],c.prototype,"loadStatus",void 0);b.__decorate([a.property({type:[l],readOnly:!0})],c.prototype,"loadWarnings",null);return c=b.__decorate([f.subclass("esri.core.Loadable")],c)};g=class extends d(g.EsriPromise){};
g=b.__decorate([f.subclass("esri.core.Loadable")],g);(function(c){c.LoadableMixin=d;c.isLoadable=function(e){return!(!e||!e.load)}})(g||={});return g})},"esri/core/Promise":function(){define(["exports","../chunks/tslib.es6","./Accessor","./promiseUtils","./accessorSupport/decorators/subclass"],function(b,q,n,g,k){var l;(function(d){d[d.PENDING=0]="PENDING";d[d.RESOLVED=1]="RESOLVED";d[d.REJECTED=2]="REJECTED"})(l||={});class a{constructor(){this._resolver=g.createResolver();this._status=l.PENDING;
this._resolvingPromises=[];this._resolver.promise.then(()=>{this._status=l.RESOLVED;this._cleanUp()},()=>{this._status=l.REJECTED;this._cleanUp()});this.promise=this._resolver.promise}destroy(){this._cleanUp()}addResolvingPromise(d){this._resolvingPromises.push(d);this._tryResolve()}isResolved(){return this._status===l.RESOLVED}isRejected(){return this._status===l.REJECTED}isFulfilled(){return this._status!==l.PENDING}abort(){this._resolver.reject(g.createAbortError())}_cleanUp(){this._resolvingPromises=
this._allPromise=null}_tryResolve(){if(!this.isFulfilled()){var d=g.createResolver(),c=[...this._resolvingPromises,d.promise],e=this._allPromise=Promise.all(c);e.then(()=>{this.isFulfilled()||this._allPromise!==e||this._resolver.resolve()},h=>{this.isFulfilled()||this._allPromise!==e||g.isAbortError(h)||this._resolver.reject(h)});d.resolve()}}}const f=d=>{d=class extends d{constructor(...c){super(...c);this._promiseProps=new a;this.addResolvingPromise(Promise.resolve())}destroy(){this._promiseProps.destroy()}isResolved(){return this._promiseProps.isResolved()}isRejected(){return this._promiseProps.isRejected()}isFulfilled(){return this._promiseProps.isFulfilled()}when(c,
e){return this._promiseProps.promise.then(()=>this).then(c,e)}catch(c){return this.when(null,c)}addResolvingPromise(c){c&&!this._promiseProps.isFulfilled()&&this._promiseProps.addResolvingPromise("_promiseProps"in c?c.when():c)}};return d=q.__decorate([k.subclass("esri.core.Promise")],d)};b.EsriPromise=class extends f(n){};b.EsriPromise=q.__decorate([k.subclass("esri.core.Promise")],b.EsriPromise);b.EsriPromiseMixin=f;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/core/loadAll":function(){define(["exports",
"./asyncUtils","./Collection","./Loadable"],function(b,q,n,g){async function k(l,a){const f=[],d=(...e)=>{for(const h of e)null!=h&&(Array.isArray(h)?d(...h):n.isCollection(h)?h.forEach(x=>d(x)):g.isLoadable(h)&&f.push(h))};a(d);let c=null;await q.map(f,async e=>{e=await q.result("loadAll"in e&&"function"===typeof e.loadAll?e.loadAll():e.load());!1!==e.ok||c||(c=e)});if(c)throw c.error;return l}b.loadAll=async function(l,a){await l.load();return k(l,a)};b.loadAllChildren=k;Object.defineProperty(b,
Symbol.toStringTag,{value:"Module"})})},"esri/portal/Portal":function(){define("require ../chunks/tslib.es6 ../config ../kernel ../request ../core/Error ../core/JSONSupport ../core/Loadable ../core/maybe ../core/promiseUtils ../core/accessorSupport/decorators/property ../core/accessorSupport/ensureType ../core/RandomLCG ../core/has ../core/accessorSupport/decorators/reader ../core/accessorSupport/decorators/subclass ../geometry/Extent ../intl/locale ./portalDefault ./PortalGroup ./PortalQueryParams ./PortalQueryResult ./PortalUser ../support/apiKeyUtils".split(" "),
function(b,q,n,g,k,l,a,f,d,c,e,h,x,m,p,t,w,r,y,z,u,v,A,B){function F(D){const G=g.id;return()=>{const N=D.deref();N&&G.findCredential(N.restUrl)&&N.signIn().catch(()=>{})}}const H=D=>Object.freeze(Object.defineProperty({__proto__:null,default:D},Symbol.toStringTag,{value:"Module"}));var J;let E;const K={PortalGroup:()=>Promise.resolve({default:z}),PortalItem:()=>new Promise((D,G)=>b(["./PortalItem"],N=>D(H(N)),G)),PortalUser:()=>Promise.resolve({default:A})};a=J=class extends a.JSONSupportMixin(f){constructor(D){super(D);
this.access=this._esriIdCredentialCreateHandle=null;this.allSSL=!1;this.authMode="auto";this.bingKey=this.basemapGalleryGroupQuery3D=this.basemapGalleryGroupQuery=this.authorizedCrossOriginDomains=null;this.canProvisionDirectPurchase=this.canListPreProvisionedItems=this.canListData=this.canListApps=!1;this.canSearchPublic=!0;this.canSignInIDP=this.canSignInArcGIS=this.canSharePublic=this.canShareBingPublic=!1;this.colorSetsGroupQuery=null;this.commentsEnabled=!1;this.livingAtlasGroupQuery=this.layoutGroupQuery=
this.galleryTemplatesGroupQuery=this.featuredItemsGroupQuery=this.featuredGroups=this.eueiEnabled=this.devBasemapGalleryGroupQuery=this.description=this.defaultVectorBasemap=this.defaultExtent=this.defaultDevBasemap=this.defaultBasemap=this.default3DBasemapQuery=this.customBaseUrl=this.culture=this.created=null;this.hasClassificationSchema=this.hasCategorySchema=!1;this.ipCntryCode=this.id=this.httpsPort=this.httpPort=this.homePageFeaturedContentCount=this.homePageFeaturedContent=this.helperServices=
null;this.isReadOnly=this.isPortal=!1;this.region=this.portalProperties=this.portalMode=this.portalHostname=this.name=this.modified=this.maxTokenExpirationMinutes=this.layerTemplatesGroupQuery=null;this.recycleBinEnabled=!1;this.rotatorPanels=null;this.showHomePageDescription=!1;this.sourceJSON=null;this.supportsHostedServices=!1;this.units=this.templatesGroupQuery=this.symbolSetsGroupQuery=null;this.url=n.portalUrl;this.user=this.urlKey=null;this.use3dBasemaps=!0;this.useVectorBasemaps=this.useStandardizedQuery=
this.useDefault3dBasemap=!1;this.vectorBasemapGalleryGroupQuery=null}normalizeCtorArgs(D){return"string"===typeof D?{url:D}:D}destroy(){C.unregister(this);this.defaultBasemap=d.destroyMaybe(this.defaultBasemap);this.defaultDevBasemap=d.destroyMaybe(this.defaultDevBasemap);this.defaultVectorBasemap=d.destroyMaybe(this.defaultVectorBasemap);this._esriIdCredentialCreateHandle=d.removeMaybe(this._esriIdCredentialCreateHandle)}readAuthorizedCrossOriginDomains(D){if(D)for(const G of D)n.request.trustedServers.includes(G)||
n.request.trustedServers.push(G);return D}readDefaultBasemap(D){return this._readBasemap(D)}readDefaultDevBasemap(D){return this._readBasemap(D)}readDefaultVectorBasemap(D){return this._readBasemap(D)}get extraQuery(){const D=!this.user?.orgId||this.canSearchPublic;return this.id&&!D?` AND orgid:${this.id}`:null}get hasAPIKey(){return B.isApiKeyApplicable(this.url)}get isOrganization(){return!!this.access}get itemPageUrl(){return this.url?`${this.url}/home/item.html`:null}get restUrl(){let D=this.url;
if(D){const G=D.indexOf("/sharing");D=0<G?D.slice(0,G):this.url.replace(/\/+$/,"");D+="/sharing/rest"}return D}get thumbnailUrl(){const D=this.restUrl,G=this.thumbnail;return D&&G?this._normalizeSSL(D+"/portals/self/resources/"+G):null}readUrlKey(D){return D?D.toLowerCase():D}readUser(D){let G=null;D&&(G=A.fromJSON(D),G.portal=this);return G}load(D){const G=(new Promise((N,Y)=>b(["../Basemap"],ca=>N(H(ca)),Y))).then(({default:N})=>{c.throwIfAborted(D);E=N}).then(()=>this.sourceJSON?this.sourceJSON:
this.fetchSelf(this.authMode,!1,D)).then(N=>{if(!this.hasAPIKey&&g.id){const Y=g.id;this.credential=Y.findCredential(this.restUrl);this.credential||this.authMode!==J.AUTH_MODE_AUTO&&this.authMode!==J.AUTH_MODE_NO_PROMPT||(this._esriIdCredentialCreateHandle?.remove(),this._esriIdCredentialCreateHandle=Y.on("credential-create",F(new WeakRef(this))),C.register(this,this._esriIdCredentialCreateHandle,this))}this.sourceJSON=N;this.read(N)});this.addResolvingPromise(G);return Promise.resolve(this)}async createElevationLayers(){await this.load();
const D=this._getHelperService("defaultElevationLayers"),G=(await new Promise((N,Y)=>b(["../layers/ElevationLayer"],ca=>N(H(ca)),Y))).default;return D?D.map(N=>new G({id:N.id,url:N.url})):[]}async fetchBasemaps(D,G){const N=await this._fetchBasemaps(D,G);!0===G?.include3d&&!1!==this.use3dBasemaps&&(D=await this._fetchBasemaps3D(D,G),N.unshift(...D));return N}async fetchDefault3DBasemap(D){if(!this.useDefault3dBasemap||!this.default3DBasemapQuery||"none"===this.default3DBasemapQuery)return null;const G=
new u;G.query=this.default3DBasemapQuery;G.disableExtraQuery=!0;return(D=(await this.queryItems(G,D)).results.find(N=>"Web Scene"===N.type))?new E({portalItem:D}):null}fetchCategorySchema(D){return this.hasCategorySchema?this.request(this.restUrl+"/portals/self/categorySchema",D).then(G=>G.categorySchema):c.isAborted(D)?Promise.reject(c.createAbortError()):Promise.resolve([])}fetchFeaturedGroups(D){const G=this.featuredGroups,N=new u({num:100,sortField:"title"});if(G?.length){const Y=[];for(const ca of G)Y.push(`(title:"${ca.title}" AND owner:${ca.owner})`);
N.query=Y.join(" OR ");return this.queryGroups(N,D).then(ca=>ca.results)}return c.isAborted(D)?Promise.reject(c.createAbortError()):Promise.resolve([])}fetchRegions(D){const G=this.user?.culture||this.culture||r.getLocale();return this.request(this.restUrl+"/portals/regions",{...D,query:{culture:G}})}fetchSettings(D){const G=this.user?.culture||this.culture||r.getLocale();return this.request(this.restUrl+"/portals/self/settings",{...D,query:{culture:G}})}static getDefault(){return y.ensureDefaultPortalInstance(()=>
new J)}queryGroups(D,G){return this.queryPortal("/community/groups",D,"PortalGroup",G)}queryItems(D,G){return this.queryPortal("/search",D,"PortalItem",G)}queryUsers(D,G){D.sortField||(D.sortField="username");return this.queryPortal("/community/users",D,"PortalUser",G)}fetchSelf(D=this.authMode,G=!1,N){const Y=this.restUrl+"/portals/self";D={authMode:D,query:{culture:r.getLocale().toLowerCase()},withCredentials:!0,...N};"auto"===D.authMode&&(D.authMode="no-prompt");G&&(D.query.default=!0);return this.request(Y,
D)}queryPortal(D,G,N,Y){const ca=h.ensureType(u,G),ka=Q=>this.request(this.restUrl+D,{...ca.toRequestOptions(this),...Y}).then(R=>{const Z=ca.clone();Z.start=R.nextStart;return new v({nextQueryParams:Z,queryParams:ca,total:R.total,results:J._resultsToTypedArray(Q,{portal:this},R,Y)})}).then(R=>Promise.all(R.results.map(Z=>"function"===typeof Z.when?Z.when():R)).then(()=>R,Z=>{c.throwIfAbortError(Z);return R}));return N&&K[N]?K[N]().then(({default:Q})=>{c.throwIfAborted(Y);return ka(Q)}):ka()}signIn(){if(this.hasAPIKey)return this.load().then(()=>
{if(!this.user)throw new l("portal:not-authenticated","Unable to authenticate user. Portal.user is missing");});if(this.authMode===J.AUTH_MODE_ANONYMOUS||this.authMode===J.AUTH_MODE_NO_PROMPT&&!g.id)return Promise.reject(new l("portal:invalid-auth-mode",`Current "authMode"' is "${this.authMode}"`));if("failed"===this.loadStatus)return Promise.reject(this.loadError);const D=G=>Promise.resolve().then(()=>{if("not-loaded"===this.loadStatus)return G||(this.authMode="immediate"),this.load().then(()=>null);
if("loading"===this.loadStatus)return this.load().then(()=>{if(this.credential)return null;this.credential=G;return this.fetchSelf("immediate")});if(this.user&&this.credential===G)return null;this.credential=G;return this.fetchSelf("immediate")}).then(N=>{N&&(this.sourceJSON=N,this.read(N))});return g.id?g.id.getCredential(this.restUrl,{prompt:this.authMode!==J.AUTH_MODE_NO_PROMPT}).then(G=>D(G)):D(this.credential)}normalizeUrl(D){const G=this.credential?.token;return this._normalizeSSL(G?D+(D.includes("?")?
"\x26":"?")+"token\x3d"+G:D)}requestToTypedArray(D,G,N){return this.request(D,G).then(Y=>{const ca=J._resultsToTypedArray(N,{portal:this},Y);return Promise.all(ca.map(ka=>"function"===typeof ka.when?ka.when():Y)).then(()=>ca,()=>ca)})}request(D,G={}){var N={f:"json",...G.query};const {authMode:Y=this.authMode===J.AUTH_MODE_ANONYMOUS||this.authMode===J.AUTH_MODE_NO_PROMPT?this.authMode:"auto",body:ca=null,cacheBust:ka=!1,method:Q="auto",responseType:R="json",signal:Z}=G;N={authMode:Y,body:ca,cacheBust:ka,
method:Q,query:N,responseType:R,timeout:0,signal:Z};G.withCredentials&&(N.withCredentials=!0);return k(this._normalizeSSL(D),N).then(da=>da.data)}toJSON(){throw new l("internal:not-yet-implemented","Portal.toJSON is not yet implemented");}static fromJSON(D){if(!D)return null;if(D.declaredClass)throw Error("JSON object is already hydrated");return new J({sourceJSON:D})}_getHelperService(D){const G=this.helperServices&&this.helperServices[D];if(!G)throw new l("portal:service-not-found",`The \`helperServices\` do not include an entry named "${D}"`);
return G}async _fetchBasemaps(D,G){const N=new u;N.query=D||(this.hasAPIKey?this.devBasemapGalleryGroupQuery:this.useVectorBasemaps?this.vectorBasemapGalleryGroupQuery:this.basemapGalleryGroupQuery);N.disableExtraQuery=!0;D=await this.queryGroups(N,G);if(!D.total)return[];D=D.results[0];N.num=100;N.query='type:"Web Map" -type:"Web Application"';N.sortField=D.sortField||"name";N.sortOrder=D.sortOrder||"desc";G=await D.queryItems(N,G);return G.total?G.results.filter(Y=>"Web Map"===Y.type).map(Y=>new E({portalItem:Y})):
[]}async _fetchBasemaps3D(D,G){D=D||this.basemapGalleryGroupQuery3D;if(!D)return[];D=new u({query:D,disableExtraQuery:!0});var N=await this.queryGroups(D,G);if(!N.total)return[];N=N.results[0];D.num=100;D.query='type:"Web Scene"';D.sortField=N.sortField||"name";D.sortOrder=N.sortOrder||"desc";G=await N.queryItems(D,G);return G.total?G.results.filter(Y=>"Web Scene"===Y.type).map(Y=>new E({portalItem:Y})):[]}_normalizeSSL(D){return D.replace(/^http:/i,"https:").replace(":7080",":7443")}_readBasemap(D){return D?
(D=E.fromJSON(D),D.portalItem={portal:this},D):null}static _resultsToTypedArray(D,G,N,Y){if(N){const ca=null!=Y?Y.signal:null;N=N.listings||N.notifications||N.userInvitations||N.tags||N.items||N.groups||N.comments||N.provisions||N.results||N.relatedItems||N;if(D||G)N=N.map(ka=>{ka=Object.assign(D?D.fromJSON(ka):ka,G);"function"===typeof ka.load&&ka.load(ca);return ka})}else N=[];return N}};a.AUTH_MODE_ANONYMOUS="anonymous";a.AUTH_MODE_AUTO="auto";a.AUTH_MODE_IMMEDIATE="immediate";a.AUTH_MODE_NO_PROMPT=
"no-prompt";q.__decorate([e.property()],a.prototype,"access",void 0);q.__decorate([e.property()],a.prototype,"allSSL",void 0);q.__decorate([e.property()],a.prototype,"authMode",void 0);q.__decorate([e.property()],a.prototype,"authorizedCrossOriginDomains",void 0);q.__decorate([p.reader("authorizedCrossOriginDomains")],a.prototype,"readAuthorizedCrossOriginDomains",null);q.__decorate([e.property()],a.prototype,"basemapGalleryGroupQuery",void 0);q.__decorate([e.property({json:{name:"3DBasemapGalleryGroupQuery"}})],
a.prototype,"basemapGalleryGroupQuery3D",void 0);q.__decorate([e.property()],a.prototype,"bingKey",void 0);q.__decorate([e.property()],a.prototype,"canListApps",void 0);q.__decorate([e.property()],a.prototype,"canListData",void 0);q.__decorate([e.property()],a.prototype,"canListPreProvisionedItems",void 0);q.__decorate([e.property()],a.prototype,"canProvisionDirectPurchase",void 0);q.__decorate([e.property()],a.prototype,"canSearchPublic",void 0);q.__decorate([e.property()],a.prototype,"canShareBingPublic",
void 0);q.__decorate([e.property()],a.prototype,"canSharePublic",void 0);q.__decorate([e.property()],a.prototype,"canSignInArcGIS",void 0);q.__decorate([e.property()],a.prototype,"canSignInIDP",void 0);q.__decorate([e.property()],a.prototype,"colorSetsGroupQuery",void 0);q.__decorate([e.property()],a.prototype,"commentsEnabled",void 0);q.__decorate([e.property({type:Date})],a.prototype,"created",void 0);q.__decorate([e.property()],a.prototype,"credential",void 0);q.__decorate([e.property()],a.prototype,
"culture",void 0);q.__decorate([e.property()],a.prototype,"currentVersion",void 0);q.__decorate([e.property()],a.prototype,"customBaseUrl",void 0);q.__decorate([e.property()],a.prototype,"default3DBasemapQuery",void 0);q.__decorate([e.property()],a.prototype,"defaultBasemap",void 0);q.__decorate([p.reader("defaultBasemap")],a.prototype,"readDefaultBasemap",null);q.__decorate([e.property()],a.prototype,"defaultDevBasemap",void 0);q.__decorate([p.reader("defaultDevBasemap")],a.prototype,"readDefaultDevBasemap",
null);q.__decorate([e.property({type:w})],a.prototype,"defaultExtent",void 0);q.__decorate([e.property()],a.prototype,"defaultVectorBasemap",void 0);q.__decorate([p.reader("defaultVectorBasemap")],a.prototype,"readDefaultVectorBasemap",null);q.__decorate([e.property()],a.prototype,"description",void 0);q.__decorate([e.property()],a.prototype,"devBasemapGalleryGroupQuery",void 0);q.__decorate([e.property()],a.prototype,"eueiEnabled",void 0);q.__decorate([e.property({readOnly:!0})],a.prototype,"extraQuery",
null);q.__decorate([e.property()],a.prototype,"featuredGroups",void 0);q.__decorate([e.property()],a.prototype,"featuredItemsGroupQuery",void 0);q.__decorate([e.property()],a.prototype,"galleryTemplatesGroupQuery",void 0);q.__decorate([e.property()],a.prototype,"layoutGroupQuery",void 0);q.__decorate([e.property()],a.prototype,"livingAtlasGroupQuery",void 0);q.__decorate([e.property({readOnly:!0})],a.prototype,"hasAPIKey",null);q.__decorate([e.property()],a.prototype,"hasCategorySchema",void 0);q.__decorate([e.property()],
a.prototype,"hasClassificationSchema",void 0);q.__decorate([e.property()],a.prototype,"helpBase",void 0);q.__decorate([e.property()],a.prototype,"helperServices",void 0);q.__decorate([e.property()],a.prototype,"helpMap",void 0);q.__decorate([e.property()],a.prototype,"homePageFeaturedContent",void 0);q.__decorate([e.property()],a.prototype,"homePageFeaturedContentCount",void 0);q.__decorate([e.property()],a.prototype,"httpPort",void 0);q.__decorate([e.property()],a.prototype,"httpsPort",void 0);q.__decorate([e.property()],
a.prototype,"id",void 0);q.__decorate([e.property()],a.prototype,"ipCntryCode",void 0);q.__decorate([e.property({readOnly:!0})],a.prototype,"isOrganization",null);q.__decorate([e.property()],a.prototype,"isPortal",void 0);q.__decorate([e.property()],a.prototype,"isReadOnly",void 0);q.__decorate([e.property({readOnly:!0})],a.prototype,"itemPageUrl",null);q.__decorate([e.property()],a.prototype,"layerTemplatesGroupQuery",void 0);q.__decorate([e.property()],a.prototype,"maxTokenExpirationMinutes",void 0);
q.__decorate([e.property({type:Date})],a.prototype,"modified",void 0);q.__decorate([e.property()],a.prototype,"name",void 0);q.__decorate([e.property()],a.prototype,"portalHostname",void 0);q.__decorate([e.property()],a.prototype,"portalMode",void 0);q.__decorate([e.property()],a.prototype,"portalProperties",void 0);q.__decorate([e.property()],a.prototype,"region",void 0);q.__decorate([e.property()],a.prototype,"recycleBinEnabled",void 0);q.__decorate([e.property({readOnly:!0})],a.prototype,"restUrl",
null);q.__decorate([e.property()],a.prototype,"rotatorPanels",void 0);q.__decorate([e.property()],a.prototype,"showHomePageDescription",void 0);q.__decorate([e.property()],a.prototype,"sourceJSON",void 0);q.__decorate([e.property()],a.prototype,"staticImagesUrl",void 0);q.__decorate([e.property({json:{name:"2DStylesGroupQuery"}})],a.prototype,"stylesGroupQuery2d",void 0);q.__decorate([e.property({json:{name:"stylesGroupQuery"}})],a.prototype,"stylesGroupQuery3d",void 0);q.__decorate([e.property()],
a.prototype,"supportsHostedServices",void 0);q.__decorate([e.property()],a.prototype,"symbolSetsGroupQuery",void 0);q.__decorate([e.property()],a.prototype,"templatesGroupQuery",void 0);q.__decorate([e.property()],a.prototype,"thumbnail",void 0);q.__decorate([e.property({readOnly:!0})],a.prototype,"thumbnailUrl",null);q.__decorate([e.property()],a.prototype,"units",void 0);q.__decorate([e.property()],a.prototype,"url",void 0);q.__decorate([e.property()],a.prototype,"urlKey",void 0);q.__decorate([p.reader("urlKey")],
a.prototype,"readUrlKey",null);q.__decorate([e.property()],a.prototype,"user",void 0);q.__decorate([p.reader("user")],a.prototype,"readUser",null);q.__decorate([e.property()],a.prototype,"use3dBasemaps",void 0);q.__decorate([e.property()],a.prototype,"useDefault3dBasemap",void 0);q.__decorate([e.property()],a.prototype,"useStandardizedQuery",void 0);q.__decorate([e.property()],a.prototype,"useVectorBasemaps",void 0);q.__decorate([e.property()],a.prototype,"vectorBasemapGalleryGroupQuery",void 0);
q=a=J=q.__decorate([t.subclass("esri.portal.Portal")],a);const C=new FinalizationRegistry(D=>{D.remove()});return q})},"esri/portal/portalDefault":function(){define(["exports"],function(b){let q;b.clearDefaultPortalInstance=function(){q=void 0};b.ensureDefaultPortalInstance=function(n){if(!q||q.destroyed)q=n();return q};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/portal/PortalGroup":function(){define("../chunks/tslib.es6 ../core/Error ../core/JSONSupport ../core/accessorSupport/decorators/property ../core/accessorSupport/ensureType ../core/RandomLCG ../core/has ../core/accessorSupport/decorators/subclass ./PortalQueryParams".split(" "),
function(b,q,n,g,k,l,a,f,d){var c;n=c=class extends n.JSONSupport{constructor(e){super(e);this.id=this.description=this.created=this.access=null;this.isInvitationOnly=!1;this.title=this.tags=this.sourceJSON=this.sortOrder=this.sortField=this.snippet=this.portal=this.owner=this.modified=null}get thumbnailUrl(){const e=this.url,h=this.thumbnail;return e&&h&&this.portal?this.portal?.normalizeUrl(`${e}/info/${h}?f=json`):null}get url(){const e=this.portal?.restUrl;return e?e+"/community/groups/"+this.id:
null}fetchCategorySchema(e){return this.portal.request(this.url+"/categorySchema",e).then(h=>{h=h.categorySchema||[];return h.some(x=>"contentCategorySetsGroupQuery.LivingAtlas"===x.source)?this._fetchCategorySchemaSet("LivingAtlas",e):h})}fetchMembers(e){return this.portal.request(this.url+"/users",e)}getThumbnailUrl(e){let h=this.thumbnailUrl;h&&e&&(h+=`&w=${e}`);return h}toJSON(){throw new q("internal:not-yet-implemented","PortalGroup.toJSON is not yet implemented");}static fromJSON(e){if(!e)return null;
if(e.declaredClass)throw Error("JSON object is already hydrated");const h=new c({sourceJSON:e});h.read(e);return h}queryItems(e,h){e=k.ensureType(d,e);const x=this.portal;if(5<parseFloat(x.currentVersion))return e=e||new d,x.queryPortal(`/content/groups/${this.id}/search`,e,"PortalItem",h);e=e?e.clone():new d;e.query="group:"+this.id+(e.query?" "+e.query:"");return x.queryItems(e,h)}_fetchCategorySchemaSet(e,h){const x=this.portal;return x.fetchSelf(x.authMode,!0,h).then(m=>{if(m=m.contentCategorySetsGroupQuery)return m=
new d({disableExtraQuery:!0,num:1,query:m}),x.queryGroups(m,h);throw new q("portal-group:fetchCategorySchema","contentCategorySetsGroupQuery value not found");}).then(m=>{if(m.total){m=m.results[0];const p=new d({num:1,query:`typekeywords:"${e}"`});return m.queryItems(p,h)}throw new q("portal-group:fetchCategorySchema","contentCategorySetsGroupQuery group not found");}).then(m=>m.total?m.results[0].fetchData("json",h).then(p=>{p=p?.categorySchema;return p?.length?p:[]}):[])}};b.__decorate([g.property()],
n.prototype,"access",void 0);b.__decorate([g.property({type:Date})],n.prototype,"created",void 0);b.__decorate([g.property()],n.prototype,"description",void 0);b.__decorate([g.property()],n.prototype,"id",void 0);b.__decorate([g.property()],n.prototype,"isInvitationOnly",void 0);b.__decorate([g.property({type:Date})],n.prototype,"modified",void 0);b.__decorate([g.property()],n.prototype,"owner",void 0);b.__decorate([g.property()],n.prototype,"portal",void 0);b.__decorate([g.property()],n.prototype,
"snippet",void 0);b.__decorate([g.property()],n.prototype,"sortField",void 0);b.__decorate([g.property()],n.prototype,"sortOrder",void 0);b.__decorate([g.property()],n.prototype,"sourceJSON",void 0);b.__decorate([g.property()],n.prototype,"tags",void 0);b.__decorate([g.property()],n.prototype,"thumbnail",void 0);b.__decorate([g.property({readOnly:!0})],n.prototype,"thumbnailUrl",null);b.__decorate([g.property()],n.prototype,"title",void 0);b.__decorate([g.property({readOnly:!0})],n.prototype,"url",
null);return n=c=b.__decorate([f.subclass("esri.portal.PortalGroup")],n)})},"esri/portal/PortalQueryParams":function(){define("../chunks/tslib.es6 ../core/Accessor ../core/jsonMap ../core/lang ../core/accessorSupport/decorators/property ../core/has ../core/Logger ../core/accessorSupport/decorators/subclass ../geometry/Extent ../geometry/SpatialReference ../geometry/support/webMercatorUtils".split(" "),function(b,q,n,g,k,l,a,f,d,c,e){var h;const x=new n.JSONMap({avgRating:"avg-rating",numRatings:"num-ratings",
numComments:"num-comments",numViews:"num-views"});q=h=class extends q{constructor(m){super(m);this.categories=null;this.disableExtraQuery=!1;this.filter=this.extent=null;this.num=10;this.sortField=this.query=null;this.start=1}get sortOrder(){return this._get("sortOrder")||"asc"}set sortOrder(m){"asc"!==m&&"desc"!==m||this._set("sortOrder",m)}clone(){return new h({categories:this.categories?g.clone(this.categories):null,disableExtraQuery:this.disableExtraQuery,extent:this.extent?this.extent.clone():
null,filter:this.filter,num:this.num,query:this.query,sortField:this.sortField,sortOrder:this.sortOrder,start:this.start})}toRequestOptions(m,p){let t=[];this.categories&&(t=this.categories.map(y=>Array.isArray(y)?JSON.stringify(y):y));let w="";if(this.extent){var r=e.project(this.extent,c.WGS84);null!=r&&(w=`${r.xmin},${r.ymin},${r.xmax},${r.ymax}`)}r=this.query;!this.disableExtraQuery&&m.extraQuery&&(r="("+r+")"+m.extraQuery);m={categories:t,bbox:w,q:r,filter:this.filter,num:this.num,sortField:null,
sortOrder:null,start:this.start};this.sortField&&(m.sortField=this.sortField.split(",").map(y=>x.toJSON(y.trim())).join(","),m.sortOrder=this.sortOrder);return{query:{...p,...m}}}};b.__decorate([k.property()],q.prototype,"categories",void 0);b.__decorate([k.property()],q.prototype,"disableExtraQuery",void 0);b.__decorate([k.property({type:d})],q.prototype,"extent",void 0);b.__decorate([k.property()],q.prototype,"filter",void 0);b.__decorate([k.property()],q.prototype,"num",void 0);b.__decorate([k.property()],
q.prototype,"query",void 0);b.__decorate([k.property()],q.prototype,"sortField",void 0);b.__decorate([k.property()],q.prototype,"sortOrder",null);b.__decorate([k.property()],q.prototype,"start",void 0);return q=h=b.__decorate([f.subclass("esri.portal.PortalQueryParams")],q)})},"esri/portal/PortalQueryResult":function(){define("../chunks/tslib.es6 ../core/Accessor ../core/accessorSupport/decorators/property ../core/has ../core/Logger ../core/RandomLCG ../core/accessorSupport/decorators/subclass".split(" "),
function(b,q,n,g,k,l,a){q=class extends q{constructor(f){super(f);this.total=this.results=this.queryParams=this.nextQueryParams=null}};b.__decorate([n.property()],q.prototype,"nextQueryParams",void 0);b.__decorate([n.property()],q.prototype,"queryParams",void 0);b.__decorate([n.property()],q.prototype,"results",void 0);b.__decorate([n.property()],q.prototype,"total",void 0);return q=b.__decorate([a.subclass("esri.portal.PortalQueryResult")],q)})},"esri/portal/PortalUser":function(){define("require ../chunks/tslib.es6 ../core/Error ../core/JSONSupport ../core/accessorSupport/decorators/property ../core/has ../core/Logger ../core/RandomLCG ../core/accessorSupport/decorators/subclass ./PortalFolder ./PortalGroup".split(" "),
function(b,q,n,g,k,l,a,f,d,c,e){var h;g=h=class extends g.JSONSupport{constructor(x){super(x);this.userType=this.userLicenseTypeId=this.username=this.units=this.sourceJSON=this.roleId=this.role=this.region=this.privileges=this.preferredView=this.portal=this.orgId=this.modified=this.fullName=this.email=this.description=this.culture=this.created=this.access=null}get thumbnailUrl(){const x=this.url,m=this.thumbnail;return x&&m?this.portal.normalizeUrl(`${x}/info/${m}?f=json`):null}get userContentUrl(){const x=
this.portal?.restUrl;return x?`${x}/content/users/${this.username}`:null}get url(){const x=this.portal?.restUrl;return x?`${x}/community/users/${this.username}`:null}addItem(x){const m=x&&x.item;var p=x?.data;x=x?.folder;const t={method:"post"};m&&(t.query=m.createPostQuery(),null!=p&&("string"===typeof p?t.query.text=p:"object"===typeof p&&(t.query.text=JSON.stringify(p))));p=this.userContentUrl;x&&(p+="/"+("string"===typeof x?x:x.id));return this.portal.request(p+"/addItem",t).then(w=>{m.id=w.id;
m.portal=this.portal;return m.loaded?m.reload():m.load()})}async deleteItem(x,m=!1){let p=this.userContentUrl;x.ownerFolder&&(p+="/"+x.ownerFolder);await this.portal.request(p+`/items/${x.id}/delete`,{method:"post",query:m?{permanentDelete:!0}:{}});x.id=null;x.portal=null}async deleteItems(x,m=!1){x=x.slice();var p=this.userContentUrl+"/deleteItems";const t=[];var w=x.map(r=>r.id);if(w.length){m={method:"post",query:{items:w.join(","),permanentDelete:m}};p=await this.portal.request(p,m);for(const r of p.results)p=
x.find(y=>r.itemId===y.id),m=r.success,w=null,m?(p.id=null,p.portal=null):r.error&&(w=new n("portal:delete-item-failed",r.error.message,r.error)),t.push({item:p,success:m,error:w})}return t}fetchFolders(){return this.portal.request(this.userContentUrl??"",{query:{num:1}}).then(x=>x&&x.folders?x.folders.map(m=>{m=c.fromJSON(m);m.portal=this.portal;return m}):[])}fetchGroups(){return this.portal.request(this.url??"").then(x=>x&&x.groups?x.groups.map(m=>{m=e.fromJSON(m);m.portal=this.portal;return m}):
[])}async fetchItems(x){x??={};var m=this.userContentUrl??"";x.folder&&(m+="/"+x.folder.id);const {default:p}=await new Promise((t,w)=>b(["./PortalItem"],r=>t(Object.freeze(Object.defineProperty({__proto__:null,default:r},Symbol.toStringTag,{value:"Module"}))),w));x=await this.portal.request(m,{query:{folders:!1,inRecycleBin:x.inRecycleBin?!0:null,foldersContent:!x.folder&&x.includeSubfolderItems?!0:null,num:x.num||10,start:x.start||1,sortField:x.sortField||"created",sortOrder:x.sortOrder||"asc"}});
return x?.items?(m=x.items.map(t=>{t=p.fromJSON(t);t.portal=this.portal;return t}),await Promise.all(m.map(t=>t.load())),{items:m,nextStart:x.nextStart,total:x.total}):{items:[],nextStart:-1,total:0}}fetchTags(){return this.portal.request(this.url+"/tags").then(x=>x.tags)}getThumbnailUrl(x){let m=this.thumbnailUrl;m&&x&&(m+=`&w=${x}`);return m}queryFavorites(x){return this.favGroupId?(this._favGroup||(this._favGroup=new e({id:this.favGroupId,portal:this.portal})),this._favGroup.queryItems(x)):Promise.reject(new n("internal:unknown",
"Unknown internal error",{internalError:"Unknown favGroupId"}))}async restoreItem(x,m){await this.portal.request(this.userContentUrl+`/items/${x.id}/restore`,{method:"post",query:m?{folderID:"string"===typeof m?m:m.id}:null})}toJSON(){throw new n("internal:not-yet-implemented","PortalUser.toJSON is not yet implemented");}static fromJSON(x){if(!x)return null;if(x.declaredClass)throw Error("JSON object is already hydrated");const m=new h({sourceJSON:x});m.read(x);return m}};q.__decorate([k.property()],
g.prototype,"access",void 0);q.__decorate([k.property({type:Date})],g.prototype,"created",void 0);q.__decorate([k.property()],g.prototype,"culture",void 0);q.__decorate([k.property()],g.prototype,"description",void 0);q.__decorate([k.property()],g.prototype,"email",void 0);q.__decorate([k.property()],g.prototype,"favGroupId",void 0);q.__decorate([k.property()],g.prototype,"fullName",void 0);q.__decorate([k.property({type:Date})],g.prototype,"modified",void 0);q.__decorate([k.property()],g.prototype,
"orgId",void 0);q.__decorate([k.property()],g.prototype,"portal",void 0);q.__decorate([k.property()],g.prototype,"preferredView",void 0);q.__decorate([k.property()],g.prototype,"privileges",void 0);q.__decorate([k.property()],g.prototype,"region",void 0);q.__decorate([k.property()],g.prototype,"role",void 0);q.__decorate([k.property()],g.prototype,"roleId",void 0);q.__decorate([k.property()],g.prototype,"sourceJSON",void 0);q.__decorate([k.property()],g.prototype,"thumbnail",void 0);q.__decorate([k.property({readOnly:!0})],
g.prototype,"thumbnailUrl",null);q.__decorate([k.property()],g.prototype,"units",void 0);q.__decorate([k.property({readOnly:!0})],g.prototype,"userContentUrl",null);q.__decorate([k.property({readOnly:!0})],g.prototype,"url",null);q.__decorate([k.property()],g.prototype,"username",void 0);q.__decorate([k.property()],g.prototype,"userLicenseTypeId",void 0);q.__decorate([k.property()],g.prototype,"userType",void 0);return g=h=q.__decorate([d.subclass("esri.portal.PortalUser")],g)})},"esri/portal/PortalFolder":function(){define("../chunks/tslib.es6 ../core/Error ../core/JSONSupport ../core/accessorSupport/decorators/property ../core/has ../core/Logger ../core/RandomLCG ../core/accessorSupport/decorators/subclass".split(" "),
function(b,q,n,g,k,l,a,f){n=class extends n.JSONSupport{constructor(d){super(d);this.username=this.title=this.portal=this.id=this.created=null}get url(){const d=this.portal?.restUrl;return d?`${d}/content/users/${this.username}/${this.id}`:null}toJSON(){throw new q("internal:not-yet-implemented","PortalFolder.toJSON is not yet implemented");}};b.__decorate([g.property({type:Date})],n.prototype,"created",void 0);b.__decorate([g.property()],n.prototype,"id",void 0);b.__decorate([g.property()],n.prototype,
"portal",void 0);b.__decorate([g.property()],n.prototype,"title",void 0);b.__decorate([g.property({readOnly:!0})],n.prototype,"url",null);b.__decorate([g.property()],n.prototype,"username",void 0);return n=b.__decorate([f.subclass("esri.portal.PortalFolder")],n)})},"esri/portal/PortalItem":function(){define("require ../chunks/tslib.es6 ../assets ../core/Error ../core/JSONSupport ../core/lang ../core/Loadable ../core/urlUtils ../core/accessorSupport/decorators/property ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/reader ../core/accessorSupport/decorators/subclass ../geometry/Extent ./Portal ./PortalItemResource ./PortalRating ../chunks/persistableUrlUtils".split(" "),
function(b,q,n,g,k,l,a,f,d,c,e,h,x,m,p,t,w){var r;const y=new Set("3DTiles Service;CSV;Feature Collection;Feature Service;Feed;GeoJson;Group Layer;Image Service;KML;Map Service;Media Layer;Scene Service;Stream Service;Vector Tile Service;WFS;WMS;WMTS".split(";")),z=new Set(["KML","GeoJson","CSV"]);k=r=class extends k.JSONSupportMixin(a){static from(u){return c.ensureClass(r,u)}constructor(u){super(u);this.id=this.groupCategories=this.extent=this.description=this.culture=this.created=this.classification=
this.categories=this.avgRating=this.applicationProxies=this.apiKey=this.accessInformation=this.access=null;this.isOrgItem=!1;this.url=this.typeKeywords=this.type=this.title=this.tags=this.spatialReference=this.sourceUrl=this.sourceJSON=this.snippet=this.size=this.screenshots=this.portal=this.ownerFolder=this.owner=this.numViews=this.numRatings=this.numComments=this.name=this.modified=this.licenseInfo=this.itemControl=null}destroy(){this.portal=null}get displayName(){const u=this.type,v=this.typeKeywords||
[];let A=u;"Feature Service"===u||"Feature Collection"===u?A=v.includes("Table")?"Table":v.includes("Route Layer")?"Route Layer":v.includes("Markup")?"Markup":"Feature Layer":"Image Service"===u?A=v.includes("Elevation 3D Layer")?"Elevation Layer":v.includes("Tiled Imagery")?"Tiled Imagery Layer":"Imagery Layer":"Scene Service"===u?A="Scene Layer":"Video Service"===u?A="Video Layer":"Scene Package"===u?A="Scene Layer Package":"Stream Service"===u?A="Feature Layer":"Geoprocessing Service"===u?A=v.includes("Web Tool")?
"Tool":"Geoprocessing Service":"Geoenrichment Service"===u?A="GeoEnrichment Service":"Geocoding Service"===u?A="Locator":"Microsoft Powerpoint"===u?A="Microsoft PowerPoint":"GeoJson"===u?A="GeoJSON":"Globe Service"===u?A="Globe Layer":"Vector Tile Service"===u?A="Tile Layer":"netCDF"===u?A="NetCDF":"Map Service"===u?A=v.includes("Spatiotemporal")||!v.includes("Hosted Service")&&!v.includes("Tiled")||v.includes("Relational")?"Map Image Layer":"Tile Layer":u?.toLowerCase().includes("add in")?A=u.replaceAll(/(add in)/gi,
"Add-In"):"datastore catalog service"===u?A="Big Data File Share":"Compact Tile Package"===u?A="Tile Package (tpkx)":"Raster function template"===u?A="Raster Function Template":"OGCFeatureServer"===u?A="OGC Feature Layer":"web mapping application"===u&&v.includes("configurableApp")?A="Instant App":"Insights Page"===u?A="Insights Report":"Excalibur Imagery Project"===u?A="Excalibur Project":"3DTiles Service"===u?A="3D tiles layer":"3DTiles Package"===u&&(A="3D tiles package");return A}readExtent(u){return u&&
u.length?new x(u[0][0],u[0][1],u[1][0],u[1][1]):null}get iconUrl(){var u=this.type?.toLowerCase()||"";const v=this.typeKeywords||[];var A=!1,B=!1;let F=!1,H=!1,J=!1,E=!1;A=B=!1;0<u.indexOf("service")||"feature collection"===u||"kml"===u||"wms"===u||"wmts"===u||"wfs"===u?(A=v.includes("Hosted Service"),"feature service"===u||"feature collection"===u||"kml"===u||"wfs"===u?(B=v.includes("Table"),F=v.includes("Route Layer"),H=v.includes("Markup"),J=v.includes("Spatiotemporal"),E=v.includes("UtilityNetwork"),
u=J&&B?"spatiotemporaltable":B?"table":F?"routelayer":H?"markup":J?"spatiotemporal":E?"utilitynetwork":A?"featureshosted":"features"):"map service"===u||"wms"===u||"wmts"===u?(J=v.includes("Spatiotemporal"),B=v.includes("Relational"),u=J||B?"mapimages":A||v.includes("Tiled")||"wmts"===u?"maptiles":"mapimages"):u="scene service"===u?v.includes("Line")?"sceneweblayerline":v.includes("3DObject")?"sceneweblayermultipatch":v.includes("Point")?"sceneweblayerpoint":v.includes("IntegratedMesh")?"sceneweblayermesh":
v.includes("PointCloud")?"sceneweblayerpointcloud":v.includes("Polygon")?"sceneweblayerpolygon":v.includes("Building")?"sceneweblayerbuilding":v.includes("Voxel")?"sceneweblayervoxel":"sceneweblayer":"image service"===u?v.includes("Elevation 3D Layer")?"elevationlayer":v.includes("Tiled Imagery")?"tiledimagerylayer":"imagery":"stream service"===u?"streamlayer":"vector tile service"===u?"vectortile":"datastore catalog service"===u?"datastorecollection":"geocoding service"===u?"geocodeservice":"video service"===
u?v.includes("Live Stream")?"livestreamvideolayer":"videolayer":"geoprocessing service"===u?v.includes("Web Tool")?"tool":"layers":"geodata service"===u?"geodataservice":"3dtiles service"===u?v.includes("3DObject")?"3dobjecttileslayer":v.includes("IntegratedMesh")?"integratedmeshtileslayer":"3dtileslayer":"layers"):u="web map"===u||"cityengine web scene"===u?"maps":"web scene"===u?v.includes("ViewingMode-Local")?"webscenelocal":"websceneglobal":"web mapping application"===u&&v.includes("configurableApp")?
"instantapps":"web mapping application"===u||"mobile application"===u||"application"===u||"operation view"===u||"desktop application"===u?"apps":"map document"===u||"map package"===u||"published map"===u||"scene document"===u||"globe document"===u||"basemap package"===u||"mobile basemap package"===u||"mobile map package"===u||"project package"===u||"project template"===u||"pro map"===u||"layout"===u||"layer"===u&&v.includes("ArcGIS Pro")||"explorer map"===u&&v.indexOf("Explorer Document")?"mapsgray":
"service definition"===u||"shapefile"===u||"cad drawing"===u||"geojson"===u||"netcdf"===u||"administrative report"===u?"datafiles":"360 vr experience"===u?"360vr":"explorer add in"===u||"desktop add in"===u||"windows viewer add in"===u||"windows viewer configuration"===u?"appsgray":"arcgis pro add in"===u||"arcgis pro configuration"===u?"addindesktop":"pdf"===u?"pdf":"microsoft word"===u?"word":"microsoft excel"===u?"excel":"microsoft powerpoint"===u?"ppt":"rule package"===u||"file geodatabase"===
u||"sqlite geodatabase"===u||"csv collection"===u||"kml collection"===u||"windows mobile package"===u||"map template"===u||"desktop application template"===u||"gml"===u||"arcpad package"===u||"code sample"===u||"document link"===u||"earth configuration"===u||"operations dashboard add in"===u||"rules package"===u||"workflow manager package"===u||"explorer map"===u&&v.includes("Explorer Mapping Application")||v.includes("Document")?"datafilesgray":"network analysis service"===u||"geoprocessing service"===
u||"geodata service"===u||"geometry service"===u||"geoprocessing package"===u||"locator package"===u||"geoprocessing sample"===u||"workflow manager service"===u?"toolsgray":"layer"===u||"layer package"===u||"explorer layer"===u?"layersgray":"analysis model"===u?"analysismodel":"scene package"===u?"scenepackage":"3dtiles package"===u?"3dtileslayerpackage":"3dtiles service"===u?"3dtileslayer":"mobile scene package"===u?"mobilescenepackage":"tile package"===u||"compact tile package"===u?"tilepackage":
"task file"===u?"taskfile":"report template"===u?"report-template":"statistical data collection"===u?"statisticaldatacollection":"insights workbook"===u?"workbook":"insights model"===u?"insightsmodel":"insights page"===u?"insightspage":"insights theme"===u?"insightstheme":"hub initiative"===u?"hubinitiative":"hub page"===u?"hubpage":"hub site application"===u?"hubsite":"hub event"===u?"hubevent":"hub project"===u?"hubproject":"relational database connection"===u?"relationaldatabaseconnection":"big data file share"===
u?"datastorecollection":"image collection"===u?"imagecollection":"desktop style"===u?"desktopstyle":"style"===u?v.includes("Dictionary")?"dictionarystyle":"style":"dashboard"===u?"dashboard":"raster function template"===u?"rasterprocessingtemplate":"vector tile package"===u?"vectortilepackage":"ortho mapping project"===u?"orthomappingproject":"ortho mapping template"===u?"orthomappingtemplate":"solution"===u?"solutions":"geopackage"===u?"geopackage":"deep learning package"===u?"deeplearningpackage":
"real time analytic"===u?"realtimeanalytics":"reality mapping project"===u?"realitymappingproject":"big data analytic"===u?"bigdataanalytics":"feed"===u?"feed":"excalibur imagery project"===u?"excaliburimageryproject":"notebook"===u?"notebook":"storymap"===u?"storymap":"survey123 add in"===u?"survey123addin":"mission"===u?"mission":"mission report"===u?"missionreport":"mission template"===u?"missiontemplate":"quickcapture project"===u?"quickcaptureproject":"pro report"===u?"proreport":"pro report template"===
u?"proreporttemplate":"urban model"===u?"urbanmodel":"urban project"===u?"urbanproject":"web experience"===u?"experiencebuilder":"web experience template"===u?"webexperiencetemplate":"experience builder widget"===u?"experiencebuilderwidget":"experience builder widget package"===u?"experiencebuilderwidgetpackage":"workflow"===u?"workflow":"kernel gateway connection"===u?"kernelgatewayconnection":"insights script"===u?"insightsscript":"hub initiative template"===u?"hubinitiativetemplate":"storymap theme"===
u?"storymaptheme":"knowledge graph"===u?"knowledgegraph":"knowledge graph layer"===u?"knowledgegraphlayer":"knowledge studio project"===u?"knowledgestudio":"native application"===u?"nativeapp":"native application installer"===u?"nativeappinstaller":"web link chart"===u?"linkchart":"knowledge graph web investigation"===u?"investigation":"ogcfeatureserver"===u?"features":"pro presentation"===u?"propresentation":"pro project"===u?"proproject":"insights workbook package"===u?"insightsworkbookpackage":
"apache parquet"===u?"apacheparquet":"notebook code snippet library"===u?"notebookcodesnippets":"suitability model"===u?"suitabilitymodel":"esri classifier definition"===u?"classifierdefinition":"esri classification schema"===u?"classificationschema":"insights data engineering workbook"===u?"dataengineeringworkbook":"insights data engineering model"===u?"dataengineeringmodel":"deep learning studio project"===u?"deeplearningproject":"discussion"===u?"discussion":"allsource project"===u?"allsourceproject":
"api key"===u?"apikey":"data pipeline"===u?"datapipelines":"group layer"===u?(A=v.includes("Map"))?"layergroup2d":"layergroup":"media layer"===u?"onlinemedialayer":"form"===u?v.includes("Survey123")?"survey":"datafilesgray":"csv"===u?"csv":"image"===u?"image":"maps";return u?n.getAssetUrl("esri/images/portal/"+u+"16.png"):null}get isLayer(){return null!=this.type&&y.has(this.type)}get itemCdnUrl(){return w.toCDNUrl(this.itemUrl)}get itemPageUrl(){const u=this.portal?.itemPageUrl;return u&&this.id?
`${u}?id=${this.id}`:null}get itemUrl(){const u=this.portal?.restUrl;return u&&this.id?`${u}/content/items/${this.id}`:null}get thumbnailUrl(){const u=this.itemUrl,v=this.thumbnail;return u&&v?this.portal?.normalizeUrl(`${u}/info/${v}?f=json`)??null:null}get userItemUrl(){const u=this.portal?.restUrl;if(!u)return null;const v=this.owner||this.portal?.user?.username;return v?`${u}/content/users/${this.ownerFolder?`${v}/${this.ownerFolder}`:v}/items/${this.id}`:null}load(u){const v=this.portal??(this.portal=
m.getDefault()),A=v.load(u).then(()=>this.sourceJSON?this.sourceJSON:this.id&&this.itemUrl?v.request(this.itemUrl,{signal:null!=u?u.signal:null,query:{token:this.apiKey}}):{}).then(B=>{this.sourceJSON=B;this.read(B)});this.addResolvingPromise(A);return Promise.resolve(this)}async addRating(u){const v={method:"post",query:{}};u instanceof t&&(u=u.rating);null==u||isNaN(u)||"number"!==typeof u||(v.query.rating=u);if(!this.portal)return null;await this.portal.request(this.itemUrl+"/addRating",v);return new t({rating:u,
created:new Date})}clone(){var u={access:this.access,accessInformation:this.accessInformation,applicationProxies:l.clone(this.applicationProxies),avgRating:this.avgRating,categories:l.clone(this.categories),classification:l.clone(this.classification),created:l.clone(this.created),culture:this.culture,description:this.description,extent:l.clone(this.extent),groupCategories:l.clone(this.groupCategories),id:this.id,itemControl:this.itemControl,licenseInfo:this.licenseInfo,modified:l.clone(this.modified),
name:this.name,numComments:this.numComments,numRatings:this.numRatings,numViews:this.numViews,owner:this.owner,ownerFolder:this.ownerFolder,portal:this.portal,screenshots:l.clone(this.screenshots),size:this.size,snippet:this.snippet,sourceUrl:this.sourceUrl,spatialReference:this.spatialReference,tags:l.clone(this.tags),thumbnail:this.thumbnail,title:this.title,type:this.type,typeKeywords:l.clone(this.typeKeywords),url:this.url};this.loaded&&(u.loadStatus="loaded");u=(new r({sourceJSON:this.sourceJSON})).set(u);
u._set("isOrgItem",this.isOrgItem);return u}createPostQuery(){const u=this.toJSON();for(var v of["tags","typeKeywords","categories"])u[v]=u[v]?.join(", ");for(const A of["extent","classification"])(v=u[A])&&(u[A]=JSON.stringify(v));return u}async deleteRating(){await this.portal.request(this.itemUrl+"/deleteRating",{method:"post"})}fetchData(u="json",v){return this.portal.request(this.itemUrl+"/data",{responseType:u,...v,query:{token:this.apiKey}})}async fetchRating(u){u=await this.portal.request(this.itemUrl+
"/rating",{query:{token:this.apiKey},...u});return null!=u.rating?(u.created=new Date(u.created),new t(u)):null}fetchRelatedItems(u,v){return this.portal.requestToTypedArray(this.itemUrl+"/relatedItems",{query:{...u,token:this.apiKey},...v},r)}getThumbnailUrl(u){let v=this.thumbnailUrl;v&&u&&(v+=`&w=${u}`);return v}reload(){return this.portal.request(this.itemUrl??"",{cacheBust:!0,query:{token:this.apiKey}}).then(u=>{this.applicationProxies&&!Object.hasOwn(u,"appProxies")&&(this.applicationProxies=
null);this.sourceJSON=u;this.read(u);return this})}update(u){return this.id?this.load().then(()=>this.portal.signIn()).then(()=>{const v=u?.data,A={method:"post"};A.query=this.createPostQuery();for(const B in A.query)null===A.query[B]&&(A.query[B]="");A.query.clearEmptyFields=!0;null!=v&&("string"===typeof v?A.query.text=v:"object"===typeof v&&(A.query.text=JSON.stringify(v)));return this.portal.request(`${this.userItemUrl}/update`,A).then(()=>this.reload())}):Promise.reject(new g("portal:item-does-not-exist",
"The item does not exist yet and cannot be updated"))}async copy(u){if(!this.id)throw new g("portal:item-does-not-exist","The item does not exist yet");await this.load();const {portal:v,itemUrl:A}=this;await v.signIn();const {copyResources:B,folder:F,tags:H,title:J}=u||{};u={method:"post",query:{copyPrivateResources:"all"===B,folder:"string"===typeof F?F:F?.id,includeResources:!!B,tags:H?.join(","),title:J}};({itemId:u}=await v.request(`${A}/copy`,u));return new r({id:u,portal:v})}updateThumbnail(u){return this.id?
this.load().then(()=>this.portal.signIn()).then(()=>{const v=u.thumbnail,A=u.filename,B={method:"post"};if("string"===typeof v)f.isDataProtocol(v)?B.query={data:v}:B.query={url:f.makeAbsolute(v)},null!=A&&(B.query.filename=A);else{const F=new FormData;null!=A?F.append("file",v,A):F.append("file",v);B.body=F}return this.portal.request(`${this.userItemUrl}/updateThumbnail`,B).then(()=>this.reload())}):Promise.reject(new g("portal:item-does-not-exist","The item does not exist yet and cannot be updated"))}async fetchResources(u=
{},v){const {fetchResources:A}=await new Promise((B,F)=>b(["./support/resourceUtils"],B,F));return A(this,u,v)}async addResource(u,v,A){const {addOrUpdateResources:B}=await new Promise((F,H)=>b(["./support/resourceUtils"],F,H));u.portalItem=this;await B(this,[{resource:u,content:v,compress:A?.compress,access:A?.access}],"add",A);return u}async removeResource(u,v){const {removeResource:A}=await new Promise((B,F)=>b(["./support/resourceUtils"],B,F));if(u.portalItem&&u.portalItem.itemUrl!==this.itemUrl)throw new g("removeresource:portal-item-mismatch",
"The portal item associated with the provided resource does not match the item");return A(this,u,v)}async removeAllResources(u){const {removeAllResources:v}=await new Promise((A,B)=>b(["./support/resourceUtils"],A,B));return v(this,u)}resourceFromPath(u){return new p({portalItem:this,path:u})}toJSON(){var u=this.extent;u={accessInformation:this.accessInformation,categories:l.clone(this.categories),classification:l.clone(this.classification),created:this.created?.getTime(),description:this.description,
extent:u&&[[u.xmin,u.ymin],[u.xmax,u.ymax]],id:this.id,isOrgItem:this.isOrgItem,licenseInfo:this.licenseInfo,modified:this.modified?.getTime(),name:this.name,owner:this.owner,ownerFolder:this.ownerFolder,snippet:this.snippet,sourceUrl:this.sourceUrl,spatialReference:this.spatialReference,tags:l.clone(this.tags),thumbnail:this.thumbnail,title:this.title,type:this.type,typeKeywords:l.clone(this.typeKeywords),url:this.url};return l.fixJson(u)}static fromJSON(u){if(!u)return null;if(u.declaredClass)throw Error("JSON object is already hydrated");
return new r({sourceJSON:u})}_getPostQuery(){const u=this.toJSON();for(const v in u)"tags"===v&&null!==u[v]&&(u[v]=u[v].join(", ")),"typeKeywords"===v&&null!==u[v]&&(u[v]=u[v].join(", ")),"extent"===v&&u[v]&&(u[v]=JSON.stringify(u[v]));return u}};q.__decorate([d.property({type:["private","shared","org","public"]})],k.prototype,"access",void 0);q.__decorate([d.property()],k.prototype,"accessInformation",void 0);q.__decorate([d.property({type:String})],k.prototype,"apiKey",void 0);q.__decorate([d.property({json:{read:{source:"appProxies"}}})],
k.prototype,"applicationProxies",void 0);q.__decorate([d.property()],k.prototype,"avgRating",void 0);q.__decorate([d.property()],k.prototype,"categories",void 0);q.__decorate([d.property()],k.prototype,"classification",void 0);q.__decorate([d.property({type:Date})],k.prototype,"created",void 0);q.__decorate([d.property()],k.prototype,"culture",void 0);q.__decorate([d.property()],k.prototype,"description",void 0);q.__decorate([d.property({readOnly:!0})],k.prototype,"displayName",null);q.__decorate([d.property({type:x})],
k.prototype,"extent",void 0);q.__decorate([e.reader("extent")],k.prototype,"readExtent",null);q.__decorate([d.property()],k.prototype,"groupCategories",void 0);q.__decorate([d.property({readOnly:!0})],k.prototype,"iconUrl",null);q.__decorate([d.property()],k.prototype,"id",void 0);q.__decorate([d.property({readOnly:!0})],k.prototype,"isLayer",null);q.__decorate([d.property({type:Boolean,readOnly:!0})],k.prototype,"isOrgItem",void 0);q.__decorate([d.property()],k.prototype,"itemControl",void 0);q.__decorate([d.property({readOnly:!0})],
k.prototype,"itemPageUrl",null);q.__decorate([d.property({readOnly:!0})],k.prototype,"itemUrl",null);q.__decorate([d.property()],k.prototype,"licenseInfo",void 0);q.__decorate([d.property({type:Date})],k.prototype,"modified",void 0);q.__decorate([d.property()],k.prototype,"name",void 0);q.__decorate([d.property()],k.prototype,"numComments",void 0);q.__decorate([d.property()],k.prototype,"numRatings",void 0);q.__decorate([d.property()],k.prototype,"numViews",void 0);q.__decorate([d.property()],k.prototype,
"owner",void 0);q.__decorate([d.property()],k.prototype,"ownerFolder",void 0);q.__decorate([d.property({type:m})],k.prototype,"portal",void 0);q.__decorate([d.property()],k.prototype,"screenshots",void 0);q.__decorate([d.property()],k.prototype,"size",void 0);q.__decorate([d.property()],k.prototype,"snippet",void 0);q.__decorate([d.property()],k.prototype,"sourceJSON",void 0);q.__decorate([d.property({type:String})],k.prototype,"sourceUrl",void 0);q.__decorate([d.property({type:String})],k.prototype,
"spatialReference",void 0);q.__decorate([d.property()],k.prototype,"tags",void 0);q.__decorate([d.property()],k.prototype,"thumbnail",void 0);q.__decorate([d.property({readOnly:!0})],k.prototype,"thumbnailUrl",null);q.__decorate([d.property()],k.prototype,"title",void 0);q.__decorate([d.property()],k.prototype,"type",void 0);q.__decorate([d.property()],k.prototype,"typeKeywords",void 0);q.__decorate([d.property({type:String,json:{read(u,v){z.has(v.type)&&(v=this.portal?.restUrl,u||=v&&this.id?`${v}/content/items/${this.id}/data`:
null);return u}}})],k.prototype,"url",void 0);q.__decorate([d.property({readOnly:!0})],k.prototype,"userItemUrl",null);return k=r=q.__decorate([h.subclass("esri.portal.PortalItem")],k)})},"esri/portal/PortalItemResource":function(){define("require ../chunks/tslib.es6 ../core/Accessor ../core/Error ../core/Logger ../core/urlUtils ../core/accessorSupport/decorators/property ../core/accessorSupport/decorators/cast ../core/RandomLCG ../core/has ../core/accessorSupport/decorators/subclass".split(" "),
function(b,q,n,g,k,l,a,f,d,c,e){function h(x,m){if(null==x)return x;x=x.replace(/^\/+/,"");null!=m&&l.isAbsolute(x)&&(x=l.makeRelative(x,m.itemUrl));return x?.replace(/^\/+/,"").replace(/^(\.\/)?resources\//,"")}n=class extends n{constructor(x){super(x);this.portalItem=null}normalizeCtorArgs(x){return x?.portalItem&&x.path?{...x,path:h(x.path,x.portalItem)}:x}set path(x){null!=x&&l.isAbsolute(x)?k.getLogger(this).error("portalitemresource:invalid-path","A portal item resource path must be relative"):
this._set("path",x)}_castPath(x){return h(x,this.portalItem)}get url(){return this.portalItem&&this.path?`${this.portalItem.itemUrl}/resources/${this.path}`:null}get cdnUrl(){return this.portalItem&&this.path?`${this.portalItem.itemCdnUrl}/resources/${this.path}`:null}get itemRelativeUrl(){return this.portalItem&&this.path?`./resources/${this.path}`:null}fetch(x="json",m){const p=this.cdnUrl;if(null==p)throw new g("portal-item-resource:fetch","Portal item resource does not refer to a valid item or path");
return this.portalItem.portal.request(p,{responseType:x,query:{token:this.portalItem.apiKey,_ts:m?.cacheBust?Date.now():null},signal:m?.signal})}async update(x,m){const {addOrUpdateResources:p}=await new Promise((t,w)=>b(["./support/resourceUtils"],t,w));await p(this.portalItem,[{resource:this,content:x,compress:m?.compress,access:m?.access}],"update",m);return this}hasPath(){return null!=this.path}};q.__decorate([a.property()],n.prototype,"portalItem",void 0);q.__decorate([a.property({type:String,
value:null})],n.prototype,"path",null);q.__decorate([f.cast("path")],n.prototype,"_castPath",null);q.__decorate([a.property({type:String,readOnly:!0})],n.prototype,"url",null);q.__decorate([a.property({type:String,readOnly:!0})],n.prototype,"cdnUrl",null);q.__decorate([a.property({type:String,readOnly:!0})],n.prototype,"itemRelativeUrl",null);return n=q.__decorate([e.subclass("esri.portal.PortalItemResource")],n)})},"esri/portal/PortalRating":function(){define("../chunks/tslib.es6 ../core/Accessor ../core/accessorSupport/decorators/property ../core/has ../core/Logger ../core/RandomLCG ../core/accessorSupport/decorators/subclass".split(" "),
function(b,q,n,g,k,l,a){q=class extends q{constructor(f){super(f);this.rating=this.created=null}};b.__decorate([n.property()],q.prototype,"created",void 0);b.__decorate([n.property()],q.prototype,"rating",void 0);return q=b.__decorate([a.subclass("esri.portal.PortalRating")],q)})},"esri/chunks/persistableUrlUtils":function(){define(["exports","../kernel","../core/urlUtils","../portal/support/urlUtils"],function(b,q,n,g){function k(r,y){var z=y?.url?.path;r&&z&&(r=n.makeAbsolute(r,z,{preserveProtocolRelative:!0}),
y.portalItem&&y.readResourcePaths&&(z=n.makeRelative(r,y.portalItem.itemUrl),null!=z&&t.test(z)&&y.readResourcePaths.push(y.portalItem.resourceFromPath(z).path)));return(r=h(r,y?.portal))&&p.test(r)?x(r):r}function l(r,y,z=b.MarkKeep.YES){r=r&&p.test(r)?m(r):r;if(null==r)return r;!n.isAbsolute(r)&&y?.blockedRelativeUrls&&y.blockedRelativeUrls.push(r);let u=n.makeAbsolute(r);if(y){var v=y.verifyItemRelativeUrls?.rootPath||y.url?.path;if(v){v=h(v,y.portal);const A=h(u,y.portal);u=n.makeRelative(A,v,
v);null!=u&&u!==A&&u!==r&&y.verifyItemRelativeUrls&&y.verifyItemRelativeUrls.writtenUrls.push(u)}}u=e(u,y?.portal);n.isAbsolute(u)&&(u=n.normalize(u));y?.resources&&y?.portalItem&&!n.isAbsolute(u)&&!n.isDataProtocol(u)&&z===b.MarkKeep.YES&&y.resources.toKeep.push({resource:y.portalItem.resourceFromPath(u),compress:!1});return u}function a(r,y,z){return k(r,z)}function f(r,y,z,u){r=l(r,u);void 0!==r&&(y[z]=r)}function d(r){return(r?.match(p)??null)?.[1]??null}function c(r){r=r?.match(p)??null;if(null==
r)return null;r=r[2];const y=r.lastIndexOf("/");if(-1===y){const {path:v,extension:A}=n.splitPathExtension(r);return{prefix:null,filename:v,extension:A}}const {path:z,extension:u}=n.splitPathExtension(r.slice(y+1));return{prefix:r.slice(0,y),filename:z,extension:u}}function e(r,y){return y&&!y.isPortal&&y.urlKey&&y.customBaseUrl?n.changeDomain(r,`${y.urlKey}.${y.customBaseUrl}`,y.portalHostname):r}function h(r,y){if(!y||y.isPortal||!y.urlKey||!y.customBaseUrl)return r;const z=`${y.urlKey}.${y.customBaseUrl}`,
u=n.getAppUrl();return n.hasSameOrigin(u,`${u.scheme}://${z}`)?n.changeDomain(r,y.portalHostname,z):n.changeDomain(r,z,y.portalHostname)}function x(r){if(!r)return r||null;r&&q.id&&!q.id.findCredential(r)&&(r=g.normalizeArcGISOnlineOrgDomain(r),r=r.replace(/^https?:\/\/www\.arcgis\.com/,"https://cdn.arcgis.com"),r=r.replace(/^https?:\/\/devext\.arcgis\.com/,"https://cdndev.arcgis.com"),r=r.replace(/^https?:\/\/qaext\.arcgis\.com/,"https://cdnqa.arcgis.com"));return r}function m(r){if(!r)return r||
null;r=r.replace(/^https?:\/\/cdn\.arcgis\.com/,"https://www.arcgis.com");r=r.replace(/^https?:\/\/cdndev\.arcgis\.com/,"https://devext.arcgis.com");(r=r.replace(/^https?:\/\/cdnqa\.arcgis\.com/,"https://qaext.arcgis.com"))&&q.id&&!q.id.findCredential(r)&&(r=g.normalizeArcGISOnlineOrgDomain(r));return r}const p=/\/items\/([^/]+)\/resources\/(.*)/,t=/^\.\/resources\//;b.MarkKeep=void 0;(function(r){r[r.YES=0]="YES";r[r.NO=1]="NO"})(b.MarkKeep||(b.MarkKeep={}));const w=Object.freeze(Object.defineProperty({__proto__:null,
get MarkKeep(){return b.MarkKeep},ensureMainOnlineDomain:e,fromCDNUrl:m,fromJSON:k,itemIdFromResourceUrl:d,prefixAndFilenameFromResourceUrl:c,read:a,toCDNUrl:x,toJSON:l,write:f},Symbol.toStringTag,{value:"Module"}));b.ensureMainOnlineDomain=e;b.fromCDNUrl=m;b.fromJSON=k;b.itemIdFromResourceUrl=d;b.persistableUrlUtils=w;b.prefixAndFilenameFromResourceUrl=c;b.read=a;b.toCDNUrl=x;b.toJSON=l;b.write=f})},"esri/support/basemapDefinitions":function(){define(["exports","../assets","../intl/messages"],function(b,
q,n){b.esriBasemapDefinitions={satellite:{id:"satellite",classic:!0,get thumbnailUrl(){return q.getAssetUrl("esri/images/basemap/satellite.jpg")},baseMapLayers:[{id:"satellite-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Imagery",showLegend:!1,visibility:!0,opacity:1}]},hybrid:{id:"hybrid",classic:!0,get thumbnailUrl(){return q.getAssetUrl("esri/images/basemap/hybrid.jpg")},baseMapLayers:[{id:"hybrid-base-layer",
url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Imagery",showLegend:!1,visibility:!0,opacity:1},{id:"hybrid-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/30d6b8271e1849cd9c3042060001f425/resources/styles/root.json",layerType:"VectorTileLayer",title:"Hybrid Reference Layer",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},terrain:{id:"terrain",classic:!0,get thumbnailUrl(){return q.getAssetUrl("esri/images/basemap/terrain.jpg")},
baseMapLayers:[{id:"terrain-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Terrain_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Terrain Base",showLegend:!1,visibility:!0,opacity:1},{id:"terrain-reference-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Reference/World_Reference_Overlay/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Reference Overlay",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},oceans:{id:"oceans",
classic:!0,get thumbnailUrl(){return q.getAssetUrl("esri/images/basemap/oceans.jpg")},baseMapLayers:[{id:"oceans-base-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Ocean Base",showLegend:!1,visibility:!0,opacity:1},{id:"oceans-reference-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Reference/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Ocean Reference",
isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},osm:{id:"osm",classic:!0,get thumbnailUrl(){return q.getAssetUrl("esri/images/basemap/osm.jpg")},baseMapLayers:[{id:"osm-base-layer",layerType:"OpenStreetMap",title:"Open Street Map",showLegend:!1,visibility:!0,opacity:1}]},"dark-gray-vector":{id:"dark-gray-vector",classic:!0,get thumbnailUrl(){return q.getAssetUrl("esri/images/basemap/dark-gray-vector.jpg")},baseMapLayers:[{id:"dark-gray-base-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/5e9b3685f4c24d8781073dd928ebda50/resources/styles/root.json",
layerType:"VectorTileLayer",title:"Dark Gray Base",visibility:!0,opacity:1},{id:"dark-gray-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/747cb7a5329c478cbe6981076cc879c5/resources/styles/root.json",layerType:"VectorTileLayer",title:"Dark Gray Reference",isReference:!0,visibility:!0,opacity:1}]},get "dark-gray"(){return{...this["dark-gray-vector"],id:"dark-gray"}},"gray-vector":{id:"gray-vector",classic:!0,get thumbnailUrl(){return q.getAssetUrl("esri/images/basemap/gray-vector.jpg")},
baseMapLayers:[{id:"gray-base-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/291da5eab3a0412593b66d384379f89f/resources/styles/root.json",layerType:"VectorTileLayer",title:"Light Gray Base",visibility:!0,opacity:1},{id:"gray-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/1768e8369a214dfab4e2167d5c5f2454/resources/styles/root.json",layerType:"VectorTileLayer",title:"Light Gray Reference",isReference:!0,visibility:!0,opacity:1}]},get gray(){return{...this["gray-vector"],
id:"gray"}},"streets-vector":{id:"streets-vector",classic:!0,get thumbnailUrl(){return q.getAssetUrl("esri/images/basemap/streets-vector.jpg")},baseMapLayers:[{id:"streets-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/de26a3cf4cc9451298ea173c4b324736/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets",visibility:!0,opacity:1}]},get streets(){return{...this["streets-vector"],id:"streets"}},"topo-vector":{id:"topo-vector",classic:!0,get thumbnailUrl(){return q.getAssetUrl("esri/images/basemap/topo-vector.jpg")},
baseMapLayers:[{id:"world-hillshade-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Hillshade",showLegend:!1,visibility:!0,opacity:1},{id:"topo-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/7dc6cea0b1764a1f9af2e679f642f0f5/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Topo",visibility:!0,opacity:1}]},get topo(){return{...this["topo-vector"],id:"topo"}},
"streets-night-vector":{id:"streets-night-vector",classic:!0,get thumbnailUrl(){return q.getAssetUrl("esri/images/basemap/streets-night.jpg")},baseMapLayers:[{id:"streets-night-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/86f556a2d1fd468181855a35e344567f/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets Night",visibility:!0,opacity:1}]},"streets-relief-vector":{id:"streets-relief-vector",classic:!0,get thumbnailUrl(){return q.getAssetUrl("esri/images/basemap/streets-relief.jpg")},
baseMapLayers:[{id:"world-hillshade-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Hillshade",showLegend:!1,visibility:!0,opacity:1},{id:"streets-relief-vector-base-layer",styleUrl:"//www.arcgis.com/sharing/rest/content/items/b266e6d17fc345b498345613930fbd76/resources/styles/root.json",title:"World Streets Relief",layerType:"VectorTileLayer",visibility:!0,opacity:1}]},"streets-navigation-vector":{id:"streets-navigation-vector",
classic:!0,get thumbnailUrl(){return q.getAssetUrl("esri/images/basemap/streets-navigation.jpg")},baseMapLayers:[{id:"streets-navigation-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/63c47b7177f946b49902c24129b87252/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets Navigation",visibility:!0,opacity:1}]},"topo-3d":{id:"topo-3d",is3d:!0,get thumbnailUrl(){return q.getAssetUrl("esri/images/basemap/topo-3d.png")},baseMapLayers:[{id:"topo-3d-base-layer",
styleUrl:"https://www.arcgis.com/sharing/rest/content/items/1e7d1784d1ef4b79ba6764d0bd6c3150/resources/styles/root.json",layerType:"VectorTileLayer",title:"Topographic",visibility:!0,opacity:1},{id:"topo-3d-trees",title:"Trees",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Trees_Thematic_v1/SceneServer",itemId:"f75fef56b2d944fe92ef9f7737b4f953",layerType:"ArcGISSceneServiceLayer"},{id:"topo-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_DarkLabels_v1/SceneServer",
itemId:"a84404ad39c64c328d0596e361ec459b",layerType:"ArcGISSceneServiceLayer"},{id:"topo-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"navigation-3d":{id:"navigation-3d",is3d:!0,get thumbnailUrl(){return q.getAssetUrl("esri/images/basemap/navigation-3d.jpg")},baseMapLayers:[{id:"navigation-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/ccc904ff872b4144b94934e55e32784b/resources/styles/root.json",
layerType:"VectorTileLayer",title:"Navigation",visibility:!0,opacity:1},{id:"navigation-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_DarkLabels_v1/SceneServer",itemId:"a84404ad39c64c328d0596e361ec459b",layerType:"ArcGISSceneServiceLayer"},{id:"navigation-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",
layerType:"ArcGISSceneServiceLayer"}]},"streets-3d":{id:"streets-3d",is3d:!0,get thumbnailUrl(){return q.getAssetUrl("esri/images/basemap/streets-3d.png")},baseMapLayers:[{id:"streets-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/198298c4c64c4cb19de5b46aa00c198d/resources/styles/root.json",layerType:"VectorTileLayer",title:"Streets",visibility:!0,opacity:1},{id:"streets-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_DarkLabels_v1/SceneServer",
itemId:"a84404ad39c64c328d0596e361ec459b",layerType:"ArcGISSceneServiceLayer"},{id:"streets-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"osm-3d":{id:"osm-3d",is3d:!0,get thumbnailUrl(){return q.getAssetUrl("esri/images/basemap/osm-3d.png")},baseMapLayers:[{id:"osm-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/8628d259c9d14bdc848771c23c513940/resources/styles/root.json",
layerType:"VectorTileLayer",title:"OpenStreetMap",visibility:!0,opacity:1},{id:"osm-3d-trees",title:"Trees",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Trees_Thematic_v1/SceneServer",itemId:"f75fef56b2d944fe92ef9f7737b4f953",layerType:"ArcGISSceneServiceLayer"},{id:"osm-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_DarkLabels_v1/SceneServer",itemId:"a84404ad39c64c328d0596e361ec459b",layerType:"ArcGISSceneServiceLayer"},
{id:"osm-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"gray-3d":{id:"gray-3d",is3d:!0,get thumbnailUrl(){return q.getAssetUrl("esri/images/basemap/gray-3d.png")},baseMapLayers:[{id:"gray-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/01a14b466345455ba4176d2e6390db92/resources/styles/root.json",layerType:"VectorTileLayer",
title:"Streets",visibility:!0,opacity:1},{id:"gray-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_DarkLabels_v1/SceneServer",itemId:"a84404ad39c64c328d0596e361ec459b",layerType:"ArcGISSceneServiceLayer"},{id:"gray-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"navigation-dark-3d":{id:"navigation-dark-3d",
itemId:"5a1365328b4943f09a54cf5fd1205707",is3d:!0,baseMapLayers:[{id:"navigation-dark-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/451a1777ab3f4bf095fae24a117439d9/resources/styles/root.json",layerType:"VectorTileLayer",title:"Navigation Dark"},{id:"navigation-dark-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_LightLabels_v1/SceneServer/layers/0",itemId:"f364b70b012a4da5a4b5921e193eac4a",layerType:"ArcGISSceneServiceLayer"},
{id:"navigation-dark-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"streets-dark-3d":{id:"streets-dark-3d",itemId:"8a4efa2c20484ec9b4557895e65736ff",is3d:!0,baseMapLayers:[{id:"streets-dark-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/bc599b6d741a4ac084b7eea7bf8c5938/resources/styles/root.json",layerType:"VectorTileLayer",
title:"OpenStreetMap Streets Night (for 3D)"},{id:"streets-dark-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_LightLabels_v1/SceneServer",itemId:"f364b70b012a4da5a4b5921e193eac4a",layerType:"ArcGISSceneServiceLayer"},{id:"streets-dark-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},
"dark-gray-3d":{id:"dark-gray-3d",itemId:"a8b7322a5fe94002bb0f5e0eeb0c5c18",is3d:!0,baseMapLayers:[{id:"dark-gray-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/4178f71acb934fb89f169e7d667c20c6/resources/styles/root.json",layerType:"VectorTileLayer",title:"OpenStreetMap Dark Gray Canvas (for 3D)"},{id:"dark-gray-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_LightLabels_v1/SceneServer/layers/0",itemId:"f364b70b012a4da5a4b5921e193eac4a",
layerType:"ArcGISSceneServiceLayer"},{id:"dark-gray-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"arcgis-imagery":{get thumbnailUrl(){return q.getAssetUrl("esri/images/basemap/hybrid.jpg")},title:"Imagery Hybrid",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Imagery",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/World_Imagery/MapServer"},
{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Imagery:Labels",title:"Hybrid Reference Layer",isReference:!0}]},"arcgis-imagery-standard":{get thumbnailUrl(){return q.getAssetUrl("esri/images/basemap/satellite.jpg")},title:"Imagery",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Imagery",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/World_Imagery/MapServer"}]},"arcgis-imagery-labels":{title:"Hybrid [Reference]",
baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Imagery:Labels",title:"Hybrid Reference Layer",isReference:!0}]},"arcgis-light-gray":{get thumbnailUrl(){return q.getAssetUrl("esri/images/basemap/gray-vector.jpg")},title:"Light Gray Canvas",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:LightGray:Base",title:"Light Gray Canvas Base"},{layerType:"VectorTileLayer",
styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:LightGray:Labels",title:"Light Gray Canvas Labels",isReference:!0}]},"arcgis-dark-gray":{get thumbnailUrl(){return q.getAssetUrl("esri/images/basemap/dark-gray.jpg")},title:"Dark Gray Canvas",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:DarkGray:Base",title:"Dark Gray Canvas Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:DarkGray:Labels",
title:"Dark Gray Canvas Labels",isReference:!0}]},"arcgis-navigation":{get thumbnailUrl(){return q.getAssetUrl("esri/images/basemap/streets-navigation.jpg")},title:"Navigation",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Navigation",title:"World Navigation Map"}]},"arcgis-navigation-night":{title:"Navigation (Dark Mode)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:NavigationNight",
title:"World Navigation Map (Dark Mode)"}]},"arcgis-streets":{get thumbnailUrl(){return q.getAssetUrl("esri/images/basemap/streets-vector.jpg")},title:"Streets",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Streets",title:"World Street Map"}]},"arcgis-streets-night":{get thumbnailUrl(){return q.getAssetUrl("esri/images/basemap/streets-night.jpg")},title:"Streets (Night)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:StreetsNight",
title:"World Street Map (Night)"}]},"arcgis-streets-relief":{get thumbnailUrl(){return q.getAssetUrl("esri/images/basemap/streets-relief.jpg")},title:"Streets (with Relief)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:StreetsRelief:Base",title:"World Street Map (with Relief)"}]},
"arcgis-topographic":{get thumbnailUrl(){return q.getAssetUrl("esri/images/basemap/topo.jpg")},title:"Topographic",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Topographic:Base",title:"World Topographic Map"}]},"arcgis-oceans":{get thumbnailUrl(){return q.getAssetUrl("esri/images/basemap/oceans.jpg")},
title:"Oceans",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Ocean Base",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Ocean/World_Ocean_Base/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Oceans:Labels",title:"World Ocean Reference",isReference:!0}]},"osm-standard":{title:"OpenStreetMap",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:Standard",
title:"OpenStreetMap"}]},"osm-standard-relief":{title:"OpenStreetMap (with relief)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:StandardRelief:Base",layerType:"VectorTileLayer",title:"OpenStreetMap Relief Base"}]},"osm-streets":{title:"OpenStreetMap (Streets)",baseMapLayers:[{layerType:"VectorTileLayer",
styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:Streets",title:"OpenStreetMap (Streets)"}]},"osm-streets-relief":{title:"OpenStreetMap (Streets with relief)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:StreetsRelief:Base",layerType:"VectorTileLayer",title:"OpenStreetMap Relief Base"}]},
"osm-light-gray":{title:"OpenStreetMap (Light Gray Canvas)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:LightGray:Base",title:"OSM (Light Gray Base)"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:LightGray:Labels",title:"OSM (Light Gray Reference)",isReference:!0}]},"osm-dark-gray":{title:"OpenStreetMap (Dark Gray Canvas)",baseMapLayers:[{layerType:"VectorTileLayer",
styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:DarkGray:Base",title:"OSM (Dark Gray Base)"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:DarkGray:Labels",title:"OSM (Dark Gray Reference)",isReference:!0}]},"arcgis-terrain":{title:"Terrain with Labels",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},
{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Terrain:Base",title:"World Terrain Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Terrain:Detail",title:"World Terrain Reference",isReference:!0}]},"arcgis-community":{title:"Community",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Community",title:"Community"}]},
"arcgis-charted-territory":{title:"Charted Territory",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:ChartedTerritory:Base",title:"Charted Territory"}]},"arcgis-colored-pencil":{title:"Colored Pencil",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:ColoredPencil",
title:"Colored Pencil"}]},"arcgis-nova":{title:"Nova",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Nova",title:"Nova"}]},"arcgis-modern-antique":{title:"Modern Antique",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:ModernAntique:Base",
title:"Modern Antique"}]},"arcgis-midcentury":{title:"Mid-Century",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Midcentury",title:"Mid-Century"}]},"arcgis-newspaper":{title:"Newspaper",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Newspaper",title:"Newspaper"}]},"arcgis-hillshade-light":{title:"Hillshade",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",
showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"}]},"arcgis-hillshade-dark":{title:"Hillshade (Dark)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade (Dark)",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade_Dark/MapServer"}]},"arcgis-human-geography":{title:"Human Geography",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeography:Base",
title:"Human Geography Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeography:Detail",title:"Human Geography Detail",isReference:!0},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeography:Label",title:"Human Geography Label",isReference:!0}]},"arcgis-human-geography-dark":{title:"Human Geography (Dark)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeographyDark:Base",
title:"Human Geography Dark Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeographyDark:Detail",title:"Human Geography Dark Detail",isReference:!0},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeographyDark:Label",title:"Human Geography Dark Label",isReference:!0}]}};b.getBasemapTitle=async function(g){if(g){var k=g.includes("-vector")?g.slice(0,g.indexOf("-vector")):
g.includes("-3d")?g.slice(0,g.indexOf("-3d")):g,l=await n.fetchMessageBundle("esri/t9n/basemaps");return l[g]||l[k]}};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/support/BasemapStyle":function(){define("../chunks/tslib.es6 ../core/Accessor ../core/accessorSupport/decorators/property ../core/has ../core/Logger ../core/RandomLCG ../core/accessorSupport/decorators/subclass ../intl/locale".split(" "),function(b,q,n,g,k,l,a,f){const d=new Set("ar bs ca hr cs da nl en et fi fr de el he hu id it ja ko lv lt nb pl ro ru sr es sv th tr uk vi".split(" "));
q=class extends q{constructor(c){super(c);this.places=this.language=this.id=this.apiKey=null;this.serviceUrl="https://basemapstyles-api.arcgis.com/arcgis/rest/services/styles/v2/webmaps";this.worldview=null}getLanguageParamValue(){if(this.language)return this.language;var c=f.getLocale().toLowerCase();switch(c){case "pt-br":return"pt-BR";case "pt-pt":return"pt-PT";case "zh-cn":return"zh-CN";case "zh-hk":return"zh-HK";case "zh-tw":return"zh-TW"}c=f.getLanguage(c);return"pt"===c?"pt-BR":c&&d.has(c)?
c:"global"}};b.__decorate([n.property()],q.prototype,"apiKey",void 0);b.__decorate([n.property()],q.prototype,"id",void 0);b.__decorate([n.property()],q.prototype,"language",void 0);b.__decorate([n.property()],q.prototype,"places",void 0);b.__decorate([n.property()],q.prototype,"serviceUrl",void 0);b.__decorate([n.property()],q.prototype,"worldview",void 0);return q=b.__decorate([a.subclass("esri.support.BasemapStyle")],q)})},"esri/webdoc/support/writeUtils":function(){define("exports ../../core/Error ../../core/lang ../../core/object ../../core/accessorSupport/extensions/serializableProperty/writer ../../layers/support/layerUtils".split(" "),
function(b,q,n,g,k,l){function a(c,e){"maxScale"in c&&(e.maxScale=k.numberToJSON(c.maxScale)??void 0);"minScale"in c&&(e.minScale=k.numberToJSON(c.minScale)??void 0)}const f=new Set("bing-maps imagery imagery-tile map-image open-street-map tile unknown unsupported vector-tile web-tile wms wmts".split(" ")),d=new Set("catalog csv feature geo-rss geojson group imagery imagery-tile kml knowledge-graph map-image map-notes media ogc-feature oriented-imagery route stream subtype-group tile unknown unsupported vector-tile web-tile wfs wms wmts".split(" "));
b.disableRestrictedWriting=function(c){f.add(c);d.add(c)};b.enableRestrictedWriting=function(c){f.delete(c);d.delete(c)};b.getLayerJSON=function(c,e,h){if(!c.persistenceEnabled)return null;if(!("write"in c&&c.write))return h?.messages&&h.messages.push(new q("layer:unsupported",`Layers (${c.title}, ${c.id}) of type '${c.declaredClass}' cannot be persisted`,{layer:c})),null;if(l.isFeatureCollectionLayer(c)&&!c.isTable)e=c.resourceInfo;else{if(h.restrictedWebMapWriting){var x="basemap"===h.layerContainerType?
f:"operational-layers"===h.layerContainerType?d:null;x=null!=x?x.has(c.type)&&!l.isFeatureCollectionLayer(c):!0}else x=!0;if(x)return e={},c.write(e,h)?e:null}if(null!=e){e=n.clone(e);if(h=e)l.isFeatureCollectionLayer(c)?(x=g.getDeepValue("featureCollection.layers",h)?.[0]?.layerDefinition)&&a(c,x):"group"!==c.type&&a(c,h);if(h&&(h.id=c.id,"blendMode"in c&&(h.blendMode=c.blendMode,"normal"===h.blendMode&&delete h.blendMode),h.opacity=k.numberToJSON(c.opacity)??void 0,h.title=c.title||"Layer",h.visibility=
c.visible,"legendEnabled"in c&&"wmts"!==c.type))if(l.isFeatureCollectionLayer(c)){if(h=h.featureCollection)h.showLegend=c.legendEnabled}else h.showLegend=c.legendEnabled}return e};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/layerUtils":function(){define(["exports","../../kernel","../../request"],function(b,q,n){function g(a){return"scene"===a?.type}function k(a){return null!=a&&"object"===typeof a&&"type"in a&&"subtype-group"===a.type&&"sublayers"in a}function l(a){a=
a?.type;return"imagery-tile"===a||"tile"===a||"open-street-map"===a||"vector-tile"===a||"web-tile"===a||"wmts"===a}b.getEffectiveEditingEnabled=function(a){a:if("editingEnabled"in a)switch(a.type){case "csv":case "feature":case "geojson":case "oriented-imagery":case "scene":case "subtype-group":case "subtype-sublayer":var f=!0;break a;default:f=!1}else f=!1;return f?"effectiveEditingEnabled"in a?a.effectiveEditingEnabled:a.editingEnabled:!1};b.getEffectiveLayerCapabilities=function(a){a:if("capabilities"in
a)switch(a.type){case "catalog":case "catalog-footprint":case "csv":case "feature":case "geojson":case "imagery":case "knowledge-graph-sublayer":case "ogc-feature":case "oriented-imagery":case "scene":case "sublayer":case "subtype-group":case "subtype-sublayer":case "wfs":var f=!0;break a;default:f=!1}else f=!1;return f?"effectiveCapabilities"in a?a.effectiveCapabilities:a.capabilities:null};b.getOwningPortalUrl=async function(a,f){var d=q.id?.findServerInfo(a);if(null!=d?.currentVersion)return d.owningSystemUrl||
null;d=a.toLowerCase().indexOf("/rest/services");if(-1===d)return null;a=`${a.slice(0,d)}/rest/info`;({data:f}=await n(a,{query:{f:"json"},responseType:"json",signal:null!=f?f.signal:null}));return f?.owningSystemUrl||null};b.getSubtypesFromLayer=function(a){return a?("subtypes"in a?a.subtypes:k(a.parent)?a.parent.subtypes:[])??[]:[]};b.getTileMaxtrixSetFromActiveLayer=function(a){if(a.activeLayer){const f=a.activeLayer.tileMatrixSet;if(f)return f;if(a=a.activeLayer.tileMatrixSets)return a}return null};
b.isBaseLayer=function(a){return null!=a?.parent&&"declaredClass"in a.parent&&"esri.Basemap"===a.parent.declaredClass&&a.parent.baseLayers.includes(a)};b.isBasemap3DSupportedLayer=function(a){return l(a)||g(a)};b.isBasemapSupportedTiledLayer=l;b.isFeatureCollectionLayer=function(a){return"feature"===a?.type&&!a.url&&"memory"===a.source?.type};b.isFeatureLayer=function(a){return null!=a&&"object"===typeof a&&"type"in a&&"feature"===a.type};b.isFeatureServiceLayer=function(a){return"feature"===a?.type&&
"feature-layer"===a.source?.type};b.isGraphicsLayer=function(a){return null!=a&&"object"===typeof a&&"type"in a&&"graphics"===a.type};b.isGroupLayer=function(a){return null!=a&&"type"in a&&"group"===a.type};b.isImageryTileLayer=function(a){return"imagery-tile"===a?.type};b.isIntegratedMeshLayer=function(a){return"integrated-mesh"===a||"integrated-mesh-3dtiles"===a};b.isIntegratedMeshOperationalLayer=function(a){return"IntegratedMeshLayer"===a||"IntegratedMesh3DTilesLayer"===a};b.isKnowledgeGraphLayer=
function(a){return null!=a&&"object"===typeof a&&"type"in a&&"knowledge-graph"===a.type&&"layers"in a};b.isLayerWithFeatureLayerSource=function(a){const f=a?.type;return("feature"===f||"subtype-group"===f||"oriented-imagery"===f)&&"feature-layer"===a.source?.type};b.isLinkChartLayer=function(a){return null!=a&&"object"===typeof a&&"type"in a&&"link-chart"===a.type&&"layers"in a};b.isMapNotesLayer=function(a){return null!=a&&"object"===typeof a&&"type"in a&&"map-notes"===a.type&&"sublayers"in a};b.isSceneLayer=
g;b.isSceneServiceLayer=function(a){a=a?.type;return"building-scene"===a||"integrated-mesh"===a||"point-cloud"===a||"scene"===a};b.isSubtypeGroupLayer=k;b.isSubtypeSublayer=function(a){return"subtype-sublayer"===a?.type};b.isTable=function(a){return null!=a&&"object"===typeof a&&"isTable"in a&&!!a.isTable};b.isTiledLayer=function(a){a=a?.type;return"base-tile"===a||"tile"===a||"elevation"===a||"imagery-tile"===a||"base-elevation"===a||"open-street-map"===a||"wcs"===a||"web-tile"===a||"wmts"===a||
"vector-tile"===a};b.isVoxelLayer=function(a){return"voxel"===a?.type};b.sceneServiceLayerTypeToClassName={Point:"SceneLayer","3DObject":"SceneLayer",IntegratedMesh:"IntegratedMeshLayer",PointCloud:"PointCloudLayer",Building:"BuildingSceneLayer"};b.serializeLayerDefinitions=function(a){const f=/[:;]/,d=[];let c=!1;if(a&&(a.forEach((e,h)=>{d.push([h,e]);!c&&f.test(e)&&(c=!0)}),0<d.length)){if(c){const e={};d.forEach(h=>{e[h[0]]=h[1]});a=JSON.stringify(e)}else{const e=[];d.forEach(h=>{e.push(h[0]+":"+
h[1])});a=e.join(";")}return a}return null};b.serializeTimeOptions=function(a){if(a){var f=[];a.forEach((d,c)=>{f.push('"'+c+'":'+JSON.stringify(d))});if(f.length)return"{"+f.join(",")+"}"}};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/layers/effects/utils":function(){define(["exports","./effects"],function(b,q){b.canInterpolateEffects=function(n,g){const k=n.length>g.length?n:g;return(n.length>g.length?g:n).every((l,a)=>l.type===k[a].type)};b.effectEquals=function(n,g){n=
JSON.stringify(n??null);g=JSON.stringify(g??null);return n===g};b.isEffectFunctions=function(n){return(n=n[0])?"type"in n:!1};b.normalizeEffects=function(n,g){const k=n.length>g.length?n:g;n=n.length>g.length?g:n;for(g=n.length;g<k.length;g++)n.push(q.createEffectWithInitialValues(k[g]))};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/layers/effects/effects":function(){define(["exports","../../colorUtils","../../core/screenUtils","../../core/libs/gl-matrix-2/factories/mat4f32",
"./colorMatrixFunctions"],function(b,q,n,g,k){function l(m,p,t){return m+(p-m)*t}function a(m){return Math.round(1E3*n.px2pt(m))/1E3}class f{constructor(m,p,t){this.strength=m;this.radius=p;this.threshold=t;this.type="bloom"}interpolate(m,p,t){this.strength=l(m.strength,p.strength,t);this.radius=l(m.radius,p.radius,t);this.threshold=l(m.threshold,p.threshold,t)}clone(){return new f(this.strength,this.radius,this.threshold)}toJSON(){return{type:"bloom",radius:a(this.radius),strength:this.strength,
threshold:this.threshold}}}class d{constructor(m){this.radius=m;this.type="blur"}interpolate(m,p,t){this.radius=Math.round(l(m.radius,p.radius,t))}clone(){return new d(this.radius)}toJSON(){return{type:"blur",radius:a(this.radius)}}}class c{constructor(m,p){this.type=m;this.amount=p;if("invert"===this.type||"grayscale"===this.type||"sepia"===this.type)this.amount=Math.min(this.amount,1)}get colorMatrix(){this._colorMatrix||this._updateMatrix();return this._colorMatrix}interpolate(m,p,t){this.amount=
l(m.amount,p.amount,t);this._updateMatrix()}clone(){return new c(this.type,this.amount)}toJSON(){return{type:this.type,amount:this.amount}}_updateMatrix(){const m=this._colorMatrix||g.create();switch(this.type){case "brightness":this._colorMatrix=k.brightness(m,this.amount);break;case "contrast":this._colorMatrix=k.contrast(m,this.amount);break;case "grayscale":this._colorMatrix=k.grayscale(m,this.amount);break;case "invert":this._colorMatrix=k.invert(m,this.amount);break;case "saturate":this._colorMatrix=
k.saturate(m,this.amount);break;case "sepia":this._colorMatrix=k.sepia(m,this.amount)}}}class e{constructor(m,p,t,w){this.offsetX=m;this.offsetY=p;this.blurRadius=t;this.color=w;this.type="drop-shadow"}interpolate(m,p,t){this.offsetX=l(m.offsetX,p.offsetX,t);this.offsetY=l(m.offsetY,p.offsetY,t);this.blurRadius=l(m.blurRadius,p.blurRadius,t);this.color[0]=Math.round(l(m.color[0],p.color[0],t));this.color[1]=Math.round(l(m.color[1],p.color[1],t));this.color[2]=Math.round(l(m.color[2],p.color[2],t));
this.color[3]=l(m.color[3],p.color[3],t)}clone(){return new e(this.offsetX,this.offsetY,this.blurRadius,[...this.color])}toJSON(){const m=[...this.color];m[3]*=255;return{type:"drop-shadow",xoffset:a(this.offsetX),yoffset:a(this.offsetY),blurRadius:a(this.blurRadius),color:m}}}class h{constructor(m){this.angle=m;this.type="hue-rotate"}get colorMatrix(){this._colorMatrix||this._updateMatrix();return this._colorMatrix}interpolate(m,p,t){this.angle=l(m.angle,p.angle,t);this._updateMatrix()}clone(){return new h(this.angle)}toJSON(){return{type:"hue-rotate",
angle:this.angle}}_updateMatrix(){const m=this._colorMatrix||g.create();this._colorMatrix=k.rotateHue(m,this.angle)}}class x{constructor(m){this.amount=m;this.type="opacity";this.amount=Math.min(this.amount,1)}interpolate(m,p,t){this.amount=l(m.amount,p.amount,t)}clone(){return new x(this.amount)}toJSON(){return{type:"opacity",amount:this.amount}}}b.BloomEffect=f;b.BlurEffect=d;b.ColorMatrixEffect=c;b.DropShadowEffect=e;b.HueRotateEffect=h;b.OpacityEffect=x;b.createEffectWithInitialValues=function(m){switch(m.type){case "grayscale":case "sepia":case "invert":return new c(m.type,
0);case "saturate":case "brightness":case "contrast":return new c(m.type,1);case "opacity":return new x(1);case "hue-rotate":return new h(0);case "blur":return new d(0);case "drop-shadow":return new e(0,0,0,[...q.getNamedColor("transparent")]);case "bloom":return new f(0,0,1)}};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/core/libs/gl-matrix-2/factories/mat4f32":function(){define(["exports"],function(b){function q(){const f=new Float32Array(16);f[0]=1;f[5]=1;f[10]=1;f[15]=
1;return f}function n(f){const d=new Float32Array(16);d[0]=f[0];d[1]=f[1];d[2]=f[2];d[3]=f[3];d[4]=f[4];d[5]=f[5];d[6]=f[6];d[7]=f[7];d[8]=f[8];d[9]=f[9];d[10]=f[10];d[11]=f[11];d[12]=f[12];d[13]=f[13];d[14]=f[14];d[15]=f[15];return d}function g(f,d,c,e,h,x,m,p,t,w,r,y,z,u,v,A){const B=new Float32Array(16);B[0]=f;B[1]=d;B[2]=c;B[3]=e;B[4]=h;B[5]=x;B[6]=m;B[7]=p;B[8]=t;B[9]=w;B[10]=r;B[11]=y;B[12]=z;B[13]=u;B[14]=v;B[15]=A;return B}function k(f,d){return new Float32Array(f,d,16)}const l=q(),a=Object.freeze(Object.defineProperty({__proto__:null,
IDENTITY:l,clone:n,create:q,createView:k,fromValues:g},Symbol.toStringTag,{value:"Module"}));b.IDENTITY=l;b.clone=n;b.create=q;b.createView=k;b.fromValues=g;b.mat4f32=a;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/layers/effects/colorMatrixFunctions":function(){define(["exports","../../core/libs/gl-matrix-2/math/mat4"],function(b,q){b.brightness=(n,g)=>{n=q.set(n,g,0,0,0,0,g,0,0,0,0,g,0,0,0,0,1);return q.transpose(n,n)};b.contrast=(n,g)=>{n=q.set(n,g,0,0,.5-.5*g,0,g,0,.5-
.5*g,0,0,g,.5-.5*g,0,0,0,1);return q.transpose(n,n)};b.grayscale=(n,g)=>{g=1-g;n=q.set(n,.2126+.7874*g,.7152-.7152*g,.0722-.0722*g,0,.2126-.2126*g,.7152+.2848*g,.0722-.0722*g,0,.2126-.2126*g,.7152-.7152*g,.0722+.9278*g,0,0,0,0,1);return q.transpose(n,n)};b.invert=(n,g)=>{const k=1-2*g;n=q.set(n,k,0,0,g,0,k,0,g,0,0,k,g,0,0,0,1);return q.transpose(n,n)};b.rotateHue=(n,g)=>{const k=Math.sin(g*Math.PI/180);g=Math.cos(g*Math.PI/180);n=q.set(n,.213+.787*g-.213*k,.715-.715*g-.715*k,.072-.072*g+.928*k,0,
.213-.213*g+.143*k,.715+.285*g+.14*k,.072-.072*g-.283*k,0,.213-.213*g-.787*k,.715-.715*g+.715*k,.072+.928*g+.072*k,0,0,0,0,1);return q.transpose(n,n)};b.saturate=(n,g)=>{n=q.set(n,.213+.787*g,.715-.715*g,.072-.072*g,0,.213-.213*g,.715+.285*g,.072-.072*g,0,.213-.213*g,.715-.715*g,.072+.928*g,0,0,0,0,1);return q.transpose(n,n)};b.sepia=(n,g)=>{g=1-g;n=q.set(n,.393+.607*g,.769-.769*g,.189-.189*g,0,.349-.349*g,.686+.314*g,.168-.168*g,0,.272-.272*g,.534-.534*g,.131+.869*g,0,0,0,0,1);return q.transpose(n,
n)};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/core/libs/gl-matrix-2/math/mat4":function(){define(["exports","../factories/vec3f64","./common"],function(b,q,n){function g(M,L){M[0]=L[0];M[1]=L[1];M[2]=L[2];M[3]=L[3];M[4]=L[4];M[5]=L[5];M[6]=L[6];M[7]=L[7];M[8]=L[8];M[9]=L[9];M[10]=L[10];M[11]=L[11];M[12]=L[12];M[13]=L[13];M[14]=L[14];M[15]=L[15];return M}function k(M,L,T,ha,oa,S,X,ba,la,pa,O,ea,na,ra,Aa,za,Ba){M[0]=L;M[1]=T;M[2]=ha;M[3]=oa;M[4]=S;M[5]=X;M[6]=ba;M[7]=la;
M[8]=pa;M[9]=O;M[10]=ea;M[11]=na;M[12]=ra;M[13]=Aa;M[14]=za;M[15]=Ba;return M}function l(M){M[0]=1;M[1]=0;M[2]=0;M[3]=0;M[4]=0;M[5]=1;M[6]=0;M[7]=0;M[8]=0;M[9]=0;M[10]=1;M[11]=0;M[12]=0;M[13]=0;M[14]=0;M[15]=1;return M}function a(M,L){if(M===L){const T=L[1],ha=L[2],oa=L[3],S=L[6],X=L[7],ba=L[11];M[1]=L[4];M[2]=L[8];M[3]=L[12];M[4]=T;M[6]=L[9];M[7]=L[13];M[8]=ha;M[9]=S;M[11]=L[14];M[12]=oa;M[13]=X;M[14]=ba}else M[0]=L[0],M[1]=L[4],M[2]=L[8],M[3]=L[12],M[4]=L[1],M[5]=L[5],M[6]=L[9],M[7]=L[13],M[8]=
L[2],M[9]=L[6],M[10]=L[10],M[11]=L[14],M[12]=L[3],M[13]=L[7],M[14]=L[11],M[15]=L[15];return M}function f(M,L){d(M,L)||l(M);return M}function d(M,L){const T=L[0],ha=L[1],oa=L[2],S=L[3],X=L[4],ba=L[5],la=L[6],pa=L[7],O=L[8],ea=L[9],na=L[10],ra=L[11],Aa=L[12],za=L[13],Ba=L[14];L=L[15];const Ha=T*ba-ha*X,Ea=T*la-oa*X,Ia=T*pa-S*X,Ja=ha*la-oa*ba,Fa=ha*pa-S*ba,Ma=oa*pa-S*la,Ua=O*za-ea*Aa,hb=O*Ba-na*Aa,ib=O*L-ra*Aa,Za=ea*Ba-na*za,Oa=ea*L-ra*za,Pa=na*L-ra*Ba;let ua=Ha*Pa-Ea*Oa+Ia*Za+Ja*ib-Fa*hb+Ma*Ua;if(!ua)return null;
ua=1/ua;M[0]=(ba*Pa-la*Oa+pa*Za)*ua;M[1]=(oa*Oa-ha*Pa-S*Za)*ua;M[2]=(za*Ma-Ba*Fa+L*Ja)*ua;M[3]=(na*Fa-ea*Ma-ra*Ja)*ua;M[4]=(la*ib-X*Pa-pa*hb)*ua;M[5]=(T*Pa-oa*ib+S*hb)*ua;M[6]=(Ba*Ia-Aa*Ma-L*Ea)*ua;M[7]=(O*Ma-na*Ia+ra*Ea)*ua;M[8]=(X*Oa-ba*ib+pa*Ua)*ua;M[9]=(ha*ib-T*Oa-S*Ua)*ua;M[10]=(Aa*Fa-za*Ia+L*Ha)*ua;M[11]=(ea*Ia-O*Fa-ra*Ha)*ua;M[12]=(ba*hb-X*Za-la*Ua)*ua;M[13]=(T*Za-ha*hb+oa*Ua)*ua;M[14]=(za*Ea-Aa*Ja-Ba*Ha)*ua;M[15]=(O*Ja-ea*Ea+na*Ha)*ua;return M}function c(M,L){const T=L[0],ha=L[1],oa=L[2],
S=L[3],X=L[4],ba=L[5],la=L[6],pa=L[7],O=L[8],ea=L[9],na=L[10],ra=L[11],Aa=L[12],za=L[13],Ba=L[14];L=L[15];M[0]=ba*(na*L-ra*Ba)-ea*(la*L-pa*Ba)+za*(la*ra-pa*na);M[1]=-(ha*(na*L-ra*Ba)-ea*(oa*L-S*Ba)+za*(oa*ra-S*na));M[2]=ha*(la*L-pa*Ba)-ba*(oa*L-S*Ba)+za*(oa*pa-S*la);M[3]=-(ha*(la*ra-pa*na)-ba*(oa*ra-S*na)+ea*(oa*pa-S*la));M[4]=-(X*(na*L-ra*Ba)-O*(la*L-pa*Ba)+Aa*(la*ra-pa*na));M[5]=T*(na*L-ra*Ba)-O*(oa*L-S*Ba)+Aa*(oa*ra-S*na);M[6]=-(T*(la*L-pa*Ba)-X*(oa*L-S*Ba)+Aa*(oa*pa-S*la));M[7]=T*(la*ra-pa*na)-
X*(oa*ra-S*na)+O*(oa*pa-S*la);M[8]=X*(ea*L-ra*za)-O*(ba*L-pa*za)+Aa*(ba*ra-pa*ea);M[9]=-(T*(ea*L-ra*za)-O*(ha*L-S*za)+Aa*(ha*ra-S*ea));M[10]=T*(ba*L-pa*za)-X*(ha*L-S*za)+Aa*(ha*pa-S*ba);M[11]=-(T*(ba*ra-pa*ea)-X*(ha*ra-S*ea)+O*(ha*pa-S*ba));M[12]=-(X*(ea*Ba-na*za)-O*(ba*Ba-la*za)+Aa*(ba*na-la*ea));M[13]=T*(ea*Ba-na*za)-O*(ha*Ba-oa*za)+Aa*(ha*na-oa*ea);M[14]=-(T*(ba*Ba-la*za)-X*(ha*Ba-oa*za)+Aa*(ha*la-oa*ba));M[15]=T*(ba*na-la*ea)-X*(ha*na-oa*ea)+O*(ha*la-oa*ba);return M}function e(M){const L=M[0],
T=M[1],ha=M[2],oa=M[3],S=M[4],X=M[5],ba=M[6],la=M[7],pa=M[8],O=M[9],ea=M[10],na=M[11],ra=M[12],Aa=M[13],za=M[14];M=M[15];return(L*X-T*S)*(ea*M-na*za)-(L*ba-ha*S)*(O*M-na*Aa)+(L*la-oa*S)*(O*za-ea*Aa)+(T*ba-ha*X)*(pa*M-na*ra)-(T*la-oa*X)*(pa*za-ea*ra)+(ha*la-oa*ba)*(pa*Aa-O*ra)}function h(M,L,T){const ha=L[0],oa=L[1],S=L[2],X=L[3],ba=L[4],la=L[5],pa=L[6],O=L[7],ea=L[8],na=L[9],ra=L[10],Aa=L[11],za=L[12],Ba=L[13],Ha=L[14];L=L[15];let Ea=T[0],Ia=T[1],Ja=T[2],Fa=T[3];M[0]=Ea*ha+Ia*ba+Ja*ea+Fa*za;M[1]=
Ea*oa+Ia*la+Ja*na+Fa*Ba;M[2]=Ea*S+Ia*pa+Ja*ra+Fa*Ha;M[3]=Ea*X+Ia*O+Ja*Aa+Fa*L;Ea=T[4];Ia=T[5];Ja=T[6];Fa=T[7];M[4]=Ea*ha+Ia*ba+Ja*ea+Fa*za;M[5]=Ea*oa+Ia*la+Ja*na+Fa*Ba;M[6]=Ea*S+Ia*pa+Ja*ra+Fa*Ha;M[7]=Ea*X+Ia*O+Ja*Aa+Fa*L;Ea=T[8];Ia=T[9];Ja=T[10];Fa=T[11];M[8]=Ea*ha+Ia*ba+Ja*ea+Fa*za;M[9]=Ea*oa+Ia*la+Ja*na+Fa*Ba;M[10]=Ea*S+Ia*pa+Ja*ra+Fa*Ha;M[11]=Ea*X+Ia*O+Ja*Aa+Fa*L;Ea=T[12];Ia=T[13];Ja=T[14];Fa=T[15];M[12]=Ea*ha+Ia*ba+Ja*ea+Fa*za;M[13]=Ea*oa+Ia*la+Ja*na+Fa*Ba;M[14]=Ea*S+Ia*pa+Ja*ra+Fa*Ha;M[15]=
Ea*X+Ia*O+Ja*Aa+Fa*L;return M}function x(M,L,T){const ha=T[0],oa=T[1];T=T[2];if(L===M)M[12]=L[0]*ha+L[4]*oa+L[8]*T+L[12],M[13]=L[1]*ha+L[5]*oa+L[9]*T+L[13],M[14]=L[2]*ha+L[6]*oa+L[10]*T+L[14],M[15]=L[3]*ha+L[7]*oa+L[11]*T+L[15];else{const S=L[0],X=L[1],ba=L[2],la=L[3],pa=L[4],O=L[5],ea=L[6],na=L[7],ra=L[8],Aa=L[9],za=L[10],Ba=L[11];M[0]=S;M[1]=X;M[2]=ba;M[3]=la;M[4]=pa;M[5]=O;M[6]=ea;M[7]=na;M[8]=ra;M[9]=Aa;M[10]=za;M[11]=Ba;M[12]=S*ha+pa*oa+ra*T+L[12];M[13]=X*ha+O*oa+Aa*T+L[13];M[14]=ba*ha+ea*oa+
za*T+L[14];M[15]=la*ha+na*oa+Ba*T+L[15]}return M}function m(M,L,T){const ha=T[0],oa=T[1];T=T[2];M[0]=L[0]*ha;M[1]=L[1]*ha;M[2]=L[2]*ha;M[3]=L[3]*ha;M[4]=L[4]*oa;M[5]=L[5]*oa;M[6]=L[6]*oa;M[7]=L[7]*oa;M[8]=L[8]*T;M[9]=L[9]*T;M[10]=L[10]*T;M[11]=L[11]*T;M[12]=L[12];M[13]=L[13];M[14]=L[14];M[15]=L[15];return M}function p(M,L,T,ha){var oa=ha[0],S=ha[1];ha=ha[2];var X=Math.sqrt(oa*oa+S*S+ha*ha);if(X<=n.getEpsilon())g(M,L);else{X=1/X;oa*=X;S*=X;ha*=X;var ba=Math.sin(T),la=Math.cos(T),pa=1-la;T=L[0];X=L[1];
var O=L[2],ea=L[3],na=L[4],ra=L[5],Aa=L[6],za=L[7],Ba=L[8],Ha=L[9],Ea=L[10],Ia=L[11],Ja=oa*oa*pa+la,Fa=S*oa*pa+ha*ba,Ma=ha*oa*pa-S*ba,Ua=oa*S*pa-ha*ba,hb=S*S*pa+la,ib=ha*S*pa+oa*ba,Za=oa*ha*pa+S*ba;oa=S*ha*pa-oa*ba;S=ha*ha*pa+la;M[0]=T*Ja+na*Fa+Ba*Ma;M[1]=X*Ja+ra*Fa+Ha*Ma;M[2]=O*Ja+Aa*Fa+Ea*Ma;M[3]=ea*Ja+za*Fa+Ia*Ma;M[4]=T*Ua+na*hb+Ba*ib;M[5]=X*Ua+ra*hb+Ha*ib;M[6]=O*Ua+Aa*hb+Ea*ib;M[7]=ea*Ua+za*hb+Ia*ib;M[8]=T*Za+na*oa+Ba*S;M[9]=X*Za+ra*oa+Ha*S;M[10]=O*Za+Aa*oa+Ea*S;M[11]=ea*Za+za*oa+Ia*S;L!==M&&
(M[12]=L[12],M[13]=L[13],M[14]=L[14],M[15]=L[15])}}function t(M,L,T){const ha=Math.sin(T);T=Math.cos(T);const oa=L[4],S=L[5],X=L[6],ba=L[7],la=L[8],pa=L[9],O=L[10],ea=L[11];L!==M&&(M[0]=L[0],M[1]=L[1],M[2]=L[2],M[3]=L[3],M[12]=L[12],M[13]=L[13],M[14]=L[14],M[15]=L[15]);M[4]=oa*T+la*ha;M[5]=S*T+pa*ha;M[6]=X*T+O*ha;M[7]=ba*T+ea*ha;M[8]=la*T-oa*ha;M[9]=pa*T-S*ha;M[10]=O*T-X*ha;M[11]=ea*T-ba*ha;return M}function w(M,L,T){const ha=Math.sin(T);T=Math.cos(T);const oa=L[0],S=L[1],X=L[2],ba=L[3],la=L[8],pa=
L[9],O=L[10],ea=L[11];L!==M&&(M[4]=L[4],M[5]=L[5],M[6]=L[6],M[7]=L[7],M[12]=L[12],M[13]=L[13],M[14]=L[14],M[15]=L[15]);M[0]=oa*T-la*ha;M[1]=S*T-pa*ha;M[2]=X*T-O*ha;M[3]=ba*T-ea*ha;M[8]=oa*ha+la*T;M[9]=S*ha+pa*T;M[10]=X*ha+O*T;M[11]=ba*ha+ea*T;return M}function r(M,L,T){const ha=Math.sin(T);T=Math.cos(T);const oa=L[0],S=L[1],X=L[2],ba=L[3],la=L[4],pa=L[5],O=L[6],ea=L[7];L!==M&&(M[8]=L[8],M[9]=L[9],M[10]=L[10],M[11]=L[11],M[12]=L[12],M[13]=L[13],M[14]=L[14],M[15]=L[15]);M[0]=oa*T+la*ha;M[1]=S*T+pa*
ha;M[2]=X*T+O*ha;M[3]=ba*T+ea*ha;M[4]=la*T-oa*ha;M[5]=pa*T-S*ha;M[6]=O*T-X*ha;M[7]=ea*T-ba*ha;return M}function y(M,L){M[0]=1;M[1]=0;M[2]=0;M[3]=0;M[4]=0;M[5]=1;M[6]=0;M[7]=0;M[8]=0;M[9]=0;M[10]=1;M[11]=0;M[12]=L[0];M[13]=L[1];M[14]=L[2];M[15]=1;return M}function z(M,L){M[0]=L[0];M[1]=0;M[2]=0;M[3]=0;M[4]=0;M[5]=L[1];M[6]=0;M[7]=0;M[8]=0;M[9]=0;M[10]=L[2];M[11]=0;M[12]=0;M[13]=0;M[14]=0;M[15]=1;return M}function u(M,L,T){if(0===L)return l(M);let ha=T[0],oa=T[1];T=T[2];var S=Math.sqrt(ha*ha+oa*oa+
T*T);if(S<=n.getEpsilon())return null;S=1/S;ha*=S;oa*=S;T*=S;S=Math.sin(L);L=Math.cos(L);const X=1-L;M[0]=ha*ha*X+L;M[1]=oa*ha*X+T*S;M[2]=T*ha*X-oa*S;M[3]=0;M[4]=ha*oa*X-T*S;M[5]=oa*oa*X+L;M[6]=T*oa*X+ha*S;M[7]=0;M[8]=ha*T*X+oa*S;M[9]=oa*T*X-ha*S;M[10]=T*T*X+L;M[11]=0;M[12]=0;M[13]=0;M[14]=0;M[15]=1;return M}function v(M,L){const T=Math.sin(L);L=Math.cos(L);M[0]=1;M[1]=0;M[2]=0;M[3]=0;M[4]=0;M[5]=L;M[6]=T;M[7]=0;M[8]=0;M[9]=-T;M[10]=L;M[11]=0;M[12]=0;M[13]=0;M[14]=0;M[15]=1;return M}function A(M,
L){const T=Math.sin(L);L=Math.cos(L);M[0]=L;M[1]=0;M[2]=-T;M[3]=0;M[4]=0;M[5]=1;M[6]=0;M[7]=0;M[8]=T;M[9]=0;M[10]=L;M[11]=0;M[12]=0;M[13]=0;M[14]=0;M[15]=1;return M}function B(M,L){const T=Math.sin(L);L=Math.cos(L);M[0]=L;M[1]=T;M[2]=0;M[3]=0;M[4]=-T;M[5]=L;M[6]=0;M[7]=0;M[8]=0;M[9]=0;M[10]=1;M[11]=0;M[12]=0;M[13]=0;M[14]=0;M[15]=1;return M}function F(M,L,T){var ha=L[0],oa=L[1],S=L[2],X=L[3],ba=ha+ha,la=oa+oa;const pa=S+S;L=ha*ba;const O=ha*la;ha*=pa;const ea=oa*la;oa*=pa;S*=pa;ba*=X;la*=X;X*=pa;
M[0]=1-(ea+S);M[1]=O+X;M[2]=ha-la;M[3]=0;M[4]=O-X;M[5]=1-(L+S);M[6]=oa+ba;M[7]=0;M[8]=ha+la;M[9]=oa-ba;M[10]=1-(L+ea);M[11]=0;M[12]=T[0];M[13]=T[1];M[14]=T[2];M[15]=1;return M}function H(M,L){const T=wa,ha=-L[0],oa=-L[1],S=-L[2],X=L[3],ba=L[4],la=L[5],pa=L[6],O=L[7],ea=ha*ha+oa*oa+S*S+X*X;0<ea?(T[0]=2*(ba*X+O*ha+la*S-pa*oa)/ea,T[1]=2*(la*X+O*oa+pa*ha-ba*S)/ea,T[2]=2*(pa*X+O*S+ba*oa-la*ha)/ea):(T[0]=2*(ba*X+O*ha+la*S-pa*oa),T[1]=2*(la*X+O*oa+pa*ha-ba*S),T[2]=2*(pa*X+O*S+ba*oa-la*ha));F(M,L,T);return M}
function J(M,L){M[0]=L[12];M[1]=L[13];M[2]=L[14];return M}function E(M,L){const T=L[0],ha=L[1],oa=L[2],S=L[4],X=L[5],ba=L[6],la=L[8],pa=L[9];L=L[10];M[0]=Math.sqrt(T*T+ha*ha+oa*oa);M[1]=Math.sqrt(S*S+X*X+ba*ba);M[2]=Math.sqrt(la*la+pa*pa+L*L);return M}function K(M,L){const T=L[0]+L[5]+L[10];let ha=0;0<T?(ha=2*Math.sqrt(T+1),M[3]=.25*ha,M[0]=(L[6]-L[9])/ha,M[1]=(L[8]-L[2])/ha,M[2]=(L[1]-L[4])/ha):L[0]>L[5]&&L[0]>L[10]?(ha=2*Math.sqrt(1+L[0]-L[5]-L[10]),M[3]=(L[6]-L[9])/ha,M[0]=.25*ha,M[1]=(L[1]+L[4])/
ha,M[2]=(L[8]+L[2])/ha):L[5]>L[10]?(ha=2*Math.sqrt(1+L[5]-L[0]-L[10]),M[3]=(L[8]-L[2])/ha,M[0]=(L[1]+L[4])/ha,M[1]=.25*ha,M[2]=(L[6]+L[9])/ha):(ha=2*Math.sqrt(1+L[10]-L[0]-L[5]),M[3]=(L[1]-L[4])/ha,M[0]=(L[8]+L[2])/ha,M[1]=(L[6]+L[9])/ha,M[2]=.25*ha);return M}function C(M,L,T,ha){var oa=L[0],S=L[1],X=L[2],ba=L[3],la=oa+oa,pa=S+S,O=X+X;L=oa*la;const ea=oa*pa;oa*=O;const na=S*pa;S*=O;X*=O;la*=ba;pa*=ba;ba*=O;O=ha[0];const ra=ha[1];ha=ha[2];M[0]=(1-(na+X))*O;M[1]=(ea+ba)*O;M[2]=(oa-pa)*O;M[3]=0;M[4]=
(ea-ba)*ra;M[5]=(1-(L+X))*ra;M[6]=(S+la)*ra;M[7]=0;M[8]=(oa+pa)*ha;M[9]=(S-la)*ha;M[10]=(1-(L+na))*ha;M[11]=0;M[12]=T[0];M[13]=T[1];M[14]=T[2];M[15]=1;return M}function D(M,L,T,ha,oa){var S=L[0],X=L[1],ba=L[2],la=L[3],pa=S+S,O=X+X,ea=ba+ba;L=S*pa;var na=S*O,ra=S*ea;S=X*O;X*=ea;var Aa=ba*ea;ba=la*pa;O*=la;const za=la*ea;var Ba=ha[0],Ha=ha[1];ea=ha[2];ha=oa[0];la=oa[1];oa=oa[2];pa=(1-(S+Aa))*Ba;const Ea=(na+za)*Ba;Ba*=ra-O;na=(na-za)*Ha;Aa=(1-(L+Aa))*Ha;Ha*=X+ba;ra=(ra+O)*ea;X=(X-ba)*ea;L=(1-(L+S))*
ea;M[0]=pa;M[1]=Ea;M[2]=Ba;M[3]=0;M[4]=na;M[5]=Aa;M[6]=Ha;M[7]=0;M[8]=ra;M[9]=X;M[10]=L;M[11]=0;M[12]=T[0]+ha-(pa*ha+na*la+ra*oa);M[13]=T[1]+la-(Ea*ha+Aa*la+X*oa);M[14]=T[2]+oa-(Ba*ha+Ha*la+L*oa);M[15]=1;return M}function G(M,L){var T=L[0],ha=L[1],oa=L[2];L=L[3];var S=T+T,X=ha+ha;const ba=oa+oa;T*=S;const la=ha*S;ha*=X;const pa=oa*S,O=oa*X;oa*=ba;S*=L;X*=L;L*=ba;M[0]=1-ha-oa;M[1]=la+L;M[2]=pa-X;M[3]=0;M[4]=la-L;M[5]=1-T-oa;M[6]=O+S;M[7]=0;M[8]=pa+X;M[9]=O-S;M[10]=1-T-ha;M[11]=0;M[12]=0;M[13]=0;M[14]=
0;M[15]=1;return M}function N(M,L,T,ha,oa,S,X){const ba=1/(T-L),la=1/(oa-ha),pa=1/(S-X);M[0]=2*S*ba;M[1]=0;M[2]=0;M[3]=0;M[4]=0;M[5]=2*S*la;M[6]=0;M[7]=0;M[8]=(T+L)*ba;M[9]=(oa+ha)*la;M[10]=(X+S)*pa;M[11]=-1;M[12]=0;M[13]=0;M[14]=X*S*2*pa;M[15]=0;return M}function Y(M,L,T,ha,oa){L=1/Math.tan(L/2);let S=void 0;M[0]=L/T;M[1]=0;M[2]=0;M[3]=0;M[4]=0;M[5]=L;M[6]=0;M[7]=0;M[8]=0;M[9]=0;M[11]=-1;M[12]=0;M[13]=0;M[15]=0;null!=oa&&Infinity!==oa?(S=1/(ha-oa),M[10]=(oa+ha)*S,M[14]=2*oa*ha*S):(M[10]=-1,M[14]=
-2*ha);return M}function ca(M,L,T,ha){const oa=Math.tan(L.upDegrees*Math.PI/180),S=Math.tan(L.downDegrees*Math.PI/180),X=Math.tan(L.leftDegrees*Math.PI/180);L=Math.tan(L.rightDegrees*Math.PI/180);const ba=2/(X+L),la=2/(oa+S);M[0]=ba;M[1]=0;M[2]=0;M[3]=0;M[4]=0;M[5]=la;M[6]=0;M[7]=0;M[8]=-((X-L)*ba*.5);M[9]=(oa-S)*la*.5;M[10]=ha/(T-ha);M[11]=-1;M[12]=0;M[13]=0;M[14]=ha*T/(T-ha);M[15]=0;return M}function ka(M,L,T,ha,oa,S,X){const ba=1/(L-T),la=1/(ha-oa),pa=1/(S-X);M[0]=-2*ba;M[1]=0;M[2]=0;M[3]=0;M[4]=
0;M[5]=-2*la;M[6]=0;M[7]=0;M[8]=0;M[9]=0;M[10]=2*pa;M[11]=0;M[12]=(L+T)*ba;M[13]=(oa+ha)*la;M[14]=(X+S)*pa;M[15]=1;return M}function Q(M,L,T,ha){const oa=L[0],S=L[1];L=L[2];let X=oa-T[0],ba=S-T[1];T=L-T[2];var la=n.getEpsilon();if(Math.abs(X)<la&&Math.abs(ba)<la&&Math.abs(T)<la)l(M);else{var pa=1/Math.sqrt(X*X+ba*ba+T*T);X*=pa;ba*=pa;T*=pa;pa=ha[0];var O=ha[1];la=ha[2];ha=O*T-la*ba;la=la*X-pa*T;O=pa*ba-O*X;(pa=Math.sqrt(ha*ha+la*la+O*O))?(pa=1/pa,ha*=pa,la*=pa,O*=pa):O=la=ha=0;var ea=ba*O-T*la,na=
T*ha-X*O,ra=X*la-ba*ha;(pa=Math.sqrt(ea*ea+na*na+ra*ra))?(pa=1/pa,ea*=pa,na*=pa,ra*=pa):ra=na=ea=0;M[0]=ha;M[1]=ea;M[2]=X;M[3]=0;M[4]=la;M[5]=na;M[6]=ba;M[7]=0;M[8]=O;M[9]=ra;M[10]=T;M[11]=0;M[12]=-(ha*oa+la*S+O*L);M[13]=-(ea*oa+na*S+ra*L);M[14]=-(X*oa+ba*S+T*L);M[15]=1}}function R(M,L,T,ha){const oa=L[0],S=L[1];L=L[2];var X=ha[0];const ba=ha[1];var la=ha[2];ha=oa-T[0];let pa=S-T[1];T=L-T[2];let O=ha*ha+pa*pa+T*T;0<O&&(O=1/Math.sqrt(O),ha*=O,pa*=O,T*=O);let ea=ba*T-la*pa;la=la*ha-X*T;X=X*pa-ba*ha;
O=ea*ea+la*la+X*X;0<O&&(O=1/Math.sqrt(O),ea*=O,la*=O,X*=O);M[0]=ea;M[1]=la;M[2]=X;M[3]=0;M[4]=pa*X-T*la;M[5]=T*ea-ha*X;M[6]=ha*la-pa*ea;M[7]=0;M[8]=ha;M[9]=pa;M[10]=T;M[11]=0;M[12]=oa;M[13]=S;M[14]=L;M[15]=1;return M}function Z(M){return"mat4("+M[0]+", "+M[1]+", "+M[2]+", "+M[3]+", "+M[4]+", "+M[5]+", "+M[6]+", "+M[7]+", "+M[8]+", "+M[9]+", "+M[10]+", "+M[11]+", "+M[12]+", "+M[13]+", "+M[14]+", "+M[15]+")"}function da(M){return Math.sqrt(M[0]**2+M[1]**2+M[2]**2+M[3]**2+M[4]**2+M[5]**2+M[6]**2+M[7]**
2+M[8]**2+M[9]**2+M[10]**2+M[11]**2+M[12]**2+M[13]**2+M[14]**2+M[15]**2)}function ja(M,L,T){M[0]=L[0]+T[0];M[1]=L[1]+T[1];M[2]=L[2]+T[2];M[3]=L[3]+T[3];M[4]=L[4]+T[4];M[5]=L[5]+T[5];M[6]=L[6]+T[6];M[7]=L[7]+T[7];M[8]=L[8]+T[8];M[9]=L[9]+T[9];M[10]=L[10]+T[10];M[11]=L[11]+T[11];M[12]=L[12]+T[12];M[13]=L[13]+T[13];M[14]=L[14]+T[14];M[15]=L[15]+T[15];return M}function W(M,L,T){M[0]=L[0]-T[0];M[1]=L[1]-T[1];M[2]=L[2]-T[2];M[3]=L[3]-T[3];M[4]=L[4]-T[4];M[5]=L[5]-T[5];M[6]=L[6]-T[6];M[7]=L[7]-T[7];M[8]=
L[8]-T[8];M[9]=L[9]-T[9];M[10]=L[10]-T[10];M[11]=L[11]-T[11];M[12]=L[12]-T[12];M[13]=L[13]-T[13];M[14]=L[14]-T[14];M[15]=L[15]-T[15];return M}function aa(M,L,T){M[0]=L[0]*T;M[1]=L[1]*T;M[2]=L[2]*T;M[3]=L[3]*T;M[4]=L[4]*T;M[5]=L[5]*T;M[6]=L[6]*T;M[7]=L[7]*T;M[8]=L[8]*T;M[9]=L[9]*T;M[10]=L[10]*T;M[11]=L[11]*T;M[12]=L[12]*T;M[13]=L[13]*T;M[14]=L[14]*T;M[15]=L[15]*T;return M}function ia(M,L,T,ha){M[0]=L[0]+T[0]*ha;M[1]=L[1]+T[1]*ha;M[2]=L[2]+T[2]*ha;M[3]=L[3]+T[3]*ha;M[4]=L[4]+T[4]*ha;M[5]=L[5]+T[5]*
ha;M[6]=L[6]+T[6]*ha;M[7]=L[7]+T[7]*ha;M[8]=L[8]+T[8]*ha;M[9]=L[9]+T[9]*ha;M[10]=L[10]+T[10]*ha;M[11]=L[11]+T[11]*ha;M[12]=L[12]+T[12]*ha;M[13]=L[13]+T[13]*ha;M[14]=L[14]+T[14]*ha;M[15]=L[15]+T[15]*ha;return M}function qa(M,L){return M[0]===L[0]&&M[1]===L[1]&&M[2]===L[2]&&M[3]===L[3]&&M[4]===L[4]&&M[5]===L[5]&&M[6]===L[6]&&M[7]===L[7]&&M[8]===L[8]&&M[9]===L[9]&&M[10]===L[10]&&M[11]===L[11]&&M[12]===L[12]&&M[13]===L[13]&&M[14]===L[14]&&M[15]===L[15]}function sa(M,L){if(M===L)return!0;const T=M[0],
ha=M[1],oa=M[2],S=M[3],X=M[4],ba=M[5],la=M[6],pa=M[7],O=M[8],ea=M[9],na=M[10],ra=M[11],Aa=M[12],za=M[13],Ba=M[14];M=M[15];const Ha=L[0],Ea=L[1],Ia=L[2],Ja=L[3],Fa=L[4],Ma=L[5],Ua=L[6],hb=L[7],ib=L[8],Za=L[9],Oa=L[10],Pa=L[11],ua=L[12],ob=L[13],Hb=L[14];L=L[15];const Na=n.getEpsilon();return Math.abs(T-Ha)<=Na*Math.max(1,Math.abs(T),Math.abs(Ha))&&Math.abs(ha-Ea)<=Na*Math.max(1,Math.abs(ha),Math.abs(Ea))&&Math.abs(oa-Ia)<=Na*Math.max(1,Math.abs(oa),Math.abs(Ia))&&Math.abs(S-Ja)<=Na*Math.max(1,Math.abs(S),
Math.abs(Ja))&&Math.abs(X-Fa)<=Na*Math.max(1,Math.abs(X),Math.abs(Fa))&&Math.abs(ba-Ma)<=Na*Math.max(1,Math.abs(ba),Math.abs(Ma))&&Math.abs(la-Ua)<=Na*Math.max(1,Math.abs(la),Math.abs(Ua))&&Math.abs(pa-hb)<=Na*Math.max(1,Math.abs(pa),Math.abs(hb))&&Math.abs(O-ib)<=Na*Math.max(1,Math.abs(O),Math.abs(ib))&&Math.abs(ea-Za)<=Na*Math.max(1,Math.abs(ea),Math.abs(Za))&&Math.abs(na-Oa)<=Na*Math.max(1,Math.abs(na),Math.abs(Oa))&&Math.abs(ra-Pa)<=Na*Math.max(1,Math.abs(ra),Math.abs(Pa))&&Math.abs(Aa-ua)<=Na*
Math.max(1,Math.abs(Aa),Math.abs(ua))&&Math.abs(za-ob)<=Na*Math.max(1,Math.abs(za),Math.abs(ob))&&Math.abs(Ba-Hb)<=Na*Math.max(1,Math.abs(Ba),Math.abs(Hb))&&Math.abs(M-L)<=Na*Math.max(1,Math.abs(M),Math.abs(L))}function ya(M){const L=n.getEpsilon(),T=M[0],ha=M[1],oa=M[2],S=M[4],X=M[5],ba=M[6],la=M[8],pa=M[9];M=M[10];return Math.abs(1-(T*T+S*S+la*la))<=L&&Math.abs(1-(ha*ha+X*X+pa*pa))<=L&&Math.abs(1-(oa*oa+ba*ba+M*M))<=L}function va(M){return 1===M[0]&&0===M[1]&&0===M[2]&&0===M[4]&&1===M[5]&&0===M[6]&&
0===M[8]&&0===M[9]&&1===M[10]}const wa=q.create();q=Object.freeze(Object.defineProperty({__proto__:null,add:ja,adjoint:c,copy:g,determinant:e,equals:sa,exactEquals:qa,frob:da,fromQuat:G,fromQuat2:H,fromRotation:u,fromRotationTranslation:F,fromRotationTranslationScale:C,fromRotationTranslationScaleOrigin:D,fromScaling:z,fromTranslation:y,fromXRotation:v,fromYRotation:A,fromZRotation:B,frustum:N,getRotation:K,getScaling:E,getTranslation:J,hasIdentityRotation:va,identity:l,invert:d,invertOrIdentity:f,
isOrthoNormal:ya,lookAt:Q,mul:h,multiply:h,multiplyScalar:aa,multiplyScalarAndAdd:ia,ortho:ka,perspective:Y,perspectiveFromFieldOfView:ca,rotate:p,rotateX:t,rotateY:w,rotateZ:r,scale:m,set:k,str:Z,sub:W,subtract:W,targetTo:R,translate:x,transpose:a},Symbol.toStringTag,{value:"Module"}));b.add=ja;b.adjoint=c;b.copy=g;b.determinant=e;b.equals=sa;b.exactEquals=qa;b.frob=da;b.fromQuat=G;b.fromQuat2=H;b.fromRotation=u;b.fromRotationTranslation=F;b.fromRotationTranslationScale=C;b.fromRotationTranslationScaleOrigin=
D;b.fromScaling=z;b.fromTranslation=y;b.fromXRotation=v;b.fromYRotation=A;b.fromZRotation=B;b.frustum=N;b.getRotation=K;b.getScaling=E;b.getTranslation=J;b.hasIdentityRotation=va;b.identity=l;b.invert=d;b.invertOrIdentity=f;b.isOrthoNormal=ya;b.lookAt=Q;b.mat4=q;b.mul=h;b.multiply=h;b.multiplyScalar=aa;b.multiplyScalarAndAdd=ia;b.ortho=ka;b.perspective=Y;b.perspectiveFromFieldOfView=ca;b.rotate=p;b.rotateX=t;b.rotateY=w;b.rotateZ=r;b.scale=m;b.set=k;b.str=Z;b.sub=W;b.subtract=W;b.targetTo=R;b.translate=
x;b.transpose=a;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/statistics/utils":function(){define(["exports","../rest/support/ClassBreaksDefinition","../rest/support/generateRendererUtils"],function(b,q,n){function g(C){return null==C||"string"===typeof C&&!C?"\x3cNull\x3e":C}function k(C){const D=null!=C.minValue||null!=C.maxValue,G=!!C.sqlExpression&&C.supportsSQLExpression;return!(null!=C.normalizationField||null!=C.normalizationType)&&!D&&!G}function l(C){const {values:D,
useSampleStdDev:G,supportsNullCount:N,outStatisticTypes:Y}=C;var ca=Number.POSITIVE_INFINITY;let ka=Number.NEGATIVE_INFINITY,Q=null,R=null;var Z=null;let da=null,ja=0;const W=null==C.minValue?-Infinity:C.minValue,aa=null==C.maxValue?Infinity:C.maxValue;for(const ia of D)Number.isFinite(ia)?ia>=W&&ia<=aa&&(Q=null===Q?ia:Q+ia,ca=Math.min(ca,ia),ka=Math.max(ka,ia),ja++):"string"===typeof ia&&ja++;if(ja&&null!=Q){R=Q/ja;Z=0;for(const ia of D)Number.isFinite(ia)&&ia>=W&&ia<=aa&&(Z+=(ia-R)**2);da=G?1<ja?
Z/(ja-1):0:0<ja?Z/ja:0;Z=Math.sqrt(da)}else ka=ca=null;ca={avg:R,count:ja,max:ka,min:ca,stddev:Z,sum:Q,variance:da};N&&(ca.nullcount=D.length-ja);!C.percentileParams||Y?.include?.length&&!Y.include.includes("median")||Y?.exclude?.length&&Y.exclude.includes("median")||(ca.median=a(D,C.percentileParams));return ca}function a(C,D){const {fieldType:G,value:N,orderBy:Y,isDiscrete:ca}=D,ka=f(G,"desc"===Y);C=[...C].filter(da=>null!=da).sort((da,ja)=>ka(da,ja));if(0===C.length)return null;if(0>=N)return C[0];
if(1<=N)return C[C.length-1];var Q=(C.length-1)*N,R=Math.floor(Q);D=R+1;Q%=1;R=C[R];const Z=C[D];return D>=C.length||ca||"string"===typeof R||"string"===typeof Z?R:R*(1-Q)+Z*Q}function f(C,D){if(C){if(y.has(C))return D?E:K;if(z.has(C))return d(D,!1);if("esriFieldTypeTimestampOffset"===C)return D?F:B;const ka=d(D,!0);if("esriFieldTypeString"===C)return ka;if("esriFieldTypeGUID"===C||"esriFieldTypeGlobalID"===C)return(Q,R)=>ka(c(Q),c(R))}const G=D?1:-1,N=D?E:K,Y=d(D,!0),ca=D?v:A;return(ka,Q)=>"number"===
typeof ka&&"number"===typeof Q?N(ka,Q):"string"===typeof ka&&"string"===typeof Q?Y(ka,Q):ca(ka,Q)??G}function d(C,D){if(!D)return C?J:H;const G=C?v:A;return C?(N,Y)=>{const ca=G(N,Y);if(null!=ca)return ca;N=N.toUpperCase();Y=Y.toUpperCase();return N>Y?-1:N<Y?1:0}:(N,Y)=>{const ca=G(N,Y);if(null!=ca)return ca;N=N.toUpperCase();Y=Y.toUpperCase();return N<Y?-1:N>Y?1:0}}function c(C){return C.slice(24,36)+C.slice(19,23)+C.slice(16,18)+C.slice(14,16)+C.slice(11,13)+C.slice(9,11)+C.slice(6,8)+C.slice(4,
6)+C.slice(2,4)+C.slice(0,2)}function e(C){return"coded-value"!==C?.type?[]:C.codedValues.map(D=>D.code)}function h(C,D){const G=m({field:D.field,normalizationType:D.normalizationType,normalizationField:D.normalizationField,classificationMethod:D.classificationMethod,standardDeviationInterval:D.standardDeviationInterval,breakCount:D.numClasses||5});C=x(C,D.minValue,D.maxValue);return n.createGenerateRendererClassBreaks({definition:G,values:C,normalizationTotal:D.normalizationTotal})}function x(C,
D,G){const N=null==D?-Infinity:D,Y=null==G?Infinity:G;return C.filter(ca=>Number.isFinite(ca)&&ca>=N&&ca<=Y)}function m(C){const {breakCount:D,field:G,normalizationField:N,normalizationType:Y}=C,ca=C.classificationMethod||"equal-interval";return new q({breakCount:D,classificationField:G,classificationMethod:ca,normalizationField:"field"===Y?N:void 0,normalizationType:Y,standardDeviationInterval:"standard-deviation"===ca?C.standardDeviationInterval||1:void 0,definedInterval:"defined-interval"===ca?
C.definedInterval:void 0})}function p(C,D){const {field:G,classificationMethod:N,standardDeviationInterval:Y,normalizationType:ca,normalizationField:ka,normalizationTotal:Q,minValue:R,maxValue:Z}=D,da=D.numBins||10;let ja=D=null,W=null;N&&"equal-interval"!==N||ca?({classBreaks:C}=h(C,{field:G,normalizationType:ca,normalizationField:ka,normalizationTotal:Q,classificationMethod:N,standardDeviationInterval:Y,minValue:R,maxValue:Z,numClasses:da}),D=C[0].minValue,ja=C[C.length-1].maxValue,W=C.map(aa=>
[aa.minValue,aa.maxValue])):(null!=R&&null!=Z?(D=R,ja=Z):(C=l({values:C,minValue:R,maxValue:Z,useSampleStdDev:!ca,supportsNullCount:k({normalizationType:ca,normalizationField:ka,minValue:R,maxValue:Z})}),D=C.min??null,ja=C.max??null),W=w(D??0,ja??0,da));return{min:D,max:ja,intervals:W}}function t(C,D){let G=-1;for(let N=C.length-1;0<=N;N--)if(D>=C[N][0]){G=N;break}return G}function w(C,D,G){const N=(D-C)/G,Y=[];let ca;for(let ka=1;ka<=G;ka++)ca=C+N,ca=Number(ca.toFixed(16)),Y.push([C,ka===G?D:ca]),
C=ca;return Y}const r=/\s*(\+|-)?((\d+(\.\d+)?)|(\.\d+))\s*/gi,y=new Set("esriFieldTypeDate esriFieldTypeInteger esriFieldTypeSmallInteger esriFieldTypeSingle esriFieldTypeDouble esriFieldTypeLong esriFieldTypeOID esriFieldTypeBigInteger".split(" ")),z=new Set(["esriFieldTypeTimeOnly","esriFieldTypeDateOnly"]),u="min max avg stddev count sum variance nullcount median".split(" "),v=(C,D)=>null==C?null==D?0:1:null==D?-1:null,A=(C,D)=>null==C?null==D?0:-1:null==D?1:null,B=(C,D)=>A(C,D)??(C===D?0:(new Date(C)).getTime()-
(new Date(D)).getTime()),F=(C,D)=>v(C,D)??(C===D?0:(new Date(D)).getTime()-(new Date(C)).getTime()),H=(C,D)=>A(C,D)??(C===D?0:C<D?-1:1),J=(C,D)=>v(C,D)??(C===D?0:C<D?1:-1),E=(C,D)=>v(C,D)??D-C,K=(C,D)=>A(C,D)??C-D;b.calculateClassBreaks=h;b.calculateHistogram=function(C,D){var G=p(C,D);if(null==G.min&&null==G.max)return{bins:[],minValue:G.min,maxValue:G.max,normalizationTotal:D.normalizationTotal};const N=G.intervals,Y=G.min??0;G=G.max??0;const ca=N.map((ka,Q)=>({minValue:N[Q][0],maxValue:N[Q][1],
count:0}));for(const ka of C)null!=ka&&ka>=Y&&ka<=G&&(C=t(N,ka),-1<C&&ca[C].count++);return{bins:ca,minValue:Y,maxValue:G,normalizationTotal:D.normalizationTotal}};b.calculatePercentile=a;b.calculateStatistics=l;b.calculateStringStatistics=function(C){const {outStatisticTypes:D}=C,G=C.returnDistinct?[...(new Set(C.values))]:C.values;var N=G.filter(ca=>null!=ca).sort();const Y=N.length;N={count:Y,min:N[0],max:N[Y-1]};C.supportsNullCount&&(N.nullcount=G.length-Y);!C.percentileParams||D?.include?.length&&
!D.include.includes("median")||D?.exclude?.length&&D.exclude.includes("median")||(N.median=a(G,C.percentileParams));return N};b.calculateUniqueValuesCount=function(C){const D={};for(let G of C){if(null==G||"string"===typeof G&&""===G.trim())G=null;null==D[G]?D[G]={count:1,data:G}:D[G].count++}return{count:D}};b.createClassBreaksDefinition=m;b.createUVResult=function(C,D,G,N){C=C.count;const Y=[];if(G&&D){G=[];var ca=e(D[0]);for(const ka of ca)if(D[1]){ca=e(D[1]);for(const Q of ca)if(D[2]){ca=e(D[2]);
for(const R of ca)G.push(`${g(ka)}${N}${g(Q)}${N}${g(R)}`)}else G.push(`${g(ka)}${N}${g(Q)}`)}else G.push(ka);for(const ka of G)C.hasOwnProperty(ka)||(C[ka]={data:ka,count:0})}for(const ka in C)D=C[ka],Y.push({value:D.data,count:D.count,label:D.label});return{uniqueValueInfos:Y}};b.getAttributeComparator=f;b.getEqualIntervalBins=w;b.getNormalizedValue=function(C,D,G,N){let Y=null;switch(D){case "log":0!==C&&(Y=Math.log(C)*Math.LOG10E);break;case "percent-of-total":Number.isFinite(N)&&0!==N&&(Y=C/
N*100);break;case "field":Number.isFinite(G)&&0!==G&&(Y=C/G);break;case "natural-log":0<C&&(Y=Math.log(C));break;case "square-root":0<C&&(Y=C**.5)}return Y};b.isNullCountSupported=k;b.processNullValue=g;b.processSummaryStatisticsResult=function(C,D,G){let N;for(N in C)D?.include?.length&&!D.include.includes(N)||D?.exclude?.length&&D.exclude.includes(N)?delete C[N]:u.includes(N)&&(Number.isFinite(C[N])||(C[N]=null));if(!G)return C;["avg","stddev","variance"].forEach(Y=>{null!=C[Y]&&(C[Y]=Math.ceil(C[Y]??
0))});return C};b.resolveCBResult=function(C,D){let G=C.classBreaks;const N=G[0]?.minValue,Y=G[G.length-1]?.maxValue,ca="standard-deviation"===D;G=G.map(ka=>{const Q=ka.label;ka={minValue:ka.minValue,maxValue:ka.maxValue,label:Q};if(ca&&Q){const R=Q.match(r)?.map(Z=>+Z.trim())??[];2===R.length?(ka.minStdDev=R[0],ka.maxStdDev=R[1],0>R[0]&&0<R[1]&&(ka.hasAvg=!0)):1===R.length&&(Q.includes("\x3c")?(ka.minStdDev=null,ka.maxStdDev=R[0]):Q.includes("\x3e")&&(ka.minStdDev=R[0],ka.maxStdDev=null))}return ka});
return{minValue:N,maxValue:Y,classBreakInfos:G,normalizationTotal:C.normalizationTotal}};b.statisticTypes=u;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/rest/support/ClassBreaksDefinition":function(){define("../../chunks/tslib.es6 ../../core/jsonMap ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/has ../../core/Logger ../../core/RandomLCG ../../core/accessorSupport/decorators/enumeration ../../core/accessorSupport/decorators/subclass".split(" "),
function(b,q,n,g,k,l,a,f,d){k=new q.JSONMap({esriClassifyEqualInterval:"equal-interval",esriClassifyManual:"manual",esriClassifyNaturalBreaks:"natural-breaks",esriClassifyQuantile:"quantile",esriClassifyStandardDeviation:"standard-deviation",esriClassifyDefinedInterval:"defined-interval"});q=new q.JSONMap({esriNormalizeByLog:"log",esriNormalizeByPercentOfTotal:"percent-of-total",esriNormalizeByField:"field"});n=class extends n.JSONSupport{constructor(c){super(c);this.type="class-breaks-definition";
this.normalizationType=this.normalizationField=this.classificationMethod=this.classificationField=this.breakCount=null}set standardDeviationInterval(c){"standard-deviation"===this.classificationMethod&&this._set("standardDeviationInterval",c)}set definedInterval(c){"defined-interval"===this.classificationMethod&&this._set("definedInterval",c)}};b.__decorate([f.enumeration({classBreaksDef:"class-breaks-definition"})],n.prototype,"type",void 0);b.__decorate([g.property({json:{write:!0}})],n.prototype,
"breakCount",void 0);b.__decorate([g.property({json:{write:!0}})],n.prototype,"classificationField",void 0);b.__decorate([g.property({type:String,json:{read:k.read,write:k.write}})],n.prototype,"classificationMethod",void 0);b.__decorate([g.property({json:{write:!0}})],n.prototype,"normalizationField",void 0);b.__decorate([g.property({json:{read:q.read,write:q.write}})],n.prototype,"normalizationType",void 0);b.__decorate([g.property({value:null,json:{write:!0}})],n.prototype,"standardDeviationInterval",
null);b.__decorate([g.property({value:null,json:{write:!0}})],n.prototype,"definedInterval",null);return n=b.__decorate([d.subclass("esri.rest.support.ClassBreaksDefinition")],n)})},"esri/rest/support/generateRendererUtils":function(){define(["exports","../../core/Logger"],function(b,q){function n(h){var x=h.definition;const {classificationMethod:m,normalizationType:p,definedInterval:t}=x;x=x.breakCount??1;const w=[];var r=h.values;if(0===r.length)return[];r=r.sort((B,F)=>B-F);var y=r[0],z=r[r.length-
1];if("equal-interval"===m)if(r.length>=x){r=(z-y)/x;h=y;for(var u=1;u<x;u++){var v=Number((y+u*r).toFixed(6));w.push({minValue:h,maxValue:v,label:g(h,v,p)});h=v}w.push({minValue:h,maxValue:z,label:g(h,z,p)})}else r.forEach(B=>{w.push({minValue:B,maxValue:B,label:g(B,B,p)})});else if("natural-breaks"===m){r=k(r);h=l(r.uniqueValues,h.valueFrequency||r.valueFrequency,x);for(u=1;u<x;u++)r.uniqueValues.length>u&&(v=Number(r.uniqueValues[h[u]].toFixed(6)),w.push({minValue:y,maxValue:v,label:g(y,v,p)}),
y=v);w.push({minValue:y,maxValue:z,label:g(y,z,p)})}else if("quantile"===m)if(r.length>=x&&y!==z){h=Math.ceil(r.length/x);u=0;for(v=1;v<x;v++){var A=h+u-1;A>r.length&&(A=r.length-1);0>A&&(A=0);w.push({minValue:y,maxValue:r[A],label:g(y,r[A],p)});y=r[A];u+=h;h=Math.ceil((r.length-u)/(x-v))}w.push({minValue:y,maxValue:z,label:g(y,z,p)})}else for(x=-1,z=0;z<r.length;z++)y=r[z],y!==x&&(x=y,w.push({minValue:x,maxValue:y,label:g(x,y,p)}),x=y);else if("standard-deviation"===m)if(h=d(r),u=c(r,h),0===u)w.push({minValue:r[0],
maxValue:r[0],label:g(r[0],r[0],p)});else{r=f(y,z,x,h,u)*u;u=0;for(v=x;1<=v;v--)A=Number((h-(v-.5)*r).toFixed(6)),w.push({minValue:y,maxValue:A,label:g(y,A,p)}),y=A,u++;v=Number((h+.5*r).toFixed(6));w.push({minValue:y,maxValue:v,label:g(y,v,p)});y=v;u++;for(A=1;A<=x;A++)v=u===2*x?z:Number((h+(A+.5)*r).toFixed(6)),w.push({minValue:y,maxValue:v,label:g(y,v,p)}),y=v,u++}else if("defined-interval"===m){if(!t)return w;x=r[0];z=r[r.length-1];r=Math.ceil((z-x)/t);y=x;for(h=1;h<r;h++)u=Number((x+h*t).toFixed(6)),
w.push({minValue:y,maxValue:u,label:g(y,u,p)}),y=u;w.push({minValue:y,maxValue:z,label:g(y,z,p)})}return w}function g(h,x,m){let p=null;return p=h===x?m&&"percent-of-total"===m?h+"%":h.toString():m&&"percent-of-total"===m?h+"% - "+x+"%":h+" - "+x}function k(h){const x=[],m=[];let p=Number.MIN_VALUE,t=1,w=-1;for(let r=0;r<h.length;r++){const y=h[r];y===p?(t++,m[w]=t):null!==y&&(x.push(y),p=y,t=1,m.push(t),w++)}return{uniqueValues:x,valueFrequency:m}}function l(h,x,m){var p=h.length;const t=[];m>p&&
(m=p);for(var w=0;w<m;w++)t.push(Math.round(w*p/m-1));t.push(p-1);w=a(t,h,x,m);p=w.mean;w=w.sdcm;var r=m,y=0,z=0;let u=0,v=0,A=!0;for(let F=0;2>F&&A;F++){0===F&&(A=!1);for(var B=0;B<r-1;B++)for(;t[B+1]+1!==t[B+2];)if(t[B+1]+=1,y=e(B,t,h,x),u=y.sbMean,y=y.sbSdcm,z=e(B+1,t,h,x),v=z.sbMean,z=z.sbSdcm,y+z<w[B]+w[B+1])w[B]=y,w[B+1]=z,p[B]=u,p[B+1]=v,A=!0;else{--t[B+1];break}for(B=r-1;0<B;B--)for(;t[B]!==t[B-1]+1;)if(--t[B],y=e(B-1,t,h,x),u=y.sbMean,y=y.sbSdcm,z=e(B,t,h,x),v=z.sbMean,z=z.sbSdcm,y+z<w[B-
1]+w[B])w[B-1]=y,w[B]=z,p[B-1]=u,p[B]=v,A=!0;else{t[B]+=1;break}}A&&(w=a(t,h,x,m));return t}function a(h,x,m,p){let t=[];var w=[],r=[];let y=0;const z=[],u=[];for(var v=0;v<p;v++){var A=e(v,h,x,m);z.push(A.sbMean);u.push(A.sbSdcm);y+=u[v]}A=y;for(v=!0;v||y<A;){v=!1;t=[];for(w=0;w<p;w++)t.push(h[w]);for(r=0;r<p;r++)for(A=h[r]+1;A<=h[r+1];A++)if(w=x[A],0<r&&A!==h[r+1]&&Math.abs(w-z[r])>Math.abs(w-z[r-1]))h[r]=A;else if(r<p-1&&h[r]!==A-1&&Math.abs(w-z[r])>Math.abs(w-z[r+1])){h[r+1]=A-1;break}A=y;y=0;
w=[];r=[];for(let B=0;B<p;B++){w.push(z[B]);r.push(u[B]);const F=e(B,h,x,m);z[B]=F.sbMean;u[B]=F.sbSdcm;y+=u[B]}}if(y>A){for(x=0;x<p;x++)h[x]=t[x],z[x]=w[x],u[x]=r[x];y=A}return{mean:z,sdcm:u}}function f(h,x,m,p,t){h=Math.max(p-h,x-p)/t/m;return 1<=h?1:.5<=h?.5:.25}function d(h){let x=0;for(let m=0;m<h.length;m++)x+=h[m];return x/=h.length}function c(h,x){let m=0;for(let p=0;p<h.length;p++){const t=h[p];m+=(t-x)*(t-x)}m/=h.length;return Math.sqrt(m)}function e(h,x,m,p){var t=0,w=0;for(var r=x[h]+
1;r<=x[h+1];r++){const y=p[r];t+=m[r]*y;w+=y}0>=w&&q.getLogger("esri.rest.support.generateRendererUtils").warn("Exception in Natural Breaks calculation");t/=w;w=0;for(r=x[h]+1;r<=x[h+1];r++)w+=p[r]*(m[r]-t)**2;return{sbMean:t,sbSdcm:w}}b.createGenerateRendererClassBreaks=function(h){const {normalizationTotal:x}=h;return{classBreaks:n(h),normalizationTotal:x}};b.createGenerateRendererUniqueValues=function(h){h=k(h);const x=[],m=h.uniqueValues.length;for(let p=0;p<m;p++){const t=h.uniqueValues[p];x.push({value:t,
count:h.valueFrequency[p],label:t.toString()})}return{uniqueValues:x}};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/SnappingCandidate":function(){define(["exports"],function(b){b.makeEdgeCandidate=function(q,n,g,k,l,a=!1){return{objectId:q,target:n,distance:g,type:"edge",start:k,end:l,draped:a}};b.makeVertexCandidate=function(q,n,g){return{objectId:q,target:n,distance:g,type:"vertex"}};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/queryUtils":function(){define("require exports ../../../core/jsonMap ../../../core/unitUtils ../../../geometry/projection ../../../geometry/support/extentUtils ../../../geometry/support/jsonUtils ../../../geometry/support/normalizeUtils ../../../geometry/support/spatialReferenceUtils ./projectionSupport".split(" "),
function(b,q,n,g,k,l,a,f,d,c){async function e(w,r,y){if(!w)return null;var {where:z}=w;w.where=z=z?.trim();if(!z||/^1 *= *1$/.test(z)||r&&r===z)w.where=null;if(!w.geometry)return w;r=await x(w);w.distance=0;w.units=null;"esriSpatialRelEnvelopeIntersects"===w.spatialRel&&({spatialReference:z}=w.geometry,r=l.getGeometryExtent(r),r.spatialReference=z);if(r){await c.checkProjectionSupport(r.spatialReference,y);z=r.spatialReference;r=h(r,y)&&a.isExtent(r)?{spatialReference:z,rings:[[[r.xmin,r.ymin],[r.xmin,
r.ymax],[r.xmax,r.ymax],[r.xmax,r.ymin],[r.xmin,r.ymin]]]}:r;z=(await f.normalizeCentralMeridian(a.fromJSON(r)))[0];if(null==z)throw t;const u="quantizationParameters"in w&&w.quantizationParameters?.tolerance||"maxAllowableOffset"in w&&w.maxAllowableOffset||0;r=u&&h(r,y)?{densificationStep:8*u}:void 0;z=z.toJSON();r=c.project(z,z.spatialReference,y,r);if(!r)throw t;r.spatialReference=y;w.geometry=r}return w}function h(w,r){if(!w)return!1;const y=w.spatialReference;return(a.isExtent(w)||a.isPolygon(w)||
a.isPolyline(w))&&!d.equals(y,r)&&!k.canProjectWithoutEngine(y,r)}async function x(w){const {distance:r,units:y}=w,z=w.geometry;if(null==r||"vertexAttributes"in z)return z;var u=z.spatialReference;w=y?p.fromJSON(y):g.getUnitString(u);u=u&&(d.isGeographic(u)||d.isWebMercator(u))?z:await c.checkProjectionSupport(u,d.wgs84).then(()=>c.project(z,d.wgs84));return(await m())(u.spatialReference,u,r,w)}async function m(){return(await new Promise((w,r)=>b(["../../../geometry/geometryEngineJSON"],w,r))).geodesicBuffer}
const p=new n.JSONMap({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"}),t=Object.freeze({});q.normalizeQuery=async function(w,r,y){const {outFields:z,orderByFields:u,groupByFieldsForStatistics:v,outStatistics:A}=w;if(z)for(var B=0;B<z.length;B++)z[B]=z[B].trim();if(u)for(B=0;B<u.length;B++)u[B]=u[B].trim();if(v)for(B=0;B<v.length;B++)v[B]=v[B].trim();
if(A)for(B=0;B<A.length;B++)A[B].onStatisticField&&(A[B].onStatisticField=A[B].onStatisticField.trim());w.geometry&&!w.outSR&&(w.outSR=w.geometry.spatialReference);return e(w,r,y)};q.normalizeQueryLike=e;q.queryEngineEmptyResult=t;q.unitsKebabDict=p;Object.defineProperty(q,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/queryValidationUtils":function(){define("exports ../../../core/Error ./attributeSupport ./projectionSupport ./spatialQuerySupport ../../../support/arcadeOnDemand".split(" "),
function(b,q,n,g,k,l){function a(h,x,m){const {outFields:p,orderByFields:t,returnDistinctValues:w,outStatistics:r}=m,y=r?r.map(z=>z.outStatisticFieldName&&z.outStatisticFieldName.toLowerCase()).filter(Boolean):[];if(t&&0<t.length){const z=t.map(u=>{const v=u.toLowerCase();return v.includes(" asc")?v.split(" asc")[0]:v.includes(" desc")?v.split(" desc")[0]:u}).filter(u=>!y.includes(u));n.validateFields(h,x,z,{expressionName:"orderByFields",query:m})}if(p&&0<p.length)n.validateFields(h,x,p,{expressionName:"outFields",
query:m,allowedFieldTypes:"all"});else if(w)throw new q("unsupported-query","outFields should be specified for returnDistinctValues",{query:m});n.validateWhere(h,x,m.where,m)}function f(h,x,m){const {outStatistics:p,groupByFieldsForStatistics:t,having:w}=m;var r=t?.length,y=p?.length;if(w){if(!r||!y)throw new q("unsupported-query","outStatistics and groupByFieldsForStatistics should be specified with having",{query:m});n.validateHaving(h,x,w,p,m)}if(y&&c(p)){y=p.map(z=>z.onStatisticField).filter(Boolean);
n.validateFields(h,x,y,{expressionName:"onStatisticFields",query:m});r&&n.validateFields(h,x,t,{expressionName:"groupByFieldsForStatistics",query:m});for(const z of p){const {onStatisticField:u,statisticType:v}=z;if(("percentile_disc"===v||"percentile_cont"===v)&&"statisticParameters"in z){if({statisticParameters:r}=z,!r)throw new q("unsupported-query","statisticParameters should be set for percentile type",{definition:z,query:m});}else h.get(u)&&"count"!==v&&"min"!==v&&"max"!==v&&n.validateFields(h,
x,[u],{expressionName:`outStatistics with '${v}' statistic type`,allowedFieldTypes:e,query:m})}}}async function d(h,x,m,p){var t=[];m.valueExpression&&({arcadeUtils:t}=await l.loadArcade(),t=t.extractFieldNames(m.valueExpression));m.field&&t.push(m.field);m.field2&&t.push(m.field2);m.field3&&t.push(m.field3);m.normalizationField&&t.push(m.normalizationField);if(!t.length&&!m.valueExpression)throw new q("unsupported-query","field or valueExpression is required",{params:m});n.validateFields(h,x,t,{expressionName:"statistics",
query:p})}function c(h){return null!=h&&h.every(x=>"exceedslimit"!==x.statisticType)}const e=new Set([...n.numericFieldTypes,...n.allDateAndTimeFieldTypes]);b.validateQuery=async function(h,{fieldsIndex:x,geometryType:m,spatialReference:p,availableFields:t}){if(0>(h.distance??0)||null!=h.geometryPrecision||h.multipatchOption&&"xyFootprint"!==h.multipatchOption||h.pixelSize||h.relationParam||h.text)throw new q("unsupported-query","Unsupported query options",{query:h});a(x,t,h);f(x,t,h);return Promise.all([k.checkSpatialQuerySupport(h,
m,p),g.checkProjectionSupport(p,h.outSR)]).then(()=>h)};b.validateStatisticsQuery=async function(h,x,{fieldsIndex:m,geometryType:p,spatialReference:t,availableFields:w}){if(0>(h.distance??0)||null!=h.geometryPrecision||h.multipatchOption||h.pixelSize||h.relationParam||h.text||h.outStatistics||h.groupByFieldsForStatistics||h.having||h.orderByFields)throw new q("unsupported-query","Unsupported query options",{query:h});a(m,w,h);return Promise.all([d(m,w,x,h),k.checkSpatialQuerySupport(h,p,t),g.checkProjectionSupport(t,
h.outSR)]).then(()=>h)};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/spatialQuerySupport":function(){define("require exports ../../../core/Error ../../../geometry/support/contains ../../../geometry/support/intersects ../../../geometry/support/jsonUtils ../../../geometry/support/spatialReferenceUtils ../contains ../featureConversionUtils ../OptimizedGeometry ./geometryUtils ./projectionSupport".split(" "),function(b,q,n,g,k,l,a,f,d,c,e,h){function x(){return new Promise((r,
y)=>b(["../../../geometry/geometryEngineJSON"],r,y))}const m={esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"intersects",esriSpatialRelIndexIntersects:null,esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:null};var p={esriSpatialRelIntersects:!0,esriSpatialRelContains:!0,esriSpatialRelWithin:!0,esriSpatialRelCrosses:!0,
esriSpatialRelDisjoint:!0,esriSpatialRelTouches:!0,esriSpatialRelOverlaps:!0,esriSpatialRelEnvelopeIntersects:!0,esriSpatialRelIndexIntersects:!1,esriSpatialRelRelation:!1},t={esriGeometryPoint:!0,esriGeometryMultiPatch:!1,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!0},w={esriGeometryPoint:!0,esriGeometryMultiPatch:!0,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!1};q.canQueryWithRBush=function(r){if(l.isExtent(r))return!0;
if(l.isPolygon(r)){for(const y of r.rings)if(5!==y.length||y[0][0]!==y[1][0]||y[0][0]!==y[4][0]||y[2][0]!==y[3][0]||y[0][1]!==y[3][1]||y[0][1]!==y[4][1]||y[1][1]!==y[2][1])return!1;return!0}return!1};q.checkSpatialQuerySupport=async function(r,y,z){const {spatialRel:u,geometry:v}=r;if(v){if(null==u||!0!==p[u])throw new n("unsupported-query","Unsupported query spatial relationship",{query:r});if(a.isValid(v.spatialReference)&&a.isValid(z)){if(null==v||!0!==t[l.getJsonType(v)])throw new n("unsupported-query",
"Unsupported query geometry type",{query:r});if(null==y||!0!==w[y])throw new n("unsupported-query","Unsupported layer geometry type",{query:r});if(r.outSR)return h.checkProjectionSupport(r.geometry?.spatialReference,r.outSR)}}};q.getSpatialQueryOperator=function(r,y,z,u,v){if(l.isPolygon(y)&&"esriGeometryPoint"===z&&("esriSpatialRelIntersects"===r||"esriSpatialRelContains"===r)){const A=d.convertFromPolygon(new c,y,!1,!1);return Promise.resolve(B=>f.polygonContainsPoint(A,!1,!1,B))}if(l.isPolygon(y)&&
"esriGeometryMultipoint"===z){const A=d.convertFromPolygon(new c,y,!1,!1);if("esriSpatialRelContains"===r)return Promise.resolve(B=>f.polygonContainsMultipoint(A,!1,!1,B,u,v))}if(l.isExtent(y)&&"esriGeometryPoint"===z&&("esriSpatialRelIntersects"===r||"esriSpatialRelContains"===r))return Promise.resolve(A=>g.extentContainsPoint(y,e.getGeometry(z,u,v,A)));if(l.isExtent(y)&&"esriGeometryMultipoint"===z&&"esriSpatialRelContains"===r)return Promise.resolve(A=>g.extentContainsMultipoint(y,e.getGeometry(z,
u,v,A)));if(l.isExtent(y)&&"esriSpatialRelIntersects"===r){const A=k.getExtentIntersector(z);return Promise.resolve(B=>A(y,e.getGeometry(z,u,v,B)))}return x().then(A=>{const B=A[m[r]].bind(null,y.spatialReference,y);return F=>B(e.getGeometry(z,u,v,F))})};Object.defineProperty(q,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/intersects":function(){define(["exports","./intersectsBase"],function(b,q){b.extentIntersectsExtent=q.extentIntersectsExtent;b.extentIntersectsMultipoint=q.extentIntersectsMultipoint;
b.extentIntersectsPoint=q.extentIntersectsPoint;b.extentIntersectsPolygon=q.extentIntersectsPolygon;b.extentIntersectsPolyline=q.extentIntersectsPolyline;b.getFeatureExtentIntersector=q.getFeatureExtentIntersector;b.isSelfIntersecting=q.isSelfIntersecting;b.segmentIntersects=q.segmentIntersects;b.getExtentIntersector=function(n){return"mesh"===n?q.extentIntersectsExtent:q.getFeatureExtentIntersector(n)};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/contains":function(){define(["exports"],
function(b){function q(n,g,k,l,a){if(!n)return!1;g=g?k?4:3:k?3:2;const {coords:f,lengths:d}=n;k=!1;n=0;for(const e of d){var c=n;for(let h=n,x=n+e*g;h<x;h+=g){c=h+g;c===x&&(c=n);const m=f[h],p=f[h+1],t=f[c];c=f[c+1];(p<a&&c>=a||c<a&&p>=a)&&m+(a-p)/(c-p)*(t-m)<l&&(k=!k)}n+=e*g}return k}b.polygonContainsCoords=q;b.polygonContainsMultipoint=function(n,g,k,l,a,f){a=a?f?4:3:f?3:2;const {coords:d,lengths:c}=l;if(!c)return!1;for(let e=0,h=0;e<c.length;e++,h+=a)if(!q(n,g,k,d[h],d[h+1]))return!1;return!0};
b.polygonContainsPoint=function(n,g,k,l){return q(n,g,k,l.coords[0],l.coords[1])};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/timeSupport":function(){define(["exports"],function(b){function q(k,l,a,f,d){if(null!=f&&null!=d)return c=>{const e=k(c,l);c=k(c,a);return(null==e||e<=d)&&(null==c||c>=f)};if(null!=f)return c=>{c=k(c,a);return null==c||c>=f};if(null!=d)return c=>{c=k(c,l);return null==c||c<=d}}function n(k,l,a,f){if(null!=a&&null!=f&&a===f)return d=>
k(d,l)===a;if(null!=a&&null!=f)return d=>{d=k(d,l);return null!=d&&d>=a&&d<=f};if(null!=a)return d=>{d=k(d,l);return null!=d&&d>=a};if(null!=f)return d=>{d=k(d,l);return null!=d&&d<=f}}function g(){return()=>!1}b.getTimeExtent=async function(k,l){if(!k)return null;const a=l.featureAdapter,{startTimeField:f,endTimeField:d}=k;let c=Number.POSITIVE_INFINITY,e=Number.NEGATIVE_INFINITY;if(f&&d)await l.forEach(h=>{const x=a.getAttribute(h,f);h=a.getAttribute(h,d);null==x||isNaN(x)||(c=Math.min(c,x));null==
h||isNaN(h)||(e=Math.max(e,h))});else{const h=f||d;await l.forEach(x=>{x=a.getAttribute(x,h);null==x||isNaN(x)||(c=Math.min(c,x),e=Math.max(e,x))})}return{start:c,end:e}};b.getTimeOperator=function(k,l,a){if(!l||!k)return null;const {startTimeField:f,endTimeField:d}=k;if(!f&&!d)return null;const {start:c,end:e}=l;if(null===c&&null===e)return null;if(void 0===c&&void 0===e)return g();k=a.getAttributeAsTimestamp?.bind(a)??a.getAttribute.bind(a);return f&&d?q(k,f,d,c,e):n(k,f||d,c,e)};Object.defineProperty(b,
Symbol.toStringTag,{value:"Module"})})},"esri/views/support/Scheduler":function(){define("exports ../../core/Handles ../../core/has ../../core/Logger ../../core/maybe ../../core/PerformanceSampler ../../core/PooledArray ../../core/promiseUtils ../../core/reactiveUtils ../../core/signal ../../core/time ../../layers/support/PromiseQueue ./debugFlags ./RenderState ./Yield".split(" "),function(b,q,n,g,k,l,a,f,d,c,e,h,x,m,p){function t(J){return w.has(J)?w.get(J):"number"===typeof J?J:1}b.TaskPriority=
void 0;(function(J){J.RESOURCE_CONTROLLER_IMMEDIATE="immediate";J.RESOURCE_CONTROLLER="schedule";J.SLIDE="slide";J.STREAM_DATA_LOADER="stream loader";J.ELEVATION_QUERY="elevation query";J.TERRAIN_SURFACE="terrain";J.SURFACE_GEOMETRY_UPDATES="surface geometry updates";J.LOD_RENDERER="LoD renderer";J.GRAPHICS_CORE="Graphics3D";J.I3S_CONTROLLER="I3S";J.POINT_CLOUD_LAYER="point cloud";J.FEATURE_TILE_FETCHER="feature fetcher";J.OVERLAY="overlay";J.STAGE="stage";J.GRAPHICS_DECONFLICTOR="graphics deconflictor";
J.FILTER_VISIBILITY="Graphics3D filter visibility";J.SCALE_VISIBILITY="Graphics3D scale visibility";J.FRUSTUM_VISIBILITY="Graphics3D frustum visibility";J.POINT_OF_INTEREST_FREQUENT="POI frequent";J.POINT_OF_INTEREST_INFREQUENT="POI infrequent";J.LABELER="labeler";J.FEATURE_QUERY_ENGINE="feature query";J.FEATURE_TILE_TREE="feature tile tree";J.FEATURE_TILE_TREE_ACTIVE="fast feature tile tree";J.ELEVATION_ALIGNMENT="elevation alignment";J.ELEVATION_ALIGNMENT_SCENE="elevation alignment scene";J.TEXT_TEXTURE_ATLAS=
"text texture atlas";J.TEXTURE_UNLOAD="texture unload";J.LINE_OF_SIGHT_TOOL="line of sight tool";J.LINE_OF_SIGHT_TOOL_INTERACTIVE="interactive line of sight tool";J.ELEVATION_PROFILE="elevation profile";J.SNAPPING="snapping";J.SHADOW_ACCUMULATOR="shadow accumulator";J.CLOUDS_GENERATOR="clouds generator";J.MAPVIEW_FETCH_QUEUE="mapview fetch queue";J.MAPVIEW_LAYERVIEW_UPDATE="mapview layerview update";J.MAPVIEW_VECTOR_TILE_PARSING_QUEUE="mapview vector tile parsing queue";J[J.NONE=0]="NONE";J[J.TEST_PRIO=
1]="TEST_PRIO"})(b.TaskPriority||(b.TaskPriority={}));const w=new Map([[b.TaskPriority.RESOURCE_CONTROLLER_IMMEDIATE,0],[b.TaskPriority.RESOURCE_CONTROLLER,4],[b.TaskPriority.SLIDE,0],[b.TaskPriority.STREAM_DATA_LOADER,0],[b.TaskPriority.ELEVATION_QUERY,0],[b.TaskPriority.TERRAIN_SURFACE,1],[b.TaskPriority.SURFACE_GEOMETRY_UPDATES,1],[b.TaskPriority.LOD_RENDERER,2],[b.TaskPriority.GRAPHICS_CORE,2],[b.TaskPriority.I3S_CONTROLLER,2],[b.TaskPriority.POINT_CLOUD_LAYER,2],[b.TaskPriority.FEATURE_TILE_FETCHER,
2],[b.TaskPriority.CLOUDS_GENERATOR,2],[b.TaskPriority.OVERLAY,4],[b.TaskPriority.STAGE,4],[b.TaskPriority.GRAPHICS_DECONFLICTOR,4],[b.TaskPriority.FILTER_VISIBILITY,4],[b.TaskPriority.SCALE_VISIBILITY,4],[b.TaskPriority.FRUSTUM_VISIBILITY,4],[b.TaskPriority.POINT_OF_INTEREST_FREQUENT,6],[b.TaskPriority.POINT_OF_INTEREST_INFREQUENT,30],[b.TaskPriority.LABELER,8],[b.TaskPriority.FEATURE_QUERY_ENGINE,8],[b.TaskPriority.FEATURE_TILE_TREE,16],[b.TaskPriority.FEATURE_TILE_TREE_ACTIVE,0],[b.TaskPriority.ELEVATION_ALIGNMENT,
12],[b.TaskPriority.ELEVATION_ALIGNMENT_SCENE,14],[b.TaskPriority.TEXT_TEXTURE_ATLAS,12],[b.TaskPriority.TEXTURE_UNLOAD,12],[b.TaskPriority.LINE_OF_SIGHT_TOOL,16],[b.TaskPriority.LINE_OF_SIGHT_TOOL_INTERACTIVE,0],[b.TaskPriority.SNAPPING,0],[b.TaskPriority.SHADOW_ACCUMULATOR,30],[b.TaskPriority.MAPVIEW_FETCH_QUEUE,0],[b.TaskPriority.MAPVIEW_LAYERVIEW_UPDATE,2],[b.TaskPriority.MAPVIEW_VECTOR_TILE_PARSING_QUEUE,0]]),r=e.Milliseconds(6.5),y=e.Milliseconds(1),z=e.Milliseconds(30),u=e.Milliseconds(1E3/
30),v=e.Milliseconds(100);var A;(function(J){class E{get updating(){return this._updating.value}_updatingChanged(){this._updating.value=this._tasks.some(D=>D.needsUpdate)}constructor(){this._updating=c.signal(!0);this._microTaskQueued=!1;this._frameNumber=0;this.performanceInfo={total:new l("total"),tasks:new Map};this._frameTaskTimes=new Map;this._budget=new C;this._state=m.RenderState.INTERACTING;this._tasks=new a;this._runQueue=new a;this._load=0;this._idleStateCallbacks=new a;this._debug=this._forceTask=
this._idleUpdatesStartFired=!1;this._debugHandle=d.watch(()=>x.SCHEDULER_LOG_SLOW_TASKS,D=>this._debug=D,d.initial);for(const D of Object.keys(b.TaskPriority))this.performanceInfo.tasks.set(b.TaskPriority[D],new l(b.TaskPriority[D]))}destroy(){this._tasks.toArray().forEach(D=>D.remove());this._tasks.clear();k.removeMaybe(this._debugHandle);this._microTaskQueued=!1;this._updatingChanged()}taskRunningChanged(D){this._updatingChanged();D&&0<this._budget.remaining&&!this._microTaskQueued&&(this._microTaskQueued=
!0,queueMicrotask(()=>{this._microTaskQueued&&(this._microTaskQueued=!1,0<this._budget.remaining&&this._schedule()&&this.frame())}))}registerTask(D,G){G=new K(this,D,G);this._tasks.push(G);this._updatingChanged();this.performanceInfo.tasks.has(D)||this.performanceInfo.tasks.set(D,new l(D));return G}registerIdleStateCallbacks(D,G){const N={idleBegin:D,idleEnd:G};this._idleStateCallbacks.push(N);this.state===m.RenderState.IDLE&&this._idleUpdatesStartFired&&N.idleBegin();const Y=this;return{remove:()=>
this._removeIdleStateCallbacks(N),set idleBegin(ca){Y._idleUpdatesStartFired&&(N.idleEnd(),Y._state===m.RenderState.IDLE&&ca());N.idleBegin=ca},set idleEnd(ca){N.idleEnd=ca}}}get load(){return this._load}set state(D){this._state!==D&&(this._state=D,this.state!==m.RenderState.IDLE&&this._idleUpdatesStartFired&&(this._idleUpdatesStartFired=!1,this._idleStateCallbacks.forAll(G=>G.idleEnd())))}get state(){return this._state}updateBudget(D){this._test&&(this._test.usedBudget=0);++this._frameNumber;let G=
r,N=D.frameDuration,Y=y;switch(this.state){case m.RenderState.IDLE:G=e.Milliseconds(0);N=e.Milliseconds(Math.max(v,D.frameDuration));Y=z;break;case m.RenderState.INTERACTING:N=e.Milliseconds(Math.max(u,D.frameDuration))}N=e.Milliseconds(N-D.elapsedFrameTime-G);if(this.state!==m.RenderState.IDLE&&N<y&&!this._forceTask)return this._forceTask=!0,!1;N=e.Milliseconds(Math.max(N,Y));this._budget.reset(N,this.state);this._updateLoad();return this._schedule()}frame(){this._microTaskQueued=this._forceTask=
!1;switch(this.state){case m.RenderState.IDLE:this._idleUpdatesStartFired||(this._idleUpdatesStartFired=!0,this._idleStateCallbacks.forAll(D=>D.idleBegin()));this._runIdle();break;case m.RenderState.INTERACTING:this._runInteracting();break;default:this._runAnimating()}this._test&&(this._test.usedBudget=this._budget.elapsed)}stopFrame(){this._budget.reset(e.Milliseconds(0),this._state);this._budget.madeProgress()}_removeIdleStateCallbacks(D){this._idleUpdatesStartFired&&D.idleEnd();this._idleStateCallbacks.removeUnordered(D)}removeTask(D){this._tasks.removeUnordered(D);
this._runQueue.removeUnordered(D);this._updatingChanged()}_updateTask(D){this._tasks.forAll(G=>{G.name===D&&G.setPriority(D)})}_getState(D){if(this._runQueue.some(N=>N.name===D))return b.TaskState.SCHEDULED;let G=b.TaskState.IDLE;this._tasks.forAll(N=>{N.name===D&&N.needsUpdate&&(1>=N.schedulePriority?G=b.TaskState.READY:G!==b.TaskState.READY&&(G=b.TaskState.WAITING))});return G}_getRuntime(D){let G=0;this._tasks.forAll(N=>{N.name===D&&(G+=N.runtime)});return G}_resetRuntimes(){this._tasks.forAll(D=>
D.runtime=0)}_getRunning(){const D=new Map;this._tasks.forAll(N=>{N.needsUpdate&&D.set(N.name,(D.get(N.name)||0)+1)});if(0===D.size)return null;let G="";D.forEach((N,Y)=>{G=1<N?G+` ${N}x ${Y}`:G+` ${Y}`});return G}_runIdle(){this._run()}_runInteracting(){this._run()}_runAnimating(){this._run()}_updateLoad(){const D=this._tasks.reduce((G,N)=>N.needsUpdate?++G:G,0);this._load=.9*this._load+D*(1-.9)}_schedule(){this._runQueue.filterInPlace(D=>{if(D.needsUpdate)return!0;D.schedulePriority=D.basePriority;
return!1});for(this._tasks.forAll(D=>{0===D.basePriority&&D.needsUpdate&&!this._runQueue.includes(D)&&D.blockFrame!==this._frameNumber&&this._runQueue.unshift(D)});0===this._runQueue.length;){let D=!1;this._tasks.forAll(G=>{if(G.needsUpdate&&0!==G.schedulePriority&&0!==G.basePriority&&G.blockFrame!==this._frameNumber)switch(D=!0,G.schedulePriority){case 1:G.schedulePriority=0;this._runQueue.push(G);break;default:--G.schedulePriority}});if(!D)return this._updatingChanged(),!1}this._updatingChanged();
return!0}_run(){const D=this._budget.now();this._startFrameTaskTimes();do for(;0<this._runQueue.length;){var G=this._budget.now();const N=this._runQueue.pop();this._budget.resetProgress();try{N.task.runTask(this._budget)===p.Yield&&(N.blockFrame=this._frameNumber)}catch(Y){g.getLogger("esri.views.support.Scheduler").error(`Exception in task "${N.name}"`,Y),N.blockFrame=this._frameNumber}!this._budget.hasProgressed&&N.blockFrame!==this._frameNumber&&N.needsUpdate&&(N.blockFrame=this._frameNumber);
N.schedulePriority=N.basePriority;G=this._budget.now()-G;N.runtime+=G;this._frameTaskTimes.set(N.priority,this._frameTaskTimes.get(N.priority)+G);if(0>=this._budget.remaining){this._updatingChanged();this._recordFrameTaskTimes(this._budget.now()-D);return}}while(this._schedule());this._updatingChanged();this._recordFrameTaskTimes(this._budget.now()-D)}_startFrameTaskTimes(){for(const D of Object.keys(b.TaskPriority))this._frameTaskTimes.set(b.TaskPriority[D],0)}_recordFrameTaskTimes(D){this._frameTaskTimes.forEach((G,
N)=>this.performanceInfo.tasks.get(N).push(G));this.performanceInfo.total.push(D)}get test(){return this._test}}J.Scheduler=E;class K{get task(){return this._task.value}get updating(){return this._queue.running}constructor(D,G,N){this._scheduler=D;this.name=G;this.runtime=this.blockFrame=0;this._queue=new h.PromiseQueue;this._handles=new q;this.schedulePriority=this._basePriority=t(G);this._task=c.signal(null!=N?N:this._queue);this._handles.add(d.when(()=>this.task.running,Y=>D.taskRunningChanged(Y)))}remove(){this.processQueue(B);
this._scheduler.removeTask(this);this.schedule=H.schedule;this.reschedule=H.reschedule;this._handles.destroy()}get basePriority(){return this._basePriority}setPriority(D){if(this.name!==D){this.name=D;D=t(D);if(0===this._basePriority||0!==this.schedulePriority)this.schedulePriority=D;this._basePriority=D}}get priority(){return this.name}set priority(D){this.setPriority(D)}get needsUpdate(){return this.updating||this.task.running}schedule(D,G,N){return this._queue.push(D,G,N)}reschedule(D,G,N){return this._queue.unshift(D,
G,N)}processQueue(D){return this._queue.runTask(D)}}class C{constructor(){this._begin="undefined"!==typeof performance?performance.now():0;this._budget=0;this._state=m.RenderState.IDLE;this._progressed=this._done=!1;this._enabled=!0}run(D){if(this.done)return!1;!0===D()&&this.madeProgress();return!0}get done(){return this._done}get budget(){return this._budget}madeProgress(){this._progressed=!0;return this._done=this.elapsed>=this._budget&&this._enabled}get state(){return this._state}get enabled(){return this._enabled}set enabled(D){this._enabled=
D}reset(D,G){this._begin=this.now();this._budget=D;this._state=G;this.resetProgress()}get remaining(){return Math.max(this._budget-this.elapsed,0)}now(){return performance.now()}get elapsed(){return this.now()-this._begin}resetProgress(){this._done=this._progressed=!1}get hasProgressed(){return this._progressed}}J.Budget=C})(A||={});b.TaskState=void 0;(function(J){J.SCHEDULED="s";J.READY="r";J.WAITING="w";J.IDLE="i"})(b.TaskState||(b.TaskState={}));const B=(()=>{const J=new A.Budget;J.enabled=!1;
return J})();class F{remove(){}processQueue(){}schedule(J,E,K){try{if(f.isAborted(E)){const C=f.createAbortError();return K?Promise.resolve(K(C)):Promise.reject(C)}return f.when(J(B))}catch(C){return Promise.reject(C)}}reschedule(J,E,K){return this.schedule(J,E,K)}}const H=new F;b.ImmediateTask=H;b.getTaskPriority=t;b.newScheduler=function(){return new A.Scheduler};b.noBudget=B;b.taskPriorities=w;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/PromiseQueue":function(){define(["exports",
"../../core/promiseUtils","../../core/signal","../../views/support/Yield"],function(b,q,n,g){class k{constructor(){this._tasks=[];this._runningTasks=n.signal(0)}get length(){return this._tasks.length}get running(){return 0<this._runningTasks.value}destroy(){this.cancelAll()}runTask(a){if(0===this.length)return g.Yield;for(;!a.done&&this._process(a);)a.madeProgress()}push(a,f,d){++this._runningTasks.value;return(new Promise((c,e)=>this._tasks.push(new l(c,e,a,f,d)))).finally(()=>--this._runningTasks.value)}unshift(a,
f,d){++this._runningTasks.value;return(new Promise((c,e)=>this._tasks.unshift(new l(c,e,a,f,d)))).finally(()=>--this._runningTasks.value)}_process(a){if(0===this._tasks.length)return!1;const f=this._tasks.shift();try{const d=q.isAborted(f.signal);if(d&&!f.abortCallback)f.reject(q.createAbortError());else{const c=d?f.abortCallback?.(q.createAbortError()):f.callback(a);q.isPromiseLike(c)?c.then(f.resolve,f.reject):f.resolve(c)}}catch(d){f.reject(d)}return!0}cancelAll(){const a=q.createAbortError();
for(const f of this._tasks)if(f.abortCallback){const d=f.abortCallback(a);f.resolve(d)}else f.reject(a);this._tasks.length=0}}class l{constructor(a,f,d,c,e){this.resolve=a;this.reject=f;this.callback=d;this.signal=c;this.abortCallback=e}}b.PromiseQueue=k;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/support/Yield":function(){define(["exports"],function(b){const q=Symbol("Yield");b.Yield=q;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/support/debugFlags":function(){define("../../chunks/tslib.es6 ../../core/Accessor ../../core/accessorSupport/decorators/property ../../core/has ../../core/Logger ../../core/RandomLCG ../../core/accessorSupport/decorators/subclass".split(" "),
function(b,q,n,g,k,l,a){q=class extends q{constructor(){super(...arguments);this.FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES=this.SCHEDULER_LOG_SLOW_TASKS=!1}};b.__decorate([n.property()],q.prototype,"SCHEDULER_LOG_SLOW_TASKS",void 0);b.__decorate([n.property()],q.prototype,"FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES",void 0);q=b.__decorate([a.subclass("esri.views.support.debugFlags")],q);return new q})},"esri/views/support/RenderState":function(){define(["exports"],function(b){b.RenderState=
void 0;var q=b.RenderState||(b.RenderState={});q[q.ANIMATING=0]="ANIMATING";q[q.INTERACTING=1]="INTERACTING";q[q.IDLE=2]="IDLE";Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/processor/AProcessorStrategy":function(){define(["exports"],function(b){class q{constructor(g){this.subscription=g;this.handledChunks=new Set}destroy(){}}class n{constructor(g,k){this._source=g;this._attributeStore=k;this._sendStates=new Map}destroy(){}get enablePixelBuffering(){return!0}onSubscribe(g){const k=
this.createState(g);this._sendStates.set(g.key.id,k);this.updateChunks()}onUnsubscribe(g){this._sendStates.get(g.key.id)?.destroy();this._sendStates.delete(g.key.id)}invalidate(){const g=Array.from(this._sendStates.values());this._sendStates.clear();for(const k of g)k.destroy(),this.onSubscribe(k.subscription)}invalidateAttributeData(){}getFeatureObjectIdsForAggregate(g){throw Error("InternalError: AggregateId lookup not supported");}getDisplayIds(g){return this.displayMap(g,k=>k,k=>k)}getDisplayAndObjectIds(g){return this.displayMap(g,
k=>k,(k,l,a)=>[k,a])}beforeUpdateChunks(){}afterUpdateChunks(){}}b.AProcessorStrategy=n;b.ASendState=q;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/sources/FeatureSourceMessage":function(){define(["exports"],function(b){class q{constructor(g,k,l,a,f){this.subscription=g;this.reader=k;this.clear=l;this.end=a;this.debugInfo=f;this.type="append"}get id(){return this.subscription.tile.id}createMessage(g,k,l){return{type:"append",clear:this.clear,id:this.id,
append:g,end:this.end,debugInfo:this.debugInfo,subscriptionVesrion:this.subscription.version,version:k,attributeEpoch:l}}}class n{constructor(g,k,l,a,f){this.subscription=g;this.reader=k;this.remove=l;this.end=a;this.debugInfo=f;this.type="update"}get id(){return this.subscription.tile.id}createMessage(g,k,l){return{type:"update",id:this.id,modify:g,debugInfo:this.debugInfo,remove:this.remove,version:k,subscriptionVesrion:this.subscription.version,end:this.end,attributeEpoch:l}}}b.FeatureTileAppendMessage=
q;b.FeatureTileUpdateMessage=n;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/sources/strategies/chunks/OverrideChunk":function(){define(["exports","./ASourceChunk","../../../support/FeatureSetReaderJSON"],function(b,q,n){class g extends q.ASourceChunk{constructor(k,l){super();this.metadata=k;this.removed=new Set;this.overriddenIds=new Set;this._features=[];this.normalizedChunkId=this.chunkId=l}get reader(){return n.FeatureSetReaderJSON.fromOptimizedFeatures(this._features,
this.metadata)}get queryInfo(){return{}}get first(){return!1}get end(){return!1}get isTiled(){return!1}get lastLocalEditDropped(){return this._lastLocalEditDropped}applyOverrides(k){this._onChange();const {reader:l,removed:a}=k;k=[];const f=new Set;var d=l.getCursor();const c=new Set(a);for(this.overriddenIds.clear();d.next();){const e=d.readOptimizedFeatureWorldSpace(),h=e.objectId;k.push(e);f.add(h);this.overriddenIds.add(h);this.removed.delete(h)}for(const e of this._features)d=e.objectId,c.has(d)||
f.has(d)||(k.push(e),this.overriddenIds.add(d));this._features=k;for(const e of f.values())this.removed.delete(e);for(const e of a)this.removed.add(e),this.overriddenIds.add(e)}removeOverrides(k){this._lastLocalEditDropped=performance.now();this._onChange();k=k.reader.getCursor();const l=new Set;for(;k.next();){const a=k.getObjectId();this.overriddenIds.has(a)&&(l.add(a),this.overriddenIds.delete(a))}this._features=this._features.filter(a=>!l.has(a.objectId))}getTileReader(k){if(!this._features.length)return null;
const l=this.queryFeaturesInBounds(k.bounds);l.setTransformForDisplay(k.transform);return l}_onChange(){this.invalidate()}}b.OverrideChunk=g;b.isLocalEditChunk=function(k){return"localEdit"===k.chunkId};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/sources/strategies/chunks/ASourceChunk":function(){define(["exports","../../../FeatureSpatialIndex","../../../aggregation/GeohashSpatialIndex","../../../aggregation/GridSpatialIndex","../../../support/FeatureSetReaderIndirect"],
function(b,q,n,g,k){class l{size(){return this.reader.getSize()}get fields(){return this.reader.fields}invalidate(){this._spatialIndex=this._aggregateIndexHash=this._aggregateIndex=null}queryFeaturesInBounds(a){a=this._getSpatialIndex().search(a);return k.FeatureSetReaderIndirect.from(this.reader,a)}getAggregateIndex(a){const f=JSON.stringify(a);if(f!==this._aggregateIndexHash){this._aggregateIndexHash=f;switch(a.type){case "grid":this._aggregateIndex=new g.GridSpatialIndex(a);break;case "geohash":this._aggregateIndex=
new n.GeohashSpatialIndex(a)}this._aggregateIndex.insert(this.reader,this.isTiled)}return this._aggregateIndex}_getSpatialIndex(){this._spatialIndex||(this._spatialIndex=q.FeatureSpatialIndex.fromReader(this.reader));return this._spatialIndex}}b.ASourceChunk=l;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/FeatureSpatialIndex":function(){define(["exports","../../../../chunks/rbush","../../../../geometry/support/aaBoundingBox"],function(b,q,n){class g{static fromReader(k){const l=
[],a=k.copy();for(k=n.create();a.next();)a.getBounds(k)&&l.push(a.getIndex());k=q.rbush(9,f=>{a.setIndex(f);return{minX:a.getBoundsXMin(),minY:a.getBoundsYMin(),maxX:a.getBoundsXMax(),maxY:a.getBoundsYMax()}});k.load(l);return new g(k)}constructor(k){this._index=k}search(k){return this._index.search({minX:k[0],minY:k[1],maxX:k[2],maxY:k[3]})}}b.FeatureSpatialIndex=g;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/rbush":function(){define(["exports","./quickselect"],function(b,
q){function n(p,t){if(!(this instanceof n))return new n(p,t);this._maxEntries=Math.max(4,p||9);this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries));t&&("function"===typeof t?this.toBBox=t:this._initFormat(t));this.clear()}function g(p,t){k(p,0,p.children.length,t,p)}function k(p,t,w,r,y){y||=x(null);y.minX=Infinity;y.minY=Infinity;y.maxX=-Infinity;y.maxY=-Infinity;for(var z;t<w;t++)z=p.children[t],l(y,p.leaf?r(z):z);return y}function l(p,t){p.minX=Math.min(p.minX,t.minX);p.minY=Math.min(p.minY,
t.minY);p.maxX=Math.max(p.maxX,t.maxX);p.maxY=Math.max(p.maxY,t.maxY);return p}function a(p,t){return p.minX-t.minX}function f(p,t){return p.minY-t.minY}function d(p){return(p.maxX-p.minX)*(p.maxY-p.minY)}function c(p){return p.maxX-p.minX+(p.maxY-p.minY)}function e(p,t){return p.minX<=t.minX&&p.minY<=t.minY&&t.maxX<=p.maxX&&t.maxY<=p.maxY}function h(p,t){return t.minX<=p.maxX&&t.minY<=p.maxY&&t.maxX>=p.minX&&t.maxY>=p.minY}function x(p){return{children:p,height:1,leaf:!0,minX:Infinity,minY:Infinity,
maxX:-Infinity,maxY:-Infinity}}function m(p,t,w,r,y){for(var z=[t,w],u;z.length;)w=z.pop(),t=z.pop(),w-t<=r||(u=t+Math.ceil((w-t)/r/2)*r,q.quickselect(p,u,t,w,y),z.push(t,u,u,w))}n.prototype={all:function(){return this._all(this.data,[])},search:function(p){var t=this.data,w=[],r=this.toBBox;if(!h(p,t))return w;for(var y=[],z,u,v,A;t;){z=0;for(u=t.children.length;z<u;z++)v=t.children[z],A=t.leaf?r(v):v,h(p,A)&&(t.leaf?w.push(v):e(p,A)?this._all(v,w):y.push(v));t=y.pop()}return w},collides:function(p){var t=
this.data,w=this.toBBox;if(!h(p,t))return!1;for(var r=[],y,z,u,v;t;){y=0;for(z=t.children.length;y<z;y++)if(u=t.children[y],v=t.leaf?w(u):u,h(p,v)){if(t.leaf||e(p,v))return!0;r.push(u)}t=r.pop()}return!1},load:function(p){if(!p||!p.length)return this;if(p.length<this._minEntries){for(var t=0,w=p.length;t<w;t++)this.insert(p[t]);return this}p=this._build(p.slice(),0,p.length-1,0);this.data.children.length?this.data.height===p.height?this._splitRoot(this.data,p):(this.data.height<p.height&&(t=this.data,
this.data=p,p=t),this._insert(p,this.data.height-p.height-1,!0)):this.data=p;return this},insert:function(p){null!=p&&this._insert(p,this.data.height-1);return this},clear:function(){this.data=x([]);return this},remove:function(p,t){if(null==p)return this;for(var w=this.data,r=this.toBBox(p),y=[],z=[],u,v,A,B;w||y.length;){w||(w=y.pop(),v=y[y.length-1],u=z.pop(),B=!0);if(w.leaf){a:{A=p;var F=w.children,H=t;if(H){for(var J=0;J<F.length;J++)if(H(A,F[J])){A=J;break a}A=-1}else A=F.indexOf(A)}if(-1!==
A){w.children.splice(A,1);y.push(w);this._condense(y);break}}B||w.leaf||!e(w,r)?v?(u++,w=v.children[u],B=!1):w=null:(y.push(w),z.push(u),u=0,v=w,w=w.children[0])}return this},toBBox:function(p){return p},compareMinX:a,compareMinY:f,toJSON:function(){return this.data},fromJSON:function(p){this.data=p;return this},_all:function(p,t){for(var w=[];p;)p.leaf?t.push.apply(t,p.children):w.push.apply(w,p.children),p=w.pop();return t},_build:function(p,t,w,r){var y=w-t+1,z=this._maxEntries;if(y<=z){var u=
x(p.slice(t,w+1));g(u,this.toBBox);return u}r||(r=Math.ceil(Math.log(y)/Math.log(z)),z=Math.ceil(y/Math.pow(z,r-1)));u=x([]);u.leaf=!1;u.height=r;y=Math.ceil(y/z);z=y*Math.ceil(Math.sqrt(z));var v;for(m(p,t,w,z,this.compareMinX);t<=w;t+=z){var A=Math.min(t+z-1,w);m(p,t,A,y,this.compareMinY);for(v=t;v<=A;v+=y){var B=Math.min(v+y-1,A);u.children.push(this._build(p,v,B,r-1))}}g(u,this.toBBox);return u},_chooseSubtree:function(p,t,w,r){for(var y,z,u,v,A,B,F,H;;){r.push(t);if(t.leaf||r.length-1===w)break;
F=H=Infinity;y=0;for(z=t.children.length;y<z;y++)u=t.children[y],A=d(u),B=(Math.max(u.maxX,p.maxX)-Math.min(u.minX,p.minX))*(Math.max(u.maxY,p.maxY)-Math.min(u.minY,p.minY))-A,B<H?(H=B,F=A<F?A:F,v=u):B===H&&A<F&&(F=A,v=u);t=v||t.children[0]}return t},_insert:function(p,t,w){var r=this.toBBox;w=w?p:r(p);r=[];var y=this._chooseSubtree(w,this.data,t,r);y.children.push(p);for(l(y,w);0<=t;)if(r[t].children.length>this._maxEntries)this._split(r,t),t--;else break;this._adjustParentBBoxes(w,r,t)},_split:function(p,
t){var w=p[t],r=w.children.length,y=this._minEntries;this._chooseSplitAxis(w,y,r);r=this._chooseSplitIndex(w,y,r);r=x(w.children.splice(r,w.children.length-r));r.height=w.height;r.leaf=w.leaf;g(w,this.toBBox);g(r,this.toBBox);t?p[t-1].children.push(r):this._splitRoot(w,r)},_splitRoot:function(p,t){this.data=x([p,t]);this.data.height=p.height+1;this.data.leaf=!1;g(this.data,this.toBBox)},_chooseSplitIndex:function(p,t,w){var r,y;var z=y=Infinity;for(r=t;r<=w-t;r++){var u=k(p,0,r,this.toBBox);var v=
k(p,r,w,this.toBBox);var A=Math.max(0,Math.min(u.maxX,v.maxX)-Math.max(u.minX,v.minX))*Math.max(0,Math.min(u.maxY,v.maxY)-Math.max(u.minY,v.minY));u=d(u)+d(v);if(A<z){z=A;var B=r;y=u<y?u:y}else A===z&&u<y&&(y=u,B=r)}return B},_chooseSplitAxis:function(p,t,w){var r=p.leaf?this.compareMinX:a,y=p.leaf?this.compareMinY:f,z=this._allDistMargin(p,t,w,r);t=this._allDistMargin(p,t,w,y);z<t&&p.children.sort(r)},_allDistMargin:function(p,t,w,r){p.children.sort(r);r=this.toBBox;var y=k(p,0,t,r),z=k(p,w-t,w,
r),u=c(y)+c(z),v;for(v=t;v<w-t;v++){var A=p.children[v];l(y,p.leaf?r(A):A);u+=c(y)}for(v=w-t-1;v>=t;v--)A=p.children[v],l(z,p.leaf?r(A):A),u+=c(z);return u},_adjustParentBBoxes:function(p,t,w){for(;0<=w;w--)l(t[w],p)},_condense:function(p){for(var t=p.length-1,w;0<=t;t--)0===p[t].children.length?0<t?(w=p[t-1].children,w.splice(w.indexOf(p[t]),1)):this.clear():g(p[t],this.toBBox)},_initFormat:function(p){var t=["return a"," - b",";"];this.compareMinX=new Function("a","b",t.join(p[0]));this.compareMinY=
new Function("a","b",t.join(p[1]));this.toBBox=new Function("a","return {minX: a"+p[0]+", minY: a"+p[1]+", maxX: a"+p[2]+", maxY: a"+p[3]+"};")}};b.rbush=n})},"esri/chunks/quickselect":function(){define(["exports"],function(b){function q(k,l,a,f,d){for(;f>a;){if(600<f-a){var c=f-a+1,e=l-a+1,h=Math.log(c),x=.5*Math.exp(2*h/3);h=.5*Math.sqrt(h*x*(c-x)/c)*(0>e-c/2?-1:1);q(k,l,Math.max(a,Math.floor(l-e*x/c+h)),Math.min(f,Math.floor(l+(c-e)*x/c+h)),d)}c=k[l];e=a;x=f;n(k,a,l);for(0<d(k[f],c)&&n(k,a,f);e<
x;){n(k,e,x);e++;for(x--;0>d(k[e],c);)e++;for(;0<d(k[x],c);)x--}0===d(k[a],c)?n(k,a,x):(x++,n(k,x,f));x<=l&&(a=x+1);l<=x&&(f=x-1)}}function n(k,l,a){var f=k[l];k[l]=k[a];k[a]=f}function g(k,l){return k<l?-1:k>l?1:0}b.quickselect=function(k,l,a,f,d){q(k,l,a||0,f||k.length-1,d||g)}})},"esri/views/2d/layers/features/aggregation/GeohashSpatialIndex":function(){define(["exports","../../../../../geohash/GeohashTree","../../../../../geohash/geohashUtils","./AAggregateSpatialIndex"],function(b,q,n,g){class k extends g.AAggregateSpatialIndex{constructor(l){super(l);
this._tree=new q.GeohashTree(this._options.fields)}put(l){throw Error("Geohash tree does not support put");}putBounded(l,a,f){const {geohashLevel:d,spatialReference:c}=this._options;a=n.getGeohashBounds(a,f,d,c);null!=a&&this._tree.putBins(l,a)}_insert(l,a,f,d){const {geohashLevel:c,spatialReference:e}=this._options,h=n.getGeohash(a,f,c,e);h&&this._tree.insert(l,a,f,h[0],h[1],c,d)}}b.GeohashSpatialIndex=k;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/geohash/GeohashTree":function(){define(["exports",
"./GeohashCell"],function(b,q){class n{constructor(g){this._fields=g;this._depth=this._size=0;this._root=q.GeohashCell.create(this._fields,0,0,0)}destroy(){}get size(){return this._size}get depth(){return this._depth}find(g,k,l){return this._root.find(g,k,l,0,0,0)}insert(g,k,l,a,f,d,c){let e=this._root,h=0,x=0,m=0;for(;null!==e;){e.insert(g,k,l,a,f,c);if(h>=d)break;var p=Math.ceil((h+1)/2),t=Math.floor((h+1)/2);const r=1-h%2;var w=30-(3*p+2*t);p=30-(2*p+3*t);w=(a&7*r+3*(1-r)<<w)>>w;p=(f&3*r+7*(1-
r)<<p)>>p;t=w+p*(8*r+4*(1-r));const y=2*r+3*(1-r);x=x<<3*r+2*(1-r)|w;m=m<<y|p;null==e.children[t]&&(e.children[t]=q.GeohashCell.create(this._fields,x,m,h+1),this._depth=Math.max(this._depth,h+1),this._size+=1);h+=1;e=e.children[t]}}putBins(g,k){for(const l of this.getNodes(k))(k=g.get(l.id))?k.merge(l):g.set(l.id,l.clone())}getNodes(g){const k=[],{geohashBounds:l,level:a}=g;for(g=this._root;null!==g;){var f=g.depth,d=g.xNode,c=g.yNode;if(f>=a)k.push(g),g=g.next;else{var e=Math.ceil((f+1)/2),h=Math.floor((f+
1)/2);f=1-f%2;var x=30-(3*e+2*h),m=30-(2*e+3*h),p=~((1<<x)-1),t=~((1<<m)-1);d<<=3*f+2*(1-f);c<<=2*f+3*(1-f);e=Math.max(d,(l.xLL&p)>>x);h=Math.max(c,(l.yLL&t)>>m);x=Math.min(d+8*f+4*(1-f),(l.xTR&p)>>x);m=Math.min(c+4*f+8*(1-f),(l.yTR&t)>>m);for(p=t=null;h<=m;h++)for(let w=e;w<=x;w++){const r=g.children[w-d+(h-c)*(8*f+4*(1-f))];r&&(t||(t=r,t.next=g.next),p&&(p.next=r),p=r,r.next=g.next)}g=t||g.next}}return k}}b.GeohashTree=n;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/geohash/GeohashCell":function(){define("exports ./geohashUtils ../geometry/SpatialReference ../layers/graphics/featureConversionUtils ../layers/graphics/OptimizedGeometry ../layers/graphics/data/projectionSupport ../views/2d/layers/features/aggregation/AAggregateCell ../views/2d/layers/features/aggregation/AccumulatedStatistics".split(" "),
function(b,q,n,g,k,l,a,f){class d extends a.AAggregateCell{static create(c,e,h,x){c=f.AccumulatedStatistics.create(c);const m=Array(32);for(let p=0;p<m.length;p++)m[p]=null;return new d(c,e,h,x,m)}constructor(c,e,h,x,m){super(c);this.xNode=e;this.yNode=h;this.depth=x;this.children=m;this._objectIds=new Set;this._yGeohashTotal=this._xGeohashTotal=this._yWorldTotal=this._xWorldTotal=this._count=0;this.next=null}get id(){return`${this.xNode}.${this.yNode}`}get containedObjectIds(){return this._objectIds}get count(){return this._count}clone(){const c=
new d(this._statistics.clone(),this.xNode,this.yNode,this.depth,this.children);c._count=this._count;c._xWorldTotal=this._xWorldTotal;c._yWorldTotal=this._yWorldTotal;c._xGeohashTotal=this._xGeohashTotal;c._yGeohashTotal=this._yGeohashTotal;c.next=this.next;c._objectIds=new Set(this._objectIds);return c}insert(c,e,h,x,m,p){this._count+=1;this._xWorldTotal+=e;this._yWorldTotal+=h;this._xGeohashTotal+=x;this._yGeohashTotal+=m;this._statistics.insert(c,p);this._objectIds.add(c.getObjectId())}merge(c){if(0!==
c._count){this._count+=c._count;this._xWorldTotal+=c._xWorldTotal;this._yWorldTotal+=c._yWorldTotal;this._xGeohashTotal+=c._xWorldTotal;this._yGeohashTotal+=c._yWorldTotal;this._statistics.merge(c._statistics);for(const e of c._objectIds.values())this._objectIds.add(e)}}getCentroid(c){throw Error("getCentroid not supported for GeohashNode");}getGeometry(c,e){const h=this._getLngLatBounds(),[x,m,p,t]=h;c=l.project({rings:[[[x,m],[x,t],[p,t],[p,m],[x,m]]]},n.WGS84,c);c=g.convertFromPolygon(new k,c,
!1,!1);return null!=e?g.quantizeOptimizedGeometry(new k,c,!1,!1,"esriGeometryPolygon",e,!1,!1):c}getGeometricCentroid(c,e){const h=this._getLngLatBounds(),[x,m,p,t]=h;c=l.project({x:(x+p)/2,y:(m+t)/2},n.WGS84,c);c=g.convertFromPoint(new k,c);return null!=e?g.quantizeOptimizedGeometry(new k,c,!1,!1,"esriGeometryPoint",e,!1,!1):c}getAttributes(){const c={aggregateId:this.id};for(const e of this._statistics.values())c[e.field.name]=e.value;c.aggregateCount=this._count;return c}find(c,e,h,x,m,p){if(x>=
h)return this;var t=1-x%2;const w=3*t+2*(1-t),r=2*t+3*(1-t),y=30-m-w,z=30-p-r;t=this.children[((c&7*t+3*(1-t)<<y)>>y)+((e&3*t+7*(1-t)<<z)>>z)*(8*t+4*(1-t))];return null==t?null:t.find(c,e,h,x+1,m+w,p+r)}_getLngLatBounds(){var c=this.depth;const e=Math.ceil(c/2);c=Math.floor(c/2);return q.decodeGeohashXY({geohashX:this.xNode<<30-(3*e+2*c),geohashY:this.yNode<<30-(2*e+3*c)},this.depth)}}b.GeohashCell=d;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/geohash/geohashUtils":function(){define("exports ../core/has ../core/mathUtils ../geometry/Extent ../geometry/Polygon ../geometry/SpatialReference ../geometry/support/Ellipsoid ../layers/graphics/featureConversionUtils ../layers/graphics/OptimizedGeometry ../layers/graphics/data/projectionSupport".split(" "),
function(b,q,n,g,k,l,a,f,d,c){function e(v,A,B,F){if(F.isWebMercator)return v=n.rad2deg(v/a.earth.radius),v-=360*Math.floor((v+180)/360),A=n.rad2deg(Math.PI/2-2*Math.atan(Math.exp(-A/a.earth.radius))),F=[0,0],t(F,0,A,v,B),F;A=c.project({x:v,y:A},F,l.WGS84);if(!A)return null;v=[0,0];t(v,0,A.y,A.x,B);return v}function h(v){return 57>=v?v-48:104>=v?v-88:107>=v?v-89:110>=v?v-90:v-91}function x(v,A,B){v[0]=A;v[1]=B;return v}function m(v,A){const B=(v[0]+v[1])/2,F=!A;v[0]=F*v[0]+A*B;v[1]=F*B+A*v[1]}function p(v,
A){A=A>(v[0]+v[1])/2;m(v,A);return A}function t(v,A,B,F,H){H%2&&(H+=1);let J=0,E=0,K=-90,C=90,D=-180,G=180;for(let ka=0;ka<H/2;ka++){for(var N=0;5>N;N++){var Y=(D+G)/2,ca=F>Y?1:0;J|=ca<<29-(N+5*ka);D=(1-ca)*D+ca*Y;G=(1-ca)*Y+ca*G}for(N=0;5>N;N++)Y=(K+C)/2,ca=B>Y?1:0,E|=ca<<29-(N+5*ka),K=(1-ca)*K+ca*Y,C=(1-ca)*Y+ca*C}v[2*A]=J;v[2*A+1]=E}function w(v,A){return A?1&v|(4&v)>>1|(16&v)>>2:(2&v)>>1|(8&v)>>2}function r(v,A){return A?(2&v)>>1|(8&v)>>2:1&v|(4&v)>>1|(16&v)>>2}function y(v,A,B){var F=!((v.length-
1)%2);const H=v.slice(0,-1);var J=h(v.charCodeAt(v.length-1)),E=0,K=0;let C=0;var D=0;F?(E=8,K=4,C=1&J|(4&J)>>1|(16&J)>>2,D=(2&J)>>1|(8&J)>>2):(E=4,K=8,D=1&J|(4&J)>>1|(16&J)>>2,C=(2&J)>>1|(8&J)>>2);A=C+A;J=D+B;B=Math.floor(A/E);D=Math.floor(J/K);E=A-B*E;K=J-D*K;F="0123456789bcdefghjkmnpqrstuvwxyz"[F?E&1|(K&1)<<1|(E&2)<<1|(K&2)<<2|(E&4)<<2:K&1|(E&1)<<1|(K&2)<<1|(E&2)<<2|(K&4)<<2];return 1<v.length&&(B||D)?y(H,B,D)+F:H+F}const z=new Float64Array(2),u=new Float64Array(2);b.convertGeohash32ToXY=function(v,
A){let B=v=0,F=30,H=30;for(let K=0;K<A.length;K++){var J=A.charCodeAt(K),E=h(J);J=0===K%2;const C=w(E,J);E=r(E,J);F-=J?3:2;H-=J?2:3;v|=C<<F;B|=E<<H}return{geohashX:v,geohashY:B}};b.decodeBase32Char=h;b.decodeGeohash=function(v,A){const B=x(z,-90,90),F=x(u,-180,180);for(let J=0;J<A.length;J++){var H=A.charCodeAt(J);H=h(H);0===J%2?(m(F,!!(16&H)),m(F,!!(4&H)),m(F,!!(1&H)),m(B,!!(8&H)),m(B,!!(2&H))):(m(B,!!(16&H)),m(B,!!(4&H)),m(B,!!(1&H)),m(F,!!(8&H)),m(F,!!(2&H)))}v[0]=(B[0]+B[1])/2;v[1]=(F[0]+F[1])/
2;return v};b.decodeGeohashXY=function(v,A){let B=-90,F=90,H=-180,J=180;for(let N=0;N<A;N++){var E=Math.ceil((N+1)/2),K=Math.floor((N+1)/2),C=1-N%2,D=30-(3*E+2*K),G=30-(2*E+3*K);K=3*C+2*(1-C);E=2*C+3*(1-C);D=(7*C+3*(1-C)<<D&v.geohashX)>>D;C=(3*C+7*(1-C)<<G&v.geohashY)>>G;for(--K;0<=K;K--){G=(H+J)/2;const Y=D&1<<K?1:0;H=(1-Y)*H+Y*G;J=(1-Y)*G+Y*J}for(--E;0<=E;E--)D=(B+F)/2,K=C&1<<E?1:0,B=(1-K)*B+K*D,F=(1-K)*D+K*F}return[H,B,J,F]};b.encodeBase32Char=function(v){return"0123456789bcdefghjkmnpqrstuvwxyz"[v]};
b.encodeGeohash=function(v,A,B){let F="";const H=x(z,-90,90),J=x(u,-180,180);for(let E=0;E<B;E++){let K=0;E%2?(K|=p(H,v)<<4,K|=p(J,A)<<3,K|=p(H,v)<<2,K|=p(J,A)<<1,K|=p(H,v)<<0):(K|=p(J,A)<<4,K|=p(H,v)<<3,K|=p(J,A)<<2,K|=p(H,v)<<1,K|=p(J,A)<<0);F+="0123456789bcdefghjkmnpqrstuvwxyz"[K]}return F};b.getGeohash=e;b.getGeohashBounds=function(v,A,B,F){v=[v.xmin,v.ymin,v.xmax,v.ymax];var H=k.fromExtent(g.fromBounds(v,F));A=c.project(H,F,l.WGS84,{densificationStep:64*A});if(!A)return null;A=f.convertFromPolygon(new d,
A,!1,!1);H=A.coords.filter((E,K)=>!(K%2));var J=A.coords.filter((E,K)=>K%2);A=Math.min(...H);F=Math.min(...J);H=Math.max(...H);J=Math.max(...J);A=e(A,F,B,l.WGS84);F=e(H,J,B,l.WGS84);return A&&F?{bounds:v,geohashBounds:{xLL:A[0],yLL:A[1],xTR:F[0],yTR:F[1]},level:B}:null};b.getRelativeGeohash=y;b.setGeohashBuf=t;b.setGeohashXY=function(v,A,B,F){F%2&&(F+=1);let H=0,J=0,E=-90,K=90,C=-180,D=180;for(let ca=0;ca<F/2;ca++){for(var G=0;5>G;G++){var N=(C+D)/2,Y=B>N?1:0;H|=Y<<29-(G+5*ca);C=(1-Y)*C+Y*N;D=(1-
Y)*N+Y*D}for(G=0;5>G;G++)N=(E+K)/2,Y=A>N?1:0,J|=Y<<29-(G+5*ca),E=(1-Y)*E+Y*N,K=(1-Y)*N+Y*K}v.geohashX=H;v.geohashY=J};b.unpackXBits=w;b.unpackYBits=r;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/aggregation/AAggregateCell":function(){define(["exports"],function(b){class q{constructor(n){this._statistics=n}get statistics(){return this._statistics}}b.AAggregateCell=q;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/aggregation/AccumulatedStatistics":function(){define(["exports",
"../../../arcade/callExpressionWithCursor"],function(b,q){function n(x){switch(x.statisticType){case "min":return new a(x);case "max":return new f(x);case "avg":return new c(x);case "avg_angle":return new e(x);case "sum":return new d(x);case "mode":return new h(x);case "count":return new d(x)}}const g=Math.PI/180;class k{static create(x){return new k(x.map(m=>n(m)))}constructor(x){this._statistics=x}values(){return this._statistics.values()}insert(x,m){for(const p of this._statistics)p.insert(x,m)}merge(x){for(let m=
0;m<this._statistics.length;m++){const p=this._statistics[m],t=x._statistics[m];if(p.field.name!==t.field.name)throw Error("InternalError: Tried to merge incompatible statistics");p.merge(t)}}clone(){return new k(this._statistics.map(x=>x.clone()))}}class l{constructor(x){this.field=x}insert(x,m){this.field.computed&&(x=this.field.computed.read(x,m),q.isBadArcadeResult(x)||this._insertValue(x))}}class a extends l{constructor(){super(...arguments);this.type="min";this.value=Number.MAX_VALUE}_insertValue(x){this.value=
Math.min(this.value,x)}merge(x){this.value=Math.min(this.value,x.value)}clone(){const x=new a(this.field);x.value=this.value;return x}}class f extends l{constructor(){super(...arguments);this.type="max";this.value=Number.MIN_VALUE}_insertValue(x){this.value=Math.max(this.value,x)}merge(x){this.value=Math.max(this.value,x.value)}clone(){const x=new f(this.field);x.value=this.value;return x}}class d extends l{constructor(){super(...arguments);this.type="sum";this.value=0}_insertValue(x){this.value+=
x}merge(x){this.value+=x.value}clone(){const x=new d(this.field);x.value=this.value;return x}}class c extends l{constructor(){super(...arguments);this.type="avg";this._count=this._total=0}get value(){return this._total/this._count}_insertValue(x){this._total+=x;this._count+=1}merge(x){this._total+=x._total;this._count+=x._count}clone(){const x=new c(this.field);x._total=this._total;x._count=this._count;return x}}class e extends l{constructor(){super(...arguments);this.type="avg_angle";this._count=
this._y=this._x=0}get value(){return 180/Math.PI*Math.atan2(this._y/this._count,this._x/this._count)}_insertValue(x){this._x+=Math.cos(x*g);this._y+=Math.sin(x*g);this._count+=1}merge(x){this._x+=x._x;this._y+=x._y;this._count+=x._count}clone(){const x=new e(this.field);x._x=this._x;x._y=this._y;x._count=this._count;return x}}class h extends l{constructor(){super(...arguments);this._frequencies=new Map}get value(){let x=0,m;for(const [p,t]of this._frequencies.entries())t>x&&(x=t,m=p);return m}_insertValue(x){const m=
this._frequencies.get(x);null==m?this._frequencies.set(x,1):this._frequencies.set(x,m+1)}merge(x){for(const [m,p]of x._frequencies.entries())x=this._frequencies.get(m),null==x?this._frequencies.set(m,p):this._frequencies.set(m,x+p)}clone(){const x=new h(this.field);x._frequencies=new Map(this._frequencies);return x}}b.AccumulatedStatistics=k;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/arcade/callExpressionWithCursor":function(){define(["exports","../../../core/has",
"../../../core/Logger"],function(b,q,n){function g(k){return null==k||Infinity===k||-Infinity===k||"number"===typeof k&&isNaN(k)}b.callExpressionWithCursor=function(k,l,a){if(null==k)return null;const f=l.readArcadeFeature();l.contextTimeZone=a.$view?.timeZone;try{return k.evaluate({...a,$feature:f},k.services)}catch(d){return n.getLogger("esri.views.2d.support.arcadeOnDemand").warn("Feature arcade evaluation failed:",d),null}};b.callExpressionWithCursorWithDefault=function(k,l,a,f){if(null==k)return null!=
f?f:null;const d=l.readArcadeFeature();l.contextTimeZone=a.$view?.timeZone;k=k.evaluate({...a,$feature:d},k.services);return g(k)?null!=f?f:null:k};b.isBadArcadeResult=g;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/aggregation/AAggregateSpatialIndex":function(){define(["exports","../../../engine/webgl/definitions"],function(b,q){class n{constructor(g){this._options=g}insert(g,k){g=g.getCursor();const l={$view:{scale:this._options.scale,timeZone:this._options.timeZone}};
for(;g.next();)this._insertFeature(g,l,k)}_insertFeature(g,k,l){var {featureFilter:a}=this._options;if(null===a||a.check(g)){var f=a=0;if("esriGeometryPoint"===g.geometryType)a=g.readXWorldSpace(),f=g.readYWorldSpace();else{if(l){l=g.readCentroidForDisplay();if(null==l)return;const [d,c]=l.coords;if(0>d||d>q.tileSize||0>c||c>q.tileSize)return}l=g.readCentroidWorldSpace();if(null==l)return;a=l.coords[0];f=l.coords[1]}this._insert(g,a,f,k)}}}b.AAggregateSpatialIndex=n;Object.defineProperty(b,Symbol.toStringTag,
{value:"Module"})})},"esri/views/2d/layers/features/aggregation/GridSpatialIndex":function(){define(["exports","../../../../../core/unitUtils","./AAggregateSpatialIndex","./GridCell"],function(b,q,n,g){function k(a,f){return q.getMetersPerUnitForSR(a)*q.inchesPerMeter*96/f}class l extends n.AAggregateSpatialIndex{constructor(a){super(a);this._cells=new Map;this._pixelsPerMapUnit=k(a.spatialReference,a.scale)}put(a){for(const f of this._cells.values()){const d=a.get(f.id);d?d.merge(f):a.set(f.id,f.clone())}}putBounded(a,
f,d){const [c,e,h,x]=[f.xmin,f.ymin,f.xmax,f.ymax];f=Math.floor(c*this._pixelsPerMapUnit/this._options.cellSize);var m=Math.floor(e*this._pixelsPerMapUnit/this._options.cellSize);d=Math.ceil(h*this._pixelsPerMapUnit/this._options.cellSize);const p=Math.ceil(x*this._pixelsPerMapUnit/this._options.cellSize);for(;m<=p;m++)for(let t=f;t<=d;t++){const w=this._cells.get(`${t}.${m}`);if(!w)continue;const r=a.get(w.id);r?w&&!a.has(w.id)&&r.merge(w):a.set(w.id,w.clone())}}_insert(a,f,d,c){this._getCellOrCreate(Math.floor(f*
this._pixelsPerMapUnit/this._options.cellSize),Math.floor(d*this._pixelsPerMapUnit/this._options.cellSize)).insert(a,c,f,d)}_getCellOrCreate(a,f){const d=g.GridCell.createId(a,f);let c=this._cells.get(d);c||(c=g.GridCell.create(a,f,this._options.fields,1*this._options.cellSize/this._pixelsPerMapUnit),this._cells.set(d,c));return c}}b.GridSpatialIndex=l;b.pixelsPerMapUnit=k;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/aggregation/GridCell":function(){define(["exports",
"../../../../../layers/graphics/featureConversionUtils","../../../../../layers/graphics/OptimizedGeometry","./AAggregateCell","./AccumulatedStatistics"],function(b,q,n,g,k){class l extends g.AAggregateCell{static createId(a,f){return`${a}.${f}`}static create(a,f,d,c){return new l(a,f,k.AccumulatedStatistics.create(d),c)}constructor(a,f,d,c){super(d);this.gridX=a;this.gridY=f;this._worldUnitsPerCell=c;this._yWorldTotal=this._xWorldTotal=this._count=0;this._objectIds=new Set}get id(){return l.createId(this.gridX,
this.gridY)}get containedObjectIds(){return this._objectIds}get count(){return this._count}get firstObjectId(){return this._objectIds.values().next().value}get centroidXWorld(){return this._xWorldTotal/this._count}get centroidYWorld(){return this._yWorldTotal/this._count}clone(){const a=new l(this.gridX,this.gridY,this._statistics.clone(),this._worldUnitsPerCell);a._count=this._count;a._xWorldTotal=this._xWorldTotal;a._yWorldTotal=this._yWorldTotal;a._firstFeatureAttributes=this._firstFeatureAttributes;
a._objectIds=new Set(this._objectIds);return a}insert(a,f,d,c){this._firstFeatureAttributes=0===this._count?a.readAttributes():null;this._count+=1;this._xWorldTotal+=d;this._yWorldTotal+=c;this._statistics.insert(a,f);this._objectIds.add(a.getObjectId())}merge(a){if(0!==a._count){this._count+=a._count;this._firstFeatureAttributes=a._firstFeatureAttributes;this._xWorldTotal+=a._xWorldTotal;this._yWorldTotal+=a._yWorldTotal;this._statistics.merge(a._statistics);for(const f of a._objectIds.values())this._objectIds.add(f)}}getCentroidX(a){return null==
a?this.centroidXWorld:q.quantizeX(a,this.centroidXWorld)}getCentroidY(a){return null==a?this.centroidYWorld:q.quantizeY(a,this.centroidYWorld)}getGeometry(a,f){a=this.gridX*this._worldUnitsPerCell;var d=this.gridY*this._worldUnitsPerCell;a=new n([4],[a,d,a+this._worldUnitsPerCell,d,a+this._worldUnitsPerCell,d+this._worldUnitsPerCell,a,d+this._worldUnitsPerCell]);return null!=f?(d=new n,q.quantizeOptimizedGeometry(d,a,!1,!1,"esriGeometryPolygon",f)):a}getCentroid(a){const f=new n([],[this.centroidXWorld,
this.centroidYWorld]);if(null!=a){const d=new n;return q.quantizeOptimizedGeometry(d,f,!1,!1,"esriGeometryPoint",a)}return f}getGeometricCentroid(a,f){a=new n([],[this.gridX*this._worldUnitsPerCell+.5*this._worldUnitsPerCell,this.gridY*this._worldUnitsPerCell+.5*this._worldUnitsPerCell]);if(null!=f){const d=new n;return q.quantizeOptimizedGeometry(d,a,!1,!1,"esriGeometryPoint",f)}return a}getAttributes(){const a={aggregateId:this.id};for(const f of this._statistics.values())a[f.field.name]=f.value;
return null!=this._firstFeatureAttributes?{...a,...this._firstFeatureAttributes}:a}}b.GridCell=l;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/support/FeatureSetReaderIndirect":function(){define(["exports","../../../../../layers/graphics/featureConversionUtils","../../../../../layers/graphics/OptimizedGeometry","./FeatureSetReader"],function(b,q,n,g){class k extends g.FeatureSetReader{static from(l,a){return new k(l.copy(),a)}constructor(l,a){super(l.metadata);
this._currentIndex=-1;this._displayTranslationY=this._displayTranslationX=0;this._displayScaleY=this._displayScaleX=1;this._reader=l;this._indices=a;this._isPoint="esriGeometryPoint"===l.geometryType}setTransformForDisplay(l){const a=this._reader.getInTransform();if(null==a){const [t,w]=l.scale,[r,y]=l.translate;this._displayTranslationX=-r/t;this._displayScaleX=1/t;this._displayTranslationY=y/w;this._displayScaleY=1/-w}else{var [f,d]=a.scale,[c,e]=a.translate,[h,x]=l.scale,[m,p]=l.translate;this._displayScaleX=
f/h;this._displayTranslationX=(c-m)/h;this._displayScaleY=d/x;this._displayTranslationY=(-e+p)/x;if(!this._isPoint&&a)throw Error("InternalError: Relative transformations not supported for non-point features");}this._displayTransform=l}getInTransform(){return this._reader.getInTransform()}get fields(){return this._reader.fields}get hasNext(){return this._currentIndex+1<this._indices.length}getSize(){return this._indices.length}getCursor(){return this.copy()}copy(){const l=new k(this._reader.copy(),
this._indices);l._currentIndex=this._currentIndex;l._displayTransform=this._displayTransform;l._displayTranslationX=this._displayTranslationX;l._displayTranslationY=this._displayTranslationY;l._displayScaleX=this._displayScaleX;l._displayScaleY=this._displayScaleY;return l}get contextTimeZone(){return this._reader.contextTimeZone}set contextTimeZone(l){this._reader.contextTimeZone=l}_nextIndex(){return++this._currentIndex<this._indices.length?(this._reader.setIndex(this._indices[this._currentIndex]),
!0):!1}next(){for(;this._nextIndex()&&!this._reader._getExists(););return this._currentIndex<this._indices.length}readXForDisplay(){return this._reader.readXForDisplay()*this._displayScaleX+this._displayTranslationX}readYForDisplay(){return this._reader.readYForDisplay()*this._displayScaleY+this._displayTranslationY}readGeometryForDisplay(){const l=this._reader.readGeometryForDisplay();if(!this._displayTransform)return l;const a=new n;q.quantizeOptimizedGeometry(a,l,this.hasZ,this.hasM,this.geometryType,
this._displayTransform);return a.deltaDecode()}readCentroidForDisplay(){const l=this._reader.readCentroidForDisplay()?.clone();if(l){const [a,f]=l.coords;l.coords[0]=a*this._displayScaleX+this._displayTranslationX;l.coords[1]=f*this._displayScaleY+this._displayTranslationY}return l}get geometryType(){return this._reader.geometryType}get hasFeatures(){return this._reader.hasFeatures}get exceededTransferLimit(){return this._reader.exceededTransferLimit}get hasZ(){return this._reader.hasZ}get hasM(){return this._reader.hasM}readAttribute(l,
a=!1){return this._reader.readAttribute(l,a)}readAttributes(){return this._reader.readAttributes()}joinAttributes(l){return this._reader.joinAttributes(l)}getBounds(l){return this._reader.getBounds(l)}getAttributeHash(){return this._reader.getAttributeHash()}getObjectId(){return this._reader.getObjectId()}getDisplayId(){return this._reader.getDisplayId()}setDisplayId(l){return this._reader.setDisplayId(l)}setIndex(l){return this._reader.setIndex(l)}getIndex(){return this._reader.getIndex()}readXWorldSpace(){return this._reader.readXWorldSpace()}readYWorldSpace(){return this._reader.readYWorldSpace()}_readX(){return this._reader.readXForDisplay()}_readY(){return this._reader.readYForDisplay()}_readServerCentroid(){return this._reader._readServerCentroid()}readLegacyFeatureForDisplay(){const l=
this.readCentroidForDisplay();return{attributes:this.readAttributes(),geometry:this.readLegacyGeometryForDisplay(),centroid:(l&&{x:l.coords[0],y:l.coords[1]})??null}}readLegacyGeometryForDisplay(){const l=this.readGeometryForDisplay();return q.convertToGeometry(l,this.geometryType,!1,!1)}readGeometryArea(){return this._reader.readGeometryArea()}readGeometryWorldSpace(){return this._reader.readGeometryWorldSpace()}_readGeometry(){return this._reader._readGeometry()}_readAttribute(l,a){throw Error("Error: Should not be called. Underlying _reader should be used instead");
}_readAttributes(){throw Error("Error: Should not be called. Underlying _reader should be used instead");}readArcadeFeature(){return this._reader.readArcadeFeature()}geometry(){return this._reader.geometry()}field(l){return this._reader.field(l)}hasField(l){return this._reader.hasField(l)}setField(l,a){return this._reader.setField(l,a)}keys(){return this._reader.keys()}castToText(l=!1){return this._reader.castToText(l)}}b.FeatureSetReaderIndirect=k;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},
"esri/views/2d/layers/features/support/FeatureSetReader":function(){define("exports ../../../../../geometry ../../../../../arcade/ArcadeDate ../../../../../core/has ../../../../../core/maybe ../../../../../core/sql/DateOnly ../../../../../core/sql/TimeOnly ../../../../../geometry/GeometryCursor ../../../../../geometry/support/aaBoundingBox ../../../../../geometry/support/labelPoint ../../../../../layers/graphics/centroid ../../../../../layers/graphics/featureConversionUtils ../../../../../layers/graphics/OptimizedFeature ../../../../../layers/graphics/OptimizedGeometry ../../../../../time/timeZoneUtils ./FeatureSetCache ./StaticBitSet ../../../../../geometry/support/jsonUtils".split(" "),
function(b,q,n,g,k,l,a,f,d,c,e,h,x,m,p,t,w,r){function y(C,D,G){if(!(C.length>D))for(;C.length<=D;)C.push(G)}q=g("featurelayer-simplify-thresholds")??[.5,.5,.5,.5];const z=q[0],u=q[1],v=q[2],A=q[3];q=g("featurelayer-simplify-payload-size-factors")??[1,2,4];const B=q[0],F=q[1],H=q[2],J=g("featurelayer-simplify-mobile-factor")??2,E=g("esri-mobile");class K{constructor(C){this.metadata=C;this.type="FeatureSetReader";this._deleted=null;this._joined=[];this._objectIdToIndex=null;this._boundsBuffer=[];
this._caches=new Map;this.arcadeDeclaredClass="esri.arcade.Feature";this._contextTimeZone=null}destroy(){}[Symbol.dispose](){this.destroy()}get isEmpty(){return null!=this._deleted&&this._deleted.countSet()===this.getSize()}getAreaSimplificationThreshold(C,D){let G=1;const N=E?J:1;4E6<D?G=H*N:1E6<D?G=F*N:5E5<D?G=B*N:1E5<D&&(G=N);D=0;4E3<C?D=A*G:2E3<C?D=v*G:100<C?D=u:15<C&&(D=z);return D}getBounds(C){y(this._boundsBuffer,4*this.getIndex()+4,0);if(4294967295===this.getBoundsXMin())return!1;if(0===this.getBoundsXMin()){var D=
this.readGeometryWorldSpace();if(!D)return this.setBoundsXMin(4294967295),!1;let ca=Infinity,ka=Infinity,Q=-Infinity,R=-Infinity;D.forEachVertex((Z,da)=>{ca=Math.min(ca,Z);ka=Math.min(ka,da);Q=Math.max(Q,Z);R=Math.max(R,da)});this.setBoundsXMin(ca);this.setBoundsYMin(ka);this.setBoundsXMax(Q);this.setBoundsYMax(R);d.fromRectValues(C,ca,ka,Q,R);return!0}D=this.getBoundsXMin();const G=this.getBoundsYMin(),N=this.getBoundsXMax(),Y=this.getBoundsYMax();d.fromRectValues(C,D,G,N,Y);return!0}getBoundsXMin(){return this._boundsBuffer[4*
this.getIndex()]}setBoundsXMin(C){this._boundsBuffer[4*this.getIndex()]=C}getBoundsYMin(){return this._boundsBuffer[4*this.getIndex()+1]}setBoundsYMin(C){this._boundsBuffer[4*this.getIndex()+1]=C}getBoundsXMax(){return this._boundsBuffer[4*this.getIndex()+2]}setBoundsXMax(C){this._boundsBuffer[4*this.getIndex()+2]=C}getBoundsYMax(){return this._boundsBuffer[4*this.getIndex()+3]}setBoundsYMax(C){this._boundsBuffer[4*this.getIndex()+3]=C}readAttributeAsTimestamp(C){C=this.readAttribute(C);return"string"===
typeof C?(new Date(C)).getTime():"number"===typeof C||null==C?C:null}readAttribute(C,D=!1){var G=this._readAttribute(C,D);if(void 0!==G)return G;for(const N of this._joined)if(N.setIndex(this.getIndex()),G=N._readAttribute(C,D),void 0!==G)return G}readAttributes(){const C=this._readAttributes();for(const D of this._joined){D.setIndex(this.getIndex());const G=D._readAttributes();for(const N of Object.keys(G))C[N]=G[N]}return C}joinAttributes(C){this._joined.push(C)}removeIds(C){if(null==this._objectIdToIndex){var D=
new Map;const G=this.getCursor();for(;G.next();){const N=G.getObjectId();k.assertIsSome(N);D.set(N,G.getIndex())}this._objectIdToIndex=D}D=this._objectIdToIndex;for(const G of C.values())D.has(G)&&this._removeAtIndex(D.get(G))}readOptimizedFeatureWorldSpace(){var C=this.readGeometryWorldSpace();const D=this.readAttributes(),G=this.readCentroidWorldSpace();C=new x.OptimizedFeature(C,D,G);C.objectId=this.getObjectId();C.displayId=this.getDisplayId();return C}readLegacyFeatureForDisplay(){const C=this.readCentroidForDisplay();
return{attributes:this.readAttributes(),geometry:this.readLegacyGeometryForDisplay(),centroid:(C&&{x:C.coords[0],y:C.coords[1]})??null}}readLegacyFeatureWorldSpace(){const C=this.readCentroidWorldSpace();return{attributes:this.readAttributes(),geometry:this._readLegacyGeometryWorldSpace(),centroid:(C&&{x:C.coords[0],y:C.coords[1]})??null}}readLegacyGeometryForDisplay(){const C=this.readGeometryForDisplay();return h.convertToGeometry(C,this.geometryType,!1,!1)}readXForDisplay(){return this._readX()}readYForDisplay(){return this._readY()}readXWorldSpace(){const C=
this._readX(),D=this.getInTransform();return null==D?C:C*D.scale[0]+D.translate[0]}readYWorldSpace(){const C=this._readY(),D=this.getInTransform();return null==D?C:D.translate[1]-C*D.scale[1]}readGeometryForDisplay(){var C=this._readGeometryDeltaDecoded(!0);return C?C:(C=this._createGeometryFromServerCentroid())?C.deltaDecode():null}readGeometryWorldSpace(){var C=this._readGeometry();C||=this._createGeometryFromServerCentroid();if(!C)return null;C=C.clone();const D=this.getInTransform();null!=D&&
h.unquantizeOptimizedGeometry(C,C,this.hasZ,this.hasM,D);return C}readCentroidForDisplay(){const C=this.readGeometryForDisplay();return C?this._computeDisplayCentroid(C):this._readServerCentroid()}readCentroidWorldSpace(){var C=this.readGeometryForDisplay();C=C?this._computeDisplayCentroid(C):this._readServerCentroid();if(!C)return null;C=C.clone();const D=this.getInTransform();null!=D&&h.unquantizeOptimizedGeometry(C,C,this.hasZ,this.hasM,D);return C}setCache(C){let D=this._caches.get(C);null==D&&
(D=new t.FeatureSetCache(this.getSize()),this._caches.set(C,D));this._activeCache=D}setCachedValue(C){this._activeCache.set(this.getIndex(),C)}hasCachedValue(){return this._activeCache.has(this.getIndex())}getCachedValue(){return this._activeCache.get(this.getIndex())}_readGeometryDeltaDecoded(C){C=this._readGeometry(C);return"esriGeometryPoint"!==this.geometryType&&C&&this.getInTransform()?C.deltaDecode():C}get contextTimeZone(){return this._contextTimeZone}set contextTimeZone(C){this._contextTimeZone=
C}readArcadeFeature(){return this}hasField(C){return this.fields.has(C)||this._joined.some(D=>D.hasField(C))}geometry(){var C=this.readGeometryWorldSpace();C=h.convertToGeometry(C,this.geometryType,this.hasZ,this.hasM);if(C=r.fromJSON(C)){if(!this.metadata.spatialReference)throw Error("InternalError: Expected spatial reference to be defined");C.spatialReference=this.metadata.spatialReference}return C}autocastArcadeDate(C,D){return D&&D instanceof Date?this.isUnknownDateTimeField(C)?n.ArcadeDate.unknownDateJSToArcadeDate(D):
n.ArcadeDate.dateJSAndZoneToArcadeDate(D,this.contextTimeZone??p.system):D}isUnknownDateTimeField(C){return this.metadata.fieldsIndex.getTimeZone(C)===p.unknown}field(C){let D=this.fields.get(C);if(D)switch(D.type){case "date-only":case "esriFieldTypeDateOnly":return l.DateOnly.fromReader(this.readAttribute(C,!1));case "time-only":case "esriFieldTypeTimeOnly":return a.TimeOnly.fromReader(this.readAttribute(C,!1));case "esriFieldTypeTimestampOffset":case "timestamp-offset":return n.ArcadeDate.fromReaderAsTimeStampOffset(this.readAttribute(C,
!1));case "date":case "esriFieldTypeDate":return this.autocastArcadeDate(C,this.readAttribute(C,!0));default:return this.readAttribute(C,!1)}for(const G of this._joined)if(G.setIndex(this.getIndex()),D=G.fields.get(C))switch(D.type){case "date-only":case "esriFieldTypeDateOnly":return l.DateOnly.fromReader(G._readAttribute(C,!1));case "time-only":case "esriFieldTypeTimeOnly":return a.TimeOnly.fromReader(G._readAttribute(C,!1));case "esriFieldTypeTimestampOffset":case "timestamp-offset":return n.ArcadeDate.fromReaderAsTimeStampOffset(G._readAttribute(C,
!1));case "date":case "esriFieldTypeDate":return this.autocastArcadeDate(C,G._readAttribute(C,!0));default:return this.readAttribute(C,!1)}throw Error(`Field ${C} does not exist`);}setField(C,D){throw Error("Unable to update feature attribute values, feature is readonly");}keys(){return this.fields.fields.map(C=>C.name)}castToText(C=!1){if(!C)return JSON.stringify(this.readLegacyFeatureForDisplay());C=this.readLegacyFeatureForDisplay();if(!C)return JSON.stringify(null);C={geometry:C.geometry,attributes:{...(C.attributes??
{})}};for(const D in C.attributes){const G=C.attributes[D];G instanceof Date&&(C.attributes[D]=G.getTime())}return JSON.stringify(C)}gdbVersion(){return null}fullSchema(){return this.metadata.arcadeSchema}castAsJson(C=null){return{attributes:this._readAttributes(),geometry:!0===C?.keepGeometryType?this.geometry():this.geometry()?.toJSON()??null}}castAsJsonAsync(C,D=null){return Promise.resolve(this.castAsJson(D))}_getExists(){return null==this._deleted||!this._deleted.has(this.getIndex())}_computeDisplayCentroid(C){if(null==
this.getInTransform())return e.getCentroidOptimizedGeometry(new m,C,this.hasM,this.hasZ);C=f.GeometryCursor.fromOptimized(C,this.geometryType);C.yFactor*=-1;return(C=c.getLabelPoint(C))?(C[1]*=-1,new m([],C)):null}copyInto(C){C._joined=this._joined;C._deleted=this._deleted;C._objectIdToIndex=this._objectIdToIndex;C._boundsBuffer=this._boundsBuffer;C._activeCache=this._activeCache;C._caches=this._caches;C._contextTimeZone=this._contextTimeZone}_readLegacyGeometryWorldSpace(){const C=this.readGeometryWorldSpace();
return h.convertToGeometry(C,this.geometryType,!1,!1)}_createGeometryFromServerCentroid(){const C=this._readServerCentroid();if(!C)return null;const [D,G]=C.coords;return this._createQuantizedExtrudedGeometry(D,G)}_createQuantizedExtrudedGeometry(C,D){return"esriGeometryPolyline"===this.geometryType?this._createQuantizedExtrudedLine(C,D):this._createQuantizedExtrudedQuad(C,D)}_createQuantizedExtrudedQuad(C,D){return new m([5],[C-1,D,1,-1,1,1,-1,1,-1,-1])}_createQuantizedExtrudedLine(C,D){return new m([2],
[C-1,D+1,1,-1])}_removeAtIndex(C){null==this._deleted&&(this._deleted=w.StaticBitSet.create(this.getSize()));this._deleted.set(C)}}b.FeatureSetReader=K;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/support/FeatureSetCache":function(){define(["exports","./StaticBitSet"],function(b,q){class n{constructor(g){this._valid=q.StaticBitSet.create(g);this._data=Array(g)}has(g){return this._valid.has(g)}set(g,k){this._valid.set(g);this._data[g]=k}get(g){return this._data[g]}}
b.FeatureSetCache=n;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/support/StaticBitSet":function(){define(["exports"],function(b){class q{static fromBuffer(n,g){return new q(n,g)}static create(n,g=4294967295){n=new Uint32Array(Math.ceil(n/32));return new q(n,g)}constructor(n,g){this._mask=0;this._buf=n;this._mask=g}_getIndex(n){return Math.floor(n/32)}has(n){n&=this._mask;return!!(this._buf[this._getIndex(n)]&1<<n%32)}hasRange(n,g){for(;n%32&&n!==g;){if(this.has(n))return!0;
n++}for(;g%32&&n!==g;){if(this.has(n))return!0;g--}if(n===g)return!1;for(n/=32;n!==g/32;n++)if(this._buf[n])return!0;return!1}set(n){n&=this._mask;const g=this._getIndex(n);this._buf[g]|=1<<n%32}setRange(n,g){for(;n%32&&n!==g;)this.set(n++);for(;g%32&&n!==g;)this.set(g--);if(n!==g)for(n/=32;n!==g/32;n++)this._buf[n]=4294967295}unset(n){n&=this._mask;const g=this._getIndex(n);this._buf[g]&=4294967295^1<<n%32}resize(n){const g=this._buf;n=new Uint32Array(Math.ceil(n/32));n.set(g);this._buf=n}or(n){for(let g=
0;g<this._buf.length;g++)this._buf[g]|=n._buf[g];return this}and(n){for(let g=0;g<this._buf.length;g++)this._buf[g]&=n._buf[g];return this}xor(n){for(let g=0;g<this._buf.length;g++)this._buf[g]^=n._buf[g];return this}ior(n){for(let g=0;g<this._buf.length;g++)this._buf[g]|=~n._buf[g];return this}iand(n){for(let g=0;g<this._buf.length;g++)this._buf[g]&=~n._buf[g];return this}ixor(n){for(let g=0;g<this._buf.length;g++)this._buf[g]^=~n._buf[g];return this}any(){for(let n=0;n<this._buf.length;n++)if(this._buf[n])return!0;
return!1}copy(n){for(let g=0;g<this._buf.length;g++)this._buf[g]=n._buf[g];return this}clone(){return new q(this._buf.slice(),this._mask)}clear(){for(let n=0;n<this._buf.length;n++)this._buf[n]=0;return this}forEachSet(n){for(let g=0;g<this._buf.length;g++){let k=this._buf[g],l=32*g;if(k)for(;k;)k&1&&n(l),k>>>=1,l++}}countSet(){let n=0;this.forEachSet(g=>{n++});return n}}b.StaticBitSet=q;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/support/FeatureSetReaderJSON":function(){define(["exports",
"../../../../../layers/graphics/featureConversionUtils","../../../../../layers/graphics/OptimizedFeature","../../../../../layers/support/FieldsIndex","./FeatureSetReader"],function(b,q,n,g,k){class l extends k.FeatureSetReader{static fromFeatures(a,f){const {objectIdField:d,geometryType:c}=f,e=q.convertFromFeatures([],a,c,!1,!1,d);for(let h=0;h<e.length;h++)e[h].displayId=a[h].displayId;return l.fromOptimizedFeatures(e,f)}static fromFeatureSet(a,f){a=q.convertFromFeatureSet(a,f.objectIdField);return l.fromOptimizedFeatureSet(a,
f)}static fromOptimizedFeatureSet(a,f){f=l.fromOptimizedFeatures(a.features,f);f._exceededTransferLimit=a.exceededTransferLimit;f._transform=a.transform;f._fieldsIndex=new g(a.fields);return f}static fromOptimizedFeatures(a,f,d){a=new l(a,f);a._fieldsIndex=f.fieldsIndex;a._transform=d;return a}static empty(a){return new l([],a)}constructor(a,f){super(f);this._exceededTransferLimit=!1;this._featureIndex=-1;this._fieldsIndex=null;this._geometryType=f.geometryType;this._features=a}get fields(){return this._fieldsIndex}get geometryType(){return this._geometryType}get hasFeatures(){return!!this._features.length}get hasNext(){return this._featureIndex+
1<this._features.length}get exceededTransferLimit(){return this._exceededTransferLimit}get hasZ(){return!1}get hasM(){return!1}get _current(){return this._features[this._featureIndex]}removeIds(a){const f=new Set(a);this._features=this._features.filter(d=>!(null!=d.objectId&&f.has(d.objectId)))}getSize(){return this._features.length}getCursor(){return this.copy()}getInTransform(){return this._transform}getAttributeHash(){let a="";for(const f in this._current.attributes)a+=this._current.attributes[f];
return a}getIndex(){return this._featureIndex}setIndex(a){this._featureIndex=a}getObjectId(){return this._current?.objectId}getDisplayId(){return this._current.displayId}setDisplayId(a){this._current.displayId=a}copy(){const a=new l(this._features,this.metadata);this.copyInto(a);return a}next(){for(;++this._featureIndex<this._features.length&&!this._getExists(););return this._featureIndex<this._features.length}readGeometryArea(){return n.hasGeometry(this._current)?q.getQuantizedArea(this._current.geometry,
2):0}_readX(){return n.hasGeometry(this._current)?this._current.geometry.coords[0]:0}_readY(){return n.hasGeometry(this._current)?this._current.geometry.coords[1]:0}_readGeometry(){return n.hasGeometry(this._current)?this._current.geometry??null:null}_readServerCentroid(){return this._current.centroid}_readAttribute(a,f){if(this._fieldsIndex){var d=this._fieldsIndex.get(a);if(d)return d=this._current.attributes[d.name],null==d?d:f&&this.fields.isDateField(a)?new Date(d):d}else{f=this._current.attributes[a];
if(void 0!==f)return f;a=a.toLowerCase();for(d in this._current.attributes)if(d.toLowerCase()===a)return this._current.attributes[d]}}_readAttributes(){return this._current.attributes}copyInto(a){super.copyInto(a);a._featureIndex=this._featureIndex;a._transform=this._transform;a._fieldsIndex=this._fieldsIndex}}b.FeatureSetReaderJSON=l;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/support/ComputedAttributeStorage":function(){define("exports ../../../../../core/Error ../../../../../core/Logger ../../../../../geometry/support/aaBoundingBox ../../../engine/webgl/DisplayId ./CachedField ./ComputedExpression ./ComputedLegacyLabelExpression ./NormalizedField ./StaticBitSet ./whereUtils".split(" "),
function(b,q,n,g,k,l,a,f,d,c,e){function h(p,t,w){if(!(p.length>t))for(;p.length<=t;)p.push(w)}const x=()=>n.getLogger("esri.views.2d.layers.features.support.ComputedAttributeStorage");class m{constructor(p){this._numerics=[];this._strings=[];this._allocatedSize=256;this._bitsets=[];this._instanceIds=[];this._bounds=[];this._dirtyBitset=this.getBitset(this.createBitset());this.compilationOptions=p}createBitset(){const p=this._bitsets.length;this._bitsets.push(c.StaticBitSet.create(this._allocatedSize,
k.displayIdTexelMask));return p+1}async createComputedField(p,t=!1){if(p.expression)try{if(!this.compilationOptions)throw Error("InternalError: Compilation options not defined");return t?await f.ComputedLegacyLabelExpression.create(p.expression,this.compilationOptions):await a.ComputedExpression.create(p.expression,this.compilationOptions)}catch(w){return p=new q("featurelayer","Failed to compile arcade expression",{error:w,expression:p.expression}),x().error(p),null}if(p.normalizationType||p.normalizationField)return new d.NormalizedField(p.field,
p);if(p.field)return new l.CachedField(p.field);p=new q("featurelayer","Unable to create computed field. No expression or field found",{info:p});x().error(p);return null}async createWhereClause(p){return p?e.createWhereClause(p,this.compilationOptions.fields):null}getBitset(p){return this._bitsets[p-1]}getComputedNumeric(p,t){return this.getComputedNumericAtIndex(p&k.displayIdTexelMask,0)}setComputedNumeric(p,t,w){return this.setComputedNumericAtIndex(p&k.displayIdTexelMask,w,0)}getComputedString(p,
t){return this.getComputedStringAtIndex(p&k.displayIdTexelMask,0)}setComputedString(p,t,w){return this.setComputedStringAtIndex(p&k.displayIdTexelMask,0,w)}getComputedNumericAtIndex(p,t){p&=k.displayIdTexelMask;this._ensureNumeric(t,p);return this._numerics[t][p]}setComputedNumericAtIndex(p,t,w){p&=k.displayIdTexelMask;this._ensureNumeric(t,p);this._numerics[t][p]=w}getPackedChunkId(p){p&=k.displayIdTexelMask;this._ensureInstanceId(p);return this._instanceIds[p]}setPackedChunkId(p,t){p&=k.displayIdTexelMask;
this._ensureInstanceId(p);this._instanceIds[p]=t}getComputedStringAtIndex(p,t){p&=k.displayIdTexelMask;this._ensureString(t,p);return this._strings[t][p]}setComputedStringAtIndex(p,t,w){p&=k.displayIdTexelMask;this._ensureString(t,p);this._strings[t][p]=w}getXMin(p){return this._bounds[4*(p&k.displayIdTexelMask)]}getYMin(p){return this._bounds[4*(p&k.displayIdTexelMask)+1]}getXMax(p){return this._bounds[4*(p&k.displayIdTexelMask)+2]}getYMax(p){return this._bounds[4*(p&k.displayIdTexelMask)+3]}setBounds(p,
t,w=!1){const r=p&k.displayIdTexelMask;if(!w&&!this._dirtyBitset.has(p))return 4294967295!==this._bounds[4*r];this._dirtyBitset.unset(p);p=t.readGeometryWorldSpace();h(this._bounds,4*r+4,0);if(!p||!p.coords.length)return this._bounds[4*r]=4294967295,this._bounds[4*r+1]=4294967295,this._bounds[4*r+2]=4294967295,this._bounds[4*r+3]=4294967295,!1;let y=Infinity,z=Infinity,u=-Infinity,v=-Infinity;p.forEachVertex((A,B)=>{y=Math.min(y,A);z=Math.min(z,B);u=Math.max(u,A);v=Math.max(v,B)});this._bounds[4*
r]=y;this._bounds[4*r+1]=z;this._bounds[4*r+2]=u;this._bounds[4*r+3]=v;return!0}getBounds(p,t){const w=this.getXMin(t),r=this.getYMin(t),y=this.getXMax(t);t=this.getYMax(t);g.fromRectValues(p,w,r,y,t);return 4294967295!==w}_ensureNumeric(p,t){this._numerics[p]||(this._numerics[p]=[]);h(this._numerics[p],t,0)}_ensureInstanceId(p){h(this._instanceIds,p,0)}_ensureString(p,t){this._strings[p]||(this._strings[p]=[]);h(this._strings[p],t,null)}}b.ComputedAttributeStorage=m;Object.defineProperty(b,Symbol.toStringTag,
{value:"Module"})})},"esri/views/2d/layers/features/support/CachedField":function(){define(["exports","./AComputedField"],function(b,q){class n extends q.AComputedField{constructor(g){super();this._field=g}resize(g){throw Error("Method not implemented.");}read(g,k){return g.readAttribute(this._field)}readWithDefault(g,k){return g.readAttribute(this._field)}referencesScale(){return!1}referencesGeometry(){return!1}}b.CachedField=n;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/support/ComputedExpression":function(){define(["exports",
"../../../../../core/string","../../../../../support/arcadeOnDemand","../../../arcade/callExpressionWithCursor","./AComputedField"],function(b,q,n,g,k){class l extends k.AComputedField{static async create(a,f){f=await n.createRendererExpression(a,f.spatialReference,f.fields);a=q.numericHash(a);return new l(f,a)}constructor(a,f){super();this._compiled=a;this._cacheKey=f}resize(a){}read(a,f){return this.referencesScale()||"system"!==f.$view.timeZone?g.callExpressionWithCursor(this._compiled,a,f):this._readCached(a,
f)}readWithDefault(a,f,d){return this.referencesScale()||"system"!==f.$view.timeZone?g.callExpressionWithCursorWithDefault(this._compiled,a,f,d):this._readWithDefaultCached(a,f,d)}referencesScale(){return this._compiled?.referencesScale()??!1}referencesGeometry(){return this._compiled?.referencesGeometry()??!1}_readCached(a,f){a.setCache(this._cacheKey);if(a.hasCachedValue())return a.getCachedValue();f=g.callExpressionWithCursor(this._compiled,a,f);a.setCachedValue(f);return f}_readWithDefaultCached(a,
f,d){a.setCache(this._cacheKey);if(a.hasCachedValue())return a.getCachedValue();f=g.callExpressionWithCursorWithDefault(this._compiled,a,f,d);a.setCachedValue(f);return f}}b.ComputedExpression=l;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/support/ComputedLegacyLabelExpression":function(){define(["exports","../../../../../layers/support/labelFormatUtils","../../../../../layers/support/labelUtils","../../../arcade/callExpressionWithCursor","./AComputedField"],
function(b,q,n,g,k){class l extends k.AComputedField{static async create(a,f){const d=n.sqlToTemplateString(a);return new l(c=>d.replaceAll(/{[^}]*}/g,e=>{const h=e.slice(1,-1),x=c.metadata.fieldsIndex.get(h);if(null==x)return e;e=c.readAttribute(h);return null==e?"":q.formatField(e,x)}))}constructor(a){super();this._evaluator=a}resize(a){}read(a,f){return this._evaluator(a)}readWithDefault(a,f,d){a=this._evaluator(a);return g.isBadArcadeResult(a)?d:a}referencesScale(){return!1}referencesGeometry(){return!1}}
b.ComputedLegacyLabelExpression=l;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/labelFormatUtils":function(){define("exports ../../core/Error ../../core/Logger ../../core/sql ../../intl/date ../../intl/number ./domainUtils ./fieldUtils ./labelUtils ../../support/arcadeOnDemand".split(" "),function(b,q,n,g,k,l,a,f,d,c){function e(p,t){if(null==p)return"";const w=t.domain;if(w)if("codedValue"===w.type||"coded-value"===w.type)for(var r of w.codedValues){if(r.code===
p)return r.name}else if("range"===w.type){const {max:y,min:z}=a.getDomainRange(t);r=+p;if(null!=z&&null!=y&&z<=r&&r<=y)return w.name}f.isDateField(t)?p=k.formatDate(p,k.convertDateFormatToIntlOptions("short-date")):f.isNumericField(t)&&(p=l.formatNumber(+p));return p||""}const h=()=>n.getLogger("esri.layers.support.labelFormatUtils"),x={type:"simple",evaluate(){return null}},m={getAttribute(p,t){return p.field(t)}};b.createLabelFunction=async function(p,t,w){if(!p||!p.symbol||!t)return x;const r=
p.where,y=d.getLabelExpression(p);if("arcade"===y.type){const z=await c.createLabelExpression(y.expression,w,t);if(null==z)return x;p={type:"arcade",evaluate(u,v){try{const A="attributes"in u?z.repurposeFeature(u):u;A.contextTimeZone=v??null;const B=z.evaluate({$view:{timeZone:v},$feature:A},z.services);if(null!=B)return B.toString()}catch(A){h().error(new q("arcade-expression-error","Encountered an error when evaluating label expression for feature",{error:A,feature:u,expression:y}))}return null},
needsHydrationToEvaluate(){return null==d.getSingleFieldArcadeExpression(y.expression)}}}else p={type:"simple",evaluate(z){return y.expression.replaceAll(/{[^}]*}/g,u=>{var v=u.slice(1,-1);v=t.get(v);if(!v)return u;u=null;"attributes"in z?z&&z.attributes&&(u=z.attributes[v.name]):u=z.field(v.name);return null==u?"":e(u,v)})}};if(r){let z;try{z=await g.parseWhereClause(r,t)}catch(v){return h().error(new q("bad-where-clause","Encountered an error when evaluating where clause, ignoring",{where:r,error:v})),
x}const u=p.evaluate;p.evaluate=(v,A)=>{const B="attributes"in v?void 0:m;try{if(z.testFeature(v,B))return u(v,A)}catch(F){h().error(new q("bad-where-clause","Encountered an error when evaluating where clause for feature",{where:r,feature:v,error:F}))}return null}}return p};b.formatField=e;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/labelUtils":function(){define(["exports","../../core/string"],function(b,q){function n(t){return t.replaceAll(RegExp("\\[","g"),
"{").replaceAll(RegExp("\\]","g"),"}")}function g(t){const w={expression:"",type:"none"};t.labelExpressionInfo?t.labelExpressionInfo.value?(w.expression=t.labelExpressionInfo.value,w.type="conventional"):t.labelExpressionInfo.expression&&(w.expression=t.labelExpressionInfo.expression,w.type="arcade"):null!=t.labelExpression&&(w.expression=n(t.labelExpression),w.type="conventional");return w}function k(t){t?(t=q.replace(t,w=>'__begin__$feature["'+w+'"]__end__'),t=c.test(t)?t.replace(c,""):'"'+t,t=
e.test(t)?t.replace(e,""):t+'"',t=t.replaceAll(f,'" + ').replaceAll(d,' + "')):t='""';return t}function l(t){return t?.match(h)?.[1].trim()||null}function a(t){if(!t)return null;let w=x.exec(t)||m.exec(t);return w?w[1]||w[3]:(w=p.exec(t))?w[2]:null}const f=RegExp("__begin__","ig"),d=RegExp("__end__","ig"),c=RegExp("^__begin__","i"),e=RegExp("__end__$","i"),h=/^\s*\{([^}]+)\}\s*$/i,x=/^\s*(?:(?:\$feature\.(\w+))|(?:\$feature\[(["'])(.+)(\2)\]));?\s*$/i,m=/^\s*(?:(?:\$feature\.(\w+))|(?:\$feature\[(["'])(.+)(\2)\]));?\s*(?:DomainName\(\s*\$feature\s*,\s*(["'])(\1|\3)(\5)\s*\));?\s*$/i,
p=/^\s*(?:DomainName\(\s*\$feature\s*,\s*(["'])(.+)(\1)\s*\));?\s*$/i;b.convertTemplatedStringToArcade=k;b.getLabelExpression=g;b.getLabelExpressionArcade=function(t){t=g(t);if(!t)return null;switch(t.type){case "conventional":return k(t.expression);case "arcade":return t.expression}return null};b.getLabelExpressionSingleField=function(t){t=g(t);if(!t)return null;switch(t.type){case "conventional":return l(t.expression);case "arcade":return a(t.expression)}return null};b.getSingleFieldArcadeExpression=
a;b.getSingleFieldTemplatedString=l;b.sqlToTemplateString=n;b.templateStringToSql=function(t){return t.replaceAll(RegExp("\\{","g"),"[").replaceAll(RegExp("\\}","g"),"]")};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/support/NormalizedField":function(){define(["exports","./AComputedField"],function(b,q){class n extends q.AComputedField{constructor(g,k){super();this._field=g;this._normalizationInfo=k}resize(g){throw Error("Method not implemented.");
}read(g,k){return this._readNormalized(g)}readWithDefault(g,k){return this._readNormalized(g)}referencesScale(){return!1}referencesGeometry(){return!1}_readNormalized(g){const k=g.readAttribute(this._field);if(null==k)return null;const {normalizationField:l,normalizationTotal:a,normalizationType:f}=this._normalizationInfo;g=g.readAttribute(l);switch(f??"esriNormalizeByField"){case "esriNormalizeByField":return g?(g||void 0)&&k/g:null;case "esriNormalizeByLog":return Math.log(k)*Math.LOG10E;case "esriNormalizeByPercentOfTotal":return a?
k/a*100:null}}}b.NormalizedField=n;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/support/whereUtils":function(){define(["exports","../../../../../core/Error","../../../../../core/Logger","../../../../../core/sql"],function(b,q,n,g){const k=()=>n.getLogger("esri.views.2d.layers.features.support.whereUtils"),l={getAttribute(a,f){return a.readAttribute(f)}};b.createWhereClause=async function(a,f){try{const d=await g.parseWhereClause(a,f);if(!d.isStandardized){const c=
new q("mapview - bad input","Unable to apply filter's definition expression, as expression is not standardized.",d);k().error(c)}return c=>{c=c.readArcadeFeature();try{return d.testFeature(c,l)}catch(e){return k().warn("mapview-bad-where-clause","Encountered an error when evaluating where clause",a),!0}}}catch(d){return k().warn("mapview-bad-where-clause","Encountered an error when evaluating where clause",a),c=>!0}};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/support/FeatureFilter":function(){define("../../../../../core/Error ../../../../../core/Logger ../../../../../geometry/support/aaBoundingRect ../../../../../geometry/support/boundsUtils ../../../../../layers/graphics/data/queryUtils ../../../../../layers/graphics/data/spatialQuerySupport ../../../../../layers/graphics/data/timeSupport ../../../../../rest/support/Query ../FeatureStoreQueryAdapter ./whereUtils".split(" "),
function(b,q,n,g,k,l,a,f,d,c){class e{constructor(h){this._geometryBounds=n.create();this._idToVisibility=new Map;this._serviceInfo=h}static async create(h){const x=new e(h);await x.update(h.filterJSON,h.spatialReference);return x}get hash(){return this._hash}check(h){return this._applyFilter(h)}clear(){const h=this._resetAllHiddenIds();this.update();return{show:h,hide:[]}}invalidate(){this._idToVisibility.forEach((h,x)=>{this._idToVisibility.set(x,0)})}setKnownIds(h){for(const x of h)this._idToVisibility.set(x,
1)}setTrue(h){const x=[],m=[],p=new Set(h);this._idToVisibility.forEach((t,w)=>{t=!!(this._idToVisibility.get(w)&1);const r=p.has(w);!t&&r?x.push(w):t&&!r&&m.push(w);this._idToVisibility.set(w,r?3:0)});return{show:x,hide:m}}createQuery(){const {geometry:h,spatialRel:x,where:m,timeExtent:p,objectIds:t}=this;return f.fromJSON({geometry:h,spatialRel:x,where:m,timeExtent:p,objectIds:t})}async update(h,x){this._hash=JSON.stringify(h);h=await k.normalizeQueryLike(h,null,x);await Promise.all([this._setGeometryFilter(h),
this._setIdFilter(h),this._setAttributeFilter(h),this._setTimeFilter(h)])}async _setAttributeFilter(h){h?.where?(this._clause=await c.createWhereClause(h.where,this._serviceInfo.fieldsIndex),this.where=h.where):this.where=this._clause=null}_setIdFilter(h){this._idsToShow=h?.objectIds&&new Set(h.objectIds);this._idsToHide=h?.hiddenIds&&new Set(h.hiddenIds);this.objectIds=h?.objectIds}async _setGeometryFilter(h){if(h?.geometry){var x=h.geometry;h=h.spatialRel||"esriSpatialRelIntersects";var m=await l.getSpatialQueryOperator(h,
x,this._serviceInfo.geometryType,this._serviceInfo.hasZ,this._serviceInfo.hasM);g.getBoundsXY(this._geometryBounds,x);this._spatialQueryOperator=m;this.geometry=x;this.spatialRel=h}else this.spatialRel=this.geometry=this._spatialQueryOperator=null}_setTimeFilter(h){this.timeExtent=this._timeOperator=null;h?.timeExtent&&(this._serviceInfo.timeInfo?(this.timeExtent=h.timeExtent,this._timeOperator=a.getTimeOperator(this._serviceInfo.timeInfo,h.timeExtent,d.FeatureStoreQueryAdapter.Shared)):(h=new b("feature-layer-view:time-filter-not-available",
"Unable to apply time filter, as layer doesn't have time metadata.",h.timeExtent),q.getLogger("esri.views.2d.layers.features.controllers.FeatureFilter").error(h)))}_applyFilter(h){return this._filterByGeometry(h)&&this._filterById(h)&&this._filterByTime(h)&&this._filterByExpression(h)}_filterByExpression(h){return this.where?this._clause(h):!0}_filterById(h){return(!this._idsToHide?.size||!this._idsToHide.has(h.getObjectId()))&&(!this._idsToShow?.size||this._idsToShow.has(h.getObjectId()))}_filterByGeometry(h){return this.geometry?
(h=h.readGeometryWorldSpace())?this._spatialQueryOperator(h):!1:!0}_filterByTime(h){return null==this._timeOperator?!0:this._timeOperator(h)}_resetAllHiddenIds(){const h=[];this._idToVisibility.forEach((x,m)=>{x&1||(this._idToVisibility.set(m,1),h.push(m))});return h}}return e})},"esri/rest/support/Query":function(){define("../../chunks/tslib.es6 ../../geometry ../../core/jsonMap ../../core/JSONSupport ../../core/lang ../../core/accessorSupport/decorators/property ../../core/accessorSupport/decorators/cast ../../core/accessorSupport/decorators/enumeration ../../core/accessorSupport/decorators/subclass ../../core/accessorSupport/decorators/writer ../../core/accessorSupport/ensureType ../../geometry/support/jsonUtils ../../layers/support/source/DataLayerSource ./FullTextSearch ./QuantizationParameters ./spatialRelationships ./StatisticDefinition ../../time/TimeExtent ../../geometry/SpatialReference ../../geometry/Point".split(" "),
function(b,q,n,g,k,l,a,f,d,c,e,h,x,m,p,t,w,r,y,z){var u;n=new n.JSONMap({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});let v=u=class extends g.JSONSupport{static from(A){return e.ensureClass(u,A)}constructor(A){super(A);this.aggregateIds=null;this.cacheHint=void 0;this.compactGeometryEnabled=!1;this.datumTransformation=null;this.defaultSpatialReferenceEnabled=
!1;this.dynamicDataSource=this.distance=void 0;this.geometry=this.gdbVersion=this.fullText=this.formatOf3DObjects=null;this.geometryPrecision=void 0;this.historicMoment=this.having=this.groupByFieldsForStatistics=null;this.maxAllowableOffset=void 0;this.maxRecordCountFactor=1;this.multipatchOption=null;this.num=void 0;this.resultType=this.relationParameter=this.rangeValues=this.quantizationParameters=this.pixelSize=this.parameterValues=this.outStatistics=this.outSpatialReference=this.outFields=this.orderByFields=
this.objectIds=null;this.returnDistinctValues=this.returnCentroid=!1;this.returnExceededLimitFeatures=!0;this.returnQueryGeometry=this.returnGeometry=!1;this.returnZ=this.returnM=void 0;this.sourceSpatialReference=null;this.spatialRelationship="intersects";this.start=void 0;this.timeExtent=this.text=this.sqlFormat=null;this.timeReferenceUnknownClient=!1;this.where=this.units=null}castDatumTransformation(A){return"number"===typeof A||"object"===typeof A?A:null}writeHistoricMoment(A,B){B.historicMoment=
A&&A.getTime()}writeParameterValues(A,B){if(A){const F={};for(const H in A){const J=A[H];Array.isArray(J)?F[H]=J.map(E=>E instanceof Date?E.getTime():E):F[H]=J instanceof Date?J.getTime():J}B.parameterValues=F}}writeStart(A,B){B.resultOffset=this.start;B.resultRecordCount=this.num||10;B.where="1\x3d1"}writeWhere(A,B){B.where=A||"1\x3d1"}clone(){return new u(k.clone({aggregateIds:this.aggregateIds,cacheHint:this.cacheHint,compactGeometryEnabled:this.compactGeometryEnabled,datumTransformation:this.datumTransformation,
defaultSpatialReferenceEnabled:this.defaultSpatialReferenceEnabled,distance:this.distance,fullText:this.fullText,formatOf3DObjects:this.formatOf3DObjects,gdbVersion:this.gdbVersion,geometry:this.geometry,geometryPrecision:this.geometryPrecision,groupByFieldsForStatistics:this.groupByFieldsForStatistics,having:this.having,historicMoment:null!=this.historicMoment?new Date(this.historicMoment.getTime()):null,maxAllowableOffset:this.maxAllowableOffset,maxRecordCountFactor:this.maxRecordCountFactor,multipatchOption:this.multipatchOption,
num:this.num,objectIds:this.objectIds,orderByFields:this.orderByFields,outFields:this.outFields,outSpatialReference:this.outSpatialReference,outStatistics:this.outStatistics,parameterValues:this.parameterValues,pixelSize:this.pixelSize,quantizationParameters:this.quantizationParameters,rangeValues:this.rangeValues,relationParameter:this.relationParameter,resultType:this.resultType,returnDistinctValues:this.returnDistinctValues,returnGeometry:this.returnGeometry,returnCentroid:this.returnCentroid,
returnExceededLimitFeatures:this.returnExceededLimitFeatures,returnQueryGeometry:this.returnQueryGeometry,returnM:this.returnM,returnZ:this.returnZ,dynamicDataSource:this.dynamicDataSource,sourceSpatialReference:this.sourceSpatialReference,spatialRelationship:this.spatialRelationship,start:this.start,sqlFormat:this.sqlFormat,text:this.text,timeExtent:this.timeExtent,timeReferenceUnknownClient:this.timeReferenceUnknownClient,units:this.units,where:this.where}))}};v.MAX_MAX_RECORD_COUNT_FACTOR=5;b.__decorate([l.property({json:{write:!0}})],
v.prototype,"aggregateIds",void 0);b.__decorate([l.property({type:Boolean,json:{write:!0}})],v.prototype,"cacheHint",void 0);b.__decorate([l.property({type:Boolean,json:{default:!1,write:!0}})],v.prototype,"compactGeometryEnabled",void 0);b.__decorate([l.property({json:{write:!0}})],v.prototype,"datumTransformation",void 0);b.__decorate([a.cast("datumTransformation")],v.prototype,"castDatumTransformation",null);b.__decorate([l.property({type:Boolean,json:{default:!1,write:!0}})],v.prototype,"defaultSpatialReferenceEnabled",
void 0);b.__decorate([l.property({type:Number,json:{write:{overridePolicy(A){return{enabled:0<A}}}}})],v.prototype,"distance",void 0);b.__decorate([l.property({type:x.DataLayerSource,json:{write:!0}})],v.prototype,"dynamicDataSource",void 0);b.__decorate([l.property({type:String,json:{write:!0}})],v.prototype,"formatOf3DObjects",void 0);b.__decorate([l.property({type:[m],json:{write:{enabled:!0,overridePolicy(){return{enabled:null!=this.fullText&&0<this.fullText.length}}}}})],v.prototype,"fullText",
void 0);b.__decorate([l.property({type:String,json:{write:!0}})],v.prototype,"gdbVersion",void 0);b.__decorate([l.property({types:q.geometryTypes,json:{read:h.fromJSON,write:!0}})],v.prototype,"geometry",void 0);b.__decorate([l.property({type:Number,json:{write:!0}})],v.prototype,"geometryPrecision",void 0);b.__decorate([l.property({type:[String],json:{write:!0}})],v.prototype,"groupByFieldsForStatistics",void 0);b.__decorate([l.property({type:String,json:{write:!0}})],v.prototype,"having",void 0);
b.__decorate([l.property({type:Date})],v.prototype,"historicMoment",void 0);b.__decorate([c.writer("historicMoment")],v.prototype,"writeHistoricMoment",null);b.__decorate([l.property({type:Number,json:{write:!0}})],v.prototype,"maxAllowableOffset",void 0);b.__decorate([l.property({type:Number,cast(A){return 1>A?1:A>v.MAX_MAX_RECORD_COUNT_FACTOR?v.MAX_MAX_RECORD_COUNT_FACTOR:A},json:{write:{overridePolicy(A){return{enabled:1<A}}}}})],v.prototype,"maxRecordCountFactor",void 0);b.__decorate([l.property({type:["xyFootprint"],
json:{write:!0}})],v.prototype,"multipatchOption",void 0);b.__decorate([l.property({type:Number,json:{read:{source:"resultRecordCount"}}})],v.prototype,"num",void 0);b.__decorate([l.property({json:{write:!0}})],v.prototype,"objectIds",void 0);b.__decorate([l.property({type:[String],json:{write:!0}})],v.prototype,"orderByFields",void 0);b.__decorate([l.property({type:[String],json:{write:!0}})],v.prototype,"outFields",void 0);b.__decorate([l.property({type:y,json:{name:"outSR",write:!0}})],v.prototype,
"outSpatialReference",void 0);b.__decorate([l.property({type:[w],json:{write:{enabled:!0,overridePolicy(){return{enabled:null!=this.outStatistics&&0<this.outStatistics.length}}}}})],v.prototype,"outStatistics",void 0);b.__decorate([l.property({json:{write:!0}})],v.prototype,"parameterValues",void 0);b.__decorate([c.writer("parameterValues")],v.prototype,"writeParameterValues",null);b.__decorate([l.property({type:z,json:{write:!0}})],v.prototype,"pixelSize",void 0);b.__decorate([l.property({type:p,
json:{write:!0}})],v.prototype,"quantizationParameters",void 0);b.__decorate([l.property({type:[Object],json:{write:!0}})],v.prototype,"rangeValues",void 0);b.__decorate([l.property({type:String,json:{read:{source:"relationParam"},write:{target:"relationParam",overridePolicy(){return{enabled:"relation"===this.spatialRelationship}}}}})],v.prototype,"relationParameter",void 0);b.__decorate([l.property({type:String,json:{write:!0}})],v.prototype,"resultType",void 0);b.__decorate([l.property({type:Boolean,
json:{default:!1,write:!0}})],v.prototype,"returnCentroid",void 0);b.__decorate([l.property({type:Boolean,json:{default:!1,write:!0}})],v.prototype,"returnDistinctValues",void 0);b.__decorate([l.property({type:Boolean,json:{default:!0,write:!0}})],v.prototype,"returnExceededLimitFeatures",void 0);b.__decorate([l.property({type:Boolean,json:{write:!0}})],v.prototype,"returnGeometry",void 0);b.__decorate([l.property({type:Boolean,json:{default:!1,write:!0}})],v.prototype,"returnQueryGeometry",void 0);
b.__decorate([l.property({type:Boolean,json:{default:!1,write:!0}})],v.prototype,"returnM",void 0);b.__decorate([l.property({type:Boolean,json:{write:{overridePolicy(A){return{enabled:A}}}}})],v.prototype,"returnZ",void 0);b.__decorate([l.property({type:y,json:{write:!0}})],v.prototype,"sourceSpatialReference",void 0);b.__decorate([f.enumeration(t.spatialRelKebabDict,{ignoreUnknown:!1,name:"spatialRel"})],v.prototype,"spatialRelationship",void 0);b.__decorate([l.property({type:Number,json:{read:{source:"resultOffset"}}})],
v.prototype,"start",void 0);b.__decorate([c.writer("start"),c.writer("num")],v.prototype,"writeStart",null);b.__decorate([l.property({type:String,json:{write:!0}})],v.prototype,"sqlFormat",void 0);b.__decorate([l.property({type:String,json:{write:!0}})],v.prototype,"text",void 0);b.__decorate([l.property({type:r,json:{write:!0}})],v.prototype,"timeExtent",void 0);b.__decorate([l.property({type:Boolean,json:{default:!1,write:!0}})],v.prototype,"timeReferenceUnknownClient",void 0);b.__decorate([f.enumeration(n,
{ignoreUnknown:!1}),l.property({json:{write:{overridePolicy(A){return{enabled:!!A&&null!=this.distance&&0<this.distance}}}}})],v.prototype,"units",void 0);b.__decorate([l.property({type:String,json:{write:{overridePolicy(A){return{enabled:null!=A||null!=this.start&&0<this.start}}}}})],v.prototype,"where",void 0);b.__decorate([c.writer("where")],v.prototype,"writeWhere",null);return v=u=b.__decorate([d.subclass("esri.rest.support.Query")],v)})},"esri/layers/support/source/DataLayerSource":function(){define("exports ../../../chunks/tslib.es6 ../../../core/jsonMap ../../../core/JSONSupport ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/decorators/cast ../../../core/accessorSupport/decorators/enumeration ../../../core/accessorSupport/decorators/reader ../../../core/accessorSupport/decorators/subclass ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/extensions/serializableProperty/reader ../Field ./MapLayerSource ./QueryTableDataSource ./RasterDataSource ./TableDataSource".split(" "),
function(b,q,n,g,k,l,a,f,d,c,e,h,x,m,p,t){function w(){u||=e.createTypeReader({types:r()});return u}function r(){v||={key:"type",base:null,typeMap:{"data-layer":b.DataLayerSource,"map-layer":x.MapLayerSource}};return v}var y,z;n=n.strict()({esriLeftInnerJoin:"left-inner-join",esriLeftOuterJoin:"left-outer-join"});b.JoinTableDataSource=y=class extends g.JSONSupport{constructor(A){super(A);this.type="join-table"}readLeftTableSource(A,B,F){return w()(A,B,F)}castLeftTableSource(A){return c.ensureOneOfType(r(),
A)}readRightTableSource(A,B,F){return w()(A,B,F)}castRightTableSource(A){return c.ensureOneOfType(r(),A)}clone(){const {leftTableKey:A,rightTableKey:B,leftTableSource:F,rightTableSource:H,joinType:J}=this,E={leftTableKey:A,rightTableKey:B,leftTableSource:F?.clone()??void 0,rightTableSource:H?.clone()??void 0,joinType:J};return new y(E)}};q.__decorate([a.enumeration({joinTable:"join-table"})],b.JoinTableDataSource.prototype,"type",void 0);q.__decorate([k.property({type:String,json:{write:!0}})],b.JoinTableDataSource.prototype,
"leftTableKey",void 0);q.__decorate([k.property({type:String,json:{write:!0}})],b.JoinTableDataSource.prototype,"rightTableKey",void 0);q.__decorate([k.property({json:{write:!0}})],b.JoinTableDataSource.prototype,"leftTableSource",void 0);q.__decorate([f.reader("leftTableSource")],b.JoinTableDataSource.prototype,"readLeftTableSource",null);q.__decorate([l.cast("leftTableSource")],b.JoinTableDataSource.prototype,"castLeftTableSource",null);q.__decorate([k.property({json:{write:!0}})],b.JoinTableDataSource.prototype,
"rightTableSource",void 0);q.__decorate([f.reader("rightTableSource")],b.JoinTableDataSource.prototype,"readRightTableSource",null);q.__decorate([l.cast("rightTableSource")],b.JoinTableDataSource.prototype,"castRightTableSource",null);q.__decorate([a.enumeration(n)],b.JoinTableDataSource.prototype,"joinType",void 0);b.JoinTableDataSource=y=q.__decorate([d.subclass("esri.layers.support.source.JoinTableDataSource")],b.JoinTableDataSource);let u=null,v=null;l={key:"type",base:null,typeMap:{"join-table":b.JoinTableDataSource,
"query-table":m.QueryTableDataSource,raster:p.RasterDataSource,table:t.TableDataSource}};b.DataLayerSource=z=class extends g.JSONSupport{constructor(A){super(A);this.type="data-layer"}clone(){const {fields:A,dataSource:B}=this;return new z({fields:A,dataSource:B})}};q.__decorate([a.enumeration({dataLayer:"data-layer"})],b.DataLayerSource.prototype,"type",void 0);q.__decorate([k.property({type:[h],json:{write:!0}})],b.DataLayerSource.prototype,"fields",void 0);q.__decorate([k.property({types:l,json:{write:!0}})],
b.DataLayerSource.prototype,"dataSource",void 0);b.DataLayerSource=z=q.__decorate([d.subclass("esri.layers.support.source.DataLayerSource")],b.DataLayerSource);b.DataLayerSource.from=c.ensureType(b.DataLayerSource);Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/Field":function(){define("../../chunks/tslib.es6 ../../core/jsonMap ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/RandomLCG ../../core/has ../../core/accessorSupport/decorators/enumeration ../../core/accessorSupport/decorators/reader ../../core/accessorSupport/decorators/subclass ./domains ./fieldType".split(" "),
function(b,q,n,g,k,l,a,f,d,c,e,h){var x;const m=new q.JSONMap({binary:"binary",coordinate:"coordinate",countOrAmount:"count-or-amount",dateAndTime:"date-and-time",description:"description",locationOrPlaceName:"location-or-place-name",measurement:"measurement",nameOrTitle:"name-or-title",none:"none",orderedOrRanked:"ordered-or-ranked",percentageOrRatio:"percentage-or-ratio",typeOrCategory:"type-or-category",uniqueIdentifier:"unique-identifier"});q=x=class extends n.JSONSupport{constructor(p){super(p);
this.alias=null;this.defaultValue=void 0;this.domain=this.description=null;this.editable=!0;this.length=void 0;this.name=null;this.nullable=!0;this.valueType=this.type=null;this.visible=!0}readDescription(p,{description:t}){p=null;try{p=t?JSON.parse(t):null}catch(w){}return p?.value??null}readValueType(p,{description:t}){p=null;try{p=t?JSON.parse(t):null}catch(w){}return p?m.fromJSON(p.fieldValueType):null}clone(){return new x({alias:this.alias,defaultValue:this.defaultValue,description:this.description,
domain:this.domain?.clone()??null,editable:this.editable,length:this.length,name:this.name,nullable:this.nullable,type:this.type,valueType:this.valueType,visible:this.visible})}};b.__decorate([g.property({type:String,json:{write:!0}})],q.prototype,"alias",void 0);b.__decorate([g.property({type:[String,Number],json:{write:{allowNull:!0}}})],q.prototype,"defaultValue",void 0);b.__decorate([g.property()],q.prototype,"description",void 0);b.__decorate([d.reader("description")],q.prototype,"readDescription",
null);b.__decorate([g.property({types:e.types,json:{read:{reader:e.fromJSON},write:!0}})],q.prototype,"domain",void 0);b.__decorate([g.property({type:Boolean,json:{write:!0}})],q.prototype,"editable",void 0);b.__decorate([g.property({type:k.Integer,json:{write:{overridePolicy(p){return{enabled:Number.isFinite(p)}}}}})],q.prototype,"length",void 0);b.__decorate([g.property({type:String,json:{write:!0}})],q.prototype,"name",void 0);b.__decorate([g.property({type:Boolean,json:{write:!0}})],q.prototype,
"nullable",void 0);b.__decorate([f.enumeration(h.kebabDict)],q.prototype,"type",void 0);b.__decorate([g.property()],q.prototype,"valueType",void 0);b.__decorate([d.reader("valueType",["description"])],q.prototype,"readValueType",null);b.__decorate([g.property({type:Boolean,json:{read:!1}})],q.prototype,"visible",void 0);return q=x=b.__decorate([c.subclass("esri.layers.support.Field")],q)})},"esri/layers/support/domains":function(){define("exports ../../core/has ./CodedValueDomain ./Domain ./InheritedDomain ./RangeDomain".split(" "),
function(b,q,n,g,k,l){q={key:"type",base:g,typeMap:{range:l,"coded-value":n,inherited:k}};b.CodedValueDomain=n;b.DomainBase=g;b.InheritedDomain=k;b.RangeDomain=l;b.fromJSON=function(a){if(!a?.type)return null;switch(a.type){case "range":return l.fromJSON(a);case "codedValue":return n.fromJSON(a);case "inherited":return k.fromJSON(a)}return null};b.types=q;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/CodedValueDomain":function(){define("../../chunks/tslib.es6 ../../core/lang ../../core/accessorSupport/decorators/property ../../core/has ../../core/Logger ../../core/accessorSupport/decorators/enumeration ../../core/accessorSupport/decorators/subclass ./CodedValue ./Domain".split(" "),
function(b,q,n,g,k,l,a,f,d){var c;g=c=class extends d{constructor(e){super(e);this.codedValues=null;this.type="coded-value"}getName(e){let h=null;if(this.codedValues){const x=String(e);this.codedValues.some(m=>{String(m.code)===x&&(h=m.name);return!!h})}return h}clone(){return new c({codedValues:q.clone(this.codedValues),name:this.name})}};b.__decorate([n.property({type:[f.CodedValue],json:{write:!0}})],g.prototype,"codedValues",void 0);b.__decorate([l.enumeration({codedValue:"coded-value"})],g.prototype,
"type",void 0);return g=c=b.__decorate([a.subclass("esri.layers.support.CodedValueDomain")],g)})},"esri/layers/support/CodedValue":function(){define("exports ../../chunks/tslib.es6 ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/has ../../core/Logger ../../core/RandomLCG ../../core/accessorSupport/decorators/subclass".split(" "),function(b,q,n,g,k,l,a,f){var d;b.CodedValue=d=class extends n.JSONSupport{constructor(c){super(c);this.code=this.name=null}clone(){return new d({name:this.name,
code:this.code})}};q.__decorate([g.property({type:String,json:{write:!0}})],b.CodedValue.prototype,"name",void 0);q.__decorate([g.property({type:[String,Number],json:{write:!0}})],b.CodedValue.prototype,"code",void 0);b.CodedValue=d=q.__decorate([f.subclass("esri.layers.support.CodedValue")],b.CodedValue);Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/Domain":function(){define("../../chunks/tslib.es6 ../../core/jsonMap ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/has ../../core/Logger ../../core/RandomLCG ../../core/accessorSupport/decorators/enumeration ../../core/accessorSupport/decorators/subclass".split(" "),
function(b,q,n,g,k,l,a,f,d){q=new q.JSONMap({inherited:"inherited",codedValue:"coded-value",range:"range"});n=class extends n.JSONSupport{constructor(c){super(c);this.type=this.name=null}};b.__decorate([g.property({type:String,json:{write:!0}})],n.prototype,"name",void 0);b.__decorate([f.enumeration(q)],n.prototype,"type",void 0);return n=b.__decorate([d.subclass("esri.layers.support.Domain")],n)})},"esri/layers/support/InheritedDomain":function(){define("../../chunks/tslib.es6 ../../core/Logger ../../core/has ../../core/RandomLCG ../../core/Error ../../core/accessorSupport/decorators/enumeration ../../core/accessorSupport/decorators/subclass ./Domain".split(" "),
function(b,q,n,g,k,l,a,f){var d;q=d=class extends f{constructor(c){super(c);this.type="inherited"}clone(){return new d}};b.__decorate([l.enumeration({inherited:"inherited"})],q.prototype,"type",void 0);return q=d=b.__decorate([a.subclass("esri.layers.support.InheritedDomain")],q)})},"esri/layers/support/RangeDomain":function(){define("../../chunks/tslib.es6 ../../core/accessorSupport/decorators/property ../../core/has ../../core/Logger ../../core/RandomLCG ../../core/accessorSupport/decorators/enumeration ../../core/accessorSupport/decorators/subclass ./Domain".split(" "),
function(b,q,n,g,k,l,a,f){var d;n=d=class extends f{constructor(c){super(c);this.minValue=this.maxValue=null;this.type="range"}clone(){return new d({maxValue:this.maxValue,minValue:this.minValue,name:this.name})}};b.__decorate([q.property({json:{type:[Number],read:{source:"range",reader(c,e){return e.range?.[1]}},write:{enabled:!1,overridePolicy(){return{enabled:null!=this.maxValue&&null==this.minValue}},target:"range",writer(c,e,h){e[h]=[this.minValue||0,c]}}}})],n.prototype,"maxValue",void 0);b.__decorate([q.property({json:{type:[Number],
read:{source:"range",reader(c,e){return e.range?.[0]}},write:{target:"range",writer(c,e,h){e[h]=[c,this.maxValue||0]}}}})],n.prototype,"minValue",void 0);b.__decorate([l.enumeration({range:"range"})],n.prototype,"type",void 0);return n=d=b.__decorate([a.subclass("esri.layers.support.RangeDomain")],n)})},"esri/layers/support/source/MapLayerSource":function(){define("exports ../../../chunks/tslib.es6 ../../../core/JSONSupport ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/RandomLCG ../../../core/has ../../../core/accessorSupport/decorators/enumeration ../../../core/accessorSupport/decorators/subclass".split(" "),
function(b,q,n,g,k,l,a,f,d){var c;b.MapLayerSource=c=class extends n.JSONSupport{constructor(e){super(e);this.type="map-layer"}clone(){const {mapLayerId:e,gdbVersion:h}=this;return new c({mapLayerId:e,gdbVersion:h})}};q.__decorate([f.enumeration({mapLayer:"map-layer"})],b.MapLayerSource.prototype,"type",void 0);q.__decorate([g.property({type:k.Integer,json:{write:!0}})],b.MapLayerSource.prototype,"mapLayerId",void 0);q.__decorate([g.property({type:String,json:{write:!0}})],b.MapLayerSource.prototype,
"gdbVersion",void 0);b.MapLayerSource=c=q.__decorate([d.subclass("esri.layers.support.source.MapLayerSource")],b.MapLayerSource);Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/source/QueryTableDataSource":function(){define("exports ../../../chunks/tslib.es6 ../../../geometry ../../../core/JSONSupport ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/enumeration ../../../core/accessorSupport/decorators/subclass ../../../geometry/SpatialReference ../../../geometry/support/typeUtils".split(" "),
function(b,q,n,g,k,l,a,f,d,c,e,h){var x;b.QueryTableDataSource=x=class extends g.JSONSupport{constructor(m){super(m);this.type="query-table"}clone(){const {workspaceId:m,query:p,oidFields:t,spatialReference:w,geometryType:r}=this,y={workspaceId:m,query:p,oidFields:t,spatialReference:w?.clone()??void 0,geometryType:r};return new x(y)}};q.__decorate([d.enumeration({queryTable:"query-table"})],b.QueryTableDataSource.prototype,"type",void 0);q.__decorate([k.property({type:String,json:{write:!0}})],b.QueryTableDataSource.prototype,
"workspaceId",void 0);q.__decorate([k.property({type:String,json:{write:!0}})],b.QueryTableDataSource.prototype,"query",void 0);q.__decorate([k.property({type:String,json:{write:!0}})],b.QueryTableDataSource.prototype,"oidFields",void 0);q.__decorate([k.property({type:e,json:{write:!0}})],b.QueryTableDataSource.prototype,"spatialReference",void 0);q.__decorate([d.enumeration(h.featureGeometryTypeKebabDictionary)],b.QueryTableDataSource.prototype,"geometryType",void 0);b.QueryTableDataSource=x=q.__decorate([c.subclass("esri.layers.support.source.QueryTableDataSource")],
b.QueryTableDataSource);Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/source/RasterDataSource":function(){define("exports ../../../chunks/tslib.es6 ../../../core/JSONSupport ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/enumeration ../../../core/accessorSupport/decorators/subclass".split(" "),function(b,q,n,g,k,l,a,f,d){var c;b.RasterDataSource=c=class extends n.JSONSupport{constructor(e){super(e);
this.type="raster"}clone(){const {workspaceId:e,dataSourceName:h}=this;return new c({workspaceId:e,dataSourceName:h})}};q.__decorate([f.enumeration({raster:"raster"})],b.RasterDataSource.prototype,"type",void 0);q.__decorate([g.property({type:String,json:{write:!0}})],b.RasterDataSource.prototype,"dataSourceName",void 0);q.__decorate([g.property({type:String,json:{write:!0}})],b.RasterDataSource.prototype,"workspaceId",void 0);b.RasterDataSource=c=q.__decorate([d.subclass("esri.layers.support.source.RasterDataSource")],
b.RasterDataSource);Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/source/TableDataSource":function(){define("exports ../../../chunks/tslib.es6 ../../../core/JSONSupport ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/enumeration ../../../core/accessorSupport/decorators/subclass".split(" "),function(b,q,n,g,k,l,a,f,d){var c;b.TableDataSource=c=class extends n.JSONSupport{constructor(e){super(e);
this.type="table"}clone(){const {workspaceId:e,gdbVersion:h,dataSourceName:x}=this;return new c({workspaceId:e,gdbVersion:h,dataSourceName:x})}};q.__decorate([f.enumeration({table:"table"})],b.TableDataSource.prototype,"type",void 0);q.__decorate([g.property({type:String,json:{write:!0}})],b.TableDataSource.prototype,"workspaceId",void 0);q.__decorate([g.property({type:String,json:{write:!0}})],b.TableDataSource.prototype,"gdbVersion",void 0);q.__decorate([g.property({type:String,json:{write:!0}})],
b.TableDataSource.prototype,"dataSourceName",void 0);b.TableDataSource=c=q.__decorate([d.subclass("esri.layers.support.source.TableDataSource")],b.TableDataSource);Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/rest/support/FullTextSearch":function(){define("../../chunks/tslib.es6 ../../core/Clonable ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/has ../../core/Logger ../../core/RandomLCG ../../core/accessorSupport/decorators/subclass".split(" "),
function(b,q,n,g,k,l,a,f){q=class extends q.ClonableMixin(n.JSONSupport){constructor(d){super(d);this.searchType=this.searchTerm=this.operator=this.onFields=null}};b.__decorate([g.property({type:[String],json:{write:{enabled:!0,overridePolicy(){return{enabled:null!=this.onFields&&0<this.onFields.length}}}}})],q.prototype,"onFields",void 0);b.__decorate([g.property({type:String,json:{write:!0}})],q.prototype,"operator",void 0);b.__decorate([g.property({type:String,json:{write:!0}})],q.prototype,"searchTerm",
void 0);b.__decorate([g.property({type:String,json:{write:!0}})],q.prototype,"searchType",void 0);return q=b.__decorate([f.subclass("esri.rest.support.FullTextSearch")],q)})},"esri/core/Clonable":function(){define("exports ../chunks/tslib.es6 ./Accessor ./has ./lang ./Logger ./maybe ./accessorSupport/PropertyOrigin ./accessorSupport/utils ./accessorSupport/decorators/subclass".split(" "),function(b,q,n,g,k,l,a,f,d,c){g=e=>{e=class extends e{clone(){var h=d.getProperties(this);a.assertIsSome(h,"unable to clone instance of non-accessor class");
var x=h.metadata;const m=h.store,p={};h=new Map;for(var t in x){var w=x[t];const r=m?.originOf(t),y=w.clonable;if(w.readOnly||!1===y||r!==f.OriginId.USER&&r!==f.OriginId.DEFAULTS&&r!==f.OriginId.WEB_MAP&&r!==f.OriginId.WEB_SCENE)continue;w=this[t];let z=null;z="function"===typeof y?y(w):"reference"===y?w:k.tryClone(w);if(null==w||null!=z)r===f.OriginId.DEFAULTS?h.set(t,z):p[t]=z}x=new (Object.getPrototypeOf(this).constructor)(p);if(h.size&&(t=d.getProperties(x)?.store))for(const [r,y]of h)t.set(r,
y,f.OriginId.DEFAULTS);return x}};return e=q.__decorate([c.subclass("esri.core.Clonable")],e)};b.Clonable=class extends g(n){};b.Clonable=q.__decorate([c.subclass("esri.core.Clonable")],b.Clonable);b.ClonableMixin=g;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/rest/support/QuantizationParameters":function(){define("../../chunks/tslib.es6 ../../geometry ../../core/jsonMap ../../core/JSONSupport ../../core/lang ../../core/accessorSupport/decorators/property ../../core/has ../../core/Logger ../../core/accessorSupport/decorators/subclass ../../geometry/Extent".split(" "),
function(b,q,n,g,k,l,a,f,d,c){var e;q=new n.JSONMap({upperLeft:"upper-left",lowerLeft:"lower-left"});g=e=class extends g.JSONSupport{constructor(h){super(h);this.extent=null;this.mode="view";this.originPosition="upper-left";this.tolerance=1}clone(){return new e(k.clone({extent:this.extent,mode:this.mode,originPosition:this.originPosition,tolerance:this.tolerance}))}};b.__decorate([l.property({type:c,json:{write:{overridePolicy(){return{enabled:"view"===this.mode}}}}})],g.prototype,"extent",void 0);
b.__decorate([l.property({type:["view","edit"],json:{write:!0}})],g.prototype,"mode",void 0);b.__decorate([l.property({type:String,json:{read:q.read,write:q.write}})],g.prototype,"originPosition",void 0);b.__decorate([l.property({type:Number,json:{write:{overridePolicy(){return{enabled:"view"===this.mode}}}}})],g.prototype,"tolerance",void 0);return g=e=b.__decorate([d.subclass("esri.rest.support.QuantizationParameters")],g)})},"esri/rest/support/spatialRelationships":function(){define(["exports",
"../../core/jsonMap"],function(b,q){q=new q.JSONMap({esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"envelope-intersects",esriSpatialRelIndexIntersects:"index-intersects",esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:"relation"});b.spatialRelKebabDict=q;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},
"esri/rest/support/StatisticDefinition":function(){define("../../chunks/tslib.es6 ../../core/jsonMap ../../core/JSONSupport ../../core/lang ../../core/accessorSupport/decorators/property ../../core/has ../../core/Logger ../../core/accessorSupport/decorators/subclass ../../core/accessorSupport/decorators/writer".split(" "),function(b,q,n,g,k,l,a,f,d){var c;q=new q.JSONMap({count:"count",sum:"sum",min:"min",max:"max",avg:"avg",stddev:"stddev",var:"var",exceedslimit:"exceedslimit",percentile_cont:"percentile-continuous",
percentile_disc:"percentile-discrete",EnvelopeAggregate:"envelope-aggregate",CentroidAggregate:"centroid-aggregate",ConvexHullAggregate:"convex-hull-aggregate"});n=c=class extends n.JSONSupport{constructor(e){super(e);this.maxVertexCount=this.maxRecordCount=this.maxPointCount=void 0;this.statisticParameters=this.statisticType=this.outStatisticFieldName=this.onStatisticField=null}writeStatisticParameters(e,h){if("percentile-continuous"===this.statisticType||"percentile-discrete"===this.statisticType)h.statisticParameters=
g.clone(e)}clone(){return new c({maxPointCount:this.maxPointCount,maxRecordCount:this.maxRecordCount,maxVertexCount:this.maxVertexCount,onStatisticField:this.onStatisticField,outStatisticFieldName:this.outStatisticFieldName,statisticType:this.statisticType,statisticParameters:g.clone(this.statisticParameters)})}};b.__decorate([k.property({type:Number,json:{write:!0}})],n.prototype,"maxPointCount",void 0);b.__decorate([k.property({type:Number,json:{write:!0}})],n.prototype,"maxRecordCount",void 0);
b.__decorate([k.property({type:Number,json:{write:!0}})],n.prototype,"maxVertexCount",void 0);b.__decorate([k.property({type:String,json:{write:!0}})],n.prototype,"onStatisticField",void 0);b.__decorate([k.property({type:String,json:{write:!0}})],n.prototype,"outStatisticFieldName",void 0);b.__decorate([k.property({type:String,json:{read:{source:"statisticType",reader:q.read},write:{target:"statisticType",writer:q.write}}})],n.prototype,"statisticType",void 0);b.__decorate([k.property({type:Object})],
n.prototype,"statisticParameters",void 0);b.__decorate([d.writer("statisticParameters")],n.prototype,"writeStatisticParameters",null);return n=c=b.__decorate([f.subclass("esri.rest.support.StatisticDefinition")],n)})},"esri/time/TimeExtent":function(){define("../chunks/tslib.es6 ../core/JSONSupport ../core/timeUtils ../core/accessorSupport/decorators/property ../core/has ../core/Logger ../core/RandomLCG ../core/accessorSupport/decorators/reader ../core/accessorSupport/decorators/subclass ../core/accessorSupport/decorators/writer ./timeZoneUtils".split(" "),
function(b,q,n,g,k,l,a,f,d,c,e){var h;q=h=class extends q.JSONSupport{static get allTime(){return x}static get empty(){return m}static fromArray(p){return new h({start:null!=p[0]?new Date(p[0]):p[0],end:null!=p[1]?new Date(p[1]):p[1]})}constructor(p){super(p);this.start=this.end=null}readEnd(p,t){return null!=t.end?new Date(t.end):null}writeEnd(p,t){t.end=p?.getTime()??null}get isAllTime(){return this.equals(h.allTime)}get isEmpty(){return this.equals(h.empty)}readStart(p,t){return null!=t.start?
new Date(t.start):null}writeStart(p,t){t.start=p?.getTime()??null}clone(){return new h({end:this.end,start:this.start})}equals(p){if(!p)return!1;const t=this.start?.getTime()??this.start,w=this.end?.getTime()??this.end,r=p.start?.getTime()??p.start;p=p.end?.getTime()??p.end;return t===r&&w===p}expandTo(p,t=e.system){if(this.isEmpty||this.isAllTime)return this.clone();let w=this.start;w&&=n.truncateDate(w,p,t);let r=this.end;if(r){const y=n.truncateDate(r,p,t);r=r.getTime()===y.getTime()?y:n.offsetDate(y,
1,p,t)}return new h({start:w,end:r})}intersection(p){if(!p)return this.clone();if(this.isEmpty||p.isEmpty)return h.empty;if(this.isAllTime)return p.clone();if(p.isAllTime)return this.clone();const t=this.start?.getTime()??-Infinity,w=this.end?.getTime()??Infinity,r=p.start?.getTime()??-Infinity;p=p.end?.getTime()??Infinity;let y,z;r>=t&&r<=w?y=r:t>=r&&t<=p&&(y=t);w>=r&&w<=p?z=w:p>=t&&p<=w&&(z=p);return null==y||null==z||isNaN(y)||isNaN(z)?h.empty:new h({start:-Infinity===y?null:new Date(y),end:Infinity===
z?null:new Date(z)})}offset(p,t,w=e.system){if(this.isEmpty||this.isAllTime)return this.clone();const r=new h,{start:y,end:z}=this;null!=y&&(r.start=n.offsetDate(y,p,t,w));null!=z&&(r.end=n.offsetDate(z,p,t,w));return r}toArray(){return this.isEmpty?[void 0,void 0]:[this.start?.getTime()??null,this.end?.getTime()??null]}union(p){if(!p||p.isEmpty)return this.clone();if(this.isEmpty)return p.clone();if(this.isAllTime||p.isAllTime)return x.clone();const t=null!=this.start&&null!=p.start?new Date(Math.min(this.start.getTime(),
p.start.getTime())):null;p=null!=this.end&&null!=p.end?new Date(Math.max(this.end.getTime(),p.end.getTime())):null;return new h({start:t,end:p})}};b.__decorate([g.property({type:Date,json:{write:{allowNull:!0}}})],q.prototype,"end",void 0);b.__decorate([f.reader("end")],q.prototype,"readEnd",null);b.__decorate([c.writer("end")],q.prototype,"writeEnd",null);b.__decorate([g.property({readOnly:!0,json:{read:!1}})],q.prototype,"isAllTime",null);b.__decorate([g.property({readOnly:!0,json:{read:!1}})],
q.prototype,"isEmpty",null);b.__decorate([g.property({type:Date,json:{write:{allowNull:!0}}})],q.prototype,"start",void 0);b.__decorate([f.reader("start")],q.prototype,"readStart",null);b.__decorate([c.writer("start")],q.prototype,"writeStart",null);b=q=h=b.__decorate([d.subclass("esri.time.TimeExtent")],q);const x=new q,m=new q({start:void 0,end:void 0});return b})},"esri/views/2d/layers/features/FeatureStoreQueryAdapter":function(){define(["exports"],function(b){class q{getObjectId(n){return n.getObjectId()}getAttributes(n){return n.readAttributes()}getAttribute(n,
g){return n.readAttribute(g)}getAttributeAsTimestamp(n,g){return n.readAttributeAsTimestamp(g)}cloneWithGeometry(n,g){return n}getGeometry(n){return n.readGeometryWorldSpace()}getCentroid(n,g){return n.readCentroidForDisplay()}}q.Shared=new q;b.FeatureStoreQueryAdapter=q;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/support/FeatureMetadata":function(){define(["exports","../../../../../geometry/SpatialReference","../../../../../layers/support/FieldsIndex"],
function(b,q,n){class g{static minimal(l,a,f=[]){return new g({geometryType:l,fieldsIndex:(new n(f)).toJSON(),objectIdField:a,subtypes:null,subtypeField:null,types:null,globalIdField:null,spatialReference:null,timeInfo:null,timeReferenceUnknownClient:null,typeIdField:null})}static createFeature(l){return new g(l)}constructor(l){this._options=l;this._fieldsIndex=n.fromJSON(l.fieldsIndex);l.spatialReference&&(this._spatialReference=q.fromJSON(l.spatialReference));this._arcadeSchema={fields:this.fieldsIndex.fields,
fieldsIndex:this.fieldsIndex,geometryType:this.geometryType,objectIdField:this.objectIdField,globalIdField:this._options.globalIdField,spatialReference:this._spatialReference,timeInfo:this._options.timeInfo,typeIdField:this._options.typeIdField??void 0,types:this._options.types??void 0,subtypeField:this._options.subtypeField,subtypes:this._options.subtypes??void 0}}get fieldsIndex(){return this._fieldsIndex}get geometryType(){return"esriGeometryMultiPatch"===this._options.geometryType?"esriGeometryPolygon":
this._options.geometryType}get serviceGeometryType(){return this._options.geometryType}get subtypeField(){return this._options.subtypeField}get timeInfo(){return this._options.timeInfo}get objectIdField(){return this._options.objectIdField}get globalIdField(){return this._options.globalIdField}get arcadeSchema(){return this._arcadeSchema}get spatialReference(){return this._spatialReference}get timeReferenceUnknownClient(){return this._options.timeReferenceUnknownClient}}class k extends g{static createGraphics(l){return new k({fieldsIndex:(new n).toJSON(),
objectIdField:"uid",geometryType:null,spatialReference:l,globalIdField:null,subtypeField:null,subtypes:null,timeInfo:null,typeIdField:null,types:null,timeReferenceUnknownClient:null})}}b.FeatureMetadata=g;b.GraphicsMetadata=k;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/processor/ClusterStrategy":function(){define("exports ../../../../../layers/graphics/featureConversionUtils ../../../../../layers/graphics/OptimizedFeature ../../../../../layers/graphics/OptimizedGeometry ../../../../../layers/support/FieldsIndex ../../../engine/webgl/definitions ../aggregation/ComputedAggregateField ../aggregation/GridCell ../aggregation/GridSpatialIndex ./AAggregateStrategy ./AProcessorStrategy ./support/WithDisplayId ../sources/FeatureSourceMessage ../sources/strategies/chunks/OverrideChunk ../support/ComputedAttributeStorage ../support/FeatureFilter ../support/FeatureMetadata ../support/FeatureSetReaderJSON ../../../tiling/TileKey".split(" "),
function(b,q,n,g,k,l,a,f,d,c,e,h,x,m,p,t,w,r,y){class z extends e.ASendState{constructor(A){super(A);this.done=this.didSend=!1}}class u{constructor(A,B,F,H,J){this._level=A;this._scale=B;this._indexOptions=F;this._clusterRadius=H;this._store=J;this._cells=new Map;this._handledChunks=new Set;this._statistics=new Map;this._clusters=new Map}destroy(){this._clearClusters()}_clearClusters(){for(const A of this._clusters.values())this._store.releaseDisplayIdForObjectId(A.inner.id);this._clusters.clear()}*aggregatesWorldSpace(){for(const B of this._clusters.values()){var A=
B.inner.getCentroid(null);A=new n.OptimizedFeature(A,B.inner.getAttributes(),null);A.objectId=B.inner.id;A.displayId=B.displayId;yield A}}clusters(){return this._clusters.values()}updateChunks(A,B){let F=!1;for(var H of A)A=H.queryInfo,"tileId"in A&&(new y(A.tileId)).level!==this._level||this._handledChunks.has(H.normalizedChunkId)||(this._handledChunks.add(H.normalizedChunkId),F=!0,H.getAggregateIndex({...this._indexOptions,scale:this._scale}).put(this._cells));H={xMin:Infinity,yMin:Infinity,xMax:-Infinity,
yMax:-Infinity};A=d.pixelsPerMapUnit(this._indexOptions.spatialReference,this._scale);const J=this._indexOptions.cellSize;for(const {subscription:E}of B){B=E.tile.bounds;const K=Math.floor(B[1]*A/J),C=Math.ceil(B[2]*A/J),D=Math.ceil(B[3]*A/J);H.xMin=Math.min(H.xMin,Math.floor(B[0]*A/J));H.yMin=Math.min(H.yMin,K);H.xMax=Math.max(H.xMax,C);H.yMax=Math.max(H.yMax,D)}if(null==this._lastCellBounds||H.xMin!==this._lastCellBounds.xMin||H.yMin!==this._lastCellBounds.yMin||H.yMin!==this._lastCellBounds.yMin||
H.yMax!==this._lastCellBounds.yMax)F=!0,this._lastCellBounds=H;F&&this._clusterCells(H);return F}async updateStatistics(A){var B=!1;for(const F of this._clusters.values())1<F.inner.count&&(B=this._updateAggregateStatistics(this._statistics,F.inner)||B);B&&(B=Array.from(this._statistics.entries()).map(([F,H])=>({fieldName:F,minValue:H.minValue,maxValue:H.maxValue})),await A.container.updateStatistics(this._level,B))}createAggregateFeatures(A,B){A=A.subscription;const F=[],H=A.tile.transform;for(const C of this._clusters.values()){var J=
C.inner.getCentroidX(H);const D=C.inner.getCentroidY(H);var E=A.tile.lod,K=E.wrap?E.worldSize[0]:null;E=1===C.inner.count?C.inner.firstObjectId:C.inner.id;const G=C.displayId;null!=K&&(1===K?(K=new g([],[J,D]),K=new n.OptimizedFeature(K,C.inner.getAttributes(),null),K.geometry.coords[0]-=l.tileSize,K.objectId=E,K.displayId=G,F.push(K),K=new g([],[J,D]),K=new n.OptimizedFeature(K,C.inner.getAttributes(),null),K.geometry.coords[0]+=l.tileSize,K.objectId=E,K.displayId=G,F.push(K)):J>l.tileSize+l.tileSize/
2?J-=K*l.tileSize:J<-(l.tileSize/2)&&(J+=K*l.tileSize));J<l.tileSize+128&&-128<=J&&D<l.tileSize+128&&-128<=D&&(J=new g([],[J,D]),J=new n.OptimizedFeature(J,C.inner.getAttributes(),null),J.objectId=E,J.displayId=G,F.push(J))}return r.FeatureSetReaderJSON.fromOptimizedFeatures(F,B,A.tile.transform)}_clusterCells(A){var B=Array.from(this._cells.values());B=B.sort((K,C)=>C.count-K.count);const F=[];for(var H of this._clusters.values())F.push(H.inner.id);this._clusters.clear();H=this._clusterRadius*(1/
d.pixelsPerMapUnit(this._indexOptions.spatialReference,this._scale));const J=1+this._clusterRadius/this._indexOptions.cellSize,E=new Set;for(const K of B){if(E.has(K.id))continue;if(K.gridX<A.xMin||K.gridX>A.xMax||K.gridY<A.yMin||K.gridY>A.yMax)continue;B=this._store.createDisplayIdForObjectId(K.id);B=new h.WithDisplayId(K.clone(),B);E.add(K.id);this._clusters.set(K.id,B);const C=K.centroidXWorld,D=K.centroidYWorld;for(let G=K.gridY-J;G<=K.gridY+J;G++)for(let N=K.gridX-J;N<=K.gridX+J;N++){if(G===
K.gridY&&N===K.gridX)continue;const Y=this._cells.get(f.GridCell.createId(N,G));if(!Y||E.has(Y.id))continue;const ca=Math.abs(Y.centroidYWorld-D);Math.abs(Y.centroidXWorld-C)<H&&ca<H&&(B.inner.merge(Y),E.add(Y.id))}}for(const K of F)this._store.releaseDisplayIdForObjectId(K)}_updateAggregateStatistics(A,B){let F=!1;for(const E of B.statistics.values())if("esriFieldTypeString"!==E.field.type){var H=E.value,J=E.field;if(B=A.get(J.name)){const {minValue:K,maxValue:C}=B;J=Math.min(B.minValue,H);H=Math.max(B.maxValue,
H);if(K!==J||C!==H)B.minValue=J,B.maxValue=H,F=!0}else A.set(J.name,{minValue:H,maxValue:H}),F=!0}return F}}class v extends c.AAggregateStrategy{static async create(A,B,F,H,J,E){const K=new p.ComputedAttributeStorage({spatialReference:F}),C=await Promise.all(B.fields.map(async G=>a.ComputedAggregateField.create(K,G))),D=B.featureFilter?await t.create({geometryType:H.metadata.geometryType,hasM:!1,hasZ:!1,timeInfo:H.metadata.timeInfo,fieldsIndex:H.metadata.fieldsIndex,spatialReference:F,filterJSON:B.featureFilter}):
null;return new v(A,B.clusterRadius,{type:"grid",fields:C,spatialReference:F,featureFilter:D,cellSize:B.clusterRadius/4,timeZone:E},B.fields,H,J)}constructor(A,B,F,H,J,E){super(J,E,F.spatialReference,F.fields);this._connection=A;this._clusterRadius=B;this._indexOptions=F;this._cellsPerScale=new Map;this._metadata=w.FeatureMetadata.createFeature({geometryType:"esriGeometryPoint",objectIdField:"aggregateId",fieldsIndex:(new k([...H,...this._source.metadata.fieldsIndex.fields,{name:"aggregateId",alias:"aggregateId",
type:"esriFieldTypeOID"}])).toJSON(),globalIdField:null,spatialReference:J.metadata.spatialReference,subtypeField:null,subtypes:null,timeInfo:null,timeReferenceUnknownClient:null,typeIdField:null,types:null})}get enablePixelBuffering(){return!1}invalidate(){super.invalidate();for(const A of this._cellsPerScale.values())A.destroy();this._cellsPerScale.clear()}onSubscribe(A){super.onSubscribe(A);this._requiredLevel=A.tile.level;this._requiredScale=A.tile.scale}createState(A){return new z(A)}async *applyLocalEdit(A){for(const B of this._cellsPerScale.values())B.destroy();
this._cellsPerScale.clear();for(const B of this._sendStates.values())B.done=!1}displayMap(A,B,F){A=new Map(A.map(E=>[B(E),E]));const H=[];var J=this._getClusterState(this._requiredLevel,this._requiredScale);for(const E of J.clusters())J=A.get(E.inner.id),null!=J?(J=F(E.displayId,J,E.inner.id),H.push(J),A.delete(E.inner.id)):1===E.inner.count&&(J=A.get(E.inner.firstObjectId),null!=J&&(J=F(E.displayId,J,E.inner.firstObjectId),H.push(J),A.delete(E.inner.firstObjectId)));return H}getDisplayFeatures(A){A=
new Set(A);const B=new Set,F=[],H=[];var J=this._getClusterState(this._requiredLevel,this._requiredScale);for(const E of J.aggregatesWorldSpace())A.has(E.displayId)&&!B.has(E.displayId)&&(J=q.convertToFeature(E,this._metadata.geometryType,!1,!1),B.add(E.displayId),1===J.attributes.cluster_count?F.push({...J,displayId:E.displayId}):H.push({...J,displayId:E.displayId}));return{features:F,aggregates:H}}getFeatureObjectIdsForAggregate(A){const B=this._getClusterState(this._requiredLevel,this._requiredScale);
for(const F of B.clusters())if(F.inner.id===A)return Array.from(F.inner.containedObjectIds);return[]}async *updateChunks(){var A=this._source.chunks();if(A.length){for(var B of A)m.isLocalEditChunk(B)&&B.lastLocalEditDropped!==this._lastHandledLocalEdit&&(this.invalidate(),this._lastHandledLocalEdit=B.lastLocalEditDropped);B=this._getClusterState(this._requiredLevel,this._requiredScale);var F=Array.from(this._sendStates.values()).filter(J=>J.subscription.tile.level===this._requiredLevel);if(B.updateChunks(A,
F)||!this._source.updateTracking.updating)for(const J of F)J.subscription.tile.level===this._requiredLevel&&(J.didSend=!1,J.done=!1);A=Array.from(this._sendStates.values()).filter(J=>J.done).map(J=>J.subscription.tile.key);var H=new Set(A);for(const J of this._sendStates.values()){if(this._source.updateTracking.updating){if(A.some(E=>E.containsChild(J.subscription.tile.key)))continue;if(J.subscription.tile.key.getChildKeys().every(E=>H.has(E)))continue}J.didSend||J.subscription.tile.level!==this._requiredLevel||
(J.didSend=!0,yield*this._update(J,B,this._source))}await B.updateStatistics(this._connection)}}forEachAggregateWorldSpace(A){if(null!=this._requiredLevel&&null!=this._requiredScale){var B=this._getClusterState(this._requiredLevel,this._requiredScale);for(const F of B.aggregatesWorldSpace())A(F)}}_getClusterState(A,B){if(null==A||null==B)throw Error("InternalError: Level and scale must be defined");let F=this._cellsPerScale.get(B);F||(F=new u(A,B,this._indexOptions,this._clusterRadius,this._attributeStore),
this._cellsPerScale.set(B,F));return F}async *_update(A,B,F){if(!A.done){B=B.createAggregateFeatures(A,this._metadata);this.events.emit("changed");A.done=!F.updateTracking.updating;F=B.getCursor();for(var H=A.subscription.tile.createArcadeEvaluationOptions(this._indexOptions.timeZone);F.next();)this._attributeStore.setAttributeData(F.getDisplayId(),F,H);yield new x.FeatureTileAppendMessage(A.subscription,B,!0,A.done,{})}}}b.ClusterState=z;b.ClusterStrategy=v;Object.defineProperty(b,Symbol.toStringTag,
{value:"Module"})})},"esri/views/2d/layers/features/processor/support/WithDisplayId":function(){define(["exports"],function(b){class q{constructor(n,g){this.inner=n;this.displayId=g}}b.WithDisplayId=q;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/processor/FeatureUpdateStrategy":function(){define(["exports","../../../../../core/has","./AProcessorStrategy","../sources/FeatureSourceMessage","../sources/strategies/chunks/OverrideChunk"],function(b,q,n,
g,k){class l extends n.ASendState{}class a extends n.AProcessorStrategy{constructor(f,d,c){super(f,d);this._timeZone=c;this.handledChunks=new Set;this.handledChunksForIdCreation=new Set;this.handledChunksForAttributeData=new Set;this._streamLayerDeferredObjectIdsToRemove=[]}destroy(){super.destroy();for(const f of this._source.chunks())this._cleanupChunkIds(f)}invalidateAttributeData(){this.handledChunksForAttributeData.clear()}onSubscribe(f){super.onSubscribe(f);this._evalOptions=f.tile.createArcadeEvaluationOptions(this._timeZone)}createState(f){return new l(f)}get aggregateQueryEngine(){return null}displayMap(f,
d,c){f=new Map(f.map(x=>[d(x),x]));const e=[];for(const x of this._source.chunks()){const m=x.reader.getCursor();for(;m.next();){const p=m.getObjectId();var h=m.getDisplayId();const t=f.get(p);null!=t&&(h=c(h,t,p),e.push(h),f.delete(p))}}return e}getDisplayFeatures(f){f=new Set(f);const d=new Set,c=[];for(const e of this._source.chunks()){const h=e.reader.getCursor();for(;h.next();){const x=h.getObjectId(),m=h.getDisplayId();f.has(m)&&!d.has(x)&&(c.push({...h.readLegacyFeatureWorldSpace(),displayId:m}),
d.add(x))}}return{features:c,aggregates:[]}}async *applyLocalEdit(f){for(var d=[],c=f.reader.getCursor();c.next();){var e=c.getObjectId();e=this._attributeStore.createDisplayIdForObjectId(e);c.setDisplayId(e);this._attributeStore.setAttributeData(e,c,this._evalOptions);d.push(e)}c=[];for(var h of f.removed)e=this._attributeStore.getDisplayIdForObjectId(h),null!=e&&c.push(e);q("esri-2d-update-debug")&&console.debug("FeatureUpdateStrategy.applyLocalEdit",{message:f,modifiedDisplayIds:d,removedDisplayIds:c});
h=new k.OverrideChunk(this._source.metadata,"localEdit");h.applyOverrides(f);this.handledChunks.add(h.chunkId);this.handledChunksForAttributeData.add(h.chunkId);this.handledChunksForIdCreation.add(h.chunkId);for(const x of this._sendStates.values())x.handledChunks.add(h.chunkId),yield new g.FeatureTileUpdateMessage(x.subscription,null,d,!1,h.queryInfo);for(const x of this._sendStates.values())d=h.getTileReader(x.subscription.tile),yield new g.FeatureTileUpdateMessage(x.subscription,d,c,!1,h.queryInfo);
for(const x of f.removed)this._attributeStore.releaseDisplayIdForObjectId(x)}async *updateChunks(){if(this._source.chunks().length){await this._updateAttributeData();for(const f of this._sendStates.values())yield*this._update(f)}}removeChunks(f){for(const d of f)this.handledChunks.delete(d.chunkId),this.handledChunksForAttributeData.delete(d.chunkId),this._cleanupChunkIds(d)}afterUpdateChunks(){for(const f of this._streamLayerDeferredObjectIdsToRemove)this._attributeStore.releaseDisplayIdForObjectId(f);
this._streamLayerDeferredObjectIdsToRemove=[]}_cleanupChunkIds(f){if(this.handledChunksForIdCreation.has(f.chunkId)){const d=f.reader.getCursor();for(;d.next();){const c=d.getObjectId();this._source.isStream?this._streamLayerDeferredObjectIdsToRemove.push(c):this._attributeStore.releaseDisplayIdForObjectId(c)}this.handledChunksForIdCreation.delete(f.chunkId)}}async _updateAttributeData(){for(var f of this._source.chunks()){const {chunkId:c,reader:e}=f;if(!this.handledChunksForIdCreation.has(c)){this.handledChunksForIdCreation.add(c);
for(var d=e.getCursor();d.next();){const h=this._attributeStore.createDisplayIdForObjectId(d.getObjectId());d.setDisplayId(h)}}}for(const c of this._source.chunks())if(!this.handledChunksForAttributeData.has(c.chunkId))for(this.handledChunksForAttributeData.add(c.chunkId),f=c.reader.getCursor();f.next();)d=f.getDisplayId(),this._attributeStore.setAttributeData(d,f,this._evalOptions)}*_update(f){const {subscription:d,handledChunks:c}=f;for(const h of this._source.chunks()){var {chunkId:e}=h;c.has(e)||
(c.add(e),(e=h.getTileReader(d.tile))&&(yield new g.FeatureTileAppendMessage(f.subscription,e,!1,h.end,h.queryInfo)))}}}b.DefaultSendState=l;b.FeatureUpdateStrategy=a;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/support/AttributeStore":function(){define("exports ../../../../../core/Error ../../../../../core/has ../../../../../core/Logger ../../../../../core/accessorSupport/diffUtils ../../../engine/webgl/definitions ../../../engine/webgl/DisplayId ../../../engine/webgl/Utils ../../../engine/webgl/shaderGraph/techniques/shaders/constants ../../../engine/webgl/util/debug ./DisplayIdGenerator ./FeatureFilter ../../../../webgl/enums".split(" "),
function(b,q,n,g,k,l,a,f,d,c,e,h,x){function m(z,u){if(!z||!u)return z;switch(u){case "radius":case "distance":return 2*z;case "area":return Math.sqrt(z)}return z}const p=()=>g.getLogger("esri.views.layers.2d.features.support.AttributeStore"),t=c.createDebugLogger(c.DEBUG_ATTR_UPDATES,p());var w=n("esri-shared-array-buffer");n("esri-atomics");class r{constructor(z,u,v){this.size=0;this.texelSize=4;this.dirtyEnd=this.dirtyStart=0;const {pixelType:A,layout:B,textureOnly:F}=u;this.textureOnly=F||!1;
this.pixelType=A;this.layout=B;this._resetRange();this.size=z;this.isLocal=v;F||(this.data=this._initData(A,z))}get buffer(){return this.data?.buffer}unsetComponentAllTexels(z,u){const v=this.data;for(let A=0;A<this.size*this.size;A++)v[A*this.texelSize+z]&=~u;this.dirtyStart=0;this.dirtyEnd=this.size*this.size-1}setComponentAllTexels(z,u){const v=this.data;for(let A=0;A<this.size*this.size;A++)v[A*this.texelSize+z]|=255&u;this.dirtyStart=0;this.dirtyEnd=this.size*this.size-1}setComponent(z,u,v){const A=
this.data;for(const B of v)A[B*this.texelSize+z]|=u,this.dirtyStart=Math.min(this.dirtyStart,B),this.dirtyEnd=Math.max(this.dirtyEnd,B)}setComponentTexel(z,u,v){this.data[v*this.texelSize+z]|=u;this.dirtyStart=Math.min(this.dirtyStart,v);this.dirtyEnd=Math.max(this.dirtyEnd,v)}unsetComponentTexel(z,u,v){this.data[v*this.texelSize+z]&=~u;this.dirtyStart=Math.min(this.dirtyStart,v);this.dirtyEnd=Math.max(this.dirtyEnd,v)}getData(z,u){z=a.getDisplayIdTexel(z);return this.data[z*this.texelSize+u]}setData(z,
u,v){z=a.getDisplayIdTexel(z);0===(this.layout&1<<u)?p().error("mapview-attributes-store","Tried to set a value for a texel's readonly component"):null!=this.data&&(this.data[z*this.texelSize+u]=v,this.dirtyStart=Math.min(this.dirtyStart,z),this.dirtyEnd=Math.max(this.dirtyEnd,z))}expand(z){this.size=z;this.textureOnly||(z=this._initData(this.pixelType,z),z.set(this.data),this.data=z)}toMessage(){const z=this.dirtyStart,u=this.dirtyEnd;var v=this.texelSize;if(z>u)return null;this._resetRange();const A=
this.pixelType,B=this.layout,F=this.data;v=!this.isLocal&&F.slice(z*v,(u+1)*v)||null;return{start:z,end:u,data:v,pixelType:A,layout:B}}_initData(z,u){var v=ArrayBuffer;z=f.getPixelArrayCtor(z);u=new z(new v(u*u*4*z.BYTES_PER_ELEMENT));for(v=0;v<u.length;v+=4)u[v+1]=255;return u}_resetRange(){this.dirtyStart=2147483647;this.dirtyEnd=0}}class y{constructor(z){this._client=z;this._filters=[];this._blocks=[];this._attributeComputeInfo=null;this._abortController=new AbortController;this._size=l.attributeStoreInitialSize;
this._idsToHighlight=new Map;this._initialized=this._referencesGeometry=this._referencesScale=!1;this.version=0;this._idGenerator=new e.DisplayIdGenerator;this._epoch=1}destroy(){this._abortController.abort()}_initialize(){if(null==this._blockDescriptors){var z=x.PixelType.FLOAT;t(`Creating AttributeStore ${w?"with":"without"} shared memory`);this._blockDescriptors=[{pixelType:x.PixelType.UNSIGNED_BYTE,layout:1},{pixelType:x.PixelType.UNSIGNED_BYTE,layout:15,textureOnly:!0},{pixelType:x.PixelType.UNSIGNED_BYTE,
layout:15,textureOnly:!0},{pixelType:z,layout:15},{pixelType:z,layout:15},{pixelType:z,layout:15},{pixelType:z,layout:15},{pixelType:x.PixelType.FLOAT,layout:15}];this._blocks=this._blockDescriptors.map(()=>null)}}get referencesScale(){return this._referencesScale}get referencesGeometry(){return this._referencesGeometry}get hasHighlight(){return 0<this._idsToHighlight.size}createDisplayIdForObjectId(z){return this._idGenerator.createIdForObjectId(z)}releaseDisplayIdForObjectId(z){return this._idGenerator.releaseIdForObjectId(z)}getDisplayIdForObjectId(z){return this._idGenerator.getDisplayIdForObjectId(z)}incrementDisplayIdGeneration(){this._idGenerator.incrementGeneration()}releaseAllIds(){this._idGenerator.releaseAll()}async update(z,
u,v,A,B=0){const F=k.diff(this._schema,z);this.version=B;if(F&&(n("esri-2d-update-debug")&&console.debug(`Version[${B}] AttributeStore.update`,{changed:F}),this._schema=z,this._attributeComputeInfo=null,this._initialize(),null!=z))if(v&&(this._filters=await Promise.all(z.filters.map(H=>H?h.create({geometryType:v.geometryType,hasM:!1,hasZ:!1,timeInfo:v.timeInfo,fieldsIndex:v.fieldsIndex,spatialReference:A??v.spatialReference,filterJSON:H}):null))),"subtype"===z.type){this._attributeComputeInfo={isSubtype:!0,
subtypeField:z.subtypeField,map:new Map};this._referencesGeometry=this._referencesScale=!1;for(const H in z.bindings)await Promise.all(z.bindings[H].map(async J=>{J=await this._bind(u,J,parseInt(H,10));this._referencesGeometry=this._referencesGeometry||(J?.referencesGeometry()??!1);this._referencesScale=this._referencesScale||(J?.referencesScale()??!1)}))}else this._attributeComputeInfo={isSubtype:!1,map:new Map},await Promise.all(z.bindings.map(async H=>{H=await this._bind(u,H);this._referencesGeometry=
this._referencesGeometry||(H?.referencesGeometry()??!1);this._referencesScale=this._referencesScale||(H?.referencesScale()??!1)}))}setHighlight(z,u){const v=this._getBlock(0);v.unsetComponentAllTexels(0,(1<<l.maxHighlightReasons)-1);for(const {displayId:A,highlightFlags:B}of z){if(null==A)continue;const F=a.getDisplayIdTexel(A);v.setComponent(0,B,[F])}this._idsToHighlight.clear();for(const {objectId:A,highlightFlags:B}of z)this._idsToHighlight.set(A,B);for(const {objectId:A,highlightFlags:B}of u)this._idsToHighlight.set(A,
B)}setData(z,u,v,A){const B=a.getDisplayIdTexel(z);this._ensureSizeForTexel(B);this._getBlock(u).setData(z,v,A)}getData(z,u,v){return this._getBlock(u).getData(z,v)}getHighlightFlags(z){return this._idsToHighlight.get(z)||0}unsetAttributeData(z){z=a.getDisplayIdTexel(z);this._getBlock(0).setData(z,0,0)}setAttributeData(z,u,v){const A=a.getDisplayIdTexel(z);this._ensureSizeForTexel(A);this._getBlock(0).setData(A,0,this.getFilterFlags(u));z=this._attributeComputeInfo;let B=null;z&&(B=z.isSubtype?z.map.get(u.readAttribute(z.subtypeField)):
z.map,B?.size&&B.forEach((F,H)=>{const J=1*H%4;H=this._getBlock(Math.floor(1*H/4)+l.AttributeDataType.VV);let E=F.field?.read(u,v);F.valueRepresentation&&(E=m(E,F.valueRepresentation));if(null===E||isNaN(E)||Infinity===E||-Infinity===E)E=d.nanMagicNumber;H.setData(A,J,E)}))}get epoch(){return this._epoch}sendUpdates(){const z=this._blocks.map(v=>null!=v?v.toMessage():null),u=this._getInitArgs();n("esri-2d-log-updating")&&console.log("AttributeStore: _doSendUpdate.start");this._client.update({initArgs:u,
blockData:z,version:this.version,sendUpdateEpoch:this._epoch});this._epoch+=1;n("esri-2d-log-updating")&&console.log("AttributeStore: _doSendUpdate.end")}_ensureSizeForTexel(z){for(;z>=this._size*this._size&&!this._expand(););}async _bind(z,u,v){z=await z.createComputedField(u);const {valueRepresentation:A}=u,B=this._attributeComputeInfo;if(B.isSubtype){const F=B.map.get(v)??new Map;F.set(u.binding,{field:z,valueRepresentation:A});B.map.set(v,F)}else B.map.set(u.binding,{field:z,valueRepresentation:A});
return z}_getInitArgs(){if(this._initialized)return null;this._initialized=!0;this._getBlock(l.AttributeDataType.Animation);this._getBlock(l.AttributeDataType.GPGPU);this._getBlock(l.AttributeDataType.LocalTimeOrigin);return{blockSize:this._size,blockDescriptors:this._blocks.map(z=>null!=z?{textureOnly:z.textureOnly,buffer:z.buffer,pixelType:z.pixelType}:null)}}_getBlock(z){var u=this._blocks[z];if(null!=u)return u;t(`Initializing AttributeBlock at index ${z}`);u=new r(this._size,this._blockDescriptors[z],
this._client.isLocal);this._blocks[z]=u;this._initialized=!1;return u}_expand(){if(this._size<this._schema.capabilities.maxTextureSize){const z=this._size<<=1;t("Expanding block size to",z,this._blocks);for(const u of this._blocks)u?.expand(z);this._initialized=!1;this._size=z;return 0}p().error(new q("mapview-limitations","Maximum number of onscreen features exceeded."));return-1}isVisible(z){return!!(this._getBlock(0).getData(z,0)&1<<l.maxHighlightReasons)}getFilterFlags(z){let u=0;for(var v=0;v<
this._filters.length;v++){var A=this._filters[v];A=!(1<<v)||null==A||A.check(z);u|=(A?1:0)<<v}v=0;this._idsToHighlight.size&&(z=z.getObjectId(),v=this.getHighlightFlags(z));return u<<l.maxHighlightReasons|v}}b.AttributeStore=y;b.getVisualVariableSizeValueRepresentationRatio=m;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/util/debug":function(){define(["exports"],function(b){b.DEBUG_ATTR_UPDATES=!1;b.createDebugLogger=(q,n)=>q&&((...g)=>n.warn("DEBUG:",
...g))||(()=>null);Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/support/DisplayIdGenerator":function(){define(["exports","../../../engine/webgl/DisplayId"],function(b,q){class n{constructor(k){this.data=k;this._referenceCount=0}increment(){this._referenceCount+=1}decrement(){--this._referenceCount}empty(){return 0===this._referenceCount}}class g{constructor(){this._freeIdsGenerationA=[];this._freeIdsGenerationB=[];this._idCounter=1;this._freeIds=this._freeIdsGenerationA;
this._objectIdToDisplayId=new Map}createIdForObjectId(k){let l=this._objectIdToDisplayId.get(k);l?l.increment():(l=new n(q.createDisplayId(this._getFreeId(),!1)),l.increment(),this._objectIdToDisplayId.set(k,l));return l.data}releaseIdForObjectId(k){const l=this._objectIdToDisplayId.get(k);l&&(l.decrement(),l.empty()&&(this._objectIdToDisplayId.delete(k),this._freeIds.push(l.data)))}getDisplayIdForObjectId(k){k=this._objectIdToDisplayId.get(k);return null!=k?k.data:null}releaseAll(){for(const k of this._objectIdToDisplayId.values())this._freeIds.push(k.data);
this._objectIdToDisplayId.clear()}incrementGeneration(){this._freeIds=this._freeIds===this._freeIdsGenerationA?this._freeIdsGenerationB:this._freeIdsGenerationA}_getFreeId(){return this._freeIds.length?this._freeIds.pop():this._idCounter++}}b.DisplayIdGenerator=g;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/sources/FeatureSource":function(){define("exports ../../../../../request ../../../../../core/has ../../../../../core/promiseUtils ../../../../../core/accessorSupport/diffUtils ../../../../../layers/graphics/OptimizedFeature ../../../../../layers/graphics/data/QueryEngine ../../../../../rest/query/operations/query ../FeatureStoreStatistics ./FeatureSourceQueryInfo ./StreamMessenger ./strategies/DrillDownTileLoadStrategy ./strategies/PagedTileLoadStrategy ./strategies/ParquetLoadStrategy ./strategies/SnapshotLoadStrategy ./strategies/StreamLoadStrategy ./strategies/chunks/SourceChunkStore ../support/FeatureMetadata ../support/FeatureSetReaderJSON ../../support/UpdateTracking2D".split(" "),
function(b,q,n,g,k,l,a,f,d,c,e,h,x,m,p,t,w,r,y,z){class u{constructor(v,A,B,F,H){this.service=v;this._aggregateAdapter=A;this._subscriptions=B;this._onChange=F;this._connection=H;this._updateTracking=new z.UpdateTracking2D({debugName:"FeatureSource"});this._didInvalidateData=!1;this._store=new w.FeatureSourceChunkStore(this._onChange);this._metadata=r.FeatureMetadata.createFeature(v.metadata)}destroy(){this._strategy?.destroy();this._store.destroy();this._streamMessenger?.destroy();"memory"===this.service.type&&
this.service.source.map(v=>v.close())}get metadata(){if(!this._metadata)throw Error("InternalError: Metadata not defined. Was update called?");return this._metadata}get store(){return this._store}get streamMessenger(){null==this._streamMessenger&&this._initStreamMessenger();return this._streamMessenger}get statistics(){return d.FeatureStoreStatistics.from(this._store)}get updateTracking(){return this._updateTracking}get queryEngine(){if(!this._queryEngine){if(!this._schema)return null;const {dataFilter:v}=
this._schema.mutable,A=this._metadata;this._queryEngine=new a.QueryEngine({featureStore:this._store,fieldsIndex:A.fieldsIndex,geometryType:A.geometryType,objectIdField:A.objectIdField,hasM:!1,hasZ:!1,spatialReference:this.service.outSpatialReference,aggregateAdapter:this._aggregateAdapter,timeInfo:A.timeInfo,definitionExpression:v.definitionExpression,availableFields:this._schema.mutable.availableFields})}return this._queryEngine}get isStream(){return"stream"===this._schema.type}chunks(){return Array.from(this._store.chunks())}cleanupRemovedChunks(){return this._store.cleanupRemovedChunks()}onSubscribe(v){this._connection.onEvent({type:"subscribe",
tile:v.tile.id});const A=this._strategy?.load(v);A&&(A.then(()=>this._connection.onEvent({type:"loaded",tile:v.tile.id})).catch(B=>this._connection.onEvent({type:"error",tile:v.tile.id,error:B})),this._updateTracking.addPromise(A))}onResume(v){this._updateTracking.addPromise(g.ignoreAbortErrors(this._strategy?.load(v)))}onUnsubscribe(v){this._connection.onEvent({type:"unsubscribe",tile:v.tile.id});this._strategy?.unload(v)}getLocalEdit(v){return this._updateTracking.addPromise(this._getGetLocalEdit(v))}applyLocalEdit(v){this._didInvalidateData=
!0;this._store.applyLocalEdit(v,this.metadata)}async update(v,A){v=v.source;const B=k.diff(this._schema?.mutable,v.mutable);if(!B)return!1;n("esri-2d-update-debug")&&console.debug(`Version[${A}] FeatureSource.update`,{changes:B});this._schema=v;this._queryEngine?.destroy();this._queryEngine=null;"feature-service"===this.service.type&&null!=this.service.queryMetadata.lastEditDate&&(this._lastEditDate=this.service.queryMetadata.lastEditDate);null==this._streamMessenger&&"stream"===this._schema.type&&
this._initStreamMessenger();if(k.hasRootDiffOnly(B,"sourceRefreshVersion")&&this._strategy?.refresh)return await this._strategy.refresh(),!0;if(("feature"===v.type||"parquet"===v.type)&&k.hasRootDiffOnly(B,"availableFields")){if(await this._queryLastEditDateChanged()||this._didInvalidateData)this._didInvalidateData=!1,await this._updateStrategy(A);else{this._connection.onEvent({type:"updateFieldsStart"});try{await this._strategy.updateFields(v.mutable.availableFields),this._connection.onEvent({type:"updateFieldsEnd"})}catch(F){this._connection.onEvent({type:"updateFieldsError",
error:F})}}return!1}return k.hasRootDiff(B,"dataFilter")||k.hasRootDiff(B,"sourceRefreshVersion")?(await this._updateStrategy(A),!0):!1}async addParquetFile(v){this._strategy.addParquetFile(v)}_initStreamMessenger(){null==this._streamMessenger&&(this._streamMessenger=new e.StreamMessenger(this._connection))}async _getGetLocalEdit(v){v.historicMoment&&"feature"===this._schema.type&&(this._schema.mutable.dataFilter.historicMoment=v.historicMoment,this._strategy.unsafeSetQueryHistoricMoment(new Date(v.historicMoment)));
if("edit-by-feature"===v.type){var A=[...v.added,...v.updated].map(B=>l.OptimizedFeature.fromJSON(B,this.metadata.objectIdField));A=y.FeatureSetReaderJSON.fromOptimizedFeatures(A,this.metadata);v=this._resolveIdentifiers(v.removed);return{reader:A,removed:v}}A=this._resolveIdentifiers(v.removed);if(!v.updated.length&&!v.added.length)return{reader:y.FeatureSetReaderJSON.empty(this.metadata),removed:A};v=this._resolveIdentifiers([...v.added,...v.updated]);return{reader:await this._strategy.queryByObjectId(v),
removed:A}}_resolveIdentifiers(v){const A=[],B=[];for(const F of v)null==F.objectId||-1===F.objectId?A.push(F.globalId):B.push(F.objectId);if(A.length){const F=new Set(A),H=this.metadata.globalIdField;if(null==H)throw Error("InternalError: Recieved an edit with globalIds, but not supported by the service");this._store.forEachUnsafe(J=>{const E=J.readAttribute(H);F.has(E)&&B.push(J.getObjectId())})}return B}async _queryLastEditDateChanged(){if(null==this._lastEditDate)return!1;var v=this.service.source;
v=(await q(v.path,{query:{...v.query,f:"json"},responseType:"json"})).data.editingInfo.lastEditDate;if(v===this._lastEditDate)return!1;this._lastEditDate=v;return!0}async _createStrategy(){var v="isSourceHosted"in this.service&&this.service.isSourceHosted,A=Array.isArray(this.service.source),B=this.service.source&&"collection"in this.service.source;v=v||A||B;if("stream"===this._schema.type)return v=new t.StreamLoadStrategy(this.service,this._schema.mutable.dataFilter,this._store,{outSR:this.service.outSpatialReference},
this.metadata),this._streamMessenger.strategy=v;if("parquet"===this._schema.type)return new m.ParquetLoadStrategy(this.service,this._metadata,this._schema,this._store);A=this.service;B=c.FeatureSourceQueryInfo.fromSchema(A,this._schema,this._metadata);const F=await this._supportSnapshotMode(A,B);return F?new p.SnapshotLoadStrategy(A,B,this._store,F.featureCount,this.metadata,this._connection):v?new x.PagedTileLoadStrategy(A,B,this._store,this.metadata,this._connection):new h.DrillDownTileLoadStrategy(A,
B,this._store,this.metadata,this._connection)}async _updateStrategy(v){const A=await this._createStrategy();this._connection.onEvent({type:"updateStrategyStart",about:A.about});const B=!!this._strategy;this._store.clear();this._strategy?.destroy();this._strategy=A;n("esri-2d-update-debug")&&console.debug(`Version[${v}] FeatureSource.updateStrategy`,{strategy:A});var F=Array.from(this._subscriptions.values());if(F.length){F=Promise.all(F.map(H=>this._strategy.load(H).then(()=>this._connection.onEvent({type:"loaded",
tile:H.tile.id})).catch(J=>this._connection.onEvent({type:"error",tile:H.tile.id,error:J}))));this._updateTracking.addPromise(F);try{B&&await F}catch(H){g.throwIfNotAbortError(H)}this._connection.onEvent({type:"updateStrategyEnd"});n("esri-2d-update-debug")&&console.debug(`Version[${v}] FeatureSource.updateStrategyEnd`,{strategy:A})}else this._connection.onEvent({type:"updateStrategyEnd"})}async _supportSnapshotMode(v,A){var {queryMetadata:B}=v;B=B.snapshotInfo;if(!B||!B.supportsSnapshotMinThreshold||
!B.snapshotCountThresholds)return null;v=v.source;A=A.createQuery();A.inner.orderByFields=[];A.inner.returnGeometry=!1;A=(await f.executeQueryForCount(v,A.inner,{query:A.customParameters})).data.count;const {min:F,max:H}=B.snapshotCountThresholds;return A<=F||B.supportsSnapshotMaxThreshold&&A<H?{featureCount:A}:null}}b.FeatureSource=u;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/rest/query/operations/query":function(){define("exports ../../../request ../../../core/urlUtils ../../../geometry/support/jsonUtils ../../../geometry/support/normalizeUtils ../../../geometry/support/spatialReferenceUtils ../../operations/urlUtils ./pbfQueryUtils ./queryZScale".split(" "),
function(b,q,n,g,k,l,a,f,d){function c(m,p){if(p&&"extent"===m.type)return`${m.xmin},${m.ymin},${m.xmax},${m.ymax}`;if(p&&"point"===m.type)return`${m.x},${m.y}`;m=m.toJSON();delete m.spatialReference;return JSON.stringify(m)}function e(m,p){const t=m.geometry,w=m.toJSON();delete w.compactGeometryEnabled;delete w.defaultSpatialReferenceEnabled;let r,y,z;null!=t&&(y=t.spatialReference,z=l.srToRESTValue(y),w.geometryType=g.getJsonType(t),w.geometry=c(t,m.compactGeometryEnabled),w.inSR=z);w.groupByFieldsForStatistics&&
(w.groupByFieldsForStatistics=w.groupByFieldsForStatistics.join(","));w.objectIds&&(w.objectIds=w.objectIds.join(","));w.orderByFields&&(w.orderByFields=w.orderByFields.join(","));!w.outFields||!w.returnDistinctValues&&(p?.returnCountOnly||p?.returnExtentOnly||p?.returnIdsOnly)?delete w.outFields:w.outFields.includes("*")?w.outFields="*":w.outFields=w.outFields.join(",");w.outSR?(w.outSR=l.srToRESTValue(w.outSR),r=m.outSpatialReference):t&&(w.returnGeometry||w.returnCentroid)&&(w.outSR=w.inSR,r=y);
w.returnGeometry&&delete w.returnGeometry;w.outStatistics&&(w.outStatistics=JSON.stringify(w.outStatistics));w.fullText&&(w.fullText=JSON.stringify(w.fullText));w.pixelSize&&(w.pixelSize=JSON.stringify(w.pixelSize));w.quantizationParameters&&(m.defaultSpatialReferenceEnabled&&null!=y&&null!=m.quantizationParameters?.extent&&y.equals(m.quantizationParameters.extent.spatialReference)&&delete w.quantizationParameters.extent.spatialReference,w.quantizationParameters=JSON.stringify(w.quantizationParameters));
w.parameterValues&&(w.parameterValues=JSON.stringify(w.parameterValues));w.rangeValues&&(w.rangeValues=JSON.stringify(w.rangeValues));w.dynamicDataSource&&(w.layer=JSON.stringify({source:w.dynamicDataSource}),delete w.dynamicDataSource);if(w.timeExtent){const {start:u,end:v}=w.timeExtent;if(null!=u||null!=v)w.time=u===v?u:`${null==u?"null":u},${null==v?"null":v}`;delete w.timeExtent}m.defaultSpatialReferenceEnabled&&null!=y&&null!=r&&y.equals(r)&&(w.defaultSR=w.inSR,delete w.inSR,delete w.outSR);
return w}function h(m,p,t){return x(m,p,"pbf",t)}async function x(m,p,t,w={},r={}){m="string"===typeof m?n.urlToObject(m):m;var y=(await k.normalizeCentralMeridian(p.geometry?[p.geometry]:[],null,{signal:w.signal}))?.[0];null!=y&&(p=p.clone(),p.geometry=y);y=a.mapParameters({...m.query,f:t,...r,...e(p,r)});return q(n.join(m.path,null==p.formatOf3DObjects||r.returnCountOnly||r.returnExtentOnly||r.returnIdsOnly?"query":"query3d"),{...w,responseType:"pbf"===t?"array-buffer":"json",query:{...y,...w.query}})}
b.encodeGeometry=c;b.executeQuery=async function(m,p,t,w){m=null!=p.timeExtent&&p.timeExtent.isEmpty?{data:{features:[]}}:await x(m,p,"json",w);d.applyFeatureSetZUnitScaling(p,t,m.data);return m};b.executeQueryForCount=function(m,p,t){return null!=p.timeExtent&&p.timeExtent.isEmpty?Promise.resolve({data:{count:0}}):x(m,p,"json",t,{returnIdsOnly:!0,returnCountOnly:!0})};b.executeQueryForExtent=async function(m,p,t){if(null!=p.timeExtent&&p.timeExtent.isEmpty)return{data:{count:0,extent:null}};m=await x(m,
p,"json",t,{returnExtentOnly:!0,returnCountOnly:!0});p=m.data;if(p.hasOwnProperty("extent"))return m;if(p.features)throw Error("Layer does not support extent calculation.");if(p.hasOwnProperty("count"))throw Error("Layer does not support extent calculation.");return m};b.executeQueryForIds=function(m,p,t){return null!=p.timeExtent&&p.timeExtent.isEmpty?Promise.resolve({data:{objectIds:[]}}):x(m,p,"json",t,{returnIdsOnly:!0})};b.executeQueryPBF=async function(m,p,t,w){if(null!=p.timeExtent&&p.timeExtent.isEmpty)return{data:t.createFeatureResult()};
m=await h(m,p,w);m.data=f.parsePBFFeatureQuery(m.data,t);return m};b.executeQueryPBFBuffer=h;b.queryToQueryStringParameters=e;b.runQuery=x;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/rest/operations/urlUtils":function(){define(["exports"],function(b){function q(n){const g={};for(const k in n){if("declaredClass"===k)continue;const l=n[k];if(null!=l&&"function"!==typeof l)if(Array.isArray(l)){g[k]=[];for(let a=0;a<l.length;a++)g[k][a]=q(l[a])}else"object"===typeof l?l.toJSON&&
(g[k]=JSON.stringify(l)):g[k]=l}return g}b.mapParameters=q;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/rest/query/operations/pbfQueryUtils":function(){define(["exports","./pbfFeatureServiceParser"],function(b,q){b.parsePBFFeatureQuery=function(n,g){var k=q.parseFeatureQuery(n,g);n=k.queryResult.featureResult;g=k.queryResult.queryGeometry;k=k.queryResult.queryGeometryType;if(n&&n.features&&n.features.length&&n.objectIdFieldName){const l=n.objectIdFieldName;for(const a of n.features)a.attributes&&
(a.objectId=a.attributes[l])}n&&(n.queryGeometry=g,n.queryGeometryType=k);return n};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/rest/query/operations/pbfFeatureServiceParser":function(){define(["exports","../../../core/Error","../../../core/pbf","../../../layers/graphics/OptimizedGeometry","./pbfOptimizedFeatureSet"],function(b,q,n,g,k){function l(B){return B>=u.length?null:u[B]}function a(B,F,H){B=B.asUnsafe();for(H=F.createPointGeometry(H);B.next();)switch(B.tag()){case 3:var J=
B.getUInt32();J=B.pos()+J;let E=0;for(;B.pos()<J;)F.addCoordinatePoint(H,B.getSInt64(),E++);break;default:B.skip()}return H}function f(B,F,H){B=B.asUnsafe();const J=F.createGeometry(H);for(H=2+(H.hasZ?1:0)+(H.hasM?1:0);B.next();)switch(B.tag()){case 2:var E=B.getUInt32();E=B.pos()+E;for(var K=0;B.pos()<E;)F.addLength(J,B.getUInt32(),K++);break;case 3:E=B.getUInt32();E=B.pos()+E;K=0;for(F.allocateCoordinates(J);B.pos()<E;)F.addCoordinate(J,B.getSInt64(),K),K++,K===H&&(K=0);break;default:B.skip()}return J}
function d(B){B=B.asUnsafe();const F=new g;let H="esriGeometryPoint";for(;B.next();)switch(B.tag()){case 2:var J=B.getUInt32();for(J=B.pos()+J;B.pos()<J;)F.lengths.push(B.getUInt32());break;case 3:J=B.getUInt32();for(J=B.pos()+J;B.pos()<J;)F.coords.push(B.getSInt64());break;case 1:H=k.optimizedGeometryTypes[B.getEnum()];break;default:B.skip()}return{queryGeometry:F,queryGeometryType:H}}function c(B){for(B=B.asUnsafe();B.next();)switch(B.tag()){case 1:return B.getString();case 2:return B.getFloat();
case 3:return B.getDouble();case 4:return B.getSInt32();case 5:return B.getUInt32();case 6:return B.getInt64();case 7:return B.getUInt64();case 8:return B.getSInt64();case 9:return B.getBool();default:return B.skip(),null}return null}function e(B){B=B.asUnsafe();const F={type:l(0)};for(;B.next();)switch(B.tag()){case 1:F.name=B.getString();break;case 2:F.type=l(B.getEnum());break;case 3:F.alias=B.getString();break;case 4:var H=B.getEnum();H=H>=v.length?null:v[H];F.sqlType=H;break;case 5:B.skip();
break;case 6:F.defaultValue=B.getString();break;default:B.skip()}return F}function h(B){const F={};for(B=B.asUnsafe();B.next();)switch(B.tag()){case 1:F.name=B.getString();break;case 2:F.isSystemMaintained=B.getBool();break;default:B.skip()}return F}function x(B,F,H,J){const E=F.createFeature(H);let K=0;for(;B.next();)switch(B.tag()){case 1:const C=J[K++].name;E.attributes[C]=B.processMessage(c);break;case 2:E.geometry=B.processMessageWithArgs(f,F,H);break;case 4:E.centroid=B.processMessageWithArgs(a,
F,H);break;default:B.skip()}return E}function m(B){const F=[1,1,1,1];for(B=B.asUnsafe();B.next();)switch(B.tag()){case 1:F[0]=B.getDouble();break;case 2:F[1]=B.getDouble();break;case 4:F[2]=B.getDouble();break;case 3:F[3]=B.getDouble();break;default:B.skip()}return F}function p(B){const F=[0,0,0,0];for(B=B.asUnsafe();B.next();)switch(B.tag()){case 1:F[0]=B.getDouble();break;case 2:F[1]=B.getDouble();break;case 4:F[2]=B.getDouble();break;case 3:F[3]=B.getDouble();break;default:B.skip()}return F}function t(B){const F=
{originPosition:0>=A.length?null:A[0]};for(B=B.asUnsafe();B.next();)switch(B.tag()){case 1:var H=B.getEnum();F.originPosition=H>=A.length?null:A[H];break;case 2:F.scale=B.processMessage(m);break;case 3:F.translate=B.processMessage(p);break;default:B.skip()}return F}function w(B){const F={};for(B=B.asUnsafe();B.next();)switch(B.tag()){case 1:F.shapeAreaFieldName=B.getString();break;case 2:F.shapeLengthFieldName=B.getString();break;case 3:F.units=B.getString();break;default:B.skip()}return F}function r(B,
F){for(F=F.createSpatialReference();B.next();)switch(B.tag()){case 1:F.wkid=B.getUInt32();break;case 5:F.wkt=B.getString();break;case 2:F.latestWkid=B.getUInt32();break;case 3:F.vcsWkid=B.getUInt32();break;case 4:F.latestVcsWkid=B.getUInt32();break;default:B.skip()}return F}function y(B,F){const H=F.createFeatureResult();B=B.asUnsafe();H.geometryType=0>=F.geometryTypes.length?null:F.geometryTypes[0];let J=!1;for(;B.next();)switch(B.tag()){case 1:H.objectIdFieldName=B.getString();break;case 3:H.globalIdFieldName=
B.getString();break;case 4:H.geohashFieldName=B.getString();break;case 5:H.geometryProperties=B.processMessage(w);break;case 7:var E=B.getEnum();H.geometryType=E>=F.geometryTypes.length?null:F.geometryTypes[E];break;case 8:H.spatialReference=B.processMessageWithArgs(r,F);break;case 10:H.hasZ=B.getBool();break;case 11:H.hasM=B.getBool();break;case 12:H.transform=B.processMessage(t);break;case 9:H.exceededTransferLimit=B.getBool();break;case 13:F.addField(H,B.processMessage(e));break;case 15:J||(F.prepareFeatures(H),
J=!0);F.addFeature(H,B.processMessageWithArgs(x,F,H,H.fields));break;case 2:H.uniqueIdField=B.processMessage(h);break;default:B.skip()}F.finishFeatureResult(H);return H}function z(B,F){const H={};let J=null;for(;B.next();)switch(B.tag()){case 4:J=B.processMessageWithArgs(d);break;case 1:H.featureResult=B.processMessageWithArgs(y,F);break;default:B.skip()}null!=J&&H.featureResult&&F.addQueryGeometry(H,J);return H}const u="esriFieldTypeSmallInteger esriFieldTypeInteger esriFieldTypeSingle esriFieldTypeDouble esriFieldTypeString esriFieldTypeDate esriFieldTypeOID esriFieldTypeGeometry esriFieldTypeBlob esriFieldTypeRaster esriFieldTypeGUID esriFieldTypeGlobalID esriFieldTypeXML esriFieldTypeBigInteger esriFieldTypeDateOnly esriFieldTypeTimeOnly esriFieldTypeTimestampOffset".split(" "),
v="sqlTypeBigInt sqlTypeBinary sqlTypeBit sqlTypeChar sqlTypeDate sqlTypeDecimal sqlTypeDouble sqlTypeFloat sqlTypeGeometry sqlTypeGUID sqlTypeInteger sqlTypeLongNVarchar sqlTypeLongVarbinary sqlTypeLongVarchar sqlTypeNChar sqlTypeNVarchar sqlTypeOther sqlTypeReal sqlTypeSmallInt sqlTypeSqlXml sqlTypeTime sqlTypeTimestamp sqlTypeTimestamp2 sqlTypeTinyInt sqlTypeVarbinary sqlTypeVarchar".split(" "),A=["upperLeft","lowerLeft"];b.parseFeatureQuery=function(B,F){try{const H=new n(new Uint8Array(B),new DataView(B));
for(B={};H.next();)switch(H.tag()){case 2:B.queryResult=H.processMessageWithArgs(z,F);break;default:H.skip()}return B}catch(H){throw new q("query:parsing-pbf","Error while parsing FeatureSet PBF payload",{error:H});}};b.parseField=e;b.parseFieldType=l;b.parseTransform=t;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/rest/query/operations/pbfOptimizedFeatureSet":function(){define("exports ../../../core/unitUtils ../../../geometry/support/spatialReferenceUtils ../../../layers/graphics/OptimizedFeature ../../../layers/graphics/OptimizedFeatureSet ../../../layers/graphics/OptimizedGeometry".split(" "),
function(b,q,n,g,k,l){const a=["esriGeometryPoint","esriGeometryMultipoint","esriGeometryPolyline","esriGeometryPolygon"];class f{constructor(d){this._options=d;this.geometryTypes=a;this._vertexDimension=this._coordinatePtr=0}createFeatureResult(){return new k}prepareFeatures(d){this._vertexDimension=2;d.hasZ&&this._vertexDimension++;d.hasM&&this._vertexDimension++}finishFeatureResult(d){if(d?.features&&d.hasZ&&this._options.sourceSpatialReference&&d.spatialReference&&!n.equals(d.spatialReference,
this._options.sourceSpatialReference)&&!d.spatialReference.vcsWkid){var c=q.getMetersPerVerticalUnitForSR(this._options.sourceSpatialReference),e=q.getMetersPerVerticalUnitForSR(d.spatialReference);c/=e;if(1!==c)for(const h of d.features)if(g.hasGeometry(h))for(d=h.geometry.coords,e=2;e<d.length;e+=3)d[e]*=c}}addFeature(d,c){d.features.push(c)}createFeature(){return new g.OptimizedFeature}createSpatialReference(){return{wkid:0}}createGeometry(){return new l}addField(d,c){d.fields.push(c)}allocateCoordinates(d){d.coords.length=
d.lengths.reduce((c,e)=>c+e,0)*this._vertexDimension;this._coordinatePtr=0}addCoordinate(d,c){d.coords[this._coordinatePtr++]=c}addCoordinatePoint(d,c){d.coords.push(c)}addLength(d,c){d.lengths.push(c)}addQueryGeometry(d,c){d.queryGeometry=c.queryGeometry;d.queryGeometryType=c.queryGeometryType}createPointGeometry(){return new l}}b.OptimizedFeatureSetParserContext=f;b.optimizedGeometryTypes=a;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/rest/query/operations/queryZScale":function(){define(["exports",
"../../../geometry/support/zscale"],function(b,q){b.applyFeatureSetZUnitScaling=function(n,g,k){if(k?.features&&k.hasZ&&(n=q.getGeometryZScaler(k.geometryType,g,n.outSpatialReference),null!=n))for(const l of k.features)n(l.geometry)};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/FeatureStoreStatistics":function(){define(["exports"],function(b){class q{static from(n){let g=0,k=0,l=0;n.forEach(a=>{if(a=a._readGeometry())k+=a.isPoint?1:a.lengths.reduce((f,
d)=>f+d,0),l+=a.isPoint?1:a.lengths.length,g+=1});return new q(g,k,l)}constructor(n,g,k){this.featureCount=n;this.vertexCount=g;this.ringCount=k}toJSON(){return{featureCount:this.featureCount,ringCount:this.featureCount,vertexCount:this.featureCount}}}b.FeatureStoreStatistics=q;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/sources/FeatureSourceQueryInfo":function(){define("exports ../../../../../core/has ../../../../../core/sql ../../../../../geometry/SpatialReference ../../../../../layers/support/arcgisLayerUrl ../../../../../rest/support/Query ../../../../../time/TimeExtent".split(" "),
function(b,q,n,g,k,l,a){class f{static fromSchema(d,c,e){const h="feature"===c.type?c.mutable.dataFilter.queryScaleRanges:[];{var x=d.orderByFields??e.objectIdField+" ASC";const m=d.source;x={returnCentroid:!(null!==m&&"object"===typeof m&&"path"in m&&k.isHostedAgolService(m.path))&&"esriGeometryPolygon"===e.serviceGeometryType,returnGeometry:!0,timeReferenceUnknownClient:e.timeReferenceUnknownClient??void 0,outSpatialReference:g.fromJSON(d.outSpatialReference),orderByFields:"memory"===d.type?[]:
[x],where:c.mutable.dataFilter.definitionExpression??"1\x3d1",outFields:c.mutable.availableFields,multipatchOption:"esriGeometryMultiPatch"===e.serviceGeometryType?"xyFootprint":null};if("feature"===c.type){const {gdbVersion:p,historicMoment:t,timeExtent:w}=c.mutable.dataFilter;x={...x,gdbVersion:p,historicMoment:t?new Date(t):null,timeExtent:w?a.fromJSON(w):null,outFields:c.mutable.availableFields}}}return new f(x,h,e.subtypeField,c.mutable.dataFilter.customParameters,e.geometryType,d.queryMetadata)}constructor(d,
c,e,h,x,m){this._queryParams=d;this._queryScaleRanges=c;this._subtypeField=e;this._customParameters=h;this._geometryType=x;this._queryMetadata=m}get pageSize(){if(null==this._queryMetadata)throw Error("InternalError: Service does not support paged queries");return Math.min(8E3,(this._queryMetadata.maxRecordCount??8E3)*((this._queryMetadata.supportsMaxRecordCountFactor?4:null)??1))}updateHistoricMoment(d){this._queryParams.historicMoment=d}updateFields(d){this._queryParams.outFields=d}createPatchFieldsQuery(d,
c){if(!c.getSize())return null;d=d.clone();if("*"===this._queryParams.outFields[0]){if("*"===(d.outFields??[])[0])return null;d.outFields=this._queryParams.outFields}else{const e=new Set(this._queryParams.outFields),h=[];for(const x of e)c.hasField(x)||h.push(x);if(0===h.length)return null;d.outFields=h}d.returnGeometry=!1;d.returnCentroid=!1;d.quantizationParameters=null;d.cacheHint=!0;return{inner:d,customParameters:this._customParameters}}createQuery(d={}){if(!this._queryParams)throw Error("InternalError: queryInfo should be defined");
return{inner:new l({...this._queryParams,...d}),customParameters:this._customParameters}}createTileQuery(d,c){if(null==this._queryMetadata)throw Error("InternalError: Service does not support tile queries");const e=this.createQuery(c),h=e.inner;if(this._queryScaleRanges.length){const x=this._queryScaleRanges.filter(m=>(!m.minScale||m.minScale>=d.maxScale)&&(!m.maxScale||m.maxScale<=d.minScale)).map(m=>m.subtypeCode);x.length&&(h.where=n.sqlAnd(h.where,`${this._subtypeField} IN (${x})`))}h.quantizationParameters=
c.quantizationParameters??d.getQuantizationParameters();h.resultType="tile";h.geometry=d.extent;if(this._queryMetadata.supportsQuantization)"esriGeometryPolyline"===this._geometryType&&(h.maxAllowableOffset=d.resolution*q("feature-polyline-generalization-factor"));else if("esriGeometryPolyline"===this._geometryType||"esriGeometryPolygon"===this._geometryType)h.maxAllowableOffset=d.resolution,"esriGeometryPolyline"===this._geometryType&&(h.maxAllowableOffset*=q("feature-polyline-generalization-factor"));
h.defaultSpatialReferenceEnabled=this._queryMetadata.supportsDefaultSpatialReference;h.compactGeometryEnabled=this._queryMetadata.supportsCompactGeometry;this._queryMetadata.supportsMaxRecordCountFactor&&(h.maxRecordCountFactor=4);q("esri-tiles-debug")&&(c=d.id.replaceAll("/","."),e.customParameters=e.customParameters?{...e.customParameters,tileId:c}:{tileId:c});return e}createPagedTileQuery(d,c){const e=this.pageSize;return this.createTileQuery(d,{start:e*c,num:e,returnExceededLimitFeatures:!0})}createPagedQuery(d){const c=
this.pageSize;return this.createQuery({start:c*d,num:c,returnExceededLimitFeatures:!0,maxRecordCountFactor:4})}}b.FeatureSourceQueryInfo=f;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/arcgisLayerUrl":function(){define(["exports","../../core/urlUtils","../../chunks/persistableUrlUtils"],function(b,q,n){function g(h){if(null==h)return null;h=q.urlToObject(h);h=h?.path.match(d)||h?.path.match(c);if(!h)return null;const [,x,m,p,t]=h;h=m.indexOf("/");return{title:l(-1!==
h?m.slice(h+1):m),serverType:a[p.toLowerCase()],sublayer:null!=t&&""!==t?parseInt(t,10):null,url:{path:x}}}function k(h){return(h=q.urlToObject(h).path.match(e))?{serviceUrl:h[1],sublayerId:Number(h[2])}:null}function l(h){h=h.replaceAll(/\s*[/_]+\s*/g," ");return h[0].toUpperCase()+h.slice(1)}const a={mapserver:"MapServer",imageserver:"ImageServer",featureserver:"FeatureServer",knowledgegraphserver:"KnowledgeGraphServer",sceneserver:"SceneServer",streamserver:"StreamServer",vectortileserver:"VectorTileServer",
"3dtilesserver":"3DTilesServer",videoserver:"VideoServer"},f=Object.values(a),d=new RegExp(`^((?:https?:)?\\/\\/\\S+?\\/rest\\/services\\/(.+?)\\/(${f.join("|")}))(?:\\/(?:layers\\/)?(\\d+))?`,"i"),c=new RegExp(`^((?:https?:)?\\/\\/\\S+?\\/([^/\\n]+)\\/(${f.join("|")}))(?:\\/(?:layers\\/)?(\\d+))?`,"i"),e=/(.*?)\/(?:layers\/)?(\d+)\/?$/i;b.cleanTitle=l;b.isArcGISUrl=function(h){return d.test(h)};b.isHostedAgolService=function(h){h=q.getOrigin(h,!0);if(!h)return!1;h=h.toLowerCase();return h.endsWith(".arcgis.com")&&
(h.startsWith("services")||h.startsWith("tiles")||h.startsWith("features"))};b.isServerOrServicesAGOLUrl=function(h){if(!h)return!1;h=(new q.Url(q.makeAbsolute(h))).authority?.toLowerCase();return"server.arcgisonline.com"===h||"services.arcgisonline.com"===h};b.isWmsServer=function(h){if(!h)return!1;var x=h.toLowerCase();h=x.includes("/services/");const m=x.includes("/mapserver/wmsserver"),p=x.includes("/imageserver/wmsserver");x=x.includes("/wmsserver");return h&&(m||p||x)};b.parse=g;b.parseNonStandardSublayerUrl=
k;b.sanitizeUrl=function(h,x){return h?q.removeTrailingSlash(q.removeQueryParameters(h,x)):h};b.sanitizeUrlWithLayerId=function(h){let {url:x}=h;if(!x)return{url:x};x=q.removeQueryParameters(x,h.logger);const m=q.urlToObject(x),p=g(m.path);let t=void 0;null!=p?(null!=p.sublayer&&null==h.layer.layerId&&(t=p.sublayer),x=p.url.path):h.nonStandardUrlAllowed&&(h=k(m.path),null!=h&&(x=h.serviceUrl,t=h.sublayerId));return{url:q.removeTrailingSlash(x),layerId:t}};b.serverTypes=f;b.titleFromUrlAndName=function(h,
x){const m=[];h&&(h=g(h),null!=h&&h.title&&m.push(h.title));x&&(x=l(x),m.push(x));if(2===m.length){if(m[0].toLowerCase().includes(m[1].toLowerCase()))return m[0];if(m[1].toLowerCase().includes(m[0].toLowerCase()))return m[1]}return m.join(" - ")};b.writeUrlWithLayerId=function(h,x,m,p,t){n.write(x,p,"url",t);p.url&&null!=h.layerId&&(p.url=q.join(p.url,m,h.layerId.toString()))};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/sources/StreamMessenger":function(){define("exports ../../../../../chunks/tslib.es6 ../../../../../core/Accessor ../../../../../core/reactiveUtils ../../../../../core/accessorSupport/decorators/property ../../../../../core/has ../../../../../core/Logger ../../../../../core/RandomLCG ../../../../../core/accessorSupport/decorators/subclass".split(" "),
function(b,q,n,g,k,l,a,f,d){b.StreamMessenger=class extends n{constructor(c){super();this._connection=c;this._enabledEventTypes=new Set;this._updateInfo={websocket:0,client:0};this._lastTime=performance.now();this._queuedCommands=[];this.addHandles([g.watch(()=>this._strategy?.connectionStatus??"disconnected",e=>{this._layerView.setProperty({propertyName:"pipelineConnectionStatus",value:e})},{initial:!0}),g.watch(()=>this._strategy?.errorString||null,e=>this._layerView.setProperty({propertyName:"pipelineErrorString",
value:e}),{initial:!0})])}destroy(){this._strategy=null;this.removeAllHandles()}get _layerView(){return this._connection.layerView}set strategy(c){null==this._strategy&&this._resetUpdateInfo(performance.now());this.removeHandles("event-handles");null!=c&&(this.addHandles([c.events.on("data-received",e=>this._onFeature(e)),c.events.on("message-received",e=>this._onWebSocketMessage(e)),c.events.on("features-updated",e=>this._onUpdate(e)),c.events.on("tick",()=>this._onTick())],"event-handles"),this._queuedCommands.forEach(e=>
e(c)),this._queuedCommands=[]);this._strategy=c}updateCustomParameters(c){null!=c&&this._callOrEnqueue(e=>e.updateCustomParameters(c))}sendMessageToSocket(c){this._callOrEnqueue(e=>e.sendMessageToSocket(c))}sendMessageToClient(c){this._callOrEnqueue(e=>e.sendMessageToClient(c))}enableEvent(c,e){e?this._enabledEventTypes.add(c):this._enabledEventTypes.delete(c)}disconnect(){this._strategy?.disconnect()}connect(){this._strategy?.connect()}clear(){this._strategy?.clear()}_onWebSocketMessage(c){this._enabledEventTypes.has("message-received")&&
this._layerView.emitEvent({name:"message-received",event:c})}_onFeature(c){this._updateInfo.websocket++;this._enabledEventTypes.has("data-received")&&this._layerView.emitEvent({name:"data-received",event:{attributes:c.attributes,centroid:c.centroid,geometry:c.geometry}})}_onUpdate(c){this._updateInfo.client+=c}_onTick(){const c=performance.now();var e=c-this._lastTime;if(2500<e){const h=Math.round(this._updateInfo.client/(e/1E3));e=Math.round(this._updateInfo.websocket/(e/1E3));this._resetUpdateInfo(c);
this._layerView.emitEvent({name:"update-rate",event:{client:h,websocket:e}})}}_resetUpdateInfo(c){this._lastTime=c;this._updateInfo.client=0;this._updateInfo.websocket=0}_callOrEnqueue(c){null!=this._strategy?c(this._strategy):this._queuedCommands.push(c)}};q.__decorate([k.property()],b.StreamMessenger.prototype,"_strategy",void 0);b.StreamMessenger=q.__decorate([d.subclass("esri.views.2d.layers.features.sources.StreamMessenger")],b.StreamMessenger);Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},
"esri/views/2d/layers/features/sources/strategies/DrillDownTileLoadStrategy":function(){define("exports ../../../../../../core/handleUtils ../../../../../../core/has ../../../../../../core/promiseUtils ./ATileLoadStrategy ./chunks/DrillDownTileSourceChunk ../../support/FeatureSetReaderJSON".split(" "),function(b,q,n,g,k,l,a){class f{constructor(c,e){this.subscription=c;this._tileIdToResult=new Map;this._controller=new AbortController;this._handles=q.handlesGroup([g.onAbort(c.signal,()=>this._controller.abort()),
g.onAbort(e,()=>this._controller.abort())])}destroy(){this._controller.abort();this._handles.remove()}get(c){return this._tileIdToResult.get(c)}set(c,e){this._tileIdToResult.set(c,e)}get options(){return{signal:this._controller.signal}}}class d extends k.ATileLoadStrategy{constructor(){super(...arguments);this._loadStates=new Map}destroy(){super.destroy();for(const c of this._loadStates.values())c.destroy();this._loadStates.clear()}get about(){return{willQueryAllFeatures:!1,willQueryFullResolutionGeometry:!1}}async load(c){this._loadStates.has(c.key.id)||
this._loadStates.set(c.key.id,new f(c,this._options));const e=this._loadStates.get(c.key.id);let h;try{for await(const x of this._fetchChunkInfos(e,c.tile,0)){const {queryJSON:m,reader:p,sourceTile:t,sourceTileDepth:w,tile:r}=x,y=new l.DrillDownTileSourceChunk(p,m,r,t,w,!1);g.throwIfAborted(e.options);this._addChunk(y)}}catch(x){h=x}c=new l.DrillDownTileSourceChunk(a.FeatureSetReaderJSON.empty(this._metadata),null,c.tile,null,-1,!0);this._addChunk(c);if(h)throw h;}unload(c){super.unload(c);this._loadStates.get(c.key.id)?.destroy();
this._loadStates.delete(c.key.id)}async *_fetchChunkInfos(c,e,h){let x=c.get(e.id);const m=!!x;x||(x=await this._fetchChunkInfo(c,e,h),c.set(e.id,x));if(x.reader.exceededTransferLimit&&h<n("featurelayer-query-max-depth"))for(const p of e.createChildTiles())yield*this._fetchChunkInfos(c,p,h+1);else m||(yield x)}async _fetchChunkInfo(c,e,h){var x=c.subscription.tile.getQuantizationParameters();x=this._queryInfo.createTileQuery(e,{returnExceededLimitFeatures:!1,quantizationParameters:x});return{reader:await this._fetch(x,
c.options),queryJSON:x.inner.toJSON(),tile:c.subscription.tile,sourceTile:e,sourceTileDepth:h}}}b.DrillDownTileLoadStrategy=d;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/sources/strategies/ATileLoadStrategy":function(){define(["exports","../../../../../../core/has","./AFetchLoadStrategy"],function(b,q,n){class g extends n.AFetchLoadStrategy{constructor(){super(...arguments);this._chunksById=new Map}unload(k){this._removeChunks(k.tile)}_addChunk(k){const l=
k.tile.id;this._chunksById.has(l)||this._chunksById.set(l,[]);const a=k.size();if(a||k.first||k.end)q("esri-2d-update-debug")&&console.debug(`Chunk[${k.chunkId}] ATileLoadStrategy.addChunk [count=${a}]`),this._chunksById.get(l).push(k),this._store.insert(k)}_removeChunks(k){const l=this._chunksById.get(k.key.id)??[];for(const a of l)q("esri-2d-update-debug")&&console.debug(`Tile[${k.key.id}] Chunk[${a.chunkId}] ATileLoadStrategy.removeChunk`),this._store.remove(a);this._chunksById.delete(k.key.id)}}
b.ATileLoadStrategy=g;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/sources/strategies/AFetchLoadStrategy":function(){define("exports ../../../../../../core/Error ../../../../../../rest/support/Query ./ALoadStrategy ./support/queryAdapters ../../support/FeatureSetReaderJSON ../../../../../support/QueueProcessor".split(" "),function(b,q,n,g,k,l,a){class f extends g.ALoadStrategy{constructor(d,c,e,h,x){super(e);this._serviceInfo=d;this._queryInfo=c;this._metadata=
h;this._connection=x;this._queue=new a.QueueProcessor({concurrency:16,process:async m=>this._adapter.executeQuery(m.query.inner,{signal:m.options?.signal,query:m.query.customParameters})});this._adapter=k.createQueryAdapter(d,h)}unsafeSetQueryHistoricMoment(d){this._queryInfo.updateHistoricMoment(d)}async updateFields(d){this._queryInfo.updateFields(d);d=Array.from(this._store.chunks()).map(async c=>{const e=n.fromJSON(c.queryInfo.queryJSON);if(e)try{return await this._tryUpdateFields(c.reader,e),
null}catch(h){return h}});d=(await Promise.all(d)).filter(c=>c);if(d.length)throw new q("featurelayer-query","Encountered errors when downloading fields",{errors:d});}async queryByObjectId(d){if(0===d.length)return l.FeatureSetReaderJSON.empty(this._metadata);d=this._queryInfo.createQuery({objectIds:d});return this._fetch(d)}async _fetch(d,c){c=await this._enqueue(d,c);await this._tryUpdateFields(c,d.inner);return c}async _tryUpdateFields(d,c){if(c=this._queryInfo.createPatchFieldsQuery(c,d))c=await this._enqueue(c,
this._options),d.joinAttributes(c)}async _enqueue(d,c){this._connection.onEvent({type:"fetchStart"});return this._queue.push({query:d,options:c}).finally(()=>{this._connection.onEvent({type:"fetchEnd",done:0===this._queue.length})})}}b.AFetchLoadStrategy=f;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/sources/strategies/ALoadStrategy":function(){define(["exports"],function(b){class q{constructor(n){this._store=n;this._controller=new AbortController}destroy(){this._controller.abort()}get _options(){return{signal:this._controller.signal}}unsafeSetQueryHistoricMoment(n){throw Error("InternalError: LoadStrategy does not support query info");
}async queryOverride(n){throw Error("InternalError: LoadStrategy does not support fetching");}async queryByObjectId(n){throw Error("InternalError: LoadStrategy does not support fetching");}async addParquetFile(n){throw Error("InternalError: LoadStrategy does not support loading blobs");}}b.ALoadStrategy=q;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/sources/strategies/support/queryAdapters":function(){define("exports ../../../../../../../core/has ../../../../../../../core/workers/Connection ../../../../../../../geometry/support/quantizationUtils ../../../../../../../layers/graphics/featureConversionUtils ../../../../../../../layers/ogc/ogcFeatureUtils ../../../../../../../rest/query/operations/query ../../../support/FeatureSetReaderJSON ../../../support/FeatureSetReaderPBF".split(" "),
function(b,q,n,g,k,l,a,f,d){async function c(t){const w=new n;await w.open(t,{});return w}class e{constructor(t,w){this.service=t;this._metadata=w}destroy(){}}class h extends e{constructor(t,w){super(t,w);this._portsOpen=c(t.source).then(r=>this.client=r)}destroy(){this.client.close();this.client=null}async executeQuery(t,w){await this._portsOpen;t=await this.client.invoke("queryFeatures",t.toJSON(),w);return f.FeatureSetReaderJSON.fromFeatureSet(t,this._metadata)}}class x extends e{async executeQuery(t,
w){({data:w}=await a.executeQueryPBFBuffer(this.service.source,t,w));return d.FeatureSetReaderPBF.fromBuffer(w,this._metadata,!t.quantizationParameters)}}class m extends e{async executeQuery(t,w){const {source:r,queryMetadata:y}=this.service;if(null!=t.quantizationParameters&&!y.supportsQuantization){const z=t.clone();t=g.toQuantizationTransform(z.quantizationParameters);z.quantizationParameters=null;({data:w}=await a.executeQuery(r,z,this._metadata.spatialReference,w));w=k.convertFromFeatureSet(w,
this._metadata.objectIdField);k.quantizeOptimizedFeatureSet(t,w);return f.FeatureSetReaderJSON.fromOptimizedFeatureSet(w,this._metadata)}({data:t}=await a.executeQuery(r,t,this._metadata.spatialReference,w));"esriGeometryPoint"===this._metadata.geometryType&&(t.features=t.features?.filter(z=>null!=z.geometry?(z=z.geometry,Number.isFinite(z.x)&&Number.isFinite(z.y)):!0));return f.FeatureSetReaderJSON.fromFeatureSet(t,this._metadata)}}class p extends e{async executeQuery(t,w){if(t.quantizationParameters&&
!this.service.queryMetadata.supportsQuantization){const y=t.clone();var r=g.toQuantizationTransform(y.quantizationParameters);y.quantizationParameters=null;t=await l.queryOptimizedFeatureSet(this.service.source,t,w);k.quantizeOptimizedFeatureSet(r,t);return f.FeatureSetReaderJSON.fromOptimizedFeatureSet(t,this._metadata)}r=await l.queryOptimizedFeatureSet(this.service.source,t,w);return f.FeatureSetReaderJSON.fromOptimizedFeatureSet(r,this._metadata)}}b.SourceAdapter=e;b.createQueryAdapter=function(t,
w){switch(t.type){case "memory":return new h(t,w);case "ogc":return new p(t,w);case "feature-service":return t.queryMetadata.supportsFormatPBF&&q("featurelayer-pbf")?new x(t,w):new m(t,w)}};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/core/workers/Connection":function(){define("../handleUtils ../has ../promiseUtils ../Queue ./connectionRegistry ./InvokeHandler ./RemoteClient".split(" "),function(b,q,n,g,k,l,a){class f{constructor(){this._inUseClients=[];this._clients=[];this._clientPromises=
[];this._ongoingJobsQueue=new g}destroy(){this.close()}get closed(){return!this._clients?.length}open(d,c){return new Promise((e,h)=>{let x=!0;const m=p=>{n.throwIfAborted(c.signal);x&&(x=!1,p())};this._clients.length=d.length;this._clientPromises.length=d.length;this._inUseClients.length=d.length;for(let p=0;p<d.length;++p){const t=d[p];n.isPromiseLike(t)?this._clientPromises[p]=t.then(w=>{this._clients[p]=new a(w,c,this._ongoingJobsQueue);m(e);return this._clients[p]},()=>{m(h);return null}):(this._clients[p]=
new a(t,c,this._ongoingJobsQueue),this._clientPromises[p]=Promise.resolve(this._clients[p]),m(e))}})}broadcast(d,c,e){const h=Array(this._clientPromises.length);for(let x=0;x<this._clientPromises.length;++x)h[x]=this._clientPromises[x].then(m=>m?.invoke(d,c,e));return h}close(){let d;for(;d=this._ongoingJobsQueue.pop();)d.resolver.reject(n.createAbortError(`Worker closing, aborting job calling '${d.methodName}'`));for(const c of this._clientPromises)c.then(e=>e?.close());this._clients.length=0;this._clientPromises.length=
0;this._inUseClients.length=0;k.unregister(this)}invoke(d,c,e){return this.apply(d,[c],e)}apply(d,c,e){const h=n.createResolver();this._ongoingJobsQueue.push({methodName:d,data:c,invokeOptions:e,resolver:h});for(d=0;d<this._clientPromises.length;d++)(c=this._clients[d])?c.jobAdded():this._clientPromises[d].then(x=>x?.jobAdded());return h.promise}createInvokeProxy(d){return l.createInvokeProxy(this,d)}on(d,c){return Promise.all(this._clientPromises).then(()=>b.handlesGroup(this._clients.map(e=>e.on(d,
c))))}openPorts(){return new Promise(d=>{const c=Array(this._clientPromises.length);let e=c.length;for(let h=0;h<this._clientPromises.length;++h)this._clientPromises[h].then(x=>{x&&(c[h]=x.openPort());0===--e&&d(c)})})}get test(){}}return f})},"esri/core/workers/connectionRegistry":function(){define(["exports"],function(b){const q=new FinalizationRegistry(n=>{n.close()});b.register=function(n,g){q.register(n,g,g)};b.unregister=function(n){q.unregister(n)};Object.defineProperty(b,Symbol.toStringTag,
{value:"Module"})})},"esri/layers/ogc/ogcFeatureUtils":function(){define("exports ../../geometry ../../request ../../core/Error ../../core/Logger ../../core/urlUtils ../../geometry/support/spatialReferenceUtils ../../geometry/support/webMercatorUtils ../graphics/featureConversionUtils ../graphics/OptimizedFeatureSet ../graphics/sources/geojson/geojson ../graphics/sources/support/clientSideDefaults ../graphics/sources/support/sourceUtils ../support/FieldsIndex ../support/fieldType ../../time/timeZoneUtils ../../geometry/SpatialReference".split(" "),
function(b,q,n,g,k,l,a,f,d,c,e,h,x,m,p,t,w){async function r(J,E,K){const {collection:{links:C,landingPage:{url:D}},layerDefinition:G,maxRecordCount:N,queryParameters:{apiKey:Y,customParameters:ca},spatialReference:ka,supportedCrs:Q}=J;var R=v(C,"items",H.geojson)||v(C,"http://www.opengis.net/def/rel/ogc/1.0/items",H.geojson);if(null==R)throw new g("ogc-feature-layer:missing-items-page","Missing items url");const {geometry:Z,num:da,start:ja,timeExtent:W,where:aa}=E;if(E.objectIds)throw new g("ogc-feature-layer:query-by-objectids-not-supported",
"Queries with object ids are not supported");J=w.fromJSON(ka);E=E.outSpatialReference??J;J=E.isWGS84?null:y(E,Q);if(null==Z||"extent"!==Z.type)var ia=null;else if({spatialReference:ia}=Z,!ia||ia.isWGS84)ia={bbox:z(Z)};else{var qa=y(ia,Q);ia=null!=qa?{bbox:z(Z),"bbox-crs":qa}:ia.isWebMercator?{bbox:z(f.project(Z,w.WGS84))}:null}qa=ia;if(null==W)ia=null;else{var {start:sa,end:ya}=W;ia=`${null!=sa?sa.toISOString():".."}/${null!=ya?ya.toISOString():".."}`}const va=ia;var wa=null!=aa&&aa&&"1\x3d1"!==aa?
aa:null;ia=da??(null==ja?N:10);const M=0===ja?void 0:ja,{fields:L,geometryType:T,hasZ:ha,objectIdField:oa,paginationParameter:S}=G;R=l.makeAbsolute(R.href,D);({data:R}=await n(R,{...K,query:{...ca,...qa,crs:J,datetime:va,query:wa,limit:ia,[S]:M,token:Y},headers:{accept:H.geojson}}));K=e.createOptimizedFeatures(R,{geometryType:T,hasZ:ha,objectIdField:oa});R=K.length===ia&&!!v(R.links??[],"next",H.geojson);ia=new m(L);for(var X of K){qa={};x.mixAttributes(ia,qa,X.attributes,!0);for(const pa of ia.fields)!pa.nullable||
pa.name in qa||(qa[pa.name]=null);qa[oa]=X.attributes[oa];X.attributes=qa}if(!J&&E.isWebMercator)for(var ba of K)null!=ba.geometry&&null!=T&&(X=d.convertToGeometry(ba.geometry,T,ha,!1),X.spatialReference=w.WGS84,ba.geometry=d.convertFromGeometry(f.project(X,E)));for(var la of K)la.objectId=la.attributes[oa];ba=J||!J&&E.isWebMercator?E.toJSON():a.wgs84;la=new c;la.exceededTransferLimit=R;la.features=K;la.fields=L;la.geometryType=T;la.hasZ=ha;la.objectIdFieldName=oa;la.spatialReference=ba;return la}
function y(J,E){const {isWebMercator:K,wkid:C}=J;return C?(J=K?E[3857]??E[102100]??E[102113]??E[900913]:E[J.wkid])?`${"http://www.opengis.net/def/crs/"}${J}`:null:null}function z(J){if(null==J)return"";const {xmin:E,ymin:K,xmax:C,ymax:D}=J;return`${E},${K},${C},${D}`}function u(J){J=J.extent?.spatial;if(!J)return null;var E=J.bbox[0],K=4===E.length;const [C,D]=E;J=K?void 0:E[2];const G=K?E[2]:E[3],N=K?E[3]:E[4];E=K?void 0:E[5];K=w.WGS84.toJSON();return{xmin:C,ymin:D,xmax:G,ymax:N,zmin:J,zmax:E,spatialReference:K}}
function v(J,E,K){return J.find(({rel:C,type:D})=>C===E&&D===K)??J.find(({rel:C,type:D})=>C===E&&!D)}function A(J,E,K){if(K&&(K=v(K,"next",H.geojson),K=l.urlToObject(K?.href)?.query)){J=l.urlToObject(J).query;var C=Object.keys(J??{});return Object.entries(K).filter(([D])=>!C.includes(D)).find(([D,G])=>F.has(D.toLowerCase())&&Number.parseInt(G,10)===E)?.[0]}}const B=()=>k.getLogger("esri.layers.ogc.ogcFeatureUtils"),F=new Set(["startindex","offset"]);var H;(function(J){J.json="application/json";J.geojson=
"application/geo+json";J.openapi="application/vnd.oai.openapi+json;version\x3d3.0"})(H||={});b.crsDefault="http://www.opengis.net/def/crs/OGC/1.3/CRS84";b.crsPrefix="http://www.opengis.net/def/crs/";b.getCollectionDefinition=async function(J,E,K={},C=5){var {links:D}=J;D=v(D,"items",H.geojson)||v(D,"http://www.opengis.net/def/rel/ogc/1.0/items",H.geojson);if(null==D)throw new g("ogc-feature-layer:missing-items-page","Missing items url");const {apiKey:G,customParameters:N,signal:Y}=K;K=l.makeAbsolute(D.href,
J.landingPage.url);D=l.addQueryParameters(K,{limit:C,...N,token:G});({data:K}=await n(D,{signal:Y,headers:{accept:H.geojson}}));C=A(D,C,K.links)??"startindex";e.validateGeoJSON(K);const ca=e.inferLayerProperties(K,{geometryType:E.geometryType});K=E.fields||ca.fields||[];D=null!=E.hasZ?E.hasZ:ca.hasZ;const ka=ca.geometryType,Q=E.objectIdField||ca.objectIdFieldName||"OBJECTID";E=E.timeInfo;var R=K.find(({name:ja})=>ja===Q);if(R)R.editable=!1,R.nullable=!1;else{if(!ca.objectIdFieldType)throw new g("ogc-feature-layer:missing-feature-id",
"Collection geojson require a feature id as a unique identifier");K.unshift({name:Q,alias:Q,type:"number"===ca.objectIdFieldType?"esriFieldTypeOID":"esriFieldTypeString",editable:!1,nullable:!1})}Q!==ca.objectIdFieldName&&(R=K.find(({name:ja})=>ja===ca.objectIdFieldName))&&(R.type="esriFieldTypeInteger");K===ca.fields&&0<ca.unknownFields.length&&B().warn({name:"ogc-feature-layer:unknown-field-types",message:"Some fields types couldn't be inferred from the features and were dropped",details:{unknownFields:ca.unknownFields}});
for(var Z of K){null==Z.name&&(Z.name=Z.alias);null==Z.alias&&(Z.alias=Z.name);"esriFieldTypeOID"!==Z.type&&"esriFieldTypeGlobalID"!==Z.type&&(Z.editable=null==Z.editable||!!Z.editable,Z.nullable=null==Z.nullable||!!Z.nullable);if(!Z.name)throw new g("ogc-feature-layer:invalid-field-name","field name is missing",{field:Z});if(!p.kebabDict.jsonValues.includes(Z.type))throw new g("ogc-feature-layer:invalid-field-type",`invalid type for field "${Z.name}"`,{field:Z});}if(E){Z=new m(K);E.startTimeField&&
((R=Z.get(E.startTimeField))?(E.startTimeField=R.name,R.type="esriFieldTypeDate"):E.startTimeField=null);E.endTimeField&&((R=Z.get(E.endTimeField))?(E.endTimeField=R.name,R.type="esriFieldTypeDate"):E.endTimeField=null);E.trackIdField&&((Z=Z.get(E.trackIdField))?E.trackIdField=Z.name:(E.trackIdField=null,B().warn({name:"ogc-feature-layer:invalid-timeInfo-trackIdField",message:"trackIdField is missing",details:{timeInfo:E}})));var da;(da=E).timeReference||(da.timeReference={timeZoneIANA:t.utc});E.startTimeField||
E.endTimeField||(B().warn({name:"ogc-feature-layer:invalid-timeInfo",message:"startTimeField and endTimeField are missing",details:{timeInfo:E}}),E=void 0)}da=ka?h.createDrawingInfo(ka):null;J=u(J);return{drawingInfo:da,extent:J,geometryType:ka,fields:K,hasZ:!!D,objectIdField:Q,paginationParameter:C,timeInfo:E}};b.getServerCollections=async function(J,E={}){const {links:K,url:C}=J,D=v(K,"data",H.json)||v(K,"http://www.opengis.net/def/rel/ogc/1.0/data",H.json);if(null==D)throw new g("ogc-feature-layer:missing-collections-page",
"Missing collections url");const {apiKey:G,customParameters:N,signal:Y}=E;E=l.makeAbsolute(D.href,C);({data:E}=await n(E,{signal:Y,headers:{accept:H.json},query:{...N,token:G}}));for(const ca of E.collections)ca.landingPage=J;return E};b.getServerConformance=async function(J,E={}){const {links:K,url:C}=J;J=v(K,"conformance",H.json)||v(K,"http://www.opengis.net/def/rel/ogc/1.0/conformance",H.json);if(null==J)throw new g("ogc-feature-layer:missing-conformance-page","Missing conformance url");const {apiKey:D,
customParameters:G,signal:N}=E;E=l.makeAbsolute(J.href,C);({data:E}=await n(E,{signal:N,headers:{accept:H.json},query:{...G,token:D}}));return E};b.getServerLandingPage=async function(J,E={}){const {apiKey:K,customParameters:C,signal:D}=E;({data:E}=await n(J,{signal:D,headers:{accept:H.json},query:{...C,token:K}}));E.url=J;return E};b.getServerOpenApi=async function(J,E={}){const {links:K,url:C}=J;J=v(K,"service-desc",H.openapi);if(null==J)return B().warn("ogc-feature-layer:missing-openapi-page",
"The OGC API-Features server does not have an OpenAPI page."),null;const {apiKey:D,customParameters:G,signal:N}=E;E=l.makeAbsolute(J.href,C);({data:E}=await n(E,{signal:N,headers:{accept:H.openapi},query:{...G,token:D}}));return E};b.getSpatialReferenceWkid=function(J){J=/^http:\/\/www\.opengis.net\/def\/crs\/(?<authority>.*)\/(?<version>.*)\/(?<code>.*)$/i.exec(J)?.groups;if(!J)return null;const {authority:E,code:K}=J;switch(E.toLowerCase()){case "ogc":switch(K.toLowerCase()){case "crs27":return w.GCS_NAD_1927.wkid;
case "crs83":return 4269;case "crs84":case "crs84h":return w.WGS84.wkid;default:return null}case "esri":case "epsg":return J=Number.parseInt(K,10),Number.isNaN(J)?null:J;default:return null}};b.queryFeatureSetJSON=async function(J,E,K){J=await r(J,E,K);return d.convertToFeatureSet(J)};b.queryOptimizedFeatureSet=r;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/sources/geojson/geojson":function(){define("exports ../../../../core/date ../../../../core/Error ../../../../geometry/support/spatialReferenceUtils ../../OptimizedFeature ../../OptimizedGeometry ../../../support/fieldUtils".split(" "),
function(b,q,n,g,k,l,a){function*f(v){switch(v.type){case "Feature":yield v;break;case "FeatureCollection":for(const A of v.features)A&&(yield A)}}function*d(v){if(v)switch(v.type){case "Point":yield v.coordinates;break;case "LineString":case "MultiPoint":yield*v.coordinates;break;case "MultiLineString":case "Polygon":for(const A of v.coordinates)yield*A;break;case "MultiPolygon":for(const A of v.coordinates)for(const B of A)yield*B}}function*c(v,A={}){const {geometryType:B,objectIdField:F}=A;for(const H of v){const {geometry:J,
properties:E,id:K}=H;if(J&&u[J.type]!==B)continue;v=E||{};let C=void 0;F&&(C=v[F],null==K||C||(v[F]=C=K));yield new k.OptimizedFeature(J?m(new l,J,A):null,v,null,C??void 0)}}function e(v){for(const A of v)if(2<A.length)return!0;return!1}function h(v){let A=0;for(let B=0;B<v.length;B++){const F=v[B],H=v[(B+1)%v.length];A+=F[0]*H[1]-H[0]*F[1]}return 0>=A}function x(v){const A=v[0],B=v[v.length-1];A[0]===B[0]&&A[1]===B[1]&&A[2]===B[2]||v.push(A);return v}function m(v,A,B){switch(A.type){case "LineString":return w(v,
A.coordinates,B),v;case "MultiLineString":for(const H of A.coordinates)w(v,H,B);return v;case "MultiPoint":return w(v,A.coordinates,B),v;case "MultiPolygon":for(var F of A.coordinates)for(p(v,F[0],B),A=1;A<F.length;A++)t(v,F[A],B);return v;case "Point":return y(v,A.coordinates,B),v;case "Polygon":F=A.coordinates;p(v,F[0],B);for(A=1;A<F.length;A++)t(v,F[A],B);return v}}function p(v,A,B){A=x(A);h(A)?w(v,A,B):r(v,A,B)}function t(v,A,B){A=x(A);h(A)?r(v,A,B):w(v,A,B)}function w(v,A,B){for(const F of A)y(v,
F,B);v.lengths.push(A.length)}function r(v,A,B){for(let F=A.length-1;0<=F;F--)y(v,A[F],B);v.lengths.push(A.length)}function y(v,A,B){const [F,H,J]=A;v.coords.push(F,H);B.hasZ&&v.coords.push(J||0)}function z(v){switch(typeof v){case "string":return q.isISO8601Date(v)?"esriFieldTypeDate":"esriFieldTypeString";case "number":return"esriFieldTypeDouble";default:return"unknown"}}const u={LineString:"esriGeometryPolyline",MultiLineString:"esriGeometryPolyline",MultiPoint:"esriGeometryMultipoint",Point:"esriGeometryPoint",
Polygon:"esriGeometryPolygon",MultiPolygon:"esriGeometryPolygon"};b.createOptimizedFeatures=function(v,A){return Array.from(c(f(v),A))};b.getGeometryType=function(v){return u[v]};b.inferLayerProperties=function(v,A={}){const B=[];var F=new Set;const H=new Set;var J=!1;let E=null,K=!1,C=void 0;({geometryType:A=null}=A);for(const D of f(v)){const {geometry:G,properties:N,id:Y}=D;if(G&&(A||=u[G.type],u[G.type]!==A))continue;J||(J=d(G),J=e(J));!K&&(K=null!=Y)&&(C=typeof Y,N&&(E=Object.keys(N).filter(ca=>
N[ca]===Y)));N&&E&&K&&null!=Y&&(1<E.length?E=E.filter(ca=>N[ca]===Y):1===E.length&&(E=N[E[0]]===Y?E:[]));if(N)for(const ca in N){if(F.has(ca))continue;v=z(N[ca]);if("unknown"===v){H.add(ca);continue}H.delete(ca);F.add(ca);const ka=a.normalizeFieldName(ca);ka&&B.push({name:ka,alias:ca,type:v})}}if(F=a.normalizeFieldName(1===E?.length&&E[0]||null)??void 0)for(const D of B)if(D.name===F&&a.isNumericField(D)){D.type="esriFieldTypeOID";break}return{fields:B,geometryType:A,hasZ:J,objectIdFieldName:F,objectIdFieldType:C,
unknownFields:Array.from(H)}};b.validateGeoJSON=function(v,A=4326){if(!v)throw new n("geojson-layer:empty","GeoJSON data is empty");if("Feature"!==v.type&&"FeatureCollection"!==v.type)throw new n("geojson-layer:unsupported-geojson-object","missing or not supported GeoJSON object type",{data:v});({crs:v}=v);if(v){var B="string"===typeof v?v:"name"===v.type?v.properties.name:"EPSG"===v.type?v.properties.code:null;A=g.isWGS84({wkid:A})?RegExp(".*(CRS84H?|4326)$","i"):new RegExp(`.*(${A})$`,"i");if(!B||
!A.test(B))throw new n("geojson:unsupported-crs","unsupported GeoJSON 'crs' member",{crs:v});}};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/core/date":function(){define(["exports"],function(b){function q(a){const f=new Date(a);if(Number.isNaN(f.getTime()))a=!1;else{var d=!0;if(l&&/\d+\W*$/.test(a)&&(a=a.match(/[a-zA-Z]{2,}/))){d=!1;let c=0;for(;!d&&c<=a.length;)d=!k.test(a[c]),c++;d=!d}a=d}return a?Number.isNaN(f.getTime())?null:f.getTime()-6E4*f.getTimezoneOffset():null}
function n(a){a=g.exec(a);if(!a?.groups)return null;a=a.groups;const f=+a.year,d=+a.month-1,c=+a.day,e=+(a.hours??0),h=+(a.minutes??0),x=+(a.seconds??0);if(23<e||59<h||59<x)return null;var m=a.ms??"0";m=m?+m.padEnd(3,"0").slice(0,3):0;a=a.isUTC||!a.offsetSign?Date.UTC(f,d,c,e,h,x,m):6E4*("+"===a.offsetSign?-1:1)*(60*+a.offsetHours+ +a.offsetMinutes)+Date.UTC(f,d,c,e,h,x,m);return Number.isNaN(a)?null:a}const g=/^(?:(?<year>-?\d{4,})-(?<month>\d{2})-(?<day>\d{2}))(?:T(?<hours>\d{2}):(?<minutes>\d{2}):(?<seconds>\d{2})(?:\.(?<ms>\d+))?)?(?:(?<isUTC>Z)|(?:(?<offsetSign>\+|-)(?<offsetHours>\d{2}):(?<offsetMinutes>\d{2})))?$/,
k=/^((jan(uary)?)|(feb(ruary)?)|(mar(ch)?)|(apr(il)?)|(may)|(jun(e)?)|(jul(y)?)|(aug(ust)?)|(sep(tember)?)|(oct(ober)?)|(nov(ember)?)|(dec(ember)?)|(am)|(pm)|(gmt)|(utc))$/i,l=!Number.isNaN((new Date("technology 10")).getTime());b.isDateString=function(a){return null!=n(a)||null!=q(a)};b.isISO8601Date=function(a){return g.test(a)};b.parseDate=function(a){return n(a)??q(a)};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/sources/support/clientSideDefaults":function(){define("exports ../../../../core/has ../../../../core/lang ../../data/QueryEngineCapabilities ../../../support/capabilities ../../../../symbols/support/defaultsJSON".split(" "),
function(b,q,n,g,k,l){function a(c){return f.test(c)?`.${c}`:`["${c}"]`}const f=/^[_$a-zA-Z][_$a-zA-Z0-9]*$/;let d=1;b.createCapabilities=function(c,e){return{analytics:{supportsCacheHint:!1},attachment:null,data:{isVersioned:!1,isBranchVersioned:!1,supportsAttachment:!1,supportsM:!1,supportsZ:c},metadata:{supportsAdvancedFieldProperties:!1},operations:{supportsCalculate:!1,supportsTruncate:!1,supportsValidateSql:!1,supportsAdd:e,supportsDelete:e,supportsEditing:e,supportsChangeTracking:!1,supportsQuery:!0,
supportsQueryBins:!1,supportsQueryAnalytics:!1,supportsQueryAttachments:!1,supportsQueryTopFeatures:!1,supportsResizeAttachments:!1,supportsSync:!1,supportsUpdate:e,supportsExceedsLimitStatistics:!0,supportsAsyncConvert3D:!1},query:g.queryCapabilities,queryRelated:{supportsCount:!0,supportsOrderBy:!0,supportsPagination:!0,supportsCacheHint:!1},queryTopFeatures:{supportsCacheHint:!1},queryBins:k.zeroQueryBins,editing:{supportsGeometryUpdate:e,supportsGlobalId:!1,supportsReturnServiceEditsInSourceSpatialReference:!1,
supportsRollbackOnFailure:!1,supportsUpdateWithoutM:!1,supportsUploadWithItemId:!1,supportsDeleteByAnonymous:!1,supportsDeleteByOthers:!1,supportsUpdateByAnonymous:!1,supportsUpdateByOthers:!1,supportsAsyncApplyEdits:!1,zDefault:void 0}}};b.createDefaultAttributesFunction=function(c,e){if(q("esri-csp-restrictions"))return()=>({[e]:null,...c});try{let h=`this${a(e)} = null;`;for(const m in c){const p=a(m);h+=`this${p} = ${JSON.stringify(c[m])};`}const x=(new Function(`\n      return class AttributesClass$${d++} {\n        constructor() {\n          ${h};\n        }\n      }\n    `))();
return()=>new x}catch(h){return()=>({[e]:null,...c})}};b.createDefaultTemplate=function(c={}){return[{name:"New Feature",description:"",prototype:{attributes:n.clone(c)}}]};b.createDrawingInfo=function(c){return{renderer:{type:"simple",symbol:"esriGeometryPoint"===c||"esriGeometryMultipoint"===c?l.defaultPointSymbolJSON:"esriGeometryPolyline"===c?l.defaultPolylineSymbolJSON:l.defaultPolygonSymbolJSON}}};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/capabilities":function(){define(["exports"],
function(b){const q={supportsDate:!1,supportsFixedInterval:!1,supportsAutoInterval:!1,supportsFixedBoundaries:!1,supportedStatistics:void 0};b.zeroCapabilities={analytics:{supportsCacheHint:!1},attachment:{supportsContentType:!1,supportsExifInfo:!1,supportsKeywords:!1,supportsName:!1,supportsSize:!1,supportsCacheHint:!1,supportsResize:!1},data:{isVersioned:!1,isBranchVersioned:!1,supportsAttachment:!1,supportsM:!1,supportsZ:!1},editing:{supportsDeleteByAnonymous:!1,supportsDeleteByOthers:!1,supportsGeometryUpdate:!1,
supportsGlobalId:!1,supportsReturnServiceEditsInSourceSpatialReference:!1,supportsRollbackOnFailure:!1,supportsUpdateByAnonymous:!1,supportsUpdateByOthers:!1,supportsUpdateWithoutM:!1,supportsUploadWithItemId:!1,supportsAsyncApplyEdits:!1,zDefault:void 0},metadata:{supportsAdvancedFieldProperties:!1},operations:{supportsCalculate:!1,supportsTruncate:!1,supportsValidateSql:!1,supportsAdd:!1,supportsDelete:!1,supportsEditing:!1,supportsChangeTracking:!1,supportsQuery:!1,supportsQueryAnalytics:!1,supportsQueryAttachments:!1,
supportsQueryBins:!1,supportsQueryTopFeatures:!1,supportsResizeAttachments:!1,supportsSync:!1,supportsUpdate:!1,supportsExceedsLimitStatistics:!1,supportsAsyncConvert3D:!1},queryRelated:{supportsCount:!1,supportsOrderBy:!1,supportsPagination:!1,supportsCacheHint:!1},queryTopFeatures:{supportsCacheHint:!1},queryBins:q,query:{maxRecordCount:0,maxRecordCountFactor:0,standardMaxRecordCount:0,supportsCacheHint:!1,supportsCentroid:!1,supportsCompactGeometry:!1,supportsDefaultSpatialReference:!1,supportsFullTextSearch:!1,
supportsDisjointSpatialRelationship:!1,supportsDistance:!1,supportsDistinct:!1,supportsExtent:!1,supportsFormatPBF:!1,supportsGeometryProperties:!1,supportsHavingClause:!1,supportsHistoricMoment:!1,supportsMaxRecordCountFactor:!1,supportsOrderBy:!1,supportsPagination:!1,supportsPercentileStatistics:!1,supportsQuantization:!1,supportsQuantizationEditMode:!1,supportsQueryByAnonymous:!1,supportsQueryByOthers:!1,supportsQueryGeometry:!1,supportsResultType:!1,supportsSqlExpression:!1,supportsStandardizedQueriesOnly:!1,
supportsTopFeaturesQuery:!1,supportsSpatialAggregationStatistics:!1,supportedSpatialAggregationStatistics:{envelope:!1,centroid:!1,convexHull:!1},supportsStatistics:!1,tileMaxRecordCount:0}};b.zeroQueryBins=q;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/sources/support/sourceUtils":function(){define(["require","exports","../../../../core/date","../../../../geometry/support/spatialReferenceUtils","../../../support/fieldUtils"],function(b,q,n,g,k){function l(x){return new d(x)}
async function a(){null==h&&(h=await new Promise((x,m)=>b(["../../../../geometry/geometryEngineJSON"],x,m)));return h}class f{constructor(){this.description=this.code=null}}class d{constructor(x){this.error=new f;this.objectId=this.globalId=null;this.success=!1;this.uniqueId=null;this.error.description=x}}class c{constructor(x){this.globalId=null;this.success=!0;this.objectId=this.uniqueId=x}}const e=new Set;let h;q.createFeatureEditErrorResult=l;q.createFeatureEditSuccessResult=function(x){return new c(x)};
q.loadGeometryEngineForSimplify=async function(x,m){!g.isValid(x)||"esriGeometryPolygon"!==m&&"esriGeometryPolyline"!==m||await a()};q.mixAttributes=function(x,m,p,t=!1){e.clear();for(const y in p){const z=x.get(y);if(!z)continue;var w=z,r=p[y];let u=r;k.isNumericField(w)&&"string"===typeof r?u=parseFloat(r):k.isStringField(w)&&null!=r&&"string"!==typeof r?u=String(r):k.isDateField(w)&&"string"===typeof r&&(u=n.parseDate(r));w=k.sanitizeNullFieldValue(u);e.add(z.name);if(z&&(t||z.editable)){if(r=
k.validateFieldValue(z,w))return l(k.validationErrorToString(r,z,w));m[z.name]=w}}for(const y of x.requiredFields??[])if(!e.has(y.name))return l(`missing required field "${y.name}"`);return null};q.simplify=function(x,m){if(!x||!g.isValid(m))return x;if("rings"in x||"paths"in x){if(null==h)throw new TypeError("geometry engine not loaded");return h.simplify(m,x)}return x};Object.defineProperty(q,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/support/FeatureSetReaderPBF":function(){define("exports ../../../../../core/Error ../../../../../core/has ../../../../../core/Logger ../../../../../core/maybe ../../../../../core/pbf ../../../../../layers/graphics/OptimizedGeometry ./FeatureSetCache ./FeatureSetReader ./FeatureSetReaderPBFHeader".split(" "),
function(b,q,n,g,k,l,a,f,d,c){function e(t){if(t<=m.small.delta.length)return m.small;if(t<=m.large.delta.length)return m.large;m.large.delta=new Int32Array(Math.round(1.25*t));m.large.decoded=new Int32Array(Math.round(1.25*t));return m.large}function h(t){var w=t.getLength();for(w=t.pos()+w;t.pos()<w&&t.next();)switch(t.tag()){case 1:return t.getString();case 2:return t.getFloat();case 3:return t.getDouble();case 4:return t.getSInt32();case 5:return t.getUInt32();case 6:return t.getInt64();case 7:return t.getUInt64();
case 8:return t.getSInt64();case 9:return t.getBool();default:return t.skip(),null}return null}function x(t,w,r,y,z){return t?0===w*z-y*r&&0<w*y+r*z:!1}const m={small:{delta:new Int32Array(128),decoded:new Int32Array(128)},large:{delta:new Int32Array(128E3),decoded:new Int32Array(128E3)}};class p extends d.FeatureSetReader{static fromBuffer(t,w,r=!1){const y=w.geometryType;a:{try{const v=new l(new Uint8Array(t),new DataView(t));for(;v.next();)switch(v.tag()){case 2:b:{for(var z=v.getMessage();z.next();)switch(z.tag()){case 1:var u=
z.getMessage();break b;default:z.skip()}u=null}break a;default:v.skip()}}catch(v){t=new q("query:parsing-pbf","Error while parsing FeatureSet PBF payload",{error:v}),g.getLogger("esri.view.2d.layers.features.support.FeatureSetReaderPBF").error(t)}u=null}t=u;r=c.parseHeader(t,"esriGeometryPoint"===y,r);return new p(t,r,w)}constructor(t,w,r){super(r);this._isPoints=this._hasNext=!1;this._featureIndex=-1;this._featureOffset=0;this._cache={area:0,unquantGeometry:void 0,geometry:void 0,centroid:void 0,
legacyFeature:void 0,optFeature:void 0};this._parseCaches=[];this._geometryType=r.geometryType;this._reader=t;this._header=w;this._hasNext=w.hasFeatures;this._isPoints="esriGeometryPoint"===r.geometryType}get _size(){return this._header.featureCount}get fields(){return this._header.fields}get geometryType(){return this._geometryType}get hasZ(){return!1}get hasM(){return!1}get hasFeatures(){return this._header.hasFeatures}get hasNext(){return this._hasNext}get exceededTransferLimit(){return this._header.exceededTransferLimit}getSize(){return this._size}getInTransform(){return this._header.transform}getCursor(){return this.copy()}getIndex(){return this._featureIndex}setIndex(t){this._cache.area=
0;this._cache.unquantGeometry=void 0;this._cache.geometry=void 0;this._cache.centroid=void 0;this._cache.legacyFeature=void 0;this._cache.optFeature=void 0;this._featureIndex=t}getAttributeHash(){let t="";for(const w of this._header.fields.fields)t+=this._readAttributeAtIndex(w.index)+".";return t}getObjectId(){return this._readAttributeAtIndex(this._header.objectIdFieldIndex)}getDisplayId(){return this._header.displayIds[this._featureIndex]}setDisplayId(t){this._header.displayIds[this._featureIndex]=
t}readGeometryArea(){this._cache.area||this._readGeometry(!0);return this._cache.area}copy(){var t=this._reader.clone();t=new p(t,this._header,this.metadata);this.copyInto(t);return t}next(){this._cache.area=0;this._cache.unquantGeometry=void 0;this._cache.geometry=void 0;this._cache.centroid=void 0;this._cache.legacyFeature=void 0;for(this._cache.optFeature=void 0;++this._featureIndex<this._size&&!this._getExists(););return this._featureIndex<this._size}_readX(){return this._header.centroid[2*this._featureIndex]}_readY(){return this._header.centroid[2*
this._featureIndex+1]}_readServerCentroid(){const t=this._header.centroid[2*this._featureIndex];return 268435455===t?null:new a([],[t,this._header.centroid[2*this._featureIndex+1]])}_readGeometry(t=!1){if(void 0===this._cache.geometry){let w=null;if(this._isPoints){if(268435455===this._header.centroid[2*this._featureIndex])return null;w=new a([],[this._header.centroid[2*this._featureIndex],this._header.centroid[2*this._featureIndex+1]])}else{const r=this._header.offsets.geometry[this._featureIndex],
y=this._reader;if(0===r)return null;y.move(r);try{w=t?this._parseGeometryForDisplay(y):this._parseGeometry(y)}catch(z){return null}}0===w?.coords.length&&(w=null);return this._cache.geometry=w}return this._cache.geometry}_readAttribute(t,w){var r=this._header.fields.get(t);if(null!=r)return t=this._readAttributeAtIndex(r.index),r=this._header.fields.isDateField(r.name),w&&null!=t?r?new Date(t):t:t}_readAttributes(){const t={};for(const w of this._header.fields.fields)t[w.name]=this._readAttributeAtIndex(w.index);
return t}copyInto(t){super.copyInto(t);t._featureIndex=this._featureIndex;t._featureOffset=this._featureOffset;t._hasNext=this._hasNext;t._parseCaches=this._parseCaches}_readAttributeAtIndex(t){let w=this._parseCaches[t];w||(w=new f.FeatureSetCache(this.getSize()),this._parseCaches[t]=w);if(w.has(this._featureIndex))return w.get(this._featureIndex);const r=this._reader;r.move(this._header.offsets.attributes[this._featureIndex*this._header.fieldCount+t]);t=h(r);w.set(this._featureIndex,t);return t}_readGeometryDeltaDecoded(t=
!1){if(void 0===this._cache.unquantGeometry){t=this._readGeometry(t);if(!t)return this._cache.unquantGeometry=void 0,null;if(!this.getInTransform())return this._cache.unquantGeometry=t;var w=e(t.coords.length).decoded;t=t.clone(w);w=t.coords;let r=0;for(const y of t.lengths){for(let z=1;z<y;z++){const u=2*(r+z),v=2*(r+z-1);w[u]+=w[v];w[u+1]+=w[v+1]}r+=y}return this._cache.unquantGeometry=t}return this._cache.unquantGeometry}_parseGeometry(t){t=t.asUnsafe();var w=t.getLength();w=t.pos()+w;const r=
[],y=[];for(;t.pos()<w&&t.next();)switch(t.tag()){case 2:var z=t.getUInt32();for(z=t.pos()+z;t.pos()<z;)y.push(t.getUInt32());break;case 3:z=t.getUInt32();z=t.pos()+z;r.push(t.getSInt64());r.push(t.getSInt64());this.hasZ&&t.getSInt64();for(this.hasM&&t.getSInt64();t.pos()<z;)r.push(t.getSInt64()),r.push(t.getSInt64()),this.hasZ&&t.getSInt64(),this.hasM&&t.getSInt64();break;default:t.skip()}return new a(y,r)}_parseGeometryForDisplay(t){t=t.asUnsafe();var w=t.getLength();w=t.pos()+w;const r=[],y=[];
let z=0,u=0;var v=null;let A=0;const B="esriGeometryPolygon"===this.geometryType;var F="esriGeometryPolyline"===this.geometryType;for(F=B||F;t.pos()<w&&t.next();)switch(t.tag()){case 2:v=t.getUInt32();for(v=t.pos()+v;t.pos()<v;){var H=t.getUInt32();r.push(H);z+=H}v=e(2*z).delta;break;case 3:t.getUInt32();H=2+(this.hasZ?1:0)+(this.hasM?1:0);k.assertIsSome(v);for(const ca of r)if(u+H*ca>v.length)for(var J=0;J<ca;J++)t.getSInt32(),t.getSInt32(),this.hasZ&&t.getSInt32(),this.hasM&&t.getSInt32();else if(B){J=
this.getAreaSimplificationThreshold(ca,this._header.vertexCount);var E=2,K=1,C=t.getSInt32(),D=t.getSInt32();v[u++]=C;v[u++]=D;this.hasZ&&t.getSInt32();this.hasM&&t.getSInt32();var G=t.getSInt32(),N=t.getSInt32();this.hasZ&&t.getSInt32();for(this.hasM&&t.getSInt32();E<ca;){var Y=t.getSInt32();let ka=t.getSInt32();this.hasZ&&t.getSInt32();this.hasM&&t.getSInt32();const Q=C+G,R=D+N,Z=Q+Y,da=R+ka;.5*Math.abs(C*R+Q*da+Z*D-C*da-Q*D-Z*R)>=J?(A+=-.5*(Q-C)*(R+D),1<K&&x(F,v[u-2],v[u-1],G,N)?(v[u-2]+=G,v[u-
1]+=N):(v[u++]=G,v[u++]=N,K++),C=Q,D=R):(Y+=G,ka+=N);G=Y;N=ka;E++}3>K?u-=2*K:(A+=-.5*(C+G-C)*(D+N+D),x(F,v[u-2],v[u-1],G,N)?(v[u-2]+=G,v[u-1]+=N,y.push(K)):(v[u++]=G,v[u++]=N,y.push(++K)))}else{J=0;E=t.getSInt32();K=t.getSInt32();this.hasZ&&t.getSInt32();this.hasM&&t.getSInt32();v[u++]=E;v[u++]=K;J+=1;for(C=1;C<ca;C++)D=t.getSInt32(),G=t.getSInt32(),N=E+D,Y=K+G,A+=-.5*(N-E)*(Y+K),this.hasZ&&t.getSInt32(),this.hasM&&t.getSInt32(),2<C&&x(F,v[u-2],v[u-1],D,G)?(v[u-2]+=D,v[u-1]+=G):(v[u++]=D,v[u++]=G,
J+=1),E=N,K=Y;y.push(J)}break;default:t.skip()}this._cache.area=A;return y.length?new a(y,v):null!=v?this._createQuantizedExtrudedGeometry(v[0],v[1]):null}}b.FeatureSetReaderPBF=p;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/support/FeatureSetReaderPBFHeader":function(){define(["exports","../../../../../core/Error","../../../../../layers/support/FieldsIndex","../../../../../rest/query/operations/pbfFeatureServiceParser"],function(b,q,n,g){class k{constructor(){this.exceededTransferLimit=
this.hasFeatures=!1;this.vertexCount=this.objectIdFieldIndex=this.featureCount=this.fieldCount=0;this.offsets={attributes:[],geometry:[]};this.centroid=[]}}b.FeatureSetHeader=k;b.parseHeader=function(l,a,f=!1){l=l.asUnsafe();const d=l.pos(),c=new k;let e=0,h=0,x=null,m=null,p=null,t=!1;const w=[];for(;l.next();)switch(l.tag()){case 1:x=l.getString();break;case 3:m=l.getString();break;case 12:p=l.processMessage(g.parseTransform);break;case 9:c.exceededTransferLimit=l.getBool();if(c.exceededTransferLimit){c.offsets.geometry=
f?new Float64Array(8E3):new Int32Array(8E3);c.centroid=f?new Float64Array(16E3):new Int32Array(16E3);for(var r=0;r<c.centroid.length;r++)c.centroid[r]=268435455}break;case 13:r=l.processMessage(g.parseField);r.index=e++;w.push(r);break;case 15:r=l.getLength();r=l.pos()+r;if(!c.exceededTransferLimit){var y=c.centroid;c.offsets.geometry.push(0);y.push(268435455);y.push(268435455)}!t&&c.exceededTransferLimit&&(t=!0,c.offsets.attributes=f?new Float64Array(8E3*e):new Uint32Array(8E3*e));for(y=h*e;l.pos()<
r&&l.next();)switch(l.tag()){case 1:t?c.offsets.attributes[y++]=l.pos():c.offsets.attributes.push(l.pos());var z=l.getLength();l.skipLen(z);break;case 2:if(a)for(z=l.getLength(),z=l.pos()+z;l.pos()<z&&l.next();)switch(l.tag()){case 3:l.getUInt32();var u=l.getSInt64(),v=l.getSInt64();c.centroid[2*h]=u;c.centroid[2*h+1]=v;break;default:l.skip()}else c.offsets.geometry[h]=l.pos(),z=l.getLength(),c.vertexCount+=z,l.skipLen(z);break;case 4:z=l.getLength();for(z=l.pos()+z;l.pos()<z&&l.next();)switch(l.tag()){case 3:l.getUInt32();
u=l.getSInt64();v=l.getSInt64();c.centroid[2*h]=u;c.centroid[2*h+1]=v;break;default:l.skip()}break;default:l.skip()}h++;c.hasFeatures=!0;break;default:l.skip()}a=x||m;if(!a)throw new q("FeatureSet has no objectId or globalId field name");c.fields=new n(w);c.featureCount=h;c.fieldCount=e;c.objectIdFieldIndex=c.fields.get(a)?.index;c.transform=p;c.displayIds=new Uint32Array(c.featureCount);c.groupIds=new Uint16Array(c.featureCount);l.move(d);return c};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},
"esri/views/2d/layers/features/sources/strategies/chunks/DrillDownTileSourceChunk":function(){define(["exports","./ASourceChunk"],function(b,q){class n extends q.ASourceChunk{constructor(g,k,l,a,f,d){super();this._reader=g;this._queryJSON=k;this._tile=l;this._sourceTile=a;this._sourceTileDepth=f;this._end=d;this.chunkId=`${this._tile.key.id}.${this._sourceTile?.key.id}${this._end?"e":""}`;this.normalizedChunkId=`${this._tile.key.normalizedId}.${this._sourceTile?.key.normalizedId}${this._end?"e":""}`}get queryInfo(){return{type:"drill-down-tile",
chunkId:this.chunkId,tileId:this._tile.key.id,queryJSON:this._queryJSON,sourceTileDepth:this._sourceTileDepth,sourceTileId:this._sourceTile?.key.id,size:this.size(),end:this.end}}get first(){return 0===this._sourceTileDepth}get reader(){return this._reader}get end(){return this._end}get tile(){return this._tile}get isTiled(){return!0}getTileReader(g){return this._tile.key.id===g.key.id?this.reader:null}}b.DrillDownTileSourceChunk=n;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/sources/strategies/PagedTileLoadStrategy":function(){define("exports ../../../../../../core/handleUtils ../../../../../../core/promiseUtils ./ATileLoadStrategy ./chunks/PagedTileSourceChunk ../../support/FeatureSetReaderJSON".split(" "),
function(b,q,n,g,k,l){class a{constructor(d,c){this.subscription=d;this._pages=new Set;this._controller=new AbortController;this._done=!1;this._handles=q.handlesGroup([n.onAbort(d.signal,()=>this._controller.abort()),n.onAbort(c,()=>this._controller.abort())])}destroy(){this._controller.abort();this._handles.remove()}get pageStart(){let d=-1;for(const c of this._pages.values())d=Math.max(d,c);return d+1}get done(){return this._done}get options(){return{signal:this._controller.signal}}add(d,c){this._pages.add(d);
this._done=this._done||c}}class f extends g.ATileLoadStrategy{constructor(){super(...arguments);this._loadStates=new Map}destroy(){super.destroy();for(const d of this._loadStates.values())d.destroy();this._loadStates.clear()}get about(){return{willQueryAllFeatures:!1,willQueryFullResolutionGeometry:!1}}async load(d){this._loadStates.has(d.key.id)||this._loadStates.set(d.key.id,new a(d,this._options));const c=this._loadStates.get(d.key.id);let e;try{await this._fetchPages(c)}catch(h){e=h}d=new k.PagedTileSourceChunk(l.FeatureSetReaderJSON.empty(this._metadata),
null,d.tile,-1,!0);n.isAborted(c.options)||this._addChunk(d);if(e)throw e;}unload(d){super.unload(d);this._loadStates.get(d.key.id)?.destroy();this._loadStates.delete(d.key.id)}async _fetchPages(d){let c=0,e=d.pageStart,h=1;for(;20>c&&!d.done;){var x=[];for(let m=0;m<h;m++)x.push(this._fetchChunk(d,e++));x=await Promise.all(x);for(const m of x)if(0!==m.size()||m.first)d.add(m.page,!m.reader.exceededTransferLimit),n.throwIfAborted(d.options),this._addChunk(m);c++;h=Math.min(h+1,4)}}async _fetchChunk(d,
c){const e=d.subscription.tile,h=this._queryInfo.createPagedTileQuery(e,c);d=await this._fetch(h,d.options);return new k.PagedTileSourceChunk(d,h.inner.toJSON(),e,c,!1)}}b.PagedTileLoadStrategy=f;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/sources/strategies/chunks/PagedTileSourceChunk":function(){define(["exports","./ASourceChunk"],function(b,q){class n extends q.ASourceChunk{constructor(g,k,l,a,f){super();this._reader=g;this._queryJSON=k;this._tile=
l;this._page=a;this._end=f;this.chunkId=`${this._tile.key.id}.${this._page}${this.end?"e":""}`;this.normalizedChunkId=`${this._tile.key.normalizedId}.${this._page}${this.end?"e":""}`}get queryInfo(){return{type:"paged-tile",chunkId:this.chunkId,tileId:this._tile.key.id,queryJSON:this._queryJSON,page:this._page,size:this.size(),end:this.end}}get reader(){return this._reader}get first(){return 0===this._page}get end(){return this._end}get page(){return this._page}get tile(){return this._tile}get isTiled(){return!0}getTileReader(g){return this._tile.key.id===
g.key.id?this.reader:null}}b.PagedTileSourceChunk=n;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/sources/strategies/ParquetLoadStrategy":function(){define("exports ../../../../../../core/promiseUtils ../../../../../../core/SetUtils ../../../../../../layers/support/FieldsIndex ../../../../../../libs/parquet/parquet ./ALoadStrategy ./chunks/FeatureSnapshotSourceChunk ../../support/FeatureSetReaderJSON ../../support/FeatureSetReaderParquet".split(" "),
function(b,q,n,g,k,l,a,f,d){class c extends l.ALoadStrategy{constructor(e,h,x,m){super(m);this._service=e;this._metadata=h;this._schema=x;this._chunkId=0;this._files=[];this._availableFields=new Set(x.mutable.availableFields);({geometryInfo:e}=this._service);"location"===e.type?(this._availableFields.add(e.latitudeFieldName),this._availableFields.add(e.longitudeFieldName)):this._availableFields.add(e.primaryFieldName)}destroy(){for(const e of this._files)e.destroy()}get about(){return{willQueryAllFeatures:!0,
willQueryFullResolutionGeometry:!0}}async updateFields(e){await this._promise;e=new Set(e);const h=n.difference(e,this._availableFields);this._availableFields=n.union(h,this._availableFields);await Promise.all(this._files.map(x=>{const m=Array.from(h).map(p=>x.metadata.getFieldIndex(p));return x.inner.updateChunks(new Uint16Array(m))}))}async load(e){null==this._promise&&(this._promise=this._download());return this._promise}unload(e){}async addParquetFile(e){this._insert(e)}async _insert(e){const h=
await k.ParquetFile.create(e,{geometryInfo:this._service.geometryInfo,outSpatialReference:this._service.outSpatialReference,getCustomParameters:()=>this._schema.mutable.dataFilter.customParameters}),{geometryInfo:x}=this._service;q.throwIfAborted(this._options);const {fields:m,timeZoneByFieldName:p}=this._service.metadata.fieldsIndex;e=m.map(w=>({...w,index:h.metadata.getFieldIndex(w.name)}));const t=g.fromJSON({fields:e,timeZoneByFieldName:p});e=new Uint16Array(Array.from(this._availableFields.values()).map(w=>
t.get(w)?.index));await h.inner.readChunksWithCallback(e,w=>{var r=this._chunkId++;w=new d.FeatureSetReaderParquet(this._metadata,t,x,w,r);r=new a.FeatureSnapshotSourceChunk(w,null,r,!1);this._store.insert(r)});this._files.push(h)}async _download(){try{await Promise.all(this._service.source.urls.map(h=>this._insert(h)));const e=new a.FeatureSnapshotSourceChunk(f.FeatureSetReaderJSON.empty(this._metadata),null,-1,!0);this._store.insert(e)}catch(e){throw console.error(e),e;}}}b.ParquetLoadStrategy=
c;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/libs/parquet/parquet":function(){define(["exports","../../assets","../../request"],function(b,q,n){function g(L){const T=A[L];132>L||(A[L]=B,B=L);return T}function k(L){B===A.length&&A.push(A.length+1);const T=B;B=A[T];A[T]=L;return T}function l(){if(null===H||0===H.byteLength)H=new Uint8Array(v.memory.buffer);return H}function a(L,T){L>>>=0;return F.decode(l().subarray(L,L+T))}function f(L,T,ha,oa){const S={a:L,b:T,cnt:1,dtor:ha};
L=(...X)=>{S.cnt++;const ba=S.a;S.a=0;try{return oa(ba,S.b,...X)}finally{0===--S.cnt?(v.__wbindgen_export_0.get(S.dtor)(ba,S.b),J.unregister(S)):S.a=ba}};L.original=S;J.register(L,S,S);return L}function d(L,T,ha){v._dyn_core__ops__function__FnMut__A____Output___R_as_wasm_bindgen__closure__WasmClosure___describe__invoke__h7be72b1871260ae2(L,T,k(ha))}function c(L,T,ha){if(void 0===ha){ha=K.encode(L);var oa=T(ha.length,1)>>>0;l().subarray(oa,oa+ha.length).set(ha);E=ha.length;return oa}oa=L.length;T=
T(oa,1)>>>0;var S=l();let X=0;for(;X<oa;X++){const ba=L.charCodeAt(X);if(127<ba)break;S[T+X]=ba}X!==oa&&(0!==X&&(L=L.slice(X)),T=ha(T,oa,oa=X+3*L.length,1)>>>0,S=l().subarray(T+X,T+oa),L=C(L,S),X+=L.written,T=ha(T,oa,X,1)>>>0);E=X;return T}function e(){if(null===D||!0===D.buffer.detached||void 0===D.buffer.detached&&D.buffer!==v.memory.buffer)D=new DataView(v.memory.buffer);return D}function h(L,T){try{return L.apply(this,T)}catch(ha){v.__wbindgen_exn_store(k(ha))}}function x(L,T){T=T(2*L.length,
2)>>>0;if(null===G||0===G.byteLength)G=new Uint16Array(v.memory.buffer);G.set(L,T/2);E=L.length;return T}function m(L,T,ha){L=c(L,v.__wbindgen_malloc,v.__wbindgen_realloc);T=v.readMetadata(L,E,k(T),k(ha));return g(T)}function p(L,T){if(!(L instanceof T))throw Error(`expected instance of ${T.name}`);return L.ptr}async function t(L,T){if("function"===typeof Response&&L instanceof Response){if("function"===typeof WebAssembly.instantiateStreaming)try{return await WebAssembly.instantiateStreaming(L,T)}catch(ha){if("application/wasm"!=
L.headers.get("Content-Type"))console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",ha);else throw ha;}L=await L.arrayBuffer();return await WebAssembly.instantiate(L,T)}T=await WebAssembly.instantiate(L,T);return T instanceof WebAssembly.Instance?{instance:T,module:L}:T}function w(){const L={wbg:{}};L.wbg.__wbg_new_abda76e883ba8a5f=function(){return k(Error())};
L.wbg.__wbg_stack_658279fe44541cf6=function(T,ha){ha=c(A[ha].stack,v.__wbindgen_malloc,v.__wbindgen_realloc);const oa=E;e().setInt32(T+4,oa,!0);e().setInt32(T+0,ha,!0)};L.wbg.__wbg_error_f851667af71bcfc6=function(T,ha){let oa,S;try{oa=T,S=ha,console.error(a(T,ha))}finally{v.__wbindgen_free(oa,S,1)}};L.wbg.__wbindgen_object_drop_ref=function(T){g(T)};L.wbg.__wbindgen_is_function=function(T){return"function"===typeof A[T]};L.wbg.__wbg_self_3093d5d1f7bcb682=function(){return h(function(){return k(self.self)},
arguments)};L.wbg.__wbg_window_3bcfc4d31bc012f8=function(){return h(function(){return k(window.window)},arguments)};L.wbg.__wbg_globalThis_86b222e13bdf32ed=function(){return h(function(){return k(globalThis.globalThis)},arguments)};L.wbg.__wbg_global_e5a3fe56f8be9485=function(){return h(function(){return k(global.global)},arguments)};L.wbg.__wbindgen_is_undefined=function(T){return void 0===A[T]};L.wbg.__wbg_newnoargs_76313bd6ff35d0f2=function(T,ha){T=new Function(a(T,ha));return k(T)};L.wbg.__wbindgen_object_clone_ref=
function(T){return k(A[T])};L.wbg.__wbindgen_number_new=function(T){return k(T)};L.wbg.__wbg_new_525245e2b9901204=function(){return k({})};L.wbg.__wbindgen_string_new=function(T,ha){T=a(T,ha);return k(T)};L.wbg.__wbg_call_1084a111329e68ce=function(){return h(function(T,ha){T=A[T].call(A[ha]);return k(T)},arguments)};L.wbg.__wbg_call_89af060b4e1523f2=function(){return h(function(T,ha,oa){T=A[T].call(A[ha],A[oa]);return k(T)},arguments)};L.wbg.__wbg_call_7de908392845a9a5=function(){return h(function(T,
ha,oa,S,X){T=A[T].call(A[ha],A[oa],A[S],A[X]);return k(T)},arguments)};L.wbg.__wbg_valueOf_563b3487b1b116aa=function(T){return A[T].valueOf()};L.wbg.__wbg_set_eacc7d73fefaafdf=function(){return h(function(T,ha,oa){return Reflect.set(A[T],A[ha],A[oa])},arguments)};L.wbg.__wbg_buffer_b7b08af79b0b0974=function(T){return k(A[T].buffer)};L.wbg.__wbg_new_b85e72ed1bfd57f9=function(T,ha){try{var oa=T;var S=ha;const X=new Promise((ba,la)=>{const pa=oa;oa=0;try{v.wasm_bindgen__convert__closures__invoke2_mut__h35729c14da098d24(pa,
S,k(ba),k(la))}finally{oa=pa}});return k(X)}finally{oa=S=0}};L.wbg.__wbg_resolve_570458cb99d56a43=function(T){T=Promise.resolve(A[T]);return k(T)};L.wbg.__wbg_then_95e6edc0f89b73b1=function(T,ha){T=A[T].then(A[ha]);return k(T)};L.wbg.__wbg_then_876bb3c633745cc6=function(T,ha,oa){T=A[T].then(A[ha],A[oa]);return k(T)};L.wbg.__wbg_new_ea1883e1e5e86686=function(T){T=new Uint8Array(A[T]);return k(T)};L.wbg.__wbg_length_8339fcf5d8ecd12e=function(T){return A[T].length};L.wbg.__wbg_set_d1e79e2388520f18=function(T,
ha,oa){A[T].set(A[ha],oa>>>0)};L.wbg.__wbindgen_throw=function(T,ha){throw Error(a(T,ha));};L.wbg.__wbindgen_memory=function(){return k(v.memory)};L.wbg.__wbg_queueMicrotask_48421b3cc9052b68=function(T){return k(A[T].queueMicrotask)};L.wbg.__wbindgen_cb_drop=function(T){T=g(T).original;return 1==T.cnt--?(T.a=0,!0):!1};L.wbg.__wbg_queueMicrotask_12a30234db4045d3=function(T){queueMicrotask(A[T])};L.wbg.__wbg_parquetchunk_new=function(T){T=da.__wrap(T);return k(T)};L.wbg.__wbindgen_bigint_from_i64=function(T){return k(T)};
L.wbg.__wbg_parquetfile_new=function(T){T=W.__wrap(T);return k(T)};L.wbg.__wbg_filemetadata_new=function(T){T=ka.__wrap(T);return k(T)};L.wbg.__wbindgen_closure_wrapper1401=function(T,ha,oa){T=f(T,ha,74,d);return k(T)};return L}function r(L,T){v=L.exports;y.__wbindgen_wasm_module=T;H=G=D=null;return v}async function y(L){if(void 0!==v)return v;"undefined"!==typeof L&&Object.getPrototypeOf(L)===Object.prototype?{module_or_path:L}=L:console.warn("using deprecated parameters for the initialization function; pass a single object instead");
const T=w();if("string"===typeof L||"function"===typeof Request&&L instanceof Request||"function"===typeof URL&&L instanceof URL)L=fetch(L);const {instance:ha,module:oa}=await t(await L,T);return r(ha,oa)}async function z(){sa||=u();return sa}async function u(){const L=await Promise.resolve().then(()=>qa);await L.default({module_or_path:q.getAssetUrl("esri/libs/parquet/pkg/arcgis_parquet_bg.wasm")});L.enableTracing();return L}let v;const A=Array(128).fill(void 0);A.push(void 0,null,!0,!1);let B=A.length;
const F="undefined"!==typeof TextDecoder?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available");}};"undefined"!==typeof TextDecoder&&F.decode();let H=null;const J="undefined"===typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(L=>{v.__wbindgen_export_0.get(L.dtor)(L.a,L.b)});let E=0;const K="undefined"!==typeof TextEncoder?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available");}},C="function"===
typeof K.encodeInto?function(L,T){return K.encodeInto(L,T)}:function(L,T){const ha=K.encode(L);T.set(ha);return{read:L.length,written:ha.length}};let D=null,G=null;const N="undefined"===typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(L=>v.__wbg_fieldmetadata_free(L>>>0,1));class Y{static __wrap(L){L>>>=0;const T=Object.create(Y.prototype);T.__wbg_ptr=L;N.register(T,T.__wbg_ptr,T);return T}__destroy_into_raw(){const L=this.__wbg_ptr;this.__wbg_ptr=0;N.unregister(this);
return L}free(){const L=this.__destroy_into_raw();v.__wbg_fieldmetadata_free(L,0)}get name(){let L,T;try{const S=v.__wbindgen_add_to_stack_pointer(-16);v.fieldmetadata_name(S,this.__wbg_ptr);var ha=e().getInt32(S+0,!0),oa=e().getInt32(S+4,!0);L=ha;T=oa;return a(ha,oa)}finally{v.__wbindgen_add_to_stack_pointer(16),v.__wbindgen_free(L,T,1)}}get index(){return v.fieldmetadata_index(this.__wbg_ptr)}get type(){return"esriFieldTypeSmallInteger esriFieldTypeInteger esriFieldTypeBigInteger esriFieldTypeSingle esriFieldTypeDouble esriFieldTypeLong esriFieldTypeString esriFieldTypeDate esriFieldTypeOID esriFieldTypeGeometry esriFieldTypeBlob esriFieldTypeRaster esriFieldTypeGUID esriFieldTypeGlobalID esriFieldTypeXML esriFieldTypeDateOnly esriFieldTypeTimeOnly esriFieldTypeTimestampOffset".split(" ")[v.fieldmetadata_esri_type(this.__wbg_ptr)]}}
const ca="undefined"===typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(L=>v.__wbg_filemetadata_free(L>>>0,1));class ka{static __wrap(L){L>>>=0;const T=Object.create(ka.prototype);T.__wbg_ptr=L;ca.register(T,T.__wbg_ptr,T);return T}__destroy_into_raw(){const L=this.__wbg_ptr;this.__wbg_ptr=0;ca.unregister(this);return L}free(){const L=this.__destroy_into_raw();v.__wbg_filemetadata_free(L,0)}version(){return v.filemetadata_version(this.__wbg_ptr)}numRows(){return v.filemetadata_numRows(this.__wbg_ptr)>>>
0}numFields(){return v.filemetadata_numFields(this.__wbg_ptr)>>>0}keyValueMetadata(L){try{const oa=v.__wbindgen_add_to_stack_pointer(-16),S=c(L,v.__wbindgen_malloc,v.__wbindgen_realloc);v.filemetadata_keyValueMetadata(oa,this.__wbg_ptr,S,E);var T=e().getInt32(oa+0,!0),ha=e().getInt32(oa+4,!0);let X;0!==T&&(X=a(T,ha).slice(),v.__wbindgen_free(T,1*ha,1));return X}finally{v.__wbindgen_add_to_stack_pointer(16)}}getFieldIndex(L){L=c(L,v.__wbindgen_malloc,v.__wbindgen_realloc);L=v.filemetadata_getFieldIndex(this.__wbg_ptr,
L,E);return 16777215===L?void 0:L}getFieldByIndex(L){L=v.filemetadata_getFieldByIndex(this.__wbg_ptr,L);return 0===L?void 0:Y.__wrap(L)}}const Q="undefined"===typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(L=>v.__wbg_geometryinfodescriptor_free(L>>>0,1));class R{static __wrap(L){L>>>=0;const T=Object.create(R.prototype);T.__wbg_ptr=L;Q.register(T,T.__wbg_ptr,T);return T}__destroy_into_raw(){const L=this.__wbg_ptr;this.__wbg_ptr=0;Q.unregister(this);return L}free(){const L=
this.__destroy_into_raw();v.__wbg_geometryinfodescriptor_free(L,0)}get wkbIndex(){const L=v.__wbg_get_geometryinfodescriptor_wkbIndex(this.__wbg_ptr);return 16777215===L?void 0:L}set wkbIndex(L){v.__wbg_set_geometryinfodescriptor_wkbIndex(this.__wbg_ptr,void 0===L||null===L?16777215:L)}get lngIndex(){const L=v.__wbg_get_geometryinfodescriptor_lngIndex(this.__wbg_ptr);return 16777215===L?void 0:L}set lngIndex(L){v.__wbg_set_geometryinfodescriptor_lngIndex(this.__wbg_ptr,void 0===L||null===L?16777215:
L)}get latIndex(){const L=v.__wbg_get_geometryinfodescriptor_latIndex(this.__wbg_ptr);return 16777215===L?void 0:L}set latIndex(L){v.__wbg_set_geometryinfodescriptor_latIndex(this.__wbg_ptr,void 0===L||null===L?16777215:L)}static new(){const L=v.geometryinfodescriptor_new();return R.__wrap(L)}}const Z="undefined"===typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(L=>v.__wbg_parquetchunk_free(L>>>0,1));class da{static __wrap(L){L>>>=0;const T=Object.create(da.prototype);
T.__wbg_ptr=L;Z.register(T,T.__wbg_ptr,T);return T}__destroy_into_raw(){const L=this.__wbg_ptr;this.__wbg_ptr=0;Z.unregister(this);return L}free(){const L=this.__destroy_into_raw();v.__wbg_parquetchunk_free(L,0)}size(){return v.parquetchunk_size(this.__wbg_ptr)>>>0}hasField(L){return 0!==v.parquetchunk_hasField(this.__wbg_ptr,L)}readX(L){return v.parquetchunk_readX(this.__wbg_ptr,L)}readY(L){return v.parquetchunk_readY(this.__wbg_ptr,L)}readAttributes(L){L=v.parquetchunk_readAttributes(this.__wbg_ptr,
L);return g(L)}readAttribute(L,T){L=v.parquetchunk_readAttribute(this.__wbg_ptr,L,T);return g(L)}}const ja="undefined"===typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(L=>v.__wbg_parquetfile_free(L>>>0,1));let W=class L{static __wrap(T){T>>>=0;const ha=Object.create(L.prototype);ha.__wbg_ptr=T;ja.register(ha,ha.__wbg_ptr,ha);return ha}__destroy_into_raw(){const T=this.__wbg_ptr;this.__wbg_ptr=0;ja.unregister(this);return T}free(){const T=this.__destroy_into_raw();
v.__wbg_parquetfile_free(T,0)}metadata(){const T=v.parquetfile_metadata(this.__wbg_ptr);return ka.__wrap(T)}readChunksWithCallback(T,ha){T=x(T,v.__wbindgen_malloc);ha=v.parquetfile_readChunksWithCallback(this.__wbg_ptr,T,E,k(ha));return g(ha)}updateChunks(T){T=x(T,v.__wbindgen_malloc);T=v.parquetfile_updateChunks(this.__wbg_ptr,T,E);return g(T)}};const aa="undefined"===typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(L=>v.__wbg_rangeproviderjs_free(L>>>0,1));
class ia{static __wrap(L){L>>>=0;const T=Object.create(ia.prototype);T.__wbg_ptr=L;aa.register(T,T.__wbg_ptr,T);return T}__destroy_into_raw(){const L=this.__wbg_ptr;this.__wbg_ptr=0;aa.unregister(this);return L}free(){const L=this.__destroy_into_raw();v.__wbg_rangeproviderjs_free(L,0)}static new(L,T){L=v.rangeproviderjs_new(k(L),k(T));return ia.__wrap(L)}static withFetch(){const L=v.rangeproviderjs_withFetch();return ia.__wrap(L)}}const qa=Object.freeze(Object.defineProperty({__proto__:null,FieldMetadata:Y,
FileMetadata:ka,GeometryInfoDescriptor:R,ParquetChunk:da,ParquetFile:W,RangeProviderJs:ia,default:y,enableTracing:function(){v.enableTracing()},initSync:function(L){if(void 0!==v)return v;"undefined"!==typeof L&&Object.getPrototypeOf(L)===Object.prototype?{module:L}=L:console.warn("using deprecated parameters for `initSync()`; pass a single object instead");var T=w();L instanceof WebAssembly.Module||(L=new WebAssembly.Module(L));T=new WebAssembly.Instance(L,T);return r(T,L)},readFile:function(L,T,
ha,oa,S){L=c(L,v.__wbindgen_malloc,v.__wbindgen_realloc);const X=E;p(oa,ka);oa=oa.__destroy_into_raw();p(S,R);S=S.__destroy_into_raw();T=v.readFile(L,X,k(T),k(ha),oa,S);return g(T)},readMetadata:m},Symbol.toStringTag,{value:"Module"}));let sa=null;const ya=L=>async function(T,ha,oa){const S=L();({data:T}=await n(T,{responseType:"array-buffer",query:S,headers:{range:`bytes=${ha}-${oa}`}}));return T},va=L=>async function(T){const ha=L();({data:T}=await n(T,{responseType:"native",method:"head",query:ha}));
T=T.headers.get("Content-Length");if(null==T)throw Error("Unable to parse content length");return parseInt(T,10)};class wa{static async create(L,T){L=await (await z()).readMetadata(L,ya(T),va(T));return wa.fromFileMetadata(L)}static fromFileMetadata(L){const T=[];for(let ha=0;ha<L.numFields();ha++){const oa=L.getFieldByIndex(ha);T.push({name:oa.name,type:oa.type,alias:oa.name,index:oa.index});oa.free()}return new wa(L,T)}constructor(L,T){this._inner=L;this.fields=T}destroy(){this._inner.free()}[Symbol.dispose](){this.destroy()}get size(){return this._inner.numRows()}getFieldIndex(L){return this._inner.getFieldIndex(L)}tryReadGeoMetadata(){const L=
this._inner.keyValueMetadata("geo");return null==L?null:JSON.parse(L)}}class M{static async create(L,T){const ha=await z(),oa=ya(T.getCustomParameters),S=va(T.getCustomParameters),X=await m(L,oa,S);({geometryInfo:T}=T);const ba=R.new();"location"===T.type?(ba.latIndex=X.getFieldIndex(T.latitudeFieldName),ba.lngIndex=X.getFieldIndex(T.longitudeFieldName)):ba.wkbIndex=X.getFieldIndex(T.primaryFieldName);L=await ha.readFile(L,oa,S,X,ba);return new M(L,wa.fromFileMetadata(L.metadata()))}constructor(L,
T){this.inner=L;this.metadata=T}destroy(){this.inner.free();this.metadata.destroy()}[Symbol.dispose](){this.destroy()}}b.ParquetFile=M;b.ParquetMetadata=wa;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/sources/strategies/chunks/FeatureSnapshotSourceChunk":function(){define(["exports","./ASourceChunk"],function(b,q){class n extends q.ASourceChunk{constructor(g,k,l,a){super();this._reader=g;this._queryJSON=k;this._page=l;this._end=a;this.normalizedChunkId=
this.chunkId=`${this._page}${this.end?"e":""}`}get reader(){return this._reader}get first(){return 0===this._page}get end(){return this._end}get queryInfo(){return{type:"snapshot",chunkId:this.chunkId,queryJSON:this._queryJSON,page:this._page,size:this.size(),end:this.end}}get isTiled(){return!1}getTileReader(g){const k=this.queryFeaturesInBounds(g.bounds);k.setTransformForDisplay(g.transform);return k}}b.FeatureSnapshotSourceChunk=n;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},
"esri/views/2d/layers/features/support/FeatureSetReaderParquet":function(){define(["exports","../../../../../core/has","../../../../../geometry/support/webMercatorUtils","../../../../../layers/graphics/OptimizedGeometry","./FeatureSetReader"],function(b,q,n,g,k){class l extends k.FeatureSetReader{constructor(a,f,d,c,e,h=new Uint32Array(c.size())){super(a);this._fields=f;this._geometryInfo=d;this._inner=c;this._chunkId=e;this._displayIds=h;this._index=-1;this._size=this._inner.size();"geometry"===
this._geometryInfo.type&&(this._primaryGeometryIndex=this._fields.get(this._geometryInfo.primaryFieldName)?.index);null!=a.objectIdField&&(this._objectIdFieldIndex=this._fields.get(a.objectIdField)?.index);65535<this._chunkId&&console.error("Exceeded max allowed parquet reader size")}destroy(){super.destroy();this._inner.free()}get fields(){return this._fields}get geometryType(){return"esriGeometryPoint"}get hasFeatures(){return!0}get hasNext(){throw Error("Method not implemented.");}get exceededTransferLimit(){return!1}get hasZ(){return!1}get hasM(){return!1}getInTransform(){return null}getSize(){return this._size}getCursor(){return this.copy()}getAttributeHash(){let a=
"";for(const f of this.fields.fields)a+=this._readAttribute(f.name,!1)+".";return a}getObjectId(){return null!=this._objectIdFieldIndex?this._inner.readAttribute(this._index,this._objectIdFieldIndex):this._index<<16|this._chunkId}getDisplayId(){return this._displayIds[this._index]}setDisplayId(a){this._displayIds[this._index]=a}setIndex(a){this._index=a}getIndex(){return this._index}next(){for(;++this._index<this._size&&!this._getExists(););return this._index<this._size}readGeometryArea(){throw Error("Method not implemented.");
}copy(){const a=new l(this.metadata,this._fields,this._geometryInfo,this._inner,this._chunkId,this._displayIds);this.copyInto(a);return a}copyInto(a){super.copyInto(a);a._index=this._index}_readGeometry(a){a=n.lngLatToXY(this._inner.readX(this._index),this._inner.readY(this._index));return new g([],a)}_readX(){return this._readGeometry()?.coords[0]}_readY(){return this._readGeometry()?.coords[1]}_readServerCentroid(){return null}_readAttribute(a,f){var d=this.fields.get(a);if(d){a=this._inner.readAttribute(this._index,
d.index);if(null==a)return a;d=this.fields.isDateField(d.name);return f&&null!=a?d?new Date(a):a:a}}_readAttributes(){const a={};for(const f of this._fields.fields)this._inner.hasField(f.index)&&f.index!==this._primaryGeometryIndex&&(a[f.name]=this._readAttribute(f.name,!1));null==this._objectIdFieldIndex&&(a.__OBJECTID=this.getObjectId());return a}}b.FeatureSetReaderParquet=l;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/sources/strategies/SnapshotLoadStrategy":function(){define("exports ../../../../../../core/Error ../../../../../../core/promiseUtils ../../../../../../core/RandomLCG ./AFetchLoadStrategy ./chunks/FeatureSnapshotSourceChunk ../../support/FeatureSetReaderJSON".split(" "),
function(b,q,n,g,k,l,a){class f extends k.AFetchLoadStrategy{constructor(d,c,e,h,x,m){super(d,c,e,x,m);this._random=new g(1E3);this._featureCount=h}get about(){return{willQueryAllFeatures:!0,willQueryFullResolutionGeometry:!0}}load(d){null==this._promise&&(this._promise=this._downloadPages(this._featureCount));return this._promise}unload(d){}async _downloadPages(d){d=Array.from({length:Math.ceil(d/this._queryInfo.pageSize)},(e,h)=>h).sort((e,h)=>this._random.getInt()-this._random.getInt());d=await Promise.all(d.map(e=>
this._downloadPage(e)));const c=new l.FeatureSnapshotSourceChunk(a.FeatureSetReaderJSON.empty(this._metadata),null,-1,!0);this._store.insert(c);d=d.filter(e=>e);if(d.length)throw new q("featurelayer-query","Encountered errors when downloading data",{errors:d});}async _downloadPage(d){try{const c=this._queryInfo.createPagedQuery(d),e=await this._fetch(c,this._options),h=new l.FeatureSnapshotSourceChunk(e,c.inner.toJSON(),d,!1);n.throwIfAborted(this._options);this._store.insert(h);return null}catch(c){return c}}}
b.SnapshotLoadStrategy=f;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/sources/strategies/StreamLoadStrategy":function(){define("exports ../../../../../../core/Evented ../../../../../../core/handleUtils ../../../../../../core/has ../../../../../../core/maybe ../../../../../../layers/graphics/data/StreamFeatureManager ../../../../../../layers/graphics/sources/connections/createConnection ../StreamConnectionState ../StreamFeatureStore ./ALoadStrategy ./chunks/StreamSourceChunk".split(" "),
function(b,q,n,g,k,l,a,f,d,c,e){class h extends c.ALoadStrategy{constructor(x,m,p,t,w){super(p);this._service=x;this._dataFilter=m;this._streamOptions=t;this._metadata=w;this._connectionState=new f.StreamConnectionState;this._forceRefresh=!1;this.events=new q;const {objectIdField:r,timeInfo:y}=this._metadata;({purgeOptions:x}=m);this._stagingStore=new d.StreamFeatureStore(this._metadata,z=>this.events.emit("features-updated",z));this._manager=new l.StreamFeatureManager(this._stagingStore,r,y,x);this.connect()}destroy(){super.destroy();
this.disconnect()}get about(){return{willQueryAllFeatures:!1,willQueryFullResolutionGeometry:!1}}get connectionStatus(){return this._connectionState.connectionStatus}get errorString(){return this._connectionState?.errorString}async refresh(){const x=null!=this._chunk;if(this._manager.checkForUpdates()||!x||this._forceRefresh)this._chunk&&this._store.remove(this._chunk),this._forceRefresh=!1,this._chunk=new e.StreamSourceChunk(this._stagingStore.reader),this._store.insert(this._chunk);this.events.emit("tick")}async updateFields(x){throw Error("Updating available fields not supported for StreamLayer");
}async load(x){}unload(x){}disconnect(){this._connection=k.destroyMaybe(this._connection);this._connectionState.connection=null;this._handlesGroup?.remove()}connect(){if(null==this._connection){var {geometryType:x,spatialReference:m}=this._metadata,{maxReconnectionAttempts:p,maxReconnectionInterval:t,geometryDefinition:w,definitionExpression:r,customParameters:y}=this._dataFilter;this._connection=a.createConnection(this._service.source,m,this._streamOptions.outSR,x,r,w,p,t,y);this._handlesGroup=n.handlesGroup([this._connection.on("data-received",
z=>this._onFeature(z)),this._connection.on("message-received",z=>this._onWebSocketMessage(z))]);this._connectionState.connection=this._connection}}clear(){this._manager.checkForUpdates();this._stagingStore.clear();this._forceRefresh=!0}updateCustomParameters(x){this._connection?.updateCustomParameters(x)}sendMessageToSocket(x){this._connection?.sendMessageToSocket(x)}sendMessageToClient(x){this._connection?.sendMessageToClient(x)}_onWebSocketMessage(x){if("type"in x)switch(x.type){case "delete":if(x.objectIds)for(const m of x.objectIds)this._manager.removeById(m);
if(x.trackIds)for(const m of x.trackIds)this._manager.removeByTrackId(m);break;case "clear":this.clear()}this.events.emit("message-received",x)}_onFeature(x){try{this._manager.add(x),this.events.emit("data-received",x)}catch(m){}}}b.StreamLoadStrategy=h;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/StreamFeatureManager":function(){define(["exports","../../../core/CircularArray","../../../core/mathUtils"],function(b,q,n){class g{constructor(k,l,a,f,d=128){this._trackIdToObservations=
new Map;this._idCounter=0;this._lastPurge=performance.now();this._addOrUpdated=new Map;this._removed=[];this._maxAge=0;this._timeInfo=a;this._purgeOptions=f;this.store=k;this.objectIdField=l;this.purgeInterval=d;this._useGeneratedIds="__esri_stream_id__"===this.objectIdField}removeById(k){this._removed.push(k)}removeByTrackId(k){if(k=this._trackIdToObservations.get(k))for(const l of k.entries)this._removed.push(l)}add(k){if(this._useGeneratedIds){var l=this._nextId();k.attributes[this.objectIdField]=
l;k.objectId=l}else k.objectId=k.attributes[this.objectIdField];l=k.objectId;this._addOrUpdated.set(l,k);this._maxAge=Math.max(this._maxAge,k.attributes[this._timeInfo.startTimeField]);if(this._timeInfo.trackIdField){k=k.attributes[this._timeInfo.trackIdField];if(!this._trackIdToObservations.has(k)){const a=n.clamp(null!=this._purgeOptions?.maxObservations?this._purgeOptions.maxObservations:1E3,0,1E3);this._trackIdToObservations.set(k,new q(a))}l=this._trackIdToObservations.get(k)?.enqueue(l);null!=
l&&(this._addOrUpdated.has(l)?this._addOrUpdated.delete(l):this._removed.push(l))}else null==this._trackIdLessObservations&&(this._trackIdLessObservations=new q(1E5)),this._trackIdLessObservations.enqueue(l)}checkForUpdates(){const k=this._getToAdd();var l=this._getToRemove();const a=performance.now();a-this._lastPurge>=this.purgeInterval&&(this._purge(a),this._lastPurge=a);const f=[];if(null!=l)for(var d of l){const c=this.store.removeById(d);null!=c&&f.push(c)}d=[];if(null!=k){l=new Set(l??[]);
for(const c of k)l.has(c.objectId)||(c.attributes.__esri_timestamp__=a,this.store.add(c),d.push(c))}return d.length||f?.length?(this.store.update(d,f),!0):!1}_getToAdd(){if(!this._addOrUpdated.size)return null;const k=Array(this._addOrUpdated.size);let l=0;this._addOrUpdated.forEach(a=>k[l++]=a);this._addOrUpdated.clear();return k}_getToRemove(){const k=this._removed;if(!this._removed.length)return null;this._removed=[];return k}_nextId(){const k=this._idCounter;this._idCounter=(this._idCounter+1)%
4294967294+1;return k}_purge(k){const l=this._purgeOptions;null!=l&&(this._purgeSomeByDisplayCount(l),this._purgeByAge(l),this._purgeByAgeReceived(k,l),this._purgeTracks())}_purgeSomeByDisplayCount(k){if(k.displayCount){var l=this.store.size;if(l>k.displayCount){if(this._timeInfo.trackIdField)for(const a of this._trackIdToObservations.values())if(l>k.displayCount&&a.size){const f=a.dequeue();this._removed.push(f);l--}if(null!=this._trackIdLessObservations)for(k=l-k.displayCount;0<k--;)l=this._trackIdLessObservations.dequeue(),
null!=l&&this._removed.push(l)}}}_purgeByAge(k){const l=this._timeInfo?.startTimeField;if(k.age&&l){var a=this._maxAge-6E4*k.age;this.store.forEach(f=>{f.attributes[l]<a&&this._removed.push(f.objectId)})}}_purgeByAgeReceived(k,l){if(l.ageReceived){var a=k-6E4*l.ageReceived;this.store.forEach(f=>{f.attributes.__esri_timestamp__<a&&this._removed.push(f.objectId)})}}_purgeTracks(){this._trackIdToObservations.forEach((k,l)=>{0===k.size&&this._trackIdToObservations.delete(l)})}}b.StreamFeatureManager=
g;b.defaultStreamIdField="__esri_stream_id__";b.esriTimestamp="__esri_timestamp__";Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/core/CircularArray":function(){define(function(){class b{constructor(q){this._start=this.size=0;this.maxSize=q;this._buffer=Array(q)}get entries(){return this._buffer}enqueue(q){if(this.size===this.maxSize){const n=this._buffer[this._start];this._buffer[this._start]=q;this._start=(this._start+1)%this.maxSize;return n}this._buffer[(this._start+this.size++)%
this.maxSize]=q;return null}dequeue(){if(0===this.size)return null;const q=this._buffer[this._start];this._buffer[this._start]=null;this.size--;this._start=(this._start+1)%this.maxSize;return q}peek(){return 0===this.size?null:this._buffer[this._start]}peekLast(){return 0===this.size?null:this._buffer[(this._start+(this.size-1))%this.maxSize]}find(q){if(0===this.size)return null;for(const n of this._buffer)if(null!=n&&q(n))return n;return null}clear(q){let n=this.dequeue();for(;null!=n;)q&&q(n),n=
this.dequeue()}}return b})},"esri/layers/graphics/sources/connections/createConnection":function(){define(["exports","./GeoEventConnection","./WebSocketConnection","../../../support/ClientSideConnection"],function(b,q,n,g){b.createConnection=function(k,l,a,f,d,c,e,h,x){if(null==d&&null==c)d=null;else{var m={};null!=c&&(m.geometry=c);null!=d&&(m.where=d);d=m}l={source:k,sourceSpatialReference:l,spatialReference:a,geometryType:f,filter:d,maxReconnectionAttempts:e,maxReconnectionInterval:h,customParameters:x};
return k?k.path.startsWith("wss://")||k.path.startsWith("ws://")?new n.WebSocketConnection(l):new q(l):new g.ClientSideConnection(l)};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/sources/connections/GeoEventConnection":function(){define("require ../../../../chunks/tslib.es6 ../../../../geometry ../../../../request ../../../../core/Error ../../../../core/Logger ../../../../core/promiseUtils ../../../../core/urlUtils ../../../../core/has ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ./WebSocketConnection ../../../../rest/query/operations/query ../../../../rest/support/Query ../../../../geometry/support/jsonUtils ../../../../geometry/SpatialReference".split(" "),
function(b,q,n,g,k,l,a,f,d,c,e,h,x,m,p,t){const w={maxQueryDepth:5,maxRecordCountFactor:3};n=class extends h.WebSocketConnection{constructor(r){super({...w,...r});this._relatedFeatures=this._buddyServicesQuery=null}async _open(){var r=await this._fetchServiceDefinition(this._config.source);r.timeInfo.trackIdField||l.getLogger(this).warn("GeoEvent service was configured without a TrackIdField. This may result in certain functionality being disabled. The purgeOptions.maxObservations property will have no effect.");
r=this._fetchWebSocketUrl(r.streamUrls,this._config.spatialReference);this._buddyServicesQuery||(this._buddyServicesQuery=this._queryBuddyServices());await this._buddyServicesQuery;await this._tryCreateWebSocket(r);const {filter:y,outFields:z}=this._config;this.destroyed||this._setFilter(y,z)}_onMessage(r){if("attributes"in r){let y;try{y=this._enrich(r),null!=this._featureZScaler&&this._featureZScaler(y.geometry)}catch(z){l.getLogger(this).error(new k("geoevent-connection","Failed to parse message",
z));return}this.onFeature(y)}else this.onMessage(r)}async _fetchServiceDefinition(r){return this._serviceDefinition=r=(await g(r.path,{query:{f:"json",...this._config.customParameters},responseType:"json"})).data}_fetchWebSocketUrl(r,y){const {urls:z,token:u}=r[0];r=this._inferWebSocketBaseUrl(z);return f.addQueryParameters(`${r}/subscribe`,{outSR:""+y.wkid,token:u})}_inferWebSocketBaseUrl(r){if(1===r.length)return r[0];for(const y of r)if(y.includes("wss"))return y;l.getLogger(this).error(new k("geoevent-connection",
"Unable to infer WebSocket url",r));return null}async _setFilter(r,y){const z=this._websocket;if(null!=z&&(null!=r||null!=y)){r=JSON.stringify({filter:this._serializeFilter(r,y)});var u=!1,v=a.createResolver();z.onmessage=A=>{A=JSON.parse(A.data);A.filter&&(A.error&&(l.getLogger(this).error(new k("geoevent-connection","Failed to set service filter",A.error)),this._set("errorString",`Could not set service filter - ${A.error}`),v.reject(A.error)),this._setWebSocketJSONParseHandler(z),u=!0,v.resolve())};
z.send(r);setTimeout(()=>{u||(this.destroyed||this._websocket!==z||l.getLogger(this).error(new k("geoevent-connection","Server timed out when setting filter")),v.reject())},1E4);return v.promise}}_serializeFilter(r,y){const z={};if(null==r&&null==y)return z;if(r?.geometry)try{const u=p.fromJSON(r.geometry);if("extent"!==u.type)throw new k(`Expected extent but found type ${u.type}`);z.geometry=JSON.stringify(u.shiftCentralMeridian())}catch(u){l.getLogger(this).error(new k("geoevent-connection","Encountered an error when setting connection geometryDefinition",
u))}r?.where&&"1 \x3d 1"!==r.where&&"1\x3d1"!==r.where&&(z.where=r.where);null!=y&&(z.outFields=y.join(","));return z}_enrich(r){if(!this._relatedFeatures)return r;const y=this._relatedFeatures.get(r.attributes[this._serviceDefinition.relatedFeatures.joinField]);if(!y)return l.getLogger(this).warn("geoevent-connection","Feature join failed. Is the join field configured correctly?",r),r;const {attributes:z,geometry:u}=y;for(const v in z)r.attributes[v]=z[v];u&&(r.geometry=u);r.geometry||r.centroid||
l.getLogger(this).error(new k("geoevent-connection","Found malformed feature - no geometry found",r));return r}async _queryBuddyServices(){try{const {relatedFeatures:r,keepLatestArchive:y}=this._serviceDefinition,z=this._queryRelatedFeatures(r),u=this._queryArchive(y);await z;const v=await u;if(v)for(const A of v.features)this.onFeature(this._enrich(A))}catch(r){l.getLogger(this).error(new k("geoevent-connection","Encountered an error when querying buddy services",{error:r}))}}async _queryRelatedFeatures(r){r&&
(r=await this._queryBuddy(r.featuresUrl),this._addRelatedFeatures(r))}async _queryArchive(r){if(r)return this._queryBuddy(r.featuresUrl)}async _queryBuddy(r){const y=new (await new Promise((H,J)=>b(["../../../FeatureLayer"],E=>H(Object.freeze(Object.defineProperty({__proto__:null,default:E},Symbol.toStringTag,{value:"Module"}))),J))).default({url:r});var {capabilities:z}=await y.load();const u=z.query.supportsMaxRecordCountFactor,v=z.query.supportsPagination;z=z.query.supportsCentroid;const A=this._config.maxRecordCountFactor;
var B=y.capabilities.query.maxRecordCount;B=u?B*A:B;const F=new m;F.outFields=this._config.outFields??["*"];F.where=this._config.filter?.where??"1\x3d1";F.returnGeometry=!0;F.returnExceededLimitFeatures=!0;F.outSpatialReference=t.fromJSON(this._config.spatialReference);z&&(F.returnCentroid=!0);u&&(F.maxRecordCountFactor=A);if(v)return F.num=B,y.destroy(),this._queryPages(r,F);r=await x.executeQuery(r,F,this._config.sourceSpatialReference);y.destroy();return r.data}async _queryPages(r,y,z=[],u=0){y.start=
null!=y.num?u*y.num:null;const {data:v}=await x.executeQuery(r,y,this._config.sourceSpatialReference);if(v.exceededTransferLimit&&u<(this._config.maxQueryDepth??0))return v.features.forEach(A=>z.push(A)),this._queryPages(r,y,z,u+1);z.forEach(A=>v.features.push(A));return v}_addRelatedFeatures(r){const y=new Map;r=r.features;const z=this._serviceDefinition.relatedFeatures.joinField;for(const u of r)y.set(u.attributes[z],u);this._relatedFeatures=y}};return n=q.__decorate([e.subclass("esri.layers.graphics.sources.connections.GeoEventConnection")],
n)})},"esri/layers/graphics/sources/connections/WebSocketConnection":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/Error ../../../../core/Logger ../../../../core/promiseUtils ../../../../core/urlUtils ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ../../../../geometry/support/zscale ../../../support/StreamConnection".split(" "),function(b,q,n,g,k,l,a,f,d,c,e,h){var x;
(function(m){m[m.CONNECTING=0]="CONNECTING";m[m.OPEN=1]="OPEN";m[m.CLOSING=2]="CLOSING";m[m.CLOSED=3]="CLOSED"})(x||={});b.WebSocketConnection=class extends h{constructor(m){super({});this._outstandingMessages=[];this.errorString=null;const {geometryType:p,spatialReference:t,sourceSpatialReference:w}=m;this._config=m;this._featureZScaler=e.getGeometryZScaler(p,w,t);this._open()}normalizeCtorArgs(){return{}}async _open(){await this._tryCreateWebSocket();this.destroyed||await this._handshake()}destroy(){super.destroy();
null!=this._websocket&&(this._websocket.onopen=null,this._websocket.onclose=null,this._websocket.onerror=null,this._websocket.onmessage=null,this._websocket.close());this._websocket=null}get connectionStatus(){if(null==this._websocket)return"disconnected";switch(this._websocket.readyState){case x.CONNECTING:case x.OPEN:return"connected";case x.CLOSING:case x.CLOSED:return"disconnected"}}sendMessageToSocket(m){null==this._websocket?this._outstandingMessages.push(m):this._websocket.send(JSON.stringify(m))}sendMessageToClient(m){this._onMessage(m)}updateCustomParameters(m){this._config.customParameters=
m;null!=this._websocket&&this._websocket.close()}async _tryCreateWebSocket(m=this._config.source.path,p=1E3,t=0){try{if(!this.destroyed){var w=l.addQueryParameters(m,this._config.customParameters??{});this._websocket=await this._createWebSocket(w);this.notifyChange("connectionStatus")}}catch(r){if(w=p/1E3,this._config.maxReconnectionAttempts&&t>=this._config.maxReconnectionAttempts)g.getLogger(this).error(new n("websocket-connection","Exceeded maxReconnectionAttempts attempts. No further attempts will be made")),
this.destroy();else return g.getLogger(this).error(new n("websocket-connection",`Failed to connect. Attempting to reconnect in ${w}s`,r)),await k.after(p),this._tryCreateWebSocket(m,Math.min(1.5*p,1E3*this._config.maxReconnectionInterval),t+1)}}_setWebSocketJSONParseHandler(m){m.onmessage=p=>{try{const t=JSON.parse(p.data);this._onMessage(t)}catch(t){g.getLogger(this).error(new n("websocket-connection","Failed to parse message, invalid JSON",{error:t}))}}}_createWebSocket(m){return new Promise((p,
t)=>{const w=new WebSocket(m);w.onopen=()=>{w.onopen=null;this.destroyed?(w.onclose=null,w.close()):(w.onclose=r=>this._onClose(r),w.onerror=r=>this._onError(r),this._setWebSocketJSONParseHandler(w),p(w))};w.onclose=r=>{w.onopen=w.onclose=null;t(r)}})}async _handshake(m=1E4){const p=this._websocket;if(null!=p){var t=k.createResolver(),w=p.onmessage,{filter:r,outFields:y,spatialReference:z}=this._config;t.timeout(m);p.onmessage=u=>{let v=null;try{v=JSON.parse(u.data)}catch(A){}v&&"object"===typeof v||
(g.getLogger(this).error(new n("websocket-connection","Protocol violation. Handshake failed - malformed message",u.data)),t.reject(),this.destroy());v.spatialReference?.wkid!==z?.wkid&&(g.getLogger(this).error(new n("websocket-connection",`Protocol violation. Handshake failed - expected wkid of ${z.wkid}`,u.data)),t.reject(),this.destroy());"json"!==v.format&&(g.getLogger(this).error(new n("websocket-connection","Protocol violation. Handshake failed - format is not set",u.data)),t.reject(),this.destroy());
r&&v.filter!==r&&g.getLogger(this).error(new n("websocket-connection","Tried to set filter, but server doesn't support it"));y&&v.outFields!==y&&g.getLogger(this).error(new n("websocket-connection","Tried to set outFields, but server doesn't support it"));p.onmessage=w;for(const A of this._outstandingMessages)p.send(JSON.stringify(A));this._outstandingMessages=[];t.resolve()};p.send(JSON.stringify({filter:r,outFields:y,format:"json",spatialReference:{wkid:z.wkid}}));return t.promise}}_onMessage(m){this.onMessage(m);
if("type"in m)switch(m.type){case "features":case "featureResult":for(const p of m.features)null!=this._featureZScaler&&this._featureZScaler(p.geometry),this.onFeature(p)}}_onError(m){this._set("errorString","Encountered an error over WebSocket connection");g.getLogger(this).error("websocket-connection","Encountered an error over WebSocket connection")}_onClose(m){this._websocket=null;this.notifyChange("connectionStatus");1E3!==m.code&&g.getLogger(this).error("websocket-connection",`WebSocket closed unexpectedly with error code ${m.code}`);
this.destroyed||this._open()}};q.__decorate([a.property()],b.WebSocketConnection.prototype,"connectionStatus",null);q.__decorate([a.property()],b.WebSocketConnection.prototype,"errorString",void 0);b.WebSocketConnection=q.__decorate([c.subclass("esri.layers.graphics.sources.connections.WebSocketConnection")],b.WebSocketConnection);Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/StreamConnection":function(){define("../../chunks/tslib.es6 ../../core/Error ../../core/Evented ../../core/accessorSupport/decorators/property ../../core/has ../../core/Logger ../../core/RandomLCG ../../core/accessorSupport/decorators/subclass".split(" "),
function(b,q,n,g,k,l,a,f){n=class extends n.EventedAccessor{destroy(){this.emit("destroy")}get connectionError(){return this.errorString?new q("stream-connection",this.errorString):null}onFeature(d){this.emit("data-received",d)}onMessage(d){this.emit("message-received",d)}};b.__decorate([g.property({readOnly:!0})],n.prototype,"connectionError",null);return n=b.__decorate([f.subclass("esri.layers.support.StreamConnection")],n)})},"esri/layers/support/ClientSideConnection":function(){define("exports ../../chunks/tslib.es6 ../../core/accessorSupport/decorators/property ../../core/has ../../core/Logger ../../core/RandomLCG ../../core/accessorSupport/decorators/subclass ../../geometry/support/zscale ./StreamConnection".split(" "),
function(b,q,n,g,k,l,a,f,d){b.ClientSideConnection=class extends d{constructor(c){super({});this.connectionStatus="connected";this.errorString=null;const {geometryType:e,spatialReference:h,sourceSpatialReference:x}=c;this._featureZScaler=f.getGeometryZScaler(e,x,h)}normalizeCtorArgs(){return{}}updateCustomParameters(c){}sendMessageToSocket(c){}sendMessageToClient(c){if("type"in c)switch(c.type){case "features":case "featureResult":for(const e of c.features)null!=this._featureZScaler&&this._featureZScaler(e.geometry),
this.onFeature(e)}this.onMessage(c)}};q.__decorate([n.property()],b.ClientSideConnection.prototype,"connectionStatus",void 0);q.__decorate([n.property()],b.ClientSideConnection.prototype,"errorString",void 0);b.ClientSideConnection=q.__decorate([a.subclass("esri.layers.support.ClientSideConnection")],b.ClientSideConnection);Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/sources/StreamConnectionState":function(){define(["exports","../../../../../chunks/tslib.es6",
"../../../../../core/Accessor","../../../../../core/accessorSupport/decorators/property","../../../../../core/accessorSupport/decorators/subclass"],function(b,q,n,g,k){b.StreamConnectionState=class extends n{constructor(l){super(l)}get connectionStatus(){return this.connection?.connectionStatus}get errorString(){return this.connection?.errorString}};q.__decorate([g.property()],b.StreamConnectionState.prototype,"connection",void 0);q.__decorate([g.property()],b.StreamConnectionState.prototype,"connectionStatus",
null);q.__decorate([g.property()],b.StreamConnectionState.prototype,"errorString",null);b.StreamConnectionState=q.__decorate([k.subclass("esri.views.2d.layers.features.sources.StreamConnectionState")],b.StreamConnectionState);Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/sources/StreamFeatureStore":function(){define(["exports","../support/FeatureSetReaderJSON"],function(b,q){class n{constructor(g,k){this._metadata=g;this._onUpdate=k;this._objectIdToFeature=
new Map}get size(){return this._objectIdToFeature.size}get reader(){return q.FeatureSetReaderJSON.fromFeatures([...this._objectIdToFeature.values()],this._metadata)}add(g){this._objectIdToFeature.set(g.objectId,g)}forEach(g){this._objectIdToFeature.forEach(g)}removeById(g){const k=this._objectIdToFeature.get(g);return k?(this._objectIdToFeature.delete(g),k):null}clear(){this._objectIdToFeature=new Map}update(g,k){this._onUpdate(g?.length??0)}}b.StreamFeatureStore=n;Object.defineProperty(b,Symbol.toStringTag,
{value:"Module"})})},"esri/views/2d/layers/features/sources/strategies/chunks/StreamSourceChunk":function(){define(["exports","./ASourceChunk"],function(b,q){class n extends q.ASourceChunk{constructor(g){super();this._reader=g;this.normalizedChunkId=this.chunkId="stream-chunk"}get reader(){return this._reader}get first(){return!0}get end(){return!0}get queryInfo(){return{type:"stream",chunkId:this.chunkId,size:this.size(),end:this.end}}get isTiled(){return!1}getTileReader(g){const k=this.queryFeaturesInBounds(g.bounds);
k.setTransformForDisplay(g.transform);return k}}b.StreamSourceChunk=n;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/sources/strategies/chunks/SourceChunkStore":function(){define("exports ../../../../../../../core/Evented ../../../../../../../core/has ../../../../../../../geometry/support/aaBoundingBox ../../../FeatureStoreQueryAdapter ./OverrideChunk".split(" "),function(b,q,n,g,k,l){class a{constructor(f){this._onChange=f;this._chunks=new Map;this._chunksToRemove=
[];this.events=new q;this.featureAdapter=new k.FeatureStoreQueryAdapter}destroy(){this.clear()}clear(){for(const f of this._chunks.values())this._chunksToRemove.push(f);this._chunks.clear();null!=this._localEditChunk&&this._chunksToRemove.push(this._localEditChunk);this._localEditChunk=null}*chunks(){this._localEditChunk&&(yield this._localEditChunk);this._localOverridesChunk&&(yield this._localOverridesChunk);yield*this._chunks.values()}dataChunks(){return this._chunks.values()}insert(f){n("esri-2d-update-debug")&&
console.debug(`Chunk[${f.chunkId}] SourceChunkStore.insert`);this._localOverridesChunk?.overriddenIds.size&&(f.reader.removeIds(this._localOverridesChunk.overriddenIds),f.invalidate());this._localEditChunk?.overriddenIds.size&&this._localEditChunk.removeOverrides(f);this._chunks.set(f.chunkId,f);this.events.emit("changed");this._onChange()}remove(f){n("esri-2d-update-debug")&&console.debug(`Chunk[${f.chunkId}] SourceChunkStore.remove`);this._chunks.delete(f.chunkId);this._chunksToRemove.push(f)}cleanupRemovedChunks(){const f=
this._chunksToRemove;this._chunksToRemove=[];return f}applyLocalOverrides(f,d){null==this._localOverridesChunk&&(this._localOverridesChunk=new l.OverrideChunk(d,"localOverride"));this._localOverridesChunk.applyOverrides(f);for(const c of this._chunks.values())c.reader.removeIds(this._localOverridesChunk.overriddenIds),c.invalidate();this.events.emit("changed")}applyLocalEdit(f,d){null==this._localEditChunk&&(this._localEditChunk=new l.OverrideChunk(d,"localEdit"));this._localEditChunk.applyOverrides(f);
for(const c of this._chunks.values())c.reader.removeIds(this._localEditChunk.overriddenIds),c.invalidate();this.events.emit("changed")}forEach(f){const d=new Set;for(const c of this.chunks()){const e=c.reader.getCursor();for(;e.next();){const h=e.getObjectId();d.has(h)||(f(e.copy()),d.add(h))}}}forEachUnsafe(f){const d=new Set;for(const c of this.chunks()){const e=c.reader.getCursor();for(;e.next();){const h=e.getObjectId();d.has(h)||(f(e),d.add(h))}}}forEachInBounds(f,d){const c=new Set;for(const e of this.chunks()){const h=
e.queryFeaturesInBounds(f);for(;h.next();){const x=h.getObjectId();c.has(x)||(d(h.copy()),c.add(x))}}}forEachBounds(f,d){const c=g.create();for(const e of f)e.getBounds(c)&&d(c)}}b.FeatureSourceChunkStore=a;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/support/UpdateTracking2D":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/has ../../../../core/ReactiveMap ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/Logger ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ../../../../core/support/UpdatingHandles".split(" "),
function(b,q,n,g,k,l,a,f,d,c,e){b.UpdateTracking2D=class extends n{constructor(h){super(h);this.debugName="";this._updatingHandles=new e.UpdatingHandles;this._idToUpdatingState=new k}get updating(){const h=this._updatingHandles.updating||Array.from(this._idToUpdatingState.values()).some(x=>x);if(g("esri-2d-log-updating")){const x=Array.from(this._idToUpdatingState.entries()).map(([m,p])=>`-> ${m}: ${p}`).join("\n");console.log(`${this.debugName}: Updating: ${h}\n-> Handles: ${this._updatingHandles.updating}\n${x}`)}return h}addUpdateTracking(h,
x){const m=l.watch(()=>x.updating,p=>this._idToUpdatingState.set(h,p),{sync:!0});this.addHandles(m)}addPromise(h){return this._updatingHandles.addPromise(h)}};q.__decorate([a.property({constructOnly:!0})],b.UpdateTracking2D.prototype,"debugName",void 0);q.__decorate([a.property({readOnly:!0})],b.UpdateTracking2D.prototype,"updating",null);b.UpdateTracking2D=q.__decorate([c.subclass("esri.views.2d.layers.support.UpdateTracking2D")],b.UpdateTracking2D);Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},
"esri/core/support/UpdatingHandles":function(){define("exports ../../chunks/tslib.es6 ../Accessor ../handleUtils ../reactiveUtils ../scheduling ../accessorSupport/decorators/property ../accessorSupport/decorators/subclass".split(" "),function(b,q,n,g,k,l,a,f){b.UpdatingHandles=class extends n{constructor(){super(...arguments);this.updating=!1;this._scheduleHandleId=this._handleId=0;this._pendingPromises=new Set}destroy(){this.removeAll()}add(d,c,e={}){return this._installWatch(d,c,e,k.watch)}addWhen(d,
c,e={}){return this._installWatch(d,c,e,k.when)}addOnCollectionChange(d,c,{initial:e=!1,final:h=!1}={}){const x=++this._handleId;this.addHandles([k.on(d,"after-changes",this._createSyncUpdatingCallback(),k.sync),k.on(d,"change",c,{onListenerAdd:e?m=>c({added:m.toArray(),removed:[]}):void 0,onListenerRemove:h?m=>c({added:[],removed:m.toArray()}):void 0})],x);return g.makeHandle(()=>this.removeHandles(x))}addPromise(d){if(null==d)return d;const c=++this._handleId;this.addHandles(g.makeHandle(()=>{this._pendingPromises.delete(d)&&
(0!==this._pendingPromises.size||this.hasHandles(-42)||this._set("updating",!1))}),c);this._pendingPromises.add(d);this._set("updating",!0);const e=()=>this.removeHandles(c);d.then(e,e);return d}removeAll(){this._pendingPromises.clear();this.removeAllHandles();this._set("updating",!1)}_installWatch(d,c,e={},h){const x=++this._handleId;e.sync||this._installSyncUpdatingWatch(d,x);d=h(d,c,e);this.addHandles(d,x);return g.makeHandle(()=>this.removeHandles(x))}_installSyncUpdatingWatch(d,c){const e=this._createSyncUpdatingCallback();
d=k.watch(d,e,{sync:!0,equals:()=>!1});this.addHandles(d,c);return d}_createSyncUpdatingCallback(){return()=>{this.removeHandles(-42);++this._scheduleHandleId;const d=this._scheduleHandleId;this._get("updating")||this._set("updating",!0);this.addHandles(l.schedule(()=>{d===this._scheduleHandleId&&(this._set("updating",0<this._pendingPromises.size),this.removeHandles(-42))}),-42)}}};q.__decorate([a.property({readOnly:!0})],b.UpdatingHandles.prototype,"updating",void 0);b.UpdatingHandles=q.__decorate([f.subclass("esri.core.support.UpdatingHandles")],
b.UpdatingHandles);Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/sources/FeatureTileSubscription":function(){define(["exports"],function(b){class q{constructor(n,g){this.tile=n;this.version=g;this._abortController=new AbortController}get key(){return this.tile.key}get signal(){return this._abortController.signal}abort(){this._abortController.abort()}}b.FeatureTileSubscription=q;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/support/Tile":function(){define("exports ../../../../../core/ArrayPool ../../../../../geometry/Extent ../../../../../geometry/support/aaBoundingRect ../../../../../rest/support/QuantizationParameters ../../../tiling/TileKey".split(" "),
function(b,q,n,g,k,l){class a{constructor(f,d){this.key=new l(0,0,0,0);this.bounds=g.create();this.objectIds=new Set;this.key.set(d);d=f.getLODInfoAt(this.key);this.tileInfoView=f;this.tileInfoView.getTileBounds(this.bounds,this.key,!0);this.resolution=d.resolution;this.level=d.level;this.scale=d.scale;this.minScale=f.zoomToScale(d.level-1);this.maxScale=f.zoomToScale(d.level+1)}get lod(){return this.tileInfoView.getLODInfoAt(this.key)}get id(){return this.key.id}get extent(){return n.fromBounds(this.bounds,
this.tileInfoView.tileInfo.spatialReference)}get transform(){return{originPosition:"upperLeft",scale:[this.resolution,this.resolution],translate:[this.bounds[0],this.bounds[3]]}}createArcadeEvaluationOptions(f){return{$view:{scale:this.scale,timeZone:f}}}createChildTiles(){const f=this.key.getChildKeys(),d=q.acquire();for(let c=0;c<f.length;c++)d[c]=new a(this.tileInfoView,f[c]);return d}getQuantizationParameters(){return k.fromJSON({mode:"view",originPosition:"upperLeft",tolerance:this.resolution,
extent:{xmin:this.bounds[0],ymin:this.bounds[1],xmax:this.bounds[2],ymax:this.bounds[3],spatialReference:this.tileInfoView.tileInfo.spatialReference}})}}b.Tile=a;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"*noref":1}});
define("../../../../core/Error ../../../../core/handleUtils ../../../../core/has ../../../../core/nextTick ../../../../core/promiseUtils ../../../../core/RandomLCG ../../../../core/reactiveUtils ../../../../core/screenUtils ../../../../core/workers/utils ../../../../layers/support/TileInfo ../../tiling/TileInfoView ../../tiling/TileKey ../../tiling/TileQueue ../../tiling/TileStrategy ../../engine/webgl/definitions ./PipelineConnectionHandlers ./Processor ./sources/FeatureSource ./sources/FeatureTileSubscription ./support/Tile".split(" "),function(b,
q,n,g,k,l,a,f,d,c,e,h,x,m,p,t,w,r,y,z){class u{constructor(A){this.inner=A;this.resolver=k.createResolver()}}class v{constructor(){this._aggregateAdapter={getFeatureObjectIds:A=>this._processor.getFeatureObjectIdsForAggregate(A)};this._subscriptions=new Map;this._updateRequested=!1;this._updateSubscriptionRequests=[];this._updateHighlightRequests=[]}destroy(){this._subscriptions.clear();this._processor?.destroy();this._source?.destroy();this._handles?.remove();this._tileInfoView=this._updateLocalEditsRequest=
null}onAttach(A){n("esri-2d-update-debug")&&console.debug("Pipeline.onAttach");const B=this._connection,F=c.fromJSON(A.tileInfoJSON);this._tileInfoView=new e(F);this._source=new r.FeatureSource(A.service,this._aggregateAdapter,this._subscriptions,()=>this._requestUpdate(),B);this._processor=new w(B,this._source);this._handles=q.handlesGroup([a.watch(()=>this._source.updateTracking.updating,()=>{this._requestUpdate();k.ignoreAbortErrors(this._connection.layerView.setUpdating({data:this._source.updateTracking.updating,
pipeline:!0}))})])}onDetach(){n("esri-2d-update-debug")&&console.debug("Pipeline.onDetach");this.destroy()}set remoteClient(A){this._connection=new t.PipelineConnectionHandlers(A)}get features(){const A=this._source?.queryEngine;if(!A)throw new b("no-queryEngine","No query engine defined");return A}get aggregates(){const A=this._processor?.aggregateQueryEngine;if(!A)throw new b("no-queryEngine","No aggregate query engine defined");return A}get processor(){return this._processor}get streamMessenger(){return this._source.streamMessenger}getDisplayFeatures(A){return this._processor.getDisplayFeatures(A)}getDisplayIds(A){return this._processor.getDisplayIds(A)}async updateSchema(A,
B){n("esri-2d-update-debug")&&this._updateSchemaRequest&&console.error("InternalError: Schema already updating");this._updateSchemaRequest=new u({schema:A,version:B});this._requestUpdate();return this._updateSchemaRequest.resolver.promise}updateSubscriptions(A){A=new u(A);this._updateSubscriptionRequests.push(A);this._requestUpdate();return A.resolver.promise}updateHighlight(A){A=new u(A);this._updateHighlightRequests.push(A);this._requestUpdate();return A.resolver.promise}async addParquetFile(A){return this._source.addParquetFile(A)}async onEdits(A){if(null!=
this._updateLocalEditsRequest)throw new b("InternalError - Already processing an edit");this._updateLocalEditsRequest=new u(A);A=this._updateLocalEditsRequest.resolver.promise;this._requestUpdate();return A}queryStatistics(){return this._source.statistics.toJSON()}async queryVisibleFeatures(A,B){return this.features.executeQuery(A,B)}async queryHeatmapStatistics(A){var B=Math.round(f.pt2px(A.radius));let F=Number.POSITIVE_INFINITY,H=Number.NEGATIVE_INFINITY;const J="string"===typeof A.fieldOffset,
E=A.fieldOffset??0;var K=Array.from(this._subscriptions.values());const C=this._source.chunks(),D=B**2,G=3/(Math.PI*D);B*=2;const N=Math.ceil(p.tileSize/B);for(const R of K){var Y=R.tile;K=new Float64Array(N*N);for(const Z of C){var ca=Z.getTileReader(Y);if(ca)for(ca=ca.getCursor();ca.next();){var ka=1;null!=A.field&&(ka=ca.readAttribute(A.field),ka=J?-1*+ka:+ka+E);var Q=ca.readXForDisplay()/B;const da=ca.readYForDisplay()/B,ja=Math.floor(Q),W=Math.floor(da);0>ja||0>W||ja>=N||W>=N||(Q=((.5+ja-Q)*
B)**2+((.5+W-da)*B)**2,Q>D||(K[W+ja*N]+=ka*G*(1-Q/D)**2))}}for(Y=0;Y<K.length;Y++)F=Math.min(F,K[Y]),H=Math.max(H,K[Y])}return{max:H,min:F}}async getSampleFeatures(A){const B=this._source.chunks();if(B.reduce((G,N)=>G+N.size(),0)<=A.minFeatureCount){if(!this._source.updateTracking.updating){const G=[];this._source.store.forEachUnsafe(N=>G.push(N.readLegacyFeatureWorldSpace()));return G}return null}const F=new Set,H=[],J=B.map(G=>G.reader.getCursor()),E=new l,K=3*A.sampleSize;for(let G=0;G<K&&H.length<
A.sampleSize;G++){var C=E.getIntRange(0,B.length-1);C=J[C];if(0!==C.getSize()){var D=E.getIntRange(0,C.getSize()-1);C.setIndex(D);D=C.getObjectId();F.has(D)||(F.add(D),H.push(C.readLegacyFeatureWorldSpace()))}}return H.length>=A.sampleSize?H:null}_requestUpdate(){this._updateRequested||(this._updateRequested=!0,g.nextTick(()=>this._scheduleNextUpdate()))}_scheduleNextUpdate(){this._updateRequested&&!this._ongoingUpdate&&(this._ongoingUpdate=d.ignoreConnectionErrors(this._doUpdate()).finally(()=>{this._ongoingUpdate=
null;this._scheduleNextUpdate()}),this._updateRequested=!1)}_subscribe(A){const B=A.tileId;if(!this._subscriptions.has(B)){n("esri-2d-update-debug")&&console.debug(`Tile[${B}] Pipeline.subscribe`);var F=new z.Tile(this._tileInfoView,B);A=new y.FeatureTileSubscription(F,A.version);this._subscriptions.set(B,A);this._source.onSubscribe(A);this._processor.onSubscribe(A)}}_unsubscribe(A){const B=this._subscriptions.get(A);B&&(n("esri-2d-update-debug")&&console.debug(`Tile[${A}] Pipeline.unsubscribe`),
B.abort(),this._source.onUnsubscribe(B),this._processor.onUnsubscribe(B),this._subscriptions.delete(B.key.id))}async _doUpdate(){n("esri-2d-update-debug")&&console.debug("Pipeline._doUpdateStart");await this._connection.layerView.setUpdating({data:this._source.updateTracking.updating,pipeline:!0});if(this._updateSubscriptionRequests.length){var A=this._updateSubscriptionRequests;this._updateSubscriptionRequests=[];for(var B of A)this._doUpdateSubscriptions(B.inner),B.resolver.resolve()}A=this._updateSchemaRequest;
this._updateSchemaRequest=null;if(null!=A){const {schema:J,version:E}=A.inner;await this._doUpdateSchema(J,E)}B=this._updateLocalEditsRequest;this._updateLocalEditsRequest=null;if(null!=B){n("esri-2d-update-debug")&&console.debug("Pipeline.applyEditOverride",B.inner);var F=await this._source.getLocalEdit(B.inner);await this._processor.applyLocalEdit(F);this._source.applyLocalEdit(F);n("esri-2d-update-debug")&&console.debug("Pipeline.endEditOverride",B.inner)}if(this._updateHighlightRequests.length){F=
this._updateHighlightRequests;this._updateHighlightRequests=[];for(var H of F)this._processor.updateHighlight(H.inner),H.resolver.resolve()}H=this._source.cleanupRemovedChunks();this._processor.removeChunks(H);try{this._subscriptions.size&&(n("esri-2d-update-debug")&&console.debug("Pipeline.updateChunksStart"),await this._processor.updateChunks(),n("esri-2d-update-debug")&&console.debug("Pipeline.updateChunksEnd"))}catch(J){k.throwIfNotAbortError(J)}null!=B&&B.resolver.resolve();null!=A&&A.resolver.resolve();
this._updateRequested?(n("esri-2d-update-debug")&&console.debug("Pipeline._doUpdateEnd [updateRequested\x3dtrue]"),await this._connection.layerView.setUpdating({data:this._source.updateTracking.updating,pipeline:!0})):(n("esri-2d-update-debug")&&console.debug("Pipeline._doUpdateEnd [updateRequested\x3dfalse, After flush]"),await this._connection.layerView.setUpdating({data:this._source.updateTracking.updating,pipeline:this._updateRequested}))}async _doUpdateSchema(A,B){n("esri-2d-update-debug")&&
console.debug(`Version[${B}] Pipeline.updateStart`,{schema:A});const F={tileInfo:this._tileInfoView?.tileInfo},H=await this._source.update(A,B),J=Array.from(this._subscriptions.values());await this._processor.update(A,B,F,H,J);n("esri-2d-update-debug")&&console.debug(`Version[${B}] Pipeline.updateEnd`)}_doUpdateSubscriptions(A){n("esri-2d-update-debug")&&console.debug("Pipeline.updateSubscriptions",A);for(const B of A.subscribe)this._subscribe(B);for(const B of A.unsubscribe)this._unsubscribe(B)}}
return v});