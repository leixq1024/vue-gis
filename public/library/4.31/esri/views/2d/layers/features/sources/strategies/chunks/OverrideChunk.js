// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.31/esri/copyright.txt for details.
//>>built
define(["exports","./ASourceChunk","../../../support/FeatureSetReaderJSON"],function(f,k,l){class m extends k.ASourceChunk{constructor(a,c){super();this.metadata=a;this.removed=new Set;this.overriddenIds=new Set;this._features=[];this.normalizedChunkId=this.chunkId=c}get reader(){return l.FeatureSetReaderJSON.fromOptimizedFeatures(this._features,this.metadata)}get queryInfo(){return{}}get first(){return!1}get end(){return!1}get isTiled(){return!1}get lastLocalEditDropped(){return this._lastLocalEditDropped}applyOverrides(a){this._onChange();
const {reader:c,removed:d}=a;a=[];const g=new Set;var e=c.getCursor();const n=new Set(d);for(this.overriddenIds.clear();e.next();){const b=e.readOptimizedFeatureWorldSpace(),h=b.objectId;a.push(b);g.add(h);this.overriddenIds.add(h);this.removed.delete(h)}for(const b of this._features)e=b.objectId,n.has(e)||g.has(e)||(a.push(b),this.overriddenIds.add(e));this._features=a;for(const b of g.values())this.removed.delete(b);for(const b of d)this.removed.add(b),this.overriddenIds.add(b)}removeOverrides(a){this._lastLocalEditDropped=
performance.now();this._onChange();a=a.reader.getCursor();const c=new Set;for(;a.next();){const d=a.getObjectId();this.overriddenIds.has(d)&&(c.add(d),this.overriddenIds.delete(d))}this._features=this._features.filter(d=>!c.has(d.objectId))}getTileReader(a){if(!this._features.length)return null;const c=this.queryFeaturesInBounds(a.bounds);c.setTransformForDisplay(a.transform);return c}_onChange(){this.invalidate()}}f.OverrideChunk=m;f.isLocalEditChunk=function(a){return"localEdit"===a.chunkId};Object.defineProperty(f,
Symbol.toStringTag,{value:"Module"})});