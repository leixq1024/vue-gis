// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.31/esri/copyright.txt for details.
//>>built
require({cache:{"esri/AggregateGraphic":function(){define("./chunks/tslib.es6 ./Graphic ./core/accessorSupport/decorators/property ./core/has ./core/Logger ./core/RandomLCG ./core/accessorSupport/decorators/subclass".split(" "),function(n,t,r,q,z,v,k){t=class extends t{constructor(){super(...arguments);this.isAggregate=!0}getEffectivePopupTemplate(x){return this.popupTemplate?this.popupTemplate:(x=this.sourceLayer?.featureReduction)&&"popupTemplate"in x&&x.popupEnabled?x.popupTemplate:null}getObjectId(){return this.attributes.aggregateId}};
n.__decorate([r.property({type:Boolean})],t.prototype,"isAggregate",void 0);return t=n.__decorate([k.subclass("esri.AggregateGraphic")],t)})},"esri/layers/effects/FeatureEffectView":function(){define("../../chunks/tslib.es6 ../../core/Accessor ../../core/has ../../core/accessorSupport/decorators/property ../../core/Logger ../../core/RandomLCG ../../core/accessorSupport/decorators/subclass ./EffectView".split(" "),function(n,t,r,q,z,v,k,x){t=class extends t{constructor(l){super(l);this._filter=null;
this.duration=r("mapview-transitions-duration");this._excludedEffectView=new x.EffectView(l);this._includedEffectView=new x.EffectView(l)}get excludedEffects(){return this._excludedEffectView.effects}set featureEffect(l){this._get("featureEffect")!==l&&this._transitionTo(l)}get filter(){return this._filter||this.featureEffect?.filter||null}get hasEffects(){return this._excludedEffectView.hasEffects||this._includedEffectView.hasEffects}get includedEffects(){return this._includedEffectView.effects}set scale(l){this._set("scale",
l);this._excludedEffectView.scale=l;this._includedEffectView.scale=l}get transitioning(){return this._excludedEffectView.transitioning||this._includedEffectView.transitioning}get transitioningToEmpty(){return!this._excludedEffectView.final&&!this._includedEffectView.final}transitionStep(l,e){this._set("scale",e);this.transitioning?(this._includedEffectView.transitionStep(l,e),this._excludedEffectView.transitionStep(l,e),this.transitioning||(this._filter=null)):(this._excludedEffectView.scale=e,this._includedEffectView.scale=
e)}endTransition(){this._includedEffectView.endTransition();this._excludedEffectView.endTransition();this._filter=null}_transitionTo(l){const e=this._get("featureEffect"),c=l?.includedEffect,p=l?.excludedEffect,w=this._includedEffectView.canTransitionTo(c)&&this._excludedEffectView.canTransitionTo(p);this._includedEffectView.effect=c;this._excludedEffectView.effect=p;this._set("featureEffect",l);this._filter=l?.filter||e?.filter||null;w||this.endTransition()}};n.__decorate([q.property()],t.prototype,
"_filter",void 0);n.__decorate([q.property()],t.prototype,"_excludedEffectView",void 0);n.__decorate([q.property()],t.prototype,"_includedEffectView",void 0);n.__decorate([q.property()],t.prototype,"duration",void 0);n.__decorate([q.property()],t.prototype,"excludedEffects",null);n.__decorate([q.property()],t.prototype,"featureEffect",null);n.__decorate([q.property()],t.prototype,"filter",null);n.__decorate([q.property()],t.prototype,"hasEffects",null);n.__decorate([q.property()],t.prototype,"includedEffects",
null);n.__decorate([q.property({value:0})],t.prototype,"scale",null);n.__decorate([q.property()],t.prototype,"transitioning",null);n.__decorate([q.property()],t.prototype,"transitioningToEmpty",null);return t=n.__decorate([k.subclass("esri.layers.effects.FeatureEffectView")],t)})},"esri/layers/support/timeSupport":function(){define(["exports","../../support/timeUtils"],function(n,t){n.combineTimeExtent=function(r,q,z){if(null==r?.timeInfo)return null;const {datesInUnknownTimezone:v=!1,timeOffset:k,
useViewTime:x}=r;r=r.timeExtent;v&&(r=t.toLocalTimeExtent(r));q=x?q&&r?q.intersection(r):q||r:r;if(!q||q.isEmpty||q.isAllTime)return q;k&&(q=q.offset(-k.value,k.unit));v&&(q=t.toUTCTimeExtent(q));return q.equals(z)?z:q};Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/support/timeUtils":function(){define("exports ../core/arrayUtils ../core/deprecate ../core/lang ../core/Logger ../core/timeUtils ../time/TimeExtent ../webmap/utils ../webscene/utils".split(" "),function(n,t,r,q,
z,v,k,x,l){function e(b){return void 0!==b.timeInfo}async function c(b,f){return b.widgets?.timeSlider?.fullTimeExtent??p(b.allLayers,f)}async function p(b,f){if(0===b.length)return k.allTime;await Promise.all(b.map(y=>y.load({signal:f})));var m=b.filter(e),d=b.filter(y=>!e(y)&&null!=y.visibilityTimeExtent);if(0===m.length&&0===d.length)return k.allTime;b=[];const u=[];for(const y of m)"feature"!==y?.type&&"map-image"!==y?.type||!y.timeInfo?.hasLiveData?u.push(y):b.push(y);m=y=>null==y||y.isAllTime;
d=[...u.map(y=>{const C=y.timeInfo?.fullTimeExtent;({visibilityTimeExtent:y}=y);return C?.intersection(y)??y}),...d.map(y=>y.visibilityTimeExtent)];if(d.some(m))return k.allTime;b=b.map(async y=>{const C=(await y.fetchRecomputedExtents({signal:f}))?.timeExtent??y.timeInfo?.fullTimeExtent;({visibilityTimeExtent:y}=y);return C?.intersection(y)??y});b=(await Promise.allSettled(b)).map(y=>"fulfilled"===y.status?y.value:null);if(b.some(m))return k.allTime;b=[...b,...d].filter(t.isSome);return 0===b.length?
k.allTime:b.reduce((y,C)=>y.union(C))}function w(b,f){b=b.currentTimeExtent;if(!b)return null;const {start:m,end:d}=b;b=m??d??null;switch(f){case "time-window":return new k({start:m,end:d});case "cumulative-from-start":return new k({start:null,end:b});case "cumulative-from-end":return new k({start:b,end:null});case "instant":return new k({start:b,end:b})}}async function a(b,f){if(!x.isWebMap(b)&&!l.isWebScene(b))return null;await b.load({signal:f});var m=b?.widgets?.timeSlider;if(!m)return null;b=
await c(b,f);f=m.loop;var d=m.numThumbs??2;var u=m.currentTimeExtent;if(u){const {start:C,end:H}=u;d=null!=C&&null!=H&&C.getTime()===H.getTime()?"instant":2===d?"time-window":null==C||0===C.getTime()?"cumulative-from-start":"cumulative-from-end"}else d=2===d?"time-window":"cumulative-from-start";u=m.stopDelay??2E3;{const {numStops:C,stopInterval:H,stops:I}=m;var y=I?{dates:q.clone(I)}:H?{interval:H.clone()}:{count:C??5}}m=w(m,d);return{fullTimeExtent:b,loop:f,mode:d,playRate:u,stops:y,timeExtent:m}}
n.getTimeExtentFromLayers=p;n.getTimeSliderSettingsFromWebDocument=a;n.getTimeSliderSettingsFromWebMap=async function(b,f){r.deprecatedFunction(z.getLogger("esri.support.timeUtils.getTimeSliderSettingsFromWebMap"),"`timeUtils.getTimeSliderSettingsFromWebMap` is deprecated in favor of 'timeUtils.getTimeSliderSettingsFromWebDocument'",{replacement:"timeUtils.getTimeSliderSettingsFromWebDocument",version:"4.30",see:"https://developers.arcgis.com/javascript/latest/api-reference/esri-support-timeUtils.html#getTimeSliderSettingsFromWebDocument",
warnOnce:!0});return null!=b&&x.isWebMap(b)?await a(b,f):null};n.toLocalTimeExtent=function(b){if(!b)return b;const {start:f,end:m}=b;return new k({start:null!=f?v.offsetDate(f,f.getTimezoneOffset(),"minutes"):f,end:null!=m?v.offsetDate(m,m.getTimezoneOffset(),"minutes"):m})};n.toUTCTimeExtent=function(b){if(!b)return b;const {start:f,end:m}=b;return new k({start:null!=f?v.offsetDate(f,-f.getTimezoneOffset(),"minutes"):f,end:null!=m?v.offsetDate(m,-m.getTimezoneOffset(),"minutes"):m})};Object.defineProperty(n,
Symbol.toStringTag,{value:"Module"})})},"esri/webscene/utils":function(){define(["exports","../support/tagSymbols"],function(n,t){n.isWebScene=function(r){return null!=r&&"object"===typeof r&&t.WebSceneTag in r};Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/support/tagSymbols":function(){define(["exports"],function(n){const t=Symbol("WebScene");n.WebSceneTag=t;Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/rest/support/AggregateFeatureSet":function(){define("../../chunks/tslib.es6 ../../AggregateGraphic ../../geometry ../../core/accessorSupport/decorators/property ../../core/has ../../core/Logger ../../core/RandomLCG ../../core/accessorSupport/decorators/reader ../../core/accessorSupport/decorators/subclass ./FeatureSet ../../geometry/SpatialReference".split(" "),
function(n,t,r,q,z,v,k,x,l,e,c){r=class extends e{constructor(){super(...arguments);this.features=[]}readFeatures(p,w){w=c.fromJSON(w.spatialReference);const a=[];for(let m=0;m<p.length;m++){var b=p[m];const d=t.fromJSON(b);var f=b.geometry?.spatialReference;null==d.geometry||f||(d.geometry.spatialReference=w);b=b.aggregateGeometries;f=d.aggregateGeometries;if(b&&null!=f)for(const u in f){const y=f[u],C=b[u]?.spatialReference;null==y||C||(y.spatialReference=w)}a.push(d)}return a}};n.__decorate([q.property({type:[t],
json:{write:!0}})],r.prototype,"features",void 0);n.__decorate([x.reader("features")],r.prototype,"readFeatures",null);return r=n.__decorate([l.subclass("esri.rest.support.AggregateFeatureSet")],r)})},"esri/views/2d/layers/LayerView2D":function(){define("exports ../../../chunks/tslib.es6 ../../../core/Collection ../../../core/collectionUtils ../../../core/Error ../../../core/Logger ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ../../../linkChart/utils ../engine/Container ./support/util ../support/HighlightGroup ../support/highlightGroupUtils ../support/HighlightOptions ../../layers/support/ClipRect ../../layers/support/Geometry ../../layers/support/Path ../../support/layerViewUtils".split(" "),
function(n,t,r,q,z,v,k,x,l,e,c,p,w,a,b,f,m,d,u,y,C){const H=r.ofType({key:"type",base:null,typeMap:{rect:d,path:y,geometry:u}}),I=new (r.ofType(b.HighlightGroup));n.LayerView2DMixin=G=>{G=class extends G{constructor(){super(...arguments);this.attached=!1;this.clips=new H;this.highlights=null;this.lastUpdateId=-1;this.updateRequested=this.moving=!1;this._visibleAtCurrentScale=!0}initialize(){const D=this.view?.spatialReferenceLocked??!0;this.view?.spatialReference&&D&&!this.spatialReferenceSupported?
this.addResolvingPromise(Promise.reject(new z("layerview:spatial-reference-incompatible","The spatial reference of this layer does not meet the requirements of the view",{layer:this.layer}))):(this.container||(this.container=new w.Container),this.container.fadeTransitionEnabled=!0,this.container.visible=!1,this.container.endTransitions(),this.addHandles([k.watch(()=>this.suspended,h=>{this.container&&(this.container.visible=!h)},k.syncAndInitial),k.watch(()=>this.updateSuspended,h=>{this.view&&!h&&
this.updateRequested&&this.view.requestUpdate()},k.syncAndInitial),k.watch(()=>this.layer?.opacity??1,h=>{this.container&&(this.container.opacity=h)},k.syncAndInitial),k.watch(()=>this.layer&&"blendMode"in this.layer?this.layer.blendMode:"normal",h=>{this.container&&(this.container.blendMode=h)},k.syncAndInitial),k.watch(()=>this.layer&&"effect"in this.layer?this.layer.effect:null,h=>{this.container&&(this.container.effect=h)},k.syncAndInitial),k.watch(()=>this._mergedHighlights.items.map(h=>({name:h.name,
options:{fillColor:h.options.color,haloColor:h.options.haloColor,fillOpacity:h.options.fillOpacity,haloOpacity:h.options.haloOpacity,haloWidth:h.options.haloWidth,haloBlur:h.options.haloBlur}})),()=>{this.container.highlightGradient=a.createOrReuseHighlightGradient(this.container.highlightGradient,this._mergedHighlights.items)},k.syncAndInitial),k.watch(()=>this._mergedHighlights.items.map(h=>h.name),()=>{this._updateHighlights()}),k.on(()=>this.clips,"change",()=>{this.container&&(this.container.clips=
this.clips)},k.syncAndInitial),k.watch(()=>({scale:this.view?.scale,scaleRange:this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null}),({scale:h,scaleRange:B})=>{h=C.isInEffectiveScaleRange(B,h);h!==this._visibleAtCurrentScale&&(this._visibleAtCurrentScale=h)},k.syncAndInitial)],"constructor"),this.view?.whenLayerView?this.view.whenLayerView(this.layer).then(h=>{h===this&&this.processAttach()},()=>{}):this.when().then(()=>{this.processAttach()},()=>{}))}_updateHighlights(){}destroy(){this.processDetach();
this.updateRequested=!1}get highlightOptions(){return f.getDefaultHighlightOptions(this)}set highlightOptions(D){f.setDefaultHighlightOptions(this,D)}get _mergedHighlights(){if(!this.view)return I;if(!this.highlights)return this.view.highlights;const D=this.view.highlights.clone();for(const h of this.highlights){const B=D.find(E=>E.name===h.name);B&&(B.options=h.options)}return D}get scheduler(){return this.view.scheduler}get spatialReferenceSupported(){const D=this.view?.spatialReference;return null==
D||this.supportsSpatialReference(D)}get updating(){return this.spatialReferenceSupported&&(!this.attached||!this.suspended&&(this.updateRequested||this.isUpdating())||!!this._updatingHandles?.updating||this.container.transitioning)}get visibleAtCurrentScale(){return this._visibleAtCurrentScale}processAttach(){this.isResolved()&&!this.attached&&!this.destroyed&&this.spatialReferenceSupported&&(this.attach(),this.attached=!0,this.requestUpdate())}processDetach(){this.attached&&(this.attached=!1,this.removeHandles("attach"),
this.detach(),this.updateRequested=!1)}requestUpdate(){this.destroyed||this.updateRequested||(this.updateRequested=!0,this.updateSuspended||this.view.requestUpdate())}processUpdate(D){this.isFulfilled()&&!this.isResolved()?this.updateRequested=!1:(this._set("updateParameters",D),this.updateRequested&&!this.updateSuspended&&(this.updateRequested=!1,this.update(D)))}hitTest(D,h){return Promise.resolve(null)}supportsSpatialReference(D){return!0}canResume(){if(!this.spatialReferenceSupported)return!1;
switch(this.layer?.type){case "link-chart":case "knowledge-graph-sublayer":break;default:if(p.isLinkChartView(this.view)&&!this.view.inGeographicLayout)return!1}return super.canResume()?this.visibleAtCurrentScale:!1}getSuspendInfo(){const D=super.getSuspendInfo(),h=!this.spatialReferenceSupported;h&&(D.spatialReferenceNotSupported=h);return D}addAttachHandles(D){this.addHandles(D,"attach")}_getHighlightBits(D){D=new Set(D);let h=1,B=0;if(!this.view)return 0;const E=this._mergedHighlights;for(const {name:M}of E)D.delete(M)&&
(B=h),h<<=1;for(const M of D)v.getLogger(this).error("#highlights",`${M} was not found. Features in this group will not be highlighted.`);return B}};t.__decorate([x.property()],G.prototype,"attached",void 0);t.__decorate([x.property({type:H,set(D){D=q.referenceSetter(D,this._get("clips"),H);this._set("clips",D)}})],G.prototype,"clips",void 0);t.__decorate([x.property()],G.prototype,"container",void 0);t.__decorate([x.property({type:m})],G.prototype,"highlightOptions",null);t.__decorate([x.property({type:r.ofType(b.HighlightGroup)})],
G.prototype,"highlights",void 0);t.__decorate([x.property()],G.prototype,"_mergedHighlights",null);t.__decorate([x.property()],G.prototype,"moving",void 0);t.__decorate([x.property({readOnly:!0})],G.prototype,"spatialReferenceSupported",null);t.__decorate([x.property({readOnly:!0})],G.prototype,"updateParameters",void 0);t.__decorate([x.property()],G.prototype,"updateRequested",void 0);t.__decorate([x.property()],G.prototype,"updating",null);t.__decorate([x.property()],G.prototype,"view",void 0);
t.__decorate([x.property()],G.prototype,"_visibleAtCurrentScale",void 0);t.__decorate([x.property({readOnly:!0})],G.prototype,"visibleAtCurrentScale",null);return G=t.__decorate([c.subclass("esri.views.2d.layers.LayerView2D")],G)};Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/linkChart/utils":function(){define(["exports"],function(n){n.isLinkChartView=function(t){return null!=t&&"object"===typeof t&&"2d"===t.type&&"linkchart"===t.view2dType};Object.defineProperty(n,Symbol.toStringTag,
{value:"Module"})})},"esri/views/layers/support/ClipRect":function(){define("../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ./ClipArea".split(" "),function(n,t,r,q,z,v,k){var x;r=x=class extends k{constructor(l){super(l);this.type="rect";this.bottom=this.top=this.right=this.left=null}clone(){return new x({left:this.left,right:this.right,top:this.top,bottom:this.bottom})}commitVersionProperties(){this.commitProperty("left");
this.commitProperty("right");this.commitProperty("top");this.commitProperty("bottom")}};n.__decorate([t.property({type:[Number,String],json:{write:!0}})],r.prototype,"left",void 0);n.__decorate([t.property({type:[Number,String],json:{write:!0}})],r.prototype,"right",void 0);n.__decorate([t.property({type:[Number,String],json:{write:!0}})],r.prototype,"top",void 0);n.__decorate([t.property({type:[Number,String],json:{write:!0}})],r.prototype,"bottom",void 0);return r=x=n.__decorate([v.subclass("esri.views.layers.support.ClipRect")],
r)})},"esri/views/layers/support/ClipArea":function(){define("../../../chunks/tslib.es6 ../../../core/JSONSupport ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass".split(" "),function(n,t,r,q,z,v,k){t=class extends t.JSONSupport{get version(){this.commitVersionProperties();return(this._get("version")||0)+1}};n.__decorate([r.property({readOnly:!0})],t.prototype,"version",null);return t=
n.__decorate([k.subclass("esri.views.layers.support.ClipArea")],t)})},"esri/views/layers/support/Geometry":function(){define("../../../chunks/tslib.es6 ../../../geometry ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ../../../geometry/Geometry ../../../geometry/support/jsonUtils ./ClipArea ../../../geometry/Extent ../../../geometry/Polygon".split(" "),function(n,t,r,q,z,v,k,x,l,e,c,
p){var w;t={base:x,key:"type",typeMap:{extent:c,polygon:p}};e=w=class extends e{constructor(a){super(a);this.type="geometry";this.geometry=null}clone(){return new w({geometry:this.geometry?.clone()??null})}commitVersionProperties(){this.commitProperty("geometry")}};n.__decorate([r.property({types:t,json:{read:l.fromJSON,write:!0}})],e.prototype,"geometry",void 0);return e=w=n.__decorate([k.subclass("esri.views.layers.support.Geometry")],e)})},"esri/views/layers/support/Path":function(){define("../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ./ClipArea".split(" "),
function(n,t,r,q,z,v,k){r=class extends k{constructor(x){super(x);this.type="path";this.path=[]}commitVersionProperties(){this.commitProperty("path")}};n.__decorate([t.property({type:[[[Number]]],json:{write:!0}})],r.prototype,"path",void 0);return r=n.__decorate([v.subclass("esri.views.layers.support.Path")],r)})},"esri/views/2d/layers/features/FeatureContainer":function(){define("exports ../../../../core/has ../../../../core/promiseUtils ../../../../core/support/UpdatingHandles ../../engine/AFeatureContainer ../../engine/webgl/enums ../../engine/webgl/shaderGraph/techniques/FeatureInstanceStore ../../engine/webgl/shaderGraph/techniques/TechniqueRegistry ../../engine/webgl/shaderGraph/techniques/TechniqueType ./RenderState ../support/util".split(" "),
function(n,t,r,q,z,v,k,x,l,e,c){class p{constructor(a,b){this.id=a;this.version=b;this._resolver=r.createResolver();this._done=!1}get done(){return this._done}get promise(){return this._resolver.promise}end(){this._resolver.resolve();this._done=!0}destroy(){this._resolver.reject()}}class w extends z.AFeatureContainer{constructor(a){super(a.view.featuresTilingScheme);this.updatingHandles=new q.UpdatingHandles;this._hitTestsRequests=[];this._store=new k;this._visibleTiles=new Set;this._subscriptions=
new Map;this._updateStatisticsRequests=[];this._lockStatisticUpdates=!1;this._layerView=a;this.addTransitionable(this._layerView.featureEffectView)}renderChildren(a){this._updateAttributeView();this._renderState?.update(this.attributeView.currentEpoch);if(this._renderState){const b=Array.from(this._renderState.tiles()).filter(f=>f.needsUpload);b.length&&(b[Math.floor(Math.random()*b.length)].upload(),2<=b.length&&this.requestRender());for(const f of this._renderState.tiles())f.tryReady(this.attributeView.currentEpoch)&&
(this._subscriptions.get(f.key.id)?.end(),this._layerView.requestUpdate(),this.hasLabels&&this._layerView.view.labelManager.requestUpdate(),this.requestRender())}for(const b of this.children)b.setTransform(a.state);super.renderChildren(a);switch(a.drawPhase){case v.WGLDrawPhase.MAP:return this._renderMapPhase(a);case v.WGLDrawPhase.HIGHLIGHT:return this._renderHighlightPhase(a);case v.WGLDrawPhase.LABEL:return this._renderLabelPhase(a)}}subscriptions(){return this._subscriptions.values()}get _instanceStore(){return this._store}get instanceStore(){return this._store}get layerView(){return this._layerView}get hasLabels(){return 0<
this._layerView.labelingCollisionInfos.length}get hasHighlight(){return this._layerView.hasHighlight()}get _layer(){return this._layerView.layer}_getHeatmapInstance(a){if(null==this._instanceStore||!(a.drawPhase&x.Techniques.heatmap.drawPhase))return null;for(const b of this._instanceStore.values())if(b.techniqueRef.type===l.TechniqueType.Heatmap)return b;return null}get children(){return this._renderState?Array.from(this._renderState.tiles()).filter(a=>this._visibleTiles.has(a.key.id)):[]}updateAttributeView(a){this.requestRender();
this.attributeView.requestUpdate(a);this.hasLabels&&this._layerView.view.labelManager.requestUpdate()}updateSubscriptions(a){for(const {tileId:b,version:f}of a.subscribe)if(this._subscriptions.has(b))this._subscriptions.get(b).version=f;else{const m=new p(b,f);this._subscriptions.set(b,m);this.updatingHandles.addPromise(m.promise)}for(const b of a.unsubscribe)this._subscriptions.get(b)?.destroy(),this._subscriptions.delete(b),this.removeTile(b)}isDone(a){return this._renderState?this._renderState.isTileDone(a):
!1}async updateRenderState(a){t("esri-2d-update-debug")&&console.debug(`Version[${a}] FeatureContainer.updateRenderState`);this._renderStateNext=new e.RenderState(()=>this._stage,b=>this._subscriptions.get(b)?.version,a,this.tileInfoView)}getDisplayStatistics(a,b){return(a=this._statisticsByLevel.get(a))?a.get(b):null}updateStatistics(a,b){if(this._lockStatisticUpdates)this._updateStatisticsRequests.push({level:a,statistics:b});else{var f=this._statisticsByLevel.get(a);f||(f=new Map,this._statisticsByLevel.set(a,
f));for(const m of b)f.set(m.fieldName,{minValue:m.minValue,maxValue:m.maxValue})}}editStart(){this._renderState?.lockUploads();this.attributeView.lockTextureUploads();this._lockStatisticUpdates=!0}editEnd(){this._renderState?.unlockUploads();this.attributeView.unlockTextureUploads();this._lockStatisticUpdates=!1;for(const a of this._updateStatisticsRequests)this.updateStatistics(a.level,a.statistics);this._updateStatisticsRequests=[];this.requestRender()}swapRenderState(){this._renderStateNext&&
(t("esri-2d-update-debug")&&console.debug(`Version[${this._renderStateNext.version}] FeatureContainer.update.swapRenderState`),this._renderState?.destroy(),this._renderState=this._renderStateNext,this._renderStateNext=null);this._renderState&&this._renderState.flush();this.requestRender()}setVisibleTiles(a){this._visibleTiles=a}async onMessage(a,b){r.throwIfAborted(b);b=a.inner;if(this._subscriptions.has(b.id)){var f=this._subscriptions.get(b.id);if(f.version!==b.subscriptionVesrion)t("esri-2d-update-debug")&&
console.debug(`Version[${`${b.subscriptionVesrion} != ${f.version}`}] Tile[${b.id}] FeatureContainer - Dropping message, outdated version]`,b);else{f=this._renderStateNext??this._renderState;if(!f)throw Error("InternalError: No renderState defined");f.version!==b.version&&console.error(`InternalError: Version mismatch. [renderState: ${f.version}, message: ${b.version}]`);f.enqueueUpdate(a);this.requestRender();this._layerView.view.labelManager.requestUpdate();this._layerView.requestUpdate()}}}removeTile(a){if(this._renderState||
this._renderStateNext)this._renderState&&this._renderState.removeTile(a),this._renderStateNext&&this._renderStateNext.removeTile(a)}hitTest(a){let b=this._hitTestsRequests.find(({x:m,y:d})=>m===a.x&&d===a.y);const f=r.createResolver();b?b.resolvers.push(f):(b={x:a.x,y:a.y,resolvers:[f]},this._hitTestsRequests.push(b));this.requestRender();return f.promise}getSortKeys(a){a=new Set(a);const b=new Map;for(const f of this.children)if(f.getSortKeys(a).forEach((m,d)=>b.set(d,m)),b.size===a.size)break;return b}get hasAnimation(){return this.hasLabels}doRender(a){const {minScale:b,
maxScale:f}=this._layer.effectiveScaleRange,m=a.state.scale;m<=(b||Infinity)&&m>=f&&super.doRender(a)}afterRender(a){super.afterRender(a);this._hitTestsRequests.length&&this.requestRender()}setStencilReference(a){if(null!=this._getHeatmapInstance(a))for(const b of this.children)b.stencilRef=x.Techniques.heatmap.getStencilReference(b);else super.setStencilReference(a)}_renderMapPhase(a){this._layerView.featureEffectView.hasEffects?(this._renderOutsideEffect(a),this._renderInsideEffect(a)):this._renderFeatures(a,
v.FeatureSelection.All);0<this._hitTestsRequests.length&&this._renderHittest(a)}_renderHighlightPhase(a){this.hasHighlight&&c.renderHighlight(a,!1,b=>{this._renderFeatures(b,v.FeatureSelection.Highlight)})}_renderLabelPhase(a){this._renderFeatures(a,v.FeatureSelection.All)}_renderInsideEffect(a){const b=a.painter.effects.insideEffect;b.bind(a);this._renderFeatures(a,v.FeatureSelection.InsideEffect);b.draw(a,this._layerView.featureEffectView.includedEffects);b.unbind()}_renderOutsideEffect(a){const b=
a.painter.effects.outsideEffect;b.bind(a);this._renderFeatures(a,v.FeatureSelection.OutsideEffect);b.draw(a,this._layerView.featureEffectView.excludedEffects);b.unbind()}_renderHittest(a){const {context:b}=a,f=a.painter.effects.hittest,m=b.getBoundFramebufferObject(),d=b.getViewport(),u=a.passOptions,y=a.drawPhase;f.bind(a);a.passOptions=f.createOptions(a,this._hitTestsRequests);a.drawPhase=v.WGLDrawPhase.HITTEST;const {distance:C,smallSymbolDistance:H}=a.passOptions,I=Math.max(C,H);for(const G of this.children)G.visible&&
G.containsScreenPoint(a.state,a.passOptions.position,2*I)&&this._renderTile(G,a,v.FeatureSelection.All);f.draw(a);f.unbind();b.bindFramebuffer(m);b.restoreViewport(d);a.passOptions=u;a.drawPhase=y}_renderFeatures(a,b){const f=this._getHeatmapInstance(a);null!=f?this._renderHeatmapFeatures(a,b,f):this._renderGeometryFeatures(a,b)}_renderGeometryFeatures(a,b){for(const f of this.children)f.visible&&this._renderTile(f,a,b)}_renderHeatmapFeatures(a,b,f){for(const m of this.children)m.visible&&this._renderTile(m,
a,b,l.TechniqueType.Heatmap);f.techniqueRef.renderResolvePass(a,f)}_renderTile(a,b,f,m){const d=t("featurelayer-force-marker-text-draw-order")?v.FeatureBatchingStrategy.STRICT_MARKERS_AND_TEXT:v.FeatureBatchingStrategy.BATCHING;a=a.getDisplayList(this._instanceStore,d);b.selection=f;a?.render(b,m)}}n.FeatureContainer=w;Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/FeatureInstanceStore":function(){define(["../../../../../../core/string",
"./TechniqueInstance","./mesh/instanceIdUtils"],function(n,t,r){class q{constructor(){this._instanceById=new Map}destroy(){this._instanceById.clear()}get size(){return this._instanceById.size}entries(){return this._instanceById.entries()}updateStart(){this._instanceByIdNext=new Map}updateEnd(){if(!this._instanceByIdNext)throw Error("InternalError: Found updateEnd call without corresponding updateStart");for(var z of this._instanceById.keys())this._instanceByIdNext.has(z)||this._instanceById.delete(z);
for(const [v,k]of this._instanceByIdNext.entries())(z=this._instanceById.get(v))?z.setInput(k.getInput()):this._instanceById.set(v,k);this._instanceByIdNext=null}values(){return this._instanceById.values()}ensureInstance(z,v){if("object"===typeof v&&"optionalAttributes"in v&&"uniforms"in v){var k=`${z.type}${JSON.stringify(v.optionalAttributes)}`;const x=v.uniforms;if("object"===typeof x)for(const l in x)k+=`${l}.${null!=x[l]}`}else k=`${z.type}.${JSON.stringify(v)}`;k=n.numericHash(k);if(this._instanceByIdNext)return z=
new t.FeatureTechniqueInstance(r.castInstanceId(k),z,v),this._instanceByIdNext.set(k,z),z;this._instanceById.has(k)||(z=new t.FeatureTechniqueInstance(r.castInstanceId(k),z,v),this._instanceById.set(k,z));return this._instanceById.get(k)}getInstance(z){return this._instanceById.get(z)}}return q})},"esri/views/2d/layers/features/RenderState":function(){define("exports ../../../../core/CircularArray ../../../../core/Error ../../../../core/has ../../../../core/Logger ../../../../geometry/support/aaBoundingRect ../../tiling/TileInfoView ../../tiling/TileKey ../../tiling/TileQueue ../../tiling/TileStrategy ../../engine/webgl/FeatureTile".split(" "),
function(n,t,r,q,z,v,k,x,l,e,c){class p{constructor(w,a,b,f){this.getStage=w;this.getSubscriptionVersion=a;this.version=b;this._tileInfoView=f;this._pendingUpdates=new t(1E3);this._locked=!1;this._tiles=new Map}destroy(){for(const w of this.tiles())w.destroy();this._pendingUpdates.clear();this._tiles.clear()}tiles(){return this._tiles.values()}size(){return this._tiles.size}setTiles(w){this._tiles.clear();for(const a of w)this._tiles.set(a.key.id,a)}lockUploads(){this._locked=!0}unlockUploads(){this._locked=
!1;this.flush()}enqueueUpdate(w){this._pendingUpdates.enqueue(w)}update(w){if(!this._locked)for(;this._pendingUpdates.size;){const a=this._pendingUpdates.peek();if(null==a||a.inner.attributeEpoch>w)break;this._updateTile(a);this._pendingUpdates.dequeue()}}removeTile(w){const a=this._tiles.get(w);q("esri-2d-update-debug")&&console.debug(`Tile[${w}] RenderState.removeTile`);a?.destroy();this._tiles.delete(w)}isTileDone(w){return(w=this._tiles.get(w.id))?w.isReady:!1}flush(){for(;this._pendingUpdates.size;){const w=
this._pendingUpdates.dequeue();null!=w&&this._updateTile(w)}for(const w of this._tiles.values())w.upload()}_updateTile(w){const {inner:a,objectIdMap:b}=w;w=this.getSubscriptionVersion(a.id);if(w!==a.subscriptionVesrion)q("esri-2d-update-debug")&&console.debug(`Version[${`${a.subscriptionVesrion} != ${w}`}] Tile[${a.id}] FeatureContainer - Dropping message, outdated version]`,a);else if(q("esri-2d-update-debug")&&console.debug(`Version[${a.version}] Tile[${a.id}] Chunk[${a.debugInfo?.chunkId??"\x3cEnsureEnd\x3e"}] RenderState.updateTile [${a.type}]`,
a),w=this._ensureTile(a.id),"update"===a.type){const [y,...C]=a.modify;w.onMessage({type:"update",modify:y,remove:a.remove,end:a.end,attributeEpoch:a.attributeEpoch,objectIdMap:b});for(var f of C){var m=this._tiles.get(f.tileId);if(m)m.onMessage({type:"update",modify:f,remove:a.remove,end:!1,isPixelBuffer:!0,attributeEpoch:null,objectIdMap:b})}}else if(null==a.append)w.onMessage({type:"append",clear:a.clear,debugInfo:a.debugInfo,end:a.end,attributeEpoch:a.attributeEpoch,objectIdMap:b});else{var [d,
...u]=a.append;w.onMessage({type:"append",clear:a.clear,append:d,debugInfo:a.debugInfo,end:a.end,attributeEpoch:a.attributeEpoch,objectIdMap:b});for(m of u)if(f=this._tiles.get(m.tileId))f.onMessage({type:"update",modify:m,remove:[],sort:!1,end:!1,isPixelBuffer:!0,attributeEpoch:null,objectIdMap:b})}}_ensureTile(w){if(!this._tiles.has(w)){const a=this._createTile(w);this._copyPixelBufferedEntitiesInto(a);this._tiles.set(w,a)}return this._tiles.get(w)}_createTile(w){q("esri-2d-update-debug")&&console.debug(`Version[${this.version}] Tile[${w}] RenderState.createTile`);
w=new x(w);var a=this._tileInfoView.getTileBounds(v.create(),w);const b=this._tileInfoView.getTileResolution(w.level);w=new c.FeatureTile(w,b,a[0],a[3],!0);w.stage=this.getStage();w.stage||(a=new r("featurelayerview:webgl","Cannot create tile with empty stage"),z.getLogger("esri.views.2d.layers.features.RenderState").error(a));return w}_copyPixelBufferedEntitiesInto(w){let a=7;const b=this._tileInfoView.getLODInfoAt(w.key);for(let m=-1;1>=m;m++)for(let d=-1;1>=d;d++)if(0!==m||0!==d){var f=w.key.getNormalizedNeighbor(d,
m,b).id;f=this._tiles.get(f);null!=f&&w.copyPixelBufferedEntitesFrom(f,1<<a,d,m);a--}}}n.RenderState=p;Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/FeaturePipelineWorkerProxy":function(){define(["exports","../../../../core/workers/workers"],function(n,t){class r{constructor(q){this._connection=q;this.pipeline=this._connection.createInvokeProxy();this.features=this._connection.createInvokeProxy("features");this.aggregates=this._connection.createInvokeProxy("aggregates");
this.streamMessenger=this._connection.createInvokeProxy("streamMessenger")}destroy(){this._connection.destroy()}get closed(){return this._connection.closed}}n.FeaturePipelineWorkerProxy=r;n.createFeaturePipelineWorkerProxy=async function(q){q=await t.open("FeaturePipelineWorker",{client:q,strategy:"dedicated"});return new r(q)};Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/FeatureSourceEventLog":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/CircularArray ../../../../core/Evented ../../../../core/ReactiveMap ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/Logger ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass".split(" "),
function(n,t,r,q,z,v,k,x,l,e,c){n.FeatureSourceEventLog=class extends r{constructor(){super(...arguments);this.events=new z;this._updatingStrategy=!0;this._tileToEvent=new v;this._fetchStatus={outstanding:0,done:0}}get hasAllFeatures(){return this._hasAllData()&&(this._strategyInfo?.willQueryAllFeatures??!1)}get hasAllFeaturesInView(){return this._hasAllData()}get hasFullGeometries(){return this._hasAllData()&&(this._strategyInfo?.willQueryFullResolutionGeometry??!1)}onEvent(p){switch(p.type){case "subscribe":case "unsubscribe":case "loaded":case "error":this._handleTileEvent(p);
break;case "updateStrategyStart":this._updatingStrategy=!0;this._fetchStatus={done:0,outstanding:0};this._strategyInfo=p.about;break;case "updateStrategyEnd":this._updatingStrategy=!1;break;case "updateFieldsStart":this._fetchStatus={done:0,outstanding:0};break;case "updateFieldsError":this.events.emit("error",p);break;case "fetchStart":this._fetchStatus.outstanding+=1;this.events.emit("status",this._fetchStatus);break;case "fetchEnd":this._fetchStatus.done+=1,this.events.emit("status",this._fetchStatus),
p.done&&(this._fetchStatus={done:0,outstanding:0})}}_hasAllData(){return!this._updatingStrategy&&this._hasAllTileData()}_hasAllTileData(){for(const p of this._tileToEvent.values())if("loaded"!==p.peekLast()?.type)return!1;return!0}_handleTileEvent(p){switch(p.type){case "subscribe":var w=new q(10);w.enqueue(p);this._tileToEvent.set(p.tile,w);break;case "unsubscribe":this._tileToEvent.delete(p.tile);break;case "loaded":w=this._tileToEvent.get(p.tile);if(!w)break;w.enqueue(p);this._tileToEvent.set(p.tile,
w);break;case "error":if(w=this._tileToEvent.get(p.tile))w.enqueue(p),this._tileToEvent.set(p.tile,w),this.events.emit("error",p)}}};t.__decorate([k.property({readOnly:!0})],n.FeatureSourceEventLog.prototype,"hasAllFeatures",null);t.__decorate([k.property({readOnly:!0})],n.FeatureSourceEventLog.prototype,"hasAllFeaturesInView",null);t.__decorate([k.property({readOnly:!0})],n.FeatureSourceEventLog.prototype,"hasFullGeometries",null);t.__decorate([k.property()],n.FeatureSourceEventLog.prototype,"_updatingStrategy",
void 0);t.__decorate([k.property()],n.FeatureSourceEventLog.prototype,"_strategyInfo",void 0);t.__decorate([k.property()],n.FeatureSourceEventLog.prototype,"_tileToEvent",void 0);n.FeatureSourceEventLog=t.__decorate([c.subclass("esri.views.2d.layers.features.FeatureSourceEventLog")],n.FeatureSourceEventLog);Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/layerAdapters/CatalogFootprintLayerAdapter":function(){define("exports ../../../../../core/lang ../../../../../layers/support/arcgisLayerUrl ./geometryUtils ./labelingUtils ../schema/SourceSchema ../schema/processor/SimpleProcessorSchema ../support/rendererUtils".split(" "),
function(n,t,r,q,z,v,k,x){class l{constructor(e){this.layer=e}getLabelingDeconflictionInfo(e){e=this.layer;const c=z.getLayerDeconflictionEnabled(e);return[{vvEvaluators:{0:z.createLabelVVEvaluator(e.renderer)},deconflictionEnabled:c}]}async createServiceOptions(e){var c=this.layer;const {capabilities:p,editingInfo:w,objectIdField:a,globalIdField:b,datesInUnknownTimezone:f,orderBy:m,parsedUrl:d}=c,u=c.fieldsIndex.toJSON(),y=q.getServiceGeometryType(c),C=c.timeInfo?.toJSON();c=c.spatialReference.toJSON();
const H=t.clone(d);let I=a;if(m?.length){var G=!m[0].valueExpression&&m[0].field;G&&(I=G)}G=r.isHostedAgolService(H.path);return{type:"feature-service",source:H,isSourceHosted:G,orderByFields:I,outSpatialReference:e.spatialReference.toJSON(),metadata:{timeReferenceUnknownClient:f,globalIdField:b,fieldsIndex:u,geometryType:y,objectIdField:a,timeInfo:C,spatialReference:c,subtypeField:null,subtypes:null,typeIdField:null,types:null},queryMetadata:{maxRecordCount:p.query.maxRecordCount,supportsCompactGeometry:p.query.supportsCompactGeometry,
supportsDefaultSpatialReference:p.query.supportsDefaultSpatialReference,supportsFormatPBF:p.query.supportsFormatPBF,supportsMaxRecordCountFactor:p.query.supportsMaxRecordCountFactor,supportsQuantization:p.query.supportsQuantization,lastEditDate:w?.lastEditDate?.getTime(),snapshotInfo:null}}}createSourceSchema(e,c){const {definitionExpression:p,customParameters:w,timeExtent:a,apiKey:b}=this.layer;return v.createFeatureSourceSchema({definitionExpression:p,customParameters:w,timeExtent:a},e,c,b)}createProcessorSchema(e,
c,p){const {fields:w,geometryType:a,orderBy:b,objectIdField:f,renderer:m,labelingInfo:d,labelsVisible:u}=this.layer,y={featureReduction:null,fields:w.map(C=>C.toJSON()),geometryType:a,labelingInfo:d,labelsVisible:u,objectIdField:f,orderBy:b??"default",renderer:m?.clone()};return k.createSimpleProcessorSchema(e,c,y,p)}get hasRequiredSupport(){return x.isRendererSupported(this.layer.renderer)}get timeOptions(){return this.layer}getUpdateHashProperties(e){var c=this.layer;const {definitionExpression:p,
apiKey:w,renderer:a}=c;e=this.layer.labelsVisible?this.layer.labelingInfo:null;const b=JSON.stringify(c.customParameters);c=JSON.stringify(c.orderBy);return{outFields:this.layer.outFields,apiKey:w,customParameters:b,definitionExpression:p,labelingInfo:e,orderBy:c,renderer:a}}setGraphicOrigin(e){e.origin={type:"catalog",layer:this.layer}}}n.CatalogFootprintLayerAdapter=l;Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/layerAdapters/geometryUtils":function(){define(["exports"],
function(n){n.getServiceGeometryType=function(t){switch(t.geometryType){case "point":return"esriGeometryPoint";case "polyline":return"esriGeometryPolyline";case "polygon":return"esriGeometryPolygon";case "multipatch":return"esriGeometryMultiPatch";case "multipoint":return"esriGeometryMultipoint";default:return null}};Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/layerAdapters/labelingUtils":function(){define(["exports","../../../../../core/screenUtils",
"./featureReductionUtils","../../support/visualVariableSimpleUtils"],function(n,t,r,q){function z(v){return k=>t.pt2px(q.getSizeForValueSimple(k,v))}n.createLabelVVEvaluator=function(v){v=null!=v&&"visualVariables"in v&&v.visualVariables;if(!v)return null;for(const k of v)if("size"===k.type)return z(k);return null};n.getFeatureReductionDeconflictionEnabled=function(v,k){v=r.getEffectiveFeatureReduction(v,k);if(v?.labelsVisible&&v.labelingInfo?.length)return v.labelingInfo.every(x=>"none"!==x.deconflictionStrategy)};
n.getLayerDeconflictionEnabled=function(v){return(v.labelsVisible&&v.labelingInfo?.every(k=>"none"!==k.deconflictionStrategy))??!1};Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/layerAdapters/featureReductionUtils":function(){define(["exports"],function(n){n.getEffectiveFeatureReduction=function(t,r){return(t=t.featureReduction)&&"selection"!==t.type?!("maxScale"in t&&t.maxScale)||t.maxScale<r.scale?t:null:null};Object.defineProperty(n,Symbol.toStringTag,
{value:"Module"})})},"esri/views/2d/layers/support/visualVariableSimpleUtils":function(){define(["exports","../../../../core/mathUtils","../../../../renderers/support/lengthUtils","../../../../renderers/visualVariables/support/sizeVariableUtils"],function(n,t,r,q){function z(l,e){switch(e.transformationType){case q.TransformationType.Additive:var c=v(e.minSize,l);return l+(c||e.minDataValue);case q.TransformationType.Constant:return c=e.stops,c=c?.length&&c[0].size,null==c&&(c=e.minSize),v(c,l);case q.TransformationType.ClampedLinear:c=
e.minDataValue;var p=e.maxDataValue,w=(l-c)/(p-c),a=v(e.minSize,l);e=v(e.maxSize,l);l=l<=c?a:l>=p?e:a+w*(e-a);return l;case q.TransformationType.Proportional:return c=l/e.minDataValue,p=v(e.minSize,l),l=v(e.maxSize,l),t.clamp(c*p,p,l);case q.TransformationType.Stops:{const [b,f,m]=k(l,e.cache.ipData);b===f?l=v(e.stops[b].size,l):(c=v(e.stops[b].size,l),l=v(e.stops[f].size,l),l=c+(l-c)*m)}return l;case q.TransformationType.RealWorldSize:return c=r.meterIn[e.valueUnit],p=v(e.minSize,l),w=v(e.maxSize,
l),{valueRepresentation:e}=e,a=null,a="area"===e?2*Math.sqrt(l/x)/c:"radius"===e||"distance"===e?2*l/c:l/c,t.clamp(a,p,w);case q.TransformationType.Identity:return l;case q.TransformationType.Unknown:return null}}function v(l,e){return"number"===typeof l?l:z(e,l)}function k(l,e){if(e){var c=0,p=e.length-1;e.some((w,a)=>{if(l<w)return p=a,!0;c=a;return!1});return[c,p,(l-e[c])/(e[p]-e[c])]}}const x=Math.PI;n.getSizeForValueSimple=z;Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/schema/SourceSchema":function(){define(["exports",
"../../../../../core/sql"],function(n,t){n.createFeatureSourceSchema=function(r,q,z,v){const k=t.sqlAnd(r.definitionExpression,null!=r.subtypeCode?`${r.subtypeField} = ${r.subtypeCode}`:null),x=r.customParameters??{};v&&(x.token=v);return{type:"feature",mutable:{sourceRefreshVersion:z,availableFields:q.availableFields,dataFilter:{queryScaleRanges:r.queryScaleRanges??[],definitionExpression:k,gdbVersion:r.gdbVersion,historicMoment:r.historicMoment?.getTime(),timeExtent:r.timeExtent?.toJSON(),customParameters:x}}}};
Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/schema/processor/SimpleProcessorSchema":function(){define("exports ../../../../../../core/screenUtils ../../../../../../layers/support/OrderByInfo ../../../../engine/webgl/shaderGraph/techniques/TechniqueType ./LabelMatcherSchema ./MatcherSchema ./StorageSchema ./VisualVariablesSchema".split(" "),function(n,t,r,q,z,v,k,x){async function l(f,m){var d=m.renderer;const u=x.createVisualVariableUniforms(d);d=
await v.createMatcherSchema(f,d);f=await z.createLabelMatcherSchema(f,m,u);return{symbology:d,labels:f}}function e(f,m){return f.fields.map(d=>({...d.toJSON(),type:c(d,m)}))}function c(f,m){const {onStatisticExpression:d,onStatisticField:u,statisticType:y}=f;switch(y){case "min":case "max":case "avg":case "avg_angle":case "sum":case "count":return"esriFieldTypeDouble";case "mode":return d?({returnType:f}=d,f?"string"===f?"esriFieldTypeString":"esriFieldTypeDouble":"esriFieldTypeString"):(f=m.find(C=>
C.name===u))?f.type:"esriFieldTypeString"}}async function p(f,m,d,u,y){u=e(f,u.fields);var C=f.renderer;const H=await v.createMatcherSchema(m,C),I=k.createStorageSchema(C,[null,null]);C=x.createVisualVariableUniforms(C);m=await z.createLabelMatcherSchema(m,{geometryType:"polygon",labelingInfo:f.labelingInfo,labelsVisible:f.labelsVisible},C);C=b(H);f="geohash"===f.binType?{type:"geohash",fixBinLevel:f.fixedBinLevel??3}:{type:"grid",size:t.pt2px(f.size),fixedBinLevel:f.fixedBinLevel};return{storage:I,
mesh:{properties:{sortKey:null,timeZone:d.timeZone,returnMeshObjectId:C,displayRefreshVersion:y},strategy:{type:"binning",fields:u,index:f,featureFilter:d.filters[0]},factory:{labels:m,symbology:H}}}}async function w(f,m,d,u,y){const C=e(f,u.fields),H={type:"cluster",feature:await v.createMatcherSchema(m,f.effectiveFeatureRenderer),cluster:await v.createMatcherSchema(m,f.effectiveClusterRenderer)};var I=x.createVisualVariableUniforms(f.effectiveFeatureRenderer);m={type:"cluster",feature:await z.createLabelMatcherSchema(m,
u,I),cluster:await z.createLabelMatcherSchema(m,{geometryType:"point",labelingInfo:f.labelingInfo,labelsVisible:f.labelsVisible},I)};u=k.createStorageSchema(f.effectiveFeatureRenderer,[null,null]);I=b(H);return{storage:u,mesh:{properties:{sortKey:null,timeZone:d.timeZone,displayRefreshVersion:y,returnMeshObjectId:I},strategy:{type:"cluster",fields:C,featureFilter:d.filters[0],clusterRadius:t.pt2px(f.clusterRadius/2)},factory:{labels:m,symbology:H}}}}function a(f){return f.techniqueType===q.TechniqueType.AnimatedMarker}
function b(f){return"simple"===f.type&&f.meshes.some(a)||"interval"===f.type&&(f.intervals.some(m=>m.meshes.some(a))||f.backgroundFill.some(a))||"map"===f.type&&(f.map.some(m=>m.symbol.some(a))||f.backgroundFill.some(a))?!0:!1}n.createSimpleProcessorSchema=async function(f,m,d,u){var y=d.featureReduction;if(y)switch(y.type){case "binning":return p(y,f,m,d,u);case "cluster":return w(y,f,m,d,u)}y=d.orderBy;var C=d.renderer;C=null!=C&&"unique-value"===C.type&&C.orderByClassesEnabled;"default"!==y||C||
(y=[new r({field:d.objectIdField,order:"descending"})]);"default"!==y&&y?.length?(y=y[0],C="ascending"===y.order?"asc":"desc",y=y.field?{field:y.field,order:C}:y.valueExpression?{expression:y.valueExpression,order:C}:null):y=C?{byRenderer:!0,order:"asc"}:null;C=k.createStorageSchema(d.renderer,m.filters);f=await l(f,d);d=b(f.symbology);return{storage:C,mesh:{properties:{sortKey:y,timeZone:m.timeZone,returnMeshObjectId:d,displayRefreshVersion:u},strategy:{type:"feature"},factory:f}}};n.getAggregateFields=
e;Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/schema/processor/LabelMatcherSchema":function(){define(["exports","../../../../../../layers/support/labelingInfo","../../layerAdapters/geometryUtils","./symbols/SymbolSchema"],function(n,t,r,q){async function z(v,k,x,l){v=await q.createSymbolMeshSchemas(k,{path:`${x}`,schemaOptions:v,uniforms:l});return{maxScale:k.maxScale,minScale:k.minScale,expression:k.labelExpressionInfo?.expression??k.labelExpression,
where:k.where,meshes:v}}n.createLabelMatcherSchema=async function(v,k,x){var l=k.labelsVisible&&k.labelingInfo||[];k=r.getServiceGeometryType(k);l=t.validateLabelingInfo(l,k);return{type:"label",classes:await Promise.all(l.map((e,c)=>z(v,e,c,x)))}};Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/schema/processor/symbols/SymbolSchema":function(){define("exports ../../../../../../../symbols ../../../../../../../core/Logger ../../../../../../../core/screenUtils ../../../../../../../renderers/support/heatmapUtils ../../../../../../../symbols/cim/CIMSymbolHelper ../../../../../../../symbols/cim/enums ../../../../../../../symbols/cim/SDFHelper ../../../../../engine/webgl/alignmentUtils ../../../../../engine/webgl/color ../../../../../engine/webgl/definitions ../../../../../engine/webgl/shaderGraph/techniques/TechniqueRegistry ../schemaUtils ../VisualVariablesSchema ./ComplexSymbolSchema ./utils ../../../../../../../symbols/SimpleFillSymbol ../../../../../../../symbols/SimpleMarkerSymbol ../../../../../../../symbols/SimpleLineSymbol".split(" "),
function(n,t,r,q,z,v,k,x,l,e,c,p,w,a,b,f,m,d,u){async function y(h,B){if(!h)return[];switch(h.type){case "simple-fill":return G(h,B);case "picture-fill":{var {outline:E}=h;const {uniforms:S,schemaOptions:da}=B;var {store:M}=da,K=[];const fa=v.CIMSymbolHelper.createPictureFillRasterizationParam(h);if(fa){var {width:J,height:N,xoffset:W,yoffset:T,xscale:X,yscale:U}=h;h={color:[255,255,255,255],sprite:fa,height:N,aspectRatio:J/N,offsetX:W,offsetY:T,scaleX:X,scaleY:U,angle:0,applyRandomOffset:!1,sampleAlphaOnly:!1,
scaleProportionally:!1,effects:null,scaleInfo:null};"solid"===E?.style?h=[M.ensureInstance(p.Techniques.complexOutlineFill,{uniforms:{visualVariableColor:S.visualVariableColor,visualVariableOpacity:S.visualVariableOpacity,visualVariableSizeScaleStops:S.visualVariableSizeOutlineScaleStops,visualVariableSizeMinMaxValue:null,visualVariableSizeStops:null,visualVariableSizeUnitValue:null},optionalAttributes:{zoomRange:!1}}).createMeshInfo({...h,...I(E,!!S.visualVariableSizeOutlineScaleStops)})]:(M=M.ensureInstance(p.Techniques.complexFill,
{uniforms:{visualVariableColor:S.visualVariableColor,visualVariableOpacity:S.visualVariableOpacity},optionalAttributes:{zoomRange:!1}}),K.push(M.createMeshInfo(h)),E&&K.push(...D(E,B,!0)),h=K)}else h=[]}return h;case "simple-marker":return H(h,B);case "picture-marker":{const {uniforms:S,schemaOptions:da}=B;({store:B}=da);B=B.ensureInstance(p.Techniques.marker,{uniforms:{visualVariableColor:S.visualVariableColor,visualVariableOpacity:S.visualVariableOpacity,visualVariableSizeMinMaxValue:S.visualVariableSizeMinMaxValue,
visualVariableSizeScaleStops:S.visualVariableSizeScaleStops,visualVariableSizeStops:S.visualVariableSizeStops,visualVariableSizeUnitValue:S.visualVariableSizeUnitValue,visualVariableRotation:S.visualVariableRotation},optionalAttributes:{zoomRange:!1}});h=(E=v.CIMSymbolHelper.createPictureMarkerRasterizationParam(h))?[B.createMeshInfo({type:"picture",color:[255,255,255,255],height:h.height,width:h.width,offsetX:h.xoffset,offsetY:h.yoffset,angle:h.angle,alignment:f.hasRotationVVUniform(S)?k.Alignment.MAP:
k.Alignment.SCREEN,outlineColor:null,outlineSize:0,referenceSize:h.height,sprite:E,overrideOutlineColor:!1,hasSizeVV:f.hasSizeVVUniform(S),placement:null,effects:null,transforms:null,scaleInfo:null,minPixelBuffer:a.getMaxSizeVVSize(S)})]:[]}return h;case "simple-line":return D(h,B,!1);case "text":const {uniforms:Q,schemaOptions:ea}=B;({store:B}=ea);return[B.ensureInstance(p.Techniques.text,{uniforms:{visualVariableColor:Q.visualVariableColor,visualVariableOpacity:Q.visualVariableOpacity,visualVariableRotation:Q.visualVariableRotation,
visualVariableSizeMinMaxValue:Q.visualVariableSizeMinMaxValue,visualVariableSizeScaleStops:Q.visualVariableSizeScaleStops,visualVariableSizeStops:Q.visualVariableSizeStops,visualVariableSizeUnitValue:Q.visualVariableSizeUnitValue},optionalAttributes:{zoomRange:!1,clipAngle:!1,referenceSymbol:!1}}).createMeshInfo({boxBackgroundColor:h.backgroundColor?.toArray(),boxBorderLineColor:h.borderLineColor?.toArray(),boxBorderLineSize:h.borderLineSize??0,color:h.color?.toArray()??[0,0,0,0],offsetX:h.xoffset,
offsetY:h.yoffset,postAngle:h.angle,fontSize:h.font.size,decoration:h.font.decoration,haloColor:h.haloColor?.toArray()??[0,0,0,0],haloSize:h.haloSize??0,outlineColor:[0,0,0,0],outlineSize:0,lineWidth:h.lineWidth,lineHeightRatio:h.lineHeight,horizontalAlignment:h.horizontalAlignment,verticalAlignment:h.verticalAlignment,useCIMAngleBehavior:!1,glyphs:{type:"text-rasterization-param",resource:{type:"text",font:h.font.toJSON(),textString:h.text,symbol:v.CIMSymbolHelper.createCIMTextSymbolfromTextSymbol(h)},
overrides:[]},referenceSize:null,effects:null,placement:null,scaleInfo:null,transforms:null,scaleFactor:1,minPixelBuffer:a.getMaxSizeVVSize(Q),repeatLabel:null,repeatLabelDistance:null,allowOverrun:null,labelPosition:null})];case "label":const {schemaOptions:aa,uniforms:Y}=B;({store:K}=aa);B=h.symbol;const {allowOverrun:ca,repeatLabel:R,repeatLabelDistance:ha}=h;E={maxScale:h.maxScale??0,minScale:h.minScale??0};K=K.ensureInstance(p.Techniques.label,{uniforms:{visualVariableColor:null,visualVariableOpacity:null,
visualVariableRotation:Y.visualVariableRotation,visualVariableSizeMinMaxValue:Y.visualVariableSizeMinMaxValue,visualVariableSizeScaleStops:Y.visualVariableSizeScaleStops,visualVariableSizeStops:Y.visualVariableSizeStops,visualVariableSizeUnitValue:Y.visualVariableSizeUnitValue},optionalAttributes:{zoomRange:!0,clipAngle:!0,referenceSymbol:!0}});const [ia,ja]=l.getAlignmentFromPlacement(h.labelPlacement);return[K.createMeshInfo({boxBackgroundColor:B.backgroundColor?.toArray(),boxBorderLineColor:B.borderLineColor?.toArray(),
boxBorderLineSize:B.borderLineSize??0,color:B.color?.toArray()??[0,0,0,0],offsetX:B.xoffset,offsetY:B.yoffset,postAngle:B.angle,fontSize:B.font.size,decoration:B.font.decoration,outlineColor:[0,0,0,0],outlineSize:0,haloColor:B.haloColor?.toArray()??[0,0,0,0],haloSize:B.haloSize??0,lineWidth:B.lineWidth,lineHeightRatio:B.lineHeight,horizontalAlignment:ia,verticalAlignment:ja,repeatLabel:R,repeatLabelDistance:q.pt2px(ha),allowOverrun:ca,labelPosition:h.labelPosition,scaleInfo:E,minPixelBuffer:a.getMaxSizeVVSize(Y),
useCIMAngleBehavior:!1,glyphs:{type:"text-rasterization-param",resource:{type:"text",font:B.font.toJSON(),textString:B.text,symbol:v.CIMSymbolHelper.createCIMTextSymbolfromTextSymbol(B),primitiveName:"label-override"},useLegacyLabelEvaluationRules:null==h.labelExpressionInfo?.expression,overrides:[{type:"CIMPrimitiveOverride",valueExpressionInfo:{type:"CIMExpressionInfo",expression:h.labelExpressionInfo?.expression??h.labelExpression,returnType:"String"},primitiveName:"label-override",propertyName:"textString",
defaultValue:""}]},referenceSize:null,effects:null,placement:null,transforms:null,scaleFactor:1})];case "cim":return b.createComplexSymbolInstances(h.data,B);case "web-style":return h=await h.fetchCIMSymbol(),b.createComplexSymbolInstances(h.data,B);case "line-3d":return r.getLogger("esri.views.layers.FeatureLayerView").warn("unsupported-symbol",`Symbol of type "${h.type}" unsupported in MapView. Defaulting to simple-line`),D(new u,B,!1);case "point-3d":return r.getLogger("esri.views.layers.FeatureLayerView").warn("unsupported-symbol",
`Symbol of type "${h.type}" unsupported in MapView. Defaulting to simple-marker`),H(new d,B);case "polygon-3d":return r.getLogger("esri.views.layers.FeatureLayerView").warn("unsupported-symbol",`Symbol of type "${h.type}" unsupported in MapView. Defaulting to simple-fill`),G(new m,B);case "mesh-3d":case "label-3d":return r.getLogger("esri.views.layers.FeatureLayerView").warn("unsupported-symbol",`Symbol of type "${h.type}" unsupported in MapView. Ignoring`),[];case "CIMSymbolReference":throw Error("InternalError: CIMSymbolReference should already be resolved");
}}function C(h){if("path"===h.style){if(null==h.path)throw Error("Symbol with a style of type path must define a path");return{type:"sprite-rasterization-param",overrides:[],resource:{type:"path",path:h.path,asFill:!0}}}const B=v.CIMSymbolHelper.fromSimpleMarker(h);if("outline"in h&&h.outline&&"none"!==h.outline.style&&"solid"!==h.outline.style){if(!B||!B.symbolLayers)throw Error("Error handling marker! ");return{type:"sprite-rasterization-param",resource:B.symbolLayers[0],overrides:[]}}return{type:"sprite-rasterization-param",
resource:x.getSDFInfo(B),overrides:[]}}async function H(h,B){const {uniforms:E,schemaOptions:M}=B;var {store:K}=M;if("path"===h.style||h.outline&&"solid"!==h.outline.style&&"none"!==h.outline.style){K=v.CIMSymbolHelper.fromSimpleMarker(h);if(!K||!K.symbolLayers)throw Error("Error handling marker! ");E.visualVariableRotation&&(K.angleAlignment="Map");if("path"!==h.style){var J=K.symbolLayers[0];if(f.hasSizeVVUniform(B.uniforms)){var N=a.getMaxSizeVVSize(B.uniforms,0,1);N>J.size&&(h=N/J.size,J.size=
N,J=J.markerGraphics?.[0].symbol,(J.symbolLayers&&J.symbolLayers[0]).width*=h)}}return b.createComplexSymbolInstances({type:"CIMSymbolReference",symbol:K},B)}B=K.ensureInstance(p.Techniques.marker,{uniforms:{visualVariableColor:E.visualVariableColor,visualVariableOpacity:E.visualVariableOpacity,visualVariableSizeMinMaxValue:E.visualVariableSizeMinMaxValue,visualVariableSizeScaleStops:E.visualVariableSizeScaleStops,visualVariableSizeStops:E.visualVariableSizeStops,visualVariableSizeUnitValue:E.visualVariableSizeUnitValue,
visualVariableRotation:E.visualVariableRotation},optionalAttributes:{zoomRange:!1}});K=C(h);J=h.color?.toArray()??[0,0,0,0];"CIMVectorMarker"===K.resource.type&&(J=[255,255,255,255]);N=h.size;const W=null!=E.visualVariableColor&&("cross"===h.style||"x"===h.style);return[B.createMeshInfo({type:"simple",color:J,height:N,width:N*("triangle"===h.style?124/116:1),offsetX:h.xoffset,offsetY:h.yoffset,angle:h.angle,alignment:f.hasRotationVVUniform(E)?k.Alignment.MAP:k.Alignment.SCREEN,outlineColor:h.outline?.color?.toArray()??
[0,0,0,0],outlineSize:h.outline?.width??1,referenceSize:N,sprite:K,overrideOutlineColor:W,hasSizeVV:f.hasSizeVVUniform(E),placement:null,effects:null,transforms:null,scaleInfo:null,minPixelBuffer:a.getMaxSizeVVSize(E)})]}function I(h,B){const E=h.width;return{outlineColor:h.color?.toArray()||[0,0,0,1],width:E,referenceWidth:E,capType:h.cap??"round",joinType:h.join??"round",miterLimit:h.miterLimit,hasSizeVV:B}}async function G(h,B){if("cim"===h.type)return b.createComplexSymbolInstances(h.data,B);
var {style:E}=h;if(E&&"none"!==E&&"solid"!==E){{const {uniforms:J,schemaOptions:N}=B;var {store:M}=N;E=h.color?.toArray()??[0,0,0,0];var K={type:"sprite-rasterization-param",resource:{type:"fill-style",style:h.style},overrides:[]};"solid"===h.outline?.style?h=[M.ensureInstance(p.Techniques.patternOutlineFill,{uniforms:{visualVariableColor:J.visualVariableColor,visualVariableOpacity:J.visualVariableOpacity,visualVariableSizeScaleStops:J.visualVariableSizeOutlineScaleStops,visualVariableSizeMinMaxValue:null,
visualVariableSizeStops:null,visualVariableSizeUnitValue:null},optionalAttributes:{zoomRange:!1}}).createMeshInfo({color:E,...I(h.outline,!!J.visualVariableSizeOutlineScaleStops),sprite:K,scaleInfo:null,effects:null})]:(E=[],M=M.ensureInstance(p.Techniques.patternFill,{uniforms:{visualVariableColor:J.visualVariableColor,visualVariableOpacity:J.visualVariableOpacity},optionalAttributes:{zoomRange:!1}}).createMeshInfo({color:h.color?.toArray()??[0,0,0,0],sprite:K,scaleInfo:null,effects:null}),E.push(M),
h.outline&&E.push(...D(h.outline,B,!0)),h=E)}return h}{const {uniforms:J,schemaOptions:N}=B;({store:M}=N);K=h.color?.toArray()??[0,0,0,0];"none"!==h.style&&"solid"===h.outline?.style?h=[M.ensureInstance(p.Techniques.outlineFill,{uniforms:{visualVariableColor:J.visualVariableColor,visualVariableOpacity:J.visualVariableOpacity,visualVariableSizeScaleStops:J.visualVariableSizeOutlineScaleStops,visualVariableSizeMinMaxValue:null,visualVariableSizeStops:null,visualVariableSizeUnitValue:null},optionalAttributes:{zoomRange:!1}}).createMeshInfo({color:K,
...I(h.outline,!!J.visualVariableSizeOutlineScaleStops),scaleInfo:null,effects:null})]:(E=[],"none"!==h.style&&(M=M.ensureInstance(p.Techniques.fill,{uniforms:{visualVariableColor:J.visualVariableColor,visualVariableOpacity:J.visualVariableOpacity},optionalAttributes:{zoomRange:!1}}).createMeshInfo({color:K,scaleInfo:null,effects:null}),E.push(M)),h.outline&&E.push(...D(h.outline,B,!0)),h=E)}return h}function D(h,B,E){const {color:M,style:K,width:J,cap:N,join:W}=h;var {schemaOptions:T}=B,{store:X}=
T;T=[];var U=E?{...a.noVisualVariables,visualVariableSizeScaleStops:B.uniforms.visualVariableSizeOutlineScaleStops}:B.uniforms;E={uniforms:{visualVariableColor:U.visualVariableColor,visualVariableOpacity:U.visualVariableOpacity,visualVariableSizeMinMaxValue:U.visualVariableSizeMinMaxValue,visualVariableSizeScaleStops:U.visualVariableSizeScaleStops,visualVariableSizeStops:U.visualVariableSizeStops,visualVariableSizeUnitValue:U.visualVariableSizeUnitValue},optionalAttributes:{zoomRange:!1}};U={color:M?.toArray()??
[0,0,0,0],width:J,referenceWidth:J,capType:N,joinType:W,miterLimit:h.miterLimit,hasSizeVV:f.hasSizeVVUniform(U),effects:null,scaleInfo:null};null==K||"solid"===K?(X=X.ensureInstance(p.Techniques.line,E).createMeshInfo(U),T.push(X)):"none"!==K&&(X=X.ensureInstance(p.Techniques.texturedLine,E).createMeshInfo({...U,offsetAlongLine:0,shouldScaleDash:!0,shouldSampleAlphaOnly:!1,isSDF:!0,sprite:{type:"sprite-rasterization-param",resource:{type:"dash",dashTemplate:v.slsDashToTemplateArray(K,N)},overrides:[]}}),
T.push(X));if(null!=h.marker){X=T.push;E=h.marker;const {uniforms:Q,schemaOptions:ea}=B;({store:B}=ea);B=B.ensureInstance(p.Techniques.marker,{uniforms:{visualVariableColor:Q.visualVariableColor,visualVariableOpacity:Q.visualVariableOpacity,visualVariableSizeMinMaxValue:Q.visualVariableSizeMinMaxValue,visualVariableSizeScaleStops:Q.visualVariableSizeScaleStops,visualVariableSizeStops:Q.visualVariableSizeStops,visualVariableSizeUnitValue:Q.visualVariableSizeUnitValue,visualVariableRotation:Q.visualVariableRotation},
optionalAttributes:{zoomRange:!1}});U=C(E);const aa=6*h.width,Y=E.color?.toArray()??h.color?.toArray()??[0,0,0,0],ca="cross"===E.style||"x"===E.style;switch(E.placement){case "begin-end":E=k.ExtremityPlacement.Both;break;case "begin":E=k.ExtremityPlacement.JustBegin;break;case "end":E=k.ExtremityPlacement.JustEnd;break;default:E=k.ExtremityPlacement.None}E={type:"cim-marker-placement-param",placement:{type:"CIMMarkerPlacementAtExtremities",angleToLine:!0,offset:0,extremityPlacement:E,offsetAlongLine:0},
overrides:[]};h=[B.createMeshInfo({type:"simple",color:Y,height:aa,width:aa,offsetX:0,offsetY:0,angle:0,alignment:f.hasRotationVVUniform(Q)?k.Alignment.MAP:k.Alignment.SCREEN,outlineColor:Y,outlineSize:ca?h.width:0,referenceSize:aa/6,sprite:U,overrideOutlineColor:ca&&null!=Q.visualVariableColor,hasSizeVV:f.hasSizeVVUniform(Q),placement:E,transforms:null,effects:null,scaleInfo:null,minPixelBuffer:a.getMaxSizeVVSize(Q)})];X.call(T,...h)}return T}n.createDotDensityMeshSchemas=async function(h,B){var {schemaOptions:E}=
B;({store:E}=E);var M=Array(c.dotDensityMaxFields),K=Array(c.dotDensityMaxFields/4);for(var J=0;J<c.dotDensityMaxFields;J++){const N=J<h.attributes.length?h.attributes[J].color:null;M[J]=[0,0,0,0];e.writeColor(M[J],N)}for(J=0;J<c.dotDensityMaxFields/4;J++)K[J]=[0,0,0,0],K[J][0]=4*J<h.attributes.length?1:0,K[J][1]=4*J+1<h.attributes.length?1:0,K[J][2]=4*J+2<h.attributes.length?1:0,K[J][3]=4*J+3<h.attributes.length?1:0;M=E.ensureInstance(p.Techniques.dotDensity,{uniforms:{isActive:K,colors:M,dotValue:h.dotValue,
dotScale:h.referenceScale,blending:h.dotBlendingEnabled,dotSize:h.dotSize,seed:h.seed},optionalAttributes:{}}).createMeshInfo({effects:null});E=[];K=new m({color:h.backgroundColor??[0,0,0,0],outline:null});K=await y(K,B);E.push(...K);E.push(M);h.outline&&(h=D(h.outline,B,!0),E.push(...h));return E};n.createHeatmapMeshSchemas=async function(h,B){({store:B}=B);const {radius:E,minDensity:M,maxDensity:K,referenceScale:J,field:N,valueExpression:W,colorStops:T}=h;h=z.generateGradient(T);return[B.ensureInstance(p.Techniques.heatmap,
{uniforms:{radius:q.pt2px(E),minDensity:M,maxDensity:K,referenceScale:J,isFieldActive:!(!N&&!W),gradient:h,gradientHash:h.join(",")},optionalAttributes:{}}).createMeshInfo({effects:null})]};n.createLineInstance=D;n.createPieChartMeshSchemas=async function(h,B){var {store:E}=B;const M=h.outline?.width||0,K=a.createVisualVariableUniforms(h);E=E.ensureInstance(p.Techniques.pieChart,{uniforms:{shader:{outlineWidth:Math.round(q.pt2px(M)),defaultColor:w.premultiplyColor(h.defaultColor),outlineColor:w.premultiplyColor(h.outline?.color),
othersColor:w.premultiplyColor(h.othersCategory?.color),donutRatio:h.holePercentage,sectorThreshold:h.othersCategory?.threshold||0,colors:h.attributes.map(J=>w.premultiplyColor(J.color)),visualVariableOpacity:K.visualVariableOpacity,visualVariableSizeMinMaxValue:K.visualVariableSizeMinMaxValue,visualVariableSizeScaleStops:K.visualVariableSizeScaleStops,visualVariableSizeStops:K.visualVariableSizeStops,visualVariableSizeUnitValue:K.visualVariableSizeUnitValue,hittestUniforms:null},numberOfFields:h.attributes.length},
optionalAttributes:{}}).createMeshInfo({size:h.size,outlineWidth:M,effects:null,scaleInfo:null,minPixelBuffer:a.getMaxSizeVVSize(K)});return[...(h.backgroundFillSymbol?await G(h.backgroundFillSymbol,{schemaOptions:B,path:"",uniforms:a.noVisualVariables}):[]),E]};n.createSymbolMeshSchemas=y;Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/schema/processor/MatcherSchema":function(){define(["exports","./VisualVariablesSchema","./symbols/SymbolSchema"],function(n,
t,r){async function q(e,c){var p=c.getSymbols();p=p.length?p[0]:null;c=t.createVisualVariableUniforms(c);return{type:"simple",meshes:await r.createSymbolMeshSchemas(p,{schemaOptions:e,uniforms:c,path:"renderer.symbol"})}}async function z(e,c){const p=t.createVisualVariableUniforms(c);return{type:"dot-density",meshes:await r.createDotDensityMeshSchemas(c,{schemaOptions:e,uniforms:p,path:"renderer.symbol"})}}async function v(e,c){const p=t.createVisualVariableUniforms(c);var w=c.backgroundFillSymbol,
a=c.normalizationType;a="log"===a?"esriNormalizeByLog":"percent-of-total"===a?"esriNormalizeByPercentOfTotal":"field"===a?"esriNormalizeByField":null;var b=c.classBreakInfos.map(async m=>({meshes:await r.createSymbolMeshSchemas(m.symbol,{path:`renderer-stop-${m.minValue}-${m.maxValue}`,schemaOptions:e,uniforms:p}),min:m.minValue,max:m.maxValue}));b=(await Promise.all(b)).sort((m,d)=>m.min-d.min);w=await r.createSymbolMeshSchemas(w,{schemaOptions:e,path:"renderer.backgroundFill",uniforms:{...t.noVisualVariables,
visualVariableSizeOutlineScaleStops:p.visualVariableSizeOutlineScaleStops}});const f=await r.createSymbolMeshSchemas(c.defaultSymbol,{schemaOptions:e,path:"renderer.defaultSymbol",uniforms:p});return{type:"interval",field:c.field,expression:c.valueExpression,backgroundFill:w,defaultSymbol:f,intervals:b,normalizationField:c.normalizationField,normalizationTotal:c.normalizationTotal,normalizationType:a,isMaxInclusive:c.isMaxInclusive}}async function k(e,c){const p=[],w=t.createVisualVariableUniforms(c),
a=await r.createSymbolMeshSchemas(c.backgroundFillSymbol,{schemaOptions:e,path:"renderer.backgroundFill",uniforms:{...t.noVisualVariables,visualVariableSizeOutlineScaleStops:w.visualVariableSizeOutlineScaleStops}}),b=await r.createSymbolMeshSchemas(c.defaultSymbol,{schemaOptions:e,path:"renderer.defaultSymbol",uniforms:w});for(const f of c.uniqueValueInfos??[]){const m=await r.createSymbolMeshSchemas(f.symbol,{path:`renderer-unique-value-${f.value}`,schemaOptions:e,uniforms:w});p.push({value:""+f.value,
symbol:m})}return{type:"map",field:c.field,expression:c.valueExpression,field2:c.field2,field3:c.field3,fieldDelimiter:c.fieldDelimiter,backgroundFill:a,defaultSymbol:b,map:p}}async function x(e,c){return{type:"heatmap",meshes:await r.createHeatmapMeshSchemas(c,e)}}async function l(e,c){return{type:"pie-chart",meshes:await r.createPieChartMeshSchemas(c,e)}}n.createMatcherSchema=async function(e,c){if(!c)return{type:"simple",meshes:[]};switch(c.type){case "simple":return q(e,c);case "dot-density":return z(e,
c);case "class-breaks":return v(e,c);case "unique-value":return k(e,c);case "dictionary":e=t.createVisualVariableUniforms(c);const p=c.scaleExpression;return{type:"dictionary",fieldMap:c.fieldMap,scaleExpression:null!=p&&"1"!==p?{valueExpressionInfo:{type:"CIMExpressionInfo",expression:c.scaleExpression,returnType:"Numeric"},defaultValue:1}:void 0,visualVariableUniforms:e};case "heatmap":return x(e,c);case "pie-chart":return l(e,c)}};n.createSimpleMatcherSchemaFromSymbol=async function(e,c,p){return{type:"simple",
meshes:await r.createSymbolMeshSchemas(c,{schemaOptions:e,path:p,uniforms:{visualVariableColor:null,visualVariableOpacity:null,visualVariableRotation:null,visualVariableSizeStops:null,visualVariableSizeScaleStops:null,visualVariableSizeOutlineScaleStops:null,visualVariableSizeUnitValue:null,visualVariableSizeMinMaxValue:null}})}};Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/layerAdapters/FeatureLayerAdapter":function(){define("exports ../../../../../core/has ../../../../../core/lang ../../../../../layers/support/arcgisLayerUrl ./featureReductionUtils ./featureServiceUtils ./floorFilterUtils ./geometryUtils ./labelingUtils ../schema/SourceSchema ../schema/processor/SimpleProcessorSchema ../support/rendererUtils".split(" "),
function(n,t,r,q,z,v,k,x,l,e,c,p){class w{constructor(a){this.layer=a}getLabelingDeconflictionInfo(a){const b=this.layer;a=l.getFeatureReductionDeconflictionEnabled(b,a)??l.getLayerDeconflictionEnabled(b);return[{vvEvaluators:{0:l.createLabelVVEvaluator(b.renderer)},deconflictionEnabled:a}]}async createServiceOptions(a){var b=this.layer;const {capabilities:f,editingInfo:m,objectIdField:d,typeIdField:u,globalIdField:y,datesInUnknownTimezone:C,orderBy:H,subtypeField:I,refreshInterval:G}=b,D=b.fieldsIndex.toJSON(),
h=x.getServiceGeometryType(b),B=b.timeInfo?.toJSON(),E=b.spatialReference.toJSON(),M=b.types?.map(T=>T.toJSON()),K=r.clone(this.layer.parsedUrl);this.layer.dynamicDataSource&&(K.query={layer:JSON.stringify({source:this.layer.dynamicDataSource})});let J=this.layer.objectIdField;if(H?.length){var N=!H[0].valueExpression&&H[0].field;N&&(J=N)}N=null==m?.lastEditDate&&0<G;b=(N=!!t("featurelayer-snapshot-enabled")&&"point"===b.geometryType&&f?.query.supportsPagination&&!f?.operations.supportsEditing&&!N)&&
v.exceedsMinimumSnapshotCoverage(a,b.fullExtent);const W=q.isHostedAgolService(K.path);return{type:"feature-service",source:K,isSourceHosted:W,orderByFields:J,outSpatialReference:a.spatialReference.toJSON(),metadata:{typeIdField:u??void 0,types:M,timeReferenceUnknownClient:C,subtypeField:I,globalIdField:y,fieldsIndex:D,geometryType:h,objectIdField:d,timeInfo:B,spatialReference:E,subtypes:this.layer.subtypes?.map(T=>T.toJSON())},queryMetadata:{maxRecordCount:f.query.maxRecordCount,supportsCompactGeometry:f.query.supportsCompactGeometry,
supportsDefaultSpatialReference:f.query.supportsDefaultSpatialReference,supportsFormatPBF:f.query.supportsFormatPBF,supportsMaxRecordCountFactor:f.query.supportsMaxRecordCountFactor,supportsQuantization:f.query.supportsQuantization,lastEditDate:m?.lastEditDate?.getTime(),snapshotInfo:{supportsSnapshotMinThreshold:N,supportsSnapshotMaxThreshold:b,snapshotCountThresholds:{min:t("featurelayer-snapshot-point-min-threshold"),max:t("featurelayer-snapshot-point-max-threshold")}}}}}createSourceSchema(a,b){const {definitionExpression:f,
customParameters:m,gdbVersion:d,historicMoment:u,subtypeCode:y,subtypeField:C,timeExtent:H,apiKey:I}=this.layer;return e.createFeatureSourceSchema({definitionExpression:f,customParameters:m,gdbVersion:d,historicMoment:u,subtypeCode:y,subtypeField:C,timeExtent:H},a,b,I)}createProcessorSchema(a,b,f){const {fields:m,renderer:d,geometryType:u,labelingInfo:y,labelsVisible:C,orderBy:H,objectIdField:I}=this.layer,G={fields:m.map(D=>D.toJSON()),renderer:d?.clone(),featureReduction:z.getEffectiveFeatureReduction(this.layer,
b),geometryType:u,labelingInfo:y,labelsVisible:C,objectIdField:I,orderBy:H??"default"};return c.createSimpleProcessorSchema(a,b,G,f)}get hasRequiredSupport(){return p.isRendererSupported(this.layer.renderer)}get timeOptions(){return this.layer}hasFilters(a){return k.hasFloorFilter(this.layer,a)}addFilters(a,b){return k.addFloorFilter(this.layer,a,b)}getUpdateHashProperties(a){var b=this.layer;const {definitionExpression:f,renderer:m,gdbVersion:d,apiKey:u,subtypeCode:y}=b,C=this.layer.labelsVisible?
this.layer.labelingInfo:null,H=b.historicMoment?.getTime()??void 0,I=JSON.stringify(b.customParameters),G=z.getEffectiveFeatureReduction(b,a);b=JSON.stringify(b.orderBy);a=k.hasFloorFilter(this.layer,a)?a.floors:null;return{outFields:this.layer.outFields,apiKey:u,customParameters:I,definitionExpression:f,featureReduction:G,floors:a,gdbVersion:d,historicMoment:H,labelingInfo:C,orderBy:b,renderer:m,subtypeCode:y}}}n.FeatureLayerAdapter=w;Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},
"esri/views/2d/layers/features/layerAdapters/featureServiceUtils":function(){define(["exports","../../../../../core/has"],function(n,t){n.exceedsMinimumSnapshotCoverage=function(r,q){r=r.extent;r=q?.clone().intersection(r);r=null!=r?r.width*r.height:0;q=q?q.width*q.height:0;q=0===q?0:r/q;r=t("featurelayer-snapshot-point-coverage");return!isNaN(q)&&q>=r};Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/layerAdapters/floorFilterUtils":function(){define(["exports",
"../../../../../core/sql","../../../../../layers/support/FeatureFilter"],function(n,t,r){function q(z,v,k){if(null==z.floorInfo||!k.floors?.length)return v;k=k.floors;const {floorField:x,viewAllLevelIds:l}=z.floorInfo;l.length&&(k=l);z=k.filter(e=>""!==e).map(e=>"'"+e+"'");z.push("''");v?.includes(x)&&(k=new RegExp("AND \\("+x+".*NULL\\)","g"),v=v.replace(k,""),k=new RegExp("\\("+x+".*NULL\\)","g"),v=v.replace(k,""),v=v.replaceAll(/\s+/g," ").trim());z=("("+x+" IN ({ids}) OR "+x+" IS NULL)").replace("{ids}",
z.join(", "));return t.sqlAnd(v,z)}n.addFloorFilter=function(z,v,k){z=q(z,v?.where,k);if(!z)return v;v??=new r;v.where=z;return v};n.hasFloorFilter=function(z,v){return null!=z.floorInfo&&(0<z.floorInfo.viewAllLevelIds.length||0<v.floors.length)};Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/layerAdapters/InMemoryLayerAdapter":function(){define("exports ../../../../../core/Error ./featureReductionUtils ./geometryUtils ./labelingUtils ../schema/SourceSchema ../schema/processor/SimpleProcessorSchema ../support/rendererUtils".split(" "),
function(n,t,r,q,z,v,k,x){class l{constructor(e){this.layer=e}getLabelingDeconflictionInfo(e){const c=this.layer;e=z.getFeatureReductionDeconflictionEnabled(c,e)??z.getLayerDeconflictionEnabled(c);return[{vvEvaluators:{0:z.createLabelVVEvaluator(c.renderer)},deconflictionEnabled:e}]}async createServiceOptions(e){const c=this.layer,{capabilities:p,objectIdField:w}=c,a=c.fieldsIndex.toJSON(),b=q.getServiceGeometryType(c),f=c.timeInfo?.toJSON(),m=c.spatialReference.toJSON();if(!("openPorts"in c.source))throw new t("source-not-supported");
return{type:"memory",source:await c.source.openPorts(),orderByFields:w,outSpatialReference:e.spatialReference.toJSON(),metadata:{fieldsIndex:a,geometryType:b,objectIdField:w,timeInfo:f,spatialReference:m,subtypes:null,subtypeField:null,globalIdField:null,typeIdField:null,types:null,timeReferenceUnknownClient:null},queryMetadata:{maxRecordCount:p.query.maxRecordCount,supportsCompactGeometry:p.query.supportsCompactGeometry,supportsDefaultSpatialReference:p.query.supportsDefaultSpatialReference,supportsFormatPBF:p.query.supportsFormatPBF,
supportsMaxRecordCountFactor:p.query.supportsMaxRecordCountFactor,supportsQuantization:p.query.supportsQuantization,lastEditDate:null,snapshotInfo:null}}}createSourceSchema(e,c){const {definitionExpression:p,timeExtent:w}=this.layer;return v.createFeatureSourceSchema({definitionExpression:p,timeExtent:w,customParameters:null},e,c,null)}createProcessorSchema(e,c,p){const {fields:w,renderer:a,geometryType:b,labelingInfo:f,labelsVisible:m,orderBy:d,objectIdField:u}=this.layer,y={fields:w.map(C=>C.toJSON()),
renderer:a?.clone(),featureReduction:r.getEffectiveFeatureReduction(this.layer,c),geometryType:b,labelingInfo:f,labelsVisible:m,objectIdField:u,orderBy:d??"default"};return k.createSimpleProcessorSchema(e,c,y,p)}get hasRequiredSupport(){return x.isRendererSupported(this.layer.renderer)}get timeOptions(){return this.layer}getUpdateHashProperties(e){var c=this.layer;const {definitionExpression:p,renderer:w}=c,a=this.layer.labelsVisible?this.layer.labelingInfo:null;e=r.getEffectiveFeatureReduction(c,
e);c=JSON.stringify(c.orderBy);return{outFields:this.layer.outFields,orderBy:c,definitionExpression:p,renderer:w,labelingInfo:a,featureReduction:e}}}n.InMemoryLayerAdapter=l;Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/layerAdapters/KnowledgeGraphSublayerAdapter":function(){define("exports ./featureReductionUtils ./geometryUtils ./labelingUtils ../schema/SourceSchema ../schema/processor/SimpleProcessorSchema ../support/rendererUtils".split(" "),function(n,
t,r,q,z,v,k){class x{constructor(l){this.layer=l}getLabelingDeconflictionInfo(l){const e=this.layer;l=q.getFeatureReductionDeconflictionEnabled(e,l)??q.getLayerDeconflictionEnabled(e);return[{vvEvaluators:{0:q.createLabelVVEvaluator(e.renderer)},deconflictionEnabled:l}]}async createServiceOptions(l){const e=this.layer,{capabilities:c,objectIdField:p}=e,w=e.fieldsIndex.toJSON(),a=r.getServiceGeometryType(e),b=e.spatialReference.toJSON();return{type:"memory",source:await e.source.openPorts(),orderByFields:p,
outSpatialReference:l.spatialReference.toJSON(),metadata:{fieldsIndex:w,geometryType:a,objectIdField:p,spatialReference:b,globalIdField:null,subtypeField:null,subtypes:null,timeInfo:e.timeInfo?.toJSON(),timeReferenceUnknownClient:null,typeIdField:null,types:null},queryMetadata:{maxRecordCount:c.query.maxRecordCount,supportsCompactGeometry:c.query.supportsCompactGeometry,supportsDefaultSpatialReference:c.query.supportsDefaultSpatialReference,supportsFormatPBF:c.query.supportsFormatPBF,supportsMaxRecordCountFactor:c.query.supportsMaxRecordCountFactor,
supportsQuantization:c.query.supportsQuantization,lastEditDate:null,snapshotInfo:null}}}createSourceSchema(l,e){const {definitionExpression:c}=this.layer;return z.createFeatureSourceSchema({definitionExpression:c,customParameters:null},l,e,null)}createProcessorSchema(l,e,c){const {fields:p,renderer:w,geometryType:a,labelingInfo:b,labelsVisible:f,objectIdField:m}=this.layer,d={fields:p.map(u=>u.toJSON()),renderer:w?.clone(),featureReduction:t.getEffectiveFeatureReduction(this.layer,e),geometryType:a,
labelingInfo:b,labelsVisible:f,objectIdField:m,orderBy:"default"};return v.createSimpleProcessorSchema(l,e,d,c)}get hasRequiredSupport(){return k.isRendererSupported(this.layer.renderer)}get timeOptions(){return this.layer}getUpdateHashProperties(l){const e=this.layer,{definitionExpression:c,renderer:p}=e,w=this.layer.labelsVisible?this.layer.labelingInfo:null;l=t.getEffectiveFeatureReduction(e,l);return{definitionExpression:c,renderer:p,labelingInfo:w,featureReduction:l}}}n.KnowledgeGraphSublayerAdapter=
x;Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/layerAdapters/OGCFeatureLayerAdapter":function(){define("exports ../../../../../core/lang ./featureReductionUtils ./geometryUtils ./labelingUtils ../schema/SourceSchema ../schema/processor/SimpleProcessorSchema ../support/rendererUtils".split(" "),function(n,t,r,q,z,v,k,x){class l{constructor(e){this.layer=e}getLabelingDeconflictionInfo(e){const c=this.layer;e=z.getFeatureReductionDeconflictionEnabled(c,
e)??z.getLayerDeconflictionEnabled(c);return[{vvEvaluators:{0:z.createLabelVVEvaluator(c.renderer)},deconflictionEnabled:e}]}async createServiceOptions(e){var c=this.layer;const {capabilities:p,objectIdField:w}=c,a=c.fieldsIndex.toJSON(),b=q.getServiceGeometryType(c),f=c.timeInfo?.toJSON(),m=c.spatialReference.toJSON();c=c.source.getSource();const d=this.layer.objectIdField,u=t.clone(p);u.query.maxRecordCount=c.maxRecordCount;return{type:"ogc",source:c,orderByFields:d,outSpatialReference:e.spatialReference.toJSON(),
metadata:{fieldsIndex:a,geometryType:b,objectIdField:w,timeInfo:f,spatialReference:m,globalIdField:null,subtypeField:null,subtypes:null,timeReferenceUnknownClient:null,typeIdField:null,types:null},queryMetadata:{maxRecordCount:u.query.maxRecordCount,supportsCompactGeometry:u.query.supportsCompactGeometry,supportsDefaultSpatialReference:u.query.supportsDefaultSpatialReference,supportsFormatPBF:u.query.supportsFormatPBF,supportsMaxRecordCountFactor:u.query.supportsMaxRecordCountFactor,supportsQuantization:u.query.supportsQuantization,
lastEditDate:null,snapshotInfo:null}}}createSourceSchema(e,c){const {customParameters:p,timeExtent:w,apiKey:a}=this.layer;return v.createFeatureSourceSchema({customParameters:p,timeExtent:w},e,c,a)}createProcessorSchema(e,c,p){const {fields:w,renderer:a,geometryType:b,labelingInfo:f,labelsVisible:m,orderBy:d,objectIdField:u}=this.layer,y={fields:w.map(C=>C.toJSON()),renderer:a?.clone(),featureReduction:r.getEffectiveFeatureReduction(this.layer,c),geometryType:b,labelingInfo:f,labelsVisible:m,objectIdField:u,
orderBy:d??"default"};return k.createSimpleProcessorSchema(e,c,y,p)}get hasRequiredSupport(){return x.isRendererSupported(this.layer.renderer)}get timeOptions(){return this.layer}getUpdateHashProperties(e){var c=this.layer;const {renderer:p,apiKey:w}=c,a=this.layer.labelsVisible?this.layer.labelingInfo:null,b=JSON.stringify(c.customParameters);e=r.getEffectiveFeatureReduction(c,e);c=JSON.stringify(c.orderBy);return{apiKey:w,customParameters:b,featureReduction:e,labelingInfo:a,orderBy:c,renderer:p}}}
n.OGCFeatureLayerAdapter=l;Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/layerAdapters/OrientedImageryLayerAdapter":function(){define("exports ../../../../../core/has ../../../../../core/lang ../../../../../layers/support/arcgisLayerUrl ./featureReductionUtils ./featureServiceUtils ./floorFilterUtils ./geometryUtils ./labelingUtils ../schema/SourceSchema ../schema/processor/SimpleProcessorSchema ../support/rendererUtils".split(" "),function(n,t,r,q,
z,v,k,x,l,e,c,p){class w{constructor(a){this.layer=a}getLabelingDeconflictionInfo(a){const b=this.layer;a=l.getFeatureReductionDeconflictionEnabled(b,a)??l.getLayerDeconflictionEnabled(b);return[{vvEvaluators:{0:l.createLabelVVEvaluator(b.renderer)},deconflictionEnabled:a}]}async createServiceOptions(a){var b=this.layer;const {capabilities:f,objectIdField:m,globalIdField:d,orderBy:u,refreshInterval:y}=b,C=b.fieldsIndex.toJSON(),H=x.getServiceGeometryType(b),I=b.timeInfo?.toJSON(),G=b.spatialReference.toJSON(),
D=r.clone(this.layer.parsedUrl);let h=this.layer.objectIdField;if(u?.length){var B=!u[0].valueExpression&&u[0].field;B&&(h=B)}B=0<y;b=(B=!!t("featurelayer-snapshot-enabled")&&"point"===b.geometryType&&f?.query.supportsPagination&&!f?.operations.supportsEditing&&!B)&&v.exceedsMinimumSnapshotCoverage(a,b.fullExtent);const E=q.isHostedAgolService(D.path);return{type:"feature-service",source:D,isSourceHosted:E,orderByFields:h,outSpatialReference:a.spatialReference.toJSON(),metadata:{globalIdField:d,fieldsIndex:C,
geometryType:H,objectIdField:m,timeInfo:I,spatialReference:G,timeReferenceUnknownClient:!1,subtypeField:null,subtypes:null,typeIdField:null,types:null},queryMetadata:{maxRecordCount:f.query.maxRecordCount,supportsCompactGeometry:f.query.supportsCompactGeometry,supportsDefaultSpatialReference:f.query.supportsDefaultSpatialReference,supportsFormatPBF:f.query.supportsFormatPBF,supportsMaxRecordCountFactor:f.query.supportsMaxRecordCountFactor,supportsQuantization:f.query.supportsQuantization,lastEditDate:null,
snapshotInfo:{supportsSnapshotMinThreshold:B,supportsSnapshotMaxThreshold:b,snapshotCountThresholds:{min:t("featurelayer-snapshot-point-min-threshold"),max:t("featurelayer-snapshot-point-max-threshold")}}}}}createSourceSchema(a,b){const {definitionExpression:f,customParameters:m,timeExtent:d}=this.layer;return e.createFeatureSourceSchema({definitionExpression:f,customParameters:m,timeExtent:d},a,b,null)}createProcessorSchema(a,b,f){const {fields:m,renderer:d,geometryType:u,labelingInfo:y,labelsVisible:C,
orderBy:H,objectIdField:I}=this.layer,G={fields:m.map(D=>D.toJSON()),renderer:d?.clone(),featureReduction:z.getEffectiveFeatureReduction(this.layer,b),geometryType:u,labelingInfo:y,labelsVisible:C,objectIdField:I,orderBy:H??"default"};return c.createSimpleProcessorSchema(a,b,G,f)}get hasRequiredSupport(){return p.isRendererSupported(this.layer.renderer)}get timeOptions(){return this.layer}hasFilters(a){return k.hasFloorFilter(this.layer,a)}addFilters(a,b){return k.addFloorFilter(this.layer,a,b)}getUpdateHashProperties(a){var b=
this.layer;const {definitionExpression:f,renderer:m,outFields:d}=b,u=this.layer.labelsVisible?this.layer.labelingInfo:null,y=JSON.stringify(b.customParameters),C=z.getEffectiveFeatureReduction(b,a);b=JSON.stringify(b.orderBy);a=k.hasFloorFilter(this.layer,a)?a.floors:null;return{outFields:d,orderBy:b,definitionExpression:f,renderer:m,labelingInfo:u,featureReduction:C,customParameters:y,floors:a}}}n.OrientedImageryLayerAdapter=w;Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/layerAdapters/ParquetLayerAdapter":function(){define("exports ./featureReductionUtils ./geometryUtils ./labelingUtils ../schema/processor/SimpleProcessorSchema ../support/rendererUtils".split(" "),
function(n,t,r,q,z,v){class k{constructor(x){this.layer=x}get hasRequiredSupport(){return v.isRendererSupported(this.layer.renderer)}get timeOptions(){return null}getLabelingDeconflictionInfo(x){const l=this.layer;x=q.getFeatureReductionDeconflictionEnabled(l,x)??q.getLayerDeconflictionEnabled(l);return[{vvEvaluators:{0:q.createLabelVVEvaluator(l.renderer)},deconflictionEnabled:x}]}getUpdateHashProperties(x){var l=this.layer;const {renderer:e}=l,c=this.layer.labelsVisible?this.layer.labelingInfo:
null,p=JSON.stringify(l.customParameters);x=t.getEffectiveFeatureReduction(l,x);l=JSON.stringify(l.orderBy);return{outFields:this.layer.outFields,labelingInfo:c,featureReduction:x,customParameters:p,orderBy:l,renderer:e}}async createServiceOptions(x){const l=r.getServiceGeometryType(this.layer);return{type:"parquet",source:{urls:this.layer.urls.items},outSpatialReference:x.spatialReference.toJSON(),geometryInfo:this.layer.source.geometryInfo,metadata:{spatialReference:this.layer.spatialReference,
fieldsIndex:this.layer.fieldsIndex.toJSON(),objectIdField:this.layer.objectIdField,geometryType:l,types:null,subtypes:null,timeInfo:null,typeIdField:null,subtypeField:null,globalIdField:null,timeReferenceUnknownClient:null}}}createSourceSchema(x,l){return{type:"parquet",mutable:{sourceRefreshVersion:l,availableFields:x.availableFields,dataFilter:{customParameters:this.layer.customParameters??null}}}}createProcessorSchema(x,l,e){const c={fields:this.layer.fields.map(p=>p.toJSON()),renderer:this.layer.renderer?.clone(),
featureReduction:t.getEffectiveFeatureReduction(this.layer,l),geometryType:this.layer.geometryType,labelingInfo:this.layer.labelingInfo,labelsVisible:this.layer.labelsVisible,objectIdField:this.layer.objectIdField,orderBy:this.layer.orderBy};return z.createSimpleProcessorSchema(x,l,c,e)}}n.ParquetLayerAdapter=k;Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/layerAdapters/StreamLayerAdapter":function(){define("exports ./featureReductionUtils ./geometryUtils ./labelingUtils ../schema/processor/SimpleProcessorSchema ../support/rendererUtils".split(" "),
function(n,t,r,q,z,v){class k{constructor(x){this.layer=x}getLabelingDeconflictionInfo(x){const l=this.layer;x=q.getFeatureReductionDeconflictionEnabled(l,x)??q.getLayerDeconflictionEnabled(l);return[{vvEvaluators:{0:q.createLabelVVEvaluator(l.renderer)},deconflictionEnabled:x}]}async createServiceOptions(x){var l=this.layer;const {objectIdField:e}=l,c=r.getServiceGeometryType(l),p=l.timeInfo?.toJSON()||null;l=l.spatialReference?l.spatialReference.toJSON():null;return{type:"stream",source:this.layer.parsedUrl,
outSpatialReference:x.spatialReference.toJSON(),metadata:{fieldsIndex:this.layer.fieldsIndex.toJSON(),geometryType:c,objectIdField:e,timeInfo:p,timeReferenceUnknownClient:null,spatialReference:l,subtypeField:null,subtypes:null,globalIdField:null,typeIdField:null,types:null}}}createSourceSchema(x,l){const {definitionExpression:e,geometryDefinition:c,customParameters:p}=this.layer;return{type:"stream",mutable:{sourceRefreshVersion:l,availableFields:x.availableFields,dataFilter:{geometryDefinition:c?.toJSON(),
definitionExpression:e,customParameters:p??null,maxReconnectionAttempts:this.layer.maxReconnectionAttempts,maxReconnectionInterval:this.layer.maxReconnectionInterval,purgeOptions:this.layer.purgeOptions.toJSON()}}}}createProcessorSchema(x,l,e){const {fields:c,renderer:p,geometryType:w,labelingInfo:a,labelsVisible:b,objectIdField:f}=this.layer,m={fields:c.map(d=>d.toJSON()),renderer:p?.clone(),featureReduction:t.getEffectiveFeatureReduction(this.layer,l),geometryType:w,labelingInfo:a,labelsVisible:b,
objectIdField:f,orderBy:"default"};return z.createSimpleProcessorSchema(x,l,m,e)}get hasRequiredSupport(){return v.isRendererSupported(this.layer.renderer)}get timeOptions(){return this.layer}getUpdateHashProperties(x){const l=this.layer,{definitionExpression:e,renderer:c}=l,p=this.layer.labelsVisible?this.layer.labelingInfo:null,w=JSON.stringify(l.customParameters);x=t.getEffectiveFeatureReduction(l,x);return{definitionExpression:e,renderer:c,labelingInfo:p,featureReduction:x,customParameters:w,
geometryDefinition:l.geometryDefinition,definitionExpressoin:l.definitionExpression}}}n.StreamLayerAdapter=k;Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/layerAdapters/SubtypeGroupLayerAdapter":function(){define("exports ../../../../../core/has ../../../../../core/lang ../../../../../core/mathUtils ../../../../../core/sql ../../../../../layers/support/arcgisLayerUrl ../../../../../layers/support/FeatureFilter ./featureServiceUtils ./floorFilterUtils ./geometryUtils ./labelingUtils ../schema/SourceSchema ../schema/processor/SubtypeProcessorSchema".split(" "),
function(n,t,r,q,z,v,k,x,l,e,c,p,w){function a(m,d){return m.sublayers.some(u=>!b(u,d))}function b(m,d){return m.visible&&(0===m.minScale||q.floatEqualAbsolute(d.scale,m.minScale)||d.scale<m.minScale)&&(0===m.maxScale||q.floatEqualAbsolute(d.scale,m.maxScale)||d.scale>m.maxScale)}class f{constructor(m){this.layer=m}getLabelingDeconflictionInfo(m){return[{vvEvaluators:{},deconflictionEnabled:this.layer.sublayers.every(d=>c.getLayerDeconflictionEnabled(d))}]}async createServiceOptions(m){var d=this.layer;
const {capabilities:u,datesInUnknownTimezone:y,editingInfo:C,globalIdField:H,objectIdField:I,refreshInterval:G,subtypeField:D}=d,h=d.fieldsIndex.toJSON(),B=e.getServiceGeometryType(d),E=d.timeInfo?.toJSON(),M=d.spatialReference.toJSON(),K=r.clone(this.layer.parsedUrl);var J=null==C?.lastEditDate&&0<G;d=(J=!!t("featurelayer-snapshot-enabled")&&"point"===d.geometryType&&u?.query.supportsPagination&&!u?.operations.supportsEditing&&!J)&&x.exceedsMinimumSnapshotCoverage(m,d.fullExtent);const N=v.isHostedAgolService(K.path);
return{type:"feature-service",source:K,isSourceHosted:N,orderByFields:I,outSpatialReference:m.spatialReference.toJSON(),metadata:{timeReferenceUnknownClient:y,subtypeField:D,globalIdField:H,fieldsIndex:h,geometryType:B,objectIdField:I,timeInfo:E,spatialReference:M,subtypes:this.layer.subtypes?.map(W=>W.toJSON()),typeIdField:null,types:null},queryMetadata:{maxRecordCount:u.query.maxRecordCount,supportsCompactGeometry:u.query.supportsCompactGeometry,supportsDefaultSpatialReference:u.query.supportsDefaultSpatialReference,
supportsFormatPBF:u.query.supportsFormatPBF,supportsMaxRecordCountFactor:u.query.supportsMaxRecordCountFactor,supportsQuantization:u.query.supportsQuantization,lastEditDate:C?.lastEditDate?.getTime(),snapshotInfo:{supportsSnapshotMinThreshold:J,supportsSnapshotMaxThreshold:d,snapshotCountThresholds:{min:t("featurelayer-snapshot-point-min-threshold"),max:t("featurelayer-snapshot-point-max-threshold")}}}}}createSourceSchema(m,d){const {definitionExpression:u,customParameters:y,gdbVersion:C,historicMoment:H,
subtypeField:I,timeExtent:G,apiKey:D}=this.layer,h={queryScaleRanges:this.layer.sublayers.items.map(B=>({subtypeCode:B.subtypeCode,minScale:B.minScale,maxScale:B.maxScale})),definitionExpression:u,customParameters:y,gdbVersion:C,historicMoment:H,subtypeField:I,timeExtent:G};return p.createFeatureSourceSchema(h,m,d,D)}createProcessorSchema(m,d,u){const y={subtypeField:this.layer.subtypeField,sublayers:Array.from(this.layer.sublayers,C=>({featureReduction:null,geometryType:this.layer.geometryType,labelingInfo:C.labelingInfo,
labelsVisible:C.labelsVisible,renderer:C.renderer,subtypeCode:C.subtypeCode,orderBy:null}))};return w.createSubtypeProcessorSchema(m,d,y,u)}hasFilters(m){return l.hasFloorFilter(this.layer,m)||a(this.layer,m)}addFilters(m,d){m=l.addFloorFilter(this.layer,m,d);var u=this.layer.sublayers.filter(y=>!b(y,d)).map(y=>y.subtypeCode);if(!u.length)return m;m??=new k;u=`NOT ${this.layer.subtypeField} IN (${u.join(",")})`;m.where=z.sqlAnd(m.where,u);return m}get hasRequiredSupport(){return!0}get timeOptions(){return this.layer}getUpdateHashProperties(m){var d=
this.layer;const {definitionExpression:u,gdbVersion:y,apiKey:C}=d,H=d.historicMoment?.getTime()??void 0;d=JSON.stringify(d.customParameters);m=l.hasFloorFilter(this.layer,m)?m.floors:null;const I=this.layer.sublayers.map(({renderer:G,labelsVisible:D,labelingInfo:h,visible:B})=>({renderer:G,labelsVisible:D,labelingInfo:h,visible:B}));return{outFields:this.layer.outFields,gdbVersion:y,definitionExpression:u,historicMoment:H,customParameters:d,apiKey:C,sublayers:I,floors:m}}setGraphicOrigin(m){var d=
this.layer.fieldsIndex.get(this.layer.subtypeField);const u=m.attributes[d.name];d=this.layer.sublayers.find(y=>y.subtypeCode===u);m.layer=m.sourceLayer=d}}n.SubtypeGroupLayerAdapter=f;Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/schema/processor/SubtypeProcessorSchema":function(){define("exports ./LabelMatcherSchema ./MatcherSchema ./StorageSchema ./VisualVariablesSchema ../../../../../webgl/capabilities".split(" "),function(n,t,r,q,z,v){async function k(e,
{subtypeField:c,sublayers:p}){const w=await Promise.all(p.map(({renderer:a})=>r.createMatcherSchema(e,a)));return{type:"subtype",subtypeField:c,renderers:p.reduce((a,{subtypeCode:b},f)=>({...a,[b]:w[f]}),{})}}function x(e,c){const p=v.getWebGLCapabilities();return{type:"subtype",filters:e.filters,capabilities:{maxTextureSize:p.maxTextureSize},subtypeField:c.subtypeField,target:"feature",bindings:c.sublayers.reduce((w,{renderer:a,subtypeCode:b})=>{a=q.createVVBindings(a);return{...w,[b]:a}},{})}}async function l(e,
{subtypeField:c,sublayers:p}){const w=await Promise.all(p.map(a=>{const b=z.createVisualVariableUniforms(a.renderer);return t.createLabelMatcherSchema(e,{...a,geometryType:a.geometryType??null},b)}));return{type:"subtype",subtypeField:c,renderers:p.reduce((a,{subtypeCode:b},f)=>({...a,[b]:w[f]}),{})}}n.createSubtypeProcessorSchema=async function(e,c,p,w){return{storage:x(c,p),mesh:{properties:{timeZone:c.timeZone,displayRefreshVersion:w,returnMeshObjectId:!1,sortKey:null},strategy:{type:"feature"},
factory:{symbology:await k(e,p),labels:await l(e,p)}}}};Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/support/handleNoEngineError":function(){define(["exports"],function(n){n.handleNoEngineError=async function(t,r){try{return await t}catch(q){if("no-queryEngine"!==q.name)throw q;return r}};Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/support/HighlightCounter":function(){define(["exports"],function(n){const t=new Set;
class r{constructor(){this._idToCounters=new Map}get empty(){return 0===this._idToCounters.size}addGroup(q,z){for(const v of q)q=this._idToCounters.get(v),q||(q=new Map,this._idToCounters.set(v,q)),q.set(z,(q.get(z)||0)+1)}deleteGroup(q,z){for(const v of q){q=this._idToCounters.get(v);if(!q)continue;let k=q.get(z);if(null==k)break;k--;0<k?q.set(z,k):q.delete(z);0===q.size&&this._idToCounters.delete(v)}}getHighlightGroups(q){q=this._idToCounters.get(q);if(!q)return t;const z=new Set;for(const [v,k]of q)0<
k&&z.add(v);return z}ids(){return this._idToCounters.keys()}}n.HighlightCounter=r;Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/tiling/FeatureTileSubscriptionManager":function(){define(["exports","./TileKey"],function(n,t){function r(k,x){const l=new Set;for(const e of k instanceof Set?k.values():k.keys())x.has(e)||l.add(e);return l}class q{constructor(k,x,l){l=l?k.getTileCoverage(l,0,!0,"closest"):null;k=k.getTileCoverage(x,0,!0,"closest");this._tileKeys=new Map;
if(l)for(const e of l.keys())this._tileKeys.set(e.id,e);if(k)for(const e of k.keys())this._tileKeys.set(e.id,e)}get coverageSet(){return new Set(this._tileKeys.keys())}keys(){return this._tileKeys.values()}}class z{constructor(k){this.version=k}}class v{constructor(k){this._subscriptions=new Map;this._visible=new Set;this._paused=new Set;this._version=0;this._config=k}destroy(){}get _coverageSet(){return this._coverage?.coverageSet??new Set}suspend(){this._suspendedOverage=this._coverage;this._coverage=
null;this._updateSubscriptions()}resume(){null==this._coverage&&(this._coverage=this._suspendedOverage,this._suspendedOverage=null,this._updateSubscriptions())}update(k,x){this._version=(this._version+1)%Number.MAX_SAFE_INTEGER;this._updateCoverage(k,x);this._updateSubscriptions();return new Set(this._visible)}_updateCoverage(k,x){this._coverage=new q(this._config.tileInfoView,k,x)}_updateSubscriptions(){var k=this._coverageSet;const x=this._updateVisibility();var l=r(x,k);const e=r(this._subscriptions,
x),c=r(k,this._subscriptions);k=r(e,k);l=r(l,k);l=r(l,this._paused);this._visible=x;for(const p of c.values())this._subscriptions.set(p,new z(this._version));for(const p of l.values())this._paused.add(p);for(const p of k.values())this._subscriptions.delete(p),this._paused.delete(p);(c.size||k.size||l.size)&&this._sendUpdateSubscriptions(c,k,l)}_sendUpdateSubscriptions(k,x,l){k=Array.from(k.values()).map(e=>({tileId:e,version:this._subscriptions.get(e).version}));this._config.updateSubscriptions({subscribe:k,
unsubscribe:Array.from(x.values()),pause:Array.from(l.values())})}_updateVisibility(){const k=new Set,x=new Set;if(!this._coverage)return k;for(var l of this._coverage.keys())this._config.isDone(l)?k.add(l.id):this._addVisibleParent(k,x,l)||this._addVisibleChildren(k,l)||k.add(l.id);l=new t(0,0,0,0);const e=new t(0,0,0,0);for(const c of x){l.id=c;for(const p of k)e.id=p,l.containsChild(e)&&k.delete(p)}return k}_addVisibleParent(k,x,l){let e=!1;for(const c of this._visible.values())(new t(c)).containsChild(l)&&
(k.add(c),x.add(c),e=!0);return e}_addVisibleChildren(k,x){let l=!1;for(const e of this._visible.values()){const c=new t(e);x.containsChild(c)&&(k.add(e),l=!0)}return l}}n.FeatureTileSubscriptionManager=v;Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/views/layers/FeatureLayerView":function(){define("../../chunks/tslib.es6 ../../core/Error ../../core/has ../../core/Logger ../../core/promiseUtils ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/RandomLCG ../../core/accessorSupport/decorators/subclass ../../layers/support/FeatureEffect ../../layers/support/FeatureFilter ../../layers/support/fieldUtils ../../layers/support/floorFilterUtils ../../rest/support/Query ../../support/arcadeOnDemand ./support/popupUtils".split(" "),
function(n,t,r,q,z,v,k,x,l,e,c,p,w,a,b,f){return m=>{m=class extends m{constructor(...d){super(...d);this._updatingRequiredFieldsPromise=null;this.dataUpdating=!1;this.layer=this.filter=null;this.requiredFields=[];this.view=null}initialize(){this.addHandles([v.watch(()=>{const d=this.layer;return[d&&"elevationInfo"in d?d.elevationInfo?.featureExpressionInfo:null,d&&"displayField"in d?d.displayField:null,d&&"timeInfo"in d&&d.timeInfo,d&&"renderer"in d&&d.renderer,d&&"labelingInfo"in d&&d.labelingInfo,
d&&"floorInfo"in d&&d.floorInfo,this.filter,this.featureEffect,this.timeExtent]},()=>this._handleRequiredFieldsChange(),v.syncAndInitial),v.on(()=>this.view?.floors,"change",()=>this._handleRequiredFieldsChange()),v.on(()=>{const d=this.layer;return d&&"sublayers"in d?d.sublayers:null},"change",()=>this._handleRequiredFieldsChange())])}get availableFields(){if(!this.layer)return[];const {layer:d,layer:{fieldsIndex:u},requiredFields:y}=this;return"outFields"in d&&d.outFields?p.fixFields(u,[...p.unpackFieldNames(u,
d.outFields),...y]):p.fixFields(u,y)}get featureEffect(){return this.layer&&"featureEffect"in this.layer?this.layer.featureEffect:null}set featureEffect(d){this._override("featureEffect",d)}get maximumNumberOfFeatures(){return 0}set maximumNumberOfFeatures(d){q.getLogger(this).error("#maximumNumberOfFeatures\x3d","Setting maximum number of features is not supported")}get maximumNumberOfFeaturesExceeded(){return!1}highlight(d){throw Error("missing implementation");}createQuery(){var d={outFields:["*"],
returnGeometry:!0,outSpatialReference:this.view.spatialReference};d=null!=this.filter?this.filter.createQuery(d):new a(d);if("floorInfo"in this.layer&&this.layer.floorInfo){const u=w.getFloorFilterClause(this);null!=u&&(d.where=d.where?`(${d.where}) AND (${u})`:u)}null!=this.timeExtent&&(d.timeExtent=null!=d.timeExtent?d.timeExtent.intersection(this.timeExtent):this.timeExtent.clone());return d}createAggregateQuery(){return new a({outFields:["*"],returnGeometry:!0,outSpatialReference:this.view.spatialReference})}queryFeatures(d,
u){throw Error("missing implementation");}queryObjectIds(d,u){throw Error("missing implementation");}queryFeatureCount(d,u){throw Error("missing implementation");}queryExtent(d,u){throw Error("missing implementation");}async fetchPopupFeaturesFromGraphics(d,u){this._validateFetchPopupFeatures(d,u);return this._fetchPopupFeatures(d,u)}_loadArcadeModules(d){return d.expressionInfos?.length||Array.isArray(d.content)&&d.content.some(u=>"expression"===u.type)?b.loadArcade():Promise.resolve()}_handleRequiredFieldsChange(){const d=
this._updateRequiredFields();this._set("_updatingRequiredFieldsPromise",d);d.then(()=>{this._updatingRequiredFieldsPromise===d&&this._set("_updatingRequiredFieldsPromise",null)})}async _updateRequiredFields(){if(this.layer&&this.view){var d="3d"===this.view.type,{layer:u,layer:{fieldsIndex:y,objectIdField:C}}=this,H="renderer"in u&&u.renderer,I="orderBy"in u&&u.orderBy,G="featureReduction"in u?u.featureReduction:null,D=new Set;H=await Promise.allSettled([H?H.collectRequiredFields(D,y):null,p.collectLabelingFields(D,
u),d&&"elevationInfo"in u?p.collectElevationFields(D,u):null,null!=this.filter?p.collectFilterFields(D,u,this.filter):null,d||null==this.featureEffect?null:p.collectFilterFields(D,u,this.featureEffect.filter),!d&&G?p.collectFeatureReductionFields(D,u,G):null,!d&&I?p.collectOrderByInfos(D,u,I):null]);"timeInfo"in u&&u.timeInfo&&this.timeExtent&&p.collectFields(D,u.fieldsIndex,[u.timeInfo.startField,u.timeInfo.endField]);"floorInfo"in u&&u.floorInfo&&p.collectFields(D,u.fieldsIndex,[u.floorInfo.floorField]);
"feature"===u.type&&d&&null!=u.infoFor3D&&(null==u.globalIdField&&q.getLogger(this).error("globalIdField missing on 3DObjectFeatureLayer"),p.collectFields(D,u.fieldsIndex,[u.globalIdField]));"subtype-group"===u.type&&(p.collectField(D,y,u.subtypeField),I=u.sublayers.map(h=>Promise.all([h.renderer?.collectRequiredFields(D,y),p.collectLabelingFields(D,h)])),await Promise.allSettled(I));"catalog-footprint"===u.type&&u.parent&&(I=u.parent,p.collectFields(D,y,[I.itemNameField,I.itemSourceField,I.itemTypeField,
I.maxScaleField,I.minScaleField]));for(const h of H)"rejected"===h.status&&q.getLogger(this).error(h.reason);p.collectField(D,y,C);d&&"displayField"in u&&u.displayField&&p.collectField(D,y,u.displayField);d=Array.from(D).sort();this._set("requiredFields",d)}}_validateFetchPopupFeatures(d,u){if(null!=u)for(const y of d){d=y.origin&&"layer"in y.origin?y.origin.layer:y.layer;if("popupEnabled"in d&&!d.popupEnabled)throw new t("featurelayerview:fetchPopupFeatures","Popups are disabled",{layer:d});if(y.isAggregate){const C=
"featureReduction"in d?d.featureReduction:null;if(!(C&&"popupTemplate"in C&&C.popupEnabled&&C.popupTemplate))throw new t("featurelayerview:fetchPopupFeatures","Popups are disabled",{layer:d});}else if("popupTemplate"in d&&!f.getFetchPopupTemplate(d,u))throw new t("featurelayerview:fetchPopupFeatures","Layer does not define a popup template",{layer:d});}}_popupFeatureHasRequiredFields(d,u){return p.featureHasFields(u,d)}async _fetchPopupFeatures(d,u){const y=Array(d.length),C=new Map,H=await this._createPopupQuery(d.map(G=>
G.origin?.layer??G.layer),u);for(let G=0;G<d.length;G++){const D=d[G];if(D.isAggregate){y[G]=D;continue}var I=D.origin?.layer??D.layer;if(!(I&&"popupEnabled"in I))continue;const h=p.unpackFieldNames(this.layer.fieldsIndex,H.outFields);I=f.getFetchPopupTemplate(I,u);if(null==I)continue;const B=await this._loadArcadeModules(I);z.throwIfAborted(u);B&&B.arcadeUtils.hasGeometryOperations(I)||!this._popupFeatureHasRequiredFields(D,h)?C.set(D.getObjectId(),{graphic:D,index:G}):y[G]=D}if("stream"===this.layer.type||
"parquet"===this.layer.type||0===C.size)return y.filter(Boolean);H.objectIds=Array.from(C.keys());try{const G=await this.layer.queryFeatures(H,u);for(const D of G.features){const {graphic:{geometry:h,origin:B},index:E}=C.get(D.getObjectId());let M;(M=D).geometry||(M.geometry=h);D.origin=B;y[E]=D}}catch{}return y.filter(Boolean)}async _createPopupQuery(d,u){const y=this.layer.createQuery(),C=new Set;var H=!1;d=d??[this.layer];for(const I of d)if("popupEnabled"in I&&(d=f.getFetchPopupTemplate(I,u),
null!=d)){H=await this._loadArcadeModules(d);z.throwIfAborted(u);H=H&&H.arcadeUtils.hasGeometryOperations(d);H=!("point"!==this.layer.geometryType&&!H);d=await f.getRequiredFields(this.layer,d);z.throwIfAborted(u);for(const G of d)C.add(G)}y.returnGeometry=H;y.returnZ=H;y.returnM=H;y.outFields=Array.from(C);y.outSpatialReference=this.view.spatialReference;"floorInfo"in this.layer&&this.layer.floorInfo&&(u=w.getFloorFilterClause(this),null!=u&&(y.where=y.where?`(${y.where}) AND (${u})`:u));return y}canResume(){return!super.canResume()||
null!=this.timeExtent&&this.timeExtent.isEmpty?!1:!0}getTest(){}get test(){}};n.__decorate([k.property()],m.prototype,"_updatingRequiredFieldsPromise",void 0);n.__decorate([k.property({readOnly:!0})],m.prototype,"availableFields",null);n.__decorate([k.property({readOnly:!0})],m.prototype,"dataUpdating",void 0);n.__decorate([k.property({type:e})],m.prototype,"featureEffect",null);n.__decorate([k.property({type:c})],m.prototype,"filter",void 0);n.__decorate([k.property()],m.prototype,"layer",void 0);
n.__decorate([k.property({type:Number})],m.prototype,"maximumNumberOfFeatures",null);n.__decorate([k.property({readOnly:!0,type:Boolean})],m.prototype,"maximumNumberOfFeaturesExceeded",null);n.__decorate([k.property({readOnly:!0})],m.prototype,"requiredFields",void 0);n.__decorate([k.property()],m.prototype,"suspended",void 0);n.__decorate([k.property()],m.prototype,"view",void 0);return m=n.__decorate([l.subclass("esri.views.layers.FeatureLayerView")],m)}})},"esri/layers/support/floorFilterUtils":function(){define(["exports"],
function(n){function t(r,q){if(!r?.length)return null;r=r.filter(z=>""!==z).map(z=>`'${z}'`);r.push("''");return`${q} IN (${r.join(",")}) OR ${q} IS NULL`}n.getFloorFilterClause=function(r){const q=r.layer;return"floorInfo"in q&&q.floorInfo?.floorField&&"floors"in r.view?t(r.view.floors,q.floorInfo.floorField):null};n.getLayerFloorFilterClause=function(r,q){return"floorInfo"in q&&q.floorInfo?.floorField?t(r,q.floorInfo.floorField):null};Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},
"esri/views/layers/support/popupUtils":function(){define(["exports","../../../layers/support/fieldUtils"],function(n,t){function r(q,z){return q.popupTemplate?q.popupTemplate:null!=z&&z.defaultPopupTemplateEnabled&&null!=q.defaultPopupTemplate?q.defaultPopupTemplate:null}n.getFetchPopupTemplate=r;n.getRequiredFields=async function(q,z=q.popupTemplate){if(null==z)return[];const v=await z.getRequiredFields(q.fieldsIndex);({lastEditInfoEnabled:z}=z);const {objectIdField:k,typeIdField:x,globalIdField:l,
relationships:e}=q;if(v.includes("*"))return["*"];z=z?t.getFeatureEditFields(q):[];const c=t.fixFields(q.fieldsIndex,[...v,...z]);x&&c.push(x);c&&k&&q.fieldsIndex?.has(k)&&!c.includes(k)&&c.push(k);c&&l&&q.fieldsIndex?.has(l)&&!c.includes(l)&&c.push(l);e&&e.forEach(p=>{({keyField:p}=p);c&&p&&q.fieldsIndex?.has(p)&&!c.includes(p)&&c.push(p)});return c};n.hasPopupTemplate=function(q,z){return null!=r(q,{defaultPopupTemplateEnabled:z})};Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},
"esri/views/layers/RefreshableLayerView":function(){define("../../chunks/tslib.es6 ../../core/Logger ../../core/promiseUtils ../../core/reactiveUtils ../../core/has ../../core/RandomLCG ../../core/Error ../../core/accessorSupport/decorators/subclass".split(" "),function(n,t,r,q,z,v,k,x){return l=>{l=class extends l{initialize(){this.addHandles(q.on(()=>this.layer,"refresh",e=>{this.doRefresh(e.dataChanged).catch(c=>{r.isAbortError(c)||t.getLogger(this).error(c)})}),"RefreshableLayerView")}};return l=
n.__decorate([x.subclass("esri.views.layers.RefreshableLayerView")],l)}})},"*noref":1}});
define("../../../chunks/tslib.es6 ../../../AggregateGraphic ../../../geometry ../../../Graphic ../../../core/arrayUtils ../../../core/Collection ../../../core/compilerUtils ../../../core/Error ../../../core/handleUtils ../../../core/has ../../../core/Logger ../../../core/maybe ../../../core/object ../../../core/promiseUtils ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/decorators/subclass ../../../layers/effects/FeatureEffectView ../../../layers/graphics/featureConversionUtils ../../../layers/support/FeatureFilter ../../../layers/support/fieldUtils ../../../layers/support/layerUtils ../../../layers/support/timeSupport ../../../rest/support/AggregateFeatureSet ../../../rest/support/FeatureSet ../../../rest/support/Query ./LayerView2D ./features/FeatureContainer ./features/FeaturePipelineWorkerProxy ./features/FeatureSourceEventLog ./features/layerAdapters/CatalogFootprintLayerAdapter ./features/layerAdapters/FeatureLayerAdapter ./features/layerAdapters/InMemoryLayerAdapter ./features/layerAdapters/KnowledgeGraphSublayerAdapter ./features/layerAdapters/OGCFeatureLayerAdapter ./features/layerAdapters/OrientedImageryLayerAdapter ./features/layerAdapters/ParquetLayerAdapter ./features/layerAdapters/StreamLayerAdapter ./features/layerAdapters/SubtypeGroupLayerAdapter ./features/schema/processor/symbols/ComplexSymbolSchema ./support/FeatureCommandQueue ./support/handleNoEngineError ./support/HighlightCounter ./support/util ../tiling/FeatureTileSubscriptionManager ../../layers/FeatureLayerView ../../layers/LayerView ../../layers/RefreshableLayerView ../../../geometry/Extent".split(" "),function(n,
t,r,q,z,v,k,x,l,e,c,p,w,a,b,f,m,d,u,y,C,H,I,G,D,h,B,E,M,K,J,N,W,T,X,U,Q,ea,aa,Y,ca,R,ha,ia,ja,S,da,fa,la){function ma(g,A){const F=new Set;g&&g.forEach(L=>F.add(L));A&&A.forEach(L=>F.add(L));return F.has("*")?["*"]:Array.from(F)}r=class extends S(fa(B.LayerView2DMixin(da))){constructor(){super(...arguments);this._commandsQueue=new ca({process:g=>{switch(g.type){case "edit-by-feature":case "edit-by-id":return this._doEdit(g);case "update":return this._doUpdate();case "highlight":return this._updateHighlights()}}});
this._visibilityOverrides=new Set;this._highlightCounter=new ha.HighlightCounter;this._lastAvailableFields=[];this._lastTargetState=null;this.eventLog=new K.FeatureSourceEventLog;this._displayRefreshVersion=this._sourceRefreshVersion=1;this._pipelineUpdating=!1;this._fields=null;this.featureEffectView=new d}destroy(){this._workerProxy?.destroy();this._workerAttached.reject(a.createAbortError());this._commandsQueue.destroy()}initialize(){this._workerAttached=a.createResolver();a.ignoreAbortErrors(this._workerAttached.promise);
this.addResolvingPromise(this._initProxy());this.featureEffectView.featureEffect=this.featureEffect;this.featureEffectView.endTransition()}async _initProxy(){var g=this.layer;if("isTable"in g&&g.isTable)throw new x("featurelayerview:table-not-supported","table feature layer can't be displayed",{layer:g});if("mesh"===g.geometryType)throw new x("featurelayerview:geometry-type-not-supported",`Geometry type of ${g.geometryType} is not supported`,{layer:g});if(("feature"===g.type||"subtype-group"===g.type)&&
!1===H.getEffectiveLayerCapabilities(g)?.operations.supportsQuery)throw new x("featurelayerview:query-not-supported","layer view requires a layer with query capability",{layer:g});this._workerProxy&&this._workerProxy.destroy();g=this._createClientOptions();this._workerProxy=await M.createFeaturePipelineWorkerProxy(g)}async _attachProxy(){const g={service:await this.layerAdapter.createServiceOptions(this.view),tileInfoJSON:this.view?.featuresTilingScheme?.tileInfo?.toJSON()};let A=[];Array.isArray(g.service.source)&&
(A=g.service.source);try{await this._workerProxy.pipeline.onAttach(g,{transferList:A}),this._workerAttached.resolve()}catch(F){this._workerAttached.reject(a.createAbortError()),a.throwIfNotAbortError(F)}}async _detachProxy(){return this._workerProxy.pipeline.onDetach()}async getWorker(){await this._workerAttached.promise;return this._workerProxy}get hasAllFeatures(){return this.layer.visible&&!this.suspended&&this.eventLog.hasAllFeatures}get hasAllFeaturesInView(){return this.layer.visible&&!this.suspended&&
this.eventLog.hasAllFeaturesInView}get hasFullGeometries(){return this.layer.visible&&!this.suspended&&this.eventLog.hasFullGeometries}get labelingCollisionInfos(){const g=this.layerAdapter.getLabelingDeconflictionInfo(this.view),A=this.layer.geometryType,F=!this.suspended;return g.map(({vvEvaluators:L,deconflictionEnabled:O})=>({container:this.featureContainer,vvEvaluators:L,deconflictionEnabled:O,geometryType:A,visible:F}))}get layerAdapter(){switch(this.layer.type){case "feature":return"memory"===
this.layer.source.type?new W.InMemoryLayerAdapter(this.layer):new N.FeatureLayerAdapter(this.layer);case "geojson":case "csv":case "wfs":return new W.InMemoryLayerAdapter(this.layer);case "parquet":return new Q.ParquetLayerAdapter(this.layer);case "subtype-group":return new aa.SubtypeGroupLayerAdapter(this.layer);case "ogc-feature":return new X.OGCFeatureLayerAdapter(this.layer);case "stream":return new ea.StreamLayerAdapter(this.layer);case "oriented-imagery":return new U.OrientedImageryLayerAdapter(this.layer);
case "knowledge-graph-sublayer":return new T.KnowledgeGraphSublayerAdapter(this.layer);case "catalog-footprint":return new J.CatalogFootprintLayerAdapter(this.layer);default:k.neverReached(this.layer)}return null}get timeExtent(){return I.combineTimeExtent(this.layerAdapter.timeOptions,this.view?.timeExtent,this._get("timeExtent"))}getDisplayStatistics(g,A){return this.featureContainer?.getDisplayStatistics(g,A)}async queryHeatmapStatistics(g){return(await this.getWorker()).pipeline.queryHeatmapStatistics(g)}highlight(g,
A="default"){let F;g instanceof q?F=[g.getObjectId()]:"number"===typeof g||"string"===typeof g?F=[g]:v.isCollection(g)&&0<g.length?F=g.map(O=>O?.getObjectId()).toArray():Array.isArray(g)&&0<g.length&&(F="number"===typeof g[0]||"string"===typeof g[0]?g:g.map(O=>O?.getObjectId()));const L=F?.filter(z.isSome);if(!L?.length)return l.makeHandle();this._addHighlights(L,A);return l.makeHandle(()=>this._removeHighlights(L,A))}getHighlightIds(){return Array.from(this._highlightCounter.ids())}hasHighlight(){return!this._highlightCounter.empty}async hitTest(g,
A){A=await this.featureContainer.hitTest(A);if(0===A.length)return null;const F=await this.getWorker(),{features:L,aggregates:O}=await F.pipeline.getDisplayFeatures(A),P=this.featureContainer.getSortKeys(A);A=({displayId:V},{displayId:ba})=>P.has(V)&&P.has(ba)?P.get(V)-P.get(ba):V-ba;L.sort(A).reverse();O.sort(A).reverse();return[...O.map(V=>this._createGraphicHit(g,t.fromJSON(V))),...L.map(V=>this._createGraphicHit(g,q.fromJSON(V)))]}async queryStatistics(){const g=await this.getWorker();return R.handleNoEngineError(g.pipeline.queryStatistics(),
{featureCount:0,ringCount:0,vertexCount:0})}async querySummaryStatistics(g,A,F){const L=await this.getWorker();A={...A,scale:this.view.scale};g=L.features.executeQueryForSummaryStatistics(this._cleanUpQuery(g),A,F);return R.handleNoEngineError(g,{})}async queryAggregateSummaryStatistics(g,A,F){A={...A,scale:this.view.scale};g=(await this.getWorker()).aggregates.executeQueryForSummaryStatistics(this._cleanUpAggregateQuery(g),A,F);return R.handleNoEngineError(g,{})}async queryUniqueValues(g,A,F){const L=
await this.getWorker();A={...A,scale:this.view.scale};g=L.features.executeQueryForUniqueValues(this._cleanUpQuery(g),A,F);return R.handleNoEngineError(g,{uniqueValueInfos:[]})}async queryAggregateUniqueValues(g,A,F){const L=await this.getWorker();A={...A,scale:this.view.scale};g=L.aggregates.executeQueryForUniqueValues(this._cleanUpAggregateQuery(g),A,F);return R.handleNoEngineError(g,{uniqueValueInfos:[]})}async queryClassBreaks(g,A,F){const L=await this.getWorker();A={...A,scale:this.view.scale};
g=L.features.executeQueryForClassBreaks(this._cleanUpQuery(g),A,F);return R.handleNoEngineError(g,{classBreakInfos:[]})}async queryAggregateClassBreaks(g,A,F){const L=await this.getWorker();A={...A,scale:this.view.scale};g=L.aggregates.executeQueryForClassBreaks(this._cleanUpAggregateQuery(g),A,F);return R.handleNoEngineError(g,{classBreakInfos:[]})}async queryHistogram(g,A,F){const L=await this.getWorker();A={...A,scale:this.view.scale};g=L.features.executeQueryForHistogram(this._cleanUpQuery(g),
A,F);return R.handleNoEngineError(g,{bins:[],maxValue:null,minValue:null,normalizationTotal:null})}async queryAggregateHistogram(g,A,F){const L=await this.getWorker();A={...A,scale:this.view.scale};g=L.aggregates.executeQueryForHistogram(this._cleanUpAggregateQuery(g),A,F);return R.handleNoEngineError(g,{bins:[],maxValue:null,minValue:null,normalizationTotal:null})}queryFeatures(g,A){return this.queryFeaturesJSON(g,A).then(F=>{F=D.fromJSON(F);F.features.forEach(L=>this._setLayersForFeature(L));return F})}async queryVisibleFeatures(g,
A){g=(await this.getWorker()).pipeline.queryVisibleFeatures(this._cleanUpQuery(g),A);g=await R.handleNoEngineError(g,{features:[]});g=D.fromJSON(g);g.features.forEach(F=>this._setLayersForFeature(F));return g}async queryAggregates(g,A){g=(await this.getWorker()).aggregates.executeQuery(this._cleanUpAggregateQuery(g),A);g=await R.handleNoEngineError(g,{features:[]});g=G.fromJSON(g);g.features.forEach(F=>this._setLayersForFeature(F));return g}async queryAggregateIds(g,A){g=(await this.getWorker()).aggregates.executeQueryForIds(this._cleanUpAggregateQuery(g),
A);return R.handleNoEngineError(g,[])}async queryAggregateCount(g,A){g=(await this.getWorker()).aggregates.executeQueryForCount(this._cleanUpAggregateQuery(g),A);return R.handleNoEngineError(g,0)}async queryAggregateJSON(g,A){g=(await this.getWorker()).aggregates.executeQuery(this._cleanUpAggregateQuery(g),A);return R.handleNoEngineError(g,{features:[]})}async queryFeaturesJSON(g,A){g=(await this.getWorker()).features.executeQuery(this._cleanUpQuery(g),A);return R.handleNoEngineError(g,{features:[]})}async queryObjectIds(g,
A){g=(await this.getWorker()).features.executeQueryForIds(this._cleanUpQuery(g),A);return R.handleNoEngineError(g,[])}async queryFeatureCount(g,A){g=(await this.getWorker()).features.executeQueryForCount(this._cleanUpQuery(g),A);return R.handleNoEngineError(g,0)}async queryExtent(g,A){g=(await this.getWorker()).features.executeQueryForExtent(this._cleanUpQuery(g),A);g=await R.handleNoEngineError(g,{count:0,extent:null});return{count:g.count,extent:la.fromJSON(g.extent)}}async getSampleFeatures(g){return(await this.getWorker()).pipeline.getSampleFeatures(g)}setVisibility(g,
A){A?this._visibilityOverrides.delete(g):this._visibilityOverrides.add(g);this._update()}update(g){this._subscriptionManager&&(this.view.animation&&!this._lastTargetState&&(this._lastTargetState=g.state.clone()),!this.view.animation&&this._lastTargetState&&(this._lastTargetState=null),g=this._subscriptionManager.update(g.targetState,this._lastTargetState),this.featureContainer.setVisibleTiles(g))}attach(){e("esri-2d-update-debug")&&console.debug("FeatureLayerView2D.attach");a.ignoreAbortErrors(this._updatingHandles.addPromise(this._workerAttached.promise));
a.ignoreAbortErrors(this._attachProxy());this.featureContainer=new E.FeatureContainer(this);this.container.addChild(this.featureContainer);this.view.timeline.record(`${this.layer.title} (FeatureLayer) Attach`);this._subscriptionManager=new ja.FeatureTileSubscriptionManager({tileInfoView:this.view.featuresTilingScheme,updateSubscriptions:g=>{this.featureContainer.updateSubscriptions(g);a.ignoreAbortErrors(this._updatingHandles.addPromise(this.getWorker().then(A=>A.pipeline.updateSubscriptions(g))))},
isDone:g=>this.featureContainer.isDone(g)});this.requestUpdate();this.addAttachHandles([b.watch(()=>JSON.stringify({displayRefreshVersion:this._displayRefreshVersion,timeExtent:this.timeExtent,clips:this.clips,filter:this.filter,featureEffect:this.featureEffect,sourceRefreshVersion:this._sourceRefreshVersion,timeZone:this.view.timeZone,effect:this.featureEffect,...this.layerAdapter.getUpdateHashProperties(this.view)}),()=>this._update(),b.initial),b.watch(()=>this.updateSuspended,g=>{g||(this._subscriptionManager.resume(),
this.view.labelManager.requestUpdate())}),b.watch(()=>this.visible,g=>{this.view.labelManager.requestUpdate()})]);"stream"!==this.layer.type&&"parquet"!==this.layer.type&&"catalog-footprint"!==this.layer.type&&this.addAttachHandles(this.layer.on("edits",g=>this._edit(g)))}detach(){e("esri-2d-update-debug")&&console.debug("FeatureLayerView2D.detach");this._detachProxy();this._fields=null;this.featureContainer.destroy();this.featureContainer=null;this._commandsQueue.clear();this.container.removeAllChildren();
this._subscriptionManager=p.destroyMaybe(this._subscriptionManager);this._workerProxy.pipeline.onDetach();this._workerAttached=a.createResolver();a.ignoreAbortErrors(this._workerAttached.promise);this._lastAvailableFields=[];this._lastSchema=null}viewChange(){this.requestUpdate()}moveEnd(){this.requestUpdate()}isUpdating(){const g="renderer"in this.layer&&null!=this.layer.renderer,A=this._commandsQueue.updateTracking.updating,F=null!=this._updatingRequiredFieldsPromise,L=this.featureContainer.updatingHandles.updating,
O=this.updateRequested||g&&(A||F)||L||this._pipelineUpdating||this.dataUpdating;if(e("esri-2d-log-updating")){console.log(`Updating FLV2D (${this.layer.id}): ${O}\n  -> updateRequested ${this.updateRequested}\n  -> hasRenderer ${g}\n  -> updatingRequiredFields ${F}\n  -> hasPendingCommand ${A}\n  -> dataUpdating ${this.dataUpdating}\n  -> processing ${this._pipelineUpdating}\n  -> updatingContainer ${L}\n`);for(const P of this.featureContainer.subscriptions())console.log(`    -> Tile[${P.id}] Done: ${P.done}`)}return O}_createClientOptions(){const g=
this;return{get container(){return g.featureContainer},setUpdating:A=>{this._set("_pipelineUpdating",A.pipeline);this._set("dataUpdating",A.data)},emitEvent:A=>{this.emit(A.name,A.event)},get eventLog(){return g.eventLog},fetch:A=>Promise.all(A.map(F=>g.view.stage.painter.textureManager.rasterizeItem(F))),fetchDictionary:A=>Promise.all(A.map(F=>this._fetchDictionaryRequest(F)))}}async _fetchDictionaryRequest(g){try{if("subtype-group"===this.layer.type)throw Error("InternalError: SubtypeGroupLayer does not support dictionary renderer");
const A=this.layer.renderer;if(!A||"dictionary"!==A.type)throw Error("InternalError: Expected layer to have a DictionaryRenderer");const F=this._lastSchema.processor.mesh.factory.symbology;if("dictionary"!==F.type)throw Error("InternalError: Expected schema to be of type 'dictionary'");const L={cimAnalyzer:this.view.stage.cimAnalyzer,cimResourceManager:this.view.stage.painter.textureManager.resourceManager,store:this.featureContainer.instanceStore,scaleExpression:F.scaleExpression};this._fields||
(this._fields=this.layer.fields.map(V=>V.toJSON()));const O=F.visualVariableUniforms,P=await A.getSymbolAsync(g.feature,{fields:this._fields});return P&&P.data?{type:"dictionary-response",meshes:await Y.createComplexSymbolInstances(P.data,{uniforms:O,path:"renderer",schemaOptions:L})}:{type:"dictionary-response",meshes:[]}}catch(A){return{type:"dictionary-response",meshes:[]}}}_cleanUpQuery(g){g=h.from(g)||this.createQuery();g.outSpatialReference||(g.outSpatialReference=this.view.spatialReference);
return g.toJSON()}_cleanUpAggregateQuery(g){g=h.from(g)||this.createAggregateQuery();g.outSpatialReference||(g.outSpatialReference=this.view.spatialReference);const A=g.objectIds??[];for(const F of g.aggregateIds??[])A.push(F);g.objectIds=A;g.aggregateIds=[];return g.toJSON()}async _update(){return this._commandsQueue.push({type:"update"})}async _edit(g){if(this.updateSuspended)this._subscriptionManager.suspend();else if(g=this._getEffectiveEdit(g))return this._commandsQueue.push(g).catch(a.throwIfNotAbortError)}async doRefresh(g){this.attached&&
(this.updateSuspended&&g||(g?this.incrementSourceRefreshVersion():this.incrementDisplayRefreshVersion()))}incrementSourceRefreshVersion(){this._sourceRefreshVersion=(this._sourceRefreshVersion+1)%4294967294+1}incrementDisplayRefreshVersion(){this._displayRefreshVersion=(this._displayRefreshVersion+1)%4294967294+1}_getEffectiveEdit(g){const A="globalIdField"in this.layer&&this.layer.globalIdField;var F=g.deletedFeatures.some(P=>-1===P.objectId||!P.objectId),L=A&&this.availableFields.includes(A);if(F&&
!L)return c.getLogger(this).error(new x("mapview-apply-edits",`Editing the specified service requires the layer's globalIdField, ${A} to be included the layer's outFields for updates to be reflected on the map`)),null;const O=this.layer;F=g.historicMoment?.getTime()??null;if((L="layerId"in O&&g.editedFeatures?.find(P=>P.layerId===O.layerId))&&this._canEditByFeature(L)){const P=ia.toJSONGeometryType(this.layer.geometryType),{adds:V,deletes:ba,updates:na}=L.editedFeatures,ka=this.layer.objectIdField;
g=V.map(Z=>u.convertFromFeature(Z,P,!1,!1));L=na.map(Z=>u.convertFromFeature(Z.current,P,!1,!1));const oa=ba.map(Z=>"attributes"in Z?{globalId:A?Z.attributes[A]:null,objectId:ka?Z.attributes[ka]:null}:Z);return{type:"edit-by-feature",added:g,removed:oa,updated:L,historicMoment:F}}return{type:"edit-by-id",added:g.addedFeatures,updated:g.updatedFeatures,removed:g.deletedFeatures,historicMoment:F}}_canEditByFeature(g){const {adds:A,updates:F}=g.editedFeatures;return A.every(L=>this.view.spatialReference.equals(L.geometry?.spatialReference))&&
F.every(L=>this.view.spatialReference.equals(L.current.geometry?.spatialReference))}async _doUpdate(){"featureReduction"in this.layer&&this.layer.featureReduction&&this.layer.featureReduction!==this._lastFeatureReduction&&(this.layer.featureReduction=this.layer.featureReduction?.clone(),this._lastFeatureReduction=this.layer.featureReduction);try{if(await this._updateRequiredFields(),!this.destroyed&&this.layerAdapter?.hasRequiredSupport&&this._subscriptionManager){var g=this.featureContainer.instanceStore;
this.featureContainer.attributeView.lockTextureUploads();g.updateStart();var A=this.featureEffect,F={store:g,cimAnalyzer:this.view.stage.cimAnalyzer,cimResourceManager:this.view.stage.painter.textureManager.resourceManager,scaleExpression:void 0},L=this._createViewSchemaConfig(),O={source:this.layerAdapter.createSourceSchema(L,this._sourceRefreshVersion),processor:await this.layerAdapter.createProcessorSchema(F,L,this._displayRefreshVersion)},P=w.notDeepEqual(this._lastSchema?.source.mutable,O.source.mutable)||
w.notDeepEqual(this._lastSchema?.processor,O.processor);if(P){this._lastSchema=O;this._fields=null;var V=Math.round(performance.now());e("esri-2d-update-debug")&&console.debug(`Id[${this.layer.uid}] Version[${V}] FeatureLayerView2D._doUpdate`,{changes:P});await (await this.getWorker()).pipeline.updateSchema(O,V);g.updateEnd();this.featureEffectView.featureEffect=A;this.featureEffectView.endTransition();this.featureContainer.restartAllAnimations();this.featureContainer.attributeView.unlockTextureUploads();
this.featureContainer.swapRenderState();this.featureContainer.requestRender();e("esri-2d-update-debug")&&console.debug(`Version[${V}] FeatureLayerView2D.updateEnd`);this.requestUpdate()}else this.featureContainer.requestRender(),this.featureContainer.attributeView.unlockTextureUploads(),g.updateEnd(),this.featureEffectView.featureEffect=A}}catch(ba){e("esri-2d-update-debug")&&console.error("Encountered an error during update",ba)}}async _doEdit(g){const A=await this.getWorker();try{this.featureContainer.editStart(),
await A.pipeline.onEdits(g),this.featureContainer.editEnd()}catch(F){a.isAbortError(F)}}get hasFilter(){const g=this.layerAdapter.hasFilters?.(this.view)??!1;return null!=this.filter||null!=this.timeExtent||0<this._visibilityOverrides.size||g}_getEffectiveAvailableFields(g){this._lastAvailableFields=g=ma(this._lastAvailableFields,g);return C.packFields(this.layer.fieldsIndex,g)}_createViewSchemaConfig(){var g=this.view,A=this.layerAdapter,F=this.timeExtent,L=this._visibilityOverrides,O=this.filter;
O&&=O.clone();const P=null!=O?O.timeExtent:null;if(F=null!=F&&null!=P?F.intersection(P):F||P)O??=new y,O.timeExtent=F;O=A.addFilters?.(O,g)??O;g=O?.toJSON()??null;L.size&&(g??=(new y).toJSON(),g.hiddenIds=Array.from(L));L=this.featureEffect?.filter?.toJSON()??null;L=[g,L];return{availableFields:this._getEffectiveAvailableFields(this.availableFields),filters:L,scale:this.view.scale,timeZone:this.view.timeZone}}_addHighlights(g,A){this._highlightCounter.addGroup(g,A);this._commandsQueue.push({type:"highlight"})}_removeHighlights(g,
A){this._highlightCounter.deleteGroup(g,A);this._commandsQueue.push({type:"highlight"})}async _updateHighlights(){var g=[];for(var A of this._highlightCounter.ids()){var F=this._highlightCounter.getHighlightGroups(A);F=this._getHighlightBits(F);g.push({objectId:A,highlightFlags:F})}A=await this.getWorker();this.destroyed||(g=A.pipeline.updateHighlight({highlights:g}).catch(L=>{a.isAbortError(L)||c.getLogger(this).error(L)}),this._updatingHandles.addPromise(g))}_setLayersForFeature(g){g.layer=g.sourceLayer=
this.layer;this.layerAdapter.setGraphicOrigin&&this.layerAdapter.setGraphicOrigin(g)}_createGraphicHit(g,A){this._setLayersForFeature(A);null!=A.geometry&&(A.geometry.spatialReference=this.view.spatialReference);return{type:"graphic",graphic:A,layer:this.layer,mapPoint:g}}};n.__decorate([f.property()],r.prototype,"_commandsQueue",void 0);n.__decorate([f.property()],r.prototype,"_sourceRefreshVersion",void 0);n.__decorate([f.property()],r.prototype,"_displayRefreshVersion",void 0);n.__decorate([f.property({readOnly:!0})],
r.prototype,"_pipelineUpdating",void 0);n.__decorate([f.property({readOnly:!0})],r.prototype,"hasAllFeatures",null);n.__decorate([f.property({readOnly:!0})],r.prototype,"hasAllFeaturesInView",null);n.__decorate([f.property({readOnly:!0})],r.prototype,"hasFullGeometries",null);n.__decorate([f.property()],r.prototype,"featureEffectView",void 0);n.__decorate([f.property()],r.prototype,"labelingCollisionInfos",null);n.__decorate([f.property()],r.prototype,"layerAdapter",null);n.__decorate([f.property({readOnly:!0})],
r.prototype,"timeExtent",null);n.__decorate([f.property()],r.prototype,"updating",void 0);return r=n.__decorate([m.subclass("esri.views.2d.layers.FeatureLayerView2D")],r)});