// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.31/esri/copyright.txt for details.
//>>built
define(["../../../geometry/support/spatialReferenceUtils","./TileKey"],function(u,v){function g(a,b,c){a[0]=b;a[1]=c;return a}const f=new v("0/0/0/0");class r{static create(a,b,c=null){const d=u.getInfo(a.spatialReference),e=b.origin||[a.origin.x,a.origin.y],h=[a.size[0]*b.resolution,a.size[1]*b.resolution],k=[-Infinity,-Infinity],l=[Infinity,Infinity],m=[Infinity,Infinity];null!=c&&(g(k,Math.max(0,Math.floor((c.xmin-e[0])/h[0])),Math.max(0,Math.floor((e[1]-c.ymax)/h[1]))),g(l,Math.max(0,Math.floor((c.xmax-
e[0])/h[0])),Math.max(0,Math.floor((e[1]-c.ymin)/h[1]))),g(m,l[0]-k[0]+1,l[1]-k[1]+1));const {cols:n,rows:p}=b;!c&&n&&p&&(g(k,n[0],p[0]),g(l,n[1],p[1]),g(m,n[1]-n[0]+1,p[1]-p[0]+1));let q,t;a.isWrappable?(a=[Math.ceil(Math.round((d.valid[1]-d.valid[0])/b.resolution)/a.size[0]),m[1]],c=!0,q=d.origin,t=d.valid):(a=m,c=!1);return new r(b.level,b.resolution,b.scale,e,k,l,m,h,a,c,q,t)}constructor(a,b,c,d,e,h,k,l,m,n,p,q){this.level=a;this.resolution=b;this.scale=c;this.origin=d;this.first=e;this.last=
h;this.size=k;this.norm=l;this.worldSize=m;this.wrap=n;this._spatialReferenceOrigin=p;this._spatialReferenceValid=q}normalizeCol(a){if(!this.wrap)return a;const b=this.worldSize[0];return 0>a?b-1-Math.abs((a+1)%b):a%b}normalizeKey(a){if(this.wrap){var b=this.worldSize[0],c=a.col;0>c?(a.col=c+b,--a.world):c>=b&&(a.col=c-b,a.world+=1)}}denormalizeCol(a,b){return this.wrap?this.worldSize[0]*b+a:a}getWorldForColumn(a){return this.wrap?Math.floor(a/this.worldSize[0]):0}getFirstColumnForWorld(a){return a*
this.worldSize[0]+this.first[0]}getLastColumnForWorld(a){return a*this.worldSize[0]+this.first[0]+this.size[0]-1}getColumnForX(a){return(a-this.origin[0])/this.norm[0]}getXForColumn(a){const b=this.origin[0]+a*this.norm[0],c=this._spatialReferenceOrigin,d=this._spatialReferenceValid;return this.wrap&&c&&d?b===c[0]?d[0]:this.origin[0]===c[0]&&a===this.worldSize[0]?d[1]:b:b}getRowForY(a){return(this.origin[1]-a)/this.norm[1]}getYForRow(a){return this.origin[1]-a*this.norm[1]}getTileBounds(a,b,c=!1){f.set(b);
var d=c?f.col:this.denormalizeCol(f.col,f.world),e=f.row;b=this.getXForColumn(d);c=this.getYForRow(e+1);d=this.getXForColumn(d+1);e=this.getYForRow(e);a[0]=b;a[1]=c;a[2]=d;a[3]=e;return a}getTileCoords(a,b,c=!1){f.set(b);b=c?f.col:this.denormalizeCol(f.col,f.world);Array.isArray(a)?g(a,this.getXForColumn(b),this.getYForRow(f.row)):(a.x=this.getXForColumn(b),a.y=this.getYForRow(f.row));return a}}return r});