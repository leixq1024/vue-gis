// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.31/esri/copyright.txt for details.
//>>built
require({cache:{"esri/views/2d/engine/Stage":function(){define("require exports ../../../core/Error ../../../core/has ../../../core/maybe ../../../core/scheduling ../../../core/signal ../../../core/libs/gl-matrix-2/factories/mat3f32 ../../../symbols/cim/cimAnalyzer ./Container ./ManagedCanvas ./webgl/definitions ./webgl/enums ./webgl/Painter ./webgl/PooledUint32Array ./webgl/Profiler ./webgl/TileReshuffleManager ./webgl/shaderGraph/techniques/TechniqueRegistry ./webgl/shaderGraph/techniques/mesh/MeshWriterRegistry ../support/Timeline ../../webgl/enums ../../webgl/FramebufferObject ../../webgl/RenderbufferDescriptor ../../webgl/RenderingContext ../../webgl/TextureDescriptor".split(" "),
function(l,q,n,d,m,h,g,c,a,b,k,e,r,f,p,t,w,z,u,y,A,v,x,C,B){class E extends b.Container{constructor(D,F){super();this.meshWriterRegistry=new u.MeshWriterRegistry;this._trash=new Set;this._lastFrameRenderTime=this._renderRemainingTime=0;this._renderRequested=g.signal(!1);this.stage=this;this._stationary=!0;this._reshuffleManager=new w.TileReshuffleManager;this._canvas=new k.ManagedCanvas(D);this.context=new C.RenderingContext(this._canvas.gl,F.contextOptions??{});this.painter=new f(this.context,this);
this._cimAnalyzer=new a.CIMAnalyzer(this.painter.textureManager.resourceManager);d("esri-2d-profiler")&&(this._debugOutput=document.createElement("div"),this._debugOutput.setAttribute("style","margin: 24px 64px; position: absolute; color: red;"),D.appendChild(this._debugOutput));const G=()=>this.highlightGradient;this._renderParameters={drawPhase:0,state:this.state,pixelRatio:window.devicePixelRatio,stationary:!1,globalOpacity:1,blendMode:null,deltaTime:-1,time:0,inFadeTransition:!1,effects:null,
context:this.context,painter:this.painter,timeline:F.timeline||new y.Timeline,renderingOptions:F.renderingOptions,requestRender:()=>this.requestRender(),allowDelayedRender:!1,requireFBO:!1,profiler:new t.Profiler(this.context,this._debugOutput),dataUploadCounter:0,get highlightGradient(){return G()},reshuffleManager:this._reshuffleManager,backgroundColor:F.backgroundColor};this._taskHandle=h.addFrameTask({render:H=>this.renderFrame(H)});this._taskHandle.pause();this._lostWebGLContextHandle=this._canvas.events.on("webgl-context-lost",
H=>this.emit("webgl-error",{error:new n("webgl-context-lost",H.statusMessage)}));this._bufferPool=new p.ArrayBufferPool;z.startup()}destroy(){z.shutdown(this.context);this.removeAllChildren();this._emptyTrash();this._taskHandle=m.removeMaybe(this._taskHandle);this._lostWebGLContextHandle=m.removeMaybe(this._lostWebGLContextHandle);this._canvas.destroy();this._debugOutput?.parentNode?.removeChild(this._debugOutput);this._bufferPool.destroy();this.painter.dispose();this.context.dispose();this._canvas=
null}get textureManager(){return this.painter.textureManager}get backgroundColor(){return this._renderParameters.backgroundColor}set backgroundColor(D){this._renderParameters.backgroundColor=D;this.requestRender()}get bufferPool(){return this._bufferPool}get cimAnalyzer(){return this._cimAnalyzer}get renderingOptions(){return this._renderingOptions}set renderingOptions(D){this._renderingOptions=D;this.requestRender()}get renderRequested(){return this._renderRequested.value}get state(){return this._state}set state(D){this._state=
D;this.requestRender()}get stationary(){return this._stationary}set stationary(D){this._stationary!==D&&(this._stationary=D,this.requestRender())}trashDisplayObject(D){this._trash.add(D);this.requestRender()}untrashDisplayObject(D){return this._trash.delete(D)}requestRender(){this._renderRemainingTime=2E3;this.renderRequested||(this._renderRequested.value=!0,this._taskHandle.resume())}renderFrame(D){this._renderRemainingTime-=this._lastFrameRenderTime?D.time-this._lastFrameRenderTime:0;0>=this._renderRemainingTime&&
this._taskHandle.pause();this._lastFrameRenderTime=D.time;this._renderRequested.value=!1;this._renderParameters.state=this._state;this._renderParameters.stationary=this.stationary;this._renderParameters.pixelRatio=window.devicePixelRatio;this._renderParameters.globalOpacity=1;this._renderParameters.time=D.time;this._renderParameters.deltaTime=D.deltaTime;this._renderParameters.effects=null;this.processRender(this._renderParameters);this._emptyTrash()}_createTransforms(){return{displayViewScreenMat3:c.create()}}renderChildren(D){for(const F of this.children)F.beforeRender(D);
this._reshuffleManager.reshuffle(e.MAX_TILE_RESHUFFLES_PER_FRAME);this._canvas.render(D,()=>this._renderChildren(this.children,D));for(const F of this.children)F.afterRender(D)}_renderChildren(D,F){const G=this.context;this.painter.textureUploadManager.upload();G.resetInfo();F.profiler.recordStart("drawLayers");F.dataUploadCounter=0;this.painter.beforeRenderPhases(F,F.backgroundColor,this.state.padding);F.drawPhase=r.WGLDrawPhase.MAP;for(const H of D)H.processRender(F);if(this.children.some(H=>H.hasHighlight)){F.drawPhase=
r.WGLDrawPhase.HIGHLIGHT;for(const H of D)H.processRender(F)}if(this.children.some(H=>H.hasLabels)){F.drawPhase=r.WGLDrawPhase.LABEL;for(const H of D)H.processRender(F)}if(d("esri-tiles-debug")){F.drawPhase=r.WGLDrawPhase.DEBUG;for(const H of D)H.processRender(F)}this.painter.afterRenderPhases(F);F.profiler.recordEnd("drawLayers");G.logInfo()}doRender(D){const F=this.context,{state:G,pixelRatio:H}=D;this._canvas.resize(D);F.setViewport(0,0,H*G.size[0],H*G.size[1]);F.setDepthWriteEnabled(!0);F.setStencilWriteMask(255);
this.renderChildren(D)}async takeScreenshot(D,F,G,H){const I=Math.round(this.state.size[0]*D.resolutionScale),K=Math.round(this.state.size[1]*D.resolutionScale);var L=D.resolutionScale,R=this.context,S=this._state.clone();if(null!=H){const W=S.viewpoint;S.viewpoint.rotation=H;S.viewpoint=W}H={...this._renderParameters,drawPhase:null,globalOpacity:1,stationary:!0,state:S,pixelRatio:L,time:performance.now(),deltaTime:0,blendMode:null,effects:null,inFadeTransition:!1,backgroundColor:G};G=new B.TextureDescriptor(I,
K);G.wrapMode=A.TextureWrapMode.CLAMP_TO_EDGE;G.internalFormat=A.SizedPixelFormat.RGBA8;G.isImmutable=!0;G=new v.FramebufferObject(R,G,new x.RenderbufferDescriptor(A.RenderbufferFormat.DEPTH_STENCIL,I,K));L=R.getBoundFramebufferObject();S=R.getViewport();R.bindFramebuffer(G);R.setViewport(0,0,I,K);this._renderChildren(F??this.children,H);F=this._readbackScreenshot(G,{...D.cropArea,y:K-(D.cropArea.y+D.cropArea.height)});R.bindFramebuffer(L);R.setViewport(S.x,S.y,S.width,S.height);this.requestRender();
R=await F;1===D.outputScale?D=R:(D=new ImageData(Math.round(R.width*D.outputScale),Math.round(R.height*D.outputScale)),(await new Promise((W,J)=>l(["../../support/screenshotUtils"],W,J))).resampleHermite(R,D,!0));G.dispose();return D}async _readbackScreenshot(D,F){const G=(await new Promise((H,I)=>l(["../../support/screenshotUtils"],H,I))).createEmptyImageData(F.width,F.height,document.createElement("canvas"));await D.readPixelsAsync(F.x,F.y,F.width,F.height,A.PixelFormat.RGBA,A.PixelType.UNSIGNED_BYTE,
new Uint8Array(G.data.buffer));return G}_emptyTrash(){for(;0<this._trash.size;){const D=Array.from(this._trash);this._trash.clear();for(const F of D)F.processDetach()}}}q.Stage=E;q.extraRenderTime=2E3;Object.defineProperty(q,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/cimAnalyzer":function(){define("exports ../../core/colorUtils ../../core/fontUtils ../../core/lang ../../core/Logger ../../core/screenUtils ../../core/string ./animationUtils ./CIMSymbolHelper ./defaultCIMValues ./enums ./OverrideHelper ./SDFHelper ./utils ./effects/CIMEffectHelper ../../views/2d/engine/webgl/definitions".split(" "),
function(l,q,n,d,m,h,g,c,a,b,k,e,r,f,p,t){function w(v){return v&&0===v.indexOf("Level_")&&(v=parseInt(v.slice(6),10),!isNaN(v))?v:0}function z(v){var x=v.symbolLayers;if(!x)return!1;v=x.find(C=>C.effects?.find(B=>"CIMGeometricEffectDashes"===B.type&&null!=B.dashTemplate));x=x.find(C=>C.effects?.find(B=>"CIMGeometricEffectAddControlPoints"===B.type));return!!v||!!x}function u(v){return d.clone(v).map(x=>({...x,propertyName:f.uncapitalize(x.propertyName)}))}function y(v){return c.shouldUseAnimatedPath(v)?
{type:"animation-params",params:v}:null}class A{constructor(v){this._cimLayers=[];this._poMap={};this._primitiveOverrides=[];v&&(this._resourceManager=v)}analyzeSymbolReference(v,x,C){this._cimLayers=C??[];if(!v)return this._cimLayers;this._reset();if(v.primitiveOverrides){this._primitiveOverrides=v.primitiveOverrides;for(const B of this._primitiveOverrides)(C=B.valueExpressionInfo)?this._setPoMap(B.primitiveName,B.propertyName,C):null!=B.value&&(C=B.value,B.propertyName.includes("Color")&&(q.isRGB(C)&&
(C=f.colorToArray(C)),C=f.normalizeAlpha(C)),this._setPoMap(B.primitiveName,B.propertyName,C))}this._analyzeSymbol(v.symbol,x);return this._cimLayers}_reset(){this._cimLayers=[];this._poMap={};this._primitiveOverrides=[]}_analyzeSymbol(v,x){switch(v?.type){case "CIMPointSymbol":case "CIMLineSymbol":case "CIMPolygonSymbol":this._analyzeMultiLayerSymbol(v,x)}}_analyzeMultiLayerSymbol(v,x){const C=v?.symbolLayers;if(C){var B=v.effects,E=k.Alignment.SCREEN,D=f.getSize(v)??0;"CIMPointSymbol"===v.type&&
"Map"===v.angleAlignment&&(E=k.Alignment.MAP);var F={transform:[0,0,0,1],fromColor:[1,1,1,1],toColor:[1,1,1,1],colorMix:[0,0,0,0],toOpacity:[1,1,1,1],opacityMix:[0,0,0,0],hasAnimations:c.checkForAnimations(v)};F=c.getAnimationParams(this._poMap,v,F);for(var G="CIMPolygonSymbol"===v.type,H=C.length;H--;){const R=C[H];if(!R||!1===R.enable)continue;let S;B?.length&&(S=[...B]);var I=R.effects;I?.length&&(B?S.push(...I):S=[...I]);I=null;if(S){I=[];for(const W of S){var K=e.OverrideHelper.findEffectOverrides(W,
this._primitiveOverrides);K&&I.push(K)}}e.OverrideHelper.findApplicableOverrides(R,this._primitiveOverrides,[]);switch(R.type){case "CIMSolidFill":this._analyzeSolidFill(R,I);break;case "CIMPictureFill":this._analyzePictureFill(R,I);break;case "CIMHatchFill":this._analyzeHatchFill(R,I);break;case "CIMGradientFill":this._analyzeGradientFill(R,I);break;case "CIMSolidStroke":this._analyzeSolidStroke(R,I,G,D);break;case "CIMPictureStroke":this._analyzePictureStroke(R,I,G,D);break;case "CIMGradientStroke":this._analyzeGradientStroke(R,
I,G,D);break;case "CIMCharacterMarker":case "CIMPictureMarker":case "CIMVectorMarker":if("CIMLineSymbol"===v.type||"CIMPolygonSymbol"===v.type)E=(E=R.markerPlacement)&&E.angleToLine?k.Alignment.MAP:k.Alignment.SCREEN;K=[];var L=R.primitiveName;L&&K.push(L);L=G&&f.isCIMMarkerStrokePlacement(R.markerPlacement);this._analyzeMarker(R,I,null,K,E,D,x,[],F,!1,L);break;default:m.getLogger("esri.symbols.cim.cimAnalyzer").error("Cannot analyze CIM layer",R.type)}}}}_analyzeSolidFill(v,x){const {primitiveName:C,
type:B}=v,E=f.normalizeAlpha(v.color);this._cimLayers.push({type:"fill",spriteRasterizationParam:null,colorLocked:!!v.colorLocked,color:this._getValueOrOverrideExpression(B,C,"Color",E),height:0,angle:0,offsetX:0,offsetY:0,scaleX:1,effects:x,applyRandomOffset:!1,sampleAlphaOnly:!0,hasUnresolvedReplacementColor:!1})}_analyzePictureFill(v,x){const {primitiveName:C,type:B}=v,E=f.getTintColor(v),D=f.getNumericValue(v.height,b.defaultCIMValues.CIMPictureFill.height);let F=f.getNumericValue(v.scaleX,1);
if("width"in v&&"number"===typeof v.width){var G=v.width;let H=1;const I=this._resourceManager.getResource(v.url);null!=I&&(H=I.width/I.height);F/=D/G*H}G={type:"sprite-rasterization-param",resource:v,overrides:this._getPrimitiveMaterialOverrides(C,B)};this._cimLayers.push({type:"fill",spriteRasterizationParam:G,colorLocked:!!v.colorLocked,effects:x,color:this._getValueOrOverrideExpression(B,C,"TintColor",E),height:this._getValueOrOverrideExpression(B,C,"Height",D),scaleX:this._getValueOrOverrideExpression(B,
C,"ScaleX",F),angle:this._getValueOrOverrideExpression(B,C,"Rotation",f.getNumericValue(v.rotation)),offsetX:this._getValueOrOverrideExpression(B,C,"OffsetX",f.getNumericValue(v.offsetX)),offsetY:this._getValueOrOverrideExpression(B,C,"OffsetY",f.getNumericValue(v.offsetY)),applyRandomOffset:!1,sampleAlphaOnly:!1,hasUnresolvedReplacementColor:!1})}_analyzeHatchFill(v,x){const {primitiveName:C,type:B}=v;var E=this._analyzeMaterialOverrides(C,["Rotation","OffsetX","OffsetY"]);E=f.normalizePrimitiveOverrideProps(E);
let D=[255,255,255,1],F=!1;if(v.lineSymbol?.symbolLayers)for(const H of v.lineSymbol.symbolLayers){if("CIMSolidStroke"!==H.type)continue;const I=H.primitiveName??C;F||!I||H.colorLocked||null==this._poMap[I]?.Color&&null==this._poMap[I]?.StrokeColor||(D=f.normalizeAlpha(H.color),D=this._maybeGetValueOrOverrideExpression(I,"StrokeColor")??this._getValueOrOverrideExpression(B,I,"Color",D),F=!0);var G=this._maybeGetValueOrOverrideExpression(I,"StrokeWidth");if(G){let K=null,L=null;"number"===typeof G?
K=G:L=G.valueExpressionInfo;(G=E.find(R=>"strokeWidth"===R.propertyName))?G.propertyName="width":(G={type:"CIMPrimitiveOverride",primitiveName:I,propertyName:"width",valueExpressionInfo:L,value:K,defaultValue:f.getDefaultCIMValue(B,"width")},E.push(G))}}this._cimLayers.push({type:"fill",spriteRasterizationParam:{type:"sprite-rasterization-param",resource:v,overrides:E},colorLocked:!!v.colorLocked,effects:x,color:D,height:this._getValueOrOverrideExpression(B,C,"Separation",f.getNumericValue(v.separation,
b.defaultCIMValues.CIMHatchFill.separation)),scaleX:1,angle:this._getValueOrOverrideExpression(B,C,"Rotation",f.getNumericValue(v.rotation)),offsetX:this._getValueOrOverrideExpression(B,C,"OffsetX",f.getNumericValue(v.offsetX)),offsetY:this._getValueOrOverrideExpression(B,C,"OffsetY",f.getNumericValue(v.offsetY)),applyRandomOffset:!1,sampleAlphaOnly:!0,hasUnresolvedReplacementColor:!F})}_analyzeGradientFill(v,x){this._cimLayers.push({type:"fill",spriteRasterizationParam:null,colorLocked:!!v.colorLocked,
effects:x,color:[128,128,128,1],height:0,angle:0,offsetX:0,offsetY:0,scaleX:1,applyRandomOffset:!1,sampleAlphaOnly:!1,hasUnresolvedReplacementColor:!1})}_analyzeSolidStroke(v,x,C,B){const {primitiveName:E,type:D}=v,F=f.normalizeAlpha(v.color),G=f.getNumericValue(v.width,b.defaultCIMValues.CIMSolidStroke.width),H=f.getEnum(v.capStyle,b.defaultCIMValues.CIMSolidStroke.capstyle),I=f.getEnum(v.joinStyle,b.defaultCIMValues.CIMSolidStroke.joinstyle),K=v.miterLimit;let L=[];this._analyzePrimitiveOverrides(E,
x,null,null)&&(L=this._getPrimitiveMaterialOverrides(E,D));let R,S,W,J;if(x&&Array.isArray(x)&&0<x.length){const O=x[x.length-1].effect;O&&"CIMGeometricEffectDashes"===O.type&&"NoConstraint"===O.lineDashEnding&&(R=O.dashTemplate,S=O.scaleDash,W=O.offsetAlongLine,J=O.primitiveName,x=[...x],x.pop())}null!=J&&L.push(...this._getPrimitiveMaterialOverrides(J,D).filter(O=>"dashTemplate"===O.propertyName));this._cimLayers.push({type:"line",spriteRasterizationParam:void 0!==R?{type:"sprite-rasterization-param",
resource:{type:"dash",dashTemplate:R,primitiveName:J},overrides:L}:null,isOutline:C,colorLocked:!!v.colorLocked,effects:x,color:this._getValueOrOverrideExpression(D,E,"Color",F),width:this._getValueOrOverrideExpression(D,E,"Width",G),cap:this._getValueOrOverrideExpression(D,E,"CapStyle",H),join:this._getValueOrOverrideExpression(D,E,"JoinStyle",I),miterLimit:K&&this._getValueOrOverrideExpression(D,E,"MiterLimit",K),referenceWidth:B,zOrder:w(v.name),dashTemplate:this._maybeGetValueOrOverrideExpression(J,
"DashTemplate")??R,offsetAlongLine:this._getValueOrOverrideExpression(D,J,"OffsetAlongLine",W??0),scaleDash:S,sampleAlphaOnly:!0})}_analyzePictureStroke(v,x,C,B){const {primitiveName:E,type:D}=v,F=f.getTintColor(v),G=f.getNumericValue(v.width,b.defaultCIMValues.CIMPictureStroke.width),H=f.getEnum(v.capStyle,b.defaultCIMValues.CIMPictureStroke.capstyle),I=f.getEnum(v.joinStyle,b.defaultCIMValues.CIMPictureStroke.joinstyle),K=v.miterLimit,L={type:"sprite-rasterization-param",resource:v,overrides:this._getPrimitiveMaterialOverrides(E,
D)};this._cimLayers.push({type:"line",spriteRasterizationParam:L,isOutline:C,colorLocked:!!v.colorLocked,effects:x,color:this._getValueOrOverrideExpression(D,E,"TintColor",F),width:this._getValueOrOverrideExpression(D,E,"Width",G),cap:this._getValueOrOverrideExpression(D,E,"CapStyle",H),join:this._getValueOrOverrideExpression(D,E,"JoinStyle",I),miterLimit:K&&this._getValueOrOverrideExpression(D,E,"MiterLimit",K),referenceWidth:B,zOrder:w(v.name),dashTemplate:null,scaleDash:!1,sampleAlphaOnly:!1})}_analyzeGradientStroke(v,
x,C,B){const {primitiveName:E,type:D}=v,F=f.getNumericValue(v.width,b.defaultCIMValues.CIMSolidStroke.width),G=f.getEnum(v.capStyle,b.defaultCIMValues.CIMGradientStroke.capstyle),H=f.getEnum(v.joinStyle,b.defaultCIMValues.CIMGradientStroke.joinstyle),I=v.miterLimit;this._cimLayers.push({type:"line",spriteRasterizationParam:null,isOutline:C,colorLocked:!!v.colorLocked,effects:x,color:[128,128,128,1],width:this._getValueOrOverrideExpression(D,E,"Width",F),cap:this._getValueOrOverrideExpression(D,E,
"CapStyle",G),join:this._getValueOrOverrideExpression(D,E,"JoinStyle",H),miterLimit:I&&this._getValueOrOverrideExpression(D,E,"MiterLimit",I),referenceWidth:B,zOrder:w(v.name),dashTemplate:null,scaleDash:!1,sampleAlphaOnly:!1})}_analyzeMarker(v,x,C,B,E,D,F,G,H,I=!1,K=!1){I||=!!v.colorLocked;if(!this._analyzeMarkerInsidePolygon(v,x,I)){var L=f.getNumericValue(v.size,b.defaultCIMValues.CIMVectorMarker.size),R=f.getNumericValue(v.rotation),S=f.getNumericValue(v.offsetX),W=f.getNumericValue(v.offsetY),
{primitiveName:J,type:O}=v;L=this._getValueOrOverrideExpression(O,J,"Size",L);R=this._getValueOrOverrideExpression(O,J,"Rotation",R);S=this._getValueOrOverrideExpression(O,J,"OffsetX",S);W=this._getValueOrOverrideExpression(O,J,"OffsetY",W);H=c.handleAbsoluteAnchor(v,H);H=c.handleMarker(this._poMap,v,H);H=c.handleRelativeAnchor(v,H);H=c.getAnimationParams(this._poMap,v,H);switch(v.type){case "CIMPictureMarker":this._analyzePictureMarker(v,x,C,B,E,D,L,R,S,W,G,H,I,K);break;case "CIMVectorMarker":this._analyzeVectorMarker(v,
x,C,B,E,D,L,R,S,W,G,H,F,I,K)}}}_analyzeMarkerInsidePolygon(v,x,C){const {markerPlacement:B,type:E}=v;if(!B||"CIMMarkerPlacementInsidePolygon"!==B.type)return!1;if("CIMVectorMarker"===E||"CIMPictureMarker"===E){var D=v.primitiveName;if(D&&this._analyzePrimitiveOverrides([D],x,null,null)||(D=B.primitiveName)&&this._analyzePrimitiveOverrides([D],x,null,null))return!1;if("CIMVectorMarker"===E){if({markerGraphics:D}=v,D)for(var F of D)if({symbol:D}=F,"CIMPolygonSymbol"===D?.type&&D.symbolLayers){({symbolLayers:D}=
D);for(var G of D)if("CIMSolidStroke"===G.type)return!1}}else if({animatedSymbolProperties:F}=v,F)return!1}G=Math.abs(B.stepX);D=Math.abs(B.stepY);if(0===G||0===D)return!0;if("Random"===B.gridType){F=h.px2pt(t.randomInsidePolygonTextureSize);const H=Math.max(Math.floor(F/G),1);F=D*Math.max(Math.floor(F/D),1);G=H*G/F}else B.shiftOddRows?(F=2*D,G=G/D*.5):(F=D,G/=D);D=f.getTintColor(v);this._cimLayers.push({type:"fill",spriteRasterizationParam:"CIMCharacterMarker"===v.type?null:{type:"sprite-rasterization-param",
resource:v,overrides:[]},colorLocked:C,effects:x,color:D,height:F,scaleX:G,angle:B.gridAngle,offsetX:f.getNumericValue(B.offsetX),offsetY:f.getNumericValue(B.offsetY),applyRandomOffset:"Random"===B.gridType,sampleAlphaOnly:"CIMPictureMarker"!==v.type,hasUnresolvedReplacementColor:!0});return!0}_analyzePictureMarker(v,x,C,B,E,D,F,G,H,I,K,L,R,S){const {animatedSymbolProperties:W,primitiveName:J,type:O}=v;let T=f.getNumericValue(v.scaleX,1);const X=f.getTintColor(v);C||=this._createMarkerPlacementOverrideExpression(v.markerPlacement);
const U=this._createGIFAnimatedSymbolPropertiesOverrideExpression(W),N=v.anchorPoint??{x:0,y:0};if("width"in v&&"number"===typeof v.width){var Q=v.width;let V=1;var P=this._resourceManager.getResource(v.url);null!=P&&(V=P.width/P.height);P=f.getNumericValue(v.size);T/=P/Q*V}B=[...B];v.primitiveName&&B.push(v.primitiveName);W||U?Q={type:"animated",url:v.url,urlHash:"H"+g.numericHash(v.url),playAnimation:v.animatedSymbolProperties?.playAnimation,reverseAnimation:v.animatedSymbolProperties?.reverseAnimation,
randomizeStartTime:v.animatedSymbolProperties?.randomizeStartTime,randomizeStartSeed:v.animatedSymbolProperties?.randomizeStartSeed,startTimeOffset:v.animatedSymbolProperties?.startTimeOffset,duration:v.animatedSymbolProperties?.duration,repeatType:v.animatedSymbolProperties?.repeatType,repeatDelay:v.animatedSymbolProperties?.repeatDelay}:(Q=d.clone(v),Q.markerPlacement=null);B={type:"sprite-rasterization-param",resource:Q,overrides:this._getMaterialOverrides(B,O)};U&&B.overrides.push(...U.overrides);
this._cimLayers.push({type:"marker",spriteRasterizationParam:B,colorLocked:R,effects:x,scaleSymbolsProportionally:!1,alignment:E,size:F,scaleX:this._getValueOrOverrideExpression(O,J,"ScaleX",T),rotation:G,offsetX:H,offsetY:I,transform:{type:"cim-marker-transform-param",params:K},color:this._getValueOrOverrideExpression(O,J,"TintColor",X),anchorPoint:{x:N.x,y:N.y},isAbsoluteAnchorPoint:"Relative"!==v.anchorPointUnits,outlineColor:[0,0,0,0],outlineWidth:0,frameHeight:0,widthRatio:1,rotateClockwise:!!v.rotateClockwise,
referenceSize:D,sizeRatio:1,isOutline:S,markerPlacement:C,animationParams:y(L),baseSize:F})}_analyzeVectorMarker(v,x,C,B,E,D,F,G,H,I,K,L,R,S,W){var J=v.markerGraphics;if(J){var O=v.frame,T=0;T=O?O.ymax-O.ymin:D;var X=!!v.scaleSymbolsProportionally;T&&(F={offsetX:H,offsetY:I,rotation:G,size:F,frameHeight:T,rotateClockWise:!!v.rotateClockwise,absoluteAnchorPoint:!1,scaleSymbolsProportionally:X},K=[...K,F]);C||=this._createMarkerPlacementOverrideExpression(v.markerPlacement);for(const N of J)if(N){J=
N.symbol;if(!J)continue;(F=N.primitiveName)&&B.push(F);G=L;var U=void 0;if(("CIMPointSymbol"===J.type||"CIMTextSymbol"===J.type)&&O){H=U=0;I=N.geometry;"x"in I&&"y"in I&&(U+=I.x-.5*(O.xmin+O.xmax),H+=I.y-.5*(O.ymin+O.ymax));I=v.anchorPoint;let V=!1;I&&("Absolute"===v.anchorPointUnits?(U-=I.x,H-=I.y,V=!0):O&&(U-=(O.xmax-O.xmin)*I.x,H-=(O.ymax-O.ymin)*I.y));U={offsetX:U,offsetY:H,rotation:0,size:0,frameHeight:0,rotateClockWise:!1,absoluteAnchorPoint:V,scaleSymbolsProportionally:X};U=[...K,U]}const [Q,
P]=c.getFrameTranslation(N.geometry,O);if(0!==Q||0!==P)G=c.translate(G,Q,P);"CIMPointSymbol"===J.type&&(G=c.getAnimationParams(this._poMap,J,G));switch(J.type){case "CIMPointSymbol":case "CIMLineSymbol":case "CIMPolygonSymbol":R||z(J)?(G={...G,transform:{type:"AnimatedTransform",relativeTranslation:!1,absoluteScale:!0,translation:c.getStaticParam([0,0]),rotation:c.getStaticParam(0),scale:c.getStaticParam(T),parent:L.transform}},this._analyzeMultiLayerGraphicNonSDF(v,x,C,N,B,E,D,U??K,G,T,S,W)):this._analyzeMultiLayerGraphic(v,
x,C,N,B,E,D,U??K,G,T,S,W);break;case "CIMTextSymbol":this._analyzeTextGraphic(x,C,N,B,E,D,U??K,S)}F&&B.pop()}}}_analyzeMultiLayerGraphic(v,x,C,B,E,D,F,G,H,I,K,L){var R=B.symbol;const S=R.symbolLayers;if(S){var W=S.length;if(!(S&&2===S.length&&S[0].enable&&S[1].enable&&"CIMSolidStroke"===S[0].type&&"CIMSolidFill"===S[1].type&&null==S[0].path&&null==S[1].path)||S[0].effects||S[1].effects||S[0].animations||S[1].animations||c.shouldUseAnimatedPath(H)){var J=this._resourceManager.geometryEngine;if(R=p.CIMEffectHelper.applyEffects(R.effects,
B.geometry,J))for(;W--;){const P=S[W];if(!P||!1===P.enable)continue;const V=P.primitiveName;V&&E.push(V);switch(P.type){case "CIMSolidFill":case "CIMSolidStroke":const Z=p.CIMEffectHelper.applyEffects(P.effects,R,J);var O=r.getExtent(Z);if(!O)continue;const ba="Relative"!==v.anchorPointUnits;var T=f.getStrokeWidth(P)??0;const {frameSizeRatio:aa,anchorX:ca,anchorY:ea,widthRatio:fa,sdfPaddingRatio:ha}=r.getSDFMetrics(O,v.frame,v.size,v.anchorPoint,ba,T,v.scaleSymbolsProportionally);var X="CIMSolidFill"===
P.type,U={type:"sdf",geom:Z,sdfPaddingRatio:ha,asFill:X},{path:N}=P;O=X?f.normalizeAlpha(f.getFillColor(P)):null==N?f.normalizeAlpha(f.getStrokeColor(P)):[0,0,0,0];var Q=X?[0,0,0,0]:f.normalizeAlpha(f.getStrokeColor(P));if(!X&&!T)break;const ja=B.primitiveName;let la=null;X&&!P.colorLocked&&(la=this._maybeGetValueOrOverrideExpression(ja,"FillColor"));let oa=null;X||P.colorLocked||(oa=this._maybeGetValueOrOverrideExpression(ja,"StrokeColor"));O=la??this._getValueOrOverrideExpression(P.type,V,"Color",
O);Q=oa??this._getValueOrOverrideExpression(P.type,V,"Color",Q);T=this._maybeGetValueOrOverrideExpression(ja,"StrokeWidth")??this._getValueOrOverrideExpression(P.type,V,"Width",T);X=N?{type:"sprite-rasterization-param",resource:{type:"path",path:N,asFill:X},overrides:[]}:{type:"sprite-rasterization-param",resource:U,overrides:[]};U=c.getAnimationParams(this._poMap,P,H);N=f.getNumericValue(v.size,b.defaultCIMValues.CIMVectorMarker.size);N=this._getValueOrOverrideExpression(v.type,v.primitiveName,"Size",
N);this._cimLayers.push({type:"marker",spriteRasterizationParam:X,colorLocked:!!P.colorLocked||!!K,effects:x,scaleSymbolsProportionally:!!v.scaleSymbolsProportionally,alignment:D,anchorPoint:{x:ca,y:ea},isAbsoluteAnchorPoint:ba,size:I,rotation:0,offsetX:0,offsetY:0,scaleX:1,transform:{type:"cim-marker-transform-param",params:G},frameHeight:I,widthRatio:fa,rotateClockwise:!1,referenceSize:F,sizeRatio:aa,color:O,outlineColor:Q,outlineWidth:T,isOutline:L,markerPlacement:C,animationParams:y(U),isStroke:"CIMSolidFill"===
P.type?!1:!0,baseSize:N,...r.getSDFDimensions(Z,ha)});break;case "CIMPictureMarker":case "CIMVectorMarker":P.markerPlacement?this._analyzeMultiLayerGraphicNonSDF(v,x,C,B,E,D,F,G,H,I,!!P.colorLocked||!!K,L):this._analyzeMarker(P,x,C,E,D,F,!1,G,H,K,L);break;default:this._analyzeMultiLayerGraphicNonSDF(v,x,C,B,E,D,F,G,H,I,!!P.colorLocked||!!K,L)}V&&E.pop()}}else this._analyzeCompositeMarkerGraphic(v,x,C,B,S,D,F,G,I,K,L)}}_analyzeTextGraphic(v,x,C,B,E,D,F,G){e.OverrideHelper.findApplicableOverrides(C,
this._primitiveOverrides,[]);var H=C.geometry;if("x"in H&&"y"in H){H=C.symbol;var I=f.fromCIMFontDecoration(H),K=f.fromCIMFontStyle(H.fontStyleName),L=n.getFontFamily(H.fontFamilyName);H.font={family:L,decoration:I,...K};var R=f.getNumericValue(H.height,b.defaultCIMValues.CIMTextSymbol.height),S=f.getNumericValue(H.angle),W=f.getNumericValue(H.offsetX),J=f.getNumericValue(H.offsetY),{haloSymbol:O}=H,T=f.getNumericValue(H.haloSize,0),X=[0,0,0,0];if(O?.symbolLayers?.length){O=O.symbolLayers;for(var U of O)if(U.color){X=
this._getValueOrOverrideExpression(H?.haloSymbol?.type??"CIMPolygonSymbol",U.primitiveName,"Color",f.normalizeAlpha(U.color));break}}var N=C.primitiveName,Q=[0,0,0,1];U=[0,0,0,0];O=0;var P=!1;if(H.symbol?.symbolLayers)for(var V of H.symbol.symbolLayers){var Z=V.primitiveName;if("CIMSolidStroke"===V.type)U=this._getValueOrOverrideExpression("CIMSolidStroke",Z,"Color",f.normalizeAlpha(V.color)),O=this._getValueOrOverrideExpression("CIMSolidStroke",Z,"Width",f.getStrokeWidth(V)??0);else if("CIMSolidFill"===
V.type){var ba=f.normalizeAlpha(V.color);P=P??!!V.colorLocked;Q=this._getValueOrOverrideExpression("CIMSolidFill",Z??N,"Color",ba)}}var aa=ba=Z=V=null,ca=null;N&&(V=this._maybeGetValueOrOverrideExpression(N,"TextSize"),Z=this._maybeGetValueOrOverrideExpression(N,"TextAngle"),ba=this._maybeGetValueOrOverrideExpression(N,"TextOffsetX"),aa=this._maybeGetValueOrOverrideExpression(N,"TextOffsetY"),P||(ca=this._maybeGetValueOrOverrideExpression(N,"FillColor")));N=ca??Q;ca=Q=null;var ea=0;if(H.callout&&
"CIMBackgroundCallout"===H.callout.type){var fa=H.callout;if(fa.backgroundSymbol&&(fa=fa.backgroundSymbol.symbolLayers))for(var ha of fa)"CIMSolidFill"===ha.type?Q=f.normalizeAlpha(ha.color):"CIMSolidStroke"===ha.type&&(ca=f.normalizeAlpha(ha.color),ea=f.getNumericValue(ha.width,b.defaultCIMValues.CIMSolidStroke.width))}ha=this._getValueOrOverrideExpression(H.type,C.primitiveName,"TextString",C.textString??"");null!=ha&&({fontStyleName:fa}=H,L+=fa?"-"+fa.toLowerCase():"-regular",B=this._getMaterialOverrides(B,
H.type),B.push(...this._getPrimitiveMaterialOverrides(C.primitiveName,H.type)),this._cimLayers.push({type:"text",lineWidth:H.lineWidth,textRasterizationParam:{type:"text-rasterization-param",resource:{type:"text",textString:C.textString??"",font:H.font,symbol:H,primitiveName:C.primitiveName},overrides:B},colorLocked:!!G||!!P,effects:v,alignment:E,anchorPoint:{x:0,y:0},isAbsoluteAnchorPoint:!1,fontName:L,decoration:I,haloSize:T,haloColor:X,weight:K.weight,style:K.style,size:V??R,angle:Z??S,offsetX:ba??
W,offsetY:aa??J,transform:{type:"cim-marker-transform-param",params:F},horizontalAlignment:f.fromCIMHorizontalAlignment(H.horizontalAlignment),verticalAlignment:f.fromCIMVerticalAlignment(H.verticalAlignment),text:ha,color:N,outlineColor:U,outlineSize:O,backgroundColor:Q,borderLineColor:ca,borderLineWidth:ea,referenceSize:D,sizeRatio:1,markerPlacement:x}))}}_analyzeMultiLayerGraphicNonSDF(v,x,C,B,E,D,F,G,H,I,K,L){var R={type:v.type,enable:!0,name:v.name,colorLocked:v.colorLocked,primitiveName:v.primitiveName,
anchorPoint:v.anchorPoint,anchorPointUnits:v.anchorPointUnits,offsetX:0,offsetY:0,rotateClockwise:v.rotateClockwise,rotation:0,size:v.size,billboardMode3D:v.billboardMode3D,depth3D:v.depth3D,frame:v.frame,markerGraphics:[B],scaleSymbolsProportionally:v.scaleSymbolsProportionally,respectFrame:v.respectFrame,clippingPath:v.clippingPath};B=v.primitiveName;var S=this._analyzeMaterialOverrides(B,["Rotation","OffsetX","OffsetY"]);S=f.normalizePrimitiveOverrideProps(S);const [W,J,O]=a.CIMSymbolHelper.getTextureAnchor(R,
this._resourceManager);E=this._getMaterialOverrides(E,v.type);E.push(...S);E={type:"sprite-rasterization-param",resource:{...R,avoidSDFRasterization:!0},overrides:E};R=f.getNumericValue(v.size,b.defaultCIMValues.CIMVectorMarker.size);B=this._getValueOrOverrideExpression(v.type,B,"Size",R);this._cimLayers.push({type:"marker",spriteRasterizationParam:E,colorLocked:K,effects:x,scaleSymbolsProportionally:!!v.scaleSymbolsProportionally,alignment:D,anchorPoint:{x:W,y:J},isAbsoluteAnchorPoint:!1,size:I,
rotation:0,offsetX:0,offsetY:0,transform:{type:"cim-marker-transform-param",params:G},color:[255,255,255,1],outlineColor:[0,0,0,0],outlineWidth:0,scaleX:1,frameHeight:I,widthRatio:1,rotateClockwise:!!v.rotateClockwise,referenceSize:F,sizeRatio:O/h.pt2px(v.size),isOutline:L,markerPlacement:C,animationParams:y(H),baseSize:B})}_createMarkerPlacementOverrideExpression(v){if(!v)return null;const x=[];e.OverrideHelper.findApplicableOverrides(v,this._primitiveOverrides,x);return{type:"cim-marker-placement-param",
placement:v,overrides:u(x)}}_createGIFAnimatedSymbolPropertiesOverrideExpression(v){if(!v)return null;const x=[];e.OverrideHelper.findApplicableOverrides(v,this._primitiveOverrides,x);return{type:"cim-gif-animation-params",animation:v,overrides:u(x)}}_analyzeCompositeMarkerGraphic(v,x,C,B,E,D,F,G,H,I,K){const L=B.geometry;var R=E[0],S=E[1],W=r.getExtent(L);if(W){E="Relative"!==v.anchorPointUnits;var J=f.getNumericValue(R.width,b.defaultCIMValues.CIMSolidStroke.width),{frameSizeRatio:O,anchorX:T,anchorY:X,
widthRatio:U,sdfPaddingRatio:N}=r.getSDFMetrics(W,v.frame,v.size,v.anchorPoint,E,J,v.scaleSymbolsProportionally);({path:W}=S);var Q=S.primitiveName,P=R.primitiveName;B=B.primitiveName;var V=null;S.colorLocked||I||(V=this._maybeGetValueOrOverrideExpression(B,"FillColor"));S=V??this._getValueOrOverrideExpression(S.type,Q,"Color",f.normalizeAlpha(S.color));Q=null;R.colorLocked||I||(Q=this._maybeGetValueOrOverrideExpression(B,"StrokeColor"));Q=Q??this._getValueOrOverrideExpression(R.type,P,"Color",f.normalizeAlpha(R.color));
R=this._maybeGetValueOrOverrideExpression(B,"StrokeWidth")??this._getValueOrOverrideExpression(R.type,P,"Width",J);this._cimLayers.push({type:"marker",spriteRasterizationParam:{type:"sprite-rasterization-param",resource:W?{type:"path",path:W,asFill:!0}:{type:"sdf",geom:L,sdfPaddingRatio:N,asFill:!0},overrides:[]},colorLocked:I,effects:x,scaleSymbolsProportionally:!!v.scaleSymbolsProportionally,alignment:D,anchorPoint:{x:T,y:X},isAbsoluteAnchorPoint:E,size:H,rotation:0,offsetX:0,offsetY:0,scaleX:1,
transform:{type:"cim-marker-transform-param",params:G},frameHeight:H,widthRatio:U,rotateClockwise:!1,referenceSize:F,sizeRatio:O,color:S,outlineColor:Q,outlineWidth:R,isOutline:K,markerPlacement:C})}}_setPoMap(v,x,C){let B;this._poMap[v]?B=this._poMap[v]:(B={},this._poMap[v]=B);B[x]=C}_maybeGetValueOrOverrideExpression(v,x,C){return this._getValueOrOverrideExpression("",v,x,C,!1)}_getValueOrOverrideExpression(v,x,C,B,E=!0){E&&!f.isValidCIMValue(B)&&(B=f.getDefaultCIMValue(v,C.toLowerCase()));if(null==
x)return B;v=this._poMap[x];if(null==v)return B;C=v[C];return"string"===typeof C||"number"===typeof C||Array.isArray(C)?C:C?{valueExpressionInfo:C,defaultValue:B}:B}_analyzePrimitiveOverrides(v,x,C,B){if(null==v)return!1;"string"===typeof v&&(v=[v]);for(const E of this._primitiveOverrides)if(v.includes(E.primitiveName)&&E.valueExpressionInfo)return!0;if(null!=x)for(const E of x)if(0<E?.overrides.length)return!0;if(null!=C)for(const E of C)if(0<E?.overrides.length)return!0;if(null!=B)for(const E of B)if(0<
E?.overrides.length)return!0;return!1}_getMaterialOverrides(v,x){if(!v)return[];const C=[];for(const B of v)C.push(...this._getPrimitiveMaterialOverrides(B,x));return C}_getPrimitiveMaterialOverrides(v,x){if(!v)return[];const C=f.normalizePrimitiveOverrideProps(this._primitiveOverrides.filter(B=>B.primitiveName===v));C.forEach(B=>B.defaultValue=f.getDefaultCIMValue(x,B.propertyName.toLowerCase()));return C}_analyzeMaterialOverrides(v,x){return this._primitiveOverrides.filter(C=>C.primitiveName!==
v||!x.includes(C.propertyName))}}l.CIMAnalyzer=A;l.analyzeCIMResource=function(v,x){if(!x||0===x.length)return v;v=d.clone(v);e.OverrideHelper.applyOverrides(v,x);return v};Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/core/fontUtils":function(){define(["exports","../config"],function(l,q){function n(k){if(!k)return"arial-unicode-ms";k=k.toLowerCase().split(" ").join("-");switch(k){case "serif":return"noto-serif";case "sans-serif":return"arial-unicode-ms";case "monospace":return"ubuntu-mono";
case "fantasy":return"cabin-sketch";case "cursive":return"redressed";default:return k}}function d(k){const e=h(k)+g(k);return n(k.family)+(0<e.length?e:"-regular")}function m(k){const e=h(k)+g(k);return(k.family||"arial-unicode-ms")+(0<e.length?e:"-regular")}function h(k){if(!k.weight)return"";switch(k.weight.toLowerCase()){case "bold":case "bolder":return"-bold"}return""}function g(k){if(!k.style)return"";switch(k.style.toLowerCase()){case "italic":case "oblique":return"-italic"}return""}const c=
new Map,a=new Set;class b{constructor(k,e){this.fontFace=k;this.promise=e}}l.clearFonts=function(){const k=document.fonts;c.forEach(e=>{k.delete(e.fontFace)});c.clear();a.clear()};l.defaultFontFamily="arial-unicode-ms";l.getFontFamily=n;l.getFullyQualifiedFontName=d;l.isCachedFontFace=function(k){return a.has(k)};l.loadFont=async function(k){const e=m(k),r=d(k),f=c.get(e);if(f)return f.promise;const p=new FontFace(k.family,`url('${q.fontsUrl}/woff2/${r}.${"woff2"}') format('${"woff2"}')`,{style:k.style,
weight:k.weight}),t=document.fonts;if(t.has(p)&&"loading"===p.status)return p.loaded;k=p.load().then(()=>{t.add(p);return p});c.set(e,new b(p,k));a.add(p);return k};Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/animationUtils":function(){define("exports ../../core/Logger ./animationDebugFlags ./defaultCIMValues ./enums ./SDFHelper ./utils ../../views/2d/engine/webgl/animations/instructions".split(" "),function(l,q,n,d,m,h,g,c){function a(A,v){let x=0,C=0;const B=
"Absolute"!==A.anchorPointUnits;A.anchorPoint&&(x=-A.anchorPoint.x,C=-A.anchorPoint.y);return{...v,transform:{type:"AnimatedTransform",relativeTranslation:B,absoluteScale:!1,translation:u([x,C]),rotation:u(0),scale:u(1),parent:v.transform}}}function b(A,v){switch(v.type){case "CIMSolidStroke":case "CIMSolidFill":return g.getProcessParam(A,v,"Color");case "CIMPictureMarker":case "CIMPictureStroke":case "CIMPictureFill":return g.getProcessParam(A,v,"TintColor")}return[1,1,1,1]}function k(A,v,x){var {animations:C}=
v;v=b(A,v);(C=C?.filter(B=>"CIMSymbolAnimationColor"===B.type)[0])&&(v=g.getProcessParam(A,C,"ToColor"));return{type:"AnimatedColor",color:u(v),opacity:u(1),parent:x}}function e(A,v,x){({animations:v}=v);return(v=v?.filter(C=>"CIMSymbolAnimationColor"===C.type)[0])?{type:"AnimatedColor",color:u([1,1,1,1]),opacity:{from:0,to:1,timing:p(A,v?.animatedSymbolProperties)},parent:[1,1,1,1]}:x}function r(A,v,x){var {animations:C}=v;v=u(1);if(C=C?.filter(B=>"CIMSymbolAnimationTransparency"===B.type)[0])A=
g.getProcessParam(A,C,"ToTransparency"),v=u({type:"Process",op:"Transparency",value:A});return{type:"AnimatedColor",color:u([1,1,1,1]),opacity:v,parent:x}}function f(A,v,x){({animations:v}=v);return(v=v?.filter(C=>"CIMSymbolAnimationTransparency"===C.type)[0])?{type:"AnimatedColor",color:u([1,1,1,1]),opacity:{from:0,to:1,timing:p(A,v?.animatedSymbolProperties)},parent:[1,1,1,1]}:x}function p(A,v){if(!v)return{duration:1,startTimeOffset:0,repeatDelay:0,timeOriginSelector:c.TimeOrigin.Local,repeatType:m.AnimatedSymbolRepeatType.Loop,
easing:m.AnimatedSymbolEasingType.Linear,playAnimation:1,reverseAnimation:0};const x=g.getProcessParam(A,v,"Duration");if(g.getProcessParam(A,v,"RandomizeStartTime")){var C=g.getProcessParam(A,v,"RandomizeStartSeed");C={type:"Process",op:"Random",min:0,max:x,seed:C}}else C=g.getProcessParam(A,v,"StartTimeOffset");const B=g.getProcessParam(A,v,"RepeatDelay"),E=g.getProcessParam(A,v,"PlayAnimation");A=g.getProcessParam(A,v,"ReverseAnimation");const D=g.getValue(v.repeatType,d.defaultCIMValues.CIMAnimatedSymbolProperties.repeattype),
F=D===m.AnimatedSymbolRepeatType.None?c.TimeOrigin.Local:c.TimeOrigin.Global;v=g.getValue(v.easing,d.defaultCIMValues.CIMAnimatedSymbolProperties.easing);return{duration:x,startTimeOffset:C,repeatDelay:B,timeOriginSelector:F,repeatType:D,easing:v,playAnimation:E,reverseAnimation:A}}function t(A,v){var {animations:x}=v;if("CIMPictureMarker"!==v.type&&"CIMVectorMarker"!==v.type&&"CIMPointSymbol"!==v.type)return u(1);v="CIMPictureMarker"===v.type||"CIMVectorMarker"===v.type?g.getProcessParam(A,v,"Size"):
g.getSize(v)||10;const C=x?.filter(B=>"CIMSymbolAnimationScale"===B.type)[0];return C?{from:1,to:g.getProcessParam(A,C,"ScaleFactor"),timing:p(A,C.animatedSymbolProperties)}:(x=x?.filter(B=>"CIMSymbolAnimationSize"===B.type)[0])?{from:1,to:{type:"Process",op:"Divide",left:g.getProcessParam(A,x,"ToSize"),right:v},timing:p(A,x.animatedSymbolProperties)}:u(1)}function w(A,v){({animations:v}=v);v=v?.filter(B=>"CIMSymbolAnimationOffset"===B.type)[0];if(!v)return u([0,0]);const x=g.getProcessParam(A,v,
"OffsetX"),C=g.getProcessParam(A,v,"OffsetY");return{from:[0,0],to:[x,C],timing:p(A,v.animatedSymbolProperties)}}function z(A,v){var {animations:x}=v;a:{switch(v.type){case "CIMPictureMarker":case "CIMVectorMarker":v=g.getProcessParam(A,v,"Rotation");break a}v=0}x=x?.filter(B=>"CIMSymbolAnimationRotation"===B.type)[0];if(!x)return u(v);const C=g.getProcessParam(A,x,"ToRotation");return{from:v,to:C,timing:p(A,x.animatedSymbolProperties)}}function u(A){return{from:A,to:A,timing:{duration:1,startTimeOffset:0,
repeatDelay:0,timeOriginSelector:c.TimeOrigin.Local,repeatType:m.AnimatedSymbolRepeatType.Loop,easing:m.AnimatedSymbolEasingType.Linear,playAnimation:1,reverseAnimation:0}}}function y(A){if(null==A||"object"!==typeof A)return!1;if(A.animations&&Array.isArray(A.animations)&&0<A.animations.length)return!0;for(const v in A)if(y(A[v]))return!0;return!1}l.checkForAnimations=y;l.getAnimationParams=function(A,v,x){var C=x.transform;var B=w(A,v),E=z(A,v),D=t(A,v);C={type:"AnimatedTransform",relativeTranslation:!1,
absoluteScale:!1,translation:B,rotation:E,scale:D,parent:C};B=x.fromColor;E=u(b(A,v));D=u(1);B={type:"AnimatedColor",color:E,opacity:D,parent:B};E=k(A,v,x.toColor);D=e(A,v,x.colorMix);const F=r(A,v,x.toOpacity);A=f(A,v,x.opacityMix);return{transform:C,fromColor:B,toColor:E,colorMix:D,toOpacity:F,opacityMix:A,hasAnimations:x.hasAnimations||!!v.animations&&0<v.animations.length}};l.getFrameTranslation=function(A,v){const x=v?.5*-(v.xmin+v.xmax):0;v=v?.5*-(v.ymin+v.ymax):0;let C=0;var B=0;if("x"in A&&
"y"in A)C=A.x+x,B=A.y+v;else if(A=h.getExtent(A))B=(A[1]+A[3])/2,C=(A[0]+A[2])/2+x,B+=v;return[C,B]};l.getStaticParam=u;l.handleAbsoluteAnchor=function(A,v){return"Absolute"!==A.anchorPointUnits?v:a(A,v)};l.handleAnchor=a;l.handleMarker=function(A,v,x){if("CIMCharacterMarker"===v.type)return q.getLogger("animationUtils").error("#handleMarker()","CIM character markers do not support animations"),x;const C=g.getProcessParam(A,v,"OffsetX"),B=g.getProcessParam(A,v,"OffsetY");if("CIMPictureMarker"===v.type)return{...x,
transform:{type:"AnimatedTransform",relativeTranslation:!1,absoluteScale:!0,translation:u([C,B]),rotation:u(0),scale:u(g.getProcessParam(A,v,"Size")),parent:x.transform}};var E=v.frame;E=E.ymax-E.ymin;return{...x,transform:{type:"AnimatedTransform",relativeTranslation:!1,absoluteScale:!1,translation:u([C,B]),rotation:u(0),scale:u({type:"Process",op:"Divide",left:g.getProcessParam(A,v,"Size"),right:E}),parent:x.transform}}};l.handleRelativeAnchor=function(A,v){return"Absolute"===A.anchorPointUnits?
v:a(A,v)};l.shouldUseAnimatedPath=function(A){return n.animationDebugFlags.forceStaticPath?!1:n.animationDebugFlags.forceAnimatedPath||A.hasAnimations};l.translate=function(A,v,x){return{...A,transform:{type:"AnimatedTransform",relativeTranslation:!1,absoluteScale:!1,translation:u([v,x]),rotation:u(0),scale:u(1),parent:A.transform}}};Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/animationDebugFlags":function(){define(["exports","../../core/has"],function(l,q){class n{get forceStaticPath(){return"disabled"===
q("esri-cim-animations-enable-status")}get forceAnimatedPath(){return"forced"===q("esri-cim-animations-enable-status")}get freezeGlobalTime(){const m=q("esri-cim-animations-freeze-time");return null==m?!1:m}get spotlightAnimatedSymbols(){return!!q("esri-cim-animations-spotlight")}get forceGlobalTimeOrigin(){return!1!==q("esri-cim-animations-freeze-time")}}const d=new n;l.animationDebugFlags=d;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/SDFHelper":function(){define(["exports",
"../../core/floatRGBA","../../geometry/support/jsonUtils","./Rect","../../views/2d/engine/webgl/definitions"],function(l,q,n,d,m){function h(a,b=.5){switch(a.type){case "CIMPointSymbol":b=a.symbolLayers;if(!b||1!==b.length)return null;b=b[0];return"CIMVectorMarker"!==b.type?null:h(b);case "CIMVectorMarker":a=a.markerGraphics;if(!a||1!==a.length)return null;var k=a[0];if(!k)return null;a=k.geometry;if(!a)return null;k=k.symbol;return!k||"CIMPolygonSymbol"!==k.type&&"CIMLineSymbol"!==k.type||k.symbolLayers?.some(e=>
!!e.effects)?null:{type:"sdf",geom:a,sdfPaddingRatio:b,asFill:"CIMPolygonSymbol"===k.type}}}function g(a){let b=Infinity,k=-Infinity,e=Infinity,r=-Infinity;for(const f of a)for(const p of f)p[0]<b&&(b=p[0]),p[0]>k&&(k=p[0]),p[1]<e&&(e=p[1]),p[1]>r&&(r=p[1]);return[b,e,k,r]}function c(a){return a?a.rings?g(a.rings):a.paths?g(a.paths):n.isExtent(a)?[a.xmin,a.ymin,a.xmax,a.ymax]:null:null}l.buildSDF=function(a){var b=a.geom;var k=b?b.rings?b.rings:b.paths?b.paths:void 0!==b.xmin&&void 0!==b.ymin&&void 0!==
b.xmax&&void 0!==b.ymax?[[[b.xmin,b.ymin],[b.xmin,b.ymax],[b.xmax,b.ymax],[b.xmax,b.ymin],[b.xmin,b.ymin]]]:null:null;b=Infinity;var e=-Infinity,r=Infinity;var f=-Infinity;for(var p of k)for(var t of p)t[0]<b&&(b=t[0]),t[0]>e&&(e=t[0]),t[1]<r&&(r=t[1]),t[1]>f&&(f=t[1]);f=new d(b,r,e-b,f-r);t=m.defaultSdfTextureSize;b=m.spritePadding;p=Math.floor(.5*(t*a.sdfPaddingRatio-b));t-=2*(p+b);var w=t/Math.max(f.width,f.height);b=Math.round(f.width*w)+2*p;e=Math.round(f.height*w)+2*p;r=[];for(var z of k)if(z&&
1<z.length){k=[];for(var u of z){let [I,K]=u;I-=f.x;K-=f.y;I*=w;K*=w;I+=p-.5;K+=p-.5;a.asFill?k.push([I,K]):k.push([Math.round(I),Math.round(K)])}if(a.asFill){var y=k.length-1;k[0][0]===k[y][0]&&k[0][1]===k[y][1]||k.push(k[0])}r.push(k)}u=b*e;z=Array(u);k=p*p+1;for(f=0;f<u;++f)z[f]=k;for(var A of r)for(k=A.length,f=1;f<k;++f){w=A[f-1];y=A[f];var v=void 0,x=void 0;w[0]<y[0]?(v=w[0],x=y[0]):(v=y[0],x=w[0]);var C=void 0,B=void 0;w[1]<y[1]?(C=w[1],B=y[1]):(C=y[1],B=w[1]);var E=Math.floor(v)-p;x=Math.floor(x)+
p;C=Math.floor(C)-p;B=Math.floor(B)+p;0>E&&(E=0);x>b&&(x=b);0>C&&(C=0);B>e&&(B=e);v=y[0]-w[0];const I=y[1]-w[1],K=v*v+I*I;for(;E<x;E++)for(let L=C;L<B;L++){var D=E+.5,F=L+.5,G=(D-w[0])*v+(F-w[1])*I;let R;0>G?(R=w[0],G=w[1]):G>K?(R=y[0],G=y[1]):(G/=K,R=w[0]+G*v,G=w[1]+G*I);D=(D-R)*(D-R)+(F-G)*(F-G);F=(e-L-1)*b+E;D<z[F]&&(z[F]=D)}}for(A=0;A<u;++A)z[A]=Math.sqrt(z[A]);if(a.asFill)for(var H of r)for(A=H.length,r=1;r<A;++r)for(u=H[r-1],k=H[r],u[0]<k[0]?(f=u[0],w=k[0]):(f=k[0],w=u[0]),u[1]<k[1]?(x=u[1],
y=k[1]):(x=k[1],y=u[1]),f=Math.floor(f),w=Math.floor(w)+1,x=Math.floor(x),y=Math.floor(y)+1,f<p&&(f=p),w>b-p&&(w=b-p),x<p&&(x=p),y>e-p&&(y=e-p);x<y;++x)if(u[1]>x!==k[1]>x){B=x+.5;C=(e-x-1)*b;for(v=f;v<w;++v)v+.5<(k[0]-u[0])*(B-u[1])/(k[1]-u[1])+u[0]&&(z[C+v]=-z[C+v]);for(B=p;B<f;++B)z[C+B]=-z[C+B]}H=2*p;A=z.length;r=new Uint8Array(4*A);for(u=0;u<A;++u)q.packFloatRGBA(.5-z[u]/H,r,4*u);return{data:r,width:b,height:e,sdfPaddingRatio:a.sdfPaddingRatio,sdfDecodeCoeff:2*p/t}};l.getExtent=c;l.getSDFDimensions=
function(a,b){const [k,e,r,f]=c(a);a=r-k;const p=f-e;var t=m.defaultSdfTextureSize;const w=m.spritePadding;b=Math.floor(.5*(t*b-w));t=(t-2*(b+w))/Math.max(a,p);return{pixelDimensions:[a,p],texelDimensions:[Math.round((Math.round(a*t)+2*b)/t),Math.round((Math.round(p*t)+2*b)/t)]}};l.getSDFInfo=h;l.getSDFMetrics=function(a,b,k,e,r,f,p){const [t,w,z,u]=a;if(z<t||u<w)return{frameSizeRatio:0,anchorX:0,anchorY:0,widthRatio:1,sdfPaddingRatio:.5};var y=z-t,A=u-w,v=Math.max(y,A);a=.5;null!=f&&null!=k&&(p||
null==b||(f*=(b.ymax-b.ymin)/k),f/=f+v,.45<f&&1>f&&(a=Math.min(f+.1,.99)));p=m.defaultSdfTextureSize;var x=m.spritePadding;f=Math.floor(.5*(p*a-x));v=(p-2*(f+x))/v;p=Math.round(y*v);x=Math.round(A*v)+2*f;A=1;b&&(A=x*(1-a)/((b.ymax-b.ymin)*v));let C=0,B=0;y=1;e&&(r?b&&k&&0<b.ymax-b.ymin&&(y=(b.xmax-b.xmin)/(b.ymax-b.ymin),C=e.x/(k*y),B=e.y/k):(C=e.x,B=e.y));b&&(C=.5*(b.xmax+b.xmin)+C*(b.xmax-b.xmin),B=.5*(b.ymax+b.ymin)+B*(b.ymax-b.ymin));C=(C-t)*v+f;B=(B-w)*v+f;b=C/(p+2*f)-.5;e=B/x-.5;r&&k&&(b*=k*
y,e*=k);return{frameSizeRatio:A,anchorX:b,anchorY:e,widthRatio:y,sdfPaddingRatio:a}};Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/core/floatRGBA":function(){define(["exports","./mathUtils"],function(l,q){function n(g,c=0){let a=0;for(let b=0;4>b;b++)a+=g[c+b]*m[b];return a}const d=[1,256,65536,16777216],m=[1/256,1/65536,1/16777216,1/4294967296],h=n(new Uint8ClampedArray([255,255,255,255]));l.packFloatRGBA=function(g,c,a=0){g=q.clamp(g,0,h);for(let e=0;4>e;e++){var b=Math,
k=g*d[e];c[a+e]=b.floor.call(b,256*(k-Math.floor(k)))}};l.unpackFloatRGBA=n;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/Rect":function(){define(function(){class l{constructor(q=0,n=0,d=0,m=0){this.x=q;this.y=n;this.width=d;this.height=m}static fromExtent(q){return new l(q.xmin,-q.ymax,q.xmax-q.xmin,q.ymax-q.ymin)}get isEmpty(){return 0>=this.width||0>=this.height}union(q){this.x=Math.min(this.x,q.x);this.y=Math.min(this.y,q.y);this.width=Math.max(this.width,q.width);
this.height=Math.max(this.height,q.height)}}return l})},"esri/views/2d/engine/webgl/animations/instructions":function(){define(["exports"],function(l){function q(w){return[`float duration = clamp(${w.duration}, 0.05, 3600.0);`,`float startTimeOffset = ${w.startTimeOffset};`,`float repeatDelay = ${w.repeatDelay};`,`float timeOriginSelector = ${w.timeOriginSelector};`,`float repeatType = ${w.repeatType};`,`float easing = ${w.easing};`,`float playAnimation = ${w.playAnimation} * (1.0 - step(0.0, -${w.duration}));`,
`float reverseAnimation = ${w.reverseAnimation};`,"float time \x3d globalTime - (timeOriginSelector \x3d\x3d 1.0 ? localTimeOrigin : 0.0);","time *\x3d playAnimation;","time *\x3d 1.0 - reverseAnimation * 2.0;","float period \x3d duration + repeatDelay;","time +\x3d reverseAnimation \x3d\x3d 1.0 ? (period - startTimeOffset - 0.001) : startTimeOffset + 0.001;","float omega \x3d time / period;","float oi \x3d floor(omega);","omega \x3d repeatType \x3d\x3d 1.0 || repeatType \x3d\x3d 3.0 ? omega - oi : omega;",
"float of \x3d omega * period;","of \x3d (clamp(of, reverseAnimation * repeatDelay, period - (1.0 - reverseAnimation) * repeatDelay) - reverseAnimation * repeatDelay) / duration;","of \x3d easing \x3d\x3d 2.0 ? pow(of, 3.0) : of;","of \x3d easing \x3d\x3d 3.0 ? 1.0 - pow(1.0 - of, 3.0) : of;","of \x3d easing \x3d\x3d 4.0 ? of \x3c 0.5 ? 4.0 * pow(of, 3.0) : 1.0 - pow(-2.0 * of + 2.0, 3.0) / 2.0 : of;","bool oscillate \x3d repeatType \x3d\x3d 3.0 \x26\x26 mod(oi, 2.0) \x3d\x3d 1.0;",`${w.out} = oscillate ? 1.0 - of : of;`]}
function n(w){return[[w.duration,w.startTimeOffset,w.repeatDelay,r[w.timeOriginSelector]],[e[w.repeatType],k[w.easing],w.playAnimation,w.reverseAnimation]]}function d(w){const z=[];z.push(`float globalTime = ${w.globalTime};`);z.push(`float localTimeOrigin = ${w.localTimeOrigin};`);z.push(`vec2 pointer = ${w.animationPointer};`);z.push(`vec2 size = ${w.animationTextureSize};`);z.push("int top \x3d 0;");z.push("vec4 stack[4];");z.push("for (int counter \x3d 0; counter \x3c 40; counter++) {");z.push(`vec4 atom0 = texture(${w.animationTexture}, (pointer + 0.5) / size);`);
z.push("pointer.x +\x3d 1.0;");z.push(`vec2 pixelDimensions = ${w.pixelDimensions};`);z.push("if (false) {");for(const u in t){const y=t[u];z.push(`} else if (int(atom0.x) == ${y.opcode}) {`);for(const A of y.generateSource(w))z.push(A)}z.push("} // End if-else.");z.push("} // End for.");z.push(`${w.out} = top > 0 ? stack[top - 1] : vec4(0.0);`);return z.join("\n")}l.TimeOrigin=void 0;(function(w){w.Local="Local";w.Global="Global"})(l.TimeOrigin||(l.TimeOrigin={}));class m{generateSource(w){const z=
[];for(let y=1;y<this.length;y++)z.push(`vec4 atom${y} = texture(${w.animationTexture}, (pointer + 0.5) / size);`),z.push("pointer.x +\x3d 1.0;");for(w=0;w<this.ins;w++)z.push("top--;"),z.push(`vec4 in${this.ins-w-1} = stack[top];`);for(w=0;w<this.outs;w++)z.push(`vec4 out${w};`);({microcode:w}=this);for(var u of w)z.push(u);for(u=0;u<this.outs;u++)z.push(`stack[top] = out${u};`),z.push("top++;"),z.push("if (top \x3e\x3d 4) { top \x3d 3; }");return z}}let h=128;class g extends m{constructor(){super(...arguments);
this.opcode=++h;this.length=1;this.outs=this.ins=0;this.microcode=["break;"]}encode(){return[[this.opcode,0,0,0]]}}class c extends m{constructor(){super(...arguments);this.opcode=++h;this.length=1;this.ins=0;this.outs=1;this.microcode=["out0 \x3d vec4(atom0.y, atom0.y, atom0.y, atom0.y);"]}encode(w){return[[this.opcode,w,0,0]]}}class a extends m{constructor(){super(...arguments);this.opcode=++h;this.length=1;this.ins=0;this.outs=1;this.microcode=["out0 \x3d vec4(atom0.yzw, 0.0);"]}encode(w){return[[this.opcode,
w[0]||0,w[1]||0,w[2]||0]]}}class b extends m{constructor(){super(...arguments);this.opcode=++h;this.length=2;this.ins=0;this.outs=1;this.microcode=["out0 \x3d atom1;"]}encode(w){return[[this.opcode,0,0,0],w]}}const k={Linear:1,EaseIn:2,EaseOut:3,EaseInOut:4},e={Loop:1,None:2,Oscillate:3},r={Local:1,Global:2};class f extends m{constructor(){super(...arguments);this.opcode=++h;this.length=10;this.outs=this.ins=1;this.microcode=["vec2 fromTranslation \x3d atom1.xy;","vec2 toTranslation \x3d atom1.zw;",
"float fromRotation \x3d atom2.x;","float toRotation \x3d atom2.y;","float fromScale \x3d atom2.z;","float toScale \x3d atom2.w;","bool relativeTranslation \x3d atom9.x \x3d\x3d 1.0;","bool absoluteScale \x3d atom9.y \x3d\x3d 1.0;","vec2 translationMultiplier \x3d relativeTranslation ? pixelDimensions : vec2(1.0, 1.0);","float scaleDivisor \x3d absoluteScale ? pixelDimensions.y : 1.0;","float fTranslation;","{",...q({duration:"atom3.x",startTimeOffset:"atom3.y",repeatDelay:"atom3.z",timeOriginSelector:"atom3.w",
repeatType:"atom4.x",easing:"atom4.y",playAnimation:"atom4.z",reverseAnimation:"atom4.w",out:"fTranslation"}),"}","float fRotation;","{",...q({duration:"atom5.x",startTimeOffset:"atom5.y",repeatDelay:"atom5.z",timeOriginSelector:"atom5.w",repeatType:"atom6.x",easing:"atom6.y",playAnimation:"atom6.z",reverseAnimation:"atom6.w",out:"fRotation"}),"}","float fScale;","{",...q({duration:"atom7.x",startTimeOffset:"atom7.y",repeatDelay:"atom7.z",timeOriginSelector:"atom7.w",repeatType:"atom8.x",easing:"atom8.y",
playAnimation:"atom8.z",reverseAnimation:"atom8.w",out:"fScale"}),"}","vec2 aTranslation \x3d mix(fromTranslation, toTranslation, fTranslation);","float aRotation \x3d mix(fromRotation, toRotation, fRotation);","float aScale \x3d mix(fromScale, toScale, fScale);","vec2 pTranslation \x3d in0.xy;","float pRotation \x3d in0.z;","float pScale \x3d in0.w;","aTranslation *\x3d translationMultiplier;","aScale /\x3d scaleDivisor;","float rotation \x3d pRotation + aRotation;","float scale \x3d pScale * aScale;",
"float sin1 \x3d sin(pRotation);","float cos1 \x3d cos(pRotation);","float s1 \x3d pScale;","float x1 \x3d pTranslation.x;","float y1 \x3d pTranslation.y;","float x2 \x3d aTranslation.x;","float y2 \x3d aTranslation.y;","\n    vec2 translation \x3d vec2(\n      cos1 * s1 * x2 - sin1 * s1 * y2 + x1,\n      sin1 * s1 * x2 + cos1 * s1 * y2 + y1\n    );\n    ","out0 \x3d vec4(translation, rotation, scale);"]}encode(w){return[[this.opcode,0,0,0],[w.translation.from[0],w.translation.from[1],w.translation.to[0],
w.translation.to[1]],[w.rotation.from,w.rotation.to,w.scale.from,w.scale.to],...n(w.translation.timing),...n(w.rotation.timing),...n(w.scale.timing),[w.relativeTranslation?1:0,w.absoluteScale?1:0,0,0]]}}class p extends m{constructor(){super(...arguments);this.opcode=++h;this.length=7;this.outs=this.ins=1;this.microcode=["float fromOpacity \x3d atom0.y;","float toOpacity \x3d atom0.z;","vec4 fromColor \x3d atom1;","vec4 toColor \x3d atom2;","float fColor;","{",...q({duration:"atom3.x",startTimeOffset:"atom3.y",
repeatDelay:"atom3.z",timeOriginSelector:"atom3.w",repeatType:"atom4.x",easing:"atom4.y",playAnimation:"atom4.z",reverseAnimation:"atom4.w",out:"fColor"}),"}","float fOpacity;","{",...q({duration:"atom5.x",startTimeOffset:"atom5.y",repeatDelay:"atom5.z",timeOriginSelector:"atom5.w",repeatType:"atom6.x",easing:"atom6.y",playAnimation:"atom6.z",reverseAnimation:"atom6.w",out:"fOpacity"}),"}","vec4 aColor \x3d mix(fromColor, toColor, fColor);","aColor.a *\x3d mix(fromOpacity, toOpacity, fOpacity);",
"vec4 pColor \x3d in0;","out0 \x3d aColor * pColor;"]}encode(w){return[[this.opcode,w.opacity.from,w.opacity.to,0],[w.color.from[0],w.color.from[1],w.color.from[2],w.color.from[3]],[w.color.to[0],w.color.to[1],w.color.to[2],w.color.to[3]],...n(w.color.timing),...n(w.opacity.timing)]}}const t={scalar:new c,vector3:new a,vector4:new b,animatedTransform:new f,animatedColor:new p,ret:new g};l.AAnimationInstruction=m;l.AnimatedColorInstruction=p;l.AnimatedTransformInstruction=f;l.RetInstruction=g;l.ScalarInstruction=
c;l.Vector3Instruction=a;l.Vector4Instruction=b;l.easingCodes=k;l.generateGetValueSource=function(w,z){return`\n    vec4 ${w}(int valueIndex) {\n      vec2 thePointer = ${z.animationPointer};\n      float jump = texture(${z.animationTexture}, (0.5 + vec2(thePointer.x + float(valueIndex), thePointer.y)) / ${z.animationTextureSize}).x;\n      thePointer = vec2(thePointer.x + jump, thePointer.y);\n      vec4 theResult;\n      ${d({...z,out:"theResult",animationPointer:"thePointer"})}\n      return theResult;\n    }\n  `};
l.generateVirtualMachineSource=d;l.getTweenFactor=q;l.instructions=t;l.repeatTypeCodes=e;l.timeOriginSelectorCodes=r;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/CIMSymbolHelper":function(){define("exports ../../core/BidiText ../../core/has ../../core/lang ../../core/Logger ../../core/RandomLCG ../../core/screenUtils ../../geometry/support/aaBoundingRect ../../geometry/support/boundsUtils ../Font ./CIMPlacements ./CIMSymbolDrawHelper ./defaultCIMValues ./enums ./utils ../support/defaults ../../views/2d/engine/vectorTiles/GeometryUtils ../../views/2d/engine/webgl/definitions ../../views/2d/engine/webgl/mesh/templates/shapingUtils ../../views/2d/layers/graphics/graphicsUtils".split(" "),
function(l,q,n,d,m,h,g,c,a,b,k,e,r,f,p,t,w,z,u,y){function A(N,Q,P){switch(Q.type){case "CIMSymbolReference":return A(N,Q.symbol,P);case "CIMPointSymbol":null==P&&(P={x:0,y:0});N.drawSymbol(Q,P);break;case "CIMLineSymbol":null==P&&(P={paths:[[[0,0],[10,0]]]});N.drawSymbol(Q,P);break;case "CIMPolygonSymbol":null==P&&(P={rings:[[[0,0],[0,10],[10,10],[10,0],[0,0]]]});N.drawSymbol(Q,P);break;case "CIMTextSymbol":N.drawSymbol(Q,{x:0,y:0});break;case "CIMVectorMarker":P=new k.Placement,N.drawMarker(Q,P)}return N.envelope()}
function v(N){if(!N)return 0;switch(N.type){case "CIMMarkerPlacementAlongLineSameSize":return Math.abs(N.offset);case "CIMMarkerPlacementAlongLineRandomSize":return Math.abs(N.offset);case "CIMMarkerPlacementAtExtremities":return Math.abs(N.offset);case "CIMMarkerPlacementAtMeasuredUnits":return Math.abs(N.offset);case "CIMMarkerPlacementAtRatioPositions":return Math.abs(N.offset);case "CIMMarkerPlacementInsidePolygon":return 0;case "CIMMarkerPlacementOnLine":return Math.abs(N.offset);case "CIMMarkerPlacementOnVertices":return Math.abs(N.offset);
case "CIMMarkerPlacementPolygonCenter":return 0;default:return 0}}function x(N){if(!N)return 0;switch(N.type){case "CIMGeometricEffectArrow":return Math.abs(.5*N.width);case "CIMGeometricEffectBuffer":return Math.abs(N.size);case "CIMGeometricEffectControlMeasureLine":return 500;case "CIMGeometricEffectExtension":return Math.abs(N.length);case "CIMGeometricEffectJog":return Math.abs(.5*N.length);case "CIMGeometricEffectMove":return Math.max(Math.abs(p.getNumericValue(N.offsetX)),Math.abs(p.getNumericValue(N.offsetY)));
case "CIMGeometricEffectOffset":return Math.abs(N.offset);case "CIMGeometricEffectOffsetTangent":return Math.abs(N.offset);case "CIMGeometricEffectRadial":return Math.abs(N.length);case "CIMGeometricEffectRegularPolygon":return Math.abs(N.radius);case "CIMGeometricEffectRotate":return 0;case "CIMGeometricEffectScale":return 0;case "CIMGeometricEffectTaperedPolygon":return.5*Math.max(Math.abs(N.fromWidth),Math.abs(N.toWidth));case "CIMGeometricEffectWave":return Math.abs(N.amplitude);case "CIMGeometricEffectDonut":return Math.abs(N.width);
default:return 0}}function C(N){if(!N)return 0;let Q=0;for(const P of N)Q+=x(P);return Q}function B(N,Q){if(N)switch(N.type){case "CIMPointSymbol":case "CIMLineSymbol":case "CIMPolygonSymbol":if(N=N.symbolLayers)for(const P of N)switch(Q(P),P.type){case "CIMVectorMarker":if(N=P.markerGraphics)for(const V of N)V&&(N=V.symbol)&&B(N,Q)}}}function E(N,Q,P){N.effects&&null==Q.geometryEngine&&(Q.geometryEnginePromise?P.push(Q.geometryEnginePromise):p.isGeometryEngineRequired(N.effects)&&(Q.geometryEnginePromise=
p.importGeometryEngine(),P.push(Q.geometryEnginePromise),Q.geometryEnginePromise.then(V=>Q.geometryEngine=V)))}function D(N){if(!N)return null;let Q=null;const {cap:P,color:V,join:Z,miterLimit:ba,style:aa,width:ca}=N;"solid"!==aa&&"none"!==aa&&"esriSLSSolid"!==aa&&"esriSLSNull"!==aa&&(Q=[{type:"CIMGeometricEffectDashes",dashTemplate:X(aa,P),lineDashEnding:"NoConstraint",scaleDash:!0,offsetAlongLine:null}]);return{type:"CIMSolidStroke",color:"esriSLSNull"!==aa&&"none"!==aa?T(V):[0,0,0,0],capStyle:S(P),
joinStyle:W(Z),miterLimit:ba,width:ca,effects:Q}}const F=Math.PI,G=F/2,H=Math.PI/180,I=96/72,K=()=>m.getLogger("esri.symbols.cim.CIMSymbolHelper");class L{static getSymbolInflateSize(N,Q,P,V,Z){N||=[0,0,0,0];return Q?this._getInflateSize(N,Q,P,V,Z):N}static safeSize(N){const Q=Math.max(Math.abs(N[0]),Math.abs(N[2]));N=Math.max(Math.abs(N[1]),Math.abs(N[3]));return Math.sqrt(Q*Q+N*N)}static _vectorMarkerBounds(N,Q,P,V){let Z=!0;const ba=c.create();if(Q?.markerGraphics)for(const aa of Q.markerGraphics)Q=
[0,0,0,0],aa.geometry&&(a.getBoundsXY(ba,aa.geometry),Q[0]=0,Q[1]=0,Q[2]=0,Q[3]=0,this.getSymbolInflateSize(Q,aa.symbol,P,0,V),ba[0]+=Q[0],ba[1]+=Q[1],ba[2]+=Q[2],ba[3]+=Q[3],Z?(N[0]=ba[0],N[1]=ba[1],N[2]=ba[2],N[3]=ba[3],Z=!1):(N[0]=Math.min(N[0],ba[0]),N[1]=Math.min(N[1],ba[1]),N[2]=Math.max(N[2],ba[2]),N[3]=Math.max(N[3],ba[3])));return N}static _getInflateSize(N,Q,P,V,Z){return void 0!==Q.symbolLayers?(N=this._getLayersInflateSize(N,Q.symbolLayers,P,V,Z),Q=C(Q.effects),0<Q&&(N[0]-=Q,N[1]-=Q,N[2]+=
Q,N[3]+=Q),N):this._getTextInflatedSize(N,Q,Z)}static _getLayersInflateSize(N,Q,P,V,Z){let ba=!0;if(!Q)return N;for(const ja of Q)if(ja){Q=[0,0,0,0];switch(ja.type){case "CIMSolidStroke":case "CIMPictureStroke":case "CIMGradientStroke":var aa=ja,ca=aa.width;null!=ca&&(ca=aa.capStyle===f.LineCapStyle.Square||aa.joinStyle===f.LineJoinStyle.Miter?ca/1.4142135623730951:ca/2,Q[0]=-ca,Q[1]=-ca,Q[2]=ca,Q[3]=ca);break;case "CIMCharacterMarker":case "CIMVectorMarker":case "CIMPictureMarker":aa=ja;if("CIMVectorMarker"===
ja.type){if(ca=ja,Q=this._vectorMarkerBounds(Q,ca,P,Z),ca.frame){var ea=(ca.frame.xmin+ca.frame.xmax)/2,fa=(ca.frame.ymin+ca.frame.ymax)/2;Q[0]-=ea;Q[1]-=fa;Q[2]-=ea;Q[3]-=fa;null!=ca.size&&(ca=ca.size/(ca.frame.ymax-ca.frame.ymin),Q[0]*=ca,Q[1]*=ca,Q[2]*=ca,Q[3]*=ca)}}else"CIMPictureMarker"===ja.type?(ca=ja,fa=P.getResource(ca.url),ea=1,null!=fa&&fa.height&&(ea=fa.width/fa.height),null!=aa.size&&(Q=aa.size/2,ca=aa.size*ea*ca.scaleX/2,Q=[-ca,-Q,ca,Q])):null!=aa.size&&(Q=aa.size/2,Q=[-Q,-Q,Q,Q]);aa.anchorPoint&&
("Absolute"===aa.anchorPointUnits?(ca=aa.anchorPoint.x,ea=aa.anchorPoint.y):(ca=aa.anchorPoint.x*(Q[2]-Q[0]),ea=aa.anchorPoint.y*(Q[3]-Q[1])),ca=1.25*Math.sqrt(ca*ca+ea*ea),Q[0]-=ca,Q[1]-=ca,Q[2]+=ca,Q[3]+=ca);ca=p.getNumericValue(aa.rotation);aa.rotateClockwise&&(ca=-ca);V&&(ca-=V);ca&&(ea=H*ca,ca=Math.cos(ea),ea=Math.sin(ea),fa=c.create([w.cInfinity,w.cInfinity,-w.cInfinity,-w.cInfinity]),c.expandPointInPlace(fa,[Q[0]*ca-Q[1]*ea,Q[0]*ea+Q[1]*ca]),c.expandPointInPlace(fa,[Q[0]*ca-Q[3]*ea,Q[0]*ea+
Q[3]*ca]),c.expandPointInPlace(fa,[Q[2]*ca-Q[1]*ea,Q[2]*ea+Q[1]*ca]),c.expandPointInPlace(fa,[Q[2]*ca-Q[3]*ea,Q[2]*ea+Q[3]*ca]),Q=fa);ca=p.getNumericValue(aa.offsetX);ea=p.getNumericValue(aa.offsetY);if(V){var ha=H*V;fa=Math.cos(ha);ha=Math.sin(ha);const la=ca*ha+ea*fa;ca=ca*fa-ea*ha;ea=la}Q[0]+=ca;Q[1]+=ea;Q[2]+=ca;Q[3]+=ea;aa=v(aa.markerPlacement);0<aa&&(Q[0]-=aa,Q[1]-=aa,Q[2]+=aa,Q[3]+=aa)}aa=C(ja.effects);0<aa&&(Q[0]-=aa,Q[1]-=aa,Q[2]+=aa,Q[3]+=aa);ba?(N[0]=Q[0],N[1]=Q[1],N[2]=Q[2],N[3]=Q[3],
ba=!1):(N[0]=Math.min(N[0],Q[0]),N[1]=Math.min(N[1],Q[1]),N[2]=Math.max(N[2],Q[2]),N[3]=Math.max(N[3],Q[3]))}return N}static _getTextInflatedSize(N,Q,P){var V=y.roundPtToWholePixel(Q.height??r.defaultCIMValues.CIMTextSymbol.height);N[0]=-V/2;N[1]=-V/2;N[2]=V/2;N[3]=V/2;if(!P)return N;P=P.get(Q);if(!P||!P.glyphMosaicItems.glyphs.length)return N;const {lineGapType:Z,lineGap:ba}=Q,aa=Z?e.lineGapType2LineHeight(Z,ba??0,V):0,ca="CIMBackgroundCallout"===Q.callout?.type;Q=u.shapeGlyphs(P.glyphMosaicItems,
{scale:V/z.glyphSize,angle:p.getNumericValue(Q.angle),xOffset:p.getNumericValue(Q.offsetX),yOffset:p.getNumericValue(Q.offsetY),horizontalAlignment:Q.horizontalAlignment,verticalAlignment:Q.verticalAlignment,maxLineWidth:y.getLineWidth(Q.lineWidth),lineHeight:z.magicLabelLineHeight*Math.max(.25,Math.min(aa||1,4)),decoration:Q.font.decoration||"none",useCIMAngleBehavior:!0,hasBackground:ca}).boundsT;V=Math.sqrt(Q.width*Q.width+Q.height*Q.height);N[0]-=Q.x+V;N[1]-=Q.y-V;N[2]+=Q.x+V;N[3]+=-Q.y+V;return N}}
class R{static getEnvelope(N,Q,P){if(!N)return null;P=new e.EnvDrawHelper(P);if(Array.isArray(N)){let V;for(const Z of N)V?V.union(A(P,Z,Q)):V=A(P,Z,Q);return V}return A(P,N,Q)}static getTextureAnchor(N,Q){N=this.getEnvelope(N,null,Q);if(!N)return[0,0,0];Q=N.height*I+2;return[-((N.x+.5*N.width)*I)/(N.width*I+2),-((N.y+.5*N.height)*I)/Q,Q]}static rasterize(N,Q,P,V,Z=!0,ba){var aa=P||this.getEnvelope(Q,null,V);if(!aa)return[null,0,0,0,0];var ca=Math.max(aa.width,aa.height)*I;let ea=null!=ba?Math.max(ba/
ca,1):1;ea*=I;ba=(aa.x+.5*aa.width)*ea;ca=(aa.y+.5*aa.height)*ea;N.width=aa.width*ea;N.height=aa.height*ea;P||(N.width+=2,N.height+=2);P=N.getContext("2d",{willReadFrequently:!0});aa=e.Transformation.createScale(ea,-ea);aa.translate(.5*N.width-ba,.5*N.height+ca);V=new e.CanvasDrawHelper(P,V,aa);switch(Q.type){case "CIMPointSymbol":V.drawSymbol(Q,{type:"point",x:0,y:0});break;case "CIMVectorMarker":aa=new k.Placement,V.drawMarker(Q,aa)}Q=P.getImageData(0,0,N.width,N.height);Q=new Uint8Array(Q.data);
if(Z)for(V=0;V<Q.length;V+=4)Z=Q[V+3]/255,Q[V]*=Z,Q[V+1]*=Z,Q[V+2]*=Z;return[Q,N.width,N.height,-ba/N.width,-ca/N.height]}static fromTextSymbol(N){const {text:Q}=N;return{type:"CIMPointSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,anchorPointUnits:"Relative",dominantSizeAxis3D:"Y",size:10,billboardMode3D:"FaceNearPlane",frame:{xmin:-5,ymin:-5,xmax:5,ymax:5},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{x:0,y:0},symbol:R.createCIMTextSymbolfromTextSymbol(N),textString:Q}],scaleSymbolsProportionally:!0,
respectFrame:!0}],scaleX:1,angleAlignment:"Display"}}static fromPictureFillSymbol(N){const {height:Q,outline:P,width:V,xoffset:Z,xscale:ba,yoffset:aa,yscale:ca}=N,ea=[],fa={type:"CIMPolygonSymbol",symbolLayers:ea};if(P){var ha=D(P);ha&&ea.push(ha)}ha=N.url;"esriPFS"===N.type&&N.imageData&&(ha=N.imageData);N="angle"in N?N.angle??0:0;ea.push({type:"CIMPictureFill",invertBackfaceTexture:!1,scaleX:1,textureFilter:f.TextureFilter.Picture,tintColor:null,url:ha,height:(Q??0)*(ca||1),width:(V??0)*(ba||1),
offsetX:p.getNumericValue(Z),offsetY:p.getNumericValue(aa),rotation:p.getNumericValue(-N),colorSubstitutions:null});return fa}static fromSimpleFillSymbol(N){const {color:Q,style:P,outline:V}=N;N=[];const Z={type:"CIMPolygonSymbol",symbolLayers:N};if(V){var ba=D(V);ba&&N.push(ba)}if(P&&"solid"!==P&&"none"!==P&&"esriSFSSolid"!==P&&"esriSFSNull"!==P){ba={type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",color:T(Q),capStyle:f.LineCapStyle.Butt,joinStyle:f.LineJoinStyle.Miter,width:.75}]};let aa=
0;const ca=g.px2pt("vertical"===P||"horizontal"===P||"cross"===P||"esriSFSCross"===P||"esriSFSVertical"===P||"esriSFSHorizontal"===P?8:10);switch(P){case "vertical":case "esriSFSVertical":aa=90;break;case "forward-diagonal":case "esriSFSForwardDiagonal":aa=-45;break;case "backward-diagonal":case "esriSFSBackwardDiagonal":aa=45;break;case "cross":case "esriSFSCross":aa=0;break;case "diagonal-cross":case "esriSFSDiagonalCross":aa=-45}N.push({type:"CIMHatchFill",lineSymbol:ba,offsetX:0,offsetY:0,rotation:aa,
separation:ca});"cross"===P||"esriSFSCross"===P?N.push({type:"CIMHatchFill",lineSymbol:d.clone(ba),offsetX:0,offsetY:0,rotation:90,separation:ca}):("diagonal-cross"===P||"esriSFSDiagonalCross"===P)&&N.push({type:"CIMHatchFill",lineSymbol:d.clone(ba),offsetX:0,offsetY:0,rotation:45,separation:ca})}else!P||"solid"!==P&&"esriSFSSolid"!==P||N.push({type:"CIMSolidFill",enable:!0,color:T(Q)});return Z}static fromSimpleLineSymbol(N){const {cap:Q,color:P,join:V,marker:Z,miterLimit:ba,style:aa,width:ca}=N;
N=null;"solid"!==aa&&"none"!==aa&&"esriSLSSolid"!==aa&&"esriSLSNull"!==aa&&(N=[{type:"CIMGeometricEffectDashes",dashTemplate:X(aa,Q),lineDashEnding:"NoConstraint",scaleDash:!0,offsetAlongLine:null}]);const ea=[];if(Z){let fa;switch(Z.placement){case "begin-end":fa=f.ExtremityPlacement.Both;break;case "begin":fa=f.ExtremityPlacement.JustBegin;break;case "end":fa=f.ExtremityPlacement.JustEnd;break;default:fa=f.ExtremityPlacement.None}const ha=R.fromSimpleMarker(Z,ca,P).symbolLayers[0];ha.markerPlacement=
{type:"CIMMarkerPlacementAtExtremities",placePerPart:!1,angleToLine:!0,offset:0,extremityPlacement:fa,offsetAlongLine:0};ea.push(ha)}ea.push({type:"CIMSolidStroke",color:"none"!==aa&&"esriSLSNull"!==aa?T(P):[0,0,0,0],capStyle:S(Q),joinStyle:W(V),miterLimit:ba,width:ca,effects:N});return{type:"CIMLineSymbol",symbolLayers:ea}}static fromPictureMarker(N){const {angle:Q,height:P,width:V,xoffset:Z,yoffset:ba}=N;let aa=N.url;"esriPMS"===N.type&&N.imageData&&(aa=N.imageData);return{type:"CIMPointSymbol",
symbolLayers:[{type:"CIMPictureMarker",invertBackfaceTexture:!1,scaleX:1,textureFilter:f.TextureFilter.Picture,tintColor:null,url:aa,size:P,width:V,offsetX:p.getNumericValue(Z),offsetY:p.getNumericValue(ba),rotation:p.getNumericValue(-Q)}]}}static createCIMTextSymbolfromTextSymbol(N){const {angle:Q,color:P,font:V,haloColor:Z,haloSize:ba,horizontalAlignment:aa,kerning:ca,lineWidth:ea,text:fa,verticalAlignment:ha,xoffset:ja,yoffset:la,backgroundColor:oa,borderLineColor:ra,borderLineSize:qa}=N;let Da,
sa,M;if(V){var Y=V.family;var da=V.style;var ia=V.weight;Da=V.size;sa=V.decoration}N=!1;fa&&(N=q.bidiText(fa)[1]);if(oa||qa)M={type:"CIMBackgroundCallout",margin:null,backgroundSymbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",color:T(oa)},{type:"CIMSolidStroke",color:T(ra),width:qa}]},accentBarSymbol:null,gap:null,leaderLineSymbol:null,lineStyle:null};var na=f.BlockProgression.BTT,wa=f.FontEffects.Normal,za=f.FontEncoding.Unicode;Y=Y||"Arial";b:{if(ia)switch(ia.toLowerCase()){case "bold":case "bolder":ia=
"bold";break b}ia=""}b:{if(da)switch(da.toLowerCase()){case "italic":case "oblique":da="italic";break b}da=""}ia=ia&&da?`${ia}-${da}`:`${ia}${da}`;return{type:"CIMTextSymbol",angle:Q,blockProgression:na,depth3D:1,extrapolateBaselines:!0,fontEffects:wa,fontEncoding:za,fontFamilyName:Y,fontStyleName:ia,fontType:f.FontType.Unspecified,haloSize:ba,height:Da,hinting:f.GlyphHinting.Default,horizontalAlignment:J(aa??"center"),kerning:ca,letterWidth:100,ligatures:!0,lineGapType:"Multiple",lineWidth:ea,offsetX:p.getNumericValue(ja),
offsetY:p.getNumericValue(la),strikethrough:"line-through"===sa,underline:"underline"===sa,symbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",enable:!0,color:T(P)}]},haloSymbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",enable:!0,color:T(Z)}]},shadowColor:[0,0,0,255],shadowOffsetX:1,shadowOffsetY:1,textCase:"Normal",textDirection:N?f.TextReadingDirection.RTL:f.TextReadingDirection.LTR,verticalAlignment:O(ha??"baseline"),verticalGlyphOrientation:f.VerticalGlyphOrientation.Right,
wordSpacing:100,billboardMode3D:f.BillBoardMode.FaceNearPlane,callout:M}}static createPictureMarkerRasterizationParam(N){const {angle:Q,height:P,width:V,xoffset:Z,yoffset:ba}=N;return(N=N.url??N.source?.url??N.source?.imageData)?{type:"sprite-rasterization-param",overrides:[],resource:{type:"CIMPictureMarker",invertBackfaceTexture:!1,scaleX:1,textureFilter:f.TextureFilter.Picture,tintColor:null,url:N,size:P,width:V,offsetX:p.getNumericValue(Z),offsetY:p.getNumericValue(ba),rotation:p.getNumericValue(-Q)}}:
null}static createPictureFillRasterizationParam(N){const {width:Q,height:P,xoffset:V,yoffset:Z,url:ba}=N;return ba?{type:"sprite-rasterization-param",overrides:[],resource:{type:"CIMPictureFill",scaleX:1,textureFilter:f.TextureFilter.Picture,tintColor:null,url:ba,width:Q,height:P,offsetX:p.getNumericValue(V),offsetY:p.getNumericValue(Z),rotation:0}}:null}static fromSimpleMarker(N,Q,P){var {style:V}=N;P=N.color??P;if("path"===V||"esriSMSPath"===V){Q=[];if("outline"in N&&N.outline){var Z=N.outline;
Q.push({type:"CIMSolidStroke",enable:!0,width:Z.width,color:T(Z.color),path:N.path})}Q.push({type:"CIMSolidFill",enable:!0,color:T(P),path:N.path});const [fa,ha]=U("square");return{type:"CIMPointSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,rotation:-p.getNumericValue(N.angle),size:p.getNumericValue(N.size||6),offsetX:p.getNumericValue(N.xoffset),offsetY:p.getNumericValue(N.yoffset),scaleSymbolsProportionally:!1,frame:fa,markerGraphics:[{type:"CIMMarkerGraphic",geometry:ha,symbol:{type:"CIMPolygonSymbol",
symbolLayers:Q}}]}]}}const ba=[];Z=N.size;let aa;if("outline"in N&&N.outline&&"none"!==N.outline.style&&"esriSLSNull"!==N.outline.style){const fa=N.outline,ha="solid"!==fa.style&&"esriSLSSolid"!==fa.style;[V,aa]=ha?U(V,N.size):U(V);const ja=fa.width??t.defaultPolylineSymbol2D.width;if(ha){var ca=ja/N.size,ea=(V.xmax-V.xmin)*ca/2;ca=(V.ymax-V.ymin)*ca/2;V.xmin-=ea;V.xmax+=ea;V.ymin-=ca;V.ymax+=ca;Z&&(Z+=ja)}ea="cross"!==N.style&&"x"!==N.style||"dot"===N?.outline.style||"short-dot"===N?.outline.style?
f.LineDashEnding.HalfGap:f.LineDashEnding.FullPattern;ea=ha?[{type:"CIMGeometricEffectAddControlPoints"},{type:"CIMGeometricEffectDashes",dashTemplate:X(fa.style,null).map(la=>fa.width&&0<fa.width?la*fa.width:la),lineDashEnding:ea,controlPointEnding:f.LineDashEnding.FullPattern}]:void 0;ba.push({type:"CIMSolidStroke",capStyle:ha?f.LineCapStyle.Round:f.LineCapStyle.Butt,enable:!0,width:ja,color:T(fa.color),effects:ea})}else!Q||"line-marker"!==N.type||"cross"!==N.style&&"x"!==N.style?[V,aa]=U(V):([V,
aa]=U(V),ba.push({type:"CIMSolidStroke",enable:!0,width:Q,color:T(P)}));ba.push({type:"CIMSolidFill",enable:!0,color:T(P)});P={type:"CIMPolygonSymbol",symbolLayers:ba};return{type:"CIMPointSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,rotation:p.getNumericValue(-N.angle),size:p.getNumericValue(Z||6*Q),offsetX:p.getNumericValue(N.xoffset),offsetY:p.getNumericValue(N.yoffset),scaleSymbolsProportionally:!1,frame:V,markerGraphics:[{type:"CIMMarkerGraphic",geometry:aa,symbol:P}]}]}}static fromCIMHatchFill(N,
Q){const P=Q*(N.separation??r.defaultCIMValues.CIMHatchFill.separation),V=P/2;N=d.clone(N.lineSymbol);N.symbolLayers?.forEach(ba=>{switch(ba.type){case "CIMSolidStroke":null!=ba.width&&(ba.width*=Q);ba.effects?.forEach(aa=>{"CIMGeometricEffectDashes"===aa.type&&(aa.dashTemplate=aa.dashTemplate?.map(ca=>ca*Q))});break;case "CIMVectorMarker":null!=ba.size&&(ba.size*=Q),ba=ba.markerPlacement,null!=ba&&"placementTemplate"in ba&&(ba.placementTemplate=ba.placementTemplate.map(aa=>aa*Q))}});for(var Z=this._getLineSymbolPeriod(N)||
4;4>Z;)Z*=2;Z/=2;return{type:"CIMVectorMarker",frame:{xmin:-Z,xmax:Z,ymin:-V,ymax:V},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{paths:[[[-Z,0],[Z,0]]]},symbol:N}],size:P}}static fetchResources(N,Q,P,V=null){if(!N||!Q)return P;B(N,Z=>{E(Z,Q,P);"url"in Z&&Z.url&&P.push(Q.fetchResource(Z.url,{signal:V}))});return P}static fetchFonts(N,Q,P){if(N&&Q)if("symbolLayers"in N&&N.symbolLayers)for(const ba of N.symbolLayers){if("CIMVectorMarker"===ba.type&&ba.markerGraphics)for(const aa of ba.markerGraphics)aa?.symbol&&
R.fetchFonts(aa.symbol,Q,P)}else if("CIMTextSymbol"===N.type){const {fontFamilyName:ba,fontStyleName:aa}=N;if(ba&&"calcitewebcoreicons"!==ba.toLowerCase()){var {style:V,weight:Z}=p.fromCIMFontStyle(aa);N=p.fromCIMFontDecoration(N);N=new b({family:ba,style:V,weight:Z,decoration:N});P.push(Q.loadFont(N).catch(()=>{K().error(`Unsupported font ${ba} in CIM symbol`)}))}}}static _getLineSymbolPeriod(N){if(N){const Q=this._getEffectsRepeat(N.effects);if(Q)return Q;if(N.symbolLayers)for(const P of N.symbolLayers)if(P){if(N=
this._getEffectsRepeat(P.effects))return N;switch(P.type){case "CIMCharacterMarker":case "CIMPictureMarker":case "CIMVectorMarker":case "CIMObjectMarker3D":case "CIMglTFMarker3D":if(N=this._getPlacementRepeat(P.markerPlacement))return N}}}return 0}static _getEffectsRepeat(N){if(N)for(var Q of N)if(Q)switch(Q.type){case "CIMGeometricEffectDashes":if((N=Q.dashTemplate)&&N.length){Q=0;for(const P of N)Q+=P;N.length&1&&(Q*=2);return Q}break;case "CIMGeometricEffectWave":return Q.period;default:K().error(`unsupported geometric effect type ${Q.type}`)}return 0}static _getPlacementRepeat(N){if(N)switch(N.type){case "CIMMarkerPlacementAlongLineSameSize":case "CIMMarkerPlacementAlongLineRandomSize":case "CIMMarkerPlacementAlongLineVariableSize":if((N=
N.placementTemplate)&&N.length){let Q=0;for(const P of N)Q+=+P;N.length&1&&(Q*=2);return Q}}return 0}static fromCIMInsidePolygon(N){var Q=N.markerPlacement;const P={...N,markerPlacement:null,anchorPoint:null};N=Math.abs(Q.stepX);const V=Math.abs(Q.stepY);var Z=(Q.randomness??100)/100;let ba,aa;if("Random"===Q.gridType){var ca=g.px2pt(z.randomInsidePolygonTextureSize);const ea=Math.max(Math.floor(ca/N),1),fa=Math.max(Math.floor(ca/V),1);ca=ea*N/2;ba=fa*V/2;aa=2*ba;Q=new h(Q.seed);const ha=Z*N/1.5,
ja=Z*V/1.5;Z=[];for(let la=0;la<ea;la++)for(let oa=0;oa<fa;oa++){const ra=la*N-ca+ha*(.5-Q.getFloat()),qa=oa*V-ba+ja*(.5-Q.getFloat());Z.push({x:ra,y:qa});0===la&&Z.push({x:ra+2*ca,y:qa});0===oa&&Z.push({x:ra,y:qa+2*ba})}}else!0===Q.shiftOddRows?(ca=N/2,ba=V,aa=2*V,Z=[{x:-ca,y:0},{x:ca,y:0},{x:0,y:ba},{x:0,y:-ba}]):(ca=N/2,ba=V/2,aa=V,Z=[{x:-N,y:0},{x:0,y:-V},{x:-N,y:-V},{x:0,y:0},{x:N,y:0},{x:0,y:V},{x:N,y:V},{x:-N,y:V},{x:N,y:-V}]);N=Z.map(ea=>({type:"CIMMarkerGraphic",geometry:ea,symbol:{type:"CIMPointSymbol",
symbolLayers:[P]}}));return{type:"CIMVectorMarker",frame:{xmin:-ca,xmax:ca,ymin:-ba,ymax:ba},markerGraphics:N,size:aa}}}const S=N=>{if(!N)return f.LineCapStyle.Butt;switch(N){case "butt":return f.LineCapStyle.Butt;case "square":return f.LineCapStyle.Square;case "round":return f.LineCapStyle.Round}},W=N=>{if(!N)return f.LineJoinStyle.Miter;switch(N){case "miter":return f.LineJoinStyle.Miter;case "round":return f.LineJoinStyle.Round;case "bevel":return f.LineJoinStyle.Bevel}},J=N=>{if(null==N)return"Center";
switch(N){case "left":return"Left";case "right":return"Right";case "center":return"Center"}},O=N=>{if(null==N)return"Center";switch(N){case "baseline":return"Baseline";case "top":return"Top";case "middle":return"Center";case "bottom":return"Bottom"}},T=N=>{if(!N)return[0,0,0,0];const {r:Q,g:P,b:V,a:Z}=N;return[Q,P,V,255*Z]},X=(N,Q)=>{const P=n("safari")?.001:0;Q="butt"===Q;switch(N){case "dash":case "esriSLSDash":return Q?[4,3]:[3,4];case "dash-dot":case "esriSLSDashDot":return Q?[4,3,1,3]:[3,4,P,
4];case "dot":case "esriSLSDot":return Q?[1,3]:[P,4];case "long-dash":case "esriSLSLongDash":return Q?[8,3]:[7,4];case "long-dash-dot":case "esriSLSLongDashDot":return Q?[8,3,1,3]:[7,4,P,4];case "long-dash-dot-dot":case "esriSLSDashDotDot":return Q?[8,3,1,3,1,3]:[7,4,P,4,P,4];case "short-dash":case "esriSLSShortDash":return Q?[4,1]:[3,2];case "short-dash-dot":case "esriSLSShortDashDot":return Q?[4,1,1,1]:[3,2,P,2];case "short-dash-dot-dot":case "esriSLSShortDashDotDot":return Q?[4,1,1,1,1,1]:[3,2,
P,2,P,2];case "short-dot":case "esriSLSShortDot":return Q?[1,1]:[P,2];case "solid":case "esriSLSSolid":case "none":return K().error("Unexpected: style does not require rasterization"),[0,0];default:return K().error(`Tried to rasterize SLS, but found an unexpected style: ${N}!`),[0,0]}},U=(N,Q=100)=>{var P=Q/2,V;if("circle"===N||"esriSMSCircle"===N){var Z=Math.acos(1-.25/P);Q=Math.ceil(F/Z/4);0===Q&&(Q=1);Z=G/Q;Q*=4;N=[];N.push([P,0]);for(V=1;V<Q;V++)N.push([P*Math.cos(V*Z),-P*Math.sin(V*Z)]);N.push([P,
0]);Z={rings:[N]};V={xmin:-P,ymin:-P,xmax:P,ymax:P}}else"cross"===N||"esriSMSCross"===N?(Z={paths:[[[0,P],[0,-P]],[[P,0],[-P,0]]]},V={xmin:-P,ymin:-P,xmax:P,ymax:P}):"diamond"===N||"esriSMSDiamond"===N?(Z={rings:[[[-P,0],[0,P],[P,0],[0,-P],[-P,0]]]},V={xmin:-P,ymin:-P,xmax:P,ymax:P}):"square"===N||"esriSMSSquare"===N?(Z={rings:[[[-P,-P],[-P,P],[P,P],[P,-P],[-P,-P]]]},V={xmin:-P,ymin:-P,xmax:P,ymax:P}):"x"===N||"esriSMSX"===N?(Z={paths:[[[P,P],[-P,-P]],[[P,-P],[-P,P]]]},V={xmin:-P,ymin:-P,xmax:P,ymax:P}):
"triangle"===N||"esriSMSTriangle"===N?(P=.5773502691896257*Q,N=-P,V=2/3*Q,Q=V-Q,Z={rings:[[[N,Q],[0,V],[P,Q],[N,Q]]]},V={xmin:N,ymin:Q,xmax:P,ymax:V}):"arrow"===N&&(Z={rings:[[[-50,50],[50,0],[-50,-50],[-33,-20],[-33,20],[-50,50]]]},V={xmin:-P,ymin:-P,xmax:P,ymax:P});return[V,Z]};l.CIMSymbolHelper=R;l.CIMSymbolInflatedSizeHelper=L;l.capTypeToEnum=S;l.getEffectsInflateSize=C;l.slsDashToTemplateArray=X;l.symbolToCIM=function(N){let Q;switch(N.type){case "cim":return N.data;case "web-style":return N;
case "simple-marker":N=R.fromSimpleMarker(N);if(!N)throw Error("InternalError: Cannot convert symbol to CIM");Q=N;break;case "picture-marker":Q=R.fromPictureMarker(N);break;case "simple-line":Q=R.fromSimpleLineSymbol(N);break;case "simple-fill":Q=R.fromSimpleFillSymbol(N);break;case "picture-fill":Q=R.fromPictureFillSymbol(N);break;case "text":Q=R.fromTextSymbol(N)}return{type:"CIMSymbolReference",symbol:Q}};Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/core/BidiText":function(){define(["exports",
"./BidiEngine"],function(l,q){const n=new q;l.bidiText=function(d){if(null==d)return["",!1];if(!n.hasBidiChar(d))return[d,!1];let m;m="rtl"===n.checkContextual(d)?"IDNNN":"ICNNN";return[n.bidiTransform(d,m,"VLYSN"),!0]};Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/core/BidiEngine":function(){define(["./bidiEngineTables"],function(l){function q(x,C,B,E,D){var F=x;void 0===C&&(C=D.defInFormat);void 0===B&&(B=D.defOutFormat);void 0===E&&(E=D.defSwap);if(C!==B){var G=C.slice(0,
1),H=B.slice(0,1);var I=C.slice(1,4);var K=B.slice(1,4);"C"===I.charAt(0)&&(I=n(F),I="ltr"===I||"rtl"===I?I.toUpperCase():"L"===C.charAt(2)?"LTR":"RTL",C=G+I);"C"===K.charAt(0)&&(I=n(F),"rtl"===I?K="RTL":"ltr"===I?(F=F.split(""),F.reverse(),I=n(F.join("")),K=I.toUpperCase()):K="L"===B.charAt(2)?"LTR":"RTL",B=H+K)}if(C===B)return x;H=C.slice(0,1);F=C.slice(1,4);G=B.slice(0,1);K=B.slice(1,4);D.inFormat=C;D.outFormat=B;D.swap=E;if("L"===H&&"VLTR"===B){if("LTR"===F)return D.dir=0,d(x,D);if("RTL"===F)return D.dir=
1,d(x,D)}if("V"===H&&"V"===G)return D.dir="RTL"===F?1:0,h(x,D);if("L"===H&&"VRTL"===B)return D.dir="LTR"===F?0:1,x=d(x,D),h(x);if("VLTR"===C&&"LLTR"===B)return D.dir=0,d(x,D);if("V"===H&&"L"===G&&F!==K)return x=h(x),"RTL"===F?q(x,"LLTR","VLTR",E,D):q(x,"LRTL","VRTL",E,D);if("VRTL"===C&&"LRTL"===B)return q(x,"LRTL","VRTL",E,D);"L"===H&&"L"===G&&(C=D.swap,D.swap=C.slice(0,1)+"N","RTL"===F?(D.dir=1,x=d(x,D),D.swap="N"+C.slice(1,3),D.dir=0,x=d(x,D)):(D.dir=0,x=d(x,D),D.swap="N"+C.slice(1,3),x=q(x,"VLTR",
"LRTL",D.swap,D)));return x}function n(x){return(x=/[A-Za-z\u05d0-\u065f\u066a-\u06ef\u06fa-\u07ff\ufb1d-\ufdff\ufe70-\ufefc]/.exec(x))?"z">=x[0]?"ltr":"rtl":""}function d(x,C){x=x.split("");const B=[];m(x,B,C);if(0!==C.hiLevel&&C.swap[0]!==C.swap[1])for(let F=0;F<x.length;F++)if(1===B[F]){var E=F;b:{let G=void 0;var D=x[F];let H=0,I=l.swapTable.length-1;for(;H<=I;)if(G=Math.floor((H+I)/2),D<l.swapTable[G][0])I=G-1;else if(D>l.swapTable[G][0])H=G+1;else{D=l.swapTable[G][1];break b}}x[E]=D}a(2,x,B,
C);a(1,x,B,C);u=B;return x.join("")}function m(x,C,B){const E=x.length;var D=B.dir?l.impTabRtl:l.impTabLtr,F=0,G=-1;const H=[],I=[];B.hiLevel=B.dir;B.lastArabic=!1;B.hasUbatAl=!1;B.hasUbatB=!1;B.hasUbatS=!1;for(var K=0;K<E;K++){var L=K,R=x[K].charCodeAt(0);const S=l.primaryTable[R>>8];H[L]=S<l.tbbase?S:l.unicodeTable[S-l.tbbase][R&255]}for(L=0;L<E;L++){K=b(x,H,I,L,B);I[L]=K;F=D[F][K];R=F&240;F&=15;K=D[F][5];C[L]=K;if(0<R){if(16===R)for(;G<L;G++)C[G]=1;G=-1}if(D[F][6])-1===G&&(G=L);else if(-1<G){for(;G<
L;G++)C[G]=K;G=-1}H[L]===l.ubatB&&(C[L]=0);B.hiLevel|=K}if(B.hasUbatS)for(x=0;x<E;x++)if(H[x]===l.ubatS)for(C[x]=B.dir,D=x-1;0<=D;D--)if(H[D]===l.ubatWs)C[D]=B.dir;else break}function h(x,C){x=x.split("");if(C){const B=[];m(x,B,C);u=B}x.reverse();w.reverse();return x.join("")}function g(x){for(let C=0;C<l.arabicAlefBetIntervalsBegine.length;C++)if(x>=l.arabicAlefBetIntervalsBegine[C]&&x<=l.arabicAlefBetIntervalsEnd[C])return!0;return!1}function c(x,C,B,E){for(;C*B<E&&e(x[C]);)C+=B;return C*B<E&&g(x[C])?
!0:!1}function a(x,C,B,E){if(!(E.hiLevel<x))if(1!==x||1!==E.dir||E.hasUbatB){E=C.length;for(var D=0,F,G,H;D<E;){if(B[D]>=x){for(F=D+1;F<E&&B[F]>=x;)F++;for(G=F-1;D<G;D++,G--)H=C[D],C[D]=C[G],C[G]=H,H=w[D],w[D]=w[G],w[G]=H;D=F}D++}}else C.reverse(),w.reverse()}function b(x,C,B,E,D){return{UBAT_L:()=>{D.lastArabic=!1;return l.ubatL},UBAT_R:()=>{D.lastArabic=!1;return l.ubatR},UBAT_ON:()=>l.ubatOn,UBAT_AN:()=>l.ubatAn,UBAT_EN:()=>D.lastArabic?l.ubatAn:l.ubatEn,UBAT_AL:()=>{D.lastArabic=!0;D.hasUbatAl=
!0;return l.ubatR},UBAT_WS:()=>l.ubatOn,UBAT_CS:()=>{let F,G;if(1>E||E+1>=C.length||(F=B[E-1])!==l.ubatEn&&F!==l.ubatAn||(G=C[E+1])!==l.ubatEn&&G!==l.ubatAn)return l.ubatOn;D.lastArabic&&(G=l.ubatAn);return G===F?G:l.ubatOn},UBAT_ES:()=>(0<E?B[E-1]:l.ubatB)===l.ubatEn&&E+1<C.length&&C[E+1]===l.ubatEn?l.ubatEn:l.ubatOn,UBAT_ET:()=>{if(0<E&&B[E-1]===l.ubatEn)return l.ubatEn;if(D.lastArabic)return l.ubatOn;let F=E+1;const G=C.length;for(;F<G&&C[F]===l.ubatEt;)F++;return F<G&&C[F]===l.ubatEn?l.ubatEn:
l.ubatOn},UBAT_NSM:()=>{if("VLTR"===D.inFormat){for(var F=C.length,G=E+1;G<F&&C[G]===l.ubatNsm;)G++;if(G<F&&(F=x[E].charCodeAt(0),G=C[G],(1425<=F&&2303>=F||64286===F)&&(G===l.ubatR||G===l.ubatAl)))return l.ubatR}return 1>E||C[E-1]===l.ubatB?l.ubatOn:B[E-1]},UBAT_B:()=>{D.lastArabic=!0;D.hasUbatB=!0;return D.dir},UBAT_S:()=>{D.hasUbatS=!0;return l.ubatOn},UBAT_LRE:()=>{D.lastArabic=!1;return l.ubatOn},UBAT_RLE:()=>{D.lastArabic=!1;return l.ubatOn},UBAT_LRO:()=>{D.lastArabic=!1;return l.ubatOn},UBAT_RLO:()=>
{D.lastArabic=!1;return l.ubatOn},UBAT_PDF:()=>{D.lastArabic=!1;return l.ubatOn},UBAT_BN:()=>l.ubatOn}[l.typesNames[C[E]]]()}function k(x,C){for(let B=0;B<l.baseForm.length;B++)if(x===l.baseForm[B])return C[B];return x}function e(x){return"\u064b"<=x&&"\u0655">=x}function r(x){return"L"===x?"LTR":"R"===x?"RTL":"C"===x?"CLR":"D"===x?"CRL":""}function f(x,C){for(let B=0;B<l.aLefTable.length;B++)if(x===l.aLefTable[B])return C[B];return x}function p(x,C,B,E){for(let D=0;D<x.length;D++)if(x[D]>C||!B&&
x[D]===C)x[D]+=E}class t{constructor(){this.inputFormat="ILYNN";this.outputFormat="VLNNN";this.sourceToTarget=[];this.targetToSource=[];this.levels=[]}bidiTransform(x,C,B){this.sourceToTarget=[];this.targetToSource=[];if(!x)return"";var E=this.sourceToTarget,D=this.targetToSource,F=x.length;w=[];u=[];for(var G=0;G<F;G++)E[G]=G,D[G]=G,w[G]=G;if(!this.checkParameters(C,B))return x;C=this.inputFormat;B=this.outputFormat;E=x;E=y;G=r(C.charAt(1));D=r(B.charAt(1));var H="I"===C.charAt(0)?"L":C.charAt(0);
F="I"===B.charAt(0)?"L":B.charAt(0);G=H+G;D=F+D;F=C.charAt(2)+B.charAt(2);E.defInFormat=G;E.defOutFormat=D;E.defSwap=F;x=q(x,G,D,F,E);E=!1;if("R"===B.charAt(1))E=!0;else if("C"===B.charAt(1)||"D"===B.charAt(1))E="rtl"===this.checkContextual(x);D=this.sourceToTarget=w;F=Array(D.length);for(G=0;G<D.length;G++)F[D[G]]=G;z=this.targetToSource=F;if(C.charAt(3)===B.charAt(3))E=x;else if("S"===B.charAt(3))if(C=E,B=x,0===B.length)E="";else{void 0===C&&(C=!0);B=String(B);B=B.split("");D=0;x=1;E=B.length;C||
(D=B.length-1,x=-1,E=1);G=D;H=0;D=[];for(F=0;G*x<E;G+=x)if(g(B[G])||e(B[G])){var I;if(I="\u0644"===B[G])b:{for(var K=B,L=G+x,R=x,S=E;L*R<S&&e(K[L]);)L+=R;I=" ";if(L*R<S)for(I=K[L],K=0;K<l.aLefTable.length;K++)if(l.aLefTable[K]===I){I=!0;break b}I=!1}if(I){B[G]=0===H?f(B[G+x],l.lamAlefInialTableFE):f(B[G+x],l.lamAlefMedialTableFE);G+=x;H=B;I=G;K=x;for(L=E;I*K<L&&e(H[I]);)I+=K;I*K<L&&(H[I]=" ");D[F]=G;F++;H=0}else{I=B[G];if(1===H){K=G;if(c(B,G+x,x,E))b:for(L=B[G],R=0;R<l.baseForm.length;R++){if(L===
l.baseForm[R]){L=l.medialForm[R];break b}}else L=k(B[G],l.finalForm);B[K]=L}else!0===c(B,G+x,x,E)?B[G]=k(B[G],l.initialForm):B[G]=k(B[G],l.isolatedForm);e(I)||(H=1);b:{for(K=0;K<l.standAlonForm.length;K++)if(l.standAlonForm[K]===I){I=!0;break b}I=!1}!0===I&&(H=0)}}else H=0;x=D;E="";for(D=0;D<B.length;D++){b:{for(F=0;F<x.length;F++)if(x[F]===D)break b;F=-1}-1<F?(p(z,D,!C,-1),w.splice(D,1)):E+=B[D]}}else if(C=x,B=E,0===C.length)E="";else{void 0===B&&(B=!0);C=String(C);x="";E=C.split("");for(D=0;D<C.length;D++)F=
!1,"\ufe70"<=E[D]&&"\ufeff">E[D]?(G=C.charCodeAt(D),"\ufef5"<=E[D]&&"\ufefc">=E[D]?(B?(0<D&&" "===E[D-1]?x=x.slice(0,-1)+"\u0644":(x+="\u0644",F=!0),x+=l.aLefTable[(G-65269)/2]):(x+=l.aLefTable[(G-65269)/2],x+="\u0644",D+1<C.length&&" "===E[D+1]?D++:F=!0),F&&(p(z,D,!0,1),w.splice(D,0,w[D]))):x+=l.feTo06Table[G-65136]):x+=E[D];E=x}this.sourceToTarget=w;this.targetToSource=z;this.levels=u;return E}_inputFormatSetter(x){if(!A.test(x))throw Error("dojox/string/BidiEngine: the bidi layout string is wrong!");
this.inputFormat=x}_outputFormatSetter(x){if(!A.test(x))throw Error("dojox/string/BidiEngine: the bidi layout string is wrong!");this.outputFormat=x}checkParameters(x,C){x?this._inputFormatSetter(x):x=this.inputFormat;C?this._outputFormatSetter(C):C=this.outputFormat;return x===C?!1:!0}checkContextual(x){x=n(x);if("ltr"!==x&&"rtl"!==x){try{x=document.dir.toLowerCase()}catch(C){}"ltr"!==x&&"rtl"!==x&&(x="ltr")}return x}hasBidiChar(x){return v.test(x)}}let w=[],z=[],u=[];const y={dir:0,defInFormat:"LLTR",
defoutFormat:"VLTR",defSwap:"YN",inFormat:"LLTR",outFormat:"VLTR",swap:"YN",hiLevel:0,lastArabic:!1,hasUbatAl:!1,hasBlockSep:!1,hasSegSep:!1,defOutFormat:""},A=/^[(I|V)][(L|R|C|D)][(Y|N)][(S|N)][N]$/,v=/[\u0591-\u06ff\ufb1d-\ufefc]/;return t})},"esri/core/bidiEngineTables":function(){define(["exports"],function(l){l.aLefTable=["\u0622","\u0623","\u0625","\u0627"];l.arabicAlefBetIntervalsBegine=["\u0621","\u0641"];l.arabicAlefBetIntervalsEnd=["\u063a","\u064a"];l.baseForm="\u0627\u0628\u062a\u062b\u062c\u062d\u062e\u062f\u0630\u0631\u0632\u0633\u0634\u0635\u0636\u0637\u0638\u0639\u063a\u0641\u0642\u0643\u0644\u0645\u0646\u0647\u0648\u064a\u0625\u0623\u0622\u0629\u0649\u0644\u0645\u0646\u0647\u0648\u064a\u0625\u0623\u0622\u0629\u0649\u06cc\u0626\u0624".split("");
l.feTo06Table="\u064b\u064b\u064c\u061f\u064d\u061f\u064e\u064e\u064f\u064f\u0650\u0650\u0651\u0651\u0652\u0652\u0621\u0622\u0622\u0623\u0623\u0624\u0624\u0625\u0625\u0626\u0626\u0626\u0626\u0627\u0627\u0628\u0628\u0628\u0628\u0629\u0629\u062a\u062a\u062a\u062a\u062b\u062b\u062b\u062b\u062c\u062c\u062c\u062c\u062d\u062d\u062d\u062d\u062e\u062e\u062e\u062e\u062f\u062f\u0630\u0630\u0631\u0631\u0632\u0632\u0633\u0633\u0633\u0633\u0634\u0634\u0634\u0634\u0635\u0635\u0635\u0635\u0636\u0636\u0636\u0636\u0637\u0637\u0637\u0637\u0638\u0638\u0638\u0638\u0639\u0639\u0639\u0639\u063a\u063a\u063a\u063a\u0641\u0641\u0641\u0641\u0642\u0642\u0642\u0642\u0643\u0643\u0643\u0643\u0644\u0644\u0644\u0644\u0645\u0645\u0645\u0645\u0646\u0646\u0646\u0646\u0647\u0647\u0647\u0647\u0648\u0648\u0649\u0649\u064a\u064a\u064a\u064a\ufef5\ufef6\ufef7\ufef8\ufef9\ufefa\ufefb\ufefc\u061f\u061f\u061f".split("");
l.finalForm="\ufe8e\ufe90\ufe96\ufe9a\ufe9e\ufea2\ufea6\ufeaa\ufeac\ufeae\ufeb0\ufeb2\ufeb6\ufeba\ufebe\ufec2\ufec6\ufeca\ufece\ufed2\ufed6\ufeda\ufede\ufee2\ufee6\ufeea\ufeee\ufef2\ufe88\ufe84\ufe82\ufe94\ufef0\ufbfd\ufe8a\ufe86\ufe70\ufe72\ufe74\ufe76\ufe78\ufe7a\ufe7c\ufe7e\ufe80\ufe8a\ufe86".split("");l.impTabLtr=[[0,3,0,1,0,0,0],[0,3,0,1,2,2,0],[0,3,0,17,2,0,1],[0,3,5,5,4,1,0],[0,3,21,21,4,0,1],[0,3,5,5,4,2,0]];l.impTabRtl=[[2,0,1,1,0,1,0],[2,0,1,1,0,2,0],[2,0,2,1,3,2,0],[2,0,2,33,3,1,1]];l.initialForm=
"\ufe8d\ufe91\ufe97\ufe9b\ufe9f\ufea3\ufea7\ufea9\ufeab\ufead\ufeaf\ufeb3\ufeb7\ufebb\ufebf\ufec3\ufec7\ufecb\ufecf\ufed3\ufed7\ufedb\ufedf\ufee3\ufee7\ufeeb\ufeed\ufef3\ufe87\ufe83\ufe81\ufe93\ufeef\ufbfe\ufe8b\ufe85\ufe70\ufe72\ufe74\ufe76\ufe78\ufe7a\ufe7c\ufe7e\ufe80\ufe8b\ufe85".split("");l.isolatedForm="\ufe8d\ufe8f\ufe95\ufe99\ufe9d\ufea1\ufea5\ufea9\ufeab\ufead\ufeaf\ufeb1\ufeb5\ufeb9\ufebd\ufec1\ufec5\ufec9\ufecd\ufed1\ufed5\ufed9\ufedd\ufee1\ufee5\ufee9\ufeed\ufef1\ufe87\ufe83\ufe81\ufe93\ufeef\ufbfc\ufe89\ufe85\ufe70\ufe72\ufe74\ufe76\ufe78\ufe7a\ufe7c\ufe7e\ufe80\ufe89\ufe85".split("");
l.lamAlefInialTableFE=["\ufef5","\ufef7","\ufef9","\ufefb"];l.lamAlefMedialTableFE=["\ufef6","\ufef8","\ufefa","\ufefc"];l.medialForm="\ufe8e\ufe92\ufe98\ufe9c\ufea0\ufea4\ufea8\ufeaa\ufeac\ufeae\ufeb0\ufeb4\ufeb8\ufebc\ufec0\ufec4\ufec8\ufecc\ufed0\ufed4\ufed8\ufedc\ufee0\ufee4\ufee8\ufeec\ufeee\ufef4\ufe88\ufe84\ufe82\ufe94\ufef0\ufbff\ufe8c\ufe86\ufe71\ufe72\ufe74\ufe77\ufe79\ufe7b\ufe7d\ufe7f\ufe80\ufe8c\ufe86".split("");l.primaryTable=[100,0,0,0,0,101,102,103,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,104,4,4,4,0,4,0,4,0,4,4,4,0,0,4,4,0,0,0,0,0,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,0,0,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,0,0,4,4,0,0,4,4,0,0,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,0,0,0,105,7,7,106,107];l.standAlonForm="\u0621\u0622\u0623\u0624\u0625\u0627\u0629\u062f\u0630\u0631\u0632\u0648\u0649".split("");
l.swapTable=[["(",")"],[")","("],["\x3c","\x3e"],["\x3e","\x3c"],["[","]"],["]","["],["{","}"],["}","{"],["\u00ab","\u00bb"],["\u00bb","\u00ab"],["\u2039","\u203a"],["\u203a","\u2039"],["\u207d","\u207e"],["\u207e","\u207d"],["\u208d","\u208e"],["\u208e","\u208d"],["\u2264","\u2265"],["\u2265","\u2264"],["\u2329","\u232a"],["\u232a","\u2329"],["\ufe59","\ufe5a"],["\ufe5a","\ufe59"],["\ufe5b","\ufe5c"],["\ufe5c","\ufe5b"],["\ufe5d","\ufe5e"],["\ufe5e","\ufe5d"],["\ufe64","\ufe65"],["\ufe65","\ufe64"]];
l.tbbase=100;l.typesNames="UBAT_L UBAT_R UBAT_EN UBAT_AN UBAT_ON UBAT_B UBAT_S UBAT_AL UBAT_WS UBAT_CS UBAT_ES UBAT_ET UBAT_NSM UBAT_LRE UBAT_RLE UBAT_PDF UBAT_LRO UBAT_RLO UBAT_BN".split(" ");l.ubatAl=7;l.ubatAn=3;l.ubatB=5;l.ubatBn=18;l.ubatCs=9;l.ubatEn=2;l.ubatEs=10;l.ubatEt=11;l.ubatL=0;l.ubatLre=13;l.ubatLro=16;l.ubatNsm=12;l.ubatOn=4;l.ubatPdf=15;l.ubatR=1;l.ubatRle=14;l.ubatRlo=17;l.ubatS=6;l.ubatWs=8;l.unicodeTable=[[18,18,18,18,18,18,18,18,18,6,5,6,8,5,18,18,18,18,18,18,18,18,18,18,18,18,
18,18,5,5,5,6,8,4,4,11,11,11,4,4,4,4,4,10,9,10,9,9,2,2,2,2,2,2,2,2,2,2,9,4,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,4,4,18,18,18,18,18,18,5,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,9,4,11,11,11,11,4,4,4,4,0,4,4,18,4,4,11,11,2,2,4,0,4,4,4,2,0,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,
0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,4,4,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,4,4,4,4,4,4,4,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,1,12,1,12,12,1,12,12,1,12,4,4,4,4,4,4,4,4,1,1,1,1,1,1,1,1,1,1,1,1,1,1,
1,1,1,1,1,1,1,1,1,1,1,1,1,4,4,4,4,4,1,1,1,1,1,4,4,4,4,4,4,4,4,4,4,4],[3,3,3,3,4,4,4,4,7,11,11,7,9,7,4,4,12,12,12,12,12,12,12,12,12,12,12,7,4,4,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,3,3,3,3,3,3,3,3,3,3,11,3,3,7,7,7,12,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,12,12,12,12,12,12,12,3,4,12,12,12,12,12,12,7,7,12,12,4,12,12,12,12,7,7,2,2,2,2,2,2,2,2,2,2,7,7,7,7,7,7],[7,7,7,7,7,7,7,7,7,7,7,7,7,7,4,7,7,12,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,4,4,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,12,12,
12,12,12,12,12,12,12,12,12,7,4,4,4,4,4,4,4,4,4,4,4,4,4,4,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,12,12,12,12,12,12,12,12,12,1,1,4,4,4,4,1,4,4,4,4,4],[8,8,8,8,8,8,8,8,8,8,8,18,18,18,0,1,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,8,5,13,14,15,16,17,9,11,11,11,11,11,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,9,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,8,18,18,18,18,18,4,4,4,4,4,18,18,18,18,18,18,2,0,4,4,2,2,2,2,2,2,10,10,4,4,4,0,2,2,2,2,2,2,2,2,2,2,10,
10,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,4,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4],[0,0,0,0,0,0,0,4,4,4,4,4,4,4,4,4,4,4,4,0,0,0,0,0,4,4,4,4,4,1,12,1,1,1,1,1,1,1,1,1,1,10,1,1,1,1,1,1,1,1,1,1,1,1,1,4,1,1,1,1,1,4,1,4,1,1,4,1,1,4,1,1,1,1,1,1,1,1,1,1,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7],[12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,12,12,12,12,12,12,12,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,9,4,9,4,
4,9,4,4,4,4,4,4,4,4,4,11,4,4,10,10,4,4,4,4,4,11,11,4,4,4,4,4,7,7,7,7,7,4,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,4,4,18],[4,4,4,11,11,11,4,4,4,4,4,10,9,10,9,9,2,2,2,2,2,2,2,2,2,2,9,4,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,4,4,4,4,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,4,4,4,4,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,4,0,0,0,0,0,0,4,4,0,0,0,0,0,0,4,4,0,0,0,0,0,0,4,4,0,0,0,4,4,4,11,11,4,4,4,11,11,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4]];Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/CIMPlacements":function(){define(["exports"],
function(l){class q{constructor(){this.setIdentity()}getAngle(){if(null==this.rz||0===this.rz&&1!==this.rzCos&&0!==this.rzSin)this.rz=Math.atan2(this.rzSin,this.rzCos);return this.rz}setIdentity(){this.tz=this.ty=this.tx=0;this.s=1;this.rz=this.ry=this.rx=0;this.rzCos=1;this.rzSin=0}setTranslate(d,m){this.tx=d;this.ty=m}setTranslateZ(d){this.tz=d}setRotateCS(d,m){this.rz=void 0;this.rzCos=d;this.rzSin=m}setRotate(d){this.rz=d;this.rzSin=this.rzCos=void 0}setRotateY(d){this.ry=d}setScale(d){this.s=
d}setMeasure(d){this.m=d}}class n{next(){return null}}l.EmptyPlacementCursor=n;l.Placement=q;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/CIMSymbolDrawHelper":function(){define("exports ../../core/fontUtils ../../core/has ../../core/lang ../../core/Logger ../../core/ObjectPool ../../core/screenUtils ../../geometry/GeometryCursor ../../geometry/support/aaBoundingRect ../../geometry/support/boundsUtils ../../geometry/support/centroid ../../geometry/support/jsonUtils ./CIMEffects ./CIMImageColorSubstitutionHelper ./CIMOperators ./CIMPlacements ./defaultCIMValues ./enums ./imageUtils ./Rect ./TextRasterizer ./utils ../../views/2d/engine/svgUtils ../../views/2d/engine/webgl/definitions ../../views/2d/engine/webgl/mesh/templates/shapingUtils ../../views/2d/layers/graphics/graphicsUtils".split(" "),
function(l,q,n,d,m,h,g,c,a,b,k,e,r,f,p,t,w,z,u,y,A,v,x,C,B,E){function D(J,O,T){for(const U of O){O=U.length;for(let N=1;N<O;N++){var X=U[N-1];const Q=U[N];let P=(Q[0]-X[0])*(Q[0]-X[0])+(Q[1]-X[1])*(Q[1]-X[1]);if(0!==P&&(P=Math.sqrt(P),Math.abs(((Q[0]-X[0])*(J[1]-X[1])-(Q[1]-X[1])*(J[0]-X[0]))/P)<T&&(X=((Q[0]-X[0])*(J[0]-X[0])+(Q[1]-X[1])*(J[1]-X[1]))/P,X>-T&&X<P+T)))return!0}}return!1}function F(J,O=1){const T=v.fromCIMFontDecoration(J);var X=v.fromCIMFontStyle(J.fontStyleName);const U=J.fontFamilyName??
q.defaultFontFamily,{weight:N,style:Q}=X;X=O*(J.height||5);const P=v.fromCIMHorizontalAlignment(J.horizontalAlignment),V=v.fromCIMVerticalAlignment(J.verticalAlignment),Z=v.getFillColor(J),ba=v.getFillColor(J.haloSymbol),aa=null!=ba?O*(J.haloSize??0):0,ca=v.getStrokeColor(J.symbol);O*=v.getStrokeWidth(J.symbol)||0;var ea="CIMBackgroundCallout"===J.callout?.type?J.callout.backgroundSymbol:null;J=v.getFillColor(ea);const fa=v.getStrokeWidth(ea);ea=v.getStrokeColor(ea);return{color:Z,size:X,horizontalAlignment:P,
verticalAlignment:V,font:{family:U,style:v.getFontStyle(Q),weight:v.getFontWeight(N),decoration:T},outline:{size:O||0,color:ca},halo:{size:aa||0,color:ba,style:Q},backgroundColor:J,borderLine:null!=fa&&null!=ea?{size:fa,color:ea}:null,pixelRatio:1,premultiplyColors:!0}}const G=Math.PI/180;class H{constructor(J){this._t=J}static createIdentity(){return new H([1,0,0,0,1,0])}clone(){return new H(this._t.slice())}transform(J){const O=this._t;return[O[0]*J[0]+O[1]*J[1]+O[2],O[3]*J[0]+O[4]*J[1]+O[5]]}static createScale(J,
O){return new H([J,0,0,0,O,0])}scale(J,O){const T=this._t;T[0]*=J;T[1]*=J;T[2]*=J;T[3]*=O;T[4]*=O;T[5]*=O;return this}scaleRatio(){return Math.sqrt(this._t[0]*this._t[0]+this._t[1]*this._t[1])}static createTranslate(J,O){return new H([0,0,J,0,0,O])}translate(J,O){const T=this._t;T[2]+=J;T[5]+=O;return this}static createRotate(J){const O=Math.cos(J);J=Math.sin(J);return new H([O,-J,0,J,O,0])}rotate(J){return H.multiply(this,H.createRotate(J),this)}angle(){const J=this._t[0],O=this._t[3],T=Math.sqrt(J*
J+O*O);return[J/T,O/T]}static multiply(J,O,T){J=J._t;O=O._t;const X=J[1]*O[0]+J[4]*O[1],U=J[2]*O[0]+J[5]*O[1]+O[2],N=J[0]*O[3]+J[3]*O[4],Q=J[1]*O[3]+J[4]*O[4],P=J[2]*O[3]+J[5]*O[4]+O[5],V=T._t;V[0]=J[0]*O[0]+J[3]*O[1];V[1]=X;V[2]=U;V[3]=N;V[4]=Q;V[5]=P;return T}invert(){const J=this._t;let O=J[0]*J[4]-J[1]*J[3];if(0===O)return new H([0,0,0,0,0,0]);O=1/O;return new H([J[4]*O,-J[1]*O,(J[1]*J[5]-J[2]*J[4])*O,-J[3]*O,J[0]*O,(J[2]*J[3]-J[0]*J[5])*O])}}class I{constructor(J,O){this._resourceManager=J;this._transfos=
[];this._sizeTransfos=[];this._geomUnitsPerPoint=1;this._placementPool=new h(t.Placement,void 0,void 0,100);this._earlyReturn=!1;this._mapRotation=0;this._transfos.push(O||H.createIdentity());this._sizeTransfos.push(O?O.scaleRatio():1)}setTransform(J,O){this._transfos=[J||H.createIdentity()];this._sizeTransfos=[O||(J?J.scaleRatio():1)]}setGeomUnitsPerPoint(J){this._geomUnitsPerPoint=J}transformPt(J){return this._transfos[this._transfos.length-1].transform(J)}transformSize(J){return J*this._sizeTransfos[this._sizeTransfos.length-
1]}reverseTransformPt(J){return this._transfos[this._transfos.length-1].invert().transform(J)}reverseTransformSize(J){return J/this._sizeTransfos[this._sizeTransfos.length-1]}reverseTransformScalar(J){return J/this._transfos[this._transfos.length-1].scaleRatio()}getTransformAngle(){return this._transfos[this._transfos.length-1].angle()}geomUnitsPerPoint(){return this.isEmbedded()?1:this._geomUnitsPerPoint}prevGeomUnitsPerPoint(){return 2<this._transfos.length?1:this._geomUnitsPerPoint}isEmbedded(){return 1<
this._transfos.length}back(){return this._transfos[this._transfos.length-1]}push(J,O){O=O?J.scaleRatio():1;H.multiply(J,this.back(),J);this._transfos.push(J);this._sizeTransfos.push(this._sizeTransfos[this._sizeTransfos.length-1]*O)}pop(){this._transfos.splice(-1,1);this._sizeTransfos.splice(-1,1)}drawSymbol(J,O,T){if(J)switch(J.type){case "CIMPointSymbol":case "CIMLineSymbol":case "CIMPolygonSymbol":this.drawMultiLayerSymbol(J,O);break;case "CIMTextSymbol":this.drawTextSymbol(J,O,T)}}drawMultiLayerSymbol(J,
O){if(J&&O){var T=J.symbolLayers;if(T)if((J=J.effects)&&0<J.length){if(O=this.executeEffects(J,O))for(J=O.next();J;)this.drawSymbolLayers(T,J.asJSON()),J=O.next()}else this.drawSymbolLayers(T,O)}}executeEffects(J,O){const T=this._resourceManager.geometryEngine;O=new r.SimpleEffectCursor(c.GeometryCursor.fromJSONCIM(O));for(const X of J)(J=p.getEffectOperator(X))&&(O=J.execute(O,X,this.geomUnitsPerPoint(),null,T));return O}drawSymbolLayers(J,O){let T=J.length;for(;T--;){const U=J[T];if(U&&!1!==U.enable){var X=
U.effects;if(X&&0<X.length){if(X=this.executeEffects(X,O)){let N=null;for(;(N=X.next())&&(this.drawSymbolLayer(U,N.asJSON()),!this._earlyReturn););}}else this.drawSymbolLayer(U,O);if(this._earlyReturn)break}}}drawSymbolLayer(J,O){switch(J.type){case "CIMSolidFill":this.drawSolidFill(O,J.color,J.path);break;case "CIMHatchFill":this.drawHatchFill(O,J);break;case "CIMPictureFill":this.drawPictureFill(O,J);break;case "CIMGradientFill":this.drawGradientFill(O,J);break;case "CIMSolidStroke":this.drawSolidStroke(O,
J.color,J.width,J.capStyle,J.joinStyle,J.miterLimit,J.path);break;case "CIMPictureStroke":this.drawPictureStroke(O,J);break;case "CIMGradientStroke":this.drawGradientStroke(O,J);break;case "CIMCharacterMarker":case "CIMPictureMarker":case "CIMVectorMarker":this.drawMarkerLayer(J,O)}}drawHatchFill(J,O){var T=this.geomUnitsPerPoint(),X=v.getNumericValue(O.separation,w.defaultCIMValues.CIMHatchFill.separation)*T;var U=v.getNumericValue(O.rotation);if(0===X)U=null;else{0>X&&(X=-X);for(var N=0,Q=.5*X;N>
Q;)N-=X;for(;N<-Q;)N+=X;var P=a.create();b.getBoundsXY(P,J);P[0]-=Q;P[1]-=Q;P[2]+=Q;P[3]+=Q;for(var V=[[P[0],P[1]],[P[0],P[3]],[P[2],P[3]],[P[2],P[1]]];180<U;)U-=180;for(;0>U;)U+=180;P=Math.cos(U*G);var Z=Math.sin(U*G);U=-X*Z;Q=X*P;N=v.getNumericValue(O.offsetX)*T;T*=v.getNumericValue(O.offsetY);N=N*Z-T*P;var ba;var aa=T=Number.MAX_VALUE;var ca=ba=-Number.MAX_VALUE;for(var ea of V){var fa=ea[0];const ha=ea[1];V=P*fa+Z*ha;fa=-Z*fa+P*ha;aa=Math.min(aa,V);T=Math.min(T,fa);ca=Math.max(ca,V);ba=Math.max(ba,
fa)}T=Math.floor(T/X)*X;ea=P*aa-Z*T-U*N/X;aa=Z*aa+P*T-Q*N/X;V=P*ca-Z*T-U*N/X;P=Z*ca+P*T-Q*N/X;X=1+Math.round((ba-T)/X);N=[];for(Z=0;Z<X;Z++)ea+=U,aa+=Q,V+=U,P+=Q,N.push([[ea,aa],[V,P]]);U={paths:N}}U&&(this.pushClipPath(J),this.drawMultiLayerSymbol(O.lineSymbol,U),this.popClipPath())}drawPictureFill(J,O){}drawGradientFill(J,O){}drawPictureStroke(J,O){}drawGradientStroke(J,O){}drawMarkerLayer(J,O){var T=J.markerPlacement;if(T){var X=p.getPlacementOperator(T);if(X){var U="CIMMarkerPlacementInsidePolygon"===
T.type||"CIMMarkerPlacementPolygonCenter"===T.type&&T.clipAtBoundary;U&&this.pushClipPath(O);if(O=X.execute(c.GeometryCursor.fromJSONCIM(O),T,this.geomUnitsPerPoint(),null,this._resourceManager.geometryEngine))for(T=null;(T=O.next())&&(this.drawMarker(J,T),!this._earlyReturn););U&&this.popClipPath()}}else{U=this._placementPool.acquire();if(e.isPoint(O))U.tx=O.x,U.ty=O.y,this.drawMarker(J,U);else if(e.isPolygon(O)){if(O=k.polygonCentroid(O))[U.tx,U.ty]=O,this.drawMarker(J,U)}else for(X of O.points)if(U.tx=
X[0],U.ty=X[1],this.drawMarker(J,U),this._earlyReturn)break;this._placementPool.release(U)}}drawMarker(J,O){switch(J.type){case "CIMCharacterMarker":case "CIMPictureMarker":this.drawPictureMarker(J,O);break;case "CIMVectorMarker":this.drawVectorMarker(J,O)}}drawPictureMarker(J,O){if(J){var T=this._resourceManager.getResource(J.url),X=v.getNumericValue(J.size,w.defaultCIMValues.CIMPictureMarker.size);if(!(null==T||0>=X)){var U=T.width;T=T.height;if(U&&T){T=U/T;var N=v.getNumericValue(J.scaleX,1);U=
H.createIdentity();var Q=J.anchorPoint;if(Q){var P=Q.x;Q=Q.y;"Absolute"!==J.anchorPointUnits&&(P*=X*T*N,Q*=X);U.translate(-P,-Q)}T=v.getNumericValue(J.rotation);J.rotateClockwise&&(T=-T);this._mapRotation&&(T+=this._mapRotation);T&&U.rotate(T*G);T=v.getNumericValue(J.offsetX);N=v.getNumericValue(J.offsetY);if(T||N){if(this._mapRotation){Q=G*this._mapRotation;P=Math.cos(Q);Q=Math.sin(Q);const V=T*Q+N*P;T=T*P-N*Q;N=V}U.translate(T,N)}T=this.geomUnitsPerPoint();1!==T&&U.scale(T,T);(T=O.getAngle())&&
U.rotate(T);U.translate(O.tx,O.ty);this.push(U,!1);this.drawImage(J,X);this.pop()}}}}drawVectorMarker(J,O){if(J){var T=J.markerGraphics;if(T){var X=v.getNumericValue(J.size,w.defaultCIMValues.CIMVectorMarker.size),U=J.frame,N=U?U.ymax-U.ymin:0;N=X&&N?X/N:1;X=H.createIdentity();U&&X.translate(.5*-(U.xmax+U.xmin),.5*-(U.ymax+U.ymin));var Q=J.anchorPoint;if(Q){var P=Q.x;Q=Q.y;"Absolute"!==J.anchorPointUnits?U&&(P*=U.xmax-U.xmin,Q*=U.ymax-U.ymin):(P/=N,Q/=N);X.translate(-P,-Q)}1!==N&&X.scale(N,N);U=v.getNumericValue(J.rotation);
J.rotateClockwise&&(U=-U);this._mapRotation&&(U+=this._mapRotation);U&&X.rotate(U*G);U=v.getNumericValue(J.offsetX);N=v.getNumericValue(J.offsetY);if(U||N){if(this._mapRotation){Q=G*this._mapRotation;P=Math.cos(Q);Q=Math.sin(Q);const V=U*Q+N*P;U=U*P-N*Q;N=V}X.translate(U,N)}U=this.geomUnitsPerPoint();1!==U&&X.scale(U,U);(U=O.getAngle())&&X.rotate(U);X.translate(O.tx,O.ty);this.push(X,J.scaleSymbolsProportionally);for(const V of T)if(V?.symbol&&V.geometry||m.getLogger("esri.symbols.cim.CIMSymbolDrawHelper").error("Invalid marker graphic",
V),J=V.textString,"number"===typeof J&&(J=J.toString()),this.drawSymbol(V.symbol,V.geometry,J),this._earlyReturn)break;this.pop()}}}drawTextSymbol(J,O,T){if(J&&e.isPoint(O)&&!(0>=v.getNumericValue(J.height,w.defaultCIMValues.CIMTextSymbol.height))){var X=H.createIdentity(),U=v.getNumericValue(J.angle);(U=-U)&&X.rotate(U*G);U=v.getNumericValue(J.offsetX);var N=v.getNumericValue(J.offsetY);(U||N)&&X.translate(U,N);U=this.geomUnitsPerPoint();1!==U&&X.scale(U,U);X.translate(O.x,O.y);this.push(X,!1);this.drawText(J,
T);this.pop()}}}class K extends I{constructor(J,O){super(J,O);this.reset()}reset(){this._xmin=this._ymin=Infinity;this._xmax=this._ymax=-Infinity;this._clipCount=0}envelope(){return new y(this._xmin,this._ymin,this._xmax-this._xmin,this._ymax-this._ymin)}bounds(){return a.fromValues(this._xmin,this._ymin,this._xmax,this._ymax)}drawSolidFill(J){!J||0<this._clipCount||(e.isPolygon(J)?this._processPath(J.rings,0):e.isPolyline(J)?this._processPath(J.paths,0):e.isExtent(J)?(J=S(J))&&this._processPath(J.rings,
0):console.error("drawSolidFill Unexpected geometry type!"))}drawSolidStroke(J,O,T){!J||0<this._clipCount||null==T||0>=T||(O=Math.max(.5*this.transformSize(v.getNumericValue(T,w.defaultCIMValues.CIMSolidStroke.width)),.25),e.isPolygon(J)?this._processPath(J.rings,O):e.isPolyline(J)?this._processPath(J.paths,O):e.isExtent(J)?(J=S(J))&&this._processPath(J.rings,O):console.error("drawSolidStroke unexpected geometry type!"))}drawMarkerLayer(J,O){e.isPolygon(O)&&J.markerPlacement&&("CIMMarkerPlacementInsidePolygon"===
J.markerPlacement.type||"CIMMarkerPlacementPolygonCenter"===J.markerPlacement.type&&J.markerPlacement.clipAtBoundary)?this._processPath(O.rings,0):super.drawMarkerLayer(J,O)}drawHatchFill(J,O){this.drawSolidFill(J)}drawPictureFill(J,O){this.drawSolidFill(J)}drawGradientFill(J,O){this.drawSolidFill(J)}drawPictureStroke(J,O){this.drawSolidStroke(J,null,O.width)}drawGradientStroke(J,O){this.drawSolidStroke(J,null,O.width)}pushClipPath(J){this.drawSolidFill(J);this._clipCount++}popClipPath(){this._clipCount--}drawImage(J,
O){var {url:T}=J;J=v.getNumericValue(J.scaleX,1);let X=J*O;var U=O;T=this._resourceManager.getResource(T);null!=T&&(U=T.height/T.width,X=J*(O?1<U?O:O/U:T.width),U=O?1<U?O*U:O:T.height);this._merge(this.transformPt([-X/2,-U/2]),0);this._merge(this.transformPt([-X/2,U/2]),0);this._merge(this.transformPt([X/2,-U/2]),0);this._merge(this.transformPt([X/2,U/2]),0)}drawText(J,O){if(O&&0!==O.length){this._textRasterizer||(this._textRasterizer=new A);var T=F(J),[X,U]=this._textRasterizer.computeTextSize(O,
T);X=g.px2pt(X);U=g.px2pt(U);O=this.transformSize(1)*this.reverseTransformScalar(1);X*=O;U*=O;O=0;switch(J.horizontalAlignment){case "Left":O=X/2;break;case "Right":O=-X/2}T=0;switch(J.verticalAlignment){case "Bottom":T=U/2;break;case "Top":T=-U/2;break;case "Baseline":T=U/6}this._merge(this.transformPt([-X/2+O,-U/2+T]),0);this._merge(this.transformPt([-X/2+O,U/2+T]),0);this._merge(this.transformPt([X/2+O,-U/2+T]),0);this._merge(this.transformPt([X/2+O,U/2+T]),0)}}_processPath(J,O){if(J)for(const T of J)if(J=
T?T.length:0,1<J){this._merge(this.transformPt(T[0]),O);for(let X=1;X<J;X++)this._merge(this.transformPt(T[X]),O)}}_merge(J,O){J[0]-O<this._xmin&&(this._xmin=J[0]-O);J[0]+O>this._xmax&&(this._xmax=J[0]+O);J[1]-O<this._ymin&&(this._ymin=J[1]-O);J[1]+O>this._ymax&&(this._ymax=J[1]+O)}}class L extends I{constructor(){super(...arguments);this._searchPoint=[0,0];this._searchDistPoint=0;this._canvas=this._path=this._svg=this._textInfo=null}destroy(){this._svg=x.destroyHiddenSvg(this._svg);this._canvas=
this._path=null}hitTest(J,O,T,X,U,N){N*=g.pt2px(1);this.setTransform();this.setGeomUnitsPerPoint(N);this._searchPoint=[(J[0]+J[2])/2,(J[1]+J[3])/2];this._searchDistPoint=(J[2]-J[0])/2/N;this._textInfo=X;this._mapRotation=O&&("CIMPointSymbol"===O.type&&"Map"!==O.angleAlignment||"CIMTextSymbol"===O.type)?U:0;n("esri-mobile")||(J=g.px2pt(C.hittestToleranceSmallSymbol*window.devicePixelRatio),X=g.px2pt(C.hittestSmallSymbolThreshold),("CIMLineSymbol"!==O?.type&&"CIMPolygonSymbol"!==O?.type||!O.symbolLayers?.some(v.isCIMFill))&&
"CIMMeshSymbol"!==O?.type&&(v.getSize(O)??0)<X&&(this._searchDistPoint=J));this._earlyReturn=!1;this.drawSymbol(O,T);return this._earlyReturn}executeEffects(J,O){"CIMGeometricEffectDashes"===J.at(-1)?.type&&(J=J.slice(0,-1));return super.executeEffects(J,O)}drawSolidFill(J,O,T){null!=T?this._hittestSvgPath(J,T,!0):this._hitTestFill(J)}drawHatchFill(J,O){this._hitTestFill(J)}drawPictureFill(J,O){this._hitTestFill(J)}drawGradientFill(J,O){this._hitTestFill(J)}drawSolidStroke(J,O,T,X,U,N,Q){null!=Q?
this._hittestSvgPath(J,Q,!1,T):this._hitTestStroke(J,T)}drawPictureStroke(J,O){this._hitTestStroke(J,O.width)}drawGradientStroke(J,O){this._hitTestStroke(J,O.width)}drawMarkerLayer(J,O){J.markerPlacement&&("CIMMarkerPlacementInsidePolygon"===J.markerPlacement.type||"CIMMarkerPlacementPolygonCenter"===J.markerPlacement.type&&J.markerPlacement.clipAtBoundary)?this._hitTestFill(O):super.drawMarkerLayer(J,O)}pushClipPath(J){}popClipPath(){}drawImage(J,O){var {url:T}=J;J=v.getNumericValue(J.scaleX,1);
T=this._resourceManager.getResource(T);if(null!=T&&0!==T.height&&0!==O){O*=this.geomUnitsPerPoint();J=T.width/T.height*J*O;T=this.reverseTransformPt(this._searchPoint);var X=this._searchDistPoint;Math.abs(T[0])<J/2+X&&Math.abs(T[1])<O/2+X&&(this._earlyReturn=!0)}}drawText(J,O){if((O=this._textInfo)&&(O=O.get(J))&&O.glyphMosaicItems.glyphs.length){var T=E.roundPtToWholePixel(v.getNumericValue(J.height,w.defaultCIMValues.CIMTextSymbol.height)),{lineGapType:X,lineGap:U}=J,N=X?W(X,v.getNumericValue(U),
T):0,Q="CIMBackgroundCallout"===J.callout?.type;J=B.shapeGlyphs(O.glyphMosaicItems,{scale:T/C.glyphSize,angle:0,xOffset:0,yOffset:0,horizontalAlignment:J.horizontalAlignment,verticalAlignment:J.verticalAlignment,maxLineWidth:E.getLineWidth(J.lineWidth),lineHeight:C.magicLabelLineHeight*Math.max(.25,Math.min(N||1,4)),decoration:J.font.decoration||"none",useCIMAngleBehavior:!0,hasBackground:Q});T=this.reverseTransformPt(this._searchPoint);O=T[0];T=T[1];for(const P of J.glyphs)if(O>P.xTopLeft&&O<P.xBottomRight&&
T>-P.yBottomRight&&T<-P.yTopLeft){this._earlyReturn=!0;break}}}_hitTestFill(J){let O=null;if(e.isExtent(J))O=[[[J.xmin,J.ymin],[J.xmin,J.ymax],[J.xmax,J.ymax],[J.xmax,J.ymin],[J.xmin,J.ymin]]];else if(e.isPolygon(J))O=J.rings;else if(e.isPolyline(J))O=J.paths;else return;J=this.reverseTransformPt(this._searchPoint);let T=0;for(var X of O){const U=X.length;for(let N=1;N<U;N++){const Q=X[N-1],P=X[N];Q[1]>J[1]!==P[1]>J[1]&&(0<(P[0]-Q[0])*(J[1]-Q[1])-(P[1]-Q[1])*(J[0]-Q[0])?T++:T--)}}0!==T&&(this._earlyReturn=
!0);this._earlyReturn||(X=this.reverseTransformScalar(this._searchDistPoint)*this.prevGeomUnitsPerPoint(),D(J,O,X)&&(this._earlyReturn=!0))}_getSvgPath(){if(null==this._svg||null==this._path)this._svg??(this._svg=x.createHiddenSvg()),this._path??(this._path=x.createSvgElement("path")),this._svg.appendChild(this._path);return this._path}_getCanvas(){this._canvas??(this._canvas=document.createElement("canvas"));return this._canvas}_hittestSvgPath(J,O,T,X){var U=a.create();b.getBoundsXY(U,J);J=U[0];
var N=U[1],Q=U[2]-U[0];U=U[3]-U[1];var P=this._getSvgPath();P.setAttribute("d",O);const V=P.getBBox();Q=V.width/Q;P=V.height/U;var Z=this._getCanvas();Z.width=V.width;Z.height=V.height;Z=Z.getContext("2d",{willReadFrequently:!0});Z.setTransform(1,0,0,1,V.x,-V.y);O=new Path2D(O);T?Z.fill(O):(Z.lineWidth=X*Q,Z.stroke(O));T=this.reverseTransformScalar(this._searchDistPoint)*this.prevGeomUnitsPerPoint();X=this.reverseTransformPt(this._searchPoint);J=Z.getImageData((X[0]-J-T)*Q,(U-(X[1]-N)-T)*P,2*T*Q,
2*T*P).data;for(N=3;N<J.length;N+=4)if(127.5<J[N]){this._earlyReturn=!0;break}}_hitTestStroke(J,O){let T=null;if(e.isExtent(J))T=[[[J.xmin,J.ymin],[J.xmin,J.ymax],[J.xmax,J.ymax],[J.xmax,J.ymin],[J.xmin,J.ymin]]];else if(e.isPolygon(J))T=J.rings;else if(e.isPolyline(J))T=J.paths;else return;J=this.reverseTransformPt(this._searchPoint);O=v.getNumericValue(O,w.defaultCIMValues.CIMSolidStroke.width)*this.geomUnitsPerPoint();const X=this.reverseTransformScalar(this._searchDistPoint)*this.prevGeomUnitsPerPoint();
D(J,T,O/2+X)&&(this._earlyReturn=!0)}}class R extends I{constructor(J,O,T,X){super(O,T);this._applyAdditionalRenderProps=X;this._colorSubstitutionHelper=new f;this._ctx=J}drawSolidFill(J,O){if(J){if(e.isPolygon(J))this._buildPath(J.rings,!0);else if(e.isPolyline(J))this._buildPath(J.paths,!0);else if(e.isExtent(J))this._buildPath(S(J).rings,!0);else if(e.isMultipoint(J))console.log("CanvasDrawHelper.drawSolidFill - No implementation!");else return;J=this._ctx;J.fillStyle="string"===typeof O?O:"rgba("+
Math.round(O[0])+","+Math.round(O[1])+","+Math.round(O[2])+","+(O[3]??255)/255+")";J.fill("evenodd")}}drawSolidStroke(J,O,T,X,U,N){if(J&&O&&0!==T){if(e.isPolygon(J))this._buildPath(J.rings,!0);else if(e.isPolyline(J))this._buildPath(J.paths,!1);else if(e.isExtent(J))this._buildPath(S(J).rings,!0);else{console.log("CanvasDrawHelper.drawSolidStroke isn't implemented!");return}J=this._ctx;J.strokeStyle="string"===typeof O?O:"rgba("+Math.round(O[0])+","+Math.round(O[1])+","+Math.round(O[2])+","+(O[3]??
255)/255+")";J.lineWidth=Math.max(this.transformSize(T),.5);this._setCapStyle(X);this._setJoinStyle(U);J.miterLimit=N;J.stroke()}}pushClipPath(J){this._ctx.save();if(e.isPolygon(J))this._buildPath(J.rings,!0);else if(e.isPolyline(J))this._buildPath(J.paths,!0);else if(e.isExtent(J))this._buildPath(S(J).rings,!0);else return;this._ctx.clip("evenodd")}popClipPath(){this._ctx.restore()}drawImage(J,O){const {colorSubstitutions:T,url:X,tintColor:U}=J;J=v.getNumericValue(J.scaleX,1);var N=this._resourceManager.getResource(X);
if(null!=N){var Q=N.width/N.height*O,P=O;O||(Q=N.width,P=N.height);var V=v.isSVGImage(X)||"src"in N&&v.isSVGImage(N.src);O="getFrame"in N?u.getFirstFrame(N):N;T&&(O=this._colorSubstitutionHelper.applyColorSubstitution(O,T));this._applyAdditionalRenderProps&&!V&&U&&(O=this._colorSubstitutionHelper.tintImageData(O,U));N=this.transformPt([0,0]);var [Z,ba]=this.getTransformAngle();V=this.transformSize(1);var aa=this._ctx;aa.save();aa.setTransform({m11:J*V*Z,m12:J*V*ba,m21:-V*ba,m22:V*Z,m41:N[0],m42:N[1]});
aa.drawImage(O,-Q/2,-P/2,Q,P);aa.restore()}}drawText(J,O){if(O&&0!==O.length&&(this._textRasterizer||(this._textRasterizer=new A),J=F(J,this.transformSize(g.px2pt(1))),O=this._textRasterizer.rasterizeText(O,J))){var {size:T,anchorX:X,anchorY:U,canvas:N}=O;O=T[0]*(X+.5);J=T[1]*(U-.5);var Q=this._ctx,P=this.transformPt([0,0]),[V,Z]=this.getTransformAngle();Q.save();Q.setTransform({m11:1*V,m12:1*Z,m21:-1*Z,m22:1*V,m41:P[0]-1*O,m42:P[1]+1*J});Q.drawImage(N,0,0);Q.restore()}}drawPictureFill(J,O){if(J){var {colorSubstitutions:T,
height:X,offsetX:U,offsetY:N,rotation:Q,scaleX:P,tintColor:V,url:Z}=O;O=this._resourceManager.getResource(Z);if(null!=O){if(e.isPolygon(J))this._buildPath(J.rings,!0);else if(e.isPolyline(J))this._buildPath(J.paths,!0);else if(e.isExtent(J))this._buildPath(S(J).rings,!0);else if(e.isMultipoint(J))console.log("CanvasDrawHelper.drawPictureFill - No implementation!");else return;J=this._ctx;var ba=v.isSVGImage(Z)||"src"in O&&v.isSVGImage(O.src),aa="getFrame"in O?u.getFirstFrame(O):O;T&&(aa=this._colorSubstitutionHelper.applyColorSubstitution(aa,
T));if(this._applyAdditionalRenderProps){if(ba||V&&(aa=this._colorSubstitutionHelper.tintImageData(aa,V)),ba=J.createPattern(aa,"repeat"),aa=this.transformSize(1),Q||=0,U=U?aa*U:0,N=N?aa*N:0,X&&=aa*X,aa=X?X/O.height:1,O=P&&X?P*X/O.width:1,0!==Q||1!==aa||1!==O||0!==U||0!==N){const ca=new DOMMatrix;ca.rotateSelf(0,0,-Q).translateSelf(U,N).scaleSelf(O,aa,1);ba.setTransform(ca)}}else ba=J.createPattern(aa,"repeat");J.save();J.fillStyle=ba;J.fill("evenodd");J.restore()}}}drawPictureStroke(J,O){if(J){var {colorSubstitutions:T,
capStyle:X,joinStyle:U,miterLimit:N,tintColor:Q,url:P,width:V}=O;O=this._resourceManager.getResource(P);if(null!=O){if(e.isPolygon(J))var Z=J.rings;else if(e.isPolyline(J))Z=J.paths;else if(e.isExtent(J))Z=S(J).rings;else{e.isMultipoint(J)&&console.log("CanvasDrawHelper.drawPictureStroke - No implementation!");return}V||(V=O.width);J=v.isSVGImage(P)||"src"in O&&v.isSVGImage(O.src);var ba="getFrame"in O?u.getFirstFrame(O):O;T&&(ba=this._colorSubstitutionHelper.applyColorSubstitution(ba,T));this._applyAdditionalRenderProps&&
(J||Q&&(ba=this._colorSubstitutionHelper.tintImageData(ba,Q)));O=Math.max(this.transformSize(g.pt2px(V)),.5);J=O/ba.width;var aa=this._ctx;ba=aa.createPattern(ba,"repeat-y");aa.save();this._setCapStyle(X);this._setJoinStyle(U);void 0!==N&&(aa.miterLimit=N);aa.lineWidth=O;var ca;for(let la of Z){la=d.clone(la);var ea=ca=void 0,fa=void 0;let oa=ea=void 0;Z=la;for(var ha=Z[0],ja=1;ja<Z.length;)oa=Z[ja][0]-ha[0],ea=Z[ja][1]-ha[1],ea=0!==oa?ea/oa:Math.PI/2,void 0!==fa&&1E-4>=ea-fa?(Z.splice(ja-1,1),ha=
ca):(ca=ha,ha=Z[ja],ja++),fa=ea;if(la&&!(1>=la.length))for(Z=this.transformPt(la[0]),fa=1;fa<la.length;fa++)ca=this.transformPt(la[fa]),ha=180/Math.PI*Math.atan2(ca[1]-Z[1],ca[0]-Z[0]),ja=new DOMMatrix,ja.translateSelf(0,Z[1]-O/2).scaleSelf(J,J,1).rotateSelf(0,0,90-ha),ba.setTransform(ja),aa.strokeStyle=ba,aa.beginPath(),aa.moveTo(Z[0],Z[1]),aa.lineTo(ca[0],ca[1]),aa.stroke(),Z=ca}aa.restore()}}}_buildPath(J,O){const T=this._ctx;T.beginPath();if(J)for(const X of J)if(J=X?X.length:0,1<J){let U=this.transformPt(X[0]);
T.moveTo(U[0],U[1]);for(let N=1;N<J;N++)U=this.transformPt(X[N]),T.lineTo(U[0],U[1]);O&&T.closePath()}}_setCapStyle(J){switch(J){case z.LineCapStyle.Butt:this._ctx.lineCap="butt";break;case z.LineCapStyle.Round:this._ctx.lineCap="round";break;case z.LineCapStyle.Square:this._ctx.lineCap="square"}}_setJoinStyle(J){switch(J){case z.LineJoinStyle.Bevel:this._ctx.lineJoin="bevel";break;case z.LineJoinStyle.Round:this._ctx.lineJoin="round";break;case z.LineJoinStyle.Miter:this._ctx.lineJoin="miter"}}}
const S=J=>J?{spatialReference:J.spatialReference,rings:[[[J.xmin,J.ymin],[J.xmin,J.ymax],[J.xmax,J.ymax],[J.xmax,J.ymin],[J.xmin,J.ymin]]]}:null,W=(J,O,T)=>{switch(J){case "ExtraLeading":return 1+O/T;case "Multiple":return O;case "Exact":return O/T}};l.CIMSymbolDrawHelper=I;l.CanvasDrawHelper=R;l.EnvDrawHelper=K;l.HittestDrawHelper=L;l.Transformation=H;l.cDegToRad=G;l.lineGapType2LineHeight=W;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/GeometryCursor":function(){define(["exports",
"../core/lang","./geometryCursorCollectUtils","./support/jsonUtils","../layers/graphics/OptimizedGeometry"],function(l,q,n,d,m){function h(e){if(d.isPolygon(e))e=[e.rings,"esriGeometryPolygon"];else if(d.isPolyline(e))e=[e.paths,"esriGeometryPolyline"];else if(d.isMultipoint(e))e=[[e.points],"esriGeometryMultipoint"];else if(d.isExtent(e))e=[[[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]]],"esriGeometryEnvelope"];else if(d.isPoint(e)){const r=[e.x,e.y];e.z&&r.push(e.z);
e.m&&r.push(e.m);e=[[[r]],"esriGeometryPoint"]}else e=[[],"esriGeometryPolyline"];return e}class g{static fromOptimized(e,r,f=!1,p=!1,t=1){return(new c).initialize(e,r,f,p,t)}static fromJSON(e,r=!1,f=!1){const [p,t]=h(e);return(new a).initialize(p,t,r,f,1)}static fromOptimizedCIM(e,r,f=!1,p=!1,t=1){return(new b).initialize(e,r,f,p,t)}static fromJSONCIM(e,r=!1,f=!1,p=1){const [t,w]=h(e);return(new k).initialize(t,w,r,f,p)}static fromFeatureSetReader(e){const r=e.readGeometryForDisplay();e=e.geometryType;
return r&&e?this.fromOptimized(r,e):null}static fromFeatureSetReaderCIM(e){const r=e.readGeometryForDisplay();e=e.geometryType;return r&&e?this.fromOptimizedCIM(r,e):null}static createEmptyOptimized(e,r=!1,f=!1,p=1){return(new c).initialize(new m,e,r,f,p)}static createEmptyJSON(e,r=!1,f=!1){return(new a).initialize([],e,r,f,1)}static createEmptyOptimizedCIM(e,r=!1,f=!1,p=1){return(new b).initialize(new m,e,r,f,p)}static createEmptyJSONCIM(e,r=!1,f=!1,p=1){return(new k).initialize([],e,r,f,p)}asJSON(){const e=
n.collectMultipath(this);return"esriGeometryEnvelope"===this.geometryType?{xmin:e[0][0][0],ymin:e[0][0][1],xmax:e[0][2][0],ymax:e[0][2][1]}:"esriGeometryMultipoint"===this.geometryType?{points:e.flat()}:"esriGeometryPoint"===this.geometryType?{x:e[0][0][0],y:e[0][0][1]}:"esriGeometryPolygon"===this.geometryType?{rings:e}:{paths:e}}getCurrentRingArea(){if(3>this.pathSize)return 0;let e=0,r,f;this.seekPathStart();if(!this.nextPoint())return 0;r=this.x;f=this.y;const p=r,t=f;for(;this.nextPoint();)e+=
(r-this.x)*(f+this.y),r=this.x,f=this.y;return-.5*(e+(r-p)*(f+t))}invertY(){this.yFactor*=-1}}class c extends g{constructor(){super(...arguments);this._end=-1}initialize(e,r,f,p,t){this.hasZ=f;this.hasM=p;this.geometryType=r;this._stride=2+Number(f)+Number(p);this._geometry=e;this._pathIndex=-1;this._pathOffset=0;this._pointOffset=-this._stride;this._end=-1;this.yFactor=t;return this}reset(){this.initialize(this._geometry,this.geometryType,this.hasZ,this.hasM,this.yFactor)}seekPath(e){if(0<=e&&e<
this.totalSize){if(this._pathIndex<e)for(;this._pathIndex<e&&this.nextPath(););else if(this._pathIndex>e)for(;this._pathIndex>e&&this.prevPath(););return!0}return!1}seekPathStart(){this._pointOffset=this._pathOffset-this._stride}seekPathEnd(){this._pointOffset=this._end}seekInPath(e){e=this._pathOffset+e*this._stride;return 0<=e&&e<this._end?(this._pointOffset=e,!0):!1}nextPoint(){return(this._pointOffset+=this._stride)<this._end}prevPoint(){return(this._pointOffset-=this._stride)>=this._pathOffset}nextPath(){if(this.pathIndex>=
this.totalSize-1)return!1;0<=this._pathIndex&&(this._pathOffset+=this._stride*this.pathSize);this._pathIndex++;this._pointOffset=this._pathOffset-this._stride;this._end=this._pointOffset+this._stride+this._stride*this.pathSize;return!0}prevPath(){if(0>=this.pathIndex)return!1;this._pathIndex--;this._end=this._pathOffset;this._pathOffset-=this._stride*this.pathSize;this._pointOffset=this._pathOffset-this._stride;return!0}getCurrentPath(){const e=this._end,r=this._geometry.coords,f=this._pathOffset;
return(new c).initialize(new m([this.pathSize],r.slice(f,e)),this.geometryType,this.hasZ,this.hasM,this.yFactor)}pathLength(){const e=this._end,r=this._stride,f=this._geometry.coords;let p=0;for(let t=this._pathOffset+r;t<e;t+=r){const w=f[t]-f[t-r],z=f[t+1]-f[t-r+1];p+=Math.sqrt(w*w+z*z)}return p}startPath(){this._geometry.lengths.push(0)}pushPath(e){this.startPath();this.pushPoints(e)}pushPoint(e){for(let r=0;r<this._stride;++r)this._geometry.coords.push(e[r]);this._geometry.lengths[this.totalSize-
1]++}pushXY(e,r){this._geometry.coords.push(e,r);this._geometry.lengths[this.totalSize-1]++}pushPoints(e){for(const r of e)for(let f=0;f<this._stride;++f)this._geometry.coords.push(r[f]);this._geometry.lengths[this.totalSize-1]+=e.length}pushCursor(e){e=e.asOptimized();this._geometry.coords.push(...e.coords);this._geometry.lengths.push(...e.lengths)}asOptimized(){const e=this._geometry.clone();if(1!==this.yFactor)for(let r=1;r<e.coords.length;r+=this._stride)e.coords[r]*=this.yFactor;"esriGeometryPoint"===
this.geometryType&&(e.lengths.length=0);return e}isClosed(){const e=this._geometry.coords,r=this._pathOffset,f=this._end-this._stride;for(let p=0;p<this._stride;p++)if(e[r+p]!==e[f+p])return!1;return!0}clone(){return(new c).initialize(this._geometry.clone(),this.geometryType,this.hasZ,this.hasM,this.yFactor)}get totalPoints(){return this._geometry.isPoint?1:this._geometry.lengths.reduce((e,r)=>e+r)}get pathSize(){const {lengths:e}=this._geometry;return this._geometry.isPoint?1:0>this._pathIndex||
this._pathIndex>e.length-1?0:e[this._pathIndex]}get totalSize(){return this._geometry.isPoint?1:this._geometry.lengths.length}get x(){return this._geometry.coords[this._pointOffset]}set x(e){this._geometry.coords[this._pointOffset]=e}get y(){return this.yFactor*this._geometry.coords[this._pointOffset+1]}set y(e){this._geometry.coords[this._pointOffset+1]=this.yFactor*e}get z(){return this._geometry.coords[this._pointOffset+2]}set z(e){this._geometry.coords[this._pointOffset+2]=e}get m(){return this._geometry.coords[this._pointOffset+
(this.hasZ?3:2)]}set m(e){this._geometry.coords[this._pointOffset+3]=e}get pathIndex(){return this._pathIndex}get _coordIndex(){return this._pointOffset/this._stride}}class a extends g{initialize(e,r,f,p,t){this._paths=e;this.geometryType=r;this.hasZ=f;this.hasM=p;this._pathIndex=this._pointIndex=-1;this.yFactor=t;this._mIndex=this.hasZ?3:2;return this}reset(){this._pathIndex=this._pointIndex=-1}seekPath(e){this._pathIndex=e;this._pointIndex=-1;return 0<=e&&e<this.totalSize?(this._currentPath=this._paths[e],
!0):!1}seekPathStart(){this._pointIndex=-1}seekPathEnd(){this._pointIndex=this._currentPath.length}seekInPath(e){return 0<=e&&e<this._currentPath.length?(this._pointIndex=e,this._currentPoint=this._currentPath[this._pointIndex],!0):!1}nextPoint(){this._currentPoint=this._currentPath[++this._pointIndex];return this._pointIndex<this._currentPath.length}prevPoint(){this._currentPoint=this._currentPath[--this._pointIndex];return 0<=this._pointIndex}nextPath(){this._pointIndex=-1;this._currentPath=this._paths[++this._pathIndex];
return this._pathIndex<this.totalSize}prevPath(){return 0<this.pathIndex?(this._pointIndex=-1,this._pathIndex--,this._currentPath=this._paths[this._pathIndex],!0):!1}pathLength(){const e=this._currentPath.length,r=this._currentPath;let f=0;for(let t=1;t<e;t++){var p=r[t-1];const w=r[t],z=w[0]-p[0];p=w[1]-p[1];f+=Math.sqrt(z*z+p*p)}return f}startPath(){this._paths.push([])}getCurrentPath(){return(new a).initialize([this._currentPath],this.geometryType,this.hasZ,this.hasM,this.yFactor)}pushPath(e){this._paths.push(e)}pushPoint(e){this._paths[this.totalSize-
1].push(e)}pushXY(e,r){this._paths[this.totalSize-1].push([e,r])}pushPoints(e){this._paths[this.totalSize-1].push(...e)}pushCursor(e){e=n.collectMultipath(e);for(const r of e)this.pushPath(r)}asOptimized(){const e=new m;if("esriGeometryPoint"===this.geometryType)e.coords.push(...this._paths[0][0]),e.lengths.length=0;else for(const r of this._paths){for(const f of r)e.coords.push(f[0]),e.coords.push(f[1]*this.yFactor),this.hasZ&&e.coords.push(f[2]),this.hasM&&e.coords.push(f[this._mIndex]);e.lengths.push(r.length)}return e}isClosed(){const e=
this._currentPath[0],r=this._currentPath[this._currentPath.length-1];for(let f=0;f<e.length;f++)if(e[f]!==r[f])return!1;return!0}clone(){return(new a).initialize(q.clone(this._paths),this.geometryType,this.hasZ,this.hasM,this.yFactor)}get totalPoints(){return this._paths.map(e=>e.length).reduce((e,r)=>e+r)}get pathSize(){return 0>this._pathIndex||this._pathIndex>this.totalSize-1?-1:this._paths[this._pathIndex].length}get totalSize(){return this._paths.length}get x(){return this._currentPoint[0]}set x(e){this._currentPoint[0]=
e}get y(){return this.yFactor*this._currentPoint[1]}set y(e){this._currentPoint[1]=this.yFactor*e}get z(){return this._currentPoint[2]}set z(e){this._currentPoint[2]=e}get m(){return this._currentPoint[this._mIndex]}set m(e){this._currentPoint[this._mIndex]=e}get pathIndex(){return this._pathIndex}}class b extends c{initialize(e,r,f,p,t){super.initialize(e,r,f,p,t);this._controlPoints||(this._controlPoints=this._controlPoints=Array(this.totalSize).fill(void 0).map(w=>new Set));return this}startPath(){super.startPath();
this._controlPoints.push(new Set)}clone(){const e=(new b).initialize(this._geometry.clone(),this.geometryType,this.hasZ,this.hasM,this.yFactor);e._controlPoints=this._controlPoints;return e}setControlPoint(){this._controlPoints[this.pathIndex].add(this._coordIndex)}getControlPoint(){return this._controlPoints[this.pathIndex].has(this._coordIndex)}setControlPointAt(e){this._controlPoints[this.pathIndex].add(e)}getControlPointAt(e){return this._controlPoints[this.pathIndex].has(e)}}class k extends a{initialize(e,
r,f,p,t){return super.initialize(e,r,f,p,t)}clone(){return(new k).initialize(q.clone(this._paths),this.geometryType,this.hasZ,this.hasM,this.yFactor)}setControlPoint(){this._paths[this.pathIndex][this._pointIndex][4]=1}getControlPoint(){return 1===this._paths[this.pathIndex][this._pointIndex][4]}setControlPointAt(e){this._paths[this.pathIndex][e][4]=1}getControlPointAt(e){return 1===this._paths[this.pathIndex][e][4]}}l.GeometryCursor=g;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},
"esri/symbols/cim/CIMEffects":function(){define(["exports","../../geometry/GeometryCursor","../../geometry/support/TileClipper"],function(l,q,n){let d;class m{constructor(h){this._geometry=h}next(){const h=this._geometry;this._geometry=null;return h}}l.SimpleEffectCursor=m;l.clipCursorToTileExtent=function(h,g){d||=new n.TileClipper(0,0,0,1);var c="esriGeometryPolygon"===h.geometryType;const a=c?3:2;d.reset(c?n.GeometryType.Polygon:n.GeometryType.LineString);d.setPixelMargin(g+1);d.setExtent(512);
let b;for(;h.nextPath();)if(!(h.pathSize<a)){h.nextPoint();g=h.x;b=-h.y;for(d.moveTo(g,b);h.nextPoint();)g=h.x,b=-h.y,d.lineTo(g,b);c&&d.close()}if(c=d.result(!1)){h=q.GeometryCursor.createEmptyOptimizedCIM(h.geometryType);for(const k of c){h.startPath();for(const e of k)h.pushXY(e.x,-e.y)}h.reset();return h}return null};Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/TileClipper":function(){define(["exports"],function(l){l.GeometryType=void 0;(function(a){a[a.Unknown=
0]="Unknown";a[a.Point=1]="Point";a[a.LineString=2]="LineString";a[a.Polygon=3]="Polygon"})(l.GeometryType||(l.GeometryType={}));class q{constructor(a,b){this.x=a;this.y=b}clone(){return new q(this.x,this.y)}equals(a,b){return a===this.x&&b===this.y}isEqual(a){return a.x===this.x&&a.y===this.y}setCoords(a,b){this.x=a;this.y=b;return this}normalize(){var a=this.x;const b=this.y;a=Math.sqrt(a*a+b*b);this.x/=a;this.y/=a;return this}rightPerpendicular(){const a=this.x;this.x=this.y;this.y=-a;return this}leftPerpendicular(){const a=
this.x;this.x=-this.y;this.y=a;return this}move(a,b){this.x+=a;this.y+=b;return this}assign(a){this.x=a.x;this.y=a.y;return this}assignAdd(a,b){this.x=a.x+b.x;this.y=a.y+b.y;return this}assignSub(a,b){this.x=a.x-b.x;this.y=a.y-b.y;return this}rotate(a,b){const k=this.x,e=this.y;this.x=k*a-e*b;this.y=k*b+e*a;return this}scale(a){this.x*=a;this.y*=a;return this}length(){const a=this.x,b=this.y;return Math.sqrt(a*a+b*b)}sub(a){this.x-=a.x;this.y-=a.y;return this}add(a){this.x+=a.x;this.y+=a.y;return this}static distance(a,
b){const k=b.x-a.x;a=b.y-a.y;return Math.sqrt(k*k+a*a)}static add(a,b){return new q(a.x+b.x,a.y+b.y)}static sub(a,b){return new q(a.x-b.x,a.y-b.y)}}class n{constructor(a,b,k){this.ratio=a;this.x=b;this.y=k}}class d{constructor(a,b,k,e=8,r=8){this._lines=[];this._starts=[];this.validateTessellation=!0;this._pixelRatio=e;this._pixelMargin=r;this._tileSize=512*e;this._dz=a;this._yPos=b;this._xPos=k}setPixelMargin(a){a!==this._pixelMargin&&(this._pixelMargin=a,this.setExtent(this._extent))}setExtent(a){this._extent=
a;this._finalRatio=this._tileSize/a*(1<<this._dz);let b=this._pixelRatio*this._pixelMargin;b/=this._finalRatio;a>>=this._dz;b>a&&(b=a);this._margin=b;this._xmin=a*this._xPos-b;this._ymin=a*this._yPos-b;this._xmax=this._xmin+a+2*b;this._ymax=this._ymin+a+2*b}reset(a){this._type=a;this._lines=[];this._starts=[];this._line=null;this._start=0}moveTo(a,b){this._pushLine();this._prevIsIn=this._isIn(a,b);this._moveTo(a,b,this._prevIsIn);this._prevPt=new q(a,b);this._firstPt=new q(a,b);this._dist=0}lineTo(a,
b){const k=this._isIn(a,b),e=new q(a,b),r=q.distance(this._prevPt,e);if(k)if(this._prevIsIn)this._lineTo(a,b,!0);else{var f=this._prevPt;var p=e;a=this._intersect(p,f);this._start=this._dist+r*(1-this._r);this._lineTo(a.x,a.y,!0);this._lineTo(p.x,p.y,!0)}else if(this._prevIsIn)p=this._prevPt,f=e,a=this._intersect(p,f),this._lineTo(a.x,a.y,!0),this._lineTo(f.x,f.y,!1);else{const w=this._prevPt;if(!(w.x<=this._xmin&&e.x<=this._xmin||w.x>=this._xmax&&e.x>=this._xmax||w.y<=this._ymin&&e.y<=this._ymin||
w.y>=this._ymax&&e.y>=this._ymax)){a=[];if(w.x<this._xmin&&e.x>this._xmin||w.x>this._xmin&&e.x<this._xmin){b=(this._xmin-w.x)/(e.x-w.x);var t=w.y+b*(e.y-w.y);t<=this._ymin?p=!1:t>=this._ymax?p=!0:a.push(new n(b,this._xmin,t))}if(w.x<this._xmax&&e.x>this._xmax||w.x>this._xmax&&e.x<this._xmax)b=(this._xmax-w.x)/(e.x-w.x),t=w.y+b*(e.y-w.y),t<=this._ymin?p=!1:t>=this._ymax?p=!0:a.push(new n(b,this._xmax,t));if(w.y<this._ymin&&e.y>this._ymin||w.y>this._ymin&&e.y<this._ymin)b=(this._ymin-w.y)/(e.y-w.y),
t=w.x+b*(e.x-w.x),t<=this._xmin?f=!1:t>=this._xmax?f=!0:a.push(new n(b,t,this._ymin));if(w.y<this._ymax&&e.y>this._ymax||w.y>this._ymax&&e.y<this._ymax)b=(this._ymax-w.y)/(e.y-w.y),t=w.x+b*(e.x-w.x),t<=this._xmin?f=!1:t>=this._xmax?f=!0:a.push(new n(b,t,this._ymax));if(0===a.length)f?p?this._lineTo(this._xmax,this._ymax,!0):this._lineTo(this._xmax,this._ymin,!0):p?this._lineTo(this._xmin,this._ymax,!0):this._lineTo(this._xmin,this._ymin,!0);else if(1<a.length&&a[0].ratio>a[1].ratio)this._start=this._dist+
r*a[1].ratio,this._lineTo(a[1].x,a[1].y,!0),this._lineTo(a[0].x,a[0].y,!0);else for(this._start=this._dist+r*a[0].ratio,f=0;f<a.length;f++)this._lineTo(a[f].x,a[f].y,!0)}this._lineTo(e.x,e.y,!1)}this._dist+=r;this._prevIsIn=k;this._prevPt=e}close(){if(2<this._line.length){var a=this._firstPt,b=this._prevPt;a.x===b.x&&a.y===b.y||this.lineTo(a.x,a.y);a=this._line;for(b=a.length;4<=b;)if(a[0].x===a[1].x&&a[0].x===a[b-2].x||a[0].y===a[1].y&&a[0].y===a[b-2].y)a.pop(),a[0].x=a[b-2].x,a[0].y=a[b-2].y,--b;
else break}}result(a=!0){this._pushLine();if(0===this._lines.length)return null;this._type===l.GeometryType.Polygon&&a&&g.simplify(this._tileSize,this._margin*this._finalRatio,this._lines);return this._lines}resultWithStarts(){if(this._type!==l.GeometryType.LineString)throw Error("Only valid for lines");this._pushLine();const a=this._lines,b=a.length;if(0===b)return null;const k=[];for(let e=0;e<b;e++)k.push({line:a[e],start:this._starts[e]||0});return k}_isIn(a,b){return a>=this._xmin&&a<=this._xmax&&
b>=this._ymin&&b<=this._ymax}_intersect(a,b){let k,e,r;if(b.x>=this._xmin&&b.x<=this._xmax)e=b.y<=this._ymin?this._ymin:this._ymax,r=(e-a.y)/(b.y-a.y),k=a.x+r*(b.x-a.x);else if(b.y>=this._ymin&&b.y<=this._ymax)k=b.x<=this._xmin?this._xmin:this._xmax,r=(k-a.x)/(b.x-a.x),e=a.y+r*(b.y-a.y);else{e=b.y<=this._ymin?this._ymin:this._ymax;k=b.x<=this._xmin?this._xmin:this._xmax;const f=(k-a.x)/(b.x-a.x),p=(e-a.y)/(b.y-a.y);f<p?(r=f,e=a.y+f*(b.y-a.y)):(r=p,k=a.x+p*(b.x-a.x))}this._r=r;return new q(k,e)}_pushLine(){this._line&&
(this._type===l.GeometryType.Point?0<this._line.length&&(this._lines.push(this._line),this._starts.push(this._start)):this._type===l.GeometryType.LineString?1<this._line.length&&(this._lines.push(this._line),this._starts.push(this._start)):this._type===l.GeometryType.Polygon&&3<this._line.length&&(this._lines.push(this._line),this._starts.push(this._start)));this._line=[];this._start=0}_moveTo(a,b,k){this._type!==l.GeometryType.Polygon?k&&(a=Math.round((a-(this._xmin+this._margin))*this._finalRatio),
b=Math.round((b-(this._ymin+this._margin))*this._finalRatio),this._line.push(new q(a,b))):(k||(a<this._xmin&&(a=this._xmin),a>this._xmax&&(a=this._xmax),b<this._ymin&&(b=this._ymin),b>this._ymax&&(b=this._ymax)),a=Math.round((a-(this._xmin+this._margin))*this._finalRatio),b=Math.round((b-(this._ymin+this._margin))*this._finalRatio),this._line.push(new q(a,b)),this._isV=this._isH=!1)}_lineTo(a,b,k){if(this._type!==l.GeometryType.Polygon)if(k){a=Math.round((a-(this._xmin+this._margin))*this._finalRatio);
b=Math.round((b-(this._ymin+this._margin))*this._finalRatio);if(0<this._line.length&&(k=this._line[this._line.length-1],k.equals(a,b)))return;this._line.push(new q(a,b))}else this._line&&0<this._line.length&&this._pushLine();else if(k||(a<this._xmin&&(a=this._xmin),a>this._xmax&&(a=this._xmax),b<this._ymin&&(b=this._ymin),b>this._ymax&&(b=this._ymax)),a=Math.round((a-(this._xmin+this._margin))*this._finalRatio),b=Math.round((b-(this._ymin+this._margin))*this._finalRatio),this._line&&0<this._line.length){k=
this._line[this._line.length-1];const e=k.x===a,r=k.y===b;e&&r||(this._isH&&e?(k.x=a,k.y=b,k=this._line[this._line.length-2],k.x===a&&k.y===b?(this._line.pop(),1>=this._line.length?this._isV=this._isH=!1:(k=this._line[this._line.length-2],this._isH=k.x===a,this._isV=k.y===b)):(this._isH=k.x===a,this._isV=k.y===b)):this._isV&&r?(k.x=a,k.y=b,k=this._line[this._line.length-2],k.x===a&&k.y===b?(this._line.pop(),1>=this._line.length?this._isV=this._isH=!1:(k=this._line[this._line.length-2],this._isH=k.x===
a,this._isV=k.y===b)):(this._isH=k.x===a,this._isV=k.y===b)):(this._line.push(new q(a,b)),this._isH=e,this._isV=r))}else this._line.push(new q(a,b))}}class m{setExtent(a){this._ratio=4096===a?1:4096/a}get validateTessellation(){return 1>this._ratio}reset(a){this._lines=[];this._line=null}moveTo(a,b){this._line&&this._lines.push(this._line);this._line=[];const k=this._ratio;this._line.push(new q(a*k,b*k))}lineTo(a,b){const k=this._ratio;this._line.push(new q(a*k,b*k))}close(){const a=this._line;a&&
!a[0].isEqual(a[a.length-1])&&a.push(a[0])}result(){this._line&&this._lines.push(this._line);return 0===this._lines.length?null:this._lines}}var h;(function(a){a[a.sideLeft=0]="sideLeft";a[a.sideRight=1]="sideRight";a[a.sideTop=2]="sideTop";a[a.sideBottom=3]="sideBottom"})(h||={});class g{static simplify(a,b,k){if(k){var e=-b,r=a+b,f=-b,p=a+b;a=[];b=[];var t=k.length;for(let w=0;w<t;++w){const z=k[w];if(!z||2>z.length)continue;let u=z[0],y;const A=z.length;for(let v=1;v<A;++v)y=z[v],u.x===y.x&&(u.x<=
e&&(u.y>y.y?(a.push(w),a.push(v),a.push(h.sideLeft),a.push(-1)):(b.push(w),b.push(v),b.push(h.sideLeft),b.push(-1))),u.x>=r&&(u.y<y.y?(a.push(w),a.push(v),a.push(h.sideRight),a.push(-1)):(b.push(w),b.push(v),b.push(h.sideRight),b.push(-1)))),u.y===y.y&&(u.y<=f&&(u.x<y.x?(a.push(w),a.push(v),a.push(h.sideTop),a.push(-1)):(b.push(w),b.push(v),b.push(h.sideTop),b.push(-1))),u.y>=p&&(u.x>y.x?(a.push(w),a.push(v),a.push(h.sideBottom),a.push(-1)):(b.push(w),b.push(v),b.push(h.sideBottom),b.push(-1)))),
u=y}0!==a.length&&0!==b.length&&(g.fillParent(k,b,a),g.fillParent(k,a,b),e=[],g.calcDeltas(e,b,a),g.calcDeltas(e,a,b),g.addDeltas(e,k))}}static fillParent(a,b,k){const e=k.length,r=b.length;for(let z=0;z<r;z+=4){var f=b[z],p=b[z+1];const u=b[z+2],y=a[f][p-1];f=a[f][p];p=8092;let A=-1;for(let v=0;v<e;v+=4){if(k[v+2]!==u)continue;var t=k[v];const x=k[v+1];var w=a[t][x-1];t=a[t][x];switch(u){case h.sideLeft:case h.sideRight:c(y.y,w.y,t.y)&&c(f.y,w.y,t.y)&&(w=Math.abs(t.y-w.y),w<p&&(p=w,A=v));break;case h.sideTop:case h.sideBottom:c(y.x,
w.x,t.x)&&c(f.x,w.x,t.x)&&(w=Math.abs(t.x-w.x),w<p&&(p=w,A=v))}}b[z+3]=A}}static calcDeltas(a,b,k){const e=b.length;for(let r=0;r<e;r+=4){const f=g.calcDelta(r,b,k,[]);a.push(b[r]);a.push(b[r+1]);a.push(b[r+2]);a.push(f)}}static calcDelta(a,b,k,e){a=b[a+3];if(-1===a)return 0;const r=e.length;if(1<r&&e[r-2]===a)return 0;e.push(a);return g.calcDelta(a,k,b,e)+1}static addDeltas(a,b){const k=a.length;let e=0;for(var r=0;r<k;r+=4){var f=a[r+3];f>e&&(e=f)}for(r=0;r<k;r+=4){f=b[a[r]];const p=a[r+1],t=e-
a[r+3];switch(a[r+2]){case h.sideLeft:f[p-1].x-=t;f[p].x-=t;1===p&&(f[f.length-1].x-=t);p===f.length-1&&(f[0].x-=t);break;case h.sideRight:f[p-1].x+=t;f[p].x+=t;1===p&&(f[f.length-1].x+=t);p===f.length-1&&(f[0].x+=t);break;case h.sideTop:f[p-1].y-=t;f[p].y-=t;1===p&&(f[f.length-1].y-=t);p===f.length-1&&(f[0].y-=t);break;case h.sideBottom:f[p-1].y+=t,f[p].y+=t,1===p&&(f[f.length-1].y+=t),p===f.length-1&&(f[0].y+=t)}}}}const c=(a,b,k)=>a>=b&&a<=k||a>=k&&a<=b;l.Point=q;l.SimpleBuilder=m;l.TileClipper=
d;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/CIMImageColorSubstitutionHelper":function(){define(function(){class l{applyColorSubstitution(q,n){if(!n)return q;this._rasterizationCanvas||(this._rasterizationCanvas=document.createElement("canvas"));const {width:d,height:m}=q,h=this._rasterizationCanvas,g=h.getContext("2d",{willReadFrequently:!0});q!==h&&(h.width=d,h.height=m,g.drawImage(q,0,0,d,m));q=g.getImageData(0,0,d,m).data;if(n)for(var c of n)if(c&&c.oldColor&&
4===c.oldColor.length&&c.newColor&&4===c.newColor.length){const [a,b,k,e]=c.oldColor,[r,f,p,t]=c.newColor;if(a!==r||b!==f||k!==p||e!==t)for(n=0;n<q.length;n+=4)a===q[n]&&b===q[n+1]&&k===q[n+2]&&e===q[n+3]&&(q[n]=r,q[n+1]=f,q[n+2]=p,q[n+3]=t)}c=new ImageData(q,d,m);g.putImageData(c,0,0);return h}tintImageData(q,n){if(!n||4>n.length)return q;this._rasterizationCanvas||(this._rasterizationCanvas=document.createElement("canvas"));const {width:d,height:m}=q,h=this._rasterizationCanvas,g=h.getContext("2d",
{willReadFrequently:!0});q!==h&&(h.width=d,h.height=m,g.drawImage(q,0,0,d,m));q=g.getImageData(0,0,d,m);q=new Uint8Array(q.data);n=[n[0]/255,n[1]/255,n[2]/255,n[3]/255];for(let c=0;c<q.length;c+=4)q[c]*=n[0],q[c+1]*=n[1],q[c+2]*=n[2],q[c+3]*=n[3];n=new ImageData(new Uint8ClampedArray(q.buffer),d,m);g.putImageData(n,0,0);return h}}return l})},"esri/symbols/cim/CIMOperators":function(){define("exports ./effects/EffectAddControlPoints ./effects/EffectArrow ./effects/EffectBuffer ./effects/EffectControlMeasureLine ./effects/EffectCut ./effects/EffectDashes ./effects/EffectDonut ./effects/EffectJog ./effects/EffectMove ./effects/EffectOffset ./effects/EffectReverse ./effects/EffectRotate ./effects/EffectScale ./effects/EffectWave ./placements/PlacementAlongLineSameSize ./placements/PlacementAtExtremities ./placements/PlacementAtRatioPositions ./placements/PlacementInsidePolygon ./placements/PlacementOnLine ./placements/PlacementOnVertices ./placements/PlacementPolygonCenter".split(" "),
function(l,q,n,d,m,h,g,c,a,b,k,e,r,f,p,t,w,z,u,y,A,v){l.getEffectOperator=function(x){if(!x)return null;switch(x.type){case "CIMGeometricEffectAddControlPoints":return q.EffectAddControlPoints.local();case "CIMGeometricEffectArrow":return n.EffectArrow.local();case "CIMGeometricEffectBuffer":return d.EffectBuffer.local();case "CIMGeometricEffectControlMeasureLine":return m.EffectControlMeasureLine.local();case "CIMGeometricEffectCut":return h.EffectCut.local();case "CIMGeometricEffectDashes":return g.EffectDashes.local();
case "CIMGeometricEffectDonut":return c.EffectDonut.local();case "CIMGeometricEffectJog":return a.EffectJog.local();case "CIMGeometricEffectMove":return b.EffectMove.local();case "CIMGeometricEffectOffset":return k.EffectOffset.local();case "CIMGeometricEffectReverse":return e.EffectReverse.local();case "CIMGeometricEffectRotate":return r.EffectRotate.local();case "CIMGeometricEffectScale":return f.EffectScale.local();case "CIMGeometricEffectWave":return p.EffectWave.local()}return null};l.getPlacementOperator=
function(x){if(!x)return null;switch(x.type){case "CIMMarkerPlacementAlongLineSameSize":return t.PlacementAlongLineSameSize.local();case "CIMMarkerPlacementAtExtremities":return w.PlacementAtExtremities.local();case "CIMMarkerPlacementAtRatioPositions":return z.PlacementAtRatioPositions.local();case "CIMMarkerPlacementInsidePolygon":return u.PlacementInsidePolygon.local();case "CIMMarkerPlacementOnLine":return y.PlacementOnLine.local();case "CIMMarkerPlacementOnVertices":return A.PlacementOnVertices.local();
case "CIMMarkerPlacementPolygonCenter":return v.PlacementPolygonCenter.local()}return null};Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/effects/EffectAddControlPoints":function(){define(["exports"],function(l){class q{static local(){null===q.instance&&(q.instance=new q);return q.instance}execute(d,m,h,g,c){return new n(d,m,h)}}q.instance=null;class n{constructor(d,m,h){this._inputGeometries=d;this._angleTolerance=void 0!==m.angleTolerance?m.angleTolerance:120;
this._maxCosAngle=Math.cos((1-Math.abs(this._angleTolerance)/180)*Math.PI)}next(){let d=this._inputGeometries.next();for(;d;){if("esriGeometryPolygon"===d.geometryType)this._isClosed=!0;else if("esriGeometryPolyline"===d.geometryType)this._isClosed=!1;else if("esriGeometryEnvelope"===d.geometryType){if(this._maxCosAngle)return d;this._isClosed=!0}else{d=this._inputGeometries.next();continue}for(;d.nextPath();)this._processPath(d);d.reset();return d}return null}_processPath(d){if(d.nextPoint()){const m=
d.x,h=d.y;let g=m,c=h,a=d.pathSize,b=0,k=0,e=0,r=0,f=0,p=0;this._isClosed&&++a;for(let t=1;d.nextPoint()||t<a;++t){let w,z;this._isClosed&&t===a-1?(w=m,z=h):(w=d.x,z=d.y);const u=w-g,y=z-c,A=Math.sqrt(u*u+y*y);1<t&&0<A&&0<e&&(b*u+k*y)/A/e<=this._maxCosAngle&&d.setControlPointAt(t-1);1===t&&(r=u,f=y,p=A);0<A&&(g=w,c=z,b=u,k=y,e=A)}this._isClosed&&0<e&&0<p&&(b*r+k*f)/p/e<=this._maxCosAngle&&d.setControlPointAt(0)}}}l.EffectAddControlPoints=q;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},
"esri/symbols/cim/effects/EffectArrow":function(){define("exports ../../../geometry/GeometryCursor ../../../geometry/geometryCursorCollectUtils ../CIMCursor ../CurveHelper ../enums".split(" "),function(l,q,n,d,m,h){const g=h.GeometricEffectArrowType.OpenEnded;class c{static local(){null===c.instance&&(c.instance=new c);return c.instance}execute(b,k,e,r,f){return new a(b,k,e)}}c.instance=null;class a extends d.PathEffectCursor{constructor(b,k,e){super(b,!1,!0);this._curveHelper=new m.CurveHelper;this._width=
(void 0!==k.width?k.width:5)*e;this._arrowType=void 0!==k.geometricEffectArrowType?k.geometricEffectArrowType:void 0!==k.arrowType?k.arrowType:g;this._offsetFlattenError=m.pixelTolerance*e}processPath(b){const k=q.GeometryCursor.createEmptyOptimizedCIM(b.geometryType);switch(this._arrowType){default:this._constructSimpleArrow(k,b,!0);break;case h.GeometricEffectArrowType.Block:this._constructSimpleArrow(k,b,!1);break;case h.GeometricEffectArrowType.Crossed:this._constructCrossedArrow(k,b)}return k}_constructSimpleArrow(b,
k,e){var r=k.pathLength(),f=this._width;r<2*f&&(f=r/2);var p=this._curveHelper.getSubCurve(k,0,r-f);if(p&&p.nextPath()&&(p.seekPathStart(),r=f/2,!this._curveHelper.isEmpty(p)&&(p=n.collectPath(p),f=this._constructOffset(p,-r)))&&(p=this._constructOffset(p,r))){var t=this._constructArrowBasePoint(f,-r/2);t&&(r=this._constructArrowBasePoint(p,r/2))&&(k.seekInPath(k.pathSize-1),k=[k.x,k.y],b.pushPath(p),b.nextPath(),b.nextPoint(),b.setControlPoint(),b.pushPoint(r),b.nextPoint(),b.setControlPoint(),b.pushPoint(k),
b.nextPoint(),b.setControlPoint(),b.pushPoint(t),b.nextPoint(),b.setControlPoint(),b.pushPoints(f.reverse()),b.setControlPoint(),e||(b.setControlPointAt(0),b.setControlPointAt(b.pathSize-1),b.pushPoint(p[0])),b.reset())}}_constructCrossedArrow(b,k){var e=k.pathLength(),r=this._width;e<3.732050807568877*r&&(r=e/3.732050807568877);k.seekPathStart();var f=this._curveHelper.getSubCurve(k,0,e-2.732050807568877*r);if(f){f.nextPath();var p=r/2;if(!this._curveHelper.isEmpty(f)){var t=n.collectPath(f);if(f=
this._constructOffset(t,p))if(t=this._constructOffset(t,-p))if(e=this._curveHelper.getSubCurve(k,0,e-r))if(e.nextPath(),!this._curveHelper.isEmpty(e)&&(e=n.collectPath(e),r=this._constructOffset(e,p))){var w=this._constructOffset(e,-p);if(w&&(e=r[r.length-1],r=this._constructArrowBasePoint(r,p/2))){var z=w[w.length-1];if(p=this._constructArrowBasePoint(w,-p/2))k.seekInPath(k.pathSize-1),k=[k.x,k.y],b.pushPath(f),b.nextPath(),b.nextPoint(),b.setControlPoint(),b.pushPoint(z),b.nextPoint(),b.setControlPoint(),
b.pushPoint(p),b.nextPoint(),b.setControlPoint(),b.pushPoint(k),b.nextPoint(),b.setControlPoint(),b.pushPoint(r),b.nextPoint(),b.setControlPoint(),b.pushPoint(e),b.nextPoint(),b.setControlPoint(),b.pushPoints(t.reverse()),b.nextPoint(),b.setControlPoint(),b.reset()}}}}}_constructOffset(b,k){return this._curveHelper.offset(b,k,h.GeometricEffectOffsetMethod.Rounded,4,this._offsetFlattenError)}_constructArrowBasePoint(b,k){if(!b||2>b.length)return null;var e=b[b.length-2];b=b[b.length-1];e=[b[0]-e[0],
b[1]-e[1]];this._curveHelper.normalize(e);return[b[0]+e[1]*k,b[1]-e[0]*k]}}l.EffectArrow=c;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/CIMCursor":function(){define(["exports","./CIMPlacements"],function(l,q){class n{constructor(m,h=!0,g=!0,c=0){this.isClosed=!1;this.geometryCursor=null;this.geometryCursor=!h&&"esriGeometryPolygon"===m.geometryType||!g&&"esriGeometryPolyline"===m.geometryType?null:m;this.geomUnitsPerPoint=c;this.iteratePath=this.iterateMultiPath=
!1;this.internalPlacement=new q.Placement}next(){if(!this.geometryCursor)return null;const m=this.processMultiPath(this.geometryCursor);this.iterateMultiPath&&m||(this.geometryCursor=null);return m}processMultiPath(m){for(;this.iteratePath||m.pathIndex<m.totalSize-1;){this.iteratePath||m.nextPath();this.iterateMultiPath=!0;const h=this.processPath(m);if(h)return h}this.iterateMultiPath=!1;return null}}class d{constructor(m,h,g,c=0){this.isClosed=!1;this.inputGeometries=m;this.acceptPolygon=h;this.acceptPolyline=
g;this.geomUnitsPerPoint=c;this.iteratePath=!1;this.multiPathCursor=null}next(){for(;;){if(!this.multiPathCursor){for(var m=this.inputGeometries.next();m&&!(this.isClosed=this.acceptPolygon&&"esriGeometryPolygon"===m.geometryType||"esriGeometryEnvelope"===m.geometryType,this.multiPathCursor=m);)m=this.inputGeometries.next();if(!this.multiPathCursor)return null}for(;this.iteratePath||this.multiPathCursor.nextPath();)if(this.multiPathCursor.seekPathStart(),m=this.processPath(this.multiPathCursor))return m;
this.multiPathCursor=null}}}l.PathEffectCursor=d;l.PathTransformationCursor=n;l.getId=function(m){return m[4]};l.setId=function(m,h){m[4]=h};Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/CurveHelper":function(){define(["exports","../../geometry/GeometryCursor","./enums"],function(l,q,n){class d{constructor(m,h){}isEmpty(m){if(!m.nextPoint())return!0;let h,g,c,a;h=m.x;for(g=m.y;m.nextPoint();h=g,g=a)if(c=m.x,a=m.y,c!==h||a!==g)return m.seekPathStart(),!1;m.seekPathStart();
return!0}normalize(m){const h=Math.sqrt(m[0]*m[0]+m[1]*m[1]);0!==h&&(m[0]/=h,m[1]/=h)}getLength(m,h,g,c){m=g-m;h=c-h;return Math.sqrt(m*m+h*h)}getSegLength(m){const [[h,g],[c,a]]=m;return this.getLength(h,g,c,a)}getCoord2D(m,h,g,c,a){return[m+(g-m)*a,h+(c-h)*a]}getSegCoord2D(m,h){const [[g,c],[a,b]]=m;return this.getCoord2D(g,c,a,b,h)}getAngle(m,h,g,c,a){return Math.atan2(c-h,g-m)}getAngleCS(m,h,g,c,a){m=g-m;h=c-h;c=Math.sqrt(m*m+h*h);return 0<c?[m/c,h/c]:[1,0]}getSegAngleCS(m,h){const [[g,c],[a,
b]]=m;return this.getAngleCS(g,c,a,b,h)}cut(m,h,g,c,a,b){a=0>=a?[m,h]:this.getCoord2D(m,h,g,c,a);m=1<=b?[g,c]:this.getCoord2D(m,h,g,c,b);return[a,m]}getSubCurve(m,h,g){const c=q.GeometryCursor.createEmptyOptimizedCIM("esriGeometryPolyline");return this.appendSubCurve(c,m,h,g)?c:null}appendSubCurve(m,h,g,c){m.startPath();h.seekPathStart();let a=0;var b=!0;if(!h.nextPoint())return!1;var k=h.x;let e=h.y;for(;h.nextPoint();){const r=this.getLength(k,e,h.x,h.y);if(0!==r){if(b){if(a+r>g){const f=(g-a)/
r;let p=1;b=!1;a+r>=c&&(p=(c-a)/r,b=!0);(k=this.cut(k,e,h.x,h.y,f,p))&&m.pushPoints(k);if(b)break;b=!1}}else{if(a+r>c){(h=this.cut(k,e,h.x,h.y,0,(c-a)/r))&&m.pushPoint(h[1]);break}m.pushXY(h.x,h.y)}a+=r}k=h.x;e=h.y}return!0}getCIMPointAlong(m,h){if(!m.nextPoint())return null;let g=0,c,a,b,k;c=m.x;for(a=m.y;m.nextPoint();c=b,a=k){b=m.x;k=m.y;const e=this.getLength(c,a,b,k);if(0!==e){if(g+e>h)return this.getCoord2D(c,a,b,k,(h-g)/e);g+=e}}return null}offset(m,h,g,c,a){if(!m||2>m.length)return null;var b=
0,k=m[b++];for(a=b;b<m.length;){var e=m[b];if(e[0]!==k[0]||e[1]!==k[1])b!==a&&(m[a]=m[b]),k=m[a++];b++}(b=m[0][0]===m[a-1][0]&&m[0][1]===m[a-1][1])&&--a;if(a<(b?3:2))return null;e=[];k=b?m[a-1]:null;let r=m[0];for(let z=0;z<a;z++){const u=z===a-1?b?m[0]:null:m[z+1];if(k)if(u){var f=[u[0]-r[0],u[1]-r[1]];this.normalize(f);var p=[r[0]-k[0],r[1]-k[1]];this.normalize(p);var t=p[0]*f[1]-p[1]*f[0],w=p[0]*f[0]+p[1]*f[1];if(0===t&&1===w){r=u;continue}if(0<=t===0>=h)1>w&&(f=[f[0]-p[0],f[1]-p[1]],this.normalize(f),
p=Math.sqrt((1+w)/2),p>1/c&&(p=-Math.abs(h)/p,e.push([r[0]-f[0]*p,r[1]-f[1]*p])));else switch(g){case n.GeometricEffectOffsetMethod.Mitered:if(k=Math.sqrt((1+w)/2),0<k&&1/k<c){f=[f[0]-p[0],f[1]-p[1]];this.normalize(f);p=Math.abs(h)/k;e.push([r[0]-f[0]*p,r[1]-f[1]*p]);break}case n.GeometricEffectOffsetMethod.Bevelled:e.push([r[0]+p[1]*h,r[1]-p[0]*h]);e.push([r[0]+f[1]*h,r[1]-f[0]*h]);break;case n.GeometricEffectOffsetMethod.Rounded:if(1>w){e.push([r[0]+p[1]*h,r[1]-p[0]*h]);k=Math.floor(2.5*(1-w));
if(0<k){t=w=1/k;for(let y=1;y<k;y++,t+=w){const A=[p[1]*(1-t)+f[1]*t,-p[0]*(1-t)-f[0]*t];this.normalize(A);e.push([r[0]+A[0]*h,r[1]+A[1]*h])}}e.push([r[0]+f[1]*h,r[1]-f[0]*h])}break;default:0>t?(e.push([r[0]+(p[1]+p[0])*h,r[1]+(p[1]-p[0])*h]),e.push([r[0]+(f[1]-f[0])*h,r[1]-(f[0]+f[1])*h])):(k=Math.sqrt((1+Math.abs(w))/2),f=[f[0]-p[0],f[1]-p[1]],this.normalize(f),p=h/k,e.push([r[0]-f[0]*p,r[1]-f[1]*p]))}}else f=[r[0]-k[0],r[1]-k[1]],this.normalize(f),e.push([r[0]+f[1]*h,r[1]-f[0]*h]);else f=[u[0]-
r[0],u[1]-r[1]],this.normalize(f),e.push([r[0]+f[1]*h,r[1]-f[0]*h]);k=r;r=u}if(e.length<(b?3:2))return null;b&&e.push([e[0][0],e[0][1]]);return e}}l.CurveHelper=d;l.pixelTolerance=.03;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/effects/EffectBuffer":function(){define("exports ../../../geometry ../../../geometry/GeometryCursor ../../../geometry/geometryCursorCollectUtils ../CIMEffects ../CurveHelper ../enums ../../../geometry/SpatialReference".split(" "),function(l,
q,n,d,m,h,g,c){class a{static local(){null===a.instance&&(a.instance=new a);return a.instance}execute(k,e,r,f,p,t){return new b(k,e,r,f,p,t)}}a.instance=null;class b{constructor(k,e,r,f,p,t){this._inputGeometries=k;this._tileKey=f;this._geometryEngine=p;this._curveHelper=new h.CurveHelper;this._size=(void 0!==e.size?e.size:1)*r;this._maxInflateSize=t*r;this._offsetFlattenError=h.pixelTolerance*r}next(){for(var k;k=this._inputGeometries.next();){if(0===this._size)return k;if("esriGeometryEnvelope"===
k.geometryType)if(0<this._size){var e=n.GeometryCursor.createEmptyOptimizedCIM(k.geometryType),r=d.collectMultipath(k)[0];if(r=this._curveHelper.offset(r,this._size,g.GeometricEffectOffsetMethod.Rounded,4,this._offsetFlattenError))return e.pushPath(r),e}else if(0>this._size&&(e=k.asJSON(),0<Math.min(e.xmax-e.xmin,e.ymax-e.ymin)+2*this._size))return n.GeometryCursor.fromJSONCIM({xmin:e.xmin-this._size,xmax:e.xmax+this._size,ymin:e.ymin-this._size,ymax:e.ymax+this._size});e=this._geometryEngine;if(null==
e)break;if(k=this._tileKey?m.clipCursorToTileExtent(k,this._maxInflateSize):k)return(k=e.buffer(c.WebMercator,k.asJSON(),this._size,1))?n.GeometryCursor.fromJSONCIM(k):null}return null}}l.EffectBuffer=a;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/effects/EffectControlMeasureLine":function(){define("exports ../../../geometry/GeometryCursor ../../../geometry/geometryCursorCollectUtils ../../../geometry/support/coordsUtils ../CIMCursor ../enums".split(" "),function(l,
q,n,d,m,h){class g{static local(){null===g.instance&&(g.instance=new g);return g.instance}execute(a,b,k,e,r){return new c(a,b,k)}}g.instance=null;class c{constructor(a,b,k){this._defaultPointSize=20;this._inputGeometries=a;this._geomUnitsPerPoint=k;this._rule=b.rule??h.GeometricEffectControlMeasureLineRule.FullGeometry;this._defaultSize=this._defaultPointSize*k}next(){for(var a;a=this._inputGeometries.next();)if(a=this._processGeom(n.collectMultipath(a)),a?.length)return q.GeometryCursor.fromJSONCIM({paths:a});
return null}_clone(a){return[a[0],a[1]]}_mid(a,b){return[(a[0]+b[0])/2,(a[1]+b[1])/2]}_mix(a,b,k,e){return[a[0]*b+k[0]*e,a[1]*b+k[1]*e]}_add(a,b){return[a[0]+b[0],a[1]+b[1]]}_add2(a,b,k){return[a[0]+b,a[1]+k]}_sub(a,b){return[a[0]-b[0],a[1]-b[1]]}_dist(a,b){return Math.sqrt((a[0]-b[0])*(a[0]-b[0])+(a[1]-b[1])*(a[1]-b[1]))}_norm(a){return Math.sqrt(a[0]*a[0]+a[1]*a[1])}_normalize(a,b=1){b/=this._norm(a);a[0]*=b;a[1]*=b}_leftPerpendicular(a){const b=a[0];a[0]=-a[1];a[1]=b}_leftPerp(a){return[-a[1],
a[0]]}_rightPerpendicular(a){const b=-a[0];a[0]=a[1];a[1]=b}_rightPerp(a){return[a[1],-a[0]]}_dotProduct(a,b){return a[0]*b[0]+a[1]*b[1]}_crossProduct(a,b){return a[0]*b[1]-a[1]*b[0]}_rotateDirect(a,b,k){const e=a[0]*k+a[1]*b;a[0]=a[0]*b-a[1]*k;a[1]=e}_makeCtrlPt(a){a=[a[0],a[1]];m.setId(a,1);return a}_addAngledTicks(a,b,k,e){const r=this._sub(k,b);this._normalize(r);var f=this._crossProduct(r,this._sub(e,b));e=0<f?this._rightPerp(r):this._leftPerp(r);f=Math.abs(f)/2;const p=[];p.push([b[0]+(e[0]-
r[0])*f,b[1]+(e[1]-r[1])*f]);p.push(b);p.push(k);p.push([k[0]+(e[0]+r[0])*f,k[1]+(e[1]+r[1])*f]);a.push(p)}_addBezier2(a,b,k,e,r){if(0===r--)a.push(e);else{var f=this._mid(b,k);k=this._mid(k,e);var p=this._mid(f,k);this._addBezier2(a,b,f,p,r);this._addBezier2(a,p,k,e,r)}}_addBezier3(a,b,k,e,r,f){if(0===f--)a.push(r);else{var p=this._mid(b,k),t=this._mid(k,e);e=this._mid(e,r);k=this._mid(p,t);t=this._mid(t,e);var w=this._mid(k,t);this._addBezier3(a,b,p,k,w,f);this._addBezier3(a,w,t,e,r,f)}}_add90DegArc(a,
b,k,e,r){e=r??0<this._crossProduct(this._sub(k,b),this._sub(e,b));r=this._mid(b,k);const f=this._sub(r,b);e?this._leftPerpendicular(f):this._rightPerpendicular(f);r[0]+=f[0];r[1]+=f[1];this._addBezier3(a,b,this._mix(b,.33333,r,.66667),this._mix(k,.33333,r,.66667),k,4)}_addArrow(a,b,k){var e=b[0],r=b[1],f=b[b.length-1],p=this._sub(e,r),t=this._norm(p);this._normalize(p);const w=Math.abs(this._crossProduct(p,this._sub(f,r)));f=this._dotProduct(p,this._sub(f,r));f<.05*t?f=.05*t:f>.95*t&&(f=.95*t);t=
.5*w;var z=this._leftPerp(p);f=[r[0]+p[0]*f,r[1]+p[1]*f];var u=b.length-1;r=[];r.push(k?[-z[0],-z[1]]:z);var y=[-p[0],-p[1]];for(k=1;k<u-1;k++){p=this._sub(b[k+1],b[k]);this._normalize(p);var A=this._dotProduct(p,y);z=this._crossProduct(p,y);A=Math.sqrt((1+A)/2);y=this._sub(p,y);this._normalize(y);y[0]/=A;y[1]/=A;r.push(0>z?[-y[0],-y[1]]:y);y=p}r.push(this._rightPerp(y));for(u=r.length-1;0<u;u--)a.push([b[u][0]+r[u][0]*t,b[u][1]+r[u][1]*t]);a.push([f[0]+r[0][0]*t,f[1]+r[0][1]*t]);a.push([f[0]+r[0][0]*
w,f[1]+r[0][1]*w]);a.push(e);a.push([f[0]-r[0][0]*w,f[1]-r[0][1]*w]);a.push([f[0]-r[0][0]*t,f[1]-r[0][1]*t]);for(e=1;e<r.length;e++)a.push([b[e][0]-r[e][0]*t,b[e][1]-r[e][1]*t])}_addDash(a,b,k){const e=this._norm(k)/7;this._normalize(k);let r=[];for(let f=0;7>=f;f++)r.push([b[0]+k[0]*f*e,b[1]+k[1]*f*e]),f&1&&(a.push(r),r=[])}_cp2(a,b,k){return 2<=a.length?a[1]:this._add2(a[0],b*this._defaultSize,k*this._defaultSize)}_cp3(a,b,k,e){if(3<=a.length)return a[2];k=this._mix(a[0],1-k,b,k);a=this._sub(b,
a[0]);this._normalize(a);this._rightPerpendicular(a);return[k[0]+a[0]*e*this._defaultSize,k[1]+a[1]*e*this._defaultSize]}_arrowPath(a){if(2<a.length)return a;const b=a[0];a=this._cp2(a,-4,0);const k=this._sub(b,a);this._normalize(k);const e=this._rightPerp(k);return[b,a,[b[0]+(e[0]-k[0])*this._defaultSize,b[1]+(e[1]-k[1])*this._defaultSize]]}_arrowLastSeg(a){var b=a[0];const k=this._cp2(a,-4,0);if(3<=a.length)b=a[a.length-1];else{a=this._sub(b,k);this._normalize(a);const e=this._rightPerp(a);b=[b[0]+
(e[0]-a[0])*this._defaultSize,b[1]+(e[1]-a[1])*this._defaultSize]}return[k,b]}_processGeom(a){if(!a)return null;const b=[];for(const k of a){const e=1<k.length&&d.getPathLength(k)<this._defaultSize;if(!k||0===k.length||e)continue;const r=k.length;let f=k[0];switch(this._rule){case h.GeometricEffectControlMeasureLineRule.PerpendicularFromFirstSegment:const p=this._cp2(k,0,-1),t=this._cp3(k,p,.5,4),w=[];w.push(t);w.push(this._mid(f,p));b.push(w);break;case h.GeometricEffectControlMeasureLineRule.ReversedFirstSegment:const z=
this._cp2(k,0,-1);b.push([z,f]);break;case h.GeometricEffectControlMeasureLineRule.PerpendicularToSecondSegment:if(3>k.length)return[];const u=this._cp2(k,-4,1),y=this._cp3(k,u,.882353,-1.94),A=[];A.push(this._mid(u,y));A.push(f);b.push(A);break;case h.GeometricEffectControlMeasureLineRule.SecondSegmentWithTicks:if(3>k.length)return[];const v=this._cp2(k,-4,1),x=this._cp3(k,v,.882353,-1.94),C=this._sub(x,v);let B;B=0<this._crossProduct(C,this._sub(f,v))?this._rightPerp(C):this._leftPerp(C);const E=
[];E.push([v[0]+(B[0]-C[0])/3,v[1]+(B[1]-C[1])/3]);E.push(v);E.push(x);E.push([x[0]+(B[0]+C[0])/3,x[1]+(B[1]+C[1])/3]);b.push(E);break;case h.GeometricEffectControlMeasureLineRule.DoublePerpendicular:const D=this._cp2(k,0,-1),F=this._cp3(k,D,.5,3),G=this._mid(f,D),H=this._sub(G,F);this._normalize(H);const I=this._crossProduct(H,this._sub(f,F));this._leftPerpendicular(H);const K=[];K.push(f);K.push([F[0]+H[0]*I,F[1]+H[1]*I]);b.push(K);const L=[];L.push([F[0]-H[0]*I,F[1]-H[1]*I]);L.push(D);b.push(L);
break;case h.GeometricEffectControlMeasureLineRule.OppositeToFirstSegment:const R=this._cp2(k,0,-1),S=this._cp3(k,R,.5,3),W=this._mid(f,R),J=this._sub(W,S);this._normalize(J);const O=this._crossProduct(J,this._sub(f,S));this._leftPerpendicular(J);const T=[];T.push([S[0]+J[0]*O,S[1]+J[1]*O]);T.push([S[0]-J[0]*O,S[1]-J[1]*O]);b.push(T);break;case h.GeometricEffectControlMeasureLineRule.TriplePerpendicular:const X=this._cp2(k,0,-1),U=this._cp3(k,X,.5,4),N=this._mid(f,X),Q=this._sub(N,U);this._normalize(Q);
const P=this._crossProduct(Q,this._sub(f,U));this._leftPerpendicular(Q);const V=[];V.push([U[0]+Q[0]*P*.8,U[1]+Q[1]*P*.8]);V.push([N[0]+.8*(f[0]-N[0]),N[1]+.8*(f[1]-N[1])]);b.push(V);b.push([U,N]);const Z=[];Z.push([U[0]-Q[0]*P*.8,U[1]-Q[1]*P*.8]);Z.push([N[0]+.8*(X[0]-N[0]),N[1]+.8*(X[1]-N[1])]);b.push(Z);break;case h.GeometricEffectControlMeasureLineRule.HalfCircleFirstSegment:const ba=this._cp2(k,0,-1),aa=this._cp3(k,ba,.5,4),ca=this._mid(f,ba);let ea=this._sub(ba,f);const fa=Math.cos(Math.PI/
18),ha=Math.sin(Math.PI/18),ja=Math.sqrt((1+fa)/2),la=Math.sqrt((1-fa)/2),oa=[];let ra;0<this._crossProduct(ea,this._sub(aa,f))?(oa.push(f),ea=this._sub(f,ca),ra=ba):(oa.push(ba),ea=this._sub(ba,ca),ra=f);this._rotateDirect(ea,ja,la);ea[0]/=ja;ea[1]/=ja;for(let ka=1;18>=ka;ka++)oa.push(this._add(ca,ea)),this._rotateDirect(ea,fa,ha);oa.push(ra);b.push(oa);break;case h.GeometricEffectControlMeasureLineRule.HalfCircleSecondSegment:const qa=this._cp2(k,0,-1),Da=this._cp3(k,qa,1,-1);let sa=this._sub(f,
qa);this._normalize(sa);const M=this._crossProduct(sa,this._sub(Da,qa))/2;this._leftPerpendicular(sa);const Y=[qa[0]+sa[0]*M,qa[1]+sa[1]*M];sa=this._sub(qa,Y);const da=Math.cos(Math.PI/18);let ia=Math.sin(Math.PI/18);0<M&&(ia=-ia);const na=[qa];for(let ka=1;18>=ka;ka++)this._rotateDirect(sa,da,ia),na.push(this._add(Y,sa));b.push(na);break;case h.GeometricEffectControlMeasureLineRule.HalfCircleExtended:const wa=this._cp2(k,0,-2),za=this._cp3(k,wa,1,-1);let db;if(4<=r)db=k[3];else{const ka=this._sub(f,
wa);db=this._add(za,ka)}const Cb=this._dist(wa,za)/2/.75,lc=this._sub(wa,f);this._normalize(lc,Cb);const mc=this._sub(za,db);this._normalize(mc,Cb);b.push([db,za]);const Ub=[this._clone(za)];this._addBezier3(Ub,za,this._add(za,mc),this._add(wa,lc),wa,4);Ub.push(f);b.push(Ub);break;case h.GeometricEffectControlMeasureLineRule.OpenCircle:const nc=this._cp2(k,-2,0),oc=this._sub(nc,f),Uc=Math.cos(Math.PI/18),Vc=-Math.sin(Math.PI/18),xd=[nc];for(let ka=1;33>=ka;ka++)this._rotateDirect(oc,Uc,Vc),xd.push(this._add(f,
oc));b.push(xd);break;case h.GeometricEffectControlMeasureLineRule.CoverageEdgesWithTicks:const eb=this._cp2(k,0,-1);let pb;if(3<=r)pb=k[2];else{const ka=this._sub(eb,f),pa=this._leftPerp(ka);pb=[f[0]+pa[0]-.25*ka[0],f[1]+pa[1]-.25*ka[1]]}let pc;if(4<=r)pc=k[3];else{const ka=this._mid(f,eb),pa=this._sub(f,eb);this._normalize(pa);this._leftPerpendicular(pa);const ua=this._crossProduct(pa,this._sub(pb,ka));this._rightPerpendicular(pa);pc=[pb[0]+pa[0]*ua*2,pb[1]+pa[1]*ua*2]}const Ra=this._sub(eb,f);
let Db,Sa;Db=0<this._crossProduct(Ra,this._sub(pb,f))?this._rightPerp(Ra):this._leftPerp(Ra);Sa=[];Sa.push(pb);Sa.push(f);Sa.push([f[0]+(Db[0]-Ra[0])/3,f[1]+(Db[1]-Ra[1])/3]);b.push(Sa);Db=0<this._crossProduct(Ra,this._sub(pc,eb))?this._rightPerp(Ra):this._leftPerp(Ra);Sa=[];Sa.push([eb[0]+(Db[0]+Ra[0])/3,eb[1]+(Db[1]+Ra[1])/3]);Sa.push(eb);Sa.push(pc);b.push(Sa);break;case h.GeometricEffectControlMeasureLineRule.GapExtentWithDoubleTicks:const qc=this._cp2(k,0,2),Wc=this._cp3(k,qc,0,1);let rc;if(4<=
r)rc=k[3];else{const ka=this._sub(qc,f);rc=this._add(Wc,ka)}this._addAngledTicks(b,f,qc,this._mid(Wc,rc));this._addAngledTicks(b,Wc,rc,this._mid(f,qc));break;case h.GeometricEffectControlMeasureLineRule.GapExtentMidline:const Xc=this._cp2(k,2,0),yd=this._cp3(k,Xc,0,1);let Yc;if(4<=r)Yc=k[3];else{const ka=this._sub(Xc,f);Yc=this._add(yd,ka)}const Zc=[];Zc.push(this._mid(f,yd));Zc.push(this._mid(Xc,Yc));b.push(Zc);break;case h.GeometricEffectControlMeasureLineRule.Chevron:const zd=this._cp2(k,-1,-1);
let $c;if(3<=r)$c=k[2];else{const ka=this._sub(zd,f);this._leftPerpendicular(ka);$c=this._add(f,ka)}b.push([zd,this._makeCtrlPt(f),$c]);break;case h.GeometricEffectControlMeasureLineRule.PerpendicularWithArc:const Eb=this._cp2(k,0,-2),Ad=this._cp3(k,Eb,.5,-1),Ea=this._sub(Eb,f),Ta=this._norm(Ea);Ea[0]/=Ta;Ea[1]/=Ta;const qb=this._crossProduct(Ea,this._sub(Ad,f));let Fb=this._dotProduct(Ea,this._sub(Ad,f));Fb<.05*Ta?Fb=.05*Ta:Fb>.95*Ta&&(Fb=.95*Ta);const sc=[f[0]+Ea[0]*Fb,f[1]+Ea[1]*Fb];let Fa=this._leftPerp(Ea),
Gb=[];Gb.push([sc[0]-Fa[0]*qb,sc[1]-Fa[1]*qb]);Gb.push([sc[0]+Fa[0]*qb,sc[1]+Fa[1]*qb]);b.push(Gb);if(4<=r){const ka=k[3];let pa=this._dotProduct(Ea,this._sub(ka,f));pa<.1*Ta?pa=.1*Ta:pa>.9*Ta&&(pa=.9*Ta);const ua=[f[0]+Ea[0]*pa,f[1]+Ea[1]*pa],Ga=this._crossProduct(Ea,this._sub(ka,f)),ad=[];ad.push([ua[0]-Fa[0]*Ga,ua[1]-Fa[1]*Ga]);ad.push([ua[0]+Fa[0]*Ga,ua[1]+Fa[1]*Ga]);b.push(ad)}const Bd=[Eb[0]+Fa[0]*qb,Eb[1]+Fa[1]*qb];Fa=this._sub(Eb,Bd);const ge=Math.cos(Math.PI/18);let bd=Math.sin(Math.PI/18);
0>qb&&(bd=-bd);Gb=[f,Eb];for(let ka=1;9>=ka;ka++)this._rotateDirect(Fa,ge,bd),Gb.push(this._add(Bd,Fa));b.push(Gb);break;case h.GeometricEffectControlMeasureLineRule.ClosedHalfCircle:const cd=this._cp2(k,2,0),Cd=this._mid(f,cd),Dd=this._sub(cd,Cd),he=Math.cos(Math.PI/18),ie=Math.sin(Math.PI/18),Ed=[f,cd];for(let ka=1;18>=ka;ka++)this._rotateDirect(Dd,he,ie),Ed.push(this._add(Cd,Dd));b.push(Ed);break;case h.GeometricEffectControlMeasureLineRule.TripleParallelExtended:const rb=this._cp2(k,0,-2),dd=
this._cp3(k,rb,1,-2),sb=this._mid(f,rb),Ua=this._sub(dd,rb);this._normalize(Ua);const Fd=Math.abs(this._crossProduct(Ua,this._sub(sb,rb)))/2,Hb=this._dist(rb,dd),Gd=[rb,f];Gd.push([f[0]+Ua[0]*Hb*.5,f[1]+Ua[1]*Hb*.5]);b.push(Gd);const Ib=[];Ib.push([sb[0]-Ua[0]*Fd,sb[1]-Ua[1]*Fd]);Ib.push([sb[0]+Ua[0]*Hb*.375,sb[1]+Ua[1]*Hb*.375]);m.setId(Ib[Ib.length-1],1);Ib.push([sb[0]+Ua[0]*Hb*.75,sb[1]+Ua[1]*Hb*.75]);b.push(Ib);b.push([rb,dd]);break;case h.GeometricEffectControlMeasureLineRule.ParallelWithTicks:const Vb=
this._cp2(k,3,0),ed=this._cp3(k,Vb,.5,-1),Wb=this._sub(ed,Vb);this._normalize(Wb);const Hd=this._crossProduct(Wb,this._sub(ed,f));this._leftPerpendicular(Wb);this._addAngledTicks(b,f,Vb,ed);this._addAngledTicks(b,this._mix(f,1,Wb,Hd),this._mix(Vb,1,Wb,Hd),this._mid(f,Vb));break;case h.GeometricEffectControlMeasureLineRule.Parallel:const Xb=this._cp2(k,3,0),je=this._cp3(k,Xb,.5,-1),fd=this._sub(Xb,f);this._normalize(fd);const tc=this._leftPerp(fd),uc=this._crossProduct(fd,this._sub(je,f));let Yb=[f,
Xb];b.push(Yb);Yb=[];Yb.push([f[0]+tc[0]*uc,f[1]+tc[1]*uc]);Yb.push([Xb[0]+tc[0]*uc,Xb[1]+tc[1]*uc]);b.push(Yb);break;case h.GeometricEffectControlMeasureLineRule.PerpendicularToFirstSegment:const gd=this._cp2(k,3,0),ke=this._cp3(k,gd,.5,-1),vc=this._mid(f,gd),tb=this._sub(gd,f);this._normalize(tb);const wc=this._crossProduct(tb,this._sub(ke,f));this._leftPerpendicular(tb);const hd=[];hd.push([vc[0]-tb[0]*wc*.25,vc[1]-tb[1]*wc*.25]);hd.push([vc[0]+tb[0]*wc*1.25,vc[1]+tb[1]*wc*1.25]);b.push(hd);break;
case h.GeometricEffectControlMeasureLineRule.ParallelOffset:const Jb=this._cp2(k,3,0),le=this._cp3(k,Jb,.5,-1),Ja=this._sub(Jb,f);this._normalize(Ja);const fb=this._crossProduct(Ja,this._sub(le,f));this._leftPerpendicular(Ja);const id=[];id.push([f[0]-Ja[0]*fb,f[1]-Ja[1]*fb]);id.push([Jb[0]-Ja[0]*fb,Jb[1]-Ja[1]*fb]);b.push(id);const jd=[];jd.push([f[0]+Ja[0]*fb,f[1]+Ja[1]*fb]);jd.push([Jb[0]+Ja[0]*fb,Jb[1]+Ja[1]*fb]);b.push(jd);break;case h.GeometricEffectControlMeasureLineRule.OffsetOpposite:const xc=
this._cp2(k,3,0),me=this._cp3(k,xc,.5,-1),ub=this._sub(xc,f);this._normalize(ub);const yc=this._crossProduct(ub,this._sub(me,f));this._leftPerpendicular(ub);const kd=[];kd.push([f[0]-ub[0]*yc,f[1]-ub[1]*yc]);kd.push([xc[0]-ub[0]*yc,xc[1]-ub[1]*yc]);b.push(kd);break;case h.GeometricEffectControlMeasureLineRule.OffsetSame:const zc=this._cp2(k,3,0),ne=this._cp3(k,zc,.5,-1),vb=this._sub(zc,f);this._normalize(vb);const Ac=this._crossProduct(vb,this._sub(ne,f));this._leftPerpendicular(vb);const ld=[];ld.push([f[0]+
vb[0]*Ac,f[1]+vb[1]*Ac]);ld.push([zc[0]+vb[0]*Ac,zc[1]+vb[1]*Ac]);b.push(ld);break;case h.GeometricEffectControlMeasureLineRule.CircleWithArc:let gb=this._cp2(k,3,0);const md=this._cp3(k,gb,.5,-1);let Kb,Bc;if(4<=r)Kb=k[3],Bc=0<this._crossProduct(this._sub(Kb,gb),this._sub(md,gb));else{Kb=gb;Bc=0<this._crossProduct(this._sub(Kb,f),this._sub(md,f));const ka=24*this._geomUnitsPerPoint,pa=this._sub(Kb,f);this._normalize(pa,ka);const ua=Math.sqrt(2)/2;this._rotateDirect(pa,ua,Bc?ua:-ua);gb=this._add(f,
pa)}const Id=this._sub(gb,f),oe=Math.cos(Math.PI/18),pe=Math.sin(Math.PI/18),Zb=[gb];for(let ka=1;36>=ka;ka++)this._rotateDirect(Id,oe,pe),Zb.push(this._add(f,Id));this._add90DegArc(Zb,gb,Kb,md,Bc);m.setId(Zb[Zb.length-8],1);b.push(Zb);break;case h.GeometricEffectControlMeasureLineRule.DoubleJog:let hb=this._cp2(k,-3,1),wb=this._cp3(k,hb,-1,-.5),Za;if(4<=r)Za=k[3];else{const ka=f;f=hb;Za=wb;const pa=this._dist(f,ka),ua=this._dist(Za,ka);let Ga=30*this._geomUnitsPerPoint;.5*pa<Ga&&(Ga=.5*pa);.5*ua<
Ga&&(Ga=.5*ua);hb=this._mix(f,Ga/pa,ka,(pa-Ga)/pa);wb=this._mix(Za,Ga/ua,ka,(ua-Ga)/ua)}const Jd=this._mid(f,hb),Kd=this._mid(Za,wb),qe=this._dist(f,hb),re=this._dist(wb,Za);let Cc=Math.min(qe,re)/8;Cc=Math.min(Cc,24*this._geomUnitsPerPoint);const ib=Math.cos(Math.PI/4);let Ha=this._sub(f,hb);this._normalize(Ha,Cc);0<this._crossProduct(Ha,this._sub(Za,hb))?this._rotateDirect(Ha,ib,-ib):this._rotateDirect(Ha,ib,ib);let Ka=[];Ka.push(hb);Ka.push(this._add(Jd,Ha));Ka.push(this._sub(Jd,Ha));Ka.push(f);
b.push(Ka);Ha=this._sub(Za,wb);this._normalize(Ha,Cc);0>this._crossProduct(Ha,this._sub(f,wb))?this._rotateDirect(Ha,ib,ib):this._rotateDirect(Ha,ib,-ib);Ka=[];Ka.push(wb);Ka.push(this._add(Kd,Ha));Ka.push(this._sub(Kd,Ha));Ka.push(Za);b.push(Ka);break;case h.GeometricEffectControlMeasureLineRule.PerpendicularOffset:const Dc=this._cp2(k,-4,1),Ld=this._cp3(k,Dc,.882353,-1.94),$b=this._sub(Ld,Dc);0<this._crossProduct($b,this._sub(f,Dc))?this._rightPerpendicular($b):this._leftPerpendicular($b);const se=
[$b[0]/8,$b[1]/8],te=this._sub(this._mid(Dc,Ld),se);b.push([te,f]);break;case h.GeometricEffectControlMeasureLineRule.LineExcludingLastSegment:const Md=this._arrowPath(k),Nd=[];let Od=Md.length-2;for(;Od--;)Nd.push(Md[Od]);b.push(Nd);break;case h.GeometricEffectControlMeasureLineRule.MultivertexArrow:const ue=this._arrowPath(k),Pd=[];this._addArrow(Pd,ue,!1);b.push(Pd);break;case h.GeometricEffectControlMeasureLineRule.CrossedArrow:const ve=this._arrowPath(k),Qd=[];this._addArrow(Qd,ve,!0);b.push(Qd);
break;case h.GeometricEffectControlMeasureLineRule.ChevronArrow:const [ac,Rd]=this._arrowLastSeg(k),Lb=10*this._geomUnitsPerPoint,La=this._sub(f,ac),Ec=this._norm(La);this._normalize(La);const Fc=this._crossProduct(La,this._sub(Rd,ac));let Mb=this._dotProduct(La,this._sub(Rd,ac));Mb<.05*Ec?Mb=.05*Ec:Mb>.95*Ec-Lb&&(Mb=.95*Ec-Lb);const Gc=[ac[0]+La[0]*Mb,ac[1]+La[1]*Mb],Hc=this._leftPerp(La),Ic=[];Ic.push([Gc[0]+Hc[0]*Fc+La[0]*Lb,Gc[1]+Hc[1]*Fc+La[1]*Lb]);Ic.push(f);Ic.push([Gc[0]-Hc[0]*Fc+La[0]*Lb,
Gc[1]-Hc[1]*Fc+La[1]*Lb]);b.push(Ic);break;case h.GeometricEffectControlMeasureLineRule.ChevronArrowOffset:const [bc,Sd]=this._arrowLastSeg(k),Ma=this._sub(f,bc),Jc=this._norm(Ma);this._normalize(Ma);const Kc=this._crossProduct(Ma,this._sub(Sd,bc));let Nb=this._dotProduct(Ma,this._sub(Sd,bc));Nb<.05*Jc?Nb=.05*Jc:Nb>.95*Jc&&(Nb=.95*Jc);const cc=[bc[0]+Ma[0]*Nb,bc[1]+Ma[1]*Nb];this._leftPerpendicular(Ma);const Lc=[];Lc.push([cc[0]+Ma[0]*Kc*.5,cc[1]+Ma[1]*Kc*.5]);Lc.push(this._mid(cc,f));Lc.push([cc[0]-
Ma[0]*Kc*.5,cc[1]-Ma[1]*Kc*.5]);b.push(Lc);break;case h.GeometricEffectControlMeasureLineRule.PartialFirstSegment:const [dc,we]=this._arrowLastSeg(k),ec=this._sub(f,dc),Mc=this._norm(ec);this._normalize(ec);let Ob=this._dotProduct(ec,this._sub(we,dc));Ob<.05*Mc?Ob=.05*Mc:Ob>.95*Mc&&(Ob=.95*Mc);b.push([dc,[dc[0]+ec[0]*Ob,dc[1]+ec[1]*Ob]]);break;case h.GeometricEffectControlMeasureLineRule.Arch:const nd=this._cp2(k,0,-1),Nc=this._cp3(k,nd,.5,1),Td=this._sub(f,nd),xe=this._mix(Nc,1,Td,.55),ye=this._mix(Nc,
1,Td,-.55),od=[f];this._addBezier2(od,f,xe,Nc,4);this._addBezier2(od,Nc,ye,nd,4);b.push(od);break;case h.GeometricEffectControlMeasureLineRule.CurvedParallelTicks:const jb=this._cp2(k,-4,1),fc=this._cp3(k,jb,.882353,-1.94),xb=this._sub(fc,jb);0<this._crossProduct(xb,this._sub(f,jb))?this._rightPerpendicular(xb):this._leftPerpendicular(xb);const pd=[xb[0]/8,xb[1]/8],Ud=this._sub(this._mid(jb,fc),pd),ze=this._sub(this._mix(jb,.75,fc,.25),pd),Ae=this._sub(this._mix(jb,.25,fc,.75),pd),Oc=[jb];this._addBezier2(Oc,
jb,ze,Ud,3);this._addBezier2(Oc,Ud,Ae,fc,3);b.push(Oc);for(let ka=0;8>ka;ka++){const pa=Oc[2*ka+1],ua=[this._clone(pa)];ua.push(this._add(pa,[xb[0]/4,xb[1]/4]));b.push(ua)}break;case h.GeometricEffectControlMeasureLineRule.Arc90Degrees:const qd=this._cp2(k,0,-1),Be=this._cp3(k,qd,.5,1),Vd=[qd];this._add90DegArc(Vd,qd,f,Be);b.push(Vd);break;case h.GeometricEffectControlMeasureLineRule.TipWithPerpendicularAndTicks:const [rd,Wd]=this._arrowLastSeg(k),Pb=10*this._geomUnitsPerPoint,Na=this._sub(f,rd),
gc=this._norm(Na);this._normalize(Na);let Va=this._crossProduct(Na,this._sub(Wd,rd)),hc=this._dotProduct(Na,this._sub(Wd,rd));hc<.05*gc?hc=.05*gc:hc>.95*gc-Pb&&(hc=.95*gc-Pb);const kb=this._leftPerp(Na),$a=[f[0]-Na[0]*Pb,f[1]-Na[1]*Pb],lb=.5*Math.max(gc-hc-Pb,Pb);Va=Math.abs(Va);const ic=[];ic.push([$a[0]+kb[0]*(Va+lb)-Na[0]*lb,$a[1]+kb[1]*(Va+lb)-Na[1]*lb]);ic.push([$a[0]+kb[0]*Va,$a[1]+kb[1]*Va]);ic.push([$a[0]-kb[0]*Va,$a[1]-kb[1]*Va]);ic.push([$a[0]-kb[0]*(Va+lb)-Na[0]*lb,$a[1]-kb[1]*(Va+lb)-
Na[1]*lb]);b.push(ic);b.push([$a,f]);break;case h.GeometricEffectControlMeasureLineRule.ConcentricCircles:const Xd=this._cp2(k,1,0),Ce=this._cp3(k,Xd,2,0),sd=Math.cos(Math.PI/18),td=Math.sin(Math.PI/18);let jc=this._dist(Xd,f),ab=[jc,0],Wa=[];for(let ka=0;36>=ka;ka++)Wa.push(this._add(f,ab)),this._rotateDirect(ab,sd,td);b.push(Wa);if(4<=r){Wa=[];jc=this._dist(k[3],f);ab=[jc,0];for(let ka=0;36>=ka;ka++)Wa.push(this._add(f,ab)),0===ka&&(Wa.push(this._add(f,ab)),m.setId(Wa[1],1)),this._rotateDirect(ab,
sd,td);b.push(Wa)}Wa=[];jc=this._dist(Ce,f);ab=[jc,0];for(let ka=0;36>=ka;ka++)Wa.push(this._add(f,ab)),this._rotateDirect(ab,sd,td);b.push(Wa);break;case h.GeometricEffectControlMeasureLineRule.DoubleJogArrow:f=this._arrowPath(k)[0];const [De,Yd]=this._arrowLastSeg(k),xa=this._sub(f,De),Pc=this._norm(xa);this._normalize(xa);const kc=Math.abs(this._crossProduct(xa,this._sub(Yd,f)));let bb=Math.abs(this._dotProduct(xa,this._sub(Yd,f)));bb<.05*Pc?bb=.05*Pc:bb>.95*Pc&&(bb=.95*Pc);const va=Math.max(kc,
bb),Aa=this._leftPerp(xa);let Oa=[];const ma=[f[0]-xa[0]*bb*.5+Aa[0]*kc*.5,f[1]-xa[1]*bb*.5+Aa[1]*kc*.5];Oa.push([ma[0],ma[1]]);ma[0]+=xa[0]*va*.5+Aa[0]*va*.4;ma[1]+=xa[1]*va*.5+Aa[1]*va*.4;Oa.push([ma[0],ma[1]]);ma[0]-=Aa[0]*va*.25;ma[1]-=Aa[1]*va*.25;Oa.push([ma[0],ma[1]]);ma[0]+=xa[0]*va*.5+Aa[0]*va*.4;ma[1]+=xa[1]*va*.5+Aa[1]*va*.4;Oa.push([ma[0],ma[1]]);b.push(Oa);Oa=[];ma[0]=f[0]-xa[0]*bb*.5-Aa[0]*kc*.5;ma[1]=f[1]-xa[1]*bb*.5-Aa[1]*kc*.5;Oa.push([ma[0],ma[1]]);ma[0]+=xa[0]*va*.5-Aa[0]*va*.4;
ma[1]+=xa[1]*va*.5-Aa[1]*va*.4;Oa.push([ma[0],ma[1]]);ma[0]+=Aa[0]*va*.25;ma[1]+=Aa[1]*va*.25;Oa.push([ma[0],ma[1]]);ma[0]+=xa[0]*va*.5-Aa[0]*va*.4;ma[1]+=xa[1]*va*.5-Aa[1]*va*.4;Oa.push([ma[0],ma[1]]);b.push(Oa);break;case h.GeometricEffectControlMeasureLineRule.LinkedChevrons:const Qb=this._cp2(k,-5,0),Ee=this._cp3(k,Qb,-.2,1),Pa=this._sub(f,Qb);this._normalize(Pa);const mb=this._leftPerp(Pa),Ba=Math.abs(this._crossProduct(Pa,this._sub(Ee,Qb)));b.push([Qb,f]);const Qc=[];Qc.push([f[0]-Pa[0]*Ba+
mb[0]*Ba,f[1]-Pa[1]*Ba+mb[1]*Ba]);Qc.push(f);Qc.push([f[0]-Pa[0]*Ba-mb[0]*Ba,f[1]-Pa[1]*Ba-mb[1]*Ba]);b.push(Qc);this._addDash(b,Qb,[-Pa[0]*Ba+mb[0]*Ba,-Pa[1]*Ba+mb[1]*Ba]);this._addDash(b,Qb,[-Pa[0]*Ba-mb[0]*Ba,-Pa[1]*Ba-mb[1]*Ba]);break;case h.GeometricEffectControlMeasureLineRule.SegmentThenHalfCircle:const Rb=this._cp2(k,2,0),Fe=this._cp3(k,Rb,1.5,0);let Zd;Zd=4<=r?k[3]:this._cp3(k,Rb,1.25,-.5);const Ia=this._sub(Rb,f);this._normalize(Ia);const $d=.5*this._dist(Rb,Fe),Ge=0<this._crossProduct(Ia,
this._sub(Zd,f)),He=Math.cos(Math.PI/18);let ud=Math.sin(Math.PI/18);Ge&&(ud=-ud);const ae=[f,Rb];Ia[0]*=$d;Ia[1]*=$d;const Ie=this._add(Rb,Ia);Ia[0]=-Ia[0];Ia[1]=-Ia[1];for(let ka=1;18>=ka;ka++)this._rotateDirect(Ia,He,ud),ae.push(this._add(Ie,Ia));b.push(ae);break;case h.GeometricEffectControlMeasureLineRule.LineWithStraightTicks:const Rc=this._cp2(k,-2,1),vd=this._cp3(k,Rc,-1,-.5),yb=this._sub(vd,Rc);this._normalize(yb);const be=this._dotProduct(yb,this._sub(Rc,f)),ce=this._dotProduct(yb,this._sub(vd,
f));let zb=[f];zb.push([f[0]+yb[0]*be,f[1]+yb[1]*be]);zb.push(Rc);b.push(zb);zb=[f];zb.push([f[0]+yb[0]*ce,f[1]+yb[1]*ce]);zb.push(vd);b.push(zb);break;case h.GeometricEffectControlMeasureLineRule.DoubleCurve:const Ab=this._cp2(k,-5,-1),Bb=this._cp3(k,Ab,2,0),de=Math.atan2(1,5),ee=Math.cos(de),fe=Math.sin(de),nb=this._sub(Ab,f),Sb=this._dist(f,Ab);this._normalize(nb);this._rotateDirect(nb,ee,-fe);const ob=[f];ob.push([f[0]+nb[0]*Sb*.5,f[1]+nb[1]*Sb*.5]);m.setId(ob[1],1);ob.push([f[0]+nb[0]*Sb*.8,
f[1]+nb[1]*Sb*.8]);this._addBezier2(ob,ob[2],[f[0]+nb[0]*Sb,f[1]+nb[1]*Sb],Ab,3);const Tb=this._sub(Bb,Ab),Sc=this._dist(Ab,Bb);this._normalize(Tb);this._rotateDirect(Tb,ee,-fe);this._addBezier2(ob,Ab,[Bb[0]-Tb[0]*Sc,Bb[1]-Tb[1]*Sc],[Bb[0]-Tb[0]*Sc*.8,Bb[1]-Tb[1]*Sc*.8],3);ob.push(Bb);b.push(ob);break;case h.GeometricEffectControlMeasureLineRule.ParallelWithTicksByWidth:const Xa=this._cp2(k,0,-1),Je=this._cp3(k,Xa,.5,3),Qa=this._sub(Xa,f);this._normalize(Qa);const cb=this._crossProduct(Qa,this._sub(Je,
f));this._leftPerpendicular(Qa);0<cb?(this._addAngledTicks(b,f,[f[0]+Qa[0]*cb,f[1]+Qa[1]*cb],Xa),this._addAngledTicks(b,Xa,[Xa[0]+Qa[0]*cb,Xa[1]+Qa[1]*cb],f)):(this._addAngledTicks(b,[f[0]+Qa[0]*cb,f[1]+Qa[1]*cb],f,Xa),this._addAngledTicks(b,[Xa[0]+Qa[0]*cb,Xa[1]+Qa[1]*cb],f,Xa));break;case h.GeometricEffectControlMeasureLineRule.EnclosingRoundedRectangle:const Tc=this._cp2(k,3,-2),ta=[Math.min(f[0],Tc[0]),Math.max(f[1],Tc[1])],ya=[Math.max(f[0],Tc[0]),Math.min(f[1],Tc[1])],wd=ya[0]-ta[0],Ca=Math.min(wd,
ta[1]-ya[1])/10,Ya=[];Ya.push([ta[0]+Ca+.75*(wd-2*Ca),ta[1]]);Ya.push([ya[0]-Ca,ta[1]]);this._add90DegArc(Ya,[ya[0]-Ca,ta[1]],[ya[0],ta[1]-Ca],[ya[0],ta[1]]);Ya.push([ya[0],ya[1]+Ca]);this._add90DegArc(Ya,[ya[0],ya[1]+Ca],[ya[0]-Ca,ya[1]],ya);Ya.push([ta[0]+Ca,ya[1]]);this._add90DegArc(Ya,[ta[0]+Ca,ya[1]],[ta[0],ya[1]+Ca],[ta[0],ya[1]]);Ya.push([ta[0],ta[1]-Ca]);this._add90DegArc(Ya,[ta[0],ta[1]-Ca],[ta[0]+Ca,ta[1]],ta);Ya.push([ta[0]+Ca+.75*(wd-2*Ca),ta[1]]);break;default:b.push(k)}}return b}}l.EffectControlMeasureLine=
g;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/effects/EffectCut":function(){define(["exports","../../../geometry/GeometryCursor","../CIMCursor","../CurveHelper"],function(l,q,n,d){class m{static local(){null===m.instance&&(m.instance=new m);return m.instance}execute(g,c,a,b,k){return new h(g,c,a)}}m.instance=null;class h extends n.PathEffectCursor{constructor(g,c,a){super(g,!0,!0);this._curveHelper=new d.CurveHelper;this._beginCut=(void 0!==c.beginCut?c.beginCut:
1)*a;this._endCut=(void 0!==c.endCut?c.endCut:1)*a;this._middleCut=(void 0!==c.middleCut?c.middleCut:0)*a;this._invert=void 0!==c.invert?c.invert:!1;0>this._beginCut&&(this._beginCut=0);0>this._endCut&&(this._endCut=0);0>this._middleCut&&(this._middleCut=0)}processPath(g){const {_beginCut:c,_endCut:a,_middleCut:b}=this,k=g.pathLength(),e=q.GeometryCursor.createEmptyOptimizedCIM("esriGeometryPolyline");if(!this._invert)if(0===c&&0===a&&0===b)for(e.startPath();g.nextPoint();)e.pushXY(g.x,g.y);else c+
a+b<k&&(0===b?this._curveHelper.appendSubCurve(e,g,c,k-a):(this._curveHelper.appendSubCurve(e,g,c,.5*(k-b)),this._curveHelper.appendSubCurve(e,g,.5*(k+b),k-a)));else if(0!==c||0!==a||0!==b)if(c+a+b>=k)for(e.startPath();g.nextPoint();)e.pushXY(g.x,g.y);else this._curveHelper.appendSubCurve(e,g,0,c),this._curveHelper.appendSubCurve(e,g,.5*(k-b),.5*(k+b)),this._curveHelper.appendSubCurve(e,g,k-a,a);return 0===e.totalSize?null:e}}l.EffectCut=m;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},
"esri/symbols/cim/effects/EffectDashes":function(){define("exports ../../../geometry/GeometryCursor ../../../geometry/geometryCursorCollectUtils ../CIMCursor ../enums ../GeometryWalker ../utils".split(" "),function(l,q,n,d,m,h,g){class c{static local(){null===c.instance&&(c.instance=new c);return c.instance}execute(b,k,e,r,f){return new a(b,k,e)}}c.instance=null;class a extends d.PathEffectCursor{constructor(b,k,e){super(b,!0,!0);this._firstCurve=null;this._walker=new h.GeometryWalker;this._walker.updateTolerance(e);
this._endings=k.lineDashEnding;this._customDashPos=-(k.offsetAlongLine??0)*e;this._offsetAtEnd=(k.customEndingOffset??0)*e;b=g.normalizeDashEffectTemplate(k).dashTemplate;null==b&&(b=[]);b.length%2&&(b=[...b,...b]);this._pattern=new h.DashPattern;this._pattern.init(b,!0);this._pattern.scale(e)}processPath(b){if(0===this._pattern.length())return this.iteratePath=!1,b=n.collectPath(b),q.GeometryCursor.fromJSONCIM({paths:[b]});if(!this.iteratePath){var k=!0;switch(this._endings){default:this._pattern.extPtGap=
0;break;case m.LineDashEnding.FullPattern:this.isClosed||(this._pattern.extPtGap=.5*this._pattern.firstValue());break;case m.LineDashEnding.FullGap:this.isClosed||(this._pattern.extPtGap=.5*this._pattern.lastValue());break;case m.LineDashEnding.NoConstraint:this.isClosed||(k=!1);break;case m.LineDashEnding.Custom:this.isClosed||(this._pattern.extPtGap=.5*this._offsetAtEnd)}var e=b.pathLength();if(this._pattern.isEmpty()||e<.1*this._pattern.length()||!this._walker.init(b,this._pattern,k))return b=
n.collectPath(b),q.GeometryCursor.fromJSONCIM({paths:[b]})}if(this.iteratePath)b=this._pattern.nextValue();else{switch(this._endings){default:k=.5*this._pattern.firstValue();break;case m.LineDashEnding.HalfGap:k=.5*-this._pattern.lastValue();break;case m.LineDashEnding.FullGap:k=-this._pattern.lastValue();break;case m.LineDashEnding.FullPattern:k=0;break;case m.LineDashEnding.NoConstraint:case m.LineDashEnding.Custom:k=-this._customDashPos}b=k/this._pattern.length();b-=Math.floor(b);k=b*this._pattern.length();
this._pattern.reset();b=this._pattern.nextValue();for(e=!1;k>=b;)k-=b,b=this._pattern.nextValue(),e=!e;b-=k;e?(this._walker.nextPosition(b),b=this._pattern.nextValue()):this.isClosed&&(this._firstCurve=this._walker.nextCurve(b),b=this._pattern.nextValue(),this._walker.nextPosition(b),b=this._pattern.nextValue())}if(k=this._walker.nextCurve(b))if(this._walker.isPathEnd()){if(this.iteratePath=!1,this._firstCurve){for(this._firstCurve.nextPath();this._firstCurve.nextPoint();)k.pushXY(this._firstCurve.x,
this._firstCurve.y);this._firstCurve=null}}else b=this._pattern.nextValue(),!this._walker.nextPosition(b)||this._walker.isPathEnd()?(this.iteratePath=!1,this._firstCurve&&(k.pushCursor(this._firstCurve),this._firstCurve=null)):this.iteratePath=!0;else this.iteratePath=!1,k=this._firstCurve,this._firstCurve=null;k?.reset();return k}}l.EffectDashes=c;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/GeometryWalker":function(){define(["exports","../../geometry/GeometryCursor",
"./CurveHelper"],function(l,q,n){class d{constructor(){this._values=[];this._currentValue=this._length=this.ctrlPtGap=this.extPtGap=0}isEmpty(){return 0===this._values.length}size(){return this._values.length}init(c,a,b=!0){this._setEmpty();if(!c||0===c.length)return!1;for(let k=0;k<c.length;k++){let e=Math.abs(c[k]);b&&1E-7>e&&(e=1E-7);this._values.push(e);this._length+=e}a&&c.length&1&&(this._length*=2);if(0===this._length)return!1;this.ctrlPtGap=this.extPtGap=0;this._currentValue=-1;return!0}scale(c){const a=
this._values?this._values.length:0;for(let b=0;b<a;++b)this._values[b]*=c;this._length*=c;this.extPtGap*=c;this.ctrlPtGap*=c}addValue(c){this._length+=c;this._values.push(c)}firstValue(){return this._values[0]}lastValue(){return this._values[this._values.length-1]}nextValue(){this._currentValue++;this._currentValue===this._values.length&&(this._currentValue=0);return this._values[this._currentValue]}reset(){this._currentValue=-1}length(){return this._length}_setEmpty(){this.extPtGap=this.ctrlPtGap=
this._length=0;this._currentValue=-1;this._values.length=0}}class m{constructor(){this.pt=null;this.sa=this.ca=0}}l.EndType=void 0;(function(c){c[c.FAIL=0]="FAIL";c[c.END=1]="END";c[c.CONTINUE=2]="CONTINUE"})(l.EndType||(l.EndType={}));class h{constructor(){this.reset()}reset(){this.segment=null;this.abscissa=this.segmentLength=0;this.isPartEnd=this.isPathEnd=!1}isValid(){return null!==this.segment}copyTo(c){c.segment=this.segment;c.segmentLength=this.segmentLength;c.abscissa=this.abscissa;c.isPathEnd=
this.isPathEnd;c.isPartEnd=this.isPartEnd}}class g extends n.CurveHelper{constructor(c=0,a=!1){super(c,a);this._tolerance=n.pixelTolerance;this._currentPosition=new h}updateTolerance(c){this._tolerance=n.pixelTolerance*c}init(c,a,b=!0){b?(this._patternLength=a.length(),this._partExtPtGap=a.extPtGap,this._partCtrlPtGap=a.ctrlPtGap):this._partCtrlPtGap=this._partExtPtGap=this._patternLength=0;this._currentPosition.reset();this._partSegCount=0;this._pathCursor=c;this._seg=-1;return this._setPosAtNextPart()}curPositionIsValid(){return this._currentPosition.isValid()}nextPosition(c,
a=l.EndType.FAIL){const b=new h;if(!this._nextPosition(c,b,null,a))return!1;b.copyTo(this._currentPosition);return!0}curPointAndAngle(c){c.pt=this._getPoint(this._currentPosition);const [a,b]=this._getAngleCS(this._currentPosition);c.ca=a;c.sa=b}nextPointAndAngle(c,a,b=l.EndType.FAIL){const k=new h;if(!this._nextPosition(c,k,null,b))return!1;k.copyTo(this._currentPosition);a.pt=this._getPoint(k);const [e,r]=this._getAngleCS(k);a.ca=e;a.sa=r;return!0}nextCurve(c){if(0===c)return null;const a=q.GeometryCursor.createEmptyOptimizedCIM("esriGeometryPolyline");
a.startPath();a.nextPath();const b=new h;if(!this._nextPosition(c,b,a,l.EndType.END))return null;b.copyTo(this._currentPosition);return a}isPathEnd(){return this._currentPosition.isPathEnd}getPathEnd(){return this._currentPosition.segment[1]}getPt(c){this._pathCursor.seekInPath(c);return[this._pathCursor.x,this._pathCursor.y]}getSeg(c){const a=this.getPt(c);c=this.getPt(c+1);return[a,c]}_nextPosition(c,a,b,k){if(this._currentPosition.isPathEnd)return!1;var e=this._currentPosition.abscissa;0<this._currentPosition.segmentLength&&
(e/=this._currentPosition.segmentLength);for(this._currentPosition.copyTo(a);a.abscissa+c*this._partLengthRatio>a.segmentLength+this._tolerance;)if(b&&(0===b.pathSize&&(0===e?(e=a.segment[0],b.pushXY(e[0],e[1])):b.pushPoint(this.getSegCoord2D(a.segment,e))),e=a.segment[1],b.pushXY(e[0],e[1])),e=0,c-=(a.segmentLength-a.abscissa)/this._partLengthRatio,this._partSegCount)a.segment=this._nextSegment(),a.segmentLength=this.getSegLength(a.segment),a.abscissa=0,this._partSegCount--;else{if(!this._setPosAtNextPart()){if(k===
l.EndType.FAIL)return!1;a.segmentLength=this.getSegLength(a.segment);a.isPartEnd=!0;k===l.EndType.END?(a.abscissa=a.segmentLength,a.isPathEnd=!0):a.abscissa=a.segmentLength+c;return!0}this._currentPosition.copyTo(a)}a.abscissa+=c*this._partLengthRatio;b&&(0===b.pathSize&&(0===e?b.pushPoint(a.segment[0]):b.pushPoint(this.getSegCoord2D(a.segment,e))),c=a.abscissa/a.segmentLength,1===c?b.pushPoint(a.segment[1]):b.pushPoint(this.getSegCoord2D(a.segment,c)));!this._partSegCount&&Math.abs(a.abscissa-a.segmentLength)<
this._tolerance&&(a.isPathEnd=this._partIsLast,a.isPartEnd=!0);return!0}_getPoint(c){return this.getSegCoord2D(this._currentPosition.segment,0>=c.segmentLength?0:c.abscissa/c.segmentLength)}_getAngleCS(c){return this.getSegAngleCS(this._currentPosition.segment,0>=c.segmentLength?0:c.abscissa/c.segmentLength)}_setPosAtNextPart(){for(;this._partSegCount;)this._hasNextSegment()&&this._nextSegment(),this._partSegCount--;if(!this._hasNextSegment())return!1;this._partLength=0;this._partIsLast=!0;for(this._partSegCount=
0;this._hasNextSegment();)if(this._partLength+=this.getSegLength(this._nextSegment()),this._partSegCount++,this._pathCursor.getControlPointAt(this._getEndPointIndex())){this._partIsLast=!this._hasNextSegment();break}for(var c=this._partSegCount;c;)this._previousSegment(),--c;this._currentPosition.segment=this._nextSegment();this._currentPosition.segmentLength=this.getSegLength(this._currentPosition.segment);this._currentPosition.abscissa=0;this._currentPosition.isPathEnd=this._currentPosition.isPartEnd=
!1;--this._partSegCount;c=this._getStartPointIndex();this._ctrlPtBegin=this._pathCursor.getControlPointAt(c);c=c+this._partSegCount+1;c>=this._pathCursor.pathSize&&(c=0);this._ctrlPtEnd=this._pathCursor.getControlPointAt(c);if(0<this._patternLength){c=this._ctrlPtBegin?this._partCtrlPtGap:this._partExtPtGap;const a=this._ctrlPtEnd?this._partCtrlPtGap:this._partExtPtGap;let b=Math.round((this._partLength-(c+a))/this._patternLength);0>=b&&(b=0<c+a?0:1);this._partLengthRatio=this._partLength/(c+a+b*
this._patternLength);.01>this._partLengthRatio&&(this._partLengthRatio=1)}else this._partLengthRatio=1;return!0}_hasNextSegment(){return this._seg<this._pathCursor.pathSize-2}_previousSegment(){return this.getSeg(--this._seg)}_nextSegment(){return this.getSeg(++this._seg)}_getStartPointIndex(){return this._seg}_getEndPointIndex(){return this._seg+1}}l.DashPattern=d;l.GeometryWalker=g;l.Pos=m;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/effects/EffectDonut":function(){define("exports ../../../geometry ../../../geometry/GeometryCursor ../CIMEffects ../enums ../../../geometry/SpatialReference".split(" "),
function(l,q,n,d,m,h){class g{static local(){null===g.instance&&(g.instance=new g);return g.instance}execute(a,b,k,e,r,f){return new c(a,b,k,e,r,f)}}g.instance=null;class c{constructor(a,b,k,e,r,f){this._inputGeometries=a;this._tileKey=e;this._geometryEngine=r;this._maxInflateSize=f*k;this._width=(void 0!==b.width?b.width:2)*k;this._option=b.option}next(){for(var a;a=this._inputGeometries.next();){if("esriGeometryEnvelope"===a.geometryType&&0<this._width){var b=a.asJSON();return 0>Math.min(b.xmax-
b.xmin,b.ymax-b.ymin)-2*this._width?a:n.GeometryCursor.fromJSONCIM({paths:[[[b.xmin+this._width,b.ymin+this._width],[b.xmax-this._width,b.ymin+this._width],[b.xmax-this._width,b.ymax-this._width],[b.xmin+this._width,b.ymax-this._width],[b.xmin+this._width,b.ymin+this._width]],[[b.xmin,b.ymin],[b.xmin,b.ymax],[b.xmax,b.ymax],[b.xmax,b.ymin],[b.xmin,b.ymin]]]})}if("esriGeometryPolygon"===a.geometryType){if(0===this._width)return a.clone();var k=this._geometryEngine;if(null==k)break;if(a=this._tileKey?
d.clipCursorToTileExtent(a,this._maxInflateSize):a.clone()){if(k=k.buffer(h.WebMercator,a.asJSON(),-this._width,1))for(b of k.rings)if(b){a.startPath();for(const e of b.reverse())a.pushXY(e[0],a.yFactor*e[1])}return a}}}return null}}l.EffectDonut=g;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/effects/EffectJog":function(){define(["exports","../../../geometry/GeometryCursor","../CIMCursor","../CurveHelper"],function(l,q,n,d){class m{static local(){null===m.instance&&
(m.instance=new m);return m.instance}execute(g,c,a,b,k){return new h(g,c,a)}}m.instance=null;class h extends n.PathEffectCursor{constructor(g,c,a){super(g,!1,!0);this._curveHelper=new d.CurveHelper;this._length=(void 0!==c.length?c.length:20)*a;this._angle=void 0!==c.angle?c.angle:225;this._position=void 0!==c.position?c.position:50;0>this._length&&(this._length=-this._length);20>this._position&&(this._position=20);80<this._position&&(this._position=80);this._mirror=!1}processPath(g){const c=q.GeometryCursor.createEmptyOptimizedCIM("esriGeometryPolyline");
if(this._curveHelper.isEmpty(g))return null;g.seekInPath(0);const a=g.x,b=g.y;g.seekInPath(g.pathSize-1);const k=g.x;g=g.y;this._curveHelper.normalize([k-a,g-b]);const e=a+(k-a)*this._position/100,r=b+(g-b)*this._position/100,f=Math.cos((90-this._angle)/180*Math.PI);let p=Math.sin((90-this._angle)/180*Math.PI);this._mirror&&(p=-p);this._mirror=!this._mirror;c.pushPath([[a,b],[e-this._length/2*f,r-this._length/2*p],[e+this._length/2*f,r+this._length/2*p],[k,g]]);return c}}l.EffectJog=m;Object.defineProperty(l,
Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/effects/EffectMove":function(){define(["exports"],function(l){class q{static local(){null===q.instance&&(q.instance=new q);return q.instance}execute(d,m,h,g,c){return new n(d,m,h)}}q.instance=null;class n{constructor(d,m,h){this._inputGeometries=d;this._offsetX=void 0!==m.offsetX?m.offsetX*h:0;this._offsetY=void 0!==m.offsetY?m.offsetY*h:0}next(){let d=this._inputGeometries.next();for(;d;){if(0<d.totalSize)return this._move(d.clone(),this._offsetX,
this._offsetY);d=this._inputGeometries.next()}return null}_move(d,m,h){for(;d.nextPath();)for(;d.nextPoint();)d.x+=m,d.y+=h;d.reset();return d}}l.EffectMove=q;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/effects/EffectOffset":function(){define("exports ../../../geometry ../../../geometry/GeometryCursor ../../../geometry/geometryCursorCollectUtils ../../../geometry/support/jsonUtils ../CIMEffects ../CurveHelper ../enums ../../../geometry/SpatialReference".split(" "),
function(l,q,n,d,m,h,g,c,a){class b{static local(){null===b.instance&&(b.instance=new b);return b.instance}execute(e,r,f,p,t,w){return new k(e,r,f,p,t,w)}}b.instance=null;class k{constructor(e,r,f,p,t,w){this._inputGeometries=e;this._tileKey=p;this._geometryEngine=t;this._curveHelper=new g.CurveHelper;this._offset=(r.offset??1)*f;this._method=r.method;this._maxInflateSize=Math.max(Math.abs(w*f),10);this._option=r.option;this._offsetFlattenError=g.pixelTolerance*f}next(){for(var e;e=this._inputGeometries.next();){if(0===
this._offset)return e.clone();if("esriGeometryEnvelope"===e.geometryType){if(this._method===c.GeometricEffectOffsetMethod.Rounded&&0<this._offset){var r=d.collectPath(e);if(r=this._curveHelper.offset(r,-this._offset,this._method,4,this._offsetFlattenError))return e=n.GeometryCursor.createEmptyOptimizedCIM(e.geometryType),e.pushPath(r),e;break}r=e.asJSON();if(m.isExtent(r)&&0<Math.min(r.xmax-r.xmin,r.ymax-r.ymin)+2*this._offset)return n.GeometryCursor.fromJSONCIM({xmin:r.xmin-this._offset,xmax:r.xmax+
this._offset,ymin:r.ymin-this._offset,ymax:r.ymax+this._offset})}r=this._geometryEngine;if(null!=r&&(e=this._tileKey?h.clipCursorToTileExtent(e,this._maxInflateSize):e.clone()))return(e=r.offset(a.WebMercator,e.asJSON(),-this._offset,1,this._method,4,this._offsetFlattenError))?n.GeometryCursor.fromJSONCIM(e):null}return null}}l.EffectOffset=b;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/effects/EffectReverse":function(){define(["exports"],function(l){class q{static local(){null===
q.instance&&(q.instance=new q);return q.instance}execute(d,m,h,g,c){return new n(d,m,h)}}q.instance=null;class n{constructor(d,m,h){this._inputGeometries=d;this._reverse=void 0!==m.reverse?m.reverse:!0}next(){for(var d=this._inputGeometries.next();d;){if(!this._reverse)return d;if("esriGeometryPolyline"===d.geometryType){for(d=d.clone();d.nextPath();)for(let m=0;m<d.pathSize/2;m++){d.seekInPath(m);const h=d.x,g=d.y;d.seekInPath(d.pathSize-m-1);const c=d.x,a=d.y;d.x=h;d.y=g;d.seekInPath(m);d.x=c;d.y=
a}d.reset();return d}d=this._inputGeometries.next()}return null}}l.EffectReverse=q;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/effects/EffectRotate":function(){define(["exports","../../../geometry/support/boundsUtils"],function(l,q){class n{static local(){null===n.instance&&(n.instance=new n);return n.instance}execute(m,h,g,c,a){return new d(m,h,g)}}n.instance=null;class d{constructor(m,h,g){this._inputGeometries=m;this._rotateAngle=void 0!==h.angle?h.angle*Math.PI/
180:0}next(){let m=this._inputGeometries.next();for(;m;){if(0===this._rotateAngle||"esriGeometryPoint"===m.geometryType)return m;if(0<m.totalSize){var h=q.getCursorBoundsXY(m);const g=(h[2]+h[0])/2;h=(h[3]+h[1])/2;m.reset();return this._rotate(m.clone(),g,h)}m=this._inputGeometries.next()}return null}_rotate(m,h,g){const c=Math.cos(this._rotateAngle),a=Math.sin(this._rotateAngle);for(;m.nextPath();)for(;m.nextPoint();){const b=m.x-h,k=m.y-g;m.x=h+b*c-k*a;m.y=g+b*a+k*c}m.reset();return m}}l.EffectRotate=
n;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/effects/EffectScale":function(){define(["exports","../../../geometry/support/boundsUtils"],function(l,q){class n{static local(){null===n.instance&&(n.instance=new n);return n.instance}execute(m,h,g,c,a){return new d(m,h,g)}}n.instance=null;class d{constructor(m,h,g){this._inputGeometries=m;this._xFactor=void 0!==h.xScaleFactor?h.xScaleFactor:1.15;this._yFactor=void 0!==h.yScaleFactor?h.yScaleFactor:1.15}next(){const m=
this._inputGeometries.next();if(m){if(1===this._xFactor&&1===this._yFactor||"esriGeometryPoint"===m.geometryType)return m;if(0<m.totalSize){var h=q.getCursorBoundsXY(m);const g=(h[2]+h[0])/2;h=(h[3]+h[1])/2;m.reset();return this._scaleCursor(m.clone(),g,h)}}return null}_scaleCursor(m,h,g){for(;m.nextPath();)for(;m.nextPoint();)m.x=h+(m.x-h)*this._xFactor,m.y=g+(m.y-g)*this._yFactor;m.reset();return m}}l.EffectScale=n;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/effects/EffectWave":function(){define(["exports",
"../../../geometry/GeometryCursor","../enums","../GeometryWalker"],function(l,q,n,d){class m{static local(){null===m.instance&&(m.instance=new m);return m.instance}execute(g,c,a,b,k){return new h(g,c,a)}}m.instance=null;class h{constructor(g,c,a){this._inputGeometries=g;this._height=(void 0!==c.amplitude?c.amplitude:2)*a;this._period=(void 0!==c.period?c.period:3)*a;this._style=c.waveform;0>=this._height&&(this._height=Math.abs(this._height));0>=this._period&&(this._period=Math.abs(this._period));
this._pattern=new d.DashPattern;this._pattern.addValue(this._period);this._pattern.addValue(this._period);this._walker=new d.GeometryWalker;this._walker.updateTolerance(a)}next(){for(var g=this._inputGeometries.next();g;){if(0===this._height||0===this._period||(g=this._processGeom(g)))return g;g=this._inputGeometries.next()}return null}_processGeom(g){const c=q.GeometryCursor.createEmptyOptimizedCIM(g.geometryType);for(;g.nextPath();){c.startPath();const a=g.pathLength();if(this._walker.init(g,this._pattern))switch(this._style){default:this._constructCurve(c,
a,!1);break;case n.GeometricEffectWaveform.Square:this._constructSquare(c,a);break;case n.GeometricEffectWaveform.Triangle:this._constructTriangle(c,a);break;case n.GeometricEffectWaveform.Random:this._constructCurve(c,a,!0)}else for(;g.nextPoint();)c.pushXY(g.x,g.y)}return c}_constructCurve(g,c,a){var b=Math.round(c/this._period);0===b&&(b=1);const k=this._period/16,e=1/(16*b+1);c=2*Math.PI*c/(c/b);b=2*Math.PI*Math.random();const r=2*Math.PI*Math.random(),f=2*Math.PI*Math.random(),p=.75-Math.random()/
2,t=.75-Math.random()/2,w=new d.Pos;this._walker.curPointAndAngle(w);g.pushPoint(w.pt);let z=0;for(;;)if(this._walker.nextPointAndAngle(k,w)){const u=z;z+=e;let y;if(a){const A=this._height/2*(1+.3*Math.sin(p*c*u+b));y=A*Math.sin(c*u+r);y+=A*Math.sin(t*c*u+f);y/=2}else y=.5*this._height*Math.sin(.5*c*u);g.pushXY(w.pt[0]-y*w.sa,w.pt[1]+y*w.ca)}else{g.pushPoint(this._walker.getPathEnd());break}}_constructSquare(g,c){Math.round(c/this._period);for(c=!0;;){let a=!1;if(this._walker.curPositionIsValid()){const b=
new d.Pos;this._walker.curPointAndAngle(b);const k=new d.Pos;if(this._walker.nextPointAndAngle(this._period,k)){const e=new d.Pos;this._walker.nextPointAndAngle(this._period,e)&&(c?(g.pushPoint(b.pt),c=!1):g.pushPoint(b.pt),g.pushXY(b.pt[0]-this._height/2*b.sa,b.pt[1]+this._height/2*b.ca),g.pushXY(k.pt[0]-this._height/2*k.sa,k.pt[1]+this._height/2*k.ca),g.pushXY(k.pt[0]+this._height/2*k.sa,k.pt[1]-this._height/2*k.ca),g.pushXY(e.pt[0]+this._height/2*e.sa,e.pt[1]-this._height/2*e.ca),a=!0)}}if(!a){g.pushPoint(this._walker.getPathEnd());
break}}}_constructTriangle(g,c){Math.round(c/this._period);for(c=!0;;){let a=!1;if(this._walker.curPositionIsValid()){const b=new d.Pos;this._walker.curPointAndAngle(b);const k=new d.Pos;if(this._walker.nextPointAndAngle(this._period/2,k)){const e=new d.Pos;this._walker.nextPointAndAngle(this._period,e)&&(this._walker.nextPosition(this._period/2)&&(c?(g.pushPoint(b.pt),c=!1):g.pushPoint(b.pt),g.pushXY(k.pt[0]-this._height/2*k.sa,k.pt[1]+this._height/2*k.ca),g.pushXY(e.pt[0]+this._height/2*e.sa,e.pt[1]-
this._height/2*e.ca)),a=!0)}}if(!a){g.pushPoint(this._walker.getPathEnd());break}}}}l.EffectWave=m;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/placements/PlacementAlongLineSameSize":function(){define(["exports","../CIMCursor","../enums","../GeometryWalker"],function(l,q,n,d){class m{static local(){null===m.instance&&(m.instance=new m);return m.instance}execute(g,c,a,b,k){return new h(g,c,a)}}m.instance=null;class h extends q.PathTransformationCursor{constructor(g,
c,a){super(g);this._geometryWalker=new d.GeometryWalker;this._geometryWalker.updateTolerance(a);this._angleToLine=c.angleToLine??!0;this._offset=(c.offset?c.offset:0)*a;this._originalEndings=c.endings;this._offsetAtEnd=(c.customEndingOffset?c.customEndingOffset:0)*a;this._position=-(c.offsetAlongLine?c.offsetAlongLine:0)*a;this._pattern=new d.DashPattern;this._pattern.init(c.placementTemplate,!1);this._pattern.scale(a);this._endings=this._originalEndings}processPath(g){if(this._pattern.isEmpty())return null;
if(this.iteratePath)var c=this._pattern.nextValue();else{this._endings=this._originalEndings===n.PlacementEndings.WithFullGap&&this.isClosed?n.PlacementEndings.WithMarkers:this._originalEndings;this._pattern.extPtGap=0;let a=!0;switch(this._endings){case n.PlacementEndings.NoConstraint:c=-this._position;c=this._adjustPosition(c);a=!1;break;default:c=-this._pattern.lastValue()/2;break;case n.PlacementEndings.WithFullGap:c=-this._pattern.lastValue();this._pattern.extPtGap=this._pattern.lastValue();
break;case n.PlacementEndings.WithMarkers:c=0;break;case n.PlacementEndings.Custom:c=-this._position,c=this._adjustPosition(c),this._pattern.extPtGap=.5*this._offsetAtEnd}if(!this._geometryWalker.init(g,this._pattern,a))return null;this._pattern.reset();for(g=0;c>g;)c-=g,g=this._pattern.nextValue();c=g-c;this.iteratePath=!0}g=new d.Pos;if(!this._geometryWalker.nextPointAndAngle(c,g)||this._endings===n.PlacementEndings.WithFullGap&&this._geometryWalker.isPathEnd())return this.iteratePath=!1,null;if(this._endings===
n.PlacementEndings.WithMarkers&&this._geometryWalker.isPathEnd()&&(this.iteratePath=!1,this.isClosed))return null;this.internalPlacement.setTranslate(g.pt[0]-this._offset*g.sa,g.pt[1]+this._offset*g.ca);this._angleToLine&&this.internalPlacement.setRotateCS(g.ca,g.sa);return this.internalPlacement}_adjustPosition(g){g/=this._pattern.length();g-=Math.floor(g);return g*this._pattern.length()}}l.PlacementAlongLineSameSize=m;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/placements/PlacementAtExtremities":function(){define(["exports",
"../CIMCursor","../CurveHelper","../enums"],function(l,q,n,d){class m{static local(){null===m.instance&&(m.instance=new m);return m.instance}execute(g,c,a,b,k){return new h(g,c,a)}}m.instance=null;class h extends q.PathTransformationCursor{constructor(g,c,a){super(g,!1,!0);this._curveHelper=new n.CurveHelper;this._placePerPart=c.placePerPart??!1;this._angleToLine=void 0!==c.angleToLine?c.angleToLine:!0;this._offset=void 0!==c.offset?c.offset*a:0;this._type=c.extremityPlacement;this._position=void 0!==
c.offsetAlongLine?c.offsetAlongLine*a:0;this._beginProcessed=!1}processMultiPath(g){return this._placePerPart?super.processMultiPath(g):this.processPath(g)}processPath(g){let c;switch(this._type){default:this._beginProcessed?(c=this._atExtremities(g,this._position,!1),this.iteratePath=this.iterateMultiPath=this._beginProcessed=!1):(c=this._atExtremities(g,this._position,!0),this.iteratePath=this.iterateMultiPath=this._beginProcessed=!0);break;case d.ExtremityPlacement.JustBegin:c=this._atExtremities(g,
this._position,!0);break;case d.ExtremityPlacement.JustEnd:c=this._atExtremities(g,this._position,!1);case d.ExtremityPlacement.None:}return c}_atExtremities(g,c,a){this._placePerPart||(a?g.seekPath(0):g.seekPath(g.totalSize-1));a||g.seekPathEnd();if(a?g.nextPoint():g.prevPoint()){let b=0,[k,e]=[0,0],[r,f]=[g.x,g.y];for(;a?g.nextPoint():g.prevPoint();){k=r;e=f;r=g.x;f=g.y;const p=this._curveHelper.getLength(k,e,r,f);if(b+p>c){g=(c-b)/p;const [t,w]=this._curveHelper.getAngleCS(k,e,r,f,g);g=this._curveHelper.getCoord2D(k,
e,r,f,g);this.internalPlacement.setTranslate(g[0]-this._offset*w,g[1]+this._offset*t);this._angleToLine&&this.internalPlacement.setRotateCS(-t,-w);return this.internalPlacement}b+=p}}return null}}l.PlacementAtExtremities=m;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/placements/PlacementAtRatioPositions":function(){define(["exports","../CIMCursor","../GeometryWalker"],function(l,q,n){class d{static local(){null===d.instance&&(d.instance=new d);return d.instance}execute(h,
g,c,a,b){return new m(h,g,c)}}d.instance=null;class m extends q.PathTransformationCursor{constructor(h,g,c){super(h);this._walker=new n.GeometryWalker;this._walker.updateTolerance(c);this._angleToLine=void 0!==g.angleToLine?g.angleToLine:!0;this._offset=void 0!==g.offset?g.offset*c:0;this._beginGap=void 0!==g.beginPosition?g.beginPosition*c:0;this._endGap=void 0!==g.endPosition?g.endPosition*c:0;this._flipFirst=void 0!==g.flipFirst?g.flipFirst:!0;this._pattern=new n.DashPattern;this._pattern.init(g.positionArray,
!1,!1);this._subPathLen=0;this._posCount=this._pattern.size();this._isFirst=!0;this._prevPos=0}processPath(h){if(this._pattern.isEmpty())return null;if(this.iteratePath){h=this._pattern.nextValue()*this._subPathLen;var g=this._beginGap+h;h=g-this._prevPos;this._prevPos=g}else{this._posCount=this._pattern.size();this._isFirst=!0;this._prevPos=0;this._subPathLen=h.pathLength()-this._beginGap-this._endGap;if(0>this._subPathLen)return this.iteratePath=!1,null;if(!this._walker.init(h,this._pattern,!1))return null;
this._pattern.reset();h=this._pattern.nextValue()*this._subPathLen;g=this._beginGap+h;h=g-this._prevPos;this._prevPos=g;this.iteratePath=!0}g=new n.Pos;if(!this._walker.nextPointAndAngle(h,g,n.EndType.END))return this.iteratePath=!1,null;this.internalPlacement.setTranslate(g.pt[0]-this._offset*g.sa,g.pt[1]+this._offset*g.ca);h=this._isFirst&&this._flipFirst;let c;this._angleToLine?(c=g.ca,g=g.sa):(c=1,g=0);h&&(c=-c,g=-g);this.internalPlacement.setRotateCS(c,g);this._isFirst=!1;this._posCount--;0===
this._posCount&&(this.iteratePath=!1);return this.internalPlacement}}l.PlacementAtRatioPositions=d;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/placements/PlacementInsidePolygon":function(){define(["exports","../../../core/RandomLCG","../CIMPlacements","../enums"],function(l,q,n,d){class m{static local(){null===m.instance&&(m.instance=new m);return m.instance}execute(g,c,a,b,k){return new h(g,c,a,b,k)}}m.instance=null;class h{constructor(g,c,a,b,k){this._currentY=
this._currentX=this._yMax=this._yMin=this._xMax=this._xMin=0;this._accelerationMap=null;this._testInsidePolygon=!1;this._verticalSubdivision=!0;this._stepX=Math.abs(c.stepX??16)*a;this._stepY=Math.abs(c.stepY??16)*a;this._stepX=Math.round(128*this._stepX)/128;this._stepY=Math.round(128*this._stepY)/128;if(0!==this._stepX&&0!==this._stepY){this._gridType=c.gridType??d.PlacementGridType.Fixed;if(this._gridType===d.PlacementGridType.Random)this._randomLCG=new q(1*(c.seed??13)),this._randomness=(c.randomness??
100)/100,this._gridAngle=0,this._shiftOddRows=!1,this._cosAngle=1,this._offsetY=this._offsetX=this._sinAngle=0,this._buildRandomValues();else{this._randomness=0;this._gridAngle=c.gridAngle??0;this._shiftOddRows=c.shiftOddRows??!1;this._offsetX=(c.offsetX??0)*a;this._offsetY=(c.offsetY??0)*a;this._cosAngle=Math.cos(this._gridAngle/180*Math.PI);this._sinAngle=-Math.sin(this._gridAngle/180*Math.PI);if(this._stepX)if(0>this._offsetX)for(;this._offsetX<-.5*this._stepX;)this._offsetX+=this._stepX;else for(;this._offsetX>=
.5*this._stepX;)this._offsetX-=this._stepX;if(this._stepY)if(0>this._offsetY)for(;this._offsetY<-.5*this._stepY;)this._offsetY+=this._stepY;else for(;this._offsetY>=.5*this._stepY;)this._offsetY-=this._stepY}this._graphicOriginY=this._graphicOriginX=0;if(null!=b){const [e,r,f,p]=b.split("/");c=parseFloat(e);a=parseFloat(r);b=parseFloat(f);this._graphicOriginX=512*-(parseFloat(p)*2**c+b);this._graphicOriginY=512*a;this._testInsidePolygon=!0}this._internalPlacement=new n.Placement;this._calculateMinMax(g);
this._geometryCursor=g}}next(){return this._geometryCursor?this._nextInside():null}_buildRandomValues(){if(!h._randValues){h._randValues=[];for(let g=0;24>g;g++)for(let c=0;24>c;c++)h._randValues.push(this._randomLCG.getFloat()),h._randValues.push(this._randomLCG.getFloat())}}_calculateMinMax(g){this._yMax=this._yMin=this._xMax=this._xMin=0;let c,a,b,k,e,r,f,p;c=a=f=e=Number.MAX_VALUE;b=k=p=r=-Number.MAX_VALUE;var t=1!==this._cosAngle;for(g.reset();g.nextPath();)for(;g.nextPoint();){var w=g.x;var z=
g.y;var u=w-this._graphicOriginX-this._offsetX;var y=z-this._graphicOriginY-this._offsetY;if(t){var A=this._cosAngle*u-this._sinAngle*y;u=this._sinAngle*u+this._cosAngle*y}else A=u,u=y;c=Math.min(c,A);b=Math.max(b,A);a=Math.min(a,u);k=Math.max(k,u);e=Math.min(e,z);r=Math.max(r,z);f=Math.min(f,w);p=Math.max(p,w)}e=e!==Number.MAX_VALUE?e:-512-this._stepY;r=r!==-Number.MAX_VALUE?r:this._stepY;f=f!==Number.MAX_VALUE?f:-this._stepX;p=p!==-Number.MAX_VALUE?p:512+this._stepX;this._polygonMin=(this._verticalSubdivision=
r-e>=p-f)?e:f;if(this._testInsidePolygon){A=0-this._graphicOriginX-this._offsetX-this._stepX;z=512-this._graphicOriginX-this._offsetX+this._stepX;w=-512-this._graphicOriginY-this._offsetY-this._stepY;u=0-this._graphicOriginY-this._offsetY+this._stepY;if(t){t=[[A,w],[A,u],[z,w],[z,u]];A=w=Number.MAX_VALUE;z=u=-Number.MAX_VALUE;for(const v of t)t=this._cosAngle*v[0]-this._sinAngle*v[1],y=this._sinAngle*v[0]+this._cosAngle*v[1],A=Math.min(A,t),z=Math.max(z,t),w=Math.min(w,y),u=Math.max(u,y)}c=c!==Number.MAX_VALUE?
Math.max(c,A):A;a=a!==Number.MAX_VALUE?Math.max(a,w):w;b=b!==-Number.MAX_VALUE?Math.min(b,z):z;k=k!==-Number.MAX_VALUE?Math.min(k,u):u}this._xMin=Math.round(c/this._stepX);this._xMax=Math.round(b/this._stepX);this._yMin=Math.round(a/this._stepY);this._yMax=Math.round(k/this._stepY);this._currentX=this._xMax+1;this._currentY=this._yMin-1;this._buildAccelerationMap(g,f,p,e,r)}_buildAccelerationMap(g,c,a,b,k){g.reset();const e=new Map,r=this._verticalSubdivision;a=r?k-b:a-c;k=Math.ceil(a/10);if(!(1>=
k)){a=Math.floor(a/k);k++;this._delta=a;var f,p;if(r){k=-512-2*this._stepY;var t=2*this._stepY;var w=b}else k=-2*this._stepX,t=512+2*this._stepX,w=c;for(;g.nextPath();)if(!(2>g.pathSize)&&g.nextPoint()){var z=g.x;for(f=g.y;g.nextPoint();z=c,f=b){c=g.x;b=g.y;if(r){if(f===b||f<k&&b<k||f>t&&b>t)continue;var u=Math.min(f,b);var y=Math.max(f,b)}else{if(z===c||z<k&&c<k||z>t&&c>t)continue;u=Math.min(z,c);y=Math.max(z,c)}for(;u<y;){var A=p=Math.floor((u-w)/a),v=z,x=f,C=c,B=b,E=e;let D=E.get(A);D||(D=[],E.set(A,
D));D.push([[v,x],[C,B]]);u+=a}u=Math.floor((y-w)/a);u>p&&(y=c,A=b,v=e,x=v.get(u),x||(x=[],v.set(u,x)),x.push([[z,f],[y,A]]))}}this._accelerationMap=e}}_nextInside(){for(;;){if(this._currentX>this._xMax){this._currentY++;if(this._currentY>this._yMax)return null;this._currentX=this._xMin;this._shiftOddRows&&this._currentY%2&&this._currentX--}var g=this._currentX*this._stepX+this._offsetX;this._shiftOddRows&&this._currentY%2&&(g+=.5*this._stepX);const c=this._currentY*this._stepY+this._offsetY;this._currentX++;
let a;if(this._gridType===d.PlacementGridType.Random){const b=(this._currentX%24+24)%24,k=(this._currentY%24+24)%24;a=this._graphicOriginX+g+this._stepX*this._randomness*(.5-h._randValues[24*k+b])*2/3;g=this._graphicOriginY+c+this._stepY*this._randomness*(.5-h._randValues[24*k+b+1])*2/3}else a=this._graphicOriginX+this._cosAngle*g+this._sinAngle*c,g=this._graphicOriginY-this._sinAngle*g+this._cosAngle*c;if(!this._testInsidePolygon||this._isInsidePolygon(a,g,this._geometryCursor))return this._internalPlacement.setTranslate(a,
g),this._internalPlacement}}_isInsidePolygon(g,c,a){if(null==this._accelerationMap){var b=0,k;let f;g+=1E-6;c+=1E-6;for(a.reset();a.nextPath();)if(a.nextPoint()){var e=a.x;for(k=a.y;a.nextPoint();e=r,k=f){var r=a.x;f=a.y;k>c!==f>c&&(0<(r-e)*(c-k)-(f-k)*(g-e)?b++:b--)}}return 0!==b}g+=1E-6;c+=1E-6;a=this._verticalSubdivision;k=this._accelerationMap.get(Math.floor(((a?c:g)-this._polygonMin)/this._delta));if(!k)return!1;e=0;for(b of k){k=b[0];r=b[1];if(a){if(k[1]>c===r[1]>c)continue;k=(r[0]-k[0])*(c-
k[1])-(r[1]-k[1])*(g-k[0])}else{if(k[0]>g===r[0]>g)continue;k=(r[1]-k[1])*(g-k[0])-(r[0]-k[0])*(c-k[1])}0<k?e++:e--}return 0!==e}}l.PlacementInsidePolygon=m;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/placements/PlacementOnLine":function(){define(["exports","../CIMCursor","../CurveHelper","../enums"],function(l,q,n,d){class m{static local(){null===m.instance&&(m.instance=new m);return m.instance}execute(g,c,a,b,k){return new h(g,c,a)}}m.instance=null;class h extends q.PathTransformationCursor{constructor(g,
c,a){super(g);this._curveHelper=new n.CurveHelper;this._angleToLine=void 0!==c.angleToLine?c.angleToLine:!0;this._offset=void 0!==c.offset?c.offset*a:0;this._relativeTo=c.relativeTo;this._position=void 0!==c.startPointOffset?c.startPointOffset*a:0;this._epsilon=.001*a}processPath(g){var c=this._position;if(this._relativeTo===d.PlacementOnLineRelativeTo.SegmentMidpoint){this.iteratePath||(this.iteratePath=!0);if(g.nextPoint()){let [a,b]=[g.x,g.y],[k,e]=[0,0];for(;g.nextPoint();){k=g.x;e=g.y;c=this._curveHelper.getLength(a,
b,k,e);if(c<this._epsilon){a=k;b=e;continue}g=.5+this._position/c;const [r,f]=this._curveHelper.getAngleCS(a,b,k,e,g);g=this._curveHelper.getCoord2D(a,b,k,e,g);this.internalPlacement.setTranslate(g[0]-this._offset*f,g[1]+this._offset*r);this._angleToLine&&this.internalPlacement.setRotateCS(r,f);return this.internalPlacement}}this.iteratePath=!1;return null}return this.onLine(g,c,this._relativeTo===d.PlacementOnLineRelativeTo.LineEnd)}onLine(g,c,a){let b=!1;switch(this._relativeTo){default:g.seekPathStart();
c=g.pathLength()/2+c;break;case d.PlacementOnLineRelativeTo.LineBeginning:break;case d.PlacementOnLineRelativeTo.LineEnd:b=!0}a?g.seekPathEnd():g.seekPathStart();let k=0;if(a?g.prevPoint():g.nextPoint()){let [e,r]=[g.x,g.y],[f,p]=[0,0];for(;a?g.prevPoint():g.nextPoint();){f=g.x;p=g.y;const t=this._curveHelper.getLength(e,r,f,p);if(k+t>c){g=(c-k)/t;const [w,z]=this._curveHelper.getAngleCS(e,r,f,p,g);g=this._curveHelper.getCoord2D(e,r,f,p,g);a=b?-this._offset:this._offset;this.internalPlacement.setTranslate(g[0]-
a*z,g[1]+a*w);this._angleToLine&&(b?this.internalPlacement.setRotateCS(-w,-z):this.internalPlacement.setRotateCS(w,z));return this.internalPlacement}e=f;r=p;k+=t}}return null}}l.PlacementOnLine=m;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/placements/PlacementOnVertices":function(){define(["exports","../CIMCursor","../CurveHelper"],function(l,q,n){function d(g,c){const a=Math.PI;for(;Math.abs(c-g)>a+2E-15;)c=c-g>a?c-2*a:c+2*a;return(g+c)/2}class m{static local(){null===
m.instance&&(m.instance=new m);return m.instance}execute(g,c,a,b,k){return new h(g,c,a)}}m.instance=null;class h extends q.PathTransformationCursor{constructor(g,c,a){super(g);this._curveHelper=new n.CurveHelper;this._angleToLine=void 0!==c.angleToLine?c.angleToLine:!0;this._offset=void 0!==c.offset?c.offset*a:0;this._endPoints=void 0!==c.placeOnEndPoints?c.placeOnEndPoints:!0;this._controlPoints=void 0!==c.placeOnControlPoints?c.placeOnControlPoints:!0;this._regularVertices=void 0!==c.placeOnRegularVertices?
c.placeOnRegularVertices:!0;this._tags=[];this._tagIterator=0}processPath(g){this.iteratePath||(this._preparePath(g),this.iteratePath=!0);if(this._tagIterator>=this._tags.length)return this._tagIterator=this._tags.length=0,this.iteratePath=!1,null;g=this._tags[this._tagIterator];this._angleToLine&&this.internalPlacement.setRotate(g[2]);let c=g[0],a=g[1];if(0!==this._offset){const b=Math.cos(g[2]);c-=this._offset*Math.sin(g[2]);a+=this._offset*b}this.internalPlacement.setTranslate(c,a);this._tagIterator++;
return this.internalPlacement}_preparePath(g){this._tagIterator=this._tags.length=0;g.seekPathStart();const c=g.isClosed();let a=0,b=!1,k=0,e=0;g.seekPathStart();if(g.nextPoint()){let r=g.x,f=g.y,p=g.getControlPoint(),t=!0,w=g.nextPoint();for(;w;){const z=g.x,u=g.y,y=g.getControlPoint();if(this._angleToLine||0!==this._offset)k=this._curveHelper.getAngle(r,f,z,u,0);t?(t=!1,c?(a=k,b=p):(this._endPoints||this._controlPoints&&p)&&this._tags.push([r,f,k])):p?this._controlPoints&&this._tags.push([r,f,d(e,
k)]):this._regularVertices&&this._tags.push([r,f,d(e,k)]);if(this._angleToLine||0!==this._offset)e=this._curveHelper.getAngle(r,f,z,u,1);(w=g.nextPoint())||(c?y||b?this._controlPoints&&this._tags.push([z,u,d(e,a)]):this._regularVertices&&this._tags.push([z,u,d(e,a)]):(this._endPoints||this._controlPoints&&y)&&this._tags.push([z,u,e]));r=z;f=u;p=y}}this._tagIterator=0}}l.PlacementOnVertices=m;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/placements/PlacementPolygonCenter":function(){define("exports ../../../geometry/support/boundsUtils ../../../geometry/support/centroid ../../../geometry/support/labelPoint ../CIMPlacements ../enums".split(" "),
function(l,q,n,d,m,h){class g{static local(){null===g.instance&&(g.instance=new g);return g.instance}execute(a,b,k,e,r){return new c(a,b,k)}}g.instance=null;class c{constructor(a,b,k){this._geometryCursor=a;this._offsetX=void 0!==b.offsetX?b.offsetX*k:0;this._offsetY=void 0!==b.offsetY?b.offsetY*k:0;this._method=void 0!==b.method?b.method:h.PlacementPolygonCenterMethod.OnPolygon;this._placementPerPart=void 0!==b.placePerPart?b.placePerPart:!1;this._internalPlacement=new m.Placement}next(){const a=
this._geometryCursor;if(!a)return null;if(this._placementPerPart){for(;a.nextPath();)if(!(0>a.getCurrentRingArea()))return this._polygonCenter(a.getCurrentPath());this._geometryCursor=null}else return this._geometryCursor=null,this._polygonCenter(a);return null}_polygonCenter(a){let b=!1;switch(this._method){case h.PlacementPolygonCenterMethod.CenterOfMass:if(a=n.weightedAreaCentroid(a))this._internalPlacement.setTranslate(a[0]+this._offsetX,a[1]+this._offsetY),b=!0;break;case h.PlacementPolygonCenterMethod.BoundingBoxCenter:if(a=
q.getCursorBoundsXY(a))this._internalPlacement.setTranslate((a[2]+a[0])/2+this._offsetX,(a[3]+a[1])/2+this._offsetY),b=!0;break;default:a=d.getLabelPoint(a),null!==a&&(this._internalPlacement.setTranslate(a[0]+this._offsetX,a[1]+this._offsetY),b=!0)}return b?this._internalPlacement:null}}l.PlacementPolygonCenter=g;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/labelPoint":function(){define("exports ../../core/PriorityQueue ./aaBoundingRect ./boundsUtils ./centroid ./coordsUtils ./intersectsBase".split(" "),
function(l,q,n,d,m,h,g){function c(p,t){let w=0,z,u,y,A;for(t.reset();t.nextPath()&&t.nextPoint();)for(z=t.x,u=t.y;t.nextPoint();z=y,u=A)y=t.x,A=t.y,u>p[1]!==A>p[1]&&(0<(y-z)*(p[1]-u)-(A-u)*(p[0]-z)?w++:w--);return 0!==w}function a(p,t,w){if(w&&c(p,t))return{coord:p,distance:0};w=Infinity;let z=0,u=0;var y=[0,0];let A=[0,0];const v=[0,0];for(t.reset();t.nextPath()&&t.nextPoint();)if(!(2>t.pathSize))for(y[0]=t.x,y[1]=t.y;t.nextPoint();y=A)A=[t.x,t.y],h.projectPointOnLineSeg(v,p,y,A),y=e(p,v),y<w&&
(w=y,z=v[0],u=v[1]);return{coord:[z,u],distance:Math.sqrt(w)}}function b(p,t,w,z){w=[t,0];let u=Infinity,y=Infinity,A=!1,v=!1;t=[[t,z[1]-1],[t,z[3]+1]];z=[0,0];const x=[0,0],C=[0,0],B=[[0,0],[0,0]],E=n.create();for(p.reset();p.nextPath()&&p.nextPoint();)if(!(2>p.pathSize))for(B[0][0]=p.x,B[0][1]=p.y;p.nextPoint();B[0][0]=B[1][0],B[0][1]=B[1][1]){B[1][0]=p.x;B[1][1]=p.y;a:{var D=E;var F=B;if(2>F.length){D=null;break a}D||=n.create();const [H,I]=F[0],[K,L]=F[1];D[0]=Math.min(H,K);D[1]=Math.min(I,L);
D[2]=Math.max(H,K);D[3]=Math.max(I,L)}if(null!==D){x[0]=t[0][0];x[1]=t[0][1];C[0]=t[1][0];C[1]=t[1][1];a:{D=E;F=x;var G=C;let H=k(F,D),I=k(G,D);const K=D[0],L=D[1],R=D[2],S=D[3];if(H&I){D=0;break a}if(!(H|I)){D=4;break a}const W=(H?1:0)|(I?2:0);do{const J=G[0]-F[0],O=G[1]-F[1];if(J>O)H&3?(H&1?(F[1]+=O*(K-F[0])/J,F[0]=K):(F[1]+=O*(R-F[0])/J,F[0]=R),H=k(F,D)):I&3?(I&1?(G[1]+=O*(K-G[0])/J,G[0]=K):(G[1]+=O*(R-G[0])/J,G[0]=R),I=k(G,D)):H?(H&4?(F[0]+=J*(L-F[1])/O,F[1]=L):(F[0]+=J*(S-F[1])/O,F[1]=S),H=k(F,
D)):(I&4?(G[0]+=J*(L-G[1])/O,G[1]=L):(G[0]+=J*(S-G[1])/O,G[1]=S),I=k(G,D));else if(H&12?(H&4?(F[0]+=J*(L-F[1])/O,F[1]=L):(F[0]+=J*(S-F[1])/O,F[1]=S),H=k(F,D)):I&12?(I&4?(G[0]+=J*(L-G[1])/O,G[1]=L):(G[0]+=J*(S-G[1])/O,G[1]=S),I=k(G,D)):H?(H&1?(F[1]+=O*(K-F[0])/J,F[0]=K):(F[1]+=O*(R-F[0])/J,F[0]=R),H=k(F,D)):(I&1?(G[1]+=O*(K-G[0])/J,G[0]=K):(G[1]+=O*(R-G[0])/J,G[0]=R),I=k(G,D)),H&I){D=0;break a}}while(H|I);D=W}0!==D&&g.segmentIntersects(t[0],t[1],B[0],B[1],z)&&(D=z[1],u>y?D<u&&(u=D,A=!0):D<y&&(y=D,
v=!0))}}A&&v?w[1]=(u+y)/2:w[0]=w[1]=NaN;return w}function k(p,t){return(p[0]<t[0]?1:0)|(p[0]>t[2]?1:0)<<1|(p[1]<t[1]?1:0)<<2|(p[1]>t[3]?1:0)<<3}function e(p,t){return(p[0]-t[0])*(p[0]-t[0])+(p[1]-t[1])*(p[1]-t[1])}function r(p,t){if(p<t)return-1;if(p>t)return 1;if(p===t)return 0;p=isNaN(p);t=isNaN(t);return p<t?-1:p>t?1:0}class f{constructor(p,t,w,z){this.x=p;this.y=t;this.cellSize=w;this.distancefromCellCenter=h.distanceFromPointToPolygon(p,t,z);this.maxDistanceToPolygon=this.distancefromCellCenter+
this.cellSize*Math.SQRT2}}l.getLabelPoint=function(p){if(0===p.totalSize)return null;var t=d.getCursorBoundsXY(p);if(!t)return null;var w=8.8818E-14*(Math.abs(t[0])+Math.abs(t[2])+Math.abs(t[1])+Math.abs(t[3])+1),z=0,u=0;p.reset();for(var y=0;p.nextPath();y++){var A=p.getCurrentRingArea();A>u&&(u=A,z=y)}p.seekPath(z);if(0===p.pathSize)return null;p.seekPathStart();A=d.getCursorPathBounds(p);if(Math.abs(u)<=2*w*w)return[(A[0]+A[2])/2,(A[1]+A[3])/2];p.seekPathStart();var v=m.ringCentroidCursorXY(p,
n.create());if(null===v)return null;if(4>p.totalPoints)return v;u=[[NaN,NaN],[NaN,NaN],[NaN,NaN],[NaN,NaN]];z=[NaN,NaN,NaN,NaN];y=[NaN,NaN,NaN,NaN];var x=!1,C=a(v,p,!0);0===C.distance&&(x=!0,u[0][0]=v[0],u[0][1]=v[1],C=a(v,p,!1));z[0]=C.distance;y[0]=0;var B=[NaN,NaN];let E=!1,D=.25,F=-1;C=NaN;do{C=NaN;var G=A[0];u[1]=b(p,G+(A[2]-G)*D,w,t);isNaN(u[1][0])||isNaN(u[1][1])||(C=a(u[1],p,!1),C=C.distance);if(!isNaN(C)&&C>w&&c(u[1],p))E=!0,z[1]=C,y[1]=e(u[1],v);else if(!isNaN(C)&&C>F&&(F=C,B[0]=u[1][0],
B[1]=u[1][1]),D-=.01,.1>D)if(0<=F)E=!0,z[1]=F,u[1][0]=B[0],u[1][1]=B[1],y[1]=e(u[1],v);else break}while(!E);E=!1;D=.5;F=-1;G=.01;let H=1;do{C=NaN;var I=A[0];u[2]=b(p,I+(A[2]-I)*D,w,t);isNaN(u[2][0])||isNaN(u[2][1])||(C=a(u[2],p,!1),C=C.distance);if(!isNaN(C)&&C>w&&c(u[2],p))E=!0,z[2]=C,y[2]=e(u[2],v);else if(!isNaN(C)&&C>F)F=C,B[0]=u[2][0],B[1]=u[2][1];else if(C>F&&(F=C,B[0]=u[2][0],B[1]=u[2][1]),D=.5+G*H,G+=.01,H*=-1,.3>D||.7<D)if(0<=F)E=!0,z[2]=F,u[2][0]=B[0],u[2][1]=B[1],y[2]=e(u[2],v);else break}while(!E);
E=!1;D=.75;F=-1;do if(C=NaN,G=A[0],u[3]=b(p,G+(A[2]-G)*D,w,t),isNaN(u[3][0])||isNaN(u[3][1])||(C=a(u[3],p,!1),C=C.distance),!isNaN(C)&&C>w&&c(u[3],p))E=!0,z[3]=C,y[3]=e(u[3],v);else if(C>F&&(F=C,B[0]=u[3][0],B[1]=u[3][1]),D+=.01,.9<D)if(0<=F)E=!0,z[3]=F,u[3][0]=B[0],u[3][1]=B[1],y[3]=e(u[3],v);else break;while(!E);p=[0,1,2,3];t=x?0:1;for(A=t;4>A;A++)for(x=t;3>x;x++)v=y[x],B=y[x+1],0<r(v,B)&&(w=p[x],p[x]=p[x+1],p[x+1]=w,y[x]=B,y[x+1]=v);y=t;for(A=w=0;4>t;t++){switch(t){case 0:A=2*z[p[t]];break;case 1:A=
1.66666666*z[p[t]];break;case 2:A=1.33333333*z[p[t]];break;case 3:A=z[p[t]]}A>w&&(w=A,y=p[t])}return u[y]};l.getPolylabelPoint=function(p){if(!p.nextPath()||!p.pathSize)return null;var t=d.getCursorPathBounds(p),w=t[2]-t[0],z=t[3]-t[1];if(0===w||0===z)return[t[0]+w/2,t[1]+z/2];const u=Math.max(Math.min(w,z)/100,1),y=new q((x,C)=>C.maxDistanceToPolygon-x.maxDistanceToPolygon);z=Math.min(w,z);w=z/2;let A=0,v=0;for(A=t[0];A<t[2];A+=z)for(v=t[1];v<t[3];v+=z)y.enqueue(new f(A+w,v+w,w,p));p.reset();p.nextPath();
t=m.ringsCentroidCursor(p);if(null===t)return null;for(t=new f(t[0],t[1],0,p);0<y.size;)z=y.dequeue(),z.distancefromCellCenter>t.distancefromCellCenter&&(t=z),z.maxDistanceToPolygon-t.distancefromCellCenter<=u||(w=z.cellSize/2,y.enqueue(new f(z.x-w,z.y-w,w,p)),y.enqueue(new f(z.x+w,z.y-w,w,p)),y.enqueue(new f(z.x-w,z.y+w,w,p)),y.enqueue(new f(z.x+w,z.y+w,w,p)));return[t.x,t.y]};Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/core/PriorityQueue":function(){define(function(){class l{constructor(n=
q){this._data=[];this._compare=n}get size(){return this._data.length}enqueue(n){if(null!=n){var {_data:d,_compare:m}=this;d.push(n);n=d.length-1>>>0;for(var h=d[n];0<n;){const g=n-1>>1,c=d[g];if(0>=m(c,h))d[g]=h,d[n]=c,n=g;else break}}}dequeue(){const {_data:n,_compare:d}=this,m=n[0];var h=n.pop();if(0===n.length)return m;n[0]=h;h=0;const g=n.length,c=n[0];let a;let b=null;for(;;){var k=2*h+1;const e=2*h+2;b=null;k<g&&(a=n[k],0<d(a,c)&&(b=k));e<g&&(k=n[e],null===b&&0>=d(k,c)||null!==b&&0>=d(k,a))&&
(b=e);if(null===b)break;n[h]=n[b];n[b]=c;h=b}return m}}const q=(n,d)=>n<d?-1:n>d?1:0;return l})},"esri/symbols/cim/imageUtils":function(){define(["exports"],function(l){l.getFirstFrame=function(q){const n=q.getFrame(0);if(n instanceof HTMLImageElement||n instanceof HTMLCanvasElement)return n;const d=document.createElement("canvas");d.width=q.width;d.height=q.height;q=d.getContext("2d");n instanceof ImageData?q.putImageData(n,0,0):q.drawImage(n,0,0);return d};Object.defineProperty(l,Symbol.toStringTag,
{value:"Module"})})},"esri/symbols/cim/TextRasterizer":function(){define(["../../core/screenUtils","../support/textUtils"],function(l,q){function n(h){return`rgba(${h.slice(0,3).toString()},${h[3]})`}function d(h,g){var c=g.font;c=`${c.style} ${c.weight} ${l.pt2px(Math.max(g.size,.5)).toFixed(1)}px ${c.family}, sans-serif`;h.font=c;h.textBaseline="top";switch(g.horizontalAlignment){case "left":g="left";break;case "right":g="right";break;case "center":g="center";break;default:g="left"}h.textAlign=
g}class m{constructor(h){h&&(this._textRasterizationCanvas=h)}rasterizeText(h,g){this._textRasterizationCanvas||(this._textRasterizationCanvas=document.createElement("canvas"));const c=this._textRasterizationCanvas;var a=c.getContext("2d",{willReadFrequently:!0});d(a,g);this._parameters=g;this._textLines=h.split(/\r?\n/);this._lineHeight=this._computeLineHeight();const {decoration:b,weight:k}=g.font;this._lineThroughWidthOffset=b&&"line-through"===b?.1*this._lineHeight:0;var e=(h=null!=g.backgroundColor||
null!=g.borderLine)?q.backgroundPadding:0,r=this._computeTextWidth(a,g)+2*e,f=this._lineHeight*this._textLines.length+2*e;c.width=r+2*this._lineThroughWidthOffset;c.height=f;if(0===c.width||0===c.height)return c.width=c.height=1,{size:[0,0],image:new Uint32Array(0),sdf:!1,simplePattern:!1,anchorX:0,anchorY:0,canvas:c};this._renderedLineHeight=Math.round(this._lineHeight);this._renderedOutlineSize=(g.outline.size||0)*g.pixelRatio;this._renderedHaloSize=(g.halo.size||0)*g.pixelRatio;this._renderedWidth=
r;this._renderedHeight=f;this._lineThroughWidthOffset*=g.pixelRatio;r=(g.outline&&g.outline.color)??[0,0,0,0];f=g.halo&&g.halo.color?g.halo.color:[0,0,0,0];this._fillStyle=n(g.color??[0,0,0,0]);this._outlineStyle=n(r);this._haloStyle=`rgb(${f.slice(0,3).toString()})`;r=this._renderedLineHeight;f=this._renderedOutlineSize;var p=this._renderedHaloSize;a.save();a.clearRect(0,0,c.width,c.height);d(a,g);var t=e*g.pixelRatio;e=a.textAlign;var w=this._renderedWidth-2*t,z=this._renderedHaloSize+this._renderedOutlineSize;
e=("center"===e?.5*w:"right"===e?w-z:z)+t;t=p+f+t;p=0<p;w=this._lineThroughWidthOffset;z=0;if(h){a.save();h=g.borderLine?.color??[0,0,0,0];const y=2*(g.borderLine?.size??0);a.fillStyle=n(g.backgroundColor??[0,0,0,0]);a.strokeStyle=n(h);a.lineWidth=y;a.fillRect(0,0,c.width,c.height);a.strokeRect(0,0,c.width,c.height);a.restore()}p&&this._renderHalo(a,e,t,w,z,g);0<f&&this._renderOutline(a,e,t,w,z,g);z+=t;w+=e;for(var u of this._textLines)p&&(a.globalCompositeOperation="destination-out",a.fillStyle=
"rgb(0, 0, 0)",a.fillText(u,w,z),a.globalCompositeOperation="source-over"),a.fillStyle=this._fillStyle,a.fillText(u,w,z),b&&"none"!==b&&this._renderDecoration(a,w,z,b,k),z+=r;a.restore();u=this._renderedWidth+2*this._lineThroughWidthOffset;h=this._renderedHeight;a=a.getImageData(0,0,u,h);a=new Uint8Array(a.data);if(g.premultiplyColors)for(f=0;f<a.length;f+=4)r=a[f+3]/255,a[f]*=r,a[f+1]*=r,a[f+2]*=r;switch(g.horizontalAlignment){case "left":r=-.5;break;case "right":r=.5;break;default:r=0}switch(g.verticalAlignment){case "bottom":g=
-.5;break;case "top":g=.5;break;case "baseline":g=-1/6;break;default:g=0}return{size:[u,h],image:new Uint32Array(a.buffer),sdf:!1,simplePattern:!1,anchorX:r,anchorY:g,canvas:c}}_renderHalo(h,g,c,a,b,k){const e=this._renderedWidth,r=this._renderedHeight;this._outlineRasterizationCanvas||(this._outlineRasterizationCanvas=document.createElement("canvas"));this._outlineRasterizationCanvas.width=e;this._outlineRasterizationCanvas.height=r;const f=this._outlineRasterizationCanvas,p=f.getContext("2d");p.clearRect(0,
0,e,r);d(p,k);const {decoration:t,weight:w}=k.font;p.fillStyle=this._haloStyle;p.strokeStyle=this._haloStyle;p.lineJoin="round";this._renderOutlineNative(p,g,c,t,w,this._renderedHaloSize+this._renderedOutlineSize);h.globalAlpha=this._parameters.halo.color[3];h.drawImage(f,0,0,e,r,a,b,e,r);h.globalAlpha=1}_renderOutline(h,g,c,a,b,k){const e=this._renderedWidth,r=this._renderedHeight;this._outlineRasterizationCanvas||(this._outlineRasterizationCanvas=document.createElement("canvas"));this._outlineRasterizationCanvas.width=
e;this._outlineRasterizationCanvas.height=r;const f=this._outlineRasterizationCanvas,p=f.getContext("2d");p.clearRect(0,0,e,r);d(p,k);const {decoration:t,weight:w}=k.font;p.fillStyle=this._outlineStyle;p.strokeStyle=this._outlineStyle;p.lineJoin="round";this._renderOutlineNative(p,g,c,t,w,this._renderedOutlineSize);h.globalAlpha=this._parameters.outline.color[3];h.drawImage(f,0,0,e,r,a,b,e,r);h.globalAlpha=1}_renderOutlineNative(h,g,c,a,b,k){const e=this._renderedLineHeight;for(const r of this._textLines){const f=
2*k;for(let p=0;5>p;p++){const t=(.6+.1*p)*f;h.lineWidth=t;h.strokeText(r,g,c);a&&"none"!==a&&this._renderDecoration(h,g,c,a,b,t)}c+=e}}computeTextSize(h,g){this._textRasterizationCanvas||(this._textRasterizationCanvas=document.createElement("canvas"));const c=this._textRasterizationCanvas;var a=c.getContext("2d");d(a,g);this._parameters=g;this._textLines=h.split(/\r?\n/);this._lineHeight=this._computeLineHeight();h=this._computeTextWidth(a,g);a=this._lineHeight*this._textLines.length;c.width=h;c.height=
a;return[h*g.pixelRatio,a*g.pixelRatio]}_computeTextWidth(h,g){let c=0;for(const a of this._textLines)c=Math.max(c,h.measureText(a).width);g=g.font;if("italic"===g.style||"oblique"===g.style||"string"===typeof g.weight&&("bold"===g.weight||"bolder"===g.weight)||"number"===typeof g.weight&&600<g.weight)c+=.3*h.measureText("w").width;c+=2*l.pt2px(this._parameters.halo.size);return Math.round(c)}_computeLineHeightBase(){return 1.275*this._parameters.size}_computeLineHeight(){let h=this._computeLineHeightBase();
const g=this._parameters.font.decoration;g&&"underline"===g&&(h*=1.3);return Math.round(h+2*l.pt2px(this._parameters.halo.size))}_renderDecoration(h,g,c,a,b,k){let e=.9*this._lineHeight;b="bold"===b?.06:"bolder"===b?.09:.04;switch(h.textAlign){case "center":g-=this._renderedWidth/2;break;case "right":g-=this._renderedWidth}const r=h.textBaseline;if("underline"===a)switch(e=.9*this._computeLineHeightBase(),r){case "top":c+=e;break;case "middle":c+=e/2}else if("line-through"===a)switch(r){case "top":c+=
e/1.5;break;case "middle":c+=e/3}a=k?1.5*k:Math.ceil(e*b);h.save();h.beginPath();h.strokeStyle=h.fillStyle;h.lineWidth=a;h.moveTo(g-this._lineThroughWidthOffset,c);h.lineTo(g+this._renderedWidth+2*this._lineThroughWidthOffset,c);h.stroke();h.restore()}}return m})},"esri/views/2d/engine/svgUtils":function(){define(["exports"],function(l){function q(n){return document.createElementNS("http://www.w3.org/2000/svg",n)}l.createHiddenSvg=function(){const n=q("svg");n.setAttribute("style","position: absolute;");
n.setAttribute("width","0");n.setAttribute("height","0");n.setAttribute("aria-hidden","true");n.setAttribute("role","presentation");document.body.appendChild(n);return n};l.createSvgElement=q;l.destroyHiddenSvg=function(n){null!=n&&document.body.removeChild(n);return null};Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/mesh/templates/shapingUtils":function(){define("exports ../../../../../../core/libs/gl-matrix-2/math/mat2d ../../../../../../core/libs/gl-matrix-2/factories/mat2df32 ../../../../../../core/libs/gl-matrix-2/math/vec2 ../../../../../../core/libs/gl-matrix-2/factories/vec2f32 ../../alignmentUtils ../../Rect ../../collisions/BoundingBox".split(" "),
function(l,q,n,d,m,h,g,c){function a(f,p){f.forEach(t=>d.transformMat2d(t,t,p));return{topLeft:f[0],topRight:f[1],bottomLeft:f[2],bottomRight:f[3]}}const b=Math.PI/180;class k{constructor(f,p,t,w){this._rotationT=n.create();this.minZoom=this._yBounds=this._xBounds=0;this.maxZoom=255;this._bounds=null;const z=t.rect,u=new Float32Array(8);f*=w;p*=w;const y=t.code?z.width*w:t.metrics.width,A=t.code?z.height*w:t.metrics.height;this.width=y;this.height=A;u[0]=f;u[1]=p;u[2]=f+y;u[3]=p;u[4]=f;u[5]=p+A;u[6]=
f+y;u[7]=p+A;this._data=u;this._setTextureCoords(z);this._scale=w;this._mosaic=t;this.x=f;this.y=p;this.maxOffset=Math.max(f+y,p+A)}get mosaic(){return this._mosaic}set angle(f){this._angle=f;q.fromRotation(this._rotationT,-f);this._setOffsets()}get angle(){return this._angle}get xTopLeft(){return this._data[0]}get yTopLeft(){return this._data[1]}get xBottomRight(){return this._data[6]}get yBottomRight(){return this._data[7]}get texcoords(){return this._texcoords}get textureBinding(){return this._mosaic.textureBinding}get offsets(){this._offsets||
this._setOffsets();return this._offsets}get char(){return String.fromCharCode(this._mosaic.code)}get code(){return this._mosaic.code}get bounds(){if(!this._bounds){const {height:z,width:u}=this._mosaic.metrics;var f=u*this._scale,p=Math.abs(z)*this._scale,t=new Float32Array(8);t[0]=this.x;t[1]=this.y;t[2]=this.x+f;t[3]=this.y;t[4]=this.x;t[5]=this.y+p;t[6]=this.x+f;t[7]=this.y+p;f=q.multiply(n.create(),this._rotationT,this._transform);n.transformMany(t,t,f);p=f=Infinity;let y=-Infinity;var w=-Infinity;
for(let A=0;4>A;A++){const v=t[2*A],x=t[2*A+1];f=Math.min(f,v);p=Math.min(p,x);y=Math.max(y,v);w=Math.max(w,x)}t=y-f;w-=p;this._bounds=new c(f+t/2,p+w/2,t,w)}return this._bounds}setTransform(f){this._transform=f;this._offsets=null}_setOffsets(){this._offsets||(this._offsets={topLeft:[0,0],topRight:[0,0],bottomLeft:[0,0],bottomRight:[0,0]});const f=q.multiply(n.create(),this._rotationT,this._transform);this._offsets.topLeft[0]=this._data[0];this._offsets.topLeft[1]=this._data[1];this._offsets.topRight[0]=
this._data[2];this._offsets.topRight[1]=this._data[3];this._offsets.bottomLeft[0]=this._data[4];this._offsets.bottomLeft[1]=this._data[5];this._offsets.bottomRight[0]=this._data[6];this._offsets.bottomRight[1]=this._data[7];d.transformMat2d(this._offsets.topLeft,this._offsets.topLeft,f);d.transformMat2d(this._offsets.topRight,this._offsets.topRight,f);d.transformMat2d(this._offsets.bottomLeft,this._offsets.bottomLeft,f);d.transformMat2d(this._offsets.bottomRight,this._offsets.bottomRight,f)}_setTextureCoords({x:f,
y:p,width:t,height:w}){this._texcoords={topLeft:[f,p],topRight:[f+t,p],bottomLeft:[f,p+w],bottomRight:[f+t,p+w]}}}class e{constructor(f,p,t){this._rotation=0;this._decorate(f,p,t);this.glyphs=f;this.bounds=this._createBounds(f);this.isMultiline=1<p.length;this._hasRotation=0!==t.angle;this._transform=this._createGlyphTransform(this.bounds,t);if((this._borderLineSizePx=t.borderLineSizePx)||t.hasBackground)[this.bounds,this.textBox]=this.shapeBackground(this._transform);for(const w of f)w.setTransform(this._transform)}setRotation(f){if(0!==
f||0!==this._rotation){this._rotation=f;var p=this._transform;f=q.fromRotation(n.create(),f);q.multiply(p,f,p);for(const t of this.glyphs)t.setTransform(this._transform)}}_decorate(f,p,t){if(t.decoration&&"none"!==t.decoration&&f.length){var w=t.scale;t="underline"===t.decoration?26:16;var z=f[0].textureBinding;for(const v of p){const x=v.startX*w,C=v.startY*w;p=f;var u=p.push;var y=(v.width+v.glyphWidthEnd)*w;var A=z;y={code:0,page:0,sdf:!0,rect:new g(0,0,11,8),textureBinding:A,metrics:{advance:0,
height:4,width:y,left:0,top:0}};u.call(p,new k(x,C+t*w,y,1))}}}shapeBackground(f){const p=(1.5+(this._borderLineSizePx||0))/2;var t=this._borderLineSizePx?p:0;const {xmin:w,ymin:z,xmax:u,ymax:y,x:A,y:v,width:x,height:C}=this.bounds,B=[w-8,z-8],E=[u+8,z-8],D=[w-8,y+8],F=[u+8,y+8],G=a([[B[0]-p,B[1]-p],[E[0]+p,E[1]-p],[B[0]+t,B[1]+t],[E[0]-t,E[1]+t]],f),H=a([[D[0]+t,D[1]-t],[F[0]-t,F[1]-t],[D[0]-p,D[1]+p],[F[0]+p,F[1]+p]],f),I=a([[B[0]-p,B[1]-p],[B[0]+t,B[1]+t],[D[0]-p,D[1]+p],[D[0]+t,D[1]-t]],f);t=
a([[E[0]-t,E[1]+t],[E[0]+p,E[1]-p],[F[0]-t,F[1]-t],[F[0]+p,F[1]+p]],f);f={main:a([B,E,D,F],f),top:G,bot:H,left:I,right:t};return[new c(A,v,x+2*p,C+2*p),f]}get boundsT(){var f=this.bounds;const p=d.set(m.create(),f.x,f.y);d.transformMat2d(p,p,this._transform);return this._hasRotation?(f=Math.max(f.width,f.height),new c(p[0],p[1],f,f)):new c(p[0],p[1],f.width,f.height)}_createBounds(f){let p=Infinity,t=Infinity,w=0;var z=0;for(const u of f)p=Math.min(p,u.xTopLeft),t=Math.min(t,u.yTopLeft),w=Math.max(w,
u.xBottomRight),z=Math.max(z,u.yBottomRight);f=w-p;z-=t;return new c(p+f/2,t+z/2,f,z)}_createGlyphTransform(f,p){const t=b*p.angle,w=n.create(),z=m.create();q.translate(w,w,d.set(z,p.xOffset,-p.yOffset));p.useCIMAngleBehavior?q.rotate(w,w,t):(q.translate(w,w,d.set(z,f.x,f.y)),q.rotate(w,w,t),q.translate(w,w,d.set(z,-f.x,-f.y)));return w}}class r{constructor(f,p,t,w,z,u){this.startY=this.startX=this.glyphWidthEnd=0;this.start=Math.max(0,Math.min(p,t));this.end=Math.max(0,Math.max(p,t));this.end<f.length&&
(this.glyphWidthEnd=f[this.end].metrics.width);this.width=w;this.yMin=z;this.yMax=u}}l.ShapedGlyph=k;l.ShapingInfo=e;l.shapeGlyphs=function(f,p){const t=p.scale,w=[],{glyphs:z,isRightToLeft:u}=f,y=[];var A=1/p.scale*p.maxLineWidth,v=u?z.length-1:0,x=u?-1:z.length,C=u?-1:1,B=v,E=0,D=0,F=B;let G=F,H=0,I=Infinity,K=0;for(;B!==x;){const {code:R,metrics:S}=z[B];var L=Math.abs(S.top);10!==R&&32!==R&&(I=Math.min(I,L),K=Math.max(K,L+S.height));10===R?(B!==v&&(y.push(new r(z,F,B-C,E,Infinity===I?0:I,K)),I=
Infinity,K=0),E=0,F=B+C,G=B+C,D=0):32===R?(G=B+C,D=0,H=S.advance,E+=S.advance):(E>A&&(G!==F?(L=G-2*C,E-=H,y.push(new r(z,F,L,E-D,I,K)),I=Infinity,K=0,F=G,E=D):(y.push(new r(z,F,B-C,E,I,K)),I=Infinity,K=0,G=F=B,E=0)),E+=S.advance,D+=S.advance);B+=C}A=new r(z,F,B-C,E,I,K);0<=A.start&&A.end<z.length&&y.push(A);if(y.length){A=0;for(v=0;v<y.length;v++)({width:x}=y[v]),A=Math.max(x,A);v=y[0].yMin;A={x:0,y:v,height:y[y.length-1].yMax+p.lineHeight*(y.length-1)+("underline"===p.decoration?4:0)-v,width:A}}else A=
{x:0,y:0,height:0,width:0};v=A;A=h.getXAnchorDirection(p.horizontalAlignment);x=h.getYAnchorDirection(p.verticalAlignment);C=x===h.VAlign.Baseline?1:0;v=(1-C)*-v.y+v.height/2*(C?0:x-1)+-22*(C?1:0);for(x=0;x<y.length;x++){const {start:R,end:S,width:W}=y[x];C=W/2*(A+1)*-1-3;B=(f.isRightToLeft?y.length-1-x:x)*p.lineHeight+v-3;y[x].startX=C;y[x].startY=B;for(E=R;E<=S;E++)D=z[E],10!==D.code&&(F=new k(C+D.metrics.left,B-D.metrics.top,D,t),C+=D.metrics.advance,w.push(F))}return new e(w,y,p)};Object.defineProperty(l,
Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/alignmentUtils":function(){define(["exports","../../../../core/Logger"],function(l,q){l.HAlign=void 0;(function(n){n[n.Left=-1]="Left";n[n.Center=0]="Center";n[n.Right=1]="Right"})(l.HAlign||(l.HAlign={}));l.VAlign=void 0;(function(n){n[n.Top=1]="Top";n[n.Center=0]="Center";n[n.Bottom=-1]="Bottom";n[n.Baseline=2]="Baseline"})(l.VAlign||(l.VAlign={}));l.getAlignmentFromPlacement=function(n){switch(n){case "above-left":case "esriServerPointLabelPlacementAboveLeft":return["right",
"bottom"];case "above-center":case "above-along":case "esriServerPointLabelPlacementAboveCenter":case "esriServerLinePlacementAboveAlong":return["center","bottom"];case "above-right":case "esriServerPointLabelPlacementAboveRight":return["left","bottom"];case "center-left":case "esriServerPointLabelPlacementCenterLeft":return["right","middle"];case "center-center":case "center-along":case "esriServerPointLabelPlacementCenterCenter":case "esriServerLinePlacementCenterAlong":return["center","middle"];
case "center-right":case "esriServerPointLabelPlacementCenterRight":return["left","middle"];case "below-left":case "esriServerPointLabelPlacementBelowLeft":return["right","top"];case "below-center":case "below-along":case "esriServerPointLabelPlacementBelowCenter":case "esriServerLinePlacementBelowAlong":return["center","top"];case "below-right":case "esriServerPointLabelPlacementBelowRight":return["left","top"];case "always-horizontal":case "esriServerPolygonPlacementAlwaysHorizontal":return["center",
"middle"];default:return console.debug(`Found invalid placement type ${n}`),["center","middle"]}};l.getJustification=function(n){switch(n){case "left":return l.HAlign.Left;case "right":return l.HAlign.Right;case "center":return l.HAlign.Center}};l.getXAnchorDirection=function(n){if(!n)return l.HAlign.Center;switch(n){case "Left":case "left":return l.HAlign.Left;case "Right":case "right":return l.HAlign.Right;case "Justify":return q.getLogger("esri.views.2d.engine.webgl.alignmentUtils").warnOnce("Horizontal alignment 'justify' is not implemented. Falling back to 'center'."),
l.HAlign.Center;case "Center":case "center":return l.HAlign.Center}};l.getXDirection=function(n){switch(n){case l.HAlign.Right:case "right":return-1;case l.HAlign.Center:case "center":return 0;case l.HAlign.Left:case "left":return 1;default:return console.debug(`Found invalid horizontal alignment ${n}`),0}};l.getYAnchorDirection=function(n){if(!n)return l.VAlign.Center;switch(n){case "Top":case "top":return l.VAlign.Top;case "Center":case "middle":return l.VAlign.Center;case "Baseline":case "baseline":return l.VAlign.Baseline;
case "Bottom":case "bottom":return l.VAlign.Bottom}};l.getYDirection=function(n){switch(n){case l.VAlign.Top:case "top":return 1;case l.VAlign.Center:case "middle":return 0;case l.VAlign.Bottom:case l.VAlign.Baseline:case "baseline":case "bottom":return-1;default:return console.debug(`Found invalid vertical alignment ${n}`),0}};l.isMapAligned=function(n){switch(n){case "above-along":case "below-along":case "center-along":case "esriServerLinePlacementAboveAlong":case "esriServerLinePlacementBelowAlong":case "esriServerLinePlacementCenterAlong":return!0;
default:return!1}};Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/Rect":function(){define(function(){class l{constructor(q=0,n=0,d=0,m=0){this.x=q;this.y=n;this.width=d;this.height=m}get isEmpty(){return 0>=this.width||0>=this.height}union(q){this.x=Math.min(this.x,q.x);this.y=Math.min(this.y,q.y);this.width=Math.max(this.width,q.width);this.height=Math.max(this.height,q.height)}}return l})},"esri/views/2d/engine/webgl/collisions/BoundingBox":function(){define(["../../../../../core/libs/gl-matrix-2/factories/vec2f32"],
function(l){class q{constructor(n,d,m,h){this.transformedY=this.transformedX=0;this.center=l.fromValues(n,d);this.centerT=l.create();this.halfWidth=m/2;this.halfHeight=h/2;this.width=m;this.height=h}get x(){return this.center[0]}get y(){return this.center[1]}get blX(){return this.center[0]+this.halfWidth}get blY(){return this.center[1]+this.halfHeight}get trX(){return this.center[0]-this.halfWidth}get trY(){return this.center[1]-this.halfHeight}get xmin(){return this.x-this.halfWidth}get xmax(){return this.x+
this.halfWidth}get ymin(){return this.y-this.halfHeight}get ymax(){return this.y+this.halfHeight}set x(n){this.center[0]=n}set y(n){this.center[1]=n}clone(){return new q(this.x,this.y,this.width,this.height)}serialize(n){n.writeF32(this.center[0]);n.writeF32(this.center[1]);n.push(this.width);n.push(this.height);return n}findCollisionDelta(n,d=4){return Math.log2(Math.min((n.halfWidth+this.halfWidth+d)/Math.abs(n.centerT[0]-this.centerT[0]),(n.halfHeight+this.halfHeight+d)/Math.abs(n.centerT[1]-this.centerT[1])))}extend(n){const d=
Math.min(this.xmin,n.xmin),m=Math.min(this.ymin,n.ymin),h=Math.max(this.xmax,n.xmax)-d;n=Math.max(this.ymax,n.ymax)-m;this.width=h;this.height=n;this.halfWidth=h/2;this.halfHeight=n/2;this.x=d+h/2;this.y=m+n/2}static deserialize(n){const d=n.readF32(),m=n.readF32(),h=n.readInt32();n=n.readInt32();return new q(d,m,h,n)}}return q})},"esri/views/2d/layers/graphics/graphicsUtils":function(){define("exports ../../../../core/screenUtils ../../../../geometry/Polygon ../../../../geometry/support/aaBoundingRect ../../../../geometry/support/spatialReferenceUtils ../../engine/webgl/definitions".split(" "),
function(l,q,n,d,m,h){l.getLineWidth=function(g){const c=q.px2pt(h.minTextLineWidth),a=q.px2pt(h.maxTextLineWidth);return Math.max(c,Math.min(g||a,a))};l.intersectingInternationalDateline=function(g,c){c=m.getInfo(c);if(!c)return null;const [a,b]=c.valid;return g[2]>b?[d.create([g[0],g[1],b,g[3]]),d.create([a,g[1],a+g[2]-b,g[3]])]:g[0]<a?[d.create([a,g[1],g[2],g[3]]),d.create([b-(a-g[0]),g[1],b,g[3]])]:null};l.isMarkerSymbol=function(g){return"simple-marker"===g||"picture-marker"===g||"esriSMS"===
g||"esriPMS"===g};l.isTextSymbol=function(g){return"text"===g||"esriTS"===g};l.pixelBuffer=50;l.polygonFromExtent=function(g){if(!g)return null;const {xmin:c,ymin:a,xmax:b,ymax:k,spatialReference:e}=g;return new n({rings:[[[c,a],[c,k],[b,k],[b,a],[c,a]]],spatialReference:e})};l.roundPtToWholePixel=function(g){return q.px2pt(Math.round(q.pt2px(g)))};l.tileSize=512;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/GeometryUtils":function(){define(["exports",
"../../../../geometry/support/coordsUtils","../../../../geometry/support/TileClipper"],function(l,q,n){function d(b,k){b%=k;return 0<=b?b:b+k}const m=Number.POSITIVE_INFINITY,h=Math.PI,g=128/h,c=256/360,a=1/Math.LN2;l.between=function(b,k,e){return b>=k&&b<=e||b>=e&&b<=k};l.c2pi=2*h;l.cDegTo256=c;l.cDegToRad=h/180;l.cInfinity=m;l.cPi=h;l.cRadTo256=g;l.degToByte=function(b){return d(b*c,256)};l.distanceFromToPolylineWithinThreshold=function(b,k,e,r){let f,p,t;r*=r;for(const w of e){const z=w.length;
if(!(2>z)){e=w[0].x;f=w[0].y;for(let u=1;u<z;++u){p=w[u].x;t=w[u].y;if(q.distanceToSegmentSquared(b,k,e,f,p,t)<r)return!0;e=p;f=t}}}return!1};l.getTileMargins=function(b){return 8+Math.max(16*(b-14),0)};l.interpolate=function(b,k,e){return b*(1-e)+k*e};l.isCircleOverlapingRect=function(b,k,e,r,f,p,t){k=Math.max(r,Math.min(k,p))-k;e=Math.max(f,Math.min(e,t))-e;return k*k+e*e<=b*b};l.log2=function(b){return Math.log(b)*a};l.offsetLine=function(b,k){if(0===k||Number.isNaN(k))return b;const e=[],r=new n.Point(0,
0),f=new n.Point(0,0),p=new n.Point(0,0);for(let w=0;w<b.length;w++){const z=b[w],u=[];for(let y=0;y<z.length;y++){var t=z[y-1];const A=z[y],v=z[y+1];0===y?r.setCoords(0,0):r.assignSub(A,t).normalize().rightPerpendicular();y===z.length-1?f.setCoords(0,0):f.assignSub(v,A).normalize().rightPerpendicular();p.assignAdd(r,f).normalize();t=p.x*f.x+p.y*f.y;0!==t&&p.scale(1/t);u.push(n.Point.add(A,p.scale(k)))}e.push(u)}return e};l.pointInPolygon=function(b,k,e){let r=0,f,p;for(const t of e){e=t.length;for(let w=
1;w<e;++w)f=t[w-1],p=t[w],f.y>k!==p.y>k&&(0<(p.x-f.x)*(k-f.y)-(p.y-f.y)*(b-f.x)?r++:r--)}return 0!==r};l.positiveMod=d;l.radToByte=function(b){return d(b*g,256)};l.sqr=function(b){return b*b};l.translateAnchor=function(b,k,e,r){b=new n.Point(b[0],b[1]);b.scale(r);"viewport"===k&&(k=Math.PI/180*-e,b.rotate(Math.cos(k),Math.sin(k)));return b};Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/effects/CIMEffectHelper":function(){define("exports ../../../geometry/GeometryCursor ../../../geometry/geometryCursorCollectUtils ../CIMEffects ../CIMOperators ../CIMSymbolHelper".split(" "),
function(l,q,n,d,m,h){const g=96/72;class c{static executeEffects(a,b,k,e){const r=h.getEffectsInflateSize(a);b=new d.SimpleEffectCursor(b);for(const f of a)(a=m.getEffectOperator(f))&&(b=a.execute(b,f,g,k,e,r));return b}static applyEffects(a,b,k){if(!a)return b;var e=h.getEffectsInflateSize(a);b=new d.SimpleEffectCursor(q.GeometryCursor.fromJSONCIM(b));for(var r of a)(a=m.getEffectOperator(r))&&(b=a.execute(b,r,1,null,k,e));e=[];for(r=null;k=b.next();)e.push(...n.collectMultipath(k)),r=k.geometryType;
return 0===e.length||null===r?null:"esriGeometryPolygon"===r?{rings:e}:{paths:e}}}l.CIMEffectHelper=c;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/Container":function(){define("exports ../../../core/accessorSupport/tracking ../../../core/accessorSupport/tracking/SimpleObservable ../../../core/libs/gl-matrix-2/factories/mat3f32 ../../../layers/effects/EffectView ./DisplayObject".split(" "),function(l,q,n,d,m,h){class g extends h.DisplayObject{constructor(){super(...arguments);
this._childrenSet=new Set;this._needsSort=!1;this._children=[];this._childrenObservable=new n.SimpleObservable;this._highlightGradient=this._effectView=null}get blendMode(){return this._blendMode}set blendMode(c){this._blendMode=c;this.requestRender()}get children(){q.trackAccess(this._childrenObservable);return this._children}get clips(){return this._clips}set clips(c){this._clips=c;this.children.forEach(a=>a.clips=c)}get computedEffects(){return this._effectView?.effects??null}get effect(){return this._effectView?.effect??
""}set effect(c){if(this._effectView||c)this._effectView||(this._effectView=new m.EffectView,this.addTransitionable(this._effectView)),this._effectView.effect=c,this.requestRender()}get highlightGradient(){return this._highlightGradient}set highlightGradient(c){this._highlightGradient=c;this.requestRender()}get hasBlending(){return!!this.blendMode}get hasHighlight(){return this.children.some(c=>c.hasHighlight)}get hasLabels(){return this.children.some(c=>c.hasLabels)}get requiresDedicatedFBO(){return this.children.some(c=>
"blendMode"in c&&c.blendMode&&"normal"!==c.blendMode)}get isReady(){return this.children.every(c=>c.isReady)}get sortFunction(){return this._sortFunction}set sortFunction(c){if(this._sortFunction=c)this._needsSort=!0}doRender(c){c=this.createRenderParams(c);const {painter:a}=c;a.beforeRenderLayer(c,this._clips?.length?255:0,this.computedOpacity);this.renderChildren(c);a.afterRenderLayer(c,this.computedOpacity)}addChild(c){return this.addChildAt(c,this.children.length)}addChildAt(c,a=this.children.length){if(!c||
this.contains(c))return c;this._needsSort=!0;const b=c.parent;b&&b!==this&&b.removeChild(c);a>=this.children.length?this.children.push(c):this.children.splice(a,0,c);this._childrenSet.add(c);c.parent=this;c.stage=this.stage;this!==this.stage&&(c.clips=this.clips);this.requestRender();this._childrenObservable.notify();return c}contains(c){q.trackAccess(this._childrenObservable);return this._childrenSet.has(c)}removeAllChildren(){this._childrenSet.clear();this._needsSort=!0;for(const c of this.children)this!==
this.stage&&(c.clips=null),c.stage=null,c.parent=null;this.children.length=0;this._childrenObservable.notify()}removeChild(c){return this.contains(c)?this.removeChildAt(this.children.indexOf(c)):c}removeChildAt(c){if(0>c||c>=this.children.length)return null;this._needsSort=!0;c=this.children.splice(c,1)[0];this._childrenSet.delete(c);this!==this.stage&&(c.clips=null);c.stage=null;c.parent=null;this._childrenObservable.notify();return c}beforeRender(c){super.beforeRender(c);this.sortFunction&&this._needsSort&&
(this.children.sort(this.sortFunction),this._needsSort=!1,this._childrenObservable.notify());for(const a of this.children)a.beforeRender(c)}afterRender(c){super.afterRender(c);for(const a of this.children)a.afterRender(c)}_createTransforms(){return{displayViewScreenMat3:d.create()}}onAttach(){super.onAttach();const c=this.stage;for(const a of this.children)a.stage=c}onDetach(){super.onDetach();for(const c of this.children)c.stage=null}renderChildren(c){for(const a of this.children)a.processRender(c)}createRenderParams(c){return{...c,
requireFBO:this.requiresDedicatedFBO,blendMode:this.blendMode,effects:this.computedEffects,globalOpacity:c.globalOpacity*this.computedOpacity,inFadeTransition:this.inFadeTransition,highlightGradient:this._highlightGradient||c.highlightGradient}}isTransitioning(){return super.isTransitioning()||this.children.some(c=>c.transitioning)}}l.Container=g;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/layers/effects/EffectView":function(){define("exports ../../chunks/tslib.es6 ../../core/Accessor ../../core/has ../../core/lang ../../core/Logger ../../core/accessorSupport/decorators/property ../../core/accessorSupport/decorators/subclass ./parser ./utils".split(" "),
function(l,q,n,d,m,h,g,c,a,b){function k(f){f=a.parse(f)||[];var p=(p=f[0])?"type"in p:!1;return p?[{scale:-1,effects:f}]:f}function e(f,p,t){return f[0]?.effects&&p[0]?.effects?(-1===f[0]?.scale||-1===p[0]?.scale)&&(1<f.length||1<p.length)&&0>=t?!1:b.canInterpolateEffects(f[0].effects,p[0].effects):!0}function r(f,p,t){const w=f.length>p.length?f:p;f=f.length>p.length?p:f;var z=f[f.length-1];p=z?.scale??t;z=z?.effects??[];for(let u=f.length;u<w.length;u++)f.push({scale:p,effects:[...z]});for(p=0;p<
w.length;p++)f[p].scale=-1===f[p].scale?t:f[p].scale,w[p].scale=-1===w[p].scale?t:w[p].scale,b.normalizeEffects(f[p].effects,w[p].effects)}l.EffectView=class extends n{constructor(f){super(f);this._final=this._to=this._from=null;this._current=[];this._time=0;this.duration=d("mapview-transitions-duration");this.effects=[]}set effect(f){const p=this._get("effect");f=f||"";if(p!==f){this._set("effect",f);try{this._transitionTo(k(f))}catch(t){this._transitionTo([]),h.getLogger(this).warn("Invalid Effect",
{effect:f,error:t})}}}get final(){return this._final}get hasEffects(){return this.transitioning||!!this.effects.length}set scale(f){this._updateForScale(f)}get transitioning(){return null!==this._to}canTransitionTo(f){try{return 0<this.scale&&e(this._current,k(f),this.scale)}catch{return!1}}transitionStep(f,p){this._applyTimeTransition(f);this._updateForScale(p)}endTransition(){this._applyTimeTransition(this.duration)}_transitionTo(f){0<this.scale&&e(this._current,f,this.scale)?(this._final=f,this._to=
m.clone(f),r(this._current,this._to,this.scale),this._from=m.clone(this._current),this._time=0):(this._from=this._to=this._final=null,this._current=f);this._set("effects",this._current[0]?m.clone(this._current[0].effects):[])}_applyTimeTransition(f){if(this._to&&this._from&&this._current&&this._final){this._time+=f;f=Math.min(1,this._time/this.duration);for(let t=0;t<this._current.length;t++){const w=this._current[t],z=this._from[t],u=this._to[t];var p=z.scale;w.scale=p+(u.scale-p)*f;for(p=0;p<w.effects.length;p++)w.effects[p].interpolate(z.effects[p],
u.effects[p],f)}1===f&&(this._current=this._final,this._set("effects",this._current[0]?m.clone(this._current[0].effects):[]),this._from=this._to=this._final=null)}}_updateForScale(f){this._set("scale",f);if(0!==this._current.length){var p=this._current,t=this._current.length-1,w,z=1;if(1===p.length||f>=p[0].scale)var u=w=p[0].effects;else if(f<=p[t].scale)u=w=p[t].effects;else for(let y=0;y<t;y++){const A=p[y],v=p[y+1];if(A.scale>=f&&v.scale<=f){z=(f-A.scale)/(v.scale-A.scale);w=A.effects;u=v.effects;
break}}for(f=0;f<this.effects.length;f++)this.effects[f].interpolate(w[f],u[f],z)}}};q.__decorate([g.property()],l.EffectView.prototype,"_to",void 0);q.__decorate([g.property()],l.EffectView.prototype,"duration",void 0);q.__decorate([g.property({value:""})],l.EffectView.prototype,"effect",null);q.__decorate([g.property({readOnly:!0})],l.EffectView.prototype,"effects",void 0);q.__decorate([g.property({readOnly:!0})],l.EffectView.prototype,"final",null);q.__decorate([g.property({readOnly:!0})],l.EffectView.prototype,
"hasEffects",null);q.__decorate([g.property({value:0})],l.EffectView.prototype,"scale",null);q.__decorate([g.property({readOnly:!0})],l.EffectView.prototype,"transitioning",null);l.EffectView=q.__decorate([c.subclass("esri.layers.effects.EffectView")],l.EffectView);l.canInterpolateEffectStops=e;l.convertEffectToStops=k;l.normalizeEffectStops=r;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/DisplayObject":function(){define(["exports","../../../core/arrayUtils",
"../../../core/Evented","./transitions/FadeTransition"],function(l,q,n,d){class m extends n{constructor(){super(...arguments);this._fadeTransition=this._clips=this._transitionables=null;this._isReady=!1;this._opacity=1;this._stage=this.parent=null;this._visible=!0}get computedOpacity(){return this._fadeTransition?.computedOpacity??this.opacity}get clips(){return this._clips}set clips(h){this._clips=h;this.requestRender()}get fadeTransitionEnabled(){return null!==this._fadeTransition}set fadeTransitionEnabled(h){!this._fadeTransition&&
h?(this._fadeTransition=new d.FadeTransition({opacity:this.opacity,visible:this.visible}),this.addTransitionable(this._fadeTransition)):this._fadeTransition&&!h&&(this.removeTransitionable(this._fadeTransition),this._fadeTransition=null)}get inFadeTransition(){return this._fadeTransition?.transitioning??!1}get isReady(){return this._isReady}get opacity(){return this._opacity}set opacity(h){this._opacity!==h&&(this._opacity=Math.min(1,Math.max(h,0)),this._fadeTransition&&(this._fadeTransition.opacity=
this._opacity),this.requestRender())}get stage(){return this._stage}set stage(h){if(this._stage!==h){var g=this._stage;(this._stage=h)?this._stage?.untrashDisplayObject(this)||(this.onAttach(),this.emit("attach")):g?.trashDisplayObject(this)}}get transforms(){null==this._transforms&&(this._transforms=this._createTransforms());return this._transforms}get transitioning(){return this.isTransitioning()}get visible(){return this._visible}set visible(h){this._visible!==h&&(this._visible=h,this._fadeTransition&&
(this._fadeTransition.visible=this._visible),this.requestRender())}get hasLabels(){return!1}get hasHighlight(){return!1}get hasBlending(){return!1}addTransitionable(h){this._transitionables??(this._transitionables=[]);this._transitionables.push(h);this.requestRender()}removeTransitionable(h){h.endTransition();this._transitionables&&q.remove(this._transitionables,h);this.requestRender()}fadeIn(){this.fadeTransitionEnabled=!0;const h=this._fadeTransition.fadeIn();this.opacity=1;this.requestRender();
return h}fadeOut(){this.fadeTransitionEnabled=!0;const h=this._fadeTransition.fadeOut();this.opacity=0;this.requestRender();return h}endTransitions(){if(this._transitionables){for(const h of this._transitionables)h.endTransition();this.requestRender()}}beforeRender(h){this.transitionStep(h.deltaTime,h.state.scale);this.setTransform(h.state)}afterRender(h){this.transitioning&&this.requestRender()}remove(){this.parent?.removeChild(this)}setTransform(h){}processRender(h){this.stage&&(this._fadeTransition?.computedVisible??
this.visible)&&this.doRender(h)}requestRender(){this.stage&&this.stage.requestRender()}processDetach(){this.endTransitions();this.onDetach();this.emit("detach")}isTransitioning(){return this._transitionables?.some(h=>h.transitioning)??!1}transitionStep(h,g){if(this._transitionables)for(const c of this._transitionables)c.transitionStep(h,g)}onAttach(){}onDetach(){}doRender(h){}ready(){this._isReady||(this._isReady=!0,this.emit("isReady"),this.requestRender())}}l.DisplayObject=m;Object.defineProperty(l,
Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/transitions/FadeTransition":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/has ../../../../core/promiseUtils ../../../../core/accessorSupport/decorators/property ../../../../core/Logger ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass".split(" "),function(l,q,n,d,m,h,g,c,a){l.FadeTransition=class extends n{constructor(b){super(b);this.computedOpacity=1;this.computedVisible=
!0;this.opacity=1;this.visible=!0;this._fadeInResolver=this._fadeOutResolver=null}get transitioning(){return(this._fadeOutResolver||!this.visible?0:this.opacity)!==this.computedOpacity}endTransition(){this._fadeInResolver?.();this._fadeOutResolver?.();this._fadeInResolver=this._fadeOutResolver=null;this.computedOpacity=this.visible?this.opacity:0}fadeIn(){if(this._fadeInResolver)return this._fadeInResolver.promise;this.opacity=1;this.computedOpacity=0;this._fadeOutResolver?.();this._fadeOutResolver=
null;this._fadeInResolver=m.createResolver();return this._fadeInResolver.promise}fadeOut(){if(this._fadeOutResolver)return this._fadeOutResolver.promise;this.opacity=0;this._fadeInResolver?.();this._fadeInResolver=null;this._fadeOutResolver=m.createResolver();return this._fadeOutResolver.promise}transitionStep(b,k){const e=(k=d("mapview-transitions-duration"))?1/k:0;if(0===e)this.computedOpacity=this.opacity,this.computedVisible=this.visible;else{k=this._fadeOutResolver||!this.visible?0:this.opacity;
const r=this.computedOpacity;r===k?this.computedVisible=this.visible:(b*=e,this.computedOpacity=r>k?Math.max(k,r-b):Math.min(k,r+b),this.computedVisible=0<this.computedOpacity)}this.transitioning||(this._fadeInResolver?.(),this._fadeOutResolver?.(),this._fadeOutResolver=this._fadeInResolver=null)}};q.__decorate([h.property()],l.FadeTransition.prototype,"computedOpacity",void 0);q.__decorate([h.property()],l.FadeTransition.prototype,"computedVisible",void 0);q.__decorate([h.property()],l.FadeTransition.prototype,
"opacity",void 0);q.__decorate([h.property()],l.FadeTransition.prototype,"visible",void 0);q.__decorate([h.property()],l.FadeTransition.prototype,"transitioning",null);q.__decorate([h.property()],l.FadeTransition.prototype,"_fadeOutResolver",void 0);q.__decorate([h.property()],l.FadeTransition.prototype,"_fadeInResolver",void 0);l.FadeTransition=q.__decorate([a.subclass("esri.views.2d.engine.transitions.FadeTransition")],l.FadeTransition);Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},
"esri/views/2d/engine/ManagedCanvas":function(){define("exports ../../../core/Evented ../../../core/events ../../../core/handleUtils ../../../core/has ../../../core/mathUtils ../../../core/libs/gl-matrix-2/math/mat2d ../../../core/libs/gl-matrix-2/factories/mat2df64".split(" "),function(l,q,n,d,m,h,g,c){class a{constructor(b){this.events=new q;this._hasMajorPerformanceCaveat=!1;this._lastRenderFrameCounter=0;this._canvas=document.createElement("canvas");this._canvas.setAttribute("style","width: 100%; height:100%; display:block; willChange:transform");
const k={failIfMajorPerformanceCaveat:!0,alpha:!0,antialias:!1,depth:!0,stencil:!0,powerPreference:"high-performance"};b.appendChild(this._canvas);b=this._canvas.getContext("webgl2",k);b||(b=this._canvas.getContext("webgl2",{...k,failIfMajorPerformanceCaveat:!1}),this._hasMajorPerformanceCaveat=!0);this._gl=b;this._handles=d.handlesGroup([n.on(this._canvas,"webglcontextlost",e=>this.events.emit("webgl-context-lost",e))])}destroy(){this._canvas.parentNode?.removeChild(this._canvas);this._canvas=null;
this._handles.remove();this._gl=null}get gl(){return this._gl}render(b,k){if(this._hasMajorPerformanceCaveat||m("esri-force-performance-mode")){if(++this._lastRenderFrameCounter>=m("esri-performance-mode-frames-between-render")&&(k(),this._lastRenderViewState=b.state.clone(),this._lastRenderFrameCounter=0),this._lastRenderViewState){const [e,r,f,p,t,w]=this._computeViewTransform(this._lastRenderViewState,b.state);this._canvas.style.transform=`matrix(${e}, ${r}, ${f}, ${p}, ${t}, ${w})`}}else k()}resize(b){const k=
this._canvas,e=k.style,{state:{size:r},pixelRatio:f}=b;b=r[0];const p=r[1],t=Math.round(b*f),w=Math.round(p*f);if(k.width!==t||k.height!==w)k.width=t,k.height=w;e.width=b+"px";e.height=p+"px"}_computeViewTransform(b,k){const [e,r]=b.center,[f,p]=k.center,[t,w]=b.toScreen([0,0],f,p),[z,u]=b.toScreen([0,0],e,r),y=z-t,A=u-w,v=b.scale/k.scale;b=k.rotation-b.rotation;k=c.create();g.identity(k);g.scale(k,k,[v,v]);g.rotate(k,k,h.deg2rad(b));g.translate(k,k,[y,A]);return k}}l.ManagedCanvas=a;Object.defineProperty(l,
Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/Painter":function(){define("../../../../core/has ../../../../core/maybe ../brushes ../vectorTiles/shaders/VTLMaterialManager ./BitBlitRenderer ./definitions ./enums ./MaterialManager ./TextureManager ./TextureUploadManager ./WorldExtentClipRenderer ./effects/BlendEffect ./effects/FeatureEffect ./effects/HighlightEffect ./effects/HittestEffect ./effects/post-processing/EffectManager ./meshing/SimpleMesh ./painter/RenderPass ./shaderGraph/techniques/TechniqueProgramCache ../../../webgl/enums ../../../webgl/FramebufferObject ../../../webgl/Renderbuffer ../../../webgl/RenderbufferDescriptor ../../../webgl/TextureDescriptor".split(" "),
function(l,q,n,d,m,h,g,c,a,b,k,e,r,f,p,t,w,z,u,y,A,v,x,C){function B(D,F,G,H){return D!==g.WGLDrawPhase.LABEL_ALPHA&&D!==g.WGLDrawPhase.LABEL&&D!==g.WGLDrawPhase.HIGHLIGHT&&(1!==H||null!=F&&"normal"!==F||null!=G&&0<G.length)}class E{constructor(D,F){this.context=D;this._currentPipelineStateNeedsUpdate=!1;this._blitRenderer=new m.BitBlitRenderer;this._worldExtentRenderer=new k.WorldExtentRenderer;this._brushCache=new Map;this._lastHeight=this._lastWidth=null;this._vtlMaterialManager=new d;this._blendEffect=
new e.BlendEffect;this._stencilBuf=null;this._prevBeforeLayerFBOStack=[];this._fboPool=[];this.effects={highlight:new f,hittest:new p.HittestEffect,insideEffect:new r.FeatureEffect("inside"),outsideEffect:new r.FeatureEffect("outside")};this._programCache=new u.TechniqueProgramCache;this._shaderState={shader:null,uniforms:null,defines:null,optionalAttributes:null,useComputeBuffer:!1};this.materialManager=new c(D);this.textureManager=new a(F);this.textureUploadManager=new b.TextureUploadManager(F);
this._effectsManager=new t.EffectManager;this._quadMesh=w.SimpleMesh.fromVertexStream(D,[0,0,1,0,0,1,1,1])}dispose(){this._programCache.destroy();this.materialManager.dispose();this.textureManager.dispose();this.textureUploadManager.destroy();this._blitRenderer=q.disposeMaybe(this._blitRenderer);this._worldExtentRenderer=q.disposeMaybe(this._worldExtentRenderer);this._quadMesh=q.destroyMaybe(this._quadMesh);this._brushCache&&(this._brushCache.forEach(D=>D.dispose()),this._brushCache.clear(),this._brushCache=
null);if(this._fbos){let D;for(D in this._fbos)this._fbos[D]&&this._fbos[D].dispose()}for(const D of this._fboPool)D.dispose();this._fboPool.length=0;if(this.effects){let D;for(D in this.effects)this.effects[D]&&this.effects[D].dispose()}this._effectsManager.dispose();this._blendEffect.dispose(this.context);this._vtlMaterialManager=q.disposeMaybe(this._vtlMaterialManager)}clearShaderCache(){this._programCache.destroy();this._programCache=new u.TechniqueProgramCache}get blitRenderer(){return this._blitRenderer}get vectorTilesMaterialManager(){return this._vtlMaterialManager}get quadMesh(){return this._quadMesh}getFbos(){if(!this._fbos)throw Error("InternalError: Painter FBOs not initialized");
return this._fbos}acquireFbo(D,F){if(0<this._fboPool.length)var G=this._fboPool.pop();else G=new C.TextureDescriptor(D,F),G.samplingMode=y.TextureSamplingMode.NEAREST,G.wrapMode=y.TextureWrapMode.CLAMP_TO_EDGE,G=new A.FramebufferObject(this.context,G,this._stencilBuf);G.width===D&&G.height===F||G.resize(D,F);return G}releaseFbo(D){this._fboPool.push(D)}getSharedStencilBuffer(){return this._stencilBuf}beforeRenderPhases(D,F,G){const {context:H}=D;this._worldExtentRenderer.render(D,F,G);const {width:I,
height:K}=H.getViewport();this.updateFBOs(I,K);this._prevFBO=H.getBoundFramebufferObject();H.bindFramebuffer(this.getFbos().output);H.setColorMask(!0,!0,!0,!0);if(null!=F){const {r:L,g:R,b:S,a:W}=F;H.setClearColor(W*L/255,W*R/255,W*S/255,W)}else H.setClearColor(0,0,0,0);H.setDepthWriteEnabled(!0);H.setClearDepth(1);H.clear(H.gl.COLOR_BUFFER_BIT|H.gl.DEPTH_BUFFER_BIT);H.setDepthWriteEnabled(!1)}afterRenderPhases(D){({context:D}=D);D.bindFramebuffer(this._prevFBO);D.setStencilFunction(y.CompareFunction.EQUAL,
h.backbufferStencilVisible,255);D.setStencilTestEnabled(!0);D.setDepthTestEnabled(!1);this.blitTexture(D,this.getFbos().output.colorTexture,y.TextureSamplingMode.NEAREST)}beforeRenderLayer(D,F,G){const {context:H,blendMode:I,effects:K,drawPhase:L,requireFBO:R}=D;if(R||B(L,I,K,G)){D=H.getBoundFramebufferObject();this._prevBeforeLayerFBOStack.push(D);const {width:S,height:W}=H.getViewport();D=this.acquireFbo(S,W);H.bindFramebuffer(D);H.setColorMask(!0,!0,!0,!0);H.setClearColor(0,0,0,0);H.setDepthWriteEnabled(!0);
H.setClearDepth(1);H.clear(H.gl.COLOR_BUFFER_BIT|H.gl.DEPTH_BUFFER_BIT);H.setDepthWriteEnabled(!1)}H.setDepthWriteEnabled(!1);H.setDepthTestEnabled(!1);H.setStencilTestEnabled(!0);H.setClearStencil(F);H.setStencilWriteMask(255);H.clear(H.gl.STENCIL_BUFFER_BIT)}afterRenderLayer(D,F){const {context:G,blendMode:H,effects:I,requireFBO:K,drawPhase:L}=D;if(K||B(L,H,I,F)){const R=G.getBoundFramebufferObject();null!=I&&0<I.length&&L===g.WGLDrawPhase.MAP&&(G.setColorMask(!0,!0,!0,!0),this._applyEffects(D,
I,R));G.bindFramebuffer(this._prevBeforeLayerFBOStack.pop());G.setStencilTestEnabled(!1);G.setStencilWriteMask(0);G.setBlendingEnabled(!0);G.setBlendFunctionSeparate(y.BlendFactor.ONE,y.BlendFactor.ONE_MINUS_SRC_ALPHA,y.BlendFactor.ONE,y.BlendFactor.ONE_MINUS_SRC_ALPHA);G.setColorMask(!0,!0,!0,!0);this._blendEffect.draw(D,R.colorTexture,y.TextureSamplingMode.NEAREST,null==H||L===g.WGLDrawPhase.HIGHLIGHT||L===g.WGLDrawPhase.LABEL?"normal":H,F);this.releaseFbo(R)}}renderObject(D,F,G,H){if(G=n.brushes[G]){var I=
this._brushCache.get(G);void 0===I&&(I=new G,this._brushCache.set(G,I));I.prepareState(D);I.draw(D,F,H)}}renderObjects(D,F,G,H){if(G=n.brushes[G]){var I=this._brushCache.get(G);void 0===I&&(I=new G,this._brushCache.set(G,I));I.drawMany(D,F,H)}}registerRenderPass(D){const F=D.brushes.map(G=>{this._brushCache.has(G)||this._brushCache.set(G,new G);return this._brushCache.get(G)});return new z(F,D)}blitTexture(D,F,G,H=1){D.setBlendingEnabled(!0);D.setBlendFunctionSeparate(y.BlendFactor.ONE,y.BlendFactor.ONE_MINUS_SRC_ALPHA,
y.BlendFactor.ONE,y.BlendFactor.ONE_MINUS_SRC_ALPHA);D.setColorMask(!0,!0,!0,!0);this._blitRenderer.render(D,F,G,H);this._currentPipelineStateNeedsUpdate=!0}getPostProcessingEffects(D){return this._effectsManager.getPostProcessingEffects(D)}updateFBOs(D,F){if(D!==this._lastWidth||F!==this._lastHeight)if(this._lastWidth=D,this._lastHeight=F,this._fbos)for(var G in this._fbos)this._fbos[G].resize(D,F);else G=new C.TextureDescriptor(D,F),G.samplingMode=y.TextureSamplingMode.NEAREST,G.wrapMode=y.TextureWrapMode.CLAMP_TO_EDGE,
D=new x.RenderbufferDescriptor(y.RenderbufferFormat.DEPTH_STENCIL,D,F),this._stencilBuf=new v.Renderbuffer(this.context,D),this._fbos={output:new A.FramebufferObject(this.context,G,this._stencilBuf),effect0:new A.FramebufferObject(this.context,G,this._stencilBuf)}}_applyEffects(D,F,G){const {context:H}=D;F=this._effectsManager.getPostProcessingEffects(F);for(const {postProcessingEffect:I,effect:K}of F)H.bindFramebuffer(G),I.draw(D,G,K);this._currentPipelineStateNeedsUpdate=!0}setShader(D){this._shaderState.shader=
D.shader;this._shaderState.uniforms=D.uniforms;this._shaderState.defines=D.defines;this._shaderState.optionalAttributes=D.optionalAttributes;this._shaderState.useComputeBuffer=D.useComputeBuffer??!1}setPipelineState(D){D!==this._currentPipelineState&&(this._currentPipelineState=D,this._currentPipelineStateNeedsUpdate=!0)}submitDraw(D,F){const {shader:G,uniforms:H,defines:I,optionalAttributes:K}=this._shaderState,L=D.context;var R=F.getAttributePrecisionPackFactors();R=this._programCache.getProgram(G,
R,H,I??{},K??{});R.setUniforms(H);R.bind(L);this.updatePipelineState(L);this.setStencilRef(L,F);F.draw(D,G.locationInfo);R.cleanupTemporaryTextures();return{vertexShader:R.vertexShader,fragmentShader:R.fragmentShader}}submitDrawMesh(D,F,G,H){this.submitDrawMeshUntyped(D,F,G,H)}submitDrawMeshUntyped(D,F,G,H){this.setShader(F);const {shader:I,uniforms:K,defines:L,optionalAttributes:R}=this._shaderState;F=this._programCache.getProgram(I,{},K,L??{},R??{});F.setUniforms(K);F.bind(D);this.updatePipelineState(D);
if(H)for(const S of H)G.bind(D,S),G.draw(D);else for(H=0;H<G.parts.length;H++)G.bind(D,H),G.draw(D);G.unbind(D);F.cleanupTemporaryTextures()}updatePipelineState(D){this._currentPipelineStateNeedsUpdate&&(this._currentPipelineStateNeedsUpdate=!1,this._updatePipelineState(D))}_updatePipelineState(D){if(null==this._currentPipelineState)throw Error("Pipeline state not defined. Call setPipelineState before calling submitDraw ");const {color:F,depth:G,stencil:H}=this._currentPipelineState;if(F){const {blendMode:K,
write:L}=F;D.setColorMask(...L);D.setBlendingEnabled(!0);D.setBlendEquation(y.BlendOperation.ADD);switch(K){case "composite":D.setBlendFunctionSeparate(y.BlendFactor.ONE,y.BlendFactor.ONE_MINUS_SRC_ALPHA,y.BlendFactor.ONE,y.BlendFactor.ONE_MINUS_SRC_ALPHA);break;case "additive":D.setBlendFunctionSeparate(y.BlendFactor.ONE,y.BlendFactor.ONE,y.BlendFactor.ONE,y.BlendFactor.ONE);break;case "custom":var {blendParameters:I}=F;const {dstAlpha:R,dstRGB:S,srcAlpha:W,srcRGB:J}=I;D.setBlendFunctionSeparate(J,
S,W,R);break;case "delete":D.setBlendEquation(y.BlendOperation.REVERSE_SUBTRACT),D.setBlendFunctionSeparate(y.BlendFactor.ONE,y.BlendFactor.ONE_MINUS_SRC_ALPHA,y.BlendFactor.ONE,y.BlendFactor.ONE_MINUS_SRC_ALPHA)}}if(G){const {test:K,write:L}=G;L?(D.setDepthWriteEnabled(!0),D.setDepthRange(L.zNear,L.zFar)):D.setDepthWriteEnabled(!1);K?(D.setDepthTestEnabled(!0),D.setDepthFunction(K)):D.setDepthTestEnabled(!1)}else D.setDepthTestEnabled(!1),D.setDepthWriteEnabled(!1);if(H){const {test:K,write:L}=H;
if(K){const {compare:R,mask:S,op:W,ref:J}=K;D.setStencilTestEnabled(!0);"function"!==typeof J&&D.setStencilFunctionSeparate(y.Face.FRONT_AND_BACK,R,J,S);D.setStencilOpSeparate(y.Face.FRONT_AND_BACK,W.fail,W.zFail,W.zPass)}else D.setStencilTestEnabled(!1);L?({mask:I}=L,D.setStencilWriteMask(I)):D.setStencilWriteMask(0)}else D.setStencilTestEnabled(!1),D.setStencilWriteMask(0)}setStencilRef(D,F){if(null==this._currentPipelineState)throw Error("Pipeline state not defined. Call setPipelineState before calling submitDraw ");
var {stencil:G}=this._currentPipelineState;if(G&&({test:G}=G,G)){const {compare:H,mask:I,ref:K}=G;if("function"===typeof K){F=F.getStencilReference();if(null===F)throw Error("InternalError: Stencil reference expected for target but not defined");D.setStencilFunctionSeparate(y.Face.FRONT_AND_BACK,H,F,I)}}}}return E})},"esri/views/2d/engine/brushes":function(){define("exports ./webgl/brushes/BrushBitmap ./webgl/brushes/BrushClip ./webgl/brushes/WGLBrushStencil ./webgl/brushes/WGLBrushTileDebugInfo ./webgl/brushes/WGLBrushVTLBackground ./webgl/brushes/WGLBrushVTLCircle ./webgl/brushes/WGLBrushVTLFill ./webgl/brushes/WGLBrushVTLLine ./webgl/brushes/WGLBrushVTLSymbol".split(" "),
function(l,q,n,d,m,h,g,c,a,b){l.brushes={clip:n,stencil:d,bitmap:q,tileDebugInfo:m,vtlBackground:h.WGLBrushVTLBackground,vtlFill:c.WGLBrushVTLFill,vtlLine:a.WGLBrushVTLLine,vtlCircle:g.WGLBrushVTLCircle,vtlSymbol:b.WGLBrushVTLSymbol};Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/brushes/BrushBitmap":function(){define(["../definitions","../VertexStream","./WGLBrush","../../../../webgl/enums"],function(l,q,n,d){const m={nearest:{defines:[],samplingMode:d.TextureSamplingMode.NEAREST,
mips:!1},bilinear:{defines:[],samplingMode:d.TextureSamplingMode.LINEAR,mips:!1},bicubic:{defines:["bicubic"],samplingMode:d.TextureSamplingMode.LINEAR,mips:!1},trilinear:{defines:[],samplingMode:d.TextureSamplingMode.LINEAR_MIPMAP_LINEAR,mips:!0}};class h extends n{constructor(){super(...arguments);this._desc={vsPath:"raster/bitmap",fsPath:"raster/bitmap",attributes:new Map([["a_pos",0]])}}dispose(){this._quad&&this._quad.dispose()}prepareState({context:g}){g.setBlendingEnabled(!0);g.setColorMask(!0,
!0,!0,!0);g.setStencilWriteMask(0);g.setStencilTestEnabled(!0)}draw(g,c){const {context:a,renderingOptions:b,painter:k,requestRender:e,allowDelayedRender:r}=g;if(c.source&&c.isReady){if("dynamic"===b.samplingMode){({state:p}=g);var f=c.resolution/c.pixelRatio/p.resolution;const u=Math.round(g.pixelRatio)!==g.pixelRatio;var p=p.rotation||1.05<f||.95>f||u||c.isSourceScaled||c.rotation?m.bilinear:m.nearest}else p=m[b.samplingMode];f=k.materialManager.getProgram(this._desc,p.defines);if(r&&null!=e&&!f.compiled)e();
else{g.timeline.begin(this.name);"additive"===c.blendFunction?a.setBlendFunctionSeparate(d.BlendFactor.ONE,d.BlendFactor.ONE,d.BlendFactor.ONE,d.BlendFactor.ONE):a.setBlendFunctionSeparate(d.BlendFactor.ONE,d.BlendFactor.ONE_MINUS_SRC_ALPHA,d.BlendFactor.ONE,d.BlendFactor.ONE_MINUS_SRC_ALPHA);a.setStencilFunction(d.CompareFunction.EQUAL,c.stencilRef,255);this._quad||(this._quad=new q(a,[0,0,1,0,0,1,1,1]));var {coordScale:t,computedOpacity:w,transforms:z}=c;c.setSamplingProfile(p);c.bind(g.context,
l.textureBindingBitmap);a.useProgram(f);f.setUniformMatrix3fv("u_dvsMat3",z.displayViewScreenMat3);f.setUniform1i("u_texture",l.textureBindingBitmap);f.setUniform2fv("u_coordScale",t);f.setUniform1f("u_opacity",w);this._quad.draw();g.timeline.end(this.name)}}}}return h})},"esri/views/2d/engine/webgl/VertexStream":function(){define(["./shaderGraph/techniques/mesh/utils","../../../webgl/BufferObject","../../../webgl/enums","../../../webgl/VertexArrayObject","../../../webgl/VertexElementDescriptor"],
function(l,q,n,d,m){class h{constructor(g,c){this._rctx=g;this._attributes=[{name:"position",offset:0,type:n.DataType.SHORT,count:2}];this.layout={hash:l.vertexLayoutHash(this._attributes),attributes:this._attributes,stride:4};this._vertexBuffer=q.BufferObject.createVertex(g,n.Usage.STATIC_DRAW,new Uint16Array(c));this._vao=new d.VertexArrayObject(g,new Map([["a_position",0]]),new Map([["geometry",[new m.VertexElementDescriptor("a_position",2,n.DataType.SHORT,0,4)]]]),new Map([["geometry",this._vertexBuffer]]));
this._count=c.length/2}bind(){this._rctx.bindVAO(this._vao)}unbind(){this._rctx.bindVAO(null)}dispose(){this._vao.dispose()}draw(){this._rctx.bindVAO(this._vao);this._rctx.drawArrays(n.PrimitiveType.TRIANGLE_STRIP,0,this._count)}}return h})},"esri/views/2d/engine/webgl/shaderGraph/techniques/mesh/utils":function(){define(["exports","../../../../../../../core/string"],function(l,q){function n(d,m,h,g,c,a,b){if(d.primitiveName===m)m=g?.readWithDefault(c,a,d[h]&&b),"text"===d.type&&(m=m.toString()),
d[h]=m;else if("type"in d&&null!=d.type){if(d.effects)for(const k of d.effects)n(k,m,h,g,c,a,b);switch(d.type){case "CIMPointSymbol":case "CIMLineSymbol":case "CIMPolygonSymbol":if(d.symbolLayers)for(const k of d.symbolLayers)n(k,m,h,g,c,a,b);break;case "CIMTextSymbol":d.symbol&&n(d.symbol,m,h,g,c,a,b);break;case "CIMHatchFill":d.lineSymbol&&n(d.lineSymbol,m,h,g,c,a,b);break;case "CIMPictureMarker":case "CIMCharacterMarker":case "CIMVectorMarker":if(d.markerPlacement&&n(d.markerPlacement,m,h,g,c,
a,b),"CIMVectorMarker"===d.type&&d.markerGraphics)for(const k of d.markerGraphics)n(k,m,h,g,c,a,b),n(k.symbol,m,h,g,c,a,b)}}}l.applyComputedValue=n;l.getLineClippingMargin=function(d){const m=d.width;return null!=d.effects?400:Math.max(1.25*m,8)};l.vertexLayoutHash=function(d){d=d.map(({name:m,count:h,type:g})=>`${m}.${h}.${g}`).join(",");return q.numericHash(d)};Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/VertexElementDescriptor":function(){define(["exports"],
function(l){class q{constructor(n,d,m,h,g,c=!1,a=0){this.name=n;this.count=d;this.type=m;this.offset=h;this.stride=g;this.normalized=c;this.divisor=a}}l.VertexElementDescriptor=q;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/brushes/WGLBrush":function(){define(function(){class l{constructor(){this.name=this.constructor.name||"UnnamedBrush";this.brushEffect=null}prepareState(q,n){}draw(q,n,d){}drawMany(q,n,d){for(const m of n)m.visible&&this.draw(q,m,d)}}
return l})},"esri/views/2d/engine/webgl/brushes/BrushClip":function(){define("../../../../../core/libs/gl-matrix-2/factories/vec4f32 ../Utils ./WGLBrush ../shaders/BackgroundPrograms ../../../../webgl/enums ../../../../webgl/ProgramTemplate".split(" "),function(l,q,n,d,m,h){class g extends n{constructor(){super(...arguments);this._color=l.fromValues(0,1,0,1)}dispose(){this._program&&this._program.dispose()}prepareState({context:c}){c.setStencilTestEnabled(!0);c.setBlendingEnabled(!1);c.setFaceCullingEnabled(!1);
c.setColorMask(!1,!1,!1,!1);c.setStencilOp(m.StencilOperation.KEEP,m.StencilOperation.KEEP,m.StencilOperation.REPLACE);c.setStencilWriteMask(255);c.setStencilFunction(m.CompareFunction.ALWAYS,0,255)}draw(c,a){const {context:b,state:k,requestRender:e,allowDelayedRender:r}=c;c=q.createProgramDescriptor("clip",{geometry:[{location:0,name:"a_pos",count:2,type:m.DataType.SHORT}]});a=a.getVAO(b,k,c.attributes,c.bufferLayouts);null!=a.indexBuffer&&(this._program||(this._program=h.createProgram(b,d.background)),
r&&null!=e&&!this._program.compiled?e():(b.useProgram(this._program),this._program.setUniform2fv("u_coord_range",[1,1]),this._program.setUniform4fv("u_color",this._color),this._program.setUniformMatrix3fv("u_dvsMat3",k.displayMat3),b.bindVAO(a),b.drawElements(m.PrimitiveType.TRIANGLES,a.indexBuffer.size,m.DataType.UNSIGNED_INT,0),b.bindVAO()))}}return g})},"esri/core/libs/gl-matrix-2/factories/vec4f32":function(){define(["exports"],function(l){function q(){return new Float32Array(4)}function n(u){const y=
new Float32Array(4);y[0]=u[0];y[1]=u[1];y[2]=u[2];y[3]=u[3];return y}function d(u,y,A,v){const x=new Float32Array(4);x[0]=u;x[1]=y;x[2]=A;x[3]=v;return x}function m(u,y){return new Float32Array(u,y,4)}function h(){return q()}function g(){return d(1,1,1,1)}function c(){return d(1,0,0,0)}function a(){return d(0,1,0,0)}function b(){return d(0,0,1,0)}function k(){return d(0,0,0,1)}const e=q(),r=g(),f=c(),p=a(),t=b(),w=k(),z=Object.freeze(Object.defineProperty({__proto__:null,ONES:r,UNIT_W:w,UNIT_X:f,
UNIT_Y:p,UNIT_Z:t,ZEROS:e,clone:n,create:q,createView:m,fromValues:d,ones:g,unitW:k,unitX:c,unitY:a,unitZ:b,zeros:h},Symbol.toStringTag,{value:"Module"}));l.ONES=r;l.UNIT_W=w;l.UNIT_X=f;l.UNIT_Y=p;l.UNIT_Z=t;l.ZEROS=e;l.clone=n;l.create=q;l.createView=m;l.fromValues=d;l.ones=g;l.unitW=k;l.unitX=c;l.unitY=a;l.unitZ=b;l.vec4f32=z;l.zeros=h;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/Utils":function(){define("exports ../../../../core/Error ../../../../core/Logger ../../../../symbols/cim/enums ../../../../core/RandomLCG ../../../../core/has ../../../webgl/checkWebGLError ../../../webgl/enums ../../../webgl/FramebufferObject ../../../webgl/GLObjectType ../../../webgl/getDataTypeBytes ../../../webgl/Texture ../../../webgl/TextureDescriptor ../../../webgl/VertexElementDescriptor".split(" "),
function(l,q,n,d,m,h,g,c,a,b,k,e,r,f){function p(u){const y=new Map;for(const A in u){let v=0;y.set(A,u[A].map(x=>{const C=new f.VertexElementDescriptor(x.name,x.count,x.type,v,0,x.normalized||!1);v+=x.count*k.getDataTypeBytes(x.type);return C}));y.get(A).forEach(x=>x.stride=v)}return y}const t=()=>n.getLogger("esri.views.2d.engine.webgl.Utils"),w=u=>{const y={};u.forEach((A,v)=>y[v]=A?.length?A[0].stride:0);return y},z=new Map;l.charCodes=function(u){const y=[];for(let A=0;A<u.length;A++)y.push(u.charCodeAt(A));
return y};l.createAttributeLayout=p;l.createProgramDescriptor=(u,y)=>{if(!z.has(u)){const A=p(y),v=w(A),x=new Map;for(const C in y)for(const B of y[C])x.set(B.name,B.location);z.set(u,{strides:v,bufferLayouts:A,attributes:x})}return z.get(u)};l.createTexture=function(u,y,A){const v=new r.TextureDescriptor(y.width,y.height);v.dataType=y.dataType;y.depth&&(v.depth=y.depth);y.flipped&&(v.flipped=y.flipped);y.hasMipmap&&(v.hasMipmap=y.hasMipmap);v.internalFormat=y.internalFormat;y.isImmutable&&(v.isImmutable=
y.isImmutable);y.isOpaque&&(v.isOpaque=y.isOpaque);y.maxAnisotropy&&(v.maxAnisotropy=y.maxAnisotropy);v.pixelFormat=y.pixelFormat;y.preMultiplyAlpha&&(v.preMultiplyAlpha=y.preMultiplyAlpha);y.samplingMode&&(v.samplingMode=y.samplingMode);y.target&&(v.target=y.target);v.uniform=y.uniform;y.unpackAlignment&&(v.unpackAlignment=y.unpackAlignment);y.wrapMode&&(v.wrapMode=y.wrapMode);return new e.Texture(u,v,A)};l.discardUrlIfHasUrlHash=function(u){return"url"in u&&"urlHash"in u?{...u,url:""}:u};l.getCapType=
function(u){switch(u){case "butt":return d.CapType.BUTT;case "round":return d.CapType.ROUND;case "square":return d.CapType.SQUARE;default:return t().error(new q("mapview-invalid-type",`Cap type ${u} is not a valid option. Defaulting to round`)),d.CapType.ROUND}};l.getJoinType=function(u){switch(u){case "miter":return d.JoinType.MITER;case "bevel":return d.JoinType.BEVEL;case "round":return d.JoinType.ROUND;default:return t().error(new q("mapview-invalid-type",`Join type ${u} is not a valid option. Defaulting to round`)),
d.JoinType.ROUND}};l.getPixelArrayCtor=function(u){switch(u){case c.PixelType.UNSIGNED_BYTE:return Uint8Array;case c.PixelType.UNSIGNED_SHORT_4_4_4_4:return Uint16Array;case c.PixelType.FLOAT:return Float32Array;default:t().error(new q("webgl-utils",`Unable to handle type ${u}`))}};l.getPixelBytes=function(u){switch(u){case c.PixelType.UNSIGNED_BYTE:return 1;case c.PixelType.UNSIGNED_SHORT_4_4_4_4:return 2;case c.PixelType.FLOAT:return 4;default:t().error(new q("webgl-utils",`Unable to handle type ${u}`))}};
l.isSVGImage=u=>u.includes("data:image/svg+xml");l.isValidSVG=u=>{if(!u)return!1;u=u.trim();return/^[mzlhvcsqta]\s*[-+.0-9][^mlhvzcsqta]+/i.test(u)&&/[\dz]$/i.test(u)&&4<u.length?!0:!1};Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaders/BackgroundPrograms":function(){define(["exports","./sources/resolver"],function(l,q){q={shaders:{vertexShader:q.resolveIncludes("background/background.vert"),fragmentShader:q.resolveIncludes("background/background.frag")},
attributes:new Map([["a_pos",0]])};l.background=q;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaders/sources/resolver":function(){define(["exports","./shaderRepository","../../../../../webgl/ShaderCompiler"],function(l,q,n){const d=new n.ShaderCompiler(function(m){return function(h){let g=m;h.split("/").forEach(c=>{g&&=g[c]});return g}}(q));l.resolveIncludes=function(m){return d.resolveIncludes(m)};Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},
"esri/views/2d/engine/webgl/shaders/sources/shaderRepository":function(){define(function(){return{background:{"background.frag":"uniform lowp vec4 u_color;\nvoid main() {\ngl_FragColor \x3d u_color;\n}","background.vert":"attribute vec2 a_pos;\nuniform highp mat3 u_dvsMat3;\nuniform mediump vec2 u_coord_range;\nuniform mediump float u_depth;\nvoid main() {\nvec3 v_pos \x3d u_dvsMat3 * vec3(u_coord_range * a_pos, 1.0);\ngl_Position \x3d vec4(v_pos.xy, 0.0, 1.0);\n}"},bitBlit:{"bitBlit.frag":"uniform lowp sampler2D u_tex;\nuniform lowp float u_opacity;\nvarying mediump vec2 v_uv;\nvoid main() {\nlowp vec4 color \x3d texture2D(u_tex, v_uv);\ngl_FragColor \x3d color * u_opacity;\n}",
"bitBlit.vert":"attribute vec2 a_pos;\nattribute vec2 a_tex;\nvarying mediump vec2 v_uv;\nvoid main(void) {\ngl_Position \x3d vec4(a_pos , 0.0, 1.0);\nv_uv \x3d a_tex;\n}"},debug:{overlay:{"overlay.frag":"precision mediump float;\nvarying vec4 v_color;\nvoid main(void) {\ngl_FragColor \x3d v_color;\n}","overlay.vert":"attribute vec3 a_PositionAndFlags;\nuniform mat3 u_dvsMat3;\nuniform vec4 u_colors[4];\nuniform float u_opacities[4];\nvarying vec4 v_color;\nvoid main(void) {\nvec2 position \x3d a_PositionAndFlags.xy;\nfloat flags \x3d a_PositionAndFlags.z;\nint colorIndex \x3d int(mod(flags, 4.0));\nvec4 color;\nfor (int i \x3d 0; i \x3c 4; i++) {\ncolor \x3d u_colors[i];\nif (i \x3d\x3d colorIndex) {\nbreak;\n}\n}\nint opacityIndex \x3d int(mod(floor(flags / 4.0), 4.0));\nfloat opacity;\nfor (int i \x3d 0; i \x3c 4; i++) {\nopacity \x3d u_opacities[i];\nif (i \x3d\x3d opacityIndex) {\nbreak;\n}\n}\nv_color \x3d color * opacity;\ngl_Position \x3d vec4((u_dvsMat3 * vec3(position, 1.0)).xy, 0.0, 1.0);\n}"}},
dot:{dot:{"dot.frag":"precision mediump float;\nvarying vec4 v_color;\nvarying float v_dotRatio;\nvarying float v_invEdgeRatio;\nuniform highp float u_tileZoomFactor;\nvoid main()\n{\nfloat dist \x3d length(gl_PointCoord - vec2(.5, .5)) * 2.;\nfloat alpha \x3d smoothstep(0., 1., v_invEdgeRatio * (dist - v_dotRatio) + 1.);\ngl_FragColor \x3d v_color * alpha;\n}","dot.vert":"precision highp float;\nattribute vec2 a_pos;\nuniform sampler2D u_texture;\nuniform highp mat3 u_dvsMat3;\nuniform highp float u_tileZoomFactor;\nuniform highp float u_dotSize;\nuniform highp float u_pixelRatio;\nvarying vec2 v_pos;\nvarying vec4 v_color;\nvarying float v_dotRatio;\nvarying float v_invEdgeRatio;\nconst float EPSILON \x3d 0.000001;\nvoid main()\n{\nmat3 tileToTileTexture \x3d mat3(  1., 0., 0.,\n0., -1., 0.,\n0., 1., 1.  );\nvec3 texCoords \x3d tileToTileTexture * vec3(a_pos.xy / 512., 1.);\nv_color \x3d texture2D(u_texture, texCoords.xy);\nfloat smoothEdgeWidth \x3d max(u_dotSize / 2., 1.) ;\nfloat z \x3d 0.;\nz +\x3d 2.0 * step(v_color.a, EPSILON);\ngl_PointSize \x3d (smoothEdgeWidth + u_dotSize);\ngl_Position \x3d vec4((u_dvsMat3 * vec3(a_pos + .5, 1.)).xy, z, 1.);\nv_dotRatio \x3d u_dotSize / gl_PointSize;\nv_invEdgeRatio \x3d -1. / ( smoothEdgeWidth / gl_PointSize );\ngl_PointSize  *\x3d (u_pixelRatio * u_tileZoomFactor);\n}"}},
filtering:{"bicubic.glsl":"vec4 computeWeights(float v) {\nfloat b \x3d 1.0 / 6.0;\nfloat v2 \x3d v * v;\nfloat v3 \x3d v2 * v;\nfloat w0 \x3d b * (-v3 + 3.0 * v2 - 3.0 * v + 1.0);\nfloat w1 \x3d b * (3.0 * v3  - 6.0 * v2 + 4.0);\nfloat w2 \x3d b * (-3.0 * v3 + 3.0 * v2 + 3.0 * v + 1.0);\nfloat w3 \x3d b * v3;\nreturn vec4(w0, w1, w2, w3);\n}\nvec4 bicubicOffsetsAndWeights(float v) {\nvec4 w \x3d computeWeights(v);\nfloat g0 \x3d w.x + w.y;\nfloat g1 \x3d w.z + w.w;\nfloat h0 \x3d 1.0 - (w.y / g0) + v;\nfloat h1 \x3d 1.0 + (w.w / g1) - v;\nreturn vec4(h0, h1, g0, g1);\n}\nvec4 sampleBicubicBSpline(sampler2D sampler, vec2 coords, vec2 texSize) {\nvec2 eX \x3d vec2(1.0 / texSize.x, 0.0);\nvec2 eY \x3d vec2(0.0, 1.0 / texSize.y);\nvec2 texel \x3d coords * texSize - 0.5;\nvec3 hgX \x3d bicubicOffsetsAndWeights(fract(texel).x).xyz;\nvec3 hgY \x3d bicubicOffsetsAndWeights(fract(texel).y).xyz;\nvec2 coords10 \x3d coords + hgX.x * eX;\nvec2 coords00 \x3d coords - hgX.y * eX;\nvec2 coords11 \x3d coords10 + hgY.x * eY;\nvec2 coords01 \x3d coords00 + hgY.x * eY;\ncoords10 \x3d coords10 - hgY.y * eY;\ncoords00 \x3d coords00 - hgY.y * eY;\nvec4 color00 \x3d texture2D(sampler, coords00);\nvec4 color10 \x3d texture2D(sampler, coords10);\nvec4 color01 \x3d texture2D(sampler, coords01);\nvec4 color11 \x3d texture2D(sampler, coords11);\ncolor00 \x3d mix(color00, color01, hgY.z);\ncolor10 \x3d mix(color10, color11, hgY.z);\ncolor00 \x3d mix(color00, color10, hgX.z);\nreturn color00;\n}",
"bilinear.glsl":"vec4 sampleBilinear(sampler2D sampler, vec2 coords, vec2 texSize) {\nvec2 texelStart \x3d floor(coords * texSize);\nvec2 coord0 \x3d texelStart / texSize;\nvec2 coord1 \x3d (texelStart +  vec2(1.0, 0.0)) / texSize;\nvec2 coord2 \x3d (texelStart +  vec2(0.0, 1.0)) / texSize;\nvec2 coord3 \x3d (texelStart +  vec2(1.0, 1.0)) / texSize;\nvec4 color0 \x3d texture2D(sampler, coord0);\nvec4 color1 \x3d texture2D(sampler, coord1);\nvec4 color2 \x3d texture2D(sampler, coord2);\nvec4 color3 \x3d texture2D(sampler, coord3);\nvec2 blend \x3d fract(coords * texSize);\nvec4 color01 \x3d mix(color0, color1, blend.x);\nvec4 color23 \x3d mix(color2, color3, blend.x);\nvec4 color \x3d mix(color01, color23, blend.y);\n#ifdef NNEDGE\nfloat alpha \x3d floor(color0.a * color1.a * color2.a * color3.a + 0.5);\ncolor \x3d color * alpha + (1.0 - alpha) * texture2D(sampler, coords);\n#endif\nreturn color;\n}",
"epx.glsl":"vec4 sampleEPX(sampler2D sampler, float size, vec2 coords, vec2 texSize) {\nvec2 invSize \x3d 1.0 / texSize;\nvec2 texel \x3d coords * texSize;\nvec2 texel_i \x3d floor(texel);\nvec2 texel_frac \x3d fract(texel);\nvec4 colorP \x3d texture2D(sampler, texel_i * invSize);\nvec4 colorP1 \x3d vec4(colorP);\nvec4 colorP2 \x3d vec4(colorP);\nvec4 colorP3 \x3d vec4(colorP);\nvec4 colorP4 \x3d vec4(colorP);\nvec4 colorA \x3d texture2D(sampler, (texel_i - vec2(0.0, 1.0)) * invSize);\nvec4 colorB \x3d texture2D(sampler, (texel_i + vec2(1.0, 0.0)) * invSize);\nvec4 colorC \x3d texture2D(sampler, (texel_i - vec2(1.0, 0.0)) * invSize);\nvec4 colorD \x3d texture2D(sampler, (texel_i + vec2(0.0, 1.0)) * invSize);\nif (colorC \x3d\x3d colorA \x26\x26 colorC !\x3d colorD \x26\x26 colorA !\x3d colorB) {\ncolorP1 \x3d colorA;\n}\nif (colorA \x3d\x3d colorB \x26\x26 colorA !\x3d colorC \x26\x26 colorB !\x3d colorD) {\ncolorP2 \x3d colorB;\n}\nif (colorD \x3d\x3d colorC \x26\x26 colorD !\x3d colorB \x26\x26 colorC !\x3d colorA) {\ncolorP3 \x3d colorC;\n}\nif (colorB \x3d\x3d colorD \x26\x26 colorB !\x3d colorA \x26\x26 colorD !\x3d colorC) {\ncolorP4 \x3d colorD;\n}\nvec4 colorP12 \x3d mix(colorP1, colorP2, texel_frac.x);\nvec4 colorP34 \x3d mix(colorP1, colorP2, texel_frac.x);\nreturn mix(colorP12, colorP34, texel_frac.y);\n}"},
heatmap:{heatmapResolve:{"heatmapResolve.frag":"precision highp float;\n#ifdef HEATMAP_PRECISION_HALF_FLOAT\n#define COMPRESSION_FACTOR 4.0\n#else\n#define COMPRESSION_FACTOR 1.0\n#endif\nuniform sampler2D u_texture;\nuniform sampler2D u_gradient;\nuniform vec2 u_densityMinAndInvRange;\nuniform float u_densityNormalization;\nvarying vec2 v_uv;\nvoid main() {\nvec4 data \x3d texture2D(u_texture, v_uv);\nfloat density \x3d data.r * COMPRESSION_FACTOR;\ndensity *\x3d u_densityNormalization;\ndensity \x3d (density - u_densityMinAndInvRange.x) * u_densityMinAndInvRange.y;\nvec4 color \x3d texture2D(u_gradient, vec2(density, 0.5));\ngl_FragColor \x3d vec4(color.rgb * color.a, color.a);\n}",
"heatmapResolve.vert":"precision highp float;\nattribute vec2 a_pos;\nvarying vec2 v_uv;\nvoid main() {\nv_uv \x3d a_pos;\ngl_Position \x3d vec4(a_pos * 2.0 - 1.0, 1., 1.);\n}"}},highlight:{"blur.frag":"varying mediump vec2 v_texcoord;\nuniform mediump vec4 u_direction;\nuniform mediump mat4 u_channelSelector;\nuniform mediump float u_sigma;\nuniform sampler2D u_texture;\nmediump float gauss1(mediump vec2 dir) {\nreturn exp(-dot(dir, dir) / (2.0 * u_sigma * u_sigma));\n}\nmediump vec4 selectChannel(mediump vec4 sample) {\nreturn u_channelSelector * sample;\n}\nvoid accumGauss1(mediump float i, inout mediump float tot, inout mediump float weight) {\nmediump float w \x3d gauss1(i * u_direction.xy);\ntot +\x3d selectChannel(texture2D(u_texture, v_texcoord + i * u_direction.zw))[3] * w;\nweight +\x3d w;\n}\nvoid main(void) {\nmediump float tot \x3d 0.0;\nmediump float weight \x3d 0.0;\naccumGauss1(-5.0, tot, weight);\naccumGauss1(-4.0, tot, weight);\naccumGauss1(-3.0, tot, weight);\naccumGauss1(-2.0, tot, weight);\naccumGauss1(-1.0, tot, weight);\naccumGauss1(0.0, tot, weight);\naccumGauss1(1.0, tot, weight);\naccumGauss1(2.0, tot, weight);\naccumGauss1(3.0, tot, weight);\naccumGauss1(4.0, tot, weight);\naccumGauss1(5.0, tot, weight);\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, tot / weight);\n}",
"highlight.frag":"varying mediump vec2 v_texcoord;\nuniform sampler2D u_texture;\nuniform mediump float u_sigma;\nuniform sampler2D u_shade;\nuniform mediump vec2 u_minMaxDistance;\nmediump float estimateDistance() {\nmediump float y \x3d texture2D(u_texture, v_texcoord)[3];\nconst mediump float y0 \x3d 0.5;\nmediump float m0 \x3d 1.0 / (sqrt(2.0 * 3.1415) * u_sigma);\nmediump float d \x3d (y - y0) / m0;\nreturn d;\n}\nmediump vec4 shade(mediump float d) {\nmediump float mappedDistance \x3d (d - u_minMaxDistance.x) / (u_minMaxDistance.y - u_minMaxDistance.x);\nmappedDistance \x3d clamp(mappedDistance, 0.0, 1.0);\nreturn texture2D(u_shade, vec2(mappedDistance, 0.5));\n}\nvoid main(void) {\nmediump float d \x3d estimateDistance();\ngl_FragColor \x3d shade(d);\n}",
"textured.vert":"attribute mediump vec2 a_position;\nattribute mediump vec2 a_texcoord;\nvarying mediump vec2 v_texcoord;\nvoid main(void) {\ngl_Position \x3d vec4(a_position, 0.0, 1.0);\nv_texcoord \x3d a_texcoord;\n}"},materials:{"attributeData.glsl":"uniform highp sampler2D filterFlags;\nuniform highp sampler2D animation;\nuniform highp sampler2D gpgpu;\nuniform highp sampler2D visualVariableData;\nuniform highp sampler2D dataDriven0;\nuniform highp sampler2D dataDriven1;\nuniform highp sampler2D dataDriven2;\nuniform float size;\nhighp vec2 getAttributeDataCoords(in highp vec3 id) {\nhighp vec3  texel \x3d unpackDisplayIdTexel(id);\nhighp float u32 \x3d float(int(texel.r) + int(texel.g) * 256 + int(texel.b) * 256 * 256);\nhighp float col \x3d mod(u32, size);\nhighp float row \x3d (u32 - col) / size;\nhighp float u \x3d col / size;\nhighp float v \x3d row / size;\nreturn vec2(u, v);\n}\nhighp vec2 getAttributeDataTextureCoords(in highp vec3 id) {\nreturn (getAttributeDataCoords(id) * 2.0) - 1.0 + (.5 / vec2(size));\n}\nhighp vec4 getFilterData(in highp vec3 id) {\nvec2 coords \x3d getAttributeDataCoords(id);\nreturn texture2D(filterFlags, coords);\n}\nhighp vec4 getAnimation(in highp vec3 id) {\nhighp vec2 coords \x3d getAttributeDataCoords(id);\nreturn texture2D(animation, coords);\n}\nhighp vec4 getVisualVariableData(in highp vec3 id) {\nhighp vec2 coords \x3d getAttributeDataCoords(id);\nreturn texture2D(visualVariableData, coords);\n}\nhighp vec4 getDataDriven0(in highp vec3 id) {\nhighp vec2 coords \x3d getAttributeDataCoords(id);\nreturn texture2D(dataDriven0, coords);\n}\nhighp vec4 getDataDriven1(in highp vec3 id) {\nhighp vec2 coords \x3d getAttributeDataCoords(id);\nreturn texture2D(dataDriven1, coords);\n}\nhighp vec4 getGPGPU(in highp vec3 id) {\nhighp vec2 coords \x3d getAttributeDataCoords(id);\nreturn texture2D(gpgpu, coords);\n}\nhighp vec4 getDataDriven2(in highp vec3 id) {\nhighp vec2 coords \x3d getAttributeDataCoords(id);\nreturn texture2D(dataDriven2, coords);\n}\nfloat u88VVToFloat(in vec2 v) {\nbool isMagic \x3d v.x \x3d\x3d 255.0 \x26\x26 v.y \x3d\x3d 255.0;\nif (isMagic) {\nreturn NAN_MAGIC_NUMBER;\n}\nreturn (v.x + v.y * float(0x100)) - 32768.0;\n}",
"barycentric.glsl":"float inTriangle(vec3 bary) {\nvec3 absBary \x3d abs(bary);\nreturn step((absBary.x + absBary.y + absBary.z), 1.05);\n}\nvec3 xyToBarycentric(in vec2 pos, in vec2 v0,  in vec2 v1, in vec2 v2) {\nmat3 xyToBarycentricMat3 \x3d mat3(\nv1.x * v2.y - v2.x * v1.y, v2.x * v0.y - v0.x * v2.y, v0.x * v1.y - v1.x * v0.y,\nv1.y - v2.y, v2.y - v0.y, v0.y - v1.y,\nv2.x - v1.x, v0.x - v2.x, v1.x - v0.x\n);\nfloat A2 \x3d v0.x * (v1.y - v2.y) + v1.x * (v2.y - v0.y) + v2.x * (v0.y - v1.y);\nreturn (1. / A2) * xyToBarycentricMat3 * vec3(1., pos);\n}",
"constants.glsl":"const float C_DEG_TO_RAD \x3d 3.14159265359 / 180.0;\nconst float C_256_TO_RAD \x3d 3.14159265359 / 128.0;\nconst float C_RAD_TO_DEG \x3d 180.0 / 3.141592654;\nconst float POSITION_PRECISION \x3d 1.0 / 8.0;\nconst float FILL_POSITION_PRECISION \x3d 1.0 / 1.0;\nconst float SOFT_EDGE_RATIO \x3d 1.0;\nconst float THIN_LINE_WIDTH_FACTOR \x3d 1.1;\nconst float THIN_LINE_HALF_WIDTH \x3d 1.0;\nconst float EXTRUDE_SCALE_PLACEMENT_PADDING \x3d 1.0 / 4.0;\nconst float OFFSET_PRECISION \x3d 1.0 / 8.0;\nconst float OUTLINE_SCALE \x3d 1.0 / 5.0;\nconst float SDF_FONT_SIZE \x3d 24.0;\nconst float MAX_SDF_DISTANCE \x3d 8.0;\nconst float PLACEMENT_PADDING \x3d 8.0;\nconst float EPSILON \x3d 0.00001;\nconst float EPSILON_HITTEST \x3d 0.05;\nconst int MAX_FILTER_COUNT \x3d 2;\nconst int ATTR_VV_SIZE \x3d 0;\nconst int ATTR_VV_COLOR \x3d 1;\nconst int ATTR_VV_OPACITY \x3d 2;\nconst int ATTR_VV_ROTATION \x3d 3;\nconst highp float NAN_MAGIC_NUMBER \x3d 1e-30;\nconst int BITSET_GENERIC_LOCK_COLOR \x3d 1;\nconst int BITSET_GENERIC_CONSIDER_ALPHA_ONLY \x3d 4;\nconst int BITSET_MARKER_ALIGNMENT_MAP \x3d 0;\nconst int BITSET_MARKER_OUTLINE_ALLOW_COLOR_OVERRIDE \x3d 2;\nconst int BITSET_MARKER_SCALE_SYMBOLS_PROPORTIONALLY \x3d 3;\nconst int BITSET_TYPE_FILL_OUTLINE \x3d 0;\nconst int BITSET_FILL_RANDOM_PATTERN_OFFSET \x3d 2;\nconst int BITSET_FILL_HAS_UNRESOLVED_REPLACEMENT_COLOR \x3d 3;\nconst int BITSET_FILL_HAS_PATTERN_HEIGHT_PRECISION_FACTOR \x3d 5;\nconst int BITSET_FILL_HAS_PATTERN_WIDTH_PRECISION_FACTOR \x3d 6;\nconst int BITSET_LINE_SCALE_DASH \x3d 2;",
fill:{"common.glsl":"#include \x3cmaterials/symbologyTypeUtils.glsl\x3e\n#ifdef PATTERN\nuniform mediump vec2 u_mosaicSize;\nvarying mediump float v_sampleAlphaOnly;\n#endif\n#if SYMBOLOGY_TYPE \x3d\x3d SYMBOLOGY_TYPE_DOT_DENSITY\nuniform lowp vec4 u_isActive[ 2 ];\nuniform highp float u_dotValue;\nuniform highp float u_tileDotsOverArea;\nuniform highp float u_dotTextureDotCount;\nuniform mediump float u_tileZoomFactor;\n#endif\nvarying highp vec3 v_id;\nvarying lowp vec4 v_color;\nvarying lowp float v_opacity;\nvarying mediump vec4 v_aux1;\n#ifdef PATTERN\nvarying mediump vec2 v_tileTextureCoord;\n#endif\n#ifdef SYMBOLOGY_TYPE_IS_OUTLINE_FILL_LIKE\nvarying lowp float v_isOutline;\n#endif\n#if SYMBOLOGY_TYPE \x3d\x3d SYMBOLOGY_TYPE_DOT_DENSITY\nvarying highp vec2 v_dotTextureCoords;\nvarying highp vec4 v_dotThresholds[ 2 ];\n#endif",
"fill.frag":"precision highp float;\n#include \x3cmaterials/constants.glsl\x3e\n#include \x3cmaterials/utils.glsl\x3e\n#include \x3cmaterials/fill/common.glsl\x3e\n#ifdef PATTERN\nuniform lowp sampler2D u_texture;\n#endif\n#if SYMBOLOGY_TYPE \x3d\x3d SYMBOLOGY_TYPE_DOT_DENSITY\nuniform mediump mat4 u_dotColors[ 2 ];\nuniform sampler2D u_dotTextures[ 2 ];\nuniform vec4 u_dotBackgroundColor;\n#endif\n#ifdef SYMBOLOGY_TYPE_IS_OUTLINE_FILL_LIKE\n#include \x3cmaterials/shared/line/common.glsl\x3e\n#include \x3cmaterials/shared/line/line.frag\x3e\nlowp vec4 drawLine() {\nfloat v_lineWidth \x3d v_aux1.x;\nvec2  v_normal    \x3d v_aux1.yz;\nLineData inputs \x3d LineData(\nv_color,\nv_normal,\nv_lineWidth,\nv_opacity,\nv_id\n);\nreturn shadeLine(inputs);\n}\n#endif\nlowp vec4 drawFill() {\nlowp vec4 out_color \x3d vec4(0.);\n#ifdef HITTEST\nout_color \x3d v_color;\n#elif defined(PATTERN)\nmediump vec4 v_tlbr \x3d v_aux1;\nmediump vec2 normalizedTextureCoord \x3d mod(v_tileTextureCoord, 1.0);\nmediump vec2 samplePos \x3d mix(v_tlbr.xy, v_tlbr.zw, normalizedTextureCoord);\nlowp vec4 color \x3d texture2D(u_texture, samplePos);\nif (v_sampleAlphaOnly \x3e 0.5) {\ncolor.rgb \x3d vec3(color.a);\n}\nout_color \x3d v_opacity * v_color * color;\n#elif SYMBOLOGY_TYPE \x3d\x3d SYMBOLOGY_TYPE_DOT_DENSITY \x26\x26 !defined(HIGHLIGHT)\nvec4 textureThresholds0 \x3d texture2D(u_dotTextures[0], v_dotTextureCoords);\nvec4 textureThresholds1 \x3d texture2D(u_dotTextures[1], v_dotTextureCoords);\nvec4 difference0 \x3d v_dotThresholds[0] - textureThresholds0;\nvec4 difference1 \x3d v_dotThresholds[1] - textureThresholds1;\n#ifdef DD_DOT_BLENDING\nvec4 isPositive0 \x3d step(0.0, difference0);\nvec4 isPositive1 \x3d step(0.0, difference1);\nfloat weightSum \x3d dot(isPositive0, difference0) + dot(isPositive1, difference1);\nfloat lessThanEqZero \x3d step(weightSum, 0.0);\nfloat greaterThanZero \x3d 1.0 - lessThanEqZero ;\nfloat divisor \x3d (weightSum + lessThanEqZero);\nvec4 weights0 \x3d difference0 * isPositive0 / divisor;\nvec4 weights1 \x3d difference1 * isPositive1 / divisor;\nvec4 dotColor \x3d u_dotColors[0] * weights0 + u_dotColors[1] * weights1;\nvec4 preEffectColor \x3d greaterThanZero * dotColor + lessThanEqZero * u_dotBackgroundColor;\n#else\nfloat diffMax \x3d max(max4(difference0), max4(difference1));\nfloat lessThanZero \x3d step(diffMax, 0.0);\nfloat greaterOrEqZero \x3d 1.0 - lessThanZero;\nvec4 isMax0 \x3d step(diffMax, difference0);\nvec4 isMax1 \x3d step(diffMax, difference1);\nvec4 dotColor \x3d u_dotColors[0] * isMax0 + u_dotColors[1] * isMax1;\nvec4 preEffectColor \x3d greaterOrEqZero * dotColor + lessThanZero * u_dotBackgroundColor;\n#endif\nout_color \x3d preEffectColor;\n#else\nout_color \x3d v_opacity * v_color;\n#endif\n#ifdef HIGHLIGHT\nout_color.a \x3d 1.0;\n#endif\nreturn out_color;\n}\nvoid main() {\n#ifdef SYMBOLOGY_TYPE_IS_OUTLINE_FILL_LIKE\nif (v_isOutline \x3e 0.5) {\ngl_FragColor \x3d drawLine();\n} else {\ngl_FragColor \x3d drawFill();\n}\n#else\ngl_FragColor \x3d drawFill();\n#endif\n}",
"fill.vert":"#include \x3cmaterials/symbologyTypeUtils.glsl\x3e\n#define PACKED_LINE\nprecision highp float;\nattribute float a_bitset;\n#if SYMBOLOGY_TYPE \x3d\x3d SYMBOLOGY_TYPE_DOT_DENSITY\nattribute float a_inverseArea;\nvec4 a_color \x3d vec4(0.0, 0.0, 0.0, 1.0);\nvec2 a_zoomRange \x3d vec2(0.0, 10000.0);\n#else\nattribute vec4 a_color;\nattribute vec4 a_aux2;\nattribute vec4 a_aux3;\n#ifndef SYMBOLOGY_TYPE_IS_SIMPLE_LIKE\nattribute vec4 a_aux1;\nattribute vec2 a_zoomRange;\n#else\nvec2 a_zoomRange \x3d vec2(0.0, 10000.0);\n#endif\n#endif\nuniform vec2 u_tileOffset;\nuniform vec2 u_maxIntNumOfCrossing;\n#include \x3cutil/encoding.glsl\x3e\n#include \x3cmaterials/vcommon.glsl\x3e\n#include \x3cmaterials/fill/common.glsl\x3e\n#include \x3cmaterials/fill/hittest.glsl\x3e\nconst float INV_SCALE_COMPRESSION_FACTOR \x3d 1.0 / 128.0;\nconst float MAX_REPRESENTABLE_INT \x3d 16777216.0;\n#if SYMBOLOGY_TYPE \x3d\x3d SYMBOLOGY_TYPE_DOT_DENSITY\nvec4 dotThreshold(vec4 featureAttrOverFeatureArea, float dotValue, float tileDotsOverArea) {\nreturn featureAttrOverFeatureArea * (1.0 / dotValue)  * (1.0 / tileDotsOverArea);\n}\n#endif\n#ifdef SYMBOLOGY_TYPE_IS_OUTLINE_FILL_LIKE\n#include \x3cmaterials/shared/line/common.glsl\x3e\n#include \x3cmaterials/shared/line/line.vert\x3e\nvoid drawLine(out lowp vec4 out_color, out highp vec3 out_pos) {\nLineData outputs \x3d buildLine(\nout_pos,\na_id,\na_pos,\na_color,\n(a_aux3.xy - 128.) / 16.,\n(a_aux3.zw - 128.) / 16.,\n0.,\na_aux2.z / 16.,\na_bitset,\nvec4(0.),\nvec2(0.),\na_aux2.w / 16.\n);\nv_id      \x3d outputs.id;\nv_opacity \x3d outputs.opacity;\nv_aux1    \x3d vec4(outputs.lineHalfWidth, outputs.normal, 0.);\nout_color \x3d outputs.color;\n}\n#endif\nvoid drawFill(out lowp vec4 out_color, out highp vec3 out_pos) {\nfloat a_bitSet \x3d a_bitset;\nout_color \x3d getColor(a_color, a_bitSet, BITSET_GENERIC_LOCK_COLOR);\nv_opacity \x3d getOpacity();\nv_id      \x3d norm(a_id);\n#if SYMBOLOGY_TYPE \x3d\x3d SYMBOLOGY_TYPE_DOT_DENSITY\nmat3 tileToTileNormalized \x3d mat3(  2. / 512.,  0.,  0.,\n0., -2. / 512.,  0.,\n-1.,  1.,  1.  );\nout_pos   \x3d tileToTileNormalized * vec3((a_pos * FILL_POSITION_PRECISION), 1.);\n#else\nout_pos   \x3d u_dvsMat3 * vec3(a_pos * FILL_POSITION_PRECISION, 1.);\n#endif\n#ifdef PATTERN\nvec4  a_tlbr   \x3d a_aux1;\nfloat a_width  \x3d a_aux2.x;\nfloat a_height \x3d a_aux2.y;\nvec2  a_offset \x3d a_aux2.zw;\nvec2  a_scale  \x3d a_aux3.xy;\nfloat a_angle  \x3d a_aux3.z;\nif (getBit(a_bitset, BITSET_FILL_HAS_PATTERN_WIDTH_PRECISION_FACTOR) \x3e 0.5) {\na_width *\x3d INV_SCALE_COMPRESSION_FACTOR;\n}\nif (getBit(a_bitset, BITSET_FILL_HAS_PATTERN_HEIGHT_PRECISION_FACTOR) \x3e 0.5) {\na_height *\x3d INV_SCALE_COMPRESSION_FACTOR;\n}\nvec2 scale \x3d INV_SCALE_COMPRESSION_FACTOR * a_scale;\nfloat width \x3d u_zoomFactor * a_width * scale.x;\nfloat height \x3d u_zoomFactor * a_height * scale.y;\nfloat angle \x3d C_256_TO_RAD * a_angle;\nfloat sinA \x3d sin(angle);\nfloat cosA \x3d cos(angle);\nfloat dx \x3d 0.0;\nfloat dy \x3d 0.0;\nif (getBit(a_bitset, BITSET_FILL_RANDOM_PATTERN_OFFSET) \x3e 0.5) {\nfloat id \x3d rgba2float(vec4(a_id, 0.0));\ndx \x3d rand(vec2(id, 0.0));\ndy \x3d rand(vec2(0.0, id));\n}\nmat3 patternMatrix \x3d mat3(cosA / width, sinA / height, 0,\n-sinA / width, cosA / height, 0,\ndx,            dy,           1);\nvec2 patternSize \x3d vec2(a_width, a_height);\nvec2 numPatternsPerMaxInt \x3d vec2(MAX_REPRESENTABLE_INT) / patternSize;\nvec2 maxIntCrossingOffsetCorrection \x3d patternSize * fract(u_maxIntNumOfCrossing * numPatternsPerMaxInt);\nvec2 tileOffset \x3d u_tileOffset + maxIntCrossingOffsetCorrection - 0.5 * patternSize;\ntileOffset \x3d vec2(tileOffset.x * cosA - tileOffset.y * sinA, tileOffset.x * sinA + tileOffset.y * cosA);\ntileOffset \x3d mod(tileOffset, patternSize);\nvec2 symbolOffset \x3d u_zoomFactor * scale * vec2(a_offset - tileOffset) / vec2(width, height);\nv_tileTextureCoord \x3d (patternMatrix * vec3(a_pos * FILL_POSITION_PRECISION, 1.0)).xy - symbolOffset;\nv_aux1 \x3d a_tlbr / u_mosaicSize.xyxy;\nv_sampleAlphaOnly \x3d getBit(a_bitset, BITSET_GENERIC_CONSIDER_ALPHA_ONLY);\nif (getBit(a_bitSet, BITSET_FILL_HAS_UNRESOLVED_REPLACEMENT_COLOR) \x3e 0.5) {\n#ifdef VV_COLOR\nv_sampleAlphaOnly *\x3d (1.0 - float(isNan(VV_ADATA[ATTR_VV_COLOR]))) * (1.0 - getBit(a_bitSet, BITSET_GENERIC_LOCK_COLOR));\n#else\nv_sampleAlphaOnly \x3d 0.0;\n#endif\n}\n#elif SYMBOLOGY_TYPE \x3d\x3d SYMBOLOGY_TYPE_DOT_DENSITY\nvec4 ddAttributeData0 \x3d getAttributeData2(a_id) * u_isActive[0] * a_inverseArea;\nvec4 ddAttributeData1 \x3d getAttributeData3(a_id) * u_isActive[1] * a_inverseArea;\nfloat size \x3d u_tileZoomFactor * 512.0 * 1.0 / u_pixelRatio;\nv_dotThresholds[0] \x3d dotThreshold(ddAttributeData0, u_dotValue, u_tileDotsOverArea);\nv_dotThresholds[1] \x3d dotThreshold(ddAttributeData1, u_dotValue, u_tileDotsOverArea);\nv_dotTextureCoords \x3d (a_pos * FILL_POSITION_PRECISION + 0.5) / size;\n#endif\n}\n#ifdef HITTEST\nvoid draw(out lowp vec4 out_color, out highp vec3 out_pos) {\n#ifdef SYMBOLOGY_TYPE_IS_OUTLINE_FILL_LIKE\nif (getBit(a_bitset, BITSET_TYPE_FILL_OUTLINE) \x3e 0.5) {\nout_pos \x3d vec3(0., 0., 2.);\nreturn;\n}\n#endif\nhittestFill(out_color, out_pos);\ngl_PointSize \x3d 1.0;\n}\n#elif defined(SYMBOLOGY_TYPE_IS_OUTLINE_FILL_LIKE)\nvoid draw(out lowp vec4 out_color, out highp vec3 out_pos) {\nv_isOutline \x3d getBit(a_bitset, BITSET_TYPE_FILL_OUTLINE);\nif (v_isOutline \x3e 0.5) {\ndrawLine(out_color, out_pos);\n} else {\ndrawFill(out_color, out_pos);\n}\n}\n#else\n#define draw drawFill\n#endif\nvoid main()\n{\nINIT;\nhighp vec3 pos  \x3d vec3(0.);\nhighp vec4 color  \x3d vec4(0.);\ndraw(color, pos);\nv_color \x3d color;\ngl_Position \x3d vec4(clip(v_color, pos, getFilterFlags(), a_zoomRange), 1.0);\n}",
"hittest.glsl":"#ifdef HITTEST\n#include \x3cmaterials/hittest/common.glsl\x3e\nattribute vec2 a_pos1;\nattribute vec2 a_pos2;\nvoid hittestFill(\nout lowp vec4 out_color,\nout highp vec3 out_pos\n) {\nvec3 pos        \x3d u_viewMat3 * u_tileMat3 * vec3(a_pos  * FILL_POSITION_PRECISION, 1.);\nvec3 pos1       \x3d u_viewMat3 * u_tileMat3 * vec3(a_pos1 * FILL_POSITION_PRECISION, 1.);\nvec3 pos2       \x3d u_viewMat3 * u_tileMat3 * vec3(a_pos2 * FILL_POSITION_PRECISION, 1.);\nfloat hittestDist \x3d u_hittestDist;\nfloat dist \x3d distPointTriangle(u_hittestPos, pos.xy, pos1.xy, pos2.xy);\nout_pos \x3d vec3(getAttributeDataTextureCoords(a_id), 0.0);\nif (dist \x3c 0. || dist \x3e\x3d hittestDist) {\nout_pos.z +\x3d 2.0;\n}\nout_color \x3d vec4(1. / 255., 0, 0, dist \x3d\x3d 0. ? (1. / 255.) : 0.);\n}\n#endif"},
hittest:{"common.glsl":"#ifdef HITTEST\nuniform float hittestDist;\nuniform highp vec2 hittestPos;\nfloat projectScalar(vec2 a, vec2 b) {\nreturn dot(a, normalize(b));\n}\nfloat distPointSegment(vec2 p0, vec2 p1, vec2 p2) {\nvec2 L \x3d p2 - p1;\nvec2 A \x3d p0 - p1;\nfloat projAL \x3d projectScalar(A, L);\nfloat t \x3d clamp(projAL / length(L), 0., 1.);\nreturn distance(p0, p1 + t * (p2 - p1));\n}\nvoid hittestMarker(out lowp vec4 out_color, out highp vec3 out_pos, in highp vec3 pos, float size) {\nfloat dist \x3d distance(pos, vec3(hittestPos, 1.));\nout_pos \x3d vec3(getAttributeDataTextureCoords(a_id), 0.0);\nif ((dist - size) \x3e hittestDist) {\nout_pos.z +\x3d 2.0;\n}\nout_color \x3d vec4(1. / 255., 0, 0, (dist - size) \x3c 0. ? (1. / 255.) : 0.);\n}\nfloat intersectPointTriangleBary(vec2 p, vec2 a, vec2 b, vec2 c) {\nreturn inTriangle(xyToBarycentric(p, a, b, c));\n}\nfloat distPointTriangle(vec2 p, vec2 a, vec2 b, vec2 c) {\nvec2 ba \x3d b - a;\nvec2 ca \x3d c - a;\nfloat crossProduct \x3d ba.x * ca.y - ca.x * ba.y;\nbool isParallel \x3d crossProduct \x3c EPSILON_HITTEST \x26\x26 crossProduct \x3e -EPSILON_HITTEST;\nif (isParallel) {\nreturn -1.;\n}\nif (intersectPointTriangleBary(p.xy, a, b, c) \x3d\x3d 1.) {\nreturn 0.;\n}\nfloat distAB \x3d distPointSegment(p, a, b);\nfloat distBC \x3d distPointSegment(p, b, c);\nfloat distCA \x3d distPointSegment(p, c, a);\nreturn min(min(distAB, distBC), distCA);\n}\n#endif"},
icon:{"common.glsl":"#include \x3cutil/encoding.glsl\x3e\nuniform lowp vec2 u_mosaicSize;\nvarying lowp vec4 v_color;\nvarying highp vec3 v_id;\nvarying highp vec4 v_sizeTex;\nvarying mediump vec3 v_pos;\nvarying lowp float v_opacity;\nuniform lowp sampler2D u_texture;\n#ifdef SDF\nvarying lowp vec4 v_outlineColor;\nvarying mediump float v_outlineWidth;\nvarying mediump float v_distRatio;\nvarying mediump float v_overridingOutlineColor;\nvarying mediump float v_isThin;\n#endif\n#ifdef SDF\nvec4 getColor(vec2 v_size, vec2 v_tex) {\n#ifdef HITTEST\nlowp vec4 fillPixelColor \x3d vec4(1.0);\n#else\nlowp vec4 fillPixelColor \x3d v_color;\n#endif\nfloat d \x3d 0.5 - rgba2float(texture2D(u_texture, v_tex));\nfloat size \x3d max(v_size.x, v_size.y);\nfloat dist \x3d d * size * SOFT_EDGE_RATIO * v_distRatio;\nfillPixelColor *\x3d clamp(0.5 - dist, 0.0, 1.0);\nfloat outlineWidth \x3d v_outlineWidth;\n#ifdef HIGHLIGHT\noutlineWidth \x3d max(outlineWidth, 4.0 * v_isThin);\n#endif\nif (outlineWidth \x3e 0.25) {\nlowp vec4 outlinePixelColor \x3d v_overridingOutlineColor * v_color + (1.0 - v_overridingOutlineColor) * v_outlineColor;\nfloat clampedOutlineSize \x3d min(outlineWidth, size);\noutlinePixelColor *\x3d clamp(0.5 - abs(dist) + clampedOutlineSize * 0.5, 0.0, 1.0);\nreturn v_opacity * ((1.0 - outlinePixelColor.a) * fillPixelColor + outlinePixelColor);\n}\nreturn v_opacity * fillPixelColor;\n}\n#else\nvec4 getColor(vec2 _v_size, vec2 v_tex) {\nlowp vec4 texColor \x3d texture2D(u_texture, v_tex);\nreturn v_opacity * texColor * v_color;\n}\n#endif",
heatmapAccumulate:{"common.glsl":"varying lowp vec4 v_hittestResult;\nvarying mediump vec2 v_offsetFromCenter;\nvarying highp float v_fieldValue;","heatmapAccumulate.frag":"precision mediump float;\n#include \x3cmaterials/icon/heatmapAccumulate/common.glsl\x3e\n#ifdef HEATMAP_PRECISION_HALF_FLOAT\n#define COMPRESSION_FACTOR 0.25\n#else\n#define COMPRESSION_FACTOR 1.0\n#endif\nuniform lowp sampler2D u_texture;\nvoid main() {\n#ifdef HITTEST\ngl_FragColor \x3d v_hittestResult;\n#else\nfloat radius \x3d length(v_offsetFromCenter);\nfloat shapeWeight \x3d step(radius, 1.0);\nfloat oneMinusRadiusSquared \x3d 1.0 - radius * radius;\nfloat kernelWeight \x3d oneMinusRadiusSquared * oneMinusRadiusSquared;\ngl_FragColor \x3d vec4(shapeWeight * kernelWeight * v_fieldValue * COMPRESSION_FACTOR);\n#endif\n}",
"heatmapAccumulate.vert":"precision highp float;\nattribute vec2 a_vertexOffset;\nvec4 a_color \x3d vec4(0.0);\nvec2 a_zoomRange \x3d vec2(0.0, 10000.0);\nuniform float u_radius;\nuniform float u_isFieldActive;\n#include \x3cmaterials/vcommon.glsl\x3e\n#include \x3cmaterials/hittest/common.glsl\x3e\n#include \x3cmaterials/icon/heatmapAccumulate/common.glsl\x3e\nvoid main() {\nfloat filterFlags \x3d getFilterFlags();\n#ifdef HITTEST\nhighp vec4 out_hittestResult \x3d vec4(0.);\nhighp vec3 out_pos \x3d vec3(0.);\nvec3 pos \x3d u_viewMat3 * u_tileMat3 * vec3(a_pos * POSITION_PRECISION, 1.0);\nhittestMarker(out_hittestResult, out_pos, pos, u_radius);\nv_hittestResult \x3d out_hittestResult;\ngl_PointSize \x3d 1.;\ngl_Position \x3d vec4(clip(a_color, out_pos, filterFlags, a_zoomRange), 1.0);\n#else\nv_offsetFromCenter \x3d sign(a_vertexOffset);\nv_fieldValue \x3d getAttributeData2(a_id).x * u_isFieldActive + 1.0 - u_isFieldActive;\nvec3 centerPos \x3d u_dvsMat3 * vec3(a_pos * POSITION_PRECISION, 1.0);\nvec3 vertexPos \x3d centerPos + u_displayViewMat3 * vec3(v_offsetFromCenter, 0.0) * u_radius;\ngl_Position \x3d vec4(clip(a_color, vertexPos, filterFlags, a_zoomRange), 1.0);\n#endif\n}"},
"hittest.glsl":"#ifdef HITTEST\n#include \x3cmaterials/hittest/common.glsl\x3e\nattribute vec2 a_vertexOffset1;\nattribute vec2 a_vertexOffset2;\nattribute vec2 a_texCoords1;\nattribute vec2 a_texCoords2;\nvec2 getTextureCoords(in vec3 bary, in vec2 texCoords0, in vec2 texCoords1, in vec2 texCoords2) {\nreturn texCoords0 * bary.x + texCoords1 * bary.y + texCoords2 * bary.z;\n}\nvoid hittestIcon(\ninout lowp vec4 out_color,\nout highp vec3 out_pos,\nin vec3 pos,\nin vec3 offset,\nin vec2 size,\nin float scaleFactor,\nin float isMapAligned\n) {\nout_pos \x3d vec3(getAttributeDataTextureCoords(a_id), 0.0);\nvec3 posBase \x3d u_viewMat3 * u_tileMat3  * pos;\nvec3 offset1 \x3d scaleFactor * vec3(a_vertexOffset1 / 16.0, 0.);\nvec3 offset2 \x3d scaleFactor * vec3(a_vertexOffset2 / 16.0, 0.);\nvec2 pos0    \x3d (posBase + getMatrixNoDisplay(isMapAligned) * offset).xy;\nvec2 pos1    \x3d (posBase + getMatrixNoDisplay(isMapAligned) * offset1).xy;\nvec2 pos2    \x3d (posBase + getMatrixNoDisplay(isMapAligned) * offset2).xy;\nvec3 bary0 \x3d xyToBarycentric(u_hittestPos + vec2(-u_hittestDist, -u_hittestDist), pos0, pos1, pos2);\nvec3 bary1 \x3d xyToBarycentric(u_hittestPos + vec2(0., -u_hittestDist), pos0, pos1, pos2);\nvec3 bary2 \x3d xyToBarycentric(u_hittestPos + vec2(u_hittestDist, -u_hittestDist), pos0, pos1, pos2);\nvec3 bary3 \x3d xyToBarycentric(u_hittestPos + vec2(-u_hittestDist, 0.), pos0, pos1, pos2);\nvec3 bary4 \x3d xyToBarycentric(u_hittestPos, pos0, pos1, pos2);\nvec3 bary5 \x3d xyToBarycentric(u_hittestPos + vec2(u_hittestDist, 0.), pos0, pos1, pos2);\nvec3 bary6 \x3d xyToBarycentric(u_hittestPos + vec2(-u_hittestDist, u_hittestDist), pos0, pos1, pos2);\nvec3 bary7 \x3d xyToBarycentric(u_hittestPos + vec2(0., u_hittestDist), pos0, pos1, pos2);\nvec3 bary8 \x3d xyToBarycentric(u_hittestPos + vec2(u_hittestDist, u_hittestDist), pos0, pos1, pos2);\nvec2 tex0 \x3d a_texCoords  / u_mosaicSize;\nvec2 tex1 \x3d a_texCoords1 / u_mosaicSize;\nvec2 tex2 \x3d a_texCoords2 / u_mosaicSize;\nfloat alphaSum \x3d 0.;\nalphaSum +\x3d inTriangle(bary0) * getColor(size, getTextureCoords(bary0, tex0, tex1, tex2)).a;\nalphaSum +\x3d inTriangle(bary1) * getColor(size, getTextureCoords(bary1, tex0, tex1, tex2)).a;\nalphaSum +\x3d inTriangle(bary2) * getColor(size, getTextureCoords(bary2, tex0, tex1, tex2)).a;\nalphaSum +\x3d inTriangle(bary3) * getColor(size, getTextureCoords(bary3, tex0, tex1, tex2)).a;\nalphaSum +\x3d inTriangle(bary4) * getColor(size, getTextureCoords(bary4, tex0, tex1, tex2)).a;\nalphaSum +\x3d inTriangle(bary5) * getColor(size, getTextureCoords(bary5, tex0, tex1, tex2)).a;\nalphaSum +\x3d inTriangle(bary6) * getColor(size, getTextureCoords(bary6, tex0, tex1, tex2)).a;\nalphaSum +\x3d inTriangle(bary7) * getColor(size, getTextureCoords(bary7, tex0, tex1, tex2)).a;\nout_pos.z +\x3d step(alphaSum, .05) * 2.0;\nout_color \x3d vec4(1. / 255., 0., 0., alphaSum / 255.);\n}\n#endif",
"icon.frag":"precision mediump float;\n#include \x3cmaterials/constants.glsl\x3e\n#include \x3cmaterials/utils.glsl\x3e\n#include \x3cmaterials/icon/common.glsl\x3e\nvoid main()\n{\n#ifdef HITTEST\nvec4 color \x3d v_color;\n#else\nvec4 color \x3d getColor(v_sizeTex.xy, v_sizeTex.zw);\n#endif\n#ifdef HIGHLIGHT\ncolor.a \x3d step(1.0 / 255.0, color.a);\n#endif\ngl_FragColor \x3d color;\n}","icon.vert":"precision highp float;\nattribute vec4 a_color;\nattribute vec4 a_outlineColor;\nattribute vec4 a_sizeAndOutlineWidth;\nattribute vec2 a_vertexOffset;\nattribute vec2 a_texCoords;\nattribute vec2 a_bitSetAndDistRatio;\nattribute vec2 a_zoomRange;\n#include \x3cmaterials/vcommon.glsl\x3e\n#include \x3cmaterials/icon/common.glsl\x3e\n#include \x3cmaterials/icon/hittest.glsl\x3e\nfloat getMarkerScaleFactor(inout vec2 size, in float referenceSize) {\n#ifdef VV_SIZE\nfloat f \x3d getSize(size.y) / size.y;\nfloat sizeFactor \x3d size.y / referenceSize;\nreturn getSize(referenceSize) / referenceSize;\n#else\nreturn 1.;\n#endif\n}\nvoid main()\n{\nINIT;\nfloat a_bitSet \x3d a_bitSetAndDistRatio.x;\nvec3  pos           \x3d vec3(a_pos * POSITION_PRECISION, 1.0);\nvec2  size          \x3d a_sizeAndOutlineWidth.xy * a_sizeAndOutlineWidth.xy / 128.0;\nvec3  offset        \x3d vec3(a_vertexOffset / 16.0, 0.);\nfloat outlineSize   \x3d a_sizeAndOutlineWidth.z * a_sizeAndOutlineWidth.z / 128.0;\nfloat isMapAligned  \x3d getBit(a_bitSet, BITSET_MARKER_ALIGNMENT_MAP);\nfloat referenceSize \x3d a_sizeAndOutlineWidth.w * a_sizeAndOutlineWidth.w / 128.0;\nfloat scaleSymbolProportionally \x3d getBit(a_bitSet, BITSET_MARKER_SCALE_SYMBOLS_PROPORTIONALLY);\nfloat scaleFactor               \x3d getMarkerScaleFactor(size, referenceSize);\nsize.xy     *\x3d scaleFactor;\noffset.xy   *\x3d scaleFactor;\noutlineSize *\x3d scaleSymbolProportionally * (scaleFactor - 1.0) + 1.0;\nvec2 v_tex   \x3d a_texCoords / u_mosaicSize;\nfloat filterFlags \x3d getFilterFlags();\nv_color    \x3d getColor(a_color, a_bitSet, BITSET_GENERIC_LOCK_COLOR);\nv_opacity  \x3d getOpacity();\nv_id       \x3d norm(a_id);\nv_pos      \x3d u_dvsMat3 * pos + getMatrix(isMapAligned) * getRotation()  * offset;\nv_sizeTex  \x3d vec4(size.xy, v_tex.xy);\n#ifdef SDF\nv_isThin   \x3d getBit(a_bitSet, BITSET_MARKER_OUTLINE_ALLOW_COLOR_OVERRIDE);\n#ifdef VV_COLOR\nv_overridingOutlineColor \x3d v_isThin;\n#else\nv_overridingOutlineColor \x3d 0.0;\n#endif\nv_outlineWidth \x3d min(outlineSize, max(max(size.x, size.y) - 0.99, 0.0));\nv_outlineColor \x3d a_outlineColor;\nv_distRatio \x3d a_bitSetAndDistRatio.y / 128.0;\n#endif\n#ifdef HITTEST\nhighp vec4 out_color \x3d vec4(0.);\nhighp vec3 out_pos   \x3d vec3(0.);\nhittestIcon(out_color, out_pos, pos, offset, size, scaleFactor, isMapAligned);\nv_color \x3d out_color;\ngl_PointSize \x3d 1.;\ngl_Position \x3d vec4(clip(v_color, out_pos, filterFlags, a_zoomRange), 1.0);\n#else\ngl_Position \x3d vec4(clip(v_color, v_pos, filterFlags, a_zoomRange), 1.0);\n#endif\n}"},
label:{"common.glsl":"uniform mediump float u_zoomLevel;\nuniform mediump float u_mapRotation;\nuniform mediump float u_mapAligned;\nuniform mediump vec2 u_mosaicSize;\nvarying mediump float v_antialiasingWidth;\nvarying mediump float v_edgeDistanceOffset;\nvarying mediump vec2 v_tex;\nvarying mediump vec4 v_color;\nvarying lowp vec4 v_animation;","label.frag":"#include \x3cmaterials/text/text.frag\x3e","label.vert":"precision highp float;\n#include \x3cmaterials/vcommon.glsl\x3e\n#include \x3cmaterials/text/common.glsl\x3e\nattribute vec4 a_color;\nattribute vec4 a_haloColor;\nattribute vec4 a_texAndSize;\nattribute vec4 a_refSymbolAndPlacementOffset;\nattribute vec4 a_glyphData;\nattribute vec2 a_vertexOffset;\nattribute vec2 a_texCoords;\nuniform float u_isHaloPass;\nuniform float u_isBackgroundPass;\nuniform float u_mapRotation;\nuniform float u_mapAligned;\nfloat getZ(in float minZoom, in float maxZoom, in float angle) {\nfloat glyphAngle \x3d angle * 360.0 / 254.0;\nfloat mapAngle \x3d u_mapRotation * 360.0 / 254.0;\nfloat diffAngle \x3d min(360.0 - abs(mapAngle - glyphAngle), abs(mapAngle - glyphAngle));\nfloat z \x3d 0.0;\nz +\x3d u_mapAligned * (2.0 * (1.0 - step(minZoom, u_currentZoom)));\nz +\x3d u_mapAligned * 2.0 * step(90.0, diffAngle);\nz +\x3d 2.0 * (1.0 - step(u_currentZoom, maxZoom));\nreturn z;\n}\nvoid main()\n{\nINIT;\nfloat groupMinZoom    \x3d getMinZoom();\nfloat glyphMinZoom    \x3d a_glyphData.x;\nfloat glyphMaxZoom    \x3d a_glyphData.y;\nfloat glyphAngle      \x3d a_glyphData.z;\nfloat a_isBackground  \x3d a_glyphData.w;\nfloat a_minZoom          \x3d max(groupMinZoom, glyphMinZoom);\nfloat a_placementPadding \x3d a_refSymbolAndPlacementOffset.x * EXTRUDE_SCALE_PLACEMENT_PADDING;\nvec2  a_placementDir     \x3d unpack_u8_nf32(a_refSymbolAndPlacementOffset.zw);\nfloat a_refSymbolSize    \x3d a_refSymbolAndPlacementOffset.y;\nfloat fontSize           \x3d a_texAndSize.z;\nfloat haloSize           \x3d a_texAndSize.w * OUTLINE_SCALE;\nvec2  vertexOffset \x3d a_vertexOffset * OFFSET_PRECISION;\nvec3  pos          \x3d vec3(a_pos * POSITION_PRECISION, 1.0);\nfloat z            \x3d getZ(a_minZoom, glyphMaxZoom, glyphAngle);\nfloat fontScale    \x3d fontSize / SDF_FONT_SIZE;\nfloat halfSize     \x3d getSize(a_refSymbolSize) / 2.0;\nfloat animation    \x3d pow(getAnimationState(), vec4(2.0)).r;\nfloat isText \x3d 1.0 - a_isBackground;\nfloat isBackground \x3d u_isBackgroundPass * a_isBackground;\nvec4  nonHaloColor \x3d (isBackground + isText) * a_color;\nv_color     \x3d animation * ((1.0 - u_isHaloPass) * nonHaloColor + (u_isHaloPass * a_haloColor));\nv_opacity   \x3d 1.0;\nv_tex       \x3d a_texCoords / u_mosaicSize;\nv_edgeDistanceOffset \x3d u_isHaloPass * haloSize / fontScale / MAX_SDF_DISTANCE;\nv_antialiasingWidth  \x3d 0.105 * SDF_FONT_SIZE / fontSize / u_pixelRatio;\nvec2 placementOffset \x3d a_placementDir * (halfSize + a_placementPadding);\nvec3 glyphOffset     \x3d u_displayMat3 * vec3(vertexOffset + placementOffset, 0.0);\nvec3 v_pos           \x3d vec3((u_dvsMat3 * pos + glyphOffset).xy, z);\nfloat isHidden \x3d u_isBackgroundPass * isText + (1.0 - u_isBackgroundPass) * a_isBackground;\nv_pos.z +\x3d 2.0 * isHidden;\ngl_Position \x3d vec4(v_pos, 1.0);\n#ifdef DEBUG\nv_color \x3d vec4(a_color.rgb, z \x3d\x3d 0.0 ? 1.0 : 0.645);\n#endif\n}"},
line:{"common.glsl":"varying lowp vec4 v_color;\nvarying highp vec3 v_id;\nvarying mediump vec2 v_normal;\nvarying mediump float v_lineHalfWidth;\nvarying lowp float v_opacity;\n#ifdef PATTERN\nvarying mediump vec4 v_tlbr;\nvarying mediump vec2 v_patternSize;\n#endif\n#if defined(PATTERN) || defined(SDF)\nvarying highp float v_accumulatedDistance;\n#endif\n#ifdef SDF\nvarying mediump float v_lineWidthRatio;\n#endif","hittest.glsl":"#include \x3cmaterials/hittest/common.glsl\x3e\n#ifdef HITTEST\nattribute vec2 a_pos1;\nattribute vec2 a_pos2;\nvoid hittestLine(out lowp vec4 out_color, out highp vec3 out_pos, float halfWidth) {\nvec3 pos        \x3d u_viewMat3 * u_tileMat3 * vec3(a_pos  * POSITION_PRECISION, 1.);\nvec3 pos1       \x3d u_viewMat3 * u_tileMat3 * vec3(a_pos1 * POSITION_PRECISION, 1.);\nvec3 pos2       \x3d u_viewMat3 * u_tileMat3 * vec3(a_pos2 * POSITION_PRECISION, 1.);\nvec3 outTextureCoords \x3d vec3(getAttributeDataTextureCoords(a_id), 0.0);\nfloat dist \x3d min(distPointSegment(u_hittestPos, pos.xy, pos1.xy),\ndistPointSegment(u_hittestPos, pos.xy, pos2.xy)) - halfWidth;\nout_pos \x3d vec3(getAttributeDataTextureCoords(a_id), 0.0);\nif (dist \x3e\x3d u_hittestDist) {\nout_pos.z +\x3d 2.0;\n}\nout_color \x3d vec4(1. / 255., 0, 0, dist \x3c\x3d 0. ? (1. / 255.) : 0.);\n}\n#endif",
"line.frag":"precision lowp float;\n#include \x3cutil/encoding.glsl\x3e\n#include \x3cmaterials/constants.glsl\x3e\n#include \x3cmaterials/symbologyTypeUtils.glsl\x3e\n#include \x3cmaterials/line/common.glsl\x3e\n#include \x3cmaterials/shared/line/common.glsl\x3e\n#include \x3cmaterials/shared/line/line.frag\x3e\n#ifdef HITTEST\nvoid main() {\ngl_FragColor \x3d v_color;\n}\n#else\nvoid main() {\nLineData inputs \x3d LineData(\nv_color,\nv_normal,\nv_lineHalfWidth,\nv_opacity,\n#ifndef SYMBOLOGY_TYPE_IS_OUTLINE_FILL_LIKE\n#ifdef PATTERN\nv_tlbr,\nv_patternSize,\n#endif\n#ifdef SDF\nv_lineWidthRatio,\n#endif\n#if defined(PATTERN) || defined(SDF)\nv_accumulatedDistance,\n#endif\n#endif\nv_id\n);\ngl_FragColor \x3d shadeLine(inputs);\n}\n#endif",
"line.vert":"precision highp float;\nattribute vec4 a_color;\nattribute vec4 a_offsetAndNormal;\nattribute vec2 a_accumulatedDistanceAndHalfWidth;\nattribute vec4 a_tlbr;\nattribute vec4 a_segmentDirection;\nattribute vec2 a_aux;\nattribute vec2 a_zoomRange;\n#include \x3cmaterials/vcommon.glsl\x3e\n#include \x3cmaterials/symbologyTypeUtils.glsl\x3e\n#include \x3cmaterials/line/common.glsl\x3e\n#include \x3cmaterials/line/hittest.glsl\x3e\n#include \x3cmaterials/shared/line/common.glsl\x3e\n#include \x3cmaterials/shared/line/line.vert\x3e\n#ifdef HITTEST\nvoid draw() {\nfloat aa        \x3d 0.5 * u_antialiasing;\nfloat a_halfWidth \x3d a_accumulatedDistanceAndHalfWidth.y / 16.;\nfloat a_cimHalfWidth \x3d a_aux.x / 16. ;\nvec2  a_offset \x3d a_offsetAndNormal.xy / 16.;\nfloat baseWidth \x3d getBaseLineHalfWidth(a_halfWidth, a_cimHalfWidth);\nfloat halfWidth \x3d getLineHalfWidth(baseWidth, aa);\nhighp vec3 pos  \x3d vec3(0.);\nv_color \x3d vec4(0.);\nhittestLine(v_color, pos, halfWidth);\ngl_PointSize \x3d 1.;\ngl_Position \x3d vec4(clip(v_color, pos, getFilterFlags(), a_zoomRange), 1.0);\n}\n#else\nvoid draw()\n{\nhighp vec3 pos \x3d vec3(0.);\nLineData outputs \x3d buildLine(\npos,\na_id,\na_pos,\na_color,\na_offsetAndNormal.xy / 16.,\na_offsetAndNormal.zw / 16.,\na_accumulatedDistanceAndHalfWidth.x,\na_accumulatedDistanceAndHalfWidth.y / 16.,\na_segmentDirection.w,\na_tlbr,\na_segmentDirection.xy / 16.,\na_aux.x / 16.\n);\nv_id              \x3d outputs.id;\nv_color           \x3d outputs.color;\nv_normal          \x3d outputs.normal;\nv_lineHalfWidth   \x3d outputs.lineHalfWidth;\nv_opacity         \x3d outputs.opacity;\n#ifndef SYMBOLOGY_TYPE_IS_OUTLINE_FILL_LIKE\n#ifdef PATTERN\nv_tlbr          \x3d outputs.tlbr;\nv_patternSize   \x3d outputs.patternSize;\n#endif\n#ifdef SDF\nv_lineWidthRatio \x3d outputs.lineWidthRatio;\n#endif\n#if defined(PATTERN) || defined(SDF)\nv_accumulatedDistance \x3d outputs.accumulatedDistance;\n#endif\n#endif\ngl_Position \x3d vec4(clip(outputs.color, pos, getFilterFlags(), a_zoomRange), 1.0);\n}\n#endif\nvoid main() {\nINIT;\ndraw();\n}"},
pie:{"pie.common.glsl":"uniform float outlineWidth;\nuniform mediump float sectorThreshold;\nvarying vec3  v_id;\nvarying vec3  v_pos;\nvarying vec2  v_offset;\nvarying vec4  v_color;\nvarying float v_size;\nvarying float v_numOfEntries;\nvarying float v_maxSectorAngle;\nvarying vec2  v_filteredSectorToColorId[numberOfFields];\nvarying vec2  v_texCoords;\nvarying float v_outlineWidth;\nvarying float v_opacity;\nstruct FilteredChartInfo {\nfloat endSectorAngle;\nint colorId;\n};","pie.frag":"precision highp float;\n#include \x3cutil/atan2.glsl\x3e\n#include \x3cmaterials/constants.glsl\x3e\n#include \x3cmaterials/utils.glsl\x3e\n#include \x3cmaterials/pie/pie.common.glsl\x3e\nuniform lowp vec4 colors[numberOfFields];\nuniform lowp vec4 defaultColor;\nuniform lowp vec4 othersColor;\nuniform lowp vec4 outlineColor;\nuniform float donutRatio;\nlowp vec4 getSectorColor(in int index, in vec2 filteredSectorToColorId[numberOfFields]) {\nmediump int colorIndex \x3d int(filteredSectorToColorId[index].y);\nreturn colors[colorIndex];\n}\nconst int OTHER_SECTOR_ID \x3d 255;\n#ifdef HITTEST\nvec4 getColor() {\nfloat distanceSize \x3d length(v_offset) * v_size;\nfloat donutSize \x3d donutRatio * v_size;\nfloat alpha \x3d step(donutSize, distanceSize) * (1.0 - step(v_size, distanceSize));\nreturn v_color;\n}\n#else\nvec4 getColor() {\nfloat angle \x3d 90.0 - C_RAD_TO_DEG * atan2(v_offset.y, v_offset.x);\nif (angle \x3c 0.0) {\nangle +\x3d 360.0;\n} else if (angle \x3e 360.0) {\nangle \x3d mod(angle, 360.0);\n}\nint numOfEntries \x3d int(v_numOfEntries);\nfloat maxSectorAngle \x3d v_maxSectorAngle;\nlowp vec4 fillColor \x3d (maxSectorAngle \x3e 0.0 || sectorThreshold \x3e 0.0) ? othersColor : defaultColor;\nlowp vec4 prevColor \x3d vec4(0.0);\nlowp vec4 nextColor \x3d vec4(0.0);\nfloat startSectorAngle \x3d 0.0;\nfloat endSectorAngle \x3d 0.0;\nif (angle \x3c maxSectorAngle) {\nfor (int index \x3d 0; index \x3c numberOfFields; ++index) {\nstartSectorAngle \x3d endSectorAngle;\nendSectorAngle \x3d v_filteredSectorToColorId[index].x;\nif (endSectorAngle \x3e angle) {\nfillColor \x3d getSectorColor(index, v_filteredSectorToColorId);\nprevColor \x3d sectorThreshold !\x3d 0.0 \x26\x26 index \x3d\x3d 0 \x26\x26 abs(360.0 - maxSectorAngle) \x3c EPSILON ? othersColor :\ngetSectorColor(index \x3e 0 ? index - 1 : numOfEntries - 1, v_filteredSectorToColorId);\nnextColor \x3d sectorThreshold !\x3d 0.0 \x26\x26 abs(endSectorAngle - maxSectorAngle) \x3c EPSILON ? othersColor :\ngetSectorColor(index \x3c numOfEntries - 1 ? index + 1 : 0, v_filteredSectorToColorId);\nbreak;\n}\nif (index \x3d\x3d numOfEntries - 1) {\nbreak;\n}\n}\n} else {\nprevColor \x3d getSectorColor(numOfEntries - 1, v_filteredSectorToColorId);\nnextColor \x3d getSectorColor(0, v_filteredSectorToColorId);\nstartSectorAngle \x3d maxSectorAngle;\nendSectorAngle \x3d 360.0;\n}\nlowp vec4 outlineColor \x3d outlineColor;\nfloat offset \x3d length(v_offset);\nfloat distanceSize \x3d offset * v_size;\nif (startSectorAngle !\x3d 0.0 || endSectorAngle !\x3d 360.0) {\nfloat distanceToStartSector \x3d (angle - startSectorAngle);\nfloat distanceToEndSector \x3d (endSectorAngle - angle);\nfloat sectorThreshold \x3d 0.6;\nfloat beginSectorAlpha \x3d smoothstep(0.0, sectorThreshold, distanceToStartSector * offset);\nfloat endSectorAlpha \x3d smoothstep(0.0, sectorThreshold, distanceToEndSector * offset);\nif (endSectorAlpha \x3e 0.0) {\nfillColor \x3d mix(nextColor, fillColor, endSectorAlpha);\n} else if (beginSectorAlpha \x3e 0.0) {\nfillColor \x3d mix(prevColor, fillColor, beginSectorAlpha);\n}\n}\nfloat donutSize \x3d donutRatio * (v_size - v_outlineWidth);\nfloat endOfDonut \x3d donutSize - v_outlineWidth;\nfloat aaThreshold \x3d 0.75;\nfloat innerCircleAlpha \x3d endOfDonut - aaThreshold \x3e 0.0 ? smoothstep(endOfDonut - aaThreshold, endOfDonut + aaThreshold, distanceSize) : 1.0;\nfloat outerCircleAlpha \x3d 1.0 - smoothstep(v_size - aaThreshold, v_size + aaThreshold , distanceSize);\nfloat circleAlpha \x3d innerCircleAlpha * outerCircleAlpha;\nfloat startOfOutline \x3d v_size - v_outlineWidth;\nif (startOfOutline \x3e 0.0 \x26\x26 v_outlineWidth \x3e 0.25) {\nfloat outlineFactor \x3d smoothstep(startOfOutline - aaThreshold, startOfOutline + aaThreshold, distanceSize);\nfloat innerLineFactor \x3d donutSize - aaThreshold \x3e 0.0 ? 1.0 - smoothstep(donutSize - aaThreshold, donutSize + aaThreshold , distanceSize) : 0.0;\nfillColor \x3d mix(fillColor, outlineColor, innerLineFactor + outlineFactor);\n}\nreturn v_opacity * circleAlpha * fillColor;\n}\n#endif\nvoid main()\n{\nvec4 color \x3d getColor();\n#ifdef highlight\ncolor.a \x3d step(1.0 / 255.0, color.a);\n#endif\ngl_FragColor \x3d color;\n}",
"pie.vert":"#include \x3cmaterials/constants.glsl\x3e\n#include \x3cmaterials/utils.glsl\x3e\n#include \x3cmaterials/barycentric.glsl\x3e\n#include \x3cmaterials/vcommon.glsl\x3e\n#include \x3cmaterials/vv.glsl\x3e\n#include \x3cmaterials/attributeData.glsl\x3e\n#include \x3cmaterials/pie/pie.common.glsl\x3e\n#include \x3cmaterials/hittest/common.glsl\x3e\nattribute float a_bitSet;\nattribute vec2  a_offset;\nattribute vec2  a_texCoords;\nattribute vec2  a_size;\nattribute float a_referenceSize;\nattribute vec2  a_zoomRange;\nint filterValue(in float sectorAngle,\nin int currentIndex,\ninout FilteredChartInfo filteredInfo,\ninout vec2 filteredSectorToColorId[numberOfFields]) {\nif (sectorAngle \x3e sectorThreshold * 360.0) {\nfilteredInfo.endSectorAngle +\x3d sectorAngle;\nfilteredSectorToColorId[filteredInfo.colorId] \x3d vec2(filteredInfo.endSectorAngle, currentIndex);\n++filteredInfo.colorId;\n}\nreturn 0;\n}\nint filterValues(inout vec2 filteredSectorToColorId[numberOfFields],\ninout FilteredChartInfo filteredInfo,\nin float sectorAngles[numberOfFields]) {\nfor (int index \x3d 0; index \x3c numberOfFields; ++index) {\nfloat sectorValue \x3d sectorAngles[index];\nfilterValue(sectorValue, index, filteredInfo, filteredSectorToColorId);\n}\nreturn filteredInfo.colorId;\n}\nvec2 getMarkerSize(inout vec2 offset, inout vec2 baseSize, inout float outlineSize, in float a_referenceSize, in float bitSet) {\nvec2 outSize \x3d baseSize;\n#ifdef VV_SIZE\nfloat r \x3d getSize(a_referenceSize, currentScale) / a_referenceSize;\noutSize.xy *\x3d r;\noffset.xy *\x3d r;\nfloat scaleSymbolProportionally \x3d getBit(bitSet, BITSET_MARKER_SCALE_SYMBOLS_PROPORTIONALLY);\noutlineSize *\x3d scaleSymbolProportionally * (r - 1.0) + 1.0;\n#endif\nreturn outSize;\n}\nvec3 getOffset(in vec2 in_offset, float a_bitSet) {\nfloat isMapAligned \x3d getBit(a_bitSet, BITSET_MARKER_ALIGNMENT_MAP);\nvec3  offset       \x3d vec3(in_offset, 0.0);\nreturn getMatrix(isMapAligned) * offset;\n}\nfloat filterNaNValues(in float value) {\nreturn value !\x3d NAN_MAGIC_NUMBER \x26\x26 value \x3e 0.0 ? value : 0.0;\n}\nvoid main()\n{\nINIT;\nvec2  a_size   \x3d a_size;\nvec2  a_offset \x3d a_offset / 16.0;\nfloat outlineSize \x3d outlineWidth;\nfloat a_bitSet \x3d a_bitSet;\nfloat a_referenceSize \x3d a_referenceSize;\nvec2 a_texCoords \x3d a_texCoords / 4.0;\nvec2 markerSize \x3d getMarkerSize(a_offset, a_size, outlineSize, a_referenceSize, a_bitSet);\nfloat filterFlags \x3d getFilterFlags();\nvec3  pos         \x3d vec3(a_pos / 10.0, 1.0);\nv_opacity      \x3d getOpacity();\nv_id           \x3d norm(a_id);\nv_pos          \x3d displayViewScreenMat3 * pos + getOffset(a_offset, a_bitSet);\nv_offset       \x3d sign(a_texCoords - 0.5);\nv_size         \x3d max(markerSize.x, markerSize.y);\nv_outlineWidth \x3d outlineSize;\nfloat attributeData[10];\nvec4 attributeData3 \x3d getDataDriven0(a_id);\nattributeData[0] \x3d filterNaNValues(attributeData3.x);\nattributeData[1] \x3d filterNaNValues(attributeData3.y);\nattributeData[2] \x3d filterNaNValues(attributeData3.z);\nattributeData[3] \x3d filterNaNValues(attributeData3.w);\n#if (numberOfFields \x3e 4)\nvec4 attributeData4 \x3d getDataDriven1(a_id);\nattributeData[4] \x3d filterNaNValues(attributeData4.x);\nattributeData[5] \x3d filterNaNValues(attributeData4.y);\nattributeData[6] \x3d filterNaNValues(attributeData4.z);\nattributeData[7] \x3d filterNaNValues(attributeData4.w);\n#endif\n#if (numberOfFields \x3e 8)\nvec4 attributeData5 \x3d getDataDriven2(a_id);\nattributeData[8] \x3d filterNaNValues(attributeData5.x);\nattributeData[9] \x3d filterNaNValues(attributeData5.y);\n#endif\nfloat sum \x3d 0.0;\nfor (int i \x3d 0; i \x3c numberOfFields; ++i) {\nsum +\x3d attributeData[i];\n}\nfloat sectorAngles[numberOfFields];\nfor (int i \x3d 0; i \x3c numberOfFields; ++i) {\nsectorAngles[i] \x3d 360.0 * attributeData[i] / sum;\n}\nvec2 filteredSectorToColorId[numberOfFields];\nFilteredChartInfo filteredInfo \x3d FilteredChartInfo(0.0, 0);\nint numOfEntries \x3d filterValues(filteredSectorToColorId, filteredInfo, sectorAngles);\nv_numOfEntries \x3d float(numOfEntries);\nv_maxSectorAngle \x3d filteredInfo.endSectorAngle;\nv_filteredSectorToColorId \x3d filteredSectorToColorId;\n#ifdef HITTEST\nhighp vec3 out_pos \x3d vec3(0.0);\nv_color            \x3d vec4(0.0);\nhittestMarker(v_color, out_pos, viewMat3 * tileMat3 *  pos, v_size);\ngl_PointSize \x3d 1.0;\ngl_Position \x3d vec4(clip(v_color, out_pos, filterFlags, a_zoomRange), 1.0);\n#else\ngl_Position \x3d vec4(clip(v_color, v_pos, filterFlags, a_zoomRange), 1.0);\n#endif\n}"},
shared:{line:{"common.glsl":"#if !defined(SYMBOLOGY_TYPE_IS_OUTLINE_FILL_LIKE) \x26\x26 defined(PATTERN)\nuniform mediump vec2 u_mosaicSize;\nvarying mediump float v_sampleAlphaOnly;\n#endif\nstruct LineData {\nlowp vec4 color;\nmediump vec2 normal;\nmediump float lineHalfWidth;\nlowp float opacity;\n#ifndef SYMBOLOGY_TYPE_IS_OUTLINE_FILL_LIKE\n#ifdef PATTERN\nmediump vec4 tlbr;\nmediump vec2 patternSize;\n#endif\n#ifdef SDF\nmediump float lineWidthRatio;\n#endif\n#if defined(PATTERN) || defined(SDF)\nhighp float accumulatedDistance;\n#endif\n#endif\nhighp vec3 id;\n};",
"line.frag":"uniform lowp float u_blur;\n#if !defined(SYMBOLOGY_TYPE_IS_OUTLINE_FILL_LIKE) \x26\x26 !defined(HIGHLIGHT)\n#if defined(PATTERN) || defined(SDF)\nuniform sampler2D u_texture;\nuniform highp float u_pixelRatio;\n#endif\n#endif\n#if defined(SDF) \x26\x26 !defined(HIGHLIGHT) \x26\x26 !defined(SYMBOLOGY_TYPE_IS_OUTLINE_FILL_LIKE)\nlowp vec4 getLineColor(LineData line) {\nmediump float adjustedPatternWidth \x3d line.patternSize.x * 2.0 * line.lineWidthRatio;\nmediump float relativeTexX \x3d fract(line.accumulatedDistance / adjustedPatternWidth);\nmediump float relativeTexY \x3d 0.5 + 0.25 * line.normal.y;\nmediump vec2 texCoord \x3d mix(line.tlbr.xy, line.tlbr.zw, vec2(relativeTexX, relativeTexY));\nmediump float d \x3d rgba2float(texture2D(u_texture, texCoord)) - 0.5;\nfloat dist \x3d d * line.lineHalfWidth;\nreturn line.opacity * clamp(0.5 - dist, 0.0, 1.0) * line.color;\n}\n#elif defined(PATTERN) \x26\x26 !defined(HIGHLIGHT) \x26\x26 !defined(SYMBOLOGY_TYPE_IS_OUTLINE_FILL_LIKE)\nlowp vec4 getLineColor(LineData line) {\nmediump float lineHalfWidth \x3d line.lineHalfWidth;\nmediump float adjustedPatternHeight \x3d line.patternSize.y * 2.0 * lineHalfWidth / line.patternSize.x;\nmediump float relativeTexY \x3d fract(line.accumulatedDistance / adjustedPatternHeight);\nmediump float relativeTexX \x3d 0.5 + 0.5 * line.normal.y;\nmediump vec2 texCoord \x3d mix(line.tlbr.xy, line.tlbr.zw, vec2(relativeTexX, relativeTexY));\nlowp vec4 color \x3d texture2D(u_texture, texCoord);\n#ifdef VV_COLOR\nif (v_sampleAlphaOnly \x3e 0.5) {\ncolor.rgb \x3d vec3(color.a);\n}\n#endif\nreturn line.opacity * line.color * color;\n}\n#else\nlowp vec4 getLineColor(LineData line) {\nreturn line.opacity * line.color;\n}\n#endif\nvec4 shadeLine(LineData line)\n{\nmediump float thinLineFactor \x3d max(THIN_LINE_WIDTH_FACTOR * step(line.lineHalfWidth, THIN_LINE_HALF_WIDTH), 1.0);\nmediump float fragDist \x3d length(line.normal) * line.lineHalfWidth;\nlowp float alpha \x3d clamp(thinLineFactor * (line.lineHalfWidth - fragDist) / (u_blur + thinLineFactor - 1.0), 0.0, 1.0);\nlowp vec4 out_color \x3d getLineColor(line) * alpha;\n#ifdef HIGHLIGHT\nout_color.a \x3d step(1.0 / 255.0, out_color.a);\n#endif\n#ifdef ID\nif (out_color.a \x3c 1.0 / 255.0) {\ndiscard;\n}\nout_color \x3d vec4(line.id, 0.0);\n#endif\nreturn out_color;\n}",
"line.vert":"float getBaseLineHalfWidth(in float lineHalfWidth, in float referenceHalfWidth) {\n#ifdef VV_SIZE\nfloat refLineWidth \x3d 2.0 * referenceHalfWidth;\nreturn 0.5 * (lineHalfWidth / max(referenceHalfWidth, EPSILON)) * getSize(refLineWidth);\n#else\nreturn lineHalfWidth;\n#endif\n}\nfloat getLineHalfWidth(in float baseWidth, in float aa) {\nfloat halfWidth \x3d max(baseWidth + aa, 0.45) + 0.1 * aa;\n#ifdef HIGHLIGHT\nhalfWidth \x3d max(halfWidth, 2.0);\n#endif\nreturn halfWidth;\n}\nvec2 getDist(in vec2 offset, in float halfWidth) {\nfloat thinLineFactor \x3d max(THIN_LINE_WIDTH_FACTOR * step(halfWidth, THIN_LINE_HALF_WIDTH), 1.0);\nreturn thinLineFactor * halfWidth * offset;\n}\nLineData buildLine(\nout vec3 out_pos,\nin vec3 in_id,\nin vec2 in_pos,\nin vec4 in_color,\nin vec2 in_offset,\nin vec2 in_normal,\nin float in_accumulatedDist,\nin float in_lineHalfWidth,\nin float in_bitSet,\nin vec4 in_tlbr,\nin vec2 in_segmentDirection,\nin float in_referenceHalfWidth\n)\n{\nfloat aa        \x3d 0.5 * u_antialiasing;\nfloat baseWidth \x3d getBaseLineHalfWidth(in_lineHalfWidth, in_referenceHalfWidth);\nfloat halfWidth \x3d getLineHalfWidth(baseWidth, aa);\nfloat z         \x3d 2.0 * step(baseWidth, 0.0);\nvec2  dist      \x3d getDist(in_offset, halfWidth);\nvec3  offset    \x3d u_displayViewMat3 * vec3(dist, 0.0);\nvec3  pos       \x3d u_dvsMat3 * vec3(in_pos * POSITION_PRECISION, 1.0) + offset;\n#ifdef SYMBOLOGY_TYPE_IS_OUTLINE_FILL_LIKE\nvec4  color     \x3d in_color;\nfloat opacity   \x3d 1.0;\n#else\nvec4  color     \x3d getColor(in_color, in_bitSet, BITSET_GENERIC_LOCK_COLOR);\nfloat opacity   \x3d getOpacity();\n#ifdef SDF\nconst float SDF_PATTERN_HALF_WIDTH \x3d 15.5;\nfloat scaleDash \x3d getBit(in_bitSet, BITSET_LINE_SCALE_DASH);\nfloat lineWidthRatio \x3d (scaleDash * max(halfWidth - 0.55 * u_antialiasing, 0.25) + (1.0 - scaleDash)) / SDF_PATTERN_HALF_WIDTH;\n#endif\n#endif\n#if !defined(SYMBOLOGY_TYPE_IS_OUTLINE_FILL_LIKE) \x26\x26 defined(PATTERN)\nv_sampleAlphaOnly \x3d getBit(in_bitSet, BITSET_GENERIC_CONSIDER_ALPHA_ONLY);\n#endif\nout_pos \x3d vec3(pos.xy, z);\nreturn LineData(\ncolor,\nin_normal,\nhalfWidth,\nopacity,\n#ifndef SYMBOLOGY_TYPE_IS_OUTLINE_FILL_LIKE\n#ifdef PATTERN\nin_tlbr / u_mosaicSize.xyxy,\nvec2(in_tlbr.z - in_tlbr.x, in_tlbr.w - in_tlbr.y),\n#endif\n#ifdef SDF\nlineWidthRatio,\n#endif\n#if defined(PATTERN) || defined(SDF)\nin_accumulatedDist * u_zoomFactor + dot(in_segmentDirection, dist),\n#endif\n#endif\nnorm(in_id)\n);\n}"}},
"symbologyTypeUtils.glsl":"#if SYMBOLOGY_TYPE \x3d\x3d SYMBOLOGY_TYPE_OUTLINE_FILL || SYMBOLOGY_TYPE \x3d\x3d SYMBOLOGY_TYPE_OUTLINE_FILL_SIMPLE\n#define SYMBOLOGY_TYPE_IS_OUTLINE_FILL_LIKE\n#endif\n#if SYMBOLOGY_TYPE \x3d\x3d SYMBOLOGY_TYPE_SIMPLE || SYMBOLOGY_TYPE \x3d\x3d SYMBOLOGY_TYPE_OUTLINE_FILL_SIMPLE\n#define SYMBOLOGY_TYPE_IS_SIMPLE_LIKE\n#endif",text:{"common.glsl":"uniform highp vec2 u_mosaicSize;\nvarying highp vec3 v_id;\nvarying mediump vec3 v_pos;\nvarying lowp float v_opacity;\nvarying lowp vec4 v_color;\nvarying highp vec2 v_tex;\nvarying mediump float v_antialiasingWidth;\nvarying mediump float v_edgeDistanceOffset;\nvarying lowp float v_transparency;",
"hittest.glsl":"#include \x3cmaterials/hittest/common.glsl\x3e","text.frag":"precision mediump float;\n#include \x3cmaterials/text/common.glsl\x3e\nuniform lowp sampler2D u_texture;\n#ifdef HITTEST\nvec4 getColor() {\nreturn v_color;\n}\n#else\nvec4 getColor()\n{\nfloat SDF_CUTOFF \x3d (2.0 / 8.0);\nfloat SDF_BASE_EDGE_DIST \x3d 1.0 - SDF_CUTOFF;\nlowp float dist \x3d texture2D(u_texture, v_tex).a;\nmediump float edge \x3d SDF_BASE_EDGE_DIST - v_edgeDistanceOffset;\n#ifdef HIGHLIGHT\nedge /\x3d 2.0;\n#endif\nlowp float aa \x3d v_antialiasingWidth;\nlowp float alpha \x3d smoothstep(edge - aa, edge + aa, dist);\nreturn alpha * v_color * v_opacity;\n}\n#endif\nvoid main()\n{\ngl_FragColor \x3d getColor();\n}",
"text.vert":"precision highp float;\n#include \x3cmaterials/utils.glsl\x3e\n#include \x3cmaterials/vcommon.glsl\x3e\n#include \x3cmaterials/text/common.glsl\x3e\n#include \x3cmaterials/text/hittest.glsl\x3e\nattribute vec4 a_color;\nattribute vec4 a_haloColor;\nattribute vec4 a_texFontSize;\nattribute vec4 a_aux;\nattribute vec2 a_zoomRange;\nattribute vec2 a_vertexOffset;\nattribute vec2 a_texCoords;\nuniform float u_isHaloPass;\nuniform float u_isBackgroundPass;\nfloat getTextSize(inout vec2 offset, inout float baseSize, in float referenceSize) {\n#ifdef VV_SIZE\nfloat r \x3d getSize(referenceSize) / referenceSize;\nbaseSize *\x3d r;\noffset.xy *\x3d r;\nreturn baseSize;\n#endif\nreturn baseSize;\n}\nvoid main()\n{\nINIT;\nfloat a_isBackground  \x3d a_aux.y;\nfloat a_referenceSize \x3d a_aux.z * a_aux.z / 256.0;\nfloat a_bitSet        \x3d a_aux.w;\nfloat a_fontSize      \x3d a_texFontSize.z;\nvec2  a_offset        \x3d a_vertexOffset * OFFSET_PRECISION;\nvec3  in_pos        \x3d vec3(a_pos * POSITION_PRECISION, 1.0);\nfloat fontSize      \x3d getTextSize(a_offset, a_fontSize, a_referenceSize);\nfloat fontScale     \x3d fontSize / SDF_FONT_SIZE;\nvec3  offset        \x3d getRotation() * vec3(a_offset, 0.0);\nmat3  extrudeMatrix \x3d getBit(a_bitSet, 0) \x3d\x3d 1.0 ? u_displayViewMat3 : u_displayMat3;\nfloat isText \x3d 1.0 - a_isBackground;\nfloat isBackground \x3d u_isBackgroundPass * a_isBackground;\nvec4  nonHaloColor  \x3d (isBackground * a_color) + (isText * getColor(a_color, a_bitSet, 1));\nv_color   \x3d u_isHaloPass * a_haloColor + (1.0 - u_isHaloPass) * nonHaloColor;\nv_opacity \x3d getOpacity();\nv_id      \x3d norm(a_id);\nv_tex     \x3d a_texCoords / u_mosaicSize;\nv_pos     \x3d u_dvsMat3 * in_pos + extrudeMatrix * offset;\nfloat isHidden \x3d u_isBackgroundPass * isText + (1.0 - u_isBackgroundPass) * a_isBackground;\nv_pos.z +\x3d 2.0 * isHidden;\nv_edgeDistanceOffset \x3d u_isHaloPass * OUTLINE_SCALE * a_texFontSize.w / fontScale / MAX_SDF_DISTANCE;\nv_antialiasingWidth  \x3d 0.105 * SDF_FONT_SIZE / fontSize / u_pixelRatio;\n#ifdef HITTEST\nhighp vec3 out_pos  \x3d vec3(0.);\nv_color \x3d vec4(0.);\nhittestMarker(v_color, out_pos, u_viewMat3 * u_tileMat3 *  vec3(a_pos * POSITION_PRECISION, 1.0)\n+ u_tileMat3 * offset, fontSize / 2.);\ngl_PointSize \x3d 1.;\ngl_Position \x3d vec4(clip(v_color, out_pos, getFilterFlags(), a_zoomRange), 1.0);\n#else\ngl_Position \x3d  vec4(clip(v_color, v_pos, getFilterFlags(), a_zoomRange), 1.0);\n#endif\n}"},
"utils.glsl":"float rshift(in float u32, in int amount) {\nreturn floor(u32 / pow(2.0, float(amount)));\n}\nfloat getBit(in float bitset, in int bitIndex) {\nfloat offset \x3d pow(2.0, float(bitIndex));\nreturn mod(floor(bitset / offset), 2.0);\n}\nconst int maxHighlightReasons \x3d 6;\nfloat getFilterBit(in float bitset, in int bitIndex) {\nreturn getBit(bitset, bitIndex + maxHighlightReasons);\n}\nfloat getHighlightBit(in float bitset, in int bitIndex) {\nreturn getBit(bitset, bitIndex);\n}\nhighp vec3 unpackDisplayIdTexel(in highp vec3 bitset) {\nfloat isAggregate \x3d getBit(bitset.b, 7);\nreturn (1.0 - isAggregate) * bitset + isAggregate * (vec3(bitset.rgb) - vec3(0.0, 0.0, float(0x80)));\n}\nvec4 unpack(in float u32) {\nfloat r \x3d mod(rshift(u32, 0), 255.0);\nfloat g \x3d mod(rshift(u32, 8), 255.0);\nfloat b \x3d mod(rshift(u32, 16), 255.0);\nfloat a \x3d mod(rshift(u32, 24), 255.0);\nreturn vec4(r, g, b, a);\n}\nvec3 norm(in vec3 v) {\nreturn v /\x3d 255.0;\n}\nvec4 norm(in vec4 v) {\nreturn v /\x3d 255.0;\n}\nfloat max4(vec4 target) {\nreturn max(max(max(target.x, target.y), target.z), target.w);\n}\nvec2 unpack_u8_nf32(vec2 bytes) {\nreturn (bytes - 127.0) / 127.0;\n}\nhighp float rand(in vec2 co) {\nhighp float a \x3d 12.9898;\nhighp float b \x3d 78.233;\nhighp float c \x3d 43758.5453;\nhighp float dt \x3d dot(co, vec2(a,b));\nhighp float sn \x3d mod(dt, 3.14);\nreturn fract(sin(sn) * c);\n}",
"vcommon.glsl":"#include \x3cmaterials/constants.glsl\x3e\n#include \x3cmaterials/utils.glsl\x3e\n#include \x3cmaterials/attributeData.glsl\x3e\n#include \x3cmaterials/vv.glsl\x3e\n#include \x3cmaterials/barycentric.glsl\x3e\nattribute vec2 a_pos;\nattribute highp vec3 a_id;\nuniform highp mat3 displayViewScreenMat3;\nuniform highp mat3 displayViewMat3;\nuniform highp mat3 displayMat3;\nuniform highp mat3 tileMat3;\nuniform highp mat3 viewMat3;\nuniform highp float pixelRatio;\nuniform mediump float zoomFactor;\nuniform mediump float antialiasing;\nuniform mediump float currentScale;\nuniform mediump float currentZoom;\nuniform mediump float metersPerSRUnit;\nvec4 VV_ADATA \x3d vec4(0.0);\nvoid loadVisualVariableData(inout vec4 target) {\ntarget.rgba \x3d getVisualVariableData(a_id);\n}\n#ifdef VV\n#define INIT loadVisualVariableData(VV_ADATA)\n#else\n#define INIT\n#endif\nvec4 getColor(in vec4 a_color, in float a_bitSet, int index) {\n#ifdef VV_COLOR\nfloat isColorLocked   \x3d getBit(a_bitSet, index);\nreturn getVVColor(VV_ADATA[ATTR_VV_COLOR], a_color, isColorLocked);\n#else\nreturn a_color;\n#endif\n}\nfloat getOpacity() {\n#ifdef VV_OPACITY\nreturn getVVOpacity(VV_ADATA[ATTR_VV_OPACITY]);\n#else\nreturn 1.0;\n#endif\n}\nfloat getSize(in float in_size, in float currentScale) {\n#ifdef VV_SIZE\nreturn getVVSize(in_size, VV_ADATA[ATTR_VV_SIZE], currentScale);\n#else\nreturn in_size;\n#endif\n}\nmat3 getRotation() {\n#ifdef VV_ROTATION\nreturn getVVRotationMat3(mod(VV_ADATA[ATTR_VV_ROTATION], 360.0));\n#else\nreturn mat3(1.0);\n#endif\n}\nfloat getFilterFlags() {\n#ifdef IGNORES_SAMPLER_PRECISION\nreturn ceil(getFilterData(a_id).x * 255.0);\n#else\nreturn getFilterData(a_id).x * 255.0;\n#endif\n}\nvec4 getAnimationState() {\nreturn getAnimation(a_id);\n}\nfloat getMinZoom() {\nvec4 data0 \x3d getFilterData(a_id) * 255.0;\nreturn data0.g;\n}\nmat3 getMatrixNoDisplay(float isMapAligned) {\nreturn isMapAligned * viewMat3 * tileMat3 + (1.0 - isMapAligned) * tileMat3;\n}\nmat3 getMatrix(float isMapAligned) {\nreturn isMapAligned * displayViewMat3 + (1.0 - isMapAligned) * displayMat3;\n}\nfloat checkHighlightBit(float filterFlags, int index) {\nreturn getHighlightBit(filterFlags, index);\n}\nfloat checkHighlight(float filterFlags) {\nfloat result \x3d checkHighlightBit(filterFlags, 0);\nfor (int i \x3d 1; i \x3c maxHighlightReasons; i++) {\nresult \x3d result + checkHighlightBit(filterFlags, i);\n}\nreturn step(0.1, result);\n}\nvec3 clip(inout vec4 color, inout vec3 pos, in float filterFlags, in vec2 minMaxZoom) {\npos.z +\x3d 2.0 * (1.0 - getFilterBit(filterFlags, 0));\n#ifdef inside\npos.z +\x3d 2.0 * (1.0 - getFilterBit(filterFlags, 1));\n#elif defined(outside)\npos.z +\x3d 2.0 * getFilterBit(filterFlags, 1);\n#elif defined(highlight)\n#if !defined(highlight_all)\npos.z +\x3d 2.0 * (1.0 - checkHighlight(filterFlags));\n#endif\n#endif\npos.z +\x3d 2.0 * (step(minMaxZoom.y, currentZoom) + (1.0 - step(minMaxZoom.x, currentZoom)));\nreturn pos;\n}",
"vv.glsl":"#if defined(VV_SIZE_MIN_MAX_VALUE) || defined(VV_SIZE_SCALE_STOPS) || defined(VV_SIZE_FIELD_STOPS) || defined(VV_SIZE_UNIT_VALUE)\n#define VV_SIZE\n#endif\n#if defined(VV_COLOR) || defined(VV_SIZE) || defined(VV_OPACITY) || defined(VV_ROTATION)\n#define VV\n#endif\n#ifdef VV_COLOR\nuniform highp float colorValues[8];\nuniform vec4 colors[8];\n#endif\n#ifdef VV_SIZE_MIN_MAX_VALUE\nuniform highp vec4 minMaxValueAndSize;\n#endif\n#ifdef VV_SIZE_SCALE_STOPS\nuniform highp float values[8];\nuniform float sizes[8];\n#endif\n#ifdef VV_SIZE_FIELD_STOPS\nuniform highp float values[8];\nuniform float sizes[8];\n#endif\n#ifdef VV_SIZE_UNIT_VALUE\nuniform highp float unitMeterRatio;\n#endif\n#ifdef VV_OPACITY\nuniform highp float opacityValues[8];\nuniform float opacities[8];\n#endif\n#ifdef VV_ROTATION\nuniform lowp float rotationType;\n#endif\nbool isNan(float val) {\nreturn (val \x3d\x3d NAN_MAGIC_NUMBER);\n}\n#ifdef VV_SIZE_MIN_MAX_VALUE\nfloat getVVMinMaxSize(float sizeValue, float fallback) {\nif (isNan(sizeValue)) {\nreturn fallback;\n}\nfloat interpolationRatio \x3d (sizeValue  - minMaxValueAndSize.x) / (minMaxValueAndSize.y - minMaxValueAndSize.x);\ninterpolationRatio \x3d clamp(interpolationRatio, 0.0, 1.0);\nreturn minMaxValueAndSize.z + interpolationRatio * (minMaxValueAndSize.w - minMaxValueAndSize.z);\n}\n#endif\n#ifdef VV_SIZE_SCALE_STOPS\nfloat getVVScaleStopsSize(float currentScale) {\nfloat outSize;\nif (currentScale \x3c\x3d values[0]) {\noutSize \x3d sizes[0];\n} else {\nif (currentScale \x3e\x3d values[7]) {\noutSize \x3d sizes[7];\n} else {\nint index;\nindex \x3d -1;\nfor (int i \x3d 0; i \x3c 8; i++) {\nif (values[i] \x3e currentScale) {\nindex \x3d i;\nbreak;\n}\n}\nint prevIndex \x3d index - 1;\nfloat a \x3d currentScale - values[prevIndex];\nfloat b \x3d values[index] - values[prevIndex];\noutSize \x3d mix(sizes[prevIndex], sizes[index], a / b);\n}\n}\nreturn outSize;\n}\n#endif\n#ifdef VV_SIZE_FIELD_STOPS\nconst int VV_SIZE_N \x3d 8;\nfloat getVVStopsSize(float sizeValue, float fallback) {\nif (isNan(sizeValue)) {\nreturn fallback;\n}\nif (sizeValue \x3c\x3d values[0]) {\nreturn sizes[0];\n}\nif (sizeValue \x3e\x3d values[VV_SIZE_N - 1]) {\nreturn sizes[VV_SIZE_N - 1];\n}\nfor (int i \x3d 1; i \x3c VV_SIZE_N; ++i) {\nif (values[i] \x3e\x3d sizeValue) {\nfloat f \x3d (sizeValue - values[i-1]) / (values[i] - values[i-1]);\nreturn mix(sizes[i-1], sizes[i], f);\n}\n}\nreturn sizes[VV_SIZE_N - 1];\n}\n#endif\n#ifdef VV_SIZE_UNIT_VALUE\nfloat getVVUnitValue(float sizeValue, float fallback) {\nif (isNan(sizeValue)) {\nreturn fallback;\n}\nreturn sizeValue * (metersPerSRUnit / unitMeterRatio);\n}\n#endif\n#ifdef VV_OPACITY\nconst int VV_OPACITY_N \x3d 8;\nfloat getVVOpacity(float opacityValue) {\nif (isNan(opacityValue)) {\nreturn 1.0;\n}\nif (opacityValue \x3c\x3d opacityValues[0]) {\nreturn opacities[0];\n}\nfor (int i \x3d 1; i \x3c VV_OPACITY_N; ++i) {\nif (opacityValues[i] \x3e\x3d opacityValue) {\nfloat f \x3d (opacityValue - opacityValues[i-1]) / (opacityValues[i] - opacityValues[i-1]);\nreturn mix(opacities[i-1], opacities[i], f);\n}\n}\nreturn opacities[VV_OPACITY_N - 1];\n}\n#endif\n#ifdef VV_ROTATION\nmat4 getVVRotation(float rotationValue) {\nif (isNan(rotationValue)) {\nreturn mat4(1, 0, 0, 0,\n0, 1, 0, 0,\n0, 0, 1, 0,\n0, 0, 0, 1);\n}\nfloat rotation \x3d rotationValue;\nif (rotationType \x3d\x3d 1.0) {\nrotation \x3d 90.0 - rotation;\n}\nfloat angle \x3d C_DEG_TO_RAD * rotation;\nfloat sinA \x3d sin(angle);\nfloat cosA \x3d cos(angle);\nreturn mat4(cosA, sinA, 0, 0,\n-sinA,  cosA, 0, 0,\n0,     0, 1, 0,\n0,     0, 0, 1);\n}\nmat3 getVVRotationMat3(float rotationValue) {\nif (isNan(rotationValue)) {\nreturn mat3(1, 0, 0,\n0, 1, 0,\n0, 0, 1);\n}\nfloat rotation \x3d rotationValue;\nif (rotationType \x3d\x3d 1.0) {\nrotation \x3d 90.0 - rotation;\n}\nfloat angle \x3d C_DEG_TO_RAD * -rotation;\nfloat sinA \x3d sin(angle);\nfloat cosA \x3d cos(angle);\nreturn mat3(cosA, -sinA, 0,\nsinA, cosA, 0,\n0,    0,    1);\n}\n#endif\n#ifdef VV_COLOR\nconst int VV_COLOR_N \x3d 8;\nvec4 getVVColor(float colorValue, vec4 fallback, float isColorLocked) {\nif (isNan(colorValue) || isColorLocked \x3d\x3d 1.0) {\nreturn fallback;\n}\nif (colorValue \x3c\x3d colorValues[0]) {\nreturn colors[0];\n}\nfor (int i \x3d 1; i \x3c VV_COLOR_N; ++i) {\nif (colorValues[i] \x3e\x3d colorValue) {\nfloat f \x3d (colorValue - colorValues[i-1]) / (colorValues[i] - colorValues[i-1]);\nreturn mix(colors[i-1], colors[i], f);\n}\n}\nreturn colors[VV_COLOR_N - 1];\n}\n#endif\nfloat getVVSize(in float size, in float vvSize, in float currentScale)  {\n#ifdef VV_SIZE_MIN_MAX_VALUE\nreturn getVVMinMaxSize(vvSize, size);\n#elif defined(VV_SIZE_SCALE_STOPS)\nfloat outSize \x3d getVVScaleStopsSize(currentScale);\nreturn isNan(outSize) ? size : outSize;\n#elif defined(VV_SIZE_FIELD_STOPS)\nfloat outSize \x3d getVVStopsSize(vvSize, size);\nreturn isNan(outSize) ? size : outSize;\n#elif defined(VV_SIZE_UNIT_VALUE)\nreturn getVVUnitValue(vvSize, size);\n#else\nreturn size;\n#endif\n}"},
"post-processing":{blit:{"blit.frag":"precision mediump float;\nuniform sampler2D u_texture;\nvarying vec2 v_uv;\nvoid main() {\ngl_FragColor \x3d texture2D(u_texture, v_uv);\n}"},bloom:{composite:{"composite.frag":"precision mediump float;\nvarying vec2 v_uv;\nuniform sampler2D u_blurTexture1;\nuniform sampler2D u_blurTexture2;\nuniform sampler2D u_blurTexture3;\nuniform sampler2D u_blurTexture4;\nuniform sampler2D u_blurTexture5;\nuniform float u_bloomStrength;\nuniform float u_bloomRadius;\nuniform float u_bloomFactors[NUMMIPS];\nuniform vec3 u_bloomTintColors[NUMMIPS];\nfloat lerpBloomFactor(const in float factor) {\nfloat mirrorFactor \x3d 1.2 - factor;\nreturn mix(factor, mirrorFactor, u_bloomRadius);\n}\nvoid main() {\nvec4 color \x3d u_bloomStrength * (\nlerpBloomFactor(u_bloomFactors[0]) * vec4(u_bloomTintColors[0], 1.0) * texture2D(u_blurTexture1, v_uv) +\nlerpBloomFactor(u_bloomFactors[1]) * vec4(u_bloomTintColors[1], 1.0) * texture2D(u_blurTexture2, v_uv) +\nlerpBloomFactor(u_bloomFactors[2]) * vec4(u_bloomTintColors[2], 1.0) * texture2D(u_blurTexture3, v_uv) +\nlerpBloomFactor(u_bloomFactors[3]) * vec4(u_bloomTintColors[3], 1.0) * texture2D(u_blurTexture4, v_uv) +\nlerpBloomFactor(u_bloomFactors[4]) * vec4(u_bloomTintColors[4], 1.0) * texture2D(u_blurTexture5, v_uv)\n);\ngl_FragColor \x3d clamp(color, 0.0, 1.0);\n}"},
gaussianBlur:{"gaussianBlur.frag":"precision mediump float;\nuniform sampler2D u_colorTexture;\nuniform vec2 u_texSize;\nuniform vec2 u_direction;\nvarying vec2 v_uv;\n#define KERNEL_RADIUS RADIUS\n#define SIGMA RADIUS\nfloat gaussianPdf(in float x, in float sigma) {\nreturn 0.39894 * exp(-0.5 * x * x / ( sigma * sigma)) / sigma;\n}\nvoid main() {\nvec2 invSize \x3d 1.0 / u_texSize;\nfloat fSigma \x3d float(SIGMA);\nfloat weightSum \x3d gaussianPdf(0.0, fSigma);\nvec4 pixelColorSum \x3d texture2D(u_colorTexture, v_uv) * weightSum;\nfor (int i \x3d 1; i \x3c KERNEL_RADIUS; i ++) {\nfloat x \x3d float(i);\nfloat w \x3d gaussianPdf(x, fSigma);\nvec2 uvOffset \x3d u_direction * invSize * x;\nvec4 sample1 \x3d texture2D(u_colorTexture, v_uv + uvOffset);\nvec4 sample2 \x3d texture2D(u_colorTexture, v_uv - uvOffset);\npixelColorSum +\x3d (sample1 + sample2) * w;\nweightSum +\x3d 2.0 * w;\n}\ngl_FragColor \x3d pixelColorSum /weightSum;\n}"},
luminosityHighPass:{"luminosityHighPass.frag":"precision mediump float;\nuniform sampler2D u_texture;\nuniform vec3 u_defaultColor;\nuniform float u_defaultOpacity;\nuniform float u_luminosityThreshold;\nuniform float u_smoothWidth;\nvarying vec2 v_uv;\nvoid main() {\nvec4 texel \x3d texture2D(u_texture, v_uv);\nvec3 luma \x3d vec3(0.299, 0.587, 0.114);\nfloat v \x3d dot(texel.xyz, luma);\nvec4 outputColor \x3d vec4(u_defaultColor.rgb, u_defaultOpacity);\nfloat alpha \x3d smoothstep(u_luminosityThreshold, u_luminosityThreshold + u_smoothWidth, v);\ngl_FragColor \x3d mix(outputColor, texel, alpha);\n}"}},
blur:{gaussianBlur:{"gaussianBlur.frag":"precision mediump float;\nuniform sampler2D u_colorTexture;\nuniform vec2 u_texSize;\nuniform vec2 u_direction;\nuniform float u_sigma;\nvarying vec2 v_uv;\n#define KERNEL_RADIUS RADIUS\nfloat gaussianPdf(in float x, in float sigma) {\nreturn 0.39894 * exp(-0.5 * x * x / ( sigma * sigma)) / sigma;\n}\nvoid main() {\nvec2 invSize \x3d 1.0 / u_texSize;\nfloat fSigma \x3d u_sigma;\nfloat weightSum \x3d gaussianPdf(0.0, fSigma);\nvec4 pixelColorSum \x3d texture2D(u_colorTexture, v_uv) * weightSum;\nfor (int i \x3d 1; i \x3c KERNEL_RADIUS; i ++) {\nfloat x \x3d float(i);\nfloat w \x3d gaussianPdf(x, fSigma);\nvec2 uvOffset \x3d u_direction * invSize * x;\nvec4 sample1 \x3d texture2D(u_colorTexture, v_uv + uvOffset);\nvec4 sample2 \x3d texture2D(u_colorTexture, v_uv - uvOffset);\npixelColorSum +\x3d (sample1 + sample2) * w;\nweightSum +\x3d 2.0 * w;\n}\ngl_FragColor \x3d pixelColorSum /weightSum;\n}"},
"radial-blur":{"radial-blur.frag":"precision mediump float;\nuniform sampler2D u_colorTexture;\nvarying vec2 v_uv;\nconst float sampleDist \x3d 1.0;\nconst float sampleStrength \x3d 2.2;\nvoid main(void) {\nfloat samples[10];\nsamples[0] \x3d -0.08;\nsamples[1] \x3d -0.05;\nsamples[2] \x3d -0.03;\nsamples[3] \x3d -0.02;\nsamples[4] \x3d -0.01;\nsamples[5] \x3d  0.01;\nsamples[6] \x3d  0.02;\nsamples[7] \x3d  0.03;\nsamples[8] \x3d  0.05;\nsamples[9] \x3d  0.08;\nvec2 dir \x3d 0.5 - v_uv;\nfloat dist \x3d sqrt(dir.x * dir.x + dir.y * dir.y);\ndir \x3d dir / dist;\nvec4 color \x3d texture2D(u_colorTexture,v_uv);\nvec4 sum \x3d color;\nfor (int i \x3d 0; i \x3c 10; i++) {\nsum +\x3d texture2D(u_colorTexture, v_uv + dir * samples[i] * sampleDist);\n}\nsum *\x3d 1.0 / 11.0;\nfloat t \x3d dist * sampleStrength;\nt \x3d clamp(t, 0.0, 1.0);\ngl_FragColor \x3d mix(color, sum, t);\n}"}},
dra:{"dra.frag":"precision mediump float;\nuniform sampler2D u_minColor;\nuniform sampler2D u_maxColor;\nuniform sampler2D u_texture;\nvarying vec2 v_uv;\nvoid main() {\nvec4 minColor \x3d texture2D(u_minColor, vec2(0.5));\nvec4 maxColor \x3d texture2D(u_maxColor, vec2(0.5));\nvec4 color \x3d texture2D(u_texture, v_uv);\nvec3 minColorUnpremultiply \x3d minColor.rgb / minColor.a;\nvec3 maxColorUnpremultiply \x3d maxColor.rgb / maxColor.a;\nvec3 colorUnpremultiply \x3d color.rgb / color.a;\nvec3 range \x3d maxColorUnpremultiply - minColorUnpremultiply;\ngl_FragColor \x3d vec4(color.a * (colorUnpremultiply - minColorUnpremultiply) / range, color.a);\n}",
"min-max":{"min-max.frag":"#extension GL_EXT_draw_buffers : require\nprecision mediump float;\n#define CELL_SIZE 2\nuniform sampler2D u_minTexture;\nuniform sampler2D u_maxTexture;\nuniform vec2 u_srcResolution;\nuniform vec2 u_dstResolution;\nvarying vec2 v_uv;\nvoid main() {\nvec2 srcPixel \x3d floor(gl_FragCoord.xy) * float(CELL_SIZE);\nvec2 onePixel \x3d vec2(1.0) / u_srcResolution;\nvec2 uv \x3d (srcPixel + 0.5) / u_srcResolution;\nvec4 minColor \x3d vec4(1.0);\nvec4 maxColor \x3d vec4(0.0);\nfor (int y \x3d 0; y \x3c CELL_SIZE; ++y) {\nfor (int x \x3d 0; x \x3c CELL_SIZE; ++x) {\nvec2 offset \x3d uv + vec2(x, y) * onePixel;\nminColor \x3d min(minColor, texture2D(u_minTexture, offset));\nmaxColor \x3d max(maxColor, texture2D(u_maxTexture, offset));\n}\n}\ngl_FragData[0] \x3d minColor;\ngl_FragData[1] \x3d maxColor;\n}"}},
"drop-shadow":{composite:{"composite.frag":"precision mediump float;\nuniform sampler2D u_layerFBOTexture;\nuniform sampler2D u_blurTexture;\nuniform vec4 u_shadowColor;\nuniform vec2 u_shadowOffset;\nuniform highp mat3 u_displayViewMat3;\nvarying vec2 v_uv;\nvoid main() {\nvec3 offset \x3d u_displayViewMat3 * vec3(u_shadowOffset, 0.0);\nvec4 layerColor \x3d texture2D(u_layerFBOTexture, v_uv);\nvec4 blurColor \x3d texture2D(u_blurTexture, v_uv - offset.xy / 2.0);\ngl_FragColor \x3d ((1.0 - layerColor.a) * blurColor.a * u_shadowColor + layerColor);\n}"}},
"edge-detect":{"frei-chen":{"frei-chen.frag":"precision mediump float;\nuniform sampler2D u_colorTexture;\nuniform vec2 u_texSize;\nvarying vec2 v_uv;\nvec2 texel \x3d vec2(1.0 / u_texSize.x, 1.0 / u_texSize.y);\nmat3 G[9];\nconst mat3 g0 \x3d mat3( 0.3535533845424652, 0, -0.3535533845424652, 0.5, 0, -0.5, 0.3535533845424652, 0, -0.3535533845424652 );\nconst mat3 g1 \x3d mat3( 0.3535533845424652, 0.5, 0.3535533845424652, 0, 0, 0, -0.3535533845424652, -0.5, -0.3535533845424652 );\nconst mat3 g2 \x3d mat3( 0, 0.3535533845424652, -0.5, -0.3535533845424652, 0, 0.3535533845424652, 0.5, -0.3535533845424652, 0 );\nconst mat3 g3 \x3d mat3( 0.5, -0.3535533845424652, 0, -0.3535533845424652, 0, 0.3535533845424652, 0, 0.3535533845424652, -0.5 );\nconst mat3 g4 \x3d mat3( 0, -0.5, 0, 0.5, 0, 0.5, 0, -0.5, 0 );\nconst mat3 g5 \x3d mat3( -0.5, 0, 0.5, 0, 0, 0, 0.5, 0, -0.5 );\nconst mat3 g6 \x3d mat3( 0.1666666716337204, -0.3333333432674408, 0.1666666716337204, -0.3333333432674408, 0.6666666865348816, -0.3333333432674408, 0.1666666716337204, -0.3333333432674408, 0.1666666716337204 );\nconst mat3 g7 \x3d mat3( -0.3333333432674408, 0.1666666716337204, -0.3333333432674408, 0.1666666716337204, 0.6666666865348816, 0.1666666716337204, -0.3333333432674408, 0.1666666716337204, -0.3333333432674408 );\nconst mat3 g8 \x3d mat3( 0.3333333432674408, 0.3333333432674408, 0.3333333432674408, 0.3333333432674408, 0.3333333432674408, 0.3333333432674408, 0.3333333432674408, 0.3333333432674408, 0.3333333432674408 );\nvoid main() {\nG[0] \x3d g0,\nG[1] \x3d g1,\nG[2] \x3d g2,\nG[3] \x3d g3,\nG[4] \x3d g4,\nG[5] \x3d g5,\nG[6] \x3d g6,\nG[7] \x3d g7,\nG[8] \x3d g8;\nmat3 I;\nfloat cnv[9];\nvec3 sample;\nfor (float i \x3d 0.0; i \x3c 3.0; i++) {\nfor (float j \x3d 0.0; j \x3c 3.0; j++) {\nsample \x3d texture2D(u_colorTexture, v_uv + texel * vec2(i - 1.0,j - 1.0)).rgb;\nI[int(i)][int(j)] \x3d length(sample);\n}\n}\nfor (int i \x3d 0; i \x3c 9; i++) {\nfloat dp3 \x3d dot(G[i][0], I[0]) + dot(G[i][1], I[1]) + dot(G[i][2], I[2]);\ncnv[i] \x3d dp3 * dp3;\n}\nfloat M \x3d (cnv[0] + cnv[1]) + (cnv[2] + cnv[3]);\nfloat S \x3d (cnv[4] + cnv[5]) + (cnv[6] + cnv[7]) + (cnv[8] + M);\ngl_FragColor \x3d vec4(vec3(sqrt(M / S)), texture2D(u_colorTexture, v_uv).a);\n}"},
sobel:{"sobel.frag":"precision mediump float;\nuniform sampler2D u_colorTexture;\nvarying vec2 v_uv;\nuniform vec2 u_texSize;\nvec2 texel \x3d vec2(1.0 / u_texSize.x, 1.0 / u_texSize.y);\nmat3 G[2];\nconst mat3 g0 \x3d mat3( 1.0, 2.0, 1.0, 0.0, 0.0, 0.0, -1.0, -2.0, -1.0 );\nconst mat3 g1 \x3d mat3( 1.0, 0.0, -1.0, 2.0, 0.0, -2.0, 1.0, 0.0, -1.0 );\nvoid main() {\nmat3 I;\nfloat cnv[2];\nvec3 sample;\nG[0] \x3d g0;\nG[1] \x3d g1;\nfor (float i \x3d 0.0; i \x3c 3.0; i++) {\nfor (float j \x3d 0.0; j \x3c 3.0; j++) {\nsample \x3d texture2D( u_colorTexture, v_uv + texel * vec2(i-1.0,j-1.0) ).rgb;\nI[int(i)][int(j)] \x3d length(sample);\n}\n}\nfor (int i \x3d 0; i \x3c 2; i++) {\nfloat dp3 \x3d dot(G[i][0], I[0]) + dot(G[i][1], I[1]) + dot(G[i][2], I[2]);\ncnv[i] \x3d dp3 * dp3;\n}\ngl_FragColor \x3d vec4(vec3(0.5 * sqrt(cnv[0] * cnv[0] + cnv[1] * cnv[1])), texture2D(u_colorTexture, v_uv).a);\n}"}},
"edge-enhance":{"edge-enhance.frag":"precision mediump float;\nuniform sampler2D u_colorTexture;\nvarying vec2 v_uv;\nuniform vec2 u_texSize;\nvec2 texel \x3d vec2(1.0 / u_texSize.x, 1.0 / u_texSize.y);\nmat3 G[2];\nconst mat3 g0 \x3d mat3( 1.0, 0.0, -1.0, 1.0, 0.0, -1.0, 1.0, 0.0, -1.0 );\nconst mat3 g1 \x3d mat3( 1.0, 1.0, 1.0, 0.0, 0.0, 0.0, -1.0, -1.0, -1.0 );\nvoid main() {\nmat3 I;\nfloat cnv[2];\nvec3 sample;\nG[0] \x3d g0;\nG[1] \x3d g1;\nfor (float i \x3d 0.0; i \x3c 3.0; i++) {\nfor (float j \x3d 0.0; j \x3c 3.0; j++) {\nsample \x3d texture2D( u_colorTexture, v_uv + texel * vec2(i-1.0,j-1.0) ).rgb;\nI[int(i)][int(j)] \x3d length(sample);\n}\n}\nfor (int i \x3d 0; i \x3c 2; i++) {\nfloat dp3 \x3d dot(G[i][0], I[0]) + dot(G[i][1], I[1]) + dot(G[i][2], I[2]);\ncnv[i] \x3d dp3 * dp3;\n}\nvec4 color \x3d texture2D(u_colorTexture, v_uv);\ngl_FragColor \x3d vec4(0.5 * sqrt(cnv[0] * cnv[0] + cnv[1] * cnv[1]) * color);\n}"},
filterEffect:{"filterEffect.frag":"precision mediump float;\nuniform sampler2D u_colorTexture;\nuniform mat4 u_coefficients;\nvarying vec2 v_uv;\nvoid main() {\nvec4 color \x3d texture2D(u_colorTexture, v_uv);\nvec4 rgbw \x3d u_coefficients * vec4(color.a \x3e 0.0 ? color.rgb / color.a : vec3(0.0), 1.0);\nfloat a \x3d color.a;\ngl_FragColor \x3d vec4(a * rgbw.rgb, a);\n}"},pp:{"pp.vert":"precision mediump float;\nattribute vec2 a_position;\nvarying vec2 v_uv;\nvoid main() {\ngl_Position \x3d vec4(a_position, 0.0, 1.0);\nv_uv \x3d (a_position + 1.0) / 2.0;\n}"}},
raster:{bitmap:{"bitmap.frag":"precision mediump float;\nvarying highp vec2 v_texcoord;\nuniform sampler2D u_texture;\nuniform highp vec2 u_coordScale;\nuniform lowp float u_opacity;\n#include \x3cfiltering/bicubic.glsl\x3e\nvoid main() {\n#ifdef BICUBIC\nvec4 color \x3d sampleBicubicBSpline(u_texture, v_texcoord, u_coordScale);\n#else\nvec4 color \x3d texture2D(u_texture, v_texcoord);\n#endif\ngl_FragColor \x3d vec4(color.rgb * u_opacity, color.a * u_opacity);\n}","bitmap.vert":"precision mediump float;\nattribute vec2 a_pos;\nuniform highp mat3 u_dvsMat3;\nuniform highp vec2 u_coordScale;\nvarying highp vec2 v_texcoord;\nvoid main()\n{\nv_texcoord \x3d a_pos;\ngl_Position \x3d vec4(u_dvsMat3 * vec3(a_pos * u_coordScale, 1.0), 1.0);\n}"},
common:{"common.glsl":"uniform sampler2D u_image;\nuniform int u_bandCount;\nuniform bool u_flipY;\nuniform float u_opacity;\nuniform int u_resampling;\nuniform vec2 u_srcImageSize;\n#ifdef APPLY_PROJECTION\n#include \x3craster/common/projection.glsl\x3e\n#endif\n#ifdef BICUBIC\n#include \x3cfiltering/bicubic.glsl\x3e\n#endif\n#ifdef BILINEAR\n#include \x3cfiltering/bilinear.glsl\x3e\n#endif\nvec2 getPixelLocation(vec2 coords) {\nvec2 targetLocation \x3d u_flipY ? vec2(coords.s, 1.0 - coords.t) : coords;\n#ifdef APPLY_PROJECTION\ntargetLocation \x3d projectPixelLocation(targetLocation);\n#endif\nreturn targetLocation;\n}\nbool isOutside(vec2 coords){\nif (coords.t\x3e1.00001 ||coords.t\x3c-0.00001 || coords.s\x3e1.00001 ||coords.s\x3c-0.00001) {\nreturn true;\n} else {\nreturn false;\n}\n}\nvec4 getPixel(vec2 pixelLocation) {\n#ifdef BICUBIC\nvec4 color \x3d sampleBicubicBSpline(u_image, pixelLocation, u_srcImageSize);\n#elif defined(BILINEAR)\nvec4 color \x3d sampleBilinear(u_image, pixelLocation, u_srcImageSize);\n#else\nvec4 color \x3d texture2D(u_image, pixelLocation);\n#endif\nreturn color;\n}",
"common.vert":"precision mediump float;\nattribute vec2 a_pos;\nuniform highp mat3 u_dvsMat3;\nuniform highp vec2 u_coordScale;\nuniform highp float u_scale;\nuniform highp vec2 u_offset;\nvarying highp vec2 v_texcoord;\nvoid main()\n{\nv_texcoord \x3d a_pos * u_scale + u_offset;\ngl_Position \x3d vec4(u_dvsMat3 * vec3(a_pos * u_coordScale, 1.0), 1.0);\n}","contrastBrightness.glsl":"uniform float u_contrastOffset;\nuniform float u_brightnessOffset;\nvec4 adjustContrastBrightness(vec4 currentPixel, bool isFloat) {\nvec4 pixelValue \x3d isFloat ? currentPixel * 255.0 : currentPixel;\nfloat maxI \x3d 255.0;\nfloat mid \x3d 128.0;\nfloat c \x3d u_contrastOffset;\nfloat b \x3d u_brightnessOffset;\nvec4 v;\nif (c \x3e 0.0 \x26\x26 c \x3c 100.0) {\nv \x3d (200.0 * pixelValue - 100.0 * maxI + 2.0 * maxI * b) / (2.0 * (100.0 - c)) + mid;\n} else if (c \x3c\x3d 0.0 \x26\x26 c \x3e -100.0) {\nv \x3d (200.0 * pixelValue - 100.0 * maxI + 2.0 * maxI * b) * (100.0 + c) / 20000.0 + mid;\n} else if (c \x3d\x3d 100.0) {\nv \x3d (200.0 * pixelValue - 100.0 * maxI + (maxI + 1.0) * (100.0 - c) + 2.0 * maxI * b);\nv \x3d (sign(v) + 1.0) / 2.0;\n} else if (c \x3d\x3d -100.0) {\nv \x3d vec4(mid, mid, mid, currentPixel.a);\n}\nvec3 rgb \x3d clamp(v.rgb / 255.0, 0.0, 1.0);\nreturn vec4(rgb, currentPixel.a);\n}",
"getSurfaceValues.glsl":"#include \x3craster/common/mirror.glsl\x3e\nvoid getSurfaceValues(sampler2D imageTexture, vec2 texCoord, vec2 srcImageSize, inout float values[10]) {\nvec2 onePixel \x3d 1.0 / srcImageSize;\nvec4 va \x3d texture2D(imageTexture, mirror(texCoord + onePixel * vec2(-1.0, -1.0)));\nvec4 vb \x3d texture2D(imageTexture, mirror(texCoord + onePixel * vec2(0.0, -1.0)));\nvec4 vc \x3d texture2D(imageTexture, mirror(texCoord + onePixel * vec2(1.0, -1.0)));\nvec4 vd \x3d texture2D(imageTexture, mirror(texCoord + onePixel * vec2(-1.0, 0.0)));\nvec4 ve \x3d texture2D(imageTexture, mirror(texCoord));\nvec4 vf \x3d texture2D(imageTexture, mirror(texCoord + onePixel * vec2(1.0, 0.0)));\nvec4 vg \x3d texture2D(imageTexture, mirror(texCoord + onePixel * vec2(-1.0, 1.0)));\nvec4 vh \x3d texture2D(imageTexture, mirror(texCoord + onePixel * vec2(0.0, 1.0)));\nvec4 vi \x3d texture2D(imageTexture, mirror(texCoord + onePixel * vec2(1.0, 1.0)));\nfloat alpha \x3d va.a * vb.a * vc.a * vd.a * ve.a * vf.a * vg.a * vh.a * vi.a;\nvalues[0] \x3d va.r;\nvalues[1] \x3d vb.r;\nvalues[2] \x3d vc.r;\nvalues[3] \x3d vd.r;\nvalues[4] \x3d ve.r;\nvalues[5] \x3d vf.r;\nvalues[6] \x3d vg.r;\nvalues[7] \x3d vh.r;\nvalues[8] \x3d vi.r;\nvalues[9] \x3d alpha;\n}",
"inverse.glsl":"float invertValue(float value) {\nfloat s \x3d sign(value);\nreturn (s * s) / (value + abs(s) - 1.0);\n}","mirror.glsl":"vec2 mirror(vec2 pos) {\nvec2 pos1 \x3d abs(pos);\nreturn step(pos1, vec2(1.0, 1.0)) * pos1 + step(1.0, pos1) * (2.0 - pos1);\n}","projection.glsl":"uniform sampler2D u_transformGrid;\nuniform vec2 u_transformSpacing;\nuniform vec2 u_transformGridSize;\nuniform vec2 u_targetImageSize;\nvec2 projectPixelLocation(vec2 coords) {\n#ifdef LOOKUP_PROJECTION\nvec4 pv \x3d texture2D(u_transformGrid, coords);\nreturn vec2(pv.r, pv.g);\n#endif\nvec2 index_image \x3d floor(coords * u_targetImageSize);\nvec2 oneTransformPixel \x3d vec2(0.25 / u_transformGridSize.s, 1.0 / u_transformGridSize.t);\nvec2 index_transform \x3d floor(index_image / u_transformSpacing) / u_transformGridSize;\nvec2 pos \x3d fract((index_image + vec2(0.5, 0.5)) / u_transformSpacing);\nvec2 srcLocation;\nvec2 transform_location \x3d index_transform + oneTransformPixel * 0.5;\nif (pos.s \x3c\x3d pos.t) {\nvec4 ll_abc \x3d texture2D(u_transformGrid, vec2(transform_location.s, transform_location.t));\nvec4 ll_def \x3d texture2D(u_transformGrid, vec2(transform_location.s + oneTransformPixel.s, transform_location.t));\nsrcLocation.s \x3d dot(ll_abc.rgb, vec3(pos, 1.0));\nsrcLocation.t \x3d dot(ll_def.rgb, vec3(pos, 1.0));\n} else {\nvec4 ur_abc \x3d texture2D(u_transformGrid, vec2(transform_location.s + 2.0 * oneTransformPixel.s, transform_location.t));\nvec4 ur_def \x3d texture2D(u_transformGrid, vec2(transform_location.s + 3.0 * oneTransformPixel.s, transform_location.t));\nsrcLocation.s \x3d dot(ur_abc.rgb, vec3(pos, 1.0));\nsrcLocation.t \x3d dot(ur_def.rgb, vec3(pos, 1.0));\n}\nreturn srcLocation;\n}"},
flow:{"getFadeOpacity.glsl":"uniform float u_decayRate;\nuniform float u_fadeToZero;\nfloat getFadeOpacity(float x) {\nfloat cutOff \x3d mix(0.0, exp(-u_decayRate), u_fadeToZero);\nreturn (exp(-u_decayRate * x) - cutOff) / (1.0 - cutOff);\n}","getFragmentColor.glsl":"vec4 getFragmentColor(vec4 color, float dist, float size, float featheringSize) {\nfloat featheringStart \x3d clamp(0.5 - featheringSize / size, 0.0, 0.5);\nif (dist \x3e featheringStart) {\ncolor *\x3d 1.0 - (dist - featheringStart) / (0.5 - featheringStart);\n}\nreturn color;\n}",
imagery:{"imagery.frag":"precision highp float;\nvarying vec2 v_texcoord;\nuniform sampler2D u_texture;\nuniform float u_Min;\nuniform float u_Max;\nuniform float u_featheringSize;\n#include \x3craster/flow/vv.glsl\x3e\nfloat getIntensity(float v) {\nreturn u_Min + v * (u_Max - u_Min);\n}\nvoid main(void) {\nvec4 sampled \x3d texture2D(u_texture, v_texcoord);\nfloat intensity \x3d getIntensity(sampled.r);\ngl_FragColor \x3d getColor(intensity);\ngl_FragColor.a *\x3d getOpacity(sampled.r);\ngl_FragColor.a *\x3d sampled.a;\ngl_FragColor.rgb *\x3d gl_FragColor.a;\n}",
"imagery.vert":"attribute vec2 a_position;\nattribute vec2 a_texcoord;\nuniform mat3 u_dvsMat3;\nvarying vec2 v_texcoord;\nvoid main(void) {\nvec2 xy \x3d (u_dvsMat3 * vec3(a_position, 1.0)).xy;\ngl_Position \x3d vec4(xy, 0.0, 1.0);\nv_texcoord \x3d a_texcoord;\n}"},particles:{"particles.frag":"precision highp float;\nvarying vec4 v_color;\nvarying vec2 v_texcoord;\nvarying float v_size;\nuniform float u_featheringSize;\n#include \x3craster/flow/getFragmentColor.glsl\x3e\nvoid main(void) {\ngl_FragColor \x3d getFragmentColor(v_color, length(v_texcoord - 0.5), v_size, u_featheringSize);\n}",
"particles.vert":"attribute vec4 a_xyts0;\nattribute vec4 a_xyts1;\nattribute vec4 a_typeIdDurationSeed;\nattribute vec4 a_extrudeInfo;\nuniform mat3 u_dvsMat3;\nuniform mat3 u_displayViewMat3;\nuniform float u_time;\nuniform float u_trailLength;\nuniform float u_flowSpeed;\nvarying vec4 v_color;\nvarying vec2 v_texcoord;\nvarying float v_size;\nuniform float u_featheringSize;\nuniform float u_introFade;\n#include \x3craster/flow/vv.glsl\x3e\n#include \x3craster/flow/getFadeOpacity.glsl\x3e\nvoid main(void) {\nvec2 position0 \x3d a_xyts0.xy;\nfloat t0 \x3d a_xyts0.z;\nfloat speed0 \x3d a_xyts0.w;\nvec2 position1 \x3d a_xyts1.xy;\nfloat t1 \x3d a_xyts1.z;\nfloat speed1 \x3d a_xyts1.w;\nfloat type \x3d a_typeIdDurationSeed.x;\nfloat id \x3d a_typeIdDurationSeed.y;\nfloat duration \x3d a_typeIdDurationSeed.z;\nfloat seed \x3d a_typeIdDurationSeed.w;\nvec2 e0 \x3d a_extrudeInfo.xy;\nvec2 e1 \x3d a_extrudeInfo.zw;\nfloat animationPeriod \x3d duration + u_trailLength;\nfloat scaledTime \x3d u_time * u_flowSpeed;\nfloat randomizedTime \x3d scaledTime + seed * animationPeriod;\nfloat t \x3d mod(randomizedTime, animationPeriod);\nfloat fUnclamped \x3d (t - t0) / (t1 - t0);\nfloat f \x3d clamp(fUnclamped, 0.0, 1.0);\nfloat clampedTime \x3d mix(t0, t1, f);\nfloat speed \x3d mix(speed0, speed1, f);\nvec2 extrude;\nvec2 position;\nfloat fadeOpacity;\nfloat introOpacity;\nif (type \x3d\x3d 2.0) {\nif (fUnclamped \x3c 0.0 || (fUnclamped \x3e 1.0 \x26\x26 t1 !\x3d duration)) {\ngl_Position \x3d vec4(0.0, 0.0, -2.0, 1.0);\nreturn;\n}\nvec2 ortho \x3d mix(e0, e1, f);\nvec2 parallel;\nparallel \x3d normalize(position1 - position0) * 0.5;\nif (id \x3d\x3d 1.0) {\nextrude \x3d ortho;\nv_texcoord \x3d vec2(0.5, 0.0);\n} else if (id \x3d\x3d 2.0) {\nextrude \x3d -ortho;\nv_texcoord \x3d vec2(0.5, 1.0);\n} else if (id \x3d\x3d 3.0) {\nextrude \x3d ortho + parallel;\nv_texcoord \x3d vec2(1.0, 0.0);\n} else if (id \x3d\x3d 4.0) {\nextrude \x3d -ortho + parallel;\nv_texcoord \x3d vec2(1.0, 1.0);\n}\nfadeOpacity \x3d getFadeOpacity((t - clampedTime) / u_trailLength);\nintroOpacity \x3d 1.0 - exp(-clampedTime);\nv_size \x3d getSize(speed);\nv_color \x3d getColor(speed);\nv_color.a *\x3d getOpacity(speed);\nposition \x3d mix(position0, position1, f);\n} else {\nif (fUnclamped \x3c 0.0) {\ngl_Position \x3d vec4(0.0, 0.0, -2.0, 1.0);\nreturn;\n}\nif (id \x3d\x3d 1.0) {\nextrude \x3d e0;\nv_texcoord \x3d vec2(0.5, 0.0);\nfadeOpacity \x3d getFadeOpacity((t - t0) / u_trailLength);\nintroOpacity \x3d 1.0 - exp(-t0);\nv_size \x3d getSize(speed0);\nv_color \x3d getColor(speed0);\nv_color.a *\x3d getOpacity(speed0);\nposition \x3d position0;\n} else if (id \x3d\x3d 2.0) {\nextrude \x3d -e0;\nv_texcoord \x3d vec2(0.5, 1.0);\nfadeOpacity \x3d getFadeOpacity((t - t0) / u_trailLength);\nintroOpacity \x3d 1.0 - exp(-t0);\nv_size \x3d getSize(speed0);\nv_color \x3d getColor(speed0);\nv_color.a *\x3d getOpacity(speed0);\nposition \x3d position0;\n} else if (id \x3d\x3d 3.0) {\nextrude \x3d mix(e0, e1, f);\nv_texcoord \x3d vec2(0.5, 0.0);\nfadeOpacity \x3d getFadeOpacity((t - clampedTime) / u_trailLength);\nintroOpacity \x3d 1.0 - exp(-clampedTime);\nv_size \x3d getSize(speed);\nv_color \x3d getColor(speed);\nv_color.a *\x3d getOpacity(speed);\nposition \x3d mix(position0, position1, f);\n} else if (id \x3d\x3d 4.0) {\nextrude \x3d -mix(e0, e1, f);\nv_texcoord \x3d vec2(0.5, 1.0);\nfadeOpacity \x3d getFadeOpacity((t - clampedTime) / u_trailLength);\nintroOpacity \x3d 1.0 - exp(-clampedTime);\nv_size \x3d getSize(speed);\nv_color \x3d getColor(speed);\nv_color.a *\x3d getOpacity(speed);\nposition \x3d mix(position0, position1, f);\n}\n}\nvec2 xy \x3d (u_dvsMat3 * vec3(position, 1.0) + u_displayViewMat3 * vec3(extrude * v_size, 0.0)).xy;\ngl_Position \x3d vec4(xy, 0.0, 1.0);\nv_color.a *\x3d fadeOpacity;\nv_color.a *\x3d mix(1.0, introOpacity, u_introFade);\nv_color.rgb *\x3d v_color.a;\n}"},
streamlines:{"streamlines.frag":"precision highp float;\nvarying float v_side;\nvarying float v_time;\nvarying float v_totalTime;\nvarying float v_timeSeed;\nvarying vec4 v_color;\nvarying float v_size;\nuniform float u_time;\nuniform float u_trailLength;\nuniform float u_flowSpeed;\nuniform float u_featheringSize;\nuniform float u_introFade;\n#include \x3craster/flow/getFragmentColor.glsl\x3e\n#include \x3craster/flow/getFadeOpacity.glsl\x3e\nvoid main(void) {\nfloat t \x3d mod(v_timeSeed * (v_totalTime + u_trailLength) + u_time * u_flowSpeed, v_totalTime + u_trailLength) - v_time;\nvec4 color \x3d v_color * step(0.0, t) * getFadeOpacity(t / u_trailLength);\ncolor *\x3d mix(1.0, 1.0 - exp(-v_time), u_introFade);\ngl_FragColor \x3d getFragmentColor(color, length((v_side + 1.0) / 2.0 - 0.5), v_size, u_featheringSize);\n}",
"streamlines.vert":"attribute vec3 a_positionAndSide;\nattribute vec3 a_timeInfo;\nattribute vec2 a_extrude;\nattribute float a_speed;\nuniform mat3 u_dvsMat3;\nuniform mat3 u_displayViewMat3;\nvarying float v_time;\nvarying float v_totalTime;\nvarying float v_timeSeed;\nvarying vec4 v_color;\nvarying float v_side;\nvarying float v_size;\nuniform float u_featheringSize;\n#include \x3craster/flow/vv.glsl\x3e\nvoid main(void) {\nvec4 lineColor \x3d getColor(a_speed);\nfloat lineOpacity \x3d getOpacity(a_speed);\nfloat lineSize \x3d getSize(a_speed);\nvec2 position \x3d a_positionAndSide.xy;\nv_side \x3d a_positionAndSide.z;\nvec2 xy \x3d (u_dvsMat3 * vec3(position, 1.0) + u_displayViewMat3 * vec3(a_extrude * lineSize, 0.0)).xy;\ngl_Position \x3d vec4(xy, 0.0, 1.0);\nv_time \x3d a_timeInfo.x;\nv_totalTime \x3d a_timeInfo.y;\nv_timeSeed \x3d a_timeInfo.z;\nv_color \x3d lineColor;\nv_color.a *\x3d lineOpacity;\nv_color.rgb *\x3d v_color.a;\nv_size \x3d lineSize;\n}"},
"vv.glsl":"#define MAX_STOPS 8\n#ifdef VV_COLOR\nuniform float u_color_stops[MAX_STOPS];\nuniform vec4 u_color_values[MAX_STOPS];\nuniform int u_color_count;\n#else\nuniform vec4 u_color;\n#endif\n#ifdef VV_OPACITY\nuniform float u_opacity_stops[MAX_STOPS];\nuniform float u_opacity_values[MAX_STOPS];\nuniform int u_opacity_count;\n#else\nuniform float u_opacity;\n#endif\n#ifdef VV_SIZE\nuniform float u_size_stops[MAX_STOPS];\nuniform float u_size_values[MAX_STOPS];\nuniform int u_size_count;\n#else\nuniform float u_size;\n#endif\nuniform float u_featheringOffset;\nvec4 getColor(float x) {\n#ifdef VV_COLOR\nvec4 color \x3d u_color_values[0];\n{\nfor (int i \x3d 1; i \x3c MAX_STOPS; i++) {\nif (i \x3e\x3d u_color_count) {\nbreak;\n}\nfloat x1 \x3d u_color_stops[i - 1];\nif (x \x3c x1) {\nbreak;\n}\nfloat x2 \x3d u_color_stops[i];\nvec4 y2 \x3d u_color_values[i];\nif (x \x3c x2) {\nvec4 y1 \x3d u_color_values[i - 1];\ncolor \x3d y1 + (y2 - y1) * (x - x1) / (x2 - x1);\n} else {\ncolor \x3d y2;\n}\n}\n}\n#else\nvec4 color \x3d u_color;\n#endif\nreturn color;\n}\nfloat getOpacity(float x) {\n#ifdef VV_OPACITY\nfloat opacity \x3d u_opacity_values[0];\n{\nfor (int i \x3d 1; i \x3c MAX_STOPS; i++) {\nif (i \x3e\x3d u_opacity_count) {\nbreak;\n}\nfloat x1 \x3d u_opacity_stops[i - 1];\nif (x \x3c x1) {\nbreak;\n}\nfloat x2 \x3d u_opacity_stops[i];\nfloat y2 \x3d u_opacity_values[i];\nif (x \x3c x2) {\nfloat y1 \x3d u_opacity_values[i - 1];\nopacity \x3d y1 + (y2 - y1) * (x - x1) / (x2 - x1);\n} else {\nopacity \x3d y2;\n}\n}\n}\n#else\nfloat opacity \x3d u_opacity;\n#endif\nreturn opacity;\n}\nfloat getSize(float x) {\n#ifdef VV_SIZE\nfloat size \x3d u_size_values[0];\n{\nfor (int i \x3d 1; i \x3c MAX_STOPS; i++) {\nif (i \x3e\x3d u_size_count) {\nbreak;\n}\nfloat x1 \x3d u_size_stops[i - 1];\nif (x \x3c x1) {\nbreak;\n}\nfloat x2 \x3d u_size_stops[i];\nfloat y2 \x3d u_size_values[i];\nif (x \x3c x2) {\nfloat y1 \x3d u_size_values[i - 1];\nsize \x3d y1 + (y2 - y1) * (x - x1) / (x2 - x1);\n} else {\nsize \x3d y2;\n}\n}\n}\n#else\nfloat size \x3d u_size;\n#endif\nreturn size + 2.0 * u_featheringSize * u_featheringOffset;\n}"},
hillshade:{"hillshade.frag":"precision mediump float;\nvarying highp vec2 v_texcoord;\n#include \x3craster/common/common.glsl\x3e\nuniform int u_hillshadeType;\nuniform float u_sinZcosAs[6];\nuniform float u_sinZsinAs[6];\nuniform float u_cosZs[6];\nuniform float u_weights[6];\nuniform vec2 u_factor;\nuniform float u_minValue;\nuniform float u_maxValue;\nuniform float u_scaling;\n#include \x3craster/lut/colorize.glsl\x3e\n#include \x3craster/common/getSurfaceValues.glsl\x3e\nvec3 rgb2hsv(vec3 c) {\nvec4 K \x3d vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);\nvec4 p \x3d c.g \x3c c.b ? vec4(c.bg, K.wz) : vec4(c.gb, K.xy);\nvec4 q \x3d c.r \x3c p.x ? vec4(p.xyw, c.r) : vec4(c.r, p.yzx);\nfloat d \x3d q.x - min(q.w, q.y);\nfloat e \x3d 1.0e-10;\nreturn vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), min(d / (q.x + e), 1.0), q.x);\n}\nvec3 hsv2rgb(vec3 c) {\nvec4 K \x3d vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\nvec3 p \x3d abs(fract(c.xxx + K.xyz) * 6.0 - K.www);\nreturn c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);\n}\nvec4 overlay(float val, float minValue, float maxValue, float hillshade) {\nval \x3d clamp((val - minValue) / (maxValue - minValue), 0.0, 1.0);\nvec4 rgb \x3d colorize(vec4(val, val, val, 1.0), 255.0);\nvec3 hsv \x3d rgb2hsv(rgb.xyz);\nhsv.z \x3d hillshade;\nreturn vec4(hsv2rgb(hsv) * u_scaling, 1.0) * rgb.a;\n}\nvoid main() {\nvec2 pixelLocation \x3d getPixelLocation(v_texcoord);\nif (isOutside(pixelLocation)) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn;\n}\nvec4 currentPixel \x3d getPixel(pixelLocation);\nif (currentPixel.a \x3d\x3d 0.0) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn;\n}\nfloat pv[10];\ngetSurfaceValues(u_image, pixelLocation, u_srcImageSize, pv);\nfloat alpha \x3d pv[9];\nfloat dzx \x3d (pv[2] + 2.0 * pv[5] + pv[8] - pv[0] - 2.0 * pv[3] - pv[6]) * u_factor.s;\nfloat dzy \x3d (pv[6] + 2.0 * pv[7] + pv[8] - pv[0] - 2.0 * pv[1] - pv[2]) * u_factor.t;\nfloat dzd \x3d sqrt(1.0 + dzx * dzx + dzy * dzy);\nfloat hillshade \x3d 0.0;\nif (u_hillshadeType \x3d\x3d 0){\nfloat cosDelta \x3d u_sinZsinAs[0] * dzy - u_sinZcosAs[0] * dzx;\nfloat z \x3d (u_cosZs[0] + cosDelta) / dzd;\nif (z \x3c 0.0)  z \x3d 0.0;\nhillshade \x3d z;\n} else {\nfor (int k \x3d 0; k \x3c 6; k++) {\nfloat cosDelta \x3d u_sinZsinAs[k] * dzy - u_sinZcosAs[k] * dzx;\nfloat z \x3d (u_cosZs[k] + cosDelta) / dzd;\nif (z \x3c 0.0) z \x3d 0.0;\nhillshade \x3d hillshade + z * u_weights[k];\nif (k \x3d\x3d 5) break;\n}\n}\n#ifdef APPLY_COLORMAP\nvec4 result \x3d overlay(pv[4], u_minValue, u_maxValue, hillshade) * alpha * u_opacity;\n#else\nhillshade *\x3d u_scaling;\nvec4 result \x3d vec4(hillshade, hillshade, hillshade, 1.0) * alpha * u_opacity;\n#endif\n#ifdef ROUND_OUTPUT\nresult \x3d vec4(floor(result.xyz + 0.5), result.a);\n#endif\ngl_FragColor \x3d result;\n}"},
lut:{"colorize.glsl":"uniform sampler2D u_colormap;\nuniform float u_colormapOffset;\nuniform float u_colormapMaxIndex;\nvec4 colorize(vec4 currentPixel, float scaleFactor) {\nfloat clrIndex \x3d clamp(currentPixel.r * scaleFactor - u_colormapOffset, 0.0, u_colormapMaxIndex);\nvec2 clrPosition \x3d vec2((clrIndex + 0.5) / (u_colormapMaxIndex + 1.0), 0.0);\nvec4 color \x3d texture2D(u_colormap, clrPosition);\nvec4 result \x3d vec4(color.rgb, color.a * currentPixel.a);\nreturn result;\n}\nvec4 colorizeNoClamp(vec4 currentPixel, float scaleFactor) {\nfloat value \x3d currentPixel.r * scaleFactor - u_colormapOffset;\nvec4 result \x3d colorize(currentPixel, scaleFactor);\nreturn result * step(0.0, value) * step(value, u_colormapMaxIndex);\n}",
"lut.frag":"precision mediump float;\nvarying highp vec2 v_texcoord;\n#include \x3craster/common/common.glsl\x3e\n#include \x3craster/lut/colorize.glsl\x3e\nvoid main() {\nvec2 pixelLocation \x3d getPixelLocation(v_texcoord);\nif (isOutside(pixelLocation)) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn;\n}\nvec4 currentPixel \x3d getPixel(pixelLocation);\nvec4 result \x3d colorizeNoClamp(currentPixel, 1.0);\ngl_FragColor \x3d vec4(result.xyz, 1.0) * result.a * u_opacity;\n}"},magdir:{"magdir.frag":"precision mediump float;\nvarying vec4 v_color;\nuniform lowp float u_opacity;\nvoid main() {\ngl_FragColor \x3d v_color * u_opacity;\n}",
"magdir.vert":"precision mediump float;\nattribute vec2 a_pos;\nattribute vec2 a_offset;\nattribute vec2 a_vv;\nuniform highp mat3 u_dvsMat3;\nuniform highp vec2 u_coordScale;\nuniform vec2 u_symbolSize;\nuniform vec2 u_symbolPercentRange;\nuniform vec2 u_dataRange;\nuniform float u_rotation;\nuniform vec4 u_colors[12];\nvarying vec4 v_color;\nvoid main()\n{\nfloat angle \x3d a_offset.y + u_rotation;\n#ifndef ROTATION_GEOGRAPHIC\nangle \x3d 3.14159265359 * 2.0 - angle - 3.14159265359 / 2.0;\n#endif\nvec2 offset \x3d vec2(cos(angle), sin(angle)) * a_offset.x;\n#ifdef DATA_RANGE\nfloat valuePercentage \x3d clamp((a_vv.y - u_dataRange.x) / (u_dataRange.y - u_dataRange.x), 0.0, 1.0);\nfloat sizeRatio \x3d u_symbolPercentRange.x + valuePercentage * (u_symbolPercentRange.y - u_symbolPercentRange.x);\nfloat sizePercentage \x3d clamp(sizeRatio, u_symbolPercentRange.x, u_symbolPercentRange.y);\n#else\nfloat sizePercentage \x3d (u_symbolPercentRange.x + u_symbolPercentRange.y) / 2.0;\n#endif\nvec2 pos \x3d a_pos + offset * sizePercentage * u_symbolSize;\nv_color \x3d u_colors[int(a_vv.x)];\ngl_Position \x3d vec4(u_dvsMat3 * vec3(pos * u_coordScale, 1.0), 1.0);\n}"},
reproject:{"reproject.frag":"precision mediump float;\nvarying vec2 v_texcoord;\n#include \x3craster/common/common.glsl\x3e\nvoid main() {\nvec2 pixelLocation \x3d getPixelLocation(v_texcoord);\nif (isOutside(pixelLocation)) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 1.0);\nreturn;\n}\nvec4 currentPixel \x3d getPixel(pixelLocation);\ngl_FragColor \x3d vec4(currentPixel.rgb, 1.0) * currentPixel.a * u_opacity;\n}","reproject.vert":"precision mediump float;\nattribute vec2 a_position;\nvarying highp vec2 v_texcoord;\nvoid main()\n{\nv_texcoord \x3d a_position;\ngl_Position \x3d vec4(2.0 * (a_position - 0.5), 0.0, 1.0);\n}"},
rfx:{aspect:{"aspect.frag":"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texcoord;\nuniform vec2 u_cellSize;\nuniform vec2 u_srcImageSize;\n#include \x3craster/common/getSurfaceValues.glsl\x3e\nconst float pi \x3d 3.14159265359;\nvoid main() {\nfloat pv[10];\ngetSurfaceValues(u_image, v_texcoord, u_srcImageSize, pv);\nfloat alpha \x3d pv[9];\nfloat dzx \x3d (pv[2] + 2.0 * pv[5] + pv[8] - pv[0] - 2.0 * pv[3] - pv[6]) / (8.0 * u_cellSize[0]);\nfloat dzy \x3d -(pv[6] + 2.0 * pv[7] + pv[8] - pv[0] - 2.0 * pv[1] - pv[2]) / (8.0 * u_cellSize[1]);\nalpha *\x3d sign(abs(dzx) + abs(dzy));\nfloat aspect_rad \x3d (dzx \x3d\x3d 0.0) ? (step(0.0, dzy) * 0.5 * pi + step(dzy, 0.0) * 1.5 * pi) : mod((2.5 * pi + atan(dzy, -dzx)), 2.0 * pi);\nfloat aspect \x3d aspect_rad * 180.0 / pi;\ngl_FragColor \x3d vec4(aspect, aspect, aspect, 1.0) * alpha;\n}"},
bandarithmetic:{"bandarithmetic.frag":"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texcoord;\nuniform mediump mat3 u_bandIndexMat3;\nuniform float u_adjustments[3];\n#include \x3craster/common/inverse.glsl\x3e\nvoid main() {\nvec4 pv \x3d texture2D(u_image, v_texcoord);\nvec3 pv2 \x3d u_bandIndexMat3 * pv.rgb;\nfloat nir \x3d pv2.r;\nfloat red \x3d pv2.g;\nfloat index;\n#ifdef NDXI\nindex \x3d (nir - red) * invertValue(nir + red);\n#elif defined(SR)\nindex \x3d nir * invertValue(red);\n#elif defined(CI)\nindex \x3d nir * invertValue(red) - 1.0;\n#elif defined(SAVI)\nindex \x3d (nir - red) * invertValue(nir + red + u_adjustments[0]) * (1.0 + u_adjustments[0]);\n#elif defined(TSAVI)\nfloat s \x3d u_adjustments[0];\nfloat a \x3d u_adjustments[1];\nfloat x \x3d u_adjustments[2];\nfloat y \x3d -a * s + x * (1.0 + s * s);\nindex \x3d (s * (nir - s * red - a)) * invertValue(a * nir + red + y);\n#elif defined(MSAVI)\nfloat nir2 \x3d 2.0 * nir + 1.0;\nindex \x3d 0.5 * (nir2 - sqrt(nir2 * nir2 - 8.0 * (nir - red)));\n#elif defined(GEMI)\nfloat eta \x3d (2.0 * (nir * nir - red * red) + 1.5 * nir + 0.5 * red) * invertValue(nir + red + 0.5);\nindex \x3d eta * (1.0 - 0.25 * eta) - (red - 0.125) * invertValue(1.0 - red);\n#elif defined(PVI)\nfloat a \x3d u_adjustments[0];\nfloat b \x3d u_adjustments[1];\nfloat y \x3d sqrt(1.0 + a * a);\nindex \x3d (nir - a * red - b) * invertValue(y);\n#elif defined(VARI)\nindex \x3d (pv2.g - pv2.r) * invertValue(pv2.g + pv2.r - pv2.b);\n#elif defined(MTVI)\nfloat green \x3d pv2.b;\nfloat v \x3d sqrt(pow((2.0 * nir + 1.0), 2.0) - (6.0 * nir - 5.0 * sqrt(red)) - 0.5);\nindex \x3d 1.5 * (1.2 * (nir - green) - 2.5 * (red - green)) * invertValue(v);\n#elif defined(RTVICORE)\nfloat green \x3d pv2.b;\nindex \x3d 100.0 * (nir - red) - 10.0 * (nir - green);\n#elif defined(EVI)\nfloat blue \x3d pv2.b;\nfloat denom \x3d nir + 6.0 * red - 7.5 * blue + 1.0;\nindex \x3d  (2.5 * (nir - red)) * invertValue(denom);\n#elif defined(WNDWI)\nfloat g \x3d pv2.r;\nfloat n \x3d pv2.g;\nfloat s \x3d pv2.b;\nfloat a \x3d u_adjustments[0];\nfloat denom \x3d g + a * n + (1.0 - a) * s;\nindex \x3d (g - a * n - (1.0 - a) * s) * invertValue(denom);\n#elif defined(BAI)\nindex \x3d invertValue(pow((0.1 - red), 2.0) + pow((0.06 - nir), 2.0));\n#else\ngl_FragColor \x3d pv;\nreturn;\n#endif\n#ifdef ROUND_OUTPUT\nindex \x3d floor(index + 0.5);\n#endif\ngl_FragColor \x3d vec4(index, index, index, pv.a);\n}"},
colormap2rgb:{"colormap2rgb.frag":"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texcoord;\n#include \x3craster/lut/colorize.glsl\x3e\nvoid main() {\nvec4 pv \x3d texture2D(u_image, v_texcoord);\nvec4 result \x3d colorizeNoClamp(vec4(pv.r, pv.r, pv.r, 1.0), 1.0);\ngl_FragColor \x3d vec4(result.xyz * 255.0, 1.0) * result.a * pv.a;\n}"},compositeband:{"compositeband.frag":"precision mediump float;\nuniform sampler2D u_image;\nuniform sampler2D u_image1;\nuniform sampler2D u_image2;\n#ifdef ONE_CONSTANT\nuniform float u_image1Const;\n#ifdef TWO_CONSTANT\nuniform float u_image2Const;\n#endif\nuniform mat3 u_imageSwap;\n#endif\nvarying vec2 v_texcoord;\nvoid main() {\nvec4 pv0 \x3d texture2D(u_image, v_texcoord);\nfloat a \x3d pv0.r;\nfloat alpha \x3d pv0.a;\n#ifdef TWO_CONSTANT\nfloat b \x3d u_image1Const;\nfloat c \x3d u_image2Const;\nvec3 abc \x3d u_imageSwap * vec3(a, b, c);\na \x3d abc.s;\nb \x3d abc.t;\nc \x3d abc.p;\n#elif defined(ONE_CONSTANT)\nvec4 pv1 \x3d texture2D(u_image1, v_texcoord);\nfloat b \x3d pv1.r;\nfloat c \x3d u_image1Const;\nvec3 abc \x3d u_imageSwap * vec3(a, b, c);\na \x3d abc.s;\nb \x3d abc.t;\nc \x3d abc.p;\nalpha *\x3d pv1.a;\n#else\nvec4 pv1 \x3d texture2D(u_image1, v_texcoord);\nvec4 pv2 \x3d texture2D(u_image2, v_texcoord);\nfloat b \x3d pv1.r;\nfloat c \x3d pv2.r;\nalpha \x3d alpha * pv1.a * pv2.a;\n#endif\ngl_FragColor \x3d vec4(a, b, c, alpha);\n}"},
computechange:{"computechange.frag":"precision mediump float;\nuniform sampler2D u_image;\nuniform sampler2D u_image1;\n#ifdef ONE_CONSTANT\nuniform float u_image1Const;\nuniform mat3 u_imageSwap;\n#endif\nvarying vec2 v_texcoord;\nuniform vec2 u_domainRange;\n#include \x3craster/common/inverse.glsl\x3e\nvoid main() {\nvec4 pv0 \x3d texture2D(u_image, v_texcoord);\nfloat a \x3d pv0.r;\n#ifdef ONE_CONSTANT\nfloat b \x3d u_image1Const;\nvec3 abc \x3d u_imageSwap * vec3(a, b, 0);\na \x3d abc.s;\nb \x3d abc.t;\n#else\nvec4 pv1 \x3d texture2D(u_image1, v_texcoord);\nfloat b \x3d pv1.r;\n#endif\nfloat result \x3d a;\nfloat alpha \x3d pv0.a;\n#ifdef DIFFERENCE\nresult \x3d a - b;\n#elif defined(RELATIVE)\nresult \x3d (a - b) * invertValue(max(abs(a), abs(b)));\n#endif\nbool isInvalid \x3d result \x3c u_domainRange.s || result \x3e u_domainRange.t;\nresult \x3d isInvalid ? 0.0 : result;\nalpha *\x3d float(!isInvalid);\n#ifdef ROUND_OUTPUT\nresult \x3d floor(result + 0.5);\n#endif\ngl_FragColor \x3d vec4(result, result, result, alpha);\n}"},
contrast:{"contrast.frag":"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texcoord;\n#include \x3craster/common/contrastBrightness.glsl\x3e\nvoid main() {\nvec4 pv \x3d texture2D(u_image, v_texcoord);\nvec4 result \x3d adjustContrastBrightness(pv, false);\ngl_FragColor \x3d vec4(floor(result.rgb * 255.0 + 0.5), result.a);\n}"},convolution:{"convolution.frag":"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texcoord;\nuniform vec2 u_srcImageSize;\n#define KERNEL_SIZE_ROWS ROWS\n#define KERNEL_SIZE_COLS COLS\nuniform vec2 u_clampRange;\nuniform float u_kernel[25];\n#include \x3craster/common/mirror.glsl\x3e\nvoid main() {\nvec3 rgb \x3d vec3(0.0, 0.0, 0.0);\nvec2 resolution \x3d 1.0 / u_srcImageSize;\nfloat rowOffset \x3d -float(floor(float(KERNEL_SIZE_ROWS) / 2.0));\nfloat colOffset \x3d -float(floor(float(KERNEL_SIZE_COLS) / 2.0));\nfloat alpha \x3d 1.0;\nfor (int row \x3d 0; row \x3c KERNEL_SIZE_ROWS; row++) {\nfloat pos_row \x3d rowOffset + float(row);\nfor (int col \x3d 0; col \x3c KERNEL_SIZE_COLS; col++) {\nvec2 pos \x3d v_texcoord + vec2(colOffset + float(col), pos_row) * resolution;\nvec4 pv \x3d texture2D(u_image, mirror(pos));\nrgb +\x3d pv.rgb * u_kernel[row * KERNEL_SIZE_COLS + col];\nalpha *\x3d pv.a;\n}\n}\nrgb \x3d clamp(rgb, u_clampRange.s, u_clampRange.t);\ngl_FragColor \x3d vec4(rgb * alpha, alpha);\n}"},
curvature:{"curvature.frag":"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texcoord;\nuniform float u_zlFactor;\nuniform vec2 u_srcImageSize;\n#include \x3craster/common/getSurfaceValues.glsl\x3e\nvoid main() {\nfloat pv[10];\ngetSurfaceValues(u_image, v_texcoord, u_srcImageSize, pv);\nfloat alpha \x3d pv[9];\nfloat d \x3d ((pv[3] + pv[5]) * 0.5 - pv[4]);\nfloat e \x3d ((pv[1] + pv[7]) * 0.5 - pv[4]);\nfloat curvature \x3d 0.0;\n#ifdef STANDARD\ncurvature \x3d -u_zlFactor * (d + e);\ngl_FragColor \x3d vec4(curvature, curvature, curvature, alpha);\n#else\nfloat f \x3d (-pv[0] + pv[2] + pv[6] - pv[8]) / 4.0;\nfloat g \x3d (-pv[3] + pv[5]) / 2.0;\nfloat h \x3d (pv[1] - pv[7]) / 2.0;\nfloat g2 \x3d g * g;\nfloat h2 \x3d h * h;\n#ifdef PROFILE\ncurvature \x3d (u_zlFactor * (d * g2 + e * h2 + f * g * h)) / (g2 + h2);\n#else\ncurvature \x3d (-u_zlFactor * (d * h2 + e * g2 - f * g * h)) / (g2 + h2);\n#endif\n#endif\ngl_FragColor \x3d vec4(curvature, curvature, curvature, alpha);\n}"},
extractband:{"extractband.frag":"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texcoord;\nuniform mediump mat3 u_bandIndexMat3;\nvoid main() {\nvec4 pv \x3d texture2D(u_image, v_texcoord);\nvec3 pv2 \x3d u_bandIndexMat3 * pv.rgb;\ngl_FragColor \x3d vec4(pv2, pv.a);\n}"},focalstatistics:{"focalstatistics.frag":"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texcoord;\nuniform vec2 u_srcImageSize;\n#define KERNEL_SIZE_ROWS ROWS\n#define KERNEL_SIZE_COLS COLS\nuniform vec2 u_clampRange;\n#include \x3craster/common/mirror.glsl\x3e\n#include \x3craster/common/inverse.glsl\x3e\nvoid main() {\nvec2 resolution \x3d 1.0 / u_srcImageSize;\nfloat rowOffset \x3d -float(floor(float(KERNEL_SIZE_ROWS) / 2.0));\nfloat colOffset \x3d -float(floor(float(KERNEL_SIZE_COLS) / 2.0));\nfloat count \x3d 0.0;\n#ifdef STDDEV\nvec3 sum \x3d vec3(0.0, 0.0, 0.0);\nvec3 sum2 \x3d vec3(0.0, 0.0, 0.0);\n#endif\nvec4 currentPixel \x3d texture2D(u_image, v_texcoord);\nvec3 rgb \x3d currentPixel.rgb;\nfor (int row \x3d 0; row \x3c KERNEL_SIZE_ROWS; row++) {\nfloat pos_row \x3d rowOffset + float(row);\nfor (int col \x3d 0; col \x3c KERNEL_SIZE_COLS; col++) {\nvec2 pos \x3d v_texcoord + vec2(colOffset + float(col), pos_row) * resolution;\nvec4 pv \x3d texture2D(u_image, mirror(pos));\ncount +\x3d pv.a;\n#ifdef MIN\nrgb \x3d min(rgb, pv.rgb);\n#elif defined(MAX)\nrgb \x3d max(rgb, pv.rgb);\n#elif defined(MEAN)\nrgb +\x3d pv.rgb;\n#elif defined(STDDEV)\nsum +\x3d pv.rgb;\nsum2 +\x3d (pv.rgb * pv.rgb);\n#endif\n}\n}\n#ifdef MEAN\nrgb *\x3d invertValue(count);\n#elif defined(STDDEV)\nrgb \x3d sqrt((sum2 - sum * sum * invertValue(count)) * invertValue(count));\n#endif\nfloat alpha \x3d step(0.9999, count);\nrgb \x3d clamp(rgb, u_clampRange.s, u_clampRange.t);\n#ifdef FILL\nrgb \x3d (1.0 - currentPixel.a) * rgb + currentPixel.a * currentPixel.rgb;\n#endif\ngl_FragColor \x3d vec4(rgb * alpha, alpha);\n}"},
grayscale:{"grayscale.frag":"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texcoord;\nuniform vec3 u_weights;\nvoid main() {\nvec4 pv \x3d texture2D(u_image, v_texcoord);\nfloat value \x3d dot(u_weights, pv.rgb);\ngl_FragColor \x3d vec4(value, value, value, pv.a);\n}"},local:{"local.frag":"precision highp float;\nuniform sampler2D u_image;\nuniform sampler2D u_image1;\n#ifdef ONE_CONSTANT\nuniform float u_image1Const;\n#ifdef TWO_CONSTANT\nuniform float u_image2Const;\n#endif\nuniform mat3 u_imageSwap;\n#endif\nvarying vec2 v_texcoord;\nuniform vec2 u_domainRange;\n#include \x3craster/common/inverse.glsl\x3e\nvoid main() {\nvec4 pv0 \x3d texture2D(u_image, v_texcoord);\nfloat a \x3d pv0.r;\n#ifdef TWO_IMAGES\n#ifdef ONE_CONSTANT\nfloat b \x3d u_image1Const;\nvec3 abc \x3d u_imageSwap * vec3(a, b, 0);\na \x3d abc.s;\nb \x3d abc.t;\n#else\nvec4 pv1 \x3d texture2D(u_image1, v_texcoord);\nfloat b \x3d pv1.r;\n#endif\n#elif defined(CONDITIONAL)\n#ifdef TWO_CONSTANT\nfloat b \x3d u_image1Const;\nfloat c \x3d u_image2Const;\nvec3 abc \x3d u_imageSwap * vec3(a, b, c);\na \x3d abc.s;\nb \x3d abc.t;\nc \x3d abc.p;\n#elif defined(ONE_CONSTANT)\nvec4 pv1 \x3d texture2D(u_image1, v_texcoord);\nfloat b \x3d pv1.r;\nfloat c \x3d u_image1Const;\nvec3 abc \x3d u_imageSwap * vec3(a, b, c);\na \x3d abc.s;\nb \x3d abc.t;\nc \x3d abc.p;\n#else\nvec4 pv1 \x3d texture2D(u_image1, v_texcoord);\nvec4 pv2 \x3d texture2D(u_image2, v_texcoord);\nfloat b \x3d pv1.r;\nfloat c \x3d pv2.r;\n#endif\n#endif\nfloat result \x3d a;\nfloat alpha \x3d pv0.a;\n#ifdef PLUS\nresult \x3d a + b;\n#elif defined(MINUS)\nresult \x3d a - b;\n#elif defined(TIMES)\nresult \x3d a * b;\n#elif defined(DIVIDE)\nresult \x3d a * invertValue(b);\nalpha *\x3d float(abs(sign(b)));\n#elif defined(FLOATDIVIDE)\nresult \x3d a * invertValue(b);\nalpha *\x3d float(abs(sign(b)));\n#elif defined(FLOORDIVIDE)\nresult \x3d floor(a * invertValue(b));\nalpha *\x3d float(abs(sign(b)));\n#elif defined(SQUARE)\nresult \x3d a * a;\n#elif defined(SQRT)\nresult \x3d sqrt(a);\n#elif defined(POWER)\nresult \x3d pow(a, b);\n#elif defined(LN)\nresult \x3d a \x3c\x3d 0.0 ? 0.0: log(a);\nalpha *\x3d float(a \x3e 0.0);\n#elif defined(LOG_1_0)\nresult \x3d a \x3c\x3d 0.0 ? 0.0: log2(a) * invertValue(log2(10.0));\nalpha *\x3d float(a \x3e 0.0);\n#elif defined(LOG_2)\nresult \x3d a \x3c\x3d 0.0 ? 0.0: log2(a);\nalpha *\x3d float(a \x3e 0.0);\n#elif defined(EXP)\nresult \x3d exp(a);\n#elif defined(EXP_1_0)\nresult \x3d pow(10.0, a);\n#elif defined(EXP_2)\nresult \x3d pow(2.0, a);\n#elif defined(ROUNDDOWN)\nresult \x3d floor(a);\n#elif defined(ROUNDUP)\nresult \x3d ceil(a);\n#elif defined(INT)\nresult \x3d float(sign(a)) * floor(abs(a));\n#elif defined(MOD)\nresult \x3d mod(a, b);\n#elif defined(NEGATE)\nresult \x3d -a;\n#elif defined(ABS)\nresult \x3d abs(a);\n#elif defined(ACOS)\nresult \x3d abs(a) \x3e 1.0 ? 0.0: acos(a);\nalpha *\x3d step(abs(a), 1.00001);\n#elif defined(ACOSH)\nresult \x3d acosh(a);\n#elif defined(ASIN)\nresult \x3d abs(a) \x3e 1.0 ? 0.0: asin(a);\nalpha *\x3d step(abs(a), 1.00001);\n#elif defined(ASINH)\nresult \x3d asinh(a);\n#elif defined(ATAN)\nresult \x3d atan(a);\n#elif defined(ATANH)\nresult \x3d abs(a) \x3e 1.0 ? 0.0: atanh(a);\nalpha *\x3d step(abs(a), 1.0);\n#elif defined(ATAN_2)\nresult \x3d atan(a, b);\n#elif defined(COS)\nresult \x3d cos(a);\n#elif defined(COSH)\nresult \x3d cosh(a);\n#elif defined(SIN)\nresult \x3d sin(a);\n#elif defined(SINH)\nresult \x3d sinh(a);\n#elif defined(TAN)\nresult \x3d tan(a);\n#elif defined(TANH)\nresult \x3d tanh(a);\n#elif defined(BITWISEAND)\nresult \x3d float(int(a) \x26 int(b));\n#elif defined(BITWISEOR)\nresult \x3d float(int(a) | int(b));\n#elif defined(BITWISELEFTSHIFT)\nresult \x3d float(int(a) \x3c\x3c int(b));\n#elif defined(BITWISERIGHTSHIFT)\nresult \x3d float(int(a) \x3e\x3e int(b));\n#elif defined(BITWISENOT)\nresult \x3d float(~(int(a)));\n#elif defined(BITWISEXOR)\nresult \x3d float(int(a) ^ int(b));\n#elif defined(BOOLEANAND)\nresult \x3d float((a !\x3d 0.0) \x26\x26 (b !\x3d 0.0));\n#elif defined(BOOLEANNOT)\nresult \x3d float(a \x3d\x3d 0.0);\n#elif defined(BOOLEANOR)\nresult \x3d float((a !\x3d 0.0) || (b !\x3d 0.0));\n#elif defined(BOOLEANXOR)\nresult \x3d float((a !\x3d 0.0) ^^ (b !\x3d 0.0));\n#elif defined(GREATERTHAN)\nresult \x3d float(a \x3e b);\n#elif defined(GREATERTHANEQUAL)\nresult \x3d float(a \x3e\x3d b);\n#elif defined(LESSTHAN)\nresult \x3d float(a \x3c b);\n#elif defined(LESSTHANEQUAL)\nresult \x3d float(a \x3c\x3d b);\n#elif defined(EQUALTO)\nresult \x3d float(a \x3d\x3d b);\n#elif defined(NOTEQUAL)\nresult \x3d float(a !\x3d b);\n#elif defined(ISNULL)\nresult \x3d float(alpha \x3d\x3d 0.0);\nalpha \x3d 1.0;\n#elif defined(SETNULL)\nfloat maskValue \x3d float(a \x3d\x3d 0.0);\nresult \x3d maskValue * b;\nalpha *\x3d maskValue;\n#elif defined(CONDITIONAL)\nfloat weight \x3d float(abs(sign(a)));\nresult \x3d weight * b + (1.0 - weight) * c;\n#endif\nfloat rangeFactor \x3d step(u_domainRange.s, result) * step(result, u_domainRange.t);\nresult *\x3d rangeFactor;\nalpha *\x3d rangeFactor;\n#ifdef ROUND_OUTPUT\nresult \x3d floor(result + 0.5);\n#endif\ngl_FragColor \x3d vec4(result, result, result, alpha);\n}"},
mask:{"mask.frag":"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texcoord;\n#define LEN_INCLUDED_RANGES 6\n#define LEN_NODATA_VALUES 6\nuniform highp float u_includedRanges[6];\nuniform highp float u_noDataValues[6];\nfloat maskFactor(float bandValue, float fromValue, float to) {\nfloat factor \x3d 1.0;\nfor (int i \x3d 0; i \x3c LEN_NODATA_VALUES; i++) {\nfactor *\x3d float(u_noDataValues[i] !\x3d bandValue);\n}\nfactor *\x3d step(fromValue, bandValue) * step(bandValue, to);\nreturn factor;\n}\nvoid main() {\nvec4 pv \x3d texture2D(u_image, v_texcoord);\nfloat redFactor \x3d maskFactor(pv.r, u_includedRanges[0], u_includedRanges[1]);\n#ifdef MULTI_BAND\nfloat greenFactor \x3d maskFactor(pv.g, u_includedRanges[2], u_includedRanges[3]);\nfloat blueFactor \x3d maskFactor(pv.b, u_includedRanges[4], u_includedRanges[5]);\nfloat maskFactor \x3d redFactor * greenFactor * blueFactor;\ngl_FragColor \x3d pv * maskFactor;\n#else\ngl_FragColor \x3d pv * redFactor;\n#endif\n}"},
ndvi:{"ndvi.frag":"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texcoord;\nuniform mediump mat3 u_bandIndexMat3;\n#include \x3craster/common/inverse.glsl\x3e\nvoid main() {\nvec4 pv \x3d texture2D(u_image, v_texcoord);\nvec3 pv2 \x3d u_bandIndexMat3 * pv.rgb;\nfloat nir \x3d pv2.r;\nfloat red \x3d pv2.g;\nfloat index \x3d (nir - red) * invertValue(nir + red);\n#ifdef SCALED\nindex \x3d floor((index + 1.0) * 100.0 + 0.5);\n#endif\ngl_FragColor \x3d vec4(index, index, index, pv.a);\n}"},
remap:{"remap.frag":"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texcoord;\n#define LEN_REMAP_RANGES 18\n#define LEN_NODATA_RANGES 12\nuniform highp float u_rangeMaps[18];\nuniform highp float u_noDataRanges[12];\nuniform highp float u_unmatchMask;\nuniform vec2 u_clampRange;\nvoid main() {\nvec4 pv \x3d texture2D(u_image, v_texcoord);\nfloat factor \x3d 1.0;\nfloat bandValue \x3d pv.r;\nfor (int i \x3d 0; i \x3c LEN_NODATA_RANGES; i+\x3d2) {\nfloat inside \x3d 1.0 - step(u_noDataRanges[i], bandValue) * step(bandValue, u_noDataRanges[i+1]);\nfactor *\x3d inside;\n}\nfloat mapValue \x3d 0.0;\nfloat includeMask \x3d 0.0;\nfor (int i \x3d 0; i \x3c LEN_REMAP_RANGES; i+\x3d3) {\nfloat stepMask \x3d step(u_rangeMaps[i], bandValue) * step(bandValue, u_rangeMaps[i+1]);\nincludeMask \x3d (1.0 - stepMask) * includeMask + stepMask;\nmapValue \x3d (1.0 - stepMask) * mapValue + stepMask * u_rangeMaps[i+2];\n}\nbandValue \x3d factor * (mapValue + (1.0 - includeMask) * u_unmatchMask * pv.r);\nfloat bandMask \x3d factor * max(u_unmatchMask, includeMask);\nbandValue \x3d clamp(bandValue, u_clampRange.s, u_clampRange.t);\ngl_FragColor \x3d vec4(bandValue, bandValue, bandValue, bandMask * pv.a);\n}"},
slope:{"slope.frag":"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texcoord;\nuniform vec2 u_cellSize;\nuniform float u_zFactor;\nuniform vec2 u_srcImageSize;\nuniform float u_pixelSizePower;\nuniform float u_pixelSizeFactor;\n#include \x3craster/common/getSurfaceValues.glsl\x3e\nvoid main() {\nfloat pv[10];\ngetSurfaceValues(u_image, v_texcoord, u_srcImageSize, pv);\nfloat alpha \x3d pv[9];\nfloat xf \x3d (u_zFactor + pow(u_cellSize[0], u_pixelSizePower) * u_pixelSizeFactor) / (8.0 * u_cellSize[0]);\nfloat yf \x3d (u_zFactor + pow(u_cellSize[1], u_pixelSizePower) * u_pixelSizeFactor) / (8.0 * u_cellSize[1]);\nfloat dzx \x3d (pv[2] + 2.0 * pv[5] + pv[8] - pv[0] - 2.0 * pv[3] - pv[6]) * xf;\nfloat dzy \x3d -(pv[6] + 2.0 * pv[7] + pv[8] - pv[0] - 2.0 * pv[1] - pv[2]) * yf;\nfloat rise2run \x3d sqrt(dzx * dzx + dzy * dzy);\n#ifdef PERCENT_RISE\nfloat result \x3d rise2run * 100.0;\n#else\nfloat result \x3d atan(rise2run) * 57.2957795;\n#endif\n#ifdef ROUND_OUTPUT\nresult \x3d floor(result + 0.5);\n#endif\ngl_FragColor \x3d vec4(result, result, result, alpha);\n}"},
stretch:{"stretch.frag":"precision mediump float;\nuniform sampler2D u_image;\nvarying highp vec2 v_texcoord;\nuniform float u_minCutOff[3];\nuniform float u_maxCutOff[3];\nuniform float u_minOutput;\nuniform float u_maxOutput;\nuniform float u_factor[3];\nuniform float u_gamma[3];\nuniform float u_gammaCorrection[3];\nfloat stretchOneValue(float val, float minCutOff, float maxCutOff, float minOutput, float maxOutput, float factor, float gamma, float gammaCorrection) {\nval \x3d clamp(val, minCutOff, maxCutOff);\nfloat stretchedVal;\n#ifdef USE_GAMMA\nfloat tempf \x3d 1.0;\nfloat outRange \x3d maxOutput - minOutput;\nfloat relativeVal \x3d (val - minCutOff) / (maxCutOff - minCutOff);\ntempf -\x3d step(1.0, gamma) * sign(gamma - 1.0) * pow(1.0 / outRange, relativeVal * gammaCorrection);\nstretchedVal \x3d tempf * outRange * pow(relativeVal, 1.0 / gamma) + minOutput;\nstretchedVal \x3d clamp(stretchedVal, minOutput, maxOutput);\n#else\nstretchedVal \x3d minOutput + (val - minCutOff) * factor;\n#endif\n#ifdef ROUND_OUTPUT\nstretchedVal \x3d floor(stretchedVal + 0.5);\n#endif\nreturn stretchedVal;\n}\nvoid main() {\nvec4 currentPixel \x3d texture2D(u_image, v_texcoord);\nfloat redVal \x3d stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_gamma[0], u_gammaCorrection[0]);\n#ifdef MULTI_BAND\nfloat greenVal \x3d stretchOneValue(currentPixel.g, u_minCutOff[1], u_maxCutOff[1], u_minOutput, u_maxOutput, u_factor[1], u_gamma[1], u_gammaCorrection[1]);\nfloat blueVal \x3d stretchOneValue(currentPixel.b, u_minCutOff[2], u_maxCutOff[2], u_minOutput, u_maxOutput, u_factor[2], u_gamma[2], u_gammaCorrection[2]);\ngl_FragColor \x3d vec4(redVal, greenVal, blueVal, currentPixel.a);\n#else\ngl_FragColor \x3d vec4(redVal, redVal, redVal, currentPixel.a);\n#endif\n}"},
vs:{"vs.vert":"precision mediump float;\nattribute vec2 a_pos;\nuniform highp mat3 u_dvsMat3;\nuniform highp vec2 u_coordScale;\nvarying highp vec2 v_texcoord;\nvoid main()\n{\nv_texcoord \x3d a_pos;\ngl_Position \x3d vec4(u_dvsMat3 * vec3(a_pos * u_coordScale, 1.0), 1.0);\n}"}},scalar:{"scalar.frag":"precision mediump float;\nuniform lowp float u_opacity;\nvarying vec2 v_pos;\nconst vec4 outlineColor \x3d vec4(0.2, 0.2, 0.2, 1.0);\nconst float outlineSize \x3d 0.02;\nconst float innerRadius \x3d 0.25;\nconst float outerRadius \x3d 0.42;\nconst float innerSquareLength \x3d 0.15;\nvoid main() {\nmediump float dist \x3d length(v_pos);\nmediump float fillalpha1 \x3d smoothstep(outerRadius, outerRadius + outlineSize, dist);\nfillalpha1 *\x3d (1.0-smoothstep(outerRadius + outlineSize, outerRadius + 0.1 + outlineSize, dist));\n#ifdef INNER_CIRCLE\nmediump float fillalpha2 \x3d smoothstep(innerRadius, innerRadius + outlineSize, dist);\nfillalpha2 *\x3d (1.0-smoothstep(innerRadius + outlineSize, innerRadius + 0.1 + outlineSize, dist));\n#else\nmediump float fillalpha2 \x3d (abs(v_pos.x) \x3c innerSquareLength ? 1.0 : 0.0) * (abs(v_pos.y) \x3c innerSquareLength ? 1.0 : 0.0);\n#endif\ngl_FragColor \x3d (fillalpha2 + fillalpha1) * outlineColor * u_opacity;\n}",
"scalar.vert":"precision mediump float;\nattribute vec2 a_pos;\nattribute vec2 a_offset;\nattribute vec2 a_vv;\nuniform highp mat3 u_dvsMat3;\nuniform highp vec2 u_coordScale;\nuniform vec2 u_symbolSize;\nuniform vec2 u_symbolPercentRange;\nuniform vec2 u_dataRange;\nvarying vec2 v_pos;\nvoid main()\n{\n#ifdef DATA_RANGE\nfloat valuePercentage \x3d clamp((a_vv.y - u_dataRange.x) / (u_dataRange.y - u_dataRange.x), 0.0, 1.0);\nfloat sizeRatio \x3d u_symbolPercentRange.x + valuePercentage * (u_symbolPercentRange.y - u_symbolPercentRange.x);\nfloat sizePercentage \x3d clamp(sizeRatio, u_symbolPercentRange.x, u_symbolPercentRange.y);\n#else\nfloat sizePercentage \x3d (u_symbolPercentRange.x + u_symbolPercentRange.y) / 2.0;\n#endif\nvec2 size \x3d u_symbolSize * sizePercentage;\nvec2 pos \x3d a_pos + a_offset * size;\nv_pos \x3d a_offset;\ngl_Position \x3d vec4(u_dvsMat3 * vec3(pos * u_coordScale, 1.0), 1.0);\n}"},
stretch:{"stretch.frag":"precision mediump float;\nvarying highp vec2 v_texcoord;\n#include \x3craster/common/common.glsl\x3e\nuniform float u_minCutOff[3];\nuniform float u_maxCutOff[3];\nuniform float u_minOutput;\nuniform float u_maxOutput;\nuniform float u_factor[3];\nuniform bool u_useGamma;\nuniform float u_gamma[3];\nuniform float u_gammaCorrection[3];\n#include \x3craster/lut/colorize.glsl\x3e\nfloat stretchOneValue(float val, float minCutOff, float maxCutOff, float minOutput, float maxOutput, float factor, bool useGamma, float gamma, float gammaCorrection) {\nif (val \x3e\x3d maxCutOff) {\nreturn maxOutput;\n} else if (val \x3c\x3d minCutOff) {\nreturn minOutput;\n}\nfloat stretchedVal;\nif (useGamma) {\nfloat tempf \x3d 1.0;\nfloat outRange \x3d maxOutput - minOutput;\nfloat relativeVal \x3d (val - minCutOff) / (maxCutOff - minCutOff);\nif (gamma \x3e 1.0) {\ntempf -\x3d pow(1.0 / outRange, relativeVal * gammaCorrection);\n}\nstretchedVal \x3d (tempf * outRange * pow(relativeVal, 1.0 / gamma) + minOutput) / 255.0;\n} else {\nstretchedVal \x3d minOutput + (val - minCutOff) * factor;\n}\n#ifdef ROUND_OUTPUT\nstretchedVal \x3d floor(stretchedVal + 0.5);\n#endif\nreturn stretchedVal;\n}\nvoid main() {\nvec2 pixelLocation \x3d getPixelLocation(v_texcoord);\nif (isOutside(pixelLocation)) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn;\n}\nvec4 currentPixel \x3d getPixel(pixelLocation);\n#ifdef NOOP\ngl_FragColor \x3d vec4(currentPixel.rgb, 1.0) * currentPixel.a * u_opacity;\nreturn;\n#endif\nif (u_bandCount \x3d\x3d 1) {\nfloat grayVal \x3d stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_useGamma, u_gamma[0], u_gammaCorrection[0]);\n#ifdef APPLY_COLORMAP\nvec4 result \x3d colorize(vec4(grayVal, grayVal, grayVal, 1.0), u_useGamma ? 255.0 : 1.0);\ngl_FragColor \x3d vec4(result.xyz, 1.0) * result.a * currentPixel.a * u_opacity;\n#else\ngl_FragColor \x3d vec4(grayVal, grayVal, grayVal, 1.0) * currentPixel.a * u_opacity;\n#endif\n} else {\nfloat redVal \x3d stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_useGamma, u_gamma[0], u_gammaCorrection[0]);\nfloat greenVal \x3d stretchOneValue(currentPixel.g, u_minCutOff[1], u_maxCutOff[1], u_minOutput, u_maxOutput, u_factor[1], u_useGamma, u_gamma[1], u_gammaCorrection[1]);\nfloat blueVal \x3d stretchOneValue(currentPixel.b, u_minCutOff[2], u_maxCutOff[2], u_minOutput, u_maxOutput, u_factor[2], u_useGamma, u_gamma[2], u_gammaCorrection[2]);\ngl_FragColor \x3d vec4(redVal, greenVal, blueVal, 1.0) * currentPixel.a * u_opacity;\n}\n}"}},
stencil:{"stencil.frag":"void main() {\ngl_FragColor \x3d vec4(1.0, 1.0, 1.0, 1.0);\n}","stencil.vert":"attribute vec2 a_pos;\nuniform mat3 u_worldExtent;\nvoid main() {\ngl_Position \x3d vec4(u_worldExtent * vec3(a_pos, 1.0), 1.0);\n}"},test:{"TestShader.common.glsl":"#ifndef RETURN_RED\nvarying    vec4      v_color;\n#endif\nvarying    vec2      v_offset;","TestShader.frag":"precision highp float;\n#include \x3ctest/TestShader.common.glsl\x3e\nvoid main() {\nif (v_offset.x \x3e -.5 \x26\x26 v_offset.y \x3e -.5 \x26\x26 v_offset.x \x3c .5 \x26\x26 v_offset.y \x3c .5) {\ndiscard;\n}\n#ifdef RETURN_RED\ngl_FragColor \x3d vec4(1., 0., 0., 1.);\n#else\ngl_FragColor \x3d v_color;\n#endif\n}",
"TestShader.vert":"const float POS_PRECISION_FACTOR \x3d 10.;\nconst float OFFSET_PRECISION_FACTOR \x3d 10.;\nconst float SIZE_PRECISION_FACTOR \x3d 10.;\nattribute  vec2      a_pos_packed;\nattribute  vec2      a_offset_packed;\nattribute  float     a_size_packed;\n#ifdef DATA_DRIVEN_COLOR\nconst float u_dataDrivenColor_validValues[4] \x3d float[4](0., 0., 1., 0.);\nuniform    vec4      u_dataDrivenColor_colorFallback;\nuniform    vec4      u_dataDrivenColor_color;\n#endif\nuniform    float     u_view_zoomLevel;\n#include \x3ctest/TestShader.common.glsl\x3e\n#ifdef DATA_DRIVEN_COLOR\nvec4 getColor(float value) {\nint index \x3d -1;\nfor (int i \x3d 0; i \x3c 4; i++) {\nif (u_dataDrivenColor_validValues[i] \x3d\x3d value) {\nindex \x3d i;\nbreak;\n}\n}\nif (index \x3d\x3d -1) {\nreturn u_dataDrivenColor_colorFallback;\n}\nreturn u_dataDrivenColor_color;\n}\n#endif\nvoid main() {\nvec2  a_pos \x3d a_pos_packed / POS_PRECISION_FACTOR;\nvec2  a_offset \x3d a_offset_packed / OFFSET_PRECISION_FACTOR;\nfloat a_size \x3d a_size_packed / SIZE_PRECISION_FACTOR;\nvec4 color \x3d vec4(1., 0., 0., 1.);\n#ifdef DATA_DRIVEN_COLOR\ncolor \x3d getColor(1.);\n#endif\nvec2 offsetScaled \x3d a_offset * a_size;\nvec4 pos \x3d vec4(a_pos.xy + offsetScaled, 0., 1.);\ngl_Position \x3d pos;\n#ifndef RETURN_RED\nv_color \x3d color;\n#endif\nv_offset \x3d a_offset;\n}"},
tileInfo:{"tileInfo.frag":"uniform mediump sampler2D u_texture;\nvarying mediump vec2 v_tex;\nvoid main(void) {\nlowp vec4 color \x3d texture2D(u_texture, v_tex);\ncolor.rgb *\x3d color.a;\ngl_FragColor \x3d color;\n}","tileInfo.vert":"attribute vec2 a_pos;\nuniform highp mat3 u_dvsMat3;\nuniform mediump float u_depth;\nuniform mediump vec2 u_coord_ratio;\nuniform mediump vec2 u_delta;\nuniform mediump vec2 u_dimensions;\nvarying mediump vec2 v_tex;\nvoid main() {\nmediump vec2 offset \x3d u_coord_ratio * vec2(u_delta + a_pos * u_dimensions);\nvec3 v_pos \x3d u_dvsMat3 * vec3(offset, 1.0);\ngl_Position \x3d vec4(v_pos.xy, 0.0, 1.0);\nv_tex \x3d a_pos;\n}"},
util:{"atan2.glsl":"float atan2(in float y, in float x) {\nfloat t0, t1, t2, t3, t4;\nt3 \x3d abs(x);\nt1 \x3d abs(y);\nt0 \x3d max(t3, t1);\nt1 \x3d min(t3, t1);\nt3 \x3d 1.0 / t0;\nt3 \x3d t1 * t3;\nt4 \x3d t3 * t3;\nt0 \x3d         - 0.013480470;\nt0 \x3d t0 * t4 + 0.057477314;\nt0 \x3d t0 * t4 - 0.121239071;\nt0 \x3d t0 * t4 + 0.195635925;\nt0 \x3d t0 * t4 - 0.332994597;\nt0 \x3d t0 * t4 + 0.999995630;\nt3 \x3d t0 * t3;\nt3 \x3d (abs(y) \x3e abs(x)) ? 1.570796327 - t3 : t3;\nt3 \x3d x \x3c 0.0 ?  3.141592654 - t3 : t3;\nt3 \x3d y \x3c 0.0 ? -t3 : t3;\nreturn t3;\n}",
"encoding.glsl":"const vec4 rgba2float_factors \x3d vec4(\n255.0 / (256.0),\n255.0 / (256.0 * 256.0),\n255.0 / (256.0 * 256.0 * 256.0),\n255.0 / (256.0 * 256.0 * 256.0 * 256.0)\n);\nfloat rgba2float(vec4 rgba) {\nreturn dot(rgba, rgba2float_factors);\n}"}}})},"esri/views/2d/engine/webgl/brushes/WGLBrushStencil":function(){define("../../../../../core/libs/gl-matrix-2/factories/vec4f32 ../DefaultVertexAttributeLayouts ./WGLBrush ../shaders/BackgroundPrograms ../../../../webgl/BufferObject ../../../../webgl/enums ../../../../webgl/ProgramTemplate ../../../../webgl/VertexArrayObject".split(" "),
function(l,q,n,d,m,h,g,c){class a extends n{constructor(){super(...arguments);this._color=l.fromValues(1,0,0,1);this._initialized=!1}dispose(){this._solidProgram&&(this._solidProgram.dispose(),this._solidProgram=null);this._solidVertexArrayObject&&(this._solidVertexArrayObject.dispose(),this._solidVertexArrayObject=null)}prepareState({context:b}){b.setDepthWriteEnabled(!1);b.setDepthTestEnabled(!1);b.setStencilTestEnabled(!0);b.setBlendingEnabled(!1);b.setColorMask(!1,!1,!1,!1);b.setStencilOp(h.StencilOperation.KEEP,
h.StencilOperation.KEEP,h.StencilOperation.REPLACE);b.setStencilWriteMask(255)}draw(b,k){const {context:e,requestRender:r,allowDelayedRender:f}=b;this._initialized||this._initialize(e);f&&null!=r&&!this._solidProgram.compiled?r():(e.setStencilFunctionSeparate(h.Face.FRONT_AND_BACK,h.CompareFunction.GREATER,k.stencilRef,255),e.bindVAO(this._solidVertexArrayObject),e.useProgram(this._solidProgram),this._solidProgram.setUniformMatrix3fv("u_dvsMat3",k.transforms.displayViewScreenMat3),this._solidProgram.setUniform2fv("u_coord_range",
[k.rangeX,k.rangeY]),this._solidProgram.setUniform1f("u_depth",0),this._solidProgram.setUniform4fv("u_color",this._color),e.drawArrays(h.PrimitiveType.TRIANGLE_STRIP,0,4),e.bindVAO())}_initialize(b){if(this._initialized)return!0;const k=g.createProgram(b,d.background);if(!k)return!1;var e=new Int8Array([0,0,1,0,0,1,1,1]);e=m.BufferObject.createVertex(b,h.Usage.STATIC_DRAW,e);b=new c.VertexArrayObject(b,d.background.attributes,q.Pos2b,new Map([["geometry",e]]));this._solidProgram=k;this._solidVertexArrayObject=
b;return this._initialized=!0}}return a})},"esri/views/2d/engine/webgl/DefaultVertexAttributeLayouts":function(){define(["exports","../../../webgl/enums","../../../webgl/VertexElementDescriptor"],function(l,q,n){const d=new Map([["geometry",[new n.VertexElementDescriptor("a_pos",2,q.DataType.BYTE,0,2)]]]),m=new Map([["geometry",[new n.VertexElementDescriptor("a_pos",2,q.DataType.BYTE,0,4),new n.VertexElementDescriptor("a_tex",2,q.DataType.BYTE,2,4)]]]);q=new Map([["geometry",[new n.VertexElementDescriptor("a_pos",
2,q.DataType.UNSIGNED_SHORT,0,4)]]]);l.Pos2b=d;l.Pos2us=q;l.PosTex2b=m;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/brushes/WGLBrushTileDebugInfo":function(){define("../../../../../core/libs/gl-matrix-2/factories/vec4f32 ../DefaultVertexAttributeLayouts ../FeatureTile ./WGLBrush ../shaders/BackgroundPrograms ../shaders/TileInfoPrograms ../../../../webgl/BufferObject ../../../../webgl/enums ../../../../webgl/ProgramTemplate ../../../../webgl/Texture ../../../../webgl/TextureDescriptor ../../../../webgl/VertexArrayObject".split(" "),
function(l,q,n,d,m,h,g,c,a,b,k,e){class r extends d{constructor(){super(...arguments);this._color=l.fromValues(1,0,0,1)}dispose(){this._outlineProgram?.dispose();this._outlineProgram=null;this._tileInfoProgram?.dispose();this._tileInfoProgram=null;this._outlineVertexArrayObject?.dispose();this._outlineVertexArrayObject=null;this._tileInfoVertexArrayObject?.dispose();this._ctx=this._tileInfoVertexArrayObject=null}prepareState({context:f}){f.setBlendingEnabled(!0);f.setBlendFunctionSeparate(c.BlendFactor.ONE,
c.BlendFactor.ONE_MINUS_SRC_ALPHA,c.BlendFactor.ONE,c.BlendFactor.ONE_MINUS_SRC_ALPHA);f.setColorMask(!0,!0,!0,!0);f.setStencilWriteMask(0);f.setStencilTestEnabled(!1)}draw(f,p){const {context:t,requestRender:w,allowDelayedRender:z}=f;if(!(!p.isReady&&p instanceof n.FeatureTile&&p.hasData))if(this._loadWGLResources(t),!z||null==w||this._outlineProgram.compiled&&this._tileInfoProgram.compiled){t.bindVAO(this._outlineVertexArrayObject);t.useProgram(this._outlineProgram);this._outlineProgram.setUniformMatrix3fv("u_dvsMat3",
p.transforms.displayViewScreenMat3);this._outlineProgram.setUniform2f("u_coord_range",p.rangeX,p.rangeY);this._outlineProgram.setUniform1f("u_depth",0);this._outlineProgram.setUniform4fv("u_color",this._color);t.drawArrays(c.PrimitiveType.LINE_STRIP,0,4);if(f=this._getTexture(t,p))t.bindVAO(this._tileInfoVertexArrayObject),t.useProgram(this._tileInfoProgram),t.bindTexture(f,0),this._tileInfoProgram.setUniformMatrix3fv("u_dvsMat3",p.transforms.displayViewScreenMat3),this._tileInfoProgram.setUniform1f("u_depth",
0),this._tileInfoProgram.setUniform2f("u_coord_ratio",p.rangeX/p.width,p.rangeY/p.height),this._tileInfoProgram.setUniform2f("u_delta",0,0),this._tileInfoProgram.setUniform2f("u_dimensions",f.descriptor.width,f.descriptor.height),t.drawArrays(c.PrimitiveType.TRIANGLE_STRIP,0,4);t.bindVAO()}else w()}_loadWGLResources(f){if(!this._outlineProgram||!this._tileInfoProgram){var p=a.createProgram(f,m.background),t=a.createProgram(f,h.tileInfo),w=new Int8Array([0,0,1,0,1,1,0,1]);w=g.BufferObject.createVertex(f,
c.Usage.STATIC_DRAW,w);w=new e.VertexArrayObject(f,m.background.attributes,q.Pos2b,new Map([["geometry",w]]));var z=new Int8Array([0,0,1,0,0,1,1,1]);z=g.BufferObject.createVertex(f,c.Usage.STATIC_DRAW,z);f=new e.VertexArrayObject(f,h.tileInfo.attributes,q.Pos2b,new Map([["geometry",z]]));this._outlineProgram=p;this._tileInfoProgram=t;this._outlineVertexArrayObject=w;this._tileInfoVertexArrayObject=f}}_getTexture(f,p){if(!this._ctx){var t=document.createElement("canvas");t.width=512;t.height=512;this._ctx=
t.getContext("2d")}p.tileDebugInfoTexture||(t=new k.TextureDescriptor,t.wrapMode=c.TextureWrapMode.CLAMP_TO_EDGE,t.samplingMode=c.TextureSamplingMode.LINEAR,t.isImmutable=!0,t.width=512,t.height=512,p.tileDebugInfoTexture=new b.Texture(f,t));f=this._ctx;f.clearRect(0,0,f.canvas.width,f.canvas.height);f.textAlign="left";f.textBaseline="top";f.font="14px sans-serif";f.lineWidth=2;f.fillStyle="white";f.strokeStyle="black";var {debugSlot:w}=p;t=8+99.2*w;w=`${w}) ${p.key.id} (${p.constructor.name})`;f.strokeText(w,
8,t);f.fillText(w,8,t);t+=16;({debugInfo:w}=p);if(w){const {length:u,minOrderedLength:y,minUnorderedLength:A,triangleCount:v}=w.display;if(0<u){var z=`Length: ${u}`;f.strokeText(z,8,t);f.fillText(z,8,t);t+=16}y&&(z=`Min ordered length: ${y}`,f.strokeText(z,8,t),f.fillText(z,8,t),t+=16);A&&(z=`Min unordered length: ${A}`,f.strokeText(z,8,t),f.fillText(z,8,t),t+=16);0<v&&(1E5<v&&(f.fillStyle="red",f.strokeStyle="white"),z=`Triangle count: ${v}`,f.strokeText(z,8,t),f.fillText(z,8,t),t+=16);const {bytesUsed:x,
bytesReserved:C}=w.memory;f.fillStyle="white";f.strokeStyle="black";if(0<x||0<C)w=`Memory usage: ${x} of ${C} bytes`,f.strokeText(w,8,t),f.fillText(w,8,t),t+=16}p.tileDebugInfoTexture.setData(f.canvas);return p.tileDebugInfoTexture}}return r})},"esri/views/2d/engine/webgl/FeatureTile":function(){define("exports ../../../../core/has ../../../../core/Logger ../../../../core/libs/gl-matrix-2/factories/mat2df32 ./AFeatureTile ./definitions ./DisplayEntity ./enums ./FeatureDisplayList ./ReshufflePlan ./collisions/LabelMetric ./cpuMapped/MappedMesh ./mesh/meshDebugUtils ./util/Reader ./util/serializationUtils".split(" "),
function(l,q,n,d,m,h,g,c,a,b,k,e,r,f,p){let t=0;class w extends m.AFeatureTile{constructor(z,u,y,A,v=!1){super(z,u,y,A);this._meshes=new Map;this._entities=[];this._nextUploadAllowed=this._invalidated=!1;this.tileAge=t++;this._metrics=[];this._entityIds=new Set;this._entityIdsFromBuffer=new Set;this._attributeEpoch=0;this._encounteredEnd=!1;this._objectIdMap=null;this.visible=!0;this.transforms.labelMat2d=d.create();this.enableDeferredUploads=v}destroy(){super.destroy();this.clear()}clear(){for(const z of this._meshes.values())z.destroy();
this._meshes.clear();this._entities=[];this._metrics=[];this._displayList=null;this._invalidated=!0;this._entityIds.clear();this._nextUploadAllowed=!0}beforeRender(z){super.beforeRender(z);this._needsReshuffle&&z.reshuffleManager.schedule(this)}tryReady(z){const u=this._invalidated&&!this._uploadAllowed;return!this.isReady&&!u&&this._encounteredEnd&&z>=this._attributeEpoch?(q("esri-2d-update-debug")&&console.debug(`Tile[${this.key.id}] FeatureTile.ready [epoch=${z}]`),this.ready(),this.requestRender(),
!0):!1}get labelMetrics(){return this._metrics}get hasData(){return!!this._meshes.size}get hasAnimations(){return!!this._objectIdMap}get needsUpload(){return this._invalidated}get _uploadAllowed(){return!this.enableDeferredUploads||this._nextUploadAllowed}upload(){this._nextUploadAllowed=!0}getDisplayList(z,u){if(this._uploadAllowed&&this._invalidated){this._entities.sort((y,A)=>{const v=A.sortKey,x=y.sortKey;return x===v?y.id-A.id:x-v});u===c.FeatureBatchingStrategy.BATCHING&&this.reshuffle(!0);
this._displayList=a.DisplayList.fromDisplayEntities(this._entities,this,z,u);for(const y of this._meshes.values())y.upload();this.debugInfo.display.length=this._displayList.length;this.debugInfo.display.minOrderedLength=this._displayList.minOrderedLength;this.debugInfo.display.minUnorderedLength=this._displayList.minUnorderedLength;this.requestRender();this._nextUploadAllowed=this._invalidated=!1}return this._displayList}getMesh(z){if(!this._meshes.has(z))throw Error(`InternalError: Unable to find VAO for instance: ${z}`);
return this._meshes.get(z)}getSortKeys(z){const u=new Map;for(const {id:y,sortKey:A}of this._entities)if(z.has(y)&&u.set(y,A),u.size===z.size)break;return u}onMessage(z){if(z.objectIdMap)for(const u in z.objectIdMap)this._objectIdMap||(this._objectIdMap={}),this._objectIdMap[u]=z.objectIdMap[u];switch(z.type){case "append":this._onAppendMessage(z);break;case "update":this._onUpdateMessage(z)}this._aggregateMemoryStats();this.requestRender();if(z.end){q("esri-2d-update-debug")&&console.debug(`Tile[${this.key.id}] FeatureTile.end [epoch=${z.attributeEpoch}]`);
if(!z.attributeEpoch)throw Error("InternalError: Attribute epoch not defined.");this._attributeEpoch=z.attributeEpoch;this._encounteredEnd=!0}}_onAppendMessage(z){q("esri-2d-update-debug")&&console.debug(`Tile[${this.key.id}] FeatureTile.append`,{append:r.debugMeshDataInfo(z?.append)});z.clear&&this.clear();if(z.append){var u=p.deserializeList(new f(z.append.entities),g);this._insert(u,z.append.data,!1)}}_onUpdateMessage(z){q("esri-2d-update-debug")&&console.debug(`Tile[${this.key.id}] FeatureTile.update`,
{isPixelBuffer:z.isPixelBuffer,modify:r.debugMeshDataInfo(z.modify),remove:z.remove});const u=p.deserializeList(new f(z.modify.entities),g);var y=u.map(v=>v.id);const A=z.isPixelBuffer??!1;y=[...z.remove,...y];A?this._removeByIdsFromBuffer(y):this._removeByIds(y);this._insert(u,z.modify.data,A)}reshuffle(z=!1){if(!this.destroyed){var u=new Map;for(const y of this._entities)for(const A of y.records){const v=this._meshes.get(A.instanceId);let x=u.get(v);x||(x=new b.ReshufflePlan(z),u.set(v,x));x.copyRecord(A)}for(const [y,
A]of u)y.reshuffle(A);this._invalidated=!0;this._aggregateMemoryStats();q("esri-2d-update-debug")&&n.getLogger("esri.views.2d.engine.webgl.FeatureTile").info(`Tile ${this.key.id} was reshuffled.`)}}copyPixelBufferedEntitesFrom(z,u,y,A){y*=h.tileSize;A*=h.tileSize;for(const x of z._entities){let C=null;for(const B of x.records)if(B.overlaps&u){var v=z.getMesh(B.instanceId);v=this._ensureMesh(B.instanceId,v.layout).copyRecordFrom(v,B,y,A);C||(C=new g(x.id,x.sortKey),this._entityIdsFromBuffer.add(x.id),
this._entities.push(C));C.records.push(v)}}this._invalidated=!0}_ensureMesh(z,u){this._meshes.has(z)||this._meshes.set(z,new e.MappedMesh(this._stage.bufferPool,u));return this._meshes.get(z)}_insert(z,u,y){if(z.length){this._removeDuplicatedBufferedEntites(z);u=this._insertVertexData(u);for(const A of z){for(const v of A.records)v.updateBaseOffsets(u.get(v.instanceId));y?this._tryInsertBufferedEntity(A):this._insertEntity(A)}this._invalidated=!0}}_insertVertexData(z){const u=new Map;for(const y of z){const {instanceId:A,
layout:v}=y;z=this._ensureMesh(A,v).append(y);if(y.metrics){const x=p.deserializeList(new f(y.metrics),k.LabelMetric)??[];this._metrics.push(...x)}u.set(A,z)}return u}_insertEntity(z){q("esri-2d-update-debug")&&this._entityIds.has(z.id)&&console.error(`Tile ${this.key.id} insertEnitty: Already have entityId ${z.id}`);this._entityIds.add(z.id);this._entities.push(z)}_tryInsertBufferedEntity(z){this._entityIds.has(z.id)?this._removeRecordsFromMesh(z.records):(this._entityIdsFromBuffer.add(z.id),this._entities.push(z))}_removeDuplicatedBufferedEntites(z){if(this._entityIdsFromBuffer.size){var u=
[];for(const y of z)this._entityIdsFromBuffer.has(y.id)&&u.push(y.id);this._removeByIds(u)}}_removeByIdsFromBuffer(z){this._removeByIds(z.filter(u=>this._entityIdsFromBuffer.has(u)))}_removeByIds(z){if(0!==z.length){z=new Set(z);var u=[];for(const y of this._entities)z.has(y.id)?this._remove(y):u.push(y);this._entities=u;this._invalidated=!0}}_remove(z){this._removeRecordsFromMesh(z.records);this._entityIds.delete(z.id);this._entityIdsFromBuffer.delete(z.id);for(let u=this._metrics.length-1;0<=u;u--)this._metrics[u].entityTexel===
z.id&&this._metrics.splice(u,1)}_removeRecordsFromMesh(z){for(const u of z){const {instanceId:y,indexStart:A,indexCount:v,vertexStart:x,vertexCount:C}=u;this._meshes.get(y)?.remove(A,v,x,C)}}_aggregateMemoryStats(){this.debugInfo.memory.bytesUsed=0;this.debugInfo.memory.bytesReserved=0;for(const z of this._meshes.values())this.debugInfo.memory.bytesUsed+=z.memoryStats.bytesUsed,this.debugInfo.memory.bytesReserved+=z.memoryStats.bytesReserved}get _needsReshuffle(){if(this.destroyed)return!1;const {bytesUsed:z,
bytesReserved:u}=this.debugInfo.memory,{minOrderedLength:y,length:A}=this.debugInfo.display;return u>h.RESHUFFLING_EXEMPT_MEMORY_BYTES&&z/u<h.RESHUFFLING_TARGET_MEMORY_EFFICIENCY||A>h.RESHUFFLING_EXEMPT_DRAW_CALLS&&y/A<h.RESHUFFLING_TARGET_DRAW_EFFICIENCY?!0:!1}get entityIds(){return this._objectIdMap?this._entities.map(({id:z})=>({objectId:this._objectIdMap[z],displayId:z})):[]}}l.FeatureTile=w;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/AFeatureTile":function(){define("exports ../../../../core/libs/gl-matrix-2/math/mat2d ../../../../core/libs/gl-matrix-2/factories/mat2df32 ../../../../core/libs/gl-matrix-2/math/mat3 ../../../../core/libs/gl-matrix-2/factories/mat3f32 ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f32 ./definitions ./TiledDisplayObject".split(" "),
function(l,q,n,d,m,h,g,c,a){const b=m.create(),k=g.create();class e extends a.TiledDisplayObject{constructor(r,f,p,t){super(r,f,p,t,c.tileSize,c.tileSize)}destroy(){super.destroy()}setTransform(r){var f=this.resolution/r.resolution,p=this.transforms.tileMat3;const [t,w]=r.toScreenNoRotation([0,0],[this.x,this.y]),z=this.width/this.rangeX*f;f*=this.height/this.rangeY;d.set(p,z,0,0,0,f,0,t,w,1);d.multiply(this.transforms.displayViewScreenMat3,r.displayViewMat3,p);p=q.set(n.create(),z,0,0,f,t,w);q.multiply(this.transforms.labelMat2d,
r.viewMat2d,p)}_createTransforms(){return{labelMat2d:n.create(),tileMat3:m.create(),displayViewScreenMat3:m.create()}}containsScreenPoint(r,f,p){var t=d.multiply(b,r.viewMat3,this.transforms.tileMat3);t=d.invert(b,t);if(null==t)return!0;h.set(k,...f,1);f=h.transformMat3(k,k,t);r=this.resolution/r.resolution*p;return f[0]>=-r&&f[0]<this.width+r&&f[1]>=-r&&f[1]<this.height+r}}l.AFeatureTile=e;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/core/libs/gl-matrix-2/factories/vec3f32":function(){define(["exports"],
function(l){function q(){return new Float32Array(3)}function n(w){const z=new Float32Array(3);z[0]=w[0];z[1]=w[1];z[2]=w[2];return z}function d(w,z,u){const y=new Float32Array(3);y[0]=w;y[1]=z;y[2]=u;return y}function m(w,z){return new Float32Array(w,z,3)}function h(){return q()}function g(){return d(1,1,1)}function c(){return d(1,0,0)}function a(){return d(0,1,0)}function b(){return d(0,0,1)}const k=q(),e=g(),r=c(),f=a(),p=b(),t=Object.freeze(Object.defineProperty({__proto__:null,ONES:e,UNIT_X:r,
UNIT_Y:f,UNIT_Z:p,ZEROS:k,clone:n,create:q,createView:m,fromValues:d,ones:g,unitX:c,unitY:a,unitZ:b,zeros:h},Symbol.toStringTag,{value:"Module"}));l.ONES=e;l.UNIT_X=r;l.UNIT_Y=f;l.UNIT_Z=p;l.ZEROS=k;l.clone=n;l.create=q;l.createView=m;l.fromValues=d;l.ones=g;l.unitX=c;l.unitY=a;l.unitZ=b;l.vec3f32=t;l.zeros=h;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/TiledDisplayObject":function(){define(["exports","../../../../core/libs/gl-matrix-2/math/mat3","../DisplayObject",
"../../tiling/TileKey"],function(l,q,n,d){class m extends n.DisplayObject{constructor(h,g,c,a,b,k,e=b,r=k){super();this.tileDebugInfoTexture=null;this.debugInfo={display:{length:0,minOrderedLength:0,minUnorderedLength:0,triangleCount:0},memory:{bytesUsed:0,bytesReserved:0}};this._destroyed=!1;this.key=new d(h);this.resolution=g;this.x=c;this.y=a;this.width=b;this.height=k;this.rangeX=e;this.rangeY=r}destroy(){this.tileDebugInfoTexture&&(this.tileDebugInfoTexture.dispose(),this.tileDebugInfoTexture=
null);this._destroyed=!0}get debugSlot(){let h=this;for(;h.parent!==this._stage;){if(!h.parent)return 0;h=h.parent}return this._stage.children.indexOf(h)}setTransform(h){const g=this.resolution/(h.resolution*h.pixelRatio),c=this.transforms.tileMat3,[a,b]=h.toScreenNoRotation([0,0],[this.x,this.y]);q.set(c,this.width/this.rangeX*g,0,0,0,this.height/this.rangeY*g,0,a,b,1);q.multiply(this.transforms.displayViewScreenMat3,h.displayViewMat3,c)}get destroyed(){return this._destroyed}}l.TiledDisplayObject=
m;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/DisplayEntity":function(){define(["./DisplayRecord","./util/serializationUtils"],function(l,q){class n{constructor(d,m){this.id=d;this.sortKey=m;this.records=[]}serialize(d){d.push(this.id);d.writeF32(this.sortKey);q.serializeList(d,this.records);return d}static deserialize(d){var m=d.readInt32();const h=d.readF32();m=new n(m,h);m.records=q.deserializeList(d,l)??[];return m}}n.byteSizeHint=2*Uint32Array.BYTES_PER_ELEMENT+
l.byteSizeHint;return n})},"esri/views/2d/engine/webgl/DisplayRecord":function(){define(function(){class l{constructor(q,n,d,m,h,g,c){this.instanceId=q;this.textureKey=n;this.indexStart=d;this.indexCount=m;this.vertexStart=h;this.vertexCount=g;this.overlaps=c}updateBaseOffsets(q){this.vertexStart+=q.vertexFrom;this.indexStart+=q.indexFrom}clone(){return new l(this.instanceId,this.textureKey,this.indexStart,this.indexCount,this.vertexStart,this.vertexCount,this.overlaps)}static write(q,n,d,m,h,g,c,
a){q.push(n);q.push(d);q.push(m);q.push(h);q.push(g);q.push(c);q.push(a)}serialize(q){q.push(this.instanceId);q.push(this.textureKey);q.push(this.indexStart);q.push(this.indexCount);q.push(this.vertexStart);q.push(this.vertexCount);q.push(this.overlaps);return q}static deserialize(q){const n=q.readInt32(),d=q.readInt32(),m=q.readInt32(),h=q.readInt32(),g=q.readInt32(),c=q.readInt32();q=q.readInt32();return new l(n,d,m,h,g,c,q)}}l.byteSizeHint=7*Uint32Array.BYTES_PER_ELEMENT;return l})},"esri/views/2d/engine/webgl/util/serializationUtils":function(){define(["exports"],
function(l){l.deserializeList=function(q,n,d){var m=q.readInt32();m=Array(m);for(let h=0;h<m.length;h++)m[h]=n.deserialize(q,d);return m};l.serializeList=function(q,n){if(null===n)q.push(0);else{q.push(n.length);for(const d of n)d.serialize(q);return q}};Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/FeatureDisplayList":function(){define("exports ../../../../core/has ./enums ./cpuMapped/FreeList ./shaderGraph/techniques/featureTechniqueUtils ../../../webgl/enums".split(" "),
function(l,q,n,d,m,h){class g{constructor(a,b,k,e,r){this.instance=a;this.materialKey=b;this.target=k;this.start=e;this.count=r}get textureKey(){return this.materialKey&255}get indexEnd(){return this.start+this.count}extend(a){this.count+=a}render(a){this.instance.techniqueRef.render(a,this)}getStencilReference(){return this.target.stencilRef}getAttributePrecisionPackFactors(){return this.target.getMesh(this.instance.instanceId).getAttributePrecisionPackFactors()}draw(a,b){m.isHittest(a)?this.drawCompute(a.context,
b):this.drawGeometry(a.context,b)}drawCompute(a,b){b=this.target.getMesh(this.instance.instanceId).getComputeVAO(a,b);const k=this.start*Uint32Array.BYTES_PER_ELEMENT/3;a.bindVAO(b);a.drawElements(h.PrimitiveType.POINTS,this.count/3,h.DataType.UNSIGNED_INT,k);a.bindVAO(null)}drawGeometry(a,b){b=this.target.getMesh(this.instance.instanceId).getGeometryVAO(a,b);const k=this.start*Uint32Array.BYTES_PER_ELEMENT;a.bindVAO(b);a.drawElements(h.PrimitiveType.TRIANGLES,this.count,h.DataType.UNSIGNED_INT,k);
a.bindVAO(null)}}class c{constructor(){this._minOrderedLength=this._length=0;this._materialKeys=new Set}static fromDisplayEntities(a,b,k,e){const r=new c;for(const f of a.values())for(const p of f.records)a=k.getInstance(p.instanceId),r.addRecord(a,a.instanceId<<16|p.textureKey&255,p.indexStart,p.indexCount,p.vertexStart,p.vertexCount,b,e);return r}get length(){return this._length}get minOrderedLength(){return this._minOrderedLength}get minUnorderedLength(){return this._materialKeys.size}render(a,
b){const {drawPhase:k}=a;for(const e of this.infos()){const r=e.instance.techniqueRef;r.drawPhase&k&&(null==b||r.type===b)&&e.render(a)}}addRecord(a,b,k,e,r,f,p,t){e||(k=r,e=f);if(e)if(null==this._head)a=new g(a,b,p,k,e),this._tail=this._head=new d.List(a),this._length++,this._minOrderedLength++;else{if(t===n.FeatureBatchingStrategy.STRICT_ORDER)return this._insert(a,b,p,k,e,this._tail,null);r=null;f=this._head;var w=a.instanceId,z=a.techniqueRef.symbologyPlane;if(t===n.FeatureBatchingStrategy.STRICT_MARKERS_AND_TEXT&&
(z===n.FeatureSymbologyDrawOrder.MARKER||z===n.FeatureSymbologyDrawOrder.TEXT))return this._insert(a,b,p,k,e,this._tail,null);for(;f;){t=f.data.instance;const u=t.instanceId,y=r?.data.instance.instanceId;if(z<t.techniqueRef.symbologyPlane||w===y&&w!==u)return this._insert(a,b,p,k,e,r,f);r=f;f=f.next}this._insert(a,b,p,k,e,r,null)}}*infos(){if(null!=this._head)for(const a of this._head.values())yield a}_insert(a,b,k,e,r,f,p){if(null==f&&null==p)a=new g(a,b,k,e,r),this._tail=this._head=new d.List(a),
this._length++,this._minOrderedLength++;else{b!==this._tail.data.materialKey&&this._minOrderedLength++;this._materialKeys.add(b);if(null==f&&null!=p)return this._insertAtHead(a,b,k,e,r,p);if(null!=f&&null==p)return this._insertAtEnd(a,b,k,e,r,f);if(null!=f&&null!=p)return this._insertAtMiddle(a,b,k,e,r,f,p)}}_insertAtHead(a,b,k,e,r,f){b===f.data.materialKey&&k===f.data.target&&e+r===f.data.start?(f.data.start=e,f.data.count+=r):(a=new g(a,b,k,e,r),this._head=new d.List(a),this._head.next=f,this._length++)}_insertAtEnd(a,
b,k,e,r,f){f.data.materialKey===b&&f.data.indexEnd===e?f.data.count+=r:(a=new g(a,b,k,e,r),this._tail=new d.List(a),f.next=this._tail,this._length++)}_insertAtMiddle(a,b,k,e,r,f,p){f.data.materialKey===b&&f.data.target===k&&f.data.indexEnd===e?(f.data.count+=r,f.data.materialKey===p.data.materialKey&&f.data.target===p.data.target&&f.data.indexEnd===p.data.start&&(f.data.count+=p.data.count,f.next=p.next,this._length--)):b===p.data.materialKey&&k===p.data.target&&e+r===p.data.start?(p.data.start=e,
p.data.count+=r):(a=new g(a,b,k,e,r),a=new d.List(a),f.next=a,a.next=p,this._length++)}}l.DisplayList=c;l.DisplayListInfo=g;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/cpuMapped/FreeList":function(){define(["exports"],function(l){class q{constructor(d){this.next=null;if(Array.isArray(d)){this.data=d[0];var m=this;for(let h=1;h<d.length;h++)m.next=new q([d[h]]),m=m.next}else this.data=d}*values(){let d=this;for(;d;)yield d.data,d=d.next}forEach(d){let m=
this;for(;m;)d(m.data),m=m.next}get last(){return this.next?this.next.last:this}}class n{constructor(d){this._head=null;null!=d&&(this._head=new q(d))}get head(){return this._head}maxAvailableSpace(){if(null==this._head)return 0;let d=0;this._head.forEach(m=>{d=Math.max(d,m.end-m.start)});return d}firstFit(d){if(null==this._head)return null;var m=null;let h=this._head;for(;h;){const g=h.data.end-h.data.start;if(g===d)return m?m.next=h.next:this._head=h.next,h.data.start;if(g>d)return m=h.data.start,
h.data.start+=d,m;m=h;h=h.next}return null}free(d,m){const h=d+m;if(null==this._head)this._head=new q({start:d,end:h});else if(h<=this._head.data.start)if(h===this._head.data.start)this._head.data.start-=m;else{var g=new q({start:d,end:h});g.next=this._head;this._head=g}else{g=this._head;for(var c=g.next;c;){if(c.data.start>=h){if(g.data.end===d){g.data.end+=m;g.data.end===c.data.start&&(g.data.end+=c.data.end-c.data.start,g.next=c.next);return}if(c.data.start===h){c.data.start-=m;return}d=new q({start:d,
end:h});d.next=g.next;g.next=d;return}g=c;c=c.next}d===g.data.end?g.data.end+=m:(d=new q({start:d,end:h}),g.next=d)}}clear(){this._head=null}}l.FreeList=n;l.List=q;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/ReshufflePlan":function(){define(["exports"],function(l){class q{constructor(n){this._indexOnly=n;this.vertex={count:0,operations:[]};this.index={count:0,operations:[]}}copyRecord(n){let d=0;this._indexOnly||(d=this.vertex.count-n.vertexStart,this.vertex.operations.push({srcFrom:n.vertexStart,
dstFrom:this.vertex.count,count:n.vertexCount,mutate:0}),n.vertexStart=this.vertex.count,this.vertex.count+=n.vertexCount);let m=!1;if(this._indexOnly&&1<=this.index.operations.length){const h=this.index.operations[this.index.operations.length-1];h.srcFrom+h.count===n.indexStart&&(h.count+=n.indexCount,m=!0)}m||this.index.operations.push({srcFrom:n.indexStart,dstFrom:this.index.count,count:n.indexCount,mutate:d});n.indexStart=this.index.count;this.index.count+=n.indexCount}}l.ReshufflePlan=q;Object.defineProperty(l,
Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/collisions/LabelMetric":function(){define(["exports","./BoundingBox","../util/serializationUtils"],function(l,q,n){class d{constructor(m,h,g,c,a,b,k,e,r=[]){this.entityTexel=m;this.anchorX=h;this.anchorY=g;this.directionX=c;this.directionY=a;this.maxScale=b;this.minScale=k;this.referenceBounds=e;this.bounds=r}serialize(m){m.push(this.entityTexel);m.writeF32(this.anchorX);m.writeF32(this.anchorY);m.writeF32(this.directionX);m.writeF32(this.directionY);
m.writeF32(this.maxScale);m.writeF32(this.minScale);null===this.referenceBounds?(m.writeF32(0),m.writeF32(0),m.writeF32(0)):(m.writeF32(this.referenceBounds.size),m.writeF32(this.referenceBounds.offsetX),m.writeF32(this.referenceBounds.offsetY));n.serializeList(m,this.bounds)}static deserialize(m){const h=m.readInt32(),g=m.readF32(),c=m.readF32(),a=m.readF32(),b=m.readF32(),k=m.readF32(),e=m.readF32(),r=m.readF32(),f=m.readF32(),p=m.readF32();m=n.deserializeList(m,q)??[];return new d(h,g,c,a,b,k,
e,{size:r,offsetX:f,offsetY:p},m)}}l.LabelMetric=d;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/cpuMapped/MappedMesh":function(){define("exports ../../../../../core/maybe ../number ./Buffer ../shaderGraph/techniques/mesh/dataViewUtils ../../../../webgl/enums ../../../../webgl/VertexArrayObject".split(" "),function(l,q,n,d,m,h,g){function c(k,e){const r=k.attributes.filter(f=>e.locations.has(f.name)).map(f=>({name:f.name,type:f.type,count:f.count,divisor:0,
normalized:f.normalized??!1,offset:f.offset,stride:k.stride}));return new Map([["geometry",r]])}function a(k,e){const r=[];var f=k.attributes.filter(p=>e.locations.has(p.name));for(const p of f)r.push({name:p.name,type:p.type,count:p.count,divisor:0,normalized:p.normalized??!1,offset:p.offset,stride:k.stride}),f=e.computeAttributeMap[p.name],null!=f&&2===f.length&&(r.push({name:f[0],count:p.count,divisor:0,type:p.type,normalized:p.normalized??!1,offset:p.offset+k.stride,stride:k.stride}),r.push({name:f[1],
count:p.count,divisor:0,type:p.type,normalized:p.normalized??!1,offset:p.offset+2*k.stride,stride:k.stride}));return new Map([["geometry",r]])}class b{constructor(k,e){this._bufferPool=k;this._layout=e;this._invalidatedCompute=this._invalidatedGeometry=!1;this._position=this._layout.attributes.find(r=>"pos"===r.name||"position"===r.name);if(!this._position)throw Error("InternalError: Unable to find position attribute");}destroy(){this._indexBuffer=q.destroyMaybe(this._indexBuffer);this._vertexBuffer=
q.destroyMaybe(this._vertexBuffer);this._computeVAO?.disposeVAOOnly();this._geometryVAO?.disposeVAOOnly()}get layout(){return this._layout}getDrawArgs(k,e,r,f){return f?{primitive:h.PrimitiveType.POINTS,count:e/3,offset:r/3}:{primitive:k,count:e,offset:r}}getAttributePrecisionPackFactors(){const k={};for(const e of this.layout.attributes)e.packPrecisionFactor&&(k[e.name]=e.packPrecisionFactor);return k}getDebugVertexInfo(k=!1,e){if(!this._vertexBuffer)return null;const r=this._layout,f=r.stride;var p=
this._vertexBuffer.getView(0,this._vertexBuffer.byteSize);const t=[];if(k)if(null==e)console.log("must provide location info to see compute attributes");else for(var w of r.attributes){var z=e.computeAttributeMap[w.name];null!=z&&2===z.length&&(t.push({...w,name:z[0],offset:w.offset+f}),t.push({...w,name:z[1],offset:w.offset+2*f}))}e=new DataView(p.slice().buffer);p=p.byteLength/f;k&&(p=this._indexBuffer.fillPointer/3);w=this._indexBuffer.getView(0,this._indexBuffer.byteSize);z=0;const u=[];for(let y=
0;y<p;y++){k&&(z=w[3*y]*f);const A={};for(const v of[...r.attributes,...t]){let x=`${v.offset} ${v.name}`,C=m.unpackDataView(e,v,z);if(v.packPrecisionFactor)if(x+=` (precision: ${v.packPrecisionFactor})`,"number"===typeof C)C/=v.packPrecisionFactor;else for(let B=0;B<C.length;B++)C[B]/=v.packPrecisionFactor;A[x]=C}z+=f;u.push(A)}return{vertices:u,layout:r}}_ensure(k,e){if(this._vertexBuffer&&this._indexBuffer)this._indexBuffer.ensure(Math.max(k,1E3)),this._vertexBuffer.ensure(Math.max(e,1E3));else{const r=
this._layout.stride/Uint32Array.BYTES_PER_ELEMENT;this._indexBuffer=new d.MappedBuffer("index",Math.max(k,1E3),1,this._bufferPool);this._vertexBuffer=new d.MappedBuffer("vertex",Math.max(e,1E3),r,this._bufferPool)}}append(k){var e=k.layout.stride;this._ensure(k.indices.byteLength/Uint32Array.BYTES_PER_ELEMENT,k.vertices.byteLength/e);const {vertices:r,indices:f}=k;k=this._vertexBuffer.insert(r,0,r.byteLength/e,0);e=this._indexBuffer.insert(f,0,f.byteLength/4,k);return{vertexFrom:k,indexFrom:e}}copyRecordFrom(k,
e,r,f){const {indexStart:p,indexCount:t,vertexStart:w,vertexCount:z}=e;this._ensure(t,z);const u=k._position;var y=u.offset;r=n.i1616to32(r*(u.packPrecisionFactor??1),f*(u.packPrecisionFactor??1));y=this._vertexBuffer.copyFrom(k._vertexBuffer,w,z,r,y);k=this._indexBuffer.copyFrom(k._indexBuffer,p,t,y-w,0);e=e.clone();e.vertexStart=y;e.indexStart=k;e.overlaps=0;return e}remove(k,e,r,f){this._indexBuffer.free(k,e);this._vertexBuffer.free(r,f)}upload(){this._invalidatedCompute=this._invalidatedGeometry=
!0}getGeometryVAO(k,e){if(!this._vertexBuffer||!this._indexBuffer||!this._vertexBuffer.bufferSize)return null;if(this._invalidatedGeometry){if(this._vertexBuffer.invalidated||this._indexBuffer.invalidated)this._vertexBuffer.invalidate(),this._indexBuffer.invalidate(),this._geometryVAO?.disposeVAOOnly(),this._geometryVAO=null;this._vertexBuffer.upload();this._indexBuffer.upload();const r=this._indexBuffer.getGPUBuffer(k,!1),f=this._vertexBuffer.getGPUBuffer(k);this._geometryVAO||(this._geometryVAO=
new g.VertexArrayObject(k,e.locations,c(this.layout,e),new Map([["geometry",f]]),r));this._invalidatedGeometry=!1}return this._geometryVAO}getComputeVAO(k,e){if(!this._vertexBuffer||!this._indexBuffer||!this._vertexBuffer.bufferSize)return null;if(this._invalidatedCompute){if(this._vertexBuffer.invalidated||this._indexBuffer.invalidatedComputeBuffer)this._vertexBuffer.invalidate(),this._indexBuffer.invalidate(),this._computeVAO?.disposeVAOOnly(),this._computeVAO=null;this._vertexBuffer.upload();this._indexBuffer.upload();
const r=this._indexBuffer.getGPUBuffer(k,!0),f=this._vertexBuffer.getGPUBuffer(k);this._computeVAO||(this._computeVAO=new g.VertexArrayObject(k,e.locations,a(this.layout,e),new Map([["geometry",f]]),r),this._invalidatedCompute=!1)}return this._computeVAO}get memoryStats(){return{bytesUsed:this._vertexBuffer.memoryStats.bytesUsed+this._indexBuffer.memoryStats.bytesUsed,bytesReserved:this._vertexBuffer.memoryStats.bytesReserved+this._indexBuffer.memoryStats.bytesReserved,vertex:this._vertexBuffer.memoryStats,
index:this._indexBuffer.memoryStats}}reshuffle(k){this._vertexBuffer&&this._vertexBuffer.reshuffle(k.vertex.count,k.vertex.operations);this._indexBuffer&&this._indexBuffer.reshuffle(k.index.count,k.index.operations)}}l.MappedMesh=b;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/number":function(){define(["exports"],function(l){function q(h,g,c){return Math.round(Math.max(Math.min(h,c),g))}function n(h){d[0]=h;return m[0]}const d=new Float32Array(1),m=new Uint32Array(d.buffer);
l.fromUint16=function(h){let g,c;g=(h>>10&31)-15;c=(h&1023)/1024;-15<g?c+=1:g=-14;return(h>>>15?-1:1)*2**g*c};l.i16=function(h){return q(h,-32768,32767)};l.i1616to32=function(h,g){return 65535&h|g<<16};l.i32=function(h){return q(h,-2147483648,2147483647)};l.i8=function(h){return q(h,-128,127)};l.i8816to32=function(h,g,c){return h&255|(g&255)<<8|c<<16};l.i8888to32=function(h,g,c,a){return h&255|(g&255)<<8|(c&255)<<16|a<<24};l.numTo32=function(h){return h|0};l.toFloat32=function(h){m[0]=h;return d[0]};
l.toUint16=function(h){var g=n(h);h=g>>>31;var c=g&8388607;g=(g>>>23&255)-127;if(15<g)return h<<15|31744;if(-25>g)return 0;-14>g&&(c=(c+8388608)/2**(-14-g),g=-15);var a=c/8192;c=Math.floor(a);a-=c;c=1023>c&&(.5<a||.5===a&&1===c%2)?c+1:c;return h<<15|g+15<<10|c};l.toUint32=n;l.u16=function(h){return q(h,0,65535)};l.u32=function(h){return q(h,0,4294967295)};l.u32to4Xu8=function(h){return[h&255,(h&65280)>>>8,(h&16711680)>>>16,(h&4278190080)>>>24]};l.u4u4to8=function(h,g){return 15&h|(15&g)<<4};l.u8=
function(h){return q(h,0,255)};Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/cpuMapped/Buffer":function(){define("exports ../../../../../core/has ../../../../../core/maybe ../PooledUint32Array ./FreeList ../../../../webgl/BufferObject ../../../../webgl/enums".split(" "),function(l,q,n,d,m,h,g){class c{constructor(a,b,k,e){this._pool=e;e=d.PooledUint32Array.create(b*k*Uint32Array.BYTES_PER_ELEMENT,this._pool);this.size=b;this.strideInt=k;this.bufferType=
a;this.dirty={start:Infinity,end:0};this.memoryStats={bytesUsed:0,bytesReserved:b*k*Uint32Array.BYTES_PER_ELEMENT};this._gpu=null;this._cpu=e;this.clear()}get elementSize(){return this._cpu.length/this.strideInt}get intSize(){return this.fillPointer*this.strideInt}get byteSize(){return this.intSize*Uint32Array.BYTES_PER_ELEMENT}get invalidated(){return 0<this.bufferSize&&!this._gpu}get invalidatedComputeBuffer(){return 0<this.bufferSize&&!this._gpuComputeTriangles}invalidate(){this._invalidateTriangleBuffer();
this._gpu?.dispose();this._gpu=null}_invalidateTriangleBuffer(){this._gpuComputeTriangles?.dispose();this._gpuComputeTriangles=null}destroy(){this._gpu?.dispose();this._gpuComputeTriangles?.dispose();this._cpu?.destroy()}clear(){this.dirty.start=Infinity;this.dirty.end=0;this.freeList=new m.FreeList({start:0,end:this._cpu.length/this.strideInt});this.fillPointer=0}ensure(a){if(!(this.maxAvailableSpace()>=a)&&a*this.strideInt>this._cpu.length-this.fillPointer){this.invalidate();const b=this._cpu.length/
this.strideInt;a=Math.round(1.25*(b+a));this._cpu.expand(a*this.strideInt*Uint32Array.BYTES_PER_ELEMENT);this.freeList.free(b,a-b);this.memoryStats.bytesReserved+=(a-b)*this.strideInt*Uint32Array.BYTES_PER_ELEMENT}}set(a,b){this._cpu.array[a]!==b&&(this._cpu.array[a]=b,this.dirty.start=Math.min(a,this.dirty.start),this.dirty.end=Math.max(a+1,this.dirty.end))}getGPUBuffer(a,b=!1){if(!this.bufferSize)return null;if(b){if("index"!==this.bufferType)throw Error("Tired to get triangle buffer, but target is not an index buffer");
null==this._gpuComputeTriangles&&(this._gpuComputeTriangles=this._createComputeBuffer(a));return this._gpuComputeTriangles}null==this._gpu&&(this._gpu=this._createBuffer(a));return this._gpu}getView(a,b){return this._cpu.getUint32View(a,b/Uint32Array.BYTES_PER_ELEMENT)}get bufferSize(){return this._cpu.length/this.strideInt}maxAvailableSpace(){return this.freeList.maxAvailableSpace()}insert(a,b,k,e){const r=k*this.strideInt;if(!r)return 0;a=new Uint32Array(a,b*this.strideInt*Uint32Array.BYTES_PER_ELEMENT,
r);b=this.freeList.firstFit(k);n.assertIsSome(b,"First fit region must be defined");const f=b*this.strideInt;this._cpu.array.set(a,f);if(0!==e)for(let p=0;p<a.length;p++)this._cpu.array[p+f]+=e;this.dirty.start=Math.min(this.dirty.start,f);this.dirty.end=Math.max(this.dirty.end,f+r);this.fillPointer=Math.max(this.fillPointer,f+r);this.memoryStats.bytesUsed+=k*this.strideInt*Uint32Array.BYTES_PER_ELEMENT;return b}copyFrom(a,b,k,e,r){const f=k*this.strideInt;if(!f)return 0;var p=a._cpu.getUint32View(b*
this.strideInt*Uint32Array.BYTES_PER_ELEMENT,f);a=this.freeList.firstFit(k);n.assertIsSome(a,"First fit region must be defined");b=a*this.strideInt;this._cpu.array.set(p,b);if(0!==e)for(p=0;p<f;p++)this._cpu.array[b+p*this.strideInt+r]+=e;this.dirty.start=Math.min(this.dirty.start,b);this.dirty.end=Math.max(this.dirty.end,b+f);this.fillPointer=Math.max(this.fillPointer,b+f);this.memoryStats.bytesUsed+=k*this.strideInt*Uint32Array.BYTES_PER_ELEMENT;return a}free(a,b,k){const e=a*this.strideInt,r=(a+
b)*this.strideInt;if(!0===k)for(k=a;k!==a+b;k++)this._cpu.array[k*this.strideInt]=2147450879;this.dirty.start=Math.min(this.dirty.start,e);this.dirty.end=Math.max(this.dirty.end,r);this.freeList.free(a,b);this.memoryStats.bytesUsed-=b*this.strideInt*Uint32Array.BYTES_PER_ELEMENT}upload(){this.dirty.end&&(this._invalidateTriangleBuffer(),null!=this._gpu&&this._gpu.setSubData(this._cpu.array,this.dirty.start,this.dirty.start,this.dirty.end),this.dirty.start=Infinity,this.dirty.end=0)}reshuffle(a,b){if(0!==
b.length){a=a*this.strideInt*Uint32Array.BYTES_PER_ELEMENT;var k=this.byteSize>a,e=this._cpu,r=d.PooledUint32Array.create(a,this._pool);k||r.array.set(this._cpu.getUint32View(0,this.intSize));for(const f of b)if(k||f.srcFrom!==f.dstFrom||0!==f.mutate)for(this.dirty.start=Math.min(this.dirty.start,f.dstFrom*this.strideInt),this.dirty.end=Math.max(this.dirty.end,(f.dstFrom+f.count)*this.strideInt),b=0;b<f.count;b++){const p=(f.dstFrom+b)*this.strideInt,t=(f.srcFrom+b)*this.strideInt;for(let w=0;w<this.strideInt;w++)r.array[p+
w]=e.array[t+w]+f.mutate}this._cpu.destroy();this._cpu=r;k&&this.invalidate();this.freeList.clear();this.memoryStats.bytesUsed=this.memoryStats.bytesReserved=a}}_createBuffer(a){const b=g.Usage.DYNAMIC_DRAW;return"index"===this.bufferType?h.BufferObject.createIndex(a,b,this._cpu.array):h.BufferObject.createVertex(a,b,this._cpu.array)}_createComputeBuffer(a){const b=g.Usage.DYNAMIC_DRAW,k=new Uint32Array(this.fillPointer/3);for(let e=0;e<this.fillPointer;e+=3)k[e/3]=this._cpu.array[e];return h.BufferObject.createIndex(a,
b,k)}}l.MappedBuffer=c;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/PooledUint32Array":function(){define(["exports","../../../../core/has","../../../../core/maybe","./cpuMapped/FreeList"],function(l,q,n,d){const m=q("esri-2d-log-allocations");class h{static create(a,b){a=b.acquireUint32Array(a);return new h(a,b)}constructor(a,b){this._array=a;this._pool=b}get array(){return this._array}get length(){return this._array.length}getUint32View(a,b){return new Uint32Array(this._array.buffer,
a+this._array.byteOffset,b)}expand(a){a<=this._array.byteLength||(a=this._pool.acquireUint32Array(a),a.set(this._array),this._pool.releaseUint32Array(this._array),this._array=a)}destroy(){this._pool.releaseUint32Array(this._array)}}class g{constructor(){this._data=new ArrayBuffer(g.BYTE_LENGTH);this._freeList=new d.FreeList({start:0,end:this._data.byteLength})}static get BYTE_LENGTH(){return 16E6}get buffer(){return this._data}acquireUint32Array(a){const b=this._freeList.firstFit(a);return null==
b?null:new Uint32Array(this._data,b,a/Uint32Array.BYTES_PER_ELEMENT)}releaseUint32Array(a){this._freeList.free(a.byteOffset,a.byteLength)}}class c{constructor(){this._pages=[];this._pagesByBuffer=new Map;this._bytesAllocated=0}destroy(){this._pages=[];this._pagesByBuffer=null}get _bytesTotal(){return this._pages.length*g.BYTE_LENGTH}acquireUint32Array(a){this._bytesAllocated+=a;m&&console.log(`Allocating ${a}, (${this._bytesAllocated} / ${this._bytesTotal})`);if(a>=g.BYTE_LENGTH)return new Uint32Array(a/
Uint32Array.BYTES_PER_ELEMENT);for(const b of this._pages){const k=b.acquireUint32Array(a);if(null!=k)return k}a=this._addPage().acquireUint32Array(a);n.assertIsSome(a,"Expected to allocate page");return a}releaseUint32Array(a){this._bytesAllocated-=a.byteLength;m&&console.log(`Freeing ${a.byteLength}, (${this._bytesAllocated} / ${this._bytesTotal})`);const b=this._pagesByBuffer.get(a.buffer);b&&b.releaseUint32Array(a)}_addPage(){const a=new g;this._pages.push(a);this._pagesByBuffer.set(a.buffer,
a);return a}}l.ArrayBufferPool=c;l.PooledUint32Array=h;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/mesh/dataViewUtils":function(){define(["exports","../../../number","../../../../../../webgl/enums"],function(l,q,n){l.packDataView=function(d,m,h,g){const c=h.packPrecisionFactor??1;switch(h.type){case n.DataType.BYTE:if(1===h.count)d.setInt8(g+h.offset,m*c);else for(var a=0;a<h.count;a++)d.setInt8(g+h.offset+a*Int8Array.BYTES_PER_ELEMENT,
m[a]*c);break;case n.DataType.UNSIGNED_BYTE:if(1===h.count)d.setUint8(g+h.offset,m*c);else for(a=0;a<h.count;a++)d.setUint8(g+h.offset+a*Uint8Array.BYTES_PER_ELEMENT,m[a]*c);break;case n.DataType.SHORT:if(1===h.count)d.setInt16(g+h.offset,m*c,!0);else for(a=0;a<h.count;a++)d.setInt16(g+h.offset+a*Int16Array.BYTES_PER_ELEMENT,m[a]*c,!0);break;case n.DataType.UNSIGNED_SHORT:if(1===h.count)d.setUint16(g+h.offset,m*c,!0);else for(a=0;a<h.count;a++)d.setUint16(g+h.offset+a*Uint16Array.BYTES_PER_ELEMENT,
m[a]*c,!0);break;case n.DataType.INT:if(1===h.count)d.setInt32(g+h.offset,m*c,!0);else for(a=0;a<h.count;a++)d.setInt32(g+h.offset+a*Int32Array.BYTES_PER_ELEMENT,m[a]*c,!0);break;case n.DataType.UNSIGNED_INT:if(1===h.count)d.setUint32(g+h.offset,m*c,!0);else for(a=0;a<h.count;a++)d.setUint32(g+h.offset+a*Uint32Array.BYTES_PER_ELEMENT,m[a]*c,!0);break;case n.DataType.FLOAT:if(1===h.count)d.setFloat32(g+h.offset,m*c,!0);else for(a=0;a<h.count;a++)d.setFloat32(g+h.offset+a*Float32Array.BYTES_PER_ELEMENT,
m[a]*c,!0);break;case n.DataType.HALF_FLOAT:if(1===h.count)d.setUint16(g+h.offset,q.toUint16(m*c),!0);else for(a=0;a<h.count;a++)d.setUint16(g+h.offset+a*Uint16Array.BYTES_PER_ELEMENT,q.toUint16(m[a]*c),!0)}};l.unpackDataView=function(d,m,h){switch(m.type){case n.DataType.BYTE:if(1===m.count)return d.getInt8(h+m.offset);var g=[];for(var c=0;c<m.count;c++)g.push(d.getInt8(h+m.offset+c*Int8Array.BYTES_PER_ELEMENT));return g;case n.DataType.UNSIGNED_BYTE:if(1===m.count)return d.getUint8(h+m.offset);
g=[];for(c=0;c<m.count;c++)g.push(d.getUint8(h+m.offset+c*Uint8Array.BYTES_PER_ELEMENT));return g;case n.DataType.SHORT:if(1===m.count)return d.getInt16(h+m.offset,!0);g=[];for(c=0;c<m.count;c++)g.push(d.getInt16(h+m.offset+c*Int16Array.BYTES_PER_ELEMENT,!0));return g;case n.DataType.UNSIGNED_SHORT:if(1===m.count)return d.getUint16(h+m.offset,!0);g=[];for(c=0;c<m.count;c++)g.push(d.getUint16(h+m.offset+c*Uint16Array.BYTES_PER_ELEMENT,!0));return g;case n.DataType.INT:if(1===m.count)return d.getInt32(h+
m.offset,!0);g=[];for(c=0;c<m.count;c++)g.push(d.getInt32(h+m.offset+c*Int32Array.BYTES_PER_ELEMENT,!0));return g;case n.DataType.UNSIGNED_INT:if(1===m.count)return d.getUint32(h+m.offset,!0);g=[];for(c=0;c<m.count;c++)g.push(d.getUint32(h+m.offset+c*Uint32Array.BYTES_PER_ELEMENT,!0));return g;case n.DataType.FLOAT:if(1===m.count)return d.getFloat32(h+m.offset,!0);g=[];for(c=0;c<m.count;c++)g.push(d.getFloat32(h+m.offset+c*Float32Array.BYTES_PER_ELEMENT,!0));return g;case n.DataType.HALF_FLOAT:if(1===
m.count)return q.fromUint16(d.getUint16(h+m.offset,!0));g=[];for(c=0;c<m.count;c++)g.push(q.fromUint16(d.getUint16(h+m.offset+c*Uint16Array.BYTES_PER_ELEMENT,!0)));return g}};Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/mesh/meshDebugUtils":function(){define(["exports","../DisplayEntity","../shaderGraph/techniques/mesh/dataViewUtils","../util/Reader","../util/serializationUtils"],function(l,q,n,d,m){function h(g){const c=g.layout.stride,a=new DataView(g.vertices),
b=[],k=g.vertices.byteLength/c;let e=0;for(let r=0;r<k;r++){const f={};for(const p of g.layout.attributes){let t=`${p.offset} ${p.name}`,w=n.unpackDataView(a,p,e);if(p.packPrecisionFactor)if(t+=` (precision: ${p.packPrecisionFactor})`,"number"===typeof w)w/=p.packPrecisionFactor;else for(let z=0;z<w.length;z++)w[z]/=p.packPrecisionFactor;f[t]=w}e+=c;b.push(f)}return{vertices:b,layout:g.layout}}l.debugMeshDataInfo=function(g){if(!g)return null;const c=m.deserializeList(new d(g.entities),q);g=g.data.map(h);
return{entities:c,vertexData:g}};Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/util/Reader":function(){define(function(){class l{constructor(q){this._pos=0;this._buffer=q;this._i32View=new Int32Array(this._buffer);this._f32View=new Float32Array(this._buffer)}readInt32(){return this._i32View[this._pos++]}readF32(){return this._f32View[this._pos++]}}return l})},"esri/views/2d/engine/webgl/shaders/TileInfoPrograms":function(){define(["exports","./sources/resolver"],
function(l,q){q={shaders:{vertexShader:q.resolveIncludes("tileInfo/tileInfo.vert"),fragmentShader:q.resolveIncludes("tileInfo/tileInfo.frag")},attributes:new Map([["a_pos",0]])};l.tileInfo=q;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/brushes/WGLBrushVTLBackground":function(){define("exports ../../../../../core/mathUtils ../../../../../core/libs/gl-matrix-2/factories/mat3f32 ../../../../../core/libs/gl-matrix-2/factories/vec4f32 ../definitions ./WGLBrush ../../../../webgl/BufferObject ../../../../webgl/enums ../../../../webgl/VertexArrayObject".split(" "),
function(l,q,n,d,m,h,g,c,a){class b extends h{constructor(){super(...arguments);this._color=d.fromValues(1,0,0,1);this._patternMatrix=n.create();this._programOptions={id:!1,pattern:!1}}dispose(){this._vao&&(this._vao.dispose(),this._vao=null)}drawMany(k,e){const {context:r,painter:f,requestRender:p,allowDelayedRender:t}=k;this._loadWGLResources(k);const w=k.displayLevel;var z=k.styleLayer,u=z.backgroundMaterial;const y=f.vectorTilesMaterialManager;var A=z.getPaintValue("background-color",w),v=z.getPaintValue("background-opacity",
w);const x=z.getPaintValue("background-pattern",w),C=void 0!==x,B=k.spriteMosaic;let E,D;k=(window.devicePixelRatio|1)>m.vtlHighResCutoff?2:1;const F=this._programOptions;F.pattern=C;u=y.getMaterialProgram(r,u,F);if(t&&null!=p&&!u.compiled)p();else{r.bindVAO(this._vao);r.useProgram(u);if(C){A=B.getMosaicItemPosition(x,!0);if(null!=A){const {tl:G,br:H,page:I}=A;E=H[0]-G[0];D=H[1]-G[1];A=B.getPageSize(I);null!=A&&(B.bind(r,c.TextureSamplingMode.LINEAR,I,m.vtlTextureBindingUnitSprites),u.setUniform4f("u_tlbr",
G[0],G[1],H[0],H[1]),u.setUniform2fv("u_mosaicSize",A),u.setUniform1i("u_texture",m.vtlTextureBindingUnitSprites))}u.setUniform1f("u_opacity",v)}else v*=A[3],this._color[0]=v*A[0],this._color[1]=v*A[1],this._color[2]=v*A[2],this._color[3]=v,u.setUniform4fv("u_color",this._color);u.setUniform1f("u_depth",z.z||0);for(const G of e)u.setUniform1f("u_coord_range",G.rangeX),u.setUniformMatrix3fv("u_dvsMat3",G.transforms.displayViewScreenMat3),C&&(z=k*G.width*Math.max(2**(Math.round(w)-G.key.level),1),e=
z/q.nextPowerOfTwo(E),z/=q.nextPowerOfTwo(D),this._patternMatrix[0]=e,this._patternMatrix[4]=z,u.setUniformMatrix3fv("u_pattern_matrix",this._patternMatrix)),r.setStencilFunction(c.CompareFunction.EQUAL,0,255),r.drawArrays(c.PrimitiveType.TRIANGLE_STRIP,0,4)}}_loadWGLResources(k){if(!this._vao){var {context:e,styleLayer:r}=k;k=r.backgroundMaterial;var f=new Int8Array([0,0,1,0,0,1,1,1]);f=g.BufferObject.createVertex(e,c.Usage.STATIC_DRAW,f);this._vao=new a.VertexArrayObject(e,k.getAttributeLocations(),
k.getLayoutInfo(),new Map([["geometry",f]]))}}}l.WGLBrushVTLBackground=b;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/brushes/WGLBrushVTLCircle":function(){define(["exports","../../vectorTiles/style/StyleDefinition","./WGLBrush","../../../../webgl/enums"],function(l,q,n,d){class m extends n{constructor(){super(...arguments);this._programOptions={id:!1}}dispose(){}drawMany(h,g){const {context:c,displayLevel:a,requiredLevel:b,state:k,painter:e,spriteMosaic:r,
styleLayerUID:f,requestRender:p,allowDelayedRender:t}=h;if(g.some(A=>A.layerData.get(f)?.circleIndexCount??!1)){h=h.styleLayer;var w=h.circleMaterial,z=e.vectorTilesMaterialManager,u=h.getPaintValue("circle-translate",a),y=h.getPaintValue("circle-translate-anchor",a);z=z.getMaterialProgram(c,w,this._programOptions);if(t&&null!=p&&!z.compiled)p();else{c.useProgram(z);z.setUniformMatrix3fv("u_displayMat3",y===q.TranslateAnchor.VIEWPORT?k.displayMat3:k.displayViewMat3);z.setUniform2fv("u_circleTranslation",
u);z.setUniform1f("u_depth",h.z);z.setUniform1f("u_antialiasingWidth",1.2);u=-1;for(const A of g)A.layerData.has(f)&&(A.key.level!==u&&(u=A.key.level,w.setDataUniforms(z,a,h,u,r)),g=A.layerData.get(f),g.circleIndexCount&&(g.prepareForRendering(c),y=g.vao,null!=y&&(c.bindVAO(y),z.setUniformMatrix3fv("u_dvsMat3",A.transforms.displayViewScreenMat3),b!==A.key.level?c.setStencilFunction(d.CompareFunction.EQUAL,A.stencilRef,255):c.setStencilFunction(d.CompareFunction.GREATER,255,255),c.drawElements(d.PrimitiveType.TRIANGLES,
g.circleIndexCount,d.DataType.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*g.circleIndexStart),A.triangleCount+=g.circleIndexCount/3)))}}}}l.WGLBrushVTLCircle=m;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/style/StyleDefinition":function(){define(["exports","../../../../../symbols/cim/enums"],function(l,q){l.StyleLayerType=void 0;(function(d){d[d.BACKGROUND=0]="BACKGROUND";d[d.FILL=1]="FILL";d[d.LINE=2]="LINE";d[d.SYMBOL=3]="SYMBOL";d[d.CIRCLE=4]=
"CIRCLE"})(l.StyleLayerType||(l.StyleLayerType={}));l.Visibility=void 0;(function(d){d[d.VISIBLE=0]="VISIBLE";d[d.NONE=1]="NONE"})(l.Visibility||(l.Visibility={}));l.SymbolPlacement=void 0;(function(d){d[d.POINT=0]="POINT";d[d.LINE=1]="LINE";d[d.LINE_CENTER=2]="LINE_CENTER"})(l.SymbolPlacement||(l.SymbolPlacement={}));l.RotationAlignment=void 0;(function(d){d[d.MAP=0]="MAP";d[d.VIEWPORT=1]="VIEWPORT";d[d.AUTO=2]="AUTO"})(l.RotationAlignment||(l.RotationAlignment={}));l.TextJustification=void 0;(function(d){d[d.AUTO=
0]="AUTO";d[d.LEFT=1]="LEFT";d[d.CENTER=2]="CENTER";d[d.RIGHT=3]="RIGHT"})(l.TextJustification||(l.TextJustification={}));l.SymbolAnchor=void 0;(function(d){d[d.CENTER=0]="CENTER";d[d.LEFT=1]="LEFT";d[d.RIGHT=2]="RIGHT";d[d.TOP=3]="TOP";d[d.BOTTOM=4]="BOTTOM";d[d.TOP_LEFT=5]="TOP_LEFT";d[d.TOP_RIGHT=6]="TOP_RIGHT";d[d.BOTTOM_LEFT=7]="BOTTOM_LEFT";d[d.BOTTOM_RIGHT=8]="BOTTOM_RIGHT"})(l.SymbolAnchor||(l.SymbolAnchor={}));l.TextTransform=void 0;(function(d){d[d.NONE=0]="NONE";d[d.UPPERCASE=1]="UPPERCASE";
d[d.LOWERCASE=2]="LOWERCASE"})(l.TextTransform||(l.TextTransform={}));l.TranslateAnchor=void 0;(function(d){d[d.MAP=0]="MAP";d[d.VIEWPORT=1]="VIEWPORT"})(l.TranslateAnchor||(l.TranslateAnchor={}));l.TextWritingMode=void 0;(function(d){d[d.HORIZONTAL=0]="HORIZONTAL";d[d.VERTICAL=1]="VERTICAL"})(l.TextWritingMode||(l.TextWritingMode={}));class n{}n.backgroundLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:l.Visibility.VISIBLE}};n.fillLayoutDefinition={visibility:{type:"enum",
values:["visible","none"],default:l.Visibility.VISIBLE}};n.lineLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:l.Visibility.VISIBLE},"line-cap":{type:"enum",values:["butt","round","square"],default:q.CapType.BUTT},"line-join":{type:"enum",values:["bevel","round","miter"],default:q.JoinType.MITER},"line-miter-limit":{type:"number",default:2},"line-round-limit":{type:"number",default:1.05}};n.symbolLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:l.Visibility.VISIBLE},
"symbol-avoid-edges":{type:"boolean",default:!1},"symbol-placement":{type:"enum",values:["point","line","line-center"],default:l.SymbolPlacement.POINT},"symbol-sort-key":{type:"number",default:-1},"symbol-spacing":{type:"number",minimum:1,default:250},"icon-allow-overlap":{type:"boolean",default:!1},"icon-anchor":{type:"enum",values:"center left right top bottom top-left top-right bottom-left bottom-right".split(" "),default:l.SymbolAnchor.CENTER},"icon-ignore-placement":{type:"boolean",default:!1},
"icon-image":{type:"string"},"icon-keep-upright":{type:"boolean",default:!1},"icon-offset":{type:"array",value:"number",length:2,default:[0,0]},"icon-optional":{type:"boolean",default:!1},"icon-padding":{type:"number",minimum:0,default:2},"icon-rotate":{type:"number",default:0},"icon-rotation-alignment":{type:"enum",values:["map","viewport","auto"],default:l.RotationAlignment.AUTO},"icon-size":{type:"number",minimum:0,default:1},"text-allow-overlap":{type:"boolean",default:!1},"text-anchor":{type:"enum",
values:"center left right top bottom top-left top-right bottom-left bottom-right".split(" "),default:l.SymbolAnchor.CENTER},"text-field":{type:"string"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"]},"text-ignore-placement":{type:"boolean",default:!1},"text-justify":{type:"enum",values:["auto","left","center","right"],default:l.TextJustification.CENTER},"text-keep-upright":{type:"boolean",default:!0},"text-letter-spacing":{type:"number",default:0},
"text-line-height":{type:"number",default:1.2},"text-max-angle":{type:"number",minimum:0,default:45},"text-max-width":{type:"number",minimum:0,default:10},"text-offset":{type:"array",value:"number",length:2,default:[0,0]},"text-optional":{type:"boolean",default:!1},"text-padding":{type:"number",minimum:0,default:2},"text-rotate":{type:"number",default:0},"text-rotation-alignment":{type:"enum",values:["map","viewport","auto"],default:l.RotationAlignment.AUTO},"text-size":{type:"number",minimum:0,default:16},
"text-transform":{type:"enum",values:["none","uppercase","lowercase"],default:l.TextTransform.NONE},"text-writing-mode":{type:"array",value:"enum",values:["horizontal","vertical"],default:[l.TextWritingMode.HORIZONTAL]}};n.circleLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:l.Visibility.VISIBLE}};n.backgroundPaintDefinition={"background-color":{type:"color",default:[0,0,0,1]},"background-opacity":{type:"number",minimum:0,maximum:1,default:1},"background-pattern":{type:"string"}};
n.fillPaintDefinition={"fill-antialias":{type:"boolean",default:!0},"fill-color":{type:"color",default:[0,0,0,1]},"fill-opacity":{type:"number",minimum:0,maximum:1,default:1},"fill-outline-color":{type:"color",default:[0,0,0,0]},"fill-pattern":{type:"string"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0]},"fill-translate-anchor":{type:"enum",values:["map","viewport"],default:l.TranslateAnchor.MAP}};n.linePaintDefinition={"line-blur":{type:"number",minimum:0,default:0},"line-color":{type:"color",
default:[0,0,0,1]},"line-dasharray":{type:"array",value:"number",default:[]},"line-gap-width":{type:"number",minimum:0,default:0},"line-offset":{type:"number",default:0},"line-opacity":{type:"number",minimum:0,maximum:1,default:1},"line-pattern":{type:"string"},"line-translate":{type:"array",value:"number",length:2,default:[0,0]},"line-translate-anchor":{type:"enum",values:["map","viewport"],default:l.TranslateAnchor.MAP},"line-width":{type:"number",minimum:0,default:1}};n.symbolPaintDefinition={"icon-color":{type:"color",
default:[0,0,0,1]},"icon-halo-blur":{type:"number",minimum:0,default:0},"icon-halo-color":{type:"color",default:[0,0,0,0]},"icon-halo-width":{type:"number",minimum:0,default:0},"icon-opacity":{type:"number",minimum:0,maximum:1,default:1},"icon-translate":{type:"array",value:"number",length:2,default:[0,0]},"icon-translate-anchor":{type:"enum",values:["map","viewport"],default:l.TranslateAnchor.MAP},"text-color":{type:"color",default:[0,0,0,1]},"text-halo-blur":{type:"number",minimum:0,default:0},
"text-halo-color":{type:"color",default:[0,0,0,0]},"text-halo-width":{type:"number",minimum:0,default:0},"text-opacity":{type:"number",minimum:0,maximum:1,default:1},"text-translate":{type:"array",value:"number",length:2,default:[0,0]},"text-translate-anchor":{type:"enum",values:["map","viewport"],default:l.TranslateAnchor.MAP}};n.rasterPaintDefinition={"raster-opacity":{type:"number",minimum:0,maximum:1,default:1},"raster-hue-rotate":{type:"number",default:0},"raster-brightness-min":{type:"number",
minimum:0,maximum:1,default:0},"raster-brightness-max":{type:"number",minimum:0,maximum:1,default:1},"raster-saturation":{type:"number",minimum:-1,maximum:1,default:0},"raster-contrast":{type:"number",minimum:-1,maximum:1,default:0},"raster-fade-duration":{type:"number",minimum:0,default:300}};n.circlePaintDefinition={"circle-blur":{type:"number",minimum:0,default:0},"circle-color":{type:"color",default:[0,0,0,1]},"circle-opacity":{type:"number",minimum:0,maximum:1,default:1},"circle-radius":{type:"number",
minimum:0,default:5},"circle-stroke-color":{type:"color",default:[0,0,0,1]},"circle-stroke-opacity":{type:"number",minimum:0,maximum:1,default:1},"circle-stroke-width":{type:"number",minimum:0,default:0},"circle-translate":{type:"array",value:"number",length:2,default:[0,0]},"circle-translate-anchor":{type:"enum",values:["map","viewport"],default:l.TranslateAnchor.MAP}};l.StyleDefinition=n;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/brushes/WGLBrushVTLFill":function(){define(["exports",
"../../vectorTiles/style/StyleDefinition","../definitions","./WGLBrush","../../../../webgl/enums"],function(l,q,n,d,m){const h=1/65536;class g extends d{constructor(){super(...arguments);this._fillProgramOptions={id:!1,pattern:!1};this._outlineProgramOptions={id:!1}}dispose(){}drawMany(c,a){const {displayLevel:b,renderPass:k,spriteMosaic:e,styleLayerUID:r}=c;var f=!1;for(var p of a)if(p.layerData.has(r)){var t=p.layerData.get(r);if(0<t.fillIndexCount||0<t.outlineIndexCount){f=!0;break}}if(f){f=c.styleLayer;
var w=f.getPaintProperty("fill-pattern");t=(p=void 0!==w)&&w.isDataDriven;if(p&&!t){var z=w.getValue(b);z=e.getMosaicItemPosition(z,!0)}w=!p&&f.getPaintValue("fill-antialias",b);var u=!0,y=1;if(!p){var A=f.getPaintProperty("fill-color"),v=f.getPaintProperty("fill-opacity");A?.isDataDriven||v?.isDataDriven||(y=f.getPaintValue("fill-color",b),y=f.getPaintValue("fill-opacity",b)*y[3],1<=y&&(u=!1))}u&&"opaque"===k||(A=f.getPaintValue("fill-translate",b),v=f.getPaintValue("fill-translate-anchor",b),(u||
"translucent"!==k)&&this._drawFill(c,r,f,a,A,v,p,z,t),z=!f.hasDataDrivenOutlineColor&&f.outlineUsesFillColor&&1>y,w&&"opaque"!==k&&!z&&this._drawOutline(c,r,f,a,A,v))}}_drawFill(c,a,b,k,e,r,f,p,t){if(!f||t||null!=p){var {context:w,displayLevel:z,state:u,painter:y,pixelRatio:A,spriteMosaic:v,requestRender:x,allowDelayedRender:C}=c;c=b.fillMaterial;var B=y.vectorTilesMaterialManager,E=A>n.vtlHighResCutoff?2:1,D=this._fillProgramOptions;D.pattern=f;B=B.getMaterialProgram(w,c,D);if(C&&null!=x&&!B.compiled)x();
else{w.useProgram(B);null!=p&&({page:p}=p,D=v.getPageSize(p),null!=D&&(v.bind(w,m.TextureSamplingMode.LINEAR,p,n.vtlTextureBindingUnitSprites),B.setUniform2fv("u_mosaicSize",D),B.setUniform1i("u_texture",n.vtlTextureBindingUnitSprites)));B.setUniformMatrix3fv("u_displayMat3",r===q.TranslateAnchor.VIEWPORT?u.displayMat3:u.displayViewMat3);B.setUniform2fv("u_fillTranslation",e);B.setUniform1f("u_depth",b.z+h);e=-1;for(const F of k)if(F.layerData.has(a)&&(F.key.level!==e&&(e=F.key.level,c.setDataUniforms(B,
z,b,e,v)),k=F.layerData.get(a),k.fillIndexCount&&(k.prepareForRendering(w),r=k.fillVAO,null!=r))){w.bindVAO(r);B.setUniformMatrix3fv("u_dvsMat3",F.transforms.displayViewScreenMat3);w.setStencilFunction(m.CompareFunction.EQUAL,F.stencilRef,255);f&&B.setUniform1f("u_patternFactor",F.rangeX/(E*F.width*Math.max(2**(Math.round(z)-F.key.level),1)));if(t){r=k.patternMap;if(!r)continue;for(const [G,H]of r)r=v.getPageSize(G),null!=r&&(v.bind(w,m.TextureSamplingMode.LINEAR,G,n.vtlTextureBindingUnitSprites),
B.setUniform2fv("u_mosaicSize",r),B.setUniform1i("u_texture",n.vtlTextureBindingUnitSprites),w.drawElements(m.PrimitiveType.TRIANGLES,H[1],m.DataType.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*H[0]))}else w.drawElements(m.PrimitiveType.TRIANGLES,k.fillIndexCount,m.DataType.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*k.fillIndexStart);F.triangleCount+=k.fillIndexCount/3}}}}_drawOutline(c,a,b,k,e,r){const {context:f,displayLevel:p,state:t,painter:w,pixelRatio:z,spriteMosaic:u,requestRender:y,allowDelayedRender:A}=
c;c=b.outlineMaterial;const v=.75/z,x=w.vectorTilesMaterialManager.getMaterialProgram(f,c,this._outlineProgramOptions);if(A&&null!=y&&!x.compiled)y();else{f.useProgram(x);x.setUniformMatrix3fv("u_displayMat3",r===q.TranslateAnchor.VIEWPORT?t.displayMat3:t.displayViewMat3);x.setUniform2fv("u_fillTranslation",e);x.setUniform1f("u_depth",b.z+h);x.setUniform1f("u_outline_width",v);e=-1;for(const C of k)C.layerData.has(a)&&(C.key.level!==e&&(e=C.key.level,c.setDataUniforms(x,p,b,e,u)),k=C.layerData.get(a),
k.prepareForRendering(f),k.outlineIndexCount&&(r=k.outlineVAO,null!=r&&(f.bindVAO(r),x.setUniformMatrix3fv("u_dvsMat3",C.transforms.displayViewScreenMat3),f.setStencilFunction(m.CompareFunction.EQUAL,C.stencilRef,255),f.drawElements(m.PrimitiveType.TRIANGLES,k.outlineIndexCount,m.DataType.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*k.outlineIndexStart),C.triangleCount+=k.outlineIndexCount/3)))}}}l.WGLBrushVTLFill=g;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/brushes/WGLBrushVTLLine":function(){define(["exports",
"../../vectorTiles/style/StyleDefinition","../definitions","./WGLBrush","../../../../webgl/enums"],function(l,q,n,d,m){class h extends d{constructor(){super(...arguments);this._programOptions={id:!1,pattern:!1,sdf:!1}}dispose(){}drawMany(g,c){const {context:a,displayLevel:b,state:k,painter:e,pixelRatio:r,spriteMosaic:f,styleLayerUID:p,requestRender:t,allowDelayedRender:w}=g;if(c.some(G=>G.layerData.get(p)?.lineIndexCount??!1)){g=g.styleLayer;var z=g.lineMaterial,u=e.vectorTilesMaterialManager,y=g.getPaintValue("line-translate",
b),A=g.getPaintValue("line-translate-anchor",b),v=g.getPaintProperty("line-pattern"),x=void 0!==v,C=x&&v.isDataDriven;if(x&&!C){v=v.getValue(b);var B=f.getMosaicItemPosition(v)}var E;v=!1;if(!x){var D=g.getPaintProperty("line-dasharray");v=(E=void 0!==D)&&D.isDataDriven;E&&!v&&(B=D.getValue(b),B=g.getDashKey(B,g.getLayoutValue("line-cap",b)),B=f.getMosaicItemPosition(B))}D=1/r;var F=this._programOptions;F.pattern=x;F.sdf=E;E=u.getMaterialProgram(a,z,F);if(w&&null!=t&&!E.compiled)t();else{a.useProgram(E);
E.setUniformMatrix3fv("u_displayViewMat3",k.displayViewMat3);E.setUniformMatrix3fv("u_displayMat3",A===q.TranslateAnchor.VIEWPORT?k.displayMat3:k.displayViewMat3);E.setUniform2fv("u_lineTranslation",y);E.setUniform1f("u_depth",g.z);E.setUniform1f("u_antialiasing",D);B&&null!=B&&({page:y}=B,A=f.getPageSize(y),null!=A&&(f.bind(a,m.TextureSamplingMode.LINEAR,y,n.vtlTextureBindingUnitSprites),E.setUniform2fv("u_mosaicSize",A),E.setUniform1i("u_texture",n.vtlTextureBindingUnitSprites)));y=-1;for(const G of c)if(G.layerData.has(p)&&
(G.key.level!==y&&(y=G.key.level,z.setDataUniforms(E,b,g,y,f)),E.setUniform1f("u_zoomFactor",2**(b-y)/r),c=G.layerData.get(p),c.lineIndexCount&&(c.prepareForRendering(a),A=c.vao,null!=A))){a.bindVAO(A);E.setUniformMatrix3fv("u_dvsMat3",G.transforms.displayViewScreenMat3);a.setStencilFunction(m.CompareFunction.EQUAL,G.stencilRef,255);if(C||v){A=c.patternMap;if(!A)continue;for(const [H,I]of A)A=f.getPageSize(H),null!=A&&(f.bind(a,m.TextureSamplingMode.LINEAR,H,n.vtlTextureBindingUnitSprites),E.setUniform2fv("u_mosaicSize",
A),E.setUniform1i("u_texture",n.vtlTextureBindingUnitSprites),a.drawElements(m.PrimitiveType.TRIANGLES,I[1],m.DataType.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*I[0]))}else a.drawElements(m.PrimitiveType.TRIANGLES,c.lineIndexCount,m.DataType.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*c.lineIndexStart);G.triangleCount+=c.lineIndexCount/3}}}}}l.WGLBrushVTLLine=h;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/brushes/WGLBrushVTLSymbol":function(){define("exports ../../../../../core/libs/gl-matrix-2/factories/vec2f32 ../../vectorTiles/decluttering/config ../../vectorTiles/style/StyleDefinition ../definitions ../GeometryUtils ./WGLBrush ../../../../webgl/enums".split(" "),
function(l,q,n,d,m,h,g,c){const a=1/65536;class b extends g{constructor(){super(...arguments);this._iconProgramOptions={id:!1,sdf:!1};this._sdfProgramOptions={id:!1};this._spritesTextureSize=q.create()}dispose(){}drawMany(k,e){const r=k.styleLayer;this._drawIcons(k,r,e);this._drawText(k,r,e)}_drawIcons(k,e,r){const {context:f,displayLevel:p,painter:t,spriteMosaic:w,state:z,styleLayerUID:u,requestRender:y,allowDelayedRender:A}=k,v=e.iconMaterial;var x=t.vectorTilesMaterialManager;let C;var B=!1;for(var E of r)if(E.layerData.has(u)&&
(C=E.layerData.get(u),0<C.iconPerPageElementsMap.size)){B=!0;break}if(B){B=e.getPaintValue("icon-translate",p);E=e.getPaintValue("icon-translate-anchor",p);var D=e.getLayoutValue("icon-rotation-alignment",p);D===d.RotationAlignment.AUTO&&(D=e.getLayoutValue("symbol-placement",p)===d.SymbolPlacement.POINT?d.RotationAlignment.VIEWPORT:d.RotationAlignment.MAP);var F=D===d.RotationAlignment.MAP;F=e.getLayoutValue("icon-keep-upright",p)&&F;var G=this._iconProgramOptions;G.sdf=C.isIconSDF;x=x.getMaterialProgram(f,
v,G);if(A&&null!=y&&!x.compiled)y();else{f.useProgram(x);x.setUniformMatrix3fv("u_displayViewMat3",D===d.RotationAlignment.MAP?z.displayViewMat3:z.displayMat3);x.setUniformMatrix3fv("u_displayMat3",E===d.TranslateAnchor.VIEWPORT?z.displayMat3:z.displayViewMat3);x.setUniform2fv("u_iconTranslation",B);x.setUniform1f("u_depth",e.z);x.setUniform1f("u_mapRotation",h.degToByte(z.rotation));x.setUniform1f("u_keepUpright",F?1:0);x.setUniform1f("u_level",10*p);x.setUniform1i("u_texture",m.vtlTextureBindingUnitSprites);
x.setUniform1f("u_fadeDuration",n.fadeDuration/1E3);B=-1;for(const H of r)if(H.layerData.has(u)&&(H.key.level!==B&&(B=H.key.level,v.setDataUniforms(x,p,e,B,w)),C=H.layerData.get(u),0!==C.iconPerPageElementsMap.size&&(C.prepareForRendering(f),C.updateOpacityInfo(),r=C.iconVAO,null!=r))){f.bindVAO(r);x.setUniformMatrix3fv("u_dvsMat3",H.transforms.displayViewScreenMat3);x.setUniform1f("u_time",(performance.now()-C.lastOpacityUpdate)/1E3);for(const [I,K]of C.iconPerPageElementsMap)this._renderIconRange(k,
x,K,I,H)}}}}_renderIconRange(k,e,r,f,p){const {context:t,spriteMosaic:w}=k;this._spritesTextureSize[0]=w.getWidth(f)/4;this._spritesTextureSize[1]=w.getHeight(f)/4;e.setUniform2fv("u_mosaicSize",this._spritesTextureSize);w.bind(t,c.TextureSamplingMode.LINEAR,f,m.vtlTextureBindingUnitSprites);this._setStencilState(k,p);t.drawElements(c.PrimitiveType.TRIANGLES,r[1],c.DataType.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*r[0]);p.triangleCount+=r[1]/3}_drawText(k,e,r){const {context:f,displayLevel:p,glyphMosaic:t,
painter:w,pixelRatio:z,spriteMosaic:u,state:y,styleLayerUID:A,requestRender:v,allowDelayedRender:x}=k,C=e.textMaterial;var B=w.vectorTilesMaterialManager,E=!1;for(var D of r)if(D.layerData.has(A)){var F=D.layerData.get(A);if(0<F.glyphPerPageElementsMap.size){E=!0;break}}if(E&&(F=e.getPaintProperty("text-opacity"),!F||F.isDataDriven||0!==F.getValue(p))){F=e.getPaintProperty("text-color");var G=!F||F.isDataDriven||0<F.getValue(p)[3];F=e.getPaintProperty("text-halo-width");E=e.getPaintProperty("text-halo-color");
var H=(!F||F.isDataDriven||0<F.getValue(p))&&(!E||E.isDataDriven||0<E.getValue(p)[3]);if(G||H){F=e.getLayoutValue("text-rotation-alignment",p);F===d.RotationAlignment.AUTO&&(F=e.getLayoutValue("symbol-placement",p)===d.SymbolPlacement.POINT?d.RotationAlignment.VIEWPORT:d.RotationAlignment.MAP);E=F===d.RotationAlignment.MAP;E=e.getLayoutValue("text-keep-upright",p)&&E;D=.8*3/z;this._glyphTextureSize||(this._glyphTextureSize=q.fromValues(t.width/4,t.height/4));var I=e.getPaintValue("text-translate",
p),K=e.getPaintValue("text-translate-anchor",p),L=B.getMaterialProgram(f,C,this._sdfProgramOptions);if(x&&null!=v&&!L.compiled)v();else{f.useProgram(L);L.setUniformMatrix3fv("u_displayViewMat3",F===d.RotationAlignment.MAP?y.displayViewMat3:y.displayMat3);L.setUniformMatrix3fv("u_displayMat3",K===d.TranslateAnchor.VIEWPORT?y.displayMat3:y.displayViewMat3);L.setUniform2fv("u_textTranslation",I);L.setUniform1f("u_depth",e.z+a);L.setUniform2fv("u_mosaicSize",this._glyphTextureSize);L.setUniform1f("u_mapRotation",
h.degToByte(y.rotation));L.setUniform1f("u_keepUpright",E?1:0);L.setUniform1f("u_level",10*p);L.setUniform1i("u_texture",m.vtlTextureBindingUnitGlyphs);L.setUniform1f("u_antialiasingWidth",D);L.setUniform1f("u_fadeDuration",n.fadeDuration/1E3);B=-1;for(const R of r)R.layerData.has(A)&&(R.key.level!==B&&(B=R.key.level,C.setDataUniforms(L,p,e,B,u)),F=R.layerData.get(A),0!==F.glyphPerPageElementsMap.size&&(F.prepareForRendering(f),F.updateOpacityInfo(),r=F.textVAO,null!=r&&(f.bindVAO(r),L.setUniformMatrix3fv("u_dvsMat3",
R.transforms.displayViewScreenMat3),this._setStencilState(k,R),r=(performance.now()-F.lastOpacityUpdate)/1E3,L.setUniform1f("u_time",r),F.glyphPerPageElementsMap.forEach((S,W)=>{this._renderGlyphRange(f,S,W,t,L,H,G,R)}))))}}}}_renderGlyphRange(k,e,r,f,p,t,w,z){f.bind(k,c.TextureSamplingMode.LINEAR,r,m.vtlTextureBindingUnitGlyphs);t&&(p.setUniform1f("u_halo",1),k.drawElements(c.PrimitiveType.TRIANGLES,e[1],c.DataType.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*e[0]),z.triangleCount+=e[1]/3);w&&(p.setUniform1f("u_halo",
0),k.drawElements(c.PrimitiveType.TRIANGLES,e[1],c.DataType.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*e[0]),z.triangleCount+=e[1]/3)}_setStencilState(k,e){const {context:r,is3D:f,stencilSymbols:p}=k;r.setStencilTestEnabled(!0);p?(r.setStencilWriteMask(255),r.setStencilFunction(c.CompareFunction.ALWAYS,e.stencilRef,255)):(r.setStencilWriteMask(0),f?r.setStencilFunction(c.CompareFunction.EQUAL,e.stencilRef,255):r.setStencilFunction(c.CompareFunction.GREATER,255,255))}}l.WGLBrushVTLSymbol=b;Object.defineProperty(l,
Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/decluttering/config":function(){define(["exports"],function(l){l.collisionGridCellSize=32;l.declutterBudget=1.5;l.declutterTiles=!0;l.fadeDuration=200;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/GeometryUtils":function(){define(["exports"],function(l){function q(h,g){h%=g;return 0<=h?h:h+g}const n=128/Math.PI,d=256/360,m=1/Math.LN2;l.between=function(h,g,c){return h>=g&&h<=c||
h>=c&&h<=g};l.degToByte=function(h){return q(h*d,256)};l.interpolate=function(h,g,c){return h*(1-c)+g*c};l.log2=function(h){return Math.log(h)*m};l.positiveMod=q;l.radToByte=function(h){return q(h*n,256)};Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/shaders/VTLMaterialManager":function(){define(["../enums","./Programs"],function(l,q){class n{constructor(){this._programByKey=new Map}dispose(){this._programByKey.forEach(d=>d.dispose());this._programByKey.clear()}getMaterialProgram(d,
m,h){const g=m.key<<3|this._getMaterialOptionsValue(m.type,h);if(this._programByKey.has(g))return this._programByKey.get(g);var c=this._getProgramTemplate(m.type);({shaders:c}=c);const {vertexShader:a,fragmentShader:b}=c(h);h=m.getShaderHeader();c=m.getShaderMain();h=a.replace("#pragma header",h).replace("#pragma main",c);d=d.programCache.acquire(h,b,m.getAttributeLocations());this._programByKey.set(g,d);return d}_getMaterialOptionsValue(d,m){switch(d){case l.ShaderProgramType.BACKGROUND:return(m.pattern?
1:0)<<1;case l.ShaderProgramType.FILL:return(m.pattern?1:0)<<1;case l.ShaderProgramType.OUTLINE:return 0;case l.ShaderProgramType.LINE:return(m.sdf?1:0)<<2|(m.pattern?1:0)<<1;case l.ShaderProgramType.ICON:return(m.sdf?1:0)<<1;case l.ShaderProgramType.CIRCLE:return 0;case l.ShaderProgramType.TEXT:return 0;default:return 0}}_getProgramTemplate(d){switch(d){case l.ShaderProgramType.BACKGROUND:return q.background;case l.ShaderProgramType.CIRCLE:return q.circle;case l.ShaderProgramType.FILL:return q.fill;
case l.ShaderProgramType.ICON:return q.icon;case l.ShaderProgramType.LINE:return q.line;case l.ShaderProgramType.OUTLINE:return q.outline;case l.ShaderProgramType.TEXT:return q.text;default:return null}}}return n})},"esri/views/2d/engine/vectorTiles/enums":function(){define(["exports"],function(l){l.BucketType=void 0;(function(q){q[q.FILL=1]="FILL";q[q.LINE=2]="LINE";q[q.SYMBOL=3]="SYMBOL";q[q.CIRCLE=4]="CIRCLE"})(l.BucketType||(l.BucketType={}));l.ShaderProgramType=void 0;(function(q){q[q.BACKGROUND=
0]="BACKGROUND";q[q.FILL=1]="FILL";q[q.OUTLINE=2]="OUTLINE";q[q.LINE=3]="LINE";q[q.ICON=4]="ICON";q[q.CIRCLE=5]="CIRCLE";q[q.TEXT=6]="TEXT";q[q.TILEINFO=7]="TILEINFO"})(l.ShaderProgramType||(l.ShaderProgramType={}));l.StyleUpdateType=void 0;(function(q){q[q.PAINTER_CHANGED=0]="PAINTER_CHANGED";q[q.LAYOUT_CHANGED=1]="LAYOUT_CHANGED";q[q.LAYER_CHANGED=2]="LAYER_CHANGED";q[q.LAYER_REMOVED=3]="LAYER_REMOVED";q[q.SPRITES_CHANGED=4]="SPRITES_CHANGED"})(l.StyleUpdateType||(l.StyleUpdateType={}));Object.defineProperty(l,
Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/shaders/Programs":function(){define(["exports","./sources/resolver","../../../../webgl/programUtils"],function(l,q,n){l.background={shaders:d=>({vertexShader:n.glslifyDefineMap({PATTERN:d.pattern})+q.resolveIncludes("background/background.vert"),fragmentShader:n.glslifyDefineMap({PATTERN:d.pattern})+q.resolveIncludes("background/background.frag")})};l.circle={shaders:d=>({vertexShader:q.resolveIncludes("circle/circle.vert"),
fragmentShader:q.resolveIncludes("circle/circle.frag")})};l.fill={shaders:d=>({vertexShader:n.glslifyDefineMap({PATTERN:d.pattern})+q.resolveIncludes("fill/fill.vert"),fragmentShader:n.glslifyDefineMap({PATTERN:d.pattern})+q.resolveIncludes("fill/fill.frag")})};l.icon={shaders:d=>({vertexShader:n.glslifyDefineMap({SDF:d.sdf})+q.resolveIncludes("icon/icon.vert"),fragmentShader:n.glslifyDefineMap({SDF:d.sdf})+q.resolveIncludes("icon/icon.frag")})};l.line={shaders:d=>({vertexShader:n.glslifyDefineMap({PATTERN:d.pattern,
SDF:d.sdf})+q.resolveIncludes("line/line.vert"),fragmentShader:n.glslifyDefineMap({PATTERN:d.pattern,SDF:d.sdf})+q.resolveIncludes("line/line.frag")})};l.outline={shaders:d=>({vertexShader:q.resolveIncludes("outline/outline.vert"),fragmentShader:q.resolveIncludes("outline/outline.frag")})};l.text={shaders:d=>({vertexShader:q.resolveIncludes("text/text.vert"),fragmentShader:q.resolveIncludes("text/text.frag")})};Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/shaders/sources/resolver":function(){define(["exports",
"./shaderRepository","../../../../../webgl/ShaderCompiler"],function(l,q,n){const d=new n.ShaderCompiler(function(m){let h=q;m.split("/").forEach(g=>{h&&=h[g]});return h});l.resolveIncludes=function(m){return d.resolveIncludes(m)};Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/shaders/sources/shaderRepository":function(){define(function(){return{background:{"background.frag":"#ifdef PATTERN\nuniform lowp float u_opacity;\nuniform lowp sampler2D u_texture;\nvarying mediump vec4 v_tlbr;\nvarying mediump vec2 v_tileTextureCoord;\n#else\nuniform lowp vec4 u_color;\n#endif\nvoid main() {\n#ifdef PATTERN\nmediump vec2 normalizedTextureCoord \x3d mod(v_tileTextureCoord, 1.0);\nmediump vec2 samplePos \x3d mix(v_tlbr.xy, v_tlbr.zw, normalizedTextureCoord);\nlowp vec4 color \x3d texture2D(u_texture, samplePos);\ngl_FragColor \x3d u_opacity * color;\n#else\ngl_FragColor \x3d u_color;\n#endif\n}",
"background.vert":"precision mediump float;\nattribute vec2 a_pos;\nuniform highp mat3 u_dvsMat3;\nuniform mediump float u_coord_range;\nuniform mediump float u_depth;\n#ifdef PATTERN\nuniform mediump mat3 u_pattern_matrix;\nvarying mediump vec2 v_tileTextureCoord;\nuniform mediump vec4 u_tlbr;\nuniform mediump vec2 u_mosaicSize;\nvarying mediump vec4 v_tlbr;\n#endif\nvoid main() {\ngl_Position \x3d vec4((u_dvsMat3 * vec3(u_coord_range * a_pos, 1.0)).xy, u_depth, 1.0);\n#ifdef PATTERN\nv_tileTextureCoord \x3d (u_pattern_matrix * vec3(a_pos, 1.0)).xy;\nv_tlbr             \x3d u_tlbr / u_mosaicSize.xyxy;\n#endif\n}"},
circle:{"circle.frag":"precision lowp float;\nvarying lowp vec4 v_color;\nvarying lowp vec4 v_stroke_color;\nvarying mediump float v_blur;\nvarying mediump float v_stroke_width;\nvarying mediump float v_radius;\nvarying mediump vec2 v_offset;\nvoid main()\n{\nmediump float dist \x3d length(v_offset);\nmediump float alpha \x3d smoothstep(0.0, -v_blur, dist - 1.0);\nlowp float color_mix_ratio \x3d v_stroke_width \x3c 0.01 ? 0.0 : smoothstep(-v_blur, 0.0, dist - v_radius / (v_radius + v_stroke_width));\ngl_FragColor \x3d alpha * mix(v_color, v_stroke_color, color_mix_ratio);\n}",
"circle.vert":"precision mediump float;\nattribute vec2 a_pos;\n#pragma header\nvarying lowp vec4 v_color;\nvarying lowp vec4 v_stroke_color;\nvarying mediump float v_blur;\nvarying mediump float v_stroke_width;\nvarying mediump float v_radius;\nvarying mediump vec2 v_offset;\nuniform highp mat3 u_dvsMat3;\nuniform highp mat3 u_displayMat3;\nuniform mediump vec2 u_circleTranslation;\nuniform mediump float u_depth;\nuniform mediump float u_antialiasingWidth;\nvoid main()\n{\n#pragma main\nv_color \x3d color * opacity;\nv_stroke_color \x3d stroke_color * stroke_opacity;\nv_stroke_width \x3d stroke_width;\nv_radius \x3d radius;\nv_blur \x3d max(blur, u_antialiasingWidth / (radius + stroke_width));\nmediump vec2 offset \x3d vec2(mod(a_pos, 2.0) * 2.0 - 1.0);\nv_offset \x3d offset;\nmediump vec3 pos \x3d u_dvsMat3 * vec3(a_pos * 0.5, 1.0) + u_displayMat3 * vec3((v_radius + v_stroke_width) * offset + u_circleTranslation, 0.0);\ngl_Position \x3d vec4(pos.xy, u_depth, 1.0);\n}"},
fill:{"fill.frag":"precision lowp float;\n#ifdef PATTERN\nuniform lowp sampler2D u_texture;\nvarying mediump vec2 v_tileTextureCoord;\nvarying mediump vec4 v_tlbr;\n#endif\nvarying lowp vec4 v_color;\nvec4 mixColors(vec4 color1, vec4 color2) {\nfloat compositeAlpha \x3d color2.a + color1.a * (1.0 - color2.a);\nvec3 compositeColor \x3d color2.rgb + color1.rgb * (1.0 - color2.a);\nreturn vec4(compositeColor, compositeAlpha);\n}\nvoid main()\n{\n#ifdef PATTERN\nmediump vec2 normalizedTextureCoord \x3d fract(v_tileTextureCoord);\nmediump vec2 samplePos \x3d mix(v_tlbr.xy, v_tlbr.zw, normalizedTextureCoord);\nlowp vec4 color \x3d texture2D(u_texture, samplePos);\ngl_FragColor \x3d v_color[3] * color;\n#else\ngl_FragColor \x3d v_color;\n#endif\n}",
"fill.vert":"precision mediump float;\nattribute vec2 a_pos;\n#pragma header\nuniform highp mat3 u_dvsMat3;\nuniform highp mat3 u_displayMat3;\nuniform mediump float u_depth;\nuniform mediump vec2 u_fillTranslation;\n#ifdef PATTERN\n#include \x3cutil/util.glsl\x3e\nuniform mediump vec2 u_mosaicSize;\nuniform mediump float u_patternFactor;\nvarying mediump vec2 v_tileTextureCoord;\nvarying mediump vec4 v_tlbr;\n#endif\nvarying lowp vec4 v_color;\nvoid main()\n{\n#pragma main\nv_color \x3d color * opacity;\n#ifdef PATTERN\nfloat patternWidth \x3d nextPOT(tlbr.z - tlbr.x);\nfloat patternHeight \x3d nextPOT(tlbr.w - tlbr.y);\nfloat scaleX \x3d 1.0 / (patternWidth * u_patternFactor);\nfloat scaleY \x3d 1.0 / (patternHeight * u_patternFactor);\nmat3 patterMat \x3d mat3(scaleX, 0.0,    0.0,\n0.0,    -scaleY, 0.0,\n0.0,    0.0,    1.0);\nv_tileTextureCoord \x3d (patterMat * vec3(a_pos, 1.0)).xy;\nv_tlbr             \x3d tlbr / u_mosaicSize.xyxy;\n#endif\nvec3 pos \x3d u_dvsMat3 * vec3(a_pos, 1.0) + u_displayMat3 * vec3(u_fillTranslation, 0.0);\ngl_Position \x3d vec4(pos.xy, u_depth, 1.0);\n}"},
icon:{"icon.frag":"precision mediump float;\nuniform lowp sampler2D u_texture;\n#ifdef SDF\nuniform lowp vec4 u_color;\nuniform lowp vec4 u_outlineColor;\n#endif\nvarying mediump vec2 v_tex;\nvarying lowp float v_opacity;\nvarying mediump vec2 v_size;\nvarying lowp vec4 v_color;\n#ifdef SDF\nvarying mediump flaot v_halo_width;\n#endif\n#include \x3cutil/encoding.glsl\x3e\nvec4 mixColors(vec4 color1, vec4 color2) {\nfloat compositeAlpha \x3d color2.a + color1.a * (1.0 - color2.a);\nvec3 compositeColor \x3d color2.rgb + color1.rgb * (1.0 - color2.a);\nreturn vec4(compositeColor, compositeAlpha);\n}\nvoid main()\n{\n#ifdef SDF\nlowp vec4 fillPixelColor \x3d v_color;\nfloat d \x3d rgba2float(texture2D(u_texture, v_tex)) - 0.5;\nconst float softEdgeRatio \x3d 0.248062016;\nfloat size \x3d max(v_size.x, v_size.y);\nfloat dist \x3d d * softEdgeRatio * size;\nfillPixelColor *\x3d clamp(0.5 - dist, 0.0, 1.0);\nif (v_halo_width \x3e 0.25) {\nlowp vec4 outlinePixelColor \x3d u_outlineColor;\nconst float outlineLimitRatio \x3d (16.0 / 86.0);\nfloat clampedOutlineSize \x3d softEdgeRatio * min(v_halo_width, outlineLimitRatio * max(v_size.x, v_size.y));\noutlinePixelColor *\x3d clamp(0.5 - (abs(dist) - clampedOutlineSize), 0.0, 1.0);\ngl_FragColor \x3d v_opacity * mixColors(fillPixelColor, outlinePixelColor);\n}\nelse {\ngl_FragColor \x3d v_opacity * fillPixelColor;\n}\n#else\nlowp vec4 texColor \x3d texture2D(u_texture, v_tex);\ngl_FragColor \x3d v_opacity * texColor;\n#endif\n}",
"icon.vert":"attribute vec2 a_pos;\nattribute vec2 a_vertexOffset;\nattribute vec4 a_texAngleRange;\nattribute vec4 a_levelInfo;\nattribute float a_opacityInfo;\n#pragma header\nvarying lowp vec4 v_color;\n#ifdef SDF\nvarying mediump float v_halo_width;\n#endif\nuniform highp mat3 u_dvsMat3;\nuniform highp mat3 u_displayMat3;\nuniform highp mat3 u_displayViewMat3;\nuniform mediump vec2 u_iconTranslation;\nuniform vec2 u_mosaicSize;\nuniform mediump float u_depth;\nuniform mediump float u_mapRotation;\nuniform mediump float u_level;\nuniform lowp float u_keepUpright;\nuniform mediump float u_fadeDuration;\nvarying mediump vec2 v_tex;\nvarying lowp float v_opacity;\nvarying mediump vec2 v_size;\nconst float C_OFFSET_PRECISION \x3d 1.0 / 8.0;\nconst float C_256_TO_RAD \x3d 3.14159265359 / 128.0;\nconst float C_DEG_TO_RAD \x3d 3.14159265359 / 180.0;\nconst float tileCoordRatio \x3d 1.0 / 8.0;\nuniform highp float u_time;\nvoid main()\n{\n#pragma main\nv_color \x3d color;\nv_opacity \x3d opacity;\n#ifdef SDF\nv_halo_width \x3d halo_width;\n#endif\nfloat modded \x3d mod(a_opacityInfo, 128.0);\nfloat targetOpacity \x3d (a_opacityInfo - modded) / 128.0;\nfloat startOpacity \x3d modded / 127.0;\nfloat interpolatedOpacity \x3d clamp(startOpacity + 2.0 * (targetOpacity - 0.5) * u_time / u_fadeDuration, 0.0, 1.0);\nv_opacity *\x3d interpolatedOpacity;\nmediump float a_angle         \x3d a_levelInfo[1];\nmediump float a_minLevel      \x3d a_levelInfo[2];\nmediump float a_maxLevel      \x3d a_levelInfo[3];\nmediump vec2 a_tex            \x3d a_texAngleRange.xy;\nmediump float delta_z \x3d 0.0;\nmediump float rotated \x3d mod(a_angle + u_mapRotation, 256.0);\ndelta_z +\x3d (1.0 - step(u_keepUpright, 0.0)) * step(64.0, rotated) * (1.0 - step(192.0, rotated));\ndelta_z +\x3d 1.0 - step(a_minLevel, u_level);\ndelta_z +\x3d step(a_maxLevel, u_level);\ndelta_z +\x3d step(v_opacity, 0.0);\nvec2 offset \x3d C_OFFSET_PRECISION * a_vertexOffset;\nv_size \x3d abs(offset);\n#ifdef SDF\noffset \x3d (120.0 / 86.0) * offset;\n#endif\nmediump vec3 pos \x3d u_dvsMat3 * vec3(a_pos, 1.0) + u_displayViewMat3 * vec3(size * offset, 0.0) + u_displayMat3 * vec3(u_iconTranslation, 0.0);\ngl_Position \x3d vec4(pos.xy, u_depth + delta_z, 1.0);\nv_tex \x3d a_tex.xy / u_mosaicSize;\n}"},
line:{"line.frag":"precision lowp float;\nvarying mediump vec2 v_normal;\nvarying highp float v_accumulatedDistance;\nvarying mediump float v_lineHalfWidth;\nvarying lowp vec4 v_color;\nvarying mediump float v_blur;\n#if defined (PATTERN) || defined(SDF)\nvarying mediump vec4 v_tlbr;\nvarying mediump vec2 v_patternSize;\nvarying mediump float v_widthRatio;\nuniform sampler2D u_texture;\nuniform mediump float u_antialiasing;\n#endif\n#ifdef SDF\n#include \x3cutil/encoding.glsl\x3e\n#endif\nvoid main()\n{\nmediump float fragDist \x3d length(v_normal) * v_lineHalfWidth;\nlowp float alpha \x3d clamp((v_lineHalfWidth - fragDist) / v_blur, 0.0, 1.0);\n#ifdef PATTERN\nmediump float relativeTexX \x3d fract(v_accumulatedDistance / (v_patternSize.x * v_widthRatio));\nmediump float relativeTexY \x3d 0.5 + v_normal.y * v_lineHalfWidth / (v_patternSize.y * v_widthRatio);\nmediump vec2 texCoord \x3d mix(v_tlbr.xy, v_tlbr.zw, vec2(relativeTexX, relativeTexY));\nlowp vec4 color \x3d texture2D(u_texture, texCoord);\ngl_FragColor \x3d alpha * v_color[3] * color;\n#elif defined(SDF)\nmediump float relativeTexX \x3d fract((v_accumulatedDistance * 0.5) / (v_patternSize.x * v_widthRatio));\nmediump float relativeTexY \x3d  0.5 + 0.25 * v_normal.y;\nmediump vec2 texCoord \x3d mix(v_tlbr.xy, v_tlbr.zw, vec2(relativeTexX, relativeTexY));\nmediump float d \x3d rgba2float(texture2D(u_texture, texCoord)) - 0.5;\nfloat dist \x3d d * (v_lineHalfWidth + u_antialiasing / 2.0);\ngl_FragColor \x3d alpha * clamp(0.5 - dist, 0.0, 1.0) * v_color;\n#else\ngl_FragColor \x3d alpha * v_color;\n#endif\n}",
"line.vert":"precision mediump float;\nattribute vec2 a_pos;\nattribute vec4 a_extrude_offset;\nattribute vec4 a_dir_normal;\nattribute vec2 a_accumulatedDistance;\n#pragma header\nuniform highp mat3 u_dvsMat3;\nuniform highp mat3 u_displayMat3;\nuniform highp mat3 u_displayViewMat3;\nuniform mediump float u_zoomFactor;\nuniform mediump vec2 u_lineTranslation;\nuniform mediump float u_antialiasing;\nuniform mediump float u_depth;\nvarying mediump vec2 v_normal;\nvarying highp float v_accumulatedDistance;\nconst float scale \x3d 1.0 / 31.0;\nconst mediump float tileCoordRatio \x3d 8.0;\n#if defined (SDF)\nconst mediump float sdfPatternHalfWidth \x3d 15.5;\n#endif\n#if defined (PATTERN) || defined(SDF)\nuniform mediump vec2 u_mosaicSize;\nvarying mediump vec4 v_tlbr;\nvarying mediump vec2 v_patternSize;\nvarying mediump float v_widthRatio;\n#endif\nvarying lowp vec4 v_color;\nvarying mediump float v_lineHalfWidth;\nvarying mediump float v_blur;\nvoid main()\n{\n#pragma main\nv_color \x3d color * opacity;\nv_blur \x3d blur + u_antialiasing;\nv_normal \x3d a_dir_normal.zw * scale;\n#if defined (PATTERN) || defined(SDF)\nv_tlbr          \x3d tlbr / u_mosaicSize.xyxy;\nv_patternSize   \x3d vec2(tlbr.z - tlbr.x, tlbr.y - tlbr.w);\n#if defined (PATTERN)\nv_widthRatio \x3d width / v_patternSize.y;\n#else\nv_widthRatio \x3d width / sdfPatternHalfWidth / 2.0;\n#endif\n#endif\nv_lineHalfWidth \x3d (width + u_antialiasing) * 0.5;\nmediump vec2 dir \x3d a_dir_normal.xy * scale;\nmediump vec2 offset_ \x3d a_extrude_offset.zw * scale * offset;\nmediump vec2 dist \x3d v_lineHalfWidth * scale * a_extrude_offset.xy;\nmediump vec3 pos \x3d u_dvsMat3 * vec3(a_pos + offset_ * tileCoordRatio / u_zoomFactor, 1.0) + u_displayViewMat3 * vec3(dist, 0.0) + u_displayMat3 * vec3(u_lineTranslation, 0.0);\ngl_Position \x3d vec4(pos.xy, u_depth, 1.0);\n#if defined (PATTERN) || defined(SDF)\nv_accumulatedDistance \x3d a_accumulatedDistance.x * u_zoomFactor / tileCoordRatio + dot(dir, dist + offset_);\n#endif\n}"},
outline:{"outline.frag":"varying lowp vec4 v_color;\nvarying mediump vec2 v_normal;\nvoid main()\n{\nlowp float dist \x3d abs(v_normal.y);\nlowp float alpha \x3d smoothstep(1.0, 0.0, dist);\ngl_FragColor \x3d alpha * v_color;\n}","outline.vert":"attribute vec2 a_pos;\nattribute vec2 a_offset;\nattribute vec2 a_xnormal;\n#pragma header\nvarying lowp vec4 v_color;\nuniform highp mat3 u_dvsMat3;\nuniform highp mat3 u_displayMat3;\nuniform mediump vec2 u_fillTranslation;\nuniform mediump float u_depth;\nuniform mediump float u_outline_width;\nvarying lowp vec2 v_normal;\nconst float scale \x3d 1.0 / 15.0;\nvoid main()\n{\n#pragma main\nv_color \x3d color * opacity;\nv_normal \x3d a_xnormal;\nmediump vec2 dist \x3d u_outline_width * scale * a_offset;\nmediump vec3 pos \x3d u_dvsMat3 * vec3(a_pos, 1.0) + u_displayMat3 * vec3(dist + u_fillTranslation, 0.0);\ngl_Position \x3d vec4(pos.xy, u_depth, 1.0);\n}"},
text:{"text.frag":"uniform lowp sampler2D u_texture;\nvarying lowp vec2 v_tex;\nvarying lowp vec4 v_color;\nvarying mediump float v_edgeWidth;\nvarying mediump float v_edgeDistance;\nvoid main()\n{\nlowp float dist \x3d texture2D(u_texture, v_tex).a;\nmediump float alpha \x3d smoothstep(v_edgeDistance - v_edgeWidth, v_edgeDistance + v_edgeWidth, dist);\ngl_FragColor \x3d alpha * v_color;\n}","text.vert":"attribute vec2 a_pos;\nattribute vec2 a_vertexOffset;\nattribute vec4 a_texAngleRange;\nattribute vec4 a_levelInfo;\nattribute float a_opacityInfo;\n#pragma header\nvarying lowp vec4 v_color;\nuniform highp mat3 u_dvsMat3;\nuniform highp mat3 u_displayMat3;\nuniform highp mat3 u_displayViewMat3;\nuniform mediump vec2 u_textTranslation;\nuniform vec2 u_mosaicSize;\nuniform mediump float u_depth;\nuniform mediump float u_mapRotation;\nuniform mediump float u_level;\nuniform lowp float u_keepUpright;\nuniform mediump float u_fadeDuration;\nvarying lowp vec2 v_tex;\nconst float offsetPrecision \x3d 1.0 / 8.0;\nconst mediump float edgePos \x3d 0.75;\nuniform mediump float u_antialiasingWidth;\nvarying mediump float v_edgeDistance;\nvarying mediump float v_edgeWidth;\nuniform lowp float u_halo;\nconst float sdfFontScale \x3d 1.0 / 24.0;\nconst float sdfPixel \x3d 3.0;\nuniform highp float u_time;\nvoid main()\n{\n#pragma main\nif (u_halo \x3e 0.5)\n{\nv_color \x3d halo_color * opacity;\nhalo_width *\x3d sdfPixel;\nhalo_blur *\x3d sdfPixel;\n}\nelse\n{\nv_color \x3d color * opacity;\nhalo_width \x3d 0.0;\nhalo_blur \x3d 0.0;\n}\nfloat modded \x3d mod(a_opacityInfo, 128.0);\nfloat targetOpacity \x3d (a_opacityInfo - modded) / 128.0;\nfloat startOpacity \x3d modded / 127.0;\nfloat interpolatedOpacity \x3d clamp(startOpacity + 2.0 * (targetOpacity - 0.5) * u_time / u_fadeDuration, 0.0, 1.0);\nv_color *\x3d interpolatedOpacity;\nmediump float a_angle       \x3d a_levelInfo[1];\nmediump float a_minLevel    \x3d a_levelInfo[2];\nmediump float a_maxLevel    \x3d a_levelInfo[3];\nmediump vec2 a_tex          \x3d a_texAngleRange.xy;\nmediump float a_visMinAngle    \x3d a_texAngleRange.z;\nmediump float a_visMaxAngle    \x3d a_texAngleRange.w;\nmediump float delta_z \x3d 0.0;\nmediump float angle \x3d mod(a_angle + u_mapRotation, 256.0);\nif (a_visMinAngle \x3c a_visMaxAngle)\n{\ndelta_z +\x3d (1.0 - step(u_keepUpright, 0.0)) * (step(a_visMaxAngle, angle) + (1.0 - step(a_visMinAngle, angle)));\n}\nelse\n{\ndelta_z +\x3d (1.0 - step(u_keepUpright, 0.0)) * (step(a_visMaxAngle, angle) * (1.0 - step(a_visMinAngle, angle)));\n}\ndelta_z +\x3d 1.0 - step(a_minLevel, u_level);\ndelta_z +\x3d step(a_maxLevel, u_level);\ndelta_z +\x3d step(v_color[3], 0.0);\nv_tex \x3d a_tex.xy / u_mosaicSize;\nv_edgeDistance \x3d edgePos - halo_width / size;\nv_edgeWidth \x3d (u_antialiasingWidth + halo_blur) / size;\nmediump vec3 pos \x3d u_dvsMat3 * vec3(a_pos, 1.0) + sdfFontScale * u_displayViewMat3 * vec3(offsetPrecision * size * a_vertexOffset, 0.0) + u_displayMat3 * vec3(u_textTranslation, 0.0);\ngl_Position \x3d vec4(pos.xy, u_depth + delta_z, 1.0);\n}"},
util:{"encoding.glsl":"const vec4 rgba2float_factors \x3d vec4(\n255.0 / (256.0),\n255.0 / (256.0 * 256.0),\n255.0 / (256.0 * 256.0 * 256.0),\n255.0 / (256.0 * 256.0 * 256.0 * 256.0)\n);\nfloat rgba2float(vec4 rgba) {\nreturn dot(rgba, rgba2float_factors);\n}","util.glsl":"float nextPOT(in float x) {\nreturn pow(2.0, ceil(log2(abs(x))));\n}"}}})},"esri/views/2d/engine/webgl/BitBlitRenderer":function(){define("exports ../../../../core/maybe ./DefaultVertexAttributeLayouts ./shaders/BitBlitPrograms ../../../webgl/BufferObject ../../../webgl/enums ../../../webgl/ProgramTemplate ../../../webgl/VertexArrayObject".split(" "),
function(l,q,n,d,m,h,g,c){class a{constructor(){this._initialized=!1}dispose(){this._program=q.disposeMaybe(this._program);this._vertexArrayObject=q.disposeMaybe(this._vertexArrayObject)}render(b,k,e,r){b&&(this._initialized||this._initialize(b),b.setBlendFunctionSeparate(h.BlendFactor.ONE,h.BlendFactor.ONE_MINUS_SRC_ALPHA,h.BlendFactor.ONE,h.BlendFactor.ONE_MINUS_SRC_ALPHA),b.bindVAO(this._vertexArrayObject),b.useProgram(this._program),k.setSamplingMode(e),b.bindTexture(k,0),this._program.setUniform1i("u_tex",
0),this._program.setUniform1f("u_opacity",r),b.drawArrays(h.PrimitiveType.TRIANGLE_STRIP,0,4),b.bindTexture(null,0),b.bindVAO())}_initialize(b){if(this._initialized)return!0;const k=g.createProgram(b,d.bitBlit);if(!k)return!1;const e=new Int8Array(16);e[0]=-1;e[1]=-1;e[2]=0;e[3]=0;e[4]=1;e[5]=-1;e[6]=1;e[7]=0;e[8]=-1;e[9]=1;e[10]=0;e[11]=1;e[12]=1;e[13]=1;e[14]=1;e[15]=1;b=new c.VertexArrayObject(b,d.bitBlit.attributes,n.PosTex2b,new Map([["geometry",m.BufferObject.createVertex(b,h.Usage.STATIC_DRAW,
e)]]));this._program=k;this._vertexArrayObject=b;return this._initialized=!0}}l.BitBlitRenderer=a;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaders/BitBlitPrograms":function(){define(["exports","./sources/resolver"],function(l,q){q={shaders:{vertexShader:q.resolveIncludes("bitBlit/bitBlit.vert"),fragmentShader:q.resolveIncludes("bitBlit/bitBlit.frag")},attributes:new Map([["a_pos",0],["a_tex",1]])};l.bitBlit=q;Object.defineProperty(l,Symbol.toStringTag,
{value:"Module"})})},"esri/views/2d/engine/webgl/MaterialManager":function(){define(["./shaders/MaterialPrograms"],function(l){class q{constructor(n){this._rctx=n;this._programByKey=new Map}dispose(){this._programByKey.forEach(n=>n.dispose());this._programByKey.clear()}getProgram(n,d=[]){const m=n.vsPath+"."+n.fsPath+JSON.stringify(d);if(this._programByKey.has(m))return this._programByKey.get(m);d={...d.map(a=>"string"===typeof a?{name:a,value:!0}:a).reduce((a,b)=>({...a,[b.name]:b.value}),{})};const {vsPath:h,
fsPath:g,attributes:c}=n;n=l.createProgramTemplate(h,g,c,d);n=this._rctx.programCache.acquire(n.shaders.vertexShader,n.shaders.fragmentShader,n.attributes);if(!n)throw Error("Unable to get program for key: ${key}");this._programByKey.set(m,n);return n}}return q})},"esri/views/2d/engine/webgl/shaders/MaterialPrograms":function(){define(["exports","./sources/resolver","../../../../webgl/programUtils"],function(l,q,n){l.createProgramTemplate=(d,m,h,g)=>{d+=d.slice(Math.max(0,d.lastIndexOf("/")));m+=
m.slice(Math.max(0,m.lastIndexOf("/")));const c={};for(const b in g){let k=void 0;var a=b;k=""+a[0].toUpperCase();for(let e=1;e<a.length;e++){const r=a[e];r===r.toUpperCase()?(k+="_",k+=r):k+=r.toUpperCase()}c[k]=g[b]}g=n.glslifyDefineMap(c);return{attributes:h,shaders:{vertexShader:g+q.resolveIncludes(`${d}.vert`),fragmentShader:g+q.resolveIncludes(`${m}.frag`)}}};Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/TextureManager":function(){define("../../../../config ../../../../request ../../../../core/BidiText ../../../../core/Error ../../../../core/fontUtils ../../../../core/has ../../../../core/Logger ../../../../core/promiseUtils ../../../../core/screenUtils ../../../../core/string ../../../../symbols/cim/CIMResourceManager ../../../../symbols/cim/CIMSymbolHelper ../../../../symbols/cim/Rasterizer ../../../../symbols/cim/utils ./definitions ./enums ./GlyphMosaic ./GlyphSource ./Rect ./SDFConverter ./SpriteMosaic ./Utils ./animatedFormats/AnimatableTextureResource ./animations/store/AnimationStore ../../../support/QueueProcessor ../../../webgl/enums".split(" "),
function(l,q,n,d,m,h,g,c,a,b,k,e,r,f,p,t,w,z,u,y,A,v,x,C,B,E){function D(I){switch(I.type){case "CIMVectorMarker":case "CIMPictureMarker":return I&&"markerPlacement"in I&&I.markerPlacement&&"CIMMarkerPlacementInsidePolygon"===I.markerPlacement.type;default:return!0}}const F=(I,K,L)=>g.getLogger("esri.views.2d.engine.webgl.TextureManager").error(new d(I,K,L));class G{static fromMosaic(I,K){return new G(I,K.page,K.sdf)}constructor(I,K,L){this.mosaicType=I;this.page=K;this.sdf=L}}class H{constructor(I){this._requestRender=
I;this._resourceManager=new k;this._invalidFontsMap=new Map;this._sdfConverter=new y(p.svgSdfTextureInnerSize);this._bindingInfos=[];this._hashToBindingIndex=new Map;this._ongoingRasterizations=new Map;this._imageRequestQueue=new B.QueueProcessor({concurrency:10,process:async(K,L)=>{c.throwIfAborted(L);try{return await q(K,{responseType:"image",signal:L})}catch(R){if(!c.isAbortError(R))throw new d("mapview-invalid-resource",`Could not fetch requested resource at ${K}`,R);throw R;}}});this.animationStore=
new C.AnimationStore;this._spriteMosaic=new A(2048,2048,500);this._glyphSource=new z(`${l.fontsUrl}/{fontstack}/{range}.pbf`);this._glyphMosaic=new w(1024,1024,this._glyphSource);this._rasterizer=new r(this.resourceManager)}dispose(){this._spriteMosaic.dispose();this._glyphMosaic.dispose();this._rasterizer.dispose();this._sdfConverter.dispose();this._sdfConverter=this._glyphMosaic=this._spriteMosaic=null;this._hashToBindingIndex.clear();this._bindingInfos=this._hashToBindingIndex=null;this._ongoingRasterizations.clear();
this._ongoingRasterizations=null;this._imageRequestQueue.clear();this._imageRequestQueue=null;this._resourceManager.destroy();this.animationStore.destroy()}get sprites(){return this._spriteMosaic}get glyphs(){return this._glyphMosaic}get resourceManager(){return this._resourceManager}async rasterizeItem(I,K){if(null==I)return F("mapview-null-resource","Unable to rasterize null resource"),null;if("animation-info"===I.type){var {resource:L}=I;K=this.animationStore.add(L);({location:K}=K);return{rect:new u(K.column,
K.row,L.length,1),page:K.page,type:"sprite",width:L.length,height:1,rasterizationScale:1,sdfPaddingRatio:.5,sdfDecodeCoeff:1,simplePattern:!1}}if("cim-rasterization-info"!==I.type)return F("mapview-unexpected-resource","Unable to rasterize resource"),null;({resource:I}=I);if("text"===I.type){K=await this._rasterizeText(I,K);for(L of K.glyphs)this._setTextureBinding(t.MosaicType.GLYPH,L);return K}(L=await this._rasterizeSprite(I,K))&&this._setTextureBinding(t.MosaicType.SPRITE,L);return L}getMosaicInfo(I,
K,L=!1){I=this._getTextureBindingInfo(I,K,L);return I?{size:I.size,texture:{texture:I.texture,unit:"sprite"===I.type?p.textureBindingSpriteAtlas:p.textureBindingGlyphAtlas}}:(F("mapview-invalid-resource",`Unable to find resource for ${K}`),{size:[0,0],texture:{texture:null,unit:0}})}_getTextureBindingInfo(I,K,L){var R=this._bindingInfos[K-1];K=R.page;L=L?E.TextureSamplingMode.LINEAR_MIPMAP_LINEAR:E.TextureSamplingMode.LINEAR;switch(R.mosaicType){case t.MosaicType.SPRITE:R=this.sprites.getWidth(K);
var S=this.sprites.getHeight(K);R=[R,S];I=this._spriteMosaic.getTexture(I,K);I.setSamplingMode(L);return{type:"sprite",texture:I,size:R};case t.MosaicType.GLYPH:return R=[this.glyphs.width,this.glyphs.height],S=this._glyphMosaic.getTexture(I,K),this._glyphMosaic.bind(I,L,K,p.textureBindingGlyphAtlas),S.setSamplingMode(L),{type:"glyph",texture:S,size:R};default:return F("mapview-texture-manager",`Cannot handle unknown type ${R.mosaicType}`),null}}_hashMosaic(I,K){return 1|I<<1|(K.sdf?1:0)<<2|K.page<<
3}_setTextureBinding(I,K){const L=this._hashMosaic(I,K);this._hashToBindingIndex.has(L)||(I=G.fromMosaic(I,K),this._hashToBindingIndex.set(L,this._bindingInfos.length+1),this._bindingInfos.push(I));K.textureBinding=this._hashToBindingIndex.get(L)}async _rasterizeText(I,K){const {font:L,textString:R}=I;I=m.getFullyQualifiedFontName(L);var S=this._invalidFontsMap.has(I);const [W,J]=n.bidiText(R),O=v.charCodes(W);try{return S=S?"arial-unicode-ms-regular":I,h("esri-2d-stabilize-glyphs")&&await this._glyphMosaic.preloadASCIIGlyphCache(S),
{type:"glyphs",glyphs:await this._glyphMosaic.getGlyphItems(S,O,K),isRightToLeft:J}}catch(T){return F("mapview-invalid-resource",`Couldn't find font ${I}. Falling back to Arial Unicode MS Regular`),this._invalidFontsMap.set(I,!0),{type:"glyphs",glyphs:await this._glyphMosaic.getGlyphItems("arial-unicode-ms-regular",O,K),isRightToLeft:J}}}_hashSpriteResource(I){switch(I.type){case "path":return`path:${I.path}.${I.asFill?1:0}`;case "CIMPictureMarker":return`${I.type}:${I.url}:${I.size}`;case "CIMPictureFill":return`${I.type}:${I.url}:${I.height}`;
case "CIMPictureStroke":return`${I.type}:${I.url}:${I.width}`;case "dash":return`dash:${I.capStyle}.${f.normalizeDashTemplate(I.dashTemplate).join("")}`;case "sdf":return`sdf:${JSON.stringify(I.geom)}.${I.asFill?1:0}`;case "fill-style":return`fill_style:${I.style}`;case "animated":return JSON.stringify(v.discardUrlIfHasUrlHash(I));case "CIMHatchFill":return JSON.stringify(I);case "CIMVectorMarker":return JSON.stringify(I)}}async _rasterizeSprite(I,K){if(!I)return null;const L=b.numericHash(this._hashSpriteResource(I));
if(this._spriteMosaic.has(L))return this._spriteMosaic.getSpriteItem(L);if("url"in I&&I.url||"CIMPictureFill"===I.type||"CIMPictureStroke"===I.type||"CIMPictureMarker"===I.type||"CIMVectorMarker"===I.type){const R=[];e.CIMSymbolHelper.fetchResources({type:"CIMPointSymbol",symbolLayers:[I]},this._resourceManager,R);0<R.length&&await Promise.all(R)}switch(I.type){case "CIMPictureMarker":return"CIMMarkerPlacementInsidePolygon"===I.markerPlacement?.type?this._rasterizeJSONResource(L,I):this._handleAsyncResource(L,
I,K);case "animated":return this._handleAsyncResource(L,I,K);case "CIMPictureFill":case "CIMPictureStroke":case "path":return this._handleAsyncResource(L,I,K);case "sdf":case "dash":case "fill-style":case "CIMVectorMarker":case "CIMHatchFill":return this._rasterizeJSONResource(L,I)}}_rasterizeJSONResource(I,K){const L=this._rasterizer.rasterizeJSONResource(K);if(L){const {size:R,image:S,sdf:W,simplePattern:J,rasterizationScale:O,sdfPaddingRatio:T,sdfDecodeCoeff:X}=L;return this._addItemToMosaic(I,
R,{type:"static",data:S},D(K),W,J,O,T,X)}return null}async _handleAsyncResource(I,K,L){if(this._ongoingRasterizations.has(I))return this._ongoingRasterizations.get(I);K="path"===K.type?this._handleSVG(K,I,L):this._handleImage(K,I,L);this._ongoingRasterizations.set(I,K);K.finally(()=>this._ongoingRasterizations.delete(I));return K}async _handleSVG(I,K,L){const R=[p.svgSdfTextureInnerSize,p.svgSdfTextureInnerSize],{asFill:S}=I;I=await this._sdfConverter.draw(I.path,S,L);return this._addItemToMosaic(K,
R,{type:"static",data:new Uint32Array(I.buffer)},!1,!0,!0)}async _handleGIFOrPNG(I,K,L){const R=this.resourceManager.getResource(I.url);if(null==R)return null;const {width:S,height:W}=R;if(R instanceof HTMLImageElement){if("animated"===I.type)return F("mapview-unexpected-resource","Attempt to configure animations for a non-animated image."),null;const {size:O,sdf:T,image:X}=this._rasterizer.rasterizeImageResource(S,W,R,"colorSubstitutions"in I?I.colorSubstitutions:void 0);return this._addItemToMosaic(K,
O,{type:"static",data:X},D(I),T,!1)}let J;"animated"===I.type?(L=!1,J={type:"CIMAnimatedSymbolProperties",playAnimation:I.playAnimation,reverseAnimation:I.reverseAnimation,randomizeStartTime:I.randomizeStartTime,randomizeStartSeed:I.randomizeStartSeed,startTimeOffset:I.startTimeOffset,duration:I.duration,repeatType:I.repeatType,repeatDelay:I.repeatDelay},I=I.startGroup||0):(L=D(I),J={type:"CIMAnimatedSymbolProperties"},I=0);I=new x.AnimatableTextureResource(R,this._requestRender,J,I);return this._addItemToMosaic(K,
[I.width,I.height],{type:"animated",data:I},L,!1,!1)}async _handleImage(I,K,L){const R=I.url;var S;(S=R&&(R.includes(".gif")||null!=R&&R.startsWith("data:image/gif")))||(S=R&&(R.includes(".png")||null!=R&&R.startsWith("data:image/png")));if(S)return this._handleGIFOrPNG(I,K,L);if("animated"===I.type)return F("mapview-unexpected-resource","Attempt to configure animations for a non-animated image."),null;try{let W;const J=this.resourceManager.getResource(R);if(null!=J&&J instanceof HTMLImageElement)W=
J;else{const {data:U}=await this._imageRequestQueue.push(R,{...L});W=U}v.isSVGImage(R)&&("width"in I&&"height"in I?(W.width=a.pt2px(I.width),W.height=a.pt2px(I.height)):"cim"in I&&(W.width=a.pt2px(I.width??I.scaleX*I.size),W.height=a.pt2px(I.size)));if(!W.width||!W.height)return null;const {size:O,sdf:T,image:X}=this._rasterizer.rasterizeImageResource(W.width,W.height,W,"colorSubstitutions"in I?I.colorSubstitutions:void 0);return this._addItemToMosaic(K,O,{type:"static",data:X},D(I),T,!1)}catch(W){if(!c.isAbortError(W))throw new d("mapview-invalid-resource",
`Could not fetch requested resource at ${R}. ${W.message}`);throw W;}}_addItemToMosaic(I,K,L,R,S,W,J,O,T){return this._spriteMosaic.addSpriteItem(I,K,L,R,S,W,J,O,T)}}return H})},"esri/symbols/cim/CIMResourceManager":function(){define(["../../core/fontUtils","../../core/imageUtils"],function(l,q){class n{constructor(){this._resourceMap=new Map;this._inFlightResourceMap=new Map;this.geometryEnginePromise=this.geometryEngine=null}destroy(){this._inFlightResourceMap.clear();this._resourceMap.clear()}getResource(d){return this._resourceMap.get(d)??
null}async fetchResource(d,m){var h=this._resourceMap.get(d);if(h)return{width:h.width,height:h.height};if(h=this._inFlightResourceMap.get(d))return h.then(g=>({width:g.width,height:g.height}));h=q.getImageData(d,m);this._inFlightResourceMap.set(d,h);return h.then(g=>{this._inFlightResourceMap.delete(d);this._resourceMap.set(d,g);return{width:g.width,height:g.height}},()=>({width:0,height:0}))}deleteResource(d){this._inFlightResourceMap.delete(d);this._resourceMap.delete(d)}loadFont(d){return l.loadFont(d)}}
return n})},"esri/symbols/cim/Rasterizer":function(){define("./CIMSymbolHelper ./rasterizingUtils ./Rect ./SDFHelper ./utils ../../views/2d/engine/webgl/definitions".split(" "),function(l,q,n,d,m,h){function g(a){if(!a)return null;const {data:b,width:k,height:e,sdfPaddingRatio:r,sdfDecodeCoeff:f}=d.buildSDF(a);return b?{size:[k,e],image:new Uint32Array(b.buffer),sdf:!0,simplePattern:!0,sdfPaddingRatio:r,sdfDecodeCoeff:f,anchorX:0,anchorY:0}:null}class c{constructor(a){this._resourceManager=a;this._cachedRasterizationCanvas=
null}dispose(){this._cachedRasterizationCanvas=null}get _canvas(){this._cachedRasterizationCanvas||(this._cachedRasterizationCanvas=document.createElement("canvas"));return this._cachedRasterizationCanvas}rasterizeJSONResource(a){switch(a.type){case "dash":a=m.normalizeDashTemplate(a.dashTemplate);const [b,k,e]=q.rasterizeDash1D(a);return{size:[k,e],image:new Uint32Array(b.buffer),sdf:!0,simplePattern:!0,anchorX:0,anchorY:0};case "fill-style":const [r,f,p,t]=q.rasterizeFillStyle(this._canvas,a,h.patternFillRasterizationScale);
return{size:[f,p],image:new Uint32Array(r.buffer),sdf:!1,simplePattern:!0,anchorX:0,anchorY:0,rasterizationScale:t};case "sdf":return g(a);case "CIMHatchFill":case "CIMVectorMarker":case "CIMPictureMarker":return this._rasterizeCIMJSONResource(a)}}_rasterizeCIMJSONResource(a){switch(a.type){case "CIMHatchFill":return a=l.CIMSymbolHelper.fromCIMHatchFill(a,h.patternFillRasterizationScale),this._rasterizeCIMVectorMarker(a);case "CIMPictureMarker":return a=l.CIMSymbolHelper.fromCIMInsidePolygon(a),this._rasterizeCIMVectorMarker(a);
case "CIMVectorMarker":if("CIMMarkerPlacementInsidePolygon"===a.markerPlacement?.type)return a=l.CIMSymbolHelper.fromCIMInsidePolygon(a),this._rasterizeCIMVectorMarker(a);const b=d.getSDFInfo(a);return b&&!a.avoidSDFRasterization?g(b):this._rasterizeCIMVectorMarker(a,!1,h.rasterizedVectorMarkerMinSize)}}_rasterizeCIMVectorMarker(a,b=!0,k){b=b?n.fromExtent(a.frame):null;const [e,r,f,p,t]=l.CIMSymbolHelper.rasterize(this._canvas,a,b,this._resourceManager,!0,k);return e?{size:[r,f],image:new Uint32Array(e.buffer),
sdf:!1,simplePattern:!1,anchorX:p,anchorY:t}:null}rasterizeImageResource(a,b,k,e){this._canvas.width=a;this._canvas.height=b;var r=this._canvas.getContext("2d",{willReadFrequently:!0});k instanceof ImageData?r.putImageData(k,0,0):(k.setAttribute("width",`${a}px`),k.setAttribute("height",`${b}px`),r.drawImage(k,0,0,a,b));k=r.getImageData(0,0,a,b);k=new Uint8Array(k.data);if(e)for(var f of e)if(f&&f.oldColor&&4===f.oldColor.length&&f.newColor&&4===f.newColor.length){const [p,t,w,z]=f.oldColor,[u,y,
A,v]=f.newColor;if(p!==u||t!==y||w!==A||z!==v)for(e=0;e<k.length;e+=4)p===k[e]&&t===k[e+1]&&w===k[e+2]&&z===k[e+3]&&(k[e]=u,k[e+1]=y,k[e+2]=A,k[e+3]=v)}for(e=0;e<k.length;e+=4)f=k[e+3]/255,k[e]*=f,k[e+1]*=f,k[e+2]*=f;r=k;f=a;e=b;if(512<=f||512<=e){r=f/e;1<r?(f=512,e=Math.round(512/r)):(e=512,f=Math.round(512*r));r=new Uint8Array(4*f*e);const p=new Uint8ClampedArray(r.buffer);m.resampleHermite(k,a,b,p,f,e,!1)}return{size:[f,e],image:new Uint32Array(r.buffer),sdf:!1,simplePattern:!1,anchorX:0,anchorY:0}}}
return c})},"esri/symbols/cim/rasterizingUtils":function(){define(["exports","../../core/floatRGBA","../../core/mathUtils","./constants"],function(l,q,n,d){l.rasterizeDash=function(m,h){null==m&&(m=[]);var g="Butt"===h,c="Square"===h;h=!g&&!c;1===m.length%2&&(m=[...m,...m]);const a=d.dashRadius,b=2*a;var k=0;for(var e of m)k+=e;e=Math.round(k*a);k=new Float32Array(e*b);const r=.5*a;let f=0,p=0,t=.5,w=!0;for(var z of m){f=p;for(p+=z*a;t<=p;){for(m=.5;m<b;){const u=h?(m-a)*(m-a):Math.abs(m-a);k[(m-
.5)*e+t-.5]=w?g?Math.max(Math.max(f+r-t,u),Math.max(t-p+r,u)):u:h?Math.min((t-f)*(t-f)+u,(t-p)*(t-p)+u):c?Math.min(Math.max(t-f,u),Math.max(p-t,u)):Math.min(Math.max(t-f+r,u),Math.max(p+r-t,u));m++}t++}w=!w}g=k.length;z=new Uint8Array(4*g);for(c=0;c<g;++c)q.packFloatRGBA((h?Math.sqrt(k[c]):k[c])/a,z,4*c);return[z,e,b]};l.rasterizeDash1D=function(m){1===m.length%2&&(m=[...m,...m]);var h=m.reduce((r,f)=>r+f,0);h=Math.round(h*d.dashSdfRasterizationScale);const g=new Float32Array(1*h);var c=0;let a=0,
b=.5,k=!0;for(var e of m){c=a;for(a+=e*d.dashSdfRasterizationScale;b<=a;)m=Math.min(Math.abs(b-c),Math.abs(b-a)),g[b-.5]=k?-m:m,b++;k=!k}e=g.length;m=new Uint8Array(4*e);for(c=0;c<e;++c)q.packFloatRGBA(g[c]/d.dashSdfRasterizationScale/d.dashSdfDistanceNormalization*.5+.5,m,4*c);return[m,h,1]};l.rasterizeFillStyle=function(m,h,g){h=h.style;g=n.nextPowerOfTwo(Math.ceil(g));var c="vertical"===h||"horizontal"===h||"cross"===h||"esriSFSCross"===h||"esriSFSVertical"===h||"esriSFSHorizontal"===h?8*g:16*
g,a=2*g;m.width=c;m.height=c;const b=m.getContext("2d");b.strokeStyle="#ffffff";b.lineWidth=g;b.beginPath();if("vertical"===h||"cross"===h||"esriSFSCross"===h||"esriSFSVertical"===h)b.moveTo(c/2,-a),b.lineTo(c/2,c+a);if("horizontal"===h||"cross"===h||"esriSFSCross"===h||"esriSFSHorizontal"===h)b.moveTo(-a,c/2),b.lineTo(c+a,c/2);if("backward-diagonal"===h||"diagonal-cross"===h||"esriSFSDiagonalCross"===h||"esriSFSBackwardDiagonal"===h)b.moveTo(-a,-a),b.lineTo(c+a,c+a),b.moveTo(c-a,-a),b.lineTo(c+a,
a),b.moveTo(-a,c-a),b.lineTo(a,c+a);if("forward-diagonal"===h||"diagonal-cross"===h||"esriSFSForwardDiagonal"===h||"esriSFSDiagonalCross"===h)b.moveTo(c+a,-a),b.lineTo(-a,c+a),b.moveTo(a,-a),b.lineTo(-a,a),b.moveTo(c+a,c-a),b.lineTo(c-a,c+a);b.stroke();h=b.getImageData(0,0,m.width,m.height);h=new Uint8Array(h.data);for(a=0;a<h.length;a+=4)c=h[a+3]/255,h[a]*=c,h[a+1]*=c,h[a+2]*=c;return[h,m.width,m.height,g]};Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/constants":function(){define(["exports"],
function(l){l.dashRadius=15.5;l.dashSdfDistanceNormalization=64;l.dashSdfRasterizationScale=4;l.maxTileCoordValue=1024;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/GlyphMosaic":function(){define("../../../../core/has ../../../../core/promiseUtils ./Rect ./RectangleBinPack ../../../webgl/enums ../../../webgl/Texture ../../../webgl/TextureDescriptor".split(" "),function(l,q,n,d,m,h,g){function c(k){const e=new Set;for(const r of k)e.add(Math.floor(r/256));
return e}function a(k,e,r){k.has(e)||k.set(e,r().then(()=>{k.delete(e)}).catch(f=>{k.delete(e);q.throwIfNotAbortError(f)}));return k.get(e)}class b{constructor(k,e,r){this.height=this.width=0;this._dirties=[];this._glyphData=[];this._currentPage=0;this._glyphCache={};this._textures=[];this._rangePromises=new Map;this._preloadCache={};this.width=k;this.height=e;this._glyphSource=r;this._binPack=new d(k-4,e-4);this._glyphData.push(new Uint8Array(k*e));this._dirties.push(!0);this._textures.push(null);
this._initDecorationGlyphs()}dispose(){this._binPack=null;for(const k of this._textures)k&&k.dispose();this._textures.length=0;this._glyphData.length=0}_initDecorationGlyphs(){var k=[117,149,181,207,207,181,149,117];const e=[];var r=[];for(let f=0;f<k.length;f++){const p=k[f];for(let t=0;11>t;t++){const w=3<=f&&5>f&&3<=t&&8>t?255:0;e.push(p);r.push(w)}}k={metrics:{width:5,height:2,left:0,top:0,advance:0},bitmap:new Uint8Array(e)};r={metrics:{width:5,height:2,left:0,top:0,advance:0},bitmap:new Uint8Array(r)};
this._recordGlyph(k);this._recordGlyph(r)}getTexture(k,e){if(!this._textures[e]){const r=new g.TextureDescriptor;r.pixelFormat=m.PixelFormat.ALPHA;r.wrapMode=m.TextureWrapMode.CLAMP_TO_EDGE;r.width=this.width;r.height=this.height;this._textures[e]=new h.Texture(k,r,new Uint8Array(this.width*this.height))}this._dirties[e]&&(this._textures[e].setData(this._glyphData[e]),this._dirties[e]=!1);return this._textures[e]}async getGlyphItems(k,e,r){const f=this._getGlyphCache(k);await this._fetchRanges(k,
e,r);return e.map(p=>this._getMosaicItem(f,k,p))}bind(k,e,r,f){r=this.getTexture(k,r);r.setSamplingMode(e);k.bindTexture(r,f)}preloadASCIIGlyphCache(k){var e=this._preloadCache[k];if(null!=e)return e;e=this._glyphSource.preloadASCIIRange(k).then(()=>{const r=this._getGlyphCache(k);for(let f=0;256>f;f++)this._getMosaicItem(r,k,f)});return this._preloadCache[k]=e}_getGlyphCache(k){this._glyphCache[k]||(this._glyphCache[k]={});return this._glyphCache[k]}_invalidate(){this._dirties[this._currentPage]=
!0}async _fetchRanges(k,e,r){const f=[];c(e).forEach(p=>{f.push(this._fetchRange(k,p,r))});await Promise.all(f)}async _fetchRange(k,e,r){if(!(256<e))return a(this._rangePromises,k+e,()=>this._glyphSource.getRange(k,e,r))}_getMosaicItem(k,e,r){if(!k[r]){e=this._glyphSource.getGlyph(e,r);if(!e?.metrics)return{rect:new n(0,0,0,0),page:0,metrics:{left:0,width:0,height:0,advance:0,top:0},code:r,sdf:!0};const f=this._recordGlyph(e);k[r]={rect:f,page:this._currentPage,metrics:e.metrics,code:r,sdf:!0};this._invalidate()}return k[r]}_recordGlyph(k){var e=
k.metrics;if(0===e.width)e=new n(0,0,0,0);else{const r=e.width+6,f=e.height+6;e=this._binPack.allocate(r,f);e.isEmpty&&(this._dirties[this._currentPage]||(this._glyphData[this._currentPage]=null),this._currentPage=this._glyphData.length,this._glyphData.push(new Uint8Array(this.width*this.height)),this._dirties.push(!0),this._textures.push(null),this._initDecorationGlyphs(),this._binPack=new d(this.width-4,this.height-4),e=this._binPack.allocate(r,f));const p=this._glyphData[this._currentPage];k=k.bitmap;
let t,w;if(k)for(let z=0;z<f;z++){t=r*z;w=this.width*(e.y+z)+e.x;for(let u=0;u<r;u++)p[w+u]=k[t+u]}l("esri-glyph-debug")&&this._showDebugPage(p)}return e}_showDebugPage(k){const e=document.createElement("canvas"),r=e.getContext("2d"),f=new ImageData(this.width,this.height),p=f.data;e.width=this.width;e.height=this.height;e.style.border="1px solid black";for(let t=0;t<k.length;++t)p[4*t]=k[t],p[4*t+1]=0,p[4*t+2]=0,p[4*t+3]=255;r.putImageData(f,0,0);document.body.appendChild(e)}}return b})},"esri/views/2d/engine/webgl/RectangleBinPack":function(){define(["./Rect"],
function(l){class q{constructor(n,d){this._height=this._width=0;this._free=[];this._width=n;this._height=d;this._free.push(new l(0,0,n,d))}get width(){return this._width}get height(){return this._height}allocate(n,d){if(n>this._width||d>this._height)return new l;let m=null,h=-1;for(let g=0;g<this._free.length;++g){const c=this._free[g];n<=c.width&&d<=c.height&&(null===m||c.y<=m.y&&c.x<=m.x)&&(m=c,h=g)}if(null===m)return new l;this._free.splice(h,1);m.width<m.height?(m.width>n&&this._free.push(new l(m.x+
n,m.y,m.width-n,d)),m.height>d&&this._free.push(new l(m.x,m.y+d,m.width,m.height-d))):(m.width>n&&this._free.push(new l(m.x+n,m.y,m.width-n,m.height)),m.height>d&&this._free.push(new l(m.x,m.y+d,n,m.height-d)));return new l(m.x,m.y,n,d)}release(n){for(let d=0;d<this._free.length;++d){const m=this._free[d];if(m.y===n.y&&m.height===n.height&&m.x+m.width===n.x)m.width+=n.width;else if(m.x===n.x&&m.width===n.width&&m.y+m.height===n.y)m.height+=n.height;else if(n.y===m.y&&n.height===m.height&&n.x+n.width===
m.x)m.x=n.x,m.width+=n.width;else if(n.x===m.x&&n.width===m.width&&n.y+n.height===m.y)m.y=n.y,m.height+=n.height;else continue;this._free.splice(d,1);this.release(n)}this._free.push(n)}}return q})},"esri/views/2d/engine/webgl/GlyphSource":function(){define(["../../../../request","../../../../core/pbf"],function(l,q){class n{constructor(h){this._metrics=[];for(this._bitmaps=[];h.next();)switch(h.tag()){case 1:const g=h.getMessage();for(;g.next();)switch(g.tag()){case 3:const c=g.getMessage();let a,
b,k,e,r,f,p;for(;c.next();)switch(c.tag()){case 1:a=c.getUInt32();break;case 2:b=c.getBytes();break;case 3:k=c.getUInt32();break;case 4:e=c.getUInt32();break;case 5:r=c.getSInt32();break;case 6:f=c.getSInt32();break;case 7:p=c.getUInt32();break;default:c.skip()}c.release();a&&(this._metrics[a]={width:k,height:e,left:r,top:f,advance:p},this._bitmaps[a]=b);break;default:g.skip()}g.release();break;default:h.skip()}}getMetrics(h){return this._metrics[h]}getBitmap(h){return this._bitmaps[h]}}class d{constructor(){this._ranges=
[]}getRange(h){return this._ranges[h]}addRange(h,g){this._ranges[h]=g}}class m{constructor(h){this._glyphInfo={};this._baseURL=h}getRange(h,g,c){const a=this._getFontStack(h);if(a.getRange(g))return Promise.resolve();const b=256*g,k=b+255;h=this._baseURL.replace("{fontstack}",h).replace("{range}",b+"-"+k);return l(h,{responseType:"array-buffer",...c}).then(e=>{a.addRange(g,new n(new q(new Uint8Array(e.data),new DataView(e.data))))})}async preloadASCIIRange(h){const g=this._getFontStack(h);h=this._baseURL.replace("{fontstack}",
h).replace("{range}","0-255");h=await l(h,{responseType:"array-buffer"});h=new n(new q(new Uint8Array(h.data),new DataView(h.data)));for(let c=0;255>=c;c++)g.getRange(c)||g.addRange(c,h)}getGlyph(h,g){if(h=this._getFontStack(h))if(h=h.getRange(Math.floor(g/256)))return{metrics:h.getMetrics(g),bitmap:h.getBitmap(g)}}_getFontStack(h){let g=this._glyphInfo[h];g||=this._glyphInfo[h]=new d;return g}}return m})},"esri/views/2d/engine/webgl/SDFConverter":function(){define(["../../../../core/floatRGBA","../../../../core/promiseUtils",
"../svgUtils"],function(l,q,n){class d{constructor(m,h=2){this._textureSize=m;this._rasterizationScale=h;this._canvasSize=this._textureSize*this._rasterizationScale;this._svg=null;({_canvasSize:m}=this);h=document.createElement("canvas");h.width=h.height=m;this._context=h.getContext("2d",{willReadFrequently:!1});this._gridOuter=new Float64Array(m*m);this._gridInner=new Float64Array(m*m);this._f=new Float64Array(m);this._d=new Float64Array(m);this._z=new Float64Array(m+1);this._v=new Int16Array(m)}dispose(){this._context=
this._gridOuter=this._gridInner=this._f=this._d=this._z=this._v=null;this._svg=n.destroyHiddenSvg(this._svg)}draw(m,h,g){const {_canvasSize:c,_textureSize:a,_rasterizationScale:b}=this,k=a/4;this._initSVG();const e=this.createSVGString(m,h);return new Promise((r,f)=>{const p=new Image;p.src="data:image/svg+xml; charset\x3dutf8, "+encodeURIComponent(e);p.onload=()=>{p.onload=null;this._context.clearRect(0,0,c,c);this._context.drawImage(p,0,0,c,c);var w=this._context.getImageData(0,0,c,c);const z=new Uint8Array(a*
a*4);for(var u=0;u<c*c;u++){var y=w.data[4*u+3]/255;this._gridOuter[u]=1===y?0:0===y?1E20:Math.max(0,.5-y)**2;this._gridInner[u]=1===y?1E20:0===y?0:Math.max(0,y-.5)**2}this._edt(this._gridOuter,c,c);this._edt(this._gridInner,c,c);for(w=0;w<a*a;w++){u=0;for(y=0;y<b;y++){const A=Math.floor(w/a)*b+y;for(let v=0;v<b;v++){const x=A*c+(w%a*b+v);u+=this._gridOuter[x]-this._gridInner[x]}}u/=b*b;u/=b;l.packFloatRGBA(.5-u/(2*k),z,4*w)}r(z)};const t=g?.signal;if(t)q.onAbort(t,()=>f(q.createAbortError()))})}_initSVG(){this._svg||
(this._svg=n.createHiddenSvg());return this._svg}createSVGString(m,h){const g=this._initSVG(),c=n.createSvgElement("path");c.setAttribute("d",m);g.appendChild(c);m=c.getBBox();var a=m.width/m.height;const b=this._canvasSize/2;let k,e;1<a?(k=b/m.width,e=this._canvasSize/4,a=b-1/a*b/2):(k=b/m.height,e=b-b*a/2,a=this._canvasSize/4);c.setAttribute("style",`transform: matrix(${k}, 0, 0, ${k}, ${-m.x*k+e}, ${-m.y*k+a})`);c.setAttribute("stroke-width",`${.5/k}`);h=`<svg style="fill:${h?"red":"none"}; stroke:${h?
"none":"red"}" height="${this._canvasSize}" width="${this._canvasSize}" xmlns="http://www.w3.org/2000/svg">${g.innerHTML}</svg>`;g.removeChild(c);return h}_edt(m,h,g){const c=this._f,a=this._d,b=this._v,k=this._z;for(var e=0;e<h;e++){for(var r=0;r<g;r++)c[r]=m[r*h+e];this._edt1d(c,a,b,k,g);for(r=0;r<g;r++)m[r*h+e]=a[r]}for(e=0;e<g;e++){for(r=0;r<h;r++)c[r]=m[e*h+r];this._edt1d(c,a,b,k,h);for(r=0;r<h;r++)m[e*h+r]=Math.sqrt(a[r])}}_edt1d(m,h,g,c,a){g[0]=0;c[0]=-1E20;c[1]=1E20;for(let b=1,k=0;b<a;b++){let e=
(m[b]+b*b-(m[g[k]]+g[k]*g[k]))/(2*b-2*g[k]);for(;e<=c[k];)k--,e=(m[b]+b*b-(m[g[k]]+g[k]*g[k]))/(2*b-2*g[k]);k++;g[k]=b;c[k]=e;c[k+1]=1E20}for(let b=0,k=0;b<a;b++){for(;c[k+1]<b;)k++;h[b]=(b-g[k])*(b-g[k])+m[g[k]]}}}return d})},"esri/views/2d/engine/webgl/SpriteMosaic":function(){define("../../../../core/Error ../../../../core/has ./definitions ./GeometryUtils ./Rect ./RectangleBinPack ../../../webgl/enums ../../../webgl/Texture ../../../webgl/TextureDescriptor".split(" "),function(l,q,n,d,m,h,g,c,
a){function b(f){return f&&"static"===f.type}function k(f,p){const t=new a.TextureDescriptor;t.width=p[0];t.height=p[1];t.wrapMode=g.TextureWrapMode.CLAMP_TO_EDGE;return new c.Texture(f,t,null)}class e{constructor(f,p,t=0){this._mosaicPages=[];this._pageHeight=this._pageWidth=this._currentPage=this._maxItemSize=0;this._mosaicRects=new Map;this._spriteCopyQueue=[];this.pixelRatio=1;this._pageWidth=f;this._pageHeight=p;0<t&&(this._maxItemSize=t);this.pixelRatio=window.devicePixelRatio||1;this._binPack=
new h(this._pageWidth,this._pageHeight);this._mosaicPages.push({mosaicsData:{type:"static",data:new Uint32Array(Math.floor(this._pageWidth)*Math.floor(this._pageHeight))},size:[this._pageWidth,this._pageHeight],dirty:!0,texture:void 0})}getWidth(f){return f>=this._mosaicPages.length?-1:this._mosaicPages[f].size[0]}getHeight(f){return f>=this._mosaicPages.length?-1:this._mosaicPages[f].size[1]}getPageTexture(f){return f<this._mosaicPages.length?this._mosaicPages[f].texture:null}has(f){return this._mosaicRects.has(f)}get itemCount(){return this._mosaicRects.size}getSpriteItem(f){return this._mosaicRects.get(f)}addSpriteItem(f,
p,t,w,z,u,y=1,A=.5,v=1){if(this._mosaicRects.has(f))return this._mosaicRects.get(f);let x,C,B;b(t)?[x,C,B]=this._allocateImage(p[0],p[1]):(x=new m(0,0,p[0],p[1]),C=this._mosaicPages.length,this._mosaicPages.push({mosaicsData:t,size:[p[0]+2*n.spritePadding,p[1]+2*n.spritePadding],dirty:!0,texture:void 0}));if(0>=x.width||0>=x.height)return null;u={type:"sprite",rect:x,width:p[0],height:p[1],sdf:z,simplePattern:u,rasterizationScale:y,sdfPaddingRatio:A,sdfDecodeCoeff:v,page:C};this._mosaicRects.set(f,
u);b(t)&&(q("esri-mosaic-debug")&&this._showDebugSprite(p,t.data),this._copy({rect:x,spriteSize:p,spriteData:t.data,page:C,pageSize:B,repeat:w,sdf:z}));return u}hasItemsToProcess(){return 0!==this._spriteCopyQueue.length}processNextItem(){const f=this._spriteCopyQueue.pop();f&&this._copy(f)}getMosaicItemPosition(f){f=this.getSpriteItem(f);const p=f?.rect;if(!p)return null;p.width=f.width;p.height=f.height;const t=n.spritePadding,w=this._mosaicPages[f.page].size;return{size:[f.width,f.height],tl:[(p.x+
t)/w[0],(p.y+t)/w[1]],br:[(p.x+t+f.width)/w[0],(p.y+t+f.height)/w[1]],page:f.page}}bind(f,p,t=0,w=0){const z=this._mosaicPages[t],u=z.mosaicsData;let y=z.texture;y||(y=k(f,z.size),z.texture=y);y.setSamplingMode(p);b(u)?(f.bindTexture(y,w),z.dirty&&(y.setData(new Uint8Array(u.data.buffer)),y.generateMipmap(),q("esri-mosaic-debug")&&this._showDebugPage(t))):(u.data.loadFrame(y),f.bindTexture(y,w),y.generateMipmap());z.dirty=!1}getTexture(f,p=0){const t=this._mosaicPages[p],w=t.mosaicsData;let z=t.texture;
z||(z=k(f,t.size),t.texture=z);b(w)?t.dirty&&(z.setData(new Uint8Array(w.data.buffer)),z.generateMipmap(),q("esri-mosaic-debug")&&this._showDebugPage(p)):(w.data.loadFrame(z),z.generateMipmap());t.dirty=!1;return z}dispose(){this._binPack=null;for(const p of this._mosaicPages){var f=p.texture;f&&f.dispose();f=p.mosaicsData;b(f)||f.data.destroy()}this._mosaicPages=null;this._mosaicRects.clear()}static _copyBits(f,p,t,w,z,u,y,A,v,x,C){let B=w*p+t;y=A*u+y;if(C)for(y-=u,C=-1;C<=x;C++,B=((C+x)%x+w)*p+
t,y+=u)for(A=-1;A<=v;A++)z[y+A]=f[B+(A+v)%v];else for(t=0;t<x;t++){for(w=0;w<v;w++)z[y+w]=f[B+w];B+=p;y+=u}}_copy(f){if(!(f.page>=this._mosaicPages.length)){var p=this._mosaicPages[f.page],t=p.mosaicsData;if(!b(p.mosaicsData))throw new l("mapview-invalid-resource","unsuitable data type!");e._copyBits(f.spriteData,f.spriteSize[0],0,0,t.data,f.pageSize[0],f.rect.x+n.spritePadding,f.rect.y+n.spritePadding,f.spriteSize[0],f.spriteSize[1],f.repeat);p.dirty=!0}}_allocateImage(f,p){f+=2*n.spritePadding;
p+=2*n.spritePadding;var t=Math.max(f,p);if(this._maxItemSize&&this._maxItemSize<t){t=2**Math.ceil(d.log2(f));const w=2**Math.ceil(d.log2(p));f=new m(0,0,f,p);this._mosaicPages.push({mosaicsData:{type:"static",data:new Uint32Array(t*w)},size:[t,w],dirty:!0,texture:void 0});return[f,this._mosaicPages.length-1,[t,w]]}t=this._binPack.allocate(f,p);return 0>=t.width?(t=this._mosaicPages[this._currentPage],!t.dirty&&b(t.mosaicsData)&&(t.mosaicsData.data=null),this._currentPage=this._mosaicPages.length,
this._mosaicPages.push({mosaicsData:{type:"static",data:new Uint32Array(this._pageWidth*this._pageHeight)},size:[this._pageWidth,this._pageHeight],dirty:!0,texture:void 0}),this._binPack=new h(this._pageWidth,this._pageHeight),this._allocateImage(f,p)):[t,this._currentPage,[this._pageWidth,this._pageHeight]]}_showDebugSprite([f,p],t){const w=document.createElement("canvas");w.width=f;w.height=p;w.setAttribute("style",`position: absolute; top: ${4+204*r++}px; right: 208px; width: 200px; height: 200px; border: 1px solid black;`);
const z=w.getContext("2d");f=new ImageData(f,p);f.data.set(new Uint8Array(t.buffer));z.putImageData(f,0,0);document.body.appendChild(w)}_showDebugPage(f){const {size:[p,t],mosaicsData:w}=this._mosaicPages[f];if(b(w)){var z=`mosaicDebugPage${f}`,u=document.getElementById(z)??document.createElement("canvas");u.id=z;u.width=p;u.height=t;u.setAttribute("style",`position: absolute; top: ${4+204*f}px; right: 4px; width: 200px; height: 200px; border: 1px solid black;`);f=u.getContext("2d");z=new ImageData(p,
t);z.data.set(new Uint8Array(w.data.buffer));f.putImageData(z,0,0);document.body.appendChild(u)}}}let r=0;return e})},"esri/views/2d/engine/webgl/animatedFormats/AnimatableTextureResource":function(){define(["exports","../definitions","./utils"],function(l,q,n){class d{constructor(m,h,g,c){this._animation=m;this._frameData=null;this.frameCount=this._animation.frameDurations.length;this.width=this._animation.width;this.height=this._animation.height;this._playHandle=n.play(this._animation,g,c,a=>{this._frameData=
a;h.requestRender()})}destroy(){this._playHandle.remove()}loadFrame(m){const h=this._frameData;null!=h&&(m.updateData(0,q.spritePadding,q.spritePadding,"width"in h?h.width:h.codedWidth,"height"in h?h.height:h.codedHeight,h),this._frameData=null)}}l.AnimatableTextureResource=d;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/animatedFormats/utils":function(){define("exports ../../../../../core/handleUtils ../../../../../core/time ../../../../../geometry/support/meshUtils/exporters/gltf/imageutils ../../../../../symbols/cim/enums ../grouping".split(" "),
function(l,q,n,d,m,h){function g(t){return n.Milliseconds(t.frameDurations.reduce((w,z)=>w+z,0))}function c(t){const {width:w,height:z}=t,u=t.frameDurations.reverse();return{frameCount:t.frameCount,duration:t.duration,frameDurations:u,getFrame:y=>t.getFrame(t.frameDurations.length-1-y),width:w,height:z}}function a(t,w){const {width:z,height:u,getFrame:y}=t,A=w/t.duration;w=t.frameDurations.map(v=>n.Milliseconds(v*A));return{frameCount:t.frameCount,duration:t.duration,frameDurations:w,getFrame:y,width:z,
height:u}}function b(t,w){const {width:z,height:u,getFrame:y}=t,A=t.frameDurations.slice(),v=A.shift();A.unshift(n.Milliseconds(v+w));return{frameCount:t.frameCount,duration:t.duration+w,frameDurations:A,getFrame:y,width:z,height:u}}function k(t,w){const {width:z,height:u,getFrame:y}=t,A=t.frameDurations.slice(),v=A.pop();A.push(n.Milliseconds(v+w));return{frameCount:t.frameCount,duration:t.duration+w,frameDurations:A,getFrame:y,width:z,height:u}}function e(t,w,z,u){let {repeatType:y}=w;null==y&&
(y=m.AnimatedSymbolRepeatType.Loop);!0===w.reverseAnimation&&(t=c(t));null!=w.duration&&(t=a(t,n.Milliseconds(1E3*w.duration)));if(null!=w.repeatDelay){const A=1E3*w.repeatDelay;y===m.AnimatedSymbolRepeatType.Loop?t=k(t,n.Milliseconds(A)):y===m.AnimatedSymbolRepeatType.Oscillate&&(t=b(k(t,n.Milliseconds(A/2)),n.Milliseconds(A/2)))}null!=w.startTimeOffset?w=n.Milliseconds(1E3*w.startTimeOffset):null!=w.randomizeStartTime?(w=h.getRandomValue(z,null!=w.randomizeStartSeed?w.randomizeStartSeed:82749913),
w=n.Milliseconds(w*g(t))):w=n.Milliseconds(0);return new r(t,w,y,u)}class r{constructor(t,w,z,u){this._animation=t;this._repeatType=z;this._onFrameData=u;this._direction=1;this._currentFrame=0;this.timeToFrame=this._animation.frameDurations[this._currentFrame];for(t=0;w>t;)t+=this.timeToFrame,this.nextFrame();w=this._animation.getFrame(this._currentFrame);this._onFrameData(w)}nextFrame(){this._currentFrame+=this._direction;if(0<this._direction){if(this._currentFrame===this._animation.frameDurations.length)switch(this._repeatType){case m.AnimatedSymbolRepeatType.None:this._currentFrame-=
this._direction;break;case m.AnimatedSymbolRepeatType.Loop:this._currentFrame=0;break;case m.AnimatedSymbolRepeatType.Oscillate:this._currentFrame-=this._direction,this._direction=-1}}else if(-1===this._currentFrame)switch(this._repeatType){case m.AnimatedSymbolRepeatType.None:this._currentFrame-=this._direction;break;case m.AnimatedSymbolRepeatType.Loop:this._currentFrame=this._animation.frameDurations.length-1;break;case m.AnimatedSymbolRepeatType.Oscillate:this._currentFrame-=this._direction,this._direction=
1}this.timeToFrame=this._animation.frameDurations[this._currentFrame];const t=this._animation.getFrame(this._currentFrame);this._onFrameData(t)}}let f,p;l.Player=r;l.adjustDuration=a;l.appendDelay=k;l.createPlayer=e;l.getDuration=g;l.play=function(t,w,z,u){function y(){C=A?setTimeout(()=>{v.nextFrame();x=v.timeToFrame;y()},x):void 0}const A=null!=w.playAnimation?w.playAnimation:!0,v=e(t,w,z,u);let x=v.timeToFrame,C;y();return q.makeHandle(()=>A&&clearTimeout(C))};l.prependDelay=b;l.resize=function(t,
w,z){f??=document.createElement("canvas");p??=f.getContext("2d");const {canvas:u,ctx:y}={canvas:f,ctx:p};u.width=w;u.height=z;const A=[],v=t.frameDurations.length;for(let x=0;x<v;x++){const C=t.getFrame(x);y.clearRect(0,0,w,z);C instanceof ImageData?y.drawImage(d.imageTypeToCanvas(C),0,0,w,z):y.drawImage(C,0,0,w,z);A.push(y.getImageData(0,0,w,z))}return{width:w,height:z,frameDurations:t.frameDurations,getFrame:x=>A[x],frameCount:t.frameCount,duration:t.duration}};l.reverse=c;Object.defineProperty(l,
Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/meshUtils/exporters/gltf/imageutils":function(){define(["exports","../../../../../core/has","../../../../../core/Error","../../../../../core/promiseUtils","../../../../../core/urlUtils"],function(l,q,n,d,m){function h(c){if(!(c instanceof HTMLImageElement))return"image/png";c=c.src;return m.isDataProtocol(c)?(c=m.dataComponents(c),"image/jpeg"===c?.mediaType?c.mediaType:"image/png"):/\.png$/i.test(c)?"image/png":/\.(jpg|jpeg)$/i.test(c)?
"image/jpeg":"image/png"}function g(c){if(c instanceof HTMLCanvasElement)return c;if(c instanceof HTMLVideoElement)return null;const a=document.createElement("canvas");a.width=c.width;a.height=c.height;const b=a.getContext("2d");c instanceof HTMLImageElement?b.drawImage(c,0,0,c.width,c.height):c instanceof ImageData&&b.putImageData(c,0,0);return a}l.encodeBase64DataUri=function(c){const a=[];c=new Uint8Array(c);for(let b=0;b<c.length;b++)a.push(String.fromCharCode(c[b]));return"data:application/octet-stream;base64,"+
btoa(a.join(""))};l.imageToArrayBuffer=async function(c,a){const b=g(c);if(null==b)throw new n("imageToArrayBuffer","Unsupported image type");const k=h(c);c=await new Promise(e=>b.toBlob(e,k));d.throwIfAborted(a);if(!c)throw new n("imageToArrayBuffer","Failed to encode image");c=await c.arrayBuffer();d.throwIfAborted(a);return{data:c,type:k}};l.imageToDataURI=function(c){c=g(c);return null!=c?c.toDataURL():""};l.imageTypeToCanvas=g;l.isArrayBufferPNG=function(c){if(8>c.byteLength)return!1;c=new Uint8Array(c);
return 137===c[0]&&80===c[1]&&78===c[2]&&71===c[3]&&13===c[4]&&10===c[5]&&26===c[6]&&10===c[7]};Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/grouping":function(){define(["exports","../../../../core/string"],function(l,q){function n(d,m){if("string"===typeof d)d=q.numericHash(d+`-seed(${m})`);else{let h=12;d^=m;do d=107*(d>>8^d)+h|0;while(0!==--h)}return(1+d/-2147483648)/2}l.getRandomValue=n;l.getStartGroup=function(d){return Math.floor(10*n(d,53290320))};
Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/animations/store/AnimationStore":function(){define(["exports","../../../../../webgl/enums","../../../../../webgl/Texture","../../../../../webgl/TextureDescriptor","../../../../../webgl/ValidatedTextureDescriptor"],function(l,q,n,d,m){class h{constructor(){this._entries=new c;this._nodes=new Map;this._book=new a}add(k){let e=this._entries.get(k);if(!e){const r={};e={location:this._book.add(k),references:0,handle:r};
k=this._entries.set(k,e);this._nodes.set(r,k)}e.references++;return e}remove(k){const e=this._nodes.get(k.handle);e&&e.payload&&(e.payload.references--,0===e.payload.references&&(this._book.remove(e.payload.location),this._entries.delete(e),this._nodes.delete(k.handle)))}getTexture(k,e){return this._book.getTexture(k,e)}destroy(){this._book.destroy()}}class g{constructor(k,e){this.parent=k;this.key=e;this.payload=null;this._children=new Map}get(k){return this._children.get(k)}ensure(k){let e=this._children.get(k);
e||(e=new g(this,k),this._children.set(k,e));return e}delete(k){this._children.delete(k)}}class c{constructor(){this._root=new g(null,NaN)}set(k,e){let r=this._root;for(const f of k)for(const p of f)r=r.ensure(p);r.payload=e;return r}delete(k){k.parent?.delete(k.key)}get(k){let e=this._root;for(const r of k)for(const f of r){k=e.get(f);if(!k)return;e=k}return e.payload||void 0}}class a{constructor(){this._pages=[]}add(k){0===this._pages.length&&this._pages.push(new b);let e=this._pages.length-1,r=
this._pages[e].add(k);r||(this._pages.push(new b),e=this._pages.length-1,r=this._pages[e].add(k));if(!r)throw Error("Data allocation failed.");return{...r,page:e}}remove(k){this._pages[k.page].remove(k)}getTexture(k,e){return this._pages[e].getTexture(k)}destroy(){}}class b{constructor(){this._cursor={row:0,column:0};this._rows=this._columns=1024;this._data=new Float32Array(this._columns*this._rows*4);this._texture=null;this._textureCursor={row:0,column:0}}add(k){if(k.length>this._columns)throw Error(`The maximum allocation size is ${this._columns} texels.`);
var e={...this._cursor};e.column+=k.length;e.column>=this._columns&&(e.column=k.length,e.row++);if(e.row>=this._rows)return null;this._cursor=e;e={...this._cursor};e.column-=k.length;let r=4*(e.row*this._columns+e.column);for(let f=0;f<k.length;f++)this._data[r++]=k[f][0],this._data[r++]=k[f][1],this._data[r++]=k[f][2],this._data[r++]=k[f][3];return e}remove(k){}getTexture(k){if(!this._texture){var e=new d.TextureDescriptor(this._columns,this._rows);e.pixelFormat=q.PixelFormat.RGBA;e.dataType=q.PixelType.FLOAT;
e.wrapMode=q.TextureWrapMode.CLAMP_TO_EDGE;e.samplingMode=q.TextureSamplingMode.NEAREST;e.hasMipmap=!1;e=new m.ValidatedTextureDescriptor(k,e);this._texture=new n.Texture(k,e)}if(this._cursor.row===this._textureCursor.row&&this._cursor.column===this._textureCursor.column)return this._texture;k=this._textureCursor.row;this._texture.updateData(0,0,k,this._columns,this._cursor.row-k+1,this._data,k);this._textureCursor.row=this._cursor.row;this._textureCursor.column=this._cursor.column;return this._texture}destroy(){this._texture?.dispose()}}
l.AnimationStore=h;l.PrefixMap=c;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/TextureUploadManager":function(){define(["exports","../../../../core/promiseUtils","./definitions"],function(l,q,n){class d{constructor(m){this._queue=[];this._refreshable=m}destroy(){this._queue=[]}enqueueTextureUpdate(m,h){const g=q.createResolver(),c=n.textureUploadManagerChunkSize,a=Math.ceil(m.height/c);q.throwIfAborted(h);for(let b=0;b<a;b++){const k=b===a-1;this._queue.push({type:"chunk",
request:m,resolver:g,chunk:b,chunkOffset:b*c,destHeight:k?m.height-c*b:c,chunkIsLast:k,options:h})}q.onAbortOrThrow(h,b=>g.reject(b));return g.promise}upload(){let m=0;for(;this._queue.length;){var h=performance.now();const g=this._queue.shift();if(g&&(null==g.options.signal||!g.options.signal.aborted)){switch(g.type){case "chunk":this._uploadChunk(g);break;case "no-chunk":this._uploadNoChunk(g)}h=performance.now()-h;m+=h;if(m+h>=n.textureUploadManagerBudget)break}}this._queue.length&&this._refreshable.requestRender()}_uploadChunk(m){const {request:h,
resolver:g,chunkOffset:c,chunkIsLast:a,destHeight:b}=m,{data:k,texture:e,width:r}=h;null!=k&&(e.updateData(0,0,c,r,b,k,c),a&&g.resolve())}_uploadNoChunk(m){const {request:h,resolver:g}=m,{data:c,texture:a}=h;a.setData(c);g.resolve()}}l.TextureUploadManager=d;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/WorldExtentClipRenderer":function(){define("exports ../../../../core/maybe ../../../../core/libs/gl-matrix-2/math/common ../../../../core/libs/gl-matrix-2/math/mat3 ../../../../core/libs/gl-matrix-2/factories/mat3f32 ../../../../core/libs/gl-matrix-2/factories/vec2f64 ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ./definitions ./VertexStream ./shaders/StencilPrograms ../../../webgl/enums ../../../webgl/ProgramTemplate".split(" "),
function(l,q,n,d,m,h,g,c,a,b,k,e,r){const f=h.fromValues(-.5,-.5);class p{constructor(){this._centerNdc=c.create();this._pxToNdc=c.create();this._worldDimensionsPx=c.create();this._mat3=m.create();this._initialized=!1}dispose(){this._program=q.disposeMaybe(this._program);this._quad=q.disposeMaybe(this._quad)}render(t,w,z){const {context:u}=t;t=this._updateGeometry(t,z);if(null!=w){const {r:y,g:A,b:v,a:x}=w;u.setClearColor(x*y/255,x*A/255,x*v/255,x)}else u.setClearColor(0,0,0,0);u.setStencilFunction(e.CompareFunction.ALWAYS,
0,255);u.setStencilWriteMask(255);t?(u.setClearStencil(a.backbufferStencilClipped),u.clear(u.gl.STENCIL_BUFFER_BIT|u.gl.COLOR_BUFFER_BIT),this._initialized||this._initialize(u),u.setDepthWriteEnabled(!1),u.setDepthTestEnabled(!1),u.setColorMask(!1,!1,!1,!1),u.setBlendingEnabled(!1),u.setStencilOp(e.StencilOperation.KEEP,e.StencilOperation.KEEP,e.StencilOperation.REPLACE),u.setStencilFunction(e.CompareFunction.ALWAYS,a.backbufferStencilVisible,255),u.setStencilTestEnabled(!0),u.useProgram(this._program),
this._program.setUniformMatrix3fv("u_worldExtent",this._mat3),this._quad.bind(),this._quad.draw(),this._quad.unbind()):(u.setClearStencil(a.backbufferStencilVisible),u.clear(u.gl.STENCIL_BUFFER_BIT|u.gl.COLOR_BUFFER_BIT))}_initialize(t){if(!this._initialized){var w=r.createProgram(t,k.stencil);w&&(this._program=w,this._quad=new b(t,[0,0,1,0,0,1,1,1]),this._initialized=!0)}}_updateGeometry(t,w){const {state:z,pixelRatio:u}=t,{size:y,rotation:A}=z,v=Math.round(y[0]*u),x=Math.round(y[1]*u);if(!z.spatialReference.isWrappable)return!1;
t=n.toRadian(A);const C=Math.abs(Math.cos(t)),B=Math.abs(Math.sin(t)),E=Math.round(u*z.worldScreenWidth);if(Math.round(v*C+x*B)<=E)return!1;const D=(w.left-w.right)*u/v;w=(w.bottom-w.top)*u/x;g.set(this._worldDimensionsPx,E,v*B+x*C,1);g.set(this._pxToNdc,2/v,-2/x,1);g.set(this._centerNdc,D,w,1);w=this._mat3;d.fromTranslation(w,this._centerNdc);d.scale(w,w,this._pxToNdc);0!==A&&d.rotate(w,w,t);d.scale(w,w,this._worldDimensionsPx);d.translate(w,w,f);return!0}}l.WorldExtentRenderer=p;Object.defineProperty(l,
Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaders/StencilPrograms":function(){define(["exports","./sources/resolver"],function(l,q){q={shaders:{vertexShader:q.resolveIncludes("stencil/stencil.vert"),fragmentShader:q.resolveIncludes("stencil/stencil.frag")},attributes:new Map([["a_pos",0]])};l.stencil=q;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/effects/BlendEffect":function(){define(["exports","../shaderGraph/techniques/blend/BlendTechnique"],
function(l,q){class n{constructor(){this._blendTechnique=new q.BlendTechnique}dispose(d){this._blendTechnique?.shutdown()}draw(d,m,h,g,c){this._blendTechnique.render(d,{colorTexture:m,config:{opacity:c,samplingMode:h},blendMode:g})}}l.BlendEffect=n;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/blend/BlendTechnique":function(){define("exports ../../utils ../Technique ../TechniqueType ../shaders/BlendShader ../shaders/OpacityShader ../../../../../../webgl/enums ../../../../../../webgl/Texture ../../../../../../webgl/TextureDescriptor".split(" "),
function(l,q,n,d,m,h,g,c,a){class b extends n.Technique{constructor(){super(...arguments);this.type=d.TechniqueType.Blend;this._backBufferTexture=null;this.shaders={blend:new m.BlendShader,opacity:new h.OpacityShader}}shutdown(){super.shutdown();null!==this._backBufferTexture&&(this._backBufferTexture.dispose(),this._backBufferTexture=null)}render(k,e){const {context:r,state:f,pixelRatio:p,inFadeTransition:t,painter:w}=k;var {size:z}=f;const u=r.getBoundFramebufferObject();let y;null!=u?(y=u.width,
z=u.height):(y=Math.round(p*z[0]),z=Math.round(p*z[1]));const {blendMode:A}=e;"normal"===A?(e={shader:this.shaders.opacity,uniforms:{config:{layerTexture:{texture:e.colorTexture,unit:0},opacity:e.config.opacity}},defines:null,optionalAttributes:null,useComputeBuffer:!1},w.setPipelineState(q.simplePipelineState),w.submitDrawMesh(r,e,w.quadMesh)):(k=this._createOrResizeTexture(k,y,z),u.copyToTexture(0,0,y,z,0,0,k),w.setPipelineState({color:{write:[!0,!0,!0,!0],blendMode:"custom",blendParameters:{srcRGB:g.BlendFactor.ONE,
dstRGB:g.BlendFactor.ZERO,srcAlpha:g.BlendFactor.ONE,dstAlpha:g.BlendFactor.ZERO}},depth:!1,stencil:!1}),w.submitDrawMesh(r,{shader:this.shaders.blend,uniforms:{config:{backbufferTexture:{texture:k,unit:0},layerTexture:{texture:e.colorTexture,unit:1},inFadeOpacity:t?1:0,...e.config}},defines:{blendMode:A},optionalAttributes:null,useComputeBuffer:!1},w.quadMesh))}_createOrResizeTexture(k,e,r){({context:k}=k);if(null!==this._backBufferTexture&&this._backBufferTexture.descriptor?.width===e&&this._backBufferTexture.descriptor?.height===
r)return this._backBufferTexture;if(null===this._backBufferTexture){const f=new a.TextureDescriptor;f.internalFormat=g.PixelFormat.RGBA;f.wrapMode=g.TextureWrapMode.CLAMP_TO_EDGE;f.width=e;f.height=r;this._backBufferTexture=new c.Texture(k,f)}else this._backBufferTexture.resize(e,r);return this._backBufferTexture}}l.BlendTechnique=b;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/utils":function(){define(["exports"],function(l){l.getLocations=
function(q){return q.locationsMap};l.simplePipelineState={color:{write:[!0,!0,!0,!0],blendMode:"composite"},depth:!1,stencil:!1};Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/Technique":function(){define(["exports","../../enums"],function(l,q){class n{constructor(){this.drawPhase=q.WGLDrawPhase.MAP|q.WGLDrawPhase.HITTEST|q.WGLDrawPhase.HIGHLIGHT|q.WGLDrawPhase.DEBUG}startup(){}shutdown(d){}}l.Technique=n;Object.defineProperty(l,
Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/TechniqueType":function(){define(["exports"],function(l){l.TechniqueType=void 0;var q=l.TechniqueType||(l.TechniqueType={});q[q.AnimatedMarker=0]="AnimatedMarker";q[q.Blend=1]="Blend";q[q.ComplexFill=2]="ComplexFill";q[q.ComplexOutlineFill=3]="ComplexOutlineFill";q[q.DotDensity=4]="DotDensity";q[q.Fill=5]="Fill";q[q.Grid=6]="Grid";q[q.Heatmap=7]="Heatmap";q[q.Label=8]="Label";q[q.Line=9]="Line";q[q.Magnifier=
10]="Magnifier";q[q.Marker=11]="Marker";q[q.OutlineFill=12]="OutlineFill";q[q.Overlay=13]="Overlay";q[q.PatternFill=14]="PatternFill";q[q.PatternOutlineFill=15]="PatternOutlineFill";q[q.PieChart=16]="PieChart";q[q.Test=17]="Test";q[q.Text=18]="Text";q[q.TexturedLine=19]="TexturedLine";Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/BlendShader":function(){define(["exports","../../../../../../../chunks/tslib.es6","../../GraphShaderModule",
"../../graph/glsl","./utils"],function(l,q,n,d,m){function h(B,E,D,F,G){return new d.Vec4(B.multiply(F).multiply(G).add(E.multiply(F).multiply(m.oneMinus(G))).add(D.multiply(G).multiply(m.oneMinus(F))),F.add(G.multiply(m.oneMinus(F))))}function g(B,E){return(new d.Float(1)).subtract(d.step(new d.Float(.5),E)).multiply(m.oneMinus((new d.Float(2)).multiply(m.oneMinus(E).multiply(m.oneMinus(B))))).add(d.step(new d.Float(.5),E).multiply((new d.Float(2)).multiply(E).multiply(B)))}function c(B,E){return d.ifElse(d.equal(B,
new d.Float(0)),new d.Float(0),d.ifElse(d.equal(E,new d.Float(1)),new d.Float(1),d.min(new d.Float(1),B.divide((new d.Float(1)).subtract(E)))))}function a(B,E){return d.ifElse(d.equal(B,new d.Float(1)),new d.Float(1),d.ifElse(d.equal(E,new d.Float(0)),new d.Float(0),m.oneMinus(d.min(new d.Float(1),m.oneMinus(B).divide(E)))))}function b(B,E){return(new d.Float(1)).subtract(d.step(new d.Float(.5),E)).multiply((new d.Float(2)).multiply(E).multiply(B)).add(d.step(new d.Float(.5),E).multiply(m.oneMinus((new d.Float(2)).multiply(m.oneMinus(E).multiply(m.oneMinus(B))))))}
function k(B,E){return d.cond([d.lessThanEqual(E,new d.Float(.5)),()=>{var D=(new d.Float(2)).multiply(E);D=m.oneMinus(D);const F=m.oneMinus(B);return B.subtract(D.multiply(B).multiply(F))}],[d.lessThanEqual(B,new d.Float(.25)),()=>{var D=(new d.Float(2)).multiply(E);D=m.minusOne(D).multiply(B);const F=(new d.Float(16)).multiply(B).subtract(new d.Float(12)).multiply(B).add(new d.Float(3));return B.add(D.multiply(F))}],[!0,()=>{var D=(new d.Float(2)).multiply(E);D=m.minusOne(D);const F=d.sqrt(B).subtract(B);
return B.add(D.multiply(F))}])}function e(B,E){const D=m.oneMinus(d.step(new d.Float(.5),E)).multiply(a(B,(new d.Float(2)).multiply(E)));B=d.step(new d.Float(.5),E).multiply(c(B,(new d.Float(2)).multiply(m.minusScalar(E,.5))));return D.add(B)}function r(B){return d.min(d.min(B.r,B.g),B.b)}function f(B){return d.max(d.max(B.r,B.g),B.b)}function p(B){return d.dot(B,new d.Vec3(.3,.59,.11))}function t(B){return f(B).subtract(r(B))}function w(B){const E=p(B),D=r(B),F=f(B);return d.cond([d.lessThan(D,new d.Float(0)),
()=>{const G=B.subtract(E).multiply(E),H=E.subtract(D);return E.add(G.divide(H))}],[d.greaterThan(F,new d.Float(1)),()=>{var G=B.subtract(E),H=m.oneMinus(E);G=G.multiply(H);H=F.subtract(E);return E.add(G.divide(H))}],[!0,B])}function z(B,E){const D=p(B);E=p(E).subtract(D);B=B.add(new d.Vec3(E));return w(B)}function u(B,E,D){const F=r(B),G=t(B),H=t(E);E=d.ifElse(d.greaterThan(G,new d.Float(0)),()=>B.subtract(F).multiply(H).divide(G),new d.Vec3(0));return z(E,D)}function y(B,E){return d.ifElse(d.equal(E,
new d.Float(1)),E,()=>{var D=m.oneMinus(E);D=B.multiply(B).divide(D);return d.min(D,new d.Float(1))})}class A extends n.VertexInput{}q.__decorate([n.location(0,d.Vec2)],A.prototype,"position",void 0);class v extends n.FragmentInput{}class x extends n.UniformGroup{}q.__decorate([n.uniform(d.Sampler2D)],x.prototype,"layerTexture",void 0);q.__decorate([n.uniform(d.Sampler2D)],x.prototype,"backbufferTexture",void 0);q.__decorate([n.uniform(d.Float)],x.prototype,"opacity",void 0);q.__decorate([n.uniform(d.Float)],
x.prototype,"inFadeOpacity",void 0);class C extends n.GraphShaderModule{vertex(B){const E=B.position;B=new d.Vec4(m.uvToClip(B.position),0,1);return{uv:E,glPosition:B}}fragment(B){const E=new n.FragmentOutput;var D=d.texture2D(this.config.layerTexture,B.uv),F=d.texture2D(this.config.backbufferTexture,B.uv),G=d.ifElse(d.equal(D.a,new d.Float(0)),D.rgb,D.rgb.divide(D.a));B=d.ifElse(d.equal(F.a,new d.Float(0)),F.rgb,F.rgb.divide(F.a));const H=this.config.opacity.multiply(D.a);F=F.a;switch(this.blendMode){case "destination-over":E.glFragColor=
new d.Vec4(G.multiply(H).multiply(m.oneMinus(F)).add(B.multiply(F)),H.add(F).subtract(H.multiply(F)));break;case "source-in":G=new d.Vec4(G.multiply(H).multiply(F),H.multiply(F));B=(new d.Vec4(B.multiply(F),F)).multiply(m.oneMinus(this.config.opacity)).multiply(this.config.inFadeOpacity);E.glFragColor=G.add(B);break;case "destination-in":G=new d.Vec4(B.multiply(F).multiply(H),F.multiply(H));B=(new d.Vec4(B.multiply(F),F)).multiply(new d.Vec4(m.oneMinus(this.config.opacity).multiply(this.config.inFadeOpacity)));
E.glFragColor=G.add(B);break;case "source-out":E.glFragColor=new d.Vec4(G.multiply(H).multiply(m.oneMinus(F)),H.multiply(m.oneMinus(F)));break;case "destination-out":E.glFragColor=new d.Vec4(B.multiply(F).multiply(m.oneMinus(H)),F.multiply(m.oneMinus(H)));break;case "source-atop":E.glFragColor=new d.Vec4(G.multiply(H).multiply(F).add(B.multiply(F.multiply(m.oneMinus(H)))),F);break;case "destination-atop":E.glFragColor=new d.Vec4(G.multiply(H.multiply(m.oneMinus(F))).add(B.multiply(F).multiply(H)),
H);break;case "xor":E.glFragColor=new d.Vec4(G.multiply(H.multiply(m.oneMinus(F))).add(B.multiply(F.multiply(m.oneMinus(H)))),H.multiply(m.oneMinus(F)).add(F.multiply(m.oneMinus(H))));break;case "multiply":E.glFragColor=new d.Vec4(G.multiply(H).multiply(B.multiply(F)).add(G.multiply(H).multiply(m.oneMinus(F))).add(B.multiply(F).multiply(m.oneMinus(H))),H.add(F.multiply(m.oneMinus(H))));break;case "screen":E.glFragColor=new d.Vec4(G.add(B).subtract(G.multiply(B)).multiply(H.multiply(F)).add(G.multiply(H).multiply(m.oneMinus(F))).add(B.multiply(F).multiply(m.oneMinus(H))),
H.add(F.multiply(m.oneMinus(H))));break;case "overlay":D=new d.Vec3(g(B.r,G.r),g(B.g,G.g),g(B.b,G.b));E.glFragColor=h(D,G,B,H,F);break;case "darken":D=d.min(G,B);E.glFragColor=h(D,G,B,H,F);break;case "lighter":E.glFragColor=new d.Vec4(G.multiply(H).add(B.multiply(F)),H.add(F));break;case "lighten":D=d.max(G,B);E.glFragColor=h(D,G,B,H,F);break;case "color-dodge":D=d.clamp(new d.Vec3(c(B.r,G.r),c(B.g,G.g),c(B.b,G.b)),new d.Vec3(0),new d.Vec3(1));E.glFragColor=h(D,G,B,H,F);break;case "color-burn":D=
new d.Vec3(a(B.r,G.r),a(B.g,G.g),a(B.b,G.b));E.glFragColor=h(D,G,B,H,F);break;case "hard-light":D=new d.Vec3(b(B.r,G.r),b(B.g,G.g),b(B.b,G.b));E.glFragColor=h(D,G,B,H,F);break;case "soft-light":D=new d.Vec3(k(B.r,G.r),k(B.g,G.g),k(B.b,G.b));E.glFragColor=h(D,G,B,H,F);break;case "difference":D=d.abs(B.subtract(G));E.glFragColor=h(D,G,B,H,F);break;case "exclusion":D=G.add(B).subtract((new d.Float(2)).multiply(G).multiply(B));E.glFragColor=h(D,G,B,H,F);break;case "invert":E.glFragColor=new d.Vec4((new d.Vec3(1)).subtract(B).multiply(H).multiply(F).add(B.multiply(F).multiply(m.oneMinus(H))),
F);break;case "vivid-light":D=new d.Vec3(d.clamp(e(B.r,G.r),new d.Float(0),new d.Float(1)),d.clamp(e(B.g,G.g),new d.Float(0),new d.Float(1)),d.clamp(e(B.b,G.b),new d.Float(0),new d.Float(1)));E.glFragColor=h(D,G,B,H,F);break;case "hue":D=u(G,B,B);E.glFragColor=h(D,G,B,H,F);break;case "saturation":D=u(B,G,B);E.glFragColor=h(D,G,B,H,F);break;case "color":D=z(G,B);E.glFragColor=h(D,G,B,H,F);break;case "luminosity":D=z(B,G);E.glFragColor=h(D,G,B,H,F);break;case "plus":E.glFragColor=d.clamp(new d.Vec4(D.r.add(B.r),
D.g.add(B.g),D.b.add(B.b),H.add(F)),new d.Vec4(0),new d.Vec4(1));break;case "minus":E.glFragColor=new d.Vec4(d.clamp(new d.Vec3(B.r.subtract(D.r),B.g.subtract(D.g),B.b.subtract(D.b)),new d.Vec3(0),new d.Vec3(1)),F.multiply(H));break;case "average":D=B.add(G).divide(2);E.glFragColor=h(D,G,B,H,F);break;case "reflect":D=d.clamp(new d.Vec3(y(B.r,G.r),y(B.g,G.g),y(B.b,G.b)),new d.Vec3(0),new d.Vec3(1));E.glFragColor=h(D,G,B,H,F);break;default:E.glFragColor=D.multiply(this.config.opacity)}return E}}q.__decorate([n.define],
C.prototype,"blendMode",void 0);q.__decorate([n.uniform(x)],C.prototype,"config",void 0);q.__decorate([q.__param(0,n.input(A))],C.prototype,"vertex",null);q.__decorate([q.__param(0,n.input(v))],C.prototype,"fragment",null);l.BlendShader=C;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/GraphShaderModule":function(){define("exports ../../../../../chunks/tslib.es6 ../../../../../core/has ../../../../../core/Logger ../../../../../core/string ./ShaderBuilder2D ./graph/glsl ./graph/GlslGraphWriter ./graph/ShaderGraphContext ./graph/ShaderGraphNode ./typed/TypedShaderProgram".split(" "),
function(l,q,n,d,m,h,g,c,a,b,k){function e(u,y,A){const v=u.constructor[y]??[];u.constructor.hasOwnProperty(y)||Object.defineProperty(u.constructor,y,{value:v.slice()});u.constructor[y].push(A)}n=(u,y)=>(A,v)=>{A.constructor.builtins.push({builtin:u,propertyKey:v,typeCtor:y})};class r{}r.builtins=[];q.__decorate([n("gl_VertexID",g.Int)],r.prototype,"glVertexID",void 0);class f{}class p{}p.builtins=[];q.__decorate([n("gl_FragCoord",g.Vec4)],p.prototype,"glFragCoord",void 0);q.__decorate([n("gl_PointCoord",
g.Vec2)],p.prototype,"glPointCoord",void 0);class t{}class w{constructor(){this.type="uniform-group"}get _uniforms(){return this.constructor.uniforms??[]}}class z{constructor(){this.logShader=!1;this.computeAttributes={}}get vertexInput(){const u=this._shaderModuleClass.inputs.findLast(y=>"vertex"===y.propertyKey&&0===y.parameterIndex);if(!u)throw Error("Unable to find vertex input parameter");return u}get computeInput(){return this._shaderModuleClass.inputs.findLast(u=>"vertex"===u.propertyKey&&
1===u.parameterIndex)}get fragmentInput(){const u=this._shaderModuleClass.inputs.findLast(y=>"fragment"===y.propertyKey);if(!u)throw Error("Unable to find fragment input parameter");return u}get transformFeedbackBindings(){return this.fragmentInput.inputCtor.transformFeedbackBindings??[]}get locations(){return[...this.vertexInput.inputCtor.locations,...(this.computeInput?.inputCtor.locations??[])]}get locationsMap(){const u=new Map,y=new Set;for(const A of this.locations)y.has(A.index)?d.getLogger("esri.views.2d.engine.webgl.shaderGraph.GraphShaderModule").warnOnce("mapview-rendering",
`Unable to assigned attribute ${A.propertyKey} to ${A.index}. Index already in use`,{locationsMap:u}):(u.set(A.propertyKey,A.index),y.add(A.index));return u}get locationInfo(){if(!this._locationInfo){const u=this.locationsMap,y=Array.from(u.entries()).map(([A,v])=>`${A}.${v}`).join(".");this._locationInfo={hash:m.numericHash(y),locations:u,computeAttributeMap:this.computeAttributes}}return this._locationInfo}get renamedLocationsMap(){const u=new Map;for(const y of this.locations)u.set("a_"+y.propertyKey,
y.index);return u}get optionPropertyKeys(){if(!this._optionPropertyKeys){const u=new Set;for(const y of this._options)u.add(y.propertyKey);this._optionPropertyKeys=u}return this._optionPropertyKeys}get _shaderModuleClass(){return this.constructor}get _defines(){return this._shaderModuleClass.defines??[]}get _options(){return this._shaderModuleClass.options??[]}get _uniforms(){return this._shaderModuleClass.uniforms??[]}getProgram(u,y,A,v){try{const {vertex:x,fragment:C,uniformBindings:B}=this._generateShaders(u,
y,A,v);return new k.TypedShaderProgram(x,C,this.renamedLocationsMap,this.locationInfo,B,this.transformFeedbackBindings)}catch(x){return new k.TypedShaderProgram("","",this.renamedLocationsMap,this.locationInfo,[],this.transformFeedbackBindings)}}getDebugUniformClassInfo(u){var y=this._options.find(A=>A.propertyKey===u);if(y)return{type:"option",className:y.typeCtor};y=this._uniforms.find(A=>A.propertyKey===u);if(!y)throw Error(`Unable to find uniform class type for property: ${u}`);return{type:"required",
className:y.typeCtor}}getShaderKey(u,y,A,v){const x=Object.keys(u).map(D=>`${D}.${u[D]}`).join("."),C=Object.keys(A).map(D=>`${D}.${A[D]}`).join("."),B=Object.keys(v).map(D=>`${D}.${v[D]}`).join("."),E=Object.keys(y).filter(D=>this.optionPropertyKeys.has(D)&&y[D]).join(".");return`${this.constructor.name}.${x}.${C}.${B}.${E}`}_generateShaders(u,y,A,v){const x=[];this._setDefines(A);this._setOptionalUniforms(x,y);this._setRequiredUniforms(x);y=this._hydrateVertexInput(v);v=this._injectPackPrecisionFactor(y,
u);u=(A=this._hydrateComputeInput())&&this._injectComputePackPrecisionFactor(A,u);const C=this.vertex(v,u);u=this._hydrateFragmentInput(C);v=this.fragment(u);const B=new Set;for(var E in v)b.setReachableUids(B,v[E]);E=this._getVertexInputBuiltins();E=a.ShaderGraphContext.createVertex({...y,...A},C,E,x,this.transformFeedbackBindings,B);(new c.GlslShaderWriter).write(E);y=this._getFragmentInputBuiltins(v);y.set("glPointCoord","gl_PointCoord");y=a.ShaderGraphContext.createFragment(u,v,y,x,E,this.transformFeedbackBindings);
(new c.GlslShaderWriter).write(y);y=this._createShaderBuilder(E,y);E=y.generate("vertex",!0);y=y.generate("fragment",!0);this.logShader&&(console.log(E),console.log(y));return{vertex:E,fragment:y,uniformBindings:x}}_setDefines(u){for(const y in u)this[y]=u[y]}_setOptionalUniforms(u,y){for(const A of this._options)this[A.propertyKey]=y[A.propertyKey]?this._hydrateUniformGroup(u,A):null}_setRequiredUniforms(u){for(const y of this._uniforms)this[y.propertyKey]=this._hydrateUniformGroup(u,y)}_hydrateUniformGroup(u,
y){const A=new y.typeCtor;for(const v of A._uniforms??[]){const x=new v.typeCtor,C=`u_${y.propertyKey}_${v.propertyKey}`,B=x.type,E=[y.propertyKey,v.propertyKey].join(".");if("type"in v.typeCtor&&"array"===v.typeCtor.type){const D=x;u.push({shaderModulePath:E,uniformName:C,uniformType:B,uniformArrayLength:D.size,uniformArrayElementType:D.elementType.type,uniformHydrated:x})}else u.push({shaderModulePath:E,uniformName:C,uniformType:B,uniformHydrated:x});A[v.propertyKey]=x}return A}_hydrateVertexInput(u){var y=
this.vertexInput.inputCtor;const A=y.locations.reduce((v,x)=>!1===u[x.propertyKey]?v:{...v,[x.propertyKey]:new x.typeCtor},{});for(const {propertyKey:v,typeCtor:x}of y.builtins)y=new x,A[v]=y;return A}_hydrateComputeInput(){return null==this.computeInput?null:this.computeInput.inputCtor.locations.reduce((u,y)=>({...u,[y.propertyKey]:new y.typeCtor}),{})}_injectPackPrecisionFactor(u,y){const A={};for(const v in u){const x=u[v],C=y[v];if(C){if("float"!==x.type&&"vec2"!==x.type&&"vec3"!==x.type&&"vec4"!==
x.type)throw Error(`InternalError: packPrecisionFactor requires GenType, but found ${x.type}`);A[v]=x.divide(new g.Float(C))}else A[v]=x}return A}_injectComputePackPrecisionFactor(u,y){const A={},v=new Map;for(var x in this.computeAttributes)for(var C of this.computeAttributes[x]??[])v.set(C,x);for(const B in u)if(x=u[B],C=v.get(B))if(C=y[C]){if("float"!==x.type&&"vec2"!==x.type&&"vec3"!==x.type&&"vec4"!==x.type)throw Error(`InternalError: packPrecisionFactor requires GenType, but found ${x.type}`);
A[B]=x.divide(new g.Float(C))}else A[B]=x;return A}_hydrateFragmentInput(u){const y={};for(const A in u)y[A]=u[A];for(const {propertyKey:A,typeCtor:v}of p.builtins)u=new v,y[A]=u;return y}_getVertexInputBuiltins(){const u=this.vertexInput.inputCtor,y=new Map;for(const {builtin:A,propertyKey:v}of u.builtins)y.set(v,A);return y}_getFragmentInputBuiltins(u){u=u.constructor;const y=new Map;for(const A of u.builtins??[])y.set(A.propertyKey,A.builtin);return y}_createShaderBuilder(u,y){const A=new h.ShaderBuilder2D;
this._insertDebugInfo(A);u.insertVertexShader(A);y.insertFragmentShader(A);return A}_insertDebugInfo(u){u.vertex.code.add("// DEFINES: ");u.vertex.code.add("// --------------------------------------------------------- ");for(const y of this._defines)this[y.propertyKey]?u.vertex.code.add(`//   ${y.propertyKey}: true`):u.vertex.code.add(`//   ${y.propertyKey}: false`);u.vertex.code.add("");u.vertex.code.add("// OPTIONS: ");u.vertex.code.add("// --------------------------------------------------------- ");
for(const y of this._options)this[y.propertyKey]?u.vertex.code.add(`//   ${y.propertyKey}: true`):u.vertex.code.add(`//   ${y.propertyKey}: false`)}}l.ComputeVertexInput=f;l.FragmentInput=p;l.FragmentOutput=t;l.GraphShaderModule=z;l.UniformGroup=w;l.VertexInput=r;l.builtin=u=>(y,A)=>{e(y,"builtins",{builtin:u,propertyKey:A})};l.define=(u,y)=>{e(u,"defines",{propertyKey:y})};l.input=u=>(y,A,v)=>{e(y,"inputs",{inputCtor:u,propertyKey:A,parameterIndex:v})};l.location=function(u,y){return(A,v)=>{e(A,
"locations",{typeCtor:y,propertyKey:v,parameterIndex:null,index:u})}};l.option=u=>(y,A)=>{e(y,"options",{typeCtor:u,propertyKey:A})};l.transformFeedback=function(u){return(y,A)=>{e(y,"transformFeedbackBindings",{propertyKey:A,parameterIndex:null,index:u})}};l.uniform=u=>(y,A)=>{e(y,"uniforms",{typeCtor:u,propertyKey:A})};Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/ShaderBuilder2D":function(){define("exports ../../../../../core/Error ../../../../../core/has ../../../../../core/Logger ../../../../3d/webgl-engine/core/shaderTechnique/BindType ../../../../3d/webgl-engine/lib/Util".split(" "),
function(l,q,n,d,m,h){class g{constructor(){this._includedModules=new Map}include(t,w){this._includedModules.has(t)?this._includedModules.get(t):(this._includedModules.set(t,w),t(this.builder,w))}}class c extends g{constructor(){super(...arguments);this.vertex=new k;this.fragment=new k;this.attributes=new e;this.varyings=new r;this.extensions=new f;this.constants=new p}get fragmentUniforms(){return this.fragment.uniforms.entries}get builder(){return this}generate(t,w=!0){const z=this.extensions.generateSource(t),
u=this.attributes.generateSource(t),y=this.varyings.generateSource(t);var A="vertex"===t?this.vertex:this.fragment;const v=A.uniforms.generateSource(),x=A.code.generateSource();t="vertex"===t?"precision highp float;\nprecision highp sampler2D;":"#ifdef GL_FRAGMENT_PRECISION_HIGH\n  precision highp float;\n  precision highp sampler2D;\n#else\n  precision mediump float;\n  precision mediump sampler2D;\n#endif\n";A=this.constants.generateSource().concat(A.constants.generateSource());return`${w?"#version 300 es":
""}\n${z.join("\n")}\n${t}\n${A.join("\n")}\n${v.join("\n")}\n${u.join("\n")}\n${y.join("\n")}\n${x.join("\n")}`}generateBindPass(t){const w=new Map;this.vertex.uniforms.entries.forEach(y=>{const A=y.bind[m.BindType.Pass];A&&w.set(y.name,A)});this.fragment.uniforms.entries.forEach(y=>{const A=y.bind[m.BindType.Pass];A&&w.set(y.name,A)});const z=Array.from(w.values()),u=z.length;return(y,A)=>{for(let v=0;v<u;++v)z[v](t,y,A)}}generateBindDraw(t){const w=new Map;this.vertex.uniforms.entries.forEach(y=>
{const A=y.bind[m.BindType.Draw];A&&w.set(y.name,A)});this.fragment.uniforms.entries.forEach(y=>{const A=y.bind[m.BindType.Draw];A&&w.set(y.name,A)});const z=Array.from(w.values()),u=z.length;return(y,A,v)=>{for(let x=0;x<u;++x)z[x](t,v,y,A)}}}class a{constructor(){this._entries=new Map}add(...t){for(const w of t)this._add(w)}get(t){return this._entries.get(t)}_add(t){if(null==t)d.getLogger("esri.views.3d.webgl-engine.core.shaderModules.shaderBuilder").error(`Trying to add null Uniform from ${Error().stack}.`);
else{if(this._entries.has(t.name)&&!this._entries.get(t.name).equals(t))throw new q(`Duplicate uniform name ${t.name} for different uniform type`);this._entries.set(t.name,t)}}generateSource(){return Array.from(this._entries.values()).map(t=>null!=t.arraySize?`uniform ${t.type} ${t.name}[${t.arraySize}];`:`uniform ${t.type} ${t.name};`)}get entries(){return Array.from(this._entries.values())}}class b{constructor(){this._entries=[]}add(t){this._entries.push(t)}generateSource(){return this._entries}}
class k extends g{constructor(){super(...arguments);this.uniforms=new a;this.code=new b;this.constants=new p}get builder(){return this}}class e{constructor(){this._entries=[]}add(t,w){this._entries.push([t,w])}generateSource(t){return"fragment"===t?[]:this._entries.map(w=>`in ${w[1]} ${w[0]};`)}}class r{constructor(){this._entries=new Map}add(t,w){this._entries.has(t)&&h.assert(this._entries.get(t)===w);this._entries.set(t,w)}generateSource(t){const w=[];this._entries.forEach((z,u)=>w.push("vertex"===
t?`out ${z} ${u};`:`in ${z} ${u};`));return w}}class f{constructor(){this._entries=new Set}add(t){this._entries.add(t)}generateSource(t){const w="vertex"===t?f.ALLOWLIST_VERTEX:f.ALLOWLIST_FRAGMENT;return Array.from(this._entries).filter(z=>w.includes(z)).map(z=>`#extension ${z} : enable`)}}f.ALLOWLIST_FRAGMENT=["GL_EXT_shader_texture_lod","GL_OES_standard_derivatives"];f.ALLOWLIST_VERTEX=[];class p{constructor(){this._entries=new Set}add(t,w,z){let u="ERROR_CONSTRUCTOR_STRING";switch(w){case "float":u=
p._numberToFloatStr(z);break;case "int":u=p._numberToIntStr(z);break;case "bool":u=z.toString();break;case "vec2":u=`vec2(${p._numberToFloatStr(z[0])},                            ${p._numberToFloatStr(z[1])})`;break;case "vec3":u=`vec3(${p._numberToFloatStr(z[0])},                            ${p._numberToFloatStr(z[1])},                            ${p._numberToFloatStr(z[2])})`;break;case "vec4":u=`vec4(${p._numberToFloatStr(z[0])},                            ${p._numberToFloatStr(z[1])},                            ${p._numberToFloatStr(z[2])},                            ${p._numberToFloatStr(z[3])})`;
break;case "ivec2":u=`ivec2(${p._numberToIntStr(z[0])},                             ${p._numberToIntStr(z[1])})`;break;case "ivec3":u=`ivec3(${p._numberToIntStr(z[0])},                             ${p._numberToIntStr(z[1])},                             ${p._numberToIntStr(z[2])})`;break;case "ivec4":u=`ivec4(${p._numberToIntStr(z[0])},                             ${p._numberToIntStr(z[1])},                             ${p._numberToIntStr(z[2])},                             ${p._numberToIntStr(z[3])})`;
break;case "mat2":case "mat3":case "mat4":u=`${w}(${Array.prototype.map.call(z,y=>p._numberToFloatStr(y)).join(", ")})`}this._entries.add(`const ${w} ${t} = ${u};`);return this}static _numberToIntStr(t){return t.toFixed(0)}static _numberToFloatStr(t){return Number.isInteger(t)?t.toFixed(1):t.toString()}generateSource(){return Array.from(this._entries)}}l.Code=b;l.Includes=g;l.ShaderBuilder2D=c;l.Stage=k;l.Uniforms=a;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderTechnique/BindType":function(){define(["exports"],
function(l){l.BindType=void 0;var q=l.BindType||(l.BindType={});q[q.Pass=0]="Pass";q[q.Draw=1]="Draw";Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/Util":function(){define(["exports","../../../../core/libs/gl-matrix-2/factories/vec2f64","../../../../chunks/vec42","../../../../core/libs/gl-matrix-2/factories/vec4f64"],function(l,q,n,d){function m(c,a="Assertion"){if(!c)throw new g(`${a} at ${Error(a).stack}`);}const h=d.create();class g{constructor(c){this.message=
c}toString(){return`AssertException: ${this.message}`}}l.assert=m;l.isTranslationMatrix=function(c){return 1===c[0]&&0===c[1]&&0===c[2]&&0===c[3]&&0===c[4]&&1===c[5]&&0===c[6]&&0===c[7]&&0===c[8]&&0===c[9]&&1===c[10]&&0===c[11]&&1===c[15]};l.logWithBase=function(c,a){return Math.log(c)/Math.log(a)};l.project=function(c,a,b,k,e){h[0]=c[0];h[1]=c[1];h[2]=c[2];h[3]=1;n.transformMat4(h,h,a);2<e.length&&(e[2]=-h[2]);n.transformMat4(h,h,b);m(0!==h[3]);e[0]=h[0]/h[3];e[1]=h[1]/h[3];e[2]=h[2]/h[3];e[0]=(.5*
e[0]+.5)*k[2]+k[0];e[1]=(.5*e[1]+.5)*k[3]+k[1]};l.rayBoxTest=function(c,a,b,k){let e,r=(b[0]-c[0])/a[0],f=(k[0]-c[0])/a[0];r>f&&(e=r,r=f,f=e);let p=(b[1]-c[1])/a[1],t=(k[1]-c[1])/a[1];p>t&&(e=p,p=t,t=e);if(r>t||p>f)return!1;p>r&&(r=p);t<f&&(f=t);b=(b[2]-c[2])/a[2];c=(k[2]-c[2])/a[2];b>c&&(e=b,b=c,c=e);if(r>c||b>f)return!1;c<f&&(f=c);return 0>f?!1:!0};l.rayRay2D=function(c,a,b,k,e,r=q.create()){const f=(k[e]-b[e])*(a[0]-c[0])-(k[0]-b[0])*(a[e]-c[e]);if(0===f)return!1;b=((k[0]-b[0])*(c[e]-b[e])-(k[e]-
b[e])*(c[0]-b[0]))/f;r[0]=c[0]+b*(a[0]-c[0]);r[1]=c[e]+b*(a[e]-c[e]);return!0};l.setMatrixTranslation3=function(c,a,b,k){c[12]=a;c[13]=b;c[14]=k};l.verify=function(c,a){c||console.warn("Verify failed: "+(a||"")+"\n"+Error("verify").stack)};Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/graph/glsl":function(){define(["exports","../../../../../../chunks/tslib.es6","./ShaderGraphNode"],function(l,q,n){function d(M){switch(M.type){case "uint":return ha;
case "uvec2":return l.Vec2;case "uvec3":return l.Vec3;case "uvec4":return l.Vec4;default:throw Error("Found unexpected type");}}function m(M){switch(M.type){case "float":return l.UInt;case "vec2":return l.UVec2;case "vec3":return l.UVec3;case "vec4":return l.UVec4;default:throw Error("Found unexpected type");}}function h(M){switch(M.type){case "int":return ha;case "ivec2":return l.Vec2;case "ivec3":return l.Vec3;case "ivec4":return l.Vec4;default:throw Error("Found unexpected type");}}function g(M){switch(M.type){case "float":return la;
case "vec2":return l.IVec2;case "vec3":return l.IVec3;case "vec4":return l.IVec4;default:throw Error("Found unexpected type");}}function c(M){switch(M.type){case "bool":case "float":case "int":case "uint":return ja;case "bvec2":case "vec2":case "ivec2":case "uvec2":return l.BVec2;case "bvec3":case "vec3":case "ivec3":case "uvec3":return l.BVec3;case "bvec4":case "vec4":case "ivec4":case "uvec4":return l.BVec4;default:throw Error("Unable to handle type");}}function a(M){switch(M.type){case "float":case "int":case "uint":case "bool":case "sampler2D":return 1;
case "vec2":case "ivec2":case "uvec2":case "bvec2":return 2;case "vec3":case "ivec3":case "uvec3":case "bvec3":return 3;case "vec4":case "ivec4":case "uvec4":case "bvec4":return 4;case "mat2":return 4;case "mat3":return 9;case "mat4":return 16;case "array":return M.size*a(M.elementType)}}function b(M){const Y=[["float","vec2","vec3","vec4"],["int","ivec2","ivec3","ivec4"],["uint","uvec2","uvec3","uvec4"],["bool","bvec2","bvec3","bvec4"]];for(const da of Y)if(da.includes(M))return da.map(ia=>Da[ia]);
throw Error("Unable to find type family");}function k(M){return new Proxy(M,{get(Y,da){if("constructor"===da)return new Proxy(Y.constructor,{construct(ia,na,wa){ia=new ia(...na);return k(ia)}});if(da in Y)return Y[da];if("string"===typeof da)return Y=b(M.type),p(M,da,Y[da.length-1])}})}function e(M){return new Proxy(M,{construct(Y,da,ia){Y=new Y(...da);return k(Y)}})}function r(M){return new Proxy(M,{get(Y,da){if(da in Y)return Y[da];if("string"===typeof da&&(Y=parseInt(da,10),!isNaN(Y)))return p(M,
`[${Y}]`,M.elementType.constructor)}})}function f(M,Y){return"number"===typeof M?new Y(M):M}function p(M,Y,da){M=new da(new n.ShaderPropertyAccessNode(Y,M,da));M.isImplicit=!0;return M}function t(M,Y,da,ia=null){if(ia){const na=new ia;M=new ia(new n.ShaderFunctionNode(M,[Y,da],!0,!1,na));M.isImplicit=!0;return M}if("float"===Y.type||"int"===Y.type||("mat2"===Y.type||"mat3"===Y.type||"mat4"===Y.type)&&"float"!==da.type)return M=new da.constructor(new n.ShaderFunctionNode(M,[Y,da],!0,!1,da.constructor)),
M.isImplicit=!0,M;M=new Y.constructor(new n.ShaderFunctionNode(M,[Y,da],!0,!1,Y.constructor));M.isImplicit=!0;return M}function w(M,Y,da=Y.constructor){M=new da(new n.ShaderFunctionNode(M,[Y],!1,!1,da));M.isImplicit=!0;return M}function z(M,Y,da,ia=Y.constructor){M=new ia(new n.ShaderFunctionNode(M,[Y,da],!1,!1,ia));M.isImplicit=!0;return M}function u(M,Y,da,ia,na=Y.constructor){M=new na(new n.ShaderFunctionNode(M,[Y,da,ia],!1,!1,na));M.isImplicit=!0;return M}function y(M){return B(M,sa(-1))}function A(M,
Y,da,ia){return new Y(new n.ShaderBlockNode(M,Y,da,ia))}function v(M,Y,da=0,ia=M.size){da=(new la(da)).setMutable().setDebugName("FindIndexIterator");M=M.get(da);Y=Y(M).setDebugName("FindIndexPredicate");return A({iter:da},la,Y,({out:na,iter:wa,subgraph:za})=>`\n${na} = -1;\n\nfor (; ${wa} < ${ia}; ${wa}++) {\n\n${za.body}\n\n  if (${za.varName}) {\n    ${na} = ${wa};\n    break;\n  }\n\n}\n`).setDebugName("FindIndexBlock")}function x(M,Y,da=0,ia=M.size){return A({array:M},la,null,({out:na,array:wa})=>
`\n${na} = -1;\nfor (int i = ${da}; i < ${ia}; i++) {\n  bool condition;\n  ${Y({array:wa,i:"i",out:"condition"})}\n  if (condition) {\n    ${na} = i;\n    break;\n  }\n}\n`).setDebugName("GlslFindIndexBlock")}function C(M,Y,da){Y="function"===typeof Y?Y():Y;da="function"===typeof da?da():da;M=new Y.constructor(new n.ShaderConditionNode(M,Y,da));M.isImplicit=!0;return M}function B(M,Y){return t("*",M,Y)}function E(M,Y){return t("/",M,Y)}function D(M,Y){return t("+",M,Y)}function F(M,Y){return t("-",
M,Y)}function G(...M){return 1>=M.length?M[0]:M.slice(1).reduce((Y,da)=>H(Y,da),M[0])}function H(M,Y){return t("||",M,Y,ja)}function I(...M){return 1>=M.length?M[0]:M.slice(1).reduce((Y,da)=>t("\x26\x26",Y,da,ja),M[0])}function K(M){return w("all",M,ja)}function L(M){return w("any",M,ja)}function R(M){return w("cos",M)}function S(M){return w("sin",M)}var W,J,O,T,X,U,N,Q,P,V,Z,ba,aa,ca;class ea extends Error{}l.FixedArray=W=class extends n.ShaderPrimitiveNode{constructor(M,Y){super();this.elementType=
M;this.size=Y;this.children=[];this.type="array"}clone(){const M=new W(this.elementType,this.size);super.cloneInto(M);return M}get(M){return"number"===typeof M?(M=new la(M),M.isImplicit=!0,p(this,M,this.elementType.constructor)):p(this,M,this.elementType.constructor)}last(){return this.get(this.size-1)}first(){return this.get(0)}findIndex(M,Y,da){return v(this,M,Y,da)}glslFindIndex(M,Y,da){return x(this,M,Y,da)}static ofType(M,Y){return new Proxy(W,{construct(da,ia){return new W(new M,Y)}})}};l.FixedArray.type=
"array";l.FixedArray=W=q.__decorate([function(M){return new Proxy(M,{construct(Y,da,ia){Y=new Y(...da);return r(Y)}})}],l.FixedArray);class fa extends n.ShaderPrimitiveNode{constructor(){super(...arguments);this.type="sampler2D";this.children=[]}clone(){const M=new fa;M.children=this.children.map(n.cloneShaderNode);super.cloneInto(M);return M}}fa.type="sampler2D";class ha extends n.ShaderPrimitiveNode{constructor(M){super();this.type="float";this.children=[M]}clone(){const M=new ha(n.cloneShaderNode(this.children[0]));
super.cloneInto(M);return M}multiply(M){return"number"===typeof M?B(this,f(M,ha)):B(this,M)}divide(M){return"number"===typeof M?E(this,f(M,ha)):E(this,M)}add(M){return"number"===typeof M?D(this,f(M,ha)):D(this,M)}subtract(M){return"number"===typeof M?F(this,f(M,ha)):F(this,M)}}ha.type="float";l.Vec2=J=class extends n.ShaderPrimitiveNode{constructor(M,Y){super();this.type="vec2";this.children=[M,Y].filter(da=>null!=da)}clone(){const M=new J(n.cloneShaderNode(this.children[0]),n.cloneShaderNode(this.children[1]));
super.cloneInto(M);return M}get 0(){return p(this,"[0]",ha)}get 1(){return p(this,"[1]",ha)}get 2(){throw new ea;}get 3(){throw new ea;}multiply(M){return B(this,"number"===typeof M?f(M,ha):M)}divide(M){return E(this,"number"===typeof M?f(M,ha):M)}add(M){return D(this,"number"===typeof M?f(M,ha):M)}subtract(M){return F(this,"number"===typeof M?f(M,ha):M)}};l.Vec2.type="vec2";l.Vec2=J=q.__decorate([e],l.Vec2);l.Vec3=O=class extends n.ShaderPrimitiveNode{constructor(M,Y,da){super();this.type="vec3";
this.children=[M,Y,da].filter(ia=>null!=ia)}get 0(){return p(this,"[0]",ha)}get 1(){return p(this,"[1]",ha)}get 2(){return p(this,"[2]",ha)}get 3(){throw new ea;}clone(){const M=new O(n.cloneShaderNode(this.children[0]),n.cloneShaderNode(this.children[1]),n.cloneShaderNode(this.children[2]));super.cloneInto(M);return M}multiply(M){return B(this,"number"===typeof M?f(M,ha):M)}divide(M){return E(this,"number"===typeof M?f(M,ha):M)}add(M){return D(this,"number"===typeof M?f(M,ha):M)}subtract(M){return F(this,
"number"===typeof M?f(M,ha):M)}};l.Vec3.type="vec3";l.Vec3=O=q.__decorate([e],l.Vec3);l.Vec4=T=class extends n.ShaderPrimitiveNode{constructor(M,Y,da,ia){super();this.type="vec4";this.children=[M,Y,da,ia].filter(na=>null!=na)}clone(){const M=new T(n.cloneShaderNode(this.children[0]),n.cloneShaderNode(this.children[1]),n.cloneShaderNode(this.children[2]),n.cloneShaderNode(this.children[3]));super.cloneInto(M);return M}get 0(){return p(this,"[0]",ha)}get 1(){return p(this,"[1]",ha)}get 2(){return p(this,
"[2]",ha)}get 3(){return p(this,"[3]",ha)}multiply(M){return B(this,"number"===typeof M?f(M,ha):M)}divide(M){return E(this,"number"===typeof M?f(M,ha):M)}add(M){return D(this,"number"===typeof M?f(M,ha):M)}subtract(M){return F(this,"number"===typeof M?f(M,ha):M)}};l.Vec4.type="vec4";l.Vec4=T=q.__decorate([e],l.Vec4);l.UInt=X=class extends n.ShaderPrimitiveNode{constructor(M){super();this.type="uint";this.children=[M]}clone(){const M=new X(n.cloneShaderNode(this.children[0]));super.cloneInto(M);return M}};
l.UInt.type="uint";l.UInt=X=q.__decorate([e],l.UInt);l.UVec2=U=class extends n.ShaderPrimitiveNode{constructor(M,Y){super();this.type="uvec2";this.children=[M,Y].filter(da=>null!=da)}clone(){const M=new U(n.cloneShaderNode(this.children[0]),n.cloneShaderNode(this.children[1]));super.cloneInto(M);return M}};l.UVec2.type="uvec2";l.UVec2=U=q.__decorate([e],l.UVec2);l.UVec3=N=class extends n.ShaderPrimitiveNode{constructor(M,Y,da){super();this.type="uvec3";this.children=[M,Y,da].filter(ia=>null!=ia)}clone(){const M=
new N(n.cloneShaderNode(this.children[0]),n.cloneShaderNode(this.children[1]),n.cloneShaderNode(this.children[2]));super.cloneInto(M);return M}};l.UVec3.type="uvec3";l.UVec3=N=q.__decorate([e],l.UVec3);l.UVec4=Q=class extends n.ShaderPrimitiveNode{constructor(M,Y,da,ia){super();this.type="uvec4";this.children=[M,Y,da,ia].filter(na=>null!=na)}clone(){const M=new Q(n.cloneShaderNode(this.children[0]),n.cloneShaderNode(this.children[1]),n.cloneShaderNode(this.children[2]),n.cloneShaderNode(this.children[3]));
super.cloneInto(M);return M}};l.UVec4.type="uvec4";l.UVec4=Q=q.__decorate([e],l.UVec4);class ja extends n.ShaderPrimitiveNode{constructor(M){super();this.type="bool";this.children=[M]}and(M){return I(this,M)}or(M){return G(this,M)}clone(){const M=new ja(n.cloneShaderNode(this.children[0]));super.cloneInto(M);return M}}ja.type="bool";l.BVec2=P=class extends n.ShaderPrimitiveNode{constructor(M,Y){super();this.type="bvec2";this.children=[M,Y].filter(da=>null!=da)}all(){return K(this)}any(){return L(this)}clone(){const M=
new P(n.cloneShaderNode(this.children[0]),n.cloneShaderNode(this.children[1]));super.cloneInto(M);return M}};l.BVec2.type="bvec2";l.BVec2=P=q.__decorate([e],l.BVec2);l.BVec3=V=class extends n.ShaderPrimitiveNode{constructor(M,Y,da){super();this.type="bvec3";this.children=[M,Y,da].filter(ia=>null!=ia)}all(){return K(this)}any(){return L(this)}clone(){const M=new V(n.cloneShaderNode(this.children[0]),n.cloneShaderNode(this.children[1]),n.cloneShaderNode(this.children[2]));super.cloneInto(M);return M}};
l.BVec3.type="bvec3";l.BVec3=V=q.__decorate([e],l.BVec3);l.BVec4=Z=class extends n.ShaderPrimitiveNode{constructor(M,Y,da,ia){super();this.type="bvec4";this.children=[M,Y,da,ia].filter(na=>null!=na)}all(){return K(this)}any(){return L(this)}clone(){const M=new Z(n.cloneShaderNode(this.children[0]),n.cloneShaderNode(this.children[1]),n.cloneShaderNode(this.children[2]),n.cloneShaderNode(this.children[3]));super.cloneInto(M);return M}};l.BVec4.type="bvec4";l.BVec4=Z=q.__decorate([e],l.BVec4);class la extends n.ShaderPrimitiveNode{constructor(M){super();
this.type="int";this.children=[M]}multiply(M){return B(this,f(M,la))}add(M){return D(this,f(M,la))}subtract(M){return F(this,f(M,la))}divide(M){return E(this,f(M,la))}clone(){const M=new la(n.cloneShaderNode(this.children[0]));super.cloneInto(M);return M}}la.type="int";l.IVec2=ba=class extends n.ShaderPrimitiveNode{constructor(M,Y){super();this.type="ivec2";this.children=[M,Y].filter(da=>null!=da)}clone(){const M=new ba(n.cloneShaderNode(this.children[0]),n.cloneShaderNode(this.children[1]));super.cloneInto(M);
return M}};l.IVec2.type="ivec2";l.IVec2=ba=q.__decorate([e],l.IVec2);l.IVec3=aa=class extends n.ShaderPrimitiveNode{constructor(M,Y,da){super();this.type="ivec3";this.children=[M,Y,da].filter(ia=>null!=ia)}clone(){const M=new aa(n.cloneShaderNode(this.children[0]),n.cloneShaderNode(this.children[1]),n.cloneShaderNode(this.children[2]));super.cloneInto(M);return M}};l.IVec3.type="ivec3";l.IVec3=aa=q.__decorate([e],l.IVec3);l.IVec4=ca=class extends n.ShaderPrimitiveNode{constructor(M,Y,da,ia){super();
this.type="ivec4";this.children=[M,Y,da,ia].filter(na=>null!=na)}clone(){const M=new ca(n.cloneShaderNode(this.children[0]),n.cloneShaderNode(this.children[1]),n.cloneShaderNode(this.children[2]),n.cloneShaderNode(this.children[3]));super.cloneInto(M);return M}};l.IVec4.type="ivec4";l.IVec4=ca=q.__decorate([e],l.IVec4);class oa extends n.ShaderPrimitiveNode{constructor(M,Y,da,ia){super();this.type="mat2";this.children=[M,Y,da,ia]}clone(){const M=new oa(n.cloneShaderNode(this.children[0]),n.cloneShaderNode(this.children[1]),
n.cloneShaderNode(this.children[2]),n.cloneShaderNode(this.children[3]));super.cloneInto(M);return M}multiply(M){return B(this,M)}}oa.type="mat2";class ra extends n.ShaderPrimitiveNode{static identity(){return new ra(1,0,0,0,1,0,0,0,1)}static fromRotation(M){const Y=S(M);M=R(M);return new ra(M,Y,0,y(Y),M,0,0,0,1)}constructor(M,Y,da,ia,na,wa,za,db,Cb){super();this.type="mat3";this.children=[M,Y,da,ia,na,wa,za,db,Cb]}add(M){return D(this,M)}multiply(M){return B(this,M)}clone(){const M=new ra(n.cloneShaderNode(this.children[0]),
n.cloneShaderNode(this.children[1]),n.cloneShaderNode(this.children[2]),n.cloneShaderNode(this.children[3]),n.cloneShaderNode(this.children[4]),n.cloneShaderNode(this.children[5]),n.cloneShaderNode(this.children[6]),n.cloneShaderNode(this.children[7]),n.cloneShaderNode(this.children[8]));super.cloneInto(M);return M}}ra.type="mat3";class qa extends n.ShaderPrimitiveNode{static identity(){return new qa(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)}constructor(M,Y,da,ia,na,wa,za,db,Cb,lc,mc,Ub,nc,oc,Uc,Vc){super();
this.type="mat4";this.children=[M,Y,da,ia,na,wa,za,db,Cb,lc,mc,Ub,nc,oc,Uc,Vc]}static fromColumns(M,Y,da,ia){return new qa(M.x,M.y,M.z,M.w,Y.x,Y.y,Y.z,Y.w,da.x,da.y,da.z,da.w,ia.x,ia.y,ia.z,ia.w)}multiply(M){return B(this,M)}clone(){const M=new qa(n.cloneShaderNode(this.children[0]),n.cloneShaderNode(this.children[1]),n.cloneShaderNode(this.children[2]),n.cloneShaderNode(this.children[3]),n.cloneShaderNode(this.children[4]),n.cloneShaderNode(this.children[5]),n.cloneShaderNode(this.children[6]),n.cloneShaderNode(this.children[7]),
n.cloneShaderNode(this.children[8]),n.cloneShaderNode(this.children[9]),n.cloneShaderNode(this.children[10]),n.cloneShaderNode(this.children[11]),n.cloneShaderNode(this.children[12]),n.cloneShaderNode(this.children[13]),n.cloneShaderNode(this.children[14]),n.cloneShaderNode(this.children[15]));super.cloneInto(M);return M}}qa.type="mat4";const Da={float:ha,vec2:l.Vec2,vec3:l.Vec3,vec4:l.Vec4,int:la,ivec2:l.IVec2,ivec3:l.IVec3,ivec4:l.IVec4,uint:l.UInt,uvec2:l.UVec2,uvec3:l.UVec3,uvec4:l.UVec4,bool:ja,
bvec2:l.BVec2,bvec3:l.BVec3,bvec4:l.BVec4},sa=(...M)=>new ha(...M);l.Bool=ja;l.Float=ha;l.Int=la;l.Mat2=oa;l.Mat3=ra;l.Mat4=qa;l.Sampler2D=fa;l._or=H;l.abs=function(M){return w("abs",M)};l.acos=function(M){return w("acos",M)};l.acosh=function(M){return w("acosh",M)};l.add=D;l.all=K;l.and=I;l.any=L;l.asin=function(M){return w("asin",M)};l.asinh=function(M){return w("asinh",M)};l.atan=function(M,Y){return null==Y?w("atan",M):z("atan",M,Y,M.constructor)};l.atanh=function(M){return w("atanh",M)};l.bitAnd=
function(M,Y){return t("\x26",M,Y)};l.bitOr=function(M,Y){return t("|",M,Y)};l.bitRShift=function(M,Y){return t("\x3e\x3e",M,Y)};l.bitShift=function(M,Y){return t("\x3c\x3c",M,Y)};l.bitXor=function(M,Y){return t("^",M,Y)};l.block=A;l.ceil=function(M){return w("ceil",M)};l.clamp=function(M,Y,da){return u("clamp",M,Y,da,M.constructor)};l.cond=function(...M){var Y=M.map(([ia,na])=>"function"===typeof na?[ia,na()]:[ia,na]);M=Y[0][1].constructor;const da=Y.findIndex(ia=>!0===ia[0]);if(-1===da)throw Error("A cond must have a fallthrough case with `true`/; ");
Y=Y.slice(0,da).reduceRight((ia,na)=>C(na[0],na[1],ia),Y[da][1]);M=new M(Y);M.isImplicit=!0;return M};l.cos=R;l.cosh=function(M){return w("cosh",M)};l.cross=function(M,Y){return z("cross",M,Y,M.constructor)};l.dFdx=function(M){return w("dFdX",M)};l.dFdy=function(M){return w("dFdY",M)};l.definePropertyAccess=p;l.degrees=function(M){return w("degrees",M)};l.determinant=function(M){return w("determinant",M,ha)};l.distance=function(M,Y){return z("distance",M,Y,ha)};l.divide=E;l.dot=function(M,Y){return z("dot",
M,Y,ha)};l.equal=function(M,Y){return t("\x3d\x3d",M,Y,ja)};l.equalComponent=function(M,Y){return z("equal",M,Y,c(M))};l.exp=function(M){return w("exp",M)};l.exp2=function(M){return w("exp2",M)};l.faceforward=function(M,Y,da){return u("faceforward",M,Y,da)};l.findIndex=v;l.float=sa;l.floatBitsToInt=function(M){return w("floatBitsToInt",M,g(M))};l.floatBitsToUint=function(M){return w("floatBitsToUint",M,m(M))};l.floor=function(M){return w("floor",M)};l.fract=function(M){return w("fract",M)};l.fwidth=
function(M){return w("fwidth",M)};l.getTypeElementLengthForType=a;l.glslFindIndex=x;l.greaterThan=function(M,Y){return t("\x3e",M,Y,ja)};l.greaterThanComponent=function(M,Y){return z("greaterThan",M,Y,c(M))};l.greaterThanEqual=function(M,Y){return t("\x3e\x3d",M,Y,ja)};l.greaterThanEqualComponent=function(M,Y){return z("greaterThanEqual",M,Y,c(M))};l.ifElse=C;l.int=(...M)=>new la(...M);l.intBitsToFloat=function(M){return w("intBitsToFloat",M,h(M))};l.intMod=function(M,Y){return t("%",M,Y)};l.inverse=
function(M){return w("inverse",M,ha)};l.inversesqrt=function(M){return w("inversesqrt",M)};l.isinf=function(M){return w("isinf",M,c(M))};l.isnan=function(M){return w("isnan",M,c(M))};l.length=function(M){return w("length",M,ha)};l.lessThan=function(M,Y){return t("\x3c",M,Y,ja)};l.lessThanComponent=function(M,Y){return z("lessThan",M,Y,c(M))};l.lessThanEqual=function(M,Y){return t("\x3c\x3d",M,Y,ja)};l.lessThanEqualComponent=function(M,Y){return z("lessThanEqual",M,Y,c(M))};l.log=function(M){return w("log",
M)};l.log2=function(M){return w("log2",M)};l.mat2=(...M)=>new oa(...M);l.mat3=(...M)=>new ra(...M);l.mat4=(...M)=>new qa(...M);l.matrixCompMult=function(M,Y){return z("matrixCompMult",M,Y)};l.max=function(M,Y){return z("max",M,Y)};l.min=function(M,Y){return z("min",M,Y)};l.mix=function(M,Y,da){return u("mix",M,Y,da)};l.mod=function(M,Y){return z("mod",M,Y)};l.modf=function(M,Y){throw Error("modf not implemented");};l.multiply=B;l.namedScope=function(M,Y){M="function"===typeof M?M():M;Y=new M.constructor((new n.ShaderScopeNode(M)).setDebugName(Y));
Y.isImplicit=!0;return Y};l.negate=y;l.normalize=function(M){return w("normalize",M)};l.not=function(M){return"bool"===M.type?w("!",M):w("not",M)};l.notEqual=function(M,Y){return t("!\x3d",M,Y,ja)};l.notEqualComponent=function(M,Y){return z("notEqual",M,Y,c(M))};l.or=G;l.outerProduct=function(M,Y){throw Error("Impl type?");};l.packHalf2x16=function(M){return w("packHalf2x16",M,l.UInt)};l.packSnorm2x16=function(M){return w("packSnorm2x16",M,l.UInt)};l.packUnorm2x16=function(M){return w("packUnorm2x16",
M,l.UInt)};l.pow=function(M,Y){return z("pow",M,Y)};l.radians=function(M){return w("radians",M)};l.reflect=function(M,Y){return z("reflect",M,Y)};l.refract=function(M,Y,da){return u("refract",M,Y,da)};l.round=function(M){return w("round",M)};l.roundEven=function(M){return w("roundEven",M)};l.sign=function(M){return w("sign",M)};l.sin=S;l.sinh=function(M){return w("sinh",M)};l.smoothstep=function(M,Y,da){return u("smoothstep",M,Y,da)};l.sqrt=function(M){return w("sqrt",M)};l.step=function(M,Y){return z("step",
M,Y,Y.constructor)};l.subtract=F;l.tan=function(M){return w("tan",M)};l.tanh=function(M){return w("tanh",M)};l.texelFetch=function(M,Y,da){throw Error("Impl type");};l.texelFetchOffset=function(M,Y,da,ia){throw Error("Impl type");};l.texture=function(M,Y,da){throw Error("Impl type");};l.texture2D=function(M,Y){return z("texture",M,Y,l.Vec4)};l.textureGrad=function(M,Y,da,ia){throw Error("Impl type");};l.textureGradOffset=function(M,Y,da,ia,na){throw Error("Impl type");};l.textureLod=function(M,Y,
da){throw Error("Impl type");};l.textureLodOffset=function(M,Y,da,ia){throw Error("Impl type");};l.textureOffset=function(M,Y,da,ia){throw Error("Impl type");};l.textureProj=function(M,Y,da){throw Error("Impl type");};l.textureProjGrad=function(M,Y,da,ia){throw Error("Impl type");};l.textureProjGradOffset=function(M,Y,da,ia,na){throw Error("Impl type");};l.textureProjLod=function(M,Y,da){throw Error("Impl type");};l.textureProjLodOffset=function(M,Y,da,ia){throw Error("Impl type");};l.textureProjOffset=
function(M,Y,da,ia){throw Error("Impl type");};l.textureSize=function(M,Y){throw Error("Impl type");};l.transformFloatToInt=g;l.transformFloatToUInt=m;l.transformIntToFloat=h;l.transformTypeToBooleanType=c;l.transformUIntToFloat=d;l.transpose=function(M){return w("transpose",M)};l.trunc=function(M){return w("trunc",M)};l.uintBitsToFloat=function(M){return w("uintBitsToFloat",M,d(M))};l.unpackHalf2x16=function(M){return w("unpackHalf2x16",M,l.Vec2)};l.unpackSnorm2x16=function(M){return w("unpackSnorm2x16",
M,l.Vec2)};l.unpackUnorm2x16=function(M){return w("unpackUnorm2x16",M,l.Vec2)};l.vec2=(...M)=>new l.Vec2(...M);l.vec3=(...M)=>new l.Vec3(...M);l.vec4=(...M)=>new l.Vec4(...M);l.when=function(M,Y){M=new Y.constructor(new n.ShaderConditionNode(M,Y,null));M.isImplicit=!0;return M};Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/graph/ShaderGraphNode":function(){define(["exports"],function(l){function q(e){return e.split(" ").map((r,f)=>0<f?r.charAt(0).toUpperCase()+
r.slice(1):r).join("")}function n(e){return"object"===typeof e?e.clone():e}class d{constructor(){this.uid=d.NodeCount++;this._debugName=null;this.isImplicit=this._isMutable=!1}get isMutable(){return this._isMutable}setMutable(){this._isMutable=!0;return this}setDebugName(e){this._debugName=e=q(e);this.isImplicit&&this.children[0]instanceof d&&this.children[0].setDebugName(e);return this}get debugInfo(){return{name:this._debugName??""}}cloneInto(e){e._debugName=this._debugName;e._isMutable=this._isMutable;
e.isImplicit=this.isImplicit;e.uid=this.uid}}d.NodeCount=0;class m extends d{constructor(){super(...arguments);this.shaderType="primitive-node"}}class h extends d{constructor(e){super();this.child=e;this.shaderType="scope-node"}get children(){return[this.child]}clone(){const e=new h(n(this.child));this.cloneInto(e);return e}}class g extends d{constructor(e){super();this.text=e;this.shaderType="text-node"}get children(){return[]}clone(){const e=new g(this.text);this.cloneInto(e);return e}}class c extends d{constructor(e,
r,f){super();this.property=e;this.target=r;this.returnType=f;this.shaderType="property-access-node"}get children(){const e=[this.target];"string"!==typeof this.property&&e.push(this.property);return e}clone(){const e=new c(this.property,n(this.target),this.returnType);this.cloneInto(e);return e}}class a extends d{constructor(e,r,f){super();this.condition=e;this.ifTrue=r;this.ifFalse=f;this.shaderType="condition-node"}get children(){return[this.condition,this.ifTrue,this.ifFalse]}clone(){var e=n(this.ifTrue);
const r=this.ifFalse?n(this.ifFalse):null;e=new a(this.condition,e,r);this.cloneInto(e);return e}}class b extends d{constructor(e,r,f,p){super();this.captureList=e;this.returnType=r;this.generator=p;this.shaderType="block-node";f&&(this.subgraph=new h(f))}get children(){return Object.keys(this.captureList).map(e=>this.captureList[e]).concat(this.subgraph??[])}clone(){var e={};for(const r in this.captureList)e[r]=n(this.captureList[r]);e=new b(e,this.returnType,this.subgraph?n(this.subgraph.child):
this.subgraph,this.generator);this.cloneInto(e);return e}}class k extends d{constructor(e,r,f,p,t,w=!1){super();this.token=e;this._children=r;this.isInfix=f;this.isPropertyAccess=p;this.returnType=t;this.isTernary=w;this.shaderType="function-node"}get children(){return this._children}clone(){const e=new k(this.token,this._children.map(n),this.isInfix,this.isPropertyAccess,this.returnType,this.isTernary);this.cloneInto(e);return e}}l.ShaderBlockNode=b;l.ShaderConditionNode=a;l.ShaderFunctionNode=k;
l.ShaderNode=d;l.ShaderPrimitiveNode=m;l.ShaderPropertyAccessNode=c;l.ShaderScopeNode=h;l.ShaderTextNode=g;l.cloneShaderNode=n;l.setReachableUids=function(e,r){const f=[];for(f.push(r);f.length;)if(r=f.pop(),"object"===typeof r&&!e.has(r.uid)){e.add(r.uid);for(const p of r.children)f.push(p)}};Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/graph/GlslGraphWriter":function(){define(["exports"],function(l){function q(d,m,h){m=m.split("\n");for(const g of m)if(g.trim().length){m=
"";const c=h??"000";null!=h&&(m+=`/*id:${c}*/   `);d.body+=m.padEnd(14);d.body+=" ".repeat(d.indent)+g+"\n"}}class n{write(d){for(const m of d.rootOutputNodes())d.shouldPruneOutputNode(m)||(m.variableName=this._write(d,m.node));return d}_createVarName(d,m){let h="";"boolean"!==typeof m&&"number"!==typeof m&&m.debugInfo.name&&(h=`${m.debugInfo.name}_`);return`${h}v${d.varCount++}`}_write(d,m,h=!1){if("number"===typeof m||"boolean"===typeof m)return m.toString();let g=d.getEmit(m);if(g)return g;switch(m.shaderType){case "scope-node":g=
this._writeScopeNode(d,m);break;case "primitive-node":g=this._writePrimitiveNode(d,m,h);break;case "function-node":g=this._writeFunctionNode(d,m);break;case "property-access-node":g=this._writePropertyAccessNode(d,m);break;case "text-node":g=m.text;break;case "block-node":g=this._writeBlockNode(d,m);break;case "condition-node":g=this._writeConditionNode(d,m)}d.setEmit(m,g);return g}_writeScopeNode(d,m){var h=new m.child.constructor;h.setDebugName(m.debugInfo.name);h=this._write(d,h,!0);q(d,`{ /*ScopeStart: ${m.uid} ${m.debugInfo.name}*/`);
d.indent+=2;const g=this._write(d,m.child);q(d,`${h} = ${g};`);d.indent-=2;q(d,`} /*ScopeEnd: ${m.uid} ${m.debugInfo.name}*/`);return h}_writeConditionNode(d,m){var h=new m.ifTrue.constructor;h=this._write(d,h,!0);var g=this._write(d,m.condition);q(d,`if (${g}) {`);d.indent+=2;g=d.createSubgraphContext();const c=this._write(g,m.ifTrue);d.body+=g.body;c&&q(d,`${h} = ${c};`);d.indent-=2;q(d,"}");m.ifFalse&&(q(d,"else {"),d.indent+=2,g=d.createSubgraphContext(),m=this._write(g,m.ifFalse),d.body+=g.body,
m&&q(d,`${h} = ${m};`),d.indent-=2,q(d,"}"));return h}_writeBlockNode(d,m){const {captureList:h,generator:g,returnType:c}=m;var a={};for(var b in h)if(h[b]){var k=this._write(d,h[b]);a[b]=k}b=new c;b=this._write(d,b,!0);a.out=b;m.subgraph&&(k=d.createSubgraphContext(),m=this._write(k,m.subgraph.child),a.subgraph={varName:m,body:k.body});a=g(a);q(d,"{\n");d.indent+=2;q(d,a);d.indent-=2;q(d,"}\n");return b}_writePropertyAccessNode(d,m){const h=this._write(d,m.target);return"string"===typeof m.property&&
m.property.includes("[")?`${h}${m.property}`:"string"!==typeof m.property?(d=this._write(d,m.property),`${h}[${d}]`):`${h}.${m.property}`}_writeFunctionNode(d,m){const h=m.returnType.type;if(m.isInfix){const [a,b]=m.children.map(k=>this._write(d,k));var g=this._createVarName(d,m);q(d,`${h.padEnd(5)} ${g} = ${a} ${m.token} ${b};`,m.uid);return g}g=m.children.map(a=>this._write(d,a)).join(", ");const c=this._createVarName(d,m);q(d,`${h.padEnd(5)} ${c} = ${m.token}(${g});`,m.uid);return c}_writePrimitiveNode(d,
m,h=!1){var g=d.getInput(m);if(g)return g.isUsed=!0,g.variableName;g=1===m.children.length&&m.children[0]?.type===m.type;if(m.isImplicit||g)return this._write(d,m.children[0]);g=this._createVarName(d,m);if(h)return q(d,`${m.type.padEnd(5)} ${g};`,m.uid),g;if((h=!m.debugInfo.name&&!m.isMutable)&&"float"===m.type&&"number"===typeof m.children[0])return Number.isInteger(m.children[0])?m.children[0].toFixed(1):m.children[0].toString();if(h&&"int"===m.type&&"number"===typeof m.children[0]&&Number.isInteger(m.children[0]))return m.children[0].toString();
const c=m.children.map(a=>this._write(d,a)).join(", ");if("array"===m.type)return q(d,`${m.type.padEnd(5)} ${g} = [${c}];`,m.uid),g;if(h)return`${m.type}(${c})`;q(d,`${m.type.padEnd(5)} ${g} = ${m.type}(${c});`,m.uid);return g}}l.GlslShaderWriter=n;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/graph/ShaderGraphContext":function(){define(["exports","./ShaderGraphNode"],function(l,q){class n{constructor(h,g,c){this.variableName=h;this.variableInputType=
g;this.node=c;this.type="shader-input";this.isUsed=!1}clone(){return new n(this.variableName,this.variableInputType,q.cloneShaderNode(this.node))}}class d{constructor(h,g,c){this.outVariableName=h;this.outVariableType=g;this.node=c;this.type="shader-output"}clone(){const h=new d(this.outVariableName,this.outVariableType,q.cloneShaderNode(this.node));h.variableName=this.variableName;return h}}class m{static createVertex(h,g,c,a,b,k){const e=[];for(const r in h){const f=h[r],p=c.get(r);p?e.push(new n(p,
"builtin",f)):e.push(new n("a_"+r,"in",f))}for(const r of a)e.push(new n(r.uniformName,"uniform",r.uniformHydrated));h=[];for(const r in g)c=g[r],"glPosition"===r?h.push(new d("gl_Position","builtin",c)):"glPointSize"===r?h.push(new d("gl_PointSize","builtin",c)):h.push(new d("v_"+r,"out",c));return new m(e,h,b,k)}static createFragment(h,g,c,a,b,k){const e=[];b=Array.from(b.rootOutputNodes());for(var r in h){const p=h[r];var f=c.get(r);f?e.push(new n(f,"builtin",p)):(f=b.find(t=>t.node===p))&&e.push(new n(f.outVariableName,
"in",p))}for(const p of a)e.push(new n(p.uniformName,"uniform",p.uniformHydrated));h=[];for(const p in g)a=g[p],r=c.get(p),"discard"===p?h.push(new d(null,"discard",a)):r?h.push(new d(r,"builtin",a)):h.push(new d(p,"out",a));return new m(e,h,k)}constructor(h,g,c,a){this.type="shader-graph-context";this.indent=0;this.body="";this.varCount=0;this._inputShaderTypesByNodeUid=new Map;this._nodeEmitMap=new Map;for(const b of h)this._inputShaderTypesByNodeUid.set(b.node.uid,b);this._outputShaderTypes=g;
this._transformFeedbackBindings=c;this._transformFeedbackNames=new Set(c.map(b=>"v_"+b.propertyKey));this._usedInFragmentShader=a}shouldPruneOutputNode(h){return!this._usedInFragmentShader||"builtin"===h.outVariableType||this._transformFeedbackNames.has(h.outVariableName)?!1:!this._usedInFragmentShader.has(h.node.uid)}setEmit(h,g){this._nodeEmitMap.set(h.uid,g)}getEmit(h){return this._nodeEmitMap.get(h.uid)}inputs(){return this._inputShaderTypesByNodeUid.values()}getInput(h){return this._inputShaderTypesByNodeUid.get(h.uid)}*rootOutputNodes(){for(const h of this._outputShaderTypes)yield h}*nodes(){const h=
[];for(var g of this._outputShaderTypes.values())h.push(g.node);for(;h.length;)g=h.pop(),"number"!==typeof g&&"boolean"!==typeof g&&h.push(...g.children.filter(Boolean)),yield g}*nodesOfTypeOrFunction(){for(const h of this.nodes())"number"!==typeof h&&"boolean"!==typeof h&&(yield h)}createSubgraphContext(){const h=this.clone();h.body="";h.indent=this.indent+2;h._nodeEmitMap=new Map(this._nodeEmitMap);return h}clone(){const h=new m([],this._outputShaderTypes,this._transformFeedbackBindings,this._usedInFragmentShader);
h._inputShaderTypesByNodeUid=this._inputShaderTypesByNodeUid;h.indent=this.indent;h.body=this.body;h.varCount=this.varCount;h._nodeEmitMap=this._nodeEmitMap;return h}insertVertexShader(h){h.vertex.code.add("");this._insertInputs(h,"vertex");h.vertex.code.add("");h.vertex.code.add("// OUTPUTS: ");h.vertex.code.add("// --------------------------------------------------------- ");for(const g of this.rootOutputNodes()){const c="builtin"===g.outVariableType;this.shouldPruneOutputNode(g)||(c?h.vertex.code.add(`// ${g.outVariableType.padEnd(7)} ${g.node.type.padEnd(9)} ${g.outVariableName};`):
h.vertex.code.add(`${g.outVariableType.padEnd(10)} ${g.node.type.padEnd(9)} ${g.outVariableName};`))}h.vertex.code.add("");h.vertex.code.add("void main() {");h.vertex.code.add("  "+this.body.split("\n").join("\n  "));for(const g of this.rootOutputNodes())this.shouldPruneOutputNode(g)||h.vertex.code.add("  "+`${g.outVariableName} = ${g.variableName};`);h.vertex.code.add("}")}insertFragmentShader(h){this._insertInputs(h,"fragment");h.fragment.code.add("");h.fragment.code.add("// OUTPUTS: ");h.fragment.code.add("// --------------------------------------------------------- ");
for(const g of this.rootOutputNodes())"builtin"===g.outVariableType?h.fragment.code.add(`// ${g.outVariableType.padEnd(7)} ${g.node.type.padEnd(9)} ${g.outVariableName};`):h.fragment.code.add(`${g.outVariableType.padEnd(10)} ${g.node.type.padEnd(9)} ${g.outVariableName};`);h.fragment.code.add("");h.fragment.code.add("void main() {");h.fragment.code.add("  "+this.body.split("\n").join("\n  "));for(const g of this.rootOutputNodes())"discard"===g.outVariableType?(h.fragment.code.add("  // TODO: Should ensure codegen for discard appears first in fragment shader"),
h.fragment.code.add("  "+`if (${g.variableName}) {`),h.fragment.code.add("    discard;"),h.fragment.code.add("  }"),h.fragment.code.add("  ")):h.fragment.code.add("  "+`${g.outVariableName} = ${g.variableName};`);h.fragment.code.add("}")}_insertInputs(h,g){h[g].code.add("// INPUTS: ");h[g].code.add("// --------------------------------------------------------- ");for(const c of this.inputs())c.isUsed&&"builtin"!==c.variableInputType&&("array"===c.node.type?h[g].code.add(`${c.variableInputType.padEnd(10)} ${c.node.elementType.type.padEnd(9)} ${c.variableName}[${c.node.size}];`):
h[g].code.add(`${c.variableInputType.padEnd(10)} ${c.node.type.padEnd(9)} ${c.variableName};`))}}l.ShaderGraphContext=m;l.ShaderInput=n;l.ShaderOutput=d;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/typed/TypedShaderProgram":function(){define("exports ../../../../../../core/Error ../../../../../../core/Logger ../../../../../../core/object ../../../../../../core/RandomLCG ../../../../../../core/has ../../../../../webgl/checkWebGLError ../../../../../webgl/enums ../../../../../webgl/FramebufferObject ../../../../../webgl/Program ../../../../../webgl/GLObjectType ../../../../../webgl/Texture ../../Utils".split(" "),
function(l,q,n,d,m,h,g,c,a,b,k,e,r){function f(t,w,z){const u=w.length;u!==z&&(t=new q("Invalid Uniform",`Invalid length, expected ${z} but got ${u}`,{uniformName:t,values:w}),n.getLogger("esri.views.2d.engine.webgl.shaderGraph.typed.TypedShaderProgram").errorOnce(t))}class p{constructor(t,w,z,u,y,A){this._vao=this._program=null;this._temporaryTextures=[];this.vertexShader=t;this.fragmentShader=w;this._locations=z;this._locationInfo=u;this._uniformBindings=y;this._transformFeedbackBindings=A}destroy(){this._program&&
this._program.dispose();this.cleanupTemporaryTextures()}get locations(){return this._locations}get locationInfo(){return this._locationInfo}setUniforms(t){this._uniforms=t}cleanupTemporaryTextures(){for(const t of this._temporaryTextures)t.dispose();this._temporaryTextures=[]}bind(t){const w=this._uniforms;if(!this._program){var z=new Map;for(const [y,A]of this._locations)z.set(y,A);var u=[];for(const y of this._transformFeedbackBindings??[]){const {index:A,propertyKey:v}=y;u[A]=`v_${v}`}this._program=
new b.Program(t,this.vertexShader,this.fragmentShader,z,new Map,u)}z=this._program;t.useProgram(z);for(const y of this._uniformBindings){const {shaderModulePath:A,uniformName:v,uniformType:x,uniformArrayLength:C}=y;u=d.getDeepValue(A,w);if(null==u){if("sampler2D"===x)continue;throw Error(`Failed to find uniform value for ${A}`);}switch("array"===x?y.uniformArrayElementType:x){case "sampler2D":const {unit:B,texture:E}=u;z.setUniform1i(v,B);"type"in E?t.bindTexture(E,B):(u=r.createTexture(t,E.descriptor,
E.data),t.bindTexture(u,B));break;case "int":if(!C){z.setUniform1i(v,u);break}f(y.uniformName,u,C);z.setUniform1iv(v,u);break;case "float":if(!C){z.setUniform1f(v,u);break}f(y.uniformName,u,C);z.setUniform1fv(v,u);break;case "vec2":if(!C){z.setUniform2f(v,u[0],u[1]);break}f(y.uniformName,u,C);z.setUniform2fv(v,u.flat());break;case "vec3":if(!C){z.setUniform3f(v,u[0],u[1],u[2]);break}f(y.uniformName,u,C);z.setUniform3fv(v,u.flat());break;case "vec4":if(!C){z.setUniform4f(v,u[0],u[1],u[2],u[3]);break}f(y.uniformName,
u,C);z.setUniform4fv(v,u.flat());break;case "mat3":z.setUniformMatrix3fv(v,u);break;case "mat4":z.setUniformMatrix4fv(v,u);break;default:throw Error(`Unable to set uniform for type ${x}`);}}}}l.TypedShaderProgram=p;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/utils":function(){define(["exports","../../../definitions","../../graph/glsl","./constants"],function(l,q,n,d){function m(h,g){g=n.float(2**g);return n.mod(n.floor(h.divide(g)),
n.float(2))}l.clipToUv=function(h){return h.multiply(.5).add(.5)};l.cross2=function(h,g){return h.x.multiply(g.y).subtract(g.x.multiply(h.y))};l.getBit=m;l.getBitBool=function(h,g){return n.greaterThan(m(h,g),n.float(.5))};l.getFilterBit=function(h,g){return m(h,g+q.maxHighlightReasons)};l.getHighlightBit=function(h,g){return m(h,g)};l.isNan=function(h){return n.equal(h,n.float(d.nanMagicNumber))};l.max4=function(h){return n.max(n.max(n.max(h.x,h.y),h.z),h.w)};l.minusOne=function(h){return h.subtract(new n.Float(1))};
l.minusScalar=function(h,g){return h.subtract(new n.Float(g))};l.norm=function(h){return n.divide(h,n.float(255))};l.oneMinus=function(h){return(new n.Float(1)).subtract(h)};l.rand=function(h){const g=n.float(12.9898),c=n.float(78.233),a=n.float(43758.5453);h=n.dot(h,n.vec2(g,c));h=n.mod(h,n.float(3.14));return n.fract(n.sin(h).multiply(a))};l.rgba2float=function(h){const g=n.vec4(.99609375,255/65536,255/16777216,255/4294967296);return n.dot(h,g)};l.scalarMinus=function(h,g){return(new n.Float(h)).subtract(g)};
l.unpackDisplayIdTexel=function(h){const g=m(h.z,7),c=n.float(1).subtract(g),a=h.xyz.subtract(n.vec3(0,0,n.float(128)));return c.multiply(h).add(g.multiply(a))};l.uvToClip=function(h){return h.multiply(2).subtract(1)};Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/constants":function(){define(["exports"],function(l){l.RotationType=void 0;var q=l.RotationType||(l.RotationType={});q[q.Geographic=0]="Geographic";q[q.Arithmatic=
1]="Arithmatic";l.attrVvColor=1;l.attrVvOpacity=2;l.attrVvRotation=3;l.attrVvSize=0;l.bitsetFillRandomPatternOffset=2;l.bitsetGenericConsiderAlphaOnly=4;l.bitsetGenericLockColor=1;l.bitsetLineIsSdf=3;l.bitsetLineScaleDash=2;l.bitsetMarkerAlignmentMap=0;l.bitsetMarkerOutlineAllowColorOverride=2;l.bitsetMarkerScaleSymbolsProportionally=3;l.bitsetTextIsBackground=0;l.bitsetTextIsMapAligned=3;l.bitsetTypeFillOutline=0;l.c256ToRad=3.14159265359/128;l.cDegToRad=3.14159265359/180;l.cRadToDeg=57.29577950560105;
l.epsilon=1E-5;l.epsilonHitTest=.05;l.extrudeScalePlacementPadding=.25;l.fillPositionPrecision=1;l.magnifierBarrelFactor=1.1;l.maxFilterCount=2;l.maxRepresentableInt=16777216;l.maxSdfDistance=8;l.nanMagicNumber=1E-30;l.offsetPrecision=.125;l.outlineScale=.2;l.placementPadding=8;l.positionPrecision=.125;l.sdfFontSize=24;l.softEdgeRatio=1;l.thinLineHalfWidth=1;l.thinLineWidthFactor=1.1;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/OpacityShader":function(){define(["exports",
"../../../../../../../chunks/tslib.es6","../../GraphShaderModule","../../graph/glsl"],function(l,q,n,d){class m extends n.VertexInput{}q.__decorate([n.location(0,d.Vec2)],m.prototype,"position",void 0);class h extends n.FragmentInput{}class g extends n.UniformGroup{}q.__decorate([n.uniform(d.Sampler2D)],g.prototype,"layerTexture",void 0);q.__decorate([n.uniform(d.Float)],g.prototype,"opacity",void 0);class c extends n.GraphShaderModule{vertex(a){const b=a.position;a=new d.Vec4(a.position.subtract(new d.Vec2(.5)).multiply(2),
0,1);return{uv:b,glPosition:a}}fragment(a){const b=new n.FragmentOutput;b.glFragColor=d.texture2D(this.config.layerTexture,a.uv).multiply(this.config.opacity);return b}}q.__decorate([n.uniform(g)],c.prototype,"config",void 0);q.__decorate([q.__param(0,n.input(m))],c.prototype,"vertex",null);q.__decorate([q.__param(0,n.input(h))],c.prototype,"fragment",null);l.OpacityShader=c;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/effects/FeatureEffect":function(){define(["exports",
"./Effect","../../../../webgl/enums"],function(l,q,n){class d extends q.Effect{constructor(m){super();this.name=this.constructor.name;this.defines=[m]}dispose(){}bind({context:m,painter:h}){this._prev=m.getBoundFramebufferObject();h=h.getFbos().effect0;m.bindFramebuffer(h);m.setColorMask(!0,!0,!0,!0);m.setClearColor(0,0,0,0);m.clear(m.gl.COLOR_BUFFER_BIT)}unbind(){}draw(m,h){const {context:g,painter:c}=m;h=c.getPostProcessingEffects(h);const a=g.getBoundFramebufferObject();for(const {postProcessingEffect:b,
effect:k}of h)b.draw(m,a,k);g.bindFramebuffer(this._prev);g.setStencilTestEnabled(!1);c.blitTexture(g,a.colorTexture,n.TextureSamplingMode.NEAREST);g.setStencilTestEnabled(!0)}}l.FeatureEffect=d;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/effects/Effect":function(){define(["exports"],function(l){class q{constructor(){this.name=this.constructor.name}createOptions(n,d){return null}}l.Effect=q;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},
"esri/views/2d/engine/webgl/effects/HighlightEffect":function(){define("../../../../../core/has ../BitBlitRenderer ./Effect ./highlight/HighlightRenderer ./highlight/HighlightSurfaces ../../../../webgl/enums".split(" "),function(l,q,n,d,m,h){class g extends n.Effect{constructor(){super(...arguments);this.defines=["highlight"];this._hlRenderer=new d;this._height=this._width=void 0;this._boundFBO=null;this._hlSurfaces=new m;this._adjustedHeight=this._adjustedWidth=void 0;this._blitRenderer=new q.BitBlitRenderer}dispose(){this._hlSurfaces?.dispose();
this._hlRenderer?.dispose();this._boundFBO=null}bind(c){const {context:a,painter:b}=c,{width:k,height:e}=a.getViewport(),r=b.getFbos().effect0;this.setup(c,k,e);a.bindFramebuffer(r);a.setColorMask(!0,!0,!0,!0);a.setClearColor(0,0,0,0);a.clear(a.gl.COLOR_BUFFER_BIT)}unbind(){}setup({context:c},a,b){this._width=a;this._height=b;const k=a%4,e=b%4;a+=2>k?-k:4-k;b+=2>e?-e:4-e;this._adjustedWidth=a;this._adjustedHeight=b;this._boundFBO=c.getBoundFramebufferObject();a=Math.round(1*a);b=Math.round(1*b);this._hlRenderer.setup(c,
a,b);this._hlSurfaces.setup(c,a,b)}draw(c){const {context:a,passOptions:b}=c;c=b.activeGradient;const k=a.getBoundFramebufferObject();a.setViewport(0,0,1*this._adjustedWidth,1*this._adjustedHeight);a.bindFramebuffer(this._hlSurfaces.sharedBlur1Fbo);a.setStencilTestEnabled(!1);a.setClearColor(0,0,0,0);a.clear(a.gl.COLOR_BUFFER_BIT);this._blitRenderer.render(a,k.colorTexture,h.TextureSamplingMode.NEAREST,1);a.setStencilTestEnabled(!1);a.setBlendingEnabled(!1);a.setColorMask(!1,!1,!1,!0);a.bindFramebuffer(this._hlSurfaces.sharedBlur2Fbo);
a.setClearColor(0,0,0,0);a.clear(a.gl.COLOR_BUFFER_BIT);this._hlRenderer.preBlur(a,this._hlSurfaces.sharedBlur1Tex);a.bindFramebuffer(this._hlSurfaces.sharedBlur1Fbo);a.setClearColor(0,0,0,0);a.clear(a.gl.COLOR_BUFFER_BIT);this._hlRenderer.finalBlur(a,this._hlSurfaces.sharedBlur2Tex);a.bindFramebuffer(this._boundFBO);a.setBlendingEnabled(!0);a.setColorMask(!0,!0,!0,!0);a.setViewport(0,0,this._width,this._height);this._hlRenderer.renderHighlight(a,this._hlSurfaces.sharedBlur1Tex,c);this._boundFBO=
null}}return g})},"esri/views/2d/engine/webgl/effects/highlight/HighlightRenderer":function(){define("../../definitions ./parameters ../../shaders/HighlightPrograms ../../../../../webgl/BufferObject ../../../../../webgl/enums ../../../../../webgl/ProgramTemplate ../../../../../webgl/VertexArrayObject ../../../../../webgl/VertexElementDescriptor".split(" "),function(l,q,n,d,m,h,g,c){class a{constructor(){this._height=this._width=void 0;this._resources=null}dispose(){this._resources&&(this._resources.quadGeometry.dispose(),
this._resources.quadVAO.dispose(),this._resources.highlightProgram.dispose(),this._resources.blurProgram.dispose(),this._resources=null)}preBlur(b,k){b.bindTexture(k,l.textureBindingHighlight0);b.useProgram(this._resources.blurProgram);this._resources.blurProgram.setUniform4fv("u_direction",[1,0,1/this._width,0]);this._resources.blurProgram.setUniformMatrix4fv("u_channelSelector",q.alphaToRgbaChannelSelectorMatrix);b.bindVAO(this._resources.quadVAO);b.drawArrays(m.PrimitiveType.TRIANGLE_STRIP,0,4);
b.bindVAO()}finalBlur(b,k){b.bindTexture(k,l.textureBindingHighlight0);b.useProgram(this._resources.blurProgram);this._resources.blurProgram.setUniform4fv("u_direction",[0,1,0,1/this._height]);this._resources.blurProgram.setUniformMatrix4fv("u_channelSelector",q.rgbaToRgbaChannelSelectorMatrix);b.bindVAO(this._resources.quadVAO);b.drawArrays(m.PrimitiveType.TRIANGLE_STRIP,0,4);b.bindVAO()}renderHighlight(b,k,e){b.bindTexture(k,l.textureBindingHighlight0);b.useProgram(this._resources.highlightProgram);
e.applyHighlightOptions(b,this._resources.highlightProgram);b.bindVAO(this._resources.quadVAO);b.setBlendingEnabled(!0);b.setBlendFunction(m.BlendFactor.ONE,m.BlendFactor.ONE_MINUS_SRC_ALPHA);b.drawArrays(m.PrimitiveType.TRIANGLE_STRIP,0,4);b.bindVAO()}_initialize(b,k,e){this._width=k;this._height=e;k=d.BufferObject.createVertex(b,m.Usage.STATIC_DRAW,(new Int8Array([-1,-1,0,0,1,-1,1,0,-1,1,0,1,1,1,1,1])).buffer);e=new g.VertexArrayObject(b,new Map([["a_position",0],["a_texcoord",1]]),new Map([["geometry",
[new c.VertexElementDescriptor("a_position",2,m.DataType.BYTE,0,4),new c.VertexElementDescriptor("a_texcoord",2,m.DataType.UNSIGNED_BYTE,2,4)]]]),new Map([["geometry",k]]));const r=h.createProgram(b,n.highlight),f=h.createProgram(b,n.blur);b.useProgram(r);r.setUniform1i("u_texture",l.textureBindingHighlight0);r.setUniform1i("u_shade",l.textureBindingHighlight1);r.setUniform1f("u_sigma",q.sigma);b.useProgram(f);f.setUniform1i("u_texture",l.textureBindingHighlight0);f.setUniform1f("u_sigma",q.sigma);
this._resources={quadGeometry:k,quadVAO:e,highlightProgram:r,blurProgram:f}}setup(b,k,e){this._resources?(this._width=k,this._height=e):this._initialize(b,k,e)}}return a})},"esri/views/2d/engine/webgl/shaders/HighlightPrograms":function(){define(["exports","./sources/resolver"],function(l,q){const n={shaders:{vertexShader:q.resolveIncludes("highlight/textured.vert"),fragmentShader:q.resolveIncludes("highlight/highlight.frag")},attributes:new Map([["a_position",0],["a_texcoord",1]])};q={shaders:{vertexShader:q.resolveIncludes("highlight/textured.vert"),
fragmentShader:q.resolveIncludes("highlight/blur.frag")},attributes:new Map([["a_position",0],["a_texcoord",1]])};l.blur=q;l.highlight=n;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/effects/highlight/HighlightSurfaces":function(){define(["../../../../../webgl/enums","../../../../../webgl/FramebufferObject","../../../../../webgl/RenderbufferDescriptor","../../../../../webgl/TextureDescriptor"],function(l,q,n,d){function m(g,c,a){const b=new d.TextureDescriptor(c,
a);b.wrapMode=l.TextureWrapMode.CLAMP_TO_EDGE;return new q.FramebufferObject(g,b,new n.RenderbufferDescriptor(l.RenderbufferFormat.STENCIL_INDEX8,c,a))}class h{constructor(){this._height=this._width=void 0;this._resources=null}dispose(){this._resources&&(this._resources.sharedBlur1Fbo.dispose(),this._resources.sharedBlur2Fbo.dispose(),this._resources=null)}_initialize(g,c,a){this._width=c;this._height=a;const b=m(g,c,a);g=m(g,c,a);this._resources={sharedBlur1Fbo:b,sharedBlur2Fbo:g}}setup(g,c,a){!this._resources||
this._width===c&&this._height===a||this.dispose();this._resources||this._initialize(g,c,a)}get sharedBlur1Tex(){return this._resources.sharedBlur1Fbo.colorTexture}get sharedBlur1Fbo(){return this._resources.sharedBlur1Fbo}get sharedBlur2Tex(){return this._resources.sharedBlur2Fbo.colorTexture}get sharedBlur2Fbo(){return this._resources.sharedBlur2Fbo}}return h})},"esri/views/2d/engine/webgl/effects/HittestEffect":function(){define(["exports","../../../../../core/has","../definitions","./Effect","../../../../webgl/enums"],
function(l,q,n,d,m){class h extends d.Effect{constructor(){super(...arguments);this.name=this.constructor.name;this.defines=["hittest"]}dispose(){null!=this._fbo&&this._fbo.dispose()}createOptions({pixelRatio:g},c){if(!c.length)return null;var a=c.shift();c=a.x;const b=a.y;this._outstanding=a;a=q("esri-mobile");return{type:"hittest",distance:(a?n.hittestToleranceMobile:n.hittestToleranceDesktop)*g,smallSymbolDistance:(a?n.hittestToleranceMobile:n.hittestToleranceSmallSymbol)*g,smallSymbolSizeThreshold:n.hittestSmallSymbolThreshold,
position:[c,b]}}bind(g){const {context:c,attributeView:a}=g;a.size&&(g=a.getBlock(n.AttributeDataType.GPGPU),null!=g&&(g=g.getFBO(c),c.setViewport(0,0,a.size,a.size),c.bindFramebuffer(g),c.setColorMask(!0,!0,!0,!0),c.setClearColor(0,0,0,0),c.clear(c.gl.COLOR_BUFFER_BIT|c.gl.DEPTH_BUFFER_BIT)))}unbind(){}draw(g){if(null!=this._outstanding){var c=this._outstanding;this._outstanding=null;this._resolve(g,c.resolvers)}}async _resolve(g,c){const {context:a,attributeView:b}=g;g=b.getBlock(n.AttributeDataType.GPGPU);
if(null==g)c.forEach(r=>r.resolve([]));else{var k=g.getFBO(a);g=new Uint8Array(k.width*k.height*4);try{await k.readPixelsAsync(0,0,k.width,k.height,m.PixelFormat.RGBA,m.PixelType.UNSIGNED_BYTE,g)}catch(r){c.forEach(f=>f.resolve([]));return}var e=[];for(k=0;k<g.length;k+=4){const r=k/4;g[k]&&e.push(r)}c.forEach(r=>r.resolve(e))}}}l.HittestEffect=h;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/effects/post-processing/EffectManager":function(){define("exports ./Bloom ./Blur ./Colorize ./DropShadow ./Opacity".split(" "),
function(l,q,n,d,m,h){const g={colorize:()=>new d.Colorize,blur:()=>new n.Blur,bloom:()=>new q.Bloom,opacity:()=>new h.Opacity,"drop-shadow":()=>new m.DropShadow};class c{constructor(){this._effectMap=new Map}dispose(){this._effectMap.forEach(a=>a.dispose());this._effectMap.clear()}getPostProcessingEffects(a){if(!a||0===a.length)return[];const b=[];for(const k of a){a:switch(a=k.type,a){case "bloom":case "blur":case "opacity":case "drop-shadow":break a;default:a="colorize"}let e=this._effectMap.get(a);
e||(e=g[a](),this._effectMap.set(a,e));b.push({postProcessingEffect:e,effect:k})}return b}}l.EffectManager=c;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/effects/post-processing/Bloom":function(){define("exports ../../../../../../core/maybe ../../VertexStream ../../../../../webgl/enums ../../../../../webgl/FramebufferObject ../../../../../webgl/TextureDescriptor".split(" "),function(l,q,n,d,m,h){const g=[1,0],c=[0,1],a=[1,.8,.6,.4,.2],b=[1,1,1,1,1,1,
1,1,1,1,1,1,1,1,1];class k{constructor(){this._compositeFBO=this._intensityFBO=null;this._mipsFBOs=Array(5);this._nMips=5;this._kernelSizeArray=[3,5,7,9,11];this._size=[0,0];this._programDesc={luminosityHighPass:{vsPath:"post-processing/pp",fsPath:"post-processing/bloom/luminosityHighPass",attributes:new Map([["a_position",0]])},gaussianBlur:{vsPath:"post-processing/pp",fsPath:"post-processing/bloom/gaussianBlur",attributes:new Map([["a_position",0]])},composite:{vsPath:"post-processing/pp",fsPath:"post-processing/bloom/composite",
attributes:new Map([["a_position",0]])},blit:{vsPath:"post-processing/pp",fsPath:"post-processing/blit",attributes:new Map([["a_position",0]])}}}dispose(){this._quad=q.disposeMaybe(this._quad);this._intensityFBO=q.disposeMaybe(this._intensityFBO);this._compositeFBO=q.disposeMaybe(this._compositeFBO);if(this._mipsFBOs){for(let e=0;e<this._nMips;e++)this._mipsFBOs[e]&&(this._mipsFBOs[e].horizontal.dispose(),this._mipsFBOs[e].vertical.dispose());this._mipsFBOs=null}}draw(e,r,f){const {width:p,height:t}=
r,{context:w,painter:z}=e,{materialManager:u}=z;var y=w.gl;const A=this._programDesc,{strength:v,radius:x,threshold:C}=f;this._quad||(this._quad=new n(w,[-1,-1,1,-1,-1,1,1,1]));this._createOrResizeResources(e,p,t);w.setStencilTestEnabled(!1);w.setBlendingEnabled(!0);w.setBlendFunction(d.BlendFactor.ONE,d.BlendFactor.ONE_MINUS_SRC_ALPHA);w.setStencilWriteMask(0);e=this._quad;e.bind();w.bindFramebuffer(this._intensityFBO);f=u.getProgram(A.luminosityHighPass);w.useProgram(f);w.bindTexture(r.colorTexture,
0);f.setUniform1i("u_texture",0);f.setUniform3fv("u_defaultColor",[0,0,0]);f.setUniform1f("u_defaultOpacity",0);f.setUniform1f("u_luminosityThreshold",C);f.setUniform1f("u_smoothWidth",.01);f=[Math.round(p/2),Math.round(t/2)];w.setViewport(0,0,f[0],f[1]);w.setClearColor(0,0,0,0);w.clear(y.COLOR_BUFFER_BIT);e.draw();w.setBlendingEnabled(!1);y=this._intensityFBO.colorTexture;for(let B=0;B<this._nMips;B++){const E=u.getProgram(A.gaussianBlur,[{name:"radius",value:this._kernelSizeArray[B]}]);w.useProgram(E);
w.bindTexture(y,B+1);E.setUniform1i("u_colorTexture",B+1);E.setUniform2fv("u_texSize",f);E.setUniform2fv("u_direction",g);w.setViewport(0,0,f[0],f[1]);const D=this._mipsFBOs[B];w.bindFramebuffer(D.horizontal);e.draw();y=D.horizontal.colorTexture;w.bindFramebuffer(D.vertical);w.bindTexture(y,B+1);E.setUniform2fv("u_direction",c);e.draw();y=D.vertical.colorTexture;f[0]=Math.round(f[0]/2);f[1]=Math.round(f[1]/2)}w.setViewport(0,0,p,t);f=u.getProgram(A.composite,[{name:"nummips",value:5}]);w.bindFramebuffer(this._compositeFBO);
w.useProgram(f);f.setUniform1f("u_bloomStrength",v);f.setUniform1f("u_bloomRadius",x);f.setUniform1fv("u_bloomFactors",a);f.setUniform3fv("u_bloomTintColors",b);w.bindTexture(this._mipsFBOs[0].vertical.colorTexture,1);f.setUniform1i("u_blurTexture1",1);w.bindTexture(this._mipsFBOs[1].vertical.colorTexture,2);f.setUniform1i("u_blurTexture2",2);w.bindTexture(this._mipsFBOs[2].vertical.colorTexture,3);f.setUniform1i("u_blurTexture3",3);w.bindTexture(this._mipsFBOs[3].vertical.colorTexture,4);f.setUniform1i("u_blurTexture4",
4);w.bindTexture(this._mipsFBOs[4].vertical.colorTexture,5);f.setUniform1i("u_blurTexture5",5);e.draw();w.bindFramebuffer(r);w.setBlendingEnabled(!0);r=u.getProgram(A.blit);w.useProgram(r);w.bindTexture(this._compositeFBO.colorTexture,6);r.setUniform1i("u_texture",6);w.setBlendFunction(d.BlendFactor.ONE,d.BlendFactor.ONE);e.draw();e.unbind();w.setBlendFunction(d.BlendFactor.ONE,d.BlendFactor.ONE_MINUS_SRC_ALPHA);w.setStencilTestEnabled(!0)}_createOrResizeResources(e,r,f){({context:e}=e);if(!this._compositeFBO||
this._size[0]!==r||this._size[1]!==f){this._size[0]=r;this._size[1]=f;var p=[Math.round(r/2),Math.round(f/2)];this._compositeFBO?this._compositeFBO.resize(r,f):(r=new h.TextureDescriptor(r,f),r.internalFormat=d.PixelFormat.RGBA,r.wrapMode=d.TextureWrapMode.CLAMP_TO_EDGE,this._compositeFBO=new m.FramebufferObject(e,r));this._intensityFBO?this._intensityFBO.resize(p[0],p[1]):(r=new h.TextureDescriptor(p[0],p[1]),r.internalFormat=d.PixelFormat.RGBA,r.wrapMode=d.TextureWrapMode.CLAMP_TO_EDGE,this._intensityFBO=
new m.FramebufferObject(e,r));for(r=0;r<this._nMips;r++)this._mipsFBOs[r]?(this._mipsFBOs[r].horizontal.resize(p[0],p[1]),this._mipsFBOs[r].vertical.resize(p[0],p[1])):(f=new h.TextureDescriptor(p[0],p[1]),f.internalFormat=d.PixelFormat.RGBA,f.wrapMode=d.TextureWrapMode.CLAMP_TO_EDGE,this._mipsFBOs[r]={horizontal:new m.FramebufferObject(e,f),vertical:new m.FramebufferObject(e,f)}),p[0]=Math.round(p[0]/2),p[1]=Math.round(p[1]/2)}}}l.Bloom=k;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},
"esri/views/2d/engine/webgl/effects/post-processing/Blur":function(){define(["exports","../../VertexStream","../../../../../webgl/enums","../../../../../webgl/FramebufferObject","../../../../../webgl/TextureDescriptor"],function(l,q,n,d,m){const h=[1,0],g=[0,1];class c{constructor(){this._blurFBO=null;this._size=[0,0];this._programDesc={gaussianBlur:{vsPath:"post-processing/pp",fsPath:"post-processing/blur/gaussianBlur",attributes:new Map([["a_position",0]])},radialBlur:{vsPath:"post-processing/pp",
fsPath:"post-processing/blur/radial-blur",attributes:new Map([["a_position",0]])},blit:{vsPath:"post-processing/pp",fsPath:"post-processing/blit",attributes:new Map([["a_position",0]])}}}dispose(){this._blurFBO&&(this._blurFBO.dispose(),this._blurFBO=null)}draw(a,b,k){const {context:e}=a,{type:r,radius:f}=k;0!==f&&(this._createOrResizeResources(a),this._quad||(this._quad=new q(e,[-1,-1,1,-1,-1,1,1,1])),k=this._quad,k.bind(),"blur"===r?this._gaussianBlur(a,b,f):this._radialBlur(a,b),k.unbind())}_gaussianBlur(a,
b,k){const {context:e,state:r,painter:f,pixelRatio:p}=a;var {size:t}=r,{materialManager:w}=f;a=this._quad;t=[Math.round(p*t[0]),Math.round(p*t[1])];const z=this._blurFBO;w=w.getProgram(this._programDesc.gaussianBlur,[{name:"radius",value:Math.ceil(k)}]);e.useProgram(w);e.setBlendingEnabled(!1);e.bindFramebuffer(z);e.bindTexture(b.colorTexture,4);w.setUniform1i("u_colorTexture",4);w.setUniform2fv("u_texSize",t);w.setUniform2fv("u_direction",h);w.setUniform1f("u_sigma",k);a.draw();e.bindFramebuffer(b);
e.setStencilWriteMask(0);e.setStencilTestEnabled(!1);e.setDepthWriteEnabled(!1);e.setDepthTestEnabled(!1);e.bindTexture(z?.colorTexture,5);w.setUniform1i("u_colorTexture",5);w.setUniform2fv("u_direction",g);a.draw();e.setBlendingEnabled(!0);e.setBlendFunction(n.BlendFactor.ONE,n.BlendFactor.ONE_MINUS_SRC_ALPHA);e.setStencilTestEnabled(!0)}_radialBlur(a,b){const {context:k,painter:e}=a,{materialManager:r}=e,f=this._programDesc;a=this._quad;const p=this._blurFBO;k.bindFramebuffer(p);const t=r.getProgram(f.radialBlur);
k.useProgram(t);k.setBlendingEnabled(!1);k.bindTexture(b.colorTexture,4);t.setUniform1i("u_colorTexture",4);a.draw();k.bindFramebuffer(b);k.setStencilWriteMask(0);k.setStencilTestEnabled(!1);k.setDepthWriteEnabled(!1);k.setDepthTestEnabled(!1);k.setBlendingEnabled(!0);b=r.getProgram(f.blit);k.useProgram(b);k.bindTexture(p?.colorTexture,5);b.setUniform1i("u_texture",5);k.setBlendFunction(n.BlendFactor.ONE,n.BlendFactor.ONE_MINUS_SRC_ALPHA);a.draw()}_createOrResizeResources(a){const {context:b,state:k,
pixelRatio:e}=a;var {size:r}=k;a=Math.round(e*r[0]);r=Math.round(e*r[1]);this._blurFBO&&this._size[0]===a&&this._size[1]===r||(this._size[0]=a,this._size[1]=r,this._blurFBO?this._blurFBO.resize(a,r):(a=new m.TextureDescriptor(a,r),a.internalFormat=n.PixelFormat.RGBA,a.wrapMode=n.TextureWrapMode.CLAMP_TO_EDGE,this._blurFBO=new d.FramebufferObject(b,a)))}}l.Blur=c;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/effects/post-processing/Colorize":function(){define("exports ../../../../../../core/maybe ../../VertexStream ../../../../../webgl/enums ../../../../../webgl/Texture ../../../../../webgl/TextureDescriptor".split(" "),
function(l,q,n,d,m,h){class g{constructor(){this._layerFBOTexture=null;this._size=[0,0];this._programDesc={vsPath:"post-processing/pp",fsPath:"post-processing/filterEffect",attributes:new Map([["a_position",0]])}}dispose(){this._layerFBOTexture=q.disposeMaybe(this._layerFBOTexture)}draw(c,a,b){const {width:k,height:e}=a;this._createOrResizeResources(c,k,e);const {context:r,painter:f}=c,{materialManager:p}=f,t=this._programDesc;c=this._quad;b=b.colorMatrix;c.bind();const w=this._layerFBOTexture;r.bindFramebuffer(a);
a.copyToTexture(0,0,k,e,0,0,w);r.setBlendingEnabled(!1);r.setStencilTestEnabled(!1);a=p.getProgram(t);r.useProgram(a);r.bindTexture(w,2);a.setUniformMatrix4fv("u_coefficients",b);a.setUniform1i("u_colorTexture",2);c.draw();r.setBlendingEnabled(!0);r.setBlendFunction(d.BlendFactor.ONE,d.BlendFactor.ONE_MINUS_SRC_ALPHA);r.setStencilTestEnabled(!0);c.unbind()}_createOrResizeResources(c,a,b){({context:c}=c);if(!this._layerFBOTexture||this._size[0]!==a||this._size[1]!==b){this._size[0]=a;this._size[1]=
b;if(this._layerFBOTexture)this._layerFBOTexture.resize(a,b);else{const k=new h.TextureDescriptor;k.internalFormat=d.PixelFormat.RGBA;k.wrapMode=d.TextureWrapMode.CLAMP_TO_EDGE;k.width=a;k.height=b;this._layerFBOTexture=new m.Texture(c,k)}this._quad||(this._quad=new n(c,[-1,-1,1,-1,-1,1,1,1]))}}}l.Colorize=g;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/effects/post-processing/DropShadow":function(){define("exports ../../../../../../core/maybe ../../../../../../core/screenUtils ../../VertexStream ../../../../../webgl/enums ../../../../../webgl/FramebufferObject ../../../../../webgl/Texture ../../../../../webgl/TextureDescriptor".split(" "),
function(l,q,n,d,m,h,g,c){const a=[1,0],b=[0,1];class k{constructor(){this._verticalBlurFBO=this._horizontalBlurFBO=this._layerFBOTexture=null;this._size=[0,0];this._quad=null;this._programDesc={blur:{vsPath:"post-processing/pp",fsPath:"post-processing/blur/gaussianBlur",attributes:new Map([["a_position",0]])},composite:{vsPath:"post-processing/pp",fsPath:"post-processing/drop-shadow/composite",attributes:new Map([["a_position",0]])},blit:{vsPath:"post-processing/pp",fsPath:"post-processing/blit",
attributes:new Map([["a_position",0]])}}}dispose(){this._layerFBOTexture=q.disposeMaybe(this._layerFBOTexture);this._horizontalBlurFBO=q.disposeMaybe(this._horizontalBlurFBO);this._verticalBlurFBO=q.disposeMaybe(this._verticalBlurFBO)}draw(e,r,f){const {context:p,state:t,painter:w}=e,{materialManager:z}=w,u=this._programDesc,y=r.width,A=r.height,v=[Math.round(y),Math.round(A)],{blurRadius:x,offsetX:C,offsetY:B,color:E}=f;f=[n.pt2px(C),n.pt2px(B)];this._createOrResizeResources(e,y,A,v);const D=this._horizontalBlurFBO;
e=this._verticalBlurFBO;p.setStencilWriteMask(0);p.setStencilTestEnabled(!1);p.setDepthWriteEnabled(!1);p.setDepthTestEnabled(!1);const F=this._layerFBOTexture;r.copyToTexture(0,0,y,A,0,0,F);this._quad||(this._quad=new d(p,[-1,-1,1,-1,-1,1,1,1]));p.setViewport(0,0,v[0],v[1]);const G=this._quad;G.bind();p.setBlendingEnabled(!1);const H=z.getProgram(u.blur,[{name:"radius",value:Math.ceil(x)}]);p.useProgram(H);p.bindFramebuffer(D);p.bindTexture(r.colorTexture,4);H.setUniform1i("u_colorTexture",4);H.setUniform2fv("u_texSize",
v);H.setUniform2fv("u_direction",a);H.setUniform1f("u_sigma",x);G.draw();p.bindFramebuffer(e);p.bindTexture(D?.colorTexture,5);H.setUniform1i("u_colorTexture",5);H.setUniform2fv("u_direction",b);G.draw();p.bindFramebuffer(r);p.setViewport(0,0,y,A);r=z.getProgram(u.composite);p.useProgram(r);p.bindTexture(e?.colorTexture,2);r.setUniform1i("u_blurTexture",2);p.bindTexture(F,3);r.setUniform1i("u_layerFBOTexture",3);r.setUniform4fv("u_shadowColor",[E[0]/255*E[3],E[1]/255*E[3],E[2]/255*E[3],E[3]]);r.setUniformMatrix3fv("u_displayViewMat3",
t.displayMat3);r.setUniform2fv("u_shadowOffset",f);G.draw();p.setBlendingEnabled(!0);p.setStencilTestEnabled(!0);p.setBlendFunction(m.BlendFactor.ONE,m.BlendFactor.ONE_MINUS_SRC_ALPHA);G.unbind()}_createOrResizeResources(e,r,f,p){({context:e}=e);if(!this._horizontalBlurFBO||this._size[0]!==r||this._size[1]!==f){this._size[0]=r;this._size[1]=f;if(this._horizontalBlurFBO)this._horizontalBlurFBO.resize(p[0],p[1]);else{const t=new c.TextureDescriptor(p[0],p[1]);t.internalFormat=m.PixelFormat.RGBA;t.wrapMode=
m.TextureWrapMode.CLAMP_TO_EDGE;this._horizontalBlurFBO=new h.FramebufferObject(e,t)}this._verticalBlurFBO?this._verticalBlurFBO.resize(p[0],p[1]):(p=new c.TextureDescriptor(p[0],p[1]),p.internalFormat=m.PixelFormat.RGBA,p.wrapMode=m.TextureWrapMode.CLAMP_TO_EDGE,this._verticalBlurFBO=new h.FramebufferObject(e,p));this._layerFBOTexture?this._layerFBOTexture.resize(r,f):(p=new c.TextureDescriptor,p.internalFormat=m.PixelFormat.RGBA,p.wrapMode=m.TextureWrapMode.CLAMP_TO_EDGE,p.width=r,p.height=f,this._layerFBOTexture=
new g.Texture(e,p))}}}l.DropShadow=k;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/effects/post-processing/Opacity":function(){define(["exports","../../../../../../core/maybe","../../../../../webgl/enums","../../../../../webgl/Texture","../../../../../webgl/TextureDescriptor"],function(l,q,n,d,m){class h{constructor(){this._size=[0,0];this._layerFBOTexture=null}dispose(){this._layerFBOTexture=q.disposeMaybe(this._layerFBOTexture)}draw(g,c,a){const {width:b,
height:k}=c;this._createOrResizeResources(g,b,k);const {context:e,painter:r}=g;({amount:g}=a);a=e.gl;const f=this._layerFBOTexture;e.bindFramebuffer(c);c.copyToTexture(0,0,b,k,0,0,f);e.setBlendingEnabled(!0);e.setStencilTestEnabled(!1);e.setDepthTestEnabled(!1);e.setClearColor(0,0,0,0);e.clear(a.COLOR_BUFFER_BIT);r.blitTexture(e,f,n.TextureSamplingMode.NEAREST,g)}_createOrResizeResources(g,c,a){({context:g}=g);if(!this._layerFBOTexture||this._size[0]!==c||this._size[1]!==a)if(this._size[0]=c,this._size[1]=
a,this._layerFBOTexture)this._layerFBOTexture.resize(c,a);else{const b=new m.TextureDescriptor;b.internalFormat=n.PixelFormat.RGBA;b.wrapMode=n.TextureWrapMode.CLAMP_TO_EDGE;b.samplingMode=n.TextureSamplingMode.NEAREST;b.width=c;b.height=a;this._layerFBOTexture=new d.Texture(g,b)}}}l.Opacity=h;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/meshing/SimpleMesh":function(){define(["exports","./definitions","./Mesh","../../../../webgl/enums"],function(l,q,
n,d){const m={position:{type:d.DataType.SHORT,count:2}};class h extends n.Mesh{static create(g,c,a){var b=[],{stride:k}=c;if(null==k){k=0;for(const [,{count:r,type:f,offset:p}]of Object.entries(c.layout)){if(null!=p)throw Error("Stride cannot be computed automatically when attribute offsets are supplied explicitly.");k+=r*q.dataSizeInBytes[f]}}let e=0;for(const [r,{count:f,offset:p,type:t,normalized:w}]of Object.entries(c.layout)){null!=p&&(e=p);const z=a.get(r);if(null==z)throw Error("Locations must be specified at mesh initialization.");
b.push({name:r,location:z,vertex:"vertexData",count:f,type:t,offset:e,stride:k,divisor:0,normalized:null!=w?w:!1});e+=f*q.dataSizeInBytes[t]}a={attributes:b,primitive:c.primitive};null!=c.index&&(a.index="indexData");({count:b}=c);if(null==b&&(b=c.index?c.index.length:c.vertex.byteLength/k,Math.floor(b)!==b))throw Error(`The byte length of vertex data must be an exact multiple of the stride, which is ${k}.`);k={vertex:{vertexData:c.vertex},parts:[{start:0,count:b,group:0,primitive:c.primitive}],groups:[a]};
null!=c.index&&(k.index={indexData:c.index});return new h(g,k,c.layout)}static fromVertexStream(g,c){return h.create(g,{primitive:d.PrimitiveType.TRIANGLE_STRIP,vertex:new Uint16Array(c),layout:m},new Map([["position",0]]))}constructor(g,c,a){super(g,c);this._spec=a}bind(g,c=0){super.bind(g,c)}}l.SimpleMesh=h;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/meshing/definitions":function(){define(["exports","../../../../webgl/enums"],function(l,q){l.dataSizeInBytes=
{[q.DataType.BYTE]:1,[q.DataType.UNSIGNED_BYTE]:1,[q.DataType.SHORT]:2,[q.DataType.UNSIGNED_SHORT]:2,[q.DataType.HALF_FLOAT]:2,[q.DataType.INT]:4,[q.DataType.UNSIGNED_INT]:4,[q.DataType.FLOAT]:4};Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/meshing/Mesh":function(){define("exports ./definitions ../../../../webgl/BufferObject ../../../../webgl/enums ../../../../webgl/VertexArrayObject ../../../../webgl/VertexElementDescriptor".split(" "),function(l,q,
n,d,m,h){class g{constructor(c,a){this._boundPart=null;this.vertexBuffers=new Map;for(const [r,f]of Object.entries(a.vertex)){var b=n.BufferObject.createVertex(c,d.Usage.STATIC_DRAW,f);this.vertexBuffers.set(r,b)}b=new Map;for(const [r,f]of Object.entries(a.index??{})){var k=n.BufferObject.createIndex(c,d.Usage.STATIC_DRAW,f);b.set(r,k)}this.groups=[];for(const r of a.groups){let f;if(null!=r.index){if(!a.index?.[r.index])throw Error("No index data.");({BYTES_PER_ELEMENT:k}=a.index[r.index]);2===
k?f=d.DataType.UNSIGNED_SHORT:4===k&&(f=d.DataType.UNSIGNED_INT)}var e=null!=r.index?b.get(r.index):null;k=new Map;const p=new Map;for(const t of r.attributes){const {name:w,count:z,type:u,offset:y,normalized:A,divisor:v,stride:x,vertex:C,location:B}=t;let E=p.get(C);E||(E=[],p.set(C,E));const D=new h.VertexElementDescriptor(w,z,u,y,x,A,v);E.push(D);k.set(w,B)}e=new m.VertexArrayObject(c,k,p,this.vertexBuffers,e);this.groups.push({...r,vertexArray:e,locations:k,layout:p,indexing:f})}this.parts=a.parts}bind(c,
a){this._boundPart=a;({group:a}=this.parts[this._boundPart]);({vertexArray:a}=this.groups[a]);c.bindVAO(a)}draw(c){if(null==this._boundPart)throw Error("Mesh.bind() has not been called.");const {start:a,count:b}=this.parts[this._boundPart],{group:k}=this.parts[this._boundPart],{indexing:e,primitive:r}=this.groups[k];e?c.drawElements(r,b,e,a*q.dataSizeInBytes[e]):c.drawArrays(r,a,b)}unbind(c){this._boundPart=null;c.bindVAO(null)}destroy(){for(const {vertexArray:c}of this.groups)c.dispose()}}l.Mesh=
g;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/painter/RenderPass":function(){define(["../../../../../core/arrayUtils","../enums"],function(l,q){class n{constructor(d,m){this.brushes=d;this.name=m.name;this.drawPhase=m.drawPhase||q.WGLDrawPhase.MAP;this._targetFn=m.target;this.effects=m.effects||[];this.enableDefaultDraw=m.enableDefaultDraw??(()=>!0);this.forceDrawByDisplayOrder=!!m.forceDrawByDisplayOrder}render(d){const {context:m,profiler:h}=d,g=this._targetFn();
var c=this.drawPhase&d.drawPhase;h.recordPassStart(this.name);if(c){this.enableDefaultDraw()&&this._doRender(d,g);h.recordPassEnd();for(const a of this.effects){if(!a.enable())continue;c=a.apply;const b=a.args?.(),k=m.getViewport(),e=m.getBoundFramebufferObject(),r=d.passOptions;this._bindEffect(d,c,b);this._doRender(d,g,c.defines);this._drawAndUnbindEffect(d,c,k,e,r,b)}}}_doRender(d,m,h){if(null!=m){var {profiler:g,context:c}=d;for(const a of this.brushes){g.recordBrushStart(a.name);if(null!=a.brushEffect){const b=
c.getViewport(),k=c.getBoundFramebufferObject(),e=d.passOptions;this._bindEffect(d,a.brushEffect);this._drawWithBrush(a,d,m,h);this._drawAndUnbindEffect(d,a.brushEffect,b,k,e)}else this._drawWithBrush(a,d,m,h);g.recordBrushEnd()}}}_drawWithBrush(d,m,h,g){l.isArrayLike(h)?(d.prepareState(m,g),d.drawMany(m,h,g)):h.visible&&(d.prepareState(m,g),d.draw(m,h,g))}_bindEffect(d,m,h){const {profiler:g}=d;g.recordPassStart(this.name+"."+m.name);m.bind(d,h);m=m.createOptions(d,h);d.passOptions=m}_drawAndUnbindEffect(d,
m,h,g,c,a){const {profiler:b,context:k}=d;d.passOptions=c;b.recordBrushStart(m.name);m.draw(d,a);m.unbind(d,a);k.bindFramebuffer(g);const {x:e,y:r,width:f,height:p}=h;k.setViewport(e,r,f,p);b.recordBrushEnd();b.recordPassEnd()}}return n})},"esri/views/2d/engine/webgl/shaderGraph/techniques/TechniqueProgramCache":function(){define(["exports"],function(l){class q{constructor(){this._programCache=new Map}destroy(){for(const n of this._programCache.values())n.destroy();this._programCache.clear()}getProgram(n,
d,m,h,g){const c=n.getShaderKey(d,m,h,g);let a=this._programCache.get(c);a||(a=n.getProgram(d,m,h,g),this._programCache.set(c,a));return a}}l.TechniqueProgramCache=q;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/Profiler":function(){define(["exports","../../../../core/CircularArray","../../../../core/Evented","../../../../core/has","../../../webgl/capabilities/DisjointTimerQuery"],function(l,q,n,d,m){const h=!!d("esri-2d-profiler");class g{constructor(c,
a){this._events=new n;this._entries=new Map;this._timings=new q(10);this._currentSummary=this._currentBrush=this._currentPass=this._currentContainer=null;if(h){this._ext=m.createDisjointTimerQuery(c.gl,{});this._debugOutput=a;var b=c.gl;if(this.enableCommandLogging)for(var k in b)if("function"===typeof b[k]){const e=b[k],r=k.includes("draw");b[k]=(...f)=>{this._events.emit("command",{container:this._currentContainer,pass:this._currentPass,brush:this._currentBrush,method:k,args:f,isDrawCommand:r});
this._currentSummary&&(this._currentSummary.commands++,r&&this._currentSummary.drawCommands++);return e.apply(b,f)}}}}get enableCommandLogging(){return!("object"===typeof h&&h.disableCommands)}recordContainerStart(c){h&&(this._currentContainer=c)}recordContainerEnd(){h&&(this._currentContainer=null)}recordPassStart(c){h&&(this._currentPass=c,this._initSummary())}recordPassEnd(){h&&(this._currentPass=null,this._emitSummary())}recordBrushStart(c){h&&(this._currentBrush=c)}recordBrushEnd(){h&&(this._currentBrush=
null)}recordStart(c){if(h&&null!=this._ext){if(this._entries.has(c)){const r=this._entries.get(c);var a=this._ext.resultAvailable(r.query),b=this._ext.disjoint();if(a&&!b){a=this._ext.getResult(r.query)/1E6;b=0;if(null!=this._timings.enqueue(a)){b=this._timings.entries;const f=b.length;let p=0;for(var k of b)p+=k;b=p/f}k=a.toFixed(2);a=b?b.toFixed(2):"--";this.enableCommandLogging?(console.groupCollapsed(`Frame report for ${c}, ${k} ms (${a} last 10 avg)\n${r.commandsLen} Commands (${r.drawCommands} draw)`),
console.log("RenderPass breakdown: "),console.table(r.summaries),console.log("Commands: ",r.commands),console.groupEnd()):console.log(`Frame report for ${c}, ${k} ms (${a} last 10 avg)`);this._debugOutput.innerHTML=`${k} (${a})`}for(const f of r.handles)f.remove();this._ext.deleteQuery(r.query);this._entries.delete(c)}const e={name:c,query:this._ext.createQuery(),commands:[],commandsLen:0,drawCommands:0,summaries:[],handles:[]};this.enableCommandLogging&&(e.handles.push(this._events.on("command",
r=>{e.commandsLen++;e.commands.push(r);r.isDrawCommand&&e.drawCommands++})),e.handles.push(this._events.on("summary",r=>{e.summaries.push(r)})));this._ext.beginTimeElapsed(e.query);this._entries.set(c,e)}}recordEnd(c){h&&null!=this._ext&&this._entries.has(c)&&this._ext.endTimeElapsed()}_initSummary(){this.enableCommandLogging&&(this._currentSummary={container:this._currentContainer,pass:this._currentPass,drawCommands:0,commands:0})}_emitSummary(){this.enableCommandLogging&&this._currentSummary&&this._events.emit("summary",
this._currentSummary)}}l.Profiler=g;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/core/CircularArray":function(){define(function(){class l{constructor(q){this._start=this.size=0;this.maxSize=q;this._buffer=Array(q)}get entries(){return this._buffer}enqueue(q){if(this.size===this.maxSize){const n=this._buffer[this._start];this._buffer[this._start]=q;this._start=(this._start+1)%this.maxSize;return n}this._buffer[(this._start+this.size++)%this.maxSize]=q;return null}dequeue(){if(0===
this.size)return null;const q=this._buffer[this._start];this._buffer[this._start]=null;this.size--;this._start=(this._start+1)%this.maxSize;return q}peek(){return 0===this.size?null:this._buffer[this._start]}peekLast(){return 0===this.size?null:this._buffer[(this._start+(this.size-1))%this.maxSize]}find(q){if(0===this.size)return null;for(const n of this._buffer)if(null!=n&&q(n))return n;return null}clear(q){let n=this.dequeue();for(;null!=n;)q&&q(n),n=this.dequeue()}}return l})},"esri/views/webgl/capabilities/DisjointTimerQuery":function(){define(["exports"],
function(l){class q{constructor(n,d,m,h,g,c,a,b,k){this.createQuery=n;this.deleteQuery=d;this.resultAvailable=m;this.getResult=h;this.disjoint=g;this.beginTimeElapsed=c;this.endTimeElapsed=a;this.createTimestamp=b;this.timestampBits=k}}l.hasRunningElapsedTimer=!1;l.DisjointTimerQuery=q;l.createDisjointTimerQuery=function(n,d){if(d.disjointTimerQuery)return null;let m=n.getExtension("EXT_disjoint_timer_query_webgl2");return m?new q(()=>n.createQuery(),h=>{n.deleteQuery(h);l.hasRunningElapsedTimer=
!1},h=>n.getQueryParameter(h,n.QUERY_RESULT_AVAILABLE),h=>n.getQueryParameter(h,n.QUERY_RESULT),()=>n.getParameter(m.GPU_DISJOINT_EXT),h=>{l.hasRunningElapsedTimer||(l.hasRunningElapsedTimer=!0,n.beginQuery(m.TIME_ELAPSED_EXT,h))},()=>{n.endQuery(m.TIME_ELAPSED_EXT);l.hasRunningElapsedTimer=!1},h=>m.queryCounterEXT(h,m.TIMESTAMP_EXT),()=>n.getQuery(m.TIMESTAMP_EXT,m.QUERY_COUNTER_BITS_EXT)):(m=n.getExtension("EXT_disjoint_timer_query"))?new q(()=>m.createQueryEXT(),h=>{m.deleteQueryEXT(h);l.hasRunningElapsedTimer=
!1},h=>m.getQueryObjectEXT(h,m.QUERY_RESULT_AVAILABLE_EXT),h=>m.getQueryObjectEXT(h,m.QUERY_RESULT_EXT),()=>n.getParameter(m.GPU_DISJOINT_EXT),h=>{l.hasRunningElapsedTimer||(l.hasRunningElapsedTimer=!0,m.beginQueryEXT(m.TIME_ELAPSED_EXT,h))},()=>{m.endQueryEXT(m.TIME_ELAPSED_EXT);l.hasRunningElapsedTimer=!1},h=>m.queryCounterEXT(h,m.TIMESTAMP_EXT),()=>m.getQueryEXT(m.TIMESTAMP_EXT,m.QUERY_COUNTER_BITS_EXT)):null};Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/TileReshuffleManager":function(){define(["exports"],
function(l){class q{constructor(){this._candidateTiles=[]}schedule(n){this._candidateTiles.includes(n)||this._candidateTiles.push(n)}reshuffle(n){const d=[];for(const m of this._candidateTiles)0<n?(m.reshuffle(),n--):d.push(m);this._candidateTiles=d}}l.TileReshuffleManager=q;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/TechniqueRegistry":function(){define("exports ./animated/AnimatedMarkerTechnique ./dotDensity/DotDensityTechnique ./fill/ComplexFillTechnique ./fill/ComplexOutlineFillTechnique ./fill/FillTechnique ./fill/OutlineFillTechnique ./fill/PatternFillTechnique ./fill/PatternOutlineFillTechnique ./heatmap/HeatmapTechnique ./labels/LabelTechnique ./line/LineTechnique ./line/TexturedLineTechnique ./markers/MarkerTechnique ./pieChart/PieChartTechnique ./text/TextTechnique".split(" "),
function(l,q,n,d,m,h,g,c,a,b,k,e,r,f,p,t){const w={fill:new h.FillTechnique,patternFill:new c.PatternFillTechnique,complexFill:new d.ComplexFillTechnique,outlineFill:new g.OutlineFillTechnique,patternOutlineFill:new a.PatternOutlineFillTechnique,complexOutlineFill:new m.ComplexOutlineFillTechnique,marker:new f.MarkerTechnique,pieChart:new p.PieChartTechnique,line:new e.LineTechnique,texturedLine:new r.TexturedLineTechnique,text:new t.TextTechnique,label:new k.LabelTechnique,heatmap:new b.HeatmapTechnique,
dotDensity:new n.DotDensityTechnique,animatedMarker:new q.AnimatedMarkerTechnique};l.Techniques=w;l.shutdown=function(z){for(const u in w)w[u].shutdown(z)};l.startup=function(){for(const z in w)w[z].startup()};Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/animated/AnimatedMarkerTechnique":function(){define(["exports","../TechniqueType","./AnimatedMarkerShader","./AnimatedTechnique"],function(l,q,n,d){class m extends d.AnimatedTechnique{constructor(){super(...arguments);
this.type=q.TechniqueType.AnimatedMarker;this.shaders={geometry:new n.AnimatedMarkerShader}}}l.AnimatedMarkerTechnique=m;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/animated/AnimatedMarkerShader":function(){define("exports ../../../../../../../chunks/tslib.es6 ../../../../../../../symbols/cim/animationDebugFlags ../../GraphShaderModule ../../graph/glsl ./AnimatedShader ./enums ../markers/markerConstants ../shaders/constants ../shaders/hittestUtils ../shaders/utils ../shaders/vvUtils".split(" "),
function(l,q,n,d,m,h,g,c,a,b,k,e){function r(z,u,y,A){return u.multiply(z.x).add(y.multiply(z.y)).add(A.multiply(z.z))}class f extends h.AAnimatedVertexInput{}q.__decorate([d.location(5,m.Vec2)],f.prototype,"offset",void 0);q.__decorate([d.location(6,m.Vec2)],f.prototype,"uv",void 0);q.__decorate([d.location(7,m.Vec4)],f.prototype,"sizing",void 0);q.__decorate([d.location(8,m.Float)],f.prototype,"angle",void 0);class p extends d.ComputeVertexInput{}q.__decorate([d.location(12,m.Vec2)],p.prototype,
"offsetNextVertex1",void 0);q.__decorate([d.location(13,m.Vec2)],p.prototype,"offsetNextVertex2",void 0);q.__decorate([d.location(14,m.Vec2)],p.prototype,"textureUVNextVertex1",void 0);q.__decorate([d.location(15,m.Vec2)],p.prototype,"textureUVNextVertex2",void 0);class t extends h.AAnimatedFragmentInput{}class w extends h.AAnimatedShader{constructor(){super(...arguments);this.computeAttributes={offset:["offsetNextVertex1","offsetNextVertex2"],uv:["textureUVNextVertex1","textureUVNextVertex2"]}}_vertexPreamble(z){const {id:u,
pos:y,offset:A,animationPointerAndBaseSizeAndReferenceSize:v,uv:x,sizing:C,angle:B}=z,E=v.xy,D=v.z;var F=v.w,G=C.xy;const H=C.z,I=k.getBit(z.bitset,c.MarkerConstants.bitset.isStroke),K=C.w,L=k.getBit(z.bitset,c.MarkerConstants.bitset.scaleSymbolsProportionally);G=this._getEvalParams(z,G);var R=h.getValue(E,g.AnimationParamIndex.transform,G),S=m.cond([m.equal(k.getBit(z.bitset,c.MarkerConstants.bitset.isMapAligned),new m.Float(1)),this.view.rotation.divide(180).multiply(Math.PI)],[!0,new m.Float(0)]);
const W=(new m.Mat2(m.cos(S),m.sin(S.multiply(-1)),m.sin(S),m.cos(S))).multiply(R.xy);S=R.z.subtract(S).subtract(B.multiply(a.c256ToRad));R=R.w;z=k.getBit(z.bitset,c.MarkerConstants.bitset.isSDF);const J=e.getVisualVariableSize(this,u,new m.Float(F)).divide(new m.Float(F));F=this._getScreenPosition({id:u,pos:y,offset:A,referenceSize:F,translation:W,rotation:S,scale:R,vvScale:J});return{baseSize:D,animationPointer:E,strokeWidth:H,isOutline:I,unscaledDistanceToPx:K,scaleSymbolsProportionally:L,isSDF:z,
position:F,uv:x,evalParams:G,vvScale:J,scale:R}}vertex(z,u){const {position:y,animationPointer:A,evalParams:v,isOutline:x,unscaledDistanceToPx:C,vvScale:B,uv:E,strokeWidth:D,scaleSymbolsProportionally:F,scale:G,isSDF:H,baseSize:I}=this._vertexPreamble(z),K=this._toNdc(y);var L=h.getValue(A,g.AnimationParamIndex.fromColor,v);L=new m.Vec4(L.rgb.multiply(L.a),L.a);var R=h.getValue(A,g.AnimationParamIndex.toColor,v);R=new m.Vec4(R.rgb.multiply(R.a),R.a);var S=h.getValue(A,g.AnimationParamIndex.colorMix,
v);S=new m.Vec4(S.rgb.multiply(S.a),S.a);var W=h.getValue(A,g.AnimationParamIndex.toOpacity,v).a,J=h.getValue(A,g.AnimationParamIndex.opacityMix,v).a;L=e.getVisualVariableColor(this,z.id,L,m.or(k.getBitBool(z.bitset,c.MarkerConstants.bitset.colorLocked),new m.Bool(x)));R=m.mix(L,R,S);S=e.getVisualVariableOpacity(this,z.id);W=m.mix(S,W,J);W=R.multiply(W);J=this.clip(z.id,z.zoomRange);R=C.multiply(B);return{glPosition:new m.Vec4(K,J,1),uv:E.divide(this.mosaicInfo.size),color:W.multiply((new m.Float(1)).subtract(x)),
outlineColor:W.multiply(x),distanceToPx:R,strokeWidth:D.multiply(m.mix(new m.Float(1),G,F)),isOutline:x,isSDF:H,...this.maybeRunHittest(z,u,{pos:z.pos,size:I,sizeCorrection:new m.Float(1),isMapAligned:new m.Float(1),vvRotationMat3:new m.Mat3(1,0,0,0,1,0,0,0,1),placementMat3:new m.Mat3(1,0,0,0,1,0,0,0,1),outlineSize:new m.Float(1),distanceToPx:R,isSDF:H})}}fragment(z){let u=this._getColor(z.uv,{color:z.color,distanceToPx:z.distanceToPx,isSDF:z.isSDF,outlineColor:z.outlineColor,outlineSize:z.strokeWidth});
n.animationDebugFlags.spotlightAnimatedSymbols&&(u=u.add(new m.Vec4(0,.3,0,.3)));return this.getFragmentOutput(u,z)}hittest(z,u,y){return m.ifElse(m.lessThan(y.size,this.hittestRequest.smallSymbolSizeThreshold),this._hittestSmallMarker(z,u,y),this._hittestMarker(z,u,y))}_hittestSmallMarker(z,u,y){const {position:A,distance:v,smallSymbolDistance:x}=this.hittestRequest;z=v.subtract(x);const {viewMat3:C,tileMat3:B}=this.view;u=C.multiply(B).multiply(new m.Vec3(y.pos,1)).xy;y=y.size.multiply(.5);return m.distance(u,
A).subtract(y).add(z)}_hittestMarker(z,u,y){const A=this._vertexPreamble({...z}).position,v=this._vertexPreamble({...z,offset:u.offsetNextVertex1,uv:u.textureUVNextVertex1}).position,x=this._vertexPreamble({...z,offset:u.offsetNextVertex2,uv:u.textureUVNextVertex2}).position,C=this.hittestRequest.distance,B=b.distPointTriangle(this.hittestRequest.position,A,v,x);return m.ifElse(m.greaterThan(B,C),B,this._hittestSamples(A,v,x,z,u,y))}_hittestSamples(z,u,y,A,v,x){const {outlineSize:C,isSDF:B,distanceToPx:E}=
x;var D=this.hittestRequest.position;const F=this.hittestRequest.distance;x=b.xyToBarycentric(D.add(new m.Vec2(m.negate(F),m.negate(F))),z,u,y);const G=b.xyToBarycentric(D.add(new m.Vec2(0,m.negate(F))),z,u,y),H=b.xyToBarycentric(D.add(new m.Vec2(F,m.negate(F))),z,u,y),I=b.xyToBarycentric(D.add(new m.Vec2(m.negate(F),0)),z,u,y),K=b.xyToBarycentric(D,z,u,y),L=b.xyToBarycentric(D.add(new m.Vec2(F,0)),z,u,y),R=b.xyToBarycentric(D.add(new m.Vec2(m.negate(F),F)),z,u,y),S=b.xyToBarycentric(D.add(new m.Vec2(0,
F)),z,u,y);z=b.xyToBarycentric(D.add(new m.Vec2(F,F)),z,u,y);A=A.uv.divide(this.mosaicInfo.size);u=v.textureUVNextVertex1.divide(this.mosaicInfo.size);v=v.textureUVNextVertex2.divide(this.mosaicInfo.size);y={color:new m.Vec4(1,1,1,1),outlineSize:C,outlineColor:new m.Vec4(1,1,1,1),isSDF:B,distanceToPx:E};D=new m.Float(0);D=D.add(b.inTriangle(x).multiply(this._getColor(r(x,A,u,v),y).a));D=D.add(b.inTriangle(G).multiply(this._getColor(r(G,A,u,v),y).a));D=D.add(b.inTriangle(H).multiply(this._getColor(r(H,
A,u,v),y).a));D=D.add(b.inTriangle(I).multiply(this._getColor(r(I,A,u,v),y).a));D=D.add(b.inTriangle(K).multiply(this._getColor(r(K,A,u,v),y).a));D=D.add(b.inTriangle(L).multiply(this._getColor(r(L,A,u,v),y).a));D=D.add(b.inTriangle(R).multiply(this._getColor(r(R,A,u,v),y).a));D=D.add(b.inTriangle(S).multiply(this._getColor(r(S,A,u,v),y).a));D=D.add(b.inTriangle(z).multiply(this._getColor(r(z,A,u,v),y).a));return m.step(D,new m.Float(.05)).multiply(b.failHittest(this.hittestRequest))}}q.__decorate([q.__param(0,
d.input(f)),q.__param(1,d.input(p))],w.prototype,"vertex",null);q.__decorate([q.__param(0,d.input(t))],w.prototype,"fragment",null);l.AnimatedMarkerFragmentInput=t;l.AnimatedMarkerShader=w;l.AnimatedMarkerVertexInput=f;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/animated/AnimatedShader":function(){define("exports ../../../../../../../chunks/tslib.es6 ../../../../../../../symbols/cim/animationDebugFlags ../../../animations/instructions ../../GraphShaderModule ../../graph/glsl ./AnimationUniformInfo ../shaders/AFeatureShader ../shaders/constants ../shaders/MosaicInfo ../shaders/utils ../shaders/VisualVariableColor ../shaders/VisualVariableOpacity ../shaders/VisualVariableRotation ../shaders/VisualVariableSizeMinMaxValue ../shaders/VisualVariableSizeScaleStops ../shaders/VisualVariableSizeStops ../shaders/VisualVariableSizeUnitValue ../shaders/vvUtils".split(" "),
function(l,q,n,d,m,h,g,c,a,b,k,e,r,f,p,t,w,z,u){class y extends c.FeatureVertexInput{}q.__decorate([m.location(3,h.Vec4)],y.prototype,"animationPointerAndBaseSizeAndReferenceSize",void 0);q.__decorate([m.location(4,h.Vec2)],y.prototype,"zoomRange",void 0);class A extends c.FeatureFragmentInput{}class v extends c.AFeatureShader{_getScreenPosition(x){const {pos:C,translation:B,rotation:E,scale:D,offset:F,id:G,vvScale:H}=x;var I=u.getVisualVariableAngle(this,G).multiply(Math.PI/180);x=B.x.multiply(4/
3);const K=B.y.multiply(-1).multiply(4/3);var L=h.sin(E.subtract(I));const R=h.cos(E.subtract(I)),S=new h.Float(0),W=new h.Float(1);({pixelRatio:I}=this.animationInfo);x=new h.Mat3(W,S,S,S,W,S,x.multiply(I),K.multiply(I),W);L=new h.Mat3(R,L.multiply(-1),S,L,R,S,0,0,W);I=D.multiply(H).multiply(I).multiply(4/3);L=L.multiply(I);I=this.animationInfo.toScreen.multiply(new h.Vec3(C,1));x=x.multiply(I).xy;L=L.multiply(new h.Vec3(F,0)).xy;return x.add(L)}_clip(x,C){C=super.clip(x,C);x=h.lessThanEqual(this._getLocalTimeOrigin(x),
new h.Float(0));n.animationDebugFlags.forceGlobalTimeOrigin||(C=C.add(h.cond([x,()=>new h.Float(2)],[!0,()=>new h.Float(0)])));return C}_getLocalTimeOrigin(x){return this.storage.getLocalTimeOrigin(x)}_toNdc(x){return this.animationInfo.toNdc.multiply(new h.Vec3(x,1)).xy}_getEvalParams(x,C){const {globalTime:B,animationTextureSize:E,animationTexture:D}=this.animationInfo;return{globalTime:B,localTimeOrigin:this._getLocalTimeOrigin(x.id),animationTextureSize:E,animationTexture:D,pixelDimensions:C}}_getColor(x,
C){return h.ifElse(h.equal(C.isSDF,new h.Float(1)),this._getSDFColor(x,C),this._getSpriteColor(x,C))}_getSpriteColor(x,C){return h.texture2D(this.mosaicInfo.texture,x).multiply(C.color)}_getSDFColor(x,C){x=h.texture2D(this.mosaicInfo.texture,x);var B=(new h.Float(.5)).subtract(k.rgba2float(x)).multiply(C.distanceToPx).multiply(a.softEdgeRatio);x=h.clamp((new h.Float(.5)).subtract(B),new h.Float(0),new h.Float(1));x=C.color.multiply(x);const E=C.outlineSize.multiply(.5);B=h.abs(B).subtract(E);B=h.clamp((new h.Float(.5)).subtract(B),
new h.Float(0),new h.Float(1));C=C.outlineColor.multiply(B);return(new h.Float(1)).subtract(C.a).multiply(x).add(C)}}q.__decorate([m.uniform(b.MosaicInfo)],v.prototype,"mosaicInfo",void 0);q.__decorate([m.uniform(g.AnimationUniformInfo)],v.prototype,"animationInfo",void 0);q.__decorate([m.option(e.VisualVariableColor)],v.prototype,"visualVariableColor",void 0);q.__decorate([m.option(r.VisualVariableOpacity)],v.prototype,"visualVariableOpacity",void 0);q.__decorate([m.option(p.VisualVariableSizeMinMaxValue)],
v.prototype,"visualVariableSizeMinMaxValue",void 0);q.__decorate([m.option(t.VisualVariableSizeScaleStops)],v.prototype,"visualVariableSizeScaleStops",void 0);q.__decorate([m.option(w.VisualVariableSizeStops)],v.prototype,"visualVariableSizeStops",void 0);q.__decorate([m.option(z.VisualVariableSizeUnitValue)],v.prototype,"visualVariableSizeUnitValue",void 0);q.__decorate([m.option(f.VisualVariableRotation)],v.prototype,"visualVariableRotation",void 0);l.AAnimatedFragmentInput=A;l.AAnimatedShader=
v;l.AAnimatedVertexInput=y;l.getValue=function(x,C,B){C=x.add(new h.Vec2(C,0));C=h.texture2D(B.animationTexture,C.add(.5).divide(B.animationTextureSize)).xy;x=x.add(C);return h.block({animationPointer:x,...B},h.Vec4,null,E=>{const {out:D}=E;if(!D)throw Error("out is null");return d.generateVirtualMachineSource({...E,out:D})})};Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/animated/AnimationUniformInfo":function(){define(["exports",
"../../../../../../../chunks/tslib.es6","../../GraphShaderModule","../../graph/glsl"],function(l,q,n,d){class m extends n.UniformGroup{}q.__decorate([n.uniform(d.Float)],m.prototype,"globalTime",void 0);q.__decorate([n.uniform(d.Vec2)],m.prototype,"animationTextureSize",void 0);q.__decorate([n.uniform(d.Sampler2D)],m.prototype,"animationTexture",void 0);q.__decorate([n.uniform(d.Mat3)],m.prototype,"toScreen",void 0);q.__decorate([n.uniform(d.Mat3)],m.prototype,"toNdc",void 0);q.__decorate([n.uniform(d.Float)],
m.prototype,"mapRotation",void 0);q.__decorate([n.uniform(d.Float)],m.prototype,"pixelRatio",void 0);l.AnimationUniformInfo=m;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/AFeatureShader":function(){define("exports ../../../../../../../chunks/tslib.es6 ../../../definitions ../../GraphShaderModule ../../graph/glsl ./EntityStorage ./ShaderHighlight ./ShaderHittest ./utils ./ViewInfo".split(" "),function(l,q,n,d,m,h,g,c,a,b){class k extends d.VertexInput{}
q.__decorate([d.location(0,m.Vec3)],k.prototype,"id",void 0);q.__decorate([d.location(1,m.Float)],k.prototype,"bitset",void 0);q.__decorate([d.location(2,m.Vec2)],k.prototype,"pos",void 0);class e extends d.ComputeVertexInput{}q.__decorate([d.location(14,m.Vec2)],e.prototype,"nextPos1",void 0);q.__decorate([d.location(15,m.Vec2)],e.prototype,"nextPos2",void 0);class r extends d.FragmentInput{}class f extends d.GraphShaderModule{clip(p,t){let w=new m.Float(0);p=this.storage.getFilterFlags(p);w=w.add(m.float(2).multiply(m.float(1).subtract(a.getFilterBit(p,
0))));this.inside?w=w.add(m.float(2).multiply(m.float(1).subtract(a.getFilterBit(p,1)))):this.outside?w=w.add(m.float(2).multiply(a.getFilterBit(p,1))):this.highlight&&(w=w.add(m.float(2).multiply(m.float(1).subtract(this._checkHighlight(p)))));null!=t&&(p=(new m.Float(1)).subtract(m.step(t.x,this.view.currentZoom)),t=m.step(t.y,this.view.currentZoom),w=w.add((new m.Float(2)).multiply(p.add(t))));return w}getFragmentOutput(p,t,w=new m.Float(1/255)){const z=new d.FragmentOutput;z.glFragColor=this._maybeWriteHittest(t)??
this._maybeHighlight(p,w)??p;return z}_maybeHighlight(p,t){return this.highlight?new m.Vec4(p.rgb,m.step(t,p.a)):null}_checkHighlight(p){let t=this._checkHighlightBit(p,0);for(let w=1;w<n.maxHighlightReasons;w++)t=t.add(this._checkHighlightBit(p,w));return m.step(new m.Float(.1),t.add(this.highlight.highlightAll))}_checkHighlightBit(p,t){return a.getHighlightBit(p,t).multiply(a.getBit(this.highlight.activeReasons,t))}maybeRunHittest(p,t,w){if(null==this.hittestRequest)return null;t=this.hittest(p,
t,w);t=m.ifElse(m.greaterThan(t,this.hittestRequest.distance),new m.Float(2),new m.Float(0));w=this.storage.getAttributeDataCoords(p.id);w=a.uvToClip(w);t=t.add(this.clip(p.id,p.zoomRange));p=new m.Vec4(new m.Float(1/255),0,0,0);return{glPointSize:new m.Float(1),glPosition:new m.Vec4(w,t,1),color:p}}_maybeWriteHittest(p){return null!=this.hittestRequest?p.color:null}}q.__decorate([d.define],f.prototype,"inside",void 0);q.__decorate([d.define],f.prototype,"outside",void 0);q.__decorate([d.option(g.ShaderHighlight)],
f.prototype,"highlight",void 0);q.__decorate([d.uniform(h.EntityStorage)],f.prototype,"storage",void 0);q.__decorate([d.uniform(b.ViewInfo)],f.prototype,"view",void 0);q.__decorate([d.option(c.ShaderHittest)],f.prototype,"hittestRequest",void 0);l.AFeatureShader=f;l.BaseHittestVertexInput=e;l.FeatureFragmentInput=r;l.FeatureVertexInput=k;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/EntityStorage":function(){define("exports ../../../../../../../chunks/tslib.es6 ../../../../../../../core/has ../../GraphShaderModule ../../graph/glsl ./utils".split(" "),
function(l,q,n,d,m,h){class g extends d.UniformGroup{getVisualVariableData(c){this._vvData||(c=this.getAttributeDataCoords(c),this._vvData=m.texture2D(this.visualVariableData,c).setDebugName("storage2"));return this._vvData}getAttributeDataCoords(c){if(!this._uv){var a=h.unpackDisplayIdTexel(c);c=this.size;var b=m.int(a.x),k=m.int(a.y).multiply(m.int(256));a=m.int(a.z).multiply(m.int(256)).multiply(m.int(256));k=m.float(b.add(k).add(a));b=m.mod(k,c);k=k.subtract(b).divide(c);this._uv=(new m.Vec2(b,
k)).add(.5).divide(c)}return this._uv}getFilterData(c){c=this.getAttributeDataCoords(c);return m.texture2D(this.filterFlags,c).setDebugName("storage0")}getAnimationData(c){c=this.getAttributeDataCoords(c);return m.texture2D(this.animation,c).setDebugName("storage1")}getVVData(c){return this.getVisualVariableData(c)}getDataDrivenData0(c){c=this.getAttributeDataCoords(c);return m.texture2D(this.dataDriven0,c).setDebugName("storage30")}getDataDrivenData1(c){c=this.getAttributeDataCoords(c);return m.texture2D(this.dataDriven1,
c).setDebugName("storage31")}getDataDrivenData2(c){c=this.getAttributeDataCoords(c);return m.texture2D(this.dataDriven2,c).setDebugName("storage32")}getGPGPUData(c){c=this.getAttributeDataCoords(c);return m.texture2D(this.gpgpu,c).setDebugName("storage4")}getLocalTimeOrigin(c){c=this.getAttributeDataCoords(c);return m.texture2D(this.localTimeOrigin,c).x.setDebugName("storage5")}getFilterFlags(c){return n("webgl-ignores-sampler-precision")?m.ceil(this.getFilterData(c).x.multiply(m.float(255))):this.getFilterData(c).x.multiply(m.float(255))}getLabelVisibility(c){c=
this.getFilterData(c).y.multiply(255);return(new m.Float(1)).subtract(c)}getAnimationValue(c){return this.getAnimationData(c).x}getSizeValue(c){return this.getVisualVariableData(c).x}getColorValue(c){return this.getVisualVariableData(c).y}getOpacityValue(c){return this.getVisualVariableData(c).z}getRotationValue(c){return this.getVisualVariableData(c).w}}q.__decorate([d.uniform(m.Sampler2D)],g.prototype,"filterFlags",void 0);q.__decorate([d.uniform(m.Sampler2D)],g.prototype,"animation",void 0);q.__decorate([d.uniform(m.Sampler2D)],
g.prototype,"gpgpu",void 0);q.__decorate([d.uniform(m.Sampler2D)],g.prototype,"localTimeOrigin",void 0);q.__decorate([d.uniform(m.Sampler2D)],g.prototype,"visualVariableData",void 0);q.__decorate([d.uniform(m.Sampler2D)],g.prototype,"dataDriven0",void 0);q.__decorate([d.uniform(m.Sampler2D)],g.prototype,"dataDriven1",void 0);q.__decorate([d.uniform(m.Sampler2D)],g.prototype,"dataDriven2",void 0);q.__decorate([d.uniform(m.Float)],g.prototype,"size",void 0);l.EntityStorage=g;Object.defineProperty(l,
Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/ShaderHighlight":function(){define(["exports","../../../../../../../chunks/tslib.es6","../../GraphShaderModule","../../graph/glsl"],function(l,q,n,d){class m extends n.UniformGroup{}q.__decorate([n.uniform(d.Float)],m.prototype,"activeReasons",void 0);q.__decorate([n.uniform(d.Float)],m.prototype,"highlightAll",void 0);l.ShaderHighlight=m;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},
"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/ShaderHittest":function(){define(["exports","../../../../../../../chunks/tslib.es6","../../GraphShaderModule","../../graph/glsl"],function(l,q,n,d){class m extends n.UniformGroup{}q.__decorate([n.uniform(d.Vec2)],m.prototype,"position",void 0);q.__decorate([n.uniform(d.Float)],m.prototype,"distance",void 0);q.__decorate([n.uniform(d.Float)],m.prototype,"smallSymbolDistance",void 0);q.__decorate([n.uniform(d.Float)],m.prototype,"smallSymbolSizeThreshold",
void 0);l.ShaderHittest=m;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/ViewInfo":function(){define(["exports","../../../../../../../chunks/tslib.es6","../../GraphShaderModule","../../graph/glsl"],function(l,q,n,d){class m extends n.UniformGroup{}q.__decorate([n.uniform(d.Mat3)],m.prototype,"displayViewScreenMat3",void 0);q.__decorate([n.uniform(d.Mat3)],m.prototype,"displayViewMat3",void 0);q.__decorate([n.uniform(d.Mat3)],
m.prototype,"displayMat3",void 0);q.__decorate([n.uniform(d.Mat3)],m.prototype,"viewMat3",void 0);q.__decorate([n.uniform(d.Mat3)],m.prototype,"tileMat3",void 0);q.__decorate([n.uniform(d.Float)],m.prototype,"displayZoomFactor",void 0);q.__decorate([n.uniform(d.Float)],m.prototype,"requiredZoomFactor",void 0);q.__decorate([n.uniform(d.Vec2)],m.prototype,"tileOffset",void 0);q.__decorate([n.uniform(d.Float)],m.prototype,"currentScale",void 0);q.__decorate([n.uniform(d.Float)],m.prototype,"currentZoom",
void 0);q.__decorate([n.uniform(d.Float)],m.prototype,"metersPerSRUnit",void 0);q.__decorate([n.uniform(d.Float)],m.prototype,"rotation",void 0);q.__decorate([n.uniform(d.Float)],m.prototype,"pixelRatio",void 0);l.ViewInfo=m;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/MosaicInfo":function(){define(["exports","../../../../../../../chunks/tslib.es6","../../GraphShaderModule","../../graph/glsl"],function(l,q,n,d){class m extends n.UniformGroup{}
q.__decorate([n.uniform(d.Vec2)],m.prototype,"size",void 0);q.__decorate([n.uniform(d.Sampler2D)],m.prototype,"texture",void 0);l.MosaicInfo=m;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/VisualVariableColor":function(){define(["exports","../../../../../../../chunks/tslib.es6","../../GraphShaderModule","../../graph/glsl","./utils"],function(l,q,n,d,m){class h extends n.UniformGroup{getColor(g,c,a){return d.cond([d.or(m.isNan(g),
a),c],[d.lessThanEqual(g,this.values.first()),this.colors.first()],[d.greaterThanEqual(g,this.values.last()),this.colors.last()],[!0,()=>{const b=this.values.findIndex(f=>d.greaterThan(f,g));var k=this.values.get(b);const e=b.subtract(1),r=this.values.get(e);k=g.subtract(r).divide(k.subtract(r));return d.mix(this.colors.get(e),this.colors.get(b),k)}])}}q.__decorate([n.uniform(d.FixedArray.ofType(d.Vec4,8))],h.prototype,"colors",void 0);q.__decorate([n.uniform(d.FixedArray.ofType(d.Float,8))],h.prototype,
"values",void 0);l.VisualVariableColor=h;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/VisualVariableOpacity":function(){define(["exports","../../../../../../../chunks/tslib.es6","../../GraphShaderModule","../../graph/glsl","./utils"],function(l,q,n,d,m){class h extends n.UniformGroup{getOpacity(g){return d.cond([m.isNan(g),new d.Float(1)],[d.lessThanEqual(g,this.opacityValues.first()),this.opacities.first()],[d.greaterThanEqual(g,
this.opacityValues.last()),this.opacities.last()],[!0,()=>{const c=this.opacityValues.findIndex(e=>d.greaterThan(e,g));var a=this.opacityValues.get(c);const b=c.subtract(1),k=this.opacityValues.get(b);a=g.subtract(k).divide(a.subtract(k));return d.mix(this.opacities.get(b),this.opacities.get(c),a)}])}}q.__decorate([n.uniform(d.FixedArray.ofType(d.Float,8))],h.prototype,"opacities",void 0);q.__decorate([n.uniform(d.FixedArray.ofType(d.Float,8))],h.prototype,"opacityValues",void 0);l.VisualVariableOpacity=
h;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/VisualVariableRotation":function(){define("exports ../../../../../../../chunks/tslib.es6 ../../GraphShaderModule ../../graph/glsl ./constants ./utils".split(" "),function(l,q,n,d,m,h){class g extends n.UniformGroup{getVVRotationMat4(c){return d.ifElse(h.isNan(c),d.Mat4.identity(),()=>{var a=this.getNormalizedAngle(c).multiply(m.cDegToRad);const b=d.sin(a);a=d.cos(a);return new d.Mat4(a,
b,0,0,b.multiply(new d.Float(-1)),a,0,0,0,0,1,0,0,0,0,1)})}getVVRotationMat3(c){return d.ifElse(h.isNan(c),d.Mat3.identity(),()=>{var a=this.getNormalizedAngle(c).multiply(m.cDegToRad);const b=d.sin(a);a=d.cos(a);return new d.Mat3(a,b,0,b.multiply(new d.Float(-1)),a,0,0,0,1)})}getNormalizedAngle(c){const a=d.equal(this.rotationType,new d.Float(m.RotationType.Arithmatic));return d.ifElse(a,(new d.Float(90)).subtract(c),c)}}q.__decorate([n.uniform(d.Float)],g.prototype,"rotationType",void 0);l.VisualVariableRotation=
g;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/VisualVariableSizeMinMaxValue":function(){define(["exports","../../../../../../../chunks/tslib.es6","../../GraphShaderModule","../../graph/glsl","./utils"],function(l,q,n,d,m){class h extends n.UniformGroup{getSize(g,c){const a=this.minMaxValueAndSize.xy,b=this.minMaxValueAndSize.zw;return d.ifElse(m.isNan(g),c,()=>{var k=g.subtract(a.x).divide(a.y.subtract(a.x));k=d.clamp(k,
new d.Float(0),new d.Float(1));return b.x.add(k.multiply(b.y.subtract(b.x)))})}}q.__decorate([n.uniform(d.Vec4)],h.prototype,"minMaxValueAndSize",void 0);l.VisualVariableSizeMinMaxValue=h;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/VisualVariableSizeScaleStops":function(){define(["exports","../../../../../../../chunks/tslib.es6","../../GraphShaderModule","../../graph/glsl"],function(l,q,n,d){class m extends n.UniformGroup{getSizeForViewScale(h){return d.cond([d.lessThanEqual(h,
this.values.first()),this.sizes.first()],[d.greaterThanEqual(h,this.values.last()),this.sizes.last()],[!0,()=>{const g=this.values.findIndex(k=>d.greaterThan(k,h));var c=this.values.get(g);const a=g.subtract(1),b=this.values.get(a);c=h.subtract(b).divide(c.subtract(b));return d.mix(this.sizes.get(a),this.sizes.get(g),c)}])}}q.__decorate([n.uniform(d.FixedArray.ofType(d.Float,8))],m.prototype,"sizes",void 0);q.__decorate([n.uniform(d.FixedArray.ofType(d.Float,8))],m.prototype,"values",void 0);l.VisualVariableSizeScaleStops=
m;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/VisualVariableSizeStops":function(){define(["exports","../../../../../../../chunks/tslib.es6","../../GraphShaderModule","../../graph/glsl","./utils"],function(l,q,n,d,m){class h extends n.UniformGroup{getSize(g,c){const a=d.cond([m.isNan(g),c],[d.lessThanEqual(g,this.values.first()),this.sizes.first()],[d.greaterThanEqual(g,this.values.last()),this.sizes.last()],[!0,()=>{const b=
this.values.findIndex(f=>d.greaterThan(f,g));var k=this.values.get(b);const e=b.subtract(1),r=this.values.get(e);k=g.subtract(r).divide(k.subtract(r));return d.mix(this.sizes.get(e),this.sizes.get(b),k)}]);return d.ifElse(m.isNan(a),c,a)}}q.__decorate([n.uniform(d.FixedArray.ofType(d.Float,8))],h.prototype,"sizes",void 0);q.__decorate([n.uniform(d.FixedArray.ofType(d.Float,8))],h.prototype,"values",void 0);l.VisualVariableSizeStops=h;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},
"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/VisualVariableSizeUnitValue":function(){define(["exports","../../../../../../../chunks/tslib.es6","../../GraphShaderModule","../../graph/glsl","./utils"],function(l,q,n,d,m){class h extends n.UniformGroup{getSize(g,c){return d.ifElse(m.isNan(g),c,g.multiply(this.unitValueToPixelsRatio))}}q.__decorate([n.uniform(d.Float)],h.prototype,"unitValueToPixelsRatio",void 0);l.VisualVariableSizeUnitValue=h;Object.defineProperty(l,Symbol.toStringTag,
{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/vvUtils":function(){define(["exports","../../graph/glsl"],function(l,q){function n(d){return null!=d.visualVariableSizeMinMaxValue||null!=d.visualVariableSizeScaleStops||null!=d.visualVariableSizeStops||null!=d.visualVariableSizeUnitValue}l.getVisualVariableAngle=function(d,m){if(null==d.visualVariableRotation)return new q.Float(0);m=d.storage.getRotationValue(m);return d.visualVariableRotation.getNormalizedAngle(m)};
l.getVisualVariableColor=function(d,m,h,g=new q.Bool(!1)){if(null==d.visualVariableColor)return h;m=d.storage.getColorValue(m);return d.visualVariableColor.getColor(m,h,g)};l.getVisualVariableOpacity=function(d,m){if(null==d.visualVariableOpacity)return new q.Float(1);m=d.storage.getOpacityValue(m);return d.visualVariableOpacity.getOpacity(m)};l.getVisualVariableRotation=function(d,m){if(null==d.visualVariableRotation)return q.Mat3.identity();m=d.storage.getRotationValue(m);return d.visualVariableRotation.getVVRotationMat3(m)};
l.getVisualVariableSize=function(d,m,h){return n(d)?(m=d.storage.getSizeValue(m),d.visualVariableSizeMinMaxValue?.getSize(m,h)??d.visualVariableSizeScaleStops?.getSizeForViewScale(d.view.currentScale)??d.visualVariableSizeStops?.getSize(m,h)??d.visualVariableSizeUnitValue?.getSize(m,h)):h};l.hasVisualVariableSize=n;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/animated/enums":function(){define(["exports"],function(l){l.AnimationParamIndex=
void 0;var q=l.AnimationParamIndex||(l.AnimationParamIndex={});q[q.transform=0]="transform";q[q.fromColor=1]="fromColor";q[q.toColor=2]="toColor";q[q.colorMix=3]="colorMix";q[q.toOpacity=4]="toOpacity";q[q.opacityMix=5]="opacityMix";Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/markers/markerConstants":function(){define(["exports"],function(l){l.MarkerConstants={bitset:{isSDF:0,isMapAligned:1,scaleSymbolsProportionally:2,overrideOutlineColor:3,
colorLocked:4,isStroke:5}};Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/hittestUtils":function(){define(["exports","../../graph/glsl","./constants","./utils"],function(l,q,n,d){function m(b,k){return q.dot(b,q.normalize(k))}function h(b,k,e){var r=e.subtract(k),f=b.subtract(k);f=m(f,r);r=q.clamp(f.divide(q.length(r)),new q.Float(0),new q.Float(1));return q.distance(b,k.add(r.multiply(e.subtract(k))))}function g(b){b=q.abs(b);
return q.step(b.x.add(b.y).add(b.z),new q.Float(1.05))}function c(b,k,e,r){const f=new q.Mat3(e.x.multiply(r.y).subtract(r.x.multiply(e.y)),r.x.multiply(k.y).subtract(k.x.multiply(r.y)),k.x.multiply(e.y).subtract(e.x.multiply(k.y)),e.y.subtract(r.y),r.y.subtract(k.y),k.y.subtract(e.y),r.x.subtract(e.x),k.x.subtract(r.x),e.x.subtract(k.x));var p=k.x.multiply(e.y.subtract(r.y));const t=e.x.multiply(r.y.subtract(k.y));k=r.x.multiply(k.y.subtract(e.y));p=p.add(t).add(k);return(new q.Float(1)).divide(p).multiply(f.multiply(new q.Vec3(1,
b)))}function a(b,k,e,r){var f=e.subtract(k);const p=r.subtract(k);f=d.cross2(f,p);f=q.and(q.lessThan(f,new q.Float(n.epsilonHitTest)),q.greaterThan(f,new q.Float(-n.epsilonHitTest)));return q.cond([q.and(q.not(f),q.equal(g(c(b.xy,k,e,r)),new q.Float(1))),new q.Float(-1)],[!0,()=>{const t=h(b,k,e),w=h(b,e,r),z=h(b,r,k);return q.min(q.min(t,w),z)}])}l.distPointSegment=h;l.distPointTriangle=a;l.failHittest=function(b){return b.distance.add(1)};l.hittestFill=function(b,k,e){const {viewMat3:r,tileMat3:f}=
b.view,p=r.multiply(f);k=p.multiply(new q.Vec3(k.pos,1));const t=p.multiply(new q.Vec3(e.nextPos1,1));e=p.multiply(new q.Vec3(e.nextPos2,1));return a(b.hittestRequest.position,k.xy,t.xy,e.xy)};l.hittestMarker=function(b,k,e){return q.distance(b,e).subtract(k)};l.inTriangle=g;l.projectScalar=m;l.xyToBarycentric=c;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/animated/AnimatedTechnique":function(){define("exports ../../../../../../../core/libs/gl-matrix-2/math/mat3 ../../../../../../../core/libs/gl-matrix-2/factories/mat3f32 ../../../../../../../symbols/cim/animationDebugFlags ../FeatureTechnique ../featureTechniqueUtils".split(" "),
function(l,q,n,d,m,h){class g extends m.FeatureTechnique{render(c,a){const {context:b,painter:k}=c,{target:e}=a,{freezeGlobalTime:r}=d.animationDebugFlags,f=k.textureManager.animationStore.getTexture(b,0),p=[2/c.state.size[0],0,0,0,-2/c.state.size[1],0,-1,1,1];var t=Array.from(q.invert(n.create(),p));t=Array.from(q.multiply(n.create(),t,e.transforms.displayViewScreenMat3));const w=a.instance.getInput();k.setShader({shader:this.shaders.geometry,uniforms:{...h.resolveDynamicUniforms(c,a.target,w.uniforms),
...h.getFeatureUniforms(c,a.target),mosaicInfo:k.textureManager.getMosaicInfo(b,a.textureKey,!0),animationInfo:{globalTime:!1===r?c.time/1E3:r,animationTextureSize:[f.descriptor.width,f.descriptor.height],animationTexture:{unit:6,texture:f},toScreen:t,toNdc:p,mapRotation:c.state.rotation,pixelRatio:c.state.pixelRatio}},defines:{...h.getSelectionDefines(c)},optionalAttributes:{zoomRange:!0},useComputeBuffer:!0});k.setPipelineState({...h.getFeaturePipelineState(c)});k.submitDraw(c,a);!1===r&&e.requestRender()}}
l.AnimatedTechnique=g;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/FeatureTechnique":function(){define(["exports","../../enums","./Technique"],function(l,q,n){class d extends n.Technique{constructor(){super(...arguments);this.symbologyPlane=q.FeatureSymbologyDrawOrder.FILL;this._input=null}}l.FeatureTechnique=d;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/dotDensity/DotDensityTechnique":function(){define("exports ../../../definitions ../../utils ../FeatureTechnique ../featureTechniqueUtils ../TechniqueType ./DotDensityPointShader ./DotDensityPolygonShader ./DotDensityResources ../shaders/FillShader ../../../../../../webgl/enums".split(" "),
function(l,q,n,d,m,h,g,c,a,b,k){class e extends d.FeatureTechnique{constructor(){super(...arguments);this.type=h.TechniqueType.DotDensity;this.shaders={polygon:new c.DotDensityPolygonShader,point:new g.DotDensityPointShader,fill:new b.FillShader};this._resources=new Map}render(r,f){m.isHighlight(r)||m.isHittest(r)?this._renderPolygons(r,f):this._renderDotDensity(r,f)}_renderPolygons(r,f){const {painter:p}=r;p.setShader({shader:this.shaders.fill,uniforms:{...m.getFeatureUniforms(r,f.target),visualVariableColor:null,
visualVariableOpacity:null},defines:{...m.getSelectionDefines(r)},optionalAttributes:{zoomRange:!1},useComputeBuffer:m.isHittest(r)});p.setPipelineState(m.getFeaturePipelineState(r));p.submitDraw(r,f)}_renderDotDensity(r,f){const {context:p,painter:t,requiredLevel:w}=r,z=f.instance.getInput().uniforms,u=this._getOrCreateResourcesRecord(p);var y=u.getDotDensityTextures(p,q.tileSize,z.seed),A=1/2**(w-f.target.key.level),v=q.tileSize;v=v*window.devicePixelRatio*v*window.devicePixelRatio;const x=1/A*
(z.dotScale?r.state.scale/z.dotScale:1)*z.dotValue*(1/A);t.setShader({shader:this.shaders.polygon,uniforms:{...m.getFeatureUniforms(r,f.target),instance:{isActive:z.isActive,colors:z.colors,dotValue:Math.max(1,x)},draw:{dotTexture0:{unit:q.textureBindingRenderer0,texture:y[0]},dotTexture1:{unit:q.textureBindingRenderer1,texture:y[1]},tileZoomFactor:A,pixelRatio:window.devicePixelRatio,tileDotsOverArea:v/(q.tileSize*window.devicePixelRatio*q.tileSize*window.devicePixelRatio)}},defines:{...m.getSelectionDefines(r),
blending:z.blending},optionalAttributes:{},useComputeBuffer:!1});y=p.getViewport();p.setViewport(0,0,q.tileSize,q.tileSize);A=p.getBoundFramebufferObject();v=u.getFBO(p);p.bindFramebuffer(v);p.setClearColor(0,0,0,0);p.clear(k.FramebufferBit.COLOR);t.setPipelineState({color:{write:[!0,!0,!0,!0],blendMode:"composite"},depth:!1,stencil:!1});t.updatePipelineState(p);t.submitDraw(r,f);p.bindFramebuffer(A);p.setViewport(y.x,y.y,y.width,y.height);y=u.getFBO(p).colorTexture;f={shader:this.shaders.point,uniforms:{view:m.getViewUniforms(r,
f.target),instance:{dotSize:z.dotSize},draw:{locations:{unit:q.textureBindingRenderer0,texture:y},tileZoomFactor:1,pixelRatio:window.devicePixelRatio}},defines:{...m.getSelectionDefines(r)},optionalAttributes:{},useComputeBuffer:!1};t.setPipelineState(m.getFeaturePipelineState(r));t.submitDrawMesh(p,f,u.getDotDensityMesh(p,n.getLocations(this.shaders.point)))}shutdown(r){super.shutdown(r);this._resources.get(r)?.destroy();this._resources.delete(r)}_getOrCreateResourcesRecord(r){let f=this._resources.get(r);
null==f&&(f=new a.DotDensityResources,this._resources.set(r,f));return f}}l.DotDensityTechnique=e;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/dotDensity/DotDensityPointShader":function(){define("exports ../../../../../../../chunks/tslib.es6 ../../../definitions ../../GraphShaderModule ../../graph/glsl ../shaders/AFeatureShader ../shaders/ViewInfo".split(" "),function(l,q,n,d,m,h,g){class c extends d.VertexInput{}q.__decorate([d.location(0,
m.Vec2)],c.prototype,"pos",void 0);class a extends h.FeatureFragmentInput{}class b extends d.UniformGroup{}q.__decorate([d.uniform(m.Float)],b.prototype,"dotSize",void 0);class k extends d.UniformGroup{}q.__decorate([d.uniform(m.Sampler2D)],k.prototype,"locations",void 0);q.__decorate([d.uniform(m.Float)],k.prototype,"pixelRatio",void 0);q.__decorate([d.uniform(m.Float)],k.prototype,"tileZoomFactor",void 0);class e extends d.GraphShaderModule{vertex(r){var f=(new m.Mat3(1,0,0,0,-1,0,0,1,1)).multiply(new m.Vec3(r.pos.xy.divide(n.tileSize),
1));f=m.texture2D(this.draw.locations,f.xy);var p=m.max(this.instance.dotSize.divide(2),new m.Float(1)),t=new m.Float(0);t=t.add(m.step(f.a,new m.Float(1E-6)).multiply(2));let w=p.add(this.instance.dotSize);r=this.view.displayViewScreenMat3.multiply(new m.Vec3(r.pos.add(.5),1));r=new m.Vec4(r.xy,t,1);t=this.instance.dotSize.divide(w);p=(new m.Float(-1)).divide(p.divide(w));w=w.multiply(this.draw.pixelRatio.multiply(this.draw.tileZoomFactor));return{glPosition:r,glPointSize:w,color:f,ratio:t,invEdgeRatio:p}}fragment(r){var f=
m.length(r.glPointCoord.subtract(.5)).multiply(2);f=m.smoothstep(new m.Float(0),new m.Float(1),r.invEdgeRatio.multiply(f.subtract(r.ratio)).add(1));const p=new d.FragmentOutput;p.glFragColor=r.color.multiply(f);return p}}q.__decorate([d.uniform(b)],e.prototype,"instance",void 0);q.__decorate([d.uniform(k)],e.prototype,"draw",void 0);q.__decorate([d.uniform(g.ViewInfo)],e.prototype,"view",void 0);q.__decorate([q.__param(0,d.input(c))],e.prototype,"vertex",null);q.__decorate([q.__param(0,d.input(a))],
e.prototype,"fragment",null);l.DotDensityPointDrawUniforms=k;l.DotDensityPointFragmentInput=a;l.DotDensityPointInstanceUniforms=b;l.DotDensityPointShader=e;l.DotDensityPointVertexInput=c;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/dotDensity/DotDensityPolygonShader":function(){define("exports ../../../../../../../chunks/tslib.es6 ../../../definitions ../../GraphShaderModule ../../graph/glsl ../shaders/AFeatureShader ../shaders/hittestUtils ../shaders/utils".split(" "),
function(l,q,n,d,m,h,g,c){class a extends h.FeatureVertexInput{}q.__decorate([d.location(3,m.Float)],a.prototype,"inverseArea",void 0);class b extends h.FeatureFragmentInput{}class k extends d.UniformGroup{}q.__decorate([d.uniform(m.FixedArray.ofType(m.Vec4,2))],k.prototype,"isActive",void 0);q.__decorate([d.uniform(m.FixedArray.ofType(m.Vec4,8))],k.prototype,"colors",void 0);q.__decorate([d.uniform(m.Float)],k.prototype,"dotValue",void 0);class e extends d.UniformGroup{}q.__decorate([d.uniform(m.Sampler2D)],
e.prototype,"dotTexture0",void 0);q.__decorate([d.uniform(m.Sampler2D)],e.prototype,"dotTexture1",void 0);q.__decorate([d.uniform(m.Float)],e.prototype,"tileZoomFactor",void 0);q.__decorate([d.uniform(m.Float)],e.prototype,"pixelRatio",void 0);q.__decorate([d.uniform(m.Float)],e.prototype,"tileDotsOverArea",void 0);class r extends h.AFeatureShader{_dotThreshold(f,p,t){return f.divide(p).divide(t)}vertex(f){var p=(new m.Mat3(2/n.tileSize,0,0,0,-2/n.tileSize,0,-1,1,1)).multiply(new m.Vec3(f.pos,1)),
t=this.clip(f.id);p=new m.Vec4(p.xy,t,1);var w=this.storage.getVVData(f.id).multiply(this.instance.isActive.get(0)).multiply(f.inverseArea),z=this.storage.getDataDrivenData0(f.id).multiply(this.instance.isActive.get(1)).multiply(f.inverseArea);t=this.draw.tileZoomFactor.multiply(n.tileSize).divide(this.draw.pixelRatio);w=this._dotThreshold(w,this.instance.dotValue,this.draw.tileDotsOverArea);z=this._dotThreshold(z,this.instance.dotValue,this.draw.tileDotsOverArea);f=f.pos.add(.5).divide(t);return{glPosition:p,
color:new m.Vec4(0,0,0,0),textureCoords:f,thresholds0:w,thresholds1:z}}fragment(f){const p=new d.FragmentOutput;var t=m.texture2D(this.draw.dotTexture0,f.textureCoords),w=m.texture2D(this.draw.dotTexture1,f.textureCoords);t=f.thresholds0.subtract(t);var z=f.thresholds1.subtract(w);f=m.Mat4.fromColumns(this.instance.colors[0],this.instance.colors[1],this.instance.colors[2],this.instance.colors[3]);w=m.Mat4.fromColumns(this.instance.colors[4],this.instance.colors[5],this.instance.colors[6],this.instance.colors[7]);
if(this.blending){const v=m.step(new m.Float(0),t);var u=m.step(new m.Float(0),z),y=m.dot(v,t).add(m.dot(u,z));const x=m.step(y,new m.Float(0));var A=(new m.Float(1)).subtract(x);y=y.add(x);t=t.multiply(v).divide(y);z=z.multiply(u).divide(y);f=f.multiply(t).add(w.multiply(z));f=A.multiply(f)}else u=m.max(c.max4(t),c.max4(z)),A=m.step(u,new m.Float(0)),A=(new m.Float(1)).subtract(A),t=m.step(u,t),z=m.step(u,z),f=f.multiply(t).add(w.multiply(z)),f=A.multiply(f);p.glFragColor=f;return p}hittest(f){return g.failHittest(this.hittestRequest)}}
q.__decorate([d.define],r.prototype,"blending",void 0);q.__decorate([d.uniform(k)],r.prototype,"instance",void 0);q.__decorate([d.uniform(e)],r.prototype,"draw",void 0);q.__decorate([q.__param(0,d.input(a))],r.prototype,"vertex",null);q.__decorate([q.__param(0,d.input(h.FeatureFragmentInput))],r.prototype,"fragment",null);l.DotDensityPolygonDrawUniforms=e;l.DotDensityPolygonFragmentInput=b;l.DotDensityPolygonInstanceUniforms=k;l.DotDensityPolygonShader=r;l.DotDensityPolygonVertexInput=a;Object.defineProperty(l,
Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/dotDensity/DotDensityResources":function(){define("exports ../../../../../../../core/RandomLCG ../../../definitions ../../../meshing/SimpleMesh ../../../../../../webgl/enums ../../../../../../webgl/FramebufferObject ../../../../../../webgl/Renderbuffer ../../../../../../webgl/RenderbufferDescriptor ../../../../../../webgl/Texture ../../../../../../webgl/TextureDescriptor".split(" "),function(l,q,n,d,m,h,g,c,
a,b){const k={pos:{count:2,type:m.DataType.UNSIGNED_SHORT}};class e{constructor(){this._dotTextureSize=0;this._dotMesh=this._dotTextures=null}destroy(){this._disposeTextures();this._dotFBO&&this._dotFBO.dispose();this._dotMesh&&this._dotMesh.destroy()}getFBO(r){if(null==this._dotFBO){var f=n.tileSize;const p=n.tileSize,t=new b.TextureDescriptor(f,p);t.samplingMode=m.TextureSamplingMode.NEAREST;t.wrapMode=m.TextureWrapMode.CLAMP_TO_EDGE;f=new g.Renderbuffer(r,new c.RenderbufferDescriptor(m.RenderbufferFormat.DEPTH_STENCIL,
f,p));this._dotFBO=new h.FramebufferObject(r,t,f)}return this._dotFBO}getDotDensityMesh(r,f){if(null==this._dotMesh){const p=n.tileSize,t=p*p,w=new Int16Array(2*t);for(let z=0;z<p;z++)for(let u=0;u<p;u++)w[2*(u+z*p)]=u,w[2*(u+z*p)+1]=z;this._dotMesh=d.SimpleMesh.create(r,{primitive:m.PrimitiveType.POINTS,vertex:w,count:t,layout:k},f)}return this._dotMesh}getDotDensityTextures(r,f,p){if(this._dotTextureSize!==f||this._seed!==p)this._disposeTextures(),this._dotTextureSize=f,this._seed=p;null===this._dotTextures&&
(p=new q(p),this._dotTextures=[this._allocDotDensityTexture(r,f,p),this._allocDotDensityTexture(r,f,p)]);return this._dotTextures}_disposeTextures(){if(this._dotTextures){for(let r=0;r<this._dotTextures.length;r++)this._dotTextures[r].dispose();this._dotTextures=null}}_allocDotDensityTexture(r,f,p){const t=new Float32Array(f*f*4);for(let w=0;w<t.length;w++)t[w]=p.getFloat();p=new b.TextureDescriptor;p.dataType=m.PixelType.FLOAT;p.samplingMode=m.TextureSamplingMode.NEAREST;p.width=f;p.height=f;return new a.Texture(r,
p,t)}}l.DotDensityResources=e;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/FillShader":function(){define("exports ../../../../../../../chunks/tslib.es6 ../../GraphShaderModule ../../graph/glsl ./AFeatureShader ./hittestUtils ./VisualVariableColor ./VisualVariableOpacity ./vvUtils".split(" "),function(l,q,n,d,m,h,g,c,a){class b extends m.FeatureVertexInput{}q.__decorate([n.location(3,d.Vec4)],b.prototype,"color",void 0);
q.__decorate([n.location(4,d.Vec2)],b.prototype,"zoomRange",void 0);class k extends m.AFeatureShader{constructor(){super(...arguments);this.computeAttributes={pos:["nextPos1","nextPos2"]}}vertex(e,r){var f=a.getVisualVariableOpacity(this,e.id);f=a.getVisualVariableColor(this,e.id,e.color).multiply(f);const p=this.view.displayViewScreenMat3.multiply(new d.Vec3(e.pos.xy,1)),t=this.clip(e.id,e.zoomRange);return{glPosition:new d.Vec4(p.xy,t,1),color:f,...this.maybeRunHittest(e,r,null)}}fragment(e){return this.getFragmentOutput(e.color,
e,new d.Float(0))}hittest(e,r){return h.hittestFill(this,e,r)}}q.__decorate([n.option(g.VisualVariableColor)],k.prototype,"visualVariableColor",void 0);q.__decorate([n.option(c.VisualVariableOpacity)],k.prototype,"visualVariableOpacity",void 0);q.__decorate([q.__param(0,n.input(b)),q.__param(1,n.input(m.BaseHittestVertexInput))],k.prototype,"vertex",null);q.__decorate([q.__param(0,n.input(m.FeatureFragmentInput))],k.prototype,"fragment",null);l.FillShader=k;l.FillVertexInput=b;Object.defineProperty(l,
Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/fill/ComplexFillTechnique":function(){define(["exports","../FeatureTechnique","../featureTechniqueUtils","../TechniqueType","../shaders/ComplexFillShader"],function(l,q,n,d,m){class h extends q.FeatureTechnique{constructor(){super(...arguments);this.type=d.TechniqueType.ComplexFill;this.shaders={geometry:new m.ComplexFillShader}}render(g,c){const {context:a,painter:b}=g,k=c.instance.getInput();b.setShader({shader:this.shaders.geometry,
uniforms:{...n.resolveDynamicUniforms(g,c.target,k.uniforms),...n.getFeatureUniforms(g,c.target),mosaicInfo:b.textureManager.getMosaicInfo(a,c.textureKey),localTileOffset:n.getLocalTileOffset(c.target)},defines:{...n.getSelectionDefines(g)},optionalAttributes:k.optionalAttributes,useComputeBuffer:n.isHittest(g)});b.setPipelineState(n.getFeaturePipelineState(g));b.submitDraw(g,c)}}l.ComplexFillTechnique=h;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/ComplexFillShader":function(){define("exports ../../../../../../../chunks/tslib.es6 ../../GraphShaderModule ../../graph/glsl ./AFeatureShader ./constants ./FillShader ./LocalTileOffset ./MosaicInfo ./utils".split(" "),
function(l,q,n,d,m,h,g,c,a,b){function k(t,w){var z=t.view.requiredZoomFactor,u=new d.Vec2(w.width,w.height),y=u.multiply(w.scale).multiply(z),A=w.angle.multiply(h.c256ToRad);const v=d.sin(A);A=d.cos(A);var x=w.id;var C=d.equal(b.getBit(w.bitset,h.bitsetFillRandomPatternOffset),d.float(1));x=b.rgba2float(new d.Vec4(x,0));C=d.ifElse(C,d.mat3(A.divide(y.x),v.divide(y.y),0,d.negate(v.divide(y.x)),A.divide(y.y),0,b.rand(d.vec2(x,0)),b.rand(d.vec2(0,x)),1),d.mat3(A.divide(y.x),v.divide(y.y),0,d.negate(v.divide(y.x)),
A.divide(y.y),0,0,0,1));u=t.localTileOffset.getPatternOffsetAtTileOrigin(u,v,A);z=z.multiply(w.scale).multiply(w.offset.subtract(u)).divide(y);y=new d.Vec3(w.pos,1);z=C.multiply(y).xy.subtract(z);y=w.tlbr.divide(t.mosaicInfo.size.xyxy);u=b.getBit(w.bitset,h.bitsetGenericConsiderAlphaOnly);null!=t.visualVariableColor&&(u=d.ifElse(b.isNan(t.storage.getColorValue(w.id)),new d.Float(0),u));return{tileTextureCoord:z,tlbr:y,sampleAlphaOnly:u}}function e(t,w){var z=d.mod(w.tileTextureCoord,new d.Float(1));
z=d.mix(w.tlbr.xy,w.tlbr.zw,z);t=d.texture2D(t.mosaicInfo.texture,z);t=d.ifElse(d.greaterThan(w.sampleAlphaOnly,new d.Float(.5)),t.aaaa,t);return w.color.multiply(t)}class r extends g.FillVertexInput{}q.__decorate([n.location(5,d.Vec4)],r.prototype,"tlbr",void 0);q.__decorate([n.location(6,d.Float)],r.prototype,"width",void 0);q.__decorate([n.location(7,d.Float)],r.prototype,"height",void 0);q.__decorate([n.location(8,d.Vec2)],r.prototype,"offset",void 0);q.__decorate([n.location(9,d.Vec2)],r.prototype,
"scale",void 0);q.__decorate([n.location(10,d.Float)],r.prototype,"angle",void 0);class f extends m.FeatureFragmentInput{}class p extends g.FillShader{vertex(t,w){return{...super.vertex(t,w),...k(this,t)}}fragment(t){const w=e(this,t);return this.getFragmentOutput(w,t,new d.Float(0))}}q.__decorate([n.uniform(a.MosaicInfo)],p.prototype,"mosaicInfo",void 0);q.__decorate([n.uniform(c.LocalTileOffset)],p.prototype,"localTileOffset",void 0);q.__decorate([q.__param(0,n.input(r)),q.__param(1,n.input(m.BaseHittestVertexInput))],
p.prototype,"vertex",null);q.__decorate([q.__param(0,n.input(f))],p.prototype,"fragment",null);l.ComplexFillFragmentInput=f;l.ComplexFillShader=p;l.ComplexFillVertexInput=r;l.getComplexFillFragmentColor=e;l.getComplexFillVertexData=k;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/LocalTileOffset":function(){define(["exports","../../../../../../../chunks/tslib.es6","../../GraphShaderModule","../../graph/glsl","./constants"],
function(l,q,n,d,m){class h extends n.UniformGroup{getPatternOffsetAtTileOrigin(g,c=new d.Float(0),a=new d.Float(1)){var b=(new d.Vec2(m.maxRepresentableInt)).divide(g);b=g.multiply(d.fract(this.maxIntsToLocalOrigin.multiply(b))).add(this.tileOffsetFromLocalOrigin).subtract((new d.Float(.5)).multiply(g));b=new d.Vec2(b.x.multiply(a).subtract(b.y.multiply(c)),b.x.multiply(c).add(b.y.multiply(a)));return d.mod(b,g)}}q.__decorate([n.uniform(d.Vec2)],h.prototype,"tileOffsetFromLocalOrigin",void 0);q.__decorate([n.uniform(d.Vec2)],
h.prototype,"maxIntsToLocalOrigin",void 0);l.LocalTileOffset=h;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/fill/ComplexOutlineFillTechnique":function(){define("exports ../FeatureTechnique ../featureTechniqueUtils ../TechniqueType ../line/utils ../shaders/ComplexOutlineFillShader".split(" "),function(l,q,n,d,m,h){class g extends q.FeatureTechnique{constructor(){super(...arguments);this.type=d.TechniqueType.ComplexOutlineFill;this.shaders=
{geometry:new h.ComplexOutlineFillShader}}render(c,a){const {context:b,painter:k,pixelRatio:e}=c,r=a.instance.getInput();k.setShader({shader:this.shaders.geometry,uniforms:{...n.resolveDynamicUniforms(c,a.target,r.uniforms),...n.getFeatureUniforms(c,a.target),antialiasingControls:m.getAntialiasingControls(e),mosaicInfo:k.textureManager.getMosaicInfo(b,a.textureKey),localTileOffset:n.getLocalTileOffset(a.target)},defines:{...n.getSelectionDefines(c)},optionalAttributes:r.optionalAttributes,useComputeBuffer:n.isHittest(c)});
k.setPipelineState(n.getFeaturePipelineState(c));k.submitDraw(c,a)}}l.ComplexOutlineFillTechnique=g;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/line/utils":function(){define(["exports"],function(l){l.getAntialiasingControls=function(q){q=1/q;return{antialiasing:q,blur:0+q}};Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/ComplexOutlineFillShader":function(){define("exports ../../../../../../../chunks/tslib.es6 ../../GraphShaderModule ../../graph/glsl ./AFeatureShader ./ComplexFillShader ./hittestUtils ./LineShader ./LocalTileOffset ./MosaicInfo ./OutlineFillShader ./PatternOutlineFillShader".split(" "),
function(l,q,n,d,m,h,g,c,a,b,k,e){class r extends m.FeatureVertexInput{}q.__decorate([n.location(3,d.Vec4)],r.prototype,"color",void 0);q.__decorate([n.location(4,d.Vec4)],r.prototype,"tlbr",void 0);q.__decorate([n.location(5,d.Float)],r.prototype,"angle",void 0);q.__decorate([n.location(6,d.Float)],r.prototype,"aux1",void 0);q.__decorate([n.location(7,d.Float)],r.prototype,"aux2",void 0);q.__decorate([n.location(8,d.Vec2)],r.prototype,"aux3",void 0);q.__decorate([n.location(9,d.Vec2)],r.prototype,
"aux4",void 0);q.__decorate([n.location(10,d.Vec2)],r.prototype,"zoomRange",void 0);class f extends e.PatternOutlineFillFragmentInput{}class p extends k.AOutlineFillShader{vertex(t,w){const {aux1:z,aux2:u,aux3:y,aux4:A}=t;var v={...t,width:z,height:u,offset:y,scale:A.multiply(.0625)},x={...t,halfWidth:z,referenceHalfWidth:u,offset:y,normal:A.subtract(128).multiply(.0625)};x=k.getOutlineFillVertexData(this,x);v=h.getComplexFillVertexData(this,v);const C=d.greaterThan(x.isOutline,new d.Float(.5));return{...x,
...v,...this.maybeRunHittest(t,w,C)}}fragment(t){var {isOutline:w}=t;w=d.greaterThan(w,new d.Float(.5));var z=c.getLineFragmentColor(t,this.antialiasingControls.blur);const u=h.getComplexFillFragmentColor(this,t);z=d.ifElse(w,z,u);w=d.ifElse(w,new d.Float(1/255),new d.Float(0));return this.getFragmentOutput(z,t,w)}hittest(t,w,z){return d.ifElse(z,g.failHittest(this.hittestRequest),g.hittestFill(this,t,w))}}q.__decorate([n.uniform(b.MosaicInfo)],p.prototype,"mosaicInfo",void 0);q.__decorate([n.uniform(a.LocalTileOffset)],
p.prototype,"localTileOffset",void 0);q.__decorate([q.__param(0,n.input(r)),q.__param(1,n.input(m.BaseHittestVertexInput))],p.prototype,"vertex",null);q.__decorate([q.__param(0,n.input(f))],p.prototype,"fragment",null);l.ComplexOutlineFillShader=p;l.ComplexOutlineFillVertexInput=r;l.packPrecision=16;l.signedToUnsignedByte=128;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/LineShader":function(){define("exports ../../../../../../../chunks/tslib.es6 ../../GraphShaderModule ../../graph/glsl ./AFeatureShader ./constants ./hittestUtils ./VisualVariableColor ./VisualVariableOpacity ./VisualVariableSizeMinMaxValue ./VisualVariableSizeScaleStops ./VisualVariableSizeStops ./VisualVariableSizeUnitValue ./vvUtils".split(" "),
function(l,q,n,d,m,h,g,c,a,b,k,e,r,f){function p(x){return d.max((new d.Float(h.thinLineWidthFactor)).multiply(d.step(x,new d.Float(h.thinLineHalfWidth))),new d.Float(1))}function t(x,C){const {halfWidth:B,normal:E}=x;x=p(B);const D=d.length(E).multiply(B);return d.clamp(x.multiply(B.subtract(D)).divide(C.add(x).subtract(new d.Float(1))),new d.Float(0),new d.Float(1))}function w(x,C){const {id:B,offset:E,pos:D,normal:F,zoomRange:G}=C,{displayViewScreenMat3:H,displayViewMat3:I}=x.view,K=f.getVisualVariableColor(x,
B,C.color),L=f.getVisualVariableOpacity(x,B);{const {id:J,halfWidth:O,referenceHalfWidth:T}=C;f.hasVisualVariableSize(x)?(C=(new d.Float(2)).multiply(T),C=f.getVisualVariableSize(x,J,C),C=(new d.Float(.5)).multiply(O.divide(d.max(T,new d.Float(h.epsilon)))).multiply(C)):C=O}var R=(new d.Float(.5)).multiply(x.antialiasingControls.antialiasing);R=d.max(C.add(R),new d.Float(.45)).add((new d.Float(.1)).multiply(R));const S=p(R).multiply(R).multiply(E);var W=I.multiply(new d.Vec3(S,new d.Float(0)));W=
H.multiply(new d.Vec3(D,new d.Float(1))).add(W);x=(new d.Float(2)).multiply(d.step(C,new d.Float(0))).add(x.clip(B,G));W=new d.Vec4(W.xy,x,1);x=new d.Vec4(W.xy,x,1);return{color:K,opacity:L,halfWidth:R,normal:F,scaledOffset:S,scaledHalfWidth:C,glPosition:x}}function z(x,C){const {opacity:B,color:E}=x;x=t(x,C);return B.multiply(E).multiply(x)}class u extends m.FeatureVertexInput{}q.__decorate([n.location(3,d.Vec4)],u.prototype,"color",void 0);q.__decorate([n.location(4,d.Vec2)],u.prototype,"offset",
void 0);q.__decorate([n.location(5,d.Vec2)],u.prototype,"normal",void 0);q.__decorate([n.location(6,d.Float)],u.prototype,"halfWidth",void 0);q.__decorate([n.location(7,d.Float)],u.prototype,"referenceHalfWidth",void 0);q.__decorate([n.location(8,d.Vec2)],u.prototype,"zoomRange",void 0);class y extends m.FeatureFragmentInput{}class A extends n.UniformGroup{}q.__decorate([n.uniform(d.Float)],A.prototype,"antialiasing",void 0);q.__decorate([n.uniform(d.Float)],A.prototype,"blur",void 0);class v extends m.AFeatureShader{constructor(){super(...arguments);
this.computeAttributes={pos:["nextPos1","nextPos2"]}}vertex(x,C){const B=w(this,x);return{...B,...this.maybeRunHittest(x,C,B.halfWidth)}}fragment(x){const C=z(x,this.antialiasingControls.blur);return this.getFragmentOutput(C,x)}hittest(x,C,B){const {viewMat3:E,tileMat3:D}=this.view;var F=E.multiply(D);x=F.multiply(new d.Vec3(x.pos,1));const G=F.multiply(new d.Vec3(C.nextPos1,1));C=F.multiply(new d.Vec3(C.nextPos2,1));const {distance:H,smallSymbolDistance:I,smallSymbolSizeThreshold:K}=this.hittestRequest;
F=d.step(B,K.multiply(.5)).multiply(H.subtract(I));const L=this.hittestRequest.position;return d.min(g.distPointSegment(L,x.xy,G.xy),g.distPointSegment(L,x.xy,C.xy)).subtract(B).add(F)}}q.__decorate([n.uniform(A)],v.prototype,"antialiasingControls",void 0);q.__decorate([n.option(c.VisualVariableColor)],v.prototype,"visualVariableColor",void 0);q.__decorate([n.option(a.VisualVariableOpacity)],v.prototype,"visualVariableOpacity",void 0);q.__decorate([n.option(b.VisualVariableSizeMinMaxValue)],v.prototype,
"visualVariableSizeMinMaxValue",void 0);q.__decorate([n.option(k.VisualVariableSizeScaleStops)],v.prototype,"visualVariableSizeScaleStops",void 0);q.__decorate([n.option(e.VisualVariableSizeStops)],v.prototype,"visualVariableSizeStops",void 0);q.__decorate([n.option(r.VisualVariableSizeUnitValue)],v.prototype,"visualVariableSizeUnitValue",void 0);q.__decorate([q.__param(0,n.input(u)),q.__param(1,n.input(m.BaseHittestVertexInput))],v.prototype,"vertex",null);q.__decorate([q.__param(0,n.input(y))],
v.prototype,"fragment",null);l.AntialiasingControls=A;l.LineFragmentInput=y;l.LineShader=v;l.LineVertexInput=u;l.getLineAntialiasing=t;l.getLineFragmentColor=z;l.getLineVertexData=w;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/OutlineFillShader":function(){define("exports ../../../../../../../chunks/tslib.es6 ../../GraphShaderModule ../../graph/glsl ./AFeatureShader ./constants ./hittestUtils ./LineShader ./utils ./VisualVariableColor ./VisualVariableOpacity ./VisualVariableSizeMinMaxValue ./VisualVariableSizeScaleStops ./VisualVariableSizeStops ./VisualVariableSizeUnitValue ./vvUtils".split(" "),
function(l,q,n,d,m,h,g,c,a,b,k,e,r,f,p,t){function w(v,x,C){const {id:B,bitset:E}=x,D=a.getBit(E,h.bitsetTypeFillOutline),F=d.greaterThan(D,new d.Float(.5)),G=c.getLineVertexData(v,x),H=d.ifElse(F,G.halfWidth,new d.Float(0));var I=t.getVisualVariableOpacity(v,B),K=t.getVisualVariableColor(v,B,x.color);I=d.ifElse(F,x.color,K.multiply(I));K=v.view.displayViewScreenMat3.multiply(new d.Vec3(x.pos.xy,1));const L=v.clip(x.id);K=new d.Vec4(K.xy,L,1);K=d.ifElse(F,G.glPosition,K);v=C&&v.maybeRunHittest(x,
C,F);return{isOutline:D,color:I,opacity:new d.Float(1),halfWidth:H,normal:G.normal,glPosition:K,...v}}class z extends m.FeatureVertexInput{}q.__decorate([n.location(3,d.Vec2)],z.prototype,"offset",void 0);q.__decorate([n.location(4,d.Vec4)],z.prototype,"color",void 0);q.__decorate([n.location(5,d.Vec2)],z.prototype,"normal",void 0);q.__decorate([n.location(6,d.Float)],z.prototype,"halfWidth",void 0);q.__decorate([n.location(7,d.Float)],z.prototype,"referenceHalfWidth",void 0);q.__decorate([n.location(8,
d.Vec2)],z.prototype,"zoomRange",void 0);class u extends c.LineFragmentInput{}class y extends m.AFeatureShader{constructor(){super(...arguments);this.computeAttributes={pos:["nextPos1","nextPos2"]}}}q.__decorate([n.uniform(c.AntialiasingControls)],y.prototype,"antialiasingControls",void 0);q.__decorate([n.option(b.VisualVariableColor)],y.prototype,"visualVariableColor",void 0);q.__decorate([n.option(k.VisualVariableOpacity)],y.prototype,"visualVariableOpacity",void 0);q.__decorate([n.option(e.VisualVariableSizeMinMaxValue)],
y.prototype,"visualVariableSizeMinMaxValue",void 0);q.__decorate([n.option(r.VisualVariableSizeScaleStops)],y.prototype,"visualVariableSizeScaleStops",void 0);q.__decorate([n.option(f.VisualVariableSizeStops)],y.prototype,"visualVariableSizeStops",void 0);q.__decorate([n.option(p.VisualVariableSizeUnitValue)],y.prototype,"visualVariableSizeUnitValue",void 0);class A extends y{vertex(v,x){return w(this,v,x)}fragment(v){const {color:x,isOutline:C}=v;var B=d.greaterThan(C,new d.Float(.5)),E=c.getLineFragmentColor(v,
this.antialiasingControls.blur);E=d.ifElse(B,E,x);B=d.ifElse(B,new d.Float(1/255),new d.Float(0));return this.getFragmentOutput(E,v,B)}hittest(v,x,C){return d.ifElse(C,g.failHittest(this.hittestRequest),g.hittestFill(this,v,x))}}q.__decorate([q.__param(0,n.input(z)),q.__param(1,n.input(m.BaseHittestVertexInput))],A.prototype,"vertex",null);q.__decorate([q.__param(0,n.input(u))],A.prototype,"fragment",null);l.AOutlineFillShader=y;l.OutlineFillFragmentInput=u;l.OutlineFillShader=A;l.OutlineFillVertexInput=
z;l.getOutlineFillVertexData=w;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/PatternOutlineFillShader":function(){define("exports ../../../../../../../chunks/tslib.es6 ../../GraphShaderModule ../../graph/glsl ./AFeatureShader ./LineShader ./LocalTileOffset ./MosaicInfo ./OutlineFillShader ./PatternFillShader".split(" "),function(l,q,n,d,m,h,g,c,a,b){class k extends a.OutlineFillVertexInput{}q.__decorate([n.location(9,d.Vec4)],
k.prototype,"tlbr",void 0);q.__decorate([n.location(10,d.Float)],k.prototype,"inverseRasterizationScale",void 0);class e extends a.OutlineFillFragmentInput{}class r extends a.OutlineFillShader{vertex(f,p){return{...a.getOutlineFillVertexData(this,f,p),...b.getPatternFillVertexData(this,f)}}fragment(f){var {isOutline:p}=f;p=d.greaterThan(p,new d.Float(.5));var t=h.getLineFragmentColor(f,this.antialiasingControls.blur);const w=b.getPatternFillFragmentColor(f,this.mosaicInfo);t=d.ifElse(p,t,w);p=d.ifElse(p,
new d.Float(1/255),new d.Float(0));return this.getFragmentOutput(t,f,p)}}q.__decorate([n.uniform(c.MosaicInfo)],r.prototype,"mosaicInfo",void 0);q.__decorate([n.uniform(g.LocalTileOffset)],r.prototype,"localTileOffset",void 0);q.__decorate([q.__param(0,n.input(k)),q.__param(1,n.input(m.BaseHittestVertexInput))],r.prototype,"vertex",null);q.__decorate([q.__param(0,n.input(e))],r.prototype,"fragment",null);l.PatternOutlineFillFragmentInput=e;l.PatternOutlineFillShader=r;l.PatternOutlineFillVertexInput=
k;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/PatternFillShader":function(){define("exports ../../../../../../../chunks/tslib.es6 ../../GraphShaderModule ../../graph/glsl ./AFeatureShader ./FillShader ./LocalTileOffset ./MosaicInfo".split(" "),function(l,q,n,d,m,h,g,c){function a(f,p){var t=p.tlbr.xy,w=p.tlbr.zw,z=w.x.subtract(t.x);t=t.y.subtract(w.y);z=(new d.Vec2(z,t)).multiply(p.inverseRasterizationScale);t=z.multiply(f.view.requiredZoomFactor);
w=new d.Float(1);const u=new d.Float(0);w=new d.Mat3(w.divide(t.x),u.divide(t.y),0,d.negate(u.divide(t.x)),w.divide(t.y),0,0,0,1);z=f.localTileOffset.getPatternOffsetAtTileOrigin(z).divide(t);t=new d.Vec3(p.pos,1);z=w.multiply(t).xy.subtract(z);f=p.tlbr.divide(f.mosaicInfo.size.xyxy);return{tileTextureCoord:z,tlbr:f}}function b(f,p){var t=d.mod(f.tileTextureCoord,new d.Float(1));t=d.mix(f.tlbr.xy,f.tlbr.zw,t);p=d.texture2D(p.texture,t);return f.color.multiply(p)}class k extends h.FillVertexInput{}
q.__decorate([n.location(5,d.Vec4)],k.prototype,"tlbr",void 0);q.__decorate([n.location(6,d.Float)],k.prototype,"inverseRasterizationScale",void 0);class e extends m.FeatureFragmentInput{}class r extends h.FillShader{vertex(f,p){return{...super.vertex(f,p),...a(this,f)}}fragment(f){const p=b(f,this.mosaicInfo);return this.getFragmentOutput(p,f,new d.Float(0))}}q.__decorate([n.uniform(c.MosaicInfo)],r.prototype,"mosaicInfo",void 0);q.__decorate([n.uniform(g.LocalTileOffset)],r.prototype,"localTileOffset",
void 0);q.__decorate([q.__param(0,n.input(k)),q.__param(1,n.input(m.BaseHittestVertexInput))],r.prototype,"vertex",null);q.__decorate([q.__param(0,n.input(e))],r.prototype,"fragment",null);l.PatternFillFragmentInput=e;l.PatternFillShader=r;l.PatternFillVertexInput=k;l.getPatternFillFragmentColor=b;l.getPatternFillVertexData=a;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/fill/FillTechnique":function(){define(["exports","../FeatureTechnique",
"../featureTechniqueUtils","../TechniqueType","../shaders/FillShader"],function(l,q,n,d,m){class h extends q.FeatureTechnique{constructor(){super(...arguments);this.type=d.TechniqueType.Fill;this.shaders={geometry:new m.FillShader}}render(g,c){const {painter:a}=g,b=c.instance.getInput();a.setShader({shader:this.shaders.geometry,uniforms:{...n.resolveDynamicUniforms(g,c.target,b.uniforms),...n.getFeatureUniforms(g,c.target)},defines:n.getSelectionDefines(g),optionalAttributes:b.optionalAttributes,
useComputeBuffer:n.isHittest(g)});a.setPipelineState(n.getFeaturePipelineState(g));a.submitDraw(g,c)}}l.FillTechnique=h;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/fill/OutlineFillTechnique":function(){define("exports ../FeatureTechnique ../featureTechniqueUtils ../TechniqueType ../line/utils ../shaders/OutlineFillShader".split(" "),function(l,q,n,d,m,h){class g extends q.FeatureTechnique{constructor(){super(...arguments);this.type=
d.TechniqueType.OutlineFill;this.shaders={geometry:new h.OutlineFillShader}}render(c,a){const {painter:b,pixelRatio:k}=c,e=a.instance.getInput();b.setShader({shader:this.shaders.geometry,uniforms:{...n.resolveDynamicUniforms(c,a.target,e.uniforms),...n.getFeatureUniforms(c,a.target),antialiasingControls:m.getAntialiasingControls(k)},defines:{...n.getSelectionDefines(c)},optionalAttributes:e.optionalAttributes,useComputeBuffer:n.isHittest(c)});b.setPipelineState(n.getFeaturePipelineState(c));b.submitDraw(c,
a)}}l.OutlineFillTechnique=g;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/fill/PatternFillTechnique":function(){define(["exports","../FeatureTechnique","../featureTechniqueUtils","../TechniqueType","../shaders/PatternFillShader"],function(l,q,n,d,m){class h extends q.FeatureTechnique{constructor(){super(...arguments);this.type=d.TechniqueType.PatternFill;this.shaders={geometry:new m.PatternFillShader}}render(g,c){const {context:a,
painter:b}=g,k=c.instance.getInput();b.setShader({shader:this.shaders.geometry,uniforms:{...n.resolveDynamicUniforms(g,c.target,k.uniforms),...n.getFeatureUniforms(g,c.target),mosaicInfo:b.textureManager.getMosaicInfo(a,c.textureKey),localTileOffset:n.getLocalTileOffset(c.target)},defines:{...n.getSelectionDefines(g)},optionalAttributes:k.optionalAttributes,useComputeBuffer:n.isHittest(g)});b.setPipelineState(n.getFeaturePipelineState(g));b.submitDraw(g,c)}}l.PatternFillTechnique=h;Object.defineProperty(l,
Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/fill/PatternOutlineFillTechnique":function(){define("exports ../FeatureTechnique ../featureTechniqueUtils ../TechniqueType ../line/utils ../shaders/PatternOutlineFillShader".split(" "),function(l,q,n,d,m,h){class g extends q.FeatureTechnique{constructor(){super(...arguments);this.type=d.TechniqueType.PatternOutlineFill;this.shaders={geometry:new h.PatternOutlineFillShader}}render(c,a){const {context:b,painter:k,
pixelRatio:e}=c,r=a.instance.getInput();k.setShader({shader:this.shaders.geometry,uniforms:{...n.resolveDynamicUniforms(c,a.target,r.uniforms),...n.getFeatureUniforms(c,a.target),antialiasingControls:m.getAntialiasingControls(e),mosaicInfo:k.textureManager.getMosaicInfo(b,a.textureKey),localTileOffset:n.getLocalTileOffset(a.target)},defines:{...n.getSelectionDefines(c)},optionalAttributes:r.optionalAttributes,useComputeBuffer:n.isHittest(c)});k.setPipelineState(n.getFeaturePipelineState(c));k.submitDraw(c,
a)}}l.PatternOutlineFillTechnique=g;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/heatmap/HeatmapTechnique":function(){define("exports ../../../enums ../FeatureTechnique ../featureTechniqueUtils ../TechniqueType ./HeatmapResources ../shaders/HeatmapAccumulateShader ../shaders/HeatmapResolveShader ../../../../../../webgl/enums".split(" "),function(l,q,n,d,m,h,g,c,a){function b(t){return t.key.level+1}function k(t,w){const {referenceScale:z,
radius:u}=t.uniforms;return u*(0!==z?z/w.scale:1)}class e extends n.FeatureTechnique{constructor(){super(...arguments);this.type=m.TechniqueType.Heatmap;this.drawPhase=q.WGLDrawPhase.MAP|q.WGLDrawPhase.HITTEST|q.WGLDrawPhase.DEBUG;this.shaders={accumulate:new g.HeatmapAccumulateShader,resolve:new c.HeatmapResolveShader};this._isBound=!1;this._resources=new Map}shutdown(t){super.shutdown(t);this._resources.get(t)?.destroy();this._resources.delete(t);this._prevFBO=null;this._unbind()}render(t,w){const {context:z,
painter:u,state:y}=t;var A=w.instance.getInput();const {isFieldActive:v}=A.uniforms,x=this._getOrCreateResourcesRecord(z),C=x.loadQualityProfile(z);d.isHittest(t)||this._bind(t,x,A);u.setShader({shader:this.shaders.accumulate,uniforms:{...d.getFeatureUniforms(t,w.target),kernelControls:{radius:k(A,y),isFieldActive:v?1:0}},defines:{...d.getSelectionDefines(t),...C.defines},optionalAttributes:{},useComputeBuffer:d.isHittest(t)});A=d.isHittest(t)?f:r;u.setPipelineState(A);u.submitDraw(t,w)}getStencilReference(t){return b(t)}renderResolvePass(t,
w){if(!d.isHittest(t)){var {context:z,painter:u}=t,y=this._resources.get(z);if(null!=this._prevFBO&&null!=this._prevViewport&&y?.initialized){({defines:t}=y.loadQualityProfile(z));var {minDensity:A,maxDensity:v,radius:x}=w.getInput().uniforms;w=y.accumulateFramebuffer;y=y.resolveGradientTexture;t={shader:this.shaders.resolve,uniforms:{accumulatedDensity:{texture:{unit:8,texture:w.colorTexture},minAndInvRange:[A,1/(v-A)],normalization:3/(x*x*Math.PI)},gradient:{texture:{unit:9,texture:y}}},defines:t,
optionalAttributes:{},useComputeBuffer:!1};z.bindFramebuffer(this._prevFBO);z.setViewport(0,0,this._prevViewport.width,this._prevViewport.height);z.bindTexture(w.colorTexture,8);z.bindTexture(y,9);u.setPipelineState(p);u.submitDrawMesh(z,t,u.quadMesh);this._unbind()}}}_getOrCreateResourcesRecord(t){let w=this._resources.get(t);null==w&&(w=new h.HeatmapResources,this._resources.set(t,w));return w}_unbind(){this._prevViewport=this._prevFBO=null;this._isBound=!1}_bind(t,w,z){if(!this._isBound){var {context:u,
state:y,pixelRatio:A}=t;t=u.getBoundFramebufferObject();var v=u.getViewport();this._prevFBO=t;this._prevViewport=v;var {gradient:x,gradientHash:C}=z.uniforms;w.ensureResolveGradientTexture(u,C,x);var {width:B,height:E}=v;z=k(z,y);v=1.5<A?.25:.5;z=z<1/(2*v)?1:v;w=w.ensureAccumulateFBO(u,B*z,E*z);u.blitFramebuffer(t,w,0,0,t.width,t.height,0,0,w.width,w.height,a.FramebufferBit.STENCIL,a.TextureSamplingMode.NEAREST);u.bindFramebuffer(w);u.setViewport(0,0,w.width,w.height);u.setColorMask(!0,!0,!0,!0);
u.setClearColor(0,0,0,0);u.clear(a.FramebufferBit.COLOR);this._isBound=!0}}}const r={color:{write:[!0,!0,!0,!0],blendMode:"additive"},depth:!1,stencil:{write:!1,test:{ref:b,compare:a.CompareFunction.GEQUAL,mask:255,op:{fail:a.StencilOperation.KEEP,zFail:a.StencilOperation.KEEP,zPass:a.StencilOperation.REPLACE}}}},f={...r,stencil:!1},p={color:{write:[!0,!0,!0,!0],blendMode:"composite"},depth:!1,stencil:!1};l.HeatmapTechnique=e;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/heatmap/HeatmapResources":function(){define("exports ../../../../../../../core/Logger ../../../../../../../core/maybe ../../../../../../webgl/enums ../../../../../../webgl/FramebufferObject ../../../../../../webgl/heatmapTextureUtils ../../../../../../webgl/RenderbufferDescriptor ../../../../../../webgl/Texture ../../../../../../webgl/TextureDescriptor".split(" "),
function(l,q,n,d,m,h,g,c,a){class b{destroy(){this._accumulateFramebuffer=n.disposeMaybe(this._accumulateFramebuffer);this._resolveGradientTexture=n.disposeMaybe(this._resolveGradientTexture);this._qualityProfile=this._prevGradientHash=null}get initialized(){return null!=this._accumulateFramebuffer&&null!=this._resolveGradientTexture}get accumulateFramebuffer(){return this._accumulateFramebuffer}get resolveGradientTexture(){return this._resolveGradientTexture}loadQualityProfile(k){null==this._qualityProfile&&
(k=h.loadHeatmapTextureConfiguration(k,q.getLogger("esri.views.2d.engine.webgl.shaderGraph.techniques.heatmap.HeatmapResources")),this._qualityProfile={...k,defines:{usesHalfFloatPrecision:k.dataType!==d.PixelType.FLOAT}});return this._qualityProfile}ensureAccumulateFBO(k,e,r){if(null==this._accumulateFramebuffer){const {dataType:f,samplingMode:p,pixelFormat:t,internalFormat:w}=this.loadQualityProfile(k),z=new a.TextureDescriptor(e,r);z.pixelFormat=t;z.internalFormat=w;z.dataType=f;z.samplingMode=
p;z.wrapMode=d.TextureWrapMode.CLAMP_TO_EDGE;e=new g.RenderbufferDescriptor(d.RenderbufferFormat.DEPTH_STENCIL,e,r);this._accumulateFramebuffer=new m.FramebufferObject(k,z,e)}else{const {width:f,height:p}=this._accumulateFramebuffer;f===e&&p===r||this._accumulateFramebuffer.resize(e,r)}return this._accumulateFramebuffer}ensureResolveGradientTexture(k,e,r){null==this._resolveGradientTexture?(e=new a.TextureDescriptor,e.wrapMode=d.TextureWrapMode.CLAMP_TO_EDGE,this._resolveGradientTexture=new c.Texture(k,
e)):this._prevGradientHash!==e&&(this._resolveGradientTexture.resize(r.length/4,1),this._resolveGradientTexture.setData(r),this._prevGradientHash=e);return this._resolveGradientTexture}}l.HeatmapResources=b;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/heatmapTextureUtils":function(){define(["exports","../../core/Error","./enums"],function(l,q,n){class d{constructor(h,g,c,a){this.dataType=h;this.samplingMode=g;this.pixelFormat=c;this.internalFormat=a}}const m=new d(n.PixelType.HALF_FLOAT,
n.TextureSamplingMode.NEAREST,n.PixelFormat.RGBA,n.PixelFormat.RGBA);l.HeatmapTextureConfiguration=d;l.fallBackHeatmapConfiguration=m;l.loadHeatmapTextureConfiguration=function(h,g){const {textureFloatLinear:c,colorBufferFloat:a}=h.capabilities,b=a?.textureFloat,k=a?.textureHalfFloat,e=a?.floatBlend;h=h.driverTest.floatBufferBlend.result;if(!b&&!k)throw new q("heatmap:missing-color-buffer-float","HeatmapRenderer requires the WebGL extension EXT_color_buffer_float or EXT_color_buffer_half_float or WEBGL_color_buffer_float.");
if(!(e&&h||k))throw new q("heatmap:missing-float-blend",`HeatmapRenderer requires the WebGL extension EXT_float_blend or EXT_color_buffer_half_float.${h?"":" This device claims support for EXT_float_blend, but does not actually support it."}`);const r=!!a?.R32F,f=!!a?.R16F;if(b&&e&&h&&c)return c||g.warnOnce("Missing WebGL extension OES_texture_float_linear. Heatmap quality may be reduced."),new d(n.PixelType.FLOAT,c?n.TextureSamplingMode.LINEAR:n.TextureSamplingMode.NEAREST,r?n.PixelFormat.RED:n.PixelFormat.RGBA,
r?n.SizedPixelFormat.R32F:n.PixelFormat.RGBA);if(k)return new d(n.PixelType.HALF_FLOAT,n.TextureSamplingMode.LINEAR,f?n.PixelFormat.RED:n.PixelFormat.RGBA,f?n.SizedPixelFormat.R16F:n.PixelFormat.RGBA);throw new q("heatmap:missing-hardware-support","HeatmapRenderer requires WebGL extensions that allow it to render and blend to float or half float textures.");};Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/HeatmapAccumulateShader":function(){define("exports ../../../../../../../chunks/tslib.es6 ../../GraphShaderModule ../../graph/glsl ./AFeatureShader ./heatmapUtils ./hittestUtils".split(" "),
function(l,q,n,d,m,h,g){class c extends m.FeatureVertexInput{}q.__decorate([n.location(5,d.Vec2)],c.prototype,"offset",void 0);class a extends m.FeatureFragmentInput{}class b extends n.UniformGroup{}q.__decorate([n.uniform(d.Float)],b.prototype,"radius",void 0);q.__decorate([n.uniform(d.Float)],b.prototype,"isFieldActive",void 0);class k extends m.AFeatureShader{constructor(){super(...arguments);this.usesHalfFloatPrecision=!1}vertex(e){const {radius:r,isFieldActive:f}=this.kernelControls,p=e.offset,
t=f.multiply(this.storage.getVVData(e.id).x).add((new d.Float(1)).subtract(f)),w=this.view.displayViewScreenMat3.multiply(new d.Vec3(e.pos,1)).add(this.view.displayViewMat3.multiply(new d.Vec3(p,0)).multiply(r)),z=this.clip(e.id);return{glPosition:new d.Vec4(w.xy,z,1),offset:p,fieldValue:t,color:new d.Vec4(0),...this.maybeRunHittest(e,{},null)}}fragment(e){const {offset:r,fieldValue:f}=e;var p=d.length(r),t=d.step(p,new d.Float(1));p=(new d.Float(1)).subtract(p.multiply(p));p=p.multiply(p);t=t.multiply(p).multiply(f).multiply(new d.Float(h.getHeatmapCompressionFactor(this.usesHalfFloatPrecision)));
return this.getFragmentOutput(new d.Vec4(t),e)}hittest(e){const {viewMat3:r,tileMat3:f}=this.view;e=r.multiply(f).multiply(new d.Vec3(e.pos,1));return g.hittestMarker(e.xy,this.kernelControls.radius,this.hittestRequest.position)}}q.__decorate([n.define],k.prototype,"usesHalfFloatPrecision",void 0);q.__decorate([n.uniform(b)],k.prototype,"kernelControls",void 0);q.__decorate([q.__param(0,n.input(c))],k.prototype,"vertex",null);q.__decorate([q.__param(0,n.input(a))],k.prototype,"fragment",null);l.HeatmapAccumulateFragmentInput=
a;l.HeatmapAccumulateShader=k;l.HeatmapAccumulateVertexInput=c;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/heatmapUtils":function(){define(["exports"],function(l){l.getHeatmapCompressionFactor=function(q){return q?.25:1};Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/HeatmapResolveShader":function(){define(["exports","../../../../../../../chunks/tslib.es6",
"../../GraphShaderModule","../../graph/glsl","./heatmapUtils"],function(l,q,n,d,m){class h extends n.VertexInput{}q.__decorate([n.location(0,d.Vec2)],h.prototype,"position",void 0);class g extends n.FragmentInput{}class c extends n.UniformGroup{}q.__decorate([n.uniform(d.Sampler2D)],c.prototype,"texture",void 0);q.__decorate([n.uniform(d.Vec2)],c.prototype,"minAndInvRange",void 0);q.__decorate([n.uniform(d.Float)],c.prototype,"normalization",void 0);class a extends n.UniformGroup{}q.__decorate([n.uniform(d.Sampler2D)],
a.prototype,"texture",void 0);class b extends n.GraphShaderModule{constructor(){super(...arguments);this.usesHalfFloatPrecision=!1}vertex(k){return{glPosition:new d.Vec4(k.position.multiply(2).subtract(1),1,1),uv:k.position}}fragment(k){const {accumulatedDensity:e,gradient:r}=this;k=d.texture2D(e.texture,k.uv).r.divide(new d.Float(m.getHeatmapCompressionFactor(this.usesHalfFloatPrecision)));k=k.multiply(e.normalization);k=k.subtract(e.minAndInvRange.x).multiply(e.minAndInvRange.y);k=d.texture2D(r.texture,
new d.Vec2(k,.5));const f=new n.FragmentOutput;f.glFragColor=new d.Vec4(k.rgb.multiply(k.a),k.a);return f}}q.__decorate([n.define],b.prototype,"usesHalfFloatPrecision",void 0);q.__decorate([n.uniform(c)],b.prototype,"accumulatedDensity",void 0);q.__decorate([n.uniform(a)],b.prototype,"gradient",void 0);q.__decorate([q.__param(0,n.input(h))],b.prototype,"vertex",null);q.__decorate([q.__param(0,n.input(g))],b.prototype,"fragment",null);l.AccumulatedDensity=c;l.Gradient=a;l.HeatmapResolveFragmentInput=
g;l.HeatmapResolveShader=b;l.HeatmapResolveVertexInput=h;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/labels/LabelTechnique":function(){define("exports ../../../enums ../FeatureTechnique ../featureTechniqueUtils ../TechniqueType ../text/TextShader".split(" "),function(l,q,n,d,m,h){class g extends n.FeatureTechnique{constructor(){super(...arguments);this.type=m.TechniqueType.Label;this.shaders={geometry:new h.TextShader};this.drawPhase=
q.WGLDrawPhase.LABEL|q.WGLDrawPhase.LABEL_ALPHA|q.WGLDrawPhase.HITTEST;this.symbologyPlane=q.FeatureSymbologyDrawOrder.TEXT}render(c,a){const {context:b,painter:k}=c,e=d.getSelectionDefines(c),r={...d.getFeaturePipelineState(c)};var f=a.instance.getInput();f={shader:this.shaders.geometry,uniforms:{...d.resolveDynamicUniforms(c,a.target,f.uniforms),...d.getFeatureUniforms(c,a.target),mosaicInfo:k.textureManager.getMosaicInfo(b,a.textureKey)},defines:{...e,textRenderPassType:h.TextRenderPassType.Color,
isBackgroundPass:!0,isLabel:!0},optionalAttributes:f.optionalAttributes,useComputeBuffer:d.isHittest(c)};k.setShader(f);k.setPipelineState(r);k.submitDraw(c,a);k.setShader({...f,defines:{...e,textRenderPassType:h.TextRenderPassType.Halo,isBackgroundPass:!1,isLabel:!0}});k.setPipelineState(r);k.submitDraw(c,a);k.setShader({...f,defines:{...e,textRenderPassType:h.TextRenderPassType.Color,isBackgroundPass:!1,isLabel:!0}});k.setPipelineState(r);k.submitDraw(c,a)}}l.LabelTechnique=g;Object.defineProperty(l,
Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/text/TextShader":function(){define("exports ../../../../../../../chunks/tslib.es6 ../../../definitions ../../GraphShaderModule ../../graph/glsl ../shaders/AFeatureShader ../shaders/constants ../shaders/hittestUtils ../shaders/MosaicInfo ../shaders/utils ../shaders/VisualVariableColor ../shaders/VisualVariableOpacity ../shaders/VisualVariableRotation ../shaders/VisualVariableSizeMinMaxValue ../shaders/VisualVariableSizeScaleStops ../shaders/VisualVariableSizeStops ../shaders/VisualVariableSizeUnitValue ../shaders/vvUtils".split(" "),
function(l,q,n,d,m,h,g,c,a,b,k,e,r,f,p,t,w,z){const u=360/254;l.TextRenderPassType=void 0;(function(C){C[C.Color=0]="Color";C[C.Outline=1]="Outline";C[C.Halo=2]="Halo"})(l.TextRenderPassType||(l.TextRenderPassType={}));class y extends h.FeatureVertexInput{}q.__decorate([d.location(3,m.Vec4)],y.prototype,"color",void 0);q.__decorate([d.location(4,m.Vec2)],y.prototype,"offset",void 0);q.__decorate([d.location(5,m.Vec2)],y.prototype,"textureUV",void 0);q.__decorate([d.location(6,m.Float)],y.prototype,
"fontSize",void 0);q.__decorate([d.location(7,m.Float)],y.prototype,"referenceSize",void 0);q.__decorate([d.location(8,m.Vec4)],y.prototype,"outlineColor",void 0);q.__decorate([d.location(9,m.Vec4)],y.prototype,"haloColor",void 0);q.__decorate([d.location(10,m.Vec2)],y.prototype,"outlineAndHaloSize",void 0);q.__decorate([d.location(11,m.Vec2)],y.prototype,"zoomRange",void 0);q.__decorate([d.location(12,m.Float)],y.prototype,"clipAngle",void 0);q.__decorate([d.location(13,m.Vec4)],y.prototype,"referenceSymbol",
void 0);class A extends d.ComputeVertexInput{}q.__decorate([d.location(14,m.Vec2)],A.prototype,"offsetNextVertex1",void 0);q.__decorate([d.location(15,m.Vec2)],A.prototype,"offsetNextVertex2",void 0);class v extends h.FeatureFragmentInput{}class x extends h.AFeatureShader{constructor(){super(...arguments);this.computeAttributes={offset:["offsetNextVertex1","offsetNextVertex2"]};this.textRenderPassType=l.TextRenderPassType.Color;this.isLabel=this.isBackgroundPass=!1}clipLabel(C,B,E){B=B.multiply(u);
B=m.abs(this.view.rotation.subtract(B));var D=m.min((new m.Float(360)).subtract(B),B);B=new m.Float(0);const F=m.floor(this.view.currentZoom.multiply(n.minMaxZoomPrecisionFactor)).divide(n.minMaxZoomPrecisionFactor);var G=C.x;C=C.y;G=(new m.Float(1)).subtract(m.step(G,F)).multiply(2);D=m.step(new m.Float(90),D).multiply(2);C=(new m.Float(2)).multiply((new m.Float(1)).subtract(m.step(F,C)));B=B.add(E.multiply(G));B=B.add(E.multiply(D));return B=B.add(C)}vertex(C,B){var E=b.getBit(C.bitset,g.bitsetTextIsBackground),
D=(new m.Float(1)).subtract(E),F=C.fontSize;let G=F.divide(g.sdfFontSize);var H=this.textRenderPassType===l.TextRenderPassType.Outline?C.outlineColor:this.textRenderPassType===l.TextRenderPassType.Halo?C.haloColor:this._getVertexColor(C),I=this.isLabel?this.storage.getLabelVisibility(C.id):new m.Float(1);H=this.isLabel?H.multiply(I):H;var K=this.view.displayViewScreenMat3.multiply(new m.Vec3(C.pos,1)),L=C.offset;let R=new m.Float(1),S=m.Mat3.identity();var W=new m.Vec2(0);if(this.isLabel){if(!C.referenceSymbol)throw Error("InternalError: Optional attribute 'referenceSymbol' expected for labels");
var J=C.referenceSymbol;W=J.xy;var O=J.z;J=this._unpackDirection(J.w);O=z.getVisualVariableSize(this,C.id,O).divide(2);O=J.multiply(O.add(n.labelPlacementOffsetPadding));W=W.add(O);L=L.add(W)}else R=z.getVisualVariableSize(this,C.id,C.referenceSize).divide(C.referenceSize),F=F.multiply(R),G=G.multiply(R),L=L.multiply(R),S=z.getVisualVariableRotation(this,C.id),L=S.multiply(new m.Vec3(L,0)).xy;J=b.getBit(C.bitset,g.bitsetTextIsMapAligned);O=this._getViewRotationMatrix(J).multiply(new m.Vec3(L,0));
L=this.isLabel?this.clipLabel(C.zoomRange,C.clipAngle,J):this.clip(C.id,C.zoomRange);L=this.isBackgroundPass?L.add(D.multiply(2)):L.add(E.multiply(2));E=this.isLabel?m.or(m.greaterThan(L,new m.Float(1)),m.equal(I,new m.Float(0))):new m.Bool(!1);D=new m.Vec4(K.xy.add(O.xy),L,1);I=C.textureUV.divide(this.mosaicInfo.size);K=new m.Float(0);this.textRenderPassType===l.TextRenderPassType.Outline&&(m.equal(C.outlineAndHaloSize.x,new m.Float(0))&&(L=L.add(new m.Float(2))),K=(new m.Float(C.outlineAndHaloSize.x)).divide(G).divide(g.maxSdfDistance));
this.textRenderPassType===l.TextRenderPassType.Halo&&(K=C.outlineAndHaloSize.x,O=new m.Float(C.outlineAndHaloSize.y),m.equal(O,new m.Float(0))&&(L=L.add(new m.Float(2))),K=O.add(K).divide(G).divide(g.maxSdfDistance));F=(new m.Float(.105*g.sdfFontSize)).divide(F).divide(this.view.pixelRatio);return{glPosition:D,color:H,size:G,textureUV:I,antialiasingWidth:F,outlineDistanceOffset:K,...this.maybeRunHittest(C,B,{vvSizeAdjustment:R,vvRotation:S,labelOffset:W,labelClipped:E})}}_getViewRotationMatrix(C){const B=
this.view.displayViewMat3,E=this.view.displayMat3,D=(new m.Float(1)).subtract(C);return B.multiply(C).add(E.multiply(D))}fragment(C){var B=new m.Float(.25),E=(new m.Float(1)).subtract(B);B=m.texture2D(this.mosaicInfo.texture,C.textureUV).a;E=E.subtract(C.outlineDistanceOffset);this.highlight&&(E=E.divide(2));const D=C.antialiasingWidth;B=m.smoothstep(E.subtract(D),E.add(D),B);return this.getFragmentOutput(C.color.multiply(B),C)}hittest(C,B,{vvSizeAdjustment:E,vvRotation:D,labelOffset:F,labelClipped:G}){if(this.isLabel){var H=
new m.Vec3(C.offset.add(F),0);var I=new m.Vec3(B.offsetNextVertex1.add(F),0);B=new m.Vec3(B.offsetNextVertex2.add(F),0)}else H=D.multiply(new m.Vec3(C.offset.multiply(E),0)),I=D.multiply(new m.Vec3(B.offsetNextVertex1.multiply(E),0)),B=D.multiply(new m.Vec3(B.offsetNextVertex2.multiply(E),0));const {viewMat3:K,tileMat3:L}=this.view;C=K.multiply(L).multiply(new m.Vec3(C.pos,1));H=C.add(L.multiply(H)).xy;I=C.add(L.multiply(I)).xy;C=C.add(L.multiply(B)).xy;I=c.distPointTriangle(this.hittestRequest.position,
H.xy,I.xy,C.xy);return this.isLabel?m.ifElse(G,c.failHittest(this.hittestRequest),I):I}_unpackDirection(C){var B=new m.Int(C);C=m.bitRShift(B,new m.Int(2));B=m.bitAnd(B,new m.Int(3));return new m.Vec2((new m.Float(C)).subtract(1),(new m.Float(B)).subtract(1))}_getVertexColor(C){var B=C.color;this.visualVariableColor&&(B=this.storage.getColorValue(C.id),B=this.visualVariableColor.getColor(B,C.color,new m.Bool(!1)));this.visualVariableOpacity&&(C=this.storage.getOpacityValue(C.id),C=this.visualVariableOpacity.getOpacity(C),
B=B.multiply(C));return B}}q.__decorate([d.option(k.VisualVariableColor)],x.prototype,"visualVariableColor",void 0);q.__decorate([d.option(e.VisualVariableOpacity)],x.prototype,"visualVariableOpacity",void 0);q.__decorate([d.option(r.VisualVariableRotation)],x.prototype,"visualVariableRotation",void 0);q.__decorate([d.option(f.VisualVariableSizeMinMaxValue)],x.prototype,"visualVariableSizeMinMaxValue",void 0);q.__decorate([d.option(p.VisualVariableSizeScaleStops)],x.prototype,"visualVariableSizeScaleStops",
void 0);q.__decorate([d.option(t.VisualVariableSizeStops)],x.prototype,"visualVariableSizeStops",void 0);q.__decorate([d.option(w.VisualVariableSizeUnitValue)],x.prototype,"visualVariableSizeUnitValue",void 0);q.__decorate([d.uniform(a.MosaicInfo)],x.prototype,"mosaicInfo",void 0);q.__decorate([d.define],x.prototype,"textRenderPassType",void 0);q.__decorate([d.define],x.prototype,"isBackgroundPass",void 0);q.__decorate([d.define],x.prototype,"isLabel",void 0);q.__decorate([q.__param(0,d.input(y)),
q.__param(1,d.input(A))],x.prototype,"vertex",null);q.__decorate([q.__param(0,d.input(v))],x.prototype,"fragment",null);l.TextFragmentInput=v;l.TextShader=x;l.TextVertexInput=y;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/line/LineTechnique":function(){define("exports ../../../enums ../FeatureTechnique ../featureTechniqueUtils ../TechniqueType ./utils ../shaders/LineShader".split(" "),function(l,q,n,d,m,h,g){class c extends n.FeatureTechnique{constructor(){super(...arguments);
this.type=m.TechniqueType.Line;this.shaders={geometry:new g.LineShader};this.symbologyPlane=q.FeatureSymbologyDrawOrder.LINE}render(a,b){const {painter:k,pixelRatio:e}=a,r=b.instance.getInput();k.setShader({shader:this.shaders.geometry,uniforms:{...d.resolveDynamicUniforms(a,b.target,r.uniforms),...d.getFeatureUniforms(a,b.target),antialiasingControls:h.getAntialiasingControls(e)},defines:{...d.getSelectionDefines(a)},optionalAttributes:r.optionalAttributes,useComputeBuffer:d.isHittest(a)});k.setPipelineState(d.getFeaturePipelineState(a));
k.submitDraw(a,b)}}l.LineTechnique=c;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/line/TexturedLineTechnique":function(){define("exports ../../../enums ../FeatureTechnique ../featureTechniqueUtils ../TechniqueType ./utils ../shaders/TexturedLineShader".split(" "),function(l,q,n,d,m,h,g){class c extends n.FeatureTechnique{constructor(){super(...arguments);this.type=m.TechniqueType.TexturedLine;this.shaders={geometry:new g.TexturedLineShader};
this.symbologyPlane=q.FeatureSymbologyDrawOrder.LINE}render(a,b){const {context:k,painter:e,pixelRatio:r}=a,f=b.instance.getInput();e.setShader({shader:this.shaders.geometry,uniforms:{...d.resolveDynamicUniforms(a,b.target,f.uniforms),...d.getFeatureUniforms(a,b.target),antialiasingControls:h.getAntialiasingControls(r),mosaicInfo:e.textureManager.getMosaicInfo(k,b.textureKey)},defines:{...d.getSelectionDefines(a)},optionalAttributes:f.optionalAttributes,useComputeBuffer:d.isHittest(a)});e.setPipelineState(d.getFeaturePipelineState(a));
e.submitDraw(a,b)}}l.TexturedLineTechnique=c;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/TexturedLineShader":function(){define("exports ../../../../../../../chunks/tslib.es6 ../../../../../../../core/screenUtils ../../../../../../../symbols/cim/constants ../../GraphShaderModule ../../graph/glsl ./AFeatureShader ./constants ./LineShader ./MosaicInfo ./utils".split(" "),function(l,q,n,d,m,h,g,c,a,b,k){class e extends a.LineVertexInput{}
q.__decorate([m.location(9,h.Float)],e.prototype,"accumulatedDistance",void 0);q.__decorate([m.location(10,h.Vec2)],e.prototype,"segmentDirection",void 0);q.__decorate([m.location(11,h.Float)],e.prototype,"offsetAlongLine",void 0);q.__decorate([m.location(12,h.Float)],e.prototype,"capType",void 0);q.__decorate([m.location(13,h.Vec4)],e.prototype,"tlbr",void 0);class r extends a.LineFragmentInput{}class f extends a.LineShader{_getDistanceRatio(p,t){p=k.getBit(p.bitset,c.bitsetLineScaleDash);return p.multiply(h.max(t,
new h.Float(.25)).multiply(new h.Float(2))).add((new h.Float(1)).subtract(p).multiply(n.pt2px(1)))}_getSDFAlpha(p){const {halfWidth:t,normal:w,tlbr:z,patternSize:u,accumulatedDistance:y,offsetAlongLine:A,dashToPx:v,capType:x}=p;p=u.x.divide(d.dashSdfRasterizationScale).multiply(v);p=h.fract(y.add(A).divide(p));p=h.mix(z.xy,z.zw,new h.Vec2(p,.5));p=k.rgba2float(h.texture2D(this.mosaicInfo.texture,p)).multiply(2).subtract(1).multiply(d.dashSdfDistanceNormalization).multiply(v);const C=w.y.multiply(t);
p=h.cond([h.equal(x,new h.Float(1)),p.subtract(t)],[h.equal(x,new h.Float(2)),h.sqrt(h.pow(h.max(p,new h.Float(0)),new h.Float(2)).add(C.multiply(C))).subtract(t)],[!0,p]);p=h.clamp((new h.Float(.25)).subtract(p),new h.Float(0),new h.Float(1));return new h.Vec4(p)}_getPatternColor(p){const {halfWidth:t,normal:w,color:z,accumulatedDistance:u,patternSize:y,sampleAlphaOnly:A,tlbr:v}=p;p=y.y.multiply((new h.Float(2)).multiply(t).divide(y.x));p=h.fract(u.divide(p));const x=(new h.Float(.5)).multiply(w.y).add(new h.Float(.5));
p=h.mix(v.xy,v.zw,new h.Vec2(x,p));p=h.texture2D(this.mosaicInfo.texture,p);null!=this.visualVariableColor&&(p=h.ifElse(h.greaterThan(A,new h.Float(.5)),new h.Vec4(z.a),z));return p}vertex(p,t){const {segmentDirection:w,tlbr:z,bitset:u}=p,y=a.getLineVertexData(this,p),A=p.accumulatedDistance.divide(this.view.displayZoomFactor).add(h.dot(w,y.scaledOffset)),v=new h.Vec2(z.z.subtract(z.x),z.w.subtract(z.y)),x=z.divide(this.mosaicInfo.size.xyxy),C=k.getBit(u,c.bitsetLineIsSdf),B=k.getBit(u,c.bitsetGenericConsiderAlphaOnly),
E=h.ifElse(h.greaterThan(C,new h.Float(.5)),this._getDistanceRatio(p,y.scaledHalfWidth),new h.Float(1));return{...y,tlbr:x,patternSize:v,accumulatedDistance:A,isSDF:C,sampleAlphaOnly:B,dashToPx:E,offsetAlongLine:p.offsetAlongLine,capType:p.capType,...this.maybeRunHittest(p,t,y.halfWidth)}}fragment(p){const {color:t,opacity:w,isSDF:z}=p;var u=a.getLineAntialiasing(p,this.antialiasingControls.blur);const y=h.ifElse(h.greaterThan(z,new h.Float(.5)),this._getSDFAlpha(p),this._getPatternColor(p));u=t.multiply(w).multiply(u).multiply(y);
return this.getFragmentOutput(u,p)}}q.__decorate([m.uniform(b.MosaicInfo)],f.prototype,"mosaicInfo",void 0);q.__decorate([q.__param(0,m.input(e)),q.__param(1,m.input(g.BaseHittestVertexInput))],f.prototype,"vertex",null);l.TexturedLineFragmentInput=r;l.TexturedLineShader=f;l.TexturedLineVertexInput=e;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/markers/MarkerTechnique":function(){define("exports ../../../enums ../FeatureTechnique ../featureTechniqueUtils ../TechniqueType ./MarkerShader".split(" "),
function(l,q,n,d,m,h){class g extends n.FeatureTechnique{constructor(){super(...arguments);this.type=m.TechniqueType.Marker;this.shaders={geometry:new h.MarkerShader};this.symbologyPlane=q.FeatureSymbologyDrawOrder.MARKER}render(c,a){const {context:b,painter:k}=c,e=a.instance.getInput();k.setShader({shader:this.shaders.geometry,uniforms:{...d.resolveDynamicUniforms(c,a.target,e.uniforms),...d.getFeatureUniforms(c,a.target),mosaicInfo:k.textureManager.getMosaicInfo(b,a.textureKey,!0)},defines:{...d.getSelectionDefines(c)},
optionalAttributes:e.optionalAttributes,useComputeBuffer:d.isHittest(c)});k.setPipelineState(d.getFeaturePipelineState(c));k.submitDraw(c,a)}}l.MarkerTechnique=g;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/markers/MarkerShader":function(){define("exports ../../../../../../../chunks/tslib.es6 ../../GraphShaderModule ../../graph/glsl ./markerConstants ../shaders/AFeatureShader ../shaders/constants ../shaders/hittestUtils ../shaders/MosaicInfo ../shaders/utils ../shaders/VisualVariableColor ../shaders/VisualVariableOpacity ../shaders/VisualVariableRotation ../shaders/VisualVariableSizeMinMaxValue ../shaders/VisualVariableSizeScaleStops ../shaders/VisualVariableSizeStops ../shaders/VisualVariableSizeUnitValue ../shaders/vvUtils".split(" "),
function(l,q,n,d,m,h,g,c,a,b,k,e,r,f,p,t,w,z){function u(B,E,D,F){return E.multiply(B.x).add(D.multiply(B.y)).add(F.multiply(B.z))}function y(B){return B.multiply(B).divide(128)}class A extends h.FeatureVertexInput{}q.__decorate([n.location(3,d.Vec4)],A.prototype,"color",void 0);q.__decorate([n.location(4,d.Vec4)],A.prototype,"outlineColor",void 0);q.__decorate([n.location(5,d.Vec2)],A.prototype,"offset",void 0);q.__decorate([n.location(6,d.Vec2)],A.prototype,"textureUV",void 0);q.__decorate([n.location(7,
d.Vec4)],A.prototype,"sizing",void 0);q.__decorate([n.location(8,d.Float)],A.prototype,"placementAngle",void 0);q.__decorate([n.location(9,d.Float)],A.prototype,"sdfDecodeCoeff",void 0);q.__decorate([n.location(10,d.Vec2)],A.prototype,"zoomRange",void 0);class v extends n.ComputeVertexInput{}q.__decorate([n.location(12,d.Vec2)],v.prototype,"offsetNextVertex1",void 0);q.__decorate([n.location(13,d.Vec2)],v.prototype,"offsetNextVertex2",void 0);q.__decorate([n.location(14,d.Vec2)],v.prototype,"textureUVNextVertex1",
void 0);q.__decorate([n.location(15,d.Vec2)],v.prototype,"textureUVNextVertex2",void 0);class x extends h.FeatureFragmentInput{}class C extends h.AFeatureShader{constructor(){super(...arguments);this.computeAttributes={offset:["offsetNextVertex1","offsetNextVertex2"],textureUV:["textureUVNextVertex1","textureUVNextVertex2"]}}vertex(B,E){var D=y(B.sizing.x),F=y(B.sizing.y),G=y(B.sizing.z),H=B.placementAngle;const I=b.getBit(B.bitset,m.MarkerConstants.bitset.isSDF),K=b.getBit(B.bitset,m.MarkerConstants.bitset.isMapAligned);
var L=b.getBit(B.bitset,m.MarkerConstants.bitset.scaleSymbolsProportionally),R=b.getBitBool(B.bitset,m.MarkerConstants.bitset.colorLocked),S=z.getVisualVariableOpacity(this,B.id);R=z.getVisualVariableColor(this,B.id,B.color,R).multiply(S);S=this.view.displayViewScreenMat3.multiply(new d.Vec3(B.pos.xy,1));G=z.getVisualVariableSize(this,B.id,G).divide(G);D=D.multiply(G);var W=B.offset.xy.multiply(G);L=F.multiply(L.multiply(G.subtract(1)).add(1));L=d.min(L,d.max(D.subtract(.99),new d.Float(0)));F=d.max(L,
new d.Float(1));var J=d.min(L,new d.Float(1));H=d.Mat3.fromRotation(H.multiply(g.c256ToRad));L=z.getVisualVariableRotation(this,B.id);W=this._getViewRotationMatrix(K).multiply(L).multiply(H).multiply(new d.Vec3(W.xy,0));var O=this.clip(B.id,B.zoomRange);S=new d.Vec4(S.xy.add(W.xy),O,1);W=B.textureUV.divide(this.mosaicInfo.size);J=B.outlineColor.multiply(J);O=b.getBit(B.bitset,m.MarkerConstants.bitset.overrideOutlineColor);const T=B.sdfDecodeCoeff.multiply(D);return{glPosition:S,color:R,textureUV:W,
outlineColor:J,outlineSize:F,distanceToPx:T,isSDF:I,overrideOutlineColor:O,...this.maybeRunHittest(B,E,{pos:B.pos,size:D,sizeCorrection:G,isMapAligned:K,vvRotationMat3:L,placementMat3:H,outlineSize:F,distanceToPx:T,isSDF:I})}}fragment(B){const E=this._getColor(B.textureUV,B);return this.getFragmentOutput(E,B)}hittest(B,E,D){return d.ifElse(d.lessThan(D.size,this.hittestRequest.smallSymbolSizeThreshold),this._hittestSmallMarker(B,E,D),this._hittestMarker(B,E,D))}_getViewRotationMatrix(B){const E=this.view.displayViewMat3,
D=this.view.displayMat3,F=(new d.Float(1)).subtract(B);return E.multiply(B).add(D.multiply(F))}_getViewScreenMatrix(B){const E=this.view.viewMat3.multiply(this.view.tileMat3),D=this.view.tileMat3,F=(new d.Float(1)).subtract(B);return E.multiply(B).add(D.multiply(F))}_getColor(B,E){return d.ifElse(d.equal(E.isSDF,new d.Float(1)),this._getSDFColor(B,E),this._getSpriteColor(B,E))}_getSpriteColor(B,E){return d.texture2D(this.mosaicInfo.texture,B).multiply(E.color)}_getSDFColor(B,E){B=d.texture2D(this.mosaicInfo.texture,
B);var D=(new d.Float(.5)).subtract(b.rgba2float(B)).multiply(E.distanceToPx).multiply(g.softEdgeRatio);B=d.clamp((new d.Float(.5)).subtract(D),new d.Float(0),new d.Float(1));B=E.color.multiply(B);var F=E.outlineSize;this.highlight&&(F=d.max(F,E.overrideOutlineColor.multiply(4)));F=F.multiply(.5);D=d.abs(D).subtract(F);D=d.clamp((new d.Float(.5)).subtract(D),new d.Float(0),new d.Float(1));E=d.mix(E.outlineColor,E.color,E.overrideOutlineColor).multiply(D);return(new d.Float(1)).subtract(E.a).multiply(B).add(E)}_hittestSmallMarker(B,
E,D){const {position:F,distance:G,smallSymbolDistance:H}=this.hittestRequest;B=G.subtract(H);const {viewMat3:I,tileMat3:K}=this.view;E=I.multiply(K).multiply(new d.Vec3(D.pos,1)).xy;D=D.size.multiply(.5);return d.distance(E,F).subtract(D).add(B)}_hittestMarker(B,E,D){const {pos:F,sizeCorrection:G,isMapAligned:H}=D;var I=new d.Vec3(B.offset.multiply(G),0),K=new d.Vec3(E.offsetNextVertex1.multiply(G),0),L=new d.Vec3(E.offsetNextVertex2.multiply(G),0);const {viewMat3:R,tileMat3:S}=this.view;var W=R.multiply(S).multiply(new d.Vec3(F,
1)),J=this._getViewScreenMatrix(H).multiply(D.vvRotationMat3).multiply(D.placementMat3);I=W.add(J.multiply(I)).xy;K=W.add(J.multiply(K)).xy;L=W.add(J.multiply(L)).xy;W=this.hittestRequest.distance;J=c.distPointTriangle(this.hittestRequest.position,I,K,L);return d.ifElse(d.greaterThan(J,W),J,this._hittestSamples(I,K,L,B,E,D))}_hittestSamples(B,E,D,F,G,H){const {outlineSize:I,isSDF:K,distanceToPx:L}=H;var R=this.hittestRequest.position;const S=this.hittestRequest.distance;H=c.xyToBarycentric(R.add(new d.Vec2(d.negate(S),
d.negate(S))),B,E,D);const W=c.xyToBarycentric(R.add(new d.Vec2(0,d.negate(S))),B,E,D),J=c.xyToBarycentric(R.add(new d.Vec2(S,d.negate(S))),B,E,D),O=c.xyToBarycentric(R.add(new d.Vec2(d.negate(S),0)),B,E,D),T=c.xyToBarycentric(R,B,E,D),X=c.xyToBarycentric(R.add(new d.Vec2(S,0)),B,E,D),U=c.xyToBarycentric(R.add(new d.Vec2(d.negate(S),S)),B,E,D),N=c.xyToBarycentric(R.add(new d.Vec2(0,S)),B,E,D);B=c.xyToBarycentric(R.add(new d.Vec2(S,S)),B,E,D);F=F.textureUV.divide(this.mosaicInfo.size);E=G.textureUVNextVertex1.divide(this.mosaicInfo.size);
G=G.textureUVNextVertex2.divide(this.mosaicInfo.size);D={color:new d.Vec4(1),outlineColor:new d.Vec4(1),overrideOutlineColor:new d.Float(1),outlineSize:I,distanceToPx:L,isSDF:K};R=new d.Float(0);R=R.add(c.inTriangle(H).multiply(this._getColor(u(H,F,E,G),D).a));R=R.add(c.inTriangle(W).multiply(this._getColor(u(W,F,E,G),D).a));R=R.add(c.inTriangle(J).multiply(this._getColor(u(J,F,E,G),D).a));R=R.add(c.inTriangle(O).multiply(this._getColor(u(O,F,E,G),D).a));R=R.add(c.inTriangle(T).multiply(this._getColor(u(T,
F,E,G),D).a));R=R.add(c.inTriangle(X).multiply(this._getColor(u(X,F,E,G),D).a));R=R.add(c.inTriangle(U).multiply(this._getColor(u(U,F,E,G),D).a));R=R.add(c.inTriangle(N).multiply(this._getColor(u(N,F,E,G),D).a));R=R.add(c.inTriangle(B).multiply(this._getColor(u(B,F,E,G),D).a));return d.step(R,new d.Float(.05)).multiply(c.failHittest(this.hittestRequest))}}q.__decorate([n.option(k.VisualVariableColor)],C.prototype,"visualVariableColor",void 0);q.__decorate([n.option(e.VisualVariableOpacity)],C.prototype,
"visualVariableOpacity",void 0);q.__decorate([n.option(r.VisualVariableRotation)],C.prototype,"visualVariableRotation",void 0);q.__decorate([n.option(f.VisualVariableSizeMinMaxValue)],C.prototype,"visualVariableSizeMinMaxValue",void 0);q.__decorate([n.option(p.VisualVariableSizeScaleStops)],C.prototype,"visualVariableSizeScaleStops",void 0);q.__decorate([n.option(t.VisualVariableSizeStops)],C.prototype,"visualVariableSizeStops",void 0);q.__decorate([n.option(w.VisualVariableSizeUnitValue)],C.prototype,
"visualVariableSizeUnitValue",void 0);q.__decorate([n.uniform(a.MosaicInfo)],C.prototype,"mosaicInfo",void 0);q.__decorate([q.__param(0,n.input(A)),q.__param(1,n.input(v))],C.prototype,"vertex",null);q.__decorate([q.__param(0,n.input(x))],C.prototype,"fragment",null);l.MarkerFragmentInput=x;l.MarkerShader=C;l.MarkerVertexInput=A;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/pieChart/PieChartTechnique":function(){define("exports ../../../enums ../FeatureTechnique ../featureTechniqueUtils ../TechniqueType ./PieChartShader".split(" "),
function(l,q,n,d,m,h){class g extends n.FeatureTechnique{constructor(){super(...arguments);this.type=m.TechniqueType.PieChart;this.shaders={geometry:new h.PieChartShader};this.symbologyPlane=q.FeatureSymbologyDrawOrder.MARKER}render(c,a){const {painter:b}=c,{instance:k,target:e}=a,r=this.shaders.geometry,f=k.getInput(),p=f.uniforms.numberOfFields,t=d.isHittest(c),w=d.getFeatureUniforms(c,e),z=d.getSelectionDefines(c);r.setNumberOfFields(p);b.setShader({shader:r,uniforms:{...d.resolveDynamicUniforms(c,
a.target,f.uniforms.shader),...w.storage,...w.view,hittestUniforms:w.hittestRequest?{hittestDist:w.hittestRequest?.distance,hittestPos:w.hittestRequest?.position}:null},defines:{VV_SIZE_MIN_MAX_VALUE:!!f.uniforms.shader.visualVariableSizeMinMaxValue,VV_SIZE_SCALE_STOPS:!!f.uniforms.shader.visualVariableSizeScaleStops,VV_SIZE_FIELD_STOPS:!!f.uniforms.shader.visualVariableSizeStops,VV_SIZE_UNIT_VALUE:!!f.uniforms.shader.visualVariableSizeUnitValue,VV_OPACITY:!!f.uniforms.shader.visualVariableOpacity,
HITTEST:t,highlight:w.highlight?1:0,...z,numberOfFields:p},optionalAttributes:{},useComputeBuffer:t});b.setPipelineState(d.getFeaturePipelineState(c));b.submitDraw(c,a)}}l.PieChartTechnique=g;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/pieChart/PieChartShader":function(){define(["exports","../../GLSLShaderModule","../../graph/glsl","../../../shaders/sources/resolver"],function(l,q,n,d){const m={hittestDist:n.Float,hittestPos:n.Vec2},
h={filterFlags:n.Sampler2D,animation:n.Sampler2D,visualVariableData:n.Sampler2D,dataDriven0:n.Sampler2D,dataDriven1:n.Sampler2D,dataDriven2:n.Sampler2D,gpgpu:n.Sampler2D,size:n.Float},g={displayViewScreenMat3:n.Mat3,displayViewMat3:n.Mat3,displayMat3:n.Mat3,viewMat3:n.Mat3,tileMat3:n.Mat3,displayZoomFactor:n.Float,requiredZoomFactor:n.Float,tileOffset:n.Vec2,currentScale:n.Float,currentZoom:n.Float,metersPerSRUnit:n.Float};class c extends q.GLSLShaderModule{constructor(){super(...arguments);this.vertexShader=
d.resolveIncludes("materials/pie/pie.vert");this.fragmentShader=d.resolveIncludes("materials/pie/pie.frag");this.required={...h,...g,outlineWidth:n.Float,colors:n.FixedArray,defaultColor:n.Vec4,othersColor:n.Vec4,outlineColor:n.Vec4,donutRatio:n.Float,sectorThreshold:n.Float};this.options={hittestUniforms:m,visualVariableSizeMinMaxValue:{minMaxValueAndSize:n.Vec4},visualVariableSizeScaleStops:{sizes:{...n.FixedArray.ofType(n.Float,8),type:"array",elementType:n.Float,size:8},values:{...n.FixedArray.ofType(n.Float,
8),type:"array",elementType:n.Float,size:8}},visualVariableSizeStops:{sizes:{...n.FixedArray.ofType(n.Float,8),type:"array",elementType:n.Float,size:8},values:{...n.FixedArray.ofType(n.Float,8),type:"array",elementType:n.Float,size:8}},visualVariableSizeUnitValue:{unitValueToPixelsRatio:n.Float},visualVariableOpacity:{opacities:{...n.FixedArray.ofType(n.Float,8),type:"array",elementType:n.Float,size:8},opacityValues:{...n.FixedArray.ofType(n.Float,8),type:"array",elementType:n.Float,size:8}}};this.locations=
{pos:{index:0,type:n.Vec2},id:{index:1,type:n.Vec3},bitset:{index:2,type:n.Float},offset:{index:3,type:n.Vec2},texCoords:{index:4,type:n.Vec2},size:{index:5,type:n.Vec2},referenceSize:{index:6,type:n.Float},zoomRange:{index:7,type:n.Vec2}};this.defines={VV_SIZE_MIN_MAX_VALUE:"boolean",VV_SIZE_SCALE_STOPS:"boolean",VV_SIZE_FIELD_STOPS:"boolean",VV_SIZE_UNIT_VALUE:"boolean",VV_OPACITY:"boolean",HITTEST:"boolean",numberOfFields:"number",highlight:"boolean",inside:"boolean",outside:"boolean"}}setNumberOfFields(a){this.required.colors=
{...n.FixedArray.ofType(n.Vec4,a),type:"array",elementType:n.Vec4,size:a}}}l.PieChartShader=c;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/GLSLShaderModule":function(){define(["exports","../../../../../core/string","./typed/TypedShaderProgram"],function(l,q,n){class d{constructor(){this.computeAttributes={}}get locationsMap(){const m=new Map;for(const h in this.locations)m.set(h,this.locations[h].index);return m}get optionPropertyKeys(){this._optionPropertyKeys||
(this._optionPropertyKeys=new Set(Object.keys(this.options)));return this._optionPropertyKeys}get _transformFeedbackBindings(){return[]}get locationInfo(){if(!this._locationInfo){const m=this.locationsMap,h=Array.from(m.entries()).map(([g,c])=>`${g}.${c}`).join(".");this._locationInfo={hash:q.numericHash(h),locations:m,computeAttributeMap:this.computeAttributes}}return this._locationInfo}get renamedLocationsMap(){const m=new Map;for(const [h,g]of this.locationsMap.entries())m.set("a_"+h,g);return m}getShaderKey(m,
h,g){const c=Object.keys(m).map(b=>`${b}.${m[b]}`).join("."),a=Object.keys(g).filter(b=>g[b]).map(b=>`${b}_${g[b].toString()}`).join(".");h=Object.keys(h).filter(b=>this.optionPropertyKeys.has(b)).join(".");return`${c}.${a}.${h}`}getProgram(m,h,g,c){c=m="";for(const a in g)if(g[a]){const b="boolean"===typeof g[a]?`#define ${a}\n`:`#define ${a} ${g[a]}\n`;m+=b;c+=b}m+=this.vertexShader;c+=this.fragmentShader;return new n.TypedShaderProgram(m,c,this.renamedLocationsMap,this.locationInfo,this._getUniformBindings(h),
this._transformFeedbackBindings)}_getUniformBindings(m){const h=[];for(var g in this.required){var c=this.required[g];h.push({uniformHydrated:null,shaderModulePath:g,uniformName:g,uniformType:c.type,uniformArrayElementType:"array"===c.type?c.elementType?.type:void 0,uniformArrayLength:"array"===c.type?c.size:void 0})}for(const a in m)if(g=this.options[a],m[a])for(const b in g)c=g[b],h.push({uniformHydrated:null,shaderModulePath:`${a}.${b}`,uniformName:b,uniformType:c.type,uniformArrayElementType:"array"===
c.type?c.elementType?.type:void 0,uniformArrayLength:"array"===c.type?c.size:void 0});return h}}l.GLSLShaderModule=d;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/text/TextTechnique":function(){define("exports ../../../enums ../FeatureTechnique ../featureTechniqueUtils ../TechniqueType ./TextShader".split(" "),function(l,q,n,d,m,h){class g extends n.FeatureTechnique{constructor(){super(...arguments);this.type=m.TechniqueType.Text;
this.shaders={geometry:new h.TextShader};this.symbologyPlane=q.FeatureSymbologyDrawOrder.TEXT}render(c,a){const {context:b,painter:k}=c,e=d.getSelectionDefines(c);var r=a.instance.getInput();r={shader:this.shaders.geometry,uniforms:{...d.resolveDynamicUniforms(c,a.target,r.uniforms),...d.getFeatureUniforms(c,a.target),mosaicInfo:k.textureManager.getMosaicInfo(b,a.textureKey)},defines:{...e,isBackgroundPass:!0,isLabel:!1,textRenderPassType:h.TextRenderPassType.Color},optionalAttributes:r.optionalAttributes,
useComputeBuffer:d.isHittest(c)};k.setShader(r);k.setPipelineState(d.getFeaturePipelineState(c));k.submitDraw(c,a);k.setShader({...r,defines:{...e,isBackgroundPass:!1,isLabel:!1,textRenderPassType:h.TextRenderPassType.Halo}});k.submitDraw(c,a);k.setShader({...r,defines:{...e,isBackgroundPass:!1,isLabel:!1,textRenderPassType:h.TextRenderPassType.Outline}});k.submitDraw(c,a);k.setShader({...r,defines:{...e,isBackgroundPass:!1,isLabel:!1,textRenderPassType:h.TextRenderPassType.Color}});k.submitDraw(c,
a)}}l.TextTechnique=g;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/mesh/MeshWriterRegistry":function(){define("exports ../TechniqueType ../animated/AnimatedMarkerMeshWriter ../dotDensity/DotDensityMeshWriter ../fill/ComplexFillMeshWriter ../fill/ComplexOutlineFillMeshWriter ../fill/FillMeshWriter ../fill/OutlineFillMeshWriter ../fill/PatternFillMeshWriter ../fill/PatternOutlineFillMeshWriter ../heatmap/HeatmapMeshWriter ../labels/LabelMeshWriter ../line/LineMeshWriter ../line/TexturedLineMeshWriter ../markers/MarkerMeshWriter ./MeshWriterInputEvaluator ../pieChart/PieChartMeshWriter ../text/TextMeshWriter".split(" "),
function(l,q,n,d,m,h,g,c,a,b,k,e,r,f,p,t,w,z){class u{async createMeshWriter(y,A,v,x){const C=this._getMeshWriter(x.techniqueType);y=await t.MeshWriterInputEvaluator.create(y,A,x.inputParams);v=new C(x.id,y,x.optionalAttributes,v);await v.loadDependencies();return v}_getMeshWriter(y){switch(y){case q.TechniqueType.Fill:return g.FillMeshWriter;case q.TechniqueType.DotDensity:return d.DotDensityMeshWriter;case q.TechniqueType.ComplexFill:return m.ComplexFillMeshWriter;case q.TechniqueType.PatternFill:return a.PatternFillMeshWriter;
case q.TechniqueType.OutlineFill:return c.OutlineFillMeshWriter;case q.TechniqueType.PatternOutlineFill:return b.PatternOutlineFillMeshWriter;case q.TechniqueType.ComplexOutlineFill:return h.ComplexOutlineFillMeshWriter;case q.TechniqueType.Marker:return p.MarkerMeshWriter;case q.TechniqueType.PieChart:return w.PieChartMeshWriter;case q.TechniqueType.Text:return z.TextMeshWriter;case q.TechniqueType.Line:return r.LineMeshWriter;case q.TechniqueType.TexturedLine:return f.TexturedLineMeshWriter;case q.TechniqueType.Heatmap:return k.HeatmapMeshWriter;
case q.TechniqueType.Label:return e.LabelMeshWriter;case q.TechniqueType.AnimatedMarker:return n.AnimatedMarkerMeshWriter;default:throw Error("Internal Error: Mesh writer not in the registry");}}}l.MeshWriterRegistry=u;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/animated/AnimatedMarkerMeshWriter":function(){define("exports ../../../../../../../core/screenUtils ../../../definitions ./AnimatedMeshWriter ../fill/meshWriterUtils ../shaders/constants ../../../../../../webgl/enums".split(" "),
function(l,q,n,d,m,h,g){class c extends d.AAnimatedMeshWriter{get vertexSpec(){return{createComputedParams:a=>{let {pixelDimensions:b,texelDimensions:k,baseSize:e,referenceSize:r,strokeWidth:f,sizeRatio:p}=a;b||=a.sprite.sdf?[0,0]:[a.sprite.width,a.sprite.height];k||=a.sprite.sdf?[0,0]:b;e=q.pt2px(e);r=q.pt2px(r);f=q.pt2px(f);return{...a,pixelDimensions:b,texelDimensions:k,baseSize:e,referenceSize:r,strokeWidth:f,sdfDecodeCoeff:(a.sprite.sdfDecodeCoeff??1)*p}},optionalAttributes:{zoomRange:{type:g.DataType.SHORT,
count:2,packPrecisionFactor:n.minMaxZoomPrecisionFactor,pack:({scaleInfo:a},{tileInfo:b})=>m.getMinMaxZoom(a,b)}},attributes:{id:{type:g.DataType.UNSIGNED_BYTE,count:3,pack:"id"},bitset:{type:g.DataType.UNSIGNED_BYTE,count:1,pack:d.packAnimatedBitset},pos:{type:g.DataType.SHORT,count:2,pack:"position",packPrecisionFactor:1},offset:{type:g.DataType.FLOAT,count:2,packAlternating:{count:4,pack:a=>{a=a.texelDimensions;return[[-.5*a[0],-.5*a[1]],[.5*a[0],-.5*a[1]],[-.5*a[0],.5*a[1]],[.5*a[0],.5*a[1]]]}}},
uv:{type:g.DataType.SHORT,count:2,packPrecisionFactor:1,packAlternating:{count:4,packTessellation:({texXmax:a,texXmin:b,texYmax:k,texYmin:e})=>[[b,e],[a,e],[b,k],[a,k]]}},animationPointerAndBaseSizeAndReferenceSize:{type:g.DataType.UNSIGNED_SHORT,count:4,packPrecisionFactor:1,pack:({animations:a,baseSize:b,referenceSize:k})=>[a.dataColumn,a.dataRow,b,k]},sizing:{type:g.DataType.UNSIGNED_SHORT,count:4,packPrecisionFactor:8,pack:({strokeWidth:a,pixelDimensions:b,baseSize:k,sprite:e,sizeRatio:r})=>[b[0],
b[1],a,e.sdfDecodeCoeff*Math.max(k*e.width/e.height,k)*r]},angle:{type:g.DataType.BYTE,count:1,packTessellation:({angle:a})=>a}}}}_write(a,b){var {textureBinding:k}=this.evaluatedMeshParams.sprite;a.recordStart(this.instanceId,this.attributeLayout,k);const e=b.getDisplayId();if("esriGeometryPolygon"===b.geometryType){b=b.readCentroidForDisplay();if(!b)return;const [r,f]=b.coords;this._writeQuad(a,e,r,f)}else if("esriGeometryPoint"===b.geometryType)k=b.readXForDisplay(),b=b.readYForDisplay(),this._writeQuad(a,
e,k,b);else if(b=b.readGeometryForDisplay())if({angleToLine:k}=this.evaluatedMeshParams,k){let r=!0,f=null,p=null;b.forEachVertex((t,w)=>{if(null!=f&&null!=p){const z=Math.atan2(w-p,t-f)/h.c256ToRad;r&&(this._writeQuad(a,e,f,p,z),r=!1);this._writeQuad(a,e,t,w,z)}f=t;p=w})}else b.forEachVertex((r,f)=>{this._writeQuad(a,e,r,f)});a.recordEnd()}_writeQuad(a,b,k,e,r=0){var {rect:f}=this.evaluatedMeshParams.sprite,p=f.x+2;const t=f.y+2,w=f.x+f.width-2,z=f.y+f.height-2;f=a.vertexCount();a.recordBounds(k,
e,64,64);r={texXmin:p,texYmin:t,texXmax:w,texYmax:z,angle:r};for(p=0;4>p;p++)this._writeVertex(a,b,k,e,r);a.indexEnsureSize(6);a.indexWrite(f);a.indexWrite(f+1);a.indexWrite(f+2);a.indexWrite(f+1);a.indexWrite(f+3);a.indexWrite(f+2)}}l.AnimatedMarkerMeshWriter=c;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/animated/AnimatedMeshWriter":function(){define(["exports","../fill/meshWriterUtils","../markers/markerConstants","../mesh/MeshWriter"],
function(l,q,n,d){class m extends d.MeshWriter{}l.AAnimatedMeshWriter=m;l.packAnimatedBitset=function(h){const {sprite:g,isMapAligned:c,colorLocked:a,scaleSymbolsProportionally:b,isStroke:k}=h;h=0;c&&(h|=q.getBitMask(n.MarkerConstants.bitset.isMapAligned));a&&(h|=q.getBitMask(n.MarkerConstants.bitset.colorLocked));g.sdf&&(h|=q.getBitMask(n.MarkerConstants.bitset.isSDF));b&&(h|=q.getBitMask(n.MarkerConstants.bitset.scaleSymbolsProportionally));k&&(h|=q.getBitMask(n.MarkerConstants.bitset.isStroke));
return h};Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/fill/meshWriterUtils":function(){define(["exports","../../../../../../../Color","../../../../../../../core/Error","../../../../../../../core/Logger","../../../../../../../symbols/cim/enums"],function(l,q,n,d,m){l.getBitMask=function(h){return 1<<h};l.getMinMaxZoom=function(h,g){const c=!!h?.minScale&&g.scaleToZoom(h.minScale)||0;h=!!h?.maxScale&&g.scaleToZoom(h.maxScale)||100;
return[c,h]};l.packBitset=function(h){let g=0;for(const [c,a]of h)a&&(g|=1<<c);return g};l.packByteSqrt=function(h,g){return Math.round(Math.min(Math.sqrt(h*g),255))};l.packRounded=function(h,g){return Math.round(h*g)/g};l.processColorInput=function(h){if(!h)return[0,0,0,0];if("string"===typeof h){const k=q.fromString(h);if(!k)return d.getLogger("esri.views.2d.engine.webgl.shaderGraph.techniques.meshWriterUtils").errorOnce(new n("mapview:mesh-processing","Unable to parse string into color",{color:h})),
[0,0,0,0];h=k.toArray()}const [g,c,a,b]=h;return[b/255*g,b/255*c,b/255*a,b]};l.processLineCapInput=function(h){switch(h){case "butt":case m.LineCapStyle.Butt:return m.CapType.BUTT;case "round":case m.LineCapStyle.Round:return m.CapType.ROUND;case "square":case m.LineCapStyle.Square:return m.CapType.SQUARE}};l.processLineJoinInput=function(h){switch(h){case "bevel":case m.LineJoinStyle.Bevel:return m.JoinType.BEVEL;case "miter":case m.LineJoinStyle.Miter:return m.JoinType.MITER;case "round":case m.LineJoinStyle.Round:return m.JoinType.ROUND}};
Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/mesh/MeshWriter":function(){define(["exports","../../../../../../../geometry/GeometryCursor","../../../../../../../symbols/cim/effects/CIMEffectHelper","./loadGeometryEngine","./MeshWriterVertexPack"],function(l,q,n,d,m){class h{constructor(g,c,a,b){this._instanceId=g;this._evaluator=c;this._enabledOptionalAttributes=a;this._viewParams=b;this._evaluator.evaluator=k=>this.vertexSpec.createComputedParams(k)}get _vertexPack(){if(!this._cachedVertexPack){const g=
m.MeshWriterVertexPack.fromVertexSpec(this.vertexSpec,this._enabledOptionalAttributes);this._evaluator.hasDynamicProperties||g.pack(this._evaluator.evaluatedMeshParams,this._viewParams);this._cachedVertexPack=g}return this._cachedVertexPack}get evaluatedMeshParams(){return this._evaluator.evaluatedMeshParams}get hasEffects(){return!!this.evaluatedMeshParams.effects}get instanceId(){return this._instanceId}get attributeLayout(){return this._vertexPack.attributeLayout}setReferences(g){this._references=
g}getBoundsInfo(){return null}getTileInfo(){return this._viewParams.tileInfo}async loadDependencies(){var g;a:{if(g=this._evaluator.inputMeshParams.effects?.effectInfos)for(const c of g)switch(c.effect.type){case "CIMGeometricEffectBuffer":case "CIMGeometricEffectOffset":case "CIMGeometricEffectDonut":g=!0;break a}g=!1}g&&await d.loadGeometryEngine()}enqueueRequest(g,c,a){this._evaluator.hasDynamicProperties&&this._evaluator.enqueueRequest(g,c,a)}write(g,c,a,b,k){this.ensurePacked(c,a,b);if((c=this.evaluatedMeshParams.effects)&&
0!==c.length){if(b=a.readGeometryForDisplay()?.clone()){b=q.GeometryCursor.fromOptimizedCIM(b,a.geometryType);var e=d.getGeometryEngine();b.invertY();for(c=n.CIMEffectHelper.executeEffects(c,b,g.id||"",e);b=c.next();)b.invertY(),this._write(g,a,b,k)}}else this._write(g,a,void 0,k)}ensurePacked(g,c,a){this._evaluator.hasDynamicProperties&&(g=this._evaluator.evaluateMeshParams(g,c,a),this._vertexPack.pack(g,this._viewParams))}_writeVertex(g,c,a,b,k){this._vertexPack.writeVertex(g,c,a,b,this.evaluatedMeshParams,
k)}}l.MeshWriter=h;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/mesh/loadGeometryEngine":function(){define(["require","exports"],function(l,q){let n=null;q.getGeometryEngine=function(){return n};q.loadGeometryEngine=async function(){n=await new Promise((d,m)=>l(["../../../../../../../geometry/geometryEngineJSON"],d,m))};Object.defineProperty(q,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/mesh/MeshWriterVertexPack":function(){define(["exports",
"../../../number","./AlignedVertexSpec","./dataViewUtils"],function(l,q,n,d){class m{static fromVertexSpec(h,g){h=n.AlignedVertexSpec.fromVertexSpec(h,g);return new m(h)}constructor(h){this._spec=h;this._packed=new Uint8Array(this._spec.stride*this._spec.packVertexCount);this._packedU32View=new Uint32Array(this._packed.buffer);this._dataView=new DataView(this._packed.buffer)}get attributeLayout(){return this._spec.attributeLayout}get stride(){return this._spec.stride}writeVertex(h,g,c,a,b,k){for(let f=
0;f<this._spec.packVertexCount;f++){const p=f*this._spec.stride;this._packPosition(c,a,p);this._packId(g,p);var e=this._spec.bitset;if(k){if(e.packTessellation){var r=e.packTessellation(k,b);this._pack(r,e,p)}for(const t of this._spec.standardAttributes)if(null!=t.packTessellation)e=t.packTessellation(k,b),this._pack(e,t,p);else if(t.packAlternating?.packTessellation)for(e=t.packAlternating.packTessellation(k,b),r=0;r<this._spec.packVertexCount;r++)this._pack(e[r],t,r*this._spec.stride)}}h.vertexWriteRegion(this._packedU32View)}pack(h,
g){for(const b of this._spec.standardAttributes)if(b.pack&&"string"!==typeof b.pack){var c=b.pack(h,g);for(var a=0;a<this._spec.packVertexCount;a++)this._pack(c,b,a*this._spec.stride)}else if(b.packAlternating?.pack)for(c=b.packAlternating.pack(h,g),a=0;a<this._spec.packVertexCount;a++)this._pack(c[a],b,a*this._spec.stride)}_packPosition(h,g,c){const {offset:a}=this._spec.position,b=this._spec.position.packPrecisionFactor??1;h=q.i1616to32(h*b,g*b);this._dataView.setUint32(c+a,h,!0)}_packId(h,g){h*=
this._spec.id.packPrecisionFactor??1;const c=this._dataView.getUint32(g+this._spec.id.offset,!0)&4278190080;this._dataView.setUint32(g+this._spec.id.offset,h|c,!0)}_pack(h,g,c){d.packDataView(this._dataView,h,g,c)}}l.MeshWriterVertexPack=m;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/mesh/AlignedVertexSpec":function(){define(["exports","../../../../../../../core/has","./utils","../../../../../../webgl/enums"],function(l,q,n,d){function m(c){switch(c){case d.DataType.BYTE:case d.DataType.UNSIGNED_BYTE:return 1;
case d.DataType.SHORT:case d.DataType.UNSIGNED_SHORT:case d.DataType.HALF_FLOAT:return 2;case d.DataType.FLOAT:case d.DataType.INT:case d.DataType.UNSIGNED_INT:return 4}}function h(c){const a=[],b=[],k=[];for(const e of c)switch(c=m(e.type)*e.count,c%2||c%4||4){case 4:a.push(e);continue;case 2:b.push(e);continue;case 1:k.push(e);continue;default:throw Error("Found unexpected dataType byte count");}a.push(...b);a.push(...k);return a}class g{static fromVertexSpec(c,a){const {attributes:b,optionalAttributes:k}=
c;let e,r,f;c=[];for(var p in b){const z=b[p];"position"===z.pack?e={...z,name:p,offset:0}:"id"===z.pack?r={...z,name:p,offset:4}:"bitset"===p?f={...z,name:p,offset:7}:c.push({...z,name:p})}for(var t in k)!0===a[t]&&c.push({...k[t],name:t});c=h(c);a=[];p=8;t=1;for(var w of c)a.push({...w,offset:p}),p+=m(w.type)*w.count,w.packAlternating&&(t=Math.max(w.packAlternating.count,t));w=Uint32Array.BYTES_PER_ELEMENT;c=p%w;return new g(e,r,f,a,p+(c?w-c:0),t)}constructor(c,a,b,k,e,r){this.position=c;this.id=
a;this.bitset=b;this.standardAttributes=k;this.stride=e;this.packVertexCount=r;k.push(b);this._attributes=[c,a,b,...k]}get attributeLayout(){if(!this._attributeLayout){const c=n.vertexLayoutHash(this._attributes);this._attributeLayout={attributes:this._attributes.map(a=>({name:a.name,count:a.count,offset:a.offset,type:a.type,packPrecisionFactor:a.packPrecisionFactor,normalized:a.normalized??!1})),hash:c,stride:this.stride}}return this._attributeLayout}}l.AlignedVertexSpec=g;l.sortByAlignment=h;Object.defineProperty(l,
Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/dotDensity/DotDensityMeshWriter":function(){define(["exports","../fill/AFillMeshWriter","../../../../../../webgl/enums"],function(l,q,n){const d={createComputedParams:h=>h,optionalAttributes:{},attributes:{id:{type:n.DataType.UNSIGNED_BYTE,count:3,pack:"id"},bitset:{type:n.DataType.UNSIGNED_BYTE,count:1},pos:{type:n.DataType.SHORT,count:2,pack:"position",packPrecisionFactor:10},inverseArea:{type:n.DataType.FLOAT,
count:1,packTessellation:({inverseArea:h})=>h}}};class m extends q.AFillMeshWriter{constructor(){super(...arguments);this.vertexSpec=d}createTesselationParams(h){return{inverseArea:1/h.readGeometryArea()}}}l.DotDensityMeshWriter=m;l.dotDensityVertexSpec=d;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/fill/AFillMeshWriter":function(){define(["exports","../../../../../../../core/has","../../../../../../../geometry/libtess","../../../mesh/templates/templateUtils",
"../mesh/MeshWriter"],function(l,q,n,d,m){const h=q("featurelayer-fast-triangulation-enabled");class g extends m.MeshWriter{async loadDependencies(){await Promise.all([super.loadDependencies(),n.loadLibtess()])}_write(c,a,b){b=b?.asOptimized()??a.readGeometryForDisplay();if(b=this._clip(b))c.recordStart(this.instanceId,this.attributeLayout),this._writeGeometry(c,a,b),c.recordEnd()}_clip(c){return c?d.clipMarshall(c,this.hasEffects?256:8):null}_writeGeometry(c,a,b){const k=100<b.maxLength,e=[],r=this.createTesselationParams(a);
!k&&h&&d.triangulate(e,b)?e.length&&this._writeVertices(c,a,b.coords,r,e):(b=d.triangulateLibtess(b),this._writeVertices(c,a,b,r))}_writeVertices(c,a,b,k,e){const r=a.getDisplayId();a=c.vertexCount();const f=this.hasEffects;let p=0;if(e)for(var t of e){e=b[2*t];var w=b[2*t+1];f&&c.recordBounds(e,w,0,0);this._writeVertex(c,r,e,w,k);p++}else for(t=0;t<b.length;t+=2)e=Math.round(b[t]),w=Math.round(b[t+1]),f&&c.recordBounds(e,w,0,0),this._writeVertex(c,r,e,w,k),p++;c.indexEnsureSize(p);for(b=0;b<p;b++)c.indexWrite(b+
a)}}l.AFillMeshWriter=g;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/libtess":function(){define(["require","exports","../assets","../core/has"],function(l,q,n,d){async function m(){g=await (d("esri-csp-restrictions")?await (new Promise((c,a)=>l(["../chunks/libtess-asm"],c,a))).then(c=>c.libtessAsm):await (new Promise((c,a)=>l(["../chunks/libtess"],c,a))).then(c=>c.libtess)).default({locateFile:c=>n.getAssetUrl(`esri/core/libs/libtess/${c}`)})}let h=null,g=null;q.loadLibtess=
async function(){h||=m();return h};q.triangulate=function(c,a){return g.triangulate(c,a,Math.max(c.length,128E3))};Object.defineProperty(q,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/mesh/templates/templateUtils":function(){define("exports ../../../../../../chunks/earcut ../../../../../../geometry/libtess ../../../../../../geometry/support/TileClipper ../../../../../../layers/graphics/OptimizedGeometry ../../definitions ../bufcut".split(" "),function(l,q,n,d,m,h,g){function c(e,
r,f){let p=0;for(let t=1;t<f;t++)p+=(e[2*(r+t)]-e[2*(r+t-1)])*(e[2*(r+t)+1]+e[2*(r+t-1)+1]);return p}function a(e,r,f,p,t){let w=0;for(;f<p;f+=3){const z=2*(e[f]-t),u=2*(e[f+1]-t),y=2*(e[f+2]-t);w+=Math.abs((r[z]-r[y])*(r[u+1]-r[z+1])-(r[z]-r[u])*(r[y+1]-r[z+1]))}return w}const b=new d.TileClipper(0,0,0,1,0),k=new d.TileClipper(0,0,0,1,0);b.setExtent(h.tileSize);k.setExtent(h.tileSize);l.area=c;l.clipLinesMarshall=function(e,r){k.setPixelMargin(r);const f=-r;r=h.tileSize+r;let p=[];var t=!1;if(!e.nextPath())return null;
let w=!0;for(;w;){e.seekPathStart();const z=[];if(!e.pathSize)return null;k.reset(d.GeometryType.LineString);e.nextPoint();let u=e.x,y=e.y;if(t)k.moveTo(u,y);else{if(u<f||u>r||y<f||y>r){t=!0;continue}z.push({x:u,y})}let A=!1;for(;e.nextPoint();)if(u=e.x,y=e.y,t)k.lineTo(u,y);else{if(u<f||u>r||y<f||y>r){A=!0;break}z.push({x:u,y})}if(A)t=!0;else{if(t){if(t=k.resultWithStarts())for(const v of t)p.push(v)}else p.push({line:z,start:0});w=e.nextPath();t=!1}}p=p.filter(z=>1<z.line.length);return 0===p.length?
null:p};l.clipMarshall=function(e,r){if(null==e)return null;a:{var f=h.tileSize+128;var p=0;for(var t=0;t<e.lengths.length;t++){var w=e.lengths[t];for(var z=0;z<w;z++){const u=e.coords[2*(z+p)],y=e.coords[2*(z+p)+1];if(-128>u||u>f||-128>y||y>f){f=!0;break a}}p+=w}f=!1}if(!f)return e;b.setPixelMargin(r);b.reset(d.GeometryType.Polygon);r=0;for(f=0;f<e.lengths.length;f++){p=e.lengths[f];t=e.coords[2*(0+r)];w=e.coords[2*(0+r)+1];b.moveTo(t,w);for(z=1;z<p;z++)t=e.coords[2*(z+r)],w=e.coords[2*(z+r)+1],
b.lineTo(t,w);b.close();r+=p}f=b.result(!1);if(!f)return null;e=[];r=[];for(const u of f){f=0;for(const y of u)r.push(y.x),r.push(y.y),f++;e.push(f)}return new m(e,r)};l.triangleAreaArray=a;l.triangulate=function(e,r){const {coords:f,lengths:p}=r;r=0;for(var t=0;t<p.length;){let u=t,y=p[t];t=c(f,r,y);for(var w=[];++u<p.length;){var z=p[u];const A=c(f,r+y,z);if(!(0<A))break;t+=A;w.push(r+y);y+=z}z=e.length;g.bufcut(e,f,r,r+y,w,2,0);w=a(e,f,z,e.length,0);t=Math.abs(t);if(1E-5<Math.abs((w-t)/Math.max(1E-7,
t)))return e.length=0,!1;t=u;r+=y}return!0};l.triangulateEarcut=function(e,r,f){const {coords:p,lengths:t}=r;let w=0;for(var z=0;z<t.length;){let y=z,A=t[z];for(z=[];++y<t.length;){var u=t[y];if(!(0<c(p,w+A,u)))break;z.push(w+A-w);A+=u}u=r.coords.slice(2*w,2*(w+A));z=q.earcut(u,z,2);for(const v of z)e.push(v+f+w);z=y;w+=A}return!0};l.triangulateLibtess=function(e){const {coords:r,lengths:f}=e;({buffer:e}=n.triangulate(r,f));return e};Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},
"esri/chunks/earcut":function(){define(["exports"],function(l){function q(x,C,B){B=B||2;var E=C&&C.length,D=E?C[0]*B:x.length,F=n(x,0,D,B,!0),G=[];if(!F||F.next===F.prev)return G;var H;if(E){var I=F;var K=B;F=[];var L;E=0;for(L=C.length;E<L;E++){var R=C[E]*K;var S=E<L-1?C[E+1]*K:x.length;R=n(x,R,S,K,!1);R===R.next&&(R.steiner=!0);S=F;var W=S.push,J=R,O=R;do{if(J.x<O.x||J.x===O.x&&J.y<O.y)O=J;J=J.next}while(J!==R);W.call(S,O)}F.sort(g);for(E=0;E<F.length;E++)K=F[E],C=I,(I=a(K,C))?(L=z(I,K),K=d(I,I.next),
L=c(L),d(L,L.next),K=c(K),I=c(C===I?K:C)):I=C,I=d(I,I.next);F=I}if(x.length>80*B){var T=H=x[0];var X=E=x[1];for(K=B;K<D;K+=B)C=x[K],I=x[K+1],C<T&&(T=C),I<X&&(X=I),C>H&&(H=C),I>E&&(E=I);H=Math.max(H-T,E-X);H=0!==H?1/H:0}m(F,G,B,T,X,H);return G}function n(x,C,B,E,D){if(D===0<v(x,C,B,E))for(D=C;D<B;D+=E)var F=u(D,x[D],x[D+1],F);else for(D=B-E;D>=C;D-=E)F=u(D,x[D],x[D+1],F);F&&r(F,F.next)&&(x=F.next,y(F),F=x);return F}function d(x,C){if(!x)return x;C||=x;do{var B=!1;if(x.steiner||!r(x,x.next)&&0!==e(x.prev,
x,x.next))x=x.next;else{C=x.prev;y(x);x=C;if(x===x.next)break;B=!0}}while(B||x!==C);return C}function m(x,C,B,E,D,F,G){if(x){if(!G&&F){var H=x,I=H;do null===I.z&&(I.z=b(I.x,I.y,E,D,F)),I.prevZ=I.prev,I=I.nextZ=I.next;while(I!==H);I.prevZ.nextZ=null;I.prevZ=null;H=I;var K,L,R,S,W=1;do{I=H;var J=H=null;for(L=0;I;){L++;var O=I;for(K=R=0;K<W&&(R++,O=O.nextZ,O);K++);for(S=W;0<R||0<S&&O;)0!==R&&(0===S||!O||I.z<=O.z)?(K=I,I=I.nextZ,R--):(K=O,O=O.nextZ,S--),J?J.nextZ=K:H=K,K.prevZ=J,J=K;I=O}J.nextZ=null;
W*=2}while(1<L)}for(H=x;x.prev!==x.next;){I=x.prev;O=x.next;if(F)J=h(x,E,D,F);else a:if(J=x,L=J.prev,R=J,W=J.next,0<=e(L,R,W))J=!1;else{for(K=J.next.next;K!==J.prev;){if(k(L.x,L.y,R.x,R.y,W.x,W.y,K.x,K.y)&&0<=e(K.prev,K,K.next)){J=!1;break a}K=K.next}J=!0}if(J)C.push(I.i/B),C.push(x.i/B),C.push(O.i/B),y(x),H=x=O.next;else if(x=O,x===H){if(!G)m(d(x),C,B,E,D,F,1);else if(1===G){x=d(x);G=C;H=B;I=x;do O=I.prev,J=I.next.next,!r(O,J)&&f(O,I,I.next,J)&&w(O,J)&&w(J,O)&&(G.push(O.i/H),G.push(I.i/H),G.push(J.i/
H),y(I),y(I.next),I=x=J),I=I.next;while(I!==x);x=d(I);m(x,C,B,E,D,F,2)}else if(2===G)a:{G=x;do{for(H=G.next.next;H!==G.prev;){if(I=G.i!==H.i){J=J=J=J=void 0;I=G;O=H;if(J=I.next.i!==O.i&&I.prev.i!==O.i){b:{J=I;do{if(J.i!==I.i&&J.next.i!==I.i&&J.i!==O.i&&J.next.i!==O.i&&f(J,J.next,I,O)){J=!0;break b}J=J.next}while(J!==I);J=!1}J=!J}if(J){if(J=w(I,O)&&w(O,I)){J=I;L=!1;R=(I.x+O.x)/2;W=(I.y+O.y)/2;do J.y>W!==J.next.y>W&&J.next.y!==J.y&&R<(J.next.x-J.x)*(W-J.y)/(J.next.y-J.y)+J.x&&(L=!L),J=J.next;while(J!==
I);J=L}J=J&&(e(I.prev,I,O.prev)||e(I,O.prev,O))||r(I,O)&&0<e(I.prev,I,I.next)&&0<e(O.prev,O,O.next)}I=J}if(I){x=z(G,H);G=d(G,G.next);x=d(x,x.next);m(G,C,B,E,D,F);m(x,C,B,E,D,F);break a}H=H.next}G=G.next}while(G!==x)}break}}}}function h(x,C,B,E){var D=x.prev,F=x.next;if(0<=e(D,x,F))return!1;var G=D.x>x.x?D.x>F.x?D.x:F.x:x.x>F.x?x.x:F.x,H=D.y>x.y?D.y>F.y?D.y:F.y:x.y>F.y?x.y:F.y,I=b(D.x<x.x?D.x<F.x?D.x:F.x:x.x<F.x?x.x:F.x,D.y<x.y?D.y<F.y?D.y:F.y:x.y<F.y?x.y:F.y,C,B,E);C=b(G,H,C,B,E);B=x.prevZ;for(E=
x.nextZ;B&&B.z>=I&&E&&E.z<=C;){if(B!==x.prev&&B!==x.next&&k(D.x,D.y,x.x,x.y,F.x,F.y,B.x,B.y)&&0<=e(B.prev,B,B.next))return!1;B=B.prevZ;if(E!==x.prev&&E!==x.next&&k(D.x,D.y,x.x,x.y,F.x,F.y,E.x,E.y)&&0<=e(E.prev,E,E.next))return!1;E=E.nextZ}for(;B&&B.z>=I;){if(B!==x.prev&&B!==x.next&&k(D.x,D.y,x.x,x.y,F.x,F.y,B.x,B.y)&&0<=e(B.prev,B,B.next))return!1;B=B.prevZ}for(;E&&E.z<=C;){if(E!==x.prev&&E!==x.next&&k(D.x,D.y,x.x,x.y,F.x,F.y,E.x,E.y)&&0<=e(E.prev,E,E.next))return!1;E=E.nextZ}return!0}function g(x,
C){return x.x-C.x}function c(x){if(x.next.prev===x)return x;let C=x;do{const B=C.next;if(B.prev===C||B===C||B===x)break;C=B}while(1);return C}function a(x,C){var B=C,E=x.x,D=x.y,F=-Infinity;do{if(D<=B.y&&D>=B.next.y&&B.next.y!==B.y){var G=B.x+(D-B.y)*(B.next.x-B.x)/(B.next.y-B.y);if(G<=E&&G>F){F=G;if(G===E){if(D===B.y)return B;if(D===B.next.y)return B.next}var H=B.x<B.next.x?B:B.next}}B=B.next}while(B!==C);if(!H)return null;if(E===F)return H;C=H;G=H.x;var I=H.y,K=Infinity;B=H;do{if(E>=B.x&&B.x>=G&&
E!==B.x&&k(D<I?E:F,D,G,I,D<I?F:E,D,B.x,B.y)){var L=Math.abs(D-B.y)/(E-B.x);var R;if((R=w(B,x))&&!(R=L<K)&&(R=L===K)&&!(R=B.x>H.x)&&(R=B.x===H.x)){R=H;var S=B;R=0>e(R.prev,R,S.prev)&&0>e(S.next,R,R.next)}R&&(H=B,K=L)}B=B.next}while(B!==C);return H}function b(x,C,B,E,D){x=32767*(x-B)*D;C=32767*(C-E)*D;x=(x|x<<8)&16711935;x=(x|x<<4)&252645135;x=(x|x<<2)&858993459;C=(C|C<<8)&16711935;C=(C|C<<4)&252645135;C=(C|C<<2)&858993459;return(x|x<<1)&1431655765|((C|C<<1)&1431655765)<<1}function k(x,C,B,E,D,F,G,
H){return 0<=(D-G)*(C-H)-(x-G)*(F-H)&&0<=(x-G)*(E-H)-(B-G)*(C-H)&&0<=(B-G)*(F-H)-(D-G)*(E-H)}function e(x,C,B){return(C.y-x.y)*(B.x-C.x)-(C.x-x.x)*(B.y-C.y)}function r(x,C){return x.x===C.x&&x.y===C.y}function f(x,C,B,E){var D=t(e(x,C,B)),F=t(e(x,C,E)),G=t(e(B,E,x)),H=t(e(B,E,C));return D!==F&&G!==H||0===D&&p(x,B,C)||0===F&&p(x,E,C)||0===G&&p(B,x,E)||0===H&&p(B,C,E)?!0:!1}function p(x,C,B){return C.x<=Math.max(x.x,B.x)&&C.x>=Math.min(x.x,B.x)&&C.y<=Math.max(x.y,B.y)&&C.y>=Math.min(x.y,B.y)}function t(x){return 0<
x?1:0>x?-1:0}function w(x,C){return 0>e(x.prev,x,x.next)?0<=e(x,C,x.next)&&0<=e(x,x.prev,C):0>e(x,C,x.prev)||0>e(x,x.next,C)}function z(x,C){var B=new A(x.i,x.x,x.y),E=new A(C.i,C.x,C.y),D=x.next,F=C.prev;x.next=C;C.prev=x;B.next=D;D.prev=B;E.next=B;B.prev=E;F.next=E;E.prev=F;return E}function u(x,C,B,E){x=new A(x,C,B);E?(x.next=E.next,x.prev=E,E.next.prev=x,E.next=x):(x.prev=x,x.next=x);return x}function y(x){x.next.prev=x.prev;x.prev.next=x.next;x.prevZ&&(x.prevZ.nextZ=x.nextZ);x.nextZ&&(x.nextZ.prevZ=
x.prevZ)}function A(x,C,B){this.i=x;this.x=C;this.y=B;this.nextZ=this.prevZ=this.z=this.next=this.prev=null;this.steiner=!1}function v(x,C,B,E){for(var D=0,F=B-E;C<B;C+=E)D+=(x[F]-x[C])*(x[C+1]+x[F+1]),F=C;return D}q.deviation=function(x,C,B,E){var D=C&&C.length,F=Math.abs(v(x,0,D?C[0]*B:x.length,B));if(D){D=0;for(var G=C.length;D<G;D++)F-=Math.abs(v(x,C[D]*B,D<G-1?C[D+1]*B:x.length,B))}for(D=C=0;D<E.length;D+=3){G=E[D]*B;var H=E[D+1]*B,I=E[D+2]*B;C+=Math.abs((x[G]-x[I])*(x[H+1]-x[G+1])-(x[G]-x[H])*
(x[I+1]-x[G+1]))}return 0===F&&0===C?0:Math.abs((C-F)/F)};q.flatten=function(x){for(var C=x[0][0].length,B={vertices:[],holes:[],dimensions:C},E=0,D=0;D<x.length;D++){for(var F=0;F<x[D].length;F++)for(var G=0;G<C;G++)B.vertices.push(x[D][F][G]);0<D&&(E+=x[D-1].length,B.holes.push(E))}return B};l.earcut=q})},"esri/views/2d/engine/webgl/mesh/bufcut":function(){define(["exports","../../../../../core/has"],function(l,q){function n(v,x,C,B,E,D,F){let G;C=0;for(let H=B,I=E-D;H<E;H+=D)C+=(v[I+x*D]-v[H+x*
D])*(v[H+1+x*D]+v[I+1+x*D]),I=H;if(F===0<C)for(;B<E;B+=D)G=g(B+x*D,v[B+x*D],v[B+1+x*D],G);else for(E-=D;E>=B;E-=D)G=g(E+x*D,v[E+x*D],v[E+1+x*D],G);G&&t(G,G.next)&&(c(G),G=G.next);return G}function d(v,x=v){if(!v)return v;let C;do if(C=!1,v.steiner||!t(v,v.next)&&0!==k(v.prev,v,v.next))v=v.next;else{c(v);v=x=v.prev;if(v===v.next)break;C=!0}while(C||v!==x);return x}function m(v,x,C,B,E,D,F,G){if(v){!G&&D&&(v=b(v,B,E,D));for(var H=v;v.prev!==v.next;){var I=v.prev,K=v.next;if(D)var L=h(v,B,E,D);else a:{L=
v;var R=L.prev,S=L;const W=L.next;if(0<=k(R,S,W)){L=!1;break a}let J=L.next.next;const O=J;let T=0;for(;J!==L.prev&&(0===T||J!==O);){T++;if(r(R.x,R.y,S.x,S.y,W.x,W.y,J.x,J.y)&&0<=k(J.prev,J,J.next)){L=!1;break a}J=J.next}L=!0}if(L)x.push(I.index/C+F),x.push(v.index/C+F),x.push(K.index/C+F),c(v),H=v=K.next;else if(v=K,v===H){if(!G)m(d(v),x,C,B,E,D,F,1);else if(1===G){G=x;H=C;I=F;K=v;do L=K.prev,R=K.next.next,!t(L,R)&&e(L,K,K.next,R)&&f(L,R)&&f(R,L)&&(G.push(L.index/H+I),G.push(K.index/H+I),G.push(R.index/
H+I),c(K),c(K.next),K=v=R),K=K.next;while(K!==v);v=K;m(v,x,C,B,E,D,F,2)}else if(2===G)a:{G=v;do{for(H=G.next.next;H!==G.prev;){if(I=G.index!==H.index){L=L=L=void 0;I=G;K=H;if(L=I.next.index!==K.index&&I.prev.index!==K.index){b:{L=I;do{if(L.index!==I.index&&L.next.index!==I.index&&L.index!==K.index&&L.next.index!==K.index&&e(L,L.next,I,K)){L=!0;break b}L=L.next}while(L!==I);L=!1}L=!L}if(L=L&&f(I,K)&&f(K,I)){L=I;R=!1;S=(I.x+K.x)/2;K=(I.y+K.y)/2;do L.y>K!==L.next.y>K&&L.next.y!==L.y&&S<(L.next.x-L.x)*
(K-L.y)/(L.next.y-L.y)+L.x&&(R=!R),L=L.next;while(L!==I);L=R}I=L}if(I){v=z(G,H);G=d(G,G.next);v=d(v,v.next);m(G,x,C,B,E,D,F,0);m(v,x,C,B,E,D,F,0);break a}H=H.next}G=G.next}while(G!==v)}break}}}}function h(v,x,C,B){const E=v.prev,D=v.next;if(0<=k(E,v,D))return!1;const F=E.x>v.x?E.x>D.x?E.x:D.x:v.x>D.x?v.x:D.x,G=E.y>v.y?E.y>D.y?E.y:D.y:v.y>D.y?v.y:D.y,H=p(E.x<v.x?E.x<D.x?E.x:D.x:v.x<D.x?v.x:D.x,E.y<v.y?E.y<D.y?E.y:D.y:v.y<D.y?v.y:D.y,x,C,B);x=p(F,G,x,C,B);C=v.prevZ;for(B=v.nextZ;C&&C.z>=H&&B&&B.z<=
x;){if(C!==v.prev&&C!==v.next&&r(E.x,E.y,v.x,v.y,D.x,D.y,C.x,C.y)&&0<=k(C.prev,C,C.next))return!1;C=C.prevZ;if(B!==v.prev&&B!==v.next&&r(E.x,E.y,v.x,v.y,D.x,D.y,B.x,B.y)&&0<=k(B.prev,B,B.next))return!1;B=B.nextZ}for(;C&&C.z>=H;){if(C!==v.prev&&C!==v.next&&r(E.x,E.y,v.x,v.y,D.x,D.y,C.x,C.y)&&0<=k(C.prev,C,C.next))return!1;C=C.prevZ}for(;B&&B.z<=x;){if(B!==v.prev&&B!==v.next&&r(E.x,E.y,v.x,v.y,D.x,D.y,B.x,B.y)&&0<=k(B.prev,B,B.next))return!1;B=B.nextZ}return!0}function g(v,x,C,B){v=u.create(v,x,C);
B?(v.next=B.next,v.prev=B,B.next.prev=v,B.next=v):(v.prev=v,v.next=v);return v}function c(v){v.next.prev=v.prev;v.prev.next=v.next;v.prevZ&&(v.prevZ.nextZ=v.nextZ);v.nextZ&&(v.nextZ.prevZ=v.prevZ)}function a(v,x){let C=x;const B=v.x,E=v.y;let D=-Infinity,F;do{if(E<=C.y&&E>=C.next.y&&C.next.y!==C.y){var G=C.x+(E-C.y)*(C.next.x-C.x)/(C.next.y-C.y);if(G<=B&&G>D){D=G;if(G===B){if(E===C.y)return C;if(E===C.next.y)return C.next}F=C.x<C.next.x?C:C.next}}C=C.next}while(C!==x);if(!F)return null;if(B===D)return F.prev;
x=F;G=F.x;const H=F.y;let I=Infinity,K;for(C=F.next;C!==x;)B>=C.x&&C.x>=G&&B!==C.x&&r(E<H?B:D,E,G,H,E<H?D:B,E,C.x,C.y)&&(K=Math.abs(E-C.y)/(B-C.x),(K<I||K===I&&C.x>F.x)&&f(C,v)&&(F=C,I=K)),C=C.next;return F}function b(v,x,C,B){for(var E;E!==v;E=E.next){E=E||v;null===E.z&&(E.z=p(E.x,E.y,x,C,B));if(E.prev.next!==E||E.next.prev!==E)return E.prev.next=E,E.next.prev=E,b(v,x,C,B);E.prevZ=E.prev;E.nextZ=E.next}v.prevZ.nextZ=null;v.prevZ=null;a:for(C=1;;){B=v;x=v=null;let D=0;for(;B;){D++;E=B;let F=0;for(;F<
C&&E;F++)E=E.nextZ;let G=C;for(;0<F||0<G&&E;){let H;0===F?(H=E,E=E.nextZ,G--):0!==G&&E?B.z<=E.z?(H=B,B=B.nextZ,F--):(H=E,E=E.nextZ,G--):(H=B,B=B.nextZ,F--);x?x.nextZ=H:v=H;H.prevZ=x;x=H}B=E}x.nextZ=null;C*=2;if(2>D)break a}return v}function k(v,x,C){return(x.y-v.y)*(C.x-x.x)-(x.x-v.x)*(C.y-x.y)}function e(v,x,C,B){return t(v,x)&&t(C,B)||t(v,B)&&t(C,x)?!0:0<k(v,x,C)!==0<k(v,x,B)&&0<k(C,B,v)!==0<k(C,B,x)}function r(v,x,C,B,E,D,F,G){return 0<=(E-F)*(x-G)-(v-F)*(D-G)&&0<=(v-F)*(B-G)-(C-F)*(x-G)&&0<=(C-
F)*(D-G)-(E-F)*(B-G)}function f(v,x){return 0>k(v.prev,v,v.next)?0<=k(v,x,v.next)&&0<=k(v,v.prev,x):0>k(v,x,v.prev)||0>k(v,v.next,x)}function p(v,x,C,B,E){v=32767*(v-C)*E;x=32767*(x-B)*E;v=(v|v<<8)&16711935;v=(v|v<<4)&252645135;v=(v|v<<2)&858993459;x=(x|x<<8)&16711935;x=(x|x<<4)&252645135;x=(x|x<<2)&858993459;return(v|v<<1)&1431655765|((x|x<<1)&1431655765)<<1}function t(v,x){return v.x===x.x&&v.y===x.y}function w(v,x){return v.x-x.x}function z(v,x){const C=u.create(v.index,v.x,v.y),B=u.create(x.index,
x.x,x.y),E=v.next,D=x.prev;v.next=x;x.prev=v;C.next=E;E.prev=C;B.next=C;C.prev=B;D.next=B;B.prev=D;return B}class u{constructor(){this.y=this.x=this.index=0;this.nextZ=this.prevZ=this.z=this.next=this.prev=null;this.steiner=!1}static create(v,x,C){const B=A<y.length?y[A++]:new u;B.index=v;B.x=x;B.y=C;B.prev=null;B.next=null;B.z=null;B.prevZ=null;B.nextZ=null;B.steiner=!1;return B}}const y=[];let A=0;for(q=0;8096>q;q++)y.push(new u);l.bufcut=function(v,x,C,B,E,D,F){A=0;var G=(B-C)*D,H=E&&E.length;
const I=H?(E[0]-C)*D:G;var K=n(x,C,B,0,I,D,!0);if(K&&K.next!==K.prev){var L;if(H){const O=[];for(let T=0,X=E.length;T<X;T++){const U=n(x,C,B,E[T]*D,T<X-1?E[T+1]*D:B*D,D,!1);U===U.next&&(U.steiner=!0);H=O;var R=H.push;let N=U,Q=U;do{if(N.x<Q.x||N.x===Q.x&&N.y<Q.y)Q=N;N=N.next}while(N!==U);R.call(H,Q)}O.sort(w);for(var S of O)if(B=S,E=a(B,K))B=z(E,B),d(B,B.next),K=d(E,E.next)}if(G>80*D){var W=G=x[C*D];var J=L=x[1+C*D];for(S=D;S<I;S+=D)B=x[S+C*D],E=x[S+1+C*D],W=Math.min(W,B),J=Math.min(J,E),G=Math.max(G,
B),L=Math.max(L,E);L=Math.max(G-W,L-J);L=0!==L?1/L:0}m(K,v,D,W,J,L,F,0)}};Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/fill/ComplexFillMeshWriter":function(){define("exports ../../../../../../../core/screenUtils ../../../../vectorTiles/GeometryUtils ./meshWriterUtils ./PatternFillMeshWriter ../shaders/constants ../../../../../../webgl/enums".split(" "),function(l,q,n,d,m,h,g){function c(e){const {sprite:r,aspectRatio:f,scaleProportionally:p}=
e;var t=q.pt2px(e.height);e=0<t?t:r.height;t*=f;0>=t?t=r.width:p&&(t*=r.width/r.height);return{width:t,height:e}}function a(e){const {applyRandomOffset:r,sampleAlphaOnly:f}=e;return d.packBitset([[h.bitsetFillRandomPatternOffset,r],[h.bitsetGenericConsiderAlphaOnly,f]])}const b={createComputedParams:e=>e,optionalAttributes:m.patternFillVertexSpec.optionalAttributes,attributes:{...m.patternFillVertexSpec.attributes,bitset:{count:1,type:g.DataType.UNSIGNED_BYTE,pack:a},width:{count:1,type:g.DataType.HALF_FLOAT,
pack:e=>c(e).width},height:{count:1,type:g.DataType.HALF_FLOAT,pack:e=>c(e).height},offset:{count:2,type:g.DataType.HALF_FLOAT,pack:({offsetX:e,offsetY:r})=>[q.pt2px(e),-q.pt2px(r)]},scale:{count:2,type:g.DataType.UNSIGNED_BYTE,packPrecisionFactor:16,pack:({scaleX:e,scaleY:r})=>[e,r]},angle:{count:1,type:g.DataType.UNSIGNED_BYTE,pack:({angle:e})=>n.degToByte(e)}}};class k extends m.PatternFillMeshWriter{constructor(){super(...arguments);this.vertexSpec=b}}l.ComplexFillMeshWriter=k;l.complexFillVertexSpec=
b;l.getPatternSize=c;l.packComplexFillBitset=a;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/fill/PatternFillMeshWriter":function(){define(["exports","../../../definitions","./FillMeshWriter","../../../../../../webgl/enums"],function(l,q,n,d){const m={createComputedParams:g=>g,optionalAttributes:n.fillVertexSpec.optionalAttributes,attributes:{...n.fillVertexSpec.attributes,tlbr:{count:4,type:d.DataType.UNSIGNED_SHORT,pack:({sprite:g})=>
{const {rect:c,width:a,height:b}=g;g=c.x+q.spritePadding;const k=c.y+q.spritePadding;return[g,k,g+a,k+b]}},inverseRasterizationScale:{count:1,type:d.DataType.BYTE,packPrecisionFactor:16,pack:({sprite:g})=>1/g.rasterizationScale}}};class h extends n.FillMeshWriter{constructor(){super(...arguments);this.vertexSpec=m}_write(g,c,a){a=a?.asOptimized()??c.readGeometryForDisplay();if(a=this._clip(a))g.recordStart(this.instanceId,this.attributeLayout,this.evaluatedMeshParams.sprite?.textureBinding),this._writeGeometry(g,
c,a),g.recordEnd()}}l.PatternFillMeshWriter=h;l.patternFillVertexSpec=m;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/fill/FillMeshWriter":function(){define(["exports","../../../definitions","./AFillMeshWriter","./meshWriterUtils","../../../../../../webgl/enums"],function(l,q,n,d,m){const h={createComputedParams:c=>c,optionalAttributes:{zoomRange:{type:m.DataType.SHORT,count:2,packPrecisionFactor:q.minMaxZoomPrecisionFactor,pack:({scaleInfo:c},
{tileInfo:a})=>d.getMinMaxZoom(c,a)}},attributes:{id:{type:m.DataType.UNSIGNED_BYTE,count:3,pack:"id"},bitset:{type:m.DataType.UNSIGNED_BYTE,count:1},pos:{type:m.DataType.SHORT,count:2,pack:"position",packPrecisionFactor:10},color:{type:m.DataType.UNSIGNED_BYTE,count:4,normalized:!0,pack:({color:c})=>d.processColorInput(c)}}};class g extends n.AFillMeshWriter{constructor(){super(...arguments);this.vertexSpec=h}createTesselationParams(c){return null}}l.FillMeshWriter=g;l.fillVertexSpec=h;Object.defineProperty(l,
Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/fill/ComplexOutlineFillMeshWriter":function(){define("exports ../../../../../../../core/screenUtils ../../../../../../../geometry/GeometryCursor ./ComplexFillMeshWriter ./meshWriterUtils ./OutlineFillMeshWriter ../shaders/ComplexOutlineFillShader ../shaders/constants ../../../../../../webgl/enums".split(" "),function(l,q,n,d,m,h,g,c,a){const b=d.complexFillVertexSpec,k={createComputedParams:p=>p,optionalAttributes:b.optionalAttributes,
attributes:{...b.attributes,bitset:{type:a.DataType.UNSIGNED_BYTE,count:1,pack:p=>d.packComplexFillBitset(p)},aux1:{count:1,type:a.DataType.HALF_FLOAT,pack:p=>d.getPatternSize(p).width},aux2:{count:1,type:a.DataType.HALF_FLOAT,pack:p=>d.getPatternSize(p).height},aux3:{count:2,type:a.DataType.HALF_FLOAT,pack:({offsetX:p,offsetY:t})=>[q.pt2px(p),q.pt2px(t)]},aux4:{count:2,type:a.DataType.UNSIGNED_BYTE,pack:({scaleX:p,scaleY:t})=>[p*g.packPrecision,t*g.packPrecision]}}},e={createComputedParams:p=>p,
optionalAttributes:b.optionalAttributes,attributes:{...b.attributes,color:h.outlineFillVertexSpec_Outline.attributes.color,bitset:{type:a.DataType.UNSIGNED_BYTE,count:1,pack:p=>m.packBitset([[c.bitsetTypeFillOutline,!0]])},aux1:{count:1,type:a.DataType.HALF_FLOAT,pack:p=>q.pt2px(.5*p.width)},aux2:{count:1,type:a.DataType.HALF_FLOAT,pack:p=>q.pt2px(.5*p.referenceWidth)},aux3:{count:2,type:a.DataType.HALF_FLOAT,packTessellation:({extrusionOffsetX:p,extrusionOffsetY:t})=>[p,t]},aux4:{count:2,type:a.DataType.UNSIGNED_BYTE,
packTessellation:({normalX:p,normalY:t})=>[p*g.packPrecision+g.signedToUnsignedByte,t*g.packPrecision+g.signedToUnsignedByte]}}};class r extends h.OutlineFillOutlineMeshWriter{constructor(){super(...arguments);this.vertexSpec=e}}class f extends h.OutlineFillMeshWriter{constructor(){super(...arguments);this.vertexSpec=k}_createOutlineWriter(p,t,w,z){return new r(p,t,w,z)}_write(p,t,w){w=w?.asOptimized()??t.readGeometryForDisplay();if(w=this._clip(w))p.recordStart(this.instanceId,this.attributeLayout,
this.evaluatedMeshParams.sprite?.textureBinding),this._writeGeometry(p,t,w),this._lineMeshWriter.writeLineVertices(p,n.GeometryCursor.fromOptimizedCIM(w,"esriGeometryPolyline"),t),p.recordEnd()}ensurePacked(p,t,w){super.ensurePacked(p,t,w);this._lineMeshWriter.ensurePacked(p,t,w)}enqueueRequest(p,t,w){super.enqueueRequest(p,t,w);this._lineMeshWriter.enqueueRequest(p,t,w)}async loadDependencies(){await Promise.all([super.loadDependencies(),this._lineMeshWriter.loadDependencies()])}}l.ComplexOutlineFillMeshWriter=
f;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/fill/OutlineFillMeshWriter":function(){define("exports ../../../../../../../geometry/GeometryCursor ../../../mesh/templates/templateUtils ./FillMeshWriter ./meshWriterUtils ../line/LineMeshWriter ../mesh/utils ../shaders/constants ../../../../../../webgl/enums".split(" "),function(l,q,n,d,m,h,g,c,a){const b={createComputedParams:f=>f,optionalAttributes:h.LineVertexSpec.optionalAttributes,
attributes:{...h.LineVertexSpec.attributes,bitset:{type:a.DataType.UNSIGNED_BYTE,count:1,pack:f=>0},color:{type:a.DataType.UNSIGNED_BYTE,count:4,normalized:!0,pack:({color:f})=>m.processColorInput(f)}}},k={createComputedParams:f=>f,optionalAttributes:h.LineVertexSpec.optionalAttributes,attributes:{...h.LineVertexSpec.attributes,bitset:{type:a.DataType.UNSIGNED_BYTE,count:1,pack:f=>m.packBitset([[c.bitsetTypeFillOutline,!0]])},color:{type:a.DataType.UNSIGNED_BYTE,count:4,normalized:!0,pack:({outlineColor:f})=>
m.processColorInput(f)}}};class e extends h.LineMeshWriter{constructor(){super(...arguments);this.vertexSpec=k}}class r extends d.FillMeshWriter{constructor(f,p,t,w){super(f,p,t,w);this.vertexSpec=b;this._lineMeshWriter=this._createOutlineWriter(f,p,t,w)}_createOutlineWriter(f,p,t,w){return new e(f,p,t,w)}_write(f,p,t){t=t?.asOptimized()??p.readGeometryForDisplay();if(t=this._clip(t))f.recordStart(this.instanceId,this.attributeLayout),this._writeGeometry(f,p,t),this._lineMeshWriter.writeLineVertices(f,
q.GeometryCursor.fromOptimizedCIM(t,"esriGeometryPolyline"),p),f.recordEnd()}_clip(f){return f?n.clipMarshall(f,g.getLineClippingMargin(this.evaluatedMeshParams)):null}ensurePacked(f,p,t){super.ensurePacked(f,p,t);this._lineMeshWriter.ensurePacked(f,p,t)}enqueueRequest(f,p,t){super.enqueueRequest(f,p,t);this._lineMeshWriter.enqueueRequest(f,p,t)}async loadDependencies(){await Promise.all([super.loadDependencies(),this._lineMeshWriter.loadDependencies()])}}l.OutlineFillMeshWriter=r;l.OutlineFillOutlineMeshWriter=
e;l.outlineFillVertexSpec_Fill=b;l.outlineFillVertexSpec_Outline=k;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/line/LineMeshWriter":function(){define("exports ../../../../../../../core/screenUtils ../../../../../../../geometry/GeometryCursor ../../../definitions ../../../TurboLine ../../../mesh/templates/templateUtils ../fill/meshWriterUtils ../mesh/MeshWriter ../mesh/utils ../../../../../../webgl/enums".split(" "),function(l,
q,n,d,m,h,g,c,a,b){class k{constructor(){this.distance=this.directionY=this.directionX=this.normalY=this.normalX=this.extrusionOffsetY=this.extrusionOffsetX=0}}const e={createComputedParams:p=>p,optionalAttributes:{zoomRange:{type:b.DataType.SHORT,count:2,packPrecisionFactor:d.minMaxZoomPrecisionFactor,pack:({scaleInfo:p},{tileInfo:t})=>g.getMinMaxZoom(p,t)}},attributes:{id:{type:b.DataType.UNSIGNED_BYTE,count:3,pack:"id"},pos:{type:b.DataType.SHORT,count:2,pack:"position",packPrecisionFactor:10},
bitset:{type:b.DataType.UNSIGNED_BYTE,count:1},color:{type:b.DataType.UNSIGNED_BYTE,count:4,normalized:!0,pack:({color:p})=>g.processColorInput(p)},offset:{type:b.DataType.BYTE,count:2,packPrecisionFactor:16,packTessellation:({extrusionOffsetX:p,extrusionOffsetY:t})=>[g.packRounded(p,16),g.packRounded(t,16)]},normal:{type:b.DataType.BYTE,count:2,packPrecisionFactor:16,packTessellation:({normalX:p,normalY:t})=>[g.packRounded(p,16),g.packRounded(t,16)]},halfWidth:{type:b.DataType.HALF_FLOAT,count:1,
pack:({width:p})=>q.pt2px(.5*p)},referenceHalfWidth:{type:b.DataType.HALF_FLOAT,count:1,pack:({referenceWidth:p})=>q.pt2px(.5*p)}}};class r{constructor(){this.vertexBounds=this.vertexFrom=this.vertexCount=this.indexCount=this.bitset=this.id=0}}class f extends c.MeshWriter{constructor(p,t,w,z){super(p,t,w,z);this.vertexSpec=e;this._currentWrite=new r;this._tessellationOptions={halfWidth:0,pixelCoordRatio:1,offset:0,wrapDistance:65535,textured:!1};this._tessParams=new k;this._initializeTessellator()}writeLineVertices(p,
t,w){t=this._getLines(t);null!=t&&this._writeVertices(p,w,t)}_initializeTessellator(){this._lineTessellator=new m.LineTessellation(this._writeTesselatedVertex.bind(this),this._writeTriangle.bind(this),!0)}_write(p,t,w){(w=w??n.GeometryCursor.fromFeatureSetReaderCIM(t))&&this._writeGeometry(p,t,w)}_writeGeometry(p,t,w,z){p.recordStart(this.instanceId,this.attributeLayout,z);this.writeLineVertices(p,w,t);p.recordEnd()}_getLines(p){return h.clipLinesMarshall(p,a.getLineClippingMargin(this.evaluatedMeshParams))}_writeVertices(p,
t,w){const {_currentWrite:z,_tessellationOptions:u,evaluatedMeshParams:y}=this,{width:A,capType:v,joinType:x,miterLimit:C,hasSizeVV:B}=y,E=q.pt2px(.5*A);u.halfWidth=E;u.capType=g.processLineCapInput(v);u.joinType=g.processLineJoinInput(x);u.miterLimit=C;const D=!B;z.out=p;z.id=t.getDisplayId();z.vertexCount=0;z.indexCount=0;z.vertexFrom=p.vertexCount();z.vertexBounds=D&&E<d.thinLineHalfWidthThreshold?0:1;for(const {line:F,start:G}of w)u.initialDistance=G%65535,this._lineTessellator.tessellate(F,u,
D)}_writeTesselatedVertex(p,t,w,z,u,y,A,v,x,C,B){const {out:E,id:D,vertexBounds:F}=this._currentWrite;this.hasEffects&&E.recordBounds(p,t,F,F);this._tessParams.extrusionOffsetX=A;this._tessParams.extrusionOffsetY=v;this._tessParams.normalX=x;this._tessParams.normalY=C;this._tessParams.directionX=u;this._tessParams.directionY=y;this._tessParams.distance=B;this._writeVertex(E,D,p,t,this._tessParams);return this._currentWrite.vertexFrom+this._currentWrite.vertexCount++}_writeTriangle(p,t,w){const {out:z}=
this._currentWrite;z.indexEnsureSize(3);z.indexWrite(p);z.indexWrite(t);z.indexWrite(w);this._currentWrite.indexCount+=3}}l.LineMeshWriter=f;l.LineTessellationParams=k;l.LineVertexSpec=e;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/TurboLine":function(){define(["exports","../../../../symbols/cim/enums","./definitions"],function(l,q,n){function d(e,r){return e.x===r.x&&e.y===r.y}function m(e,r){e.x=r.y;e.y=-r.x;return e}function h(e,r){e.x=-r.y;e.y=r.x;
return e}function g(e,r){e.x=r.x;e.y=r.y;return e}function c(e,r){e.x=-r.x;e.y=-r.y;return e}function a(e){return Math.sqrt(e.x*e.x+e.y*e.y)}function b(e,r,f,p){e.x=r.x*f+r.y*p;e.y=r.x*p-r.y*f;return e}class k{constructor(e,r,f){this._writeVertex=e;this._writeTriangle=r;this._canUseThinTessellation=f;this._prevNormal={x:void 0,y:void 0};this._nextNormal={x:void 0,y:void 0};this._textureNormalLeft={x:0,y:1};this._textureNormalRight={x:0,y:-1};this._textureNormal={x:void 0,y:void 0};this._joinNormal=
{x:void 0,y:void 0};this._inner={x:void 0,y:void 0};this._outer={x:void 0,y:void 0};this._roundStart={x:void 0,y:void 0};this._roundEnd={x:void 0,y:void 0};this._startBreak={x:void 0,y:void 0};this._endBreak={x:void 0,y:void 0};this._innerPrev={x:void 0,y:void 0};this._innerNext={x:void 0,y:void 0};this._bevelStart={x:void 0,y:void 0};this._bevelEnd={x:void 0,y:void 0};this._bevelMiddle={x:void 0,y:void 0}}tessellate(e,r,f=this._canUseThinTessellation){if(e){var p=e.length;if(!(1>=p)){var t=0;for(let w=
1;w<p;w++)d(e[w],e[t])||++t===w||(e[t]=e[w]);e.length=t+1}}f&&r.halfWidth<n.thinLineHalfWidthThreshold&&!r.offset?this._tessellateThin(e,r):this._tessellate(e,r)}_tessellateThin(e,r){if(!(2>e.length)){var f=r.wrapDistance||65535;r=r.initialDistance||0;var p=!1,t=e[0].x,w=e[0].y,z=e.length;for(let v=1;v<z;++v){p&&(p=!1,r=0);let x=e[v].x,C=e[v].y;var u=x-t;let B=C-w;var y=Math.sqrt(u*u+B*B);u/=y;B/=y;if(r+y>f){p=!0;var A=(f-r)/y;y=f-r;x=(1-A)*t+A*x;C=(1-A)*w+A*C;--v}A=this._writeVertex(t,w,0,0,u,B,
B,-u,0,-1,r);t=this._writeVertex(t,w,0,0,u,B,-B,u,0,1,r);r+=y;y=this._writeVertex(x,C,0,0,u,B,B,-u,0,-1,r);u=this._writeVertex(x,C,0,0,u,B,-B,u,0,1,r);this._writeTriangle(A,t,y);this._writeTriangle(t,y,u);t=x;w=C}}}_tessellate(e,r){var f=e[e.length-1];const p=d(e[0],f);if(!(e.length<(p?3:2))){var t=r.pixelCoordRatio,w=null!=r.capType?r.capType:q.CapType.BUTT,z=null!=r.joinType?r.joinType:q.JoinType.MITER,u=null!=r.miterLimit?Math.min(r.miterLimit,4):2,y=null!=r.roundLimit?Math.min(r.roundLimit,1.05):
1.05,A=null!=r.halfWidth?r.halfWidth:2,v=!!r.textured,x=null,C=this._prevNormal,B=this._nextNormal,E=-1,D=-1,F=this._joinNormal,G=this._textureNormalLeft,H=this._textureNormalRight,I=this._textureNormal,K=-1,L=-1,R=r.wrapDistance||65535,S=r.initialDistance||0,W=this._writeVertex,J=this._writeTriangle;r=(la,oa,ra,qa,Da,sa)=>{la=W(T,X,Q,P,ra,qa,la,oa,Da,sa,S);0<=K&&0<=L&&0<=la&&J(K,L,la);K=L;return L=la};if(p){var O=e[e.length-2];B.x=f.x-O.x;B.y=f.y-O.y;D=a(B);B.x/=D;B.y/=D}f=!1;for(let la=0;la<e.length;++la){f&&
(f=!1,S=0);O&&(C.x=-B.x,C.y=-B.y,E=D,S+E>R&&(f=!0));f?(x=(R-S)/E,E=R-S,O={x:(1-x)*O.x+x*e[la].x,y:(1-x)*O.y+x*e[la].y},--la):O=e[la];var T=O.x;var X=O.y;var U=0>=la&&!f,N=la===e.length-1;U||(S+=E);(x=N?p?e[1]:null:e[la+1])?(B.x=x.x-T,B.y=x.y-X,D=a(B),B.x/=D,B.y/=D):(B.x=void 0,B.y=void 0);if(!p){if(U){h(F,B);var Q=F.x;var P=F.y;w===q.CapType.SQUARE&&(r(-B.y-B.x,B.x-B.y,B.x,B.y,0,-1),r(B.y-B.x,-B.x-B.y,B.x,B.y,0,1));w===q.CapType.ROUND&&(r(-B.y-B.x,B.x-B.y,B.x,B.y,-1,-1),r(B.y-B.x,-B.x-B.y,B.x,B.y,
-1,1));if(w===q.CapType.ROUND||w===q.CapType.BUTT)r(-B.y,B.x,B.x,B.y,0,-1),r(B.y,-B.x,B.x,B.y,0,1);continue}if(N){m(F,C);Q=F.x;P=F.y;if(w===q.CapType.ROUND||w===q.CapType.BUTT)r(C.y,-C.x,-C.x,-C.y,0,-1),r(-C.y,C.x,-C.x,-C.y,0,1);w===q.CapType.SQUARE&&(r(C.y-C.x,-C.x-C.y,-C.x,-C.y,0,-1),r(-C.y-C.x,C.x-C.y,-C.x,-C.y,0,1));w===q.CapType.ROUND&&(r(C.y-C.x,-C.x-C.y,-C.x,-C.y,1,-1),r(-C.y-C.x,C.x-C.y,-C.x,-C.y,1,1));continue}}var V=void 0;U=-(C.x*B.y-C.y*B.x);.01>Math.abs(U)?0<C.x*B.x+C.y*B.y?(F.x=C.x,
F.y=C.y,U=1,V=Number.MAX_VALUE,x=!0):(h(F,B),V=U=1,x=!1):(F.x=(C.x+B.x)/U,F.y=(C.y+B.y)/U,V=a(F),x=(V-1)*A*t,x=4<V||x>E&&x>D);Q=F.x;P=F.y;var Z=z;switch(z){case q.JoinType.BEVEL:1.05>V&&(Z=q.JoinType.MITER);break;case q.JoinType.ROUND:V<y&&(Z=q.JoinType.MITER);break;case q.JoinType.MITER:V>u&&(Z=q.JoinType.BEVEL)}switch(Z){case q.JoinType.MITER:r(F.x,F.y,-C.x,-C.y,0,-1);r(-F.x,-F.y,-C.x,-C.y,0,1);if(N)break;v&&(x=f?0:S,K=this._writeVertex(T,X,Q,P,B.x,B.y,F.x,F.y,0,-1,x),L=this._writeVertex(T,X,Q,
P,B.x,B.y,-F.x,-F.y,0,1,x));break;case q.JoinType.BEVEL:U=0>U;var ba=void 0;U?(Z=K,K=L,L=Z,ba=G,Z=H):(ba=H,Z=G);var aa=void 0,ca=void 0;x?(aa=U?h(this._innerPrev,C):m(this._innerPrev,C),ca=U?m(this._innerNext,B):h(this._innerNext,B)):aa=ca=U?c(this._inner,F):g(this._inner,F);V=U?m(this._bevelStart,C):h(this._bevelStart,C);r(aa.x,aa.y,-C.x,-C.y,ba.x,ba.y);aa=r(V.x,V.y,-C.x,-C.y,Z.x,Z.y);if(N)break;N=U?h(this._bevelEnd,B):m(this._bevelEnd,B);x?(x=this._writeVertex(T,X,Q,P,-C.x,-C.y,0,0,0,0,S),K=this._writeVertex(T,
X,Q,P,B.x,B.y,ca.x,ca.y,ba.x,ba.y,S),L=this._writeVertex(T,X,Q,P,B.x,B.y,N.x,N.y,Z.x,Z.y,S),this._writeTriangle(aa,x,L)):(v?(x=this._bevelMiddle,x.x=(V.x+N.x)/2,x.y=(V.y+N.y)/2,b(I,x,-C.x,-C.y),r(x.x,x.y,-C.x,-C.y,I.x,I.y),b(I,x,B.x,B.y),K=this._writeVertex(T,X,Q,P,B.x,B.y,x.x,x.y,I.x,I.y,S),L=this._writeVertex(T,X,Q,P,B.x,B.y,ca.x,ca.y,ba.x,ba.y,S)):(x=K,K=L,L=x),r(N.x,N.y,B.x,B.y,Z.x,Z.y));U&&(x=K,K=L,L=x);break;case q.JoinType.ROUND:U=0>U;var ea=void 0;U?(Z=K,K=L,L=Z,Z=G,ea=H):(Z=H,ea=G);var fa=
U?c(this._inner,F):g(this._inner,F);x?(ca=U?h(this._innerPrev,C):m(this._innerPrev,C),ba=U?m(this._innerNext,B):h(this._innerNext,B)):ba=ca=fa;aa=U?m(this._roundStart,C):h(this._roundStart,C);var ha=U?h(this._roundEnd,B):m(this._roundEnd,B);ca=r(ca.x,ca.y,-C.x,-C.y,Z.x,Z.y);aa=r(aa.x,aa.y,-C.x,-C.y,ea.x,ea.y);if(N)break;N=this._writeVertex(T,X,Q,P,-C.x,-C.y,0,0,0,0,S);x||this._writeTriangle(K,L,N);fa=c(this._outer,fa);ea=this._writeVertex(T,X,Q,P,B.x,B.y,ha.x,ha.y,ea.x,ea.y,S);let oa,ra;if(ha=2<V){var ja=
void 0;V!==Number.MAX_VALUE?(fa.x/=V,fa.y/=V,ja=C.x*fa.x+C.y*fa.y,ja=(V*(ja*ja-1)+1)/ja):ja=-1;oa=U?m(this._startBreak,C):h(this._startBreak,C);oa.x+=C.x*ja;oa.y+=C.y*ja;ra=U?h(this._endBreak,B):m(this._endBreak,B);ra.x+=B.x*ja;ra.y+=B.y*ja}b(I,fa,-C.x,-C.y);V=this._writeVertex(T,X,Q,P,-C.x,-C.y,fa.x,fa.y,I.x,I.y,S);b(I,fa,B.x,B.y);fa=v?this._writeVertex(T,X,Q,P,B.x,B.y,fa.x,fa.y,I.x,I.y,S):V;ja=N;const qa=v?this._writeVertex(T,X,Q,P,B.x,B.y,0,0,0,0,S):N;let Da=-1,sa=-1;ha&&(b(I,oa,-C.x,-C.y),Da=
this._writeVertex(T,X,Q,P,-C.x,-C.y,oa.x,oa.y,I.x,I.y,S),b(I,ra,B.x,B.y),sa=this._writeVertex(T,X,Q,P,B.x,B.y,ra.x,ra.y,I.x,I.y,S));v?ha?(this._writeTriangle(ja,aa,Da),this._writeTriangle(ja,Da,V),this._writeTriangle(qa,fa,sa),this._writeTriangle(qa,sa,ea)):(this._writeTriangle(ja,aa,V),this._writeTriangle(qa,fa,ea)):ha?(this._writeTriangle(N,aa,Da),this._writeTriangle(N,Da,sa),this._writeTriangle(N,sa,ea)):(this._writeTriangle(N,aa,V),this._writeTriangle(N,fa,ea));x?K=this._writeVertex(T,X,Q,P,B.x,
B.y,ba.x,ba.y,Z.x,Z.y,S):(K=v?this._writeVertex(T,X,Q,P,B.x,B.y,ba.x,ba.y,Z.x,Z.y,S):ca,this._writeTriangle(K,qa,ea));L=ea;U&&(x=K,K=L,L=x)}}}}}l.LineTessellation=k;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/fill/PatternOutlineFillMeshWriter":function(){define(["exports","../../../../../../../geometry/GeometryCursor","./OutlineFillMeshWriter","./PatternFillMeshWriter"],function(l,q,n,d){const m={optionalAttributes:d.patternFillVertexSpec.optionalAttributes,
createComputedParams:a=>a,attributes:{...d.patternFillVertexSpec.attributes,...n.outlineFillVertexSpec_Fill.attributes}},h={optionalAttributes:d.patternFillVertexSpec.optionalAttributes,createComputedParams:a=>a,attributes:{...d.patternFillVertexSpec.attributes,...n.outlineFillVertexSpec_Outline.attributes}};class g extends n.OutlineFillOutlineMeshWriter{constructor(){super(...arguments);this.vertexSpec=h}}class c extends n.OutlineFillMeshWriter{constructor(){super(...arguments);this.vertexSpec=m}_createOutlineWriter(a,
b,k,e){return new g(a,b,k,e)}_write(a,b,k){k=k?.asOptimized()??b.readGeometryForDisplay();if(k=this._clip(k))a.recordStart(this.instanceId,this.attributeLayout,this.evaluatedMeshParams.sprite?.textureBinding),this._writeGeometry(a,b,k),this._lineMeshWriter.writeLineVertices(a,q.GeometryCursor.fromOptimizedCIM(k,"esriGeometryPolyline"),b),a.recordEnd()}ensurePacked(a,b,k){super.ensurePacked(a,b,k);this._lineMeshWriter.ensurePacked(a,b,k)}enqueueRequest(a,b,k){super.enqueueRequest(a,b,k);this._lineMeshWriter.enqueueRequest(a,
b,k)}async loadDependencies(){await Promise.all([super.loadDependencies(),this._lineMeshWriter.loadDependencies()])}}l.PatternOutlineFillMeshWriter=c;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/heatmap/HeatmapMeshWriter":function(){define(["exports","../mesh/MeshWriter","../../../../../../webgl/enums"],function(l,q,n){const d={createComputedParams:h=>h,optionalAttributes:{},attributes:{pos:{type:n.DataType.SHORT,count:2,pack:"position",
packPrecisionFactor:10},id:{type:n.DataType.UNSIGNED_BYTE,count:3,pack:"id"},bitset:{type:n.DataType.UNSIGNED_BYTE,count:1},offset:{type:n.DataType.BYTE,count:2,packAlternating:{count:4,pack:()=>[[-1,-1],[1,-1],[-1,1],[1,1]]}}}};class m extends q.MeshWriter{constructor(){super(...arguments);this.vertexSpec=d}_write(h,g){h.recordStart(this.instanceId,this.attributeLayout);const c=g.getDisplayId();if("esriGeometryPoint"===g.geometryType){const a=g.readXForDisplay();g=g.readYForDisplay();this._writeQuad(h,
c,a,g)}else"esriGeometryMultipoint"===g.geometryType&&g.readGeometryForDisplay()?.forEachVertex((a,b)=>{0<=a&&512>=a&&0<=b&&512>=b&&this._writeQuad(h,c,a,b)});h.recordEnd()}_writeQuad(h,g,c,a){const b=h.vertexCount();this._writeVertex(h,g,c,a);h.indexWrite(b+0);h.indexWrite(b+1);h.indexWrite(b+2);h.indexWrite(b+1);h.indexWrite(b+3);h.indexWrite(b+2)}}l.HeatmapMeshWriter=m;l.heatmapVertexSpec=d;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/labels/LabelMeshWriter":function(){define("exports ../../../../../../../core/MapUtils ../../../../../../../core/screenUtils ../../../../../../../core/libs/gl-matrix-2/math/mat2d ../../../../../../../core/libs/gl-matrix-2/factories/mat2df32 ../../../../../../../core/libs/gl-matrix-2/math/vec2 ../../../../../../../core/libs/gl-matrix-2/factories/vec2f32 ../../../../../../../core/libs/gl-matrix-2/factories/vec2f64 ../../../../../../../layers/graphics/featureConversionUtils ../../../../../../../layers/graphics/OptimizedGeometry ../../../alignmentUtils ../../../definitions ../../../DisplayId ../../../collisions/LabelMetric ../../../mesh/templates/segmentUtils ../fill/meshWriterUtils ../text/TextMeshWriter".split(" "),
function(l,q,n,d,m,h,g,c,a,b,k,e,r,f,p,t,w){function z(A,v,x){const {coords:C,lengths:B}=v;v=c.create();const E=c.create(),D=c.create(),F=c.create(),G=c.create(),H=c.create();let I=0;for(let L=0;L<B.length;L++){const R=B[L];for(let S=0;S<R;S++){var K=2*(S+I-1);const W=2*(S+I),J=2*(S+I+1);0<S?h.set(v,C[K],C[K+1]):h.set(v,0,0);h.set(E,C[W],C[W+1]);S<R-1?h.set(D,C[J],C[J+1]):h.set(D,0,0);0===S?h.set(F,0,0):(h.sub(F,E,v),h.normalize(F,F),h.set(F,F[1],-F[0]));S===R-1?h.set(G,0,0):(h.sub(G,D,E),h.normalize(G,
G),h.set(G,G[1],-G[0]));h.add(H,F,G);h.normalize(H,H);K=H[0]*G[0]+H[1]*G[1];0!==K&&h.scale(H,H,K);h.scale(H,H,x);A.coords.push(E[0]+H[0],E[1]+H[1])}A.lengths.push(R);I+=R}return A}const u=q.memoize(A=>{let v=0;if(0===A)return Infinity;for(;!(A%2);)v++,A/=2;return v});class y extends w.TextMeshWriter{constructor(){super(...arguments);this._zoomLevel=0}_write(A,v,x,C){this._zoomLevel=C||0;if(null!=x)throw Error("InternalError: EffectGeometry not support for LabelMeshWriter");switch(v.geometryType){case "esriGeometryPoint":x=
v.readXForDisplay();C=v.readYForDisplay();this._writePoint(A,x,C,v);break;case "esriGeometryEnvelope":case "esriGeometryPolygon":case "esriGeometryMultipoint":x=v.readCentroidForDisplay();if(!x)break;const [B,E]=x.coords;this._writePoint(A,B,E,v);break;case "esriGeometryPolyline":this._writeLines(A,v)}}_createLineLabelMetric(A,v,x,C){A=r.getDisplayIdTexel(A);return new f.LabelMetric(A,v,x,"right"===this.evaluatedMeshParams.horizontalAlignment?-1:1,"bottom"===this.evaluatedMeshParams.verticalAlignment?
-1:1,this.evaluatedMeshParams.scaleInfo?.maxScale??0,this.evaluatedMeshParams.scaleInfo?.minScale??0,C??null)}_writePoint(A,v,x,C){const B=this._getShaping();if(B){var E=C.getDisplayId(),D=k.getXAnchorDirection(this.evaluatedMeshParams.horizontalAlignment),F=k.getYAnchorDirection(this.evaluatedMeshParams.verticalAlignment),G=this.evaluatedMeshParams.scaleInfo?.maxScale??0,H=this.evaluatedMeshParams.scaleInfo?.minScale??0;C=r.getDisplayIdTexel(C.getDisplayId());var I=this._getPointReferenceBounds()||
{offsetX:0,offsetY:0,size:0};A.metricStart(new f.LabelMetric(C,v,x,D,F,G,H,I));this._writeGlyphs(A,E,v,x,B,0,I);A.metricBoxWrite(B.boundsT);A.metricEnd()}}_getPointReferenceBounds(){if(!this._references)return null;for(const A of this._references){const v=A.getBoundsInfo();if(v)return v}return null}_writeLines(A,v){const {scaleInfo:x,verticalAlignment:C}=this.evaluatedMeshParams;var B=this.evaluatedMeshParams.repeatLabelDistance||128;const E=this._getShaping("middle");if(E){var D=(F,G,H,I)=>this._placeSubdivGlyphs(F,
G,H,I);B=(E.bounds.width+B)/2;this._current={out:A,id:v.getDisplayId(),shaping:E,zoomRange:t.getMinMaxZoom(x,this.getTileInfo()),referenceBounds:this._getPointReferenceBounds()||{offsetX:0,offsetY:0,size:0},offsetDirection:null};(this._verticalPlacement="bottom"===C?"above":"top"===C?"below":null)?this._writeAboveAndBelowAlong(v,D,B):this._writeCenterAlong(v,D,B)}}_writeAboveAndBelowAlong(A,v,x){const {repeatLabel:C}=this.evaluatedMeshParams;var {shaping:B}=this._current,E=B.bounds.halfHeight;if(A=
A.readGeometryForDisplay()){var D=new b;a.generalizeOptimizedGeometry(D,A,!1,!1,"esriGeometryPolyline",1);A=z(new b,D,E);E=z(new b,D,-E);E=a.convertToGeometry(E,"esriGeometryPolyline",!1,!1);A=a.convertToGeometry(A,"esriGeometryPolyline",!1,!1);A=p.smoothPaths(A.paths,B.bounds.width);B=p.smoothPaths(E.paths,B.bounds.width);this._current.offsetDirection="above";for(const F of A)p.pathDivide(F,x,v,!!C);this._current.offsetDirection="below";for(const F of B)p.pathDivide(F,x,v,!!C)}}_writeCenterAlong(A,
v,x){const {repeatLabel:C}=this.evaluatedMeshParams,{shaping:B}=this._current;A=p.smoothPaths(A.readLegacyGeometryForDisplay().paths,B.bounds.width);for(const E of A)p.pathDivide(E,x,v,!!C)}_placeSubdivGlyphs(A,v,x,C){const {allowOverrun:B,labelPosition:E,repeatLabelDistance:D}=this.evaluatedMeshParams,F=this._current.zoomRange[0];var G=u(v),H=this._current.shaping.bounds.width/2,I=Math.sqrt(D||128)/2;x=Math.min(x,C-x);H=this._current.shaping.isMultiline?w.maxLabelZoom:Math.log2(x/(I+H/2));G=Math.max(F,
this._zoomLevel+1-(0===v?H:Math.min(G,H)));H=this._zoomLevel-G;I=this._current.shaping.bounds.width/2*2**H;this._current.shaping.isMultiline?0===v&&this._placeStraight(A,G):B&&0>H?this._placeStraightAlong(A,F):"parallel"===E?this._placeStraightAlong(A,G):"curved"===E&&this._placeCurved(A,G,I)}_placeStraight(A,v){const {out:x,id:C,shaping:B,referenceBounds:E}=this._current,{x:D,y:F}=A;x.metricStart(this._createLineLabelMetric(C,D,F));x.metricBoxWrite(B.boundsT);const G=(180/Math.PI*A.angle+180)%360;
this._writeGlyphs(x,C,D,F,B,0,E,{clipAngle:180/Math.PI*A.angle%360,mapAligned:!0,isLineLabel:!0,minZoom:v});this._writeGlyphs(x,C,D,F,B,0,E,{clipAngle:G,mapAligned:!0,isLineLabel:!0,minZoom:v});x.metricEnd()}_placeCurved(A,v,x){const {out:C,id:B}=this._current;C.metricStart(this._createLineLabelMetric(B,A.x,A.y));const E=A.clone(),D=180/Math.PI*A.angle%360,F=(180/Math.PI*A.angle+180)%360;this._verticalPlacement&&this._verticalPlacement!==this._current.offsetDirection||(this._placeFirst(E,v,1,D),this._placeBack(A,
E,v,x,1,D),this._placeForward(A,E,v,x,1,D));this._verticalPlacement&&this._verticalPlacement===this._current.offsetDirection||(this._placeFirst(E,v,0,F),this._placeBack(A,E,v,x,0,F),this._placeForward(A,E,v,x,0,F));C.metricEnd()}_placeStraightAlong(A,v){const {out:x,id:C,shaping:B,zoomRange:E,referenceBounds:D}=this._current,{boxBorderLineColor:F,boxBackgroundColor:G}=this.evaluatedMeshParams,H=A.clone(),I=180/Math.PI*A.angle%360,K=(180/Math.PI*A.angle+180)%360;var L=0<B.glyphs.length&&!(!F&&!G);
x.metricStart(this._createLineLabelMetric(C,A.x,A.y));if(L){var R=Math.max(v,E[0],0),S=Math.min(w.maxLabelZoom,E[1]);L=d.fromRotation(m.create(),-A.angle);R={minZoom:R,maxZoom:S,clipAngle:I,mapAligned:!0,isLineLabel:!0};S=n.pt2px(this.evaluatedMeshParams.offsetX);const J=n.pt2px(this.evaluatedMeshParams.offsetY);if(!this._verticalPlacement||this._verticalPlacement===this._current.offsetDirection){var W=g.fromValues(S,-1*J);const [O,T]=B.shapeBackground(d.translate(m.create(),L,W));x.recordStart(this.instanceId,
this.attributeLayout,B.glyphs[0].textureBinding);W=2*Math.max(O.width,O.height);x.recordBounds(A.x+O.x,A.y+O.y,W,W);this._writeTextBox(x,C,A.x,A.y,T,D,R);x.recordEnd()}if(!this._verticalPlacement||this._verticalPlacement!==this._current.offsetDirection){S=g.fromValues(S,J);const [O,T]=B.shapeBackground(d.translate(m.create(),L,S));R.clipAngle=K;x.recordStart(this.instanceId,this.attributeLayout,B.glyphs[0].textureBinding);L=2*Math.max(O.width,O.height);x.recordBounds(A.x+O.x,A.y+O.y,L,L);this._writeTextBox(x,
C,A.x,A.y,T,D,R);x.recordEnd()}}this._verticalPlacement&&this._verticalPlacement!==this._current.offsetDirection||this._placeFirst(H,v,1,I,!0);this._verticalPlacement&&this._verticalPlacement===this._current.offsetDirection||this._placeFirst(H,v,0,K,!0);x.metricEnd()}_placeBack(A,v,x,C,B,E){const D=A.clone();for(A=A.backwardLength+0;D.prev()&&!(A>=C);)this._placeOnSegment(D,v,A,x,-1,B,E),A+=D.length+0}_placeForward(A,v,x,C,B,E){const D=A.clone();for(A=A.remainingLength+0;D.next()&&!(A>=C);)this._placeOnSegment(D,
v,A,x,1,B,E),A+=D.length+0}_placeFirst(A,v,x,C,B=!1){const {out:E,id:D,shaping:F,zoomRange:G,referenceBounds:H}=this._current;var I=F.glyphs;for(const K of I)I=K.x>F.bounds.x?x:1-x,I=Math.max(0,this._zoomLevel+Math.log2(Math.abs(K.x+K.width/2-F.bounds.x)/(I*A.remainingLength+(1-I)*A.backwardLength))),I=Math.max(v,B?0:I),K.maxZoom=Math.min(G[1],w.maxLabelZoom),K.angle=A.angle+(1-x)*Math.PI,K.minZoom=Math.max(G[0],I),this._writeLineGlyph(E,D,A.x,A.y,F.bounds,K,C,H,!0),(x||this._current.offsetDirection)&&
this._isVisible(K.minZoom,K.maxZoom)&&E.metricBoxWrite(K.bounds)}_placeOnSegment(A,v,x,C,B,E,D){const {out:F,id:G,shaping:H,referenceBounds:I}=this._current;var K=H.glyphs;v=A.x+A.dx/A.length*-B*x;var L=A.y+A.dy/A.length*-B*x;for(const S of K)if((K=S.x>H.bounds.x?E:1-E)&&1===B||!K&&-1===B){var R=Math.abs(S.x+S.width/2-H.bounds.x);K=Math.max(0,this._zoomLevel+Math.log2(R/x)-.1);R=Math.max(C,this._zoomLevel+Math.log2(R/(x+A.length+0)));0!==K&&(S.angle=A.angle+(1-E)*Math.PI,S.minZoom=R,S.maxZoom=K,this._writeLineGlyph(F,
G,v,L,H.bounds,S,D,I,!0),(E||this._current.offsetDirection)&&this._isVisible(S.minZoom,S.maxZoom)&&F.metricBoxWrite(S.bounds))}}_writeLineGlyph(A,v,x,C,B,E,D,F,G){const H=x+B.x,I=C+B.y;B=2*Math.max(B.width,B.height)*(this.evaluatedMeshParams.minPixelBuffer?this.evaluatedMeshParams.minPixelBuffer/this._textMeshTransformProps.fontSize:1);A.recordStart(this.instanceId,this.attributeLayout,E.textureBinding);A.recordBounds(H,I,B,B);const {texcoords:K,offsets:L}=E,{fontSize:R,haloSize:S,outlineSize:W}=
this._textMeshTransformProps;this._writeQuad(A,v,x,C,{texcoords:K,offsets:L,fontSize:R,haloSize:S,outlineSize:W,color:t.processColorInput(this.evaluatedMeshParams.color),isBackground:!1,referenceBounds:F,minZoom:Math.max(this._current.zoomRange[0],E.minZoom),maxZoom:Math.min(this._current.zoomRange[1],E.maxZoom),clipAngle:D,mapAligned:G,isLineLabel:!0});A.recordEnd()}_isVisible(A,v){const x=Math.floor(this._zoomLevel*e.minMaxZoomPrecisionFactor)/e.minMaxZoomPrecisionFactor;return A<=x&&x<=v}}l.LabelMeshWriter=
y;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/DisplayId":function(){define(["exports"],function(l){l.aggregateValidFiltersMask=254;l.createDisplayId=function(q,n){return((n?8388608:0)|q)>>>0};l.displayIdTexelMask=8388607;l.displayIdTypeAggregate=1;l.displayIdTypeFeature=0;l.displayIdTypeMask=8388608;l.getDisplayIdFilterMask=q=>1===(q&8388608)>>>23?254:255;l.getDisplayIdTexel=q=>q&8388607;l.getDisplayIdType=q=>(q&8388608)>>>23;l.isAggregateId=function(q){return 1===
(q&8388608)>>>23};l.nonAggregateValidFiltersMask=255;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/mesh/templates/segmentUtils":function(){define(["exports","../../../../../../symbols/cim/constants"],function(l,q){function n(b,k,e){b[0]=k[0]-e[0];b[1]=k[1]-e[1];return b}function d(b){var k=b[0];var e=b[1];k=Math.sqrt(k*k+e*e);b[0]/=k;b[1]/=k}function m(b){return b.length-1}function h(b){let k=0;for(let e=0;e<m(b);e++)k+=g(b,e);return k}function g(b,k,
e=1){let [r,f]=b[k+1];[r,f]=[Math.round(r),Math.round(f)];return Math.sqrt(r*r+f*f)*e}function c(b,k,e,r,f){if(!(e<k)){var p=r.clone().seek(e/2);null!=p&&(b(p.clone(),e,f),e=(e-k)/2,p=p.seek(k/2),c(b,k,e,r,f+1),c(b,k,e,p,f+1))}}class a{constructor(b,k,e,r,f){this._segments=b;this._index=k;this._distance=e;this._xStart=r;this._yStart=f;this._done=!1}static create(b){return new a(b,0,0,b[0][0],b[0][1])}clone(){return new a(this._segments,this._index,this._distance,this.xStart,this.yStart)}equals(b){return this._index===
b._index||b._index===this._index-1&&(0===this._distance||1===b._distance)||b._index===this._index+1&&(1===this._distance||0===b._distance)}leq(b){return this._index<b._index||this._index===b._index&&this._distance<=b._distance}geq(b){return this._index>b._index||this._index===b._index&&this._distance>=b._distance}get _segment(){return this._segments[this._index+1]}get angle(){const b=this.dy;let k=Math.acos((0*b+-1*-this.dx)/(1*this.length));0<b&&(k=2*Math.PI-k);return k}get xStart(){return this._xStart}get yStart(){return this._yStart}get x(){return this.xStart+
this.distance*this.dx}get y(){return this.yStart+this.distance*this.dy}get dx(){return this._segment[0]}get dy(){return this._segment[1]}get xMidpoint(){return this.xStart+.5*this.dx}get yMidpoint(){return this.yStart+.5*this.dy}get xEnd(){return this.xStart+this.dx}get yEnd(){return this.yStart+this.dy}get length(){const {dx:b,dy:k}=this;return Math.sqrt(b*b+k*k)}get remainingLength(){return this.length*(1-this._distance)}get backwardLength(){return this.length*this._distance}get distance(){return this._distance}get done(){return this._done}hasPrev(){return 0<=
this._index-1}hasNext(){return this._index+1<m(this._segments)}next(){if(!this.hasNext())return null;this._xStart+=this.dx;this._yStart+=this.dy;this._distance=0;this._index+=1;return this}prev(){if(!this.hasPrev())return this._done=!0,null;--this._index;this._xStart-=this.dx;this._yStart-=this.dy;this._distance=1;return this}_seekBackwards(b,k){var e=this.backwardLength;if(b<=e)return this._distance=(e-b)/this.length,this;for(e=this.backwardLength;this.prev();){if(e+this.length>b)return this._seekBackwards(b-
e);e+=this.length}this._distance=0;return k?this:null}seek(b,k=!1){if(0>b)return this._seekBackwards(Math.abs(b),k);if(b<=this.remainingLength)return this._distance=(this.backwardLength+b)/this.length,this;let e=this.remainingLength;for(;this.next();){if(e+this.length>b)return this.seek(b-e,k);e+=this.length}this._distance=1;return k?this:null}}l.SegmentCursor=a;l.pathDivide=function(b,k,e,r=!0){const f=h(b);b=a.create(b);const p=f/2;if(r){r=Math.floor(Math.max((f-k)/2,0)/k);b.seek(p-r*k);for(let t=
-r;t<=r;t++)Math.abs(b.x)<q.maxTileCoordValue&&Math.abs(b.y)<q.maxTileCoordValue&&e(b.clone(),t,p+t*k,f),b.seek(k)}else b.seek(p),Math.abs(b.x)<q.maxTileCoordValue&&Math.abs(b.y)<q.maxTileCoordValue&&e(b.clone(),0,p+0*k,f)};l.pathLength=h;l.pathSubdivide=function(b,k,e){c(e,k,h(b),a.create(b),0)};l.segmentAt=function(b,k){return b[k+1]};l.segmentCount=m;l.segmentLength=g;l.smoothPaths=function(b,k){for(let G=0;G<b.length;G++){let H=b[G];a:{var e=H,r=k;if(0>=r)break a;const I=e.length;if(3>I)break a;
const K=[];var f=0;K.push(0);for(var p=1;p<I;p++){var t=e[p],w=e[p-1],z=t[0]-w[0];t=t[1]-w[1];f+=Math.sqrt(z*z+t*t);K.push(f)}r=Math.min(r,.2*f);p=[];p.push(e[0][0]);p.push(e[0][1]);f=e[I-1][0];z=e[I-1][1];t=n([0,0],e[0],e[1]);d(t);e[0][0]+=r*t[0];e[0][1]+=r*t[1];n(t,e[I-1],e[I-2]);d(t);e[I-1][0]+=r*t[0];e[I-1][1]+=r*t[1];for(t=1;t<I;t++)K[t]+=r;K[I-1]+=r;t=.5*r;for(w=1;w<I-1;w++){let L=0,R=0,S=0;for(var u=w-1;0<=u&&!(K[u+1]<K[w]-t);u--){var y=t+K[u+1]-K[w],A=K[u+1]-K[u],v=K[w]-K[u]<t?1:y/A;if(1E-6>
Math.abs(v))break;var x=v*v,C=v*y-.5*x*A,B=v*A/r,E=e[u+1],D=e[u][0]-E[0],F=e[u][1]-E[1];L+=B/C*(E[0]*v*y+.5*x*(y*D-A*E[0])-x*v*A*D/3);R+=B/C*(E[1]*v*y+.5*x*(y*F-A*E[1])-x*v*A*F/3);S+=B}for(u=w+1;u<I&&!(K[u-1]>K[w]+t);u++){y=t-K[u-1]+K[w];A=K[u]-K[u-1];v=K[u]-K[w]<t?1:y/A;if(1E-6>Math.abs(v))break;x=v*v;C=v*y-.5*x*A;B=v*A/r;E=e[u-1];D=e[u][0]-E[0];F=e[u][1]-E[1];L+=B/C*(E[0]*v*y+.5*x*(y*D-A*E[0])-x*v*A*D/3);R+=B/C*(E[1]*v*y+.5*x*(y*F-A*E[1])-x*v*A*F/3);S+=B}p.push(L/S);p.push(R/S)}p.push(f);p.push(z);
for(let L=0,R=0;L<I;L++)e[L][0]=p[R++],e[L][1]=p[R++]}e=[];e.push(H[0]);for(r=1;r<H.length;r++){const [I,K]=H[r-1],[L,R]=H[r];e.push([L-I,R-K])}H=b[G]=e}return b};Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/text/TextMeshWriter":function(){define("exports ../../../../../../../core/mathUtils ../../../../../../../core/screenUtils ../../../../../../../geometry/GeometryCursor ../../../../../../../symbols/cim/placements/CIMMarkerPlacementHelper ../../../alignmentUtils ../../../definitions ../../../mesh/templates/shapingUtils ../fill/meshWriterUtils ../mesh/loadGeometryEngine ../mesh/MeshWriter ../shaders/constants ./TextParams ../../../../../../webgl/enums".split(" "),
function(l,q,n,d,m,h,g,c,a,b,k,e,r,f){const p=[4,4];var t=[16,4];const w={topLeft:t,topRight:t,bottomLeft:t,bottomRight:t};t=[4,2];const z=[4,6],u={topLeft:t,topRight:t,bottomLeft:z,bottomRight:z},y={topLeft:t,topRight:z,bottomLeft:t,bottomRight:z},A={topLeft:z,topRight:z,bottomLeft:p,bottomRight:p},v={topLeft:p,topRight:p,bottomLeft:z,bottomRight:z},x={topLeft:z,topRight:p,bottomLeft:z,bottomRight:p},C={topLeft:p,topRight:z,bottomLeft:p,bottomRight:z},B={createComputedParams:D=>D,optionalAttributes:{zoomRange:{type:f.DataType.UNSIGNED_SHORT,
count:2,packPrecisionFactor:g.minMaxZoomPrecisionFactor,packTessellation:({minZoom:D,maxZoom:F})=>[D||0,F||28]},clipAngle:{type:f.DataType.UNSIGNED_BYTE,count:1,packTessellation:({clipAngle:D})=>Math.round(254/360*(D||0))},referenceSymbol:{type:f.DataType.BYTE,count:4,packPrecisionFactor:1,packTessellation:(D,F)=>{const G=D.isLineLabel||!D.referenceBounds,H=h.getXDirection(G?"center":F.horizontalAlignment);F=h.getYDirection(G?"middle":F.verticalAlignment);const {offsetX:I,offsetY:K,size:L}=G?{offsetX:0,
offsetY:0,size:0}:D.referenceBounds;return[n.pt2px(I),-n.pt2px(K),Math.round(n.pt2px(L)),H+1<<2|F+1]}}},attributes:{pos:{type:f.DataType.SHORT,count:2,pack:"position",packPrecisionFactor:10},id:{type:f.DataType.UNSIGNED_BYTE,count:3,pack:"id"},bitset:{type:f.DataType.UNSIGNED_BYTE,count:1,packTessellation:({isBackground:D,mapAligned:F})=>a.packBitset([[e.bitsetTextIsBackground,D],[e.bitsetTextIsMapAligned,!!F]])},offset:{type:f.DataType.SHORT,count:2,packPrecisionFactor:8,packAlternating:{count:4,
packTessellation:({offsets:D})=>{const {bottomLeft:F,bottomRight:G,topLeft:H,topRight:I}=D;return[H,I,F,G]}}},textureUV:{type:f.DataType.SHORT,count:2,packPrecisionFactor:4,packAlternating:{count:4,packTessellation:({texcoords:D})=>{const {bottomLeft:F,bottomRight:G,topLeft:H,topRight:I}=D;return[H,I,F,G]}}},color:{type:f.DataType.UNSIGNED_BYTE,count:4,normalized:!0,packTessellation:({color:D})=>D},fontSize:{type:f.DataType.UNSIGNED_SHORT,count:1,packPrecisionFactor:4,packTessellation:({fontSize:D})=>
Math.round(n.pt2px(D))},referenceSize:{type:f.DataType.UNSIGNED_BYTE,count:1,packPrecisionFactor:4,packTessellation:({fontSize:D},{referenceSize:F})=>Math.round(n.pt2px(F??D))},outlineColor:{type:f.DataType.UNSIGNED_BYTE,count:4,normalized:!0,pack:({outlineColor:D})=>a.processColorInput(D)},haloColor:{type:f.DataType.UNSIGNED_BYTE,count:4,normalized:!0,pack:({haloColor:D})=>a.processColorInput(D)},outlineAndHaloSize:{type:f.DataType.UNSIGNED_SHORT,count:2,packPrecisionFactor:4,packTessellation:({outlineSize:D,
haloSize:F})=>[Math.round(n.pt2px(D)),Math.round(n.pt2px(F))]}}};class E extends k.MeshWriter{constructor(){super(...arguments);this.vertexSpec=B;this._textMeshParamsPropsInitialized=!1}ensurePacked(D,F,G){super.ensurePacked(D,F,G);if(!this._textMeshParamsPropsInitialized||this._evaluator.hasDynamicProperties)this._textMeshTransformProps=new r.TextMeshTransformProps(this.evaluatedMeshParams),this._textMeshParamsPropsInitialized=!0}_write(D,F,G){const H=this._getShaping();if(H){var I=F.getDisplayId();
if(null!=this.evaluatedMeshParams.placement)return this._writePlacedTextMarkers(D,F,H,G);if(G?.nextPath())return G.nextPoint(),this._writeGlyphs(D,I,G.x,G.y,H,0);if("esriGeometryPolygon"===F.geometryType){F=F.readCentroidForDisplay();if(!F)return;const [K,L]=F.coords;return this._writeGlyphs(D,I,K,L,H,0)}if("esriGeometryMultipoint"===F.geometryType)F.readGeometryForDisplay()?.forEachVertex((K,L)=>this._writeGlyphs(D,I,K,L,H,0));else return G=F.readXForDisplay(),F=F.readYForDisplay(),this._writeGlyphs(D,
I,G,F,H,0)}}_writePlacedTextMarkers(D,F,G,H){if(H=H??d.GeometryCursor.fromFeatureSetReaderCIM(F))if(H=m.CIMMarkerPlacementHelper.getPlacement(H,-1,this.evaluatedMeshParams.placement,n.pt2px(1),D.id,b.getGeometryEngine())){F=F.getDisplayId();for(var I=H.next();null!=I;){const K=I.tx,L=-I.ty;I=-I.getAngle();this._writeGlyphs(D,F,K,L,G,I);I=H.next()}}}_getShaping(D){const F=this._textMeshTransformProps,G=this.evaluatedMeshParams;if(!G.glyphs?.glyphs.length)return null;const H=n.pt2px(F.fontSize),I=n.pt2px(F.offsetX),
K=n.pt2px(F.offsetY),L=q.clamp(n.pt2px(G.lineWidth),g.minTextLineWidth,g.maxTextLineWidth),R=g.magicLabelLineHeight*q.clamp(G.lineHeightRatio,.25,4);return c.shapeGlyphs(G.glyphs,{scale:H/g.glyphSize,angle:F.postAngle,xOffset:I,yOffset:K,horizontalAlignment:G.horizontalAlignment,verticalAlignment:D||G.verticalAlignment,maxLineWidth:L,lineHeight:R,decoration:G.decoration,borderLineSizePx:n.pt2px(G.boxBorderLineSize),hasBackground:!!G.boxBackgroundColor,useCIMAngleBehavior:G.useCIMAngleBehavior})}_writeGlyphs(D,
F,G,H,I,K,L,R){const S=this.evaluatedMeshParams;var W=this._textMeshTransformProps;const J=n.pt2px(W.fontSize),O=W.haloSize,T=W.outlineSize;var X=n.pt2px(W.offsetX),U=n.pt2px(W.offsetY);const [N,Q]=a.getMinMaxZoom(S.scaleInfo,this.getTileInfo());0!==K&&I.setRotation(K);W=I.bounds;X=G+W.x+X;U=H+W.y-U;W=2*Math.max(W.width,W.height)*(S.minPixelBuffer?S.minPixelBuffer/J:1);I.textBox&&(D.recordStart(this.instanceId,this.attributeLayout,I.glyphs[0].textureBinding),D.recordBounds(X,U,W,W),this._writeTextBox(D,
F,G,H,I.textBox,L,R),D.recordEnd());for(const P of I.glyphs){D.recordStart(this.instanceId,this.attributeLayout,P.textureBinding);D.recordBounds(X,U,W,W);const {texcoords:V,offsets:Z}=P;this._writeQuad(D,F,G,H,{texcoords:V,offsets:Z,fontSize:J,haloSize:O,outlineSize:T,color:a.processColorInput(S.color),isBackground:!1,referenceBounds:L,minZoom:N,maxZoom:Q,...R});D.recordEnd()}0!==K&&I.setRotation(-K)}_writeTextBox(D,F,G,H,I,K,L){const R=this.evaluatedMeshParams,{fontSize:S,haloSize:W,outlineSize:J}=
this._textMeshTransformProps,{boxBackgroundColor:O,boxBorderLineColor:T}=R;K={isBackground:!0,fontSize:S,haloSize:W,outlineSize:J,referenceBounds:K,...L};O&&(this._writeQuad(D,F,G,H,{texcoords:w,offsets:I.main,color:a.processColorInput(O),...K}),T||(this._writeQuad(D,F,G,H,{texcoords:A,offsets:I.top,color:a.processColorInput(O),...K}),this._writeQuad(D,F,G,H,{texcoords:v,offsets:I.bot,color:a.processColorInput(O),...K}),this._writeQuad(D,F,G,H,{texcoords:x,offsets:I.left,color:a.processColorInput(O),
...K}),this._writeQuad(D,F,G,H,{texcoords:C,offsets:I.right,color:a.processColorInput(O),...K})));T&&(this._writeQuad(D,F,G,H,{texcoords:u,offsets:I.top,color:a.processColorInput(T),...K}),this._writeQuad(D,F,G,H,{texcoords:u,offsets:I.bot,color:a.processColorInput(T),...K}),this._writeQuad(D,F,G,H,{texcoords:y,offsets:I.left,color:a.processColorInput(T),...K}),this._writeQuad(D,F,G,H,{texcoords:y,offsets:I.right,color:a.processColorInput(T),...K}))}_writeQuad(D,F,G,H,I){const K=D.vertexCount();this._writeVertex(D,
F,G,H,I);D.indexWrite(K+0);D.indexWrite(K+1);D.indexWrite(K+2);D.indexWrite(K+1);D.indexWrite(K+3);D.indexWrite(K+2)}}l.TextMeshWriter=E;l.TextVertexSpec=B;l.maxLabelZoom=28;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/placements/CIMMarkerPlacementHelper":function(){define(["exports","../CIMOperators"],function(l,q){class n{static getPlacement(d,m,h,g,c,a){const b=q.getPlacementOperator(h);if(!b)return null;-1===m&&d.invertY();return b.execute(d,h,g,c,a)}}l.CIMMarkerPlacementHelper=
n;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/text/TextParams":function(){define(["exports","../../../../../../../symbols/cim/utils"],function(l,q){class n{constructor(d){const {offsetX:m,offsetY:h,postAngle:g,fontSize:c,haloSize:a,outlineSize:b,scaleFactor:k,transforms:e}=d;this.offsetX=m;this.offsetY=h;this.postAngle=g;this.fontSize=Math.min(c,96);this.haloSize=a??0;this.outlineSize=b??0;if((this.transforms=e)&&1<e.infos.length){d=
q.applyParentTransform(c,g,!1,m,h,e,!1);this.fontSize=Math.min(d.size,96);const r=d.size/c;this.haloSize*=r;this.outlineSize*=r;this.postAngle=d.rotation;this.offsetX=d.offsetX;this.offsetY=d.offsetY}k&&(this.fontSize*=k,this.offsetX*=k,this.offsetY*=k)}}l.TextMeshTransformProps=n;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/line/TexturedLineMeshWriter":function(){define("exports ../../../../../../../core/screenUtils ../../../../../../../geometry/GeometryCursor ../../../../../../../symbols/cim/enums ../../../definitions ../fill/meshWriterUtils ./LineMeshWriter ../shaders/constants ../../../../../../webgl/enums".split(" "),
function(l,q,n,d,m,h,g,c,a){const b={createComputedParams:e=>e,optionalAttributes:g.LineVertexSpec.optionalAttributes,attributes:{...g.LineVertexSpec.attributes,bitset:{type:a.DataType.UNSIGNED_BYTE,count:1,pack:({shouldSampleAlphaOnly:e,shouldScaleDash:r,isSDF:f})=>h.packBitset([[c.bitsetGenericConsiderAlphaOnly,e],[c.bitsetLineScaleDash,r],[c.bitsetLineIsSdf,f]])},tlbr:{type:a.DataType.UNSIGNED_SHORT,count:4,pack:({sprite:e})=>{const {rect:r,width:f,height:p}=e;e=r.x+m.spritePadding;const t=r.y+
m.spritePadding;return[e,t,e+f,t+p]}},accumulatedDistance:{type:a.DataType.UNSIGNED_SHORT,count:1,packTessellation:({distance:e})=>e},segmentDirection:{type:a.DataType.BYTE,count:2,packPrecisionFactor:16,packTessellation:({directionX:e,directionY:r})=>[e,r]},offsetAlongLine:{type:a.DataType.HALF_FLOAT,count:1,pack:({offsetAlongLine:e})=>q.pt2px(e)},capType:{type:a.DataType.UNSIGNED_BYTE,count:1,pack:({capType:e})=>{switch(e){case d.LineCapStyle.Butt:case "butt":return 0;case d.LineCapStyle.Square:case "square":return 1;
case d.LineCapStyle.Round:case "round":return 2;default:return 0}}}}};class k extends g.LineMeshWriter{constructor(e,r,f,p){super(e,r,f,p);this.vertexSpec=b;this._tessellationOptions.textured=!0}_write(e,r,f){if(f=f??n.GeometryCursor.fromFeatureSetReaderCIM(r)){var {sprite:p}=this.evaluatedMeshParams;this._writeGeometry(e,r,f,p?.textureBinding)}}}l.TexturedLineMeshWriter=k;l.texturedLineVertexSpec=b;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/markers/MarkerMeshWriter":function(){define("exports ../../../../../../../core/screenUtils ../../../../../../../core/libs/gl-matrix-2/math/mat2d ../../../../../../../core/libs/gl-matrix-2/factories/mat2df32 ../../../../../../../core/libs/gl-matrix-2/math/vec2 ../../../../../../../geometry/GeometryCursor ../../../../../../../symbols/cim/constants ../../../../../../../symbols/cim/enums ../../../../../../../symbols/cim/placements/CIMMarkerPlacementHelper ../../../definitions ../fill/meshWriterUtils ./ComputedMarkerParams ./markerConstants ../mesh/loadGeometryEngine ../mesh/MeshWriter ../../../../../../webgl/enums".split(" "),
function(l,q,n,d,m,h,g,c,a,b,k,e,r,f,p,t){function w(v,x,C,B,E=!1){v=d.create();E=E?1:-1;n.identity(v);(x||C)&&n.translate(v,v,[x,-C]);B&&n.rotate(v,v,E*z*-B);return v}const z=3.14159265359/180,u=128/Math.PI,y={createComputedParams:v=>e.ComputedMarkerParams.from(v),optionalAttributes:{zoomRange:{type:t.DataType.SHORT,count:2,packPrecisionFactor:b.minMaxZoomPrecisionFactor,pack:({scaleInfo:v},{tileInfo:x})=>k.getMinMaxZoom(v,x)}},attributes:{pos:{type:t.DataType.SHORT,count:2,pack:"position",packPrecisionFactor:10},
id:{type:t.DataType.UNSIGNED_BYTE,count:3,pack:"id"},bitset:{type:t.DataType.UNSIGNED_BYTE,count:1,pack:({sprite:v,alignment:x,scaleSymbolsProportionally:C,overrideOutlineColor:B,colorLocked:E})=>{let D=0;v.sdf&&(D|=k.getBitMask(r.MarkerConstants.bitset.isSDF));x===c.Alignment.MAP&&(D|=k.getBitMask(r.MarkerConstants.bitset.isMapAligned));C&&(D|=k.getBitMask(r.MarkerConstants.bitset.scaleSymbolsProportionally));B&&(D|=k.getBitMask(r.MarkerConstants.bitset.overrideOutlineColor));E&&(D|=k.getBitMask(r.MarkerConstants.bitset.colorLocked));
return D}},offset:{type:t.DataType.SHORT,count:2,packPrecisionFactor:4,packAlternating:{count:4,pack:({angle:v,computedWidth:x,computedHeight:C,anchorX:B,anchorY:E,offsetX:D,offsetY:F,rotateClockwise:G})=>{v=w(0,D,F,-v,G);B=-(.5+B)*x;G=-(.5-E)*C;E=[B,G];D=[B+x,G];F=[B,G+C];x=[B+x,G+C];m.transformMat2d(E,E,v);m.transformMat2d(D,D,v);m.transformMat2d(F,F,v);m.transformMat2d(x,x,v);return[E,D,F,x]}}},textureUV:{type:t.DataType.SHORT,count:2,packPrecisionFactor:4,packAlternating:{count:4,pack:({texXmax:v,
texXmin:x,texYmax:C,texYmin:B})=>[[x,B],[v,B],[x,C],[v,C]]}},color:{type:t.DataType.UNSIGNED_BYTE,count:4,normalized:!0,pack:({color:v})=>k.processColorInput(v)},outlineColor:{type:t.DataType.UNSIGNED_BYTE,count:4,normalized:!0,pack:({outlineColor:v})=>k.processColorInput(v)},sizing:{type:t.DataType.UNSIGNED_BYTE,count:4,pack:({rawWidth:v,rawHeight:x,outlineSize:C,referenceSize:B})=>[k.packByteSqrt(Math.max(v,x),128),k.packByteSqrt(C,128),k.packByteSqrt(B,128),0]},placementAngle:{type:t.DataType.UNSIGNED_BYTE,
count:1,packTessellation:({placementAngle:v})=>{v*=u;v%=256;return Math.abs(0<=v?v:v+256)}},sdfDecodeCoeff:{type:t.DataType.UNSIGNED_SHORT,count:1,packPrecisionFactor:64,pack:({sdfDecodeCoeff:v})=>v}}};class A extends p.MeshWriter{constructor(){super(...arguments);this.vertexSpec=y}getBoundsInfo(){return this.evaluatedMeshParams.boundsInfo}_write(v,x,C){var B=this.evaluatedMeshParams.sprite?.textureBinding;const E=x.getDisplayId();v.recordStart(this.instanceId,this.attributeLayout,B);B=this.evaluatedMeshParams.minPixelBuffer;
const D=Math.max(this.evaluatedMeshParams.computedWidth,B),F=Math.max(this.evaluatedMeshParams.computedHeight,B),G=this.evaluatedMeshParams.offsetX+-this.evaluatedMeshParams.anchorX*this.evaluatedMeshParams.computedWidth,H=-this.evaluatedMeshParams.offsetY+this.evaluatedMeshParams.anchorY*this.evaluatedMeshParams.computedHeight;if(null!=this.evaluatedMeshParams.placement)this._writePlacedMarkers(v,x,C,D,F);else if(C?.nextPath())C.nextPoint(),x=C.x,C=C.y,v.recordBounds(x+G,C+H,D,F),this._writeQuad(v,
E,x,C);else if("esriGeometryPolygon"===x.geometryType){x=x.readCentroidForDisplay();if(!x)return;const [I,K]=x.coords;v.recordBounds(I+G,K+H,D,F);this._writeQuad(v,E,I,K)}else"esriGeometryPoint"===x.geometryType?(C=x.readXForDisplay(),x=x.readYForDisplay(),v.recordBounds(C+G,x+H,D,F),this._writeQuad(v,E,C,x)):x.readGeometryForDisplay()?.forEachVertex((I,K)=>{v.recordBounds(I+G,K+H,D,F);Math.abs(I)>g.maxTileCoordValue||Math.abs(K)>g.maxTileCoordValue||this._writeQuad(v,E,I,K)});v.recordEnd()}_writePlacedMarkers(v,
x,C,B,E){if(C=C??h.GeometryCursor.fromFeatureSetReaderCIM(x)?.clone())if(C=a.CIMMarkerPlacementHelper.getPlacement(C,-1,this.evaluatedMeshParams.placement,q.pt2px(1),v.id,f.getGeometryEngine())){x=x.getDisplayId();for(var D=C.next(),F=this.evaluatedMeshParams.offsetX,G=-this.evaluatedMeshParams.offsetY;null!=D;){const H=D.tx,I=-D.ty;Math.abs(H)>g.maxTileCoordValue||Math.abs(I)>g.maxTileCoordValue?D=C.next():(D=-D.getAngle(),v.recordBounds(H+F,I+G,B,E),this._writeQuad(v,x,H,I,D),D=C.next())}}}_writeQuad(v,
x,C,B,E){const D=v.vertexCount();this._writeVertex(v,x,C,B,null==E?null:{placementAngle:E});v.indexWrite(D+0);v.indexWrite(D+1);v.indexWrite(D+2);v.indexWrite(D+1);v.indexWrite(D+3);v.indexWrite(D+2)}}l.MarkerMeshWriter=A;l.MarkerVertexSpec=y;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/markers/ComputedMarkerParams":function(){define(["exports","../../../../../../../core/screenUtils","../../../../../../../symbols/cim/enums","../../../../../../../symbols/cim/utils",
"../../../definitions"],function(l,q,n,d,m){class h{static from(g){return"width"in g?this.fromSimpleMeshParams(g):this.fromComplexMeshParams(g)}static fromSimpleMeshParams(g){const c=new h(g.sprite,g.color,g.outlineColor,g.minPixelBuffer,g.placement,g.scaleInfo,g.effects),{type:a,width:b,height:k,angle:e,alignment:r,outlineSize:f,referenceSize:p,sprite:t,overrideOutlineColor:w}=g;c.rawWidth=q.pt2px(b);c.rawHeight=q.pt2px(k);c.angle=e;c.alignment=r;c.outlineSize=q.pt2px(f);c.referenceSize=q.pt2px(p);
c.overrideOutlineColor=w;c.offsetX=q.pt2px(g.offsetX);c.offsetY=q.pt2px(g.offsetY);"simple"!==a||t.sdf||(c.rawWidth=t.width,c.rawHeight=t.height);c._computeSize(g,!1);return c}static fromComplexMeshParams(g){const c=new h(g.sprite,g.color,g.outlineColor,g.minPixelBuffer,g.placement,g.scaleInfo,g.effects);let {alignment:a,transforms:b,size:k,scaleX:e,anchorX:r,anchorY:f,angle:p,colorLocked:t,frameHeight:w,widthRatio:z,offsetX:u,offsetY:y,outlineSize:A,referenceSize:v,scaleFactor:x,sizeRatio:C,isAbsoluteAnchorPoint:B,
rotateClockwise:E,scaleSymbolsProportionally:D,sprite:F}=g;if(b&&0<b.infos.length){var G=d.applyParentTransform(k,p,E,u,y,b);k=G.size;p=G.rotation;u=G.offsetX;y=G.offsetY;E=!1}x&&(k*=x,u*=x,y*=x);G=F.width/F.height*e;c.alignment=a;c.rawHeight=q.pt2px(k);c.rawWidth=c.rawHeight*G;c.referenceSize=q.pt2px(v);c.sizeRatio=C;c.sdfDecodeCoeff=(F.sdfDecodeCoeff??1)*C;c.angle=p;c.rotateClockwise=E;c.anchorX=r;c.anchorY=f;c.offsetX=q.pt2px(u);c.offsetY=q.pt2px(y);B&&k&&(c.anchorX=F.sdf?r/(k*z):r/(k*G),c.anchorY=
f/k);G=D&&w?k/w:1;c.outlineSize=0===A||isNaN(A)?0:q.pt2px(A)*G;c.scaleSymbolsProportionally=D;c.colorLocked=t;c._computeSize(g,!0);return c}constructor(g,c,a,b,k,e,r){this.sprite=g;this.color=c;this.outlineColor=a;this.minPixelBuffer=b;this.placement=k;this.scaleInfo=e;this.effects=r;this.referenceSize=this.outlineSize=this.angle=this.rawHeight=this.rawWidth=0;this.sdfDecodeCoeff=this.sizeRatio=1;this.alignment=n.Alignment.SCREEN;this.colorLocked=this.overrideOutlineColor=this.scaleSymbolsProportionally=
!1;this.offsetY=this.offsetX=this.texYmax=this.texXmax=this.texYmin=this.texXmin=this.computedHeight=this.computedWidth=this.anchorY=this.anchorX=0;this.rotateClockwise=!0}get boundsInfo(){return{size:Math.max(this.computedHeight,this.computedWidth),offsetX:this.offsetX,offsetY:this.offsetY}}_computeSize(g,c){const {sprite:a,hasSizeVV:b}=g;var k=!!a.sdf;g=a.sdfPaddingRatio??.5;const {rawWidth:e,rawHeight:r,sizeRatio:f,outlineSize:p}=this;var t=f*(k?1/(1-g):1);g=e*t;t*=r;if(k&&!b){var w=p+2;this.computedWidth=
Math.min((c&&e>r?g:e)+w,g);this.computedHeight=Math.min(r+w,t)}else this.computedWidth=g,this.computedHeight=t;c=k?Math.max(a.width,a.height)/Math.max(g,t):1;w=.5*(g-this.computedWidth)*c;var z=.5*(t-this.computedHeight)*c;c=a.rect.x+m.spritePadding+w;k=a.rect.y+m.spritePadding+z;w=c+a.width-2*w;z=k+a.height-2*z;this.texXmin=Math.floor(c);this.texYmin=Math.floor(k);this.texXmax=Math.ceil(w);this.texYmax=Math.ceil(z);this.computedWidth*=(this.texXmax-this.texXmin)/(w-c);this.computedHeight*=(this.texYmax-
this.texYmin)/(z-k);this.anchorX*=g/this.computedWidth;this.anchorY*=t/this.computedHeight}}l.ComputedMarkerParams=h;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/mesh/MeshWriterInputEvaluator":function(){define("exports ../../../../../../../core/arrayUtils ../../../../../../../core/Error ../../../../../../../core/lang ../../../../../../../core/Logger ../../../grouping ../../../animations/infos ../../../animations/utils ./utils ../../../../../layers/features/support/DictionaryValue".split(" "),
function(l,q,n,d,m,h,g,c,a,b){async function k(t,w,z=!1){const {defaultValue:u,valueExpressionInfo:y,value:A}=w;if(y){const {expression:v}=y;return(t=await t.createComputedField({expression:v},z))?{...w,computed:t,defaultValue:u}:null}return{...w,computed:new b.DictionaryValue(A),defaultValue:u}}async function e(t,w){var {valueExpressionInfo:z}=w;({expression:z}=z);return(t=await t.createComputedField({expression:z}))?{...w,computed:t}:null}function r(t){return"object"!==typeof t||null==t?!1:"valueExpressionInfo"in
t&&t.valueExpressionInfo||"type"in t&&"Process"===t.type&&"op"in t&&"Random"===t.op?!0:!1}function f(t){if(Array.isArray(t))for(const w of t)if(f(w))return!0;if("object"===typeof t){if(r(t))return!0;for(const w in t)if(f(t[w]))return!0}return!1}class p{static async create(t,w,z){const u={},y=new Map,A=new Map,v=new Map,x=new Map,C=new Map,B=new Map;for(const D in z){const F=z[D];if(null==F||"object"!==typeof F)u[D]=F;else if(Array.isArray(F)){if("object"===typeof F[0])throw Error(`InternalError: Cannot handle ${D}. Nested array params are not supported`);
u[D]=F}else if("valueExpressionInfo"in F)if(F.value)u[D]=F.value;else{var E=await e(t,F);E?(y.set(D,E),u[D]=null):u[D]=F.defaultValue}else switch(F.type){case "cim-effect-infos":if(F.effectInfos.some(G=>G.overrides.length)){A.set(D,{effects:await Promise.all(F.effectInfos.map(async G=>{const H=G.overrides.map(I=>k(t,I));return{effect:G.effect,compiledOverrides:(await Promise.all(H)).filter(q.isSome)}}))});break}u[D]=F.effectInfos.map(G=>G.effect);break;case "cim-marker-placement-param":F.overrides.length&&
v.set(D,{placementInfo:F,compiledOverrides:(await Promise.all(F.overrides.map(G=>k(t,G)))).filter(q.isSome)});u[D]=F.placement;break;case "text-rasterization-param":if(F.overrides.length){E=F.overrides.map(G=>k(t,G,F.useLegacyLabelEvaluationRules));x.set(D,{compiledOverrides:(await Promise.all(E)).filter(q.isSome),rasterizationParam:F,objectIdToResourceId:new Map});continue}u[D]=await w.fetchResourceImmediate({type:"cim-rasterization-info",resource:F.resource})??null;break;case "sprite-rasterization-param":if(F.overrides.length){E=
F.overrides.map(G=>k(t,G));x.set(D,{compiledOverrides:(await Promise.all(E)).filter(q.isSome),rasterizationParam:F,objectIdToResourceId:new Map});continue}if("animated"===F.resource.type){x.set(D,{compiledOverrides:[],rasterizationParam:F,objectIdToResourceId:new Map});continue}u[D]=await w.fetchResourceImmediate({type:"cim-rasterization-info",resource:F.resource})??null;break;case "cim-marker-transform-param":({params:E}=F);if(f(E)){const G={compiledMarkerInfos:[]};await Promise.all(E.map(async H=>
{const I={props:{}};for(const K in H)if(r(H[K])){const L=await e(t,H[K]);I.compiledExpressionMap||(I.compiledExpressionMap=new Map);const R=I.compiledExpressionMap;L&&R.set(K,L)}else I.props[K]=H[K];G.compiledMarkerInfos.push(I)}));C.set(D,G)}else u[D]={type:"cim-marker-transform-info",infos:E};break;case "animation-params":({params:E}=F);E=c.createParamList(E);f(E)?(E=await Promise.all(E.map(G=>c.compileAnimationParam(G,t))),B.set(D,{params:E,propertyIdToResourceId:new Map,key:D})):(E=c.fromJSON(E),
E=await w.fetchResourceImmediate({type:"animation-info",resource:E}),null!=E&&"sprite"===E.type&&(u[D]={dataRow:E.rect.y,dataColumn:E.rect.x}));break;default:u[D]=F}}return new p(z,u,y,A,v,x,C,B)}constructor(t,w,z,u,y,A,v,x){this.inputMeshParams=t;this._resolvedMeshParams=w;this._dynamicProperties=z;this._dynamicEffectProperties=u;this._dynamicPlacementProperties=y;this._dynamicAsyncProperties=A;this._dynamicTransformProperties=v;this._dynamicAsyncAnimations=x;this.evaluator=C=>C}get hasDynamicProperties(){return!!(this._dynamicProperties.size||
this._dynamicAsyncProperties.size||this._dynamicEffectProperties.size||this._dynamicTransformProperties.size||this._dynamicPlacementProperties.size||this._dynamicAsyncAnimations.size)}get evaluatedMeshParams(){this._evaluatedMeshParams||(this._evaluatedMeshParams=this.evaluator(this._resolvedMeshParams));return this._evaluatedMeshParams}enqueueRequest(t,w,z){for(var u of this._dynamicAsyncProperties.values()){var y=d.clone(u.rasterizationParam.resource);"animated"===u.rasterizationParam.resource.type&&
u.rasterizationParam.resource.randomizeStartTime&&(y.primitiveName="__RESERVED__PRIMITIVE__NAME__",y.startGroup=h.getStartGroup(w.getObjectId()||0));for(const {primitiveName:A,propertyName:v,computed:x,defaultValue:C,valueExpressionInfo:B}of u.compiledOverrides)try{a.applyComputedValue(y,"animated"===u.rasterizationParam.resource.type?y.primitiveName:A,v,x,w,z,C)}catch(E){m.getLogger("esri.views.2d.engine.webgl.shaderGraph.techniques.mesh.MeshWriterInputEvaluator").errorOnce(new n("invalid-arcade-expression",
`Encountered an error when evaluating the arcade expression '${B?.expression}' (primitive: '${A}', property: '${v}')`,E))}y=t.enqueueRequest({type:"cim-rasterization-info",resource:y});u.objectIdToResourceId.set(w.getObjectId(),y)}for(const A of this._dynamicAsyncAnimations.values())u=A.params.map(v=>c.resolveToAnimationInfo(v,w,z)).map(g.hydrate).map(v=>v.simplify()),u=c.encodeParamList(u),u=t.enqueueRequest({type:"animation-info",resource:u}),A.propertyIdToResourceId.set(w.getObjectId()+"."+A.key,
u)}evaluateMeshParams(t,w,z){for(const [A,v]of this._dynamicProperties.entries())this._resolvedMeshParams[A]=v.computed.readWithDefault(w,z,v.defaultValue);for(const [A,v]of this._dynamicPlacementProperties.entries())for(const {computed:x,defaultValue:C,propertyName:B}of v.compiledOverrides){var u=x.readWithDefault(w,z,C);v.placementInfo.placement[B]=u;this._resolvedMeshParams[A]=v.placementInfo.placement}for(const [A,v]of this._dynamicEffectProperties.entries())for(var y of v.effects){for(const {computed:x,
defaultValue:C,propertyName:B}of y.compiledOverrides)u=x.readWithDefault(w,z,C),y.effect[B]=u;this._resolvedMeshParams[A]=v.effects.map(x=>x.effect)}for(const [A,v]of this._dynamicTransformProperties.entries()){y={type:"cim-marker-transform-info",infos:[]};for(const x of v.compiledMarkerInfos){u={...x.props};if(x.compiledExpressionMap)for(const [C,B]of x.compiledExpressionMap){const E=B.computed.readWithDefault(w,z,B.defaultValue);u[C]="number"===typeof E||"boolean"===typeof E?E:B.defaultValue}y.infos.push(u)}this._resolvedMeshParams[A]=
y}for(const [A,v]of this._dynamicAsyncProperties.entries())z=v.objectIdToResourceId.get(w.getObjectId()),null!=z&&(z=t.getResource(z),this._resolvedMeshParams[A]=z);for(const [A,v]of this._dynamicAsyncAnimations.entries())z=v.propertyIdToResourceId.get(w.getObjectId()+"."+A),null!=z&&(z=t.getResource(z),this._resolvedMeshParams[A]={dataRow:z.rect.y,dataColumn:z.rect.x});this._evaluatedMeshParams=this.evaluator(this._resolvedMeshParams);return this.evaluatedMeshParams}}l.MeshWriterInputEvaluator=p;
l.hasExpression=r;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/animations/infos":function(){define(["exports","./instructions"],function(l,q){function n(a){return a instanceof d?a:"object"===typeof a&&"type"in a?c[a.type].hydrate(a):new m(a)}class d{constructor(a){this.inputs=a}encode(){const a=[];for(const b of this.inputs)a.push(...b.encode());a.push(...this.instructions);return a}}class m extends d{constructor(a){super([]);this.value=a}simplify(){return this}get instructions(){if(Array.isArray(this.value)){const [a,
b,k,e]=this.value;return null!=e?q.instructions.vector4.encode([a,b||0,k||0,e]):q.instructions.vector3.encode([a,b||0,k||0])}return q.instructions.scalar.encode(this.value)}}class h extends d{constructor(a,b){super([b]);this._config=a;this._parent=b}static hydrate(a){return new h(a,n(a.parent))}simplify(){if(this._config.relativeTranslation||this._config.absoluteScale)return this;var a=this._parent.simplify();if(!(a instanceof m))return this;const [b,k,e,r]=a.value,f=this._config.translation.from[0],
p=this._config.translation.from[1],t=this._config.rotation.from,w=this._config.scale.from;if(f===this._config.translation.to[0]&&p===this._config.translation.to[1]&&t===this._config.rotation.to&&w===this._config.scale.to){a=Math.sin(e);const z=Math.cos(e);return new m([z*r*f-a*r*p+b,a*r*f+z*r*p+k,e+t,r*w])}return new h(this._config,a)}get instructions(){return q.instructions.animatedTransform.encode(this._config)}}class g extends d{constructor(a,b){super([b]);this._config=a;this._parent=b}static hydrate(a){return new g(a,
n(a.parent))}simplify(){const a=this._parent.simplify();if(!(a instanceof m))return this;const [b,k,e,r]=a.value,f=this._config.color.from[0],p=this._config.color.from[1],t=this._config.color.from[2];let w=this._config.color.from[3];const z=this._config.opacity.from;return f===this._config.color.to[0]&&p===this._config.color.to[1]&&t===this._config.color.to[2]&&w===this._config.color.to[3]&&z===this._config.opacity.to?new m([b*f,k*p,e*t,r*w*z]):new g(this._config,a)}get instructions(){return q.instructions.animatedColor.encode(this._config)}}
const c={AnimatedTransform:h,AnimatedColor:g};l.AAnimationInfo=d;l.AnimatedColor=g;l.AnimatedTransform=h;l.Constant=m;l.hydrate=n;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/animations/utils":function(){define(["exports","../../../../../Color","../grouping","./infos","./instructions"],function(l,q,n,d,m){function h(b){const k=[],e=[];let r=0;for(const f of b){const p=[...f.encode(),...m.instructions.ret.encode()];k.push([r+b.length,0,0,0]);e.push(...p);
r+=p.length}return[...k,...e]}async function g(b,k){if("number"===typeof b||"string"===typeof b||"boolean"===typeof b)var e=b;else if(Array.isArray(b))e=await Promise.all(b.map(r=>g(r,k)));else if("object"===typeof b)if("valueExpressionInfo"in b)({valueExpressionInfo:e}=b),{expression:e}=e,e={...b,computed:await k.createComputedField({expression:e})};else{e={};for(const r in b)e[r]=await g(b[r],k)}return e}function c(b,k,e){function r(w){if(!("computed"in w))return w;w=w.computed.readWithDefault(k,
e,[255*w.defaultValue[0],255*w.defaultValue[1],255*w.defaultValue[2],w.defaultValue[3]]);if("string"===typeof w){const z=q.fromString(w);z&&(w=[z.r,z.g,z.b,z.a])}return w}if("number"===typeof b||"string"===typeof b||"boolean"===typeof b)var f=b;else if(Array.isArray(b))f=b.map(w=>c(w,k,e));else if("object"===typeof b)if("type"in b&&null!=b.type&&"Process"===b.type)switch(b.op){case "ArcadeColor":b=c(b.value,k,e);a(Array.isArray(b)&&4===b.length);f=[b[0]/255,b[1]/255,b[2]/255,b[3]];break;case "Transparency":b=
c(b.value,k,e);a("number"===typeof b);f=1-b/100;break;case "Divide":f=c(b.left,k,e);a("number"===typeof f);b=c(b.right,k,e);a("number"===typeof b);f/=b;break;case "Random":f=c(b.seed,k,e);var p=c(b.min,k,e);b=c(b.max,k,e);var t=k.getObjectId();t=n.getStartGroup(t||0);f=p+n.getRandomValue(t,f)*(b-p)}else if("computed"in b)f=r(b);else for(p in f={},b)f[p]=c(b[p],k,e);return f}function a(b){if(!b)throw Error("Assertion failed.");}l.assert=a;l.compileAnimationParam=g;l.createParamList=function(b){const k=
[];k.push(b.transform);k.push(b.fromColor);k.push(b.toColor);k.push(b.colorMix);k.push(b.toOpacity);k.push(b.opacityMix);return k};l.encodeParamList=h;l.fromJSON=function(b){b=b.map(k=>c(k)).map(k=>d.hydrate(k).simplify());return h(b)};l.resolveToAnimationInfo=c;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/support/DictionaryValue":function(){define(["exports","./AComputedField"],function(l,q){class n extends q.AComputedField{constructor(d){super();
this._value=d}resize(d){}read(d,m){return this._value}readWithDefault(d,m,h){return this._value}referencesScale(){return!1}referencesGeometry(){return!1}}l.DictionaryValue=n;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/support/AComputedField":function(){define(["exports"],function(l){class q{destroy(){}}l.AComputedField=q;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/pieChart/PieChartMeshWriter":function(){define(["exports",
"../../../../../../../core/screenUtils","../fill/meshWriterUtils","../mesh/MeshWriter","../../../../../../webgl/enums"],function(l,q,n,d,m){const h={createComputedParams:c=>c,optionalAttributes:{},attributes:{pos:{type:m.DataType.SHORT,count:2,packPrecisionFactor:10,pack:"position"},id:{type:m.DataType.UNSIGNED_BYTE,count:3,pack:"id"},bitset:{type:m.DataType.UNSIGNED_BYTE,count:1,pack:c=>0},offset:{type:m.DataType.SHORT,count:2,packPrecisionFactor:16,packAlternating:{count:4,pack:({size:c})=>{c=q.pt2px(c);
const a=-c/2,b=-c/2;return[[a,b],[a+c,b],[a,b+c],[a+c,b+c]]}}},texCoords:{type:m.DataType.SHORT,count:2,packPrecisionFactor:4,packAlternating:{count:4,pack:()=>[[0,1],[1,1],[0,0],[1,0]]}},size:{type:m.DataType.UNSIGNED_BYTE,count:2,pack:({size:c})=>[c,c]},referenceSize:{type:m.DataType.UNSIGNED_BYTE,count:1,pack:({size:c})=>q.pt2px(c)},zoomRange:{type:m.DataType.UNSIGNED_BYTE,count:2,pack:({scaleInfo:c},{tileInfo:a})=>n.getMinMaxZoom(c,a)}}};class g extends d.MeshWriter{constructor(){super(...arguments);
this.vertexSpec=h}_write(c,a){const b=a.getDisplayId();var k=this.evaluatedMeshParams.minPixelBuffer,e=Math.max(q.pt2px(this.evaluatedMeshParams.size),k);if("esriGeometryPoint"===a.geometryType)k=a.readXForDisplay(),a=a.readYForDisplay();else{a=a.readCentroidForDisplay();if(!a)return;k=a?.coords[0];a=a?.coords[1]}c.recordStart(this.instanceId,this.attributeLayout);c.recordBounds(k,a,e,e);e=c.vertexCount();this._writeVertex(c,b,k,a);c.indexWrite(e+0);c.indexWrite(e+1);c.indexWrite(e+2);c.indexWrite(e+
1);c.indexWrite(e+3);c.indexWrite(e+2);c.recordEnd()}}l.PieChartMeshWriter=g;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/RenderingContext":function(){define("exports ../../core/has ../../core/maybe ../../core/promiseUtils ../../core/time ./checkWebGLError ./ContextState ./enums ./InstanceCounter ./Parameters ./ProgramCache ./renderState ./Texture ./Util ./WebGLDriverTest ./capabilities/Capabilities".split(" "),function(l,q,n,d,m,h,g,c,a,b,k,e,r,f,p,t){function w(u,
y,A,v){y?v!==y&&u.bindBuffer(A,y.glName):u.bindBuffer(A,null);return y}function z(u,y){switch(u){case c.PrimitiveType.POINTS:return 2*y;case c.PrimitiveType.TRIANGLES:return y/3;case c.PrimitiveType.TRIANGLE_STRIP:return y-2;case c.PrimitiveType.TRIANGLE_FAN:return y-2;default:return 0}}l.RenderingContext=class{constructor(u,y){this.gl=u;this.instanceCounter=new a.InstanceCounter;this.programCache=new k.ProgramCache(this);this._transformFeedbackRequestInfo=null;this._state=new g.ContextState;this._numOfTriangles=
this._numOfDrawCalls=0;this._loadExtensions();this.configure(y)}configure(u){this._capabilities=new t.Capabilities(this.gl,u);this._parameters=new b.Parameters(this.gl,this._capabilities,u);r.Texture.TEXTURE_UNIT_FOR_UPDATES=this._parameters.maxTextureImageUnits-1;u=this.gl.getParameter(this.gl.VIEWPORT);this._state=new g.ContextState;this._state.viewport={x:u[0],y:u[1],width:u[2],height:u[3]};this._stateTracker=new e.StateTracker({setBlending:y=>{y?(this.setBlendingEnabled(!0),this.setBlendEquationSeparate(y.opRgb,
y.opAlpha),this.setBlendFunctionSeparate(y.srcRgb,y.dstRgb,y.srcAlpha,y.dstAlpha),y=y.color,this.setBlendColor(y.r,y.g,y.b,y.a)):this.setBlendingEnabled(!1)},setCulling:y=>{y?(this.setFaceCullingEnabled(!0),this.setCullFace(y.face),this.setFrontFace(y.mode)):this.setFaceCullingEnabled(!1)},setPolygonOffset:y=>{y?(this.setPolygonOffsetFillEnabled(!0),this.setPolygonOffset(y.factor,y.units)):this.setPolygonOffsetFillEnabled(!1)},setDepthTest:y=>{y?(this.setDepthTestEnabled(!0),this.setDepthFunction(y.func)):
this.setDepthTestEnabled(!1)},setStencilTest:y=>{if(y){this.setStencilTestEnabled(!0);const A=y.function;this.setStencilFunction(A.func,A.ref,A.mask);y=y.operation;this.setStencilOp(y.fail,y.zFail,y.zPass)}else this.setStencilTestEnabled(!1)},setDepthWrite:y=>{y?(this.setDepthWriteEnabled(!0),this.setDepthRange(y.zNear,y.zFar)):this.setDepthWriteEnabled(!1)},setColorWrite:y=>{y?this.setColorMask(y.r,y.g,y.b,y.a):this.setColorMask(!1,!1,!1,!1)},setStencilWrite:y=>{y?this.setStencilWriteMask(y.mask):
this.setStencilWriteMask(0)},setDrawBuffers:y=>{y?this.setDrawBuffers(y.buffers):({drawFramebuffer:y}=this._state,null===y?this.setDrawBuffers([c.SpecialDrawBuffers.BACK]):0===y.colorAttachments.length?this.setDrawBuffers([c.SpecialDrawBuffers.NONE]):this.setDrawBuffers([c.ColorAttachment.COLOR_ATTACHMENT0]))}});this.enforceState();n.disposeMaybe(this._driverTest);this._driverTest=new p.WebGLDriverTest(this)}dispose(){n.disposeMaybe(this._driverTest);this.programCache.dispose();this.bindVAO(null);
this.unbindBuffer(c.BufferType.ARRAY_BUFFER);this.unbindBuffer(c.BufferType.ELEMENT_ARRAY_BUFFER);this.unbindBuffer(c.BufferType.UNIFORM_BUFFER);this._state.uniformBufferBindingPoints.length=0;this.unbindBuffer(c.BufferType.PIXEL_PACK_BUFFER);this.unbindBuffer(c.BufferType.PIXEL_UNPACK_BUFFER);this.unbindBuffer(c.BufferType.COPY_READ_BUFFER);this.unbindBuffer(c.BufferType.COPY_WRITE_BUFFER);this._state.textureUnitMap.length=0;h.webglDebugEnabled()&&console.log(this.instanceCounter.resourceInformation)}get driverTest(){return this._driverTest}get contextAttributes(){return this.gl.getContextAttributes()}get parameters(){return this._parameters}setPipelineState(u){this._stateTracker.setPipeline(u)}setBlendingEnabled(u){this._state.blend!==
u&&(!0===u?this.gl.enable(this.gl.BLEND):this.gl.disable(this.gl.BLEND),this._state.blend=u,this._stateTracker.invalidateBlending())}externalProgramUpdate(){this._state.program?.stop();this._state.program=null}externalTextureUnitUpdate(u,y){for(let A=0;A<u.length;++A)this._state.textureUnitMap[u[A]]=null;0<=y&&(this._state.activeTexture=y)}externalVertexArrayObjectUpdate(){this.gl.bindVertexArray(null);this._state.vertexArrayObject=null;this._state.vertexBuffer=null;this._state.indexBuffer=null}externalVertexBufferUpdate(){this._state.vertexBuffer=
null}externalIndexBufferUpdate(){this._state.indexBuffer=null}setBlendColor(u,y,A,v){if(u!==this._state.blendColor.r||y!==this._state.blendColor.g||A!==this._state.blendColor.b||v!==this._state.blendColor.a)this.gl.blendColor(u,y,A,v),this._state.blendColor.r=u,this._state.blendColor.g=y,this._state.blendColor.b=A,this._state.blendColor.a=v,this._stateTracker.invalidateBlending()}setBlendFunction(u,y){if(u!==this._state.blendFunction.srcRGB||y!==this._state.blendFunction.dstRGB)this.gl.blendFunc(u,
y),this._state.blendFunction.srcRGB=u,this._state.blendFunction.srcAlpha=u,this._state.blendFunction.dstRGB=y,this._state.blendFunction.dstAlpha=y,this._stateTracker.invalidateBlending()}setBlendFunctionSeparate(u,y,A,v){if(this._state.blendFunction.srcRGB!==u||this._state.blendFunction.srcAlpha!==A||this._state.blendFunction.dstRGB!==y||this._state.blendFunction.dstAlpha!==v)this.gl.blendFuncSeparate(u,y,A,v),this._state.blendFunction.srcRGB=u,this._state.blendFunction.srcAlpha=A,this._state.blendFunction.dstRGB=
y,this._state.blendFunction.dstAlpha=v,this._stateTracker.invalidateBlending()}setBlendEquation(u){this._state.blendEquation.mode!==u&&(this.gl.blendEquation(u),this._state.blendEquation.mode=u,this._state.blendEquation.modeAlpha=u,this._stateTracker.invalidateBlending())}setBlendEquationSeparate(u,y){if(this._state.blendEquation.mode!==u||this._state.blendEquation.modeAlpha!==y)this.gl.blendEquationSeparate(u,y),this._state.blendEquation.mode=u,this._state.blendEquation.modeAlpha=y,this._stateTracker.invalidateBlending()}setColorMask(u,
y,A,v){if(this._state.colorMask.r!==u||this._state.colorMask.g!==y||this._state.colorMask.b!==A||this._state.colorMask.a!==v)this.gl.colorMask(u,y,A,v),this._state.colorMask.r=u,this._state.colorMask.g=y,this._state.colorMask.b=A,this._state.colorMask.a=v,this._stateTracker.invalidateColorWrite()}setClearColor(u,y,A,v){if(this._state.clearColor.r!==u||this._state.clearColor.g!==y||this._state.clearColor.b!==A||this._state.clearColor.a!==v)this.gl.clearColor(u,y,A,v),this._state.clearColor.r=u,this._state.clearColor.g=
y,this._state.clearColor.b=A,this._state.clearColor.a=v}setFaceCullingEnabled(u){this._state.faceCulling!==u&&(!0===u?this.gl.enable(this.gl.CULL_FACE):this.gl.disable(this.gl.CULL_FACE),this._state.faceCulling=u,this._stateTracker.invalidateCulling())}setPolygonOffsetFillEnabled(u){this._state.polygonOffsetFill!==u&&(!0===u?this.gl.enable(this.gl.POLYGON_OFFSET_FILL):this.gl.disable(this.gl.POLYGON_OFFSET_FILL),this._state.polygonOffsetFill=u,this._stateTracker.invalidatePolygonOffset())}setPolygonOffset(u,
y){if(this._state.polygonOffset[0]!==u||this._state.polygonOffset[1]!==y)this._state.polygonOffset[0]=u,this._state.polygonOffset[1]=y,this.gl.polygonOffset(u,y),this._stateTracker.invalidatePolygonOffset()}setCullFace(u){this._state.cullFace!==u&&(this.gl.cullFace(u),this._state.cullFace=u,this._stateTracker.invalidateCulling())}setFrontFace(u){this._state.frontFace!==u&&(this.gl.frontFace(u),this._state.frontFace=u,this._stateTracker.invalidateCulling())}setScissorTestEnabled(u){this._state.scissorTest!==
u&&(!0===u?this.gl.enable(this.gl.SCISSOR_TEST):this.gl.disable(this.gl.SCISSOR_TEST),this._state.scissorTest=u)}setScissorRect(u,y,A,v){if(this._state.scissorRect.x!==u||this._state.scissorRect.y!==y||this._state.scissorRect.width!==A||this._state.scissorRect.height!==v)this.gl.scissor(u,y,A,v),this._state.scissorRect.x=u,this._state.scissorRect.y=y,this._state.scissorRect.width=A,this._state.scissorRect.height=v}setDepthTestEnabled(u){this._state.depthTest!==u&&(!0===u?this.gl.enable(this.gl.DEPTH_TEST):
this.gl.disable(this.gl.DEPTH_TEST),this._state.depthTest=u,this._stateTracker.invalidateDepthTest())}setClearDepth(u){this._state.clearDepth!==u&&(this.gl.clearDepth(u),this._state.clearDepth=u)}setDepthFunction(u){this._state.depthFunction!==u&&(this.gl.depthFunc(u),this._state.depthFunction=u,this._stateTracker.invalidateDepthTest())}setDepthWriteEnabled(u){this._state.depthWrite!==u&&(this.gl.depthMask(u),this._state.depthWrite=u,this._stateTracker.invalidateDepthWrite())}setDepthRange(u,y){if(this._state.depthRange.zNear!==
u||this._state.depthRange.zFar!==y)this.gl.depthRange(u,y),this._state.depthRange.zNear=u,this._state.depthRange.zFar=y,this._stateTracker.invalidateDepthWrite()}setStencilTestEnabled(u){this._state.stencilTest!==u&&(!0===u?this.gl.enable(this.gl.STENCIL_TEST):this.gl.disable(this.gl.STENCIL_TEST),this._state.stencilTest=u,this._stateTracker.invalidateStencilTest())}setClearStencil(u){u!==this._state.clearStencil&&(this.gl.clearStencil(u),this._state.clearStencil=u)}setStencilFunction(u,y,A){if(this._state.stencilFunction.func!==
u||this._state.stencilFunction.ref!==y||this._state.stencilFunction.mask!==A)this.gl.stencilFunc(u,y,A),this._state.stencilFunction.face=c.Face.FRONT_AND_BACK,this._state.stencilFunction.func=u,this._state.stencilFunction.ref=y,this._state.stencilFunction.mask=A,this._stateTracker.invalidateStencilTest()}setStencilFunctionSeparate(u,y,A,v){if(this._state.stencilFunction.face!==u||this._state.stencilFunction.func!==y||this._state.stencilFunction.ref!==A||this._state.stencilFunction.mask!==v)this.gl.stencilFuncSeparate(u,
y,A,v),this._state.stencilFunction.face=u,this._state.stencilFunction.func=y,this._state.stencilFunction.ref=A,this._state.stencilFunction.mask=v,this._stateTracker.invalidateStencilTest()}setStencilWriteMask(u){this._state.stencilWriteMask!==u&&(this.gl.stencilMask(u),this._state.stencilWriteMask=u,this._stateTracker.invalidateStencilWrite())}setStencilOp(u,y,A){if(this._state.stencilOperation.face!==c.Face.FRONT_AND_BACK||this._state.stencilOperation.fail!==u||this._state.stencilOperation.zFail!==
y||this._state.stencilOperation.zPass!==A)this.gl.stencilOp(u,y,A),this._state.stencilOperation.face=c.Face.FRONT_AND_BACK,this._state.stencilOperation.fail=u,this._state.stencilOperation.zFail=y,this._state.stencilOperation.zPass=A,this._stateTracker.invalidateStencilTest()}setStencilOpSeparate(u,y,A,v){if(this._state.stencilOperation.face!==u||this._state.stencilOperation.fail!==y||this._state.stencilOperation.zFail!==A||this._state.stencilOperation.zPass!==v)this.gl.stencilOpSeparate(u,y,A,v),
this._state.stencilOperation.face=u,this._state.stencilOperation.fail=y,this._state.stencilOperation.zFail=A,this._state.stencilOperation.zPass=v,this._stateTracker.invalidateStencilTest()}setActiveTexture(u,y=!1){const A=this._state.activeTexture;0<=u&&(y||u!==this._state.activeTexture)&&(this.gl.activeTexture(c.baseTextureUnit+u),this._state.activeTexture=u);return A}setDrawBuffers(u){const {drawFramebuffer:y}=this._state,A=null===y,v=A?this._state.drawBuffers.defaultFramebuffer:this._state.drawBuffers.fbos.get(y);
if(v?.length!==u.length||!v.every((x,C)=>x===u[C]))if(u.length>this.parameters.maxDrawBuffers)console.error("Setting more active draw buffers than GL.MAX_DRAW_BUFFERS allows.");else{if(A){if(1<u.length){console.error("The default framebuffer can only have one active draw buffer.");return}if(u[0]!==c.SpecialDrawBuffers.BACK&&u[0]!==c.SpecialDrawBuffers.NONE){console.error("The default framebuffer can only use the constants GL.BACK or GL.NONE as draw buffers.");return}}!A&&u.includes(c.SpecialDrawBuffers.BACK)?
console.error("A framebuffer object can only use the constants GL.COLOR_ATTACHMENTi or GL.NONE as draw buffers."):(this.gl.drawBuffers(u),A?this._state.drawBuffers.defaultFramebuffer=u:this._state.drawBuffers.fbos.set(y,u),this._stateTracker.invalidateDrawBuffers())}}clear(u,y=255){if(u){if(u&c.FramebufferBit.COLOR){const A=this._state.drawFramebuffer?.colorAttachments;A&&this.setDrawBuffers(A);this.setColorMask(!0,!0,!0,!0)}u&c.FramebufferBit.DEPTH&&this.setDepthWriteEnabled(!0);u&c.FramebufferBit.STENCIL&&
this.setStencilWriteMask(y);this.gl.clear(u)}}clearFramebuffer(u,y=!1,A=!1){let v=0;u&&(this.setClearColor(u[0],u[1],u[2],Math.max(1E-13,u[3])),v|=c.FramebufferBit.COLOR);y&&(v|=c.FramebufferBit.DEPTH);!1===A?A=0:(!0===A&&(A=255),v|=c.FramebufferBit.STENCIL);v&&this.clear(v,A)}drawArrays(u,y,A){if(this._transformFeedbackRequestInfo){if(u!==this._transformFeedbackRequestInfo.primitiveType)throw Error("DrawArrays called during transform feedback, but primitiveType does not match that of the current transform feedback request");
if(null==this._state.program?.hasTransformFeedbackVaryings)throw Error("DrawArrays called during transform feedback, but the shader program was not linked with a transform feedback varying");}if(h.webglDebugEnabled()){this._numOfDrawCalls++;this._numOfTriangles+=z(u,A);const v=this._state.textureUnitMap;for(let x=0;x<v.length;x++){const C=v[x];if(null!=C&&C===this._state.drawFramebuffer?.colorTexture)throw Error(`Detected readWrite. Texture already bound at index ${x}`);}}this.gl.drawArrays(u,y,A);
h.checkWebGLError(this.gl)}drawArraysInstanced(u,y,A,v){this.gl.drawArraysInstanced(u,y,A,v);h.checkWebGLError(this.gl)}drawElements(u,y,A,v){if(this._transformFeedbackRequestInfo)throw Error("Cannot called drawElements during a transform feedback request");h.webglDebugEnabled()&&(this._numOfDrawCalls++,this._numOfTriangles+=z(u,y));this.gl.drawElements(u,y,A,v);if(h.webglDebugEnabled()){const x=f.getErrorString(this);if(x){const C=this.getBoundVAO(),B=C?.indexBuffer,E=B?.size??0,D=v+y;console.error(`drawElements: ${x}${E<
D?`. Buffer is too small. Attempted to draw index ${D} of ${E}`:""}`,{args:{mode:u,count:y,type:A,offset:v},vao:{indexBuffer:B,vertexBuffers:C?.vertexBuffers}})}}}drawElementsInstanced(u,y,A,v,x){this.gl.drawElementsInstanced(u,y,A,v,x);h.checkWebGLError(this.gl)}logInfo(){h.webglDebugEnabled()&&console.log(`DrawCalls: ${this._numOfDrawCalls}, Triangles: ${this._numOfTriangles}`)}resetInfo(){h.webglDebugEnabled()&&(this._numOfTriangles=this._numOfDrawCalls=0)}get capabilities(){return this._capabilities}setViewport(u,
y,A,v){A=Math.max(Math.round(A),1);v=Math.max(Math.round(v),1);const x=this._state.viewport;if(x.x!==u||x.y!==y||x.width!==A||x.height!==v)x.x=u,x.y=y,x.width=A,x.height=v,this.gl.viewport(u,y,A,v)}setViewport4fv(u){this.setViewport(u[0],u[1],u[2],u[3])}restoreViewport({x:u,y,width:A,height:v}){this.setViewport(u,y,A,v)}getViewport(){const u=this._state.viewport;return{x:u.x,y:u.y,width:u.width,height:u.height}}useProgram(u){this._state.program!==u&&(this._state.program?.stop(),this._state.program=
u,this.gl.useProgram(u?.glName??null))}bindTexture(u,y,A=!1){(y>=this.parameters.maxTextureImageUnits||0>y)&&console.error("Input texture unit is out of range of available units!");const v=this._state.textureUnitMap[y];if(null==u?.glName)return null!=v&&(this.setActiveTexture(y,A),this.gl.bindTexture(v.descriptor.target,null)),this._state.textureUnitMap[y]=null,v;if(!A&&v===u)return u.isDirty&&(this.setActiveTexture(y,A),u.applyChanges()),v;this.setActiveTexture(y,A);this.gl.bindTexture(u.descriptor.target,
u.glName);u.applyChanges();this._state.textureUnitMap[y]=u;return v}unbindTexture(u){if(null!=u)for(let y=0;y<this.parameters.maxTextureImageUnits;y++)this._state.textureUnitMap[y]===u&&(this.bindTexture(null,y),this._state.textureUnitMap[y]=null)}bindFramebuffer(u,y=!1){if(y||this._state.readFramebuffer!==u||this._state.drawFramebuffer!==u)this._stateTracker.invalidateDrawBuffers(),null==u?(this.gl.bindFramebuffer(c.FramebufferTarget.FRAMEBUFFER,null),this._state.readFramebuffer=this._state.drawFramebuffer=
null):(u.initializeAndBind(c.FramebufferTarget.FRAMEBUFFER),this._state.readFramebuffer=u,this._state.drawFramebuffer=u)}bindFramebufferSeparate(u,y,A=!1){const v=y===c.FramebufferTarget.READ_FRAMEBUFFER,x=v?this._state.readFramebuffer:this._state.drawFramebuffer;if(A||x!==u)null==u?this.gl.bindFramebuffer(y,null):u.initializeAndBind(y),v?this._state.readFramebuffer=u??null:(this._stateTracker.invalidateDrawBuffers(),this._state.drawFramebuffer=u??null)}blitFramebuffer(u,y,A=0,v=0,x=u.width,C=u.height,
B=0,E=0,D=y.width,F=y.height,G=c.FramebufferBit.COLOR,H=c.TextureSamplingMode.NEAREST){this.bindFramebufferSeparate(u,c.FramebufferTarget.READ_FRAMEBUFFER);this.bindFramebufferSeparate(y,c.FramebufferTarget.DRAW_FRAMEBUFFER);this.gl.blitFramebuffer(A,v,x,C,B,E,D,F,G,H)}bindBuffer(u,y){if(u)switch(y??=u.bufferType,y){case c.BufferType.ARRAY_BUFFER:this._state.vertexBuffer=w(this.gl,u,y,this._state.vertexBuffer);break;case c.BufferType.ELEMENT_ARRAY_BUFFER:this._state.indexBuffer=w(this.gl,u,y,this._state.indexBuffer);
break;case c.BufferType.UNIFORM_BUFFER:this._state.uniformBuffer=w(this.gl,u,y,this._state.uniformBuffer);break;case c.BufferType.PIXEL_PACK_BUFFER:this._state.pixelPackBuffer=w(this.gl,u,y,this._state.pixelPackBuffer);break;case c.BufferType.PIXEL_UNPACK_BUFFER:this._state.pixelUnpackBuffer=w(this.gl,u,y,this._state.pixelUnpackBuffer);break;case c.BufferType.COPY_READ_BUFFER:this._state.copyReadBuffer=w(this.gl,u,y,this._state.copyReadBuffer);break;case c.BufferType.COPY_WRITE_BUFFER:this._state.copyWriteBuffer=
w(this.gl,u,y,this._state.copyWriteBuffer);break;case c.BufferType.TRANSFORM_FEEDBACK_BUFFER:this._state.transformFeedbackBuffer=w(this.gl,u,y,this._state.transformFeedbackBuffer)}}bindRenderbuffer(u){const y=this.gl;u||(y.bindRenderbuffer(y.RENDERBUFFER,null),this._state.renderbuffer=null);this._state.renderbuffer!==u&&(y.bindRenderbuffer(y.RENDERBUFFER,u.glName),this._state.renderbuffer=u)}_getBufferBinding(u,y){if(y>=this.parameters.maxUniformBufferBindings||0>y)return console.error("Uniform buffer binding point is out of range!"),
null;u=u===c.BufferType.UNIFORM_BUFFER?this._state.uniformBufferBindingPoints:this._state.transformBufferBindingPoints;let A=u[y];null==A&&(A={buffer:null,offset:0,size:0},u[y]=A);return A}bindBufferBase(u,y,A){const v=this._getBufferBinding(u,y);null==v||v.buffer===A&&0===v.offset&&0===v.size||(this.gl.bindBufferBase(u,y,A?A.glName:null),v.buffer=A,v.offset=0,v.size=0)}bindBufferRange(u,y,A,v,x){const C=this._getBufferBinding(u,y);null==C||C.buffer===A&&C.offset===v&&C.size===x||(0!==v%this._parameters.uniformBufferOffsetAlignment?
console.error("Uniform buffer binding offset is not a multiple of the context offset alignment"):(this.gl.bindBufferRange(u,y,A.glName,v,x),C.buffer=A,C.offset=v,C.size=x))}bindUBO(u,y,A,v){null==y?this.bindBufferBase(c.BufferType.UNIFORM_BUFFER,u,null):(h.webglDebugEnabled()&&(v??y.byteLength)>this._parameters.maxUniformBlockSize&&console.error("Attempting to bind more data than the maximum uniform block size"),y.initialize(),void 0!==A&&void 0!==v?this.bindBufferRange(c.BufferType.UNIFORM_BUFFER,
u,y.buffer,A,v):this.bindBufferBase(c.BufferType.UNIFORM_BUFFER,u,y.buffer))}unbindUBO(u){for(let y=0,A=this._state.uniformBufferBindingPoints.length;y<A;y++){const v=this._state.uniformBufferBindingPoints[y];null!=v&&v.buffer===u.buffer&&this.bindBufferBase(c.BufferType.UNIFORM_BUFFER,y,null)}}unbindBuffer(u){switch(u){case c.BufferType.ARRAY_BUFFER:this._state.vertexBuffer=w(this.gl,null,u,this._state.vertexBuffer);break;case c.BufferType.ELEMENT_ARRAY_BUFFER:this._state.indexBuffer=w(this.gl,null,
u,this._state.indexBuffer);break;case c.BufferType.UNIFORM_BUFFER:this._state.uniformBuffer=w(this.gl,null,u,this._state.uniformBuffer);break;case c.BufferType.PIXEL_PACK_BUFFER:this._state.pixelPackBuffer=w(this.gl,null,u,this._state.pixelPackBuffer);break;case c.BufferType.PIXEL_UNPACK_BUFFER:this._state.pixelUnpackBuffer=w(this.gl,null,u,this._state.pixelUnpackBuffer);break;case c.BufferType.COPY_READ_BUFFER:this._state.copyReadBuffer=w(this.gl,null,u,this._state.copyReadBuffer);break;case c.BufferType.COPY_WRITE_BUFFER:this._state.copyWriteBuffer=
w(this.gl,null,u,this._state.copyWriteBuffer)}}bindVAO(u=null){null==u?this._state.vertexArrayObject&&(this._state.vertexArrayObject.unbind(),this._state.vertexArrayObject=null):this._state.vertexArrayObject!==u&&(u.bind(),this._state.vertexArrayObject=u)}bindTransformFeedback(u){const {gl:y}=this;y.bindTransformFeedback(y.TRANSFORM_FEEDBACK,u.glName)}beginTransformFeedback(u,y){if(this._transformFeedbackRequestInfo)throw Error("Already in a transform feedback request");const {gl:A}=this;A.bindTransformFeedback(A.TRANSFORM_FEEDBACK,
u.glName);A.beginTransformFeedback(y);this._transformFeedbackRequestInfo={primitiveType:y}}endTransformFeedback(){if(!this._transformFeedbackRequestInfo)throw Error("Not in a transform feedback request");const {gl:u}=this;u.endTransformFeedback();u.bindTransformFeedback(u.TRANSFORM_FEEDBACK,null);this._transformFeedbackRequestInfo=null}async clientWaitAsync(u=m.Milliseconds(10)){const {gl:y}=this,A=y.fenceSync(c.SyncCondition.SYNC_GPU_COMMANDS_COMPLETE,0);if(!A)throw Error("Client wait failed, could not create sync object");
this.instanceCounter.increment(c.ResourceType.Sync,A);y.flush();let v;do await d.after(u),v=y.clientWaitSync(A,0,0);while(v===c.ClientWaitSyncStatus.TIMEOUT_EXPIRED);this.instanceCounter.decrement(c.ResourceType.Sync,A);y.deleteSync(A);if(v===c.ClientWaitSyncStatus.WAIT_FAILED)throw Error("Client wait failed");}getBoundFramebufferObject(u=c.FramebufferTarget.FRAMEBUFFER){return u===c.FramebufferTarget.READ_FRAMEBUFFER?this._state.readFramebuffer:this._state.drawFramebuffer}getBoundVAO(){return this._state.vertexArrayObject}resetState(){this.useProgram(null);
this.bindVAO(null);this.bindFramebuffer(null,!0);this.unbindBuffer(c.BufferType.ARRAY_BUFFER);this.unbindBuffer(c.BufferType.ELEMENT_ARRAY_BUFFER);this.unbindBuffer(c.BufferType.UNIFORM_BUFFER);this._state.uniformBufferBindingPoints.length=0;this.unbindBuffer(c.BufferType.PIXEL_PACK_BUFFER);this.unbindBuffer(c.BufferType.PIXEL_UNPACK_BUFFER);this.unbindBuffer(c.BufferType.COPY_READ_BUFFER);this.unbindBuffer(c.BufferType.COPY_WRITE_BUFFER);for(let u=0;u<this.parameters.maxTextureImageUnits;++u)this.bindTexture(null,
u);this.setBlendingEnabled(!1);this.setBlendFunction(c.BlendFactor.ONE,c.BlendFactor.ZERO);this.setBlendEquation(c.BlendOperation.ADD);this.setBlendColor(0,0,0,0);this.setFaceCullingEnabled(!1);this.setCullFace(c.Face.BACK);this.setFrontFace(c.CullMode.CCW);this.setPolygonOffsetFillEnabled(!1);this.setPolygonOffset(0,0);this.setScissorTestEnabled(!1);this.setScissorRect(0,0,this.gl.canvas.width,this.gl.canvas.height);this.setDepthTestEnabled(!1);this.setDepthFunction(c.CompareFunction.LESS);this.setDepthRange(0,
1);this.setStencilTestEnabled(!1);this.setStencilFunction(c.CompareFunction.ALWAYS,0,0);this.setStencilOp(c.StencilOperation.KEEP,c.StencilOperation.KEEP,c.StencilOperation.KEEP);this.setClearColor(0,0,0,0);this.setClearDepth(1);this.setClearStencil(0);this.setColorMask(!0,!0,!0,!0);this.setStencilWriteMask(4294967295);this.setDepthWriteEnabled(!0);this.setDrawBuffers([c.SpecialDrawBuffers.BACK]);this.setViewport(0,0,this.gl.canvas.width,this.gl.canvas.height)}enforceState(){const {gl:u}=this;u.bindVertexArray(null);
for(var y=0;y<this.parameters.maxVertexAttributes;y++)u.disableVertexAttribArray(y);this._state.vertexBuffer?u.bindBuffer(this._state.vertexBuffer.bufferType,this._state.vertexBuffer.glName):u.bindBuffer(c.BufferType.ARRAY_BUFFER,null);this._state.indexBuffer?u.bindBuffer(this._state.indexBuffer.bufferType,this._state.indexBuffer.glName):u.bindBuffer(c.BufferType.ELEMENT_ARRAY_BUFFER,null);this._state.uniformBuffer?u.bindBuffer(this._state.uniformBuffer.bufferType,this._state.uniformBuffer.glName):
u.bindBuffer(c.BufferType.UNIFORM_BUFFER,null);for(y=0;y<this._parameters.maxUniformBufferBindings;y++){var A=this._state.uniformBufferBindingPoints[y];if(null!=A){const {buffer:v,offset:x,size:C}=A;null!==v?0===x&&0===C?u.bindBufferBase(c.BufferType.UNIFORM_BUFFER,y,v.glName):u.bindBufferRange(c.BufferType.UNIFORM_BUFFER,y,v.glName,x,C):u.bindBufferBase(c.BufferType.UNIFORM_BUFFER,y,null)}}this._state.pixelPackBuffer?u.bindBuffer(this._state.pixelPackBuffer.bufferType,this._state.pixelPackBuffer.glName):
u.bindBuffer(c.BufferType.PIXEL_PACK_BUFFER,null);this._state.pixelUnpackBuffer?u.bindBuffer(this._state.pixelUnpackBuffer.bufferType,this._state.pixelUnpackBuffer.glName):u.bindBuffer(c.BufferType.PIXEL_UNPACK_BUFFER,null);this._state.copyReadBuffer?u.bindBuffer(this._state.copyReadBuffer.bufferType,this._state.copyReadBuffer.glName):u.bindBuffer(c.BufferType.COPY_READ_BUFFER,null);this._state.copyWriteBuffer?u.bindBuffer(this._state.copyWriteBuffer.bufferType,this._state.copyWriteBuffer.glName):
u.bindBuffer(c.BufferType.COPY_WRITE_BUFFER,null);u.bindFramebuffer(c.FramebufferTarget.READ_FRAMEBUFFER,null);u.readBuffer(u.BACK);this._state.readFramebuffer&&(u.bindFramebuffer(c.FramebufferTarget.READ_FRAMEBUFFER,this._state.readFramebuffer.glName),u.readBuffer(c.ColorAttachment.COLOR_ATTACHMENT0));u.bindFramebuffer(c.FramebufferTarget.DRAW_FRAMEBUFFER,this._state.drawFramebuffer?.glName??null);null===this._state.drawFramebuffer?u.drawBuffers(this._state.drawBuffers.defaultFramebuffer??[c.SpecialDrawBuffers.BACK]):
(y=this._state.drawBuffers.fbos.get(this._state.drawFramebuffer),u.drawBuffers(y??[c.ColorAttachment.COLOR_ATTACHMENT0]));if(this._state.vertexArrayObject){if(y=this._state.vertexArrayObject)this._state.vertexArrayObject.unbind(),this._state.vertexArrayObject=null;this.bindVAO(y)}u.useProgram(this._state.program?.glName??null);u.blendColor(this._state.blendColor.r,this._state.blendColor.g,this._state.blendColor.b,this._state.blendColor.a);u.bindRenderbuffer(u.RENDERBUFFER,this._state.renderbuffer?.glName??
null);!0===this._state.blend?u.enable(this.gl.BLEND):u.disable(this.gl.BLEND);u.blendEquationSeparate(this._state.blendEquation.mode,this._state.blendEquation.modeAlpha);u.blendFuncSeparate(this._state.blendFunction.srcRGB,this._state.blendFunction.dstRGB,this._state.blendFunction.srcAlpha,this._state.blendFunction.dstAlpha);u.clearColor(this._state.clearColor.r,this._state.clearColor.g,this._state.clearColor.b,this._state.clearColor.a);u.clearDepth(this._state.clearDepth);u.clearStencil(this._state.clearStencil);
u.colorMask(this._state.colorMask.r,this._state.colorMask.g,this._state.colorMask.b,this._state.colorMask.a);u.cullFace(this._state.cullFace);u.depthFunc(this._state.depthFunction);u.depthRange(this._state.depthRange.zNear,this._state.depthRange.zFar);!0===this._state.depthTest?u.enable(u.DEPTH_TEST):u.disable(u.DEPTH_TEST);u.depthMask(this._state.depthWrite);u.frontFace(this._state.frontFace);u.lineWidth(1);!0===this._state.faceCulling?u.enable(u.CULL_FACE):u.disable(u.CULL_FACE);u.polygonOffset(this._state.polygonOffset[0],
this._state.polygonOffset[1]);!0===this._state.polygonOffsetFill?u.enable(u.POLYGON_OFFSET_FILL):u.disable(u.POLYGON_OFFSET_FILL);u.scissor(this._state.scissorRect.x,this._state.scissorRect.y,this._state.scissorRect.width,this._state.scissorRect.height);!0===this._state.scissorTest?u.enable(u.SCISSOR_TEST):u.disable(u.SCISSOR_TEST);u.stencilFunc(this._state.stencilFunction.func,this._state.stencilFunction.ref,this._state.stencilFunction.mask);u.stencilOpSeparate(this._state.stencilOperation.face,
this._state.stencilOperation.fail,this._state.stencilOperation.zFail,this._state.stencilOperation.zPass);!0===this._state.stencilTest?u.enable(u.STENCIL_TEST):u.disable(u.STENCIL_TEST);u.stencilMask(this._state.stencilWriteMask);for(y=0;y<this.parameters.maxTextureImageUnits;y++)u.activeTexture(c.baseTextureUnit+y),u.bindTexture(c.TextureType.TEXTURE_2D,null),u.bindTexture(c.TextureType.TEXTURE_CUBE_MAP,null),u.bindTexture(c.TextureType.TEXTURE_3D,null),u.bindTexture(c.TextureType.TEXTURE_2D_ARRAY,
null),A=this._state.textureUnitMap[y],null!=A&&u.bindTexture(A.descriptor.target,A.glName);u.activeTexture(c.baseTextureUnit+this._state.activeTexture);y=this._state.viewport;u.viewport(y.x,y.y,y.width,y.height);this.resetInfo()}_loadExtensions(){this.gl.getExtension("KHR_parallel_shader_compile")}};Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/ContextState":function(){define(["exports","./enums"],function(l,q){class n{constructor(){this.blend=!1;this.blendColor=
{r:0,g:0,b:0,a:0};this.blendFunction={srcRGB:q.BlendFactor.ONE,dstRGB:q.BlendFactor.ZERO,srcAlpha:q.BlendFactor.ONE,dstAlpha:q.BlendFactor.ZERO};this.blendEquation={mode:q.BlendOperation.ADD,modeAlpha:q.BlendOperation.ADD};this.colorMask={r:!0,g:!0,b:!0,a:!0};this.faceCulling=!1;this.cullFace=q.Face.BACK;this.frontFace=q.CullMode.CCW;this.scissorTest=!1;this.scissorRect={x:0,y:0,width:0,height:0};this.depthTest=!1;this.depthFunction=q.CompareFunction.LESS;this.clearDepth=1;this.depthWrite=!0;this.depthRange=
{zNear:0,zFar:1};this.viewport=null;this.polygonOffsetFill=this.stencilTest=!1;this.polygonOffset=[0,0];this.stencilFunction={face:q.Face.FRONT_AND_BACK,func:q.CompareFunction.ALWAYS,ref:0,mask:1};this.clearStencil=0;this.stencilWriteMask=1;this.stencilOperation={face:q.Face.FRONT_AND_BACK,fail:q.StencilOperation.KEEP,zFail:q.StencilOperation.KEEP,zPass:q.StencilOperation.KEEP};this.clearColor={r:0,g:0,b:0,a:0};this.transformFeedbackBuffer=this.copyWriteBuffer=this.copyReadBuffer=this.pixelUnpackBuffer=
this.pixelPackBuffer=this.uniformBuffer=this.indexBuffer=this.vertexBuffer=this.program=null;this.uniformBufferBindingPoints=[];this.transformBufferBindingPoints=[];this.drawFramebuffer=this.readFramebuffer=null;this.drawBuffers={defaultFramebuffer:[q.SpecialDrawBuffers.BACK],fbos:new WeakMap};this.renderbuffer=null;this.activeTexture=0;this.textureUnitMap=[];this.vertexArrayObject=null}}l.ContextState=n;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/InstanceCounter":function(){define(["exports",
"./AllocationTracer","./enums"],function(l,q,n){const d={RECORD_ALLOCATIONS:!1};class m{constructor(){this._current=[];for(this._allocations=d.RECORD_ALLOCATIONS?new q.AllocationTracer("WebGLObject"):null;this._current.length<n.ResourceType.COUNT;)this._current.push(0)}increment(h,g,c=1){this._current[h]+=c;this._allocations?.add(g)}decrement(h,g,c=1){this._current[h]-=c;this._allocations?.remove(g)}get current(){return this._current}get total(){return this.current.reduce((h,g,c)=>h+(c<n.ResourceType.UNCOUNTED?
g:0),0)}get resourceInformation(){let h="";if(0<this.total){h+="Live objects:\n";for(let g=0;g<n.ResourceType.COUNT;++g){const c=this._current[g];0<c&&(h+=`${n.ResourceType[g]}: ${c}\n`)}}return h+=this._allocations?.resetLog()}}l.InstanceCounter=m;l.test=d;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/AllocationTracer":function(){define(["exports"],function(l){class q{constructor(d){this._objectType=d;this._active=new Map}get _stack(){const d=Error().stack.split("\n");
d.shift();d.shift();d.shift();return d.join("\n")}add(d){this._active.set(d,new n(this._stack))}remove(d){this._active.delete(d)}addReference(d){(d=this._active.get(d))&&d.retains.push(this._stack)}removeReference(d){(d=this._active.get(d))&&d.releases.push(this._stack)}resetLog(){const d=new Map;let m="";this._active.forEach((c,{usedMemory:a})=>{d.has(c.from)||(d.set(c.from,new Map),0<c.retains.length&&(m+=`  First reference count mismatch:\n  Retain:\n    ${c.retains.join("\n\n    ")}\n\n  Release:    ${c.releases.join("\n\n    ")}\n`));
c=d.get(c.from);c.set(a??0,c.get(a??0)??1)});this._active.clear();let h=0;const g=[];d.forEach((c,a)=>{let b=0;c.forEach((k,e)=>b+=k*e);c.set(-1,b);h+=b;g.push([a,c])});d.clear();g.sort((c,a)=>a[1].get(-1)-c[1].get(-1));return g.reduce((c,[a,b])=>{const k=Math.round(b.get(-1)/1024);b.delete(-1);b=Array.from(b.values()).reduce((e,r)=>e+r,0);return c+=`  ${k}KB from ${b} allocations at ${a}\n`},`Total ${this._objectType} memory: ${Math.round(h/1024)}KB\n${m}`)}}class n{constructor(d){this.from=d;this.retains=
[];this.releases=[]}}l.AllocationTracer=q;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/Parameters":function(){define(["exports"],function(l){class q{constructor(n,d,m){d=d.textureFilterAnisotropic;m=m.maxAnisotropy??Infinity;this.versionString=n.getParameter(n.VERSION);this.maxVertexTextureImageUnits=n.getParameter(n.MAX_VERTEX_TEXTURE_IMAGE_UNITS);this.maxVertexAttributes=n.getParameter(n.MAX_VERTEX_ATTRIBS);this.maxMaxAnisotropy=d?Math.min(n.getParameter(d.MAX_TEXTURE_MAX_ANISOTROPY),
m):1;this.maxTextureImageUnits=n.getParameter(n.MAX_TEXTURE_IMAGE_UNITS);this.maxTextureSize=n.getParameter(n.MAX_TEXTURE_SIZE);this.maxRenderbufferSize=n.getParameter(n.MAX_RENDERBUFFER_SIZE);this.maxViewportDims=n.getParameter(n.MAX_VIEWPORT_DIMS);this.maxUniformBufferBindings=n.getParameter(n.MAX_UNIFORM_BUFFER_BINDINGS);this.maxVertexUniformBlocks=n.getParameter(n.MAX_VERTEX_UNIFORM_BLOCKS);this.maxFragmentUniformBlocks=n.getParameter(n.MAX_FRAGMENT_UNIFORM_BLOCKS);this.maxUniformBlockSize=n.getParameter(n.MAX_UNIFORM_BLOCK_SIZE);
this.uniformBufferOffsetAlignment=n.getParameter(n.UNIFORM_BUFFER_OFFSET_ALIGNMENT);this.maxArrayTextureLayers=n.getParameter(n.MAX_ARRAY_TEXTURE_LAYERS);this.maxSamples=n.getParameter(n.MAX_SAMPLES);this.maxDrawBuffers=n.getParameter(n.MAX_DRAW_BUFFERS)}}l.Parameters=q;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/renderState":function(){define(["exports","../3d/webgl-engine/lib/basicInterfaces","./enums"],function(l,q,n){function d(P,V,Z=n.BlendOperation.ADD,
ba=[0,0,0,0]){return{srcRgb:P,srcAlpha:P,dstRgb:V,dstAlpha:V,opRgb:Z,opAlpha:Z,color:{r:ba[0],g:ba[1],b:ba[2],a:ba[3]}}}function m(P,V,Z,ba,aa=n.BlendOperation.ADD,ca=n.BlendOperation.ADD,ea=[0,0,0,0]){return{srcRgb:P,srcAlpha:V,dstRgb:Z,dstAlpha:ba,opRgb:aa,opAlpha:ca,color:{r:ea[0],g:ea[1],b:ea[2],a:ea[3]}}}function h(P){return L.intern(P)}function g(P){return R.intern(P)}function c(P){return S.intern(P)}function a(P){return W.intern(P)}function b(P){return J.intern(P)}function k(P){return O.intern(P)}
function e(P){return T.intern(P)}function r(P){return X.intern(P)}function f(P){return U.intern(P)}function p(P){return"["+P.join(",")+"]"}function t(P){return P?p([P.srcRgb,P.srcAlpha,P.dstRgb,P.dstAlpha,P.opRgb,P.opAlpha,P.color.r,P.color.g,P.color.b,P.color.a]):null}function w(P){return P?p([P.face,P.mode]):null}function z(P){return P?p([P.factor,P.units]):null}function u(P){return P?p([P.func]):null}function y(P){return P?p([P.function.func,P.function.ref,P.function.mask,P.operation.fail,P.operation.zFail,
P.operation.zPass]):null}function A(P){return P?p([P.zNear,P.zFar]):null}function v(P){return P?p([P.r,P.g,P.b,P.a]):null}function x(P){return P?p([P.mask]):null}function C(P){return P?p(P.buffers):null}const B=d(n.BlendFactor.ZERO,n.BlendFactor.ONE_MINUS_SRC_ALPHA),E=d(n.BlendFactor.ONE,n.BlendFactor.ZERO),D=d(n.BlendFactor.ONE,n.BlendFactor.ONE),F=d(n.BlendFactor.ONE,n.BlendFactor.ONE_MINUS_SRC_ALPHA),G=m(n.BlendFactor.SRC_ALPHA,n.BlendFactor.ONE,n.BlendFactor.ONE_MINUS_SRC_ALPHA,n.BlendFactor.ONE_MINUS_SRC_ALPHA),
H={face:n.Face.BACK,mode:n.CullMode.CCW},I={face:n.Face.FRONT,mode:n.CullMode.CCW};class K{constructor(P,V){this._makeKey=P;this._makeRef=V;this._interns=new Map}intern(P){if(!P)return null;const V=this._makeKey(P),Z=this._interns;Z.has(V)||Z.set(V,this._makeRef(P));return Z.get(V)??null}}const L=new K(t,P=>({__tag:"Blending",...P})),R=new K(w,P=>({__tag:"Culling",...P})),S=new K(z,P=>({__tag:"PolygonOffset",...P})),W=new K(u,P=>({__tag:"DepthTest",...P})),J=new K(y,P=>({__tag:"StencilTest",...P})),
O=new K(A,P=>({__tag:"DepthWrite",...P})),T=new K(v,P=>({__tag:"ColorWrite",...P})),X=new K(x,P=>({__tag:"StencilWrite",...P})),U=new K(C,P=>({__tag:"DrawBuffers",...P})),N=new K(function(P){return P?p([t(P.blending),w(P.culling),z(P.polygonOffset),u(P.depthTest),y(P.stencilTest),A(P.depthWrite),v(P.colorWrite),x(P.stencilWrite),C(P.drawBuffers)]):null},P=>({blending:h(P.blending),culling:g(P.culling),polygonOffset:c(P.polygonOffset),depthTest:a(P.depthTest),stencilTest:b(P.stencilTest),depthWrite:k(P.depthWrite),
colorWrite:e(P.colorWrite),stencilWrite:r(P.stencilWrite),drawBuffers:f(P.drawBuffers)}));class Q{constructor(P){this._drawBuffersInvalid=this._stencilWriteInvalid=this._colorWriteInvalid=this._depthWriteInvalid=this._stencilTestInvalid=this._depthTestInvalid=this._polygonOffsetInvalid=this._cullingInvalid=this._blendingInvalid=this._pipelineInvalid=!0;this._stateSetters=P}setPipeline(P){if(this._pipelineInvalid||P!==this._pipeline)this._setBlending(P.blending),this._setCulling(P.culling),this._setPolygonOffset(P.polygonOffset),
this._setDepthTest(P.depthTest),this._setStencilTest(P.stencilTest),this._setDepthWrite(P.depthWrite),this._setColorWrite(P.colorWrite),this._setStencilWrite(P.stencilWrite),this._setDrawBuffers(P.drawBuffers),this._pipeline=P;this._pipelineInvalid=!1}invalidateBlending(){this._pipelineInvalid=this._blendingInvalid=!0}invalidateCulling(){this._pipelineInvalid=this._cullingInvalid=!0}invalidatePolygonOffset(){this._pipelineInvalid=this._polygonOffsetInvalid=!0}invalidateDepthTest(){this._pipelineInvalid=
this._depthTestInvalid=!0}invalidateStencilTest(){this._pipelineInvalid=this._stencilTestInvalid=!0}invalidateDepthWrite(){this._pipelineInvalid=this._depthWriteInvalid=!0}invalidateColorWrite(){this._pipelineInvalid=this._colorWriteInvalid=!0}invalidateStencilWrite(){this._pipelineInvalid=this._stencilTestInvalid=!0}invalidateDrawBuffers(){this._pipelineInvalid=this._drawBuffersInvalid=!0}_setBlending(P){this._blending=this._setSubState(P,this._blending,this._blendingInvalid,this._stateSetters.setBlending);
this._blendingInvalid=!1}_setCulling(P){this._culling=this._setSubState(P,this._culling,this._cullingInvalid,this._stateSetters.setCulling);this._cullingInvalid=!1}_setPolygonOffset(P){this._polygonOffset=this._setSubState(P,this._polygonOffset,this._polygonOffsetInvalid,this._stateSetters.setPolygonOffset);this._polygonOffsetInvalid=!1}_setDepthTest(P){this._depthTest=this._setSubState(P,this._depthTest,this._depthTestInvalid,this._stateSetters.setDepthTest);this._depthTestInvalid=!1}_setStencilTest(P){this._stencilTest=
this._setSubState(P,this._stencilTest,this._stencilTestInvalid,this._stateSetters.setStencilTest);this._stencilTestInvalid=!1}_setDepthWrite(P){this._depthWrite=this._setSubState(P,this._depthWrite,this._depthWriteInvalid,this._stateSetters.setDepthWrite);this._depthWriteInvalid=!1}_setColorWrite(P){this._colorWrite=this._setSubState(P,this._colorWrite,this._colorWriteInvalid,this._stateSetters.setColorWrite);this._colorWriteInvalid=!1}_setStencilWrite(P){this._stencilWrite=this._setSubState(P,this._stencilWrite,
this._stencilWriteInvalid,this._stateSetters.setStencilWrite);this._stencilTestInvalid=!1}_setDrawBuffers(P){this._drawBuffers=this._setSubState(P,this._drawBuffers,this._drawBuffersInvalid,this._stateSetters.setDrawBuffers);this._drawBuffersInvalid=!1}_setSubState(P,V,Z,ba){if(Z||P!==V)ba(P),this._pipelineInvalid=!0;return P}}l.StateTracker=Q;l.backFaceCullingParams=H;l.blendWithPremultipliedAlpha=F;l.cullingParams=P=>P===q.CullFaceOptions.Back?H:P===q.CullFaceOptions.Front?I:null;l.defaultColorWrite=
{r:!0,g:!0,b:!0,a:!0};l.defaultDepthWrite={zNear:0,zFar:1};l.frontFaceCullingParams=I;l.keepSourceValues=E;l.makeBlending=h;l.makeColorWrite=e;l.makeCulling=g;l.makeDepthTest=a;l.makeDepthWrite=k;l.makeDrawBuffers=f;l.makePipelineState=function(P){return N.intern(P)};l.makePolygonOffset=c;l.makeStencilTest=b;l.makeStencilWrite=r;l.premultipliedAlphaToPremultipliedAlpha=G;l.separateBlendingParams=m;l.simpleBlendingParams=d;l.weightedAdd=D;l.writeDestinationPremultipliedAlpha=B;Object.defineProperty(l,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/basicInterfaces":function(){define(["exports"],function(l){l.CullFaceOptions=void 0;(function(q){q[q.None=0]="None";q[q.Front=1]="Front";q[q.Back=2]="Back";q[q.COUNT=3]="COUNT"})(l.CullFaceOptions||(l.CullFaceOptions={}));l.DepthTestFunction=void 0;(function(q){q[q.Less=0]="Less";q[q.Lequal=1]="Lequal";q[q.COUNT=2]="COUNT"})(l.DepthTestFunction||(l.DepthTestFunction={}));l.RenderRequestType=void 0;(function(q){q[q.BACKGROUND=
0]="BACKGROUND";q[q.UPDATE=1]="UPDATE"})(l.RenderRequestType||(l.RenderRequestType={}));l.ResourceState=void 0;(function(q){q[q.NOT_LOADED=0]="NOT_LOADED";q[q.LOADING=1]="LOADING";q[q.LOADED=2]="LOADED"})(l.ResourceState||(l.ResourceState={}));l.StencilBits=void 0;(function(q){q[q.IntegratedMeshMaskExcluded=1]="IntegratedMeshMaskExcluded";q[q.OutlineVisualElementMask=2]="OutlineVisualElementMask"})(l.StencilBits||(l.StencilBits={}));l.Object3DState=void 0;(function(q){q[q.Highlight=0]="Highlight";
q[q.MaskOccludee=1]="MaskOccludee"})(l.Object3DState||(l.Object3DState={}));l.AlphaDiscardMode=void 0;(function(q){q[q.Blend=0]="Blend";q[q.Opaque=1]="Opaque";q[q.Mask=2]="Mask";q[q.MaskBlend=3]="MaskBlend";q[q.COUNT=4]="COUNT"})(l.AlphaDiscardMode||(l.AlphaDiscardMode={}));l.TextureEncodingMimeType=void 0;(function(q){q.DDS_ENCODING="image/vnd-ms.dds";q.KTX2_ENCODING="image/ktx2";q.BASIS_ENCODING="image/x.basis"})(l.TextureEncodingMimeType||(l.TextureEncodingMimeType={}));Object.defineProperty(l,
Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/WebGLDriverTest":function(){define(["exports","./testAppleAmdDrawArrays","./testDoublePrecisionArithmetic","./testFloatBufferBlend","./testSVGPremultipliedAlpha"],function(l,q,n,d,m){class h{constructor(g){this.rctx=g;this.floatBufferBlend=new d.FloatBufferBlend(g);this.svgPremultipliesAlpha=new m.SVGPremultipliedAlpha(g);this.doublePrecisionRequiresObfuscation=new n.DoublePrecisionRequiresObfuscation(g);this.drawArraysRequiresIndicesTypeReset=
new q.DrawArraysRequiresIndicesTypeReset(g)}dispose(){this.doublePrecisionRequiresObfuscation.dispose();this.svgPremultipliesAlpha.dispose();this.floatBufferBlend.dispose();this.drawArraysRequiresIndicesTypeReset.dispose()}}l.WebGLDriverTest=h;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/testAppleAmdDrawArrays":function(){define("exports ../../core/has ../3d/webgl-engine/core/shaderModules/interfaces ./AppleAmdDriverHelper ./BufferObject ./enums ./FramebufferObject ./TextureDescriptor ./WebGLDriverTestModule".split(" "),
function(l,q,n,d,m,h,g,c,a){class b extends a.WebGLDriverTestModule{constructor(k){super();this._rctx=k;this._helperProgram=null;q("mac")&&q("chrome")&&(this._program=this._prepareProgram(),this._helperProgram=this._prepareHelperProgram())}dispose(){super.dispose();this._helperProgram?.dispose();this._helperProgram=null}_test(k){const e=this._rctx,r=e.getBoundFramebufferObject(),{x:f,y:p,width:t,height:w}=e.getViewport();e.resetState();var z=new c.TextureDescriptor(1);z.wrapMode=h.TextureWrapMode.CLAMP_TO_EDGE;
z.samplingMode=h.TextureSamplingMode.NEAREST;z=new g.FramebufferObject(e,z);const u=m.BufferObject.createIndex(this._rctx,h.Usage.STATIC_DRAW,new Uint8Array([0]));e.bindFramebuffer(z);e.setViewport(0,0,1,1);e.useProgram(this._helperProgram);e.bindBuffer(u,h.BufferType.ELEMENT_ARRAY_BUFFER);e.drawElements(h.PrimitiveType.POINTS,1,h.DataType.UNSIGNED_BYTE,0);e.useProgram(k);e.bindVAO(null);e.drawArrays(h.PrimitiveType.TRIANGLES,0,258);k=new Uint8Array(4);z.readPixels(0,0,1,1,h.PixelFormat.RGBA,h.PixelType.UNSIGNED_BYTE,
k);e.setViewport(f,p,t,w);e.bindFramebuffer(r);z.dispose();u.dispose();return 255===k[0]}_prepareProgram(){const k=`#version 300 es\n    precision highp float;\n\n    out float triangleId;\n\n    const vec3 triangleVertices[3] = vec3[3](vec3(-0.5, -0.5, 0.0), vec3(0.5, -0.5, 0.0), vec3(0.0, 0.5, 0.0));\n\n    void main(void) {\n      triangleId = floor(float(gl_VertexID)/3.0);\n\n      vec3 position = triangleVertices[gl_VertexID % 3];\n      float offset = triangleId / ${n.glsl.float(85)};\n      position.z = 0.5 - offset;\n\n      gl_Position = vec4(position, 1.0);\n    }\n    `,
e=`#version 300 es\n    precision highp float;\n\n    in float triangleId;\n\n    out vec4 fragColor;\n\n    void main(void) {\n      fragColor = triangleId == ${n.glsl.float(85)} ? vec4(0.0, 1.0, 0.0, 1.0) : vec4(1.0, 0.0, 0.0, 1.0);\n    }\n    `;return this._rctx.programCache.acquire(k,e,new Map([]))}_prepareHelperProgram(){const k=d.AppleAmdDriverHelper.getShaderSources();return this._rctx.programCache.acquire(k.vertex,k.fragment,new Map([]))}}l.DrawArraysRequiresIndicesTypeReset=b;Object.defineProperty(l,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/interfaces":function(){define(["exports"],function(l){function q(m,...h){let g="";for(let c=0;c<h.length;c++)g+=m[c]+h[c];return g+=m[m.length-1]}class n{}const d=n;(function(m){m.int=function(h){return Math.round(h).toString()};m.float=function(h){return h.toPrecision(8)}})(q||={});l.If=function(m,h,g=""){return m?h:g};l.NoParameters=d;l.glsl=q;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/AppleAmdDriverHelper":function(){define(["exports",
"../../core/has","./BufferObject","./enums"],function(l,q,n,d){class m{constructor(h){this._rctx=h;this._indexBuffer=this._createIndexbuffer();this._program=this._createHelperProgram()}static getShaderSources(){return{vertex:"#version 300 es\n    precision highp float;\n\n    void main(void) {\n      gl_Position \x3d vec4(0.0, 0.0, float(gl_VertexID)-2.0, 1.0);\n    }",fragment:"#version 300 es\n    precision highp float;\n\n    out vec4 fragColor;\n\n    void main(void) {\n      fragColor \x3d vec4(0.0, 0.0, 0.0, 1.0);\n    }"}}_createHelperProgram(){const h=
m.getShaderSources();return this._rctx.programCache.acquire(h.vertex,h.fragment,new Map([]))}_createIndexbuffer(){return n.BufferObject.createIndex(this._rctx,d.Usage.STATIC_DRAW,new Uint32Array([0]))}run(){this._program.compiled&&this._indexBuffer&&(this._rctx.bindVAO(null),this._rctx.useProgram(this._program),this._rctx.bindBuffer(this._indexBuffer,d.BufferType.ELEMENT_ARRAY_BUFFER),this._rctx.drawElements(d.PrimitiveType.POINTS,1,d.DataType.UNSIGNED_INT,0))}dispose(){this._program.dispose();this._indexBuffer.dispose()}get test(){}}
l.AppleAmdDriverHelper=m;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/WebGLDriverTestModule":function(){define(["exports","../../core/maybe"],function(l,q){class n{constructor(){this._result=!1}dispose(){this._program=q.disposeMaybe(this._program)}get result(){null!=this._program&&(this._result=this._test(this._program),this.dispose());return this._result}}l.WebGLDriverTestModule=n;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/testDoublePrecisionArithmetic":function(){define("exports ../../core/floatRGBA ../../core/has ../../core/maybe ../../core/libs/gl-matrix-2/factories/vec3f64 ./BufferObject ./doublePrecisionUtils ./enums ./FramebufferObject ./TextureDescriptor ./VertexArrayObject ./VertexElementDescriptor ./WebGLDriverTestModule".split(" "),
function(l,q,n,d,m,h,g,c,a,b,k,e,r){function f(t,w){return t.programCache.acquire(`\n\n  precision highp float;\n\n  attribute vec2 position;\n\n  uniform vec3 u_highA;\n  uniform vec3 u_lowA;\n  uniform vec3 u_highB;\n  uniform vec3 u_lowB;\n\n  varying vec4 v_color;\n\n  ${w?"#define DOUBLE_PRECISION_REQUIRES_OBFUSCATION":""}\n\n  #ifdef DOUBLE_PRECISION_REQUIRES_OBFUSCATION\n\n  vec3 dpPlusFrc(vec3 a, vec3 b) {\n    return mix(a, a + b, vec3(notEqual(b, vec3(0))));\n  }\n\n  vec3 dpMinusFrc(vec3 a, vec3 b) {\n    return mix(vec3(0), a - b, vec3(notEqual(a, b)));\n  }\n\n  vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {\n    vec3 t1 = dpPlusFrc(hiA, hiB);\n    vec3 e = dpMinusFrc(t1, hiA);\n    vec3 t2 = dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;\n    return t1 + t2;\n  }\n\n  #else\n\n  vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {\n    vec3 t1 = hiA + hiB;\n    vec3 e = t1 - hiA;\n    vec3 t2 = ((hiB - e) + (hiA - (t1 - e))) + loA + loB;\n    return t1 + t2;\n  }\n\n  #endif\n\n  const float MAX_RGBA_FLOAT =\n    255.0 / 256.0 +\n    255.0 / 256.0 / 256.0 +\n    255.0 / 256.0 / 256.0 / 256.0 +\n    255.0 / 256.0 / 256.0 / 256.0 / 256.0;\n\n  const vec4 FIXED_POINT_FACTORS = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);\n\n  vec4 float2rgba(const float value) {\n    // Make sure value is in the domain we can represent\n    float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);\n\n    // Decompose value in 32bit fixed point parts represented as\n    // uint8 rgba components. Decomposition uses the fractional part after multiplying\n    // by a power of 256 (this removes the bits that are represented in the previous\n    // component) and then converts the fractional part to 8bits.\n    vec4 fixedPointU8 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);\n\n    // Convert uint8 values (from 0 to 255) to floating point representation for\n    // the shader\n    const float toU8AsFloat = 1.0 / 255.0;\n\n    return fixedPointU8 * toU8AsFloat;\n  }\n\n  void main() {\n    vec3 val = dpAdd(u_highA, u_lowA, -u_highB, -u_lowB);\n\n    v_color = float2rgba(val.z / 25.0);\n\n    gl_Position = vec4(position * 2.0 - 1.0, 0.0, 1.0);\n  }\n  `,
"\n  precision highp float;\n\n  varying vec4 v_color;\n\n  void main() {\n    gl_FragColor \x3d v_color;\n  }\n  ",new Map([["position",0]]))}class p extends r.WebGLDriverTestModule{constructor(t){super();this._rctx=t;this._program=f(this._rctx,!1);this._obfuscated=f(this._rctx,!0)}dispose(){super.dispose();this._obfuscated=d.disposeMaybe(this._obfuscated)}_test(t){if(n("force-double-precision-obfuscation"))return!0;if(null==this._obfuscated)return!1;const w=this._rctx,z=w.getBoundFramebufferObject(),
{x:u,y,width:A,height:v}=w.getViewport();t=this._runProgram(t);const x=this._runProgram(this._obfuscated);w.setViewport(u,y,A,v);w.bindFramebuffer(z);return 0!==t&&(0===x||5<t/x)}_runProgram(t){var w=this._rctx;w.resetState();var z=new b.TextureDescriptor(1);z.wrapMode=c.TextureWrapMode.CLAMP_TO_EDGE;z.samplingMode=c.TextureSamplingMode.NEAREST;z=new a.FramebufferObject(w,z);var u=h.BufferObject.createVertex(w,c.Usage.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1]));u=new k.VertexArrayObject(w,new Map([["position",
0]]),new Map([["geometry",[new e.VertexElementDescriptor("position",2,c.DataType.UNSIGNED_SHORT,0,4)]]]),new Map([["geometry",u]]));const y=m.fromValues(5633261.287538229,2626832.878767164,1434988.0495278358),A=m.fromValues(5633271.46742708,2626873.6381334523,1434963.231608387),v=new Float32Array(6);g.encodeDoubleArray(y,v,3);const x=new Float32Array(6);g.encodeDoubleArray(A,x,3);w.useProgram(t);t.setUniform3f("u_highA",v[0],v[2],v[4]);t.setUniform3f("u_lowA",v[1],v[3],v[5]);t.setUniform3f("u_highB",
x[0],x[2],x[4]);t.setUniform3f("u_lowB",x[1],x[3],x[5]);w.bindFramebuffer(z);w.setViewport(0,0,1,1);w.bindVAO(u);w.drawArrays(c.PrimitiveType.TRIANGLE_STRIP,0,4);t=new Uint8Array(4);z.readPixels(0,0,1,1,c.PixelFormat.RGBA,c.PixelType.UNSIGNED_BYTE,t);u.dispose();z.dispose();w=(y[2]-A[2])/25;t=q.unpackFloatRGBA(t);return Math.abs(w-t)}}l.DoublePrecisionRequiresObfuscation=p;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/doublePrecisionUtils":function(){define(["exports"],
function(l){const q=new Float32Array(2);l.decodeDoubleArray=function(n,d,m){for(let h=0;h<m;++h)d[h]=n[2*h]+n[2*h+1]};l.encodeDoubleArray=function(n,d,m){for(let h=0;h<m;++h)d[2*h]=n[h],d[2*h+1]=n[h]-d[2*h]};l.encodeDoubleHi=function(n,d){const m=n.length;for(let h=0;h<m;++h)q[0]=n[h],d[h]=q[0];return d};l.encodeDoubleLo=function(n,d){const m=n.length;for(let h=0;h<m;++h)q[0]=n[h],q[1]=n[h]-q[0],d[h]=q[1];return d};Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/testFloatBufferBlend":function(){define("exports ./BufferObject ./enums ./FramebufferObject ./renderState ./TextureDescriptor ./VertexArrayObject ./VertexElementDescriptor ./WebGLDriverTestModule".split(" "),
function(l,q,n,d,m,h,g,c,a){class b extends a.WebGLDriverTestModule{constructor(k){super();this._rctx=k;k.gl&&k.capabilities.colorBufferFloat?.textureFloat&&k.capabilities.colorBufferFloat?.floatBlend&&(this._program=k.programCache.acquire("\n    precision highp float;\n    attribute vec2 a_pos;\n\n    void main() {\n      gl_Position \x3d vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);\n    }\n    ","\n     precision highp float;\n\n     void main() {\n      gl_FragColor \x3d vec4(0.5, 0.5, 0.5, 0.5);\n     }\n    ",
new Map([["a_pos",0]])))}_test(k){const e=this._rctx;var r=new h.TextureDescriptor(1);r.wrapMode=n.TextureWrapMode.CLAMP_TO_EDGE;r.dataType=n.PixelType.FLOAT;r.internalFormat=n.SizedPixelFormat.RGBA32F;r.samplingMode=n.TextureSamplingMode.NEAREST;r=new d.FramebufferObject(e,r);var f=q.BufferObject.createVertex(e,n.Usage.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1]));f=new g.VertexArrayObject(e,new Map([["a_pos",0]]),new Map([["geometry",[new c.VertexElementDescriptor("a_pos",2,n.DataType.UNSIGNED_SHORT,
0,4)]]]),new Map([["geometry",f]]));e.gl.getError();e.useProgram(k);k=e.getBoundFramebufferObject();const {x:p,y:t,width:w,height:z}=e.getViewport();e.bindFramebuffer(r);e.setViewport(0,0,1,1);e.bindVAO(f);e.drawArrays(n.PrimitiveType.TRIANGLE_STRIP,0,4);var u=m.makePipelineState({blending:m.writeDestinationPremultipliedAlpha});e.setPipelineState(u);e.drawArrays(n.PrimitiveType.TRIANGLE_STRIP,0,4);u=e.gl.getError();e.setViewport(p,t,w,z);e.bindFramebuffer(k);f.dispose();r.dispose();return u===e.gl.INVALID_OPERATION?
(console.warn("Device claims support for WebGL extension EXT_float_blend but does not support it. Using fall back."),!1):!0}}l.FloatBufferBlend=b;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/testSVGPremultipliedAlpha":function(){define("exports ../2d/engine/webgl/DefaultVertexAttributeLayouts ./BufferObject ./enums ./FramebufferObject ./Texture ./TextureDescriptor ./VertexArrayObject ./WebGLDriverTestModule".split(" "),function(l,q,n,d,m,h,g,c,a){class b extends a.WebGLDriverTestModule{constructor(e){super();
this._rctx=e;this._program=e.programCache.acquire("\n    precision highp float;\n\n    attribute vec2 a_pos;\n    varying vec2 v_uv;\n\n    void main() {\n      v_uv \x3d a_pos;\n      gl_Position \x3d vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);\n    }\n    ","\n    precision highp float;\n\n    varying vec2 v_uv;\n\n    uniform sampler2D u_texture;\n\n    void main() {\n      gl_FragColor \x3d texture2D(u_texture, v_uv);\n    }\n    ",new Map([["a_pos",0]]))}dispose(){super.dispose()}_test(e){const r=this._rctx;
if(!r.gl)return e.dispose(),!0;var f=new g.TextureDescriptor(1);f.wrapMode=d.TextureWrapMode.CLAMP_TO_EDGE;f.samplingMode=d.TextureSamplingMode.NEAREST;f=new m.FramebufferObject(r,f);var p=n.BufferObject.createVertex(r,d.Usage.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1]));p=new c.VertexArrayObject(r,new Map([["a_pos",0]]),q.Pos2us,new Map([["geometry",p]]));var t=new g.TextureDescriptor;t.samplingMode=d.TextureSamplingMode.LINEAR;t.wrapMode=d.TextureWrapMode.CLAMP_TO_EDGE;t=new h.Texture(r,t,k);
r.useProgram(e);r.bindTexture(t,0);e.setUniform1i("u_texture",0);e=r.getBoundFramebufferObject();const {x:w,y:z,width:u,height:y}=r.getViewport();r.bindFramebuffer(f);r.setViewport(0,0,1,1);r.setClearColor(0,0,0,0);r.setBlendingEnabled(!1);r.clear(d.FramebufferBit.COLOR);r.bindVAO(p);r.drawArrays(d.PrimitiveType.TRIANGLE_STRIP,0,4);const A=new Uint8Array(4);f.readPixels(0,0,1,1,d.PixelFormat.RGBA,d.PixelType.UNSIGNED_BYTE,A);p.dispose();f.dispose();t.dispose();r.setViewport(w,z,u,y);r.bindFramebuffer(e);
return 255!==A[0]}}const k=new Image;k.src="data:image/svg+xml,%3C%3Fxml version\x3d'1.0' encoding\x3d'UTF-8'%3F%3E%3Csvg width\x3d'5' height\x3d'5' version\x3d'1.1' viewBox\x3d'0 0 5 5' xmlns\x3d'http://www.w3.org/2000/svg'%3E%3Crect width\x3d'5' height\x3d'5' fill\x3d'%23f00' fill-opacity\x3d'.5'/%3E%3C/svg%3E%0A";k.width=5;k.height=5;k.decode();l.SVGPremultipliedAlpha=b;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/capabilities/Capabilities":function(){define(["exports",
"./DisjointTimerQuery","./load","./LoseContext"],function(l,q,n,d){class m{constructor(h,g){this._gl=h;this._textureFloatLinear=this._textureNorm16=this._loseContext=this._colorBufferFloat=this._textureFilterAnisotropic=this._compressedTextureS3TC=this._compressedTextureETC=null;this._disabledExtensions=g.disabledExtensions||{};this._debugWebGLExtensions=g.debugWebGLExtensions||{}}get compressedTextureETC(){this._compressedTextureETC??(this._compressedTextureETC=n.loadCompressedTextureETC(this._gl,
this._disabledExtensions));return this._compressedTextureETC}get compressedTextureS3TC(){this._compressedTextureS3TC??(this._compressedTextureS3TC=n.loadCompressedTextureS3TC(this._gl,this._disabledExtensions));return this._compressedTextureS3TC}get textureFilterAnisotropic(){this._textureFilterAnisotropic??(this._textureFilterAnisotropic=n.loadTextureFilterAnisotropicCapability(this._gl,this._disabledExtensions));return this._textureFilterAnisotropic}get disjointTimerQuery(){this._disjointTimerQuery??
(this._disjointTimerQuery=q.createDisjointTimerQuery(this._gl,this._disabledExtensions));return this._disjointTimerQuery}get colorBufferFloat(){this._colorBufferFloat??(this._colorBufferFloat=n.loadColorBufferFloat(this._gl,this._disabledExtensions));return this._colorBufferFloat}get loseContext(){this._loseContext??(this._loseContext=d.load(this._gl,this._debugWebGLExtensions));return this._loseContext}get textureNorm16(){this._textureNorm16??(this._textureNorm16=n.loadTextureNorm16(this._gl,this._disabledExtensions));
return this._textureNorm16}get textureFloatLinear(){this._textureFloatLinear??(this._textureFloatLinear=n.loadBooleanExtension(this._gl,this._disabledExtensions,"textureFloatLinear",!1,["OES_texture_float_linear"]));return this._textureFloatLinear}enable(h){return this[h]}}l.Capabilities=m;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/capabilities/load":function(){define(["exports"],function(l){l.loadBooleanExtension=function(q,n,d,m,h){if(m)return!0;if(n[d])return!1;
for(const g of h)if(q.getExtension(g))return!0;return!1};l.loadColorBufferFloat=function(q,n){const d=!n.colorBufferHalfFloat&&q.getExtension("EXT_color_buffer_half_float")||!n.colorBufferFloat&&q.getExtension("EXT_color_buffer_float"),m=!n.colorBufferFloat&&q.getExtension("EXT_color_buffer_float");n=!n.floatBlend&&!n.colorBufferFloat&&q.getExtension("EXT_float_blend");return d||m||n?{textureFloat:!!m,textureHalfFloat:!!d,floatBlend:!!n,R16F:q.R16F,RG16F:q.RG16F,RGBA16F:q.RGBA16F,R32F:q.R32F,RG32F:q.RG32F,
RGBA32F:q.RGBA32F,R11F_G11F_B10F:q.R11F_G11F_B10F,RGB16F:q.RGB16F}:null};l.loadCompressedTextureETC=function(q,n){return n.compressedTextureETC?null:(q=q.getExtension("WEBGL_compressed_texture_etc"))?{COMPRESSED_R11_EAC:q.COMPRESSED_R11_EAC,COMPRESSED_SIGNED_R11_EAC:q.COMPRESSED_SIGNED_R11_EAC,COMPRESSED_RG11_EAC:q.COMPRESSED_RG11_EAC,COMPRESSED_SIGNED_RG11_EAC:q.COMPRESSED_SIGNED_RG11_EAC,COMPRESSED_RGB8_ETC2:q.COMPRESSED_RGB8_ETC2,COMPRESSED_SRGB8_ETC2:q.COMPRESSED_SRGB8_ETC2,COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:q.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2,
COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:q.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2,COMPRESSED_RGBA8_ETC2_EAC:q.COMPRESSED_RGBA8_ETC2_EAC,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:q.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC}:null};l.loadCompressedTextureS3TC=function(q,n){return n.compressedTextureS3TC?null:(q=q.getExtension("WEBGL_compressed_texture_s3tc"))?{COMPRESSED_RGB_S3TC_DXT1:q.COMPRESSED_RGB_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT1:q.COMPRESSED_RGBA_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT3:q.COMPRESSED_RGBA_S3TC_DXT3_EXT,
COMPRESSED_RGBA_S3TC_DXT5:q.COMPRESSED_RGBA_S3TC_DXT5_EXT}:null};l.loadTextureFilterAnisotropicCapability=function(q,n){return n.textureFilterAnisotropic?null:(q=q.getExtension("EXT_texture_filter_anisotropic")||q.getExtension("MOZ_EXT_texture_filter_anisotropic")||q.getExtension("WEBKIT_EXT_texture_filter_anisotropic"))?{MAX_TEXTURE_MAX_ANISOTROPY:q.MAX_TEXTURE_MAX_ANISOTROPY_EXT,TEXTURE_MAX_ANISOTROPY:q.TEXTURE_MAX_ANISOTROPY_EXT}:null};l.loadTextureNorm16=function(q,n){return n.textureNorm16?null:
(q=q.getExtension("EXT_texture_norm16"))?{R16:q.R16_EXT,RG16:q.RG16_EXT,RGB16:q.RGB16_EXT,RGBA16:q.RGBA16_EXT,R16_SNORM:q.R16_SNORM_EXT,RG16_SNORM:q.RG16_SNORM_EXT,RGB16_SNORM:q.RGB16_SNORM_EXT,RGBA16_SNORM:q.RGBA16_SNORM_EXT}:null};Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/capabilities/LoseContext":function(){define(["exports"],function(l){l.load=function(q,n){const d=n.loseContext&&q.getExtension("WEBGL_lose_context");return d?{loseRenderingContext:()=>d.loseContext()}:
null};Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/LabelManager":function(){define("exports ../../chunks/tslib.es6 ../../core/Accessor ../../core/Error ../../core/has ../../core/Logger ../../core/accessorSupport/decorators/property ../../core/RandomLCG ../../core/accessorSupport/decorators/subclass ./engine/webgl/collisions/CollisionEngine".split(" "),function(l,q,n,d,m,h,g,c,a,b){l.LabelManager=class extends n{constructor(k){super(k);this._lastUpdate=0;this.collisionEngine=
new b.CollisionEngine;this.lastUpdateId=-1;this.updateRequested=!1;this.view=null}get updating(){m("esri-2d-log-updating")&&console.log(`Updating LabelManager ${this.updateRequested}:\n-> updateRequested: ${this.updateRequested}`);return this.updateRequested}update(k){const e=performance.now();32<=e-this._lastUpdate?(this._lastUpdate=e,this.doUpdate(k)):this.requestUpdate()}viewChange(){this.requestUpdate()}requestUpdate(){this.updateRequested||(this.updateRequested=!0,this.view?.requestUpdate())}processUpdate(k){this.updateRequested&&
(this.updateRequested=!1,this.update(k))}doUpdate(k){const e=this.view;if(e)try{const r=k.state.scale,f=e.featuresTilingScheme.getClosestInfoForScale(r).level;this.collisionEngine.run(e.allLayerViews.items,k,r,f)}catch(r){}}};q.__decorate([g.property()],l.LabelManager.prototype,"updateRequested",void 0);q.__decorate([g.property()],l.LabelManager.prototype,"updating",null);q.__decorate([g.property()],l.LabelManager.prototype,"view",void 0);l.LabelManager=q.__decorate([a.subclass("esri.views.2d.LabelManager")],
l.LabelManager);Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/collisions/CollisionEngine":function(){define(["exports","../../../../../core/has","../definitions","../enums","./CollisionGrid"],function(l,q,n,d,m){function h(a,b){a=a.children.slice();a.sort((k,e)=>k.tileAge-e.tileAge);a.forEach(k=>{null!=k.labelMetrics&&k.isReady&&b(k,k.labelMetrics)})}function g(a,b){return(!a.minScale||a.minScale>=b)&&(!a.maxScale||a.maxScale<=b)}class c{run(a,b,k,e){const r=
[];for(let f=a.length-1;0<=f;f--){const p=a[f];p.labelingCollisionInfos?.length&&r.push(...p.labelingCollisionInfos)}q("esri-2d-update-debug")&&r.length&&console.debug("CollisionEngine.run");this._transformMetrics(r);this._runCollision(r,b,k,e);for(const f of r)f.container.requestRender()}_runCollision(a,b,k,e){const [r,f]=b.state.size,p=new m.CollisionBitsetGrid(r,f,b.pixelRatio);for(const {container:t,deconflictionEnabled:w,visible:z}of a){const u=t.attributeView;w?z?(this._prepare(t),this._collideVisible(p,
t,k,e),this._collideInvisible(p,t)):h(t,(y,A)=>{for(const v of A)u.setLabelMinZoom(v.entityTexel,255)}):h(t,(y,A)=>{for(const v of A)g(v,k)?(u.setLabelMinZoom(v.entityTexel,0),z&&p.insertMetrics(v)):u.setLabelMinZoom(v.entityTexel,254)})}}_isFiltered(a,b,k){a=b.getFilterFlags(a);b=null==k.featureEffect||k.featureEffect.excludedLabelsVisible||!!(a&n.effectFlag0);return!((!k.hasFilter||a&n.filterFlag0)&&b)}_prepare(a){const b=a.attributeView,k=new Set;h(a,(e,r)=>{for(const f of r)e=f.entityTexel,k.has(e)||
(k.add(e),this._isFiltered(e,b,a.layerView)?b.setLabelMinZoom(e,254):0!==b.getLabelMinZoom(e)?b.setLabelMinZoom(e,255):b.setLabelMinZoom(e,0))})}_collideVisible(a,b,k,e){const r=b.attributeView,f=new Set;h(b,(p,t)=>{for(var w=0;w<t.length;w++){const u=t[w].entityTexel;if(f.has(u))continue;if(p.key.level!==e){r.setLabelMinZoom(u,254);f.add(u);continue}if(!g(t[w],k)){r.setLabelMinZoom(u,254);f.add(u);continue}if(0!==r.getLabelMinZoom(u)){f.add(u);continue}let y=!1,A=!0;for(var z=w;w<t.length;w++){const v=
t[w];if(v.entityTexel!==u)break;if(!y)switch(a.hasCollision(v)){case m.hasCollision:y=!0;A=!1;break;case m.none:A=!1}}if(!y)for(;z<w;z++)a.insertMetrics(t[z]);--w;A||(f.add(u),r.setLabelMinZoom(u,y?254:0))}})}_collideInvisible(a,b){const k=b.attributeView,e=new Set;h(b,(r,f)=>{for(var p=0;p<f.length;p++){r=f[p].entityTexel;if(e.has(r))continue;if(255!==k.getLabelMinZoom(r)){e.add(r);continue}let w=!1,z=!0;for(var t=p;p<f.length;p++){const u=f[p];if(u.entityTexel!==r)break;if(!w)switch(a.hasCollision(u)){case m.hasCollision:w=
!0;z=!1;break;case m.none:z=!1}}if(!w)for(;t<p;t++)a.insertMetrics(f[t]);--p;z||(e.add(r),k.setLabelMinZoom(r,w?255:0))}})}_transformMetrics(a){for(const {container:b,geometryType:k,vvEvaluators:e}of a)h(b,(r,f)=>{const p=b.attributeView;r=r.transforms.labelMat2d;r[4]=Math.round(r[4]);r[5]=Math.round(r[5]);const t="polyline"===k;for(const y of f){const {entityTexel:A,anchorX:v,anchorY:x}=y;f=y.referenceBounds?.size??0;var w=e[0];if(null!=w){var z=p.getVisualVariableData(A,d.VVBinding.SIZE);w=w(z);
f=isNaN(w)||null==w||Infinity===w?f:w}w=n.labelPlacementOffsetPadding+f/2;f=y.directionX*w;w*=y.directionY;for(const C of y.bounds){z=v;var u=x;if(t){u=v+C.x+f;const B=x+C.y+w;z=r[0]*u+r[2]*B+r[4];u=r[1]*u+r[3]*B+r[5];C.transformedX=Math.floor(z);C.transformedY=Math.floor(u)}else z=r[0]*v+r[2]*x+r[4],u=r[1]*v+r[3]*x+r[5],u=u+C.y+w,C.transformedX=z+C.x+f,C.transformedY=u}}})}}l.CollisionEngine=c;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/collisions/CollisionGrid":function(){define(["exports",
"../../../../../core/mathUtils","../../../layers/features/support/StaticBitSet"],function(l,q,n){class d{constructor(m,h,g){this._width=m*g;this._height=h*g;this._pixelRatio=g;m=Math.ceil(this._width/1);h=Math.ceil(this._height/1);this._cols=m;this._rows=h;this._cells=n.StaticBitSet.create(m*h)}insertMetrics(m){this._markMetrics(m)}hasCollision(m){let h=0;for(const {transformedX:g,transformedY:c,width:a,height:b}of m.bounds)switch(this._collide(g*this._pixelRatio,c*this._pixelRatio,a*this._pixelRatio,
b*this._pixelRatio)){case 2:return 2;case 1:h++}return h===m.bounds.length?1:0}getCellId(m,h){return m+h*this._cols}has(m){return this._cells.has(m)}hasRange(m,h){return this._cells.hasRange(m,h)}set(m){this._cells.set(m)}setRange(m,h){this._cells.setRange(m,h)}_collide(m,h,g,c){m-=g/2;h-=c/2;g=m+g;var a=h+c;if(0>g||0>a||m>this._width||h>this._height)return 1;c=q.clamp(Math.floor(m/1),0,this._cols);var b=q.clamp(Math.floor(h/1),0,this._rows);m=q.clamp(Math.ceil(g/1),0,this._cols);h=q.clamp(Math.ceil(a/
1),0,this._rows);for(g=b;g<=h;g++)for(a=c;a<=m;a++)if(b=this.getCellId(a,g),this.has(b))return 2;return 0}_mark(m,h,g,c){m-=g/2;h-=c/2;g=m+g;var a=h+c;c=q.clamp(Math.floor(m/1),0,this._cols);var b=q.clamp(Math.floor(h/1),0,this._rows);m=q.clamp(Math.ceil(g/1),0,this._cols);h=q.clamp(Math.ceil(a/1),0,this._rows);for(g=b;g<=h;g++)for(a=c;a<=m;a++)b=this.getCellId(a,g),this.set(b);return!1}_markMetrics(m){for(const {transformedX:h,transformedY:g,width:c,height:a}of m.bounds)this._mark(h*this._pixelRatio,
g*this._pixelRatio,c*this._pixelRatio,a*this._pixelRatio)}}l.CollisionBitsetGrid=d;l.hasCollision=2;l.none=0;l.outsideExtent=1;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/support/StaticBitSet":function(){define(["exports"],function(l){class q{static fromBuffer(n,d){return new q(n,d)}static create(n,d=4294967295){n=new Uint32Array(Math.ceil(n/32));return new q(n,d)}constructor(n,d){this._mask=0;this._buf=n;this._mask=d}_getIndex(n){return Math.floor(n/
32)}has(n){n&=this._mask;return!!(this._buf[this._getIndex(n)]&1<<n%32)}hasRange(n,d){for(;n%32&&n!==d;){if(this.has(n))return!0;n++}for(;d%32&&n!==d;){if(this.has(n))return!0;d--}if(n===d)return!1;for(n/=32;n!==d/32;n++)if(this._buf[n])return!0;return!1}set(n){n&=this._mask;const d=this._getIndex(n);this._buf[d]|=1<<n%32}setRange(n,d){for(;n%32&&n!==d;)this.set(n++);for(;d%32&&n!==d;)this.set(d--);if(n!==d)for(n/=32;n!==d/32;n++)this._buf[n]=4294967295}unset(n){n&=this._mask;const d=this._getIndex(n);
this._buf[d]&=4294967295^1<<n%32}resize(n){const d=this._buf;n=new Uint32Array(Math.ceil(n/32));n.set(d);this._buf=n}or(n){for(let d=0;d<this._buf.length;d++)this._buf[d]|=n._buf[d];return this}and(n){for(let d=0;d<this._buf.length;d++)this._buf[d]&=n._buf[d];return this}xor(n){for(let d=0;d<this._buf.length;d++)this._buf[d]^=n._buf[d];return this}ior(n){for(let d=0;d<this._buf.length;d++)this._buf[d]|=~n._buf[d];return this}iand(n){for(let d=0;d<this._buf.length;d++)this._buf[d]&=~n._buf[d];return this}ixor(n){for(let d=
0;d<this._buf.length;d++)this._buf[d]^=~n._buf[d];return this}any(){for(let n=0;n<this._buf.length;n++)if(this._buf[n])return!0;return!1}copy(n){for(let d=0;d<this._buf.length;d++)this._buf[d]=n._buf[d];return this}clone(){return new q(this._buf.slice(),this._mask)}clear(){for(let n=0;n<this._buf.length;n++)this._buf[n]=0;return this}forEachSet(n){for(let d=0;d<this._buf.length;d++){let m=this._buf[d],h=32*d;if(m)for(;m;)m&1&&n(h),m>>>=1,h++}}countSet(){let n=0;this.forEachSet(d=>{n++});return n}}
l.StaticBitSet=q;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/graphics/GraphicsView2D":function(){define("../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/arrayUtils ../../../../core/has ../../../../core/Identifiable ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/Logger ../../../../core/accessorSupport/decorators/subclass ../../../../geometry/support/aaBoundingRect ../../../../geometry/support/jsonUtils ../../../../layers/support/FieldsIndex ../../../../symbols/cim/CIMSymbolHelper ../../../../symbols/cim/OverrideHelper ../../../../symbols/support/defaults ../../engine/webgl/definitions ../../engine/webgl/FeatureTile ../../engine/webgl/mesh/MeshData ../../engine/webgl/mesh/factories/ResourceProxy ../../engine/webgl/shaderGraph/techniques/createGraphicSymbolMeshSchemas ../features/schema/processor/StorageSchema ../features/support/AttributeStore ../features/support/ComputedAttributeStorage ../features/support/FeatureMetadata ../features/support/GraphicsReader ./GraphicStore ../support/FeatureCommandQueue ../support/UpdateTracking2D".split(" "),
function(l,q,n,d,m,h,g,c,a,b,k,e,r,f,p,t,w,z,u,y,A,v,x,C,B,E,D,F,G,H){class I{static getOrCreate(K,L,R){let S=L.get(K.id);S||(S=new I(K,R),L.set(K.id,S));return S}static fromItems(K,L,R){K=new I(K,R);for(const S of L)K.append(S);return K}constructor(K,L){this.tile=K;this.metadata=L;this.addedOrModified=[];this.removed=[];this.objectIdMap=null}get reader(){this._reader||(this._reader=D.GraphicsReader.from(this.addedOrModified,this.tile,this.metadata));return this._reader}append(K){this.addedOrModified.push(K);
K.hasAnimations&&(this.objectIdMap=this.objectIdMap||{},this.objectIdMap[K.displayId]=K.objectId)}}q=class extends m.IdentifiableMixin(q){constructor(K){super(K);this._attached=!1;this._tiles=new Map;this._controller=new AbortController;this._hashToSymbolInfo=new Map;this._lastCleanup=performance.now();this._cleanupRequired=!0;this.lastUpdateId=-1;this.renderer=null;this._updateTracking=new H.UpdateTracking2D({debugName:"GraphicsView2D"});this.updateRequested=!1;this.defaultPointSymbolEnabled=!0;
this._commandQueue=new G({process:L=>{switch(L.type){case "update":return this._update();default:throw Error("InternalError: Unsupported command");}}});this.graphicUpdateHandler=this.graphicUpdateHandler.bind(this)}destroy(){this.container.destroy();this.renderer=this.view=null;this._set("graphics",null);this._controller.abort();this._graphicStore.clear();this._graphicStore.destroy();this._attributeStore=null;this._hashToSymbolInfo.clear();this._updateTracking.destroy();this._commandQueue.destroy()}_initAttributeStore(){this._storage=
new B.ComputedAttributeStorage({spatialReference:this.view.spatialReference,fields:new f});this._attributeStore=new C.AttributeStore({isLocal:!0,update:L=>{d("esri-2d-update-debug")&&console.debug(`[Id: ${this.layerId}] GraphicsView2D.AttributeStoreView.updateStart`,{message:L});this.container.attributeView.requestUpdate(L);this.container.requestRender();d("esri-2d-update-debug")&&console.debug(`[Id: ${this.layerId}] GraphicsView2D.AttributeStoreView.updateEnd`,{message:L})}});const K=x.createStorageSchema(null,
[]);this._attributeStore.update(K,this._storage,null);this.container.checkHighlight=()=>this._attributeStore.hasHighlight}initialize(){this._initAttributeStore();this._metadata=E.GraphicsMetadata.createGraphics(this.view.spatialReference);this._resourceProxy=new A.ResourceProxy({fetch:K=>Promise.all(K.map(L=>this.view.stage.textureManager.rasterizeItem(L))),fetchDictionary:K=>{throw Error("InternalError: Graphics do not support Dictionary requests");}});this.addHandles([c.watch(()=>this._effectiveRenderer,
()=>this._pushUpdate()),this.view.graphicsTileStore.on("update",this._onTileUpdate.bind(this)),this.container.on("attach",()=>{this.addHandles([this.graphics.on("change",()=>this._pushUpdate())]);this._graphicStore?.destroy();this._graphicStore=new F(this.view.spatialReference,this._cimResourceManager,this.view.featuresTilingScheme,this.view.state.scale,this._attributeStore);this._attached=!0;this.requestUpdate();this._pushUpdate()})]);this._updateTracking.addUpdateTracking("CommandQueue",this._commandQueue.updateTracking);
this._onTileUpdate({added:this.view.graphicsTileStore.tiles,removed:[]})}get _effectiveRenderer(){return"function"===typeof this.renderer?this.renderer():this.renderer}get _cimResourceManager(){return this.view.stage.textureManager.resourceManager}get updating(){const K=!this._attached||this._updateTracking.updating;d("esri-2d-log-updating")&&console.log(`Updating GraphicsView2D: ${K}\n  -> attaching ${!this._attached}\n  -> updateTracking ${this._updateTracking.updating}`);return K}hitTest(K){if(!this.view||
this.view.suspended)return[];const {resolution:L,rotation:R}=this.view.state;K=this._graphicStore.hitTest(K.x,K.y,2,L,R);const S=new Set(K),W=this.graphics.items.reduce((J,O)=>{S.has(O.uid)&&J.set(O.uid,O);return J},new Map);return K.map(J=>W.get(J)).filter(n.isSome)}requestUpdate(){this.updateRequested||(this.updateRequested=!0,this.requestUpdateCallback());this.notifyChange("updating")}processUpdate(K){this.updateRequested&&(this.updateRequested=!1,this.update(K))}viewChange(){this.requestUpdate()}setHighlight(K){const L=
[];for(const {objectId:R,highlightFlags:S}of K){const W=this._graphicStore.getItem(R)?.displayId;L.push({objectId:R,highlightFlags:S,displayId:W})}this._attributeStore.setHighlight(L,K);this._pushUpdate()}graphicUpdateHandler(K){this._pushUpdate()}update(K){this.updateRequested=!1;this._attached&&this._graphicStore.updateLevel(K.state.resolution)}pushUpdate(){this._pushUpdate()}_pushUpdate(){g.ignoreAbortErrors(this._commandQueue.push({type:"update"}))}async _update(){try{d("esri-2d-update-debug")&&
console.debug(`[Id: ${this.layerId}] GraphicsView._update start`);const K=await this._graphicStore.update(this.graphics,R=>this._getSymbolForGraphic(R),R=>this._ensureSymbolResource(R));for(const R of K.updated)this.container.restartAnimation(R.objectId);if(!K.hasAnyUpdate()){this._attributeStore.sendUpdates();return}K.removed.length&&(this._cleanupRequired=!0);d("esri-2d-update-debug")&&console.debug(`[Id: ${this.layerId}] GraphicsView updateMessage`,K);const L=this._createTileMessages(K);await this._fetchResources(L);
this._write(L);for(const R of K.added)this._setFilterState(R);for(const R of K.updated)this._setFilterState(R);d("esri-2d-update-debug")&&console.debug(`[Id: ${this.layerId}] GraphicsView sendUpdate`,K);this._attributeStore.sendUpdates();d("esri-2d-update-debug")&&console.debug(`[Id: ${this.layerId}] GraphicsView sendUpdate.await`,K)}catch(K){}this._cleanupSharedResources()}_createTileMessages(K){const L=new Map;for(var R of K.added){var S=this.view.graphicsTileStore.getIntersectingTiles(R.bounds);
for(const W of S)I.getOrCreate(W,L,this._metadata).append(R)}for(const W of K.updated){R=this.view.graphicsTileStore.getIntersectingTiles(W.prevBounds);S=this.view.graphicsTileStore.getIntersectingTiles(W.bounds);for(const J of R)I.getOrCreate(J,L,this._metadata).removed.push(W.displayId);for(const J of S)I.getOrCreate(J,L,this._metadata).append(W)}for(const W of K.removed){K=this.view.graphicsTileStore.getIntersectingTiles(W.bounds);for(const J of K)I.getOrCreate(J,L,this._metadata).removed.push(W.displayId)}return Array.from(L.values())}async _fetchResources(K){for(const {tile:L,
reader:R}of K){d("esri-2d-update-debug")&&console.debug(`Id[${this.layerId}] Tile[${L.id}] GraphicsView fetchResources`,K);const S=R.getCursor();for(;S.next();)for(const W of S.getMeshWriters())W.enqueueRequest(this._resourceProxy,S,L.createArcadeEvaluationOptions(this.view.timeZone))}await this._resourceProxy.fetchEnqueuedResources()}_write(K){for(const L of K){d("esri-2d-update-debug")&&console.debug(`Id[${this.layerId}] Tile[${L.tile.id}] GraphicsView write`,L);K=this._writeMeshes(L);let R=this._tiles.get(L.tile.key);
R||=this._createFeatureTile(L.tile.key);d("esri-2d-update-debug")&&console.debug(`Id[${this.layerId}] Tile[${L.tile.id}] GraphicsView onTileData`,L);this.container.onTileData(R,{type:"update",modify:K,remove:L.removed,end:!1,attributeEpoch:this._attributeStore.epoch,objectIdMap:L.objectIdMap});this.container.requestRender()}}_writeMeshes(K){const L=new y.MeshData(K.tile.id),R=K.reader.getCursor();for(;R.next();){L.entityStart(R.getDisplayId(),R.getZOrder());for(const S of R.getMeshWriters())S.write(L,
this._resourceProxy,R,K.tile.createArcadeEvaluationOptions(this.view.timeZone),K.tile.level);L.entityEnd()}return{...L.serialize().message,tileId:K.tile.id}}_setFilterState(K){const L=K.displayId,R=this._attributeStore.getHighlightFlags(K.objectId);this._attributeStore.setData(L,0,0,R|(K.visible?z.filterFlag0:0))}_getSymbolForGraphic(K){return null!=K.symbol?K.symbol:null!=this._effectiveRenderer?this._effectiveRenderer.getSymbol(K):this._getNullSymbol(K)}async _ensureSymbolResource(K){if(K.symbol){var L=
await this._getSymbolInfo(K.symbol);if(L){var R=L.linearCIM.filter(S=>"text"===S.type);0<R.length?(R=await this._getTextResources(K,R),K.symbolResource={symbolInfo:L,textInfo:R}):K.symbolResource={symbolInfo:L}}}}_getSymbolInfo(K){const L=K.hash();this._hashToSymbolInfo.has(L)||this._hashToSymbolInfo.set(L,this._createSymbolInfo(L,K).catch(R=>null));return this._hashToSymbolInfo.get(L)}async _createSymbolInfo(K,L){L=await this._convertToCIMSymbol(L);const R=await this._createLinearCIM(L),S=await this._createMeshWriters(L,
R);return{hash:K,cimSymbol:L,linearCIM:R,meshWriters:S}}async _convertToCIMSymbol(K){K=p.symbolToCIM(K);return"web-style"===K.type?(await K.fetchCIMSymbol()).data:K}async _createLinearCIM(K){await Promise.all(p.CIMSymbolHelper.fetchResources(K.symbol,this._cimResourceManager,[]));return this.view.stage.cimAnalyzer.analyzeSymbolReference(K,!1)}async _createMeshWriters(K,L){g.throwIfAborted(this._controller.signal);const R=this.view.stage.meshWriterRegistry;K=await v.createGraphicSymbolMeshSchemas(K,
L,this.container.instanceStore);return Promise.all(K.map(S=>R.createMeshWriter(this._storage,this._resourceProxy,{tileInfo:this.view.featuresTilingScheme.tileInfo},S)))}_onTileUpdate(K){if(K.added&&0<K.added.length)for(const L of K.added)this._updateTracking.addPromise(this._addTile(L));if(K.removed&&0<K.removed.length)for(const L of K.removed)this._removeTile(L.key)}_createFeatureTile(K){var L=this.view.featuresTilingScheme.getTileBounds(e.create(),K);const R=this.view.featuresTilingScheme.getTileResolution(K.level);
L=new u.FeatureTile(K,R,L[0],L[3]);this._tiles.set(K,L);this.container.addChild(L);return L}async _addTile(K){if(this._attached){var L=this._graphicStore.queryItems(K);if(L.length){var R=this._createFeatureTile(K.key);K=I.fromItems(K,L,this._metadata);await this._fetchResources([K]);L=this._writeMeshes(K);R.onMessage({type:"append",append:L,clear:!1,end:!0,attributeEpoch:this._attributeStore.epoch,objectIdMap:K.objectIdMap})}}}_removeTile(K){if(this._tiles.has(K)){var L=this._tiles.get(K);this.container.removeChild(L);
L.destroy();this._tiles.delete(K)}}_getNullSymbol(K){K=K.geometry;return r.isPolyline(K)?w.errorPolylineSymbol2D:r.isPolygon(K)||r.isExtent(K)?w.errorPolygonSymbol2D:this.defaultPointSymbolEnabled?w.errorPointSymbol2D:null}async _getTextResources(K,L){var R=[];const S=[];for(var W=0;W<L.length;W++){const O=L[W],{resource:T,overrides:X}=O.textRasterizationParam;if(0<X?.length){var J=t.OverrideHelper.resolveSymbolOverrides({type:"CIMSymbolReference",primitiveOverrides:X,symbol:{type:"CIMPointSymbol",
symbolLayers:[{type:"CIMVectorMarker",enable:!0,size:T.symbol.height,anchorPointUnits:"Relative",frame:{xmin:-5,ymin:-5,xmax:5,ymax:5},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{x:0,y:0},symbol:T.symbol,textString:T.textString}],scaleSymbolsProportionally:!0,respectFrame:!0}]}},K,this.view.spatialReference,null,r.getJsonType(K.projectedGeometry),null,null);J.then(U=>{({textString:U}=U.symbolLayers[0].markerGraphics[0]);S.push({type:"cim-rasterization-info",resource:{type:"text",textString:U||
"",font:T.font}});O.text=T.textString=U||""});R.push(J)}else S.push({type:"cim-rasterization-info",resource:T})}0<R.length&&await Promise.all(R);K=S.map(O=>this.view.stage.textureManager.rasterizeItem(O));K=await Promise.all(K);h.assertIsSome(K);R=new Map;for(W=0;W<L.length;W++)J=L[W],R.set(J.textRasterizationParam.resource.symbol,{text:J.text,glyphMosaicItems:K[W]});return R}_cleanupSharedResources(){if(this._cleanupRequired){var K=performance.now();if(!(5E3>K-this._lastCleanup)){this._cleanupRequired=
!1;this._lastCleanup=K;K=new Set;for(var L of this._graphicStore.items())K.add(L.symbolResource?.symbolInfo.hash);L=new Set(this._hashToSymbolInfo.keys());for(const R of L.values())K.has(R)||this._hashToSymbolInfo.delete(R)}}}};l.__decorate([a.property()],q.prototype,"_effectiveRenderer",null);l.__decorate([a.property({constructOnly:!0})],q.prototype,"layerId",void 0);l.__decorate([a.property({constructOnly:!0})],q.prototype,"requestUpdateCallback",void 0);l.__decorate([a.property()],q.prototype,
"container",void 0);l.__decorate([a.property({constructOnly:!0})],q.prototype,"graphics",void 0);l.__decorate([a.property()],q.prototype,"renderer",void 0);l.__decorate([a.property()],q.prototype,"_updateTracking",void 0);l.__decorate([a.property()],q.prototype,"updating",null);l.__decorate([a.property()],q.prototype,"view",void 0);l.__decorate([a.property()],q.prototype,"updateRequested",void 0);l.__decorate([a.property()],q.prototype,"defaultPointSymbolEnabled",void 0);return q=l.__decorate([k.subclass("esri.views.2d.layers.graphics.GraphicsView2D")],
q)})},"esri/views/2d/engine/webgl/mesh/MeshData":function(){define(["exports","../DisplayEntity","../DisplayRecord","./VertexDataWriter","../util/Writer"],function(l,q,n,d,m){class h{constructor(g,c=0){this._id=g;this._sizeHint=c;this._entitySortKeyIndex=this._entityIdIndex=this._entityCountOffset=this._entityRecordCountOffset=0;this._didEntityStart=!1;this._instanceIdToVertexData=new Map;this._recordVertexCount=this._recordVertexStart=this._recordIndexCount=this._recordIndexStart=0;this._current=
{metric:null,writer:null,start:0,sortKey:0,instanceId:0,layoutHash:0,indexStart:0,vertexStart:0,textureKey:0,metricBoxLenPointer:0};this._entities=new m(Uint32Array,this._sizeHint*q.byteSizeHint);this._entityCountOffset=this._entities.push(0)}get id(){return this._id}serialize(){const g=[],c=[],a=this._entities.buffer();for(const b of this._instanceIdToVertexData.values())c.push(b.serialize(g));return{message:{data:c,entities:a},transferList:g}}vertexCount(){return this._current.writer?.vertexCount??
0}indexCount(){return this._current.writer?.indexCount??0}vertexEnsureSize(g){this._current.writer.vertexEnsureSize(g)}indexEnsureSize(g){this._current.writer.indexEnsureSize(g)}vertexWrite(g){this._current.writer.writeVertex(g)}vertexWriteRegion(g){this._current.writer.writeVertexRegion(g)}vertexWriteF32(g){this._current.writer.writeVertexF32(g)}recordBounds(g,c,a,b){}indexWrite(g){this._current.writer.writeIndex(g)}metricStart(g){this._current.metric=g}metricEnd(){this._current.metric.bounds.length&&
this._current.writer.writeMetric(this._current.metric)}metricBoxWrite(g){this._current.metric.bounds.push(g)}entityStart(g,c=g){this._entityIdIndex=this._entities.push(g);this._entitySortKeyIndex=this._entities.writeF32(c);this._entityRecordCountOffset=this._entities.push(0);this._didEntityStart=!0}entityRecordCount(){return this._entities.getValue(this._entityRecordCountOffset)}entityEnd(){this._didEntityStart&&(0===this.entityRecordCount()?this._entities.seek(this._entityIdIndex):this._entities.incr(this._entityCountOffset),
this._didEntityStart=!1)}recordCount(){return this._entities.getValue(this._entityRecordCountOffset)}recordStart(g,c,a=0){this._current.writer=this._getVertexWriter(g,c);this._current.indexStart=this._current.writer.indexCount;this._current.vertexStart=this._current.writer.vertexCount;this._current.instanceId=g;this._current.layoutHash=c.hash;this._current.textureKey=a}recordEnd(g=0){const c=this._current.vertexStart,a=this._current.writer.vertexCount-c;if(!a)return!1;const b=this._current.indexStart,
k=this._current.writer.indexCount-b;this._recordIndexStart=b;this._recordIndexCount=k;this._recordVertexStart=c;this._recordVertexCount=a;this._entities.incr(this._entityRecordCountOffset);n.write(this._entities,this._current.instanceId,this._current.textureKey,b,k,c,a,g);return!0}copyLast(g,c){var a=this._recordVertexStart+this._recordVertexCount;this._entities.incr(this._entityRecordCountOffset);n.write(this._entities,this._current.instanceId,this._current.textureKey,this._recordIndexStart+this._recordIndexCount,
this._recordIndexCount,a,this._recordVertexCount,0);var b=this._current.writer.indexWriter;const k=this._current.writer.vertexWriter;var e=this._recordIndexStart+this._recordIndexCount,r=this._recordVertexCount;for(var f=this._recordIndexStart;f!==e;f++){const p=b.getValue(f);b.push(p+r)}b=this._current.writer.layout.stride/Uint32Array.BYTES_PER_ELEMENT;r=this._recordVertexStart*b;for(e=(this._recordVertexStart+this._recordVertexCount)*b;r!==e;r++)f=k.getValue(r),k.push(f);e=this._current.writer.layout.position;
r=e.packPrecisionFactor??1;e=e.offset/Uint32Array.BYTES_PER_ELEMENT;g*=r;c*=r;for(a*=b;a<=k.length;a+=b)k.i1616Add(a+e,g,c)}copyLastFrom(g,c,a){var b=g._entities.getValue(g._entityIdIndex),k=this._entities.getValue(this._entityIdIndex);b!==k&&(k=g._entities.getValueF32(g._entitySortKeyIndex),this.entityStart(b,k));this.recordStart(g._current.instanceId,g._current.writer.layout,g._current.textureKey);b=this._current.writer.layout.stride/Uint32Array.BYTES_PER_ELEMENT;var e=this._current.vertexStart,
r=g._current.vertexStart-e;const f=this._current.writer.indexWriter;k=this._current.writer.vertexWriter;const p=g._current.writer.indexWriter;var t=g._current.writer.vertexWriter;for(let w=g._current.indexStart;w!==p.length;w++){const z=p.getValue(w);f.push(z-r)}for(g=g._current.vertexStart*b;g!==t.length;g++)r=t.getValue(g),k.push(r);g=this._current.writer.layout.position;t=g.packPrecisionFactor??1;g=g.offset/Uint32Array.BYTES_PER_ELEMENT;c*=t;a*=t;for(e*=b;e<=k.length;e+=b)k.i1616Add(e+g,c,a);this.recordEnd()}_getVertexWriter(g,
c){const a=this._instanceIdToVertexData;a.has(g)||a.set(g,new d.VertexDataWriter(g,c,this._sizeHint));return a.get(g)}}l.MeshData=h;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/mesh/VertexDataWriter":function(){define(["exports","../util/Writer"],function(l,q){class n{constructor(d,m,h=0){const g=6*h*Uint32Array.BYTES_PER_ELEMENT;h=4*h*m.stride;const c=m.stride/4,a=m.attributes.find(b=>"pos"===b.name||"position"===b.name);if(!a)throw Error("InternalError: Unable to find position attribute");
this.layout={...m,position:a};this._indices=new q(Uint32Array,g);this._vertices=new q(Uint32Array,h);this._metrics=new q(Uint32Array,0);this._metricCountOffset=this._metrics.push(0);this._strideInt=c;this._instanceId=d}serialize(d){const m=this._indices.buffer(),h=this._vertices.buffer(),g=this._metrics.length?this._metrics.buffer():null;d.push(m,h);return{instanceId:this._instanceId,layout:this.layout,indices:m,vertices:h,metrics:g}}get strideInt(){return this._strideInt}get vertexCount(){return this._vertices.length/
this._strideInt}get indexCount(){return this._indices.length}get indexWriter(){return this._indices}get vertexWriter(){return this._vertices}get metricWriter(){return this._metrics}vertexEnsureSize(d){this._vertices.ensureSize(d)}indexEnsureSize(d){this._indices.ensureSize(d)}writeIndex(d){this._indices.push(d)}writeVertex(d){this._vertices.push(d)}writeVertexRegion(d){this._vertices.writeRegion(d)}writeVertexF32(d){this._vertices.writeF32(d)}writeMetric(d){this._metrics.incr(this._metricCountOffset);
d.serialize(this._metrics)}}l.VertexDataWriter=n;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/util/Writer":function(){define(function(){class l{get length(){return this._pos}constructor(q,n){this._pos=0;n=n?this._roundToNearest(n,q.BYTES_PER_ELEMENT):40;this._array=new ArrayBuffer(n);this._buffer=new q(this._array);this._ctor=q;this._i16View=new Int16Array(this._array)}_roundToNearest(q,n){q=Math.round(q);return 1===n?q:q+(n-q%n)}_ensureSize(q){if(this._pos+
q>=this._buffer.length){q=this._roundToNearest(1.25*(this._array.byteLength+q*this._buffer.BYTES_PER_ELEMENT),this._buffer.BYTES_PER_ELEMENT);q=new ArrayBuffer(q);const n=new this._ctor(q);n.set(this._buffer,0);this._array=q;this._buffer=n;this._i16View=new Int16Array(this._array)}}ensureSize(q){this._ensureSize(q)}writeF32(q){this._ensureSize(1);const n=this._pos;(new Float32Array(this._array,4*this._pos,1))[0]=q;this._pos++;return n}push(q){this._ensureSize(1);const n=this._pos;this._buffer[this._pos++]=
q;return n}writeFixed(q){this._buffer[this._pos++]=q}setValue(q,n){this._buffer[q]=n}i1616Add(q,n,d){this._i16View[2*q]+=n;this._i16View[2*q+1]+=d}getValue(q){return this._buffer[q]}getValueF32(q){return(new Float32Array(this._array,4*q,1))[0]}incr(q){if(this._buffer.length<q)throw Error("Increment index overflows the target buffer");this._buffer[q]++}decr(q){this._buffer[q]--}writeRegion(q){this._ensureSize(q.length);const n=this._pos;this._buffer.set(q,this._pos);this._pos+=q.length;return n}writeManyFrom(q,
n,d){for(this._ensureSize(d-n);n!==d;n++)this.writeFixed(q._buffer[n])}buffer(){const q=this._array.slice(0,4*this._pos);this.destroy();return q}toArray(){return[...this._buffer]}seek(q){this._pos=q}destroy(){this._buffer=this._array=null}}return l})},"esri/views/2d/engine/webgl/mesh/factories/ResourceProxy":function(){define(["exports","../../../../../../core/string","../../Utils","../../shaderGraph/techniques/mesh/AResourceProxy"],function(l,q,n,d){class m extends d.AResourceProxy{constructor(h){super();
this._fetcher=h;this._controller=new AbortController;this._pendingIds=new Set;this._pendingRequests=[];this._resourceIdToResource=new Map}destroy(){this._controller.abort()}get _abortOptions(){return{signal:this._controller.signal}}enqueueRequest(h){var g=n.discardUrlIfHasUrlHash(h.resource);g=q.numericHash(JSON.stringify(g));if(this._pendingIds.has(g))return g;this._pendingIds.add(g);this._pendingRequests.push({...h,resourceId:g});return g}async fetchEnqueuedResources(){const h=this._pendingRequests;
this._pendingIds.clear();this._pendingRequests=[];const g=await this._fetcher.fetch(h,this._abortOptions);for(let c=0;c<g.length;c++)this._resourceIdToResource.set(h[c].resourceId,g[c])}async fetchResourceImmediate(h){h=await this._fetcher.fetch([h],this._abortOptions);if(1!==h.length)throw Error("FeaturePipelineResourceProxy: failed to fetch resources");return h[0]}async fetchDictionaryResourceImmediate(h){h=await this._fetcher.fetchDictionary([h],this._abortOptions);if(1!==h.length)throw Error("FeaturePipelineResourceProxy: failed to fetch dictionary resources");
return h[0]}getResource(h){return this._resourceIdToResource.get(h)}}l.ResourceProxy=m;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/mesh/AResourceProxy":function(){define(["exports"],function(l){class q{}l.AResourceProxy=q;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/createGraphicSymbolMeshSchemas":function(){define(["exports","../../../../layers/features/schema/processor/VisualVariablesSchema",
"../../../../layers/features/schema/processor/symbols/ComplexSymbolSchema"],function(l,q,n){l.createGraphicSymbolMeshSchemas=async function(d,m,h){const g=[];d={scaleInfo:n.getScaleInfo(d),scaleExpression:null};for(const c of m)switch(c.type){case "marker":if(c.animationParams){g.push(...n.createAnimatedMarkerMeshInfos(h.instances.animatedMarker,c,q.noVisualVariables,d));break}g.push(...n.createComplexMarkerMeshInfos(h.instances.marker,c,q.noVisualVariables,d));break;case "fill":null==c.spriteRasterizationParam?
g.push(...n.createComplexSimpleFillMeshInfos(h.instances.fill,c,d)):g.push(...n.createComplexFillMeshInfos(h.instances.complexFill,c,!1,d));break;case "line":c.spriteRasterizationParam?g.push(...n.createComplexTexturedLineMeshInfos(h.instances.texturedLine,c,!1,d)):g.push(...n.createComplexSimpleLineMeshInfos(h.instances.line,c,!1,d));break;case "text":g.push(...n.createComplexTextMeshInfos(h.instances.text,c,q.noVisualVariables,d))}return g};Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},
"esri/views/2d/layers/features/schema/processor/VisualVariablesSchema":function(){define("exports ../../../../../../core/has ../../../../../../core/screenUtils ../../../../../../core/unitUtils ../../../../../../renderers/support/lengthUtils ../../../../engine/webgl/definitions ../../../../engine/webgl/shaderGraph/techniques/shaders/constants ./schemaUtils ../../support/rendererUtils".split(" "),function(l,q,n,d,m,h,g,c,a){function b(z){if(!z.stops?.length)return null;z=z.stops.sort((y,A)=>y.value-
A.value);var u=c.padStops(z,8);z=u.map(({value:y})=>y);u=u.map(({color:y})=>c.premultiplyColor(y));return{values:z,colors:u}}function k(z){if(!z.stops?.length)return null;z=z.stops.sort((y,A)=>y.value-A.value);var u=c.padStops(z,8);z=u.map(({value:y})=>y);u=u.map(({opacity:y})=>y);return{opacityValues:z,opacities:u}}function e(z){return{rotationType:"geographic"===z.rotationType?g.RotationType.Geographic:g.RotationType.Arithmatic}}function r(z){if(!z.stops?.length)return null;if(z.stops.some(A=>A.useMaxValue||
A.useMinValue))return(A,v)=>{const x=A.statisticsByLevel.get(v.key.level);A=z.stops.map(C=>{const B=C.useMaxValue?x?.get(z.field)?.maxValue??0:C.useMinValue?x?.get(z.field)?.minValue??0:C.value;C=C.size?n.pt2px(C.size):h.nanMagicNumber;return{value:B,size:C}}).sort((C,B)=>C.value-B.value);v=c.padStops(A,8);A=v.map(({value:C})=>C);v=v.map(({size:C})=>C);return{values:A,sizes:v}};var u=z.stops.sort((A,v)=>A.value-v.value),y=c.padStops(u,8);u=y.map(({value:A})=>A);y=y.map(({size:A})=>n.pt2px(A));return{values:u,
sizes:y}}function f(z){return u=>{({state:u}=u);return{unitValueToPixelsRatio:d.getMetersPerUnitForSR(u.spatialReference)/m.meterIn[z.valueUnit??"meters"]/u.resolution}}}function p(z,u){const y=u.length;if(z<u[0].value||1===y)return u[0].size;for(let A=1;A<y;A++)if(z<u[A].value)return u[A-1].size+(z-u[A-1].value)/(u[A].value-u[A-1].value)*(u[A].size-u[A-1].size);return u[y-1].size}function t(z){const {minDataValue:u,maxDataValue:y,minSize:A,maxSize:v}=z;if("object"===typeof A&&"object"===typeof v)return(x,
C)=>{C=x.state.scale;x=n.pt2px(p(C,A.stops));C=n.pt2px(p(C,v.stops));return{minMaxValueAndSize:[u,y,x,C]}};if("object"===typeof A||"object"===typeof v)throw Error("InternalError: Found a partial VisualVariableSizeMinMaxValue");return{minMaxValueAndSize:[u,y,n.pt2px(A),n.pt2px(v)]}}const w={visualVariableColor:null,visualVariableOpacity:null,visualVariableRotation:null,visualVariableSizeStops:null,visualVariableSizeScaleStops:null,visualVariableSizeOutlineScaleStops:null,visualVariableSizeUnitValue:null,
visualVariableSizeMinMaxValue:null};l.createVisualVariableColor=b;l.createVisualVariableOpacity=k;l.createVisualVariableRotation=e;l.createVisualVariableSizeMinMaxValue=t;l.createVisualVariableSizeScaleStops=function(z){if(!z.stops?.length)return null;z=z.stops.sort((y,A)=>y.value-A.value);var u=c.padStops(z,8);z=u.map(({value:y})=>y);u=u.map(({size:y})=>n.pt2px(y));return{values:z,sizes:u}};l.createVisualVariableSizeStops=r;l.createVisualVariableSizeUnitValue=f;l.createVisualVariableUniforms=function(z){const u=
{...w};if(!(z&&"visualVariables"in z&&z.visualVariables))return u;for(const y of a.simplifyVisualVariables(z.visualVariables))switch(y.type){case "color":u.visualVariableColor=b(y);break;case "opacity":u.visualVariableOpacity=k(y);break;case "rotation":u.visualVariableRotation=e(y);break;case "size":switch(z=y,"number"===typeof z.minDataValue&&"number"===typeof z.maxDataValue&&null!=z.minSize&&null!=z.maxSize?"min-max":"$view.scale"===z?.valueExpression&&Array.isArray(z.stops)?"scale-stops":null==
z.field&&"$view.scale"===z?.valueExpression||!(Array.isArray(z.stops)||"levels"in z&&z.levels)?null!=z.field||"$view.scale"!==z?.valueExpression?"unit-value":null:"field-stops"){case "field-stops":u.visualVariableSizeStops=r(y);break;case "scale-stops":"outline"===y.target?u.visualVariableSizeOutlineScaleStops=r(y):u.visualVariableSizeScaleStops=r(y);break;case "min-max":u.visualVariableSizeMinMaxValue=t(y);break;case "unit-value":u.visualVariableSizeUnitValue=f(y)}}return u};l.getMaxSizeVVSize=function(z,
u=128,y=1.25){if(z.visualVariableSizeMinMaxValue)return z.visualVariableSizeMinMaxValue instanceof Function?128:Math.max(z.visualVariableSizeMinMaxValue.minMaxValueAndSize[3]*y,u);if(z.visualVariableSizeScaleStops){if(z.visualVariableSizeScaleStops instanceof Function)return 128;z=z.visualVariableSizeScaleStops.sizes;return Math.max(z[z.length-1]*y,u)}if(z.visualVariableSizeStops){if(z.visualVariableSizeStops instanceof Function)return 128;z=z.visualVariableSizeStops.sizes;return Math.max(z[z.length-
1]*y,u)}return z.visualVariableSizeUnitValue?256:0};l.noVisualVariables=w;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/schema/processor/schemaUtils":function(){define(["exports"],function(l){l.padStops=function(q,n){q=q.slice(0,n);n-=q.length;for(let d=0;d<n;d++)q.push(q[q.length-1]);return q};l.premultiplyColor=function(q){if(!q)return[0,0,0,0];const {r:n,g:d,b:m,a:h}=q;return[h/255*n,h/255*d,h/255*m,h]};Object.defineProperty(l,Symbol.toStringTag,
{value:"Module"})})},"esri/views/2d/layers/features/support/rendererUtils":function(){define(["exports","../../../../../core/Error","../../../../../core/Logger","../../../../../core/screenUtils","../../../../webgl/capabilities"],function(l,q,n,d,m){function h(){const {supportsColorBufferFloat:c,supportsColorBufferFloatBlend:a,supportsColorBufferHalfFloat:b}=m.getWebGLCapabilities();return c&&a||b}const g=()=>n.getLogger("esri.views.2d.layers.features.support.rendererUtils");l.isRendererSupported=
function(c){if(!c)return!0;switch(c.type){case "heatmap":if(!h()){const a=m.getWebGLCapabilities();c=["supportsColorBufferFloat","supportsColorBufferFloatBlend","supportsColorBufferHalfFloat"].filter(b=>!a[b]).join(", ");g().errorOnce(new q("webgl-missing-extension",`Missing WebGL2 requirements for Heatmap: ${c}`));return!1}}return!0};l.simplifyVisualVariables=function(c){return c.map(a=>{if(("size"===a.type||"color"===a.type||"opacity"===a.type)&&null!=a.stops){a=a.clone();var b=a.type;var k=a.stops??
[];if(8>=k.length)b=k;else if(g().warn(`Found ${k.length} Visual Variable stops, but MapView only supports ${8}. Displayed stops will be simplified.`),16<k.length){const [v,...x]=k;var e=x.pop(),r=x[0].value,f=x[x.length-1].value,p=(f-r)/6;const C=[];for(;r<f;r+=p){for(var t=0;r>=x[t].value;)t++;var w=x[t],z=k[t-1],u=r-z.value;w=w.value===z.value?1:u/(w.value-z.value);"color"===b?(z=x[t],t=k[t-1],u=z.color.clone(),u.r=(1-w)*t.color.r+w*u.r,u.g=(1-w)*t.color.g+w*u.g,u.b=(1-w)*t.color.b+w*u.b,u.a=(1-
w)*t.color.a+w*u.a,C.push({value:r,color:u,label:z.label})):"size"===b?(z=x[t],u=k[t-1],t=d.toPt(z.size),u=d.toPt(u.size),C.push({value:r,size:(1-w)*u+w*t,label:z.label})):(z=x[t],C.push({value:r,opacity:(1-w)*k[t-1].opacity+w*z.opacity,label:z.label}))}b=[v,...C,e]}else{var [y,...A]=k;for(b=A.pop();6<A.length;){e=k=0;for(f=1;f<A.length;f++)p=Math.abs(A[f].value-A[f-1].value),p>e&&(e=p,k=f);A.splice(k,1)}b=[y,...A,b]}a.stops=b}return a})};Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},
"esri/views/2d/layers/features/schema/processor/symbols/ComplexSymbolSchema":function(){define("exports ../../../../../../../symbols/cim/CIMSymbolHelper ../../../../../../../symbols/cim/defaultCIMValues ../../../../../../../symbols/cim/enums ../../../../../engine/webgl/shaderGraph/techniques/TechniqueRegistry ../VisualVariablesSchema ./utils".split(" "),function(l,q,n,d,m,h,g){function c(z){return z.minScale||z.maxScale?{minScale:z.minScale??0,maxScale:z.maxScale??0}:null}function a(z){if(null==z)return null;
if(Array.isArray(z)){const [u,y,A,v]=z;return[u,y,A,255*v]}return"string"===typeof z?z:{...z,defaultValue:a(z?.defaultValue)}}function b(z,u,y,A){return u.animationParams?[z.createMeshInfo({pixelDimensions:u.pixelDimensions,texelDimensions:u.texelDimensions,effects:u.effects?{type:"cim-effect-infos",effectInfos:u.effects}:null,sprite:u.spriteRasterizationParam,animations:u.animationParams,scaleInfo:A.scaleInfo,scaleSymbolsProportionally:u.scaleSymbolsProportionally,strokeWidth:u.outlineWidth,isMapAligned:u.alignment===
d.Alignment.MAP,colorLocked:u.colorLocked,isStroke:u.isStroke,baseSize:u.baseSize,referenceSize:u.referenceSize,angleToLine:u.markerPlacement?u.markerPlacement.placement&&"angleToLine"in u.markerPlacement.placement&&u.markerPlacement.placement.angleToLine:!1,sizeRatio:u.sizeRatio})]:[]}function k(z,u,y,{scaleInfo:A,scaleExpression:v}){const x=g.hasSizeVVUniform(y);return[z.createMeshInfo({size:u.size,scaleX:u.scaleX,anchorX:u.anchorPoint.x,anchorY:u.anchorPoint.y,angle:u.rotation,color:a(u.color)??
[0,0,0,0],colorLocked:u.colorLocked,frameHeight:u.frameHeight,widthRatio:u.widthRatio,scaleInfo:A,offsetX:u.offsetX,offsetY:u.offsetY,outlineColor:a(u.outlineColor)??[0,0,0,0],outlineSize:u.outlineWidth,referenceSize:u.referenceSize||n.defaultCIMValues.CIMVectorMarker.size,rotateClockwise:u.rotateClockwise,scaleFactor:v??1,sizeRatio:u.sizeRatio,alignment:u.alignment,isAbsoluteAnchorPoint:u.isAbsoluteAnchorPoint,scaleSymbolsProportionally:u.scaleSymbolsProportionally,sprite:u.spriteRasterizationParam,
hasSizeVV:x,placement:u.markerPlacement,effects:u.effects?{type:"cim-effect-infos",effectInfos:u.effects}:null,transforms:u.transform,minPixelBuffer:h.getMaxSizeVVSize(y)})]}function e(z,u,{scaleInfo:y}){return[z.createMeshInfo({color:a(u.color)??[0,0,0,0],scaleInfo:y,effects:u.effects?{type:"cim-effect-infos",effectInfos:u.effects}:null})]}function r(z,u,y,{scaleInfo:A}){if(!u.spriteRasterizationParam)throw Error("InternalError: Sprite should always be defined");y=!!u.hasUnresolvedReplacementColor&&
(!y||u.colorLocked);y=u.sampleAlphaOnly&&!y;const v=u.spriteRasterizationParam;return[z.createMeshInfo({color:a(u.color)??[0,0,0,0],height:u.height,aspectRatio:u.scaleX,offsetX:u.offsetX,offsetY:u.offsetY,scaleX:1,scaleY:1,angle:u.angle,applyRandomOffset:u.applyRandomOffset,sampleAlphaOnly:y,scaleProportionally:"CIMHatchFill"===v.resource.type,sprite:v,scaleInfo:A,effects:u.effects?{type:"cim-effect-infos",effectInfos:u.effects}:null})]}function f(z,u,{scaleInfo:y}){return{color:a(z.color)??[0,0,
0,0],width:z.width,referenceWidth:z.referenceWidth,capType:z.cap,joinType:z.join,miterLimit:z.miterLimit,scaleInfo:y,hasSizeVV:u,effects:z.effects?{type:"cim-effect-infos",effectInfos:z.effects}:null}}function p(z,u,y,A){if(u.spriteRasterizationParam)throw Error("InternalError: Sprite should not be defined");u=f(u,y,A);return[z.createMeshInfo(u)]}function t(z,u,y,A){const {spriteRasterizationParam:v,scaleDash:x,sampleAlphaOnly:C}=u;if(!v)throw Error("InternalError: Sprite should be defined");return[z.createMeshInfo({...f(u,
y,A),offsetAlongLine:u.offsetAlongLine??0,shouldScaleDash:x??!1,shouldSampleAlphaOnly:C,isSDF:"CIMPictureStroke"!==v.resource.type,sprite:v})]}function w(z,u,y,{scaleInfo:A,scaleExpression:v}){return[z.createMeshInfo({boxBackgroundColor:a(u.backgroundColor),boxBorderLineColor:a(u.borderLineColor),boxBorderLineSize:u.borderLineWidth??0,color:a(u.color)??[0,0,0,0],offsetX:u.offsetX,offsetY:u.offsetY,postAngle:u.angle,fontSize:u.size,referenceSize:u.referenceSize,decoration:u.decoration,haloColor:a(u.haloColor)??
[0,0,0,0],haloSize:u.haloSize??0,outlineColor:a(u.outlineColor)??[0,0,0,0],outlineSize:u.outlineSize,lineWidth:u.lineWidth||512,lineHeightRatio:1,horizontalAlignment:u.horizontalAlignment??"center",verticalAlignment:u.verticalAlignment??"baseline",useCIMAngleBehavior:!1,glyphs:u.textRasterizationParam,scaleInfo:A,effects:u.effects?{type:"cim-effect-infos",effectInfos:u.effects}:null,placement:u.markerPlacement,transforms:u.transform,scaleFactor:v??1,minPixelBuffer:h.getMaxSizeVVSize(y),repeatLabel:null,
repeatLabelDistance:null,allowOverrun:null,labelPosition:null})]}l.createAnimatedMarkerMeshInfos=b;l.createComplexFillMeshInfos=r;l.createComplexMarkerMeshInfos=k;l.createComplexSimpleFillMeshInfos=e;l.createComplexSimpleLineMeshInfos=p;l.createComplexSymbolInstances=async function(z,u){const {cimResourceManager:y,cimAnalyzer:A,scaleExpression:v}=u.schemaOptions;await Promise.all(q.CIMSymbolHelper.fetchResources(z.symbol,y,[]));var x=A.analyzeSymbolReference(z,!1);z={scaleInfo:c(z),scaleExpression:v};
const C=[];for(const H of x)switch(H.type){case "marker":x=C;var B=x.push;{var E=H;var D=z;const {uniforms:L,schemaOptions:R}=u;var {store:F}=R,G=E.isOutline?{...h.noVisualVariables,visualVariableSizeScaleStops:L.visualVariableSizeOutlineScaleStops}:{visualVariableColor:L.visualVariableColor,visualVariableOpacity:L.visualVariableOpacity,visualVariableSizeMinMaxValue:L.visualVariableSizeMinMaxValue,visualVariableSizeScaleStops:L.visualVariableSizeScaleStops,visualVariableSizeStops:L.visualVariableSizeStops,
visualVariableSizeUnitValue:L.visualVariableSizeUnitValue,visualVariableRotation:L.visualVariableRotation};E.animationParams?(F=F.ensureInstance(m.Techniques.animatedMarker,{uniforms:G,optionalAttributes:{zoomRange:!0}}),E=b(F,E,h.noVisualVariables,D)):(F=F.ensureInstance(m.Techniques.marker,{uniforms:G,optionalAttributes:{zoomRange:!!D.scaleInfo}}),E=k(F,E,L,D))}B.call(x,...E);break;case "fill":x=C;B=x.push;a:{D=H;F=u;E=z;if(!D.spriteRasterizationParam){const {uniforms:S,schemaOptions:W}=F;({store:F}=
W);F=F.ensureInstance(m.Techniques.fill,{uniforms:{visualVariableColor:D.colorLocked?null:S.visualVariableColor,visualVariableOpacity:S.visualVariableOpacity},optionalAttributes:{zoomRange:!!E.scaleInfo}});E=e(F,D,E);break a}const {uniforms:L,schemaOptions:R}=F;({store:F}=R);F=F.ensureInstance(m.Techniques.complexFill,{uniforms:{visualVariableColor:D.colorLocked?null:L.visualVariableColor,visualVariableOpacity:L.visualVariableOpacity},optionalAttributes:{zoomRange:!!E.scaleInfo}});E=r(F,D,null!=L.visualVariableColor,
E)}B.call(x,...E);break;case "line":x=C;B=x.push;{E=H;D=z;const {uniforms:L,schemaOptions:R}=u;({store:G}=R);F=E.isOutline?{...h.noVisualVariables,visualVariableSizeScaleStops:L.visualVariableSizeOutlineScaleStops}:{visualVariableColor:E.colorLocked?null:L.visualVariableColor,visualVariableOpacity:L.visualVariableOpacity,visualVariableSizeMinMaxValue:L.visualVariableSizeMinMaxValue,visualVariableSizeScaleStops:L.visualVariableSizeScaleStops,visualVariableSizeStops:L.visualVariableSizeStops,visualVariableSizeUnitValue:L.visualVariableSizeUnitValue};
const S={uniforms:F,optionalAttributes:{zoomRange:!!D.scaleInfo}};F=!!(F.visualVariableSizeMinMaxValue||F.visualVariableSizeScaleStops||F.visualVariableSizeStops||F.visualVariableSizeUnitValue);E.spriteRasterizationParam?(G=G.ensureInstance(m.Techniques.texturedLine,S),E=t(G,E,F,D)):(G=G.ensureInstance(m.Techniques.line,S),E=p(G,E,F,D))}B.call(x,...E);break;case "text":x=C;B=x.push;E=H;D=z;const {uniforms:I,schemaOptions:K}=u;({store:F}=K);F=F.ensureInstance(m.Techniques.text,{uniforms:{visualVariableColor:E.colorLocked?
null:I.visualVariableColor,visualVariableOpacity:I.visualVariableOpacity,visualVariableRotation:I.visualVariableRotation,visualVariableSizeMinMaxValue:I.visualVariableSizeMinMaxValue,visualVariableSizeScaleStops:I.visualVariableSizeScaleStops,visualVariableSizeStops:I.visualVariableSizeStops,visualVariableSizeUnitValue:I.visualVariableSizeUnitValue},optionalAttributes:{zoomRange:!!D.scaleInfo,referenceSymbol:!1,clipAngle:!1}});E=w(F,E,I,D);B.call(x,...E)}return C};l.createComplexTextMeshInfos=w;l.createComplexTexturedLineMeshInfos=
t;l.getScaleInfo=c;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/schema/processor/symbols/utils":function(){define(["exports"],function(l){l.hasRotationVVUniform=function(q){return!!q.visualVariableRotation};l.hasSizeVVUniform=function(q){return!!(q.visualVariableSizeMinMaxValue||q.visualVariableSizeScaleStops||q.visualVariableSizeStops||q.visualVariableSizeUnitValue||q.visualVariableSizeOutlineScaleStops)};Object.defineProperty(l,Symbol.toStringTag,
{value:"Module"})})},"esri/views/2d/layers/features/schema/processor/StorageSchema":function(){define(["exports","../../../../../../core/arrayUtils","../../../../engine/webgl/enums","../../support/rendererUtils","../../../../../webgl/capabilities"],function(l,q,n,d,m){function h(r){switch(r){case "opacity":return n.VVBinding.OPACITY;case "color":return n.VVBinding.COLOR;case "rotation":return n.VVBinding.ROTATION;case "size":return n.VVBinding.SIZE;default:return null}}function g(r){if(!r)return[];
switch(r.type){case "simple":case "class-breaks":case "unique-value":case "dictionary":return k(r);case "dot-density":return c(r);case "pie-chart":return a(r);case "heatmap":return b(r)}}function c(r){const f=[];for(const p of r.attributes)f.push({binding:f.length,expression:p.valueExpression,field:p.field});return f}function a(r){const f=k(r);let p=4;for(const t of r.attributes)f.push({binding:p++,expression:t.valueExpression,field:t.field});return f}function b({valueExpression:r,field:f}){return r||
f?[{binding:0,expression:r,field:f}]:[]}function k(r){return"visualVariables"in r&&r.visualVariables?.length?d.simplifyVisualVariables(r.visualVariables).map(f=>e(f)).filter(q.isSome):[]}function e(r){switch(r.type){case "size":return r="$view.scale"===r.valueExpression?null:{binding:h(r.type),field:r.field,normalizationField:r.normalizationField,expression:r.valueExpression,valueRepresentation:r.valueRepresentation},r;case "color":return{binding:h(r.type),field:r.field,normalizationField:r.normalizationField,
expression:r.valueExpression};case "opacity":return{binding:h(r.type),field:r.field,normalizationField:r.normalizationField,expression:r.valueExpression};case "rotation":return{binding:h(r.type),expression:r.valueExpression,field:r.field}}}l.createDotDensityBindings=c;l.createHeatmapBindings=b;l.createPieChartBindings=a;l.createStorageSchema=function(r,f){const p=m.getWebGLCapabilities();return{type:"simple",filters:f,capabilities:{maxTextureSize:p.maxTextureSize},bindings:g(r)}};l.createVVBindings=
k;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/support/AttributeStore":function(){define("exports ../../../../../core/Error ../../../../../core/has ../../../../../core/Logger ../../../../../core/accessorSupport/diffUtils ../../../engine/webgl/definitions ../../../engine/webgl/DisplayId ../../../engine/webgl/Utils ../../../engine/webgl/shaderGraph/techniques/shaders/constants ../../../engine/webgl/util/debug ./DisplayIdGenerator ./FeatureFilter ../../../../webgl/enums".split(" "),
function(l,q,n,d,m,h,g,c,a,b,k,e,r){function f(y,A){if(!y||!A)return y;switch(A){case "radius":case "distance":return 2*y;case "area":return Math.sqrt(y)}return y}const p=()=>d.getLogger("esri.views.layers.2d.features.support.AttributeStore"),t=b.createDebugLogger(b.DEBUG_ATTR_UPDATES,p());var w=n("esri-shared-array-buffer");n("esri-atomics");class z{constructor(y,A,v){this.size=0;this.texelSize=4;this.dirtyEnd=this.dirtyStart=0;const {pixelType:x,layout:C,textureOnly:B}=A;this.textureOnly=B||!1;
this.pixelType=x;this.layout=C;this._resetRange();this.size=y;this.isLocal=v;B||(this.data=this._initData(x,y))}get buffer(){return this.data?.buffer}unsetComponentAllTexels(y,A){const v=this.data;for(let x=0;x<this.size*this.size;x++)v[x*this.texelSize+y]&=~A;this.dirtyStart=0;this.dirtyEnd=this.size*this.size-1}setComponentAllTexels(y,A){const v=this.data;for(let x=0;x<this.size*this.size;x++)v[x*this.texelSize+y]|=255&A;this.dirtyStart=0;this.dirtyEnd=this.size*this.size-1}setComponent(y,A,v){const x=
this.data;for(const C of v)x[C*this.texelSize+y]|=A,this.dirtyStart=Math.min(this.dirtyStart,C),this.dirtyEnd=Math.max(this.dirtyEnd,C)}setComponentTexel(y,A,v){this.data[v*this.texelSize+y]|=A;this.dirtyStart=Math.min(this.dirtyStart,v);this.dirtyEnd=Math.max(this.dirtyEnd,v)}unsetComponentTexel(y,A,v){this.data[v*this.texelSize+y]&=~A;this.dirtyStart=Math.min(this.dirtyStart,v);this.dirtyEnd=Math.max(this.dirtyEnd,v)}getData(y,A){y=g.getDisplayIdTexel(y);return this.data[y*this.texelSize+A]}setData(y,
A,v){y=g.getDisplayIdTexel(y);0===(this.layout&1<<A)?p().error("mapview-attributes-store","Tried to set a value for a texel's readonly component"):null!=this.data&&(this.data[y*this.texelSize+A]=v,this.dirtyStart=Math.min(this.dirtyStart,y),this.dirtyEnd=Math.max(this.dirtyEnd,y))}expand(y){this.size=y;this.textureOnly||(y=this._initData(this.pixelType,y),y.set(this.data),this.data=y)}toMessage(){const y=this.dirtyStart,A=this.dirtyEnd;var v=this.texelSize;if(y>A)return null;this._resetRange();const x=
this.pixelType,C=this.layout,B=this.data;v=!this.isLocal&&B.slice(y*v,(A+1)*v)||null;return{start:y,end:A,data:v,pixelType:x,layout:C}}_initData(y,A){var v=ArrayBuffer;y=c.getPixelArrayCtor(y);A=new y(new v(A*A*4*y.BYTES_PER_ELEMENT));for(v=0;v<A.length;v+=4)A[v+1]=255;return A}_resetRange(){this.dirtyStart=2147483647;this.dirtyEnd=0}}class u{constructor(y){this._client=y;this._filters=[];this._blocks=[];this._attributeComputeInfo=null;this._abortController=new AbortController;this._size=h.attributeStoreInitialSize;
this._idsToHighlight=new Map;this._initialized=this._referencesGeometry=this._referencesScale=!1;this.version=0;this._idGenerator=new k.DisplayIdGenerator;this._epoch=1}destroy(){this._abortController.abort()}_initialize(){if(null==this._blockDescriptors){var y=r.PixelType.FLOAT;t(`Creating AttributeStore ${w?"with":"without"} shared memory`);this._blockDescriptors=[{pixelType:r.PixelType.UNSIGNED_BYTE,layout:1},{pixelType:r.PixelType.UNSIGNED_BYTE,layout:15,textureOnly:!0},{pixelType:r.PixelType.UNSIGNED_BYTE,
layout:15,textureOnly:!0},{pixelType:y,layout:15},{pixelType:y,layout:15},{pixelType:y,layout:15},{pixelType:y,layout:15},{pixelType:r.PixelType.FLOAT,layout:15}];this._blocks=this._blockDescriptors.map(()=>null)}}get referencesScale(){return this._referencesScale}get referencesGeometry(){return this._referencesGeometry}get hasHighlight(){return 0<this._idsToHighlight.size}createDisplayIdForObjectId(y){return this._idGenerator.createIdForObjectId(y)}releaseDisplayIdForObjectId(y){return this._idGenerator.releaseIdForObjectId(y)}getDisplayIdForObjectId(y){return this._idGenerator.getDisplayIdForObjectId(y)}incrementDisplayIdGeneration(){this._idGenerator.incrementGeneration()}releaseAllIds(){this._idGenerator.releaseAll()}async update(y,
A,v,x,C=0){const B=m.diff(this._schema,y);this.version=C;if(B&&(n("esri-2d-update-debug")&&console.debug(`Version[${C}] AttributeStore.update`,{changed:B}),this._schema=y,this._attributeComputeInfo=null,this._initialize(),null!=y))if(v&&(this._filters=await Promise.all(y.filters.map(E=>E?e.create({geometryType:v.geometryType,hasM:!1,hasZ:!1,timeInfo:v.timeInfo,fieldsIndex:v.fieldsIndex,spatialReference:x??v.spatialReference,filterJSON:E}):null))),"subtype"===y.type){this._attributeComputeInfo={isSubtype:!0,
subtypeField:y.subtypeField,map:new Map};this._referencesGeometry=this._referencesScale=!1;for(const E in y.bindings)await Promise.all(y.bindings[E].map(async D=>{D=await this._bind(A,D,parseInt(E,10));this._referencesGeometry=this._referencesGeometry||(D?.referencesGeometry()??!1);this._referencesScale=this._referencesScale||(D?.referencesScale()??!1)}))}else this._attributeComputeInfo={isSubtype:!1,map:new Map},await Promise.all(y.bindings.map(async E=>{E=await this._bind(A,E);this._referencesGeometry=
this._referencesGeometry||(E?.referencesGeometry()??!1);this._referencesScale=this._referencesScale||(E?.referencesScale()??!1)}))}setHighlight(y,A){const v=this._getBlock(0);v.unsetComponentAllTexels(0,(1<<h.maxHighlightReasons)-1);for(const {displayId:x,highlightFlags:C}of y){if(null==x)continue;const B=g.getDisplayIdTexel(x);v.setComponent(0,C,[B])}this._idsToHighlight.clear();for(const {objectId:x,highlightFlags:C}of y)this._idsToHighlight.set(x,C);for(const {objectId:x,highlightFlags:C}of A)this._idsToHighlight.set(x,
C)}setData(y,A,v,x){const C=g.getDisplayIdTexel(y);this._ensureSizeForTexel(C);this._getBlock(A).setData(y,v,x)}getData(y,A,v){return this._getBlock(A).getData(y,v)}getHighlightFlags(y){return this._idsToHighlight.get(y)||0}unsetAttributeData(y){y=g.getDisplayIdTexel(y);this._getBlock(0).setData(y,0,0)}setAttributeData(y,A,v){const x=g.getDisplayIdTexel(y);this._ensureSizeForTexel(x);this._getBlock(0).setData(x,0,this.getFilterFlags(A));y=this._attributeComputeInfo;let C=null;y&&(C=y.isSubtype?y.map.get(A.readAttribute(y.subtypeField)):
y.map,C?.size&&C.forEach((B,E)=>{const D=1*E%4;E=this._getBlock(Math.floor(1*E/4)+h.AttributeDataType.VV);let F=B.field?.read(A,v);B.valueRepresentation&&(F=f(F,B.valueRepresentation));if(null===F||isNaN(F)||Infinity===F||-Infinity===F)F=a.nanMagicNumber;E.setData(x,D,F)}))}get epoch(){return this._epoch}sendUpdates(){const y=this._blocks.map(v=>null!=v?v.toMessage():null),A=this._getInitArgs();n("esri-2d-log-updating")&&console.log("AttributeStore: _doSendUpdate.start");this._client.update({initArgs:A,
blockData:y,version:this.version,sendUpdateEpoch:this._epoch});this._epoch+=1;n("esri-2d-log-updating")&&console.log("AttributeStore: _doSendUpdate.end")}_ensureSizeForTexel(y){for(;y>=this._size*this._size&&!this._expand(););}async _bind(y,A,v){y=await y.createComputedField(A);const {valueRepresentation:x}=A,C=this._attributeComputeInfo;if(C.isSubtype){const B=C.map.get(v)??new Map;B.set(A.binding,{field:y,valueRepresentation:x});C.map.set(v,B)}else C.map.set(A.binding,{field:y,valueRepresentation:x});
return y}_getInitArgs(){if(this._initialized)return null;this._initialized=!0;this._getBlock(h.AttributeDataType.Animation);this._getBlock(h.AttributeDataType.GPGPU);this._getBlock(h.AttributeDataType.LocalTimeOrigin);return{blockSize:this._size,blockDescriptors:this._blocks.map(y=>null!=y?{textureOnly:y.textureOnly,buffer:y.buffer,pixelType:y.pixelType}:null)}}_getBlock(y){var A=this._blocks[y];if(null!=A)return A;t(`Initializing AttributeBlock at index ${y}`);A=new z(this._size,this._blockDescriptors[y],
this._client.isLocal);this._blocks[y]=A;this._initialized=!1;return A}_expand(){if(this._size<this._schema.capabilities.maxTextureSize){const y=this._size<<=1;t("Expanding block size to",y,this._blocks);for(const A of this._blocks)A?.expand(y);this._initialized=!1;this._size=y;return 0}p().error(new q("mapview-limitations","Maximum number of onscreen features exceeded."));return-1}isVisible(y){return!!(this._getBlock(0).getData(y,0)&1<<h.maxHighlightReasons)}getFilterFlags(y){let A=0;for(var v=0;v<
this._filters.length;v++){var x=this._filters[v];x=!(1<<v)||null==x||x.check(y);A|=(x?1:0)<<v}v=0;this._idsToHighlight.size&&(y=y.getObjectId(),v=this.getHighlightFlags(y));return A<<h.maxHighlightReasons|v}}l.AttributeStore=u;l.getVisualVariableSizeValueRepresentationRatio=f;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/util/debug":function(){define(["exports"],function(l){l.DEBUG_ATTR_UPDATES=!1;l.createDebugLogger=(q,n)=>q&&((...d)=>n.warn("DEBUG:",
...d))||(()=>null);Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/support/DisplayIdGenerator":function(){define(["exports","../../../engine/webgl/DisplayId"],function(l,q){class n{constructor(m){this.data=m;this._referenceCount=0}increment(){this._referenceCount+=1}decrement(){--this._referenceCount}empty(){return 0===this._referenceCount}}class d{constructor(){this._freeIdsGenerationA=[];this._freeIdsGenerationB=[];this._idCounter=1;this._freeIds=this._freeIdsGenerationA;
this._objectIdToDisplayId=new Map}createIdForObjectId(m){let h=this._objectIdToDisplayId.get(m);h?h.increment():(h=new n(q.createDisplayId(this._getFreeId(),!1)),h.increment(),this._objectIdToDisplayId.set(m,h));return h.data}releaseIdForObjectId(m){const h=this._objectIdToDisplayId.get(m);h&&(h.decrement(),h.empty()&&(this._objectIdToDisplayId.delete(m),this._freeIds.push(h.data)))}getDisplayIdForObjectId(m){m=this._objectIdToDisplayId.get(m);return null!=m?m.data:null}releaseAll(){for(const m of this._objectIdToDisplayId.values())this._freeIds.push(m.data);
this._objectIdToDisplayId.clear()}incrementGeneration(){this._freeIds=this._freeIds===this._freeIdsGenerationA?this._freeIdsGenerationB:this._freeIdsGenerationA}_getFreeId(){return this._freeIds.length?this._freeIds.pop():this._idCounter++}}l.DisplayIdGenerator=d;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/support/FeatureFilter":function(){define("../../../../../core/Error ../../../../../core/Logger ../../../../../geometry/support/aaBoundingRect ../../../../../geometry/support/boundsUtils ../../../../../layers/graphics/data/queryUtils ../../../../../layers/graphics/data/spatialQuerySupport ../../../../../layers/graphics/data/timeSupport ../../../../../rest/support/Query ../FeatureStoreQueryAdapter ./whereUtils".split(" "),
function(l,q,n,d,m,h,g,c,a,b){class k{constructor(e){this._geometryBounds=n.create();this._idToVisibility=new Map;this._serviceInfo=e}static async create(e){const r=new k(e);await r.update(e.filterJSON,e.spatialReference);return r}get hash(){return this._hash}check(e){return this._applyFilter(e)}clear(){const e=this._resetAllHiddenIds();this.update();return{show:e,hide:[]}}invalidate(){this._idToVisibility.forEach((e,r)=>{this._idToVisibility.set(r,0)})}setKnownIds(e){for(const r of e)this._idToVisibility.set(r,
1)}setTrue(e){const r=[],f=[],p=new Set(e);this._idToVisibility.forEach((t,w)=>{t=!!(this._idToVisibility.get(w)&1);const z=p.has(w);!t&&z?r.push(w):t&&!z&&f.push(w);this._idToVisibility.set(w,z?3:0)});return{show:r,hide:f}}createQuery(){const {geometry:e,spatialRel:r,where:f,timeExtent:p,objectIds:t}=this;return c.fromJSON({geometry:e,spatialRel:r,where:f,timeExtent:p,objectIds:t})}async update(e,r){this._hash=JSON.stringify(e);e=await m.normalizeQueryLike(e,null,r);await Promise.all([this._setGeometryFilter(e),
this._setIdFilter(e),this._setAttributeFilter(e),this._setTimeFilter(e)])}async _setAttributeFilter(e){e?.where?(this._clause=await b.createWhereClause(e.where,this._serviceInfo.fieldsIndex),this.where=e.where):this.where=this._clause=null}_setIdFilter(e){this._idsToShow=e?.objectIds&&new Set(e.objectIds);this._idsToHide=e?.hiddenIds&&new Set(e.hiddenIds);this.objectIds=e?.objectIds}async _setGeometryFilter(e){if(e?.geometry){var r=e.geometry;e=e.spatialRel||"esriSpatialRelIntersects";var f=await h.getSpatialQueryOperator(e,
r,this._serviceInfo.geometryType,this._serviceInfo.hasZ,this._serviceInfo.hasM);d.getBoundsXY(this._geometryBounds,r);this._spatialQueryOperator=f;this.geometry=r;this.spatialRel=e}else this.spatialRel=this.geometry=this._spatialQueryOperator=null}_setTimeFilter(e){this.timeExtent=this._timeOperator=null;e?.timeExtent&&(this._serviceInfo.timeInfo?(this.timeExtent=e.timeExtent,this._timeOperator=g.getTimeOperator(this._serviceInfo.timeInfo,e.timeExtent,a.FeatureStoreQueryAdapter.Shared)):(e=new l("feature-layer-view:time-filter-not-available",
"Unable to apply time filter, as layer doesn't have time metadata.",e.timeExtent),q.getLogger("esri.views.2d.layers.features.controllers.FeatureFilter").error(e)))}_applyFilter(e){return this._filterByGeometry(e)&&this._filterById(e)&&this._filterByTime(e)&&this._filterByExpression(e)}_filterByExpression(e){return this.where?this._clause(e):!0}_filterById(e){return(!this._idsToHide?.size||!this._idsToHide.has(e.getObjectId()))&&(!this._idsToShow?.size||this._idsToShow.has(e.getObjectId()))}_filterByGeometry(e){return this.geometry?
(e=e.readGeometryWorldSpace())?this._spatialQueryOperator(e):!1:!0}_filterByTime(e){return null==this._timeOperator?!0:this._timeOperator(e)}_resetAllHiddenIds(){const e=[];this._idToVisibility.forEach((r,f)=>{r&1||(this._idToVisibility.set(f,1),e.push(f))});return e}}return k})},"esri/layers/graphics/data/queryUtils":function(){define("require exports ../../../core/jsonMap ../../../core/unitUtils ../../../geometry/projection ../../../geometry/support/extentUtils ../../../geometry/support/jsonUtils ../../../geometry/support/normalizeUtils ../../../geometry/support/spatialReferenceUtils ./projectionSupport".split(" "),
function(l,q,n,d,m,h,g,c,a,b){async function k(w,z,u){if(!w)return null;var {where:y}=w;w.where=y=y?.trim();if(!y||/^1 *= *1$/.test(y)||z&&z===y)w.where=null;if(!w.geometry)return w;z=await r(w);w.distance=0;w.units=null;"esriSpatialRelEnvelopeIntersects"===w.spatialRel&&({spatialReference:y}=w.geometry,z=h.getGeometryExtent(z),z.spatialReference=y);if(z){await b.checkProjectionSupport(z.spatialReference,u);y=z.spatialReference;z=e(z,u)&&g.isExtent(z)?{spatialReference:y,rings:[[[z.xmin,z.ymin],[z.xmin,
z.ymax],[z.xmax,z.ymax],[z.xmax,z.ymin],[z.xmin,z.ymin]]]}:z;y=(await c.normalizeCentralMeridian(g.fromJSON(z)))[0];if(null==y)throw t;const A="quantizationParameters"in w&&w.quantizationParameters?.tolerance||"maxAllowableOffset"in w&&w.maxAllowableOffset||0;z=A&&e(z,u)?{densificationStep:8*A}:void 0;y=y.toJSON();z=b.project(y,y.spatialReference,u,z);if(!z)throw t;z.spatialReference=u;w.geometry=z}return w}function e(w,z){if(!w)return!1;const u=w.spatialReference;return(g.isExtent(w)||g.isPolygon(w)||
g.isPolyline(w))&&!a.equals(u,z)&&!m.canProjectWithoutEngine(u,z)}async function r(w){const {distance:z,units:u}=w,y=w.geometry;if(null==z||"vertexAttributes"in y)return y;var A=y.spatialReference;w=u?p.fromJSON(u):d.getUnitString(A);A=A&&(a.isGeographic(A)||a.isWebMercator(A))?y:await b.checkProjectionSupport(A,a.wgs84).then(()=>b.project(y,a.wgs84));return(await f())(A.spatialReference,A,z,w)}async function f(){return(await new Promise((w,z)=>l(["../../../geometry/geometryEngineJSON"],w,z))).geodesicBuffer}
const p=new n.JSONMap({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"}),t=Object.freeze({});q.normalizeQuery=async function(w,z,u){const {outFields:y,orderByFields:A,groupByFieldsForStatistics:v,outStatistics:x}=w;if(y)for(var C=0;C<y.length;C++)y[C]=y[C].trim();if(A)for(C=0;C<A.length;C++)A[C]=A[C].trim();if(v)for(C=0;C<v.length;C++)v[C]=v[C].trim();
if(x)for(C=0;C<x.length;C++)x[C].onStatisticField&&(x[C].onStatisticField=x[C].onStatisticField.trim());w.geometry&&!w.outSR&&(w.outSR=w.geometry.spatialReference);return k(w,z,u)};q.normalizeQueryLike=k;q.queryEngineEmptyResult=t;q.unitsKebabDict=p;Object.defineProperty(q,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/projectionSupport":function(){define("exports ../../../core/arrayUtils ../../../core/promiseUtils ../../../geometry/projection ../../../geometry/geometryAdapters/json ../../../geometry/support/spatialReferenceUtils ../../../geometry/support/webMercatorUtils".split(" "),
function(l,q,n,d,m,h,g){function c(t,w){if(!w)return null;if("x"in w){var z={x:0,y:0};[z.x,z.y]=t(w.x,w.y,k);null!=w.z&&(z.z=w.z);null!=w.m&&(z.m=w.m);return z}return"xmin"in w?(z={xmin:0,ymin:0,xmax:0,ymax:0},[z.xmin,z.ymin]=t(w.xmin,w.ymin,k),[z.xmax,z.ymax]=t(w.xmax,w.ymax,k),w.hasZ&&(z.zmin=w.zmin,z.zmax=w.zmax,z.hasZ=!0),w.hasM&&(z.mmin=w.mmin,z.mmax=w.mmax,z.hasM=!0),z):"rings"in w?{rings:a(w.rings,t),hasM:w.hasM,hasZ:w.hasZ}:"paths"in w?{paths:a(w.paths,t),hasM:w.hasM,hasZ:w.hasZ}:"points"in
w?{points:b(w.points,t),hasM:w.hasM,hasZ:w.hasZ}:null}function a(t,w){const z=[];for(const u of t)z.push(b(u,w));return z}function b(t,w){const z=[];for(const u of t)t=w(u[0],u[1],[0,0]),z.push(t),2<u.length&&t.push(u[2]),3<u.length&&t.push(u[3]);return z}const k=[0,0],e=c.bind(null,g.lngLatToXY),r=c.bind(null,g.xyToLngLat);class f{constructor(){this._jobs=[];this._timer=null;this._process=this._process.bind(this)}async push(t,w,z,u){if(!t?.length||!w||!z||h.equals(w,z))return t;t={geometries:t,inSpatialReference:w,
outSpatialReference:z,geographicTransformation:u,resolve:n.createResolver()};this._jobs.push(t);this._timer??(this._timer=setTimeout(this._process,10));return t.resolve.promise}_process(){this._timer=null;const t=this._jobs.shift();if(t){var {geometries:w,inSpatialReference:z,outSpatialReference:u,resolve:y,geographicTransformation:A}=t;g.canProject(z,u)?h.isWebMercator(u)?y(w.map(e)):y(w.map(r)):y(d.projectMany(m.jsonAdapter,w,z,u,A,null));0<this._jobs.length&&(this._timer=setTimeout(this._process,
10))}}}const p=new f;l.checkProjectionSupport=async function(t,w){t&&w&&(t=Array.isArray(t)?t.map(z=>null!=z.geometry?z.geometry.spatialReference:null).filter(q.isSome):[t],await d.initializeProjection(t.map(z=>({source:z,dest:w}))))};l.project=function(t,w,z,u){if(!t)return t;z||(z=w,w=t.spatialReference);return h.isValid(w)&&h.isValid(z)&&!h.equals(w,z)?g.canProject(w,z)?(t=h.isWebMercator(z)?e(t):r(t),t.spatialReference=z,t):d.projectMany(m.jsonAdapter,[t],w,z,null,u)[0]:t};l.projectMany=function(t,
w,z,u){return p.push(t,w,z,u)};Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/geometryAdapters/json":function(){define(["exports"],function(l){class q{constructor(g,c,a){this.x=g;this.y=c;this.spatialReference=a;this.m=this.z=void 0}}class n{constructor(g,c,a,b){this.rings=g;this.spatialReference=c;this.hasM=this.hasZ=void 0;a&&(this.hasZ=a);b&&(this.hasM=b)}}class d{constructor(g,c,a,b){this.paths=g;this.spatialReference=c;this.hasM=this.hasZ=void 0;a&&(this.hasZ=
a);b&&(this.hasM=b)}}class m{constructor(g,c,a,b){this.points=g;this.spatialReference=c;this.hasM=this.hasZ=void 0;a&&(this.hasZ=a);b&&(this.hasM=b)}}class h{constructor(g,c,a,b,k){this.xmin=g;this.ymin=c;this.xmax=a;this.ymax=b;this.spatialReference=k;this.mmax=this.mmin=this.zmax=this.zmin=void 0}}l.jsonAdapter={convertToGEGeometry:function(g,c){return null==c?null:g.convertJSONToGeometry(c)},exportPoint:function(g,c,a){a=new q(g.getPointX(c),g.getPointY(c),a);const b=g.hasZ(c),k=g.hasM(c);b&&(a.z=
g.getPointZ(c));k&&(a.m=g.getPointM(c));return a},exportPolygon:function(g,c,a){return new n(g.exportPaths(c),a,g.hasZ(c),g.hasM(c))},exportPolyline:function(g,c,a){return new d(g.exportPaths(c),a,g.hasZ(c),g.hasM(c))},exportMultipoint:function(g,c,a){return new m(g.exportPoints(c),a,g.hasZ(c),g.hasM(c))},exportExtent:function(g,c,a){var b=g.hasZ(c);const k=g.hasM(c);a=new h(g.getXMin(c),g.getYMin(c),g.getXMax(c),g.getYMax(c),a);b&&(b=g.getZExtent(c),a.zmin=b.vmin,a.zmax=b.vmax);k&&(g=g.getMExtent(c),
a.mmin=g.vmin,a.mmax=g.vmax);return a}};Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/spatialQuerySupport":function(){define("require exports ../../../core/Error ../../../geometry/support/contains ../../../geometry/support/intersects ../../../geometry/support/jsonUtils ../../../geometry/support/spatialReferenceUtils ../contains ../featureConversionUtils ../OptimizedGeometry ./geometryUtils ./projectionSupport".split(" "),function(l,q,n,d,m,h,g,c,a,b,k,
e){function r(){return new Promise((z,u)=>l(["../../../geometry/geometryEngineJSON"],z,u))}const f={esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"intersects",esriSpatialRelIndexIntersects:null,esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:null};var p={esriSpatialRelIntersects:!0,esriSpatialRelContains:!0,
esriSpatialRelWithin:!0,esriSpatialRelCrosses:!0,esriSpatialRelDisjoint:!0,esriSpatialRelTouches:!0,esriSpatialRelOverlaps:!0,esriSpatialRelEnvelopeIntersects:!0,esriSpatialRelIndexIntersects:!1,esriSpatialRelRelation:!1},t={esriGeometryPoint:!0,esriGeometryMultiPatch:!1,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!0},w={esriGeometryPoint:!0,esriGeometryMultiPatch:!0,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!1};
q.canQueryWithRBush=function(z){if(h.isExtent(z))return!0;if(h.isPolygon(z)){for(const u of z.rings)if(5!==u.length||u[0][0]!==u[1][0]||u[0][0]!==u[4][0]||u[2][0]!==u[3][0]||u[0][1]!==u[3][1]||u[0][1]!==u[4][1]||u[1][1]!==u[2][1])return!1;return!0}return!1};q.checkSpatialQuerySupport=async function(z,u,y){const {spatialRel:A,geometry:v}=z;if(v){if(null==A||!0!==p[A])throw new n("unsupported-query","Unsupported query spatial relationship",{query:z});if(g.isValid(v.spatialReference)&&g.isValid(y)){if(null==
v||!0!==t[h.getJsonType(v)])throw new n("unsupported-query","Unsupported query geometry type",{query:z});if(null==u||!0!==w[u])throw new n("unsupported-query","Unsupported layer geometry type",{query:z});if(z.outSR)return e.checkProjectionSupport(z.geometry?.spatialReference,z.outSR)}}};q.getSpatialQueryOperator=function(z,u,y,A,v){if(h.isPolygon(u)&&"esriGeometryPoint"===y&&("esriSpatialRelIntersects"===z||"esriSpatialRelContains"===z)){const x=a.convertFromPolygon(new b,u,!1,!1);return Promise.resolve(C=>
c.polygonContainsPoint(x,!1,!1,C))}if(h.isPolygon(u)&&"esriGeometryMultipoint"===y){const x=a.convertFromPolygon(new b,u,!1,!1);if("esriSpatialRelContains"===z)return Promise.resolve(C=>c.polygonContainsMultipoint(x,!1,!1,C,A,v))}if(h.isExtent(u)&&"esriGeometryPoint"===y&&("esriSpatialRelIntersects"===z||"esriSpatialRelContains"===z))return Promise.resolve(x=>d.extentContainsPoint(u,k.getGeometry(y,A,v,x)));if(h.isExtent(u)&&"esriGeometryMultipoint"===y&&"esriSpatialRelContains"===z)return Promise.resolve(x=>
d.extentContainsMultipoint(u,k.getGeometry(y,A,v,x)));if(h.isExtent(u)&&"esriSpatialRelIntersects"===z){const x=m.getExtentIntersector(y);return Promise.resolve(C=>x(u,k.getGeometry(y,A,v,C)))}return r().then(x=>{const C=x[f[z]].bind(null,u.spatialReference,u);return B=>C(k.getGeometry(y,A,v,B))})};Object.defineProperty(q,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/intersects":function(){define(["exports","./intersectsBase"],function(l,q){l.extentIntersectsExtent=q.extentIntersectsExtent;
l.extentIntersectsMultipoint=q.extentIntersectsMultipoint;l.extentIntersectsPoint=q.extentIntersectsPoint;l.extentIntersectsPolygon=q.extentIntersectsPolygon;l.extentIntersectsPolyline=q.extentIntersectsPolyline;l.getFeatureExtentIntersector=q.getFeatureExtentIntersector;l.isSelfIntersecting=q.isSelfIntersecting;l.segmentIntersects=q.segmentIntersects;l.getExtentIntersector=function(n){return"mesh"===n?q.extentIntersectsExtent:q.getFeatureExtentIntersector(n)};Object.defineProperty(l,Symbol.toStringTag,
{value:"Module"})})},"esri/layers/graphics/contains":function(){define(["exports"],function(l){function q(n,d,m,h,g){if(!n)return!1;d=d?m?4:3:m?3:2;const {coords:c,lengths:a}=n;m=!1;n=0;for(const k of a){var b=n;for(let e=n,r=n+k*d;e<r;e+=d){b=e+d;b===r&&(b=n);const f=c[e],p=c[e+1],t=c[b];b=c[b+1];(p<g&&b>=g||b<g&&p>=g)&&f+(g-p)/(b-p)*(t-f)<h&&(m=!m)}n+=k*d}return m}l.polygonContainsCoords=q;l.polygonContainsMultipoint=function(n,d,m,h,g,c){g=g?c?4:3:c?3:2;const {coords:a,lengths:b}=h;if(!b)return!1;
for(let k=0,e=0;k<b.length;k++,e+=g)if(!q(n,d,m,a[e],a[e+1]))return!1;return!0};l.polygonContainsPoint=function(n,d,m,h){return q(n,d,m,h.coords[0],h.coords[1])};Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/geometryUtils":function(){define(["exports","../featureConversionUtils","../OptimizedGeometry"],function(l,q,n){const d=new n,m=new n,h=new n,g={esriGeometryPoint:q.convertToPoint,esriGeometryPolyline:q.convertToPolyline,esriGeometryPolygon:q.convertToPolygon,
esriGeometryMultipoint:q.convertToMultipoint},c=(a,b)=>"_geVersion"!==a?b:void 0;l.cleanFromGeometryEngine=function(a){return a&&"_geVersion"in a?JSON.parse(JSON.stringify(a,c)):a};l.getGeometry=function(a,b,k,e,r,f,p=b,t=k){const w=b&&p,z=k&&t;e=null!=e?"coords"in e?e:e.geometry:null;if(null==e)return null;if(r)return b=q.generalizeOptimizedGeometry(m,e,b,k,a,r,p,t),f&&(b=q.quantizeOptimizedGeometry(h,b,w,z,a,f)),g[a]?.(b,w,z)??null;if(f)return f=q.quantizeOptimizedGeometry(h,e,b,k,a,f,p,t),g[a]?.(f,
w,z)??null;q.removeZMValues(d,e,b,k,p,t);return g[a]?.(d,w,z)??null};l.transformCentroid=function(a,b,k,e=a.hasZ,r=a.hasM){if(null==b)return null;const f=a.hasZ&&e,p=a.hasM&&r;return k?(a=q.quantizeOptimizedGeometry(h,b,a.hasZ,a.hasM,"esriGeometryPoint",k,e,r),q.convertToPoint(a,f,p)):q.convertToPoint(b,f,p)};Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/timeSupport":function(){define(["exports"],function(l){function q(m,h,g,c,a){if(null!=c&&null!=a)return b=>
{const k=m(b,h);b=m(b,g);return(null==k||k<=a)&&(null==b||b>=c)};if(null!=c)return b=>{b=m(b,g);return null==b||b>=c};if(null!=a)return b=>{b=m(b,h);return null==b||b<=a}}function n(m,h,g,c){if(null!=g&&null!=c&&g===c)return a=>m(a,h)===g;if(null!=g&&null!=c)return a=>{a=m(a,h);return null!=a&&a>=g&&a<=c};if(null!=g)return a=>{a=m(a,h);return null!=a&&a>=g};if(null!=c)return a=>{a=m(a,h);return null!=a&&a<=c}}function d(){return()=>!1}l.getTimeExtent=async function(m,h){if(!m)return null;const g=
h.featureAdapter,{startTimeField:c,endTimeField:a}=m;let b=Number.POSITIVE_INFINITY,k=Number.NEGATIVE_INFINITY;if(c&&a)await h.forEach(e=>{const r=g.getAttribute(e,c);e=g.getAttribute(e,a);null==r||isNaN(r)||(b=Math.min(b,r));null==e||isNaN(e)||(k=Math.max(k,e))});else{const e=c||a;await h.forEach(r=>{r=g.getAttribute(r,e);null==r||isNaN(r)||(b=Math.min(b,r),k=Math.max(k,r))})}return{start:b,end:k}};l.getTimeOperator=function(m,h,g){if(!h||!m)return null;const {startTimeField:c,endTimeField:a}=m;
if(!c&&!a)return null;const {start:b,end:k}=h;if(null===b&&null===k)return null;if(void 0===b&&void 0===k)return d();m=g.getAttributeAsTimestamp?.bind(g)??g.getAttribute.bind(g);return c&&a?q(m,c,a,b,k):n(m,c||a,b,k)};Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/FeatureStoreQueryAdapter":function(){define(["exports"],function(l){class q{getObjectId(n){return n.getObjectId()}getAttributes(n){return n.readAttributes()}getAttribute(n,d){return n.readAttribute(d)}getAttributeAsTimestamp(n,
d){return n.readAttributeAsTimestamp(d)}cloneWithGeometry(n,d){return n}getGeometry(n){return n.readGeometryWorldSpace()}getCentroid(n,d){return n.readCentroidForDisplay()}}q.Shared=new q;l.FeatureStoreQueryAdapter=q;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/support/whereUtils":function(){define(["exports","../../../../../core/Error","../../../../../core/Logger","../../../../../core/sql"],function(l,q,n,d){const m=()=>n.getLogger("esri.views.2d.layers.features.support.whereUtils"),
h={getAttribute(g,c){return g.readAttribute(c)}};l.createWhereClause=async function(g,c){try{const a=await d.parseWhereClause(g,c);if(!a.isStandardized){const b=new q("mapview - bad input","Unable to apply filter's definition expression, as expression is not standardized.",a);m().error(b)}return b=>{b=b.readArcadeFeature();try{return a.testFeature(b,h)}catch(k){return m().warn("mapview-bad-where-clause","Encountered an error when evaluating where clause",g),!0}}}catch(a){return m().warn("mapview-bad-where-clause",
"Encountered an error when evaluating where clause",g),b=>!0}};Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/support/ComputedAttributeStorage":function(){define("exports ../../../../../core/Error ../../../../../core/Logger ../../../../../geometry/support/aaBoundingBox ../../../engine/webgl/DisplayId ./CachedField ./ComputedExpression ./ComputedLegacyLabelExpression ./NormalizedField ./StaticBitSet ./whereUtils".split(" "),function(l,q,n,d,m,h,g,c,a,
b,k){function e(p,t,w){if(!(p.length>t))for(;p.length<=t;)p.push(w)}const r=()=>n.getLogger("esri.views.2d.layers.features.support.ComputedAttributeStorage");class f{constructor(p){this._numerics=[];this._strings=[];this._allocatedSize=256;this._bitsets=[];this._instanceIds=[];this._bounds=[];this._dirtyBitset=this.getBitset(this.createBitset());this.compilationOptions=p}createBitset(){const p=this._bitsets.length;this._bitsets.push(b.StaticBitSet.create(this._allocatedSize,m.displayIdTexelMask));
return p+1}async createComputedField(p,t=!1){if(p.expression)try{if(!this.compilationOptions)throw Error("InternalError: Compilation options not defined");return t?await c.ComputedLegacyLabelExpression.create(p.expression,this.compilationOptions):await g.ComputedExpression.create(p.expression,this.compilationOptions)}catch(w){return p=new q("featurelayer","Failed to compile arcade expression",{error:w,expression:p.expression}),r().error(p),null}if(p.normalizationType||p.normalizationField)return new a.NormalizedField(p.field,
p);if(p.field)return new h.CachedField(p.field);p=new q("featurelayer","Unable to create computed field. No expression or field found",{info:p});r().error(p);return null}async createWhereClause(p){return p?k.createWhereClause(p,this.compilationOptions.fields):null}getBitset(p){return this._bitsets[p-1]}getComputedNumeric(p,t){return this.getComputedNumericAtIndex(p&m.displayIdTexelMask,0)}setComputedNumeric(p,t,w){return this.setComputedNumericAtIndex(p&m.displayIdTexelMask,w,0)}getComputedString(p,
t){return this.getComputedStringAtIndex(p&m.displayIdTexelMask,0)}setComputedString(p,t,w){return this.setComputedStringAtIndex(p&m.displayIdTexelMask,0,w)}getComputedNumericAtIndex(p,t){p&=m.displayIdTexelMask;this._ensureNumeric(t,p);return this._numerics[t][p]}setComputedNumericAtIndex(p,t,w){p&=m.displayIdTexelMask;this._ensureNumeric(t,p);this._numerics[t][p]=w}getPackedChunkId(p){p&=m.displayIdTexelMask;this._ensureInstanceId(p);return this._instanceIds[p]}setPackedChunkId(p,t){p&=m.displayIdTexelMask;
this._ensureInstanceId(p);this._instanceIds[p]=t}getComputedStringAtIndex(p,t){p&=m.displayIdTexelMask;this._ensureString(t,p);return this._strings[t][p]}setComputedStringAtIndex(p,t,w){p&=m.displayIdTexelMask;this._ensureString(t,p);this._strings[t][p]=w}getXMin(p){return this._bounds[4*(p&m.displayIdTexelMask)]}getYMin(p){return this._bounds[4*(p&m.displayIdTexelMask)+1]}getXMax(p){return this._bounds[4*(p&m.displayIdTexelMask)+2]}getYMax(p){return this._bounds[4*(p&m.displayIdTexelMask)+3]}setBounds(p,
t,w=!1){const z=p&m.displayIdTexelMask;if(!w&&!this._dirtyBitset.has(p))return 4294967295!==this._bounds[4*z];this._dirtyBitset.unset(p);p=t.readGeometryWorldSpace();e(this._bounds,4*z+4,0);if(!p||!p.coords.length)return this._bounds[4*z]=4294967295,this._bounds[4*z+1]=4294967295,this._bounds[4*z+2]=4294967295,this._bounds[4*z+3]=4294967295,!1;let u=Infinity,y=Infinity,A=-Infinity,v=-Infinity;p.forEachVertex((x,C)=>{u=Math.min(u,x);y=Math.min(y,C);A=Math.max(A,x);v=Math.max(v,C)});this._bounds[4*
z]=u;this._bounds[4*z+1]=y;this._bounds[4*z+2]=A;this._bounds[4*z+3]=v;return!0}getBounds(p,t){const w=this.getXMin(t),z=this.getYMin(t),u=this.getXMax(t);t=this.getYMax(t);d.fromRectValues(p,w,z,u,t);return 4294967295!==w}_ensureNumeric(p,t){this._numerics[p]||(this._numerics[p]=[]);e(this._numerics[p],t,0)}_ensureInstanceId(p){e(this._instanceIds,p,0)}_ensureString(p,t){this._strings[p]||(this._strings[p]=[]);e(this._strings[p],t,null)}}l.ComputedAttributeStorage=f;Object.defineProperty(l,Symbol.toStringTag,
{value:"Module"})})},"esri/views/2d/layers/features/support/CachedField":function(){define(["exports","./AComputedField"],function(l,q){class n extends q.AComputedField{constructor(d){super();this._field=d}resize(d){throw Error("Method not implemented.");}read(d,m){return d.readAttribute(this._field)}readWithDefault(d,m){return d.readAttribute(this._field)}referencesScale(){return!1}referencesGeometry(){return!1}}l.CachedField=n;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/support/ComputedExpression":function(){define(["exports",
"../../../../../core/string","../../../../../support/arcadeOnDemand","../../../arcade/callExpressionWithCursor","./AComputedField"],function(l,q,n,d,m){class h extends m.AComputedField{static async create(g,c){c=await n.createRendererExpression(g,c.spatialReference,c.fields);g=q.numericHash(g);return new h(c,g)}constructor(g,c){super();this._compiled=g;this._cacheKey=c}resize(g){}read(g,c){return this.referencesScale()||"system"!==c.$view.timeZone?d.callExpressionWithCursor(this._compiled,g,c):this._readCached(g,
c)}readWithDefault(g,c,a){return this.referencesScale()||"system"!==c.$view.timeZone?d.callExpressionWithCursorWithDefault(this._compiled,g,c,a):this._readWithDefaultCached(g,c,a)}referencesScale(){return this._compiled?.referencesScale()??!1}referencesGeometry(){return this._compiled?.referencesGeometry()??!1}_readCached(g,c){g.setCache(this._cacheKey);if(g.hasCachedValue())return g.getCachedValue();c=d.callExpressionWithCursor(this._compiled,g,c);g.setCachedValue(c);return c}_readWithDefaultCached(g,
c,a){g.setCache(this._cacheKey);if(g.hasCachedValue())return g.getCachedValue();c=d.callExpressionWithCursorWithDefault(this._compiled,g,c,a);g.setCachedValue(c);return c}}l.ComputedExpression=h;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/arcade/callExpressionWithCursor":function(){define(["exports","../../../core/has","../../../core/Logger"],function(l,q,n){function d(m){return null==m||Infinity===m||-Infinity===m||"number"===typeof m&&isNaN(m)}l.callExpressionWithCursor=
function(m,h,g){if(null==m)return null;const c=h.readArcadeFeature();h.contextTimeZone=g.$view?.timeZone;try{return m.evaluate({...g,$feature:c},m.services)}catch(a){return n.getLogger("esri.views.2d.support.arcadeOnDemand").warn("Feature arcade evaluation failed:",a),null}};l.callExpressionWithCursorWithDefault=function(m,h,g,c){if(null==m)return null!=c?c:null;const a=h.readArcadeFeature();h.contextTimeZone=g.$view?.timeZone;m=m.evaluate({...g,$feature:a},m.services);return d(m)?null!=c?c:null:
m};l.isBadArcadeResult=d;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/support/ComputedLegacyLabelExpression":function(){define(["exports","../../../../../layers/support/labelFormatUtils","../../../../../layers/support/labelUtils","../../../arcade/callExpressionWithCursor","./AComputedField"],function(l,q,n,d,m){class h extends m.AComputedField{static async create(g,c){const a=n.sqlToTemplateString(g);return new h(b=>a.replaceAll(/{[^}]*}/g,k=>{const e=
k.slice(1,-1),r=b.metadata.fieldsIndex.get(e);if(null==r)return k;k=b.readAttribute(e);return null==k?"":q.formatField(k,r)}))}constructor(g){super();this._evaluator=g}resize(g){}read(g,c){return this._evaluator(g)}readWithDefault(g,c,a){g=this._evaluator(g);return d.isBadArcadeResult(g)?a:g}referencesScale(){return!1}referencesGeometry(){return!1}}l.ComputedLegacyLabelExpression=h;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/labelFormatUtils":function(){define("exports ../../core/Error ../../core/Logger ../../core/sql ../../intl/date ../../intl/number ./domainUtils ./fieldUtils ./labelUtils ../../support/arcadeOnDemand".split(" "),
function(l,q,n,d,m,h,g,c,a,b){function k(p,t){if(null==p)return"";const w=t.domain;if(w)if("codedValue"===w.type||"coded-value"===w.type)for(var z of w.codedValues){if(z.code===p)return z.name}else if("range"===w.type){const {max:u,min:y}=g.getDomainRange(t);z=+p;if(null!=y&&null!=u&&y<=z&&z<=u)return w.name}c.isDateField(t)?p=m.formatDate(p,m.convertDateFormatToIntlOptions("short-date")):c.isNumericField(t)&&(p=h.formatNumber(+p));return p||""}const e=()=>n.getLogger("esri.layers.support.labelFormatUtils"),
r={type:"simple",evaluate(){return null}},f={getAttribute(p,t){return p.field(t)}};l.createLabelFunction=async function(p,t,w){if(!p||!p.symbol||!t)return r;const z=p.where,u=a.getLabelExpression(p);if("arcade"===u.type){const y=await b.createLabelExpression(u.expression,w,t);if(null==y)return r;p={type:"arcade",evaluate(A,v){try{const x="attributes"in A?y.repurposeFeature(A):A;x.contextTimeZone=v??null;const C=y.evaluate({$view:{timeZone:v},$feature:x},y.services);if(null!=C)return C.toString()}catch(x){e().error(new q("arcade-expression-error",
"Encountered an error when evaluating label expression for feature",{error:x,feature:A,expression:u}))}return null},needsHydrationToEvaluate(){return null==a.getSingleFieldArcadeExpression(u.expression)}}}else p={type:"simple",evaluate(y){return u.expression.replaceAll(/{[^}]*}/g,A=>{var v=A.slice(1,-1);v=t.get(v);if(!v)return A;A=null;"attributes"in y?y&&y.attributes&&(A=y.attributes[v.name]):A=y.field(v.name);return null==A?"":k(A,v)})}};if(z){let y;try{y=await d.parseWhereClause(z,t)}catch(v){return e().error(new q("bad-where-clause",
"Encountered an error when evaluating where clause, ignoring",{where:z,error:v})),r}const A=p.evaluate;p.evaluate=(v,x)=>{const C="attributes"in v?void 0:f;try{if(y.testFeature(v,C))return A(v,x)}catch(B){e().error(new q("bad-where-clause","Encountered an error when evaluating where clause for feature",{where:z,feature:v,error:B}))}return null}}return p};l.formatField=k;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/support/NormalizedField":function(){define(["exports",
"./AComputedField"],function(l,q){class n extends q.AComputedField{constructor(d,m){super();this._field=d;this._normalizationInfo=m}resize(d){throw Error("Method not implemented.");}read(d,m){return this._readNormalized(d)}readWithDefault(d,m){return this._readNormalized(d)}referencesScale(){return!1}referencesGeometry(){return!1}_readNormalized(d){const m=d.readAttribute(this._field);if(null==m)return null;const {normalizationField:h,normalizationTotal:g,normalizationType:c}=this._normalizationInfo;
d=d.readAttribute(h);switch(c??"esriNormalizeByField"){case "esriNormalizeByField":return d?(d||void 0)&&m/d:null;case "esriNormalizeByLog":return Math.log(m)*Math.LOG10E;case "esriNormalizeByPercentOfTotal":return g?m/g*100:null}}}l.NormalizedField=n;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/support/FeatureMetadata":function(){define(["exports","../../../../../geometry/SpatialReference","../../../../../layers/support/FieldsIndex"],function(l,q,
n){class d{static minimal(h,g,c=[]){return new d({geometryType:h,fieldsIndex:(new n(c)).toJSON(),objectIdField:g,subtypes:null,subtypeField:null,types:null,globalIdField:null,spatialReference:null,timeInfo:null,timeReferenceUnknownClient:null,typeIdField:null})}static createFeature(h){return new d(h)}constructor(h){this._options=h;this._fieldsIndex=n.fromJSON(h.fieldsIndex);h.spatialReference&&(this._spatialReference=q.fromJSON(h.spatialReference));this._arcadeSchema={fields:this.fieldsIndex.fields,
fieldsIndex:this.fieldsIndex,geometryType:this.geometryType,objectIdField:this.objectIdField,globalIdField:this._options.globalIdField,spatialReference:this._spatialReference,timeInfo:this._options.timeInfo,typeIdField:this._options.typeIdField??void 0,types:this._options.types??void 0,subtypeField:this._options.subtypeField,subtypes:this._options.subtypes??void 0}}get fieldsIndex(){return this._fieldsIndex}get geometryType(){return"esriGeometryMultiPatch"===this._options.geometryType?"esriGeometryPolygon":
this._options.geometryType}get serviceGeometryType(){return this._options.geometryType}get subtypeField(){return this._options.subtypeField}get timeInfo(){return this._options.timeInfo}get objectIdField(){return this._options.objectIdField}get globalIdField(){return this._options.globalIdField}get arcadeSchema(){return this._arcadeSchema}get spatialReference(){return this._spatialReference}get timeReferenceUnknownClient(){return this._options.timeReferenceUnknownClient}}class m extends d{static createGraphics(h){return new m({fieldsIndex:(new n).toJSON(),
objectIdField:"uid",geometryType:null,spatialReference:h,globalIdField:null,subtypeField:null,subtypes:null,timeInfo:null,typeIdField:null,types:null,timeReferenceUnknownClient:null})}}l.FeatureMetadata=d;l.GraphicsMetadata=m;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/support/GraphicsReader":function(){define("exports ../../../../../geometry/support/centroid ../../../../../geometry/support/jsonUtils ../../../../../layers/graphics/featureConversionUtils ../../../../../layers/graphics/OptimizedGeometry ../../../engine/webgl/definitions ./FeatureSetReader".split(" "),
function(l,q,n,d,m,h,g){class c extends g.FeatureSetReader{static from(a,b,k){return new c(a,b,k)}constructor(a,b,k){super(k);this._items=a;this._tile=b;this._index=-1;this._cachedGeometry=null;a=b.lod;a.wrap&&(this._wrappingInfo={worldSizeX:a.worldSize[0]})}get _current(){return this._items[this._index]}getItem(){return this._current}getZOrder(){return this._current.zOrder}getMeshWriters(){return this._current.symbolResource?.symbolInfo.meshWriters??[]}hasField(a){return null!=this._current.attributes[a]}field(a){return this.readAttribute(a)}get geometryType(){const a=
n.getJsonType(this._current.geometry);return"esriGeometryPoint"===a?"esriGeometryMultipoint":a}getCursor(){return this.copy()}copy(){const a=new c(this._items,this._tile,this.metadata);this.copyInto(a);return a}copyInto(a){super.copyInto(a);a._cachedGeometry=this._cachedGeometry;a._index=this._index}get fields(){throw Error("Fields reading not supported to graphics.");}get hasFeatures(){return!!this._items.length}get hasNext(){return this._index+1<this._items.length}get exceededTransferLimit(){throw Error("InternalError: exceededTransferLimit not implemented for graphics.");
}get hasZ(){return!1}get hasM(){return!1}getInTransform(){return this._tile.transform}getSize(){return this._items.length}getAttributeHash(){let a="";for(const b in this._current.attributes)a+=this._current.attributes[b];return a}getObjectId(){return this._items[this._index].objectId}getDisplayId(){return this._current.displayId}setDisplayId(a){throw Error("InternalError: Setting displayId not supported for graphics.");}setIndex(a){this._index=a}getIndex(){return this._index}next(){for(this._cachedGeometry=
null;++this._index<this._items.length&&!this._getExists(););return this._index<this._items.length}readGeometryArea(){throw Error("InternalError: readGeometryArea not supported for graphics.");}_readGeometry(){if(!this._cachedGeometry){let a=d.convertFromGeometry(this._current.projectedGeometry,this.hasZ,this.hasM);"esriGeometryPolyline"===this.geometryType&&(a=d.generalizeOptimizedGeometry(new m,a,this.hasZ,this.hasM,this.geometryType,this._tile.transform.scale[0]));this._cachedGeometry=d.quantizeOptimizedGeometry(new m,
a,this.hasZ,this.hasM,this.geometryType,this._tile.transform);if(!this._cachedGeometry)return null;this._wrapGeometry(this._cachedGeometry)}return this._cachedGeometry}_wrapGeometry(a){if(this._wrappingInfo){var {worldSizeX:b}=this._wrappingInfo;if(a.isPoint)1===b?(a.coords.push(h.tileSize,0),a.coords.push(2*-h.tileSize,0),a.lengths.push(3)):2===b?(a.coords.push(2*h.tileSize,0),a.coords.push(4*-h.tileSize,0),a.lengths.push(3)):this._wrapVertex(a.coords,0,2,b);else if("esriGeometryMultipoint"===this.geometryType)if(1===
b){b=a.coords.slice();b[0]-=512;const k=a.coords.slice();k[0]+=512;a.coords.push(...b,...k);b=a.lengths[0];a.lengths.push(b,b)}else this._wrapVertex(a.coords,0,2,b)}}_wrapVertex(a,b,k,e){b*=k;k=a[b];k<-(h.tileSize*(e-2))?a[b]=k+h.tileSize*e:k>h.tileSize*(e-1)&&(a[b]=k-h.tileSize*e)}_readX(){const a=this._readGeometry();return null!=a?a.coords[0]:0}_readY(){const a=this._readGeometry();return null!=a?a.coords[1]:0}_readServerCentroid(){switch(this.geometryType){case "esriGeometryPolygon":var a=q.polygonCentroid(this._current.projectedGeometry);
a=new m([],a);return d.quantizeOptimizedGeometry(new m,a,this.hasZ,this.hasM,this.geometryType,this._tile.transform);case "esriGeometryPolyline":return a=q.ringsCentroid(this._current.projectedGeometry.paths,this.hasZ),a=new m([],a),d.quantizeOptimizedGeometry(new m,a,this.hasZ,this.hasM,this.geometryType,this._tile.transform)}return null}_readAttribute(a,b){b=this._current.attributes[a];if(void 0!==b)return b;a=a.toLowerCase();for(const k in this._current.attributes)if(k.toLowerCase()===a)return this._current.attributes[k]}_readAttributes(){return this._current.attributes}}
l.GraphicsReader=c;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/support/FeatureSetReader":function(){define("exports ../../../../../geometry ../../../../../arcade/ArcadeDate ../../../../../core/has ../../../../../core/maybe ../../../../../core/sql/DateOnly ../../../../../core/sql/TimeOnly ../../../../../geometry/GeometryCursor ../../../../../geometry/support/aaBoundingBox ../../../../../geometry/support/labelPoint ../../../../../layers/graphics/centroid ../../../../../layers/graphics/featureConversionUtils ../../../../../layers/graphics/OptimizedFeature ../../../../../layers/graphics/OptimizedGeometry ../../../../../time/timeZoneUtils ./FeatureSetCache ./StaticBitSet ../../../../../geometry/support/jsonUtils".split(" "),
function(l,q,n,d,m,h,g,c,a,b,k,e,r,f,p,t,w,z){function u(H,I,K){if(!(H.length>I))for(;H.length<=I;)H.push(K)}q=d("featurelayer-simplify-thresholds")??[.5,.5,.5,.5];const y=q[0],A=q[1],v=q[2],x=q[3];q=d("featurelayer-simplify-payload-size-factors")??[1,2,4];const C=q[0],B=q[1],E=q[2],D=d("featurelayer-simplify-mobile-factor")??2,F=d("esri-mobile");class G{constructor(H){this.metadata=H;this.type="FeatureSetReader";this._deleted=null;this._joined=[];this._objectIdToIndex=null;this._boundsBuffer=[];
this._caches=new Map;this.arcadeDeclaredClass="esri.arcade.Feature";this._contextTimeZone=null}destroy(){}[Symbol.dispose](){this.destroy()}get isEmpty(){return null!=this._deleted&&this._deleted.countSet()===this.getSize()}getAreaSimplificationThreshold(H,I){let K=1;const L=F?D:1;4E6<I?K=E*L:1E6<I?K=B*L:5E5<I?K=C*L:1E5<I&&(K=L);I=0;4E3<H?I=x*K:2E3<H?I=v*K:100<H?I=A:15<H&&(I=y);return I}getBounds(H){u(this._boundsBuffer,4*this.getIndex()+4,0);if(4294967295===this.getBoundsXMin())return!1;if(0===this.getBoundsXMin()){var I=
this.readGeometryWorldSpace();if(!I)return this.setBoundsXMin(4294967295),!1;let S=Infinity,W=Infinity,J=-Infinity,O=-Infinity;I.forEachVertex((T,X)=>{S=Math.min(S,T);W=Math.min(W,X);J=Math.max(J,T);O=Math.max(O,X)});this.setBoundsXMin(S);this.setBoundsYMin(W);this.setBoundsXMax(J);this.setBoundsYMax(O);a.fromRectValues(H,S,W,J,O);return!0}I=this.getBoundsXMin();const K=this.getBoundsYMin(),L=this.getBoundsXMax(),R=this.getBoundsYMax();a.fromRectValues(H,I,K,L,R);return!0}getBoundsXMin(){return this._boundsBuffer[4*
this.getIndex()]}setBoundsXMin(H){this._boundsBuffer[4*this.getIndex()]=H}getBoundsYMin(){return this._boundsBuffer[4*this.getIndex()+1]}setBoundsYMin(H){this._boundsBuffer[4*this.getIndex()+1]=H}getBoundsXMax(){return this._boundsBuffer[4*this.getIndex()+2]}setBoundsXMax(H){this._boundsBuffer[4*this.getIndex()+2]=H}getBoundsYMax(){return this._boundsBuffer[4*this.getIndex()+3]}setBoundsYMax(H){this._boundsBuffer[4*this.getIndex()+3]=H}readAttributeAsTimestamp(H){H=this.readAttribute(H);return"string"===
typeof H?(new Date(H)).getTime():"number"===typeof H||null==H?H:null}readAttribute(H,I=!1){var K=this._readAttribute(H,I);if(void 0!==K)return K;for(const L of this._joined)if(L.setIndex(this.getIndex()),K=L._readAttribute(H,I),void 0!==K)return K}readAttributes(){const H=this._readAttributes();for(const I of this._joined){I.setIndex(this.getIndex());const K=I._readAttributes();for(const L of Object.keys(K))H[L]=K[L]}return H}joinAttributes(H){this._joined.push(H)}removeIds(H){if(null==this._objectIdToIndex){var I=
new Map;const K=this.getCursor();for(;K.next();){const L=K.getObjectId();m.assertIsSome(L);I.set(L,K.getIndex())}this._objectIdToIndex=I}I=this._objectIdToIndex;for(const K of H.values())I.has(K)&&this._removeAtIndex(I.get(K))}readOptimizedFeatureWorldSpace(){var H=this.readGeometryWorldSpace();const I=this.readAttributes(),K=this.readCentroidWorldSpace();H=new r.OptimizedFeature(H,I,K);H.objectId=this.getObjectId();H.displayId=this.getDisplayId();return H}readLegacyFeatureForDisplay(){const H=this.readCentroidForDisplay();
return{attributes:this.readAttributes(),geometry:this.readLegacyGeometryForDisplay(),centroid:(H&&{x:H.coords[0],y:H.coords[1]})??null}}readLegacyFeatureWorldSpace(){const H=this.readCentroidWorldSpace();return{attributes:this.readAttributes(),geometry:this._readLegacyGeometryWorldSpace(),centroid:(H&&{x:H.coords[0],y:H.coords[1]})??null}}readLegacyGeometryForDisplay(){const H=this.readGeometryForDisplay();return e.convertToGeometry(H,this.geometryType,!1,!1)}readXForDisplay(){return this._readX()}readYForDisplay(){return this._readY()}readXWorldSpace(){const H=
this._readX(),I=this.getInTransform();return null==I?H:H*I.scale[0]+I.translate[0]}readYWorldSpace(){const H=this._readY(),I=this.getInTransform();return null==I?H:I.translate[1]-H*I.scale[1]}readGeometryForDisplay(){var H=this._readGeometryDeltaDecoded(!0);return H?H:(H=this._createGeometryFromServerCentroid())?H.deltaDecode():null}readGeometryWorldSpace(){var H=this._readGeometry();H||=this._createGeometryFromServerCentroid();if(!H)return null;H=H.clone();const I=this.getInTransform();null!=I&&
e.unquantizeOptimizedGeometry(H,H,this.hasZ,this.hasM,I);return H}readCentroidForDisplay(){const H=this.readGeometryForDisplay();return H?this._computeDisplayCentroid(H):this._readServerCentroid()}readCentroidWorldSpace(){var H=this.readGeometryForDisplay();H=H?this._computeDisplayCentroid(H):this._readServerCentroid();if(!H)return null;H=H.clone();const I=this.getInTransform();null!=I&&e.unquantizeOptimizedGeometry(H,H,this.hasZ,this.hasM,I);return H}setCache(H){let I=this._caches.get(H);null==I&&
(I=new t.FeatureSetCache(this.getSize()),this._caches.set(H,I));this._activeCache=I}setCachedValue(H){this._activeCache.set(this.getIndex(),H)}hasCachedValue(){return this._activeCache.has(this.getIndex())}getCachedValue(){return this._activeCache.get(this.getIndex())}_readGeometryDeltaDecoded(H){H=this._readGeometry(H);return"esriGeometryPoint"!==this.geometryType&&H&&this.getInTransform()?H.deltaDecode():H}get contextTimeZone(){return this._contextTimeZone}set contextTimeZone(H){this._contextTimeZone=
H}readArcadeFeature(){return this}hasField(H){return this.fields.has(H)||this._joined.some(I=>I.hasField(H))}geometry(){var H=this.readGeometryWorldSpace();H=e.convertToGeometry(H,this.geometryType,this.hasZ,this.hasM);if(H=z.fromJSON(H)){if(!this.metadata.spatialReference)throw Error("InternalError: Expected spatial reference to be defined");H.spatialReference=this.metadata.spatialReference}return H}autocastArcadeDate(H,I){return I&&I instanceof Date?this.isUnknownDateTimeField(H)?n.ArcadeDate.unknownDateJSToArcadeDate(I):
n.ArcadeDate.dateJSAndZoneToArcadeDate(I,this.contextTimeZone??p.system):I}isUnknownDateTimeField(H){return this.metadata.fieldsIndex.getTimeZone(H)===p.unknown}field(H){let I=this.fields.get(H);if(I)switch(I.type){case "date-only":case "esriFieldTypeDateOnly":return h.DateOnly.fromReader(this.readAttribute(H,!1));case "time-only":case "esriFieldTypeTimeOnly":return g.TimeOnly.fromReader(this.readAttribute(H,!1));case "esriFieldTypeTimestampOffset":case "timestamp-offset":return n.ArcadeDate.fromReaderAsTimeStampOffset(this.readAttribute(H,
!1));case "date":case "esriFieldTypeDate":return this.autocastArcadeDate(H,this.readAttribute(H,!0));default:return this.readAttribute(H,!1)}for(const K of this._joined)if(K.setIndex(this.getIndex()),I=K.fields.get(H))switch(I.type){case "date-only":case "esriFieldTypeDateOnly":return h.DateOnly.fromReader(K._readAttribute(H,!1));case "time-only":case "esriFieldTypeTimeOnly":return g.TimeOnly.fromReader(K._readAttribute(H,!1));case "esriFieldTypeTimestampOffset":case "timestamp-offset":return n.ArcadeDate.fromReaderAsTimeStampOffset(K._readAttribute(H,
!1));case "date":case "esriFieldTypeDate":return this.autocastArcadeDate(H,K._readAttribute(H,!0));default:return this.readAttribute(H,!1)}throw Error(`Field ${H} does not exist`);}setField(H,I){throw Error("Unable to update feature attribute values, feature is readonly");}keys(){return this.fields.fields.map(H=>H.name)}castToText(H=!1){if(!H)return JSON.stringify(this.readLegacyFeatureForDisplay());H=this.readLegacyFeatureForDisplay();if(!H)return JSON.stringify(null);H={geometry:H.geometry,attributes:{...(H.attributes??
{})}};for(const I in H.attributes){const K=H.attributes[I];K instanceof Date&&(H.attributes[I]=K.getTime())}return JSON.stringify(H)}gdbVersion(){return null}fullSchema(){return this.metadata.arcadeSchema}castAsJson(H=null){return{attributes:this._readAttributes(),geometry:!0===H?.keepGeometryType?this.geometry():this.geometry()?.toJSON()??null}}castAsJsonAsync(H,I=null){return Promise.resolve(this.castAsJson(I))}_getExists(){return null==this._deleted||!this._deleted.has(this.getIndex())}_computeDisplayCentroid(H){if(null==
this.getInTransform())return k.getCentroidOptimizedGeometry(new f,H,this.hasM,this.hasZ);H=c.GeometryCursor.fromOptimized(H,this.geometryType);H.yFactor*=-1;return(H=b.getLabelPoint(H))?(H[1]*=-1,new f([],H)):null}copyInto(H){H._joined=this._joined;H._deleted=this._deleted;H._objectIdToIndex=this._objectIdToIndex;H._boundsBuffer=this._boundsBuffer;H._activeCache=this._activeCache;H._caches=this._caches;H._contextTimeZone=this._contextTimeZone}_readLegacyGeometryWorldSpace(){const H=this.readGeometryWorldSpace();
return e.convertToGeometry(H,this.geometryType,!1,!1)}_createGeometryFromServerCentroid(){const H=this._readServerCentroid();if(!H)return null;const [I,K]=H.coords;return this._createQuantizedExtrudedGeometry(I,K)}_createQuantizedExtrudedGeometry(H,I){return"esriGeometryPolyline"===this.geometryType?this._createQuantizedExtrudedLine(H,I):this._createQuantizedExtrudedQuad(H,I)}_createQuantizedExtrudedQuad(H,I){return new f([5],[H-1,I,1,-1,1,1,-1,1,-1,-1])}_createQuantizedExtrudedLine(H,I){return new f([2],
[H-1,I+1,1,-1])}_removeAtIndex(H){null==this._deleted&&(this._deleted=w.StaticBitSet.create(this.getSize()));this._deleted.set(H)}}l.FeatureSetReader=G;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/arcade/ArcadeDate":function(){define(["exports","../core/string","../core/sql/UnknownTimeZone","../chunks/datetime"],function(l,q,n,d){function m(b,k,e){return b<k?b-k:b>e?b-e:0}function h(b,k=!0){if(b instanceof d.Zone)return b;if("system"===b.toLowerCase())return"system";if("utc"===
b.toLowerCase())return"UTC";if("unknown"===b.toLowerCase())return n.UnknownTimeZone.instance;if(/^[+-]?[0-9]{1,2}([:][0-9]{2})?$/.test(b)){const e=d.FixedOffsetZone.parseSpecifier("UTC"+(b.startsWith("+")||b.startsWith("-")?"":"+")+b);if(e)return e}b=d.IANAZone.create(b);if(!b.isValid){if(k)throw new c(l.ArcadeDateErrorCodes.TimeZoneNotRecognized);return null}return b}l.ArcadeDateErrorCodes=void 0;(l.ArcadeDateErrorCodes||(l.ArcadeDateErrorCodes={})).TimeZoneNotRecognized="TimeZoneNotRecognized";
const g={[l.ArcadeDateErrorCodes.TimeZoneNotRecognized]:"Timezone identifier has not been recognized."};class c extends Error{constructor(b,k){super(q.replace(g[b],k));this.declaredRootClass="esri.arcade.arcadedate.dateerror";Error.captureStackTrace&&Error.captureStackTrace(this,c)}}class a{constructor(b){this._date=b;this.declaredRootClass="esri.arcade.arcadedate"}static fromParts(b=0,k=1,e=1,r=0,f=0,p=0,t=0,w){if(isNaN(b)||isNaN(k)||isNaN(e)||isNaN(r)||isNaN(f)||isNaN(p)||isNaN(t))return null;const z=
d.DateTime.local(b,k).daysInMonth;b=d.DateTime.fromObject({day:1>e?1:e>z?z:e,year:b,month:1>k?1:12<k?12:k,hour:0>r?0:23<r?23:r,minute:0>f?0:59<f?59:f,second:0>p?0:59<p?59:p,millisecond:0>t?0:999<t?999:t},{zone:h(w)});b=b.plus({months:m(k,1,12),days:m(e,1,z),hours:m(r,0,23),minutes:m(f,0,59),seconds:m(p,0,59),milliseconds:m(t,0,999)});return new a(b)}static get systemTimeZoneCanonicalName(){return Intl.DateTimeFormat().resolvedOptions().timeZone??"system"}static arcadeDateAndZoneToArcadeDate(b,k){k=
h(k);return b.isUnknownTimeZone||k===n.UnknownTimeZone.instance?a.fromParts(b.year,b.monthJS+1,b.day,b.hour,b.minute,b.second,b.millisecond,k):new a(b._date.setZone(k))}static dateJSToArcadeDate(b){return new a(d.DateTime.fromJSDate(b,{zone:"system"}))}static dateJSAndZoneToArcadeDate(b,k="system"){k=h(k);return new a(d.DateTime.fromJSDate(b,{zone:k}))}static unknownEpochToArcadeDate(b){return new a(d.DateTime.fromMillis(b,{zone:n.UnknownTimeZone.instance}))}static unknownDateJSToArcadeDate(b){return new a(d.DateTime.fromMillis(b.getTime(),
{zone:n.UnknownTimeZone.instance}))}static epochToArcadeDate(b,k="system"){k=h(k);return new a(d.DateTime.fromMillis(b,{zone:k}))}static dateTimeToArcadeDate(b){return new a(b)}clone(){return new a(this._date)}changeTimeZone(b){b=h(b);return a.dateTimeToArcadeDate(this._date.setZone(b))}static dateTimeAndZoneToArcadeDate(b,k){k=h(k);return b.zone===n.UnknownTimeZone.instance||k===n.UnknownTimeZone.instance?a.fromParts(b.year,b.month,b.day,b.hour,b.minute,b.second,b.millisecond,k):new a(b.setZone(k))}static nowToArcadeDate(b){b=
h(b);return new a(d.DateTime.fromJSDate(new Date,{zone:b}))}static nowUTCToArcadeDate(){return new a(d.DateTime.utc())}get isSystem(){return"system"===this.timeZone||this.timeZone===a.systemTimeZoneCanonicalName}equals(b){return this.isSystem&&b.isSystem?this.toNumber()===b.toNumber():this.isUnknownTimeZone!==b.isUnknownTimeZone?!1:this._date.equals(b._date)}get isUnknownTimeZone(){return this._date.zone===n.UnknownTimeZone.instance}get isValid(){return this._date.isValid}get hour(){return this._date.hour}get second(){return this._date.second}get day(){return this._date.day}get dayOfWeekISO(){return this._date.weekday}get dayOfWeekJS(){let b=
this._date.weekday;6<b&&(b=0);return b}get millisecond(){return this._date.millisecond}get monthISO(){return this._date.month}get weekISO(){return this._date.weekNumber}get yearISO(){return this._date.weekYear}get monthJS(){return this._date.month-1}get year(){return this._date.year}get minute(){return this._date.minute}get zone(){return this._date.zone}get timeZoneOffset(){return this.isUnknownTimeZone?0:this._date.offset}get timeZone(){if(this.isUnknownTimeZone)return"unknown";if("system"===this._date.zone.type)return"system";
const b=this.zone;return"fixed"===b.type?0===b.fixed?"UTC":b.formatOffset(0,"short"):b.name}stringify(){return JSON.stringify(this.toJSDate())}plus(b){return new a(this._date.plus(b))}diff(b,k="milliseconds"){return this._date.diff(b._date,k)[k]}toISODate(){return this._date.toISODate()}toISOString(b){return b?this._date.toISO({suppressMilliseconds:!0,includeOffset:!this.isUnknownTimeZone}):this._date.toISO({includeOffset:!this.isUnknownTimeZone})}toISOTime(b,k){return this._date.toISOTime({suppressMilliseconds:b,
includeOffset:k&&!this.isUnknownTimeZone})}toFormat(b,k){this.isUnknownTimeZone&&(b=b.replaceAll("Z",""));return this._date.toFormat(b,k)}toJSDate(){return this._date.toJSDate()}toSQLValue(){return this._date.toFormat("yyyy-LL-dd HH:mm:ss")}toSQLWithKeyword(){return`timestamp '${this.toSQLValue()}'`}toDateTime(){return this._date}toNumber(){return this._date.toMillis()}getTime(){return this._date.toMillis()}toUTC(){return new a(this._date.toUTC())}toLocal(){return new a(this._date.toLocal())}toString(){return this.toISOString(!0)}static fromReaderAsTimeStampOffset(b){if(!b)return null;
b=d.DateTime.fromISO(b,{setZone:!0});return new a(b)}}l.ArcadeDate=a;l.ArcadeDateError=c;l.arcadeDateErrorMessages=g;l.createDateTimeZone=h;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/core/sql/DateOnly":function(){define(["exports","../../arcade/ArcadeDate","../../intl/locale","../../chunks/datetime"],function(l,q,n,d){function m(g){g=g.replaceAll(/LTS|LT|L{1,4}|l{1,4}/g,"[$\x26]");let c="";const a=/(\[[^[]*\])|(\\)?([Hh]mm(ss)?|Mo|M{1,4}|Do|DDDo|D{1,4}|d{2,4}|do?|w[o|w]?|W[o|W]?|Qo?|N{1,5}|YYYYYY|YYYYY|YYYY|YY|y{2,4}|yo?|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|kk?|mm?|ss?|S{1,9}|x|X|zz?|ZZ?|.)/g;
for(const b of g.match(a)||[])switch(b){case "D":c+="d";break;case "DD":c+="dd";break;case "DDD":c+="o";break;case "d":c+="c";break;case "ddd":c+="ccc";break;case "dddd":c+="cccc";break;case "M":c+="L";break;case "MM":c+="LL";break;case "MMM":c+="LLL";break;case "MMMM":c+="LLLL";break;case "YY":c+="yy";break;case "Y":case "YYYY":c+="yyyy";break;case "Q":c+="q";break;case "X":case "x":c+=b;break;default:c=2<=b.length&&"["===b.slice(0,1)&&"]"===b.slice(-1)?c+`'${b.slice(1,-1)}'`:c+`'${b}'`}return c}
class h{constructor(g,c,a){this._year=g;this._month=c;this._day=a;this.declaredRootClass="esri.core.sql.dateonly"}get month(){return this._month}get monthJS(){return this._month-1}get year(){return this._year}get day(){return this._day}get isValid(){return this.toDateTime("unknown").isValid}equals(g){return g instanceof h&&g.day===this.day&&g.month===this.month&&g.year===this.year}clone(){return new h(this._year,this._month,this._day)}toDateTime(g){return d.DateTime.fromObject({day:this.day,month:this.month,
year:this.year},{zone:q.createDateTimeZone(g)})}toDateTimeLuxon(g){return d.DateTime.fromObject({day:this.day,month:this.month,year:this.year},{zone:q.createDateTimeZone(g)})}toString(){return`${this.year.toString().padStart(4,"0")}-${this.month.toString().padStart(2,"0")}-${this.day.toString().padStart(2,"0")}`}toFormat(g=null,c=!0){if(null===g||""===g)return this.toString();c&&(g=m(g));if(!g)return"";c=this.toDateTime("unknown");return q.ArcadeDate.dateTimeToArcadeDate(c).toFormat(g,{locale:n.getLocale(),
numberingSystem:"latn"})}toArcadeDate(){const g=this.toDateTime("unknown");return q.ArcadeDate.dateTimeToArcadeDate(g)}toNumber(){return this.toDateTime("unknown").toMillis()}toJSDate(){return this.toDateTime("unknown").toJSDate()}toStorageFormat(){return this.toFormat("yyyy-LL-dd",!1)}toSQLValue(){return this.toFormat("yyyy-LL-dd",!1)}toSQLWithKeyword(){return"date '"+this.toFormat("yyyy-LL-dd",!1)+"'"}plus(g,c){return h.fromDateTime(this.toUTCDateTime().plus({[g]:c}))}toUTCDateTime(){return d.DateTime.utc(this.year,
this.month,this.day,0,0,0,0)}difference(g,c){switch(c.toLowerCase()){case "days":case "day":case "d":return this.toUTCDateTime().diff(g.toUTCDateTime(),"days").days;case "months":case "month":return this.toUTCDateTime().diff(g.toUTCDateTime(),"months").months;case "minutes":case "minute":case "m":return"M"===c?this.toUTCDateTime().diff(g.toUTCDateTime(),"months").months:this.toUTCDateTime().diff(g.toUTCDateTime(),"minutes").minutes;case "seconds":case "second":case "s":return this.toUTCDateTime().diff(g.toUTCDateTime(),
"seconds").seconds;case "milliseconds":case "millisecond":case "ms":return this.toUTCDateTime().diff(g.toUTCDateTime(),"milliseconds").milliseconds;case "hours":case "hour":case "h":return this.toUTCDateTime().diff(g.toUTCDateTime(),"hours").hours;case "years":case "year":case "y":return this.toUTCDateTime().diff(g.toUTCDateTime(),"years").years;default:return this.toUTCDateTime().diff(g.toUTCDateTime(),"milliseconds").milliseconds}}static fromMilliseconds(g){g=d.DateTime.fromMillis(g,{zone:d.FixedOffsetZone.utcInstance});
return g.isValid?h.fromParts(g.year,g.month,g.day):null}static fromSeconds(g){g=d.DateTime.fromSeconds(g,{zone:d.FixedOffsetZone.utcInstance});return g.isValid?h.fromParts(g.year,g.month,g.day):null}static fromReader(g){if(!g)return null;g=g.split("-");return 3!==g.length?null:new h(parseInt(g[0],10),parseInt(g[1],10),parseInt(g[2],10))}static fromParts(g,c,a){g=new h(g,c,a);return!1===g.isValid?null:g}static fromDateJS(g){return h.fromParts(g.getFullYear(),g.getMonth()+1,g.getDay())}static fromDateTime(g){return h.fromParts(g.year,
g.month,g.day)}static fromSqlTimeStampOffset(g){return this.fromDateTime(g.toDateTime())}static fromString(g,c=null){if(""===g||null===g)return null;var a=[];if(c)(c=m(c))&&a.push(c);else if(null===c||""===c)return g=d.DateTime.fromISO(g,{setZone:!0}),g.isValid?h.fromParts(g.year,g.month,g.day):null;for(const b of a)if(a=d.DateTime.fromFormat(g,c??b),a.isValid)return new h(a.year,a.month,a.day);return null}static fromNow(g="system"){g=d.DateTime.fromJSDate(new Date).setZone(q.createDateTimeZone(g));
return new h(g.year,g.month,g.day)}}l.DateOnly=h;l.standardizeDateOnlyFormat=m;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/core/sql/TimeOnly":function(){define(["exports","../../arcade/kernel","../../intl/locale","../../chunks/datetime"],function(l,q,n,d){function m(g){if(!g)return"";const c=/(a|A|hh?|HH?|mm?|ss?|SSS|S|.)/g;let a="";for(const b of g.match(c)||[])switch(b){case "SSS":a+=b;break;case "A":case "a":a+="a";break;case "m":case "mm":case "h":case "hh":case "H":case "HH":case "s":case "ss":a+=
b;break;default:a+=`'${b}'`}return a}class h{constructor(g,c,a,b){this._hour=g;this._minute=c;this._second=a;this._millisecond=b;this.declaredRootClass="esri.core.sql.timeonly"}get hour(){return this._hour}get minute(){return this._minute}get second(){return this._second}get millisecond(){return this._millisecond}equals(g){return g instanceof h&&g.hour===this.hour&&g.minute===this.minute&&g.second===this.second&&g.millisecond===this.millisecond}clone(){return new h(this.hour,this.minute,this.second,
this.millisecond)}isValid(){return q.isInteger(this.hour)&&q.isInteger(this.minute)&&q.isInteger(this.second)&&q.isInteger(this.millisecond)&&0<=this.hour&&24>this.hour&&0<=this.minute&&60>this.minute&&0<=this.second&&60>this.second&&0<=this.millisecond&&1E3>this.millisecond}toString(){return`${this.hour.toString().padStart(2,"0")}:${this.minute.toString().padStart(2,"0")}:${this.second.toString().padStart(2,"0")}`+(0<this.millisecond?"."+this.millisecond.toString().padStart(3,"0"):"")}toSQLValue(){return this.toString()}toSQLWithKeyword(){return`time '${this.hour.toString().padStart(2,
"0")}:${this.minute.toString().padStart(2,"0")}:${this.second.toString().padStart(2,"0")}${0<this.millisecond?"."+this.millisecond.toString().padStart(3,"0"):""}'`}toStorageString(){return`${this.hour.toString().padStart(2,"0")}:${this.minute.toString().padStart(2,"0")}:${this.second.toString().padStart(2,"0")}`}toFormat(g=null){return null===g||""===g?this.toString():(g=m(g))?d.DateTime.local(1970,1,1,this._hour,this._minute,this._second,this._millisecond).toFormat(g,{locale:n.getLocale(),numberingSystem:"latn"}):
""}toNumber(){return this.millisecond+1E3*this.second+6E4*this.minute+36E5*this.hour}static fromParts(g,c,a,b){g=new h(g,c,a,b);return g.isValid()?g:null}static fromReader(g){if(!g)return null;g=g.split(":");return 3!==g.length?null:new h(parseInt(g[0],10),parseInt(g[1],10),parseInt(g[2],10),0)}static fromMilliseconds(g){return 864E5<g||0>g?null:new h(Math.floor(g/36E5%24),Math.floor(g/6E4%60),Math.floor(g/1E3%60),Math.floor(g%1E3))}static fromDateJS(g){return new h(g.getHours(),g.getMinutes(),g.getSeconds(),
g.getMilliseconds())}static fromDateTime(g){return new h(g.hour,g.minute,g.second,g.millisecond)}static fromSqlTimeStampOffset(g){return this.fromDateTime(g.toDateTime())}static fromString(g,c=null){if(""===g||null===g)return null;const a=[];if(c)(c=m(c))&&a.push(c);else if(null===c||""===c)a.push("HH:mm:ss"),a.push("HH:mm:ss.SSS"),a.push("hh:mm:ss a"),a.push("hh:mm:ss.SSS a"),a.push("HH:mm"),a.push("hh:mm a"),a.push("H:mm"),a.push("h:mm a"),a.push("H:mm:ss"),a.push("h:mm:ss a"),a.push("H:mm:ss.SSS"),
a.push("h:mm:ss.SSS a");for(const b of a)if(c=d.DateTime.fromFormat(g,b),c.isValid)return new h(c.hour,c.minute,c.second,c.millisecond);return null}plus(g,c){switch(g){case "days":case "years":case "months":return this.clone();case "hours":case "minutes":case "seconds":case "milliseconds":return h.fromDateTime(this.toUTCDateTime().plus({[g]:c}))}return null}toUTCDateTime(){return d.DateTime.utc(1970,1,1,this.hour,this.minute,this.second,this.millisecond)}difference(g,c){switch(c.toLowerCase()){case "days":case "day":case "d":return this.toUTCDateTime().diff(g.toUTCDateTime(),
"days").days;case "months":case "month":return this.toUTCDateTime().diff(g.toUTCDateTime(),"months").months;case "minutes":case "minute":case "m":return"M"===c?this.toUTCDateTime().diff(g.toUTCDateTime(),"months").months:this.toUTCDateTime().diff(g.toUTCDateTime(),"minutes").minutes;case "seconds":case "second":case "s":return this.toUTCDateTime().diff(g.toUTCDateTime(),"seconds").seconds;case "milliseconds":case "millisecond":case "ms":return this.toUTCDateTime().diff(g.toUTCDateTime(),"milliseconds").milliseconds;
case "hours":case "hour":case "h":return this.toUTCDateTime().diff(g.toUTCDateTime(),"hours").hours;case "years":case "year":case "y":return this.toUTCDateTime().diff(g.toUTCDateTime(),"years").years;default:return this.toUTCDateTime().diff(g.toUTCDateTime(),"milliseconds").milliseconds}}}l.TimeOnly=h;l.standardizeTimeFormat=m;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/arcade/kernel":function(){define(["exports","../geometry/Extent"],function(l,q){l.cloneGeometry=function(n){if(null==
n)return null;const d=n.clone();void 0!==n.cache._geVersion&&(d.cache._geVersion=n.cache._geVersion);return d};l.convertLinearUnitsToCode=function(n){if(null==n)return null;if("number"===typeof n)return n;n=n.toLowerCase();n=n.replaceAll(/\s/g,"");n=n.replaceAll("-","");switch(n){case "meters":case "meter":case "m":case "squaremeters":case "squaremeter":return 9001;case "miles":case "mile":case "squaremile":case "squaremiles":return 9093;case "kilometers":case "kilometer":case "squarekilometers":case "squarekilometer":case "km":return 9036;
case "yard":case "yd":case "yards":case "squareyards":case "squareyard":return 9096;case "feet":case "ft":case "foot":case "squarefeet":case "squarefoot":return 9002;case "nmi":case "nauticalmile":case "nauticalmiles":case "squarenauticalmile":case "squarenauticalmiles":return 9030}return null};l.convertSquareUnitsToCode=function(n){if(null==n)return null;if("number"===typeof n)return n;n=n.toLowerCase();n=n.replaceAll(/\s/g,"");n=n.replaceAll("-","");switch(n){case "meters":case "meter":case "m":case "squaremeters":case "squaremeter":return 109404;
case "miles":case "mile":case "squaremile":case "squaremiles":return 109439;case "kilometers":case "kilometer":case "squarekilometers":case "squarekilometer":case "km":return 109414;case "acres":case "acre":case "ac":return 109402;case "hectares":case "hectare":case "ha":return 109401;case "yard":case "yd":case "yards":case "squareyards":case "squareyard":return 109442;case "feet":case "ft":case "foot":case "squarefeet":case "squarefoot":return 109405;case "nmi":case "nauticalmile":case "nauticalmiles":case "squarenauticalmile":case "squarenauticalmiles":return 109409}return null};
l.isInteger=function(n){return"number"===typeof n&&isFinite(n)&&Math.floor(n)===n};l.sameGeomType=function(n,d){return n===d||"point"===n&&"esriGeometryPoint"===d||"polyline"===n&&"esriGeometryPolyline"===d||"polygon"===n&&"esriGeometryPolygon"===d||"extent"===n&&"esriGeometryEnvelope"===d||"multipoint"===n&&"esriGeometryMultipoint"===d||"point"===d&&"esriGeometryPoint"===n||"polyline"===d&&"esriGeometryPolyline"===n||"polygon"===d&&"esriGeometryPolygon"===n||"extent"===d&&"esriGeometryEnvelope"===
n||"multipoint"===d&&"esriGeometryMultipoint"===n?!0:!1};l.shapeExtent=function(n){if(null==n)return null;switch(n.type){case "polygon":case "multipoint":case "polyline":return n.extent;case "point":return new q({xmin:n.x,ymin:n.y,xmax:n.x,ymax:n.y,spatialReference:n.spatialReference});case "extent":return n}return null};Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/centroid":function(){define(["exports"],function(l){function q(d,m,h,g,c,a){a=c?a?4:3:a?3:2;
let b=h,k=h+a,e=0,r=0,f=h=0,p=0;for(let t=0,w=g-1;t<w;t++,b+=a,k+=a){g=m[b];const z=m[b+1],u=m[b+2],y=m[k],A=m[k+1],v=m[k+2];let x=g*A-y*z;f+=x;e+=(g+y)*x;r+=(z+A)*x;c&&(x=g*v-y*u,h+=(u+v)*x,p+=x);g<d[0]&&(d[0]=g);g>d[1]&&(d[1]=g);z<d[2]&&(d[2]=z);z>d[3]&&(d[3]=z);c&&(u<d[4]&&(d[4]=u),u>d[5]&&(d[5]=u))}0<f&&(f*=-1);0<p&&(p*=-1);if(!f)return null;d=[e,r,.5*f];c&&(d[3]=h,d[4]=.5*p);return d}function n(d,m,h,g,c){c=g?c?4:3:c?3:2;let a=m,b=m+c,k=0,e=0,r=0,f=0;for(let z=0,u=h-1;z<u;z++,a+=c,b+=c){var p=
d[a];const y=d[a+1],A=d[a+2],v=d[b],x=d[b+1],C=d[b+2];if(g){var t=v-p;var w=x-y;const B=C-A;t=Math.sqrt(t*t+w*w+B*B)}else t=v-p,w=x-y,t=Math.sqrt(t*t+w*w);t&&(k+=t,g?(p=[p+.5*(v-p),y+.5*(x-y),A+.5*(C-A)],e+=t*p[0],r+=t*p[1],f+=t*p[2]):(p=[p+.5*(v-p),y+.5*(x-y)],e+=t*p[0],r+=t*p[1]))}return 0<k?g?[e/k,r/k,f/k]:[e/k,r/k]:0<h?g?[d[m],d[m+1],d[m+2]]:[d[m],d[m+1]]:null}l.getCentroidOptimizedGeometry=function(d,m,h,g){if(!m?.lengths.length)return null;d.lengths.length&&(d.lengths.length=0);d.coords.length&&
(d.coords.length=0);const c=d.coords,a=[],b=h?[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY]:[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY],{lengths:k,coords:e}=m;var r=h?g?4:3:g?3:2;let f=0;for(const p of k){const t=q(b,e,f,p,h,g);t&&a.push(t);f+=p*r}a.sort((p,t)=>{let w=p[2]-t[2];0===w&&h&&(w=p[4]-t[4]);return w});a.length&&(r=6*a[0][2],
c[0]=a[0][0]/r,c[1]=a[0][1]/r,h&&(r=6*a[0][4],c[2]=0!==r?a[0][3]/r:0),c[0]<b[0]||c[0]>b[1]||c[1]<b[2]||c[1]>b[3]||h&&(c[2]<b[4]||c[2]>b[5]))&&(c.length=0);if(!c.length)if(m=m.lengths[0]?n(e,0,k[0],h,g):null)c[0]=m[0],c[1]=m[1],h&&2<m.length&&(c[2]=m[2]);else return null;return d};l.lineCentroid=n;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/support/FeatureSetCache":function(){define(["exports","./StaticBitSet"],function(l,q){class n{constructor(d){this._valid=
q.StaticBitSet.create(d);this._data=Array(d)}has(d){return this._valid.has(d)}set(d,m){this._valid.set(d);this._data[d]=m}get(d){return this._data[d]}}l.FeatureSetCache=n;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/graphics/GraphicStore":function(){define("../../../../core/has ../../../../core/screenUtils ../../../../chunks/rbush ../../../../geometry/support/aaBoundingRect ../../../../geometry/support/boundsUtils ../../../../geometry/support/normalizeUtils ../../../../geometry/support/spatialReferenceUtils ../../../../symbols/cim/CIMSymbolDrawHelper ../../../../symbols/cim/CIMSymbolHelper ../../engine/webgl/definitions ./GraphicStoreItem ./graphicsUtils ./GraphicUpdateMessage".split(" "),
function(l,q,n,d,m,h,g,c,a,b,k,e,r){function f(t,w){return w.zOrder-t.zOrder}class p{constructor(t,w,z,u,y){this._items=new Map;this._boundsDirty=!1;this._outSpatialReference=t;this._cimResourceManager=w;this._hittestDrawHelper=new c.HittestDrawHelper(w);this._tileInfoView=z;this._store=y;t=z.getClosestInfoForScale(u);this._resolution=this._tileInfoView.getTileResolution(t.level)}destroy(){this._hittestDrawHelper.destroy()}items(){return this._items.values()}getItem(t){return this._items.get(t)}async update(t,
w,z){const u=[],y=[],A=[],v=new Set,x=[];let C=0;for(const E of t.items){C++;var B=E.uid;const D=this._items.get(B);t=w(E);v.add(B);D?D.update(E,t,C)&&(y.push(D),x.push(this._updateItem(D,z))):(B=this._store.createDisplayIdForObjectId(B),t=k.GraphicStoreItem.fromGraphic(E,t,C,B),x.push(this._updateItem(t,z)),this._items.set(t.objectId,t),u.push(t))}for(const [E,D]of this._items.entries())v.has(E)||(this._store.releaseDisplayIdForObjectId(E),this._items.delete(E),A.push(D));await Promise.all(x);this._index=
null;return new r.GraphicUpdateMessage(u,y,A)}updateLevel(t){this._resolution!==t&&(this._index=null,this._boundsDirty=!0,this._resolution=t)}hitTest(t,w,z,u,y){var A=(z=l("esri-mobile"))?b.hittestToleranceMobile:b.hittestToleranceDesktop,v=A+(z?0:b.hittestToleranceSmallSymbol);t=h.normalizeMapX(t,this._tileInfoView.spatialReference);var x=u*window.devicePixelRatio*v;z=d.create();z[0]=t-x;z[1]=w-x;z[2]=t+x;z[3]=w+x;x=u*window.devicePixelRatio*A;A=d.create();A[0]=t-x;A[1]=w-x;A[2]=t+x;A[3]=w+x;v=.5*
u*(v+e.pixelBuffer);w=this._searchIndex(t-v,w-v,t+v,w+v);if(!w||0===w.length)return[];t=[];v=d.create();x=d.create();for(var C of w){if(!C.visible)continue;const {projectedGeometry:B,symbolResource:E}=C;this._getSymbolBounds(v,E,B,x,y);x[3]=x[2]=x[1]=x[0]=0;d.intersects(v,z)&&t.push(C)}if(0===t.length)return[];C=this._hittestDrawHelper;z=[];for(const B of t){const {projectedGeometry:E,symbolResource:D}=B;if(!D)continue;const {textInfo:F,symbolInfo:G}=D;C.hitTest(A,G.cimSymbol.symbol,E,F,y,u)&&z.push(B)}z.sort(f);
return z.map(B=>B.objectId)}queryItems(t){return 0===this._items.size?[]:this._searchForItems(t)}clear(){this._items.clear();this._index=null}async _updateItem(t,w){await t.projectAndNormalize(this._outSpatialReference);await w(t);({size:w}=t);w[0]=w[1]=w[2]=w[3]=0;this._getSymbolBounds(t.bounds,t.symbolResource,t.projectedGeometry,t.size,0)}_searchIndex(t,w,z,u){this._boundsDirty&&(this._items.forEach(y=>this._getSymbolBounds(y.bounds,y.symbolResource,y.projectedGeometry,y.size,0)),this._boundsDirty=
!1);this._index||(this._index=n.rbush(9,y=>({minX:y.bounds[0],minY:y.bounds[1],maxX:y.bounds[2],maxY:y.bounds[3]})),this._index.load(Array.from(this._items.values())));return this._index.search({minX:t,minY:w,maxX:z,maxY:u})}_searchForItems(t){var w=this._tileInfoView.spatialReference,z=t.bounds,u=g.getInfo(w);if(u&&w.isWrappable){const [y,A]=u.valid;w=1E-5>Math.abs(z[2]-A);u=1E-5>Math.abs(z[0]-y);if(!(w&&u||!w&&!u))return t=t.resolution,t=w?d.create([y,z[1],y+t*e.pixelBuffer,z[3]]):d.create([A-t*
e.pixelBuffer,z[1],A,z[3]]),z=this._searchIndex(z[0],z[1],z[2],z[3]),t=this._searchIndex(t[0],t[1],t[2],t[3]),[...(new Set([...z,...t]))]}return this._searchIndex(z[0],z[1],z[2],z[3])}_getSymbolBounds(t,w,z,u,y){if(!w||!w.symbolInfo.linearCIM||!z)return null;t||=d.create();m.getBoundsXY(t,z);if(!u||0===u[0]&&0===u[1]&&0===u[2]&&0===u[3]){const {textInfo:A,symbolInfo:v}=w;w=v.cimSymbol;u||=[0,0,0,0];y=a.CIMSymbolInflatedSizeHelper.getSymbolInflateSize(u,w.symbol,this._cimResourceManager,y,A);u[0]=
q.pt2px(y[0]);u[1]=q.pt2px(y[1]);u[2]=q.pt2px(y[2]);u[3]=q.pt2px(y[3])}y=this._resolution;u=a.CIMSymbolInflatedSizeHelper.safeSize(u);t[0]-=u*y;t[1]-=u*y;t[2]+=u*y;t[3]+=u*y;return t}}return p})},"esri/views/2d/layers/graphics/GraphicStoreItem":function(){define("exports ../../../../geometry/support/aaBoundingRect ../../../../geometry/support/coordsUtils ../../../../geometry/support/jsonUtils ../../../../geometry/support/normalizeUtilsSync ../../../../layers/graphics/data/projectionSupport ./graphicsUtils".split(" "),
function(l,q,n,d,m,h,g){class c{static fromGraphic(a,b,k,e){return new c(a.geometry,b,a.attributes,a.visible,a.uid,a.version,k,e)}constructor(a,b,k,e,r,f,p,t){this.geometry=a;this.symbol=b;this.attributes=k;this.visible=e;this.objectId=r;this._version=f;this.zOrder=p;this.displayId=t;this.bounds=q.create();this.prevBounds=q.create();this.size=[0,0,0,0]}get linearCIM(){return this.symbolResource?.symbolInfo.linearCIM}get hasAnimations(){const {linearCIM:a}=this;return a?a.some(b=>"animationParams"in
b&&!!b.animationParams):!1}update(a,b,k){if(this._version===a.version&&this.zOrder===k&&this.symbol===b)return!1;this.prevBounds=this.bounds;this.bounds=q.create();this.zOrder=k;this.geometry=a.geometry;this.attributes=a.attributes;this.symbol=b;this.visible=a.visible;this._version=a.version;this.projectedGeometry=this.symbolResource=null;return!0}async projectAndNormalize(a){let b=this.geometry;if(b&&b.spatialReference&&"mesh"!==b.type){"extent"===b.type&&(b=g.polygonFromExtent(b));await h.checkProjectionSupport(b.spatialReference,
a);var k=m.normalizeCentralMeridianForDisplay(b);k&&((a=h.project(k,b.spatialReference,a))&&n.closeRingsAndFixWinding(a),this.projectedGeometry=d.isExtent(a)?g.polygonFromExtent(a):a)}}}l.GraphicStoreItem=c;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/normalizeUtilsSync":function(){define("exports ../../core/JSONSupport ./aaBoundingRect ./boundsUtils ./coordsUtils ./jsonUtils ./normalizeUtilsCommon ./spatialReferenceUtils".split(" "),function(l,q,n,d,m,h,
g,c){function a(A,v){if(null==A)return null;var x=A.spatialReference,C=c.getInfo(x);A=q.isSerializable(A)?A.toJSON():A;if(!C)return A;x=c.isWebMercator(x)?102100:4326;const B=g.cutParams[x].maxX,E=g.cutParams[x].minX;if(h.isPoint(A))return k(A,B,E);if(h.isMultipoint(A))A.points=A.points.map(D=>k(D,B,E));else{if(h.isExtent(A))return b(A,C);if(h.isPolygon(A)||h.isPolyline(A)){x=d.getBoundsXY(u,A);C=x[0];x=x[2];const D=2*g.offsetMagnitude(C,E)*B;A=0===D?A:g.updatePolyGeometry(A,D);C+=D;x+=D;return x>
B?t(A,B,v):C<E?t(A,E,v):A}}return A}function b(A,v){if(!v)return A;const x=e(A,v).map(C=>C.extent);return 2>x.length?x[0]||A:2<x.length?(A.xmin=v.valid[0],A.xmax=v.valid[1],A):{rings:x.map(C=>[[C.xmin,C.ymin],[C.xmin,C.ymax],[C.xmax,C.ymax],[C.xmax,C.ymin],[C.xmin,C.ymin]])}}function k(A,v,x){if(Array.isArray(A)){var C=A[0];C>v?(x=g.offsetMagnitude(C,v),A[0]=C+-2*x*v):C<x&&(v=g.offsetMagnitude(C,x),A[0]=C+-2*v*x)}else C=A.x,C>v?(x=g.offsetMagnitude(C,v),A.x+=-2*x*v):C<x&&(v=g.offsetMagnitude(C,x),
A.x+=-2*v*x);return A}function e(A,v){const x=[],{ymin:C,ymax:B,xmin:E,xmax:D}=A;var F=A.xmax-A.xmin;const [G,H]=v.valid,{x:I,frameId:K}=r(A.xmin,v),{x:L,frameId:R}=r(A.xmax,v);A=I===L&&0<F;if(F>2*H){F={xmin:E<D?I:L,ymin:C,xmax:H,ymax:B};A={xmin:G,ymin:C,xmax:E<D?L:I,ymax:B};v={xmin:0,ymin:C,xmax:H,ymax:B};const S={xmin:G,ymin:C,xmax:0,ymax:B},W=[],J=[];f(F,v)&&W.push(K);f(F,S)&&J.push(K);f(A,v)&&W.push(R);f(A,S)&&J.push(R);for(let O=K+1;O<R;O++)W.push(O),J.push(O);x.push(new z(F,[K]),new z(A,[R]),
new z(v,W),new z(S,J))}else I>L||A?x.push(new z({xmin:I,ymin:C,xmax:H,ymax:B},[K]),new z({xmin:G,ymin:C,xmax:L,ymax:B},[R])):x.push(new z({xmin:I,ymin:C,xmax:L,ymax:B},[K]));return x}function r(A,v){const [x,C]=v.valid;v=2*C;var B=0;A>C?(B=Math.ceil(Math.abs(A-C)/v),A-=B*v):A<x&&(B=Math.ceil(Math.abs(A-x)/v),A+=B*v,B=-B);return{x:A,frameId:B}}function f(A,v){const {xmin:x,ymin:C,xmax:B,ymax:E}=v;return p(A,x,C)&&p(A,x,E)&&p(A,B,E)&&p(A,B,C)}function p(A,v,x){return v>=A.xmin&&v<=A.xmax&&x>=A.ymin&&
x<=A.ymax?!0:!1}function t(A,v,x=!0){const C=!h.isPolyline(A);C&&m.closeRings(A);if(x)return(new y).cut(A,v);x=C?A.rings:A.paths;const B=C?4:2,E=x.length;v*=-2;for(let D=0;D<E;D++){const F=x[D];if(F&&F.length>=B){const G=[];for(const H of F)G.push([H[0]+v,H[1]]);x.push(G)}}C?A.rings=x:A.paths=x;return A}function w(A,v,x){const C=A.length;1<C&&A[C-1][0]===v&&A[C-2][0]===v?A[C-1][1]=x:A.push([v,x])}class z{constructor(A,v){this.extent=A;this.frameIds=v}}const u=n.create();class y{constructor(){this._linesIn=
[];this._linesOut=[]}cut(A,v){this._xCut=v;if(A.rings)this._closed=!0,v=A.rings,this._minPts=4;else if(A.paths)this._closed=!1,v=A.paths,this._minPts=2;else return null;for(var x of v)if(x&&!(x.length<this._minPts)){v=!0;for(const C of x)v?(this.moveTo(C),v=!1):this.lineTo(C);this._closed&&this.close()}this._pushLineIn();this._pushLineOut();v=[];for(const C of this._linesIn)C&&C.length>=this._minPts&&v.push(C);x=-2*this._xCut;for(const C of this._linesOut)if(C&&C.length>=this._minPts){for(const B of C)B[0]+=
x;v.push(C)}this._closed?A.rings=v:A.paths=v;return A}moveTo(A){this._pushLineIn();this._pushLineOut();this._prevSide=this._side(A[0]);this._moveTo(A[0],A[1],this._prevSide);this._firstPt=this._prevPt=A}lineTo(A){const v=this._side(A[0]);if(-1===v*this._prevSide){const x=this._intersect(this._prevPt,A);this._lineTo(this._xCut,x,0);this._prevSide=0}this._lineTo(A[0],A[1],v);this._prevSide=v;this._prevPt=A}close(){const A=this._firstPt,v=this._prevPt;A[0]===v[0]&&A[1]===v[1]||this.lineTo(A);this._checkClosingPt(this._lineIn);
this._checkClosingPt(this._lineOut)}_moveTo(A,v,x){this._closed?(this._lineIn.push([0>=x?A:this._xCut,v]),this._lineOut.push([0<=x?A:this._xCut,v])):(0>=x&&this._lineIn.push([A,v]),0<=x&&this._lineOut.push([A,v]))}_lineTo(A,v,x){this._closed?(w(this._lineIn,0>=x?A:this._xCut,v),w(this._lineOut,0<=x?A:this._xCut,v)):0>x?(0===this._prevSide&&this._pushLineOut(),this._lineIn.push([A,v])):0<x?(0===this._prevSide&&this._pushLineIn(),this._lineOut.push([A,v])):0>this._prevSide?(this._lineIn.push([A,v]),
this._lineOut.push([A,v])):0<this._prevSide&&(this._lineOut.push([A,v]),this._lineIn.push([A,v]))}_checkClosingPt(A){const v=A.length;3<v&&A[0][0]===this._xCut&&A[v-2][0]===this._xCut&&A[1][0]===this._xCut&&(A[0][1]=A[v-2][1],A.pop())}_side(A){return A<this._xCut?-1:A>this._xCut?1:0}_intersect(A,v){return A[1]+(this._xCut-A[0])/(v[0]-A[0])*(v[1]-A[1])}_pushLineIn(){this._lineIn&&this._lineIn.length>=this._minPts&&this._linesIn.push(this._lineIn);this._lineIn=[]}_pushLineOut(){this._lineOut&&this._lineOut.length>=
this._minPts&&this._linesOut.push(this._lineOut);this._lineOut=[]}}l.CutVertical=y;l.normalizeCentralMeridianForDisplay=function(A){return a(A,!1)};l.normalizeCentralMeridianSync=function(A){return a(A,!0)};Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/graphics/GraphicUpdateMessage":function(){define(["exports"],function(l){class q{constructor(n,d,m){this.added=n;this.updated=d;this.removed=m}hasAnyUpdate(){return!!(this.added.length||this.updated.length||this.removed.length)}}
l.GraphicUpdateMessage=q;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/support/FeatureCommandQueue":function(){define(["../../../../core/promiseUtils","./UpdateTracking2D","../../../support/QueueProcessor"],function(l,q,n){class d{constructor(m){this.updateTracking=new q.UpdateTracking2D({debugName:"FeatureCommandQueue"});this._queueProcessor=new n.QueueProcessor({concurrency:1,process:m.process})}destroy(){this.updateTracking.destroy();this._queueProcessor.destroy();
this.clear()}clear(){this._queueProcessor.clear()}async push(m){return l.ignoreAbortErrors(this.updateTracking.addPromise(this._doPush(m)))}async _doPush(m){const h=this._queueProcessor,g=h.last();switch(m.type){case "update":case "highlight":if(g?.type===m.type)break;return h.push(m);case "edit-by-id":case "edit-by-feature":return h.push(m)}}}return d})},"esri/views/2d/layers/support/UpdateTracking2D":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/has ../../../../core/ReactiveMap ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/Logger ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ../../../../core/support/UpdatingHandles".split(" "),
function(l,q,n,d,m,h,g,c,a,b,k){l.UpdateTracking2D=class extends n{constructor(e){super(e);this.debugName="";this._updatingHandles=new k.UpdatingHandles;this._idToUpdatingState=new m}get updating(){const e=this._updatingHandles.updating||Array.from(this._idToUpdatingState.values()).some(r=>r);if(d("esri-2d-log-updating")){const r=Array.from(this._idToUpdatingState.entries()).map(([f,p])=>`-> ${f}: ${p}`).join("\n");console.log(`${this.debugName}: Updating: ${e}\n-> Handles: ${this._updatingHandles.updating}\n${r}`)}return e}addUpdateTracking(e,
r){const f=h.watch(()=>r.updating,p=>this._idToUpdatingState.set(e,p),{sync:!0});this.addHandles(f)}addPromise(e){return this._updatingHandles.addPromise(e)}};q.__decorate([g.property({constructOnly:!0})],l.UpdateTracking2D.prototype,"debugName",void 0);q.__decorate([g.property({readOnly:!0})],l.UpdateTracking2D.prototype,"updating",null);l.UpdateTracking2D=q.__decorate([b.subclass("esri.views.2d.layers.support.UpdateTracking2D")],l.UpdateTracking2D);Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},
"esri/views/2d/layers/graphics/GraphicContainer":function(){define(["../../engine/webgl/enums","./AGraphicContainer","../support/util"],function(l,q,n){class d extends q.AGraphicContainer{renderChildren(m){for(const h of this.children)h.setTransform(m.state);super.renderChildren(m);this._updateAttributeView();if(this.children.some(h=>h.hasData)){switch(m.drawPhase){case l.WGLDrawPhase.MAP:this._renderChildren(m,l.FeatureSelection.All);break;case l.WGLDrawPhase.HIGHLIGHT:this.hasHighlight&&this._renderHighlight(m)}this._boundsRenderer&&
this._boundsRenderer.doRender(m)}}_renderHighlight(m){n.renderHighlight(m,!1,h=>{this._renderChildren(h,l.FeatureSelection.Highlight)})}}return d})},"esri/views/2d/layers/graphics/AGraphicContainer":function(){define("exports ../../../../core/maybe ../../engine/AFeatureContainer ../../engine/webgl/enums ../../engine/webgl/shaderGraph/techniques/GraphicInstanceStore ./GraphicBoundsRenderer".split(" "),function(l,q,n,d,m,h){class g extends n.AFeatureContainer{constructor(c){super(c);this._instanceStore=
new m.GraphicInstanceStore;this.checkHighlight=()=>!0}destroy(){super.destroy();this._boundsRenderer=q.destroyMaybe(this._boundsRenderer)}get instanceStore(){return this._instanceStore}enableRenderingBounds(c){this._boundsRenderer=new h(c);this.requestRender()}get hasHighlight(){return this.checkHighlight()}onTileData(c,a){c.onMessage(a);this.contains(c)||this.addChild(c);this.requestRender()}_renderChildren(c,a){c.selection=a;for(const b of this.children)b.visible&&b.getDisplayList(this._instanceStore,
d.FeatureBatchingStrategy.STRICT_ORDER)?.render(c)}}l.AGraphicContainer=g;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/AFeatureContainer":function(){define(["exports","./webgl/AttributeStoreView","./webgl/definitions","./webgl/TileContainer"],function(l,q,n,d){class m extends d{constructor(h){super(h);this._statisticsByLevel=new Map;this._entityIndex=new Map;this.attributeView=new q.AttributeStoreView}destroy(){this.children.forEach(h=>h.destroy());this.removeAllChildren();
this.attributeView.destroy()}doRender(h){h.context.capabilities.enable("textureFloatLinear");super.doRender(h)}get hasAnimations(){for(const h of this.children)if(h.hasAnimations)return!0;return!1}_reindexAndUpdateFeaturesIfNeeded(){if(this.hasAnimations&&(this._reindexFeatures(),0!==this.attributeView.size))for(const h of this._entityIndex.values())h.dirty&&(this.attributeView.setData(h.displayId,n.AttributeDataType.LocalTimeOrigin,0,h.firstIndexed),h.dirty=!1)}restartAnimation(h){if(h=this._entityIndex.get(h)){var g=
performance.now()/1E3;h.firstIndexed=g;h.dirty=!0}}restartAllAnimations(){const h=performance.now()/1E3;for(const [,g]of this._entityIndex)g.firstIndexed=h,g.dirty=!0}_reindexFeatures(){const h=performance.now()/1E3;for(const g of this.children)for(const c of g.entityIds){const {objectId:a}=c;let b=this._entityIndex.get(a);b||(b={objectId:a,displayId:0,firstIndexed:h,lastIndexed:0,dirty:!0},this._entityIndex.set(a,b));b.lastIndexed=h;b.displayId=c.displayId}for(const [g,c]of this._entityIndex)60<
h-c.lastIndexed&&this._entityIndex.delete(g)}_updateAttributeView(){this.attributeView.update();this._reindexAndUpdateFeaturesIfNeeded()}createRenderParams(h){h=super.createRenderParams(h);h.attributeView=this.attributeView;h.instanceStore=this._instanceStore;h.statisticsByLevel=this._statisticsByLevel;return h}}l.AFeatureContainer=m;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/AttributeStoreView":function(){define("exports ../../../../core/Error ../../../../core/has ../../../../core/Logger ./definitions ./DisplayId ./Utils ../../../webgl/enums ../../../webgl/FramebufferObject ../../../webgl/Texture ../../../webgl/TextureDescriptor".split(" "),
function(l,q,n,d,m,h,g,c,a,b,k){class e{constructor(f,p,t){this._lastTexture=this._texture=null;this._fbos={};this.texelSize=4;const {buffer:w,pixelType:z,textureOnly:u}=f;f=g.getPixelArrayCtor(z);this.blockIndex=t;this.pixelType=z;this.size=p;this.textureOnly=u;u||(this.data=new f(w));this._resetRange()}destroy(){this._texture?.dispose();for(const f in this._fbos){const p=this._fbos[f];p&&("0"===f&&p.detachColorTexture(),p.dispose());this._fbos[f]=null}this._texture=null}get _textureDesc(){const f=
new k.TextureDescriptor;f.wrapMode=c.TextureWrapMode.CLAMP_TO_EDGE;f.samplingMode=c.TextureSamplingMode.NEAREST;f.dataType=this.pixelType;f.width=this.size;f.height=this.size;return f}setData(f,p,t){f=h.getDisplayIdTexel(f);const w=this.data;p=f*this.texelSize+p;!w||p>=w.length||(w[p]=t,this.dirtyStart=Math.min(this.dirtyStart,f),this.dirtyEnd=Math.max(this.dirtyEnd,f))}getData(f,p){if(null==this.data)return null;f=h.getDisplayIdTexel(f)*this.texelSize+p;return!this.data||f>=this.data.length?null:
this.data[f]}getTexture(f){return this._texture??this._initTexture(f)}getFBO(f,p=0){if(!this._fbos[p]){const t=0===p?this.getTexture(f):this._textureDesc;this._fbos[p]=new a.FramebufferObject(f,t)}return this._fbos[p]}get hasDirty(){return this.dirtyEnd>=this.dirtyStart}updateTexture(f,p){try{const B=this.dirtyStart,E=this.dirtyEnd;if(this.hasDirty){n("esri-2d-update-debug")&&console.debug(`Version[${p}] AttributeStoreView.updateTexture`,{start:B,end:E,firstBytes:new Uint8Array(this.data.buffer.slice(0,
16)),block:this});this._resetRange();var t=this.data.buffer,w=this.getTexture(f),z=(B-B%this.size)/this.size,u=(E-E%this.size)/this.size,y=z*this.size*4,A=4*(this.size+u*this.size)-y,v=g.getPixelArrayCtor(this.pixelType),x=new v(t,y*v.BYTES_PER_ELEMENT,A),C=this.size;f=u-z+1;f>this.size?d.getLogger("esri.views.2d.engine.webgl.AttributeStoreView").error(new q("mapview-webgl","Out-of-bounds index when updating AttributeData")):w.updateData(0,0,z,C,f,x)}}catch(B){}}update(f){const {data:p,start:t,end:w}=
f;if(null!=p&&null!=this.data){const z=this.data,u=t*this.texelSize;for(let y=0;y<p.length;y++)f.layout&1<<y%this.texelSize&&(z[u+y]=p[y])}this.dirtyStart=Math.min(this.dirtyStart,t);this.dirtyEnd=Math.max(this.dirtyEnd,w)}resize(f,p){const t=this.size;this.size=p;this.textureOnly?t!==this.size&&(this._lastTexture=this._texture,this._texture=null):(p=g.getPixelArrayCtor(this.pixelType),this.destroy(),this.data=new p(f.buffer))}_resetRange(){this.dirtyStart=2147483647;this.dirtyEnd=0}_initTexture(f){const p=
new b.Texture(f,this._textureDesc,this.data??void 0);if(null!=this._lastTexture&&this._fbos[0]){const z=this._lastTexture.descriptor.width,u=this._lastTexture.descriptor.height,y=this._lastTexture.descriptor.dataType,A=this._lastTexture.descriptor.pixelFormat,v=this.getFBO(f);var t=g.getPixelBytes(y),w=g.getPixelArrayCtor(y);t=new ArrayBuffer(z*u*t*this.texelSize);w=new w(t);t=f.getBoundFramebufferObject();const {x,y:C,width:B,height:E}=f.getViewport();f.bindFramebuffer(v);v.readPixels(0,0,z,u,A,
y,w);p.updateData(0,0,0,2*z,u/2,w);f.setViewport(x,C,B,E);f.bindFramebuffer(t)}this.destroy();return this._texture=p}}class r{constructor(){this.size=0;this._pendingAttributeUpdates=[];this._epoch=this._version=0;this._locked=!1}_initialize(f){if(!f)throw Error("InternalError: initArgs must be defined");const p=f.blockDescriptors;this.size=f.blockSize;n("esri-2d-update-debug")&&console.debug("AttributeStoreView.initialize",{message:f});if(null==this._data)this._data=p.map((t,w)=>null!=t?new e(t,this.size,
w):null);else for(f=0;f<this._data.length;f++){const t=this._data[f],w=p[f];null!=w&&(null==t?this._data[f]=new e(w,this.size,f):t.resize(w,this.size))}}destroy(){for(const f of this._data??[])f?.destroy();this._defaultTexture?.dispose();this._defaultTexture=null;this._pendingAttributeUpdates=[]}isEmpty(){return null==this._data}getBlock(f){return null==this._data?null:this._data[f]}setLabelMinZoom(f,p){this.setData(f,m.AttributeDataType.FilterFlags,1,p)}setLocalTimeOrigin(f,p){this.setData(f,m.AttributeDataType.LocalTimeOrigin,
0,p)}getLabelMinZoom(f){return this.getData(f,m.AttributeDataType.FilterFlags,1,255)}getFilterFlags(f){return this.getData(f,m.AttributeDataType.FilterFlags,0,0)}getVisualVariableData(f,p){return this.getData(f,m.AttributeDataType.VV,p,0)}getData(f,p,t,w){if(!this._data)return 0;p=this._data[p];if(null==p)return 0;f=p.getData(f,t);return null!=f?f:w}setData(f,p,t,w){this._data[p].setData(f,t,w)}lockTextureUploads(){this._locked=!0}unlockTextureUploads(){this._locked=!1;this.update()}requestUpdate(f){this._version=
f.version;this._pendingAttributeUpdates.push(f);n("esri-2d-update-debug")&&console.debug(`Version[${this._version}] AttributeStoreView.requestUpdate`,{message:f})}get currentEpoch(){return this._epoch}update(){if(!this._locked){var f=this._pendingAttributeUpdates;this._pendingAttributeUpdates=[];for(const p of f){const {blockData:t,initArgs:w,sendUpdateEpoch:z,version:u}=p;n("esri-2d-update-debug")&&console.debug(`Version[${this._version}] Epoch[${z}] AttributeStoreView.applyUpdate`);this._version=
u;this._epoch=z;null!=w&&this._initialize(w);f=this._data;for(let y=0;y<t.length;y++){const A=t[y],v=f[y];null!=v&&null!=A&&(n("esri-2d-update-debug")&&console.debug(`Version[${this._version}] CpuBlock[${y}] AttributeStoreView.update`,{block:A}),v.update(A))}}}}getUniforms(f){return{filterFlags:{texture:this._getTexture(f,m.AttributeDataType.FilterFlags),unit:m.filterFlagsUnit},animation:{texture:this._getTexture(f,m.AttributeDataType.Animation),unit:m.animationUnit},gpgpu:{texture:this._getTexture(f,
m.AttributeDataType.GPGPU),unit:m.gpgpuUnit},localTimeOrigin:{texture:this._getTexture(f,m.AttributeDataType.LocalTimeOrigin),unit:m.localTimeOriginUnit},visualVariableData:{texture:this._getTexture(f,m.AttributeDataType.VV),unit:m.visualVariableUnit},dataDriven0:{texture:this._getTexture(f,m.AttributeDataType.DD0),unit:m.dataDrivenUnit0},dataDriven1:{texture:this._getTexture(f,m.AttributeDataType.DD1),unit:m.dataDrivenUnit1},dataDriven2:{texture:this._getTexture(f,m.AttributeDataType.DD2),unit:m.dataDrivenUnit2},
size:this.size}}_getTexture(f,p){p=this._data?.[p];if(!p)return this._getDefaultTexture(f);p.updateTexture(f,this._version);return p.getTexture(f)}_getDefaultTexture(f){if(null==this._defaultTexture){const p=new k.TextureDescriptor;p.wrapMode=c.TextureWrapMode.CLAMP_TO_EDGE;p.samplingMode=c.TextureSamplingMode.NEAREST;p.width=1;p.height=1;this._defaultTexture=new b.Texture(f,p,new Uint8Array(4))}return this._defaultTexture}}l.AttributeStoreView=r;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},
"esri/views/2d/engine/webgl/TileContainer":function(){define(["../../../../core/has","./enums","./WGLContainer","./brushes/WGLBrushStencil","./brushes/WGLBrushTileDebugInfo"],function(l,q,n,d,m){const h=(c,a)=>0!==c.key.level-a.key.level?c.key.level-a.key.level:0!==c.key.row-a.key.row?c.key.row-a.key.row:c.key.col-a.key.col;class g extends n{constructor(c){super();this.tileInfoView=c;this.sortFunction=h}renderChildren(c){this.setStencilReference(c);super.renderChildren(c)}createRenderParams(c){const {state:a}=
c;c=super.createRenderParams(c);c.requiredLevel=this.tileInfoView.getClosestInfoForScale(a.scale).level;c.displayLevel=this.tileInfoView.tileInfo.scaleToZoom(a.scale);return c}prepareRenderPasses(c){const a=super.prepareRenderPasses(c);a.push(c.registerRenderPass({name:"stencil",brushes:[d],drawPhase:q.WGLDrawPhase.DEBUG|q.WGLDrawPhase.MAP|q.WGLDrawPhase.HIGHLIGHT|q.WGLDrawPhase.LABEL,target:()=>this.getStencilTarget()}));l("esri-tiles-debug")&&a.push(c.registerRenderPass({name:"tileInfo",brushes:[m],
drawPhase:q.WGLDrawPhase.DEBUG,target:()=>this.children}));return a}getStencilTarget(){return this.children}setStencilReference(c){c=1;for(const a of this.children)a.stencilRef=c++}}return g})},"esri/views/2d/engine/webgl/WGLContainer":function(){define(["../../../../core/has","../brushes","../Container","./ClippingInfo","./enums"],function(l,q,n,d,m){class h extends n.Container{set clips(g){super.clips=g;this._updateClippingInfo(g)}renderChildren(g){g.painter.setPipelineState(null);null==this._renderPasses&&
(this._renderPasses=this.prepareRenderPasses(g.painter));for(const c of this._renderPasses)try{c.render(g)}catch(a){}}prepareRenderPasses(g){return[g.registerRenderPass({name:"clip",brushes:[q.brushes.clip],target:()=>this._clippingInfos,drawPhase:m.WGLDrawPhase.MAP|m.WGLDrawPhase.LABEL|m.WGLDrawPhase.LABEL_ALPHA|m.WGLDrawPhase.DEBUG|m.WGLDrawPhase.HIGHLIGHT})]}_updateClippingInfo(g){null!=this._clippingInfos&&(this._clippingInfos.forEach(c=>c.destroy()),this._clippingInfos=null);null!=g&&g.length&&
(this._clippingInfos=g.items.map(c=>d.fromClipArea(this.stage,c)));this.requestRender()}}return h})},"esri/views/2d/engine/webgl/ClippingInfo":function(){define("../../../../core/Error ../../../../core/Logger ../../../../core/reactiveUtils ../../../../core/libs/gl-matrix-2/factories/mat3f32 ../DisplayObject ./Mesh2D ../../support/clippingUtils ../../../webgl/VertexArrayObject".split(" "),function(l,q,n,d,m,h,g,c){class a extends m.DisplayObject{constructor(b,k){super();this._clip=k;this._cache={};
this.stage=b;this._handle=n.watch(()=>k.version,()=>this._invalidate());this.ready()}static fromClipArea(b,k){return new a(b,k)}_destroyGL(){null!=this._cache.mesh&&(this._cache.mesh.destroy(),this._cache.mesh=null);null!=this._cache.vao&&(this._cache.vao.dispose(),this._cache.vao=null)}destroy(){this._destroyGL();this._handle.remove()}getVAO(b,k,e,r){const [f,p]=k.size;if("geometry"===this._clip.type||this._lastWidth!==f||this._lastHeight!==p)this._lastWidth=f,this._lastHeight=p,this._destroyGL();
if(null==this._cache.vao){k=this._createMesh(k,this._clip);const t=k.getIndexBuffer(b),w=k.getVertexBuffers(b);this._cache.mesh=k;this._cache.vao=new c.VertexArrayObject(b,e,r,w,t)}return this._cache.vao}_createTransforms(){return{displayViewScreenMat3:d.create()}}_invalidate(){this._destroyGL();this.requestRender()}_createMesh(b,k){switch(k.type){case "rect":return h.fromScreenExtent(g.createScreenExtent(k,b.size[0],b.size[1]));case "path":return h.fromPath(k);case "geometry":return h.fromGeometry(b,
k);default:return q.getLogger("esri.views.2d.engine.webgl.ClippingInfo").error(new l("mapview-bad-type","Unable to create ClippingInfo mesh from clip of type: ${clip.type}")),h.fromScreenExtent({xmin:0,ymin:0,xmax:1,ymax:1})}}}return a})},"esri/views/2d/engine/webgl/Mesh2D":function(){define("../../../../core/Error ../../../../core/Logger ../../../../chunks/earcut ../../../../core/libs/gl-matrix-2/math/vec2 ../../../../core/libs/gl-matrix-2/factories/vec2f64 ../../../../layers/graphics/featureConversionUtils ../../../../layers/graphics/OptimizedGeometry ./number ../../../webgl/BufferObject ../../../webgl/enums".split(" "),
function(l,q,n,d,m,h,g,c,a,b){const k=({coords:r,lengths:f},p)=>{const t=[];for(let u=0,y=0;u<f.length;y+=f[u],u+=1){const A=y;for(var w=[];u<f.length-1;u+=1,y+=f[u]){var z=y+f[u];let v=0;for(let x=1;x<f[u+1];x++)v+=(r[2*(z+x)]-r[2*(z+x-1)])*(r[2*(z+x)+1]+r[2*(z+x-1)+1]);if(!(p?0<v:0>v))break;w.push(y+f[u]-A)}z=r.slice(2*A,2*(y+f[u]));w=n.earcut(z,w,2);for(const v of w)t.push(v+A)}return t};class e{constructor(r,f,p,t=!1){this._cache={};this.vertices=r;this.indices=f;this.primitiveType=p;this.isMapSpace=
t}static fromPath(r){var f=h.convertFromNestedArray(new g,r.path,!1,!1);r=f.coords;f=new Uint32Array(k(f,!0));const p=new Uint32Array(r.length/2);for(let t=0;t<p.length;t++)p[t]=c.i1616to32(Math.floor(r[2*t]),Math.floor(r[2*t+1]));return new e({geometry:p},f,b.PrimitiveType.TRIANGLES)}static fromGeometry(r,f){const p=f.geometry?.type;switch(p){case "polygon":return e.fromPolygon(r,f.geometry);case "extent":return e.fromMapExtent(r,f.geometry);default:return q.getLogger("esri.views.2d.engine.webgl.Mesh2D").error(new l("mapview-bad-type",
`Unable to create a mesh from type ${p}`,f)),e.fromScreenExtent({xmin:0,ymin:0,xmax:1,ymax:1})}}static fromPolygon(r,f){var p=h.convertFromPolygon(new g,f,!1,!1);f=p.coords;p=new Uint32Array(k(p,!1));const t=new Uint32Array(f.length/2),w=m.create(),z=m.create();for(let u=0;u<t.length;u++)d.set(w,f[2*u],f[2*u+1]),r.toScreen(z,w),t[u]=c.i1616to32(Math.floor(z[0]),Math.floor(z[1]));return new e({geometry:t},p,b.PrimitiveType.TRIANGLES,!0)}static fromScreenExtent({xmin:r,xmax:f,ymin:p,ymax:t}){r={geometry:new Uint32Array([c.i1616to32(r,
p),c.i1616to32(f,p),c.i1616to32(r,t),c.i1616to32(r,t),c.i1616to32(f,p),c.i1616to32(f,t)])};f=new Uint32Array([0,1,2,3,4,5]);return new e(r,f,b.PrimitiveType.TRIANGLES)}static fromMapExtent(r,f){const [p,t]=r.toScreen([0,0],[f.xmin,f.ymin]),[w,z]=r.toScreen([0,0],[f.xmax,f.ymax]);r={geometry:new Uint32Array([c.i1616to32(p,t),c.i1616to32(w,t),c.i1616to32(p,z),c.i1616to32(p,z),c.i1616to32(w,t),c.i1616to32(w,z)])};f=new Uint32Array([0,1,2,3,4,5]);return new e(r,f,b.PrimitiveType.TRIANGLES)}destroy(){null!=
this._cache.indexBuffer&&this._cache.indexBuffer.dispose();this._cache.vertexBuffers?.forEach(r=>r?.dispose());this._cache.indexBuffer=this._cache.vertexBuffers=null}get elementType(){a:switch(this.indices.BYTES_PER_ELEMENT){case 1:var r=b.DataType.UNSIGNED_BYTE;break a;case 2:r=b.DataType.UNSIGNED_SHORT;break a;case 4:r=b.DataType.UNSIGNED_INT;break a;default:throw new l("Cannot get DataType of array");}return r}getIndexBuffer(r,f=b.Usage.STATIC_DRAW){let p;(p=this._cache).indexBuffer??(p.indexBuffer=
a.BufferObject.createIndex(r,f,this.indices));return this._cache.indexBuffer}getVertexBuffers(r,f=b.Usage.STATIC_DRAW){let p;(p=this._cache).vertexBuffers??(p.vertexBuffers=new Map(Object.keys(this.vertices).reduce((t,w)=>{t.push([w,a.BufferObject.createVertex(r,f,this.vertices[w])]);return t},[])));return this._cache.vertexBuffers}}return e})},"esri/views/2d/engine/webgl/shaderGraph/techniques/GraphicInstanceStore":function(){define(["exports","./TechniqueInstance","./TechniqueRegistry","./mesh/instanceIdUtils"],
function(l,q,n,d){function m(a,b){return new q.FeatureTechniqueInstance(d.castInstanceId(h++),a,b)}let h=0;const g={visualVariableColor:null,visualVariableOpacity:null,visualVariableSizeMinMaxValue:null,visualVariableSizeScaleStops:null,visualVariableSizeStops:null,visualVariableSizeUnitValue:null,visualVariableRotation:null,visualVariableSizeOutlineScaleStops:null};class c{constructor(){this.instances={fill:m(n.Techniques.fill,{uniforms:g,optionalAttributes:{zoomRange:!0}}),marker:m(n.Techniques.marker,
{uniforms:g,optionalAttributes:{zoomRange:!0}}),line:m(n.Techniques.line,{uniforms:g,optionalAttributes:{zoomRange:!0}}),text:m(n.Techniques.text,{uniforms:g,optionalAttributes:{zoomRange:!0,referenceSymbol:!1,clipAngle:!1}}),complexFill:m(n.Techniques.complexFill,{uniforms:g,optionalAttributes:{zoomRange:!0}}),texturedLine:m(n.Techniques.texturedLine,{uniforms:g,optionalAttributes:{zoomRange:!0}}),animatedMarker:m(n.Techniques.animatedMarker,{uniforms:g,optionalAttributes:{zoomRange:!0}})};this._instancesById=
Object.values(this.instances).reduce((a,b)=>{a.set(b.instanceId,b);return a},new Map)}getInstance(a){return this._instancesById.get(a)}}l.GraphicInstanceStore=c;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/TechniqueInstance":function(){define(["exports","./mesh/instanceIdUtils"],function(l,q){class n{constructor(d,m,h){this._instanceId=d;this.techniqueRef=m;this._input=h}get instanceId(){return q.castStrictInstanceId(this._instanceId)}createMeshInfo(d){return{id:q.castStrictInstanceId(this._instanceId),
techniqueType:this.techniqueRef.type,inputParams:d,optionalAttributes:this._input.optionalAttributes}}getInput(){return this._input}setInput(d){this._input=d}}l.FeatureTechniqueInstance=n;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/mesh/instanceIdUtils":function(){define(["exports"],function(l){l.castInstanceId=function(q){return q};l.castStrictInstanceId=function(q){return q};Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},
"esri/views/2d/layers/graphics/GraphicBoundsRenderer":function(){define("../../../../core/maybe ../../../../core/libs/gl-matrix-2/math/mat3 ../../../../core/libs/gl-matrix-2/factories/mat3f32 ../../../../core/libs/gl-matrix-2/factories/vec2f32 ../../../../core/libs/gl-matrix-2/factories/vec3f32 ../../../../geometry/support/normalizeUtils ../../engine/DisplayObject ../../engine/webgl/Utils ../../../webgl/BufferObject ../../../webgl/enums ../../../webgl/VertexArrayObject".split(" "),function(l,q,n,
d,m,h,g,c,a,b,k){const e=Math.PI/180;class r extends g.DisplayObject{constructor(p){super();this._indexBuffer=this._vertexBuffer=this._vao=this._program=null;this._dvsMat3=n.create();this._localOrigin={x:0,y:0};this._getBounds=p}destroy(){this._vao&&(this._vao.dispose(),this._indexBuffer=this._vertexBuffer=this._vao=null);this._program=l.disposeMaybe(this._program)}doRender(p){const {context:t}=p,w=this._getBounds();1>w.length||(this._createShaderProgram(t),this._updateMatricesAndLocalOrigin(p),this._updateBufferData(t,
w),t.setBlendingEnabled(!0),t.setDepthTestEnabled(!1),t.setStencilWriteMask(0),t.setStencilTestEnabled(!1),t.setBlendFunction(b.BlendFactor.ONE,b.BlendFactor.ONE_MINUS_SRC_ALPHA),t.setColorMask(!0,!0,!0,!0),p=this._program,t.bindVAO(this._vao),t.useProgram(p),p.setUniformMatrix3fv("u_dvsMat3",this._dvsMat3),t.gl.lineWidth(1),t.drawElements(b.PrimitiveType.LINES,8*w.length,b.DataType.UNSIGNED_INT,0),t.bindVAO())}_createTransforms(){return{displayViewScreenMat3:n.create()}}_createShaderProgram(p){this._program||
(this._program=p.programCache.acquire("precision highp float;\n        uniform mat3 u_dvsMat3;\n\n        attribute vec2 a_position;\n\n        void main() {\n          mediump vec3 pos \x3d u_dvsMat3 * vec3(a_position, 1.0);\n          gl_Position \x3d vec4(pos.xy, 0.0, 1.0);\n        }","precision mediump float;\n      void main() {\n        gl_FragColor \x3d vec4(0.75, 0.0, 0.0, 0.75);\n      }",f().attributes))}_updateMatricesAndLocalOrigin(p){var {state:t}=p;const {displayMat3:w,size:z,resolution:u,
pixelRatio:y,rotation:A,viewpoint:v}=t;p=e*A;const {x,y:C}=v.targetGeometry;t=h.normalizeMapX(x,t.spatialReference);this._localOrigin.x=t;this._localOrigin.y=C;t=y*z[0];const B=y*z[1],E=u*t,D=u*B,F=q.identity(this._dvsMat3);q.multiply(F,F,w);q.translate(F,F,d.fromValues(t/2,B/2));q.scale(F,F,m.fromValues(z[0]/E,-B/D,1));q.rotate(F,F,-p)}_updateBufferData(p,t){const {x:w,y:z}=this._localOrigin,u=new Float32Array(8*t.length),y=new Uint32Array(8*t.length);let A=0,v=0;for(const x of t)x&&(u[2*A]=x[0]-
w,u[2*A+1]=x[1]-z,u[2*A+2]=x[0]-w,u[2*A+3]=x[3]-z,u[2*A+4]=x[2]-w,u[2*A+5]=x[3]-z,u[2*A+6]=x[2]-w,u[2*A+7]=x[1]-z,y[v]=A+0,y[v+1]=A+3,y[v+2]=A+3,y[v+3]=A+2,y[v+4]=A+2,y[v+5]=A+1,y[v+6]=A+1,y[v+7]=A+0,A+=4,v+=8);this._vertexBuffer?this._vertexBuffer.setData(u.buffer):this._vertexBuffer=a.BufferObject.createVertex(p,b.Usage.DYNAMIC_DRAW,u.buffer);this._indexBuffer?this._indexBuffer.setData(y):this._indexBuffer=a.BufferObject.createIndex(p,b.Usage.DYNAMIC_DRAW,y);this._vao||(t=f(),this._vao=new k.VertexArrayObject(p,
t.attributes,t.bufferLayouts,new Map([["geometry",this._vertexBuffer]]),this._indexBuffer))}}const f=()=>c.createProgramDescriptor("bounds",{geometry:[{location:0,name:"a_position",count:2,type:b.DataType.FLOAT}]});return r})},"esri/views/2d/navigation/MapViewNavigation":function(){define("../../../chunks/tslib.es6 ../../../Viewpoint ../../../core/Accessor ../../../core/maybe ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ../../../geometry/Point ../viewpointUtils ./duration ./ZoomBox ./actions/Pan ./actions/Pinch ./actions/Rotate".split(" "),
function(l,q,n,d,m,h,g,c,a,b,k,e,r,f,p,t){const w=new q({targetGeometry:new b}),z=[0,0];q=class extends n{constructor(u){super(u);this.animationManager=this._lastEventTimestamp=this._endTimer=null;this.interacting=!1}initialize(){this.pan=new f({navigation:this});this.rotate=new t({navigation:this});this.pinch=new p({navigation:this});this.zoomBox=new r({view:this.view,navigation:this})}destroy(){this.pan=d.destroyMaybe(this.pan);this.rotate=d.destroyMaybe(this.rotate);this.pinch=d.destroyMaybe(this.pinch);
this.zoomBox=d.destroyMaybe(this.zoomBox);this.animationManager=null}begin(){this.stop();this._set("interacting",!0)}end(){this._lastEventTimestamp=performance.now();this._startTimer(250)}async zoom(u,y=this._getDefaultAnchor()){this.begin();if(this.view.constraints.snapToZoom&&this.view.constraints.effectiveLODs)return 1>u?this.zoomIn(y):this.zoomOut(y);this.setViewpoint(y,u,0,[0,0])}async zoomIn(u){var y=this.view;y=y.constraints.snapToNextScale(y.scale);return this._zoomToScale(y,u)}async zoomOut(u){var y=
this.view;y=y.constraints.snapToPreviousScale(y.scale);return this._zoomToScale(y,u)}setViewpoint(u,y,A,v){this.begin();this.view.stateManager.state.viewpoint=this._scaleRotateTranslateViewpoint(this.view.viewpoint,u,y,A,v);this.end()}setViewpointImmediate(u,y=0,A=[0,0],v=this._getDefaultAnchor()){this.view.stateManager.state.viewpoint=this._scaleRotateTranslateViewpoint(this.view.viewpoint,v,u,y,A)}continuousRotateClockwise(){const u=this.view.viewpoint;this.animationManager?.animateContinuous(u,
y=>{k.rotateBy(y,y,-1)})}continuousRotateCounterclockwise(){const u=this.view.viewpoint;this.animationManager?.animateContinuous(u,y=>{k.rotateBy(y,y,1)})}resetRotation(){this.view.constraints.rotationEnabled&&(this.view.rotation=0)}continuousPanLeft(){this._continuousPan([-10,0])}continuousPanRight(){this._continuousPan([10,0])}continuousPanUp(){this._continuousPan([0,10])}continuousPanDown(){this._continuousPan([0,-10])}continuousPanVector({x:u,y}){this._continuousPan([10*u,10*y])}stop(){this.pan.stopMomentumNavigation();
this.animationManager?.stop();this.end();null!==this._endTimer&&(clearTimeout(this._endTimer),this._endTimer=null,this._set("interacting",!1))}_continuousPan(u){const y=this.view.viewpoint;this.animationManager?.animateContinuous(y,A=>{k.translateBy(A,A,u);this.view.constraints.constrainByGeometry(A)})}_startTimer(u){return null!==this._endTimer?this._endTimer:this._endTimer=setTimeout(()=>{this._endTimer=null;const y=performance.now()-(this._lastEventTimestamp??0);250>y?this._endTimer=this._startTimer(y):
this._set("interacting",!1)},u)}_getDefaultAnchor(){const {size:u,padding:{left:y,right:A,top:v,bottom:x}}=this.view;z[0]=.5*(u[0]-A+y);z[1]=.5*(u[1]-x+v);return z}async _zoomToScale(u,y=this._getDefaultAnchor()){const {view:A}=this,{constraints:v,scale:x,viewpoint:C,size:B,padding:E}=A,D=v.canZoomInTo(u),F=v.canZoomOutTo(u);if(!(u<x&&!D||u>x&&!F))return k.padAndScaleAndRotateBy(w,C,u/x,0,y,B,E),v.constrainByGeometry(w),A.goTo(w,{animate:!0,animationMode:"always",duration:e.getGoToDuration(),pickClosestTarget:!1})}_scaleRotateTranslateViewpoint(u,
y,A,v,x){var {view:C}=this;const {size:B,padding:E,constraints:D,scale:F,viewpoint:G}=C;var H=F*A;C=D.canZoomInTo(H);H=D.canZoomOutTo(H);if(1>A&&!C||1<A&&!H)A=1;k.translateBy(G,G,x);k.padAndScaleAndRotateBy(u,G,A,v,y,B,E);return D.constrainByGeometry(u)}};l.__decorate([m.property()],q.prototype,"animationManager",void 0);l.__decorate([m.property({type:Boolean,readOnly:!0})],q.prototype,"interacting",void 0);l.__decorate([m.property()],q.prototype,"pan",void 0);l.__decorate([m.property()],q.prototype,
"pinch",void 0);l.__decorate([m.property()],q.prototype,"rotate",void 0);l.__decorate([m.property()],q.prototype,"view",void 0);l.__decorate([m.property()],q.prototype,"zoomBox",void 0);return q=l.__decorate([a.subclass("esri.views.2d.navigation.MapViewNavigation")],q)})},"esri/views/2d/navigation/ZoomBox":function(){define("../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/screenUtils ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ./duration ../../input/InputManager".split(" "),
function(l,q,n,d,m,h,g,c,a,b){q=class extends q{constructor(k){super(k);this._boxShape=this._backgroundShape=this._overlay=this._container=null;this._box={x:0,y:0,width:0,height:0};this._rafId=null;this._redraw=this._redraw.bind(this)}destroy(){this.view=null}set view(k){this.removeAllHandles();this._destroyOverlay();this._set("view",k);k&&this.addHandles([k.on("drag",["Shift"],e=>this._handleDrag(e,1),b.ViewEventPriorities.INTERNAL),k.on("drag",["Shift","Control"],e=>this._handleDrag(e,-1),b.ViewEventPriorities.INTERNAL)])}_start(){this._createContainer();
this._createOverlay();this.navigation.begin()}_update(k,e,r,f){this._box.x=k;this._box.y=e;this._box.width=r;this._box.height=f;this._rafId||(this._rafId=requestAnimationFrame(this._redraw))}_end(k,e,r,f,p){const t=this.view;k=t.toMap(n.createScreenPoint(k+.5*r,e+.5*f));r=Math.max(r/t.width,f/t.height);-1===p&&(r=1/r);this._destroyOverlay();this.navigation.end();t.goTo({center:k,scale:t.scale*r},{animationMode:"always",duration:a.getGoToDuration()})}_updateBox(k,e,r,f){const p=this._boxShape;p.setAttributeNS(null,
"x",""+k);p.setAttributeNS(null,"y",""+e);p.setAttributeNS(null,"width",""+r);p.setAttributeNS(null,"height",""+f);p.setAttributeNS(null,"class","esri-zoom-box__outline")}_updateBackground(k,e,r,f){this._backgroundShape.setAttributeNS(null,"d",this._toSVGPath(k,e,r,f,this.view.width,this.view.height))}_createContainer(){const k=document.createElement("div");k.className="esri-zoom-box__container";this.view.root.appendChild(k);this._container=k}_createOverlay(){var k=this.view.width,e=this.view.height;
const r=document.createElementNS("http://www.w3.org/2000/svg","path");r.setAttributeNS(null,"d","M 0 0 L "+k+" 0 L "+k+" "+e+" L 0 "+e+" Z");r.setAttributeNS(null,"class","esri-zoom-box__overlay-background");k=document.createElementNS("http://www.w3.org/2000/svg","rect");e=document.createElementNS("http://www.w3.org/2000/svg","svg");e.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xlink","http://www.w3.org/1999/xlink");e.setAttributeNS(null,"class","esri-zoom-box__overlay");e.appendChild(r);
e.appendChild(k);this._container.appendChild(e);this._backgroundShape=r;this._boxShape=k;this._overlay=e}_destroyOverlay(){this._container&&this._container.parentNode&&this._container.parentNode.removeChild(this._container);this._container=this._backgroundShape=this._boxShape=this._overlay=null}_toSVGPath(k,e,r,f,p,t){r=k+r;f=e+f;return"M 0 0 L "+p+" 0 L "+p+" "+t+" L 0 "+t+" ZM "+k+" "+e+" L "+k+" "+f+" L "+r+" "+f+" L "+r+" "+e+" Z"}_handleDrag(k,e){var r=k.x,f=k.y,p=k.origin.x;const t=k.origin.y;
let w;r>p?(w=p,p=r-p):(w=r,p-=r);f>t?(r=t,f-=t):(r=f,f=t-f);switch(k.action){case "start":this._start();break;case "update":this._update(w,r,p,f);break;case "end":this._end(w,r,p,f,e)}k.stopPropagation()}_redraw(){if(this._rafId&&(this._rafId=null,this._overlay)){var {x:k,y:e,width:r,height:f}=this._box;this._updateBox(k,e,r,f);this._updateBackground(k,e,r,f);this._rafId=requestAnimationFrame(this._redraw)}}};l.__decorate([d.property()],q.prototype,"navigation",void 0);l.__decorate([d.property()],
q.prototype,"view",null);return q=l.__decorate([c.subclass("esri.views.2d.navigation.ZoomBox")],q)})},"esri/views/2d/navigation/actions/Pan":function(){define("../../../../chunks/tslib.es6 ../../../../geometry ../../../../Viewpoint ../../../../core/Accessor ../../../../core/reactiveUtils ../../../../core/screenUtils ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/Logger ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../viewpointUtils ../../../navigation/PanPlanarMomentumEstimator ../../../../geometry/Point".split(" "),
function(l,q,n,d,m,h,g,c,a,b,k,e,r,f,p,t){q=class extends d{constructor(w){super(w);this.animationTime=0;this.momentumEstimator=new p.PanPlanarMomentumEstimator(500,6,.92);this.momentum=null;this.tmpMomentum=r.create();this.momentumFinished=!1;this.viewpoint=new n({targetGeometry:new t,scale:0,rotation:0});this._previousDrag=null;m.when(()=>this.momentumFinished,()=>this.navigation.stop())}begin(w,z){this.navigation.begin();this.momentumEstimator.reset();this.addToEstimator(z);this._previousDrag=
z}update(w,z){this.addToEstimator(z);let u=z.center.x,y=z.center.y;const A=this._previousDrag;u=A?A.center.x-u:-u;y=A?y-A.center.y:y;w.viewpoint=f.translateBy(this.viewpoint,w.viewpoint,[u||0,y||0]);this._previousDrag=z}end(w,z){this.addToEstimator(z);this.momentum=w.navigation.effectiveMomentumEnabled?this.momentumEstimator.evaluateMomentum():null;this.animationTime=0;if(this.momentum)this.onAnimationUpdate(w);this._previousDrag=null;this.navigation.end()}addToEstimator(w){var z=w.center.x;const u=
w.center.y,y=h.createScreenPointArray(-z,u);z=r.fromValues(-z,u,0);this.momentumEstimator.add(y,z,.001*w.timestamp)}onAnimationUpdate(w){this.navigation.animationManager?.animateContinuous(w.viewpoint,(z,u)=>{const {momentum:y,animationTime:A,tmpMomentum:v}=this;var x=this.momentumFinished=!y||y.isFinished(A);u*=.001;x||(x=y.valueDelta(A,u),e.scale(v,y.direction,x),f.translateBy(z,z,v),w.constraints.constrainByGeometry(z));this.animationTime+=u})}stopMomentumNavigation(){this.momentum&&(this.momentumEstimator.reset(),
this.momentum=null,this.navigation.stop())}};l.__decorate([g.property()],q.prototype,"momentumFinished",void 0);l.__decorate([g.property()],q.prototype,"viewpoint",void 0);l.__decorate([g.property()],q.prototype,"navigation",void 0);return q=l.__decorate([k.subclass("esri.views.2d.navigation.actions.Pan")],q)})},"esri/views/navigation/PanPlanarMomentumEstimator":function(){define(["exports","../../chunks/vec32","../../core/libs/gl-matrix-2/factories/vec3f64","./FilteredFiniteDifference","./Momentum"],
function(l,q,n,d,m){class h extends m.Momentum{constructor(c,a,b,k,e){super(c,a,b);this._sceneVelocity=k;this.direction=e}value(c){return super.valueFromInitialVelocity(this._sceneVelocity,c)}}class g{constructor(c=300,a=12,b=.84){this._minimumInitialVelocity=c;this._stopVelocity=a;this._friction=b;this.enabled=!0;this._time=new d.FilteredFiniteDifference(.6);this._screen=[new d.FilteredFiniteDifference(.4),new d.FilteredFiniteDifference(.4)];this._scene=[new d.FilteredFiniteDifference(.6),new d.FilteredFiniteDifference(.6),
new d.FilteredFiniteDifference(.6)];this._tmpDirection=n.create()}add(c,a,b){!this.enabled||this._time.hasLastValue()&&.015>this._time.computeDelta(b)||(this._screen[0].update(c[0]),this._screen[1].update(c[1]),this._scene[0].update(a[0]),this._scene[1].update(a[1]),this._scene[2].update(a[2]),this._time.update(b))}reset(){this._screen[0].reset();this._screen[1].reset();this._scene[0].reset();this._scene[1].reset();this._scene[2].reset();this._time.reset()}evaluateMomentum(){if(!this.enabled||!this._screen[0].hasFilteredDelta()||
!this._time.hasFilteredDelta())return null;var c=this._screen[0].filteredDelta,a=this._screen[1].filteredDelta;c=null==c||null==a?0:Math.sqrt(c*c+a*a);a=this._time.filteredDelta;c=null==a||null==c?0:c/a;return Math.abs(c)<this._minimumInitialVelocity?null:this.createMomentum(c,this._stopVelocity,this._friction)}createMomentum(c,a,b){q.set(this._tmpDirection,this._scene[0].filteredDelta??0,this._scene[1].filteredDelta??0,this._scene[2].filteredDelta??0);const k=q.length(this._tmpDirection);0<k&&q.scale(this._tmpDirection,
this._tmpDirection,1/k);const e=this._time.filteredDelta;return new h(c,a,b,null==e?0:k/e,this._tmpDirection)}}l.PanPlanarMomentum=h;l.PanPlanarMomentumEstimator=g;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/navigation/FilteredFiniteDifference":function(){define(["exports"],function(l){class q{constructor(n){this._gain=n;this.filteredDelta=this.lastValue=void 0}update(n){if(this.hasLastValue()){const d=this.computeDelta(n);this._updateDelta(d)}this.lastValue=n}reset(){this.filteredDelta=
this.lastValue=void 0}hasLastValue(){return void 0!==this.lastValue}hasFilteredDelta(){return void 0!==this.filteredDelta}computeDelta(n){return void 0===this.lastValue?NaN:n-this.lastValue}_updateDelta(n){this.filteredDelta=void 0!==this.filteredDelta?(1-this._gain)*this.filteredDelta+this._gain*n:n}}l.FilteredFiniteDifference=q;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/navigation/Momentum":function(){define(["exports"],function(l){class q{constructor(n,d,m){this._initialVelocity=
n;this._stopVelocity=d;this._friction=m;this._duration=Math.abs(Math.log(Math.abs(this._initialVelocity)/this._stopVelocity)/Math.log(1-this._friction))}get duration(){return this._duration}isFinished(n){return n>this.duration}get friction(){return this._friction}value(n){return this.valueFromInitialVelocity(this._initialVelocity,n)}valueDelta(n,d){const m=this.value(n);return this.value(n+d)-m}valueFromInitialVelocity(n,d){d=Math.min(d,this.duration);const m=1-this.friction;return n*(m**d-1)/Math.log(m)}}
l.Momentum=q;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/navigation/actions/Pinch":function(){define("../../../../chunks/tslib.es6 ../../../../Viewpoint ../../../../core/Accessor ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/Logger ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ../../../../core/libs/gl-matrix-2/math/vec2 ../../../../core/libs/gl-matrix-2/factories/vec2f64 ../../../../geometry/Point ../../viewpointUtils ../../../navigation/RotationMomentumEstimator ../../../navigation/ZoomMomentumEstimator".split(" "),
function(l,q,n,d,m,h,g,c,a,b,k,e,r,f,p){n=class extends n{constructor(t){super(t);this._animationTime=0;this._momentumFinished=!1;this._previousRadius=this._previousAngle=0;this._previousCenter=null;this._rotationMomentumEstimator=new f.RotationMomentumEstimator(.6,.15,.95);this._rotationDirection=1;this._startRadius=this._startAngle=0;this._updateTimestamp=null;this._zoomDirection=1;this._zoomMomentumEstimator=new p.ZoomMomentumEstimator;this._zoomOnly=null;this.viewpoint=new q({targetGeometry:new e,
scale:0,rotation:0});this.rotateMomentum=this.zoomMomentum=null;this.addHandles(d.when(()=>this._momentumFinished,()=>this.navigation.stop()))}begin(t,w){this.navigation.begin();this._rotationMomentumEstimator.reset();this._zoomMomentumEstimator.reset();this._zoomOnly=null;this._previousAngle=this._startAngle=w.angle;this._previousRadius=this._startRadius=w.radius;this._previousCenter=w.center;this._updateTimestamp=null;t.constraints.rotationEnabled&&this.addToRotateEstimator(0,w.timestamp);this.addToZoomEstimator(w,
1)}update(t,w){null===this._updateTimestamp&&(this._updateTimestamp=w.timestamp);const z=w.angle,u=w.radius,y=w.center,A=Math.abs(180*(z-this._startAngle)/Math.PI),v=Math.abs(u-this._startRadius),x=this._startRadius/u;if(this._previousRadius&&this._previousCenter){const C=u/this._previousRadius;let B=180*(z-this._previousAngle)/Math.PI;this._rotationDirection=0<=B?1:-1;this._zoomDirection=1<=C?1:-1;t.constraints.rotationEnabled?(null===this._zoomOnly&&200<w.timestamp-this._updateTimestamp&&(this._zoomOnly=
0<v-A),null===this._zoomOnly||this._zoomOnly?B=0:this.addToRotateEstimator(z-this._startAngle,w.timestamp)):B=0;this.addToZoomEstimator(w,x);this.navigation.setViewpoint([y.x,y.y],1/C,B,[this._previousCenter.x-y.x,y.y-this._previousCenter.y])}this._previousAngle=z;this._previousRadius=u;this._previousCenter=y}end(t){this.rotateMomentum=this._rotationMomentumEstimator.evaluateMomentum();this.zoomMomentum=this._zoomMomentumEstimator.evaluateMomentum();this._animationTime=0;if(this.rotateMomentum||this.zoomMomentum)this.onAnimationUpdate(t);
this.navigation.end()}addToRotateEstimator(t,w){this._rotationMomentumEstimator.add(t,.001*w)}addToZoomEstimator(t,w){this._zoomMomentumEstimator.add(w,.001*t.timestamp)}canZoomIn(t){const w=t.scale;t=t.constraints.effectiveMaxScale;return 0===t||w>t}canZoomOut(t){const w=t.scale;t=t.constraints.effectiveMinScale;return 0===t||w<t}onAnimationUpdate(t){this.navigation.animationManager?.animateContinuous(t.viewpoint,(w,z)=>{var u=!this.canZoomIn(t)&&1<this._zoomDirection||!this.canZoomOut(t)&&1>this._zoomDirection,
y=!this.rotateMomentum||this.rotateMomentum.isFinished(this._animationTime);u=u||!this.zoomMomentum||this.zoomMomentum.isFinished(this._animationTime);z*=.001;this._momentumFinished=y&&u;if(!this._momentumFinished){y=this.rotateMomentum?Math.abs(this.rotateMomentum.valueDelta(this._animationTime,z))*this._rotationDirection*180/Math.PI:0;u=this.zoomMomentum?Math.abs(this.zoomMomentum.valueDelta(this._animationTime,z)):1;const v=k.create();var A=k.create();if(this._previousCenter){b.set(v,this._previousCenter.x,
this._previousCenter.y);r.getPaddingScreenTranslation(A,t.size,t.padding);b.add(v,v,A);const {constraints:x,scale:C}=t;A=C*u;1>u&&!x.canZoomInTo(A)?(u=C/x.effectiveMaxScale,this.rotateMomentum=this.zoomMomentum=null):1<u&&!x.canZoomOutTo(A)&&(u=C/x.effectiveMinScale,this.rotateMomentum=this.zoomMomentum=null);r.scaleAndRotateBy(w,t.viewpoint,u,y,v,t.size);t.constraints.constrainByGeometry(w)}}this._animationTime+=z})}stopMomentumNavigation(){if(this.rotateMomentum||this.zoomMomentum)this.rotateMomentum&&
(this._rotationMomentumEstimator.reset(),this.rotateMomentum=null),this.zoomMomentum&&(this._zoomMomentumEstimator.reset(),this.zoomMomentum=null),this.navigation.stop()}};l.__decorate([m.property()],n.prototype,"_momentumFinished",void 0);l.__decorate([m.property()],n.prototype,"viewpoint",void 0);l.__decorate([m.property()],n.prototype,"navigation",void 0);return n=l.__decorate([a.subclass("esri.views.2d.navigation.actions.Pinch")],n)})},"esri/views/navigation/RotationMomentumEstimator":function(){define(["exports",
"./MomentumEstimator"],function(l,q){class n extends q.MomentumEstimator{constructor(d=3,m=.01,h=.95,g=12){super(d,m,h,g)}add(d,m){const h=this.value.lastValue;if(null!=h){for(d-=h;d>Math.PI;)d-=2*Math.PI;for(;d<-Math.PI;)d+=2*Math.PI;d=h+d}super.add(d,m)}}l.RotationMomentumEstimator=n;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/navigation/MomentumEstimator":function(){define(["exports","../../core/mathUtils","./FilteredFiniteDifference","./Momentum"],function(l,q,
n,d){class m{constructor(h=2.5,g=.01,c=.95,a=12){this._minimumInitialVelocity=h;this._stopVelocity=g;this._friction=c;this._maxVelocity=a;this.enabled=!0;this.value=new n.FilteredFiniteDifference(.8);this.time=new n.FilteredFiniteDifference(.3)}add(h,g){if(this.enabled&&null!=g){if(this.time.hasLastValue()){if(.01>this.time.computeDelta(g))return;if(this.value.hasFilteredDelta()){const c=this.value.computeDelta(h);0>this.value.filteredDelta*c&&this.value.reset()}}this.time.update(g);this.value.update(h)}}reset(){this.value.reset();
this.time.reset()}evaluateMomentum(){if(!this.enabled||!this.value.hasFilteredDelta()||!this.time.hasFilteredDelta())return null;let h=this.value.filteredDelta/this.time.filteredDelta;h=q.clamp(h,-this._maxVelocity,this._maxVelocity);return Math.abs(h)<this._minimumInitialVelocity?null:this.createMomentum(h,this._stopVelocity,this._friction)}createMomentum(h,g,c){return new d.Momentum(h,g,c)}}l.MomentumEstimator=m;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/navigation/ZoomMomentumEstimator":function(){define(["exports",
"./Momentum","./MomentumEstimator"],function(l,q,n){class d extends q.Momentum{constructor(h,g,c){super(h,g,c)}value(h){h=super.value(h);return Math.exp(h)}valueDelta(h,g){const c=super.value(h);h=super.value(h+g);return Math.exp(h-c)}}class m extends n.MomentumEstimator{constructor(h=2.5,g=.01,c=.95,a=12){super(h,g,c,a)}add(h,g){super.add(Math.log(h),g)}createMomentum(h,g,c){return new d(h,g,c)}}l.ZoomMomentum=d;l.ZoomMomentumEstimator=m;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},
"esri/views/2d/navigation/actions/Rotate":function(){define("../../../../chunks/tslib.es6 ../../../../geometry ../../../../Viewpoint ../../../../core/Accessor ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/Logger ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ../../../../core/libs/gl-matrix-2/math/vec2 ../../../../core/libs/gl-matrix-2/factories/vec2f64 ../../viewpointUtils ../../../../geometry/Point".split(" "),function(l,
q,n,d,m,h,g,c,a,b,k,e,r){const f=k.create(),p=k.create();q=class extends d{constructor(t){super(t);this._previousCenter=k.create();this.viewpoint=new n({targetGeometry:new r,scale:0,rotation:0})}begin(t,w){this.navigation.begin();b.set(this._previousCenter,w.center.x,w.center.y)}update(t,w){const {state:{size:z,padding:u}}=t;b.set(f,w.center.x,w.center.y);e.getAnchor(p,z,u);t.viewpoint=e.rotateBy(this.viewpoint,t.state.paddedViewState.viewpoint,e.angleBetween(p,this._previousCenter,f));b.copy(this._previousCenter,
f)}end(){this.navigation.end()}};l.__decorate([m.property()],q.prototype,"viewpoint",void 0);l.__decorate([m.property()],q.prototype,"navigation",void 0);return q=l.__decorate([a.subclass("esri.views.2d.navigation.actions.Rotate")],q)})},"esri/views/2d/magnifier/MagnifierView2D":function(){define("../../../request ../../../core/asyncUtils ../../../core/Handles ../../../core/maybe ../../../core/reactiveUtils ../../../core/libs/gl-matrix-2/factories/mat3f32 ../../../core/support/UpdatingHandles ../engine/DisplayObject ../engine/webgl/enums ../engine/webgl/shaderGraph/techniques/magnifier/MagnifierTechnique ../../magnifier/resources".split(" "),
function(l,q,n,d,m,h,g,c,a,b,k){class e extends c.DisplayObject{constructor(){super();this._handles=new n;this._magnifierTechnique=new b.MagnifierTechnique;this.updatingHandles=new g.UpdatingHandles;this.visible=!1}destroy(){this._handles=d.destroyMaybe(this._handles);this._magnifierTechnique.shutdown();this._resourcesTask=d.abortMaybe(this._resourcesTask)}get backgroundColor(){return this._backgroundColor}set backgroundColor(r){this._backgroundColor=r;this.requestRender()}get magnifier(){return this._magnifier}set magnifier(r){this._magnifier=
r;this._handles.removeAll();this._handles.add([m.watch(()=>r.version,()=>{this.visible=r.visible&&null!=r.position&&0<r.size;this.requestRender()},m.initial),m.watch(()=>[r.maskUrl,r.overlayUrl],()=>this._reloadResources()),m.watch(()=>r.size,()=>{this._magnifierTechnique.shutdown();this.requestRender()})])}_createTransforms(){return{displayViewScreenMat3:h.create()}}doRender(r){if(!this._resourcesTask)this._reloadResources();else if(r.drawPhase===a.WGLDrawPhase.MAP&&this._canRender()){var f=this._magnifier;
if(null!=f.position){this._magnifierTechnique.updateResources(r,this._mask,this._overlay,f);var p=this.backgroundColor;this._magnifierTechnique.render(r,{background:p?[p.a*p.r/255,p.a*p.g/255,p.a*p.b/255,p.a]:[1,1,1,1],maskEnabled:f.maskEnabled?1:0,overlayEnabled:f.overlayEnabled?1:0})}}}_canRender(){return this._mask&&this._overlay&&null!=this._magnifier}_reloadResources(){this._resourcesTask&&this._resourcesTask.abort();const r=null!=this._magnifier?this._magnifier.maskUrl:null,f=null!=this._magnifier?
this._magnifier.overlayUrl:null;this._resourcesTask=q.createTask(async p=>{const t=null==r||null==f?k.loadMagnifierResources(p):null,w=null!=r?l(r,{responseType:"image",signal:p}).then(y=>y.data):t.then(y=>y.mask);p=null!=f?l(f,{responseType:"image",signal:p}).then(y=>y.data):t.then(y=>y.overlay);const [z,u]=await Promise.all([w,p]);this._mask=z;this._overlay=u;this._magnifierTechnique.shutdown();this.requestRender()});this.updatingHandles.addPromise(this._resourcesTask.promise)}}return e})},"esri/views/2d/engine/webgl/shaderGraph/techniques/magnifier/MagnifierTechnique":function(){define("exports ../../../../../../../core/mathUtils ../../../../../../../core/maybe ../../../../../../../core/urlUtils ../../utils ../Technique ../TechniqueType ../shaders/MagnifierShader ../../../../../../webgl/enums ../../../../../../webgl/Texture ../../../../../../webgl/TextureDescriptor".split(" "),
function(l,q,n,d,m,h,g,c,a,b,k){class e extends h.Technique{constructor(){super(...arguments);this.type=g.TechniqueType.Magnifier;this._resourcePixelRatio=1;this._position=[0,0,0,0];this.shaders={magnifier:new c.MagnifierShader}}updateResources(r,f,p,t){r.pixelRatio!==this._resourcePixelRatio&&this._destroyResources();this._readbackTexture||this._initializeResources(r,f,p,t);const {context:w,pixelRatio:z}=r,{factor:u,offset:y,position:A}=t;({size:p}=r.state);t=t.size*z;f=Math.ceil(1/u*t);this._readbackTexture.resize(f,
f);r=z*p[0];p=z*p[1];var v=.5*f,x=.5*f;const C=q.clamp(z*A.x,v,r-v-1),B=q.clamp(p-z*A.y,x,p-x-1);v=C-v;x=B-x;const E=this._readbackTexture;w.bindTexture(E,0);w.gl.copyTexImage2D(E.descriptor.target,0,E.descriptor.pixelFormat,v,x,f,f,0);f=y.y*z;this._position[0]=-1+(C+y.x*z)/r*2;this._position[1]=-1+(B-f)/p*2;this._position[2]=t/r*2;this._position[3]=t/p*2}render(r,f){const {context:p,painter:t}=r;t.setPipelineState(m.simplePipelineState);t.submitDrawMesh(p,{shader:this.shaders.magnifier,uniforms:{config:{readbackTexture:{texture:this._readbackTexture,
unit:0},maskTexture:{texture:this._maskTexture,unit:7},overlayTexture:{texture:this._overlayTexture,unit:6},drawPos:this._position,...f}},defines:null,optionalAttributes:null,useComputeBuffer:!1},t.quadMesh)}shutdown(){this._destroyResources()}_initializeResources(r,f,p,t){const w=r.context;this._resourcePixelRatio=r.pixelRatio;const z=Math.ceil(t.size*r.pixelRatio);p.width=z;p.height=z;const u=new k.TextureDescriptor;u.internalFormat=a.PixelFormat.RGBA;u.wrapMode=a.TextureWrapMode.CLAMP_TO_EDGE;
u.samplingMode=a.TextureSamplingMode.NEAREST;u.flipped=!0;u.preMultiplyAlpha=!d.isSVG(p.src)||!r.context.driverTest.svgPremultipliesAlpha.result;this._overlayTexture=new b.Texture(w,u,p);f.width=z;f.height=z;u.pixelFormat=u.internalFormat=a.PixelFormat.ALPHA;this._maskTexture=new b.Texture(w,u,f);r=1/t.factor;u.pixelFormat=u.internalFormat=a.PixelFormat.RGBA;u.width=u.height=Math.ceil(r*z);u.samplingMode=a.TextureSamplingMode.LINEAR;u.flipped=!1;this._readbackTexture=new b.Texture(w,u)}_destroyResources(){n.disposeMaybe(this._maskTexture);
n.disposeMaybe(this._overlayTexture);n.disposeMaybe(this._readbackTexture)}}l.MagnifierTechnique=e;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/MagnifierShader":function(){define(["exports","../../../../../../../chunks/tslib.es6","../../GraphShaderModule","../../graph/glsl","./constants"],function(l,q,n,d,m){function h(k){const e=k.multiply(new d.Vec2(2)).subtract(1);return d.ifElse(d.equal(e.x,new d.Float(0)).and(d.equal(e.y,
new d.Float(0))),new d.Vec2(.5),()=>{var r=d.atan(e.y,e.x);const f=d.pow(d.length(e),new d.Float(m.magnifierBarrelFactor));r=new d.Vec2(d.cos(r),d.sin(r));return f.multiply(r).multiply(new d.Vec2(.5)).add(new d.Float(.5))})}class g extends n.VertexInput{}q.__decorate([n.location(0,d.Vec2)],g.prototype,"position",void 0);class c extends n.FragmentInput{}class a extends n.UniformGroup{}q.__decorate([n.uniform(d.Sampler2D)],a.prototype,"readbackTexture",void 0);q.__decorate([n.uniform(d.Sampler2D)],
a.prototype,"maskTexture",void 0);q.__decorate([n.uniform(d.Sampler2D)],a.prototype,"overlayTexture",void 0);q.__decorate([n.uniform(d.Vec4)],a.prototype,"background",void 0);q.__decorate([n.uniform(d.Vec4)],a.prototype,"drawPos",void 0);q.__decorate([n.uniform(d.Float)],a.prototype,"maskEnabled",void 0);q.__decorate([n.uniform(d.Float)],a.prototype,"overlayEnabled",void 0);class b extends n.GraphShaderModule{vertex(k){const e=k.position;k=k.position.subtract(new d.Vec2(.5)).multiply(this.config.drawPos.zw);
k=this.config.drawPos.xy.add(k);return{glPosition:new d.Vec4(k,0,1),texCoord:e}}fragment(k){let e=d.texture2D(this.config.readbackTexture,h(k.texCoord));e=e.add((new d.Float(1)).subtract(e.a)).multiply(this.config.background);var r=d.ifElse(d.equal(this.config.maskEnabled,new d.Float(1)),d.texture2D(this.config.maskTexture,k.texCoord).a,new d.Float(1));e=e.multiply(r);k=d.ifElse(d.equal(this.config.overlayEnabled,new d.Float(1)),d.texture2D(this.config.overlayTexture,k.texCoord),new d.Vec4(0));r=
new n.FragmentOutput;r.glFragColor=k.add((new d.Float(1)).subtract(k.a).multiply(e));return r}}q.__decorate([n.uniform(a)],b.prototype,"config",void 0);q.__decorate([q.__param(0,n.input(g))],b.prototype,"vertex",null);q.__decorate([q.__param(0,n.input(c))],b.prototype,"fragment",null);l.MagnifierShader=b;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/magnifier/resources":function(){define(["require","exports","../../core/promiseUtils","../../support/requestImageUtils"],
function(l,q,n,d){const m=h=>Object.freeze(Object.defineProperty({__proto__:null,default:h},Symbol.toStringTag,{value:"Module"}));q.loadMagnifierResources=async function(h){var g=new Promise((a,b)=>l(["./mask-svg"],k=>a(m(k)),b)),c=new Promise((a,b)=>l(["./overlay-svg"],k=>a(m(k)),b));g=d.requestImage((await g).default,{signal:h});c=d.requestImage((await c).default,{signal:h});c={mask:await g,overlay:await c};n.throwIfAborted(h);return c};Object.defineProperty(q,Symbol.toStringTag,{value:"Module"})})},
"esri/support/requestImageUtils":function(){define(["exports","../request"],function(l,q){l.requestImage=async function(n,d){({data:n}=await q(n,{responseType:"image",...d}));return n};Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/grid/GridView2D":function(){define("../../../core/Handles ../../../core/mathUtils ../../../core/maybe ../../../core/reactiveUtils ../../../core/unitUtils ../../../core/libs/gl-matrix-2/math/mat3 ../../../core/libs/gl-matrix-2/factories/mat3f32 ../../../core/libs/gl-matrix-2/math/vec2 ../../../core/libs/gl-matrix-2/factories/vec2f32 ../../../core/libs/gl-matrix-2/factories/vec2f64 ../../../geometry/projection ../../../geometry/support/normalizeUtils ../../../geometry/support/scaleUtils ../../../geometry/support/spatialReferenceUtils ../engine/DisplayObject ../engine/webgl/enums ../engine/webgl/shaderGraph/techniques/grid/GridTechnique ./constants ./gridUtils".split(" "),
function(l,q,n,d,m,h,g,c,a,b,k,e,r,f,p,t,w,z,u){function y(x){const [C,B,E,D]=x.toArray().map(F=>F/255);return[C*D,B*D,E*D,D]}const A=b.create();class v extends p.DisplayObject{constructor(){super();this._handles=new l;this._metersPerSRUnit=this._projectedCenter=null;this._technique=new w.GridTechnique;this._grid=null;this.visible=!0}destroy(){this._handles=n.destroyMaybe(this._handles);this._technique.shutdown()}get grid(){return this._grid}set grid(x){this._grid=x;this._handles.removeAll();this._handles.add([d.watch(()=>
x?.center,()=>{this._projectedCenter=null},d.initial),d.watch(()=>[x?.center,x?.dynamicScaling,x?.majorLineColor,x?.majorLineInterval,x?.minorLineColor,x?.rotateWithMap,x?.rotation,x?.spacing,x?.units],()=>this.requestRender(),d.initial)])}_createTransforms(){return{displayViewScreenMat3:g.create()}}doRender(x){if(x.drawPhase===t.WGLDrawPhase.MAP&&null!=this.grid&&this.visible){var {spacing:C,units:B,majorLineInterval:E,dynamicScaling:D,majorLineColor:F,minorLineColor:G}=this.grid;if(0!==C&&(this._updateDerivedValues(x),
null!=this._projectedCenter&&null!=this._metersPerSRUnit)){var {scale:H,spatialReference:I}=x.state,K=m.convertUnit(C,B,"meters"),L=this._metersPerSRUnit*r.getResolutionForScale(H,I),R=K/L;!D&&R<z.minimumPixelsPerStrideForDisplayWhenScalingOff||(K*=u.getScaleFactor(E,R,D),this._updateTransform(x,L,K),this._technique.render(x,{transform:{dvs:this.transforms.displayViewScreenMat3},config:{pxPerCell:K/L,minorLineColor:y(G),majorLineColor:y(F),majorLineInterval:E,halfWidth:.25,aaWidth:.5}}))}}}_updateDerivedValues(x){if(this.grid){var {center:C}=
this.grid;({spatialReference:x}=x.state);this._projectedCenter&&f.equals(this._projectedCenter.spatialReference,x)||(this._metersPerSRUnit=null,f.equals(C.spatialReference,x)?this._projectedCenter=C:k.isLoadedOrLoadFor(C.spatialReference,x)?this._projectedCenter=k.project(C,x):this.requestRender());null==this._metersPerSRUnit&&null!=this._projectedCenter&&(this._metersPerSRUnit=u.measureMetersPerUnitAtReferencePoint(this._projectedCenter))}}_updateTransform(x,C,B){const {grid:E}=this,{center:D,rotation:F,
size:G,spatialReference:H}=x.state;if(null!=E&&null!=this._projectedCenter&&null!=this._metersPerSRUnit){x=G[0]/2*C;var I=G[1]/2*C,K=this._metersPerSRUnit/B,L=this._projectedCenter,R=q.deg2rad(E.rotation),S=q.deg2rad(F);C=this.transforms.displayViewScreenMat3;h.fromRotation(C,-R);var W=H.isWrappable?e.getClosestDenormalizedXToReference(L.x,D[0],H):L.x;L=c.set(A,W,L.y);L=c.sub(A,D,L);c.scale(L,L,K);E.rotateWithMap||c.rotate(L,L,a.ZEROS,-S);c.rotate(L,L,a.ZEROS,-R);c.scale(L,L,1/E.majorLineInterval);
L[0]-=Math.trunc(L[0]);L[1]-=Math.trunc(L[1]);c.scale(L,L,E.majorLineInterval);c.rotate(L,L,a.ZEROS,R);h.translate(C,C,L);E.rotateWithMap&&h.rotate(C,C,S);B=c.set(A,x/B,I/B);h.scaleByVec2(C,C,B)}}}return v})},"esri/geometry/support/scaleUtils":function(){define(["exports","../../core/mathUtils","../../core/unitUtils"],function(l,q,n){function d(m,h){h=n.getMetersPerUnitForSR(h);return m/(h*n.inchesPerMeter*96)}l.getExtentForScale=function(m,h){const g=m.extent;m=m.width-(m.padding?m.padding.left+
m.padding.right:0);h=d(h,g.spatialReference);return g.clone().expand(h*m/g.width)};l.getResolutionForScale=d;l.getResolutionInMetersForScale=function(m){return m/(96*n.inchesPerMeter)};l.getScale=function(m,h){h=h||m.extent;m=m.width;const g=n.getMetersPerUnitForSR(h?.spatialReference);return h&&m?h.width/m*g*n.inchesPerMeter*96:0};l.getScaleForResolution=function(m,h){h=n.getMetersPerUnitForSR(h);return m*h*n.inchesPerMeter*96};l.isInScaleRange=function(m,h,g){if(h=0===h||q.floatEqualAbsolute(m,
h)||m<h)h=0===g||q.floatEqualAbsolute(m,g)||m>g;return h};Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/grid/GridTechnique":function(){define(["exports","../../utils","../Technique","../TechniqueType","../shaders/GridShader"],function(l,q,n,d,m){class h extends n.Technique{constructor(){super(...arguments);this.type=d.TechniqueType.Grid;this.shaders={grid:new m.GridShader}}render(g,c){const {context:a,painter:b}=g;b.setPipelineState(q.simplePipelineState);
b.submitDrawMesh(a,{shader:this.shaders.grid,uniforms:c,defines:null,optionalAttributes:null,useComputeBuffer:!1},b.quadMesh)}}l.GridTechnique=h;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/GridShader":function(){define(["exports","../../../../../../../chunks/tslib.es6","../../GraphShaderModule","../../graph/glsl"],function(l,q,n,d){class m extends n.VertexInput{}q.__decorate([n.location(0,d.Vec2)],m.prototype,"position",
void 0);class h extends n.FragmentInput{}class g extends n.UniformGroup{}q.__decorate([n.uniform(d.Mat3)],g.prototype,"dvs",void 0);class c extends n.UniformGroup{}q.__decorate([n.uniform(d.Float)],c.prototype,"halfWidth",void 0);q.__decorate([n.uniform(d.Float)],c.prototype,"aaWidth",void 0);q.__decorate([n.uniform(d.Float)],c.prototype,"pxPerCell",void 0);q.__decorate([n.uniform(d.Vec4)],c.prototype,"minorLineColor",void 0);q.__decorate([n.uniform(d.Vec4)],c.prototype,"majorLineColor",void 0);q.__decorate([n.uniform(d.Int)],
c.prototype,"majorLineInterval",void 0);class a extends n.GraphShaderModule{vertex(b){var k=b.position.multiply(2).subtract(1);b=this.transform.dvs.multiply(new d.Vec3(k,1)).xy;k=new d.Vec4(k,0,1);return{gridPos:b,glPosition:k}}fragment(b){var k=d.abs(b.gridPos),e=d.fract(k);b=d.min(e.x,(new d.Float(1)).subtract(e.x));e=d.min(e.y,(new d.Float(1)).subtract(e.y));e=(new d.Vec2(b,e)).multiply(this.config.pxPerCell).subtract(this.config.halfWidth);b=d.min(e.x,e.y);b=(new d.Float(1)).subtract(d.smoothstep(new d.Float(0),
this.config.aaWidth,b));var r=new d.Int(d.round(k.x)),f=new d.Int(d.round(k.y));k=new d.Float(d.intMod(r,this.config.majorLineInterval));f=new d.Float(d.intMod(f,this.config.majorLineInterval));r=d.ifElse(d.lessThan(e.x,e.y),k,f);e=d.greaterThan(d.multiply(d.step(e.x,this.config.aaWidth),d.step(e.y,this.config.aaWidth)),new d.Float(.5));k=d.min(k,f);e=d.ifElse(e,k,r);e=d.mix(this.config.majorLineColor,this.config.minorLineColor,d.min(e,new d.Float(1)));k=new n.FragmentOutput;k.glFragColor=e.multiply(b);
return k}}q.__decorate([n.uniform(g)],a.prototype,"transform",void 0);q.__decorate([n.uniform(c)],a.prototype,"config",void 0);q.__decorate([q.__param(0,n.input(m))],a.prototype,"vertex",null);q.__decorate([q.__param(0,n.input(h))],a.prototype,"fragment",null);l.GridShader=a;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/grid/constants":function(){define(["exports"],function(l){l.minimumPixelsPerStrideForDisplayWhenScalingOff=5;l.pixelsPerCell=50;Object.defineProperty(l,
Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/grid/gridUtils":function(){define("exports ../../../geometry ../../../core/unitUtils ../../../geometry/support/geodesicUtils ../../../geometry/support/normalizeUtils ../../../geometry/support/spatialReferenceUtils ../../../geometry/support/webMercatorUtils ./constants ../../../geometry/SpatialReference ../../../geometry/Point ../../../geometry/Polyline".split(" "),function(l,q,n,d,m,h,g,c,a,b,k){function e(r){const {isGeographic:f,isWebMercator:p}=
r;return!f&&!p}l.getScaleFactor=function(r,f,p){r=1===r?10:r;return r**(p?Math.round(Math.log(c.pixelsPerCell/f)/Math.log(r)):0)};l.measureMetersPerUnitAtReferencePoint=function(r,f,p){var t="number"==typeof r?null:r;p=p??t?.spatialReference;if(null==p||!h.isValid(p)||e(p))return n.getMetersPerUnitForSR(p);r=t?.x??r;f=t?.y??f;var w=1/Math.sqrt(2);t=r+w;w=f+w;const {isWebMercator:z,isGeographic:u}=p;var y=u&&!d.isSupported(p)?a.WGS84:p;z&&(y=new b({x:r,y:f,spatialReference:p}),g.webMercatorToGeographic(y,
!0,y),r=y.x,f=y.y,y=new b({x:t,y:w,spatialReference:p}),g.webMercatorToGeographic(y,!0,y),t=y.x,w=y.y,y=a.WGS84);r=new k({paths:[[[r,f],[t,w]]],spatialReference:y});r=m.straightLineDensify(r,10);let A;try{[A]=d.geodesicLengths([r],"meters")}catch{return n.getMetersPerUnitForSR(p)}return A};l.shouldUsePlanar=e;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/geodesicUtils":function(){define("exports ../../geometry ../../core/Error ../../core/unitUtils ../../core/accessorSupport/ensureType ./geodesicConstants ./spatialReferenceUtils ../SpatialReference ../Polyline ../Polygon ../Point".split(" "),
function(l,q,n,d,m,h,g,c,a,b,k){function e(A){if(!A)return null;var v=A.wkid;if(v)return h.spheroids[v];(A=A.wkt2??A.wkt)?(A=h.wktSpheroidRegex.exec(A))&&2===A.length?(v=A[1].split(","),!v||3>v.length?A=null:(A=parseFloat(v[1]),v=parseFloat(v[2]),A=isNaN(A)||isNaN(v)?null:{a:A,f:0===v?0:1/v})):A=null:A=null;return A}function r(A){A=e(A);if(null!=A&&"b"in A&&"eSq"in A&&"radius"in A)return A;const v=A.a*(1-A.f);return Object.assign(A,{b:v,eSq:1-(v/A.a)**2,radius:(2*A.a+v)/3,densificationRatio:1E4/((2*
A.a+v)/3)})}function f(A){return null!=A&&0>A?A+360:A}function p(A,v,x){const {a:C,eSq:B}=r(x);x=Math.sqrt(B);const E=Math.sin(v[1]*h.toRadians);v=C*v[0]*h.toRadians;x=0<B?C*(1-B)*(E/(1-B*E*E)-1/(2*x)*Math.log((1-x*E)/(1+x*E)))*.5:C*E;A[0]=v;A[1]=x;return A}function t(A){return g.isGeographic(A)&&!!e(A)}function w(A,v){if("polyline"!==A.type&&"polygon"!==A.type)throw new n("geodesic-densify:invalid-geometry","the input geometry is neither polyline nor polygon");const {spatialReference:x}=A;if(!t(x))throw new n("geodesic-densify:invalid-spatial-reference",
"the input geometry spatial reference is not supported");var C="polyline"===A.type?A.paths:A.rings;const B=[],E=[0,0],D=new y;for(const H of C){C=[];B.push(C);C.push([H[0][0],H[0][1]]);var F=H[0][0],G=H[0][1];let I,K;for(let L=0;L<H.length-1;L++){I=H[L+1][0];K=H[L+1][1];if(F===I&&G===K)continue;const R=[F,G];u(D,[F,G],[I,K],x);const {azimuth:S,distance:W}=D;F=W/v;if(1<F){for(G=1;G<=F-1;G++)z(E,R,S,G*v,x),C.push(E.slice());z(E,R,S,(W+Math.floor(F-1)*v)/2,x);C.push(E.slice())}z(E,R,S,W,x);C.push(E.slice());
F=E[0];G=E[1]}}v=m.ensureClass(c,x);return"polyline"===A.type?new a({paths:B,spatialReference:v}):new b({rings:B,spatialReference:v})}function z(A,v,x,C,B){const E=v[0]*h.toRadians;v=v[1]*h.toRadians;x=(x??0)*h.toRadians;const {a:D,b:F,f:G}=r(B);B=Math.sin(x);x=Math.cos(x);var H=(1-G)*Math.tan(v);v=1/Math.sqrt(1+H*H);const I=H*v,K=Math.atan2(H,x);H=v*B;const L=H*H;var R=1-L,S=R*(D*D-F*F)/(F*F);const W=1+S/16384*(4096+S*(-768+S*(320-175*S))),J=S/1024*(256+S*(-128+S*(74-47*S)));S=C/(F*W);let O=2*Math.PI,
T,X,U,N;for(;1E-12<Math.abs(S-O);)U=Math.cos(2*K+S),T=Math.sin(S),X=Math.cos(S),N=J*T*(U+J/4*(X*(-1+2*U*U)-J/6*U*(-3+4*T*T)*(-3+4*U*U))),O=S,S=C/(F*W)+N;C=I*T-v*X*x;R=G/16*R*(4+G*(4-3*R));C=Math.atan2(I*X+v*T*x,(1-G)*Math.sqrt(L+C*C))/h.toRadians;A[0]=(E+(Math.atan2(T*B,v*X-I*T*x)-(1-R)*G*H*(S+R*T*(U+R*X*(-1+2*U*U)))))/h.toRadians;A[1]=C;return A}function u(A,v,x,C){var B=v[0]*h.toRadians;v=v[1]*h.toRadians;var E=x[0]*h.toRadians;x=x[1]*h.toRadians;const {a:D,b:F,f:G,radius:H}=r(C),I=E-B;var K=Math.atan((1-
G)*Math.tan(v)),L=Math.atan((1-G)*Math.tan(x));C=Math.sin(K);K=Math.cos(K);const R=Math.sin(L);L=Math.cos(L);let S=1E3,W=I,J,O,T;let X,U,N;do{var Q=Math.sin(W);var P=Math.cos(W);T=Math.sqrt(L*Q*L*Q+(K*R-C*L*P)*(K*R-C*L*P));if(0===T)return A.distance=0,A.azimuth=void 0,A.reverseAzimuth=void 0,A;P=C*R+K*L*P;X=Math.atan2(T,P);U=K*L*Q/T;O=1-U*U;Q=P-2*C*R/O;isNaN(Q)&&(Q=0);N=G/16*O*(4+G*(4-3*O));J=W;W=I+(1-N)*G*U*(X+N*T*(Q+N*P*(-1+2*Q*Q)))}while(1E-12<Math.abs(W-J)&&0<--S);if(0===S)return C=Math.acos(Math.sin(v)*
Math.sin(x)+Math.cos(v)*Math.cos(x)*Math.cos(E-B))*H,B=E-B,A.azimuth=Math.atan2(Math.sin(B)*Math.cos(x),Math.cos(v)*Math.sin(x)-Math.sin(v)*Math.cos(x)*Math.cos(B))/h.toRadians,A.distance=C,A.reverseAzimuth=void 0,A;B=O*(D*D-F*F)/(F*F);v=B/1024*(256+B*(-128+B*(74-47*B)));E=Math.atan2(K*Math.sin(W),K*R*Math.cos(W)-C*L);A.azimuth=Math.atan2(L*Math.sin(W),K*R-C*L*Math.cos(W))/h.toRadians;A.distance=F*(1+B/16384*(4096+B*(-768+B*(320-175*B))))*(X-v*T*(Q+v/4*(P*(-1+2*Q*Q)-v/6*Q*(-3+4*T*T)*(-3+4*Q*Q))));
A.reverseAzimuth=E/h.toRadians;return A}class y{constructor(A=0,v,x){this.distance=A;this.azimuth=v;this.reverseAzimuth=x}}l.InverseGeodeticSolverResult=y;l.directGeodeticSolver=z;l.geodesicAreas=function(A,v="square-meters"){if(A.some(E=>!t(E.spatialReference)))throw new n("geodesic-areas:invalid-spatial-reference","the input geometries spatial reference is not supported");const x=[];for(var C=0;C<A.length;C++){var B=A[C];const {radius:E,densificationRatio:D}=r(B.spatialReference);x.push(w(B,E*D))}A=
[];C=[0,0];B=[0,0];for(let E=0;E<x.length;E++){const {rings:D,spatialReference:F}=x[E];let G=0;for(let H=0;H<D.length;H++){const I=D[H];p(C,I[0],F);p(B,I[I.length-1],F);let K=B[0]*C[1]-C[0]*B[1];for(let L=0;L<I.length-1;L++)p(C,I[L+1],F),p(B,I[L],F),K+=B[0]*C[1]-C[0]*B[1];G+=K}G=d.convertUnit(G,"square-meters",v);A.push(G/-2)}return A};l.geodesicCompatibleSpatialReference=function(A){return t(A)?A:g.isWebMercator(A)?c.WGS84:null};l.geodesicDensify=w;l.geodesicDistance=function(A,v,x="meters"){if(!A||
!v)throw new n("geodesic-distance:missing-parameters","one or both input parameters are missing");if(!A.spatialReference||!v.spatialReference)throw new n("geodesic-distance:invalid-parameters","one or both input points do not have a spatial reference");if(!g.equals(A.spatialReference,v.spatialReference))throw new n("geodesic-distance:invalid-parameters","spatial references of input parameters do not match");const {spatialReference:C}=A;if(!t(C))throw new n("geodesic-distance:not-supported","input geometry spatial reference is not supported");
if(A.x===v.x&&A.y===v.y)return new y(0,0,0);const B=new y;u(B,[A.x,A.y],[v.x,v.y],C);B.distance=d.convertUnit(B.distance,"meters",x);B.azimuth=f(B.azimuth);B.reverseAzimuth=f(B.reverseAzimuth);return B};l.geodesicLengths=function(A,v="meters"){if(!A)throw new n("geodesic-lengths:invalid-geometries","the input geometries type is not supported");if(A.some(B=>!t(B.spatialReference)))throw new n("geodesic-lengths:invalid-spatial-reference","the input geometries spatial reference is not supported");const x=
[];for(let B=0;B<A.length;B++){var C=A[B];const {spatialReference:E}=C;C="polyline"===C.type?C.paths:C.rings;let D=0;for(let F=0;F<C.length;F++){const G=C[F];let H=0;for(let I=1;I<G.length;I++){const K=G[I-1][0],L=G[I][0],R=G[I-1][1],S=G[I][1];if(R!==S||K!==L){const W=new y;u(W,[K,R],[L,S],E);H+=W.distance}}D+=H}D=d.convertUnit(D,"meters",v);x.push(D)}return x};l.inverseGeodeticSolver=u;l.isSupported=t;l.pointFromDistance=function(A,v,x){if(!A||null==v||null==x)throw new n("point-from-distance:missing-parameters",
"one or more input parameters are missing or undefined");if(0>x||360<x)throw new n("point-from-distance:-of-bounds","azimuth is restricted to angles between, and including, 0\u00b0 to 360\u00b0 degrees");if(!A.spatialReference)throw new n("point-from-distance:missing-spatial-reference","the input point must have a spatial reference");const {spatialReference:C}=A;if(!t(C))throw new n("geodesic-distance:not-supported","input geometry spatial reference is not supported");const B=[0,0];z(B,[A.x,A.y],
x,v,C);return new k({x:B[0],y:B[1],spatialReference:C})};Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/core/libs/gl-matrix-2/mat4":function(){define(["exports","./math/mat4"],function(l,q){l.mat4=q.mat4;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/core/libs/gl-matrix-2/mat4f32":function(){define(["exports","./factories/mat4f32"],function(l,q){l.mat4f32=q.mat4f32;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/core/libs/gl-matrix-2/vec3f32":function(){define(["exports",
"./factories/vec3f32"],function(l,q){l.vec3f32=q.vec3f32;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/core/libs/gl-matrix-2/vec4f32":function(){define(["exports","./factories/vec4f32"],function(l,q){l.vec4f32=q.vec4f32;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/Bitmap":function(){define("exports ../../../core/promiseUtils ../../../core/libs/gl-matrix-2/math/mat3 ../../../core/libs/gl-matrix-2/factories/mat3f32 ../../../core/libs/gl-matrix-2/factories/vec2f32 ./DisplayObject ./ImageryBitmapSource ../../webgl/enums ../../webgl/Texture ../../webgl/TextureDescriptor".split(" "),
function(l,q,n,d,m,h,g,c,a,b){function k(f){return f&&"render"in f}function e(f){const p=document.createElement("canvas");p.width=f.width;p.height=f.height;f.render(p.getContext("2d"));return p}class r extends h.DisplayObject{constructor(f=null,p=!1){super();this.blendFunction="standard";this._sourceHeight=this._sourceWidth=0;this._textureInvalidated=!1;this._texture=null;this.stencilRef=0;this.coordScale=[1,1];this._height=void 0;this.pixelRatio=1;this.rotation=this.resolution=0;this._source=null;
this._width=void 0;this.y=this.x=0;this.immutable=p;this.source=f;this.requestRender=this.requestRender.bind(this)}destroy(){this._texture&&(this._texture.dispose(),this._texture=null);null!=this._uploadStatus&&(this._uploadStatus.controller.abort(),this._uploadStatus=null)}get isSourceScaled(){return this.width!==this._sourceWidth||this.height!==this._sourceHeight}get height(){return void 0!==this._height?this._height:this._sourceHeight}set height(f){this._height=f}get source(){return this._source}set source(f){if(null!=
f||null!=this._source)this._source=f,this.invalidateTexture(),this.requestRender()}get width(){return void 0!==this._width?this._width:this._sourceWidth}set width(f){this._width=f}beforeRender(f){super.beforeRender(f);this.updateTexture(f)}async setSourceAsync(f,p){null!=this._uploadStatus&&this._uploadStatus.controller.abort();const t=new AbortController,w=q.createResolver();q.onAbortOrThrow(p,()=>t.abort());q.onAbortOrThrow(t,z=>w.reject(z));this._uploadStatus={controller:t,resolver:w};this.source=
f;return w.promise}invalidateTexture(){this._textureInvalidated||(this._textureInvalidated=!0,this._source instanceof HTMLImageElement?(this._sourceHeight=this._source.naturalHeight,this._sourceWidth=this._source.naturalWidth):this._source&&(this._sourceHeight=this._source.height,this._sourceWidth=this._source.width))}transitionStep(f,p){64<=f&&(this.fadeTransitionEnabled=!1);super.transitionStep(f,p)}setTransform(f){const p=n.identity(this.transforms.displayViewScreenMat3),[t,w]=f.toScreenNoRotation([0,
0],[this.x,this.y]);var z=this.resolution/this.pixelRatio/f.resolution;const u=z*this.width;z*=this.height;const y=Math.PI*this.rotation/180;n.translate(p,p,m.fromValues(t,w));n.translate(p,p,m.fromValues(u/2,z/2));n.rotate(p,p,-y);n.translate(p,p,m.fromValues(-u/2,-z/2));n.scaleByVec2(p,p,m.fromValues(u,z));n.multiply(this.transforms.displayViewScreenMat3,f.displayViewMat3,p)}setSamplingProfile(f){this._texture&&(f.mips&&!this._texture.descriptor.hasMipmap&&this._texture.generateMipmap(),this._texture.setSamplingMode(f.samplingMode))}bind(f,
p){this._texture&&f.bindTexture(this._texture,p)}async updateTexture({context:f,painter:p}){if(this._textureInvalidated)if(this._textureInvalidated=!1,this._texture||(this._texture=this._createTexture(f)),this.source){this._texture.resize(this._sourceWidth,this._sourceHeight);f=this.source;f=k(f)?f instanceof g?f.getRenderedRasterPixels()?.renderedRasterPixels:e(f):f;try{if(null!=this._uploadStatus){const {controller:t,resolver:w}=this._uploadStatus,z={signal:t.signal},{width:u,height:y}=this;await p.textureUploadManager.enqueueTextureUpdate({data:f,
texture:this._texture,width:u,height:y},z);w.resolve();this._uploadStatus=null}else this._texture.setData(f);this.ready()}catch(t){q.throwIfNotAbortError(t)}}else this._texture.setData(null)}onDetach(){this.destroy()}_createTransforms(){return{displayViewScreenMat3:d.create()}}_createTexture(f){const p=this.immutable,t=new b.TextureDescriptor;t.internalFormat=p?c.SizedPixelFormat.RGBA8:c.PixelFormat.RGBA;t.wrapMode=c.TextureWrapMode.CLAMP_TO_EDGE;t.isImmutable=p;t.width=this._sourceWidth;t.height=
this._sourceHeight;return new a.Texture(f,t)}}l.Bitmap=r;l.isImageSource=k;l.rasterize=e;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/ImageryBitmapSource":function(){define(function(){class l{constructor(q,n,d){this.pixelBlock=q;this.extent=n;this.originalPixelBlock=d}get width(){return null!=this.pixelBlock?this.pixelBlock.width:0}get height(){return null!=this.pixelBlock?this.pixelBlock.height:0}render(q){var n=this.pixelBlock;if(null!=n){var d=this.filter({extent:this.extent,
pixelBlock:this.originalPixelBlock??n});null!=d.pixelBlock&&(d.pixelBlock.maskIsAlpha&&(d.pixelBlock.premultiplyAlpha=!0),n=d.pixelBlock.getAsRGBA(),d=q.createImageData(d.pixelBlock.width,d.pixelBlock.height),d.data.set(n),q.putImageData(d,0,0))}}getRenderedRasterPixels(){const q=this.filter({extent:this.extent,pixelBlock:this.pixelBlock});if(null==q.pixelBlock)return null;q.pixelBlock.maskIsAlpha&&(q.pixelBlock.premultiplyAlpha=!0);return{width:q.pixelBlock.width,height:q.pixelBlock.height,renderedRasterPixels:new Uint8Array(q.pixelBlock.getAsRGBA().buffer)}}}
return l})},"esri/views/2d/engine/BitmapContainer":function(){define(["exports","./brushes","./webgl/enums","./webgl/WGLContainer"],function(l,q,n,d){class m extends d{constructor(){super(...arguments);this._hasCrossfade=!1}get requiresDedicatedFBO(){return super.requiresDedicatedFBO||this._hasCrossfade}beforeRender(h){super.beforeRender(h);this._manageFade()}prepareRenderPasses(h){const g=h.registerRenderPass({name:"bitmap",brushes:[q.brushes.bitmap],target:()=>this.children,drawPhase:n.WGLDrawPhase.MAP});
return[...super.prepareRenderPasses(h),g]}_manageFade(){2<=this.children.reduce((h,g)=>h+(g.inFadeTransition?1:0),0)?(this.children.forEach(h=>h.blendFunction="additive"),this._hasCrossfade=!0):(this.children.forEach(h=>h.blendFunction="standard"),this._hasCrossfade=!1)}}l.BitmapContainer=m;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/BitmapTile":function(){define(["exports","../../../core/libs/gl-matrix-2/factories/mat3f32","./Bitmap","./webgl/TiledDisplayObject"],
function(l,q,n,d){class m extends d.TiledDisplayObject{constructor(h,g,c,a,b,k,e=null){super(h,g,c,a,b,k);this.bitmap=new n.Bitmap(e);this.bitmap.coordScale=[b,k];this.bitmap.once("isReady",()=>this.ready())}destroy(){super.destroy();this.bitmap.destroy()}beforeRender(h){this.bitmap.beforeRender(h);super.beforeRender(h)}afterRender(h){this.bitmap.afterRender(h);super.afterRender(h)}set stencilRef(h){this.bitmap.stencilRef=h}get stencilRef(){return this.bitmap.stencilRef}_createTransforms(){return{displayViewScreenMat3:q.create(),
tileMat3:q.create()}}setTransform(h){super.setTransform(h);this.bitmap.transforms.displayViewScreenMat3=this.transforms.displayViewScreenMat3}onAttach(){this.bitmap.stage=this.stage}onDetach(){this.bitmap&&(this.bitmap.stage=null)}}l.BitmapTile=m;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/BitmapTileContainer":function(){define("exports ../../../geometry/support/aaBoundingRect ./BitmapTile ./brushes ./webgl/enums ./webgl/TileContainer".split(" "),function(l,
q,n,d,m,h){class g extends h{get requiresDedicatedFBO(){return this.children.some(c=>"additive"===c.bitmap.blendFunction)}createTile(c){const a=this.tileInfoView.getTileBounds(q.create(),c),b=this.tileInfoView.getTileResolution(c.level),[k,e]=this.tileInfoView.tileInfo.size;return new n.BitmapTile(c,b,a[0],a[3],k,e)}prepareRenderPasses(c){const a=c.registerRenderPass({name:"bitmap (tile)",brushes:[d.brushes.bitmap],target:()=>this.children.map(b=>b.bitmap),drawPhase:m.WGLDrawPhase.MAP});return[...super.prepareRenderPasses(c),
a]}doRender(c){this.visible&&c.drawPhase===m.WGLDrawPhase.MAP&&super.doRender(c)}}l.BitmapTileContainer=g;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/color":function(){define(["exports","./number"],function(l,q){l.premultiplyAlpha=function(n,d=0,m=!1){const h=n[d+3];n[d]*=h;n[d+1]*=h;n[d+2]*=h;m||(n[d+3]*=255);return n};l.premultiplyAlphaRGBA=function(n){if(!n)return 0;const {r:d,g:m,b:h,a:g}=n;return q.i8888to32(d*g,m*g,h*g,255*g)};l.premultiplyAlphaRGBAArray=
function(n){if(!n)return 0;const [d,m,h,g]=n;return q.i8888to32(g/255*d,g/255*m,g/255*h,g)};l.writeColor=function(n,d,m=0){if(null==d)n[m]=0,n[m+1]=0,n[m+2]=0,n[m+3]=0;else{var {r:h,g,b:c,a}=d;n[m]=h*a/255;n[m+1]=g*a/255;n[m+2]=c*a/255;n[m+3]=a}};Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/util/Matcher":function(){define(["exports"],function(l){class q{constructor(){this._backgroundFillResult=this._defaultResult=null}static async from(n,d){const m=new q;
m.setDefault(await n.createMeshWriters(d.meshes));return m}size(){return 1}getDefault(){return this._defaultResult}setDefault(n){this._defaultResult=n}getBackgroundFill(){return this._backgroundFillResult}setBackgroundFill(n){this._backgroundFillResult=n}match(n,d){return(n=this.doMatch(n,d)||this.getDefault())&&0<n.length&&(d=this.getBackgroundFill())?[...d,...n]:n}getSortKey(n,d){return 0}doMatch(n,d){return null}async fetchResources(n,d){}}l.FeatureMatcher=q;Object.defineProperty(l,Symbol.toStringTag,
{value:"Module"})})},"*noref":1}});define("exports ./engine/Stage ./LabelManager ./layers/graphics/GraphicsView2D ./layers/graphics/GraphicContainer ./navigation/MapViewNavigation ./magnifier/MagnifierView2D ./grid/GridView2D".split(" "),function(l,q,n,d,m,h,g,c){l.Stage=q.Stage;Object.defineProperty(l,"LabelManager",{enumerable:!0,get:()=>n.LabelManager});l.GraphicsView2D=d;l.GraphicContainer=m;l.MapViewNavigation=h;l.MagnifierView2D=g;l.GridView2D=c;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})});