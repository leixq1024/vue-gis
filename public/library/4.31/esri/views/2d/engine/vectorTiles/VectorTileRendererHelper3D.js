// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.31/esri/copyright.txt for details.
//>>built
define("exports ../../../../core/libs/gl-matrix-2/math/mat3 ../../../../core/libs/gl-matrix-2/factories/mat3f64 ../../../../core/libs/gl-matrix-2/math/common ../../tiling/TileInfoView ../../tiling/TileKey ../../tiling/TileQueue ../../tiling/TileStrategy ./decluttering/jobsUtil ./style/StyleDefinition ../webgl/RenderableTile ../webgl/TileReshuffleManager ../../../webgl/enums".split(" "),function(w,r,x,z,H,A,I,J,B,C,D,E,p){class F{constructor(){this._renderParams={reshuffleManager:new E.TileReshuffleManager,
context:null,drawPhase:1,state:new G,stationary:!0,pixelRatio:1,displayLevel:-1,requiredLevel:-1,globalOpacity:1,renderPass:"background",styleLayer:null,styleLayerUID:-1,painter:null,glyphMosaic:null,spriteMosaic:null,profiler:null,renderingOptions:null,requestRender:null,allowDelayedRender:!1,deltaTime:-1,timeline:null,time:0,hasClipping:!1,blendMode:null,dataUploadCounter:0,effects:null,inFadeTransition:!1,requireFBO:!1,highlightGradient:null,stencilSymbols:!0,is3D:!0,backgroundColor:null};this._backgroundTile=
new D.RenderableTile(new A(0,0,0,0),0,0,0,512,512,4096,4096);this._heading=0;this._declutteredForHeading=new WeakMap}dispose(){this._renderParams=null}renderBackground(a,f,b,g,k,d,h,e,n,c){const l=this._backgroundTile;this._updateRenderParameters(a,f,l,b,k,d,h,e,n,c);this._renderParams.stencilSymbols=!1;b.drawBackground(this._renderParams,l,g)}renderContent(a,f,b,g,k,d,h,e,n,c,l,m){this._declutter(b);g.forAll(({sourceLayerInfo:{data:u}})=>this._declutter(u));const q=0<g.length;q&&this._stencilSymbols(a,
f,b,g,k,d,h,e,n,c,l,m);let t=1;b.stencilRef=q?t:0;a.setStencilFunction(p.CompareFunction.EQUAL,b.stencilRef,255);this._render(a,f,b,k,d,h,e,n,c,l,m);g.forAll(({sourceLod:u,offset:v,sourceLayerInfo:{data:y}})=>{y.stencilRef=++t;this._renderSymbols(a,u,y,k,d,h,e,v,c,l,m)})}_stencilSymbols(a,f,b,g,k,d,h,e,n,c,l,m){let q=1;b.stencilRef=q;a.setDepthTestEnabled(!1);a.setDepthWriteEnabled(!1);a.setStencilTestEnabled(!0);a.setBlendingEnabled(!1);a.setColorMask(!1,!1,!1,!1);a.setStencilOp(p.StencilOperation.KEEP,
p.StencilOperation.KEEP,p.StencilOperation.REPLACE);a.setStencilWriteMask(255);a.setStencilFunction(p.CompareFunction.ALWAYS,b.stencilRef,255);this._stencilTileSymbols(a,f,b,k,d,h,e,n,c,l,m);g.forAll(({sourceLod:t,offset:u,sourceLayerInfo:{data:v}})=>{v.stencilRef=++q;a.setStencilFunction(p.CompareFunction.ALWAYS,v.stencilRef,255);this._stencilTileSymbols(a,t,v,k,d,h,e,u,c,l,m)});a.setStencilWriteMask(0);a.setBlendingEnabled(!0);a.setDepthTestEnabled(!0);a.setColorMask(!0,!0,!0,!0)}_renderSymbols(a,
f,b,g,k,d,h,e,n,c,l){a.setStencilFunction(p.CompareFunction.EQUAL,b.stencilRef,255);this._render(a,f,b,g,k,d,h,e,n,c,l,C.StyleLayerType.SYMBOL)}_render(a,f,b,g,k,d,h,e,n,c,l,m){this._updateRenderParameters(a,f,b,g,d,h,e,n,c,l);this._renderParams.stencilSymbols=!1;g.drawTile(this._renderParams,b,k,m)}_stencilTileSymbols(a,f,b,g,k,d,h,e,n,c,l){this._updateRenderParameters(a,f,b,g,d,h,e,n,c,l);this._renderParams.stencilSymbols=!0;b.triangleCount=0;g.drawSymbols(this._renderParams,b,k)}_updateRenderParameters(a,
f,b,g,k,d,h,e,n,c){"type"in b&&"vector-tile"===b.type&&!b.stage&&b.attachWithContext(a);const l=f[0]-k.getLevelShift(f[0]),m=this._renderParams;m.context=a;m.painter=g;m.glyphMosaic=g.glyphMosaic;m.spriteMosaic=g.spriteMosaic;m.pixelRatio=n*c;m.displayLevel=l;m.requiredLevel=l;a=k.getScale(f[0]);const [q,t]=k.getOffset(f,d*a);f=.125*d*a/e;b=b.transforms.displayViewScreenMat3;b[0]=f;b[4]=-f;b[6]=-1-q-h[0]*d*2;b[7]=1+t+(1-h[1])*d*2-2;d=m.state;e/=c;d.size[0]=e;d.size[1]=e;d.pixelRatio=c;d.rotation=
(360-this._heading)%360;c=2/e;r.set(d.displayViewMat3,c,0,0,0,-c,0,-1,1,1);c=r.identity(d.displayMat3);h=z.toRadian(this._heading);r.translate(c,c,[e/2,e/2]);r.rotate(c,c,h);r.translate(c,c,[-e/2,-e/2]);r.multiply(c,d.displayViewMat3,c)}updateHeading(a){this._heading=a}_declutter(a){this._declutteredForHeading.get(a)!==this._heading&&(B.declutterSingleTile(a,(360-this._heading)%360),this._declutteredForHeading.set(a,this._heading))}}class G{constructor(){this.size=[0,0];this.pixelRatio=1;this.rotation=
0;this.displayMat3=x.create();this.displayViewMat3=x.create();this.viewMat3=this.viewMat2d=this.inverseTransform=this.transform=null;this.id=0;this.center=this.extent=null;this.scale=1;this.worldScreenWidth=this.resolution=0;this.toJSON=this.copy=this.clone=this.toScreen=this.toMap=this.getScreenTransform=this.viewpoint=this.spatialReference=null}}w.VectorTileRendererHelper3D=F;Object.defineProperty(w,Symbol.toStringTag,{value:"Module"})});