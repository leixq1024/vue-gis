// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.31/esri/copyright.txt for details.
//>>built
define("exports ../../../../../../core/libs/gl-matrix-2/math/mat2d ../../../../../../core/libs/gl-matrix-2/factories/mat2df32 ../../../../../../core/libs/gl-matrix-2/math/vec2 ../../../../../../core/libs/gl-matrix-2/factories/vec2f32 ../../alignmentUtils ../../Rect ../../collisions/BoundingBox".split(" "),function(D,u,z,v,J,H,L,B){function C(a,b){a.forEach(c=>v.transformMat2d(c,c,b));return{topLeft:a[0],topRight:a[1],bottomLeft:a[2],bottomRight:a[3]}}const M=Math.PI/180;class I{constructor(a,b,c,
d){this._rotationT=z.create();this.minZoom=this._yBounds=this._xBounds=0;this.maxZoom=255;this._bounds=null;const f=c.rect,h=new Float32Array(8);a*=d;b*=d;const e=c.code?f.width*d:c.metrics.width,g=c.code?f.height*d:c.metrics.height;this.width=e;this.height=g;h[0]=a;h[1]=b;h[2]=a+e;h[3]=b;h[4]=a;h[5]=b+g;h[6]=a+e;h[7]=b+g;this._data=h;this._setTextureCoords(f);this._scale=d;this._mosaic=c;this.x=a;this.y=b;this.maxOffset=Math.max(a+e,b+g)}get mosaic(){return this._mosaic}set angle(a){this._angle=
a;u.fromRotation(this._rotationT,-a);this._setOffsets()}get angle(){return this._angle}get xTopLeft(){return this._data[0]}get yTopLeft(){return this._data[1]}get xBottomRight(){return this._data[6]}get yBottomRight(){return this._data[7]}get texcoords(){return this._texcoords}get textureBinding(){return this._mosaic.textureBinding}get offsets(){this._offsets||this._setOffsets();return this._offsets}get char(){return String.fromCharCode(this._mosaic.code)}get code(){return this._mosaic.code}get bounds(){if(!this._bounds){const {height:f,
width:h}=this._mosaic.metrics;var a=h*this._scale,b=Math.abs(f)*this._scale,c=new Float32Array(8);c[0]=this.x;c[1]=this.y;c[2]=this.x+a;c[3]=this.y;c[4]=this.x;c[5]=this.y+b;c[6]=this.x+a;c[7]=this.y+b;a=u.multiply(z.create(),this._rotationT,this._transform);z.transformMany(c,c,a);b=a=Infinity;let e=-Infinity;var d=-Infinity;for(let g=0;4>g;g++){const m=c[2*g],n=c[2*g+1];a=Math.min(a,m);b=Math.min(b,n);e=Math.max(e,m);d=Math.max(d,n)}c=e-a;d-=b;this._bounds=new B(a+c/2,b+d/2,c,d)}return this._bounds}setTransform(a){this._transform=
a;this._offsets=null}_setOffsets(){this._offsets||(this._offsets={topLeft:[0,0],topRight:[0,0],bottomLeft:[0,0],bottomRight:[0,0]});const a=u.multiply(z.create(),this._rotationT,this._transform);this._offsets.topLeft[0]=this._data[0];this._offsets.topLeft[1]=this._data[1];this._offsets.topRight[0]=this._data[2];this._offsets.topRight[1]=this._data[3];this._offsets.bottomLeft[0]=this._data[4];this._offsets.bottomLeft[1]=this._data[5];this._offsets.bottomRight[0]=this._data[6];this._offsets.bottomRight[1]=
this._data[7];v.transformMat2d(this._offsets.topLeft,this._offsets.topLeft,a);v.transformMat2d(this._offsets.topRight,this._offsets.topRight,a);v.transformMat2d(this._offsets.bottomLeft,this._offsets.bottomLeft,a);v.transformMat2d(this._offsets.bottomRight,this._offsets.bottomRight,a)}_setTextureCoords({x:a,y:b,width:c,height:d}){this._texcoords={topLeft:[a,b],topRight:[a+c,b],bottomLeft:[a,b+d],bottomRight:[a+c,b+d]}}}class K{constructor(a,b,c){this._rotation=0;this._decorate(a,b,c);this.glyphs=
a;this.bounds=this._createBounds(a);this.isMultiline=1<b.length;this._hasRotation=0!==c.angle;this._transform=this._createGlyphTransform(this.bounds,c);if((this._borderLineSizePx=c.borderLineSizePx)||c.hasBackground)[this.bounds,this.textBox]=this.shapeBackground(this._transform);for(const d of a)d.setTransform(this._transform)}setRotation(a){if(0!==a||0!==this._rotation){this._rotation=a;var b=this._transform;a=u.fromRotation(z.create(),a);u.multiply(b,a,b);for(const c of this.glyphs)c.setTransform(this._transform)}}_decorate(a,
b,c){if(c.decoration&&"none"!==c.decoration&&a.length){var d=c.scale;c="underline"===c.decoration?26:16;var f=a[0].textureBinding;for(const m of b){const n=m.startX*d,r=m.startY*d;b=a;var h=b.push;var e=(m.width+m.glyphWidthEnd)*d;var g=f;e={code:0,page:0,sdf:!0,rect:new L(0,0,11,8),textureBinding:g,metrics:{advance:0,height:4,width:e,left:0,top:0}};h.call(b,new I(n,r+c*d,e,1))}}}shapeBackground(a){const b=(1.5+(this._borderLineSizePx||0))/2;var c=this._borderLineSizePx?b:0;const {xmin:d,ymin:f,xmax:h,
ymax:e,x:g,y:m,width:n,height:r}=this.bounds,k=[d-8,f-8],l=[h+8,f-8],p=[d-8,e+8],q=[h+8,e+8],x=C([[k[0]-b,k[1]-b],[l[0]+b,l[1]-b],[k[0]+c,k[1]+c],[l[0]-c,l[1]+c]],a),E=C([[p[0]+c,p[1]-c],[q[0]-c,q[1]-c],[p[0]-b,p[1]+b],[q[0]+b,q[1]+b]],a),t=C([[k[0]-b,k[1]-b],[k[0]+c,k[1]+c],[p[0]-b,p[1]+b],[p[0]+c,p[1]-c]],a);c=C([[l[0]-c,l[1]+c],[l[0]+b,l[1]-b],[q[0]-c,q[1]-c],[q[0]+b,q[1]+b]],a);a={main:C([k,l,p,q],a),top:x,bot:E,left:t,right:c};return[new B(g,m,n+2*b,r+2*b),a]}get boundsT(){var a=this.bounds;
const b=v.set(J.create(),a.x,a.y);v.transformMat2d(b,b,this._transform);return this._hasRotation?(a=Math.max(a.width,a.height),new B(b[0],b[1],a,a)):new B(b[0],b[1],a.width,a.height)}_createBounds(a){let b=Infinity,c=Infinity,d=0;var f=0;for(const h of a)b=Math.min(b,h.xTopLeft),c=Math.min(c,h.yTopLeft),d=Math.max(d,h.xBottomRight),f=Math.max(f,h.yBottomRight);a=d-b;f-=c;return new B(b+a/2,c+f/2,a,f)}_createGlyphTransform(a,b){const c=M*b.angle,d=z.create(),f=J.create();u.translate(d,d,v.set(f,b.xOffset,
-b.yOffset));b.useCIMAngleBehavior?u.rotate(d,d,c):(u.translate(d,d,v.set(f,a.x,a.y)),u.rotate(d,d,c),u.translate(d,d,v.set(f,-a.x,-a.y)));return d}}class F{constructor(a,b,c,d,f,h){this.startY=this.startX=this.glyphWidthEnd=0;this.start=Math.max(0,Math.min(b,c));this.end=Math.max(0,Math.max(b,c));this.end<a.length&&(this.glyphWidthEnd=a[this.end].metrics.width);this.width=d;this.yMin=f;this.yMax=h}}D.ShapedGlyph=I;D.ShapingInfo=K;D.shapeGlyphs=function(a,b){const c=b.scale,d=[],{glyphs:f,isRightToLeft:h}=
a,e=[];var g=1/b.scale*b.maxLineWidth,m=h?f.length-1:0,n=h?-1:f.length,r=h?-1:1,k=m,l=0,p=0,q=k;let x=q,E=0,t=Infinity,w=0;for(;k!==n;){const {code:A,metrics:y}=f[k];var G=Math.abs(y.top);10!==A&&32!==A&&(t=Math.min(t,G),w=Math.max(w,G+y.height));10===A?(k!==m&&(e.push(new F(f,q,k-r,l,Infinity===t?0:t,w)),t=Infinity,w=0),l=0,q=k+r,x=k+r,p=0):32===A?(x=k+r,p=0,E=y.advance,l+=y.advance):(l>g&&(x!==q?(G=x-2*r,l-=E,e.push(new F(f,q,G,l-p,t,w)),t=Infinity,w=0,q=x,l=p):(e.push(new F(f,q,k-r,l,t,w)),t=Infinity,
w=0,x=q=k,l=0)),l+=y.advance,p+=y.advance);k+=r}g=new F(f,q,k-r,l,t,w);0<=g.start&&g.end<f.length&&e.push(g);if(e.length){g=0;for(m=0;m<e.length;m++)({width:n}=e[m]),g=Math.max(n,g);m=e[0].yMin;g={x:0,y:m,height:e[e.length-1].yMax+b.lineHeight*(e.length-1)+("underline"===b.decoration?4:0)-m,width:g}}else g={x:0,y:0,height:0,width:0};m=g;g=H.getXAnchorDirection(b.horizontalAlignment);n=H.getYAnchorDirection(b.verticalAlignment);r=n===H.VAlign.Baseline?1:0;m=(1-r)*-m.y+m.height/2*(r?0:n-1)+-22*(r?1:
0);for(n=0;n<e.length;n++){const {start:A,end:y,width:N}=e[n];r=N/2*(g+1)*-1-3;k=(a.isRightToLeft?e.length-1-n:n)*b.lineHeight+m-3;e[n].startX=r;e[n].startY=k;for(l=A;l<=y;l++)p=f[l],10!==p.code&&(q=new I(r+p.metrics.left,k-p.metrics.top,p,c),r+=p.metrics.advance,d.push(q))}return new K(d,e,b)};Object.defineProperty(D,Symbol.toStringTag,{value:"Module"})});