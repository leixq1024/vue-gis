// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.31/esri/copyright.txt for details.
//>>built
define("../../../../../../core/Logger ../../definitions ./parameters ../../../../support/HighlightOptions ../../../../../webgl/enums ../../../../../webgl/Texture ../../../../../webgl/TextureDescriptor".split(" "),function(u,r,l,v,w,x,y){function z(b,a){a.fillColor[0]=b.color.r/255;a.fillColor[1]=b.color.g/255;a.fillColor[2]=b.color.b/255;a.fillColor[3]=b.color.a;b.haloColor?(a.outlineColor[0]=b.haloColor.r/255,a.outlineColor[1]=b.haloColor.g/255,a.outlineColor[2]=b.haloColor.b/255,a.outlineColor[3]=
b.haloColor.a):(a.outlineColor[0]=a.fillColor[0],a.outlineColor[1]=a.fillColor[1],a.outlineColor[2]=a.fillColor[2],a.outlineColor[3]=a.fillColor[3]);a.fillColor[3]*=b.fillOpacity;a.outlineColor[3]*=b.haloOpacity;a.fillColor[0]*=a.fillColor[3];a.fillColor[1]*=a.fillColor[3];a.fillColor[2]*=a.fillColor[3];a.outlineColor[0]*=a.outlineColor[3];a.outlineColor[1]*=a.outlineColor[3];a.outlineColor[2]*=a.outlineColor[3];a.outlineWidth=(1-b.haloBlur)*b.haloWidth;a.outerHaloWidth=b.haloBlur*b.haloWidth/2;a.innerHaloWidth=
b.haloBlur*b.haloWidth/2;a.outlinePosition=0}const p=()=>u.getLogger("esri.views.2d.engine.webgl.painter.highlight.HighlightGradient"),A=[0,0,0,0];class B{constructor(){this.type="single";this._highlightOptions=new v;this._convertedHighlightOptions={fillColor:[0,0,0,0],outlineColor:[0,0,0,0],outlinePosition:0,outlineWidth:0,innerHaloWidth:0,outerHaloWidth:0};this._optionsShadeTexKey="";this._texelData=new Uint8Array(4*l.shadeTextureSize);this._minMaxDistance=[0,0]}setHighlightOptions(b){this._highlightOptions=
b}applyHighlightOptions(b,a){this._updateGradientTexture(b);b.bindTexture(this._shadeTex,r.textureBindingHighlight1);a.setUniform2fv("u_minMaxDistance",this._minMaxDistance)}destroy(){this._shadeTex?.dispose();this._shadeTex=null}getReasonsWithGradients(){return[{activeReasons:(1<<r.maxHighlightReasons)-1,activeGradient:this}]}_updateGradientTexture(b){function a(f,n,h){d[0]=(1-h)*f[0]+h*n[0];d[1]=(1-h)*f[1]+h*n[1];d[2]=(1-h)*f[2]+h*n[2];d[3]=(1-h)*f[3]+h*n[3]}var {optionsKey:c}=this._highlightOptions;
if(c!==this._optionsShadeTexKey){this._optionsShadeTexKey=c;z(this._highlightOptions,this._convertedHighlightOptions);c=this._convertedHighlightOptions;var k=c.outlinePosition-c.outlineWidth/2-c.outerHaloWidth,t=c.outlinePosition-c.outlineWidth/2,q=c.outlinePosition+c.outlineWidth/2,m=c.outlinePosition+c.outlineWidth/2+c.innerHaloWidth,e=Math.sqrt(Math.PI/2)*l.sigma,g=Math.abs(k)>e?Math.round(10*(Math.abs(k)-e))/10:0;e=Math.abs(m)>e?Math.round(10*(Math.abs(m)-e))/10:0;g&&!e?p().error("The outer rim of the highlight is "+
g+"px away from the edge of the feature; consider reducing some width values or shifting the outline position towards positive values (inwards)."):!g&&e?p().error("The inner rim of the highlight is "+e+"px away from the edge of the feature; consider reducing some width values or shifting the outline position towards negative values (outwards)."):g&&e&&p().error("The highlight is "+Math.max(g,e)+"px away from the edge of the feature; consider reducing some width values.");var d=[void 0,void 0,void 0,
void 0];({_texelData:e}=this);for(let f=0;f<l.shadeTextureSize;++f)g=k+f/(l.shadeTextureSize-1)*(m-k),g<k?(d[0]=0,d[1]=0,d[2]=0,d[3]=0):g<t?a(A,c.outlineColor,(g-k)/(t-k)):g<q?[d[0],d[1],d[2],d[3]]=c.outlineColor:g<m?a(c.outlineColor,c.fillColor,(g-q)/(m-q)):[d[0],d[1],d[2],d[3]]=c.fillColor,e[4*f]=255*d[0],e[4*f+1]=255*d[1],e[4*f+2]=255*d[2],e[4*f+3]=255*d[3];this._minMaxDistance[0]=k;this._minMaxDistance[1]=m;this._shadeTex||(c=new y.TextureDescriptor,c.wrapMode=w.TextureWrapMode.CLAMP_TO_EDGE,
c.width=l.shadeTextureSize,c.height=1,this._shadeTex=new x.Texture(b,c));this._shadeTex.updateData(0,0,0,l.shadeTextureSize,1,this._texelData)}}}return B});