// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.31/esri/copyright.txt for details.
//>>built
define(["exports","../../../../../webgl/enums","../../../../../webgl/Texture","../../../../../webgl/TextureDescriptor","../../../../../webgl/ValidatedTextureDescriptor"],function(f,e,l,m,n){class p{constructor(){this._entries=new g;this._nodes=new Map;this._book=new q}add(b){let a=this._entries.get(b);if(!a){const c={};a={location:this._book.add(b),references:0,handle:c};b=this._entries.set(b,a);this._nodes.set(c,b)}a.references++;return a}remove(b){const a=this._nodes.get(b.handle);a&&a.payload&&
(a.payload.references--,0===a.payload.references&&(this._book.remove(a.payload.location),this._entries.delete(a),this._nodes.delete(b.handle)))}getTexture(b,a){return this._book.getTexture(b,a)}destroy(){this._book.destroy()}}class h{constructor(b,a){this.parent=b;this.key=a;this.payload=null;this._children=new Map}get(b){return this._children.get(b)}ensure(b){let a=this._children.get(b);a||(a=new h(this,b),this._children.set(b,a));return a}delete(b){this._children.delete(b)}}class g{constructor(){this._root=
new h(null,NaN)}set(b,a){let c=this._root;for(const d of b)for(const r of d)c=c.ensure(r);c.payload=a;return c}delete(b){b.parent?.delete(b.key)}get(b){let a=this._root;for(const c of b)for(const d of c){b=a.get(d);if(!b)return;a=b}return a.payload||void 0}}class q{constructor(){this._pages=[]}add(b){0===this._pages.length&&this._pages.push(new k);let a=this._pages.length-1,c=this._pages[a].add(b);c||(this._pages.push(new k),a=this._pages.length-1,c=this._pages[a].add(b));if(!c)throw Error("Data allocation failed.");
return{...c,page:a}}remove(b){this._pages[b.page].remove(b)}getTexture(b,a){return this._pages[a].getTexture(b)}destroy(){}}class k{constructor(){this._cursor={row:0,column:0};this._rows=this._columns=1024;this._data=new Float32Array(this._columns*this._rows*4);this._texture=null;this._textureCursor={row:0,column:0}}add(b){if(b.length>this._columns)throw Error(`The maximum allocation size is ${this._columns} texels.`);var a={...this._cursor};a.column+=b.length;a.column>=this._columns&&(a.column=b.length,
a.row++);if(a.row>=this._rows)return null;this._cursor=a;a={...this._cursor};a.column-=b.length;let c=4*(a.row*this._columns+a.column);for(let d=0;d<b.length;d++)this._data[c++]=b[d][0],this._data[c++]=b[d][1],this._data[c++]=b[d][2],this._data[c++]=b[d][3];return a}remove(b){}getTexture(b){if(!this._texture){var a=new m.TextureDescriptor(this._columns,this._rows);a.pixelFormat=e.PixelFormat.RGBA;a.dataType=e.PixelType.FLOAT;a.wrapMode=e.TextureWrapMode.CLAMP_TO_EDGE;a.samplingMode=e.TextureSamplingMode.NEAREST;
a.hasMipmap=!1;a=new n.ValidatedTextureDescriptor(b,a);this._texture=new l.Texture(b,a)}if(this._cursor.row===this._textureCursor.row&&this._cursor.column===this._textureCursor.column)return this._texture;b=this._textureCursor.row;this._texture.updateData(0,0,b,this._columns,this._cursor.row-b+1,this._data,b);this._textureCursor.row=this._cursor.row;this._textureCursor.column=this._cursor.column;return this._texture}destroy(){this._texture?.dispose()}}f.AnimationStore=p;f.PrefixMap=g;Object.defineProperty(f,
Symbol.toStringTag,{value:"Module"})});