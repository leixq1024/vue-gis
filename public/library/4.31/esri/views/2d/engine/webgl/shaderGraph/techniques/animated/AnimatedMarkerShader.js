// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.31/esri/copyright.txt for details.
//>>built
define("exports ../../../../../../../chunks/tslib.es6 ../../../../../../../symbols/cim/animationDebugFlags ../../GraphShaderModule ../../graph/glsl ./AnimatedShader ./enums ../markers/markerConstants ../shaders/constants ../shaders/hittestUtils ../shaders/utils ../shaders/vvUtils".split(" "),function(J,p,N,q,a,v,A,G,O,h,H,K){function w(b,c,d,g){return c.multiply(b.x).add(d.multiply(b.y)).add(g.multiply(b.z))}class B extends v.AAnimatedVertexInput{}p.__decorate([q.location(5,a.Vec2)],B.prototype,"offset",
void 0);p.__decorate([q.location(6,a.Vec2)],B.prototype,"uv",void 0);p.__decorate([q.location(7,a.Vec4)],B.prototype,"sizing",void 0);p.__decorate([q.location(8,a.Float)],B.prototype,"angle",void 0);class I extends q.ComputeVertexInput{}p.__decorate([q.location(12,a.Vec2)],I.prototype,"offsetNextVertex1",void 0);p.__decorate([q.location(13,a.Vec2)],I.prototype,"offsetNextVertex2",void 0);p.__decorate([q.location(14,a.Vec2)],I.prototype,"textureUVNextVertex1",void 0);p.__decorate([q.location(15,a.Vec2)],
I.prototype,"textureUVNextVertex2",void 0);class M extends v.AAnimatedFragmentInput{}class L extends v.AAnimatedShader{constructor(){super(...arguments);this.computeAttributes={offset:["offsetNextVertex1","offsetNextVertex2"],uv:["textureUVNextVertex1","textureUVNextVertex2"]}}_vertexPreamble(b){const {id:c,pos:d,offset:g,animationPointerAndBaseSizeAndReferenceSize:f,uv:n,sizing:t,angle:u}=b,C=f.xy,e=f.z;var k=f.w,x=t.xy;const z=t.z,D=H.getBit(b.bitset,G.MarkerConstants.bitset.isStroke),E=t.w,r=H.getBit(b.bitset,
G.MarkerConstants.bitset.scaleSymbolsProportionally);x=this._getEvalParams(b,x);var l=v.getValue(C,A.AnimationParamIndex.transform,x),m=a.cond([a.equal(H.getBit(b.bitset,G.MarkerConstants.bitset.isMapAligned),new a.Float(1)),this.view.rotation.divide(180).multiply(Math.PI)],[!0,new a.Float(0)]);const y=(new a.Mat2(a.cos(m),a.sin(m.multiply(-1)),a.sin(m),a.cos(m))).multiply(l.xy);m=l.z.subtract(m).subtract(u.multiply(O.c256ToRad));l=l.w;b=H.getBit(b.bitset,G.MarkerConstants.bitset.isSDF);const F=K.getVisualVariableSize(this,
c,new a.Float(k)).divide(new a.Float(k));k=this._getScreenPosition({id:c,pos:d,offset:g,referenceSize:k,translation:y,rotation:m,scale:l,vvScale:F});return{baseSize:e,animationPointer:C,strokeWidth:z,isOutline:D,unscaledDistanceToPx:E,scaleSymbolsProportionally:r,isSDF:b,position:k,uv:n,evalParams:x,vvScale:F,scale:l}}vertex(b,c){const {position:d,animationPointer:g,evalParams:f,isOutline:n,unscaledDistanceToPx:t,vvScale:u,uv:C,strokeWidth:e,scaleSymbolsProportionally:k,scale:x,isSDF:z,baseSize:D}=
this._vertexPreamble(b),E=this._toNdc(d);var r=v.getValue(g,A.AnimationParamIndex.fromColor,f);r=new a.Vec4(r.rgb.multiply(r.a),r.a);var l=v.getValue(g,A.AnimationParamIndex.toColor,f);l=new a.Vec4(l.rgb.multiply(l.a),l.a);var m=v.getValue(g,A.AnimationParamIndex.colorMix,f);m=new a.Vec4(m.rgb.multiply(m.a),m.a);var y=v.getValue(g,A.AnimationParamIndex.toOpacity,f).a,F=v.getValue(g,A.AnimationParamIndex.opacityMix,f).a;r=K.getVisualVariableColor(this,b.id,r,a.or(H.getBitBool(b.bitset,G.MarkerConstants.bitset.colorLocked),
new a.Bool(n)));l=a.mix(r,l,m);m=K.getVisualVariableOpacity(this,b.id);y=a.mix(m,y,F);y=l.multiply(y);F=this.clip(b.id,b.zoomRange);l=t.multiply(u);return{glPosition:new a.Vec4(E,F,1),uv:C.divide(this.mosaicInfo.size),color:y.multiply((new a.Float(1)).subtract(n)),outlineColor:y.multiply(n),distanceToPx:l,strokeWidth:e.multiply(a.mix(new a.Float(1),x,k)),isOutline:n,isSDF:z,...this.maybeRunHittest(b,c,{pos:b.pos,size:D,sizeCorrection:new a.Float(1),isMapAligned:new a.Float(1),vvRotationMat3:new a.Mat3(1,
0,0,0,1,0,0,0,1),placementMat3:new a.Mat3(1,0,0,0,1,0,0,0,1),outlineSize:new a.Float(1),distanceToPx:l,isSDF:z})}}fragment(b){let c=this._getColor(b.uv,{color:b.color,distanceToPx:b.distanceToPx,isSDF:b.isSDF,outlineColor:b.outlineColor,outlineSize:b.strokeWidth});N.animationDebugFlags.spotlightAnimatedSymbols&&(c=c.add(new a.Vec4(0,.3,0,.3)));return this.getFragmentOutput(c,b)}hittest(b,c,d){return a.ifElse(a.lessThan(d.size,this.hittestRequest.smallSymbolSizeThreshold),this._hittestSmallMarker(b,
c,d),this._hittestMarker(b,c,d))}_hittestSmallMarker(b,c,d){const {position:g,distance:f,smallSymbolDistance:n}=this.hittestRequest;b=f.subtract(n);const {viewMat3:t,tileMat3:u}=this.view;c=t.multiply(u).multiply(new a.Vec3(d.pos,1)).xy;d=d.size.multiply(.5);return a.distance(c,g).subtract(d).add(b)}_hittestMarker(b,c,d){const g=this._vertexPreamble({...b}).position,f=this._vertexPreamble({...b,offset:c.offsetNextVertex1,uv:c.textureUVNextVertex1}).position,n=this._vertexPreamble({...b,offset:c.offsetNextVertex2,
uv:c.textureUVNextVertex2}).position,t=this.hittestRequest.distance,u=h.distPointTriangle(this.hittestRequest.position,g,f,n);return a.ifElse(a.greaterThan(u,t),u,this._hittestSamples(g,f,n,b,c,d))}_hittestSamples(b,c,d,g,f,n){const {outlineSize:t,isSDF:u,distanceToPx:C}=n;var e=this.hittestRequest.position;const k=this.hittestRequest.distance;n=h.xyToBarycentric(e.add(new a.Vec2(a.negate(k),a.negate(k))),b,c,d);const x=h.xyToBarycentric(e.add(new a.Vec2(0,a.negate(k))),b,c,d),z=h.xyToBarycentric(e.add(new a.Vec2(k,
a.negate(k))),b,c,d),D=h.xyToBarycentric(e.add(new a.Vec2(a.negate(k),0)),b,c,d),E=h.xyToBarycentric(e,b,c,d),r=h.xyToBarycentric(e.add(new a.Vec2(k,0)),b,c,d),l=h.xyToBarycentric(e.add(new a.Vec2(a.negate(k),k)),b,c,d),m=h.xyToBarycentric(e.add(new a.Vec2(0,k)),b,c,d);b=h.xyToBarycentric(e.add(new a.Vec2(k,k)),b,c,d);g=g.uv.divide(this.mosaicInfo.size);c=f.textureUVNextVertex1.divide(this.mosaicInfo.size);f=f.textureUVNextVertex2.divide(this.mosaicInfo.size);d={color:new a.Vec4(1,1,1,1),outlineSize:t,
outlineColor:new a.Vec4(1,1,1,1),isSDF:u,distanceToPx:C};e=new a.Float(0);e=e.add(h.inTriangle(n).multiply(this._getColor(w(n,g,c,f),d).a));e=e.add(h.inTriangle(x).multiply(this._getColor(w(x,g,c,f),d).a));e=e.add(h.inTriangle(z).multiply(this._getColor(w(z,g,c,f),d).a));e=e.add(h.inTriangle(D).multiply(this._getColor(w(D,g,c,f),d).a));e=e.add(h.inTriangle(E).multiply(this._getColor(w(E,g,c,f),d).a));e=e.add(h.inTriangle(r).multiply(this._getColor(w(r,g,c,f),d).a));e=e.add(h.inTriangle(l).multiply(this._getColor(w(l,
g,c,f),d).a));e=e.add(h.inTriangle(m).multiply(this._getColor(w(m,g,c,f),d).a));e=e.add(h.inTriangle(b).multiply(this._getColor(w(b,g,c,f),d).a));return a.step(e,new a.Float(.05)).multiply(h.failHittest(this.hittestRequest))}}p.__decorate([p.__param(0,q.input(B)),p.__param(1,q.input(I))],L.prototype,"vertex",null);p.__decorate([p.__param(0,q.input(M))],L.prototype,"fragment",null);J.AnimatedMarkerFragmentInput=M;J.AnimatedMarkerShader=L;J.AnimatedMarkerVertexInput=B;Object.defineProperty(J,Symbol.toStringTag,
{value:"Module"})});