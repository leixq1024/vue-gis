// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.31/esri/copyright.txt for details.
//>>built
define("exports ../../../../../../../chunks/tslib.es6 ../../../../../../../symbols/cim/animationDebugFlags ../../../animations/instructions ../../GraphShaderModule ../../graph/glsl ./AnimationUniformInfo ../shaders/AFeatureShader ../shaders/constants ../shaders/MosaicInfo ../shaders/utils ../shaders/VisualVariableColor ../shaders/VisualVariableOpacity ../shaders/VisualVariableRotation ../shaders/VisualVariableSizeMinMaxValue ../shaders/VisualVariableSizeScaleStops ../shaders/VisualVariableSizeStops ../shaders/VisualVariableSizeUnitValue ../shaders/vvUtils".split(" "),
function(p,e,v,w,f,a,x,r,y,z,A,B,C,D,E,F,G,H,I){class t extends r.FeatureVertexInput{}e.__decorate([f.location(3,a.Vec4)],t.prototype,"animationPointerAndBaseSizeAndReferenceSize",void 0);e.__decorate([f.location(4,a.Vec2)],t.prototype,"zoomRange",void 0);class J extends r.FeatureFragmentInput{}class g extends r.AFeatureShader{_getScreenPosition(b){const {pos:c,translation:d,rotation:k,scale:m,offset:K,id:L,vvScale:M}=b;var h=I.getVisualVariableAngle(this,L).multiply(Math.PI/180);b=d.x.multiply(4/
3);const N=d.y.multiply(-1).multiply(4/3);var l=a.sin(k.subtract(h));const u=a.cos(k.subtract(h)),n=new a.Float(0),q=new a.Float(1);({pixelRatio:h}=this.animationInfo);b=new a.Mat3(q,n,n,n,q,n,b.multiply(h),N.multiply(h),q);l=new a.Mat3(u,l.multiply(-1),n,l,u,n,0,0,q);h=m.multiply(M).multiply(h).multiply(4/3);l=l.multiply(h);h=this.animationInfo.toScreen.multiply(new a.Vec3(c,1));b=b.multiply(h).xy;l=l.multiply(new a.Vec3(K,0)).xy;return b.add(l)}_clip(b,c){c=super.clip(b,c);b=a.lessThanEqual(this._getLocalTimeOrigin(b),
new a.Float(0));v.animationDebugFlags.forceGlobalTimeOrigin||(c=c.add(a.cond([b,()=>new a.Float(2)],[!0,()=>new a.Float(0)])));return c}_getLocalTimeOrigin(b){return this.storage.getLocalTimeOrigin(b)}_toNdc(b){return this.animationInfo.toNdc.multiply(new a.Vec3(b,1)).xy}_getEvalParams(b,c){const {globalTime:d,animationTextureSize:k,animationTexture:m}=this.animationInfo;return{globalTime:d,localTimeOrigin:this._getLocalTimeOrigin(b.id),animationTextureSize:k,animationTexture:m,pixelDimensions:c}}_getColor(b,
c){return a.ifElse(a.equal(c.isSDF,new a.Float(1)),this._getSDFColor(b,c),this._getSpriteColor(b,c))}_getSpriteColor(b,c){return a.texture2D(this.mosaicInfo.texture,b).multiply(c.color)}_getSDFColor(b,c){b=a.texture2D(this.mosaicInfo.texture,b);var d=(new a.Float(.5)).subtract(A.rgba2float(b)).multiply(c.distanceToPx).multiply(y.softEdgeRatio);b=a.clamp((new a.Float(.5)).subtract(d),new a.Float(0),new a.Float(1));b=c.color.multiply(b);const k=c.outlineSize.multiply(.5);d=a.abs(d).subtract(k);d=a.clamp((new a.Float(.5)).subtract(d),
new a.Float(0),new a.Float(1));c=c.outlineColor.multiply(d);return(new a.Float(1)).subtract(c.a).multiply(b).add(c)}}e.__decorate([f.uniform(z.MosaicInfo)],g.prototype,"mosaicInfo",void 0);e.__decorate([f.uniform(x.AnimationUniformInfo)],g.prototype,"animationInfo",void 0);e.__decorate([f.option(B.VisualVariableColor)],g.prototype,"visualVariableColor",void 0);e.__decorate([f.option(C.VisualVariableOpacity)],g.prototype,"visualVariableOpacity",void 0);e.__decorate([f.option(E.VisualVariableSizeMinMaxValue)],
g.prototype,"visualVariableSizeMinMaxValue",void 0);e.__decorate([f.option(F.VisualVariableSizeScaleStops)],g.prototype,"visualVariableSizeScaleStops",void 0);e.__decorate([f.option(G.VisualVariableSizeStops)],g.prototype,"visualVariableSizeStops",void 0);e.__decorate([f.option(H.VisualVariableSizeUnitValue)],g.prototype,"visualVariableSizeUnitValue",void 0);e.__decorate([f.option(D.VisualVariableRotation)],g.prototype,"visualVariableRotation",void 0);p.AAnimatedFragmentInput=J;p.AAnimatedShader=
g;p.AAnimatedVertexInput=t;p.getValue=function(b,c,d){c=b.add(new a.Vec2(c,0));c=a.texture2D(d.animationTexture,c.add(.5).divide(d.animationTextureSize)).xy;b=b.add(c);return a.block({animationPointer:b,...d},a.Vec4,null,k=>{const {out:m}=k;if(!m)throw Error("out is null");return w.generateVirtualMachineSource({...k,out:m})})};Object.defineProperty(p,Symbol.toStringTag,{value:"Module"})});