// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.31/esri/copyright.txt for details.
//>>built
define(["exports","../../../../../core/mathUtils","../../../layers/features/support/StaticBitSet"],function(h,g,k){class l{constructor(a,b,c){this._width=a*c;this._height=b*c;this._pixelRatio=c;a=Math.ceil(this._width/1);b=Math.ceil(this._height/1);this._cols=a;this._rows=b;this._cells=k.StaticBitSet.create(a*b)}insertMetrics(a){this._markMetrics(a)}hasCollision(a){let b=0;for(const {transformedX:c,transformedY:e,width:d,height:f}of a.bounds)switch(this._collide(c*this._pixelRatio,e*this._pixelRatio,
d*this._pixelRatio,f*this._pixelRatio)){case 2:return 2;case 1:b++}return b===a.bounds.length?1:0}getCellId(a,b){return a+b*this._cols}has(a){return this._cells.has(a)}hasRange(a,b){return this._cells.hasRange(a,b)}set(a){this._cells.set(a)}setRange(a,b){this._cells.setRange(a,b)}_collide(a,b,c,e){a-=c/2;b-=e/2;c=a+c;var d=b+e;if(0>c||0>d||a>this._width||b>this._height)return 1;e=g.clamp(Math.floor(a/1),0,this._cols);var f=g.clamp(Math.floor(b/1),0,this._rows);a=g.clamp(Math.ceil(c/1),0,this._cols);
b=g.clamp(Math.ceil(d/1),0,this._rows);for(c=f;c<=b;c++)for(d=e;d<=a;d++)if(f=this.getCellId(d,c),this.has(f))return 2;return 0}_mark(a,b,c,e){a-=c/2;b-=e/2;c=a+c;var d=b+e;e=g.clamp(Math.floor(a/1),0,this._cols);var f=g.clamp(Math.floor(b/1),0,this._rows);a=g.clamp(Math.ceil(c/1),0,this._cols);b=g.clamp(Math.ceil(d/1),0,this._rows);for(c=f;c<=b;c++)for(d=e;d<=a;d++)f=this.getCellId(d,c),this.set(f);return!1}_markMetrics(a){for(const {transformedX:b,transformedY:c,width:e,height:d}of a.bounds)this._mark(b*
this._pixelRatio,c*this._pixelRatio,e*this._pixelRatio,d*this._pixelRatio)}}h.CollisionBitsetGrid=l;h.hasCollision=2;h.none=0;h.outsideExtent=1;Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})});