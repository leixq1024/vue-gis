// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.31/esri/copyright.txt for details.
//>>built
define("exports ../../../../chunks/tslib.es6 ../../../../core/mathUtils ../../../../core/time ../../../../core/Logger ../../../../core/has ../../../../core/RandomLCG ../../../../core/Error ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../geometry/support/ray ../../../../chunks/sphere ../../camera/constraintUtils ../../camera/constraintUtils/ConstraintOptions ../../camera/constraintUtils/ConstraintTypes ../../camera/constraintUtils/InteractionType ../../camera/constraintUtils/surfaceCollision ./PointToPointAnimationController ../utils/navigationUtils ../../support/geometryUtils/ray ../../support/geometryUtils/sphere ../../webgl/RenderCamera ../../webgl-engine/lib/Intersector ../../../animation/easing".split(" "),
function(l,t,u,v,K,L,M,N,w,b,k,x,y,z,A,B,C,D,E,h,F,G,q,H,I){l.ZoomStepControllerGlobal=class extends E.PointToPointAnimationController{constructor(){super(...arguments);this._zoomLocation=k.create();this._tmpCamera=new q;this._tmpViewDir=k.create();this._tmpRayDir=x.create();this._targetOnSphere=k.create();this._tmpCenter=k.create();this._beginCamera=new q;this._constraintOptions=new A.ConstraintOptions(B.ConstraintTypes.ALL_EXCEPT_COLLISION,C.InteractionType.ZOOM,null,this._beginCamera);this._sphere=
y.create()}initialize(){this._intersector=H.newIntersector(this.view.state.viewingMode)}step(a,e){if(this.running){var c=this.view.state;this.animation.finished?this._beginCamera.copyFrom(c.camera):this.animation.cameraAt(1,this._beginCamera);var d=!1,f=!1;this._intersectionHelper.intersectScreen(e,this._zoomLocation,0===this.view.map.ground.opacity?h.contentIntersectorOptions:{})&&(d=0<a,f=!0);this._tmpCamera.copyFrom(c.camera);d?this._intersectionHelper.intersectRay(this._tmpCamera.ray,this._intersector,
this._tmpCenter)&&(this._tmpCamera.center=this._tmpCenter):this._intersectionHelper.intersectRay(this._tmpCamera.ray,this._intersector,this._zoomLocation)?this._tmpCamera.center=this._zoomLocation:b.copy(this._zoomLocation,this._tmpCamera.center);this._updateCamera(this._tmpCamera,a,e,f);this.begin(this._tmpCamera)}}animationSettings(){return{duration:v.Milliseconds(600),easing:I.outExpo}}_updateCamera(a,e,c,d){var f=h.navigationMode(a,c,this.view.renderCoordsHelper,this.view.viewingMode),p=Math.abs(this.view.camera.position.z),
g=this._zoomLocation;b.normalize(m,a.eye);b.scale(m,m,-1);F.fromScreenAtEye(a,c,this._tmpRayDir);b.normalize(this._tmpRayDir.direction,this._tmpRayDir.direction);const r=u.clamp(Math.min(h.zoomDistanceModifier,1/Math.abs(b.dot(m,this._tmpRayDir.direction)))*p,h.zoomMinDistanceModifier,h.zoomMaxDistanceModifier);if(f===h.NavigationMode.Horizontal){e=.6**e;this._sphere[3]=b.length(g);b.subtract(this._tmpViewDir,a.center,a.eye);d=Math.min(b.length(this._tmpViewDir),r);f=d*e;1>=e&&4>f&&(f=4,e=f/d);if(1E-6>
Math.abs(d-f))return;d=b.length(a.center);this._sphere[3]!==d&&(a.center=b.scale(n,a.center,(this._sphere[3]+e*(d-this._sphere[3]))/d));b.scale(this._tmpViewDir,this._tmpViewDir,-e);a.eye=b.add(n,a.center,this._tmpViewDir);z.applyAll(this.view,a,this._constraintOptions);1E-12<b.squaredDistance(g,a.center)&&G.intersectScreen(this._sphere,a,c,this._targetOnSphere)&&h.panToPosition(this._sphere,a,g,this._targetOnSphere,this.view.camera.heading,this.view.camera.tilt,!0)}else{f=.6**Math.abs(e);p=0<e?1:
-1;b.subtract(this._tmpViewDir,g,a.eye);const J=b.length(this._tmpViewDir);c=this.view._stage.renderView.getMinimalDepthForArea(null,c[0],c[1],this.view.state.camera,60);c=null!=c?c:r;c=d&&0<e?Math.min(c,J):c;b.scale(this._tmpRayDir.direction,this._tmpRayDir.direction,c);b.add(g,this._tmpRayDir.origin,this._tmpRayDir.direction);g=c*f;d=Math.max(4,1.01*a.nearFar[0]);0<e&&g<d&&(g=d,f=g/c);if(1E-6>Math.abs(c-g))return;b.scale(this._tmpRayDir.direction,this._tmpRayDir.direction,p*(1-f));a.eye=b.add(n,
a.eye,this._tmpRayDir.direction);a.center=b.add(n,a.center,this._tmpRayDir.direction)}D.applySurfaceCollisionConstraint(this.view,a)}};l.ZoomStepControllerGlobal=t.__decorate([w.subclass("esri.views.3d.state.controllers.ZoomStepControllerGlobal")],l.ZoomStepControllerGlobal);const n=k.create(),m=k.create();Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})});