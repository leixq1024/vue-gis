// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.31/esri/copyright.txt for details.
//>>built
define("exports ../../../../chunks/tslib.es6 ../../../../Camera ../../../../core/mathUtils ../../../../core/maybe ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/Logger ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../camera/constraintUtils ../../camera/constraintUtils/ConstraintOptions ../../camera/constraintUtils/ConstraintTypes ../../camera/constraintUtils/InteractionType ./InteractiveController ../utils/navigationUtils ../../../ui/Component ../../../../widgets/FovOverlay".split(" "),
function(e,l,n,f,p,q,B,C,D,r,c,g,m,t,u,v,w,x,y,z){e.FovController=class extends w.InteractiveController{constructor(a){super(a);this.onStop=null;this._timeOutId=void 0;this._onReset=()=>{this._startSize=this._lastDrag=null;this._setFov(A);this.updateTimeout()};this._center=g.create();this._viewForward=g.create();this._constraints=new t.ConstraintOptions(u.ConstraintTypes.ALL,v.InteractionType.ZOOM)}begin(a){Array.isArray(a)?(this._lastDrag=a[1],this._startSize=null,this._ensureStartSize(this.view.state.camera)):
this._showOverlay().fov=a.fov}updateTimeout(){clearTimeout(this._timeOutId);this._timeOutId=setTimeout(this.onStop,1500)}update(a){if(null==this._lastDrag)this._lastDrag=a[1],this._startSize=null,this._ensureStartSize(this.view.state.camera);else{var b=-(this._lastDrag-a[1])/2;this._lastDrag=a[1];this.step(b)}}step(a){if(this.running){var b=this.currentCamera.copyFrom(this.view.state.camera);a=f.rad2deg(b.fov)+a;a=f.deg2rad(f.clamp(a,10,150));a===b.fov?this._showOverlay().fov=b.fov:this._setFov(a)}else this._startSize=
this._lastDrag=null}finish(){this.running&&(this._startSize=this._lastDrag=null,this.finishController())}destroy(){this.hideOverlay()}onControllerEnd(a){super.onControllerEnd(a);this._startSize=this._lastDrag=null;this.hideOverlay()}_showOverlay(){this._overlay||(this._overlay=new y({id:"esri.FovOverlay",node:new z.FovOverlay({onReset:this._onReset})}),this.view.ui.add(this._overlay));return this._overlay.widget}hideOverlay(){this._overlay&&(this.view.ui.remove(this._overlay),this._overlay=p.destroyMaybe(this._overlay))}_setFov(a){const b=
this.view.state,d=this.currentCamera.copyFrom(b.camera);var h=this._ensureStartSize(d)/Math.tan(a/2);h=c.add(k,this._center,c.scale(k,this._viewForward,-h));d.eye=h;d.fov=a;this._constraints.interactionStartCamera=b.camera;this._constraints.interactionFactor=m.pixelDistanceToInteractionFactor(this.currentCamera.height-b.camera.height);m.applyAll(this.view,this.currentCamera,this._constraints);this.begin(d);this.commitCamera()}_ensureStartSize(a){if(null==this._startSize){c.copy(this._viewForward,
a.viewForward);var b=this.view._stage.renderView.getMinimalDepthForArea(null,a.fullWidth/a.pixelRatio*.5,a.fullHeight/a.pixelRatio*.5,a,x.screenPixelArea);const d=c.distance(a.eye,this.view.pointsOfInterest.centerOnContent.renderLocation);b=b??d;c.add(this._center,a.eye,c.scale(k,this._viewForward,b));this._startSize=b*Math.tan(a.fov/2)}return this._startSize}};l.__decorate([q.property()],e.FovController.prototype,"onStop",void 0);e.FovController=l.__decorate([r.subclass("esri.views.3d.state.controllers.FovController")],
e.FovController);const A=f.deg2rad((new n).fov),k=g.create();Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})});