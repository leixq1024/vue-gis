// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.31/esri/copyright.txt for details.
//>>built
define(["exports","../../../core/PooledArray","./RenderOrder","./terrainUtils"],function(e,k,r,l){function h(a,b){b(a);if(!a.leaf)for(const c of a.children)h(c,b)}function m(a,b){a=a.lij;b=b.lij;return a[0]-b[0]||a[1]-b[1]||a[2]-b[2]}function t(a,b){const c=b.screenDepth-a.screenDepth;if(0!==c)return c;a=a.lij;b=b.lij;return a[0]-b[0]||a[1]-b[1]||a[2]-b[2]}function u(a,b){const c=a.screenDepth-b.screenDepth;if(0!==c)return c;a=a.lij;b=b.lij;return a[0]-b[0]||a[1]-b[1]||a[2]-b[2]}function n(a,b,c){const d=
a.screenDepth,f=b.screenDepth;return d<f?-c:d>f?c:m(a,b)}function p(a,b,c,d){const f=q(a,d);d=q(b,d);return f===d?n(a,b,c):a?c:-c}function q(a,b){for(const c of b)if(a.intersectsExtent(c))return!0;return!1}function v(a,b){const c=a.distanceToPOI-b.distanceToPOI;if(0!==c)return c;a=a.lij;b=b.lij;return a[0]-b[0]||a[1]-b[1]||a[2]-b[2]}class w{constructor(){this._queue=new k;this.remove=()=>{}}get done(){return 0===this._queue.length&&(!this._last||this._last.leaf)}resetOne(a){this._queue.clear();this._queue.push(a);
this._last=void 0}reset(a=null){this._queue.clear();null!=a&&this._queue.pushArray(a);this._last=void 0}skipSubtree(){this._last=void 0}next(){const a=this._last?.children;a?.[0]&&this._queue.pushArray(a);return this._last=this._queue.pop()}}class x{constructor(){this._q=new k}get done(){return 0===this._q.length}reset(a){this._q.clear();if(null!=a)for(this._q.pushArray(a),a=0;a<this._q.length;++a){const b=this._q.data[a];b.leaf||this._q.pushArray(b.children)}}next(){return this._q.pop()}}e.IteratorPostorder=
x;e.IteratorPreorder=w;e.compareTiles=n;e.compareTilesByLij=m;e.compareTilesWithStencil=p;e.computeUpsampleInfo=function(a,b,c){let d=1,f=0,g=0;for(;a!==b;)if(d*=.5,f*=.5,g*=.5,a.lij[2]&1&&(f+=.5),0===(a.lij[1]&1)&&(g+=.5),a=a.parent,null==a)throw Error("tile was not a descendant of upsampleTile");c.init(b,f,g,d)};e.fallsWithinLayerView=function(a,b){if(null==b)return!1;b=l.isImageryTileLayerView(b)?{fullExtent:b.fullExtent,minScale:b.layer.minScale,maxScale:b.layer.maxScale}:b.layer;if(null==b?.fullExtent)return!1;
var c=b.fullExtent;const d=a.extent;if(c.xmin>d[2]||c.ymin>d[3]||c.xmax<d[0]||c.ymax<d[1])return!1;a=a.surface.tilingScheme.levels[a.level].scale;c=b.minScale;if(0<c&&a>1.00000001*c)return!1;b=b.maxScale;return 0<b&&a<.99999999*b?!1:!0};e.getTileMapCache=function(a){return!l.isImageryTileLayerView(a)&&a.layer&&"tilemapCache"in a.layer?a.layer.tilemapCache:null};e.hasLoadableSiblings=function(a){for(let b=0;b<a.length;b++){const c=a[b],d=c.parent;if(d)for(let f=0;4>f;f++){const g=d.children[f];if(g&&
g!==c)return!0}}return!1};e.sortTiles=function(a,b,c=null){null==c||0===c.length?a===r.RenderOrder.BACK_TO_FRONT?b.sort(t):b.sort(u):b.sort((d,f)=>p(d,f,a,c))};e.sortTilesByPOI=function(a,b){const c=a.length;for(let d=0;d<c;++d)a.at(d).updateDistanceToPOI(b);a.sort(v)};e.tilesAreRelated=function(a,b){if(!a||!b||a[0]===b[0])return!1;const c=a[0]<b[0],d=c?a:b;a=c?b:a;b=1<<a[0]-d[0];return Math.floor(a[1]/b)===d[1]&&Math.floor(a[2]/b)===d[2]};e.traverseTilesPreorder=function(a,b){if(Array.isArray(a))for(let c=
0;c<a.length;c++)h(a[c],b);else h(a,b)};Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})});