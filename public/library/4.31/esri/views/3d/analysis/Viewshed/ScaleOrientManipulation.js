// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.31/esri/copyright.txt for details.
//>>built
define("exports ../../../../core/Handles ../../../../core/mathUtils ../../../../core/libs/gl-matrix-2/math/mat4 ../../../../core/libs/gl-matrix-2/factories/mat4f64 ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../chunks/boundedPlane ../../../../geometry/support/ray ../Slice/sliceToolConfig ./ArrowManipulator ./ViewshedConfiguration ./viewshedToolUtils ../../interactive/editingTools/dragEventPipeline3D ../../interactive/editingTools/ManipulatorType ../../interactive/editingTools/manipulations/config ../../interactive/editingTools/manipulations/InteractiveManipulation ../../../interactive/dragEventPipeline".split(" "),
function(D,I,J,d,l,e,w,E,K,L,x,y,z,M,k,F,N,r){class O extends N.InteractiveManipulation{constructor(a){super();this._handles=new I;this._tool=a.tool;this._view=a.view;a=y.viewshedToolManipulatorConfiguration.scaleOrientHandleRadius;this._manipulatorHeading=new x.ArrowManipulator(this._view,a);this._manipulatorTilt=new x.ArrowManipulator(this._view,a);this._manipulatorDistance=new x.ArrowManipulator(this._view,a);this.forEachManipulator(b=>this._tool.manipulators.add(b))}destroy(){this._handles.destroy();
this.forEachManipulator(a=>{this._tool.manipulators.remove(a);a.destroy()});this._view=this._tool=this._manipulatorDistance=this._manipulatorTilt=this._manipulatorHeading=null}createHeadingDragPipeline(a,b){return r.createManipulatorDragEventPipeline(this._manipulatorHeading,(f,g,m,c,h)=>{c=this._view;const {tiltParallelToSurface:n,farDistanceRenderSpace:t,upVector:p,observerRenderSpace:u,targetRenderSpace:A,rightVector:P}=b;h=Math.sin(J.deg2rad(n))*t;h=e.add(v,u,e.scale(B,p,h));const G=e.sub(B,A,
h),R=e.scale(Q,P,e.len(G));h=E.fromValues(h,G,R);g=z.screenToCircleAngle(g,c,h,b).next(S=>({...S,manipulatorType:k.ManipulatorType.ROTATE}));a(f,g,m)})}createTiltDragPipeline(a,b){return r.createManipulatorDragEventPipeline(this._manipulatorTilt,(f,g,m,c,h)=>{const {observerRenderSpace:n,farDistanceRenderSpace:t,upVector:p,targetDirection:u}=b;c=e.dot(u,p);c=e.scaleAndAdd(v,u,p,-c);e.scale(c,e.normalize(c,c),t);h=e.scale(B,p,t);c=E.fromValues(n,c,h);g=z.screenToCircleAngle(g,this._view,c,b).next(A=>
({...A,manipulatorType:k.ManipulatorType.ROTATE}));a(f,g,m)})}createDistanceDragPipeline(a,b){return r.createManipulatorDragEventPipeline(this._manipulatorDistance,(f,g,m,c,h)=>{c=K.fromValues(b.observerRenderSpace,b.targetDirection);g=g.next(r.dragAtLocation(this._view,f.location)).next(M.screenToRenderRay(this._view,c)).next(n=>({...n,manipulatorType:k.ManipulatorType.SCALE}));a(f,g,m)})}updateManipulators(a){var {targetRenderSpace:b}=a;this._manipulatorHeading.renderLocation=b;this._manipulatorTilt.renderLocation=
b;this._manipulatorDistance.renderLocation=b;b=l.create();const f=F.discRadiusSmall/F.discRadius*y.viewshedToolManipulatorConfiguration.scaleOrientSize;d.multiply(b,d.fromScaling(q,e.set(v,f,f,f)),b);d.multiply(b,z.getViewshedRotationMatrix(a,q),b);a=e.scale(v,a.targetDirection,y.viewshedToolManipulatorConfiguration.scaleOrientHandleRadius*L.displayFocusMultiplier*f);d.multiply(b,d.fromTranslation(q,a),b);a=d.fromZRotation(q,-C);d.mul(a,a,d.fromYRotation(H,-C));this._manipulatorHeading.modelTransform=
d.mul(l.create(),b,a);a=d.fromYRotation(q,C);d.mul(a,a,d.fromZRotation(H,Math.PI));this._manipulatorTilt.modelTransform=d.multiply(l.create(),b,a);this._manipulatorDistance.modelTransform=b}forEachManipulator(a){a(this._manipulatorHeading,k.ManipulatorType.ROTATE);a(this._manipulatorTilt,k.ManipulatorType.ROTATE);a(this._manipulatorDistance,k.ManipulatorType.SCALE)}}const q=l.create(),H=l.create(),v=w.create(),B=w.create(),Q=w.create(),C=Math.PI/2;D.ScaleOrientManipulation=O;Object.defineProperty(D,
Symbol.toStringTag,{value:"Module"})});