// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.31/esri/copyright.txt for details.
//>>built
define("exports ../../../../core/mathUtils ../../../../core/libs/gl-matrix-2/math/mat4 ../../../../core/libs/gl-matrix-2/factories/mat4f64 ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../geometry/support/plane ./ViewshedConfiguration ../../interactive/manipulatorUtils ../../interactive/editingTools/dragEventPipeline3D ../../support/cameraUtils ../../support/cameraUtilsInternal".split(" "),function(h,n,B,C,c,e,p,D,u,v,E,F){function G(a,d){const b=w;a.renderCoordsHelper.toRenderCoords(a.camera.position,
b);a=E.headingTiltToDirectionUp(a,b,a.camera.heading,a.camera.tilt,F.createDirectionUp()).direction;return n.rad2deg(c.angle(a,d))-90}const w=e.create(),H=e.create(),x=e.create(),I=e.create(),y=C.create();h.getViewshedRotationMatrix=function({tiltedUpVector:a,rightVector:d,observerRenderSpace:b},f){a=u.calculateTranslateRotateFromBases(a,d,b,f);a[12]=0;a[13]=0;a[14]=0;return a};h.rotateBy=function(a,d,b,f){B.fromRotation(y,b,f);return c.transformMat4(a,d,y)};h.screenToCircleAngle=function(a,d,b,f){const z=
e.create(),A=p.getNormal(b.plane);var q=G(d,A);if(Math.abs(q)>D.viewshedToolManipulatorConfiguration.viewAngleThreshold)a=a.next(v.screenToRenderPlane(d,b.plane));else{q=p.fromPositionAndNormal(f.targetRenderSpace,b.basis1,p.create());const g=c.normalize(w,b.basis1),k=c.normalize(H,b.basis2);a=a.next(v.screenToRenderPlane(d,q)).next(r=>{var m=l=>{l=c.dot(c.sub(x,l,b.origin),k);var t=Math.acos(n.clamp(l/f.farDistanceRenderSpace,-1,1));t=Math.sin(t)*f.farDistanceRenderSpace;return c.add(e.create(),
b.origin,c.add(e.create(),c.scale(x,g,t),c.scale(I,k,l)))};const J=m(r.renderStart);m=m(r.renderEnd);return{...r,renderStart:J,renderEnd:m}})}return a.next(g=>{"start"===g.action&&c.copy(z,g.renderStart);const k=n.rad2deg(u.calculateInputRotationTransform(z,g.renderEnd,b.origin,A));return{...g,deltaAngle:k}})};Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})});