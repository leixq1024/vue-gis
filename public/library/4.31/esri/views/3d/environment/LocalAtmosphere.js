// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.31/esri/copyright.txt for details.
//>>built
define("exports ../../../chunks/tslib.es6 ../../../core/maybe ../../../core/reactiveUtils ../../../core/Logger ../../../core/has ../../../core/RandomLCG ../../../core/Error ../../../core/accessorSupport/decorators/subclass ../../../core/libs/gl-matrix-2/math/mat4 ../../../core/libs/gl-matrix-2/factories/mat4f64 ../webgl ../../../chunks/SimpleAtmosphere.glsl ./SimpleAtmosphereTechnique ./SimpleAtmosphereTechniqueConfiguration ./resources/SimpleAtmosphereTexture ../support/buffer/glUtil ../support/buffer/InterleavedLayout ../webgl-engine/effects/OpaqueEnvironment ../webgl-engine/lib/basicInterfaces ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/GeometryUtil ../webgl-engine/lib/VertexArrayObject ../webgl-engine/lib/VertexAttribute ../../webgl/BufferObject ../../webgl/enums ../../webgl/Texture ../../webgl/TextureDescriptor ../../webgl/Util".split(" "),
function(g,t,l,m,O,P,Q,R,u,v,w,x,y,n,p,z,A,B,C,D,E,F,G,H,I,h,J,K,L){function M(a){var c=F.createPolySphereData(1,2,!1);const {data:e,indices:b}=c[0][1];c=q.createBuffer(b.length);const f=c.position;for(let d=0;d<b.length;++d){const k=3*b[0===d%3?d+2:2===d%3?d-2:d];f.set(d,0,e[k]);f.set(d,1,e[k+1]);f.set(d,2,e[k+2])}return new G.VertexArrayObject(a,E.Default3D,new Map([["geometry",A.glLayout(q)]]),new Map([["geometry",I.BufferObject.createVertex(a,h.Usage.STATIC_DRAW,c.buffer)]]))}function N(a,c){v.copy(a,
c);a[12]=0;a[13]=0;a[14]=0;a[15]=1}g.LocalAtmosphere=class extends C.OpaqueEnvironment{constructor(a){super(a);this._configuration=new p.SimpleAtmosphereTechniqueConfiguration;this._passParameters=new y.SimpleAtmospherePassParameters;this._vao=null;this._vaoCount=0;({techniques:a}=a);this._configuration.geometry=p.SimpleAtmosphereGeometry.Cylinder;a.precompile(n.SimpleAtmosphereTechnique,this._configuration)}initialize(){this.addHandles([m.watch(()=>this.view.environment.atmosphereEnabled,a=>a?this._enable():
this._disable(),m.initial)])}destroy(){this._passParameters.texture=l.disposeMaybe(this._passParameters.texture);this._vao=l.disposeMaybe(this._vao)}render(a){a=a.find(({name:f})=>f===x.InternalRenderCategory.OPAQUE_ENVIRONMENT);const c=this.techniques.acquire(n.SimpleAtmosphereTechnique,this._configuration);if(!c.compiled)return c.release(),this.requestRender(D.RenderRequestType.UPDATE),a;const e=this.renderingContext;this._vao||(this._vao=M(e),this._vaoCount=L.vertexCount(this._vao,"geometry"));
if(!this._passParameters.texture){var b=new K.TextureDescriptor;b.wrapMode=h.TextureWrapMode.CLAMP_TO_EDGE;b.flipped=!0;b.width=1;b.height=512;this._passParameters.texture=new J.Texture(e,b,z.earthAtmosphereTextureSimple)}b=e.bindTechnique(c,this.bindParameters,this._passParameters);N(r,this.bindParameters.camera.viewMatrix);b.setUniformMatrix4fv("view",r);e.bindVAO(this._vao);b.assertCompatibleVertexAttributeLocations(this._vao);e.drawArrays(h.PrimitiveType.TRIANGLES,0,this._vaoCount);c.release();
return a}};g.LocalAtmosphere=t.__decorate([u.subclass("esri.views.3d.environment.LocalAtmosphere")],g.LocalAtmosphere);const r=w.create(),q=B.newLayout().vec3f(H.VertexAttribute.POSITION);Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})});