// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.31/esri/copyright.txt for details.
//>>built
define("exports ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/aaBoundingRect ./graphicUtils ../../webgl-engine/lib/basicInterfaces ../../webgl-engine/lib/ModelDirtyTypes".split(" "),function(m,r,n,e,t,u,p,k){class v{constructor(a,b,g,l){this.graphics3DSymbolLayer=a;this.renderGeometries=b;this.boundingBox=g;this._drapeSourceRenderer=l;this.type="draped";this.stage=null;this.isElevationSource=this._addedToStage=
this._visible=!1}initialize(a){this.stage=a.stage}setVisibility(a){if(null!=this.stage&&this._visible!==a)if((this._visible=a)&&!this._addedToStage)this._addedToStage=!0,this._drapeSourceRenderer.addGeometries(this.renderGeometries,k.DirtyOperation.ADD);else if(a||this._addedToStage){for(const b of this.renderGeometries)b.visible=this._visible;this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,k.DirtyState.VISIBILITY)}}destroy(){this.stage&&this._addedToStage&&this._drapeSourceRenderer.removeGeometries(this.renderGeometries,
k.DirtyOperation.REMOVE);this._visible=this._addedToStage=!1;this.stage=null}getCenterObjectSpace(a=n.create()){return r.set(a,0,0,0)}getBoundingBoxObjectSpace(a=e.create()){return e.empty(a)}addObjectState(a){a.stateType===p.Object3DState.Highlight&&(this.renderGeometries.forEach(b=>{const g=b.geometry.allocateIdAndHighlight(a.highlightGroupName);a.addRenderGeometry(b,g,this)}),this._addedToStage&&this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,k.DirtyState.HIGHLIGHT))}removeObjectState(a){this.renderGeometries.forEach(b=>
a.removeByObject(b))}removeRenderGeometryObjectState(a,b){b.channel===p.Object3DState.Highlight&&(a.geometry.removeHighlight(b),this._addedToStage&&this._drapeSourceRenderer.modifyGeometries([a],k.DirtyState.HIGHLIGHT))}computeAttachmentOrigin(a){for(const b of this.renderGeometries)b.geometry.computeAttachmentOrigin(h)&&(a.draped.origin[0]+=h[0],a.draped.origin[1]+=h[1],a.draped.num++)}async getProjectedBoundingBox(a,b,g,l,c){e.empty(c);for(let f=0;f<this.renderGeometries.length;f++)this._getRenderGeometryProjectedBoundingRect(this.renderGeometries[f],
a,q,g),e.expandWithRect(c,q);if(b){e.center(c,h);let f;a=u.demResolutionForBoundingBox(c,b.service.spatialReference,b);try{f=await b.service.queryElevation(h[0],h[1],l,a,"ground")}catch(w){}null!=f&&(c[2]=Math.min(c[2],f),c[5]=Math.max(c[5],f))}return c}_getRenderGeometryProjectedBoundingRect(a,b,g,l){if(this.boundingBox)e.set(d,this.boundingBox);else{a=a.boundingSphere;const c=a[3];d[0]=a[0]-c;d[1]=a[1]-c;d[2]=a[2]-c;d[3]=a[0]+c;d[4]=a[1]+c;d[5]=a[2]+c}b(d,0,2);this.calculateRelativeScreenBounds&&
l.push({location:e.center(d),screenSpaceBoundingRect:this.calculateRelativeScreenBounds()});return e.toRect(d,g)}}const q=t.create(),d=e.create(),h=n.create();m.Graphics3DDrapedGraphicLayer=v;Object.defineProperty(m,Symbol.toStringTag,{value:"Module"})});