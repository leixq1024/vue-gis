// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.31/esri/copyright.txt for details.
//>>built
define("require exports ../../../../core/maybe ../../../../core/promiseUtils ../../glTF/DefaultLoadingContext ./wosrLoader".split(" "),function(n,l,p,k,q,r){async function m(a,g,b,e,f){k.throwIfAborted(f);const h=k.onAbort(f,()=>{{const c=a.get(b);null!=c&&0<--c.refCount||(a.delete(b),null!=c&&c.abortController.abort())}});var d=a.get(b);d?d.refCount++:(d=new AbortController,e=e({...f,signal:d.signal}),d={refCount:1,abortController:d,promise:e},a.set(b,d));try{const c=await d.promise;g.put(b,c,c.size);
a.delete(b);k.throwIfAborted(f);return c}finally{p.removeMaybe(h)}}class t{constructor(a){this._gltfLoading=new Map;this._wosrLoading=new Map;this._gltfMemCache=a("gltf-resources",()=>{});this._wosrMemCache=a("wosr-resources",()=>{})}destroy(){this._gltfLoading.forEach(a=>a.abortController.abort());this._wosrLoading.forEach(a=>a.abortController.abort());this._gltfMemCache.destroy();this._wosrMemCache.destroy()}loadGLTF(a,g,b){const e=b?`gltfPBR:${a}`:`gltf:${a}`,f=this._gltfMemCache.get(e);return null!=
f?Promise.resolve(f):m(this._gltfLoading,this._gltfMemCache,e,async h=>{const {loadGLTF:d}=await new Promise((c,u)=>n(["../../glTF/loader"],c,u));return d(new q.DefaultLoadingContext(h.streamDataRequester),a,h,b)},g)}loadWOSR(a,g){const b=`wosr:${a}:${g.disableTextures}`,e=this._wosrMemCache.get(b);return null!=e?Promise.resolve(e):m(this._wosrLoading,this._wosrMemCache,b,f=>r.load(a,f),g)}}l.ObjectResourceCache=t;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})});