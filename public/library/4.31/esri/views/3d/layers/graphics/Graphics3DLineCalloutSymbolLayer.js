// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.31/esri/copyright.txt for details.
//>>built
define("exports ../../../../Color ../../../../core/screenUtils ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../core/libs/gl-matrix-2/factories/vec4f64 ../../../../symbols/callouts/calloutUtils ./ElevationAligners ./elevationAlignmentUtils ./ElevationContext ./Graphics3DGraphicCreationContext ./Graphics3DObject3DGraphicLayer ./Graphics3DObjectMetadata ./Graphics3DSymbolLayer ./graphicUtils ./pointUtils ./SymbolComplexity ../../webgl-engine/lib/Attribute ../../webgl-engine/lib/ContentObjectType ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/VertexAttribute ../../webgl-engine/materials/LineCalloutMaterial".split(" "),
function(n,w,x,A,y,B,C,g,D,E,F,G,H,I,z,J,h,K,L,q,k){class r extends H.Graphics3DSymbolLayer{constructor(a,b){super(a,null,b,M);this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1};this.ensureDrapedStatus(!1)}async doLoad(){this._materials[0]=new k.LineCalloutMaterial(this._materialParameters,this._context.spherical);this._context.stage.add(this._materials[0])}destroy(){super.destroy();this._context.stage.remove(this._materials[0]);this._materials.length=0}_perInstanceMaterialParameters(a){const b=
this._materialParameters;b.horizontalScreenOffset=a.horizontalScreenOffset??0;b.centerOffsetUnits=a.centerOffsetUnits||"world";return b}get _materialParameters(){const a=new k.Parameters;var b=this.symbol,d=b.callout;if(d.color){const c=w.toUnitRGBA(d.color);c[3]*=this._getLayerOpacity();a.color=c}else a.color=y.ZEROS;a.size=x.pt2px(d.size||0);if(b.verticalOffset){const {screenLength:c,minWorldLength:f,maxWorldLength:e}=b.verticalOffset;a.verticalOffset={screenLength:x.pt2px(c),minWorldLength:f||
0,maxWorldLength:null!=e?e:Infinity}}a.borderColor=null!=d.border?.color?w.toUnitRGBA(d.border.color):null;d="object"===b.symbolLayers.at(0).type;b="label-3d"===b.type;a.occlusionTest=!d;a.shaderPolygonOffset=d?0:void 0;a.hudDepthAlignStart=b;a.hasSlicePlane=this._context.slicePlaneEnabled;a.screenSizePerspective=this._context.screenSizePerspectiveEnabled?this._context.sharedResources.screenSizePerspectiveSettings:null;return a}_defaultElevationInfoNoZ(){return N}createGraphics3DGraphic(a){const b=
a.renderingInfo;a=a.graphic;const d=this.setGraphicElevationContext(a,new D.ElevationContext,b.elevationOffset||0);var c=b.symbol;const f="on-the-ground"===this._elevationContext.mode&&("cim"===c.type||!c.symbolLayers.some(e=>"object"===e.type||"text"===e.type));if("label-3d"!==c.type&&f||"point-3d"===c.type&&c.symbolLayers.every(e=>"text"===e.type&&!B.textSymbolLayerSupportsVerticalOffset(e)))return null;c=I.computeCentroid(a.geometry);return null==c?null:this._createAs3DShape(c,d,b,a.uid)}layerOpacityChanged(){this._materials[0]?.setParameters(this._materialParameters)}layerElevationInfoChanged(a,
b,d){d=g.elevationModeChangeUpdateType(r.elevationModeChangeTypes,d,this._elevationContext.mode);if(d!==g.SymbolUpdateType.UPDATE)return d;a.forEach(c=>{const f=b(c);null!=f&&this.updateGraphicElevationContext(c.graphic,f)});return d}slicePlaneEnabledChanged(){this._materials[0]?.setParameters({hasSlicePlane:this._context.slicePlaneEnabled});return!0}physicalBasedRenderingChanged(){return!0}setGraphicElevationContext(a,b,d=0){super.setGraphicElevationContext(a,b);b.addOffsetRenderUnits(d);return b}updateGraphicElevationContext(a,
b){this.setGraphicElevationContext(a,b.elevationContext,null!=b.metadata?b.metadata.elevationOffset:0);b.needsElevationUpdates=g.needsElevationUpdates2D(b.elevationContext.mode)}computeComplexity(){return new J.SymbolComplexity({verticesPerFeature:6})}_getOrCreateMaterial(a){const b=this._perInstanceMaterialParameters(a),d=k.uniqueMaterialIdentifier(b);if(d===this._materials[0]?.uniqueMaterialIdentifier)return{material:this._materials[0],isUnique:!1};if(null!=a.materialCollection){let c=a.materialCollection.get(d);
null==c&&(c=new k.LineCalloutMaterial(b,this._context.spherical),a.materialCollection.add(d,c));return{material:c,isUnique:!1}}return{material:new k.LineCalloutMaterial(b,this._context.spherical),isUnique:!0}}_createAs3DShape(a,b,d,c){var f=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:c,layerUid:this._context.layer.uid}),e=this._getOrCreateMaterial(d),t=L.Geometry,u=e.material;const {translation:p,centerOffset:l}=d;var v=p?new h.Attribute([p[0],p[1],p[2]],m,3,!0):new h.Attribute([0,
0,0],m,3,!0);const O=l?new h.Attribute([l[0],l[1],l[2],l[3]],m,4,!0):new h.Attribute([0,0,0,1],m,4,!0);v=[[q.VertexAttribute.POSITION,v],[q.VertexAttribute.NORMAL,new h.Attribute([0,0,1],m,3,!0)],[q.VertexAttribute.CENTEROFFSETANDDISTANCE,O]];f=new t(u,v,null,K.ContentObjectType.Point,f);c=z.createStageObject(this._context,a,f,b,c);if(null==c)return null;e=new F.Graphics3DObject3DGraphicLayer(this,c.object,[f],e.isUnique?[e.material]:null,null,C.perObjectElevationAligner,b);e.metadata=new G.Graphics3DObjectMetadata(d.elevationOffset);
e.alignedSampledElevation=c.sampledElevation;e.needsElevationUpdates=g.needsElevationUpdates2D(b.mode);z.extendPointGraphicElevationContext(e,a,this._context.elevationProvider);return e}}r.elevationModeChangeTypes={definedChanged:g.SymbolUpdateType.UPDATE,staysOnTheGround:g.SymbolUpdateType.UPDATE,onTheGroundChanged:g.SymbolUpdateType.RECREATE};const m=[0],N={mode:"relative-to-ground",offset:0},M={ignoreDrivers:!0,renderPriority:0,renderPriorityStep:1};class P{constructor(a,b,d=A.create(),c=y.create(),
f=0,e="world",t=0,u=null){this.renderer=a;this.symbol=b;this.translation=d;this.centerOffset=c;this.horizontalScreenOffset=f;this.centerOffsetUnits=e;this.elevationOffset=t;this.materialCollection=u}}class Q extends E.Graphics3DGraphicCreationContext{}n.Graphics3DLineCalloutSymbolLayer=r;n.LineCalloutCreationContext=Q;n.LineCalloutSymbolLayerRenderingInfo=P;Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})});