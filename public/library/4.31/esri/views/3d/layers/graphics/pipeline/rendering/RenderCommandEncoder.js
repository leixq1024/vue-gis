// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.31/esri/copyright.txt for details.
//>>built
define("exports ../../../../../../geometry/support/Indices ./FeaturePipelineRenderManager ./RenderGeometryBufferWriter ../../../../webgl-engine/lib/BoundingInfo ../../../../webgl-engine/lib/VertexAttribute ../../../../webgl-engine/materials/DefaultMaterial".split(" "),function(g,l,m,h,n,k,p){class q{constructor(b){this._context=b;this._commands=[];this._transferables=new Set}createMaterial(b){const a=this._context,d=a.generateId("material");switch(b){case "default":var c=new p.DefaultMaterial({},
{spherical:this._context.globalViewingMode,doublePrecisionRequiresObfuscation:!0});c=new h.RenderGeometryBufferWriter(c);a.registerRenderGeometryBufferWriter(d,c);break;case "hud":c=m.createHudMaterial(null,this._context.globalViewingMode)[0],c=new h.RenderGeometryBufferWriter(c),a.registerRenderGeometryBufferWriter(d,c)}this._commands.push({id:"create-material",type:b,materialId:d});return d}createDirectRenderer(b){const a=this._context.generateId("material-renderer");this._commands.push({id:"create-direct-renderer",
materialRendererId:a,materialId:b});return a}addDirectRendererGeometry(b,a,d){const c=a.materialId,e=this._context.getRenderGeometryBufferWriter(c);if(null==e)throw Error(`no bufferwriter found for material ${c}`);a=e.createBuffer(a,d);this._transferables.add(a.data);this._commands.push({id:"add-direct-renderer-geometry",renderGeometryId:b,materialId:c,renderGeometryBuffer:a,localOrigin:d})}removeDirectRendererGeometry(b){this._commands.push({id:"remove-direct-renderer-geometry",renderGeometryId:b})}createLodRenderer(b){const a=
this._context.generateId("lod-renderer");b={levels:b.levels.map(d=>({components:d.components.map(c=>{var e=c.attributes.get(k.VertexAttribute.POSITION);if(!e||0===e.indices.length)throw Error("positions attribute expected");var f=l.getContinuousIndexArray(e.indices.length/3);e=new n.BoundingInfo(f,3,e);f=this._context.getRenderGeometryBufferWriter(c.materialId);if(null==f)throw Error("writer not found");f=f.createBuffer(c,null);this._transferables.add(f.data);return{materialId:c.materialId,renderGeometryBuffer:f,
boundingInfo:{bbMax:e.bbMax,bbMin:e.bbMin}}}),minScreenSpaceRadius:d.minScreenSpaceRadius}))};this._commands.push({id:"create-lod-renderer",lodRendererId:a,lodRenderGeometry:b});return a}addLodInstances(b,a){this._commands.push({id:"add-lod-instances",lodRendererId:b,data:a});this._transferables.add(a.featureIds.buffer);this._transferables.add(a.globalTransforms.buffer);this._transferables.add(a.localTransforms.buffer)}removeLodInstances(b,a){this._commands.push({id:"remove-lod-instances",lodRendererId:b,
featureIds:a});this._transferables.add(a.buffer)}async dispatch(){const b=this._commands,a=Array.from(this._transferables);this._clearCommandBuffer();this._context.dispatchRenderCommands(b,a)}_clearCommandBuffer(){this._commands=[];this._transferables.clear()}}Object.defineProperty(g,"VertexAttribute",{enumerable:!0,get:()=>k.VertexAttribute});g.RenderCommandEncoder=q;Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})});