// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.31/esri/copyright.txt for details.
//>>built
define("exports ../../../../../../chunks/tslib.es6 ../../../../../../core/accessorSupport/decorators/property ../../../../../../core/has ../../../../../../core/Logger ../../../../../../core/RandomLCG ../../../../../../core/accessorSupport/decorators/subclass ../../../../support/buffer/glUtil ../../../../webgl-engine/core/shaderLibrary/ShaderOutput ../../../../webgl-engine/effects/RenderPlugin ../../../../webgl-engine/lib/GLMaterials ../../../../webgl-engine/lib/RenderSlot ../../../../webgl-engine/materials/DrawParameters ../../../../webgl-engine/materials/renderers/MergedRenderer".split(" "),
function(e,k,m,w,x,y,n,p,f,q,r,l,t,u){e.DirectRenderer=class extends q.SyncRenderPlugin{constructor(a){super(a);this._hasHighlights=!1;this._glMaterials=null;this._produces=new Map;this._renderGeometries=new Map;this._vaoCache=null;this._drawParameters=new t.DrawParameters;this._bufferWriter=null}get produces(){return this._produces}initialize(){this._bufferWriter=this.material.createBufferWriter();this.material.produces.forEach((a,b)=>{this._produces.set(b,c=>c!==f.ShaderOutput.Highlight&&c!==f.ShaderOutput.ShadowHighlight||
this._hasHighlights?a(c):!1)})}destroy(){this._glMaterials.dispose();const a=this._renderGeometries.keys();for(const b of a)this.removeRenderGeometry(b)}acquireTechniques(a){const b=this.material;if(!b.shouldRender(a))return null;const {output:c,bind:d}=a;return b.produces.get(d.slot)?.(c)&&(c!==f.ShaderOutput.Highlight&&c!==f.ShaderOutput.ShadowHighlight||this._hasHighlights)?this._glMaterials.load(a.rctx,d.slot,c)?.beginSlot(d):null}render(a,b){const c=this._renderGeometries;if(0!==c.size){var {bind:d}=
a,g=d.slot===l.RenderSlot.OCCLUDER_MATERIAL||d.slot===l.RenderSlot.TRANSPARENT_OCCLUDER_MATERIAL?d.slot:null;a=a.rctx;a.runAppleAmdDriverHelper();a.bindTechnique(b,d,this.material.parameters);var v=b.program;for(const [,h]of c)this._drawParameters.origin=h.localOrigin,v.bindDraw(d,this.material.parameters,this._drawParameters),b.ensureAttributeLocations(h.vao),a.bindVAO(h.vao),a.setPipelineState(b.getPipeline(!1,g)),a.drawArrays(b.primitiveType,0,h.numElements)}}initializeRenderContext(a,b){this._glMaterials=
new r.GLMaterials(this.material,a.materials);this._vaoCache=a.renderContext.rctx.getVaoCache(this.material.vertexAttributeLocations,p.glLayout(this._bufferWriter.vertexBufferLayout))}uninitializeRenderContext(){}addRenderGeometry(a,b,c){this.removeRenderGeometry(a);const d=this._bufferWriter.vertexBufferLayout.stride,g=this._vaoCache.newVao(u.sizeForVao(b.data.byteLength));g.vertexBuffers.get("geometry").setSubData(new Uint8Array(b.data),0,0,b.elementCount*d);b={localOrigin:c,vao:g,numElements:b.elementCount};
this._renderGeometries.set(a,b);return b}removeRenderGeometry(a){const b=this._renderGeometries.get(a);null!=b&&(this._vaoCache.deleteVao(b.vao),this._renderGeometries.delete(a))}};k.__decorate([m.property({constructOnly:!0})],e.DirectRenderer.prototype,"material",void 0);e.DirectRenderer=k.__decorate([n.subclass("esri.views.3d.layers.graphics.pipeline.rendering.DirectRenderer")],e.DirectRenderer);Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})});