// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.31/esri/copyright.txt for details.
//>>built
define("exports ../../../../../../core/promiseUtils ../../../../../../geometry/support/aaBoundingRect ../../../../../../rest/query/operations/query ../Tile ../featureSet/PBFPointFeatureSetView".split(" "),function(l,m,n,p,q,r){class t{constructor(c,a,b,d,k){this.spatialReference=c;this.url=b;this.objectIdField=d;this.capabilities=k;const {supportsMaxRecordCountFactor:h,maxRecordCount:g}=this.capabilities.query;b=h?4:1;this._pageSize=Math.min(8E3,(g??8E3)*b);a=a.clone();a.cacheHint=!0;a.resultType=
"tile";a.outSpatialReference=c;a.returnGeometry=!0;a.returnZ=!0;a.maxRecordCountFactor=b;a.num=this._pageSize;a.outFields=[d];this._baseQuery=a}async fetch(c,a){var {spatialReference:b}=this,d=n.toExtent(c.extent,b);b=this._baseQuery.clone();b.geometry=d;d=[];let k=0,h=!1,g=1;for(;!h;){var e=[];for(let f=0;f<g;++f)e.push(this._fetchPage(b,k++,a));e=await Promise.all(e);m.throwIfAborted(a);for(const f of e)e=0!==f.featureCount,h||=!f.exceededTransferLimit||!e,e&&d.push(f);g=Math.min(g+1,4)}return new q.Tile(c,
d)}async _fetchPage(c,a,b){c=c.clone();c.start=a*this._pageSize;a=(await p.executeQueryPBFBuffer(this.url,c,{signal:b})).data;m.throwIfAborted(b);return new r.PBFPointFeatureSetView(a)}}l.Tile3DFetcher=t;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})});