// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.31/esri/copyright.txt for details.
//>>built
define("exports ../../../../core/Error ../../../../core/has ../../../../geometry/SpatialReference ../../../../geometry/support/aaBoundingBox ../../../../core/mathUtils ../../../../geometry/Extent ../../../../geometry/Geometry ../../../../geometry/Multipoint ../../../../geometry/Point ../../../../geometry/Polygon ../../../../geometry/Polyline ../../../../geometry/support/typeUtils ../../../../layers/support/Field ../../../../layers/graphics/dehydratedFeatureComparison".split(" "),function(h,k,q,r,
t,u,v,w,x,y,z,A,B,C,l){class m{constructor(a,b){this.feature=a;this.resolution=b;this.refCount=1}}class n{get isReferenced(){return 0!==this.versions.length}get isSingle(){return 1===this.versions.length&&1===this.versions[0].refCount}constructor(a,b){this._highestResolutionVersion=null;this.versions=[];this.ref(a,b)}ref(a,b){const c=this.feature;(e.oldVersion=c)&&Object.defineProperty(a,"uid",{value:c.uid,configurable:!0});const d=this._highestResolutionVersion;for(var f of this.versions)if(f.resolution===
b){f.refCount++;if((b=d===f&&!l.equals(a,f.feature))||d!==f)f.feature=a;e.newVersion=b?a:c;return e}f=new m(a,b);this.versions.push(f);!d||b<d.resolution?(e.newVersion=a,this._highestResolutionVersion=f):e.newVersion=c;return e}unref(a){const {versions:b}=this;for(let c=0;c<b.length;c++){const d=b[c];if(d.resolution===a)return d.refCount--,g.oldVersion=this.feature,0===d.refCount&&(b[c]=b[b.length-1],--b.length,this._highestResolutionVersion===d&&(this._recalculateHighestResolutionVersion(),g.oldVersion=
d.feature)),g.newVersion=this.feature,g}a=`Unref feature (SR) with no references: ${this.feature?.uid}`;throw new k(a,a,Error().stack?.slice(6));}get feature(){return this._highestResolutionVersion?.feature??null}_recalculateHighestResolutionVersion(){if(0===this.versions.length)this._highestResolutionVersion=null;else{var a=this.versions[0];for(let b=1;b<this.versions.length;b++){const c=this.versions[b];c.resolution<a.resolution&&(a=c)}this._highestResolutionVersion=a}}}class p{get isReferenced(){return 0!==
this._refCount}get isSingle(){return 1===this._refCount}constructor(a){this._feature=a;this._refCount=1}ref(a){++this._refCount;const b=this._feature;(e.oldVersion=b)&&Object.defineProperty(a,"uid",{value:b.uid,configurable:!0});l.equals(b,a)||(this._feature=a);e.newVersion=this._feature;return e}unref(){g.oldVersion=this._feature;var a=this._refCount;if(0<a){if(this._refCount=a-1,1===a)return g.newVersion=null,g}else throw a=`Unref feature (SR) with no references: ${this._feature?.uid}`,new k(a,
a,Error().stack?.slice(6));g.newVersion=this._feature;return g}get feature(){return this._feature}}const g={oldVersion:null,newVersion:null},e={oldVersion:null,newVersion:null};h.FeatureVersion=m;h.MultiFeatureReference=n;h.SingleFeatureReference=p;Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})});