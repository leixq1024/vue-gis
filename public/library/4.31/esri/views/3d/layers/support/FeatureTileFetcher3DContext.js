// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.31/esri/copyright.txt for details.
//>>built
define(["exports","../../../../core/maybe","./featureTileQuery3D"],function(c,e,f){function d(a){const b=a.capabilities.query;a:switch(a.geometryType){case "polyline":a=!0;break a;case "polygon":a=a.capabilities&&a.capabilities.query&&a.capabilities.query.supportsQuantization;break a;default:a=!1}return{supportsMultipleResolutions:a,supportsPagination:!(!b||!b.supportsPagination),supportsResultType:!(!b||!b.supportsResultType),supportsCacheHint:!(!b||!b.supportsCacheHint),supportsQuantization:!(!b||
!b.supportsQuantization),supportsQuantizationEditMode:!(!b||!b.supportsQuantizationEditMode),supportsMaxRecordCountFactor:!(!b||!b.supportsMaxRecordCountFactor),supportsFormatPBF:!(!b||!b.supportsFormatPBF)}}class g{constructor(a){this._memoryCache=null;const b=a.layerView.layer;this._layerView=a.layerView;this.objectIdField=b.objectIdField;this.globalIdField="globalIdField"in b?b.globalIdField:null;this._returnZ=a.returnZ;this._returnM=a.returnM;a=this._layerView.view.resourceController;this.query=
f.createFeatureTileQuery3D(this._layerView,a.normal);a&&this._memoryCacheEnabled&&(this._memoryCache=a.memoryController.newCache(`fl-${b.uid}`))}get _memoryCacheEnabled(){switch(this._layerView.layer.source.type){case "feature-layer":case "ogc-feature":case "oriented-imagery":return!0;case "csv":case "parquet":case "geojson":case "memory":case "wfs":return!1}}destroy(){this._memoryCache=e.destroyMaybe(this._memoryCache);this.query.destroy()}createQuery(){const a=this._layerView.layer.createQuery();
a.outFields=this._layerView.availableFields;a.returnZ=this._returnZ;a.returnM=this._returnM;a.outSpatialReference=this.tilingScheme.spatialReference;return a}get memoryCache(){return this._memoryCache}get viewingMode(){return this._layerView.view.state.viewingMode}get tilingScheme(){return this._layerView.view.featureTiles.tilingScheme}get scheduler(){return this._layerView.view.resourceController?.scheduler}get geometryType(){return this._layerView.layer.geometryType}get fullExtent(){return this._layerView.layer.fullExtent}get tileMaxRecordCount(){return this._layerView.layer.capabilities.query.tileMaxRecordCount}get maxRecordCount(){return this._layerView.layer.capabilities.query.maxRecordCount}get isDraped(){return"on-the-ground"===
this._layerView.layer.elevationInfo?.mode}get capabilities(){this._capabilities??(this._capabilities=d(this._layerView.layer));return this._capabilities}logFetchError(a,b){a.error("#fetchTile()",this._layerView.layer,b?.message??b)}}c.FeatureTileFetcher3DContext=g;c.contextCapabilitiesFromLayer=d;Object.defineProperty(c,Symbol.toStringTag,{value:"Module"})});