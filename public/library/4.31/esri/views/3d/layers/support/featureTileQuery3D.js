// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.31/esri/copyright.txt for details.
//>>built
define("exports ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/SetUtils ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/Logger ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ../../../../layers/graphics/dehydratedFeatures ../../../../rest/query/operations/query ../../support/PBFDecoder".split(" "),function(q,d,l,v,r,w,e,z,A,B,m,t,u,x){let f=class extends l{constructor(a){super(a)}get implicitFields(){if(!this.layer.outFields?.includes("*"))return new Set;
const a=new Set(this.layerView.requiredFields),c=new Set(this.layerView.availableFields);return w.difference(c,a)}get queryFeaturesDehydrated(){const {layer:a}=this;var c=a.capabilities;c=c&&c.query;const b=a.parsedUrl;if(c&&c.supportsFormatPBF){null==this._decoder&&(this._decoder=new x.PBFDecoder(this.controller));const n={sourceSpatialReference:a.spatialReference?.toJSON()??null,applyTransform:!0,maxStringAttributeFields:this.implicitFields,maxStringAttributeLength:1024};return(p,g)=>u.runQuery(b,
p,"pbf",this._createRequestOptions(g)).then(y=>{r.throwIfAborted(g);return null!=this._decoder?this._decoder.invoke({buffer:y.data,options:n},g.signal):Promise.reject(r.createAbortError())})}return(n,p)=>u.executeQuery(b,n,a.spatialReference,this._createRequestOptions(p)).then(g=>t.fromFeatureSetJSON(g.data,{maxStringAttributeFields:this.implicitFields,maxStringAttributeLength:1024}))}queryFeatureCount(a,c){return this.layer.queryFeatureCount(a,c)}destroy(){this._decoder=v.destroyMaybe(this._decoder)}_createRequestOptions(a){return{...a,
query:{...this.layer.customParameters,token:this.layer.apiKey,...a?.query}}}};d.__decorate([e.property({constructOnly:!0})],f.prototype,"layer",void 0);d.__decorate([e.property({constructOnly:!0})],f.prototype,"layerView",void 0);d.__decorate([e.property({constructOnly:!0})],f.prototype,"controller",void 0);d.__decorate([e.property({readOnly:!0})],f.prototype,"implicitFields",null);d.__decorate([e.property({readOnly:!0})],f.prototype,"queryFeaturesDehydrated",null);f=d.__decorate([m.subclass("esri.views.3d.layers.support.featureTileQuery3D.FeatureTileServiceQuery3D")],
f);let k=class extends l{constructor(a){super(a)}queryFeaturesDehydrated(a,c){return this.layer.queryFeatures(a,c)}};d.__decorate([e.property({constructOnly:!0})],k.prototype,"layer",void 0);k=d.__decorate([m.subclass("esri.views.3d.layers.support.featureTileQuery3D.FeatureTileOGCServiceQuery3D")],k);let h=class extends l{constructor(a){super(a)}queryFeaturesDehydrated(a,c){return this.source.queryFeaturesJSON(a,c).then(t.fromFeatureSetJSON,b=>{if(b&&"query-features-json:unsupported"===b.name)return this.layer.queryFeatures(a,
c);throw b;})}queryFeatureCount(a,c){return this.layer.queryFeatureCount(a,c)}};d.__decorate([e.property({constructOnly:!0})],h.prototype,"layer",void 0);d.__decorate([e.property({constructOnly:!0})],h.prototype,"source",void 0);h=d.__decorate([m.subclass("esri.views.3d.layers.support.featureTileQuery3D.FeatureTileClientQuery3D")],h);q.createFeatureTileQuery3D=function(a,c){const {layer:b}=a;return"feature"===b.type&&"feature-layer"===b.source.type||"catalog-footprint"===b.type?new f({layer:b,layerView:a,
controller:c}):"feature"===b.type&&"memory"===b.source.type||"csv"===b.type||"geojson"===b.type||"oriented-imagery"===b.type||"wfs"===b.type?new h({layer:b,source:b.source}):"ogc-feature"===b.type?new k({layer:b}):null};Object.defineProperty(q,Symbol.toStringTag,{value:"Module"})});