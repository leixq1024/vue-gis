// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.31/esri/copyright.txt for details.
//>>built
define("require ../../../chunks/tslib.es6 ../../../core/asyncUtils ../../../core/Error ../../../core/maybe ../../../core/promiseUtils ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/decorators/subclass ./LayerView3D ../../layers/LayerView ../../layers/ViewshedLayerView".split(" "),function(m,e,n,g,h,k,l,f,p,d,q,r){d=class extends d.LayerView3D(r(q)){constructor(a){super(a);this.type="viewshed-3d";this._analysisModule=null}initialize(){this.addHandles(l.watch(()=>
this.layer.source,a=>{this._destroyAnalysisView();null!=a&&this._createAnalysisView(a)},l.syncAndInitial),"analysis-view-handles")}destroy(){this.removeHandles("analysis-view-handles");this._destroyAnalysisView()}async whenAnalysisView(){if(null!=this.analysisView)return this.analysisView;if(null!=this._createAnalysisViewTask)return this._createAnalysisViewTask.promise;throw new g("layerview:no-analysisview-for-analysis","The analysis has not been set on the ViewshedLayer of this layer view");}isUpdating(){return null!=
this._createAnalysisViewTask||null!=this.analysisView&&this.analysisView.updating}_createAnalysisView(a){const c=n.createTask(async b=>{this.analysisView=await this._createAnalysisViewPromise(a,b);this._createAnalysisViewTask===c&&(this._createAnalysisViewTask=null);return this.analysisView});this.addResolvingPromise(c.promise);this._createAnalysisViewTask=c}_destroyAnalysisView(){this.analysisView=h.destroyMaybe(this.analysisView);this._createAnalysisViewTask=h.abortMaybe(this._createAnalysisViewTask)}async _createAnalysisViewPromise(a,
c){var b=this._analysisModule;null==b&&(this._analysisModule=b=await this._loadAnalysisModule());b=new b.default({analysis:a,view:this.view,parent:this});await b.when();if(k.isAborted(c)){b.destroy();c=this.layer.source;if(null!=c&&a!==c)throw k.createAbortError("Source has changed during creation.");throw new g("layerview:no-analysisview-for-analysis","The analysis has not been added to the ViewshedLayer of this layer view",{analysis:a});}return b}_loadAnalysisModule(){return new Promise((a,c)=>
m(["../analysis/ViewshedAnalysisView3D"],b=>a(Object.freeze(Object.defineProperty({__proto__:null,default:b},Symbol.toStringTag,{value:"Module"}))),c))}};e.__decorate([f.property()],d.prototype,"type",void 0);e.__decorate([f.property()],d.prototype,"analysisView",void 0);e.__decorate([f.property()],d.prototype,"_createAnalysisViewTask",void 0);return d=e.__decorate([p.subclass("esri.views.3d.layers.ViewshedLayerView3D")],d)});