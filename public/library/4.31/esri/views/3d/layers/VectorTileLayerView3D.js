// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.31/esri/copyright.txt for details.
//>>built
require({cache:{"esri/views/2d/engine/vectorTiles/SchemaHelper":function(){define(["exports"],function(k){class v{constructor(r,b,e){this._scale=r;this._shift=b;this._levelShift=e}getLevelRowColumn(r){const b=this.getLevelShift(r[0]),e=this._shift+b;return e?[r[0]-b,r[1]>>e,r[2]>>e]:r}getLevelShift(r){return Math.min(r,this._levelShift)}getOffset(r,b){let e=0;var g=0;const d=this._shift+this.getLevelShift(r[0]);d&&(g=(1<<d)-1,b/=this._scale*(1<<d-1),e=(r[2]&g)*b,g=(r[1]&g)*b);return[e,g]}getScale(r){return this._scale*
(1<<this._shift+this.getLevelShift(r))}}k.SchemaHelper=v;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/TileHandler3D":function(){define("../../../../core/MemCache ../../../../core/promiseUtils ../../../../core/libs/gl-matrix-2/factories/mat3f32 ../../../../geometry/support/aaBoundingRect ./TileHandler ./VectorTile ../../tiling/TileInfoViewPOT ../../tiling/TileKey".split(" "),function(k,v,r,b,e,g,d,h){class f extends e.TileHandler{constructor(c,l,
t,p){super(c,l,t,c.tileInfo.lods.length-1);this._memCache=p;this._ongoingTileRequests=new Map;this._ongoingRequestToController=new Map;this._tileInfoView=new d(c.tileInfo,c.fullExtent)}destroy(){super.destroy();this._ongoingRequestToController.forEach(c=>c.abort());this._ongoingRequestToController.clear();this._ongoingTileRequests.clear()}async getVectorTile(c,l){const t=new h(c[0],c[1],c[2],0);let p=this._memCache.get(t.id);if(p)return p.retain(),p;const w=await this._getVectorTileData(t);v.throwIfAborted(l);
if(!this._layer)return null;if(p=this._memCache.get(t.id))return p.retain(),p;l=this._layer.tileInfo.getTileBounds(b.create(),t);c=this._tileInfoView.getTileResolution(c[0]);p=new g.VectorTile(t,c,l[0],l[3],512,512,this._styleRepository,this._memCache);p.setData(w);w&&(p.retain(),this._memCache.put(t.id,p,p.usedMemory,k.MinPriority));p.neededForCoverage=!0;p.transforms.tileUnitsToPixels=r.fromValues(.125,0,0,0,.125,0,0,0,1);return p}_getVectorTileData(c){const l=c.id;if(this._ongoingTileRequests.has(l))return this._ongoingTileRequests.get(l);
const t=new AbortController;c=this._getParsedVectorTileData(c,{signal:t.signal}).then(p=>{this._ongoingTileRequests.delete(l);this._ongoingRequestToController.delete(l);return p}).catch(()=>{this._ongoingTileRequests.delete(l);this._ongoingRequestToController.delete(l);return null});this._ongoingTileRequests.set(l,c);this._ongoingRequestToController.set(l,t);return c}_getParsedVectorTileData(c,l){return this.fetchTileData(c,l).then(t=>this.parseTileData({key:c,data:t},l))}}return f})},"esri/views/2d/engine/vectorTiles/TileHandler":function(){define("exports ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/urlUtils ../../../../core/workers/workers ./enums ./GlyphMosaic ./GlyphSource ./SpriteMosaic ../../tiling/TileKey".split(" "),
function(k,v,r,b,e,g,d,h,f,c){function l(p){return()=>p.abort()}class t{constructor(p,w,q,B){this._layer=p;this._styleRepository=w;this.devicePixelRatio=q;this._sourceDataMaxLOD=B;this._inputSignalEventListener=this._startOptionsInputSignal=this._spriteSourceAbortController=this._connection=this._glyphMosaic=this._spriteMosaic=null}destroy(){this._connection?.close();this._layer=this._styleRepository=this._connection=null;this._spriteMosaic?.destroy();this._glyphMosaic=this._spriteMosaic=null;this._spriteSourceAbortController=
v.abortMaybe(this._spriteSourceAbortController);this._spriteSourcePromise=null;this._inputSignalEventListener&&this._startOptionsInputSignal?.removeEventListener("abort",this._inputSignalEventListener);this._inputSignalEventListener=this._startOptionsInputSignal=null}get spriteMosaic(){return this._spriteSourcePromise.then(()=>this._spriteMosaic)}get glyphMosaic(){return this._glyphMosaic}async start(p){this._requestSprite(p);var w=this._layer.currentStyleInfo.glyphsUrl;w=new h(w?b.addQueryParameters(w,
{...this._layer.customParameters,token:this._layer.apiKey}):null);this._glyphMosaic=new d(1024,1024,w);this._broadcastPromise=e.open("WorkerTileHandler",{client:this,schedule:p.schedule,signal:p.signal}).then(q=>{this._layer&&(this._connection?.close(),this._connection=q,this._layer&&!this._connection.closed&&(q=q.broadcast("setStyle",{style:this._layer.currentStyleInfo.style,sourceDataMaxLOD:this._sourceDataMaxLOD},p),Promise.all(q).catch(B=>r.throwIfNotAbortError(B))))})}_requestSprite(p){this._spriteSourceAbortController?.abort();
const w=new AbortController;this._spriteSourceAbortController=w;const q=p?.signal;this._inputSignalEventListener&&this._startOptionsInputSignal?.removeEventListener("abort",this._inputSignalEventListener);this._startOptionsInputSignal=null;q&&(this._inputSignalEventListener=l(w),q.addEventListener("abort",this._inputSignalEventListener,{once:!0}));const {signal:B}=w;this._spriteSourcePromise=this._layer.loadSpriteSource(this.devicePixelRatio,{...p,signal:B});this._spriteSourcePromise.then(H=>{r.throwIfAbortError(B);
this._spriteMosaic=new f(1024,1024,250);this._spriteMosaic.setSpriteSource(H)})}async updateStyle(p){const w=[];for(const q of p)q.type===g.StyleUpdateType.SPRITES_CHANGED?w.push({type:g.StyleUpdateType.SPRITES_CHANGED,data:{spriteSource:null}}):w.push(q);await this._broadcastPromise;return this._broadcastPromise=Promise.all(this._connection.broadcast("updateStyle",w))}setSpriteSource(p){const w=new f(1024,1024,250);w.setSpriteSource(p);this._spriteMosaic=w;this._spriteSourcePromise=Promise.resolve(p);
this._spriteSourceAbortController=null;return w}async setStyle(p,w,q){await this._broadcastPromise;this._styleRepository=p;this._sourceDataMaxLOD=q;this._requestSprite();p=new h(this._layer.currentStyleInfo.glyphsUrl?b.addQueryParameters(this._layer.currentStyleInfo.glyphsUrl,{...this._layer.customParameters,token:this._layer.apiKey}):null);this._glyphMosaic=new d(1024,1024,p);return this._broadcastPromise=Promise.all(this._connection.broadcast("setStyle",{style:w,sourceDataMaxLOD:this._sourceDataMaxLOD}))}async fetchTileData(p,
w){p=await this._getRefKeys(p,w);return this._getSourcesData(Object.keys(this._layer.sourceNameToSource),p,w)}async fetchTilePBFs(p){const w=Object.keys(this._layer.sourceNameToSource),q={};p=await this._getRefKeys(p,q);const B=[],H=[];for(let y=0;y<p.length;y++)if(null==p[y].value||null==w[y])H.push(null);else{const A=p[y].value,C=this._getTilePayload(A,w[y],q);C.then(E=>{B.push({...E,key:A})});H.push(C)}return Promise.all(H).then(()=>B)}async parseTileData(p,w){const q=p&&p.data;if(!q)return null;
const {sourceName2DataAndRefKey:B,transferList:H}=q;return 0===Object.keys(B).length?null:this._broadcastPromise.then(()=>this._connection.invoke("createTileAndParse",{key:p.key.id,sourceName2DataAndRefKey:B,styleLayerUIDs:p.styleLayerUIDs},{...w,transferList:H}))}async getSprites(p){await this._spriteSourcePromise;return this._spriteMosaic.getSpriteItems(p)}getGlyphs(p){return this._glyphMosaic.getGlyphItems(p.font,p.codePoints)}async _getTilePayload(p,w,q){p=c.pool.acquire(p.id);const B=this._layer.sourceNameToSource[w],
{level:H,row:y,col:A}=p;c.pool.release(p);try{return{protobuff:await B.requestTile(H,y,A,q),sourceName:w}}catch(C){if(r.isAbortError(C))throw C;return{protobuff:null,sourceName:w}}}async _getRefKeys(p,w){const q=this._layer.sourceNameToSource,B=[];for(const H in q){const y=q[H].getRefKey(p,w);B.push(y)}return r.eachAlways(B)}_getSourcesData(p,w,q){const B=[];for(let H=0;H<w.length;H++)if(null==w[H].value||null==p[H])B.push(null);else{const y=this._getTilePayload(w[H].value,p[H],q);B.push(y)}return r.eachAlways(B).then(H=>
{const y={},A=[];for(let C=0;C<H.length;C++){const E=H[C].value;E&&E.protobuff&&0<E.protobuff.byteLength&&(y[E.sourceName]={refKey:w[C].value.id,protobuff:E.protobuff},A.push(E.protobuff))}return{sourceName2DataAndRefKey:y,transferList:A}})}}k.TileHandler=t;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/GlyphMosaic":function(){define(["./RectangleBinPack","../webgl/Rect","../../../webgl/enums","../../../webgl/Texture","../../../webgl/TextureDescriptor"],
function(k,v,r,b,e){class g{constructor(d,h,f){this.height=this.width=0;this._dirties=[];this._glyphData=[];this._currentPage=0;this._glyphIndex={};this._textures=[];this._rangePromises=new Map;this.width=d;this.height=h;this._glyphSource=f;this._binPack=new k(d-4,h-4);this._glyphData.push(new Uint8Array(d*h));this._dirties.push(!0);this._textures.push(void 0)}getGlyphItems(d,h){const f=[],c=this._glyphSource,l=new Set,t=1/256;for(const w of h)l.add(Math.floor(w*t));const p=[];l.forEach(w=>{const q=
d+w;this._rangePromises.has(q)?p.push(this._rangePromises.get(q)):(w=c.getRange(d,w).then(()=>{this._rangePromises["delete"](q)},()=>{this._rangePromises["delete"](q)}),this._rangePromises.set(q,w),p.push(w))});return Promise.all(p).then(()=>{let w=this._glyphIndex[d];w||(w={},this._glyphIndex[d]=w);for(const A of h){var q=w[A];if(q){f[A]={sdf:!0,rect:q.rect,metrics:q.metrics,page:q.page,code:A};continue}var B=c.getGlyph(d,A);if(!B?.metrics)continue;q=B.metrics;let C;if(0===q.width)C=new v(0,0,0,
0);else{const E=q.width+6,I=q.height+6;var H=E%4?4-E%4:4,y=I%4?4-I%4:4;1===H&&(H=5);1===y&&(y=5);C=this._binPack.allocate(E+H,I+y);C.isEmpty&&(this._dirties[this._currentPage]||(this._glyphData[this._currentPage]=null),this._currentPage=this._glyphData.length,this._glyphData.push(new Uint8Array(this.width*this.height)),this._dirties.push(!0),this._textures.push(void 0),this._binPack=new k(this.width-4,this.height-4),C=this._binPack.allocate(E+H,I+y));H=this._glyphData[this._currentPage];B=B.bitmap;
let K;if(B)for(let n=0;n<I;n++){y=E*n;K=this.width*(C.y+n+1)+C.x;for(let x=0;x<E;x++)H[K+x+1]=B.at(y+x)}}w[A]={rect:C,metrics:q,tileIDs:null,page:this._currentPage};f[A]={sdf:!0,rect:C,metrics:q,page:this._currentPage,code:A};this._dirties[this._currentPage]=!0}return f})}removeGlyphs(d){for(const h in this._glyphIndex){const f=this._glyphIndex[h];if(!f)continue;let c;for(const l in f)if(c=f[l],c.tileIDs["delete"](d),0===c.tileIDs.size){const t=this._glyphData[c.page],p=c.rect;let w,q;for(let B=0;B<
p.height;B++)for(w=this.width*(p.y+B)+p.x,q=0;q<p.width;q++)t[w+q]=0;delete f[l];this._dirties[c.page]=!0}}}bind(d,h,f,c=0){if(!this._textures[f]){var l=new e.TextureDescriptor;l.pixelFormat=r.PixelFormat.ALPHA;l.wrapMode=r.TextureWrapMode.CLAMP_TO_EDGE;l.width=this.width;l.height=this.height;this._textures[f]=new b.Texture(d,l,new Uint8Array(this.width*this.height))}l=this._textures[f];l.setSamplingMode(h);this._dirties[f]&&l.setData(this._glyphData[f]);d.bindTexture(l,c);this._dirties[f]=!1}destroy(){this.dispose()}dispose(){this._glyphData.length=
0;this._binPack=null;for(const d of this._textures)d&&d.dispose();this._textures.length=0}}return g})},"esri/views/2d/engine/vectorTiles/RectangleBinPack":function(){define(["../webgl/Rect"],function(k){class v{constructor(r,b){this._height=this._width=0;this._free=[];this._width=r;this._height=b;this._free.push(new k(0,0,r,b))}get width(){return this._width}get height(){return this._height}allocate(r,b){if(r>this._width||b>this._height)return new k;let e=null,g=-1;for(let d=0;d<this._free.length;++d){const h=
this._free[d];r<=h.width&&b<=h.height&&(null===e||h.y<=e.y&&h.x<=e.x)&&(e=h,g=d)}if(null===e)return new k;this._free.splice(g,1);e.width<e.height?(e.width>r&&this._free.push(new k(e.x+r,e.y,e.width-r,b)),e.height>b&&this._free.push(new k(e.x,e.y+b,e.width,e.height-b))):(e.width>r&&this._free.push(new k(e.x+r,e.y,e.width-r,e.height)),e.height>b&&this._free.push(new k(e.x,e.y+b,r,e.height-b)));return new k(e.x,e.y,r,b)}release(r){for(let b=0;b<this._free.length;++b){const e=this._free[b];if(e.y===r.y&&
e.height===r.height&&e.x+e.width===r.x)e.width+=r.width;else if(e.x===r.x&&e.width===r.width&&e.y+e.height===r.y)e.height+=r.height;else if(r.y===e.y&&r.height===e.height&&r.x+r.width===e.x)e.x=r.x,e.width+=r.width;else if(r.x===e.x&&r.width===e.width&&r.y+r.height===e.y)e.y=r.y,e.height+=r.height;else continue;this._free.splice(b,1);this.release(r)}this._free.push(r)}}return v})},"esri/views/2d/engine/webgl/Rect":function(){define(function(){class k{constructor(v=0,r=0,b=0,e=0){this.x=v;this.y=r;
this.width=b;this.height=e}get isEmpty(){return 0>=this.width||0>=this.height}union(v){this.x=Math.min(this.x,v.x);this.y=Math.min(this.y,v.y);this.width=Math.max(this.width,v.width);this.height=Math.max(this.height,v.height)}}return k})},"esri/views/2d/engine/vectorTiles/GlyphSource":function(){define(["../../../../request","../../../../core/pbf"],function(k,v){class r{constructor(d){this._metrics=[];if(d){for(var h=new Map,f=0;d.next();)switch(d.tag()){case 1:const l=d.getMessage();for(;l.next();)switch(l.tag()){case 3:var c=
l.getMessage();let t,p,w,q,B,H,y;for(;c.next();)switch(c.tag()){case 1:t=c.getUInt32();break;case 2:p=c.getBytes();break;case 3:w=c.getUInt32();break;case 4:q=c.getUInt32();break;case 5:B=c.getSInt32();break;case 6:H=c.getSInt32();break;case 7:y=c.getUInt32();break;default:c.skip()}c.release();t&&(c=p?.length??0,this._metrics[t]={width:w,height:q,left:B,top:H,advance:y,startOffset:f,length:c},h.set(t,p),f+=c);break;default:l.skip()}l.release();break;default:d.skip()}d=new Uint8Array(f);f=this._metrics;
for(const [l,t]of h){const {startOffset:p,length:w}=f[l];if(t)for(h=0;h<w;++h)d[p+h]=t[h]}this._allBitmaps=d}else this._allBitmaps=null}getMetrics(d){return this._metrics[d]}getBitmap(d){if(this._allBitmaps&&(d=this._metrics[d],void 0!==d)){var {startOffset:h,length:f}=d;if(0!==f)return new g(this._allBitmaps,h,f)}}}class b{constructor(){this._ranges=[]}get ranges(){return this._ranges}getRange(d){return this._ranges[d]}addRange(d,h){this._ranges[d]=h}}class e{constructor(d){this._glyphInfo={};this._baseURL=
d}getRange(d,h){const f=this._getFontStack(d);if(f.getRange(h))return Promise.resolve();const c=256*h,l=c+255;if(this._baseURL)return d=this._baseURL.replace("{fontstack}",d).replace("{range}",c+"-"+l),k(d,{responseType:"array-buffer"}).then(t=>{f.addRange(h,new r(new v(new Uint8Array(t.data),new DataView(t.data))))}).catch(()=>{f.addRange(h,new r)});f.addRange(h,new r);return Promise.resolve()}getGlyph(d,h){if(d=this._getFontStack(d))if(d=d.getRange(Math.floor(h/256)))return{metrics:d.getMetrics(h),
bitmap:d.getBitmap(h)}}_getFontStack(d){let h=this._glyphInfo[d];h||=this._glyphInfo[d]=new b;return h}}class g{constructor(d,h,f){this._array=d;this._start=h;this.length=f}at(d){return 0<=d&&d<this.length?this._array[this._start+d]:void 0}}return e})},"esri/views/2d/engine/vectorTiles/SpriteMosaic":function(){define("../../../../core/has ../../../../symbols/cim/rasterizingUtils ./RectangleBinPack ../webgl/Rect ../../../webgl/enums ../../../webgl/Texture ../../../webgl/TextureDescriptor".split(" "),
function(k,v,r,b,e,g,d){class h{constructor(f,c,l=0){this._size=[];this._mosaicsData=[];this._textures=[];this._dirties=[];this._pageHeight=this._pageWidth=this._currentPage=this._maxItemSize=0;this._mosaicRects={};this.pixelRatio=1;0>=c&&console.error("Sprites mosaic defaultWidth and defaultHeight must be greater than zero!");this._pageWidth=f;this._pageHeight=c;0<l&&(this._maxItemSize=l);this._binPack=new r(f-4,c-4)}destroy(){this.dispose()}dispose(){this._binPack=null;this._mosaicsData.length=
0;this._mosaicRects={};for(const f of this._textures)f&&f.dispose();this._textures.length=0}getWidth(f){return f>=this._size.length?-1:this._size[f][0]}getHeight(f){return f>=this._size.length?-1:this._size[f][1]}getPageSize(f){return f>=this._size.length?null:this._size[f]}setSpriteSource(f){this.dispose();this.pixelRatio=f.devicePixelRatio;if(0===this._mosaicsData.length){this._binPack=new r(this._pageWidth-4,this._pageHeight-4);const c=new Uint32Array(Math.floor(this._pageWidth)*Math.floor(this._pageHeight));
this._mosaicsData[0]=c;this._dirties.push(!0);this._size.push([this._pageWidth,this._pageHeight]);this._textures.push(void 0)}this._sprites=f}getSpriteItem(f,c=!1){var l=this._mosaicRects[f];if(l)return l;if(!this._sprites||"loaded"!==this._sprites.loadStatus)return null;let t;f&&f.startsWith("dasharray-")?([l,t]=this._rasterizeDash(f),c=!0):l=this._sprites.getSpriteInfo(f);if(!l?.width||!l.height||0>l.width||0>l.height)return null;const p=l.width,w=l.height,[q,B,H]=this._allocateImage(p,w);if(0>=
q.width)return null;this._copy(q,l,B,H,c,t);l={type:"sprite",rect:q,width:p,height:w,sdf:l.sdf,simplePattern:!1,rasterizationScale:l.pixelRatio,page:B};return this._mosaicRects[f]=l}getSpriteItems(f){const c={};for(const l of f)c[l.name]=this.getSpriteItem(l.name,l.repeat);return c}getMosaicItemPosition(f,c){f=this.getSpriteItem(f,c);c=f?.rect;if(!c)return null;c.width=f.width;c.height=f.height;return{tl:[c.x+2,c.y+2],br:[c.x+2+f.width,c.y+2+f.height],page:f.page}}bind(f,c,l=0,t=0){if(!(l>=this._size.length||
l>=this._mosaicsData.length)){if(!this._textures[l]){var p=new d.TextureDescriptor;p.wrapMode=e.TextureWrapMode.CLAMP_TO_EDGE;p.width=this._size[l][0];p.height=this._size[l][1];this._textures[l]=new g.Texture(f,p,new Uint8Array(this._mosaicsData[l].buffer))}p=this._textures[l];p.setSamplingMode(c);this._dirties[l]&&p.setData(new Uint8Array(this._mosaicsData[l].buffer));f.bindTexture(p,t);this._dirties[l]=!1}}static _copyBits(f,c,l,t,p,w,q,B,H,y,A){let C=t*c+l;q=B*w+q;if(A)for(q-=w,A=-1;A<=y;A++,C=
((A+y)%y+t)*c+l,q+=w)for(B=-1;B<=H;B++)p[q+B]=f[C+(B+H)%H];else for(l=0;l<y;l++){for(t=0;t<H;t++)p[q+t]=f[C+t];C+=c;q+=w}}_copy(f,c,l,t,p,w){if(this._sprites&&"loaded"===this._sprites.loadStatus&&!(l>=this._mosaicsData.length)){var q=new Uint32Array(w?w.buffer:this._sprites.image.buffer);h._copyBits(q,w?c.width:this._sprites.width,c.x,c.y,this._mosaicsData[l],t[0],f.x+2,f.y+2,c.width,c.height,p);this._dirties[l]=!0}}_allocateImage(f,c){f+=2;c+=2;var l=Math.max(f,c);if(this._maxItemSize&&this._maxItemSize<
l)return l=new b(0,0,f,c),this._mosaicsData.push(new Uint32Array(f*c)),this._dirties.push(!0),this._size.push([f,c]),this._textures.push(void 0),[l,this._mosaicsData.length-1,[f,c]];l=f%4?4-f%4:4;let t=c%4?4-c%4:4;1===l&&(l=5);1===t&&(t=5);l=this._binPack.allocate(f+l,c+t);return 0>=l.width?(this._dirties[this._currentPage]||(this._mosaicsData[this._currentPage]=null),this._currentPage=this._mosaicsData.length,this._mosaicsData.push(new Uint32Array(this._pageWidth*this._pageHeight)),this._dirties.push(!0),
this._size.push([this._pageWidth,this._pageHeight]),this._textures.push(void 0),this._binPack=new r(this._pageWidth-4,this._pageHeight-4),this._allocateImage(f,c)):[l,this._currentPage,[this._pageWidth,this._pageHeight]]}_rasterizeDash(f){var c=f.match(/\[(.*?)\]/);if(!c)return null;c=c[1].split(",").map(Number);f=f.slice(f.lastIndexOf("-")+1);const [l,t,p]=v.rasterizeDash(c,f);f=new Uint8Array(l.buffer);return[{x:0,y:0,width:t,height:p,sdf:!0,pixelRatio:1},f]}}return h})},"esri/symbols/cim/rasterizingUtils":function(){define(["exports",
"../../core/floatRGBA","../../core/mathUtils","./constants"],function(k,v,r,b){k.rasterizeDash=function(e,g){null==e&&(e=[]);var d="Butt"===g,h="Square"===g;g=!d&&!h;1===e.length%2&&(e=[...e,...e]);const f=b.dashRadius,c=2*f;var l=0;for(var t of e)l+=t;t=Math.round(l*f);l=new Float32Array(t*c);const p=.5*f;let w=0,q=0,B=.5,H=!0;for(var y of e){w=q;for(q+=y*f;B<=q;){for(e=.5;e<c;){const A=g?(e-f)*(e-f):Math.abs(e-f);l[(e-.5)*t+B-.5]=H?d?Math.max(Math.max(w+p-B,A),Math.max(B-q+p,A)):A:g?Math.min((B-
w)*(B-w)+A,(B-q)*(B-q)+A):h?Math.min(Math.max(B-w,A),Math.max(q-B,A)):Math.min(Math.max(B-w+p,A),Math.max(q+p-B,A));e++}B++}H=!H}d=l.length;y=new Uint8Array(4*d);for(h=0;h<d;++h)v.packFloatRGBA((g?Math.sqrt(l[h]):l[h])/f,y,4*h);return[y,t,c]};k.rasterizeDash1D=function(e){1===e.length%2&&(e=[...e,...e]);var g=e.reduce((p,w)=>p+w,0);g=Math.round(g*b.dashSdfRasterizationScale);const d=new Float32Array(1*g);var h=0;let f=0,c=.5,l=!0;for(var t of e){h=f;for(f+=t*b.dashSdfRasterizationScale;c<=f;)e=Math.min(Math.abs(c-
h),Math.abs(c-f)),d[c-.5]=l?-e:e,c++;l=!l}t=d.length;e=new Uint8Array(4*t);for(h=0;h<t;++h)v.packFloatRGBA(d[h]/b.dashSdfRasterizationScale/b.dashSdfDistanceNormalization*.5+.5,e,4*h);return[e,g,1]};k.rasterizeFillStyle=function(e,g,d){g=g.style;d=r.nextPowerOfTwo(Math.ceil(d));var h="vertical"===g||"horizontal"===g||"cross"===g||"esriSFSCross"===g||"esriSFSVertical"===g||"esriSFSHorizontal"===g?8*d:16*d,f=2*d;e.width=h;e.height=h;const c=e.getContext("2d");c.strokeStyle="#ffffff";c.lineWidth=d;c.beginPath();
if("vertical"===g||"cross"===g||"esriSFSCross"===g||"esriSFSVertical"===g)c.moveTo(h/2,-f),c.lineTo(h/2,h+f);if("horizontal"===g||"cross"===g||"esriSFSCross"===g||"esriSFSHorizontal"===g)c.moveTo(-f,h/2),c.lineTo(h+f,h/2);if("backward-diagonal"===g||"diagonal-cross"===g||"esriSFSDiagonalCross"===g||"esriSFSBackwardDiagonal"===g)c.moveTo(-f,-f),c.lineTo(h+f,h+f),c.moveTo(h-f,-f),c.lineTo(h+f,f),c.moveTo(-f,h-f),c.lineTo(f,h+f);if("forward-diagonal"===g||"diagonal-cross"===g||"esriSFSForwardDiagonal"===
g||"esriSFSDiagonalCross"===g)c.moveTo(h+f,-f),c.lineTo(-f,h+f),c.moveTo(f,-f),c.lineTo(-f,f),c.moveTo(h+f,h-f),c.lineTo(h-f,h+f);c.stroke();g=c.getImageData(0,0,e.width,e.height);g=new Uint8Array(g.data);for(f=0;f<g.length;f+=4)h=g[f+3]/255,g[f]*=h,g[f+1]*=h,g[f+2]*=h;return[g,e.width,e.height,d]};Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/constants":function(){define(["exports"],function(k){k.dashRadius=15.5;k.dashSdfDistanceNormalization=64;k.dashSdfRasterizationScale=
4;k.maxTileCoordValue=1024;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/VectorTile":function(){define("exports ../../../../core/has ../../../../core/libs/gl-matrix-2/math/mat3 ../../../../core/libs/gl-matrix-2/factories/mat3f32 ./enums ./RenderBucket ./decluttering/config ../webgl/TiledDisplayObject".split(" "),function(k,v,r,b,e,g,d,h){class f extends h.TiledDisplayObject{constructor(c,l,t,p,w,q,B,H=null){super(c,l,t,p,w,q,4096,4096);this.styleRepository=
B;this._memCache=H;this.type="vector-tile";this._referenced=1;this._hasSymbolBuckets=!1;this._usedMemory=256;this.layerData=new Map;this.status="loading";this.allSymbolsFadingOut=!1;this.lastOpacityUpdate=0;this.symbols=new Map;this.decluttered=this.neededForCoverage=this.isCoverage=!1;this.parentTile=null;this.childrenTiles=new Set;this.featureIndex=null;this.triangleCount=0;this._processed=!1;this.id=c.id}get hasSymbolBuckets(){return this._hasSymbolBuckets}get isFading(){return this._hasSymbolBuckets&&
performance.now()-this.lastOpacityUpdate<d.fadeDuration}get isHoldingForFade(){return this._hasSymbolBuckets&&(!this.allSymbolsFadingOut||performance.now()-this.lastOpacityUpdate<d.fadeDuration)}get wasRequested(){return"errored"===this.status||"loaded"===this.status||"reloading"===this.status}setData(c){this.changeDataImpl(c);this.requestRender();this.ready();this._processed=!0}deleteLayerData(c){let l=!1;for(const t of c)if(c=this.layerData.get(t))this._usedMemory-=c.usedMemory,c.type===e.BucketType.SYMBOL&&
this.symbols.delete(t)&&(l=!0),c.destroy(),this.layerData.delete(t);this._memCache?.updateSize(this.key.id,this,this._usedMemory);l&&(this.featureIndex?.clear(),this.emit("symbols-changed"));this.requestRender()}processed(){return this._processed}hasData(){return 0<this.layerData.size}hasFeatures(){const c=this.layerData.values();for(const l of c)if(l.hasData())return!0;return!1}dispose(){"unloaded"!==this.status&&(f._destroyRenderBuckets(this.layerData),this.layerData.clear(),this.featureIndex=null,
this._usedMemory=0,this.destroy(),this.status="unloaded")}release(){0===--this._referenced&&(this.dispose(),this.stage=null)}retain(){++this._referenced}get usedMemory(){return this._usedMemory}get usedMemoryPerReference(){return this._usedMemory/(this._referenced||1)}changeDataImpl(c){this.featureIndex?.clear();let l=!1;if(c){const {bucketsWithData:t,emptyBuckets:p}=c;c=this._createRenderBuckets(t);if(p&&0<p.byteLength){const w=new Uint32Array(p);for(const q of w)this._deleteLayerData(q)}for(const [w,
q]of c)this._deleteLayerData(w),q.type===e.BucketType.SYMBOL&&(this.symbols.set(w,q.symbols),l=!0),this._usedMemory+=q.usedMemory,this.layerData.set(w,q);this._memCache?.updateSize(this.key.id,this,this.usedMemory)}this._hasSymbolBuckets=!1;for(const t of this.layerData.values())t.type===e.BucketType.SYMBOL&&(this._hasSymbolBuckets=!0);l&&this.emit("symbols-changed")}attachWithContext(c){this.stage={context:c,trashDisplayObject(l){l.processDetach()},untrashDisplayObject(){return!1}}}setTransform(c){super.setTransform(c);
var l=this.resolution/(c.resolution*c.pixelRatio);const t=this.width/this.rangeX*l;l*=this.height/this.rangeY;const p=[0,0];c.toScreen(p,[this.x,this.y]);const w=this.transforms.tileUnitsToPixels;r.identity(w);r.translate(w,w,p);r.rotate(w,w,Math.PI*c.rotation/180);r.scale(w,w,[t,l,1])}_createTransforms(){return{displayViewScreenMat3:b.create(),tileMat3:b.create(),tileUnitsToPixels:b.create()}}static _destroyRenderBuckets(c){if(c){var l=new Set;for(const t of c.values())l.has(t)||(t.destroy(),l.add(t));
c.clear()}}_createRenderBuckets(c){const l=new Map,t=new Map;for(const p of c){c=this._deserializeBucket(p,t);for(const w of c.layerUIDs)l.set(w,c)}return l}_deserializeBucket(c,l){let t=l.get(c);if(t)return t;switch((new Uint32Array(c))[0]){case e.BucketType.FILL:t=new g.FillRenderBucket(c,this.styleRepository);break;case e.BucketType.LINE:t=new g.LineRenderBucket(c,this.styleRepository);break;case e.BucketType.SYMBOL:t=new g.SymbolRenderBucket(c,this.styleRepository,this);break;case e.BucketType.CIRCLE:t=
new g.CircleRenderBucket(c,this.styleRepository)}l.set(c,t);return t}_deleteLayerData(c){if(this.layerData.has(c)){var l=this.layerData.get(c);this._usedMemory-=l.usedMemory;l.destroy();this.layerData.delete(c)}}}k.VectorTile=f;k.tracer=null;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/RenderBucket":function(){define("exports ../../../../core/maybe ../../../../core/typedArrayUtil ../../tiling/TileInfoView ../../tiling/TileKey ../../tiling/TileQueue ../../tiling/TileStrategy ./enums ./decluttering/util ../../../webgl/BufferObject ../../../webgl/enums ../../../webgl/VertexArrayObject".split(" "),
function(k,v,r,b,e,g,d,h,f,c,l,t){class p{constructor(y,A){this.layerUIDs=[];this.isDestroyed=!1;this._data=y;let C=1;y=new Uint32Array(y);this.layerUIDs=[];const E=y[C++];for(let I=0;I<E;I++)this.layerUIDs[I]=y[C++];this.bufferDataOffset=C;A&&(this.layer=A.getStyleLayerByUID(this.layerUIDs[0]))}get isPreparedForRendering(){return null==this._data}get offset(){return this.bufferDataOffset}get data(){return this._data}destroy(){this.isDestroyed||(this.doDestroy(),this._data=null,this.isDestroyed=!0)}prepareForRendering(y){null!=
this._data&&(this.doPrepareForRendering(y,this._data,this.bufferDataOffset),this._data=null)}}class w extends p{constructor(y,A){super(y,A);this.type=h.BucketType.LINE;this.lineIndexCount=this.lineIndexStart=0;y=new Uint32Array(y);A=this.bufferDataOffset;this.lineIndexStart=y[A++];this.lineIndexCount=y[A++];const C=y[A++];if(0<C){this.patternMap=new Map;for(let E=0;E<C;E++){const I=y[A++],K=y[A++],n=y[A++];this.patternMap.set(I,[K,n])}}this.bufferDataOffset=A}get usedMemory(){return(this.data?.byteLength??
0)+(this.vao?.usedMemory??0)}hasData(){return 0<this.lineIndexCount}triangleCount(){return this.lineIndexCount/3}doDestroy(){this.vao=v.disposeMaybe(this.vao)}doPrepareForRendering(y,A,C){var E=new Uint32Array(A);A=new Int32Array(E.buffer);var I=E[C++];A=c.BufferObject.createVertex(y,l.Usage.STATIC_DRAW,new Int32Array(A.buffer,4*C,I));C+=I;I=E[C++];E=c.BufferObject.createIndex(y,l.Usage.STATIC_DRAW,new Uint32Array(E.buffer,4*C,I));C+=I;C=this.layer.lineMaterial;this.vao=new t.VertexArrayObject(y,
C.getAttributeLocations(),C.getLayoutInfo(),new Map([["geometry",A]]),E)}}class q extends p{constructor(y,A){super(y,A);this.type=h.BucketType.FILL;this.outlineIndexCount=this.outlineIndexStart=this.fillIndexCount=this.fillIndexStart=0;y=new Uint32Array(y);A=this.bufferDataOffset;this.fillIndexStart=y[A++];this.fillIndexCount=y[A++];this.outlineIndexStart=y[A++];this.outlineIndexCount=y[A++];const C=y[A++];if(0<C){this.patternMap=new Map;for(let E=0;E<C;E++){const I=y[A++],K=y[A++],n=y[A++];this.patternMap.set(I,
[K,n])}}this.bufferDataOffset=A}get usedMemory(){return(this.data?.byteLength??0)+(this.fillVAO?.usedMemory??0)+(this.outlineVAO?.usedMemory??0)}hasData(){return 0<this.fillIndexCount||0<this.outlineIndexCount}triangleCount(){return(this.fillIndexCount+this.outlineIndexCount)/3}doDestroy(){this.fillVAO=v.disposeMaybe(this.fillVAO);this.outlineVAO=v.disposeMaybe(this.outlineVAO)}doPrepareForRendering(y,A,C){var E=new Uint32Array(A),I=new Int32Array(E.buffer),K=E[C++];A=c.BufferObject.createVertex(y,
l.Usage.STATIC_DRAW,new Int32Array(I.buffer,4*C,K));C+=K;var n=E[C++];K=c.BufferObject.createIndex(y,l.Usage.STATIC_DRAW,new Uint32Array(E.buffer,4*C,n));C+=n;n=E[C++];I=c.BufferObject.createVertex(y,l.Usage.STATIC_DRAW,new Int32Array(I.buffer,4*C,n));C+=n;n=E[C++];E=c.BufferObject.createIndex(y,l.Usage.STATIC_DRAW,new Uint32Array(E.buffer,4*C,n));C+=n;n=this.layer;C=n.fillMaterial;n=n.outlineMaterial;this.fillVAO=new t.VertexArrayObject(y,C.getAttributeLocations(),C.getLayoutInfo(),new Map([["geometry",
A]]),K);this.outlineVAO=new t.VertexArrayObject(y,n.getAttributeLocations(),n.getLayoutInfo(),new Map([["geometry",I]]),E)}}class B extends p{constructor(y,A,C){super(y,A);this.type=h.BucketType.SYMBOL;this.iconPerPageElementsMap=new Map;this.glyphPerPageElementsMap=new Map;this.symbolInstances=[];this.opacityChanged=this.isIconSDF=!1;this.lastOpacityUpdate=0;this.symbols=[];A=new Uint32Array(y);const E=new Int32Array(y);y=new Float32Array(y);let I=this.bufferDataOffset;this.isIconSDF=!!A[I++];var K=
A[I++],n=A[I++],x=A[I++];K=new e(K,n,x,0);n=A[I++];for(x=0;x<n;x++){var z=A[I++],F=A[I++],G=A[I++];this.iconPerPageElementsMap.set(z,[F,G])}n=A[I++];for(x=0;x<n;x++)z=A[I++],F=A[I++],G=A[I++],this.glyphPerPageElementsMap.set(z,[F,G]);n=A[I++];x=A[I++];this.iconOpacity=new Int32Array(n);this.textOpacity=new Int32Array(x);this.bufferDataOffset=I=f.deserializeSymbols(A,E,y,I,this.symbols,C,K)}get usedMemory(){return(this.data?.byteLength??0)+(this.iconVAO?.usedMemory??0)+(this.textVAO?.usedMemory??0)+
r.estimateSize(this.iconOpacity)+r.estimateSize(this.textOpacity)}hasData(){return 0<this.iconPerPageElementsMap.size||0<this.glyphPerPageElementsMap.size}triangleCount(){let y=0;for(const A of this.iconPerPageElementsMap.values())y+=A[1];for(const A of this.glyphPerPageElementsMap.values())y+=A[1];return y/3}doDestroy(){this.iconVAO=v.disposeMaybe(this.iconVAO);this.textVAO=v.disposeMaybe(this.textVAO)}updateOpacityInfo(){if(this.opacityChanged){this.opacityChanged=!1;var y=this.iconOpacity,A=this.iconVAO.vertexBuffers.get("opacity");
0<y.length&&y.byteLength===A.usedMemory&&A.setSubData(y,0,0,y.length);y=this.textOpacity;A=this.textVAO.vertexBuffers.get("opacity");0<y.length&&y.byteLength===A.usedMemory&&A.setSubData(y,0,0,y.length)}}doPrepareForRendering(y,A,C){var E=new Uint32Array(A),I=new Int32Array(E.buffer),K=E[C++];A=c.BufferObject.createVertex(y,l.Usage.STATIC_DRAW,new Int32Array(I.buffer,4*C,K));C+=K;var n=E[C++];K=c.BufferObject.createIndex(y,l.Usage.STATIC_DRAW,new Uint32Array(E.buffer,4*C,n));C+=n;n=E[C++];I=c.BufferObject.createVertex(y,
l.Usage.STATIC_DRAW,new Int32Array(I.buffer,4*C,n));C+=n;n=E[C++];E=c.BufferObject.createIndex(y,l.Usage.STATIC_DRAW,new Uint32Array(E.buffer,4*C,n));C+=n;C=c.BufferObject.createVertex(y,l.Usage.STATIC_DRAW,this.iconOpacity.buffer);n=c.BufferObject.createVertex(y,l.Usage.STATIC_DRAW,this.textOpacity.buffer);var x=this.layer;const z=x.iconMaterial;x=x.textMaterial;this.iconVAO=new t.VertexArrayObject(y,z.getAttributeLocations(),z.getLayoutInfo(),new Map([["geometry",A],["opacity",C]]),K);this.textVAO=
new t.VertexArrayObject(y,x.getAttributeLocations(),x.getLayoutInfo(),new Map([["geometry",I],["opacity",n]]),E)}}class H extends p{constructor(y,A){super(y,A);this.type=h.BucketType.CIRCLE;this.circleIndexCount=this.circleIndexStart=0;y=new Uint32Array(y);A=this.bufferDataOffset;this.circleIndexStart=y[A++];this.circleIndexCount=y[A++];this.bufferDataOffset=A}get usedMemory(){return(this.data?.byteLength??0)+(this.vao?.usedMemory??0)}hasData(){return 0<this.circleIndexCount}triangleCount(){return this.circleIndexCount/
3}doDestroy(){this.vao=v.disposeMaybe(this.vao)}doPrepareForRendering(y,A,C){var E=new Uint32Array(A);A=new Int32Array(E.buffer);var I=E[C++];A=c.BufferObject.createVertex(y,l.Usage.STATIC_DRAW,new Int32Array(A.buffer,4*C,I));C+=I;I=E[C++];E=c.BufferObject.createIndex(y,l.Usage.STATIC_DRAW,new Uint32Array(E.buffer,4*C,I));C+=I;C=this.layer.circleMaterial;this.vao=new t.VertexArrayObject(y,C.getAttributeLocations(),C.getLayoutInfo(),new Map([["geometry",A]]),E)}}k.CircleRenderBucket=H;k.FillRenderBucket=
q;k.LineRenderBucket=w;k.RenderBucketBase=p;k.SymbolRenderBucket=B;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/tiling/TileInfoViewPOT":function(){define(["../../../layers/support/TileInfo","./TileInfoView","./TileKey"],function(k,v,r){class b extends v{constructor(){super(...arguments);this._fullCacheLodInfos=null;this._levelByScale={}}getTileParentId(e){e=r.pool.acquire(e);const g=0===e.level?null:r.getId(e.level-1,e.row>>1,e.col>>1,e.world);r.pool.release(e);return g}getTileCoverage(e,
g,d=!0,h){e=super.getTileCoverage(e,g,d,h);if(!e)return e;const f=1<<e.lodInfo.level;e.spans=e.spans.filter(c=>0<=c.row&&c.row<f);return e}scaleToLevel(e){this._fullCacheLodInfos||this._initializeFullCacheLODs(this._lodInfos);if(this._levelByScale[e])return this._levelByScale[e];var g=this._fullCacheLodInfos;if(e>g[0].scale)return g[0].level;let d;for(let h=0;h<g.length-1;h++)if(d=g[h+1],e>d.scale)return g=g[h],g.level+(g.scale-e)/(g.scale-d.scale);return g[g.length-1].level}_initializeFullCacheLODs(e){e=
0===e[0].level?e.map(g=>({level:g.level,resolution:g.resolution,scale:g.scale})):k.create({size:this.tileInfo.size[0],spatialReference:this.tileInfo.spatialReference}).lods.map(g=>({level:g.level,resolution:g.resolution,scale:g.scale}));for(let g=0;g<e.length;g++)this._levelByScale[e[g].scale]=e[g].level;this._fullCacheLodInfos=e}}return b})},"esri/views/2d/engine/vectorTiles/VTLPainter3D":function(){define(["../../../../core/maybe","../vtlBrushes","./shaders/VTLMaterialManager","./style/StyleDefinition",
"../../../webgl/enums"],function(k,v,r,b,e){class g{constructor(h,f){this.spriteMosaic=h;this.glyphMosaic=f;this._brushCache={vtlBackground:null,vtlFill:null,vtlLine:null,vtlCircle:null,vtlSymbol:null};this._vtlMaterialManager=new r}dispose(){this._brushCache.vtlBackground?.dispose();this._brushCache.vtlFill?.dispose();this._brushCache.vtlLine?.dispose();this._brushCache.vtlCircle?.dispose();this._brushCache.vtlSymbol?.dispose();this._brushCache=null;this._vtlMaterialManager=k.disposeMaybe(this._vtlMaterialManager);
this.spriteMosaic.dispose();this.glyphMosaic.dispose()}get vectorTilesMaterialManager(){return this._vtlMaterialManager}drawSymbols(h,f,c){c=c.layers;h.renderPass="translucent";let l=this._brushCache.vtlSymbol;null==l&&(l=new v.vtlBrushes.vtlSymbol,this._brushCache.vtlSymbol=l);for(let p=0;p<c.length;p++){const w=c[p];if(w.type===b.StyleLayerType.SYMBOL){var t=w.getLayoutProperty("visibility");t&&t.getValue()===b.Visibility.NONE||(t=h.displayLevel,void 0!==w.minzoom&&w.minzoom>t+1E-6||void 0!==w.maxzoom&&
w.maxzoom<=t-1E-6||(h.styleLayerUID=w.uid,h.styleLayer=w,d[0]=f,l.drawMany(h,d)))}}}drawBackground(h,f,c){if(0!==c.backgroundBucketIds.length){var {context:l,displayLevel:t,requiredLevel:p}=h;f.key.level=p;l.setBlendingEnabled(!0);l.setDepthTestEnabled(!1);l.setStencilTestEnabled(!1);h.renderPass="background";var w=this._brushCache.vtlBackground;null==w&&(w=new v.vtlBrushes.vtlBackground,this._brushCache.vtlBackground=w);c.backgroundBucketIds.forEach(q=>{q=c.getLayerById(q);if(q.type===b.StyleLayerType.BACKGROUND){var B=
q.getLayoutProperty("visibility");B&&B.getValue()===b.Visibility.NONE||void 0!==q.minzoom&&q.minzoom>t+1E-6||void 0!==q.maxzoom&&q.maxzoom<=t-1E-6||(h.styleLayerUID=q.uid,h.styleLayer=q,d[0]=f,w.drawMany(h,d))}})}}drawTile(h,f,c,l){const {context:t}=h;c=c.layers;t.setBlendingEnabled(!1);t.setDepthTestEnabled(!0);t.setDepthWriteEnabled(!0);t.setDepthFunction(e.CompareFunction.LEQUAL);c=c.filter(p=>null!=l&&l!==p.type||!f.layerData.has(p.uid)||p.getLayoutProperty("visibility")?.getValue()===b.Visibility.NONE?
!1:!0);h.renderPass="opaque";for(let p=c.length-1;0<=p;--p)this._renderStyleLayer(c[p],h,f);t.setDepthWriteEnabled(!1);t.setBlendingEnabled(!0);t.setBlendFunctionSeparate(e.BlendFactor.ONE,e.BlendFactor.ONE_MINUS_SRC_ALPHA,e.BlendFactor.ONE,e.BlendFactor.ONE_MINUS_SRC_ALPHA);h.renderPass="translucent";c.forEach(p=>this._renderStyleLayer(p,h,f));t.setDepthTestEnabled(!1);t.bindVAO()}_renderStyleLayer(h,f,c){var {renderPass:l}=f;let t;switch(h.type){case b.StyleLayerType.BACKGROUND:if("background"!==
l)return;t=this._brushCache.vtlBackground;t||(t=new v.vtlBrushes.vtlBackground,this._brushCache.vtlBackground=t);break;case b.StyleLayerType.FILL:if("opaque"!==l&&"translucent"!==f.renderPass)return;t=this._brushCache.vtlFill;null==t&&(t=new v.vtlBrushes.vtlFill,this._brushCache.vtlFill=t);break;case b.StyleLayerType.LINE:if("translucent"!==l)return;t=this._brushCache.vtlLine;null==t&&(t=new v.vtlBrushes.vtlLine,this._brushCache.vtlLine=t);break;case b.StyleLayerType.CIRCLE:if("translucent"!==l)return;
t=this._brushCache.vtlCircle;null==t&&(t=new v.vtlBrushes.vtlCircle,this._brushCache.vtlCircle=t);break;case b.StyleLayerType.SYMBOL:if("translucent"!==l)return;t=this._brushCache.vtlSymbol;null==t&&(t=new v.vtlBrushes.vtlSymbol,this._brushCache.vtlSymbol=t)}({displayLevel:l}=f);const {minzoom:p,maxzoom:w}=h;void 0!==p&&p>l+1E-6||void 0!==w&&w<=l-1E-6||({context:l}=f,l.setStencilTestEnabled(!1),l.setStencilWriteMask(0),f.styleLayerUID=h.uid,f.styleLayer=h,d[0]=c,t.drawMany(f,d))}}const d=[null];return g})},
"esri/views/2d/engine/vtlBrushes":function(){define("exports ./webgl/brushes/WGLBrushVTLBackground ./webgl/brushes/WGLBrushVTLCircle ./webgl/brushes/WGLBrushVTLFill ./webgl/brushes/WGLBrushVTLLine ./webgl/brushes/WGLBrushVTLSymbol".split(" "),function(k,v,r,b,e,g){k.vtlBrushes={vtlBackground:v.WGLBrushVTLBackground,vtlFill:b.WGLBrushVTLFill,vtlLine:e.WGLBrushVTLLine,vtlCircle:r.WGLBrushVTLCircle,vtlSymbol:g.WGLBrushVTLSymbol};Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/brushes/WGLBrushVTLBackground":function(){define("exports ../../../../../core/mathUtils ../../../../../core/libs/gl-matrix-2/factories/mat3f32 ../../../../../core/libs/gl-matrix-2/factories/vec4f32 ../definitions ./WGLBrush ../../../../webgl/BufferObject ../../../../webgl/enums ../../../../webgl/VertexArrayObject".split(" "),
function(k,v,r,b,e,g,d,h,f){class c extends g{constructor(){super(...arguments);this._color=b.fromValues(1,0,0,1);this._patternMatrix=r.create();this._programOptions={id:!1,pattern:!1}}dispose(){this._vao&&(this._vao.dispose(),this._vao=null)}drawMany(l,t){const {context:p,painter:w,requestRender:q,allowDelayedRender:B}=l;this._loadWGLResources(l);const H=l.displayLevel;var y=l.styleLayer,A=y.backgroundMaterial;const C=w.vectorTilesMaterialManager;var E=y.getPaintValue("background-color",H),I=y.getPaintValue("background-opacity",
H);const K=y.getPaintValue("background-pattern",H),n=void 0!==K,x=l.spriteMosaic;let z,F;l=(window.devicePixelRatio|1)>e.vtlHighResCutoff?2:1;const G=this._programOptions;G.pattern=n;A=C.getMaterialProgram(p,A,G);if(B&&null!=q&&!A.compiled)q();else{p.bindVAO(this._vao);p.useProgram(A);if(n){E=x.getMosaicItemPosition(K,!0);if(null!=E){const {tl:L,br:M,page:O}=E;z=M[0]-L[0];F=M[1]-L[1];E=x.getPageSize(O);null!=E&&(x.bind(p,h.TextureSamplingMode.LINEAR,O,e.vtlTextureBindingUnitSprites),A.setUniform4f("u_tlbr",
L[0],L[1],M[0],M[1]),A.setUniform2fv("u_mosaicSize",E),A.setUniform1i("u_texture",e.vtlTextureBindingUnitSprites))}A.setUniform1f("u_opacity",I)}else I*=E[3],this._color[0]=I*E[0],this._color[1]=I*E[1],this._color[2]=I*E[2],this._color[3]=I,A.setUniform4fv("u_color",this._color);A.setUniform1f("u_depth",y.z||0);for(const L of t)A.setUniform1f("u_coord_range",L.rangeX),A.setUniformMatrix3fv("u_dvsMat3",L.transforms.displayViewScreenMat3),n&&(y=l*L.width*Math.max(2**(Math.round(H)-L.key.level),1),t=
y/v.nextPowerOfTwo(z),y/=v.nextPowerOfTwo(F),this._patternMatrix[0]=t,this._patternMatrix[4]=y,A.setUniformMatrix3fv("u_pattern_matrix",this._patternMatrix)),p.setStencilFunction(h.CompareFunction.EQUAL,0,255),p.drawArrays(h.PrimitiveType.TRIANGLE_STRIP,0,4)}}_loadWGLResources(l){if(!this._vao){var {context:t,styleLayer:p}=l;l=p.backgroundMaterial;var w=new Int8Array([0,0,1,0,0,1,1,1]);w=d.BufferObject.createVertex(t,h.Usage.STATIC_DRAW,w);this._vao=new f.VertexArrayObject(t,l.getAttributeLocations(),
l.getLayoutInfo(),new Map([["geometry",w]]))}}}k.WGLBrushVTLBackground=c;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/definitions":function(){define(["exports"],function(k){k.AttributeDataType=void 0;var v=k.AttributeDataType||(k.AttributeDataType={});v[v.FilterFlags=0]="FilterFlags";v[v.Animation=1]="Animation";v[v.GPGPU=2]="GPGPU";v[v.VV=3]="VV";v[v.DD0=4]="DD0";v[v.DD1=5]="DD1";v[v.DD2=6]="DD2";v[v.LocalTimeOrigin=7]="LocalTimeOrigin";k.MAX_TILE_RESHUFFLES_PER_FRAME=
1;k.RESHUFFLING_EXEMPT_DRAW_CALLS=10;k.RESHUFFLING_EXEMPT_MEMORY_BYTES=1048576;k.RESHUFFLING_TARGET_DRAW_EFFICIENCY=.75;k.RESHUFFLING_TARGET_MEMORY_EFFICIENCY=.75;k.angleFactor256=256/360;k.animationUnit=2;k.attributeStoreInitialSize=256;k.attributeStoreTextureSize=1024;k.averageGlyphMosaicItem={metrics:{width:15,height:17,left:0,top:-7,advance:14}};k.backbufferStencilClipped=1;k.backbufferStencilVisible=0;k.bitsetFillHasPatternHeightPrecisionFactor=32;k.bitsetFillHasPatternWidthPrecisionFactor=64;
k.bitsetFillHasUnresolvedReplacementColor=8;k.bitsetFillRandomPatternOffset=4;k.bitsetGenericConsiderAlphaOnly=16;k.bitsetGenericLockColor=2;k.bitsetLineScaleDash=4;k.bitsetMarkerAlignmentMap=1;k.bitsetMarkerAlignmentScreen=0;k.bitsetMarkerOutlineAllowColorOverride=4;k.bitsetMarkerScaleSymbolsProportionally=8;k.bitsetTypeFillOutline=1;k.bufferDataMinimumSize=128;k.bufferDataPoolSize=4;k.chartMaxFields=10;k.collisionBoxPadding=16;k.collisionBucketSize=128;k.collisionEarlyRejectBucketSize=16;k.collisionMaxZoomDelta=
1;k.collisionPlacementPadding=8;k.collisionTileBoxSize=4;k.compressionFactorForU16=128;k.dataDrivenUnit0=4;k.dataDrivenUnit1=5;k.dataDrivenUnit2=6;k.debugLabels=!1;k.defaultSdfTextureSize=128;k.displayRecordIntPerElement=8;k.dotDensityMaxFields=8;k.effectFlag0=128;k.enableEarlyLabelDiscard=!1;k.extrudeScale=64;k.filterFlag0=64;k.filterFlagsUnit=1;k.glyphSize=24;k.gpgpuUnit=12;k.heuristicGlyphsPerFeature=10;k.heuristicGlyphsPerLine=50;k.hittestSmallSymbolThreshold=3;k.hittestToleranceDesktop=1;k.hittestToleranceMobile=
3;k.hittestToleranceSmallSymbol=3;k.labelPlacementOffsetPadding=4;k.localTimeOriginUnit=13;k.magicLabelLineHeight=29;k.maxGeohashLevel=12;k.maxGpuUploadsPerFrame=2;k.maxHighlightReasons=6;k.maxRepresentableInt=16777216;k.maxTextLineWidth=512;k.minMaxZoomPrecisionFactor=10;k.minTextLineWidth=32;k.nanMagicNumber=1E-30;k.patchPixelBufferAllocSize=500;k.patternFillRasterizationScale=2;k.pictureFillColor=4294967295;k.randomInsidePolygonTextureSize=1024;k.rasterTileSize=256;k.rasterizedVectorMarkerMinSize=
128;k.spritePadding=2;k.svgSdfTextureInnerSize=252;k.svgSdfTextureSize=256;k.textureBindingBitmap=0;k.textureBindingGlyphAtlas=0;k.textureBindingHighlight0=5;k.textureBindingHighlight1=6;k.textureBindingRenderer0=5;k.textureBindingRenderer1=6;k.textureBindingSpriteAtlas=0;k.textureUploadManagerBudget=4;k.textureUploadManagerChunkSize=128;k.thinLineHalfWidthThreshold=1.05;k.tileSize=512;k.visualVariableUnit=3;k.vtlHighResCutoff=1.15;k.vtlTextureBindingUnitGlyphs=6;k.vtlTextureBindingUnitSprites=5;
k.webglMaxInnerStops=6;k.webglMaxStops=8;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/brushes/WGLBrush":function(){define(function(){class k{constructor(){this.name=this.constructor.name||"UnnamedBrush";this.brushEffect=null}prepareState(v,r){}draw(v,r,b){}drawMany(v,r,b){for(const e of r)e.visible&&this.draw(v,e,b)}}return k})},"esri/views/2d/engine/webgl/brushes/WGLBrushVTLCircle":function(){define(["exports","../../vectorTiles/style/StyleDefinition",
"./WGLBrush","../../../../webgl/enums"],function(k,v,r,b){class e extends r{constructor(){super(...arguments);this._programOptions={id:!1}}dispose(){}drawMany(g,d){const {context:h,displayLevel:f,requiredLevel:c,state:l,painter:t,spriteMosaic:p,styleLayerUID:w,requestRender:q,allowDelayedRender:B}=g;if(d.some(E=>E.layerData.get(w)?.circleIndexCount??!1)){g=g.styleLayer;var H=g.circleMaterial,y=t.vectorTilesMaterialManager,A=g.getPaintValue("circle-translate",f),C=g.getPaintValue("circle-translate-anchor",
f);y=y.getMaterialProgram(h,H,this._programOptions);if(B&&null!=q&&!y.compiled)q();else{h.useProgram(y);y.setUniformMatrix3fv("u_displayMat3",C===v.TranslateAnchor.VIEWPORT?l.displayMat3:l.displayViewMat3);y.setUniform2fv("u_circleTranslation",A);y.setUniform1f("u_depth",g.z);y.setUniform1f("u_antialiasingWidth",1.2);A=-1;for(const E of d)E.layerData.has(w)&&(E.key.level!==A&&(A=E.key.level,H.setDataUniforms(y,f,g,A,p)),d=E.layerData.get(w),d.circleIndexCount&&(d.prepareForRendering(h),C=d.vao,null!=
C&&(h.bindVAO(C),y.setUniformMatrix3fv("u_dvsMat3",E.transforms.displayViewScreenMat3),c!==E.key.level?h.setStencilFunction(b.CompareFunction.EQUAL,E.stencilRef,255):h.setStencilFunction(b.CompareFunction.GREATER,255,255),h.drawElements(b.PrimitiveType.TRIANGLES,d.circleIndexCount,b.DataType.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*d.circleIndexStart),E.triangleCount+=d.circleIndexCount/3)))}}}}k.WGLBrushVTLCircle=e;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/brushes/WGLBrushVTLFill":function(){define(["exports",
"../../vectorTiles/style/StyleDefinition","../definitions","./WGLBrush","../../../../webgl/enums"],function(k,v,r,b,e){const g=1/65536;class d extends b{constructor(){super(...arguments);this._fillProgramOptions={id:!1,pattern:!1};this._outlineProgramOptions={id:!1}}dispose(){}drawMany(h,f){const {displayLevel:c,renderPass:l,spriteMosaic:t,styleLayerUID:p}=h;var w=!1;for(var q of f)if(q.layerData.has(p)){var B=q.layerData.get(p);if(0<B.fillIndexCount||0<B.outlineIndexCount){w=!0;break}}if(w){w=h.styleLayer;
var H=w.getPaintProperty("fill-pattern");B=(q=void 0!==H)&&H.isDataDriven;if(q&&!B){var y=H.getValue(c);y=t.getMosaicItemPosition(y,!0)}H=!q&&w.getPaintValue("fill-antialias",c);var A=!0,C=1;if(!q){var E=w.getPaintProperty("fill-color"),I=w.getPaintProperty("fill-opacity");E?.isDataDriven||I?.isDataDriven||(C=w.getPaintValue("fill-color",c),C=w.getPaintValue("fill-opacity",c)*C[3],1<=C&&(A=!1))}A&&"opaque"===l||(E=w.getPaintValue("fill-translate",c),I=w.getPaintValue("fill-translate-anchor",c),(A||
"translucent"!==l)&&this._drawFill(h,p,w,f,E,I,q,y,B),y=!w.hasDataDrivenOutlineColor&&w.outlineUsesFillColor&&1>C,H&&"opaque"!==l&&!y&&this._drawOutline(h,p,w,f,E,I))}}_drawFill(h,f,c,l,t,p,w,q,B){if(!w||B||null!=q){var {context:H,displayLevel:y,state:A,painter:C,pixelRatio:E,spriteMosaic:I,requestRender:K,allowDelayedRender:n}=h;h=c.fillMaterial;var x=C.vectorTilesMaterialManager,z=E>r.vtlHighResCutoff?2:1,F=this._fillProgramOptions;F.pattern=w;x=x.getMaterialProgram(H,h,F);if(n&&null!=K&&!x.compiled)K();
else{H.useProgram(x);null!=q&&({page:q}=q,F=I.getPageSize(q),null!=F&&(I.bind(H,e.TextureSamplingMode.LINEAR,q,r.vtlTextureBindingUnitSprites),x.setUniform2fv("u_mosaicSize",F),x.setUniform1i("u_texture",r.vtlTextureBindingUnitSprites)));x.setUniformMatrix3fv("u_displayMat3",p===v.TranslateAnchor.VIEWPORT?A.displayMat3:A.displayViewMat3);x.setUniform2fv("u_fillTranslation",t);x.setUniform1f("u_depth",c.z+g);t=-1;for(const G of l)if(G.layerData.has(f)&&(G.key.level!==t&&(t=G.key.level,h.setDataUniforms(x,
y,c,t,I)),l=G.layerData.get(f),l.fillIndexCount&&(l.prepareForRendering(H),p=l.fillVAO,null!=p))){H.bindVAO(p);x.setUniformMatrix3fv("u_dvsMat3",G.transforms.displayViewScreenMat3);H.setStencilFunction(e.CompareFunction.EQUAL,G.stencilRef,255);w&&x.setUniform1f("u_patternFactor",G.rangeX/(z*G.width*Math.max(2**(Math.round(y)-G.key.level),1)));if(B){p=l.patternMap;if(!p)continue;for(const [L,M]of p)p=I.getPageSize(L),null!=p&&(I.bind(H,e.TextureSamplingMode.LINEAR,L,r.vtlTextureBindingUnitSprites),
x.setUniform2fv("u_mosaicSize",p),x.setUniform1i("u_texture",r.vtlTextureBindingUnitSprites),H.drawElements(e.PrimitiveType.TRIANGLES,M[1],e.DataType.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*M[0]))}else H.drawElements(e.PrimitiveType.TRIANGLES,l.fillIndexCount,e.DataType.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*l.fillIndexStart);G.triangleCount+=l.fillIndexCount/3}}}}_drawOutline(h,f,c,l,t,p){const {context:w,displayLevel:q,state:B,painter:H,pixelRatio:y,spriteMosaic:A,requestRender:C,allowDelayedRender:E}=
h;h=c.outlineMaterial;const I=.75/y,K=H.vectorTilesMaterialManager.getMaterialProgram(w,h,this._outlineProgramOptions);if(E&&null!=C&&!K.compiled)C();else{w.useProgram(K);K.setUniformMatrix3fv("u_displayMat3",p===v.TranslateAnchor.VIEWPORT?B.displayMat3:B.displayViewMat3);K.setUniform2fv("u_fillTranslation",t);K.setUniform1f("u_depth",c.z+g);K.setUniform1f("u_outline_width",I);t=-1;for(const n of l)n.layerData.has(f)&&(n.key.level!==t&&(t=n.key.level,h.setDataUniforms(K,q,c,t,A)),l=n.layerData.get(f),
l.prepareForRendering(w),l.outlineIndexCount&&(p=l.outlineVAO,null!=p&&(w.bindVAO(p),K.setUniformMatrix3fv("u_dvsMat3",n.transforms.displayViewScreenMat3),w.setStencilFunction(e.CompareFunction.EQUAL,n.stencilRef,255),w.drawElements(e.PrimitiveType.TRIANGLES,l.outlineIndexCount,e.DataType.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*l.outlineIndexStart),n.triangleCount+=l.outlineIndexCount/3)))}}}k.WGLBrushVTLFill=d;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/brushes/WGLBrushVTLLine":function(){define(["exports",
"../../vectorTiles/style/StyleDefinition","../definitions","./WGLBrush","../../../../webgl/enums"],function(k,v,r,b,e){class g extends b{constructor(){super(...arguments);this._programOptions={id:!1,pattern:!1,sdf:!1}}dispose(){}drawMany(d,h){const {context:f,displayLevel:c,state:l,painter:t,pixelRatio:p,spriteMosaic:w,styleLayerUID:q,requestRender:B,allowDelayedRender:H}=d;if(h.some(L=>L.layerData.get(q)?.lineIndexCount??!1)){d=d.styleLayer;var y=d.lineMaterial,A=t.vectorTilesMaterialManager,C=d.getPaintValue("line-translate",
c),E=d.getPaintValue("line-translate-anchor",c),I=d.getPaintProperty("line-pattern"),K=void 0!==I,n=K&&I.isDataDriven;if(K&&!n){I=I.getValue(c);var x=w.getMosaicItemPosition(I)}var z;I=!1;if(!K){var F=d.getPaintProperty("line-dasharray");I=(z=void 0!==F)&&F.isDataDriven;z&&!I&&(x=F.getValue(c),x=d.getDashKey(x,d.getLayoutValue("line-cap",c)),x=w.getMosaicItemPosition(x))}F=1/p;var G=this._programOptions;G.pattern=K;G.sdf=z;z=A.getMaterialProgram(f,y,G);if(H&&null!=B&&!z.compiled)B();else{f.useProgram(z);
z.setUniformMatrix3fv("u_displayViewMat3",l.displayViewMat3);z.setUniformMatrix3fv("u_displayMat3",E===v.TranslateAnchor.VIEWPORT?l.displayMat3:l.displayViewMat3);z.setUniform2fv("u_lineTranslation",C);z.setUniform1f("u_depth",d.z);z.setUniform1f("u_antialiasing",F);x&&null!=x&&({page:C}=x,E=w.getPageSize(C),null!=E&&(w.bind(f,e.TextureSamplingMode.LINEAR,C,r.vtlTextureBindingUnitSprites),z.setUniform2fv("u_mosaicSize",E),z.setUniform1i("u_texture",r.vtlTextureBindingUnitSprites)));C=-1;for(const L of h)if(L.layerData.has(q)&&
(L.key.level!==C&&(C=L.key.level,y.setDataUniforms(z,c,d,C,w)),z.setUniform1f("u_zoomFactor",2**(c-C)/p),h=L.layerData.get(q),h.lineIndexCount&&(h.prepareForRendering(f),E=h.vao,null!=E))){f.bindVAO(E);z.setUniformMatrix3fv("u_dvsMat3",L.transforms.displayViewScreenMat3);f.setStencilFunction(e.CompareFunction.EQUAL,L.stencilRef,255);if(n||I){E=h.patternMap;if(!E)continue;for(const [M,O]of E)E=w.getPageSize(M),null!=E&&(w.bind(f,e.TextureSamplingMode.LINEAR,M,r.vtlTextureBindingUnitSprites),z.setUniform2fv("u_mosaicSize",
E),z.setUniform1i("u_texture",r.vtlTextureBindingUnitSprites),f.drawElements(e.PrimitiveType.TRIANGLES,O[1],e.DataType.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*O[0]))}else f.drawElements(e.PrimitiveType.TRIANGLES,h.lineIndexCount,e.DataType.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*h.lineIndexStart);L.triangleCount+=h.lineIndexCount/3}}}}}k.WGLBrushVTLLine=g;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/brushes/WGLBrushVTLSymbol":function(){define("exports ../../../../../core/libs/gl-matrix-2/factories/vec2f32 ../../vectorTiles/decluttering/config ../../vectorTiles/style/StyleDefinition ../definitions ../GeometryUtils ./WGLBrush ../../../../webgl/enums".split(" "),
function(k,v,r,b,e,g,d,h){const f=1/65536;class c extends d{constructor(){super(...arguments);this._iconProgramOptions={id:!1,sdf:!1};this._sdfProgramOptions={id:!1};this._spritesTextureSize=v.create()}dispose(){}drawMany(l,t){const p=l.styleLayer;this._drawIcons(l,p,t);this._drawText(l,p,t)}_drawIcons(l,t,p){const {context:w,displayLevel:q,painter:B,spriteMosaic:H,state:y,styleLayerUID:A,requestRender:C,allowDelayedRender:E}=l,I=t.iconMaterial;var K=B.vectorTilesMaterialManager;let n;var x=!1;for(var z of p)if(z.layerData.has(A)&&
(n=z.layerData.get(A),0<n.iconPerPageElementsMap.size)){x=!0;break}if(x){x=t.getPaintValue("icon-translate",q);z=t.getPaintValue("icon-translate-anchor",q);var F=t.getLayoutValue("icon-rotation-alignment",q);F===b.RotationAlignment.AUTO&&(F=t.getLayoutValue("symbol-placement",q)===b.SymbolPlacement.POINT?b.RotationAlignment.VIEWPORT:b.RotationAlignment.MAP);var G=F===b.RotationAlignment.MAP;G=t.getLayoutValue("icon-keep-upright",q)&&G;var L=this._iconProgramOptions;L.sdf=n.isIconSDF;K=K.getMaterialProgram(w,
I,L);if(E&&null!=C&&!K.compiled)C();else{w.useProgram(K);K.setUniformMatrix3fv("u_displayViewMat3",F===b.RotationAlignment.MAP?y.displayViewMat3:y.displayMat3);K.setUniformMatrix3fv("u_displayMat3",z===b.TranslateAnchor.VIEWPORT?y.displayMat3:y.displayViewMat3);K.setUniform2fv("u_iconTranslation",x);K.setUniform1f("u_depth",t.z);K.setUniform1f("u_mapRotation",g.degToByte(y.rotation));K.setUniform1f("u_keepUpright",G?1:0);K.setUniform1f("u_level",10*q);K.setUniform1i("u_texture",e.vtlTextureBindingUnitSprites);
K.setUniform1f("u_fadeDuration",r.fadeDuration/1E3);x=-1;for(const M of p)if(M.layerData.has(A)&&(M.key.level!==x&&(x=M.key.level,I.setDataUniforms(K,q,t,x,H)),n=M.layerData.get(A),0!==n.iconPerPageElementsMap.size&&(n.prepareForRendering(w),n.updateOpacityInfo(),p=n.iconVAO,null!=p))){w.bindVAO(p);K.setUniformMatrix3fv("u_dvsMat3",M.transforms.displayViewScreenMat3);K.setUniform1f("u_time",(performance.now()-n.lastOpacityUpdate)/1E3);for(const [O,R]of n.iconPerPageElementsMap)this._renderIconRange(l,
K,R,O,M)}}}}_renderIconRange(l,t,p,w,q){const {context:B,spriteMosaic:H}=l;this._spritesTextureSize[0]=H.getWidth(w)/4;this._spritesTextureSize[1]=H.getHeight(w)/4;t.setUniform2fv("u_mosaicSize",this._spritesTextureSize);H.bind(B,h.TextureSamplingMode.LINEAR,w,e.vtlTextureBindingUnitSprites);this._setStencilState(l,q);B.drawElements(h.PrimitiveType.TRIANGLES,p[1],h.DataType.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*p[0]);q.triangleCount+=p[1]/3}_drawText(l,t,p){const {context:w,displayLevel:q,glyphMosaic:B,
painter:H,pixelRatio:y,spriteMosaic:A,state:C,styleLayerUID:E,requestRender:I,allowDelayedRender:K}=l,n=t.textMaterial;var x=H.vectorTilesMaterialManager,z=!1;for(var F of p)if(F.layerData.has(E)){var G=F.layerData.get(E);if(0<G.glyphPerPageElementsMap.size){z=!0;break}}if(z&&(G=t.getPaintProperty("text-opacity"),!G||G.isDataDriven||0!==G.getValue(q))){G=t.getPaintProperty("text-color");var L=!G||G.isDataDriven||0<G.getValue(q)[3];G=t.getPaintProperty("text-halo-width");z=t.getPaintProperty("text-halo-color");
var M=(!G||G.isDataDriven||0<G.getValue(q))&&(!z||z.isDataDriven||0<z.getValue(q)[3]);if(L||M){G=t.getLayoutValue("text-rotation-alignment",q);G===b.RotationAlignment.AUTO&&(G=t.getLayoutValue("symbol-placement",q)===b.SymbolPlacement.POINT?b.RotationAlignment.VIEWPORT:b.RotationAlignment.MAP);z=G===b.RotationAlignment.MAP;z=t.getLayoutValue("text-keep-upright",q)&&z;F=.8*3/y;this._glyphTextureSize||(this._glyphTextureSize=v.fromValues(B.width/4,B.height/4));var O=t.getPaintValue("text-translate",
q),R=t.getPaintValue("text-translate-anchor",q),S=x.getMaterialProgram(w,n,this._sdfProgramOptions);if(K&&null!=I&&!S.compiled)I();else{w.useProgram(S);S.setUniformMatrix3fv("u_displayViewMat3",G===b.RotationAlignment.MAP?C.displayViewMat3:C.displayMat3);S.setUniformMatrix3fv("u_displayMat3",R===b.TranslateAnchor.VIEWPORT?C.displayMat3:C.displayViewMat3);S.setUniform2fv("u_textTranslation",O);S.setUniform1f("u_depth",t.z+f);S.setUniform2fv("u_mosaicSize",this._glyphTextureSize);S.setUniform1f("u_mapRotation",
g.degToByte(C.rotation));S.setUniform1f("u_keepUpright",z?1:0);S.setUniform1f("u_level",10*q);S.setUniform1i("u_texture",e.vtlTextureBindingUnitGlyphs);S.setUniform1f("u_antialiasingWidth",F);S.setUniform1f("u_fadeDuration",r.fadeDuration/1E3);x=-1;for(const U of p)U.layerData.has(E)&&(U.key.level!==x&&(x=U.key.level,n.setDataUniforms(S,q,t,x,A)),G=U.layerData.get(E),0!==G.glyphPerPageElementsMap.size&&(G.prepareForRendering(w),G.updateOpacityInfo(),p=G.textVAO,null!=p&&(w.bindVAO(p),S.setUniformMatrix3fv("u_dvsMat3",
U.transforms.displayViewScreenMat3),this._setStencilState(l,U),p=(performance.now()-G.lastOpacityUpdate)/1E3,S.setUniform1f("u_time",p),G.glyphPerPageElementsMap.forEach((Y,aa)=>{this._renderGlyphRange(w,Y,aa,B,S,M,L,U)}))))}}}}_renderGlyphRange(l,t,p,w,q,B,H,y){w.bind(l,h.TextureSamplingMode.LINEAR,p,e.vtlTextureBindingUnitGlyphs);B&&(q.setUniform1f("u_halo",1),l.drawElements(h.PrimitiveType.TRIANGLES,t[1],h.DataType.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*t[0]),y.triangleCount+=t[1]/3);H&&(q.setUniform1f("u_halo",
0),l.drawElements(h.PrimitiveType.TRIANGLES,t[1],h.DataType.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*t[0]),y.triangleCount+=t[1]/3)}_setStencilState(l,t){const {context:p,is3D:w,stencilSymbols:q}=l;p.setStencilTestEnabled(!0);q?(p.setStencilWriteMask(255),p.setStencilFunction(h.CompareFunction.ALWAYS,t.stencilRef,255)):(p.setStencilWriteMask(0),w?p.setStencilFunction(h.CompareFunction.EQUAL,t.stencilRef,255):p.setStencilFunction(h.CompareFunction.GREATER,255,255))}}k.WGLBrushVTLSymbol=c;Object.defineProperty(k,
Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/GeometryUtils":function(){define(["exports"],function(k){function v(g,d){g%=d;return 0<=g?g:g+d}const r=128/Math.PI,b=256/360,e=1/Math.LN2;k.between=function(g,d,h){return g>=d&&g<=h||g>=h&&g<=d};k.degToByte=function(g){return v(g*b,256)};k.interpolate=function(g,d,h){return g*(1-h)+d*h};k.log2=function(g){return Math.log(g)*e};k.positiveMod=v;k.radToByte=function(g){return v(g*r,256)};Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},
"esri/views/2d/engine/vectorTiles/shaders/VTLMaterialManager":function(){define(["../enums","./Programs"],function(k,v){class r{constructor(){this._programByKey=new Map}dispose(){this._programByKey.forEach(b=>b.dispose());this._programByKey.clear()}getMaterialProgram(b,e,g){const d=e.key<<3|this._getMaterialOptionsValue(e.type,g);if(this._programByKey.has(d))return this._programByKey.get(d);var h=this._getProgramTemplate(e.type);({shaders:h}=h);const {vertexShader:f,fragmentShader:c}=h(g);g=e.getShaderHeader();
h=e.getShaderMain();g=f.replace("#pragma header",g).replace("#pragma main",h);b=b.programCache.acquire(g,c,e.getAttributeLocations());this._programByKey.set(d,b);return b}_getMaterialOptionsValue(b,e){switch(b){case k.ShaderProgramType.BACKGROUND:return(e.pattern?1:0)<<1;case k.ShaderProgramType.FILL:return(e.pattern?1:0)<<1;case k.ShaderProgramType.OUTLINE:return 0;case k.ShaderProgramType.LINE:return(e.sdf?1:0)<<2|(e.pattern?1:0)<<1;case k.ShaderProgramType.ICON:return(e.sdf?1:0)<<1;case k.ShaderProgramType.CIRCLE:return 0;
case k.ShaderProgramType.TEXT:return 0;default:return 0}}_getProgramTemplate(b){switch(b){case k.ShaderProgramType.BACKGROUND:return v.background;case k.ShaderProgramType.CIRCLE:return v.circle;case k.ShaderProgramType.FILL:return v.fill;case k.ShaderProgramType.ICON:return v.icon;case k.ShaderProgramType.LINE:return v.line;case k.ShaderProgramType.OUTLINE:return v.outline;case k.ShaderProgramType.TEXT:return v.text;default:return null}}}return r})},"esri/views/2d/engine/vectorTiles/shaders/Programs":function(){define(["exports",
"./sources/resolver","../../../../webgl/programUtils"],function(k,v,r){k.background={shaders:b=>({vertexShader:r.glslifyDefineMap({PATTERN:b.pattern})+v.resolveIncludes("background/background.vert"),fragmentShader:r.glslifyDefineMap({PATTERN:b.pattern})+v.resolveIncludes("background/background.frag")})};k.circle={shaders:b=>({vertexShader:v.resolveIncludes("circle/circle.vert"),fragmentShader:v.resolveIncludes("circle/circle.frag")})};k.fill={shaders:b=>({vertexShader:r.glslifyDefineMap({PATTERN:b.pattern})+
v.resolveIncludes("fill/fill.vert"),fragmentShader:r.glslifyDefineMap({PATTERN:b.pattern})+v.resolveIncludes("fill/fill.frag")})};k.icon={shaders:b=>({vertexShader:r.glslifyDefineMap({SDF:b.sdf})+v.resolveIncludes("icon/icon.vert"),fragmentShader:r.glslifyDefineMap({SDF:b.sdf})+v.resolveIncludes("icon/icon.frag")})};k.line={shaders:b=>({vertexShader:r.glslifyDefineMap({PATTERN:b.pattern,SDF:b.sdf})+v.resolveIncludes("line/line.vert"),fragmentShader:r.glslifyDefineMap({PATTERN:b.pattern,SDF:b.sdf})+
v.resolveIncludes("line/line.frag")})};k.outline={shaders:b=>({vertexShader:v.resolveIncludes("outline/outline.vert"),fragmentShader:v.resolveIncludes("outline/outline.frag")})};k.text={shaders:b=>({vertexShader:v.resolveIncludes("text/text.vert"),fragmentShader:v.resolveIncludes("text/text.frag")})};Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/shaders/sources/resolver":function(){define(["exports","./shaderRepository","../../../../../webgl/ShaderCompiler"],
function(k,v,r){const b=new r.ShaderCompiler(function(e){let g=v;e.split("/").forEach(d=>{g&&=g[d]});return g});k.resolveIncludes=function(e){return b.resolveIncludes(e)};Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/shaders/sources/shaderRepository":function(){define(function(){return{background:{"background.frag":"#ifdef PATTERN\nuniform lowp float u_opacity;\nuniform lowp sampler2D u_texture;\nvarying mediump vec4 v_tlbr;\nvarying mediump vec2 v_tileTextureCoord;\n#else\nuniform lowp vec4 u_color;\n#endif\nvoid main() {\n#ifdef PATTERN\nmediump vec2 normalizedTextureCoord \x3d mod(v_tileTextureCoord, 1.0);\nmediump vec2 samplePos \x3d mix(v_tlbr.xy, v_tlbr.zw, normalizedTextureCoord);\nlowp vec4 color \x3d texture2D(u_texture, samplePos);\ngl_FragColor \x3d u_opacity * color;\n#else\ngl_FragColor \x3d u_color;\n#endif\n}",
"background.vert":"precision mediump float;\nattribute vec2 a_pos;\nuniform highp mat3 u_dvsMat3;\nuniform mediump float u_coord_range;\nuniform mediump float u_depth;\n#ifdef PATTERN\nuniform mediump mat3 u_pattern_matrix;\nvarying mediump vec2 v_tileTextureCoord;\nuniform mediump vec4 u_tlbr;\nuniform mediump vec2 u_mosaicSize;\nvarying mediump vec4 v_tlbr;\n#endif\nvoid main() {\ngl_Position \x3d vec4((u_dvsMat3 * vec3(u_coord_range * a_pos, 1.0)).xy, u_depth, 1.0);\n#ifdef PATTERN\nv_tileTextureCoord \x3d (u_pattern_matrix * vec3(a_pos, 1.0)).xy;\nv_tlbr             \x3d u_tlbr / u_mosaicSize.xyxy;\n#endif\n}"},
circle:{"circle.frag":"precision lowp float;\nvarying lowp vec4 v_color;\nvarying lowp vec4 v_stroke_color;\nvarying mediump float v_blur;\nvarying mediump float v_stroke_width;\nvarying mediump float v_radius;\nvarying mediump vec2 v_offset;\nvoid main()\n{\nmediump float dist \x3d length(v_offset);\nmediump float alpha \x3d smoothstep(0.0, -v_blur, dist - 1.0);\nlowp float color_mix_ratio \x3d v_stroke_width \x3c 0.01 ? 0.0 : smoothstep(-v_blur, 0.0, dist - v_radius / (v_radius + v_stroke_width));\ngl_FragColor \x3d alpha * mix(v_color, v_stroke_color, color_mix_ratio);\n}",
"circle.vert":"precision mediump float;\nattribute vec2 a_pos;\n#pragma header\nvarying lowp vec4 v_color;\nvarying lowp vec4 v_stroke_color;\nvarying mediump float v_blur;\nvarying mediump float v_stroke_width;\nvarying mediump float v_radius;\nvarying mediump vec2 v_offset;\nuniform highp mat3 u_dvsMat3;\nuniform highp mat3 u_displayMat3;\nuniform mediump vec2 u_circleTranslation;\nuniform mediump float u_depth;\nuniform mediump float u_antialiasingWidth;\nvoid main()\n{\n#pragma main\nv_color \x3d color * opacity;\nv_stroke_color \x3d stroke_color * stroke_opacity;\nv_stroke_width \x3d stroke_width;\nv_radius \x3d radius;\nv_blur \x3d max(blur, u_antialiasingWidth / (radius + stroke_width));\nmediump vec2 offset \x3d vec2(mod(a_pos, 2.0) * 2.0 - 1.0);\nv_offset \x3d offset;\nmediump vec3 pos \x3d u_dvsMat3 * vec3(a_pos * 0.5, 1.0) + u_displayMat3 * vec3((v_radius + v_stroke_width) * offset + u_circleTranslation, 0.0);\ngl_Position \x3d vec4(pos.xy, u_depth, 1.0);\n}"},
fill:{"fill.frag":"precision lowp float;\n#ifdef PATTERN\nuniform lowp sampler2D u_texture;\nvarying mediump vec2 v_tileTextureCoord;\nvarying mediump vec4 v_tlbr;\n#endif\nvarying lowp vec4 v_color;\nvec4 mixColors(vec4 color1, vec4 color2) {\nfloat compositeAlpha \x3d color2.a + color1.a * (1.0 - color2.a);\nvec3 compositeColor \x3d color2.rgb + color1.rgb * (1.0 - color2.a);\nreturn vec4(compositeColor, compositeAlpha);\n}\nvoid main()\n{\n#ifdef PATTERN\nmediump vec2 normalizedTextureCoord \x3d fract(v_tileTextureCoord);\nmediump vec2 samplePos \x3d mix(v_tlbr.xy, v_tlbr.zw, normalizedTextureCoord);\nlowp vec4 color \x3d texture2D(u_texture, samplePos);\ngl_FragColor \x3d v_color[3] * color;\n#else\ngl_FragColor \x3d v_color;\n#endif\n}",
"fill.vert":"precision mediump float;\nattribute vec2 a_pos;\n#pragma header\nuniform highp mat3 u_dvsMat3;\nuniform highp mat3 u_displayMat3;\nuniform mediump float u_depth;\nuniform mediump vec2 u_fillTranslation;\n#ifdef PATTERN\n#include \x3cutil/util.glsl\x3e\nuniform mediump vec2 u_mosaicSize;\nuniform mediump float u_patternFactor;\nvarying mediump vec2 v_tileTextureCoord;\nvarying mediump vec4 v_tlbr;\n#endif\nvarying lowp vec4 v_color;\nvoid main()\n{\n#pragma main\nv_color \x3d color * opacity;\n#ifdef PATTERN\nfloat patternWidth \x3d nextPOT(tlbr.z - tlbr.x);\nfloat patternHeight \x3d nextPOT(tlbr.w - tlbr.y);\nfloat scaleX \x3d 1.0 / (patternWidth * u_patternFactor);\nfloat scaleY \x3d 1.0 / (patternHeight * u_patternFactor);\nmat3 patterMat \x3d mat3(scaleX, 0.0,    0.0,\n0.0,    -scaleY, 0.0,\n0.0,    0.0,    1.0);\nv_tileTextureCoord \x3d (patterMat * vec3(a_pos, 1.0)).xy;\nv_tlbr             \x3d tlbr / u_mosaicSize.xyxy;\n#endif\nvec3 pos \x3d u_dvsMat3 * vec3(a_pos, 1.0) + u_displayMat3 * vec3(u_fillTranslation, 0.0);\ngl_Position \x3d vec4(pos.xy, u_depth, 1.0);\n}"},
icon:{"icon.frag":"precision mediump float;\nuniform lowp sampler2D u_texture;\n#ifdef SDF\nuniform lowp vec4 u_color;\nuniform lowp vec4 u_outlineColor;\n#endif\nvarying mediump vec2 v_tex;\nvarying lowp float v_opacity;\nvarying mediump vec2 v_size;\nvarying lowp vec4 v_color;\n#ifdef SDF\nvarying mediump flaot v_halo_width;\n#endif\n#include \x3cutil/encoding.glsl\x3e\nvec4 mixColors(vec4 color1, vec4 color2) {\nfloat compositeAlpha \x3d color2.a + color1.a * (1.0 - color2.a);\nvec3 compositeColor \x3d color2.rgb + color1.rgb * (1.0 - color2.a);\nreturn vec4(compositeColor, compositeAlpha);\n}\nvoid main()\n{\n#ifdef SDF\nlowp vec4 fillPixelColor \x3d v_color;\nfloat d \x3d rgba2float(texture2D(u_texture, v_tex)) - 0.5;\nconst float softEdgeRatio \x3d 0.248062016;\nfloat size \x3d max(v_size.x, v_size.y);\nfloat dist \x3d d * softEdgeRatio * size;\nfillPixelColor *\x3d clamp(0.5 - dist, 0.0, 1.0);\nif (v_halo_width \x3e 0.25) {\nlowp vec4 outlinePixelColor \x3d u_outlineColor;\nconst float outlineLimitRatio \x3d (16.0 / 86.0);\nfloat clampedOutlineSize \x3d softEdgeRatio * min(v_halo_width, outlineLimitRatio * max(v_size.x, v_size.y));\noutlinePixelColor *\x3d clamp(0.5 - (abs(dist) - clampedOutlineSize), 0.0, 1.0);\ngl_FragColor \x3d v_opacity * mixColors(fillPixelColor, outlinePixelColor);\n}\nelse {\ngl_FragColor \x3d v_opacity * fillPixelColor;\n}\n#else\nlowp vec4 texColor \x3d texture2D(u_texture, v_tex);\ngl_FragColor \x3d v_opacity * texColor;\n#endif\n}",
"icon.vert":"attribute vec2 a_pos;\nattribute vec2 a_vertexOffset;\nattribute vec4 a_texAngleRange;\nattribute vec4 a_levelInfo;\nattribute float a_opacityInfo;\n#pragma header\nvarying lowp vec4 v_color;\n#ifdef SDF\nvarying mediump float v_halo_width;\n#endif\nuniform highp mat3 u_dvsMat3;\nuniform highp mat3 u_displayMat3;\nuniform highp mat3 u_displayViewMat3;\nuniform mediump vec2 u_iconTranslation;\nuniform vec2 u_mosaicSize;\nuniform mediump float u_depth;\nuniform mediump float u_mapRotation;\nuniform mediump float u_level;\nuniform lowp float u_keepUpright;\nuniform mediump float u_fadeDuration;\nvarying mediump vec2 v_tex;\nvarying lowp float v_opacity;\nvarying mediump vec2 v_size;\nconst float C_OFFSET_PRECISION \x3d 1.0 / 8.0;\nconst float C_256_TO_RAD \x3d 3.14159265359 / 128.0;\nconst float C_DEG_TO_RAD \x3d 3.14159265359 / 180.0;\nconst float tileCoordRatio \x3d 1.0 / 8.0;\nuniform highp float u_time;\nvoid main()\n{\n#pragma main\nv_color \x3d color;\nv_opacity \x3d opacity;\n#ifdef SDF\nv_halo_width \x3d halo_width;\n#endif\nfloat modded \x3d mod(a_opacityInfo, 128.0);\nfloat targetOpacity \x3d (a_opacityInfo - modded) / 128.0;\nfloat startOpacity \x3d modded / 127.0;\nfloat interpolatedOpacity \x3d clamp(startOpacity + 2.0 * (targetOpacity - 0.5) * u_time / u_fadeDuration, 0.0, 1.0);\nv_opacity *\x3d interpolatedOpacity;\nmediump float a_angle         \x3d a_levelInfo[1];\nmediump float a_minLevel      \x3d a_levelInfo[2];\nmediump float a_maxLevel      \x3d a_levelInfo[3];\nmediump vec2 a_tex            \x3d a_texAngleRange.xy;\nmediump float delta_z \x3d 0.0;\nmediump float rotated \x3d mod(a_angle + u_mapRotation, 256.0);\ndelta_z +\x3d (1.0 - step(u_keepUpright, 0.0)) * step(64.0, rotated) * (1.0 - step(192.0, rotated));\ndelta_z +\x3d 1.0 - step(a_minLevel, u_level);\ndelta_z +\x3d step(a_maxLevel, u_level);\ndelta_z +\x3d step(v_opacity, 0.0);\nvec2 offset \x3d C_OFFSET_PRECISION * a_vertexOffset;\nv_size \x3d abs(offset);\n#ifdef SDF\noffset \x3d (120.0 / 86.0) * offset;\n#endif\nmediump vec3 pos \x3d u_dvsMat3 * vec3(a_pos, 1.0) + u_displayViewMat3 * vec3(size * offset, 0.0) + u_displayMat3 * vec3(u_iconTranslation, 0.0);\ngl_Position \x3d vec4(pos.xy, u_depth + delta_z, 1.0);\nv_tex \x3d a_tex.xy / u_mosaicSize;\n}"},
line:{"line.frag":"precision lowp float;\nvarying mediump vec2 v_normal;\nvarying highp float v_accumulatedDistance;\nvarying mediump float v_lineHalfWidth;\nvarying lowp vec4 v_color;\nvarying mediump float v_blur;\n#if defined (PATTERN) || defined(SDF)\nvarying mediump vec4 v_tlbr;\nvarying mediump vec2 v_patternSize;\nvarying mediump float v_widthRatio;\nuniform sampler2D u_texture;\nuniform mediump float u_antialiasing;\n#endif\n#ifdef SDF\n#include \x3cutil/encoding.glsl\x3e\n#endif\nvoid main()\n{\nmediump float fragDist \x3d length(v_normal) * v_lineHalfWidth;\nlowp float alpha \x3d clamp((v_lineHalfWidth - fragDist) / v_blur, 0.0, 1.0);\n#ifdef PATTERN\nmediump float relativeTexX \x3d fract(v_accumulatedDistance / (v_patternSize.x * v_widthRatio));\nmediump float relativeTexY \x3d 0.5 + v_normal.y * v_lineHalfWidth / (v_patternSize.y * v_widthRatio);\nmediump vec2 texCoord \x3d mix(v_tlbr.xy, v_tlbr.zw, vec2(relativeTexX, relativeTexY));\nlowp vec4 color \x3d texture2D(u_texture, texCoord);\ngl_FragColor \x3d alpha * v_color[3] * color;\n#elif defined(SDF)\nmediump float relativeTexX \x3d fract((v_accumulatedDistance * 0.5) / (v_patternSize.x * v_widthRatio));\nmediump float relativeTexY \x3d  0.5 + 0.25 * v_normal.y;\nmediump vec2 texCoord \x3d mix(v_tlbr.xy, v_tlbr.zw, vec2(relativeTexX, relativeTexY));\nmediump float d \x3d rgba2float(texture2D(u_texture, texCoord)) - 0.5;\nfloat dist \x3d d * (v_lineHalfWidth + u_antialiasing / 2.0);\ngl_FragColor \x3d alpha * clamp(0.5 - dist, 0.0, 1.0) * v_color;\n#else\ngl_FragColor \x3d alpha * v_color;\n#endif\n}",
"line.vert":"precision mediump float;\nattribute vec2 a_pos;\nattribute vec4 a_extrude_offset;\nattribute vec4 a_dir_normal;\nattribute vec2 a_accumulatedDistance;\n#pragma header\nuniform highp mat3 u_dvsMat3;\nuniform highp mat3 u_displayMat3;\nuniform highp mat3 u_displayViewMat3;\nuniform mediump float u_zoomFactor;\nuniform mediump vec2 u_lineTranslation;\nuniform mediump float u_antialiasing;\nuniform mediump float u_depth;\nvarying mediump vec2 v_normal;\nvarying highp float v_accumulatedDistance;\nconst float scale \x3d 1.0 / 31.0;\nconst mediump float tileCoordRatio \x3d 8.0;\n#if defined (SDF)\nconst mediump float sdfPatternHalfWidth \x3d 15.5;\n#endif\n#if defined (PATTERN) || defined(SDF)\nuniform mediump vec2 u_mosaicSize;\nvarying mediump vec4 v_tlbr;\nvarying mediump vec2 v_patternSize;\nvarying mediump float v_widthRatio;\n#endif\nvarying lowp vec4 v_color;\nvarying mediump float v_lineHalfWidth;\nvarying mediump float v_blur;\nvoid main()\n{\n#pragma main\nv_color \x3d color * opacity;\nv_blur \x3d blur + u_antialiasing;\nv_normal \x3d a_dir_normal.zw * scale;\n#if defined (PATTERN) || defined(SDF)\nv_tlbr          \x3d tlbr / u_mosaicSize.xyxy;\nv_patternSize   \x3d vec2(tlbr.z - tlbr.x, tlbr.y - tlbr.w);\n#if defined (PATTERN)\nv_widthRatio \x3d width / v_patternSize.y;\n#else\nv_widthRatio \x3d width / sdfPatternHalfWidth / 2.0;\n#endif\n#endif\nv_lineHalfWidth \x3d (width + u_antialiasing) * 0.5;\nmediump vec2 dir \x3d a_dir_normal.xy * scale;\nmediump vec2 offset_ \x3d a_extrude_offset.zw * scale * offset;\nmediump vec2 dist \x3d v_lineHalfWidth * scale * a_extrude_offset.xy;\nmediump vec3 pos \x3d u_dvsMat3 * vec3(a_pos + offset_ * tileCoordRatio / u_zoomFactor, 1.0) + u_displayViewMat3 * vec3(dist, 0.0) + u_displayMat3 * vec3(u_lineTranslation, 0.0);\ngl_Position \x3d vec4(pos.xy, u_depth, 1.0);\n#if defined (PATTERN) || defined(SDF)\nv_accumulatedDistance \x3d a_accumulatedDistance.x * u_zoomFactor / tileCoordRatio + dot(dir, dist + offset_);\n#endif\n}"},
outline:{"outline.frag":"varying lowp vec4 v_color;\nvarying mediump vec2 v_normal;\nvoid main()\n{\nlowp float dist \x3d abs(v_normal.y);\nlowp float alpha \x3d smoothstep(1.0, 0.0, dist);\ngl_FragColor \x3d alpha * v_color;\n}","outline.vert":"attribute vec2 a_pos;\nattribute vec2 a_offset;\nattribute vec2 a_xnormal;\n#pragma header\nvarying lowp vec4 v_color;\nuniform highp mat3 u_dvsMat3;\nuniform highp mat3 u_displayMat3;\nuniform mediump vec2 u_fillTranslation;\nuniform mediump float u_depth;\nuniform mediump float u_outline_width;\nvarying lowp vec2 v_normal;\nconst float scale \x3d 1.0 / 15.0;\nvoid main()\n{\n#pragma main\nv_color \x3d color * opacity;\nv_normal \x3d a_xnormal;\nmediump vec2 dist \x3d u_outline_width * scale * a_offset;\nmediump vec3 pos \x3d u_dvsMat3 * vec3(a_pos, 1.0) + u_displayMat3 * vec3(dist + u_fillTranslation, 0.0);\ngl_Position \x3d vec4(pos.xy, u_depth, 1.0);\n}"},
text:{"text.frag":"uniform lowp sampler2D u_texture;\nvarying lowp vec2 v_tex;\nvarying lowp vec4 v_color;\nvarying mediump float v_edgeWidth;\nvarying mediump float v_edgeDistance;\nvoid main()\n{\nlowp float dist \x3d texture2D(u_texture, v_tex).a;\nmediump float alpha \x3d smoothstep(v_edgeDistance - v_edgeWidth, v_edgeDistance + v_edgeWidth, dist);\ngl_FragColor \x3d alpha * v_color;\n}","text.vert":"attribute vec2 a_pos;\nattribute vec2 a_vertexOffset;\nattribute vec4 a_texAngleRange;\nattribute vec4 a_levelInfo;\nattribute float a_opacityInfo;\n#pragma header\nvarying lowp vec4 v_color;\nuniform highp mat3 u_dvsMat3;\nuniform highp mat3 u_displayMat3;\nuniform highp mat3 u_displayViewMat3;\nuniform mediump vec2 u_textTranslation;\nuniform vec2 u_mosaicSize;\nuniform mediump float u_depth;\nuniform mediump float u_mapRotation;\nuniform mediump float u_level;\nuniform lowp float u_keepUpright;\nuniform mediump float u_fadeDuration;\nvarying lowp vec2 v_tex;\nconst float offsetPrecision \x3d 1.0 / 8.0;\nconst mediump float edgePos \x3d 0.75;\nuniform mediump float u_antialiasingWidth;\nvarying mediump float v_edgeDistance;\nvarying mediump float v_edgeWidth;\nuniform lowp float u_halo;\nconst float sdfFontScale \x3d 1.0 / 24.0;\nconst float sdfPixel \x3d 3.0;\nuniform highp float u_time;\nvoid main()\n{\n#pragma main\nif (u_halo \x3e 0.5)\n{\nv_color \x3d halo_color * opacity;\nhalo_width *\x3d sdfPixel;\nhalo_blur *\x3d sdfPixel;\n}\nelse\n{\nv_color \x3d color * opacity;\nhalo_width \x3d 0.0;\nhalo_blur \x3d 0.0;\n}\nfloat modded \x3d mod(a_opacityInfo, 128.0);\nfloat targetOpacity \x3d (a_opacityInfo - modded) / 128.0;\nfloat startOpacity \x3d modded / 127.0;\nfloat interpolatedOpacity \x3d clamp(startOpacity + 2.0 * (targetOpacity - 0.5) * u_time / u_fadeDuration, 0.0, 1.0);\nv_color *\x3d interpolatedOpacity;\nmediump float a_angle       \x3d a_levelInfo[1];\nmediump float a_minLevel    \x3d a_levelInfo[2];\nmediump float a_maxLevel    \x3d a_levelInfo[3];\nmediump vec2 a_tex          \x3d a_texAngleRange.xy;\nmediump float a_visMinAngle    \x3d a_texAngleRange.z;\nmediump float a_visMaxAngle    \x3d a_texAngleRange.w;\nmediump float delta_z \x3d 0.0;\nmediump float angle \x3d mod(a_angle + u_mapRotation, 256.0);\nif (a_visMinAngle \x3c a_visMaxAngle)\n{\ndelta_z +\x3d (1.0 - step(u_keepUpright, 0.0)) * (step(a_visMaxAngle, angle) + (1.0 - step(a_visMinAngle, angle)));\n}\nelse\n{\ndelta_z +\x3d (1.0 - step(u_keepUpright, 0.0)) * (step(a_visMaxAngle, angle) * (1.0 - step(a_visMinAngle, angle)));\n}\ndelta_z +\x3d 1.0 - step(a_minLevel, u_level);\ndelta_z +\x3d step(a_maxLevel, u_level);\ndelta_z +\x3d step(v_color[3], 0.0);\nv_tex \x3d a_tex.xy / u_mosaicSize;\nv_edgeDistance \x3d edgePos - halo_width / size;\nv_edgeWidth \x3d (u_antialiasingWidth + halo_blur) / size;\nmediump vec3 pos \x3d u_dvsMat3 * vec3(a_pos, 1.0) + sdfFontScale * u_displayViewMat3 * vec3(offsetPrecision * size * a_vertexOffset, 0.0) + u_displayMat3 * vec3(u_textTranslation, 0.0);\ngl_Position \x3d vec4(pos.xy, u_depth + delta_z, 1.0);\n}"},
util:{"encoding.glsl":"const vec4 rgba2float_factors \x3d vec4(\n255.0 / (256.0),\n255.0 / (256.0 * 256.0),\n255.0 / (256.0 * 256.0 * 256.0),\n255.0 / (256.0 * 256.0 * 256.0 * 256.0)\n);\nfloat rgba2float(vec4 rgba) {\nreturn dot(rgba, rgba2float_factors);\n}","util.glsl":"float nextPOT(in float x) {\nreturn pow(2.0, ceil(log2(abs(x))));\n}"}}})},"esri/views/webgl/ShaderCompiler":function(){define(["exports"],function(k){class v{constructor(r){this._readFile=r}resolveIncludes(r){return this._resolve(r)}_resolve(r,
b=new Map){if(b.has(r))return b.get(r);const e=this._read(r);if(!e)throw Error(`cannot find shader file ${r}`);const g=/^[^\S\n]*#include\s+<(\S+)>[^\S\n]?/gm;let d=g.exec(e);const h=[];for(;null!=d;)h.push({path:d[1],start:d.index,length:d[0].length}),d=g.exec(e);let f=0,c="";h.forEach(l=>{c+=e.slice(f,l.start);c+=b.has(l.path)?"":this._resolve(l.path,b);f=l.start+l.length});c+=e.slice(f);b.set(r,c);return c}_read(r){return this._readFile(r)}}k.ShaderCompiler=v;Object.defineProperty(k,Symbol.toStringTag,
{value:"Module"})})},"esri/views/webgl/programUtils":function(){define(["exports"],function(k){k.glslifyDefineMap=function(v){let r="";for(const e in v){var b=v[e];if("boolean"===typeof b)b&&(r+=`#define ${e}\n`);else if("number"===typeof b)r+=`#define ${e} ${b.toFixed()}\n`;else if("object"===typeof b){const {options:g,value:d}=b;if("number"===typeof g[d]){const {value:h,options:f,namespace:c}=b;b=c?`${c}_`:"";for(const l in f)r+=`#define ${b}${l} ${f[l].toFixed()}\n`;r+=`#define ${e} ${b}${h}\n`}else{const h=
b.options;let f=0;for(const c in h)r+=`#define ${h[c]} ${(f++).toFixed()}\n`;r+=`#define ${e} ${h[b.value]}\n`}}}return r};Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/style/StyleRepository":function(){define(["./StyleDefinition","./StyleLayer"],function(k,v){class r{constructor(b){this._style=b;this.backgroundBucketIds=[];this._uidToLayer=new Map;this._layerByName={};this._runningId=0;b.layers||(b.layers=[]);this.version=parseFloat(b.version);
if(this.layers=b.layers.map((e,g,d)=>this._create(e,g,d)).filter(e=>!!e))for(b=0;b<this.layers.length;b++){const e=this.layers[b];this._layerByName[e.id]=e;this._uidToLayer.set(e.uid,e);e.type===k.StyleLayerType.BACKGROUND&&this.backgroundBucketIds.push(e.id)}this._identifyRefLayers()}isPainterDataDriven(b){return(b=this._layerByName[b])?b.isPainterDataDriven():!1}getStyleLayerId(b){return b>=this.layers.length?null:this.layers[b].id}getStyleLayerByUID(b){return this._uidToLayer.get(b)??null}getStyleLayerIndex(b){return(b=
this._layerByName[b])?this.layers.indexOf(b):-1}setStyleLayer(b,e){if(b?.id){var g=this._style;null!=e&&e>=this.layers.length&&(e=this.layers.length-1);var d=!0,h;if(h=this._layerByName[b.id]){const f=this.layers.indexOf(h);e||=f;e===f?(d=!1,h=r._recreateLayer(b,h),this.layers[e]=h,g.layers[e]=b):(this.layers.splice(f,1),g.layers.splice(f,1),h=this._create(b,e,this.layers),this.layers.splice(e,0,h),g.layers.splice(e,0,b))}else h=this._create(b,e,this.layers),!e||e>=this.layers.length?(this.layers.push(h),
g.layers.push(b)):(this.layers.splice(e,0,h),g.layers.splice(e,0,b));this._layerByName[b.id]=h;this._uidToLayer.set(h.uid,h);d&&this._recomputeZValues();this._identifyRefLayers()}}getStyleLayer(b){return(b=this._layerByName[b])?{type:b.typeName,id:b.id,source:b.source,"source-layer":b.sourceLayer,minzoom:b.minzoom,maxzoom:b.maxzoom,filter:b.filter,layout:b.layout,paint:b.paint}:null}deleteStyleLayer(b){const e=this._layerByName[b];e&&(delete this._layerByName[b],this._uidToLayer.delete(e.uid),b=this.layers.indexOf(e),
this.layers.splice(b,1),this._style.layers.splice(b,1),this._recomputeZValues(),this._identifyRefLayers())}getLayerById(b){return this._layerByName[b]}getLayoutProperties(b){return(b=this._layerByName[b])?b.layout:null}getPaintProperties(b){return(b=this._layerByName[b])?b.paint:null}setPaintProperties(b,e){if(b=this._layerByName[b]){var g=r._recreateLayer({type:b.typeName,id:b.id,source:b.source,"source-layer":b.sourceLayer,minzoom:b.minzoom,maxzoom:b.maxzoom,filter:b.filter,layout:b.layout,paint:e},
b),d=this.layers.indexOf(b);this.layers[d]=g;this._style.layers[d].paint=e;this._layerByName[b.id]=g;this._uidToLayer.set(b.uid,g)}}setLayoutProperties(b,e){if(b=this._layerByName[b]){var g=r._recreateLayer({type:b.typeName,id:b.id,source:b.source,"source-layer":b.sourceLayer,minzoom:b.minzoom,maxzoom:b.maxzoom,filter:b.filter,layout:e,paint:b.paint},b),d=this.layers.indexOf(b);this.layers[d]=g;this._style.layers[d].layout=e;this._layerByName[b.id]=g;this._uidToLayer.set(b.uid,g)}}setStyleLayerVisibility(b,
e){if(b=this._layerByName[b]){var g=b.layout||{};g.visibility=e;e=r._recreateLayer({type:b.typeName,id:b.id,source:b.source,"source-layer":b.sourceLayer,minzoom:b.minzoom,maxzoom:b.maxzoom,filter:b.filter,layout:g,paint:b.paint},b);var d=this.layers.indexOf(b);this.layers[d]=e;this._style.layers[d].layout=g;this._layerByName[b.id]=e;this._uidToLayer.set(b.uid,e)}}getStyleLayerVisibility(b){return(b=this._layerByName[b])?b.layout?.visibility??"visible":"none"}_recomputeZValues(){const b=this.layers,
e=1/(b.length+1);for(let g=0;g<b.length;g++)b[g].z=1-(1+g)*e}_identifyRefLayers(){const b=[],e=[];let g=0;for(const f of this.layers){const c=f.layout;if(f.type===k.StyleLayerType.FILL){var d=f,h=f.source+"|"+f.sourceLayer;h+="|"+(c?.visibility??"");h+="|"+f.minzoom;h+="|"+f.maxzoom;h+="|"+JSON.stringify(f.filter);if(d.hasDataDrivenFill||d.hasDataDrivenOutline)h+="|"+g;b.push({key:h,layer:f})}else if(f.type===k.StyleLayerType.LINE){d=f;h=f.paint;h=null!=h&&(null!=h["line-pattern"]||null!=h["line-dasharray"]);
let l=f.source+"|"+f.sourceLayer;l+="|"+(c?.visibility??"");l+="|"+f.minzoom;l+="|"+f.maxzoom;l+="|"+JSON.stringify(f.filter);l+="|"+(void 0!==c?c["line-cap"]:"");l+="|"+(void 0!==c?c["line-join"]:"");if(d.hasDataDrivenLine||h)l+="|"+g;e.push({key:l,layer:f})}++g}this._assignRefLayers(b);this._assignRefLayers(e)}_assignRefLayers(b){b.sort((c,l)=>c.key<l.key?-1:c.key>l.key?1:0);let e,g;const d=b.length;for(let c=0;c<d;c++){const l=b[c];if(l.key===e)l.layer.refLayerId=g;else if(e=l.key,g=l.layer.id,
l.layer.type===k.StyleLayerType.FILL){if(!l.layer.getPaintProperty("fill-outline-color"))for(var h=c+1;h<d;h++){var f=b[h];if(f.key===e){if(f.layer.getPaintProperty("fill-outline-color")){b[c]=f;b[h]=l;g=f.layer.id;break}}else break}}else if(l.layer.type===k.StyleLayerType.LINE)for(h=l.layer,f=c+1;f<d;f++){const t=b[f];if(t.key!==e)break;const p=t.layer;if(h.canUseThinTessellation&&!p.canUseThinTessellation||!h.canUseThinTessellation&&(p.getPaintProperty("line-pattern")||p.getPaintProperty("line-dasharray")))h=
p,b[c]=t,b[f]=l,g=t.layer.id}}}_create(b,e,g){e=1-1/(g.length+1)*(1+e);g=this._runningId++;switch(b.type){case "background":return new v.BackgroundStyleLayer(k.StyleLayerType.BACKGROUND,b,e,g);case "fill":return new v.FillStyleLayer(k.StyleLayerType.FILL,b,e,g);case "line":return new v.LineStyleLayer(k.StyleLayerType.LINE,b,e,g);case "symbol":return new v.SymbolStyleLayer(k.StyleLayerType.SYMBOL,b,e,g);case "raster":console.warn(`Unsupported vector tile raster layer ${b.id}`);break;case "circle":return new v.CircleStyleLayer(k.StyleLayerType.CIRCLE,
b,e,g)}return null}static _recreateLayer(b,e){switch(b.type){case "background":return new v.BackgroundStyleLayer(k.StyleLayerType.BACKGROUND,b,e.z,e.uid);case "fill":return new v.FillStyleLayer(k.StyleLayerType.FILL,b,e.z,e.uid);case "line":return new v.LineStyleLayer(k.StyleLayerType.LINE,b,e.z,e.uid);case "symbol":return new v.SymbolStyleLayer(k.StyleLayerType.SYMBOL,b,e.z,e.uid);case "raster":console.warn(`Unsupported vector tile raster layer ${b.id}`);break;case "circle":return new v.CircleStyleLayer(k.StyleLayerType.CIRCLE,
b,e.z,e.uid)}return null}}return r})},"esri/views/2d/engine/vectorTiles/style/StyleLayer":function(){define("exports ../../../../../geometry/support/aaBoundingRect ../enums ../GeometryUtils ../shaders/VTLBackgroundMaterial ../shaders/VTLCircleMaterial ../shaders/VTLFillMaterial ../shaders/VTLLineMaterial ../shaders/VTLSymbolMaterial ./Filter ./StyleDefinition ./StyleProperty ../../webgl/definitions".split(" "),function(k,v,r,b,e,g,d,h,f,c,l,t,p){function w(n){n=n?.getGeometry();if(null==n)return null;
let x=Infinity,z=Infinity,F=-Infinity,G=-Infinity;for(const L of n)if(L)for(const M of L)x=Math.min(x,M.x),z=Math.min(z,M.y),F=Math.max(F,M.x),G=Math.max(G,M.y);return v.fromValues(x,z,F,G)}k.CapType=void 0;(function(n){n[n.BUTT=0]="BUTT";n[n.ROUND=1]="ROUND";n[n.SQUARE=2]="SQUARE";n[n.UNKNOWN=4]="UNKNOWN"})(k.CapType||(k.CapType={}));class q{constructor(n,x,z,F,G,L){this.layer=n;this.feature=x;this.bounds=z;this.normalizationRatio=F;this.normalizationOffsetX=G;this.normalizationOffsetY=L}}class B{constructor(n,
x,z,F){this.type=n;this.typeName=x.type;this.id=x.id;this.source=x.source;this.sourceLayer=x["source-layer"];this.minzoom=x.minzoom;this.maxzoom=x.maxzoom;this.filter=x.filter;this.layout=x.layout;this.paint=x.paint;this.z=z;this.uid=F;switch(n){case l.StyleLayerType.BACKGROUND:this._layoutDefinition=l.StyleDefinition.backgroundLayoutDefinition;this._paintDefinition=l.StyleDefinition.backgroundPaintDefinition;break;case l.StyleLayerType.FILL:this._layoutDefinition=l.StyleDefinition.fillLayoutDefinition;
this._paintDefinition=l.StyleDefinition.fillPaintDefinition;break;case l.StyleLayerType.LINE:this._layoutDefinition=l.StyleDefinition.lineLayoutDefinition;this._paintDefinition=l.StyleDefinition.linePaintDefinition;break;case l.StyleLayerType.SYMBOL:this._layoutDefinition=l.StyleDefinition.symbolLayoutDefinition;this._paintDefinition=l.StyleDefinition.symbolPaintDefinition;break;case l.StyleLayerType.CIRCLE:this._layoutDefinition=l.StyleDefinition.circleLayoutDefinition,this._paintDefinition=l.StyleDefinition.circlePaintDefinition}this._layoutProperties=
this._parseLayout(this.layout);this._paintProperties=this._parsePaint(this.paint)}getFeatureFilter(){return void 0!==this._featureFilter?this._featureFilter:this._featureFilter=c.createFilter(this.filter)}getLayoutProperty(n){return this._layoutProperties[n]}getPaintProperty(n){return this._paintProperties[n]}getLayoutValue(n,x,z){let F;const G=this._layoutProperties[n];G&&(F=G.getValue(x,z));void 0===F&&(F=this._layoutDefinition[n]["default"]);return F}getPaintValue(n,x,z){let F;const G=this._paintProperties[n];
G&&(F=G.getValue(x,z));void 0===F&&(F=this._paintDefinition[n]["default"]);return F}isPainterDataDriven(){const n=this._paintProperties;if(n)for(const x in n)if(n[x].isDataDriven)return!0;return!1}isIntersectingFeature(n,x,z,F,G,L,M){return!1}getFeatureInflatedBounds(n,x,z,F){return null}_parseLayout(n){const x={};for(const z in n){const F=this._layoutDefinition[z];F&&(x[z]=new t(F,n[z]))}return x}_parsePaint(n){const x={};for(const z in n){const F=this._paintDefinition[z];F&&(x[z]=new t(F,n[z]))}return x}computeAttributesKey(n,
x,z,F){let G=0,L=0;for(const M of x){x=3;if(!M||M!==F){const {isLayout:O,isOptional:R}=z[M];x=O?this.getLayoutProperty(M):this.getPaintProperty(M);x=x?.interpolator?2:x?.isDataDriven?1:R&&!x?3:0}L|=x<<G;G+=2}return L<<3|n}}class H extends B{constructor(n,x,z,F){super(n,x,z,F);this.backgroundMaterial=new e.VTLBackgroundMaterial(this.computeAttributesKey(r.ShaderProgramType.BACKGROUND,e.VTLBackgroundMaterial.ATTRIBUTES,e.VTLBackgroundMaterial.ATTRIBUTES_INFO))}}class y extends B{constructor(n,x,z,F){super(n,
x,z,F);n=this.getPaintProperty("fill-color");x=this.getPaintProperty("fill-opacity");z=this.getPaintProperty("fill-pattern");this.hasDataDrivenColor=n?.isDataDriven;this.hasDataDrivenOpacity=x?.isDataDriven;this.hasDataDrivenFill=this.hasDataDrivenColor||this.hasDataDrivenOpacity||z?.isDataDriven;x=this.getPaintProperty("fill-outline-color");this.outlineUsesFillColor=!x;this.hasDataDrivenOutlineColor=x?.isDataDriven;this.hasDataDrivenOutline=x?x.isDataDriven:n?n.isDataDriven:!1;this.hasDataDrivenOutline=
(x?this.hasDataDrivenOutlineColor:this.hasDataDrivenColor)||this.hasDataDrivenOpacity;this.fillMaterial=new d.VTLFillMaterial(this.computeAttributesKey(r.ShaderProgramType.FILL,d.VTLFillMaterial.ATTRIBUTES,d.VTLFillMaterial.ATTRIBUTES_INFO));this.outlineMaterial=new d.VTLOutlineMaterial(this.computeAttributesKey(r.ShaderProgramType.OUTLINE,this.outlineUsesFillColor?d.VTLOutlineMaterial.ATTRIBUTES_FILL:d.VTLOutlineMaterial.ATTRIBUTES_OUTLINE,this.outlineUsesFillColor?d.VTLOutlineMaterial.ATTRIBUTES_INFO_FILL:
d.VTLOutlineMaterial.ATTRIBUTES_INFO_OUTLINE),this.outlineUsesFillColor)}getFeatureInflatedBounds(n,x,z,F){z=w(n);if(!z)return null;n=this.getPaintValue("fill-translate",x,n);F*=Math.max(n[0],n[1]);z[0]-=F;z[2]-=F;z[1]+=F;z[3]+=F;return z}isIntersectingFeature(n,x,z,F,G,L,M){const O=F.getGeometry();if(!O)return!1;const R=8/M.normalizationRatio;n=n/M.normalizationRatio+M.normalizationOffsetX;x=x/M.normalizationRatio+M.normalizationOffsetY;F=b.translateAnchor(this.getPaintValue("fill-translate",G,F),
this.getPaintValue("fill-translate-anchor",G,F),L,8);n-=R*F.x;x-=R*F.y;return b.pointInPolygon(n,x,O)?!0:b.distanceFromToPolylineWithinThreshold(n,x,O,R*z)}}class A extends B{constructor(n,x,z,F){super(n,x,z,F);n=this.getPaintProperty("line-pattern");this.lineMaterial=new h.VTLLineMaterial(this.computeAttributesKey(r.ShaderProgramType.LINE,h.VTLLineMaterial.ATTRIBUTES,h.VTLLineMaterial.ATTRIBUTES_INFO,n?"line-dasharray":""));this.hasDataDrivenLine=this.getPaintProperty("line-blur")?.isDataDriven||
this.getPaintProperty("line-color")?.isDataDriven||this.getPaintProperty("line-gap-width")?.isDataDriven||this.getPaintProperty("line-offset")?.isDataDriven||this.getPaintProperty("line-opacity")?.isDataDriven||this.getPaintProperty("line-pattern")?.isDataDriven||this.getPaintProperty("line-dasharray")?.isDataDriven||this.getLayoutProperty("line-cap")?.isDataDriven||this.getPaintProperty("line-width")?.isDataDriven;this.canUseThinTessellation=!1;!this.hasDataDrivenLine&&(n=this.getPaintProperty("line-width"),
!n||"number"===typeof n&&.5*n<p.thinLineHalfWidthThreshold)&&(n=this.getPaintProperty("line-offset"),!n||"number"===typeof n&&0===n)&&(this.canUseThinTessellation=!0)}getDashKey(n,x){switch(x){case k.CapType.BUTT:x="Butt";break;case k.CapType.ROUND:x="Round";break;case k.CapType.SQUARE:x="Square";break;default:x="Butt"}return`dasharray-[${n.toString()}]-${x}`}getFeatureInflatedBounds(n,x,z,F){z=w(n);if(!z)return null;var G=this.getPaintValue("line-translate",x,n);G=F*Math.max(G[0],G[1]);z[0]-=G;z[2]-=
G;z[1]+=G;z[3]+=G;G=F*Math.abs(this.getPaintValue("line-offset",x,n)||0);n=this.getPaintValue("line-width",x,n);F*=n/2;z[0]-=G+F;z[1]-=G+F;z[2]+=G+F;z[3]+=G+F;return z}isIntersectingFeature(n,x,z,F,G,L,M){let O=F.getGeometry();if(!O)return!1;const R=8/M.normalizationRatio;n=n/M.normalizationRatio+M.normalizationOffsetX;x=x/M.normalizationRatio+M.normalizationOffsetY;L=b.translateAnchor(this.getPaintValue("line-translate",G,F),this.getPaintValue("line-translate-anchor",G,F),L,8);n-=R*L.x;x-=R*L.y;
L=R*this.getPaintValue("line-offset",G,F)||0;0!==L&&(O=b.offsetLine(O,-L));F=this.getPaintValue("line-width",G,F);return b.distanceFromToPolylineWithinThreshold(n,x,O,R*(z+F/2))}}class C extends B{constructor(n,x,z,F){super(n,x,z,F);this.iconMaterial=new f.VTLIconMaterial(this.computeAttributesKey(r.ShaderProgramType.ICON,f.VTLIconMaterial.ATTRIBUTES,f.VTLIconMaterial.ATTRIBUTES_INFO));this.textMaterial=new f.VTLTextMaterial(this.computeAttributesKey(r.ShaderProgramType.TEXT,f.VTLTextMaterial.ATTRIBUTES,
f.VTLTextMaterial.ATTRIBUTES_INFO));this.hasDataDrivenIcon=this.getPaintProperty("icon-color")?.isDataDriven||this.getPaintProperty("icon-halo-blur")?.isDataDriven||this.getPaintProperty("icon-halo-color")?.isDataDriven||this.getPaintProperty("icon-halo-width")?.isDataDriven||this.getPaintProperty("icon-opacity")?.isDataDriven||this.getLayoutProperty("icon-size")?.isDataDriven;this.hasDataDrivenText=this.getPaintProperty("text-color")?.isDataDriven||this.getPaintProperty("text-halo-blur")?.isDataDriven||
this.getPaintProperty("text-halo-color")?.isDataDriven||this.getPaintProperty("text-halo-width")?.isDataDriven||this.getPaintProperty("text-opacity")?.isDataDriven||this.getLayoutProperty("text-size")?.isDataDriven}}class E extends B{constructor(n,x,z,F){super(n,x,z,F);this.circleMaterial=new g.VTLCircleMaterial(this.computeAttributesKey(r.ShaderProgramType.CIRCLE,g.VTLCircleMaterial.ATTRIBUTES,g.VTLCircleMaterial.ATTRIBUTES_INFO))}getFeatureInflatedBounds(n,x,z,F){z=w(n);if(!z)return null;var G=
this.getPaintValue("circle-translate",x,n);G=Math.max(G[0],G[1]);z[0]-=G;z[2]-=G;z[1]+=G;z[3]+=G;n=8*(this.getPaintValue("circle-radius",x,n)+this.getPaintValue("circle-stroke-width",x,n));F*=n/2;z[0]-=F;z[1]-=F;z[2]+=F;z[3]+=F;return z}isIntersectingFeature(n,x,z,F,G,L,M){var O=F.getGeometry();if(!O)return!1;const R=8/M.normalizationRatio;n=n/M.normalizationRatio+M.normalizationOffsetX;x=x/M.normalizationRatio+M.normalizationOffsetY;z*=R;L=b.translateAnchor(this.getPaintValue("circle-translate",
G,F),this.getPaintValue("circle-translate-anchor",G,F),L,R);F=R*(this.getPaintValue("circle-radius",G,F)+this.getPaintValue("circle-stroke-width",G,F));for(const S of O)if(S)for(const U of S)if(O=U.x+L.x,G=U.y+L.y,Math.sqrt((n-O)*(n-O)+(x-G)*(x-G))-z<=F)return!0;return!1}}class I{constructor(n,x,z){this.allowOverlap=n.getLayoutValue("icon-allow-overlap",x);this.ignorePlacement=n.getLayoutValue("icon-ignore-placement",x);this.keepUpright=n.getLayoutValue("icon-keep-upright",x);this.optional=n.getLayoutValue("icon-optional",
x);this.rotationAlignment=n.getLayoutValue("icon-rotation-alignment",x);this.rotationAlignment===l.RotationAlignment.AUTO&&(this.rotationAlignment=z?l.RotationAlignment.MAP:l.RotationAlignment.VIEWPORT);z=n.getLayoutProperty("icon-anchor");z?.isDataDriven?this._anchorProp=z:this.anchor=n.getLayoutValue("icon-anchor",x);z=n.getLayoutProperty("icon-offset");z?.isDataDriven?this._offsetProp=z:this.offset=n.getLayoutValue("icon-offset",x);z=n.getLayoutProperty("icon-padding");z?.isDataDriven?this._paddingProp=
z:this.padding=n.getLayoutValue("icon-padding",x);z=n.getLayoutProperty("icon-rotate");z?.isDataDriven?this._rotateProp=z:this.rotate=n.getLayoutValue("icon-rotate",x);z=n.getLayoutProperty("icon-size");z?.isDataDriven?this._sizeProp=z:this.size=n.getLayoutValue("icon-size",x)}update(n,x){this._anchorProp&&(this.anchor=this._anchorProp.getValue(n,x));this._offsetProp&&(this.offset=this._offsetProp.getValue(n,x));this._paddingProp&&(this.padding=this._paddingProp.getValue(n,x));this._rotateProp&&(this.rotate=
this._rotateProp.getValue(n,x));this._sizeProp&&(this.size=this._sizeProp.getValue(n,x))}}class K{constructor(n,x,z){this.allowOverlap=n.getLayoutValue("text-allow-overlap",x);this.ignorePlacement=n.getLayoutValue("text-ignore-placement",x);this.keepUpright=n.getLayoutValue("text-keep-upright",x);this.optional=n.getLayoutValue("text-optional",x);this.rotationAlignment=n.getLayoutValue("text-rotation-alignment",x);this.rotationAlignment===l.RotationAlignment.AUTO&&(this.rotationAlignment=z?l.RotationAlignment.MAP:
l.RotationAlignment.VIEWPORT);z=n.getLayoutProperty("text-anchor");z?.isDataDriven?this._anchorProp=z:this.anchor=n.getLayoutValue("text-anchor",x);z=n.getLayoutProperty("text-justify");z?.isDataDriven?this._justifyProp=z:this.justify=n.getLayoutValue("text-justify",x);z=n.getLayoutProperty("text-letter-spacing");z?.isDataDriven?this._letterSpacingProp=z:this.letterSpacing=n.getLayoutValue("text-letter-spacing",x);z=n.getLayoutProperty("text-line-height");z?.isDataDriven?this._lineHeightProp=z:this.lineHeight=
n.getLayoutValue("text-line-height",x);z=n.getLayoutProperty("text-max-angle");z?.isDataDriven?this._maxAngleProp=z:this.maxAngle=n.getLayoutValue("text-max-angle",x);z=n.getLayoutProperty("text-max-width");z?.isDataDriven?this._maxWidthProp=z:this.maxWidth=n.getLayoutValue("text-max-width",x);z=n.getLayoutProperty("text-offset");z?.isDataDriven?this._offsetProp=z:this.offset=n.getLayoutValue("text-offset",x);z=n.getLayoutProperty("text-padding");z?.isDataDriven?this._paddingProp=z:this.padding=n.getLayoutValue("text-padding",
x);z=n.getLayoutProperty("text-rotate");z?.isDataDriven?this._rotateProp=z:this.rotate=n.getLayoutValue("text-rotate",x);z=n.getLayoutProperty("text-size");z?.isDataDriven?this._sizeProp=z:this.size=n.getLayoutValue("text-size",x);z=n.getLayoutProperty("text-writing-mode");z?.isDataDriven?this._writingModeProp=z:this.writingMode=n.getLayoutValue("text-writing-mode",x)}update(n,x){this._anchorProp&&(this.anchor=this._anchorProp.getValue(n,x));this._justifyProp&&(this.justify=this._justifyProp.getValue(n,
x));this._letterSpacingProp&&(this.letterSpacing=this._letterSpacingProp.getValue(n,x));this._lineHeightProp&&(this.lineHeight=this._lineHeightProp.getValue(n,x));this._maxAngleProp&&(this.maxAngle=this._maxAngleProp.getValue(n,x));this._maxWidthProp&&(this.maxWidth=this._maxWidthProp.getValue(n,x));this._offsetProp&&(this.offset=this._offsetProp.getValue(n,x));this._paddingProp&&(this.padding=this._paddingProp.getValue(n,x));this._rotateProp&&(this.rotate=this._rotateProp.getValue(n,x));this._sizeProp&&
(this.size=this._sizeProp.getValue(n,x));this._writingModeProp&&(this.writingMode=this._writingModeProp.getValue(n,x))}}k.BackgroundStyleLayer=H;k.CircleStyleLayer=E;k.FillStyleLayer=y;k.IconLayout=I;k.IndexItem=q;k.LineStyleLayer=A;k.StyleLayer=B;k.SymbolStyleLayer=C;k.TextLayout=K;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/shaders/VTLBackgroundMaterial":function(){define(["exports","./VTLMaterial","../../../../webgl/enums","../../../../webgl/VertexElementDescriptor"],
function(k,v,r,b){class e extends v.VTLMaterial{constructor(g){super(g)}geometryInfo(){return e.GEOMETRY_LAYOUT}opacityInfo(){return null}attributes(){return e.ATTRIBUTES}attributesInfo(){return e.ATTRIBUTES_INFO}}e.ATTRIBUTES=[];e.GEOMETRY_LAYOUT=[new b.VertexElementDescriptor("a_pos",2,r.DataType.BYTE,0,2)];e.ATTRIBUTES_INFO={};k.VTLBackgroundMaterial=e;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/shaders/VTLMaterial":function(){define(["exports",
"../MemoryBuffer","./enums","../../../../webgl/enums","../../../../webgl/VertexElementDescriptor"],function(k,v,r,b,e){class g{constructor(f){this._locations=new Map;this._key=f}get key(){return this._key}get type(){return this._key&7}defines(){return[]}getStride(){this._layout||this._buildAttributesInfo();return this._stride}getAttributeLocations(){0===this._locations.size&&this._buildAttributesInfo();return this._locations}getLayoutInfo(){this._layout||this._buildAttributesInfo();return this._layout}getEncodingInfos(){this._propertyEncodingInfo||
this._buildAttributesInfo();return this._propertyEncodingInfo}getUniforms(){this._uniforms||this._buildAttributesInfo();return this._uniforms}getShaderHeader(){this._shaderHeader||this._buildAttributesInfo();return this._shaderHeader}getShaderMain(){this._shaderMain||this._buildAttributesInfo();return this._shaderMain}setDataUniforms(f,c,l,t,p){var w=this.getUniforms();for(const q of w){const {name:B,type:H,getValue:y}=q;w=y(l,c,t,p);if(null!==w)switch(H){case "float":f.setUniform1f(B,w);break;case "vec2":f.setUniform2fv(B,
w);break;case "vec4":f.setUniform4fv(B,w)}}}encodeAttributes(f,c,l,t){const p=this.attributesInfo(),w=this.getEncodingInfos(),q=[];let B=0,H=0;for(const A of Object.keys(w)){var y=w[A];const {type:C,precisionFactor:E,isLayout:I}=p[A],K=I?l.getLayoutProperty(A):l.getPaintProperty(A),n=K.interpolator?.getInterpolationRange(c);let x=0;for(const z of y){const {offset:F,bufferElementsToAdd:G}=z;if(0<G){for(y=0;y<G;y++)q.push(0);B+=H;H=z.bufferElementsToAdd}y=t??K.getValue(n?n[x]:c,f);switch(C){case r.EncodingType.R8_SIGNED:case r.EncodingType.R8_UNSIGNED:q[B]|=
this._encodeByte(y*(E||1),8*F);break;case r.EncodingType.R16_SIGNED:case r.EncodingType.R16_UNSIGNED:q[B]|=this._encodeShort(y*(E||1),8*F);break;case r.EncodingType.R8G8_SIGNED:case r.EncodingType.R8G8_UNSIGNED:q[B]|=this._encodeByte(y*(E||1),8*F);q[B]|=this._encodeByte(y*(E||1),8*F+8);break;case r.EncodingType.R16G16_SIGNED:case r.EncodingType.R16G16_UNSIGNED:q[B]|=this._encodeShort(y*(E||1),8*F);q[B]|=this._encodeShort(y*(E||1),8*F+16);break;case r.EncodingType.R8G8B8A8_SIGNED:case r.EncodingType.R8G8B8A8_UNSIGNED:q[B]|=
this._encodeByte(y*(E||1),8*F);q[B]|=this._encodeByte(y*(E||1),8*F+8);q[B]|=this._encodeByte(y*(E||1),8*F+16);q[B]|=this._encodeByte(y*(E||1),8*F+24);break;case r.EncodingType.R8G8B8A8_COLOR:q[B]=this._encodeColor(y);break;case r.EncodingType.R16G16B16A16_DASHARRAY:case r.EncodingType.R16G16B16A16_PATTERN:this._encodePattern(B,q,y);break;default:throw Error("Unsupported encoding type");}x++}}return q}getAtributeState(f){const c=3+2*f;f=0|this._bit(c);return f|=this._bit(c+1)<<1}_buildAttributesInfo(){const f=
[],c={};var l={},t=-1;const p=this.attributesInfo();var w=this.attributes();let q=-1;for(const A of w){q++;w=this.getAtributeState(q);if(w===r.AttributeStatus.UNIFORM||w===r.AttributeStatus.UNUSED)continue;var B=p[A];const C=[];c[A]=C;B=B.type;for(let E=0;E<w;E++){const {dataType:I,bytesPerElement:K,count:n,normalized:x}=g._encodingInfo[B],z=K*n;var H=`${I}-${!0===x}`;let F=l[H],G=0;!F||4<F.count+n?(t++,F={dataIndex:t,count:0,offset:0},4!==n&&(l[H]=F),f.push({location:-1,name:"a_data_"+t,count:n,
type:I,normalized:x}),G=Math.ceil(Math.max(z/4,1))):(H=f[F.dataIndex],H.count+=n,G=Math.ceil(Math.max(H.count*K/4,1))-Math.ceil(Math.max(F.offset/4,1)));C.push({dataIndex:F.dataIndex,offset:F.offset,bufferElementsToAdd:G});F.offset+=z;F.count+=n}}for(const A of f)switch(A.type){case b.DataType.BYTE:case b.DataType.UNSIGNED_BYTE:A.count=4;break;case b.DataType.SHORT:case b.DataType.UNSIGNED_SHORT:A.count+=A.count%2}this._buildVertexBufferLayout(f);l=0;t=this._layout.get("geometry");for(var y of t)this._locations.set(y.name,
l++);if(y=this._layout.get("opacity"))for(const A of y)this._locations.set(A.name,l++);this._buildShaderInfo(f,c);this._propertyEncodingInfo=c}_buildVertexBufferLayout(f){const c=new Map,l=this.geometryInfo();let t=l[0].stride;if(0===f.length)c.set("geometry",l);else{const p=[];let w=t;for(const q of f)t+=d(q.type)*q.count;for(const q of l)p.push(new e.VertexElementDescriptor(q.name,q.count,q.type,q.offset,t,q.normalized));for(const q of f)p.push(new e.VertexElementDescriptor(q.name,q.count,q.type,
w,t,q.normalized)),w+=d(q.type)*q.count;c.set("geometry",p)}(f=this.opacityInfo())&&c.set("opacity",f);this._layout=c;this._stride=t}_buildShaderInfo(f,c){let l="\n",t="\n";const p=[];for(var w of f)l+=`attribute ${this._getType(w.count)} ${w.name};\n`;var q=this.attributes();f=this.attributesInfo();w=-1;for(const y of q){w++;const {name:A,type:C,precisionFactor:E,isLayout:I}=f[y];q=E&&1!==E?` * ${1/E}`:"";const {bytesPerElement:K,count:n}=g._encodingInfo[C];var B=x=>`a_data_${x.dataIndex}${h(n,x.offset,
K)}`;switch(this.getAtributeState(w)){case r.AttributeStatus.UNIFORM:q=this._getType(n);var H=`u_${A}`;p.push({name:H,type:q,getValue:(z,F,G,L)=>{G=I?z.getLayoutValue(y,F):z.getPaintValue(y,F);if(C===r.EncodingType.R16G16B16A16_DASHARRAY){z=z.getDashKey(G,z.getLayoutValue("line-cap",F));L=L.getMosaicItemPosition(z,!1);if(null==L)return null;const {tl:M,br:O}=L;return[M[0],O[1],O[0],M[1]]}if(C===r.EncodingType.R16G16B16A16_PATTERN){L=L.getMosaicItemPosition(G,!y.includes("line-"));if(null==L)return null;
const {tl:M,br:O}=L;return[M[0],O[1],O[0],M[1]]}return C===r.EncodingType.R8G8B8A8_COLOR?(L=G[3],[L*G[0],L*G[1],L*G[2],L]):G}});l+=`uniform ${q} ${H};\n`;t+=`${q} ${A} = ${H};\n`;break;case r.AttributeStatus.DATA_DRIVEN:H=B(c[y][0]);t+=`${this._getType(n)} ${A} = ${H}${q};\n`;break;case r.AttributeStatus.INTERPOLATED_DATA_DRIVEN:H=`u_t_${A}`;p.push({name:H,type:"float",getValue:(z,F,G,L)=>(I?z.getLayoutProperty(y):z.getPaintProperty(y)).interpolator.interpolationUniformValue(G,F)});l+=`uniform float ${H};\n`;
const x=B(c[y][0]);B=B(c[y][1]);t+=`${this._getType(n)} ${A} = mix(${x}${q}, ${B}${q}, ${H});\n`}}this._shaderHeader=l;this._shaderMain=t;this._uniforms=p}_bit(f){return(this._key&1<<f)>>f}_getType(f){switch(f){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4"}throw Error("Invalid count");}_encodeColor(f){const c=255*f[3];return v.i8888to32(f[0]*c,f[1]*c,f[2]*c,c)}_encodePattern(f,c,l){if(l?.rect){var t=l.rect,p=l.width;l=l.height;c[f]=this._encodeShort(t.x+2,0);c[f]|=
this._encodeShort(t.y+2+l,16);c[f+1]=this._encodeShort(t.x+2+p,0);c[f+1]|=this._encodeShort(t.y+2,16)}}_encodeByte(f,c){return(f&255)<<c}_encodeShort(f,c){return(f&65535)<<c}}g._encodingInfo={[r.EncodingType.R8_SIGNED]:{dataType:b.DataType.BYTE,bytesPerElement:1,count:1,normalized:!1},[r.EncodingType.R8_UNSIGNED]:{dataType:b.DataType.UNSIGNED_BYTE,bytesPerElement:1,count:1,normalized:!1},[r.EncodingType.R16_SIGNED]:{dataType:b.DataType.SHORT,bytesPerElement:2,count:1,normalized:!1},[r.EncodingType.R16_UNSIGNED]:{dataType:b.DataType.UNSIGNED_SHORT,
bytesPerElement:2,count:1,normalized:!1},[r.EncodingType.R8G8_SIGNED]:{dataType:b.DataType.BYTE,bytesPerElement:1,count:2,normalized:!1},[r.EncodingType.R8G8_UNSIGNED]:{dataType:b.DataType.UNSIGNED_BYTE,bytesPerElement:1,count:2,normalized:!1},[r.EncodingType.R16G16_SIGNED]:{dataType:b.DataType.SHORT,bytesPerElement:2,count:2,normalized:!1},[r.EncodingType.R16G16_UNSIGNED]:{dataType:b.DataType.UNSIGNED_SHORT,bytesPerElement:2,count:2,normalized:!1},[r.EncodingType.R8G8B8A8_SIGNED]:{dataType:b.DataType.BYTE,
bytesPerElement:1,count:4,normalized:!1},[r.EncodingType.R8G8B8A8_UNSIGNED]:{dataType:b.DataType.UNSIGNED_BYTE,bytesPerElement:1,count:4,normalized:!1},[r.EncodingType.R8G8B8A8_COLOR]:{dataType:b.DataType.UNSIGNED_BYTE,bytesPerElement:1,count:4,normalized:!0},[r.EncodingType.R16G16B16A16_DASHARRAY]:{dataType:b.DataType.UNSIGNED_SHORT,bytesPerElement:2,count:4,normalized:!1},[r.EncodingType.R16G16B16A16_PATTERN]:{dataType:b.DataType.UNSIGNED_SHORT,bytesPerElement:2,count:4,normalized:!1}};const d=
f=>{switch(f){case b.DataType.FLOAT:case b.DataType.INT:case b.DataType.UNSIGNED_INT:return 4;case b.DataType.SHORT:case b.DataType.UNSIGNED_SHORT:case b.DataType.HALF_FLOAT:return 2;case b.DataType.BYTE:case b.DataType.UNSIGNED_BYTE:return 1}},h=(f,c,l)=>{c/=l;if(1===f)switch(c){case 0:return".x";case 1:return".y";case 2:return".z";case 3:return".w"}else if(2===f)switch(c){case 0:return".xy";case 1:return".yz";case 2:return".zw"}else if(3===f)switch(c){case 0:return".xyz";case 1:return".yzw"}return""};
k.VTLMaterial=g;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/MemoryBuffer":function(){define(["../../../../core/has"],function(k){class v{constructor(r){this._array=[];this._stride=r}get array(){return this._array}get index(){return 4*this._array.length/this._stride}get itemSize(){return this._stride}get sizeInBytes(){return 4*this._array.length}reset(){this.array.length=0}toBuffer(){return(new Uint32Array(this._array)).buffer}static i1616to32(r,
b){return 65535&r|b<<16}static i8888to32(r,b,e,g){return r&255|(b&255)<<8|(e&255)<<16|g<<24}static i8816to32(r,b,e){return r&255|(b&255)<<8|e<<16}}return v})},"esri/views/2d/engine/vectorTiles/shaders/enums":function(){define(["exports"],function(k){k.EncodingType=void 0;(function(v){v[v.R8_SIGNED=0]="R8_SIGNED";v[v.R8_UNSIGNED=1]="R8_UNSIGNED";v[v.R16_SIGNED=2]="R16_SIGNED";v[v.R16_UNSIGNED=3]="R16_UNSIGNED";v[v.R8G8_SIGNED=4]="R8G8_SIGNED";v[v.R8G8_UNSIGNED=5]="R8G8_UNSIGNED";v[v.R16G16_SIGNED=
6]="R16G16_SIGNED";v[v.R16G16_UNSIGNED=7]="R16G16_UNSIGNED";v[v.R8G8B8A8_SIGNED=8]="R8G8B8A8_SIGNED";v[v.R8G8B8A8_UNSIGNED=9]="R8G8B8A8_UNSIGNED";v[v.R8G8B8A8_COLOR=10]="R8G8B8A8_COLOR";v[v.R16G16B16A16_DASHARRAY=11]="R16G16B16A16_DASHARRAY";v[v.R16G16B16A16_PATTERN=12]="R16G16B16A16_PATTERN"})(k.EncodingType||(k.EncodingType={}));k.AttributeStatus=void 0;(function(v){v[v.UNIFORM=0]="UNIFORM";v[v.DATA_DRIVEN=1]="DATA_DRIVEN";v[v.INTERPOLATED_DATA_DRIVEN=2]="INTERPOLATED_DATA_DRIVEN";v[v.UNUSED=3]=
"UNUSED"})(k.AttributeStatus||(k.AttributeStatus={}));Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/shaders/VTLCircleMaterial":function(){define(["exports","./enums","./VTLMaterial","../../../../webgl/enums","../../../../webgl/VertexElementDescriptor"],function(k,v,r,b,e){class g extends r.VTLMaterial{constructor(d){super(d)}geometryInfo(){return g.GEOMETRY_LAYOUT}opacityInfo(){return null}attributes(){return g.ATTRIBUTES}attributesInfo(){return g.ATTRIBUTES_INFO}}
g.ATTRIBUTES="circle-radius circle-color circle-opacity circle-stroke-width circle-stroke-color circle-stroke-opacity circle-blur".split(" ");g.GEOMETRY_LAYOUT=[new e.VertexElementDescriptor("a_pos",2,b.DataType.SHORT,0,4)];g.ATTRIBUTES_INFO={"circle-radius":{name:"radius",type:v.EncodingType.R8_UNSIGNED},"circle-color":{name:"color",type:v.EncodingType.R8G8B8A8_COLOR},"circle-opacity":{name:"opacity",type:v.EncodingType.R8_UNSIGNED,precisionFactor:100},"circle-stroke-width":{name:"stroke_width",
type:v.EncodingType.R8_UNSIGNED,precisionFactor:4},"circle-stroke-color":{name:"stroke_color",type:v.EncodingType.R8G8B8A8_COLOR},"circle-stroke-opacity":{name:"stroke_opacity",type:v.EncodingType.R8_UNSIGNED,precisionFactor:100},"circle-blur":{name:"blur",type:v.EncodingType.R8_UNSIGNED,precisionFactor:32}};k.VTLCircleMaterial=g;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/shaders/VTLFillMaterial":function(){define(["exports","./enums","./VTLMaterial",
"../../../../webgl/enums","../../../../webgl/VertexElementDescriptor"],function(k,v,r,b,e){class g extends r.VTLMaterial{constructor(h){super(h)}geometryInfo(){return g.GEOMETRY_LAYOUT}opacityInfo(){return null}attributes(){return g.ATTRIBUTES}attributesInfo(){return g.ATTRIBUTES_INFO}}g.ATTRIBUTES=["fill-color","fill-opacity","fill-pattern"];g.GEOMETRY_LAYOUT=[new e.VertexElementDescriptor("a_pos",2,b.DataType.SHORT,0,4)];g.ATTRIBUTES_INFO={"fill-color":{name:"color",type:v.EncodingType.R8G8B8A8_COLOR},
"fill-opacity":{name:"opacity",type:v.EncodingType.R8_UNSIGNED,precisionFactor:100},"fill-pattern":{name:"tlbr",type:v.EncodingType.R16G16B16A16_PATTERN,isOptional:!0}};class d extends r.VTLMaterial{constructor(h,f){super(h);this._usefillColor=f}geometryInfo(){return d.GEOMETRY_LAYOUT}opacityInfo(){return null}attributes(){return this._usefillColor?d.ATTRIBUTES_FILL:d.ATTRIBUTES_OUTLINE}attributesInfo(){return this._usefillColor?d.ATTRIBUTES_INFO_FILL:d.ATTRIBUTES_INFO_OUTLINE}}d.ATTRIBUTES_OUTLINE=
["fill-outline-color","fill-opacity"];d.ATTRIBUTES_FILL=["fill-color","fill-opacity"];d.GEOMETRY_LAYOUT=[new e.VertexElementDescriptor("a_pos",2,b.DataType.SHORT,0,8),new e.VertexElementDescriptor("a_offset",2,b.DataType.BYTE,4,8),new e.VertexElementDescriptor("a_xnormal",2,b.DataType.BYTE,6,8)];d.ATTRIBUTES_INFO_OUTLINE={"fill-outline-color":{name:"color",type:v.EncodingType.R8G8B8A8_COLOR},"fill-opacity":{name:"opacity",type:v.EncodingType.R8_UNSIGNED,precisionFactor:100}};d.ATTRIBUTES_INFO_FILL=
{"fill-color":{name:"color",type:v.EncodingType.R8G8B8A8_COLOR},"fill-opacity":{name:"opacity",type:v.EncodingType.R8_UNSIGNED,precisionFactor:100}};k.VTLFillMaterial=g;k.VTLOutlineMaterial=d;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/shaders/VTLLineMaterial":function(){define(["exports","./enums","./VTLMaterial","../../../../webgl/enums","../../../../webgl/VertexElementDescriptor"],function(k,v,r,b,e){class g extends r.VTLMaterial{constructor(d){super(d)}geometryInfo(){return g.GEOMETRY_LAYOUT}opacityInfo(){return null}attributes(){return g.ATTRIBUTES}attributesInfo(){return g.ATTRIBUTES_INFO}}
g.ATTRIBUTES="line-blur line-color line-gap-width line-offset line-opacity line-width line-pattern line-dasharray".split(" ");g.GEOMETRY_LAYOUT=[new e.VertexElementDescriptor("a_pos",2,b.DataType.SHORT,0,16),new e.VertexElementDescriptor("a_extrude_offset",4,b.DataType.BYTE,4,16),new e.VertexElementDescriptor("a_dir_normal",4,b.DataType.BYTE,8,16),new e.VertexElementDescriptor("a_accumulatedDistance",2,b.DataType.UNSIGNED_SHORT,12,16)];g.ATTRIBUTES_INFO={"line-width":{name:"width",type:v.EncodingType.R8_UNSIGNED,
precisionFactor:2},"line-gap-width":{name:"gap_width",type:v.EncodingType.R8_UNSIGNED,precisionFactor:2},"line-offset":{name:"offset",type:v.EncodingType.R8_SIGNED,precisionFactor:2},"line-color":{name:"color",type:v.EncodingType.R8G8B8A8_COLOR},"line-opacity":{name:"opacity",type:v.EncodingType.R8_UNSIGNED,precisionFactor:100},"line-blur":{name:"blur",type:v.EncodingType.R8_UNSIGNED,precisionFactor:4},"line-pattern":{name:"tlbr",type:v.EncodingType.R16G16B16A16_PATTERN,isOptional:!0},"line-dasharray":{name:"tlbr",
type:v.EncodingType.R16G16B16A16_DASHARRAY,isOptional:!0}};k.VTLLineMaterial=g;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/shaders/VTLSymbolMaterial":function(){define(["exports","./enums","./VTLMaterial","../../../../webgl/enums","../../../../webgl/VertexElementDescriptor"],function(k,v,r,b,e){const g=[new e.VertexElementDescriptor("a_pos",2,b.DataType.SHORT,0,16),new e.VertexElementDescriptor("a_vertexOffset",2,b.DataType.SHORT,4,16),new e.VertexElementDescriptor("a_texAngleRange",
4,b.DataType.UNSIGNED_BYTE,8,16),new e.VertexElementDescriptor("a_levelInfo",4,b.DataType.UNSIGNED_BYTE,12,16)],d=[new e.VertexElementDescriptor("a_opacityInfo",1,b.DataType.UNSIGNED_BYTE,0,1)];class h extends r.VTLMaterial{constructor(c){super(c)}geometryInfo(){return g}opacityInfo(){return d}attributes(){return h.ATTRIBUTES}attributesInfo(){return h.ATTRIBUTES_INFO}}h.ATTRIBUTES="icon-color icon-opacity icon-halo-blur icon-halo-color icon-halo-width icon-size".split(" ");h.ATTRIBUTES_INFO={"icon-color":{name:"color",
type:v.EncodingType.R8G8B8A8_COLOR},"icon-opacity":{name:"opacity",type:v.EncodingType.R8_UNSIGNED,precisionFactor:100},"icon-halo-color":{name:"halo_color",type:v.EncodingType.R8G8B8A8_COLOR},"icon-halo-width":{name:"halo_width",type:v.EncodingType.R8_UNSIGNED,precisionFactor:4},"icon-halo-blur":{name:"halo_blur",type:v.EncodingType.R8_UNSIGNED,precisionFactor:4},"icon-size":{name:"size",type:v.EncodingType.R8_UNSIGNED,precisionFactor:32,isLayout:!0}};class f extends r.VTLMaterial{constructor(c){super(c)}geometryInfo(){return g}opacityInfo(){return d}attributes(){return f.ATTRIBUTES}attributesInfo(){return f.ATTRIBUTES_INFO}}
f.ATTRIBUTES="text-color text-opacity text-halo-blur text-halo-color text-halo-width text-size".split(" ");f.ATTRIBUTES_INFO={"text-color":{name:"color",type:v.EncodingType.R8G8B8A8_COLOR},"text-opacity":{name:"opacity",type:v.EncodingType.R8_UNSIGNED,precisionFactor:100},"text-halo-color":{name:"halo_color",type:v.EncodingType.R8G8B8A8_COLOR},"text-halo-width":{name:"halo_width",type:v.EncodingType.R8_UNSIGNED,precisionFactor:4},"text-halo-blur":{name:"halo_blur",type:v.EncodingType.R8_UNSIGNED,
precisionFactor:4},"text-size":{name:"size",type:v.EncodingType.R8_UNSIGNED,isLayout:!0}};k.VTLIconMaterial=h;k.VTLTextMaterial=f;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/style/Filter":function(){define(["../expression/expression","../expression/types"],function(k,v){class r{constructor(b){this._expression=b}filter(b,e){if(!this._expression)return!0;try{return this._expression.evaluate(b,e)}catch(g){return console.log(g.message),!0}}static createFilter(b){if(!b)return null;
this.isLegacyFilter(b)&&(b=this.convertLegacyFilter(b));try{const e=k.createExpression(b,null,v.booleanType);return new r(e)}catch(e){return console.log(e.message),null}}static isLegacyFilter(b){if(!Array.isArray(b)||0===b.length)return!0;switch(b[0]){case "\x3d\x3d":case "!\x3d":case "\x3e":case "\x3c":case "\x3e\x3d":case "\x3c\x3d":return 3===b.length&&"string"===typeof b[1]&&!Array.isArray(b[2]);case "in":return 3<=b.length&&"string"===typeof b[1]&&!Array.isArray(b[2]);case "!in":return!0;case "any":case "all":for(let e=
1;e<b.length;e++)if(this.isLegacyFilter(b[e]))return!0;return!1;case "none":return!0;case "has":return 2===b.length&&("$id"===b[1]||"$type"===b[1]);case "!has":return!0;default:return!1}}static convertLegacyFilter(b){if(!Array.isArray(b)||0===b.length)return!0;const e=b[0];if(1===b.length)return"any"!==e;switch(e){case "\x3d\x3d":return r.convertComparison("\x3d\x3d",b[1],b[2]);case "!\x3d":return r.negate(r.convertComparison("\x3d\x3d",b[1],b[2]));case "\x3e":case "\x3c":case "\x3e\x3d":case "\x3c\x3d":return r.convertComparison(e,
b[1],b[2]);case "in":return r.convertIn(b[1],b.slice(2));case "!in":return r.negate(r.convertIn(b[1],b.slice(2)));case "any":case "all":case "none":return r.convertCombining(e,b.slice(1));case "has":return r.convertHas(b[1]);case "!has":return r.negate(r.convertHas(b[1]));default:throw Error("Unexpected legacy filter.");}}static convertComparison(b,e,g){switch(e){case "$type":return[b,["geometry-type"],g];case "$id":return[b,["id"],g];default:return[b,["get",e],g]}}static convertIn(b,e){switch(b){case "$type":return["in",
["geometry-type"],["literal",e]];case "$id":return["in",["id"],["literal",e]];default:return["in",["get",b],["literal",e]]}}static convertHas(b){switch(b){case "$type":return!0;case "$id":return["has-id"];default:return["has",b]}}static convertCombining(b,e){return[b].concat(e.map(this.convertLegacyFilter))}static negate(b){return["!",b]}}return r})},"esri/views/2d/engine/vectorTiles/expression/expression":function(){define("exports ../../../../../Color ../../../../../core/colorUtils ../../../../../geometry/support/TileClipper ../../../unitBezier ../GeometryUtils ./types".split(" "),
function(k,v,r,b,e,g,d){function h(a,m,u){var D=typeof a;if("string"===D||"boolean"===D||"number"===D||null===a){if(u)switch(u.kind){case "string":"string"!==D&&(a=W.toString(a));break;case "number":"number"!==D&&(a=W.toNumber(a));break;case "color":a=W.toColor(a)}a=["literal",a]}if(!Array.isArray(a)||0===a.length)throw Error("Expression must be a non empty array");D=a[0];if("string"!==typeof D)throw Error("First element of expression must be a string");const J=na[D];if(void 0===J)throw Error(`Invalid expression operator "${D}"`);
if(!J)throw Error(`Unimplemented expression operator "${D}"`);return J.parse(a,m,u)}class f{constructor(a){this._parent=a;this._vars={}}add(a,m){this._vars[a]=m}get(a){return this._vars[a]?this._vars[a]:this._parent?this._parent.get(a):null}}class c{constructor(){this.type=d.valueType}static parse(a){if(1<a.length)throw Error('"id" does not expect arguments');return new c}evaluate(a,m){return a?.id}}class l{constructor(){this.type=d.stringType}static parse(a){if(1<a.length)throw Error('"geometry-type" does not expect arguments');
return new l}evaluate(a,m){if(!a)return null;switch(a.type){case b.GeometryType.Point:return"Point";case b.GeometryType.LineString:return"LineString";case b.GeometryType.Polygon:return"Polygon";default:return null}}}class t{constructor(){this.type=d.objectType}static parse(a){if(1<a.length)throw Error('"properties" does not expect arguments');return new t}evaluate(a,m){return a?.values}}class p{constructor(){this.type=d.numberType}static parse(a){if(1<a.length)throw Error('"zoom" does not expect arguments');
return new p}evaluate(a,m){return m}}class w{constructor(a,m,u){this._lhs=a;this._rhs=m;this._compare=u;this.type=d.booleanType}static parse(a,m,u){if(3!==a.length&&4!==a.length)throw Error(`"${a[0]}" expects 2 or 3 arguments`);if(4===a.length)throw Error(`"${a[0]}" collator not supported`);return new w(h(a[1],m),h(a[2],m),u)}evaluate(a,m){return this._compare(this._lhs.evaluate(a,m),this._rhs.evaluate(a,m))}}class q extends w{static parse(a,m){return w.parse(a,m,(u,D)=>u===D)}}class B extends w{static parse(a,
m){return w.parse(a,m,(u,D)=>u!==D)}}class H extends w{static parse(a,m){return w.parse(a,m,(u,D)=>u<D)}}class y extends w{static parse(a,m){return w.parse(a,m,(u,D)=>u<=D)}}class A extends w{static parse(a,m){return w.parse(a,m,(u,D)=>u>D)}}class C extends w{static parse(a,m){return w.parse(a,m,(u,D)=>u>=D)}}class E{constructor(a){this._arg=a;this.type=d.booleanType}static parse(a,m){if(2!==a.length)throw Error('"!" expects 1 argument');return new E(h(a[1],m))}evaluate(a,m){return!this._arg.evaluate(a,
m)}}class I{constructor(a){this._args=a;this.type=d.booleanType}static parse(a,m){const u=[];for(let D=1;D<a.length;D++)u.push(h(a[D],m));return new I(u)}evaluate(a,m){for(const u of this._args)if(!u.evaluate(a,m))return!1;return!0}}class K{constructor(a){this._args=a;this.type=d.booleanType}static parse(a,m){const u=[];for(let D=1;D<a.length;D++)u.push(h(a[D],m));return new K(u)}evaluate(a,m){for(const u of this._args)if(u.evaluate(a,m))return!0;return!1}}class n{constructor(a){this._args=a;this.type=
d.booleanType}static parse(a,m){const u=[];for(let D=1;D<a.length;D++)u.push(h(a[D],m));return new n(u)}evaluate(a,m){for(const u of this._args)if(u.evaluate(a,m))return!1;return!0}}class x{constructor(a,m,u){this.type=a;this._args=m;this._fallback=u}static parse(a,m,u){if(4>a.length)throw Error('"case" expects at least 3 arguments');if(1===a.length%2)throw Error('"case" expects an odd number of arguments');let D;const J=[];for(let N=1;N<a.length-1;N+=2){const Q=h(a[N],m),P=h(a[N+1],m,u);D||(D=P.type);
J.push({condition:Q,output:P})}a=h(a[a.length-1],m,u);D||(D=a.type);return new x(D,J,a)}evaluate(a,m){for(const u of this._args)if(u.condition.evaluate(a,m))return u.output.evaluate(a,m);return this._fallback.evaluate(a,m)}}class z{constructor(a,m){this.type=a;this._args=m}static parse(a,m){if(2>a.length)throw Error('"coalesce" expects at least 1 argument');let u;const D=[];for(let J=1;J<a.length;J++){const N=h(a[J],m);u||(u=N.type);D.push(N)}return new z(u,D)}evaluate(a,m){for(const u of this._args){const D=
u.evaluate(a,m);if(null!==D)return D}return null}}class F{constructor(a,m,u,D,J){this.type=a;this._input=m;this._labels=u;this._outputs=D;this._fallback=J}static parse(a,m){if(3>a.length)throw Error('"match" expects at least 3 arguments');if(0===a.length%2)throw Error('"case" expects an even number of arguments');let u;const D=h(a[1],m),J=[],N={};let Q;for(let X=2;X<a.length-1;X+=2){var P=a[X];Array.isArray(P)||(P=[P]);for(const ca of P){P=typeof ca;if("string"!==P&&"number"!==P)throw Error('"match" requires string or number literal as labels');
if(!Q)Q=P;else if(P!==Q)throw Error('"match" requires labels to have the same type');N[ca]=J.length}P=h(a[X+1],m);u||(u=P.type);J.push(P)}return new F(u,D,N,J,h(a[a.length-1],m))}evaluate(a,m){const u=this._input.evaluate(a,m);return(this._outputs[this._labels[u]]||this._fallback).evaluate(a,m)}}class G{constructor(a,m,u,D,J){this._operator=a;this.type=m;this.interpolation=u;this.input=D;this._stops=J}static parse(a,m,u){const D=a[0];if(5>a.length)throw Error(`"${D}" expects at least 4 arguments`);
const J=a[1];if(!Array.isArray(J)||0===J.length)throw Error(`"${J}" is not a valid interpolation`);switch(J[0]){case "linear":if(1!==J.length)throw Error("Linear interpolation cannot have parameters");break;case "exponential":if(2!==J.length||"number"!==typeof J[1])throw Error("Exponential interpolation requires one numeric argument");break;case "cubic-bezier":if(5!==J.length)throw Error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1");for(var N=1;5>N;N++){var Q=
J[N];if("number"!==typeof Q||0>Q||1<Q)throw Error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1");}break;default:throw Error(`"${a[0]}" unknown interpolation type "${J[0]}"`);}if(1!==a.length%2)throw Error(`"${D}" expects an even number of arguments`);N=h(a[2],m,d.numberType);let P;"interpolate-hcl"===D||"interpolate-lab"===D?P=d.colorType:u&&"value"!==u.kind&&(P=u);u=[];for(Q=3;Q<a.length;Q+=2){const X=a[Q];if("number"!==typeof X)throw Error(`"${D}" requires stop inputs as literal numbers`);
if(u.length&&u[u.length-1][0]>=X)throw Error(`"${D}" requires strictly ascending stop inputs`);const ca=h(a[Q+1],m,P);P||(P=ca.type);u.push([X,ca])}if(P&&P!==d.colorType&&P!==d.numberType&&("array"!==P.kind||P.itemType!==d.numberType))throw Error(`"${D}" cannot interpolate type ${d.typeToString(P)}`);return new G(D,P,J,N,u)}evaluate(a,m){var u=this._stops;if(1===u.length)return u[0][1].evaluate(a,m);var D=this.input.evaluate(a,m);if(D<=u[0][0])return u[0][1].evaluate(a,m);if(D>=u[u.length-1][0])return u[u.length-
1][1].evaluate(a,m);let J=0;for(;++J<u.length&&!(D<u[J][0]););const N=G.interpolationRatio(this.interpolation,D,u[J-1][0],u[J][0]);D=u[J-1][1].evaluate(a,m);const Q=u[J][1].evaluate(a,m);if("interpolate"===this._operator){if("array"===this.type.kind&&Array.isArray(D)&&Array.isArray(Q))return D.map((P,X)=>g.interpolate(P,Q[X],N));if("color"===this.type.kind&&D instanceof v&&Q instanceof v)return D=new v(D),a=new v(Q),new v([g.interpolate(D.r,a.r,N),g.interpolate(D.g,a.g,N),g.interpolate(D.b,a.b,N),
g.interpolate(D.a,a.a,N)]);if("number"===this.type.kind&&"number"===typeof D&&"number"===typeof Q)return g.interpolate(D,Q,N);throw Error(`"${this._operator}" cannot interpolate type ${d.typeToString(this.type)}`);}if("interpolate-hcl"===this._operator)return a=r.toLCH(D),m=r.toLCH(Q),u=m.h-a.h,a=r.toRGB({h:a.h+N*(180<u||-180>u?u-360*Math.round(u/360):u),c:g.interpolate(a.c,m.c,N),l:g.interpolate(a.l,m.l,N)}),new v({a:g.interpolate(D.a,Q.a,N),...a});if("interpolate-lab"===this._operator)return a=
r.toLAB(D),m=r.toLAB(Q),a=r.toRGB({l:g.interpolate(a.l,m.l,N),a:g.interpolate(a.a,m.a,N),b:g.interpolate(a.b,m.b,N)}),new v({a:g.interpolate(D.a,Q.a,N),...a});throw Error(`Unexpected operator "${this._operator}"`);}interpolationUniformValue(a,m){const u=this._stops;if(1===u.length||a>=u[u.length-1][0])return 0;let D=0;for(;++D<u.length&&!(a<u[D][0]););return G.interpolationRatio(this.interpolation,m,u[D-1][0],u[D][0])}getInterpolationRange(a){const m=this._stops;if(1===m.length)return a=m[0][0],[a,
a];var u=m[m.length-1][0];if(a>=u)return[u,u];for(u=0;++u<m.length&&!(a<m[u][0]););return[m[u-1][0],m[u][0]]}static interpolationRatio(a,m,u,D){let J=0;"linear"===a[0]?J=G._exponentialInterpolationRatio(m,1,u,D):"exponential"===a[0]?J=G._exponentialInterpolationRatio(m,a[1],u,D):"cubic-bezier"===a[0]&&(J=e.unitBezier(a[1],a[2],a[3],a[4])(G._exponentialInterpolationRatio(m,1,u,D),1E-5));0>J?J=0:1<J&&(J=1);return J}static _exponentialInterpolationRatio(a,m,u,D){D-=u;if(0===D)return 0;a-=u;return 1===
m?a/D:(m**a-1)/(m**D-1)}}class L{constructor(a,m,u){this.type=a;this._input=m;this._stops=u}static parse(a,m){if(5>a.length)throw Error('"step" expects at least 4 arguments');if(1!==a.length%2)throw Error('"step" expects an even number of arguments');const u=h(a[1],m,d.numberType);let D;const J=[];J.push([-Infinity,h(a[2],m)]);for(let N=3;N<a.length;N+=2){const Q=a[N];if("number"!==typeof Q)throw Error('"step" requires stop inputs as literal numbers');if(J.length&&J[J.length-1][0]>=Q)throw Error('"step" requires strictly ascending stop inputs');
const P=h(a[N+1],m);D||(D=P.type);J.push([Q,P])}return new L(D,u,J)}evaluate(a,m){const u=this._stops;if(1===u.length)return u[0][1].evaluate(a,m);const D=this._input.evaluate(a,m);let J=0;for(;++J<u.length&&!(D<u[J][0]););return this._stops[J-1][1].evaluate(a,m)}}class M{constructor(a,m){this.type=a;this._output=m}static parse(a,m,u){if(4>a.length)throw Error('"let" expects at least 3 arguments');if(1===a.length%2)throw Error('"let" expects an odd number of arguments');const D=new f(m);for(let J=
1;J<a.length-1;J+=2){const N=a[J];if("string"!==typeof N)throw Error(`"let" requires a string to define variable names - found ${N}`);D.add(N,h(a[J+1],m))}a=h(a[a.length-1],D,u);return new M(a.type,a)}evaluate(a,m){return this._output.evaluate(a,m)}}class O{constructor(a,m){this.type=a;this.output=m}static parse(a,m,u){if(2!==a.length||"string"!==typeof a[1])throw Error('"var" requires just one literal string argument');m=m.get(a[1]);if(!m)throw Error(`${a[1]} must be defined before being used in a "var" expression`);
return new O(u||d.valueType,m)}evaluate(a,m){return this.output.evaluate(a,m)}}class R{constructor(a,m,u){this.type=a;this._index=m;this._array=u}static parse(a,m){if(3!==a.length)throw Error('"at" expects 2 arguments');const u=h(a[1],m,d.numberType);a=h(a[2],m);return new R(a.type.itemType,u,a)}evaluate(a,m){const u=this._index.evaluate(a,m);a=this._array.evaluate(a,m);if(0>u||u>=a.length)throw Error('"at" index out of bounds');if(u!==Math.floor(u))throw Error('"at" index must be an integer');return a[u]}}
class S{constructor(a,m){this._key=a;this._obj=m;this.type=d.valueType}static parse(a,m){let u;switch(a.length){case 2:return u=h(a[1],m),new S(u);case 3:return u=h(a[1],m),a=h(a[2],m),new S(u,a);default:throw Error('"get" expects 1 or 2 arguments');}}evaluate(a,m){const u=this._key.evaluate(a,m);return this._obj?this._obj.evaluate(a,m)[u]:a?.values[u]}}class U{constructor(a,m){this._key=a;this._obj=m;this.type=d.booleanType}static parse(a,m){let u;switch(a.length){case 2:return u=h(a[1],m),new U(u);
case 3:return u=h(a[1],m),a=h(a[2],m),new U(u,a);default:throw Error('"has" expects 1 or 2 arguments');}}evaluate(a,m){const u=this._key.evaluate(a,m);return this._obj?(a=this._obj.evaluate(a,m),u in a):!!a?.values[u]}}class Y{constructor(a,m){this._key=a;this._vals=m;this.type=d.booleanType}static parse(a,m){if(3!==a.length)throw Error('"in" expects 2 arguments');return new Y(h(a[1],m),h(a[2],m))}evaluate(a,m){const u=this._key.evaluate(a,m);return this._vals.evaluate(a,m).includes(u)}}class aa{constructor(a,
m,u){this._item=a;this._array=m;this._from=u;this.type=d.numberType}static parse(a,m){if(3>a.length||4<a.length)throw Error('"index-of" expects 3 or 4 arguments');const u=h(a[1],m),D=h(a[2],m);return 4===a.length?(a=h(a[3],m,d.numberType),new aa(u,D,a)):new aa(u,D)}evaluate(a,m){const u=this._item.evaluate(a,m),D=this._array.evaluate(a,m);if(this._from){a=this._from.evaluate(a,m);if(a!==Math.floor(a))throw Error('"index-of" index must be an integer');return D.indexOf(u,a)}return D.indexOf(u)}}class ea{constructor(a){this._arg=
a;this.type=d.numberType}static parse(a,m){if(2!==a.length)throw Error('"length" expects 2 arguments');a=h(a[1],m);return new ea(a)}evaluate(a,m){a=this._arg.evaluate(a,m);if("string"===typeof a||Array.isArray(a))return a.length;throw Error('"length" expects string or array');}}class da{constructor(a,m,u,D){this.type=a;this._array=m;this._from=u;this._to=D}static parse(a,m){if(3>a.length||4<a.length)throw Error('"slice" expects 2 or 3 arguments');const u=h(a[1],m),D=h(a[2],m,d.numberType);if(D.type!==
d.numberType)throw Error('"slice" index must return a number');if(4===a.length){a=h(a[3],m,d.numberType);if(a.type!==d.numberType)throw Error('"slice" index must return a number');return new da(u.type,u,D,a)}return new da(u.type,u,D)}evaluate(a,m){const u=this._array.evaluate(a,m);if(!Array.isArray(u)&&"string"!==typeof u)throw Error('"slice" input must be an array or a string');const D=this._from.evaluate(a,m);if(0>D||D>=u.length)throw Error('"slice" index out of bounds');if(D!==Math.floor(D))throw Error('"slice" index must be an integer');
if(this._to){a=this._to.evaluate(a,m);if(0>a||a>=u.length)throw Error('"slice" index out of bounds');if(a!==Math.floor(a))throw Error('"slice" index must be an integer');return u.slice(D,a)}return u.slice(D)}}class fa{constructor(){this.type=d.booleanType}static parse(a){if(1!==a.length)throw Error('"has-id" expects no arguments');return new fa}evaluate(a,m){return void 0!==a?.id}}class V{constructor(a,m){this._args=a;this._calculate=m;this.type=d.numberType}static parse(a,m,u){a=a.slice(1).map(D=>
h(D,m));return new V(a,u)}evaluate(a,m){let u;this._args&&(u=this._args.map(D=>D.evaluate(a,m)));return this._calculate(u)}}class oa extends V{static parse(a,m){switch(a.length){case 2:return V.parse(a,m,u=>-u[0]);case 3:return V.parse(a,m,u=>u[0]-u[1]);default:throw Error('"-" expects 1 or 2 arguments');}}}class pa extends V{static parse(a,m){return V.parse(a,m,u=>{let D=1;for(const J of u)D*=J;return D})}}class qa extends V{static parse(a,m){if(3===a.length)return V.parse(a,m,u=>u[0]/u[1]);throw Error('"/" expects 2 arguments');
}}class ra extends V{static parse(a,m){if(3===a.length)return V.parse(a,m,u=>u[0]%u[1]);throw Error('"%" expects 2 arguments');}}class sa extends V{static parse(a,m){if(3===a.length)return V.parse(a,m,u=>u[0]**u[1]);throw Error('"^" expects 1 or 2 arguments');}}class ta extends V{static parse(a,m){return V.parse(a,m,u=>{let D=0;for(const J of u)D+=J;return D})}}class T{constructor(a,m){this._args=a;this._calculate=m;this.type=d.numberType}static parse(a,m){const u=a.slice(1).map(D=>h(D,m));return new T(u,
T.ops[a[0]])}evaluate(a,m){let u;this._args&&(u=this._args.map(D=>D.evaluate(a,m)));return this._calculate(u)}}T.ops={abs:a=>Math.abs(a[0]),acos:a=>Math.acos(a[0]),asin:a=>Math.asin(a[0]),atan:a=>Math.atan(a[0]),ceil:a=>Math.ceil(a[0]),cos:a=>Math.cos(a[0]),e:()=>Math.E,floor:a=>Math.floor(a[0]),ln:a=>Math.log(a[0]),ln2:()=>Math.LN2,log10:a=>Math.log(a[0])/Math.LN10,log2:a=>Math.log(a[0])/Math.LN2,max:a=>Math.max(...a),min:a=>Math.min(...a),pi:()=>Math.PI,round:a=>Math.round(a[0]),sin:a=>Math.sin(a[0]),
sqrt:a=>Math.sqrt(a[0]),tan:a=>Math.tan(a[0])};class ha{constructor(a){this._args=a;this.type=d.stringType}static parse(a,m){return new ha(a.slice(1).map(u=>h(u,m)))}evaluate(a,m){return this._args.map(u=>u.evaluate(a,m)).join("")}}class ba{constructor(a,m){this._arg=a;this._calculate=m;this.type=d.stringType}static parse(a,m){if(2!==a.length)throw Error(`${a[0]} expects 1 argument`);m=h(a[1],m);return new ba(m,ba.ops[a[0]])}evaluate(a,m){return this._calculate(this._arg.evaluate(a,m))}}ba.ops={downcase:a=>
a.toLowerCase(),upcase:a=>a.toUpperCase()};class ia{constructor(a){this._args=a;this.type=d.colorType}static parse(a,m){if(4!==a.length)throw Error('"rgb" expects 3 arguments');a=a.slice(1).map(u=>h(u,m));return new ia(a)}evaluate(a,m){const u=this._validate(this._args[0].evaluate(a,m)),D=this._validate(this._args[1].evaluate(a,m));a=this._validate(this._args[2].evaluate(a,m));return new v({r:u,g:D,b:a})}_validate(a){if("number"!==typeof a||0>a||255<a)throw Error(`${a}: invalid color component`);
return Math.round(a)}}class ja{constructor(a){this._args=a;this.type=d.colorType}static parse(a,m){if(5!==a.length)throw Error('"rgba" expects 4 arguments');a=a.slice(1).map(u=>h(u,m));return new ja(a)}evaluate(a,m){const u=this._validate(this._args[0].evaluate(a,m)),D=this._validate(this._args[1].evaluate(a,m)),J=this._validate(this._args[2].evaluate(a,m));a=this._validateAlpha(this._args[3].evaluate(a,m));return new v({r:u,g:D,b:J,a})}_validate(a){if("number"!==typeof a||0>a||255<a)throw Error(`${a}: invalid color component`);
return Math.round(a)}_validateAlpha(a){if("number"!==typeof a||0>a||1<a)throw Error(`${a}: invalid alpha color component`);return a}}class ka{constructor(a){this._color=a;this.type=d.arrayType(d.numberType,4)}static parse(a,m){if(2!==a.length)throw Error('"to-rgba" expects 1 argument');a=h(a[1],m);return new ka(a)}evaluate(a,m){return(new v(this._color.evaluate(a,m))).toRgba()}}class Z{constructor(a,m){this.type=a;this._args=m}static parse(a,m){var u=a[0];if(2>a.length)throw Error(`${u} expects at least one argument`);
let D=1,J;if("array"===u){if(2<a.length){switch(a[1]){case "string":J=d.stringType;break;case "number":J=d.numberType;break;case "boolean":J=d.booleanType;break;default:throw Error('"array" type argument must be string, number or boolean');}D++}else J=d.valueType;if(3<a.length){var N=a[2];if(null!==N&&("number"!==typeof N||0>N||N!==Math.floor(N)))throw Error('"array" length argument must be a positive integer literal');D++}J=d.arrayType(J,N)}else switch(u){case "string":J=d.stringType;break;case "number":J=
d.numberType;break;case "boolean":J=d.booleanType;break;case "object":J=d.objectType}for(u=[];D<a.length;D++)N=h(a[D],m),u.push(N);return new Z(J,u)}evaluate(a,m){let u;for(const D of this._args){const J=D.evaluate(a,m);u=d.getType(J);if(d.matchType(u,this.type))return J}throw Error(`Expected ${d.typeToString(this.type)} but got ${d.typeToString(u)}`);}}class W{constructor(a,m){this.type=a;this._args=m}static parse(a,m){var u=a[0];const D=W.types[u];if(D===d.booleanType||D===d.stringType){if(2!==
a.length)throw Error(`${u} expects one argument`);}else if(2>a.length)throw Error(`${u} expects at least one argument`);u=[];for(let J=1;J<a.length;J++){const N=h(a[J],m);u.push(N)}return new W(D,u)}evaluate(a,m){if(this.type===d.booleanType)return!!this._args[0].evaluate(a,m);if(this.type===d.stringType)return d.valueToString(this._args[0].evaluate(a,m));if(this.type===d.numberType){for(const D of this._args){var u=Number(D.evaluate(a,m));if(!isNaN(u))return u}return null}if(this.type===d.colorType){for(u of this._args)try{const D=
W.toColor(u.evaluate(a,m));if(D instanceof v)return D}catch{}return null}}static toBoolean(a){return!!a}static toString(a){return d.valueToString(a)}static toNumber(a){const m=Number(a);if(isNaN(m))throw Error(`"${a}" is not a number`);return m}static toColor(a){if(a instanceof v)return a;if("string"===typeof a){const m=v.fromString(a);if(m)return m;throw Error(`"${a}" is not a color`);}if(Array.isArray(a))return v.fromArray(a);throw Error(`"${a}" is not a color`);}}W.types={"to-boolean":d.booleanType,
"to-color":d.colorType,"to-number":d.numberType,"to-string":d.stringType};class la{constructor(a){this._val=a;this.type=d.getType(a)}static parse(a){if(2!==a.length)throw Error('"literal" expects 1 argument');return new la(a[1])}evaluate(a,m){return this._val}}class ma{constructor(a){this._arg=a;this.type=d.stringType}static parse(a,m){if(2!==a.length)throw Error('"typeof" expects 1 argument');return new ma(h(a[1],m))}evaluate(a,m){return d.typeToString(d.getType(this._arg.evaluate(a,m)))}}const na=
{array:Z,boolean:Z,collator:null,format:null,image:null,literal:la,number:Z,"number-format":null,object:Z,string:Z,"to-boolean":W,"to-color":W,"to-number":W,"to-string":W,typeof:ma,accumulated:null,"feature-state":null,"geometry-type":l,id:c,"line-progress":null,properties:t,at:R,get:S,has:U,in:Y,"index-of":aa,length:ea,slice:da,"!":E,"!\x3d":B,"\x3c":H,"\x3c\x3d":y,"\x3d\x3d":q,"\x3e":A,"\x3e\x3d":C,all:I,any:K,case:x,coalesce:z,match:F,within:null,interpolate:G,"interpolate-hcl":G,"interpolate-lab":G,
step:L,let:M,var:O,concat:ha,downcase:ba,"is-supported-script":null,"resolved-locale":null,upcase:ba,rgb:ia,rgba:ja,"to-rgba":ka,"-":oa,"*":pa,"/":qa,"%":ra,"^":sa,"+":ta,abs:T,acos:T,asin:T,atan:T,ceil:T,cos:T,e:T,floor:T,ln:T,ln2:T,log10:T,log2:T,max:T,min:T,pi:T,round:T,sin:T,sqrt:T,tan:T,zoom:p,"heatmap-density":null,"has-id":fa,none:n};k.ALL=I;k.ANY=K;k.Add=ta;k.Assert=Z;k.At=R;k.Calculate=T;k.Case=x;k.Coalesce=z;k.Coerce=W;k.Concat=ha;k.Div=qa;k.EQ=q;k.GE=C;k.GT=A;k.GeomType=l;k.Get=S;k.Has=
U;k.HasID=fa;k.ID=c;k.In=Y;k.IndexOf=aa;k.Interpolate=G;k.LE=y;k.LT=H;k.Length=ea;k.Let=M;k.Literal=la;k.Match=F;k.Mod=ra;k.Mul=pa;k.NE=B;k.NONE=n;k.NOT=E;k.Pow=sa;k.Properties=t;k.Rgb=ia;k.Rgba=ja;k.Slice=da;k.Step=L;k.String=ba;k.Sub=oa;k.ToRgba=ka;k.TypeOf=ma;k.Var=O;k.Zoom=p;k.createExpression=h;k.ops=na;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/unitBezier":function(){define(["exports"],function(k){function v(e,g,d,h){function f(B,H){var y;let A,C;A=B;for(y=
0;8>y;y++){C=((t*A+l)*A+c)*A-B;if(Math.abs(C)<H)return A;var E=(3*t*A+2*l)*A+c;if(1E-6>Math.abs(E))break;A-=C/E}E=0;y=1;A=B;if(A<E)return E;if(A>y)return y;for(;E<y;){C=((t*A+l)*A+c)*A;if(Math.abs(C-B)<H)break;B>C?E=A:y=A;A=.5*(y-E)+E}return A}const c=3*e,l=3*(d-e)-c,t=1-c-l,p=3*g,w=3*(h-g)-p,q=1-p-w;return function(B,H=1E-6){B=f(B,H);return((q*B+w)*B+p)*B}}const r=/^cubic-bezier\((.*)\)/,b={};b.ease=v(.25,.1,.25,1);b.linear=v(0,0,1,1);b.easeIn=b["ease-in"]=v(.42,0,1,1);b.easeOut=b["ease-out"]=v(0,
0,.58,1);b.easeInOut=b["ease-in-out"]=v(.42,0,.58,1);k.easingFunctions=b;k.parse=function(e){let g=b[e]||null;!g&&(e=r.exec(e))&&(e=e[1].split(",").map(d=>parseFloat(d.trim())),4!==e.length||e.some(d=>isNaN(d))||(g=v.apply(v,e)));return g};k.unitBezier=v;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/expression/types":function(){define(["exports","../../../../../Color"],function(k,v){function r(q,B){return{kind:"array",itemType:q,n:B}}function b(q){if("array"===
q.kind){const B=b(q.itemType);return"number"===typeof q.n?`array<${B}, ${q.n}>`:"value"===q.itemType.kind?"array":`array<${B}>`}return q.kind}function e(q){if(null===q)return d;if("string"===typeof q)return f;if("boolean"===typeof q)return c;if("number"===typeof q)return h;if(q instanceof v)return l;if(Array.isArray(q)){let B;for(const H of q){const y=e(H);if(!B)B=y;else if(B!==y){B=p;break}}return r(B||p,q.length)}return"object"===typeof q?t:p}function g(q,B){if("array"===B.kind)return"array"===
q.kind&&(0===q.n&&"value"===q.itemType.kind||g(q.itemType,B.itemType))&&("number"!==typeof B.n||B.n===q.n);if("value"===B.kind)for(const H of w)if(g(q,H))return!0;return B.kind===q.kind}const d={kind:"null"},h={kind:"number"},f={kind:"string"},c={kind:"boolean"},l={kind:"color"},t={kind:"object"},p={kind:"value"},w=[d,h,f,c,l,t,r(p)];k.arrayType=r;k.booleanType=c;k.colorType=l;k.getType=e;k.matchType=g;k.nullType=d;k.numberType=h;k.objectType=t;k.stringType=f;k.typeToString=b;k.valueToString=function(q){if(null===
q)return"";const B=typeof q;return"string"===B?q:"number"===B||"boolean"===B?String(q):q instanceof v?q.toString():JSON.stringify(q)};k.valueType=p;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/style/StyleProperty":function(){define(["../../../../../Color","../GeometryUtils","../expression/expression","../expression/types"],function(k,v,r,b){class e{constructor(g,d){this.isDataDriven=!1;this.interpolator=null;switch(g.type){case "number":var h=!0;
break;case "color":h=!0;break;case "array":h="number"===g.value;break;default:h=!1}null==d&&(d=g.default);if(Array.isArray(d)&&0<d.length&&r.ops[d[0]]){h={number:b.numberType,color:b.colorType,string:b.stringType,boolean:b.booleanType,enum:b.stringType};try{var f="array"===g.type?b.arrayType(h[g.value]||b.valueType,g.length):h[g.type];const c=r.createExpression(d,null,f);this.getValue=this._buildExpression(c,g);this.isDataDriven=!0;c instanceof r.Interpolate&&c.input instanceof r.Zoom&&(this.interpolator=
c)}catch(c){console.log(c.message),this.getValue=this._buildSimple(g.default)}}else{h&&"interval"===d.type&&(h=!1);if(f=d?.stops&&0<d.stops.length)for(const c of d.stops)c[1]=this._validate(c[1],g);if(this.isDataDriven=d?!!d.property:!1)if(void 0!==d.default&&(d.default=this._validate(d.default,g)),f)switch(d.type){case "identity":this.getValue=this._buildIdentity(d,g);break;case "categorical":this.getValue=this._buildCategorical(d,g);break;default:this.getValue=h?this._buildInterpolate(d,g):this._buildInterval(d,
g)}else this.getValue=this._buildIdentity(d,g);else f?this.getValue=h?this._buildZoomInterpolate(d):this._buildZoomInterval(d):(d=this._validate(d,g),this.getValue=this._buildSimple(d))}}_validate(g,d){if("number"===d.type){if(null!=d.minimum&&g<d.minimum)return d.minimum;if(null!=d.maximum&&g>d.maximum)return d.maximum}else"color"===d.type?g=e._parseColor(g):"enum"===d.type?"string"===typeof g&&(g=d.values.indexOf(g)):"array"===d.type&&"enum"===d.value?g=g.map(h=>"string"===typeof h?d.values.indexOf(h):
h):"string"===d.type&&(g=b.valueToString(g));return g}_buildSimple(g){return()=>g}_buildExpression(g,d){return(h,f)=>{try{const c=g.evaluate(f,h);return void 0===c?d.default:this._validate(c,d)}catch(c){return console.log(c.message),d.default}}}_buildIdentity(g,d){return(h,f)=>{let c;f&&(c=f.values[g.property]);void 0!==c&&(c=this._validate(c,d));return null!=c?c:void 0!==g.default?g.default:d.default}}_buildCategorical(g,d){return(h,f)=>{let c;f&&(c=f.values[g.property]);c=this._categorical(c,g.stops);
return void 0!==c?c:void 0!==g.default?g.default:d.default}}_buildInterval(g,d){return(h,f)=>{let c;f&&(c=f.values[g.property]);return"number"===typeof c?this._interval(c,g.stops):void 0!==g.default?g.default:d.default}}_buildInterpolate(g,d){return(h,f)=>{let c;f&&(c=f.values[g.property]);return"number"===typeof c?this._interpolate(c,g.stops,g.base||1):void 0!==g.default?g.default:d.default}}_buildZoomInterpolate(g){return d=>this._interpolate(d,g.stops,g.base||1)}_buildZoomInterval(g){return d=>
this._interval(d,g.stops)}_categorical(g,d){const h=d.length;for(let f=0;f<h;f++)if(d[f][0]===g)return d[f][1]}_interval(g,d){const h=d.length;let f=0;for(let c=0;c<h;c++)if(d[c][0]<=g)f=c;else break;return d[f][1]}_interpolate(g,d,h){const f=d.length;for(let t=0;t<f;t++){const p=d[t];if(p[0]<=g)var c=p;else{var l=p;break}}if(c&&l){d=l[0]-c[0];g-=c[0];h=1===h?g/d:(h**g-1)/(h**d-1);if(Array.isArray(c[1])){c=c[1];l=l[1];g=[];for(d=0;d<c.length;d++)g.push(v.interpolate(c[d],l[d],h));return g}return v.interpolate(c[1],
l[1],h)}if(c)return c[1];if(l)return l[1]}static _isEmpty(g){for(const d in g)if(g.hasOwnProperty(d))return!1;return!0}static _parseColor(g){if(Array.isArray(g))return g;"string"===typeof g&&(g=new k(g));if(g instanceof k&&!this._isEmpty(g))return k.toUnitRGBA(g)}}return e})},"*noref":1}});
define("../../../chunks/tslib.es6 ../../../core/Error ../../../core/has ../../../core/maybe ../../../core/promiseUtils ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ../../2d/engine/vectorTiles/SchemaHelper ../../2d/engine/vectorTiles/TileHandler3D ../../2d/engine/vectorTiles/VTLPainter3D ../../2d/engine/vectorTiles/style/StyleRepository ./LayerView3D ./TiledLayerView3D ../terrain/terrainUtils ../../layers/LayerView".split(" "),function(k,
v,r,b,e,g,d,h,f,c,l,t,p,w,q,B,H,y){function A(C){return E=>C.immediate.schedule(E)}h=class extends B.TiledLayerView3D(q.LayerView3D(y)){constructor(){super(...arguments);this._tileHandlerController=null;this.type="vector-tile-3d";this.levelShift=r("disable-feature:vtl-level-shift")?0:1}initialize(){if(null==this.layer.fullExtent)this.addResolvingPromise(Promise.reject(new v("vectortilelayerview:full-extent-undefined","This layer view's layer does not define a fullExtent.")));else{var {basemapTerrain:C,
spatialReference:E,state:I,viewingMode:K}=this.view,n="local"===K&&!H.vtlAssumes256PixelSizeAsDefault(E)||H.test.force512VTL?this.layer.tileInfo:this.layer.tileInfo.getCompatibleForVTL(256);n=this._getTileInfoSupportError(n,this.layer.fullExtent);if(null!=n)return this.addResolvingPromise(Promise.reject(n));n=g.whenOnce(()=>this.view?.basemapTerrain?.tilingSchemeLocked).then(()=>{var M=C.tilingScheme,O=M.pixelSize;this.schemaHelper=new l.SchemaHelper(256===O?1:2,C.spatialReference?.isGeographic&&
256===O?1:0,this.levelShift+(C.spatialReference?.isGeographic||256!==O?0:1));O=256===O||512===O?this.layer.tileInfo.getCompatibleForVTL(O):this.layer.tileInfo;if(M=this._getTileInfoCompatibilityError(O,M))throw M;this.tileInfo=O});this._tileHandlerController=new AbortController;var x=this.view.resourceController;this._memCache=x.memoryController.newCache(`vtl-${this.layer.uid}`,M=>M.release());this.addHandles(g.watch(()=>this.view.qualitySettings.memoryLimit,M=>this._memCache.maxSize=Math.ceil(M/
10*1048576),g.syncAndInitial));var z=new w(this.layer.currentStyleInfo.style);this._tileHandler=new t(this.layer,z,I.contentPixelRatio,this._memCache);var F=this._tileHandlerController.signal,G=A(x);x=this._tileHandler.start({signal:F,schedule:G});z=this._tileHandler.spriteMosaic;z.then(M=>{!e.isAborted(F)&&this._tileHandler&&(this.painter=new p(M,this._tileHandler.glyphMosaic))});x.then(()=>this._tileHandlerController=null);var L=()=>{this._tileHandlerController&&this._tileHandlerController.abort();
this._tileHandlerController=new AbortController;this._memCache.clear();var M=this.view.state?.contentPixelRatio??1,O=new w(this.layer.currentStyleInfo.style);const R=new t(this.layer,O,M,this._memCache);M=R.start({signal:this._tileHandlerController.signal,schedule:G});O=R.spriteMosaic;M.then(()=>this._tileHandlerController=null);this._updatingHandles.addPromise(Promise.all([M,O]).then(([,S])=>{const U=this._tileHandler,Y=this.painter;this.painter=new p(S,R.glyphMosaic);this._tileHandler=R;this.emit("data-changed");
U.destroy();Y&&Y.dispose()}))};this._updatingHandles.add(()=>({style:this.layer.currentStyleInfo.style,pixelRatio:this.view.state?.contentPixelRatio}),L);this.addHandles([this.layer.on("paint-change",()=>this.emit("data-changed")),this.layer.on("style-layer-change",L),this.layer.on("delete-style-layer",L),this.layer.on("spriteSource-change",()=>this.emit("data-changed")),this.layer.on("layout-change",()=>this.emit("data-changed")),this.layer.on("style-layer-visibility-change",()=>this.emit("data-changed"))]);
n=Promise.all([n,x,z]);this.addResolvingPromise(n)}}destroy(){this.painter=b.disposeMaybe(this.painter);this._tileHandlerController=b.abortMaybe(this._tileHandlerController);this._tileHandler=b.destroyMaybe(this._tileHandler);this._memCache=b.destroyMaybe(this._memCache)}get contentZoom(){return r("disable-feature:vtl-level-shift")?1:this.view.qualitySettings.tiledSurface.vtlContentZoom}get displayLevelRange(){var C=this.tileInfo.lods;C=this.levelRangeFromScaleRange(this.layer.minScale||C[0].scale,
this.layer.maxScale||C[C.length-1].scale);this.layer.maxScale?C.maxLevel++:C.maxLevel+=this.levelShift;return C}get dataScaleRange(){const C=this.tileInfo.lods;return{minScale:C[0].scale,maxScale:C[C.length-1].scale}}get dataLevelRange(){const {minScale:C,maxScale:E}=this.dataScaleRange,I=this.levelRangeFromScaleRange(C,E);1===I.minLevel&&256===this.tileInfo.size[0]&&(I.minLevel=0);I.maxLevel+=this.levelShift;return I}async fetchTile(C,E){C=this.schemaHelper.getLevelRowColumn(C);return this._tileHandler.getVectorTile(C,
E)}};k.__decorate([d.property()],h.prototype,"layer",void 0);k.__decorate([d.property()],h.prototype,"levelShift",void 0);k.__decorate([d.property()],h.prototype,"contentZoom",null);k.__decorate([d.property()],h.prototype,"displayLevelRange",null);k.__decorate([d.property()],h.prototype,"tileInfo",void 0);k.__decorate([d.property()],h.prototype,"dataScaleRange",null);k.__decorate([d.property()],h.prototype,"dataLevelRange",null);k.__decorate([d.property()],h.prototype,"updatingProgressValue",void 0);
return h=k.__decorate([c.subclass("esri.views.3d.layers.VectorTileLayerView3D")],h)});