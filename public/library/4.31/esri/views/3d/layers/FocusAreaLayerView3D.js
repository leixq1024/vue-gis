// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.31/esri/copyright.txt for details.
//>>built
define("../../../chunks/tslib.es6 ../../../core/maybe ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/decorators/subclass ../../../chunks/earcut ../../../core/libs/gl-matrix-2/factories/mat4f64 ../../../chunks/vec32 ../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../geometry/projection/computeTranslationToOriginAndRotation ../../../geometry/support/DoubleArray ../../../geometry/support/Indices ../../../chunks/vec3 ../../ViewingMode ./LayerView3D ./graphics/ElevationContext ./graphics/Graphics3DExtrudeSymbolLayer ./graphics/graphicUtils ../support/renderInfoUtils/polygon ../webgl-engine/effects/focusArea/FocusAreaRenderNode ../../layers/LayerView".split(" "),
function(r,u,f,v,A,B,w,C,x,D,l,y,E,F,c,G,H,I,J,g,K){c=class extends c.LayerView3D(K){constructor(){super(...arguments);this.type="focusArea-3d";this._elevationContext=new G.ElevationContext;this._geometries=[]}initialize(){this.addHandles([f.watch(()=>this.layer.geometries,(a,b)=>{this._extrudePolygons(a);this._setFocusAreaRenderNode()},f.syncAndInitial),f.watch(()=>this.layer.tmpEffect,(a,b)=>{b=a;this._renderNode&&b&&(this._renderNode.effect=g.effectsMapping[b])},f.syncAndInitial),f.watch(()=>this.layer.visible,
(a,b)=>{a?this._renderNode??(this._renderNode=new g.FocusAreaRenderNode({view:this.view,techniques:this.view._stage.renderView.techniques,focusAreaGeometries:this._geometries,effect:g.effectsMapping[this.layer.tmpEffect??"none"]})):this._renderNode=u.destroyMaybe(this._renderNode)},f.syncAndInitial)])}destroy(){this._renderNode=u.destroyMaybe(this._renderNode);this._geometries=[]}_extrudePolygons(a){this._geometries=[];for(const t of a){a=w.create();const h=x.create(),z=this.view.renderCoordsHelper.viewingMode===
F.ViewingMode.Global;z||this.view.renderCoordsHelper.worldUpAtPosition(null,h);var b=I.computeCentroid(t);if(null==b)break;D.computeTranslationToOriginAndRotation(t.spatialReference,[b.x,b.y,0],a,this.view.renderCoordsHelper.spatialReference);b=C.normalize(L,[a[12]-0*h[0],a[13]-0*h[1],a[14]-0*h[2]]);const m=w.create();m[12]=-a[12];m[13]=-a[13];m[14]=-a[14];var d=J.geometryToRenderInfo(t,this.view.elevationProvider,this.view.renderCoordsHelper,this._elevationContext);const {polygons:M,mapPositions:N,
position:O}=d;for(const n of M){var p=n.count;d=B.earcut(n.mapPositions,n.holeIndices,3);if(0===d.length)continue;var k=d.length,e=6*p;p=y.newIndexArray(e+k);k=y.newIndexArray(k);const q=l.newDoubleArray(3*e),P=l.newDoubleArray(3*e),Q=l.newDoubleArray(3*e);e=l.newDoubleArray(e);H.extrudePolygon(O,N,d,n,q,Q,P,e,p,k,1E4,h,z);E.transformMat4(q,q,m);d=new g.FocusAreaGeometry(q,k,p,1E4,[a[12]+0*b[0],a[13]+0*b[1],a[14]+0*b[2]]);this._geometries.push(d)}}}_setFocusAreaRenderNode(){this._renderNode?(this._renderNode.focusAreaGeometries=
this._geometries,this._renderNode.setExtrudedVolume()):this._renderNode=new g.FocusAreaRenderNode({view:this.view,techniques:this.view._stage.renderView.techniques,focusAreaGeometries:this._geometries,effect:g.effectsMapping[this.layer.tmpEffect??"none"]})}};r.__decorate([v.property()],c.prototype,"type",void 0);r.__decorate([v.property()],c.prototype,"layer",void 0);c=r.__decorate([A.subclass("esri.views.3d.layers.FocusAreaLayerView3D")],c);const L=x.create();return c});