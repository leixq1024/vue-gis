// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.31/esri/copyright.txt for details.
//>>built
define("exports ../../../../../chunks/tslib.es6 ../../../../../core/Accessor ../../../../../core/arrayUtils ../../../../../core/colorUtils ../../../../../core/has ../../../../../core/Evented ../../../../../core/Handles ../../../../../core/handleUtils ../../../../../core/maybe ../../../../../core/reactiveUtils ../../../../../core/accessorSupport/decorators/property ../../../../../core/Logger ../../../../../core/accessorSupport/decorators/subclass ../../../../../core/libs/gl-matrix-2/factories/mat4f64 ../../../../../chunks/vec32 ../../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../../core/support/UpdatingHandles ../../../../../geometry/Point ../../../../../geometry/Polyline ../../../../../geometry/SpatialReference ../../../../../layers/graphics/dehydratedPoint ../../../../../symbols/support/utils ../../Manipulator3D ../../manipulatorUtils ../../RenderObject ../../SegmentLabels3D ../../SnappingVisualizer3D ../dragEventPipeline3D ../geometryUtils ../ManipulatorType ../manipulatorUtils ../settings ../visualElementUtils ../manipulations/config ../manipulations/MoveManipulation ../manipulations/MoveXYObjectManipulation ./edgeOffsetUtils ./reshapeTooltipUtils3D ../../visualElements/OutlineVisualElement ../../../webgl-engine/lib/GeometryUtil ../../../../input/IViewEvents ../../../../interactive/dragEventPipeline ../../../../interactive/interfaces ../../../../interactive/keybindings ../../../../interactive/editGeometry/interfaces ../../../../interactive/snapping/SnappingContext ../../../../interactive/snapping/SnappingDragPipelineStep ../../../../interactive/tooltip/tooltipCommonUtils".split(" "),
function(m,r,ka,la,C,Da,ma,na,H,z,w,t,Ea,oa,pa,K,X,qa,ra,sa,ta,Y,Z,R,D,y,ua,aa,P,va,ba,S,wa,xa,ya,I,za,E,M,ca,L,da,A,p,Aa,T,ea,fa,U){function Ba(){return a=>{const {operation:b,mapEnd:d}=a;return null==b||null==d?a:{...a,signedDistance:b.signedDistanceToPoint(d)}}}function ha(a){const b=a.size/2,d=b+a.collisionPadding;return{size:b/d,outlineSize:(b+a.outlineSize)/d}}function V(a){return new ra({x:0,y:0,z:0,spatialReference:a})}function W(a){return"edge"===a.type&&"edgeManipulator"in a}const ia=Symbol();
m.ReshapeOperation=class extends ka{get _operations(){return this.object.operations}constructor(a){super(a);this._selectedIndex=0;this._manipulatorHandles=new na;this._manipulatorInfos=[];this._numDragging=this._numGrabbing=0;this._reshapeEventState=l.NONE;this._pendingEdgeOffsetInfo=null;this._updatingHandles=new qa.UpdatingHandles;this._recreatingManipulators=!1;this._settings=new wa.Settings({getTheme:()=>this.view.effectiveTheme});this.events=new ma;this._vertexLaserLineVisualElement=this.activeTooltipInfo=
null;this._tooltipCallbacks={onBeforeReshape:()=>this.tool.endDrag(),onReshapeStart:()=>this._updateEventState(l.RESHAPING),onReshape:()=>this.events.emit("reshape",{type:"reshape",object:this.object}),onReshapeStop:()=>this._updateEventState(l.NONE,{forceEnd:!0}),onMoveStart:()=>this._updateEventState(l.MOVING),onMove:()=>this.events.emit("move",{type:"move",object:this.object,dx:0,dy:0}),onMoveStop:()=>this._updateEventState(l.NONE,{forceEnd:!0})}}initialize(){const {view:a}=this;var b=this._settings.manipulators,
d=b.vertex;this.tooltipInfos=M.createTooltipInfos(this._sketchOptions,a);this._vertexManipulatorMaterial=D.createManipulatorMaterial(C.unitRGBAFromColor(d.color),d.renderOccluded);this._vertexManipulatorOutlineMaterial=D.createManipulatorOutlineMaterial(C.unitRGBAFromColor(d.outlineColor),d.renderOccluded);this._vertexManipulatorHoverOutlineMaterial=D.createManipulatorOutlineMaterial(C.unitRGBAFromColor(d.hoverOutlineColor),d.renderOccluded);d=b.edge;this._edgeManipulatorMaterial=D.createManipulatorMaterial(C.unitRGBAFromColor(d.color),
d.renderOccluded);this._edgeManipulatorOutlineMaterial=D.createManipulatorOutlineMaterial(C.unitRGBAFromColor(d.outlineColor),d.renderOccluded);d=b.edgeOffset;this._edgeOffsetManipulatorMaterial=D.createManipulatorMaterial(C.unitRGBAFromColor(d.color),d.renderOccluded,!1);this._edgeOffsetManipulatorHoverMaterial=D.createManipulatorMaterial(C.unitRGBAFromColor(d.hoverColor),d.renderOccluded,!1);b=b.selected;this._selectedManipulatorMaterial=D.createManipulatorMaterial(C.unitRGBAFromColor(b.color),
b.renderOccluded);this._selectedManipulatorOutlineMaterial=D.createManipulatorOutlineMaterial(C.unitRGBAFromColor(b.outlineColor),b.renderOccluded);this._selectedManipulatorHoverOutlineMaterial=D.createManipulatorOutlineMaterial(C.unitRGBAFromColor(b.hoverOutlineColor),b.renderOccluded);this.tooltip=U.makeTooltip(()=>({view:a,options:this._sketchOptions.tooltips}));this.addHandles([w.watch(()=>{const c=this._settings.manipulators;return{vertexSettings:c.vertex,edgeSettings:c.edge,edgeOffsetSettings:c.edgeOffset,
selectedSettings:c.selected}},({vertexSettings:c,edgeSettings:e,edgeOffsetSettings:f,selectedSettings:g})=>{c.applyColor(this._vertexManipulatorMaterial);c.applyOutline(this._vertexManipulatorOutlineMaterial);c.applyHoverOutline(this._vertexManipulatorHoverOutlineMaterial);e.applyColor(this._edgeManipulatorMaterial);e.applyOutline(this._edgeManipulatorOutlineMaterial);f.applyColor(this._edgeOffsetManipulatorMaterial);f.applyHover(this._edgeOffsetManipulatorHoverMaterial);g.applyColor(this._selectedManipulatorMaterial);
g.applyOutline(this._selectedManipulatorOutlineMaterial);g.applyHoverOutline(this._selectedManipulatorHoverOutlineMaterial)}),w.watch(()=>this.object.visible,c=>{for(const e of this._manipulatorInfos)e.manipulator.available=c,W(e)&&(e.edgeManipulator.available=c)}),w.watch(()=>0===this._numGrabbing+this._numDragging,c=>this._toggleAutoHideManipulators(c)),w.watch(()=>({labels:this._segmentLabels,enabled:this._sketchOptions.labels.enabled,edgeOffsetEnabled:this.enableEdgeOffset}),({labels:c,enabled:e,
edgeOffsetEnabled:f})=>{null!=c&&(c.visible=e,c.edgeDistance=f?"far":"default")},w.initial),M.connectTooltipToManipulatedObject(this.tooltip,this.object,()=>this._tooltipsContext),w.watch(()=>this.tooltip.mode,(c,e)=>{"input"===e&&"input"!==c&&this._resetTooltip()}),w.on(()=>this._operations,"vertex-update",c=>this._updateManipulatorPositions(c.vertices),{onListenerAdd:()=>this._recreateManipulators()}),w.on(()=>this._operations?.data,"change",c=>{"undo"!==c.operation&&"redo"!==c.operation||this._recreateManipulators()})])}destroy(){this._removeManipulators();
this._updatingHandles.destroy();this._segmentLabels=z.destroyMaybe(this._segmentLabels);this.tooltip=z.destroyMaybe(this.tooltip)}get updating(){return this._updatingHandles.updating}get manipulators(){return this.tool.manipulators}get view(){return this.tool.view}get object(){return this.tool.object}get enableZShape(){return this.tool.enableZShape}get enableDeleteVertices(){return this.tool.enableDeleteVertices}get enableZVertex(){return this.tool.enableZVertex}get autoHideManipulators(){return this.tool.autoHideManipulators}get enableMoveObject(){return this.tool.enableMoveObject}get enableMidpoints(){return this.tool.enableMidpoints}get enableEdgeOffset(){return this.tool.enableEdgeOffset}get _sketchOptions(){return this.tool.sketchOptions}get _accentColor(){return this.view.effectiveTheme.accentColor}enterInputModeIfAvailable(a){return"key-down"!==
a.type||a.key!==Aa.tooltipKeys.enterInputMode?!1:"reshape-edge-offset"===this.activeTooltipInfo?.type?this._enterInputModeDuringEdgeOffset(a):U.enterInputModeIfAvailable(a,this.tooltip)?(this.tool.endDrag(),!0):!1}removeSelectedVertices(){const a=this._manipulatorInfos.filter(b=>b.manipulator.selected&&"vertex"===b.type);this._removeVertices(a);return a.length}onManipulatorSelectionChanged(){this.events.emit("manipulators-changed")}_removeManipulators(){this._manipulatorHandles.removeAll();this._moveManipulation=
z.destroyMaybe(this._moveManipulation);this._objectMoveManipulation=z.destroyMaybe(this._objectMoveManipulation);this.manipulators.removeAll();this._manipulatorInfos=[];this._numDragging=this._numGrabbing=0}_createManipulators(a){if(null!=this._operations){var b=this.object.elevationInfo;for(const d of this._operations.data.components){const c=a?.byComponentIndex.get(d.index);for(const e of d.vertices){const f=c?.has(e.index);this._createVertexOrEdgeManipulator(e,b,f)}for(const e of d.edges)this._createVertexOrEdgeManipulator(e,
b)}this._createObjectMoveManipulation();this._createMoveManipulation(b);this._createVisualElements()}}get canRedo(){return null!=this._operations&&this._operations.canRedo}get canUndo(){return null!=this._operations&&this._operations.canUndo}redo(){return this._operations?.redo()}undo(){this.events.emit("undo");return this._operations?.undo()}_recreateManipulators(){if(!this._recreatingManipulators){this._recreatingManipulators=!0;this._removeManipulators();this._resetTooltip();this._operations&&
this._segmentLabels?.context?.editGeometryOperations===this._operations||(this._segmentLabels=z.destroyMaybe(this._segmentLabels));this._createManipulators();if(!this._segmentLabels&&this._operations){const a=this._sketchOptions.labels;this._segmentLabels=new ua.SegmentLabels3D({context:{view:this.view,editGeometryOperations:this._operations,elevationInfo:this.object.elevationInfo,labelOptions:a},visible:a.enabled})}this._recreatingManipulators=!1}}_perObjectManipulatorDragAction(a,b){if("end"===
b.action)return b;let d=0;const c=[],e=this._manipulatorInfos.some(f=>"vertex"===f.type&&f.manipulator.selected);a=a===N.SELECTED_OR_ALL&&e;for(const f of this._manipulatorInfos)"vertex"===f.type&&(f.manipulator.grabbing||a&&!f.manipulator.selected||c.push(f),d++);this._moveVertices(c,b);if(c.length===d){this._updateEventState(l.MOVING);if(this.destroyed)return b;this.events.emit("move",{type:"move",dx:b.screenDeltaX,dy:b.screenDeltaY,object:this.object})}else{this._updateEventState(l.RESHAPING);
if(this.destroyed)return b;this.events.emit("reshape",{type:"reshape",object:this.object})}return b}_toggleAutoHideManipulators(a){this.autoHideManipulators&&(a?this.removeHandles(ia):this.tool.manipulators.forEach(({manipulator:b})=>{(b=b.disableDisplay?.())&&this.addHandles(b,ia)}))}_isMultiVertexSelection(){return 1<this._manipulatorInfos.reduce((a,b)=>"vertex"===b.type&&b.manipulator.selected?a+1:a,0)}_perVertexManipulatorDragAction(a){this._updateEventState(l.RESHAPING);if(!this.destroyed){var {mapDeltaX:b,
mapDeltaY:d,mapDeltaZ:c}=a;if(b||d||c){var e=[];for(const f of this._manipulatorInfos)"vertex"===f.type&&(f.manipulator.selected&&!f.manipulator.grabbing||f===a.info)&&e.push(f);this._moveVertices(e,a,T.AccumulationBehavior.ACCUMULATE_STEPS);this.events.emit("reshape",{type:"reshape",object:this.object})}}}_updateEventState(a,b={}){if(a===this._reshapeEventState)return!1;switch(a){case l.NONE:if(!b.forceEnd&&(0!==this._numGrabbing||0!==this._numDragging))return!1;switch(this._reshapeEventState){case l.MOVING:this.events.emit("move",
{type:"move-stop",dx:0,dy:0,object:this.object});break;case l.RESHAPING:this.events.emit("reshape",{type:"reshape-stop",object:this.object})}break;case l.MOVING:switch(this._reshapeEventState){case l.NONE:this.events.emit("move",{type:"move-start",dx:0,dy:0,object:this.object});break;case l.RESHAPING:this.events.emit("reshape",{type:"reshape-stop",object:this.object}),this.destroyed||this.events.emit("move",{type:"move-start",dx:0,dy:0,object:this.object})}break;case l.RESHAPING:switch(this._reshapeEventState){case l.NONE:this.events.emit("reshape",
{type:"reshape-start",object:this.object});break;case l.MOVING:this.events.emit("move",{type:"move-stop",dx:0,dy:0,object:this.object}),this.destroyed||this.events.emit("reshape",{type:"reshape-start",object:this.object})}}if(this.destroyed)return!1;b=this._reshapeEventState!==a;this._reshapeEventState=a;return b}_createObjectMoveManipulation(){const {tool:a,view:b,object:d,_operations:c}=this;if(c){this._objectMoveManipulation=new za.MoveXYObjectManipulation({tool:a,view:b,object:d});if(this.enableMoveObject){let e=
null;this._manipulatorHandles.add(this._objectMoveManipulation.createDragPipeline((f,g,k)=>{g.next(h=>this._trackNumDragging(h)).next(h=>{"start"===h.action&&(e=c.createUndoGroup());return h}).next(h=>this._perObjectManipulatorDragAction(N.ALL,h)).next(h=>{this._updateTranslateObjectTooltip(I.ManipulationType.XY,h);return h}).next(h=>{"end"===h.action&&(this._resetTooltip(),e=z.removeMaybe(e))});k.next(()=>this._onDragCancel(!0,()=>e=z.removeMaybe(e)))}));this._objectMoveManipulation.forEachManipulator(f=>
this._manipulatorHandles.add(this._watchAndUpdateGrabState(f,!1)))}else this._objectMoveManipulation.forEachManipulator(e=>{e.grabbable=!1;e.cursor=null});this._objectMoveManipulation.forEachManipulator(e=>this._manipulatorHandles.add(e.events.on("immediate-click",f=>{this._manipulatorInfos.some(g=>g.manipulator.selected)?this._clearSelection():this.events.emit("immediate-click",{...f,object:this.object});f.stopPropagation()})))}}_createMoveManipulation(a){const {object:b,tool:d,view:c,_operations:e}=
this;if(e){this._moveManipulation=new I.MoveManipulation({tool:d,view:c,xyAvailable:!0,xyAxisAvailable:!0,zAvailable:this.enableZShape&&S.canMoveZOperations(b.operations,b.elevationInfo),snapToScene:!1,radius:I.MoveManipulation.radiusForSymbol(b.graphic?.symbol)});this._moveManipulation.forEachManipulator(g=>this.addHandles([g.events.on("immediate-click",k=>{this._moveManipulation.zManipulation.hasManipulator(g)||this._manipulatorInfos.some(h=>h.manipulator.selected)||this.events.emit("immediate-click",
{...k,object:this.object});k.stopPropagation()}),this._watchAndUpdateGrabState(g,!1)]));var f=g=>k=>{this.addHandles([k.events.on("focus-changed",({action:h})=>{"focus"===h?this._updateTranslateTooltip(g):this._resetTooltip()})])};this._moveManipulation.xyManipulation.forEachManipulator(f(I.ManipulationType.XY));this._moveManipulation.xyAxisManipulation.forEachManipulator(f(I.ManipulationType.XY_AXIS));this._moveManipulation.zManipulation.forEachManipulator(f(I.ManipulationType.Z));this._moveManipulation.elevationInfo=
{mode:"absolute-height",offset:0};this.addHandles([this._moveManipulation.createDragPipeline((g,k,h,n,q)=>{const {snappingStep:B,cancelSnapping:v}=fa.createSnapDragEventPipelineStep({predicate:u=>!!u.info,snappingManager:d.snappingManager,snappingContext:new ea.SnappingContext({editGeometryOperations:e,elevationInfo:a,pointer:q,excludeFeature:b.graphic,visualizer:new aa.SnappingVisualizer3D}),updatingHandles:this._updatingHandles,useZ:!1});n=n.next(u=>{this._onDragCancel();return u}).next(v);h=h.next(u=>
this._trackNumDragging(u)).next(u=>{const x=this._manipulatorInfos.filter(J=>"vertex"===J.type&&J.manipulator.selected);return u.manipulatorType===ba.ManipulatorType.TRANSLATE_XY&&1===x.length?{...u,info:x[0],snapOrigin:x[0].handle.pos}:u}).next(A.sceneSnappingAtLocation(this.view,a,b.graphic??void 0)).next(...B).next(A.addMapDelta()).next(u=>this._perObjectManipulatorDragAction(N.SELECTED_OR_ALL,u)).next(u=>{this._updateTranslateTooltip(g,u);return u});return{steps:h,cancel:n}},a,e.data.spatialReference,
b.graphic),w.watch(()=>b.visible,()=>this._updateMoveManipulationPosition(),w.initial),b.on("committed",()=>{this._recreatingManipulators||this._updateMoveManipulationPosition()}),w.watch(()=>b.isDraped,g=>{this._updateMoveManipulationPosition();g?this.addHandles(this.view.elevationProvider.on("elevation-change",()=>this._updateMoveManipulationPosition()),"align-move-manipulation"):this.removeHandles("align-move-manipulation")},w.initial)])}}_createVisualElements(){const {object:a,view:b}=this,d=
xa.createVisualElements({view:b,object:a,forEachManipulator:e=>{if(!this.destroyed&&!this._recreatingManipulators){this._objectMoveManipulation.forEachManipulator(e);this._moveManipulation.forEachManipulator(e);for(const f of this._manipulatorInfos)e(f.manipulator,ba.ManipulatorType.TRANSLATE_XY)}},onManipulatorsChanged:e=>this.events.on("manipulators-changed",e)});null!=d&&(this._outlineVisualElement=d.visualElement instanceof ca.OutlineVisualElement?d.visualElement:null);const c=this._outlineVisualElement;
if(null!=c){const e=()=>{a.isDraped||this._updateMoveManipulationPosition()};this._manipulatorHandles.add(w.on(()=>c.events,"attachment-origin-changed",e,{onListenerAdd:e}))}this._manipulatorHandles.add(d)}_createEdgeOffsetManipulator(a,b=this.object.elevationInfo){var d=this.view;const c=this._operations;if(2>=a.component.vertices.length||!c)return null;const e=c.data.spatialReference,f=this._settings.manipulators.edgeOffset;var g=f.size/2,k=g+f.collisionPadding,h=g/k;g=h/2;h=h*Math.sqrt(3)/2;const {height:n,
offset:q}=f,B=this._edgeOffsetManipulatorMaterial;this._edgeOffsetManipulatorGeometryInside||(this._edgeOffsetManipulatorGeometryInside=L.createExtrudedTriangle(B,h,g,g,n,q));this._edgeOffsetManipulatorGeometryOutside||(this._edgeOffsetManipulatorGeometryOutside=L.createExtrudedTriangle(B,-h,g,g,n,-q));g=[new y.RenderObject(this._edgeOffsetManipulatorGeometryInside.instantiate(),p.ManipulatorStateFlags.Unfocused),new y.RenderObject(this._edgeOffsetManipulatorGeometryInside.instantiate({material:this._edgeOffsetManipulatorHoverMaterial}),
p.ManipulatorStateFlags.Focused),new y.RenderObject(this._edgeOffsetManipulatorGeometryOutside.instantiate(),p.ManipulatorStateFlags.Unfocused),new y.RenderObject(this._edgeOffsetManipulatorGeometryOutside.instantiate({material:this._edgeOffsetManipulatorHoverMaterial}),p.ManipulatorStateFlags.Focused)];k=new R.Manipulator3D({view:d,renderObjects:g,elevationInfo:"on-the-ground"!==b.mode||Z.isVolumetricSymbol(this.object.graphic?.symbol)?{mode:"absolute-height",offset:0}:b,worldOriented:!1,focusMultiplier:1,
radius:k,available:this.object.visible,collisionType:{type:"disc",direction:X.fromValues(0,0,1)},collisionPriority:1,metadata:{deleting:!1},location:V(e)});d=new R.Manipulator3D({view:d,worldSized:!0,worldOriented:!1,available:this.object.visible,collisionPriority:-10,cursor:this.enableMoveObject?"move":"default",metadata:{deleting:!1},location:V(e)});const v={manipulator:k,handle:a,locationUpdateHandle:null,type:"edge",selectedIndex:0,edgeManipulator:d,visibilityHandle:null};this._autoHideEdgeOffsetManipulator(v,
f.minSquaredEdgeLength);const u=()=>this._updateEdgeOffsetManipulator(v);u();v.locationUpdateHandle=H.handlesGroup([a.leftVertex,a.rightVertex].map(x=>this._getManipulatorInfoFromHandle(x)?.manipulator.events.on("location-update",u)));a=x=>{this._manipulatorInfos.some(J=>J.manipulator.selected)?this._clearSelection():this.events.emit("immediate-click",{...x,object:this.object});x.stopPropagation()};this._manipulatorHandles.add([v.locationUpdateHandle,this._watchAndUpdateGrabState(k,!0),this._watchAndUpdateGrabState(d,
!0),A.createManipulatorDragEventPipeline(k,this._createEdgeOffsetPipeline(v,b,c)),A.createManipulatorDragEventPipeline(d,this._createEdgePipeline(v,b,c)),d.events.on("immediate-click",a),k.events.on("immediate-click",a),k.events.on("focus-changed",()=>this._resetTooltip()),k.events.on("grab-changed",({screenPoint:x,action:J})=>{v.grabMapPoint="start"===J?E.getMapPointAtEdgeOffsetManipulatorElevation(x,this.view,this.object,v):null})],k);this._manipulatorInfos.push(v);this.manipulators.addMany([k,
d]);this.events.emit("manipulators-changed");return v}_autoHideEdgeOffsetManipulator(a,b){const d=a.manipulator,c=a.edgeManipulator,e=()=>{a.visibilityHandle=z.removeMaybe(a.visibilityHandle);var f=this._getManipulatorInfoFromHandle(a.handle.leftVertex);const g=this._getManipulatorInfoFromHandle(a.handle.rightVertex);f=null!=f&&null!=g&&E.screenEdgeLengthSquared(f.manipulator.renderLocation,g.manipulator.renderLocation,this.view.state.camera)<b;if(!d.focused&&!c.focused||f)d.grabbable=!f,c.grabbable=
!f,a.visibilityHandle=H.handlesGroup([d.disableDisplay(),H.makeHandle(()=>{d.grabbable=!0;c.grabbable=this.enableMoveObject})])};this._manipulatorHandles.add([d.events.on("focus-changed",e),c.events.on("focus-changed",e),H.makeHandle(()=>{z.removeMaybe(a.visibilityHandle);c.metadata.deleting=!0;this.manipulators.remove(c)})],d);e()}_updateEdgeOffsetManipulator(a){if(this._operations){this._updateManipulatorPosition(a);var {coordinateHelper:b}=this._operations.data;b=E.createEdgeOffsetIntersectionPlane(this.view,
a.manipulator.elevationAlignedLocation,E.createEdgeOffsetOperation(b,a.handle,a.manipulator.elevationInfo));var d=this._getManipulatorInfoFromHandle(a.handle.leftVertex),c=this._getManipulatorInfoFromHandle(a.handle.rightVertex);null!=d&&null!=c&&(d=d.manipulator.renderLocation,c=c.manipulator.renderLocation,b=null!=b?E.edgeOffsetRotationMatrix(b,d,c):pa.IDENTITY,a.manipulator.modelTransform=b,a.edgeManipulator.elevationAlignedLocation=a.manipulator.elevationAlignedLocation,a.edgeManipulator.modelTransform=
b,b=K.length(K.subtract(Q,d,c))/2,a.edgeManipulator.collisionType={type:"line",paths:[[[-b,0,0],[b,0,0]]]})}}_createEdgePipeline(a,b,d){return(c,e,f,g)=>{if("touch"===g)this._createEdgeOffsetPipeline(a,b,d)(c,e,f);else if(this.enableMoveObject){g=this.object.graphic;const k=d.data.spatialReference,{elevationAlignedLocation:h}=c;e.next(n=>this._trackNumDragging(n)).next(A.dragAtLocation(this.view,h)).next(P.screenToMapXYAtLocation(this.view,h,b,k,g)).next(A.addScreenDelta()).next(A.addMapDelta()).next(n=>
this._perObjectManipulatorDragAction(N.ALL,n)).next(n=>{this._updateTranslateObjectTooltip(I.ManipulationType.XY,n);return n}).next(n=>{"end"===n.action&&this._resetTooltip()});f.next(()=>this._onDragCancel(!c.metadata.deleting))}}}_createEdgeOffsetPipeline(a,b,d){return(c,e,f)=>{const g=this._pendingEdgeOffsetInfo;if(g?.manipulatorInfo===a&&"drag"!==g.mode)f.execute({action:"cancel"});else{this._clearSelection();var {initializeStep:k,cleanup:h}=this._initializeEdgeOffset(a,b,d,f),n=this._applyEdgeOffsetStep(a);
e.next(q=>this._trackNumDragging(q)).next(A.dragAtLocation(this.view,c.elevationAlignedLocation)).next(k).next(P.screenToRenderPlaneFromEvent(this.view)).next(P.convertToMapCoordinates(this.view,d.data.spatialReference)).next(A.addMapDelta()).next(Ba()).next(q=>this._pendingEdgeOffsetInfo?q:n(q)).next(q=>{"end"!==q.action||this._pendingEdgeOffsetInfo||h()});f.next(()=>{this._exitEdgeOffsetInputMode();c.metadata.deleting||(h(),this._onDragCancel())})}}}_initializeEdgeOffset(a,b,d,c){const {view:e,
object:f}=this,g=E.createEdgeOffsetOperation(d.data.coordinateHelper,a.handle,b),k=d.createUndoGroup(),h=E.createEdgeOffsetIntersectionPlane(e,a.manipulator.elevationAlignedLocation,g);this._splitEdgesBeforeEdgeOffset(a,g);this._selectEdgeOffsetArrow(a,g);let n;const q=()=>{this._cleanEdgeOffsetCollapsedEdges(a,d);n=z.removeMaybe(n)},B=this.events.on("undo",q);n=H.handlesGroup([this._initializeEdgeOffsetVisualElement(a,f,b,d),k,B,this._connectEdgeOffsetTooltip(a,g,d,()=>{c.execute({action:"cancel"})})]);
return{initializeStep:v=>null==g||null==h?(q(),null):{...v,operation:g,plane:h},cleanup:q}}_initializeEdgeOffsetVisualElement(a,b,d,c){const e=()=>new sa({paths:[[a.handle.leftVertex.pos,a.handle.rightVertex.pos]],spatialReference:c.data.spatialReference}),f=new ca.OutlineVisualElement({view:this.view,isDraped:b.isDraped,geometry:e(),elevationInfo:d,width:this._settings.visualElements.lineObjects.outline.width,attached:!1,isDecoration:!0});d=H.handlesGroup([w.watch(()=>({color:this._accentColor,draped:b.isDraped}),
({color:g,draped:k})=>{f.color=C.unitRGBAFromColor(g);f.isDraped=k},w.syncAndInitial),b.on("committed",()=>{f.geometry=e()}),H.destroyHandle(f)]);f.attached=!0;return d}_applyEdgeOffsetStep(a){return b=>{if(this.destroyed||null==b.operation||!this._operations)return b;this._updateEventState(l.RESHAPING);if(null==b.signedDistance)this._resetTooltip();else{if(b.mapDeltaX||b.mapDeltaY||b.mapDeltaZ)this._offsetEdge(a,b.operation,b.signedDistance),this.events.emit("reshape",{type:"reshape",object:this.object});
this._updateEdgeOffsetTooltip(b)}return b}}_cleanEdgeOffsetCollapsedEdges(a,b){var d=a.handle.leftVertex.leftEdge?.leftVertex,c=a.handle.leftVertex;const e=a.handle.rightVertex.rightEdge?.rightVertex;a=a.handle.rightVertex;const f=b.data.coordinateHelper,g=this.view.pixelSizeAt(f.vectorToDehydratedPoint(c.pos),f.spatialReference);b=[];d&&1E-6>f.distance(d.pos,c.pos)&&(d=this._getManipulatorInfoFromHandle(c),null!=d&&b.push(d));if(f.distance(c.pos,a.pos)<g||e&&1E-6>f.distance(e.pos,a.pos))c=this._getManipulatorInfoFromHandle(a),
null!=c&&b.push(c);b.length&&this._removeVertices(b)}_enterInputModeDuringEdgeOffset(a){const b=this._findActiveEdgeOffsetManipulatorInfo();if(!b)return!1;if(U.enterInputModeIfAvailable(a,this.tooltip)){if(b.manipulator.dragging)return this._pendingEdgeOffsetInfo={manipulatorInfo:b,mode:"drag"},!0;this._clearSelection();this._pendingEdgeOffsetInfo={manipulatorInfo:b,mode:"hover"};this._connectEdgeOffsetTooltipOnHover(b);return!0}return!1}_exitEdgeOffsetInputMode(){this.tooltip&&(this._pendingEdgeOffsetInfo=
null,this._resetTooltip(),this.tooltip.exitInputMode())}_findActiveEdgeOffsetManipulatorInfo(){return this._manipulatorInfos.filter(W).find(({manipulator:a})=>a.hovering||a.grabbing||a.dragging)}_connectEdgeOffsetTooltipOnHover(a){const {_operations:b,object:d}=this;if(b){var {elevationInfo:c}=d,e=E.createEdgeOffsetOperation(b.data.coordinateHelper,a.handle,c);this._selectEdgeOffsetArrow(a,e);this.addHandles([this._initializeEdgeOffsetVisualElement(a,d,c,b),this._connectEdgeOffsetTooltip(a,e,b,()=>
{this.removeHandles(e);this._exitEdgeOffsetInputMode()})],e)}}_splitEdgesBeforeEdgeOffset(a,b){if(b.requiresSplitEdgeLeft){const d=this._getManipulatorInfoFromHandle(a.handle.leftVertex.leftEdge);null!=d&&this._splitEdgeManipulator(d,1)}b.requiresSplitEdgeRight&&(a=this._getManipulatorInfoFromHandle(a.handle.rightVertex.rightEdge),null!=a&&this._splitEdgeManipulator(a,0))}_selectEdgeOffsetArrow(a,b){(a=a.grabMapPoint??E.getMapPointAtEdgeOffsetManipulatorElevation(this.view.inputManager?.latestPointerLocation,
this.view,this.object,a))&&b.selectArrowFromStartPoint(a)}_connectEdgeOffsetTooltip(a,b,d,c){const e=()=>this.tooltipInfos.edgeOffset.distance.actual,f=g=>{c();queueMicrotask(()=>{this.view.focus();const k=d.createUndoGroup();this._tooltipCallbacks.onReshapeStart?.();this._splitEdgesBeforeEdgeOffset(a,b);this._offsetEdge(a,b,E.getDistanceInGeometrySR(g,a.manipulator.location,b,d));this._tooltipCallbacks.onReshape?.();this._tooltipCallbacks.onReshapeStop?.();this._cleanEdgeOffsetCollapsedEdges(a,d);
k.remove()})};return H.handlesGroup([w.when(()=>this.tooltip&&!this.tooltip.focused,()=>{const g=e();null!=g?f(g):c()},w.sync),this.tooltip.on("discard",c),this.tooltip.on("commit",g=>{"commit-and-exit"===g.type&&(g=e(),null!=g?f(g):c())})])}_createVertexOrEdgeManipulator(a,b=this.object.elevationInfo,d=!1){const c=this.view,e=this._operations;var f=this._settings;if(!e)return null;const g=e.data.type,k=e.data.spatialReference;if("edge"===a.type){if(this.enableEdgeOffset)return this._createEdgeOffsetManipulator(a,
b);if(!this.enableMidpoints)return null}if(null==this._vertexManipulatorGeometry||null==this._vertexManipulatorOutlineGeometry){const {size:q,outlineSize:B}=ha(f.manipulators.vertex);this._vertexManipulatorGeometry=L.createSphereGeometry(this._vertexManipulatorMaterial,q,16,16);this._vertexManipulatorOutlineGeometry=L.createSphereGeometry(this._vertexManipulatorOutlineMaterial,B,16,16)}if(null==this._edgeManipulatorGeometry||null==this._edgeManipulatorOutlineGeometry){const {size:q,outlineSize:B}=
ha(f.manipulators.edge);this._edgeManipulatorGeometry=L.createSphereGeometry(this._edgeManipulatorMaterial,q,16,16);this._edgeManipulatorOutlineGeometry=L.createSphereGeometry(this._edgeManipulatorOutlineMaterial,B,16,16)}f="point"===g||"mesh"===g?[]:[new y.RenderObject(this._vertexManipulatorGeometry.instantiate(),F.Vertex|p.ManipulatorStateFlags.Unselected),new y.RenderObject(this._vertexManipulatorOutlineGeometry.instantiate(),F.Vertex|p.ManipulatorStateFlags.Unfocused|p.ManipulatorStateFlags.Unselected),
new y.RenderObject(this._vertexManipulatorOutlineGeometry.instantiate({material:this._vertexManipulatorHoverOutlineMaterial}),F.Vertex|p.ManipulatorStateFlags.Focused|p.ManipulatorStateFlags.Unselected),new y.RenderObject(this._vertexManipulatorGeometry.instantiate({material:this._selectedManipulatorMaterial}),p.ManipulatorStateFlags.Selected),new y.RenderObject(this._vertexManipulatorOutlineGeometry.instantiate({material:this._selectedManipulatorOutlineMaterial}),p.ManipulatorStateFlags.Selected|
p.ManipulatorStateFlags.Unfocused),new y.RenderObject(this._vertexManipulatorOutlineGeometry.instantiate({material:this._selectedManipulatorHoverOutlineMaterial}),p.ManipulatorStateFlags.Selected|p.ManipulatorStateFlags.Focused)];this.enableMidpoints&&f.push(new y.RenderObject(this._edgeManipulatorGeometry.instantiate({material:this._vertexManipulatorMaterial}),F.Edge|p.ManipulatorStateFlags.Focused|p.ManipulatorStateFlags.Unselected),new y.RenderObject(this._edgeManipulatorOutlineGeometry.instantiate({material:this._vertexManipulatorHoverOutlineMaterial}),
F.Edge|p.ManipulatorStateFlags.Focused|p.ManipulatorStateFlags.Unselected),new y.RenderObject(this._edgeManipulatorGeometry.instantiate(),F.Edge|p.ManipulatorStateFlags.Unfocused|p.ManipulatorStateFlags.Unselected),new y.RenderObject(this._edgeManipulatorOutlineGeometry.instantiate(),F.Edge|p.ManipulatorStateFlags.Unfocused|p.ManipulatorStateFlags.Unselected));f=new R.Manipulator3D({view:c,renderObjects:f,elevationInfo:b,focusMultiplier:1,touchMultiplier:1,available:this.object.visible,metadata:{deleting:!1},
location:V(k)});f.selected=d;this._setTypeSpecificManipulatorSettings(f,a,b);const h="edge"===a.type?{manipulator:f,handle:a,locationUpdateHandle:null,type:"edge",selectedIndex:0}:{manipulator:f,handle:a,type:"vertex",selectedIndex:0};this._manipulatorInfos.push(h);this.manipulators.add(f);this._updateManipulatorPosition(h);if("edge"===h.type){a=[];for(var n of[h.handle.leftVertex,h.handle.rightVertex])d=this._getManipulatorInfoFromHandle(n),null!=d&&a.push(d.manipulator.events.on("location-update",
()=>this._updateManipulatorPosition(h)));h.locationUpdateHandle=H.handlesGroup(a);this._manipulatorHandles.add(h.locationUpdateHandle,f)}this._manipulatorHandles.add(this._watchAndUpdateGrabState(f,!0),f);n=A.createManipulatorDragEventPipeline(f,(q,B,v,u)=>{let x=null;const {snappingStep:J,cancelSnapping:Ca}=fa.createSnapDragEventPipelineStep({predicate:()=>!this._isMultiVertexSelection(),snappingManager:this.tool.snappingManager,snappingContext:new ea.SnappingContext({editGeometryOperations:e,elevationInfo:b,
pointer:u,excludeFeature:this.object.graphic,visualizer:new aa.SnappingVisualizer3D}),updatingHandles:this._updatingHandles,useZ:!1});v=v.next(G=>{this._onDragCancel(!q.metadata.deleting,()=>x=z.removeMaybe(x));return G}).next(Ca);({elevationAlignedLocation:v}=q);u=this.object.graphic??void 0;B.next(G=>this._trackNumDragging(G)).next(G=>{"start"===G.action&&e&&(x=e.createUndoGroup());if("edge"===h.type){const ja=this._splitEdgeManipulator(h);return{...G,info:ja,snapOrigin:ja.handle.pos}}return{...G,
info:h,snapOrigin:h.handle.pos}}).next(A.dragAtLocation(c,v)).next(P.screenToMapXYAtLocation(c,v,b,k,u)).next(A.sceneSnappingAtLocation(c,b,u)).next(...J).next(A.addMapDelta()).next(G=>{this._perVertexManipulatorDragAction(G);"end"===G.action&&(x=z.removeMaybe(x));this._resetTooltip()})});this._manipulatorHandles.add([n,f.events.on("immediate-click",q=>this._manipulatorClickCallback(q,h)),f.events.on("select-changed",()=>{h.selectedIndex=++this._selectedIndex;this._updateMoveManipulationPosition();
this._resetTooltip()}),f.events.on("focus-changed",()=>{this._resetTooltip()})],f);this.events.emit("manipulators-changed");return h}_trackNumDragging(a){switch(a.action){case "start":this._numDragging++;break;case "end":this._numDragging--}return a}_onDragCancel(a=!0,b){this._numDragging--;a&&this.undo();this.tool.snappingManager?.doneSnapping();this._resetTooltip();switch(this._reshapeEventState){case l.MOVING:this.events.emit("move",{type:"move",dx:0,dy:0,object:this.object});break;case l.RESHAPING:this.events.emit("reshape",
{type:"reshape",object:this.object})}b?.();this.destroyed||this._updateEventState(l.NONE)}_setTypeSpecificManipulatorSettings(a,b,d){const c=this._settings;switch(b.type){case "vertex":a.state=F.Vertex;a.selectable=!0;a.cursor="move";a.collisionPriority=2;const {size:e,collisionPadding:f}=c.manipulators.vertex;a.radius=e/2+f;a.elevationInfo=d;b=this._operations?.data.type;a.interactive=null!=b&&"point"!==b&&"mesh"!==b;break;case "edge":a.state=F.Edge;a.selectable=!1;a.cursor="copy";a.collisionPriority=
-1;const {size:g,collisionPadding:k}=c.manipulators.edge;a.radius=g/2+k;a.elevationInfo="on-the-ground"!==d.mode||Z.isVolumetricSymbol(this.object.graphic?.symbol)?{mode:"absolute-height",offset:0}:d}}_watchAndUpdateGrabState(a,b){return a.events.on("grab-changed",d=>{this._onGrabStateChanged(a,b,d.action,d.pointerType)})}_onGrabStateChanged(a,b,d,c="mouse"){if(!this._recreatingManipulators){if("start"===d)b&&this._updateSelection(a),this._numGrabbing++;else if(this._numGrabbing--,this._updateEventState(l.NONE),
this.destroyed)return;this._moveManipulation.interactive=!this._numGrabbing;if("touch"!==c||this.enableEdgeOffset)this._manipulatorInfos.forEach(e=>{const {manipulator:f}=e,g=this._operations?.data.type;f.interactive=f.grabbing||!this._numGrabbing&&null!=g&&"point"!==g&&"mesh"!==g;W(e)&&(e.edgeManipulator.interactive=e.edgeManipulator.grabbing||!this._numGrabbing)}),this._objectMoveManipulation.forEachManipulator(e=>{e.interactive=e.grabbing||!this._numGrabbing})}}_clearSelection(){for(const a of this._manipulatorInfos)a.manipulator.grabbing||
(a.manipulator.selected=!1);this._pendingEdgeOffsetInfo=null}_updateSelection(a){a.grabbing&&!a.selected&&a.selectable&&(this._clearSelection(),a.selected=!0,this.events.emit("manipulators-changed"))}_removeManipulator(a){null!=a&&(a.manipulator.metadata.deleting=!0,this.manipulators.remove(a.manipulator),this._manipulatorHandles.remove(a.manipulator),la.removeUnordered(this._manipulatorInfos,a),this.events.emit("manipulators-changed"),this._resetTooltip())}_getManipulatorInfoFromHandle(a){if(a)for(const b of this._manipulatorInfos)if(a===
b.handle)return b;return null}_updateManipulatorPositions(a){for(const b of a)this._updateManipulatorPosition(this._getManipulatorInfoFromHandle(b))}_updateManipulatorPosition(a){const b=this._operations;if(null!=a&&b)if("vertex"===a.type)a.manipulator.location=b.data.coordinateHelper.vectorToDehydratedPoint(a.handle.pos,O),a.manipulator.grabbing&&null!=this._vertexLaserLineVisualElement&&(this._vertexLaserLineVisualElement.visualElement.intersectsWorldUpAtLocation=a.manipulator.renderLocation);else if("edge"===
a.type){var d=this._getManipulatorInfoFromHandle(a.handle.leftVertex),c=this._getManipulatorInfoFromHandle(a.handle.rightVertex);null!=d&&null!=c&&(d=d.manipulator,c=c.manipulator,"on-the-ground"===a.manipulator.elevationInfo?.mode?(d=d.location,c=c.location,a.manipulator.location=Y.makeDehydratedPoint(d.x+.5*(c.x-d.x),d.y+.5*(c.y-d.y),d.hasZ&&c.hasZ?0:void 0,b.data.spatialReference)):(K.lerp(Q,d.renderLocation,c.renderLocation,.5),a.manipulator.renderLocation=Q))}}_splitEdgeManipulator(a,b=.5){var d=
this._operations;b=d.splitEdge(a.handle,b).createdVertex;a.locationUpdateHandle=z.removeMaybe(a.locationUpdateHandle);var c=this.object.elevationInfo;let e;this.enableEdgeOffset?(this._removeManipulator(a),e=this._createVertexOrEdgeManipulator(b)):(e=a,e.handle=b,e.type="vertex",this._setTypeSpecificManipulatorSettings(a.manipulator,a.handle,c));b.leftEdge&&this._createVertexOrEdgeManipulator(b.leftEdge);b.rightEdge&&this._createVertexOrEdgeManipulator(b.rightEdge);this._updateManipulatorPosition(e);
this.enableEdgeOffset||this._resetTooltip();this._updateSelection(a.manipulator);a=this._updateEventState(l.RESHAPING);c=d.data.coordinateHelper.vectorToArray(e.handle.pos);d=d.data.components.indexOf(b.component);this.events.emit("vertex-add",{type:"vertex-add",object:this.object,vertices:[{coordinates:c,componentIndex:d,vertexIndex:b.index}],added:c});a&&this._updateEventState(l.NONE);return e}_updateMoveManipulationPosition(){const a=K.set(Q,0,0,0);let b=0,d=!1;var c=null;let e=null;for(var f of this._manipulatorInfos)if("vertex"===
f.type)if(f.manipulator.selected)if(b++,K.add(a,a,f.manipulator.renderLocation),null==c||f.selectedIndex>c.selectedIndex)e=c,c=f;else{if(null==e||f.selectedIndex>e.selectedIndex)e=f}else d=!0;f=this.object;var g=this._operations?.data.geometry;if(0===b)c=f.visible&&this.enableMoveObject,this._moveManipulation.xyManipulation.available=c,this._moveManipulation.xyAxisManipulation.available=c,this._moveManipulation.xyAxisManipulation.orthogonalAvailable=c,this._moveManipulation.zManipulation.available=
c&&this.enableZShape&&S.canMoveZOperations(this._operations,f.elevationInfo),this._moveManipulation.angle=va.orientation(g),this._moveManipulation.radius=I.MoveManipulation.radiusForSymbol(f.graphic?.symbol);else{f=f.visible;this._moveManipulation.xyManipulation.available=f;this._moveManipulation.xyAxisManipulation.available=f;this._moveManipulation.zManipulation.available=f&&this.enableZVertex&&S.canMoveZOperations(this._operations,this.object.elevationInfo);this._moveManipulation.xyAxisManipulation.orthogonalAvailable=
f&&1!==b;f=0;if(null!=c){g=c.handle.pos;const k=null!=e?e.handle.pos:c.handle.leftEdge?.leftVertex?c.handle.leftEdge.leftVertex.pos:null;c=null==e&&c.handle.rightEdge?.rightVertex?c.handle.rightEdge.rightVertex.pos:null;k&&c?this._moveManipulation.xyAxisManipulation.available=!1:k?f=Math.atan2(g[1]-k[1],g[0]-k[0])+Math.PI/2:c&&(f=Math.atan2(c[1]-g[1],c[0]-g[0])+Math.PI/2)}this._moveManipulation.angle=f;this._moveManipulation.radius=ya.discRadiusSmall}0!==b&&d?(K.scale(a,a,1/b),O.spatialReference=
this._operations.data.spatialReference,O.hasZ=!0,this.view.renderCoordsHelper.fromRenderCoords(a,O),this._moveManipulation.elevationAlignedLocation=O):null==this._outlineVisualElement||this.object.isDraped||null==this._outlineVisualElement.attachmentOrigin?D.placeAtObject(this._moveManipulation,this.object):this._moveManipulation.elevationAlignedLocation=this._outlineVisualElement.attachmentOrigin}_removeVertices(a){var b=[];const d=this._operations;if(d){for(var c of a)if(a=c.handle.component,"vertex"===
c.type&&d.canRemoveVertex(a)){b.push(c.handle);this._removeManipulator(c);this._removeManipulator(this._getManipulatorInfoFromHandle(c.handle.leftEdge));this._removeManipulator(this._getManipulatorInfoFromHandle(c.handle.rightEdge));const e=d.removeVertices([c.handle]).removedVertices?.[0].createdEdge;e?this._createVertexOrEdgeManipulator(e):this.enableEdgeOffset&&2>=a.vertices.length&&this._removeManipulator(this._getManipulatorInfoFromHandle(a.edges[0]))}if(0<b.length&&(b=b.map(e=>{const f=d.data.components.indexOf(e.component);
return{coordinates:d.data.coordinateHelper.vectorToArray(e.pos),componentIndex:f,vertexIndex:e.index}}),c=this._updateEventState(l.RESHAPING),!this.destroyed&&(this.events.emit("vertex-remove",{type:"vertex-remove",object:this.object,removed:b.map(e=>e.coordinates),vertices:b}),!this.destroyed))){if(c&&(this._updateEventState(l.NONE),this.destroyed))return;this._updateMoveManipulationPosition()}}}_moveVertices(a,b,d="start"===b.action?T.AccumulationBehavior.NEW_STEP:T.AccumulationBehavior.ACCUMULATE_STEPS){const c=
this._operations;if(c){0<a.length&&c.moveVertices(a.map(e=>e.handle),b.mapDeltaX,b.mapDeltaY,b.mapDeltaZ,d);for(const e of a)this._updateManipulatorPosition(e)}}_offsetEdge(a,b,d){this._operations&&(b=b.clone(),b.distance=d,this._operations.updateVertices([a.handle.leftVertex,a.handle.rightVertex],b),this._updateManipulatorPosition(this._getManipulatorInfoFromHandle(a.handle.leftVertex)),this._updateManipulatorPosition(this._getManipulatorInfoFromHandle(a.handle.rightVertex)))}_manipulatorClickCallback(a,
b){a.shiftKey||this._clearSelection();"vertex"===b.type&&(b.manipulator.selected=!b.manipulator.selected,this.enableDeleteVertices&&a.button===da.MouseButton.Right&&this._removeVertices([b]));"edge"===b.type&&a.button===da.MouseButton.Left&&this._splitEdgeManipulator(b);a.stopPropagation()}_updateTranslateTooltip(a,b){null!=this._defaultTooltipInfo?this._resetTooltip():this._updateTranslateObjectTooltip(a,b)}_updateTranslateObjectTooltip(a,b){this._pendingEdgeOffsetInfo||(this.activeTooltipInfo=M.getUpdatedTranslateObjectTooltipInfo(a,
b,this._tooltipsContext))}_updateEdgeOffsetTooltip(a){this._pendingEdgeOffsetInfo||(this.activeTooltipInfo=M.getUpdatedEdgeOffsetTooltipInfo(this.object,a,this._tooltipsContext))}_resetTooltip(){const a=this.activeTooltipInfo;if(!this._pendingEdgeOffsetInfo||"reshape-edge-offset"!==a?.type){var b=null;b=this._pendingEdgeOffsetInfo||null!=this._findActiveEdgeOffsetManipulatorInfo()?M.getUpdatedEdgeOffsetTooltipInfo(this.object,null,this._tooltipsContext):this._defaultTooltipInfo;b===a||null!=a&&null!=
b&&"input"===this.tooltip.mode||(this.activeTooltipInfo=b)}}get _defaultTooltipInfo(){switch(this._operations?.data.type){case "polyline":case "polygon":return this._selectedVertexManipulatorInfo?this.tooltipInfos.selectedVertex:null;case "point":case "mesh":return this.tooltipInfos.movePoint;default:return null}}get _selectedVertexManipulatorInfo(){const a=this._manipulatorInfos.filter(b=>"vertex"===b.type&&b.manipulator.selected);return 1===a.length?a[0]:null}get _tooltipsContext(){return{sketchOptions:this._sketchOptions,
tooltipInfos:this.tooltipInfos,activeTooltipInfo:this.activeTooltipInfo,selectedVertexManipulatorInfo:this._selectedVertexManipulatorInfo,callbacks:this._tooltipCallbacks}}get test(){}};r.__decorate([t.property()],m.ReshapeOperation.prototype,"_numGrabbing",void 0);r.__decorate([t.property()],m.ReshapeOperation.prototype,"_numDragging",void 0);r.__decorate([t.property()],m.ReshapeOperation.prototype,"_pendingEdgeOffsetInfo",void 0);r.__decorate([t.property()],m.ReshapeOperation.prototype,"_operations",
null);r.__decorate([t.property()],m.ReshapeOperation.prototype,"_segmentLabels",void 0);r.__decorate([t.property({constructOnly:!0})],m.ReshapeOperation.prototype,"tool",void 0);r.__decorate([t.property()],m.ReshapeOperation.prototype,"tooltip",void 0);r.__decorate([t.property()],m.ReshapeOperation.prototype,"activeTooltipInfo",void 0);r.__decorate([t.property({readOnly:!0})],m.ReshapeOperation.prototype,"updating",null);r.__decorate([t.property()],m.ReshapeOperation.prototype,"manipulators",null);
r.__decorate([t.property()],m.ReshapeOperation.prototype,"view",null);r.__decorate([t.property()],m.ReshapeOperation.prototype,"object",null);r.__decorate([t.property()],m.ReshapeOperation.prototype,"enableZShape",null);r.__decorate([t.property()],m.ReshapeOperation.prototype,"enableDeleteVertices",null);r.__decorate([t.property()],m.ReshapeOperation.prototype,"enableZVertex",null);r.__decorate([t.property()],m.ReshapeOperation.prototype,"autoHideManipulators",null);r.__decorate([t.property()],m.ReshapeOperation.prototype,
"enableMoveObject",null);r.__decorate([t.property()],m.ReshapeOperation.prototype,"enableMidpoints",null);r.__decorate([t.property()],m.ReshapeOperation.prototype,"enableEdgeOffset",null);r.__decorate([t.property()],m.ReshapeOperation.prototype,"_sketchOptions",null);r.__decorate([t.property()],m.ReshapeOperation.prototype,"_accentColor",null);r.__decorate([t.property()],m.ReshapeOperation.prototype,"_tooltipsContext",null);m.ReshapeOperation=r.__decorate([oa.subclass("esri.views.3d.interactive.editingTools.reshape.ReshapeOperation")],
m.ReshapeOperation);const O=Y.makeDehydratedPoint(0,0,void 0,ta.WGS84),Q=X.create();var F;(function(a){a.Vertex=p.ManipulatorStateCustomFlags.Custom1;a.Edge=p.ManipulatorStateCustomFlags.Custom2})(F||={});var l;(function(a){a[a.NONE=0]="NONE";a[a.MOVING=1]="MOVING";a[a.RESHAPING=2]="RESHAPING"})(l||={});var N;(function(a){a[a.ALL=0]="ALL";a[a.SELECTED_OR_ALL=1]="SELECTED_OR_ALL"})(N||={});Object.defineProperty(m,Symbol.toStringTag,{value:"Module"})});