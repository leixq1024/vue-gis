// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.31/esri/copyright.txt for details.
//>>built
define("exports ../../../../../../core/reactiveUtils ../../../../../../core/libs/gl-matrix-2/math/vec2 ../../../../../../chunks/vec32 ../../../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../../../chunks/boundedPlane ../../../../../../geometry/support/vectorStacks ../../geometryUtils ../../manipulatedObjectUtils ../../../../layers/graphics/elevationAlignmentUtils ../../../../layers/graphics/ElevationContext ../../../../../interactive/editGeometry/support/editPlaneUtils ../../../../../support/extentUtils".split(" "),
function(t,x,y,b,q,l,h,z,A,B,C,u,D){function E(a,d,f,k=0,c){c||=l.create();d.toRenderCoords(a.origin,f,c.origin);var g=h.sv3d.get();b.add(g,a.origin,a.basis1);b.add(g,g,a.basis2);d.toRenderCoords(g,f,g);var e=h.sv3d.get();b.add(e,a.origin,a.basis1);b.subtract(e,e,a.basis2);d.toRenderCoords(e,f,e);const m=h.sv3d.get();b.subtract(m,a.origin,a.basis1);b.subtract(m,m,a.basis2);d.toRenderCoords(m,f,m);const n=h.sv3d.get();b.subtract(n,a.origin,a.basis1);b.add(n,n,a.basis2);d.toRenderCoords(n,f,n);a=b.lerp(h.sv3d.get(),
g,e,.5);b.subtract(a,a,c.origin);d=b.lerp(h.sv3d.get(),m,n,.5);b.subtract(d,c.origin,d);b.lerp(c.basis1,a,d,.5);g=b.lerp(h.sv3d.get(),n,g,.5);b.subtract(g,g,c.origin);e=b.lerp(h.sv3d.get(),e,m,.5);b.subtract(e,c.origin,e);b.lerp(c.basis2,g,e,.5);e=b.cross(h.sv3d.get(),c.basis1,c.basis2);e=b.cross(e,e,c.basis1);b.normalize(e,e);b.scale(c.basis2,e,b.dot(c.basis2,e));b.scale(c.basis1,c.basis1,1+k/b.length(c.basis1));b.scale(c.basis2,c.basis2,1+k/b.length(c.basis2));l.updateUnboundedPlane(c);return c}
class F{constructor(a,d){this._tool=a;this.mapBounds=l.create();this.mapBoundsStart=l.create();this.displayBounds=l.create();a.addHandles(x.on(()=>a.object,"modified-externally",()=>this._resetMapBounds(),{onListenerAdd:()=>this._resetMapBounds()}));this._onDisplayBoundsChanged=d}get displayBoundsMargin(){const {view:a,object:d}=this._tool;var f=A.manipulatedObjectGeometry(d);return(f=a.pointsOfInterest?.centerOnSurfaceFrequent.location??f?.extent?.center)?10*a.pixelSizeAt(f):0}backupMapBounds(){l.copy(this.mapBounds,
this.mapBoundsStart)}updateDisplayBounds(){this._calculateDisplayBounds();this._onDisplayBoundsChanged?.()}updateMapBoundsFromOperation(a){u.apply(a,this.mapBounds);this.updateDisplayBounds()}updateMapBoundsFromOperationInverse(a){u.applyInverse(a,this.mapBounds);this.updateDisplayBounds()}_resetMapBounds(){this._calculateMapBounds();this.updateDisplayBounds()}_calculateMapBounds(){const {view:a,attachmentOrigin:d,object:f}=this._tool,k=f.operations?.data;if(k){var c=k.geometry;this.spatialReference=
c.spatialReference;var g=z.mainAxis(c);y.scale(g,g,-1);c=d?a.pixelSizeAt(d,c.spatialReference):0;u.calculateOrientedBounds(g,k,80*c,this.mapBounds)}}_calculateDisplayBounds(){const {view:a,attachmentOrigin:d}=this._tool,f=d?.z??B.evaluateElevationAlignmentAtPoint(this.mapBounds.origin,a.elevationProvider,C.ElevationContext.fromElevationInfo(this._tool.object.elevationInfo),a.renderCoordsHelper),k=l.copy(this.mapBounds);k.origin[2]=f??0;E(k,a.renderCoordsHelper,this.spatialReference,this.displayBoundsMargin,
this.displayBounds)}}const v=q.create(),w=q.create(),r=q.create(),p=q.create();t.TransformBounds=F;t.mapPlaneAutoSize2D=function(a,d,f){b.subtract(p,b.subtract(p,a.origin,a.basis1),a.basis2);b.scaleAndAdd(r,p,a.basis1,2);b.scaleAndAdd(w,r,a.basis2,2);b.scaleAndAdd(v,p,a.basis2,2);p[2]=r[2]=w[2]=v[2]=d;return D.autoSize2D({topLeft:v,topRight:w,bottomRight:r,bottomLeft:p,spatialReference:f})};Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})});