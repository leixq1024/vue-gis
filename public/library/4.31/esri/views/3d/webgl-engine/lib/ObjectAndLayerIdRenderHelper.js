// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.31/esri/copyright.txt for details.
//>>built
define(["exports","../../../../core/has","../../../../core/NestedMap","../../../../core/libs/gl-matrix-2/factories/vec4f64","../../../../geometry/support/buffer/BufferView"],function(f,k,g,l,h){class m{constructor(){this.declaredClass="esri.views.3d.webgl-engine.lib.ObjectAndLayerIdRenderHelper";this.colorZero=new h.BufferViewVec4u8(new ArrayBuffer(4));this._layerToOidToColor=new g.NestedMap;this._colorToUID=new Map;this._layerUidToGraphicsUidToObjectId=new g.NestedMap;this._layerUidToId=new Map;
this._layerUidToPopupEnabled=new Map}setUidToObjectAndLayerId(a,b,d,c,e,n=null,p=null,q=null){a&&b&&d&&c&&(this._layerUidToId.set(c,d),this._layerUidToPopupEnabled.set(c,e),e&&this._layerUidToGraphicsUidToObjectId.set(c,b,{objectId:a,attributeNodeId:n,attributeIndex:p,subLayerId:q}))}getObjectAndLayerIdColor(a){a=this.getObjectAndLayerIdColorArray(a);return l.fromValues(a.get(0,1),a.get(0,2),a.get(0,3),255)}getObjectAndLayerIdColorArray(a){if(!a.layerUid||!a.graphicUid)return this.colorZero;var b=
this._layerUidToPopupEnabled.get(a.layerUid);if(void 0===b||!1===b)return this.colorZero;const d=this._layerUidToGraphicsUidToObjectId.get(a.layerUid,a.graphicUid)?.objectId;if(!d)return this.colorZero;b=this._layerToOidToColor.get(a.layerUid,d);if(!b){if(k("enable-feature:objectAndLayerId-screenshot-testing"))b=d;else for(;!b;){const c=Math.floor(16777214*Math.random())+1;this._colorToUID.has(c)||(b=c)}if(16777215<b)throw Error("Object ID Overflow");this._layerToOidToColor.set(a.layerUid,d,b);this._colorToUID.set(b,
a)}a=new ArrayBuffer(4);(new DataView(a)).setUint32(0,b,!1);return new h.BufferViewVec4u8(a)}getColorToObjectAndLayerIdMapping(){const a=new Map;for(const [b,d]of this._colorToUID.entries()){const c=this._layerUidToGraphicsUidToObjectId.get(d.layerUid,d.graphicUid),e=this._layerUidToId.get(d.layerUid);c&&e&&a.set(b,c.attributeNodeId?{type:"object-and-layer-and-i3s-id",olid:c.objectId,lid:e,attrId:c.attributeNodeId,attrIdx:c.attributeIndex,subLayerId:c.subLayerId}:{type:"object-and-layer-id",olid:c.objectId,
lid:e})}return a}}f.ObjectAndLayerIdRenderHelper=m;Object.defineProperty(f,Symbol.toStringTag,{value:"Module"})});