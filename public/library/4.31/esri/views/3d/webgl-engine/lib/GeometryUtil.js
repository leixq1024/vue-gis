// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.31/esri/copyright.txt for details.
//>>built
define("exports ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../geometry/support/DoubleArray ../../../../geometry/support/FloatArray ../../../../geometry/support/Indices ../../../../geometry/support/plane ../../../../geometry/support/ray ./Attribute ./BufferVectorMath ./ContentObjectType ./Geometry ./Util ./VertexAttribute".split(" "),function(F,l,z,G,sa,H,ba,ca,ta,x,D,ka,I,Y,t){function la(f,b,a){function d(h,
e){h>e&&([h,e]=[e,h]);const k=h.toString()+"."+e.toString();if(m[k])return m[k];let p=c.length;c.length+=3;R.add(c,3*h,c,3*e,c,p);R.scale(c,p,f/R.length(c,p));p/=3;return m[k]=p}let c;a?(c=[0,-1,0,1,0,0,0,0,1,-1,0,0,0,0,-1,0,1,0],a=[0,1,2,0,2,3,0,3,4,0,4,1,1,5,2,2,5,3,3,5,4,4,5,1]):(a=f*(1+Math.sqrt(5))/2,c=[-f,a,0,f,a,0,-f,-a,0,f,-a,0,0,-f,a,0,f,a,0,-f,-a,0,f,-a,a,0,-f,a,0,f,-a,0,-f,-a,0,f],a=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,
2,4,11,6,2,10,8,6,7,9,8,1]);for(var g=0;g<c.length;g+=3)R.scale(c,g,f/R.length(c,g));let m={};for(g=0;g<b;g++){const h=a.length,e=Array(4*h);for(let k=0;k<h;k+=3){const p=a[k],w=a[k+1],y=a[k+2],n=d(p,w),A=d(w,y),v=d(y,p),u=4*k;e[u]=p;e[u+1]=n;e[u+2]=v;e[u+3]=w;e[u+4]=A;e[u+5]=n;e[u+6]=y;e[u+7]=v;e[u+8]=A;e[u+9]=n;e[u+10]=A;e[u+11]=v}a=e;m={}}b=H.floatArrayFrom(c);for(g=0;g<b.length;g+=3)R.normalize(b,g);return[[t.VertexAttribute.POSITION,new x.Attribute(H.floatArrayFrom(c),a,3,!0)],[t.VertexAttribute.NORMAL,
new x.Attribute(b,a,3,!0)]]}function ma(f,b,a,d,c=!0,g=!0){let m=0;var h=z.fromValues(0,m,0),e=z.fromValues(0,m+f,0),k=z.fromValues(0,-1,0),p=z.fromValues(0,1,0);d&&(m=f,e=z.fromValues(0,0,0),h=z.fromValues(0,m,0),k=z.fromValues(0,1,0),p=z.fromValues(0,-1,0));h=[e,h];k=[k,p];p=a+2;e=Math.sqrt(f*f+b*b);if(d)for(d=a-1;0<=d;d--){var w=2*Math.PI/a*d,y=z.fromValues(Math.cos(w)*b,m,Math.sin(w)*b);h.push(y);w=z.fromValues(f*Math.cos(w)/e,-b/e,f*Math.sin(w)/e);k.push(w)}else for(d=0;d<a;d++)w=2*Math.PI/a*
d,y=z.fromValues(Math.cos(w)*b,m,Math.sin(w)*b),h.push(y),w=z.fromValues(f*Math.cos(w)/e,b/e,f*Math.sin(w)/e),k.push(w);f=[];b=[];if(c){for(c=3;c<h.length;c++)f.push(1),f.push(c-1),f.push(c),b.push(0),b.push(0),b.push(0);f.push(h.length-1);f.push(2);f.push(1);b.push(0);b.push(0);b.push(0)}if(g){for(g=3;g<h.length;g++)f.push(g),f.push(g-1),f.push(0),b.push(g),b.push(g-1),b.push(1);f.push(0);f.push(2);f.push(h.length-1);b.push(1);b.push(2);b.push(k.length-1)}g=H.newFloatArray(3*p);for(c=0;c<p;c++)g[3*
c]=h[c][0],g[3*c+1]=h[c][1],g[3*c+2]=h[c][2];h=H.newFloatArray(3*p);for(c=0;c<p;c++)h[3*c]=k[c][0],h[3*c+1]=k[c][1],h[3*c+2]=k[c][2];return[[t.VertexAttribute.POSITION,new x.Attribute(g,f,3,!0)],[t.VertexAttribute.NORMAL,new x.Attribute(h,b,3,!0)]]}function na(f,b,a,d,c,g,m=z.fromValues(0,0,0)){var h=b.length;const e=H.newFloatArray(a.length*h*3+(6*d.length||0)),k=H.newFloatArray(a.length*h*3+(d?6:0)),p=[],w=[];let y=0;var n=0;const A=G.create(),v=G.create(),u=G.create(),K=G.create(),C=G.create(),
q=G.create(),E=G.create(),r=G.create(),O=G.create(),L=G.create(),oa=G.create(),da=G.create(),ua=G.create(),pa=ca.create();l.set(O,0,1,0);l.subtract(v,a[1],a[0]);l.normalize(v,v);g?(l.add(r,a[0],m),l.normalize(u,r)):l.set(u,0,0,1);ea(v,u,O,O,C,u,.99619469809);l.copy(K,u);l.copy(da,C);for(var B=0;B<d.length;B++)l.scale(q,C,d[B][0]),l.scale(r,u,d[B][2]),l.add(q,q,r),l.add(q,q,a[0]),e[y++]=q[0],e[y++]=q[1],e[y++]=q[2];k[n++]=-v[0];k[n++]=-v[1];k[n++]=-v[2];for(B=0;B<c.length;B++)p.push(0<c[B][0]?c[B][0]:
-c[B][0]-1+d.length),p.push(0<c[B][1]?c[B][1]:-c[B][1]-1+d.length),p.push(0<c[B][2]?c[B][2]:-c[B][2]-1+d.length),w.push(0),w.push(0),w.push(0);B=d.length;const va=d.length-1;for(let J=0;J<a.length;J++){let qa=!1;0<J&&(l.copy(A,v),J<a.length-1?(l.subtract(v,a[J+1],a[J]),l.normalize(v,v)):qa=!0,l.add(L,A,v),l.normalize(L,L),l.add(oa,a[J-1],K),ca.fromPositionAndNormal(a[J],L,pa),ca.intersectRay(pa,ta.wrap(oa,A),r)?(l.subtract(r,r,a[J]),l.normalize(u,r),l.cross(C,L,u),l.normalize(C,C)):ea(L,K,da,O,C,
u,.99619469809),l.copy(K,u),l.copy(da,C));g&&(l.add(r,a[J],m),l.normalize(ua,r));for(let M=0;M<h;M++)if(l.scale(q,C,b[M][0]),l.scale(r,u,b[M][1]),l.add(q,q,r),l.normalize(E,q),k[n++]=E[0],k[n++]=E[1],k[n++]=E[2],l.add(q,q,a[J]),e[y++]=q[0],e[y++]=q[1],e[y++]=q[2],!qa){var P=(M+1)%h;p.push(B+M);p.push(B+h+M);p.push(B+P);p.push(B+P);p.push(B+h+M);p.push(B+h+P);for(P=0;6>P;P++)w.push(p[p.length-6+P]-va)}B+=h}b=a[a.length-1];for(a=0;a<d.length;a++)l.scale(q,C,d[a][0]),l.scale(r,u,d[a][1]),l.add(q,q,r),
l.add(q,q,b),e[y++]=q[0],e[y++]=q[1],e[y++]=q[2];d=n/3;k[n++]=v[0];k[n++]=v[1];k[n++]=v[2];h=B-h;for(n=0;n<c.length;n++)p.push(0<=c[n][0]?B+c[n][0]:-c[n][0]-1+h),p.push(0<=c[n][2]?B+c[n][2]:-c[n][2]-1+h),p.push(0<=c[n][1]?B+c[n][1]:-c[n][1]-1+h),w.push(d),w.push(d),w.push(d);c=[[t.VertexAttribute.POSITION,new x.Attribute(e,p,3,!0)],[t.VertexAttribute.NORMAL,new x.Attribute(k,w,3,!0)]];return new I.Geometry(f,c)}function fa(f,b,a,d,c){if(Math.abs(l.dot(b,f))>c)return!1;l.cross(a,f,b);l.normalize(a,
a);l.cross(d,a,f);l.normalize(d,d);return!0}function ea(f,b,a,d,c,g,m){return fa(f,b,c,g,m)||fa(f,a,c,g,m)||fa(f,d,c,g,m)}const R=D.Vec3Compact,ha=[[-.5,-.5,.5],[.5,-.5,.5],[.5,.5,.5],[-.5,.5,.5],[-.5,-.5,-.5],[.5,-.5,-.5],[.5,.5,-.5],[-.5,.5,-.5]],wa=[0,0,1,-1,0,0,1,0,0,0,-1,0,0,1,0,0,0,-1],xa=[0,0,1,0,1,1,0,1],ya=[0,1,2,2,3,0,4,0,3,3,7,4,1,5,6,6,2,1,1,0,4,4,5,1,3,2,6,6,7,3,5,4,7,7,6,5],ra=Array(36);for(D=0;6>D;D++)for(var N=0;6>N;N++)ra[6*D+N]=D;const Q=Array(36);for(D=0;6>D;D++)Q[6*D]=0,Q[6*D+
1]=1,Q[6*D+2]=2,Q[6*D+3]=2,Q[6*D+4]=3,Q[6*D+5]=0;const ia=[[-.5,0,-.5],[.5,0,-.5],[.5,0,.5],[-.5,0,.5],[0,-.5,0],[0,.5,0]],za=[0,1,-1,1,1,0,0,1,1,-1,1,0,0,-1,-1,1,-1,0,0,-1,1,-1,-1,0],Aa=[5,1,0,5,2,1,5,3,2,5,0,3,4,0,1,4,1,2,4,2,3,4,3,0],Ba=[0,0,0,1,1,1,2,2,2,3,3,3,4,4,4,5,5,5,6,6,6,7,7,7];D=z.fromValues(-.5,0,-.5);N=z.fromValues(.5,0,-.5);const Z=z.fromValues(0,0,.5),aa=z.fromValues(0,.5,0),S=z.create(),T=z.create(),U=z.create(),V=z.create(),W=z.create();l.subtract(S,D,aa);l.subtract(T,D,N);l.cross(U,
S,T);l.normalize(U,U);l.subtract(S,N,aa);l.subtract(T,N,Z);l.cross(V,S,T);l.normalize(V,V);l.subtract(S,Z,aa);l.subtract(T,Z,D);l.cross(W,S,T);l.normalize(W,W);const ja=[D,N,Z,aa],Ca=[0,-1,0,U[0],U[1],U[2],V[0],V[1],V[2],W[0],W[1],W[2]],Da=[0,1,2,3,1,0,3,2,1,3,0,2],Ea=[0,0,0,1,1,1,2,2,2,3,3,3],Fa=[[-1,-1,0],[1,-1,0],[1,1,0],[-1,1,0]],X=G.create();F.cgToGIS=function(f,b=f){var a=f.attributes;f=a.get(t.VertexAttribute.POSITION).data;if(a=a.get(t.VertexAttribute.NORMAL).data){var d=b.getMutableAttribute(t.VertexAttribute.NORMAL).data;
for(let c=0;c<a.length;c+=3){const g=a[c+1];d[c+1]=-a[c+2];d[c+2]=g}}if(f)for(b=b.getMutableAttribute(t.VertexAttribute.POSITION).data,a=0;a<f.length;a+=3)d=f[a+1],b[a+1]=-f[a+2],b[a+2]=d};F.createBoxGeometry=function(f,b){Array.isArray(b)||(b=[b,b,b]);const a=Array(24);for(let d=0;8>d;d++)a[3*d]=ha[d][0]*b[0],a[3*d+1]=ha[d][1]*b[1],a[3*d+2]=ha[d][2]*b[2];return new I.Geometry(f,[[t.VertexAttribute.POSITION,new x.Attribute(a,ya,3,!0)],[t.VertexAttribute.NORMAL,new x.Attribute(wa,ra,3)],[t.VertexAttribute.UV0,
new x.Attribute(xa,Q,2)]])};F.createConeGeometry=function(f,b,a,d,c,g=!0,m=!0){return new I.Geometry(f,ma(b,a,d,c,g,m))};F.createConeGeometryData=ma;F.createCylinderGeometry=function(f,b,a,d,c,g,m){c=c?z.clone(c):z.fromValues(1,0,0);g=g?z.clone(g):z.fromValues(0,0,0);m??=!0;var h=z.create();l.normalize(h,c);var e=z.create();l.scale(e,h,Math.abs(b));var k=z.create();l.scale(k,e,-.5);l.add(k,k,g);const p=z.fromValues(0,1,0);.2>Math.abs(1-l.dot(h,p))&&l.set(p,0,0,1);const w=z.create();l.cross(w,h,p);
l.normalize(w,w);l.cross(p,w,h);b=2*d+(m?2:0);g=d+(m?2:0);c=H.newFloatArray(3*b);const y=H.newFloatArray(3*g),n=H.newFloatArray(2*b),A=Array(3*d*(m?4:2)),v=Array(3*d*(m?4:2));m&&(c[3*(b-2)]=k[0],c[3*(b-2)+1]=k[1],c[3*(b-2)+2]=k[2],n[2*(b-2)]=0,n[2*(b-2)+1]=0,c[3*(b-1)]=c[3*(b-2)]+e[0],c[3*(b-1)+1]=c[3*(b-2)+1]+e[1],c[3*(b-1)+2]=c[3*(b-2)+2]+e[2],n[2*(b-1)]=1,n[2*(b-1)+1]=1,y[3*(g-2)]=-h[0],y[3*(g-2)+1]=-h[1],y[3*(g-2)+2]=-h[2],y[3*(g-1)]=h[0],y[3*(g-1)+1]=h[1],y[3*(g-1)+2]=h[2]);h=0;const u=z.create(),
K=z.create();for(let r=0;r<d;r++){var C=2*Math.PI/d*r;l.scale(u,p,Math.sin(C));l.scale(K,w,Math.cos(C));l.add(u,u,K);y[3*r]=u[0];y[3*r+1]=u[1];y[3*r+2]=u[2];l.scale(u,u,a);l.add(u,u,k);c[3*r]=u[0];c[3*r+1]=u[1];c[3*r+2]=u[2];n[2*r]=r/d;n[2*r+1]=0;c[3*(r+d)]=c[3*r]+e[0];c[3*(r+d)+1]=c[3*r+1]+e[1];c[3*(r+d)+2]=c[3*r+2]+e[2];n[2*(r+d)]=r/d;n[2*r+1]=1;C=(r+1)%d;var q=h++,E=r;A[q]=r;v[q]=E;q=h++;E=r;A[q]=r+d;v[q]=E;q=h++;E=C;A[q]=C;v[q]=E;q=h++;E=C;A[q]=C;v[q]=E;q=h++;E=r;A[q]=r+d;v[q]=E;q=h++;E=C;A[q]=
C+d;v[q]=E}if(m){for(a=0;a<d;a++)m=(a+1)%d,e=h++,k=g-2,A[e]=b-2,v[e]=k,e=h++,k=g-2,A[e]=a,v[e]=k,e=h++,k=g-2,A[e]=m,v[e]=k;for(a=0;a<d;a++)m=(a+1)%d,e=h++,k=g-1,A[e]=a+d,v[e]=k,e=h++,k=g-1,A[e]=b-1,v[e]=k,e=h++,k=g-1,A[e]=m+d,v[e]=k}d=[[t.VertexAttribute.POSITION,new x.Attribute(c,A,3,!0)],[t.VertexAttribute.NORMAL,new x.Attribute(y,v,3,!0)],[t.VertexAttribute.UV0,new x.Attribute(n,A,2,!0)]];return new I.Geometry(f,d)};F.createDiamondGeometry=function(f,b){Array.isArray(b)||(b=[b,b,b]);const a=Array(18);
for(let d=0;6>d;d++)a[3*d]=ia[d][0]*b[0],a[3*d+1]=ia[d][1]*b[1],a[3*d+2]=ia[d][2]*b[2];return new I.Geometry(f,[[t.VertexAttribute.POSITION,new x.Attribute(a,Aa,3,!0)],[t.VertexAttribute.NORMAL,new x.Attribute(za,Ba,3)]])};F.createExtrudedTriangle=function(f,b,a,d,c,g=0){const m=Array(18);b=[[-a,g,c/2],[d,g,c/2],[0,b+g,c/2],[-a,g,-c/2],[d,g,-c/2],[0,b+g,-c/2]];for(a=0;6>a;a++)m[3*a]=b[a][0],m[3*a+1]=b[a][1],m[3*a+2]=b[a][2];return new I.Geometry(f,[[t.VertexAttribute.POSITION,new x.Attribute(m,[0,
1,2,3,0,2,2,5,3,1,4,5,5,2,1,1,0,3,3,4,1,4,3,5],3,!0)]])};F.createPathExtrusionGeometry=na;F.createPointGeometry=function(f,b,a,d,c,g,m,h,e,k=null){a=a?G.clone(a):G.create();b=b?G.clone(b):G.fromValues(0,0,1);d=d?[255*d[0],255*d[1],255*d[2],3<d.length?255*d[3]:255]:[255,255,255,255];g=null!=g&&2===g.length?g:[1,1];const p=null!=c?[c]:[0];c=ba.getZeroIndexArray(1);a=[[t.VertexAttribute.POSITION,new x.Attribute(a,c,3,!0)],[t.VertexAttribute.NORMAL,new x.Attribute(b,c,3,!0)],[t.VertexAttribute.COLOR,
new x.Attribute(d,c,4,!0)],[t.VertexAttribute.SIZE,new x.Attribute(g,c,2)],[t.VertexAttribute.ROTATION,new x.Attribute(p,c,1,!0)]];h&&a.push([t.VertexAttribute.UV0,new x.Attribute(h,c,h.length)]);null!=m&&(m=[m[0],m[1],m[2],m[3]],a.push([t.VertexAttribute.CENTEROFFSETANDDISTANCE,new x.Attribute(m,c,4)]));e&&a.push([t.VertexAttribute.FEATUREATTRIBUTE,new x.Attribute([e[0],e[1],e[2],e[3]],c,4)]);return new I.Geometry(f,a,null,ka.ContentObjectType.Point,k)};F.createPolySphereData=la;F.createPolySphereGeometry=
function(f,b,a,d){b=la(b,a,d);return new I.Geometry(f,b)};F.createPolylineGeometry=function(f,b,a,d){Y.assert(1<b.length,"createPolylineGeometry(): polyline needs at least 2 points");Y.assert(3===b[0].length,"createPolylineGeometry(): malformed vertex");Y.assert(null==a||a.length===b.length,"createPolylineGeometry: need same number of points and normals");Y.assert(null==a||3===a[0].length,"createPolylineGeometry(): malformed normal");var c=sa.newDoubleArray(3*b.length);const g=Array(2*(b.length-1));
var m=0,h=0;for(var e=0;e<b.length;e++){for(var k=0;3>k;k++)c[m++]=b[e][k];0<e&&(g[h++]=e-1,g[h++]=e)}c=[[t.VertexAttribute.POSITION,new x.Attribute(c,g,3,!0)]];if(a){m=H.newFloatArray(3*a.length);h=0;for(e=0;e<b.length;e++)for(k=0;3>k;k++)m[h++]=a[e][k];c.push([t.VertexAttribute.NORMAL,new x.Attribute(m,g,3,!0)])}d&&c.push([t.VertexAttribute.COLOR,new x.Attribute(d,ba.getContinuousIndexArray(d.length/4),4)]);return new I.Geometry(f,c,null,ka.ContentObjectType.Line)};F.createSphereGeometry=function(f,
b,a,d,c={uv:!0}){var g=-Math.PI,m=2*Math.PI,h=-Math.PI/2,e=Math.PI;a=Math.max(3,Math.floor(a));d=Math.max(2,Math.floor(d));var k=(a+1)*(d+1);const p=H.newFloatArray(3*k),w=H.newFloatArray(3*k);k=H.newFloatArray(2*k);const y=[];var n=0;for(var A=0;A<=d;A++){const u=[],K=A/d,C=h+K*e,q=Math.cos(C);for(let E=0;E<=a;E++){const r=E/a;var v=g+r*m;const O=Math.cos(v)*q,L=Math.sin(C);v=-Math.sin(v)*q;p[3*n]=O*b;p[3*n+1]=L*b;p[3*n+2]=v*b;w[3*n]=O;w[3*n+1]=L;w[3*n+2]=v;k[2*n]=r;k[2*n+1]=K;u.push(n);++n}y.push(u)}b=
[];for(g=0;g<d;g++)for(m=0;m<a;m++)h=y[g][m],e=y[g][m+1],n=y[g+1][m+1],A=y[g+1][m],0===g?(b.push(h),b.push(n),b.push(A)):g===d-1?(b.push(h),b.push(e),b.push(n)):(b.push(h),b.push(e),b.push(n),b.push(n),b.push(A),b.push(h));a=[[t.VertexAttribute.POSITION,new x.Attribute(p,b,3,!0)],[t.VertexAttribute.NORMAL,new x.Attribute(w,b,3,!0)]];c.uv&&a.push([t.VertexAttribute.UV0,new x.Attribute(k,b,2,!0)]);c.offset&&(a[0][0]=t.VertexAttribute.OFFSET,a.push([t.VertexAttribute.POSITION,new x.Attribute(Float64Array.from(c.offset),
ba.getZeroIndexArray(b.length),3,!0)]));return new I.Geometry(f,a)};F.createSquareGeometry=function(f,b=Fa){var a=Array(12);for(var d=0;4>d;d++)for(let c=0;3>c;c++)a[3*d+c]=b[d][c];b=[0,1,2,2,3,0];d=[0,0,0,0,0,0];a=[[t.VertexAttribute.POSITION,new x.Attribute(a,b,3,!0)],[t.VertexAttribute.NORMAL,new x.Attribute([0,0,1],d,3,!0)],[t.VertexAttribute.UV0,new x.Attribute([0,0,1,0,1,1,0,1],b,2,!0)],[t.VertexAttribute.COLOR,new x.Attribute([255,255,255,255],d,4,!0)]];return new I.Geometry(f,a)};F.createTetrahedronGeometry=
function(f,b){Array.isArray(b)||(b=[b,b,b]);const a=Array(12);for(let d=0;4>d;d++)a[3*d]=ja[d][0]*b[0],a[3*d+1]=ja[d][1]*b[1],a[3*d+2]=ja[d][2]*b[2];return new I.Geometry(f,[[t.VertexAttribute.POSITION,new x.Attribute(a,Da,3,!0)],[t.VertexAttribute.NORMAL,new x.Attribute(Ca,Ea,3)]])};F.createTubeGeometry=function(f,b,a,d,c,g){d=d||10;c=null!=c?c:!0;Y.assert(1<b.length);const m=[],h=[];for(let e=0;e<d;e++){m.push([0,-e-1,-((e+1)%d)-1]);const k=e/d*2*Math.PI;h.push([Math.cos(k)*a,Math.sin(k)*a])}return na(f,
h,b,[[0,0,0]],m,c,g)};F.makeOrthoBasisDirUpFallback=ea;F.transformInPlace=function(f,b){f=f.getMutableAttribute(t.VertexAttribute.POSITION).data;for(let a=0;a<f.length;a+=3)l.set(X,f[a],f[a+1],f[a+2]),l.transformMat4(X,X,b),f[a]=X[0],f[a+1]=X[1],f[a+2]=X[2]};Object.defineProperty(F,Symbol.toStringTag,{value:"Module"})});