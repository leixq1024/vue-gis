// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.31/esri/copyright.txt for details.
//>>built
define("exports ../../../../core/Logger ../../../../core/mathUtils ../../../../core/screenUtils ../../../../core/libs/gl-matrix-2/math/vec2 ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../core/libs/gl-matrix-2/factories/vec4f64 ../../../../geometry/support/frustum ../../../../geometry/support/lineSegment ../../../../geometry/support/plane ../core/shaderLibrary/ShaderOutput ../core/shaderLibrary/util/AlphaCutoff ../lib/GLMaterial ../lib/Material ../lib/RenderSlot ../lib/Util ../lib/VertexAttribute ./DefaultBufferWriter ./DefaultLayouts ../shaders/NativeLineTechnique ../shaders/NativeLineTechniqueConfiguration".split(" "),
function(F,S,T,A,U,e,p,V,D,v,c,W,X,Y,L,Z,aa,G,ba,M,ca,da){class ea extends L.Material{constructor(a){super(a,N);this._configuration=new da.NativeLineTechniqueConfiguration;this.produces=new Map([[Z.RenderSlot.OPAQUE_MATERIAL,b=>W.isColorHighlightOrOID(b)]])}getConfiguration(a,b){this._configuration.output=a;this._configuration.hasSlicePlane=this.parameters.hasSlicePlane;this._configuration.hasVertexColors=this.parameters.hasVertexColors;this._configuration.transparent=1>this.parameters.color[3]||
1>this.parameters.width;this._configuration.hasOccludees=b.hasOccludees;return this._configuration}get visible(){return this.parameters.color[3]>=X.alphaCutoff}intersect(a,b,n,l,q,E){if(n.options.selectionMode&&a.visible)if(aa.isTranslationMatrix(b)){q=a.attributes.get(G.VertexAttribute.POSITION).data;var f=n.camera,m=fa;U.copy(m,n.point);e.set(B[0],m[0]-2,m[1]+2,0);e.set(B[1],m[0]+2,m[1]+2,0);e.set(B[2],m[0]+2,m[1]-2,0);e.set(B[3],m[0]-2,m[1]-2,0);for(a=0;4>a;a++)if(!f.unprojectFromRenderScreen(B[a],
t[a]))return;c.fromPoints(f.eye,t[0],t[1],H);c.fromPoints(f.eye,t[1],t[2],I);c.fromPoints(f.eye,t[2],t[3],J);c.fromPoints(f.eye,t[3],t[0],K);l=Number.MAX_VALUE;a=0;for(let g=0;g<q.length-5;g+=3)if(h[0]=q[g]+b[12],h[1]=q[g+1]+b[13],h[2]=q[g+2]+b[14],k[0]=q[g+3]+b[12],k[1]=q[g+4]+b[13],k[2]=q[g+5]+b[14],!(0>c.signedDistance(H,h)&&0>c.signedDistance(H,k)||0>c.signedDistance(I,h)&&0>c.signedDistance(I,k)||0>c.signedDistance(J,h)&&0>c.signedDistance(J,k)||0>c.signedDistance(K,h)&&0>c.signedDistance(K,
k))){f.projectToRenderScreen(h,w);f.projectToRenderScreen(k,x);if(0>w[2]&&0<x[2]){e.subtract(r,h,k);var d=f.frustum;d=-c.signedDistance(d[D.PlaneIndex.NEAR],h)/e.dot(r,c.getNormal(d[D.PlaneIndex.NEAR]));e.scale(r,r,d);e.add(h,h,r);f.projectToRenderScreen(h,w)}else if(0<w[2]&&0>x[2])e.subtract(r,k,h),d=f.frustum,d=-c.signedDistance(d[D.PlaneIndex.NEAR],k)/e.dot(r,c.getNormal(d[D.PlaneIndex.NEAR])),e.scale(r,r,d),e.add(k,k,r),f.projectToRenderScreen(k,x);else if(0>w[2]&&0>x[2])continue;w[2]=0;x[2]=
0;d=v.distance2(v.fromPoints(w,x,O),m);d<l&&(l=d,e.copy(P,h),e.copy(Q,k),a=g/3)}b=n.rayBegin;n=n.rayEnd;4>l&&(l=Number.MAX_VALUE,v.closestLineSegmentPoint(v.fromPoints(P,Q,O),v.fromPoints(b,n,ha),y)&&(e.subtract(y,y,b),l=e.length(y),e.scale(y,y,1/l),l/=e.distance(b,n)),E(l,y,a,!1))}else S.getLogger("esri.views.3d.webgl-engine.materials.NativeLineMaterial").error("intersection assumes a translation-only matrix")}intersectDraped(a,b,n,l,q,E){if(n.options.selectionMode){b=a.attributes.get(G.VertexAttribute.POSITION).data;
var f=a.attributes.get(G.VertexAttribute.SIZE);n=l[0];l=l[1];a=(((f?f.data[0]:0)+1)/2+4)*a.screenToWorldRatio;f=Number.MAX_VALUE;var m=0;for(let z=0;z<b.length-5;z+=3){var d=b[z],g=b[z+1],C=n-d,u=l-g;d=b[z+3]-d;g=b[z+4]-g;const R=T.clamp((d*C+g*u)/(d*d+g*g),0,1);C=d*R-C;u=g*R-u;u=C*C+u*u;u<f&&(f=u,m=z/3)}f<a*a&&q(E.dist,E.normal,m,!1)}}createGLMaterial(a){return new ia(a)}createBufferWriter(){return new ba.DefaultBufferWriter(this.parameters.hasVertexColors?M.PositionColorLayout:M.PositionLayout)}}
class ia extends Y{beginSlot(a){return this.acquireTechnique(ca.NativeLineTechnique,a)}}class N extends L.MaterialParameters{constructor(){super(...arguments);this.color=V.ONES;this.hasSlicePlane=this.hasVertexColors=!1;this.width=1}}const h=p.create(),k=p.create(),r=p.create(),y=p.create(),w=A.createRenderScreenPointArray3(),x=A.createRenderScreenPointArray3(),P=p.create(),Q=p.create(),O=v.create(),ha=v.create(),fa=p.create(),B=[A.createRenderScreenPointArray3(),A.createRenderScreenPointArray3(),
A.createRenderScreenPointArray3(),A.createRenderScreenPointArray3()],t=[p.create(),p.create(),p.create(),p.create()],H=c.create(),I=c.create(),J=c.create(),K=c.create();F.NativeLineMaterial=ea;F.Parameters=N;Object.defineProperty(F,Symbol.toStringTag,{value:"Module"})});