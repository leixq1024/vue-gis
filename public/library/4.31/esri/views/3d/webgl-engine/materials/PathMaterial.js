// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.31/esri/copyright.txt for details.
//>>built
define("exports ../../../../core/mathUtils ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../geometry/support/aaBoundingBox ../../support/buffer/InterleavedLayout ../core/shaderLibrary/ShaderOutput ../core/shaderLibrary/output/Emissions.glsl ../core/shaderLibrary/shading/Normals.glsl ../core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../core/shaderLibrary/util/AlphaCutoff ../effects/geometry/olidUtils ../lib/GLMaterial ../lib/Material ../lib/PathGeometry ../lib/RayIntersections ../lib/RenderSlot ../lib/VertexAttribute ./DefaultBufferWriter ./PathTechnique ./PathTechniqueConfiguration".split(" "),
function(n,t,E,F,G,H,e,u,p,v,I,J,K,L,M,w,x,k,N,q,O){function P(){const a=H.newLayout().vec3f(k.VertexAttribute.POSITION).vec4f(k.VertexAttribute.PROFILERIGHT).vec4f(k.VertexAttribute.PROFILEUP).vec4f(k.VertexAttribute.PROFILEVERTEXANDNORMAL).vec4f(k.VertexAttribute.FEATUREVALUE);J.olidEnabled()&&a.vec4u8(k.VertexAttribute.OBJECTANDLAYERIDCOLOR);return a}function y(a,b,d,f,h,m){a.baked.size&&a.baked.size[0]===b[0]&&a.baked.size[1]===b[1]||a.baked.bake(b);a.baked.intersect(d,f,h,m)}class Q extends L.Material{constructor(a,
b){super(a,z);this._vertexBufferLayout=P();this.vertexAttributeLocations=q.vertexAttributeLocations;this.supportsEdges=!0;this.produces=new Map([[x.RenderSlot.OPAQUE_MATERIAL,d=>(this.parameters.castShadows&&e.isShadowRelatedOutput(d)||e.is3DGeometryOutputMRT(d))&&!this.parameters.transparent],[x.RenderSlot.TRANSPARENT_MATERIAL,d=>(this.parameters.castShadows&&e.isShadowRelatedOutput(d)||e.is3DGeometryOutputMRT(d))&&this.parameters.transparent]]);this._configuration=new O.PathTechniqueConfiguration(b.spherical,
b.doublePrecisionRequiresObfuscation)}get hasEmissions(){return!E.exactEquals(this.parameters.emissiveFactor,F.ZEROS)}getConfiguration(a,b){this._configuration.output=a;this._configuration.vvSize=!!this.parameters.vvSize;this._configuration.vvColor=!!this.parameters.vvColor;this._configuration.vvOpacity=!!this.parameters.vvOpacity;this._configuration.hasSlicePlane=this.parameters.hasSlicePlane;this._configuration.transparent=this.parameters.transparent;this._configuration.hasOccludees=b.hasOccludees;
e.isColorOrColorEmission(a)&&(this._configuration.doubleSidedMode=this.parameters.doubleSided&&"normal"===this.parameters.doubleSidedType?p.NormalsDoubleSidedMode.View:this.parameters.doubleSided&&"winding-order"===this.parameters.doubleSidedType?p.NormalsDoubleSidedMode.WindingOrder:p.NormalsDoubleSidedMode.None,this._configuration.receiveShadows=b.shadowMap.enabled,this._configuration.receiveAmbientOcclusion=null!=b.ssao);this._configuration.pbrMode=this.parameters.usePBR?v.PBRMode.Schematic:v.PBRMode.Disabled;
this._configuration.emissionSource=this.parameters.usePBR?u.EmissionSource.Value:u.EmissionSource.None;this._configuration.oitPass=b.oitPass;this._configuration.terrainDepthTest=b.terrainDepthTest;this._configuration.cullAboveTerrain=b.cullAboveTerrain;return this._configuration}isVisibleForOutput(a){return a===e.ShaderOutput.Shadow||a===e.ShaderOutput.ShadowExcludeHighlight||a===e.ShaderOutput.ShadowHighlight?this.parameters.castShadows:!0}get visible(){return this.parameters.opacity>=I.alphaCutoff}intersect(a,
b,d,f,h,m){if(M.isPathGeometry(a)){b=a.path;var g=[this.parameters.size[0],this.parameters.size[1]];if(this.parameters.vvSize){const {offset:A,factor:B,minSize:C,maxSize:D}=this.parameters.vvSize;var l=b.sizeAttributeValue;g[0]*=t.clamp(A[0]+l*B[0],C[0],D[0]);g[1]*=t.clamp(A[2]+l*B[2],C[2],D[2])}l=new w.MeshIntersectionOptions(!1,d.options.normalRequired);var c=Math.max(g[0],g[1]);a=a.boundingInfo;if(null==a)y(b,g,f,h,l,m);else{a=G.fromValues(a.bbMin[0]-c,a.bbMin[1]-c,a.bbMin[2]-c,a.bbMax[0]+c,a.bbMax[1]+
c,a.bbMax[2]+c);c=[h[0]-f[0],h[1]-f[1],h[2]-f[2]];var r=Math.sqrt(c[0]*c[0]+c[1]*c[1]+c[2]*c[2]);w.intersectAabbInvDir(a,f,[r/c[0],r/c[1],r/c[2]],d.tolerance)&&y(b,g,f,h,l,m)}}}createBufferWriter(){return new N.DefaultBufferWriter(this._vertexBufferLayout)}createGLMaterial(a){return new R(a)}}class R extends K{beginSlot(a){return this.acquireTechnique(q.PathTechnique,a)}}class z extends q.PathPassParameters{constructor(){super(...arguments);this.doubleSided=!1;this.doubleSidedType="normal";this.castShadows=
!0;this.usePBR=this.transparent=this.hasSlicePlane=!1}}n.Parameters=z;n.PathMaterial=Q;Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})});