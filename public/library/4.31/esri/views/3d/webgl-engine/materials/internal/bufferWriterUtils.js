// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.31/esri/copyright.txt for details.
//>>built
define(["exports","../../../../../core/libs/gl-matrix-2/math/mat4","../../../../../geometry/support/buffer/BufferView","../../lib/Util","../../lib/VertexAttribute"],function(v,H,z,w,x){function I(d,a,c){const {data:b,indices:e}=d;d=a.typedBuffer;a=a.typedBufferStride;const f=e.length;c*=a;for(let h=0;h<f;++h){const g=2*e[h];d[c]=b[g];d[c+1]=b[g+1];c+=a}}function J(d,a,c,b){const {data:e,indices:f}=d;d=a.typedBuffer;a=a.typedBufferStride;const h=f.length;c*=a;if(null==b||1===b)for(b=0;b<h;++b){var g=
3*f[b];d[c]=e[g];d[c+1]=e[g+1];d[c+2]=e[g+2];c+=a}else for(g=0;g<h;++g){const k=3*f[g];for(let u=0;u<b;++u)d[c]=e[k],d[c+1]=e[k+1],d[c+2]=e[k+2],c+=a}}function K(d,a,c,b=1){const {data:e,indices:f}=d;d=a.typedBuffer;a=a.typedBufferStride;const h=f.length;c*=a;if(1===b)for(b=0;b<h;++b){var g=4*f[b];d[c]=e[g];d[c+1]=e[g+1];d[c+2]=e[g+2];d[c+3]=e[g+3];c+=a}else for(g=0;g<h;++g){const k=4*f[g];for(let u=0;u<b;++u)d[c]=e[k],d[c+1]=e[k+1],d[c+2]=e[k+2],d[c+3]=e[k+3],c+=a}}function M(d,a,c,b,e=1){if(a){var {data:f,
indices:h}=d;d=c.typedBuffer;c=c.typedBufferStride;var g=h.length,k=a[0],u=a[1],A=a[2],B=a[4],C=a[5],D=a[6],E=a[8],F=a[9],G=a[10],r=a[12],p=a[13],l=a[14];b*=c;var m=0,q=0,n=0;a=H.hasIdentityRotation(a)?t=>{m=f[t]+r;q=f[t+1]+p;n=f[t+2]+l}:t=>{const y=f[t],L=f[t+1];t=f[t+2];m=k*y+B*L+E*t+r;q=u*y+C*L+F*t+p;n=A*y+D*L+G*t+l};if(1===e)for(e=0;e<g;++e)a(3*h[e]),d[b]=m,d[b+1]=q,d[b+2]=n,b+=c;else for(let t=0;t<g;++t){a(3*h[t]);for(let y=0;y<e;++y)d[b]=m,d[b+1]=q,d[b+2]=n,b+=c}}else J(d,c,b,e)}function N(d,
a,c,b,e=1){if(a){var {data:f,indices:h}=d;d=c.typedBuffer;c=c.typedBufferStride;var g=h.length,k=a[0],u=a[1],A=a[2],B=a[4],C=a[5],D=a[6],E=a[8],F=a[9],G=a[10],r=!H.isOrthoNormal(a);b*=c;var p=0,l=0,m=0;a=H.hasIdentityRotation(a)?n=>{p=f[n];l=f[n+1];m=f[n+2]}:n=>{const t=f[n],y=f[n+1];n=f[n+2];p=k*t+B*y+E*n;l=u*t+C*y+F*n;m=A*t+D*y+G*n};if(1===e)if(r)for(e=0;e<g;++e)a(3*h[e]),r=p*p+l*l+m*m,.999999>r&&1E-6<r?(r=1/Math.sqrt(r),d[b]=p*r,d[b+1]=l*r,d[b+2]=m*r):(d[b]=p,d[b+1]=l,d[b+2]=m),b+=c;else for(e=
0;e<g;++e)a(3*h[e]),d[b]=p,d[b+1]=l,d[b+2]=m,b+=c;else for(let n=0;n<g;++n){a(3*h[n]);if(r){var q=p*p+l*l+m*m;.999999>q&&1E-6<q&&(q=1/Math.sqrt(q),p*=q,l*=q,m*=q)}for(q=0;q<e;++q)d[b]=p,d[b+1]=l,d[b+2]=m,b+=c}}else J(d,c,b,e)}function O(d,a,c,b,e=1){if(a){var {data:f,indices:h}=d;d=c.typedBuffer;c=c.typedBufferStride;var g=h.length,k=a[0],u=a[1],A=a[2],B=a[4],C=a[5],D=a[6],E=a[8],F=a[9],G=a[10];a=!H.isOrthoNormal(a);b*=c;if(1===e)for(e=0;e<g;++e){var r=4*h[e],p=f[r],l=f[r+1],m=f[r+2];r=f[r+3];var q=
k*p+B*l+E*m,n=u*p+C*l+F*m;p=A*p+D*l+G*m;a&&(l=q*q+n*n+p*p,.999999>l&&1E-6<l&&(l=1/Math.sqrt(l),q*=l,n*=l,p*=l));d[b]=q;d[b+1]=n;d[b+2]=p;d[b+3]=r;b+=c}else for(r=0;r<g;++r){q=4*h[r];l=f[q];m=f[q+1];const t=f[q+2];q=f[q+3];n=k*l+B*m+E*t;p=u*l+C*m+F*t;l=A*l+D*m+G*t;a&&(m=n*n+p*p+l*l,.999999>m&&1E-6<m&&(m=1/Math.sqrt(m),n*=m,p*=m,l*=m));for(m=0;m<e;++m)d[b]=n,d[b+1]=p,d[b+2]=l,d[b+3]=q,b+=c}}else K(d,c,b,e)}function P(d,a,c,b,e=1){const {data:f,indices:h}=d;var g=c.typedBuffer,k=c.typedBufferStride;
d=h.length;b*=k;if(a===f.length&&4===a)for(g[b]=f[0],g[b+1]=f[1],g[b+2]=f[2],g[b+3]=f[3],g=new Uint32Array(c.typedBuffer.buffer,c.start),k/=4,b/=4,a=g[b],b+=k,d*=e,e=1;e<d;++e)g[b]=a,b+=k;else if(1===e)if(4===a)for(e=0;e<d;++e)a=4*h[e],g[b]=f[a],g[b+1]=f[a+1],g[b+2]=f[a+2],g[b+3]=f[a+3],b+=k;else for(e=0;e<d;++e)a=3*h[e],g[b]=f[a],g[b+1]=f[a+1],g[b+2]=f[a+2],g[b+3]=255,b+=k;else if(4===a)for(a=0;a<d;++a){c=4*h[a];for(var u=0;u<e;++u)g[b]=f[c],g[b+1]=f[c+1],g[b+2]=f[c+2],g[b+3]=f[c+3],b+=k}else for(a=
0;a<d;++a)for(c=3*h[a],u=0;u<e;++u)g[b]=f[c],g[b+1]=f[c+1],g[b+2]=f[c+2],g[b+3]=255,b+=k}function Q(d,a,c){const {data:b,indices:e}=d;d=a.typedBuffer;a=a.typedBufferStride;const f=e.length,h=b[0];c*=a;for(let g=0;g<f;++g)d[c]=h,c+=a}function R(d,a,c,b,e=1){const f=a.typedBuffer;a=a.typedBufferStride;b*=a;if(1===e)for(e=0;e<c;++e)f[b]=d[0],f[b+1]=d[1],f[b+2]=d[2],f[b+3]=d[3],b+=a;else for(let h=0;h<c;++h)for(let g=0;g<e;++g)f[b]=d[0],f[b+1]=d[1],f[b+2]=d[2],f[b+3]=d[3],b+=a}function S(d,a,c,b,e,f){switch(d){case x.VertexAttribute.POSITION:w.assert(3===
a.size);b=e.getField(d,z.BufferViewVec3f);w.assert(!!b,`No buffer view for ${d}`);b&&M(a,c,b,f);break;case x.VertexAttribute.NORMAL:w.assert(3===a.size);c=e.getField(d,z.BufferViewVec3f);w.assert(!!c,`No buffer view for ${d}`);c&&N(a,b,c,f);break;case x.VertexAttribute.NORMALCOMPRESSED:w.assert(2===a.size);c=e.getField(d,z.BufferViewVec2i16);w.assert(!!c,`No buffer view for ${d}`);c&&I(a,c,f);break;case x.VertexAttribute.UV0:w.assert(2===a.size);c=e.getField(d,z.BufferViewVec2f);w.assert(!!c,`No buffer view for ${d}`);
c&&I(a,c,f);break;case x.VertexAttribute.COLOR:case x.VertexAttribute.SYMBOLCOLOR:c=e.getField(d,z.BufferViewVec4u8);w.assert(!!c,`No buffer view for ${d}`);w.assert(3===a.size||4===a.size);!c||3!==a.size&&4!==a.size||P(a,a.size,c,f);break;case x.VertexAttribute.COLORFEATUREATTRIBUTE:c=e.getField(d,z.BufferViewFloat);w.assert(!!c,`No buffer view for ${d}`);w.assert(1===a.size);c&&1===a.size&&Q(a,c,f);break;case x.VertexAttribute.TANGENT:w.assert(4===a.size);b=e.getField(d,z.BufferViewVec4f);w.assert(!!b,
`No buffer view for ${d}`);b&&O(a,c,b,f);break;case x.VertexAttribute.PROFILERIGHT:case x.VertexAttribute.PROFILEUP:case x.VertexAttribute.PROFILEVERTEXANDNORMAL:case x.VertexAttribute.FEATUREVALUE:w.assert(4===a.size),c=e.getField(d,z.BufferViewVec4f),w.assert(!!c,`No buffer view for ${d}`),c&&K(a,c,f)}}v.writeBufferFloat=function(d,a,c,b=1){const {data:e,indices:f}=d;d=a.typedBuffer;a=a.typedBufferStride;const h=f.length;c*=a;if(1===b)for(b=0;b<h;++b)d[c]=e[f[b]],c+=a;else for(let g=0;g<h;++g){const k=
e[f[g]];for(let u=0;u<b;u++)d[c]=k,c+=a}};v.writeBufferMat3f=function(d,a,c){const {data:b,indices:e}=d;d=a.typedBuffer;a=a.typedBufferStride;const f=e.length;c*=a;for(let h=0;h<f;++h){const g=9*e[h];for(let k=0;9>k;++k)d[c+k]=b[g+k];c+=a}};v.writeBufferMat4f=function(d,a,c){const {data:b,indices:e}=d;d=a.typedBuffer;a=a.typedBufferStride;const f=e.length;c*=a;for(let h=0;h<f;++h){const g=16*e[h];for(let k=0;16>k;++k)d[c+k]=b[g+k];c+=a}};v.writeBufferVec2=I;v.writeBufferVec3=J;v.writeBufferVec4=K;
v.writeBufferVec4Zeros=function(d,a,c){const b=d.typedBuffer;d=d.typedBufferStride;a*=d;for(let e=0;e<c;++e)b[a]=0,b[a+1]=0,b[a+2]=0,b[a+3]=0,a+=d};v.writeColor=P;v.writeColorFeatureAttribute=Q;v.writeDefaultAttribute=S;v.writeDefaultAttributes=function(d,a,c,b,e,f,h){for(const k of c.fields.keys()){c=d.get(k);var g=c?.indices;c&&g?S(k,c,b,e,f,h):k===x.VertexAttribute.OBJECTANDLAYERIDCOLOR&&null!=a&&(c=d.get(x.VertexAttribute.POSITION)?.indices)&&(c=c.length,g=f.getField(k,z.BufferViewVec4u8),R(a,
g,c,h))}};v.writeNormal=N;v.writeObjectAndLayerIdColor=R;v.writePosition=M;v.writeTangent=O;Object.defineProperty(v,Symbol.toStringTag,{value:"Module"})});