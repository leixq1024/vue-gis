// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.31/esri/copyright.txt for details.
//>>built
define(["./IndexRange/ComponentRangeRunLengthEncoded"],function(l){function m(a,b,n,e){const k=new Map,c=[];let h=e.length;n.forEachComponent(d=>{if(0<a[d]){var f=b[d];let g=k.get(f);void 0===g&&(g=[],k.set(f,g));f=e[d];d=e[d+1];g.push(f);g.push(d-f)}else h!==d-1&&(c.length&&c.push(e[h+1]-c[c.length-1]),c.push(e[d])),h=d;return!0});c.length&&c.push(e[h+1]-c[c.length-1]);return{highlightRangesMap:k,defaultRanges:c}}class p{constructor(a,b){this.offsets=b;this.cachedDefaultRanges=this.cachedHighlightRangesMap=
this.cachedGeometryRanges=this.verticalOffsets=this.highlightGroups=this.highlightCounts=this.pickability=null;b=this.count;this.visibility=new l.ComponentRangeRunLengthEncoded(b);this.materialDataBuffer=a.getBuffer(b);this.materialDataIndices=new Uint16Array(b);for(a=0;a<b;a++)this.materialDataIndices[a]=this.materialDataBuffer.acquireIndex()}destroy(){for(let a=0;a<this.count;a++)this.materialDataBuffer.releaseIndex(this.materialDataIndices[a])}get count(){return this.offsets.length-1}get geometryRanges(){null==
this.cachedGeometryRanges&&(this.cachedGeometryRanges=this.visibility.computeOffsetRanges(this.offsets));return this.cachedGeometryRanges}get highlightRanges(){if(null==this.highlightCounts)return null;this._updateCachedHighlightRanges();return this.cachedHighlightRangesMap}get defaultShadowMapRanges(){if(null==this.highlightCounts)return this.geometryRanges;this._updateCachedHighlightRanges();return this.cachedDefaultRanges}highlightsDirty(){this.cachedDefaultRanges=this.cachedHighlightRangesMap=
null}visibilityDirty(){this.cachedGeometryRanges=null;this.highlightsDirty()}_updateCachedHighlightRanges(){if((null==this.cachedHighlightRangesMap||null==this.cachedDefaultRanges)&&null!=this.highlightCounts&&null!=this.highlightGroups){const {highlightRangesMap:a,defaultRanges:b}=m(this.highlightCounts,this.highlightGroups,this.visibility,this.offsets);this.cachedHighlightRangesMap=a;this.cachedDefaultRanges=b}}}return p});