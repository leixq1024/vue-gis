// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.31/esri/copyright.txt for details.
//>>built
define(["exports","../../../../../core/PooledArray","./AllRenderPasses","../../lib/OITPass","../../../../webgl/enums"],function(g,x,y,z,p){g.RenderPassSorting=void 0;(function(a){a[a.FrontToBack=0]="FrontToBack";a[a.BackToFront=1]="BackToFront"})(g.RenderPassSorting||(g.RenderPassSorting={}));class A{constructor(a,b,d=g.RenderPassSorting.FrontToBack){this._rctx=a;this._techniques=b;this._sorting=d;this._draws=new x({initialSize:32,allocator:e=>e??{material:null,geometry:null,geometryRanges:null,bindDrawParams:null,
depthSquaredHint:0,indexType:0}});this._previouslyBoundDraw=new Map}submitDraw(a,b,d,e,h){const f=this._draws.pushNew();f.geometry=b;f.geometryRanges=d;f.material=a;f.depthSquaredHint=e;f.indexType=(b.indexed?b.vao.indexBuffer.indexType:null)??0;f.highlightGroupName=h}acquire(a,b){return this._draws.map(d=>d.material.acquireTechnique(this._techniques,a,b,d.geometry.parameters))}dispatch(a,b,d){const e=this._rctx;this._previouslyBoundDraw.clear();let h=null;const f=this._draws.length;for(let k=0;k<
f;k++){var l=this._draws.data[k];if(a.identifier===y.RenderPassIdentifier.Highlight){var {highlightGroupName:c}=l;if(c&&(b.highlightGroupIndices.get(c)??0)!==b.highlightLevel)continue}c=d[k];if(c!==h||b.oitPass!==z.OITPass.NONE)e.bindTechnique(c,b,a),h=c;const {geometryRanges:q,indexType:r,geometry:u,material:t}=l;e.bindVAO(u.vao);this._previouslyBoundDraw.get(c)!==t&&(c.program.bindDraw(b,a,t),this._previouslyBoundDraw.set(c,t));l=q.length;({primitiveType:c}=u);for(let m=0;m<l;m+=2){const v=q[m],
w=q[m+1];if(0!==r){const B=n.get(r);e.drawElements(c,w,r,v*B)}else e.drawArrays(c,v,w)}}}prepareSubmit(){this._draws.clear()}finishSubmit(){const a=this._sorting===g.RenderPassSorting.FrontToBack?1:-1;this._draws.sort((b,d)=>{const e=a*(b.depthSquaredHint-d.depthSquaredHint);return 0!==e?e:b.geometry.vao.byteSize-d.geometry.vao.byteSize})}get count(){return this._draws.length}}const n=new Map;n.set(p.DataType.UNSIGNED_BYTE,1);n.set(p.DataType.UNSIGNED_SHORT,2);n.set(p.DataType.UNSIGNED_INT,4);g.RenderPass=
A;Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})});