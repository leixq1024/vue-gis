// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.31/esri/copyright.txt for details.
//>>built
define("exports ../../../../core/Logger ../../../../core/PooledArray ../../webgl/utils ../core/FBOCache ../../../webgl/checkWebGLError".split(" "),function(l,m,p,q,r,n){class t{constructor(a){this._context=a;this._nodes=new p}destroy(){this._nodes.forEach(a=>a.destroy());this._nodes.clear()}add(a){this._nodes.push(a);n.hasFeatureFlagWebGLDebug&&console.log(`Registered render nodes: ${this._nodes.map(({declaredClass:b})=>b).join(", ")}`)}remove(a){this._nodes.remove(a);n.hasFeatureFlagWebGLDebug&&
console.log(`Registered render nodes: ${this._nodes.map(({declaredClass:b})=>b).join(", ")}`)}produces(a){return this._nodes.some(({produces:b})=>b===a)}require(a,...b){const f=this._nodes,d=g=>f.reduce((c,{consumes:k,produces:h})=>c+(!k.required.includes(a)||null!=g&&h!==g?0:1),0);return 0===b.length?d():b.reduce((g,c)=>g+d(c),0)}optional(a,...b){const f=this._nodes,d=g=>f.reduce((c,{consumes:k,produces:h})=>c+(!k.optional?.includes(a)||null!=g&&h!==g?0:1),0);return 0===b.length?d():b.reduce((g,
c)=>g+d(c),0)}updateAnimation(a){return this._nodes.reduce((b,f)=>f.updateAnimation(a)||b,!1)}precompile(...a){++this._context.techniques.precompiling;for(const b of a)this._nodes.forEach(f=>{f.produces===b&&f.precompile()});--this._context.techniques.precompiling}render(a,b,f=()=>{}){const d=a.name,g=this._nodes.filter(({produces:c})=>c===d);if(0===g.length)return q.isManagedFBO(a)?a:r.defaultWebGLFBO;g.forEach(c=>{const k=[a];for(var h of c.consumes.required){if(h===d)continue;const e=b.get(h);
if(e)k.push(e);else if("emissive"!==h||!b.get(d)?.hasAttachment(h)){f&&f(k);return}}if(c.consumes.optional)for(const e of c.consumes.optional)e!==d&&(h=b.get(e))&&k.push(h);try{const e=c.doRender(k);e&&e!==a&&(d!==e.name&&(m.getLogger(c).errorOnce(`RenderNode produced ${e.name}, expected ${d}`),e.setName(d)),a.release(),a=e,b.set(d,a))}catch(e){m.getLogger(c).errorOnce(e)}f&&f(k)});this._context.rctx.enforceState();return a}requireGeometryDepth(){return this._nodes.some(a=>"disabled"!==a.produces&&
a.requireGeometryDepth)}get test(){return{nodes:this._nodes}}}l.RenderNodes=t;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})});