// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.31/esri/copyright.txt for details.
//>>built
require({cache:{"esri/core/accessorSupport/overrideDefaultsFrom":function(){define(["exports","../Accessor","./PropertyOrigin","./utils"],function(a,b,n,k){function p(h,e){var g=k.getProperties(h),d=k.getProperties(e);g=g.store;e=d.store;d=d.metadata;for(const l in d){var f=d[l],c=g.originOf(l);const w=e.originOf(l);f.readOnly||w===n.OriginId.DEFAULTS||(c!==n.OriginId.DEFAULTS?(f=g.get(l),c=e.get(l),f&&c&&c instanceof b&&f instanceof b&&f instanceof c.constructor&&p(f,c)):h.set(l,e.get(l)))}}a.overrideDefaultsFrom=
p;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/projection/projectBoundingRect":function(){define(["exports","../../core/libs/gl-matrix-2/factories/vec3f64","./projectBuffer","../support/aaBoundingRect","../support/spatialReferenceUtils"],function(a,b,n,k,p){const h=b.create();a.projectBoundingRect=function(e,g,d,f){if(null==e)return!1;if(p.equals(g,f))return k.copy(d,e),!0;h[0]=e[0];h[1]=e[1];h[2]=0;if(!n.projectBuffer(h,g,0,h,f,0))return!1;d[0]=h[0];d[1]=h[1];h[0]=
e[2];h[1]=e[3];h[2]=0;if(!n.projectBuffer(h,g,0,h,f,0))return!1;d[2]=h[0];d[3]=h[1];return!0};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/projection/projectPointToVector":function(){define(["exports","../../core/libs/gl-matrix-2/factories/vec3f64","../projection","./projectBuffer"],function(a,b,n,k){function p(e,g,d,f){if(n.canProjectWithoutEngine(e.spatialReference,d))return h[0]=e.x,h[1]=e.y,h[2]=e.z??f??0,k.projectBuffer(h,e.spatialReference,0,g,d,0);e=n.tryProjectWithZConversion(e,
d);if(!e)return!1;g[0]=e?.x;g[1]=e?.y;g[2]=e?.z??f??0;return!0}const h=b.create();a.projectPointToVector=p;a.projectPointToVectorAsync=async function(e,g,d,f,c){await n.initializeProjection(e.spatialReference,d,null,c);return p(e,g,d,f)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/boundedPlane":function(){define("exports ../core/has ../core/Logger ../core/mathUtils ../core/ObjectStack ../core/libs/gl-matrix-2/math/mat4 ../core/libs/gl-matrix-2/factories/mat4f64 ./vec32 ../core/libs/gl-matrix-2/factories/vec3f64 ../geometry/support/aaBoundingRect ../geometry/support/Axis ../geometry/support/lineSegment ../geometry/support/plane ../geometry/support/ray ../geometry/support/vector ../geometry/support/vectorStacks".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w,x,u,t){function m(la=ia){return{plane:w.create(la.plane),origin:d.clone(la.origin),basis1:d.clone(la.basis1),basis2:d.clone(la.basis2)}}function q(la,na,qa){const sa=ja.get();sa.origin=la;sa.basis1=na;sa.basis2=qa;sa.plane=w.wrap(0,0,0,0);B(sa);return sa}function r(la,na=m()){return y(la.origin,la.basis1,la.basis2,na)}function v(la,na){g.copy(na.origin,la.origin);g.copy(na.basis1,la.basis1);g.copy(na.basis2,la.basis2);w.copy(na.plane,la.plane)}function y(la,na,qa,
sa=m()){g.copy(sa.origin,la);g.copy(sa.basis1,na);g.copy(sa.basis2,qa);B(sa);1E-6<Math.abs(g.dot(sa.basis1,sa.basis2)/(g.length(sa.basis1)*g.length(sa.basis2)))&&S().warn("fromValues()","Provided basis vectors are not perpendicular");1E-6<Math.abs(g.dot(sa.basis1,U(sa)))&&S().warn("fromValues()","Basis vectors and plane normal are not perpendicular");1E-6<Math.abs(-g.dot(U(sa),sa.origin)-sa.plane[3])&&S().warn("fromValues()","Plane offset is not consistent with plane origin");return sa}function B(la){w.fromVectorsAndPoint(la.basis2,
la.basis1,la.origin,la.plane)}function z(la,na,qa){la!==qa&&r(la,qa);la=g.scale(t.sv3d.get(),U(la),na);g.add(qa.origin,qa.origin,la);qa.plane[3]-=na;return qa}function A(la,na,qa){H(na,qa);z(qa,P(la,la.origin),qa);return qa}function C(la,na){const qa=la.basis1[0],sa=la.basis2[1],[xa,ta]=la.origin;return f.fromValues(xa-qa,ta-sa,xa+qa,ta+sa,na)}function H(la,na=m()){const qa=(la[2]-la[0])/2,sa=(la[3]-la[1])/2;g.set(na.origin,la[0]+qa,la[1]+sa,0);g.set(na.basis1,qa,0,0);g.set(na.basis2,0,sa,0);w.fromValues(0,
0,1,0,na.plane);return na}function E(la,na,qa){return w.intersectRay(la.plane,na,qa)?da(la,qa):!1}function F(la,na,qa){if(E(la,na,qa))return qa;la=G(la,na,t.sv3d.get());g.add(qa,na.origin,g.scale(t.sv3d.get(),na.direction,g.distance(na.origin,la)/g.length(na.direction)));return qa}function G(la,na,qa){const sa=Y.get();var xa=Y.get();T(la,na,sa,xa);xa=Number.POSITIVE_INFINITY;for(const Ba of X){var ta=ha(la,Ba,ea.get());const Ia=t.sv3d.get();w.intersectLineSegment(sa,ta,Ia)&&(ta=g.direction(t.sv3d.get(),
na.origin,Ia),ta=Math.abs(k.acosClamped(g.dot(na.direction,ta))),ta<xa&&(xa=ta,g.copy(qa,Ia)))}return xa===Number.POSITIVE_INFINITY?I(la,na,qa):qa}function D(la,na){return(na-la)/na}function I(la,na,qa){if(E(la,na,qa))return qa;const sa=Y.get(),xa=Y.get();T(la,na,sa,xa);let ta=Number.POSITIVE_INFINITY;for(const Ia of X){var Ba=ha(la,Ia,ea.get());const Ca=t.sv3d.get();w.intersectLineSegmentClamp(sa,Ba,Ca)&&(Ba=x.distance2(na,Ca),w.isPointInside(xa,Ca)&&Ba<ta&&(ta=Ba,g.copy(qa,Ca)))}M(la,na.origin)<
ta&&J(la,na.origin,qa);return qa}function J(la,na,qa){var sa=w.projectPoint(la.plane,na,t.sv3d.get());na=l.projectPointClamp(fa(la,la.basis1),sa,-1,1,t.sv3d.get());sa=l.projectPointClamp(fa(la,la.basis2),sa,-1,1,t.sv3d.get());g.subtract(qa,g.add(t.sv3d.get(),na,sa),la.origin);return qa}function N(la,na,qa){const {origin:sa,basis1:xa,basis2:ta}=la,Ba=g.subtract(t.sv3d.get(),na,sa);na=u.projectPointSignedLength(xa,Ba);const Ia=u.projectPointSignedLength(ta,Ba);la=u.projectPointSignedLength(U(la),Ba);
return g.set(qa,na,Ia,la)}function M(la,na){na=N(la,na,t.sv3d.get());const {basis1:qa,basis2:sa}=la;la=g.length(qa);var xa=g.length(sa);la=Math.max(Math.abs(na[0])-la,0);xa=Math.max(Math.abs(na[1])-xa,0);na=na[2];return la*la+xa*xa+na*na}function Q(la,na){return Math.sqrt(M(la,na))}function O(la,na){let qa=Number.NEGATIVE_INFINITY;for(const xa of X){var sa=ha(la,xa,ea.get());sa=l.distance2(sa,na);sa>qa&&(qa=sa)}return Math.sqrt(qa)}function K(la,na){return w.isPointInside(la.plane,na)&&da(la,na)}
function L(la,na,qa,sa){switch(qa){case c.Axis.X:g.copy(sa,la.basis1);g.normalize(sa,sa);break;case c.Axis.Y:g.copy(sa,la.basis2);g.normalize(sa,sa);break;case c.Axis.Z:g.copy(sa,U(la))}return sa}function P(la,na){const qa=-la.plane[3];return u.projectPointSignedLength(U(la),na)-qa}function R(la,na,qa,sa){const xa=P(la,na);la=g.scale(ka,U(la),qa-xa);g.add(sa,na,la);return sa}function W(la,na){return g.exactEquals(la.basis1,na.basis1)&&g.exactEquals(la.basis2,na.basis2)&&g.exactEquals(la.origin,na.origin)}
function V(la,na,qa){la!==qa&&r(la,qa);h.invert(aa,na);h.transpose(aa,aa);g.transformMat4(qa.basis1,la.basis1,aa);g.transformMat4(qa.basis2,la.basis2,aa);g.transformMat4(w.getNormal(qa.plane),w.getNormal(la.plane),aa);g.transformMat4(qa.origin,la.origin,na);w.setOffsetFromPoint(qa.plane,qa.plane,qa.origin);return qa}function ba(la,na,qa,sa){la!==sa&&r(la,sa);h.fromRotation(pa,na,qa);g.transformMat4(sa.basis1,la.basis1,pa);g.transformMat4(sa.basis2,la.basis2,pa);B(sa);return sa}function U(la){return w.getNormal(la.plane)}
function da(la,na){const qa=g.subtract(t.sv3d.get(),na,la.origin);na=g.squaredLength(la.basis1);const sa=g.squaredLength(la.basis2),xa=g.dot(la.basis1,qa);la=g.dot(la.basis2,qa);return 0>-xa-na&&0>xa-na&&0>-la-sa&&0>la-sa}function fa(la,na){const qa=ea.get();g.copy(qa.origin,la.origin);g.copy(qa.vector,na);return qa}function ha(la,na,qa){const {basis1:sa,basis2:xa,origin:ta}=la;la=g.scale(t.sv3d.get(),sa,na.origin[0]);const Ba=g.scale(t.sv3d.get(),xa,na.origin[1]);g.add(qa.origin,la,Ba);g.add(qa.origin,
qa.origin,ta);la=g.scale(t.sv3d.get(),sa,na.direction[0]);na=g.scale(t.sv3d.get(),xa,na.direction[1]);g.scale(qa.vector,g.add(la,la,na),2);return qa}function T(la,na,qa,sa){la=U(la);w.fromVectorsAndPoint(la,na.direction,na.origin,qa);w.fromVectorsAndPoint(w.getNormal(qa),la,na.origin,sa)}const S=()=>n.getLogger("esri.views.3d.support.geometryUtils.boundedPlane");class Z{constructor(){this.plane=w.create();this.origin=d.create();this.basis1=d.create();this.basis2=d.create()}}b=Z;const ia={plane:w.create(),
origin:d.fromValues(0,0,0),basis1:d.fromValues(1,0,0),basis2:d.fromValues(0,1,0)},Y=new p.ObjectStack(w.create),ea=new p.ObjectStack(l.create),ka=d.create(),ja=new p.ObjectStack(()=>m()),X=[{origin:[-1,-1],direction:[1,0]},{origin:[1,-1],direction:[0,1]},{origin:[1,1],direction:[-1,0]},{origin:[-1,1],direction:[0,-1]}],aa=e.create(),pa=e.create();p=Object.freeze(Object.defineProperty({__proto__:null,BoundedPlaneClass:b,altitudeAt:P,axisAt:L,cameraFrustumCoverage:D,closestPoint:I,closestPointOnSilhouette:G,
copy:r,copyWithoutVerify:v,create:m,distance:Q,distance2:M,distanceToSilhouette:O,elevate:z,equals:W,extrusionContainsPoint:K,fromAABoundingRect:H,fromValues:y,getExtent:C,intersectRay:E,intersectRayClosestSilhouette:F,normal:U,projectPoint:J,projectPointLocal:N,rotate:ba,setAltitudeAt:R,setExtent:A,transform:V,up:ia,updateUnboundedPlane:B,wrap:q},Symbol.toStringTag,{value:"Module"}));a.BoundedPlaneClass=b;a.altitudeAt=P;a.axisAt=L;a.boundedPlane=p;a.cameraFrustumCoverage=D;a.closestPoint=I;a.closestPointOnSilhouette=
G;a.copy=r;a.copyWithoutVerify=v;a.create=m;a.distance=Q;a.distance2=M;a.distanceToSilhouette=O;a.elevate=z;a.equals=W;a.extrusionContainsPoint=K;a.fromAABoundingRect=H;a.fromValues=y;a.getExtent=C;a.intersectRay=E;a.intersectRayClosestSilhouette=F;a.normal=U;a.projectPoint=J;a.projectPointLocal=N;a.rotate=ba;a.setAltitudeAt=R;a.setExtent=A;a.transform=V;a.up=ia;a.updateUnboundedPlane=B;a.wrap=q})},"esri/core/ObjectStack":function(){define(["exports","./nextTick"],function(a,b){class n{constructor(k){this._allocator=
k;this._items=[];this._itemsPtr=0;this._grow()}get(){0===this._itemsPtr&&b.nextTick(()=>this._reset());this._itemsPtr===this._items.length&&this._grow();return this._items[this._itemsPtr++]}_reset(){this._items.length=Math.min(Math.min(3*Math.max(8,this._itemsPtr),this._itemsPtr+3072),this._items.length);this._itemsPtr=0}_grow(){for(let k=0;k<Math.max(8,Math.min(this._items.length,1024));k++)this._items.push(this._allocator())}}a.ObjectStack=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/geometry/support/lineSegment":function(){define("exports ../../core/mathUtils ../../core/ObjectStack ../../chunks/vec32 ../../core/libs/gl-matrix-2/factories/vec3f64 ./vectorStacks".split(" "),function(a,b,n,k,p,h){function e(x){return x?{origin:p.clone(x.origin),vector:p.clone(x.vector)}:{origin:p.create(),vector:p.create()}}function g(x,u){const t=w.get();t.origin=x;t.vector=u;return t}function d(x,u,t=e()){k.copy(t.origin,x);k.copy(t.vector,u);return t}function f(x,u,t,m,q){const {vector:r,
origin:v}=x;u=k.subtract(h.sv3d.get(),u,v);u=k.dot(r,u)/k.squaredLength(r);k.scale(q,r,b.clamp(u,t,m));return k.add(q,q,x.origin)}function c(x,u,t,m){const q=x.origin;var r=k.add(h.sv3d.get(),q,x.vector);x=u.origin;var v=k.add(h.sv3d.get(),x,u.vector),y=h.sv3d.get();u=h.sv3d.get();y[0]=q[0]-x[0];y[1]=q[1]-x[1];y[2]=q[2]-x[2];u[0]=v[0]-x[0];u[1]=v[1]-x[1];u[2]=v[2]-x[2];if(1E-6>Math.abs(u[0])&&1E-6>Math.abs(u[1])&&1E-6>Math.abs(u[2]))return!1;v=h.sv3d.get();v[0]=r[0]-q[0];v[1]=r[1]-q[1];v[2]=r[2]-
q[2];if(1E-6>Math.abs(v[0])&&1E-6>Math.abs(v[1])&&1E-6>Math.abs(v[2]))return!1;r=y[0]*u[0]+y[1]*u[1]+y[2]*u[2];var B=u[0]*v[0]+u[1]*v[1]+u[2]*v[2];const z=u[0]*u[0]+u[1]*u[1]+u[2]*u[2],A=(v[0]*v[0]+v[1]*v[1]+v[2]*v[2])*z-B*B;if(1E-6>Math.abs(A))return!1;y=(r*B-(y[0]*v[0]+y[1]*v[1]+y[2]*v[2])*z)/A;r=(r+B*y)/z;t&&(y=b.clamp(y,0,1),r=b.clamp(r,0,1));t=h.sv3d.get();B=h.sv3d.get();t[0]=q[0]+y*v[0];t[1]=q[1]+y*v[1];t[2]=q[2]+y*v[2];B[0]=x[0]+r*u[0];B[1]=x[1]+r*u[1];B[2]=x[2]+r*u[2];m.tA=y;m.tB=r;m.pA=t;
m.pB=B;m.distance2=k.squaredDistance(t,B);return!0}const l={tA:0,tB:0,pA:p.create(),pB:p.create(),distance2:0},w=new n.ObjectStack(()=>e());a.closestLineSegmentPoint=function(x,u,t){return c(x,u,!0,l)?(k.copy(t,l.pA),!0):!1};a.closestRayDistance2=function(x,u){if(c(x,g(u.origin,u.direction),!1,l)){const {tA:t,pB:m,distance2:q}=l;if(0<=t&&1>=t)return q;if(0>t)return k.squaredDistance(x.origin,m);if(1<t)return k.squaredDistance(k.add(h.sv3d.get(),x.origin,x.vector),m)}return null};a.copy=function(x,
u=e()){return d(x.origin,x.vector,u)};a.create=e;a.distance2=function(x,u){u=k.subtract(h.sv3d.get(),u,x.origin);var t=k.dot(x.vector,u);const m=k.dot(x.vector,x.vector);t=b.clamp(t/m,0,1);x=k.subtract(h.sv3d.get(),k.scale(h.sv3d.get(),x.vector,t),u);return k.dot(x,x)};a.fromPoints=function(x,u,t=e()){k.copy(t.origin,x);k.subtract(t.vector,u,x);return t};a.fromValues=d;a.pointAt=function(x,u,t){return k.add(t,x.origin,k.scale(t,x.vector,u))};a.projectPoint=function(x,u,t){return f(x,u,0,1,t)};a.projectPointClamp=
f;a.wrap=g;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/vectorStacks":function(){define(["exports","../../core/VectorStack"],function(a,b){const n=b.VectorStack.createVec2f64(),k=b.VectorStack.createVec3f64(),p=b.VectorStack.createVec4f64(),h=b.VectorStack.createMat3f64(),e=b.VectorStack.createMat4f64();b=b.VectorStack.createQuatf64();a.sm3d=h;a.sm4d=e;a.sq4d=b;a.sv2d=n;a.sv3d=k;a.sv4d=p;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/VectorStack":function(){define("exports ./has ./nextTick ./libs/gl-matrix-2/factories/mat3f64 ./libs/gl-matrix-2/factories/mat4f64 ./libs/gl-matrix-2/factories/quatf64 ./libs/gl-matrix-2/factories/vec2f64 ./libs/gl-matrix-2/factories/vec3f64 ./libs/gl-matrix-2/factories/vec4f64".split(" "),
function(a,b,n,k,p,h,e,g,d){class f{constructor(c){this._create=c;this._items=[];this._itemsPtr=0}get(){0===this._itemsPtr&&n.nextTick(()=>this._reset());this._itemsPtr>=this._items.length&&this._items.push(this._create());return this._items[this._itemsPtr++]}_reset(){const c=2*this._itemsPtr;this._items.length>c&&(this._items.length=c);this._itemsPtr=0}static createVec2f64(){return new f(e.create)}static createVec3f64(){return new f(g.create)}static createVec4f64(){return new f(d.create)}static createMat3f64(){return new f(k.create)}static createMat4f64(){return new f(p.create)}static createQuatf64(){return new f(h.create)}get test(){}}
a.VectorStack=f;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/libs/gl-matrix-2/factories/vec2f64":function(){define(["exports"],function(a){function b(){return[0,0]}function n(t){return[t[0],t[1]]}function k(t,m){return[t,m]}function p(t,m=[0,0]){const q=Math.min(2,t.length);for(let r=0;r<q;++r)m[r]=t[r];return m}function h(t,m){return new Float64Array(t,m,2)}function e(){return[0,0]}function g(){return[1,1]}function d(){return[1,0]}function f(){return[0,1]}const c=[0,
0],l=[1,1],w=[1,0],x=[0,1],u=Object.freeze(Object.defineProperty({__proto__:null,ONES:l,UNIT_X:w,UNIT_Y:x,ZEROS:c,clone:n,create:b,createView:h,fromArray:p,fromValues:k,ones:g,unitX:d,unitY:f,zeros:e},Symbol.toStringTag,{value:"Module"}));a.ONES=l;a.UNIT_X=w;a.UNIT_Y=x;a.ZEROS=c;a.clone=n;a.create=b;a.createView=h;a.fromArray=p;a.fromValues=k;a.ones=g;a.unitX=d;a.unitY=f;a.vec2f64=u;a.zeros=e;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/plane":function(){define("exports ../../core/mathUtils ../../chunks/vec32 ../../core/libs/gl-matrix-2/factories/vec3f64 ../../chunks/vec42 ./vector ./vectorStacks ../../views/3d/support/mathUtils".split(" "),
function(a,b,n,k,p,h,e,g){function d(F=C){return[F[0],F[1],F[2],F[3]]}function f(F,G){return c(G[0],G[1],G[2],G[3],F)}function c(F,G,D,I,J=d()){J[0]=F;J[1]=G;J[2]=D;J[3]=I;return J}function l(F,G,D){var I=G[0]*G[0]+G[1]*G[1]+G[2]*G[2];I=1E-5<Math.abs(I-1)&&1E-12<I?1/Math.sqrt(I):1;D[0]=G[0]*I;D[1]=G[1]*I;D[2]=G[2]*I;D[3]=-(D[0]*F[0]+D[1]*F[1]+D[2]*F[2]);return D}function w(F,G,D,I=d()){var J=D[0]-G[0],N=D[1]-G[1],M=D[2]-G[2];D=F[0]-G[0];const Q=F[1]-G[1],O=F[2]-G[2];G=N*O-M*Q;M=M*D-J*O;J=J*Q-N*D;
N=G*G+M*M+J*J;N=1E-5<Math.abs(N-1)&&1E-12<N?1/Math.sqrt(N):1;I[0]=G*N;I[1]=M*N;I[2]=J*N;I[3]=-(I[0]*F[0]+I[1]*F[1]+I[2]*F[2]);return I}function x(F,G,D,I=0,J=Math.floor(1/3*D),N=Math.floor(2/3*D)){if(3>D)return!1;G(v,I);let M=J,Q=!1;for(;M<D-1&&!Q;)G(y,M),M++,Q=!n.exactEquals(v,y);if(!Q)return!1;M=Math.max(M,N);for(Q=!1;M<D&&!Q;)G(B,M),M++,n.subtract(z,v,y),n.normalize(z,z),n.subtract(A,y,B),n.normalize(A,A),Q=!n.exactEquals(v,B)&&!n.exactEquals(y,B)&&.99619469809>Math.abs(n.dot(z,A));if(!Q)return 0===
I&&1===J&&2===N?!1:x(F,G,D,0,1,2);w(v,y,B,F);return!0}function u(F,G,D){F=n.scale(e.sv3d.get(),F,n.dot(F,G));n.subtract(D,G,F);return D}function t(F,G){return n.dot(F,G)+F[3]}function m(F){return F===a.IntersectResult.INTERSECTS_INSIDE_OUT||F===a.IntersectResult.INTERSECTS_OUTSIDE_IN}function q(F,G,D,I,J){var N=n.dot(F,D);F=t(F,G);if(0===N)return 0<=F?a.IntersectResult.INSIDE:a.IntersectResult.OUTSIDE;N=-F/N;I&a.IntersectFlags.CLAMP&&(N=b.clamp(N,0,1));if(!(I&a.IntersectFlags.INFINITE_MIN)&&0>N||
!(I&a.IntersectFlags.INFINITE_MAX)&&1<N)return 0<=F?a.IntersectResult.INSIDE:a.IntersectResult.OUTSIDE;n.add(J,G,n.scale(J,D,N));return 0<=F?a.IntersectResult.INTERSECTS_INSIDE_OUT:a.IntersectResult.INTERSECTS_OUTSIDE_IN}const r=p.exactEquals;p=p.equals;const v=k.create(),y=k.create(),B=k.create(),z=k.create(),A=k.create();a.IntersectResult=void 0;(function(F){F[F.INTERSECTS_INSIDE_OUT=0]="INTERSECTS_INSIDE_OUT";F[F.INTERSECTS_OUTSIDE_IN=1]="INTERSECTS_OUTSIDE_IN";F[F.INSIDE=2]="INSIDE";F[F.OUTSIDE=
3]="OUTSIDE"})(a.IntersectResult||(a.IntersectResult={}));const C=[0,0,1,0];a.IntersectFlags=void 0;(function(F){F[F.NONE=0]="NONE";F[F.CLAMP=1]="CLAMP";F[F.INFINITE_MIN=4]="INFINITE_MIN";F[F.INFINITE_MAX=8]="INFINITE_MAX"})(a.IntersectFlags||(a.IntersectFlags={}));const H=a.IntersectFlags.INFINITE_MIN|a.IntersectFlags.INFINITE_MAX,E=a.IntersectFlags.INFINITE_MAX;a.clip=function(F,G){const D=n.dot(F,G.ray.direction);F=-t(F,G.ray.origin);if(0>F&&0<=D)return!1;if(-1E-6<D&&1E-6>D)return 0<F;if((0>F||
0>D)&&!(0>F&&0>D))return!0;F/=D;0<D?F<G.c1&&(G.c1=F):F>G.c0&&(G.c0=F);return G.c0<=G.c1};a.clipInfinite=function(F,G){const D=n.dot(F,G.ray.direction);F=-t(F,G.ray.origin);if(-1E-6<D&&1E-6>D)return 0<F;F/=D;0<D?F<G.c1&&(G.c1=F):F>G.c0&&(G.c0=F);return G.c0<=G.c1};a.copy=f;a.create=d;a.distance=function(F,G){return Math.abs(t(F,G))};a.equals=p;a.exactEquals=r;a.fromArray=function(F,G,D=!0){const I=G.length/3;return x(F,(J,N)=>n.set(J,G[3*N],G[3*N+1],G[3*N+2]),D?I-1:I)};a.fromManyPoints=x;a.fromNormalAndOffset=
function(F,G,D){n.copy(D,F);D[3]=G;return D};a.fromPoints=w;a.fromPositionAndNormal=l;a.fromValues=c;a.fromVectorsAndPoint=function(F,G,D,I){n.cross(B,G,F);return l(D,B,I)};a.getNormal=function(F){return F};a.intersectLine=function(F,G,D,I){D=n.subtract(e.sv3d.get(),D,G);return m(q(F,G,D,H,I))};a.intersectLineOrRay=q;a.intersectLineSegment=function(F,G,D){return m(q(F,G.origin,G.vector,a.IntersectFlags.NONE,D))};a.intersectLineSegmentClamp=function(F,G,D){return m(q(F,G.origin,G.vector,a.IntersectFlags.CLAMP,
D))};a.intersectRay=function(F,G,D){return null!=G?m(q(F,G.origin,G.direction,E,D)):!1};a.isPointInside=function(F,G){return 0<=t(F,G)};a.negate=function(F,G){G[0]=-F[0];G[1]=-F[1];G[2]=-F[2];G[3]=-F[3];return G};a.projectPoint=function(F,G,D){const I=n.scale(e.sv3d.get(),F,-F[3]);G=n.subtract(e.sv3d.get(),G,I);F=u(F,G,e.sv3d.get());n.add(D,F,I);return D};a.projectPointLocal=function(F,G,D,I){var J=e.sv3d.get(),N=e.sv3d.get();g.tangentFrame(F,J,N);G=n.subtract(e.sv3d.get(),D,G);J=h.projectPointSignedLength(J,
G);N=h.projectPointSignedLength(N,G);F=h.projectPointSignedLength(F,G);return n.set(I,J,N,F)};a.projectVector=u;a.setOffsetFromPoint=function(F,G,D){G!==F&&f(F,G);F[3]=-n.dot(F,D);return F};a.signedDistance=t;a.up=C;a.wrap=function(F=C[0],G=C[1],D=C[2],I=C[3]){return c(F,G,D,I,e.sv4d.get())};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/vector":function(){define(["exports","../../core/mathUtils","../../chunks/vec32","../../core/libs/gl-matrix-2/factories/vec3f64"],
function(a,b,n,k){const p=k.create(),h=k.create();a.angle=function(e,g){e=n.dot(e,g)/(n.length(e)*n.length(g));return-b.acosClamped(e)};a.angleAroundAxis=function(e,g,d){n.normalize(p,e);n.normalize(h,g);e=n.dot(p,h);e=b.acosClamped(e);g=n.cross(p,p,h);return 0>n.dot(g,d)?2*Math.PI-e:e};a.projectPoint=function(e,g,d){g=n.dot(e,g)/n.dot(e,e);return n.scale(d,e,g)};a.projectPointSignedLength=function(e,g){return n.dot(e,g)/n.length(e)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/support/mathUtils":function(){define(["exports","../../../core/mathUtils","../../../chunks/vec32","../../../core/libs/gl-matrix-2/factories/vec3f64"],function(a,b,n,k){const p=k.create(),h=k.create(),e=k.create(),g=k.create(),d=k.create();a.angle=function(f,c,l){f=n.normalize(g,f);c=n.normalize(d,c);const w=b.acosClamped(n.dot(f,c));return l&&(f=n.cross(e,f,c),0>n.dot(f,l))?-w:w};a.bilerp=function(f,c,l,w,x,u){f+=(c-f)*x;return f+(l+(w-l)*x-f)*u};a.cosCapped=function(f,c){return f>
c?Math.cos(c):Math.cos(f)};a.fovx2fovy=function(f,c,l){return 2*Math.atan(l*Math.tan(.5*f)/c)};a.fovy2fovx=function(f,c,l){return 2*Math.atan(c*Math.tan(.5*f)/l)};a.makeOrthonormal=function(f,c,l){l=l||f;const w=n.dot(f,c);n.set(l,f[0]-w*c[0],f[1]-w*c[1],f[2]-w*c[2]);n.normalize(l,l)};a.makePiecewiseLinearFunction=function(f){const c=f.length;return l=>{if(l<=f[0][0])return f[0][1];if(l>=f[c-1][0])return f[c-1][1];let w=1;for(;l>f[w][0];)w++;const x=f[w][0];l=(x-l)/(x-f[w-1][0]);return l*f[w-1][1]+
(1-l)*f[w][1]}};a.maxScale=function(f){return Math.sqrt(Math.max(f[0]*f[0]+f[4]*f[4]+f[8]*f[8],f[1]*f[1]+f[5]*f[5]+f[9]*f[9],f[2]*f[2]+f[6]*f[6]+f[10]*f[10]))};a.midpoint3d=function(f,c){n.set(c,0,0,0);if(0<f.length){for(let l=0;l<f.length;++l)n.add(c,c,f[l]);n.scale(c,c,1/f.length)}};a.planeFromPoints=function(f,c,l,w){n.subtract(p,c,f);n.subtract(h,l,f);n.cross(w,p,h);n.normalize(w,w);w[3]=-n.dot(f,w)};a.scaleFromMatrix=function(f,c){n.set(f,Math.sqrt(c[0]*c[0]+c[4]*c[4]+c[8]*c[8]),Math.sqrt(c[1]*
c[1]+c[5]*c[5]+c[9]*c[9]),Math.sqrt(c[2]*c[2]+c[6]*c[6]+c[10]*c[10]));return f};a.slerp=function(f,c,l,w=k.create()){const x=n.length(f);var u=n.length(c),t=n.dot(f,c)/(x*u);if(.9999999999999999>t){t=Math.acos(t);const m=((1-l)*x+l*u)/Math.sin(t);u=m/u*Math.sin(l*t);n.scale(g,f,m/x*Math.sin((1-l)*t));n.scale(d,c,u);return n.add(w,g,d)}return n.lerp(w,f,c,l)};a.slerpTangent=function(f,c,l,w=k.create(),x=k.create()){const u=n.length(f),t=n.length(c);var m=n.dot(f,c)/(u*t);if(.9999999999999999>m){m=
Math.acos(m);const q=Math.sin(m),r=Math.sin(l*m),v=Math.sin((1-l)*m),y=(1-l)*u+l*t,B=y/q,z=B/t*r;n.scale(g,f,B/u*v);n.scale(d,c,z);n.add(w,g,d);n.scale(g,f,1/u*(-Math.cos((1-l)*m)*m*y+v*(-u+t)));n.scale(d,c,1/t*(Math.cos(l*m)*m*y+r*(-u+t)));n.add(x,g,d);n.scale(x,x,1/q);return x}n.lerp(w,f,c,l);n.subtract(x,c,f);n.normalize(x,x);return x};a.tangentFrame=function(f,c,l){Math.abs(f[0])>Math.abs(f[1])?n.set(c,0,1,0):n.set(c,1,0,0);n.cross(l,f,c);n.cross(c,l,f);n.normalize(l,l);n.normalize(c,c)};Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/ray":function(){define("exports ../../core/arrayUtils ../../core/ObjectStack ../../core/libs/gl-matrix-2/math/mat3 ../../core/libs/gl-matrix-2/factories/mat3f64 ../../chunks/vec32 ../../core/libs/gl-matrix-2/factories/vec3f64 ./vectorStacks".split(" "),function(a,b,n,k,p,h,e,g){function d(m){return m?f(e.clone(m.origin),e.clone(m.direction)):f(e.create(),e.create())}function f(m,q){return{origin:m,direction:q}}function c(m,q,r=d()){h.copy(r.origin,
m);h.copy(r.direction,q);return r}const l=new n.ObjectStack(()=>d()),w=e.create(),x=e.create(),u=e.create(),t=p.create();a.closestPoint=function(m,q,r){q=h.dot(m.direction,h.subtract(r,q,m.origin));h.add(r,m.origin,h.scale(r,m.direction,q));return r};a.closestPoints=function(m,q,r,v){const y=m.origin,B=q.origin;m=m.direction;q=q.direction;var z=h.dot(h.normalize(x,m),h.normalize(u,q));if(1<=Math.abs(z))return null;var A=h.cross(x,m,q);z=h.sub(w,B,y);A=k.set(t,m[0],m[1],m[2],-q[0],-q[1],-q[2],A[0],
A[1],A[2]);const C=k.invert(t,A);if(null==C)return[r,v];A=h.dot(h.set(x,C[0],C[3],C[6]),z);z=h.dot(h.set(u,C[1],C[4],C[7]),z);h.add(r,y,h.scale(w,m,A));h.add(v,B,h.scale(w,q,z));return[r,v]};a.copy=function(m,q=d()){return c(m.origin,m.direction,q)};a.create=d;a.distance2=function(m,q){m=h.cross(g.sv3d.get(),h.normalize(g.sv3d.get(),m.direction),h.subtract(g.sv3d.get(),q,m.origin));return h.dot(m,m)};a.equals=function(m,q){return b.equals(m.origin,q.origin)&&b.equals(m.direction,q.direction)};a.fromPoints=
function(m,q,r=d()){h.copy(r.origin,m);h.subtract(r.direction,q,m);return r};a.fromValues=c;a.wrap=function(m,q){const r=l.get();r.origin=m;r.direction=q;return r};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/libs/gl-matrix-2/math/mat3":function(){define(["exports","./common"],function(a,b){function n(M,Q){M[0]=Q[0];M[1]=Q[1];M[2]=Q[2];M[3]=Q[4];M[4]=Q[5];M[5]=Q[6];M[6]=Q[8];M[7]=Q[9];M[8]=Q[10];return M}function k(M,Q){M[0]=Q[0];M[1]=Q[1];M[2]=Q[2];M[3]=Q[3];M[4]=Q[4];
M[5]=Q[5];M[6]=Q[6];M[7]=Q[7];M[8]=Q[8];return M}function p(M,Q,O,K,L,P,R,W,V,ba){M[0]=Q;M[1]=O;M[2]=K;M[3]=L;M[4]=P;M[5]=R;M[6]=W;M[7]=V;M[8]=ba;return M}function h(M){M[0]=1;M[1]=0;M[2]=0;M[3]=0;M[4]=1;M[5]=0;M[6]=0;M[7]=0;M[8]=1;return M}function e(M,Q){if(M===Q){const O=Q[1],K=Q[2],L=Q[5];M[1]=Q[3];M[2]=Q[6];M[3]=O;M[5]=Q[7];M[6]=K;M[7]=L}else M[0]=Q[0],M[1]=Q[3],M[2]=Q[6],M[3]=Q[1],M[4]=Q[4],M[5]=Q[7],M[6]=Q[2],M[7]=Q[5],M[8]=Q[8];return M}function g(M,Q){const O=Q[0],K=Q[1],L=Q[2],P=Q[3],R=
Q[4],W=Q[5],V=Q[6],ba=Q[7];Q=Q[8];const U=Q*R-W*ba,da=-Q*P+W*V,fa=ba*P-R*V;let ha=O*U+K*da+L*fa;if(!ha)return null;ha=1/ha;M[0]=U*ha;M[1]=(-Q*K+L*ba)*ha;M[2]=(W*K-L*R)*ha;M[3]=da*ha;M[4]=(Q*O-L*V)*ha;M[5]=(-W*O+L*P)*ha;M[6]=fa*ha;M[7]=(-ba*O+K*V)*ha;M[8]=(R*O-K*P)*ha;return M}function d(M,Q){const O=Q[0],K=Q[1],L=Q[2],P=Q[3],R=Q[4],W=Q[5],V=Q[6],ba=Q[7];Q=Q[8];M[0]=R*Q-W*ba;M[1]=L*ba-K*Q;M[2]=K*W-L*R;M[3]=W*V-P*Q;M[4]=O*Q-L*V;M[5]=L*P-O*W;M[6]=P*ba-R*V;M[7]=K*V-O*ba;M[8]=O*R-K*P;return M}function f(M){const Q=
M[3],O=M[4],K=M[5],L=M[6],P=M[7],R=M[8];return M[0]*(R*O-K*P)+M[1]*(-R*Q+K*L)+M[2]*(P*Q-O*L)}function c(M,Q,O){const K=Q[0],L=Q[1],P=Q[2],R=Q[3],W=Q[4],V=Q[5],ba=Q[6],U=Q[7];Q=Q[8];const da=O[0],fa=O[1],ha=O[2],T=O[3],S=O[4],Z=O[5],ia=O[6],Y=O[7];O=O[8];M[0]=da*K+fa*R+ha*ba;M[1]=da*L+fa*W+ha*U;M[2]=da*P+fa*V+ha*Q;M[3]=T*K+S*R+Z*ba;M[4]=T*L+S*W+Z*U;M[5]=T*P+S*V+Z*Q;M[6]=ia*K+Y*R+O*ba;M[7]=ia*L+Y*W+O*U;M[8]=ia*P+Y*V+O*Q;return M}function l(M,Q,O){const K=Q[0],L=Q[1],P=Q[2],R=Q[3],W=Q[4],V=Q[5],ba=Q[6],
U=Q[7];Q=Q[8];const da=O[0];O=O[1];M[0]=K;M[1]=L;M[2]=P;M[3]=R;M[4]=W;M[5]=V;M[6]=da*K+O*R+ba;M[7]=da*L+O*W+U;M[8]=da*P+O*V+Q;return M}function w(M,Q,O){const K=Q[0],L=Q[1],P=Q[2],R=Q[3],W=Q[4],V=Q[5],ba=Q[6],U=Q[7];Q=Q[8];const da=Math.sin(O);O=Math.cos(O);M[0]=O*K+da*R;M[1]=O*L+da*W;M[2]=O*P+da*V;M[3]=O*R-da*K;M[4]=O*W-da*L;M[5]=O*V-da*P;M[6]=ba;M[7]=U;M[8]=Q;return M}function x(M,Q,O){const K=O[0],L=O[1];O=O[2];M[0]=K*Q[0];M[1]=K*Q[1];M[2]=K*Q[2];M[3]=L*Q[3];M[4]=L*Q[4];M[5]=L*Q[5];M[6]=O*Q[6];
M[7]=O*Q[7];M[8]=O*Q[8];return M}function u(M,Q,O){const K=O[0];O=O[1];M[0]=K*Q[0];M[1]=K*Q[1];M[2]=K*Q[2];M[3]=O*Q[3];M[4]=O*Q[4];M[5]=O*Q[5];return M}function t(M,Q){M[0]=1;M[1]=0;M[2]=0;M[3]=0;M[4]=1;M[5]=0;M[6]=Q[0];M[7]=Q[1];M[8]=1;return M}function m(M,Q){const O=Math.sin(Q);Q=Math.cos(Q);M[0]=Q;M[1]=O;M[2]=0;M[3]=-O;M[4]=Q;M[5]=0;M[6]=0;M[7]=0;M[8]=1;return M}function q(M,Q){M[0]=Q[0];M[1]=0;M[2]=0;M[3]=0;M[4]=Q[1];M[5]=0;M[6]=0;M[7]=0;M[8]=1;return M}function r(M,Q){M[0]=Q[0];M[1]=Q[1];M[2]=
0;M[3]=Q[2];M[4]=Q[3];M[5]=0;M[6]=Q[4];M[7]=Q[5];M[8]=1;return M}function v(M,Q){var O=Q[0],K=Q[1],L=Q[2];Q=Q[3];var P=O+O,R=K+K;const W=L+L;O*=P;const V=K*P;K*=R;const ba=L*P,U=L*R;L*=W;P*=Q;R*=Q;Q*=W;M[0]=1-K-L;M[3]=V-Q;M[6]=ba+R;M[1]=V+Q;M[4]=1-O-L;M[7]=U-P;M[2]=ba-R;M[5]=U+P;M[8]=1-O-K;return M}function y(M,Q){const O=Q[0],K=Q[1],L=Q[2],P=Q[4],R=Q[5],W=Q[6],V=Q[8],ba=Q[9];Q=Q[10];const U=Q*R-W*ba,da=-Q*P+W*V,fa=ba*P-R*V;var ha=O*U+K*da+L*fa;if(!ha)return null;ha=1/ha;M[0]=U*ha;M[1]=(-Q*K+L*ba)*
ha;M[2]=(W*K-L*R)*ha;M[3]=da*ha;M[4]=(Q*O-L*V)*ha;M[5]=(-W*O+L*P)*ha;M[6]=fa*ha;M[7]=(-ba*O+K*V)*ha;M[8]=(R*O-K*P)*ha;return M}function B(M,Q){const O=Q[0],K=Q[1],L=Q[2],P=Q[3],R=Q[4],W=Q[5],V=Q[6],ba=Q[7];var U=Q[8],da=Q[9],fa=Q[10],ha=Q[11];const T=Q[12],S=Q[13],Z=Q[14];Q=Q[15];const ia=O*W-K*R,Y=O*V-L*R,ea=O*ba-P*R,ka=K*V-L*W,ja=K*ba-P*W,X=L*ba-P*V,aa=U*S-da*T,pa=U*Z-fa*T;U=U*Q-ha*T;const la=da*Z-fa*S;da=da*Q-ha*S;fa=fa*Q-ha*Z;ha=ia*fa-Y*da+ea*la+ka*U-ja*pa+X*aa;if(!ha)return null;ha=1/ha;M[0]=
(W*fa-V*da+ba*la)*ha;M[1]=(V*U-R*fa-ba*pa)*ha;M[2]=(R*da-W*U+ba*aa)*ha;M[3]=(L*da-K*fa-P*la)*ha;M[4]=(O*fa-L*U+P*pa)*ha;M[5]=(K*U-O*da-P*aa)*ha;M[6]=(S*X-Z*ja+Q*ka)*ha;M[7]=(Z*ea-T*X-Q*Y)*ha;M[8]=(T*ja-S*ea+Q*ia)*ha;return M}function z(M,Q,O){M[0]=2/Q;M[1]=0;M[2]=0;M[3]=0;M[4]=-2/O;M[5]=0;M[6]=-1;M[7]=1;M[8]=1;return M}function A(M){return"mat3("+M[0]+", "+M[1]+", "+M[2]+", "+M[3]+", "+M[4]+", "+M[5]+", "+M[6]+", "+M[7]+", "+M[8]+")"}function C(M){return Math.sqrt(M[0]**2+M[1]**2+M[2]**2+M[3]**2+
M[4]**2+M[5]**2+M[6]**2+M[7]**2+M[8]**2)}function H(M,Q,O){M[0]=Q[0]+O[0];M[1]=Q[1]+O[1];M[2]=Q[2]+O[2];M[3]=Q[3]+O[3];M[4]=Q[4]+O[4];M[5]=Q[5]+O[5];M[6]=Q[6]+O[6];M[7]=Q[7]+O[7];M[8]=Q[8]+O[8];return M}function E(M,Q,O){M[0]=Q[0]-O[0];M[1]=Q[1]-O[1];M[2]=Q[2]-O[2];M[3]=Q[3]-O[3];M[4]=Q[4]-O[4];M[5]=Q[5]-O[5];M[6]=Q[6]-O[6];M[7]=Q[7]-O[7];M[8]=Q[8]-O[8];return M}function F(M,Q,O){M[0]=Q[0]*O;M[1]=Q[1]*O;M[2]=Q[2]*O;M[3]=Q[3]*O;M[4]=Q[4]*O;M[5]=Q[5]*O;M[6]=Q[6]*O;M[7]=Q[7]*O;M[8]=Q[8]*O;return M}function G(M,
Q,O,K){M[0]=Q[0]+O[0]*K;M[1]=Q[1]+O[1]*K;M[2]=Q[2]+O[2]*K;M[3]=Q[3]+O[3]*K;M[4]=Q[4]+O[4]*K;M[5]=Q[5]+O[5]*K;M[6]=Q[6]+O[6]*K;M[7]=Q[7]+O[7]*K;M[8]=Q[8]+O[8]*K;return M}function D(M,Q){return M[0]===Q[0]&&M[1]===Q[1]&&M[2]===Q[2]&&M[3]===Q[3]&&M[4]===Q[4]&&M[5]===Q[5]&&M[6]===Q[6]&&M[7]===Q[7]&&M[8]===Q[8]}function I(M,Q){const O=M[0],K=M[1],L=M[2],P=M[3],R=M[4],W=M[5],V=M[6],ba=M[7];M=M[8];const U=Q[0],da=Q[1],fa=Q[2],ha=Q[3],T=Q[4],S=Q[5],Z=Q[6],ia=Q[7];Q=Q[8];const Y=b.getEpsilon();return Math.abs(O-
U)<=Y*Math.max(1,Math.abs(O),Math.abs(U))&&Math.abs(K-da)<=Y*Math.max(1,Math.abs(K),Math.abs(da))&&Math.abs(L-fa)<=Y*Math.max(1,Math.abs(L),Math.abs(fa))&&Math.abs(P-ha)<=Y*Math.max(1,Math.abs(P),Math.abs(ha))&&Math.abs(R-T)<=Y*Math.max(1,Math.abs(R),Math.abs(T))&&Math.abs(W-S)<=Y*Math.max(1,Math.abs(W),Math.abs(S))&&Math.abs(V-Z)<=Y*Math.max(1,Math.abs(V),Math.abs(Z))&&Math.abs(ba-ia)<=Y*Math.max(1,Math.abs(ba),Math.abs(ia))&&Math.abs(M-Q)<=Y*Math.max(1,Math.abs(M),Math.abs(Q))}function J(M){const Q=
b.getEpsilon(),O=M[0],K=M[1],L=M[2],P=M[3],R=M[4],W=M[5],V=M[6],ba=M[7];M=M[8];return Math.abs(1-(O*O+P*P+V*V))<=Q&&Math.abs(1-(K*K+R*R+ba*ba))<=Q&&Math.abs(1-(L*L+W*W+M*M))<=Q}const N=Object.freeze(Object.defineProperty({__proto__:null,add:H,adjoint:d,copy:k,determinant:f,equals:I,exactEquals:D,frob:C,fromMat2d:r,fromMat4:n,fromQuat:v,fromRotation:m,fromScaling:q,fromTranslation:t,identity:h,invert:g,isOrthoNormal:J,mul:c,multiply:c,multiplyScalar:F,multiplyScalarAndAdd:G,normalFromMat4:B,normalFromMat4Legacy:y,
projection:z,rotate:w,scale:x,scaleByVec2:u,set:p,str:A,sub:E,subtract:E,translate:l,transpose:e},Symbol.toStringTag,{value:"Module"}));a.add=H;a.adjoint=d;a.copy=k;a.determinant=f;a.equals=I;a.exactEquals=D;a.frob=C;a.fromMat2d=r;a.fromMat4=n;a.fromQuat=v;a.fromRotation=m;a.fromScaling=q;a.fromTranslation=t;a.identity=h;a.invert=g;a.isOrthoNormal=J;a.mat3=N;a.mul=c;a.multiply=c;a.multiplyScalar=F;a.multiplyScalarAndAdd=G;a.normalFromMat4=B;a.normalFromMat4Legacy=y;a.projection=z;a.rotate=w;a.scale=
x;a.scaleByVec2=u;a.set=p;a.str=A;a.sub=E;a.subtract=E;a.translate=l;a.transpose=e;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/coordinateSystem":function(){define("exports ../../core/libs/gl-matrix-2/math/mat4 ../../chunks/vec32 ../../core/libs/gl-matrix-2/factories/vec3f64 ../ellipsoidUtils ../SpatialReference ../spatialReferenceEllipsoidUtils ./Axis ../../chunks/boundedPlane ../../chunks/sphere".split(" "),function(a,b,n,k,p,h,e,g,d,f){function c(m){return{operations:m,
value:m.create()}}function l(m,q,r=c(m)){r.operations=m;m.copy(q,r.value);return r}function w(m,q,r,v){return m.operations.setAltitudeAt(m.value,q,r,v)}const x=2**50,u=k.create(),t=k.create();a.altitudeAt=function(m,q){return m.operations.altitudeAt(m.value,q)};a.axisAt=function(m,q,r,v){return m.operations.axisAt(m.value,q,r,v)};a.closestPoint=function(m,q,r){return m.operations.closestPoint(m.value,q,r)};a.closestPointOnSilhouette=function(m,q,r){return m.operations.closestPointOnSilhouette(m.value,
q,r)};a.coordinateSystemFromOneAxisAndNormalVector=function(m,q,r,v,y){n.copy(r,m);n.copy(t,q);n.normalize(t,t);n.cross(v,t,r);n.cross(y,v,r)};a.create=function(m){const {value:q,operations:r}=m;return{operations:r,value:r.create(q)}};a.createFromOperations=c;a.createGlobal=function(m){return l(f.sphere,f.fromValues(0,0,0,p.getReferenceEllipsoid(m).radius))};a.createLocal=function(){return l(d.boundedPlane,d.fromValues([0,0,0],[x,0,0],[0,x,0]))};a.distanceToSilhouette=function(m,q){return m.operations.distanceToSilhouette(m.value,
q)};a.elevate=function(m,q,r){return m.operations.elevate(m.value,q,r.value)};a.fromValues=l;a.getExtent=function(m,q){m.operations.getExtent(m.value,q);return q};a.intersectRay=function(m,q,r){return m.operations.intersectRay(m.value,q,r)};a.intersectRayClosestSilhouette=function(m,q,r){return m.operations.intersectRayClosestSilhouette(m.value,q,r)};a.normalAt=function(m,q,r){return m.operations.axisAt(m.value,q,g.Axis.Z,r)};a.renderSRFromViewSR=function(m,q){return m?e.getSphericalPCPF(q):q.isGeographic?
h.PlateCarree:q};a.setAltitudeAt=w;a.setAltitudeOfTransformation=function(m,q,r,v){q!==v&&b.copy(v,q);n.set(u,v[12],v[13],v[14]);w(m,u,r,u);v[12]=u[0];v[13]=u[1];v[14]=u[2];return v};a.setExtent=function(m,q,r){m.operations.setExtent(m.value,q,r.value);return r};a.vectorCoordinates=function(m,q,r,v,y){y[0]=n.dot(m,q);y[1]=n.dot(m,r);y[2]=n.dot(m,v);return y};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/spatialReferenceEllipsoidUtils":function(){define(["exports",
"./ellipsoidUtils","./SpatialReference","./support/spatialReferenceUtils"],function(a,b,n,k){const p=new n(b.SphericalECEFSpatialReferenceLike),h=new n(b.SphericalPCPFMarsLike),e=new n(b.SphericalPCPFMoonLike);b=new n(b.WGS84ECEFSpatialReferenceLike);const g=new Map,d=h.wkt.toUpperCase(),f=e.wkt.toUpperCase();a.SphericalECEFSpatialReference=p;a.SphericalPCPFMars=h;a.SphericalPCPFMoon=e;a.WGS84ECEFSpatialReference=b;a.getSphericalPCPF=function(c){var l=g.get(c);if(l)return l;l=p;if(c)if(c===h)l=h;
else if(c===e)l=e;else{var w=c.wkid;const x=c.latestWkid;if(null!=w||null!=x)if(k.isWKIDFromMars(w)||k.isWKIDFromMars(x))l=h;else{if(k.isWKIDFromMoon(w)||k.isWKIDFromMoon(x))l=e}else if(w=c.wkt2??c.wkt)w=w.toUpperCase(),w===d?l=h:w===f&&(l=e)}g.set(c,l);return l};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/sphere":function(){define("exports ../core/has ../core/Logger ../core/mathUtils ../core/libs/gl-matrix-2/math/mat4 ./vec32 ../core/libs/gl-matrix-2/factories/vec3f64 ./vec42 ../core/libs/gl-matrix-2/factories/vec4f64 ../core/libs/gl-matrix-2/math/common ../geometry/support/Axis ../geometry/support/ray ../geometry/support/sphereUtils ../geometry/support/vector ../geometry/support/vectorStacks".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w,x,u){function t(){return d.create()}function m(ia,Y){return g.copy(Y,ia)}function q(ia,Y){return d.fromValues(ia[0],ia[1],ia[2],Y)}function r(ia){return ia}function v(ia){ia[0]=ia[1]=ia[2]=ia[3]=0}function y(ia,Y){ia[0]=ia[1]=ia[2]=0;ia[3]=Y;return ia}function B(ia){return ia[3]}function z(ia){return ia}function A(ia,Y,ea,ka){return d.fromValues(ia,Y,ea,ka)}function C(ia,Y,ea){ia!==ea&&(ea[0]=ia[0],ea[1]=ia[1],ea[2]=ia[2]);ea[3]=ia[3]+Y;return ea}function H(ia,Y,
ea){ia!==ea&&m(ia,ea);return ea}function E(ia,Y){return Y}function F(ia,Y,ea){if(null==Y||!D(ia,Y,da))return!1;let {t0:ka,t1:ja}=da;if(0>ka||ja<ka&&0<ja)ka=ja;if(0>ka)return!1;if(ea){const {origin:X,direction:aa}=Y;ea[0]=X[0]+aa[0]*ka;ea[1]=X[1]+aa[1]*ka;ea[2]=X[2]+aa[2]*ka}return!0}function G(ia,Y,ea){Y=l.fromPoints(Y,ea);if(!D(ia,Y,da))return[];const {origin:ka,direction:ja}=Y,{t0:X,t1:aa}=da;Y=pa=>{const la=e.create();h.scaleAndAdd(la,ka,ja,pa);return O(ia,la,la)};return Math.abs(X-aa)<f.getEpsilon()?
[Y(X)]:[Y(X),Y(aa)]}function D(ia,Y,ea){const {origin:ka,direction:ja}=Y,X=fa;X[0]=ka[0]-ia[0];X[1]=ka[1]-ia[1];X[2]=ka[2]-ia[2];Y=ja[0]*ja[0]+ja[1]*ja[1]+ja[2]*ja[2];if(0===Y)return!1;const aa=2*(ja[0]*X[0]+ja[1]*X[1]+ja[2]*X[2]);ia=aa*aa-4*Y*(X[0]*X[0]+X[1]*X[1]+X[2]*X[2]-ia[3]*ia[3]);if(0>ia)return!1;ia=Math.sqrt(ia);ea.t0=(-aa-ia)/(2*Y);ea.t1=(-aa+ia)/(2*Y);return!0}function I(ia,Y){return F(ia,Y,null)}function J(ia,Y,ea){if(F(ia,Y,ea))return ea;ia=N(ia,Y,u.sv3d.get());h.add(ea,Y.origin,h.scale(u.sv3d.get(),
Y.direction,h.distance(Y.origin,ia)/h.length(Y.direction)));return ea}function N(ia,Y,ea){const ka=u.sv3d.get(),ja=u.sm4d.get();h.cross(ka,Y.origin,Y.direction);const X=ia[3];h.cross(ea,ka,Y.origin);h.scale(ea,ea,1/h.length(ea)*X);ia=L(ia,Y.origin);Y=x.angle(Y.origin,ea);p.fromRotation(ja,Y+ia,ka);h.transformMat4(ea,ea,ja);return ea}function M(ia,Y,ea,ka){ia=ia[3];var ja=ia*ia;Y+=.5*Math.PI;const X=ea*ea+ja-2*Math.cos(Y)*ea*ia;ea=Math.sqrt(X);ja=X-ja;return 0>=ja?.5:Math.min(1,(Math.acos(Math.sqrt(ja)/
ea)-Math.asin(ia/(ea/Math.sin(Y)))+.5*ka)/ka)}function Q(ia,Y,ea){if(F(ia,Y,ea))return ea;l.closestPoint(Y,ia,ea);return O(ia,ea,ea)}function O(ia,Y,ea){Y=h.subtract(u.sv3d.get(),Y,ia);Y=h.scale(u.sv3d.get(),Y,ia[3]/h.length(Y));return h.add(ea,Y,ia)}function K(ia,Y){Y=h.subtract(u.sv3d.get(),Y,ia);Y=h.squaredLength(Y);return Math.sqrt(Math.abs(Y-ia[3]*ia[3]))}function L(ia,Y){Y=h.subtract(u.sv3d.get(),Y,ia);Y=h.length(Y);ia=ia[3];return k.acosClamped(ia/(ia+Math.abs(ia-Y)))}function P(ia,Y,ea,ka){ia=
h.subtract(ha,Y,ia);switch(ea){case c.Axis.X:return ea=w.cartesianToSpherical(ia,ha)[2],h.set(ka,-Math.sin(ea),Math.cos(ea),0);case c.Axis.Y:return ia=w.cartesianToSpherical(ia,ha),ea=ia[1],ia=ia[2],Y=Math.sin(ea),h.set(ka,-Y*Math.cos(ia),-Y*Math.sin(ia),Math.cos(ea));case c.Axis.Z:return h.normalize(ka,ia)}}function R(ia,Y){Y=h.subtract(T,Y,ia);return h.length(Y)-ia[3]}function W(ia,Y,ea,ka){const ja=R(ia,Y);ia=P(ia,Y,c.Axis.Z,T);ea=h.scale(T,ia,ea-ja);return h.add(ka,Y,ea)}function V(ia,Y){Y=h.squaredDistance(ia,
Y);ia=ia[3];return Y<=ia*ia}function ba(ia,Y,ea=d.create()){const ka=h.distance(ia,Y),ja=ia[3],X=Y[3];if(ka+X<ja)return g.copy(ea,ia),ea;if(ka+ja<X)return g.copy(ea,Y),ea;h.lerp(ea,ia,Y,(ka+X-ja)/(2*ka));ea[3]=(ka+ja+X)/2;return ea}b=t();const U=n=g.equals,da={t0:0,t1:0},fa=e.create(),ha=e.create(),T=e.create(),S=t(),Z=Object.freeze(Object.defineProperty({__proto__:null,NullSphere:b,altitudeAt:R,angleToSilhouette:L,axisAt:P,cameraFrustumCoverage:M,clear:v,closestPoint:Q,closestPointOnSilhouette:N,
containsPoint:V,copy:m,create:t,distanceToSilhouette:K,elevate:C,equals:U,exactEquals:n,fromCenterAndRadius:q,fromRadius:y,fromValues:A,getCenter:z,getExtent:E,getRadius:B,intersectLine:G,intersectRay:F,intersectRayClosestSilhouette:J,intersectsRay:I,projectPoint:O,setAltitudeAt:W,setExtent:H,tmpSphere:S,union:ba,wrap:r},Symbol.toStringTag,{value:"Module"}));a.NullSphere=b;a.altitudeAt=R;a.angleToSilhouette=L;a.axisAt=P;a.cameraFrustumCoverage=M;a.clear=v;a.closestPoint=Q;a.closestPointOnSilhouette=
N;a.containsPoint=V;a.copy=m;a.create=t;a.distanceToSilhouette=K;a.elevate=C;a.equals=U;a.exactEquals=n;a.fromCenterAndRadius=q;a.fromRadius=y;a.fromValues=A;a.getCenter=z;a.getExtent=E;a.getRadius=B;a.intersectLine=G;a.intersectRay=F;a.intersectRayClosestSilhouette=J;a.intersectsRay=I;a.projectPoint=O;a.setAltitudeAt=W;a.setExtent=H;a.sphere=Z;a.tmpSphere=S;a.union=ba;a.wrap=r})},"esri/geometry/support/sphereUtils":function(){define(["exports","../../core/mathUtils","../../chunks/vec32"],function(a,
b,n){a.cartesianToSpherical=function(k,p){const h=n.length(k),e=b.asinClamped(k[2]/h);n.set(p,h,e,Math.atan2(k[1]/h,k[0]/h));return p};a.sphericalToCartesian=function(k,p){const h=k[0],e=k[1];k=k[2];const g=Math.cos(e);n.set(p,h*g*Math.cos(k),h*g*Math.sin(k),h*Math.sin(e))};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/scaleUtils":function(){define(["exports","../../core/mathUtils","../../core/unitUtils"],function(a,b,n){function k(p,h){h=n.getMetersPerUnitForSR(h);
return p/(h*n.inchesPerMeter*96)}a.getExtentForScale=function(p,h){const e=p.extent;p=p.width-(p.padding?p.padding.left+p.padding.right:0);h=k(h,e.spatialReference);return e.clone().expand(h*p/e.width)};a.getResolutionForScale=k;a.getResolutionInMetersForScale=function(p){return p/(96*n.inchesPerMeter)};a.getScale=function(p,h){h=h||p.extent;p=p.width;const e=n.getMetersPerUnitForSR(h?.spatialReference);return h&&p?h.width/p*e*n.inchesPerMeter*96:0};a.getScaleForResolution=function(p,h){h=n.getMetersPerUnitForSR(h);
return p*h*n.inchesPerMeter*96};a.isInScaleRange=function(p,h,e){if(h=0===h||b.floatEqualAbsolute(p,h)||p<h)h=0===e||b.floatEqualAbsolute(p,e)||p>e;return h};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/BreakpointsOwner":function(){define("exports ../chunks/tslib.es6 ../core/ArrayPool ../core/reactiveUtils ../core/accessorSupport/decorators/property ../core/has ../core/Logger ../core/RandomLCG ../core/accessorSupport/decorators/subclass".split(" "),function(a,b,n,k,
p,h,e,g,d){function f(w,x){return x?c[w].valueToClassName[x].split(" "):[]}const c={widthBreakpoint:{getValue(w){const x=w.viewSize[0];w=w.breakpoints;const u=this.values;return x<=w.xsmall?u.xsmall:x<=w.small?u.small:x<=w.medium?u.medium:x<=w.large?u.large:u.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-width-xsmall esri-view-width-less-than-small esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",
small:"esri-view-width-small esri-view-width-greater-than-xsmall esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",medium:"esri-view-width-medium esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-less-than-large esri-view-width-less-than-xlarge",large:"esri-view-width-large esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-less-than-xlarge",
xlarge:"esri-view-width-xlarge esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-greater-than-large"}},heightBreakpoint:{getValue(w){const x=w.viewSize[1];w=w.breakpoints;const u=this.values;return x<=w.xsmall?u.xsmall:x<=w.small?u.small:x<=w.medium?u.medium:x<=w.large?u.large:u.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-height-xsmall esri-view-height-less-than-small esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",
small:"esri-view-height-small esri-view-height-greater-than-xsmall esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",medium:"esri-view-height-medium esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-less-than-large esri-view-height-less-than-xlarge",large:"esri-view-height-large esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-less-than-xlarge",
xlarge:"esri-view-height-xlarge esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-greater-than-large"}},orientation:{getValue(w){w=w.viewSize;const x=this.values;return w[1]>=w[0]?x.portrait:x.landscape},values:{portrait:"portrait",landscape:"landscape"},valueToClassName:{portrait:"esri-view-orientation-portrait",landscape:"esri-view-orientation-landscape"}}},l={xsmall:544,small:768,medium:992,large:1200};a.BreakpointsOwner=
w=>{w=class extends w{constructor(...x){super(...x);this.heightBreakpoint=this.widthBreakpoint=this.orientation=null;this.breakpoints=l}initialize(){this.addHandles(k.watch(()=>[this.breakpoints,this.size],()=>this._updateClassNames(),k.initial))}destroy(){this.destroyed||this._removeActiveClassNames()}set breakpoints(x){var u=this._get("breakpoints");x!==u&&(u=x,u&&u.xsmall<u.small&&u.small<u.medium&&u.medium<u.large||(x=JSON.stringify(l,null,2),console.warn("provided breakpoints are not valid, using defaults:"+
x),x=l),this._set("breakpoints",{...x}))}_updateClassNames(){if(this.container){var x=n.acquire(),u=n.acquire(),t=!1,m;for(m in c){const q=this[m],r=c[m].getValue({viewSize:this.size,breakpoints:this.breakpoints});q!==r&&(t=!0,this[m]=r,f(m,q).forEach(v=>u.push(v)),f(m,r).forEach(v=>x.push(v)))}t&&(this._applyClassNameChanges(x,u),n.release(x),n.release(u))}}_applyClassNameChanges(x,u){const t=this.container;t&&(u.forEach(m=>t.classList.remove(m)),x.forEach(m=>t.classList.add(m)))}_removeActiveClassNames(){const x=
this.container;if(x)for(var u in c)f(u,this[u]).forEach(t=>x.classList.remove(t))}};b.__decorate([p.property()],w.prototype,"breakpoints",null);b.__decorate([p.property()],w.prototype,"orientation",void 0);b.__decorate([p.property()],w.prototype,"widthBreakpoint",void 0);b.__decorate([p.property()],w.prototype,"heightBreakpoint",void 0);return w=b.__decorate([d.subclass("esri.views.BreakpointsOwner")],w)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/DOMContainer":function(){define("exports ../chunks/tslib.es6 ../core/domUtils ../core/events ../core/Logger ../core/maybe ../core/reactiveUtils ../core/scheduling ../core/accessorSupport/decorators/property ../core/has ../core/RandomLCG ../core/accessorSupport/decorators/subclass ./overlay/ViewOverlay".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w){function x(t){t&&(t.textContent="",t.parentNode&&t.parentNode.removeChild(t))}const u=[0,0];a.DOMContainer=t=>{t=class extends t{constructor(...m){super(...m);this._freqInfo={freq:16,time:750};this._overlayRenderTaskHandle=null;this.height=0;this.position=this.overlay=this.messagesCommon=null;this.resizing=!1;this.surface=this.root=null;this.suspended=!0;this.userContent=this.ui=null;this.width=0;this.widthBreakpoint=null;this.addHandles([e.watch(()=>this.cursor,
q=>{const {surface:r}=this;r&&r.setAttribute("data-cursor",q)}),e.watch(()=>this.navigating,q=>{const {surface:r}=this;r&&r.setAttribute("data-navigating",q.toString())})])}initialize(){this.addHandles([e.watch(()=>this.ui,(m,q)=>this._handleUIChange(m,q),e.initial),this.on("focus",()=>this.notifyChange("focused")),this.on("blur",()=>this.notifyChange("focused"))])}destroy(){this.destroyed||(this.ui=h.destroyMaybe(this.ui),this.container=null)}get container(){return this._get("container")??null}set container(m){var q=
this._get("container");const r=n.byId(m);r||"string"!==typeof m||p.getLogger(this).error("#container",`element with id '${m}' not found`);if(q!==r)if(this._stopMeasuring(),q&&(q.classList.remove("esri-view"),this._overlayRenderTaskHandle&&(this._overlayRenderTaskHandle.remove(),this._overlayRenderTaskHandle=null),this.overlay&&(this.overlay.destroy(),this._set("overlay",null)),this.root&&(x(this.root),this._set("root",null)),this.userContent&&(n.reparent(this.userContent,q),x(this.userContent),this._set("userContent",
null))),r){r.classList.add("esri-view");m=document.createElement("div");m.className="esri-view-user-storage";n.reparent(r,m);r.appendChild(m);this._set("userContent",m);m=document.createElement("div");m.className="esri-view-root";r.insertBefore(m,r.firstChild);this._set("root",m);q=document.createElement("div");q.className="esri-view-surface";q.setAttribute("role","application");q.tabIndex=0;m.appendChild(q);this._set("surface",q);var v=new w;m.appendChild(v.surface);this._set("overlay",v);this.addHandles(e.watch(()=>
v.needsRender,y=>{this._overlayRenderTaskHandle=y&&!this._overlayRenderTaskHandle?g.addFrameTask({render:()=>this.overlay?.render()}):h.removeMaybe(this._overlayRenderTaskHandle)}));this.forceDOMReadyCycle();this._set("container",r);this._startMeasuring()}else this._set("width",0),this._set("height",0),this._set("position",null),this._set("suspended",!0),this._set("surface",null),this._set("container",null)}get focused(){const m=document.activeElement===this.surface;return document.hasFocus()&&m}get size(){return[this.width,
this.height]}blur(){this.surface?.blur()}focus(){this.surface?.focus()}pageToContainer(m,q,r){const v=this.position;m-=v?v[0]:0;q-=v?v[1]:0;r?(r[0]=m,r[1]=q):r=[m,q];return r}containerToPage(m,q,r){const v=this.position;m+=v?v[0]:0;q+=v?v[1]:0;r?(r[0]=m,r[1]=q):r=[m,q];return r}_handleUIChange(m,q){this.removeHandles("ui");q&&q!==m&&q.destroy();m&&(m.view=this,this.addHandles(e.watch(()=>this.root,r=>{if(r){const v=document.createElement("div");r.appendChild(v);r=v}else r=null;m.container=r},e.initial),
"ui"));this._set("ui",m)}_stopMeasuring(){this.removeHandles("measuring");this._get("resizing")&&this._set("resizing",!1)}_startMeasuring(){const m=this._freqInfo;m.freq=16;m.time=750;this.addHandles([k.on(window,"resize",()=>{m.freq=16;m.time=750}),g.addFrameTask({prepare:q=>{const r=this._measure(),v=this._freqInfo;v.time+=q.deltaTime;r&&(v.freq=16,this._get("resizing")||this._set("resizing",!0));v.time<v.freq||(v.time=0,this._position()||r?v.freq=16:v.freq=Math.min(750,2*v.freq),!r&&512<=v.freq&&
this._get("resizing")&&this._set("resizing",!1))}})],"measuring");this._measure();this._position()}_measure(){var m=this.container;const q=m?m.clientWidth:0;m=m?m.clientHeight:0;if(0===q||0===m)return this.suspended||this._set("suspended",!0),!1;const r=this.width,v=this.height;if(q===r&&m===v)return this.suspended&&this._set("suspended",!1),!1;this._set("width",q);this._set("height",m);this.suspended&&this._set("suspended",!1);this.emit("resize",{oldWidth:r,oldHeight:v,width:q,height:m});return!0}_position(){var m=
this.container;const q=this.position;var r;if(r=m)r=(m.ownerDocument||window.document).defaultView,m=m.getBoundingClientRect(),u[0]=m.left+(r?.pageXOffset??0),u[1]=m.top+(r?.pageYOffset??0),r=u;m=r;return m?q&&m[0]===q[0]&&m[1]===q[1]?!1:(this._set("position",[m[0],m[1]]),!0):!1}forceDOMReadyCycle(){}};b.__decorate([d.property()],t.prototype,"container",null);b.__decorate([d.property({readOnly:!0})],t.prototype,"focused",null);b.__decorate([d.property({readOnly:!0})],t.prototype,"height",void 0);
b.__decorate([d.property()],t.prototype,"messagesCommon",void 0);b.__decorate([d.property({type:w})],t.prototype,"overlay",void 0);b.__decorate([d.property({readOnly:!0})],t.prototype,"position",void 0);b.__decorate([d.property({readOnly:!0})],t.prototype,"resizing",void 0);b.__decorate([d.property({readOnly:!0})],t.prototype,"root",void 0);b.__decorate([d.property({value:null,readOnly:!0})],t.prototype,"size",null);b.__decorate([d.property({readOnly:!0})],t.prototype,"surface",void 0);b.__decorate([d.property({readOnly:!0})],
t.prototype,"suspended",void 0);b.__decorate([d.property()],t.prototype,"ui",void 0);b.__decorate([d.property({readOnly:!0})],t.prototype,"userContent",void 0);b.__decorate([d.property({readOnly:!0})],t.prototype,"width",void 0);b.__decorate([d.property()],t.prototype,"widthBreakpoint",void 0);return t=b.__decorate([l.subclass("esri.views.DOMContainer")],t)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/overlay/ViewOverlay":function(){define("../../chunks/tslib.es6 ../../core/Accessor ../../core/Collection ../../core/accessorSupport/decorators/property ../../core/has ../../core/Logger ../../core/RandomLCG ../../core/accessorSupport/decorators/subclass ../../core/support/UpdatingHandles ../../libs/maquette/projection ../../libs/maquette/projector".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c){b=class extends b{constructor(){super(...arguments);this.items=new n;this._watchUpdatingTracking=new d.UpdatingHandles;this._callbacks=new Map;this._projector=c.createProjector();this._hiddenProjector=c.createProjector()}get needsRender(){return 0<this.items.length}get updating(){return this._watchUpdatingTracking?.updating??!1}initialize(){const l=document.createElement("div");l.className="esri-overlay-surface";this._set("surface",l);this._hiddenSurface=document.createElement("div");
this._hiddenSurface.setAttribute("style","visibility: hidden;");l.appendChild(this._hiddenSurface);this._watchUpdatingTracking.addOnCollectionChange(()=>this.items,w=>{for(const x of w.added){const u=()=>x.render();this._callbacks.set(x,u);this._projector.append(this.surface,u)}for(const x of w.removed)w=this._projector.detach(this._callbacks.get(x)),this.surface.removeChild(w.domNode),this._callbacks.delete(x)})}addItem(l){this.items.add(l)}removeItem(l){this.items.remove(l)}destroy(){this.items.removeAll();
this._callbacks.forEach(l=>this._projector.detach(l));this._projector=this._callbacks=null;this._watchUpdatingTracking.destroy()}render(){this._projector.renderNow()}computeBoundingRect(l){const w=this._hiddenSurface,x=this._hiddenProjector;let u;const t=()=>u=l.render();x.append(w,t);x.renderNow();const m={left:0,top:0,right:0,bottom:0};if(u?.domNode){const q=u.domNode.getBoundingClientRect();m.left=q.left;m.top=q.top;m.right=q.right;m.bottom=q.bottom}for(x.detach(t);w.firstChild;)w.removeChild(w.firstChild);
return m}overlaps(l,w){l=this.computeBoundingRect(l);w=this.computeBoundingRect(w);return Math.max(l.left,w.left)<=Math.min(l.right,w.right)&&Math.max(l.top,w.top)<=Math.min(l.bottom,w.bottom)}get hasVisibleItems(){return this.items.some(l=>l.visible)}async prepare(){await document.fonts.load(this._fontString()).catch(()=>{})}renderCanvas(l,w){const x=!!w?.disableDecorations;if(this.items.some(t=>t.visible&&!(x&&t.isDecoration))){var u=l.getContext("2d");u.save();u.font=this._fontString();this.items.forEach(t=>
{x&&t.isDecoration||(u.save(),t.renderCanvas(u),u.restore())});u.restore()}}_fontString(){return`10px ${getComputedStyle(this.surface).fontFamily}`}};a.__decorate([k.property({readOnly:!0})],b.prototype,"surface",void 0);a.__decorate([k.property({readOnly:!0})],b.prototype,"items",void 0);a.__decorate([k.property({readOnly:!0})],b.prototype,"needsRender",null);a.__decorate([k.property({readOnly:!0})],b.prototype,"_watchUpdatingTracking",void 0);a.__decorate([k.property({readOnly:!0})],b.prototype,
"updating",null);return b=a.__decorate([g.subclass("esri.views.overlay.ViewOverlay")],b)})},"esri/views/GroundView":function(){define("../chunks/tslib.es6 ../core/Accessor ../core/Collection ../core/reactiveUtils ../core/accessorSupport/decorators/property ../core/has ../core/Logger ../core/RandomLCG ../core/accessorSupport/decorators/subclass ./3d/support/cameraUtils ./support/GroundViewElevationSampler".split(" "),function(a,b,n,k,p,h,e,g,d,f,c){b=class extends b{constructor(l){super(l);this.view=
null;this.layerViews=new n}initialize(){this.addHandles(k.when(()=>this.view?.map?.ground,l=>l.load()));this.addHandles(this.layerViews.on("after-changes",()=>this._layerViewsAfterChangesHandler()))}destroy(){this._set("view",null);for(const l of this.layerViews)l.destroy();this.layerViews.length=0}get elevationSampler(){return this.view&&"2d"!==this.view.type&&this.view.ready&&this.view.basemapTerrain&&this.view.basemapTerrain.ready?new c({view:this.view}):null}get extent(){const l=this.view;return l&&
"2d"!==l.type&&l.ready?f.toExtent(l,l.state.camera,l.pointsOfInterest.centerOnSurfaceFrequent.renderLocation):null}get updating(){return this.suspended?!1:this.layerViews.some(l=>l.updating)}get suspended(){return!this.view||this.view.suspended}_layerViewsAfterChangesHandler(){this.removeHandles("updating");this.addHandles(this.layerViews.map(l=>k.watch(()=>l.updating,()=>this._updateUpdating(),k.sync)).toArray(),"updating");this._updateUpdating()}_updateUpdating(){this.notifyChange("updating")}};
a.__decorate([p.property({readOnly:!0})],b.prototype,"elevationSampler",null);a.__decorate([p.property({readOnly:!0})],b.prototype,"extent",null);a.__decorate([p.property({type:Boolean,readOnly:!0})],b.prototype,"updating",null);a.__decorate([p.property({constructOnly:!0})],b.prototype,"view",void 0);a.__decorate([p.property({type:n,readOnly:!0})],b.prototype,"layerViews",void 0);a.__decorate([p.property({readOnly:!0})],b.prototype,"suspended",null);return b=a.__decorate([d.subclass("esri.views.GroundView")],
b)})},"esri/views/3d/support/cameraUtils":function(){define("exports ../../../Camera ../../../core/Cyclical ../../../core/Logger ../../../core/mathUtils ../../../core/promiseUtils ../../../chunks/vec32 ../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../geometry/ellipsoidUtils ../../../geometry/Point ../../../geometry/projection ../../../geometry/SpatialReference ../../../geometry/projection/projectPointToVector ../../../geometry/projection/projectVectorToPoint ../../../geometry/projection/projectVectorToVector ../../ViewingMode ../camera/intersectionUtils ../../../chunks/cameraUtilsPlanar ../../../chunks/cameraUtilsSpherical ./earthUtils ./ElevationProvider ../../support/spatialReferenceSupport".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w,x,u,t,m,q,r,v,y,B){function z(X){return X.spatialReference??l.WGS84}function A({state:X}){return X.isGlobal?r.cameraUtilsSpherical:q.cameraUtilsPlanar}function C(X,aa){if(null==aa)return null;var pa=X.renderSpatialReference;const la=A(X).headingTiltToDirectionUp,na=g.create();if(!w.projectPointToVector(aa.position,na,pa))return null;pa=la(na,aa.heading,aa.tilt);e.scale(pa.direction,pa.direction,X.state.camera.distance);e.add(pa.direction,pa.direction,na);X=m.cameraOnContentAlongViewDirection(X,
na,pa.direction,pa.up);X.fov=p.deg2rad(aa.fov);X.row=aa.layout.row;X.rows=aa.layout.rows;X.column=aa.layout.column;X.columns=aa.layout.columns;return X}function H(X,aa){const {camera:pa}=X.state;({unitInMeters:X}=X.renderCoordsHelper);const la=pa.width/2/pa.pixelRatio;aa/=X;return la/(96*39.37/aa)/Math.tan(pa.fovX/2)}function E(X,aa){const {camera:pa}=X.state;({unitInMeters:X}=X.renderCoordsHelper);return Z/(pa.width/2/pa.pixelRatio/(aa*Math.tan(pa.fovX/2)))*X}function F(X,aa,pa,la){aa=la.levelAtScale(aa);
X=N(X,pa.eye,pa.viewForward,pa.up).tilt;return la.scaleAtLevel(Math.max(aa-2*((90<X?180-X:X)/90)**2,0))}function G(X,aa,pa){X=pa.levelAtScale(X);return pa.scaleAtLevel(X+2*((90<aa?180-aa:aa)/90)**2)}function D(X,aa,pa){const la=X.basemapTerrain?.tilingScheme;if(!la)return 0;null==pa&&(pa=((pa=X.pointsOfInterest?.cameraOnSurface?.renderLocation)&&X.renderCoordsHelper?.getAltitude(pa))??0);var na=d.getReferenceEllipsoid(X.spatialReference).radius;na=X.state.viewingMode===t.ViewingMode.Local?aa.eye[2]:
e.length(aa.eye)-na;pa=E(X,Math.abs(na-pa));return F(X,pa,aa,la)}function I(X,aa,pa){return(aa=C(X,aa))?D(X,aa,pa):0}async function J(X,aa,pa,la,na,qa){aa=await P(X,la.heading,la.tilt,aa,pa,na,qa);h.throwIfAborted(qa);return T(X,aa,la.fov,qa)}function N(X,aa,pa,la,na){return A(X).directionToHeadingTilt(aa,pa,la,na)}function M(X,aa){return!!(X.basemapTerrain&&X.renderCoordsHelper.fromRenderCoords(aa,Y,X.spatialReference)&&X.elevationProvider&&(y.getElevationAtPoint(X.elevationProvider,Y)??0)>Y[2]-
1)}async function Q(X,aa,pa){if(M(X,aa))return!0;const {elevationProvider:la,spatialReference:na,renderCoordsHelper:qa}=X;if(null==la||!qa.fromRenderCoords(aa,Y,na))return!1;const [sa,xa,ta]=Y;X=await la.queryElevation(sa,xa,ta,na,"ground",pa)??0;h.throwIfAborted(pa);return X>ta-1}async function O(X,aa,pa){const la=g.create();if(null==aa)return e.copy(la,X.state.camera.center);if(aa instanceof f){const {renderSpatialReference:na,basemapTerrain:qa,elevationProvider:sa}=X,xa=aa.spatialReference;await w.projectPointToVectorAsync(aa,
la,na,0,{signal:pa});h.throwIfAborted(pa);null==aa.z&&null!=qa&&null!=sa&&(aa=await sa.queryElevation(aa.x,aa.y,aa.z??0,xa,"ground",pa),h.throwIfAborted(pa),null!=aa&&X.renderCoordsHelper.setAltitude(la,aa));return la}return e.copy(la,aa)}function K(X,aa){const pa=g.create();if(null==aa)return e.copy(pa,X.state.camera.center);if(aa instanceof f){if(!w.projectPointToVector(aa,pa,X.renderSpatialReference))return null;const {basemapTerrain:la,elevationProvider:na}=X;null==aa.z&&null!=la&&null!=na&&(aa=
y.getElevationAtPoint(na,aa),null!=aa&&X.renderCoordsHelper.setAltitude(pa,aa));return pa}return e.copy(pa,aa)}function L(X,aa,pa,la,na,qa){const sa=la instanceof f?la:null;la=K(X,la);return R(X,aa,pa,sa,la,na,qa)}async function P(X,aa,pa,la,na,qa,sa){const xa=la instanceof f?la:null;la=await O(X,la,sa);h.throwIfAborted(sa);return W(X,aa,pa,xa,la,na,qa,sa)}function R(X,aa,pa,la,na,qa,sa){if(null==na||!la&&(la=new f({spatialReference:z(X)}),!x.projectVectorToPoint(na,X.renderSpatialReference,la)))return null;
const xa=V(X,aa,pa,na,qa,sa);if(ba(X,pa,sa)&&M(X,xa.eye)){const {tilt:ta,mode:Ba}=U(X,pa,na,qa);return R(X,aa,ta,la,na,qa,Ba)}return{...xa,center:g.clone(na)}}async function W(X,aa,pa,la,na,qa,sa,xa){la||(la=new f({spatialReference:z(X)}),await x.projectVectorToPointAsync(na,X.renderSpatialReference,la,{signal:xa})||(la=null));h.throwIfAborted(xa);const ta=V(X,aa,pa,na,qa,sa);if(ba(X,pa,sa)&&await Q(X,ta.eye,xa)){h.throwIfAborted(xa);const {tilt:Ba,mode:Ia}=U(X,pa,na,qa);return W(X,aa,Ba,la,na,qa,
Ia,xa)}return{...ta,center:g.clone(na)}}function V(X,aa,pa,la,na,qa){na=Math.max(na,X.state.constraints.minimumPoiDistance);var sa=pa;pa=na;let xa=0;if(qa=qa===a.OrientationMode.ADJUST)qa=X.pointsOfInterest.centerOnSurfaceFrequent.distance,qa=8<Math.log(pa/qa)/Math.LN2?!0:5<e.distance(la,X.pointsOfInterest.centerOnSurfaceFrequent.renderLocation)/(Math.tan(.5*X.state.camera.fov)*qa);qa?(aa=0,sa=A(X).eyeTiltToLookAtTilt(sa,la,pa),X.state.constraints.tilt?(qa=X.state.constraints.tilt(pa),qa.max=Math.min(qa.max,
.5*Math.PI),xa=Math.min(sa,qa.min*(1-.7)+.7*qa.max)):xa=sa):xa=A(X).eyeTiltToLookAtTilt(sa,la,pa);sa=xa=X.state.constraints.clampTilt(pa,xa);pa=sa=A(X).lookAtTiltToEyeTilt(sa,la,pa);X=A(X).eyeForCenterWithHeadingTilt;return X(la,na,aa,pa)}function ba(X,aa,pa){const la=X.map.ground.navigationConstraint;return pa===a.OrientationMode.ADJUST&&X.state.isGlobal&&0<aa&&(null==la||"stay-above"===la.type)}function U(X,aa,pa,la){{let qa=A(X).eyeTiltToLookAtTilt(aa,pa,la);if(X.state.constraints.tilt){var na=
X.state.constraints.tilt(la);qa=Math.min(qa,.5*Math.PI);na=na.min*(1-.7)+.7*qa}else na=qa}X=A(X).lookAtTiltToEyeTilt(na,pa,la);return{tilt:X,mode:1>aa-X?a.OrientationMode.LOCKED:a.OrientationMode.ADJUST}}function da(X,aa){const {state:pa,spatialReference:la}=X;X=aa.spatialReference;return pa.isGlobal&&B.isSpatialReferenceSupported(X,t.ViewingMode.Global)||pa.isLocal&&la.equals(X)}function fa(X,aa){let pa;if(X.state.isGlobal){const qa=new f(aa.xmin,aa.ymin,aa.spatialReference),sa=new f(aa.xmax,aa.ymax,
aa.spatialReference),xa=aa.spatialReference.isGeographic?ka:ea;var la=new f({x:xa.center(qa.x,sa.x),y:(sa.y+qa.y)/2,z:null!=aa.zmax&&null!=aa.zmin?(aa.zmax+aa.zmin)/2:void 0,spatialReference:aa.spatialReference});const ta=d.getReferenceEllipsoid(aa.spatialReference);var na=v.getGreatCircleSpanAt(la,qa,sa);pa=na.lon;na=na.lat;xa.diff(qa.x,sa.x)>xa.range/2&&(pa+=ta.halfCircumference);pa=Math.min(pa,ta.halfCircumference);na=Math.min(na,ta.halfCircumference)}else la=X.renderSpatialReference??aa.spatialReference,
la.equals(aa.spatialReference)||(aa=c.project(aa,la)),pa=aa.xmax-aa.xmin,na=aa.ymax-aa.ymin,la=new f({x:aa.xmin+.5*pa,y:aa.ymin+.5*na,z:null!=aa.zmax&&null!=aa.zmin?(aa.zmax+aa.zmin)/2:void 0,spatialReference:la});X=X.state.camera;return{center:la,distance:Math.max(1/Math.tan(X.fovX/2)*pa*.5,1/Math.tan(X.fovY/2)*na*.5,1/Math.tan(X.fov/2)*(null!=aa.zmax&&null!=aa.zmin?aa.zmax-aa.zmin:0)*.5)/1}}function ha(X,aa,pa,la){if(null==aa)return null;const na=X.renderSpatialReference;X=new f({spatialReference:z(X)});
if(!x.projectVectorToPoint(aa.eye,na,X))return null;la??=new b;la.position=X;la.heading=aa.heading;la.tilt=aa.tilt;la.fov=pa;return la}async function T(X,aa,pa,la){const na=X.renderSpatialReference;X=new f({spatialReference:z(X)});await x.projectVectorToPointAsync(aa.eye,na,X,{signal:la});h.throwIfAborted(la);return new b(X,aa.heading,aa.tilt,pa)}const S=()=>k.getLogger("esri.views.3d.support.cameraUtils"),Z=96*39.37,ia={heading:0,tilt:0},Y=g.create(),ea=new n.Cyclical(-2.0037508342788905E7,2.0037508342788905E7),
ka=new n.Cyclical(-180,180);a.OrientationMode=void 0;(function(X){X[X.LOCKED=0]="LOCKED";X[X.ADJUST=1]="ADJUST"})(a.OrientationMode||(a.OrientationMode={}));const ja=g.create();a.applyTiltAdjustToScale=F;a.directionToHeadingTilt=N;a.distanceToScale=E;a.externalCameraToScale=I;a.externalToInternal=C;a.fromCenterDistanceAsync=J;a.fromCenterDistanceSync=function(X,aa,pa,la,na,qa){aa=L(X,la.heading,la.tilt,aa,pa,na);return ha(X,aa,la.fov,qa)};a.fromCenterScale=async function(X,aa,pa,la,na,qa){pa=H(X,
pa);return J(X,aa,pa,la,na,qa)};a.fromExtentAsync=async function(X,aa,pa,la,na,qa){aa=da(X,aa)?aa:await c.projectWithZConversion(aa,X.spatialReference,{signal:qa});h.throwIfAborted(qa);const {center:sa,distance:xa}=fa(X,aa);pa=await P(X,pa,la,sa,xa,na,qa);h.throwIfAborted(qa);return T(X,pa,X.camera.fov,qa)};a.fromExtentSync=function(X,aa,pa,la,na,qa){let sa;try{sa=da(X,aa)?aa:c.project(aa,X.spatialReference)}catch(Ba){return null}const {center:xa,distance:ta}=fa(X,sa);aa=L(X,pa,la,xa,ta,na);return null==
aa?null:ha(X,aa,X.camera.fov,qa)};a.getObserverForPointAtDistanceAsync=P;a.getObserverForPointAtDistanceSync=L;a.getViewSR=z;a.headingTiltToDirectionUp=function(X,aa,pa,la,na){return A(X).headingTiltToDirectionUp(aa,pa,la,na)};a.internalCameraToScale=D;a.internalToExternal=function(X,aa,pa){const la=X.renderSpatialReference,na=N(X,aa.eye,aa.viewForward,aa.up,ia);X=z(X);u.projectVectorToVector(aa.eye,la,ja,X)||(X=l.WGS84,u.projectVectorToVector(aa.eye,la,ja,X));null==pa?pa=new b(new f(ja,X),na.heading,
na.tilt,p.rad2deg(aa.fov)):(pa.position.x=ja[0],pa.position.y=ja[1],pa.position.z=ja[2],pa.position.spatialReference=X,pa.heading=na.heading,pa.tilt=na.tilt,pa.fov=p.rad2deg(aa.fov));pa.layout.row=aa.row;pa.layout.rows=aa.rows;pa.layout.column=aa.column;pa.layout.columns=aa.columns;return pa};a.removeTiltAdjustFromScale=G;a.scaleErrorThreshold=1;a.scaleToDistance=H;a.scaleToTargetDistance=function(X,aa,pa,la,na){if(0===aa)return 0;var qa=e.distance(pa.eye,la);const sa=X.basemapTerrain?.tilingScheme;
if(!sa)return S().error("#scaleToTargetDistance()","Cannot compute distance from scale without a tiling scheme"),qa;var xa=qa;const ta=N(X,pa.eye,pa.viewForward,pa.up),Ba=90<ta.tilt;if(X.state.viewingMode===t.ViewingMode.Local)aa=G(aa,ta.tilt,sa),X=(H(X,aa)-Math.abs(pa.eye[2]-na[2]))/Math.cos(p.deg2rad(ta.tilt)),xa=Ba?xa-X:xa+X;else{var Ia=Infinity;let Ha=0;qa=L(X,ta.heading,ta.tilt,la,qa,a.OrientationMode.ADJUST);if(!qa)return xa;for(na=e.length(na);1<Ia&&100>Ha;){Ia=e.length(qa.eye);var Ca=p.deg2rad(Ba?
180-qa.tilt:qa.tilt);xa=Math.sin(Ca)*Ia;Ia*=Math.cos(Ca);Ca=G(aa,qa.tilt,sa);Ca=H(X,Ca);Ca=Ba?na-Ca:na+Ca;xa=p.asinClamped(xa/Ca);xa=Math.cos(xa)*Ca-Ia;qa=e.distance(qa.eye,la);xa=Ba?qa-xa:qa+xa;qa=L(X,ta.heading,ta.tilt,la,xa,a.OrientationMode.ADJUST);Ia=ha(X,qa,p.rad2deg(pa.fov));if(!qa||!Ia)break;Ca=d.getReferenceEllipsoid(X.spatialReference).radius;Ia=I(X,Ia,na-Ca);Ia=Math.abs(aa-Ia);++Ha}}return xa};a.scaleToZoom=function(X,aa){if(X=X.basemapTerrain?.tilingScheme)return X.levelAtScale(aa);S().error("#scaleToZoom()",
"Cannot compute zoom from scale without a tiling scheme")};a.toArea=function(X,aa){return A(X).toArea(X,aa)};a.toExtent=function(X,aa,pa){var la=X.renderSpatialReference;const na=new f({spatialReference:z(X)});if(!x.projectVectorToPoint(pa,la,na))return null;const qa=Math.tan(aa.fovX/2);la=Math.tan(aa.fovY/2);aa=e.dist(aa.eye,pa);pa=2*aa*qa;la*=2*aa;return A(X).toExtent(X,na,pa,la)};a.zoomToScale=function(X,aa){if(X=X.basemapTerrain?.tilingScheme)return X.scaleAtLevel(aa);S().error("#zoomToScale()",
"Cannot compute scale from zoom without a tiling scheme")};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/projection/projectVectorToPoint":function(){define(["exports","../../core/libs/gl-matrix-2/factories/vec3f64","../projection","./projectVectorToVector"],function(a,b,n,k){function p(e,g,d){if(!k.projectVectorToVector(e,g,h,d.spatialReference))return!1;d.x=h[0];d.y=h[1];d.z=h[2];return!0}const h=b.create();a.projectVectorToPoint=p;a.projectVectorToPointAsync=async function(e,
g,d,f){await n.initializeProjection(g,d.spatialReference,null,f);return p(e,g,d)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/projection/projectVectorToVector":function(){define(["exports","../projection","../SpatialReference","./projectPointToVector","../../layers/graphics/dehydratedPoint"],function(a,b,n,k,p){function h(g,d,f,c,l){if(null==d||null==c||2>g.length)return!1;e.x=g[0];e.y=g[1];e.z=g[2];e.spatialReference=d;return k.projectPointToVector(e,f,c,l)}const e=
p.makeDehydratedPoint(0,0,0,n.WGS84);a.projectVectorToVector=h;a.projectVectorToVectorAsync=async function(g,d,f,c,l,w){await b.initializeProjection(d,c,null,w);return h(g,d,f,c,l)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/dehydratedPoint":function(){define(["exports"],function(a){a.makeDehydratedPoint=function(b,n,k,p){return{x:b,y:n,z:k,hasZ:null!=k,hasM:!1,spatialReference:p,type:"point"}};a.setDehydratedPoint=function(b,n,k,p,h){b.x=n;b.y=k;b.z=p;b.hasZ=
null!=p;b.spatialReference=h};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/camera/intersectionUtils":function(){define("exports ../../../chunks/vec32 ../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../geometry/ellipsoidUtils ../../../geometry/support/aaBoundingRect ../webgl-engine/lib/Intersector".split(" "),function(a,b,n,k,p,h){function e(x,u){return x.elevationProvider?x.elevationProvider.getElevation(u[0],u[1],u[2],x.renderCoordsHelper.spatialReference,
"ground")??0:0}function g(x,u,t){if(!x.state.isGlobal||!x.stateManager.constraintsManager)return!1;const m=e(x,u);({far:x}=x.stateManager.constraintsManager.nearFarHeuristic.compute(u,t,x.renderDataExtent,m,w));x*=x;return b.squaredDistance(u,t)>x}const d={},f=n.create(),c=n.create(),l=n.create(),w={near:0,far:0};a.cameraOnContentAlongViewDirection=function(x,u,t,m){const q=x.state.camera.clone();u&&t&&m&&(q.eye=u,q.center=t,q.up=m);u=q.ray;t=d[x.viewingMode];t||(t=h.newIntersector(x.state.viewingMode),
t.options.backfacesTerrain=!x.state.isGlobal,t.options.invisibleTerrain=!0,d[x.viewingMode]=t);({isGlobal:m}=x.state);x.sceneIntersectionHelper.intersectRay(u,t,c)&&!g(x,u.origin,c)?u=!0:!x.renderCoordsHelper.intersectManifold(u,0,c)||g(x,u.origin,c)?m?(t=k.getReferenceEllipsoid(x.spatialReference).radius,t=b.dot(u.origin,u.origin)-t*t,b.scale(c,u.direction,(0<t?Math.sqrt(t)/3:1)/b.length(u.direction)),b.add(c,c,u.origin),u=!0):u=!1:u=!0;u||b.copy(c,q.center);t=x.state.constraints;m=t.minimumPoiDistance;
b.squaredDistance(q.eye,c)<m&&(u=t.collision.enabled,b.copy(l,q.viewForward),b.scale(l,l,m),u?q.eye=b.subtract(f,c,l):b.add(c,q.eye,l),x=x.renderCoordsHelper,m=x.getAltitude(q.eye),t=t.collision.elevationMargin,u&&m<t&&(b.subtract(l,c,q.eye),q.eye=x.setAltitude(f,t,q.eye),b.add(c,q.eye,l)));q.center=c;return q};a.eyeWithinExtent=function(x,u,t,m){return null!=x.renderCoordsHelper.fromRenderCoords(u.eye,f,m)&&p.containsPoint(t,f)};a.surfaceElevationBelowRenderLocation=e;Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/views/3d/webgl-engine/lib/Intersector":function(){define("exports ../../../../core/libs/gl-matrix-2/math/mat4 ../../../../core/libs/gl-matrix-2/factories/mat4f64 ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../chunks/vec42 ../../../../core/libs/gl-matrix-2/factories/vec4f64 ../../../../geometry/support/ray ../../../ViewingMode ./IntersectorInterfaces ./IntersectorTarget ./intersectorUtils ./verticalOffsetUtils".split(" "),function(a,
b,n,k,p,h,e,g,d,f,c,l,w){class x{constructor(v){this.options=new f.IntersectorOptions;this._results=new u;this.transform=new w.IntersectorTransform;this.tolerance=1E-5;this.verticalOffset=null;this._ray=g.create();this._rayEnd=p.create();this._rayBeginTransformed=p.create();this._rayEndTransformed=p.create();this.viewingMode=null==v?d.ViewingMode.Global:v}get results(){return this._results}get ray(){return this._ray}get rayBegin(){return this._ray.origin}get rayEnd(){return this._rayEnd}reset(v,y,
B){this.resetWithRay(g.fromPoints(v,y,this._ray),B)}resetWithRay(v,y){this.camera=y;v!==this._ray&&g.copy(v,this._ray);0!==this.options.verticalOffset?this.viewingMode===d.ViewingMode.Local?this._ray.origin[2]-=this.options.verticalOffset:this.verticalOffset=this.options.verticalOffset:this.verticalOffset=null;k.add(this._rayEnd,this._ray.origin,this._ray.direction);this._results.init(this._ray)}intersect(v=null,y,B,z,A){this.point=y;this.filterPredicate=z;this.tolerance=null==B?1E-5:B;y=w.getVerticalOffsetObject3D(this.verticalOffset);
if(v&&0<v.length){const C=A?H=>{A(H)&&this.intersectObject(H)}:H=>{this.intersectObject(H)};for(const H of v)v=H.getSpatialQueryAccelerator?.(),null!=v?(null!=y?v.forEachAlongRayWithVerticalOffset(this._ray.origin,this._ray.direction,C,y):v.forEachAlongRay(this._ray.origin,this._ray.direction,C),this.options.selectionMode&&this.options.hud&&v.forEachDegenerateObject(C)):H.objects.forAll(E=>C(E))}this.sortResults()}intersectObject(v){const y=v.geometries;if(y){var B=v.effectiveTransformation,z=w.getVerticalOffsetObject3D(this.verticalOffset);
for(const A of y){if(!A.visible)continue;const {material:C,id:H}=A;if(!C.visible)continue;this.transform.setAndInvalidateLazyTransforms(B,A.transformation);k.transformMat4(this._rayBeginTransformed,this.rayBegin,this.transform.inverse);k.transformMat4(this._rayEndTransformed,this.rayEnd,this.transform.inverse);const E=this.transform.transform;null!=z&&(z.objectTransform=this.transform);C.intersect(A,this.transform.transform,this,this._rayBeginTransformed,this._rayEndTransformed,(F,G,D,I,J,N)=>{if(0<=
F&&(null==this.filterPredicate||this.filterPredicate(this._ray.origin,this._rayEnd,F))){var M=I?this._results.hud:this._results,Q=I?O=>{const K=new c.HudTarget(v,H,D,N);O.set(f.IntersectorType.HUD,K,F,G,n.IDENTITY,J)}:O=>O.set(f.IntersectorType.OBJECT,{object:v,geometryId:H,triangleNr:D},F,G,E,J);(null==M.min.drapedLayerOrder||J>=M.min.drapedLayerOrder)&&(null==M.min.dist||F<M.min.dist)&&Q(M.min);this.options.store!==f.StoreResults.MIN&&(null==M.max.drapedLayerOrder||J<M.max.drapedLayerOrder)&&(null==
M.max.dist||F>M.max.dist)&&Q(M.max);this.options.store===f.StoreResults.ALL&&(I?(I=new m(this._ray),Q(I),this._results.hud.all.push(I)):(I=new t(this._ray),Q(I),this._results.all.push(I)))}})}}}sortResults(v=this._results.all){v.sort((y,B)=>y.dist!==B.dist?(y.dist??0)-(B.dist??0):y.drapedLayerOrder!==B.drapedLayerOrder?(B.drapedLayerOrder??-Number.MAX_VALUE)-(y.drapedLayerOrder??-Number.MAX_VALUE):(B.drapedLayerGraphicOrder??-Number.MAX_VALUE)-(y.drapedLayerGraphicOrder??-Number.MAX_VALUE))}}class u{constructor(){this.min=
new t(g.create());this.max=new t(g.create());this.hud={min:new m(g.create()),max:new m(g.create()),all:[]};this.ground=new t(g.create());this.all=[]}init(v){this.min.init(v);this.max.init(v);this.ground.init(v);this.all.length=0;this.hud.min.init(v);this.hud.max.init(v);this.hud.all.length=0}}class t{get ray(){return this._ray}get distanceInRenderSpace(){return null!=this.dist?(k.scale(q,this.ray.direction,this.dist),k.length(q)):null}getIntersectionPoint(v){if(!l.isValidIntersectorResult(this))return!1;
k.scale(q,this.ray.direction,this.dist);k.add(v,this.ray.origin,q);return!0}getTransformedNormal(v){k.copy(r,this.normal);r[3]=0;h.transformMat4(r,r,this.transformation);k.copy(v,r);return k.normalize(v,v)}constructor(v){this.intersector=f.IntersectorType.OBJECT;this.normal=p.create();this.transformation=n.create();this._ray=g.create();this.init(v)}init(v){this.drapedLayerGraphicOrder=this.drapedLayerOrder=this.target=this.dist=null;this.intersector=f.IntersectorType.OBJECT;g.copy(v,this._ray)}set(v,
y,B,z,A,C,H){this.intersector=v;this.dist=B;k.copy(this.normal,z??p.UNIT_Z);b.copy(this.transformation,A??n.IDENTITY);this.target=y;this.drapedLayerOrder=C;this.drapedLayerGraphicOrder=H}copy(v){g.copy(v.ray,this._ray);this.intersector=v.intersector;this.dist=v.dist;this.target=v.target;this.drapedLayerOrder=v.drapedLayerOrder;this.drapedLayerGraphicOrder=v.drapedLayerGraphicOrder;k.copy(this.normal,v.normal);b.copy(this.transformation,v.transformation)}}class m extends t{constructor(){super(...arguments);
this.intersector=f.IntersectorType.HUD}}const q=p.create(),r=e.create();a.defaultTolerance=1E-5;a.newIntersector=function(v){return new x(v)};a.newIntersectorResult=function(v){return new t(v)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/IntersectorInterfaces":function(){define(["exports"],function(a){a.IntersectorType=void 0;(function(n){n[n.OBJECT=0]="OBJECT";n[n.HUD=1]="HUD";n[n.TERRAIN=2]="TERRAIN";n[n.OVERLAY=3]="OVERLAY";n[n.I3S=4]="I3S";n[n.PCL=
5]="PCL";n[n.LOD=6]="LOD";n[n.VOXEL=7]="VOXEL";n[n.TILES3D=8]="TILES3D"})(a.IntersectorType||(a.IntersectorType={}));class b{constructor(){this.verticalOffset=0;this.selectionMode=!1;this.selectOpaqueTerrainOnly=this.hud=!0;this.invisibleTerrain=!1;this.backfacesTerrain=!0;this.isFiltered=!1;this.filteredLayerUids=[];this.store=a.StoreResults.ALL;this.normalRequired=!0;this.excludeLabels=!1}}a.StoreResults=void 0;(function(n){n[n.MIN=0]="MIN";n[n.MINMAX=1]="MINMAX";n[n.ALL=2]="ALL"})(a.StoreResults||
(a.StoreResults={}));a.IntersectorOptions=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/IntersectorTarget":function(){define(["exports","../../../../core/libs/gl-matrix-2/factories/vec3f64"],function(a,b){class n{constructor(g,d,f){this.object=g;this.geometryId=d;this.triangleNr=f}}class k extends n{constructor(g,d,f,c){super(g,d,f);this.center=null!=c?b.clone(c):null}}class p extends k{}class h{constructor(g){this.layerUid=g}}class e extends h{constructor(g,
d){super(g);this.graphicUid=d}}a.Graphic3DTarget=e;a.HudTarget=k;a.LayerTarget=h;a.ObjectTarget=n;a.ValidHudTarget=p;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/intersectorUtils":function(){define(["exports","../../../../chunks/vec32","../../../../core/libs/gl-matrix-2/factories/vec3f64","../../../../chunks/boundedPlane","./IntersectorInterfaces"],function(a,b,n,k,p){function h(g){return null!=g?.dist}const e=n.create();a.isHudIntersectorResult=
function(g){return h(g)&&g.intersector===p.IntersectorType.HUD&&!!g.target&&"center"in g.target&&null!=g.target.center};a.isObjectIntersectorResult=function(g){return h(g)&&g.intersector===p.IntersectorType.OBJECT&&!!g.target};a.isValidIntersectorResult=h;a.sliceFilterPredicate=function(g){return(d,f,c)=>{b.lerp(e,d,f,c);return!k.extrusionContainsPoint(g,e)}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/verticalOffsetUtils":function(){define("exports ../../../../core/libs/gl-matrix-2/math/mat3 ../../../../core/libs/gl-matrix-2/factories/mat3f64 ../../../../core/libs/gl-matrix-2/math/mat4 ../../../../core/libs/gl-matrix-2/factories/mat4f64 ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../chunks/sphere ../../../ViewingMode ../../support/orientedBoundingBox".split(" "),
function(a,b,n,k,p,h,e,g,d,f){class c{constructor(){this._transform=p.create();this._transformInverse=new l({value:this._transform},k.invert,p.create);this._transformInverseTranspose=new l(this._transformInverse,k.transpose,p.create);this._transformTranspose=new l({value:this._transform},k.transpose,p.create);this._transformInverseRotation=new l({value:this._transform},b.normalFromMat4Legacy,n.create)}_invalidateLazyTransforms(){this._transformInverse.invalidate();this._transformInverseTranspose.invalidate();
this._transformTranspose.invalidate();this._transformInverseRotation.invalidate()}get transform(){return this._transform}get inverse(){return this._transformInverse.value}get inverseTranspose(){return this._transformInverseTranspose.value}get inverseRotation(){return this._transformInverseRotation.value}get transpose(){return this._transformTranspose.value}setTransformMatrix(A){k.copy(this._transform,A)}multiplyTransform(A){k.multiply(this._transform,this._transform,A)}set(A){k.copy(this._transform,
A);this._invalidateLazyTransforms()}setAndInvalidateLazyTransforms(A,C){this.setTransformMatrix(A);this.multiplyTransform(C);this._invalidateLazyTransforms()}}class l{constructor(A,C,H){this._original=A;this._update=C;this._dirty=!0;this._transform=H()}invalidate(){this._dirty=!0}get value(){this._dirty&&(this._update(this._transform,this._original.value),this._dirty=!1);return this._transform}}class w{constructor(A=0){this.offset=A;this.tmpVertex=e.create()}applyToVertex(A,C,H){A=h.set(r,A,C,H);
C=h.add(v,A,this.localOrigin);H=this.offset/h.length(C);h.scaleAndAdd(this.tmpVertex,A,C,H);return this.tmpVertex}applyToAabb(A){var C=y;const H=B,E=z;for(var F=0;3>F;++F)C[F]=A[0+F]+this.localOrigin[F],H[F]=A[3+F]+this.localOrigin[F],E[F]=C[F];F=this.applyToVertex(C[0],C[1],C[2]);for(var G=0;3>G;++G)A[G]=F[G],A[G+3]=F[G];F=I=>{I=this.applyToVertex(I[0],I[1],I[2]);for(let J=0;3>J;++J)A[J]=Math.min(A[J],I[J]),A[J+3]=Math.max(A[J+3],I[J])};for(G=1;8>G;++G){for(var D=0;3>D;++D)E[D]=0===(G&1<<D)?C[D]:
H[D];F(E)}G=0;for(D=0;3>D;++D)0>C[D]*H[D]&&(G|=1<<D);if(0!==G&&7!==G)for(D=0;8>D;++D)if(0===(G&D)){for(let I=0;3>I;++I)E[I]=0!==(G&1<<I)?0:0!==(D&1<<I)?C[I]:H[I];F(E)}for(C=0;3>C;++C)A[C]-=this.localOrigin[C],A[C+3]-=this.localOrigin[C];return A}}class x{constructor(A=0){this._offset=this._totalOffset=this.componentLocalOriginLength=0;this._tmpVertex=e.create();this._tmpMbs=g.create();this._tmpObb=new f.Obb;this._resetOffset(A)}_resetOffset(A){this._totalOffset=this._offset=A}set offset(A){this._resetOffset(A)}get offset(){return this._offset}set componentOffset(A){this._totalOffset=
this._offset+A}set localOrigin(A){this.componentLocalOriginLength=h.length(A)}applyToVertex(A,C,H){const E=h.set(r,A,C,H);A=h.set(v,A,C,H+this.componentLocalOriginLength);C=this._totalOffset/h.length(A);h.scaleAndAdd(this._tmpVertex,E,A,C);return this._tmpVertex}applyToAabb(A){var C=this.componentLocalOriginLength;const H=A[0],E=A[1],F=A[2]+C,G=A[3],D=A[4];C=A[5]+C;var I=Math.abs(H),J=Math.abs(E),N=Math.abs(F),M=Math.abs(G),Q=Math.abs(D),O=Math.abs(C),K=.5*(1+Math.sign(H*G))*Math.min(I,M),L=.5*(1+
Math.sign(E*D))*Math.min(J,Q);const P=.5*(1+Math.sign(F*C))*Math.min(N,O);var R=Math.max(I,M),W=Math.max(J,Q),V=Math.max(N,O);K=Math.sqrt(K*K+L*L+P*P);I=Math.sign(I+H);J=Math.sign(J+E);N=Math.sign(N+F);M=Math.sign(M+G);Q=Math.sign(Q+D);O=Math.sign(O+C);L=this._totalOffset;if(K<L)return A[0]-=(1-I)*L,A[1]-=(1-J)*L,A[2]-=(1-N)*L,A[3]+=M*L,A[4]+=Q*L,A[5]+=O*L,A;R=L/Math.sqrt(R*R+W*W+V*V);W=L/K;V=W-R;K=-V;A[0]+=H*(I*K+W);A[1]+=E*(J*K+W);A[2]+=F*(N*K+W);A[3]+=G*(M*V+R);A[4]+=D*(Q*V+R);A[5]+=C*(O*V+R);
return A}applyToMbs(A){const C=h.length(g.getCenter(A)),H=this._totalOffset/C;h.scaleAndAdd(g.getCenter(this._tmpMbs),g.getCenter(A),g.getCenter(A),H);this._tmpMbs[3]=A[3]+A[3]*this._totalOffset/C;return this._tmpMbs}applyToObb(A){f.computeOffsetObb(A,this._totalOffset,this._totalOffset,d.ViewingMode.Global,this._tmpObb);return this._tmpObb}}class u{constructor(A=0){this.offset=A;this.sphere=g.create();this.tmpVertex=e.create()}applyToVertex(A,C,H){var E=this.objectTransform.transform;A=h.set(r,A,
C,H);E=h.transformMat4(A,A,E);A=this.offset/h.length(E);h.scaleAndAdd(E,E,E,A);h.transformMat4(this.tmpVertex,E,this.objectTransform.inverse);return this.tmpVertex}applyToMinMax(A,C){const H=this.offset/h.length(A);h.scaleAndAdd(A,A,A,H);A=this.offset/h.length(C);h.scaleAndAdd(C,C,C,A)}applyToAabb(A){var C=this.offset/Math.sqrt(A[0]*A[0]+A[1]*A[1]+A[2]*A[2]);A[0]+=A[0]*C;A[1]+=A[1]*C;A[2]+=A[2]*C;C=this.offset/Math.sqrt(A[3]*A[3]+A[4]*A[4]+A[5]*A[5]);A[3]+=A[3]*C;A[4]+=A[4]*C;A[5]+=A[5]*C;return A}applyToBoundingSphere(A){const C=
h.length(g.getCenter(A)),H=this.offset/C;h.scaleAndAdd(g.getCenter(this.sphere),g.getCenter(A),g.getCenter(A),H);this.sphere[3]=A[3]+A[3]*this.offset/C;return this.sphere}}const t=new u,m=new x,q=new w,r=e.create(),v=e.create(),y=e.create(),B=e.create(),z=e.create();a.I3SVerticalOffsetGlobalViewingMode=x;a.IntersectorTransform=c;a.Object3DVerticalOffsetGlobalViewingMode=u;a.TerrainVerticalOffsetGlobalViewingMode=w;a.getVerticalOffsetI3S=function(A){return null!=A?(m.offset=A,m):null};a.getVerticalOffsetObject3D=
function(A){return null!=A?(t.offset=A,t):null};a.getVerticalOffsetTerrain=function(A){return null!=A?(q.offset=A,q):null};a.terrainId="terrain";Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/orientedBoundingBox":function(){define("exports ../../../core/libs/gl-matrix-2/math/mat3 ../../../core/libs/gl-matrix-2/factories/mat3f64 ../../../core/libs/gl-matrix-2/factories/mat4f64 ../../../core/libs/gl-matrix-2/math/quat ../../../core/libs/gl-matrix-2/factories/quatf64 ../../../chunks/vec32 ../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../chunks/vec42 ../../../core/libs/gl-matrix-2/factories/vec4f64 ../../../geometry/ellipsoidUtils ../../../geometry/spatialReferenceEllipsoidUtils ../../../geometry/projection/computeTranslationToOriginAndRotation ../../../geometry/projection/projectBuffer ../../../geometry/projection/projectors ../../../geometry/support/plane ../../../geometry/support/spatialReferenceUtils ../../../geometry/support/vectorStacks ../../ViewingMode ./dito ../webgl-engine/lib/Attribute".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w,x,u,t,m,q,r,v,y){function B(T,S=new H){v.computeOBB(T,S);return S}function z(T,S,Z,ia,Y){var ea=S.getQuaternion(F);ea=b.fromQuat(W,ea);S=S.getHalfSize(R);for(let ja=0;8>ja;++ja){for(var ka=0;3>ka;++ka)K[ka]=S[ka]*(0!==(ja&1<<ka)?-1:1);for(ka=0;3>ka;++ka){let X=Z[ka];for(let aa=0;3>aa;++aa)X+=K[aa]*ea[3*aa+ka];Q[3*ja+ka]=X}}x.projectBuffer(Q,T,0,Q,ia,0,8);B(O,Y)}function A(T,S,Z,ia,Y=l.getSphericalPCPF(Z),ea=u.getProjector(Z,Y)){T.getCorners(ba);T.getCenter(K);K[2]+=
ia;w.computeTranslationToOriginAndRotation(Z,K,V,Y);S.setCenter(V[12],V[13],V[14]);Z=2*Math.sqrt(1+V[0]+V[5]+V[10]);E[0]=(V[6]-V[9])/Z;E[1]=(V[8]-V[2])/Z;E[2]=(V[1]-V[4])/Z;E[3]=.25*Z;T=T.getQuaternion(F);S.quaternion=p.multiply(E,E,T);p.conjugate(E,E);e.set(da,0,0,0);T=S.getCenter(P);for(const ka of ba)ka[2]+=ia,ea(ka,0,ka,0),e.sub(U,ka,T),e.transformQuat(U,U,E),e.abs(U,U),e.max(da,da,U);S.halfSize=da}function C(T,S,Z,ia,Y=l.getSphericalPCPF(Z)){const ea=c.getReferenceEllipsoid(Z),ka=1+Math.max(0,
ia)/(ea.radius+T.centerZ);T.getCenter(K);K[2]+=ia;x.projectBuffer(K,Z,0,K,Y,0);S.center=K;Z=T.getQuaternion(F);S.quaternion=Z;p.conjugate(E,Z);e.set(U,0,0,1);e.transformQuat(U,U,E);T=T.getHalfSize(R);e.set(U,T[0]*Math.abs(U[0]),T[1]*Math.abs(U[1]),T[2]*Math.abs(U[2]));e.scale(U,U,ea.inverseFlattening);e.add(U,T,U);S.halfSize=e.scale(U,U,ka)}class H{constructor(T=g.ZEROS,S=ha,Z=h.IDENTITY){this._data=[T[0],T[1],T[2],S[0],S[1],S[2],Z[0],Z[1],Z[2],Z[3]]}clone(){const T=new H;T._data=this._data.slice();
return T}invalidate(){this._data[3]=-1}get isValid(){return 0<=this._data[3]}static fromData(T){const S=new H;S._data=T.slice();return S}static fromJSON(T){return new H(T.center,T.halfSize,T.quaternion)}copy(T){this._data=T.data.slice()}get center(){return e.set(q.sv3d.get(),this._data[0],this._data[1],this._data[2])}get centerX(){return this._data[0]}get centerY(){return this._data[1]}get centerZ(){return this._data[2]}getCenter(T){T[0]=this._data[0];T[1]=this._data[1];T[2]=this._data[2];return T}set center(T){this._data[0]=
T[0];this._data[1]=T[1];this._data[2]=T[2]}setCenter(T,S,Z){this._data[0]=T;this._data[1]=S;this._data[2]=Z}get halfSize(){return e.set(q.sv3d.get(),this._data[3],this._data[4],this._data[5])}get halfSizeX(){return this._data[3]}get halfSizeY(){return this._data[4]}get halfSizeZ(){return this._data[5]}getHalfSize(T){T[0]=this._data[3];T[1]=this._data[4];T[2]=this._data[5];return T}set halfSize(T){this._data[3]=T[0];this._data[4]=T[1];this._data[5]=T[2]}get quaternion(){return p.set(q.sq4d.get(),this._data[6],
this._data[7],this._data[8],this._data[9])}getQuaternion(T){T[0]=this._data[6];T[1]=this._data[7];T[2]=this._data[8];T[3]=this._data[9];return T}set quaternion(T){this._data[6]=T[0];this._data[7]=T[1];this._data[8]=T[2];this._data[9]=T[3]}get data(){return this._data}getCorners(T){const S=E,Z=this._data;S[0]=Z[6];S[1]=Z[7];S[2]=Z[8];S[3]=Z[9];for(let ia=0;8>ia;++ia){const Y=T[ia];Y[0]=(ia&1?-1:1)*Z[3];Y[1]=(ia&2?-1:1)*Z[4];Y[2]=(ia&4?-1:1)*Z[5];e.transformQuat(Y,Y,S);Y[0]+=Z[0];Y[1]+=Z[1];Y[2]+=Z[2]}}doesIntersectFrustumConservativeApproximation(T){return 0>=
this.intersectPlane(T[0])&&0>=this.intersectPlane(T[1])&&0>=this.intersectPlane(T[2])&&0>=this.intersectPlane(T[3])&&0>=this.intersectPlane(T[4])&&0>=this.intersectPlane(T[5])}get radius(){const T=this._data[3],S=this._data[4],Z=this._data[5];return Math.sqrt(T*T+S*S+Z*Z)}intersectSphere(T){D[0]=this._data[0]-T[0];D[1]=this._data[1]-T[1];D[2]=this._data[2]-T[2];const S=this.getQuaternion(F);p.conjugate(E,S);e.transformQuat(D,D,E);e.abs(D,D);I[0]=Math.min(D[0],this._data[3]);I[1]=Math.min(D[1],this._data[4]);
I[2]=Math.min(D[2],this._data[5]);return e.sqrDist(I,D)<T[3]*T[3]}intersectSphereWithMBS(T,S=this.radius){const Z=this._data;D[0]=Z[0]-T[0];D[1]=Z[1]-T[1];D[2]=Z[2]-T[2];T=T[3];const ia=e.sqrLen(D);S=T+S;if(ia>S*S)return!1;E[0]=-Z[6];E[1]=-Z[7];E[2]=-Z[8];E[3]=Z[9];e.transformQuat(D,D,E);e.abs(D,D);I[0]=Math.min(D[0],Z[3]);I[1]=Math.min(D[1],Z[4]);I[2]=Math.min(D[2],Z[5]);return e.sqrDist(I,D)<T*T}intersectPlane(T){const S=T[0]*this._data[0]+T[1]*this._data[1]+T[2]*this._data[2]+T[3];T=this.projectedRadius(t.getNormal(T));
return S>T?1:S<-T?-1:0}intersectRay(T,S,Z=0){var ia=this._data,Y=E;Y[0]=-ia[6];Y[1]=-ia[7];Y[2]=-ia[8];Y[3]=ia[9];D[0]=T[0]-ia[0];D[1]=T[1]-ia[1];D[2]=T[2]-ia[2];T=e.transformQuat(D,D,E);S=e.transformQuat(I,S,E);ia=-Infinity;Y=Infinity;const ea=this.getHalfSize(R);for(let ja=0;3>ja;ja++){var ka=T[ja];const X=S[ja],aa=ea[ja]+Z;if(1E-6<Math.abs(X)){const pa=(aa-ka)/X;ka=(-aa-ka)/X;ia=Math.max(ia,Math.min(pa,ka));Y=Math.min(Y,Math.max(pa,ka))}else if(ka>aa||ka<-aa)return!1}return ia<=Y}projectedArea(T,
S,Z,ia){var Y=this.getQuaternion(F);p.conjugate(E,Y);D[0]=T[0]-this._data[0];D[1]=T[1]-this._data[1];D[2]=T[2]-this._data[2];e.transformQuat(D,D,E);var ea=this.getHalfSize(R),ka=D[0]<-ea[0]?-1:D[0]>ea[0]?1:0,ja=D[1]<-ea[1]?-1:D[1]>ea[1]?1:0;const X=D[2]<-ea[2]?-1:D[2]>ea[2]?1:0;T=Math.abs(ka)+Math.abs(ja)+Math.abs(X);if(0===T)return Infinity;T=1===T?4:6;ka=6*(ka+3*ja+9*X+13);b.fromQuat(W,Y);b.scale(W,W,ea);Y=this.getCenter(L);for(ea=0;ea<T;ea++)ja=M[ka+ea],e.set(D,((ja&1)<<1)-1,(ja&2)-1,((ja&4)>>
1)-1),e.transformMat3(D,D,W),e.add(J,Y,D),J[3]=1,d.transformMat4(J,J,S),ja=1/Math.max(1E-6,J[3]),N[2*ea]=J[0]*ja,N[2*ea+1]=J[1]*ja;S=2*T-2;T=N[0]*(N[3]-N[S+1])+N[S]*(N[1]-N[S-1]);for(Y=2;Y<S;Y+=2)T+=N[Y]*(N[Y+3]-N[Y-1]);return Math.abs(T)*Z*ia*.125}projectedRadius(T){const S=this.getQuaternion(F);p.conjugate(E,S);e.transformQuat(D,T,E);return Math.abs(D[0]*this._data[3])+Math.abs(D[1]*this._data[4])+Math.abs(D[2]*this._data[5])}minimumDistancePlane(T){const S=T[0]*this._data[0]+T[1]*this._data[1]+
T[2]*this._data[2]+T[3];T=this.projectedRadius(t.getNormal(T));return S-T}maximumDistancePlane(T){const S=T[0]*this._data[0]+T[1]*this._data[1]+T[2]*this._data[2]+T[3];T=this.projectedRadius(t.getNormal(T));return S+T}toAaBoundingBox(T){var S=this.getQuaternion(F),Z=b.fromQuat(W,S);S=this._data[3]*Math.abs(Z[0])+this._data[4]*Math.abs(Z[3])+this._data[5]*Math.abs(Z[6]);const ia=this._data[3]*Math.abs(Z[1])+this._data[4]*Math.abs(Z[4])+this._data[5]*Math.abs(Z[7]);Z=this._data[3]*Math.abs(Z[2])+this._data[4]*
Math.abs(Z[5])+this._data[5]*Math.abs(Z[8]);T[0]=this._data[0]-S;T[1]=this._data[1]-ia;T[2]=this._data[2]-Z;T[3]=this._data[0]+S;T[4]=this._data[1]+ia;T[5]=this._data[2]+Z}transform(T,S,Z,ia=0,Y=l.getSphericalPCPF(Z),ea=l.getSphericalPCPF(S),ka=u.getProjector(S,ea)){Z===Y?S.isGeographic?C(this,T,S,ia,ea):A(this,T,S,ia,ea,ka):S.isWGS84&&(Z.isWebMercator||m.isPlateCarree(Z))?(this.getCenter(L),L[2]+=ia,ia=l.getSphericalPCPF(Z),x.projectBuffer(L,S,0,L,ia,0),z(ia,this,L,Z,T)):S.isWebMercator&&m.isPlateCarree(Z)?
(this.getCenter(L),L[2]+=ia,z(S,this,L,Z,T)):(Y=this.getCenter(L),Y[2]+=ia,x.projectBuffer(Y,S,0,Y,Z,0),T.center=Y,this!==T&&(T.quaternion=this.getQuaternion(F),T.halfSize=this.getHalfSize(R)))}}const E=h.create(),F=h.create(),G=h.create(),D=g.create(),I=g.create(),J=f.create(),N=[.1,.2,.3,.4,.5,.6,.7,.8,.9,1,1.1,1.2],M=(()=>{const T=new Int8Array(162);let S=0;const Z=ia=>{for(let Y=0;Y<ia.length;Y++)T[S+Y]=ia[Y];S+=6};Z([6,2,3,1,5,4]);Z([0,2,3,1,5,4]);Z([0,2,3,7,5,4]);Z([0,1,3,2,6,4]);Z([0,1,3,2,
0,0]);Z([0,1,5,7,3,2]);Z([0,1,3,7,6,4]);Z([0,1,3,7,6,2]);Z([0,1,5,7,6,2]);Z([0,1,5,4,6,2]);Z([0,1,5,4,0,0]);Z([0,1,3,7,5,4]);Z([0,2,6,4,0,0]);Z([0,0,0,0,0,0]);Z([1,3,7,5,0,0]);Z([2,3,7,6,4,0]);Z([2,3,7,6,0,0]);Z([2,3,1,5,7,6]);Z([0,1,5,7,6,2]);Z([0,1,5,7,6,4]);Z([0,1,3,7,6,4]);Z([4,5,7,6,2,0]);Z([4,5,7,6,0,0]);Z([4,5,1,3,7,6]);Z([0,2,3,7,5,4]);Z([6,2,3,7,5,4]);Z([6,2,3,1,5,4]);return T})(),Q=Array(24),O=new y.Vertices(Q,3),K=g.create(),L=g.create(),P=g.create(),R=g.create(),W=n.create(),V=k.create(),
ba=[[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0]],U=g.create(),da=g.create(),fa=g.create(),ha=g.freeze(-1,-1,-1);a.Obb=H;a.compute=B;a.computeOffsetObb=function(T,S,Z,ia,Y){var ea=T.getQuaternion(F);Y.quaternion=ea;p.conjugate(E,ea);var ka=T.getCenter(L);ea=T.getHalfSize(R);if(ia===r.ViewingMode.Global){e.transformQuat(U,ka,E);e.abs(da,U);e.min(fa,da,ea);e.sub(fa,da,fa);ia=e.length(fa);e.add(fa,da,ea);const ja=e.length(fa);ia<Z?(Y.center=ka,e.set(U,Z,Z,Z),Y.halfSize=e.add(U,ea,
U)):(S=0<ja?1+S/ja:1,ka=0<ia?1+Z/ia:1,Z=(ka+S)/2,S=(ka-S)/2,e.scale(fa,da,S),Y.halfSize=e.scaleAndAdd(fa,fa,ea,Z),e.scale(fa,da,Z),e.scaleAndAdd(fa,fa,ea,S),e.sign(U,U),e.multiply(U,fa,U),T=T.getQuaternion(G),Y.center=e.transformQuat(U,U,T))}else Y.center=e.scaleAndAdd(U,ka,g.UNIT_Z,(Z+S)/2),T=e.transformQuat(U,g.UNIT_Z,E),e.abs(T,T),Y.halfSize=e.scaleAndAdd(da,ea,T,(Z-S)/2);return Y};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/projection/computeTranslationToOriginAndRotation":function(){define("exports ../../core/mathUtils ../../core/libs/gl-matrix-2/math/mat4 ../../core/libs/gl-matrix-2/factories/vec3f64 ./localRotationUtils ./projectors ../support/spatialReferenceUtils".split(" "),
function(a,b,n,k,p,h,e){function g(l){return l===h.ProjectionID.SPHERICAL_ECEF||l===h.ProjectionID.SPHERICAL_MARS_PCPF||l===h.ProjectionID.SPHERICAL_MOON_PCPF||l===h.ProjectionID.WGS84_ECEF}const d=b.deg2rad(1),f=k.create(),c=k.create();a.computeTranslationToOriginAndRotation=function(l,w,x,u){if(null==l||null==u)return!1;var t=h.classifySpatialReference(l,h.sourceClassificationCache),m=h.classifySpatialReference(u,h.destClassificationCache);if(t===m&&!g(m)&&(t!==h.ProjectionID.UNKNOWN||e.equals(l,
u)))return n.fromTranslation(x,w),!0;if(g(m)){t=h.projectionTable[t][h.ProjectionID.LON_LAT];m=h.projectionTable[h.ProjectionID.LON_LAT][m];if(null==t||null==m)return!1;t(w,0,f,0);m(f,0,c,0);p.computeENUToPCPFLocalRotation(d*f[0],d*f[1],x);x[12]=c[0];x[13]=c[1];x[14]=c[2];return!0}l=g(t);if((m===h.ProjectionID.WEB_MERCATOR||m===h.ProjectionID.PLATE_CARREE||m===h.ProjectionID.WGS84||m===h.ProjectionID.CGCS2000)&&(t===h.ProjectionID.WGS84||l||t===h.ProjectionID.WEB_MERCATOR||t===h.ProjectionID.CGCS2000)){t=
h.projectionTable[t][h.ProjectionID.LON_LAT];m=h.projectionTable[h.ProjectionID.LON_LAT][m];if(null==t||null==m)return!1;t(w,0,f,0);m(f,0,c,0);l?p.computePCPFToENULocalRotation(d*f[0],d*f[1],x):n.identity(x);x[12]=c[0];x[13]=c[1];x[14]=c[2];return!0}return!1};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/projection/localRotationUtils":function(){define(["exports","../../core/libs/gl-matrix-2/math/mat4"],function(a,b){function n(k,p,h){const e=Math.sin(k);k=Math.cos(k);
const g=Math.sin(p);p=Math.cos(p);h[0]=-e;h[4]=-g*k;h[8]=p*k;h[12]=0;h[1]=k;h[5]=-g*e;h[9]=p*e;h[13]=0;h[2]=0;h[6]=p;h[10]=g;h[14]=0;h[3]=0;h[7]=0;h[11]=0;h[15]=1;return h}a.computeENUToPCPFLocalRotation=n;a.computePCPFToENULocalRotation=function(k,p,h){n(k,p,h);b.transpose(h,h);return h};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/dito":function(){define("exports ../../../core/libs/gl-matrix-2/factories/mat3f64 ../../../core/libs/gl-matrix-2/factories/quatf64 ../../../core/libs/gl-matrix-2/factories/vec2f64 ../../../chunks/vec32 ../../../core/libs/gl-matrix-2/factories/vec3f64 ../webgl-engine/lib/Attribute".split(" "),
function(a,b,n,k,p,h,e){function g(Y,ea,ka,ja,X,aa){if(!(1E-6>ea[0]*ea[0]+ea[1]*ea[1]+ea[2]*ea[2]))for(m(J,ka,ea),m(N,ja,ea),m(M,X,ea),d(Y,ea,I),O[1]=I[0],Q[1]=I[1],K[1]=Q[1]-O[1],ka=[ka,ja,X],ja=[J,N,M],X=0;3>X;++X){d(Y,ka[X],I);O[0]=I[0];Q[0]=I[1];d(Y,ja[X],I);O[2]=I[0];Q[2]=I[1];K[0]=Q[0]-O[0];K[2]=Q[2]-O[2];const pa=l(K);pa<aa.quality&&(t(aa.b0,ka[X]),t(aa.b1,ea),t(aa.b2,ja[X]),aa.quality=pa)}}function d(Y,ea,ka){const {data:ja,size:X}=Y;ka[0]=Number.POSITIVE_INFINITY;ka[1]=Number.NEGATIVE_INFINITY;
for(Y=0;Y<ja.length;Y+=X){const aa=ja[Y]*ea[0]+ja[Y+1]*ea[1]+ja[Y+2]*ea[2];ka[0]=Math.min(ka[0],aa);ka[1]=Math.max(ka[1],aa)}}function f(Y,ea,ka,ja,X,aa){d(Y,ea,I);X[0]=I[0];aa[0]=I[1];d(Y,ka,I);X[1]=I[0];aa[1]=I[1];d(Y,ja,I);X[2]=I[0];aa[2]=I[1]}function c(Y,ea,ka,ja,X,aa,pa){T[0]=Y[0];T[1]=Y[1];T[2]=Y[2];T[3]=ea[0];T[4]=ea[1];T[5]=ea[2];T[6]=ka[0];T[7]=ka[1];T[8]=ka[2];var la=S,na=T,qa=na[0]+na[4]+na[8];if(0<qa)qa=Math.sqrt(qa+1),la[3]=.5*qa,qa=.5/qa,la[0]=(na[5]-na[7])*qa,la[1]=(na[6]-na[2])*qa,
la[2]=(na[1]-na[3])*qa;else{qa=0;na[4]>na[0]&&(qa=1);na[8]>na[3*qa+qa]&&(qa=2);const sa=(qa+1)%3,xa=(qa+2)%3;let ta=Math.sqrt(na[3*qa+qa]-na[3*sa+sa]-na[3*xa+xa]+1);la[qa]=.5*ta;ta=.5/ta;la[3]=(na[3*sa+xa]-na[3*xa+sa])*ta;la[sa]=(na[3*sa+qa]+na[3*qa+sa])*ta;la[xa]=(na[3*xa+qa]+na[3*qa+xa])*ta}pa.quaternion=la;w(da,ja,X);u(da,da,.5);u(fa,Y,da[0]);u(ha,ea,da[1]);w(fa,fa,ha);u(ha,ka,da[2]);pa.center=p.add(fa,fa,ha);pa.halfSize=p.scale(da,aa,.5)}function l(Y){return Y[0]*Y[1]+Y[0]*Y[2]+Y[1]*Y[2]}function w(Y,
ea,ka){Y[0]=ea[0]+ka[0];Y[1]=ea[1]+ka[1];Y[2]=ea[2]+ka[2]}function x(Y,ea,ka){Y[0]=ea[0]-ka[0];Y[1]=ea[1]-ka[1];Y[2]=ea[2]-ka[2]}function u(Y,ea,ka){Y[0]=ea[0]*ka;Y[1]=ea[1]*ka;Y[2]=ea[2]*ka}function t(Y,ea,ka=0){Y[0]=ea[ka];Y[1]=ea[ka+1];Y[2]=ea[ka+2]}function m(Y,ea,ka){const ja=ea[0],X=ea[1];ea=ea[2];const aa=ka[0],pa=ka[1];ka=ka[2];Y[0]=X*ka-ea*pa;Y[1]=ea*aa-ja*ka;Y[2]=ja*pa-X*aa}function q(Y,ea){var ka=ea[0]*ea[0]+ea[1]*ea[1]+ea[2]*ea[2];0<ka&&(ka=1/Math.sqrt(ka),Y[0]=ea[0]*ka,Y[1]=ea[1]*ka,
Y[2]=ea[2]*ka)}function r(Y,ea){const ka=ea[0]-Y[0],ja=ea[1]-Y[1];Y=ea[2]-Y[2];return ka*ka+ja*ja+Y*Y}const v=h.create(),y=h.create(),B=h.create(),z=h.create(),A=h.create(),C=h.create(),H=h.create(),E=h.create(),F=h.create(),G=h.create(),D=[0,0,0],I=k.create(),J=h.create(),N=h.create(),M=h.create(),Q=h.create(),O=h.create(),K=h.create(),L=h.create(),P=h.create(),R=h.create(),W=h.create(),V=h.create(),ba=h.create(),U=h.create(),da=h.create(),fa=h.create(),ha=h.create(),T=b.fromValues(1,0,0,0,1,0,0,
0,1),S=n.create();class Z{constructor(Y){this.minVert=Array(7);this.maxVert=Array(7);this.buffer=new ArrayBuffer(448);var ea=0;this.minProj=new Float64Array(this.buffer,ea,7);ea+=56;this.maxProj=new Float64Array(this.buffer,ea,7);ea+=56;for(var ka=0;7>ka;++ka)this.minVert[ka]=new Float64Array(this.buffer,ea,3),ea+=24;for(ka=0;7>ka;++ka)this.maxVert[ka]=new Float64Array(this.buffer,ea,3),ea+=24;for(ea=0;7>ea;++ea)this.minProj[ea]=Number.POSITIVE_INFINITY,this.maxProj[ea]=Number.NEGATIVE_INFINITY;ea=
Array(7);ka=Array(7);const {data:ja,size:X}=Y;for(Y=0;Y<ja.length;Y+=X){var aa=ja[Y];aa<this.minProj[0]&&(this.minProj[0]=aa,ea[0]=Y);aa>this.maxProj[0]&&(this.maxProj[0]=aa,ka[0]=Y);aa=ja[Y+1];aa<this.minProj[1]&&(this.minProj[1]=aa,ea[1]=Y);aa>this.maxProj[1]&&(this.maxProj[1]=aa,ka[1]=Y);aa=ja[Y+2];aa<this.minProj[2]&&(this.minProj[2]=aa,ea[2]=Y);aa>this.maxProj[2]&&(this.maxProj[2]=aa,ka[2]=Y);aa=ja[Y]+ja[Y+1]+ja[Y+2];aa<this.minProj[3]&&(this.minProj[3]=aa,ea[3]=Y);aa>this.maxProj[3]&&(this.maxProj[3]=
aa,ka[3]=Y);aa=ja[Y]+ja[Y+1]-ja[Y+2];aa<this.minProj[4]&&(this.minProj[4]=aa,ea[4]=Y);aa>this.maxProj[4]&&(this.maxProj[4]=aa,ka[4]=Y);aa=ja[Y]-ja[Y+1]+ja[Y+2];aa<this.minProj[5]&&(this.minProj[5]=aa,ea[5]=Y);aa>this.maxProj[5]&&(this.maxProj[5]=aa,ka[5]=Y);aa=ja[Y]-ja[Y+1]-ja[Y+2];aa<this.minProj[6]&&(this.minProj[6]=aa,ea[6]=Y);aa>this.maxProj[6]&&(this.maxProj[6]=aa,ka[6]=Y)}for(Y=0;7>Y;++Y)aa=ea[Y],t(this.minVert[Y],ja,aa),aa=ka[Y],t(this.maxVert[Y],ja,aa)}}class ia{constructor(){this.b0=h.fromValues(1,
0,0);this.b1=h.fromValues(0,1,0);this.b2=h.fromValues(0,0,1);this.quality=0}}a.computeOBB=function(Y,ea){const {data:ka,size:ja}=Y;var X=ka.length/ja;if(!(0>=X)){var aa=new Z(Y);w(v,aa.minProj,aa.maxProj);u(v,v,.5);x(y,aa.maxProj,aa.minProj);var pa=l(y),la=new ia;la.quality=pa;14>X&&(Y=new e.Vertices(new Float64Array(aa.buffer,112,42),3));var na=h.create(),qa=h.create(),sa=h.create();X=h.create();var xa=h.create(),ta=h.create(),Ba=h.create();var Ia=Y;var Ca=r(aa.maxVert[0],aa.minVert[0]),Ha=0;for(var Ga=
1;7>Ga;++Ga){const Sa=r(aa.maxVert[Ga],aa.minVert[Ga]);Sa>Ca&&(Ca=Sa,Ha=Ga)}t(na,aa.minVert[Ha]);t(qa,aa.maxVert[Ha]);if(1E-6>r(na,qa))Ia=1;else{x(X,na,qa);q(X,X);const {data:Sa,size:$a}=Ia;aa=Number.NEGATIVE_INFINITY;Ca=0;for(Ha=0;Ha<Sa.length;Ha+=$a)D[0]=Sa[Ha]-na[0],D[1]=Sa[Ha+1]-na[1],D[2]=Sa[Ha+2]-na[2],Ga=X[0]*D[0]+X[1]*D[1]+X[2]*D[2],Ga=D[0]*D[0]+D[1]*D[1]+D[2]*D[2]-Ga*Ga/(X[0]*X[0]+X[1]*X[1]+X[2]*X[2]),Ga>aa&&(aa=Ga,Ca=Ha);t(sa,Sa,Ca);1E-6>aa?Ia=2:(x(xa,qa,sa),q(xa,xa),x(ta,sa,na),q(ta,ta),
m(Ba,xa,X),q(Ba,Ba),g(Ia,Ba,X,xa,ta,la),Ia=0)}switch(Ia){case 1:ea.center=v;ea.halfSize=p.scale(y,y,.5);ea.quaternion=n.IDENTITY;return;case 2:pa=Y;t(P,X);Math.abs(X[0])>Math.abs(X[1])&&Math.abs(X[0])>Math.abs(X[2])?P[0]=0:Math.abs(X[1])>Math.abs(X[2])?P[1]=0:P[2]=0;1E-6>P[0]*P[0]+P[1]*P[1]+P[2]*P[2]&&(P[0]=P[1]=P[2]=1);m(R,X,P);q(R,R);m(W,X,R);q(W,W);f(pa,X,R,W,V,ba);x(U,ba,V);c(X,R,W,V,ba,U,ea);return}Ia=Y;aa=I;const {data:Aa,size:Ja}=Ia;t(z,Aa);t(B,z);aa[0]=L[0]*Ba[0]+L[1]*Ba[1]+L[2]*Ba[2];aa[1]=
aa[0];for(Ca=Ja;Ca<Aa.length;Ca+=Ja)Ha=Aa[Ca]*Ba[0]+Aa[Ca+1]*Ba[1]+Aa[Ca+2]*Ba[2],Ha<aa[0]&&(aa[0]=Ha,t(z,Aa,Ca)),Ha>aa[1]&&(aa[1]=Ha,t(B,Aa,Ca));Ba=na[0]*Ba[0]+na[1]*Ba[1]+na[2]*Ba[2];I[1]-1E-6<=Ba&&(B[0]=void 0);I[0]+1E-6>=Ba&&(z[0]=void 0);void 0!==B[0]&&(x(A,B,na),q(A,A),x(C,B,qa),q(C,C),x(H,B,sa),q(H,H),m(E,C,X),q(E,E),m(F,H,xa),q(F,F),m(G,A,ta),q(G,G),g(Ia,E,X,C,A,la),g(Ia,F,xa,H,C,la),g(Ia,G,ta,A,H,la));void 0!==z[0]&&(x(A,z,na),q(A,A),x(C,z,qa),q(C,C),x(H,z,sa),q(H,H),m(E,C,X),q(E,E),m(F,
H,xa),q(F,F),m(G,A,ta),q(G,G),g(Ia,E,X,C,A,la),g(Ia,F,xa,H,C,la),g(Ia,G,ta,A,H,la));f(Y,la.b0,la.b1,la.b2,V,ba);Y=h.create();x(Y,ba,V);la.quality=l(Y);la.quality<pa?c(la.b0,la.b1,la.b2,V,ba,Y,ea):(ea.center=v,ea.halfSize=p.scale(y,y,.5),ea.quaternion=n.IDENTITY)}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/Attribute":function(){define(["exports"],function(a){class b{constructor(k,p,h=p){this.data=k;this.size=p;this.stride=h}}class n extends b{constructor(k,
p,h,e=!1,g=h){super(k,h,g);this.indices=p;this.exclusive=e}}a.Attribute=n;a.Vertices=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/cameraUtilsPlanar":function(){define("exports ../geometry ../core/mathUtils ../core/libs/gl-matrix-2/math/mat4 ../core/libs/gl-matrix-2/factories/mat4f64 ../core/libs/gl-matrix-2/factories/vec2f64 ./vec32 ../core/libs/gl-matrix-2/factories/vec3f64 ../geometry/Extent ../geometry/projection/projectPointToVector ../geometry/projection/projectVectorToVector ../geometry/support/coordsUtils ../geometry/support/frustum ../geometry/support/polygonExtentClipping ../geometry/support/ray ../views/3d/state/Frustum ../views/3d/support/cameraUtilsInternal ../geometry/Polygon".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w,x,u,t,m,q){function r(N,M,Q,O=m.createDirectionUp()){const {direction:K,up:L}=O;k.fromZRotation(G,-n.deg2rad(M));k.rotateX(G,G,n.deg2rad(Q));e.transformMat4(K,F,G);e.scale(K,K,-1);e.transformMat4(L,E,G);return O}function v(N,M,Q,O){return m.directionToHeadingTilt(M,Q,O,F,E)}function y(N,M,Q,O){const K=r(N,Q,O),L=g.create();e.scale(L,K.direction,-M);e.add(L,L,N);return{up:K.up,eye:L,heading:Q,tilt:O}}function B(N){return n.rad2deg(N)}function z(N){return n.deg2rad(N)}
function A(N,M,Q,O,K){const L=N.renderSpatialReference;N=N.spatialReference??M.spatialReference;f.projectPointToVector(M,D,L);f.projectPointToVector(M,I,L);D[0]-=Q/2;I[0]+=Q/2;D[1]-=O/2;I[1]+=O/2;c.projectVectorToVector(D,L,D,N);c.projectVectorToVector(I,L,I,N);K?(K.xmin=D[0],K.ymin=D[1],K.xmax=I[0],K.ymax=I[1],K.spatialReference=N):K=new d(D[0],D[1],I[0],I[1],N);return K}function C(N,M){var Q=N.frustum;const {renderCoordsHelper:O}=N,K=O.getAltitude(M);M=N.spatialReference;N=N.state.camera.eye;const L=
[],P=Q.planes[w.PlaneIndex.FAR];for(let ba=0;4>ba;ba++){var R=Q.lines[ba];if(!O.intersectInfiniteManifold(u.wrap(R.origin,R.direction),K,J)){var W=J;R=R.endpoint;var V=K;const U=Q.lines[t.LineIndex.FAR_LEFT].direction,da=O.getAltitude(R);e.scaleAndAdd(W,R,U,(V-da)/U[2])}m.clampLineSegmentToPlane(J,N,J,P);L.push(h.fromValues(J[0],J[1]))}Q=x.clipPolygonToExtent(L,O.extent);return H(Q,O,M)}function H(N,M,Q){N=N.map(O=>{e.set(J,O[0],O[1],0);M.fromRenderCoords(J,J,Q);return[J[0],J[1]]});if(2>=N.length)return new q({spatialReference:Q});
N.push(N[0].slice());l.isClockwise(N)||N.reverse();return new q({rings:[N],spatialReference:Q})}const E=g.fromValues(0,1,0),F=g.fromValues(0,0,1),G=p.create(),D=g.create(),I=g.create(),J=g.create();b=Object.freeze(Object.defineProperty({__proto__:null,directionToHeadingTilt:v,eyeForCenterWithHeadingTilt:y,eyeTiltToLookAtTilt:z,headingTiltToDirectionUp:r,lookAtTiltToEyeTilt:B,toArea:C,toExtent:A},Symbol.toStringTag,{value:"Module"}));a.cameraUtilsPlanar=b;a.directionToHeadingTilt=v;a.eyeForCenterWithHeadingTilt=
y;a.eyeTiltToLookAtTilt=z;a.headingTiltToDirectionUp=r;a.lookAtTiltToEyeTilt=B;a.toArea=C;a.toExtent=A})},"esri/geometry/support/frustum":function(){define("exports ../../core/ObjectStack ../../core/libs/gl-matrix-2/math/mat4 ../../chunks/vec32 ../../core/libs/gl-matrix-2/factories/vec3f64 ../../chunks/vec42 ../../core/libs/gl-matrix-2/factories/vec4f64 ./clipRay ./plane ./vectorStacks".split(" "),function(a,b,n,k,p,h,e,g,d,f){function c(){return[p.create(),p.create(),p.create(),p.create(),p.create(),
p.create(),p.create(),p.create()]}function l(q,r){d.fromPoints(r[a.PointIndex.FAR_BOTTOM_LEFT],r[a.PointIndex.NEAR_BOTTOM_LEFT],r[a.PointIndex.NEAR_TOP_LEFT],q[a.PlaneIndex.LEFT]);d.fromPoints(r[a.PointIndex.NEAR_BOTTOM_RIGHT],r[a.PointIndex.FAR_BOTTOM_RIGHT],r[a.PointIndex.FAR_TOP_RIGHT],q[a.PlaneIndex.RIGHT]);d.fromPoints(r[a.PointIndex.FAR_BOTTOM_LEFT],r[a.PointIndex.FAR_BOTTOM_RIGHT],r[a.PointIndex.NEAR_BOTTOM_RIGHT],q[a.PlaneIndex.BOTTOM]);d.fromPoints(r[a.PointIndex.NEAR_TOP_LEFT],r[a.PointIndex.NEAR_TOP_RIGHT],
r[a.PointIndex.FAR_TOP_RIGHT],q[a.PlaneIndex.TOP]);d.fromPoints(r[a.PointIndex.NEAR_BOTTOM_LEFT],r[a.PointIndex.NEAR_BOTTOM_RIGHT],r[a.PointIndex.NEAR_TOP_RIGHT],q[a.PlaneIndex.NEAR]);d.fromPoints(r[a.PointIndex.FAR_BOTTOM_RIGHT],r[a.PointIndex.FAR_BOTTOM_LEFT],r[a.PointIndex.FAR_TOP_LEFT],q[a.PlaneIndex.FAR])}function w(q,r){for(let v=0;6>v;v++)if(!d.clip(q[v],r))return!1;return!0}a.PlaneIndex=void 0;(function(q){q[q.LEFT=0]="LEFT";q[q.RIGHT=1]="RIGHT";q[q.BOTTOM=2]="BOTTOM";q[q.TOP=3]="TOP";q[q.NEAR=
4]="NEAR";q[q.FAR=5]="FAR"})(a.PlaneIndex||(a.PlaneIndex={}));a.PointIndex=void 0;(function(q){q[q.NEAR_BOTTOM_LEFT=0]="NEAR_BOTTOM_LEFT";q[q.NEAR_BOTTOM_RIGHT=1]="NEAR_BOTTOM_RIGHT";q[q.NEAR_TOP_RIGHT=2]="NEAR_TOP_RIGHT";q[q.NEAR_TOP_LEFT=3]="NEAR_TOP_LEFT";q[q.FAR_BOTTOM_LEFT=4]="FAR_BOTTOM_LEFT";q[q.FAR_BOTTOM_RIGHT=5]="FAR_BOTTOM_RIGHT";q[q.FAR_TOP_RIGHT=6]="FAR_TOP_RIGHT";q[q.FAR_TOP_LEFT=7]="FAR_TOP_LEFT"})(a.PointIndex||(a.PointIndex={}));const x={bottom:[a.PointIndex.FAR_BOTTOM_RIGHT,a.PointIndex.NEAR_BOTTOM_RIGHT,
a.PointIndex.NEAR_BOTTOM_LEFT,a.PointIndex.FAR_BOTTOM_LEFT],near:[a.PointIndex.NEAR_BOTTOM_LEFT,a.PointIndex.NEAR_BOTTOM_RIGHT,a.PointIndex.NEAR_TOP_RIGHT,a.PointIndex.NEAR_TOP_LEFT],far:[a.PointIndex.FAR_BOTTOM_RIGHT,a.PointIndex.FAR_BOTTOM_LEFT,a.PointIndex.FAR_TOP_LEFT,a.PointIndex.FAR_TOP_RIGHT],right:[a.PointIndex.NEAR_BOTTOM_RIGHT,a.PointIndex.FAR_BOTTOM_RIGHT,a.PointIndex.FAR_TOP_RIGHT,a.PointIndex.NEAR_TOP_RIGHT],left:[a.PointIndex.FAR_BOTTOM_LEFT,a.PointIndex.NEAR_BOTTOM_LEFT,a.PointIndex.NEAR_TOP_LEFT,
a.PointIndex.FAR_TOP_LEFT],top:[a.PointIndex.FAR_TOP_LEFT,a.PointIndex.NEAR_TOP_LEFT,a.PointIndex.NEAR_TOP_RIGHT,a.PointIndex.FAR_TOP_RIGHT]},u=[e.fromValues(-1,-1,-1,1),e.fromValues(1,-1,-1,1),e.fromValues(1,1,-1,1),e.fromValues(-1,1,-1,1),e.fromValues(-1,-1,1,1),e.fromValues(1,-1,1,1),e.fromValues(1,1,1,1),e.fromValues(-1,1,1,1)],t=new b.ObjectStack(g.create),m=c();a.computePlanes=l;a.copy=function(q,r){for(let v=0;6>v;v++)d.copy(q[v],r[v]);return q};a.create=function(q){return q?[d.create(q[0]),
d.create(q[1]),d.create(q[2]),d.create(q[3]),d.create(q[4]),d.create(q[5])]:[d.create(),d.create(),d.create(),d.create(),d.create(),d.create()]};a.createPoints=c;a.fromMatrix=function(q,r,v,y=m){q=n.multiply(f.sm4d.get(),r,q);n.invert(q,q);for(r=0;8>r;++r){const B=h.transformMat4(f.sv4d.get(),u[r],q);k.set(y[r],B[0]/B[3],B[1]/B[3],B[2]/B[3])}l(v,y)};a.intersectClipRay=function(q,r){for(let v=0;6>v;v++)if(!d.clipInfinite(q[v],r))return!1;return!0};a.intersectsLineSegment=function(q,r,v){return w(q,
g.fromLineSegmentAndDirection(r,v,t.get()))};a.intersectsPoint=function(q,r){for(let v=0;6>v;v++)if(0<d.signedDistance(q[v],r))return!1;return!0};a.intersectsRay=function(q,r){return w(q,g.fromRay(r,t.get()))};a.intersectsSphere=function(q,r){for(let v=0;6>v;v++){const y=q[v];if(y[0]*r[0]+y[1]*r[1]+y[2]*r[2]+y[3]>=r[3])return!1}return!0};a.numPlanes=6;a.numPoints=8;a.planePointIndices=x;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/clipRay":function(){define(["exports",
"../../core/ObjectStack","../../chunks/vec32","./ray"],function(a,b,n,k){function p(d){return d?{ray:k.create(d.ray),c0:d.c0,c1:d.c1}:{ray:k.create(),c0:0,c1:Number.MAX_VALUE}}function h(d,f,c,l=p()){k.copy(d,l.ray);l.c0=f;l.c1=c;return l}function e(d,f,c){return n.add(c,d.ray.origin,n.scale(c,d.ray.direction,f))}const g=new b.ObjectStack(()=>p());a.copy=function(d,f=p()){return h(d.ray,d.c0,d.c1,f)};a.create=p;a.fromLineSegmentAndDirection=function(d,f,c=p()){const l=n.length(d.vector);k.fromValues(d.origin,
f,c.ray);c.c0=0;c.c1=l;return c};a.fromRay=function(d,f=p()){k.copy(d,f.ray);f.c0=0;f.c1=Number.MAX_VALUE;return f};a.fromValues=h;a.getAt=e;a.getEnd=function(d,f){return e(d,d.c1,f)};a.getStart=function(d,f){return e(d,d.c0,f)};a.wrap=function(d,f,c){const l=g.get();l.ray=d;l.c0=f;l.c1=c;return l};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/polygonExtentClipping":function(){define(["exports","../../core/libs/gl-matrix-2/math/vec2","../../core/libs/gl-matrix-2/factories/vec2f64"],
function(a,b,n){function k(c,l,w,x){w=h(w,x);c.length=0;if(l.length)for(w(f,l[0],l[0])===g.INSIDE&&p(c,l[0]),x=0;x<l.length;x++){const u=l[x===l.length-1?0:x+1];switch(w(f,l[x],u)){case g.INSIDE:p(c,u);break;case g.INSIDE_OUT:p(c,n.clone(f));break;case g.OUTSIDE_IN:p(c,n.clone(f)),p(c,u)}}}function p(c,l){0!==c.length&&b.equals(c.at(-1),l)||c.push(l)}function h(c,l){const w=l===d.LEFT||l===d.RIGHT?0:1,x=c[l],u=l===d.LEFT||l===d.BOTTOM?e.MIN:e.MAX,t=0===w?1:0;return(m,q,r)=>{if(q[w]<x&&r[w]<x)return u===
e.MIN?g.OUTSIDE:g.INSIDE;if(q[w]>x&&r[w]>x)return u===e.MIN?g.INSIDE:g.OUTSIDE;r=q[t]+(r[t]-q[t])/(r[w]-q[w])*(x-q[w]);m[w]=x;m[t]=r;return 0<(q[w]<x?1:-1)*u?g.OUTSIDE_IN:g.INSIDE_OUT}}var e;(function(c){c[c.MIN=1]="MIN";c[c.MAX=-1]="MAX"})(e||={});var g;(function(c){c[c.OUTSIDE=0]="OUTSIDE";c[c.INSIDE=1]="INSIDE";c[c.OUTSIDE_IN=2]="OUTSIDE_IN";c[c.INSIDE_OUT=3]="INSIDE_OUT"})(g||={});var d;(function(c){c[c.LEFT=0]="LEFT";c[c.BOTTOM=1]="BOTTOM";c[c.RIGHT=2]="RIGHT";c[c.TOP=3]="TOP"})(d||={});const f=
n.create();a.clipPolygonToExtent=function(c,l){const w=[],x=[];k(w,c,l,d.LEFT);k(x,w,l,d.BOTTOM);k(w,x,l,d.RIGHT);k(x,w,l,d.TOP);return x};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/libs/gl-matrix-2/math/vec2":function(){define(["exports","./common"],function(a,b){function n(L,P){L[0]=P[0];L[1]=P[1];return L}function k(L,P,R){L[0]=P;L[1]=R;return L}function p(L,P,R){L[0]=P[0]+R[0];L[1]=P[1]+R[1];return L}function h(L,P,R){L[0]=P[0]-R[0];L[1]=P[1]-R[1];return L}function e(L,
P,R){L[0]=P[0]*R[0];L[1]=P[1]*R[1];return L}function g(L,P,R){L[0]=P[0]/R[0];L[1]=P[1]/R[1];return L}function d(L,P){L[0]=Math.ceil(P[0]);L[1]=Math.ceil(P[1]);return L}function f(L,P){L[0]=Math.floor(P[0]);L[1]=Math.floor(P[1]);return L}function c(L,P,R){L[0]=Math.min(P[0],R[0]);L[1]=Math.min(P[1],R[1]);return L}function l(L,P,R){L[0]=Math.max(P[0],R[0]);L[1]=Math.max(P[1],R[1]);return L}function w(L,P){L[0]=Math.round(P[0]);L[1]=Math.round(P[1]);return L}function x(L,P,R){L[0]=P[0]*R;L[1]=P[1]*R;
return L}function u(L,P,R,W){L[0]=P[0]+R[0]*W;L[1]=P[1]+R[1]*W;return L}function t(L,P){const R=P[0]-L[0];L=P[1]-L[1];return Math.sqrt(R*R+L*L)}function m(L,P){const R=P[0]-L[0];L=P[1]-L[1];return R*R+L*L}function q(L){const P=L[0];L=L[1];return Math.sqrt(P*P+L*L)}function r(L){const P=L[0];L=L[1];return P*P+L*L}function v(L,P){L[0]=-P[0];L[1]=-P[1];return L}function y(L,P){L[0]=1/P[0];L[1]=1/P[1];return L}function B(L,P){var R=P[0];const W=P[1];R=R*R+W*W;0<R&&(R=1/Math.sqrt(R),L[0]=P[0]*R,L[1]=P[1]*
R);return L}function z(L,P){return L[0]*P[0]+L[1]*P[1]}function A(L,P,R){P=P[0]*R[1]-P[1]*R[0];L[0]=L[1]=0;L[2]=P;return L}function C(L,P,R,W){const V=P[0];P=P[1];L[0]=V+W*(R[0]-V);L[1]=P+W*(R[1]-P);return L}function H(L,P=1){const R=2*b.RANDOM()*Math.PI;L[0]=Math.cos(R)*P;L[1]=Math.sin(R)*P;return L}function E(L,P,R){const W=P[0];P=P[1];L[0]=R[0]*W+R[2]*P;L[1]=R[1]*W+R[3]*P;return L}function F(L,P,R){const W=P[0];P=P[1];L[0]=R[0]*W+R[2]*P+R[4];L[1]=R[1]*W+R[3]*P+R[5];return L}function G(L,P,R){const W=
P[0];P=P[1];L[0]=R[0]*W+R[3]*P+R[6];L[1]=R[1]*W+R[4]*P+R[7];return L}function D(L,P,R){const W=P[0];P=P[1];L[0]=R[0]*W+R[4]*P+R[12];L[1]=R[1]*W+R[5]*P+R[13];return L}function I(L,P,R,W){const V=P[0]-R[0];P=P[1]-R[1];const ba=Math.sin(W);W=Math.cos(W);L[0]=V*W-P*ba+R[0];L[1]=V*ba+P*W+R[1];return L}function J(L,P){var R=L[0];L=L[1];const W=P[0];P=P[1];let V=R*R+L*L;0<V&&(V=1/Math.sqrt(V));let ba=W*W+P*P;0<ba&&(ba=1/Math.sqrt(ba));R=(R*W+L*P)*V*ba;return 1<R?0:-1>R?Math.PI:Math.acos(R)}function N(L){return"vec2("+
L[0]+", "+L[1]+")"}function M(L,P){return L[0]===P[0]&&L[1]===P[1]}function Q(L,P){const R=L[0];L=L[1];const W=P[0];P=P[1];const V=b.getEpsilon();return Math.abs(R-W)<=V*Math.max(1,Math.abs(R),Math.abs(W))&&Math.abs(L-P)<=V*Math.max(1,Math.abs(L),Math.abs(P))}function O(L,P,R,W,V){let ba=P[0]-R[0];R=P[1]-R[1];V=(W[0]*ba+W[1]*R)*(V-1);ba=W[0]*V;R=W[1]*V;L[0]=P[0]+ba;L[1]=P[1]+R;return L}const K=Object.freeze(Object.defineProperty({__proto__:null,add:p,angle:J,ceil:d,copy:n,cross:A,dist:t,distance:t,
div:g,divide:g,dot:z,equals:Q,exactEquals:M,floor:f,inverse:y,len:q,length:q,lerp:C,max:l,min:c,mul:e,multiply:e,negate:v,normalize:B,projectAndScale:O,random:H,rotate:I,round:w,scale:x,scaleAndAdd:u,set:k,sqrDist:m,sqrLen:r,squaredDistance:m,squaredLength:r,str:N,sub:h,subtract:h,transformMat2:E,transformMat2d:F,transformMat3:G,transformMat4:D},Symbol.toStringTag,{value:"Module"}));a.add=p;a.angle=J;a.ceil=d;a.copy=n;a.cross=A;a.dist=t;a.distance=t;a.div=g;a.divide=g;a.dot=z;a.equals=Q;a.exactEquals=
M;a.floor=f;a.inverse=y;a.len=q;a.length=q;a.lerp=C;a.max=l;a.min=c;a.mul=e;a.multiply=e;a.negate=v;a.normalize=B;a.projectAndScale=O;a.random=H;a.rotate=I;a.round=w;a.scale=x;a.scaleAndAdd=u;a.set=k;a.sqrDist=m;a.sqrLen=r;a.squaredDistance=m;a.squaredLength=r;a.str=N;a.sub=h;a.subtract=h;a.transformMat2=E;a.transformMat2d=F;a.transformMat3=G;a.transformMat4=D;a.vec2=K;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/Frustum":function(){define(["exports","../../../chunks/vec32",
"../../../core/libs/gl-matrix-2/factories/vec3f64","../../../geometry/support/frustum"],function(a,b,n,k){function p(e,g,d){e.origin=g;e.endpoint=d;b.direction(e.direction,g,d)}class h{get planes(){return this.frustum}get points(){return this._points}get mutablePoints(){return this._points}get direction(){return this._direction}get origin(){return this._origin}constructor(e){this.renderCoordsHelper=e;this.frustum=k.create();this._points=k.createPoints();this.lines=Array(12);this._origin=n.create();
this._direction=n.create();this._altitude=null;for(e=0;12>e;e++)this.lines[e]={origin:null,direction:n.create(),endpoint:null}}update(e){k.fromMatrix(e.viewMatrix,e.projectionMatrix,this.frustum,this._points);b.copy(this._origin,e.eye);b.copy(this._direction,e.viewForward);this._altitude=this.renderCoordsHelper.getAltitude(this._origin);this._updateLines()}updatePoints(e){for(let g=0;g<this._points.length;g++)b.copy(this._points[g],e[g]);k.computePlanes(this.frustum,this._points);this._updateLines()}get altitude(){return this._altitude}intersectsSphere(e){return k.intersectsSphere(this.frustum,
e)}intersectsRay(e){return k.intersectsRay(this.frustum,e)}intersectsLineSegment(e,g){return k.intersectsLineSegment(this.frustum,e,g)}intersectsPoint(e){return k.intersectsPoint(this.frustum,e)}_updateLines(){const e=this._points;for(let g=0;4>g;g++){const d=g+4;p(this.lines[g],e[g],e[d]);p(this.lines[g+4],e[g],3===g?e[0]:e[g+1]);p(this.lines[g+8],e[d],3===g?e[4]:e[d+1])}}}h.planePointIndices=k.planePointIndices;h.nearFarLineIndices=[[k.PointIndex.NEAR_BOTTOM_LEFT,k.PointIndex.FAR_BOTTOM_LEFT],[k.PointIndex.NEAR_BOTTOM_RIGHT,
k.PointIndex.FAR_BOTTOM_RIGHT],[k.PointIndex.NEAR_TOP_RIGHT,k.PointIndex.FAR_TOP_RIGHT],[k.PointIndex.NEAR_TOP_LEFT,k.PointIndex.FAR_TOP_LEFT]];a.LineIndex=void 0;(function(e){e[e.NEAR_FAR_BOTTOM_LEFT=0]="NEAR_FAR_BOTTOM_LEFT";e[e.NEAR_FAR_BOTTOM_RIGHT=1]="NEAR_FAR_BOTTOM_RIGHT";e[e.NEAR_FAR_TOP_RIGHT=2]="NEAR_FAR_TOP_RIGHT";e[e.NEAR_FAR_TOP_LEFT=3]="NEAR_FAR_TOP_LEFT";e[e.NEAR_BOTTOM=4]="NEAR_BOTTOM";e[e.NEAR_RIGHT=5]="NEAR_RIGHT";e[e.NEAR_TOP=6]="NEAR_TOP";e[e.NEAR_LEFT=7]="NEAR_LEFT";e[e.FAR_BOTTOM=
8]="FAR_BOTTOM";e[e.FAR_RIGHT=9]="FAR_RIGHT";e[e.FAR_TOP=10]="FAR_TOP";e[e.FAR_LEFT=11]="FAR_LEFT"})(a.LineIndex||(a.LineIndex={}));a.Frustum=h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/cameraUtilsInternal":function(){define("exports ../../../core/mathUtils ../../../chunks/vec32 ../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../geometry/support/lineSegment ../../../geometry/support/plane".split(" "),function(a,b,n,k,p,h){const e=k.create(),g=k.create(),
d=k.create();a.clampLineSegmentToPlane=function(f,c,l,w){n.subtract(d,l,c);h.intersectLineSegment(w,p.wrap(c,d),f)||f===l||n.copy(f,l)};a.createDirectionUp=function(){return{direction:k.create(),up:k.create()}};a.directionToHeadingTilt=function(f,c,l,w,x){let u=n.normalize(e,f),t=n.dot(u,w);const m=0<t;t=Math.abs(t);.99<t&&(t=Math.abs(n.dot(c,w)),.99>t?(n.copy(u,c),m&&n.scale(u,u,-1)):u=null);c=0;u&&(n.scale(g,w,n.dot(w,u)),n.subtract(u,u,g),c=n.dot(u,x)/(n.length(u)*n.length(x)),n.cross(g,u,x),c=
(0<n.dot(g,w)?1:-1)*b.rad2deg(b.acosClamped(c)));f=b.rad2deg(b.acosClamped(-n.dot(w,f)/n.length(f)));if(!l)return{heading:c,tilt:f};l.heading=c;l.tilt=f;return l};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/cameraUtilsSpherical":function(){define("exports ../geometry ../core/Cyclical ../core/mathUtils ../core/libs/gl-matrix-2/math/mat4 ../core/libs/gl-matrix-2/factories/mat4f64 ./vec32 ../core/libs/gl-matrix-2/factories/vec3f64 ./vec42 ../core/libs/gl-matrix-2/factories/vec4f64 ../core/libs/gl-matrix-2/math/common ../geometry/ellipsoidUtils ../geometry/Extent ../geometry/SpatialReference ../geometry/support/coordsUtils ../geometry/support/frustum ../geometry/support/lineSegment ../geometry/support/plane ../geometry/support/ray ./sphere ../geometry/support/webMercatorUtils ../views/3d/state/Frustum ../views/3d/state/utils/viewUtils ../views/3d/support/cameraUtilsInternal ../views/3d/support/earthUtils ../views/3d/support/mathUtils ../geometry/Polygon".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w,x,u,t,m,q,r,v,y,B,z,A,C,H,E){function F(ka,ja,X,aa=A.createDirectionUp()){e.cross(ba,ka,P);0===e.dot(ba,ba)&&e.cross(ba,ka,R);p.fromRotation(V,-k.deg2rad(ja),ka);p.rotate(V,V,-k.deg2rad(X),ba);const {up:pa,direction:la}=aa;e.cross(pa,ba,ka);e.normalize(pa,pa);e.transformMat4(pa,pa,V);e.normalize(la,ka);e.negate(la,la);e.transformMat4(la,la,V);return aa}function G(ka,ja,X,aa){const pa=ba,la=U;e.normalize(pa,ka);e.cross(U,pa,P);0===e.dot(U,U)&&e.cross(U,pa,R);e.cross(la,
U,pa);return A.directionToHeadingTilt(ja,X,aa,pa,la)}function D(ka,ja,X,aa){const pa={eye:g.create(),up:null,tilt:aa,heading:X},la=ba;la[0]=ka[0];la[1]=ka[2];la[2]=-ka[1];X=k.deg2rad(X);var na=k.deg2rad(aa);aa=Math.sin(X);X=Math.cos(X);var qa=Math.sin(na),sa=Math.cos(na);const xa=e.length(la);if(1E-8>Math.abs(na))na=ja+xa;else{var ta=xa/qa,Ba=k.asinClamped(ja/ta);na=ta*Math.sin(Math.PI-na-Ba)}sa*=ja;ta=ja*ja*qa*qa;Ba=X*X*ta;const Ia=na-sa,Ca=Ia*Ia;var Ha=Ba*(Ba+Ca-la[1]*la[1]);if(0>Ha)return e.scale(pa.eye,
la,na/xa),pa.tilt=0,J(pa,ka);var Ga=Math.sqrt(Ha);const Aa=la[1]*Ia;Ha=Ba+Ca;Ga=0<X?-Ga+Aa:Ga+Aa;if(1E-8>Math.abs(Ha))return 1E-8>xa?(pa.eye[0]=0,pa.eye[1]=0,pa.eye[2]=ja):e.scale(pa.eye,la,na/xa),pa.tilt=0,I(pa.eye),J(pa,ka);pa.eye[1]=Ga/Ha;ja*=qa;Ga=pa.eye[1]*pa.eye[1];qa=1-Ga;Ha=Math.sqrt(qa);ta=Ba*Ga+aa*aa*ta-2*X*ja*pa.eye[1]*Ha*Ia+qa*Ca;if(1E-8>Math.abs(ta))return e.scale(pa.eye,la,na/xa),pa.tilt=0,I(pa.eye),J(pa,ka);pa.eye[0]=(qa*(na*la[0]-sa*la[0])-ja*Ha*(la[0]*pa.eye[1]*X+la[2]*aa))/ta;pa.eye[2]=
(qa*(na*la[2]-sa*la[2])-ja*Ha*(la[2]*pa.eye[1]*X-la[0]*aa))/ta;e.scale(pa.eye,pa.eye,na);I(pa.eye);return J(pa,ka)}function I(ka){const ja=ka[1];ka[1]=-ka[2];ka[2]=ja}function J(ka,ja){ja=F(ja,ka.heading,ka.tilt);ka.up=ja.up;return ka}function N(ka,ja,X){ja=e.length(ja);X=k.asinClamped(X/(Math.sqrt(X*X+ja*ja-2*X*ja*Math.cos(Math.PI-ka))/Math.sin(ka)));return k.rad2deg(ka-X)}function M(ka,ja,X){ka=k.deg2rad(ka);ja=e.length(ja);return k.asinClamped(X/(ja/Math.sin(ka)))+ka}function Q(ka,ja,X,aa,pa){function la(xa){const ta=
Math.PI/2;xa=n.cyclical2PI.normalize(xa,-ta);xa>ta&&(xa=Math.PI-xa);return xa}var na=ja.latitude;var qa=l.getReferenceEllipsoid(ka.spatialReference).radius;ja=ja.longitude;var sa=C.getLonDeltaForDistance(na,X,qa)/2;X=ja-sa;ja+=sa;na=k.deg2rad(na);na=(1+Math.sin(na))/(1-Math.sin(na));sa=(na+1)*Math.tan(aa/qa/2);na=1.5*Math.PI-2*Math.atan(.5*(sa+Math.sqrt(4*na+sa*sa)));aa=na+aa/qa;na=la(na);aa=la(aa);aa<na&&(qa=aa,aa=na,na=qa);na=Math.max(k.rad2deg(na),-90);aa=Math.min(k.rad2deg(aa),90);ja=W.monotonic(X,
ja);180<ja-X&&(qa=(ja-X-180)/2,X+=qa,ja-=qa);qa=ka.spatialReference&&ka.spatialReference.isGeographic?ka.spatialReference:x.WGS84;pa?(pa.xmin=X,pa.ymin=na,pa.xmax=ja,pa.ymax=aa,pa.spatialReference=qa):pa=new w(X,na,ja,aa,qa);ka.spatialReference&&ka.spatialReference.isWebMercator&&y.geographicToWebMercator(pa,!1,pa);return pa}function O(ka,ja){var X=ka.frustum,{renderCoordsHelper:aa}=ka,pa=aa.getAltitude(ja);const la=ka.spatialReference;var na=aa.referenceEllipsoid.radius,qa=ka.state.camera;const sa=
qa.eye;ja=1+e.distance(sa,ja)/(na+pa);ja=Math.sqrt(ja*ja-1);const {minCurvature:xa,maxCurvature:ta,minSamples:Ba,maxSamples:Ia}=da,{renderCoordsHelper:Ca,state:{camera:Ha}}=ka,{center:Ga,eye:Aa}=Ha;ka=Math.abs(Ca.getAltitude(Ga));na=Math.abs(Math.PI/2-z.viewAngle(Ca,Ga,Aa));v.fromRadius(ia,Ca.referenceEllipsoid.radius+ka);ka=v.cameraFrustumCoverage(ia,na,Ha.distance,Ha.fovY);ja=k.clamp((ja-xa)/(ta-xa),0,1);ja=Math.round(k.lerp(Ba,Ia,ja));na=qa.aboveGround;const Ja=X.planes[t.PlaneIndex.FAR],Sa=[],
$a=q.fromPositionAndNormal(g.ZEROS,fa,q.create());qa=q.fromPositionAndNormal(g.ZEROS,ha,q.create());d.set(ea,0,0,0,0);for(let La=0;4>La;La++){const Va=La===B.LineIndex.NEAR_FAR_BOTTOM_RIGHT&&!na||La===B.LineIndex.NEAR_FAR_TOP_LEFT&&na?1-ka:0,ma=La===B.LineIndex.NEAR_FAR_BOTTOM_RIGHT&&na||La===B.LineIndex.NEAR_FAR_TOP_LEFT&&!na?ka:1,za=X.lines[La],Na=X.lines[3===La?0:La+1];for(let Ra=0;Ra<ja;Ra++){var Wa=Ra/ja;Wa=La===B.LineIndex.NEAR_FAR_BOTTOM_RIGHT?1-(1-Wa)**2:La===B.LineIndex.NEAR_FAR_TOP_LEFT?
Wa**2:Wa;var Ta=0===Ra?0:k.lerp(Va,ma,Wa);Wa=e.lerp(S,za.origin,Na.origin,Ta);Ta=H.slerp(za.direction,Na.direction,Ta,T);aa.intersectManifoldClosestSilhouette(r.wrap(Wa,Ta),pa,Z);A.clampLineSegmentToPlane(Z,sa,Z,Ja);Sa.push(g.clone(Z));0!==Sa.length&&e.sqrDist(Sa.at(-1),Z);Wa=(q.isPointInside($a,Z)?1:0)|(q.isPointInside(qa,Z)?2:0);ea[Wa]=1}}2<Sa.length&&e.sqrDist(Sa[0],Sa.at(-1));if(1<d.squaredLength(ea)){X=L(Sa,$a);pa=[];for(Da of X)pa.push(...L(Da,qa));var Da=pa}else Da=[Sa];aa=K(Da,aa,la);return new E({rings:aa,
spatialReference:la})}function K(ka,ja,X){const aa=2*c.getEpsilon();return ka.map(pa=>{const la=[];var na=!1;for(var qa of pa)ja.fromRenderCoords(qa,Z,X),Math.abs(qa[0])<aa&&Math.abs(qa[1])<aa?(la.push([null,Z[1]]),la.push([null,Z[1]]),na=!0):la.push([Z[0],Z[1]]);if(na)for(pa=0;pa<la.length;pa++){qa=la[pa];if(null!=qa[0])continue;na=la[pa+1];const sa=la.at(0===pa?-1:pa-1);qa[0]=sa[0];pa++;qa=la.at(pa===la.length-1?0:pa+1);na[0]=qa[0]}la.push(la[0]);u.isClockwise(la)||la.reverse();return la})}function L(ka,
ja){const X=[],aa=[],pa=c.getEpsilon();for(let qa=0;qa<ka.length;qa++){const sa=ka[qa];var la=m.fromPoints(sa,qa===ka.length-1?ka[0]:ka[qa+1],Y);la=q.intersectLineOrRay(ja,la.origin,la.vector,q.IntersectFlags.NONE,Z);switch(la){case q.IntersectResult.INSIDE:X.push(sa);break;case q.IntersectResult.OUTSIDE:aa.push(sa);break;case q.IntersectResult.INTERSECTS_INSIDE_OUT:case q.IntersectResult.INTERSECTS_OUTSIDE_IN:const [xa,ta,Ba]=la===q.IntersectResult.INTERSECTS_INSIDE_OUT?[1,X,aa]:[-1,aa,X];var na=
q.getNormal(ja);la=e.scaleAndAdd(g.create(),Z,na,xa*pa);na=e.scaleAndAdd(g.create(),Z,na,xa*-pa);ta.push(sa);ta.push(la);Ba.push(na)}}ka=[];X.length&&ka.push(X);aa.length&&ka.push(aa);return ka}const P=g.fromValues(0,0,1),R=e.normalize(g.create(),g.fromValues(1,1,1)),W=new n.Cyclical(-180,180),V=h.create(),ba=g.create(),U=g.create(),da={minCurvature:k.deg2rad(5),maxCurvature:k.deg2rad(50),minSamples:1,maxSamples:6},fa=g.fromValues(1,0,0),ha=g.fromValues(0,1,0),T=g.create(),S=g.create(),Z=g.create(),
ia=v.create(),Y=m.create(),ea=f.create();b=Object.freeze(Object.defineProperty({__proto__:null,directionToHeadingTilt:G,eyeForCenterWithHeadingTilt:D,eyeTiltToLookAtTilt:M,headingTiltToDirectionUp:F,lookAtTiltToEyeTilt:N,toArea:O,toExtent:Q},Symbol.toStringTag,{value:"Module"}));a.cameraUtilsSpherical=b;a.directionToHeadingTilt=G;a.eyeForCenterWithHeadingTilt=D;a.eyeTiltToLookAtTilt=M;a.headingTiltToDirectionUp=F;a.lookAtTiltToEyeTilt=N;a.toArea=O;a.toExtent=Q})},"esri/views/3d/state/utils/viewUtils":function(){define(["exports",
"../../../../core/mathUtils","../../../../chunks/vec32","../../../../core/libs/gl-matrix-2/factories/vec3f64"],function(a,b,n,k){const p=k.create(),h=k.create();a.viewAngle=function(e,g,d){e.worldUpAtPosition(g,p);n.subtract(h,d,g);e=n.length(h);return 0===e?0:b.acosClamped(n.dot(h,p)/e)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/earthUtils":function(){define(["exports","../../../core/mathUtils","../../../geometry/ellipsoidUtils","../../../geometry/Point"],
function(a,b,n,k){function p(g,d,f){if(null==d.longitude||null==d.latitude||null==f.longitude||null==f.latitude)throw Error("Invalid points: no lon/lat");return h(g,d.longitude,d.latitude,f.longitude,f.latitude)}function h(g,d,f,c,l){f=b.deg2rad(f);l=b.deg2rad(l);d=b.deg2rad(d);const w=b.deg2rad(c);c=Math.sin((f-l)/2);d=Math.sin((d-w)/2);f=2*b.asinClamped(Math.sqrt(c*c+Math.cos(f)*Math.cos(l)*d*d));return Math.round(f*g*1E4)/1E4}function e(g,d){g/=15;d||(g=Math.round(g));return g}a.getGreatCircleDistance=
h;a.getGreatCircleDistanceFromPoints=p;a.getGreatCircleSpanAt=function(g,d,f){const c=d.spatialReference,l=n.getReferenceEllipsoid(c),w=new k(d.x,g.y,c),x=new k(f.x,g.y,c);d=new k(g.x,d.y,c);g=new k(g.x,f.y,c);return{lon:p(l.radius,w,x),lat:p(l.radius,d,g)}};a.getLonDeltaForDistance=function(g,d,f){d/=f;g=b.deg2rad(g);d=Math.sin(d/2);g=Math.cos(g);g=2*b.asinClamped(Math.sqrt(d*d/(g*g)));return b.rad2deg(g)};a.longitudeToTimezone=e;a.positionToTimezoneInfo=function(g,d){g=g?.[0];if(null==g)return null;
d||={hours:0,minutes:0,seconds:0};d.hours=e(g,!0);g=d.hours%1;d.hours-=g;d.minutes=60*g;g=d.minutes%1;d.minutes-=g;d.seconds=Math.round(60*g);return d};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/ElevationProvider":function(){define(["exports","../../../layers/graphics/dehydratedFeatureUtils"],function(a,b){function n(p){return"array"in p}class k{constructor(p,h=null,e=0){this.array=p;this.spatialReference=h;this.offset=e}}a.SamplePosition=k;a.getElevationAtPoint=
function(p,h,e="ground"){if(b.isDehydratedPoint(h))return p.getElevation(h.x,h.y,h.z||0,h.spatialReference,e);if(n(h)){let g=h.offset;return p.getElevation(h.array[g++],h.array[g++],h.array[g]||0,h.spatialReference??p.spatialReference,e)}return p.getElevation(h[0],h[1],h[2]||0,p.spatialReference,e)};a.isSamplePosition=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/dehydratedFeatureUtils":function(){define(["exports"],function(a){a.isDehydratedPoint=function(b){return"point"===
b.type};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/support/spatialReferenceSupport":function(){define(["exports","../../geometry/support/SupportedGCSWkids","../ViewingMode"],function(a,b,n){a.isSpatialReferenceSupported=function(k,p){return null==k?!1:null==p?!0:p===n.ViewingMode.Local?k.isGeographic?k.isWGS84||k.wkid===b.SupportedGCSWkids.CGCS2000:!0:k.isWebMercator||k.isWGS84||k.wkid===b.SupportedGCSWkids.CGCS2000||k.wkid===b.SupportedGCSWkids.GCSMARS2000||k.wkid===
b.SupportedGCSWkids.GCSMARS2000_SPHERE||k.wkid===b.SupportedGCSWkids.GCSMOON2000};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/support/GroundViewElevationSampler":function(){define("../../chunks/tslib.es6 ../../core/Evented ../../core/Logger ../../core/accessorSupport/decorators/property ../../core/has ../../core/RandomLCG ../../core/accessorSupport/decorators/subclass ../../geometry/SpatialReference ../../geometry/support/aaBoundingRect ../../geometry/support/contains ../../layers/support/ElevationSampler ../3d/terrain/TerrainConst".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l){b=class extends b.EventedAccessor{constructor(w){super(w);this.demResolution={min:-1,max:-1};this.noDataValue=l.elevationNoDataValue}initialize(){this.view.basemapTerrain.on("elevation-change",()=>this.emit("changed",{}))}get extent(){const w=this.view.basemapTerrain;if(null==w?.extent||null==w.spatialReference)return null;const x=d.toExtent(w.extent,w.spatialReference);x.zmin=w.visibleElevationBounds.min;x.zmax=w.visibleElevationBounds.max;return x}get spatialReference(){return this.view.basemapTerrain?.spatialReference??
g.WGS84}elevationAt(w,x){if(null==this.extent||!f.extentContainsXYZ(this.extent,w,x)){const u=null!=this.extent?`${this.extent.xmin}, ${this.extent.ymin}, ${this.extent.xmax}, ${this.extent.ymax}`:null;n.getLogger(this).warn("#elevationAt()",`Point used to sample elevation (${w}, ${x}) is outside of the sampler extent (${u})`);return this.noDataValue}return this.view.elevationProvider?.getElevation(w,x,0,this.spatialReference,"ground")??this.noDataValue}queryElevation(w){return c.updateGeometryElevation(w.clone(),
this)}};a.__decorate([k.property({readOnly:!0})],b.prototype,"demResolution",void 0);a.__decorate([k.property({readOnly:!0})],b.prototype,"extent",null);a.__decorate([k.property({readOnly:!0})],b.prototype,"noDataValue",void 0);a.__decorate([k.property()],b.prototype,"spatialReference",null);a.__decorate([k.property({constructOnly:!0})],b.prototype,"view",void 0);return b=a.__decorate([e.subclass("esri.views.support.GroundViewElevationSampler")],b)})},"esri/layers/support/ElevationSampler":function(){define("exports ../../geometry ../../core/has ../../core/handleUtils ../../core/Logger ../../core/unitUtils ../../geometry/support/aaBoundingRect ../../geometry/support/webMercatorUtils ../../geometry/Point".split(" "),
function(a,b,n,k,p,h,e,g,d){function f(m,q){const r=c(m,q.spatialReference);if(!r)return null;switch(m.type){case "point":m.z=q.elevationAt(r.x,r.y);break;case "polyline":t.spatialReference=r.spatialReference;var v=m.hasM&&!m.hasZ;for(var y=0;y<m.paths.length;y++){var B=m.paths[y],z=r.paths[y];for(let A=0;A<B.length;A++){const C=B[A],H=z[A];t.x=H[0];t.y=H[1];v&&(C[3]=C[2]);C[2]=q.elevationAt(t.x,t.y)}}m.hasZ=!0;break;case "multipoint":t.spatialReference=r.spatialReference;v=m.hasM&&!m.hasZ;for(y=
0;y<m.points.length;y++)B=m.points[y],z=r.points[y],t.x=z[0],t.y=z[1],v&&(B[3]=B[2]),B[2]=q.elevationAt(t.x,t.y);m.hasZ=!0}return m}function c(m,q){if(null==m)return null;const r=m.spatialReference;if(r.equals(q))return m;(m=g.project(m,q))||l().error(`Cannot project geometry spatial reference (wkid:${r.wkid}) to elevation sampler spatial reference (wkid:${q.wkid})`);return m}const l=()=>p.getLogger("esri.layers.support.ElevationSampler");class w{queryElevation(m){return f(m.clone(),this)}on(){return k.makeHandle()}projectIfRequired(m,
q){return c(m,q)}}class x extends w{get spatialReference(){return this.extent.spatialReference}constructor(m,q,r){super();this.tile=m;this.noDataValue=r;r=m.tile.extent;this.extent=e.toExtent(r,q.spatialReference);this.extent.zmin=m.zmin;this.extent.zmax=m.zmax;this._aaExtent=r;r=h.getMetersPerUnitForSR(q.spatialReference);m=q.lodAt(m.tile.level).resolution*r;this.demResolution={min:m,max:m}}contains(m){m=this.projectIfRequired(m,this.spatialReference);return null==m?!1:this.containsAt(m.x,m.y)}containsAt(m,
q){return e.containsXY(this._aaExtent,m,q)}elevationAt(m,q){if(!this.containsAt(m,q)){var r=this.extent;r=`${r.xmin}, ${r.ymin}, ${r.xmax}, ${r.ymax}`;l().warn("#elevationAt()",`Point used to sample elevation (${m}, ${q}) is outside of the sampler extent (${r})`);return this.noDataValue}return this.tile.sample(m,q)??this.noDataValue}}class u extends w{get spatialReference(){return this.extent.spatialReference}constructor(m,q,r){super();let v;"number"===typeof q?(this.noDataValue=q,v=null):(v=q,this.noDataValue=
r);this.samplers=v?m.map(y=>new x(y,v,this.noDataValue)):m;if(m=this.samplers[0]){this.extent=m.extent.clone();const {min:y,max:B}=m.demResolution;this.demResolution={min:y,max:B};for(m=1;m<this.samplers.length;m++)q=this.samplers[m],this.extent.union(q.extent),this.demResolution.min=Math.min(this.demResolution.min,q.demResolution.min),this.demResolution.max=Math.max(this.demResolution.max,q.demResolution.max)}else this.extent=e.toExtent(e.create(),v.spatialReference),this.demResolution={min:0,max:0}}elevationAt(m,
q){let r,v=!1;for(const y of this.samplers)if(y.containsAt(m,q)&&(v=!0,r=y.elevationAt(m,q),r!==y.noDataValue))return r;if(null!=r)return r;v||l().warn("#elevationAt()",`Point used to sample elevation (${m}, ${q}) is outside of the sampler`);return this.noDataValue}}const t=new d;a.ElevationSamplerBase=w;a.MultiTileElevationSampler=u;a.TileElevationSampler=x;a.updateGeometryElevation=f;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/TerrainConst":function(){define(["exports",
"../../../core/mathUtils","../../../geometry/support/aaBoundingRect","./TilingScheme"],function(a,b,n,k){b=b.clampFloat32(b.numberMaxFloat32/10);const p=n.create();k.TilingScheme.WebMercatorAuxiliarySphere.getExtent(0,0,0,p);n=n.create([-180,-90,180,90]);a.elevationNoDataValue=b;a.geographicWorldExtent=n;a.maxMemoryLodBias=2.5;a.maxPatchTesselation=512;a.maxRootTiles=64;a.maxTileNeighborLevelDelta=4;a.progressiveLoadingModulo=2;a.tooManyRootTilesAfterChangeError="Cannot extend surface to encompass all layers because it would result in too many root tiles.";
a.tooManyRootTilesForLayerError="Surface extent is too large for tile resolution at level 0.";a.webMercatorWorldExtent=p;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/TilingScheme":function(){define("exports ../../../geometry ../../../core/Error ../../../core/has ../../../core/mathUtils ../../../core/unitUtils ../../../geometry/Extent ../../../geometry/SpatialReference ../../../geometry/support/aaBoundingRect ../../../geometry/support/spatialReferenceUtils ../../../geometry/support/webMercatorUtils ../../../layers/support/LOD ../../../layers/support/TileInfo ../../../geometry/Point".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w,x){function u(){return new n("tilingscheme:tile-info-missing","Tiling scheme must have tiling information")}class t{constructor(q){var r=t.checkUnsupported(q);if(null!=r)throw r;this.spatialReference=q.spatialReference;this._isWebMercator=this.spatialReference.isWebMercator;this._isGCS=f.isGeographic(this.spatialReference);this.origin=[q.origin.x,q.origin.y];this.pixelSize=q.size[0];this.dpi=q.dpi;var v=q.lods.reduce((z,A)=>{A.level<z.minLod.level&&(z.minLod=A);
z.max=Math.max(z.max,A.level);return z},{minLod:q.lods[0],max:-Infinity}),y=v.minLod;const B=2**y.level;r=y.resolution*B;y=y.scale*B;this.levels=Array(v.max+1);for(v=0;v<this.levels.length;v++)this.levels[v]={resolution:r,scale:y,tileSize:[r*q.size[0],r*q.size[1]]},r/=2,y/=2}clone(){return new t(this.toTileInfo())}toTileInfo(){return new w({dpi:this.dpi,origin:new x({x:this.origin[0],y:this.origin[1],spatialReference:this.spatialReference}),size:[this.pixelSize,this.pixelSize],spatialReference:this.spatialReference,
lods:this.levels.map((q,r)=>new l({level:r,scale:q.scale,resolution:q.resolution}))})}getExtent(q,r,v,y){var B=this.levels[q];q=B.tileSize[0];B=B.tileSize[1];y[0]=this.origin[0]+v*q;y[2]=this.origin[0]+(v+1)*q;y[3]=this.origin[1]-r*B;y[1]=this.origin[1]-(r+1)*B}convertExtentToRadians(q,r){this._isWebMercator?(r[0]=c.x2lon(q[0]),r[1]=c.y2lat(q[1]),r[2]=c.x2lon(q[2]),r[3]=c.y2lat(q[3])):this._isGCS&&(r[0]=p.deg2rad(q[0]),r[1]=p.deg2rad(q[1]),r[2]=p.deg2rad(q[2]),r[3]=p.deg2rad(q[3]))}getExtentGeometry(q,
r,v,y=new e){this.getExtent(q,r,v,m);y.spatialReference=this.spatialReference;y.xmin=m[0];y.ymin=m[1];y.xmax=m[2];y.ymax=m[3];y.zmin=void 0;y.zmax=void 0;return y}ensureMaxLod(q){if(null==q)return!1;for(var r=!1;this.levels.length<=q;){const {resolution:v,scale:y}=this.levels[this.levels.length-1];r=v/2*this.pixelSize;this.levels.push({resolution:v/2,scale:y/2,tileSize:[r,r]});r=!0}return r}capMaxLod(q){this.levels.length>q+1&&(this.levels.length=q+1)}getMaxLod(){return this.levels.length-1}scaleAtLevel(q){return this.levels[0].scale/
2**q}levelAtScale(q){const r=this.levels[0].scale;return q>=r?0:Math.log(r/q)*Math.LOG2E}resolutionAtLevel(q){return this.levels[0].resolution/2**q}compatibleWith(q,r=Infinity){if(t.checkUnsupported(q))return!1;q=new t(q);if(!q.spatialReference.equals(this.spatialReference)||q.pixelSize!==this.pixelSize)return!1;r=Math.min(this.levels.length-1,q.levels.length-1,r);const v=this.levels[r].resolution;let y=.5*v;if(!p.floatEqualAbsolute(q.origin[0],this.origin[0],y)||!p.floatEqualAbsolute(q.origin[1],
this.origin[1],y))return!1;y=.5*v/2**r/this.pixelSize*12;return p.floatEqualAbsolute(v,q.levels[r].resolution,y)}rootTilesInExtent(q,r=null,v=Infinity){const y=[],B=this.levels[0].tileSize;if(null==q||0===B[0]||0===B[1])return y;t.computeRowColExtent(q,B,this.origin,m);q=m[1];let z=m[3],A=m[0],C=m[2];var H=C-A;const E=z-q;H*E>v&&(v=Math.floor(Math.sqrt(v)),E>v&&(q=q+Math.floor(.5*E)-Math.floor(.5*v),z=q+v),H>v&&(A=A+Math.floor(.5*H)-Math.floor(.5*v),C=A+v));for(v=q;v<z;v++)for(H=A;H<C;H++)y.push([0,
v,H]);null!=r&&(r[0]=this.origin[0]+A*B[0],r[1]=this.origin[1]-z*B[1],r[2]=this.origin[0]+C*B[0],r[3]=this.origin[1]-q*B[1]);return y}static computeRowColExtent(q,r,v,y){const B=.001*(q[2]-q[0]+(q[3]-q[1]));y[0]=Math.max(0,Math.floor((q[0]+B-v[0])/r[0]));y[2]=Math.max(0,Math.ceil((q[2]-B-v[0])/r[0]));y[1]=Math.max(0,Math.floor((v[1]-q[3]+B)/r[1]));y[3]=Math.max(0,Math.ceil((v[1]-q[1]-B)/r[1]))}static isPowerOfTwo(q){q=q.lods;const r=q[0].resolution*2**q[0].level;return!q.some(v=>!p.floatEqualRelative(v.resolution,
r/2**v.level))}static hasGapInLevels(q){q=q.lods.map(r=>r.level);q.sort((r,v)=>r-v);for(let r=1;r<q.length;r++)if(q[r]!==q[0]+r)return!0;return!1}static tileSizeSupported(q){const r=q.size[1];return r===q.size[0]&&0===(r&r-1)&&128<=r&&512>=r}static hasOriginPerLODs(q){const r=q.origin;return q.lods.some(v=>null!=v.origin&&(v.origin[0]!==r.x||v.origin[1]!==r.y))}static getMissingTileInfoError(){return new n("tilingscheme:tile-info-missing","Tiling scheme must have tiling information")}static checkUnsupported(q){return null==
q?u():1>q.lods.length?new n("tilingscheme:generic","Tiling scheme must have at least one level"):t.isPowerOfTwo(q)?t.hasGapInLevels(q)?new n("tilingscheme:gaps","Tiling scheme levels must not have gaps between min and max level"):t.tileSizeSupported(q)?t.hasOriginPerLODs(q)?new n("tilingscheme:multiple-origin","Tiling scheme levels must not have their own origin"):null:new n("tilingscheme:tile-size","Tiles must be square and size must be one of [128, 256, 512]"):new n("tilingscheme:power-of-two",
"Tiling scheme must be power of two")}static fromExtent(q,r){const v=q[2]-q[0],y=q[3]-q[1];var B=h.getMetersPerUnitForSR(r);const z=1.2*Math.max(v,y),A=z/256;B=96/.0254*B*A;q=new t(new w({size:[256,256],origin:new x({x:q[0]-.5*(z-v),y:q[3]+.5*(z-y)}),lods:[new l({level:0,resolution:A,scale:B})],spatialReference:r}));q.ensureMaxLod(20);return q}static makeWebMercatorAuxiliarySphere(q){const r=new t(t.WebMercatorAuxiliarySphereTileInfo);r.ensureMaxLod(q);return r}static makeGCSWithTileSize(q,r=256,
v=16){const y=256/r;q=new t(new w({size:[r,r],origin:new x({x:-180,y:90,spatialReference:q}),spatialReference:q,lods:[new l({level:0,resolution:.703125*y,scale:2.95497598570834E8*y})]}));q.ensureMaxLod(v);return q}get test(){}}t.WebMercatorAuxiliarySphereTileInfo=new w({size:[256,256],origin:new x({x:-2.0037508342787E7,y:2.0037508342787E7,spatialReference:g.WebMercator}),spatialReference:g.WebMercator,lods:[new l({level:0,resolution:156543.03392800014,scale:5.91657527591555E8})]});t.WebMercatorAuxiliarySphere=
t.makeWebMercatorAuxiliarySphere(19);const m=d.create();a.TilingScheme=t;a.getMissingTileInfoError=u;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/LOD":function(){define("../../chunks/tslib.es6 ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/RandomLCG ../../core/has ../../core/accessorSupport/decorators/subclass".split(" "),function(a,b,n,k,p,h,e){var g;b=g=class extends b.JSONSupport{constructor(d){super(d);
this.cols=null;this.level=0;this.origin=this.levelValue=null;this.resolution=0;this.rows=null;this.scale=0}clone(){return new g({cols:this.cols,level:this.level,levelValue:this.levelValue,resolution:this.resolution,rows:this.rows,scale:this.scale})}};a.__decorate([n.property({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],b.prototype,"cols",void 0);a.__decorate([n.property({type:k.Integer,json:{write:!0}})],b.prototype,"level",void 0);a.__decorate([n.property({type:String,
json:{write:!0}})],b.prototype,"levelValue",void 0);a.__decorate([n.property({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],b.prototype,"origin",void 0);a.__decorate([n.property({type:Number,json:{write:!0}})],b.prototype,"resolution",void 0);a.__decorate([n.property({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],b.prototype,"rows",void 0);a.__decorate([n.property({type:Number,json:{write:!0}})],b.prototype,
"scale",void 0);return b=g=a.__decorate([e.subclass("esri.layers.support.LOD")],b)})},"esri/layers/support/TileInfo":function(){define("../../chunks/tslib.es6 ../../core/jsonMap ../../core/JSONSupport ../../core/unitUtils ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/RandomLCG ../../core/has ../../core/accessorSupport/decorators/reader ../../core/accessorSupport/decorators/subclass ../../core/accessorSupport/decorators/writer ../../geometry/Point ../../geometry/SpatialReference ../../geometry/support/aaBoundingRect ../../geometry/support/spatialReferenceUtils ../../geometry/support/webMercatorUtils ./LOD ./TileKey".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w,x,u,t,m,q){var r;b=new b.JSONMap({PNG:"png",PNG8:"png8",PNG24:"png24",PNG32:"png32",JPEG:"jpg",JPG:"jpg",DIB:"dib",TIFF:"tiff",EMF:"emf",PS:"ps",PDF:"pdf",GIF:"gif",SVG:"svg",SVGZ:"svgz",Mixed:"mixed",MIXED:"mixed",LERC:"lerc",LERC2D:"lerc2d",RAW:"raw",pbf:"pbf"});n=r=class extends n.JSONSupport{static create(v={}){const {resolutionFactor:y=1,scales:B,size:z=256,spatialReference:A=w.WebMercator,numLODs:C=24}=v;if(!u.isValid(A)){v=[];if(B)for(var H=0;H<B.length;H++){var E=
B[H];v.push(new m({level:H,scale:E,resolution:E}))}else for(H=5E-4,E=C-1;0<=E;E--)v.unshift(new m({level:E,scale:H,resolution:H})),H*=2;return new r({dpi:96,lods:v,origin:new l(0,0,A),size:[z,z],spatialReference:A})}H=u.getInfo(A);v=v.origin?new l({x:v.origin.x,y:v.origin.y,spatialReference:A}):H?new l({x:H.origin[0],y:H.origin[1],spatialReference:A}):new l({x:0,y:0,spatialReference:A});H=1/(39.37*k.getMetersPerUnitForSR(A)*96);E=[];if(B)for(var F=0;F<B.length;F++){var G=B[F];E.push(new m({level:F,
scale:G,resolution:G*H}))}else{var D=u.isGeographic(A)?512/z*5.916575275917094E8:256/z*5.91657527591555E8;F=Math.ceil(C/y);E.push(new m({level:0,scale:D,resolution:D*H}));for(G=1;G<F;G++)D/=2**y,E.push(new m({level:G,scale:D,resolution:D*H}))}return new r({dpi:96,lods:E,origin:v,size:[z,z],spatialReference:A})}constructor(v){super(v);this.dpi=96;this.spatialReference=this.size=this.origin=this.format=null}get isWrappable(){const {spatialReference:v,origin:y}=this;if(v&&y){const B=u.getInfo(v);return v.isWrappable&&
!!B&&Math.abs(B.origin[0]-y.x)<=B.dx}return!1}readOrigin(v,y){return l.fromJSON({spatialReference:y.spatialReference,...v})}set lods(v){const y=[],B=this._levelToLOD={};v&&v.forEach(z=>{y.push(z.scale);B[z.level]=z});this._set("scales",y);this._set("lods",v);this._initializeUpsampleLevels()}readSize(v,y){return[y.cols,y.rows]}writeSize(v,y){y.cols=v[0];y.rows=v[1]}zoomToScale(v){const y=this.scales;if(0>=v)return y[0];if(v>=y.length-1)return y[y.length-1];const B=Math.floor(v);return y[B]/(y[B]/y[B+
1])**(v-B)}scaleToZoom(v){const y=this.scales,B=y.length-1;let z=0;for(;z<B;z++){const A=y[z],C=y[z+1];if(A<=v)break;if(C===v)return z+1;if(A>v&&C<v)return z+Math.log(A/v)/Math.log(A/C)}return z}tileAt(v,y,B,z){var A=this.lodAt(v);if(!A)return null;let C;if("number"===typeof y)C=y,y=B;else{if(u.equals(y.spatialReference,this.spatialReference))C=y.x,y=y.y;else{z=t.project(y,this.spatialReference);if(null==z)return null;C=z.x;y=z.y}z=B}B=A.resolution*this.size[0];A=A.resolution*this.size[1];z||=new q.TileKey(null,
0,0,0,x.create());z.level=v;z.row=Math.floor((this.origin.y-y)/A+.001);z.col=Math.floor((C-this.origin.x)/B+.001);this.updateTileInfo(z);return z}updateTileInfo(v,y=r.ExtrapolateOptions.NONE){var B=this.lodAt(v.level);B||y!==r.ExtrapolateOptions.POWER_OF_TWO||(y=this.lods[this.lods.length-1],y.level<v.level&&(B=y));if(B){var z=v.level-B.level;y=B.resolution*this.size[0]/2**z;B=B.resolution*this.size[1]/2**z;v.id=`${v.level}/${v.row}/${v.col}`;v.extent||(v.extent=x.create());v.extent[0]=this.origin.x+
v.col*y;v.extent[1]=this.origin.y-(v.row+1)*B;v.extent[2]=v.extent[0]+y;v.extent[3]=v.extent[1]+B}}upsampleTile(v){const y=this._upsampleLevels[v.level];if(!y||-1===y.parentLevel)return!1;v.level=y.parentLevel;v.row=Math.floor(v.row/y.factor+.001);v.col=Math.floor(v.col/y.factor+.001);this.updateTileInfo(v);return!0}getTileBounds(v,y){var B=this.lodAt(y.level);if(null==B)return null;var {resolution:z}=B;B=z*this.size[0];z*=this.size[1];v[0]=this.origin.x+y.col*B;v[1]=this.origin.y-(y.row+1)*z;v[2]=
v[0]+B;v[3]=v[1]+z;return v}lodAt(v){return this._levelToLOD?.[v]??null}clone(){return r.fromJSON(this.write({}))}getCompatibleForVTL(v){if(this.size[0]!==this.size[1]||256===this.size[0]&&512===v)return null;const y=(512===this.size[0]&&256===v?-1:0)+(this.spatialReference.isGeographic?1:0);if(this.size[0]===v&&0===y)return this;const B=[],z=this.lods.length-y;for(let A=0;A<z;A++){const C=A+y,{scale:H,resolution:E}=0<=C?this.lods[C]:{scale:2*this.lods[0].scale,resolution:2*this.lods[0].resolution};
B.push(new m({level:A,scale:H,resolution:E}))}return new r({size:[v,v],dpi:this.dpi,format:this.format,compressionQuality:this.compressionQuality,origin:this.origin,spatialReference:this.spatialReference,lods:B})}_initializeUpsampleLevels(){const v=this.lods;this._upsampleLevels=[];let y=null;for(let B=0;B<v.length;B++){const z=v[B];this._upsampleLevels[z.level]={parentLevel:y?y.level:-1,factor:y?y.resolution/z.resolution:0};y=z}}};a.__decorate([p.property({type:Number,json:{write:!0}})],n.prototype,
"compressionQuality",void 0);a.__decorate([p.property({type:Number,json:{write:!0}})],n.prototype,"dpi",void 0);a.__decorate([p.property({type:String,json:{read:b.read,write:b.write,origins:{"web-scene":{read:!1,write:!1}}}})],n.prototype,"format",void 0);a.__decorate([p.property({readOnly:!0})],n.prototype,"isWrappable",null);a.__decorate([p.property({type:l,json:{write:!0}})],n.prototype,"origin",void 0);a.__decorate([d.reader("origin")],n.prototype,"readOrigin",null);a.__decorate([p.property({type:[m],
value:null,json:{write:!0}})],n.prototype,"lods",null);a.__decorate([p.property({readOnly:!0})],n.prototype,"scales",void 0);a.__decorate([p.property({cast:v=>Array.isArray(v)?v:"number"===typeof v?[v,v]:[256,256]})],n.prototype,"size",void 0);a.__decorate([d.reader("size",["rows","cols"])],n.prototype,"readSize",null);a.__decorate([c.writer("size",{cols:{type:h.Integer},rows:{type:h.Integer}})],n.prototype,"writeSize",null);a.__decorate([p.property({type:w,json:{write:!0}})],n.prototype,"spatialReference",
void 0);n=r=a.__decorate([f.subclass("esri.layers.support.TileInfo")],n);(function(v){v=v.ExtrapolateOptions||(v.ExtrapolateOptions={});v[v.NONE=0]="NONE";v[v.POWER_OF_TWO=1]="POWER_OF_TWO"})(n||={});return n})},"esri/layers/support/TileKey":function(){define(["exports"],function(a){class b{constructor(n,k,p,h,e){this.id=n;this.level=k;this.row=p;this.col=h;this.extent=e}}a.TileKey=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/PopupView":function(){define("require exports ../chunks/tslib.es6 ../core/asyncUtils ../core/Error ../core/has ../core/Logger ../core/promiseUtils ../core/reactiveUtils ../core/accessorSupport/decorators/property ../core/RandomLCG ../core/accessorSupport/decorators/subclass ./input/InputManager".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w){function x(q){return null!=q&&"open"in q&&"declaredClass"in q}function u(q){return null!=q&&"declaredClass"in q&&"dockOptions"in q}const t=q=>Object.freeze(Object.defineProperty({__proto__:null,default:q},Symbol.toStringTag,{value:"Module"}));class m{constructor(q){this.layerView=q;this._resolver=g.createResolver();this.graphics=[]}get promise(){return this._resolver.promise}resolve(q){const {layerView:r,graphics:v,_resolver:y}=this;if(!r)return y.resolve(v),y.promise;
let B;r.fetchPopupFeaturesFromGraphics(v,q).catch(z=>{B=z;return null}).then(z=>{z?y.resolve(z):y.reject(B)});return y.promise}}b.PopupView=q=>{q=class extends q{constructor(){super(...arguments);this._popupSetupTask=null;this.popup={};this.popupEnabled=!0}initialize(){this.addHandles([d.watch(()=>[this.ui,this.popup],([r,v],y)=>{if(y){const [B,z]=y;B&&x(z)&&(z.view=null,u(z)&&B.remove(z,"popup"))}r&&x(v)&&(v.view=this,u(v)&&r.add(v,{key:"popup",position:"manual",internal:!0}))},d.initial),this.on("click",
r=>{this.popup&&this.popupEnabled&&("mouse"!==r.pointerType||0===r.button)&&(x(this.popup)?this.popup.viewModel.handleViewClick(r):r.async(async()=>{await this.setupPopup();x(this.popup)&&!this.destroyed&&this.ready&&this.popupEnabled&&this.popup.viewModel.handleViewClick(r)}))},w.ViewEventPriorities.WIDGET)]);d.whenOnce(()=>this.ready&&this.popupEnabled&&!this.updating).then(()=>{new Promise((r,v)=>a(["../widgets/Popup"],y=>r(t(y)),v))})}destroy(){this.destroyed||this.closePopup()}async openPopup(r){if(x(this.popup))return this.popup.open(r);
try{await this.setupPopup(),this.popup?this.popup.open(r):e.getLogger(this).error(new p("view:null-popup","Popup is null and can't be opened"))}catch{}}closePopup(){this._popupSetupTask?.abort();x(this.popup)&&this.popup.close()}async fetchPopupFeatures(r,v){await this.when();return this._popupHitsToFeatures(await this._getPopupHits(r,v),v)}async setupPopup(){this._popupSetupTask?.abort();if(this.popup&&!x(this.popup))return this._popupSetupTask=k.createTask(async r=>{const {default:v}=await new Promise((y,
B)=>a(["../widgets/Popup"],z=>y(t(z)),B));g.throwIfAborted(r);this.popup&&!x(this.popup)&&(r=this.popup,delete r.open,delete r.close,this.popup=new v(r))}),this._popupSetupTask.promise}async _popupHitsToFeatures({location:r,hits:v},y){const B=[],z=[];let A=!1;const C=g.wrapAbortWithTimeout(y,h("popup-view-fetch-timeout")??5E3);y=H=>{const E=z.at(-1);E&&E.layerView===H&&!A?H=E:(H=new m(H),z.push(H),B.push(H.promise));return H};for(const H of v)"graphic"in H?(y(H.layerView).graphics.push(H.graphic),
A=!1):(B.push(H.layerView.fetchPopupFeaturesAtLocation(H.mapPoint,C)),A=!0);z.map(H=>H.resolve(C));v=g.allSettledValues(B).then(H=>H.filter(E=>!!E).flat());return{pendingFeatures:B,allGraphicsPromise:v,location:r}}async _getPopupHits(r,v){const {hits:y,location:B}=await this.popupHitTest(r);g.throwIfAborted(v);r=[];for(const z of y)if("graphic"in z){if(this._isValidPopupGraphic(z.graphic,v)){const A=this._isValidPopupGraphicsLayerView(z.layerView)?z.layerView:void 0;r.push({graphic:z.graphic,layerView:A})}}else this._isValidPopupLocationLayerView(z.layerView)&&
r.push({mapPoint:z.mapPoint,layerView:z.layerView});return{hits:r,location:B}}_isValidPopupGraphic(r,v){return r&&!!r.getEffectivePopupTemplate(v?.defaultPopupTemplateEnabled)}_isValidPopupGraphicsLayerView(r){return!r||(!("layer"in r)||!r.suspended)&&"fetchPopupFeaturesFromGraphics"in r}_isValidPopupLocationLayerView(r){return(!("layer"in r)||!r.suspended)&&"fetchPopupFeaturesAtLocation"in r}};n.__decorate([f.property()],q.prototype,"popup",void 0);n.__decorate([f.property()],q.prototype,"popupEnabled",
void 0);return q=n.__decorate([l.subclass("esri.views.PopupView")],q)};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layerViewModuleImportUtils":function(){define(["require","exports","../../core/Error"],function(a,b,n){const k=g=>Object.freeze(Object.defineProperty({__proto__:null,default:g},Symbol.toStringTag,{value:"Module"})),p=()=>new Promise((g,d)=>a(["./layers/TileLayerView3D"],f=>g(k(f)),d)),h=()=>new Promise((g,d)=>a(["./layers/ElevationLayerView3D"],f=>g(k(f)),
d)),e={"base-dynamic":()=>new Promise((g,d)=>a(["./layers/BaseDynamicLayerView3D"],f=>g(k(f)),d)),"base-elevation":h,"base-tile":p,"bing-maps":p,"building-scene":()=>new Promise((g,d)=>a(["./layers/BuildingSceneLayerView3D"],f=>g(k(f)),d)),catalog:()=>new Promise((g,d)=>a(["./layers/CatalogLayerView3D"],f=>g(k(f)),d)),"catalog-dynamic-group":()=>new Promise((g,d)=>a(["./layers/CatalogDynamicGroupLayerView3D"],f=>g(k(f)),d)),"catalog-footprint":()=>new Promise((g,d)=>a(["./layers/CatalogFootprintLayerView3D"],
f=>g(k(f)),d)),csv:()=>new Promise((g,d)=>a(["./layers/CSVLayerView3D"],f=>g(k(f)),d)),dimension:()=>new Promise((g,d)=>a(["./layers/DimensionLayerView3D"],f=>g(k(f)),d)),elevation:h,feature:()=>new Promise((g,d)=>a(["./layers/FeatureLayerView3D"],f=>g(k(f)),d)),focusArea:()=>new Promise((g,d)=>a(["./layers/FocusAreaLayerView3D"],f=>g(k(f)),d)),geojson:()=>new Promise((g,d)=>a(["./layers/GeoJSONLayerView3D"],f=>g(k(f)),d)),graphics:()=>new Promise((g,d)=>a(["./layers/GraphicsLayerView3D"],f=>g(k(f)),
d)),group:()=>new Promise((g,d)=>a(["../layers/GroupLayerView"],f=>g(k(f)),d)),imagery:()=>new Promise((g,d)=>a(["./layers/ImageryLayerView3D"],f=>g(k(f)),d)),"integrated-mesh":()=>new Promise((g,d)=>a(["./layers/IntegratedMeshLayerView3D"],f=>g(k(f)),d)),"integrated-mesh-3dtiles":()=>new Promise((g,d)=>a(["./layers/IntegratedMesh3DTilesLayerView3D"],f=>g(k(f)),d)),"line-of-sight":()=>new Promise((g,d)=>a(["./layers/LineOfSightLayerView3D"],f=>g(k(f)),d)),"map-image":()=>new Promise((g,d)=>a(["./layers/MapImageLayerView3D"],
f=>g(k(f)),d)),media:()=>new Promise((g,d)=>a(["./layers/MediaLayerView3D"],f=>g(k(f)),d)),"ogc-feature":()=>new Promise((g,d)=>a(["./layers/OGCFeatureLayerView3D"],f=>g(k(f)),d)),"open-street-map":p,"oriented-imagery":()=>new Promise((g,d)=>a(["./layers/FeatureLayerView3D"],f=>g(k(f)),d)),"point-cloud":()=>new Promise((g,d)=>a(["./layers/PointCloudLayerView3D"],f=>g(k(f)),d)),viewshed:()=>new Promise((g,d)=>a(["./layers/ViewshedLayerView3D"],f=>g(k(f)),d)),voxel:()=>new Promise((g,d)=>a(["./layers/VoxelLayerView3D"],
f=>g(k(f)),d)),route:()=>new Promise((g,d)=>a(["./layers/RouteLayerView3D"],f=>g(k(f)),d)),scene:g=>null==g.profile||"mesh-pyramids"===g.profile?new Promise((d,f)=>a(["./layers/SceneLayerView3D"],c=>d(k(c)),f)):new Promise((d,f)=>a(["./layers/SceneLayerGraphicsView3D"],c=>d(k(c)),f)),stream:()=>new Promise((g,d)=>a(["./layers/StreamLayerView3D"],f=>g(k(f)),d)),tile:p,"imagery-tile":()=>new Promise((g,d)=>a(["./layers/ImageryTileLayerView3D"],f=>g(k(f)),d)),"vector-tile":()=>new Promise((g,d)=>a(["./layers/VectorTileLayerView3D"],
f=>g(k(f)),d)),wcs:()=>new Promise((g,d)=>a(["./layers/ImageryTileLayerView3D"],f=>g(k(f)),d)),"web-tile":p,wfs:()=>new Promise((g,d)=>a(["./layers/WFSLayerView3D"],f=>g(k(f)),d)),wms:()=>new Promise((g,d)=>a(["./layers/WMSLayerView3D"],f=>g(k(f)),d)),wmts:()=>new Promise((g,d)=>a(["./layers/WMTSLayerView3D"],f=>g(k(f)),d)),parquet:null,"geo-rss":null,kml:null,"knowledge-graph":null,"link-chart":null,"knowledge-graph-sublayer":null,"map-notes":null,"subtype-group":null,unknown:null,unsupported:null,
video:null};b.layerView3DImporter={hasLayerViewModule:g=>null!=e[g.type],importLayerView:g=>{var d=e[g.type];if(null==d)throw g=g.declaredClass?g.declaredClass.slice(g.declaredClass.lastIndexOf(".")+1):"Unknown",d=g.replaceAll(/([a-z])([A-Z])/g,"$1-$2").toLowerCase(),new n(`${d}:view-not-supported`,`${g} is not supported in 3D`);return d(g)}};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/analysis/AnalysisViewManager3D":function(){define("require ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/asyncUtils ../../../core/Collection ../../../core/Error ../../../core/handleUtils ../../../core/has ../../../core/Logger ../../../core/maybe ../../../core/promiseUtils ../../../core/scheduling ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w,x){function u(){const r=c.createResolver();r.promise.catch(()=>{});return r}const t=r=>Object.freeze(Object.defineProperty({__proto__:null,default:r},Symbol.toStringTag,{value:"Module"}));var m;(function(r){r[r.PENDING=0]="PENDING";r[r.CREATED=1]="CREATED"})(m||={});var q;(function(r){r[r.ADDED=0]="ADDED";r[r.REMOVED=1]="REMOVED"})(q||={});n=class extends n{constructor(r){super(r);this._allAnalysisViews=new p;this._creatingViewCount=0;this._items=new Map;this._scheduledUpdateHandle=
null;this._attachedToViewResolver=u();this._analysisModules={"area-measurement":{module:null},dimension:{module:null},"direct-line-measurement":{module:null},"line-of-sight":{module:null},slice:{module:null},viewshed:{module:null}}}destroy(){this._disconnectOwners();this._attachedToViewResolver.reject(c.createAbortError("AnalysisViewManager was destroyed"))}attach(){this._connectOwners();this._attachedToViewResolver.resolve()}detach(){this._disconnectOwners();this._attachedToViewResolver.reject(c.createAbortError());
this._attachedToViewResolver=u()}get updating(){return!this.view.ready||0!==this._creatingViewCount||this._allAnalysisViews.some(r=>r.updating)}get testInfo(){}async whenAnalysisView(r){await this._attachedToViewResolver.promise;const v=this._items.get(r);if(null==v||v.state.list===q.REMOVED)throw new h("AnalysisViewManager:no-analysisview-for-analysis","The analysis has not been added to view.analyses",{analysis:r});return v.createAnalysisViewTask.promise}_connectOwners(){this.addHandles(this._connectAnalysesCollection(this.view.analyses),
"analyses-owner-handles")}_disconnectOwners(){this.removeHandles("analyses-owner-handles");this._update();this._creatingViewCount=0}_connectAnalysesCollection(r){for(const B of r)this._addAnalysis(B);const v=r.on("after-add",B=>this._addAnalysis(B.item)),y=r.on("after-remove",B=>this._removeAnalysis(B.item));return e.makeHandle(()=>{v.remove();y.remove();for(const B of r)this._removeAnalysis(B)})}_addAnalysis(r){const v=this._items.get(r);if(null==v){const y={state:{view:m.PENDING,list:q.ADDED},analysis:r,
view:null,createAnalysisViewTask:null};this._items.set(r,y);y.createAnalysisViewTask=k.createTask(B=>this._createAnalysisViewPromise(y,B))}else v.state.list=q.ADDED}_removeAnalysis(r){r=this._items.get(r);null==r?d.getLogger(this).error("Trying to remove analysis which was not added"):(r.state.list=q.REMOVED,this._scheduleUpdate())}_scheduleUpdate(){null==this._scheduledUpdateHandle&&(this._scheduledUpdateHandle=l.schedule(()=>this._update()))}_update(){this._scheduledUpdateHandle=f.removeMaybe(this._scheduledUpdateHandle);
this._items.forEach(r=>{if(r.state.list===q.REMOVED)switch(this._items.delete(r.analysis),r.state.view){case m.PENDING:r.createAnalysisViewTask=f.abortMaybe(r.createAnalysisViewTask);break;case m.CREATED:null!=r.view&&(this._allAnalysisViews.remove(r.view),r.view=f.destroyMaybe(r.view),r.createAnalysisViewTask=null)}})}async _createAnalysisViewPromise(r,v){var y=r.analysis;const B=y.type,z=this._analysisModules[B];this._creatingViewCount+=1;if(null==z.module)try{z.module=await this._loadAnalysisModule(B)}catch(A){throw--this._creatingViewCount,
A;}if(c.isAborted(v))throw--this._creatingViewCount,c.createAbortError("AnalysisView creation aborted");y=new z.module.default({analysis:y,view:this.view});try{await y.when()}catch(A){throw--this._creatingViewCount,A;}if(c.isAborted(v))throw--this._creatingViewCount,y.destroy(),c.createAbortError("AnalysisView creation aborted");r.view=y;r.state.view=m.CREATED;this._allAnalysisViews.add(y);--this._creatingViewCount;return y}_loadAnalysisModule(r){switch(r){case "area-measurement":return new Promise((v,
y)=>a(["./AreaMeasurementAnalysisView3D"],B=>v(t(B)),y));case "dimension":return new Promise((v,y)=>a(["./DimensionAnalysisView3D"],B=>v(t(B)),y));case "direct-line-measurement":return new Promise((v,y)=>a(["./DirectLineMeasurementAnalysisView3D"],B=>v(t(B)),y));case "line-of-sight":return new Promise((v,y)=>a(["./LineOfSightAnalysisView3D"],B=>v(t(B)),y));case "slice":return new Promise((v,y)=>a(["./SliceAnalysisView3D"],B=>v(t(B)),y));case "viewshed":return new Promise((v,y)=>a(["./ViewshedAnalysisView3D"],
B=>v(t(B)),y))}}};b.__decorate([w.property()],n.prototype,"updating",null);b.__decorate([w.property({constructOnly:!0})],n.prototype,"view",void 0);b.__decorate([w.property()],n.prototype,"_allAnalysisViews",void 0);b.__decorate([w.property()],n.prototype,"_creatingViewCount",void 0);return n=b.__decorate([x.subclass("esri.views.3d.analysis.AnalysisViewManager3D")],n)})},"esri/views/3d/constraints/Constraints":function(){define("exports ../../../chunks/tslib.es6 ../../../core/Clonable ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ./AltitudeConstraint ./ClipDistanceConstraint ./TiltConstraint".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c){a.Constraints=class extends n.Clonable{constructor(l){super(l);this.tilt=new c.TiltConstraint;this.altitude=new d.AltitudeConstraint;this.clipDistance=new f.ClipDistanceConstraint}};b.__decorate([k.property({type:c.TiltConstraint})],a.Constraints.prototype,"tilt",void 0);b.__decorate([k.property({type:d.AltitudeConstraint})],a.Constraints.prototype,"altitude",void 0);b.__decorate([k.property({type:f.ClipDistanceConstraint})],a.Constraints.prototype,"clipDistance",void 0);
a.Constraints=b.__decorate([g.subclass("esri.views.3d.constraints.Constraints")],a.Constraints);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/constraints/AltitudeConstraint":function(){define("exports ../../../chunks/tslib.es6 ../../../core/Clonable ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ../state/Constraints".split(" "),function(a,b,n,k,p,h,e,
g,d){a.AltitudeConstraint=class extends n.Clonable{constructor(){super(...arguments);this.min=d.earthAltitudeConstraint.min;this.max=d.earthAltitudeConstraint.max}};b.__decorate([k.property({type:Number})],a.AltitudeConstraint.prototype,"min",void 0);b.__decorate([k.property({type:Number})],a.AltitudeConstraint.prototype,"max",void 0);a.AltitudeConstraint=b.__decorate([g.subclass("esri.views.3d.constraints.AltitudeConstraint")],a.AltitudeConstraint);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/state/Constraints":function(){define("exports ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/Logger ../../../core/mathUtils ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ../../../geometry/support/Ellipsoid ../../ViewingMode ../support/mathUtils".split(" "),function(a,b,n,k,p,h,e,g,d,f,c,l){a.Constraints=class extends n{constructor(t){super(t);this.collision=new u;this.distance=
Infinity;this.minimumPoiDistance=4;this.tilt=null}get altitude(){return this.mode===c.ViewingMode.Local?null:this._get("altitude")||null}set altitude(t){this.mode===c.ViewingMode.Local?k.getLogger(this).warn("Altitude constraint is ignored in local scenes"):this._set("altitude",t)}get mode(){return this.state.viewingMode}clampAltitude(t){return this.altitude?p.clamp(t,this.altitude.min,this.altitude.max):t}clampTilt(t,m){if(!this.tilt)return m;t=this.tilt(t);return p.clamp(m,t.min,t.max)}clampDistance(t){return Math.min(t,
this.distance)}createDefaultTilt(){return this.mode===c.ViewingMode.Local?this._createDefaultTiltLocal():this._createDefaultTiltGlobal()}createConstantMaxTilt(t){return(m,q=x)=>{q.min=w.min;q.max=t;return q}}_createDefaultTiltLocal(){const t=this.collision.enabled?l.makePiecewiseLinearFunction([[4E3,w.max],[1E4,p.deg2rad(88)],[6E6,p.deg2rad(88)]]):()=>w.max;return(m,q=x)=>{q.min=w.min;q.max=t(m);return q}}_createDefaultTiltGlobal(){const t=this.collision.enabled?l.makePiecewiseLinearFunction([[4E3,
w.max],[5E4,p.deg2rad(88)],[6E6,p.deg2rad(88)],[2E7,w.min]]):l.makePiecewiseLinearFunction([[3E5,w.max],[3E6,p.deg2rad(88)],[6E6,p.deg2rad(88)],[2E7,w.min]]);return(m,q=x)=>{q.min=w.min;q.max=t(m);return q}}};b.__decorate([h.property()],a.Constraints.prototype,"altitude",null);b.__decorate([h.property({readOnly:!0})],a.Constraints.prototype,"collision",void 0);b.__decorate([h.property()],a.Constraints.prototype,"distance",void 0);b.__decorate([h.property({readOnly:!0})],a.Constraints.prototype,"minimumPoiDistance",
void 0);b.__decorate([h.property()],a.Constraints.prototype,"tilt",void 0);b.__decorate([h.property({constructOnly:!0})],a.Constraints.prototype,"state",void 0);a.Constraints=b.__decorate([d.subclass("esri.views.3d.state.Constraints")],a.Constraints);e={min:-2E5,max:4*f.earth.radius};const w={min:p.deg2rad(.5),max:p.deg2rad(179.5)},x={min:0,max:0};let u=class extends n{constructor(){super(...arguments);this.enabled=!0;this.elevationMargin=5}};b.__decorate([h.property({type:Boolean})],u.prototype,
"enabled",void 0);b.__decorate([h.property({type:Number})],u.prototype,"elevationMargin",void 0);u=b.__decorate([d.subclass("esri.views.3d.state.Constraints.CollisionConstraint")],u);a.TiltRange=w;a.earthAltitudeConstraint=e;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/constraints/ClipDistanceConstraint":function(){define("exports ../../../chunks/tslib.es6 ../../../core/Clonable ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/decorators/cast ../../../core/RandomLCG ../../../core/has ../../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,n,k,p,h,e,g){a.ClipDistanceConstraint=class extends n.Clonable{constructor(){super(...arguments);this.mode="auto"}get near(){return this._get("near")}set near(d){this._set("near",d);d>=this._get("far")&&(this.far=d+1E-9);this.mode="manual"}castNear(d){return Math.max(1E-8,d)}get far(){return this._get("far")}set far(d){this._set("far",d);d<=this._get("near")&&(this.near=d-1E-9);this.mode="manual"}castFar(d){return Math.max(1E-8,d)}autoUpdate(d,f){"auto"===this.mode&&(this._get("near")!==
d&&this._set("near",d),this._get("far")!==f&&this._set("far",f))}};b.__decorate([k.property({type:Number,value:1E-8})],a.ClipDistanceConstraint.prototype,"near",null);b.__decorate([p.cast("near")],a.ClipDistanceConstraint.prototype,"castNear",null);b.__decorate([k.property({type:Number,value:1E-8})],a.ClipDistanceConstraint.prototype,"far",null);b.__decorate([p.cast("far")],a.ClipDistanceConstraint.prototype,"castFar",null);b.__decorate([k.property({type:["auto","manual"]})],a.ClipDistanceConstraint.prototype,
"mode",void 0);a.ClipDistanceConstraint=b.__decorate([g.subclass("esri.views.3d.constraints.ClipDistanceConstraint")],a.ClipDistanceConstraint);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/constraints/TiltConstraint":function(){define("exports ../../../chunks/tslib.es6 ../../../core/Clonable ../../../core/mathUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/decorators/cast ../../../core/RandomLCG ../../../core/has ../../../core/accessorSupport/decorators/subclass ../state/Constraints".split(" "),
function(a,b,n,k,p,h,e,g,d,f){var c=k.rad2deg(f.TiltRange.min),l=k.rad2deg(f.TiltRange.max);a.TiltConstraint=class extends n.Clonable{constructor(w){super(w);this.mode="auto"}get max(){return this._get("max")}set max(w){this._set("max",w);this.mode="manual"}castMax(w){return k.clamp(w,c,l)}autoUpdate(w){"auto"===this.mode&&this._get("max")!==w&&this._set("max",w)}};b.__decorate([p.property({type:["auto","manual"]})],a.TiltConstraint.prototype,"mode",void 0);b.__decorate([p.property({type:Number,value:l})],
a.TiltConstraint.prototype,"max",null);b.__decorate([h.cast("max")],a.TiltConstraint.prototype,"castMax",null);a.TiltConstraint=b.__decorate([d.subclass("esri.views.3d.constraints.TiltConstraint")],a.TiltConstraint);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/EnvironmentManager":function(){define("exports ../../../chunks/tslib.es6 ../../../geometry ../../../core/Evented ../../../core/has ../../../core/maybe ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ../../../chunks/vec32 ../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../geometry/projection ../../../geometry/projection/projectPointToVector ../../../geometry/support/planetGCSUtils ../../../geometry/support/spatialReferenceUtils ../../ViewingMode ./EnvironmentRenderer ../support/earthUtils ../support/sunUtils ../webgl-engine/lib/Update ../webgl-engine/lighting/Lightsources ../../../geometry/SpatialReference".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w,x,u,t,m,q,r,v,y,B,z,A){a.EnvironmentManager=class extends k.EventedAccessor{constructor(){super();this._tmpLightParameters=new y.ColorAndIntensity;this._defaultLightParameters=new y.ColorAndIntensity;this._tmpDate=new Date;this._tmpTz={hours:0,minutes:0,seconds:0};this._viewHandlesKey="viewHandles";this._trackingEnabled=!1;this._mainLight=new z.MainLight;this._ambientLight=new z.AmbientLight;this._moonLight=new z.FillLight;this._disableWeather=this._disableProjectionEngineAutoLoad=
!1;this._referencePositionGeographic=this._renderer=null;this._resetReferencePosition()}destroy(){this.disconnectView()}get _view(){return this._renderer?.view}get updating(){return!!this._renderer?.updating||!this._canProjectCameraPosition}get weatherEnabled(){return this._view?.environment.atmosphereEnabled&&!this._disableWeather&&this._view?.state?.viewingMode===q.ViewingMode.Global&&m.isEarth(this._view.spatialReference)}get weatherVisible(){return this.weatherEnabled&&this._renderer?.weatherVisible}get referencePositionGeographic(){return this._referencePositionGeographic}get _canProjectCameraPosition(){const E=
this._view?.stateManager?.camera?.position?.spatialReference??A.WGS84,F=t.getGCSForPlanet(E);return this._disableProjectionEngineAutoLoad||x.isLoadedOrLoadFor(E,F)}connectView(E){if(!this._renderer){this._renderer=new r.EnvironmentRenderer({view:E});var F=()=>this._updateRenderParameters(),G=()=>this._cameraHandler();this.addHandles([e.watch(()=>E.environment.lighting,D=>this._updateLightingHandler(D),e.sync),e.watch(()=>"virtual"!==E.environment.lighting.type?E.environment.lighting.date:null,D=>
this._lightingDateHandler(D),e.sync),e.watch(()=>E.environment.lighting.directShadowsEnabled,F,e.sync),e.watch(()=>E.qualitySettings.ambientOcclusion,F,e.sync),e.watch(()=>E.qualitySettings.reflections,F,e.sync),e.watch(()=>E.spatialReference,()=>this._resetReferencePosition(!0),e.sync),e.watch(()=>E.environment.weather.type,()=>this._updateLighting(null,B.Update.FadeWithWeather),e.sync),e.watch(()=>this.weatherEnabled,()=>this._updateLighting(null,B.Update.FadeWithWeather),e.sync),e.watch(()=>E.viewingMode,
()=>this._resetReferencePosition(!0),e.syncAndInitial),e.watch(()=>"virtual"!==E.environment.lighting.type?E.environment.lighting.cameraTrackingEnabled:!1,D=>this._updateCameraTracking(D),e.syncAndInitial),e.watch(()=>E.state.camera,G,e.syncAndInitial),e.when(()=>this._canProjectCameraPosition,G,e.sync)],this._viewHandlesKey);this._updateRenderParameters();this._updateLighting();this._cameraHandler();this.notifyChange("updating")}}disconnectView(){this.removeHandles(this._viewHandlesKey);this._resetReferencePosition();
this._renderer=h.destroyMaybe(this._renderer)}_updateLightingHandler(E){this._updateCameraTracking("virtual"!==E.type?E.cameraTrackingEnabled:!1);this._lightingDateHandler("virtual"!==E.type?E.date:null);this._updateRenderParameters()}_updateCameraTracking(E){(this._trackingEnabled=E)?this._cameraHandler():(E=this._view.environment.lighting,"virtual"!==E?.type&&(E.positionTimezoneInfo.autoUpdated=!1))}_lightingDateHandler(E){const F=this._view.environment.lighting;if("virtual"===F?.type)this._updateLighting();
else if(E){if(!F.positionTimezoneInfo.autoUpdated&&(this._preupdateTracking(E),null!=this._referencePositionGeographic)){const G=v.positionToTimezoneInfo(this._referencePositionGeographic,this._tmpTz);null!=G&&(F.autoUpdate(null,G),this._trackingEnabled&&(F.positionTimezoneInfo.autoUpdated=!0))}this._updateLighting(E)}}_preupdateTracking(E){!this._trackingEnabled&&"virtual"!==this._view.environment.lighting.type&&this._view.environment.lighting.cameraTrackingEnabled&&this._cameraHandler(E)}_cameraHandler(E=
null){var F=this._view;if(F.ready&&(F=F.stateManager.camera)){({position:F}=F);var G=t.getGCSForPlanet(F.spatialReference??A.WGS84),D=this._referencePositionGeographic??w.create();u.projectPointToVector(F,D,G)?(this._referencePositionGeographic=D,this.notifyChange("referencePositionGeographic"),this._autoUpdateTimezone(D,E)||this._updateLighting(E)):(this._referencePositionGeographic=null,this._updateLighting())}}_updateLighting(E,F=B.Update.Immediate){var G=this._view,{lighting:D}=G.environment,
I="virtual"===D.type;const J=this._referencePositionGeographic,N=null!=J?this._tmpLightParameters:this._defaultLightParameters;J?(E??=I?null:D.date,y.computeColorAndIntensity(E,J,G.state.viewingMode,this.weatherVisible?G.environment.weather.type:"disabled",G.state.camera,N)):I&&y.computeVirtualLightDirection(G.state.camera,G.state.viewingMode,N.direct.directionToLightSource);E=this._mainLight;G=N.direct;l.scale(E.intensity,G.color,G.intensity*Math.PI);l.copy(E.direction,G.directionToLightSource);
E.specularStrength=N.specularStrength;E.environmentStrength=N.environmentStrength;D=this._ambientLight;l.scale(D.intensity,N.ambient.color,N.ambient.intensity);I=this._moonLight;l.lerp(I.intensity,C,H,N.globalFactor);l.scale(I.intensity,I.intensity,(1-.5*N.globalFactor)*(1-.4*N.noonFactor*(1-N.globalFactor)));l.copy(I.direction,G.directionToLightSource);this._view._stage.renderer.updateLighting([E,D,I],N.noonFactor,N.globalFactor,F);this._updateRenderParameters()}_autoUpdateTimezone(E,F=null){if("virtual"===
this._view.environment.lighting.type||!this._view.environment.lighting.cameraTrackingEnabled||null==E)return!1;const G=this._tmpDate;G.setTime((F||this._view.environment.lighting.date).getTime());E=v.positionToTimezoneInfo(E,this._tmpTz);if(null==E)return!1;var D=this._view.environment.lighting.positionTimezoneInfo;if(!D.autoUpdated)D=E;else if(D.hours===E.hours&&D.minutes===E.minutes&&D.seconds===E.seconds)return!1;const I=G.getUTCHours()-(E.hours-D.hours),J=G.getUTCMinutes()-(E.minutes-D.minutes);
D=G.getUTCSeconds()-(E.seconds-D.seconds);G.setUTCHours(I);G.setUTCMinutes(J);G.setUTCSeconds(D);return F?!1:this._view.environment.lighting.autoUpdate(G,E)}_updateRenderParameters(){const E=this._view._stage;if(E){var F=null==this._referencePositionGeographic||y.computeShadowsEnabled(this._referencePositionGeographic[2],this._view.state.viewingMode);E.renderer.setParameters({shadowMap:this._view.environment.lighting.directShadowsEnabled&&F,environment:this._view.environment,weatherVisible:this._view.environmentManager.weatherVisible,
qualitySettings:this._view.qualitySettings})}}_resetReferencePosition(E=!1){this._referencePositionGeographic=null;E&&this._cameraHandler()}get test(){}};b.__decorate([g.property({type:Boolean,readOnly:!0})],a.EnvironmentManager.prototype,"updating",null);b.__decorate([g.property()],a.EnvironmentManager.prototype,"_disableProjectionEngineAutoLoad",void 0);b.__decorate([g.property()],a.EnvironmentManager.prototype,"_disableWeather",void 0);b.__decorate([g.property()],a.EnvironmentManager.prototype,
"weatherEnabled",null);b.__decorate([g.property()],a.EnvironmentManager.prototype,"weatherVisible",null);b.__decorate([g.property()],a.EnvironmentManager.prototype,"referencePositionGeographic",null);b.__decorate([g.property()],a.EnvironmentManager.prototype,"_renderer",void 0);b.__decorate([g.property()],a.EnvironmentManager.prototype,"_referencePositionGeographic",void 0);b.__decorate([g.property()],a.EnvironmentManager.prototype,"_canProjectCameraPosition",null);a.EnvironmentManager=b.__decorate([c.subclass("esri.views.3d.environment.EnvironmentManager")],
a.EnvironmentManager);const C=w.fromValues(.22,.22,.33),H=w.fromValues(.22,.22,.22);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/planetGCSUtils":function(){define(["exports","../SpatialReference","../spatialReferenceEllipsoidUtils","./spatialReferenceUtils","./SupportedGCSWkids"],function(a,b,n,k,p){a.getGCSForPlanet=function(h){return k.equals(h,n.SphericalPCPFMars)||k.isMars(h)?{wkid:p.SupportedGCSWkids.GCSMARS2000}:k.equals(h,n.SphericalPCPFMoon)||k.isMoon(h)?
{wkid:p.SupportedGCSWkids.GCSMOON2000}:b.WGS84};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/EnvironmentRenderer":function(){define("exports ../../../chunks/tslib.es6 ../../../core/has ../../../core/maybe ../../../core/reactiveUtils ../../../core/signal ../../../core/accessorSupport/decorators/property ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ../../../chunks/vec32 ../../../geometry/ellipsoidUtils ./Clouds ./CloudsPresets ./CloudsRenderer ./Precipitation ./weather ../webgl-engine/effects/RenderPlugin".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w,x,u,t,m,q){a.EnvironmentRenderer=class extends q.SyncRenderPlugin{constructor(r){super(r);this.produces=new Map([]);this._clouds=h.signal(null);this._incarnation=0;this._precipitation=null}initialize(){this.view._stage.addRenderPlugin(this)}destroy(){this.removeHandles();this.uninitializeRenderContext();this.view?._stage?.removeRenderPlugin(this);this._set("view",null)}get updating(){return!!this._clouds.value?.running}get weatherVisible(){return c.length(this.view.state.camera.eye)-
l.getReferenceEllipsoid(this.view.spatialReference).radius<=m.heightLimit}get usedMemory(){return this._clouds.value?.usedMemory??0}_fadeOutPrecipitation(){this._precipitation&&(this._precipitationOutgoing?.destroy(),this._precipitationOutgoing=this._precipitation,this._precipitationOutgoing.fadeOut(()=>{this._precipitationOutgoing=k.destroyMaybe(this._precipitationOutgoing)}),this._precipitation=null,++this._incarnation)}get weather(){return this.view?.environmentManager?.weatherEnabled?this.view.environment.weather:
null}initializeRenderContext(r){this._context=r;const v=this.view;r=()=>this._requestRender();this.addHandles([p.watch(()=>this._precipitation,r,p.sync),p.watch(()=>this._clouds.value?.state,r,p.sync),p.watch(()=>v.state.mode,r,p.sync),p.watch(()=>this._updateClouds(),r,p.sync),p.watch(()=>this._updatePrecipitation(),r,p.sync),p.watch(()=>this.weather,y=>this._initWeather(y))])}uninitializeRenderContext(){this._context=null;this._clouds.value=k.destroyMaybe(this._clouds.value);this._precipitation=
k.destroyMaybe(this._precipitation);this._precipitationOutgoing=k.destroyMaybe(this._precipitationOutgoing)}prepareRender(r){const {bind:v,time:y}=r;"local"!==this.view.viewingMode&&v.clouds.data&&(v.clouds.fade(v.camera,y,this.view.qualitySettings.fadeDuration),(r=this._clouds.value)&&r.state===w.CubeMapState.Idle&&0===r.coverage&&!r.running&&r.destroyCubeMap())}acquireTechniques(){return[]}render(){}_requestRender(){this._context?.requestRender()}_initWeather(r){const v=this._context;r&&v?this._clouds.value||
(this._clouds.value=new u.CloudsRenderer({context:v,view:this.view,requestRender:()=>this._requestRender()})):this._clouds.value=k.destroyMaybe(this._clouds.value)}_updateClouds(){var r=this.view.environment.weather;if(null==r||null==this._clouds.value)return++this._incarnation;var v=this._clouds.value,y=v.applyPreset,B=x.cloudPresets[r.type];a:{switch(r.type){case "rainy":case "snowy":case "cloudy":case "sunny":r=r.cloudCover;break a;case "foggy":r=r.fogStrength;break a}r=void 0}y.call(v,B,r);return++this._incarnation}_updatePrecipitation(){const r=
this.view.environment.weather;if(r.type===this._precipitation?.type)return this._incarnation;this._fadeOutPrecipitation();const v=this._context;"rainy"!==r.type&&"snowy"!==r.type||!v||(this._precipitation=new t.Precipitation({view:this.view,techniques:v.techniques,type:r.type}),++this._incarnation);return this._incarnation}get test(){}};b.__decorate([e.property({constructOnly:!0})],a.EnvironmentRenderer.prototype,"view",void 0);b.__decorate([e.property({type:Boolean,readOnly:!0})],a.EnvironmentRenderer.prototype,
"updating",null);b.__decorate([e.property({readOnly:!0})],a.EnvironmentRenderer.prototype,"weatherVisible",null);b.__decorate([e.property()],a.EnvironmentRenderer.prototype,"_context",void 0);a.EnvironmentRenderer=b.__decorate([f.subclass("esri.views.3d.environment.EnvironmentRenderer")],a.EnvironmentRenderer);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/Clouds":function(){define(["exports"],function(a){a.CubeMapState=void 0;(function(b){b[b.Idle=0]="Idle";
b[b.Rendering=1]="Rendering";b[b.Ready=2]="Ready";b[b.Fading=3]="Fading"})(a.CubeMapState||(a.CubeMapState={}));a.CloudsTextureChannels=void 0;(function(b){b[b.RG=0]="RG";b[b.BA=1]="BA";b[b.COUNT=2]="COUNT"})(a.CloudsTextureChannels||(a.CloudsTextureChannels={}));a.ensureClouds=function(b){return null!=b&&!b.running};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/CloudsPresets":function(){define(["exports","./CloudsTechniqueConfiguration"],function(a,b){class n{constructor(k,
p,h,e,g,d,f,c,l=.5){this.coverage=k;this.density=p;this.absorption=h;this.cloudSize=e;this.detailSize=g;this.smoothness=d;this.cloudHeight=f;this.raymarchingSteps=c;this.median=l}}b={sunny:new n([0,.6],[.03,.03],[0,0],[.9,.9],[.8,.8],[.7,.7],[.05,.05],b.RayMarchingSteps.SIXTEEN),cloudy:new n([.3,.65],[.2,.4],[0,0],[.85,.85],[.75,.75],[.3,.4],[1,1],b.RayMarchingSteps.TWOHUNDRED,.6),rainy:new n([.6,.8],[.5,.8],[.1,.5],[.9,.9],[.75,.75],[.5,.5],[1,1],b.RayMarchingSteps.TWOHUNDRED,.4),snowy:new n([.25,
.75],[.3,.3],[0,0],[.95,.95],[.7,.7],[.69,.75],[.3,1],b.RayMarchingSteps.HUNDRED,.65),foggy:new n([.8,.8],[.5,.5],[0,0],[.95,.95],[.9,.9],[.55,.55],[.3,.3],b.RayMarchingSteps.SIXTEEN)};b.default=b.sunny;a.CloudPreset=n;a.cloudPresets=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/CloudsTechniqueConfiguration":function(){define(["exports","../../../chunks/tslib.es6","./Clouds","../webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration"],function(a,
b,n,k){a.RayMarchingSteps=void 0;(function(h){h[h.SIXTEEN=0]="SIXTEEN";h[h.HUNDRED=1]="HUNDRED";h[h.TWOHUNDRED=2]="TWOHUNDRED";h[h.COUNT=3]="COUNT"})(a.RayMarchingSteps||(a.RayMarchingSteps={}));class p extends k.ShaderTechniqueConfiguration{constructor(){super(...arguments);this.steps=a.RayMarchingSteps.SIXTEEN;this.writeTextureChannels=n.CloudsTextureChannels.RG}}b.__decorate([k.parameter({count:a.RayMarchingSteps.COUNT})],p.prototype,"steps",void 0);b.__decorate([k.parameter({count:n.CloudsTextureChannels.COUNT})],
p.prototype,"writeTextureChannels",void 0);a.CloudsTechniqueConfiguration=p;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration":function(){define(["exports","../../../../../core/Error","../shaderModules/interfaces","./ShaderTechniqueConfigurationKey"],function(a,b,n,k){class p extends n.NoParameters{constructor(){super();this._parameterBits=this._parameterBits?.map(()=>0)??[];this._parameterNames??(this._parameterNames=
[])}get key(){this._key??(this._key=new k.ShaderTechniqueConfigurationKey(this._parameterBits));return this._key}decode(h=this.key){const e=this._parameterBits;this._parameterBits=[...h.bits];h=this._parameterNames.map(g=>`    ${g}: ${this[g]}`).join("\n");this._parameterBits=e;return h}}a.ShaderTechniqueConfiguration=p;a.parameter=function(h={}){return(e,g)=>{e.hasOwnProperty("_parameterNames")||Object.defineProperty(e,"_parameterNames",{value:e._parameterNames?.slice()??[],configurable:!0,writable:!0});
e.hasOwnProperty("_parameterBits")||Object.defineProperty(e,"_parameterBits",{value:e._parameterBits?.slice()??[0],configurable:!0,writable:!0});e._parameterNames.push(g);const d=Math.ceil(Math.log2(h.count||2)),f=e._parameterBits;let c=0;for(;16<f[c]+d;)c++,c>=f.length&&f.push(0);const l=f[c],w=(1<<d)-1<<l;f[c]+=d;h.count?Object.defineProperty(e,g,{get(){return(this._parameterBits[c]&w)>>l},set(x){if(this[g]!==x)if(this._key=null,this._parameterBits[c]=this._parameterBits[c]&~w|+x<<l&w,"number"===
typeof x){if(null==h.count)throw new b(`Configuration value for ${g} must provide a count option`);}else throw new b(`Configuration value for ${g} must be a number, got ${typeof x}`);}}):Object.defineProperty(e,g,{get(){return!!((this._parameterBits[c]&w)>>l)},set(x){if(this[g]!==x&&(this._key=null,this._parameterBits[c]=this._parameterBits[c]&~w|+x<<l&w,"boolean"!==typeof x))throw new b(`Configuration value for ${g} must be boolean, got ${typeof x}`);}})}};Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/interfaces":function(){define(["exports"],function(a){function b(p,...h){let e="";for(let g=0;g<h.length;g++)e+=p[g]+h[g];return e+=p[p.length-1]}class n{}const k=n;(function(p){p.int=function(h){return Math.round(h).toString()};p.float=function(h){return h.toPrecision(8)}})(b||={});a.If=function(p,h,e=""){return p?h:e};a.NoParameters=k;a.glsl=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderTechnique/ShaderTechniqueConfigurationKey":function(){define(["exports",
"../../../../../core/arrayUtils"],function(a,b){class n{constructor(k){this._bits=[...k]}equals(k){return b.equals(this._bits,k.bits)}get code(){this._code??(this._code=String.fromCharCode(...this._bits));return this._code}get bits(){return this._bits}}a.ShaderTechniqueConfigurationKey=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/CloudsRenderer":function(){define("exports ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/compilerUtils ../../../core/mathUtils ../../../core/maybe ../../../core/reactiveUtils ../../../core/signal ../../../core/accessorSupport/decorators/property ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ../../../core/libs/gl-matrix-2/math/mat3 ../../../core/libs/gl-matrix-2/math/mat4 ../../../core/libs/gl-matrix-2/factories/mat4f64 ../../../core/libs/gl-matrix-2/math/vec2 ../../../core/libs/gl-matrix-2/factories/vec2f64 ../../../core/libs/gl-matrix-2/factories/vec3f32 ../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../geometry/ellipsoidUtils ./Clouds ../../../chunks/Clouds.glsl ./CloudsPresets ./CloudsTechnique ./CloudsTechniqueConfiguration ./NoiseTextureAtlas ../../support/Scheduler ../../support/Yield ../../webgl/enums ../../webgl/FramebufferObject ../../webgl/TextureDescriptor".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w,x,u,t,m,q,r,v,y,B,z,A,C,H,E,F,G,D,I){a.CloudsRenderer=class extends n{constructor(O){super(O);this._state=g.signal(y.CubeMapState.Idle);this._passParameters=new B.CloudsPassParameters;this._weatherTileCount=128;this._tileIndex=this._faceIndex=0;this._tilesPerFace=1;this.coverage=p.lerp(z.cloudPresets.default.coverage[0],z.cloudPresets.default.coverage[1],.5);this.density=p.lerp(z.cloudPresets.default.density[0],z.cloudPresets.default.density[1],.5);this.absorption=
p.lerp(z.cloudPresets.default.absorption[0],z.cloudPresets.default.absorption[1],.5);this.cloudSize=p.lerp(z.cloudPresets.default.cloudSize[0],z.cloudPresets.default.cloudSize[1],.5);this.detailSize=p.lerp(z.cloudPresets.default.detailSize[0],z.cloudPresets.default.detailSize[1],.5);this.smoothness=p.lerp(z.cloudPresets.default.smoothness[0],z.cloudPresets.default.smoothness[1],.5);this.cloudHeight=p.lerp(z.cloudPresets.default.cloudHeight[0],z.cloudPresets.default.cloudHeight[1],.5);this.raymarchingSteps=
z.cloudPresets.default.raymarchingSteps;this._viewMatrix=u.create();this.running=this._dirty=!0;this._configuration=new C.CloudsTechniqueConfiguration}initialize(){var O=v.getReferenceEllipsoid(this.view.spatialReference);this._passParameters.cloudRadius=.5*O.radius;O=()=>this.setDirty();this.addHandles([this.view.resourceController.scheduler.registerTask(E.TaskPriority.CLOUDS_GENERATOR,this),e.watch(()=>this.coverage,O,e.initial),e.watch(()=>this.density,O,e.initial),e.watch(()=>this.absorption,
O,e.initial),e.watch(()=>this.cloudSize,O,e.initial),e.watch(()=>this.detailSize,O,e.initial),e.watch(()=>this.smoothness,O,e.initial),e.watch(()=>this.cloudHeight,O,e.initial),e.watch(()=>this.raymarchingSteps,O,e.initial)]);const K=m.clone(this._computeWeatherTile());let L=0;this.addHandles(e.watch(()=>{const P=this._computeWeatherTile();t.equals(K,P)||(++L,t.copy(K,P));return L},O))}destroy(){this.destroyCubeMap();this._passParameters.noiseTexture=h.destroyMaybe(this._passParameters.noiseTexture)}_precompileTechniques(){this._configuration.steps=
this.raymarchingSteps;this._configuration.writeTextureChannels=y.CloudsTextureChannels.RG;this.context.techniques.precompile(A.CloudsTechnique,this._configuration);this._configuration.writeTextureChannels=y.CloudsTextureChannels.BA;this.context.techniques.precompile(A.CloudsTechnique,this._configuration)}_acquireTechnique(){switch(this.raymarchingSteps){case C.RayMarchingSteps.SIXTEEN:this._tilesPerFace=1;break;case C.RayMarchingSteps.HUNDRED:this._tilesPerFace=4;break;case C.RayMarchingSteps.COUNT:case C.RayMarchingSteps.TWOHUNDRED:this._tilesPerFace=
8;break;default:k.neverReached(this.raymarchingSteps)}this._configuration.writeTextureChannels=1-this.parameters.readChannels;this._configuration.steps=this.raymarchingSteps;return this.context.techniques.acquire(A.CloudsTechnique,this._configuration)}_computeWeatherTile(){const {camera:O,environment:K}=this.view,{latitude:L,longitude:P}=O.position;if(null==L||null==P)return m.ZEROS;t.set(Q,(L+90)/180,(P+180)/360);var R=Math.floor(this._weatherTileCount*Math.abs(2*Q[0]-1));Q[0]=Math.floor(2*this._weatherTileCount*
Q[0]);Q[1]=Math.floor(4*(this._weatherTileCount-R)*Q[1]);var W=R=0;"virtual"!==K?.lighting?.type&&null!=K?.lighting?.date&&(W=new Date(K.lighting.date),W.setUTCHours(K.lighting.date.getUTCHours()+(K.lighting.displayUTCOffset??0)),R=31*W.getUTCMonth()+W.getUTCDate(),W=W.getUTCFullYear());Q[0]=(Q[0]+R)%(2*this._weatherTileCount);Q[1]=(Q[1]+W%100)%(4*this._weatherTileCount);return Q}get state(){return this._state.value}set state(O){this._state.value=O}get usedMemory(){return(this._fbo?.usedMemory??0)+
(this._passParameters.noiseTexture?.textureAtlas?.usedMemory??0)}_ensureNoiseTexture(){let O;(O=this._passParameters).noiseTexture??(O.noiseTexture=new H.NoiseTextureAtlas({context:this.context}));return this._passParameters.noiseTexture}_ensureFrameBufferCube(O){const K=this.context.renderContext.rctx;null==this._fbo&&(O=new I.TextureDescriptor(O),O.target=G.TextureType.TEXTURE_CUBE_MAP,O.wrapMode=G.TextureWrapMode.CLAMP_TO_EDGE,this._fbo=new D.FramebufferObject(K,O),this.parameters.data=this);K.unbindTexture(this._fbo.colorTexture);
return this._fbo}get cubeMap(){return this._fbo}get parameters(){return this.context.renderContext.bind.clouds}destroyCubeMap(){this._fbo=h.disposeMaybe(this._fbo);this.parameters.data=null}applyPreset(O,K){const L=O.median,P=R=>{const W=p.lerp(R[0],R[1],L);return.5>K?p.lerp(R[0],W,2*K):p.lerp(W,R[1],2*(K-.5))};this.coverage=P(O.coverage);this.density=P(O.density);this.absorption=P(O.absorption);this.cloudSize=P(O.cloudSize);this.detailSize=P(O.detailSize);this.smoothness=P(O.smoothness);this.cloudHeight=
P(O.cloudHeight);this.raymarchingSteps=O.raymarchingSteps;this._precompileTechniques()}setDirty(){this._dirty=this.running=!0}runTask(O){if(this.state===y.CubeMapState.Fading)return F.Yield;this._dirty&&(this._faceIndex=this._tileIndex=0,this.state=y.CubeMapState.Rendering,this._passParameters.absorption=this.absorption,this._passParameters.density=this.density,this._passParameters.cloudSize=this.cloudSize,this._passParameters.detailSize=this.detailSize,this._passParameters.smoothness=this.smoothness,
this._passParameters.cloudHeight=this.cloudHeight,this._passParameters.coverage=this.coverage,this._ensureNoiseTexture().updateWeatherMap(this._computeWeatherTile()),this._dirty=!1);const K=this._acquireTechnique();if(!this._ensureNoiseTexture().textureAtlas||!K.compiled)return K.release(),F.Yield;x.targetTo(this._viewMatrix,M,J[this._faceIndex],N[this._faceIndex]);w.fromMat4(this._passParameters.viewMatrix,this._viewMatrix);const L=this.context.renderContext.rctx,P=L.getViewport();var R=B.cubeMapSize/
this._tilesPerFace;L.setViewport(0,this._tileIndex*R,B.cubeMapSize,R);R=this._ensureFrameBufferCube(B.cubeMapSize);L.bindFramebuffer(R);L.bindTechnique(K,this.context.renderContext.bind,this._passParameters);R.setColorTextureTarget(G.TextureType.TEXTURE_CUBE_MAP_POSITIVE_X+this._faceIndex);L.screen.draw();K.release();L.gl.flush();L.setViewport(P.x,P.y,P.width,P.height);this.requestRender();++this._tileIndex;4===this._faceIndex&&this._tileIndex===this._tilesPerFace?(this._faceIndex=this._tileIndex=
0,this.state=y.CubeMapState.Ready,this.running=!1):this._tileIndex===this._tilesPerFace&&(++this._faceIndex,this._tileIndex=0);O.madeProgress();return F.Yield}};b.__decorate([d.property({constructOnly:!0})],a.CloudsRenderer.prototype,"context",void 0);b.__decorate([d.property({constructOnly:!0})],a.CloudsRenderer.prototype,"view",void 0);b.__decorate([d.property({constructOnly:!0})],a.CloudsRenderer.prototype,"requestRender",void 0);b.__decorate([d.property()],a.CloudsRenderer.prototype,"coverage",
void 0);b.__decorate([d.property()],a.CloudsRenderer.prototype,"density",void 0);b.__decorate([d.property()],a.CloudsRenderer.prototype,"absorption",void 0);b.__decorate([d.property()],a.CloudsRenderer.prototype,"cloudSize",void 0);b.__decorate([d.property()],a.CloudsRenderer.prototype,"detailSize",void 0);b.__decorate([d.property()],a.CloudsRenderer.prototype,"smoothness",void 0);b.__decorate([d.property()],a.CloudsRenderer.prototype,"cloudHeight",void 0);b.__decorate([d.property()],a.CloudsRenderer.prototype,
"raymarchingSteps",void 0);b.__decorate([d.property()],a.CloudsRenderer.prototype,"running",void 0);a.CloudsRenderer=b.__decorate([l.subclass("esri.views.3d.environment.CloudsRenderer")],a.CloudsRenderer);const J=[q.fromValues(1,0,0),q.fromValues(-1,0,0),q.fromValues(0,1,0),q.fromValues(0,-1,0),q.fromValues(0,0,1)],N=[q.fromValues(0,1,0),q.fromValues(0,1,0),q.fromValues(0,0,-1),q.fromValues(0,0,1),q.fromValues(0,1,0)],M=r.zeros(),Q=m.zeros();Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/core/libs/gl-matrix-2/factories/vec3f32":function(){define(["exports"],function(a){function b(){return new Float32Array(3)}function n(m){const q=new Float32Array(3);q[0]=m[0];q[1]=m[1];q[2]=m[2];return q}function k(m,q,r){const v=new Float32Array(3);v[0]=m;v[1]=q;v[2]=r;return v}function p(m,q){return new Float32Array(m,q,3)}function h(){return b()}function e(){return k(1,1,1)}function g(){return k(1,0,0)}function d(){return k(0,1,0)}function f(){return k(0,0,1)}const c=b(),l=e(),w=g(),x=d(),
u=f(),t=Object.freeze(Object.defineProperty({__proto__:null,ONES:l,UNIT_X:w,UNIT_Y:x,UNIT_Z:u,ZEROS:c,clone:n,create:b,createView:p,fromValues:k,ones:e,unitX:g,unitY:d,unitZ:f,zeros:h},Symbol.toStringTag,{value:"Module"}));a.ONES=l;a.UNIT_X=w;a.UNIT_Y=x;a.UNIT_Z=u;a.ZEROS=c;a.clone=n;a.create=b;a.createView=p;a.fromValues=k;a.ones=e;a.unitX=g;a.unitY=d;a.unitZ=f;a.vec3f32=t;a.zeros=h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/Clouds.glsl":function(){define("exports ../core/has ../core/mathUtils ../core/libs/gl-matrix-2/factories/mat3f64 ../core/libs/gl-matrix-2/math/vec2 ../core/libs/gl-matrix-2/factories/vec2f64 ../views/3d/environment/CloudsTechniqueConfiguration ../views/3d/environment/NoiseTextureAtlasDimensions ../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass.glsl ../views/3d/webgl-engine/core/shaderModules/Float2PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/Matrix3PassUniform ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform ../views/3d/webgl-engine/shaders/SphereIntersect.glsl".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w,x,u,t){function m(y){const B=new x.ShaderBuilder;B.include(d.ScreenSpacePass,!1);const z=B.fragment;z.include(t.SphereIntersect);z.uniforms.add(new c.FloatPassUniform("cloudRadius",A=>A.cloudRadius),new c.FloatPassUniform("power",A=>n.lerp(35,120,A.absorption)),new c.FloatPassUniform("sigmaE",A=>1+A.absorption),new c.FloatPassUniform("density",A=>n.lerp(0,.3,A.density)),new c.FloatPassUniform("cloudSize",A=>n.lerp(0,.02,Math.max(.01,1-A.cloudSize))),new c.FloatPassUniform("detailSize",
A=>n.lerp(0,.2,Math.max(.01,1-A.detailSize))),new c.FloatPassUniform("smoothness",A=>n.lerp(0,.5,1-A.smoothness)),new c.FloatPassUniform("cloudHeight",A=>n.lerp(0,1500,A.cloudHeight)),new c.FloatPassUniform("coverage",A=>A.coverage),new w.Matrix3PassUniform("view",A=>A.viewMatrix),new u.Texture2DPassUniform("cloudShapeTexture",A=>null!=A.noiseTexture?A.noiseTexture.textureAtlas:null),new f.Float2PassUniform("cloudVariables",A=>p.set(v,A.coverage,A.absorption)));z.constants.add("halfCubeMapSize","float",
.5*r);z.code.add(l.glsl`
    const int STEPS = ${y.steps===e.RayMarchingSteps.SIXTEEN?l.glsl`16`:y.steps===e.RayMarchingSteps.HUNDRED?l.glsl`100`:l.glsl`200`};
    const int STEPS_LIGHT = 6;
    const float stepL = 300.0 / float(STEPS_LIGHT);
    const float cloudStart = 1500.0;

    vec3 rayDirection(vec2 fragCoord) {
      vec2 xy = fragCoord - halfCubeMapSize;
      return normalize(vec3(-xy, -halfCubeMapSize));
    }

    float remap(float x, float low1, float high1, float low2, float high2) {
      return low2 + (x - low1) * (high2 - low2) / (high1 - low1);
    }

    float saturate(float x) {
      return clamp(x, 0.0, 1.0);
    }`);z.code.add(l.glsl`
    float getCloudShape(vec3 pos, float pOffset) {
      const float textureWidth = ${l.glsl.float(g.atlasSize)};
      const float dataWidth = ${l.glsl.float(g.atlasSize)};
      const float tileRows = ${l.glsl.float(g.tileRows)};
      const vec3 atlasDimensions = vec3(${l.glsl.float(g.tileSize)}, ${l.glsl.float(g.tileSize)}, tileRows * tileRows);

      //Change from Y being height to Z being height
      vec3 p = float(${l.glsl.float(g.textureScale)}) * pos.xzy;

      //Pixel coordinates of point in the 3D data
      vec3 coord = vec3(mod(p - pOffset * atlasDimensions, atlasDimensions));
      float f = fract(coord.z);
      float level = floor(coord.z);
      float tileY = floor(level / tileRows);
      float tileX = level - tileY * tileRows;

      //The data coordinates are offset by the x and y tile, the two boundary cells between each tile pair and the initial boundary cell on the first row/column
      vec2 offset = atlasDimensions.x * vec2(tileX, tileY) + 2.0 * vec2(tileX, tileY) + 1.0;
      vec2 pixel = coord.xy + offset;
      vec2 data = texture(cloudShapeTexture, mod(pixel, dataWidth) / textureWidth).xy;

      return 1.0 - mix(data.x, data.y, f);
    }

    float getCloudMap(vec2 p){
      // Shift the texture center to origin to avoid seam artifacts
      vec2 uv = (${l.glsl.float(g.weatherMapScale)} * p) / ${l.glsl.float(g.atlasSize)} + 0.5;

      return texture(cloudShapeTexture, uv).a;
    }
    `);z.code.add(l.glsl`float clouds(vec3 p) {
float cloud = saturate(0.5 * mix(0.0, 1.0, min(2.0 * coverage, 1.0)));
if (cloud <= 0.0) {
return 0.0;
}
float cloudMap = getCloudMap(cloudSize * p.xy);
cloud = mix(cloud, min(2.0 * (coverage), 1.0) * cloudMap, min(2.0 * (1.0 - coverage), 1.0));
if (cloud <= 0.0) {
return 0.0;
}
float shape = getCloudShape(8.0 * cloudSize * p, 0.0);
cloud = saturate(remap(cloud, smoothness * shape, 1.0, 0.0, 1.0));
if (cloud <= 0.0) {
return 0.0;
}
float heightFraction = saturate((length(p) - cloudRadius - cloudStart) / cloudHeight);
cloud *= saturate(remap(heightFraction, 0.0, 0.25, 0.0, 1.0)) * smoothstep(1.0, 0.25, heightFraction);
if (cloud <= 0.0) {
return 0.0;
}
return density * saturate(remap(cloud, 0.35 * smoothness * getCloudShape(detailSize * p, 0.0), 1.0, 0.0, 1.0));
}`);z.code.add(l.glsl`float HenyeyGreenstein(float g, float costh) {
return (1.0 / (4.0 * 3.1415))  * ((1.0 - g * g) / pow(1.0 + g * g - 2.0 * g * costh, 1.5));
}
float multipleOctaves(float extinction, float mu, float stepL) {
float attenuation = 1.0;
float contribution = 1.0;
float phaseAttenuation = 1.0;
float luminance = 0.0;
for (int i = 0; i < 4; i++) {
float phase = mix(HenyeyGreenstein(0.0, mu), HenyeyGreenstein(0.3 * phaseAttenuation, mu), 0.7);
luminance += contribution * phase * exp(-stepL * extinction * sigmaE * attenuation);
attenuation *= 0.2;
contribution *= 0.6;
phaseAttenuation *= 0.5;
}
return luminance;
}`);z.code.add(l.glsl`float lightRay(vec3 org, vec3 p, float phaseFunction, float mu, vec3 sunDirection) {
float lightRayDensity = clouds(p);
lightRayDensity += clouds(p + sunDirection * 1.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 2.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 3.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 4.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 5.0 * stepL);
float beersLaw = multipleOctaves(lightRayDensity, mu, stepL);
return mix(beersLaw * 2.0 * (1.0 - (exp(-stepL * lightRayDensity * 2.0 * sigmaE ))), beersLaw, 0.5 + 0.5 * mu);
}`);z.code.add(l.glsl`float mainRay(vec3 org, vec3 dir, vec3 sunDirection, float distToStart, float totalDistance, out float totalTransmittance) {
if (dir.z < 0.0) {
return 0.0;
}
totalTransmittance = 1.0;
float stepS = totalDistance / float(STEPS);
float cameraHeight = length(org);
float mu = 0.5 + 0.5 * dot(sunDirection, dir);
float phaseFunction = mix(HenyeyGreenstein(-0.3, mu), HenyeyGreenstein(0.3, mu), 0.7);
vec3 p = org + distToStart  * dir;
float dist = distToStart;
float shading = 0.0;
for (int i = 0; i < STEPS; i++) {
float sampleDensity = clouds(p);
float sampleSigmaE = sampleDensity * sigmaE;
if (sampleDensity > 0.0 ) {
float ambient = mix((1.2), (1.6), saturate((length(p) - cloudRadius - cloudStart) / cloudHeight));
float luminance = sampleDensity * (ambient + power * phaseFunction * lightRay(org, p, phaseFunction, mu, sunDirection));
float transmittance = exp(-sampleSigmaE * stepS);
shading += totalTransmittance * (luminance - luminance * transmittance) / sampleSigmaE;
totalTransmittance *= transmittance;
if (totalTransmittance <= 0.001) {
totalTransmittance = 0.0;
break;
}
}
dist += stepS;
p = org + dir * dist;
}
return shading;
}`);z.main.add(l.glsl`if (coverage ==  0.0) {
fragColor = vec4(0.0, 1.0, 0.0, 1.0);
return;
}
vec3 rayDir = rayDirection(gl_FragCoord.xy);
rayDir = normalize(view * rayDir);
vec3 viewPos = vec3(0, 0, cloudRadius + 1.0);
bool hitsPlanet = rayDir.z < 0.0;
float hazeFactor = smoothstep(-0.01, mix(0.0, 0.075, cloudVariables.x), abs(dot(rayDir, vec3(0, 0, 1))));
float totalTransmittance = 1.0;
float shading = 0.0;
if (hitsPlanet) {
shading = clamp(1.0 - cloudVariables.y, 0.6, 1.0) * (1.0 - hazeFactor);
totalTransmittance = hazeFactor;
fragColor = vec4(shading, totalTransmittance, shading, totalTransmittance);
return;
}
float cloudDistance = cloudRadius + cloudStart;
float rayStartDistance = dot(viewPos, viewPos) - (cloudDistance * cloudDistance);
vec2 rayStartIntersect = sphereIntersect(viewPos, rayDir, rayStartDistance);
float rayEndDistance = dot(viewPos, viewPos) - ((cloudDistance + cloudHeight) * (cloudDistance + cloudHeight));
vec2 rayEndIntersect = sphereIntersect(viewPos, rayDir, rayEndDistance);
float distToStart = rayStartIntersect.y;
float totalDistance = rayEndIntersect.y - distToStart;
vec3 sunDirection = normalize(vec3(0, 0, 1));
shading = 0.5 * mainRay(viewPos, rayDir, sunDirection, distToStart, totalDistance, totalTransmittance);
shading = mix(clamp(1.0 - cloudVariables.y, 0.6, 1.0), shading, hazeFactor);
totalTransmittance = mix(0.0, totalTransmittance, hazeFactor);
fragColor = vec4(shading, totalTransmittance, shading, totalTransmittance);`);return B}class q extends l.NoParameters{constructor(){super(...arguments);this.coverage=this.cloudHeight=this.smoothness=this.density=this.absorption=this.detailSize=this.cloudSize=this.cloudRadius=0;this.viewMatrix=k.create()}}const r=b("esri-mobile")?1024:2048,v=h.create();b=Object.freeze(Object.defineProperty({__proto__:null,CloudsPassParameters:q,build:m,cubeMapSize:r},Symbol.toStringTag,{value:"Module"}));a.Clouds=
b;a.CloudsPassParameters=q;a.build=m;a.cubeMapSize=r})},"esri/views/3d/environment/NoiseTextureAtlasDimensions":function(){define(["exports","../../../core/has"],function(a,b){b=b("esri-mobile")?64:128;const n=Math.ceil(Math.sqrt(b)),k=(b+2)*n;a.atlasSize=k;a.textureScale=b/128;a.tileRows=n;a.tileSize=b;a.weatherMapScale=k/1560;a.weatherMapSize=1E5;a.weatherTileSize=128;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass.glsl":function(){define(["exports",
"../shaderModules/interfaces","../../lib/VertexAttribute"],function(a,b,n){a.ScreenSpacePass=function(k,p=!0){k.attributes.add(n.VertexAttribute.POSITION,"vec2");p&&k.varyings.add("uv","vec2");k.vertex.main.add(b.glsl`
      gl_Position = vec4(position, 0.0, 1.0);
      ${p?b.glsl`uv = position * 0.5 + vec2(0.5);`:""}
  `)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/VertexAttribute":function(){define(["exports"],function(a){a.VertexAttribute=void 0;(function(b){b.POSITION="position";b.NORMAL="normal";b.NORMALCOMPRESSED="normalCompressed";b.UV0="uv0";b.COLOR="color";b.SYMBOLCOLOR="symbolColor";b.SIZE="size";b.ROTATION="rotation";b.TANGENT="tangent";b.OFFSET="offset";b.PERSPECTIVEDIVIDE="perspectiveDivide";b.CENTEROFFSETANDDISTANCE="centerOffsetAndDistance";b.LENGTH=
"length";b.PREVPOSITION="prevPosition";b.NEXTPOSITION="nextPosition";b.SUBDIVISIONFACTOR="subdivisionFactor";b.COLORFEATUREATTRIBUTE="colorFeatureAttribute";b.SIZEFEATUREATTRIBUTE="sizeFeatureAttribute";b.OPACITYFEATUREATTRIBUTE="opacityFeatureAttribute";b.DISTANCETOSTART="distanceToStart";b.UVMAPSPACE="uvMapSpace";b.BOUNDINGRECT="boundingRect";b.UVREGION="uvRegion";b.PROFILERIGHT="profileRight";b.PROFILEUP="profileUp";b.PROFILEVERTEXANDNORMAL="profileVertexAndNormal";b.FEATUREVALUE="featureValue";
b.INSTANCEMODELORIGINHI="instanceModelOriginHi";b.INSTANCEMODELORIGINLO="instanceModelOriginLo";b.INSTANCEMODEL="instanceModel";b.INSTANCEMODELNORMAL="instanceModelNormal";b.INSTANCECOLOR="instanceColor";b.INSTANCEFEATUREATTRIBUTE="instanceFeatureAttribute";b.LOCALTRANSFORM="localTransform";b.GLOBALTRANSFORM="globalTransform";b.BOUNDINGSPHERE="boundingSphere";b.MODELORIGIN="modelOrigin";b.MODELSCALEFACTORS="modelScaleFactors";b.FEATUREATTRIBUTE="featureAttribute";b.STATE="state";b.LODLEVEL="lodLevel";
b.POSITION0="position0";b.POSITION1="position1";b.NORMAL2COMPRESSED="normal2Compressed";b.COMPONENTINDEX="componentIndex";b.VARIANTOFFSET="variantOffset";b.VARIANTSTROKE="variantStroke";b.VARIANTEXTENSION="variantExtension";b.SIDENESS="sideness";b.START="start";b.END="end";b.UP="up";b.START_UP="startUp";b.END_UP="endUp";b.EXTRUDE="extrude";b.OBJECTANDLAYERIDCOLOR="objectAndLayerIdColor";b.INSTANCEOBJECTANDLAYERIDCOLOR="instanceObjectAndLayerIdColor"})(a.VertexAttribute||(a.VertexAttribute={}));a.affectsGeometry=
function(b){return b===a.VertexAttribute.POSITION};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/Float2PassUniform":function(){define(["exports","./Uniform","../shaderTechnique/BindType"],function(a,b,n){class k extends b.Uniform{constructor(p,h){super(p,"vec2",n.BindType.Pass,(e,g,d)=>e.setUniform2fv(p,h(g,d)))}}a.Float2PassUniform=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/Uniform":function(){define(["exports",
"../shaderTechnique/BindType"],function(a,b){class n{constructor(k,p,h,e,g=null){this.name=k;this.type=p;this.arraySize=g;this.bind={[b.BindType.Pass]:null,[b.BindType.Draw]:null};if(e)switch(h){case b.BindType.Pass:this.bind[b.BindType.Pass]=e;break;case b.BindType.Draw:this.bind[b.BindType.Draw]=e}}equals(k){return this.type===k.type&&this.name===k.name&&this.arraySize===k.arraySize}}a.Uniform=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderTechnique/BindType":function(){define(["exports"],
function(a){a.BindType=void 0;var b=a.BindType||(a.BindType={});b[b.Pass=0]="Pass";b[b.Draw=1]="Draw";Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/FloatPassUniform":function(){define(["exports","./Uniform","../shaderTechnique/BindType"],function(a,b,n){class k extends b.Uniform{constructor(p,h){super(p,"float",n.BindType.Pass,(e,g,d)=>e.setUniform1f(p,h(g,d)))}}a.FloatPassUniform=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/webgl-engine/core/shaderModules/Matrix3PassUniform":function(){define(["exports","./Uniform","../shaderTechnique/BindType"],function(a,b,n){class k extends b.Uniform{constructor(p,h){super(p,"mat3",n.BindType.Pass,(e,g,d)=>e.setUniformMatrix3fv(p,h(g,d)))}}a.Matrix3PassUniform=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/ShaderBuilder":function(){define("exports ../../../../../core/Error ../../../../../core/has ../../../../../core/Logger ../shaderTechnique/BindType ../../lib/Util".split(" "),
function(a,b,n,k,p,h){class e{constructor(){this._includedModules=new Map}include(q,r){this._includedModules.has(q)?this._includedModules.get(q):(this._includedModules.set(q,r),q(this.builder,r))}}class g extends e{constructor(){super(...arguments);this.vertex=new l;this.fragment=new l;this.attributes=new w;this.varyings=new x;this.extensions=new u;this.outputs=new t}get fragmentUniforms(){return this.fragment.uniforms.entries}get builder(){return this}generate(q){const r=this.extensions.generateSource(q),
v=this.attributes.generateSource(q),y=this.varyings.generateSource(q);var B="vertex"===q?this.vertex:this.fragment;const z=B.uniforms.generateSource(),A=B.code.generateSource(),C=B.main.generateSource(),H="vertex"===q?"precision highp float;\nprecision highp sampler2D;":"#ifdef GL_FRAGMENT_PRECISION_HIGH\n  precision highp float;\n  precision highp sampler2D;\n#else\n  precision mediump float;\n  precision mediump sampler2D;\n#endif";B=B.constants.generateSource();q=this.outputs.generateSource(q);
return`#version 300 es\n${r.join("\n")}\n\n${H}\n\n${B.join("\n")}\n\n${z.join("\n")}\n\n${v.join("\n")}\n\n${y.join("\n")}\n\n${q.join("\n")}\n\n${A.join("\n")}\n\n${C.join("\n")}`}generateBindPass(q){const r=new Map;this.vertex.uniforms.entries.forEach(B=>{const z=B.bind[p.BindType.Pass];z&&r.set(B.name,z)});this.fragment.uniforms.entries.forEach(B=>{const z=B.bind[p.BindType.Pass];z&&r.set(B.name,z)});const v=Array.from(r.values()),y=v.length;return(B,z)=>{for(let A=0;A<y;++A)v[A](q,B,z)}}generateBindDraw(q){const r=
new Map;this.vertex.uniforms.entries.forEach(B=>{const z=B.bind[p.BindType.Draw];z&&r.set(B.name,z)});this.fragment.uniforms.entries.forEach(B=>{const z=B.bind[p.BindType.Draw];z&&r.set(B.name,z)});const v=Array.from(r.values()),y=v.length;return(B,z,A)=>{for(let C=0;C<y;++C)v[C](q,A,B,z)}}}class d{constructor(q){this._stage=q;this._entries=new Map}add(...q){for(const r of q)this._add(r);return this._stage}get(q){return this._entries.get(q)}_add(q){if(null==q)k.getLogger("esri.views.3d.webgl-engine.core.shaderModules.shaderBuilder").error(`Trying to add null Uniform from ${Error().stack}.`);
else{if(this._entries.has(q.name)&&!this._entries.get(q.name).equals(q))throw new b(`Duplicate uniform name ${q.name} for different uniform type`);this._entries.set(q.name,q)}}generateSource(){return Array.from(this._entries.values()).map(q=>null!=q.arraySize?`uniform ${q.type} ${q.name}[${q.arraySize}];`:`uniform ${q.type} ${q.name};`)}get entries(){return Array.from(this._entries.values())}}class f{constructor(q){this._stage=q;this._bodies=[]}add(q){this._bodies.push(q);return this._stage}generateSource(){if(0<
this._bodies.length)return[`void main() {\n ${this._bodies.join("\n")||""} \n}`];throw new b("Shader does not contain main function body.");}}class c{constructor(q){this._stage=q;this._entries=[]}add(q){this._entries.push(q);return this._stage}generateSource(){return this._entries}}class l extends e{constructor(){super(...arguments);this.uniforms=new d(this);this.main=new f(this);this.code=new c(this);this.constants=new m(this)}get builder(){return this}}class w{constructor(){this._entries=[]}add(q,
r){this._entries.push([q,r])}generateSource(q){return"fragment"===q?[]:this._entries.map(r=>`in ${r[1]} ${r[0]};`)}}class x{constructor(){this._entries=new Map}add(q,r){this._entries.has(q)&&h.assert(this._entries.get(q)===r);this._entries.set(q,r)}generateSource(q){const r=[];this._entries.forEach((v,y)=>r.push("vertex"===q?`out ${v} ${y};`:`in ${v} ${y};`));return r}}class u{constructor(){this._entries=new Set}add(q){this._entries.add(q)}generateSource(q){const r="vertex"===q?u.ALLOWLIST_VERTEX:
u.ALLOWLIST_FRAGMENT;return Array.from(this._entries).filter(v=>r.includes(v)).map(v=>`#extension ${v} : enable`)}}u.ALLOWLIST_FRAGMENT=["GL_EXT_shader_texture_lod","GL_OES_standard_derivatives"];u.ALLOWLIST_VERTEX=[];class t{constructor(){this._entries=new Map}add(q,r,v=0){const y=this._entries.get(v);y?h.assert(y.name===q&&y.type===r,`Fragment shader output location ${v} occupied`):this._entries.set(v,{name:q,type:r})}generateSource(q){if("vertex"===q)return[];0===this._entries.size&&this._entries.set(0,
{name:t.DEFAULT_NAME,type:t.DEFAULT_TYPE});const r=[];this._entries.forEach((v,y)=>r.push(`layout(location = ${y}) out ${v.type} ${v.name};`));return r}}t.DEFAULT_TYPE="vec4";t.DEFAULT_NAME="fragColor";class m{constructor(q){this._stage=q;this._entries=new Set}add(q,r,v){let y="ERROR_CONSTRUCTOR_STRING";switch(r){case "float":y=m._numberToFloatStr(v);break;case "int":y=m._numberToIntStr(v);break;case "bool":y=v.toString();break;case "vec2":y=`vec2(${m._numberToFloatStr(v[0])},                            ${m._numberToFloatStr(v[1])})`;
break;case "vec3":y=`vec3(${m._numberToFloatStr(v[0])},                            ${m._numberToFloatStr(v[1])},                            ${m._numberToFloatStr(v[2])})`;break;case "vec4":y=`vec4(${m._numberToFloatStr(v[0])},                            ${m._numberToFloatStr(v[1])},                            ${m._numberToFloatStr(v[2])},                            ${m._numberToFloatStr(v[3])})`;break;case "ivec2":y=`ivec2(${m._numberToIntStr(v[0])},                             ${m._numberToIntStr(v[1])})`;
break;case "ivec3":y=`ivec3(${m._numberToIntStr(v[0])},                             ${m._numberToIntStr(v[1])},                             ${m._numberToIntStr(v[2])})`;break;case "ivec4":y=`ivec4(${m._numberToIntStr(v[0])},                             ${m._numberToIntStr(v[1])},                             ${m._numberToIntStr(v[2])},                             ${m._numberToIntStr(v[3])})`;break;case "mat2":case "mat3":case "mat4":y=`${r}(${Array.prototype.map.call(v,B=>m._numberToFloatStr(B)).join(", ")})`}this._entries.add(`const ${r} ${q} = ${y};`);
return this._stage}static _numberToIntStr(q){return q.toFixed(0)}static _numberToFloatStr(q){return Number.isInteger(q)?q.toFixed(1):q.toString()}generateSource(){return Array.from(this._entries)}}a.Code=c;a.Includes=e;a.Main=f;a.ShaderBuilder=g;a.Stage=l;a.Uniforms=d;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/Util":function(){define(["exports","../../../../core/libs/gl-matrix-2/factories/vec2f64","../../../../chunks/vec42","../../../../core/libs/gl-matrix-2/factories/vec4f64"],
function(a,b,n,k){function p(g,d="Assertion"){if(!g)throw new e(`${d} at ${Error(d).stack}`);}const h=k.create();class e{constructor(g){this.message=g}toString(){return`AssertException: ${this.message}`}}a.assert=p;a.isTranslationMatrix=function(g){return 1===g[0]&&0===g[1]&&0===g[2]&&0===g[3]&&0===g[4]&&1===g[5]&&0===g[6]&&0===g[7]&&0===g[8]&&0===g[9]&&1===g[10]&&0===g[11]&&1===g[15]};a.logWithBase=function(g,d){return Math.log(g)/Math.log(d)};a.project=function(g,d,f,c,l){h[0]=g[0];h[1]=g[1];h[2]=
g[2];h[3]=1;n.transformMat4(h,h,d);2<l.length&&(l[2]=-h[2]);n.transformMat4(h,h,f);p(0!==h[3]);l[0]=h[0]/h[3];l[1]=h[1]/h[3];l[2]=h[2]/h[3];l[0]=(.5*l[0]+.5)*c[2]+c[0];l[1]=(.5*l[1]+.5)*c[3]+c[1]};a.rayBoxTest=function(g,d,f,c){let l,w=(f[0]-g[0])/d[0],x=(c[0]-g[0])/d[0];w>x&&(l=w,w=x,x=l);let u=(f[1]-g[1])/d[1],t=(c[1]-g[1])/d[1];u>t&&(l=u,u=t,t=l);if(w>t||u>x)return!1;u>w&&(w=u);t<x&&(x=t);f=(f[2]-g[2])/d[2];g=(c[2]-g[2])/d[2];f>g&&(l=f,f=g,g=l);if(w>g||f>x)return!1;g<x&&(x=g);return 0>x?!1:!0};
a.rayRay2D=function(g,d,f,c,l,w=b.create()){const x=(c[l]-f[l])*(d[0]-g[0])-(c[0]-f[0])*(d[l]-g[l]);if(0===x)return!1;f=((c[0]-f[0])*(g[l]-f[l])-(c[l]-f[l])*(g[0]-f[0]))/x;w[0]=g[0]+f*(d[0]-g[0]);w[1]=g[l]+f*(d[l]-g[l]);return!0};a.setMatrixTranslation3=function(g,d,f,c){g[12]=d;g[13]=f;g[14]=c};a.verify=function(g,d){g||console.warn("Verify failed: "+(d||"")+"\n"+Error("verify").stack)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform":function(){define(["exports",
"./Uniform","../shaderTechnique/BindType"],function(a,b,n){class k extends b.Uniform{constructor(p,h){super(p,"sampler2D",n.BindType.Pass,(e,g,d)=>e.bindTexture(p,h(g,d)))}}a.Texture2DPassUniform=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/SphereIntersect.glsl":function(){define(["exports","../core/shaderModules/interfaces"],function(a,b){a.SphereIntersect=function(n){n.code.add(b.glsl`vec2 sphereIntersect(vec3 start, vec3 dir, float distance) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float d = (b * b) - 4.0 * a * distance;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/CloudsTechnique":function(){define("require exports ./Clouds ../../../chunks/Clouds.glsl ../webgl-engine/core/shaderTechnique/ReloadableShaderModule ../webgl-engine/core/shaderTechnique/ShaderTechnique ../../webgl/enums ../../webgl/renderState".split(" "),function(a,b,n,k,p,h,e,g){class d extends h.ShaderTechnique{constructor(f,c,l){super(f,c,new p.ReloadableShaderModule(k.Clouds,()=>new Promise((w,x)=>
a(["./Clouds.glsl"],w,x))),l)}initializePipeline(f){return g.makePipelineState({blending:g.simpleBlendingParams(e.BlendFactor.CONSTANT_COLOR,e.BlendFactor.ONE_MINUS_CONSTANT_COLOR,e.BlendOperation.ADD,f.writeTextureChannels===n.CloudsTextureChannels.RG?[1,1,0,0]:[0,0,1,1]),depthTest:{func:e.CompareFunction.LEQUAL},colorWrite:g.defaultColorWrite})}}b.CloudsTechnique=d;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderTechnique/ReloadableShaderModule":function(){define(["exports"],
function(a){class b{constructor(n,k){this._module=n;this._load=k}get(){return this._module}async reload(){return this._module=await this._load()}}a.ReloadableShaderModule=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderTechnique/ShaderTechnique":function(){define("exports ../../../../../core/maybe ../../lib/DefaultVertexAttributeLocations ../../lib/Program ../../../../webgl/enums ../../../../webgl/renderState".split(" "),function(a,b,n,k,p,
h){class e{constructor(g,d,f,c,l=n.Default3D){this.release=c;this.locations=l;this.primitiveType=p.PrimitiveType.TRIANGLES;this.key=d.key;this._program=new k.Program(g.rctx,f.get().build(d),l);this._pipeline=this.initializePipeline(d);this.reload=async w=>{w&&await f.reload();if(!this.key.equals(d.key))throw Error("Configuration was changed after construction, cannot reload shader");b.disposeMaybe(this._program);this._program=new k.Program(g.rctx,f.get().build(d),l);this._pipeline=this.initializePipeline(d)}}destroy(){this._program=
b.disposeMaybe(this._program);this._pipeline=null}get program(){return this._program}get compiled(){return this.program.compiled}ensureAttributeLocations(g){this.program.assertCompatibleVertexAttributeLocations(g)}getPipeline(g,d){return this._pipeline}initializePipeline(g){return h.makePipelineState({blending:h.blendWithPremultipliedAlpha,colorWrite:h.defaultColorWrite})}}a.ShaderTechnique=e;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/DefaultVertexAttributeLocations":function(){define(["exports",
"./VertexAttribute"],function(a,b){b=new Map([[b.VertexAttribute.POSITION,0],[b.VertexAttribute.NORMAL,1],[b.VertexAttribute.NORMALCOMPRESSED,1],[b.VertexAttribute.UV0,2],[b.VertexAttribute.COLOR,3],[b.VertexAttribute.COLORFEATUREATTRIBUTE,3],[b.VertexAttribute.SIZE,4],[b.VertexAttribute.TANGENT,4],[b.VertexAttribute.CENTEROFFSETANDDISTANCE,5],[b.VertexAttribute.SYMBOLCOLOR,5],[b.VertexAttribute.FEATUREATTRIBUTE,6],[b.VertexAttribute.INSTANCEFEATUREATTRIBUTE,6],[b.VertexAttribute.INSTANCECOLOR,7],
[b.VertexAttribute.OBJECTANDLAYERIDCOLOR,7],[b.VertexAttribute.INSTANCEOBJECTANDLAYERIDCOLOR,7],[b.VertexAttribute.ROTATION,8],[b.VertexAttribute.INSTANCEMODEL,8],[b.VertexAttribute.INSTANCEMODELNORMAL,12],[b.VertexAttribute.INSTANCEMODELORIGINHI,11],[b.VertexAttribute.INSTANCEMODELORIGINLO,15]]);a.Default3D=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/Program":function(){define(["exports","../../../../core/PooledArray","../../../webgl/checkWebGLError"],
function(a,b,n){class k{constructor(p,h,e){this._context=p;this._locations=e;this._textures=new Map;this._freeTextureUnits=new b({deallocator:null});this._glProgram=p.programCache.acquire(h.generate("vertex"),h.generate("fragment"),e);this._glProgram.stop=()=>{throw Error("Wrapped _glProgram used directly");};this.bindPass=h.generateBindPass(this);this.bindDraw=h.generateBindDraw(this);this._fragmentUniforms=n.webglDebugEnabled()?h.fragmentUniforms:null}dispose(){this._glProgram.dispose()}get glName(){return this._glProgram.glName}get hasTransformFeedbackVaryings(){return this._glProgram.hasTransformFeedbackVaryings}get compiled(){return this._glProgram.compiled}setUniform1b(p,
h){this._glProgram.setUniform1i(p,h?1:0)}setUniform1i(p,h){this._glProgram.setUniform1i(p,h)}setUniform1f(p,h){this._glProgram.setUniform1f(p,h)}setUniform2fv(p,h){this._glProgram.setUniform2fv(p,h)}setUniform3fv(p,h){this._glProgram.setUniform3fv(p,h)}setUniform4fv(p,h){this._glProgram.setUniform4fv(p,h)}setUniformMatrix3fv(p,h){this._glProgram.setUniformMatrix3fv(p,h)}setUniformMatrix4fv(p,h){this._glProgram.setUniformMatrix4fv(p,h)}setUniform1fv(p,h){this._glProgram.setUniform1fv(p,h)}setUniform1iv(p,
h){this._glProgram.setUniform1iv(p,h)}setUniform2iv(p,h){this._glProgram.setUniform2iv(p,h)}setUniform3iv(p,h){this._glProgram.setUniform3iv(p,h)}setUniform4iv(p,h){this._glProgram.setUniform4iv(p,h)}assertCompatibleVertexAttributeLocations(p){p.locations!==this._locations&&console.error("VertexAttributeLocations are incompatible")}stop(){this._textures.clear();this._freeTextureUnits.clear()}bindTexture(p,h){if(null==h?.glName){if(h=this._textures.get(p))this._context.bindTexture(null,h.unit),this._freeTextureUnit(h),
this._textures.delete(p);return null}let e=this._textures.get(p);null==e?(e=this._allocTextureUnit(h),this._textures.set(p,e)):e.texture=h;this._context.useProgram(this);this.setUniform1i(p,e.unit);this._context.bindTexture(h,e.unit);return e.unit}rebindTextures(){this._context.useProgram(this);this._textures.forEach((p,h)=>{this._context.bindTexture(p.texture,p.unit);this.setUniform1i(h,p.unit)});this._fragmentUniforms?.forEach(p=>{"sampler2D"!==p.type&&"samplerCube"!==p.type||this._textures.has(p.name)||
console.error(`Texture sampler ${p.name} has no bound texture`)})}_allocTextureUnit(p){return{texture:p,unit:0===this._freeTextureUnits.length?this._textures.size:this._freeTextureUnits.pop()}}_freeTextureUnit(p){this._freeTextureUnits.push(p.unit)}}a.Program=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/checkWebGLError":function(){define(["exports","../../core/Error","../../core/has","../../core/Logger"],function(a,b,n,k){function p(e,g){switch(g){case e.INVALID_ENUM:return"Invalid Enum. An unacceptable value has been specified for an enumerated argument.";
case e.INVALID_VALUE:return"Invalid Value. A numeric argument is out of range.";case e.INVALID_OPERATION:return"Invalid Operation. The specified command is not allowed for the current state.";case e.INVALID_FRAMEBUFFER_OPERATION:return"Invalid Framebuffer operation. The currently bound framebuffer is not framebuffer complete when trying to render to or to read from it.";case e.OUT_OF_MEMORY:return"Out of memory. Not enough memory is left to execute the command.";case e.CONTEXT_LOST_WEBGL:return"WebGL context has been lost";
default:return"Unknown error"}}const h=!!n("enable-feature:webgl-debug");a.checkWebGLError=function(e){if(h){var g=e.getError();g&&(e=p(e,g),g=Error().stack,k.getLogger("esri.views.webgl.checkWebGLError").error(new b("webgl-error","WebGL error occurred",{message:e,stack:g})))}};a.hasFeatureFlagWebGLDebug=h;a.webglDebugEnabled=function(){return h};a.webglValidateShadersEnabled=function(){return h};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/enums":function(){define(["exports"],
function(a){a.FramebufferBit=void 0;(function(b){b[b.DEPTH=256]="DEPTH";b[b.STENCIL=1024]="STENCIL";b[b.COLOR=16384]="COLOR"})(a.FramebufferBit||(a.FramebufferBit={}));a.PrimitiveType=void 0;(function(b){b[b.POINTS=0]="POINTS";b[b.LINES=1]="LINES";b[b.LINE_LOOP=2]="LINE_LOOP";b[b.LINE_STRIP=3]="LINE_STRIP";b[b.TRIANGLES=4]="TRIANGLES";b[b.TRIANGLE_STRIP=5]="TRIANGLE_STRIP";b[b.TRIANGLE_FAN=6]="TRIANGLE_FAN"})(a.PrimitiveType||(a.PrimitiveType={}));a.BlendFactor=void 0;(function(b){b[b.ZERO=0]="ZERO";
b[b.ONE=1]="ONE";b[b.SRC_COLOR=768]="SRC_COLOR";b[b.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR";b[b.SRC_ALPHA=770]="SRC_ALPHA";b[b.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA";b[b.DST_ALPHA=772]="DST_ALPHA";b[b.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA";b[b.DST_COLOR=774]="DST_COLOR";b[b.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR";b[b.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE";b[b.CONSTANT_COLOR=32769]="CONSTANT_COLOR";b[b.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR";b[b.CONSTANT_ALPHA=
32771]="CONSTANT_ALPHA";b[b.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA"})(a.BlendFactor||(a.BlendFactor={}));a.BlendOperation=void 0;(function(b){b[b.ADD=32774]="ADD";b[b.MIN=32775]="MIN";b[b.MAX=32776]="MAX";b[b.SUBTRACT=32778]="SUBTRACT";b[b.REVERSE_SUBTRACT=32779]="REVERSE_SUBTRACT"})(a.BlendOperation||(a.BlendOperation={}));a.BufferType=void 0;(function(b){b[b.ARRAY_BUFFER=34962]="ARRAY_BUFFER";b[b.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER";b[b.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER";
b[b.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER";b[b.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER";b[b.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER";b[b.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER";b[b.TRANSFORM_FEEDBACK_BUFFER=35982]="TRANSFORM_FEEDBACK_BUFFER"})(a.BufferType||(a.BufferType={}));a.Face=void 0;(function(b){b[b.FRONT=1028]="FRONT";b[b.BACK=1029]="BACK";b[b.FRONT_AND_BACK=1032]="FRONT_AND_BACK"})(a.Face||(a.Face={}));a.CullMode=void 0;(function(b){b[b.CW=2304]="CW";b[b.CCW=2305]="CCW"})(a.CullMode||
(a.CullMode={}));a.DataType=void 0;(function(b){b[b.BYTE=5120]="BYTE";b[b.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE";b[b.SHORT=5122]="SHORT";b[b.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT";b[b.INT=5124]="INT";b[b.UNSIGNED_INT=5125]="UNSIGNED_INT";b[b.FLOAT=5126]="FLOAT";b[b.HALF_FLOAT=5131]="HALF_FLOAT"})(a.DataType||(a.DataType={}));a.CompareFunction=void 0;(function(b){b[b.NEVER=512]="NEVER";b[b.LESS=513]="LESS";b[b.EQUAL=514]="EQUAL";b[b.LEQUAL=515]="LEQUAL";b[b.GREATER=516]="GREATER";b[b.NOTEQUAL=517]="NOTEQUAL";
b[b.GEQUAL=518]="GEQUAL";b[b.ALWAYS=519]="ALWAYS"})(a.CompareFunction||(a.CompareFunction={}));a.StencilOperation=void 0;(function(b){b[b.ZERO=0]="ZERO";b[b.KEEP=7680]="KEEP";b[b.REPLACE=7681]="REPLACE";b[b.INCR=7682]="INCR";b[b.DECR=7683]="DECR";b[b.INVERT=5386]="INVERT";b[b.INCR_WRAP=34055]="INCR_WRAP";b[b.DECR_WRAP=34056]="DECR_WRAP"})(a.StencilOperation||(a.StencilOperation={}));a.TextureSamplingMode=void 0;(function(b){b[b.NEAREST=9728]="NEAREST";b[b.LINEAR=9729]="LINEAR";b[b.NEAREST_MIPMAP_NEAREST=
9984]="NEAREST_MIPMAP_NEAREST";b[b.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST";b[b.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR";b[b.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR"})(a.TextureSamplingMode||(a.TextureSamplingMode={}));a.TextureWrapMode=void 0;(function(b){b[b.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE";b[b.REPEAT=10497]="REPEAT";b[b.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT"})(a.TextureWrapMode||(a.TextureWrapMode={}));a.TextureType=void 0;(function(b){b[b.TEXTURE_2D=3553]=
"TEXTURE_2D";b[b.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP";b[b.TEXTURE_3D=32879]="TEXTURE_3D";b[b.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X";b[b.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X";b[b.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y";b[b.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y";b[b.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z";b[b.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z";
b[b.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY"})(a.TextureType||(a.TextureType={}));a.PixelFormat=void 0;(function(b){b[b.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT";b[b.DEPTH_STENCIL=34041]="DEPTH_STENCIL";b[b.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8";b[b.ALPHA=6406]="ALPHA";b[b.RGB=6407]="RGB";b[b.RGBA=6408]="RGBA";b[b.LUMINANCE=6409]="LUMINANCE";b[b.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA";b[b.RED=6403]="RED";b[b.RG=33319]="RG";b[b.RED_INTEGER=36244]="RED_INTEGER";b[b.RG_INTEGER=33320]="RG_INTEGER";
b[b.RGB_INTEGER=36248]="RGB_INTEGER";b[b.RGBA_INTEGER=36249]="RGBA_INTEGER"})(a.PixelFormat||(a.PixelFormat={}));a.SizedPixelFormat=void 0;(function(b){b[b.RGBA4=32854]="RGBA4";b[b.R16F=33325]="R16F";b[b.RG16F=33327]="RG16F";b[b.RGB32F=34837]="RGB32F";b[b.RGBA16F=34842]="RGBA16F";b[b.R32F=33326]="R32F";b[b.RG32F=33328]="RG32F";b[b.RGBA32F=34836]="RGBA32F";b[b.R11F_G11F_B10F=35898]="R11F_G11F_B10F";b[b.RGB8=32849]="RGB8";b[b.RGBA8=32856]="RGBA8";b[b.RGB5_A1=32855]="RGB5_A1";b[b.R8=33321]="R8";b[b.RG8=
33323]="RG8";b[b.R8I=33329]="R8I";b[b.R8UI=33330]="R8UI";b[b.R16I=33331]="R16I";b[b.R16UI=33332]="R16UI";b[b.R32I=33333]="R32I";b[b.R32UI=33334]="R32UI";b[b.RG8I=33335]="RG8I";b[b.RG8UI=33336]="RG8UI";b[b.RG16I=33337]="RG16I";b[b.RG16UI=33338]="RG16UI";b[b.RG32I=33339]="RG32I";b[b.RG32UI=33340]="RG32UI";b[b.RGB16F=34843]="RGB16F";b[b.RGB9_E5=35901]="RGB9_E5";b[b.SRGB8=35905]="SRGB8";b[b.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8";b[b.RGB565=36194]="RGB565";b[b.RGBA32UI=36208]="RGBA32UI";b[b.RGB32UI=36209]=
"RGB32UI";b[b.RGBA16UI=36214]="RGBA16UI";b[b.RGB16UI=36215]="RGB16UI";b[b.RGBA8UI=36220]="RGBA8UI";b[b.RGB8UI=36221]="RGB8UI";b[b.RGBA32I=36226]="RGBA32I";b[b.RGB32I=36227]="RGB32I";b[b.RGBA16I=36232]="RGBA16I";b[b.RGB16I=36233]="RGB16I";b[b.RGBA8I=36238]="RGBA8I";b[b.RGB8I=36239]="RGB8I";b[b.R8_SNORM=36756]="R8_SNORM";b[b.RG8_SNORM=36757]="RG8_SNORM";b[b.RGB8_SNORM=36758]="RGB8_SNORM";b[b.RGBA8_SNORM=36759]="RGBA8_SNORM";b[b.RGB10_A2=32857]="RGB10_A2";b[b.RGB10_A2UI=36975]="RGB10_A2UI"})(a.SizedPixelFormat||
(a.SizedPixelFormat={}));a.PixelType=void 0;(function(b){b[b.FLOAT=5126]="FLOAT";b[b.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE";b[b.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8";b[b.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4";b[b.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1";b[b.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5";b[b.BYTE=5120]="BYTE";b[b.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT";b[b.SHORT=5122]="SHORT";b[b.UNSIGNED_INT=5125]="UNSIGNED_INT";b[b.INT=5124]="INT";b[b.HALF_FLOAT=
5131]="HALF_FLOAT";b[b.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV";b[b.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV";b[b.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV";b[b.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV"})(a.PixelType||(a.PixelType={}));a.RenderbufferFormat=void 0;(function(b){b[b.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16";b[b.STENCIL_INDEX8=36168]="STENCIL_INDEX8";b[b.DEPTH_STENCIL=34041]="DEPTH_STENCIL";
b[b.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24";b[b.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F";b[b.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8";b[b.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8"})(a.RenderbufferFormat||(a.RenderbufferFormat={}));a.Usage=void 0;(function(b){b[b.STATIC_DRAW=35044]="STATIC_DRAW";b[b.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW";b[b.STREAM_DRAW=35040]="STREAM_DRAW";b[b.STATIC_READ=35045]="STATIC_READ";b[b.DYNAMIC_READ=35049]="DYNAMIC_READ";b[b.STREAM_READ=35041]="STREAM_READ";
b[b.STATIC_COPY=35046]="STATIC_COPY";b[b.DYNAMIC_COPY=35050]="DYNAMIC_COPY";b[b.STREAM_COPY=35042]="STREAM_COPY"})(a.Usage||(a.Usage={}));a.ShaderType=void 0;(function(b){b[b.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER";b[b.VERTEX_SHADER=35633]="VERTEX_SHADER"})(a.ShaderType||(a.ShaderType={}));a.FramebufferTarget=void 0;(function(b){b[b.FRAMEBUFFER=36160]="FRAMEBUFFER";b[b.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER";b[b.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER"})(a.FramebufferTarget||(a.FramebufferTarget=
{}));a.ResourceType=void 0;(function(b){b[b.Texture=0]="Texture";b[b.BufferObject=1]="BufferObject";b[b.VertexArrayObject=2]="VertexArrayObject";b[b.Shader=3]="Shader";b[b.Program=4]="Program";b[b.FramebufferObject=5]="FramebufferObject";b[b.Renderbuffer=6]="Renderbuffer";b[b.TransformFeedback=7]="TransformFeedback";b[b.Sync=8]="Sync";b[b.UNCOUNTED=9]="UNCOUNTED";b[b.LinesOfCode=9]="LinesOfCode";b[b.Uniform=10]="Uniform";b[b.COUNT=11]="COUNT"})(a.ResourceType||(a.ResourceType={}));a.ColorAttachment=
void 0;(function(b){b[b.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0";b[b.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1";b[b.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2";b[b.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3";b[b.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4";b[b.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5";b[b.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6";b[b.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7";b[b.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8";b[b.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9";
b[b.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10";b[b.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11";b[b.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12";b[b.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13";b[b.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14";b[b.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15"})(a.ColorAttachment||(a.ColorAttachment={}));a.SpecialDrawBuffers=void 0;(function(b){b[b.NONE=0]="NONE";b[b.BACK=1029]="BACK"})(a.SpecialDrawBuffers||(a.SpecialDrawBuffers={}));a.CompressedTextureFormat=
void 0;(function(b){b[b.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT";b[b.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT";b[b.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT";b[b.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT";b[b.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC";b[b.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC";b[b.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC";b[b.COMPRESSED_SIGNED_RG11_EAC=
37491]="COMPRESSED_SIGNED_RG11_EAC";b[b.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2";b[b.COMPRESSED_SRGB8_ETC2=37493]="COMPRESSED_SRGB8_ETC2";b[b.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2";b[b.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2";b[b.COMPRESSED_RGBA8_ETC2_EAC=37496]="COMPRESSED_RGBA8_ETC2_EAC";b[b.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC"})(a.CompressedTextureFormat||
(a.CompressedTextureFormat={}));a.UniformType=void 0;(function(b){b[b.FLOAT=5126]="FLOAT";b[b.FLOAT_VEC2=35664]="FLOAT_VEC2";b[b.FLOAT_VEC3=35665]="FLOAT_VEC3";b[b.FLOAT_VEC4=35666]="FLOAT_VEC4";b[b.INT=5124]="INT";b[b.INT_VEC2=35667]="INT_VEC2";b[b.INT_VEC3=35668]="INT_VEC3";b[b.INT_VEC4=35669]="INT_VEC4";b[b.BOOL=35670]="BOOL";b[b.BOOL_VEC2=35671]="BOOL_VEC2";b[b.BOOL_VEC3=35672]="BOOL_VEC3";b[b.BOOL_VEC4=35673]="BOOL_VEC4";b[b.FLOAT_MAT2=35674]="FLOAT_MAT2";b[b.FLOAT_MAT3=35675]="FLOAT_MAT3";b[b.FLOAT_MAT4=
35676]="FLOAT_MAT4";b[b.SAMPLER_2D=35678]="SAMPLER_2D";b[b.SAMPLER_CUBE=35680]="SAMPLER_CUBE";b[b.UNSIGNED_INT=5125]="UNSIGNED_INT";b[b.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2";b[b.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3";b[b.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4";b[b.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3";b[b.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4";b[b.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2";b[b.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4";b[b.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2";b[b.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3";
b[b.SAMPLER_3D=35679]="SAMPLER_3D";b[b.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW";b[b.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY";b[b.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW";b[b.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW";b[b.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D";b[b.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D";b[b.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE";b[b.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY";b[b.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D";b[b.UNSIGNED_INT_SAMPLER_3D=
36307]="UNSIGNED_INT_SAMPLER_3D";b[b.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE";b[b.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY"})(a.UniformType||(a.UniformType={}));a.SyncParameter=void 0;(function(b){b[b.OBJECT_TYPE=37138]="OBJECT_TYPE";b[b.SYNC_CONDITION=37139]="SYNC_CONDITION";b[b.SYNC_STATUS=37140]="SYNC_STATUS";b[b.SYNC_FLAGS=37141]="SYNC_FLAGS"})(a.SyncParameter||(a.SyncParameter={}));a.SyncStatus=void 0;(function(b){b[b.UNSIGNALED=37144]="UNSIGNALED";
b[b.SIGNALED=37145]="SIGNALED"})(a.SyncStatus||(a.SyncStatus={}));a.ClientWaitSyncStatus=void 0;(function(b){b[b.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED";b[b.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED";b[b.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED";b[b.WAIT_FAILED=37149]="WAIT_FAILED"})(a.ClientWaitSyncStatus||(a.ClientWaitSyncStatus={}));a.SyncCondition=void 0;(function(b){b[b.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE"})(a.SyncCondition||(a.SyncCondition={}));a.SyncFlag=
void 0;(function(b){b[b.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT"})(a.SyncFlag||(a.SyncFlag={}));a.DepthStencilAttachment=33306;a.baseTextureUnit=33984;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/renderState":function(){define(["exports","../3d/webgl-engine/lib/basicInterfaces","./enums"],function(a,b,n){function k(U,da,fa=n.BlendOperation.ADD,ha=[0,0,0,0]){return{srcRgb:U,srcAlpha:U,dstRgb:da,dstAlpha:da,opRgb:fa,opAlpha:fa,color:{r:ha[0],g:ha[1],
b:ha[2],a:ha[3]}}}function p(U,da,fa,ha,T=n.BlendOperation.ADD,S=n.BlendOperation.ADD,Z=[0,0,0,0]){return{srcRgb:U,srcAlpha:da,dstRgb:fa,dstAlpha:ha,opRgb:T,opAlpha:S,color:{r:Z[0],g:Z[1],b:Z[2],a:Z[3]}}}function h(U){return N.intern(U)}function e(U){return M.intern(U)}function g(U){return Q.intern(U)}function d(U){return O.intern(U)}function f(U){return K.intern(U)}function c(U){return L.intern(U)}function l(U){return P.intern(U)}function w(U){return R.intern(U)}function x(U){return W.intern(U)}
function u(U){return"["+U.join(",")+"]"}function t(U){return U?u([U.srcRgb,U.srcAlpha,U.dstRgb,U.dstAlpha,U.opRgb,U.opAlpha,U.color.r,U.color.g,U.color.b,U.color.a]):null}function m(U){return U?u([U.face,U.mode]):null}function q(U){return U?u([U.factor,U.units]):null}function r(U){return U?u([U.func]):null}function v(U){return U?u([U.function.func,U.function.ref,U.function.mask,U.operation.fail,U.operation.zFail,U.operation.zPass]):null}function y(U){return U?u([U.zNear,U.zFar]):null}function B(U){return U?
u([U.r,U.g,U.b,U.a]):null}function z(U){return U?u([U.mask]):null}function A(U){return U?u(U.buffers):null}const C=k(n.BlendFactor.ZERO,n.BlendFactor.ONE_MINUS_SRC_ALPHA),H=k(n.BlendFactor.ONE,n.BlendFactor.ZERO),E=k(n.BlendFactor.ONE,n.BlendFactor.ONE),F=k(n.BlendFactor.ONE,n.BlendFactor.ONE_MINUS_SRC_ALPHA),G=p(n.BlendFactor.SRC_ALPHA,n.BlendFactor.ONE,n.BlendFactor.ONE_MINUS_SRC_ALPHA,n.BlendFactor.ONE_MINUS_SRC_ALPHA),D={face:n.Face.BACK,mode:n.CullMode.CCW},I={face:n.Face.FRONT,mode:n.CullMode.CCW};
class J{constructor(U,da){this._makeKey=U;this._makeRef=da;this._interns=new Map}intern(U){if(!U)return null;const da=this._makeKey(U),fa=this._interns;fa.has(da)||fa.set(da,this._makeRef(U));return fa.get(da)??null}}const N=new J(t,U=>({__tag:"Blending",...U})),M=new J(m,U=>({__tag:"Culling",...U})),Q=new J(q,U=>({__tag:"PolygonOffset",...U})),O=new J(r,U=>({__tag:"DepthTest",...U})),K=new J(v,U=>({__tag:"StencilTest",...U})),L=new J(y,U=>({__tag:"DepthWrite",...U})),P=new J(B,U=>({__tag:"ColorWrite",
...U})),R=new J(z,U=>({__tag:"StencilWrite",...U})),W=new J(A,U=>({__tag:"DrawBuffers",...U})),V=new J(function(U){return U?u([t(U.blending),m(U.culling),q(U.polygonOffset),r(U.depthTest),v(U.stencilTest),y(U.depthWrite),B(U.colorWrite),z(U.stencilWrite),A(U.drawBuffers)]):null},U=>({blending:h(U.blending),culling:e(U.culling),polygonOffset:g(U.polygonOffset),depthTest:d(U.depthTest),stencilTest:f(U.stencilTest),depthWrite:c(U.depthWrite),colorWrite:l(U.colorWrite),stencilWrite:w(U.stencilWrite),
drawBuffers:x(U.drawBuffers)}));class ba{constructor(U){this._drawBuffersInvalid=this._stencilWriteInvalid=this._colorWriteInvalid=this._depthWriteInvalid=this._stencilTestInvalid=this._depthTestInvalid=this._polygonOffsetInvalid=this._cullingInvalid=this._blendingInvalid=this._pipelineInvalid=!0;this._stateSetters=U}setPipeline(U){if(this._pipelineInvalid||U!==this._pipeline)this._setBlending(U.blending),this._setCulling(U.culling),this._setPolygonOffset(U.polygonOffset),this._setDepthTest(U.depthTest),
this._setStencilTest(U.stencilTest),this._setDepthWrite(U.depthWrite),this._setColorWrite(U.colorWrite),this._setStencilWrite(U.stencilWrite),this._setDrawBuffers(U.drawBuffers),this._pipeline=U;this._pipelineInvalid=!1}invalidateBlending(){this._pipelineInvalid=this._blendingInvalid=!0}invalidateCulling(){this._pipelineInvalid=this._cullingInvalid=!0}invalidatePolygonOffset(){this._pipelineInvalid=this._polygonOffsetInvalid=!0}invalidateDepthTest(){this._pipelineInvalid=this._depthTestInvalid=!0}invalidateStencilTest(){this._pipelineInvalid=
this._stencilTestInvalid=!0}invalidateDepthWrite(){this._pipelineInvalid=this._depthWriteInvalid=!0}invalidateColorWrite(){this._pipelineInvalid=this._colorWriteInvalid=!0}invalidateStencilWrite(){this._pipelineInvalid=this._stencilTestInvalid=!0}invalidateDrawBuffers(){this._pipelineInvalid=this._drawBuffersInvalid=!0}_setBlending(U){this._blending=this._setSubState(U,this._blending,this._blendingInvalid,this._stateSetters.setBlending);this._blendingInvalid=!1}_setCulling(U){this._culling=this._setSubState(U,
this._culling,this._cullingInvalid,this._stateSetters.setCulling);this._cullingInvalid=!1}_setPolygonOffset(U){this._polygonOffset=this._setSubState(U,this._polygonOffset,this._polygonOffsetInvalid,this._stateSetters.setPolygonOffset);this._polygonOffsetInvalid=!1}_setDepthTest(U){this._depthTest=this._setSubState(U,this._depthTest,this._depthTestInvalid,this._stateSetters.setDepthTest);this._depthTestInvalid=!1}_setStencilTest(U){this._stencilTest=this._setSubState(U,this._stencilTest,this._stencilTestInvalid,
this._stateSetters.setStencilTest);this._stencilTestInvalid=!1}_setDepthWrite(U){this._depthWrite=this._setSubState(U,this._depthWrite,this._depthWriteInvalid,this._stateSetters.setDepthWrite);this._depthWriteInvalid=!1}_setColorWrite(U){this._colorWrite=this._setSubState(U,this._colorWrite,this._colorWriteInvalid,this._stateSetters.setColorWrite);this._colorWriteInvalid=!1}_setStencilWrite(U){this._stencilWrite=this._setSubState(U,this._stencilWrite,this._stencilWriteInvalid,this._stateSetters.setStencilWrite);
this._stencilTestInvalid=!1}_setDrawBuffers(U){this._drawBuffers=this._setSubState(U,this._drawBuffers,this._drawBuffersInvalid,this._stateSetters.setDrawBuffers);this._drawBuffersInvalid=!1}_setSubState(U,da,fa,ha){if(fa||U!==da)ha(U),this._pipelineInvalid=!0;return U}}a.StateTracker=ba;a.backFaceCullingParams=D;a.blendWithPremultipliedAlpha=F;a.cullingParams=U=>U===b.CullFaceOptions.Back?D:U===b.CullFaceOptions.Front?I:null;a.defaultColorWrite={r:!0,g:!0,b:!0,a:!0};a.defaultDepthWrite={zNear:0,
zFar:1};a.frontFaceCullingParams=I;a.keepSourceValues=H;a.makeBlending=h;a.makeColorWrite=l;a.makeCulling=e;a.makeDepthTest=d;a.makeDepthWrite=c;a.makeDrawBuffers=x;a.makePipelineState=function(U){return V.intern(U)};a.makePolygonOffset=g;a.makeStencilTest=f;a.makeStencilWrite=w;a.premultipliedAlphaToPremultipliedAlpha=G;a.separateBlendingParams=p;a.simpleBlendingParams=k;a.weightedAdd=E;a.writeDestinationPremultipliedAlpha=C;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/basicInterfaces":function(){define(["exports"],
function(a){a.CullFaceOptions=void 0;(function(b){b[b.None=0]="None";b[b.Front=1]="Front";b[b.Back=2]="Back";b[b.COUNT=3]="COUNT"})(a.CullFaceOptions||(a.CullFaceOptions={}));a.DepthTestFunction=void 0;(function(b){b[b.Less=0]="Less";b[b.Lequal=1]="Lequal";b[b.COUNT=2]="COUNT"})(a.DepthTestFunction||(a.DepthTestFunction={}));a.RenderRequestType=void 0;(function(b){b[b.BACKGROUND=0]="BACKGROUND";b[b.UPDATE=1]="UPDATE"})(a.RenderRequestType||(a.RenderRequestType={}));a.ResourceState=void 0;(function(b){b[b.NOT_LOADED=
0]="NOT_LOADED";b[b.LOADING=1]="LOADING";b[b.LOADED=2]="LOADED"})(a.ResourceState||(a.ResourceState={}));a.StencilBits=void 0;(function(b){b[b.IntegratedMeshMaskExcluded=1]="IntegratedMeshMaskExcluded";b[b.OutlineVisualElementMask=2]="OutlineVisualElementMask"})(a.StencilBits||(a.StencilBits={}));a.Object3DState=void 0;(function(b){b[b.Highlight=0]="Highlight";b[b.MaskOccludee=1]="MaskOccludee"})(a.Object3DState||(a.Object3DState={}));a.AlphaDiscardMode=void 0;(function(b){b[b.Blend=0]="Blend";b[b.Opaque=
1]="Opaque";b[b.Mask=2]="Mask";b[b.MaskBlend=3]="MaskBlend";b[b.COUNT=4]="COUNT"})(a.AlphaDiscardMode||(a.AlphaDiscardMode={}));a.TextureEncodingMimeType=void 0;(function(b){b.DDS_ENCODING="image/vnd-ms.dds";b.KTX2_ENCODING="image/ktx2";b.BASIS_ENCODING="image/x.basis"})(a.TextureEncodingMimeType||(a.TextureEncodingMimeType={}));Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/NoiseTextureAtlas":function(){define("exports ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/maybe ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ../../../core/libs/gl-matrix-2/math/vec2 ../../../chunks/NoiseTextureAtlas.glsl ./NoiseTextureAtlasConfiguration ./NoiseTextureAtlasDimensions ./NoiseTextureAtlasTechnique ../../webgl/FramebufferObject ../../webgl/TextureDescriptor".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w,x,u,t){a.NoiseTextureAtlas=class extends n{constructor(m){super(m);this._needsRender=!0;this._passParameters=new c.NoiseTextureAtlasPassParameters;this._configuration=new l.NoiseTextureAtlasTechniqueConfiguration;this._fbo=new u.FramebufferObject(m.context.renderContext.rctx,new t.TextureDescriptor(w.atlasSize));this._configuration.mode=l.NoiseTextureRenderMode.Full;m.context.techniques.precompile(x.NoiseTextureAtlasTechnique,this._configuration);this._configuration.mode=
l.NoiseTextureRenderMode.WeatherMap;m.context.techniques.precompile(x.NoiseTextureAtlasTechnique,this._configuration)}get textureAtlas(){if(this._texture&&!this._needsRender)return this._texture;this._configuration.mode=this._texture?l.NoiseTextureRenderMode.WeatherMap:l.NoiseTextureRenderMode.Full;const m=this.context.techniques.acquire(x.NoiseTextureAtlasTechnique,this._configuration);m.compiled&&(this._texture=this._render(m));m.release();return this._texture}updateWeatherMap(m){f.equals(this._passParameters.weatherTile,
m)||(f.copy(this._passParameters.weatherTile,m),this._needsRender=!0)}destroy(){this._weatherMapTechniqueCached=k.releaseMaybe(this._weatherMapTechniqueCached);this._fbo=k.disposeMaybe(this._fbo)}_render(m){if(!this._fbo)return null;const q=this.context.renderContext.rctx,r=q.getViewport();q.setViewport(0,0,w.atlasSize,w.atlasSize);q.bindFramebuffer(this._fbo);q.bindTechnique(m,this.context.renderContext.bind,this._passParameters);q.screen.draw();q.setViewport(r.x,r.y,r.width,r.height);this._needsRender=
!1;return this._fbo.colorTexture}};b.__decorate([p.property({constructOnly:!0})],a.NoiseTextureAtlas.prototype,"context",void 0);a.NoiseTextureAtlas=b.__decorate([d.subclass("esri.views.3d.environment.NoiseTextureAtlas")],a.NoiseTextureAtlas);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/NoiseTextureAtlas.glsl":function(){define("exports ../core/libs/gl-matrix-2/factories/vec2f64 ../views/3d/environment/NoiseTextureAtlasConfiguration ../views/3d/environment/NoiseTextureAtlasDimensions ../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass.glsl ../views/3d/webgl-engine/core/shaderModules/Float2PassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder".split(" "),
function(a,b,n,k,p,h,e,g){function d(l){const w=new g.ShaderBuilder;w.include(p.ScreenSpacePass,!1);w.fragment.code.add(e.glsl`float remap(float x, float low1, float high1, float low2, float high2) {
return low2 + (x - low1) * (high2 - low2) / (high1 - low1);
}`);l.mode===n.NoiseTextureRenderMode.Full&&(w.fragment.code.add(e.glsl`float saturate(float x) {
return clamp(x, 0.0, 1.0);
}`),w.fragment.code.add(e.glsl`vec3 modulo(vec3 m, float n) {
return mod(mod(m, n) + n, n);
}
vec3 hash(vec3 p3, float frequency) {
p3 = modulo(p3, frequency);
p3 = fract(p3 * vec3(0.1031, 0.1030, 0.0973));
p3 += dot(p3, p3.yxz + 33.33);
return -1.0 + 2.0 * fract((p3.xxy + p3.yxx) * p3.zyx);
}`),w.fragment.code.add(e.glsl`vec3 fade(vec3 t) {
return (t * t * t) * (t * (t * 6.0 - 15.0) + 10.0);
}`),w.fragment.code.add(e.glsl`
    float gradientNoise(vec3 p, float frequency) {
      vec3 i = floor(p);
      vec3 f = fract(p);
      vec3 u = fade(f);
      return mix( mix( mix( dot( hash( i + vec3(0.0,0.0,0.0), frequency), f - vec3(0.0,0.0,0.0) ),
                            dot( hash( i + vec3(1.0,0.0,0.0), frequency), f - vec3(1.0,0.0,0.0) ), u.x),
                       mix( dot( hash( i + vec3(0.0,1.0,0.0), frequency), f - vec3(0.0,1.0,0.0) ),
                            dot( hash( i + vec3(1.0,1.0,0.0), frequency), f - vec3(1.0,1.0,0.0) ), u.x), u.y),
                  mix( mix( dot( hash( i + vec3(0.0,0.0,1.0), frequency), f - vec3(0.0,0.0,1.0) ),
                            dot( hash( i + vec3(1.0,0.0,1.0), frequency), f - vec3(1.0,0.0,1.0) ), u.x),
                       mix( dot( hash( i + vec3(0.0,1.0,1.0), frequency), f - vec3(0.0,1.0,1.0) ),
                            dot( hash( i + vec3(1.0,1.0,1.0), frequency), f - vec3(1.0,1.0,1.0) ), u.x), u.y), u.z );
    }

    float getPerlinNoise(vec3 pos, float frequency) {
      float octaveFrequency = 2.0;
      float sum = 0.0;
      float weightSum = 0.0;
      float weight = 1.0;

      for (int oct = 0; oct < 3; oct++) {
        vec3 p = pos * frequency;
        float val = 0.5 + 0.5 * gradientNoise(p, frequency);
        sum += val * weight;
        weightSum += weight;
        weight *= 0.5;
        frequency *= octaveFrequency;
      }

      float noise = (sum / weightSum);
      noise = saturate(noise);
      return noise;
    }

    float worley(vec3 pos, float numCells) {
      vec3 p = pos * numCells;
      float d = 1.0e10;

      for (int x = -1; x <= 1; x++) {
        for (int y = -1; y <= 1; y++) {
          for (int z = -1; z <= 1; z++) {
            vec3 tp = floor(p) + vec3(x, y, z);
            tp = p - tp - (hash(tp, numCells) * 0.5 + 0.5);
            d = min(d, dot(tp, tp));
          }
        }
      }

      return 1.0 - clamp(d, 0.0, 1.0);
    }

    vec3 get3Dfrom2D(vec2 uv) {
      vec2 tile = floor(uv);
      float z = floor(${e.glsl.float(k.tileRows)} * tile.y + tile.x);
      return vec3(fract(uv), z);
    }

    float getTextureForPointPerlinWorley(vec3 p) {
      float perlinNoise = getPerlinNoise(p, ${e.glsl.float(8)});

      float worley0 = worley(p, ${e.glsl.float(2)} * 2.0);
      float worley1 = worley(p, ${e.glsl.float(2)} * 8.0);
      float worley2 = worley(p, ${e.glsl.float(2)} * 14.0);

      float worleyFBM = worley0 * 0.625 + worley1 * 0.25 + worley2 * 0.125;
      return remap(perlinNoise, 0.0, 1.0, worleyFBM, 1.0);
    }

    float getTextureForPointWorley(vec3 p) {
      float worley0 = worley(p, ${e.glsl.float(2)});
      float worley1 = worley(p, ${e.glsl.float(2)} * 2.0);
      float worley2 = worley(p, ${e.glsl.float(2)} * 4.0);
      float worley3 = worley(p, ${e.glsl.float(2)} * 8.0);

      float FBM0 = worley0 * 0.625 + worley1 * 0.25 + worley2 * 0.125;
      float FBM1 = worley1 * 0.625 + worley2 * 0.25 + worley3 * 0.125;
      float FBM2 = worley2 * 0.75 + worley3 * 0.25;

      return FBM0 * 0.625 + FBM1 * 0.25 + FBM2 * 0.125;
    }
  `));w.fragment.uniforms.add(new h.Float2PassUniform("weatherTile",x=>x.weatherTile)).code.add(e.glsl`
    vec2 modulo(vec2 m, float n){
      return mod(mod(m, n) + n, n);
    }

    vec2 hash(vec2 p){
      // Get position of p in weather tile
      p = modulo(p, ${e.glsl.float(k.weatherTileSize)});

      // Get global coordinates of p
      p += weatherTile * ${e.glsl.float(k.weatherTileSize)};

      // Limit position to avoid numerical instability
      p = modulo(p, ${e.glsl.float(k.weatherMapSize)});

      vec3 p3 = fract(vec3(p.xyx) * vec3(0.1031, 0.1030, 0.0973));
      p3 += dot(p3, p3.yzx + 33.33);
      return 2.0 * fract((p3.xx + p3.yz) * p3.zy) - 1.0;
    }

    vec2 fade(vec2 t){
      return (t * t * t) * (t * (t * 6.0 - 15.0) + 10.0);
    }

    float gradientNoise(vec2 p){
      vec2 i = floor( p );
      vec2 f = fract( p );

      vec2 u = fade(f);

      // Bilinear interpolation of gradients at cell vertices around point
      return  mix(
                mix(dot( hash( i + vec2(0.0,0.0) ), f - vec2(0.0,0.0) ),
                    dot( hash( i + vec2(1.0,0.0) ), f - vec2(1.0,0.0) ), u.x),
                mix(dot( hash( i + vec2(0.0,1.0) ), f - vec2(0.0,1.0) ),
                    dot( hash( i + vec2(1.0,1.0) ), f - vec2(1.0,1.0) ), u.x),
                u.y);
    }

    float worley(vec2 p){
      float d = 1.0e10;
      for (int x = -1; x <= 1; x++){
        for (int y = -1; y <= 1; y++){
                vec2 tp = floor(p) + vec2(x, y);
                tp = p - tp - (0.5 + 0.5 * hash(tp));
                d = min(d, dot(tp, tp));
            }
        }
      return 1.0 - clamp(d, 0.0, 1.0);
    }
  `);l.mode===n.NoiseTextureRenderMode.Full?w.fragment.main.add(e.glsl`
      float padWidth = 1.0;
      float paddedSize = ${e.glsl.float(k.tileSize)} + 2.0 * padWidth;
      float tileCount = ${e.glsl.float(k.tileRows)} * ${e.glsl.float(k.tileRows)};
      vec2 tile = floor((gl_FragCoord.xy - 0.5) / paddedSize);

      bool padCell = false;
      if (mod(gl_FragCoord.x, paddedSize) == 0.5 || mod(gl_FragCoord.x, paddedSize) == paddedSize - 0.5) {
        padCell = true;
      }

      if (mod(gl_FragCoord.y, paddedSize) == 0.5 || mod(gl_FragCoord.y, paddedSize) == paddedSize - 0.5) {
        padCell = true;
      }

      bool startPadX = false;
      bool startPadY = false;
      bool endPadX = false;
      bool endPadY = false;

      if (gl_FragCoord.x == tile.x * paddedSize + 0.5) {
        startPadX = true;
      }

      if (gl_FragCoord.y == tile.y * paddedSize + 0.5) {
        startPadY = true;
      }

      if (gl_FragCoord.x == (tile.x + 1.0) * paddedSize - 0.5) {
        endPadX = true;
      }

      if (gl_FragCoord.y == (tile.y + 1.0) * paddedSize - 0.5) {
        endPadY = true;
      }

      vec2 padding = vec2(2.0 * padWidth) * tile;
      vec2 uv;

      if (padCell) {
        vec2 pixel = gl_FragCoord.xy - padWidth - padding;

        if (startPadX) {
          pixel.x += ${e.glsl.float(k.tileSize)};
        }

        if (startPadY) {
          pixel.y += ${e.glsl.float(k.tileSize)};
        }

        if (endPadX) {
          pixel.x -= ${e.glsl.float(k.tileSize)};
        }

        if (endPadY) {
          pixel.y -= ${e.glsl.float(k.tileSize)};
        }

        uv = vec2(pixel.xy / ${e.glsl.float(k.tileSize)});
      } else {
        vec2 pixel = gl_FragCoord.xy - padWidth - padding;
        uv = vec2(pixel.xy / ${e.glsl.float(k.tileSize)});
      }

      vec3 p_ = get3Dfrom2D(uv);
      vec3 p = p_;
      p.z /= (${e.glsl.float(k.tileRows)} * ${e.glsl.float(k.tileRows)});

      float worleyPerlinNoise = getTextureForPointPerlinWorley(p);
      float worleyNoise = getTextureForPointWorley(p);

      fragColor.r = saturate(remap(worleyPerlinNoise, worleyNoise, 1.0, 0.0, 1.0));

      p_ = mod(p_ + 1.0, ${e.glsl.float(k.tileRows)} * ${e.glsl.float(k.tileRows)});
      p = p_;
      p.z /= (${e.glsl.float(k.tileRows)} * ${e.glsl.float(k.tileRows)});

      worleyPerlinNoise = getTextureForPointPerlinWorley(p);
      worleyNoise = getTextureForPointWorley(p);

      fragColor.g = saturate(remap(worleyPerlinNoise, worleyNoise, 1.0, 0.0, 1.0));

      vec2 mapUV = ${e.glsl.float(k.weatherTileSize)} * (gl_FragCoord.xy / ${e.glsl.float(k.atlasSize)});
      float map = abs(gradientNoise(mapUV));
      map = remap(map, 0.25 * (1.0 - worley(8.0 * mapUV)), 1.0, 0.0, 1.0);
      fragColor.ba = vec2(0.0, map);
      `):w.fragment.main.add(e.glsl`
      vec2 mapUV = ${e.glsl.float(k.weatherTileSize)} * (gl_FragCoord.xy / ${e.glsl.float(k.atlasSize)});
      float map = abs(gradientNoise(mapUV));
      map = remap(map, 0.25 * (1.0 - worley(8.0 * mapUV)), 1.0, 0.0, 1.0);
      fragColor = vec4(map);
    `);return w}class f extends e.NoParameters{constructor(){super(...arguments);this.weatherTile=b.fromValues(0,0)}}const c=Object.freeze(Object.defineProperty({__proto__:null,NoiseTextureAtlasPassParameters:f,build:d},Symbol.toStringTag,{value:"Module"}));a.NoiseTextureAtlas=c;a.NoiseTextureAtlasPassParameters=f;a.build=d})},"esri/views/3d/environment/NoiseTextureAtlasConfiguration":function(){define(["exports","../../../chunks/tslib.es6","../webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration"],
function(a,b,n){a.NoiseTextureRenderMode=void 0;(function(p){p[p.Full=0]="Full";p[p.WeatherMap=1]="WeatherMap";p[p.COUNT=2]="COUNT"})(a.NoiseTextureRenderMode||(a.NoiseTextureRenderMode={}));class k extends n.ShaderTechniqueConfiguration{constructor(){super(...arguments);this.mode=a.NoiseTextureRenderMode.Full}}b.__decorate([n.parameter({count:a.NoiseTextureRenderMode.COUNT})],k.prototype,"mode",void 0);a.NoiseTextureAtlasTechniqueConfiguration=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/environment/NoiseTextureAtlasTechnique":function(){define("require exports ../../../chunks/NoiseTextureAtlas.glsl ./NoiseTextureAtlasConfiguration ../webgl-engine/core/shaderTechnique/ReloadableShaderModule ../webgl-engine/core/shaderTechnique/ShaderTechnique ../../webgl/enums ../../webgl/renderState".split(" "),function(a,b,n,k,p,h,e,g){class d extends h.ShaderTechnique{constructor(f,c,l){super(f,c,new p.ReloadableShaderModule(n.NoiseTextureAtlas,()=>new Promise((w,x)=>a(["./NoiseTextureAtlas.glsl"],
w,x))),l)}initializePipeline(f){return g.makePipelineState({blending:f.mode===k.NoiseTextureRenderMode.Full?g.keepSourceValues:g.separateBlendingParams(e.BlendFactor.ZERO,e.BlendFactor.ONE,e.BlendFactor.ONE,e.BlendFactor.ZERO),depthTest:{func:e.CompareFunction.ALWAYS},colorWrite:g.defaultColorWrite})}}b.NoiseTextureAtlasTechnique=d;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/FramebufferObject":function(){define("exports ../../core/has ../../core/Logger ../../core/maybe ./BufferObject ./checkWebGLError ./enums ./GLObjectType ./Renderbuffer ./Texture".split(" "),
function(a,b,n,k,p,h,e,g,d,f){function c(u){return null!=u&&"type"in u&&u.type===g.GLObjectType.Texture}function l(u,t){const m=Math.max(u.width,u.height);return m>t?(n.getLogger("esri.views.webgl.FramebufferObject").warn(`Resizing FBO attachment size ${u.width}x${u.height} to device limit ${t}`),t/=m,u.width=Math.round(u.width*t),u.height=Math.round(u.height*t),!1):!0}function w(u){return u.descriptor.target===e.TextureType.TEXTURE_CUBE_MAP?e.TextureType.TEXTURE_CUBE_MAP_POSITIVE_X:e.TextureType.TEXTURE_2D}
class x{constructor(u,t,m=null){this._context=u;this._glName=null;this._colorAttachments=new Map;this._depthStencilTexture=this._depthStencilBuffer=null;this._initialized=!1;u.instanceCounter.increment(e.ResourceType.FramebufferObject,this);u=c(t)?t:new f.Texture(this._context,t);this._colorAttachments.set(e.ColorAttachment.COLOR_ATTACHMENT0,u);this._validateTextureDescriptor(u.descriptor);this._validateColorAttachmentPoint(e.ColorAttachment.COLOR_ATTACHMENT0);null!=m&&(c(m)||null!=m&&"pixelFormat"in
m?(this._depthStencilTexture=c(m)?m:new f.Texture(this._context,m),this._validateTextureDescriptor(this._depthStencilTexture.descriptor)):(this._depthStencilBuffer=m=null!=m&&"type"in m&&m.type===g.GLObjectType.RenderBuffer?m:new d.Renderbuffer(this._context,m),this._validateRenderBufferDescriptor(m.descriptor)))}dispose(){if(0!==this._colorAttachments.size||this._glName){var u=this._context.getBoundFramebufferObject();this._colorAttachments.forEach((t,m)=>this.detachColorTexture(m)?.dispose());this.detachDepthStencilBuffer()?.dispose();
this.detachDepthStencilTexture()?.dispose();this._glName&&(this._context.gl.deleteFramebuffer(this._glName),this._glName=null);this._context.bindFramebuffer(u);this._context.instanceCounter.decrement(e.ResourceType.FramebufferObject,this)}}get glName(){return this._glName}get colorTexture(){return this._colorAttachments.get(e.ColorAttachment.COLOR_ATTACHMENT0)}get depthStencil(){return this._depthStencilTexture||this._depthStencilBuffer}get depthStencilTexture(){return this._depthStencilTexture}get width(){return this._colorAttachments.get(e.ColorAttachment.COLOR_ATTACHMENT0)?.descriptor?.width??
0}get height(){return this._colorAttachments.get(e.ColorAttachment.COLOR_ATTACHMENT0)?.descriptor?.height??0}get usedMemory(){return[...this._colorAttachments].reduce((u,[,t])=>u+t.usedMemory,this.depthStencil?.usedMemory??0)}getColorTexture(u){return(u=this._colorAttachments.get(u))&&c(u)?u:null}get colorAttachments(){return[...this._colorAttachments.keys()]}attachColorTexture(u,t=e.ColorAttachment.COLOR_ATTACHMENT0){u&&(this._validateColorAttachmentPoint(t),this._validateTextureDescriptor(u.descriptor),
this.detachColorTexture(t)?.dispose(),this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(u.glName,t)),this._colorAttachments.set(t,u))}detachColorTexture(u=e.ColorAttachment.COLOR_ATTACHMENT0){const t=this._colorAttachments.get(u);if(t){if(this._initialized){const m=this._context.getBoundFramebufferObject();this._context.bindFramebuffer(this);this._framebufferTexture2D(null,u);this._context.bindFramebuffer(m)}this._colorAttachments.delete(u);return t}}setColorTextureTarget(u,
t=e.ColorAttachment.COLOR_ATTACHMENT0){const m=this._colorAttachments.get(t);m&&this._framebufferTexture2D(m.glName,t,u)}attachDepthStencil(u){if(u)switch(u.type){case g.GLObjectType.Texture:return this._attachDepthStencilTexture(u);case g.GLObjectType.RenderBuffer:return this._attachDepthStencilBuffer(u)}}_attachDepthStencilTexture(u){if(null!=u){var t=u.descriptor;t.pixelFormat!==e.PixelFormat.DEPTH_STENCIL&&t.pixelFormat!==e.PixelFormat.DEPTH24_STENCIL8&&console.error("Depth/Stencil texture must have a pixel type of DEPTH_STENCIL!");
t.dataType!==e.PixelType.UNSIGNED_INT_24_8&&console.error("Depth/Stencil texture must have data type of UNSIGNED_INT_24_8!");this._validateTextureDescriptor(t);this._disposeDepthStencilAttachments();this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(u.glName,e.DepthStencilAttachment));this._depthStencilTexture?.dispose();this._depthStencilTexture=u}}detachDepthStencilTexture(){const u=this._depthStencilTexture;if(u&&this._initialized){const t=this._context.getBoundFramebufferObject();
this._context.bindFramebuffer(this);this._framebufferTexture2D(null,e.DepthStencilAttachment);this._context.bindFramebuffer(t)}this._depthStencilTexture=null;return u}_attachDepthStencilBuffer(u){if(null!=u){var t=u.descriptor;this._validateRenderBufferDescriptor(t);this._disposeDepthStencilAttachments();if(this._initialized){this._context.bindFramebuffer(this);const m=this._context.gl;t=this._getGLAttachmentPoint(t);m.framebufferRenderbuffer(e.FramebufferTarget.FRAMEBUFFER,t,m.RENDERBUFFER,u.glName)}this._depthStencilBuffer=
u}}detachDepthStencilBuffer(){const u=this._depthStencilBuffer;if(u&&this._initialized){const t=this._context.getBoundFramebufferObject();this._context.bindFramebuffer(this);const m=this._context.gl,q=this._getGLAttachmentPoint(u.descriptor);m.framebufferRenderbuffer(e.FramebufferTarget.FRAMEBUFFER,q,m.RENDERBUFFER,null);this._context.bindFramebuffer(t)}this._depthStencilBuffer=null;return u}copyToTexture(u,t,m,q,r,v,y){(0>u||0>t||0>r||0>v)&&console.error("Offsets cannot be negative!");(0>=m||0>=
q)&&console.error("Copy width and height must be greater than zero!");var B=y.descriptor;y.descriptor.target!==e.TextureType.TEXTURE_2D&&console.error("Texture target must be TEXTURE_2D!");(null==B?.width||null==B?.height||u+m>this.width||t+q>this.height||r+m>B.width||v+q>B.height)&&console.error("Bad dimensions, the current input values will attempt to read or copy out of bounds!");B=this._context;y=B.bindTexture(y,f.Texture.TEXTURE_UNIT_FOR_UPDATES);B.setActiveTexture(f.Texture.TEXTURE_UNIT_FOR_UPDATES);
B.bindFramebuffer(this);B.gl.copyTexSubImage2D(e.TextureType.TEXTURE_2D,0,r,v,u,t,m,q);B.bindTexture(y,f.Texture.TEXTURE_UNIT_FOR_UPDATES)}readPixels(u,t,m,q,r,v,y){(0>=m||0>=q)&&console.error("Copy width and height must be greater than zero!");y||console.error("Target memory is not initialized!");this._context.bindFramebuffer(this);this._context.gl.readPixels(u,t,m,q,r,v,y)}async readPixelsAsync(u,t,m,q,r,v,y){const {gl:B}=this._context,z=p.BufferObject.createPixelPack(this._context,e.Usage.STREAM_READ,
y.byteLength);this._context.bindBuffer(z);const A=this._context.getBoundFramebufferObject();this._context.bindFramebuffer(this);B.readPixels(u,t,m,q,r,v,0);this._context.unbindBuffer(e.BufferType.PIXEL_PACK_BUFFER);this._context.bindFramebuffer(A);await z.getSubDataAsync(y);z.dispose()}resize(u,t){if(this.width!==u||this.height!==t){var m={width:u,height:t};l(m,this._context.parameters.maxTextureSize);this._colorAttachments.forEach(q=>q.resize(m.width,m.height));this._depthStencilTexture?.resize(m.width,
m.height);this._initialized&&(l(m,this._context.parameters.maxRenderbufferSize),this._depthStencilBuffer?.resize(m.width,m.height),this._context.getBoundFramebufferObject()===this&&this._context.bindFramebuffer(null),this._initialized=!1)}}initializeAndBind(u=e.FramebufferTarget.FRAMEBUFFER){const t=this._context.gl;if(this._initialized)t.bindFramebuffer(u,this.glName);else{this._glName&&t.deleteFramebuffer(this._glName);var m=t.createFramebuffer();t.bindFramebuffer(u,m);this._colorAttachments.forEach((q,
r)=>this._framebufferTexture2D(q.glName,r,w(q),u));if(this._depthStencilBuffer){const q=this._getGLAttachmentPoint(this._depthStencilBuffer.descriptor);t.framebufferRenderbuffer(u,q,t.RENDERBUFFER,this._depthStencilBuffer.glName)}else this._depthStencilTexture&&this._framebufferTexture2D(this._depthStencilTexture.glName,t.DEPTH_STENCIL_ATTACHMENT,w(this._depthStencilTexture),u);h.webglDebugEnabled()&&t.checkFramebufferStatus(u)!==t.FRAMEBUFFER_COMPLETE&&console.error("Framebuffer is incomplete!");
this._glName=m;this._initialized=!0}}_framebufferTexture2D(u,t=e.ColorAttachment.COLOR_ATTACHMENT0,m=e.TextureType.TEXTURE_2D,q=e.FramebufferTarget.FRAMEBUFFER,r=0){this._context.gl.framebufferTexture2D(q,t,m,u,r)}_disposeDepthStencilAttachments(){const u=this._context.gl;if(this._depthStencilBuffer){if(this._initialized){this._context.bindFramebuffer(this);const t=this._getGLAttachmentPoint(this._depthStencilBuffer.descriptor);u.framebufferRenderbuffer(e.FramebufferTarget.FRAMEBUFFER,t,u.RENDERBUFFER,
null)}this._depthStencilBuffer=k.disposeMaybe(this._depthStencilBuffer)}this._depthStencilTexture&&(this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,u.DEPTH_STENCIL_ATTACHMENT)),this._depthStencilTexture=k.disposeMaybe(this._depthStencilTexture))}_validateTextureDescriptor(u){u.target!==e.TextureType.TEXTURE_2D&&u.target!==e.TextureType.TEXTURE_CUBE_MAP&&console.error("Texture type must be TEXTURE_2D or TEXTURE_CUBE_MAP!");l(u,this._context.parameters.maxTextureSize);
this._validateBufferDimensions(u)}_validateRenderBufferDescriptor(u){l(u,this._context.parameters.maxRenderbufferSize);this._validateBufferDimensions(u)}_validateBufferDimensions(u){0>=u.width&&(u.width=this.width);0>=u.height&&(u.height=this.height);0<this.width&&0<this.height&&(this.width!==u.width||this.height!==u.height)&&console.error("Attachment size must match framebuffer size!")}_getGLAttachmentPoint(u){switch(u.internalFormat){case e.RenderbufferFormat.DEPTH_COMPONENT16:case e.RenderbufferFormat.DEPTH_COMPONENT24:case e.RenderbufferFormat.DEPTH_COMPONENT32F:return this._context.gl.DEPTH_ATTACHMENT;
case e.RenderbufferFormat.DEPTH24_STENCIL8:case e.RenderbufferFormat.DEPTH32F_STENCIL8:case e.RenderbufferFormat.DEPTH_STENCIL:return this._context.gl.DEPTH_STENCIL_ATTACHMENT;case e.RenderbufferFormat.STENCIL_INDEX8:return this._context.gl.STENCIL_ATTACHMENT}}_validateColorAttachmentPoint(u){if(-1===x._MAX_COLOR_ATTACHMENTS){const {gl:t}=this._context;x._MAX_COLOR_ATTACHMENTS=t.getParameter(t.MAX_COLOR_ATTACHMENTS)}u-=e.ColorAttachment.COLOR_ATTACHMENT0;u+1>x._MAX_COLOR_ATTACHMENTS&&n.getLogger("esri.views.webgl.FrameBufferObject").error("esri.FrameBufferObject",
`illegal attachment point for color attachment: ${u+1}. Implementation supports up to ${x._MAX_COLOR_ATTACHMENTS} color attachments`)}}x._MAX_COLOR_ATTACHMENTS=-1;a.FramebufferObject=x;a.ensureAttachmentMaxSize=l;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/BufferObject":function(){define("exports ../../core/arrayUtils ../../core/has ../../core/Logger ../../core/typedArrayUtil ./checkWebGLError ./enums".split(" "),function(a,b,n,k,p,h,e){class g{static createIndex(d,
f,c){return new g(d,e.BufferType.ELEMENT_ARRAY_BUFFER,f,c)}static createVertex(d,f,c){return new g(d,e.BufferType.ARRAY_BUFFER,f,c)}static createUniform(d,f,c){return new g(d,e.BufferType.UNIFORM_BUFFER,f,c)}static createPixelPack(d,f=e.Usage.STREAM_READ,c){d=new g(d,e.BufferType.PIXEL_PACK_BUFFER,f);c&&d.setSize(c);return d}static createPixelUnpack(d,f=e.Usage.STREAM_DRAW,c){return new g(d,e.BufferType.PIXEL_UNPACK_BUFFER,f,c)}static createTransformFeedback(d,f=e.Usage.STATIC_DRAW,c){d=new g(d,e.BufferType.TRANSFORM_FEEDBACK_BUFFER,
f);d.setSize(c);return d}constructor(d,f,c,l){this._context=d;this.bufferType=f;this.usage=c;this._glName=null;this._size=-1;this._indexType=void 0;d.instanceCounter.increment(e.ResourceType.BufferObject,this);this._glName=this._context.gl.createBuffer();h.checkWebGLError(this._context.gl);l&&this.setData(l)}get glName(){return this._glName}get size(){return this._size}get indexType(){return this._indexType}get usedMemory(){if(this.bufferType===e.BufferType.ELEMENT_ARRAY_BUFFER){if(this._indexType===
e.DataType.UNSIGNED_INT)return 4*this._size;if(this._indexType===e.DataType.UNSIGNED_SHORT)return 2*this._size}return this._size}get _isVAOAware(){return this.bufferType===e.BufferType.ELEMENT_ARRAY_BUFFER||this.bufferType===e.BufferType.ARRAY_BUFFER}dispose(){this._context?.gl?(this._glName&&(this._context.gl.deleteBuffer(this._glName),this._glName=null),this._context.instanceCounter.decrement(e.ResourceType.BufferObject,this),this._context=null):this._glName&&k.getLogger("esri.views.webgl.BufferObject").warn("Leaked WebGL buffer object")}setSize(d,
f=null){if(this.bufferType===e.BufferType.ELEMENT_ARRAY_BUFFER&&null!=f)switch(this._indexType=f,f){case e.DataType.UNSIGNED_SHORT:d*=2;break;case e.DataType.UNSIGNED_INT:d*=4}this._setBufferData(d)}setData(d){if(d){var f=d.byteLength;this.bufferType===e.BufferType.ELEMENT_ARRAY_BUFFER&&(p.isUint8Array(d)?this._indexType=e.DataType.UNSIGNED_BYTE:p.isUint16Array(d)?(f/=2,this._indexType=e.DataType.UNSIGNED_SHORT):p.isUint32Array(d)&&(f/=4,this._indexType=e.DataType.UNSIGNED_INT));this._setBufferData(f,
d)}}_setBufferData(d,f=null){this._size=d;const c=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null);this._context.bindBuffer(this);const l=this._context.gl;null!=f?l.bufferData(this.bufferType,f,this.usage):l.bufferData(this.bufferType,d,this.usage);h.checkWebGLError(l);this._isVAOAware&&this._context.bindVAO(c)}setSubData(d,f,c,l){if(d){var w=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null);this._context.bindBuffer(this);var {gl:x}=this._context;x.bufferSubData(this.bufferType,
f*d.BYTES_PER_ELEMENT,d,c,l-c);h.checkWebGLError(x);this._isVAOAware&&this._context.bindVAO(w)}}getSubData(d,f=0,c,l){if(!(0>c||0>l)){var w=b.isArrayLike(d)?d.BYTES_PER_ELEMENT:1;w*((c??0)+(l??0))>d.byteLength||(f+w*(l??0)>this.usedMemory&&k.getLogger("esri.views.webgl.BufferObject").warn("Potential problem getting subdata: requested data exceeds buffer size!"),w=this._context.gl,this.bufferType===e.BufferType.TRANSFORM_FEEDBACK_BUFFER?(this._context.bindBuffer(this,e.BufferType.TRANSFORM_FEEDBACK_BUFFER),
w.getBufferSubData(e.BufferType.TRANSFORM_FEEDBACK_BUFFER,f,d,c,l),this._context.unbindBuffer(e.BufferType.TRANSFORM_FEEDBACK_BUFFER)):(this._context.bindBuffer(this,e.BufferType.COPY_READ_BUFFER),w.getBufferSubData(e.BufferType.COPY_READ_BUFFER,f,d,c,l),this._context.unbindBuffer(e.BufferType.COPY_READ_BUFFER)))}}async getSubDataAsync(d,f=0,c,l){await this._context.clientWaitAsync();this.getSubData(d,f,c,l)}}a.BufferObject=g;a.tracer=null;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/webgl/GLObjectType":function(){define(["exports"],function(a){a.GLObjectType=void 0;var b=a.GLObjectType||(a.GLObjectType={});b[b.Texture=0]="Texture";b[b.RenderBuffer=1]="RenderBuffer";Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/Renderbuffer":function(){define(["exports","./enums","./GLObjectType","./RenderbufferDescriptor"],function(a,b,n,k){class p{constructor(h,e){this._context=h;this._descriptor=e;this.type=n.GLObjectType.RenderBuffer;this._context.instanceCounter.increment(b.ResourceType.Renderbuffer,
this);h=this._context.gl;this.glName=h.createRenderbuffer();this._context.bindRenderbuffer(this);const {width:g,height:d,internalFormat:f,multisampled:c}=e;c?h.renderbufferStorageMultisample(h.RENDERBUFFER,this.samples,f,g,d):h.renderbufferStorage(h.RENDERBUFFER,f,g,d);this._context.bindRenderbuffer(null)}get descriptor(){return this._descriptor}get samples(){const h=this._descriptor.samples,e=this._context.parameters.maxSamples;return h?Math.min(h,e):e}get usedMemory(){return k.estimateMemory(this._descriptor)}resize(h,
e){const g=this._descriptor;if(g.width!==h||g.height!==e)g.width=h,g.height=e,h=this._context.gl,this._context.bindRenderbuffer(this),g.multisampled?h.renderbufferStorageMultisample(h.RENDERBUFFER,this.samples,g.internalFormat,g.width,g.height):h.renderbufferStorage(h.RENDERBUFFER,g.internalFormat,g.width,g.height),this._context.bindRenderbuffer(null)}dispose(){this._context&&(this._context.gl.deleteRenderbuffer(this.glName),this._context.instanceCounter.decrement(b.ResourceType.Renderbuffer,this),
this._context=null)}}a.Renderbuffer=p;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/RenderbufferDescriptor":function(){define(["exports","./Util"],function(a,b){class n{constructor(k,p,h=p){this.internalFormat=k;this.width=p;this.height=h;this.multisampled=!1;this.samples=1}}a.RenderbufferDescriptor=n;a.estimateMemory=function(k){return 0>=k.width||0>=k.height||null==k.internalFormat?0:k.width*k.height*b.getBytesPerElementFormat(k.internalFormat)};Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/Util":function(){define(["exports","../../core/has","./checkWebGLError","./enums","./getDataTypeBytes"],function(a,b,n,k,p){function h(g){g=g.gl;switch(g.getError()){case g.NO_ERROR:return null;case g.INVALID_ENUM:return"An unacceptable value has been specified for an enumerated argument";case g.INVALID_VALUE:return"An unacceptable value has been specified for an argument";case g.INVALID_OPERATION:return"The specified command is not allowed for the current state";
case g.INVALID_FRAMEBUFFER_OPERATION:return"The currently bound framebuffer is not framebuffer complete";case g.OUT_OF_MEMORY:return"Not enough memory is left to execute the command";case g.CONTEXT_LOST_WEBGL:return"WebGL context is lost"}return"Unknown error"}function e(g){return g[0].stride}a.bindVertexBufferLayout=function(g,d,f,c,l=0){const w=g.gl;g.bindBuffer(f);for(const u of c)if(c=d.get(u.name),null==c)console.warn(`There is no location for vertex attribute '${u.name}' defined.`);else{f=l*
u.stride;if(4>=u.count)w.vertexAttribPointer(c,u.count,u.type,u.normalized,u.stride,u.offset+f),w.enableVertexAttribArray(c),0<u.divisor&&g.gl.vertexAttribDivisor(c,u.divisor);else if(9===u.count)for(var x=0;3>x;x++)w.vertexAttribPointer(c+x,3,u.type,u.normalized,u.stride,u.offset+12*x+f),w.enableVertexAttribArray(c+x),0<u.divisor&&g.gl.vertexAttribDivisor(c+x,u.divisor);else if(16===u.count)for(x=0;4>x;x++)w.vertexAttribPointer(c+x,4,u.type,u.normalized,u.stride,u.offset+16*x+f),w.enableVertexAttribArray(c+
x),0<u.divisor&&g.gl?.vertexAttribDivisor(c+x,u.divisor);else console.error("Unsupported vertex attribute element count: "+u.count);if(n.webglDebugEnabled()){c=h(g);x=p.getDataTypeBytes(u.type);const t=u.offset;x=Math.round(x/t)!==x/t?`. Offset not a multiple of stride. DataType requires ${x} bytes, but descriptor has an offset of ${t}`:"";c&&console.error(`Unable to bind vertex attribute "${u.name}" with baseInstanceOffset ${f}${x}:`,c,u)}}};a.getBytesPerElementFormat=function(g){switch(g){case k.PixelFormat.ALPHA:case k.PixelFormat.LUMINANCE:case k.PixelFormat.RED:case k.PixelFormat.RED_INTEGER:case k.SizedPixelFormat.R8:case k.SizedPixelFormat.R8I:case k.SizedPixelFormat.R8UI:case k.SizedPixelFormat.R8_SNORM:case k.RenderbufferFormat.STENCIL_INDEX8:return 1;
case k.PixelFormat.LUMINANCE_ALPHA:case k.PixelFormat.RG:case k.PixelFormat.RG_INTEGER:case k.SizedPixelFormat.RGBA4:case k.SizedPixelFormat.R16F:case k.SizedPixelFormat.R16I:case k.SizedPixelFormat.R16UI:case k.SizedPixelFormat.RG8:case k.SizedPixelFormat.RG8I:case k.SizedPixelFormat.RG8UI:case k.SizedPixelFormat.RG8_SNORM:case k.SizedPixelFormat.RGB565:case k.SizedPixelFormat.RGB5_A1:case k.RenderbufferFormat.DEPTH_COMPONENT16:return 2;case k.PixelFormat.DEPTH_COMPONENT:case k.PixelFormat.RGB:case k.PixelFormat.RGB_INTEGER:case k.SizedPixelFormat.RGB8:case k.SizedPixelFormat.RGB8I:case k.SizedPixelFormat.RGB8UI:case k.SizedPixelFormat.RGB8_SNORM:case k.SizedPixelFormat.SRGB8:case k.RenderbufferFormat.DEPTH_COMPONENT24:return 3;
case k.PixelFormat.DEPTH_STENCIL:case k.PixelFormat.DEPTH24_STENCIL8:case k.PixelFormat.RGBA:case k.PixelFormat.RGBA_INTEGER:case k.SizedPixelFormat.RGBA8:case k.SizedPixelFormat.R32F:case k.SizedPixelFormat.R11F_G11F_B10F:case k.SizedPixelFormat.RG16F:case k.SizedPixelFormat.R32I:case k.SizedPixelFormat.R32UI:case k.SizedPixelFormat.RG16I:case k.SizedPixelFormat.RG16UI:case k.SizedPixelFormat.RGBA8I:case k.SizedPixelFormat.RGBA8UI:case k.SizedPixelFormat.RGBA8_SNORM:case k.SizedPixelFormat.SRGB8_ALPHA8:case k.SizedPixelFormat.RGB9_E5:case k.SizedPixelFormat.RGB10_A2UI:case k.SizedPixelFormat.RGB10_A2:case k.RenderbufferFormat.DEPTH_STENCIL:case k.RenderbufferFormat.DEPTH_COMPONENT32F:case k.RenderbufferFormat.DEPTH24_STENCIL8:return 4;
case k.RenderbufferFormat.DEPTH32F_STENCIL8:return 5;case k.SizedPixelFormat.RGB16F:case k.SizedPixelFormat.RGB16I:case k.SizedPixelFormat.RGB16UI:return 6;case k.SizedPixelFormat.RG32F:case k.SizedPixelFormat.RG32I:case k.SizedPixelFormat.RG32UI:case k.SizedPixelFormat.RGBA16F:case k.SizedPixelFormat.RGBA16I:case k.SizedPixelFormat.RGBA16UI:return 8;case k.SizedPixelFormat.RGB32F:case k.SizedPixelFormat.RGB32I:case k.SizedPixelFormat.RGB32UI:return 12;case k.SizedPixelFormat.RGBA32F:case k.SizedPixelFormat.RGBA32I:case k.SizedPixelFormat.RGBA32UI:return 16;
case k.CompressedTextureFormat.COMPRESSED_RGB_S3TC_DXT1_EXT:case k.CompressedTextureFormat.COMPRESSED_RGBA_S3TC_DXT1_EXT:return.5;case k.CompressedTextureFormat.COMPRESSED_RGBA_S3TC_DXT3_EXT:case k.CompressedTextureFormat.COMPRESSED_RGBA_S3TC_DXT5_EXT:return 1;case k.CompressedTextureFormat.COMPRESSED_R11_EAC:case k.CompressedTextureFormat.COMPRESSED_SIGNED_R11_EAC:case k.CompressedTextureFormat.COMPRESSED_RGB8_ETC2:case k.CompressedTextureFormat.COMPRESSED_SRGB8_ETC2:case k.CompressedTextureFormat.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:case k.CompressedTextureFormat.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:return.5;
case k.CompressedTextureFormat.COMPRESSED_RG11_EAC:case k.CompressedTextureFormat.COMPRESSED_SIGNED_RG11_EAC:case k.CompressedTextureFormat.COMPRESSED_RGBA8_ETC2_EAC:case k.CompressedTextureFormat.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:return 1}return 0};a.getErrorString=h;a.getStride=e;a.unbindVertexBufferLayout=function(g,d,f,c){const l=g.gl;g.bindBuffer(f);for(const w of c)if(f=d.get(w.name),4>=w.count)l.disableVertexAttribArray(f),w.divisor&&0<w.divisor&&g.gl?.vertexAttribDivisor(f,0);else if(9===w.count)for(c=
0;3>c;c++)l.disableVertexAttribArray(f+c),w.divisor&&0<w.divisor&&g.gl?.vertexAttribDivisor(f+c,0);else if(16===w.count)for(c=0;4>c;c++)l.disableVertexAttribArray(f+c),w.divisor&&0<w.divisor&&g.gl?.vertexAttribDivisor(f+c,0);else console.error("Unsupported vertex attribute element count: "+w.count);g.unbindBuffer(k.BufferType.ARRAY_BUFFER)};a.vertexCount=function(g,d){return(g.vertexBuffers.get(d)?.usedMemory??0)/e(g.layout.get(d))};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/webgl/getDataTypeBytes":function(){define(["exports","./enums"],function(a,b){a.getDataTypeBytes=function(n){switch(n){case b.DataType.BYTE:case b.DataType.UNSIGNED_BYTE:return 1;case b.DataType.SHORT:case b.DataType.UNSIGNED_SHORT:case b.DataType.HALF_FLOAT:return 2;case b.DataType.FLOAT:case b.DataType.INT:case b.DataType.UNSIGNED_INT:return 4}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/Texture":function(){define("exports ../../core/Error ../../core/has ./checkWebGLError ./enums ./GLObjectType ./TextureDescriptor ./ValidatedTextureDescriptor".split(" "),
function(a,b,n,k,p,h,e,g){function d(m){(null!=m.width&&0>m.width||null!=m.height&&0>m.height||null!=m.depth&&0>m.depth)&&console.error("Negative dimension parameters are not allowed!")}function f(m,q){let r=q.samplingMode,v=q.samplingMode;if(r===p.TextureSamplingMode.LINEAR_MIPMAP_NEAREST||r===p.TextureSamplingMode.LINEAR_MIPMAP_LINEAR)r=p.TextureSamplingMode.LINEAR,q.hasMipmap||(v=p.TextureSamplingMode.LINEAR);else if(r===p.TextureSamplingMode.NEAREST_MIPMAP_NEAREST||r===p.TextureSamplingMode.NEAREST_MIPMAP_LINEAR)r=
p.TextureSamplingMode.NEAREST,q.hasMipmap||(v=p.TextureSamplingMode.NEAREST);m.texParameteri(q.target,m.TEXTURE_MAG_FILTER,r);m.texParameteri(q.target,m.TEXTURE_MIN_FILTER,v)}function c(m,q){"number"===typeof q.wrapMode?(m.texParameteri(q.target,m.TEXTURE_WRAP_S,q.wrapMode),m.texParameteri(q.target,m.TEXTURE_WRAP_T,q.wrapMode)):(m.texParameteri(q.target,m.TEXTURE_WRAP_S,q.wrapMode.s),m.texParameteri(q.target,m.TEXTURE_WRAP_T,q.wrapMode.t))}function l(m,q){const r=m.capabilities.textureFilterAnisotropic;
r&&m.gl.texParameterf(q.target,r.TEXTURE_MAX_ANISOTROPY,q.maxAnisotropy??1)}function w(m){return null!=m&&"type"in m&&"compressed"===m.type}function x(m){return null!=m&&!w(m)&&!(null!=m&&"byteLength"in m)}function u(m){return m===p.TextureType.TEXTURE_3D||m===p.TextureType.TEXTURE_2D_ARRAY}function t(m,q,r,v=1){q=Math.max(q,r);m===p.TextureType.TEXTURE_3D&&(q=Math.max(q,v));return Math.round(Math.log(q)/Math.LN2)+1}n=class m{constructor(q,r=null,v=null){this.type=h.GLObjectType.Texture;this._glName=
null;this._wasImmutablyAllocated=this._wrapModeDirty=this._samplingModeDirty=!1;if("context"in q)this._descriptor=q,v=r;else{q=g.ValidatedTextureDescriptor.validate(q,r);if(!q)throw new b("Texture descriptor invalid");this._descriptor=q}this._descriptor.target===p.TextureType.TEXTURE_CUBE_MAP?this._setDataCubeMap(v):this.setData(v)}get glName(){return this._glName}get descriptor(){return this._descriptor}get usedMemory(){return e.estimateMemory(this._descriptor)}get isDirty(){return this._samplingModeDirty||
this._wrapModeDirty}dispose(){this._glName&&this._descriptor.context.instanceCounter.decrement(p.ResourceType.Texture,this);this._descriptor.context.gl&&this._glName&&(this._descriptor.context.unbindTexture(this),this._descriptor.context.gl.deleteTexture(this._glName),this._glName=null)}release(){this.dispose()}resize(q,r){const v=this._descriptor;if(v.width!==q||v.height!==r){if(this._wasImmutablyAllocated)throw new b("Immutable textures can't be resized!");v.width=q;v.height=r;this._descriptor.target===
p.TextureType.TEXTURE_CUBE_MAP?this._setDataCubeMap(null):this.setData(null)}}_setDataCubeMap(q=null){for(let r=p.TextureType.TEXTURE_CUBE_MAP_POSITIVE_X;r<=p.TextureType.TEXTURE_CUBE_MAP_NEGATIVE_Z;r++)this._setData(q,r)}setData(q){this._setData(q)}_setData(q,r){const v=this._descriptor.context?.gl;if(v){k.checkWebGLError(v);this._glName||(this._glName=v.createTexture())&&this._descriptor.context.instanceCounter.increment(p.ResourceType.Texture,this);var y=this._descriptor,B=r??y.target,z=u(B);r=
this._descriptor.context.bindTexture(this,m.TEXTURE_UNIT_FOR_UPDATES);this._descriptor.context.setActiveTexture(m.TEXTURE_UNIT_FOR_UPDATES);d(y);this._configurePixelStorage();k.checkWebGLError(v);var A=this._deriveInternalFormat();if(x(q)){let C="width"in q?q.width:q.codedWidth,H="height"in q?q.height:q.codedHeight;q instanceof HTMLVideoElement&&(C=q.videoWidth,H=q.videoHeight);y.isImmutable&&!this._wasImmutablyAllocated&&this._texStorage(B,A,y.hasMipmap,C,H,1);this._texImage(B,0,A,C,H,1,q);k.checkWebGLError(v);
y.hasMipmap&&(this.generateMipmap(),k.checkWebGLError(v));y.width||(y.width=C);y.height||(y.height=H);z&&!y.depth&&(y.depth=1)}else{const {width:C,height:H,depth:E}=y;if(null==C||null==H)throw new b("Width and height must be specified!");if(z&&null==E)throw new b("Depth must be specified!");y.isImmutable&&!this._wasImmutablyAllocated&&this._texStorage(B,A,y.hasMipmap,C,H,E);if(w(q)){const F=q.levels;q=t(B,C,H,E);q=Math.min(q-1,F.length-1);v.texParameteri(y.target,this._descriptor.context.gl.TEXTURE_MAX_LEVEL,
q);if(!(A in p.CompressedTextureFormat))throw new b("Attempting to use compressed data with an uncompressed format!");this._forEachMipmapLevel((G,D,I,J)=>{this._compressedTexImage(B,G,A,D,I,J,F[Math.min(G,F.length-1)])},q)}else this._texImage(B,0,A,C,H,E,q),k.checkWebGLError(v),y.hasMipmap&&this.generateMipmap()}f(v,this._descriptor);c(v,this._descriptor);l(this._descriptor.context,this._descriptor);k.checkWebGLError(v);this._descriptor.context.bindTexture(r,m.TEXTURE_UNIT_FOR_UPDATES)}}updateData(q,
r,v,y,B,z,A=0){z||console.error("An attempt to use uninitialized data!");this._glName||console.error("An attempt to update uninitialized texture!");var C=this._descriptor;const H=this._deriveInternalFormat(),{context:E,pixelFormat:F,dataType:G,target:D,isImmutable:I}=C;if(I&&!this._wasImmutablyAllocated)throw new b("Cannot update immutable texture before allocation!");const J=E.bindTexture(this,m.TEXTURE_UNIT_FOR_UPDATES,!0);(0>r||0>v||r+y>C.width||v+B>C.height)&&console.error("An attempt to update out of bounds of the texture!");
this._configurePixelStorage();({gl:C}=E);A&&C.pixelStorei(C.UNPACK_SKIP_ROWS,A);x(z)?C.texSubImage2D(D,q,r,v,y,B,F,G,z):w(z)?C.compressedTexSubImage2D(D,q,r,v,y,B,H,z.levels[q]):C.texSubImage2D(D,q,r,v,y,B,F,G,z);A&&C.pixelStorei(C.UNPACK_SKIP_ROWS,0);E.bindTexture(J,m.TEXTURE_UNIT_FOR_UPDATES)}updateData3D(q,r,v,y,B,z,A,C){C||console.error("An attempt to use uninitialized data!");this._glName||console.error("An attempt to update uninitialized texture!");var H=this._descriptor;const E=this._deriveInternalFormat(),
{context:F,pixelFormat:G,dataType:D,isImmutable:I,target:J}=H;if(I&&!this._wasImmutablyAllocated)throw new b("Cannot update immutable texture before allocation!");u(J)||console.warn("Attempting to set 3D texture data on a non-3D texture");const N=F.bindTexture(this,m.TEXTURE_UNIT_FOR_UPDATES);F.setActiveTexture(m.TEXTURE_UNIT_FOR_UPDATES);(0>r||0>v||0>y||r+B>H.width||v+z>H.height||y+A>H.depth)&&console.error("An attempt to update out of bounds of the texture!");this._configurePixelStorage();({gl:H}=
F);w(C)?(C=C.levels[q],H.compressedTexSubImage3D(J,q,r,v,y,B,z,A,E,C)):H.texSubImage3D(J,q,r,v,y,B,z,A,G,D,C);F.bindTexture(N,m.TEXTURE_UNIT_FOR_UPDATES)}generateMipmap(){const q=this._descriptor;if(!q.hasMipmap){if(this._wasImmutablyAllocated)throw new b("Cannot add mipmaps to immutable texture after allocation");this._samplingModeDirty=q.hasMipmap=!0;d(q)}q.samplingMode===p.TextureSamplingMode.LINEAR?(this._samplingModeDirty=!0,q.samplingMode=p.TextureSamplingMode.LINEAR_MIPMAP_NEAREST):q.samplingMode===
p.TextureSamplingMode.NEAREST&&(this._samplingModeDirty=!0,q.samplingMode=p.TextureSamplingMode.NEAREST_MIPMAP_NEAREST);const r=this._descriptor.context.bindTexture(this,m.TEXTURE_UNIT_FOR_UPDATES);this._descriptor.context.setActiveTexture(m.TEXTURE_UNIT_FOR_UPDATES);this._descriptor.context.gl.generateMipmap(q.target);this._descriptor.context.bindTexture(r,m.TEXTURE_UNIT_FOR_UPDATES)}clearMipmap(){const q=this._descriptor;if(q.hasMipmap){if(this._wasImmutablyAllocated)throw new b("Cannot delete mipmaps to immutable texture after allocation");
q.hasMipmap=!1;this._samplingModeDirty=!0;d(q)}q.samplingMode===p.TextureSamplingMode.LINEAR_MIPMAP_NEAREST?(this._samplingModeDirty=!0,q.samplingMode=p.TextureSamplingMode.LINEAR):q.samplingMode===p.TextureSamplingMode.NEAREST_MIPMAP_NEAREST&&(this._samplingModeDirty=!0,q.samplingMode=p.TextureSamplingMode.NEAREST)}setSamplingMode(q){q!==this._descriptor.samplingMode&&(this._descriptor.samplingMode=q,this._samplingModeDirty=!0)}setWrapMode(q){q!==this._descriptor.wrapMode&&(this._descriptor.wrapMode=
q,d(this._descriptor),this._wrapModeDirty=!0)}applyChanges(){const q=this._descriptor,r=q.context.gl;this._samplingModeDirty&&(f(r,q),this._samplingModeDirty=!1);this._wrapModeDirty&&(c(r,q),this._wrapModeDirty=!1)}_deriveInternalFormat(){if(null!=this._descriptor.internalFormat)return this._descriptor.internalFormat===p.PixelFormat.DEPTH_STENCIL&&(this._descriptor.internalFormat=p.PixelFormat.DEPTH24_STENCIL8),this._descriptor.internalFormat;switch(this._descriptor.dataType){case p.PixelType.FLOAT:switch(this._descriptor.pixelFormat){case p.PixelFormat.RGBA:return this._descriptor.internalFormat=
p.SizedPixelFormat.RGBA32F;case p.PixelFormat.RGB:return this._descriptor.internalFormat=p.SizedPixelFormat.RGB32F;default:throw new b("Unable to derive format");}case p.PixelType.UNSIGNED_BYTE:switch(this._descriptor.pixelFormat){case p.PixelFormat.RGBA:return this._descriptor.internalFormat=p.SizedPixelFormat.RGBA8;case p.PixelFormat.RGB:return this._descriptor.internalFormat=p.SizedPixelFormat.RGB8}}return this._descriptor.internalFormat=this._descriptor.pixelFormat===p.PixelFormat.DEPTH_STENCIL?
p.PixelFormat.DEPTH24_STENCIL8:this._descriptor.pixelFormat}_configurePixelStorage(){const q=this._descriptor.context.gl,{unpackAlignment:r,flipped:v,preMultiplyAlpha:y}=this._descriptor;q.pixelStorei(q.UNPACK_ALIGNMENT,r);q.pixelStorei(q.UNPACK_FLIP_Y_WEBGL,v?1:0);q.pixelStorei(q.UNPACK_PREMULTIPLY_ALPHA_WEBGL,y?1:0)}_texStorage(q,r,v,y,B,z){const {gl:A}=this._descriptor.context;if(!(r in p.SizedPixelFormat))throw new b("Immutable textures must have a sized internal format");if(this._descriptor.isImmutable){v=
v?t(q,y,B,z):1;if(u(q)){if(null==z)throw new b("Missing depth dimension for 3D texture upload");A.texStorage3D(q,v,r,y,B,z)}else A.texStorage2D(q,v,r,y,B);this._wasImmutablyAllocated=!0}}_texImage(q,r,v,y,B,z,A){const C=this._descriptor.context.gl,H=u(q),{isImmutable:E,pixelFormat:F,dataType:G}=this._descriptor;if(E){if(null!=A)if(H){if(null==z)throw new b("Missing depth dimension for 3D texture upload");C.texSubImage3D(q,r,0,0,0,y,B,z,F,G,A)}else C.texSubImage2D(q,r,0,0,y,B,F,G,A)}else if(H){if(null==
z)throw new b("Missing depth dimension for 3D texture upload");C.texImage3D(q,r,v,y,B,z,0,F,G,A)}else C.texImage2D(q,r,v,y,B,0,F,G,A)}_compressedTexImage(q,r,v,y,B,z,A){const C=this._descriptor.context.gl,H=u(q);if(this._descriptor.isImmutable){if(null!=A)if(H){if(null==z)throw new b("Missing depth dimension for 3D texture upload");C.compressedTexSubImage3D(q,r,0,0,0,y,B,z,v,A)}else C.compressedTexSubImage2D(q,r,0,0,y,B,v,A)}else if(H){if(null==z)throw new b("Missing depth dimension for 3D texture upload");
C.compressedTexImage3D(q,r,v,y,B,z,0,A)}else C.compressedTexImage2D(q,r,v,y,B,0,A)}_forEachMipmapLevel(q,r=Infinity){let {width:v,height:y,depth:B,hasMipmap:z,target:A}=this._descriptor;const C=A===p.TextureType.TEXTURE_3D;if(null==v||null==y||C&&null==B)throw new b("Missing texture dimensions for mipmap calculation");for(let H=0;;++H){q(H,v,y,B);if(!z||1===v&&1===y&&(!C||1===B)||H>=r)break;v=Math.max(1,v>>1);y=Math.max(1,y>>1);C&&(B=Math.max(1,B>>1))}}};n.TEXTURE_UNIT_FOR_UPDATES=0;a.Texture=n;a.tracer=
null;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/TextureDescriptor":function(){define(["exports","./enums","./Util"],function(a,b,n){class k{constructor(p=0,h=p){this.width=p;this.height=h;this.target=b.TextureType.TEXTURE_2D;this.pixelFormat=b.PixelFormat.RGBA;this.dataType=b.PixelType.UNSIGNED_BYTE;this.samplingMode=b.TextureSamplingMode.LINEAR;this.wrapMode=b.TextureWrapMode.REPEAT;this.maxAnisotropy=1;this.isOpaque=this.hasMipmap=this.flipped=!1;this.unpackAlignment=
4;this.preMultiplyAlpha=!1;this.depth=1;this.isImmutable=!1}}a.TextureDescriptor=k;a.estimateMemory=function(p){return 0>=p.width||0>=p.height?0:Math.round(p.width*p.height*(p.hasMipmap?4/3:1)*(null==p.internalFormat?4:n.getBytesPerElementFormat(p.internalFormat))*(p.target===b.TextureType.TEXTURE_CUBE_MAP?6:1))};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/ValidatedTextureDescriptor":function(){define(["exports","./enums","./TextureDescriptor"],function(a,b,n){class k extends n.TextureDescriptor{constructor(p,
h){super();this.context=p;Object.assign(this,h);switch(this.internalFormat){case b.SizedPixelFormat.R16F:case b.SizedPixelFormat.R16I:case b.SizedPixelFormat.R16UI:case b.SizedPixelFormat.R32F:case b.SizedPixelFormat.R32I:case b.SizedPixelFormat.R32UI:case b.SizedPixelFormat.R8_SNORM:case b.SizedPixelFormat.R8:case b.SizedPixelFormat.R8I:case b.SizedPixelFormat.R8UI:this.pixelFormat=b.PixelFormat.RED}}static validate(p,h){return new k(p,h)}}a.ValidatedTextureDescriptor=k;Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/views/support/Scheduler":function(){define("exports ../../core/Handles ../../core/has ../../core/Logger ../../core/maybe ../../core/PerformanceSampler ../../core/PooledArray ../../core/promiseUtils ../../core/reactiveUtils ../../core/signal ../../core/time ../../layers/support/PromiseQueue ./debugFlags ./RenderState ./Yield".split(" "),function(a,b,n,k,p,h,e,g,d,f,c,l,w,x,u){function t(E){return m.has(E)?m.get(E):"number"===typeof E?E:1}a.TaskPriority=void 0;(function(E){E.RESOURCE_CONTROLLER_IMMEDIATE=
"immediate";E.RESOURCE_CONTROLLER="schedule";E.SLIDE="slide";E.STREAM_DATA_LOADER="stream loader";E.ELEVATION_QUERY="elevation query";E.TERRAIN_SURFACE="terrain";E.SURFACE_GEOMETRY_UPDATES="surface geometry updates";E.LOD_RENDERER="LoD renderer";E.GRAPHICS_CORE="Graphics3D";E.I3S_CONTROLLER="I3S";E.POINT_CLOUD_LAYER="point cloud";E.FEATURE_TILE_FETCHER="feature fetcher";E.OVERLAY="overlay";E.STAGE="stage";E.GRAPHICS_DECONFLICTOR="graphics deconflictor";E.FILTER_VISIBILITY="Graphics3D filter visibility";
E.SCALE_VISIBILITY="Graphics3D scale visibility";E.FRUSTUM_VISIBILITY="Graphics3D frustum visibility";E.POINT_OF_INTEREST_FREQUENT="POI frequent";E.POINT_OF_INTEREST_INFREQUENT="POI infrequent";E.LABELER="labeler";E.FEATURE_QUERY_ENGINE="feature query";E.FEATURE_TILE_TREE="feature tile tree";E.FEATURE_TILE_TREE_ACTIVE="fast feature tile tree";E.ELEVATION_ALIGNMENT="elevation alignment";E.ELEVATION_ALIGNMENT_SCENE="elevation alignment scene";E.TEXT_TEXTURE_ATLAS="text texture atlas";E.TEXTURE_UNLOAD=
"texture unload";E.LINE_OF_SIGHT_TOOL="line of sight tool";E.LINE_OF_SIGHT_TOOL_INTERACTIVE="interactive line of sight tool";E.ELEVATION_PROFILE="elevation profile";E.SNAPPING="snapping";E.SHADOW_ACCUMULATOR="shadow accumulator";E.CLOUDS_GENERATOR="clouds generator";E.MAPVIEW_FETCH_QUEUE="mapview fetch queue";E.MAPVIEW_LAYERVIEW_UPDATE="mapview layerview update";E.MAPVIEW_VECTOR_TILE_PARSING_QUEUE="mapview vector tile parsing queue";E[E.NONE=0]="NONE";E[E.TEST_PRIO=1]="TEST_PRIO"})(a.TaskPriority||
(a.TaskPriority={}));const m=new Map([[a.TaskPriority.RESOURCE_CONTROLLER_IMMEDIATE,0],[a.TaskPriority.RESOURCE_CONTROLLER,4],[a.TaskPriority.SLIDE,0],[a.TaskPriority.STREAM_DATA_LOADER,0],[a.TaskPriority.ELEVATION_QUERY,0],[a.TaskPriority.TERRAIN_SURFACE,1],[a.TaskPriority.SURFACE_GEOMETRY_UPDATES,1],[a.TaskPriority.LOD_RENDERER,2],[a.TaskPriority.GRAPHICS_CORE,2],[a.TaskPriority.I3S_CONTROLLER,2],[a.TaskPriority.POINT_CLOUD_LAYER,2],[a.TaskPriority.FEATURE_TILE_FETCHER,2],[a.TaskPriority.CLOUDS_GENERATOR,
2],[a.TaskPriority.OVERLAY,4],[a.TaskPriority.STAGE,4],[a.TaskPriority.GRAPHICS_DECONFLICTOR,4],[a.TaskPriority.FILTER_VISIBILITY,4],[a.TaskPriority.SCALE_VISIBILITY,4],[a.TaskPriority.FRUSTUM_VISIBILITY,4],[a.TaskPriority.POINT_OF_INTEREST_FREQUENT,6],[a.TaskPriority.POINT_OF_INTEREST_INFREQUENT,30],[a.TaskPriority.LABELER,8],[a.TaskPriority.FEATURE_QUERY_ENGINE,8],[a.TaskPriority.FEATURE_TILE_TREE,16],[a.TaskPriority.FEATURE_TILE_TREE_ACTIVE,0],[a.TaskPriority.ELEVATION_ALIGNMENT,12],[a.TaskPriority.ELEVATION_ALIGNMENT_SCENE,
14],[a.TaskPriority.TEXT_TEXTURE_ATLAS,12],[a.TaskPriority.TEXTURE_UNLOAD,12],[a.TaskPriority.LINE_OF_SIGHT_TOOL,16],[a.TaskPriority.LINE_OF_SIGHT_TOOL_INTERACTIVE,0],[a.TaskPriority.SNAPPING,0],[a.TaskPriority.SHADOW_ACCUMULATOR,30],[a.TaskPriority.MAPVIEW_FETCH_QUEUE,0],[a.TaskPriority.MAPVIEW_LAYERVIEW_UPDATE,2],[a.TaskPriority.MAPVIEW_VECTOR_TILE_PARSING_QUEUE,0]]),q=c.Milliseconds(6.5),r=c.Milliseconds(1),v=c.Milliseconds(30),y=c.Milliseconds(1E3/30),B=c.Milliseconds(100);var z;(function(E){class F{get updating(){return this._updating.value}_updatingChanged(){this._updating.value=
this._tasks.some(I=>I.needsUpdate)}constructor(){this._updating=f.signal(!0);this._microTaskQueued=!1;this._frameNumber=0;this.performanceInfo={total:new h("total"),tasks:new Map};this._frameTaskTimes=new Map;this._budget=new D;this._state=x.RenderState.INTERACTING;this._tasks=new e;this._runQueue=new e;this._load=0;this._idleStateCallbacks=new e;this._debug=this._forceTask=this._idleUpdatesStartFired=!1;this._debugHandle=d.watch(()=>w.SCHEDULER_LOG_SLOW_TASKS,I=>this._debug=I,d.initial);for(const I of Object.keys(a.TaskPriority))this.performanceInfo.tasks.set(a.TaskPriority[I],
new h(a.TaskPriority[I]))}destroy(){this._tasks.toArray().forEach(I=>I.remove());this._tasks.clear();p.removeMaybe(this._debugHandle);this._microTaskQueued=!1;this._updatingChanged()}taskRunningChanged(I){this._updatingChanged();I&&0<this._budget.remaining&&!this._microTaskQueued&&(this._microTaskQueued=!0,queueMicrotask(()=>{this._microTaskQueued&&(this._microTaskQueued=!1,0<this._budget.remaining&&this._schedule()&&this.frame())}))}registerTask(I,J){J=new G(this,I,J);this._tasks.push(J);this._updatingChanged();
this.performanceInfo.tasks.has(I)||this.performanceInfo.tasks.set(I,new h(I));return J}registerIdleStateCallbacks(I,J){const N={idleBegin:I,idleEnd:J};this._idleStateCallbacks.push(N);this.state===x.RenderState.IDLE&&this._idleUpdatesStartFired&&N.idleBegin();const M=this;return{remove:()=>this._removeIdleStateCallbacks(N),set idleBegin(Q){M._idleUpdatesStartFired&&(N.idleEnd(),M._state===x.RenderState.IDLE&&Q());N.idleBegin=Q},set idleEnd(Q){N.idleEnd=Q}}}get load(){return this._load}set state(I){this._state!==
I&&(this._state=I,this.state!==x.RenderState.IDLE&&this._idleUpdatesStartFired&&(this._idleUpdatesStartFired=!1,this._idleStateCallbacks.forAll(J=>J.idleEnd())))}get state(){return this._state}updateBudget(I){this._test&&(this._test.usedBudget=0);++this._frameNumber;let J=q,N=I.frameDuration,M=r;switch(this.state){case x.RenderState.IDLE:J=c.Milliseconds(0);N=c.Milliseconds(Math.max(B,I.frameDuration));M=v;break;case x.RenderState.INTERACTING:N=c.Milliseconds(Math.max(y,I.frameDuration))}N=c.Milliseconds(N-
I.elapsedFrameTime-J);if(this.state!==x.RenderState.IDLE&&N<r&&!this._forceTask)return this._forceTask=!0,!1;N=c.Milliseconds(Math.max(N,M));this._budget.reset(N,this.state);this._updateLoad();return this._schedule()}frame(){this._microTaskQueued=this._forceTask=!1;switch(this.state){case x.RenderState.IDLE:this._idleUpdatesStartFired||(this._idleUpdatesStartFired=!0,this._idleStateCallbacks.forAll(I=>I.idleBegin()));this._runIdle();break;case x.RenderState.INTERACTING:this._runInteracting();break;
default:this._runAnimating()}this._test&&(this._test.usedBudget=this._budget.elapsed)}stopFrame(){this._budget.reset(c.Milliseconds(0),this._state);this._budget.madeProgress()}_removeIdleStateCallbacks(I){this._idleUpdatesStartFired&&I.idleEnd();this._idleStateCallbacks.removeUnordered(I)}removeTask(I){this._tasks.removeUnordered(I);this._runQueue.removeUnordered(I);this._updatingChanged()}_updateTask(I){this._tasks.forAll(J=>{J.name===I&&J.setPriority(I)})}_getState(I){if(this._runQueue.some(N=>
N.name===I))return a.TaskState.SCHEDULED;let J=a.TaskState.IDLE;this._tasks.forAll(N=>{N.name===I&&N.needsUpdate&&(1>=N.schedulePriority?J=a.TaskState.READY:J!==a.TaskState.READY&&(J=a.TaskState.WAITING))});return J}_getRuntime(I){let J=0;this._tasks.forAll(N=>{N.name===I&&(J+=N.runtime)});return J}_resetRuntimes(){this._tasks.forAll(I=>I.runtime=0)}_getRunning(){const I=new Map;this._tasks.forAll(N=>{N.needsUpdate&&I.set(N.name,(I.get(N.name)||0)+1)});if(0===I.size)return null;let J="";I.forEach((N,
M)=>{J=1<N?J+` ${N}x ${M}`:J+` ${M}`});return J}_runIdle(){this._run()}_runInteracting(){this._run()}_runAnimating(){this._run()}_updateLoad(){const I=this._tasks.reduce((J,N)=>N.needsUpdate?++J:J,0);this._load=.9*this._load+I*(1-.9)}_schedule(){this._runQueue.filterInPlace(I=>{if(I.needsUpdate)return!0;I.schedulePriority=I.basePriority;return!1});for(this._tasks.forAll(I=>{0===I.basePriority&&I.needsUpdate&&!this._runQueue.includes(I)&&I.blockFrame!==this._frameNumber&&this._runQueue.unshift(I)});0===
this._runQueue.length;){let I=!1;this._tasks.forAll(J=>{if(J.needsUpdate&&0!==J.schedulePriority&&0!==J.basePriority&&J.blockFrame!==this._frameNumber)switch(I=!0,J.schedulePriority){case 1:J.schedulePriority=0;this._runQueue.push(J);break;default:--J.schedulePriority}});if(!I)return this._updatingChanged(),!1}this._updatingChanged();return!0}_run(){const I=this._budget.now();this._startFrameTaskTimes();do for(;0<this._runQueue.length;){var J=this._budget.now();const N=this._runQueue.pop();this._budget.resetProgress();
try{N.task.runTask(this._budget)===u.Yield&&(N.blockFrame=this._frameNumber)}catch(M){k.getLogger("esri.views.support.Scheduler").error(`Exception in task "${N.name}"`,M),N.blockFrame=this._frameNumber}!this._budget.hasProgressed&&N.blockFrame!==this._frameNumber&&N.needsUpdate&&(N.blockFrame=this._frameNumber);N.schedulePriority=N.basePriority;J=this._budget.now()-J;N.runtime+=J;this._frameTaskTimes.set(N.priority,this._frameTaskTimes.get(N.priority)+J);if(0>=this._budget.remaining){this._updatingChanged();
this._recordFrameTaskTimes(this._budget.now()-I);return}}while(this._schedule());this._updatingChanged();this._recordFrameTaskTimes(this._budget.now()-I)}_startFrameTaskTimes(){for(const I of Object.keys(a.TaskPriority))this._frameTaskTimes.set(a.TaskPriority[I],0)}_recordFrameTaskTimes(I){this._frameTaskTimes.forEach((J,N)=>this.performanceInfo.tasks.get(N).push(J));this.performanceInfo.total.push(I)}get test(){return this._test}}E.Scheduler=F;class G{get task(){return this._task.value}get updating(){return this._queue.running}constructor(I,
J,N){this._scheduler=I;this.name=J;this.runtime=this.blockFrame=0;this._queue=new l.PromiseQueue;this._handles=new b;this.schedulePriority=this._basePriority=t(J);this._task=f.signal(null!=N?N:this._queue);this._handles.add(d.when(()=>this.task.running,M=>I.taskRunningChanged(M)))}remove(){this.processQueue(A);this._scheduler.removeTask(this);this.schedule=H.schedule;this.reschedule=H.reschedule;this._handles.destroy()}get basePriority(){return this._basePriority}setPriority(I){if(this.name!==I){this.name=
I;I=t(I);if(0===this._basePriority||0!==this.schedulePriority)this.schedulePriority=I;this._basePriority=I}}get priority(){return this.name}set priority(I){this.setPriority(I)}get needsUpdate(){return this.updating||this.task.running}schedule(I,J,N){return this._queue.push(I,J,N)}reschedule(I,J,N){return this._queue.unshift(I,J,N)}processQueue(I){return this._queue.runTask(I)}}class D{constructor(){this._begin="undefined"!==typeof performance?performance.now():0;this._budget=0;this._state=x.RenderState.IDLE;
this._progressed=this._done=!1;this._enabled=!0}run(I){if(this.done)return!1;!0===I()&&this.madeProgress();return!0}get done(){return this._done}get budget(){return this._budget}madeProgress(){this._progressed=!0;return this._done=this.elapsed>=this._budget&&this._enabled}get state(){return this._state}get enabled(){return this._enabled}set enabled(I){this._enabled=I}reset(I,J){this._begin=this.now();this._budget=I;this._state=J;this.resetProgress()}get remaining(){return Math.max(this._budget-this.elapsed,
0)}now(){return performance.now()}get elapsed(){return this.now()-this._begin}resetProgress(){this._done=this._progressed=!1}get hasProgressed(){return this._progressed}}E.Budget=D})(z||={});a.TaskState=void 0;(function(E){E.SCHEDULED="s";E.READY="r";E.WAITING="w";E.IDLE="i"})(a.TaskState||(a.TaskState={}));const A=(()=>{const E=new z.Budget;E.enabled=!1;return E})();class C{remove(){}processQueue(){}schedule(E,F,G){try{if(g.isAborted(F)){const D=g.createAbortError();return G?Promise.resolve(G(D)):
Promise.reject(D)}return g.when(E(A))}catch(D){return Promise.reject(D)}}reschedule(E,F,G){return this.schedule(E,F,G)}}const H=new C;a.ImmediateTask=H;a.getTaskPriority=t;a.newScheduler=function(){return new z.Scheduler};a.noBudget=A;a.taskPriorities=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/PromiseQueue":function(){define(["exports","../../core/promiseUtils","../../core/signal","../../views/support/Yield"],function(a,b,n,k){class p{constructor(){this._tasks=
[];this._runningTasks=n.signal(0)}get length(){return this._tasks.length}get running(){return 0<this._runningTasks.value}destroy(){this.cancelAll()}runTask(e){if(0===this.length)return k.Yield;for(;!e.done&&this._process(e);)e.madeProgress()}push(e,g,d){++this._runningTasks.value;return(new Promise((f,c)=>this._tasks.push(new h(f,c,e,g,d)))).finally(()=>--this._runningTasks.value)}unshift(e,g,d){++this._runningTasks.value;return(new Promise((f,c)=>this._tasks.unshift(new h(f,c,e,g,d)))).finally(()=>
--this._runningTasks.value)}_process(e){if(0===this._tasks.length)return!1;const g=this._tasks.shift();try{const d=b.isAborted(g.signal);if(d&&!g.abortCallback)g.reject(b.createAbortError());else{const f=d?g.abortCallback?.(b.createAbortError()):g.callback(e);b.isPromiseLike(f)?f.then(g.resolve,g.reject):g.resolve(f)}}catch(d){g.reject(d)}return!0}cancelAll(){const e=b.createAbortError();for(const g of this._tasks)if(g.abortCallback){const d=g.abortCallback(e);g.resolve(d)}else g.reject(e);this._tasks.length=
0}}class h{constructor(e,g,d,f,c){this.resolve=e;this.reject=g;this.callback=d;this.signal=f;this.abortCallback=c}}a.PromiseQueue=p;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/support/Yield":function(){define(["exports"],function(a){const b=Symbol("Yield");a.Yield=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/support/debugFlags":function(){define("../../chunks/tslib.es6 ../../core/Accessor ../../core/accessorSupport/decorators/property ../../core/has ../../core/Logger ../../core/RandomLCG ../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,n,k,p,h,e){b=class extends b{constructor(){super(...arguments);this.FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES=this.SCHEDULER_LOG_SLOW_TASKS=!1}};a.__decorate([n.property()],b.prototype,"SCHEDULER_LOG_SLOW_TASKS",void 0);a.__decorate([n.property()],b.prototype,"FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES",void 0);b=a.__decorate([e.subclass("esri.views.support.debugFlags")],b);return new b})},"esri/views/support/RenderState":function(){define(["exports"],function(a){a.RenderState=
void 0;var b=a.RenderState||(a.RenderState={});b[b.ANIMATING=0]="ANIMATING";b[b.INTERACTING=1]="INTERACTING";b[b.IDLE=2]="IDLE";Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/Precipitation":function(){define("exports ../../../chunks/tslib.es6 ../../../core/mathUtils ../../../core/maybe ../../../core/reactiveUtils ../../../core/time ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ../../../geometry/ellipsoidUtils ../webgl ./PrecipitationTechnique ./PrecipitationTechniqueConfiguration ../support/buffer/glUtil ../support/buffer/InterleavedLayout ../webgl/RenderNode ../webgl-engine/lib/basicInterfaces ../webgl-engine/lib/VertexArrayObject ../webgl-engine/lib/VertexAttribute ../../webgl/BufferObject ../../webgl/enums ../../webgl/Util".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w,x,u,t,m,q,r,v,y,B,z,A){function C(F,G){const D=new Float32Array([-1,0,1,1,0,-1,1,0,1]);return new v.VertexArrayObject(F,G,new Map([["geometry",t.glLayout(H)]]),new Map([["geometry",B.BufferObject.createVertex(F,z.Usage.STATIC_DRAW,D)]]))}a.Precipitation=class extends q{constructor(F){super(F);this.consumes={required:[w.InternalRenderCategory.TRANSPARENT_ENVIRONMENT]};this.produces=w.InternalRenderCategory.TRANSPARENT_ENVIRONMENT;this._rainSpeed=.1;this._snowSpeed=
.01;this._numParticles=0;this._passParameters=new x.PrecipitationPassParameters;this._configuration=new u.PrecipitationTechniqueConfiguration;const {view:G,type:D,techniques:I}=F;this._configuration.type="rainy"===D?u.PrecipitationType.Rain:u.PrecipitationType.Snow;I.precompile(x.PrecipitationTechnique,this._configuration);this._passParameters.time=0;this._passParameters.radius=l.getReferenceEllipsoid(G.spatialReference).radius;this.addHandles(p.watch(()=>G.environment.weather,J=>{J.type===D&&this.addHandles(p.watch(()=>
J.precipitation,N=>this._adjustParticles(N),p.syncAndInitial))},p.syncAndInitial));this.addHandles(p.watch(()=>G._stage?.renderer.renderContext.bind.clouds.fadeFactor??1,J=>{this._passParameters.opacity=J;1===J&&(this.removeHandles("opacity"),this.addHandles(p.watch(()=>G._stage?.renderer.renderContext.bind.clouds.opacity??1,N=>this._passParameters.opacity=N,p.syncAndInitial),"opacity"))},p.sync),"opacity")}_adjustParticles(F){this._numParticles=25E4*(.5>F?n.lerp(0,.35,2*F):n.lerp(.35,1,2*(F-.5)))}destroy(){this._numParticles=
0;this._vao=k.disposeMaybe(this._vao);this._instanceIdBuffer=k.disposeMaybe(this._instanceIdBuffer)}fadeOut(F){this.removeAllHandles();this.addHandles(p.watch(()=>this.renderContext?.bind.clouds.fadeFactor??1,G=>{this._passParameters.opacity=1-G;1===G&&(this.removeAllHandles(),F())}),"opacity")}updateAnimation(F){F=("rainy"===this.type?this._rainSpeed:this._snowSpeed)*h.secondsFromMilliseconds(F.time)%1E5;if(this._passParameters.time===F)return!1;this._passParameters.time=F;return!0}render(F){const G=
this.renderingContext;this._instanceIdBuffer??(this._instanceIdBuffer=this._createInstanceIndices(G));const D=Math.round(this._numParticles*this._passParameters.opacity);F=F.find(({name:N})=>N===w.InternalRenderCategory.TRANSPARENT_ENVIRONMENT);if(1>D)return F;const I=this.techniques.acquire(x.PrecipitationTechnique,this._configuration);if(!I.compiled)return I.release(),this.requestRender(r.RenderRequestType.UPDATE),F;const J=G.bindTechnique(I,this.bindParameters,this._passParameters);this._vao??
(this._vao=C(G,I.locations));G.bindVAO(this._vao);J.assertCompatibleVertexAttributeLocations(this._vao);A.bindVertexBufferLayout(G,I.locations,this._instanceIdBuffer,E,0);G.drawArraysInstanced(z.PrimitiveType.TRIANGLES,0,3,D);A.unbindVertexBufferLayout(G,I.locations,this._instanceIdBuffer,E);I.release();return F}_createInstanceIndices(F){const G=[];for(let D=0;25E4>D;D++)G.push(D);return B.BufferObject.createVertex(F,z.Usage.STATIC_DRAW,new Float32Array(G))}};b.__decorate([e.property()],a.Precipitation.prototype,
"consumes",void 0);b.__decorate([e.property()],a.Precipitation.prototype,"produces",void 0);b.__decorate([e.property({constructOnly:!0})],a.Precipitation.prototype,"type",void 0);b.__decorate([e.property({constructOnly:!0})],a.Precipitation.prototype,"techniques",void 0);a.Precipitation=b.__decorate([c.subclass("esri.views.3d.environment.Precipitation")],a.Precipitation);const H=m.newLayout().vec3f(y.VertexAttribute.POSITION),E=t.glLayout(m.newLayout().f32(y.VertexAttribute.INSTANCEFEATUREATTRIBUTE),
1);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl":function(){define(["exports","../../core/libs/gl-matrix-2/factories/mat4f64","../../geometry/projection/computeTranslationToOriginAndRotation","../../geometry/projection/projectBuffer"],function(a,b,n,k){a.RenderCategory=void 0;(function(p){p.OPAQUE="opaque-color";p.TRANSPARENT="transparent-color";p.COMPOSITE="composite-color";p.FINAL="final-color"})(a.RenderCategory||(a.RenderCategory={}));a.InternalRenderCategory=
void 0;(function(p){p.SSAO="ssao";p.LASERLINES="laserline-color";p.ANTIALIASING="aa-color";p.HIGHLIGHTS="highlight-color";p.MAGNIFIER="magnifier-color";p.OCCLUDED="occluded-color";p.VIEWSHED="viewshed-color";p.OPAQUE_ENVIRONMENT="opaque-environment-color";p.TRANSPARENT_ENVIRONMENT="transparent-environment-color"})(a.InternalRenderCategory||(a.InternalRenderCategory={}));a.fromRenderCoordinates=function(p,h,e,g,d,f,c){f=f||p.spatialReference;return k.projectBuffer(h,p.renderCoordsHelper.spatialReference,
e,g,f,d,c)?g:null};a.renderCoordinateTransformAt=function(p,h,e,g){g||=b.create();e=e||p.spatialReference;return n.computeTranslationToOriginAndRotation(e,h,g,p.renderCoordsHelper.spatialReference)?g:null};a.toRenderCoordinates=function(p,h,e,g,d,f,c){g=g||p.spatialReference;return k.projectBuffer(h,g,e,d,p.renderCoordsHelper.spatialReference,f,c)?d:null};a.webgl=null;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/PrecipitationTechnique":function(){define("require exports ../../../chunks/Precipitation.glsl ../webgl-engine/core/shaderModules/interfaces ../webgl-engine/core/shaderTechnique/ReloadableShaderModule ../webgl-engine/core/shaderTechnique/ShaderTechnique ../webgl-engine/lib/VertexAttribute ../../webgl/enums ../../webgl/renderState".split(" "),
function(a,b,n,k,p,h,e,g,d){class f extends k.NoParameters{constructor(){super(...arguments);this.time=0;this.radius=1;this.width=500;this.opacity=0}}class c extends h.ShaderTechnique{constructor(l,w,x){super(l,w,new p.ReloadableShaderModule(n.Precipitation,()=>new Promise((u,t)=>a(["./Precipitation.glsl"],u,t))),x,new Map([[e.VertexAttribute.POSITION,0],[e.VertexAttribute.INSTANCEFEATUREATTRIBUTE,1]]))}initializePipeline(){return d.makePipelineState({blending:d.blendWithPremultipliedAlpha,depthTest:{func:g.CompareFunction.LEQUAL},
colorWrite:d.defaultColorWrite})}}b.PrecipitationPassParameters=f;b.PrecipitationTechnique=c;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/Precipitation.glsl":function(){define("exports ./vec32 ../core/libs/gl-matrix-2/factories/vec3f64 ../views/3d/environment/PrecipitationTechniqueConfiguration ../views/3d/webgl-engine/core/shaderModules/Float3PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/Matrix4PassUniform ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,n,k,p,h,e,g,d,f){function c(t){const m=new d.ShaderBuilder;m.attributes.add(f.VertexAttribute.POSITION,"vec3");m.attributes.add(f.VertexAttribute.INSTANCEFEATUREATTRIBUTE,"float");m.vertex.uniforms.add(new p.Float3PassUniform("cameraPosition",(q,r)=>r.camera.eye),new p.Float3PassUniform("offset",(q,r)=>{r=r.camera.eye;var v=.5*q.width;const y=1/q.width;v=b.floor(l,b.set(l,(r[0]+v)*y,(r[1]+v)*y,(r[2]+v)*y));return b.sub(v,r,b.scale(v,v,q.width))}),new h.FloatPassUniform("width",q=>q.width),
new h.FloatPassUniform("time",q=>q.time),new g.Matrix4PassUniform("proj",(q,r)=>r.camera.projectionMatrix),new g.Matrix4PassUniform("view",(q,r)=>r.camera.viewMatrix));m.varyings.add("vUv","vec2");m.vertex.code.add(e.glsl`vec3 hash31(float p){
vec3 p3 = fract(vec3(p) * vec3(0.1031, 0.1030, 0.0973));
p3 += dot(p3, p3.yzx + 33.33);
return fract((p3.xxy + p3.yzz) * p3.zyx);
}
float hash11(float p){
p = fract(p * 0.1031);
p *= p + 33.33;
p *= p + p;
return fract(p);
}
vec3 rotateVectorByQuaternion(vec3 v, vec4 q){
return 2.0 * cross(q.xyz, v * q.w + cross(q.xyz, v)) + v;
}`);m.vertex.main.add(e.glsl`
      vUv = position.xz;
      vec3 rand = hash31(instanceFeatureAttribute);

      // Set random position for all particles
      // The hash function space is not high resolution so offset particles by an additional random value
      // This creates grids of 1000 particles which are shifted by random hundredths of the tile width
      // overlaying multiple identical but offset grids
      vec3 randomPosition = 2.0 * (rand + (0.01 + 0.01 * rand) * floor(0.001 * instanceFeatureAttribute)) - 1.0;

      // Random orientation of rain drops
      float angle = 3.1415 * hash11(instanceFeatureAttribute);

      vec3 up = vec3(0, 0, 1);

      // Gravity and wind direction
      vec3 direction = normalize(cameraPosition);

      vec3 tangent = normalize(cross(direction, up));

      // Gravity
      vec3 animatedPos = randomPosition + direction * -time;

      // Rain particles fall straight down and are randomly oriented
      // Snow particles have random sinusoid trajectories and are rotated to face the camera
      ${t.type===k.PrecipitationType.Rain?e.glsl`
            // Random rotation for particle
            vec3 rotationAxis = up;
            vec4 quat = vec4(rotationAxis * sin(angle), cos(angle));
            vec3 transformedPos = rotateVectorByQuaternion(vec3(0.2, 0.2, 4.0) * (position - vec3(0.5, 0.0, 0.5)), quat);

            // Rotate particle to planetary position
            rotationAxis = tangent;
            angle = 0.5 * -acos(dot(direction, up));
            quat = vec4(rotationAxis * sin(angle), cos(angle));
            transformedPos = rotateVectorByQuaternion(transformedPos, quat);

            vec4 pos = mat4(mat3(view)) * vec4(transformedPos + (mod(width * animatedPos - offset, width) - 0.5 * width), 1.0);
            gl_Position = proj * pos;
      `:e.glsl`
            vec3 rotationAxis = direction;
            vec4 quat = vec4(rotationAxis * sin(angle), cos(angle));

            tangent = rotateVectorByQuaternion(tangent, quat);
            // Random sinusoid from friction
            animatedPos += tangent * 0.25 * sin(dot(animatedPos, direction));
            vec4 pos = mat4(mat3(view)) * vec4((mod(width * animatedPos - offset, width) - 0.5 * width), 1.0);
            gl_Position = proj * (0.5 * vec4(position.xzy, 0.0) + pos);
      `}
  `);m.fragment.uniforms.add(new h.FloatPassUniform("opacity",q=>q.opacity),new p.Float3PassUniform("particleColor",(q,r)=>{q=t.type===k.PrecipitationType.Rain?u:x;const v=b.scale(l,q,.7);b.normalize(w,r.camera.eye);r=Math.max(0,b.dot(w,r.lighting.mainLight.direction));return b.lerp(v,v,q,r)}));m.fragment.main.add(e.glsl`
    float d = length(vUv - vec2(0.5));

    ${t.type===k.PrecipitationType.Rain?e.glsl`d = 0.35 * smoothstep(0.5, 0.0, d);`:e.glsl`d = smoothstep(0.5, 0.1, d);`}
    fragColor = opacity * vec4(particleColor * d, d);
  `);return m}const l=n.create(),w=n.create(),x=n.fromValues(1,1,1),u=n.fromValues(.85,.85,.85);n=Object.freeze(Object.defineProperty({__proto__:null,build:c},Symbol.toStringTag,{value:"Module"}));a.Precipitation=n;a.build=c})},"esri/views/3d/environment/PrecipitationTechniqueConfiguration":function(){define(["exports","../../../chunks/tslib.es6","../webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration"],function(a,b,n){a.PrecipitationType=void 0;(function(p){p[p.Rain=0]="Rain";p[p.Snow=
1]="Snow";p[p.COUNT=2]="COUNT"})(a.PrecipitationType||(a.PrecipitationType={}));class k extends n.ShaderTechniqueConfiguration{constructor(){super(...arguments);this.type=a.PrecipitationType.Rain}}b.__decorate([n.parameter({count:a.PrecipitationType.COUNT})],k.prototype,"type",void 0);a.PrecipitationTechniqueConfiguration=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/Float3PassUniform":function(){define(["exports","./Uniform","../shaderTechnique/BindType"],
function(a,b,n){class k extends b.Uniform{constructor(p,h){super(p,"vec3",n.BindType.Pass,(e,g,d)=>e.setUniform3fv(p,h(g,d)))}}a.Float3PassUniform=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/Matrix4PassUniform":function(){define(["exports","./Uniform","../shaderTechnique/BindType"],function(a,b,n){class k extends b.Uniform{constructor(p,h){super(p,"mat4",n.BindType.Pass,(e,g,d)=>e.setUniformMatrix4fv(p,h(g,d)))}}a.Matrix4PassUniform=
k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/buffer/glUtil":function(){define(["exports","../../../webgl/enums","../../../webgl/VertexElementDescriptor"],function(a,b,n){const k={u8:b.DataType.UNSIGNED_BYTE,u16:b.DataType.UNSIGNED_SHORT,u32:b.DataType.UNSIGNED_INT,i8:b.DataType.BYTE,i16:b.DataType.SHORT,i32:b.DataType.INT,f32:b.DataType.FLOAT};a.glLayout=function(p,h=0){const e=p.stride;return Array.from(p.fields.keys()).map(g=>{const d=p.fields.get(g),
f=d.constructor.ElementCount;var c=k[d.constructor.ElementType];if(!c)throw Error("BufferType not supported in WebGL");return new n.VertexElementDescriptor(g,f,c,d.offset,e,d.optional?.glNormalized??!1,h)})};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/VertexElementDescriptor":function(){define(["exports"],function(a){class b{constructor(n,k,p,h,e,g=!1,d=0){this.name=n;this.count=k;this.type=p;this.offset=h;this.stride=e;this.normalized=g;this.divisor=d}}a.VertexElementDescriptor=
b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/buffer/InterleavedLayout":function(){define(["exports","../../../../geometry/support/buffer/BufferView","../../../../geometry/support/buffer/types","../../webgl-engine/lib/Util"],function(a,b,n,k){class p{constructor(f,c){this.layout=f;this.buffer="number"===typeof c?new ArrayBuffer(c*f.stride):c;for(const l of f.fields.keys())c=f.fields.get(l),this[l]=new c.constructor(this.buffer,c.offset,this.stride)}get stride(){return this.layout.stride}get count(){return this.buffer.byteLength/
this.stride}get byteLength(){return this.buffer.byteLength}getField(f,c){return(f=this[f])&&f.elementCount===c.ElementCount&&f.elementType===c.ElementType?f:null}slice(f,c){return new p(this.layout,this.buffer.slice(f*this.stride,c*this.stride))}copyFrom(f,c=0,l=0,w=f.count){const x=this.stride;0===x%4?(f=new Uint32Array(f.buffer,c*x,w*x/4),(new Uint32Array(this.buffer,l*x,w*x/4)).set(f)):(f=new Uint8Array(f.buffer,c*x,w*x),(new Uint8Array(this.buffer,l*x,w*x)).set(f));return this}get usedMemory(){return this.byteLength}dispose(){}}
class h{constructor(f){this._lastAligned=this._stride=0;this._fields=new Map;f&&(this._stride=f.stride,f.fields.forEach(c=>this._fields.set(c[0],{...c[1],constructor:d.get(c[1].constructor)})))}freeze(){return this}vec2f(f,c){this._appendField(f,b.BufferViewVec2f,c);return this}vec2f64(f,c){this._appendField(f,b.BufferViewVec2f64,c);return this}vec3f(f,c){this._appendField(f,b.BufferViewVec3f,c);return this}vec3f64(f,c){this._appendField(f,b.BufferViewVec3f64,c);return this}vec4f(f,c){this._appendField(f,
b.BufferViewVec4f,c);return this}vec4f64(f,c){this._appendField(f,b.BufferViewVec4f64,c);return this}mat3f(f,c){this._appendField(f,b.BufferViewMat3f,c);return this}mat3f64(f,c){this._appendField(f,b.BufferViewMat3f64,c);return this}mat4f(f,c){this._appendField(f,b.BufferViewMat4f,c);return this}mat4f64(f,c){this._appendField(f,b.BufferViewMat4f64,c);return this}vec4u8(f,c){this._appendField(f,b.BufferViewVec4u8,c);return this}f32(f,c){this._appendField(f,b.BufferViewFloat,c);return this}f64(f,c){this._appendField(f,
b.BufferViewFloat64,c);return this}u8(f,c){this._appendField(f,b.BufferViewUint8,c);return this}u16(f,c){this._appendField(f,b.BufferViewUint16,c);return this}i8(f,c){this._appendField(f,b.BufferViewInt8,c);return this}vec2i8(f,c){this._appendField(f,b.BufferViewVec2i8,c);return this}vec2i16(f,c){this._appendField(f,b.BufferViewVec2i16,c);return this}vec2u8(f,c){this._appendField(f,b.BufferViewVec2u8,c);return this}vec4u16(f,c){this._appendField(f,b.BufferViewVec4u16,c);return this}u32(f,c){this._appendField(f,
b.BufferViewUint32,c);return this}_appendField(f,c,l){if(this._fields.has(f))k.assert(!1,`${f} already added to vertex buffer layout`);else{var w=c.ElementCount*n.elementTypeSize(c.ElementType),x=this._stride;this._stride+=w;this._fields.set(f,{size:w,constructor:c,offset:x,optional:l})}}createBuffer(f){return new p(this,f)}createView(f){return new p(this,f)}clone(){const f=new h;f._stride=this._stride;f._fields=new Map;this._fields.forEach((c,l)=>f._fields.set(l,c));f.BufferType=this.BufferType;
return f}get stride(){if(this._lastAligned!==this._fields.size){let f=1;this._fields.forEach(c=>f=Math.max(f,n.elementTypeSize(c.constructor.ElementType)));this._stride=Math.floor((this._stride+f-1)/f)*f;this._lastAligned=this._fields.size}return this._stride}get fields(){return this._fields}}class e{constructor(f){this.fields=[];f.fields.forEach((c,l)=>{var w=c.constructor;this.fields.push([l,{...c,constructor:`${w.ElementType}_${w.ElementCount}`}])});this.stride=f.stride}}const g=[b.BufferViewFloat,
b.BufferViewVec2f,b.BufferViewVec3f,b.BufferViewVec4f,b.BufferViewMat3f,b.BufferViewMat4f,b.BufferViewFloat64,b.BufferViewVec2f64,b.BufferViewVec3f64,b.BufferViewVec4f64,b.BufferViewMat3f64,b.BufferViewMat4f64,b.BufferViewUint8,b.BufferViewVec2u8,b.BufferViewVec3u8,b.BufferViewVec4u8,b.BufferViewUint16,b.BufferViewVec2u16,b.BufferViewVec3u16,b.BufferViewVec4u16,b.BufferViewUint32,b.BufferViewVec2u32,b.BufferViewVec3u32,b.BufferViewVec4u32,b.BufferViewInt8,b.BufferViewVec2i8,b.BufferViewVec3i8,b.BufferViewVec4i8,
b.BufferViewInt16,b.BufferViewVec2i16,b.BufferViewVec3i16,b.BufferViewVec4i16,b.BufferViewInt32,b.BufferViewVec2i32,b.BufferViewVec3i32,b.BufferViewVec4i32],d=new Map;g.forEach(f=>d.set(`${f.ElementType}_${f.ElementCount}`,f));a.InterleavedBuffer=p;a.InterleavedLayout=h;a.PackedLayout=e;a.newLayout=function(){return new h};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/buffer/BufferView":function(){define("exports ./internals/Mat3 ./internals/Mat4 ./internals/Scalar ./internals/Vec2 ./internals/Vec3 ./internals/Vec4".split(" "),
function(a,b,n,k,p,h,e){class g extends k.BufferViewScalarImpl{constructor(U,da=0,fa,ha){super(Float32Array,U,da,fa,ha);this.elementType="f32"}static fromTypedArray(U,da){return new g(U.buffer,U.byteOffset,da,U.byteOffset+U.byteLength)}}g.ElementType="f32";class d extends p.BufferViewVec2Impl{constructor(U,da=0,fa,ha){super(Float32Array,U,da,fa,ha);this.elementType="f32"}slice(U,da){return this.sliceBuffer(d,U,da)}static fromTypedArray(U,da){return new d(U.buffer,U.byteOffset,da,U.byteOffset+U.byteLength)}}
d.ElementType="f32";class f extends h.BufferViewVec3Impl{constructor(U,da=0,fa,ha){super(Float32Array,U,da,fa,ha);this.elementType="f32"}slice(U,da){return this.sliceBuffer(f,U,da)}static fromTypedArray(U,da){return new f(U.buffer,U.byteOffset,da,U.byteOffset+U.byteLength)}}f.ElementType="f32";class c extends e.BufferViewVec4Impl{constructor(U,da=0,fa,ha){super(Float32Array,U,da,fa,ha);this.elementType="f32"}slice(U,da){return this.sliceBuffer(c,U,da)}static fromTypedArray(U,da){return new c(U.buffer,
U.byteOffset,da,U.byteOffset+U.byteLength)}}c.ElementType="f32";class l extends b.BufferViewMat3Impl{constructor(U,da=0,fa,ha){super(Float32Array,U,da,fa,ha);this.elementType="f32"}slice(U,da){return this.sliceBuffer(l,U,da)}static fromTypedArray(U,da){return new l(U.buffer,U.byteOffset,da,U.byteOffset+U.byteLength)}}l.ElementType="f32";class w extends b.BufferViewMat3Impl{constructor(U,da=0,fa,ha){super(Float64Array,U,da,fa,ha);this.elementType="f64"}slice(U,da){return this.sliceBuffer(w,U,da)}static fromTypedArray(U,
da){return new w(U.buffer,U.byteOffset,da,U.byteOffset+U.byteLength)}}w.ElementType="f64";class x extends n.BufferViewMat4Impl{constructor(U,da=0,fa,ha){super(Float32Array,U,da,fa,ha);this.elementType="f32"}slice(U,da){return this.sliceBuffer(x,U,da)}static fromTypedArray(U,da){return new x(U.buffer,U.byteOffset,da,U.byteOffset+U.byteLength)}}x.ElementType="f32";class u extends n.BufferViewMat4Impl{constructor(U,da=0,fa,ha){super(Float64Array,U,da,fa,ha);this.elementType="f64"}slice(U,da){return this.sliceBuffer(u,
U,da)}static fromTypedArray(U,da){return new u(U.buffer,U.byteOffset,da,U.byteOffset+U.byteLength)}}u.ElementType="f64";class t extends k.BufferViewScalarImpl{constructor(U,da=0,fa,ha){super(Float64Array,U,da,fa,ha);this.elementType="f64"}slice(U,da){return this.sliceBuffer(t,U,da)}static fromTypedArray(U,da){return new t(U.buffer,U.byteOffset,da,U.byteOffset+U.byteLength)}}t.ElementType="f64";class m extends p.BufferViewVec2Impl{constructor(U,da=0,fa,ha){super(Float64Array,U,da,fa,ha);this.elementType=
"f64"}slice(U,da){return this.sliceBuffer(m,U,da)}static fromTypedArray(U,da){return new m(U.buffer,U.byteOffset,da,U.byteOffset+U.byteLength)}}m.ElementType="f64";class q extends h.BufferViewVec3Impl{constructor(U,da=0,fa,ha){super(Float64Array,U,da,fa,ha);this.elementType="f64"}slice(U,da){return this.sliceBuffer(q,U,da)}static fromTypedArray(U,da){return new q(U.buffer,U.byteOffset,da,U.byteOffset+U.byteLength)}}q.ElementType="f64";class r extends e.BufferViewVec4Impl{constructor(U,da=0,fa,ha){super(Float64Array,
U,da,fa,ha);this.elementType="f64"}slice(U,da){return this.sliceBuffer(r,U,da)}static fromTypedArray(U,da){return new r(U.buffer,U.byteOffset,da,U.byteOffset+U.byteLength)}}r.ElementType="f64";class v extends k.BufferViewScalarImpl{constructor(U,da=0,fa,ha){super(Uint8Array,U,da,fa,ha);this.elementType="u8"}slice(U,da){return this.sliceBuffer(v,U,da)}static fromTypedArray(U,da){return new v(U.buffer,U.byteOffset,da,U.byteOffset+U.byteLength)}}v.ElementType="u8";class y extends p.BufferViewVec2Impl{constructor(U,
da=0,fa,ha){super(Uint8Array,U,da,fa,ha);this.elementType="u8"}slice(U,da){return this.sliceBuffer(y,U,da)}static fromTypedArray(U,da){return new y(U.buffer,U.byteOffset,da,U.byteOffset+U.byteLength)}}y.ElementType="u8";class B extends h.BufferViewVec3Impl{constructor(U,da=0,fa,ha){super(Uint8Array,U,da,fa,ha);this.elementType="u8"}slice(U,da){return this.sliceBuffer(B,U,da)}static fromTypedArray(U,da){return new B(U.buffer,U.byteOffset,da,U.byteOffset+U.byteLength)}}B.ElementType="u8";class z extends e.BufferViewVec4Impl{constructor(U,
da=0,fa,ha){super(Uint8Array,U,da,fa,ha);this.elementType="u8"}slice(U,da){return this.sliceBuffer(z,U,da)}static fromTypedArray(U,da){return new z(U.buffer,U.byteOffset,da,U.byteOffset+U.byteLength)}}z.ElementType="u8";class A extends k.BufferViewScalarImpl{constructor(U,da=0,fa,ha){super(Uint16Array,U,da,fa,ha);this.elementType="u16"}slice(U,da){return this.sliceBuffer(A,U,da)}static fromTypedArray(U,da){return new A(U.buffer,U.byteOffset,da,U.byteOffset+U.byteLength)}}A.ElementType="u16";class C extends p.BufferViewVec2Impl{constructor(U,
da=0,fa,ha){super(Uint16Array,U,da,fa,ha);this.elementType="u16"}slice(U,da){return this.sliceBuffer(C,U,da)}static fromTypedArray(U,da){return new C(U.buffer,U.byteOffset,da,U.byteOffset+U.byteLength)}}C.ElementType="u16";class H extends h.BufferViewVec3Impl{constructor(U,da=0,fa,ha){super(Uint16Array,U,da,fa,ha);this.elementType="u16"}slice(U,da){return this.sliceBuffer(H,U,da)}static fromTypedArray(U,da){return new H(U.buffer,U.byteOffset,da,U.byteOffset+U.byteLength)}}H.ElementType="u16";class E extends e.BufferViewVec4Impl{constructor(U,
da=0,fa,ha){super(Uint16Array,U,da,fa,ha);this.elementType="u16"}slice(U,da){return this.sliceBuffer(E,U,da)}static fromTypedArray(U,da){return new E(U.buffer,U.byteOffset,da,U.byteOffset+U.byteLength)}}E.ElementType="u16";class F extends k.BufferViewScalarImpl{constructor(U,da=0,fa,ha){super(Uint32Array,U,da,fa,ha);this.elementType="u32"}slice(U,da){return this.sliceBuffer(F,U,da)}static fromTypedArray(U,da){return new F(U.buffer,U.byteOffset,da,U.byteOffset+U.byteLength)}}F.ElementType="u32";class G extends p.BufferViewVec2Impl{constructor(U,
da=0,fa,ha){super(Uint32Array,U,da,fa,ha);this.elementType="u32"}slice(U,da){return this.sliceBuffer(G,U,da)}static fromTypedArray(U,da){return new G(U.buffer,U.byteOffset,da,U.byteOffset+U.byteLength)}}G.ElementType="u32";class D extends h.BufferViewVec3Impl{constructor(U,da=0,fa,ha){super(Uint32Array,U,da,fa,ha);this.elementType="u32"}slice(U,da){return this.sliceBuffer(D,U,da)}static fromTypedArray(U,da){return new D(U.buffer,U.byteOffset,da,U.byteOffset+U.byteLength)}}D.ElementType="u32";class I extends e.BufferViewVec4Impl{constructor(U,
da=0,fa,ha){super(Uint32Array,U,da,fa,ha);this.elementType="u32"}slice(U,da){return this.sliceBuffer(I,U,da)}static fromTypedArray(U,da){return new I(U.buffer,U.byteOffset,da,U.byteOffset+U.byteLength)}}I.ElementType="u32";class J extends k.BufferViewScalarImpl{constructor(U,da=0,fa,ha){super(Int8Array,U,da,fa,ha);this.elementType="i8"}slice(U,da){return this.sliceBuffer(J,U,da)}static fromTypedArray(U,da){return new J(U.buffer,U.byteOffset,da,U.byteOffset+U.byteLength)}}J.ElementType="i8";class N extends p.BufferViewVec2Impl{constructor(U,
da=0,fa,ha){super(Int8Array,U,da,fa,ha);this.elementType="i8"}slice(U,da){return this.sliceBuffer(N,U,da)}static fromTypedArray(U,da){return new N(U.buffer,U.byteOffset,da,U.byteOffset+U.byteLength)}}N.ElementType="i8";class M extends h.BufferViewVec3Impl{constructor(U,da=0,fa,ha){super(Int8Array,U,da,fa,ha);this.elementType="i8"}slice(U,da){return this.sliceBuffer(M,U,da)}static fromTypedArray(U,da){return new M(U.buffer,U.byteOffset,da,U.byteOffset+U.byteLength)}}M.ElementType="i8";class Q extends e.BufferViewVec4Impl{constructor(U,
da=0,fa,ha){super(Int8Array,U,da,fa,ha);this.elementType="i8"}slice(U,da){return this.sliceBuffer(Q,U,da)}static fromTypedArray(U,da){return new Q(U.buffer,U.byteOffset,da,U.byteOffset+U.byteLength)}}Q.ElementType="i8";class O extends k.BufferViewScalarImpl{constructor(U,da=0,fa,ha){super(Int16Array,U,da,fa,ha);this.elementType="i16"}slice(U,da){return this.sliceBuffer(O,U,da)}static fromTypedArray(U,da){return new O(U.buffer,U.byteOffset,da,U.byteOffset+U.byteLength)}}O.ElementType="i16";class K extends p.BufferViewVec2Impl{constructor(U,
da=0,fa,ha){super(Int16Array,U,da,fa,ha);this.elementType="i16"}slice(U,da){return this.sliceBuffer(K,U,da)}static fromTypedArray(U,da){return new K(U.buffer,U.byteOffset,da,U.byteOffset+U.byteLength)}}K.ElementType="i16";class L extends h.BufferViewVec3Impl{constructor(U,da=0,fa,ha){super(Int16Array,U,da,fa,ha);this.elementType="i16"}slice(U,da){return this.sliceBuffer(L,U,da)}static fromTypedArray(U,da){return new L(U.buffer,U.byteOffset,da,U.byteOffset+U.byteLength)}}L.ElementType="i16";class P extends e.BufferViewVec4Impl{constructor(U,
da=0,fa,ha){super(Int16Array,U,da,fa,ha);this.elementType="i16"}slice(U,da){return this.sliceBuffer(P,U,da)}static fromTypedArray(U,da){return new P(U.buffer,U.byteOffset,da,U.byteOffset+U.byteLength)}}P.ElementType="i16";class R extends k.BufferViewScalarImpl{constructor(U,da=0,fa,ha){super(Int32Array,U,da,fa,ha);this.elementType="i32"}slice(U,da){return this.sliceBuffer(R,U,da)}static fromTypedArray(U,da){return new R(U.buffer,U.byteOffset,da,U.byteOffset+U.byteLength)}}R.ElementType="i32";class W extends p.BufferViewVec2Impl{constructor(U,
da=0,fa,ha){super(Int32Array,U,da,fa,ha);this.elementType="i32"}slice(U,da){return this.sliceBuffer(W,U,da)}static fromTypedArray(U,da){return new W(U.buffer,U.byteOffset,da,U.byteOffset+U.byteLength)}}W.ElementType="i32";class V extends h.BufferViewVec3Impl{constructor(U,da=0,fa,ha){super(Int32Array,U,da,fa,ha);this.elementType="i32"}slice(U,da){return this.sliceBuffer(V,U,da)}static fromTypedArray(U,da){return new V(U.buffer,U.byteOffset,da,U.byteOffset+U.byteLength)}}V.ElementType="i32";class ba extends e.BufferViewVec4Impl{constructor(U,
da=0,fa,ha){super(Int32Array,U,da,fa,ha);this.elementType="i32"}slice(U,da){return this.sliceBuffer(ba,U,da)}static fromTypedArray(U,da){return new ba(U.buffer,U.byteOffset,da,U.byteOffset+U.byteLength)}}ba.ElementType="i32";a.BufferViewFloat=g;a.BufferViewFloat64=t;a.BufferViewInt16=O;a.BufferViewInt32=R;a.BufferViewInt8=J;a.BufferViewMat3f=l;a.BufferViewMat3f64=w;a.BufferViewMat4f=x;a.BufferViewMat4f64=u;a.BufferViewUint16=A;a.BufferViewUint32=F;a.BufferViewUint8=v;a.BufferViewVec2f=d;a.BufferViewVec2f64=
m;a.BufferViewVec2i16=K;a.BufferViewVec2i32=W;a.BufferViewVec2i8=N;a.BufferViewVec2u16=C;a.BufferViewVec2u32=G;a.BufferViewVec2u8=y;a.BufferViewVec3f=f;a.BufferViewVec3f64=q;a.BufferViewVec3i16=L;a.BufferViewVec3i32=V;a.BufferViewVec3i8=M;a.BufferViewVec3u16=H;a.BufferViewVec3u32=D;a.BufferViewVec3u8=B;a.BufferViewVec4f=c;a.BufferViewVec4f64=r;a.BufferViewVec4i16=P;a.BufferViewVec4i32=ba;a.BufferViewVec4i8=Q;a.BufferViewVec4u16=E;a.BufferViewVec4u32=I;a.BufferViewVec4u8=z;Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/buffer/internals/Mat3":function(){define(["exports"],function(a){class b{constructor(n,k,p=0,h,e){this.TypedArrayConstructor=n;this.elementCount=9;n=this.TypedArrayConstructor;void 0===h&&(h=9*n.BYTES_PER_ELEMENT);const g=0===k.byteLength?0:p;this.typedBuffer=null==e?new n(k,g):new n(k,g,(e-p)/n.BYTES_PER_ELEMENT);this.typedBufferStride=h/n.BYTES_PER_ELEMENT;this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride);this.stride=
this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(n,k,p=this.count-k){k=this.typedBuffer.byteOffset+k*this.stride;return new n(this.buffer,k,this.stride,k+p*this.stride)}getMat(n,k){n*=this.typedBufferStride;for(let p=0;9>p;p++)k[p]=this.typedBuffer[n++];return k}setMat(n,k){n*=this.typedBufferStride;for(let p=0;9>p;p++)this.typedBuffer[n++]=k[p]}get(n,k){return this.typedBuffer[n*this.typedBufferStride+k]}set(n,k,p){this.typedBuffer[n*this.typedBufferStride+k]=p}copyFrom(n,
k,p){const h=this.typedBuffer,e=k.typedBuffer;n*=this.typedBufferStride;k=p*k.typedBufferStride;for(p=0;9>p;++p)h[n++]=e[k++]}get buffer(){return this.typedBuffer.buffer}}b.ElementCount=9;a.BufferViewMat3Impl=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/buffer/internals/Mat4":function(){define(["exports"],function(a){class b{constructor(n,k,p=0,h,e){this.TypedArrayConstructor=n;this.elementCount=16;n=this.TypedArrayConstructor;void 0===h&&(h=16*n.BYTES_PER_ELEMENT);
const g=0===k.byteLength?0:p;this.typedBuffer=null==e?new n(k,g):new n(k,g,(e-p)/n.BYTES_PER_ELEMENT);this.typedBufferStride=h/n.BYTES_PER_ELEMENT;this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride);this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(n,k,p=this.count-k){k=this.typedBuffer.byteOffset+k*this.stride;return new n(this.buffer,k,this.stride,k+p*this.stride)}getMat(n,k){n*=this.typedBufferStride;for(let p=0;16>p;p++)k[p]=this.typedBuffer[n++];
return k}setMat(n,k){n*=this.typedBufferStride;for(let p=0;16>p;p++)this.typedBuffer[n++]=k[p]}get(n,k){return this.typedBuffer[n*this.typedBufferStride+k]}set(n,k,p){this.typedBuffer[n*this.typedBufferStride+k]=p}copyFrom(n,k,p){this.copyFromTypedBuffer(n,k.typedBuffer,p*k.typedBufferStride)}copyFromTypedBuffer(n,k,p){const h=this.typedBuffer;n*=this.typedBufferStride;for(let e=0;16>e;++e)h[n++]=k[p++]}get buffer(){return this.typedBuffer.buffer}}b.ElementCount=16;a.BufferViewMat4Impl=b;Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/buffer/internals/Scalar":function(){define(["exports"],function(a){class b{constructor(n,k,p=0,h,e){this.TypedArrayConstructor=n;this.elementCount=1;n=this.TypedArrayConstructor;void 0===h&&(h=n.BYTES_PER_ELEMENT);const g=0===k.byteLength?0:p;this.typedBuffer=null==e?new n(k,g):new n(k,g,(e-p)/n.BYTES_PER_ELEMENT);this.stride=h;this.typedBufferStride=h/n.BYTES_PER_ELEMENT;this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride)}sliceBuffer(n,
k,p=this.count-k){k=this.typedBuffer.byteOffset+k*this.stride;return new n(this.buffer,k,this.stride,k+p*this.stride)}get(n){return this.typedBuffer[n*this.typedBufferStride]}set(n,k){this.typedBuffer[n*this.typedBufferStride]=k}get buffer(){return this.typedBuffer.buffer}}b.ElementCount=1;a.BufferViewScalarImpl=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/buffer/internals/Vec2":function(){define(["exports","../../../../core/libs/gl-matrix-2/math/vec2"],
function(a,b){class n{constructor(k,p,h=0,e,g){this.TypedArrayConstructor=k;this.elementCount=2;k=this.TypedArrayConstructor;void 0===e&&(e=2*k.BYTES_PER_ELEMENT);const d=0===p.byteLength?0:h;this.typedBuffer=null==g?new k(p,d):new k(p,d,(g-h)/k.BYTES_PER_ELEMENT);this.typedBufferStride=e/k.BYTES_PER_ELEMENT;this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride);this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(k,p,h=this.count-p){p=this.typedBuffer.byteOffset+
p*this.stride;return new k(this.buffer,p,this.stride,p+h*this.stride)}getVec(k,p){k*=this.typedBufferStride;return b.set(p,this.typedBuffer[k],this.typedBuffer[k+1])}setVec(k,p){k*=this.typedBufferStride;this.typedBuffer[k++]=p[0];this.typedBuffer[k]=p[1]}get(k,p){return this.typedBuffer[k*this.typedBufferStride+p]}set(k,p,h){this.typedBuffer[k*this.typedBufferStride+p]=h}setValues(k,p,h){k*=this.typedBufferStride;this.typedBuffer[k++]=p;this.typedBuffer[k]=h}copyFrom(k,p,h){const e=this.typedBuffer,
g=p.typedBuffer;k*=this.typedBufferStride;p=h*p.typedBufferStride;e[k++]=g[p++];e[k]=g[p]}get buffer(){return this.typedBuffer.buffer}}n.ElementCount=2;a.BufferViewVec2Impl=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/buffer/internals/Vec3":function(){define(["exports","../../../../chunks/vec32"],function(a,b){class n{constructor(k,p,h=0,e,g){this.TypedArrayConstructor=k;this.elementCount=3;k=this.TypedArrayConstructor;void 0===e&&(e=3*k.BYTES_PER_ELEMENT);
const d=0===p.byteLength?0:h;this.typedBuffer=null==g?new k(p,d):new k(p,d,(g-h)/k.BYTES_PER_ELEMENT);this.typedBufferStride=e/k.BYTES_PER_ELEMENT;this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride);this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(k,p,h=this.count-p){p=this.typedBuffer.byteOffset+p*this.stride;return new k(this.buffer,p,this.stride,p+h*this.stride)}getVec(k,p){k*=this.typedBufferStride;return b.set(p,this.typedBuffer[k],
this.typedBuffer[k+1],this.typedBuffer[k+2])}setVec(k,p){k*=this.typedBufferStride;this.typedBuffer[k++]=p[0];this.typedBuffer[k++]=p[1];this.typedBuffer[k]=p[2]}get(k,p){return this.typedBuffer[k*this.typedBufferStride+p]}set(k,p,h){this.typedBuffer[k*this.typedBufferStride+p]=h}setValues(k,p,h,e){k*=this.typedBufferStride;this.typedBuffer[k++]=p;this.typedBuffer[k++]=h;this.typedBuffer[k]=e}copyFrom(k,p,h){const e=this.typedBuffer,g=p.typedBuffer;k*=this.typedBufferStride;p=h*p.typedBufferStride;
e[k++]=g[p++];e[k++]=g[p++];e[k]=g[p]}get buffer(){return this.typedBuffer.buffer}}n.ElementCount=3;a.BufferViewVec3Impl=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/buffer/internals/Vec4":function(){define(["exports","../../../../chunks/vec42"],function(a,b){class n{constructor(k,p,h=0,e,g){this.TypedArrayConstructor=k;this.start=h;this.elementCount=4;k=this.TypedArrayConstructor;void 0===e&&(e=4*k.BYTES_PER_ELEMENT);const d=0===p.byteLength?0:h;this.typedBuffer=
null==g?new k(p,d):new k(p,d,(g-h)/k.BYTES_PER_ELEMENT);this.typedBufferStride=e/k.BYTES_PER_ELEMENT;this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride);this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(k,p,h=this.count-p){p=this.typedBuffer.byteOffset+p*this.stride;return new k(this.buffer,p,this.stride,p+h*this.stride)}getVec(k,p){k*=this.typedBufferStride;return b.set(p,this.typedBuffer[k++],this.typedBuffer[k++],this.typedBuffer[k++],
this.typedBuffer[k])}setVec(k,p){k*=this.typedBufferStride;this.typedBuffer[k++]=p[0];this.typedBuffer[k++]=p[1];this.typedBuffer[k++]=p[2];this.typedBuffer[k]=p[3]}get(k,p){return this.typedBuffer[k*this.typedBufferStride+p]}set(k,p,h){this.typedBuffer[k*this.typedBufferStride+p]=h}setValues(k,p,h,e,g){k*=this.typedBufferStride;this.typedBuffer[k++]=p;this.typedBuffer[k++]=h;this.typedBuffer[k++]=e;this.typedBuffer[k]=g}copyFrom(k,p,h){const e=this.typedBuffer,g=p.typedBuffer;k*=this.typedBufferStride;
p=h*p.typedBufferStride;e[k++]=g[p++];e[k++]=g[p++];e[k++]=g[p++];e[k]=g[p]}get buffer(){return this.typedBuffer.buffer}}n.ElementCount=4;a.BufferViewVec4Impl=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/buffer/types":function(){define(["exports"],function(a){a.elementTypeSize=function(b){switch(b){case "u8":return 1;case "u16":return 2;case "u32":return 4;case "i8":return 1;case "i16":return 2;case "i32":return 4;case "f32":return 4;case "f64":return 8}};
a.isInteger=function(b){switch(b){case "u8":case "u16":case "u32":case "i8":case "i16":case "i32":return!0;case "f32":case "f64":return!1}};a.isSigned=function(b){switch(b){case "u8":case "u16":case "u32":return!1;case "i8":case "i16":case "i32":case "f32":case "f64":return!0}};a.maximumValue=function(b){switch(b){case "u8":return 255;case "u16":return 65535;case "u32":return 4294967295;case "i8":return 127;case "i16":return 32767;case "i32":return 2147483647;case "f32":return 3.402823E38;case "f64":return 1.79769E308}};
Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl/RenderNode":function(){define("../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/Error ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/decorators/subclass ../webgl ../webgl-engine/lib/basicInterfaces".split(" "),function(a,b,n,k,p,h,e,g){b=class extends b{constructor(d){super(d);this.view=null;this.consumes={required:[]};this.produces=e.RenderCategory.COMPOSITE;
this.requireGeometryDepth=!1;this._dirty=!0}initialize(){this.addHandles([k.watch(()=>this.view.ready,d=>{d&&this.view._stage?.renderer.addRenderNode(this)},k.initial)])}destroy(){this.view._stage?.renderer?.removeRenderNode(this)}precompile(){}render(){throw new n("RenderNode:render-function-not-implemented","render() is not implemented.");}get camera(){return this.view.state.camera.clone()}get sunLight(){return this.bindParameters.lighting.legacy}get gl(){return this.view._stage.renderView.renderingContext.gl}acquireOutputFramebuffer(){var d=
this._frameBuffer?.getTexture()?.descriptor;d=this.view._stage.renderer.fboCache.acquire(d?.width??640,d?.height??480,this.produces);d.fbo?.initializeAndBind();return d}bindRenderTarget(){this._frameBuffer?.fbo?.initializeAndBind();return this._frameBuffer}requestRender(d){d===g.RenderRequestType.UPDATE&&this.view._stage?.renderView.requestRender(d);this._dirty=!0}resetWebGLState(){this.renderingContext.resetState();this.renderingContext.bindFramebuffer(this._frameBuffer?.fbo)}get fboCache(){return this.view._stage.renderer.fboCache}get bindParameters(){return this.renderContext.bind}get renderingContext(){return this.view._stage.renderView.renderingContext}get renderContext(){return this.view._stage?.renderer.renderContext}updateAnimation(d){return this._dirty?
(this._dirty=!1,!0):!1}doRender(d){this._frameBuffer=d.find(({name:f})=>f===this.produces);try{return this.render(d)}finally{this._frameBuffer=null}}};a.__decorate([p.property({constructOnly:!0})],b.prototype,"view",void 0);a.__decorate([p.property({constructOnly:!0})],b.prototype,"consumes",void 0);a.__decorate([p.property()],b.prototype,"produces",void 0);return b=a.__decorate([h.subclass("esri.views.3d.webgl.RenderNode")],b)})},"esri/views/3d/webgl-engine/lib/VertexArrayObject":function(){define(["exports",
"../../../webgl/VertexArrayObject"],function(a,b){class n extends b.VertexArrayObject{}a.VertexArrayObject=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/VertexArrayObject":function(){define("exports ../../core/Logger ../../core/maybe ../../core/typedArrayUtil ./enums ./Util".split(" "),function(a,b,n,k,p,h){const e=()=>b.getLogger("esri.views.webgl.VertexArrayObject");a.VertexArrayObject=class{constructor(g,d,f,c,l=null){this._context=g;this._locations=d;this._layout=
f;this._buffers=c;this._indexBuffer=l;this._glName=null;this._initialized=!1}get glName(){return this._glName}get context(){return this._context}get vertexBuffers(){return this._buffers}get indexBuffer(){return this._indexBuffer}get byteSize(){return Array.from(this._buffers.values()).reduce((g,d)=>g+d.usedMemory,null!=this._indexBuffer?this._indexBuffer.usedMemory:0)}get layout(){return this._layout}get locations(){return this._locations}get usedMemory(){return this.byteSize+(Object.keys(this._buffers).length+
(this._indexBuffer?1:0))*k.typedArrayStaticSize}dispose(){this._context?(this._context.getBoundVAO()===this&&this._context.bindVAO(null),this._buffers.forEach(g=>g.dispose()),this._buffers.clear(),this._indexBuffer=n.disposeMaybe(this._indexBuffer),this.disposeVAOOnly()):(this._glName||0<Object.getOwnPropertyNames(this._buffers).length)&&e().warn("Leaked WebGL VAO")}disposeVAOOnly(){this._glName&&(this._context.gl.deleteVertexArray(this._glName),this._glName=null,this._context.instanceCounter.decrement(p.ResourceType.VertexArrayObject,
this));this._context=null}initialize(){if(!this._initialized){var {gl:g}=this._context,d=g.createVertexArray();g.bindVertexArray(d);this._bindLayout();g.bindVertexArray(null);this._glName=d;this._context.instanceCounter.increment(p.ResourceType.VertexArrayObject,this);this._initialized=!0}}bind(){this.initialize();this._context.gl.bindVertexArray(this.glName)}_bindLayout(){const {_buffers:g,_layout:d,_indexBuffer:f}=this;g||e().error("Vertex buffer dictionary is empty!");const c=this._context.gl;
this._buffers.forEach((l,w)=>{(w=d.get(w))?h.bindVertexBufferLayout(this._context,this._locations,l,w):e().error("Vertex element descriptor is empty!")});null!=f&&c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,f.glName)}unbind(){this.initialize();this._context.gl.bindVertexArray(null)}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/weather":function(){define("exports ./CloudyWeather ./FoggyWeather ./RainyWeather ./SnowyWeather ./SunnyWeather".split(" "),function(a,
b,n,k,p,h){b={key:"type",base:h,typeMap:{sunny:h,cloudy:b,rainy:k,snowy:p,foggy:n}};const e=Object.keys(b.typeMap);a.cloudsHeight=1E5;a.heightLimit=1E4;a.validateWeatherType=function(g,d){return e.includes(g)?!0:(d.error(`"${g}" is not a valid weather type`),!1)};a.weatherTypes=b;a.weatherTypesArray=e;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/CloudyWeather":function(){define("../../../chunks/tslib.es6 ../../../core/JSONSupport ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/enumeration ../../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,n,k,p,h,e,g){var d;b=d=class extends b.JSONSupport{constructor(f){super(f);this.type="cloudy";this.cloudCover=.5}clone(){return new d({cloudCover:this.cloudCover})}};a.__decorate([e.enumeration({cloudy:"cloudy"})],b.prototype,"type",void 0);a.__decorate([n.property({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],b.prototype,"cloudCover",void 0);return b=d=a.__decorate([g.subclass("esri.views.3d.environment.CloudyWeather")],b)})},"esri/views/3d/environment/FoggyWeather":function(){define("../../../chunks/tslib.es6 ../../../core/JSONSupport ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/enumeration ../../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,n,k,p,h,e,g){var d;b=d=class extends b.JSONSupport{constructor(f){super(f);this.type="foggy";this.fogStrength=.5}clone(){return new d({fogStrength:this.fogStrength})}};a.__decorate([e.enumeration({foggy:"foggy"})],b.prototype,"type",void 0);a.__decorate([n.property({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],b.prototype,"fogStrength",void 0);return b=d=a.__decorate([g.subclass("esri.views.3d.environment.FoggyWeather")],b)})},"esri/views/3d/environment/RainyWeather":function(){define("../../../chunks/tslib.es6 ../../../core/JSONSupport ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/enumeration ../../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,n,k,p,h,e,g){var d;b=d=class extends b.JSONSupport{constructor(f){super(f);this.type="rainy";this.precipitation=this.cloudCover=.5}clone(){return new d({cloudCover:this.cloudCover,precipitation:this.precipitation})}};a.__decorate([e.enumeration({rainy:"rainy"})],b.prototype,"type",void 0);a.__decorate([n.property({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],b.prototype,"cloudCover",void 0);a.__decorate([n.property({type:Number,nonNullable:!0,range:{min:0,max:1},
json:{write:!0}})],b.prototype,"precipitation",void 0);return b=d=a.__decorate([g.subclass("esri.views.3d.environment.RainyWeather")],b)})},"esri/views/3d/environment/SnowyWeather":function(){define("../../../chunks/tslib.es6 ../../../core/JSONSupport ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/enumeration ../../../core/accessorSupport/decorators/subclass".split(" "),function(a,b,n,k,p,h,
e,g){var d;b=d=class extends b.JSONSupport{constructor(f){super(f);this.type="snowy";this.precipitation=this.cloudCover=.5;this.snowCover="disabled"}clone(){return new d({cloudCover:this.cloudCover,precipitation:this.precipitation,snowCover:this.snowCover})}};a.__decorate([e.enumeration({snowy:"snowy"})],b.prototype,"type",void 0);a.__decorate([n.property({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],b.prototype,"cloudCover",void 0);a.__decorate([n.property({type:Number,nonNullable:!0,
range:{min:0,max:1},json:{write:!0}})],b.prototype,"precipitation",void 0);a.__decorate([n.property({type:["enabled","disabled"],nonNullable:!0,json:{write:!0}})],b.prototype,"snowCover",void 0);return b=d=a.__decorate([g.subclass("esri.views.3d.environment.SnowyWeather")],b)})},"esri/views/3d/environment/SunnyWeather":function(){define("../../../chunks/tslib.es6 ../../../core/JSONSupport ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/enumeration ../../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,n,k,p,h,e,g){var d;b=d=class extends b.JSONSupport{constructor(f){super(f);this.type="sunny";this.cloudCover=.5}clone(){return new d({cloudCover:this.cloudCover})}};a.__decorate([e.enumeration({sunny:"sunny"})],b.prototype,"type",void 0);a.__decorate([n.property({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],b.prototype,"cloudCover",void 0);return b=d=a.__decorate([g.subclass("esri.views.3d.environment.SunnyWeather")],b)})},"esri/views/3d/webgl-engine/effects/RenderPlugin":function(){define(["exports",
"../../../../core/Accessor","../core/shaderLibrary/ShaderOutput"],function(a,b,n){function k(d){Array.isArray(d)?d.forEach(f=>f?.release()):d?.release()}const p={required:[]};n={required:[n.ShaderOutput.Depth]};class h extends b{precompile(d){d=this.acquireTechniques(d);k(d);return null!=d}consumes(){return p}get usedMemory(){return 0}get isDecoration(){return!1}get running(){return!1}modify(d){}get numGeometries(){return 0}get hasOccludees(){return!1}get hasEmissions(){return!1}forEachGeometry(d){}queryRenderOccludedState(d){return!1}}
class e extends h{}class g extends h{}a.AsyncRenderPlugin=g;a.ConsumesDepth=n;a.ConsumesNone=p;a.SyncRenderPlugin=e;a.releaseTechniques=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/ShaderOutput":function(){define(["exports"],function(a){function b(l){return l===a.ShaderOutput.Highlight||l===a.ShaderOutput.ObjectAndLayerIdColor}function n(l){return l===a.ShaderOutput.Color}function k(l){return n(l)||c(l)}function p(l){return n(l)||
l===a.ShaderOutput.Highlight}function h(l){return n(l)||b(l)}function e(l){return k(l)||b(l)}function g(l){return h(l)||f(l)}function d(l){return e(l)||f(l)}function f(l){return l===a.ShaderOutput.Depth}function c(l){return l===a.ShaderOutput.ColorEmission}a.ShaderOutput=void 0;(function(l){l[l.Color=0]="Color";l[l.ColorEmission=1]="ColorEmission";l[l.Depth=2]="Depth";l[l.Normal=3]="Normal";l[l.Shadow=4]="Shadow";l[l.ShadowHighlight=5]="ShadowHighlight";l[l.ShadowExcludeHighlight=6]="ShadowExcludeHighlight";
l[l.ViewshedShadow=7]="ViewshedShadow";l[l.Highlight=8]="Highlight";l[l.ObjectAndLayerIdColor=9]="ObjectAndLayerIdColor";l[l.COUNT=10]="COUNT"})(a.ShaderOutput||(a.ShaderOutput={}));a.is2DGeometryOutput=function(l){return n(l)||b(l)};a.is3DGeometryOutput=function(l){return g(l)||l===a.ShaderOutput.Normal};a.is3DGeometryOutputMRT=function(l){return d(l)||l===a.ShaderOutput.Normal};a.isColor=n;a.isColorEmission=c;a.isColorEmissionHighlightOIDOrDepth=d;a.isColorEmissionHighlightOrOID=e;a.isColorHighlightOIDOrDepth=
g;a.isColorHighlightOrDepth=function(l){return p(l)||f(l)};a.isColorHighlightOrOID=h;a.isColorOrColorEmission=k;a.isColorOrHighlight=p;a.isColorOrOID=function(l){return n(l)||l===a.ShaderOutput.ObjectAndLayerIdColor};a.isDepth=f;a.isHighlightOrOID=b;a.isShadowRelatedOutput=function(l){return l===a.ShaderOutput.Shadow||l===a.ShaderOutput.ShadowHighlight||l===a.ShaderOutput.ShadowExcludeHighlight||l===a.ShaderOutput.ViewshedShadow};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/sunUtils":function(){define("exports ../../../core/mathUtils ../../../core/libs/gl-matrix-2/math/mat4 ../../../core/libs/gl-matrix-2/factories/mat4f64 ../../../core/libs/gl-matrix-2/math/vec2 ../../../core/libs/gl-matrix-2/factories/vec2f64 ../../../chunks/vec32 ../../../core/libs/gl-matrix-2/factories/vec3f64 ../../ViewingMode ../../../chunks/SunCalc ./mathUtils".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c){function l(P,R,W){R===d.ViewingMode.Global?e.normalize(O,P.eye):e.set(O,0,0,1);e.scale(K,P.viewForward,-1);R=c.angle(K,O);const V=Math.max(R-.5,0);n.fromRotation(Q,-Math.max(.25,R-.25-.85*V/(V+1)),P.viewRight);e.transformMat4(W,K,Q);e.add(W,W,e.scale(L,P.viewRight,.2));e.normalize(W,W)}function w(P,R,W,V){const ba=y,U=n.identity(v);if(W===d.ViewingMode.Global)f.SunCalc.getPosition(P,0,0,ba),e.set(V,0,0,-1),n.rotateX(U,U,-ba.azimuth),n.rotateY(U,U,-ba.altitude);else{var da=
t.planarDirection;W=da.globalAngles;da=(Math.abs(R[2])-da.localAltitude)/(da.globalAltitude-da.localAltitude);da=b.clamp(da,0,1);1>da?(f.SunCalc.getPosition(P,R[1],R[0],ba),ba.azimuth=(1-da)*ba.azimuth+da*W.azimuth,ba.altitude=(1-da)*ba.altitude+da*W.altitude):(ba.azimuth=W.azimuth,ba.altitude=W.altitude);e.set(V,0,-1,0);n.rotateZ(U,U,-ba.azimuth);n.rotateX(U,U,-ba.altitude)}e.transformMat4(V,V,U)}function x(P){switch(P){case "disabled":case "sunny":return new m(1,1);case "cloudy":return new m(1,
1);case "rainy":return new m(.4,1.2);case "snowy":return new m(.5,1.3);case "foggy":return new m(.2,1.6)}}function u(P,R){const W=(P[0]+P[1]+P[2])/3;P[0]+=(W-P[0])*R;P[1]+=(W-P[1])*R;P[2]+=(W-P[2])*R}const t={local:{altitude:1500,ambientAtNight:.1,ambientAtNoon:.45,ambientAtTwilight:.2,directAtNoon:.65,directAtTwilight:.7},global:{altitude:8E5,ambient:.015,direct:.75},planarDirection:{localAltitude:1E4,globalAltitude:1E6,globalAngles:{azimuth:1.3*Math.PI,altitude:.6*Math.PI}}};class m{constructor(P,
R){this.direct=P;this.ambient=R}}const q=g.fromValues(.5773502691896258,-.5773502691896258,.5773502691896258);class r{constructor(){this.ambient={color:g.fromValues(1,1,1),intensity:.55};this.direct={color:g.fromValues(1,1,1),intensity:.55,directionToLightSource:g.clone(q)};this.noonFactor=.5;this.globalFactor=0;this.environmentStrength=this.specularStrength=1}}const v=k.create(),y={azimuth:0,altitude:0},B=g.fromValues(.01,.01,.01),z=g.fromValues(1,.6,.5),A=g.fromValues(1,.98,.98),C=g.fromValues(1,
1,1),H=g.fromValues(.8,.8,1),E=g.fromValues(.8,.8,1),F=g.fromValues(.98,.98,1),G=g.fromValues(1,1,1),D=h.fromValues(.01,t.local.ambientAtNight),I=h.fromValues(t.local.directAtTwilight,t.local.ambientAtTwilight),J=h.fromValues(.9*t.local.directAtNoon,t.local.ambientAtNoon),N=h.fromValues(t.local.directAtNoon,t.local.ambientAtNoon),M=new Date(0),Q=k.create(),O=g.create(),K=g.create(),L=g.create();a.ColorAndIntensity=r;a.computeColorAndIntensity=function(P,R,W,V,ba,U){e.set(U.ambient.color,1,1,1);U.ambient.intensity=
t.global.ambient;e.set(U.direct.color,1,1,1);U.direct.intensity=t.global.direct;var da=b.clamp((Math.abs(R[2])-t.local.altitude)/(t.global.altitude-t.local.altitude),0,1);U.globalFactor=da;var fa;null!=P&&(fa=f.SunCalc.getTimes(P,R[1],R[0]));if(1>da){if(null!=P){var ha=fa;var T=P.valueOf();if(ha.polarException===f.SunCalc.PolarException.MIDNIGHT_SUN){var S=T-36E5*(P.getHours()+48)-6E4*P.getMinutes();ha=S+432E6}else ha.polarException===f.SunCalc.PolarException.POLAR_NIGHT?(S=T-2,ha=T-1):(S=ha.sunrise.valueOf(),
ha=ha.sunset.valueOf());var Z=ha-S;var ia=S+Z/2,Y=Z/4;const ea=ia-Y;Y=ia+Y;Z*=.06;const ka=S-Z/2,ja=S+Z/2,X=ha-Z/2,aa=ha+Z/2;S=h.create();Z=g.create();ha=g.create();T<ka||T>aa?(p.copy(S,D),e.copy(Z,B),e.copy(ha,H)):T<ja?(T=(T-ka)/(ja-ka),p.lerp(S,D,I,T),e.lerp(Z,B,z,T),e.lerp(ha,H,E,T)):T<ea?(T=(T-ja)/(ea-ja),p.lerp(S,I,J,T),e.lerp(Z,z,A,T),e.lerp(ha,E,F,T)):T<ia?(T=(T-ea)/(ia-ea),p.lerp(S,J,N,T),e.lerp(Z,A,C,T),e.lerp(ha,F,G,T)):T<Y?(T=(T-ia)/(Y-ia),p.lerp(S,N,J,T),e.lerp(Z,C,A,T),e.lerp(ha,G,F,
T)):T<X?(T=(T-Y)/(X-Y),p.lerp(S,J,I,T),e.lerp(Z,A,z,T),e.lerp(ha,F,E,T)):T<aa&&(T=(T-X)/(aa-X),p.lerp(S,I,D,T),e.lerp(Z,z,B,T),e.lerp(ha,E,H,T));T=0;switch(V){case "rainy":case "foggy":T=.8;break;case "snowy":T=.5}0<T&&(u(Z,T),u(ha,T));ia=x(V);T=S[0]*ia.direct;S=S[1]*ia.ambient}else ha=x(V),T=t.local.directAtNoon*ha.direct,Z=g.fromValues(1,1,1),S=t.local.ambientAtNoon*ha.ambient,ha=g.fromValues(1,1,1);e.lerp(U.ambient.color,ha,U.ambient.color,da);U.ambient.intensity=b.lerp(S,U.ambient.intensity,da);
e.lerp(U.direct.color,Z,U.direct.color,da);U.direct.intensity=b.lerp(T,U.direct.intensity,da);U.specularStrength="rainy"===V||"snowy"===V||"foggy"===V?0:1;U.environmentStrength="rainy"===V?.7:"snowy"===V||"foggy"===V?.75:1}null!=P?(V=P.valueOf(),fa.polarException===f.SunCalc.PolarException.MIDNIGHT_SUN?(da=V-36E5*(P.getHours()+48)-6E4*P.getMinutes(),fa=da+432E6):fa.polarException===f.SunCalc.PolarException.POLAR_NIGHT?(da=V-2,fa=V-1):(da=fa.sunrise.valueOf(),fa=fa.sunset.valueOf()),V=1-b.clamp(Math.abs(V-
(da+(fa-da)/2))/432E5,0,1)):V=1;U.noonFactor=V;null!=P?w(P,R,W,U.direct.directionToLightSource):l(ba,W,U.direct.directionToLightSource)};a.computeDirectionsOverTime=function(P,R,W,V,ba){P=P.getTime();R=R.getTime()-P;R=Math.floor(R/W)+1;const U=Array(R);for(let da=0;da<R;++da)M.setTime(P+W*da),U[da]=g.create(),w(M,V,ba,U[da]);return U};a.computeShadowsEnabled=function(P,R){return R===d.ViewingMode.Global?!0:Math.abs(P)<t.planarDirection.localAltitude};a.computeVirtualLightDirection=l;Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/chunks/SunCalc":function(){define(["exports"],function(a){function b(z){return new Date(864E5*(z+.5-2440588))}function n(z,A){return t(l(z)*w(v)-x(A)*l(v),w(z))}function k(z,A){return u(l(A)*w(v)+w(A)*l(v)*l(z))}function p(z,A,C){return t(l(z),w(z)*l(A)-x(C)*w(A))}function h(z,A,C){return u(l(A)*l(C)+w(A)*w(C)*w(z))}function e(z){return q*(1.9148*l(z)+.02*l(2*z)+3E-4*l(3*z))}function g(z,A){z=q*(357.5291+.98560028*z);var C=e(z);z=z+C+102.9372*q+c;A||=
{dec:0,ra:0};A.dec=k(z,0);A.ra=n(z,0);return A}function d(z,A,C){return 2451545+z+.0053*l(A)-.0069*l(2*C)}function f(z){var A=q*(134.963+13.064993*z),C=q*(93.272+13.22935*z);z=q*(218.316+13.176396*z)+6.289*q*l(A);C=5.128*q*l(C);A=385001-20905*w(A);return{ra:n(z,C),dec:k(z,C),dist:A}}var c=Math.PI,l=Math.sin,w=Math.cos,x=Math.tan,u=Math.asin,t=Math.atan2,m=Math.acos,q=c/180,r={dec:0,ra:0},v=23.4397*q,y={PolarException:{NORMAL:0,MIDNIGHT_SUN:1,POLAR_NIGHT:2},getPosition:function(z,A,C,H){C=q*-C;A*=
q;var E=z.valueOf()/864E5-.5+2440588-2451545;z=g(E,r);C=q*(280.16+360.9856235*E)-C-z.ra;H||={azimuth:0,altitude:0};H.azimuth=p(C,A,z.dec);H.altitude=h(C,A,z.dec);return H}},B=[[-.83,"sunrise","sunset"]];y.addTime=function(z,A,C){B.push([z,A,C])};y.getTimes=function(z,A,C){function H(K){var L=F,P=J;K=m((l(K)-l(L)*l(P))/(w(L)*w(P)));return d(9E-4+(K+E)/(2*c)+G,D,I)}var E=q*-C,F=q*A,G=Math.round(z.valueOf()/864E5-.5+2440588-2451545-9E-4-E/(2*c));z=9E-4+(0+E)/(2*c)+G;var D=q*(357.5291+.98560028*z);A=
e(D);var I=D+A+102.9372*q+c,J=k(I,0);z=d(z,D,I);A={solarNoon:b(z),nadir:b(z-.5),polarException:y.PolarException.NORMAL};var N;C=0;for(N=B.length;C<N;C+=1){var M=B[C];var Q=H(M[0]*q);var O=z-(Q-z);A[M[1]]=b(O);A[M[2]]=b(Q)}A.polarException=function(K){K=(l(K)-l(F)*l(J))/(w(F)*w(J));return-1>K?y.PolarException.MIDNIGHT_SUN:1<K?y.PolarException.POLAR_NIGHT:y.PolarException.NORMAL}(B[0][0]*q);return A};y.getMoonPosition=function(z,A,C){C=q*-C;A*=q;var H=z.valueOf()/864E5-.5+2440588-2451545;z=f(H);C=q*
(280.16+360.9856235*H)-C-z.ra;H=h(C,A,z.dec);H+=.017*q/x(H+10.26*q/(H+5.1*q));return{azimuth:p(C,A,z.dec),altitude:H,distance:z.dist}};y.getMoonFraction=function(z){var A=z.valueOf()/864E5-.5+2440588-2451545;z=g(A);A=f(A);z=m(l(z.dec)*l(A.dec)+w(z.dec)*w(A.dec)*w(z.ra-A.ra));z=t(149598E3*l(z),A.dist-149598E3*w(z));return(1+w(z))/2};a.SunCalc=y})},"esri/views/3d/webgl-engine/lib/Update":function(){define(["exports"],function(a){a.Update=void 0;var b=a.Update||(a.Update={});b[b.Immediate=0]="Immediate";
b[b.FadeWithWeather=1]="FadeWithWeather";Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lighting/Lightsources":function(){define(["exports","../../../../core/libs/gl-matrix-2/factories/vec3f64"],function(a,b){class n{constructor(e=b.zeros()){this.intensity=e}}class k{constructor(e=b.zeros(),g=b.fromValues(.57735,.57735,.57735)){this.intensity=e;this.direction=g}}class p{constructor(e=b.zeros(),g=b.fromValues(.57735,.57735,.57735),d=!0,f=1,c=1){this.intensity=
e;this.direction=g;this.castShadows=d;this.specularStrength=f;this.environmentStrength=c}}class h{constructor(){this.r=[0];this.g=[0];this.b=[0]}}a.AmbientLight=n;a.FillLight=k;a.MainLight=p;a.SphericalHarmonicsAmbientLight=h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/SceneViewEnvironment":function(){define("../../../chunks/tslib.es6 ../../../core/compilerUtils ../../../core/handleUtils ../../../core/lang ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/decorators/cast ../../../core/accessorSupport/decorators/subclass ../../../core/accessorSupport/ensureType ./lightingUtils ./SunLighting ./VirtualLighting ../../../webscene/Environment ../../../webscene/SunLighting ../../../webscene/VirtualLighting".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w,x){var u;l=u=class extends l{constructor(t){super(t);this.lighting=this.castLighting();this.cachedCameraTrackingEnabled=null}static fromWebsceneEnvironment(t){t=t.cloneConstructProperties();return new u({...t,lighting:t.lighting?"virtual"===t.lighting.type?c.fromWebsceneLighting(t.lighting):f.fromWebsceneLighting(t.lighting):void 0})}castLighting(t){return this._convertLightingWithDestroy(t)}applyLighting(t){this.lighting=this._convertLightingWithDestroy(t)}_convertLightingWithDestroy(t){const m=
this._convertLighting(t);m!==t&&this.addHandles(n.destroyHandle(m));return m}_convertLighting(t){return t?t instanceof f||t instanceof c?t:t instanceof w?this.lighting&&"virtual"!==this.lighting.type?this.lighting.cloneWithWebsceneLighting(t):new f({...t.cloneConstructProperties(),...this.lighting?.cloneNonPersistentConstructProperties()}):t instanceof x?this.lighting&&"virtual"===this.lighting.type?this.lighting.cloneWithWebsceneLighting(t):new c({...t.cloneConstructProperties(),...this.lighting?.cloneNonPersistentConstructProperties()}):
g.ensureOneOfType(d.lightingTypes,t):new f}clone(){return new u({lighting:this.lighting.clone(),weather:this.weather.clone(),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,background:k.clone(this.background)})}cloneWithWebsceneEnvironment(t){return new u({weather:this.weather.clone(),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,background:k.clone(this.background),...t.cloneConstructProperties(),lighting:this._getLighting(t)})}_getLighting(t){switch(t.lighting.type){case "sun":return this.lighting&&
"sun"===this.lighting.type?this.lighting.cloneWithWebsceneLighting(t.lighting):f.fromWebsceneLighting(t.lighting);case "virtual":return this.lighting&&"virtual"===this.lighting.type?this.lighting.cloneWithWebsceneLighting(t.lighting):c.fromWebsceneLighting(t.lighting);default:return b.neverReached(t.lighting),f.fromWebsceneLighting(t.lighting)}}};a.__decorate([p.property({nonNullable:!0})],l.prototype,"lighting",void 0);a.__decorate([h.cast("lighting")],l.prototype,"castLighting",null);return l=u=
a.__decorate([e.subclass("esri.views.3d.environment.SceneViewEnvironment")],l)})},"esri/views/3d/environment/lightingUtils":function(){define(["exports","./SunLighting","./VirtualLighting"],function(a,b,n){a.lightingTypes={key:"type",defaultKeyValue:"sun",base:null,typeMap:{sun:b,virtual:n}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/SunLighting":function(){define("../../../chunks/tslib.es6 ../../../core/Evented ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ../../../webscene/SunLighting".split(" "),
function(a,b,n,k,p,h,e,g){var d;b=d=class extends b.EventedMixin(g){constructor(c){super(c);this.cameraTrackingEnabled=!0;this.positionTimezoneInfo={hours:0,minutes:0,seconds:0,autoUpdated:!0};c=(new Date).getFullYear();c=new Date("March 15, "+c+" 12:00:00 UTC");this._set("defaultDate",c);this._set("date",c)}get defaultDate(){return new Date(this._get("defaultDate").getTime())}static fromWebsceneLighting(c){return new d(c.cloneConstructProperties())}set defaultDate(c){const l=this._get("date")===
this._get("defaultDate");c=new Date(c.getTime());this._set("defaultDate",c);l&&this._set("date",c)}set date(c){null!=c&&(this.positionTimezoneInfo.autoUpdated=!1,this._set("date",new Date(c.getTime())))}autoUpdate(c,l){const w=d.calculateTimezoneOffset(this.positionTimezoneInfo);this.positionTimezoneInfo.hours=l.hours;this.positionTimezoneInfo.minutes=l.minutes;this.positionTimezoneInfo.seconds=l.seconds;l=null;null!=c&&(this.positionTimezoneInfo.autoUpdated=!0,isNaN(c.getTime())?(l=this.defaultDate.getTime(),
this._set("date",this.defaultDate)):(l=this.date&&this.date.getTime(),this._set("date",new Date(c.getTime()))));const x=d.calculateTimezoneOffset(this.positionTimezoneInfo);w!==x&&(f.target=this,f.timezoneOffset=x,this.emit("timezone-will-change",f),f.target=null);if(null!=c)return isNaN(c.getTime())||l!==c.getTime()}clone(){const c=this._get("date")===this._get("defaultDate"),l=new d({...this.cloneConstructProperties(),defaultDate:this.defaultDate,cameraTrackingEnabled:this.cameraTrackingEnabled});
c&&l._set("date",l._get("defaultDate"));l.positionTimezoneInfo.autoUpdated=this.positionTimezoneInfo.autoUpdated;l.positionTimezoneInfo.hours=this.positionTimezoneInfo.hours;l.positionTimezoneInfo.minutes=this.positionTimezoneInfo.minutes;l.positionTimezoneInfo.seconds=this.positionTimezoneInfo.seconds;return l}cloneWithWebsceneLighting(c){const l=this.clone();null!=c.date&&(l.date=c.date);l.directShadowsEnabled=c.directShadowsEnabled;l.displayUTCOffset=c.displayUTCOffset;return l}cloneNonPersistentConstructProperties(){return{cameraTrackingEnabled:this.cameraTrackingEnabled}}};
a.__decorate([n.property({type:Boolean})],b.prototype,"cameraTrackingEnabled",void 0);a.__decorate([n.property({type:Date})],b.prototype,"defaultDate",null);a.__decorate([n.property({type:Date})],b.prototype,"date",null);b=d=a.__decorate([e.subclass("esri.views.3d.environment.SunLighting")],b);(function(c){c.calculateTimezoneOffset=function({hours:l,minutes:w,seconds:x}){return Math.round(l+w/60+x/3600)}})(b||={});const f={target:null,timezoneOffset:0};return b})},"esri/webscene/SunLighting":function(){define("../chunks/tslib.es6 ../core/JSONSupport ../core/accessorSupport/decorators/property ../core/has ../core/Logger ../core/RandomLCG ../core/accessorSupport/decorators/reader ../core/accessorSupport/decorators/subclass ../core/accessorSupport/decorators/writer".split(" "),
function(a,b,n,k,p,h,e,g,d){var f;b=f=class extends b.JSONSupport{constructor(c){super(c);this.type="sun";this.date=null;this.directShadowsEnabled=!1;this.displayUTCOffset=null}readDate(c,l){return null!=l.datetime&&new Date(l.datetime)||null}writeDate(c,l,w){l[w]=c.getTime()}readDirectShadowsEnabled(c,l){return!!l.directShadows}writedirectShadowsEnabled(c,l,w){c&&(l[w]=c)}writeDisplayUTCOffset(c,l){null!=c&&(l.displayUTCOffset=c)}clone(){return new f(this.cloneConstructProperties())}cloneConstructProperties(){const c=
{directShadowsEnabled:this.directShadowsEnabled,displayUTCOffset:null!=this.displayUTCOffset?this.displayUTCOffset:null};null!=this.date&&(c.date=new Date(this.date.getTime()));return c}};a.__decorate([n.property({readOnly:!0,type:["sun"],json:{write:!0}})],b.prototype,"type",void 0);a.__decorate([n.property({type:Date,json:{type:Number,write:{target:"datetime"}}})],b.prototype,"date",void 0);a.__decorate([e.reader("date",["datetime"])],b.prototype,"readDate",null);a.__decorate([d.writer("date")],
b.prototype,"writeDate",null);a.__decorate([n.property({type:Boolean,json:{default:!1,write:{target:"directShadows"}}})],b.prototype,"directShadowsEnabled",void 0);a.__decorate([e.reader("directShadowsEnabled",["directShadows"])],b.prototype,"readDirectShadowsEnabled",null);a.__decorate([d.writer("directShadowsEnabled")],b.prototype,"writedirectShadowsEnabled",null);a.__decorate([n.property({type:Number,json:{write:!0}})],b.prototype,"displayUTCOffset",void 0);a.__decorate([d.writer("displayUTCOffset")],
b.prototype,"writeDisplayUTCOffset",null);return b=f=a.__decorate([g.subclass("esri.webscene.SunLighting")],b)})},"esri/views/3d/environment/VirtualLighting":function(){define("../../../chunks/tslib.es6 ../../../core/Evented ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ../../../webscene/VirtualLighting".split(" "),function(a,b,n,k,p,h,e,g){var d;b=d=class extends b.EventedMixin(g){constructor(f){super(f);
this.cameraTrackingEnabled=!0}clone(){return new d({...this.cloneConstructProperties(),cameraTrackingEnabled:this.cameraTrackingEnabled})}static fromWebsceneLighting(f){return new d(f.cloneConstructProperties())}cloneWithWebsceneLighting(f){const c=this.clone();c.directShadowsEnabled=f.directShadowsEnabled;return c}cloneNonPersistentConstructProperties(){return{cameraTrackingEnabled:this.cameraTrackingEnabled}}};a.__decorate([n.property({type:Boolean})],b.prototype,"cameraTrackingEnabled",void 0);
return b=d=a.__decorate([e.subclass("esri.views.3d.environment.VirtualLighting")],b)})},"esri/webscene/VirtualLighting":function(){define("../chunks/tslib.es6 ../core/JSONSupport ../core/accessorSupport/decorators/property ../core/has ../core/Logger ../core/RandomLCG ../core/accessorSupport/decorators/subclass".split(" "),function(a,b,n,k,p,h,e){var g;b=g=class extends b.JSONSupport{constructor(d){super(d);this.type="virtual";this.directShadowsEnabled=!1}clone(){return new g(this.cloneConstructProperties())}cloneConstructProperties(){return{directShadowsEnabled:this.directShadowsEnabled}}};
a.__decorate([n.property({readOnly:!0,type:["virtual"],json:{write:!0}})],b.prototype,"type",void 0);a.__decorate([n.property({type:Boolean,json:{default:!1,name:"directShadows",write:!0}})],b.prototype,"directShadowsEnabled",void 0);return b=g=a.__decorate([e.subclass("esri.webscene.VirtualLighting")],b)})},"esri/webscene/Environment":function(){define("../chunks/tslib.es6 ../core/JSONSupport ../core/lang ../core/Logger ../core/accessorSupport/decorators/property ../core/has ../core/accessorSupport/decorators/subclass ../views/3d/environment/SunnyWeather ../views/3d/environment/weather ./lightingTypes ./SunLighting ./VirtualLighting ./background/utils".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w){var x;h=(u,t,m)=>({enabled:!m?.isPresentation});b=x=class extends b.JSONSupport{constructor(u){super(u);this.lighting=new c;this.background=null;this.starsEnabled=this.atmosphereEnabled=!0}set weather(u){d.validateWeatherType(u?.type,k.getLogger(this))&&this._set("weather",u)}clone(){return new x(this.cloneConstructProperties())}cloneConstructProperties(){return{lighting:this.lighting&&"virtual"===this.lighting.type?l.prototype.clone.call(this.lighting):c.prototype.clone.call(this.lighting),
background:n.clone(this.background),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,weather:this.weather.clone()}}};a.__decorate([p.property({types:f.lightingTypes,nonNullable:!0,json:{write:!0}})],b.prototype,"lighting",void 0);a.__decorate([p.property(w.backgroundProperty)],b.prototype,"background",void 0);a.__decorate([p.property({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:h}}})],b.prototype,"atmosphereEnabled",void 0);a.__decorate([p.property({type:Boolean,
nonNullable:!0,json:{write:{overridePolicy:h}}})],b.prototype,"starsEnabled",void 0);a.__decorate([p.property({types:d.weatherTypes,nonNullable:!0,json:{write:!0},value:new g})],b.prototype,"weather",null);return b=x=a.__decorate([e.subclass("esri.webscene.Environment")],b)})},"esri/webscene/lightingTypes":function(){define(["exports","./SunLighting","./VirtualLighting"],function(a,b,n){a.lightingTypes={key:"type",defaultKeyValue:"sun",base:null,typeMap:{sun:b,virtual:n}};Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/webscene/background/utils":function(){define(["exports","./Background","./ColorBackground"],function(a,b,n){b={base:b,key:"type",typeMap:{color:n}};b={types:b,json:{read:function(k){return(p,h,e)=>{if(!p)return p;for(const g in k.typeMap)if(p.type===g)return h=new k.typeMap[g],h.read(p,e),h}}(b),write:{overridePolicy:(k,p,h)=>({enabled:!h?.isPresentation})}}};a.backgroundProperty=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/webscene/background/Background":function(){define("../../chunks/tslib.es6 ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/has ../../core/Logger ../../core/RandomLCG ../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,n,k,p,h,e){b=class extends b.JSONSupport{constructor(g){super(g)}clone(){throw Error("Subclasses of Background should implement their own clone method.");}};a.__decorate([n.property({readOnly:!0,json:{read:!1}})],b.prototype,"type",void 0);return b=a.__decorate([e.subclass("esri.webscene.background.Background")],b)})},"esri/webscene/background/ColorBackground":function(){define("../../chunks/tslib.es6 ../../Color ../../core/accessorSupport/decorators/property ../../core/has ../../core/Logger ../../core/RandomLCG ../../core/accessorSupport/decorators/enumeration ../../core/accessorSupport/decorators/subclass ../../symbols/support/materialUtils ./Background".split(" "),
function(a,b,n,k,p,h,e,g,d,f){var c;k={...d.colorAndTransparencyProperty,nonNullable:!0};f=c=class extends f{constructor(l){super(l);this.type="color";this.color=new b([0,0,0,1])}clone(){return new c(this.cloneProperties())}cloneProperties(){return{color:this.color.clone()}}};a.__decorate([e.enumeration({color:"color"},{readOnly:!0})],f.prototype,"type",void 0);a.__decorate([n.property(k)],f.prototype,"color",void 0);return f=c=a.__decorate([g.subclass("esri.webscene.background.ColorBackground")],
f)})},"esri/views/3d/input/SceneInputManager":function(){define("../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/has ../../../core/maybe ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ./handlers/DoubleClickZoom ./handlers/DragRotate ./handlers/DragZoom ./handlers/GamepadNavigation ./handlers/KeyboardNavigation ./handlers/MouseWheelZoom ./handlers/PinchAndPanNavigation ./handlers/PointerDownCancelAnimation ./handlers/SingleKeyResetHeading ./handlers/SingleKeyResetTilt ./handlers/TwoFingerTilt ../../input/BrowserEventSource ../../input/InputManager ../../input/handlers/PreventContextMenu ../../input/recognizers/Drag ../../input/recognizers/ImmediateDoubleClick ../../input/recognizers/PointerClickHoldAndDrag ../../input/recognizers/SingleAndDoubleClick ../../input/recognizers/VerticalTwoFingerDrag ../state/controllers/RotateController".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w,x,u,t,m,q,r,v,y,B,z,A,C,H,E,F,G){b=class extends b{destroy(){this.disconnect()}get primaryDragAction(){return this._get("primaryDragAction")}set primaryDragAction(I){"pan"!==I&&"rotate"!==I||I===this._get("primaryDragAction")||(this._set("primaryDragAction",I),this._updateMode())}get mode(){return this._get("mode")}set mode(I){"default"!==I&&"pro"!==I||I===this._get("mode")||(this._set("mode",I),this._updateMode())}get updating(){return!!this._inputManager?.updating}get latestPointerType(){return this._inputManager?.latestPointerType}get latestPointerLocation(){return this._inputManager?.latestPointerLocation}get multiTouchActive(){return this._inputManager?.multiTouchActive??
!1}disconnect(){this.view.viewEvents.disconnect();this._inputManager=k.destroyMaybe(this._inputManager)}connect(){const I=this.view;this._source=new y.BrowserEventSource(this.view.surface,I.input);var J=[new C.ImmediateDoubleClick,new H.PointerClickHoldAndDrag,new E.SingleAndDoubleClick,new A.Drag(this.view.navigation),new F.VerticalTwoFingerDrag];this._inputManager=J=new B.InputManager({eventSource:this._source,recognizers:J});J.installHandlers("prevent-context-menu",[new z.PreventContextMenu],B.ViewEventPriorities.INTERNAL);
this._modeDragPan=new t.PinchAndPanNavigation(I,"primary");this._modeDragRotate=new c.DragRotate(I,"secondary",G.PivotPoint.CENTER);this._modeDragZoom=new l.DragZoom(I,"tertiary","Shift");this._modeKeyboardNavigation=new x.KeyboardNavigation(I,{left:"ArrowLeft",right:"ArrowRight",forward:"ArrowUp",backward:"ArrowDown",up:"u",down:"j",headingLeft:"a",headingRight:"d",tiltUp:"w",tiltDown:"s",zoomIn:"+",zoomOut:"-"});J.installHandlers("navigation",[new m.PointerDownCancelAnimation(I),new f.DoubleClickZoom(I),
new w.GamepadNavigation(I),new u.MouseWheelZoom(I,"Shift"),new r.SingleKeyResetTilt(I,"p"),new q.SingleKeyResetHeading(I,"n"),new c.DragRotate(I,"primary",G.PivotPoint.EYE,["b"]),new c.DragRotate(I,"secondary",G.PivotPoint.CENTER,["b"]),new t.PinchAndPanNavigation(I,"tertiary",["b"]),this._modeDragRotate,this._modeDragZoom,this._modeDragPan,this._modeKeyboardNavigation,new v.TwoFingerTilt(I)],B.ViewEventPriorities.INTERNAL);this.view.viewEvents.connect(J);this._updateMode();this.addHandles(p.watch(()=>
this.view.navigation?.browserTouchPanEnabled,N=>{this._source.browserTouchPanningEnabled=!N},p.initial))}isModifierKeyDown(I){return this._inputManager?.isModifierKeyDown(I)??!1}_updateMode(){var I=this.primaryDragAction;if(I=D.get(this.mode)?.get(I))this._modeDragPan&&(this._modeDragPan.pointerAction=I.pan),this._modeDragRotate&&(this._modeDragRotate.pointerAction=I.rotate),this._modeDragZoom&&(this._modeDragZoom.pointerAction=I.zoom)}get test(){}};a.__decorate([h.property()],b.prototype,"view",
void 0);a.__decorate([h.property({value:"pan"})],b.prototype,"primaryDragAction",null);a.__decorate([h.property({value:"default"})],b.prototype,"mode",null);a.__decorate([h.property({readOnly:!0})],b.prototype,"updating",null);a.__decorate([h.property()],b.prototype,"latestPointerType",null);a.__decorate([h.property()],b.prototype,"latestPointerLocation",null);a.__decorate([h.property()],b.prototype,"multiTouchActive",null);a.__decorate([h.property()],b.prototype,"_inputManager",void 0);b=a.__decorate([d.subclass("esri.views.3d.input.SceneInputManager")],
b);const D=new Map;a=new Map;h=new Map;a.set("pan",{pan:"primary",rotate:"secondary",zoom:"tertiary"});a.set("rotate",{pan:"secondary",rotate:"primary",zoom:"tertiary"});h.set("pan",{pan:"primary",rotate:"tertiary",zoom:"secondary"});h.set("rotate",{pan:"tertiary",rotate:"primary",zoom:"secondary"});D.set("default",a);D.set("pro",h);return b})},"esri/views/3d/input/handlers/DoubleClickZoom":function(){define("exports ../../../../core/screenUtils ../../state/controllers/ZoomStepControllerGlobal ../../state/controllers/ZoomStepControllerLocal ../../../input/InputHandler ../../../input/handlers/support".split(" "),
function(a,b,n,k,p,h){class e extends p.InputHandler{constructor(g,d){super(!0);this._view=g;this.registerIncoming("double-click",d,f=>this._handleDoubleClick(f))}_handleDoubleClick(g){const d=g.data;if(h.eventMatchesPointerAction(d,"primary")){const f=this._view.state.isGlobal?new n.ZoomStepControllerGlobal({view:this._view,mode:"animation"}):new k.ZoomStepControllerLocal({view:this._view,mode:"animation"});this._view.state.switchCameraController(f);f.step(Math.log(.5)/Math.log(.6),b.createScreenPointArray(d.x,
d.y));g.stopPropagation()}}}a.DoubleClickZoom=e;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/controllers/ZoomStepControllerGlobal":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/mathUtils ../../../../core/time ../../../../core/Logger ../../../../core/has ../../../../core/RandomLCG ../../../../core/Error ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../geometry/support/ray ../../../../chunks/sphere ../../camera/constraintUtils ../../camera/constraintUtils/ConstraintOptions ../../camera/constraintUtils/ConstraintTypes ../../camera/constraintUtils/InteractionType ../../camera/constraintUtils/surfaceCollision ./PointToPointAnimationController ../utils/navigationUtils ../../support/geometryUtils/ray ../../support/geometryUtils/sphere ../../webgl/RenderCamera ../../webgl-engine/lib/Intersector ../../../animation/easing".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w,x,u,t,m,q,r,v,y,B,z,A,C){a.ZoomStepControllerGlobal=class extends r.PointToPointAnimationController{constructor(){super(...arguments);this._zoomLocation=c.create();this._tmpCamera=new z;this._tmpViewDir=c.create();this._tmpRayDir=l.create();this._targetOnSphere=c.create();this._tmpCenter=c.create();this._beginCamera=new z;this._constraintOptions=new u.ConstraintOptions(t.ConstraintTypes.ALL_EXCEPT_COLLISION,m.InteractionType.ZOOM,null,this._beginCamera);this._sphere=
w.create()}initialize(){this._intersector=A.newIntersector(this.view.state.viewingMode)}step(F,G){if(this.running){var D=this.view.state;this.animation.finished?this._beginCamera.copyFrom(D.camera):this.animation.cameraAt(1,this._beginCamera);var I=!1,J=!1;this._intersectionHelper.intersectScreen(G,this._zoomLocation,0===this.view.map.ground.opacity?v.contentIntersectorOptions:{})&&(I=0<F,J=!0);this._tmpCamera.copyFrom(D.camera);I?this._intersectionHelper.intersectRay(this._tmpCamera.ray,this._intersector,
this._tmpCenter)&&(this._tmpCamera.center=this._tmpCenter):this._intersectionHelper.intersectRay(this._tmpCamera.ray,this._intersector,this._zoomLocation)?this._tmpCamera.center=this._zoomLocation:f.copy(this._zoomLocation,this._tmpCamera.center);this._updateCamera(this._tmpCamera,F,G,J);this.begin(this._tmpCamera)}}animationSettings(){return{duration:k.Milliseconds(600),easing:C.outExpo}}_updateCamera(F,G,D,I){var J=v.navigationMode(F,D,this.view.renderCoordsHelper,this.view.viewingMode),N=Math.abs(this.view.camera.position.z),
M=this._zoomLocation;f.normalize(E,F.eye);f.scale(E,E,-1);y.fromScreenAtEye(F,D,this._tmpRayDir);f.normalize(this._tmpRayDir.direction,this._tmpRayDir.direction);const Q=n.clamp(Math.min(v.zoomDistanceModifier,1/Math.abs(f.dot(E,this._tmpRayDir.direction)))*N,v.zoomMinDistanceModifier,v.zoomMaxDistanceModifier);if(J===v.NavigationMode.Horizontal){G=.6**G;this._sphere[3]=f.length(M);f.subtract(this._tmpViewDir,F.center,F.eye);I=Math.min(f.length(this._tmpViewDir),Q);J=I*G;1>=G&&4>J&&(J=4,G=J/I);if(1E-6>
Math.abs(I-J))return;I=f.length(F.center);this._sphere[3]!==I&&(F.center=f.scale(H,F.center,(this._sphere[3]+G*(I-this._sphere[3]))/I));f.scale(this._tmpViewDir,this._tmpViewDir,-G);F.eye=f.add(H,F.center,this._tmpViewDir);x.applyAll(this.view,F,this._constraintOptions);1E-12<f.squaredDistance(M,F.center)&&B.intersectScreen(this._sphere,F,D,this._targetOnSphere)&&v.panToPosition(this._sphere,F,M,this._targetOnSphere,this.view.camera.heading,this.view.camera.tilt,!0)}else{J=.6**Math.abs(G);N=0<G?1:
-1;f.subtract(this._tmpViewDir,M,F.eye);const O=f.length(this._tmpViewDir);D=this.view._stage.renderView.getMinimalDepthForArea(null,D[0],D[1],this.view.state.camera,60);D=null!=D?D:Q;D=I&&0<G?Math.min(D,O):D;f.scale(this._tmpRayDir.direction,this._tmpRayDir.direction,D);f.add(M,this._tmpRayDir.origin,this._tmpRayDir.direction);M=D*J;I=Math.max(4,1.01*F.nearFar[0]);0<G&&M<I&&(M=I,J=M/D);if(1E-6>Math.abs(D-M))return;f.scale(this._tmpRayDir.direction,this._tmpRayDir.direction,N*(1-J));F.eye=f.add(H,
F.eye,this._tmpRayDir.direction);F.center=f.add(H,F.center,this._tmpRayDir.direction)}q.applySurfaceCollisionConstraint(this.view,F)}};a.ZoomStepControllerGlobal=b.__decorate([d.subclass("esri.views.3d.state.controllers.ZoomStepControllerGlobal")],a.ZoomStepControllerGlobal);const H=c.create(),E=c.create();Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/camera/constraintUtils":function(){define("exports ./constraintUtils/altitude ./constraintUtils/common ./constraintUtils/ConstraintOptions ./constraintUtils/ConstraintTypes ./constraintUtils/distance ./constraintUtils/InteractionType ./constraintUtils/surfaceCollision ./constraintUtils/tilt ../../animation/easing".split(" "),
function(a,b,n,k,p,h,e,g,d,f){const c=[{type:p.ConstraintTypes.TILT,error:function(w,x,u){return d.getTiltConstraintError(w,x,u)*x.distance},apply:d.applyTiltConstraint},{type:p.ConstraintTypes.ALTITUDE,error:b.getAltitudeConstraintError,apply:b.applyAltitudeConstraint},{type:p.ConstraintTypes.DISTANCE,error:h.getDistanceConstraintError,apply:h.applyDistanceConstraint}],l=new k.ConstraintOptions;a.applyAll=function(w,x,u=l,t=x){t!==x&&t.copyFrom(x);t.computeUp(w.state.viewingMode);x=!1;for(let q=
0;5>q;q++){let r=0;for(var m of c)if(n.hasConstraintType(u.selection,m.type)){const v=Math.abs(m.error(w,t,u));m.apply(w,t,u)&&(x=!0,r+=v)}if(0===r)break}m=n.hasConstraintType(u.selection,p.ConstraintTypes.COLLISION);a:switch(u.interactionType){case e.InteractionType.PAN:u=g.Mode.EYE_AND_CENTER;break a;case e.InteractionType.ASCEND:u=w.state.isGlobal?g.Mode.EYE_AND_CENTER_SCALE:g.Mode.EYE_AND_CENTER;break a;default:u=g.Mode.EYE}m&&g.applySurfaceCollisionConstraint(w,t,u)&&(x=!0);x&&t.computeUp(w.state.viewingMode);
return x};a.pixelDistanceToInteractionFactor=function(w){return f.inOutCubic(Math.min(1,w/150))};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/camera/constraintUtils/altitude":function(){define("exports ../../../../core/mathUtils ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../geometry/support/ray ./common ./ConstraintTypes ./InteractionType ../../support/intersectionUtils".split(" "),function(a,b,n,k,p,h,e,g,d){function f(t,
m,q=h.defaultConstraintOptions){var r=t.state.constraints.altitude;r=t.state.isGlobal&&r?q.interactionType===g.InteractionType.TUMBLE&&h.hasConstraintType(q.selection,e.ConstraintTypes.TILT)?!1:!0:!1;if(!r||!t.state.constraints.altitude)return 0;var v=t.state.constraints.altitude;r=c;r.min=v.min;r.max=v.max;v=q.interactionType;if(v!==g.InteractionType.NONE){var {min:y,max:B}=r,{interactionStartCamera:z,interactionFactor:A}=q;if(z){q=v===g.InteractionType.TUMBLE||v===g.InteractionType.ZOOM;v=f(t,z);
var C=0===v?0:t.renderCoordsHelper.getAltitude(z.eye);r.min=y;r.max=B;h.adjustRangeForInteraction(v,C,q,A,.05*C,r)}}t=t.renderCoordsHelper.getAltitude(m.eye);t=b.clamp(t,r.min,r.max)-t;return 1E-6>=Math.abs(t)?0:t}const c={min:0,max:0},l=k.create(),w=k.create(),x=k.create(),u=k.create();a.applyAltitudeConstraint=function(t,m,q=h.defaultConstraintOptions){var r=f(t,m,q);if(0===r)return!1;const v=t.renderCoordsHelper,y=v.getAltitude(m.eye)+r;var B=h.interactionDirectionTowardsConstraintMinimization;
q=q.interactionDirection;r=Math.sign(r);t.renderCoordsHelper.worldUpAtPosition(m.eye,w);n.scale(w,w,r);B=B.call(h,m,q,w,l);t=n.copy(x,m.viewForward);B=v.intersectInfiniteManifold(p.wrap(m.eye,B),y,u);m.eye=null!=B?B:v.setAltitude(u,y,m.eye);m.center=d.closestPointOnRay(u,m.eye,t,m.center);return!0};a.getAltitudeConstraintError=f;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/camera/constraintUtils/common":function(){define(["exports","../../../../chunks/vec32","./ConstraintOptions",
"./ConstraintTypes"],function(a,b,n,k){n=new n.ConstraintOptions(k.ConstraintTypes.NONE);a.adjustRangeForInteraction=function(p,h,e,g,d,f){0!==p&&(e?(f.min=Math.min(f.min,h),f.max=Math.max(f.max,h)):null!=g?(f.min-=Math.max(0,(h-f.min)*(1-g)),f.max+=Math.max(0,(h-f.max)*(1-g))):d&&(f.min-=Math.max(0,h-f.min-d),f.max+=Math.max(0,h-f.max-d)))};a.defaultConstraintOptions=n;a.hasConstraintType=function(p,h){return 0!==(p&h)};a.interactionDirectionTowardsConstraintMinimization=function(p,h,e,g){h=h||p.viewForward;
b.copy(g,h);b.scale(g,g,Math.sign(b.dot(h,e)));return g};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/camera/constraintUtils/ConstraintOptions":function(){define(["exports","./ConstraintTypes","./InteractionType","./TiltMode"],function(a,b,n,k){class p{constructor(h=b.ConstraintTypes.ALL,e=n.InteractionType.NONE,g=0,d=null,f=null,c=k.TiltMode.TUMBLE){this.selection=h;this.interactionType=e;this.interactionFactor=g;this.interactionStartCamera=d;this.interactionDirection=
f;this.tiltMode=c}}a.ConstraintOptions=p;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/camera/constraintUtils/ConstraintTypes":function(){define(["exports"],function(a){a.ConstraintTypes=void 0;var b=a.ConstraintTypes||(a.ConstraintTypes={});b[b.NONE=0]="NONE";b[b.TILT=1]="TILT";b[b.ALTITUDE=2]="ALTITUDE";b[b.DISTANCE=4]="DISTANCE";b[b.COLLISION=8]="COLLISION";b[b.ALL=15]="ALL";b[b.ALL_EXCEPT_COLLISION=7]="ALL_EXCEPT_COLLISION";Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/views/3d/camera/constraintUtils/InteractionType":function(){define(["exports"],function(a){a.InteractionType=void 0;var b=a.InteractionType||(a.InteractionType={});b[b.NONE=0]="NONE";b[b.ZOOM=1]="ZOOM";b[b.TUMBLE=2]="TUMBLE";b[b.LOOK_AROUND=3]="LOOK_AROUND";b[b.PAN=4]="PAN";b[b.ASCEND=5]="ASCEND";Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/camera/constraintUtils/TiltMode":function(){define(["exports"],function(a){a.TiltMode=void 0;var b=
a.TiltMode||(a.TiltMode={});b[b.TUMBLE=0]="TUMBLE";b[b.LOOK_AROUND=1]="LOOK_AROUND";Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/intersectionUtils":function(){define(["exports","../../../core/libs/gl-matrix-2/factories/vec2f64","../../../chunks/vec32","../../../core/libs/gl-matrix-2/factories/vec3f64","../../../geometry/support/plane"],function(a,b,n,k,p){function h(d,f,c,l){const w=g;d?(c&&l&&(w.len=n.distance(f,c)),n.copy(w.dir,d)):l?(w.len=n.distance(f,
c),n.subtract(w.dir,c,f),n.scale(w.dir,w.dir,1/w.len)):(n.subtract(w.dir,c,f),n.normalize(w.dir,w.dir));return w}function e(d,f,c,l){l.clip[0]=0;l.clip[1]=c?l.len:Number.MAX_VALUE;for(c=0;c<d.length;c++){{var w=d[c],x=f;var u=l;const t=n.dot(p.getNormal(w),u.dir);w=-p.signedDistance(w,x);0>w&&0<=t?u=!1:-1E-6<t&&1E-6>t?u=0<w:!(0>w||0>t)||0>w&&0>t?(w/=t,0<t?w<u.clip[1]&&(u.clip[1]=w):w>u.clip[0]&&(u.clip[0]=w),u=u.clip[0]<=u.clip[1]):u=!0}if(!u)return!1}return!0}const g={dir:k.create(),len:0,clip:b.create()};
a.closestPointOnRay=function(d,f,c,l){l=n.dot(c,n.subtract(d,l,f));return n.add(d,f,n.scale(d,c,l))};a.frustumLineSegment=function(d,f,c,l){l=h(l,f,c,!0);return e(d,f,c,l)};a.frustumPoint=function(d,f){for(let c=0;6>c;c++)if(0<p.signedDistance(d[c],f))return!1;return!0};a.frustumRay=function(d,f,c,l){c=h(l,f,c,!1);return e(d,f,null,c)};a.frustumSphere=function(d,f,c){const l=f[0],w=f[1];f=f[2];return d[0][0]*l+d[0][1]*w+d[0][2]*f+d[0][3]>c||d[1][0]*l+d[1][1]*w+d[1][2]*f+d[1][3]>c||d[2][0]*l+d[2][1]*
w+d[2][2]*f+d[2][3]>c||d[3][0]*l+d[3][1]*w+d[3][2]*f+d[3][3]>c||d[4][0]*l+d[4][1]*w+d[4][2]*f+d[4][3]>c||d[5][0]*l+d[5][1]*w+d[5][2]*f+d[5][3]>c?!1:!0};a.planeSphere=function(d,f,c){return d[0]*f[0]+d[1]*f[1]+d[2]*f[2]+d[3]<c};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/camera/constraintUtils/distance":function(){define("exports ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../geometry/support/ray ../../../../chunks/sphere ./common ./InteractionType".split(" "),
function(a,b,n,k,p,h,e){function g(t,m,q=h.defaultConstraintOptions){if(!t.state.isLocal)return 0;var r=t.state.constraints.distance;if(!t.pointsOfInterest.surfaceOrigin.renderLocation||Infinity===r)return 0;f.min=0;f.max=r;r=f;var v=q.interactionType;if(v!==e.InteractionType.NONE){var {min:y,max:B}=r,{interactionStartCamera:z,interactionFactor:A}=q;if(z){q=v===e.InteractionType.ZOOM||v===e.InteractionType.PAN;v=g(t,z);var C=0===v?0:d(t,z);r.min=y;r.max=B;h.adjustRangeForInteraction(v,C,q,A,.05*C,
r)}}t=d(t,m);t=f.max-t;return-1E-6<=t?0:t}function d(t,m){t=t.pointsOfInterest.surfaceOrigin;return t.renderLocation?b.distance(m.eye,t.renderLocation):0}const f={min:0,max:0},c=n.create(),l=n.create(),w=n.create(),x=n.create(),u=n.create();a.applyDistanceConstraint=function(t,m,q=h.defaultConstraintOptions){var r=g(t,m,q);if(0===r)return!1;var v=t.pointsOfInterest.surfaceOrigin;if(!v.renderLocation)return!1;r=d(t,m)+r;const y=b.copy(c,m.eye);q=h.interactionDirectionTowardsConstraintMinimization(m,
q.interactionDirection,b.direction(x,m.eye,v.renderLocation),w);if(!p.intersectRay(p.fromCenterAndRadius(v.renderLocation,r),k.wrap(m.eye,q),u))return!1;m.eye=u;v=b.subtract(l,m.eye,y);m.center=b.add(u,m.center,v);v=t.renderCoordsHelper.getAltitude(m.center);t=t.renderCoordsHelper.intersectInfiniteManifold(m.ray,v,u);null!=t&&(m.center=t);return!0};a.getDistanceConstraintError=g;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/camera/constraintUtils/surfaceCollision":function(){define(["exports",
"../../../../chunks/vec32","../../../../core/libs/gl-matrix-2/factories/vec3f64","../intersectionUtils"],function(a,b,n,k){a.Mode=void 0;(function(e){e[e.EYE=0]="EYE";e[e.EYE_AND_CENTER=1]="EYE_AND_CENTER";e[e.EYE_AND_CENTER_SCALE=2]="EYE_AND_CENTER_SCALE"})(a.Mode||(a.Mode={}));const p=n.create(),h=n.create();a.applySurfaceCollisionConstraint=function(e,g,d=a.Mode.EYE){var f=e.state.constraints;if(!f.collision.enabled)return!1;var c=k.surfaceElevationBelowRenderLocation(e,g.eye);const l=e.renderCoordsHelper.getAltitude(g.eye);
f=c+f.collision.elevationMargin;if(l>=f)return!1;c=b.length(g.eye);b.subtract(p,g.center,g.eye);g.eye=e.renderCoordsHelper.setAltitude(h,f,g.eye);d===a.Mode.EYE_AND_CENTER?g.center=b.add(p,g.eye,p):d===a.Mode.EYE_AND_CENTER_SCALE&&(g.center=b.scale(p,g.center,(c-l+f)/c));return!0};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/camera/constraintUtils/tilt":function(){define("exports ../../../../core/compilerUtils ../../../../core/mathUtils ../../../../core/libs/gl-matrix-2/math/mat4 ../../../../core/libs/gl-matrix-2/factories/mat4f64 ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../geometry/ellipsoidUtils ../../../../chunks/sphere ./common ./ConstraintTypes ./InteractionType ./TiltMode ../../state/utils/viewUtils".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w,x){function u(H,E,F,G=!0){C.eyeCenterDistance=0;C.requiresTwoSteps=!1;const D=t(H,E,F,f.defaultConstraintOptions,C);if(0===D)return!1;k.fromRotation(v,-D,E.viewRight);switch(F.tiltMode){case w.TiltMode.LOOK_AROUND:h.transformMat4(r,E.viewForward,v);h.scale(r,r,C.eyeCenterDistance);E.center=h.add(y,E.eye,r);break;case w.TiltMode.TUMBLE:h.subtract(r,E.center,E.eye);h.transformMat4(r,r,v);E.eye=h.subtract(y,E.center,r);break;default:b.neverReached(F.tiltMode)}E.up=
h.transformMat4(y,E.up,v);return C.requiresTwoSteps&&G?u(H,E,F,!1):!0}function t(H,E,F,G=f.defaultConstraintOptions,D){if(!H.state.constraints.tilt)return 0;var I=H.state.constraints.tilt(E.distance,z);if(F.interactionType!==l.InteractionType.NONE){var {interactionStartCamera:J,interactionFactor:N}=F;if(J){var {min:M,max:Q}=I,O=t(H,J,f.defaultConstraintOptions,F),K=0===O?0:x.viewAngle(H.renderCoordsHelper,J.center,J.eye);I.min=M;I.max=Q;F.interactionType===l.InteractionType.TUMBLE?(f.hasConstraintType(F.selection,
c.ConstraintTypes.ALTITUDE)&&q(H,J,I),f.adjustRangeForInteraction(O,K,!0,N,B,I)):f.adjustRangeForInteraction(O,K,!1,N,B,I)}}G.interactionType===l.InteractionType.TUMBLE&&f.hasConstraintType(G.selection,c.ConstraintTypes.ALTITUDE)&&q(H,G.interactionStartCamera,I);if(F.tiltMode===w.TiltMode.LOOK_AROUND||G.tiltMode===w.TiltMode.LOOK_AROUND){a:{D&&(D.requiresTwoSteps=!1);switch(H.viewingMode){case "global":F=A;O=H.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude;G=O+g.getReferenceEllipsoid(H.spatialReference).radius;
O=H.renderCoordsHelper.intersectManifold(E.ray,O,y);F.eyeCenterDistance=E.distance;F.centerIsOnSurface=!1;null!=O?(F.eyeCenterDistance=h.distance(E.eye,O),F.tiltAtCenter=x.viewAngle(H.renderCoordsHelper,O,E.eye),F.centerIsOnSurface=!0):H.state.isLocal?F.tiltAtCenter=x.viewAngle(H.renderCoordsHelper,E.center,E.eye):(d.closestPointOnSilhouette(d.fromRadius(d.tmpSphere,G),E.ray,y),F.eyeCenterDistance=h.distance(E.eye,y),F.tiltAtCenter=n.acosClamped(-h.dot(E.viewForward,h.normalize(y,y))));F.radius=G;
F.eyeRadius=h.length(E.eye);F.constraints=H.state.constraints;E=n.clamp(F.tiltAtCenter,I.min,I.max);if(1E-9<Math.abs(F.tiltAtCenter-E)){if(F.centerIsOnSurface){{const {constraints:L,eyeCenterDistance:P,tiltAtCenter:R}=F;E=R;H=L.clampTilt(P,R);I=m(F,H);if(L.clampTilt(I,R)!==H)for(I=0;10>I&&1E-9<Math.abs(H-E);)G=(E+H)/2,O=m(F,G),O=L.clampTilt(O,G),1E-9<Math.abs(O-G)?E=G:H=G,I++;E=H}I=E;H=n.asinClamped(F.radius/F.eyeRadius*Math.sin(F.tiltAtCenter));I=n.asinClamped(F.radius/F.eyeRadius*Math.sin(I));H=
F.eyeRadius>F.radius?H-I:I-H}else E=F.constraints.clampTilt(F.eyeCenterDistance,F.tiltAtCenter),D&&E<Math.PI/2&&(D.requiresTwoSteps=!0,E=Math.PI/2-1E-5),H=F.tiltAtCenter-Math.PI/2-(E-Math.PI/2);D&&(D.eyeCenterDistance=m(F,E));D=H}else D=0;break a;case "local":G=x.viewAngle(H.renderCoordsHelper,E.center,E.eye);F=n.clamp(G,I.min,I.max);I=G-F;1E-9<Math.abs(I)?(D&&(G=Math.abs(H.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude),H=H.renderCoordsHelper.getAltitude(E.eye)-G,F=Math.max(Math.cos(F),
1E-4),D.eyeCenterDistance=1E-4<Math.abs(F)?H/F:E.distance),D=I):D=0;break a}D=void 0}return D}D=x.viewAngle(H.renderCoordsHelper,E.center,E.eye);F=n.clamp(D,I.min,I.max);D-=F;D=1E-9<Math.abs(D)?D:0;return D}function m(H,E){if(!H.centerIsOnSurface)return H.eyeCenterDistance;E=Math.PI-n.clamp(E,0,Math.PI);const F=n.asinClamped(H.radius/H.eyeRadius*Math.sin(E)),G=Math.sin(Math.PI-E-F)/Math.sin(E);return H.eyeRadius<H.radius&&1<G?Math.sin(Math.PI-E-(Math.PI-F))/Math.sin(E)*H.eyeRadius:G*H.eyeRadius}function q(H,
E,F){var G=H.state.constraints;if(!H.state.isLocal&&G.altitude&&E){var D=h.squaredLength(E.center),I=Math.sqrt(D);E=E.distance;var J=g.getReferenceEllipsoid(H.spatialReference).radius;H=G.altitude.min+J;G=G.altitude.max+J;H=(H*H-E*E-D)/(-2*I*E);F.min=Math.max(F.min,Math.min(Math.PI-n.acosClamped((G*G-E*E-D)/(-2*I*E)),F.max));F.max=Math.min(F.max,Math.PI-n.acosClamped(H))}}const r=e.create(),v=p.create(),y=e.create(),B=n.deg2rad(5),z={min:0,max:0},A={constraints:null,radius:0,eyeRadius:0,centerIsOnSurface:!0,
eyeCenterDistance:0,tiltAtCenter:0},C={eyeCenterDistance:0,requiresTwoSteps:!1};a.applyTiltConstraint=u;a.getTiltConstraintError=t;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/animation/easing":function(){define(["exports"],function(a){function b(L){const P=2*(L-Math.sqrt((L-1)*L)),R=P/2/L;return W=>W<R?L*W*W:P*W-P+1}function n(L,P){return(R,W)=>R<P?P*L(R/P,W):1-L((1-R)/(1-P),W)*(1-P)}const k=L=>L,p=L=>L*L,h=L=>1-p(1-L),e=L=>.5>L?p(2*L)/2:(1-p(1-2*(L-.5))+1)/2,g=L=>
L*L*L,d=L=>1-g(1-L),f=L=>.5>L?g(2*L)/2:(1-g(1-2*(L-.5))+1)/2,c=L=>L*L*L*L,l=L=>1-c(1-L),w=L=>.5>L?c(2*L)/2:(1-c(1-2*(L-.5))+1)/2,x=L=>L*L*L*L*L,u=L=>1-x(1-L),t=L=>.5>L?x(2*L)/2:(1-x(1-2*(L-.5))+1)/2,m=L=>-Math.cos(L*Math.PI/2)+1,q=L=>1-m(1-L),r=L=>.5>L?m(2*L)/2:(1-m(1-2*(L-.5))+1)/2,v=L=>2**(10*(L-1)),y=L=>1-2**(10*(1-L-1)),B=L=>.5>L?2**(10*(2*L-1))/2:(1-2**(10*(1-2*(L-.5)-1))+1)/2,z=L=>-(Math.sqrt(1-L*L)-1),A=L=>1-z(1-L),C=L=>.5>L?z(2*L)/2:(1-z(1-2*(L-.5))+1)/2,H=n(b(1),1),E=n(b(1),0),F=n(b(1),.5),
G=n(b(2),1),D=n(b(2),0),I=n(b(2),.5),J=n(b(3),1),N=n(b(3),0),M=n(b(3),.5),Q=n(b(4),1),O=n(b(4),0),K=n(b(4),.5);a.EasingFunctions={linear:k,"in-quad":p,"out-quad":h,"in-out-quad":e,"in-coast-quad":H,"out-coast-quad":E,"in-out-coast-quad":F,"in-cubic":g,"out-cubic":d,"in-out-cubic":f,"in-coast-cubic":G,"out-coast-cubic":D,"in-out-coast-cubic":I,"in-quart":c,"out-quart":l,"in-out-quart":w,"in-coast-quart":J,"out-coast-quart":N,"in-out-coast-quart":M,"in-quint":x,"out-quint":u,"in-out-quint":t,"in-coast-quint":Q,
"out-coast-quint":O,"in-out-coast-quint":K,"in-sine":m,"out-sine":q,"in-out-sine":r,"in-expo":v,"out-expo":y,"in-out-expo":B,"in-circ":z,"out-circ":A,"in-out-circ":C};a.inCirc=z;a.inCoastCubic=G;a.inCoastQuad=H;a.inCoastQuart=J;a.inCoastQuint=Q;a.inCubic=g;a.inExpo=v;a.inOutCirc=C;a.inOutCoastCubic=I;a.inOutCoastQuad=F;a.inOutCoastQuart=M;a.inOutCoastQuint=K;a.inOutCubic=f;a.inOutExpo=B;a.inOutQuad=e;a.inOutQuart=w;a.inOutQuint=t;a.inOutSine=r;a.inQuad=p;a.inQuart=c;a.inQuint=x;a.inSine=m;a.linear=
k;a.outCirc=A;a.outCoastCubic=D;a.outCoastQuad=E;a.outCoastQuart=N;a.outCoastQuint=O;a.outCubic=d;a.outExpo=y;a.outQuad=h;a.outQuart=l;a.outQuint=u;a.outSine=q;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/controllers/PointToPointAnimationController":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/Logger ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../ViewAnimation ../../animation/pointToPoint/Animation ./AnimationController ../../webgl/RenderCamera ../../webgl-engine/lib/Intersector ../../../animation/easing".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w,x){a.PointToPointAnimationController=class extends c.AnimationController{get _intersectionHelper(){return this.view.sceneIntersectionHelper}constructor(m){super(m);this.type="point-to-point";this.mode="interaction";this._hasTarget=!1}initialize(){this.animation=new f.Animation(this.view.state.viewingMode);this.viewAnimation="interaction"===this.mode?null:new d}get isInteractive(){return"interaction"===this.mode}begin(m,q){this._hasTarget=!0;q=this.animationSettings(q);
u.copyFrom(this.view.state.camera);const r=w.newIntersector(this.view.state.viewingMode);this._intersectionHelper.intersectRay(u.ray,r,t)&&(u.center=t);this.animation.update(u,m,q);this.animation.finished&&this.finish()}finish(){this.animation.currentTime=this.animation.time;super.finish()}get steppingFinished(){return this._hasTarget&&this.animation.finished}stepController(m,q){this._hasTarget&&this.animation.step(m,q)}onControllerEnd(m){this._hasTarget&&(this.animation.cameraAt(this.animation.currentTime/
this.animation.time,m),this.animation.currentTime=this.animation.time);super.onControllerEnd(m)}animationSettings(m={}){return{apex:{maximumDistance:this.view.state.constraints.clampAltitude(Infinity)/6,ascensionFactor:void 0,descensionFactor:void 0},...m,easing:"string"===typeof m.easing?x.EasingFunctions[m.easing]:m.easing}}};b.__decorate([n.property({constructOnly:!0})],a.PointToPointAnimationController.prototype,"mode",void 0);b.__decorate([n.property({readOnly:!0})],a.PointToPointAnimationController.prototype,
"isInteractive",null);a.PointToPointAnimationController=b.__decorate([e.subclass("esri.views.3d.state.controllers.PointToPointAnimationController")],a.PointToPointAnimationController);const u=new l,t=g.create();a.isPointToPointAnimationController=function(m){return null!=m&&"type"in m&&"point-to-point"===m.type};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/animation/pointToPoint/Animation":function(){define("exports ../../../../core/time ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ./Camera ../../../animation/pointToPoint/Animation".split(" "),
function(a,b,n,k,p,h){class e{get finished(){return this.currentTime>=this._animation.time}get time(){return this._animation.time}constructor(d){this.currentTime=b.Milliseconds(0);this._animation=new h.Animation(()=>new p.Camera(d));this._current=new p.Camera(d)}update(d,f,c){const {source:l,target:w}=this._animation.definition,x=n.subtract(g,f.center,d.center),u=n.length(x);1E-5<=u?(x[0]/=u,x[1]/=u,x[2]/=u):(x[0]=0,x[1]=1,x[0]=0);n.copy(l.direction,x);n.copy(w.direction,x);l.copyFromRenderCamera(d);
w.copyFromRenderCamera(f);this._current.copyFrom(l);this._animation.update(l,w,c);this.currentTime=b.Milliseconds(0);d.almostEquals(f)&&(this.currentTime=this._animation.time)}cameraAt(d,f){this._animation.cameraAt(d,this._current);this._current.copyToRenderCamera(f)}step(d,f){this.finished||(this.currentTime=b.Milliseconds(this.currentTime+b.millisecondsFromSeconds(d)),this.currentTime>=this.time&&(this.currentTime=this.time));this.cameraAt(this.currentTime/this.time,f)}}const g=k.create();a.Animation=
e;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/animation/pointToPoint/Camera":function(){define("exports ../../../../core/mathUtils ../../../../core/libs/gl-matrix-2/math/mat3 ../../../../core/libs/gl-matrix-2/factories/mat3f64 ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../ViewingMode ../../support/mathUtils".split(" "),function(a,b,n,k,p,h,e,g){class d{get pitch(){return this._pitch}get yaw(){return this._yaw}get distance(){return this._distance}get fov(){return this._fov}get size(){return this._size}constructor(v){this.viewingMode=
v;this.center=h.create();this._distance=this._yaw=this._pitch=0;this.direction=h.clone(m);this._fov=55;this._size=1}pixelsPerPanAtZoom(v){return this._size/2/(this._zoomToPanScale*v)}zoomAtPixelsPerPan(v){return this._size/2/(this._zoomToPanScale*v)}pixelsPerRotate(){return this._size/2/Math.max(Math.cos(Math.abs(this._pitch)),.5)}compareTo(v,y){if(this.viewingMode===e.ViewingMode.Global){var B=p.length(this.center);const z=p.length(v.center);B=(B+z)/2;y.pan=g.angle(this.center,v.center)*B}else y.pan=
p.distance(this.center,v.center);B=Math.abs(v._yaw-this._yaw);B>=Math.PI&&(B=2*Math.PI-B);y.rotate=Math.max(B,Math.abs(v._pitch-this._pitch));y.fov=v.fov-this.fov;y.sourceZoom=this._distance;y.targetZoom=v._distance}interpolate(v,y,B){this.viewingMode===e.ViewingMode.Global?g.slerp(v.center,y.center,B.pan,this.center):p.lerp(this.center,v.center,y.center,B.pan);this._distance=isFinite(y.distance)?b.lerp(v.distance,y.distance+B.zoomOffset,B.zoom):v.distance;this._pitch=b.lerp(v.pitch,y.pitch,B.rotate);
let z=v._yaw;const A=y._yaw;Math.abs(A-z)>=Math.PI&&(z+=2*(z<A?1:-1)*Math.PI);this._yaw=b.lerp(z,A,B.rotate);this._fov=b.lerp(v.fov,y.fov,B.fov)}copyFrom(v){p.copy(this.center,v.center);this._pitch=v.pitch;this._yaw=v.yaw;this._distance=v.distance;p.copy(this.direction,v.direction);this._size=v.size;this._fov=v.fov;this._zoomToPanScale=Math.atan(.5*this._fov);this.viewingMode=v.viewingMode}copyFromRenderCamera(v){var y=this._lookAtOrientation(v.center,r);p.copy(this.center,v.center);p.subtract(w,
v.center,v.eye);p.transformMat3(w,w,y);p.transformMat3(x,v.up,y);this._distance=p.length(w);0!==this._distance&&(w[0]/=this._distance,w[1]/=this._distance,w[2]/=this._distance);this._pitch=Math.PI-g.angle(t,w);y=w;const B=u;.5>Math.abs(x[2])?(p.copy(B,x),0<y[2]&&p.scale(B,B,-1)):p.copy(B,y);p.cross(c,B,t);p.normalize(c,c);this._yaw=g.angle(q,c,t);this._size=Math.sqrt(v.width*v.width+v.height*v.height);this._fov=v.fov;this._zoomToPanScale=Math.atan(.5*this._fov)}copyToRenderCamera(v){const y=this._lookAtOrientation(this.center,
r);n.transpose(y,y);this._axisAngleVec3(q,this._pitch-Math.PI/2,m,w);this._axisAngleVec3(t,this._yaw,w,w);this._axisAngleVec3(q,this._pitch-Math.PI/2,t,x);this._axisAngleVec3(t,this._yaw,x,x);p.scale(w,w,this._distance);p.transformMat3(w,w,y);p.transformMat3(x,x,y);v.center=this.center;v.eye=p.subtract(w,this.center,w);v.up=x;v.fov=this._fov}_axisAngleVec3(v,y,B,z){const A=Math.cos(y);y=Math.sin(y);p.scale(f,B,A);p.cross(c,v,B);p.scale(c,c,y);p.scale(l,v,(1-A)*p.dot(v,B));return p.add(z,p.add(z,f,
c),l)}_lookAtOrientation(v,y=k.create()){this._upAtLookAt(v,l);p.cross(f,this.direction,l);p.normalize(f,f);0===f[0]&&0===f[1]&&0===f[2]&&p.copy(f,q);p.cross(c,l,f);p.normalize(c,c);y[0]=f[0];y[1]=c[0];y[2]=l[0];y[3]=f[1];y[4]=c[1];y[5]=l[1];y[6]=f[2];y[7]=c[2];y[8]=l[2];return y}_upAtLookAt(v,y){return this.viewingMode===e.ViewingMode.Local?p.copy(y,t):p.normalize(y,v)}}const f=h.create(),c=h.create(),l=h.create(),w=h.create(),x=h.create(),u=h.create(),t=h.UNIT_Z,m=h.UNIT_Y,q=h.UNIT_X,r=k.create();
a.Camera=d;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/animation/pointToPoint/Animation":function(){define("exports ../../../core/time ../easing ./Definition ./InterpolateComponents ./Settings ./apex/Path".split(" "),function(a,b,n,k,p,h,e){const g=new p.InterpolateComponents;a.Animation=class{get time(){return this._time}get isLinear(){return 1===this.path.segments.length}constructor(d){this._time=b.Milliseconds(0);this._easing=n.inOutCoastQuad;this.definition=new k.Definition(d);
this.path=new e.Path}update(d,f,c){this.definition.update(d,f,c);this.path.update(this.definition,c);this._time=this._applyTimeSettings(b.millisecondsFromSeconds(isFinite(this.path.time)?this.path.time:b.Seconds(0)),c);this._easing=c.easing??(1E3<=this._time?n.inOutCoastQuad:n.outExpo)}cameraAt(d,f){d=Math.min(Math.max(0,d),1);d=this._normalizedEasing(d);d=this.path.interpolateComponentsAt(d,g);f.interpolate(this.definition.source,this.definition.target,d)}_normalizedEasing(d){const f=this._easing(0,
this._time),c=this._easing(1,this._time);return(this._easing(d,this._time)-f)/(c-f)}_applyTimeSettings(d,f){const c=null!=f.speedFactor?f.speedFactor:1,l=f.minDuration??h.defaultSettings.minDuration/c,w=f.maxDuration??h.defaultSettings.maxDuration/c;return d=null!=f.duration?f.duration:b.Milliseconds(Math.min(Math.max(d/c,l),w))}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/animation/pointToPoint/Definition":function(){define(["exports","../../../core/libs/gl-matrix-2/math/common",
"./Camera","./Settings"],function(a,b,n,k){class p{constructor(h){this._createCamera=h;this.compared=new n.CompareResult;this.segmentStart=0;this.segmentEnd=1;this.settings={desiredScreenFlow:k.defaultSettings.desiredScreenFlow};this.source=h();this.target=h()}clone(){const h=new p(this._createCamera);h.copyFrom(this);return h}copyFrom(h){this.update(h.source,h.target,h.settings)}update(h,e,g){this.source!==h&&this.source.copyFrom(h);this.target!==e&&this.target.copyFrom(e);this.source.compareTo(this.target,
this.compared);this.settings.desiredScreenFlow=g.desiredScreenFlow??k.defaultSettings.desiredScreenFlow;this.desiredPixelFlow=this.settings.desiredScreenFlow*this.target.size;this.halfWindowSize=this.target.size/2}halfWindowPanAtZoom(h){h=this.target.pixelsPerPanAtZoom(h);return this.halfWindowSize/h}get hasZoom(){return 1E-5<Math.abs(this.compared.sourceZoom-this.compared.targetZoom)}get hasPan(){return this.compared.pan>b.getEpsilon()}get hasFov(){return Math.abs(this.compared.fov)>b.getEpsilon()}get hasRotate(){return this.compared.rotate>
b.getEpsilon()}}a.Definition=p;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/animation/pointToPoint/Camera":function(){define(["exports"],function(a){class b{constructor(){this.targetZoom=this.sourceZoom=this.fov=this.rotate=this.pan=0}}a.CompareResult=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/animation/pointToPoint/Settings":function(){define(["exports","../../../core/time"],function(a,b){const n={desiredScreenFlow:2,minDuration:b.Milliseconds(500),
maxDuration:b.Milliseconds(8E3)};b={...n,maxDuration:b.Milliseconds(4E3)};a.defaultSettings=n;a.defaultSettings2D=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/animation/pointToPoint/InterpolateComponents":function(){define(["exports"],function(a){class b{constructor(){this.zoomOffset=this.fov=this.zoom=this.rotate=this.pan=0}}a.InterpolateComponents=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/animation/pointToPoint/apex/Path":function(){define(["exports",
"../../easing","../Path","../Segment","./planning"],function(a,b,n,k,p){class h extends n.Path{constructor(e,g){super();this._preallocSegments=[new k.Segment,new k.Segment,new k.Segment];this._descensionSegment=this._ascensionSegment=null;this.update(e,g)}update(e,g){e&&(this.definition?this.definition.copyFrom(e):this.definition=e.clone(),e=g?.apex?p.optimalDistance(e,g.apex):null,this.segments.length=0,this._descensionSegment=this._ascensionSegment=null,e?this._updateWithApex(e,g?.apex):this._updateWithoutApex())}segmentInterpolateComponentsAt(e,
g,d){e.interpolateComponentsAt(g,d);e===this._ascensionSegment?d.zoom=b.outQuad(d.zoom):e===this._descensionSegment&&(d.zoom=b.inQuad(d.zoom))}_updateWithApex(e,g){const [d,f,c]=this._preallocSegments,l=g?.ascensionFactor??.5;g=Math.min(1-l,null!=g?.ascensionFactor&&null!=g.descensionFactor?g.descensionFactor:.5);const w=1-l-g;d.definition?d.definition.copyFrom(this.definition):d.definition=this.definition.clone();d.definition.compared.targetZoom=e;d.definition.compared.pan=this.definition.compared.pan*
l;d.definition.compared.rotate=this.definition.compared.rotate*l;d.definition.segmentEnd=l;d.update();this._ascensionSegment=d;this.segments.push(d);0<w&&(f.definition?f.definition.copyFrom(this.definition):f.definition=this.definition.clone(),f.definition.copyFrom(this.definition),f.definition.compared.sourceZoom=e,f.definition.compared.targetZoom=e,f.definition.compared.pan=this.definition.compared.pan*w,f.definition.compared.rotate=this.definition.compared.rotate*w,f.definition.segmentStart=d.definition.segmentEnd,
f.definition.segmentEnd=d.definition.segmentEnd+w,f.update(),this.segments.push(f));c.definition?c.definition.copyFrom(this.definition):c.definition=this.definition.clone();c.definition.compared.sourceZoom=e;c.definition.compared.pan=this.definition.compared.pan*g;c.definition.compared.rotate=this.definition.compared.rotate*g;c.definition.segmentStart=l+w;c.update();this._descensionSegment=c;this.segments.push(c)}_updateWithoutApex(){const [e]=this._preallocSegments;e.update(this.definition);this.segments.push(e)}}
a.Path=h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/animation/pointToPoint/Path":function(){define(["exports","../../../core/time"],function(a,b){a.Path=class{constructor(){this.segments=[]}get time(){return this.segments.reduce((n,k)=>b.Seconds(n+k.time),b.Seconds(0))}interpolateComponentsAt(n,k){n=Math.min(Math.max(n,0),1);n*=this.time;var p=0,h=0;const e=this.definition,g=this.segments.reduce((d,f)=>d||f.definition.hasZoom,!1);for(let d=0;d<this.segments.length;d++){const f=
this.segments[d],c=f.definition;if(n<=f.time||d===this.segments.length-1){this.segmentInterpolateComponentsAt(f,0===f.time?0:n/f.time,k);e.hasPan&&!isNaN(k.pan)&&isFinite(e.compared.pan)?k.pan=(p+c.compared.pan*k.pan)/e.compared.pan:k.pan=1;e.hasRotate&&!isNaN(k.rotate)&&isFinite(e.compared.rotate)?k.rotate=(h+c.compared.rotate*k.rotate)/e.compared.rotate:k.rotate=1;if(g&&!isNaN(k.zoom)&&isFinite(c.compared.targetZoom)){const {sourceZoom:l,targetZoom:w}=c.compared;n=k.zoom*(w-l)+l;p=this.segments[0].definition.compared.sourceZoom;
h=Math.abs(w-p)>Math.abs(l-p)?w:l;k.zoomOffset=h-this.segments[this.segments.length-1].definition.compared.targetZoom;k.zoom=(n-p)/(h-p)}else k.zoom=1;return k}n-=f.time;p+=c.compared.pan;h+=c.compared.rotate}}segmentInterpolateComponentsAt(n,k,p){n.interpolateComponentsAt(k,p)}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/animation/pointToPoint/Segment":function(){define(["exports","../../../core/mathUtils","../../../core/time"],function(a,b,n){class k{get time(){return this._time}constructor(h){h&&
this.update(h)}update(h){h&&(this.definition?this.definition.copyFrom(h):this.definition=h.clone());this._updatePrecomputedVariables();this._updatePixelFlow()}_updatePrecomputedVariables(){var h=this.definition;const e=h.compared,g=e.sourceZoom;this._zoomSign=g>e.targetZoom?1:-1;this._panPixelsAtSource=e.pan*h.source.pixelsPerPanAtZoom(g);h=(h.source.pixelsPerRotate()+h.target.pixelsPerRotate())/2;this._rotatePixels=e.rotate*h}_updatePixelFlow(){var h=this.definition.compared.sourceZoom,e=this.definition.compared.targetZoom;
const {hasZoom:g,hasPan:d,hasRotate:f}=this.definition;var c=0,l=0;g&&(d&&(c=(e/h-1)/(-1/(this._zoomSign*this.definition.halfWindowSize)*Math.LN2*this._panPixelsAtSource)),f&&(l=Math.log(h/e)/Math.LN2*this._zoomSign*this.definition.halfWindowSize/this._rotatePixels));this._rotatePixelFlow=this._panPixelFlow=this._zoomPixelFlow=0;h=this.definition.desiredPixelFlow;g&&d&&f?(e=c+l+c*l,this._zoomPixelFlow=c*l/e*h,this._panPixelFlow=l/e*h,this._rotatePixelFlow=c/e*h):g&&d?(l=1+c,this._zoomPixelFlow=c/
l*h,this._panPixelFlow=1/l*h):g&&f?(c=1+l,this._zoomPixelFlow=l/c*h,this._rotatePixelFlow=1/c*h):d&&f?(c=this._panPixelsAtSource/this._rotatePixels,l=1+c,this._panPixelFlow=c/l*h,this._rotatePixelFlow=1/l*h):d?this._panPixelFlow=h:g?this._zoomPixelFlow=h:f&&(this._rotatePixelFlow=h);this._time=n.Seconds(Math.max(this.rotateTime,this.zoomTime,this.panTime));this.fovTime>this._time&&(h=this.fovTime/this._time,this._time=this.fovTime,this._zoomPixelFlow/=h,this._panPixelFlow/=h,this._rotatePixelFlow/=
h)}get rotateTime(){return this.definition.hasRotate?n.Seconds(this._rotatePixels/this._rotatePixelFlow):n.Seconds(0)}get zoomTime(){return this.definition.hasZoom?n.Seconds(Math.log(this.definition.compared.sourceZoom/this.definition.compared.targetZoom)/Math.LN2*this._zoomSign*this.definition.halfWindowSize/this._zoomPixelFlow):n.Seconds(0)}get fovTime(){return this.definition.hasFov?n.Seconds(Math.abs(this.definition.compared.fov)/p):n.Seconds(0)}get panTime(){if(!this.definition.hasPan)return n.Seconds(0);
if(this.definition.hasZoom){const h=-1/(this._zoomSign*this.definition.halfWindowSize)*Math.LN2;return n.Seconds(Math.log(this._zoomPixelFlow/this._panPixelFlow*this._panPixelsAtSource*h+1)/(h*this._zoomPixelFlow))}return n.Seconds(this._panPixelsAtSource/this._panPixelFlow)}_interpolateComponentsZoom(h){if(0===h||1===h)return h;if(this.definition.hasZoom){const e=this.definition.compared.sourceZoom,g=this.definition.compared.targetZoom;return(e*(e/g)**-h-e)/(g-e)}return h}_interpolateComponentsFov(h){if(0===
h)return this.definition.segmentStart;if(1===h)return this.definition.segmentEnd;if(this.definition.hasFov){const {segmentStart:e,segmentEnd:g}=this.definition;return e+h*(g-e)}return this.definition.segmentStart}_interpolateComponentsPan(h){if(0===h||1===h)return h;if(this.definition.hasPan&&this.definition.hasZoom){const e=-1/(this._zoomSign*this.definition.halfWindowSize)*this._zoomPixelFlow;return 1/this._panPixelsAtSource*this._panPixelFlow*(2**(e*h*this._time)-1)/(e*Math.LN2)}return h}_interpolateComponentsRotate(h){return h}interpolateComponentsAt(h,
e){h=Math.min(Math.max(h,0),1);e.zoom=this._interpolateComponentsZoom(h);e.pan=this._interpolateComponentsPan(h);e.rotate=this._interpolateComponentsRotate(h);e.zoomOffset=0;e.fov=this._interpolateComponentsFov(h)}}const p=b.deg2rad(45);a.Segment=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/animation/pointToPoint/apex/planning":function(){define(["exports","./functions"],function(a,b){function n(k,p){const h=Math.max(k.compared.sourceZoom,k.compared.targetZoom);k=
k.source.zoomAtPixelsPerPan(k.desiredPixelFlow/k.compared.pan)/2;return k<h?null!=p.maximumDistance?h+(p.maximumDistance-h)/2:1.5*h:p.maximumDistance?Math.min(p.maximumDistance,k):k}a.optimalDistance=function(k,p){let h=n(k,p);const e={ascensionFactor:null!=p.ascensionFactor?p.ascensionFactor:.5,descensionFactor:null!=p.descensionFactor?p.descensionFactor:.5};var g=0===e.ascensionFactor,d=0===e.descensionFactor;const f=g?b.tAscensionZoomOnly:b.tAscensionZoomPan,c=g?b.dtAscensionZoomOnly:b.dtAscensionZoomPan,
l=g?b.ddtAscensionZoomOnly:b.ddtAscensionZoomPan,w=d?b.tDescensionZoomOnly:b.tDescensionZoomPan,x=d?b.dtDescensionZoomOnly:b.dtDescensionZoomPan,u=d?b.ddtDescensionZoomOnly:b.ddtDescensionZoomPan;g=z=>f(k,z,e)+b.tPanion(k,z,e)+w(k,z,e);d=z=>c(k,z,e)+b.dtPanion(k,z,e)+x(k,z,e);const t=z=>l(k,z,e)+b.ddtPanion(k,z,e)+u(k,z,e);let m=g(h);const q=b.tBaseLine(k);let r;const v=p.maximumIterations||20,y=null!=p.maximumDistance?p.maximumDistance:Infinity;for(r=0;r<v;r++){var B=p.desiredSlope??1E-6;let z=d(h);
Math.abs(z)>B&&(z+=B);B=z/t(h);if(isNaN(B)||h>=y&&0>B){if(!isFinite(y))return null;h=y;m=g(h);break}h-=B;if(h<k.compared.sourceZoom||h<k.compared.targetZoom)return null;B=g(h);if(.005>=Math.abs(B-m)/m)break;m=B}return m>.7*q||h<k.compared.sourceZoom||h<k.compared.targetZoom?null:h};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/animation/pointToPoint/apex/functions":function(){define(["exports"],function(a){a.ddtAscensionZoomOnly=function(b,n){return-b.halfWindowSize/
(n*n*b.desiredPixelFlow*Math.LN2)};a.ddtAscensionZoomPan=function(b,n,k){const p=n-b.compared.sourceZoom,h=1/p,e=1/n,g=Math.log(b.compared.sourceZoom*e);k=(k.ascensionFactor*Math.LN2*b.compared.pan+b.halfWindowPanAtZoom(p))/b.halfWindowPanAtZoom(1);return b.halfWindowSize*h*(-2*h*e*k+2*h*g+2*e-2*g*k/(p*p)-k/(n*n))/(b.desiredPixelFlow*Math.LN2)};a.ddtDescensionZoomOnly=function(b,n){return-b.halfWindowSize/(n*n*b.desiredPixelFlow*Math.LN2)};a.ddtDescensionZoomPan=function(b,n,k){const p=n-b.compared.targetZoom,
h=1/p,e=1/n,g=Math.log(n/b.compared.targetZoom);k=(b.halfWindowPanAtZoom(n)+k.descensionFactor*Math.LN2*b.compared.pan-b.halfWindowPanAtZoom(b.compared.targetZoom))/b.halfWindowPanAtZoom(1);return b.halfWindowSize*h*(-2*h*e*k-2*h*g+2*e+2*g*k/(p*p)-k/(n*n))/(b.desiredPixelFlow*Math.LN2)};a.ddtPanion=function(b,n,k){return-2*b.compared.pan*b.halfWindowSize*(k.ascensionFactor+k.descensionFactor-1)/(b.desiredPixelFlow*b.halfWindowPanAtZoom(n*n*n))};a.dtAscensionZoomOnly=function(b,n){return b.halfWindowSize/
(n*b.desiredPixelFlow*Math.LN2)};a.dtAscensionZoomPan=function(b,n,k){const p=1/n,h=Math.log(b.compared.sourceZoom*p),e=1/b.desiredPixelFlow,g=1/Math.LN2;n-=b.compared.sourceZoom;const d=1/n;k=(k.ascensionFactor*Math.LN2*b.compared.pan+b.halfWindowPanAtZoom(n))/b.halfWindowPanAtZoom(1);return b.halfWindowSize*p*e*g*d*k-b.halfWindowSize*h*e*g*d+b.halfWindowSize*h*e*g*k/(n*n)};a.dtDescensionZoomOnly=function(b,n){return b.halfWindowSize/(n*b.desiredPixelFlow*Math.LN2)};a.dtDescensionZoomPan=function(b,
n,k){const p=Math.log(n/b.compared.targetZoom),h=1/b.desiredPixelFlow,e=1/Math.LN2,g=-n+b.compared.targetZoom,d=1/g;k=(-b.halfWindowPanAtZoom(n)-k.descensionFactor*Math.LN2*b.compared.pan+b.halfWindowPanAtZoom(b.compared.targetZoom))/b.halfWindowPanAtZoom(1);return-b.halfWindowSize*p*h*e*d+b.halfWindowSize*p*h*e*k/(g*g)+b.halfWindowSize*h*e*d*k/n};a.dtPanion=function(b,n,k){return b.compared.pan*b.halfWindowSize*(k.ascensionFactor+k.descensionFactor-1)/(b.desiredPixelFlow*b.halfWindowPanAtZoom(n*
n))};a.tAscensionZoomOnly=function(b,n){return-b.halfWindowSize*Math.log(b.compared.sourceZoom/n)/(b.desiredPixelFlow*Math.LN2)};a.tAscensionZoomPan=function(b,n,k){const p=b.halfWindowPanAtZoom(n-b.compared.sourceZoom);return-b.halfWindowSize*(k.ascensionFactor*Math.LN2*b.compared.pan+p)*Math.log(b.compared.sourceZoom/n)/(b.desiredPixelFlow*Math.LN2*p)};a.tBaseLine=function(b){var n=b.compared.sourceZoom-b.compared.targetZoom;if(0===n)return b.compared.pan*b.halfWindowSize/(b.desiredPixelFlow*b.halfWindowPanAtZoom(b.compared.sourceZoom));
const k=Math.LN2*b.compared.pan;n=b.halfWindowPanAtZoom(n);const p=b.halfWindowSize*Math.log(b.compared.sourceZoom/b.compared.targetZoom)/(b.desiredPixelFlow*Math.LN2*n);return b.compared.sourceZoom<=b.compared.targetZoom?p*(k-n):p*(k+n)};a.tDescensionZoomOnly=function(b,n){return b.halfWindowSize*Math.log(n/b.compared.targetZoom)/(b.desiredPixelFlow*Math.LN2)};a.tDescensionZoomPan=function(b,n,k){return b.halfWindowSize*(-b.halfWindowPanAtZoom(n)-k.descensionFactor*Math.LN2*b.compared.pan+b.halfWindowPanAtZoom(b.compared.targetZoom))*
Math.log(n/b.compared.targetZoom)/(b.desiredPixelFlow*Math.LN2*b.halfWindowPanAtZoom(-n+b.compared.targetZoom))};a.tPanion=function(b,n,k){return-b.compared.pan*b.halfWindowSize*(k.ascensionFactor+k.descensionFactor-1)/(b.desiredPixelFlow*b.halfWindowPanAtZoom(n))};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/controllers/AnimationController":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/Logger ../../../../core/has ../../../../core/RandomLCG ../../../../core/Error ../../../../core/accessorSupport/decorators/subclass ../../../ViewAnimation ./CameraController".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c){a.AnimationController=class extends c.CameraController{constructor(){super(...arguments);this._asyncResult=null}get canStop(){return!0}set asyncResult(l){this._asyncResult&&(this._asyncResult.reject(k.createAbortError()),this._asyncResult=null);this.state===c.State.Finished||this.state===c.State.Stopped?(n.assertIsSome(l),this.state===c.State.Finished?l.resolve():l.reject(k.createAbortError())):this._asyncResult=l}get asyncResult(){return this._asyncResult}onControllerStart(){this.state=
c.State.Running;null!=this.viewAnimation&&this.viewAnimation.when(()=>this.updateStateFromViewAnimation(),()=>this.updateStateFromViewAnimation())}updateStateFromViewAnimation(){!this.viewAnimation||this.state!==c.State.Ready&&this.state!==c.State.Running||(this.viewAnimation.state===f.State.FINISHED?this.finish():this.viewAnimation.state===f.State.STOPPED&&(this.state=c.State.Stopped))}onControllerEnd(l){null==this.viewAnimation||this.viewAnimation.done||(this.state===c.State.Finished?this.viewAnimation.finish():
this.state===c.State.Stopped&&this.viewAnimation.stop());this._asyncResult&&(this.state===c.State.Finished?this._asyncResult.resolve():this._asyncResult.reject(k.createAbortError()))}finish(){this.finishController()}};a.AnimationController=b.__decorate([d.subclass("esri.views.3d.state.controllers.AnimationController")],a.AnimationController);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/controllers/CameraController":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/Logger ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,n,k,p,h,e,g){a.State=void 0;(function(d){d[d.Ready=0]="Ready";d[d.Rejected=1]="Rejected";d[d.Running=2]="Running";d[d.Stopped=3]="Stopped";d[d.Finished=4]="Finished"})(a.State||(a.State={}));a.CameraController=class extends n{constructor(d){super(d);this.state=a.State.Ready}get running(){return this.state===a.State.Running}get isInteractive(){return!1}get canStop(){return!1}stopController(){return this.canStop?(this.state=a.State.Stopped,!0):!1}finishController(){this.state=a.State.Finished}get steppingFinished(){return!1}};
b.__decorate([k.property({constructOnly:!0})],a.CameraController.prototype,"view",void 0);b.__decorate([k.property({readOnly:!0})],a.CameraController.prototype,"running",null);b.__decorate([k.property()],a.CameraController.prototype,"state",void 0);b.__decorate([k.property({readOnly:!0})],a.CameraController.prototype,"isInteractive",null);a.CameraController=b.__decorate([g.subclass("esri.views.3d.state.controllers.CameraController")],a.CameraController);Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/views/3d/webgl/RenderCamera":function(){define("../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/Logger ../../../core/mathUtils ../../../core/screenUtils ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ../../../core/libs/gl-matrix-2/math/mat4 ../../../core/libs/gl-matrix-2/factories/mat4f64 ../../../core/libs/gl-matrix-2/math/vec2 ../../../core/libs/gl-matrix-2/factories/vec2f64 ../../../chunks/vec32 ../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../chunks/vec42 ../../../core/libs/gl-matrix-2/factories/vec4f64 ../../../geometry/support/frustum ../../../geometry/support/ray ../../../geometry/support/vector ../../ViewingMode ../webgl-engine/lib/fov ../webgl-engine/lib/rendererUtils".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w,x,u,t,m,q,r,v,y,B,z){var A;b=A=class extends b{constructor(D){super(D);this._ray=r.create();this._viewport=m.fromValues(0,0,1,1);this._padding=m.fromValues(0,0,0,0);this._fov=55/180*Math.PI;this._nearFar=w.fromValues(1,1E3);this._viewDirty=!0;this._viewMatrix=c.create();this._viewProjectionDirty=!0;this._viewProjectionMatrix=c.create();this._viewInverseTransposeMatrixDirty=!0;this._viewInverseTransposeMatrix=c.create();this._frustumDirty=!0;this._frustum=q.create();
this._fullViewport=m.create();this._pixelRatio=1;this.column=this.row=0;this._columns=this._rows=1;this._center=u.create();this._up=u.create();this.relativeElevation=0}get pixelRatio(){return this._pixelRatio}set pixelRatio(D){this._pixelRatio=0<D?D:1}get rows(){return this._rows}set rows(D){this._rows=Math.max(1,D)}get columns(){return this._columns}set columns(D){this._columns=Math.max(1,D)}get eye(){return this._ray.origin}set eye(D){this._compareAndSetView(D,this._ray.origin)}get center(){return this._center}set center(D){this._compareAndSetView(D,
this._center,"_center")}get ray(){x.subtract(this._ray.direction,this.center,this.eye);return this._ray}get up(){return this._up}set up(D){this._compareAndSetView(D,this._up,"_up")}get viewMatrix(){this._ensureViewClean();return this._viewMatrix}set viewMatrix(D){f.copy(this._viewMatrix,D);this.notifyChange("_viewMatrix");this._viewDirty=!1;this._frustumDirty=this._viewProjectionDirty=this._viewInverseTransposeMatrixDirty=!0}get viewForward(){this._ensureViewClean();return x.set(u.create(),-this._viewMatrix[2],
-this._viewMatrix[6],-this._viewMatrix[10])}get viewUp(){this._ensureViewClean();return x.set(u.create(),this._viewMatrix[1],this._viewMatrix[5],this._viewMatrix[9])}get viewRight(){this._ensureViewClean();return x.set(u.create(),this._viewMatrix[0],this._viewMatrix[4],this._viewMatrix[8])}get nearFar(){return this._nearFar}get near(){return this._nearFar[0]}set near(D){this._nearFar[0]!==D&&(this._nearFar[0]=D,this._frustumDirty=this._viewProjectionDirty=!0,this.notifyChange("_nearFar"))}get far(){return this._nearFar[1]}set far(D){this._nearFar[1]!==
D&&(this._nearFar[1]=D,this._frustumDirty=this._viewProjectionDirty=!0,this.notifyChange("_nearFar"))}get viewport(){return this._viewport}set viewport(D){this.x=D[0];this.y=D[1];this.width=D[2];this.height=D[3]}get screenViewport(){if(1===this.pixelRatio)return this._viewport;const D=t.scale(m.create(),this._viewport,1/this.pixelRatio),I=this._get("screenViewport");return I&&t.equals(D,I)?I:D}get screenPadding(){if(1===this.pixelRatio)return this._padding;const D=t.scale(m.create(),this._padding,
1/this.pixelRatio),I=this._get("screenPadding");return I&&t.equals(D,I)?I:D}get x(){return this._viewport[0]}set x(D){D+=this._padding[z.PaddingSide.LEFT];this._viewport[0]!==D&&(this._viewport[0]=D,this._frustumDirty=this._viewProjectionDirty=!0,this.notifyChange("_viewport"))}get y(){return this._viewport[1]}set y(D){D+=this._padding[z.PaddingSide.BOTTOM];this._viewport[1]!==D&&(this._viewport[1]=D,this._frustumDirty=this._viewProjectionDirty=!0,this.notifyChange("_viewport"))}get width(){return this._viewport[2]}set width(D){this._viewport[2]!==
D&&(this._viewport[2]=D,this._frustumDirty=this._viewProjectionDirty=!0,this.notifyChange("_viewport"))}get height(){return this._viewport[3]}set height(D){this._viewport[3]!==D&&(this._viewport[3]=D,this._frustumDirty=this._viewProjectionDirty=!0,this.notifyChange("_viewport"))}get fullWidth(){return this._viewport[2]+this._padding[z.PaddingSide.RIGHT]+this._padding[z.PaddingSide.LEFT]}set fullWidth(D){this.width=D-(this._padding[z.PaddingSide.RIGHT]+this._padding[z.PaddingSide.LEFT])}get fullHeight(){return this._viewport[3]+
this._padding[z.PaddingSide.TOP]+this._padding[z.PaddingSide.BOTTOM]}set fullHeight(D){this.height=D-(this._padding[z.PaddingSide.TOP]+this._padding[z.PaddingSide.BOTTOM])}get fullViewport(){this._fullViewport[0]=this._viewport[0]-this._padding[z.PaddingSide.LEFT];this._fullViewport[1]=this._viewport[1]-this._padding[z.PaddingSide.BOTTOM];this._fullViewport[2]=this.fullWidth;this._fullViewport[3]=this.fullHeight;return this._fullViewport}get _aspect(){return this.width/this.height}get padding(){return this._padding}set padding(D){t.exactEquals(this._padding,
D)||(this._viewport[0]+=D[z.PaddingSide.LEFT]-this._padding[z.PaddingSide.LEFT],this._viewport[1]+=D[z.PaddingSide.BOTTOM]-this._padding[z.PaddingSide.BOTTOM],this._viewport[2]-=D[z.PaddingSide.RIGHT]+D[z.PaddingSide.LEFT]-(this._padding[z.PaddingSide.RIGHT]+this._padding[z.PaddingSide.LEFT]),this._viewport[3]-=D[z.PaddingSide.TOP]+D[z.PaddingSide.BOTTOM]-(this._padding[z.PaddingSide.TOP]+this._padding[z.PaddingSide.BOTTOM]),t.copy(this._padding,D),this._frustumDirty=this._viewProjectionDirty=!0,
this.notifyChange("_padding"),this.notifyChange("_viewport"))}get viewProjectionMatrix(){this._viewProjectionDirty&&(f.multiply(this._viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),this._viewProjectionDirty=!1);return this._viewProjectionMatrix}get projectionMatrix(){return this._projectionMatrixInternal}get inverseProjectionMatrix(){return f.invert(c.create(),this.projectionMatrix)||this._get("inverseProjectionMatrix")||c.create()}get fov(){return this._fov}set fov(D){this._fov=D;this._frustumDirty=
this._viewProjectionDirty=!0}get fovX(){return B.fovd2fovx(this._fov,this.width,this.height)}set fovX(D){this._fov=B.fovx2fovd(D,this.width,this.height);this._frustumDirty=this._viewProjectionDirty=!0}get fovY(){return B.fovd2fovy(this._fov,this.width,this.height)}set fovY(D){this._fov=B.fovy2fovd(D,this.width,this.height);this._frustumDirty=this._viewProjectionDirty=!0}get distance(){return x.distance(this.center,this.eye)}get frustum(){this._recomputeFrustum();return this._frustum}get viewInverseTransposeMatrix(){if(this._viewInverseTransposeMatrixDirty||
this._viewDirty)f.invert(this._viewInverseTransposeMatrix,this.viewMatrix),f.transpose(this._viewInverseTransposeMatrix,this._viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1;return this._viewInverseTransposeMatrix}depthNDCToWorld(D){return 2*this.near*this.far/(this.far+this.near-(2*D-1)*(this.far-this.near))}get perRenderPixelRatio(){return Math.tan(this.fovX/2)/(this.width/2)}get perScreenPixelRatio(){return this.perRenderPixelRatio*this.pixelRatio}get aboveGround(){return null!=
this.relativeElevation&&0<=this.relativeElevation}get _projectionMatrixInternal(){var D=this.width,I=this.height,J=this.near*Math.tan(this.fovY/2)*2,N=J*this._aspect,M=J/this.rows,Q=N/this.columns;N=-N/2+this.column*Q;Q=N+Q;J=-J/2+this.row*M;M=J+M;D=f.frustum(c.create(),N*(1+2*this._padding[z.PaddingSide.LEFT]/D),Q*(1+2*this._padding[z.PaddingSide.RIGHT]/D),J*(1+2*this._padding[z.PaddingSide.BOTTOM]/I),M*(1+2*this._padding[z.PaddingSide.TOP]/I),this.near,this.far);return(I=this._get("projectionMatrix"))&&
f.equals(I,D)?I:D}copyFrom(D){x.copy(this._ray.origin,D.eye);this.center=D.center;this.up=D.up;t.copy(this._viewport,D.viewport);this.notifyChange("_viewport");t.copy(this._padding,D.padding);this.notifyChange("_padding");l.copy(this._nearFar,D.nearFar);this.notifyChange("_nearFar");this._fov=D.fov;this.row=D.row;this.column=D.column;this.rows=D.rows;this.columns=D.columns;this.relativeElevation=D.relativeElevation;this._viewDirty=D._viewDirty;this._viewDirty||(f.copy(this._viewMatrix,D.viewMatrix),
this.notifyChange("_viewMatrix"));this._viewProjectionDirty=!0;this._frustumDirty=D._frustumDirty;this._frustumDirty||(q.copy(this._frustum,D.frustum),this._frustumDirty=!1);D._viewInverseTransposeMatrixDirty?this._viewInverseTransposeMatrixDirty=!0:(f.copy(this._viewInverseTransposeMatrix,D.viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1);t.copy(this._fullViewport,D.fullViewport);this.pixelRatio=D.pixelRatio;return this}copyViewFrom(D){this.eye=D.eye;this.center=D.center;this.up=
D.up;this.fov=D.fov}clone(){return(new A).copyFrom(this)}equals(D){return x.exactEquals(this.eye,D.eye)&&x.exactEquals(this.center,D.center)&&x.exactEquals(this.up,D.up)&&t.exactEquals(this._viewport,D.viewport)&&t.exactEquals(this._padding,D.padding)&&l.exactEquals(this.nearFar,D.nearFar)&&this._fov===D.fov&&this.pixelRatio===D.pixelRatio&&this.relativeElevation===D.relativeElevation&&this.row===D.row&&this.column===D.column&&this.rows===D.rows&&this.columns===D.columns}almostEquals(D){var I=Math.max(1,
1/this.pixelRatio,1/D.pixelRatio);if(.001<=Math.abs(D.fov-this._fov)||t.squaredDistance(D.screenPadding,this.screenPadding)>=I||t.squaredDistance(this.screenViewport,D.screenViewport)>=I||this.row!==D.row||this.column!==D.column||this.rows!==D.rows||this.columns!==D.columns)return!1;x.sub(E,D.eye,D.center);x.sub(F,this.eye,this.center);I=x.dot(E,F);const J=x.sqrLen(E),N=x.sqrLen(F);return I*I>=(1-1E-10)*J*N&&x.sqrDist(D.eye,this.eye)<2.5E-7*Math.max(J,N)}computeRenderPixelSizeAt(D){return this.computeRenderPixelSizeAtDist(this._viewDirectionDistance(D))}computeRenderPixelSizeAtDist(D){return D*
this.perRenderPixelRatio}computeScreenPixelSizeAt(D){return this.computeScreenPixelSizeAtDist(this._viewDirectionDistance(D))}_viewDirectionDistance(D){return Math.abs(v.projectPointSignedLength(this.viewForward,x.subtract(E,D,this.eye)))}computeScreenPixelSizeAtDist(D){return D*this.perScreenPixelRatio}computeDistanceFromRadius(D,I){return D/Math.tan(Math.min(this.fovX,this.fovY)/(2*(I||1)))}getScreenCenter(D=p.createScreenPointArray()){D[0]=(this.padding[z.PaddingSide.LEFT]+this.width/2)/this.pixelRatio;
D[1]=(this.padding[z.PaddingSide.TOP]+this.height/2)/this.pixelRatio;return D}getRenderCenter(D,I=.5,J=.5){D[0]=this.padding[z.PaddingSide.LEFT]+this.width*I;D[1]=this.padding[z.PaddingSide.BOTTOM]+this.height*J;D[2]=.5;return D}setGLViewport(D){const I=this.viewport,J=this.padding;D.setViewport(I[0]-J[3],I[1]-J[2],I[2]+J[1]+J[3],I[3]+J[0]+J[2])}applyProjection(D,I){D!==C&&x.copy(C,D);C[3]=1;t.transformMat4(C,C,this.projectionMatrix);D=Math.abs(C[3]);x.scale(C,C,1/D);const J=this.fullViewport;I[0]=
k.lerp(0,J[0]+J[2],.5+.5*C[0]);I[1]=k.lerp(0,J[1]+J[3],.5+.5*C[1]);I[2]=.5*(C[2]+1);I[3]=D}unapplyProjection(D,I){const J=this.fullViewport;C[0]=(D[0]/(J[0]+J[2])*2-1)*D[3];C[1]=(D[1]/(J[1]+J[3])*2-1)*D[3];C[2]=(2*D[2]-1)*D[3];C[3]=D[3];null!=this.inverseProjectionMatrix&&(t.transformMat4(C,C,this.inverseProjectionMatrix),I[0]=C[0],I[1]=C[1],I[2]=C[2])}projectToScreen(D,I){this.projectToRenderScreen(D,G);this.renderToScreen(G,I);return I}projectToRenderScreen(D,I){C[0]=D[0];C[1]=D[1];C[2]=D[2];C[3]=
1;t.transformMat4(C,C,this.viewProjectionMatrix);if(0===C[3])return null;D=C;x.scale(D,D,1/Math.abs(C[3]));var J=this.fullViewport;const N=k.lerp(0,J[0]+J[2],.5+.5*D[0]);J=k.lerp(0,J[1]+J[3],.5+.5*D[1]);"x"in I?(I.x=N,I.y=J):(I[0]=N,I[1]=J,2<I.length&&(I[2]=.5*(D[2]+1)));return I}unprojectFromScreen(D,I){return this.unprojectFromRenderScreen(this.screenToRender(D,G),I)}unprojectFromRenderScreen(D,I){f.multiply(H,this.projectionMatrix,this.viewMatrix);if(!f.invert(H,H))return null;const J=this.fullViewport;
C[0]=2*(D[0]-J[0])/J[2]-1;C[1]=2*(D[1]-J[1])/J[3]-1;C[2]=2*D[2]-1;C[3]=1;t.transformMat4(C,C,H);if(0===C[3])return null;I[0]=C[0]/C[3];I[1]=C[1]/C[3];I[2]=C[2]/C[3];return I}constrainWindowSize(D,I,J,N){D*=this.pixelRatio;I*=this.pixelRatio;return[Math.round(Math.max(D-J/2,0)),Math.round(Math.max(this.fullHeight-I-N/2,0)),Math.round(J- -Math.min(D-J/2,0)- -Math.min(this.fullWidth-D-J/2,0)),Math.round(N- -Math.min(this.fullHeight-I-N/2,0)- -Math.min(I-N/2,0))]}computeUp(D){D===y.ViewingMode.Global?
this._computeUpGlobal():this._computeUpLocal()}screenToRender(D,I){const J=this.fullHeight-D[1]*this.pixelRatio;I[0]=D[0]*this.pixelRatio;I[1]=J;return I}renderToScreen(D,I){const J=(this.fullHeight-D[1])/this.pixelRatio;I[0]=D[0]/this.pixelRatio;I[1]=J}_computeUpGlobal(){x.subtract(E,this.center,this.eye);const D=x.length(this.center);1>D?(x.set(this._up,0,0,1),this._markViewDirty(),this.notifyChange("_up")):Math.abs(x.dot(E,this.center))>.9999*x.length(E)*D||(x.cross(this._up,E,this.center),x.cross(this._up,
this._up,E),x.normalize(this._up,this._up),this.notifyChange("_up"),this._markViewDirty())}_computeUpLocal(){x.direction(E,this.eye,this.center);.9999>=Math.abs(E[2])&&(x.scale(E,E,E[2]),x.set(this._up,-E[0],-E[1],1-E[2]),x.normalize(this._up,this._up),this.notifyChange("_up"),this._markViewDirty())}_compareAndSetView(D,I,J=""){"number"===typeof D[0]&&isFinite(D[0])&&"number"===typeof D[1]&&isFinite(D[1])&&"number"===typeof D[2]&&isFinite(D[2])?x.exactEquals(D,I)||(x.copy(I,D),this._markViewDirty(),
J.length&&this.notifyChange(J)):n.getLogger("esri.views.3d.webgl-engine.lib.RenderCamera").warn("RenderCamera vector contains invalid number, ignoring value")}_markViewDirty(){this._viewProjectionDirty=this._frustumDirty=this._viewDirty=!0}_recomputeFrustum(){this._frustumDirty&&(q.fromMatrix(this.viewMatrix,this.projectionMatrix,this._frustum),this._frustumDirty=!1)}_ensureViewClean(){this._viewDirty&&(f.lookAt(this._viewMatrix,this.eye,this.center,this.up),this.notifyChange("_viewMatrix"),this._viewDirty=
!1,this._viewInverseTransposeMatrixDirty=!0)}};a.__decorate([h.property()],b.prototype,"_viewport",void 0);a.__decorate([h.property()],b.prototype,"_padding",void 0);a.__decorate([h.property()],b.prototype,"_fov",void 0);a.__decorate([h.property()],b.prototype,"_nearFar",void 0);a.__decorate([h.property()],b.prototype,"_viewDirty",void 0);a.__decorate([h.property()],b.prototype,"_viewMatrix",void 0);a.__decorate([h.property()],b.prototype,"_pixelRatio",void 0);a.__decorate([h.property()],b.prototype,
"pixelRatio",null);a.__decorate([h.property()],b.prototype,"row",void 0);a.__decorate([h.property()],b.prototype,"column",void 0);a.__decorate([h.property()],b.prototype,"_rows",void 0);a.__decorate([h.property()],b.prototype,"rows",null);a.__decorate([h.property()],b.prototype,"_columns",void 0);a.__decorate([h.property()],b.prototype,"columns",null);a.__decorate([h.property()],b.prototype,"eye",null);a.__decorate([h.property()],b.prototype,"center",null);a.__decorate([h.property()],b.prototype,
"_center",void 0);a.__decorate([h.property()],b.prototype,"up",null);a.__decorate([h.property()],b.prototype,"_up",void 0);a.__decorate([h.property()],b.prototype,"viewMatrix",null);a.__decorate([h.property({readOnly:!0})],b.prototype,"viewForward",null);a.__decorate([h.property({readOnly:!0})],b.prototype,"viewUp",null);a.__decorate([h.property({readOnly:!0})],b.prototype,"viewRight",null);a.__decorate([h.property({readOnly:!0})],b.prototype,"nearFar",null);a.__decorate([h.property()],b.prototype,
"near",null);a.__decorate([h.property()],b.prototype,"far",null);a.__decorate([h.property()],b.prototype,"viewport",null);a.__decorate([h.property({readOnly:!0})],b.prototype,"screenViewport",null);a.__decorate([h.property({readOnly:!0})],b.prototype,"screenPadding",null);a.__decorate([h.property()],b.prototype,"x",null);a.__decorate([h.property()],b.prototype,"y",null);a.__decorate([h.property()],b.prototype,"width",null);a.__decorate([h.property()],b.prototype,"height",null);a.__decorate([h.property()],
b.prototype,"fullWidth",null);a.__decorate([h.property()],b.prototype,"fullHeight",null);a.__decorate([h.property({readOnly:!0})],b.prototype,"_aspect",null);a.__decorate([h.property()],b.prototype,"padding",null);a.__decorate([h.property({readOnly:!0})],b.prototype,"projectionMatrix",null);a.__decorate([h.property({readOnly:!0})],b.prototype,"inverseProjectionMatrix",null);a.__decorate([h.property()],b.prototype,"fov",null);a.__decorate([h.property()],b.prototype,"fovX",null);a.__decorate([h.property()],
b.prototype,"fovY",null);a.__decorate([h.property()],b.prototype,"viewInverseTransposeMatrix",null);a.__decorate([h.property({readOnly:!0})],b.prototype,"_projectionMatrixInternal",null);a.__decorate([h.property()],b.prototype,"relativeElevation",void 0);a=b=A=a.__decorate([d.subclass("esri.views.3d.webgl.RenderCamera")],b);const C=m.create(),H=c.create(),E=u.create(),F=u.create(),G=p.createRenderScreenPointArray3();return a})},"esri/views/3d/webgl-engine/lib/fov":function(){define(["exports"],function(a){a.fovd2fovx=
function(b,n,k){return 2*Math.atan(n*Math.tan(.5*b)/Math.sqrt(n*n+k*k))};a.fovd2fovy=function(b,n,k){return 2*Math.atan(k*Math.tan(.5*b)/Math.sqrt(n*n+k*k))};a.fovx2fovd=function(b,n,k){return 2*Math.atan(Math.sqrt(n*n+k*k)*Math.tan(.5*b)/n)};a.fovy2fovd=function(b,n,k){return 2*Math.atan(Math.sqrt(n*n+k*k)*Math.tan(.5*b)/k)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/rendererUtils":function(){define(["exports","./ChangeSet"],function(a,b){a.RendererTarget=
void 0;(function(n){n[n.Default=0]="Default";n[n.Screenshot=1]="Screenshot";n[n.ObjectAndLayerID=2]="ObjectAndLayerID"})(a.RendererTarget||(a.RendererTarget={}));a.PaddingSide=void 0;(function(n){n[n.TOP=0]="TOP";n[n.RIGHT=1]="RIGHT";n[n.BOTTOM=2]="BOTTOM";n[n.LEFT=3]="LEFT"})(a.PaddingSide||(a.PaddingSide={}));a.splitRenderGeometryChangeSetByMaterial=function(n){const k=new Map,p=h=>{let e=k.get(h);e||(e=new b.MaterialChangeSet,k.set(h,e));return e};n.removes.forAll(h=>{1<=h.geometry.indexCount&&
p(h.material).removes.push(h)});n.adds.forAll(h=>{1<=h.geometry.indexCount&&p(h.material).adds.push(h)});n.updates.forAll(h=>{1<=h.renderGeometry.geometry.indexCount&&p(h.renderGeometry.material).updates.push(h)});return k};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/ChangeSet":function(){define(["exports","../../../../core/PooledArray"],function(a,b){class n{constructor(){this.adds=new b;this.removes=new b;this.updates=new b({allocator:h=>h||new k,
deallocator:h=>{h.renderGeometry=null;return h}})}clear(){this.adds.clear();this.removes.clear();this.updates.clear()}prune(){this.adds.prune();this.removes.prune();this.updates.prune()}get empty(){return 0===this.adds.length&&0===this.removes.length&&0===this.updates.length}}class k{}class p{constructor(){this.adds=[];this.removes=[];this.updates=[]}}a.ChangeSet=n;a.MaterialChangeSet=p;a.RenderGeometryUpdate=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/utils/navigationUtils":function(){define("exports ../../../../core/Cyclical ../../../../core/mathUtils ../../../../core/screenUtils ../../../../core/libs/gl-matrix-2/math/mat4 ../../../../core/libs/gl-matrix-2/factories/mat4f64 ../../../../core/libs/gl-matrix-2/math/vec2 ../../../../core/libs/gl-matrix-2/factories/vec2f64 ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../geometry/support/axisAngle ../../../../geometry/support/coordinateSystem ../../../../geometry/support/plane ../../../../chunks/sphere ../../../../geometry/support/vectorStacks ../../support/geometryUtils/ray ../../support/geometryUtils/sphere ../../webgl/RenderCamera ../../webgl-engine/lib/verticalOffsetUtils".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w,x,u,t,m,q,r){function v(sa,xa,ta){ta=p.fromRotation(u.sm4d.get(),ta[3],c.axis(ta));null==ta||p.exactEquals(ta,h.IDENTITY)||(d.subtract(ja,sa.eye,xa),d.transformMat4(ja,ja,ta),sa.eye=d.add(ja,ja,xa),d.subtract(ja,sa.center,xa),d.transformMat4(ja,ja,ta),sa.center=d.add(ja,ja,xa),sa.up=d.transformMat4(ja,sa.up,ta))}function y(sa,xa,ta,Ba){return Math.sin(sa/d.length(xa))*(ta+Ba.radius)}function B(sa,xa,ta,Ba){ta=t.fromScreenAtEye(xa,ta,na);if(null==ta)return!1;x.closestPointOnSilhouette(sa,
ta,K);return x.intersectRay(sa,ta,Ba)?d.squaredDistance(K,ta.origin)<d.squaredDistance(Ba,ta.origin)?(d.copy(Ba,K),!1):!0:(d.subtract(L,xa.eye,xa.center),d.normalize(L,L),w.fromNormalAndOffset(L,-d.dot(d.normalize(L,L),K),P),w.intersectRay(P,ta,Ba),!1)}function z(sa,xa,ta,Ba,Ia,Ca){var Ha=0;d.cross(pa,sa,xa);d.subtract(X,sa,xa);d.length(sa)<=Ia||!Ba.aboveGround?(d.cross(ta,X,Ba.eye),Ha=d.dot(sa,xa)/(d.length(sa)*d.length(xa)),.9999>Ha?Ha=n.acosClamped(Ha):(sa=d.length(d.cross(f.create(),sa,xa))/(d.length(sa)*
d.length(xa)),Ha=n.asinClamped(sa)),Ca=Math.cos(n.clamp(b.cyclicalPI.normalize(n.deg2rad(Ca)),0,Q)),Ha=-Ha-Math.max(0,d.length(xa)-Ia)/(Ca*Ia)):(d.subtract(R,Ba.eye,Ba.center),d.cross(ta,X,R),Ha=-d.length(X)/Ia);d.normalize(ta,ta);d.scale(ta,ta,d.length(pa));return Ha}function A(sa,xa,ta,Ba){Ba=Math.cos(n.clamp(b.cyclicalPI.normalize(n.deg2rad(Ba)),0,Q));xa=xa>ta?-(xa-ta)/(Ba*ta):xa<-ta?Math.PI-(xa+ta)/(Ba*ta):n.acosClamped(xa/ta);return((sa>ta?-(sa-ta)/(Ba*ta):sa<-ta?Math.PI-(sa+ta)/(Ba*ta):n.acosClamped(sa/
ta))-xa)*ta}function C(sa,xa,ta,Ba,Ia,Ca,Ha,Ga,Aa,Ja){Ga=A(sa[2],xa[2],Ca[3],Ga);xa=Aa?A(sa[0],xa[0],Ca[3],180):xa[0]-sa[0];sa=Math.sin(Ha)*xa-Math.cos(Ha)*Ga;Ha=Math.cos(Ha)*xa+Math.sin(Ha)*Ga;d.normalize(ja,Ia);Ia=Aa?sa/Math.sqrt(Math.abs(Ca[3]**2-d.dot(ta,ja)**2)):sa/Ca[3];ta=Ha/Math.sqrt(Math.abs(Ca[3]**2-d.dot(ta,Ba)**2));e.set(Ja,Ia,ta)}function H(sa,xa,ta,Ba,Ia,Ca,Ha,Ga,Aa,Ja){d.cross(pa,sa,xa);l.coordinateSystemFromOneAxisAndNormalVector(Ca.up,Ca.eye,U,da,fa);l.coordinateSystemFromOneAxisAndNormalVector([0,
0,1],Ca.eye,W,V,ba);d.copy(ta,V);d.copy(Ba,W);d.normalize(ta,ta);d.scale(ta,ta,d.length(pa));l.vectorCoordinates(sa,d.normalize(da,da),d.normalize(fa,fa),d.normalize(U,U),ha);l.vectorCoordinates(xa,da,fa,U,T);C(ha,T,sa,W,V,Ha,Ga,Aa,Ja,Ia)}function E(sa,xa,ta,Ba,Ia,Ca,Ha){p.fromRotation(ia,Ia,Ba);p.fromRotation(Y,Ha,Ca);p.multiply(ea,ia,Y);d.subtract(xa,sa,ta);d.transformMat4(xa,xa,ea);d.add(xa,xa,ta)}function F(sa,xa,ta,Ba,Ia,Ca){p.fromRotation(ia,Ba,ta);p.fromRotation(Y,Ca,Ia);p.multiply(ea,ia,Y);
d.subtract(ja,sa.eye,xa);d.transformMat4(ja,ja,ea);sa.eye=d.add(ja,ja,xa);d.subtract(ja,sa.center,xa);d.transformMat4(ja,ja,ea);sa.center=d.add(ja,ja,xa);d.subtract(ja,sa.up,xa);d.transformMat4(ja,ja,ea);sa.up=d.add(ja,ja,xa)}function G(sa,xa,ta,Ba,Ia,Ca){return(Math.abs(Ba)>Math.PI-M.Angle||Math.abs(Ba)<M.Angle)&&(Math.abs(sa[2])<ta*M.Pole||Math.abs(xa)>ta)&&Ca.aboveGround&&Ia<M.Tilt}function D(sa,xa,ta,Ba,Ia,Ca){Ca?(c.fromPoints(ta,Ba,Z),v(xa,x.getCenter(sa),Z)):(ta=z(ta,Ba,la,xa,sa[3],Ia),v(xa,
x.getCenter(sa),c.wrapAxisAngle(la,ta)))}function I(sa,xa,ta,Ba,Ia,Ca,Ha){const Ga=Ha?20:1;d.copy(ka,Ba);aa.copyFrom(xa);let Aa;for(let Ja=0;Ja<Ga&&1E-12<d.squaredDistance(ta,ka);Ja++)if(Ba=d.squaredDistance(ta,ka),H(ta,ka,V,W,S,aa,sa,Ia,Ca,Ha),F(aa,x.getCenter(sa),W,S[1],V,S[0]),E(ka,ka,x.getCenter(sa),W,S[1],V,S[0]),Aa=d.squaredDistance(ta,ka),Aa<Ba||0===Ja)xa.copyFrom(aa);else break}a.SpherePickPointFallback=void 0;(function(sa){sa[sa.Ellipsoid=0]="Ellipsoid";sa[sa.Silhouette=1]="Silhouette"})(a.SpherePickPointFallback||
(a.SpherePickPointFallback={}));r={exclude:new Set([r.terrainId])};const J=k.createScreenPointArray();a.NavigationMode=void 0;(function(sa){sa[sa.Vertical=0]="Vertical";sa[sa.Horizontal=1]="Horizontal"})(a.NavigationMode||(a.NavigationMode={}));const N={Elevation:3E4,Angle:n.deg2rad(16)},M={Pole:.95,Angle:n.deg2rad(18),Tilt:45},Q=n.deg2rad(80),O=f.create(),K=f.create(),L=f.create(),P=w.create(),R=f.create(),W=f.create(),V=f.create(),ba=f.create(),U=f.create(),da=f.create(),fa=f.create(),ha=f.create(),
T=f.create(),S=g.create(),Z=c.create(),ia=h.create(),Y=h.create(),ea=h.create(),ka=f.create(),ja=f.create(),X=f.create(),aa=new q,pa=f.create(),la=f.create(),na={origin:f.create(),direction:f.create()},qa={origin:f.create(),direction:f.create()};a.PreservingHeadingThreshold=M;a.TiltThresholdPanningSpeed=Q;a.VerticalPanTresholds=N;a.applyPanPlanar=function(sa,xa,ta){d.subtract(O,ta,xa);sa.eye=d.subtract(ja,sa.eye,O);sa.center=d.subtract(ja,sa.center,O)};a.applyPanSphericalDirectRotation=D;a.applyPanSphericalPreserveHeading=
I;a.applyRotation=v;a.applyRotationWithTwoAxes=F;a.applyZoomOnSphere=function(sa,xa,ta){xa.getScreenCenter(J);m.intersectScreen(sa,xa,J,ja)&&(xa.center=ja);sa=xa.distance;ta*=sa;1E-6>Math.abs(sa-ta)||(ta=d.scale(u.sv3d.get(),xa.viewForward,ta),xa.eye=d.subtract(ja,xa.center,ta))};a.applyZoomToPoint=function(sa,xa,ta,Ba){const Ia=u.sv3d.get();ta=1-ta;d.subtract(Ia,xa,sa.eye);const Ca=d.length(Ia);let Ha=Ca*(1-ta);0<=ta&&Ha<Ba&&(Ha=Ba,ta=-(Ha-Ca)/Ca);1E-6>Math.abs(Ca-Ha)||(d.scale(Ia,Ia,ta),sa.eye=
d.add(ja,sa.eye,Ia),sa.center=d.lerp(ja,sa.center,xa,ta))};a.centroid=function(sa,xa){d.set(xa,0,0,0);for(const ta of sa)d.add(xa,xa,ta);d.scale(xa,xa,1/sa.length)};a.contentIntersectorOptions=r;a.distanceClampValues=[1,3E8];a.intersectPlaneFromScreenPoint=function(sa,xa,ta,Ba){return w.intersectRay(sa,t.fromScreen(xa,ta,na),Ba)};a.intersectPlaneFromScreenPointAtEye=function(sa,xa,ta,Ba){return w.intersectRay(sa,t.fromScreenAtEye(xa,ta,na),Ba)};a.lengthFromPoints=A;a.minHeightLimit=50;a.navigationMode=
function(sa,xa,ta,Ba){const Ia=sa.relativeElevation;if(Ia>N.Elevation&&"global"===Ba)return a.NavigationMode.Horizontal;t.fromScreenAtEye(sa,xa,qa);xa=Math.sign(Ia);sa=ta.worldUpAtPosition(sa.eye,ja);return-xa*d.dot(sa,qa.direction)<Math.sin(N.Angle)*d.length(qa.direction)?a.NavigationMode.Vertical:a.NavigationMode.Horizontal};a.normalizeCoordinate=function(sa,xa,ta){ta[0]=xa[0]/(sa.fullWidth/sa.pixelRatio);ta[1]=xa[1]/(sa.fullHeight/sa.pixelRatio);return ta};a.normalizeRotationDelta=function(sa){for(;sa>
Math.PI;)sa-=2*Math.PI;for(;sa<-Math.PI;)sa+=2*Math.PI;return sa};a.offSurfaceTiltToEyeTiltGlobal=function(sa,xa,ta,Ba){return y(Math.PI/2,xa,ta,Ba)+(sa-Math.PI/2)};a.onSurfaceTiltToEyeTiltGlobal=y;a.panDistanceModifier=5;a.panMotionToRotationMatrix=function(sa,xa,ta,Ba,Ia,Ca,Ha,Ga,Aa){if(G(sa.center,d.dot(sa.up,sa.center),d.length(sa.center),-b.cyclicalPI.normalize(n.deg2rad(Ca)),Ha,xa))switch(sa=-b.cyclicalPI.normalize(n.deg2rad(Ia)),{eye:Ia}=xa,l.coordinateSystemFromOneAxisAndNormalVector([0,0,
1],Ia,W,V,ba),Ia=ta.translation[0]*Ba.pan,Ca="zoom"===Aa.mode?0:ta.translation[1]*Ba.pan,xa=Math.max(Math.sqrt(Math.abs(1-d.dot(xa.center,W)**2/d.length(xa.center)**2)),.5),Ha=-Math.cos(sa)*Ca+Math.sin(sa)*Ia,p.rotate(Ga.pan.matrix,Ga.pan.matrix,(Math.sin(sa)*Ca+Math.cos(sa)*Ia)/xa,W),Ga.pan.enabled=!0,Aa.mode){case "pan":p.rotate(Ga.pan.matrix,Ga.pan.matrix,Ha,V);Ga.pan.enabled=!0;break;case "zoom":Ga.zoom=-ta.translation[1]*Ba.zoom}else{const {eye:Ja,viewRight:Sa}=xa;xa=d.cross(u.sv3d.get(),Sa,
Ja);sa=ta.translation[0]*Ba.pan;0!==sa&&(p.rotate(Ga.pan.matrix,Ga.pan.matrix,-sa,xa),Ga.pan.enabled=!0);switch(Aa.mode){case "pan":ta=ta.translation[1]*Ba.pan;0!==ta&&(p.rotate(Ga.pan.matrix,Ga.pan.matrix,ta,Sa),Ga.pan.enabled=!0);break;case "zoom":Ga.zoom=-ta.translation[1]*Ba.zoom}}};a.panToPosition=function(sa,xa,ta,Ba,Ia,Ca,Ha){G(ta,d.dot(xa.up,ta),sa[3],-b.cyclicalPI.normalize(n.deg2rad(Ia)),Ca,xa)?I(sa,xa,ta,Ba,-b.cyclicalPI.normalize(n.deg2rad(Ia)),Ca,Ha):D(sa,xa,ta,Ba,Ca,Ha)};a.pickPointAndInitSphere=
function(sa,xa,ta,Ba,Ia,Ca){const Ha=f.create(),Ga=x.create();let Aa=!0,Ja=!0;sa.intersectScreen(ta,Ha,Ca)?Ga[3]=d.length(Ha):(Ja=!1,Ga[3]=xa.aboveGround&&Ia!==a.SpherePickPointFallback.Ellipsoid?Math.max(d.length(xa.center),.9*Ba.radius):d.length(xa.eye)-xa.relativeElevation,Ia===a.SpherePickPointFallback.Silhouette?B(Ga,xa,ta,Ha):Aa=m.intersectScreen(Ga,xa,ta,Ha));return{sphere:Ga,scenePickPoint:Aa?Ha:null,hasGeometryIntersection:Ja}};a.pivotDistanceModifier=30;a.preserveHeadingThreshold=G;a.rotatePivotDistanceModifier=
5;a.rotatePivotMinDistanceModifier=10;a.rotatePointAroundTwoAxes=E;a.rotateScreenPixelArea=90;a.rotationAngleAndAxisDirectRotation=z;a.rotationAnglesAndAxesHeadingPreserving=H;a.rotationAnglesHeadingPreserving=C;a.screenPixelArea=80;a.sphereOrPlanePointFromScreenPoint=B;a.zoomDistanceModifier=8;a.zoomMaxDistanceModifier=1508E5;a.zoomMinDistanceModifier=200;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/axisAngle":function(){define("exports ../../core/libs/gl-matrix-2/math/quat ../../core/libs/gl-matrix-2/factories/quatf64 ../../chunks/vec32 ./vector ./vectorStacks".split(" "),
function(a,b,n,k,p,h){function e(w=f){return[w[0],w[1],w[2],w[3]]}function g(w,x,u,t,m=e()){m[0]=w;m[1]=x;m[2]=u;m[3]=t;return m}function d(w,x){w[3]=x;return w}const f=[0,0,1,0],c=n.create(),l=n.create();a.angle=function(w){return w[3]};a.axis=function(w){return w};a.compose=function(w,x,u){b.setAxisAngle(c,w,w[3]);b.setAxisAngle(l,x,x[3]);b.multiply(c,l,c);return d(u,b.getAxisAngle(u,c))};a.copy=function(w,x=e()){return g(w[0],w[1],w[2],w[3],x)};a.create=e;a.fromAxisAndAngle=function(w,x){const u=
e();k.copy(u,w);u[3]=x;return u};a.fromPoints=function(w,x,u){k.cross(u,w,x);k.normalize(u,u);u[3]=p.angle(w,x);return u};a.fromValues=g;a.setAngle=d;a.up=f;a.wrap=function(w,x,u,t){return g(w,x,u,t,h.sv4d.get())};a.wrapAxisAngle=function(w,x){return g(w[0],w[1],w[2],x,h.sv4d.get())};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/geometryUtils/ray":function(){define("exports ../../../../core/screenUtils ../../../../core/libs/gl-matrix-2/math/vec2 ../../../../chunks/vec32 ../../../../geometry/support/ray ../../../../geometry/support/vectorStacks".split(" "),
function(a,b,n,k,p,h){function e(f,c,l){return g(f,f.screenToRender(c,b.castRenderScreenPointArray3(h.sv3d.get())),l)}function g(f,c,l){const w=b.castRenderScreenPointArray3(n.copy(h.sv3d.get(),c));w[2]=0;if(!f.unprojectFromRenderScreen(w,l.origin))return null;c=b.castRenderScreenPointArray3(n.copy(h.sv3d.get(),c));c[2]=1;f=f.unprojectFromRenderScreen(c,h.sv3d.get());if(null==f)return null;k.subtract(l.direction,f,l.origin);return l}function d(f,c,l){k.copy(l.origin,f.eye);c=k.set(h.sv3d.get(),c[0],
c[1],1);f=f.unprojectFromRenderScreen(c,h.sv3d.get());if(null==f)return null;k.subtract(l.direction,f,l.origin);return l}a.fromRender=g;a.fromRenderAtEye=d;a.fromScreen=e;a.fromScreenAtEye=function(f,c,l){return d(f,f.screenToRender(c,b.castRenderScreenPointArray3(h.sv3d.get())),l)};a.fromScreenNormalized=function(f,c,l=p.create()){e(f,b.screenPointObjectToArray(c),l);k.normalize(l.direction,l.direction);return l};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/geometryUtils/sphere":function(){define(["exports",
"../../../../geometry/support/ray","../../../../chunks/sphere","./ray"],function(a,b,n,k){const p=b.create();a.intersectScreen=function(h,e,g,d){e=k.fromScreenAtEye(e,g,p);return n.intersectRay(h,e,d)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/controllers/ZoomStepControllerLocal":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/mathUtils ../../../../core/time ../../../../core/Logger ../../../../core/has ../../../../core/RandomLCG ../../../../core/Error ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../camera/constraintUtils ../../camera/constraintUtils/ConstraintOptions ../../camera/constraintUtils/ConstraintTypes ../../camera/constraintUtils/InteractionType ../../layers/VoxelWasm ./PointToPointAnimationController ../utils/navigationUtils ../../webgl/RenderCamera ../../webgl-engine/lib/Intersector ../../../animation/easing".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w,x,u,t,m,q,r,v,y){a.ZoomStepControllerLocal=class extends m.PointToPointAnimationController{constructor(){super(...arguments);this._zoomLocation=c.create();this._tmpCamera=new r;this._tmpRayDir=c.create();this._tmpCenter=c.create();this._beginCamera=new r;this._constraintOptions=new w.ConstraintOptions(x.ConstraintTypes.ALL,u.InteractionType.ZOOM,null,this._beginCamera)}step(C,H){if(this.running){var E=this.view.state;this.animation.finished?this._beginCamera.copyFrom(E.camera):
this.animation.cameraAt(1,this._beginCamera);this._tmpCamera.copyFrom(E.camera);var F=v.newIntersector(this.view.state.viewingMode);E=!1;0<C?(E=this._intersectionHelper.intersectScreenFreePointFallback(H,this._zoomLocation,0===this.view.map.ground.opacity?q.contentIntersectorOptions:{}),this._intersectionHelper.intersectRay(this._tmpCamera.ray,F,this._tmpCenter)&&(this._tmpCamera.center=this._tmpCenter)):this._intersectionHelper.intersectRay(this._tmpCamera.ray,F,this._zoomLocation)?this._tmpCamera.center=
this._zoomLocation:f.copy(this._zoomLocation,this._tmpCamera.center);C=.6**C;H=this.view._stage.renderView.getMinimalDepthForArea(t.getVoxelWasm(this.view),H[0],H[1],this.view.state.camera,60);f.subtract(A,this._tmpCamera.eye,this._zoomLocation);f.normalize(A,A);F=n.clamp(Math.min(q.zoomDistanceModifier,1/Math.abs(f.dot(z,A)))*Math.abs(this.view.camera.position.z),q.zoomMinDistanceModifier,q.zoomMaxDistanceModifier);if(H=null!=H?H:F)if(F=c.create(),f.subtract(F,this._zoomLocation,this._tmpCamera.eye),
H<f.length(F)||!E)f.normalize(F,F),f.add(this._zoomLocation,this._tmpCamera.eye,f.scale(F,F,H));this._updateCamera(this._tmpCamera,C,this._zoomLocation);this.begin(this._tmpCamera)}}animationSettings(){return{duration:k.Milliseconds(600),easing:y.outExpo}}_updateCamera(C,H,E){f.subtract(this._tmpRayDir,E,C.eye);const F=f.length(this._tmpRayDir);let G=F*H;const D=Math.max(4,1.01*C.nearFar[0]);0!==G&&(1>=H&&G<D&&(G=D,H=G/F),1E-6>Math.abs(F-G)||(f.scale(this._tmpRayDir,this._tmpRayDir,H),C.eye=f.subtract(B,
E,this._tmpRayDir),C.center=f.lerp(B,C.center,E,1-H),l.applyAll(this.view,C,this._constraintOptions)))}};a.ZoomStepControllerLocal=b.__decorate([d.subclass("esri.views.3d.state.controllers.ZoomStepControllerLocal")],a.ZoomStepControllerLocal);const B=c.create(),z=c.fromValues(0,0,1),A=c.create();Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/VoxelWasm":function(){define(["require","exports"],function(a,b){let n,k=null;const p=new Map;b.addLayerViewToWasm=async function(h){null==
k&&(null==n&&(n=new Promise((d,f)=>a(["../../../layers/VoxelWasmPerSceneView"],c=>d(Object.freeze(Object.defineProperty({__proto__:null,default:c},Symbol.toStringTag,{value:"Module"}))),f))),k=await n);const e=h.view;let g=p.get(e);g||(g=new k.default({view:e}),p.set(e,g));return g.addVoxelLayer(h)};b.getVoxelWasm=function(h){return p.get(h)};b.removeLayerViewFromWasm=function(h){const e=h.view,g=p.get(e);g&&1>g.removeVoxelLayer(h)&&(p.delete(e),0===p.size&&(k=n=null))};Object.defineProperty(b,Symbol.toStringTag,
{value:"Module"})})},"esri/views/input/handlers/support":function(){define(["exports"],function(a){a.eventMatchesMousePointerAction=function(b,n){if("touch"===b.pointerType)return!1;switch(n){case "primary":return 0===b.button;case "secondary":return 2===b.button;case "tertiary":return 1===b.button}};a.eventMatchesPointerAction=function(b,n){switch(n){case "primary":return"touch"===b.pointerType||0===b.button;case "secondary":return"touch"!==b.pointerType&&2===b.button;case "tertiary":return"touch"!==
b.pointerType&&1===b.button}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/input/handlers/DragRotate":function(){define(["exports","../../../../core/screenUtils","../../state/controllers/RotateController","../../../input/InputHandler","../../../input/handlers/support"],function(a,b,n,k,p){class h extends k.InputHandler{constructor(e,g,d,f){super(!0);this._view=e;this.pointerAction=g;this._pivot=d;this.registerIncoming("drag",f,c=>this._handleDrag(c))}_handleDrag(e){const g=
e.data;if(!(1<g.pointers.size)&&p.eventMatchesMousePointerAction(e.data,this.pointerAction)){var d=b.createScreenPointArray(g.center.x,g.center.y);switch(g.action){case "start":this._cameraController&&(this._cameraController.end(),this._cameraController=null);this._cameraController=new n.RotateController({view:this._view,pivot:this._pivot});this._view.state.switchCameraController(this._cameraController);this._cameraController.begin(d);break;case "update":this._cameraController&&this._cameraController.update(d);
break;case "end":this._cameraController&&(this._cameraController.end(),this._cameraController=null)}e.stopPropagation()}}}Object.defineProperty(a,"PivotPoint",{enumerable:!0,get:()=>n.PivotPoint});a.DragRotate=h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/controllers/RotateController":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/mathUtils ../../../../core/screenUtils ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/Logger ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ../../../../core/libs/gl-matrix-2/math/mat4 ../../../../core/libs/gl-matrix-2/factories/mat4f64 ../../../../core/libs/gl-matrix-2/math/vec2 ../../../../core/libs/gl-matrix-2/factories/vec2f64 ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../camera/constraintUtils ../../camera/constraintUtils/ConstraintOptions ../../camera/constraintUtils/ConstraintTypes ../../camera/constraintUtils/InteractionType ../../camera/constraintUtils/TiltMode ../../layers/VoxelWasm ../Constraints ./InteractiveController ../utils/navigationUtils".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w,x,u,t,m,q,r,v,y,B,z,A){a.PivotPoint=void 0;(function(E){E[E.CENTER=0]="CENTER";E[E.EYE=1]="EYE"})(a.PivotPoint||(a.PivotPoint={}));a.RotateController=class extends z.InteractiveController{get _intersectionHelper(){return this.view.sceneIntersectionHelper}constructor(E){super(E);this.pivot=a.PivotPoint.CENTER;this._rotScale=0;this._lastPoint=w.create();this._tmpWorldUp=u.create();this._tmpViewDir=u.create();this._tmpRotCurPoint=w.create();this._tmpTransf=c.create();
this._tmpAxis=u.create();this._tmpPivotPoint=u.create();this._pivotPos=u.create();this._constraintOptions=new m.ConstraintOptions(q.ConstraintTypes.ALL,r.InteractionType.TUMBLE,0,this.startCamera)}initialize(){this._rotScale=this.pivot===a.PivotPoint.CENTER?3:1.5}begin(E){if(this.running){switch(this.pivot){case a.PivotPoint.EYE:x.copy(this._pivotPos,this.startCamera.eye);this._constraintOptions.interactionType=r.InteractionType.LOOK_AROUND;this._constraintOptions.tiltMode=v.TiltMode.LOOK_AROUND;
this._constraintOptions.selection=q.ConstraintTypes.NONE;break;case a.PivotPoint.CENTER:const F=this._intersectionHelper.intersectRayFreePointFallback(this.startCamera.ray,this._pivotPos,0===this.view.map.ground.opacity?A.contentIntersectorOptions:{});F||x.copy(this._pivotPos,this.startCamera.center);this._constrainPivotPoint(E,F);this.startCamera.center=this._pivotPos;this._constraintOptions.interactionType=r.InteractionType.TUMBLE;this._constraintOptions.tiltMode=v.TiltMode.TUMBLE;this._constraintOptions.selection=
q.ConstraintTypes.ALL&~q.ConstraintTypes.DISTANCE}A.normalizeCoordinate(this.startCamera,E,this._lastPoint)}}_constrainPivotPoint(E,F){const G=this.startCamera,D=u.create();x.subtract(D,this._pivotPos,G.eye);const I=x.length(D);var J=Math.abs(this.view.camera.position.z);this.view.renderCoordsHelper.worldUpAtPosition(G.eye,H);J=Math.max(Math.min(A.rotatePivotDistanceModifier,1/Math.abs(x.dot(H,G.viewForward)))*J,A.rotatePivotMinDistanceModifier);F&&(J=Math.min(I,J));var N=k.createScreenPointArray(G.width/
G.pixelRatio*.5,G.height/G.pixelRatio*.5);N=A.navigationMode(this.startCamera,N,this.view.renderCoordsHelper,this.view.viewingMode);let M=this.view._stage.renderView.getMinimalDepthForArea(y.getVoxelWasm(this.view),G.fullWidth/G.pixelRatio*.5,G.fullHeight/G.pixelRatio*.5,G,2.5*A.rotateScreenPixelArea,A.rotateScreenPixelArea);E=this.view._stage.renderView.getMinimalDepthForArea(y.getVoxelWasm(this.view),E[0],E[1],G,A.rotateScreenPixelArea);if(null!=M||null!=E)M=M??E??0,E=null==E||N===A.NavigationMode.Horizontal?
M:E,J=M>E?E:M,J=F?Math.min(J,I):J;x.normalize(D,D);x.copy(this._pivotPos,x.add(this._tmpPivotPoint,G.eye,x.scale(this._tmpPivotPoint,D,J)))}update(E){if(this.running){switch(this.pivot){case a.PivotPoint.EYE:this.currentCamera.center=this._applyRotation(this.currentCamera,E,this.currentCamera.center,this._pivotPos);break;case a.PivotPoint.CENTER:this.currentCamera.center=this._pivotPos,this.currentCamera.eye=this._applyRotation(this.currentCamera,E,this.currentCamera.eye,this._pivotPos)}t.applyAll(this.view,
this.currentCamera,this._constraintOptions);this.commitCamera()}}end(){this.running&&this.finishController()}_applyRotation(E,F,G,D){this.view.renderCoordsHelper.worldUpAtPosition(D,this._tmpWorldUp);A.normalizeCoordinate(E,F,this._tmpRotCurPoint);F=(this._lastPoint[1]-this._tmpRotCurPoint[1])*this._rotScale;let I=(this._tmpRotCurPoint[0]-this._lastPoint[0])*this._rotScale;x.subtract(this._tmpViewDir,G,D);G=x.length(this._tmpViewDir);G=n.acosClamped(x.dot(this._tmpViewDir,this._tmpWorldUp)/G);if(this.pivot===
a.PivotPoint.EYE){const J=.5*Math.PI-G,N=.495*Math.PI;F=J-Math.max(-N,Math.min(N,J+-.5*F))}F=n.clamp(F+G,B.TiltRange.min,B.TiltRange.max)-G;x.cross(this._tmpAxis,E.up,this._tmpViewDir);this.pivot===a.PivotPoint.CENTER&&(I=-I);f.fromRotation(this._tmpTransf,I,this._tmpWorldUp);f.rotate(this._tmpTransf,this._tmpTransf,F,this._tmpAxis);x.transformMat4(this._tmpViewDir,this._tmpViewDir,this._tmpTransf);E.up=x.transformMat4(C,E.up,this._tmpTransf);x.add(C,D,this._tmpViewDir);l.copy(this._lastPoint,this._tmpRotCurPoint);
return C}};b.__decorate([p.property()],a.RotateController.prototype,"pivot",void 0);a.RotateController=b.__decorate([d.subclass("esri.views.3d.state.controllers.RotateController")],a.RotateController);const C=u.create(),H=u.create();Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/controllers/InteractiveController":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/Logger ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ../ViewStateManager ./CameraController ../../webgl/RenderCamera".split(" "),
function(a,b,n,k,p,h,e,g,d,f){a.InteractiveController=class extends d.CameraController{constructor(){super(...arguments);this.startCamera=new f;this.currentCamera=new f;this._lastInteraction=0}get isInteractive(){return performance.now()-this._lastInteraction<g.interactingTimeout}stepController(c,l){l.copyViewFrom(this.currentCamera);this.currentCamera.copyFrom(l)}onControllerStart(c){this.state=d.State.Running;this.startCamera.copyFrom(c);this.currentCamera.copyFrom(c)}onControllerEnd(c){c.copyViewFrom(this.currentCamera)}commitCamera(){this._lastInteraction=
performance.now();setTimeout(()=>this.notifyChange("isInteractive"),g.interactingTimeout);this.view.state.updateCamera(c=>this.stepController(0,c));this.steppingFinished&&this.finishController()}};b.__decorate([n.property({readOnly:!0})],a.InteractiveController.prototype,"isInteractive",null);b.__decorate([n.property()],a.InteractiveController.prototype,"_lastInteraction",void 0);a.InteractiveController=b.__decorate([e.subclass("esri.views.3d.state.controllers.InteractiveController")],a.InteractiveController);
Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/ViewStateManager":function(){define("exports ../../../chunks/tslib.es6 ../../../Camera ../../../geometry ../../../Viewpoint ../../../core/Accessor ../../../core/Logger ../../../core/maybe ../../../core/reactiveUtils ../../../core/scheduling ../../../core/screenUtils ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ../../../chunks/vec32 ../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../chunks/vec42 ../../../core/libs/gl-matrix-2/factories/vec4f64 ../../../geometry/Extent ../../../geometry/Point ../../../geometry/projection ../../ViewingMode ../camera/constraintUtils ../camera/intersectionUtils ./ConstraintsManager ./Frustum ./GoToOperation ./controllers/SurfaceCollisionCorrectionController ../support/cameraUtils ../support/viewpointUtils ../webgl/RenderCamera ../webgl-engine/lib/rendererUtils ../webgl-engine/lib/RenderFeature ../../support/PropertiesPool ../../support/RenderState ../../webgl/FramebufferObject ../../../geometry/Polygon".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w,x,u,t,m,q,r,v,y,B,z,A,C,H,E,F,G,D,I,J,N,M,Q,O,K,L){a.ViewStateManager=class extends h{constructor(fa){super(fa);this.ready=!1;this._windowDevicePixelRatio=1;this._devicePixelRatioOverride=null;this._idleTimeout=300;this.test={viewStateManager:this,contentCameraResetState:new Map,setDevicePixelRatio:ha=>this._devicePixelRatioOverride=ha,renderState:null,get maximumPixelRatio(){return this.viewStateManager.view.qualitySettings.maximumPixelRatio},get updatingIgnoreRenderState(){return null!=
this.renderState},get idleTimeoutEnabled(){return 0<this.viewStateManager._idleTimeout},set idleTimeoutEnabled(ha){this.viewStateManager._idleTimeout=ha?300:0}};this._propertiesPool=new Q.PropertiesPool({frustum:E.Frustum},this);this._cameraSetByUser=!1;this._gotoOperation=null;this._cameraChangeTime=0;this._tmpCanvasSize=new P}initialize(){this._cameraChangeTime=performance.now();this.addHandles([d.on(()=>this.view.state.events,"before-camera-change",fa=>fa&&this._updateElevation(fa)),d.watch(()=>
this.view.state?.camera,(fa,ha)=>this._cameraChangedHandler(fa,ha),d.sync)]);d.when(()=>this.view.state?.camera,fa=>this._updateElevation(fa),{once:!0,sync:!0});this.addHandles([f.addFrameTask({prepare:()=>this._prepareFrame()}),d.watch(()=>this.view.state.cameraController,()=>{this._cameraSetByUser=!0;this.removeHandles("pending-initial-view")}),d.on(()=>this.view.state.events,"camera-projection-changed",()=>this.notifyChange("scale"))])}destroy(){this.exit();this._propertiesPool=g.destroyMaybe(this._propertiesPool)}get camera(){const fa=
this._get("camera");if(!this.ready)return fa;const ha=D.internalToExternal(this.view,this.view.state.camera,ba);return ha&&fa&&ha.equals(fa)?fa:ha.clone()}set camera(fa){this._updatePropertyBeforeReady("camera",fa)||(this.view.elevationProvider?.enableCache(!0),this.setStateCamera(D.externalToInternal(this.view,fa),{applyConstraints:!1})||e.getLogger(this).error("#camera\x3d","Invalid camera",fa),this.view.elevationProvider?.enableCache(!1))}get contentCamera(){const fa=this._get("contentCamera");
if(!this.ready)return fa;const ha=D.internalToExternal(this.view,this.view.state.contentCamera,ba);return ha&&fa&&ha.equals(fa)?fa:ha.clone()}set contentCamera(fa){this._updatePropertyBeforeReady("contentCamera",fa)||(fa=D.externalToInternal(this.view,fa),null==fa?this.view.state.contentCamera=null:(this._updateElevation(fa),this.view.state.contentCamera=fa))}installContentCameraReset(fa){this.removeHandles("content-camera-reset");this.test.contentCameraResetState.clear();if(!this.view.state.fixedContentCamera)return!1;
const ha=this.zoom,T=this.view.state.camera.distance**2,S=m.fromArray(this.view.state.camera.center),Z=fa.sticky?this.contentCamera.clone():null;this.addHandles([d.watch(()=>this.contentCamera,()=>{fa.sticky||(this.removeHandles("content-camera-reset"),this.test.contentCameraResetState.clear())}),d.watch(()=>this.zoom,ia=>{void 0!==ia&&void 0!==ha&&(this.test.contentCameraResetState.set("view.zoom",Math.abs(ia-ha)/2),2<Math.abs(ia-ha)?this.contentCamera=null:this.view.state.fixedContentCamera||(this.contentCamera=
Z))}),d.watch(()=>this.view.state.camera,ia=>{ia=t.squaredDistance(S,ia.center);this.test.contentCameraResetState.set("camera.center",ia/T);ia>T?this.contentCamera=null:this.view.state.fixedContentCamera||(this.contentCamera=Z)})],"content-camera-reset");return!0}get center(){return this.ready?this.view.pointsOfInterest.centerOnContent.location:this._get("center")}set center(fa){this._updatePropertyBeforeReady("center",fa)||(fa?this.isCompatible(fa)?this.setStateCamera(this._centerToCamera(fa),{applyConstraints:!0})?
this.view.pointsOfInterest.centerOnContent.runTask():e.getLogger(this).error("#center\x3d","Invalid center",fa):e.getLogger(this).error("#center\x3d","Center has an incompatible spatial reference (center: "+(fa.spatialReference?fa.spatialReference.wkid:"none")+", view: "+this.view.spatialReference?.wkid+")",fa):e.getLogger(this).error("#center\x3d","Center may not be null or undefined"))}get visibleArea(){if(!this.ready){const fa=this._get("extent");return fa?L.fromExtent(fa):null}return D.toArea(this.view,
this.view.pointsOfInterest.focus.renderLocation)}get extent(){if(!this.ready)return this._get("extent");var fa=this.view;fa=D.toExtent(fa,fa.state.camera,fa.pointsOfInterest.centerOnContent.renderLocation);return null!=fa?fa:this._get("extent")}set extent(fa){this._updatePropertyBeforeReady("extent",fa)||(fa?this.isCompatible(fa)?this.setStateCamera(this._extentToCamera(fa),{applyConstraints:!0})||e.getLogger(this).error("#extent\x3d","Invalid extent",fa):e.getLogger(this).error("#extent\x3d","Extent has an incompatible spatial reference (extent: "+
(fa.spatialReference?fa.spatialReference.wkid:"none")+", view: "+this.view.spatialReference?.wkid+")",fa):e.getLogger(this).error("#extent\x3d","Extent may not be null or undefined"))}get frustum(){const fa=this._propertiesPool.get("frustum");fa.renderCoordsHelper=this.view.renderCoordsHelper;fa.update(this.view.state.camera);return fa}get constraintsManager(){return this._constraintsManager}get _initialViewpoint(){const fa=this.view.map;return fa&&"initialViewProperties"in fa?fa.initialViewProperties?.viewpoint:
void 0}get hasInitialView(){return!!this._initialViewpoint}get scale(){if(!this.ready)return this._get("scale");const fa=this.view.basemapTerrain.tilingScheme,ha=this.view.pointsOfInterest.cameraOnSurface.scale;return fa&&ha?D.applyTiltAdjustToScale(this.view,ha,this.view.state.contentCamera,fa):this._get("scale")}set scale(fa){this._updatePropertyBeforeReady("scale",fa)||this.setStateCamera(this._scaleToCamera(fa),{applyConstraints:!0})||e.getLogger(this).error("#scale\x3d","Invalid scale",fa)}get padding(){if(!this.ready)return this._get("padding");
var fa=this.view.state.camera,ha=fa.padding;const T=fa.pixelRatio;fa=this._get("padding");const S=Math.round(ha[N.PaddingSide.TOP]/T),Z=Math.round(ha[N.PaddingSide.RIGHT]/T),ia=Math.round(ha[N.PaddingSide.BOTTOM]/T);ha=Math.round(ha[N.PaddingSide.LEFT]/T);return null!=fa&&fa.top===S&&fa.right===Z&&fa.bottom===ia&&fa.left===ha?fa:{top:S,right:Z,bottom:ia,left:ha}}set padding(fa){this._updatePropertyBeforeReady("padding",fa)||(this._paddingToArray(fa,this.view.state.camera.pixelRatio,da),this.view.state.updateCamera(ha=>
ha.padding=da))}_paddingToArray(fa,ha,T){fa?q.set(T,fa.top||0,fa.right||0,fa.bottom||0,fa.left||0):q.set(T,0,0,0,0);for(fa=0;4>fa;fa++)T[fa]=Math.round(T[fa]*ha)}get screenCenter(){const fa=this.padding;return c.createScreenPoint((this.view.width-(fa.left+fa.right))/2+fa.left,(this.view.height-(fa.top+fa.bottom))/2+fa.top)}get viewpoint(){return this.ready?I.fromCamera(this.view,this.camera):this._get("viewpoint")}set viewpoint(fa){if(!this._updatePropertyBeforeReady("viewpoint",fa))if(fa)if(this.isCompatible(fa))this.setStateCamera(this._viewpointToCamera(fa),
{applyConstraints:!fa.camera})||e.getLogger(this).error("#viewpoint\x3d","Invalid viewpoint",fa);else{var ha=null!=fa.camera?fa.camera.position:fa.targetGeometry;ha=null!=ha&&ha.spatialReference;e.getLogger(this).error("#viewpoint\x3d","Viewpoint has an incompatible spatial reference (viewpoint: "+(ha?ha.wkid:"none")+", view: "+this.view.spatialReference?.wkid+")",fa)}else e.getLogger(this).error("#viewpoint\x3d","Viewpoint may not be null or undefined")}get zoom(){return this.ready?D.scaleToZoom(this.view,
this.scale):this._get("zoom")}set zoom(fa){this._updatePropertyBeforeReady("zoom",fa)||void 0===fa||this.setStateCamera(this._zoomToCamera(fa),{applyConstraints:!0})||e.getLogger(this).error("#zoom\x3d","Invalid zoom",fa)}_computeCanvasSize(){if(this._devicePixelRatioOverride)return this.view.state.contentPixelRatio=this._devicePixelRatioOverride,this._tmpCanvasSize.width=Math.round(this.view.surface.clientWidth*this._devicePixelRatioOverride),this._tmpCanvasSize.height=Math.round(this.view.surface.clientHeight*
this._devicePixelRatioOverride),this._tmpCanvasSize.pixelRatio=this._devicePixelRatioOverride,this._tmpCanvasSize;var fa=Math.min(this._windowDevicePixelRatio,this.view.qualitySettings.maximumPixelRatio);fa=(this._usePhysicalPixelRendering?this._windowDevicePixelRatio:fa)*this.view.resolutionScale;this._tmpCanvasSize.width=Math.round(this.view.surface.clientWidth*fa);this._tmpCanvasSize.height=Math.round(this.view.surface.clientHeight*fa);const ha=this.view._stage.renderView.renderingContext?.parameters.maxTextureSize;
ha&&K.ensureAttachmentMaxSize(this._tmpCanvasSize,ha);this._tmpCanvasSize.pixelRatio=0<this._tmpCanvasSize.width?this._tmpCanvasSize.width/this.view.surface.clientWidth*.5+this._tmpCanvasSize.height/this.view.surface.clientHeight*.5:fa;this.view.state&&(this.view.state.contentPixelRatio=Math.min(this._windowDevicePixelRatio,this.view.qualitySettings.maximumPixelRatio));return this._tmpCanvasSize}get _rasterPixelRatio(){return null!=this._devicePixelRatioOverride?this._devicePixelRatioOverride:this._usePhysicalPixelRenderingAny?
this._windowDevicePixelRatio:Math.min(this._windowDevicePixelRatio,this.view.qualitySettings.maximumPixelRatio)}get _usePhysicalPixelRendering(){return this.view?._stage?.renderer.isFeatureEnabled(M.RenderFeature.PhysicalPixelRendering)??!1}get _usePhysicalPixelRenderingAny(){const fa=this.view?._stage?.renderer;return fa&&(fa.isFeatureEnabled(M.RenderFeature.PhysicalPixelRendering,O.RenderState.IDLE)||fa.isFeatureEnabled(M.RenderFeature.PhysicalPixelRendering,O.RenderState.INTERACTING)||fa.isFeatureEnabled(M.RenderFeature.PhysicalPixelRendering,
O.RenderState.ANIMATING))}preinit(fa){return this._isOverridden("center")&&!B.isLoadedOrLoadFor(this.center.spatialReference,fa)||this._isOverridden("camera")&&!B.isLoadedOrLoadFor(this.camera.position.spatialReference,fa)||this._isOverridden("extent")&&!B.isLoadedOrLoadFor(this.extent.spatialReference,fa)||this._isOverridden("viewpoint")&&(!B.isLoadedOrLoadFor(this.viewpoint.targetGeometry?.spatialReference,fa)||!B.isLoadedOrLoadFor(this.viewpoint.camera?.position?.spatialReference,fa))?!1:!0}init(){this._constraintsManager=
new H.ConstraintsManager({view:this.view});this._prepareFrame();var fa=this._getInitialProperties();this._cameraSetByUser=!1;this._set("ready",!0);for(const ha of fa)this.set(ha.name,ha.value);this._cameraSetByUser||((fa=this._initialViewpoint||this.view.initialExtent)&&this.isCompatible(fa)?this._setInitialView(fa):this.view.state.viewingMode===z.ViewingMode.Local&&this.addHandles(d.when(()=>this.view.basemapTerrain.ready,()=>{this.removeHandles("pending-initial-view");this._setInitialView(this.view.dataExtent)},
{once:!0,initial:!0}),"pending-initial-view"))}exit(){this._cancelGoToOperation();this.ready&&(this._override("padding",this.padding),this._set("ready",!1),this._clearOverride("hasInitialView"),this._cameraSetByUser=!1,this.removeHandles("pending-initial-view"),this._constraintsManager=g.destroyMaybe(this._constraintsManager))}async goTo(fa,ha){ha={animate:!0,...ha};null!=this._gotoOperation&&this._gotoOperation.abort(ha.animate);this._gotoOperation=new F.GoToOperation(fa,ha,this.view);this.view.resourceController.scheduler.stopFrame();
return this._gotoOperation.promise}debugSetCameraOnContent(){this.setStateCamera(C.cameraOnContentAlongViewDirection(this.view),{applyConstraints:!1})}step(fa){const ha=this.view.state,T=ha?.cameraController;T&&(ha.updateCamera(S=>T.stepController(fa,S)),T.steppingFinished&&T.finishController())}_cancelGoToOperation(){null!=this._gotoOperation&&(this._gotoOperation.abort(),this._gotoOperation=null)}_getInitialProperties(){const fa=new Set,ha=[];for(const {propertyName:T,overrides:S}of W){const Z=
fa.has(T),ia=this._isOverridden(T);!Z&&ia&&ha.push({name:T,value:this._get(T)});this._clearOverride(T);(Z||ia)&&S.forEach(Y=>fa.add(Y))}return ha}_setInitialView(fa){if(null!=fa&&!this._cameraSetByUser)if(fa instanceof n)this.setStateCamera(D.externalToInternal(this.view,fa),{applyConstraints:!1});else if(fa instanceof p)if(fa.targetGeometry instanceof v){var ha=D.fromExtentSync(this.view,fa.targetGeometry,0,.5,D.OrientationMode.LOCKED);null!=ha&&this.setStateCamera(D.externalToInternal(this.view,
ha),{applyConstraints:!0})}else ha={applyConstraints:!fa.camera},fa=this._viewpointToCamera(fa),this.setStateCamera(fa,ha);else ha=D.fromExtentSync(this.view,fa,0,.5,D.OrientationMode.LOCKED),null!=ha&&this.setStateCamera(D.externalToInternal(this.view,ha),{applyConstraints:!0})}_updatePropertyBeforeReady(fa,ha){if(this.ready)return!1;this._override(fa,ha);ha&&R.has(fa)&&this._override("hasInitialView",!0);return!0}isCompatible(fa){return null==fa?!1:fa instanceof p?fa.camera?this.isCompatible(fa.camera):
this.isCompatible(fa.targetGeometry):fa instanceof n?this.isCompatible(fa.position):fa.spatialReference&&!B.requiresLoad(fa.spatialReference,this.view.spatialReference)}_getPreservingHeadingTilt(fa=V){this._cameraSetByUser?(fa.heading=this.camera.heading,fa.tilt=this.camera.tilt):(fa.heading=0,fa.tilt=.5);return fa}_centerPointAtDistanceToCamera(fa,ha,T=U){const {heading:S,tilt:Z}=this._getPreservingHeadingTilt();fa=D.getObserverForPointAtDistanceSync(this.view,S,Z,fa,ha,D.OrientationMode.ADJUST);
if(null==fa)return null;T.copyFrom(this.view.state.camera);T.eye=fa.eye;T.center=fa.center;T.up=fa.up;return T}_centerToCamera(fa){if(fa.hasZ)var ha=this.view.state.camera.distance;else({centerOnContent:ha}=this.view.pointsOfInterest),ha.runTask(),ha=ha.distance;return this._centerPointAtDistanceToCamera(fa,ha)}_extentToCamera(fa){const {heading:ha,tilt:T}=this._getPreservingHeadingTilt();return(fa=D.fromExtentSync(this.view,fa,ha,T,D.OrientationMode.ADJUST,ba))?D.externalToInternal(this.view,fa):
null}_scaleToCamera(fa){if(null==fa)return null;const ha=this.view;var T=ha.pointsOfInterest.centerOnContent;T.runTask();T=T.renderLocation;fa=D.scaleToTargetDistance(ha,fa,ha.state.contentCamera,T,ha.pointsOfInterest.cameraOnSurface.renderLocation);return this._centerPointAtDistanceToCamera(T,fa)}_zoomToCamera(fa){return this._scaleToCamera(D.zoomToScale(this.view,fa))}_viewpointToCamera(fa){return D.externalToInternal(this.view,I.toCameraSync(this.view,fa))}setStateCamera(fa,ha){if(null==fa||!this.view.state.stopActiveCameraController())return!1;
this._cameraSetByUser=!0;ha.doNotCancelGoToOperation||this._cancelGoToOperation();this.view.state.updateCamera(T=>{ha.positionAndOrientationOnly?(T.eye=fa.eye,T.center=fa.center,T.up=fa.up,T.fov=fa.fov):T.copyFrom(fa);ha.applyConstraints&&A.applyAll(this.view,T)});ha.applyConstraints||(this.view.state.cameraController=new G.SurfaceCollisionCorrectionController({view:this.view,desiredCamera:fa}));return!0}_prepareFrame(){const {surface:fa,canvas:ha}=this.view;if(fa&&ha){this._windowDevicePixelRatio=
window.devicePixelRatio;var T=this._computeCanvasSize();if(0!==T.width&&0!==T.height){if(ha.width!==T.width||ha.height!==T.height)ha.width=T.width,ha.height=T.height;if(this.view.state){const S=this.view.state.camera;if(S.fullWidth!==T.width||S.fullHeight!==T.height||S.pixelRatio!==T.pixelRatio)U.copyFrom(S),U.pixelRatio!==T.pixelRatio&&(this._paddingToArray(this.padding,T.pixelRatio,da),U.padding=da),U.fullWidth=T.width,U.fullHeight=T.height,U.pixelRatio=T.pixelRatio,this.view.state.camera=U;this._updateViewState()}}}}_updateElevation(fa){var ha=
this.view.basemapTerrain?.spatialReference;const T=this.view.renderCoordsHelper?.getAltitude(fa.eye)??0;ha=ha?C.surfaceElevationBelowRenderLocation(this.view,fa.eye):0;fa.relativeElevation=T-ha}_updateViewState(){null!=this.test.renderState?this.view.state.mode=this.test.renderState:this.view.animation?this.view.state.mode=O.RenderState.ANIMATING:this.view.interacting?this.view.state.mode=O.RenderState.INTERACTING:(this.view.state.mode===O.RenderState.ANIMATING&&(this._cameraChangeTime=0),performance.now()-
this._cameraChangeTime<this._idleTimeout?this.view.state.mode=O.RenderState.INTERACTING:this.view.state.mode=O.RenderState.IDLE);this.view.state.rasterPixelRatio=this._rasterPixelRatio}_cameraChangedHandler(fa,ha){fa&&ha&&fa.almostEquals(ha)||(this._cameraChangeTime=performance.now(),this._updateViewState())}};b.__decorate([l.property({type:n,dependsOn:["view.state.camera","ready"]})],a.ViewStateManager.prototype,"camera",null);b.__decorate([l.property({type:n,dependsOn:["view.state.contentCamera",
"ready"]})],a.ViewStateManager.prototype,"contentCamera",null);b.__decorate([l.property({type:y})],a.ViewStateManager.prototype,"center",null);b.__decorate([l.property()],a.ViewStateManager.prototype,"visibleArea",null);b.__decorate([l.property({type:v})],a.ViewStateManager.prototype,"extent",null);b.__decorate([l.property({readOnly:!0})],a.ViewStateManager.prototype,"frustum",null);b.__decorate([l.property()],a.ViewStateManager.prototype,"_constraintsManager",void 0);b.__decorate([l.property({readOnly:!0})],
a.ViewStateManager.prototype,"constraintsManager",null);b.__decorate([l.property()],a.ViewStateManager.prototype,"_initialViewpoint",null);b.__decorate([l.property({readOnly:!0})],a.ViewStateManager.prototype,"hasInitialView",null);b.__decorate([l.property({readOnly:!0,type:Boolean})],a.ViewStateManager.prototype,"ready",void 0);b.__decorate([l.property({type:Number})],a.ViewStateManager.prototype,"scale",null);b.__decorate([l.property()],a.ViewStateManager.prototype,"padding",null);b.__decorate([l.property({readOnly:!0})],
a.ViewStateManager.prototype,"screenCenter",null);b.__decorate([l.property({constructOnly:!0})],a.ViewStateManager.prototype,"view",void 0);b.__decorate([l.property({type:p})],a.ViewStateManager.prototype,"viewpoint",null);b.__decorate([l.property({type:Number})],a.ViewStateManager.prototype,"zoom",null);b.__decorate([l.property({readOnly:!0})],a.ViewStateManager.prototype,"_rasterPixelRatio",null);b.__decorate([l.property({readOnly:!0})],a.ViewStateManager.prototype,"_usePhysicalPixelRendering",
null);b.__decorate([l.property({readOnly:!0})],a.ViewStateManager.prototype,"_usePhysicalPixelRenderingAny",null);b.__decorate([l.property()],a.ViewStateManager.prototype,"_windowDevicePixelRatio",void 0);b.__decorate([l.property()],a.ViewStateManager.prototype,"_devicePixelRatioOverride",void 0);a.ViewStateManager=b.__decorate([u.subclass("esri.views.3d.state.ViewStateManager")],a.ViewStateManager);class P{constructor(){this.height=this.width=0;this.pixelRatio=1}}const R=new Set("camera viewpoint extent scale center zoom".split(" ")),
W=[{propertyName:"camera",overrides:["viewpoint"]},{propertyName:"viewpoint",overrides:["extent"]},{propertyName:"extent",overrides:["center","scale"]},{propertyName:"center",overrides:[]},{propertyName:"scale",overrides:["zoom"]},{propertyName:"zoom",overrides:[]},{propertyName:"padding",overrides:[]}],V={heading:0,tilt:0},ba=new n,U=new J,da=r.create();a.interactingTimeout=100;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/ConstraintsManager":function(){define("exports ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/mathUtils ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ../../ViewingMode ../camera/constraintUtils ../camera/intersectionUtils ../camera/constraintUtils/ConstraintOptions ../camera/constraintUtils/ConstraintTypes ../camera/constraintUtils/InteractionType ./NearFarHeuristic ./SurfaceCollisionConstraint".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w,x,u,t,m,q){a.ConstraintsManager=class extends n{constructor(r){super(r);this.nearFarHeuristic=m.createNearFarHeuristic(r.view.state.viewingMode,r.view.basemapTerrain,r.view.renderCoordsHelper.spatialReference)}initialize(){this.addHandles([p.watch(()=>[this.view.constraints?.clipDistance?.near,this.view.constraints?.clipDistance?.far],()=>this._clipDistanceNearFarChanged()),p.watch(()=>this.view.constraints?.clipDistance?.mode,()=>this._updateNearFar()),this.view.state.events.on("before-camera-change",
r=>this._updateCameraNearFar(r)),p.watch(()=>this.view.renderDataExtent,()=>this._updateNearFar(),p.sync),p.watch(()=>[this.view.constraints?.altitude?.min,this.view.constraints?.altitude?.max],()=>this._updateAltitude(),p.sync),p.watch(()=>this.view.constraints?.tilt?.max,()=>this._updateTiltMax(),p.sync),p.watch(()=>this.view.constraints?.tilt?.mode,()=>this._updateTilt(),p.sync),p.watch(()=>this.view.state?.camera,()=>this._updateTiltAutoMax(),p.sync),p.watch(()=>[this.view.map?.ground?.navigationConstraint?.type,
this.view.state?.constraints?.collision?.enabled],()=>this._updateCollision(),p.sync)]);this.view.state.isLocal&&this.addHandles(p.watch(()=>this.view.renderDataExtent,r=>this._updateLocalSurfaceDistance(r),p.initial));this._updateNearFar();this.view.state.viewingMode!==c.ViewingMode.Local&&this._updateAltitude();this._updateTilt();this._updateCollision();this._set("surfaceCollisionConstraint",new q.SurfaceCollisionConstraint({view:this.view}))}destroy(){this.surfaceCollisionConstraint&&(this.surfaceCollisionConstraint.destroy(),
this._set("surfaceCollisionConstraint",null))}_clipDistanceNearFarChanged(){const r=this.view.constraints?.clipDistance;r&&"auto"!==r.mode&&this.view.state.updateCamera(v=>{r&&(v.near=r.near,v.far=r.far)})}_updateNearFar(){this.view.state.updateCamera(r=>this._updateCameraNearFar(r))}_updateCameraNearFar(r){const v=this.view.constraints&&this.view.constraints.clipDistance;"manual"===(v?v.mode:"auto")?v&&(r.near=v.near,r.far=v.far):this._updateCameraNearFarAuto(r,v)}_updateCameraNearFarAuto(r,v){this.nearFarHeuristic.compute(r.eye,
r.center,this.view.renderDataExtent,w.surfaceElevationBelowRenderLocation(this.view,r.eye),r);v&&v.autoUpdate(r.near,r.far)}_updateCollision(){var r=this.view.map?.ground?.navigationConstraint?.type;r=r?"stay-above"===r:!0;const v=this.view.state.constraints.collision;r!==v.enabled&&((v.enabled=r)&&this._reapplyConstraints(u.ConstraintTypes.COLLISION),(r=this.view.constraints&&this.view.constraints.tilt)&&"auto"!==r.mode||this._updateTiltAuto())}_updateAltitude(){const r=this.view.constraints&&this.view.constraints.altitude;
this.view.state.constraints.altitude=r&&this.view.state.viewingMode!==c.ViewingMode.Local?{min:r.min,max:r.max}:null;this._reapplyConstraints()}_updateTiltMax(){const r=this.view.constraints&&this.view.constraints.tilt;r&&"auto"!==r.mode&&(this._updateTiltManual(r),this._reapplyConstraints())}_updateTilt(){const r=this.view.constraints&&this.view.constraints.tilt;"manual"===(r?r.mode:"auto")?this._updateTiltManual(r):this._updateTiltAuto();this._reapplyConstraints()}_updateTiltManual(r){const v=this.view.state.constraints;
v.tilt=v.createConstantMaxTilt(k.deg2rad(r.max))}_updateTiltAuto(){const r=this.view.state.constraints;r.tilt=r.createDefaultTilt();this._updateTiltAutoMax()}_updateTiltAutoMax(){const r=this.view.constraints&&this.view.constraints.tilt;if(r&&"auto"===r.mode){var v=this.view.state.constraints;v.tilt&&(v=v.tilt(this.view.state.camera.distance).max,r.autoUpdate(k.rad2deg(v)))}}_updateLocalSurfaceDistance(r){if(null!=r){var v=Math.max(r.width,r.height);0>=v||(null!=r.zmax&&null!=r.zmin&&(v=Math.max(v,
r.zmax-r.zmin)),r=this.view.state,v=3*v/Math.atan(r.camera.fov/2),v!==r.constraints.distance&&(r.constraints.distance=v))}}_reapplyConstraints(r=u.ConstraintTypes.ALL){this.view.state.updateCamera(v=>l.applyAll(this.view,v,new x.ConstraintOptions(r,t.InteractionType.NONE,null)))}};b.__decorate([h.property({constructOnly:!0})],a.ConstraintsManager.prototype,"view",void 0);b.__decorate([h.property({readOnly:!0})],a.ConstraintsManager.prototype,"surfaceCollisionConstraint",void 0);a.ConstraintsManager=
b.__decorate([f.subclass("esri.views.3d.state.ConstraintsManager")],a.ConstraintsManager);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/NearFarHeuristic":function(){define("exports ../../../core/mathUtils ../../../core/unitUtils ../../../chunks/vec32 ../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../geometry/ellipsoidUtils ../../../geometry/Extent ../../ViewingMode ../environment/atmosphereUtils".split(" "),function(a,b,n,k,p,h,e,g,d){function f(u,t,
m,q){m=2/m;u/t>m?(q.far=u,q.near=q.far/t):(q.near=m,q.far=q.near*t);return q}class c{constructor(u,t){this._elevationProvider=u;this._referenceEllipsoid=h.getReferenceEllipsoid(t);this._unitInMeters=n.getMetersPerUnitForSR(t,this._referenceEllipsoid.metersPerDegree)}compute(u,t,m,q,r){r||={near:0,far:0};var v=u[2]*this._unitInMeters,y=v;q=v-q;var B=this._elevationProvider?.visibleElevationBounds;B&&(v=0<=q?y-this._unitInMeters*B.min:this._unitInMeters*B.max-y);m=null!=m?m:new e({xmin:0,ymin:0,zmin:0,
xmax:0,ymax:0,zmax:0});y=Math.max(m.xmax-m.xmin,m.ymax-m.ymin,4*Math.max(m.xmax-m.xmin,m.ymax-m.ymin));k.subtract(x,t,u);w[0]=0<x[0]?m.xmax:m.xmin;w[1]=0<x[1]?m.ymax:m.ymin;w[2]=0<x[2]?y/2:-y/2;k.subtract(w,w,u);k.normalize(x,x);u=1.1*k.dot(w,x)*this._unitInMeters;t=Math.sqrt(v*(v+2*this._referenceEllipsoid.radius));m=Math.max(m.xmax-m.xmin,m.ymax-m.ymin);B=1E-4*m*this._unitInMeters;v=b.clamp((v-B)/(.001*m*this._unitInMeters-B),0,1);v=Math.min(b.lerp(t,u,v**3),t)*Math.max(Math.log(Math.abs(q)),1);
return f(Math.min(v,Math.max(34064E4,y))/this._unitInMeters,2E4,this._unitInMeters,r)}}class l{constructor(u){this._referenceEllipsoid=h.getReferenceEllipsoid(u)}compute(u,t,m,q,r){r||={near:0,far:0};u=k.length(u);t=u-this._referenceEllipsoid.radius;t=Math.max(Math.abs(t-q),Math.abs(t));q=1.2*b.lerp(Math.sqrt(t*(t+2*(this._referenceEllipsoid.radius+Math.min(0,q)))),u+this._referenceEllipsoid.radius,d.computeInnerAltitudeFade(t));u=b.clamp(2E4-(Math.log(t)-7.983)/9.011*19900,100,2E4);return f(q,u,
1,r)}}const w=p.create(),x=p.create();a.createNearFarHeuristic=function(u,t,m){return u===g.ViewingMode.Global?new l(m):new c(t,m)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/atmosphereUtils":function(){define(["exports","../../../core/mathUtils","../../../core/libs/gl-matrix-2/factories/vec3f64"],function(a,b,n){const k=n.fromValues(parseFloat(Number(5.802E-6).toFixed(6)),parseFloat(Number(1.3558E-5).toFixed(6)),parseFloat(Number(3.31E-5).toFixed(6))),
p=n.fromValues(3*parseFloat(Number(6.5E-7).toFixed(6)),3*parseFloat(Number(1.881E-6).toFixed(6)),3*parseFloat(Number(8.5E-8).toFixed(6)));n=n.fromValues(parseFloat(Number(k[0]+p[0]).toFixed(6)),parseFloat(Number(k[1]+p[1]).toFixed(6)),parseFloat(Number(k[2]+p[2]).toFixed(6)));a.betaCombined=n;a.betaMie=3.996E-6;a.betaOzone=p;a.betaRayleigh=k;a.computeInnerAltitudeFade=function(h){return b.clamp((h-1E5)/9E5,0,1)};a.innerAtmosphereDepth=1E4;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/state/SurfaceCollisionConstraint":function(){define("exports ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ../camera/intersectionUtils ../camera/constraintUtils/surfaceCollision".split(" "),function(a,b,n,k,p,h,e,g,d,f){a.SurfaceCollisionConstraint=class extends n{constructor(c){super(c)}initialize(){this.addHandles(this.view.basemapTerrain.on("elevation-change",
c=>this._handleElevationChangeEvent(c)))}_handleElevationChangeEvent(c){if(!this.view.state.cameraController){var l=this.view.state.camera;null!=c.spatialReference&&d.eyeWithinExtent(this.view,l,c.extent,c.spatialReference)&&this._applyToCurrentCamera()}}_applyToCurrentCamera(){this.view.state.updateCamera(c=>f.applySurfaceCollisionConstraint(this.view,c,f.Mode.EYE_AND_CENTER))}};b.__decorate([k.property({constructOnly:!0})],a.SurfaceCollisionConstraint.prototype,"view",void 0);a.SurfaceCollisionConstraint=
b.__decorate([g.subclass("esri.views.3d.state.SurfaceCollisionConstraint")],a.SurfaceCollisionConstraint);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/GoToOperation":function(){define("exports ../../../Camera ../../../Viewpoint ../../../core/Error ../../../core/promiseUtils ../../../core/reactiveUtils ../camera/constraintUtils ../camera/constraintUtils/surfaceCollision ./controllers/CameraController ./controllers/PointToPointAnimationController ./controllers/SurfaceCollisionCorrectionController ../support/cameraUtils ../support/viewpointUtils".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w){class x{constructor(u,t,m){this._target=u;this._options=t;this.view=m;this.state="pending";this._animationController=null;this.promise=new Promise((q,r)=>{this._resolveCallback=q;this._rejectCallback=r;q=new AbortController;if(null!=this._options.signal)p.onAbort(this._options.signal,()=>this.abort());this._abortController=q;this._waitForReady()})}_resolve(u){if("finished"!==this.state)return this.state="finished",this._resolveCallback(u)}_reject(u){if("finished"!==
this.state)return this.state="finished",this._rejectCallback(u)}abort(u=!1){this._abortController.abort();switch(this.state){case "wait-for-animation-finish":!u&&null!=this._animationController&&this.view.state.cameraController===this._animationController&&this._animationController.running&&this._animationController.stopController()}this._reject(p.createAbortError())}async _waitForReady(){this.state="wait-for-ready";if(!this.view.ready)try{await h.whenOnce(()=>this.view.ready,this._abortController.signal)}catch(u){return this._reject(u)}this._createViewPoint()}async _createViewPoint(){if("finished"!==
this.state){this.state="wait-for-viewpoint";this._animationController=this._options.animate?this._getAnimationController():null;try{const t=await w.create(this.view,this._target,this._abortController.signal);if("finished"!==this.state){var u=t?this._getCameraFromViewpoint(t):null;null!=u&&(this._options.animate?null!=this._animationController&&this._startAnimation(u,this._animationController):(this.view.stateManager.setStateCamera(u.camera,{applyConstraints:!u.isFullySpecified,positionAndOrientationOnly:!0,
doNotCancelGoToOperation:!0}),this._resolve()))}}catch(t){this._reject(t)}}}_getCameraFromViewpoint(u){const t=!!(this._target instanceof n&&this._target.camera||this._target instanceof b);var m=u.camera;if(null==m)return null;if(!this.view.stateManager.isCompatible(m))return u=(u=m.position)&&u.spatialReference,this._reject(new k("GotoAnimation:incompatible-spatialreference",`Resulting camera has an incompatible spatial reference (camera: ${u?u.wkid:"none"}, view: ${this.view.spatialReference?.wkid})`,
{camera:m})),null;m=l.externalToInternal(this.view,m);return null==m?(this._reject(new k("GotoAnimation:invalid-camera","Resulting camera is invalid")),null):{viewpoint:u,camera:m,isFullySpecified:t}}_startAnimation(u,t){this.state="wait-for-animation-finish";const m=t.viewAnimation;if(null==m)this._reject(new k("GotoAnimation:missing-animation","Unreachable code in view.stateManager"));else{m.update(u.viewpoint,"running");if(!t.running||null==t.viewAnimation||t.viewAnimation.target!==u.viewpoint||
this.view.state.cameraController!==t)return this.abort();if(u.isFullySpecified){var q=new c.SurfaceCollisionCorrectionController({view:this.view,desiredCamera:u.camera});g.applySurfaceCollisionConstraint(this.view,u.camera,g.Mode.EYE_AND_CENTER)}else e.applyAll(this.view,u.camera);t.begin(u.camera,this._options);var r=v=>{if(null!=this.view.state)switch(t.state){case d.State.Finished:switch(this.state){case "pending":case "wait-for-ready":case "wait-for-viewpoint":case "wait-for-animation-finish":this._resolve()}break;
case d.State.Ready:case d.State.Rejected:case d.State.Running:case d.State.Stopped:switch(this.state){case "pending":case "wait-for-ready":case "wait-for-viewpoint":case "wait-for-animation-finish":this._reject(v)}}};m.when(()=>{const v=this.view.state.cameraController;q&&(v&&v.running?f.isPointToPointAnimationController(v)&&null!=v.viewAnimation&&v.viewAnimation.target===u.viewpoint&&(this.view.state.cameraController=q):null!=t.viewAnimation&&t.viewAnimation.target===u.viewpoint&&t.state===d.State.Finished&&
(this.view.state.cameraController=q))},v=>r(v));t.asyncResult={resolve:()=>r(),reject:v=>r(v)}}}_getAnimationController(){let u=null;var t=null;t=this.view.state.cameraController;f.isPointToPointAnimationController(t)&&(t.updateStateFromViewAnimation(),t.running&&(u=t,t=u.viewAnimation));return null==u&&(u=new f.PointToPointAnimationController({view:this.view,mode:"animation"}),t=u.viewAnimation,this.view.state.switchCameraController(u),u.state===d.State.Rejected)?(t?.stop(),this._reject(new k("GotoAnimation:goto-cannot-interrupt",
"Cannot start an animation while interacting")),null):u}}a.GoToOperation=x;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/controllers/SurfaceCollisionCorrectionController":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/Logger ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ../../camera/intersectionUtils ../../camera/constraintUtils/surfaceCollision ./CameraController".split(" "),
function(a,b,n,k,p,h,e,g,d,f){a.SurfaceCollisionCorrectionController=class extends f.CameraController{set desiredCamera(c){this._set("desiredCamera",c.clone())}constructor(c){super(c)}get canStop(){return!0}get constraintEnabled(){return this.view.state.constraints.collision.enabled}onControllerStart(){this.state=f.State.Running;this.addHandles(this.view.basemapTerrain.on("elevation-change",c=>this._handleElevationChangeEvent(c)));this._applyCorrection()}onControllerEnd(){this.removeAllHandles()}stepController(){}_handleElevationChangeEvent(c){(null==
c.spatialReference||g.eyeWithinExtent(this.view,this.desiredCamera,c.extent,c.spatialReference))&&this._applyCorrection()}_applyCorrection(){this.view.state.updateCamera(c=>{c.copyViewFrom(this.desiredCamera);d.applySurfaceCollisionConstraint(this.view,c,d.Mode.EYE_AND_CENTER)||this.constraintEnabled||(this.state=f.State.Stopped)})}};b.__decorate([n.property({constructOnly:!0})],a.SurfaceCollisionCorrectionController.prototype,"desiredCamera",null);a.SurfaceCollisionCorrectionController=b.__decorate([e.subclass("esri.views.3d.state.controllers.SurfaceCollisionCorrectionController")],
a.SurfaceCollisionCorrectionController);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/viewpointUtils":function(){define("exports ../../../Camera ../../../geometry ../../../Graphic ../../../Viewpoint ../../../core/asyncUtils ../../../core/has ../../../core/Cyclical ../../../core/Error ../../../core/promiseUtils ../../../core/libs/gl-matrix-2/math/mat3 ../../../core/libs/gl-matrix-2/factories/mat3f64 ../../../core/libs/gl-matrix-2/factories/mat4f64 ../../../chunks/vec32 ../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../geometry/projection ../../../geometry/projection/computeTranslationToOriginAndRotation ../../../geometry/projection/projectPointToVector ../../../geometry/projection/projectVectorToPoint ../../../geometry/projection/projectVectorToVector ../../../geometry/support/aaBoundingBox ../../../geometry/support/aaBoundingRect ../../../geometry/support/frustum ../../../geometry/support/scaleUtils ../camera/intersectionUtils ./cameraUtils ./ElevationProvider ../../../geometry/Point ../../../geometry/Extent ../../../geometry/SpatialReference ../../../geometry/Geometry ../../../geometry/Multipoint".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w,x,u,t,m,q,r,v,y,B,z,A,C,H,E,F,G,D,I,J){async function N(ta,Ba,Ia,Ca){var Ha=Ba.camera;if(null!=Ha)return M(Ha,H.getViewSR(ta),Ca);({targetGeometry:Ha}=Ba);if(null==Ha)throw Error("Viewpoint has no targetGeometry!");const {camera:Ga,mode:Aa}=Q(ta,Ba.rotation,Ia);if("point"===Ha.type)return O(ta,Ba,Ha,Ga,Aa,Ca);Ba=Ha.extent;if(null==Ba)throw Error("Target geometry has no extent!");return H.fromExtentAsync(ta,Ba,Ga.heading,Ga.tilt,Aa,Ca)}async function M(ta,Ba,Ia){Ba=
await t.projectWithZConversion(ta.position,Ba,{signal:Ia});f.throwIfAborted(Ia);ta=ta.clone();ta.position=Ba.clone();return ta}function Q(ta,Ba,Ia){ta=H.internalToExternal(ta,ta.state.camera);let Ca=H.OrientationMode.ADJUST;null!=Ba&&(ta.heading=360-g.cyclicalDegrees.normalize(Ba),Ca=H.OrientationMode.LOCKED);null!=Ia&&(ta.tilt=Ia);return{camera:ta,mode:Ca}}async function O(ta,Ba,Ia,Ca,Ha,Ga){const Aa=ta.spatialReference;Ia=await t.projectWithZConversion(Ia.clone(),Aa,{signal:Ga});f.throwIfAborted(Ga);
Ba=null!=Ba.scale?H.scaleToDistance(ta,Ba.scale):ta.state.camera.distance;return H.fromCenterDistanceAsync(ta,Ia,Ba,Ca,Ha,Ga)}function K(ta,Ba){return null==Ba.scale&&null!=Ba.zoom?H.zoomToScale(ta,Ba.zoom):Ba.scale}function L(ta,Ba){let Ia=!1;null!=Ba.heading?(ta.heading=Ba.heading,Ia=!0):null!=Ba.rotation&&(ta.heading=360-g.cyclicalDegrees.normalize(Ba.rotation),Ia=!0);null!=Ba.tilt&&(ta.tilt=Ba.tilt,Ia=!0);null!=Ba.fov&&(ta.fov=Ba.fov);return Ia}function P(ta,Ba,Ia,Ca){var Ha=ta.spatialReference||
D.WGS84;Ba??=H.externalToInternal(ta,Ia);if(null==Ba)return Ca;Ha=new F({spatialReference:Ha});if(!r.projectVectorToPoint(Ba.center,ta.renderSpatialReference,Ha))return Ca;Ca.targetGeometry=Ha;Ca.scale=H.distanceToScale(ta,Ba.distance);Ca.rotation=g.cyclicalDegrees.normalize(360-Ia.heading);Ca.camera=Ia;return Ca}async function R(ta,Ba,Ia,Ca){const Ha=()=>new d("viewpointutils:invalid-geometry","The target is missing a valid geometry");if(!Ba)throw Ha();"mesh"===Ba.type&&(Ba=Ba.extent);const Ga=ta.basemapTerrain.spatialReference;
if(!Ba.hasZ&&ta.basemapTerrain){let Ja;switch(Ba.type){case "point":Ja=Ba;break;case "multipoint":case "polyline":Ja=Ba.extent?.center;break;case "extent":Ja=Ba.center;break;case "polygon":Ja=Ba.centroid}null!=Ja&&Ga&&ta.elevationProvider?(Ja=await t.projectWithZConversion(Ja,Ga,{signal:Ca}),ea[2]=E.getElevationAtPoint(ta.elevationProvider,Ja)??0):ea[2]=0}const Aa=[];(0,xa[Ba.type])(Ba,Ba.hasZ?Ja=>{Aa.push([Ja[0],Ja[1],Ja[2]])}:Ja=>{Aa.push([Ja[0],Ja[1]])},ea);if(0===Aa.length)throw Ha();ta=ta.spatialReference;
Ca=await t.projectWithZConversion(new J({spatialReference:Ba.spatialReference,hasZ:Ba.hasZ,hasM:!1,points:Aa}),ta,{signal:Ca});Ba.hasZ&&(Ia.hasZ=!0);if(Ba.hasZ)for(const [Ja,Sa,$a]of Ca.points)ea[0]=Ja,ea[1]=Sa,ea[2]=$a,y.expandWithVec3(Ia.boundingBox,ea);else for(const [Ja,Sa]of Ca.points)ea[0]=Ja,ea[1]=Sa,y.expandWithVec3(Ia.boundingBox,ea)}async function W(ta,Ba,Ia,Ca,Ha){const Ga=await h.result(ta.whenViewForGraphic(Ba));if(!1!==Ga.ok&&null!=Ga.value&&"whenGraphicBounds"in Ga.value)if(Ia=await h.result(Ga.value.whenGraphicBounds(Ba,
{minDemResolution:Ia})),!1!==Ia.ok&&Ia.value){var {screenSpaceObjects:Aa,boundingBox:Ja}=Ia.value;y.expandWithAABB(Ca.boundingBox,Ja);Aa&&Aa.forEach(Sa=>{Ca.screenSpaceObjects.push(Sa)});isFinite(Ja[2])&&(Ca.hasZ=!0)}else await R(ta,Ba.geometry,Ca,Ha);else await R(ta,Ba.geometry,Ca,Ha)}async function V(ta,Ba,Ia,Ca,Ha){if(Array.isArray(Ba)&&2===Ba.length){const Ga=Ba[0],Aa=Ba[1];if("number"===typeof Ga&&"number"===typeof Aa){sa.x=Ga;sa.y=Aa;sa.z=void 0;sa.spatialReference=ta.spatialReference?.isGeographic?
ta.spatialReference:D.WGS84;await R(ta,sa,Ca,Ha);return}}Ba&&"map"in Ba&&"function"===typeof Ba.map?await Promise.allSettled(Ba.map(Ga=>V(ta,Ga,Ia,Ca,Ha))):Ba instanceof I?await R(ta,Ba,Ca,Ha):Ba instanceof k&&await W(ta,Ba,Ia,Ca,Ha)}async function ba(ta,Ba,Ia,Ca,Ha){if(Ba.camera)return U(ta,Ba.camera,Ca,Ha);Ha.scale=Ba.scale;Ha.rotation=Ba.rotation;Ha.targetGeometry=null!=Ba.targetGeometry?Ba.targetGeometry.clone():null;Ha.camera=null;null!=Ia.heading?Ha.rotation=g.cyclicalDegrees.normalize(360-
Ia.heading):null!=Ia.rotation&&(Ha.rotation=Ia.rotation);Ba=K(ta,Ia);null!=Ba&&(Ha.scale=Ba);Ha.camera=await N(ta,Ha,Ia.tilt,Ca);return Ha}async function U(ta,Ba,Ia,Ca){Ia=await t.projectWithZConversion(Ba.position,ta.spatialReference,{signal:Ia});Ba=Ba.clone();Ba.position=Ia;return P(ta,null,Ba,Ca)}async function da(ta,Ba,Ia,Ca,Ha,Ga,Aa){const Ja=ta.renderSpatialReference;await q.projectPointToVectorAsync(Ba,na,Ja,0,{signal:Aa});await q.projectPointToVectorAsync(Ia,la,Ja,0,{signal:Aa});Ga.targetGeometry=
new F(Ba);Ha.position=new F(Ia);x.subtract(pa,na,la);H.directionToHeadingTilt(ta,la,pa,Ca.up,Ha);Ga.scale=H.distanceToScale(ta,x.distance(la,na));Ga.rotation=g.cyclicalDegrees.normalize(360-Ha.heading);Ga.camera=Ha;return Ga}async function fa(ta,Ba,Ia,Ca,Ha,Ga){Ga.targetGeometry=Ia.clone();Ia=C.cameraOnContentAlongViewDirection(ta);if(Ba.position)return da(ta,Ga.targetGeometry,Ba.position,Ia,Ca,Ga,Ha);if(Ba.zoomFactor){var Aa=Ia.distance/Ba.zoomFactor;const Ja=x.scale(ea,Ia.viewForward,-Aa);Ia.eye=
x.add(ea,Ia.center,Ja);Ga.scale=H.distanceToScale(ta,Aa)}H.internalToExternal(ta,Ia,Ca);Aa=L(Ca,Ba)?H.OrientationMode.LOCKED:H.OrientationMode.ADJUST;Ba.zoomFactor||(Ba=K(ta,Ba),null==Ba?(await q.projectPointToVectorAsync(Ga.targetGeometry,ea,ta.renderSpatialReference,0,{signal:Ha}),Ha=z.intersectsPoint(Ia.frustum,ea)?x.distance(Ia.eye,ea):Ia.distance,Ga.camera=await H.fromCenterDistanceAsync(ta,Ga.targetGeometry,Ha,Ca,Aa),Ga.scale=H.distanceToScale(ta,Ha)):(Ga.scale=Ba,Ga.camera=await H.fromCenterScale(ta,
Ga.targetGeometry,Ga.scale,Ca,Aa,Ha)));return Ga}async function ha(ta,Ba,Ia,Ca,Ha){var Ga=C.cameraOnContentAlongViewDirection(ta);x.copy(pa,Ga.viewForward);H.directionToHeadingTilt(ta,Ga.eye,pa,Ga.up,qa);Ga=ta.spatialReference;const {position:Aa}=Ba;Aa?(Ha=await t.projectWithZConversion(Aa,Ga,{signal:Ha}),Ia.position=Ha):Ia.position=new F;Ia.heading=null!=Ba.heading?Ba.heading:qa.heading;Ia.tilt=null!=Ba.tilt?Ba.tilt:qa.tilt;return P(ta,null,Ia,Ca)}async function T(ta,Ba,Ia,Ca,Ha){if(null!=Ba.heading||
null!=Ba.rotation||null!=Ba.scale||null!=Ba.tilt||null!=Ba.zoom||null!=Ba.zoomFactor){const Ga=C.cameraOnContentAlongViewDirection(ta),{spatialReference:Aa,renderSpatialReference:Ja}=ta,Sa=new F({spatialReference:Aa});return r.projectVectorToPoint(Ga.center,Ja,Sa)?fa(ta,Ba,Sa,Ia,Ca,Ha):Ha}Ha.scale=ta.scale;Ha.camera=ta.camera.clone();L(Ha.camera,Ba);return Ha}async function S(ta,Ba,Ia,Ca,Ha,Ga){Ga.targetGeometry=Ia.clone();const Aa=C.cameraOnContentAlongViewDirection(ta);H.internalToExternal(ta,Aa,
Ca);Ba=L(Ca,Ba)?H.OrientationMode.LOCKED:H.OrientationMode.ADJUST;Ga.camera=await H.fromExtentAsync(ta,Ia,Ca.heading,Ca.tilt,Ba,Ha);return Ga}async function Z(ta,Ba,Ia,Ca,Ha,Ga,Aa,Ja){Ja.targetGeometry=Ia.clone();const Sa=C.cameraOnContentAlongViewDirection(ta);var $a=0;null!=Ia.z?$a=Ia.z:ta.basemapTerrain&&ta.elevationProvider&&($a=E.getElevationAtPoint(ta.elevationProvider,Ia));x.set(ea,Ia.x,Ia.y,$a);m.computeTranslationToOriginAndRotation(ta.spatialReference,ea,ka,ta.renderSpatialReference);c.fromMat4(ja,
ka);c.transpose(ja,ja);y.empty(X);Ia=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]];for(var Wa=0;Wa<Ia.length;Wa++){const Ta=Ia[Wa];let Da=Ca[Ta[2]];isFinite(Da)||(Da=$a);x.set(ea,Ca[Ta[0]],Ca[Ta[1]],Da);v.projectVectorToVector(ea,ta.spatialReference,ea,ta.renderSpatialReference);y.expandWithVec3(X,x.transformMat3(ea,ea,ja))}Ca=y.width(X);$a=y.height(X);Ia=y.depth(X);Wa=1/Math.tan(Sa.fovY/2);Ha=Math.max(.5*Math.sqrt(Ca*Ca+Ia*Ia)*Math.max(Wa,1/Math.tan(Sa.fovX/2))+.5*$a,.5*$a*Wa+
.5*Math.max(Ca,Ia))/Ha;H.internalToExternal(ta,Sa,Ga);Ba=L(Ga,Ba)?H.OrientationMode.LOCKED:H.OrientationMode.ADJUST;Ja.camera=await H.fromCenterDistanceAsync(ta,Ja.targetGeometry,Ha,Ga,Ba,Aa);Ja.scale=H.distanceToScale(ta,Ha);return Ja}function ia(ta){null!=ta?.camera&&(ta.rotation=g.cyclicalDegrees.normalize(360-ta.camera.heading));return ta}class Y{constructor(){this.hasZ=!1;this.boundingBox=y.empty();this.screenSpaceObjects=[]}}const ea=u.create(),ka=w.create(),ja=l.create(),X=y.create(),aa=B.create(),
pa=u.create(),la=u.create(),na=u.create(),qa={heading:0,tilt:0},sa=new F,xa={point(ta,Ba,Ia){Ia[0]=ta.x;Ia[1]=ta.y;null!=ta.z&&(Ia[2]=ta.z);Ba(Ia)},polygon(ta,Ba,Ia){const Ca=ta.hasZ;for(let Ha=0;Ha<ta.rings.length;Ha++){const Ga=ta.rings[Ha];for(let Aa=0;Aa<Ga.length;Aa++)Ia[0]=Ga[Aa][0],Ia[1]=Ga[Aa][1],Ca&&(Ia[2]=Ga[Aa][2]),Ba(Ia)}},polyline(ta,Ba,Ia){const Ca=ta.hasZ;for(let Ha=0;Ha<ta.paths.length;Ha++){const Ga=ta.paths[Ha];for(let Aa=0;Aa<Ga.length;Aa++)Ia[0]=Ga[Aa][0],Ia[1]=Ga[Aa][1],Ca&&(Ia[2]=
Ga[Aa][2]),Ba(Ia)}},multipoint(ta,Ba,Ia){const Ca=ta.points;ta=ta.hasZ;for(let Ha=0;Ha<Ca.length;Ha++)Ia[0]=Ca[Ha][0],Ia[1]=Ca[Ha][1],ta&&(Ia[2]=Ca[Ha][2]),Ba(Ia)},extent(ta,Ba,Ia){null!=ta.zmin&&null!=ta.zmax?(Ba(x.set(Ia,ta.xmin,ta.ymin,ta.zmin)),Ba(x.set(Ia,ta.xmax,ta.ymin,ta.zmin)),Ba(x.set(Ia,ta.xmin,ta.ymax,ta.zmin)),Ba(x.set(Ia,ta.xmax,ta.ymax,ta.zmin)),Ba(x.set(Ia,ta.xmin,ta.ymin,ta.zmax)),Ba(x.set(Ia,ta.xmax,ta.ymin,ta.zmax)),Ba(x.set(Ia,ta.xmin,ta.ymax,ta.zmax)),Ba(x.set(Ia,ta.xmax,ta.ymax,
ta.zmax))):(Ba(x.set(Ia,ta.xmin,ta.ymin,Ia[2])),Ba(x.set(Ia,ta.xmax,ta.ymin,Ia[2])),Ba(x.set(Ia,ta.xmin,ta.ymax,Ia[2])),Ba(x.set(Ia,ta.xmax,ta.ymax,Ia[2])))}};a.create=async function(ta,Ba,Ia){if(Ba&&ta.spatialReference){var Ca={target:void 0};"declaredClass"in Ba||Array.isArray(Ba)?Ca.target=Ba:(Object.assign(Ca,Ba),!Ca.target&&"center"in Ba&&Ba.center&&(Ca.target=Ba.center));Ba=Ca}else Ba=null;if(!Ba)throw new d("viewpointutils-create:no-target","Missing target for creating viewpoint");Ca=new b({fov:ta.camera.fov});
const Ha=new p({camera:Ca});if(Ba.target instanceof p)return ta=await ba(ta,Ba.target,Ba,Ia,Ha),ia(ta);if(Ba.target instanceof b)return ia(await U(ta,Ba.target,Ia,Ha));var Ga=null!=Ba.scale||null!=Ba.zoom;if(Ba.target instanceof G){var Aa=Ba.target.xmin===Ba.target.xmax||Ba.target.ymin===Ba.target.ymax;return Ga||Aa?ia(await fa(ta,Ba,Ba.target.center,Ca,Ia,Ha)):ia(await S(ta,Ba,Ba.target,Ca,Ia,Ha))}Aa=new Y;var Ja=Ga?(Ja=K(ta,Ba))?A.getResolutionInMetersForScale(Ja):void 0:void 0;await V(ta,Ba.target,
Ja,Aa,Ia);if(isFinite(Aa.boundingBox[0])){y.center(Aa.boundingBox,ea);sa.x=ea[0];sa.y=ea[1];sa.z=ea[2];sa.spatialReference=ta.spatialReference;isFinite(sa.z)&&Aa.hasZ?Ja=y.isPoint(Aa.boundingBox):(sa.z=void 0,Ja=B.isPoint(y.toRect(Aa.boundingBox,aa)));if(Ga||Ja)return ia(await fa(ta,Ba,sa,Ca,Ia,Ha));Ga=Aa.screenSpaceObjects;if(Ga.length){Ja=Number.NEGATIVE_INFINITY;for(let Sa=0;Sa<Ga.length;Sa++){const $a=Ga[Sa].screenSpaceBoundingRect;Ja=Math.max(Ja,Math.abs($a[0]),Math.abs($a[1]),Math.abs($a[2]),
Math.abs($a[3]))}Ga=.66-Ja/Math.min(ta.width,ta.height)*2}else Ga=.66;return ia(await Z(ta,Ba,sa,Aa.boundingBox,Ga,Ca,Ia,Ha))}return Ba.position?ia(await ha(ta,Ba,Ca,Ha,Ia)):ia(await T(ta,Ba,Ca,Ia,Ha))};a.fromCamera=function(ta,Ba,Ia=null){null==Ia&&(Ia=new p);return P(ta,null,Ba.clone(),Ia)};a.toCameraAsync=N;a.toCameraSync=function(ta,Ba,Ia){var Ca=Ba.camera;if(null!=Ca){a:{ta=H.getViewSR(ta);var Ha=Ca.position;try{var Ga=t.tryProjectWithZConversion(Ha,ta)}catch(Sa){ta=null;break a}Ga?(ta=Ca.clone(),
ta.position=Ga.clone()):ta=null}return ta}({targetGeometry:Ga}=Ba);if(null==Ga)return null;const {camera:Aa,mode:Ja}=Q(ta,Ba.rotation,Ia);if("point"===Ga.type){a:{Ca=ta.spatialReference;try{Ha=t.tryProjectWithZConversion(Ga.clone(),Ca)}catch(Sa){ta=null;break a}Ha?(Ga=null!=Ba.scale?H.scaleToDistance(ta,Ba.scale):ta.state.camera.distance,ta=H.fromCenterDistanceSync(ta,Ha,Ga,Aa,Ja)):ta=null}return ta}Ga=Ga.extent;return null==Ga?null:H.fromExtentSync(ta,Ga,Aa.heading,Aa.tilt,Ja)};Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/RenderFeature":function(){define(["exports","../../../../core/has","../../../../core/NestedMap","../../../support/RenderState"],function(a,b,n,k){a.RenderFeature=void 0;(function(p){p[p.Antialiasing=0]="Antialiasing";p[p.HighQualityTransparency=1]="HighQualityTransparency";p[p.HighResolutionVoxel=2]="HighResolutionVoxel";p[p.HighResolutionAtmosphere=3]="HighResolutionAtmosphere";p[p.SSAO=4]="SSAO";p[p.WaterReflection=5]="WaterReflection";
p[p.HighResolutionShadows=6]="HighResolutionShadows";p[p.HighResolutionViewshed=7]="HighResolutionViewshed";p[p.PhysicalPixelRendering=8]="PhysicalPixelRendering"})(a.RenderFeature||(a.RenderFeature={}));a.setupFeatureDefaults=function(p=!b("disable-feature:high-quality-idle"),h=null){const e=new n.NestedMap;p?(e.set(k.RenderState.IDLE,a.RenderFeature.Antialiasing,"low"!==h),e.set(k.RenderState.IDLE,a.RenderFeature.HighResolutionAtmosphere,"low"!==h),e.set(k.RenderState.IDLE,a.RenderFeature.HighQualityTransparency,
!0),e.set(k.RenderState.IDLE,a.RenderFeature.SSAO,!0),e.set(k.RenderState.IDLE,a.RenderFeature.WaterReflection,!0),e.set(k.RenderState.IDLE,a.RenderFeature.PhysicalPixelRendering,!0)):(e.set(k.RenderState.ANIMATING,a.RenderFeature.HighResolutionShadows,!0),e.set(k.RenderState.ANIMATING,a.RenderFeature.HighResolutionViewshed,!0),e.set(k.RenderState.INTERACTING,a.RenderFeature.HighResolutionShadows,!0),e.set(k.RenderState.INTERACTING,a.RenderFeature.HighResolutionViewshed,!0));e.set(k.RenderState.IDLE,
a.RenderFeature.HighResolutionShadows,!0);e.set(k.RenderState.IDLE,a.RenderFeature.HighResolutionViewshed,!0);e.set(k.RenderState.IDLE,a.RenderFeature.HighResolutionVoxel,!0);return e};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/NestedMap":function(){define(["exports"],function(a){class b{constructor(){this._outer=new Map}clear(){this._outer.clear()}get empty(){return 0===this._outer.size}get(n,k){return this._outer.get(n)?.get(k)}getInner(n){return this._outer.get(n)}set(n,
k,p){const h=this._outer.get(n);h?h.set(k,p):this._outer.set(n,new Map([[k,p]]))}delete(n,k){const p=this._outer.get(n);p&&(p.delete(k),0===p.size&&this._outer.delete(n))}forEach(n){this._outer.forEach((k,p)=>n(k,p))}forAll(n){for(const k of this._outer.values())for(const p of k.values())n(p)}}a.NestedMap=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/input/handlers/DragZoom":function(){define("exports ../../../../core/screenUtils ../../state/controllers/FovController ../../state/controllers/ZoomControllerGlobal ../../state/controllers/ZoomControllerLocal ../../../input/InputHandler ../../../input/handlers/support".split(" "),
function(a,b,n,k,p,h,e){class g extends h.InputHandler{constructor(d,f,c){super(!0);this._view=d;this.pointerAction=f;this._fovModifier=c;this.registerIncoming("drag",[c],l=>this._handleZoom(l));this.registerIncoming("drag",l=>this._handleZoom(l))}_handleZoom(d){var f=d.data;if(!(1<f.pointers.size)&&e.eventMatchesMousePointerAction(d.data,this.pointerAction)){var c=b.createScreenPointArray(f.center.x,f.center.y);switch(f.action){case "start":this._cameraController?.finish();f=this._view;this._cameraController=
d.modifiers.has(this._fovModifier)?new n.FovController({view:f,onStop:()=>this._stopController()}):f.state.isGlobal?new k.ZoomControllerGlobal({view:f}):new p.ZoomControllerLocal({view:f});this._view.state.switchCameraController(this._cameraController);this._cameraController.begin(c);break;case "update":this._cameraController?.update(c);break;case "end":this._cameraController instanceof n.FovController?this._cameraController.updateTimeout():this._stopController()}d.stopPropagation()}}_stopController(){this._cameraController?.finish();
this._cameraController=null}}a.DragZoom=g;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/controllers/FovController":function(){define("exports ../../../../chunks/tslib.es6 ../../../../Camera ../../../../core/mathUtils ../../../../core/maybe ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/Logger ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../camera/constraintUtils ../../camera/constraintUtils/ConstraintOptions ../../camera/constraintUtils/ConstraintTypes ../../camera/constraintUtils/InteractionType ./InteractiveController ../utils/navigationUtils ../../../ui/Component ../../../../widgets/FovOverlay".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w,x,u,t,m,q,r,v){a.FovController=class extends m.InteractiveController{constructor(z){super(z);this.onStop=null;this._timeOutId=void 0;this._onReset=()=>{this._startSize=this._lastDrag=null;this._setFov(y);this.updateTimeout()};this._center=l.create();this._viewForward=l.create();this._constraints=new x.ConstraintOptions(u.ConstraintTypes.ALL,t.InteractionType.ZOOM)}begin(z){Array.isArray(z)?(this._lastDrag=z[1],this._startSize=null,this._ensureStartSize(this.view.state.camera)):
this._showOverlay().fov=z.fov}updateTimeout(){clearTimeout(this._timeOutId);this._timeOutId=setTimeout(this.onStop,1500)}update(z){if(null==this._lastDrag)this._lastDrag=z[1],this._startSize=null,this._ensureStartSize(this.view.state.camera);else{var A=-(this._lastDrag-z[1])/2;this._lastDrag=z[1];this.step(A)}}step(z){if(this.running){var A=this.currentCamera.copyFrom(this.view.state.camera);z=k.rad2deg(A.fov)+z;z=k.deg2rad(k.clamp(z,10,150));z===A.fov?this._showOverlay().fov=A.fov:this._setFov(z)}else this._startSize=
this._lastDrag=null}finish(){this.running&&(this._startSize=this._lastDrag=null,this.finishController())}destroy(){this.hideOverlay()}onControllerEnd(z){super.onControllerEnd(z);this._startSize=this._lastDrag=null;this.hideOverlay()}_showOverlay(){this._overlay||(this._overlay=new r({id:"esri.FovOverlay",node:new v.FovOverlay({onReset:this._onReset})}),this.view.ui.add(this._overlay));return this._overlay.widget}hideOverlay(){this._overlay&&(this.view.ui.remove(this._overlay),this._overlay=p.destroyMaybe(this._overlay))}_setFov(z){const A=
this.view.state,C=this.currentCamera.copyFrom(A.camera);var H=this._ensureStartSize(C)/Math.tan(z/2);H=c.add(B,this._center,c.scale(B,this._viewForward,-H));C.eye=H;C.fov=z;this._constraints.interactionStartCamera=A.camera;this._constraints.interactionFactor=w.pixelDistanceToInteractionFactor(this.currentCamera.height-A.camera.height);w.applyAll(this.view,this.currentCamera,this._constraints);this.begin(C);this.commitCamera()}_ensureStartSize(z){if(null==this._startSize){c.copy(this._viewForward,
z.viewForward);var A=this.view._stage.renderView.getMinimalDepthForArea(null,z.fullWidth/z.pixelRatio*.5,z.fullHeight/z.pixelRatio*.5,z,q.screenPixelArea);const C=c.distance(z.eye,this.view.pointsOfInterest.centerOnContent.renderLocation);A=A??C;c.add(this._center,z.eye,c.scale(B,this._viewForward,A));this._startSize=A*Math.tan(z.fov/2)}return this._startSize}};b.__decorate([h.property()],a.FovController.prototype,"onStop",void 0);a.FovController=b.__decorate([f.subclass("esri.views.3d.state.controllers.FovController")],
a.FovController);const y=k.deg2rad((new n).fov),B=l.create();Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/ui/Component":function(){define("../../chunks/tslib.es6 ../../core/Accessor ../../core/domUtils ../../core/accessorSupport/decorators/property ../../core/accessorSupport/decorators/cast ../../core/RandomLCG ../../core/has ../../core/accessorSupport/decorators/subclass".split(" "),function(a,b,n,k,p,h,e,g){b=class extends b{constructor(){super(...arguments);this.widget=
null}destroy(){this.node=null;this.widget?.destroy()}get id(){return this._get("id")??this.widget?.id??this.node?.id}set id(d){this._set("id",d)}set node(d){const f=this._get("node");d!==f&&(d&&d.classList.add("esri-component"),f&&f.classList.remove("esri-component"),this._set("node",d))}castNode(d){this.widget?.destroy();if(!d)return this._set("widget",null),null;if("string"===typeof d||d&&"nodeType"in d)return this._set("widget",null),n.byId(d);d&&"function"===typeof d.render&&!d.domNode&&(d.domNode=
document.createElement("div"));this._set("widget",d);return d.domNode}};a.__decorate([k.property()],b.prototype,"id",null);a.__decorate([k.property()],b.prototype,"node",null);a.__decorate([p.cast("node")],b.prototype,"castNode",null);a.__decorate([k.property({readOnly:!0})],b.prototype,"widget",void 0);return b=a.__decorate([g.subclass("esri.views.ui.Component")],b)})},"esri/widgets/FovOverlay":function(){define("exports ../chunks/tslib.es6 ../core/mathUtils ../core/unitFormatUtils ../core/accessorSupport/decorators/property ../core/has ../core/Logger ../core/RandomLCG ../core/accessorSupport/decorators/subclass ./Widget ./support/widgetUtils ./support/decorators/messageBundle ./support/jsxFactory".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w){const x={base:"esri-fov-overlay",outer:"esri-fov-overlay-outer",reset:"esri-fov-overlay-reset",text:"esri-fov-overlay-text"};a.FovOverlay=class extends f{constructor(t){super(t);this.onReset=()=>{};this.fov=this._messagesUnits=this._messagesCommon=null}render(){return w.tsx("div",{class:x.outer},w.tsx("div",{class:x.base},w.tsx("p",{class:x.text},this._overlay),w.tsx("p",{class:x.reset,onclick:this.onReset,title:this._messagesCommon.reset},this._reset)))}get _overlay(){const {fov:t,
_messagesUnits:m}=this;if(!m||null==t)return"";const q=k.formatAngleDegrees(n.rad2deg(t),"degrees","arithmetic","arithmetic",0),r=k.formatDecimal(m,u/(2*Math.tan(t/2)),"millimeters",0,"abbr");return`${q} | ${r} |`}get _reset(){return this._messagesUnits&&null!=this.fov?"\u21ba":""}};b.__decorate([p.property()],a.FovOverlay.prototype,"onReset",void 0);b.__decorate([p.property(),l.messageBundle("esri/t9n/common")],a.FovOverlay.prototype,"_messagesCommon",void 0);b.__decorate([p.property(),l.messageBundle("esri/core/t9n/Units")],
a.FovOverlay.prototype,"_messagesUnits",void 0);b.__decorate([p.property()],a.FovOverlay.prototype,"fov",void 0);b.__decorate([p.property()],a.FovOverlay.prototype,"_overlay",null);b.__decorate([p.property()],a.FovOverlay.prototype,"_reset",null);a.FovOverlay=b.__decorate([d.subclass("esri.widgets.FovOverlay")],a.FovOverlay);const u=Math.sqrt(1872);a.base="esri-fov-overlay";a.css=x;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/unitFormatUtils":function(){define("exports ./ByteSizeUnit ./Cyclical ./mathUtils ./quantityUtils ./string ./unitUtils ../intl/number".split(" "),
function(a,b,n,k,p,h,e,g){function d(u,t,m){return u.units[t][m]}function f(u,t,m,q=2,r="abbr"){return`${g.formatNumber(t,{minimumFractionDigits:q,maximumFractionDigits:q,signDisplay:0<t?"never":"exceptZero"})} ${d(u,m,r)}`}function c(u,t,m,q=2,r="abbr"){return`${g.formatNumber(t,{minimumFractionDigits:q,maximumFractionDigits:q,signDisplay:"exceptZero"})} ${d(u,m,r)}`}function l(u,t){const m=JSON.stringify(t);let q=w.get(m);q||(q=new Intl.NumberFormat("en-US",t),w.set(m,q));return/^[-+]?360\.?0*\u00b0?$/.test(q.format(u))?
0:u}const w=new Map,x=["B","kB","MB","GB","TB"];a.formatAngleDegrees=function(u,t,m,q,r,v=n.cyclicalDegrees,y=!0){u=v.normalize(p.convertRotationType(e.convertUnit(u,t,"degrees"),m,q),0,y);r=r??2;r={style:"unit",unitDisplay:"narrow",unit:"degree",maximumFractionDigits:r,minimumFractionDigits:r,signDisplay:0<u?"never":"exceptZero"};u=l(u,r);return g.formatNumber(u,r)};a.formatDMS=function(u,t,m=2){u=e.convertUnit(u,t,"degrees");t=u-Math.floor(u);u-=t;t*=60;let q=t-Math.floor(t);t-=q;q*=60;return`${u.toFixed()}\u00b0 ${t.toFixed()}' ${q.toFixed(m)}"`};
a.formatDecimal=f;a.formatFileSize=function(u,t){t=Math.round(t);let m=0===t?0:Math.floor(Math.log(t)/Math.log(b.ByteSizeUnit.KILOBYTES));m=k.clamp(m,0,x.length-1);t=g.formatNumber(t/b.ByteSizeUnit.KILOBYTES**m,{maximumFractionDigits:2});return h.replace(u.units.bytes[x[m]],{fileSize:t})};a.formatImperialArea=function(u,t,m,q=2,r="abbr"){const v=e.adaptiveImperialAreaUnit(t,m);return f(u,e.convertUnit(t,m,v),v,q,r)};a.formatImperialLength=function(u,t,m,q=2,r="abbr"){const v=e.adaptiveImperialLengthUnit(t,
m);return f(u,e.convertUnit(t,m,v),v,q,r)};a.formatImperialRelativeLength=function(u,t,m,q=2,r="abbr"){const v=e.adaptiveImperialLengthUnit(t,m);return c(u,e.convertUnit(t,m,v),v,q,r)};a.formatImperialRelativeVerticalLength=function(u,t,m,q=2,r="abbr"){const v=e.adaptiveImperialVerticalLengthUnit(t,m);return c(u,e.convertUnit(t,m,v),v,q,r)};a.formatImperialVerticalLength=function(u,t,m,q=2,r="abbr"){const v=e.adaptiveImperialVerticalLengthUnit(t,m);return f(u,e.convertUnit(t,m,v),v,q,r)};a.formatMetricArea=
function(u,t,m,q=2,r="abbr"){const v=e.adaptiveMetricAreaUnit(t,m);return f(u,e.convertUnit(t,m,v),v,q,r)};a.formatMetricLength=function(u,t,m,q=2,r="abbr"){const v=e.adaptiveMetricLengthUnit(t,m);return f(u,e.convertUnit(t,m,v),v,q,r)};a.formatMetricRelativeLength=function(u,t,m,q=2,r="abbr"){const v=e.adaptiveMetricLengthUnit(t,m);return c(u,e.convertUnit(t,m,v),v,q,r)};a.formatMetricRelativeVerticalLength=function(u,t,m,q=2,r="abbr"){const v=e.adaptiveMetricVerticalLengthUnit(t,m);return c(u,e.convertUnit(t,
m,v),v,q,r)};a.formatMetricVerticalLength=function(u,t,m,q=2,r="abbr"){const v=e.adaptiveMetricVerticalLengthUnit(t,m);return f(u,e.convertUnit(t,m,v),v,q,r)};a.formatRelativeAngleDegrees=function(u,t,m,q,r=2){m!==q&&(u=-u);m={style:"unit",unitDisplay:"narrow",unit:"degree",maximumFractionDigits:r,minimumFractionDigits:r,signDisplay:"exceptZero"};u=e.convertUnit(u,t,"degrees")%360;u=l(u,m);return g.formatNumber(u,m)};a.formatRelativeDecimal=c;a.unitName=d;Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/core/ByteSizeUnit":function(){define(["exports"],function(a){a.ByteSizeUnit=void 0;var b=a.ByteSizeUnit||(a.ByteSizeUnit={});b[b.KILOBYTES=1024]="KILOBYTES";b[b.MEGABYTES=1048576]="MEGABYTES";b[b.GIGABYTES=1073741824]="GIGABYTES";Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/quantityUtils":function(){define(["exports","./unitUtils"],function(a,b){function n(x,u){return{type:b.unitType(u),value:x,unit:u}}function k(x,u){return{type:b.unitType(u),
value:x,unit:u}}function p(x,u){return{type:b.unitType(u),value:x,unit:u}}function h(x,u,t="arithmetic"){return{type:b.unitType(u),value:x,unit:u,rotationType:t}}function e(x,u){const t=g(x,u);return"angle"===x.type?h(t,u,x.rotationType):n(t,u)}function g(x,u){return b.convertUnit(x.value,x.unit,u)}const d=k(0,"meters"),f=p(0,"square-meters"),c=h(0,"radians"),l=h(0,"degrees"),w=h(0,"degrees","geographic");a.convertRotationType=function(x,u,t){if(u===t)return x;switch(t){case "arithmetic":case "geographic":return-x+
90}};a.createAngle=h;a.createArea=p;a.createLength=k;a.createQuantity=n;a.createScalar=function(x){return{value:x}};a.isBaseUnit=function(x){return b.isBaseUnit(x.unit)};a.max=function(x,u){return null==x?u:null==u?x:x.value>b.convertUnit(u.value,u.unit,x.unit)?x:u};a.min=function(x,u){return null==x?u:null==u?x:x.value<b.convertUnit(u.value,u.unit,x.unit)?x:u};a.scale=function(x,u){return null==x?null:{...x,value:x.value*u}};a.toBaseUnit=function(x){return e(x,b.baseUnitForUnit(x.unit))};a.toUnit=
e;a.valueInUnit=g;a.zeroDegrees=l;a.zeroDegreesGeographic=w;a.zeroMeters=d;a.zeroRadians=c;a.zeroSquareMeters=f;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/controllers/ZoomControllerGlobal":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/mathUtils ../../../../core/screenUtils ../../../../core/Logger ../../../../core/has ../../../../core/RandomLCG ../../../../core/Error ../../../../core/accessorSupport/decorators/subclass ../../../../core/libs/gl-matrix-2/math/vec2 ../../../../core/libs/gl-matrix-2/factories/vec2f64 ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../geometry/ellipsoidUtils ../../../../geometry/support/axisAngle ../../../../chunks/sphere ../../camera/constraintUtils ../../camera/constraintUtils/ConstraintOptions ../../camera/constraintUtils/ConstraintTypes ../../camera/constraintUtils/InteractionType ../../camera/constraintUtils/surfaceCollision ./InteractiveController ../utils/navigationUtils ../../support/geometryUtils/ray".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w,x,u,t,m,q,r,v,y,B,z,A){a.ZoomControllerGlobal=class extends B.InteractiveController{constructor(){super(...arguments);this._pickPoint=w.create();this._tmpP0=c.create();this._panAxisAngle=u.create();this._tmpRayDir=w.create();this._tmpRayDirPick=w.create();this._targetOnSphere=w.create();this._navMode=z.NavigationMode.Horizontal;this._tmpRay={origin:w.create(),direction:w.create()};this.dragBeginPoint=k.createScreenPointArray();this._normalizedAnchorPoint=c.create();
this._constraintOptions=new q.ConstraintOptions(r.ConstraintTypes.ALL_EXCEPT_COLLISION,v.InteractionType.ZOOM,0,this.startCamera);this._sphere=t.create();this._hasPickPoint=!1}get _intersectionHelper(){return this.view.sceneIntersectionHelper}begin(E){if(this.running){f.copy(this.dragBeginPoint,E);z.normalizeCoordinate(this.startCamera,E,this._normalizedAnchorPoint);var F=x.getReferenceEllipsoid(this.view.spatialReference);F=z.pickPointAndInitSphere(this._intersectionHelper,this.startCamera,E,F,z.SpherePickPointFallback.Ellipsoid,
0===this.view.map.ground.opacity?z.contentIntersectorOptions:{});this._navMode=z.navigationMode(this.startCamera,E,this.view.renderCoordsHelper,this.view.viewingMode);if(this._navMode===z.NavigationMode.Horizontal)this._hasPickPoint=!!F.scenePickPoint,this._pickPoint=F.scenePickPoint??this._pickPoint,this._sphere=F.sphere;else{A.fromScreenAtEye(this.startCamera,E,this._tmpRay);l.normalize(this._tmpRay.direction,this._tmpRay.direction);let G;null!=F.scenePickPoint&&(l.subtract(this._tmpRayDirPick,
this.startCamera.eye,F.scenePickPoint),G=l.length(this._tmpRayDirPick));F=Math.abs(this.view.camera.position.z);this.view.renderCoordsHelper.worldUpAtPosition(this.startCamera.eye,H);F=n.clamp(Math.min(z.pivotDistanceModifier,1/Math.abs(l.dot(H,this._tmpRay.direction)))*F,z.distanceClampValues[0],z.distanceClampValues[1]);E=this.view._stage.renderView.getMinimalDepthForArea(null,E[0],E[1],this.view.state.camera,z.screenPixelArea);F=null!=E?E:F;F=null!=G?Math.min(F,G):F;this._hasPickPoint=!0;l.scale(this._tmpRay.direction,
this._tmpRay.direction,F);l.add(this._pickPoint,this._tmpRay.origin,this._tmpRay.direction)}}}update(E){if(this.running){this.currentCamera.eye=this.startCamera.eye;this.currentCamera.center=this.startCamera.center;this.currentCamera.up=this.startCamera.up;if(this._navMode===z.NavigationMode.Horizontal){l.subtract(this._tmpRayDir,this.currentCamera.center,this.currentCamera.eye);var F=l.length(this._tmpRayDir);z.normalizeCoordinate(this.currentCamera,E,this._tmpP0);var G=12*(this._normalizedAnchorPoint[1]-
this._tmpP0[1]),D=F*2**G;const I=this.view.state.constraints.minimumPoiDistance;0>G&&D<I&&(D=I);if(1E-6>Math.abs(F-D))return;this._hasPickPoint&&D<F&&(G=1-(1-D/F)*(1-this._sphere[3]/l.length(this.currentCamera.center)),this.currentCamera.center=l.scale(C,this.currentCamera.center,G));l.scale(this._tmpRayDir,this._tmpRayDir,-D/F);this.currentCamera.eye=l.add(C,this.currentCamera.center,this._tmpRayDir);this._constraintOptions.interactionFactor=m.pixelDistanceToInteractionFactor(f.distance(this.dragBeginPoint,
E));m.applyAll(this.view,this.currentCamera,this._constraintOptions);this._hasPickPoint&&(z.sphereOrPlanePointFromScreenPoint(this._sphere,this.currentCamera,this.dragBeginPoint,this._targetOnSphere),u.fromPoints(this._pickPoint,this._targetOnSphere,this._panAxisAngle),z.applyRotation(this.currentCamera,t.getCenter(this._sphere),this._panAxisAngle))}else{F=l.length(this._tmpRay.direction);z.normalizeCoordinate(this.currentCamera,E,this._tmpP0);E=12*(this._normalizedAnchorPoint[1]-this._tmpP0[1]);
D=F*2**E;G=this.view.state.constraints.minimumPoiDistance;0>E&&D<G&&(D=G);if(1E-6>Math.abs(F-D))return;l.scale(this._tmpRayDir,this._tmpRay.direction,1-D/F);this.currentCamera.eye=l.add(C,this.currentCamera.eye,this._tmpRayDir);this.currentCamera.center=l.add(C,this.currentCamera.center,this._tmpRayDir)}y.applySurfaceCollisionConstraint(this.view,this.currentCamera);this.commitCamera()}}finish(){this.running&&this.finishController()}};a.ZoomControllerGlobal=b.__decorate([d.subclass("esri.views.3d.state.controllers.ZoomControllerGlobal")],
a.ZoomControllerGlobal);const C=w.create(),H=w.create();Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/controllers/ZoomControllerLocal":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/mathUtils ../../../../core/screenUtils ../../../../core/Logger ../../../../core/has ../../../../core/RandomLCG ../../../../core/Error ../../../../core/accessorSupport/decorators/subclass ../../../../core/libs/gl-matrix-2/math/vec2 ../../../../core/libs/gl-matrix-2/factories/vec2f64 ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../geometry/support/plane ../../camera/constraintUtils ../../camera/constraintUtils/ConstraintOptions ../../camera/constraintUtils/ConstraintTypes ../../camera/constraintUtils/InteractionType ../../layers/VoxelWasm ./InteractiveController ../utils/navigationUtils".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w,x,u,t,m,q,r,v,y){a.ZoomControllerLocal=class extends v.InteractiveController{constructor(){super(...arguments);this._tmpP=w.create();this._tmpDir=w.create();this._tmpN=w.create();this._tmpP0=c.create();this._tmpPoi=w.create();this._tmpRayDir=w.create();this.dragBeginPoint=k.createScreenPointArray();this._normalizedAnchorPoint=c.create();this._constraintOptions=new t.ConstraintOptions(m.ConstraintTypes.ALL,q.InteractionType.ZOOM,0,this.startCamera,w.create());this._plane=
x.create()}get _intersectionHelper(){return this.view.sceneIntersectionHelper}begin(A){if(this.running){f.copy(this.dragBeginPoint,A);y.normalizeCoordinate(this.startCamera,A,this._normalizedAnchorPoint);var C=this._intersectionHelper.intersectScreenFreePointFallback(A,this._tmpP,0===this.view.map.ground.opacity?y.contentIntersectorOptions:{});l.subtract(this._tmpDir,this._tmpP,this.startCamera.eye);var H=l.length(this._tmpDir);l.normalize(this._tmpDir,this._tmpDir);var E=Math.abs(this.view.camera.position.z);
E=n.clamp(Math.min(y.pivotDistanceModifier,1/Math.abs(l.dot(z,this._tmpDir)))*E,y.distanceClampValues[0],y.distanceClampValues[1]);A=this.view._stage.renderView.getMinimalDepthForArea(r.getVoxelWasm(this.view),A[0],A[1],this.view.state.camera,y.screenPixelArea);E=null!=A?A:E;E=C?Math.min(E,H):E;l.scale(this._tmpDir,this._tmpDir,E);l.add(this._tmpP,this.startCamera.eye,this._tmpDir);l.subtract(this._tmpN,this.startCamera.eye,this.startCamera.center);l.normalize(this._tmpN,this._tmpN);0>this._tmpN[1]&&
l.negate(this._tmpN,this._tmpN);x.fromPositionAndNormal(this._tmpP,this._tmpN,this._plane)}}update(A){if(this.running){y.intersectPlaneFromScreenPoint(this._plane,this.currentCamera,this.dragBeginPoint,this._tmpPoi)||l.copy(this._tmpPoi,this.currentCamera.center);y.normalizeCoordinate(this.currentCamera,A,this._tmpP0);var C=4*(this._tmpP0[1]-this._normalizedAnchorPoint[1]);f.copy(this._normalizedAnchorPoint,this._tmpP0);l.subtract(this._tmpRayDir,this._tmpPoi,this.currentCamera.eye);var H=l.length(this._tmpRayDir),
E=H*(1-C);this._constraintOptions.interactionDirection&&(l.copy(this._constraintOptions.interactionDirection,this._tmpRayDir),l.scale(this._constraintOptions.interactionDirection,this._constraintOptions.interactionDirection,Math.sign(C)/H));var F=this.view.state.constraints.minimumPoiDistance;0<=C&&E<F&&(E=F,C=-(E-H)/H);1E-6>Math.abs(H-E)||(l.scale(this._tmpRayDir,this._tmpRayDir,C),this.currentCamera.eye=l.add(B,this.currentCamera.eye,this._tmpRayDir),l.lerp(B,this.currentCamera.center,this._tmpPoi,
C),B[2]=this._tmpPoi[2]>this.startCamera.center[2]?Math.max(this.startCamera.center[2],B[2]):Math.min(this.startCamera.center[2],B[2]),this.currentCamera.center=B,this._constraintOptions.interactionFactor=u.pixelDistanceToInteractionFactor(f.distance(this.dragBeginPoint,A)),u.applyAll(this.view,this.currentCamera,this._constraintOptions),this.commitCamera())}}finish(){this.running&&this.finishController()}};a.ZoomControllerLocal=b.__decorate([d.subclass("esri.views.3d.state.controllers.ZoomControllerLocal")],
a.ZoomControllerLocal);const B=w.create(),z=w.fromValues(0,0,1);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/input/handlers/GamepadNavigation":function(){define("exports ../../../../core/Handles ../../../../core/reactiveUtils ../../state/controllers/CameraController ../../state/controllers/GamepadKeyboardController ../../../input/InputHandler".split(" "),function(a,b,n,k,p,h){class e extends h.InputHandler{constructor(g){super(!0);this._view=g;this._watchHandles=
new b;this._handle=this.registerIncoming("gamepad",d=>this._handleEventGamepad(d));this._handle.pause()}onInstall(g){super.onInstall(g);this._watchHandles.add([n.watch(()=>this._view.navigation.gamepad.enabled,d=>{d?this._handle.resume():(this._handle.pause(),this._cameraControllerGamepad&&(this._cameraControllerGamepad.finishController(),this._cameraControllerGamepad=null))},n.initial),n.watch(()=>this._view.navigation.gamepad.device,d=>{this._cameraControllerGamepad&&d&&this._cameraControllerGamepad.gamepadDevice!==
d&&(this._cameraControllerGamepad.finishController(),this._cameraControllerGamepad=null)})])}onUninstall(){this._watchHandles.removeAll();super.onUninstall()}_handleEventGamepad(g){var d=this._view.navigation.gamepad.device;if(!d||g.data.device===d)if((d=this._cameraControllerGamepad?.running)||p.GamepadKeyboardController.activatesFor(this._view,g.data))d||(d=new p.GamepadKeyboardController({view:this._view,gamepadDevice:g.data.device}),this._view.state.switchCameraController(d),d.state!==k.State.Rejected&&
(this._cameraControllerGamepad=d)),this._cameraControllerGamepad&&this._cameraControllerGamepad.running&&this._cameraControllerGamepad.gamepadDevice===g.data.device&&this._cameraControllerGamepad.handleEventGamepad(g.data)}}a.GamepadNavigation=e;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/controllers/GamepadKeyboardController":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/compilerUtils ../../../../core/mathUtils ../../../../core/accessorSupport/decorators/property ../../../../core/Logger ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ../../../../core/libs/gl-matrix-2/math/mat4 ../../../../core/libs/gl-matrix-2/factories/mat4f64 ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../geometry/ellipsoidUtils ../../../../geometry/support/ray ../../../../chunks/sphere ../../../../geometry/support/vector ../../../../geometry/support/vectorStacks ../../camera/constraintUtils ../../camera/constraintUtils/ConstraintOptions ../../camera/constraintUtils/ConstraintTypes ../../camera/constraintUtils/InteractionType ../../camera/constraintUtils/TiltMode ../Constraints ./InteractiveController ../utils/navigationUtils ../utils/viewUtils ../../support/cameraUtils ../../support/cameraUtilsInternal ../../webgl/RenderCamera ../../../navigation/gamepadAndKeyboardUtils".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w,x,u,t,m,q,r,v,y,B,z,A,C,H,E,F,G,D){a.GamepadKeyboardController=class extends A.InteractiveController{constructor(P){super(P);this._filteredSurfaceElevation=0;this._transformation={translation:[0,0,0],heading:0,tilt:0,zoom:0};this._keysButtonState=[0,0,0,0,0,0,0,0,0,0,0,0];this._tmpCamera=new G;this._headingStart=0;this._constraintOptions=new r.ConstraintOptions(v.ConstraintTypes.ALL,y.InteractionType.NONE,0,new G,null,B.TiltMode.LOOK_AROUND)}handleEventGamepad(P){const R=
D.extractTransformation(P,this.view.navigation.gamepad,this._transformation);("end"===P.action||D.isZeroTransformation(R))&&this.finishController()}activateDirection(P){this._keysButtonState[P]=1;D.extractTransformationKeyboard(this._keysButtonState,this._transformation)}directionActive(P){return 1===this._keysButtonState[P]}countActiveDirections(){return this._keysButtonState.reduce((P,R)=>0<R?P+1:P,0)}deactivateDirection(P){this._keysButtonState[P]=0;P=D.extractTransformationKeyboard(this._keysButtonState,
this._transformation);D.isZeroTransformation(P)&&this.finishController()}onControllerStart(P){this._filteredSurfaceElevation=this.view.pointsOfInterest.cameraOnSurface.location.z;this._headingStart=this.view.camera.heading;super.onControllerStart(P)}_updateFilteredSurfaceElevation(P){this._filteredSurfaceElevation+=(this.view.pointsOfInterest.cameraOnSurface.location.z-this._filteredSurfaceElevation)*P}stepController(P,R){this._updateStartHeading();this._updateFilteredSurfaceElevation(P);this.currentCamera.copyViewFrom(R);
this._updateCameraCenter();this._constraintOptions.interactionStartCamera?.copyFrom(this.currentCamera);this._calculateControlTransformation(P,this.currentCamera,Q);this._applyDisabledMovementTypes(Q);this._applyPan(Q.pan);this._applyRotate(Q.rotate);this._applyZoom(Q.zoom);this._applyAscend(Q.ascend);this._constraintOptions.interactionType=y.InteractionType.NONE;this._constraintOptions.selection=v.ConstraintTypes.COLLISION;q.applyAll(this.view,this.currentCamera,this._constraintOptions);super.stepController(P,
R)}_updateStartHeading(){0!==this._transformation.heading&&(this._headingStart=this.view.camera.heading)}_applyRotate(P){if(P.enabled){var R=this.currentCamera;c.subtract(O,R.center,R.eye);c.transformMat4(O,O,P.matrix);R.center=c.add(O,O,R.eye);R.up=c.transformMat4(O,R.up,P.matrix);this._constraintOptions.interactionType=y.InteractionType.LOOK_AROUND;this._constraintOptions.selection=v.ConstraintTypes.ALL_EXCEPT_COLLISION;q.applyAll(this.view,R,this._constraintOptions)}}_applyPan(P,R=this.currentCamera){P.enabled&&
(R.eye=c.transformMat4(O,R.eye,P.matrix),R.center=c.transformMat4(O,R.center,P.matrix),this.view.state.isGlobal&&(R.up=c.transformMat4(O,R.up,P.matrix)),this._constraintOptions.interactionType=y.InteractionType.PAN,this._constraintOptions.selection=v.ConstraintTypes.ALL,q.applyAll(this.view,R,this._constraintOptions))}_applyZoom(P){if(P){var R=this.currentCamera.viewForward;this.currentCamera.eye=c.add(O,this.currentCamera.eye,c.scale(m.sv3d.get(),R,P));c.copy(K,R);c.negate(K,K);this._constraintOptions.interactionDirection=
K;this._constraintOptions.interactionType=y.InteractionType.ZOOM;this._constraintOptions.selection=v.ConstraintTypes.ALL_EXCEPT_COLLISION;q.applyAll(this.view,this.currentCamera,this._constraintOptions);this._constraintOptions.interactionDirection=null}}_applyAscend(P){if(P){var R=this.view.renderCoordsHelper.worldUpAtPosition(this.currentCamera.eye,m.sv3d.get());this._constraintOptions.interactionDirection=c.copy(K,R);this.view.state.isGlobal?(R=c.length(this.currentCamera.eye),P=(R+P)/R,this.currentCamera.eye=
c.scale(O,this.currentCamera.eye,P),this.currentCamera.center=c.scale(O,this.currentCamera.center,P)):(P=c.scale(m.sv3d.get(),R,P),this.currentCamera.eye=c.add(O,this.currentCamera.eye,P),this.currentCamera.center=c.add(O,this.currentCamera.center,P));this._updateCameraCenter();this._constraintOptions.interactionType=y.InteractionType.ASCEND;this._constraintOptions.selection=v.ConstraintTypes.COLLISION;q.applyAll(this.view,this.currentCamera,this._constraintOptions)&&this._updateCameraCenter();this._constraintOptions.selection=
v.ConstraintTypes.ALL_EXCEPT_COLLISION;q.applyAll(this.view,this.currentCamera,this._constraintOptions);this._constraintOptions.interactionDirection=null}}_calculateControlTransformation(P,R,W){W.zoom=0;W.ascend=0;W.pan.enabled=!1;d.identity(W.pan.matrix);W.rotate.enabled=!1;d.identity(W.rotate.matrix);P=this._computeVelocities(P);this.view.state.isLocal?this._calculateControlTransformationLocal(P,R,W):this._calculateControlTransformationGlobal(P,R,W)}_updateCameraCenter(){this.currentCamera.center=
this.view.renderCoordsHelper.intersectManifoldClosestSilhouette(this.currentCamera.ray,this.view.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,O)}_calculateControlTransformationLocal(P,R,W){const {viewRight:V,viewForward:ba}=R,U=this._transformation;var da=this.view.navigation.gamepad,fa=c.set(m.sv3d.get(),ba[0],ba[1],0);c.normalize(fa,fa);var ha=U.translation[0]*P.pan;0!==ha&&(ha=c.scale(m.sv3d.get(),V,ha),d.translate(W.pan.matrix,W.pan.matrix,ha),W.pan.enabled=!0);switch(da.mode){case "pan":da=
-U.translation[1]*P.pan;0!==da&&(fa=c.scale(m.sv3d.get(),fa,da),d.translate(W.pan.matrix,W.pan.matrix,fa),W.pan.enabled=!0);W.zoom=U.zoom*P.zoom;break;case "zoom":W.zoom=(-U.translation[1]+U.zoom)*P.zoom;break;default:n.neverReached(da.mode)}W.ascend=U.translation[2]*P.ascend;fa=-U.heading*P.rotate;0!==fa&&(d.rotate(W.rotate.matrix,W.rotate.matrix,fa,this.view.renderCoordsHelper.worldUpAtPosition(R.eye,m.sv3d.get())),W.rotate.enabled=!0);P=U.tilt*P.rotate;R=H.viewAngle(this.view.renderCoordsHelper,
R.center,R.eye);if(R=k.clamp(R+P,z.TiltRange.min,z.TiltRange.max)-R)d.rotate(W.rotate.matrix,W.rotate.matrix,R,V),W.rotate.enabled=!0}_calculateControlTransformationGlobal(P,R,W){const {eye:V,viewRight:ba}=R,U=this._transformation;var da=this.view.navigation.gamepad,fa=c.cross(m.sv3d.get(),ba,V);c.normalize(fa,fa);c.negate(fa,fa);C.panMotionToRotationMatrix(this.startCamera,R,U,P,this.view.camera.heading,this._headingStart,this.view.camera.tilt,W,da);this._tmpCamera.copyFrom(this.currentCamera);this._applyPan(Q.pan,
this._tmpCamera);da=this.view.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude;W.ascend=U.translation[2]*P.ascend;fa=-U.heading*P.rotate;0!==fa&&(d.rotate(W.rotate.matrix,W.rotate.matrix,fa,this._tmpCamera.eye),W.rotate.enabled=!0);R=this._clampTiltDeltaGlobalToValidRange(U.tilt*P.rotate,R.ray,da);0!==R&&(d.rotate(W.rotate.matrix,W.rotate.matrix,R,this._tmpCamera.viewRight),W.rotate.enabled=!0);W.zoom+=U.zoom*P.zoom}_clampTiltDeltaGlobalToValidRange(P,R,W){const V=w.getReferenceEllipsoid(this.view.spatialReference),
ba=C.onSurfaceTiltToEyeTiltGlobal(z.TiltRange.min,R.origin,W,V);var U=0;let da=0;U=m.sv3d.get();this.view.renderCoordsHelper.intersectManifold(R,W,U)?(U=H.viewAngle(this.view.renderCoordsHelper,U,R.origin),U=C.onSurfaceTiltToEyeTiltGlobal(U,R.origin,W,V),da=C.onSurfaceTiltToEyeTiltGlobal(z.TiltRange.max,R.origin,W,V)):(u.closestPointOnSilhouette(u.fromRadius(u.tmpSphere,W+V.radius),R,U),U=Math.PI+t.angle(R.direction,U),U=C.offSurfaceTiltToEyeTiltGlobal(U,R.origin,W,V),da=C.offSurfaceTiltToEyeTiltGlobal(z.TiltRange.max,
R.origin,W,V));return k.clamp(U+P,ba,da)-U}_getPointAbsoluteSurfaceElevation(P,R,W){const {renderCoordsHelper:V}=this.view,ba=V.getAltitude(P);R+=Math.abs(ba-R);V.setAltitude(W,R,P);return R}_clampedDistanceToSurface(P,R){const {renderCoordsHelper:W}=this.view,{camera:V}=this.view.state;var {direction:ba}=E.headingTiltToDirectionUp(this.view,R,0,80,L);ba=W.intersectManifoldClosestSilhouette(x.wrap(R,ba),P,m.sv3d.get());ba=c.distance(R,ba);P=W.intersectManifoldClosestSilhouette(x.wrap(R,c.direction(m.sv3d.get(),
R,V.center)),P,m.sv3d.get());R=c.distance(R,P);return Math.min(ba,R)}_computeHeadingRotateRadius(P){const {renderCoordsHelper:R,state:W}=this.view,{camera:V,isGlobal:ba}=W;var U=R.intersectManifoldClosestSilhouette(V.ray,this._filteredSurfaceElevation,m.sv3d.get());if(ba){const da=c.subtract(m.sv3d.get(),P,U);U=c.length(da);c.scale(da,da,1/U);P=c.normalize(m.sv3d.get(),P);P=k.acosClamped(c.dot(P,da));return U*Math.sin(Math.min(J,P))}P=c.copy(m.sv3d.get(),P);R.setAltitude(P,this._filteredSurfaceElevation);
return c.distance(U,P)}_minimumAscendVelocity(){return this.view.state.constraints.collision.enabled?0:5}_computeVelocities(P){var R=this._filteredSurfaceElevation,W=R+w.getReferenceEllipsoid(this.view.spatialReference).radius;const {camera:V,isGlobal:ba}=this.view.state;var U=m.sv3d.get();const da=this._getPointAbsoluteSurfaceElevation(V.eye,R,U);var fa=this._clampedDistanceToSurface(R,U);const ha=V.width/2,T=.75*V.width,S=.75*V.width;var Z=fa*Math.tan(.5*V.fovX)/ha;W=Z/W;U=Z/this._computeHeadingRotateRadius(U);
Z=(ba?W:Z)*T*P;R=da-R;R=Math.max(this._minimumAscendVelocity()*P,2**(T*P/ha)*R-R);fa=2**(T*P/ha)*fa-fa;P*=k.clamp(U*S,N,M);return{pan:Z,ascend:R,zoom:fa,rotate:P}}_applyDisabledMovementTypes(P){null==this.disableMovements||void 0!==this.disableMovements.mode&&this.view.state.viewingMode!==this.disableMovements.mode||(P.zoom=this.disableMovements.zoom?0:P.zoom,P.ascend=this.disableMovements.ascend?0:P.ascend,P.pan.enabled=!this.disableMovements.pan,this.disableMovements.pan&&d.identity(P.pan.matrix),
P.rotate.enabled=!this.disableMovements.rotate,this.disableMovements.rotate&&d.identity(P.rotate.matrix))}static activatesFor(P,R){P=D.extractTransformation(R,P.navigation.gamepad,I);return!("end"===R.action||D.isZeroTransformation(P))}};b.__decorate([p.property({constructOnly:!0})],a.GamepadKeyboardController.prototype,"gamepadDevice",void 0);b.__decorate([p.property({constructOnly:!0})],a.GamepadKeyboardController.prototype,"disableMovements",void 0);a.GamepadKeyboardController=b.__decorate([g.subclass("esri.views.3d.state.controllers.GamepadKeyboardController")],
a.GamepadKeyboardController);const I={translation:[0,0,0],heading:0,tilt:0,zoom:0},J=k.deg2rad(80),N=k.deg2rad(30),M=k.deg2rad(80),Q={zoom:0,ascend:0,pan:{enabled:!1,matrix:f.create()},rotate:{enabled:!1,matrix:f.create()}},O=l.create(),K=l.create(),L=F.createDirectionUp();Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/navigation/gamepadAndKeyboardUtils":function(){define(["exports","../../chunks/vec32"],function(a,b){function n(k){let p=k*k;0>k&&(p*=-1);return p}a.extractTransformation=
function(k,p,h){const e=k.state;k=k.device;p="forward-down"===p.tiltDirection?1:-1;"standard"===k.deviceType?(h.translation[0]=n(e.axes[0]),h.translation[1]=n(e.axes[1]),h.translation[2]=n(e.buttons[7])-n(e.buttons[6]),h.heading=n(e.axes[2]),h.tilt=n(e.axes[3])):"spacemouse"===k.deviceType&&(h.translation[0]=1.2*n(e.axes[0]),h.translation[1]=1.2*n(e.axes[1]),h.translation[2]=2*-n(e.axes[2]),h.heading=1.2*n(e.axes[5]),h.tilt=1.2*n(e.axes[3]));h.tilt*=p;b.scale(h.translation,h.translation,1);return h};
a.extractTransformationKeyboard=function(k,p){p.translation[0]=k[1]-k[0];p.translation[1]=k[3]-k[2];p.translation[2]=k[4]-k[5];p.heading=k[7]-k[6];p.tilt=k[8]-k[9];p.zoom=k[10]-k[11];return p};a.isZeroTransformation=function(k){return 0===k.translation[0]&&0===k.translation[1]&&0===k.translation[2]&&0===k.heading&&0===k.tilt&&0===k.zoom};a.resetTransformation=function(k){k.translation[0]=0;k.translation[1]=0;k.translation[2]=0;k.heading=0;k.tilt=0;return k};Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/views/3d/input/handlers/KeyboardNavigation":function(){define(["exports","../../../ViewingMode","../../state/controllers/GamepadKeyboardController","../../../input/InputHandler","../../../input/VisibilityChange"],function(a,b,n,k,p){var h;(function(g){g[g.LEFT=0]="LEFT";g[g.RIGHT=1]="RIGHT";g[g.FORWARD=2]="FORWARD";g[g.BACKWARD=3]="BACKWARD";g[g.UP=4]="UP";g[g.DOWN=5]="DOWN";g[g.HEADINGLEFT=6]="HEADINGLEFT";g[g.HEADINGRIGHT=7]="HEADINGRIGHT";g[g.TILTUP=8]="TILTUP";g[g.TILTDOWN=
9]="TILTDOWN";g[g.ZOOMIN=10]="ZOOMIN";g[g.ZOOMOUT=11]="ZOOMOUT"})(h||={});class e extends k.InputHandler{constructor(g,d){super(!0);this._view=g;this._disableMovements={pan:!0,zoom:!1,ascend:!0,rotate:!1,mode:b.ViewingMode.Local};this._stickyKeyTimeoutHandle=void 0;this._stickyKeyDuration=200;this._keyToNumber={[d.left]:h.LEFT,[d.right]:h.RIGHT,[d.forward]:h.FORWARD,[d.backward]:h.BACKWARD,[d.up]:h.UP,[d.down]:h.DOWN,[d.headingLeft]:h.HEADINGLEFT,[d.headingRight]:h.HEADINGRIGHT,[d.tiltUp]:h.TILTUP,
[d.tiltDown]:h.TILTDOWN,[d.zoomIn]:h.ZOOMIN,[d.zoomOut]:h.ZOOMOUT};this.registerIncoming("key-down",null,f=>this._handleKeyDown(f));this.registerIncoming("key-up",null,f=>this._handleKeyUp(f));this.registerIncoming("blur",null,()=>this._handleStop());this._visibilityHandle=p.onVisibilityChange(f=>f?null:this._handleStop())}onUninstall(){this._visibilityHandle?.remove();this._handleStop()}setStickyKeyDuration(g){this._stickyKeyDuration=g}_handleKeyDown(g){if(!g.data.native.ctrlKey&&!g.data.native.metaKey){var d=
this._keyToNumber[g.data.key];null!=d&&(this._cameraControllerKeyboard&&this._cameraControllerKeyboard.running||(this._cameraControllerKeyboard=new n.GamepadKeyboardController({view:this._view,disableMovements:this._disableMovements}),this._view.state.switchCameraController(this._cameraControllerKeyboard)),this._cameraControllerKeyboard.running&&(g.stopPropagation(),this._cameraControllerKeyboard.directionActive(d)||(this._cameraControllerKeyboard.activateDirection(d),!(1<this._cameraControllerKeyboard.countActiveDirections())&&
this._isPanning(d)&&0<this._stickyKeyDuration&&(this._stickyKeyTimeoutHandle=setTimeout(()=>{this._stickyKeyTimeoutHandle=void 0;null!=this._stickyDirection&&void 0!==this._stickyDirection&&(this._cameraControllerKeyboard?.deactivateDirection(this._stickyDirection),this._stickyDirection=void 0)},this._stickyKeyDuration)))))}}_handleStop(){this._cameraControllerKeyboard?.running&&(this._cameraControllerKeyboard.finishController(),this._cameraControllerKeyboard=null)}_handleKeyUp(g){if(!g.data.native.ctrlKey&&
!g.data.native.metaKey){var d=this._keyToNumber[g.data.key];null!=d&&this._cameraControllerKeyboard?.running&&(g.stopPropagation(),g=void 0===this._stickyKeyTimeoutHandle,void 0!==this._stickyKeyTimeoutHandle&&1===this._cameraControllerKeyboard?.countActiveDirections()?this._stickyDirection=d:(this._cameraControllerKeyboard?.deactivateDirection(d),g&&(this._stickyDirection=void 0)))}}_isPanning(g){return 3>=g}}a.KeyboardNavigation=e;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/input/VisibilityChange":function(){define(["exports","../../core/handleUtils"],function(a,b){a.onVisibilityChange=function(n){const k=()=>n("visible"===document.visibilityState);document.addEventListener("visibilitychange",k);return b.makeHandle(()=>document.removeEventListener("visibilitychange",k))};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/input/handlers/MouseWheelZoom":function(){define("exports ../../../../core/screenUtils ../../state/controllers/CameraController ../../state/controllers/FovController ../../state/controllers/ZoomStepControllerGlobal ../../state/controllers/ZoomStepControllerLocal ../../../input/InputHandler".split(" "),
function(a,b,n,k,p,h,e){class g extends e.InputHandler{constructor(d,f){super(!0);this._view=d;this.registerIncoming("mouse-wheel",[f],c=>this._handleFov(c));this.registerIncoming("mouse-wheel",c=>this._handleZoom(c))}_handleZoom(d){if(this._view.navigation.mouseWheelZoomEnabled){var f=d.data;this._zoomController?.running||(this._stopFovController(),this._zoomController=this._view.state.isGlobal?new p.ZoomStepControllerGlobal({view:this._view,mode:"interaction"}):new h.ZoomStepControllerLocal({view:this._view,
mode:"interaction"}),this._view.state.switchCameraController(this._zoomController));this._zoomController.step(-f.deltaY/60,b.createScreenPointArray(f.x,f.y));d.preventDefault();d.stopPropagation()}}_handleFov(d){if(this._view.navigation.mouseWheelZoomEnabled){if(!this._fovController?.running&&(this._zoomController?.finish(),this._fovController?.hideOverlay(),this._fovController=new k.FovController({view:this._view,onStop:()=>this._stopFovController()}),this._view.state.switchCameraController(this._fovController),
this._fovController.state===n.State.Rejected)){this._stopFovController();return}this._fovController.updateTimeout();this._fovController.step(d.data.deltaY/20);d.preventDefault();d.stopPropagation()}}_stopFovController(){this._fovController?.finish();this._fovController=null}}a.MouseWheelZoom=g;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/input/handlers/PinchAndPanNavigation":function(){define(["exports","../../state/controllers/PinchAndPanControllerGlobal","../../state/controllers/PinchAndPanControllerLocal",
"../../../input/InputHandler","../../../input/handlers/support"],function(a,b,n,k,p){class h extends k.InputHandler{constructor(e,g,d){super(!0);this._view=e;this.pointerAction=g;this._lastTimestamp=this._lastEndTimestamp=0;this.registerIncoming("drag",d,f=>this._handleDrag(f))}_handleDrag(e){if("mouse"!==e.data.pointerType||p.eventMatchesMousePointerAction(e.data,this.pointerAction)){var g=e.timestamp-this._lastEndTimestamp;g=this._momentum&&this._momentum.running&&40>g;switch(e.data.action){case "start":case "update":if(g)break;
this._controller&&this._controller.running?2<e.data.timestamp-this._lastTimestamp&&(this._controller.update(e.data),this._lastTimestamp=e.timestamp):this._startController(e);break;case "end":case "removed":this._endController(e,!0);break;case "added":this._endController(e,!1),this._startController(e)}e.stopPropagation()}}_endController(e,g){this._controller?.running&&(this._lastEndTimestamp=e.timestamp,e=this._controller.end(e.data),g&&e&&(this._momentum=e,this._view.state.switchCameraController(this._momentum)));
this._controller=null}_startController(e){this._controller=this._createController();this._view.state.switchCameraController(this._controller);this._controller.begin(e.data);this._lastTimestamp=e.timestamp}_createController(){return this._view.state.isGlobal?new b.PinchAndPanControllerGlobal({view:this._view}):new n.PinchAndPanControllerLocal({view:this._view})}}a.PinchAndPanNavigation=h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/controllers/PinchAndPanControllerGlobal":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/Cyclical ../../../../core/mathUtils ../../../../core/screenUtils ../../../../core/Logger ../../../../core/has ../../../../core/RandomLCG ../../../../core/Error ../../../../core/accessorSupport/decorators/subclass ../../../../core/libs/gl-matrix-2/math/vec2 ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../geometry/ellipsoidUtils ../../../../geometry/support/axisAngle ../../../../geometry/support/plane ../../../../chunks/sphere ../../camera/constraintUtils ../../camera/constraintUtils/ConstraintOptions ../../camera/constraintUtils/ConstraintTypes ../../camera/constraintUtils/InteractionType ../../input/util ./InteractiveController ./momentum/PanPlanarMomentumController ./momentum/PanSphericalMomentumController ./momentum/RotationMomentumController ./momentum/ZoomPlanarMomentumController ./momentum/ZoomSphericalMomentumController ../utils/navigationUtils ../../webgl/RenderCamera ../../../navigation/PanPlanarMomentumEstimator ../../../navigation/PanSphericalMomentumEstimator ../../../navigation/RotationMomentumEstimator ../../../navigation/ZoomMomentumEstimator".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w,x,u,t,m,q,r,v,y,B,z,A,C,H,E,F,G,D,I,J,N,M){a.PinchAndPanControllerGlobal=class extends z.InteractiveController{constructor(){super(...arguments);this._smoothRotation=new B.ExponentialFalloff(.05);this._rotationAxis=w.create();this._beginHeading=this._beginAngle=0;this._panningPlane=t.create();this._beginRadius=0;this._smoothScaling=new B.ExponentialFalloff(.05);this._zoomCenterScreen=p.createScreenPointArray();this._zoomMomentumEstimator=new M.ZoomMomentumEstimator;
this._rotationMomentumEstimator=new N.RotationMomentumEstimator;this._panSphericalMomentumEstimator=new J.PanSphericalMomentumEstimator;this._panPlanarMomentumEstimator=new I.PanPlanarMomentumEstimator;this._adjustedSphere=m.create();this._tmp3d=w.create();this._tmpScreenPointArray=p.createScreenPointArray();this._beginScreenPoint=p.createScreenPointArray();this._beginScenePoint=w.create();this._screenPickPoint=p.createScreenPointArray();this._scenePickPoint=w.create();this._navMode=G.NavigationMode.Horizontal;
this._sphere=m.create();this._pointerCount=0;this._tmpInteractionDirection=w.create();this._beginCamera=new D;this._constraintOptions=new r.ConstraintOptions(v.ConstraintTypes.ALL,y.InteractionType.NONE,0,this._beginCamera)}get _intersectionHelper(){return this.view.sceneIntersectionHelper}begin(Q){if(this.running){this._zoomMomentumEstimator.enabled=this._rotationMomentumEstimator.enabled=this._panPlanarMomentumEstimator.enabled=this._panSphericalMomentumEstimator.enabled=this.view.navigation.momentumEnabled;
this._beginHeading=-n.cyclicalPI.normalize(k.deg2rad(this.view.camera.heading));this._beginRadius=Q.radius;this._pointerCount=Q.pointers.size;this._beginAngle=Q.angle;this._smoothRotation.reset();p.screenPointObjectToArray(Q.center,this._screenPickPoint);c.copy(this._beginScreenPoint,this._screenPickPoint);var O=x.getReferenceEllipsoid(this.view.spatialReference);O=G.pickPointAndInitSphere(this._intersectionHelper,this.startCamera,this._screenPickPoint,O,G.SpherePickPointFallback.Silhouette,0===this.view.map.ground.opacity?
G.contentIntersectorOptions:{});null!=O.scenePickPoint&&(this._scenePickPoint=O.scenePickPoint,this._sphere=O.sphere,l.copy(this._beginScenePoint,this._scenePickPoint),this._navMode=G.navigationMode(this.startCamera,this._screenPickPoint,this.view.renderCoordsHelper,this.view.viewingMode),this._navMode===G.NavigationMode.Vertical&&this._preparePlanarPanMode(Q,O.hasGeometryIntersection),this._beginCamera.copyFrom(this.startCamera))}}update(Q){if(this.running){this.currentCamera.copyFrom(this.startCamera);
var O=1<Q.pointers.size;this._navMode===G.NavigationMode.Horizontal?(O&&this._zoomSpherical(Q),this._panningSpherical(Q),O&&this._rotateSpherical(Q)):(O&&this._zoomPlanar(Q),this._panningPlanar(Q),O&&this._rotatePlanar(Q));this.commitCamera()}}end(Q){Q.pointers.size===this._pointerCount&&this.update(Q);this.finishController();if(Q=this._zoomMomentumEstimator.evaluateMomentum())return this._navMode===G.NavigationMode.Horizontal?new F.ZoomSphericalMomentumController({view:this.view,momentum:Q,screenCenter:this._zoomCenterScreen,
sceneCenter:this._beginScenePoint,radius:this._sphere[3]}):new E.ZoomPlanarMomentumController({view:this.view,momentum:Q,zoomCenter:this._beginScenePoint});if(Q=this._rotationMomentumEstimator.evaluateMomentum())return new H.RotationMomentumController({view:this.view,momentum:Q,center:m.getCenter(this._sphere),axis:this._rotationAxis});if(this._navMode===G.NavigationMode.Horizontal){if(Q=this._panSphericalMomentumEstimator.evaluateMomentum())return new C.PanSphericalMomentumController({view:this.view,
momentum:Q})}else if(Q=this._panPlanarMomentumEstimator.evaluateMomentum())return new A.PanPlanarMomentumController({view:this.view,momentum:Q});return null}_preparePlanarPanMode(Q,O){var K=l.negate(this._tmp3d,this.startCamera.viewForward);t.fromPositionAndNormal(this._scenePickPoint,K,this._panningPlane);var L=p.createScreenPointArray(this._screenPickPoint[0],0);K=w.create();var P=l.length(this.startCamera.eye);this._adjustedSphere[3]=P<this._sphere[3]?P-100:this._sphere[3];G.sphereOrPlanePointFromScreenPoint(this._adjustedSphere,
this.startCamera,L,K);L=p.createRenderScreenPointArray3();this.startCamera.projectToRenderScreen(K,L);K=w.create();L=w.create();P=w.create();l.subtract(K,this._scenePickPoint,this.currentCamera.eye);const R=l.length(K);l.normalize(K,K);var W=G.panDistanceModifier*Math.max(Math.abs(this.view.camera.position.z),G.minHeightLimit);const V=this.view._stage.renderView.getMinimalDepthForArea(null,this._screenPickPoint[0],this._screenPickPoint[1],this.view.state.camera,G.screenPixelArea);W=null!=V?V:W;W=
O?Math.min(W,R):W;l.copy(P,l.add(L,this.currentCamera.eye,l.scale(L,K,W)));this._panningPlane[3]=-l.dot(t.getNormal(this._panningPlane),P);this.startCamera.center=l.add(L,this.startCamera.eye,l.scale(L,this.startCamera.viewForward,W));Q=p.screenPointObjectToArray(Q.center,this._tmpScreenPointArray);G.intersectPlaneFromScreenPointAtEye(this._panningPlane,this.startCamera,Q,this._beginScenePoint)}_zoomSpherical(Q){const O=this._beginRadius/Q.radius;this._smoothScaling.gain=.001875*Math.min(Math.max(Q.radius,
40),120);this._smoothScaling.update(O);G.applyZoomOnSphere(this._sphere,this.currentCamera,this._smoothScaling.value);p.screenPointObjectToArray(Q.center,this._zoomCenterScreen);this._zoomMomentumEstimator.add(this._smoothScaling.value,.001*Q.timestamp);this._constraintOptions.interactionType=y.InteractionType.ZOOM;this._constraintOptions.interactionFactor=q.pixelDistanceToInteractionFactor(Q.radius-this._beginRadius);q.applyAll(this.view,this.currentCamera,this._constraintOptions)}_panningSpherical(Q){const O=
p.screenPointObjectToArray(Q.center,this._tmpScreenPointArray);G.sphereOrPlanePointFromScreenPoint(this._sphere,this.currentCamera,O,this._tmp3d);G.preserveHeadingThreshold(this._beginScenePoint,l.dot(this.currentCamera.up,this._beginScenePoint),this._sphere[3],this._beginHeading,this.view.camera.tilt,this.startCamera)?(G.applyPanSphericalPreserveHeading(this._sphere,this.currentCamera,this._beginScenePoint,this._tmp3d,this._beginHeading,this.view.camera.tilt,!1),this._panSphericalMomentumEstimator.addMomentumPreserveHeading(O,
this._tmp3d,.001*Q.timestamp,this.startCamera,this._sphere,this._beginHeading,this.view.camera.tilt)):(G.applyPanSphericalDirectRotation(this._sphere,this.currentCamera,this._beginScenePoint,this._tmp3d,this.view.camera.tilt,!1),this._panSphericalMomentumEstimator.addMomentumDirectRotation(O,this._tmp3d,.001*Q.timestamp,this.startCamera,this._sphere[3],this.view.camera.tilt));this._constraintOptions.interactionType=y.InteractionType.PAN;this._constraintOptions.interactionFactor=q.pixelDistanceToInteractionFactor(c.distance(this._screenPickPoint,
O));q.applyAll(this.view,this.currentCamera,this._constraintOptions)}_rotateSpherical(Q){l.normalize(this._rotationAxis,this._scenePickPoint);this.currentCamera.aboveGround||l.negate(this._rotationAxis,this._rotationAxis);var O=this._smoothRotation.value,K=G.normalizeRotationDelta(Q.angle-O);O+=K;this._smoothRotation.gain=.00125*Math.min(Math.max(Q.radius,40),120);this._smoothRotation.update(O);K=this._smoothRotation.value-this._beginAngle;this._rotationMomentumEstimator.add(K,.001*Q.timestamp);G.applyRotation(this.currentCamera,
m.getCenter(this._sphere),u.wrapAxisAngle(this._rotationAxis,K));this._constraintOptions.interactionType=y.InteractionType.TUMBLE;this._constraintOptions.interactionFactor=q.pixelDistanceToInteractionFactor(Q.radius*O);q.applyAll(this.view,this.currentCamera,this._constraintOptions)}_panningPlanar(Q){const O=p.screenPointObjectToArray(Q.center,this._tmpScreenPointArray);G.intersectPlaneFromScreenPointAtEye(this._panningPlane,this.currentCamera,O,this._tmp3d)&&(G.applyPanPlanar(this.currentCamera,
this._beginScenePoint,this._tmp3d),this._panPlanarMomentumEstimator.add(O,this._tmp3d,.001*Q.timestamp),this._constraintOptions.interactionType=y.InteractionType.PAN,this._constraintOptions.interactionFactor=q.pixelDistanceToInteractionFactor(c.distance(this._beginScreenPoint,O)),this._constraintOptions.interactionDirection=this.view.renderCoordsHelper.worldUpAtPosition(this.currentCamera.eye,this._tmpInteractionDirection),q.applyAll(this.view,this.currentCamera,this._constraintOptions),this._constraintOptions.interactionDirection=
null)}_zoomPlanar(Q){const O=this._beginRadius/Q.radius;this._smoothScaling.gain=.001875*Math.min(Math.max(Q.radius,40),120);this._smoothScaling.update(O);this._zoomMomentumEstimator.add(this._smoothScaling.value,.001*Q.timestamp);G.applyZoomToPoint(this.currentCamera,this._beginScenePoint,this._smoothScaling.value,this.view.state.constraints.minimumPoiDistance);this._constraintOptions.interactionType=y.InteractionType.ZOOM;this._constraintOptions.interactionFactor=q.pixelDistanceToInteractionFactor(Q.radius-
this._beginRadius);q.applyAll(this.view,this.currentCamera,this._constraintOptions)}_rotatePlanar(Q){l.copy(this._rotationAxis,this._beginScenePoint);this.currentCamera.aboveGround||l.negate(this._rotationAxis,this._rotationAxis);var O=this._smoothRotation.value;let K=Q.angle-O;K=G.normalizeRotationDelta(K);this._smoothRotation.gain=.00125*Math.min(Math.max(Q.radius,40),120);this._smoothRotation.update(O+K);O=this._smoothRotation.value-this._beginAngle;this._rotationMomentumEstimator.add(O,.001*Q.timestamp);
G.applyRotation(this.currentCamera,m.getCenter(this._sphere),u.wrapAxisAngle(this._rotationAxis,O));this._constraintOptions.interactionType=y.InteractionType.TUMBLE;this._constraintOptions.interactionFactor=q.pixelDistanceToInteractionFactor(Q.radius*O);q.applyAll(this.view,this.currentCamera,this._constraintOptions)}};a.PinchAndPanControllerGlobal=b.__decorate([f.subclass("esri.views.3d.state.controllers.PinchAndPanControllerGlobal")],a.PinchAndPanControllerGlobal);Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/views/3d/input/util":function(){define(["exports"],function(a){class b{constructor(n){this._gain=n}reset(n){this._value=n}set gain(n){this._gain=n}get value(){return void 0===this._value?0:this._value}update(n){this._value=void 0===this._value?n:this._gain*n+(1-this._gain)*this._value}}a.ExponentialFalloff=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/controllers/momentum/PanPlanarMomentumController":function(){define("exports ../../../../../chunks/tslib.es6 ../../../../../core/accessorSupport/decorators/property ../../../../../core/has ../../../../../core/Logger ../../../../../core/RandomLCG ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/vec32 ../../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../camera/constraintUtils/InteractionType ./MomentumController".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c){a.PanPlanarMomentumController=class extends c.MomentumController{constructor(w){super(w);this.interactionType=f.InteractionType.PAN;this._tmpPan=d.create()}momentumStep(w,x){w=this.momentum.value(w);g.scale(this._tmpPan,this.momentum.direction,w);x.eye=g.subtract(l,x.eye,this._tmpPan);x.center=g.subtract(l,x.center,this._tmpPan);this.constraintOptions.interactionDirection=this._tmpPan}};b.__decorate([n.property({constructOnly:!0})],a.PanPlanarMomentumController.prototype,
"momentum",void 0);a.PanPlanarMomentumController=b.__decorate([e.subclass("esri.views.3d.state.controllers.momentum.PanPlanarMomentumController")],a.PanPlanarMomentumController);const l=d.create();Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/controllers/momentum/MomentumController":function(){define("exports ../../../../../chunks/tslib.es6 ../../../../../core/Logger ../../../../../core/has ../../../../../core/RandomLCG ../../../../../core/Error ../../../../../core/accessorSupport/decorators/subclass ../../../../ViewAnimation ../../../camera/constraintUtils ../../../camera/constraintUtils/ConstraintOptions ../../../camera/constraintUtils/ConstraintTypes ../../../camera/constraintUtils/InteractionType ../AnimationController ../../../webgl/RenderCamera".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w,x){a.MomentumController=class extends w.AnimationController{constructor(){super(...arguments);this._beginCamera=new x;this._elapsedTimeSec=0;this.constraintOptions=new f.ConstraintOptions(c.ConstraintTypes.ALL,l.InteractionType.PAN,0,this._beginCamera)}initialize(){this.constraintOptions.interactionType=this.interactionType;this.viewAnimation=new g}get steppingFinished(){return this.momentum.isFinished(this._elapsedTimeSec)}onControllerStart(u){this._beginCamera.copyFrom(u);
super.onControllerStart(u)}stepController(u,t){t.copyViewFrom(this._beginCamera);this._elapsedTimeSec+=u;this.momentumStep(this._elapsedTimeSec,t);d.applyAll(this.view,t,this.constraintOptions)}};a.MomentumController=b.__decorate([e.subclass("esri.views.3d.state.controllers.momentum.MomentumController")],a.MomentumController);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/controllers/momentum/PanSphericalMomentumController":function(){define("exports ../../../../../chunks/tslib.es6 ../../../../../core/accessorSupport/decorators/property ../../../../../core/has ../../../../../core/Logger ../../../../../core/RandomLCG ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/vec32 ../../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../camera/constraintUtils/InteractionType ./MomentumController ../../utils/navigationUtils".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l){const w=d.create(),x=d.create();a.PanSphericalMomentumController=class extends c.MomentumController{constructor(u){super(u);this.interactionType=f.InteractionType.PAN}momentumStep(u,t){const m=this.momentum.value1(u);u=this.momentum.value2(u);g.copy(x,t.eye);g.normalize(x,x);g.cross(this.momentum.axis2,x,this.momentum.axis1);l.applyRotationWithTwoAxes(t,w,this.momentum.axis1,m,this.momentum.axis2,u)}};b.__decorate([n.property({constructOnly:!0})],a.PanSphericalMomentumController.prototype,
"momentum",void 0);a.PanSphericalMomentumController=b.__decorate([e.subclass("esri.views.3d.state.controllers.momentum.PanSphericalMomentumController")],a.PanSphericalMomentumController);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/controllers/momentum/RotationMomentumController":function(){define("exports ../../../../../chunks/tslib.es6 ../../../../../core/accessorSupport/decorators/property ../../../../../core/has ../../../../../core/Logger ../../../../../core/RandomLCG ../../../../../core/accessorSupport/decorators/subclass ../../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../../geometry/support/axisAngle ../../../camera/constraintUtils/InteractionType ./MomentumController ../../utils/navigationUtils".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l){a.RotationMomentumController=class extends c.MomentumController{set center(w){this._set("center",g.clone(w))}set axis(w){this._set("axis",g.clone(w))}constructor(w){super(w);this.interactionType=f.InteractionType.TUMBLE}momentumStep(w,x){w=this.momentum.value(w);l.applyRotation(x,this.center,d.wrapAxisAngle(this.axis,w))}};b.__decorate([n.property({constructOnly:!0})],a.RotationMomentumController.prototype,"momentum",void 0);b.__decorate([n.property({constructOnly:!0})],
a.RotationMomentumController.prototype,"center",null);b.__decorate([n.property({constructOnly:!0})],a.RotationMomentumController.prototype,"axis",null);a.RotationMomentumController=b.__decorate([e.subclass("esri.views.3d.state.controllers.momentum.RotationMomentumController")],a.RotationMomentumController);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/controllers/momentum/ZoomPlanarMomentumController":function(){define("exports ../../../../../chunks/tslib.es6 ../../../../../core/accessorSupport/decorators/property ../../../../../core/has ../../../../../core/Logger ../../../../../core/RandomLCG ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/vec32 ../../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../camera/constraintUtils/InteractionType ./MomentumController ../../utils/navigationUtils".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l){a.ZoomPlanarMomentumController=class extends c.MomentumController{set zoomCenter(w){this._set("zoomCenter",d.clone(w))}constructor(w){super(w);this.interactionType=f.InteractionType.ZOOM;this.constraintOptions.interactionDirection=d.create()}momentumStep(w,x){const {interactionDirection:u}=this.constraintOptions;u&&(g.copy(u,x.eye),w=this.momentum.valueDelta(0,w),l.applyZoomToPoint(x,this.zoomCenter,w,this.view.state.constraints.minimumPoiDistance),g.direction(u,
x.eye,u))}};b.__decorate([n.property({constructOnly:!0})],a.ZoomPlanarMomentumController.prototype,"momentum",void 0);b.__decorate([n.property({constructOnly:!0})],a.ZoomPlanarMomentumController.prototype,"zoomCenter",null);a.ZoomPlanarMomentumController=b.__decorate([e.subclass("esri.views.3d.state.controllers.momentum.ZoomPlanarMomentumController")],a.ZoomPlanarMomentumController);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/controllers/momentum/ZoomSphericalMomentumController":function(){define("exports ../../../../../chunks/tslib.es6 ../../../../../core/screenUtils ../../../../../core/accessorSupport/decorators/property ../../../../../core/has ../../../../../core/Logger ../../../../../core/RandomLCG ../../../../../core/accessorSupport/decorators/subclass ../../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../../geometry/support/axisAngle ../../../../../chunks/sphere ../../../camera/constraintUtils ../../../camera/constraintUtils/InteractionType ./MomentumController ../../utils/navigationUtils".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w,x,u){a.ZoomSphericalMomentumController=class extends x.MomentumController{set screenCenter(t){this._set("screenCenter",n.createScreenPointArray(t[0],t[1]))}set sceneCenter(t){this._set("sceneCenter",d.clone(t))}constructor(t){super(t);this.interactionType=w.InteractionType.ZOOM;this.radius=0;this._tmpSceneCenter=d.create();this._tmpZoomAxisAngle=f.create();this._sphere=c.create()}initialize(){this._sphere[3]=this.radius}momentumStep(t,m){t=this.momentum.valueDelta(0,
t);u.applyZoomOnSphere(this._sphere,m,t);this.constraintOptions.interactionType=w.InteractionType.ZOOM;l.applyAll(this.view,m,this.constraintOptions);u.sphereOrPlanePointFromScreenPoint(this._sphere,m,this.screenCenter,this._tmpSceneCenter);f.fromPoints(this.sceneCenter,this._tmpSceneCenter,this._tmpZoomAxisAngle);u.applyRotation(m,c.getCenter(this._sphere),this._tmpZoomAxisAngle);this.constraintOptions.interactionType=w.InteractionType.PAN}};b.__decorate([k.property({constructOnly:!0})],a.ZoomSphericalMomentumController.prototype,
"momentum",void 0);b.__decorate([k.property({constructOnly:!0})],a.ZoomSphericalMomentumController.prototype,"screenCenter",null);b.__decorate([k.property({constructOnly:!0})],a.ZoomSphericalMomentumController.prototype,"sceneCenter",null);b.__decorate([k.property({constructOnly:!0})],a.ZoomSphericalMomentumController.prototype,"radius",void 0);a.ZoomSphericalMomentumController=b.__decorate([g.subclass("esri.views.3d.state.controllers.momentum.ZoomSphericalMomentumController")],a.ZoomSphericalMomentumController);
Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/navigation/PanPlanarMomentumEstimator":function(){define(["exports","../../chunks/vec32","../../core/libs/gl-matrix-2/factories/vec3f64","./FilteredFiniteDifference","./Momentum"],function(a,b,n,k,p){class h extends p.Momentum{constructor(g,d,f,c,l){super(g,d,f);this._sceneVelocity=c;this.direction=l}value(g){return super.valueFromInitialVelocity(this._sceneVelocity,g)}}class e{constructor(g=300,d=12,f=.84){this._minimumInitialVelocity=
g;this._stopVelocity=d;this._friction=f;this.enabled=!0;this._time=new k.FilteredFiniteDifference(.6);this._screen=[new k.FilteredFiniteDifference(.4),new k.FilteredFiniteDifference(.4)];this._scene=[new k.FilteredFiniteDifference(.6),new k.FilteredFiniteDifference(.6),new k.FilteredFiniteDifference(.6)];this._tmpDirection=n.create()}add(g,d,f){!this.enabled||this._time.hasLastValue()&&.015>this._time.computeDelta(f)||(this._screen[0].update(g[0]),this._screen[1].update(g[1]),this._scene[0].update(d[0]),
this._scene[1].update(d[1]),this._scene[2].update(d[2]),this._time.update(f))}reset(){this._screen[0].reset();this._screen[1].reset();this._scene[0].reset();this._scene[1].reset();this._scene[2].reset();this._time.reset()}evaluateMomentum(){if(!this.enabled||!this._screen[0].hasFilteredDelta()||!this._time.hasFilteredDelta())return null;var g=this._screen[0].filteredDelta,d=this._screen[1].filteredDelta;g=null==g||null==d?0:Math.sqrt(g*g+d*d);d=this._time.filteredDelta;g=null==d||null==g?0:g/d;return Math.abs(g)<
this._minimumInitialVelocity?null:this.createMomentum(g,this._stopVelocity,this._friction)}createMomentum(g,d,f){b.set(this._tmpDirection,this._scene[0].filteredDelta??0,this._scene[1].filteredDelta??0,this._scene[2].filteredDelta??0);const c=b.length(this._tmpDirection);0<c&&b.scale(this._tmpDirection,this._tmpDirection,1/c);const l=this._time.filteredDelta;return new h(g,d,f,null==l?0:c/l,this._tmpDirection)}}a.PanPlanarMomentum=h;a.PanPlanarMomentumEstimator=e;Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/views/navigation/FilteredFiniteDifference":function(){define(["exports"],function(a){class b{constructor(n){this._gain=n;this.filteredDelta=this.lastValue=void 0}update(n){if(this.hasLastValue()){const k=this.computeDelta(n);this._updateDelta(k)}this.lastValue=n}reset(){this.filteredDelta=this.lastValue=void 0}hasLastValue(){return void 0!==this.lastValue}hasFilteredDelta(){return void 0!==this.filteredDelta}computeDelta(n){return void 0===this.lastValue?NaN:n-this.lastValue}_updateDelta(n){this.filteredDelta=
void 0!==this.filteredDelta?(1-this._gain)*this.filteredDelta+this._gain*n:n}}a.FilteredFiniteDifference=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/navigation/Momentum":function(){define(["exports"],function(a){class b{constructor(n,k,p){this._initialVelocity=n;this._stopVelocity=k;this._friction=p;this._duration=Math.abs(Math.log(Math.abs(this._initialVelocity)/this._stopVelocity)/Math.log(1-this._friction))}get duration(){return this._duration}isFinished(n){return n>
this.duration}get friction(){return this._friction}value(n){return this.valueFromInitialVelocity(this._initialVelocity,n)}valueDelta(n,k){const p=this.value(n);return this.value(n+k)-p}valueFromInitialVelocity(n,k){k=Math.min(k,this.duration);const p=1-this.friction;return n*(p**k-1)/Math.log(p)}}a.Momentum=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/navigation/PanSphericalMomentumEstimator":function(){define("exports ../../core/libs/gl-matrix-2/factories/vec2f64 ../../chunks/vec32 ../../core/libs/gl-matrix-2/factories/vec3f64 ../3d/state/utils/navigationUtils ./FilteredFiniteDifference ./FilteredValue ./Momentum".split(" "),
function(a,b,n,k,p,h,e,g){class d extends g.Momentum{constructor(c,l,w,x,u,t=0,m){super(c,l,w);this._angularVelocity1=x;this.axis1=u;this.angularVelocity2=t;this.axis2=m}value1(c){return super.valueFromInitialVelocity(this._angularVelocity1,c)}value2(c){return super.valueFromInitialVelocity(this.angularVelocity2,c)}}class f{constructor(c=300,l=12,w=.84){this._minimumInitialVelocity=c;this._stopVelocity=l;this._friction=w;this.enabled=!0;this._tmpAxis1=k.create();this._tmpAxis2=k.create();this._tmpAngles=
b.create();this._time=new h.FilteredFiniteDifference(.3);this._screen=[new h.FilteredFiniteDifference(.4),new h.FilteredFiniteDifference(.4)];this._angle1=new e.FilteredValue(.6);this._angle2=new e.FilteredValue(.6);this._axis1=k.create();this._axis2=k.create();this._lastScene=k.create()}addMomentumDirectRotation(c,l,w,x,u,t){if(this.enabled){if(this._time.hasLastValue()){if(.01>this._time.computeDelta(w))return;x=p.rotationAngleAndAxisDirectRotation(this._lastScene,l,this._tmpAxis2,x,u,t);this._angle2.update(0);
1E-5>n.squaredLength(this._tmpAxis2)?x=0:n.normalize(this._axis1,this._tmpAxis2);this._angle1.update(x);n.copy(this._lastScene,l)}this._screen[0].update(c[0]);this._screen[1].update(c[1]);this._time.update(w)}}addMomentumPreserveHeading(c,l,w,x,u,t,m){if(this.enabled){if(this._time.hasLastValue()){if(.01>this._time.computeDelta(w))return;p.rotationAnglesAndAxesHeadingPreserving(this._lastScene,l,this._tmpAxis2,this._tmpAxis1,this._tmpAngles,x,u,t,m,!1);1E-5>n.squaredLength(this._tmpAxis2)?(this._angle1.update(0),
this._angle2.update(0)):(this._angle1.update(this._tmpAngles[1]),this._angle2.update(this._tmpAngles[0]),n.normalize(this._axis1,this._tmpAxis1),n.normalize(this._axis2,this._tmpAxis2));n.copy(this._lastScene,l)}this._screen[0].update(c[0]);this._screen[1].update(c[1]);this._time.update(w)}}reset(){this._screen[0].reset();this._screen[1].reset();this._angle1.reset();this._angle2.reset();this._time.reset()}evaluateMomentum(){if(!this.enabled||!this._screen[0].hasFilteredDelta())return null;var c=this._screen[0].filteredDelta,
l=this._screen[1].filteredDelta;c=null==c||null==l?null:Math.sqrt(c*c+l*l);l=this._time.filteredDelta;c=null==c||null==l?0:c/l;return Math.abs(c)<this._minimumInitialVelocity?null:this.createMomentum(c,this._stopVelocity,this._friction)}createMomentum(c,l,w){const x=this._time.filteredDelta,u=this._angle1.filteredValue,t=this._angle2.filteredValue;return new d(c,l,w,null==x||null==u?0:u/x,this._axis1,null==x||null==t?0:t/x,this._axis2)}}a.PanSphericalMomentum=d;a.PanSphericalMomentumEstimator=f;Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/navigation/FilteredValue":function(){define(["exports"],function(a){class b{constructor(n){this._gain=n}update(n){this.filteredValue=void 0!==this.filteredValue?(1-this._gain)*this.filteredValue+this._gain*n:n}reset(){this.filteredValue=void 0}get hasFilteredValue(){return void 0!==this.filteredValue}}a.FilteredValue=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/navigation/RotationMomentumEstimator":function(){define(["exports",
"./MomentumEstimator"],function(a,b){class n extends b.MomentumEstimator{constructor(k=3,p=.01,h=.95,e=12){super(k,p,h,e)}add(k,p){const h=this.value.lastValue;if(null!=h){for(k-=h;k>Math.PI;)k-=2*Math.PI;for(;k<-Math.PI;)k+=2*Math.PI;k=h+k}super.add(k,p)}}a.RotationMomentumEstimator=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/navigation/MomentumEstimator":function(){define(["exports","../../core/mathUtils","./FilteredFiniteDifference","./Momentum"],function(a,b,
n,k){class p{constructor(h=2.5,e=.01,g=.95,d=12){this._minimumInitialVelocity=h;this._stopVelocity=e;this._friction=g;this._maxVelocity=d;this.enabled=!0;this.value=new n.FilteredFiniteDifference(.8);this.time=new n.FilteredFiniteDifference(.3)}add(h,e){if(this.enabled&&null!=e){if(this.time.hasLastValue()){if(.01>this.time.computeDelta(e))return;if(this.value.hasFilteredDelta()){const g=this.value.computeDelta(h);0>this.value.filteredDelta*g&&this.value.reset()}}this.time.update(e);this.value.update(h)}}reset(){this.value.reset();
this.time.reset()}evaluateMomentum(){if(!this.enabled||!this.value.hasFilteredDelta()||!this.time.hasFilteredDelta())return null;let h=this.value.filteredDelta/this.time.filteredDelta;h=b.clamp(h,-this._maxVelocity,this._maxVelocity);return Math.abs(h)<this._minimumInitialVelocity?null:this.createMomentum(h,this._stopVelocity,this._friction)}createMomentum(h,e,g){return new k.Momentum(h,e,g)}}a.MomentumEstimator=p;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/navigation/ZoomMomentumEstimator":function(){define(["exports",
"./Momentum","./MomentumEstimator"],function(a,b,n){class k extends b.Momentum{constructor(h,e,g){super(h,e,g)}value(h){h=super.value(h);return Math.exp(h)}valueDelta(h,e){const g=super.value(h);h=super.value(h+e);return Math.exp(h-g)}}class p extends n.MomentumEstimator{constructor(h=2.5,e=.01,g=.95,d=12){super(h,e,g,d)}add(h,e){super.add(Math.log(h),e)}createMomentum(h,e,g){return new k(h,e,g)}}a.ZoomMomentum=k;a.ZoomMomentumEstimator=p;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/state/controllers/PinchAndPanControllerLocal":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/screenUtils ../../../../core/Logger ../../../../core/has ../../../../core/RandomLCG ../../../../core/Error ../../../../core/accessorSupport/decorators/subclass ../../../../core/libs/gl-matrix-2/math/vec2 ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../geometry/support/axisAngle ../../../../geometry/support/plane ../../camera/constraintUtils ../../camera/constraintUtils/ConstraintOptions ../../camera/constraintUtils/ConstraintTypes ../../camera/constraintUtils/InteractionType ../../input/util ../../layers/VoxelWasm ./InteractiveController ./momentum/PanPlanarMomentumController ./momentum/RotationMomentumController ./momentum/ZoomPlanarMomentumController ../utils/navigationUtils ../../webgl/RenderCamera ../../../navigation/PanPlanarMomentumEstimator ../../../navigation/RotationMomentumEstimator ../../../navigation/ZoomMomentumEstimator".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w,x,u,t,m,q,r,v,y,B,z,A,C,H,E,F){const G=c.fromValues(0,0,1);a.PinchAndPanControllerLocal=class extends v.InteractiveController{constructor(){super(...arguments);this._rotationValueSmooth=new q.ExponentialFalloff(.05);this._scalingValueSmooth=new q.ExponentialFalloff(.05);this._planeHorizontal=w.create();this._planeVertical=w.create();this._rotationMomentumEstimator=new E.RotationMomentumEstimator;this._panMomentumEstimator=new H.PanPlanarMomentumEstimator(300,12,
.9);this._zoomMomentumEstimator=new F.ZoomMomentumEstimator;this._beginRadius=0;this._beginCenter=c.create();this._beginAngle=0;this._tmpPoints=[];this._navMode=A.NavigationMode.Horizontal;this._beginCenterScreen=n.createScreenPointArray();this._tmpCentroid3d=c.create();this._tmpCentroid2d=n.createScreenPointArray();this._tmp2d=n.createScreenPointArray();this._pointerCount=0;this._beginCamera=new C;this._constraintOptions=new u.ConstraintOptions(t.ConstraintTypes.ALL,m.InteractionType.NONE,0,this._beginCamera)}begin(D){if(this.running){var I=
this.view.navigation.momentumEnabled;this._zoomMomentumEstimator.enabled=I;this._rotationMomentumEstimator.enabled=I;this._panMomentumEstimator.enabled=I;this._beginRadius=D.radius;this._pointerCount=D.pointers.size;this._beginAngle=D.angle;this._rotationValueSmooth.reset();this._scalingValueSmooth.reset();n.screenPointObjectToArray(D.center,this._beginCenterScreen);w.fromNormalAndOffset(G,0,this._planeHorizontal);var J=c.create();I=this._intersectionHelper.intersectScreenFreePointFallback(this._beginCenterScreen,
J,0===this.view.map.ground.opacity?A.contentIntersectorOptions:{});var N=c.create();f.negate(N,this.startCamera.viewForward);var M=c.create();f.copy(M,G);var Q=f.dot(N,M);this._navMode=A.navigationMode(this.startCamera,this._beginCenterScreen,this.view.renderCoordsHelper,this.view.viewingMode);var O=Math.min(A.panDistanceModifier,1/Math.abs(f.dot(M,this.startCamera.viewForward)))*Math.max(Math.abs(this.view.camera.position.z),A.minHeightLimit);w.setOffsetFromPoint(this._planeHorizontal,this._planeHorizontal,
J);this.startCamera.aboveGround||w.negate(this._planeHorizontal,this._planeHorizontal);var K=c.create(),L=c.create(),P=c.create();f.subtract(K,J,this.currentCamera.eye);var R=f.length(K);f.normalize(K,K);this._navMode===A.NavigationMode.Vertical?(f.scale(M,M,Q),f.subtract(w.getNormal(this._planeVertical),N,M),f.normalize(w.getNormal(this._planeVertical),w.getNormal(this._planeVertical)),w.setOffsetFromPoint(this._planeVertical,this._planeVertical,J),J=this.view._stage.renderView.getMinimalDepthForArea(r.getVoxelWasm(this.view),
this._beginCenterScreen[0],this._beginCenterScreen[1],this.view.state.camera,A.screenPixelArea),O=null!=J?J:O,O=I?Math.min(O,R):O,f.copy(P,f.add(L,this.currentCamera.eye,f.scale(L,K,O))),this._planeVertical[3]=-f.dot(w.getNormal(this._planeVertical),P),this._computePlanePoints(D.pointers,this._planeVertical,this.startCamera,this._tmpPoints)):(f.copy(P,f.add(L,this.currentCamera.eye,f.scale(L,K,I?R:O))),this._planeHorizontal[3]=-f.dot(w.getNormal(this._planeHorizontal),P),this._computePlanePoints(D.pointers,
this._planeHorizontal,this.startCamera,this._tmpPoints));A.centroid(this._tmpPoints,this._beginCenter);this._beginCamera.copyFrom(this.startCamera)}}update(D){if(this.running){this.currentCamera.copyFrom(this.startCamera);var I=1<D.pointers.size,J=this._navMode===A.NavigationMode.Horizontal?this._planeHorizontal:this._planeVertical,N=this._beginCenter;if(I){const M=this._beginRadius/D.radius;this._scalingValueSmooth.gain=.001875*Math.min(Math.max(D.radius,40),120);this._scalingValueSmooth.update(M);
A.applyZoomToPoint(this.currentCamera,N,this._scalingValueSmooth.value,this.view.state.constraints.minimumPoiDistance);this._zoomMomentumEstimator.add(this._scalingValueSmooth.value,.001*D.timestamp);this._constraintOptions.interactionType=m.InteractionType.ZOOM;this._constraintOptions.interactionFactor=x.pixelDistanceToInteractionFactor(Math.abs(D.radius-this._beginRadius));x.applyAll(this.view,this.currentCamera,this._constraintOptions)}this._computePlanePoints(D.pointers,J,this.currentCamera,this._tmpPoints);
A.centroid(this._tmpPoints,this._tmpCentroid3d);n.screenPointObjectToArray(D.center,this._tmpCentroid2d);A.applyPanPlanar(this.currentCamera,N,this._tmpCentroid3d);this._panMomentumEstimator.add(this._tmpCentroid2d,this._tmpCentroid3d,.001*D.timestamp);this._constraintOptions.interactionType=m.InteractionType.PAN;this._constraintOptions.interactionFactor=x.pixelDistanceToInteractionFactor(d.distance(this._beginCenterScreen,this._tmpCentroid2d));x.applyAll(this.view,this.currentCamera,this._constraintOptions);
I&&(I=this._rotationValueSmooth.value,J=A.normalizeRotationDelta(D.angle-I),this._rotationValueSmooth.gain=.00125*Math.min(Math.max(D.radius,40),120),this._rotationValueSmooth.update(I+J),I=this._rotationValueSmooth.value-this._beginAngle,this._rotationMomentumEstimator.add(I,.001*D.timestamp),J=w.getNormal(this._planeHorizontal),A.applyRotation(this.currentCamera,N,l.wrapAxisAngle(J,I)),this._constraintOptions.interactionType=m.InteractionType.TUMBLE,this._constraintOptions.interactionFactor=x.pixelDistanceToInteractionFactor(Math.abs(D.radius*
I)),x.applyAll(this.view,this.currentCamera,this._constraintOptions));this.commitCamera()}}end(D){D.pointers.size===this._pointerCount&&this.update(D);this.finishController();return(D=this._zoomMomentumEstimator.evaluateMomentum())?new z.ZoomPlanarMomentumController({view:this.view,momentum:D,zoomCenter:this._beginCenter}):(D=this._rotationMomentumEstimator.evaluateMomentum())?new B.RotationMomentumController({view:this.view,momentum:D,center:this._beginCenter,axis:w.getNormal(this._planeHorizontal)}):
(D=this._panMomentumEstimator.evaluateMomentum())?new y.PanPlanarMomentumController({view:this.view,momentum:D}):null}_computePlanePoints(D,I,J,N){N.length=D.size;const M=this._tmp2d;let Q=0;D.forEach(O=>{M[0]=O.x;M[1]=O.y;void 0===N[Q]&&(N[Q]=c.create());A.intersectPlaneFromScreenPointAtEye(I,J,M,N[Q]);Q+=1});return N}get _intersectionHelper(){return this.view.sceneIntersectionHelper}};a.PinchAndPanControllerLocal=b.__decorate([g.subclass("esri.views.3d.state.controllers.PinchAndPanControllerLocal")],
a.PinchAndPanControllerLocal);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/input/handlers/PointerDownCancelAnimation":function(){define(["exports","../../../input/InputHandler"],function(a,b){class n extends b.InputHandler{constructor(k,p){super(!0);this.view=k;this.registerIncoming("pointer-down",p,()=>this.view.state.stopActiveCameraController())}}a.PointerDownCancelAnimation=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/input/handlers/SingleKeyResetHeading":function(){define(["exports",
"./SingleKey"],function(a,b){class n extends b.SingleKey{constructor(k,p,h){super(p,h);this.view=k}activate(){this.view.goTo({heading:0}).catch(()=>{})}}a.SingleKeyResetHeading=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/input/handlers/SingleKey":function(){define(["exports","../../../input/InputHandler"],function(a,b){class n extends b.InputHandler{constructor(k,p){super(!0);this.key=k;this.registerIncoming("key-down",p,h=>this._handleKeyDown(h))}_handleKeyDown(k){k.data.key===
this.key&&(this.activate(),k.stopPropagation())}}a.SingleKey=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/input/handlers/SingleKeyResetTilt":function(){define(["exports","./SingleKey"],function(a,b){class n extends b.SingleKey{constructor(k,p,h){super(p,h);this.view=k}activate(){this.view.goTo({tilt:0}).catch(()=>{})}}a.SingleKeyResetTilt=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/input/handlers/TwoFingerTilt":function(){define(["exports",
"../../../../core/screenUtils","../../state/controllers/RotateController","../../../input/InputHandler"],function(a,b,n,k){class p extends k.InputHandler{constructor(h,e=!1){super(!0);this._view=h;this._invert=e;this.registerIncoming("vertical-two-finger-drag",g=>this._handleTwoFinger(g))}_handleTwoFinger(h){const e=b.createScreenPointArray(0,h.data.delta*(this._invert?-1:1));switch(h.data.action){case "begin":this._cameraController?.end();this._cameraController=new n.RotateController({view:this._view,
pivot:n.PivotPoint.CENTER});this._view.state.switchCameraController(this._cameraController);this._cameraController.begin(e);break;case "update":this._cameraController?.update(e);break;case "end":this._cameraController?.end(),this._cameraController=null}}}a.TwoFingerTilt=p;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/input/BrowserEventSource":function(){define(["exports","../../core/has","../../core/maybe","./gamepad/GamepadSource","../support/screenUtils"],function(a,
b,n,k,p){const h=b("edge"),e=b("chrome"),g=b("ff"),d=b("safari");class f{constructor(l,w){this._input=w;this._active={};this._callback=()=>{};this._activePointerCaptures=new Set;this._keyDownState=new Set;this._eventId=1;this._browserTouchPanningEnabled=!1;this._element=l;l.getAttribute("tabindex")||l.setAttribute("tabindex","0");this._eventHandlers={"key-down":this._handleKey,"key-up":this._handleKey,"pointer-down":this._handlePointer,"pointer-move":this._handlePointerPreventDefault,"pointer-up":this._handlePointerPreventDefault,
"pointer-enter":this._handlePointer,"pointer-leave":this._handlePointer,"pointer-cancel":this._handlePointer,"mouse-wheel":this._handleMouseWheel,"pointer-capture-lost":this._handlePointerCaptureLost};this._updateTouchAction();this._element.addEventListener("keydown",this._preventAltKeyDefault);this._gamepadSource=new k.GamepadSource(l,this._input);this._gamepadSource.onEvent=x=>this._callback("gamepad",x)}destroy(){this._callback=()=>{};this.activeEvents=null;this._activePointerCaptures.forEach(l=>
{this._releasePointerCaptureSafe(l)});this._gamepadSource=n.destroyMaybe(this._gamepadSource);this._activePointerCaptures=null;this._removeTouchAction();this._element.removeEventListener("keydown",this._preventAltKeyDefault)}get browserTouchPanningEnabled(){return this._browserTouchPanningEnabled}set browserTouchPanningEnabled(l){this._browserTouchPanningEnabled=l;this._updateTouchAction();this._updateTouchEventHandling()}set onEventReceived(l){this._callback=l}set activeEvents(l){for(const w in this._active)l&&
l.has(w)||(this._element.removeEventListener(c[w],this._active[w]),delete this._active[w]);l&&l.forEach(w=>{if(!this._active[w]&&c[w]){const x=(this._eventHandlers[w]||this._handleDefault).bind(this,w);this._element.addEventListener(c[w],x);this._active[w]=x}});this._gamepadSource.hasEventListeners=l?.has("gamepad")??!1}setPointerCapture(l,w){w?this._setPointerCatpureSafe(l.pointerId):(this._releasePointerCaptureSafe(l.pointerId),this._activePointerCaptures.delete(l.pointerId))}_updateTouchAction(){this._element.classList.remove(this._browserTouchPanningEnabled?
"esri-view-surface--touch-none":"esri-view-surface--touch-pan");this._element.classList.add(this._browserTouchPanningEnabled?"esri-view-surface--touch-pan":"esri-view-surface--touch-none")}_updateTouchEventHandling(){this._browserTouchPanningEnabled?this._element.addEventListener("touchmove",this._preventMultiTouchPanning):this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)}_removeTouchAction(){this._element.classList.remove("esri-view-surface--touch-none");this._element.classList.remove("esri-view-surface--touch-pan");
this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)}_setPointerCatpureSafe(l){try{this._element.setPointerCapture(l),this._activePointerCaptures.add(l)}catch{}}_releasePointerCaptureSafe(l){try{this._element.hasPointerCapture&&!this._element.hasPointerCapture(l)||this._element.releasePointerCapture(l)}catch(w){}}_updateNormalizedPointerLikeEvent(l,w){l=p.createScreenPointFromNativeEvent(this._element,l);f.test.disableSubpixelCoordinates&&(l.x=Math.round(l.x),l.y=Math.round(l.y));
w.x=l.x;w.y=l.y;return w}_handleKey(l,w){const {key:x}=w;x&&"key-up"===l&&this._keyDownState.delete(x);w={native:w,key:x,repeat:!!x&&this._keyDownState.has(x)};x&&"key-down"===l&&this._keyDownState.add(w.key);this._callback(l,w)}_handlePointer(l,w){w=this._updateNormalizedPointerLikeEvent(w,{native:w,x:0,y:0,pointerType:w.pointerType,button:w.button,buttons:w.buttons,eventId:this._eventId++});this._callback(l,w)}_handlePointerPreventDefault(l,w){const x=this._updateNormalizedPointerLikeEvent(w,{native:w,
x:0,y:0,pointerType:w.pointerType,button:w.button,buttons:w.buttons,eventId:this._eventId++});w.preventDefault();this._callback(l,x)}_getDeltaFromTrackpadOrMouseWheel(l){return l.shiftKey&&b("mac")&&0===l.deltaY?l.deltaX:l.deltaY}_handleMouseWheel(l,w){let x=this._getDeltaFromTrackpadOrMouseWheel(w);switch(w.deltaMode){case 0:h&&(x=x/document.documentElement.clientHeight*600);break;case 1:x*=30;break;case 2:x*=900}h?x*=.7:e||d?x*=.6:g&&(x*=1.375);const u=Math.abs(x);100<u&&(x=x/u*200/(1+Math.exp(-.02*
(u-100))));w=this._updateNormalizedPointerLikeEvent(w,{native:w,x:0,y:0,deltaY:x});this._callback(l,w)}_handlePointerCaptureLost(l,w){this._activePointerCaptures.delete(w.pointerId);this._handleDefault(l,w)}_handleDefault(l,w){const x={native:w};w.preventDefault();this._callback(l,x)}_preventAltKeyDefault(l){"Alt"===l.key&&l.preventDefault()}_preventMultiTouchPanning(l){1<l.touches.length&&l.preventDefault()}}f.test={disableSubpixelCoordinates:!1};const c={"key-down":"keydown","key-up":"keyup","pointer-down":"pointerdown",
"pointer-up":"pointerup","pointer-move":"pointermove","mouse-wheel":"wheel","pointer-capture-got":"gotpointercapture","pointer-capture-lost":"lostpointercapture","context-menu":"contextmenu","pointer-enter":"pointerenter","pointer-leave":"pointerleave","pointer-cancel":"pointercancel",focus:"focus",blur:"blur"};a.BrowserEventSource=f;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/input/gamepad/GamepadSource":function(){define(["exports","../../../core/scheduling","./GamepadInputDevice",
"./GamepadState"],function(a,b,n,k){function p(e){for(const d of navigator.getGamepads()){var g;a:if((g=d)&&g.connected){for(let f=0;f<g.axes.length;f++)if(isNaN(g.axes[f])){g=!1;break a}g=!0}else g=!1;g&&e(d)}}class h{constructor(e,g){this._element=e;this._input=g;this._hasEventListeners=!1;this._onConnectGamepad=d=>{this._connectGamepad(d.gamepad)};this._onDisconnectGamepad=d=>{d=d.gamepad;const f=d.index,c=this._inputDevices[f];c&&(this._emitGamepadEvent(d,k.extractState(c),!1),this._inputDevices.splice(f,
1),this._latestUpdate.splice(f,1),this._input.gamepad.devices.remove(c),this.ensurePollingState())};this._frameTask=null;this._latestUpdate=[];this._inputDevices=[];this._callback=null;e=window.isSecureContext;if(this.supported="getGamepads"in window.navigator&&e)p(d=>this._connectGamepad(d)),window.addEventListener("gamepadconnected",this._onConnectGamepad),window.addEventListener("gamepaddisconnected",this._onDisconnectGamepad),this.ensurePollingState()}destroy(){this.hasEventListeners=!1;this.supported&&
(window.removeEventListener("gamepadconnected",this._onConnectGamepad),window.removeEventListener("gamepaddisconnected",this._onDisconnectGamepad))}set hasEventListeners(e){this._hasEventListeners!==e&&(this._hasEventListeners=e,this.ensurePollingState())}get _eventsEnabled(){return this.supported&&0<this._inputDevices.length&&this._hasEventListeners}set onEvent(e){this._callback=e}_connectGamepad(e){const g=new n(e);"unknown"!==g.deviceType&&(this._inputDevices[e.index]=g,this._input.gamepad.devices.add(g));
this.ensurePollingState()}ensurePollingState(){this._eventsEnabled?this._startPolling():this._stopPolling()}_startPolling(){null==this._frameTask&&(this._frameTask=b.addFrameTask({update:()=>this._readGamepadState()}))}_stopPolling(){null!=this._frameTask&&(this._frameTask.remove(),this._frameTask=null,this._latestUpdate=[])}_readGamepadState(){const e=document.hasFocus(),g=this._element.contains(document.activeElement),d="document"===this._input.gamepad.enabledFocusMode&&!e||"view"===this._input.gamepad.enabledFocusMode&&
!g;p(f=>{var c=this._inputDevices[f.index];if(c){var l=this._latestUpdate[f.index];c=k.extractState(c);var w=d||k.stateIdle(c);l&&(l.timestamp===f.timestamp||!l.active&&w||k.stateEqual(l.state,c))||this._emitGamepadEvent(f,c,!w)}})}_emitGamepadEvent(e,g,d){var f=this._latestUpdate[e.index];if((f=f&&f.active)||d)this._latestUpdate[e.index]={timestamp:e.timestamp,state:g,active:d},this._callback&&this._callback({device:this._inputDevices[e.index],state:g,action:!f&&d?"start":f&&d?"update":"end"})}}
a.GamepadSource=h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/input/gamepad/GamepadState":function(){define(["exports"],function(a){a.extractState=function(b){const n=b.native;return n?{buttons:n.buttons.map(k=>k.pressed?k.value||1:0),axes:n.axes.map(k=>{{var p=b.axisThreshold;const h=Math.abs(k);k=h<p?0:Math.sign(k)*(h-p)/(1-p)}return k})}:{buttons:[],axes:[]}};a.stateEqual=function(b,n){if(b.axes.length!==n.axes.length||b.buttons.length!==n.buttons.length)return!1;
for(var k=0;k<b.axes.length;k++)if(b.axes[k]!==n.axes[k])return!1;for(k=0;k<b.buttons.length;k++)if(b.buttons[k]!==n.buttons[k])return!1;return!0};a.stateIdle=function(b){for(var n=0;n<b.axes.length;n++)if(0!==b.axes[n])return!1;for(n=0;n<b.buttons.length;n++)if(0!==b.buttons[n])return!1;return!0};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/input/handlers/PreventContextMenu":function(){define(["exports","../InputHandler"],function(a,b){class n extends b.InputHandler{constructor(){super(!0);
this.registerIncoming("context-menu",k=>k.data.native.preventDefault())}}a.PreventContextMenu=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/input/recognizers/Drag":function(){define(["exports","../../../core/screenUtils","../../../core/time","../InputHandler","./support"],function(a,b,n,k,p){function h(c){const l=[];c.forEach(w=>{l.push(b.createScreenPoint(w.event.x,w.event.y))});return p.fitCircleLSQ(l)}function e(c){const l=h(c);let w=0;c.forEach(x=>{var u=d(x,l);
for(u-=x.lastAngle;u>Math.PI;)u-=2*Math.PI;for(;u<-Math.PI;)u+=2*Math.PI;u=x.lastAngle+u;x.lastAngle=u;w+=u-x.initialAngle});w/=c.size||1;return{angle:w,radius:l.radius,center:l.center}}function g(c){const l=new Map;c.forEach((w,x)=>l.set(x,w.event));return l}function d(c,l){c=c.event;return Math.atan2(c.y-l.center.y,c.x-l.center.x)}class f extends k.InputHandler{constructor(c){super(!1);this._navigationTouch=c;this._startStateModifiers=new Set;this._activePointerMap=new Map;this._isCurrentDragSuppressed=
this._isDragging=!1;this._drag=this.registerOutgoing("drag");this.registerIncoming("pointer-drag",this._handlePointerDrag.bind(this));this.registerIncoming("pointer-up",this._handlePointerUpAndPointerLost.bind(this));this.registerIncoming("pointer-capture-lost",this._handlePointerUpAndPointerLost.bind(this));this.registerIncoming("pointer-cancel",this._handlePointerUpAndPointerLost.bind(this))}_createPayload(c,l,w,x){return{action:c,pointerType:this._pointerType,button:this._mouseButton,buttons:l.buttons,
timestamp:x,pointers:g(this._activePointerMap),pointer:l,angle:w.angle,radius:w.radius,center:w.center}}_addPointer(c){var l=c.native.pointerId;const w=e(this._activePointerMap).angle;c={event:c,initialAngle:0,lastAngle:0};this._activePointerMap.set(l,c);l=d(c,h(this._activePointerMap));c.initialAngle=l;c.lastAngle=l;this._updatePointerAngles(w)}_updatePointer(c){if(!c||null!=c.x||null!=c.y){var l=this._activePointerMap.get(c.native.pointerId);l?l.event=c:this._addPointer(c)}}_removePointer(c){const l=
e(this._activePointerMap).angle;this._activePointerMap.delete(c);this._updatePointerAngles(l)}_updatePointerAngles(c){const l=e(this._activePointerMap);this._activePointerMap.forEach(w=>{w.initialAngle=d(w,l)-c;w.lastAngle=d(w,l)-c})}_emitEvent(c,l,w){const x=e(this._activePointerMap);this._drag.emit(this._createPayload(c,l,x,w),void 0,this._startStateModifiers)}_handlePointerUpAndPointerLost(c){const l=c.data.native.pointerId,w=n.Milliseconds(c.timestamp);this._activePointerMap.get(l)&&(1===this._activePointerMap.size?
(this._updatePointer(c.data),!this._isCurrentDragSuppressed&&this._emitEvent("end",c.data,w),this._isCurrentDragSuppressed=this._isDragging=!1,this._removePointer(l)):(this._removePointer(l),this._emitEvent("removed",c.data,n.Milliseconds(c.timestamp))))}_handlePointerDrag(c){const l=c.data,w=l.currentEvent,x=n.Milliseconds(c.timestamp);switch(l.action){case "start":case "update":this._isDragging?this._activePointerMap.has(w.native.pointerId)?(this._updatePointer(w),!this._isCurrentDragSuppressed&&
this._emitEvent("update",w,x)):(this._addPointer(w),this._emitEvent("added",w,x),this._isCurrentDragSuppressed=this._isSuppressed):(this._updatePointer(w),this._pointerType=c.data.startEvent.pointerType,this._mouseButton=c.data.startEvent.button,this._startStateModifiers=c.modifiers,this._isDragging=!0,this._isCurrentDragSuppressed=this._isSuppressed,!this._isCurrentDragSuppressed&&this._emitEvent("start",w,x))}}get _isSuppressed(){return!!this._navigationTouch&&!this._navigationTouch.browserTouchPanEnabled&&
"touch"===this._pointerType&&1===this._activePointerMap.size}}a.Button=void 0;(function(c){c[c.Left=0]="Left";c[c.Middle=1]="Middle";c[c.Right=2]="Right";c[c.Back=3]="Back";c[c.Forward=4]="Forward";c[c.Undefined=-1]="Undefined"})(a.Button||(a.Button={}));a.Drag=f;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/input/recognizers/support":function(){define(["exports","../../../core/screenUtils"],function(a,b){a.DefaultParameters={maximumClickDelay:300,movementUntilMouseDrag:1.5,
movementUntilPenDrag:6,movementUntilTouchDrag:6,holdDelay:500,maximumDoubleClickDelay:250,maximumDoubleClickDistance:10,maximumDoubleTouchDelay:350,maximumDoubleTouchDistance:35};a.euclideanDistance=function(n,k){const p=k.x-n.x;n=k.y-n.y;return Math.sqrt(p*p+n*n)};a.fitCircleLSQ=function(n,k){k?(k.radius=0,k.center.x=0,k.center.y=0):k={radius:0,center:b.createScreenPoint()};if(0===n.length)return k;if(1===n.length)return k.center.x=n[0].x,k.center.y=n[0].y,k;if(2===n.length){const [t,m]=n,[q,r]=
[m.x-t.x,m.y-t.y];k.radius=Math.sqrt(q*q+r*r)/2;k.center.x=(t.x+m.x)/2;k.center.y=(t.y+m.y)/2;return k}let p=0,h=0;for(k=0;k<n.length;k++)p+=n[k].x,h+=n[k].y;p/=n.length;h/=n.length;var e=n.map(t=>t.x-p),g=n.map(t=>t.y-h);let d=k=0;var f=0,c=0,l=0,w=0,x=0;for(var u=0;u<e.length;u++){const t=e[u],m=g[u],q=t*t,r=m*m;k+=q;d+=r;f+=t*m;c+=q*t;l+=r*m;w+=t*r;x+=m*q}e=k;g=f;u=d;c=.5*(c+w);l=.5*(l+x);x=e*u-f*g;w=(c*u-l*g)/x;l=(e*l-f*c)/x;x=b.createScreenPoint(w+p,l+h);return{radius:Math.sqrt(w*w+l*l+(k+d)/
n.length),center:x}};a.getPointerId=function(n){({native:n}=n);const {pointerId:k,button:p,pointerType:h}=n;return"mouse"===h?`${k}:${p}`:`${h}`};a.manhattanDistance=function(n,k){return Math.abs(k.x-n.x)+Math.abs(k.y-n.y)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/input/recognizers/ImmediateDoubleClick":function(){define(["exports","../../../core/clock","../InputHandler","./support"],function(a,b,n,k){class p extends n.InputHandler{constructor(h=k.DefaultParameters.maximumDoubleClickDelay,
e=k.DefaultParameters.maximumDoubleClickDistance,g=k.DefaultParameters.maximumDoubleTouchDelay,d=k.DefaultParameters.maximumDoubleTouchDistance,f=b.clock){super(!1);this._maximumDoubleClickDelay=h;this._maximumDoubleClickDistance=e;this._maximumDoubleTouchDelay=g;this._maximumDoubleTouchDistance=d;this._clock=f;this._pointerState=new Map;this._immediateDoubleClick=this.registerOutgoing("immediate-double-click");this.registerIncoming("pointer-down",this._handlePointerDown.bind(this));this.registerIncoming("pointer-up",
this._handlePointerUp.bind(this))}onUninstall(){this._pointerState.forEach(h=>{h.immediateDoubleClick&&h.immediateDoubleClick.timeoutHandle.remove()});super.onUninstall()}_handlePointerDown(h){h=h.data;const e=k.getPointerId(h);this._pointerState.has(e)||(this._pointerState.set(e,{downButton:h.native.button,x:h.x,y:h.y,immediateDoubleClick:null}),this.startCapturingPointer(h.native))}_handlePointerUp(h){const e=h.data;var g=k.getPointerId(e);if((g=this._pointerState.get(g))&&g.downButton===e.native.button){const d=
g.immediateDoubleClick,f="touch"===h.data.native.pointerType?this._maximumDoubleTouchDistance:this._maximumDoubleClickDistance;d?(d.timeoutHandle.remove(),k.manhattanDistance(d,h.data)>f?this._startImmediateDoubleClick(h,g):(this._immediateDoubleClick.emit(h.data,void 0,d.modifiers),this._removeState(e))):k.manhattanDistance(g,h.data)>f?this._removeState(e):this._startImmediateDoubleClick(h,g)}}_startImmediateDoubleClick(h,e){e.immediateDoubleClick={x:h.data.x,y:h.data.y,modifiers:h.modifiers,timeoutHandle:this._clock.setTimeout(()=>
this._removeState(h.data),"touch"===h.data.native.pointerType?this._maximumDoubleTouchDelay:this._maximumDoubleClickDelay)}}_removeState(h){const e=k.getPointerId(h);this._pointerState.delete(e);this.stopCapturingPointer(h.native);this.refreshHasPendingInputs()}}a.ImmediateDoubleClick=p;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/input/recognizers/PointerClickHoldAndDrag":function(){define(["exports","../../../core/clock","../../../core/maybe","../InputHandler","./support"],
function(a,b,n,k,p){function h(g,d,f){return{action:g,startEvent:d.startEvent,previousEvent:d.previousEvent,currentEvent:f}}class e extends k.InputHandler{constructor(g=p.DefaultParameters.maximumClickDelay,d=p.DefaultParameters.movementUntilMouseDrag,f=p.DefaultParameters.movementUntilPenDrag,c=p.DefaultParameters.movementUntilTouchDrag,l=p.DefaultParameters.holdDelay,w=b.clock){super(!1);this._maximumClickDelay=g;this._movementUntilMouseDrag=d;this._movementUntilPenDrag=f;this._movementUntilTouchDrag=
c;this._holdDelay=l;this._clock=w;this._pointerState=new Map;this._pointerDrag=this.registerOutgoing("pointer-drag");this._immediateClick=this.registerOutgoing("immediate-click");this._pointerHold=this.registerOutgoing("hold");this.registerIncoming("pointer-down",x=>this._handlePointerDown(x));this.registerIncoming("pointer-up",x=>this._handlePointerLoss(x,"pointer-up"));this.registerIncoming("pointer-capture-lost",x=>this._handlePointerLoss(x,"pointer-capture-lost"));this.registerIncoming("pointer-cancel",
x=>this._handlePointerLoss(x,"pointer-cancel"));this._moveHandle=this.registerIncoming("pointer-move",x=>this._handlePointerMove(x));this._moveHandle.pause()}onUninstall(){this._pointerState.forEach(g=>{g.holdTimeout=n.removeMaybe(g.holdTimeout)});super.onUninstall()}_handlePointerDown(g){const d=g.data,f=d.native.pointerId;var c=null;0===this._pointerState.size&&(c=this._clock.setTimeout(()=>{const l=this._pointerState.get(f);l&&(l.isDragging||(this._pointerHold.emit(l.previousEvent,void 0,g.modifiers),
l.holdEmitted=!0),l.holdTimeout=null)},this._holdDelay));c={startEvent:d,previousEvent:d,startTimestamp:g.timestamp,isDragging:!1,downButton:d.native.button,holdTimeout:c,modifiers:new Set};this._pointerState.set(f,c);this.startCapturingPointer(d.native);this._moveHandle.resume();1<this._pointerState.size&&this._startDragging(g)}_handlePointerMove(g){const d=g.data,f=this._pointerState.get(d.native.pointerId);if(f){if(f.isDragging)this._pointerDrag.emit(h("update",f,d),void 0,f.modifiers);else{const c=
p.euclideanDistance(d,f.startEvent),l=this._getDragThreshold(d.native.pointerType);c>l&&this._startDragging(g)}f.previousEvent=d}}_getDragThreshold(g){switch(g){case "touch":return this._movementUntilTouchDrag;case "pen":return this._movementUntilPenDrag;default:return this._movementUntilMouseDrag}}_startDragging(g){const d=g.data,f=d.native.pointerId;this._pointerState.forEach(c=>{null!=c.holdTimeout&&(c.holdTimeout.remove(),c.holdTimeout=null);c.isDragging||(c.modifiers=g.modifiers,c.isDragging=
!0,f===c.startEvent.native.pointerId?this._pointerDrag.emit(h("start",c,d)):this._pointerDrag.emit(h("start",c,c.previousEvent),g.timestamp))})}_handlePointerLoss(g,d){const f=g.data,c=f.native.pointerId,l=this._pointerState.get(c);l&&(null!=l.holdTimeout&&(l.holdTimeout.remove(),l.holdTimeout=null),l.isDragging?this._pointerDrag.emit(h("end",l,"pointer-up"===d?f:l.previousEvent),void 0,l.modifiers):"pointer-up"===d&&l.downButton===f.native.button&&g.timestamp-l.startTimestamp<=this._maximumClickDelay&&
!l.holdEmitted&&this._immediateClick.emit(f),this._pointerState.delete(c),this.stopCapturingPointer(f.native),0===this._pointerState.size&&this._moveHandle.pause())}}a.PointerClickHoldAndDrag=e;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/input/recognizers/SingleAndDoubleClick":function(){define(["exports","../../../core/clock","../../../core/maybe","../InputHandler","./support"],function(a,b,n,k,p){class h extends k.InputHandler{constructor(e=p.DefaultParameters.maximumDoubleClickDelay,
g=p.DefaultParameters.maximumDoubleClickDistance,d=p.DefaultParameters.maximumDoubleTouchDelay,f=p.DefaultParameters.maximumDoubleTouchDistance,c=b.clock){super(!1);this._maximumDoubleClickDelay=e;this._maximumDoubleClickDistance=g;this._maximumDoubleTouchDelay=d;this._maximumDoubleTouchDistance=f;this._clock=c;this._pointerState=new Map;this._click=this.registerOutgoing("click");this._doubleClick=this.registerOutgoing("double-click");this.registerIncoming("immediate-click",l=>this._handleImmediateClick(l));
this.registerIncoming("pointer-down",l=>this._handlePointerDown(l))}onUninstall(){this._pointerState.forEach(e=>e.doubleClickTimer=n.removeMaybe(e.doubleClickTimer))}get hasPendingInputs(){for(const e of this._pointerState.values())if(null!=e.doubleClickTimer)return!0;return!1}_clearDoubleClickTimer(e,g){const d=this._pointerState.get(e);d&&(d.doubleClickTimer=n.removeMaybe(d.doubleClickTimer),g&&this._click.emit(d.event.data,void 0,d.event.modifiers),this._pointerState.delete(e),this.refreshHasPendingInputs())}_doubleClickTimeoutExceeded(e){const g=
this._pointerState.get(e);1===g.pointerDownCount&&this._click.emit(g.event.data,void 0,g.event.modifiers);g.doubleClickTimer=null;this._pointerState.delete(e);this.refreshHasPendingInputs()}_handleImmediateClick(e){const g=e.data;var {pointerType:d}=g.native;const {pointerId:f,pointerType:c,button:l}=g.native;var w="mouse"===c?`${f}:${l}`:`${c}`;if(this._pointerState.has(w)){var x=this._pointerState.get(w),{data:u,modifiers:t}=x.event;d="touch"===d?this._maximumDoubleTouchDistance:this._maximumDoubleClickDistance;
p.manhattanDistance(u,g)>d?(this._clearDoubleClickTimer(w,!0),this._startClick(e)):(this._clearDoubleClickTimer(w,!1),2===x.pointerDownCount&&this._doubleClick.emit(u,void 0,t))}else this._startClick(e)}_handlePointerDown(e){e=p.getPointerId(e.data);if(e=this._pointerState.get(e))e.pointerDownCount+=1}_startClick(e){var {data:g}=e;const {native:{pointerType:d}}=g,f=p.getPointerId(g);g=this._clock.setTimeout(()=>this._doubleClickTimeoutExceeded(f),"touch"===d?this._maximumDoubleTouchDelay:this._maximumDoubleClickDelay);
this._pointerState.set(f,{event:e,doubleClickTimer:g,pointerDownCount:1});this.refreshHasPendingInputs()}}a.SingleAndDoubleClick=h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/input/recognizers/VerticalTwoFingerDrag":function(){define(["exports","../DragEventSeparator","../InputHandler"],function(a,b,n){class k extends n.InputHandler{constructor(p=20,h=40){super(!1);this._threshold=p;this._maxDelta=h;this._state="ready";this._emittedArtificalEnd2=!1;this._vertical=this.registerOutgoing("vertical-two-finger-drag");
this._artificalDrag=this.registerOutgoing("drag");this._dragEventSeparator=new b.DragEventSeparator({start:(e,g)=>this._observeStart(e,g),update:(e,g,d)=>this._observeUpdate(e,g,d),end:(e,g)=>this._observeEnd(g)});this.registerIncoming("drag",e=>this._dragEventSeparator.handle(e))}get failed(){return"failed"===this._state}_observeStart(p,h){1===p&&this._emittedArtificalEnd2&&(this._emittedArtificalEnd2=!1,this._artificalDrag.emit({action:"start",button:h.data.button,buttons:h.data.buttons,pointerType:h.data.pointerType,
timestamp:h.data.timestamp,pointers:h.data.pointers,pointer:h.data.pointer,angle:h.data.angle,radius:h.data.radius,center:h.data.center}),h.stopPropagation());this._state=2===p?"ready":"failed"}_observeUpdate(p,h,e){"failed"!==this._state&&2===p&&("active"===this._state?(this._vertical.emit({delta:h.data.center.y-this._thresholdReachedCenter.y,action:"update"}),h.stopPropagation()):this._checkMovementWithinLimits(h.data,e.data)?this._checkVerticalThresholdReached(h.data,e.data)&&(this._state="active",
this._emittedArtificalEnd2=!0,this._thresholdReachedCenter=h.data.center,this._artificalDrag.emit({action:"end",button:h.data.button,buttons:h.data.buttons,pointerType:h.data.pointerType,timestamp:h.data.timestamp,pointers:h.data.pointers,pointer:h.data.pointer,angle:h.data.angle,radius:h.data.radius,center:h.data.center}),this._vertical.emit({delta:h.data.center.y-this._thresholdReachedCenter.y,action:"begin"}),h.stopPropagation()):this._state="failed")}_observeEnd(p){"active"===this._state&&(this._vertical.emit({delta:p.data.center.y-
this._thresholdReachedCenter.y,action:"end"}),this._state="ready",p.stopPropagation())}_checkMovementWithinLimits(p,h){let e=-Infinity,g=Infinity,d=-Infinity,f=Infinity;for(const {x:u,y:t}of h.pointers.values())e=Math.max(e,u),g=Math.min(g,u),d=Math.max(d,t),f=Math.min(f,t);let c=-Infinity,l=Infinity,w=-Infinity,x=Infinity;for(const {x:u,y:t}of p.pointers.values())c=Math.max(c,u),l=Math.min(l,u),w=Math.max(w,t),x=Math.min(x,t);return Math.abs(p.center.x-h.center.x)<this._threshold&&Math.abs(c-l-(e-
g))<=this._maxDelta&&Math.abs(w-x-(d-f))<=this._maxDelta}_checkVerticalThresholdReached(p,h){let e=Math.abs(p.center.y-h.center.y);p.pointers.forEach((g,d)=>{d=h.pointers.get(d);e=Math.min(e,Math.abs(g.y-d.y))});return e>=this._threshold}}a.VerticalTwoFingerDrag=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/input/DragEventSeparator":function(){define(["exports"],function(a){class b{constructor(n){this._callbacks=n;this._currentCount=0;this._callbacks.condition||(this._callbacks.condition=
()=>!0)}handle(n){const k=n.data,p=k.pointers.size;switch(k.action){case "start":this._currentCount=p;this._emitStart(n);break;case "added":this._emitEnd(this._previousEvent);this._currentCount=p;this._emitStart(n);break;case "update":this._emitUpdate(n);break;case "removed":this._startEvent&&this._emitEnd(this._previousEvent);this._currentCount=p;this._emitStart(n);break;case "end":this._emitEnd(n),this._currentCount=0}this._previousEvent=n}_emitStart(n){this._startEvent=n;this._callbacks.condition?.(this._currentCount,
n)&&this._callbacks.start(this._currentCount,n,this._startEvent)}_emitUpdate(n){this._callbacks.condition?.(this._currentCount,n)&&this._callbacks.update(this._currentCount,n,this._startEvent)}_emitEnd(n){this._callbacks.condition?.(this._currentCount,n)&&this._callbacks.end(this._currentCount,n,this._startEvent);this._startEvent=null}}a.DragEventSeparator=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/GraphicsDeconflictor":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/maybe ../../../../core/reactiveUtils ../../../../core/Logger ../../../../core/has ../../../../core/RandomLCG ../../../../core/Error ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/boundedPlane ./Deconflictor ./enums ./LabelDeconflictor ../../../support/Scheduler".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w,x){function u(m){m=m.layer;return!(!m?.featureReduction||"selection"!==m.featureReduction.type)}function t(m){(m=m.graphics3DGraphics)&&m.forEach(q=>q.setVisibilityFlag(l.VisibilityGroup.GRAPHIC,l.VisibilityFlag.DECONFLICTION,!0))}a.GraphicsDeconflictor=class extends c.Deconflictor{constructor(){super(...arguments);this._contexts=new Map;this.visibilityGroup=l.VisibilityGroup.GRAPHIC;this._marginFactor=-.1;this.test={overrideMarginFactor:m=>{this._marginFactor=m;
this.setDirty()}}}get labels(){return this._labels}get viewState(){return this._viewState}initialize(){this.addHandles([k.watch(()=>this.view?.state?.camera,()=>{this._updateViewState();this.setDirty()}),k.watch(()=>this.view?.map?.ground?.opacity,(m,q)=>{1!==m&&1!==q||this.setDirty()}),k.watch(()=>this.view?.slicePlane,()=>{this._updateSlicePlane();this._slicePlaneChanged()},k.initial)]);this._frameTask=this.view.resourceController.scheduler.registerTask(x.TaskPriority.GRAPHICS_DECONFLICTOR,this);
this._labels=new w.LabelDeconflictor({view:this.view,parent:this})}destroy(){this._labels=n.destroyMaybe(this._labels);this._frameTask=n.removeMaybe(this._frameTask)}get marginFactor(){return this._marginFactor}setDirty(){0<this._contexts.size&&(super.setDirty(),this._labels.setDirty())}runTask(m){super.runTask(m);this.running||this._labels.setDirty()}_updateViewState(){this.view?.state&&(this._viewState.camera.copyFrom(this.view.state.camera),this._updateSlicePlane())}_updateSlicePlane(){const m=
this.view?this.view.slicePlane:null;null!=m&&f.transform(m,this._viewState.camera.viewMatrix,this._viewState.slicePlane);this._viewState.slicePlaneEnabled=null!=m}_slicePlaneChanged(){for(const m of this._contexts.keys())if(m.symbolCreationContext.slicePlaneEnabled){this.setDirty();break}}addGraphicsOwner(m){const q=this._getGraphicsContext(m);return{addGraphic:r=>this._addGraphic(m,q,r),removeGraphic:r=>this._removeGraphic(q,r),labelingInfoChange:()=>this._labels.enabledChanged(m,q),featureReductionChange:()=>
this.enabledChanged(m,q),slicePlaneEnabledChange:()=>this._slicePlaneEnabledChanged(m,q),clear:()=>q.forEach(r=>this._removeGraphic(q,r.graphics3DGraphic)),remove:()=>this._removeGraphicsOwner(m),setDirty:()=>this.setDirty()}}_removeGraphicsOwner(m){const q=this._contexts.get(m);q&&(q.forEach(r=>this._removeGraphic(q,r.graphics3DGraphic)),this._contexts.delete(m),this.setDirty())}_addGraphic(m,q,r){const v=r.graphic.uid,y=new c.DeconflictorGraphic(r,m.symbolCreationContext.slicePlaneEnabled);q.set(v,
y);u(m)&&this.addToActiveGraphics(y);m.labelsEnabled&&this._labels.addToActiveGraphics(y);m=!this._graphicSupportsDeconfliction(r)||!u(m);r.setVisibilityFlag(l.VisibilityGroup.GRAPHIC,l.VisibilityFlag.DECONFLICTION,m)}_removeGraphic(m,q){q=q.graphic.uid;const r=m.get(q);r&&(this.removeFromActiveGraphics(r),this._labels.removeFromActiveGraphics(r),m.delete(q),this.setDirty())}enabledChanged(m,q){const r=u(m);r||t(m);this.modifyGraphics(q,r)}_slicePlaneEnabledChanged(m,q){const r=m.symbolCreationContext.slicePlaneEnabled;
q.forEach(v=>v.slicePlaneEnabled=r);this.setDirty()}getGraphicsLayers(m){return m.layers}_graphicSupportsDeconfliction(m){if(m.isDraped)return!1;m=m.layers;if(!m?.length)return!1;for(const q of m)if(this.layerSupportsDeconfliction(q))return!0;return!1}_getGraphicsContext(m){var q=this._contexts.get(m);if(q)return q;q=new Map;this._contexts.set(m,q);this.setDirty();return q}};a.GraphicsDeconflictor=b.__decorate([d.subclass("esri.views.3d.layers.graphics.GraphicsDeconflictor")],a.GraphicsDeconflictor);
Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Deconflictor":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/mathUtils ../../../../core/PooledArray ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/Logger ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ../../../../core/libs/gl-matrix-2/math/mat4 ../../../../core/libs/gl-matrix-2/factories/mat4f64 ../../../../core/libs/gl-matrix-2/factories/vec2f64 ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../chunks/vec42 ../../../../core/libs/gl-matrix-2/factories/vec4f64 ../../../../geometry/ellipsoidUtils ../../../../geometry/support/aaBoundingRect ../../../../chunks/boundedPlane ../../../../geometry/support/ray ../../../../chunks/sphere ./deconflictorDebug ./enums ../../webgl/RenderCamera ../../webgl-engine/lib/screenSizePerspectiveUtils ../../webgl-engine/lib/VertexAttribute ../../webgl-engine/materials/HUDMaterial ../../webgl-engine/materials/ScaleInfo".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w,x,u,t,m,q,r,v,y,B,z,A,C,H,E,F,G){function*D(S){if(Map.prototype.entries){S=S.entries();for(let Z=S.next();!Z.done;Z=S.next())yield Z.value[1]}else yield*S.values()}function*I(S,Z,ia){Z.clear();S.forEach((ea,ka)=>{const ja=Z.pushNew();ja.id=ka;ja.visible=ea.graphics3DGraphic.getVisibilityFlag(ia,A.VisibilityFlag.DECONFLICTION);ka=ea.info?.[ia];ja.prio=ea.graphics3DGraphic.deconflictionPriority;ja.distance=ka?ka.distance:Number.MAX_VALUE});yield;const Y=Z.iterableSort((ea,
ka)=>ea.prio!==ka.prio?ka.prio-ea.prio:ea.distance!==ka.distance?ea.distance-ka.distance:ea.visible!==ka.visible?ea.visible?-1:1:ea.id-ka.id);for(let ea=Y.next();!ea.done;ea=Y.next())yield;Z.forAll(ea=>{const ka=S.get(ea.id);ka&&(S.delete(ea.id),S.set(ea.id,ka))});Z.clear()}const J=u.create(),N=m.create(),M=m.create(),Q=u.create(),O=l.create(),K=B.create(),L=y.create(),P=u.create(),R=r.create();class W{constructor(){this.aabr=r.create();this.distance=0;this.visible=this.culled=!1}}class V{constructor(S,
Z){this.graphics3DGraphic=S;this.slicePlaneEnabled=Z;this.info={}}}a.State=void 0;(function(S){S[S.Idle=0]="Idle";S[S.Process=1]="Process";S[S.Sort=2]="Sort";S[S.Deconflict=3]="Deconflict";S[S.NumStates=4]="NumStates"})(a.State||(a.State={}));class ba{constructor(){this.camera=new C;this.slicePlane=v.create();this.slicePlaneEnabled=!1}copyFrom(S){this.camera.copyFrom(S.camera);v.copy(S.slicePlane,this.slicePlane);this.slicePlaneEnabled=S.slicePlaneEnabled}}a.Deconflictor=class extends n{get dirty(){return this._dirty}get state(){return this._state}constructor(S){super(S);
this._dirty=!1;this._viewState=new ba;this._state=a.State.Idle;this._active=new Map;this._visible=new Map;this._iterators=new da;this._accBinsNumX=15;this._accBinsNumY=20;this._accBinsSizeY=this._accBinsSizeX=0;this._accBins=null;this.accNumTests=0}destroy(){this._active.clear();this._visible.clear();this._iterators=null}setDirty(){!this._dirty&&0<this._active.size&&(this._dirty=!0,this.notifyChange("updating"))}get updating(){return this._state!==a.State.Idle||this._dirty}get updatingProgress(){if(!this.updating)return 1;
const S=this._state/a.State.NumStates;return this._dirty?.5*S:S}get running(){return this.view.ready&&null!=this.view.state&&this.updating}runTask(S){switch(this._state){case a.State.Idle:this._startUpdate(),S.madeProgress();case a.State.Process:if(this._state=a.State.Process,!this._processActiveGraphics(S))break;case a.State.Sort:if(this._state=a.State.Sort,!this._sortVisibleGraphics(S))break;case a.State.Deconflict:if(this._state=a.State.Deconflict,!this._deconflictVisibleGraphics(S))break;default:z.drawAccelerationStruct(this,
this._visible),this._state=a.State.Idle,this.notifyChange("updating")}}modifyGraphics(S,Z){Z?S.forEach(ia=>this.addToActiveGraphics(ia)):S.forEach(ia=>this.removeFromActiveGraphics(ia));this.setDirty()}layerSupportsDeconfliction(S){if(null==S||"object3d"!==S.type)return!1;S=S.stageObject;return 1===(S?.geometries.length??0)&&S?.geometries[0]?.material instanceof F.HUDMaterial?!0:!1}_startUpdate(){z.prepare(this.view);this._dirty=!1;this._viewState.copyFrom(this.viewState);const {fullWidth:S,fullHeight:Z}=
this._viewState.camera;this._initBins(S,Z);this._resetIterators()}addToActiveGraphics(S){S.info[this.visibilityGroup]=new W;this._active.set(S.graphics3DGraphic.graphic.uid,S);this.setDirty()}removeFromActiveGraphics(S){this._visible.delete(S.graphics3DGraphic.graphic.uid);const Z=S.graphics3DGraphic;Z.destroyed||Z.setVisibilityFlag(this.visibilityGroup,A.VisibilityFlag.DECONFLICTION,!0);delete S.info[this.visibilityGroup];this._active.delete(S.graphics3DGraphic.graphic.uid);this.setDirty()}_processActiveGraphics(S){const Z=
this._ensureActiveGraphicsIterator(),ia=c.invertOrIdentity(O,this._viewState.camera.projectionMatrix),Y="global"===this.view.viewingMode&&1===this.view.map.ground.opacity&&0<this._viewState.camera.relativeElevation?K:null;let ea=0;null!=Y&&(x.transformMat4(B.getCenter(Y),u.ZEROS,this._viewState.camera.viewMatrix),Y[3]=q.getReferenceEllipsoid(this.view.spatialReference).radius,ea=B.distanceToSilhouette(Y,u.ZEROS));for(;!S.done;){S.madeProgress();var ka=Z.next();if(!0===ka.done)return this._resetActiveGraphicsIterator(),
!0;ka=ka.value;const ja=ka?.info[this.visibilityGroup];ja&&(this._collectGraphics3DGraphics(ka,ia,Y,ea),ja.culled?this._visible.delete(ka.graphics3DGraphic.graphic.uid):this._visible.set(ka.graphics3DGraphic.graphic.uid,ka))}return!1}_sortVisibleGraphics(S){const Z=this._ensureSortGraphicsIterator();for(;!S.done;){const ia=Z.next();S.madeProgress();if(!0===ia.done)return this._resetSortGraphicsIterator(),!0}return!1}_deconflictVisibleGraphics(S){const Z=this._ensureVisibleGraphicsIterator(),ia=this.visibilityGroup===
A.VisibilityGroup.LABEL;for(;!S.done;){S.madeProgress();var Y=Z.next();if(!0===Y.done)return this._resetVisibleGraphicsIterator(),!0;Y=Y.value;const ka=Y.info[this.visibilityGroup];if(!ka||ka.culled)this._setGraphicVisibility(Y,!1);else{var ea=Y.graphics3DGraphic;ea=!ia||ea.isVisible();ka.visible=ea&&!this._isConflicted(Y);ka.visible&&this._addToBins(Y);this._setGraphicVisibility(Y,ka.visible);z.drawPoly(ka,ka.visible)}}return!1}_resetIterators(){this._iterators.active=null;this._iterators.visible=
null;this._iterators.sort=null}_ensureActiveGraphicsIterator(){this._iterators.active||(this._iterators.active=D(this._active));return this._iterators.active}_resetActiveGraphicsIterator(){this._iterators.active=null}_ensureVisibleGraphicsIterator(){this._iterators.visible||(this._iterators.visible=D(this._visible));return this._iterators.visible}_resetVisibleGraphicsIterator(){this._iterators.visible=null}_ensureSortGraphicsIterator(){this._iterators.sort||(this._iterators.sort=I(this._visible,this._iterators.sortArray,
this.visibilityGroup));return this._iterators.sort}_resetSortGraphicsIterator(){this._iterators.sort=null}_collectGraphics3DGraphics(S,Z,ia,Y){var ea=S.graphics3DGraphic;if(!ea.destroyed){var ka=S.info[this.visibilityGroup];if(ea.isVisible(A.VisibilityGroup.GRAPHIC,A.VisibilityFlag.DECONFLICTION)){var ja=this.getGraphicsLayers(ea);r.empty(ka.aabr);ea=null;for(const la of ja)if(this.layerSupportsDeconfliction(la)){ja=la.stageObject.geometries[0].material;if(null==ea){ea=T;this._getProjectionInfo(la,
Z,ea);var X;if(!(X=ea.isOutsideScreen||this._isCulledBySlice(S,J))&&(X=null!=ia)){X=ea;var aa=ia,pa=Y;x.copy(L.direction,X.positionView);x.set(L.origin,0,0,0);X=B.intersectRay(aa,L,P)?X.distanceWithoutPolygonOffset>pa:!1}if(X){ka.culled=!0;return}}this._expandBoundingRect(ka,la,ja,ea)}null==ea?ka.culled=!0:(ka.distance=ea.distance,ka.culled=!1)}else ka.culled=!0}}_getProjectionInfo(S,Z,ia){const Y=this._viewState.camera;S=S.stageObject;var ea=S.geometries[0];const ka=ea.material;var ja=B.getCenter(S.boundingVolumeWorldSpace.bounds);
x.transformMat4(J,ja,Y.viewMatrix);ja=ea.attributes;ea=ja.get(E.VertexAttribute.NORMAL).data;ja=ja.get(E.VertexAttribute.CENTEROFFSETANDDISTANCE).data;ka.applyShaderOffsetsView(J,ea,S.transformation,ja,Y,ia.scaleInfo,J);t.set(N,J[0],J[1],J[2],1);t.transformMat4(M,N,Y.projectionMatrix);x.scale(ia.positionNDC,M,1/M[3]);ka.applyShaderOffsetsNDC(ia.positionNDC,ja,Y,ia.positionNDC,Q);ia.distanceWithoutPolygonOffset=Y.depthNDCToWorld(Q[2]);ia.distance=Q[2]===ia.positionNDC[2]?ia.distanceWithoutPolygonOffset:
Y.depthNDCToWorld(ia.positionNDC[2]);t.set(M,ia.positionNDC[0],ia.positionNDC[1],ia.positionNDC[2],1);t.transformMat4(N,M,Z);t.scale(N,N,1/N[3]);x.set(ia.positionView,J[0],J[1],J[2])}_isCulledBySlice(S,Z){return S.slicePlaneEnabled&&this._viewState.slicePlaneEnabled&&v.extrusionContainsPoint(this._viewState.slicePlane,Z)}_expandBoundingRect(S,Z,ia,{positionNDC:Y,scaleInfo:ea}){const ka=this._viewState.camera;Z=Z.getScreenSize(fa);H.applyPrecomputedScaleFactor(Z,ea.factor,Z);Z[0]*=ka.pixelRatio;Z[1]*=
ka.pixelRatio;ia=r.offset(ia.calculateRelativeScreenBounds(Z,ea.factorAlignment.scale,R),k.lerp(0,ka.fullWidth,.5+.5*Y[0]),k.lerp(0,ka.fullHeight,.5+.5*Y[1]));Y=this.marginFactor;0!==Y&&(Y*=Math.min(r.width(ia),r.height(ia)),ia[0]-=Y,ia[1]-=Y,ia[2]+=Y,ia[3]+=Y);r.expand(S.aabr,ia,S.aabr)}_isConflicted(S){const Z=S.graphics3DGraphic.graphic.uid;S=S.info[this.visibilityGroup];let ia=!0;for(let Y=Math.floor(S.aabr[0]/this._accBinsSizeX);Y<=Math.floor(S.aabr[2]/this._accBinsSizeX);Y++)if(!(0>Y||Y>=this._accBinsNumX))for(let ea=
Math.floor(S.aabr[1]/this._accBinsSizeY);ea<=Math.floor(S.aabr[3]/this._accBinsSizeY);ea++){if(0>ea||ea>=this._accBinsNumY)continue;ia=!1;const ka=this._accBins[Y][ea];for(let ja=0;ja<ka.length;ja++){const X=ka.data[ja],aa=X.info[this.visibilityGroup];if(aa&&aa.visible&&X.graphics3DGraphic.graphic.uid!==Z&&(this.accNumTests++,r.intersects(aa.aabr,S.aabr)))return!0}}return ia}_initBins(S,Z){if(null==this._accBins){this._accBins=[];for(var ia=0;ia<this._accBinsNumX;ia++){this._accBins.push([]);var Y=
this._accBins[this._accBins.length-1];for(let ea=0;ea<this._accBinsNumY;ea++)Y.push(new p)}}else for(ia=0;ia<this._accBinsNumX;ia++)for(Y=0;Y<this._accBinsNumY;Y++)this._accBins[ia][Y].clear();this._accBinsSizeX=S/this._accBinsNumX;this._accBinsSizeY=Z/this._accBinsNumY;this.accNumTests=0}_addToBins(S){var Z=S.info[this.visibilityGroup],ia=Math.floor(Z.aabr[0]/this._accBinsSizeX);const Y=Math.floor(Z.aabr[2]/this._accBinsSizeX),ea=Math.floor(Z.aabr[1]/this._accBinsSizeY);for(Z=Math.floor(Z.aabr[3]/
this._accBinsSizeY);ia<=Y;ia++)if(!(0>ia||ia>=this._accBinsNumX))for(let ka=ea;ka<=Z;ka++)0>ka||ka>=this._accBinsNumY||this._accBins[ia][ka].push(S)}_setGraphicVisibility(S,Z){S=S.graphics3DGraphic;S.destroyed||(S.setVisibilityFlag(this.visibilityGroup,A.VisibilityFlag.DECONFLICTION,Z),this.visibilityGroup===A.VisibilityGroup.LABEL&&this.view.labeler.setLabelGraphicVisibility(S,Z))}};b.__decorate([h.property({constructOnly:!0})],a.Deconflictor.prototype,"view",void 0);b.__decorate([h.property({type:Boolean,
readOnly:!0})],a.Deconflictor.prototype,"updating",null);a.Deconflictor=b.__decorate([f.subclass("esri.views.3d.layers.graphics.Deconflictor")],a.Deconflictor);class U{constructor(){this.id=0;this.visible=!1;this.distance=this.prio=0}}class da{constructor(S=null,Z=null,ia=null){this.active=S;this.visible=Z;this.sort=ia;this.sortArray=new p({allocator:Y=>Y||new U})}}const fa=w.create();class ha{constructor(){this.positionView=u.create();this.positionNDC=u.create();this.distanceWithoutPolygonOffset=
this.distance=0;this.scaleInfo=new G.ScaleInfo}get isOutsideScreen(){const S=this.positionNDC;return-1>S[0]||-1>S[1]||-1>S[2]||1<=S[0]||1<=S[1]}}const T=new ha;a.DeconflictorGraphic=V;a.DeconflictorViewState=ba;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/deconflictorDebug":function(){define(["exports","../../support/debugFlags"],function(a,b){function n(c,l,w,x,u){g&&(g(),g=null);const t=d.height,m=f;m.beginPath();m.lineWidth=1;m.strokeStyle=u;m.moveTo(c,
t-w);m.lineTo(l,t-w);m.stroke();m.lineTo(l,t-x);m.stroke();m.lineTo(l,t-w);m.stroke();m.lineTo(c,t-w);m.stroke();m.lineTo(c,t-w);m.stroke();m.closePath()}let k=!1,p=!1,h=!1,e=!1,g=null,d,f;a.drawAccelerationStruct=function(c,l){if(p&&f){g&&(g(),g=null);var w=f,x=0;for(let u=0;u<c.accBinsNumX;u++)for(let t=0;t<c.accBinsNumY;t++){const m=c.accBins[u][c.accBinsNumY-1-t];x+=m.length;const q=u*c.accBinsSizeX,r=(u+1)*c.accBinsSizeX,v=t*c.accBinsSizeY,y=(t+1)*c.accBinsSizeY;w.fillText(m.length.toFixed(),
q+5,v+15);n(q,r,v,y,"blue")}w.fillText("total totalShownLabels: "+x,70,40);w.fillText("total visible labels: "+l.size,70,50);w.fillText("total numTests: "+c.accNumTests,70,30)}};a.drawPoly=function(c,l){k&&(l&&h||!l&&e)&&n(c.aabr[0],c.aabr[2],c.aabr[1],c.aabr[3],l?"green":"red")};a.prepare=function(c){h=b.debugFlags.DECONFLICTOR_SHOW_VISIBLE;e=b.debugFlags.DECONFLICTOR_SHOW_INVISIBLE;k=h||e;p=b.debugFlags.DECONFLICTOR_SHOW_GRID;g=null;k||p?g=()=>{null==d&&(d=document.createElement("canvas"),d.setAttribute("id",
"debugCanvas2d"),c.surface.parentElement.style.position="relative",c.surface.parentElement.appendChild(d));var {state:l}=c;const {camera:w,pixelRatio:x}=l,{width:u,height:t}=w;l=t*x;d.setAttribute("width",`${u*x}px`);d.setAttribute("height",`${l}px`);d.setAttribute("style",`position:absolute;left:0px;top:0px;display:block;pointer-events:none;width:${u}px;height:${t}px`);f=d.getContext("2d");f.clearRect(0,0,u,t);f.font="12px Arial"}:d&&(d.parentElement.removeChild(d),d=null)};Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/debugFlags":function(){define("exports ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass".split(" "),function(a,b,n,k,p,h,e,g){n=class extends n{constructor(){super(...arguments);this.LINE_WIREFRAMES=this.EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES=this.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL=
this.LOD_INSTANCE_RENDERER_DISABLE_UPDATES=this.I3S_SHOW_MODIFICATIONS=this.I3S_TREE_SHOW_TILES=this.TERRAIN_TILE_TREE_SHOW_TILES=this.FEATURE_TILE_TREE_SHOW_TILES=this.FEATURE_TILE_FETCH_SHOW_TILES=this.DRAW_MESH_GEOMETRY_NORMALS=this.TESTS_DISABLE_FAST_UPDATES=this.TESTS_DISABLE_OPTIMIZATIONS=this.SHOW_POI=this.OVERLAY_SHOW_CENTER=this.OVERLAY_DRAW_DEBUG_TEXTURE=this.TEXT_SHOW_BORDER=this.TEXT_SHOW_BASELINE=this.LABELS_SHOW_BORDER=this.DECONFLICTOR_SHOW_GRID=this.DECONFLICTOR_SHOW_INVISIBLE=this.DECONFLICTOR_SHOW_VISIBLE=
this.SCENEVIEW_HITTEST_RETURN_INTERSECTOR=!1}};b.__decorate([k.property()],n.prototype,"SCENEVIEW_HITTEST_RETURN_INTERSECTOR",void 0);b.__decorate([k.property()],n.prototype,"DECONFLICTOR_SHOW_VISIBLE",void 0);b.__decorate([k.property()],n.prototype,"DECONFLICTOR_SHOW_INVISIBLE",void 0);b.__decorate([k.property()],n.prototype,"DECONFLICTOR_SHOW_GRID",void 0);b.__decorate([k.property()],n.prototype,"LABELS_SHOW_BORDER",void 0);b.__decorate([k.property()],n.prototype,"TEXT_SHOW_BASELINE",void 0);b.__decorate([k.property()],
n.prototype,"TEXT_SHOW_BORDER",void 0);b.__decorate([k.property()],n.prototype,"OVERLAY_DRAW_DEBUG_TEXTURE",void 0);b.__decorate([k.property()],n.prototype,"OVERLAY_SHOW_CENTER",void 0);b.__decorate([k.property()],n.prototype,"SHOW_POI",void 0);b.__decorate([k.property()],n.prototype,"TESTS_DISABLE_OPTIMIZATIONS",void 0);b.__decorate([k.property()],n.prototype,"TESTS_DISABLE_FAST_UPDATES",void 0);b.__decorate([k.property()],n.prototype,"DRAW_MESH_GEOMETRY_NORMALS",void 0);b.__decorate([k.property()],
n.prototype,"FEATURE_TILE_FETCH_SHOW_TILES",void 0);b.__decorate([k.property()],n.prototype,"FEATURE_TILE_TREE_SHOW_TILES",void 0);b.__decorate([k.property()],n.prototype,"TERRAIN_TILE_TREE_SHOW_TILES",void 0);b.__decorate([k.property()],n.prototype,"I3S_TREE_SHOW_TILES",void 0);b.__decorate([k.property()],n.prototype,"I3S_SHOW_MODIFICATIONS",void 0);b.__decorate([k.property()],n.prototype,"LOD_INSTANCE_RENDERER_DISABLE_UPDATES",void 0);b.__decorate([k.property()],n.prototype,"LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL",
void 0);b.__decorate([k.property()],n.prototype,"EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES",void 0);b.__decorate([k.property()],n.prototype,"LINE_WIREFRAMES",void 0);n=b.__decorate([g.subclass("esri.views.3d.support.debugFlags")],n);b=new n;a.debugFlags=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/enums":function(){define(["exports"],function(a){a.VisibilityFlag=void 0;(function(b){b[b.USER=1]="USER";b[b.SCALE_RANGE=2]="SCALE_RANGE";b[b.FILTER=4]="FILTER";
b[b.DECONFLICTION=8]="DECONFLICTION";b[b.ALL_GRAPHIC=15]="ALL_GRAPHIC";b[b.ALL_LABEL=255]="ALL_LABEL"})(a.VisibilityFlag||(a.VisibilityFlag={}));a.VisibilityGroup=void 0;(function(b){b[b.GRAPHIC=1]="GRAPHIC";b[b.LABEL=16]="LABEL"})(a.VisibilityGroup||(a.VisibilityGroup={}));Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/screenSizePerspectiveUtils":function(){define(["exports","../../../../core/mathUtils","../../../../chunks/boundedPlane","../../../../chunks/sphere",
"../../../ViewingMode"],function(a,b,n,k,p){function h(w,x,u){u=u.parameters;f.scale=Math.min(u.divisor/(x-u.offset),1);f.factor=Math.abs(w*w*w);return f}function e(w,x){return b.lerp(w*Math.max(x.scale,x.minScaleFactor),w,x.factor)}class g{get minScaleFactor(){return null!=this._fontHeight?Math.min(this._description.minPixelSize/this._fontHeight,1):0}constructor(w,x,u,t={camera:{distance:0,fovY:0},divisor:0,offset:0},m){this._viewingMode=w;this._description=x;this._ellipsoidRadius=u;this.parameters=
t;this._fontHeight=m;this._viewingMode===p.ViewingMode.Local?(this._coverageCompensation=this._surfaceCoverageCompensationLocal,this._calculateCurvatureDependentParameters=this._calculateCurvatureDependentParametersLocal):(this._coverageCompensation=this._surfaceCoverageCompensationGlobal,this._calculateCurvatureDependentParameters=this._calculateCurvatureDependentParametersGlobal)}update(w){if(this.parameters&&this.parameters.camera.fovY===w.fovY&&this.parameters.camera.distance===w.distance)return!1;
this._calculateParameters(w,this._ellipsoidRadius,this.parameters);return!0}overrideFontHeight(w){return w!==this._fontHeight?new g(this._viewingMode,this._description,this._ellipsoidRadius,this.parameters,w):this}_calculateParameters(w,x,u){const {scaleStart:t,scaleFallOffRange:m}=this._description,{fovY:q,distance:r}=w;var v=this._calculateCurvatureDependentParameters(w,x);x=this._coverageCompensation(w,x,v);const {tiltAngle:y,scaleFallOffFactor:B}=v,z=Math.sin(y)*r,A=.5*Math.PI-y-q*(.5-t*x);v=
z/Math.cos(A);x=(v-z/Math.cos(A+q*m*x)*B)/(1-B);u.camera.fovY=w.fovY;u.camera.distance=w.distance;u.offset=x;u.divisor=v-x;return u}_calculateCurvatureDependentParametersLocal(w,x,u=c){u.tiltAngle=this._description.curvatureDependent.min.tiltAngle;u.scaleFallOffFactor=this._description.curvatureDependent.min.scaleFallOffFactor;return u}_calculateCurvatureDependentParametersGlobal(w,x,u=c){const t=this._description.curvatureDependent;w=1+w.distance/x;w=Math.sqrt(w*w-1);const [m,q]=[t.min.curvature,
t.max.curvature];w=b.clamp((w-m)/(q-m),0,1);const [r,v]=[t.min,t.max];u.tiltAngle=b.lerp(r.tiltAngle,v.tiltAngle,w);u.scaleFallOffFactor=b.lerp(r.scaleFallOffFactor,v.scaleFallOffFactor,w);return u}_surfaceCoverageCompensationLocal(w,x,u){return n.cameraFrustumCoverage(u.tiltAngle,w.fovY)}_surfaceCoverageCompensationGlobal(w,x,u){k.fromRadius(l,x);return k.cameraFrustumCoverage(l,u.tiltAngle,w.distance,w.fovY)}}const d={curvatureDependent:{min:{curvature:b.deg2rad(10),tiltAngle:b.deg2rad(12),scaleFallOffFactor:.5},
max:{curvature:b.deg2rad(70),tiltAngle:b.deg2rad(40),scaleFallOffFactor:.8}},scaleStart:.3,scaleFallOffRange:.65,minPixelSize:0},f={scale:0,factor:0,minScaleFactor:0},c={tiltAngle:0,scaleFallOffFactor:0},l=k.create();a.applyPrecomputedScaleFactor=function(w,x,u=[0,0]){x=Math.min(Math.max(x.scale,x.minScaleFactor),1);u[0]=w[0]*x;u[1]=w[1]*x;return u};a.applyScaleFactor=e;a.getLabelSettings=function(w,x){const {curvatureDependent:u,scaleStart:t,scaleFallOffRange:m}=d;return new g(w,{curvatureDependent:{min:{curvature:u.min.curvature,
tiltAngle:u.min.tiltAngle,scaleFallOffFactor:.7},max:{curvature:u.max.curvature,tiltAngle:u.max.tiltAngle,scaleFallOffFactor:.95}},scaleStart:t,scaleFallOffRange:m,minPixelSize:14},x)};a.getSettings=function(w,x){return new g(w,d,x)};a.precomputeScaleFactor=function(w,x,u,t){w=h(w,x,u);w.minScaleFactor=0;w=e(1,w);t.scale=w;t.factor=0;t.minScaleFactor=u.minScaleFactor};a.scale=function(w,x,u,t){return e(w,h(x,u,t))};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/HUDMaterial":function(){define("exports ../../../../core/mathUtils ../../../../core/libs/gl-matrix-2/math/mat3 ../../../../core/libs/gl-matrix-2/factories/mat3f64 ../../../../core/libs/gl-matrix-2/math/mat4 ../../../../core/libs/gl-matrix-2/factories/mat4f64 ../../../../core/libs/gl-matrix-2/math/vec2 ../../../../core/libs/gl-matrix-2/factories/vec2f64 ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../core/libs/gl-matrix-2/factories/vec4f64 ../../../../core/libs/gl-matrix-2/types/mat4 ../../../../geometry/support/aaBoundingRect ../../../../geometry/support/buffer/BufferView ../../layers/support/FastSymbolUpdates ../../support/debugFlags ../../support/buffer/InterleavedLayout ../core/shaderLibrary/ShaderOutput ../core/shaderLibrary/hud/HUD.glsl ../core/shaderLibrary/util/AlphaCutoff ../effects/geometry/olidUtils ../lib/GLTextureMaterial ../lib/Material ../lib/RenderSlot ../lib/screenSizePerspectiveUtils ../lib/Util ../lib/VertexAttribute ./ScaleInfo ./internal/bufferWriterUtils ./internal/MaterialUtil ../../../../chunks/HUDMaterial.glsl ../shaders/HUDMaterialTechnique ../shaders/HUDMaterialTechniqueConfiguration".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w,x,u,t,m,q,r,v,y,B,z,A,C,H,E,F,G,D,I,J,N){function M(la,na,qa,sa){l.isMat4(na)&&(na=n.fromMat4(ha,na));d.transformMat3(sa.normal,la,na);d.transformMat4(sa.normal,sa.normal,qa.viewInverseTransposeMatrix);sa.cosAngle=d.dot(V,ka);return sa}function Q(la,na,qa,sa,xa,ta,Ba,Ia,Ca){let Ha=na-xa-sa[0]*Ca[0],Ga=Ha+sa[0]+2*xa;Ca=qa-xa-sa[1]*Ca[1];xa=Ca+sa[1]+2*xa;const Aa=Ia.distanceFieldBoundingBox;Ia.textureIsSignedDistanceField&&null!=Aa&&(Ha+=sa[0]*Aa[0],Ca+=sa[1]*Aa[1],
Ga-=sa[0]*(1-Aa[2]),xa-=sa[1]*(1-Aa[3]),Ha-=ta,Ga+=ta,Ca-=ta,xa+=ta);e.set(da,na,qa);e.rotate(U,la,da,b.deg2rad(Ba));return U[0]>Ha&&U[0]<Ga&&U[1]>Ca&&U[1]<xa}class O extends z.Material{constructor(la,na){super(la,ja);this.produces=new Map([[A.RenderSlot.HUD_MATERIAL,qa=>q.isColorHighlightOrOID(qa)&&!this.parameters.drawInSecondSlot],[A.RenderSlot.LABEL_MATERIAL,qa=>q.isColorHighlightOrOID(qa)&&this.parameters.drawInSecondSlot],[A.RenderSlot.OCCLUSION_PIXELS,()=>this.parameters.occlusionTest],[A.RenderSlot.DRAPED_MATERIAL,
qa=>this.parameters.draped&&q.isColorHighlightOrOID(qa)]]);this._visible=!0;this._configuration=new N.HUDMaterialTechniqueConfiguration(na)}getConfiguration(la,na){this._configuration.output=la;this._configuration.hasSlicePlane=this.parameters.hasSlicePlane;this._configuration.hasVerticalOffset=!!this.parameters.verticalOffset;this._configuration.hasScreenSizePerspective=!!this.parameters.screenSizePerspective;this._configuration.screenCenterOffsetUnitsEnabled="screen"===this.parameters.centerOffsetUnits;
this._configuration.hasPolygonOffset=this.parameters.polygonOffset;this._configuration.draped=this.parameters.draped;this._configuration.occlusionTestEnabled=this.parameters.occlusionTest;this._configuration.pixelSnappingEnabled=this.parameters.pixelSnappingEnabled;this._configuration.signedDistanceFieldEnabled=this.parameters.textureIsSignedDistanceField;this._configuration.sampleSignedDistanceFieldTexelCenter=this.parameters.sampleSignedDistanceFieldTexelCenter;this._configuration.hasRotation=this.parameters.hasRotation;
this._configuration.vvSize=!!this.parameters.vvSize;this._configuration.vvColor=!!this.parameters.vvColor;this._configuration.occlusionPass=na.slot===A.RenderSlot.OCCLUSION_PIXELS;this._configuration.occludedFragmentFade=this.parameters.occludedFragmentFade;this._configuration.horizonCullingEnabled=this.parameters.horizonCullingEnabled;this._configuration.depthTestEnabled=this.parameters.depthEnabled||na.slot===A.RenderSlot.OCCLUSION_PIXELS;la===q.ShaderOutput.Color&&(this._configuration.debugDrawLabelBorder=
!!t.debugFlags.LABELS_SHOW_BORDER);this._configuration.oitPass=na.oitPass;this._configuration.terrainDepthTest=na.terrainDepthTest;this._configuration.cullAboveTerrain=na.cullAboveTerrain;return this._configuration}intersect(la,na,qa,sa,xa,ta){const {options:{selectionMode:Ba,hud:Ia,excludeLabels:Ca},point:Ha,camera:Ga}=qa;({parameters:sa}=this);if(Ba&&Ia&&(!Ca||!sa.isLabel)&&la.visible&&Ha){var {scaleX:Aa,scaleY:Ja}=this._getScreenScale(la,Ga.pixelRatio);n.fromMat4(fa,na);if(la.attributes.has(E.VertexAttribute.FEATUREATTRIBUTE)){xa=
fa;var Sa=xa[0],$a=xa[1],Wa=xa[2],Ta=xa[3],Da=xa[4],La=xa[5],Va=xa[6],ma=xa[7],za=xa[8];const Na=1/Math.sqrt(Sa*Sa+$a*$a+Wa*Wa),Ra=1/Math.sqrt(Ta*Ta+Da*Da+La*La),Pa=1/Math.sqrt(Va*Va+ma*ma+za*za);xa[0]=Sa*Na;xa[1]=$a*Na;xa[2]=Wa*Na;xa[3]=Ta*Ra;xa[4]=Da*Ra;xa[5]=La*Ra;xa[6]=Va*Pa;xa[7]=ma*Pa;xa[8]=za*Pa}xa=la.attributes.get(E.VertexAttribute.POSITION);Sa=la.attributes.get(E.VertexAttribute.SIZE);$a=la.attributes.get(E.VertexAttribute.NORMAL);Wa=la.attributes.get(E.VertexAttribute.ROTATION);la=la.attributes.get(E.VertexAttribute.CENTEROFFSETANDDISTANCE);
H.assert(3<=xa.size);Ta=I.calculateAnchorPosForRendering(sa);Da="screen"===this.parameters.centerOffsetUnits;for(La=0;La<xa.data.length/xa.size;La++)Va=La*xa.size,d.set(P,xa.data[Va],xa.data[Va+1],xa.data[Va+2]),d.transformMat4(P,P,na),d.transformMat4(P,P,Ga.viewMatrix),Va=La*la.size,d.set(S,la.data[Va],la.data[Va+1],la.data[Va+2]),Da||(P[0]+=S[0],P[1]+=S[1],0!==S[2]&&(Va=S[2],d.normalize(S,P),d.subtract(P,P,d.scale(S,S,Va)))),Va=La*$a.size,d.set(R,$a.data[Va],$a.data[Va+1],$a.data[Va+2]),M(R,fa,
Ga,Y),this._applyVerticalOffsetTransformationView(P,Y,Ga,L),Ga.applyProjection(P,W),-1<W[0]&&(Da&&(S[0]||S[1])&&(W[0]+=S[0]*Ga.pixelRatio,0!==S[1]&&(W[1]+=C.applyScaleFactor(S[1],L.factorAlignment)*Ga.pixelRatio),Ga.unapplyProjection(W,P)),W[0]+=this.parameters.screenOffset[0]*Ga.pixelRatio,W[1]+=this.parameters.screenOffset[1]*Ga.pixelRatio,W[0]=Math.floor(W[0]),W[1]=Math.floor(W[1]),Va=La*Sa.size,ea[0]=Sa.data[Va],ea[1]=Sa.data[Va+1],C.applyPrecomputedScaleFactor(ea,L.factor,ea),Va=1*Ga.pixelRatio,
ma=0,sa.textureIsSignedDistanceField&&(ma=Math.min(sa.outlineSize,.5*ea[0])*Ga.pixelRatio/2),ea[0]*=Aa,ea[1]*=Ja,Q(Ha,W[0],W[1],ea,Va,ma,sa.rotation+Wa.data[La*Wa.size],sa,Ta)&&(ma=qa.ray,d.transformMat4(ba,P,p.invert(T,Ga.viewMatrix)),W[0]=Ha[0],W[1]=Ha[1],Ga.unprojectFromRenderScreen(W,P)&&(Va=f.create(),d.copy(Va,ma.direction),za=1/d.length(Va),d.scale(Va,Va,za),ma=d.distance(ma.origin,P)*za,ta(ma,Va,-1,!0,1,ba))))}}intersectDraped(la,na,qa,sa,xa,ta){na=la.attributes.get(E.VertexAttribute.POSITION);
qa=la.attributes.get(E.VertexAttribute.SIZE);const Ba=la.attributes.get(E.VertexAttribute.ROTATION),Ia=this.parameters,Ca=I.calculateAnchorPosForRendering(Ia),{scaleX:Ha,scaleY:Ga}=this._getScreenScale(la,la.screenToWorldRatio),Aa=2*la.screenToWorldRatio;for(let $a=0;$a<na.data.length/na.size;$a++){var Ja=$a*na.size;const Wa=na.data[Ja];Ja=na.data[Ja+1];var Sa=$a*qa.size;ea[0]=qa.data[Sa];ea[1]=qa.data[Sa+1];Sa=0;Ia.textureIsSignedDistanceField&&(Sa=Math.min(Ia.outlineSize,.5*ea[0])*la.screenToWorldRatio/
2);ea[0]*=Ha;ea[1]*=Ga;Q(sa,Wa,Ja,ea,Aa,Sa,Ia.rotation+Ba.data[$a*Ba.size],Ia,Ca)&&xa(ta.dist,ta.normal,-1,!1)}}createBufferWriter(){return new pa}_updateScaleInfo(la,na,qa){const sa=this.parameters;null!=sa.screenSizePerspective?C.precomputeScaleFactor(qa,na,sa.screenSizePerspective,la.factor):(la.factor.scale=1,la.factor.factor=0,la.factor.minScaleFactor=0);null!=sa.screenSizePerspectiveAlignment?C.precomputeScaleFactor(qa,na,sa.screenSizePerspectiveAlignment,la.factorAlignment):(la.factorAlignment.factor=
la.factor.factor,la.factorAlignment.scale=la.factor.scale,la.factorAlignment.minScaleFactor=la.factor.minScaleFactor)}applyShaderOffsetsView(la,na,qa,sa,xa,ta,Ba){na=M(na,qa,xa,Y);this._applyVerticalGroundOffsetView(la,na,xa,Ba);this._applyVerticalOffsetTransformationView(Ba,na,xa,ta);this._applyPolygonOffsetView(Ba,na,sa[3],xa,Ba);this._applyCenterOffsetView(Ba,sa,Ba);return Ba}applyShaderOffsetsNDC(la,na,qa,sa,xa){this._applyCenterOffsetNDC(la,na,qa,sa);null!=xa&&d.copy(xa,sa);this._applyPolygonOffsetNDC(sa,
na,qa,sa);return sa}_applyPolygonOffsetView(la,na,qa,sa,xa){var ta=sa.aboveGround?1:-1;qa=Math.sign(qa);0===qa&&(qa=ta);ta*=qa;if(0>=this.parameters.shaderPolygonOffset)return d.copy(xa,la);na=b.clamp(Math.abs(na.cosAngle),.01,1);sa=1-Math.sqrt(1-na*na)/na/sa.viewport[2];0<ta?d.scale(xa,la,sa):d.scale(xa,la,1/sa);return xa}_applyVerticalGroundOffsetView(la,na,qa,sa){const xa=d.length(la),ta=qa.aboveGround?1:-1;qa=qa.computeRenderPixelSizeAtDist(xa)*r.HUDVerticalPixelOffset;na=d.scale(P,na.normal,
ta*qa);d.add(sa,la,na);return sa}_applyVerticalOffsetTransformationView(la,na,qa,sa){const xa=this.parameters;if(!xa.verticalOffset?.screenLength){if(xa.screenSizePerspective||xa.screenSizePerspectiveAlignment){var ta=d.length(la);this._updateScaleInfo(sa,ta,na.cosAngle)}else sa.factor.scale=1,sa.factorAlignment.scale=1;return la}ta=d.length(la);qa=D.verticalOffsetAtDistance(qa,ta,xa.verticalOffset,na.cosAngle,xa.screenSizePerspectiveAlignment??xa.screenSizePerspective);this._updateScaleInfo(sa,ta,
na.cosAngle);d.scale(na.normal,na.normal,qa);return d.add(la,la,na.normal)}_applyCenterOffsetView(la,na,qa){const sa="screen"!==this.parameters.centerOffsetUnits;qa!==la&&d.copy(qa,la);sa&&(qa[0]+=na[0],qa[1]+=na[1],na[2]&&(d.normalize(R,qa),d.add(qa,qa,d.scale(R,R,na[2]))));return qa}_applyCenterOffsetNDC(la,na,qa,sa){const xa="screen"!==this.parameters.centerOffsetUnits;sa!==la&&d.copy(sa,la);xa||(sa[0]+=na[0]/qa.fullWidth*2,sa[1]+=na[1]/qa.fullHeight*2);return sa}_applyPolygonOffsetNDC(la,na,qa,
sa){const xa=this.parameters.shaderPolygonOffset;la!==sa&&d.copy(sa,la);xa&&(la=qa.aboveGround?1:-1,sa[2]-=(la*Math.sign(na[3])||la)*xa);return sa}set visible(la){this._visible=la}get visible(){const {color:la,outlineSize:na,outlineColor:qa}=this.parameters,sa=la[3]>=v.alphaCutoff||na>=v.alphaCutoff&&qa[3]>=v.alphaCutoff;return this._visible&&sa}createGLMaterial(la){return new K(la)}calculateRelativeScreenBounds(la,na,qa=w.create()){var sa=this.parameters;qa[0]=sa.anchorPosition[0]*-la[0]+sa.screenOffset[0]*
na;qa[1]=sa.anchorPosition[1]*-la[1]+sa.screenOffset[1]*na;qa[2]=qa[0]+la[0];qa[3]=qa[1]+la[1];return qa}_getScreenScale(la,na){la=la.attributes.get(E.VertexAttribute.FEATUREATTRIBUTE);if(null==la)return{scaleX:na,scaleY:na};la=c.fromArray(la.data,ia);u.evaluateModelTransformScale(Z,this.parameters,la);return{scaleX:Z[0]*na,scaleY:Z[1]*na}}}class K extends B.GLTextureMaterial{constructor(la){super({...la,...la.material.parameters})}beginSlot(la){this.updateTexture(this._material.parameters.textureId);
this._material.setParameters(this.textureBindParameters);return this.acquireTechnique(J.HUDMaterialTechnique,la)}}const L=new F.ScaleInfo,P=f.create(),R=f.create(),W=c.create(),V=f.create(),ba=f.create(),U=g.create(),da=g.create(),fa=k.create(),ha=k.create(),T=h.create(),S=f.create(),Z=f.create(),ia=c.create(),Y={normal:V,cosAngle:0},ea=[0,0],ka=f.fromValues(0,0,1);class ja extends B.GLTextureMaterialBindParameters{constructor(){super(...arguments);this.renderOccluded=z.RenderOccludedFlag.Occlude;
this.isDecoration=!1;this.color=c.freeze(1,1,1,1);this.polygonOffset=!1;this.anchorPosition=g.fromValues(.5,.5);this.screenOffset=[0,0];this.shaderPolygonOffset=1E-5;this.sampleSignedDistanceFieldTexelCenter=this.textureIsSignedDistanceField=!1;this.outlineColor=c.freeze(1,1,1,1);this.rotation=this.outlineSize=0;this.vvSizeEnabled=this.hasRotation=!1;this.vvSymbolRotationMatrix=this.vvSymbolAnchor=this.vvOpacity=this.vvColor=this.vvSize=null;this.hasSlicePlane=!1;this.occlusionTest=this.pixelSnappingEnabled=
!0;this.horizonCullingEnabled=this.occludedFragmentFade=!1;this.centerOffsetUnits="world";this.drawInSecondSlot=!1;this.depthEnabled=!0;this.isLabel=this.draped=!1}}const X=m.newLayout().vec3f(E.VertexAttribute.POSITION).vec3f(E.VertexAttribute.NORMAL).vec2f(E.VertexAttribute.UV0).vec4u8(E.VertexAttribute.COLOR).vec2f(E.VertexAttribute.SIZE).f32(E.VertexAttribute.ROTATION).vec4f(E.VertexAttribute.CENTEROFFSETANDDISTANCE).vec4f(E.VertexAttribute.FEATUREATTRIBUTE),aa=X.clone().vec4u8(E.VertexAttribute.OBJECTANDLAYERIDCOLOR);
class pa{constructor(){this.vertexBufferLayout=y.olidEnabled()?aa:X}elementCount(la){return 6*la.get(E.VertexAttribute.POSITION).indices.length}write(la,na,qa,sa,xa,ta){G.writePosition(qa.get(E.VertexAttribute.POSITION),la,xa.position,ta,6);G.writeNormal(qa.get(E.VertexAttribute.NORMAL),na,xa.normal,ta,6);la=qa.get(E.VertexAttribute.UV0)?.data;var Ba=0,Ia=0,Ca=1,Ha=1;la&&4<=la.length&&(Ba=la[0],Ia=la[1],Ca=la[2],Ha=la[3]);Ca=Math.min(1.99999,Ca+1);Ha=Math.min(1.99999,Ha+1);la=qa.get(E.VertexAttribute.POSITION).indices.length;
na=ta;var Ga=xa.uv0;for(let Sa=0;Sa<la;++Sa)Ga.set(na,0,Ba),Ga.set(na,1,Ia),na++,Ga.set(na,0,Ca),Ga.set(na,1,Ia),na++,Ga.set(na,0,Ca),Ga.set(na,1,Ha),na++,Ga.set(na,0,Ca),Ga.set(na,1,Ha),na++,Ga.set(na,0,Ba),Ga.set(na,1,Ha),na++,Ga.set(na,0,Ba),Ga.set(na,1,Ia),na++;G.writeColor(qa.get(E.VertexAttribute.COLOR),4,xa.color,ta,6);const {data:Aa,indices:Ja}=qa.get(E.VertexAttribute.SIZE);la=Ja.length;Ba=xa.size;na=ta;for(Ia=0;Ia<la;++Ia)for(Ca=Aa[2*Ja[Ia]],Ha=Aa[2*Ja[Ia]+1],Ga=0;6>Ga;++Ga)Ba.set(na,0,
Ca),Ba.set(na,1,Ha),na++;G.writeBufferFloat(qa.get(E.VertexAttribute.ROTATION),xa.rotation,ta,6);qa.get(E.VertexAttribute.CENTEROFFSETANDDISTANCE)?G.writeBufferVec4(qa.get(E.VertexAttribute.CENTEROFFSETANDDISTANCE),xa.centerOffsetAndDistance,ta,6):G.writeBufferVec4Zeros(xa.centerOffsetAndDistance,ta,6*la);qa.get(E.VertexAttribute.FEATUREATTRIBUTE)?G.writeBufferVec4(qa.get(E.VertexAttribute.FEATUREATTRIBUTE),xa.featureAttribute,ta,6):G.writeBufferVec4Zeros(xa.featureAttribute,ta,6*la);null!=sa&&(qa=
qa.get(E.VertexAttribute.POSITION)?.indices)&&(qa=qa.length,xa=xa.getField(E.VertexAttribute.OBJECTANDLAYERIDCOLOR,x.BufferViewVec4u8),G.writeObjectAndLayerIdColor(sa,xa,qa,ta,6))}}a.HUDMaterial=O;a.Parameters=ja;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/libs/gl-matrix-2/types/mat4":function(){define(["exports"],function(a){function b(k){return k instanceof Float32Array&&16<=k.length}function n(k){return Array.isArray(k)&&16<=k.length}a.isMat4=function(k){return b(k)||
n(k)};a.isMat4f32=b;a.isMat4f64=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/support/FastSymbolUpdates":function(){define("exports ../../../../core/has ../../../../core/mathUtils ../../../../core/libs/gl-matrix-2/math/mat3 ../../../../core/libs/gl-matrix-2/factories/mat3f64 ../../../../core/libs/gl-matrix-2/math/mat4 ../../../../core/libs/gl-matrix-2/factories/mat4f64 ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../renderers/support/lengthUtils ../../support/debugFlags ../../webgl-engine/core/shaderModules/interfaces".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l){function w(V){return null!==V&&void 0!==V}function x(V){return"number"===typeof V}function u(V){return"string"===typeof V}function t(V,ba){V&&V.push(ba)}function m(V,ba,U,da=e.create()){V=V||0;ba=ba||0;U=U||0;0!==V&&h.rotateZ(da,da,-V/180*Math.PI);0!==ba&&h.rotateX(da,da,ba/180*Math.PI);0!==U&&h.rotateY(da,da,U/180*Math.PI);return da}function q(V,ba,U,da,fa){const ha=V.minSize,T=V.maxSize;if(V.useSymbolValue)return V=da.symbolSize[U],ba.minSize[U]=V,ba.maxSize[U]=
V,ba.offset[U]=ba.minSize[U],ba.factor[U]=0,ba.type[U]=a.FastSizeType.DefinedSize,!0;if(w(V.field)){if(w(V.stops)){if(2===V.stops.length&&x(V.stops[0].size)&&x(V.stops[1].size))return r(V.stops[0].size,V.stops[1].size,V.stops[0].value,V.stops[1].value,ba,U),ba.type[U]=a.FastSizeType.DefinedSize,!0;t(fa,"Could not convert size info: stops only supported with 2 elements");return!1}if(x(ha)&&x(T)&&w(V.minDataValue)&&w(V.maxDataValue))return r(ha,T,V.minDataValue,V.maxDataValue,ba,U),ba.type[U]=a.FastSizeType.DefinedSize,
!0;if("unknown"===V.valueUnit)return t(fa,"Could not convert size info: proportional size not supported"),!1;if(null!=f.meterIn[V.valueUnit])return ba.minSize[U]=-Infinity,ba.maxSize[U]=Infinity,ba.offset[U]=0,ba.factor[U]=1/f.meterIn[V.valueUnit],ba.type[U]=a.FastSizeType.DefinedSize,!0;t(fa,"Could not convert size info: scale-dependent size not supported");return!1}if(!w(V.field)){if(V.stops?.[0]&&x(V.stops[0].size))return ba.minSize[U]=V.stops[0].size,ba.maxSize[U]=V.stops[0].size,ba.offset[U]=
ba.minSize[U],ba.factor[U]=0,ba.type[U]=a.FastSizeType.DefinedSize,!0;if(x(ha))return ba.minSize[U]=ha,ba.maxSize[U]=ha,ba.offset[U]=ha,ba.factor[U]=0,ba.type[U]=a.FastSizeType.DefinedSize,!0}t(fa,"Could not convert size info: unsupported variant of sizeInfo");return!1}function r(V,ba,U,da,fa,ha){da=0<Math.abs(da-U)?(ba-V)/(da-U):0;fa.minSize[ha]=0<da?V:ba;fa.maxSize[ha]=0<da?ba:V;fa.offset[ha]=V-U*da;fa.factor[ha]=da}function v(V,ba,U,da){if(V.normalizationField||V.valueRepresentation)return t(da,
"Could not convert size info: unsupported property"),null;var fa=V.field;if(null!=fa&&!u(fa))return t(da,"Could not convert size info: field is not a string"),null;if(!ba.size)ba.size=new I(V.field);else if(V.field)if(!ba.size.field)ba.size.field=V.field;else if(V.field!==ba.size.field)return t(da,"Could not convert size info: multiple fields in use"),null;switch(V.axis){case "width":return(fa=q(V,ba.size,0,U,da))?ba:null;case "height":return(fa=q(V,ba.size,2,U,da))?ba:null;case "depth":return(fa=
q(V,ba.size,1,U,da))?ba:null;case "width-and-depth":return(fa=q(V,ba.size,0,U,da))&&q(V,ba.size,1,U,da),fa?ba:null;case null:case void 0:case "all":return(fa=(fa=(fa=q(V,ba.size,0,U,da))&&q(V,ba.size,1,U,da))&&q(V,ba.size,2,U,da))?ba:null;default:return t(da,`Could not convert size info: unknown axis "${V.axis}""`),null}}function y(V,ba,U){for(let da=0;3>da;++da){let fa=ba.unitInMeters;V.type[da]===a.FastSizeType.DefinedSize&&(fa*=ba.modelSize[da],V.type[da]=a.FastSizeType.DefinedScale);V.minSize[da]/=
fa;V.maxSize[da]/=fa;V.offset[da]/=fa;V.factor[da]/=fa}if(V.type[0]!==a.FastSizeType.Undefined)ba=0;else if(V.type[1]!==a.FastSizeType.Undefined)ba=1;else if(V.type[2]!==a.FastSizeType.Undefined)ba=2;else return t(U,"No size axis contains a valid size or scale"),!1;for(U=0;3>U;++U)V.type[U]===a.FastSizeType.Undefined&&(V.minSize[U]=V.minSize[ba],V.maxSize[U]=V.maxSize[ba],V.offset[U]=V.offset[ba],V.factor[U]=V.factor[ba],V.type[U]=V.type[ba]);return!0}function B(V,ba,U){V[4*ba]=U.r/255;V[4*ba+1]=
U.g/255;V[4*ba+2]=U.b/255;V[4*ba+3]=U.a}function z(V,ba,U){if(V.normalizationField)return t(U,"Could not convert color info: unsupported property"),null;if(u(V.field))if(V.stops){if(8<V.stops.length)return t(U,"Could not convert color info: too many color stops"),null;ba.color=new J(V.field);V=V.stops;for(U=0;8>U;++U){const da=V[Math.min(U,V.length-1)];ba.color.values[U]=da.value;B(ba.color.colors,U,da.color)}}else return t(U,"Could not convert color info: missing stops or colors"),null;else if(V.stops&&
0<=V.stops.length)for(V=V.stops&&0<=V.stops.length&&V.stops[0].color,ba.color={field:null,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},U=0;8>U;U++)ba.color.values[U]=Infinity,B(ba.color.colors,U,V);else return t(U,"Could not convert color info: no field and no colors/stops"),null;return ba}function A(V,ba,U){if(V.normalizationField)return t(U,"Could not convert opacity info: unsupported property"),null;if(u(V.field))if(V.stops){if(8<V.stops.length)return t(U,
"Could not convert opacity info: too many opacity stops"),null;ba.opacity=new N(V.field);V=V.stops;for(U=0;8>U;++U){const da=V[Math.min(U,V.length-1)];ba.opacity.values[U]=da.value;ba.opacity.opacityValues[U]=da.opacity}}else return t(U,"Could not convert opacity info: missing stops or opacities"),null;else if(V.stops&&0<=V.stops.length)for(V=V.stops&&0<=V.stops.length?V.stops[0].opacity:0,ba.opacity={field:null,values:[0,0,0,0,0,0,0,0],opacityValues:[0,0,0,0,0,0,0,0]},U=0;8>U;U++)ba.opacity.values[U]=
Infinity,ba.opacity.opacityValues[U]=V;else return t(U,"Could not convert opacity info: no field and no opacities/stops"),null;return ba}function C(V,ba,U){V=2===U&&"arithmetic"===V.rotationType;ba.offset[U]=V?90:0;ba.factor[U]=V?-1:1;ba.type[U]=1}function H(V,ba,U){if(!u(V.field))return t(U,"Could not convert rotation info: field is not a string"),null;if(!ba.rotation)ba.rotation={field:V.field,offset:[0,0,0],factor:[1,1,1],type:[0,0,0]};else if(V.field)if(!ba.rotation.field)ba.rotation.field=V.field;
else if(V.field!==ba.rotation.field)return t(U,"Could not convert rotation info: multiple fields in use"),null;switch(V.axis){case "tilt":return C(V,ba.rotation,0),ba;case "roll":return C(V,ba.rotation,1),ba;case null:case void 0:case "heading":return C(V,ba.rotation,2),ba;default:return t(U,`Could not convert rotation info: unknown axis "${V.axis}""`),null}}function E(V,ba,U){if(!V)return null;const da=V.reduce((fa,ha)=>{if(!fa)return fa;if(ha.valueExpression)return t(U,"Could not convert visual variables: arcade expressions not supported"),
null;switch(ha.type){case "size":return ba.supports.size?v(ha,fa,ba,U):fa;case "color":return ba.supports.color?z(ha,fa,U):fa;case "opacity":return ba.supports.opacity?A(ha,fa,U):null;case "rotation":return ba.supports.rotation?H(ha,fa,U):fa;default:return null}},new Q);return 0<V.length&&da&&!da.size&&!da.color&&!da.opacity&&!da.rotation||da?.size&&!y(da.size,ba,U)?null:da}function F(V,ba,U){if(!!V!==!!ba||V&&V.field!==ba?.field)return!1;if(V&&"rotation"===U)for(U=0;3>U;U++)if(V.type[U]!==ba.type[U]||
V.offset[U]!==ba.offset[U]||V.factor[U]!==ba.factor[U])return!1;return!0}function G(V,ba){V=new L(V);V.vvSize&&(V.vvSymbolAnchor=ba.anchor,h.identity(W),m(ba.rotation[2],ba.rotation[0],ba.rotation[1],W),V.vvSymbolRotationMatrix=V.vvSymbolRotationMatrix||p.create(),k.fromMat4(V.vvSymbolRotationMatrix,W));return V}a.FastSizeType=void 0;(function(V){V[V.Undefined=0]="Undefined";V[V.DefinedSize=1]="DefinedSize";V[V.DefinedScale=2]="DefinedScale"})(a.FastSizeType||(a.FastSizeType={}));a.FastRotationType=
void 0;(function(V){V[V.Undefined=0]="Undefined";V[V.DefinedAngle=1]="DefinedAngle"})(a.FastRotationType||(a.FastRotationType={}));class D{constructor(V){this.field=V}}class I extends D{constructor(V){super(V);this.minSize=[0,0,0];this.maxSize=[0,0,0];this.offset=[0,0,0];this.factor=[0,0,0];this.type=[a.FastSizeType.Undefined,a.FastSizeType.Undefined,a.FastSizeType.Undefined]}}class J extends D{constructor(V){super(V);this.colors=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];this.values=
[0,0,0,0,0,0,0,0]}}class N extends D{constructor(V){super(V);this.values=[0,0,0,0,0,0,0,0];this.opacityValues=[0,0,0,0,0,0,0,0]}}class M extends D{constructor(V){super(V);this.offset=[0,0,0];this.factor=[1,1,1];this.type=[0,0,0]}}class Q{}class O{constructor(V,ba=[1,1,1],U=[1,1,1],da=1,fa=[0,0,0],ha=[1,1,1],T=[0,0,0]){this.supports=V;this.modelSize=ba;this.symbolSize=U;this.unitInMeters=da;this.anchor=fa;this.scale=ha;this.rotation=T}}class K{constructor(V,ba,U){this.visualVariables=V;this.materialParameters=
ba;this.requiresShaderTransformation=U}}class L extends l.NoParameters{constructor(V){super();this.vvSize=V?.size??null;this.vvColor=V?.color??null;this.vvOpacity=V?.opacity??null}}const P=e.create(),R=d.create(),W=e.create();a.ConvertOptions=O;a.FastColorInfo=J;a.FastOpacityInfo=N;a.FastRotationInfo=M;a.FastSizeInfo=I;a.FastSymbolUpdatesState=K;a.FastVisualVariables=Q;a.VisualVariablesParameters=L;a.convertVisualVariables=E;a.evaluateModelTransform=function(V,ba,U){if(!V.vvSize)return U;h.copy(P,
U);U=V.vvSymbolRotationMatrix;h.set(W,U[0],U[1],U[2],0,U[3],U[4],U[5],0,U[6],U[7],U[8],0,0,0,0,1);h.multiply(P,P,W);for(U=0;3>U;++U)R[U]=n.clamp(V.vvSize.offset[U]+ba[0]*V.vvSize.factor[U],V.vvSize.minSize[U],V.vvSize.maxSize[U]);h.scale(P,P,R);h.translate(P,P,V.vvSymbolAnchor);return P};a.evaluateModelTransformScale=function(V,ba,U){if(!ba.vvSize)return g.set(V,1,1,1),V;for(let da=0;3>da;++da)V[da]=n.clamp(ba.vvSize.offset[da]+U[0]*ba.vvSize.factor[da],ba.vvSize.minSize[da],ba.vvSize.maxSize[da]);
return V};a.getAttributeValue=function(V,ba){V=null==V?0:ba.attributes[V];return"number"===typeof V&&isFinite(V)?V:0};a.getMaterialParameters=G;a.initFastSymbolUpdatesState=function(V,ba){return!V||c.debugFlags.TESTS_DISABLE_FAST_UPDATES?null:(V=E(V.visualVariables,ba))?new K(V,G(V,ba),!!V.size):null};a.updateFastSymbolUpdatesState=function(V,ba,U){if(!ba||!V)return!1;const da=V.visualVariables;ba=E(ba.visualVariables,U);if(!(ba&&F(da.size,ba.size,"size")&&F(da.color,ba.color,"color")&&F(da.rotation,
ba.rotation,"rotation")&&F(da.opacity,ba.opacity,"opacity")))return!1;V.visualVariables=ba;V.materialParameters=G(ba,U);V.requiresShaderTransformation=!!ba.size;return!0};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/hud/HUD.glsl":function(){define("exports ../attributes/VerticalOffset.glsl ../util/ScreenSizePerspective.glsl ../util/View.glsl ../../shaderModules/Float4PassUniform ../../shaderModules/FloatPassUniform ../../shaderModules/interfaces ../../../lib/VertexAttribute".split(" "),
function(a,b,n,k,p,h,e,g){a.HUD=function(d,f){d.include(n.ScreenSizePerspective);d.attributes.add(g.VertexAttribute.POSITION,"vec3");d.attributes.add(g.VertexAttribute.NORMAL,"vec3");d.attributes.add(g.VertexAttribute.CENTEROFFSETANDDISTANCE,"vec4");d=d.vertex;k.addProjViewLocalOrigin(d,f);k.addCameraPosition(d,f);d.uniforms.add(new p.Float4PassUniform("viewport",(c,l)=>l.camera.fullViewport),new h.FloatPassUniform("polygonOffset",c=>c.shaderPolygonOffset),new h.FloatPassUniform("cameraGroundRelative",
(c,l)=>l.camera.aboveGround?1:-1));f.hasVerticalOffset&&b.addVerticalOffset(d);d.constants.add("smallOffsetAngle","float",.984807753012208);d.code.add(e.glsl`struct ProjectHUDAux {
vec3 posModel;
vec3 posView;
vec3 vnormal;
float distanceToCamera;
float absCosAngle;
};`);d.code.add(e.glsl`
    float applyHUDViewDependentPolygonOffset(float pointGroundDistance, float absCosAngle, inout vec3 posView) {
      float pointGroundSign = ${f.terrainDepthTest?e.glsl.float(0):e.glsl`sign(pointGroundDistance)`};
      if (pointGroundSign == 0.0) {
        pointGroundSign = cameraGroundRelative;
      }

      // cameraGroundRelative is -1 if camera is below ground, 1 if above ground
      // groundRelative is 1 if both camera and symbol are on the same side of the ground, -1 otherwise
      float groundRelative = cameraGroundRelative * pointGroundSign;

      // view angle dependent part of polygon offset emulation: we take the absolute value because the sign that is
      // dropped is instead introduced using the ground-relative position of the symbol and the camera
      if (polygonOffset > .0) {
        float cosAlpha = clamp(absCosAngle, 0.01, 1.0);
        float tanAlpha = sqrt(1.0 - cosAlpha * cosAlpha) / cosAlpha;
        float factor = (1.0 - tanAlpha / viewport[2]);

        // same side of the terrain
        if (groundRelative > 0.0) {
          posView *= factor;
        }
        // opposite sides of the terrain
        else {
          posView /= factor;
        }
      }

      return groundRelative;
    }
  `);f.draped&&!f.hasVerticalOffset||k.addViewNormal(d);f.draped||(d.uniforms.add(new h.FloatPassUniform("perDistancePixelRatio",(c,l)=>Math.tan(l.camera.fovY/2)/(l.camera.fullViewport[2]/2))),d.code.add(e.glsl`
    void applyHUDVerticalGroundOffset(vec3 normalModel, inout vec3 posModel, inout vec3 posView) {
      float distanceToCamera = length(posView);

      // Compute offset in world units for a half pixel shift
      float pixelOffset = distanceToCamera * perDistancePixelRatio * ${e.glsl.float(.5)};

      // Apply offset along normal in the direction away from the ground surface
      vec3 modelOffset = normalModel * cameraGroundRelative * pixelOffset;

      // Apply the same offset also on the view space position
      vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;

      posModel += modelOffset;
      posView += viewOffset;
    }
  `));f.screenCenterOffsetUnitsEnabled&&k.addPixelRatio(d);f.hasScreenSizePerspective&&n.addScreenSizePerspectiveAlignment(d);d.code.add(e.glsl`
    vec4 projectPositionHUD(out ProjectHUDAux aux) {
      vec3 centerOffset = centerOffsetAndDistance.xyz;
      float pointGroundDistance = centerOffsetAndDistance.w;

      aux.posModel = position;
      aux.posView = (view * vec4(aux.posModel, 1.0)).xyz;
      aux.vnormal = normal;
      ${f.draped?"":"applyHUDVerticalGroundOffset(aux.vnormal, aux.posModel, aux.posView);"}

      // Screen sized offset in world space, used for example for line callouts
      // Note: keep this implementation in sync with the CPU implementation, see
      //   - MaterialUtil.verticalOffsetAtDistance
      //   - HUDMaterial.applyVerticalOffsetTransformation

      aux.distanceToCamera = length(aux.posView);

      vec3 viewDirObjSpace = normalize(cameraPosition - aux.posModel);
      float cosAngle = dot(aux.vnormal, viewDirObjSpace);

      aux.absCosAngle = abs(cosAngle);

      ${f.hasScreenSizePerspective?f.hasVerticalOffset||f.screenCenterOffsetUnitsEnabled?"vec3 perspectiveFactor \x3d screenSizePerspectiveScaleFactor(aux.absCosAngle, aux.distanceToCamera, screenSizePerspectiveAlignment);":"":""}

      ${f.hasVerticalOffset?f.hasScreenSizePerspective?"float verticalOffsetScreenHeight \x3d applyScreenSizePerspectiveScaleFactorFloat(verticalOffset.x, perspectiveFactor);":"float verticalOffsetScreenHeight \x3d verticalOffset.x;":""}

      ${f.hasVerticalOffset?e.glsl`
            float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * aux.distanceToCamera, verticalOffset.z, verticalOffset.w);
            vec3 modelOffset = aux.vnormal * worldOffset;
            aux.posModel += modelOffset;
            vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;
            aux.posView += viewOffset;
            // Since we elevate the object, we need to take that into account
            // in the distance to ground
            pointGroundDistance += worldOffset;`:""}

      float groundRelative = applyHUDViewDependentPolygonOffset(pointGroundDistance, aux.absCosAngle, aux.posView);

      ${f.screenCenterOffsetUnitsEnabled?"":e.glsl`
            // Apply x/y in view space, but z in screen space (i.e. along posView direction)
            aux.posView += vec3(centerOffset.x, centerOffset.y, 0.0);

            // Same material all have same z != 0.0 condition so should not lead to
            // branch fragmentation and will save a normalization if it's not needed
            if (centerOffset.z != 0.0) {
              aux.posView -= normalize(aux.posView) * centerOffset.z;
            }
          `}

      vec4 posProj = proj * vec4(aux.posView, 1.0);

      ${f.screenCenterOffsetUnitsEnabled?f.hasScreenSizePerspective?"float centerOffsetY \x3d applyScreenSizePerspectiveScaleFactorFloat(centerOffset.y, perspectiveFactor);":"float centerOffsetY \x3d centerOffset.y;":""}

      ${f.screenCenterOffsetUnitsEnabled?"posProj.xy +\x3d vec2(centerOffset.x, centerOffsetY) * pixelRatio * 2.0 / viewport.zw * posProj.w;":""}

      // constant part of polygon offset emulation
      posProj.z -= groundRelative * polygonOffset * posProj.w;
      return posProj;
    }
  `)};a.HUDVerticalPixelOffset=.5;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/VerticalOffset.glsl":function(){define("exports ../../../../../../chunks/vec42 ../../../../../../core/libs/gl-matrix-2/factories/vec4f64 ../util/ScreenSizePerspective.glsl ../util/View.glsl ../../shaderModules/Float4PassUniform ../../shaderModules/interfaces".split(" "),function(a,b,n,k,p,h,e){function g(f){f.uniforms.add(new h.Float4PassUniform("verticalOffset",
(c,l)=>{const {minWorldLength:w,maxWorldLength:x,screenLength:u}=c.verticalOffset;return b.set(d,u*(l.camera.pixelRatio||1),Math.tan(.5*l.camera.fovY)/(.5*l.camera.fullViewport[3]),w,x)}))}const d=n.create();a.VerticalOffset=function(f,c){const l=f.vertex;c.hasVerticalOffset?(g(l),c.hasScreenSizePerspective&&(f.include(k.ScreenSizePerspective),k.addScreenSizePerspectiveAlignment(l),p.addCameraPosition(f.vertex,c)),l.code.add(e.glsl`
      vec3 calculateVerticalOffset(vec3 worldPos, vec3 localOrigin) {
        float viewDistance = length((view * vec4(worldPos, 1.0)).xyz);
        ${c.spherical?e.glsl`vec3 worldNormal = normalize(worldPos + localOrigin);`:e.glsl`vec3 worldNormal = vec3(0.0, 0.0, 1.0);`}
        ${c.hasScreenSizePerspective?e.glsl`
            float cosAngle = dot(worldNormal, normalize(worldPos - cameraPosition));
            float verticalOffsetScreenHeight = screenSizePerspectiveScaleFloat(verticalOffset.x, abs(cosAngle), viewDistance, screenSizePerspectiveAlignment);`:e.glsl`
            float verticalOffsetScreenHeight = verticalOffset.x;`}
        // Screen sized offset in world space, used for example for line callouts
        float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * viewDistance, verticalOffset.z, verticalOffset.w);
        return worldNormal * worldOffset;
      }

      vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) {
        return worldPos + calculateVerticalOffset(worldPos, localOrigin);
      }
    `)):l.code.add(e.glsl`vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) { return worldPos; }`)};a.addVerticalOffset=g;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/ScreenSizePerspective.glsl":function(){define(["exports","../../../../../../chunks/vec32","../../../../../../core/libs/gl-matrix-2/factories/vec3f64","../../shaderModules/Float3PassUniform","../../shaderModules/interfaces"],function(a,b,n,k,p){function h(g){return b.set(e,
g.parameters.divisor,g.parameters.offset,g.minScaleFactor)}const e=n.create();a.ScreenSizePerspective=function(g){g.vertex.code.add(p.glsl`float screenSizePerspectiveViewAngleDependentFactor(float absCosAngle) {
return absCosAngle * absCosAngle * absCosAngle;
}`);g.vertex.code.add(p.glsl`vec3 screenSizePerspectiveScaleFactor(float absCosAngle, float distanceToCamera, vec3 params) {
return vec3(
min(params.x / (distanceToCamera - params.y), 1.0),
screenSizePerspectiveViewAngleDependentFactor(absCosAngle),
params.z
);
}`);g.vertex.code.add(p.glsl`float applyScreenSizePerspectiveScaleFactorFloat(float size, vec3 factor) {
return mix(size * clamp(factor.x, factor.z, 1.0), size, factor.y);
}`);g.vertex.code.add(p.glsl`float screenSizePerspectiveScaleFloat(float size, float absCosAngle, float distanceToCamera, vec3 params) {
return applyScreenSizePerspectiveScaleFactorFloat(
size,
screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params)
);
}`);g.vertex.code.add(p.glsl`vec2 applyScreenSizePerspectiveScaleFactorVec2(vec2 size, vec3 factor) {
return mix(size * clamp(factor.x, factor.z, 1.0), size, factor.y);
}`);g.vertex.code.add(p.glsl`vec2 screenSizePerspectiveScaleVec2(vec2 size, float absCosAngle, float distanceToCamera, vec3 params) {
return applyScreenSizePerspectiveScaleFactorVec2(size, screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params));
}`)};a.addScreenSizePerspective=function(g){g.uniforms.add(new k.Float3PassUniform("screenSizePerspective",d=>h(d.screenSizePerspective)))};a.addScreenSizePerspectiveAlignment=function(g){g.uniforms.add(new k.Float3PassUniform("screenSizePerspectiveAlignment",d=>h(d.screenSizePerspectiveAlignment||d.screenSizePerspective)))};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/View.glsl":function(){define("exports ../../../../../../core/libs/gl-matrix-2/math/mat4 ../../../../../../core/libs/gl-matrix-2/factories/mat4f64 ../../../../../../chunks/vec32 ../../../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../shaderModules/Float3DrawUniform ../../shaderModules/Float3PassUniform ../../shaderModules/FloatPassUniform ../../shaderModules/Matrix4DrawUniform ../../shaderModules/Matrix4PassUniform".split(" "),
function(a,b,n,k,p,h,e,g,d,f){const c=n.create(),l=p.create();a.addCameraPosition=function(w,x){x.instancedDoublePrecision?w.constants.add("cameraPosition","vec3",p.ZEROS):w.uniforms.add(new h.Float3DrawUniform("cameraPosition",(u,t)=>k.set(l,t.camera.viewInverseTransposeMatrix[3]-u.origin[0],t.camera.viewInverseTransposeMatrix[7]-u.origin[1],t.camera.viewInverseTransposeMatrix[11]-u.origin[2])))};a.addPixelRatio=function(w){w.uniforms.add(new g.FloatPassUniform("pixelRatio",(x,u)=>u.camera.pixelRatio/
u.overlayStretch))};a.addProjViewLocalOrigin=function(w,x){x.instancedDoublePrecision?w.uniforms.add(new f.Matrix4PassUniform("proj",(u,t)=>t.camera.projectionMatrix),new f.Matrix4PassUniform("view",(u,t)=>b.translate(c,t.camera.viewMatrix,k.set(l,t.camera.viewInverseTransposeMatrix[3],t.camera.viewInverseTransposeMatrix[7],t.camera.viewInverseTransposeMatrix[11]))),new e.Float3PassUniform("localOrigin",(u,t)=>k.set(l,t.camera.viewInverseTransposeMatrix[3],t.camera.viewInverseTransposeMatrix[7],t.camera.viewInverseTransposeMatrix[11]))):
w.uniforms.add(new f.Matrix4PassUniform("proj",(u,t)=>t.camera.projectionMatrix),new d.Matrix4DrawUniform("view",(u,t)=>b.translate(c,t.camera.viewMatrix,u.origin)),new h.Float3DrawUniform("localOrigin",u=>u.origin))};a.addViewNormal=function(w){w.uniforms.add(new f.Matrix4PassUniform("viewNormal",(x,u)=>u.camera.viewInverseTransposeMatrix))};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/Float3DrawUniform":function(){define(["exports",
"./Uniform","../shaderTechnique/BindType"],function(a,b,n){class k extends b.Uniform{constructor(p,h){super(p,"vec3",n.BindType.Draw,(e,g,d,f)=>e.setUniform3fv(p,h(g,d,f)))}}a.Float3DrawUniform=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/Matrix4DrawUniform":function(){define(["exports","./Uniform","../shaderTechnique/BindType"],function(a,b,n){class k extends b.Uniform{constructor(p,h){super(p,"mat4",n.BindType.Draw,(e,g,d)=>e.setUniformMatrix4fv(p,
h(g,d)))}}a.Matrix4DrawUniform=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/Float4PassUniform":function(){define(["exports","./Uniform","../shaderTechnique/BindType"],function(a,b,n){class k extends b.Uniform{constructor(p,h){super(p,"vec4",n.BindType.Pass,(e,g,d)=>e.setUniform4fv(p,h(g,d)))}}a.Float4PassUniform=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/effects/geometry/olidUtils":function(){define(["exports",
"../../../../../core/has"],function(a,b){a.olidEnabled=function(){return!!b("enable-feature:objectAndLayerId-rendering")};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/GLTextureMaterial":function(){define("exports ../../../../core/maybe ../../../../core/promiseUtils ../core/shaderModules/interfaces ./basicInterfaces ./GLMaterial".split(" "),function(a,b,n,k,p,h){class e extends h{constructor(f){super(f);this._numLoading=0;this._disposed=!1;this._textures=
f.textures;this._textureId=f.textureId;this._acquire(f.textureId,c=>this._texture=c);this._acquire(f.normalTextureId,c=>this._textureNormal=c);this._acquire(f.emissiveTextureId,c=>this._textureEmissive=c);this._acquire(f.occlusionTextureId,c=>this._textureOcclusion=c);this._acquire(f.metallicRoughnessTextureId,c=>this._textureMetallicRoughness=c)}dispose(){super.dispose();this._texture=b.releaseMaybe(this._texture);this._textureNormal=b.releaseMaybe(this._textureNormal);this._textureEmissive=b.releaseMaybe(this._textureEmissive);
this._textureOcclusion=b.releaseMaybe(this._textureOcclusion);this._textureMetallicRoughness=b.releaseMaybe(this._textureMetallicRoughness);this._disposed=!0}ensureResources(f){return 0===this._numLoading?p.ResourceState.LOADED:p.ResourceState.LOADING}get textureBindParameters(){return new d(null!=this._texture?this._texture.glTexture:null,null!=this._textureNormal?this._textureNormal.glTexture:null,null!=this._textureEmissive?this._textureEmissive.glTexture:null,null!=this._textureOcclusion?this._textureOcclusion.glTexture:
null,null!=this._textureMetallicRoughness?this._textureMetallicRoughness.glTexture:null)}updateTexture(f){if(null==this._texture||f!==this._texture.id)this._texture=b.releaseMaybe(this._texture),this._textureId=f,this._acquire(this._textureId,c=>this._texture=c)}_acquire(f,c){null==f?c(null):(f=this._textures.acquire(f),n.isPromiseLike(f)?(++this._numLoading,f.then(l=>{this._disposed?(b.releaseMaybe(l),c(null)):c(l)}).finally(()=>--this._numLoading)):c(f))}}class g extends k.NoParameters{constructor(f=
null){super();this.textureEmissive=f}}class d extends g{constructor(f=null,c=null,l=null,w=null,x=null,u,t){super(l);this.texture=f;this.textureNormal=c;this.textureOcclusion=w;this.textureMetallicRoughness=x;this.scale=u;this.normalTextureTransformMatrix=t}}a.GLEmissiveTexturePassParameters=g;a.GLTextureMaterial=e;a.GLTextureMaterialBindParameters=d;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/GLMaterial":function(){define(["./basicInterfaces"],
function(a){class b{constructor(n){this._material=n.material;this._techniques=n.techniques;this._output=n.output}dispose(){}get _stippleTextures(){return this._techniques.context.stippleTextures}get _markerTextures(){return this._techniques.context.markerTextures}acquireTechnique(n,k){return this._techniques.acquire(n,this._material.getConfiguration(this._output,k))}ensureResources(n){return a.ResourceState.LOADED}}return b})},"esri/views/3d/webgl-engine/lib/Material":function(){define("exports ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../core/shaderModules/interfaces ./ContentObject ./ContentObjectType ./DefaultVertexAttributeLocations ../materials/internal/MaterialUtil".split(" "),
function(a,b,n,k,p,h,e){class g extends k.ContentObject{constructor(f,c){super();this.type=p.ContentObjectType.Material;this.supportsEdges=!1;this._renderPriority=0;this.vertexAttributeLocations=h.Default3D;this._pp0=b.fromValues(0,0,1);this._pp1=b.fromValues(0,0,0);this._parameters=new c;e.updateParameters(this._parameters,f);this.validateParameters(this._parameters)}get parameters(){return this._parameters}update(f){return!1}setParameters(f,c=!0){e.updateParameters(this._parameters,f)&&(this.validateParameters(this._parameters),
c&&this._parametersChanged())}validateParameters(f){}shouldRender(f){return this.visible&&this.isVisibleForOutput(f.output)&&(!this.parameters.isDecoration||f.bind.decorations)&&0!==(this.parameters.renderOccluded&f.renderOccludedMask)}isVisibleForOutput(f){return!0}get renderPriority(){return this._renderPriority}set renderPriority(f){f!==this._renderPriority&&(this._renderPriority=f,this._parametersChanged())}_parametersChanged(){this.repository?.materialChanged(this)}queryRenderOccludedState(f){return this.visible&&
this.parameters.renderOccluded===f}get hasEmissions(){return!1}intersectDraped(f,c,l,w,x,u){this._pp0[0]=this._pp1[0]=w[0];this._pp0[1]=this._pp1[1]=w[1];return this.intersect(f,c,l,this._pp0,this._pp1,x)}}a.RenderOccludedFlag=void 0;(function(f){f[f.None=0]="None";f[f.Occlude=1]="Occlude";f[f.Transparent=2]="Transparent";f[f.OccludeAndTransparent=4]="OccludeAndTransparent";f[f.OccludeAndTransparentStencil=8]="OccludeAndTransparentStencil";f[f.Opaque=16]="Opaque"})(a.RenderOccludedFlag||(a.RenderOccludedFlag=
{}));class d extends n.NoParameters{constructor(){super(...arguments);this.renderOccluded=a.RenderOccludedFlag.Occlude;this.isDecoration=!1}}a.Material=g;a.MaterialParameters=d;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/ContentObject":function(){define(["exports","../../../../core/uid"],function(a,b){class n{constructor(){this.id=b.generateUID()}}a.ContentObject=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/ContentObjectType":function(){define(["exports"],
function(a){a.ContentObjectType=void 0;var b=a.ContentObjectType||(a.ContentObjectType={});b[b.Layer=0]="Layer";b[b.Object=1]="Object";b[b.Mesh=2]="Mesh";b[b.Line=3]="Line";b[b.Point=4]="Point";b[b.Material=5]="Material";b[b.Texture=6]="Texture";b[b.COUNT=7]="COUNT";Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/internal/MaterialUtil":function(){define(["exports","../../../../../core/arrayUtils","../../../../../core/mathUtils","../../lib/screenSizePerspectiveUtils"],
function(a,b,n,k){a.colorMixModes={multiply:1,ignore:2,replace:3,tint:4};a.updateParameters=function(p,h){let e=!1;for(const g in h){const d=h[g];void 0!==d&&(Array.isArray(d)?Array.isArray(p[g])&&b.equals(d,p[g])||(p[g]=d.slice(),e=!0):p[g]!==d&&(e=!0,p[g]=d))}return e};a.verticalOffsetAtDistance=function(p,h,e,g,d){let f=(e.screenLength||0)*p.pixelRatio;null!=d&&(f=k.scale(f,g,h,d));return n.clamp(f*Math.tan(.5*p.fovY)/(.5*p.fullHeight)*h,e.minWorldLength||0,null!=e.maxWorldLength?e.maxWorldLength:
Infinity)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/RenderSlot":function(){define(["exports"],function(a){a.RenderSlot=void 0;var b=a.RenderSlot||(a.RenderSlot={});b[b.INTEGRATED_MESH=0]="INTEGRATED_MESH";b[b.OPAQUE_TERRAIN=1]="OPAQUE_TERRAIN";b[b.OPAQUE_MATERIAL=2]="OPAQUE_MATERIAL";b[b.OPAQUE_MATERIAL_WITHOUT_NORMALS=3]="OPAQUE_MATERIAL_WITHOUT_NORMALS";b[b.TRANSPARENT_MATERIAL=4]="TRANSPARENT_MATERIAL";b[b.TRANSPARENT_MATERIAL_WITHOUT_NORMALS=
5]="TRANSPARENT_MATERIAL_WITHOUT_NORMALS";b[b.TRANSPARENT_TERRAIN=6]="TRANSPARENT_TERRAIN";b[b.TRANSPARENT_MATERIAL_WITHOUT_DEPTH=7]="TRANSPARENT_MATERIAL_WITHOUT_DEPTH";b[b.OCCLUDED_TERRAIN=8]="OCCLUDED_TERRAIN";b[b.OCCLUDER_MATERIAL=9]="OCCLUDER_MATERIAL";b[b.TRANSPARENT_OCCLUDER_MATERIAL=10]="TRANSPARENT_OCCLUDER_MATERIAL";b[b.OCCLUSION_PIXELS=11]="OCCLUSION_PIXELS";b[b.HUD_MATERIAL=12]="HUD_MATERIAL";b[b.LABEL_MATERIAL=13]="LABEL_MATERIAL";b[b.LINE_CALLOUTS=14]="LINE_CALLOUTS";b[b.LINE_CALLOUTS_HUD_DEPTH=
15]="LINE_CALLOUTS_HUD_DEPTH";b[b.DRAPED_MATERIAL=16]="DRAPED_MATERIAL";b[b.DRAPED_WATER=17]="DRAPED_WATER";b[b.VOXEL=18]="VOXEL";b[b.MAX_SLOTS=19]="MAX_SLOTS";Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/ScaleInfo":function(){define(["exports"],function(a){class b{constructor(){this.factor=new n;this.factorAlignment=new n}}class n{constructor(){this.minScaleFactor=this.factor=this.scale=0}}a.ScaleFactor=n;a.ScaleInfo=b;Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/internal/bufferWriterUtils":function(){define(["exports","../../../../../core/libs/gl-matrix-2/math/mat4","../../../../../geometry/support/buffer/BufferView","../../lib/Util","../../lib/VertexAttribute"],function(a,b,n,k,p){function h(t,m,q){const {data:r,indices:v}=t;t=m.typedBuffer;m=m.typedBufferStride;const y=v.length;q*=m;for(let B=0;B<y;++B){const z=2*v[B];t[q]=r[z];t[q+1]=r[z+1];q+=m}}function e(t,m,q,r){const {data:v,
indices:y}=t;t=m.typedBuffer;m=m.typedBufferStride;const B=y.length;q*=m;if(null==r||1===r)for(r=0;r<B;++r){var z=3*y[r];t[q]=v[z];t[q+1]=v[z+1];t[q+2]=v[z+2];q+=m}else for(z=0;z<B;++z){const A=3*y[z];for(let C=0;C<r;++C)t[q]=v[A],t[q+1]=v[A+1],t[q+2]=v[A+2],q+=m}}function g(t,m,q,r=1){const {data:v,indices:y}=t;t=m.typedBuffer;m=m.typedBufferStride;const B=y.length;q*=m;if(1===r)for(r=0;r<B;++r){var z=4*y[r];t[q]=v[z];t[q+1]=v[z+1];t[q+2]=v[z+2];t[q+3]=v[z+3];q+=m}else for(z=0;z<B;++z){const A=4*
y[z];for(let C=0;C<r;++C)t[q]=v[A],t[q+1]=v[A+1],t[q+2]=v[A+2],t[q+3]=v[A+3],q+=m}}function d(t,m,q,r,v=1){if(m){var {data:y,indices:B}=t;t=q.typedBuffer;q=q.typedBufferStride;var z=B.length,A=m[0],C=m[1],H=m[2],E=m[4],F=m[5],G=m[6],D=m[8],I=m[9],J=m[10],N=m[12],M=m[13],Q=m[14];r*=q;var O=0,K=0,L=0;m=b.hasIdentityRotation(m)?P=>{O=y[P]+N;K=y[P+1]+M;L=y[P+2]+Q}:P=>{const R=y[P],W=y[P+1];P=y[P+2];O=A*R+E*W+D*P+N;K=C*R+F*W+I*P+M;L=H*R+G*W+J*P+Q};if(1===v)for(v=0;v<z;++v)m(3*B[v]),t[r]=O,t[r+1]=K,t[r+
2]=L,r+=q;else for(let P=0;P<z;++P){m(3*B[P]);for(let R=0;R<v;++R)t[r]=O,t[r+1]=K,t[r+2]=L,r+=q}}else e(t,q,r,v)}function f(t,m,q,r,v=1){if(m){var {data:y,indices:B}=t;t=q.typedBuffer;q=q.typedBufferStride;var z=B.length,A=m[0],C=m[1],H=m[2],E=m[4],F=m[5],G=m[6],D=m[8],I=m[9],J=m[10],N=!b.isOrthoNormal(m);r*=q;var M=0,Q=0,O=0;m=b.hasIdentityRotation(m)?L=>{M=y[L];Q=y[L+1];O=y[L+2]}:L=>{const P=y[L],R=y[L+1];L=y[L+2];M=A*P+E*R+D*L;Q=C*P+F*R+I*L;O=H*P+G*R+J*L};if(1===v)if(N)for(v=0;v<z;++v)m(3*B[v]),
N=M*M+Q*Q+O*O,.999999>N&&1E-6<N?(N=1/Math.sqrt(N),t[r]=M*N,t[r+1]=Q*N,t[r+2]=O*N):(t[r]=M,t[r+1]=Q,t[r+2]=O),r+=q;else for(v=0;v<z;++v)m(3*B[v]),t[r]=M,t[r+1]=Q,t[r+2]=O,r+=q;else for(let L=0;L<z;++L){m(3*B[L]);if(N){var K=M*M+Q*Q+O*O;.999999>K&&1E-6<K&&(K=1/Math.sqrt(K),M*=K,Q*=K,O*=K)}for(K=0;K<v;++K)t[r]=M,t[r+1]=Q,t[r+2]=O,r+=q}}else e(t,q,r,v)}function c(t,m,q,r,v=1){if(m){var {data:y,indices:B}=t;t=q.typedBuffer;q=q.typedBufferStride;var z=B.length,A=m[0],C=m[1],H=m[2],E=m[4],F=m[5],G=m[6],
D=m[8],I=m[9],J=m[10];m=!b.isOrthoNormal(m);r*=q;if(1===v)for(v=0;v<z;++v){var N=4*B[v],M=y[N],Q=y[N+1],O=y[N+2];N=y[N+3];var K=A*M+E*Q+D*O,L=C*M+F*Q+I*O;M=H*M+G*Q+J*O;m&&(Q=K*K+L*L+M*M,.999999>Q&&1E-6<Q&&(Q=1/Math.sqrt(Q),K*=Q,L*=Q,M*=Q));t[r]=K;t[r+1]=L;t[r+2]=M;t[r+3]=N;r+=q}else for(N=0;N<z;++N){K=4*B[N];Q=y[K];O=y[K+1];const P=y[K+2];K=y[K+3];L=A*Q+E*O+D*P;M=C*Q+F*O+I*P;Q=H*Q+G*O+J*P;m&&(O=L*L+M*M+Q*Q,.999999>O&&1E-6<O&&(O=1/Math.sqrt(O),L*=O,M*=O,Q*=O));for(O=0;O<v;++O)t[r]=L,t[r+1]=M,t[r+2]=
Q,t[r+3]=K,r+=q}}else g(t,q,r,v)}function l(t,m,q,r,v=1){const {data:y,indices:B}=t;var z=q.typedBuffer,A=q.typedBufferStride;t=B.length;r*=A;if(m===y.length&&4===m)for(z[r]=y[0],z[r+1]=y[1],z[r+2]=y[2],z[r+3]=y[3],z=new Uint32Array(q.typedBuffer.buffer,q.start),A/=4,r/=4,m=z[r],r+=A,t*=v,v=1;v<t;++v)z[r]=m,r+=A;else if(1===v)if(4===m)for(v=0;v<t;++v)m=4*B[v],z[r]=y[m],z[r+1]=y[m+1],z[r+2]=y[m+2],z[r+3]=y[m+3],r+=A;else for(v=0;v<t;++v)m=3*B[v],z[r]=y[m],z[r+1]=y[m+1],z[r+2]=y[m+2],z[r+3]=255,r+=
A;else if(4===m)for(m=0;m<t;++m){q=4*B[m];for(var C=0;C<v;++C)z[r]=y[q],z[r+1]=y[q+1],z[r+2]=y[q+2],z[r+3]=y[q+3],r+=A}else for(m=0;m<t;++m)for(q=3*B[m],C=0;C<v;++C)z[r]=y[q],z[r+1]=y[q+1],z[r+2]=y[q+2],z[r+3]=255,r+=A}function w(t,m,q){const {data:r,indices:v}=t;t=m.typedBuffer;m=m.typedBufferStride;const y=v.length,B=r[0];q*=m;for(let z=0;z<y;++z)t[q]=B,q+=m}function x(t,m,q,r,v=1){const y=m.typedBuffer;m=m.typedBufferStride;r*=m;if(1===v)for(v=0;v<q;++v)y[r]=t[0],y[r+1]=t[1],y[r+2]=t[2],y[r+3]=
t[3],r+=m;else for(let B=0;B<q;++B)for(let z=0;z<v;++z)y[r]=t[0],y[r+1]=t[1],y[r+2]=t[2],y[r+3]=t[3],r+=m}function u(t,m,q,r,v,y){switch(t){case p.VertexAttribute.POSITION:k.assert(3===m.size);r=v.getField(t,n.BufferViewVec3f);k.assert(!!r,`No buffer view for ${t}`);r&&d(m,q,r,y);break;case p.VertexAttribute.NORMAL:k.assert(3===m.size);q=v.getField(t,n.BufferViewVec3f);k.assert(!!q,`No buffer view for ${t}`);q&&f(m,r,q,y);break;case p.VertexAttribute.NORMALCOMPRESSED:k.assert(2===m.size);q=v.getField(t,
n.BufferViewVec2i16);k.assert(!!q,`No buffer view for ${t}`);q&&h(m,q,y);break;case p.VertexAttribute.UV0:k.assert(2===m.size);q=v.getField(t,n.BufferViewVec2f);k.assert(!!q,`No buffer view for ${t}`);q&&h(m,q,y);break;case p.VertexAttribute.COLOR:case p.VertexAttribute.SYMBOLCOLOR:q=v.getField(t,n.BufferViewVec4u8);k.assert(!!q,`No buffer view for ${t}`);k.assert(3===m.size||4===m.size);!q||3!==m.size&&4!==m.size||l(m,m.size,q,y);break;case p.VertexAttribute.COLORFEATUREATTRIBUTE:q=v.getField(t,
n.BufferViewFloat);k.assert(!!q,`No buffer view for ${t}`);k.assert(1===m.size);q&&1===m.size&&w(m,q,y);break;case p.VertexAttribute.TANGENT:k.assert(4===m.size);r=v.getField(t,n.BufferViewVec4f);k.assert(!!r,`No buffer view for ${t}`);r&&c(m,q,r,y);break;case p.VertexAttribute.PROFILERIGHT:case p.VertexAttribute.PROFILEUP:case p.VertexAttribute.PROFILEVERTEXANDNORMAL:case p.VertexAttribute.FEATUREVALUE:k.assert(4===m.size),q=v.getField(t,n.BufferViewVec4f),k.assert(!!q,`No buffer view for ${t}`),
q&&g(m,q,y)}}a.writeBufferFloat=function(t,m,q,r=1){const {data:v,indices:y}=t;t=m.typedBuffer;m=m.typedBufferStride;const B=y.length;q*=m;if(1===r)for(r=0;r<B;++r)t[q]=v[y[r]],q+=m;else for(let z=0;z<B;++z){const A=v[y[z]];for(let C=0;C<r;C++)t[q]=A,q+=m}};a.writeBufferMat3f=function(t,m,q){const {data:r,indices:v}=t;t=m.typedBuffer;m=m.typedBufferStride;const y=v.length;q*=m;for(let B=0;B<y;++B){const z=9*v[B];for(let A=0;9>A;++A)t[q+A]=r[z+A];q+=m}};a.writeBufferMat4f=function(t,m,q){const {data:r,
indices:v}=t;t=m.typedBuffer;m=m.typedBufferStride;const y=v.length;q*=m;for(let B=0;B<y;++B){const z=16*v[B];for(let A=0;16>A;++A)t[q+A]=r[z+A];q+=m}};a.writeBufferVec2=h;a.writeBufferVec3=e;a.writeBufferVec4=g;a.writeBufferVec4Zeros=function(t,m,q){const r=t.typedBuffer;t=t.typedBufferStride;m*=t;for(let v=0;v<q;++v)r[m]=0,r[m+1]=0,r[m+2]=0,r[m+3]=0,m+=t};a.writeColor=l;a.writeColorFeatureAttribute=w;a.writeDefaultAttribute=u;a.writeDefaultAttributes=function(t,m,q,r,v,y,B){for(const A of q.fields.keys()){q=
t.get(A);var z=q?.indices;q&&z?u(A,q,r,v,y,B):A===p.VertexAttribute.OBJECTANDLAYERIDCOLOR&&null!=m&&(q=t.get(p.VertexAttribute.POSITION)?.indices)&&(q=q.length,z=y.getField(A,n.BufferViewVec4u8),x(m,z,q,B))}};a.writeNormal=f;a.writeObjectAndLayerIdColor=x;a.writePosition=d;a.writeTangent=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/HUDMaterial.glsl":function(){define("exports ../core/libs/gl-matrix-2/math/vec2 ../core/libs/gl-matrix-2/factories/vec2f64 ../core/libs/gl-matrix-2/factories/vec4f64 ../geometry/support/Ellipsoid ../views/3d/webgl-engine/core/shaderLibrary/ShaderOutput ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/ObjectAndLayerIdColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/hud/AlignPixel.glsl ../views/3d/webgl-engine/core/shaderLibrary/hud/HUD.glsl ../views/3d/webgl-engine/core/shaderLibrary/hud/HUDOcclusionPass.glsl ../views/3d/webgl-engine/core/shaderLibrary/hud/HUDVisibility.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/VisualVariables.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaCutoff ../views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/RgbaFloatEncoding.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/ScreenSizePerspective.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/View.glsl ../views/3d/webgl-engine/core/shaderModules/Float2PassUniform ../views/3d/webgl-engine/core/shaderModules/Float4DrawUniform ../views/3d/webgl-engine/core/shaderModules/Float4PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform ../views/3d/webgl-engine/lib/OITPass ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w,x,u,t,m,q,r,v,y,B,z,A,C,H,E,F){function G(N){const M=new C.ShaderBuilder;var Q=N.signedDistanceFieldEnabled;M.include(f.HUD,N);M.include(e.SliceDraw,N);if(N.occlusionPass)return M.include(c.HUDOcclusionPass,N),M;const {vertex:O,fragment:K}=M;M.include(q.ScreenSizePerspective);M.include(x.VisualVariables,N);M.include(g.ObjectAndLayerIdColor,N);M.include(l.HUDVisibility);K.include(m.RgbaFloatEncoding);K.include(t.ColorConversion);M.varyings.add("vcolor","vec4");M.varyings.add("vtc",
"vec2");M.varyings.add("vsize","vec2");M.varyings.add("voccluded","float");O.uniforms.add(new B.Float4PassUniform("viewport",(R,W)=>W.camera.fullViewport),new v.Float2PassUniform("screenOffset",(R,W)=>b.set(J,2*R.screenOffset[0]*W.camera.pixelRatio,2*R.screenOffset[1]*W.camera.pixelRatio)),new v.Float2PassUniform("anchorPosition",R=>D(R)),new B.Float4PassUniform("materialColor",R=>R.color),new z.FloatPassUniform("materialRotation",R=>R.rotation));r.addPixelRatio(O);Q&&(O.uniforms.add(new B.Float4PassUniform("outlineColor",
R=>R.outlineColor)),K.uniforms.add(new B.Float4PassUniform("outlineColor",R=>0<R.outlineColor[3]&&0<R.outlineSize?R.outlineColor:k.ZEROS),new z.FloatPassUniform("outlineSize",R=>0<R.outlineColor[3]&&0<R.outlineSize?R.outlineSize:0)));N.horizonCullingEnabled&&O.uniforms.add(new y.Float4DrawUniform("pointDistanceSphere",(R,W)=>{W=W.camera.eye;R=R.origin;return k.fromValues(R[0]-W[0],R[1]-W[1],R[2]-W[2],p.earth.radius)}));N.pixelSnappingEnabled&&O.include(d.AlignPixel);N.hasScreenSizePerspective&&(q.addScreenSizePerspective(O),
q.addScreenSizePerspectiveAlignment(O));N.debugDrawLabelBorder&&M.varyings.add("debugBorderCoords","vec4");M.attributes.add(F.VertexAttribute.UV0,"vec2");M.attributes.add(F.VertexAttribute.COLOR,"vec4");M.attributes.add(F.VertexAttribute.SIZE,"vec2");M.attributes.add(F.VertexAttribute.ROTATION,"float");M.attributes.add(F.VertexAttribute.FEATUREATTRIBUTE,"vec4");O.code.add(N.horizonCullingEnabled?A.glsl`bool behindHorizon(vec3 posModel) {
vec3 camToEarthCenter = pointDistanceSphere.xyz - localOrigin;
vec3 camToPos = pointDistanceSphere.xyz + posModel;
float earthRadius = pointDistanceSphere.w;
float a = dot(camToPos, camToPos);
float b = dot(camToPos, camToEarthCenter);
float c = dot(camToEarthCenter, camToEarthCenter) - earthRadius * earthRadius;
return  b > 0.0 && b < a && b * b  > a * c;
}`:A.glsl`bool behindHorizon(vec3 posModel) { return false; }`);O.main.add(A.glsl`
      ProjectHUDAux projectAux;
      vec4 posProj = projectPositionHUD(projectAux);
      forwardObjectAndLayerIdColor();

      if (rejectBySlice(projectAux.posModel)) {
        // Project outside of clip plane
        gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
        return;
      }

      if (behindHorizon(projectAux.posModel)) {
        // Project outside of clip plane
        gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
        return;
      }

      vec2 inputSize;
      ${A.If(N.hasScreenSizePerspective,A.glsl`
          inputSize = screenSizePerspectiveScaleVec2(size, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspective);
          vec2 screenOffsetScaled = screenSizePerspectiveScaleVec2(screenOffset, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);`,A.glsl`
          inputSize = size;
          vec2 screenOffsetScaled = screenOffset;`)}
      ${A.If(N.vvSize,A.glsl`inputSize *= vvScale(featureAttribute).xx;`)}

      vec2 combinedSize = inputSize * pixelRatio;
      vec4 quadOffset = vec4(0.0);
      bool visible = testHUDVisibility(posProj);
      voccluded = visible ? 0.0 : 1.0;
    `);var L=A.glsl`
      vec2 uv01 = floor(uv0);
      vec2 uv = uv0 - uv01;
      quadOffset.xy = (uv01 - anchorPosition) * 2.0 * combinedSize;

      ${A.If(N.hasRotation,A.glsl`
          float angle = radians(materialRotation + rotation);
          float cosAngle = cos(angle);
          float sinAngle = sin(angle);
          mat2 rotate = mat2(cosAngle, -sinAngle, sinAngle,  cosAngle);

          quadOffset.xy = rotate * quadOffset.xy;
        `)}

      quadOffset.xy = (quadOffset.xy + screenOffsetScaled) / viewport.zw * posProj.w;
  `,P=N.pixelSnappingEnabled?Q?A.glsl`posProj = alignToPixelOrigin(posProj, viewport.zw) + quadOffset;`:A.glsl`posProj += quadOffset;
if (inputSize.x == size.x) {
posProj = alignToPixelOrigin(posProj, viewport.zw);
}`:A.glsl`posProj += quadOffset;`;O.main.add(A.glsl`
    ${A.If(N.occlusionTestEnabled,A.glsl`
      if (!visible) {
        vtc = vec2(0.0);
        ${A.If(N.debugDrawLabelBorder,"debugBorderCoords \x3d vec4(0.5, 0.5, 1.5 / combinedSize);")}
        return;
      }`)}
    ${L}
    ${N.vvColor?"vcolor \x3d interpolateVVColor(featureAttribute.y) * materialColor;":"vcolor \x3d color / 255.0 * materialColor;"}

    ${A.If(N.output===h.ShaderOutput.ObjectAndLayerIdColor,A.glsl`vcolor.a = 1.0;`)}

    bool alphaDiscard = vcolor.a < ${A.glsl.float(u.alphaCutoff)};
    ${A.If(Q,`alphaDiscard = alphaDiscard && outlineColor.a < ${A.glsl.float(u.alphaCutoff)};`)}
    if (alphaDiscard) {
      // "early discard" if both symbol color (= fill) and outline color (if applicable) are transparent
      gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
      return;
    } else {
      ${P}
      gl_Position = posProj;
    }

    vtc = uv;

    ${A.If(N.debugDrawLabelBorder,A.glsl`debugBorderCoords = vec4(uv01, 1.5 / combinedSize);`)}
    vsize = inputSize;
  `);K.uniforms.add(new H.Texture2DPassUniform("tex",R=>R.texture));N.occludedFragmentFade&&(K.uniforms.add(new H.Texture2DPassUniform("depthMap",(R,W)=>W.mainDepth)),K.uniforms.add(new z.FloatPassUniform("fadeFactor",()=>I.occludedFadeFactor)));L=N.debugDrawLabelBorder?A.glsl`(isBorder > 0.0 ? 0.0 : ${A.glsl.float(u.alphaCutoff)})`:A.glsl.float(u.alphaCutoff);P=N.output===h.ShaderOutput.Highlight;Q=A.glsl`
    ${A.If(N.debugDrawLabelBorder,A.glsl`float isBorder = float(any(lessThan(debugBorderCoords.xy, debugBorderCoords.zw)) || any(greaterThan(debugBorderCoords.xy, 1.0 - debugBorderCoords.zw)));`)}

    ${A.If(N.sampleSignedDistanceFieldTexelCenter,A.glsl`
      float txSize = float(textureSize(tex, 0).x);
      float texelSize = 1.0 / txSize;

      // Calculate how much we have to add/subtract to/from each texel to reach the size of an onscreen pixel
      vec2 scaleFactor = (vsize - txSize) * texelSize;
      vec2 samplePos = vtc + (vec2(1.0, -1.0) * texelSize) * scaleFactor;`,A.glsl`vec2 samplePos = vtc;`)}

    ${Q?A.glsl`
      vec4 fillPixelColor = vcolor;

      // Get distance and map it into [-0.5, 0.5]
      float d = rgba2float(texture(tex, samplePos)) - 0.5;

      // Distance in output units (i.e. pixels)
      float dist = d * vsize.x;

      // Create smooth transition from the icon into its outline
      float fillAlphaFactor = clamp(0.5 - dist, 0.0, 1.0);
      fillPixelColor.a *= fillAlphaFactor;

      if (outlineSize > 0.25) {
        vec4 outlinePixelColor = outlineColor;
        float clampedOutlineSize = min(outlineSize, 0.5*vsize.x);

        // Create smooth transition around outline
        float outlineAlphaFactor = clamp(0.5 - (abs(dist) - 0.5*clampedOutlineSize), 0.0, 1.0);
        outlinePixelColor.a *= outlineAlphaFactor;

        if (
          outlineAlphaFactor + fillAlphaFactor < ${L} ||
          fillPixelColor.a + outlinePixelColor.a < ${A.glsl.float(u.alphaCutoff)}
        ) {
          discard;
        }

        // perform un-premultiplied over operator (see https://en.wikipedia.org/wiki/Alpha_compositing#Description)
        float compositeAlpha = outlinePixelColor.a + fillPixelColor.a * (1.0 - outlinePixelColor.a);
        vec3 compositeColor = vec3(outlinePixelColor) * outlinePixelColor.a +
          vec3(fillPixelColor) * fillPixelColor.a * (1.0 - outlinePixelColor.a);

        ${A.If(!P,A.glsl`fragColor = vec4(compositeColor, compositeAlpha);`)}
      } else {
        if (fillAlphaFactor < ${L}) {
          discard;
        }

        ${A.If(!P,A.glsl`fragColor = premultiplyAlpha(fillPixelColor);`)}
      }

      // visualize SDF:
      // fragColor = vec4(clamp(-dist/vsize.x*2.0, 0.0, 1.0), clamp(dist/vsize.x*2.0, 0.0, 1.0), 0.0, 1.0);
      `:A.glsl`
          vec4 texColor = texture(tex, vtc, -0.5);
          if (texColor.a < ${L}) {
            discard;
          }
          ${A.If(!P,A.glsl`fragColor = texColor * premultiplyAlpha(vcolor);`)}
          `}

    ${A.If(N.occludedFragmentFade&&!P,A.glsl`
        float zSample = texelFetch(depthMap, ivec2(gl_FragCoord.xy), 0).x;
        if (zSample < gl_FragCoord.z) {
          fragColor *= fadeFactor;
        }
        `)}

    ${A.If(!P&&N.debugDrawLabelBorder,A.glsl`fragColor = mix(fragColor, vec4(1.0, 0.0, 1.0, 1.0), isBorder * 0.5);`)}
  `;switch(N.output){case h.ShaderOutput.Color:N.oitPass===E.OITPass.ColorAlpha&&(M.outputs.add("fragColor","vec4",0),M.outputs.add("fragAlpha","float",1));K.main.add(A.glsl`
        ${Q}
        ${A.If(N.oitPass===E.OITPass.FrontFace,A.glsl`fragColor.rgb /= fragColor.a;`)}
        ${A.If(N.oitPass===E.OITPass.ColorAlpha,A.glsl`fragAlpha = fragColor.a;`)}`);break;case h.ShaderOutput.ObjectAndLayerIdColor:K.main.add(A.glsl`
        ${Q}
        outputObjectAndLayerIdColor();`);break;case h.ShaderOutput.Highlight:M.include(w.OutputHighlight,N),K.main.add(A.glsl`
        ${Q}
        outputHighlight(voccluded == 1.0);`)}return M}function D(N,M=J){if(N.textureIsSignedDistanceField){var Q=N.anchorPosition;N=N.distanceFieldBoundingBox;null!=N?b.set(M,Q[0]*(N[2]-N[0])+N[0],Q[1]*(N[3]-N[1])+N[1]):b.set(M,0,0)}else b.copy(M,N.anchorPosition);return M}const I={occludedFadeFactor:.6},J=n.create();n=Object.freeze(Object.defineProperty({__proto__:null,build:G,calculateAnchorPosForRendering:D,shaderSettings:I},Symbol.toStringTag,{value:"Module"}));a.HUDMaterial=n;a.build=G;a.calculateAnchorPosForRendering=
D;a.shaderSettings=I})},"esri/views/3d/webgl-engine/core/shaderLibrary/Slice.glsl":function(){define("exports ../../../../../core/libs/gl-matrix-2/math/mat4 ../../../../../core/libs/gl-matrix-2/factories/mat4f64 ../../../../../chunks/vec32 ../../../../../core/libs/gl-matrix-2/factories/vec3f64 ../shaderModules/Float3DrawUniform ../shaderModules/Float3PassUniform ../shaderModules/interfaces".split(" "),function(a,b,n,k,p,h,e,g){function d(v,y,...B){if(y.hasSlicePlane){var z=g.glsl`struct SliceFactors {
float front;
float side0;
float side1;
float side2;
float side3;
};
SliceFactors calculateSliceFactors(vec3 pos) {
vec3 rel = pos - slicePlaneOrigin;
vec3 slicePlaneNormal = -cross(slicePlaneBasis1, slicePlaneBasis2);
float slicePlaneW = -dot(slicePlaneNormal, slicePlaneOrigin);
float basis1Len2 = dot(slicePlaneBasis1, slicePlaneBasis1);
float basis2Len2 = dot(slicePlaneBasis2, slicePlaneBasis2);
float basis1Dot = dot(slicePlaneBasis1, rel);
float basis2Dot = dot(slicePlaneBasis2, rel);
return SliceFactors(
dot(slicePlaneNormal, pos) + slicePlaneW,
-basis1Dot - basis1Len2,
basis1Dot - basis1Len2,
-basis2Dot - basis2Len2,
basis2Dot - basis2Len2
);
}
bool sliceByFactors(SliceFactors factors) {
return factors.front < 0.0
&& factors.side0 < 0.0
&& factors.side1 < 0.0
&& factors.side2 < 0.0
&& factors.side3 < 0.0;
}
bool sliceEnabled() {
return dot(slicePlaneBasis1, slicePlaneBasis1) != 0.0;
}
bool sliceByPlane(vec3 pos) {
return sliceEnabled() && sliceByFactors(calculateSliceFactors(pos));
}
#define rejectBySlice(_pos_) sliceByPlane(_pos_)
#define discardBySlice(_pos_) { if (sliceByPlane(_pos_)) discard; }`,A=g.glsl`vec4 applySliceHighlight(vec4 color, vec3 pos) {
SliceFactors factors = calculateSliceFactors(pos);
const float HIGHLIGHT_WIDTH = 1.0;
const vec4 HIGHLIGHT_COLOR = vec4(0.0, 0.0, 0.0, 0.3);
factors.front /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.front);
factors.side0 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side0);
factors.side1 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side1);
factors.side2 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side2);
factors.side3 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side3);
if (sliceByFactors(factors)) {
return color;
}
float highlightFactor = (1.0 - step(0.5, factors.front))
* (1.0 - step(0.5, factors.side0))
* (1.0 - step(0.5, factors.side1))
* (1.0 - step(0.5, factors.side2))
* (1.0 - step(0.5, factors.side3));
return mix(color, vec4(HIGHLIGHT_COLOR.rgb, color.a), highlightFactor * HIGHLIGHT_COLOR.a);
}`;A=y.hasSliceHighlight?g.glsl`
        ${A}
        #define highlightSlice(_color_, _pos_) (sliceEnabled() ? applySliceHighlight(_color_, _pos_) : (_color_))
      `:g.glsl`#define highlightSlice(_color_, _pos_) (_color_)`;y.hasSliceInVertexProgram&&v.vertex.uniforms.add(...B).code.add(z);v.fragment.uniforms.add(...B).code.add(z);v.fragment.code.add(A)}else B=g.glsl`#define rejectBySlice(_pos_) false
#define discardBySlice(_pos_) {}
#define highlightSlice(_color_, _pos_) (_color_)`,y.hasSliceInVertexProgram&&v.vertex.code.add(B),v.fragment.code.add(B)}function f(v,y,B){return v.instancedDoublePrecision?k.set(t,B.camera.viewInverseTransposeMatrix[3],B.camera.viewInverseTransposeMatrix[7],B.camera.viewInverseTransposeMatrix[11]):y.slicePlaneLocalOrigin}function c(v,y){return null!=v?k.subtract(m,y.origin,v):y.origin}function l(v,y,B){return v.hasSliceTranslatedView?null!=y?b.translate(r,B.camera.viewMatrix,y):B.camera.viewMatrix:
null}function w(v,y,B){if(null==B.slicePlane)return p.ZEROS;const z=f(v,y,B);y=c(z,B.slicePlane);v=l(v,z,B);return null!=v?k.transformMat4(m,y,v):y}function x(v,y,B,z){if(null==z||null==B.slicePlane)return p.ZEROS;const A=f(v,y,B);y=c(A,B.slicePlane);v=l(v,A,B);return null!=v?(k.add(q,z,y),k.transformMat4(m,y,v),k.transformMat4(q,q,v),k.subtract(q,q,m)):z}class u extends g.NoParameters{constructor(v){super();this.slicePlaneLocalOrigin=v}}const t=p.create(),m=p.create(),q=p.create(),r=n.create();a.SliceDraw=
function(v,y){d(v,y,new h.Float3DrawUniform("slicePlaneOrigin",(B,z)=>w(y,B,z)),new h.Float3DrawUniform("slicePlaneBasis1",(B,z)=>x(y,B,z,z.slicePlane?.basis1)),new h.Float3DrawUniform("slicePlaneBasis2",(B,z)=>x(y,B,z,z.slicePlane?.basis2)))};a.SlicePass=function(v,y){d(v,y,new e.Float3PassUniform("slicePlaneOrigin",(B,z)=>w(y,B,z)),new e.Float3PassUniform("slicePlaneBasis1",(B,z)=>x(y,B,z,z.slicePlane?.basis1)),new e.Float3PassUniform("slicePlaneBasis2",(B,z)=>x(y,B,z,z.slicePlane?.basis2)))};a.SlicePlaneParameters=
u;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/ObjectAndLayerIdColor.glsl":function(){define(["exports","../ShaderOutput","../../shaderModules/interfaces","../../../lib/VertexAttribute"],function(a,b,n,k){a.ObjectAndLayerIdColor=function(p,h){h.output!==b.ShaderOutput.ObjectAndLayerIdColor?(p.vertex.code.add(n.glsl`void forwardObjectAndLayerIdColor() {}`),p.fragment.code.add(n.glsl`void outputObjectAndLayerIdColor() {}`)):
(h=h.objectAndLayerIdColorInstanced,p.varyings.add("objectAndLayerIdColorVarying","vec4"),p.attributes.add(h?k.VertexAttribute.INSTANCEOBJECTANDLAYERIDCOLOR:k.VertexAttribute.OBJECTANDLAYERIDCOLOR,"vec4"),p.vertex.code.add(n.glsl`
    void forwardObjectAndLayerIdColor() {
      objectAndLayerIdColorVarying = ${h?"instanceObjectAndLayerIdColor":"objectAndLayerIdColor"} * 0.003921568627451;
    }`),p.fragment.code.add(n.glsl`void outputObjectAndLayerIdColor() {
fragColor = objectAndLayerIdColorVarying;
}`))};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/hud/AlignPixel.glsl":function(){define(["exports","../../shaderModules/BooleanPassUniform","../../shaderModules/interfaces"],function(a,b,n){a.AlignPixel=function(k){k.uniforms.add(new b.BooleanPassUniform("alignPixelEnabled",(p,h)=>h.alignPixelEnabled));k.code.add(n.glsl`vec4 alignToPixelCenter(vec4 clipCoord, vec2 widthHeight) {
if (!alignPixelEnabled)
return clipCoord;
vec2 xy = vec2(0.500123) + 0.5 * clipCoord.xy / clipCoord.w;
vec2 pixelSz = vec2(1.0) / widthHeight;
vec2 ij = (floor(xy * widthHeight) + vec2(0.5)) * pixelSz;
vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
return vec4(result, clipCoord.zw);
}`);k.code.add(n.glsl`vec4 alignToPixelOrigin(vec4 clipCoord, vec2 widthHeight) {
if (!alignPixelEnabled)
return clipCoord;
vec2 xy = vec2(0.5) + 0.5 * clipCoord.xy / clipCoord.w;
vec2 pixelSz = vec2(1.0) / widthHeight;
vec2 ij = floor((xy + 0.5 * pixelSz) * widthHeight) * pixelSz;
vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
return vec4(result, clipCoord.zw);
}`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/BooleanPassUniform":function(){define(["exports","./Uniform","../shaderTechnique/BindType"],function(a,b,n){class k extends b.Uniform{constructor(p,h){super(p,"bool",n.BindType.Pass,(e,g,d)=>e.setUniform1b(p,h(g,d)))}}a.BooleanPassUniform=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/hud/HUDOcclusionPass.glsl":function(){define(["exports",
"./AlignPixel.glsl","../shading/TerrainDepthTest.glsl","../../shaderModules/interfaces"],function(a,b,n,k){a.HUDOcclusionPass=function(p,h){const {vertex:e,fragment:g}=p;p.include(n.terrainDepthTest,h);e.include(b.AlignPixel);h.terrainDepthTest&&p.varyings.add("depth","float");e.main.add(k.glsl`
    vec4 posProjCenter;
    if (dot(position, position) > 0.0) {
      // Render single point to center of the pixel to avoid subpixel filtering to affect the marker color
      ProjectHUDAux projectAux;
      vec4 posProj = projectPositionHUD(projectAux);
      posProjCenter = alignToPixelCenter(posProj, viewport.zw);

      ${h.terrainDepthTest?k.glsl`depth = projectAux.posView.z;`:""}
      vec3 vpos = projectAux.posModel;
      if (rejectBySlice(vpos)) {
        // Project out of clip space
        posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
      }

    } else {
      // Project out of clip space
      posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
    }

    gl_Position = posProjCenter;
    gl_PointSize = 1.0;
  `);g.main.add(k.glsl`fragColor = vec4(1);
if(terrainDepthTest(depth)) {
fragColor.g = 0.5;
}`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/TerrainDepthTest.glsl":function(){define(["exports","../output/ReadDepth.glsl","../../shaderModules/interfaces","../../shaderModules/Texture2DPassUniform"],function(a,b,n,k){a.terrainDepthTest=function(p,{occlusionPass:h,terrainDepthTest:e,cullAboveTerrain:g}){e?(p.fragment.include(b.ReadDepth),p.fragment.uniforms.add(new k.Texture2DPassUniform("terrainDepthTexture",(d,f)=>f.terrainDepth?.attachment)).code.add(n.glsl`
   ${h?"bool":"void"} terrainDepthTest(float fragmentDepth) {
      float depth = texelFetch(terrainDepthTexture, ivec2(gl_FragCoord.xy), 0).r;
      float linearDepth = linearizeDepth(depth);
      ${h?n.glsl`return fragmentDepth < linearDepth && depth < 1.0;`:n.glsl`if(fragmentDepth ${g?"\x3e":"\x3c\x3d"} linearDepth) discard;`}
    }`)):h?p.fragment.code.add(n.glsl`#define terrainDepthTest(fragmentDepth) false`):p.fragment.code.add(n.glsl`#define terrainDepthTest(fragmentDepth) {}`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/output/ReadDepth.glsl":function(){define(["exports","../../../../../../core/libs/gl-matrix-2/math/vec2","../../../../../../core/libs/gl-matrix-2/factories/vec2f64","../../shaderModules/Float2PassUniform","../../shaderModules/interfaces"],
function(a,b,n,k,p){const h=n.create();a.ReadDepth=function(e){e.uniforms.add(new k.Float2PassUniform("zProjectionMap",(g,d)=>{g=d.camera.projectionMatrix;return b.set(h,g[14],g[10])}));e.code.add(p.glsl`float linearizeDepth(float depth) {
float depthNdc = depth * 2.0 - 1.0;
float c1 = zProjectionMap[0];
float c2 = zProjectionMap[1];
return -(c1 / (depthNdc + c2 + 1e-7));
}`);e.code.add(p.glsl`float depthFromTexture(sampler2D depthTexture, vec2 uv) {
ivec2 iuv = ivec2(uv * vec2(textureSize(depthTexture, 0)));
float depth = texelFetch(depthTexture, iuv, 0).r;
return depth;
}`);e.code.add(p.glsl`float linearDepthFromTexture(sampler2D depthTexture, vec2 uv) {
return linearizeDepth(depthFromTexture(depthTexture, uv));
}`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/hud/HUDVisibility.glsl":function(){define("exports ./AlignPixel.glsl ./HUDRenderStyle ../../shaderModules/Float4PassUniform ../../shaderModules/FloatPassUniform ../../shaderModules/interfaces ../../shaderModules/Texture2DPassUniform".split(" "),function(a,b,n,k,p,h,e){a.HUDVisibility=function(g){g.vertex.uniforms.add(new p.FloatPassUniform("renderTransparentlyOccludedHUD",(d,f)=>f.hudRenderStyle===
n.HUDRenderStyle.Occluded?1:f.hudRenderStyle===n.HUDRenderStyle.NotOccluded?0:.75),new k.Float4PassUniform("viewport",(d,f)=>f.camera.fullViewport),new e.Texture2DPassUniform("hudVisibilityTexture",(d,f)=>f.hudVisibility?.getTexture()));g.vertex.include(b.AlignPixel);g.vertex.code.add(h.glsl`bool testHUDVisibility(vec4 posProj) {
vec4 posProjCenter = alignToPixelCenter(posProj, viewport.zw);
vec4 occlusionPixel = texture(hudVisibilityTexture, .5 + .5 * posProjCenter.xy / posProjCenter.w);
if (renderTransparentlyOccludedHUD > 0.5) {
return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g * renderTransparentlyOccludedHUD < 1.0;
}
return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g == 1.0;
}`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/hud/HUDRenderStyle":function(){define(["exports"],function(a){a.HUDRenderStyle=void 0;var b=a.HUDRenderStyle||(a.HUDRenderStyle={});b[b.Occluded=0]="Occluded";b[b.NotOccluded=1]="NotOccluded";b[b.Both=2]="Both";b[b.COUNT=3]="COUNT";Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl":function(){define("exports ../ShaderOutput ../../shaderModules/Integer2PassUniform ../../shaderModules/IntegerPassUniform ../../shaderModules/interfaces ../../shaderModules/Texture2DPassUniform".split(" "),
function(a,b,n,k,p,h){a.OutputHighlight=function(e,g){const {fragment:d}=e;g.output!==b.ShaderOutput.Highlight?d.code.add(p.glsl`void calculateOcclusionAndOutputHighlight() {}`):(d.uniforms.add(new h.Texture2DPassUniform("depthTexture",(f,c)=>c.mainDepth),new h.Texture2DPassUniform("highlightTexture",(f,c)=>c.highlightMixTexture),new k.IntegerPassUniform("highlightLevel",(f,c)=>c.highlightLevel),new n.Integer2PassUniform("highlightMixOrigin",(f,c)=>c.highlightMixOrigin)),e.outputs.add("fragHighlight",
"vec2",0),d.code.add(p.glsl`vec2 getAccumulatedHighlight() {
return texelFetch(highlightTexture, ivec2(gl_FragCoord.xy) - highlightMixOrigin, 0).rg;
}
void outputHighlight(bool occluded) {
if (highlightLevel == 0) {
uint bits = occluded ? 3u : 1u;
fragHighlight = vec2(float(bits) / 255.0, 0.0);
} else {
int ll = (highlightLevel & 3) << 1;
int li = (highlightLevel >> 2) & 3;
uint bits;
if (occluded) {
bits = 3u << ll;
} else {
bits = 1u << ll;
}
vec2 combinedHighlight = getAccumulatedHighlight();
uint accumulatedI = uint(combinedHighlight[li] * 255.0);
combinedHighlight[li] = float(bits | accumulatedI) / 255.0;
fragHighlight = combinedHighlight;
}
}
bool isHighlightOccluded() {
float sceneDepth = texelFetch(depthTexture, ivec2(gl_FragCoord.xy), 0).x;
return gl_FragCoord.z > sceneDepth + 5e-7;
}
void calculateOcclusionAndOutputHighlight() {
outputHighlight(isHighlightOccluded());
}`),g.canHaveOverlay&&(d.constants.add("occlusionAndMask","int",85),d.code.add(p.glsl`void outputAllHighlights(vec2 highlightToAdd) {
if (highlightToAdd == vec2(0.0)) { discard; }
int occludedOrMask = isHighlightOccluded() ? 0xaa : 0;
ivec2 added = ivec2(highlightToAdd * 255.0);
ivec2 masked = (added & ivec2(occlusionAndMask)) | (ivec2(occludedOrMask) & (added<<1));
fragHighlight = vec2(masked) / 255.0;
}`)))};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/Integer2PassUniform":function(){define(["exports","./Uniform","../shaderTechnique/BindType"],function(a,b,n){class k extends b.Uniform{constructor(p,h){super(p,"ivec2",n.BindType.Pass,(e,g,d)=>e.setUniform2iv(p,h(g,d)))}}a.Integer2PassUniform=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/IntegerPassUniform":function(){define(["exports",
"./Uniform","../shaderTechnique/BindType"],function(a,b,n){class k extends b.Uniform{constructor(p,h){super(p,"int",n.BindType.Pass,(e,g,d)=>e.setUniform1i(p,h(g,d)))}}a.IntegerPassUniform=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/VisualVariables.glsl":function(){define("exports ../../shaderModules/Float3PassUniform ../../shaderModules/Float4sPassUniform ../../shaderModules/FloatsPassUniform ../../shaderModules/interfaces ../../shaderModules/Matrix3PassUniform ../../../lib/VertexAttribute ../../../materials/VisualVariablePassParameters".split(" "),
function(a,b,n,k,p,h,e,g){a.VisualVariables=function(d,f){const {vertex:c,attributes:l}=d;f.hasVvInstancing&&(f.vvSize||f.vvColor)&&l.add(e.VertexAttribute.INSTANCEFEATUREATTRIBUTE,"vec4");f.vvSize?(c.uniforms.add(new b.Float3PassUniform("vvSizeMinSize",w=>w.vvSize.minSize)),c.uniforms.add(new b.Float3PassUniform("vvSizeMaxSize",w=>w.vvSize.maxSize)),c.uniforms.add(new b.Float3PassUniform("vvSizeOffset",w=>w.vvSize.offset)),c.uniforms.add(new b.Float3PassUniform("vvSizeFactor",w=>w.vvSize.factor)),
c.uniforms.add(new h.Matrix3PassUniform("vvSymbolRotationMatrix",w=>w.vvSymbolRotationMatrix)),c.uniforms.add(new b.Float3PassUniform("vvSymbolAnchor",w=>w.vvSymbolAnchor)),c.code.add(p.glsl`vec3 vvScale(vec4 _featureAttribute) {
return clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize);
}
vec4 vvTransformPosition(vec3 position, vec4 _featureAttribute) {
return vec4(vvSymbolRotationMatrix * ( vvScale(_featureAttribute) * (position + vvSymbolAnchor)), 1.0);
}`),c.code.add(p.glsl`
      const float eps = 1.192092896e-07;
      vec4 vvTransformNormal(vec3 _normal, vec4 _featureAttribute) {
        vec3 vvScale = clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize + eps, vvSizeMaxSize);
        return vec4(vvSymbolRotationMatrix * _normal / vvScale, 1.0);
      }

      ${f.hasVvInstancing?p.glsl`
      vec4 vvLocalNormal(vec3 _normal) {
        return vvTransformNormal(_normal, instanceFeatureAttribute);
      }

      vec4 localPosition() {
        return vvTransformPosition(position, instanceFeatureAttribute);
      }`:""}
    `)):c.code.add(p.glsl`vec4 localPosition() { return vec4(position, 1.0); }
vec4 vvLocalNormal(vec3 _normal) { return vec4(_normal, 1.0); }`);f.vvColor?(c.constants.add("vvColorNumber","int",g.vvColorNumber),c.uniforms.add(new k.FloatsPassUniform("vvColorValues",w=>w.vvColor.values,g.vvColorNumber),new n.Float4sPassUniform("vvColorColors",w=>w.vvColor.colors,g.vvColorNumber)),c.code.add(p.glsl`
      vec4 interpolateVVColor(float value) {
        if (value <= vvColorValues[0]) {
          return vvColorColors[0];
        }

        for (int i = 1; i < vvColorNumber; ++i) {
          if (vvColorValues[i] >= value) {
            float f = (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);
            return mix(vvColorColors[i-1], vvColorColors[i], f);
          }
        }
        return vvColorColors[vvColorNumber - 1];
      }

      vec4 vvGetColor(vec4 featureAttribute) {
        return interpolateVVColor(featureAttribute.y);
      }

      ${f.hasVvInstancing?p.glsl`
            vec4 vvColor() {
              return vvGetColor(instanceFeatureAttribute);
            }`:"vec4 vvColor() { return vec4(1.0); }"}
    `)):c.code.add(p.glsl`vec4 vvColor() { return vec4(1.0); }`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/Float4sPassUniform":function(){define(["exports","./Uniform","../shaderTechnique/BindType"],function(a,b,n){class k extends b.Uniform{constructor(p,h,e){super(p,"vec4",n.BindType.Pass,(g,d,f)=>g.setUniform4fv(p,h(d,f)),e)}}a.Float4sPassUniform=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/FloatsPassUniform":function(){define(["exports",
"./Uniform","../shaderTechnique/BindType"],function(a,b,n){class k extends b.Uniform{constructor(p,h,e){super(p,"float",n.BindType.Pass,(g,d,f)=>g.setUniform1fv(p,h(d,f)),e)}}a.FloatsPassUniform=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/VisualVariablePassParameters":function(){define(["exports","../../layers/support/FastSymbolUpdates","../lib/Material"],function(a,b,n){class k extends b.VisualVariablesParameters{constructor(){super(...arguments);
this.renderOccluded=n.RenderOccludedFlag.Occlude;this.isDecoration=!1}}a.VisualVariablePassParameters=k;a.vvColorNumber=8;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,b){a.ColorConversion=function(n){n.code.add(b.glsl`vec4 premultiplyAlpha(vec4 v) {
return vec4(v.rgb * v.a, v.a);
}
vec3 rgb2hsv(vec3 c) {
vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);
vec4 p = c.g < c.b ? vec4(c.bg, K.wz) : vec4(c.gb, K.xy);
vec4 q = c.r < p.x ? vec4(p.xyw, c.r) : vec4(c.r, p.yzx);
float d = q.x - min(q.w, q.y);
float e = 1.0e-10;
return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), min(d / (q.x + e), 1.0), q.x);
}
vec3 hsv2rgb(vec3 c) {
vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);
vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);
return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);
}
float rgb2v(vec3 c) {
return max(c.x, max(c.y, c.z));
}`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/RgbaFloatEncoding.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,b){a.RgbaFloatEncoding=function(n){n.code.add(b.glsl`const float MAX_RGBA_FLOAT =
255.0 / 256.0 +
255.0 / 256.0 / 256.0 +
255.0 / 256.0 / 256.0 / 256.0 +
255.0 / 256.0 / 256.0 / 256.0 / 256.0;
const vec4 FIXED_POINT_FACTORS = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);
vec4 float2rgba(const float value) {
float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);
vec4 fixedPointU8 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);
const float toU8AsFloat = 1.0 / 255.0;
return fixedPointU8 * toU8AsFloat;
}`);n.code.add(b.glsl`const vec4 RGBA_2_FLOAT_FACTORS = vec4(
255.0 / (256.0),
255.0 / (256.0 * 256.0),
255.0 / (256.0 * 256.0 * 256.0),
255.0 / (256.0 * 256.0 * 256.0 * 256.0)
);
float rgba2float(vec4 rgba) {
return dot(rgba, RGBA_2_FLOAT_FACTORS);
}`);n.code.add(b.glsl`const vec4 uninterpolatedRGBAToFloatFactors = vec4(
1.0 / 256.0,
1.0 / 256.0 / 256.0,
1.0 / 256.0 / 256.0 / 256.0,
1.0 / 256.0 / 256.0 / 256.0 / 256.0
);
float uninterpolatedRGBAToFloat(vec4 rgba) {
return (dot(round(rgba * 255.0), uninterpolatedRGBAToFloatFactors) - 0.5) * 2.0;
}`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/Float4DrawUniform":function(){define(["exports","./Uniform","../shaderTechnique/BindType"],function(a,b,n){class k extends b.Uniform{constructor(p,h){super(p,"vec4",n.BindType.Draw,(e,g,d)=>e.setUniform4fv(p,h(g,d)))}}a.Float4DrawUniform=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/OITPass":function(){define(["exports"],function(a){a.OITPass=
void 0;var b=a.OITPass||(a.OITPass={});b[b.NONE=0]="NONE";b[b.ColorAlpha=1]="ColorAlpha";b[b.FrontFace=2]="FrontFace";b[b.COUNT=3]="COUNT";Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/HUDMaterialTechnique":function(){define("require exports ../core/shaderLibrary/ShaderOutput ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../lib/OITPass ../lib/OrderIndependentTransparency ../../../../chunks/HUDMaterial.glsl ../../../webgl/enums ../../../webgl/renderState".split(" "),
function(a,b,n,k,p,h,e,g,d,f){class c extends p.ShaderTechnique{constructor(w,x,u){super(w,x,new k.ReloadableShaderModule(g.HUDMaterial,()=>new Promise((t,m)=>a(["./HUDMaterial.glsl"],t,m))),u);this.primitiveType=x.occlusionPass?d.PrimitiveType.POINTS:d.PrimitiveType.TRIANGLES}initializePipeline(w){const {oitPass:x,hasPolygonOffset:u,draped:t,output:m,depthTestEnabled:q}=w;w=x===h.OITPass.NONE;const r=u?l:null;var v=x===h.OITPass.ColorAlpha;v=t||!q||v||m===n.ShaderOutput.Highlight?null:f.defaultDepthWrite;
return f.makePipelineState({blending:m===n.ShaderOutput.Color?w?f.blendWithPremultipliedAlpha:e.oitBlending(x):null,depthTest:q&&!t?{func:d.CompareFunction.LEQUAL}:null,depthWrite:v,drawBuffers:e.getDrawBuffers(x,m),colorWrite:f.defaultColorWrite,polygonOffset:r})}}const l={factor:0,units:-4};b.HUDMaterialTechnique=c;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/OrderIndependentTransparency":function(){define(["exports","../core/shaderLibrary/ShaderOutput",
"./OITPass","../../../webgl/enums","../../../webgl/renderState"],function(a,b,n,k,p){const h=p.separateBlendingParams(k.BlendFactor.ONE,k.BlendFactor.ZERO,k.BlendFactor.ONE,k.BlendFactor.ONE_MINUS_SRC_ALPHA),e={factor:-1,units:-2};a.OITPolygonOffset=e;a.OITPolygonOffsetLimit=5E5;a.blending=function(g){switch(g){case n.OITPass.NONE:return p.premultipliedAlphaToPremultipliedAlpha;case n.OITPass.ColorAlpha:return h;case n.OITPass.FrontFace:case n.OITPass.COUNT:return null}};a.blendingColorAlpha=h;a.depthWrite=
function(g){if(g.draped)return null;switch(g.oitPass){case n.OITPass.NONE:case n.OITPass.FrontFace:return g.writeDepth?p.defaultDepthWrite:null;case n.OITPass.ColorAlpha:case n.OITPass.COUNT:return null}};a.getDrawBuffers=function(g,d){d=b.isColorEmission(d);return g===n.OITPass.ColorAlpha?d?{buffers:[k.ColorAttachment.COLOR_ATTACHMENT0,k.ColorAttachment.COLOR_ATTACHMENT1,k.ColorAttachment.COLOR_ATTACHMENT2]}:{buffers:[k.ColorAttachment.COLOR_ATTACHMENT0,k.ColorAttachment.COLOR_ATTACHMENT1]}:d?{buffers:[k.ColorAttachment.COLOR_ATTACHMENT0,
k.ColorAttachment.COLOR_ATTACHMENT1]}:null};a.getOITPolygonOffset=function(g){return g?e:null};a.oitBlending=function(g){return g===n.OITPass.FrontFace?null:h};a.oitDepthTest=function(g,d=k.CompareFunction.LESS){return g===n.OITPass.NONE||g===n.OITPass.FrontFace?d:k.CompareFunction.LEQUAL};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/HUDMaterialTechniqueConfiguration":function(){define("exports ../../../../chunks/tslib.es6 ../core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl ../core/shaderLibrary/output/Emissions.glsl ../core/shaderTechnique/ShaderTechniqueConfiguration ../materials/DefaultTechniqueConfiguration".split(" "),
function(a,b,n,k,p,h){class e extends h.DefaultTechniqueConfiguration{constructor(g){super();this.spherical=g;this.screenCenterOffsetUnitsEnabled=!1;this.occlusionTestEnabled=!0;this.hasPolygonOffset=this.hasSlicePlane=this.debugDrawLabelBorder=this.hasRotation=this.hasScreenSizePerspective=this.hasVerticalOffset=this.vvColor=this.vvSize=this.sampleSignedDistanceFieldTexelCenter=this.signedDistanceFieldEnabled=!1;this.pixelSnappingEnabled=this.depthTestEnabled=!0;this.objectAndLayerIdColorInstanced=
this.occludedFragmentFade=this.occlusionPass=this.cullAboveTerrain=this.terrainDepthTest=this.draped=!1;this.horizonCullingEnabled=!0;this.textureCoordinateType=n.TextureCoordinateType.None;this.emissionSource=k.EmissionSource.None;this.hasSliceInVertexProgram=this.discardInvisibleFragments=!0;this.hasVvInstancing=!1}}b.__decorate([p.parameter()],e.prototype,"screenCenterOffsetUnitsEnabled",void 0);b.__decorate([p.parameter()],e.prototype,"occlusionTestEnabled",void 0);b.__decorate([p.parameter()],
e.prototype,"signedDistanceFieldEnabled",void 0);b.__decorate([p.parameter()],e.prototype,"sampleSignedDistanceFieldTexelCenter",void 0);b.__decorate([p.parameter()],e.prototype,"vvSize",void 0);b.__decorate([p.parameter()],e.prototype,"vvColor",void 0);b.__decorate([p.parameter()],e.prototype,"hasVerticalOffset",void 0);b.__decorate([p.parameter()],e.prototype,"hasScreenSizePerspective",void 0);b.__decorate([p.parameter()],e.prototype,"hasRotation",void 0);b.__decorate([p.parameter()],e.prototype,
"debugDrawLabelBorder",void 0);b.__decorate([p.parameter()],e.prototype,"hasSlicePlane",void 0);b.__decorate([p.parameter()],e.prototype,"hasPolygonOffset",void 0);b.__decorate([p.parameter()],e.prototype,"depthTestEnabled",void 0);b.__decorate([p.parameter()],e.prototype,"pixelSnappingEnabled",void 0);b.__decorate([p.parameter()],e.prototype,"draped",void 0);b.__decorate([p.parameter()],e.prototype,"terrainDepthTest",void 0);b.__decorate([p.parameter()],e.prototype,"cullAboveTerrain",void 0);b.__decorate([p.parameter()],
e.prototype,"occlusionPass",void 0);b.__decorate([p.parameter()],e.prototype,"occludedFragmentFade",void 0);b.__decorate([p.parameter()],e.prototype,"objectAndLayerIdColorInstanced",void 0);b.__decorate([p.parameter()],e.prototype,"horizonCullingEnabled",void 0);a.HUDMaterialTechniqueConfiguration=e;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl":function(){define(["exports","../../../../../../core/compilerUtils",
"../../shaderModules/interfaces","../../../lib/VertexAttribute"],function(a,b,n,k){a.TextureCoordinateType=void 0;(function(p){p[p.None=0]="None";p[p.Default=1]="Default";p[p.Atlas=2]="Atlas";p[p.Compressed=3]="Compressed";p[p.COUNT=4]="COUNT"})(a.TextureCoordinateType||(a.TextureCoordinateType={}));a.TextureCoordinateAttribute=function(p,h){switch(h.textureCoordinateType){case a.TextureCoordinateType.Default:p.attributes.add(k.VertexAttribute.UV0,"vec2");p.varyings.add("vuv0","vec2");p.vertex.code.add(n.glsl`void forwardTextureCoordinates() {
vuv0 = uv0;
}`);break;case a.TextureCoordinateType.Compressed:p.attributes.add(k.VertexAttribute.UV0,"vec2");p.varyings.add("vuv0","vec2");p.vertex.code.add(n.glsl`vec2 getUV0() {
return uv0 / 16384.0;
}
void forwardTextureCoordinates() {
vuv0 = getUV0();
}`);break;case a.TextureCoordinateType.Atlas:p.attributes.add(k.VertexAttribute.UV0,"vec2");p.varyings.add("vuv0","vec2");p.attributes.add(k.VertexAttribute.UVREGION,"vec4");p.varyings.add("vuvRegion","vec4");p.vertex.code.add(n.glsl`void forwardTextureCoordinates() {
vuv0 = uv0;
vuvRegion = uvRegion;
}`);break;default:b.neverReached(h.textureCoordinateType);case a.TextureCoordinateType.None:p.vertex.code.add(n.glsl`void forwardTextureCoordinates() {}`);case a.TextureCoordinateType.COUNT:}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/output/Emissions.glsl":function(){define("exports ../ShaderOutput ../attributes/VertexTextureCoordinates.glsl ../../shaderModules/Float3DrawUniform ../../shaderModules/Float3PassUniform ../../shaderModules/interfaces ../../shaderModules/Texture2DDrawUniform ../../shaderModules/Texture2DPassUniform ../../shaderTechnique/BindType ../../../lib/GLTextureMaterial".split(" "),
function(a,b,n,k,p,h,e,g,d,f){a.EmissionSource=void 0;(function(l){l[l.None=0]="None";l[l.Value=1]="Value";l[l.Texture=2]="Texture";l[l.COUNT=3]="COUNT"})(a.EmissionSource||(a.EmissionSource={}));class c extends f.GLEmissiveTexturePassParameters{}a.Emissions=function(l,w){if(b.isColorOrColorEmission(w.output)){var {emissionSource:x,hasEmissiveTextureTransform:u,bindType:t}=w,m=x===a.EmissionSource.Texture;m&&(l.include(n.VertexTextureCoordinates,w),l.fragment.uniforms.add(t===d.BindType.Pass?new g.Texture2DPassUniform("texEmission",
q=>q.textureEmissive):new e.Texture2DDrawUniform("texEmission",q=>q.textureEmissive)));(w=x===a.EmissionSource.Value||m)&&l.fragment.uniforms.add(t===d.BindType.Pass?new p.Float3PassUniform("emissionFactor",q=>q.emissiveFactor):new k.Float3DrawUniform("emissionFactor",q=>q.emissiveFactor));l.fragment.code.add(h.glsl`
    vec4 getEmissions() {
      vec4 emissions = ${w?"vec4(emissionFactor, 1.0)":"vec4(0.0)"};
      ${h.If(m,`emissions *= textureLookup(texEmission, ${u?"emissiveUV":"vuv0"});\n         emissions.w = emissions.rgb == vec3(0.0) ? 0.0: emissions.w;`)};
      return emissions;
    }
  `)}};a.EmissionsParameters=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/VertexTextureCoordinates.glsl":function(){define(["exports","./TextureCoordinateAttribute.glsl","../util/TextureAtlasLookup.glsl","../../shaderModules/interfaces"],function(a,b,n,k){a.VertexTextureCoordinates=function(p,h){const {textureCoordinateType:e}=h;e!==b.TextureCoordinateType.None&&e!==b.TextureCoordinateType.COUNT&&(p.include(b.TextureCoordinateAttribute,
h),(h=e===b.TextureCoordinateType.Atlas)&&p.include(n.TextureAtlasLookup),p.fragment.code.add(k.glsl`
    vec4 textureLookup(sampler2D tex, vec2 uv) {
      return ${h?"textureAtlasLookup(tex, uv, vuvRegion)":"texture(tex, uv)"};
    }
  `))};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/TextureAtlasLookup.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,b){a.TextureAtlasLookup=function(n){n.fragment.code.add(b.glsl`vec4 textureAtlasLookup(sampler2D tex, vec2 textureCoordinates, vec4 atlasRegion) {
vec2 atlasScale = atlasRegion.zw - atlasRegion.xy;
vec2 uvAtlas = fract(textureCoordinates) * atlasScale + atlasRegion.xy;
float maxdUV = 0.125;
vec2 dUVdx = clamp(dFdx(textureCoordinates), -maxdUV, maxdUV) * atlasScale;
vec2 dUVdy = clamp(dFdy(textureCoordinates), -maxdUV, maxdUV) * atlasScale;
return textureGrad(tex, uvAtlas, dUVdx, dUVdy);
}`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/Texture2DDrawUniform":function(){define(["exports","./Uniform","../shaderTechnique/BindType"],function(a,b,n){class k extends b.Uniform{constructor(p,h){super(p,"sampler2D",n.BindType.Draw,(e,g,d)=>e.bindTexture(p,h(g,d)))}}a.Texture2DDrawUniform=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/DefaultTechniqueConfiguration":function(){define("exports ../../../../chunks/tslib.es6 ../core/shaderLibrary/ShaderOutput ../core/shaderLibrary/attributes/InstancedDoubleConfiguration ../core/shaderTechnique/BindType ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/OITPass".split(" "),
function(a,b,n,k,p,h,e){class g extends k.InstancedDoubleConfiguration{constructor(){super(...arguments);this.output=n.ShaderOutput.Color;this.oitPass=e.OITPass.NONE;this.hasSliceHighlight=!0;this.hasSliceInVertexProgram=!1;this.bindType=p.BindType.Pass;this.writeDepth=!0}}b.__decorate([h.parameter({count:n.ShaderOutput.COUNT})],g.prototype,"output",void 0);b.__decorate([h.parameter({count:e.OITPass.COUNT})],g.prototype,"oitPass",void 0);a.DefaultTechniqueConfiguration=g;Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/InstancedDoubleConfiguration":function(){define(["exports","../../../../../../chunks/tslib.es6","../../shaderTechnique/ShaderTechniqueConfiguration"],function(a,b,n){class k extends n.ShaderTechniqueConfiguration{constructor(){super(...arguments);this.hasModelTransformation=this.instancedDoublePrecision=!1}}b.__decorate([n.parameter()],k.prototype,"instancedDoublePrecision",void 0);b.__decorate([n.parameter()],k.prototype,
"hasModelTransformation",void 0);a.InstancedDoubleConfiguration=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/LabelDeconflictor":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/Logger ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ./Deconflictor ./enums ../../../support/RenderState ../../../support/Yield".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c){a.LabelDeconflictor=class extends g.Deconflictor{constructor(l){super(l);this.visibilityGroup=d.VisibilityGroup.LABEL;this.marginFactor=.05;this._lastDeconfliction=0}get viewState(){return this.parent.viewState}runTask(l){if(this.parent.running)return c.Yield;const w=performance.now();if(l.state!==f.RenderState.IDLE&&2E3>w-this._lastDeconfliction)return c.Yield;super.runTask(l);this.state===g.State.Idle&&(this._lastDeconfliction=w)}enabledChanged(l,w){this.modifyGraphics(w,
l.labelsEnabled)}getGraphicsLayers(l){return l.labelLayers}};b.__decorate([n.property({constructOnly:!0})],a.LabelDeconflictor.prototype,"parent",void 0);a.LabelDeconflictor=b.__decorate([e.subclass("esri.views.3d.layers.graphics.LabelDeconflictor")],a.LabelDeconflictor);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Labeler":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/asyncUtils ../../../../core/has ../../../../core/Logger ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ../../../../core/libs/gl-matrix-2/factories/vec2f64 ../../../../layers/graphics/hydratedFeatures ../../../../layers/support/labelFormatUtils ../../../../symbols/callouts/calloutUtils ./enums ./Graphics3DCalloutSymbolLayerFactory ./Graphics3DLineCalloutSymbolLayer ./graphicSymbolUtils ./LabelParameters ./labelPlacement ./placementUtils ../../../../geometry/support/Indices ./pipeline/rendering/FeaturePipelineRenderManager ../../webgl-engine/lib/BoundingInfo ../../webgl-engine/lib/VertexAttribute ../../../ViewingMode ../../support/buffer/InterleavedLayout ../../webgl-engine/core/shaderLibrary/ShaderOutput ../../webgl-engine/core/shaderLibrary/attributes/NormalAttribute.glsl ../../webgl-engine/core/shaderLibrary/output/Emissions.glsl ../../webgl-engine/core/shaderLibrary/shading/Normals.glsl ../../webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../../webgl-engine/lib/basicInterfaces ../../webgl-engine/core/shaderModules/interfaces ../../webgl-engine/lib/Material ../../webgl-engine/lib/OrderIndependentTransparency ../../webgl-engine/lib/RayIntersections ../../webgl-engine/lib/RenderSlot ../../webgl-engine/lib/verticalOffsetUtils ../../../../geometry/support/buffer/BufferView ../../../../core/mathUtils ../../../../chunks/boundedPlane ../../../../geometry/support/Axis ../../../../geometry/support/ray ../../../../geometry/support/vectorStacks ../../webgl-engine/core/shaderTechnique/BindType ../../webgl-engine/lib/DefaultVertexAttributeLocations ../../../../core/HeapSort ../../../webgl/checkWebGLError ../../../webgl/enums ../../../webgl/renderState ../../webgl-engine/lib/OITPass ../../webgl-engine/lib/StencilUtils ../support/symbolColorUtils ../../webgl-engine/core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl ../support/FastSymbolUpdates ../../webgl-engine/effects/ssao/SSAO ../../webgl-engine/core/shaderModules/ShaderBuilder ../../webgl-engine/shaders/DefaultMaterialTechniqueConfiguration ../../webgl-engine/lib/MaterialCollection ../../webgl-engine/lib/TextRenderer ../../webgl-engine/lib/TextRenderParameters ../../webgl-engine/lib/TextTextureAtlas ../../webgl-engine/lib/WebGLLayer ../../../support/Scheduler ../../../support/Yield".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w,x,u,t,m,q,r,v,y,B,z,A,C,H,E,F,G,D,I,J,N,M,Q,O,K,L,P,R,W,V,ba,U,da,fa,ha,T,S,Z,ia,Y,ea,ka,ja,X,aa,pa,la,na,qa,sa,xa,ta,Ba,Ia,Ca,Ha){function Ga(Ta,Da){Ta.geometries[0].setAttributeData(E.VertexAttribute.SIZE,[Da.displayWidth,Da.displayHeight]);Ta.geometryVertexAttributeUpdated(Ta.geometries[0],E.VertexAttribute.SIZE)}function Aa(Ta){return!0===Ta.labelsVisible&&!!Ta.labelingInfo?.some(Da=>!!Da.symbol)}class Ja{constructor(Ta,Da){this.labelingContext=Ta;this.graphics3DGraphic=
Da;this.visible=this.hasGraphics3DResources=!1;this.textureAtlasHandles=[];this.textInitialized=!1;this.textRenderers=[];this.textLabelPlacements=[]}}class Sa{constructor(Ta,Da,La,Va,ma){this.labelClass=Ta;this.graphics3DSymbol=Da;this.graphics3DCalloutSymbolLayer=La;this.textRenderParameters=Va;this.labelFunction=ma;this.calloutSymbolLayerIndex=0}}class $a{constructor(Ta,Da,La,Va,ma,za,Na,Ra){this.layer=Da;this.graphics3DCore=La;this.scaleVisibility=Va;this.emptySymbolLabelSupported=ma;this.elevationInfoOverride=
za;this.disablePlacement=Na;this.active=Ra;this.labelClassAbortController=new AbortController;this.labelClassContexts=[];this.graphics=new Map;this.labelsToInitialize=new Map;this.stageLayer=new Ia.WebGLLayer(Ta,{pickable:!0,disableOctree:!0},Da.uid)}destroy(){this.stageLayer.destroy()}}a.Labeler=class extends n{constructor(Ta){super(Ta);this._dirty=!1;this._labels=new Map;this._labelingContexts=[]}setup(){this.dispose();this.addHandles([d.watch(()=>this.view.state?.camera,()=>this.setDirty()),d.watch(()=>
this.view.state?.rasterPixelRatio,()=>this._resetAllLabels()),this.view.resourceController.scheduler.registerTask(Ca.TaskPriority.LABELER,this)]);this._textTextureAtlas=new Ba.TextTextureAtlas({view:this.view});this._hudMaterialCollection=new sa.MaterialCollection(this.view._stage);this._calloutMaterialCollection=new sa.MaterialCollection(this.view._stage)}dispose(){this.removeAllHandles();this._textTextureAtlas=e.disposeMaybe(this._textTextureAtlas);this._hudMaterialCollection=e.disposeMaybe(this._hudMaterialCollection);
this._calloutMaterialCollection=e.disposeMaybe(this._calloutMaterialCollection);this._labelingContexts.length=0;this._labels.clear()}destroy(){this.dispose();Wa.graphic=null;Wa.renderingInfo=null;Wa.layer=null}_activateLabelingContext(Ta){Ta.graphics.forEach((Da,La)=>{const Va=new Ja(Ta,Da);this._labels.set(La,Va);Ta.labelsToInitialize.set(La,Va);Da.setVisibilityFlag(m.VisibilityGroup.LABEL,m.VisibilityFlag.USER,!0)});Ta.active=!0}_deactivateLabelingContext(Ta){Ta.graphics.forEach((Da,La)=>{Da.setVisibilityFlag(m.VisibilityGroup.LABEL,
m.VisibilityFlag.USER,!1);this.setLabelGraphicVisibility(Da,!1);Da.clearLabelGraphics();this._labels.delete(La)});Ta.active=!1}_addLabelTextureToAtlas(Ta){for(const Da of Ta.graphics3DGraphic.labelLayers){if(!Da._labelClass)continue;const La=Ta.textRenderers[Da._labelIndex];La&&(Ta.textureAtlasHandles.push(this._textTextureAtlas.addText(La,Va=>{var ma=Da.stageObject;ma.geometries[0].setAttributeData(E.VertexAttribute.UV0,Va);ma.geometryVertexAttributeUpdated(ma.geometries[0],E.VertexAttribute.UV0,
!0)})),Ga(Da.stageObject,La))}}_removeLabelTextureFromAtlas(Ta){Ta.textureAtlasHandles.forEach(Da=>Da.remove());Ta.textureAtlasHandles.length=0}get running(){return this.view.ready&&(this._dirty||this.deconflictor.running)}runTask(Ta){this._updateLabels(Ta);!this._dirty&&this.deconflictor.running&&this.deconflictor.runTask(Ta);return Ha.Yield}_updateLabels(Ta){if(this._dirty){this._dirty=!1;for(const La of this._labelingContexts)if(La.active)if(La.labelClassPromise&&La.labelClassAbortController)this._dirty=
!0;else{var Da=La.labelClassContexts;if(Da&&0!==Da.length)for(const [Va,ma]of La.labelsToInitialize){this._ensureGraphics3DResources(ma)&&(this._labels.set(Va,ma),this.deconflictor.setDirty(),Ta.madeProgress());if(ma.visible&&ma.textInitialized||!ma.visible&&ma.hasGraphics3DResources)La.labelsToInitialize.delete(Va),Ta.madeProgress();if(Ta.done){this._dirty=!0;break}}else null===La.labelClassContexts?this._deactivateLabelingContext(La):(this._createLabelClassContext(La),this._dirty=!0)}this._dirty||
this.notifyChange("updating")}}async _createLabelClassContextAsync(Ta){const Da=Ta.labelClassAbortController?.signal;Ta.layer.when&&await Ta.layer.when();g.throwIfAborted(Da);Ta.scaleVisibility?.updateScaleRangeActive();const La=Ta.graphics3DCore,Va=La.layer.labelingInfo?.filter(ma=>!!ma.symbol);Va&&0!==Va.length&&(await k.forEach(Va,async(ma,za)=>{var Na=ma.symbol;const Ra=v.getGraphics3DSymbol(La.getOrCreateGraphics3DSymbol(Na));if(null==Ra)h.getLogger(this).error("Failed to create Graphics3DSymbol for label");
else{await Ra.load();g.throwIfAborted(Da);var Pa=null;t.hasCalloutSupport(Na)&&Na.hasVisibleCallout()&&(Pa=q.make(Na,La.symbolCreationContext),await Pa.load(),g.throwIfAborted(Da));Na=await k.result(u.createLabelFunction(ma,Ta.layer.fieldsIndex,this.view.spatialReference));g.throwIfAborted(Da);if(!0===Na.ok){const ca=await this._createTextRenderParameters(Ra.symbol);g.throwIfAborted(Da);Ta.labelClassContexts[za]=new Sa(ma,Ra,Pa,ca,Na.value)}else h.getLogger(this).error(`Label expression failed to evaluate: ${Na.error}`)}}),
g.throwIfAborted(Da))}async _createLabelClassContext(Ta){null==Ta.labelClassPromise&&(Ta.labelClassPromise=this._createLabelClassContextAsync(Ta).catch(Da=>{if(g.isAbortError(Da))throw Da;Ta.labelClassContexts.length=0}).then(()=>{Ta.labelClassAbortController=null;this.notifyChange("updating")}).catch(()=>{}),this.notifyChange("updating"));return Ta.labelClassPromise}async _createTextRenderParameters(Ta){Ta=Ta.symbolLayers.at(0);return"text"!==Ta?.type?null:ta.TextRenderParameters.fromSymbol(Ta,this.view.state.rasterPixelRatio)}_destroyLabelClassContext(Ta){for(var Da of Ta.labelClassContexts)--Da.graphics3DSymbol.referenced;
Da=Ta.labelClassAbortController;Ta.labelClassAbortController=new AbortController;e.abortMaybe(Da);Ta.labelClassContexts.length=0;Ta.labelClassPromise=null;this.notifyChange("updating")}_createTextSymbolGraphic(Ta,Da,La,Va,ma,za){Ta=new y.LabelParameters(La,z.horizontalPlacementFromAnchor(La.anchor),z.verticalPlacementFromAnchor(La.anchor),Ta.text,w.fromValues(Ta.displayWidth,Ta.displayHeight));Wa.graphic=Da;Wa.renderingInfo=null;Wa.layer=Va;return ma.createLabel(Wa,Ta,this._hudMaterialCollection,
this._textTextureAtlas,()=>{const Na=B.getLabelPlacement(za);return Na?Na.elevationOffset:null})}_createLineCalloutGraphic(Ta,Da,La,Va,ma){Wa.graphic=Ta;Wa.layer=ma;Wa.renderingInfo=new r.LineCalloutSymbolLayerRenderingInfo(null,Da,Va.translation,Va.centerOffset,Va.screenOffset[0],Va.centerOffsetUnits,Va.elevationOffset,this._calloutMaterialCollection);return La.createGraphics3DGraphic(Wa)}_ensureGraphics3DResources(Ta){if(Ta.hasGraphics3DResources)return!1;const Da=Ta.graphics3DGraphic;if(Da.destroyed)return!1;
this._ensureTextTextureResources(Ta);const La=Ta.labelingContext,Va=La.labelClassContexts;if(!Va||0===Va.length||!La.emptySymbolLabelSupported&&0===Da.layers.length)return!1;var ma=!1,za=Da.graphic;const Na=La.layer;var Ra=Aa(La.layer);for(let ca=0;ca<Va.length;ca++){const cb=Ta.textRenderers[ca],ib=Ta.textLabelPlacements[ca];if(null==cb||null==ib)continue;const nb=Va[ca];var Pa=nb.graphics3DSymbol;const xb=Pa.symbol&&"label-3d"===Pa.symbol.type?Pa.symbol:null;if(Pa=Pa.symbolLayers[0]){Pa.setElevationInfoOverride(La.elevationInfoOverride);
ma=new B.LabelInfo(Da,xb,nb.labelClass);ma=this._createTextSymbolGraphic(cb,za,ib,Na,Pa,ma);if(null==ma)return!1;ma._labelClass=nb.labelClass;ma._labelIndex=ca;Da.addLabelGraphic(ma,La.stageLayer);Da.deconflictionPriority=nb.textRenderParameters?.definition.size??0;Da.setVisibilityFlag(m.VisibilityGroup.LABEL,m.VisibilityFlag.USER,Ra);Da.setVisibilityFlag(m.VisibilityGroup.LABEL,m.VisibilityFlag.SCALE_RANGE,!0);Da.setVisibilityFlag(m.VisibilityGroup.LABEL,m.VisibilityFlag.DECONFLICTION,!1);ma=!0;
(Ra=nb.graphics3DCalloutSymbolLayer)&&ib.hasLabelVerticalOffset&&(Ra.setElevationInfoOverride(La.elevationInfoOverride),za=this._createLineCalloutGraphic(za,xb,Ra,ib,Na),null!=za&&(nb.calloutSymbolLayerIndex=Da.labelLayers.length,Da.addLabelGraphic(za,La.stageLayer)));break}}ma&&La.scaleVisibility?.updateGraphicLabelScaleVisibility(Da);return Ta.hasGraphics3DResources=!0}_destroyGraphics3DResources(Ta){const Da=Ta.labelingContext.labelClassContexts;for(const La of Ta.graphics3DGraphic.labelLayers)if(null!=
La._labelClass)Da[La._labelIndex].graphics3DSymbol.symbolLayers[0]?.onRemoveGraphic(La);Ta.graphics3DGraphic.deconflictionPriority=0;Ta.graphics3DGraphic.clearLabelGraphics();Ta.hasGraphics3DResources=!1}_ensureTextTextureResources(Ta){if(!Ta.textInitialized){var Da=Ta.labelingContext,La=Da.labelClassContexts;if(La&&0!==La.length){var Va=Ta.graphics3DGraphic.graphic;for(let Na=0;Na<La.length;Na++){const Ra=La[Na];Ta.textRenderers[Na]=null;Ta.textLabelPlacements[Na]=null;if(null==Ra?.textRenderParameters)continue;
var ma=Ra.labelFunction;let Pa;if("arcade"===ma.type)try{const ca=ma.needsHydrationToEvaluate()?x.hydrateGraphic(Va,Da.layer):Va;Pa=ma.evaluate(ca)}catch(ca){Pa=null}else Pa=ma.evaluate(Va);if(null!=Pa&&""!==Pa&&!/^\s+$/.test(Pa)&&(ma=Ra.graphics3DSymbol,ma.symbolLayers[0]&&(ma=B.getLabelPlacement({graphics3DGraphic:Ta.graphics3DGraphic,labelSymbol:"label-3d"===ma.symbol?.type?ma.symbol:null,labelClass:Ra.labelClass,disablePlacement:Da.disablePlacement}),null!=ma))){var za=z.horizontalPlacementFromAnchor(ma.anchor);
za=z.textRenderAlignmentFromHorizontalPlacement(za);Ta.textRenderers[Na]=new xa.TextRenderer(Pa,za,Ra.textRenderParameters,Ba.TextTextureAtlas.maxSize);Ta.textLabelPlacements[Na]=ma}}Ta.textInitialized=!0}}}_destroyTextTextureResources(Ta){Ta.textInitialized=!1;Ta.textRenderers.length=0;Ta.textLabelPlacements.length=0}_addGraphic(Ta,Da){const La=Da.graphic.uid;Ta.graphics.set(La,Da);Ta.active&&(Da=new Ja(Ta,Da),this._labels.set(La,Da),Ta.labelsToInitialize.set(La,Da));this.setDirty();this.deconflictor.setDirty()}_updateGraphicGeometry(Ta,
Da){const La=this._labels.get(Da.graphic.uid);if(!La)return!0;for(const Va of La.graphics3DGraphic.labelLayers)if(null!=Va._labelClass&&!Ta.labelClassContexts[Va._labelIndex].graphics3DSymbol.symbolLayers[0].updateGeometry(Va,Da.graphic.geometry))return!1;this.setDirty();this.deconflictor.setDirty();return!0}_removeGraphic(Ta,Da){Da=Da.graphic.uid;const La=this._labels.get(Da);Ta.graphics.delete(Da);La&&(this._destroyGraphic(La,Da),Ta.labelsToInitialize.delete(Da),this.setDirty(),this.deconflictor.setDirty())}_destroyGraphic(Ta,
Da){this._labels.delete(Da);Ta.textureAtlasHandles.length&&this._removeLabelTextureFromAtlas(Ta);this._destroyTextTextureResources(Ta);Ta.hasGraphics3DResources&&this._destroyGraphics3DResources(Ta)}async _labelingInfoChange(Ta,Da){if(Da)for(const La of Da){if(Da=Ta.graphics.get(La))this._removeGraphic(Ta,Da),this._addGraphic(Ta,Da)}else return this._visibilityInfoChange(Ta),this._resetLabels(Ta),this._createLabelClassContext(Ta)}_globalPropertyChanged(Ta,Da){for(const La of Da.labelClassContexts){const Va=
new Map;Da.graphics.forEach(ma=>Va.set(ma.graphic.uid,ma));La.graphics3DSymbol.symbolLayers[0].globalPropertyChanged(Ta,Va,ma=>ma.labelLayers[0]);La.graphics3DCalloutSymbolLayer&&La.graphics3DCalloutSymbolLayer.globalPropertyChanged(Ta,Va,ma=>ma.labelLayers[La.calloutSymbolLayerIndex])}}_visibilityInfoChange(Ta){const Da=Aa(Ta.layer);Da&&!Ta.active&&this._activateLabelingContext(Ta);!Da&&Ta.active&&this._deactivateLabelingContext(Ta);this.setDirty()}_resetAllLabels(){for(const Ta of this._labelingContexts)this._resetLabels(Ta)}_resetLabels(Ta){Ta.graphics.forEach((Da,
La)=>{if(Da=this._labels.get(La))this._destroyGraphic(Da,La),Da.visible=!1,Ta.labelsToInitialize.set(La,Da)});this._destroyLabelClassContext(Ta);this.setDirty();this.deconflictor.setDirty()}_findLabelingContext(Ta){for(const Da of this._labelingContexts)if(Da.graphics3DCore===Ta)return Da;return null}addGraphicsOwner(Ta,Da,La){const Va=La?.emptySymbolLabelSupported||!1,ma=La?.elevationInfoOverride||null;La=La?.disablePlacement||null;if(!this._findLabelingContext(Ta)){var za=Ta.layer,Na=new $a(this.view._stage,
za,Ta,Da,Va,ma,La,Aa(za));this._labelingContexts.push(Na);this.setDirty();return{addGraphic:Ra=>this._addGraphic(Na,Ra),removeGraphic:Ra=>this._removeGraphic(Na,Ra),updateGraphicGeometry:Ra=>this._updateGraphicGeometry(Na,Ra),layerLabelsEnabled:()=>Aa(Na.layer),labelingInfoChange:Ra=>this._labelingInfoChange(Na,Ra),elevationInfoChange:()=>this._globalPropertyChanged("elevationInfo",Na),slicePlaneEnabledChange:()=>this._globalPropertyChanged("slicePlaneEnabled",Na),visibilityInfoChange:()=>this._visibilityInfoChange(Na),
reset:()=>this._resetLabels(Na),remove:()=>this._removeGraphicsOwner(Ta),setDirty:()=>this.setDirty()}}}_removeGraphicsOwner(Ta){const Da=this._findLabelingContext(Ta);Da&&(Ta=this._labelingContexts.indexOf(Da),this._labelingContexts.splice(Ta,1),Da.graphics.forEach(La=>this._removeGraphic(Da,La)),Da.destroy(),this.setDirty())}setLabelGraphicVisibility(Ta,Da){Ta=Ta.graphic.uid;const La=this._labels.get(Ta);La&&La.visible!==Da&&(Da&&!La.textureAtlasHandles.length?(this._addLabelTextureToAtlas(La),
La.textInitialized||La.labelingContext.labelsToInitialize.set(Ta,La)):!Da&&La.textureAtlasHandles.length&&this._removeLabelTextureFromAtlas(La),La.visible=Da,this.setDirty())}setDirty(){!this._dirty&&0<this._labelingContexts.length&&(this._dirty=!0,this.notifyChange("updating"))}get updating(){return this._dirty||this._textTextureAtlas?.updating||this.deconflictor.updating||this._labelingContexts.some(Ta=>!!Ta.labelClassPromise&&!!Ta.labelClassAbortController)}get updatingProgress(){if(!this.updating||
!this._textTextureAtlas)return 1;const Ta=0<this._labelingContexts.length?this._labelingContexts.reduce((Da,La)=>Da+(La.labelClassPromise&&La.labelClassAbortController?0:1),0)/this._labelingContexts.length:1;return(this._dirty?0:.3)+(this._textTextureAtlas.updating?0:.1)+.1*Ta+.5*this.deconflictor.updatingProgress}get test(){}};b.__decorate([f.property({constructOnly:!0})],a.Labeler.prototype,"view",void 0);b.__decorate([f.property({constructOnly:!0})],a.Labeler.prototype,"deconflictor",void 0);b.__decorate([f.property()],
a.Labeler.prototype,"_textTextureAtlas",void 0);b.__decorate([f.property({type:Boolean,readOnly:!0})],a.Labeler.prototype,"updating",null);a.Labeler=b.__decorate([l.subclass("esri.views.3d.layers.graphics.Labeler")],a.Labeler);const Wa=new r.LineCalloutCreationContext(null,null,null);a.areLabelsVisible=Aa;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/hydratedFeatures":function(){define("exports ../../geometry ../../Graphic ../../core/has ../../core/lang ../../core/typedArrayUtil ../../geometry/support/jsonUtils ./dehydratedPoint ../../geometry/SpatialReference".split(" "),
function(a,b,n,k,p,h,e,g,d){function f(r){return"declaredClass"in r}function c(r){return"declaredClass"in r}function l(r){return"declaredClass"in r}function w(r){return null==r?null:f(r)?r:e.fromJSON(x(r))}function x(r){const {wkid:v,wkt:y,wkt2:B,latestWkid:z}=r.spatialReference,A={wkid:v,wkt:y,wkt2:B,latestWkid:z};switch(r.type){case "point":const {x:C,y:H,z:E,m:F}=r;return{x:C,y:H,z:E,m:F,spatialReference:A};case "polygon":const {rings:G,hasZ:D,hasM:I}=r;return{rings:u(G),hasZ:D,hasM:I,spatialReference:A};
case "polyline":const {paths:J,hasZ:N,hasM:M}=r;return{paths:u(J),hasZ:N,hasM:M,spatialReference:A};case "extent":const {xmin:Q,xmax:O,ymin:K,ymax:L,zmin:P,zmax:R,mmin:W,mmax:V,hasZ:ba,hasM:U}=r;return{xmin:Q,xmax:O,ymin:K,ymax:L,zmin:P,zmax:R,mmin:W,mmax:V,hasZ:ba,hasM:U,spatialReference:A};case "multipoint":const {points:da,hasZ:fa,hasM:ha}=r;return{points:q(da)?t(da):da,hasZ:fa,hasM:ha,spatialReference:A}}}function u(r){return m(r)?r.map(v=>t(v)):r}function t(r){return r.map(v=>Array.from(v))}
function m(r){for(const v of r)if(0!==v.length)return q(v);return!1}function q(r){return 0<r.length&&(h.isFloat32Array(r[0])||h.isFloat64Array(r[0]))}a.clonePoint=function(r,v){if(!r)return null;if(c(r)){if(null==v)return r.clone();if(c(v))return v.copy(r)}null!=v?(v.x=r.x,v.y=r.y,v.spatialReference=r.spatialReference,r.hasZ?(v.z=r.z,v.hasZ=r.hasZ):(v.z=void 0,v.hasZ=!1),r.hasM?(v.m=r.m,v.hasM=!0):(v.m=void 0,v.hasM=!1)):(v=g.makeDehydratedPoint(r.x,r.y,r.z,r.spatialReference),r.hasM&&(v.m=r.m,v.hasM=
!0));return v};a.hydrateGeometry=w;a.hydrateGraphic=function(r,v){return r?l(r)?r:new n({layer:v,sourceLayer:v,visible:r.visible,symbol:p.clone(r.symbol),attributes:p.clone(r.attributes),geometry:w(r.geometry)}):null};a.hydratedSpatialReference=function(r){const {wkid:v,wkt:y,wkt2:B,latestWkid:z}=r;return d.fromJSON({wkid:v,wkt:y,wkt2:B,latestWkid:z})};a.isHydratedGeometry=f;a.isHydratedGraphic=l;a.isHydratedPoint=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/labelFormatUtils":function(){define("exports ../../core/Error ../../core/Logger ../../core/sql ../../intl/date ../../intl/number ./domainUtils ./fieldUtils ./labelUtils ../../support/arcadeOnDemand".split(" "),
function(a,b,n,k,p,h,e,g,d,f){function c(u,t){if(null==u)return"";const m=t.domain;if(m)if("codedValue"===m.type||"coded-value"===m.type)for(var q of m.codedValues){if(q.code===u)return q.name}else if("range"===m.type){const {max:r,min:v}=e.getDomainRange(t);q=+u;if(null!=v&&null!=r&&v<=q&&q<=r)return m.name}g.isDateField(t)?u=p.formatDate(u,p.convertDateFormatToIntlOptions("short-date")):g.isNumericField(t)&&(u=h.formatNumber(+u));return u||""}const l=()=>n.getLogger("esri.layers.support.labelFormatUtils"),
w={type:"simple",evaluate(){return null}},x={getAttribute(u,t){return u.field(t)}};a.createLabelFunction=async function(u,t,m){if(!u||!u.symbol||!t)return w;const q=u.where,r=d.getLabelExpression(u);if("arcade"===r.type){const v=await f.createLabelExpression(r.expression,m,t);if(null==v)return w;u={type:"arcade",evaluate(y,B){try{const z="attributes"in y?v.repurposeFeature(y):y;z.contextTimeZone=B??null;const A=v.evaluate({$view:{timeZone:B},$feature:z},v.services);if(null!=A)return A.toString()}catch(z){l().error(new b("arcade-expression-error",
"Encountered an error when evaluating label expression for feature",{error:z,feature:y,expression:r}))}return null},needsHydrationToEvaluate(){return null==d.getSingleFieldArcadeExpression(r.expression)}}}else u={type:"simple",evaluate(v){return r.expression.replaceAll(/{[^}]*}/g,y=>{var B=y.slice(1,-1);B=t.get(B);if(!B)return y;y=null;"attributes"in v?v&&v.attributes&&(y=v.attributes[B.name]):y=v.field(B.name);return null==y?"":c(y,B)})}};if(q){let v;try{v=await k.parseWhereClause(q,t)}catch(B){return l().error(new b("bad-where-clause",
"Encountered an error when evaluating where clause, ignoring",{where:q,error:B})),w}const y=u.evaluate;u.evaluate=(B,z)=>{const A="attributes"in B?void 0:x;try{if(v.testFeature(B,A))return y(B,z)}catch(C){l().error(new b("bad-where-clause","Encountered an error when evaluating where clause for feature",{where:q,feature:B,error:C}))}return null}}return u};a.formatField=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DCalloutSymbolLayerFactory":function(){define(["exports",
"../../../../core/Logger","../../../../symbols/callouts/calloutUtils","./Graphics3DLineCalloutSymbolLayer"],function(a,b,n,k){const p=()=>b.getLogger("esri.views.3d.layers.graphics.Graphics3DCalloutSymbolLayerFactory"),h={line:k.Graphics3DLineCalloutSymbolLayer};a.make=function(e,g){if(!n.hasCalloutSupport(e))return p().error("Graphics3DCalloutSymbolLayerFactory#make",`symbol of type '${e.type}' does not support callouts`),null;if(!e.callout)return null;const d=h[e.callout.type];return d?new d(e,
g):(p().error("Graphics3DCalloutSymbolLayerFactory#make",`unknown or unsupported callout type ${e.callout.type}`),null)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DLineCalloutSymbolLayer":function(){define("exports ../../../../Color ../../../../core/screenUtils ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../core/libs/gl-matrix-2/factories/vec4f64 ../../../../symbols/callouts/calloutUtils ./ElevationAligners ./elevationAlignmentUtils ./ElevationContext ./Graphics3DGraphicCreationContext ./Graphics3DObject3DGraphicLayer ./Graphics3DObjectMetadata ./Graphics3DSymbolLayer ./graphicUtils ./pointUtils ./SymbolComplexity ../../webgl-engine/lib/Attribute ../../webgl-engine/lib/ContentObjectType ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/VertexAttribute ../../webgl-engine/materials/LineCalloutMaterial".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w,x,u,t,m,q,r,v,y){class B extends w.Graphics3DSymbolLayer{constructor(F,G){super(F,null,G,C);this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1};this.ensureDrapedStatus(!1)}async doLoad(){this._materials[0]=new y.LineCalloutMaterial(this._materialParameters,this._context.spherical);this._context.stage.add(this._materials[0])}destroy(){super.destroy();this._context.stage.remove(this._materials[0]);this._materials.length=0}_perInstanceMaterialParameters(F){const G=
this._materialParameters;G.horizontalScreenOffset=F.horizontalScreenOffset??0;G.centerOffsetUnits=F.centerOffsetUnits||"world";return G}get _materialParameters(){const F=new y.Parameters;var G=this.symbol,D=G.callout;if(D.color){const I=b.toUnitRGBA(D.color);I[3]*=this._getLayerOpacity();F.color=I}else F.color=p.ZEROS;F.size=n.pt2px(D.size||0);if(G.verticalOffset){const {screenLength:I,minWorldLength:J,maxWorldLength:N}=G.verticalOffset;F.verticalOffset={screenLength:n.pt2px(I),minWorldLength:J||
0,maxWorldLength:null!=N?N:Infinity}}F.borderColor=null!=D.border?.color?b.toUnitRGBA(D.border.color):null;D="object"===G.symbolLayers.at(0).type;G="label-3d"===G.type;F.occlusionTest=!D;F.shaderPolygonOffset=D?0:void 0;F.hudDepthAlignStart=G;F.hasSlicePlane=this._context.slicePlaneEnabled;F.screenSizePerspective=this._context.screenSizePerspectiveEnabled?this._context.sharedResources.screenSizePerspectiveSettings:null;return F}_defaultElevationInfoNoZ(){return A}createGraphics3DGraphic(F){const G=
F.renderingInfo;F=F.graphic;const D=this.setGraphicElevationContext(F,new d.ElevationContext,G.elevationOffset||0);var I=G.symbol;const J="on-the-ground"===this._elevationContext.mode&&("cim"===I.type||!I.symbolLayers.some(N=>"object"===N.type||"text"===N.type));if("label-3d"!==I.type&&J||"point-3d"===I.type&&I.symbolLayers.every(N=>"text"===N.type&&!h.textSymbolLayerSupportsVerticalOffset(N)))return null;I=x.computeCentroid(F.geometry);return null==I?null:this._createAs3DShape(I,D,G,F.uid)}layerOpacityChanged(){this._materials[0]?.setParameters(this._materialParameters)}layerElevationInfoChanged(F,
G,D){D=g.elevationModeChangeUpdateType(B.elevationModeChangeTypes,D,this._elevationContext.mode);if(D!==g.SymbolUpdateType.UPDATE)return D;F.forEach(I=>{const J=G(I);null!=J&&this.updateGraphicElevationContext(I.graphic,J)});return D}slicePlaneEnabledChanged(){this._materials[0]?.setParameters({hasSlicePlane:this._context.slicePlaneEnabled});return!0}physicalBasedRenderingChanged(){return!0}setGraphicElevationContext(F,G,D=0){super.setGraphicElevationContext(F,G);G.addOffsetRenderUnits(D);return G}updateGraphicElevationContext(F,
G){this.setGraphicElevationContext(F,G.elevationContext,null!=G.metadata?G.metadata.elevationOffset:0);G.needsElevationUpdates=g.needsElevationUpdates2D(G.elevationContext.mode)}computeComplexity(){return new t.SymbolComplexity({verticesPerFeature:6})}_getOrCreateMaterial(F){const G=this._perInstanceMaterialParameters(F),D=y.uniqueMaterialIdentifier(G);if(D===this._materials[0]?.uniqueMaterialIdentifier)return{material:this._materials[0],isUnique:!1};if(null!=F.materialCollection){let I=F.materialCollection.get(D);
null==I&&(I=new y.LineCalloutMaterial(G,this._context.spherical),F.materialCollection.add(D,I));return{material:I,isUnique:!1}}return{material:new y.LineCalloutMaterial(G,this._context.spherical),isUnique:!0}}_createAs3DShape(F,G,D,I){var J=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:I,layerUid:this._context.layer.uid}),N=this._getOrCreateMaterial(D),M=r.Geometry,Q=N.material;const {translation:O,centerOffset:K}=D;var L=O?new m.Attribute([O[0],O[1],O[2]],z,3,!0):new m.Attribute([0,
0,0],z,3,!0);const P=K?new m.Attribute([K[0],K[1],K[2],K[3]],z,4,!0):new m.Attribute([0,0,0,1],z,4,!0);L=[[v.VertexAttribute.POSITION,L],[v.VertexAttribute.NORMAL,new m.Attribute([0,0,1],z,3,!0)],[v.VertexAttribute.CENTEROFFSETANDDISTANCE,P]];J=new M(Q,L,null,q.ContentObjectType.Point,J);I=u.createStageObject(this._context,F,J,G,I);if(null==I)return null;N=new c.Graphics3DObject3DGraphicLayer(this,I.object,[J],N.isUnique?[N.material]:null,null,e.perObjectElevationAligner,G);N.metadata=new l.Graphics3DObjectMetadata(D.elevationOffset);
N.alignedSampledElevation=I.sampledElevation;N.needsElevationUpdates=g.needsElevationUpdates2D(G.mode);u.extendPointGraphicElevationContext(N,F,this._context.elevationProvider);return N}}B.elevationModeChangeTypes={definedChanged:g.SymbolUpdateType.UPDATE,staysOnTheGround:g.SymbolUpdateType.UPDATE,onTheGroundChanged:g.SymbolUpdateType.RECREATE};const z=[0],A={mode:"relative-to-ground",offset:0},C={ignoreDrivers:!0,renderPriority:0,renderPriorityStep:1};class H{constructor(F,G,D=k.create(),I=p.create(),
J=0,N="world",M=0,Q=null){this.renderer=F;this.symbol=G;this.translation=D;this.centerOffset=I;this.horizontalScreenOffset=J;this.centerOffsetUnits=N;this.elevationOffset=M;this.materialCollection=Q}}class E extends f.Graphics3DGraphicCreationContext{}a.Graphics3DLineCalloutSymbolLayer=B;a.LineCalloutCreationContext=E;a.LineCalloutSymbolLayerRenderingInfo=H;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/ElevationAligners":function(){define("exports ../../../../core/libs/gl-matrix-2/math/mat4 ../../../../core/libs/gl-matrix-2/factories/mat4f64 ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../geometry/projection/computeTranslationToOriginAndRotation ../../../../geometry/projection/projectBuffer ./elevationAlignmentUtils ../../support/debugFlags ../../support/ElevationProvider ../../webgl-engine/lib/GeometryWithMapPositions ../../webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l){function w(y,B,z,A,C){let H=!1;var E=y.transformation;B=B.requiresSampledElevationInfo;t[0]=E[12];t[1]=E[13];t[2]=E[14];y.invalidateBoundingInfo();var F=y.getMutableAttribute(l.VertexAttribute.POSITION);E=F.data;F=F.size;const G=E.length/F;y=new f.SamplePosition(y.mapPositions,z);let D=0,I=0;for(let J=0;J<G;J++){m[0]=E[D];m[1]=E[D+1];m[2]=E[D+2];A(y,v);B&&(I+=v.sampledElevation);if(d.debugFlags.TESTS_DISABLE_OPTIMIZATIONS)E[D]=y.array[y.offset],E[D+1]=y.array[y.offset+
1],E[D+2]=v.z,e.projectBuffer(E,z,D,E,C.spatialReference,D,1),E[D]-=t[0],E[D+1]-=t[1],E[D+2]-=t[2],H=!0;else{u[0]=E[D]+t[0];u[1]=E[D+1]+t[1];u[2]=E[D+2]+t[2];C.setAltitude(u,v.z);E[D]=u[0]-t[0];E[D+1]=u[1]-t[1];E[D+2]=u[2]-t[2];const N=.01/C.unitInMeters;if(Math.abs(m[0]-E[D])>=N||Math.abs(m[1]-E[D+1])>=N||Math.abs(m[2]-E[D+2])>=N)H=!0}D+=F;y.offset+=3}return{update:H,averageGeometrySampledElevation:I/G}}const x=n.create(),u=p.create(),t=p.create(),m=p.create(),q=n.create(),r=p.create(),v=new g.SampleElevationInfo;
a.perLodInstanceElevationAligner=function(y,B,z,A,C){var H=y.graphics3DSymbolLayer.lodRenderer;if(null==H)return 0;z=B.centerPointInElevationSR;A(z,v);B="absolute-height"!==B.mode?v.sampledElevation:0;A=H.instanceData;y=y.instanceIndex;A.getGlobalTransform(y,q);H=k.set(r,q[12],q[13],q[14]);d.debugFlags.TESTS_DISABLE_OPTIMIZATIONS?(u[0]=z.x,u[1]=z.y,u[2]=v.z,h.computeTranslationToOriginAndRotation(z.spatialReference,u,q,C.spatialReference)&&A.setGlobalTransform(y,q)):C.setAltitudeOfTransformation(v.z,
q);C=.01/C.unitInMeters;(d.debugFlags.TESTS_DISABLE_OPTIMIZATIONS||Math.abs(q[12]-H[0])>=C||Math.abs(q[13]-H[1])>=C||Math.abs(q[14]-H[2])>=C)&&A.setGlobalTransform(y,q);return B};a.perObjectElevationAligner=function(y,B,z,A,C,H){y=y.stageObject;const E=B.centerPointInElevationSR;z=0;y.usesVerticalDistanceToGround?(A(E,v),g.updateVertexPointGroundDistance(y,v.verticalDistanceToGround),z=v.sampledElevation):(A(E,v),"absolute-height"!==B.mode&&(z=v.sampledElevation));B=b.copy(x,H??y.transformation);
A=k.set(r,B[12],B[13],B[14]);d.debugFlags.TESTS_DISABLE_OPTIMIZATIONS?(u[0]=E.x,u[1]=E.y,u[2]=v.z,h.computeTranslationToOriginAndRotation(E.spatialReference,u,B,C.spatialReference)&&(H?b.copy(H,B):y.transformation=B)):C.setAltitudeOfTransformation(v.z,B);C=.01/C.unitInMeters;if(Math.abs(B[12]-A[0])>=C||Math.abs(B[13]-A[1])>=C||Math.abs(B[14]-A[2])>=C)H?b.copy(H,B):y.transformation=B;return z};a.perVertexElevationAligner=function(y,B,z,A,C){y=y.stageObject;const H=y.geometries;let E=0;for(const F of H){if(!c.isGeometryWithMapPositions(F))continue;
const {update:G,averageGeometrySampledElevation:D}=w(F,B,z,A,C);E+=D;G&&y.geometryVertexAttributeUpdated(F,l.VertexAttribute.POSITION)}return E/H.length};a.sharedGeometryElevationAligner=function(y,B,z,A,C){y=y.stageObject;const H=y.geometries;if(0===H.length)return 0;let E=0,F=null,G=0,D=!1;for(const I of H){if(!c.isGeometryWithMapPositions(I))continue;const J=I.attributes.get(l.VertexAttribute.POSITION);if(J!==F){const {update:N,averageGeometrySampledElevation:M}=w(I,B,z,A,C);G=M;F=J;D=N}D&&y.geometryVertexAttributeUpdated(I,
l.VertexAttribute.POSITION);E+=G}return E/H.length};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/elevationAlignmentUtils":function(){define("exports ../../../../core/libs/gl-matrix-2/math/mat4 ../../../../core/libs/gl-matrix-2/factories/mat4f64 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../geometry/projection/computeTranslationToOriginAndRotation ../../../../geometry/projection/projectBuffer ../../../../layers/graphics/dehydratedFeatureUtils ../../support/ElevationProvider ../../webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,n,k,p,h,e,g,d){function f(m,q,r,v,y){const B=(e.isDehydratedPoint(m)?m.z:g.isSamplePosition(m)?m.array[m.offset+2]:m[2])||0;switch(r.mode){case "on-the-ground":r=g.getElevationAtPoint(q,m,"ground")??0;y.verticalDistanceToGround=0;y.sampledElevation=r;y.z=r;break;case "relative-to-ground":m=g.getElevationAtPoint(q,m,"ground")??0;r=r.geometryZWithOffset(B,v);y.verticalDistanceToGround=r;y.sampledElevation=m;y.z=r+m;break;case "relative-to-scene":m=g.getElevationAtPoint(q,m,"scene")??0;
r=r.geometryZWithOffset(B,v);y.verticalDistanceToGround=r;y.sampledElevation=m;y.z=r+m;break;case "absolute-height":r=r.geometryZWithOffset(B,v);v=g.getElevationAtPoint(q,m,"ground")??0;y.verticalDistanceToGround=r-v;y.sampledElevation=v;y.z=r;break;default:y.z=0}}function c(m,q){for(let r=0;r<m.geometries.length;++r){const v=m.geometries[r].getMutableAttribute(d.VertexAttribute.CENTEROFFSETANDDISTANCE);v&&v.data[3]!==q&&(v.data[3]=q,m.geometryVertexAttributeUpdated(m.geometries[r],d.VertexAttribute.CENTEROFFSETANDDISTANCE))}}
class l{constructor(){this.z=this.sampledElevation=this.verticalDistanceToGround=0}}a.SymbolUpdateType=void 0;(function(m){m[m.NONE=0]="NONE";m[m.UPDATE=1]="UPDATE";m[m.RECREATE=2]="RECREATE"})(a.SymbolUpdateType||(a.SymbolUpdateType={}));const w={"absolute-height":{applyElevationAlignmentBuffer:function(m,q,r,v,y,B,z,A){B=A.calculateOffsetRenderUnits(z);A=A.featureExpressionInfoContext;q*=3;v*=3;for(z=0;z<y;++z){const C=m[q+1],H=m[q+2];r[v]=m[q];r[v+1]=C;r[v+2]=null==A?H+B:B;q+=3;v+=3}return 0},
requiresAlignment:function(m){const q=m.featureExpressionInfoContext;return 0!==m.meterUnitOffset||null!=q}},"on-the-ground":{applyElevationAlignmentBuffer:function(m,q,r,v,y,B){let z=0;const A=B.spatialReference;q*=3;v*=3;for(let C=0;C<y;++C){const H=m[q],E=m[q+1],F=B.getElevation(H,E,m[q+2],A,"ground")??0;z+=F;r[v]=H;r[v+1]=E;r[v+2]=F;q+=3;v+=3}return z/y},requiresAlignment:()=>!0},"relative-to-ground":{applyElevationAlignmentBuffer:function(m,q,r,v,y,B,z,A){let C=0;z=A.calculateOffsetRenderUnits(z);
A=A.featureExpressionInfoContext;const H=B.spatialReference;q*=3;v*=3;for(let E=0;E<y;++E){const F=m[q],G=m[q+1],D=m[q+2],I=B.getElevation(F,G,D,H,"ground")??0;C+=I;r[v]=F;r[v+1]=G;r[v+2]=null==A?D+I+z:I+z;q+=3;v+=3}return C/y},requiresAlignment:()=>!0},"relative-to-scene":{applyElevationAlignmentBuffer:function(m,q,r,v,y,B,z,A){let C=0;z=A.calculateOffsetRenderUnits(z);A=A.featureExpressionInfoContext;const H=B.spatialReference;q*=3;v*=3;for(let E=0;E<y;++E){const F=m[q],G=m[q+1],D=m[q+2],I=B.getElevation(F,
G,D,H,"scene")??0;C+=I;r[v]=F;r[v+1]=G;r[v+2]=null==A?D+I+z:I+z;q+=3;v+=3}return C/y},requiresAlignment:()=>!0}},x=n.create(),u=new l,t=k.create();a.SampleElevationInfo=l;a.applyElevationAlignmentForHUD=function(m,q,r,v,y){f(q,r,y,v,u);c(m,u.verticalDistanceToGround);r=u.sampledElevation;y=b.copy(x,m.transformation);t[0]=q.x;t[1]=q.y;t[2]=u.z;p.computeTranslationToOriginAndRotation(q.spatialReference,t,y,v.spatialReference)?m.transformation=y:console.warn("Could not locate symbol object properly, it might be misplaced");
return r};a.applyPerVertexElevationAlignment=function(m,q,r,v,y,B,z,A,C,H,E){const F=w[E.mode];let G=0;if(h.projectBuffer(m,q,r,v,C.spatialReference,y,A)&&(F?.requiresAlignment(E)?(G=F.applyElevationAlignmentBuffer(v,y,B,z,A,C,H,E),m=B,y=z):m=v,h.projectBuffer(m,C.spatialReference,y,B,H.spatialReference,z,A)))return G};a.elevationModeChangeUpdateType=function(m,q,r){return"on-the-ground"===q&&"on-the-ground"===r?m.staysOnTheGround:q===r||"on-the-ground"!==q&&"on-the-ground"!==r?null==q||null==r?m.definedChanged:
a.SymbolUpdateType.UPDATE:m.onTheGroundChanged};a.evaluateElevationAlignmentAtPoint=function(m,q,r,v){f(m,q,r,v,u);return u.z};a.evaluateElevationInfoAtPoint=f;a.needsElevationUpdates2D=function(m){return"relative-to-ground"===m||"relative-to-scene"===m};a.needsElevationUpdates3D=function(m){return"absolute-height"!==m};a.updateVertexPointGroundDistance=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/GeometryWithMapPositions":function(){define(["exports",
"./Geometry"],function(a,b){class n extends b.Geometry{}a.GeometryWithMapPositions=n;a.isGeometryWithMapPositions=function(k){return null!=k.mapPositions};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/Geometry":function(){define("exports ../../../../core/libs/gl-matrix-2/factories/mat4f64 ../../../../chunks/vec32 ../../../../geometry/support/Indices ./AttributeArray ./BoundingInfo ./ContentObject ./ContentObjectType ./geometryDataUtils ./Object3DStateID ./Util ./VertexAttribute".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l){class w extends e.ContentObject{constructor(x,u,t=null,m=g.ContentObjectType.Mesh,q=null,r=-1){super();this.material=x;this.mapPositions=t;this.type=m;this.objectAndLayerIdColor=q;this.edgeIndicesLength=r;this.highlights=new Set;this._highlightGroupCounts=new Map;this.visible=!0;this._attributes=new Map;this._boundingInfo=null;for(const [v,y]of u)this._attributes.set(v,{...y,indices:k.compactIndices(y.indices)}),v===l.VertexAttribute.POSITION&&(this.edgeIndicesLength=
0>this.edgeIndicesLength?this._attributes.get(v).indices.length:this.edgeIndicesLength)}instantiate(x={}){const u=new w(x.material||this.material,[],this.mapPositions,this.type,this.objectAndLayerIdColor,this.edgeIndicesLength);this._attributes.forEach((t,m)=>{t.exclusive=!1;u._attributes.set(m,t)});u._boundingInfo=this._boundingInfo;u.transformation=x.transformation||this.transformation;return u}get attributes(){return this._attributes}getMutableAttribute(x){let u=this._attributes.get(x);u&&!u.exclusive&&
(u={...u,exclusive:!0,data:p.cloneAttributeData(u.data)},this._attributes.set(x,u));return u}setAttributeData(x,u){const t=this._attributes.get(x);t&&this._attributes.set(x,{...t,exclusive:!0,data:u})}get indexCount(){return this._attributes.values().next().value.indices?.length??0}get faceCount(){return this.indexCount/3}get boundingInfo(){null==this._boundingInfo&&(this._boundingInfo=this._calculateBoundingInfo());return this._boundingInfo}computeAttachmentOrigin(x){return(this.type===g.ContentObjectType.Mesh?
this._computeAttachmentOriginTriangles(x):this.type===g.ContentObjectType.Line?this._computeAttachmentOriginLines(x):this._computeAttachmentOriginPoints(x))?(null!=this._transformation&&n.transformMat4(x,x,this._transformation),!0):!1}_computeAttachmentOriginTriangles(x){const u=this.attributes.get(l.VertexAttribute.POSITION);return d.computeAttachmentOriginTriangles(u,x)}_computeAttachmentOriginLines(x){const u=this.attributes.get(l.VertexAttribute.POSITION);var t=d.computeAttachmentOriginLines;
var m=this.material.parameters;m="isClosed"in m&&m.isClosed?2<u.indices.length:!1;return t.call(d,u,m,x)}_computeAttachmentOriginPoints(x){const u=this.attributes.get(l.VertexAttribute.POSITION);return d.computeAttachmentOriginPoints(u,x)}invalidateBoundingInfo(){this._boundingInfo=null}_calculateBoundingInfo(){const x=this.attributes.get(l.VertexAttribute.POSITION);if(!x||0===x.indices.length)return null;const u=this.type===g.ContentObjectType.Mesh?3:1;c.assert(0===x.indices.length%u,"Indexing error: "+
x.indices.length+" not divisible by "+u);const t=k.getContinuousIndexArray(x.indices.length/u);return new h.BoundingInfo(t,u,x)}get transformation(){return this._transformation??b.IDENTITY}set transformation(x){this._transformation=x&&x!==b.IDENTITY?b.clone(x):null}get highlightGroups(){return this._highlightGroupCounts}get hasHighlights(){return 0<this._highlightGroupCounts.size}foreachHighlightGroup(x){this._highlightGroupCounts.forEach((u,t)=>x(t))}allocateIdAndHighlight(x){x=new f.Object3DHighlightStateID(x);
return this.addHighlight(x)}addHighlight(x){this.highlights.add(x);const {highlightGroupName:u}=x,t=(this._highlightGroupCounts.get(u)??0)+1;this._highlightGroupCounts.set(u,t);return x}removeHighlight(x){if(this.highlights.delete(x)){({highlightGroupName:x}=x);const u=this._highlightGroupCounts.get(x)??0;1>=u?this._highlightGroupCounts.delete(x):this._highlightGroupCounts.set(x,u-1)}}}a.Geometry=w;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/Indices":function(){define(["exports",
"../../core/typedArrayUtil"],function(a,b){function n(f){let c=!0;for(const l of f){if(65536<=l)return b.isArray(f)?new Uint32Array(f):f;256<=l&&(c=!1)}return c?new Uint8Array(f):new Uint16Array(f)}function k(f){if(1===f)return e;if(f<b.nativeArrayMaxSize)return Array.from(new Uint16Array(g.buffer,0,f));if(f<g.length)return new Uint16Array(g.buffer,0,f);if(f>h.length){h=new Uint32Array(Math.max(2*h.length,f));for(let c=0;c<h.length;c++)h[c]=c}return new Uint32Array(h.buffer,0,f)}function p(f){if(1===
f)return e;if(f<b.nativeArrayMaxSize)return Array(f).fill(0);f>d.length&&(d=new Uint8Array(Math.max(2*d.length,f)));return new Uint8Array(d.buffer,0,f)}let h=(()=>{const f=new Uint32Array(131072);for(let c=0;c<f.length;++c)f[c]=c;return f})();const e=[0],g=(()=>{const f=new Uint16Array(65536);for(let c=0;c<f.length;++c)f[c]=c;return f})();let d=new Uint8Array(65536);a.compactIndices=function(f){if(b.isArray(f)){if(f.length<b.nativeArrayMaxSize)return f}else if(f.length<b.nativeArrayMaxSize)return Array.from(f);
let c=!0,l=!0;f.some((w,x)=>{c=c&&0===w;l=l&&w===x;return!c&&!l});return c?p(f.length):l?k(f.length):b.isArray(f)||f.BYTES_PER_ELEMENT!==Uint16Array.BYTES_PER_ELEMENT?n(f):f};a.getContinuousIndexArray=k;a.getZeroIndexArray=p;a.newIndexArray=function(f){return f<=b.nativeArrayMaxSize?Array(f):65536>=f?new Uint16Array(f):new Uint32Array(f)};a.newIntArray=function(f){return f<=b.nativeArrayMaxSize?Array(f):new Uint32Array(f)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/AttributeArray":function(){define(["exports",
"../../../../core/typedArrayUtil"],function(a,b){a.cloneAttributeData=function(n){if(n.length<b.nativeArrayMaxSize)return Array.from(n);if(b.isArray(n))return Float64Array.from(n);if(!("BYTES_PER_ELEMENT"in n))return Array.from(n);switch(n.BYTES_PER_ELEMENT){case 1:return Uint8Array.from(n);case 2:return b.isUint16Array(n)?Uint16Array.from(n):Int16Array.from(n);case 4:return Float32Array.from(n);default:case 8:return Float64Array.from(n)}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/webgl-engine/lib/BoundingInfo":function(){define(["exports","../../../../core/PooledArray","../../../../chunks/vec32","../../../../core/libs/gl-matrix-2/factories/vec3f64","./Util"],function(a,b,n,k,p){class h{constructor(g,d,f){this.primitiveIndices=g;this._numIndexPerPrimitive=d;this.position=f;this._children=void 0;p.assert(1<=g.length);p.assert(3===f.size||4===f.size);const {data:c,size:l,indices:w}=f;p.assert(0===w.length%this._numIndexPerPrimitive);p.assert(w.length>=g.length*
this._numIndexPerPrimitive);var x=g.length;d=l*w[this._numIndexPerPrimitive*g[0]];e.clear();e.push(d);f=k.fromValues(c[d],c[d+1],c[d+2]);var u=k.clone(f);for(var t=0;t<x;++t){var m=this._numIndexPerPrimitive*g[t];for(var q=0;q<this._numIndexPerPrimitive;++q){d=l*w[m+q];e.push(d);let r=c[d];f[0]=Math.min(r,f[0]);u[0]=Math.max(r,u[0]);r=c[d+1];f[1]=Math.min(r,f[1]);u[1]=Math.max(r,u[1]);r=c[d+2];f[2]=Math.min(r,f[2]);u[2]=Math.max(r,u[2])}}this.bbMin=f;this.bbMax=u;g=n.lerp(k.create(),this.bbMin,this.bbMax,
.5);this.radius=.5*Math.max(Math.max(u[0]-f[0],u[1]-f[1]),u[2]-f[2]);f=this.radius*this.radius;for(u=0;u<e.length;++u)d=e.at(u),x=c[d]-g[0],t=c[d+1]-g[1],d=c[d+2]-g[2],m=x*x+t*t+d*d,m<=f||(m=Math.sqrt(m),q=.5*(m-this.radius),this.radius+=q,f=this.radius*this.radius,m=q/m,g[0]+=x*m,g[1]+=t*m,g[2]+=d*m);this.center=g;e.clear()}getChildren(){if(this._children||1>=n.squaredDistance(this.bbMin,this.bbMax))return this._children;var g=n.lerp(k.create(),this.bbMin,this.bbMax,.5),d=this.primitiveIndices.length;
const f=new Uint8Array(d),c=Array(8);for(var l=0;8>l;++l)c[l]=0;const {data:w,size:x,indices:u}=this.position;for(l=0;l<d;++l){var t=0;const q=this._numIndexPerPrimitive*this.primitiveIndices[l];var m=x*u[q];let r=w[m],v=w[m+1],y=w[m+2];for(let B=1;B<this._numIndexPerPrimitive;++B){m=x*u[q+B];const z=w[m],A=w[m+1];m=w[m+2];z<r&&(r=z);A<v&&(v=A);m<y&&(y=m)}r<g[0]&&(t|=1);v<g[1]&&(t|=2);y<g[2]&&(t|=4);f[l]=t;++c[t]}g=0;for(l=0;8>l;++l)0<c[l]&&++g;if(!(2>g)){g=Array(8);for(l=0;8>l;++l)g[l]=0<c[l]?new Uint32Array(c[l]):
void 0;for(l=0;8>l;++l)c[l]=0;for(l=0;l<d;++l)t=f[l],g[t][c[t]++]=this.primitiveIndices[l];this._children=[];for(d=0;8>d;++d)void 0!==g[d]&&this._children.push(new h(g[d],this._numIndexPerPrimitive,this.position));return this._children}}static prune(){e.prune()}}const e=new b({deallocator:null});a.BoundingInfo=h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/geometryDataUtils":function(){define(["exports","../../../../chunks/vec32","../../../../core/libs/gl-matrix-2/factories/vec3f64",
"../../../../geometry/support/triangle"],function(a,b,n,k){const p=n.create(),h=n.create(),e=n.create(),g=n.create();a.computeAttachmentOriginLines=function(d,f,c){if(!d)return!1;b.set(c,0,0,0);b.set(g,0,0,0);let l=0,w=0;const {size:x,data:u,indices:t}=d;d=t.length-1;f=d+(f?2:0);for(let q=0;q<f;q+=2){var m=t[q<d?q:d]*x;const r=t[q<d?q+1:0]*x;p[0]=u[m];p[1]=u[m+1];p[2]=u[m+2];h[0]=u[r];h[1]=u[r+1];h[2]=u[r+2];b.scale(p,b.add(p,p,h),.5);m=b.dist(p,h);0<m?(b.add(c,c,b.scale(p,p,m)),l+=m):0===l&&(b.add(g,
g,p),w++)}return 0!==l?(b.scale(c,c,1/l),!0):0!==w?(b.scale(c,g,1/w),!0):!1};a.computeAttachmentOriginPoints=function(d,f){if(!d)return!1;const {size:c,data:l,indices:w}=d;b.set(f,0,0,0);d=-1;let x=0;for(let u=0;u<w.length;u++){const t=w[u]*c;d!==t&&(f[0]+=l[t],f[1]+=l[t+1],f[2]+=l[t+2],x++);d=t}1<x&&b.scale(f,f,1/x);return 0<x};a.computeAttachmentOriginTriangles=function(d,f){if(!d)return!1;const {size:c,data:l,indices:w}=d;b.set(f,0,0,0);b.set(g,0,0,0);let x=d=0;for(let t=0;t<w.length-2;t+=3){var u=
w[t]*c;const m=w[t+1]*c,q=w[t+2]*c;b.set(p,l[u],l[u+1],l[u+2]);b.set(h,l[m],l[m+1],l[m+2]);b.set(e,l[q],l[q+1],l[q+2]);(u=k.areaPoints3d(p,h,e))?(b.add(p,p,h),b.add(p,p,e),b.scale(p,p,1/3*u),b.add(f,f,p),d+=u):(b.add(g,g,p),b.add(g,g,h),b.add(g,g,e),x+=3)}return 0===x&&0===d?!1:0!==d?(b.scale(f,f,1/d),!0):0!==x?(b.scale(f,g,1/x),!0):!1};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/triangle":function(){define("exports ../../core/ObjectStack ../../chunks/vec32 ../../core/libs/gl-matrix-2/factories/vec3f64 ./lineSegment ./vectorStacks".split(" "),
function(a,b,n,k,p,h){function e(w){return w?{p0:k.clone(w.p0),p1:k.clone(w.p1),p2:k.clone(w.p2)}:{p0:k.create(),p1:k.create(),p2:k.create()}}function g(w,x,u,t=e()){n.copy(t.p0,w);n.copy(t.p1,x);n.copy(t.p2,u);return t}const d=new b.ObjectStack(p.create),f=new b.ObjectStack(()=>e()),c=k.create(),l=k.create();a.areaPoints2d=function(w,x,u){return.5*Math.abs((x[0]-w[0])*(u[1]-w[1])-(x[1]-w[1])*(u[0]-w[0]))};a.areaPoints3d=function(w,x,u){n.subtract(c,x,w);n.subtract(l,u,w);return.5*n.length(n.cross(c,
c,l))};a.copy=function(w,x=e()){return g(w.p0,w.p1,w.p2,x)};a.create=e;a.distance2=function(w,x){var u=w.p0,t=w.p1;w=w.p2;const m=n.subtract(h.sv3d.get(),t,u),q=n.subtract(h.sv3d.get(),w,t),r=n.subtract(h.sv3d.get(),u,w),v=n.subtract(h.sv3d.get(),x,u);var y=n.subtract(h.sv3d.get(),x,t),B=n.subtract(h.sv3d.get(),x,w);const z=n.cross(m,m,r),A=n.dot(n.cross(h.sv3d.get(),m,z),v);y=n.dot(n.cross(h.sv3d.get(),q,z),y);B=n.dot(n.cross(h.sv3d.get(),r,z),B);if(0<A&&0<y&&0<B)return x=n.dot(z,v),x*x/n.dot(z,
z);u=p.distance2(p.fromValues(u,m,d.get()),x);t=p.distance2(p.fromValues(t,q,d.get()),x);x=p.distance2(p.fromValues(w,r,d.get()),x);return Math.min(u,t,x)};a.fromValues=g;a.intersectRay=function(w,x,u){const {direction:t,origin:m}=x,{p0:q,p1:r,p2:v}=w;var y=r[0]-q[0],B=r[1]-q[1],z=r[2]-q[2];w=v[0]-q[0];x=v[1]-q[1];const A=v[2]-q[2];var C=t[1]*A-x*t[2],H=t[2]*w-A*t[0];const E=t[0]*x-w*t[1];var F=y*C+B*H+z*E;if(-1E-5<F&&1E-5>F)return!1;F=1/F;const G=m[0]-q[0],D=m[1]-q[1],I=m[2]-q[2];C=F*(G*C+D*H+I*
E);if(0>C||1<C)return!1;H=D*z-B*I;z=I*y-z*G;y=G*B-y*D;B=F*(t[0]*H+t[1]*z+t[2]*y);if(0>B||1<C+B)return!1;u&&(n.scale(u,t,F*(w*H+x*z+A*y)),n.add(u,m,u));return!0};a.wrap=function(w,x,u){const t=f.get();t.p0=w;t.p1=x;t.p2=u;return t};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/Object3DStateID":function(){define(["exports","../../../../core/uid","./basicInterfaces"],function(a,b,n){class k{constructor(){this.uid=b.generateUID()}}class p extends k{constructor(e){super();
this.highlightGroupName=e;this.channel=n.Object3DState.Highlight}}class h extends k{constructor(){super(...arguments);this.channel=n.Object3DState.MaskOccludee}}a.Object3DHighlightStateID=p;a.Object3DOccludeeStateID=h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/ElevationContext":function(){define(["exports","../../../../symbols/support/unitConversionUtils","./featureExpressionInfoUtils"],function(a,b,n){class k{constructor(){this._renderUnitOffset=
this._meterUnitOffset=0;this._unit="meters";this._metersPerElevationInfoUnit=1;this.mode=this.centerPointInElevationSR=this._featureExpressionInfoContext=null}get featureExpressionInfoContext(){return this._featureExpressionInfoContext}get meterUnitOffset(){return this._meterUnitOffset}get unit(){return this._unit}set unit(p){this._unit=p;this._metersPerElevationInfoUnit=b.getMetersPerUnit(p)}get requiresSampledElevationInfo(){return"absolute-height"!==this.mode}reset(){this.mode=null;this._renderUnitOffset=
this._meterUnitOffset=0;this._featureExpressionInfoContext=null;this.unit="meters"}set offsetMeters(p){this._meterUnitOffset=p;this._renderUnitOffset=0}set offsetElevationInfoUnits(p){this._meterUnitOffset=p*this._metersPerElevationInfoUnit;this._renderUnitOffset=0}addOffsetRenderUnits(p){this._renderUnitOffset+=p}geometryZWithOffset(p,h){h=this.calculateOffsetRenderUnits(h);return null!=this.featureExpressionInfoContext?h:p+h}calculateOffsetRenderUnits(p){let h=this._meterUnitOffset;const e=this.featureExpressionInfoContext;
null!=e&&(h+=n.execute(e)*this._metersPerElevationInfoUnit);return h/p.unitInMeters+this._renderUnitOffset}setFromElevationInfo(p){this.mode=p.mode;this.unit=b.supportsUnit(p.unit)?p.unit:"meters";this.offsetElevationInfoUnits=p.offset??0}updateFeatureExpressionInfoContext(p,h,e){if(null==p)this._featureExpressionInfoContext=null;else{var g=p?.arcade;g&&null!=h&&null!=e?(this._featureExpressionInfoContext=n.clone(p),n.setContextFeature(this._featureExpressionInfoContext,n.createFeature(g.modules,
h,e))):this._featureExpressionInfoContext=p}}static fromElevationInfo(p){const h=new k;null!=p&&h.setFromElevationInfo(p);return h}}a.ElevationContext=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/featureExpressionInfoUtils":function(){define(["exports","../../../../core/Logger","../../../../core/promiseUtils","../../../../layers/graphics/hydratedFeatures","../../../../support/arcadeOnDemand"],function(a,b,n,k,p){a.clone=function(h){return{cachedResult:h.cachedResult,
arcade:h.arcade?{func:h.arcade.func,context:h.arcade.modules.arcadeUtils.createExecContext(null,{sr:h.arcade.context.spatialReference}),modules:h.arcade.modules}:null}};a.createContext=async function(h,e,g,d){h=h?.expression;if("string"!==typeof h)return null;var f="0"===h?0:null;if(null!=f)return{cachedResult:f};f=await p.loadArcade();n.throwIfAborted(g);g=f.arcadeUtils;h=g.createSyntaxTree(h);return g.dependsOnView(h)?(null!=d&&d.error("Expressions containing '$view' are not supported on ElevationInfo"),
{cachedResult:0}):{arcade:{func:g.createFunction(h),context:g.createExecContext(null,{sr:e}),modules:f}}};a.createContextWithoutExpressionSupport=function(h){h=h?.expression;return"string"===typeof h&&(h="0"===h?0:null,null!=h)?{cachedResult:h}:null};a.createFeature=function(h,e,g){return h.arcadeUtils.createFeature(e.attributes,e.geometry,g)};a.execute=function(h){if(null!=h){if(null!=h.cachedResult)return h.cachedResult;var e=h.arcade;e=e?.modules.arcadeUtils.executeFunction(e.func,e.context);"number"!==
typeof e&&(e=h.cachedResult=0);return e}return 0};a.extractExpressionInfo=function(h,e=!1){h=h?.featureExpressionInfo;e||"0"===h?.expression||(h=null);return h??null};a.setContextFeature=function(h,e){null!=h&&null==h.cachedResult&&(e&&h.arcade?(e._geometry&&(e._geometry=k.hydrateGeometry(e._geometry)),h.arcade.modules.arcadeUtils.updateExecContext(h.arcade.context,e)):b.getLogger("esri.views.3d.layers.graphics.featureExpressionInfoUtils").errorOncePerTick("Arcade support required but not provided"))};
a.zeroContext={cachedResult:0};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DGraphicCreationContext":function(){define(["exports"],function(a){class b{constructor(n,k,p){this.graphic=n;this.renderingInfo=k;this.layer=p}}a.Graphics3DGraphicCreationContext=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DObject3DGraphicLayer":function(){define("exports ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../geometry/support/aaBoundingBox ../../../../chunks/sphere ./elevationAlignmentUtils ./featureExpressionInfoUtils ./graphicUtils ../../webgl-engine/lib/basicInterfaces ../../webgl-engine/lib/edgeRendering/interfaces".split(" "),
function(a,b,n,k,p,h,e,g,d,f){class c{constructor(m,q,r){this.baseMaterial=m;this.edgeMaterial=q;this.hasSlicePlane=r}}class l{get isElevationSource(){return!!this.stageObject.lastValidElevationBB}constructor(m,q,r,v,y,B,z,A=null){this.graphics3DSymbolLayer=m;this.stageObject=q;this._uniqueGeometries=r;this._uniqueMaterials=v;this._sharedResource=y;this.elevationAligner=B;this.elevationContext=z;this._edgeState=A;this.type="object3d";this._stageLayer=null;this._addedToStage=this._visible=!1;this.alignedSampledElevation=
0;this.useObjectOriginAsAttachmentOrigin=this.needsElevationUpdates=!1}initialize(m){this._stageLayer=m;m=m.stage;m.addMany(this._uniqueMaterials);m.addMany(this._uniqueGeometries);m.add(this.stageObject)}destroy(){if(this._stageLayer){var m=this._stageLayer.stage;m.removeMany(this._uniqueMaterials);m.removeMany(this._uniqueGeometries);m.remove(this.stageObject);this._addedToStage&&(this._stageLayer.remove(this.stageObject),this._addedToStage=!1);m.renderer.edgeView?.removeObject(this.stageObject);
this.stageObject.dispose();this._sharedResource?.release();this._visible=!1;this._stageLayer=null}}layerOpacityChanged(m,q){const {stageObject:r,_edgeState:v,_stageLayer:y}=this;if(null!=v){var B=v.baseMaterial.parameters.transparent?f.Transparency.TRANSPARENT:f.Transparency.OPAQUE;v.edgeMaterial.objectTransparency!==B&&(v.edgeMaterial.objectTransparency=B,this.resetEdgeObject(q));y.stage.renderer.withEdgeView(z=>z.updateAllComponentOpacities(r,[m]))}}slicePlaneEnabledChanged(m,q){const {stageObject:r,
_edgeState:v,_stageLayer:y}=this;null!=v&&y.stage.renderer.withEdgeView(B=>{B.updateAllComponentMaterials(r,v.edgeMaterial,m,!q);v.hasSlicePlane=m})}setVisibility(m){const {_edgeState:q,stageObject:r,_stageLayer:v}=this;null!=v&&this.visible!==m&&(this._visible=m,(r.visible=m)&&!this._addedToStage&&(v.add(r),this._addedToStage=!0),null!=q&&v.stage.renderer.withEdgeView(y=>{y.hasObject(r)?y.updateObjectVisibility(r,m):m&&this._addOrUpdateEdgeObject(q,y,!1)}))}get visible(){return this._visible}alignWithElevation(m,
q,r,v){null!=this.elevationAligner&&(null!=r&&e.setContextFeature(this.elevationContext.featureExpressionInfoContext,r),this.alignedSampledElevation=this.elevationAligner(this,this.elevationContext,m.spatialReference,(y,B)=>h.evaluateElevationInfoAtPoint(y,m,this.elevationContext,q,B),q),this.resetEdgeObject(v))}alignWithAbsoluteElevation(m,q,r){this.alignedSampledElevation=this.elevationAligner(this,this.elevationContext,null,(v,y)=>{y.sampledElevation=m;y.verticalDistanceToGround=0;y.z=m},q);this.resetEdgeObject(r)}getCenterObjectSpace(m=
n.create()){return b.copy(m,p.getCenter(this.stageObject.boundingVolumeObjectSpace.bounds))}getBoundingBoxObjectSpace(m=k.create()){const q=this.stageObject.boundingVolumeObjectSpace;k.setMin(m,q.min);k.setMax(m,q.max);return m}computeAttachmentOrigin(m){const q=this.stageObject.effectiveTransformation;if(this.useObjectOriginAsAttachmentOrigin)m.render.origin[0]+=q[12],m.render.origin[1]+=q[13],m.render.origin[2]+=q[14],m.render.num++;else for(const r of this.stageObject.geometries)r.computeAttachmentOrigin(u)&&
(b.transformMat4(u,u,q),b.add(m.render.origin,m.render.origin,u),m.render.num++)}async getProjectedBoundingBox(m,q,r,v,y){y=this.getBoundingBoxObjectSpace(y);var B=t,z=k.isPoint(y)?1:B.length;for(var A=0;A<z;A++){const C=B[A];x[0]=y[C[0]];x[1]=y[C[1]];x[2]=y[C[2]];b.transformMat4(x,x,this.stageObject.transformation);w[3*A]=x[0];w[3*A+1]=x[1];w[3*A+2]=x[2]}if(!m(w,0,z))return null;k.empty(y);m=null;this.calculateRelativeScreenBounds&&(m=this.calculateRelativeScreenBounds());for(B=0;B<3*z;B+=3){for(A=
0;3>A;A++)y[A]=Math.min(y[A],w[B+A]),y[A+3]=Math.max(y[A+3],w[B+A]);m&&r.push({location:w.slice(B,B+3),screenSpaceBoundingRect:m})}if(q?.service&&"absolute-height"!==this.elevationContext.mode){k.center(y,u);r="relative-to-scene"===this.elevationContext.mode?"scene":"ground";z=0;if(q.useViewElevation)z=q.service.getElevation(u[0],u[1],r)??0;else try{const C=g.demResolutionForBoundingBox(y,q.service.spatialReference,q);z=await q.service.queryElevation(u[0],u[1],v,C,r)??0}catch(C){}k.offset(y,0,0,-this.alignedSampledElevation+
z)}return y}addObjectState(m){m.stateType===d.Object3DState.Highlight&&m.addObject(this.stageObject,this.stageObject.highlight(m.highlightGroupName));m.stateType===d.Object3DState.MaskOccludee&&m.addObject(this.stageObject,this.stageObject.maskOccludee())}removeObjectState(m){m.removeByObject(this.stageObject)}resetEdgeObject(m){const {_edgeState:q,stageObject:r,_stageLayer:v,_visible:y}=this;null!=q&&v.stage.renderer.withEdgeView(B=>{y?this._addOrUpdateEdgeObject(q,B,m):B.removeObject(r)})}_addOrUpdateEdgeObject(m,
q,r){m.edgeMaterial.objectTransparency=m.baseMaterial.parameters.transparent?f.Transparency.TRANSPARENT:f.Transparency.OPAQUE;q.addOrUpdateObject3D(this.stageObject,m.edgeMaterial,m.hasSlicePlane,!r).then(()=>this._stageLayer?.sync())}}const w=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],x=n.create(),u=n.create(),t=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]];a.Graphics3DObject3DGraphicLayer=l;a.Object3DEdgeState=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/layers/graphics/graphicUtils":function(){define("exports ../../../../core/unitUtils ../../../../core/libs/gl-matrix-2/math/mat4 ../../../../core/libs/gl-matrix-2/factories/mat4f64 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../chunks/vec42 ../../../../core/libs/gl-matrix-2/factories/vec4f64 ../../../../geometry/projection ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/aaBoundingRect ../../../../geometry/support/centroid ../../../../geometry/support/coordsUtils ../../../../geometry/support/meshVertexSpaceUtils ../../../../layers/graphics/dehydratedPoint ../../../../layers/graphics/hydratedFeatures".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w,x,u){function t(r){var v=r.paths[0];if(!v||0===v.length)return null;v=l.getPointOnPath(v,l.getPathLength(v)/2);return x.makeDehydratedPoint(v[0],v[1],v[2],r.spatialReference)}function m(r,v,y){y=y?r:u.clonePoint(r);return v&&r?g.projectPoint(r,y,v)?y:null:y}function q(r){const v=y=>null==y||0<=y;return Array.isArray(r)?r.every(v):null==r||0<=r}a.computeCentroid=function(r,v){if("point"===r.type)return m(r,v,!1);if(u.isHydratedGeometry(r))switch(r.type){case "extent":return m(r.center,
v,!1);case "polygon":return m(r.centroid,v,!1);case "polyline":return m(t(r),v,!0);case "mesh":return m(w.vertexSpaceOriginToPoint(r.vertexSpace,r.spatialReference)??r.extent.center,v,!1)}else switch(r.type){case "extent":return r=x.makeDehydratedPoint(.5*(r.xmax+r.xmin),.5*(r.ymax+r.ymin),null!=r.zmin&&null!=r.zmax&&isFinite(r.zmin)&&isFinite(r.zmax)?.5*(r.zmax+r.zmin):void 0,r.spatialReference),m(r,v,!0);case "polygon":var y=r.rings[0];y&&0!==y.length?(y=c.ringsCentroid(r.rings,!!r.hasZ),r=x.makeDehydratedPoint(y[0],
y[1],y[2],r.spatialReference)):r=null;return m(r,v,!0);case "polyline":return m(t(r),v,!0)}};a.computeMaxZ=function(r){if(!r)return 0;switch(r.type){case "point":return r.z;case "extent":return r.zmax;case "polygon":return r.hasZ?r.rings.reduce((v,y)=>y.reduce((B,z)=>Math.max(B,z[2]),v),-Infinity):void 0;case "polyline":return r.hasZ?r.paths.reduce((v,y)=>y.reduce((B,z)=>Math.max(B,z[2]),v),-Infinity):void 0;case "mesh":return r.extent.zmax}};a.computeObjectRotation=function(r,v,y,B=k.create()){r&&
n.rotateZ(B,B,-r/180*Math.PI);v&&n.rotateX(B,B,v/180*Math.PI);y&&n.rotateY(B,B,y/180*Math.PI);return B};a.computeObjectScale=function(r=p.ONES,v,y,B=1){const z=Array(3);if(null==v||null==y)z[0]=1,z[1]=1,z[2]=1;else{let C=0;for(let H=2;0<=H;H--){const E=r[H];let F;const G=null!=E,D=0===H&&!A&&!G,I=y[H];"symbol-value"===E||D?F=0!==I?v[H]/I:1:G&&"proportional"!==E&&isFinite(E)&&(F=0!==I?E/I:1);if(null!=F){var A=z[H]=F;C=Math.max(C,Math.abs(F))}}for(r=2;0<=r;r--)null==z[r]?z[r]=A:0===z[r]&&(z[r]=.001*
C)}for(A=2;0<=A;A--)z[A]/=B;return p.fromArray(z)};a.demResolutionForBoundingBox=function(r,v,y){if(null!=y.minDemResolution)return y.minDemResolution;const B=b.getMetersPerUnitForSR(v),z=d.width(r)*B,A=d.depth(r)*B;r=d.height(r)*(v.isGeographic?1:B);return 0===z&&0===A&&0===r?y.minDemResolutionForPoints:.01*Math.max(z,A,r)};a.enlargeExtent=function(r,v,y,B=0){if(r){v||=f.create();let z=.5*r.width*(y-1);y=.5*r.height*(y-1);r.width<1E-7*r.height?z+=y/20:r.height<1E-7*r.width&&(y+=z/20);h.set(v,r.xmin-
z-B,r.ymin-y-B,r.xmax+z+B,r.ymax+y+B);return v}return null};a.isValidSize=q;a.mixinColorAndOpacity=function(r,v,y=null){const B=e.clone(e.ONES);null!=r&&(B[0]=r[0],B[1]=r[1],B[2]=r[2]);null!=v?B[3]=v:null!=r&&3<r.length&&(B[3]=r[3]);y&&(B[0]*=y,B[1]*=y,B[2]*=y,B[3]*=y);return B};a.overrideColor=function(r,v,y,B,z,A=[0,0,0,0]){for(let C=0;3>C;++C)A[C]=null!=r?.[C]?r[C]:null!=y?.[C]?y[C]:z[C];A[3]=null!=v?v:null!=B?B:z[3];return A};a.validateSymbolLayerSize=function(r){return q(null!=r.isPrimitive?
[r.width,r.depth,r.height]:r)?null:"Symbol sizes may not be negative values"};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/edgeRendering/interfaces":function(){define(["exports"],function(a){a.Transparency=void 0;var b=a.Transparency||(a.Transparency={});b[b.TRANSPARENT=0]="TRANSPARENT";b[b.OPAQUE=1]="OPAQUE";Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DObjectMetadata":function(){define(["exports"],
function(a){class b{constructor(n,k=null){this.labelText=k;this.elevationOffset=n??0}}a.Graphics3DObjectMetadata=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DSymbolLayer":function(){define("exports ../../../../Color ../../../../core/has ../../../../core/Logger ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../core/libs/gl-matrix-2/factories/vec4f64 ../../../../geometry/support/coordsUtils ./defaultSymbolComplexity ./elevationAlignmentUtils ./ElevationContext ./featureExpressionInfoUtils ./graphicUtils ./interfaces ./Loadable ../support/FastSymbolUpdates".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w,x,u){function t(B){const z={color:!1,opacity:!1,opacityAlwaysOpaque:!0,size:!1,rotation:!1};B&&"visualVariables"in B&&B.visualVariables&&B.visualVariables.forEach(A=>{switch(A.type){case "color":z.color=!0;if(A.stops)for(let C=0;C<A.stops.length;C++){const H=A.stops[C].color;H&&(z.opacity=!0,1>H.a&&(z.opacityAlwaysOpaque=!1))}break;case "opacity":z.opacity=!0;z.opacityAlwaysOpaque=!1;break;case "size":z.size=!0;break;case "rotation":z.rotation=!0}});return z}const m=
()=>k.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayer");class q extends x.Loadable{constructor(B,z,A,C){super(A.schedule);this.symbol=B;this.symbolLayer=z;this._context=A;this.ignoreDrivers=!1;this._drivenProperties={color:!1,opacity:!1,opacityAlwaysOpaque:!0,size:!1,rotation:!1};this._materials=[];this.usedMemory=0;this.logger=m();this._elevationOptions={supportsOffsetAdjustment:!1,supportsOnTheGround:!0};this.skipHighSymbolLodsChanged=!0;this._renderPriority=C.renderPriority;this._renderPriorityStep=
C.renderPriorityStep;this._elevationContext=new f.ElevationContext;this.complexity=this.computeComplexity();this.ignoreDrivers=C.ignoreDrivers;this.ignoreDrivers||(this._drivenProperties=t(this._context.renderer));this._updateElevationContext()}getCachedSize(){return null}get extentPadding(){return 0}get materials(){return this._materials}_drivenPropertiesChanged(B){if(this.ignoreDrivers)return!1;const z=this._drivenProperties;B=t(B);return B.color!==z.color||B.opacity!==z.opacity||B.opacityAlwaysOpaque!==
z.opacityAlwaysOpaque||B.size!==z.size||B.rotation!==z.rotation}get needsDrivenTransparentPass(){return this._drivenProperties.opacity&&!this._drivenProperties.opacityAlwaysOpaque}_logGeometryCreationWarnings(B,z,A,C){const H="polygons"in B?B.polygons:null,E=`${C} geometry failed to be created`;B.projectionSuccess?!this._logGeometryValidationWarnings(z,A,C)&&H&&0===H.length&&"rings"===A&&0<z.length&&2<z[0].length&&m().warnOncePerTick(`${E} (filled rings should use clockwise winding - try reversing the order of vertices)`):
m().warnOncePerTick(`${E} (failed to project geometry to view spatial reference)`)}_logGeometryValidationWarnings(B,z,A){A=`${A} geometry failed to be created`;return!B.length||1===B.length&&!B[0].length?(m().warnOncePerTick(`${A} (no ${z} were defined)`),!0):Array.isArray(B)&&Array.isArray(B[0])?!1:(m().warnOncePerTick(`${A} (${z} should be defined as a 2D array)`),!0)}_validateGeometry(B,z=null,A=null){if(null!=z&&!z.includes(B.type))return this.logger.warn("unsupported geometry type for "+A+` symbol: ${B.type}`),
!1;switch(B.type){case "point":if(!isFinite(B.x)||!isFinite(B.y))return m().warn("point coordinate is not a valid number, graphic skipped"),!1;break;case "polygon":e.closeRings(B)&&m().warnOncePerTick("Fixed a non-closed polygon ring.")}return!0}_defaultElevationInfoNoZ(){return r}_defaultElevationInfoZ(){return v}_updateElevationContext(){null!=this._elevationInfoOverride?(this._elevationContext.setFromElevationInfo(this._elevationInfoOverride),this._elevationContext.updateFeatureExpressionInfoContext(null)):
this._context.layer.elevationInfo?(this._elevationContext.setFromElevationInfo(this._context.layer.elevationInfo),this._elevationContext.updateFeatureExpressionInfoContext(this._context.featureExpressionInfoContext)):this._elevationContext.reset()}getDefaultElevationInfo(B){return B.hasZ?this._defaultElevationInfoZ():this._defaultElevationInfoNoZ()}getGeometryElevationMode(B,z=this.getDefaultElevationInfo(B)){return this._elevationContext.mode||z.mode}setElevationInfoOverride(B){this._elevationInfoOverride=
B;this._updateElevationContext()}setGraphicElevationContext(B,z=new f.ElevationContext){var A=B.geometry;const C=this.getDefaultElevationInfo(A);z.unit=null!=this._elevationContext.unit?this._elevationContext.unit:C.unit;z.mode=this.getGeometryElevationMode(A,C);z.offsetMeters=this._elevationContext.meterUnitOffset??C.offset??0;if(A=!this._elevationOptions.supportsOnTheGround&&"on-the-ground"===z.mode)z.mode="relative-to-ground",z.offsetMeters=0;z.updateFeatureExpressionInfoContext(A?c.zeroContext:
this._elevationContext.featureExpressionInfoContext,B,this._context.layer);return z}prepareSymbolLayerPatch(B){}updateGeometry(B,z){return!1}updateTransform(B,z,A,C){return!1}onRemoveGraphic(B){}_getLayerOpacity(){if(this._context.graphicsCoreOwner&&"fullOpacity"in this._context.graphicsCoreOwner)return this._context.graphicsCoreOwner.fullOpacity??0;const B=this._context.layer.opacity;return null==B?1:B}_getCombinedOpacity(B,z=y){const A=this.draped?1:this._getLayerOpacity();return this._drivenProperties.opacity?
A:B?A*B.a:z.hasIntrinsicColor?A:0}_getCombinedOpacityAndColor(B,z=y){z=this._getCombinedOpacity(B,z);if(this._drivenProperties.color)return l.mixinColorAndOpacity(null,z);B=null!=B?b.toUnitRGB(B):p.ONES;return l.mixinColorAndOpacity(B,z)}_getVertexOpacityAndColor(B,z=null){B=l.mixinColorAndOpacity(this._drivenProperties.color?B.color:null,this._drivenProperties.opacity?B.opacity:null);z&&(B[0]*=z,B[1]*=z,B[2]*=z,B[3]*=z);return B}isFastUpdatesEnabled(){return null!=this._fastUpdates}computeComplexity(){return g.defaultSymbolLayerComplexity(this.symbol,
this.symbolLayer)}globalPropertyChanged(B,z,A){switch(B){case "opacity":return this.layerOpacityChanged(z,A),!0;case "elevationInfo":return B=this._elevationContext.mode,this._updateElevationContext(),this.layerElevationInfoChanged(z,A,B)===d.SymbolUpdateType.RECREATE?!1:!0;case "slicePlaneEnabled":return this.slicePlaneEnabledChanged(z,A);case "physicalBasedRenderingEnabled":return this.physicalBasedRenderingChanged();case "pixelRatio":return this.pixelRatioChanged;case "skipHighSymbolLods":return this.skipHighSymbolLodsChanged;
default:return!1}}get pixelRatioChanged(){return!0}updateGraphics3DGraphicElevationInfo(B,z,A){let C=d.SymbolUpdateType.UPDATE;B.forEach(H=>{const E=z(H);null!=E?(this.setGraphicElevationContext(H.graphic,E.elevationContext),E.needsElevationUpdates=A(E.elevationContext.mode)):C=d.SymbolUpdateType.RECREATE});return C}applyRendererDiff(B,z){return w.ApplyRendererDiffResult.RecreateSymbol}getFastUpdateAttrValues(B){if(!this._fastUpdates)return null;const z=this._fastUpdates.visualVariables,A=z.size?
u.getAttributeValue(z.size.field,B):0,C=z.color?u.getAttributeValue(z.color.field,B):0;B=z.opacity?u.getAttributeValue(z.opacity.field,B):0;return h.fromValues(A,C,B,0)}get draped(){return this._draped}ensureDrapedStatus(B){if(null==this._draped)return this._draped=B,!0;B!==this.draped&&m().warnOnce("A symbol can only produce either draped or non-draped visualizations. Use two separate symbol instances for draped and non-draped graphics if necessary.");return!1}test(){return{drivenProperties:this._drivenProperties,
getVisVarFields:()=>({size:this._fastUpdates?.visualVariables.size?.field??null,color:this._fastUpdates?.visualVariables.color?.field??null,opacity:this._fastUpdates?.visualVariables.opacity?.field??null,rotation:this._fastUpdates?.visualVariables.rotation?.field??null})}}}const r={mode:"on-the-ground",offset:0,unit:"meters"},v={mode:"absolute-height",offset:0,unit:"meters"},y={hasIntrinsicColor:!1};a.Graphics3DSymbolLayer=q;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/defaultSymbolComplexity":function(){define("exports ../../../../core/compilerUtils ../../../../symbols/support/ObjectSymbol3DLayerResource ./Graphics3DPathSymbolLayerConstants ./primitiveObjectSymbolUtils ./SymbolComplexity ../support/edgeUtils ../../webgl-engine/materials/DefaultMaterial".split(" "),
function(a,b,n,k,p,h,e,g){function d(t){let m=0,q=0,r=0,v=!1,y=0;const B=new h.SymbolComplexityMemory;for(const z of t)null!=z&&(m+=z.verticesPerFeature,q+=z.verticesPerCoordinate,r+=z.drawCallsPerFeature,B.bytesPerFeature+=z.memory.bytesPerFeature,B.bytesPerFeatureLabel+=z.memory.bytesPerFeatureLabel,B.resourceBytes+=z.memory.resourceBytes,B.draped.bytesPerFeature+=z.memory.bytesPerFeature,B.draped.bytesPerFeatureLabel+=z.memory.bytesPerFeatureLabel,v=v||z.estimated,++y);return v?new h.EstimatedAggregateSymbolComplexity(y,
{verticesPerFeature:m,verticesPerCoordinate:q,drawCallsPerFeature:r,memory:B}):new h.AggregateSymbolComplexity(y,{verticesPerFeature:m,verticesPerCoordinate:q,drawCallsPerFeature:r,memory:B})}function f(t,m){const q=c(t,m);var r=e.hasEdges(m)?2:0;switch(m.type){case "extrude":return new h.SymbolComplexity({verticesPerFeature:-12,verticesPerCoordinate:12,drawCallsPerFeature:r,memory:q});case "fill":if("mesh-3d"===t.type)return new h.SymbolComplexity({drawCallsPerFeature:r,memory:q});if(null!=m.outline&&
0<m.outline.size)return new h.SymbolComplexity({verticesPerFeature:-12,verticesPerCoordinate:9,memory:q});case "water":return new h.SymbolComplexity({verticesPerFeature:-6,verticesPerCoordinate:3,memory:q});case "line":return new h.SymbolComplexity({verticesPerFeature:-6,verticesPerCoordinate:6,memory:q});case "object":if(m.resource?.href)return new h.EstimatedSymbolComplexity({verticesPerFeature:100,memory:q});m=m.resource?.primitive??n.defaultPrimitive;(t=x[m])?m=t:(t=p.primitiveLodResources(m,
new g.DefaultMaterial({},{spherical:!0,doublePrecisionRequiresObfuscation:!0})),t=l(t.levels),x[m]=new h.SymbolComplexity({verticesPerFeature:t}),m=x[m]);return{...m,memory:q};case "path":var v=t=0;switch(m.profile){case "circle":t=k.pathNumCircleProfileSubdivisions;break;case "quad":t=4;break;default:b.neverReached(m.profile);return}switch(m.join){case "round":v=k.pathNumRoundJoinSubdivisions;break;case "miter":case "bevel":v=1;break;default:return}r=2*t;v=t*v*2;let y=-2*v-r;switch(m.cap){case "none":break;
case "butt":case "square":y+=2*(t-1);break;case "round":y+=2*(t*(k.pathNumRoundCapExtrusionSubdivisions-1)*2+t);break;default:return}return new h.SymbolComplexity({verticesPerFeature:y,verticesPerCoordinate:v+r,memory:q});case "text":case "icon":return new h.SymbolComplexity({verticesPerFeature:6,memory:q})}}function c(t,m){t="point-3d"===t.type;switch(m.type){case "extrude":return m.edges&&0<m.edges.size?u.EXTRUDE_EDGES:u.EXTRUDE;case "fill":return null!=m.outline&&0<m.outline.size?u.FILL_OUTLINE:
u.FILL;case "water":return u.FILL;case "line":return"round"===m.join?u.LINE_ROUND:u.LINE_MITER;case "path":switch(m.join){case "round":switch(m.profile){case "circle":return u.PATH_ROUND_CIRCLE;case "quad":return u.PATH_ROUND_QUAD;default:b.neverReached(m.profile);return}case "miter":case "bevel":switch(m.profile){case "circle":return u.PATH_MITER_CIRCLE;case "quad":return u.PATH_MITER_QUAD;default:b.neverReached(m.profile);return}default:return}case "object":return t?u.OBJECT_POINT:u.OBJECT_POLYGON;
case "icon":case "text":return t?u.ICON_POINT:u.ICON_POLYGON}}function l(t){return t.reduce((m,q,r)=>m+1/10**r*q.numVertices,0)/t.reduce((m,q,r)=>m+1/10**r,0)}const w=new h.EstimatedSymbolComplexity({}),x={},u={ICON_POINT:{bytesPerFeature:2346.460896195398,bytesPerFeatureLabel:3484.7516349999996,resourceBytes:0,draped:{bytesPerFeature:2007.3528529826217,bytesPerFeatureLabel:3522.702025}},ICON_POLYGON:{bytesPerFeature:3677.214053765355,bytesPerFeatureLabel:3502.5355950000003,resourceBytes:0,draped:{bytesPerFeature:3030.3700096053935,
bytesPerFeatureLabel:3550.247175}},OBJECT_POINT:{bytesPerFeature:569.2092700798497,bytesPerFeatureLabel:3183.0256999999992,resourceBytes:0,draped:{bytesPerFeature:569.2092700798497,bytesPerFeatureLabel:3183.0256999999992}},OBJECT_POLYGON:{bytesPerFeature:1252.202280530861,bytesPerFeatureLabel:3125.853350000001,resourceBytes:0,draped:{bytesPerFeature:1252.202280530861,bytesPerFeatureLabel:3125.853350000001}},LINE_MITER:{bytesPerFeature:3252.89170349711,bytesPerFeatureLabel:3554.3931949999997,resourceBytes:0,
draped:{bytesPerFeature:2843.5793737736867,bytesPerFeatureLabel:3538.2547083333334}},LINE_ROUND:{bytesPerFeature:3384.080501909172,bytesPerFeatureLabel:3522.6055950000004,resourceBytes:0,draped:{bytesPerFeature:2833.1897218657587,bytesPerFeatureLabel:3532.0680950000005}},PATH_MITER_CIRCLE:{bytesPerFeature:38490.63544346431,bytesPerFeatureLabel:3660.7835999999998,resourceBytes:0,draped:{bytesPerFeature:38490.63544346431,bytesPerFeatureLabel:3660.7835999999998}},PATH_ROUND_CIRCLE:{bytesPerFeature:42934.88589895749,
bytesPerFeatureLabel:3729.49955,resourceBytes:0,draped:{bytesPerFeature:42934.88589895749,bytesPerFeatureLabel:3729.49955}},PATH_MITER_QUAD:{bytesPerFeature:25392.923576583788,bytesPerFeatureLabel:3647.05925,resourceBytes:0,draped:{bytesPerFeature:25392.923576583788,bytesPerFeatureLabel:3647.05925}},PATH_ROUND_QUAD:{bytesPerFeature:40448.297252606244,bytesPerFeatureLabel:3646.8303499999997,resourceBytes:0,draped:{bytesPerFeature:40448.297252606244,bytesPerFeatureLabel:3646.8303499999997}},FILL:{bytesPerFeature:3419.9079008788176,
bytesPerFeatureLabel:3564.2132483333335,resourceBytes:0,draped:{bytesPerFeature:2910.096178654882,bytesPerFeatureLabel:3554.8655816666665}},FILL_OUTLINE:{bytesPerFeature:5018.088812445781,bytesPerFeatureLabel:3524.8219616666665,resourceBytes:0,draped:{bytesPerFeature:4278.49006198517,bytesPerFeatureLabel:3532.068368333334}},EXTRUDE:{bytesPerFeature:7963.8889768932695,bytesPerFeatureLabel:3628.5106350000005,resourceBytes:0,draped:{bytesPerFeature:7963.8889768932695,bytesPerFeatureLabel:3628.5106350000005}},
EXTRUDE_EDGES:{bytesPerFeature:3111.7648563053044,bytesPerFeatureLabel:2658.4350683333337,resourceBytes:0,draped:{bytesPerFeature:3111.7648563053044,bytesPerFeatureLabel:2658.4350683333337}}};a.averageSymbolComplexities=function(t){t=d(t);0<t.numComplexities&&(t.verticesPerFeature/=t.numComplexities,t.verticesPerCoordinate/=t.numComplexities,t.drawCallsPerFeature/=t.numComplexities,t.memory.bytesPerFeature/=t.numComplexities,t.memory.bytesPerFeatureLabel/=t.numComplexities,t.memory.resourceBytes/=
t.numComplexities,t.memory.draped.bytesPerFeature/=t.numComplexities,t.memory.draped.bytesPerFeatureLabel/=t.numComplexities);return t};a.defaultSymbolComplexity=function(t){if("web-style"===t.type)return w;const m=t.symbolLayers.toArray().map(q=>f(t,q));return d(m)};a.defaultSymbolLayerComplexity=f;a.defaultSymbolLayerMemoryComplexity=c;a.emptySymbolComplexity=w;a.estimateNumVerticesForLods=l;a.memoryEstimators=u;a.totalSymbolComplexities=d;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/layers/graphics/Graphics3DPathSymbolLayerConstants":function(){define(["exports"],function(a){a.pathNumCircleProfileSubdivisions=10;a.pathNumRoundCapExtrusionSubdivisions=3;a.pathNumRoundJoinSubdivisions=3;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/primitiveObjectSymbolUtils":function(){define(["exports","../../../../core/has","../../webgl-engine/lib/GeometryUtil","../../webgl-engine/lib/lodRendering/LodResources"],function(a,b,n,
k){const p=[{tesselation:6,minScreenSpaceRadius:0},{tesselation:18,minScreenSpaceRadius:7},{tesselation:64,minScreenSpaceRadius:65}];a.isValidPrimitive=function(h){switch(h){case "sphere":case "cube":case "diamond":case "cylinder":case "cone":case "inverted-cone":case "tetrahedron":return!0}return!1};a.primitiveLodResources=function(h,e){const g=(d,f,c=!1)=>new k.LodResources(d.map(l=>{const w=f(l.tesselation);c&&n.cgToGIS(w);return new k.LodLevelResources([new k.LodComponentResources(w)],l.minScreenSpaceRadius)}));
switch(h){case "sphere":return g([{tesselation:0,minScreenSpaceRadius:0},{tesselation:1,minScreenSpaceRadius:8},{tesselation:2,minScreenSpaceRadius:16},{tesselation:3,minScreenSpaceRadius:50},{tesselation:4,minScreenSpaceRadius:250}],d=>n.createPolySphereGeometry(e,.5,d,!0));case "cube":return g([{tesselation:0,minScreenSpaceRadius:0}],()=>n.createBoxGeometry(e,1));case "cone":return g(p,d=>n.createConeGeometry(e,1,.5,d,!1),!0);case "inverted-cone":return g(p,d=>n.createConeGeometry(e,1,.5,d,!0),
!0);case "cylinder":return g(p,d=>n.createCylinderGeometry(e,1,.5,d,[0,0,1],[0,0,.5]));case "tetrahedron":return g([{tesselation:0,minScreenSpaceRadius:0}],()=>n.createTetrahedronGeometry(e,1),!0);case "diamond":return g([{tesselation:0,minScreenSpaceRadius:0}],()=>n.createDiamondGeometry(e,1),!0)}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/GeometryUtil":function(){define("exports ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../geometry/support/DoubleArray ../../../../geometry/support/FloatArray ../../../../geometry/support/Indices ../../../../geometry/support/plane ../../../../geometry/support/ray ./Attribute ./BufferVectorMath ./ContentObjectType ./Geometry ./Util ./VertexAttribute".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w,x,u){function t(fa,ha,T){function S(ea,ka){ea>ka&&([ea,ka]=[ka,ea]);const ja=ea.toString()+"."+ka.toString();if(Y[ja])return Y[ja];let X=Z.length;Z.length+=3;y.add(Z,3*ea,Z,3*ka,Z,X);y.scale(Z,X,fa/y.length(Z,X));X/=3;return Y[ja]=X}let Z;T?(Z=[0,-1,0,1,0,0,0,0,1,-1,0,0,0,0,-1,0,1,0],T=[0,1,2,0,2,3,0,3,4,0,4,1,1,5,2,2,5,3,3,5,4,4,5,1]):(T=fa*(1+Math.sqrt(5))/2,Z=[-fa,T,0,fa,T,0,-fa,-T,0,fa,-T,0,0,-fa,T,0,fa,T,0,-fa,-T,0,fa,-T,T,0,-fa,T,0,fa,-T,0,-fa,-T,0,fa],T=[0,
11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1]);for(var ia=0;ia<Z.length;ia+=3)y.scale(Z,ia,fa/y.length(Z,ia));let Y={};for(ia=0;ia<ha;ia++){const ea=T.length,ka=Array(4*ea);for(let ja=0;ja<ea;ja+=3){const X=T[ja],aa=T[ja+1],pa=T[ja+2],la=S(X,aa),na=S(aa,pa),qa=S(pa,X),sa=4*ja;ka[sa]=X;ka[sa+1]=la;ka[sa+2]=qa;ka[sa+3]=aa;ka[sa+4]=na;ka[sa+5]=la;ka[sa+6]=pa;ka[sa+7]=qa;ka[sa+8]=na;ka[sa+9]=la;ka[sa+10]=na;ka[sa+11]=qa}T=
ka;Y={}}ha=h.floatArrayFrom(Z);for(ia=0;ia<ha.length;ia+=3)y.normalize(ha,ia);return[[u.VertexAttribute.POSITION,new f.Attribute(h.floatArrayFrom(Z),T,3,!0)],[u.VertexAttribute.NORMAL,new f.Attribute(ha,T,3,!0)]]}function m(fa,ha,T,S,Z=!0,ia=!0){let Y=0;var ea=n.fromValues(0,Y,0),ka=n.fromValues(0,Y+fa,0),ja=n.fromValues(0,-1,0),X=n.fromValues(0,1,0);S&&(Y=fa,ka=n.fromValues(0,0,0),ea=n.fromValues(0,Y,0),ja=n.fromValues(0,1,0),X=n.fromValues(0,-1,0));ea=[ka,ea];ja=[ja,X];X=T+2;ka=Math.sqrt(fa*fa+
ha*ha);if(S)for(S=T-1;0<=S;S--){var aa=2*Math.PI/T*S,pa=n.fromValues(Math.cos(aa)*ha,Y,Math.sin(aa)*ha);ea.push(pa);aa=n.fromValues(fa*Math.cos(aa)/ka,-ha/ka,fa*Math.sin(aa)/ka);ja.push(aa)}else for(S=0;S<T;S++)aa=2*Math.PI/T*S,pa=n.fromValues(Math.cos(aa)*ha,Y,Math.sin(aa)*ha),ea.push(pa),aa=n.fromValues(fa*Math.cos(aa)/ka,ha/ka,fa*Math.sin(aa)/ka),ja.push(aa);fa=[];ha=[];if(Z){for(Z=3;Z<ea.length;Z++)fa.push(1),fa.push(Z-1),fa.push(Z),ha.push(0),ha.push(0),ha.push(0);fa.push(ea.length-1);fa.push(2);
fa.push(1);ha.push(0);ha.push(0);ha.push(0)}if(ia){for(ia=3;ia<ea.length;ia++)fa.push(ia),fa.push(ia-1),fa.push(0),ha.push(ia),ha.push(ia-1),ha.push(1);fa.push(0);fa.push(2);fa.push(ea.length-1);ha.push(1);ha.push(2);ha.push(ja.length-1)}ia=h.newFloatArray(3*X);for(Z=0;Z<X;Z++)ia[3*Z]=ea[Z][0],ia[3*Z+1]=ea[Z][1],ia[3*Z+2]=ea[Z][2];ea=h.newFloatArray(3*X);for(Z=0;Z<X;Z++)ea[3*Z]=ja[Z][0],ea[3*Z+1]=ja[Z][1],ea[3*Z+2]=ja[Z][2];return[[u.VertexAttribute.POSITION,new f.Attribute(ia,fa,3,!0)],[u.VertexAttribute.NORMAL,
new f.Attribute(ea,ha,3,!0)]]}function q(fa,ha,T,S,Z,ia,Y=n.fromValues(0,0,0)){var ea=ha.length;const ka=h.newFloatArray(T.length*ea*3+(6*S.length||0)),ja=h.newFloatArray(T.length*ea*3+(S?6:0)),X=[],aa=[];let pa=0;var la=0;const na=k.create(),qa=k.create(),sa=k.create(),xa=k.create(),ta=k.create(),Ba=k.create(),Ia=k.create(),Ca=k.create(),Ha=k.create(),Ga=k.create(),Aa=k.create(),Ja=k.create(),Sa=k.create(),$a=g.create();b.set(Ha,0,1,0);b.subtract(qa,T[1],T[0]);b.normalize(qa,qa);ia?(b.add(Ca,T[0],
Y),b.normalize(sa,Ca)):b.set(sa,0,0,1);v(qa,sa,Ha,Ha,ta,sa,.99619469809);b.copy(xa,sa);b.copy(Ja,ta);for(var Wa=0;Wa<S.length;Wa++)b.scale(Ba,ta,S[Wa][0]),b.scale(Ca,sa,S[Wa][2]),b.add(Ba,Ba,Ca),b.add(Ba,Ba,T[0]),ka[pa++]=Ba[0],ka[pa++]=Ba[1],ka[pa++]=Ba[2];ja[la++]=-qa[0];ja[la++]=-qa[1];ja[la++]=-qa[2];for(Wa=0;Wa<Z.length;Wa++)X.push(0<Z[Wa][0]?Z[Wa][0]:-Z[Wa][0]-1+S.length),X.push(0<Z[Wa][1]?Z[Wa][1]:-Z[Wa][1]-1+S.length),X.push(0<Z[Wa][2]?Z[Wa][2]:-Z[Wa][2]-1+S.length),aa.push(0),aa.push(0),
aa.push(0);Wa=S.length;const Ta=S.length-1;for(let La=0;La<T.length;La++){let Va=!1;0<La&&(b.copy(na,qa),La<T.length-1?(b.subtract(qa,T[La+1],T[La]),b.normalize(qa,qa)):Va=!0,b.add(Ga,na,qa),b.normalize(Ga,Ga),b.add(Aa,T[La-1],xa),g.fromPositionAndNormal(T[La],Ga,$a),g.intersectRay($a,d.wrap(Aa,na),Ca)?(b.subtract(Ca,Ca,T[La]),b.normalize(sa,Ca),b.cross(ta,Ga,sa),b.normalize(ta,ta)):v(Ga,xa,Ja,Ha,ta,sa,.99619469809),b.copy(xa,sa),b.copy(Ja,ta));ia&&(b.add(Ca,T[La],Y),b.normalize(Sa,Ca));for(let ma=
0;ma<ea;ma++)if(b.scale(Ba,ta,ha[ma][0]),b.scale(Ca,sa,ha[ma][1]),b.add(Ba,Ba,Ca),b.normalize(Ia,Ba),ja[la++]=Ia[0],ja[la++]=Ia[1],ja[la++]=Ia[2],b.add(Ba,Ba,T[La]),ka[pa++]=Ba[0],ka[pa++]=Ba[1],ka[pa++]=Ba[2],!Va){var Da=(ma+1)%ea;X.push(Wa+ma);X.push(Wa+ea+ma);X.push(Wa+Da);X.push(Wa+Da);X.push(Wa+ea+ma);X.push(Wa+ea+Da);for(Da=0;6>Da;Da++)aa.push(X[X.length-6+Da]-Ta)}Wa+=ea}ha=T[T.length-1];for(T=0;T<S.length;T++)b.scale(Ba,ta,S[T][0]),b.scale(Ca,sa,S[T][1]),b.add(Ba,Ba,Ca),b.add(Ba,Ba,ha),ka[pa++]=
Ba[0],ka[pa++]=Ba[1],ka[pa++]=Ba[2];S=la/3;ja[la++]=qa[0];ja[la++]=qa[1];ja[la++]=qa[2];ea=Wa-ea;for(la=0;la<Z.length;la++)X.push(0<=Z[la][0]?Wa+Z[la][0]:-Z[la][0]-1+ea),X.push(0<=Z[la][2]?Wa+Z[la][2]:-Z[la][2]-1+ea),X.push(0<=Z[la][1]?Wa+Z[la][1]:-Z[la][1]-1+ea),aa.push(S),aa.push(S),aa.push(S);Z=[[u.VertexAttribute.POSITION,new f.Attribute(ka,X,3,!0)],[u.VertexAttribute.NORMAL,new f.Attribute(ja,aa,3,!0)]];return new w.Geometry(fa,Z)}function r(fa,ha,T,S,Z){if(Math.abs(b.dot(ha,fa))>Z)return!1;
b.cross(T,fa,ha);b.normalize(T,T);b.cross(S,T,fa);b.normalize(S,S);return!0}function v(fa,ha,T,S,Z,ia,Y){return r(fa,ha,Z,ia,Y)||r(fa,T,Z,ia,Y)||r(fa,S,Z,ia,Y)}const y=c.Vec3Compact,B=[[-.5,-.5,.5],[.5,-.5,.5],[.5,.5,.5],[-.5,.5,.5],[-.5,-.5,-.5],[.5,-.5,-.5],[.5,.5,-.5],[-.5,.5,-.5]],z=[0,0,1,-1,0,0,1,0,0,0,-1,0,0,1,0,0,0,-1],A=[0,0,1,0,1,1,0,1],C=[0,1,2,2,3,0,4,0,3,3,7,4,1,5,6,6,2,1,1,0,4,4,5,1,3,2,6,6,7,3,5,4,7,7,6,5],H=Array(36);for(c=0;6>c;c++)for(var E=0;6>E;E++)H[6*c+E]=c;const F=Array(36);
for(c=0;6>c;c++)F[6*c]=0,F[6*c+1]=1,F[6*c+2]=2,F[6*c+3]=2,F[6*c+4]=3,F[6*c+5]=0;const G=[[-.5,0,-.5],[.5,0,-.5],[.5,0,.5],[-.5,0,.5],[0,-.5,0],[0,.5,0]],D=[0,1,-1,1,1,0,0,1,1,-1,1,0,0,-1,-1,1,-1,0,0,-1,1,-1,-1,0],I=[5,1,0,5,2,1,5,3,2,5,0,3,4,0,1,4,1,2,4,2,3,4,3,0],J=[0,0,0,1,1,1,2,2,2,3,3,3,4,4,4,5,5,5,6,6,6,7,7,7];c=n.fromValues(-.5,0,-.5);E=n.fromValues(.5,0,-.5);const N=n.fromValues(0,0,.5),M=n.fromValues(0,.5,0),Q=n.create(),O=n.create(),K=n.create(),L=n.create(),P=n.create();b.subtract(Q,c,M);
b.subtract(O,c,E);b.cross(K,Q,O);b.normalize(K,K);b.subtract(Q,E,M);b.subtract(O,E,N);b.cross(L,Q,O);b.normalize(L,L);b.subtract(Q,N,M);b.subtract(O,N,c);b.cross(P,Q,O);b.normalize(P,P);const R=[c,E,N,M],W=[0,-1,0,K[0],K[1],K[2],L[0],L[1],L[2],P[0],P[1],P[2]],V=[0,1,2,3,1,0,3,2,1,3,0,2],ba=[0,0,0,1,1,1,2,2,2,3,3,3],U=[[-1,-1,0],[1,-1,0],[1,1,0],[-1,1,0]],da=k.create();a.cgToGIS=function(fa,ha=fa){var T=fa.attributes;fa=T.get(u.VertexAttribute.POSITION).data;if(T=T.get(u.VertexAttribute.NORMAL).data){var S=
ha.getMutableAttribute(u.VertexAttribute.NORMAL).data;for(let Z=0;Z<T.length;Z+=3){const ia=T[Z+1];S[Z+1]=-T[Z+2];S[Z+2]=ia}}if(fa)for(ha=ha.getMutableAttribute(u.VertexAttribute.POSITION).data,T=0;T<fa.length;T+=3)S=fa[T+1],ha[T+1]=-fa[T+2],ha[T+2]=S};a.createBoxGeometry=function(fa,ha){Array.isArray(ha)||(ha=[ha,ha,ha]);const T=Array(24);for(let S=0;8>S;S++)T[3*S]=B[S][0]*ha[0],T[3*S+1]=B[S][1]*ha[1],T[3*S+2]=B[S][2]*ha[2];return new w.Geometry(fa,[[u.VertexAttribute.POSITION,new f.Attribute(T,
C,3,!0)],[u.VertexAttribute.NORMAL,new f.Attribute(z,H,3)],[u.VertexAttribute.UV0,new f.Attribute(A,F,2)]])};a.createConeGeometry=function(fa,ha,T,S,Z,ia=!0,Y=!0){return new w.Geometry(fa,m(ha,T,S,Z,ia,Y))};a.createConeGeometryData=m;a.createCylinderGeometry=function(fa,ha,T,S,Z,ia,Y){Z=Z?n.clone(Z):n.fromValues(1,0,0);ia=ia?n.clone(ia):n.fromValues(0,0,0);Y??=!0;var ea=n.create();b.normalize(ea,Z);var ka=n.create();b.scale(ka,ea,Math.abs(ha));var ja=n.create();b.scale(ja,ka,-.5);b.add(ja,ja,ia);
const X=n.fromValues(0,1,0);.2>Math.abs(1-b.dot(ea,X))&&b.set(X,0,0,1);const aa=n.create();b.cross(aa,ea,X);b.normalize(aa,aa);b.cross(X,aa,ea);ha=2*S+(Y?2:0);ia=S+(Y?2:0);Z=h.newFloatArray(3*ha);const pa=h.newFloatArray(3*ia),la=h.newFloatArray(2*ha),na=Array(3*S*(Y?4:2)),qa=Array(3*S*(Y?4:2));Y&&(Z[3*(ha-2)]=ja[0],Z[3*(ha-2)+1]=ja[1],Z[3*(ha-2)+2]=ja[2],la[2*(ha-2)]=0,la[2*(ha-2)+1]=0,Z[3*(ha-1)]=Z[3*(ha-2)]+ka[0],Z[3*(ha-1)+1]=Z[3*(ha-2)+1]+ka[1],Z[3*(ha-1)+2]=Z[3*(ha-2)+2]+ka[2],la[2*(ha-1)]=
1,la[2*(ha-1)+1]=1,pa[3*(ia-2)]=-ea[0],pa[3*(ia-2)+1]=-ea[1],pa[3*(ia-2)+2]=-ea[2],pa[3*(ia-1)]=ea[0],pa[3*(ia-1)+1]=ea[1],pa[3*(ia-1)+2]=ea[2]);ea=0;const sa=n.create(),xa=n.create();for(let Ca=0;Ca<S;Ca++){var ta=2*Math.PI/S*Ca;b.scale(sa,X,Math.sin(ta));b.scale(xa,aa,Math.cos(ta));b.add(sa,sa,xa);pa[3*Ca]=sa[0];pa[3*Ca+1]=sa[1];pa[3*Ca+2]=sa[2];b.scale(sa,sa,T);b.add(sa,sa,ja);Z[3*Ca]=sa[0];Z[3*Ca+1]=sa[1];Z[3*Ca+2]=sa[2];la[2*Ca]=Ca/S;la[2*Ca+1]=0;Z[3*(Ca+S)]=Z[3*Ca]+ka[0];Z[3*(Ca+S)+1]=Z[3*Ca+
1]+ka[1];Z[3*(Ca+S)+2]=Z[3*Ca+2]+ka[2];la[2*(Ca+S)]=Ca/S;la[2*Ca+1]=1;ta=(Ca+1)%S;var Ba=ea++,Ia=Ca;na[Ba]=Ca;qa[Ba]=Ia;Ba=ea++;Ia=Ca;na[Ba]=Ca+S;qa[Ba]=Ia;Ba=ea++;Ia=ta;na[Ba]=ta;qa[Ba]=Ia;Ba=ea++;Ia=ta;na[Ba]=ta;qa[Ba]=Ia;Ba=ea++;Ia=Ca;na[Ba]=Ca+S;qa[Ba]=Ia;Ba=ea++;Ia=ta;na[Ba]=ta+S;qa[Ba]=Ia}if(Y){for(T=0;T<S;T++)Y=(T+1)%S,ka=ea++,ja=ia-2,na[ka]=ha-2,qa[ka]=ja,ka=ea++,ja=ia-2,na[ka]=T,qa[ka]=ja,ka=ea++,ja=ia-2,na[ka]=Y,qa[ka]=ja;for(T=0;T<S;T++)Y=(T+1)%S,ka=ea++,ja=ia-1,na[ka]=T+S,qa[ka]=ja,ka=
ea++,ja=ia-1,na[ka]=ha-1,qa[ka]=ja,ka=ea++,ja=ia-1,na[ka]=Y+S,qa[ka]=ja}S=[[u.VertexAttribute.POSITION,new f.Attribute(Z,na,3,!0)],[u.VertexAttribute.NORMAL,new f.Attribute(pa,qa,3,!0)],[u.VertexAttribute.UV0,new f.Attribute(la,na,2,!0)]];return new w.Geometry(fa,S)};a.createDiamondGeometry=function(fa,ha){Array.isArray(ha)||(ha=[ha,ha,ha]);const T=Array(18);for(let S=0;6>S;S++)T[3*S]=G[S][0]*ha[0],T[3*S+1]=G[S][1]*ha[1],T[3*S+2]=G[S][2]*ha[2];return new w.Geometry(fa,[[u.VertexAttribute.POSITION,
new f.Attribute(T,I,3,!0)],[u.VertexAttribute.NORMAL,new f.Attribute(D,J,3)]])};a.createExtrudedTriangle=function(fa,ha,T,S,Z,ia=0){const Y=Array(18);ha=[[-T,ia,Z/2],[S,ia,Z/2],[0,ha+ia,Z/2],[-T,ia,-Z/2],[S,ia,-Z/2],[0,ha+ia,-Z/2]];for(T=0;6>T;T++)Y[3*T]=ha[T][0],Y[3*T+1]=ha[T][1],Y[3*T+2]=ha[T][2];return new w.Geometry(fa,[[u.VertexAttribute.POSITION,new f.Attribute(Y,[0,1,2,3,0,2,2,5,3,1,4,5,5,2,1,1,0,3,3,4,1,4,3,5],3,!0)]])};a.createPathExtrusionGeometry=q;a.createPointGeometry=function(fa,ha,
T,S,Z,ia,Y,ea,ka,ja=null){T=T?k.clone(T):k.create();ha=ha?k.clone(ha):k.fromValues(0,0,1);S=S?[255*S[0],255*S[1],255*S[2],3<S.length?255*S[3]:255]:[255,255,255,255];ia=null!=ia&&2===ia.length?ia:[1,1];const X=null!=Z?[Z]:[0];Z=e.getZeroIndexArray(1);T=[[u.VertexAttribute.POSITION,new f.Attribute(T,Z,3,!0)],[u.VertexAttribute.NORMAL,new f.Attribute(ha,Z,3,!0)],[u.VertexAttribute.COLOR,new f.Attribute(S,Z,4,!0)],[u.VertexAttribute.SIZE,new f.Attribute(ia,Z,2)],[u.VertexAttribute.ROTATION,new f.Attribute(X,
Z,1,!0)]];ea&&T.push([u.VertexAttribute.UV0,new f.Attribute(ea,Z,ea.length)]);null!=Y&&(Y=[Y[0],Y[1],Y[2],Y[3]],T.push([u.VertexAttribute.CENTEROFFSETANDDISTANCE,new f.Attribute(Y,Z,4)]));ka&&T.push([u.VertexAttribute.FEATUREATTRIBUTE,new f.Attribute([ka[0],ka[1],ka[2],ka[3]],Z,4)]);return new w.Geometry(fa,T,null,l.ContentObjectType.Point,ja)};a.createPolySphereData=t;a.createPolySphereGeometry=function(fa,ha,T,S){ha=t(ha,T,S);return new w.Geometry(fa,ha)};a.createPolylineGeometry=function(fa,ha,
T,S){x.assert(1<ha.length,"createPolylineGeometry(): polyline needs at least 2 points");x.assert(3===ha[0].length,"createPolylineGeometry(): malformed vertex");x.assert(null==T||T.length===ha.length,"createPolylineGeometry: need same number of points and normals");x.assert(null==T||3===T[0].length,"createPolylineGeometry(): malformed normal");var Z=p.newDoubleArray(3*ha.length);const ia=Array(2*(ha.length-1));var Y=0,ea=0;for(var ka=0;ka<ha.length;ka++){for(var ja=0;3>ja;ja++)Z[Y++]=ha[ka][ja];0<
ka&&(ia[ea++]=ka-1,ia[ea++]=ka)}Z=[[u.VertexAttribute.POSITION,new f.Attribute(Z,ia,3,!0)]];if(T){Y=h.newFloatArray(3*T.length);ea=0;for(ka=0;ka<ha.length;ka++)for(ja=0;3>ja;ja++)Y[ea++]=T[ka][ja];Z.push([u.VertexAttribute.NORMAL,new f.Attribute(Y,ia,3,!0)])}S&&Z.push([u.VertexAttribute.COLOR,new f.Attribute(S,e.getContinuousIndexArray(S.length/4),4)]);return new w.Geometry(fa,Z,null,l.ContentObjectType.Line)};a.createSphereGeometry=function(fa,ha,T,S,Z={uv:!0}){var ia=-Math.PI,Y=2*Math.PI,ea=-Math.PI/
2,ka=Math.PI;T=Math.max(3,Math.floor(T));S=Math.max(2,Math.floor(S));var ja=(T+1)*(S+1);const X=h.newFloatArray(3*ja),aa=h.newFloatArray(3*ja);ja=h.newFloatArray(2*ja);const pa=[];var la=0;for(var na=0;na<=S;na++){const sa=[],xa=na/S,ta=ea+xa*ka,Ba=Math.cos(ta);for(let Ia=0;Ia<=T;Ia++){const Ca=Ia/T;var qa=ia+Ca*Y;const Ha=Math.cos(qa)*Ba,Ga=Math.sin(ta);qa=-Math.sin(qa)*Ba;X[3*la]=Ha*ha;X[3*la+1]=Ga*ha;X[3*la+2]=qa*ha;aa[3*la]=Ha;aa[3*la+1]=Ga;aa[3*la+2]=qa;ja[2*la]=Ca;ja[2*la+1]=xa;sa.push(la);
++la}pa.push(sa)}ha=[];for(ia=0;ia<S;ia++)for(Y=0;Y<T;Y++)ea=pa[ia][Y],ka=pa[ia][Y+1],la=pa[ia+1][Y+1],na=pa[ia+1][Y],0===ia?(ha.push(ea),ha.push(la),ha.push(na)):ia===S-1?(ha.push(ea),ha.push(ka),ha.push(la)):(ha.push(ea),ha.push(ka),ha.push(la),ha.push(la),ha.push(na),ha.push(ea));T=[[u.VertexAttribute.POSITION,new f.Attribute(X,ha,3,!0)],[u.VertexAttribute.NORMAL,new f.Attribute(aa,ha,3,!0)]];Z.uv&&T.push([u.VertexAttribute.UV0,new f.Attribute(ja,ha,2,!0)]);Z.offset&&(T[0][0]=u.VertexAttribute.OFFSET,
T.push([u.VertexAttribute.POSITION,new f.Attribute(Float64Array.from(Z.offset),e.getZeroIndexArray(ha.length),3,!0)]));return new w.Geometry(fa,T)};a.createSquareGeometry=function(fa,ha=U){var T=Array(12);for(var S=0;4>S;S++)for(let Z=0;3>Z;Z++)T[3*S+Z]=ha[S][Z];ha=[0,1,2,2,3,0];S=[0,0,0,0,0,0];T=[[u.VertexAttribute.POSITION,new f.Attribute(T,ha,3,!0)],[u.VertexAttribute.NORMAL,new f.Attribute([0,0,1],S,3,!0)],[u.VertexAttribute.UV0,new f.Attribute([0,0,1,0,1,1,0,1],ha,2,!0)],[u.VertexAttribute.COLOR,
new f.Attribute([255,255,255,255],S,4,!0)]];return new w.Geometry(fa,T)};a.createTetrahedronGeometry=function(fa,ha){Array.isArray(ha)||(ha=[ha,ha,ha]);const T=Array(12);for(let S=0;4>S;S++)T[3*S]=R[S][0]*ha[0],T[3*S+1]=R[S][1]*ha[1],T[3*S+2]=R[S][2]*ha[2];return new w.Geometry(fa,[[u.VertexAttribute.POSITION,new f.Attribute(T,V,3,!0)],[u.VertexAttribute.NORMAL,new f.Attribute(W,ba,3)]])};a.createTubeGeometry=function(fa,ha,T,S,Z,ia){S=S||10;Z=null!=Z?Z:!0;x.assert(1<ha.length);const Y=[],ea=[];for(let ka=
0;ka<S;ka++){Y.push([0,-ka-1,-((ka+1)%S)-1]);const ja=ka/S*2*Math.PI;ea.push([Math.cos(ja)*T,Math.sin(ja)*T])}return q(fa,ea,ha,[[0,0,0]],Y,Z,ia)};a.makeOrthoBasisDirUpFallback=v;a.transformInPlace=function(fa,ha){fa=fa.getMutableAttribute(u.VertexAttribute.POSITION).data;for(let T=0;T<fa.length;T+=3)b.set(da,fa[T],fa[T+1],fa[T+2]),b.transformMat4(da,da,ha),fa[T]=da[0],fa[T+1]=da[1],fa[T+2]=da[2]};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/FloatArray":function(){define(["exports",
"../../core/typedArrayUtil"],function(a,b){a.compactFloatArray=function(n){return b.isArray(n)?n.length<b.nativeArrayMaxSize?n:new Float32Array(n):n.length<b.nativeArrayMaxSize?Array.from(n):n};a.floatArrayFrom=function(n){return(b.isArray(n)?n.length:n.byteLength/8)<=b.nativeArrayMaxSize?Array.from(n):new Float32Array(n)};a.floatSubArray=function(n,k,p){return Array.isArray(n)?n.slice(k,k+p):n.subarray(k,k+p)};a.newFloatArray=function(n,k=!1){return n<=b.nativeArrayMaxSize?k?Array(n).fill(0):Array(n):
new Float32Array(n)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/BufferVectorMath":function(){define(["exports"],function(a){a.Vec3Compact=void 0;(function(b){b.length=function(n,k){const p=n[k],h=n[k+1];n=n[k+2];return Math.sqrt(p*p+h*h+n*n)};b.normalize=function(n,k){var p=n[k];const h=n[k+1],e=n[k+2];p=1/Math.sqrt(p*p+h*h+e*e);n[k]*=p;n[k+1]*=p;n[k+2]*=p};b.scale=function(n,k,p){n[k]*=p;n[k+1]*=p;n[k+2]*=p};b.add=function(n,k,p,h,e,g=k){e=e||
n;e[g]=n[k]+p[h];e[g+1]=n[k+1]+p[h+1];e[g+2]=n[k+2]+p[h+2]};b.subtract=function(n,k,p,h,e,g=k){e=e||n;e[g]=n[k]-p[h];e[g+1]=n[k+1]-p[h+1];e[g+2]=n[k+2]-p[h+2]}})(a.Vec3Compact||(a.Vec3Compact={}));Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/lodRendering/LodResources":function(){define(["exports","../../../../../core/arrayUtils","../ContentObject","../VertexAttribute"],function(a,b,n,k){class p{constructor(g,d=null){this.geometry=g;this.textures=
d}get material(){return this.geometry.material}get numTriangles(){return this.geometry instanceof n.ContentObject?this.geometry.indexCount/3:this.geometry.elementCount/3}}class h{constructor(g,d,f){this.components=g;this.minScreenSpaceRadius=d;this.pivotOffset=f;this.numVertices=b.unique(this.components.map(c=>c.geometry)).reduce((c,l)=>{l=l instanceof n.ContentObject?l.attributes.get(k.VertexAttribute.POSITION).indices.length:l.elementCount;return c+l},0)}}class e{constructor(g){this.levels=g;this.levels.sort((d,
f)=>d.minScreenSpaceRadius===f.minScreenSpaceRadius?d.numVertices-f.numVertices:d.minScreenSpaceRadius-f.minScreenSpaceRadius)}}a.LodComponentResources=p;a.LodLevelResources=h;a.LodResources=e;a.geometriesFromLodResources=function(g){const d=[];g.levels.forEach(f=>f.components.forEach(c=>{c.geometry instanceof n.ContentObject&&d.push(c.geometry)}));return b.unique(d)};a.materialsFromLodResources=function(g){const d=[];g.levels.forEach(f=>f.components.forEach(c=>d.push(c.geometry.material)));return b.unique(d)};
a.texturesFromLodResources=function(g){const d=[];g.levels.forEach(f=>f.components.forEach(c=>{null!=c.textures&&d.push(...c.textures)}));return b.unique(d)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/SymbolComplexity":function(){define(["exports"],function(a){class b{constructor(e){this.estimated=!1;this.verticesPerFeature=e.verticesPerFeature??0;this.verticesPerCoordinate=e.verticesPerCoordinate??0;this.drawCallsPerFeature=e.drawCallsPerFeature??
0;this.memory=e.memory??new h}}class n extends b{constructor(e){super(e);this.estimated=!0}}class k extends b{constructor(e,g){super(g);this.numComplexities=e}}class p extends n{constructor(e,g){super(g);this.numComplexities=e}}class h{constructor(){this.resourceBytes=this.bytesPerFeatureLabel=this.bytesPerFeature=0;this.draped={bytesPerFeature:0,bytesPerFeatureLabel:0}}}a.AggregateSymbolComplexity=k;a.EstimatedAggregateSymbolComplexity=p;a.EstimatedSymbolComplexity=n;a.SymbolComplexity=b;a.SymbolComplexityMemory=
h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/support/edgeUtils":function(){define("exports ../../../../Color ../../../../core/has ../../../../core/screenUtils ../../../../core/libs/gl-matrix-2/factories/vec4f64 ./layerUtils ../../webgl-engine/lib/edgeRendering/interfaces ../../webgl-engine/shaders/sources/edgeRenderer/EdgeUtil.glsl".split(" "),function(a,b,n,k,p,h,e,g){function d(w,x){if(null==w)return null;const u=null!=w.color?p.fromArray(b.toUnitRGBA(w.color)):
p.fromValues(0,0,0,0),t=k.pt2px(w.size),m=k.pt2px(w.extensionLength);switch(w.type){case "solid":return f({color:u,size:t,extensionLength:m,...x});case "sketch":return{...l,color:u,size:t,extensionLength:m,...x,type:g.EdgeType.Sketch}}}function f(w){return{...c,...w,type:g.EdgeType.Solid}}const c={color:p.fromValues(0,0,0,.2),size:1,extensionLength:0,opacity:1,objectTransparency:e.Transparency.OPAQUE,hasSlicePlane:!1},l={color:p.fromValues(0,0,0,.2),size:1,extensionLength:0,opacity:1,objectTransparency:e.Transparency.OPAQUE,
hasSlicePlane:!1};a.createMaterial=function(w,x){return d(w&&w.enabled&&w.edges||null,x)};a.createMaterialFromEdges=d;a.createSolidEdgeMaterial=f;a.hasEdges=function(w){return w&&w.enabled&&(h.isExtrudeSymbol3DLayer(w)||h.isFillSymbol3DLayer(w))&&null!=w.edges};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/support/layerUtils":function(){define(["exports"],function(a){a.isExtrudeSymbol3DLayer=function(b){return"extrude"===b.type};a.isFillSymbol3DLayer=function(b){return"fill"===
b.type};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/sources/edgeRenderer/EdgeUtil.glsl":function(){define("exports ../../../collections/Component/Material/shader/ComponentData.glsl ../../../core/shaderLibrary/attributes/NormalAttribute.glsl ../../../core/shaderLibrary/util/DoublePrecision.glsl ../../../core/shaderLibrary/util/RgbaFloatEncoding.glsl ../../../core/shaderModules/Float3DrawUniform ../../../core/shaderModules/Float3PassUniform ../../../core/shaderModules/FloatPassUniform ../../../core/shaderModules/interfaces ../../../core/shaderModules/Matrix3DrawUniform ../../../core/shaderModules/Matrix3PassUniform ../../../core/shaderModules/Matrix4PassUniform ../../../core/shaderModules/Texture2DDrawUniform ../../../lib/VertexAttribute".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w,x){a.EdgeType=void 0;(function(u){u[u.Solid=0]="Solid";u[u.Sketch=1]="Sketch";u[u.Mixed=2]="Mixed";u[u.COUNT=3]="COUNT"})(a.EdgeType||(a.EdgeType={}));a.EdgeSilhouette=void 0;(function(u){u[u.REGULAR=0]="REGULAR";u[u.SILHOUETTE=1]="SILHOUETTE"})(a.EdgeSilhouette||(a.EdgeSilhouette={}));a.EdgeUtil=function(u,t){const m=u.vertex;m.include(p.RgbaFloatEncoding);u.include(n.NormalAttribute,t);m.uniforms.add(new g.FloatPassUniform("distanceFalloffFactor",q=>q.distanceFalloffFactor));
m.code.add(d.glsl`float distanceBasedPerspectiveFactor(float distance) {
return clamp(sqrt(distanceFalloffFactor / distance), 0.0, 1.0);
}`);m.uniforms.add(new w.Texture2DDrawUniform("componentDataTex",q=>q.componentDataTexture));u.attributes.add(x.VertexAttribute.COMPONENTINDEX,"float");m.constants.add("componentColorFieldOffset","float",0);m.constants.add("componentOtherFieldOffset","float",1);m.constants.add("componentVerticalOffsetFieldOffset","float",2);m.constants.add("componentFieldCount","float",3);m.constants.add("lineWidthFractionFactor","float",8);m.constants.add("extensionLengthOffset","float",128);m.code.add(d.glsl`
    vec2 _componentTextureCoords(float componentIndex, float fieldOffset) {
      float fieldIndex = componentFieldCount * componentIndex + fieldOffset;
      float texSize = float(textureSize(componentDataTex, 0).x);
      float colIndex = mod(fieldIndex, texSize);
      float rowIndex = floor(fieldIndex / texSize);

      return vec2(colIndex, rowIndex) + 0.5;
    }

    struct ComponentData {
      vec4 color;
      vec3 normal;
      vec3 normal2;
      float lineWidth;
      float extensionLength;
      float type;
      float verticalOffset;
    };

    ComponentData readComponentData() {
      vec2 colorIndex = _componentTextureCoords(componentIndex, componentColorFieldOffset);
      vec2 otherIndex = _componentTextureCoords(componentIndex, componentOtherFieldOffset);
      vec2 verticalOffsetIndex = _componentTextureCoords(componentIndex, componentVerticalOffsetFieldOffset);
      vec3 normal = normalModel();
      vec3 normal2 = ${t.silhouette?d.glsl`decompressNormal(normal2Compressed)`:d.glsl`normal`};

      vec4 colorValue = texelFetch(componentDataTex, ivec2(colorIndex), 0);
      vec4 otherValue = texelFetch(componentDataTex, ivec2(otherIndex), 0);
      float verticalOffset = uninterpolatedRGBAToFloat(texelFetch(componentDataTex, ivec2(verticalOffsetIndex), 0)) * ${d.glsl.float(b.maxElevationOffset)};

      return ComponentData(
        vec4(colorValue.rgb, colorValue.a * otherValue.w), // otherValue.w stores separate opacity
        normal, normal2,
        otherValue.x * (255.0 / lineWidthFractionFactor),
        otherValue.y * 255.0 - extensionLengthOffset,
        -(otherValue.z * 255.0) + 0.5, // SOLID (=0/255) needs to be > 0.0, SKETCHY (=1/255) needs to be <= 0;
        verticalOffset
      );
    }
  `);t.legacy?m.code.add(d.glsl`vec3 _modelToWorldNormal(vec3 normal) {
return (model * vec4(normal, 0.0)).xyz;
}
vec3 _modelToViewNormal(vec3 normal) {
return (localView * model * vec4(normal, 0.0)).xyz;
}`):(m.uniforms.add(new f.Matrix3DrawUniform("transformNormalGlobalFromModel",q=>q.transformNormalGlobalFromModel)),m.code.add(d.glsl`vec3 _modelToWorldNormal(vec3 normal) {
return transformNormalGlobalFromModel * normal;
}`));t.silhouette?(u.attributes.add(x.VertexAttribute.NORMAL2COMPRESSED,"vec2"),m.code.add(d.glsl`vec3 worldNormal(ComponentData data) {
return _modelToWorldNormal(normalize(data.normal + data.normal2));
}`)):m.code.add(d.glsl`vec3 worldNormal(ComponentData data) {
return _modelToWorldNormal(data.normal);
}`);t.legacy?m.code.add(d.glsl`void worldAndViewFromModelPosition(vec3 modelPos, float verticalOffset, out vec3 worldPos, out vec3 viewPos) {
worldPos = (model * vec4(modelPos, 1.0)).xyz;
viewPos = (localView * vec4(worldPos, 1.0)).xyz;
}`):(m.include(k.DoublePrecision,t),m.uniforms.add(new c.Matrix3PassUniform("transformViewFromCameraRelativeRS",q=>q.transformViewFromCameraRelativeRS),new f.Matrix3DrawUniform("transformWorldFromModelRS",q=>q.transformWorldFromModelRS),new h.Float3DrawUniform("transformWorldFromModelTL",q=>q.transformWorldFromModelTL),new h.Float3DrawUniform("transformWorldFromModelTH",q=>q.transformWorldFromModelTH),new e.Float3PassUniform("transformWorldFromViewTL",q=>q.transformWorldFromViewTL),new e.Float3PassUniform("transformWorldFromViewTH",
q=>q.transformWorldFromViewTH)),m.code.add(d.glsl`
      void worldAndViewFromModelPosition(vec3 modelPos, float verticalOffset, out vec3 worldPos, out vec3 viewPos) {
        vec3 rotatedModelPosition = transformWorldFromModelRS * modelPos;

        vec3 transformCameraRelativeFromModel = dpAdd(
          transformWorldFromModelTL,
          transformWorldFromModelTH,
          -transformWorldFromViewTL,
          -transformWorldFromViewTH
        );

        worldPos = transformCameraRelativeFromModel + rotatedModelPosition;

        if (verticalOffset != 0.0) {
          vec3 vUp = ${t.spherical?d.glsl`normalize(transformWorldFromModelTL + rotatedModelPosition);`:d.glsl`vec3(0.0, 0.0, 1.0);`}
          worldPos += verticalOffset * vUp;
        }

        viewPos = transformViewFromCameraRelativeRS * worldPos;
      }
    `));m.uniforms.add(new l.Matrix4PassUniform("transformProjFromView",(q,r)=>r.camera.projectionMatrix));m.code.add(d.glsl`vec4 projFromViewPosition(vec3 position) {
return transformProjFromView * vec4(position, 1.0);
}`);m.code.add(d.glsl`float calculateExtensionLength(float extensionLength, float lineLength) {
return extensionLength / (log2(max(1.0, 256.0 / lineLength)) * 0.2 + 1.0);
}`)};a.usesSketchLogic=function(u){return u===a.EdgeType.Sketch||u===a.EdgeType.Mixed};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/collections/Component/Material/shader/ComponentData.glsl":function(){define("exports ../../../../../../../core/compilerUtils ../../../../../../../core/floatRGBA ./DecodeSymbolColor.glsl ../../../../core/shaderLibrary/ShaderOutput ../../../../core/shaderLibrary/util/RgbaFloatEncoding.glsl ../../../../core/shaderModules/Float4DrawUniform ../../../../core/shaderModules/IntegerDrawUniform ../../../../core/shaderModules/interfaces ../../../../core/shaderModules/Texture2DDrawUniform ../../../../effects/geometry/olidUtils ../../../../lib/VertexAttribute".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l){function w(t,m){const {vertex:q,fragment:r}=t;q.include(h.RgbaFloatEncoding);q.uniforms.add(new f.Texture2DDrawUniform("componentColorTex",v=>v.componentParameters.texture.texture));t.attributes.add(l.VertexAttribute.COMPONENTINDEX,"float");t.varyings.add("vExternalColorMixMode","mediump float");t.varyings.add("vExternalColor","vec4");(m=m.output===p.ShaderOutput.ObjectAndLayerIdColor)&&t.varyings.add("vObjectAndLayerIdColor","vec4");t.include(k.DecodeSymbolColor);
q.constants.add("stride","float",c.olidEnabled()?3:2);q.code.add(d.glsl`vec2 getComponentTextureCoordinates(float componentIndex, float typeOffset) {
float index = componentIndex * stride + typeOffset;
float texSize = float(textureSize(componentColorTex, 0).x);
float coordX = mod(index, texSize);
float coordY = floor(index / texSize);
return vec2(coordX, coordY) + 0.5;
}`);q.code.add(d.glsl`
  vec4 _readComponentColor() {
    vec2 textureCoordinates = getComponentTextureCoordinates(componentIndex, 0.0);
    return texelFetch(componentColorTex, ivec2(textureCoordinates), 0);
   }

  float readElevationOffset() {
    vec2 textureCoordinates = getComponentTextureCoordinates(componentIndex, 1.0);
    vec4 encodedElevation = texelFetch(componentColorTex, ivec2(textureCoordinates), 0);
    return uninterpolatedRGBAToFloat(encodedElevation) * ${d.glsl.float(u)};
  }

  ${m?d.glsl`
          void forwardObjectAndLayerIdColor() {
            vec2 textureCoordinates = getComponentTextureCoordinates(componentIndex, 2.0);
            vObjectAndLayerIdColor = texelFetch(componentColorTex, ivec2(textureCoordinates), 0);
          }`:d.glsl`void forwardObjectAndLayerIdColor() {}`}

  vec4 forwardExternalColor(out bool castShadows) {
    vec4 componentColor = _readComponentColor() * 255.0;

    float shadowFlag = mod(componentColor.b * 255.0, 2.0);
    componentColor.b -= shadowFlag;
    castShadows = shadowFlag >= 1.0;

    int decodedColorMixMode;
    vExternalColor = decodeSymbolColor(componentColor, decodedColorMixMode) * 0.003921568627451; // = 1/255;
    vExternalColorMixMode = float(decodedColorMixMode) + 0.5; // add 0.5 to avoid interpolation artifacts

    return vExternalColor;
  }
`);r.code.add(d.glsl`
  void readExternalColor(out vec4 externalColor, out int externalColorMixMode) {
    externalColor = vExternalColor;
    externalColorMixMode = int(vExternalColorMixMode);
  }

  void outputObjectAndLayerIdColor() {
     ${m?d.glsl`fragColor = vObjectAndLayerIdColor;`:""}
  }
`)}function x(t,m){const {vertex:q,fragment:r}=t;q.uniforms.add(new e.Float4DrawUniform("externalColor",v=>v.componentParameters.externalColor));r.uniforms.add(new g.IntegerDrawUniform("externalColorMixMode",v=>v.componentParameters.externalColorMixMode));t.varyings.add("vExternalColor","vec4");q.code.add(d.glsl`float readElevationOffset() {
return 0.0;
}
void forwardObjectAndLayerIdColor() {}
vec4 forwardExternalColor(out bool castShadows) {
vExternalColor = externalColor;
castShadows = true;
return externalColor;
}`);r.code.add(d.glsl`
  void readExternalColor(out vec4 color, out int colorMixMode) {
    color = vExternalColor;
    colorMixMode = externalColorMixMode;
  }

  void outputObjectAndLayerIdColor() {
    ${m.output===p.ShaderOutput.ObjectAndLayerIdColor?d.glsl`fragColor = vec4(0, 0, 0, 0);`:""}
 }
`)}a.ComponentDataType=void 0;(function(t){t[t.Uniform=0]="Uniform";t[t.Varying=1]="Varying";t[t.COUNT=2]="COUNT"})(a.ComponentDataType||(a.ComponentDataType={}));const u=2**32/1E4;a.ComponentData=function(t,m){switch(m.componentData){case a.ComponentDataType.Varying:return w(t,m);case a.ComponentDataType.Uniform:return x(t,m);case a.ComponentDataType.COUNT:break;default:b.neverReached(m.componentData)}};a.encodeElevationOffset=function(t,m){n.packFloatRGBA(t/u*.5+.5,m)};a.maxElevationOffset=u;Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/core/floatRGBA":function(){define(["exports","./mathUtils"],function(a,b){function n(e,g=0){let d=0;for(let f=0;4>f;f++)d+=e[g+f]*p[f];return d}const k=[1,256,65536,16777216],p=[1/256,1/65536,1/16777216,1/4294967296],h=n(new Uint8ClampedArray([255,255,255,255]));a.packFloatRGBA=function(e,g,d=0){e=b.clamp(e,0,h);for(let l=0;4>l;l++){var f=Math,c=e*k[l];g[d+l]=f.floor.call(f,256*(c-Math.floor(c)))}};a.unpackFloatRGBA=n;Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/views/3d/webgl-engine/collections/Component/Material/shader/DecodeSymbolColor.glsl":function(){define(["exports","../../../../../layers/support/symbolColorUtils","../../../../core/shaderModules/interfaces"],function(a,b,n){a.DecodeSymbolColor=function(k){k.vertex.code.add(n.glsl`
    vec4 decodeSymbolColor(vec4 symbolColor, out int colorMixMode) {
      float symbolAlpha = 0.0;

      const float maxTint = 85.0;
      const float maxReplace = 170.0;
      const float scaleAlpha = 3.0;

      if (symbolColor.a > maxReplace) {
        colorMixMode = ${n.glsl.int(b.ColorMixModeEnum.Multiply)};
        symbolAlpha = scaleAlpha * (symbolColor.a - maxReplace);
      } else if (symbolColor.a > maxTint) {
        colorMixMode = ${n.glsl.int(b.ColorMixModeEnum.Replace)};
        symbolAlpha = scaleAlpha * (symbolColor.a - maxTint);
      } else if (symbolColor.a > 0.0) {
        colorMixMode = ${n.glsl.int(b.ColorMixModeEnum.Tint)};
        symbolAlpha = scaleAlpha * symbolColor.a;
      } else {
        colorMixMode = ${n.glsl.int(b.ColorMixModeEnum.Multiply)};
        symbolAlpha = 0.0;
      }

      return vec4(symbolColor.r, symbolColor.g, symbolColor.b, symbolAlpha);
    }
  `)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/support/symbolColorUtils":function(){define(["exports","../../../../core/mathUtils"],function(a,b){a.ColorMixModeEnum=void 0;(function(n){n[n.Multiply=1]="Multiply";n[n.Ignore=2]="Ignore";n[n.Replace=3]="Replace";n[n.Tint=4]="Tint"})(a.ColorMixModeEnum||(a.ColorMixModeEnum={}));a.encodeSymbolColor=function(n,k,p){if(null==n||k===a.ColorMixModeEnum.Ignore)p[0]=255,p[1]=255,p[2]=255,p[3]=255;else{var h=b.clamp(Math.round(85*
n[3]),0,85);k=0===h||k===a.ColorMixModeEnum.Tint?0:k===a.ColorMixModeEnum.Replace?85:170;p[0]=b.clamp(Math.round(255*n[0]),0,255);p[1]=b.clamp(Math.round(255*n[1]),0,255);p[2]=b.clamp(Math.round(255*n[2]),0,255);p[3]=h+k}};a.parseColorMixMode=function(n){switch(n){case "multiply":return a.ColorMixModeEnum.Multiply;case "ignore":return a.ColorMixModeEnum.Ignore;case "replace":return a.ColorMixModeEnum.Replace;case "tint":return a.ColorMixModeEnum.Tint;default:return a.ColorMixModeEnum.Multiply}};Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/IntegerDrawUniform":function(){define(["exports","./Uniform","../shaderTechnique/BindType"],function(a,b,n){class k extends b.Uniform{constructor(p,h){super(p,"int",n.BindType.Draw,(e,g,d)=>e.setUniform1i(p,h(g,d)))}}a.IntegerDrawUniform=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/NormalAttribute.glsl":function(){define(["exports","../../../../../../core/compilerUtils",
"../../shaderModules/interfaces","../../../lib/VertexAttribute"],function(a,b,n,k){a.NormalType=void 0;(function(p){p[p.Attribute=0]="Attribute";p[p.Compressed=1]="Compressed";p[p.ScreenDerivative=2]="ScreenDerivative";p[p.COUNT=3]="COUNT"})(a.NormalType||(a.NormalType={}));a.NormalAttribute=function(p,h){switch(h.normalType){case a.NormalType.Compressed:p.attributes.add(k.VertexAttribute.NORMALCOMPRESSED,"vec2");p.vertex.code.add(n.glsl`vec3 decompressNormal(vec2 normal) {
float z = 1.0 - abs(normal.x) - abs(normal.y);
return vec3(normal + sign(normal) * min(z, 0.0), z);
}
vec3 normalModel() {
return decompressNormal(normalCompressed);
}`);break;case a.NormalType.Attribute:p.attributes.add(k.VertexAttribute.NORMAL,"vec3");p.vertex.code.add(n.glsl`vec3 normalModel() {
return normal;
}`);break;case a.NormalType.ScreenDerivative:p.fragment.code.add(n.glsl`vec3 screenDerivativeNormal(vec3 positionView) {
return normalize(cross(dFdx(positionView), dFdy(positionView)));
}`);break;default:b.neverReached(h.normalType);case a.NormalType.COUNT:}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/DoublePrecision.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,b){a.DoublePrecision=function({code:n},k){k.doublePrecisionRequiresObfuscation?n.add(b.glsl`vec3 dpPlusFrc(vec3 a, vec3 b) {
return mix(a, a + b, vec3(notEqual(b, vec3(0))));
}
vec3 dpMinusFrc(vec3 a, vec3 b) {
return mix(vec3(0), a - b, vec3(notEqual(a, b)));
}
vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
vec3 t1 = dpPlusFrc(hiA, hiB);
vec3 e = dpMinusFrc(t1, hiA);
vec3 t2 = dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;
return t1 + t2;
}`):n.add(b.glsl`vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
vec3 t1 = hiA + hiB;
vec3 e = t1 - hiA;
vec3 t2 = ((hiB - e) + (hiA - (t1 - e))) + loA + loB;
return t1 + t2;
}`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/Matrix3DrawUniform":function(){define(["exports","./Uniform","../shaderTechnique/BindType"],function(a,b,n){class k extends b.Uniform{constructor(p,h){super(p,"mat3",n.BindType.Draw,(e,g,d)=>e.setUniformMatrix3fv(p,h(g,d)))}}a.Matrix3DrawUniform=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/DefaultMaterial":function(){define("exports ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../ViewingMode ../../support/buffer/InterleavedLayout ../core/shaderLibrary/ShaderOutput ../core/shaderLibrary/attributes/NormalAttribute.glsl ../core/shaderLibrary/output/Emissions.glsl ../core/shaderLibrary/shading/Normals.glsl ../core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../core/shaderLibrary/util/AlphaCutoff ../effects/geometry/olidUtils ../lib/basicInterfaces ../lib/GLTextureMaterial ../lib/Material ../lib/OrderIndependentTransparency ../lib/RayIntersections ../lib/RenderSlot ../lib/VertexAttribute ../lib/verticalOffsetUtils ./DefaultBufferWriter ./internal/MaterialUtil ../shaders/DefaultMaterialTechnique ../shaders/DefaultMaterialTechniqueConfiguration ../shaders/RealisticTreeTechnique".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w,x,u,t,m,q,r,v,y,B,z,A,C){function H(K){const L=p.newLayout().vec3f(r.VertexAttribute.POSITION);K.normalType===e.NormalType.Compressed?L.vec2i16(r.VertexAttribute.NORMALCOMPRESSED,{glNormalized:!0}):L.vec3f(r.VertexAttribute.NORMAL);K.hasVertexTangents&&L.vec4f(r.VertexAttribute.TANGENT);(K.textureId||K.normalTextureId||K.metallicRoughnessTextureId||K.emissiveTextureId||K.occlusionTextureId)&&L.vec2f(r.VertexAttribute.UV0);K.hasVertexColors&&L.vec4u8(r.VertexAttribute.COLOR);
K.hasSymbolColors&&L.vec4u8(r.VertexAttribute.SYMBOLCOLOR);l.olidEnabled()&&L.vec4u8(r.VertexAttribute.OBJECTANDLAYERIDCOLOR);return L}class E extends u.Material{constructor(K,L){super(K,G);this.materialType="default";this.supportsEdges=!0;this.produces=new Map([[q.RenderSlot.OPAQUE_MATERIAL,P=>(h.is3DGeometryOutputMRT(P)||h.isShadowRelatedOutput(P))&&!this.parameters.transparent],[q.RenderSlot.TRANSPARENT_MATERIAL,P=>(h.is3DGeometryOutputMRT(P)||h.isShadowRelatedOutput(P))&&this.parameters.transparent&&
this.parameters.writeDepth],[q.RenderSlot.TRANSPARENT_MATERIAL_WITHOUT_DEPTH,P=>(h.is3DGeometryOutput(P)||h.isShadowRelatedOutput(P))&&this.parameters.transparent&&!this.parameters.writeDepth]]);this._vertexBufferLayout=H(this.parameters);this._configuration=new A.DefaultMaterialTechniqueConfiguration(L.spherical,L.doublePrecisionRequiresObfuscation)}isVisibleForOutput(K){return K===h.ShaderOutput.Shadow||K===h.ShaderOutput.ShadowExcludeHighlight||K===h.ShaderOutput.ShadowHighlight?this.parameters.castShadows:
!0}get visible(){var K=this.parameters;if(K.layerOpacity<c.alphaCutoff)return!1;const {hasInstancedColor:L,hasVertexColors:P,hasSymbolColors:R,vvColor:W}=K,V=L||W||R,ba="replace"===K.colorMixMode,U=K.opacity>=c.alphaCutoff;if(P&&V)return ba||U;K=K.externalColor&&K.externalColor[3]>=c.alphaCutoff;return P?ba?K:U:V?ba||U:ba?K:U}get hasEmissions(){return!!this.parameters.emissiveTextureId||!b.exactEquals(this.parameters.emissiveFactor,n.ZEROS)}getConfiguration(K,L){const P=this.parameters,{treeRendering:R,
doubleSided:W,doubleSidedType:V}=P;this._configuration.output=K;this._configuration.hasNormalTexture=!R&&!!P.normalTextureId;this._configuration.hasColorTexture=!!P.textureId;this._configuration.hasVertexTangents=!R&&P.hasVertexTangents;this._configuration.instanced=P.isInstanced;this._configuration.instancedDoublePrecision=P.instancedDoublePrecision;this._configuration.vvSize=!!P.vvSize;this._configuration.hasVerticalOffset=null!=P.verticalOffset;this._configuration.hasScreenSizePerspective=null!=
P.screenSizePerspective;this._configuration.hasSlicePlane=P.hasSlicePlane;this._configuration.hasSliceHighlight=P.hasSliceHighlight;this._configuration.alphaDiscardMode=P.textureAlphaMode;this._configuration.normalType=R?e.NormalType.Attribute:P.normalType;this._configuration.transparent=P.transparent;this._configuration.writeDepth=P.writeDepth;null!=P.customDepthTest&&(this._configuration.customDepthTest=P.customDepthTest);this._configuration.hasOccludees=L.hasOccludees;this._configuration.cullFace=
P.hasSlicePlane?w.CullFaceOptions.None:P.cullFace;this._configuration.terrainDepthTest=L.terrainDepthTest;this._configuration.cullAboveTerrain=L.cullAboveTerrain;this._configuration.hasModelTransformation=!R&&null!=P.modelTransformation;this._configuration.hasVertexColors=P.hasVertexColors;this._configuration.hasSymbolColors=P.hasSymbolColors;this._configuration.doubleSidedMode=R?d.NormalsDoubleSidedMode.WindingOrder:W&&"normal"===V?d.NormalsDoubleSidedMode.View:W&&"winding-order"===V?d.NormalsDoubleSidedMode.WindingOrder:
d.NormalsDoubleSidedMode.None;this._configuration.instancedColor=P.hasInstancedColor;this._configuration.receiveShadows=P.receiveShadows&&P.receiveShadows;this._configuration.receiveAmbientOcclusion=P.receiveAmbientOcclusion&&null!=L.ssao;this._configuration.vvColor=!!P.vvColor;this._configuration.textureAlphaPremultiplied=!!P.textureAlphaPremultiplied;this._configuration.pbrMode=P.usePBR?P.isSchematic?f.PBRMode.Schematic:f.PBRMode.Normal:f.PBRMode.Disabled;this._configuration.hasMetallicRoughnessTexture=
!R&&!!P.metallicRoughnessTextureId;this._configuration.emissionSource=R?g.EmissionSource.None:null!=P.emissiveTextureId?g.EmissionSource.Texture:P.usePBR?g.EmissionSource.Value:g.EmissionSource.None;this._configuration.hasOcclusionTexture=!R&&!!P.occlusionTextureId;this._configuration.offsetBackfaces=!(!P.transparent||!P.offsetTransparentBackfaces);this._configuration.oitPass=L.oitPass;this._configuration.enableOffset=L.camera.relativeElevation<t.OITPolygonOffsetLimit;this._configuration.snowCover=
null!=L.weather&&L.weatherVisible&&"snowy"===L.weather.type&&"enabled"===L.weather.snowCover;this._configuration.hasColorTextureTransform=!!P.colorTextureTransformMatrix;this._configuration.hasNormalTextureTransform=!!P.normalTextureTransformMatrix;this._configuration.hasEmissionTextureTransform=!!P.emissiveTextureTransformMatrix;this._configuration.hasOcclusionTextureTransform=!!P.occlusionTextureTransformMatrix;this._configuration.hasMetallicRoughnessTextureTransform=!!P.metallicRoughnessTextureTransformMatrix;
return this._configuration}intersect(K,L,P,R,W,V){if(null!=this.parameters.verticalOffset){const U=P.camera;b.set(Q,L[12],L[13],L[14]);L=null;switch(P.viewingMode){case k.ViewingMode.Global:L=b.normalize(N,Q);break;case k.ViewingMode.Local:L=b.copy(N,J)}let da=0;var ba=b.subtract(O,Q,U.eye);const fa=b.length(ba);ba=b.scale(ba,ba,1/fa);let ha=null;this.parameters.screenSizePerspective&&(ha=b.dot(L,ba));da+=B.verticalOffsetAtDistance(U,fa,this.parameters.verticalOffset,ha??0,this.parameters.screenSizePerspective);
b.scale(L,L,da);b.transformMat3(M,L,P.transform.inverseRotation);R=b.subtract(D,R,M);W=b.subtract(I,W,M)}m.intersectTriangleGeometry(K,P,R,W,v.getVerticalOffsetObject3D(P.verticalOffset),V)}createGLMaterial(K){return new F(K)}createBufferWriter(){return new y.DefaultBufferWriter(this._vertexBufferLayout)}}class F extends x.GLTextureMaterial{constructor(K){super({...K,...K.material.parameters})}beginSlot(K){this._material.setParameters({receiveShadows:K.shadowMap.enabled});const L=this._material.parameters;
this.updateTexture(L.textureId);const P=K.camera.viewInverseTransposeMatrix;b.set(L.origin,P[3],P[7],P[11]);this._material.setParameters(this.textureBindParameters);return this.acquireTechnique(L.treeRendering?C.RealisticTreeTechnique:z.DefaultMaterialTechnique,K)}}class G extends z.DefaultMaterialPassParameters{constructor(){super(...arguments);this.hasVertexTangents=this.treeRendering=this.initTextureTransparent=!1}}const D=n.create(),I=n.create(),J=n.fromValues(0,0,1),N=n.create(),M=n.create(),
Q=n.create(),O=n.create();a.DefaultGLMaterial=F;a.DefaultMaterial=E;a.DefaultMaterialParameters=G;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/Normals.glsl":function(){define(["exports","../../../../../../core/compilerUtils","../../shaderModules/interfaces"],function(a,b,n){a.NormalsDoubleSidedMode=void 0;(function(k){k[k.None=0]="None";k[k.View=1]="View";k[k.WindingOrder=2]="WindingOrder";k[k.COUNT=3]="COUNT"})(a.NormalsDoubleSidedMode||
(a.NormalsDoubleSidedMode={}));a.Normals=function(k,p){k=k.fragment;k.code.add(n.glsl`struct ShadingNormalParameters {
vec3 normalView;
vec3 viewDirection;
} shadingParams;`);switch(p.doubleSidedMode){case a.NormalsDoubleSidedMode.None:k.code.add(n.glsl`vec3 shadingNormal(ShadingNormalParameters params) {
return normalize(params.normalView);
}`);break;case a.NormalsDoubleSidedMode.View:k.code.add(n.glsl`vec3 shadingNormal(ShadingNormalParameters params) {
return dot(params.normalView, params.viewDirection) > 0.0 ? normalize(-params.normalView) : normalize(params.normalView);
}`);break;case a.NormalsDoubleSidedMode.WindingOrder:k.code.add(n.glsl`vec3 shadingNormal(ShadingNormalParameters params) {
return gl_FrontFacing ? normalize(params.normalView) : normalize(-params.normalView);
}`);break;default:b.neverReached(p.doubleSidedMode);case a.NormalsDoubleSidedMode.COUNT:}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl":function(){define("exports ../attributes/VertexTextureCoordinates.glsl ../../shaderModules/Float3DrawUniform ../../shaderModules/Float3PassUniform ../../shaderModules/interfaces ../../shaderModules/Texture2DDrawUniform ../../shaderModules/Texture2DPassUniform ../../shaderTechnique/BindType ../../../lib/GLTextureMaterial ../../../materials/pbrUtils".split(" "),
function(a,b,n,k,p,h,e,g,d,f){a.PBRMode=void 0;(function(l){l[l.Disabled=0]="Disabled";l[l.Normal=1]="Normal";l[l.Schematic=2]="Schematic";l[l.Water=3]="Water";l[l.WaterOnIntegratedMesh=4]="WaterOnIntegratedMesh";l[l.Simplified=5]="Simplified";l[l.TerrainWithWater=6]="TerrainWithWater";l[l.COUNT=7]="COUNT"})(a.PBRMode||(a.PBRMode={}));class c extends d.GLTextureMaterialBindParameters{constructor(){super(...arguments);this.mrrFactors=f.schematicMRRFactors}}a.PBRRenderingParameters=c;a.PhysicallyBasedRenderingParameters=
function(l,w){const x=w.pbrMode,u=l.fragment;if(x!==a.PBRMode.Schematic&&x!==a.PBRMode.Disabled&&x!==a.PBRMode.Normal)u.code.add(p.glsl`void applyPBRFactors() {}`);else if(x===a.PBRMode.Disabled)u.code.add(p.glsl`void applyPBRFactors() {}
float getBakedOcclusion() { return 1.0; }`);else if(x===a.PBRMode.Schematic)u.code.add(p.glsl`vec3 mrr = vec3(0.0, 0.6, 0.2);
float occlusion = 1.0;
void applyPBRFactors() {}
float getBakedOcclusion() { return 1.0; }`);else{var {hasMetallicRoughnessTexture:t,hasMetallicRoughnessTextureTransform:m,hasOcclusionTexture:q,hasOcclusionTextureTransform:r,bindType:v}=w;(t||q)&&l.include(b.VertexTextureCoordinates,w);u.code.add(p.glsl`vec3 mrr;
float occlusion;`);t&&u.uniforms.add(v===g.BindType.Pass?new e.Texture2DPassUniform("texMetallicRoughness",y=>y.textureMetallicRoughness):new h.Texture2DDrawUniform("texMetallicRoughness",y=>y.textureMetallicRoughness));q&&u.uniforms.add(v===g.BindType.Pass?new e.Texture2DPassUniform("texOcclusion",y=>y.textureOcclusion):new h.Texture2DDrawUniform("texOcclusion",y=>y.textureOcclusion));u.uniforms.add(v===g.BindType.Pass?new k.Float3PassUniform("mrrFactors",y=>y.mrrFactors):new n.Float3DrawUniform("mrrFactors",
y=>y.mrrFactors));u.code.add(p.glsl`
    ${p.If(t,p.glsl`void applyMetallicRoughness(vec2 uv) {
            vec3 metallicRoughness = textureLookup(texMetallicRoughness, uv).rgb;
            mrr[0] *= metallicRoughness.b;
            mrr[1] *= metallicRoughness.g;
          }`)}

    ${p.If(q,"void applyOcclusion(vec2 uv) { occlusion *\x3d textureLookup(texOcclusion, uv).r; }")}

    float getBakedOcclusion() {
      return ${q?"occlusion":"1.0"};
    }

    void applyPBRFactors() {
      mrr = mrrFactors;
      occlusion = 1.0;

      ${p.If(t,`applyMetallicRoughness(${m?"metallicRoughnessUV":"vuv0"});`)}
      ${p.If(q,`applyOcclusion(${r?"occlusionUV":"vuv0"});`)}
    }
  `)}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/pbrUtils":function(){define(["exports","../../../../chunks/vec32","../../../../core/libs/gl-matrix-2/factories/vec3f64"],function(a,b,n){const k=n.freeze(1,1,.5),p=n.freeze(0,.6,.2),h=n.freeze(0,1,.2);a.advancedMRRFactors=k;a.esriSymbologyMRRFactors=h;a.schematicMRRFactors=p;a.useSchematicPBR=function({normalTexture:e,metallicRoughnessTexture:g,metallicFactor:d,roughnessFactor:f,emissiveTexture:c,
emissiveFactor:l,occlusionTexture:w}){return null==e&&null==g&&null==c&&(null==l||b.exactEquals(l,n.ZEROS))&&null==w&&(null==f||1===f)&&(null==d||1===d)};a.useSchematicPBRI3S=function({normalTexture:e,metallicRoughnessTexture:g,metallicFactor:d,roughnessFactor:f,emissiveTexture:c,emissiveFactor:l,occlusionTexture:w}){return null==e&&null==g&&null==c&&(null==l||b.exactEquals(l,n.ZEROS))&&null==w&&(null==f||1===f)&&(null==d||1===d||0===d)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/webgl-engine/lib/RayIntersections":function(){define("exports ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../geometry/support/aaBoundingBox ./ContentObjectType ./Util ./VertexAttribute".split(" "),function(a,b,n,k,p,h,e){function g(C,H,E,F,G,D,I){if(null!=C){var J=c(E,t);k.setMin(u,C.bbMin);k.setMax(u,C.bbMax);null!=G&&G.applyToAabb(u);if(l(u,H,J,F)){const {primitiveIndices:fa,position:ha}=C;J=fa?fa.length:ha.indices.length/3;if(1E3<J&&(C=C.getChildren(),
void 0!==C)){for(var N of C)g(N,H,E,F,G,D,I);return}F=J;N=ha.indices;C=ha.data;J=ha.stride;var M=fa;const T=H[0],S=H[1];H=H[2];const Z=E[0],ia=E[1];E=E[2];({normalRequired:D}=D);for(let Y=0;Y<F;++Y){const ea=M[Y];var Q=3*ea,O=J*N[Q],K=C[O],L=C[O+1],P=C[O+2],R=J*N[Q+1];O=C[R];var W=C[R+1];R=C[R+2];var V=J*N[Q+2];Q=C[V];var ba=C[V+1];V=C[V+2];null!=G&&([K,L,P]=G.applyToVertex(K,L,P,Y),[O,W,R]=G.applyToVertex(O,W,R,Y),[Q,ba,V]=G.applyToVertex(Q,ba,V,Y));O-=K;W-=L;R-=P;Q-=K;ba-=L;V-=P;var U=ia*V-ba*E,
da=E*Q-V*Z;const ka=Z*ba-Q*ia,ja=O*U+W*da+R*ka;if(!(1E-7>=Math.abs(ja))){K=T-K;L=S-L;P=H-P;U=K*U+L*da+P*ka;if(0<ja){if(0>U||U>ja)continue}else if(0<U||U<ja)continue;da=L*R-W*P;P=P*O-R*K;L=K*W-O*L;K=Z*da+ia*P+E*L;if(0<ja){if(0>K||U+K>ja)continue}else if(0<K||U+K<ja)continue;L=(Q*da+ba*P+V*L)/ja;0<=L&&(O=D?f(O,W,R,Q,ba,V,m):null,I(L,ea,O))}}}}}function d(C,H,E,F,G,D,I,J,N,M){const Q=A;var O=Math.abs(H[0]),K=Math.abs(H[1]),L=Math.abs(H[2]);O=O>=K?O>=L?0:2:K>=L?1:2;L=0>H[O]?2:1;K=(O+L)%3;L=(O+(3-L))%
3;const P=H[K]/H[O],R=H[L]/H[O];H=1/H[O];const W=q,V=r,ba=v;for({normalRequired:N}=N;E<F;++E){var U=3*E,da=I*G[U];b.set(Q[0],D[da+0],D[da+1],D[da+2]);da=I*G[U+1];b.set(Q[1],D[da+0],D[da+1],D[da+2]);U=I*G[U+2];b.set(Q[2],D[U+0],D[U+1],D[U+2]);J&&(b.copy(Q[0],J.applyToVertex(Q[0][0],Q[0][1],Q[0][2],E)),b.copy(Q[1],J.applyToVertex(Q[1][0],Q[1][1],Q[1][2],E)),b.copy(Q[2],J.applyToVertex(Q[2][0],Q[2][1],Q[2][2],E)));b.sub(W,Q[0],C);b.sub(V,Q[1],C);b.sub(ba,Q[2],C);da=W[K]-P*W[O];var fa=W[L]-R*W[O];const T=
V[K]-P*V[O],S=V[L]-R*V[O];var ha=ba[K]-P*ba[O];const Z=ba[L]-R*ba[O];U=ha*S-Z*T;ha=da*Z-fa*ha;fa=T*fa-S*da;(0>U||0>ha||0>fa)&&(0<U||0<ha||0<fa)||(da=U+ha+fa,0!==da&&(U=U*H*W[O]+ha*H*V[O]+fa*H*ba[O],0>U*Math.sign(da)||(U/=da,0<=U&&(N?(da=Q,b.sub(y,da[1],da[0]),b.sub(B,da[2],da[0]),b.cross(m,y,B),b.normalize(m,m),da=m):da=null,M(U,E,da)))))}}function f(C,H,E,F,G,D,I){b.set(y,C,H,E);b.set(B,F,G,D);b.cross(I,y,B);b.normalize(I,I);return I}function c(C,H){return b.set(H,1/C[0],1/C[1],1/C[2])}function l(C,
H,E,F){return w(C,H,E,F,Infinity)}function w(C,H,E,F,G){var D=(C[0]-F-H[0])*E[0],I=(C[3]+F-H[0])*E[0];let J=Math.min(D,I);D=Math.max(D,I);I=(C[1]-F-H[1])*E[1];const N=(C[4]+F-H[1])*E[1];D=Math.min(D,Math.max(I,N));if(0>D)return!1;J=Math.max(J,Math.min(I,N));if(J>D)return!1;I=(C[2]-F-H[2])*E[2];C=(C[5]+F-H[2])*E[2];D=Math.min(D,Math.max(I,C));if(0>D)return!1;J=Math.max(J,Math.min(I,C));return J>D?!1:J<G}class x{constructor(C=!1,H=!0){this.isVerticalRay=C;this.normalRequired=H}}const u=k.create(),t=
n.create(),m=n.create(),q=n.create(),r=n.create(),v=n.create(),y=n.create(),B=n.create(),z=n.create(),A=[n.create(),n.create(),n.create()];a.MeshIntersectionOptions=x;a.computeInvDir=function(C,H,E){return b.set(E,1/(H[0]-C[0]),1/(H[1]-C[1]),1/(H[2]-C[2]))};a.computeInvDirFromDirection=c;a.computeNormalFromBarycentric=f;a.intersectAabbInvDir=l;a.intersectAabbInvDirBefore=w;a.intersectRayTriangles=function(C,H,E,F,G,D,I,J,N,M=null,Q=0){const O=C[0],K=C[1];C=C[2];const L=H[0],P=H[1];for(H=H[2];E<F;++E){const Z=
Q+(M?M[E]:E);var R=3*Z,W=I*G[R],V=D[W],ba=D[W+1],U=D[W+2],da=I*G[R+1],fa=I*G[R+2];R=D[da]-V;W=D[da+1]-ba;da=D[da+2]-U;const ia=D[fa]-V,Y=D[fa+1]-ba;fa=D[fa+2]-U;var ha=P*fa-Y*H,T=H*ia-fa*L;const ea=L*Y-ia*P;var S=R*ha+W*T+da*ea;if(!(1E-7>=Math.abs(S))){V=O-V;ba=K-ba;U=C-U;ha=V*ha+ba*T+U*ea;if(0<S){if(0>ha||ha>S)continue}else if(0<ha||ha<S)continue;T=ba*da-W*U;U=U*R-da*V;ba=V*W-R*ba;V=L*T+P*U+H*ba;if(0<S){if(0>V||ha+V>S)continue}else if(0<V||ha+V<S)continue;S=(ia*T+Y*U+fa*ba)/S;0<=S&&(R=J?f(R,W,da,
ia,Y,fa,m):null,N(S,Z,R))}}};a.intersectRayTrianglesWithDisplacementWatertight=d;a.intersectRayTrianglesWithVerticalOffsetENUGlobal=function(C,H,E,F,G,D,I,J,N,M,Q,O=null,K=0){const L=C[0],P=C[1];C=C[2];const R=H[0],W=H[1];for(H=H[2];E<F;++E){const ja=K+(O?O[E]:E);var V=3*ja,ba=I*G[V],U=D[ba],da=D[ba+1],fa=D[ba+2],ha=I*G[V+1];ba=D[ha];var T=D[ha+1];ha=D[ha+2];var S=I*G[V+2];V=D[S];var Z=D[S+1];S=D[S+2];var ia=fa-N,Y=J/Math.sqrt(U*U+da*da+ia*ia);U+=U*Y;da+=da*Y;fa+=ia*Y;var ea=ha-N,ka=J/Math.sqrt(ba*
ba+T*T+ea*ea);ia=S-N;Y=J/Math.sqrt(V*V+Z*Z+ia*ia);ba=ba+ba*ka-U;T=T+T*ka-da;ha=ha+ea*ka-fa;V=V+V*Y-U;Z=Z+Z*Y-da;S=S+ia*Y-fa;Y=W*S-Z*H;ea=H*V-S*R;ka=R*Z-V*W;ia=ba*Y+T*ea+ha*ka;if(!(1E-7>=Math.abs(ia))){U=L-U;da=P-da;fa=C-fa;Y=U*Y+da*ea+fa*ka;if(0<ia){if(0>Y||Y>ia)continue}else if(0<Y||Y<ia)continue;ea=da*ha-T*fa;fa=fa*ba-ha*U;U=U*T-ba*da;da=R*ea+W*fa+H*U;if(0<ia){if(0>da||Y+da>ia)continue}else if(0<da||Y+da<ia)continue;U=(V*ea+Z*fa+S*U)/ia;0<=U&&(ba=M?f(ba,T,ha,V,Z,S,m):null,Q(U,ja,ba))}}};a.intersectTriangleGeometry=
function(C,H,E,F,G,D){if(C.visible){F=b.sub(z,F,E);var I=(N,M,Q)=>{D(N,Q,M,!1)},J=new x(!1,H.options.normalRequired);C.boundingInfo?(h.assert(C.type===p.ContentObjectType.Mesh),g(C.boundingInfo,E,F,H.tolerance,G,J,I)):(C=C.attributes.get(e.VertexAttribute.POSITION),H=C.indices,d(E,F,0,H.length/3,H,C.data,C.stride,G,J,I))}};a.intersectTriangles=function(C,H,E,F,G,D,I,J,N){const {data:M,stride:Q}=D;H=b.sub(z,H,C);d(C,H,E,F,G,M,Q,I,J,N)};a.triangleRayParallelTolerance=1E-7;Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/views/3d/webgl-engine/materials/DefaultBufferWriter":function(){define(["exports","../lib/VertexAttribute","./internal/bufferWriterUtils"],function(a,b,n){class k{constructor(p){this.vertexBufferLayout=p}elementCount(p){return p.get(b.VertexAttribute.POSITION).indices.length}write(p,h,e,g,d,f){n.writeDefaultAttributes(e,g,this.vertexBufferLayout,p,h,d,f)}}a.DefaultBufferWriter=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/DefaultMaterialTechnique":function(){define("require exports ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../core/libs/gl-matrix-2/factories/vec4f64 ../core/shaderLibrary/ShaderOutput ../core/shaderLibrary/attributes/NormalAttribute.glsl ../core/shaderLibrary/attributes/VertexNormal.glsl ../core/shaderLibrary/util/AlphaCutoff ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../lib/basicInterfaces ../lib/Material ../lib/OITPass ../lib/OrderIndependentTransparency ../lib/StencilUtils ../materials/pbrUtils ../../../../chunks/DefaultMaterial.glsl ../../../webgl/enums ../../../webgl/renderState".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w,x,u,t,m,q,r){class v extends e.VertexNormalPassParameters{constructor(){super(...arguments);this.usePBR=this.isSchematic=!1;this.mrrFactors=t.advancedMRRFactors;this.doubleSided=this.hasSymbolColors=this.hasVertexColors=!1;this.doubleSidedType="normal";this.cullFace=c.CullFaceOptions.Back;this.hasInstancedColor=this.isInstanced=!1;this.emissiveFactor=n.ZEROS;this.instancedDoublePrecision=!1;this.normalType=h.NormalType.Attribute;this.castShadows=this.receiveAmbientOcclusion=
this.receiveShadows=!0;this.ambient=n.freeze(.2,.2,.2);this.diffuse=n.freeze(.8,.8,.8);this.externalColor=k.fromValues(1,1,1,1);this.colorMixMode="multiply";this.layerOpacity=this.opacity=1;this.origin=n.create();this.hasSlicePlane=!1;this.hasSliceHighlight=!0;this.offsetTransparentBackfaces=!1;this.modelTransformation=this.vvSymbolRotationMatrix=this.vvSymbolAnchor=this.vvOpacity=this.vvColor=this.vvSize=null;this.transparent=!1;this.writeDepth=!0;this.customDepthTest=c.DepthTestFunction.Less;this.textureAlphaMode=
c.AlphaDiscardMode.Blend;this.textureAlphaCutoff=g.alphaCutoff;this.textureAlphaPremultiplied=!1;this.renderOccluded=l.RenderOccludedFlag.Occlude;this.isDecoration=!1}}class y extends e.VertexNormalDrawParameters{constructor(){super(...arguments);this.slicePlaneLocalOrigin=this.origin=n.create()}}class B extends f.ShaderTechnique{constructor(z,A,C,H=new d.ReloadableShaderModule(m.DefaultMaterial,()=>new Promise((E,F)=>a(["./DefaultMaterial.glsl"],E,F)))){super(z,A,H,C);this.type="DefaultMaterialTechnique"}_makePipeline(z,
A){const {oitPass:C,output:H,transparent:E,cullFace:F,customDepthTest:G,hasOccludees:D,enableOffset:I}=z,J=C===w.OITPass.NONE,N=C===w.OITPass.FrontFace;var M=r.makePipelineState,Q=p.isColorOrColorEmission(H)&&E?x.blending(C):null;var O=z.cullFace!==c.CullFaceOptions.None?!0:z.hasSlicePlane?!1:!z.transparent&&!z.doubleSidedMode;return M.call(r,{blending:Q,culling:O?r.cullingParams(F):null,depthTest:{func:x.oitDepthTest(C,G===c.DepthTestFunction.Lequal?q.CompareFunction.LEQUAL:q.CompareFunction.LESS)},
depthWrite:x.depthWrite(z),drawBuffers:H===p.ShaderOutput.Depth?{buffers:[q.SpecialDrawBuffers.NONE]}:x.getDrawBuffers(C,H),colorWrite:r.defaultColorWrite,stencilWrite:D?u.stencilWriteMaskOn:null,stencilTest:D?A?u.stencilToolMaskBaseParams:u.stencilBaseAllZerosParams:null,polygonOffset:J||N?null:x.getOITPolygonOffset(I)})}initializePipeline(z){this._occludeePipelineState=this._makePipeline(z,!0);return this._makePipeline(z,!1)}getPipeline(z){return z?this._occludeePipelineState:super.getPipeline()}}
b.DefaultMaterialDrawParameters=y;b.DefaultMaterialPassParameters=v;b.DefaultMaterialTechnique=B;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/VertexNormal.glsl":function(){define("exports ../../../../../../core/compilerUtils ../../../../../../core/libs/gl-matrix-2/factories/mat3f64 ../../../../../../core/libs/gl-matrix-2/factories/vec4f64 ./NormalAttribute.glsl ./VertexPosition.glsl ../../shaderModules/interfaces ../../shaderModules/Matrix3DrawUniform ../../shaderModules/Matrix3PassUniform".split(" "),
function(a,b,n,k,p,h,e,g,d){class f extends h.VertexPositionPassParameters{constructor(){super(...arguments);this.transformNormalViewFromGlobal=n.create()}}class c extends h.VertexPositionDrawParameters{constructor(){super(...arguments);this.transformNormalGlobalFromModel=n.create();this.toMapSpace=k.create()}}a.VertexNormal=function(l,w){switch(w.normalType){case p.NormalType.Attribute:case p.NormalType.Compressed:l.include(p.NormalAttribute,w);l.varyings.add("vNormalWorld","vec3");l.varyings.add("vNormalView",
"vec3");l.vertex.uniforms.add(new g.Matrix3DrawUniform("transformNormalGlobalFromModel",x=>x.transformNormalGlobalFromModel),new d.Matrix3PassUniform("transformNormalViewFromGlobal",x=>x.transformNormalViewFromGlobal));l.vertex.code.add(e.glsl`void forwardNormal() {
vNormalWorld = transformNormalGlobalFromModel * normalModel();
vNormalView = transformNormalViewFromGlobal * vNormalWorld;
}`);break;case p.NormalType.ScreenDerivative:l.vertex.code.add(e.glsl`void forwardNormal() {}`);break;default:b.neverReached(w.normalType);case p.NormalType.COUNT:}};a.VertexNormalDrawParameters=c;a.VertexNormalPassParameters=f;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/VertexPosition.glsl":function(){define("exports ../../../../../../core/libs/gl-matrix-2/factories/mat3f64 ../../../../../../core/libs/gl-matrix-2/factories/mat4f64 ../../../../../../core/libs/gl-matrix-2/factories/vec3f64 ./PositionAttribute.glsl ../util/DoublePrecision.glsl ../../shaderModules/Float3DrawUniform ../../shaderModules/Float3PassUniform ../../shaderModules/interfaces ../../shaderModules/Matrix3DrawUniform ../../shaderModules/Matrix3PassUniform ../../shaderModules/Matrix4PassUniform".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l){class w extends d.NoParameters{constructor(){super(...arguments);this.transformWorldFromViewTH=k.create();this.transformWorldFromViewTL=k.create();this.transformViewFromCameraRelativeRS=b.create();this.transformProjFromView=n.create()}}class x extends d.NoParameters{constructor(){super(...arguments);this.transformWorldFromModelRS=b.create();this.transformWorldFromModelTH=k.create();this.transformWorldFromModelTL=k.create()}}a.VertexPosition=function(u,t){u.include(p.PositionAttribute);
const m=u.vertex;m.include(h.DoublePrecision,t);u.varyings.add("vPositionWorldCameraRelative","vec3");u.varyings.add("vPosition_view","vec3");m.uniforms.add(new g.Float3PassUniform("transformWorldFromViewTH",q=>q.transformWorldFromViewTH),new g.Float3PassUniform("transformWorldFromViewTL",q=>q.transformWorldFromViewTL),new c.Matrix3PassUniform("transformViewFromCameraRelativeRS",q=>q.transformViewFromCameraRelativeRS),new l.Matrix4PassUniform("transformProjFromView",q=>q.transformProjFromView),new f.Matrix3DrawUniform("transformWorldFromModelRS",
q=>q.transformWorldFromModelRS),new e.Float3DrawUniform("transformWorldFromModelTH",q=>q.transformWorldFromModelTH),new e.Float3DrawUniform("transformWorldFromModelTL",q=>q.transformWorldFromModelTL));m.code.add(d.glsl`vec3 positionWorldCameraRelative() {
vec3 rotatedModelPosition = transformWorldFromModelRS * positionModel();
vec3 transform_CameraRelativeFromModel = dpAdd(
transformWorldFromModelTL,
transformWorldFromModelTH,
-transformWorldFromViewTL,
-transformWorldFromViewTH
);
return transform_CameraRelativeFromModel + rotatedModelPosition;
}`);m.code.add(d.glsl`
    void forwardPosition(float fOffset) {
      vPositionWorldCameraRelative = positionWorldCameraRelative();
      if (fOffset != 0.0) {
        vPositionWorldCameraRelative += fOffset * ${t.spherical?d.glsl`normalize(transformWorldFromViewTL + vPositionWorldCameraRelative)`:d.glsl`vec3(0.0, 0.0, 1.0)`};
      }

      vPosition_view = transformViewFromCameraRelativeRS * vPositionWorldCameraRelative;
      gl_Position = transformProjFromView * vec4(vPosition_view, 1.0);
    }
  `);u.fragment.uniforms.add(new g.Float3PassUniform("transformWorldFromViewTL",q=>q.transformWorldFromViewTL));m.code.add(d.glsl`vec3 positionWorld() {
return transformWorldFromViewTL + vPositionWorldCameraRelative;
}`);u.fragment.code.add(d.glsl`vec3 positionWorld() {
return transformWorldFromViewTL + vPositionWorldCameraRelative;
}`)};a.VertexPositionDrawParameters=x;a.VertexPositionPassParameters=w;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/PositionAttribute.glsl":function(){define(["exports","../../shaderModules/interfaces","../../../lib/VertexAttribute"],function(a,b,n){a.PositionAttribute=function(k){k.attributes.add(n.VertexAttribute.POSITION,"vec3");k.vertex.code.add(b.glsl`vec3 positionModel() { return position; }`)};Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/StencilUtils":function(){define(["exports","./basicInterfaces","../../../webgl/enums"],function(a,b,n){const k={func:n.CompareFunction.LESS},p={function:{func:n.CompareFunction.ALWAYS,ref:b.StencilBits.OutlineVisualElementMask,mask:b.StencilBits.OutlineVisualElementMask},operation:{fail:n.StencilOperation.KEEP,zFail:n.StencilOperation.KEEP,zPass:n.StencilOperation.ZERO}},h={function:{func:n.CompareFunction.ALWAYS,ref:b.StencilBits.OutlineVisualElementMask,
mask:b.StencilBits.OutlineVisualElementMask},operation:{fail:n.StencilOperation.KEEP,zFail:n.StencilOperation.KEEP,zPass:n.StencilOperation.REPLACE}},e={function:{func:n.CompareFunction.EQUAL,ref:b.StencilBits.OutlineVisualElementMask,mask:b.StencilBits.OutlineVisualElementMask},operation:{fail:n.StencilOperation.KEEP,zFail:n.StencilOperation.KEEP,zPass:n.StencilOperation.KEEP}};b={function:{func:n.CompareFunction.NOTEQUAL,ref:b.StencilBits.OutlineVisualElementMask,mask:b.StencilBits.OutlineVisualElementMask},
operation:{fail:n.StencilOperation.KEEP,zFail:n.StencilOperation.KEEP,zPass:n.StencilOperation.KEEP}};a.depthCompareAlways={func:n.CompareFunction.ALWAYS};a.depthCompareLess=k;a.renderWhenBitIsNotSet=g=>({function:{func:n.CompareFunction.NOTEQUAL,ref:g,mask:g},operation:{fail:n.StencilOperation.KEEP,zFail:n.StencilOperation.KEEP,zPass:n.StencilOperation.KEEP}});a.replaceBitWhenDepthTestPasses=g=>({function:{func:n.CompareFunction.ALWAYS,ref:g,mask:g},operation:{fail:n.StencilOperation.KEEP,zFail:n.StencilOperation.KEEP,
zPass:n.StencilOperation.REPLACE}});a.stencilBaseAllZerosParams=p;a.stencilToolMaskBaseParams=h;a.stencilToolMaskOccluderParams=e;a.stencilToolTransparentOccluderParams=b;a.stencilWriteMaskOff={mask:0};a.stencilWriteMaskOn={mask:255};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/DefaultMaterial.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderLibrary/ForwardLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/Offset.glsl ../views/3d/webgl-engine/core/shaderLibrary/ShaderOutput ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/Transform.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/InstancedDoublePrecision.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/NormalAttribute.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/PositionAttribute.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/SymbolColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VertexColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VertexNormal.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VerticalOffset.glsl ../views/3d/webgl-engine/core/shaderLibrary/default/DefaultMaterialAuxiliaryPasses.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ComputeNormalTexture.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateAmbientOcclusion.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateSceneLighting.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MainLighting.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/Normals.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRendering.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ReadShadowMap.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/TerrainDepthTest.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/TextureTransformUV.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/VisualVariables.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaCutoff ../views/3d/webgl-engine/core/shaderLibrary/util/DiscardOrAdjustAlpha.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/MixExternalColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/View.glsl ../views/3d/webgl-engine/core/shaderModules/Float3PassUniform ../views/3d/webgl-engine/core/shaderModules/Float4PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform ../views/3d/webgl-engine/lib/VertexAttribute ../views/3d/webgl-engine/shaders/OutputColorHighlightOID.glsl".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w,x,u,t,m,q,r,v,y,B,z,A,C,H,E,F,G,D,I,J,N,M,Q,O,K,L){function P(W){const V=new Q.ShaderBuilder,{vertex:ba,fragment:U,varyings:da}=V,{output:fa,normalType:ha,offsetBackfaces:T,instancedColor:S,spherical:Z,receiveShadows:ia,snowCover:Y,pbrMode:ea,textureAlphaPremultiplied:ka,instancedDoublePrecision:ja,hasVertexColors:X,hasVertexTangents:aa,hasColorTexture:pa,hasNormalTexture:la,hasNormalTextureTransform:na,hasColorTextureTransform:qa}=W;D.addProjViewLocalOrigin(ba,
W);V.include(d.PositionAttribute);da.add("vpos","vec3");V.include(H.VisualVariables,W);V.include(e.InstancedDoublePrecision,W);V.include(x.VerticalOffset,W);V.include(C.colorTextureUV,W);if(!k.isColorOrColorEmission(fa))return V.include(u.DefaultMaterialAuxiliaryPasses,W),V;V.include(C.normalTextureUV,W);V.include(C.emissiveTextureUV,W);V.include(C.occlusionTextureUV,W);V.include(C.metallicRoughnessTextureUV,W);D.addCameraPosition(ba,W);V.include(g.NormalAttribute,W);V.include(h.Transform,W);const sa=
ha===g.NormalType.Attribute||ha===g.NormalType.Compressed;sa&&T&&V.include(n.Offset);V.include(t.ComputeNormalTexture,W);V.include(w.VertexNormal,W);S&&V.attributes.add(K.VertexAttribute.INSTANCECOLOR,"vec4");da.add("vPositionLocal","vec3");V.include(c.TextureCoordinateAttribute,W);V.include(b.ForwardLinearDepth,W);V.include(f.SymbolColor,W);V.include(l.VertexColor,W);ba.uniforms.add(new J.Float4PassUniform("externalColor",xa=>xa.externalColor));da.add("vcolorExt","vec4");W.terrainDepthTest&&da.add("depth",
"float");ba.main.add(M.glsl`
    forwardNormalizedVertexColor();
    vcolorExt = externalColor;
    ${M.If(S,"vcolorExt *\x3d instanceColor * 0.003921568627451;")}
    vcolorExt *= vvColor();
    vcolorExt *= getSymbolColor();
    forwardColorMixMode();

    if (vcolorExt.a < ${M.glsl.float(E.alphaCutoff)}) {
      gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
    } else {
      vpos = getVertexInLocalOriginSpace();
      vPositionLocal = vpos - view[3].xyz;
      vpos = subtractOrigin(vpos);
      ${M.If(sa,"vNormalWorld \x3d dpNormal(vvLocalNormal(normalModel()));")}
      vpos = addVerticalOffset(vpos, localOrigin);
      ${M.If(aa,"vTangent \x3d dpTransformVertexTangent(tangent);")}
      gl_Position = transformPosition(proj, view, vpos);
      ${M.If(sa&&T,"gl_Position \x3d offsetBackfacingClipPosition(gl_Position, vpos, vNormalWorld, cameraPosition);")}
    }

    ${M.If(W.terrainDepthTest,"depth \x3d (view * vec4(vpos, 1.0)).z;")}
    forwardLinearDepth();
    forwardTextureCoordinates();
    forwardColorUV();
    forwardNormalUV();
    forwardEmissiveUV();
    forwardOcclusionUV();
    forwardMetallicRoughnessUV();
  `);V.include(q.EvaluateSceneLighting,W);V.include(m.EvaluateAmbientOcclusion,W);V.include(F.DiscardOrAdjustAlphaPass,W);V.include(ja?z.ReadShadowMapPass:z.ReadShadowMapDraw,W);V.include(A.terrainDepthTest,W);V.include(p.SliceDraw,W);V.include(L.outputColorHighlightOID,W);D.addCameraPosition(U,W);U.uniforms.add(ba.uniforms.get("localOrigin"),new I.Float3PassUniform("ambient",xa=>xa.ambient),new I.Float3PassUniform("diffuse",xa=>xa.diffuse),new N.FloatPassUniform("opacity",xa=>xa.opacity),new N.FloatPassUniform("layerOpacity",
xa=>xa.layerOpacity));pa&&U.uniforms.add(new O.Texture2DPassUniform("tex",xa=>xa.texture));V.include(B.PhysicallyBasedRenderingParameters,W);V.include(y.PhysicallyBasedRendering,W);U.include(G.MixExternalColor);V.include(v.Normals,W);q.addAmbientBoostFactor(U);q.addLightingGlobalFactor(U);r.addMainLightIntensity(U);U.main.add(M.glsl`
      discardBySlice(vpos);
      ${M.If(W.terrainDepthTest,"terrainDepthTest(depth);")}
      ${pa?M.glsl`
              vec4 texColor = texture(tex, ${qa?"colorUV":"vuv0"});
              ${M.If(ka,"texColor.rgb /\x3d texColor.a;")}
              discardOrAdjustAlpha(texColor);`:M.glsl`vec4 texColor = vec4(1.0);`}
      shadingParams.viewDirection = normalize(vpos - cameraPosition);
      ${ha===g.NormalType.ScreenDerivative?M.glsl`vec3 normal = screenDerivativeNormal(vPositionLocal);`:M.glsl`shadingParams.normalView = vNormalWorld;
                 vec3 normal = shadingNormal(shadingParams);`}
      applyPBRFactors();
      float ssao = evaluateAmbientOcclusionInverse() * getBakedOcclusion();

      vec3 posWorld = vpos + localOrigin;

      float additionalAmbientScale = additionalDirectedAmbientLight(posWorld);
      float shadow = ${ia?"max(lightingGlobalFactor * (1.0 - additionalAmbientScale), readShadowMap(vpos, linearDepth))":M.If(Z,"lightingGlobalFactor * (1.0 - additionalAmbientScale)","0.0")};

      vec3 matColor = max(ambient, diffuse);
      vec3 albedo = mixExternalColor(${M.If(X,"vColor.rgb *")} matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
      float opacity_ = layerOpacity * mixExternalOpacity(${M.If(X,"vColor.a * ")} opacity, texColor.a, vcolorExt.a, int(colorMixMode));
      ${la?`mat3 tangentSpace = computeTangentSpace(${aa?"normal":"normal, vpos, vuv0"});\n             vec3 shadingNormal = computeTextureNormal(tangentSpace, ${na?"normalUV":"vuv0"});`:"vec3 shadingNormal \x3d normal;"}
      vec3 normalGround = ${Z?"normalize(posWorld);":"vec3(0.0, 0.0, 1.0);"}

      ${M.If(Y,M.glsl`
            float snow = smoothstep(0.5, 0.55, dot(normal, normalGround));
            albedo = mix(albedo, vec3(1), snow);
            shadingNormal = mix(shadingNormal, normal, snow);
            ssao = mix(ssao, 1.0, snow);`)}

      vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;

      ${ea===B.PBRMode.Normal||ea===B.PBRMode.Schematic?M.glsl`
              float additionalAmbientIrradiance = additionalAmbientIrradianceFactor * mainLightIntensity[2];
              ${M.If(Y,M.glsl`mrr = mix(mrr, vec3(0.0, 1.0, 0.04), snow);`)}
              vec4 emission = ${Y?"mix(getEmissions(), vec4(0.0), snow)":"getEmissions()"};
              vec3 shadedColor = evaluateSceneLightingPBR(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight, shadingParams.viewDirection, normalGround, mrr, emission, additionalAmbientIrradiance);`:M.glsl`vec3 shadedColor = evaluateSceneLighting(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight);`}
      vec4 finalColor = vec4(shadedColor, opacity_);
      outputColorHighlightOID(finalColor, vpos);
  `);return V}const R=Object.freeze(Object.defineProperty({__proto__:null,build:P},Symbol.toStringTag,{value:"Module"}));a.DefaultMaterial=R;a.build=P})},"esri/views/3d/webgl-engine/core/shaderLibrary/ForwardLinearDepth.glsl":function(){define(["exports","./ShaderOutput","./attributes/VertexPosition.glsl","../shaderModules/Float2PassUniform","../shaderModules/interfaces"],function(a,b,n,k,p){function h(d){d.varyings.add("linearDepth","float")}function e(d){d.vertex.uniforms.add(new k.Float2PassUniform("nearFar",
(f,c)=>c.camera.nearFar))}function g(d){d.vertex.code.add(p.glsl`float calculateLinearDepth(vec2 nearFar,float z) {
return (-z - nearFar[0]) / (nearFar[1] - nearFar[0]);
}`)}a.ForwardLinearDepth=function(d,f){const {vertex:c}=d;switch(f.output){case b.ShaderOutput.Color:case b.ShaderOutput.ColorEmission:if(f.receiveShadows){h(d);c.code.add(p.glsl`void forwardLinearDepth() { linearDepth = gl_Position.w; }`);return}break;case b.ShaderOutput.Shadow:case b.ShaderOutput.ShadowHighlight:case b.ShaderOutput.ShadowExcludeHighlight:case b.ShaderOutput.ViewshedShadow:d.include(n.VertexPosition,f);h(d);e(d);g(d);c.code.add(p.glsl`void forwardLinearDepth() {
linearDepth = calculateLinearDepth(nearFar, vPosition_view.z);
}`);return}c.code.add(p.glsl`void forwardLinearDepth() {}`)};a.addCalculateLinearDepth=g;a.addLinearDepth=h;a.addNearFar=e;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/Offset.glsl":function(){define(["exports","../shaderModules/interfaces"],function(a,b){a.Offset=function(n){n.vertex.code.add(b.glsl`vec4 offsetBackfacingClipPosition(vec4 posClip, vec3 posWorld, vec3 normalWorld, vec3 camPosWorld) {
vec3 camToVert = posWorld - camPosWorld;
bool isBackface = dot(camToVert, normalWorld) > 0.0;
if (isBackface) {
posClip.z += 0.0000003 * posClip.w;
}
return posClip;
}`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/Transform.glsl":function(){define(["exports","./ForwardLinearDepth.glsl","../shaderModules/interfaces"],function(a,b,n){a.Transform=function(k){b.addCalculateLinearDepth(k);k.vertex.code.add(n.glsl`vec4 transformPositionWithDepth(mat4 proj, mat4 view, vec3 pos, vec2 nearFar, out float depth) {
vec4 eye = view * vec4(pos, 1.0);
depth = calculateLinearDepth(nearFar,eye.z);
return proj * eye;
}`);k.vertex.code.add(n.glsl`vec4 transformPosition(mat4 proj, mat4 view, vec3 pos) {
return proj * (view * vec4(pos, 1.0));
}`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/InstancedDoublePrecision.glsl":function(){define("exports ../../../../../../core/libs/gl-matrix-2/math/mat3 ../../../../../../core/libs/gl-matrix-2/factories/mat3f64 ../../../../../../core/libs/gl-matrix-2/factories/mat4f64 ../../../../../../chunks/vec32 ../../../../../../core/libs/gl-matrix-2/factories/vec3f64 ../ShaderOutput ../util/DoublePrecision.glsl ../util/View.glsl ../../shaderModules/Float3DrawUniform ../../shaderModules/interfaces ../../shaderModules/Matrix3PassUniform ../../shaderModules/Matrix4PassUniform ../../../lib/VertexAttribute ../../../../../webgl/doublePrecisionUtils".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w,x,u){class t extends c.NoParameters{constructor(){super(...arguments);this.modelTransformation=null}}const m=n.create(),q=h.create();a.InstancedDoublePassParameters=t;a.InstancedDoublePrecision=function(r,v){const y=v.hasModelTransformation,B=v.instancedDoublePrecision;y&&(r.vertex.uniforms.add(new w.Matrix4PassUniform("model",z=>z.modelTransformation??k.IDENTITY)),r.vertex.uniforms.add(new l.Matrix3PassUniform("normalLocalOriginFromModel",z=>{b.normalFromMat4(m,
z.modelTransformation??k.IDENTITY);return m})));v.instanced&&B&&(r.attributes.add(x.VertexAttribute.INSTANCEMODELORIGINHI,"vec3"),r.attributes.add(x.VertexAttribute.INSTANCEMODELORIGINLO,"vec3"),r.attributes.add(x.VertexAttribute.INSTANCEMODEL,"mat3"),r.attributes.add(x.VertexAttribute.INSTANCEMODELNORMAL,"mat3"));r=r.vertex;B&&(r.include(g.DoublePrecision,v),r.uniforms.add(new f.Float3DrawUniform("viewOriginHi",(z,A)=>u.encodeDoubleHi(p.set(q,A.camera.viewInverseTransposeMatrix[3],A.camera.viewInverseTransposeMatrix[7],
A.camera.viewInverseTransposeMatrix[11]),q)),new f.Float3DrawUniform("viewOriginLo",(z,A)=>u.encodeDoubleLo(p.set(q,A.camera.viewInverseTransposeMatrix[3],A.camera.viewInverseTransposeMatrix[7],A.camera.viewInverseTransposeMatrix[11]),q))));r.code.add(c.glsl`
    vec3 getVertexInLocalOriginSpace() {
      return ${y?B?"(model * vec4(instanceModel * localPosition().xyz, 1.0)).xyz":"(model * localPosition()).xyz":B?"instanceModel * localPosition().xyz":"localPosition().xyz"};
    }

    vec3 subtractOrigin(vec3 _pos) {
      ${B?c.glsl`
          // Negated inputs are intentionally the first two arguments. The other way around the obfuscation in dpAdd() stopped
          // working for macOS 14+ and iOS 17+.
          // Issue: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/56280
          vec3 originDelta = dpAdd(-instanceModelOriginHi, -instanceModelOriginLo, viewOriginHi, viewOriginLo);
          return _pos - originDelta;`:"return vpos;"}
    }
    `);r.code.add(c.glsl`
    vec3 dpNormal(vec4 _normal) {
      return normalize(${y?B?"normalLocalOriginFromModel * (instanceModelNormal * _normal.xyz)":"normalLocalOriginFromModel * _normal.xyz":B?"instanceModelNormal * _normal.xyz":"_normal.xyz"});
    }
    `);v.output===e.ShaderOutput.Normal&&(d.addViewNormal(r),r.code.add(c.glsl`
    vec3 dpNormalView(vec4 _normal) {
      return normalize((viewNormal * ${y?B?"vec4(normalLocalOriginFromModel * (instanceModelNormal * _normal.xyz), 1.0)":"vec4(normalLocalOriginFromModel * _normal.xyz, 1.0)":B?"vec4(instanceModelNormal * _normal.xyz, 1.0)":"_normal"}).xyz);
    }
    `));v.hasVertexTangents&&r.code.add(c.glsl`
    vec4 dpTransformVertexTangent(vec4 _tangent) {
      ${y?B?"return vec4(normalLocalOriginFromModel * (instanceModelNormal * _tangent.xyz), _tangent.w);":"return vec4(normalLocalOriginFromModel * _tangent.xyz, _tangent.w);":B?"return vec4(instanceModelNormal * _tangent.xyz, _tangent.w);":"return _tangent;"}
    }`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/doublePrecisionUtils":function(){define(["exports"],function(a){const b=new Float32Array(2);a.decodeDoubleArray=function(n,k,p){for(let h=0;h<p;++h)k[h]=n[2*h]+n[2*h+1]};a.encodeDoubleArray=function(n,k,p){for(let h=0;h<p;++h)k[2*h]=n[h],k[2*h+1]=n[h]-k[2*h]};a.encodeDoubleHi=function(n,k){const p=n.length;for(let h=0;h<p;++h)b[0]=n[h],k[h]=b[0];return k};a.encodeDoubleLo=function(n,k){const p=n.length;for(let h=
0;h<p;++h)b[0]=n[h],b[1]=n[h]-b[0],k[h]=b[1];return k};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/SymbolColor.glsl":function(){define("exports ../../../collections/Component/Material/shader/DecodeSymbolColor.glsl ../../shaderModules/IntegerPassUniform ../../shaderModules/interfaces ../../../lib/VertexAttribute ../../../materials/internal/MaterialUtil".split(" "),function(a,b,n,k,p,h){a.SymbolColor=function(e,g){g.hasSymbolColors?
(e.include(b.DecodeSymbolColor),e.attributes.add(p.VertexAttribute.SYMBOLCOLOR,"vec4"),e.varyings.add("colorMixMode","mediump float"),e.vertex.code.add(k.glsl`int symbolColorMixMode;
vec4 getSymbolColor() {
return decodeSymbolColor(symbolColor, symbolColorMixMode) * 0.003921568627451;
}
void forwardColorMixMode() {
colorMixMode = float(symbolColorMixMode) + 0.5;
}`)):(e.fragment.uniforms.add(new n.IntegerPassUniform("colorMixMode",d=>h.colorMixModes[d.colorMixMode])),e.vertex.code.add(k.glsl`vec4 getSymbolColor() { return vec4(1.0); }
void forwardColorMixMode() {}`))};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/VertexColor.glsl":function(){define(["exports","../../shaderModules/interfaces","../../../lib/VertexAttribute"],function(a,b,n){a.VertexColor=function(k,p){p.hasVertexColors?(k.attributes.add(n.VertexAttribute.COLOR,"vec4"),k.varyings.add("vColor","vec4"),k.vertex.code.add(b.glsl`void forwardVertexColor() { vColor = color; }`),k.vertex.code.add(b.glsl`void forwardNormalizedVertexColor() { vColor = color * 0.003921568627451; }`)):
k.vertex.code.add(b.glsl`void forwardVertexColor() {}
void forwardNormalizedVertexColor() {}`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/default/DefaultMaterialAuxiliaryPasses.glsl":function(){define("exports ../ForwardLinearDepth.glsl ../ShaderOutput ../Slice.glsl ../Transform.glsl ../attributes/NormalAttribute.glsl ../attributes/ObjectAndLayerIdColor.glsl ../attributes/TextureCoordinateAttribute.glsl ../attributes/VertexNormal.glsl ../output/OutputDepth.glsl ../output/OutputHighlight.glsl ../shading/VisualVariables.glsl ../util/DiscardOrAdjustAlpha.glsl ../util/View.glsl ../../shaderModules/interfaces ../../shaderModules/Texture2DPassUniform ../../../lib/basicInterfaces".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w,x,u,t,m){a.DefaultMaterialAuxiliaryPasses=function(q,r){const {vertex:v,fragment:y}=q,B=r.hasColorTexture&&r.alphaDiscardMode!==m.AlphaDiscardMode.Opaque,{output:z,normalType:A,hasColorTextureTransform:C}=r;switch(z){case n.ShaderOutput.Depth:x.addProjViewLocalOrigin(v,r);q.include(p.Transform,r);q.include(k.SliceDraw,r);q.include(g.TextureCoordinateAttribute,r);B&&y.uniforms.add(new t.Texture2DPassUniform("tex",H=>H.texture));v.main.add(u.glsl`vpos = getVertexInLocalOriginSpace();
vpos = subtractOrigin(vpos);
vpos = addVerticalOffset(vpos, localOrigin);
gl_Position = transformPosition(proj, view, vpos);
forwardTextureCoordinates();`);q.include(w.DiscardOrAdjustAlphaPass,r);y.main.add(u.glsl`
          discardBySlice(vpos);
          ${u.If(B,u.glsl`vec4 texColor = texture(tex, ${C?"colorUV":"vuv0"});
                 discardOrAdjustAlpha(texColor);`)}`);break;case n.ShaderOutput.Shadow:case n.ShaderOutput.ShadowHighlight:case n.ShaderOutput.ShadowExcludeHighlight:case n.ShaderOutput.ViewshedShadow:case n.ShaderOutput.ObjectAndLayerIdColor:x.addProjViewLocalOrigin(v,r);q.include(p.Transform,r);q.include(g.TextureCoordinateAttribute,r);q.include(l.VisualVariables,r);q.include(f.OutputDepth,r);q.include(k.SliceDraw,r);q.include(e.ObjectAndLayerIdColor,r);b.addNearFar(q);q.varyings.add("depth","float");
B&&y.uniforms.add(new t.Texture2DPassUniform("tex",H=>H.texture));v.main.add(u.glsl`vpos = getVertexInLocalOriginSpace();
vpos = subtractOrigin(vpos);
vpos = addVerticalOffset(vpos, localOrigin);
gl_Position = transformPositionWithDepth(proj, view, vpos, nearFar, depth);
forwardTextureCoordinates();
forwardObjectAndLayerIdColor();`);q.include(w.DiscardOrAdjustAlphaPass,r);y.main.add(u.glsl`
          discardBySlice(vpos);
          ${u.If(B,u.glsl`vec4 texColor = texture(tex, ${C?"colorUV":"vuv0"});
                 discardOrAdjustAlpha(texColor);`)}
          ${z===n.ShaderOutput.ObjectAndLayerIdColor?u.glsl`outputObjectAndLayerIdColor();`:u.glsl`outputDepth(depth);`}`);break;case n.ShaderOutput.Normal:x.addProjViewLocalOrigin(v,r);q.include(p.Transform,r);q.include(h.NormalAttribute,r);q.include(d.VertexNormal,r);q.include(g.TextureCoordinateAttribute,r);q.include(l.VisualVariables,r);B&&y.uniforms.add(new t.Texture2DPassUniform("tex",H=>H.texture));A===h.NormalType.ScreenDerivative&&q.varyings.add("vPositionView","vec3");v.main.add(u.glsl`
          vpos = getVertexInLocalOriginSpace();
          ${A===h.NormalType.Attribute||A===h.NormalType.Compressed?u.glsl`vNormalWorld = dpNormalView(vvLocalNormal(normalModel()));`:u.glsl`vPositionView = (view * vec4(vpos, 1.0)).xyz;`}
          vpos = subtractOrigin(vpos);
          vpos = addVerticalOffset(vpos, localOrigin);
          gl_Position = transformPosition(proj, view, vpos);
          forwardTextureCoordinates();`);q.include(k.SliceDraw,r);q.include(w.DiscardOrAdjustAlphaPass,r);y.main.add(u.glsl`
          discardBySlice(vpos);
          ${u.If(B,u.glsl`vec4 texColor = texture(tex, ${C?"colorUV":"vuv0"});
                 discardOrAdjustAlpha(texColor);`)}

          ${A===h.NormalType.ScreenDerivative?u.glsl`vec3 normal = screenDerivativeNormal(vPositionView);`:u.glsl`vec3 normal = normalize(vNormalWorld);
                     if (gl_FrontFacing == false){
                       normal = -normal;
                     }`}
          fragColor = vec4(0.5 + 0.5 * normal, 1.0);`);break;case n.ShaderOutput.Highlight:x.addProjViewLocalOrigin(v,r),q.include(p.Transform,r),q.include(g.TextureCoordinateAttribute,r),q.include(l.VisualVariables,r),B&&y.uniforms.add(new t.Texture2DPassUniform("tex",H=>H.texture)),v.main.add(u.glsl`vpos = getVertexInLocalOriginSpace();
vpos = subtractOrigin(vpos);
vpos = addVerticalOffset(vpos, localOrigin);
gl_Position = transformPosition(proj, view, vpos);
forwardTextureCoordinates();`),q.include(k.SliceDraw,r),q.include(w.DiscardOrAdjustAlphaPass,r),q.include(c.OutputHighlight,r),y.main.add(u.glsl`
          discardBySlice(vpos);
          ${u.If(B,u.glsl`vec4 texColor = texture(tex, ${C?"colorUV":"vuv0"});
                 discardOrAdjustAlpha(texColor);`)}
          calculateOcclusionAndOutputHighlight();`)}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/output/OutputDepth.glsl":function(){define(["exports","../ShaderOutput","../util/RgbaFloat16Encoding.glsl","../../shaderModules/interfaces"],function(a,b,n,k){a.OutputDepth=function(p,h){switch(h.output){case b.ShaderOutput.Shadow:case b.ShaderOutput.ShadowHighlight:case b.ShaderOutput.ShadowExcludeHighlight:case b.ShaderOutput.ViewshedShadow:p.fragment.include(n.Rgba4FloatEncoding),
p.fragment.code.add(k.glsl`float _calculateFragDepth(const in float depth) {
const float SLOPE_SCALE = 2.0;
const float BIAS = 20.0 * .000015259;
float m = max(abs(dFdx(depth)), abs(dFdy(depth)));
return depth + SLOPE_SCALE * m + BIAS;
}
void outputDepth(float _linearDepth) {
fragColor = floatToRgba4(_calculateFragDepth(_linearDepth));
}`)}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/RgbaFloat16Encoding.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,b){a.Rgba4FloatEncoding=function(n){n.code.add(b.glsl`const float MAX_RGBA4_FLOAT =
15.0 / 16.0 +
15.0 / 16.0 / 16.0 +
15.0 / 16.0 / 16.0 / 16.0 +
15.0 / 16.0 / 16.0 / 16.0 / 16.0;
const vec4 FIXED_POINT_FACTORS_RGBA4 = vec4(1.0, 16.0, 16.0 * 16.0, 16.0 * 16.0 * 16.0);
vec4 floatToRgba4(const float value) {
float valueInValidDomain = clamp(value, 0.0, MAX_RGBA4_FLOAT);
vec4 fixedPointU4 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS_RGBA4) * 16.0);
const float toU4AsFloat = 1.0 / 15.0;
return fixedPointU4 * toU4AsFloat;
}
const vec4 RGBA4_2_FLOAT_FACTORS = vec4(
15.0 / (16.0),
15.0 / (16.0 * 16.0),
15.0 / (16.0 * 16.0 * 16.0),
15.0 / (16.0 * 16.0 * 16.0 * 16.0)
);
float rgba4ToFloat(vec4 rgba) {
return dot(rgba, RGBA4_2_FLOAT_FACTORS);
}`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/DiscardOrAdjustAlpha.glsl":function(){define("exports ./AlphaCutoff ../../shaderModules/FloatDrawUniform ../../shaderModules/FloatPassUniform ../../shaderModules/interfaces ../../../lib/basicInterfaces".split(" "),function(a,b,n,k,p,h){function e(g,d,f){const c=g.fragment;switch(d.alphaDiscardMode){case h.AlphaDiscardMode.Blend:g.fragment.code.add(p.glsl`
        #define discardOrAdjustAlpha(color) { if (color.a < ${p.glsl.float(b.alphaCutoff)}) { discard; } }
      `);break;case h.AlphaDiscardMode.Opaque:c.code.add(p.glsl`void discardOrAdjustAlpha(inout vec4 color) {
color.a = 1.0;
}`);break;case h.AlphaDiscardMode.Mask:c.uniforms.add(f).code.add(p.glsl`#define discardOrAdjustAlpha(color) { if (color.a < textureAlphaCutoff) { discard; } else { color.a = 1.0; } }`);break;case h.AlphaDiscardMode.MaskBlend:c.uniforms.add(f).code.add(p.glsl`#define discardOrAdjustAlpha(color) { if (color.a < textureAlphaCutoff) { discard; } }`)}}a.DiscardOrAdjustAlphaDraw=function(g,d){e(g,d,new n.FloatDrawUniform("textureAlphaCutoff",f=>f.textureAlphaCutoff))};a.DiscardOrAdjustAlphaPass=function(g,
d){e(g,d,new k.FloatPassUniform("textureAlphaCutoff",f=>f.textureAlphaCutoff))};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/FloatDrawUniform":function(){define(["exports","./Uniform","../shaderTechnique/BindType"],function(a,b,n){class k extends b.Uniform{constructor(p,h){super(p,"float",n.BindType.Draw,(e,g,d)=>e.setUniform1f(p,h(g,d)))}}a.FloatDrawUniform=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/ComputeNormalTexture.glsl":function(){define("exports ../../../../../../core/libs/gl-matrix-2/factories/mat3f64 ../../../../../../core/libs/gl-matrix-2/factories/vec2f64 ../attributes/TextureCoordinateAttribute.glsl ../attributes/VertexTextureCoordinates.glsl ./Normals.glsl ../../shaderModules/Float2PassUniform ../../shaderModules/interfaces ../../shaderModules/Matrix3PassUniform ../../shaderModules/Texture2DDrawUniform ../../shaderModules/Texture2DPassUniform ../../shaderTechnique/BindType ../../../lib/VertexAttribute".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w){a.ComputeNormalTexture=function(x,u){const t=x.fragment;u.hasVertexTangents?(x.attributes.add(w.VertexAttribute.TANGENT,"vec4"),x.varyings.add("vTangent","vec4"),u.doubleSidedMode===h.NormalsDoubleSidedMode.WindingOrder?t.code.add(g.glsl`mat3 computeTangentSpace(vec3 normal) {
float tangentHeadedness = gl_FrontFacing ? vTangent.w : -vTangent.w;
vec3 tangent = normalize(gl_FrontFacing ? vTangent.xyz : -vTangent.xyz);
vec3 bitangent = cross(normal, tangent) * tangentHeadedness;
return mat3(tangent, bitangent, normal);
}`):t.code.add(g.glsl`mat3 computeTangentSpace(vec3 normal) {
float tangentHeadedness = vTangent.w;
vec3 tangent = normalize(vTangent.xyz);
vec3 bitangent = cross(normal, tangent) * tangentHeadedness;
return mat3(tangent, bitangent, normal);
}`)):t.code.add(g.glsl`mat3 computeTangentSpace(vec3 normal, vec3 pos, vec2 st) {
vec3 Q1 = dFdx(pos);
vec3 Q2 = dFdy(pos);
vec2 stx = dFdx(st);
vec2 sty = dFdy(st);
float det = stx.t * sty.s - sty.t * stx.s;
vec3 T = stx.t * Q2 - sty.t * Q1;
T = T - normal * dot(normal, T);
T *= inversesqrt(max(dot(T,T), 1.e-10));
vec3 B = sign(det) * cross(normal, T);
return mat3(T, B, normal);
}`);u.textureCoordinateType!==k.TextureCoordinateType.None&&(x.include(p.VertexTextureCoordinates,u),t.uniforms.add(u.bindType===l.BindType.Pass?new c.Texture2DPassUniform("normalTexture",m=>m.textureNormal):new f.Texture2DDrawUniform("normalTexture",m=>m.textureNormal)),u.hasNormalTextureTransform&&(t.uniforms.add(new e.Float2PassUniform("scale",m=>m.scale??n.ONES)),t.uniforms.add(new d.Matrix3PassUniform("normalTextureTransformMatrix",m=>m.normalTextureTransformMatrix??b.IDENTITY))),t.code.add(g.glsl`vec3 computeTextureNormal(mat3 tangentSpace, vec2 uv) {
vec3 rawNormal = textureLookup(normalTexture, uv).rgb * 2.0 - 1.0;`),u.hasNormalTextureTransform&&t.code.add(g.glsl`mat3 normalTextureRotation = mat3(normalTextureTransformMatrix[0][0]/scale[0], normalTextureTransformMatrix[0][1]/scale[1], 0.0,
normalTextureTransformMatrix[1][0]/scale[0], normalTextureTransformMatrix[1][1]/scale[1], 0.0,
0.0, 0.0, 0.0 );
rawNormal.xy = (normalTextureRotation * vec3(rawNormal.x, rawNormal.y, 1.0)).xy;`),t.code.add(g.glsl`return tangentSpace * rawNormal;
}`))};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateAmbientOcclusion.glsl":function(){define(["exports","../../shaderModules/interfaces","../../shaderModules/Texture2DPassUniform","../../../effects/ssao/SSAO"],function(a,b,n,k){a.EvaluateAmbientOcclusion=function(p,h){p=p.fragment;h.receiveAmbientOcclusion?(p.uniforms.add(new n.Texture2DPassUniform("ssaoTex",(e,g)=>g.ssao?.getTexture())),p.constants.add("blurSizePixelsInverse",
"float",1/k.blurSizePixels),p.code.add(b.glsl`float evaluateAmbientOcclusionInverse() {
vec2 ssaoTextureSizeInverse = 1.0 / vec2(textureSize(ssaoTex, 0));
return texture(ssaoTex, gl_FragCoord.xy * blurSizePixelsInverse * ssaoTextureSizeInverse).r;
}
float evaluateAmbientOcclusion() {
return 1.0 - evaluateAmbientOcclusionInverse();
}`)):p.code.add(b.glsl`float evaluateAmbientOcclusionInverse() { return 1.0; }
float evaluateAmbientOcclusion() { return 0.0; }`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/effects/ssao/SSAO":function(){define("exports ../../../../../chunks/tslib.es6 ../../../../../core/mathUtils ../../../../../core/maybe ../../../../../core/reactiveUtils ../../../../../core/time ../../../../../core/accessorSupport/decorators/property ../../../../../core/has ../../../../../core/Logger ../../../../../core/RandomLCG ../../../../../core/accessorSupport/decorators/subclass ../../../../../core/libs/gl-matrix-2/math/vec2 ../../../webgl ../../../webgl/formats ../../../webgl/RenderNode ../../core/shaderLibrary/shading/ScreenSpaceConstants ./SSAOBlurTechnique ./SSAONoiseData ./SSAOParameters ./SSAOTechnique ../../lib/basicInterfaces ../../../../../chunks/SSAO.glsl ../../../../webgl/enums ../../../../webgl/Texture ../../../../webgl/TextureDescriptor".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w,x,u,t,m,q,r,v,y,B,z,A,C){a.SSAO=class extends u{constructor(H){super(H);this.consumes={required:["normals"]};this.produces=w.InternalRenderCategory.SSAO;this.isEnabled=()=>!1;this._enableTime=h.Milliseconds(0);this._passParameters=new r.SSAOPassParameters;this._drawParameters=new r.BlurDrawParameters}initialize(){const H=Uint8Array.from(atob(q.noiseData),F=>F.charCodeAt(0)),E=new C.TextureDescriptor;E.wrapMode=z.TextureWrapMode.CLAMP_TO_EDGE;E.pixelFormat=z.PixelFormat.RGB;
E.wrapMode=z.TextureWrapMode.REPEAT;E.hasMipmap=!0;E.width=32;E.height=32;this._passParameters.noiseTexture=new A.Texture(this.renderingContext,E,H);this.techniques.precompile(v.SSAOTechnique);this.techniques.precompile(m.SSAOBlurTechnique);this.addHandles(p.watch(()=>this.isEnabled(),()=>this._enableTime=h.Milliseconds(0)))}destroy(){this._passParameters.noiseTexture=k.disposeMaybe(this._passParameters.noiseTexture)}render(H){const E=this.bindParameters;H=H.find(({name:R})=>"normals"===R);var F=
H?.getTexture();const G=H?.getTexture(z.DepthStencilAttachment);var D=this.fboCache;H=E.camera;const I=H.fullViewport[2],J=H.fullViewport[3],N=Math.round(I/2),M=Math.round(J/2);var Q=this.techniques.acquire(v.SSAOTechnique);const O=this.techniques.acquire(m.SSAOBlurTechnique);if(!Q.compiled||!O.compiled)return this._enableTime=h.Milliseconds(performance.now()),this.requestRender(y.RenderRequestType.UPDATE),Q.release(),O.release(),D.acquire(N,M,w.InternalRenderCategory.SSAO,x.ColorFormat.RED);0===
this._enableTime&&(this._enableTime=h.Milliseconds(performance.now()));const K=this.renderingContext;var L=this.view.qualitySettings.fadeDuration,P=n.clamp((t.distanceFadeEnd-H.relativeElevation)/(t.distanceFadeEnd-t.distanceFadeStart),0,1);L=0<L?Math.min(L,performance.now()-this._enableTime)/L:1;P*=L;this._passParameters.normalTexture=F;this._passParameters.depthTexture=G;this._passParameters.projScale=1/H.computeScreenPixelSizeAtDist(1);this._passParameters.intensity=2/B.getRadius(H)**6*P;F=D.acquire(I,
J,"ssao input",x.ColorFormat.RG);K.bindFramebuffer(F.fbo);K.setViewport(0,0,I,J);K.bindTechnique(Q,E,this._passParameters,this._drawParameters);K.screen.draw();Q.release();Q=D.acquire(N,M,"ssao blur",x.ColorFormat.RED);K.bindFramebuffer(Q.fbo);this._drawParameters.colorTexture=F.getTexture();l.set(this._drawParameters.blurSize,0,2/J);K.bindTechnique(O,E,this._passParameters,this._drawParameters);K.setViewport(0,0,N,M);K.screen.draw();F.release();D=D.acquire(N,M,w.InternalRenderCategory.SSAO,x.ColorFormat.RED);
K.bindFramebuffer(D.fbo);K.setViewport(0,0,I,J);K.setClearColor(1,1,1,0);K.clear(z.FramebufferBit.COLOR);this._drawParameters.colorTexture=Q.getTexture();l.set(this._drawParameters.blurSize,2/I,0);K.bindTechnique(O,E,this._passParameters,this._drawParameters);K.setViewport(0,0,N,M);K.screen.draw();O.release();K.setViewport4fv(H.fullViewport);Q.release();1>L&&this.requestRender(y.RenderRequestType.UPDATE);return D}};b.__decorate([e.property()],a.SSAO.prototype,"consumes",void 0);b.__decorate([e.property()],
a.SSAO.prototype,"produces",void 0);b.__decorate([e.property({constructOnly:!0})],a.SSAO.prototype,"techniques",void 0);b.__decorate([e.property({constructOnly:!0})],a.SSAO.prototype,"isEnabled",void 0);a.SSAO=b.__decorate([c.subclass("esri.views.3d.webgl-engine.effects.ssao.SSAO")],a.SSAO);a.blurSizePixels=2;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl/formats":function(){define(["exports"],function(a){a.ColorFormat=void 0;(function(b){b[b.RED=0]="RED";b[b.RG=
1]="RG";b[b.RGBA4=2]="RGBA4";b[b.RGBA=3]="RGBA";b[b.RGBA_MIPMAP=4]="RGBA_MIPMAP";b[b.R16F=5]="R16F";b[b.RGBA16F=6]="RGBA16F"})(a.ColorFormat||(a.ColorFormat={}));a.DepthFormat=void 0;(function(b){b[b.DEPTH_STENCIL_TEXTURE=0]="DEPTH_STENCIL_TEXTURE";b[b.DEPTH16_BUFFER=1]="DEPTH16_BUFFER"})(a.DepthFormat||(a.DepthFormat={}));Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/ScreenSpaceConstants":function(){define(["exports"],function(a){a.distanceFadeEnd=
5E5;a.distanceFadeStart=3E5;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/effects/ssao/SSAOBlurTechnique":function(){define("require exports ../../core/shaderTechnique/ReloadableShaderModule ../../core/shaderTechnique/ShaderTechnique ../../../../../chunks/SSAOBlur.glsl ../../../../webgl/renderState".split(" "),function(a,b,n,k,p,h){class e extends k.ShaderTechnique{constructor(g,d,f){super(g,d,new n.ReloadableShaderModule(p.SSAOBlur,()=>new Promise((c,
l)=>a(["../../shaders/SSAOBlur.glsl"],c,l))),f)}initializePipeline(){return h.makePipelineState({colorWrite:h.defaultColorWrite})}}b.SSAOBlurTechnique=e;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/SSAOBlur.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/ReadDepth.glsl ../views/3d/webgl-engine/core/shaderModules/Float2DrawUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DDrawUniform ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform".split(" "),
function(a,b,n,k,p,h,e,g,d){function f(){const l=new e.ShaderBuilder,w=l.fragment;l.include(b.ScreenSpacePass);w.include(n.ReadDepth);w.uniforms.add(new d.Texture2DPassUniform("depthMap",x=>x.depthTexture),new g.Texture2DDrawUniform("tex",x=>x.colorTexture),new k.Float2DrawUniform("blurSize",x=>x.blurSize),new p.FloatPassUniform("projScale",(x,u)=>{u=u.camera.distance;return 5E4<u?Math.max(0,x.projScale-(u-5E4)):x.projScale}));w.code.add(h.glsl`
    void blurFunction(vec2 uv, float r, float center_d, float sharpness, inout float wTotal, inout float bTotal) {
      float c = texture(tex, uv).r;
      float d = linearDepthFromTexture(depthMap, uv);

      float ddiff = d - center_d;

      float w = exp(-r * r * ${h.glsl.float(.08)} - ddiff * ddiff * sharpness);
      wTotal += w;
      bTotal += w * c;
    }
  `);l.outputs.add("fragBlur","float");w.main.add(h.glsl`
    float b = 0.0;
    float w_total = 0.0;

    float center_d = linearDepthFromTexture(depthMap, uv);

    float sharpness = -0.05 * projScale / center_d;
    for (int r = -${h.glsl.int(4)}; r <= ${h.glsl.int(4)}; ++r) {
      float rf = float(r);
      vec2 uvOffset = uv + rf * blurSize;
      blurFunction(uvOffset, rf, center_d, sharpness, w_total, b);
    }
    fragBlur = b / w_total;`);return l}const c=Object.freeze(Object.defineProperty({__proto__:null,build:f},Symbol.toStringTag,{value:"Module"}));a.SSAOBlur=c;a.build=f})},"esri/views/3d/webgl-engine/core/shaderModules/Float2DrawUniform":function(){define(["exports","./Uniform","../shaderTechnique/BindType"],function(a,b,n){class k extends b.Uniform{constructor(p,h){super(p,"vec2",n.BindType.Draw,(e,g,d,f)=>e.setUniform2fv(p,h(g,d,f)))}}a.Float2DrawUniform=k;Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/views/3d/webgl-engine/effects/ssao/SSAONoiseData":function(){define(["exports"],function(a){a.noiseData="eXKEvZaUc66cjIKElE1jlJ6MjJ6Ufkl+jn2fcXp5jBx7c6KEflSGiXuXeW6OWs+tfqZ2Yot2Y7Zzfo2BhniEj3xoiXuXj4eGZpqEaHKDWjSMe7palFlzc3BziYOGlFVzg6Zzg7CUY5JrjFF7eYJ4jIKEcyyEonSXe7qUfqZ7j3xofqZ2c4R5lFZ5Y0WUbppoe1l2cIh2ezyUho+BcHN2cG6DbpqJhqp2e1GcezhrdldzjFGUcyxjc3aRjDyEc1h7Sl17c6aMjH92pb6Mjpd4dnqBjMOEhqZleIOBYzB7gYx+fnqGjJuEkWlwnCx7fGl+c4hjfGyRe5qMlNOMfnqGhIWHc6OMi4GDc6aMfqZuc6aMzqJzlKZ+lJ6Me3qRfoFue0WUhoR5UraEa6qMkXiPjMOMlJOGe7JrUqKMjK6MeYRzdod+Sl17boiPc6qEeYBlcIh2c1WEe7GDiWCDa0WMjEmMdod+Y0WcdntzhmN8WjyMjKJjiXtzgYxYaGd+a89zlEV7e2GJfnd+lF1rcK5zc4p5cHuBhL6EcXp5eYB7fnh8iX6HjIKEeaxuiYOGc66RfG2Ja5hzjlGMjEmMe9OEgXuPfHyGhPeEdl6JY02McGuMfnqGhFiMa3WJfnx2l4hwcG1uhmN8c0WMc39og1GBbrCEjE2EZY+JcIh2cIuGhIWHe0mEhIVrc09+gY5+eYBlnCyMhGCDl3drfmmMgX15aGd+gYx+fnuRfnhzY1SMsluJfnd+hm98WtNrcIuGh4SEj0qPdkqOjFF7jNNjdnqBgaqUjMt7boeBhnZ4jDR7c5pze4GGjEFrhLqMjHyMc0mUhKZze4WEa117kWlwbpqJjHZ2eX2Bc09zeId+e0V7WlF7jHJ2l72BfId8l3eBgXyBe897jGl7c66cgW+Xc76EjKNbgaSEjGx4fId8jFFjgZB8cG6DhlFziZhrcIh2fH6HgUqBgXiPY8dahGFzjEmMhEFre2dxhoBzc5SGfleGe6alc7aUeYBlhKqUdlp+cH5za4OEczxza0Gcc4J2jHZ5iXuXjH2Jh5yRjH2JcFx+hImBjH+MpddCl3dreZeJjIt8ZW18bm1zjoSEeIOBlF9oh3N7hlqBY4+UeYFwhLJjeYFwaGd+gUqBYxiEYot2fqZ2ondzhL6EYyiEY02Ea0VjgZB8doaGjHxoc66cjEGEiXuXiXWMiZhreHx8frGMe75rY02Ec5pzfnhzlEp4a3VzjM+EhFFza3mUY7Zza1V5e2iMfGyRcziEhDyEkXZ2Y4OBnCx7g5t2eyBjgV6EhEFrcIh2dod+c4Z+nJ5zjm15jEmUeYxijJp7nL6clIpjhoR5WrZraGd+fnuRa6pzlIiMg6ZzfHx5foh+eX1ufnB5eX1ufnB5aJt7UqKMjIh+e3aBfm5lbYSBhGFze6J4c39oc0mUc4Z+e0V7fKFVe0WEdoaGY02Ec4Z+Y02EZYWBfH6HgU1+gY5+hIWUgW+XjJ57ebWRhFVScHuBfJ6PhBx7WqJzlM+Ujpd4gHZziX6HjHmEgZN+lJt5boiPe2GJgX+GjIGJgHZzeaxufnB5hF2JtdN7jJ57hp57hK6ElFVzg6ZzbmiEbndzhIWHe3uJfoFue3qRhJd2j3xoc65zlE1jc3p8lE1jhniEgXJ7e657vZaUc3qBh52BhIF4aHKDa9drgY5+c52GWqZzbpqJe8tjnM+UhIeMfo2BfGl+hG1zSmmMjKJjZVaGgX15c1lze0mEp4OHa3mUhIWHhDyclJ6MeYOJkXiPc0VzhFiMlKaEboSJa5Jze41re3qRhn+HZYWBe0mEc4p5fnORbox5lEp4hGFjhGGEjJuEc1WEhLZjeHeGa7KlfHx2hLaMeX1ugY5+hIWHhKGPjMN7c1WEho1zhoBzZYx7fnhzlJt5exyUhFFziXtzfmmMa6qMYyiEiXxweV12kZSMeWqXSl17fnhzxmmMrVGEe1mcc4p5eHeGjK6MgY5+doaGa6pzlGV7g1qBh4KHkXiPeW6OaKqafqZ2eXZ5e1V7jGd7boSJc3BzhJd2e0mcYot2h1RoY8dahK6EQmWEWjx7e1l2lL6UgXyBdnR4eU9zc0VreX1umqaBhld7fo2Bc6KEc5Z+hDyEcIeBWtNrfHyGe5qMhMuMe5qMhEGEbVVupcNzg3aHhIF4boeBe0mEdlptc39ofFl5Y8uUlJOGiYt2UmGEcyxjjGx4jFF7a657ZYWBnElzhp57iXtrgZN+tfOEhIOBjE2HgU1+e8tjjKNbiWCDhE15gUqBgYN7fnqGc66ce9d7iYSBj0qPcG6DnGGcT3eGa6qMZY+JlIiMl4hwc3aRdnqBlGV7eHJ2hLZjfnuRhDyEeX6MSk17g6Z+c6aUjHmEhIF4gXyBc76EZW18fGl+fkl+jCxrhoVwhDyUhIqGlL2DlI6EhJd2tdN7eYORhEGMa2Faa6pzc3Bzc4R5lIRznM+UY9eMhDycc5Z+c4p5c4iGY117pb6MgXuPrbJafnx2eYOJeXZ5e657hDyEcziElKZjfoB5eHeGj4WRhGGEe6KGeX1utTStc76EhFGJnCyMa5hzfH6HnNeceYB7hmN8gYuMhIVrczSMgYF8h3N7c5pza5hzjJqEYIRdgYuMlL2DeYRzhGGEeX1uhLaEc4iGeZ1zdl6JhrVteX6Me2iMfm5lWqJzSpqEa6pzdnmchHx2c6OMhNdrhoR5g3aHczxzeW52gV6Ejm15frGMc0Vzc4Z+l3drfniJe+9rWq5rlF1rhGGEhoVwe9OEfoh+e7pac09+c3qBY0lrhDycdnp2lJ6MiYOGhGCDc3aRlL2DlJt5doaGdnp2gYF8gWeOjF2Uc4R5c5Z+jEmMe7KEc4mEeYJ4dmyBe0mcgXiPbqJ7eYB7fmGGiYSJjICGlF1reZ2PnElzbpqJfH6Hc39oe4WEc5eJhK6EhqyJc3qBgZB8c09+hEmEaHKDhFGJc5SGiXWMUpaEa89zc6OMnCyMiXtrho+Be5qMc7KEjJ57dmN+hKGPjICGbmiEe7prdod+hGCDdnmchBx7eX6MkXZ2hGGEa657hm98jFFjY5JreYOJgY2EjHZ2a295Y3FajJ6Mc1J+YzB7e4WBjF2Uc4R5eV12gYxzg1qBeId+c9OUc5pzjFFjgY5+hFiMlIaPhoR5lIpjjIKBlNdSe7KEeX2BfrGMhIqGc65zjE2UhK6EklZ+QmWEeziMWqZza3VzdnR4foh+gYF8n3iJiZhrnKp7gYF8eId+lJ6Me1lrcIuGjKJjhmN8c66MjFF7a6prjJ6UnJ5zezyUfruRWlF7nI5zfHyGe657h4SEe8tjhBx7jFFjc09+c39ojICMeZeJeXt+YzRzjHZ2c0WEcIeBeXZ5onSXkVR+gYJ+eYFwdldzgYF7eX2BjJ6UiXuXlE1jh4SEe1mchLJjc4Z+hqZ7eXZ5bm1zlL6Ue5p7iWeGhKqUY5pzjKJjcIeBe8t7gXyBYIRdlEp4a3mGnK6EfmmMZpqEfFl5gYxzjKZuhGFjhoKGhHx2fnx2eXuMe3aBiWeGvbKMe6KGa5hzYzB7gZOBlGV7hmN8hqZlYot2Y117a6pzc6KEfId8foB5rctrfneJfJ6PcHN2hFiMc5pzjH92c0VzgY2EcElzdmCBlFVzg1GBc65zY4OBboeBcHiBeYJ4ewxzfHx5lIRzlEmEnLKEbk1zfJ6PhmN8eYBljBiEnMOEiXxwezyUcIeBe76EdsKEeX2BdnR4jGWUrXWMjGd7fkl+j4WRlEGMa5Jzho+BhDyEfnqMeXt+g3aHlE1jczClhNN7ZW18eHx8hGFjZW18iXWMjKJjhH57gYuMcIuGWjyMe4ZtjJuExmmMj4WRdntzi4GDhFFzYIRdnGGcjJp7Y0F7e4WEkbCGiX57fnSHa657a6prhBCMe3Z+SmmMjH92eHJ2hK6EY1FzexhrvbKMnI5za4OEfnd+eXuMhImBe897hLaMjN+EfG+BeIOBhF1+eZeJi4GDkXZ2eXKEgZ6Ejpd4c2GHa1V5e5KUfqZuhCx7jKp7lLZrg11+hHx2hFWUoot2nI5zgbh5mo9zvZaUe3qRbqKMfqZ2kbCGhFiM";
Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/effects/ssao/SSAOParameters":function(){define(["exports","../../../../../core/libs/gl-matrix-2/factories/vec2f64","../../core/shaderModules/interfaces"],function(a,b,n){class k extends n.NoParameters{constructor(){super(...arguments);this.projScale=1}}class p extends k{constructor(){super(...arguments);this.intensity=1}}class h extends n.NoParameters{}class e extends h{constructor(){super(...arguments);this.blurSize=
b.create()}}a.BlurDrawParameters=e;a.BlurPassParameters=k;a.SSAODrawParameters=h;a.SSAOPassParameters=p;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/effects/ssao/SSAOTechnique":function(){define("require exports ../../core/shaderTechnique/ReloadableShaderModule ../../core/shaderTechnique/ShaderTechnique ../../../../../chunks/SSAO.glsl ../../../../webgl/renderState".split(" "),function(a,b,n,k,p,h){class e extends k.ShaderTechnique{constructor(g,d,f){super(g,
d,new n.ReloadableShaderModule(p.SSAO,()=>new Promise((c,l)=>a(["../../shaders/SSAO.glsl"],c,l))),f)}initializePipeline(){return h.makePipelineState({colorWrite:h.defaultColorWrite})}}b.SSAOTechnique=e;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/SSAO.glsl":function(){define("exports ../core/libs/gl-matrix-2/math/vec2 ../core/libs/gl-matrix-2/factories/vec2f64 ../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/ReadDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/CameraSpace.glsl ../views/3d/webgl-engine/core/shaderModules/Float2PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c){function l(){const u=new f.ShaderBuilder,t=u.fragment;u.include(k.ScreenSpacePass);u.include(h.CameraSpace);t.include(p.ReadDepth);t.uniforms.add(new g.FloatPassUniform("radius",(m,q)=>w(q.camera))).code.add(d.glsl`vec3 sphere[16] = vec3[16](
vec3(0.186937, 0.0, 0.0),
vec3(0.700542, 0.0, 0.0),
vec3(-0.864858, -0.481795, -0.111713),
vec3(-0.624773, 0.102853, -0.730153),
vec3(-0.387172, 0.260319, 0.007229),
vec3(-0.222367, -0.642631, -0.707697),
vec3(-0.01336, -0.014956, 0.169662),
vec3(0.122575, 0.1544, -0.456944),
vec3(-0.177141, 0.85997, -0.42346),
vec3(-0.131631, 0.814545, 0.524355),
vec3(-0.779469, 0.007991, 0.624833),
vec3(0.308092, 0.209288,0.35969),
vec3(0.359331, -0.184533, -0.377458),
vec3(0.192633, -0.482999, -0.065284),
vec3(0.233538, 0.293706, -0.055139),
vec3(0.417709, -0.386701, 0.442449)
);
float fallOffFunction(float vv, float vn, float bias) {
float f = max(radius * radius - vv, 0.0);
return f * f * f * max(vn - bias, 0.0);
}`);t.code.add(d.glsl`float aoValueFromPositionsAndNormal(vec3 C, vec3 n_C, vec3 Q) {
vec3 v = Q - C;
float vv = dot(v, v);
float vn = dot(normalize(v), n_C);
return fallOffFunction(vv, vn, 0.1);
}`);t.uniforms.add(new c.Texture2DPassUniform("normalMap",m=>m.normalTexture),new c.Texture2DPassUniform("depthMap",m=>m.depthTexture),new g.FloatPassUniform("projScale",m=>m.projScale),new c.Texture2DPassUniform("rnm",m=>m.noiseTexture),new e.Float2PassUniform("rnmScale",(m,q)=>b.set(x,q.camera.fullWidth/m.noiseTexture.descriptor.width,q.camera.fullHeight/m.noiseTexture.descriptor.height)),new g.FloatPassUniform("intensity",m=>m.intensity),new e.Float2PassUniform("screenSize",(m,q)=>b.set(x,q.camera.fullWidth,
q.camera.fullHeight)));u.outputs.add("fragOcclusion","float");t.main.add(d.glsl`
      float depth = depthFromTexture(depthMap, uv);

      // Early out if depth is out of range, such as in the sky
      if (depth >= 1.0 || depth <= 0.0) {
        fragOcclusion = 1.0;
        return;
      }

      // get the normal of current fragment
      vec4 norm4 = texture(normalMap, uv);
      if(norm4.a != 1.0) {
        fragOcclusion = 1.0;
        return;
      }
      vec3 norm = vec3(-1.0) + 2.0 * norm4.xyz;

      float currentPixelDepth = linearizeDepth(depth);
      vec3 currentPixelPos = reconstructPosition(gl_FragCoord.xy, currentPixelDepth);

      float sum = 0.0;
      vec3 tapPixelPos;

      vec3 fres = normalize(2.0 * texture(rnm, uv * rnmScale).xyz - 1.0);

      // note: the factor 2.0 should not be necessary, but makes ssao much nicer.
      // bug or deviation from CE somewhere else?
      float ps = projScale / (2.0 * currentPixelPos.z * zScale.x + zScale.y);

      for(int i = 0; i < ${d.glsl.int(16)}; ++i) {
        vec2 unitOffset = reflect(sphere[i], fres).xy;
        vec2 offset = vec2(-unitOffset * radius * ps);

        // don't use current or very nearby samples
        if( abs(offset.x) < 2.0 || abs(offset.y) < 2.0){
          continue;
        }

        vec2 tc = vec2(gl_FragCoord.xy + offset);
        if (tc.x < 0.0 || tc.y < 0.0 || tc.x > screenSize.x || tc.y > screenSize.y) continue;
        vec2 tcTap = tc / screenSize;
        float occluderFragmentDepth = linearDepthFromTexture(depthMap, tcTap);

        tapPixelPos = reconstructPosition(tc, occluderFragmentDepth);

        sum += aoValueFromPositionsAndNormal(currentPixelPos, norm, tapPixelPos);
      }

      // output the result
      float A = max(1.0 - sum * intensity / float(${d.glsl.int(16)}), 0.0);

      // Anti-tone map to reduce contrast and drag dark region farther: (x^0.2 + 1.2 * x^4) / 2.2
      A = (pow(A, 0.2) + 1.2 * A * A * A * A) / 2.2;

      fragOcclusion = A;`);return u}function w(u){return Math.max(10,20*u.computeScreenPixelSizeAtDist(Math.abs(4*u.relativeElevation)))}const x=n.create();n=Object.freeze(Object.defineProperty({__proto__:null,build:l,getRadius:w},Symbol.toStringTag,{value:"Module"}));a.SSAO=n;a.build=l;a.getRadius=w})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/CameraSpace.glsl":function(){define("exports ../../../../../../core/libs/gl-matrix-2/math/vec2 ../../../../../../core/libs/gl-matrix-2/factories/vec2f64 ../../../../../../chunks/vec42 ../../../../../../core/libs/gl-matrix-2/factories/vec4f64 ../../shaderModules/Float2PassUniform ../../shaderModules/Float4PassUniform ../../shaderModules/interfaces".split(" "),
function(a,b,n,k,p,h,e,g){function d(w){const x=w.projectionMatrix;return 0===x[11]?k.set(c,2/(w.fullWidth*x[0]),2/(w.fullHeight*x[5]),(1+x[12])/x[0],(1+x[13])/x[5]):k.set(c,-2/(w.fullWidth*x[0]),-2/(w.fullHeight*x[5]),(1-x[8])/x[0],(1-x[9])/x[5])}function f(w){return 0===w.projectionMatrix[11]?b.set(l,0,1):b.set(l,1,0)}const c=p.create(),l=n.create();a.CameraSpace=function(w){w.fragment.uniforms.add(new e.Float4PassUniform("projInfo",(x,u)=>d(u.camera)));w.fragment.uniforms.add(new h.Float2PassUniform("zScale",
(x,u)=>f(u.camera)));w.fragment.code.add(g.glsl`vec3 reconstructPosition(vec2 fragCoord, float depth) {
return vec3((fragCoord * projInfo.xy + projInfo.zw) * (zScale.x * depth + zScale.y), depth);
}`)};a.getProjectionInfo=d;a.getZScale=f;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateSceneLighting.glsl":function(){define("exports ../../../../../../core/compilerUtils ./EvaluateAmbientLighting.glsl ./EvaluateAmbientOcclusion.glsl ./MainLighting.glsl ./PhysicallyBasedRendering.glsl ./PhysicallyBasedRenderingParameters.glsl ./PiUtils.glsl ../../shaderModules/BooleanPassUniform ../../shaderModules/FloatPassUniform ../../shaderModules/interfaces ../../../lighting/SceneLighting".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l){function w(u){u.constants.add("ambientBoostFactor","float",l.ambientBoost)}function x(u){u.uniforms.add(new f.FloatPassUniform("lightingGlobalFactor",(t,m)=>m.lighting.globalFactor))}a.EvaluateSceneLighting=function(u,t){const m=u.fragment;u.include(k.EvaluateAmbientOcclusion,t);t.pbrMode!==e.PBRMode.Disabled&&u.include(h.PhysicallyBasedRendering,t);u.include(n.EvaluateAmbientLighting,t);u.include(g.PiUtils);m.code.add(c.glsl`
    const float GAMMA_SRGB = 2.1;
    const float INV_GAMMA_SRGB = 0.4761904;
    ${t.pbrMode===e.PBRMode.Disabled?"":"const vec3 GROUND_REFLECTANCE \x3d vec3(0.2);"}
  `);w(m);x(m);p.addMainLightDirection(m);m.code.add(c.glsl`
    float additionalDirectedAmbientLight(vec3 vPosWorld) {
      float vndl = dot(${t.spherical?c.glsl`normalize(vPosWorld)`:c.glsl`vec3(0.0, 0.0, 1.0)`}, mainLightDirection);
      return smoothstep(0.0, 1.0, clamp(vndl * 2.5, 0.0, 1.0));
    }
  `);p.addMainLightIntensity(m);m.code.add(c.glsl`vec3 evaluateAdditionalLighting(float ambientOcclusion, vec3 vPosWorld) {
float additionalAmbientScale = additionalDirectedAmbientLight(vPosWorld);
return (1.0 - ambientOcclusion) * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor * mainLightIntensity;
}`);switch(t.pbrMode){case e.PBRMode.Disabled:case e.PBRMode.WaterOnIntegratedMesh:case e.PBRMode.Water:u.include(p.applyShading);m.code.add(c.glsl`vec3 evaluateSceneLighting(vec3 normalWorld, vec3 albedo, float shadow, float ssao, vec3 additionalLight) {
vec3 mainLighting = applyShading(normalWorld, shadow);
vec3 ambientLighting = calculateAmbientIrradiance(normalWorld, ssao);
vec3 albedoLinear = pow(albedo, vec3(GAMMA_SRGB));
vec3 totalLight = mainLighting + ambientLighting + additionalLight;
totalLight = min(totalLight, vec3(PI));
vec3 outColor = vec3((albedoLinear / PI) * totalLight);
return pow(outColor, vec3(INV_GAMMA_SRGB));
}`);break;case e.PBRMode.Normal:case e.PBRMode.Schematic:m.code.add(c.glsl`const float fillLightIntensity = 0.25;
const float horizonLightDiffusion = 0.4;
const float additionalAmbientIrradianceFactor = 0.02;
vec3 evaluateSceneLightingPBR(vec3 normal, vec3 albedo, float shadow, float ssao, vec3 additionalLight, vec3 viewDir, vec3 normalGround, vec3 mrr, vec4 _emission, float additionalAmbientIrradiance)
{
vec3 viewDirection = -viewDir;
vec3 h = normalize(viewDirection + mainLightDirection);
PBRShadingInfo inputs;
inputs.NdotV = clamp(abs(dot(normal, viewDirection)), 0.001, 1.0);
inputs.NdotNG = clamp(dot(normal, normalGround), -1.0, 1.0);
vec3 reflectedView = normalize(reflect(viewDirection, normal));
inputs.RdotNG = clamp(dot(reflectedView, normalGround), -1.0, 1.0);
inputs.albedoLinear = pow(albedo, vec3(GAMMA_SRGB));
inputs.ssao = ssao;
inputs.metalness = mrr[0];
inputs.roughness = clamp(mrr[1] * mrr[1], 0.001, 0.99);`);m.code.add(c.glsl`inputs.f0 = (0.16 * mrr[2] * mrr[2]) * (1.0 - inputs.metalness) + inputs.albedoLinear * inputs.metalness;
inputs.f90 = vec3(clamp(dot(inputs.f0, vec3(50.0 * 0.33)), 0.0, 1.0));
inputs.diffuseColor = inputs.albedoLinear * (vec3(1.0) - inputs.f0) * (1.0 - inputs.metalness);`);t.useFillLights?m.uniforms.add(new d.BooleanPassUniform("hasFillLights",(q,r)=>r.enableFillLights)):m.constants.add("hasFillLights","bool",!1);m.code.add(c.glsl`vec3 ambientDir = vec3(5.0 * normalGround[1] - normalGround[0] * normalGround[2], - 5.0 * normalGround[0] - normalGround[2] * normalGround[1], normalGround[1] * normalGround[1] + normalGround[0] * normalGround[0]);
ambientDir = ambientDir != vec3(0.0) ? normalize(ambientDir) : normalize(vec3(5.0, -1.0, 0.0));
inputs.NdotAmbDir = hasFillLights ? abs(dot(normal, ambientDir)) : 1.0;
float NdotL = clamp(dot(normal, mainLightDirection), 0.001, 1.0);
vec3 mainLightIrradianceComponent = NdotL * (1.0 - shadow) * mainLightIntensity;
vec3 fillLightsIrradianceComponent = inputs.NdotAmbDir * mainLightIntensity * fillLightIntensity;
vec3 ambientLightIrradianceComponent = calculateAmbientIrradiance(normal, ssao) + additionalLight;
inputs.skyIrradianceToSurface = ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;
inputs.groundIrradianceToSurface = GROUND_REFLECTANCE * ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;`);m.uniforms.add(new f.FloatPassUniform("lightingSpecularStrength",(q,r)=>r.lighting.mainLight.specularStrength),new f.FloatPassUniform("lightingEnvironmentStrength",(q,r)=>r.lighting.mainLight.environmentStrength)).code.add(c.glsl`vec3 horizonRingDir = inputs.RdotNG * normalGround - reflectedView;
vec3 horizonRingH = normalize(viewDirection + horizonRingDir);
inputs.NdotH_Horizon = dot(normal, horizonRingH);
float NdotH = clamp(dot(normal, h), 0.0, 1.0);
vec3 mainLightRadianceComponent = lightingSpecularStrength * normalDistribution(NdotH, inputs.roughness) * mainLightIntensity * (1.0 - shadow);
vec3 horizonLightRadianceComponent = lightingEnvironmentStrength * normalDistribution(inputs.NdotH_Horizon, min(inputs.roughness + horizonLightDiffusion, 1.0)) * mainLightIntensity * fillLightIntensity;
vec3 ambientLightRadianceComponent = lightingEnvironmentStrength * calculateAmbientRadiance(ssao) + additionalLight;
float normalDirectionModifier = mix(1., min(mix(0.1, 2.0, (inputs.NdotNG + 1.) * 0.5), 1.0), clamp(inputs.roughness * 5.0, 0.0 , 1.0));
inputs.skyRadianceToSurface = (ambientLightRadianceComponent + horizonLightRadianceComponent) * normalDirectionModifier + mainLightRadianceComponent;
inputs.groundRadianceToSurface = 0.5 * GROUND_REFLECTANCE * (ambientLightRadianceComponent + horizonLightRadianceComponent) * normalDirectionModifier + mainLightRadianceComponent;
inputs.averageAmbientRadiance = ambientLightIrradianceComponent[1] * (1.0 + GROUND_REFLECTANCE[1]);`);m.code.add(c.glsl`
        vec3 reflectedColorComponent = evaluateEnvironmentIllumination(inputs);
        vec3 additionalMaterialReflectanceComponent = inputs.albedoLinear * additionalAmbientIrradiance;
        vec3 emissionComponent = _emission.rgb == vec3(0.0) ? _emission.rgb : pow(_emission.rgb, vec3(GAMMA_SRGB));
        vec3 outColorLinear = reflectedColorComponent + additionalMaterialReflectanceComponent + emissionComponent;
        ${t.pbrMode!==e.PBRMode.Schematic||t.hasColorTexture?c.glsl`vec3 outColor = pow(blackLevelSoftCompression(outColorLinear, inputs), vec3(INV_GAMMA_SRGB));`:c.glsl`vec3 outColor = pow(max(vec3(0.0), outColorLinear - 0.005 * inputs.averageAmbientRadiance), vec3(INV_GAMMA_SRGB));`}
        return outColor;
      }
    `);break;case e.PBRMode.Simplified:case e.PBRMode.TerrainWithWater:p.addMainLightDirection(m);p.addMainLightIntensity(m);m.code.add(c.glsl`const float roughnessTerrain = 0.5;
const float specularityTerrain = 0.5;
const vec3 fresnelReflectionTerrain = vec3(0.04);
vec3 evaluatePBRSimplifiedLighting(vec3 n, vec3 c, float shadow, float ssao, vec3 al, vec3 vd, vec3 nup) {
vec3 viewDirection = -vd;
vec3 h = normalize(viewDirection + mainLightDirection);
float NdotL = clamp(dot(n, mainLightDirection), 0.001, 1.0);
float NdotV = clamp(abs(dot(n, viewDirection)), 0.001, 1.0);
float NdotH = clamp(dot(n, h), 0.0, 1.0);
float NdotNG = clamp(dot(n, nup), -1.0, 1.0);
vec3 albedoLinear = pow(c, vec3(GAMMA_SRGB));
float lightness = 0.3 * albedoLinear[0] + 0.5 * albedoLinear[1] + 0.2 * albedoLinear[2];
vec3 f0 = (0.85 * lightness + 0.15) * fresnelReflectionTerrain;
vec3 f90 =  vec3(clamp(dot(f0, vec3(50.0 * 0.33)), 0.0, 1.0));
vec3 mainLightIrradianceComponent = (1. - shadow) * NdotL * mainLightIntensity;
vec3 ambientLightIrradianceComponent = calculateAmbientIrradiance(n, ssao) + al;
vec3 ambientSky = ambientLightIrradianceComponent + mainLightIrradianceComponent;
vec3 indirectDiffuse = ((1.0 - NdotNG) * mainLightIrradianceComponent + (1.0 + NdotNG ) * ambientSky) * 0.5;
vec3 outDiffColor = albedoLinear * (1.0 - f0) * indirectDiffuse / PI;
vec3 mainLightRadianceComponent = normalDistribution(NdotH, roughnessTerrain) * mainLightIntensity;
vec2 dfg = prefilteredDFGAnalytical(roughnessTerrain, NdotV);
vec3 specularColor = f0 * dfg.x + f90 * dfg.y;
vec3 specularComponent = specularityTerrain * specularColor * mainLightRadianceComponent;
vec3 outColorLinear = outDiffColor + specularComponent;
vec3 outColor = pow(outColorLinear, vec3(INV_GAMMA_SRGB));
return outColor;
}`);break;default:b.neverReached(t.pbrMode);case e.PBRMode.COUNT:}};a.addAmbientBoostFactor=w;a.addLightingGlobalFactor=x;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateAmbientLighting.glsl":function(){define("exports ../../../../../../chunks/vec32 ../../../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../../../chunks/vec42 ../../../../../../core/libs/gl-matrix-2/factories/vec4f64 ./PhysicallyBasedRenderingParameters.glsl ../../shaderModules/Float3PassUniform ../../shaderModules/Float4PassUniform ../../shaderModules/interfaces".split(" "),
function(a,b,n,k,p,h,e,g,d){const f=n.create(),c=p.create();a.EvaluateAmbientLighting=function(l,w){l=l.fragment;const x=void 0!==w.lightingSphericalHarmonicsOrder?w.lightingSphericalHarmonicsOrder:2;0===x?(l.uniforms.add(new e.Float3PassUniform("lightingAmbientSH0",(u,t)=>b.set(f,t.lighting.sh.r[0],t.lighting.sh.g[0],t.lighting.sh.b[0]))),l.code.add(d.glsl`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec3 ambientLight = 0.282095 * lightingAmbientSH0;
return ambientLight * (1.0 - ambientOcclusion);
}`)):1===x?(l.uniforms.add(new g.Float4PassUniform("lightingAmbientSH_R",(u,t)=>k.set(c,t.lighting.sh.r[0],t.lighting.sh.r[1],t.lighting.sh.r[2],t.lighting.sh.r[3])),new g.Float4PassUniform("lightingAmbientSH_G",(u,t)=>k.set(c,t.lighting.sh.g[0],t.lighting.sh.g[1],t.lighting.sh.g[2],t.lighting.sh.g[3])),new g.Float4PassUniform("lightingAmbientSH_B",(u,t)=>k.set(c,t.lighting.sh.b[0],t.lighting.sh.b[1],t.lighting.sh.b[2],t.lighting.sh.b[3]))),l.code.add(d.glsl`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec4 sh0 = vec4(
0.282095,
0.488603 * normal.x,
0.488603 * normal.z,
0.488603 * normal.y
);
vec3 ambientLight = vec3(
dot(lightingAmbientSH_R, sh0),
dot(lightingAmbientSH_G, sh0),
dot(lightingAmbientSH_B, sh0)
);
return ambientLight * (1.0 - ambientOcclusion);
}`)):2===x&&(l.uniforms.add(new e.Float3PassUniform("lightingAmbientSH0",(u,t)=>b.set(f,t.lighting.sh.r[0],t.lighting.sh.g[0],t.lighting.sh.b[0])),new g.Float4PassUniform("lightingAmbientSH_R1",(u,t)=>k.set(c,t.lighting.sh.r[1],t.lighting.sh.r[2],t.lighting.sh.r[3],t.lighting.sh.r[4])),new g.Float4PassUniform("lightingAmbientSH_G1",(u,t)=>k.set(c,t.lighting.sh.g[1],t.lighting.sh.g[2],t.lighting.sh.g[3],t.lighting.sh.g[4])),new g.Float4PassUniform("lightingAmbientSH_B1",(u,t)=>k.set(c,t.lighting.sh.b[1],
t.lighting.sh.b[2],t.lighting.sh.b[3],t.lighting.sh.b[4])),new g.Float4PassUniform("lightingAmbientSH_R2",(u,t)=>k.set(c,t.lighting.sh.r[5],t.lighting.sh.r[6],t.lighting.sh.r[7],t.lighting.sh.r[8])),new g.Float4PassUniform("lightingAmbientSH_G2",(u,t)=>k.set(c,t.lighting.sh.g[5],t.lighting.sh.g[6],t.lighting.sh.g[7],t.lighting.sh.g[8])),new g.Float4PassUniform("lightingAmbientSH_B2",(u,t)=>k.set(c,t.lighting.sh.b[5],t.lighting.sh.b[6],t.lighting.sh.b[7],t.lighting.sh.b[8]))),l.code.add(d.glsl`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec3 ambientLight = 0.282095 * lightingAmbientSH0;
vec4 sh1 = vec4(
0.488603 * normal.x,
0.488603 * normal.z,
0.488603 * normal.y,
1.092548 * normal.x * normal.y
);
vec4 sh2 = vec4(
1.092548 * normal.y * normal.z,
0.315392 * (3.0 * normal.z * normal.z - 1.0),
1.092548 * normal.x * normal.z,
0.546274 * (normal.x * normal.x - normal.y * normal.y)
);
ambientLight += vec3(
dot(lightingAmbientSH_R1, sh1),
dot(lightingAmbientSH_G1, sh1),
dot(lightingAmbientSH_B1, sh1)
);
ambientLight += vec3(
dot(lightingAmbientSH_R2, sh2),
dot(lightingAmbientSH_G2, sh2),
dot(lightingAmbientSH_B2, sh2)
);
return ambientLight * (1.0 - ambientOcclusion);
}`),w.pbrMode!==h.PBRMode.Normal&&w.pbrMode!==h.PBRMode.Schematic||l.code.add(d.glsl`const vec3 skyTransmittance = vec3(0.9, 0.9, 1.0);
vec3 calculateAmbientRadiance(float ambientOcclusion)
{
vec3 ambientLight = 1.2 * (0.282095 * lightingAmbientSH0) - 0.2;
return ambientLight *= (1.0 - ambientOcclusion) * skyTransmittance;
}`))};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/MainLighting.glsl":function(){define(["exports","../../shaderModules/Float3PassUniform","../../shaderModules/interfaces"],function(a,b,n){function k(h){h.uniforms.add(new b.Float3PassUniform("mainLightDirection",(e,g)=>g.lighting.mainLight.direction))}function p(h){h.uniforms.add(new b.Float3PassUniform("mainLightIntensity",(e,g)=>g.lighting.mainLight.intensity))}a.addMainLightDirection=
k;a.addMainLightIntensity=p;a.applyShading=function(h){k(h.fragment);p(h.fragment);h.fragment.code.add(n.glsl`vec3 applyShading(vec3 shadingNormalWorld, float shadow) {
float dotVal = clamp(dot(shadingNormalWorld, mainLightDirection), 0.0, 1.0);
return mainLightIntensity * ((1.0 - shadow) * dotVal);
}`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRendering.glsl":function(){define(["exports","./AnalyticalSkyModel.glsl","./PhysicallyBasedRenderingParameters.glsl","./PiUtils.glsl","../../shaderModules/interfaces"],function(a,b,n,k,p){a.PhysicallyBasedRendering=function(h,e){const g=h.fragment.code;h.include(k.PiUtils);if(e.pbrMode===n.PBRMode.Normal||e.pbrMode===n.PBRMode.Schematic||e.pbrMode===n.PBRMode.Simplified||
e.pbrMode===n.PBRMode.TerrainWithWater)g.add(p.glsl`float normalDistribution(float NdotH, float roughness)
{
float a = NdotH * roughness;
float b = roughness / (1.0 - NdotH * NdotH + a * a);
return b * b * INV_PI;
}`),g.add(p.glsl`const vec4 c0 = vec4(-1.0, -0.0275, -0.572,  0.022);
const vec4 c1 = vec4( 1.0,  0.0425,  1.040, -0.040);
const vec2 c2 = vec2(-1.04, 1.04);
vec2 prefilteredDFGAnalytical(float roughness, float NdotV) {
vec4 r = roughness * c0 + c1;
float a004 = min(r.x * r.x, exp2(-9.28 * NdotV)) * r.x + r.y;
return c2 * a004 + r.zw;
}`);if(e.pbrMode===n.PBRMode.Normal||e.pbrMode===n.PBRMode.Schematic)h.include(b.AnalyticalSkyModel),g.add(p.glsl`struct PBRShadingInfo
{
float NdotV;
float LdotH;
float NdotNG;
float RdotNG;
float NdotAmbDir;
float NdotH_Horizon;
vec3 skyRadianceToSurface;
vec3 groundRadianceToSurface;
vec3 skyIrradianceToSurface;
vec3 groundIrradianceToSurface;
float averageAmbientRadiance;
float ssao;
vec3 albedoLinear;
vec3 f0;
vec3 f90;
vec3 diffuseColor;
float metalness;
float roughness;
};`),g.add(p.glsl`vec3 evaluateEnvironmentIllumination(PBRShadingInfo inputs) {
vec3 indirectDiffuse = evaluateDiffuseIlluminationHemisphere(inputs.groundIrradianceToSurface, inputs.skyIrradianceToSurface, inputs.NdotNG);
vec3 indirectSpecular = evaluateSpecularIlluminationHemisphere(inputs.groundRadianceToSurface, inputs.skyRadianceToSurface, inputs.RdotNG, inputs.roughness);
vec3 diffuseComponent = inputs.diffuseColor * indirectDiffuse * INV_PI;
vec2 dfg = prefilteredDFGAnalytical(inputs.roughness, inputs.NdotV);
vec3 specularColor = inputs.f0 * dfg.x + inputs.f90 * dfg.y;
vec3 specularComponent = specularColor * indirectSpecular;
return (diffuseComponent + specularComponent);
}`),g.add(p.glsl`float gamutMapChanel(float x, vec2 p){
return (x < p.x) ? mix(0.0, p.y, x/p.x) : mix(p.y, 1.0, (x - p.x) / (1.0 - p.x) );
}`),g.add(p.glsl`vec3 blackLevelSoftCompression(vec3 inColor, PBRShadingInfo inputs){
vec3 outColor;
vec2 p = vec2(0.02 * (inputs.averageAmbientRadiance), 0.0075 * (inputs.averageAmbientRadiance));
outColor.x = gamutMapChanel(inColor.x, p) ;
outColor.y = gamutMapChanel(inColor.y, p) ;
outColor.z = gamutMapChanel(inColor.z, p) ;
return outColor;
}`)};a.PhysicallyBasedRenderingWater=function(h,e){const g=h.fragment.code;h.include(k.PiUtils);g.add(p.glsl`
  struct PBRShadingWater
  {
      float NdotL;   // cos angle between normal and light direction
      float NdotV;   // cos angle between normal and view direction
      float NdotH;   // cos angle between normal and half vector
      float VdotH;   // cos angle between view direction and half vector
      float LdotH;   // cos angle between light direction and half vector
      float VdotN;   // cos angle between view direction and normal vector
  };

  float dtrExponent = ${e.useCustomDTRExponentForWater?"2.2":"2.0"};
  `);g.add(p.glsl`vec3 fresnelReflection(float angle, vec3 f0, float f90) {
return f0 + (f90 - f0) * pow(1.0 - angle, 5.0);
}`);g.add(p.glsl`float normalDistributionWater(float NdotH, float roughness)
{
float r2 = roughness * roughness;
float NdotH2 = NdotH * NdotH;
float denom = pow((NdotH2 * (r2 - 1.0) + 1.0), dtrExponent) * PI;
return r2 / denom;
}`);g.add(p.glsl`float geometricOcclusionKelemen(float LoH)
{
return 0.25 / (LoH * LoH);
}`);g.add(p.glsl`vec3 brdfSpecularWater(in PBRShadingWater props, float roughness, vec3 F0, float F0Max)
{
vec3  F = fresnelReflection(props.VdotH, F0, F0Max);
float dSun = normalDistributionWater(props.NdotH, roughness);
float V = geometricOcclusionKelemen(props.LdotH);
float diffusionSunHaze = mix(roughness + 0.045, roughness + 0.385, 1.0 - props.VdotH);
float strengthSunHaze  = 1.2;
float dSunHaze = normalDistributionWater(props.NdotH, diffusionSunHaze) * strengthSunHaze;
return ((dSun + dSunHaze) * V) * F;
}`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/AnalyticalSkyModel.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,b){a.AnalyticalSkyModel=function(n){n=n.fragment.code;n.add(b.glsl`vec3 evaluateDiffuseIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float NdotNG)
{
return ((1.0 - NdotNG) * ambientGround + (1.0 + NdotNG) * ambientSky) * 0.5;
}`);n.add(b.glsl`float integratedRadiance(float cosTheta2, float roughness)
{
return (cosTheta2 - 1.0) / (cosTheta2 * (1.0 - roughness * roughness) - 1.0);
}`);n.add(b.glsl`vec3 evaluateSpecularIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float RdotNG, float roughness)
{
float cosTheta2 = 1.0 - RdotNG * RdotNG;
float intRadTheta = integratedRadiance(cosTheta2, roughness);
float ground = RdotNG < 0.0 ? 1.0 - intRadTheta : 1.0 + intRadTheta;
float sky = 2.0 - ground;
return (ground * ambientGround + sky * ambientSky) * 0.5;
}`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/PiUtils.glsl":function(){define(["exports"],function(a){a.PiUtils=function(b){b.vertex.constants.add("PI","float",3.141592653589793);b.fragment.constants.add("PI","float",3.141592653589793);b.fragment.constants.add("LIGHT_NORMALIZATION","float",.3183098861837907);b.fragment.constants.add("INV_PI","float",.3183098861837907);b.fragment.constants.add("HALF_PI","float",1.570796326794897);
b.fragment.constants.add("TWO_PI","float",6.28318530717958)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lighting/SceneLighting":function(){define("exports ../../../../core/mathUtils ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ./Lightsources ./SphericalHarmonics".split(" "),function(a,b,n,k,p,h){class e{constructor(){this.color=k.create();this.intensity=1}}class g{constructor(){this.direction=k.create();this.ambient=
new e;this.diffuse=new e}}class d{constructor(){this._shOrder=2;this._legacy=new g;this.noonFactor=this.globalFactor=.5;this._sphericalHarmonics=new p.SphericalHarmonicsAmbientLight;this._mainLight=new p.MainLight(k.create(),k.fromValues(1,0,0),!1)}get legacy(){return this._legacy}get sh(){return this._sphericalHarmonics}get mainLight(){return this._mainLight}set(c){h.combineLights(c,this._shOrder,this._mainLight,this._sphericalHarmonics);n.copy(this._legacy.direction,this._mainLight.direction);c=
1/Math.PI;this._legacy.ambient.color[0]=.282095*this._sphericalHarmonics.r[0]*c;this._legacy.ambient.color[1]=.282095*this._sphericalHarmonics.g[0]*c;this._legacy.ambient.color[2]=.282095*this._sphericalHarmonics.b[0]*c;n.scale(this._legacy.diffuse.color,this._mainLight.intensity,c);n.copy(f,this._legacy.diffuse.color);n.scale(f,f,.4*this.globalFactor);n.add(this._legacy.ambient.color,this._legacy.ambient.color,f)}copyFrom(c){this._sphericalHarmonics.r=Array.from(c.sh.r);this._sphericalHarmonics.g=
Array.from(c.sh.g);this._sphericalHarmonics.b=Array.from(c.sh.b);n.copy(this._mainLight.direction,c.mainLight.direction);n.copy(this._mainLight.intensity,c.mainLight.intensity);this._mainLight.castShadows=c.mainLight.castShadows;this._mainLight.specularStrength=c.mainLight.specularStrength;this._mainLight.environmentStrength=c.mainLight.environmentStrength;this.globalFactor=c.globalFactor;this.noonFactor=c.noonFactor}lerpLighting(c,l,w){n.lerp(this._mainLight.intensity,c.mainLight.intensity,l.mainLight.intensity,
w);this._mainLight.environmentStrength=b.lerp(c.mainLight.environmentStrength,l.mainLight.environmentStrength,w);this._mainLight.specularStrength=b.lerp(c.mainLight.specularStrength,l.mainLight.specularStrength,w);n.copy(this._mainLight.direction,l.mainLight.direction);this._mainLight.castShadows=l.mainLight.castShadows;this.globalFactor=b.lerp(c.globalFactor,l.globalFactor,w);this.noonFactor=b.lerp(c.noonFactor,l.noonFactor,w);if(c.sh.r.length===l.sh.r.length)for(let x=0;x<l.sh.r.length;x++)this._sphericalHarmonics.r[x]=
b.lerp(c.sh.r[x],l.sh.r[x],w),this._sphericalHarmonics.g[x]=b.lerp(c.sh.g[x],l.sh.g[x],w),this._sphericalHarmonics.b[x]=b.lerp(c.sh.b[x],l.sh.b[x],w);else for(c=0;c<l.sh.r.length;c++)this._sphericalHarmonics.r[c]=l.sh.r[c],this._sphericalHarmonics.g[c]=l.sh.g[c],this._sphericalHarmonics.b[c]=l.sh.b[c]}}const f=k.create();a.SceneLighting=d;a.SunLight=g;a.ambientBoost=.4;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lighting/SphericalHarmonics":function(){define("exports ../../../../core/mathUtils ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../lib/LongVectorMath ./Lightsources".split(" "),
function(a,b,n,k,p,h){function e(v){return(v+1)*(v+1)}function g(v){return b.clamp(Math.floor(Math.sqrt(v)-1),0,2)}function d(v,y,B){const z=v[0],A=v[1];v=v[2];B=B||[];B.length=e(y);0<=y&&(B[0]=.28209479177);1<=y&&(B[1]=.4886025119*z,B[2]=.4886025119*v,B[3]=.4886025119*A);2<=y&&(B[4]=1.09254843059*z*A,B[5]=1.09254843059*A*v,B[6]=.31539156525*(3*v*v-1),B[7]=1.09254843059*z*v,B[8]=.54627421529*(z*z-A*A));return B}function f(v,y){v=e(v);y=y||{r:[],g:[],b:[]};y.r.length=y.g.length=y.b.length=v;for(let B=
0;B<v;B++)y.r[B]=y.g[B]=y.b[B]=0;return y}function c(v,y){const B=g(y.r.length);for(const z of v)n.negate(q,z.direction),d(q,B,t),p.elementwiseProduct(t,r),p.scalarProduct(t,z.intensity[0],m),p.add(y.r,m),p.scalarProduct(t,z.intensity[1],m),p.add(y.g,m),p.scalarProduct(t,z.intensity[2],m),p.add(y.b,m);return y}function l(v,y){d(q,0,t);for(const B of v)y.r[0]+=t[0]*r[0]*B.intensity[0]*4*Math.PI,y.g[0]+=t[0]*r[0]*B.intensity[1]*4*Math.PI,y.b[0]+=t[0]*r[0]*B.intensity[2]*4*Math.PI;return y}const w=[],
x=[],u=[],t=[0],m=[0],q=k.create(),r=[3.141593,2.094395,2.094395,2.094395,.785398,.785398,.785398,.785398,.785398];a.combineLights=function(v,y,B,z){f(y,z);n.set(B.intensity,0,0,0);y=!1;w.length=0;x.length=0;u.length=0;for(const A of v)A instanceof h.MainLight&&!y?(n.copy(B.direction,A.direction),n.copy(B.intensity,A.intensity),B.specularStrength=A.specularStrength,B.environmentStrength=A.environmentStrength,B.castShadows=A.castShadows,y=!0):A instanceof h.MainLight||A instanceof h.FillLight?w.push(A):
A instanceof h.AmbientLight?x.push(A):A instanceof h.SphericalHarmonicsAmbientLight&&u.push(A);c(w,z);l(x,z);for(const A of u)p.add(z.r,A.r),p.add(z.g,A.g),p.add(z.b,A.b)};a.computeCoefficients=d;a.initSHCoefficients=f;a.numberOfCoefficients=e;a.orderFromNumberOfCoefficients=g;a.projectAmbientLights=l;a.projectFillLights=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/LongVectorMath":function(){define(["exports"],function(a){a.add=function(b,n,k){k=
k||b;k.length=b.length;for(let p=0;p<b.length;p++)k[p]=b[p]+n[p];return k};a.dotProduct=function(b,n){let k=0;for(let p=0;p<b.length;p++)k+=b[p]*n[p];return k};a.elementwiseProduct=function(b,n,k){k=k||b;k.length=b.length;for(let p=0;p<b.length;p++)k[p]=b[p]*n[p];return k};a.scalarProduct=function(b,n,k){k=k||b;k.length=b.length;for(let p=0;p<b.length;p++)k[p]=b[p]*n;return k};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/ReadShadowMap.glsl":function(){define("exports ../../../../../../core/libs/gl-matrix-2/factories/mat4f64 ../../../../../../core/libs/gl-matrix-2/factories/vec3f64 ../util/RgbaFloat16Encoding.glsl ../../shaderModules/Float4PassUniform ../../shaderModules/IntegerPassUniform ../../shaderModules/interfaces ../../shaderModules/Matrix4sDrawUniform ../../shaderModules/Matrix4sPassUniform ../../shaderModules/Texture2DPassUniform".split(" "),
function(a,b,n,k,p,h,e,g,d,f){function c(t){t=t.fragment;t.include(k.Rgba4FloatEncoding);t.uniforms.add(new f.Texture2DPassUniform("shadowMap",(m,q)=>q.shadowMap.depthTexture),new h.IntegerPassUniform("numCascades",(m,q)=>q.shadowMap.numCascades),new p.Float4PassUniform("cascadeDistances",(m,q)=>q.shadowMap.cascadeDistances)).code.add(e.glsl`int chooseCascade(float depth, out mat4 mat) {
vec4 distance = cascadeDistances;
int i = depth < distance[1] ? 0 : depth < distance[2] ? 1 : depth < distance[3] ? 2 : 3;
mat = i == 0 ? shadowMapMatrix[0] : i == 1 ? shadowMapMatrix[1] : i == 2 ? shadowMapMatrix[2] : shadowMapMatrix[3];
return i;
}
vec3 lightSpacePosition(vec3 _vpos, mat4 mat) {
vec4 lv = mat * vec4(_vpos, 1.0);
lv.xy /= lv.w;
return 0.5 * lv.xyz + vec3(0.5);
}
vec2 cascadeCoordinates(int i, ivec2 textureSize, vec3 lvpos) {
float xScale = float(textureSize.y) / float(textureSize.x);
return vec2((float(i) + lvpos.x) * xScale, lvpos.y);
}
float readShadowMapDepth(ivec2 uv, sampler2D _depthTex) {
return rgba4ToFloat(texelFetch(_depthTex, uv, 0));
}
float posIsInShadow(ivec2 uv, vec3 lvpos, sampler2D _depthTex) {
return readShadowMapDepth(uv, _depthTex) < lvpos.z ? 1.0 : 0.0;
}
float filterShadow(vec2 uv, vec3 lvpos, ivec2 texSize, sampler2D _depthTex) {
vec2 st = fract(uv * vec2(texSize) + vec2(0.5));
ivec2 base = ivec2(uv * vec2(texSize) - vec2(0.5));
float s00 = posIsInShadow(ivec2(base.x, base.y), lvpos, _depthTex);
float s10 = posIsInShadow(ivec2(base.x + 1, base.y), lvpos, _depthTex);
float s11 = posIsInShadow(ivec2(base.x + 1, base.y + 1), lvpos, _depthTex);
float s01 = posIsInShadow(ivec2(base.x, base.y + 1), lvpos, _depthTex);
return mix(mix(s00, s10, st.x), mix(s01, s11, st.x), st.y);
}
float readShadowMap(const in vec3 _vpos, float _linearDepth) {
mat4 mat;
int i = chooseCascade(_linearDepth, mat);
if (i >= numCascades) { return 0.0; }
vec3 lvpos = lightSpacePosition(_vpos, mat);
if (lvpos.z >= 1.0 || lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) { return 0.0; }
ivec2 size = textureSize(shadowMap, 0);
vec2 uv = cascadeCoordinates(i, size, lvpos);
return filterShadow(uv, lvpos, size, shadowMap);
}`)}class l extends e.NoParameters{constructor(){super(...arguments);this.origin=n.create()}}class w extends l{}class x extends e.NoParameters{constructor(){super(...arguments);this.modelTransformation=b.IDENTITY}}class u extends x{constructor(){super(...arguments);this.origin=n.create()}}a.ReadShadowMapDraw=function(t,m){m.receiveShadows&&(t.fragment.uniforms.add(new g.Matrix4sDrawUniform("shadowMapMatrix",(q,r)=>r.shadowMap.getShadowMapMatrices(q.origin),4)),c(t))};a.ReadShadowMapDrawParameters=
w;a.ReadShadowMapParameters=x;a.ReadShadowMapPass=function(t,m){m.receiveShadows&&(t.fragment.uniforms.add(new d.Matrix4sPassUniform("shadowMapMatrix",(q,r)=>r.shadowMap.getShadowMapMatrices(q.origin),4)),c(t))};a.ReadShadowMapPassParameters=u;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/Matrix4sDrawUniform":function(){define(["exports","./Uniform","../shaderTechnique/BindType"],function(a,b,n){class k extends b.Uniform{constructor(p,
h,e){super(p,"mat4",n.BindType.Draw,(g,d,f,c)=>g.setUniformMatrix4fv(p,h(d,f,c)),e)}}a.Matrix4sDrawUniform=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/Matrix4sPassUniform":function(){define(["exports","./Uniform","../shaderTechnique/BindType"],function(a,b,n){class k extends b.Uniform{constructor(p,h,e){super(p,"mat4",n.BindType.Pass,(g,d,f)=>g.setUniformMatrix4fv(p,h(d,f)),e)}}a.Matrix4sPassUniform=k;Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/TextureTransformUV.glsl":function(){define(["exports","../../../../../../core/libs/gl-matrix-2/factories/mat3f64","../attributes/TextureCoordinateAttribute.glsl","../../shaderModules/interfaces","../../shaderModules/Matrix3PassUniform"],function(a,b,n,k,p){a.colorTextureUV=function(h,e){e.hasColorTextureTransform?(h.varyings.add("colorUV","vec2"),h.vertex.uniforms.add(new p.Matrix3PassUniform("colorTextureTransformMatrix",
g=>g.colorTextureTransformMatrix??b.IDENTITY)).code.add(k.glsl`void forwardColorUV(){
colorUV = (colorTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)):h.vertex.code.add(k.glsl`void forwardColorUV(){}`)};a.emissiveTextureUV=function(h,e){e.hasEmissionTextureTransform&&e.textureCoordinateType!==n.TextureCoordinateType.None?(h.varyings.add("emissiveUV","vec2"),h.vertex.uniforms.add(new p.Matrix3PassUniform("emissiveTextureTransformMatrix",g=>g.emissiveTextureTransformMatrix??b.IDENTITY)).code.add(k.glsl`void forwardEmissiveUV(){
emissiveUV = (emissiveTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)):h.vertex.code.add(k.glsl`void forwardEmissiveUV(){}`)};a.metallicRoughnessTextureUV=function(h,e){e.hasMetallicRoughnessTextureTransform&&e.textureCoordinateType!==n.TextureCoordinateType.None?(h.varyings.add("metallicRoughnessUV","vec2"),h.vertex.uniforms.add(new p.Matrix3PassUniform("metallicRoughnessTextureTransformMatrix",g=>g.metallicRoughnessTextureTransformMatrix??b.IDENTITY)).code.add(k.glsl`void forwardMetallicRoughnessUV(){
metallicRoughnessUV = (metallicRoughnessTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)):h.vertex.code.add(k.glsl`void forwardMetallicRoughnessUV(){}`)};a.normalTextureUV=function(h,e){e.hasNormalTextureTransform&&e.textureCoordinateType!==n.TextureCoordinateType.None?(h.varyings.add("normalUV","vec2"),h.vertex.uniforms.add(new p.Matrix3PassUniform("normalTextureTransformMatrix",g=>g.normalTextureTransformMatrix??b.IDENTITY)).code.add(k.glsl`void forwardNormalUV(){
normalUV = (normalTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)):h.vertex.code.add(k.glsl`void forwardNormalUV(){}`)};a.occlusionTextureUV=function(h,e){e.hasOcclusionTextureTransform&&e.textureCoordinateType!==n.TextureCoordinateType.None?(h.varyings.add("occlusionUV","vec2"),h.vertex.uniforms.add(new p.Matrix3PassUniform("occlusionTextureTransformMatrix",g=>g.occlusionTextureTransformMatrix??b.IDENTITY)).code.add(k.glsl`void forwardOcclusionUV(){
occlusionUV = (occlusionTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)):h.vertex.code.add(k.glsl`void forwardOcclusionUV(){}`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/MixExternalColor.glsl":function(){define(["exports","../../../../layers/support/symbolColorUtils","./ColorConversion.glsl","../../shaderModules/interfaces"],function(a,b,n,k){a.MixExternalColor=function(p){p.include(n.ColorConversion);p.code.add(k.glsl`
    vec3 mixExternalColor(vec3 internalColor, vec3 textureColor, vec3 externalColor, int mode) {
      // workaround for artifacts in macOS using Intel Iris Pro
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475
      vec3 internalMixed = internalColor * textureColor;
      vec3 allMixed = internalMixed * externalColor;

      if (mode == ${k.glsl.int(b.ColorMixModeEnum.Multiply)}) {
        return allMixed;
      }
      if (mode == ${k.glsl.int(b.ColorMixModeEnum.Ignore)}) {
        return internalMixed;
      }
      if (mode == ${k.glsl.int(b.ColorMixModeEnum.Replace)}) {
        return externalColor;
      }

      // tint (or something invalid)
      float vIn = rgb2v(internalMixed);
      vec3 hsvTint = rgb2hsv(externalColor);
      vec3 hsvOut = vec3(hsvTint.x, hsvTint.y, vIn * hsvTint.z);
      return hsv2rgb(hsvOut);
    }

    float mixExternalOpacity(float internalOpacity, float textureOpacity, float externalOpacity, int mode) {
      // workaround for artifacts in macOS using Intel Iris Pro
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475
      float internalMixed = internalOpacity * textureOpacity;
      float allMixed = internalMixed * externalOpacity;

      if (mode == ${k.glsl.int(b.ColorMixModeEnum.Ignore)}) {
        return internalMixed;
      }
      if (mode == ${k.glsl.int(b.ColorMixModeEnum.Replace)}) {
        return externalOpacity;
      }

      // multiply or tint (or something invalid)
      return allMixed;
    }
  `)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/OutputColorHighlightOID.glsl":function(){define("exports ../core/shaderLibrary/ShaderOutput ../core/shaderLibrary/output/Emissions.glsl ../core/shaderLibrary/output/OutputHighlight.glsl ../core/shaderLibrary/util/AlphaCutoff ../core/shaderLibrary/util/ColorConversion.glsl ../core/shaderModules/interfaces ../lib/OITPass".split(" "),function(a,b,n,k,p,h,e,g){a.outputColorHighlightOID=function(d,
f){d.include(k.OutputHighlight,f);d.include(n.Emissions,f);d.fragment.include(h.ColorConversion);const c=f.output===b.ShaderOutput.ObjectAndLayerIdColor,l=b.isColorEmission(f.output),w=b.isColorOrColorEmission(f.output)&&f.oitPass===g.OITPass.ColorAlpha,x=b.isColorOrColorEmission(f.output)&&f.oitPass!==g.OITPass.ColorAlpha;f=f.discardInvisibleFragments;let u=0;(x||l||w)&&d.outputs.add("fragColor","vec4",u++);l&&d.outputs.add("fragEmission","vec4",u++);w&&d.outputs.add("fragAlpha","float",u++);d.fragment.code.add(e.glsl`
    void outputColorHighlightOID(vec4 finalColor, const in vec3 vWorldPosition) {
      ${e.If(c,e.glsl`finalColor.a = 1.0;`)}

      ${e.If(f,e.glsl`if (finalColor.a < ${e.glsl.float(p.alphaCutoff)}){
              discard;
              return;
            }`)}

      finalColor = highlightSlice(finalColor, vWorldPosition);
      ${e.If(w,e.glsl`fragColor = premultiplyAlpha(finalColor);
             fragAlpha = finalColor.a;`)}
      ${e.If(x,"fragColor \x3d finalColor;")}
      ${e.If(l,"fragEmission \x3d getEmissions();")}
      calculateOcclusionAndOutputHighlight();
      ${e.If(c,"outputObjectAndLayerIdColor();")}
    }
  `)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/DefaultMaterialTechniqueConfiguration":function(){define("exports ../../../../chunks/tslib.es6 ../core/shaderLibrary/attributes/NormalAttribute.glsl ../core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl ../core/shaderLibrary/output/Emissions.glsl ../core/shaderLibrary/shading/Normals.glsl ../core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/basicInterfaces ../materials/DefaultTechniqueConfiguration".split(" "),
function(a,b,n,k,p,h,e,g,d,f){class c extends f.DefaultTechniqueConfiguration{constructor(l,w){super();this.spherical=l;this.doublePrecisionRequiresObfuscation=w;this.alphaDiscardMode=d.AlphaDiscardMode.Opaque;this.doubleSidedMode=h.NormalsDoubleSidedMode.None;this.pbrMode=e.PBRMode.Disabled;this.cullFace=d.CullFaceOptions.None;this.normalType=n.NormalType.Attribute;this.customDepthTest=d.DepthTestFunction.Less;this.emissionSource=p.EmissionSource.None;this.hasSlicePlane=this.hasVerticalOffset=this.hasSymbolColors=
this.hasVertexColors=!1;this.hasSliceHighlight=!0;this.instancedColor=this.instanced=this.textureAlphaPremultiplied=this.receiveAmbientOcclusion=this.receiveShadows=this.vvColor=this.vvSize=this.offsetBackfaces=this.hasModelTransformation=this.hasOccludees=this.hasVertexTangents=this.hasScreenSizePerspective=this.hasNormalTexture=this.hasOcclusionTexture=this.hasMetallicRoughnessTexture=this.hasColorTexture=!1;this.writeDepth=!0;this.transparent=!1;this.enableOffset=!0;this.occlusionPass=this.hasMetallicRoughnessTextureTransform=
this.hasOcclusionTextureTransform=this.hasNormalTextureTransform=this.hasEmissionTextureTransform=this.hasColorTextureTransform=this.snowCover=this.cullAboveTerrain=this.terrainDepthTest=!1;this.hasVvInstancing=!0;this.useCustomDTRExponentForWater=!1;this.useFillLights=!0}get textureCoordinateType(){return this.hasColorTexture||this.hasMetallicRoughnessTexture||this.emissionSource===p.EmissionSource.Texture||this.hasOcclusionTexture||this.hasNormalTexture?k.TextureCoordinateType.Default:k.TextureCoordinateType.None}get objectAndLayerIdColorInstanced(){return this.instanced}get discardInvisibleFragments(){return this.transparent}}
b.__decorate([g.parameter({count:d.AlphaDiscardMode.COUNT})],c.prototype,"alphaDiscardMode",void 0);b.__decorate([g.parameter({count:h.NormalsDoubleSidedMode.COUNT})],c.prototype,"doubleSidedMode",void 0);b.__decorate([g.parameter({count:e.PBRMode.COUNT})],c.prototype,"pbrMode",void 0);b.__decorate([g.parameter({count:d.CullFaceOptions.COUNT})],c.prototype,"cullFace",void 0);b.__decorate([g.parameter({count:n.NormalType.COUNT})],c.prototype,"normalType",void 0);b.__decorate([g.parameter({count:d.DepthTestFunction.COUNT})],
c.prototype,"customDepthTest",void 0);b.__decorate([g.parameter({count:p.EmissionSource.COUNT})],c.prototype,"emissionSource",void 0);b.__decorate([g.parameter()],c.prototype,"hasVertexColors",void 0);b.__decorate([g.parameter()],c.prototype,"hasSymbolColors",void 0);b.__decorate([g.parameter()],c.prototype,"hasVerticalOffset",void 0);b.__decorate([g.parameter()],c.prototype,"hasSlicePlane",void 0);b.__decorate([g.parameter()],c.prototype,"hasSliceHighlight",void 0);b.__decorate([g.parameter()],c.prototype,
"hasColorTexture",void 0);b.__decorate([g.parameter()],c.prototype,"hasMetallicRoughnessTexture",void 0);b.__decorate([g.parameter()],c.prototype,"hasOcclusionTexture",void 0);b.__decorate([g.parameter()],c.prototype,"hasNormalTexture",void 0);b.__decorate([g.parameter()],c.prototype,"hasScreenSizePerspective",void 0);b.__decorate([g.parameter()],c.prototype,"hasVertexTangents",void 0);b.__decorate([g.parameter()],c.prototype,"hasOccludees",void 0);b.__decorate([g.parameter()],c.prototype,"hasModelTransformation",
void 0);b.__decorate([g.parameter()],c.prototype,"offsetBackfaces",void 0);b.__decorate([g.parameter()],c.prototype,"vvSize",void 0);b.__decorate([g.parameter()],c.prototype,"vvColor",void 0);b.__decorate([g.parameter()],c.prototype,"receiveShadows",void 0);b.__decorate([g.parameter()],c.prototype,"receiveAmbientOcclusion",void 0);b.__decorate([g.parameter()],c.prototype,"textureAlphaPremultiplied",void 0);b.__decorate([g.parameter()],c.prototype,"instanced",void 0);b.__decorate([g.parameter()],c.prototype,
"instancedColor",void 0);b.__decorate([g.parameter()],c.prototype,"writeDepth",void 0);b.__decorate([g.parameter()],c.prototype,"transparent",void 0);b.__decorate([g.parameter()],c.prototype,"enableOffset",void 0);b.__decorate([g.parameter()],c.prototype,"terrainDepthTest",void 0);b.__decorate([g.parameter()],c.prototype,"cullAboveTerrain",void 0);b.__decorate([g.parameter()],c.prototype,"snowCover",void 0);b.__decorate([g.parameter()],c.prototype,"hasColorTextureTransform",void 0);b.__decorate([g.parameter()],
c.prototype,"hasEmissionTextureTransform",void 0);b.__decorate([g.parameter()],c.prototype,"hasNormalTextureTransform",void 0);b.__decorate([g.parameter()],c.prototype,"hasOcclusionTextureTransform",void 0);b.__decorate([g.parameter()],c.prototype,"hasMetallicRoughnessTextureTransform",void 0);a.DefaultMaterialTechniqueConfiguration=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/RealisticTreeTechnique":function(){define(["require","exports","../core/shaderTechnique/ReloadableShaderModule",
"./DefaultMaterialTechnique","../../../../chunks/RealisticTree.glsl"],function(a,b,n,k,p){class h extends k.DefaultMaterialTechnique{constructor(e,g,d){super(e,g,d,new n.ReloadableShaderModule(p.RealisticTree,()=>new Promise((f,c)=>a(["./RealisticTree.glsl"],f,c))));this.type="RealisticTreeTechnique"}}b.RealisticTreeTechnique=h;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/RealisticTree.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderLibrary/ForwardLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/Offset.glsl ../views/3d/webgl-engine/core/shaderLibrary/ShaderOutput ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/Transform.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/InstancedDoublePrecision.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/NormalAttribute.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/PositionAttribute.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/SymbolColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VertexColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VerticalOffset.glsl ../views/3d/webgl-engine/core/shaderLibrary/default/DefaultMaterialAuxiliaryPasses.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateAmbientOcclusion.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateSceneLighting.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MainLighting.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRendering.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ReadShadowMap.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/TerrainDepthTest.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/VisualVariables.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaCutoff ../views/3d/webgl-engine/core/shaderLibrary/util/DiscardOrAdjustAlpha.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/MixExternalColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/View.glsl ../views/3d/webgl-engine/core/shaderModules/Float3PassUniform ../views/3d/webgl-engine/core/shaderModules/Float4PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform ../views/3d/webgl-engine/lib/VertexAttribute ../views/3d/webgl-engine/shaders/OutputColorHighlightOID.glsl".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w,x,u,t,m,q,r,v,y,B,z,A,C,H,E,F,G,D,I,J,N,M){function Q(K){const L=new I.ShaderBuilder,{vertex:P,fragment:R,varyings:W}=L,{output:V,offsetBackfaces:ba,instancedColor:U,pbrMode:da,snowCover:fa,spherical:ha}=K,T=da===r.PBRMode.Normal||da===r.PBRMode.Schematic;H.addProjViewLocalOrigin(P,K);L.include(d.PositionAttribute);W.add("vpos","vec3");L.include(B.VisualVariables,K);L.include(e.InstancedDoublePrecision,K);L.include(w.VerticalOffset,K);V===k.ShaderOutput.Color&&(H.addCameraPosition(L.vertex,
K),L.include(g.NormalAttribute,K),L.include(h.Transform,K),ba&&L.include(n.Offset),U&&L.attributes.add(N.VertexAttribute.INSTANCECOLOR,"vec4"),W.add("vNormalWorld","vec3"),W.add("localvpos","vec3"),K.terrainDepthTest&&W.add("depth","float"),L.include(c.TextureCoordinateAttribute,K),L.include(b.ForwardLinearDepth,K),L.include(f.SymbolColor,K),L.include(l.VertexColor,K),P.uniforms.add(new F.Float4PassUniform("externalColor",S=>S.externalColor)),W.add("vcolorExt","vec4"),P.main.add(D.glsl`
      forwardNormalizedVertexColor();
      vcolorExt = externalColor;
      ${D.If(U,"vcolorExt *\x3d instanceColor * 0.003921568627451;")}
      vcolorExt *= vvColor();
      vcolorExt *= getSymbolColor();
      forwardColorMixMode();

      if (vcolorExt.a < ${D.glsl.float(z.alphaCutoff)}) {
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
      } else {
        vpos = getVertexInLocalOriginSpace();
        localvpos = vpos - view[3].xyz;
        vpos = subtractOrigin(vpos);
        vNormalWorld = dpNormal(vvLocalNormal(normalModel()));
        vpos = addVerticalOffset(vpos, localOrigin);
        gl_Position = transformPosition(proj, view, vpos);
        ${D.If(ba,"gl_Position \x3d offsetBackfacingClipPosition(gl_Position, vpos, vNormalWorld, cameraPosition);")}
      }
      ${D.If(K.terrainDepthTest,"depth \x3d (view * vec4(vpos, 1.0)).z;")}
      forwardLinearDepth();
      forwardTextureCoordinates();`));if(V===k.ShaderOutput.Color){const {hasColorTexture:S,hasColorTextureTransform:Z,receiveShadows:ia}=K;L.include(t.EvaluateSceneLighting,K);L.include(u.EvaluateAmbientOcclusion,K);L.include(A.DiscardOrAdjustAlphaPass,K);L.include(K.instancedDoublePrecision?v.ReadShadowMapPass:v.ReadShadowMapDraw,K);L.include(y.terrainDepthTest,K);L.include(p.SliceDraw,K);L.include(M.outputColorHighlightOID,K);H.addCameraPosition(L.fragment,K);m.addMainLightDirection(R);t.addAmbientBoostFactor(R);
t.addLightingGlobalFactor(R);R.uniforms.add(P.uniforms.get("localOrigin"),P.uniforms.get("view"),new E.Float3PassUniform("ambient",Y=>Y.ambient),new E.Float3PassUniform("diffuse",Y=>Y.diffuse),new G.FloatPassUniform("opacity",Y=>Y.opacity),new G.FloatPassUniform("layerOpacity",Y=>Y.layerOpacity));S&&R.uniforms.add(new J.Texture2DPassUniform("tex",Y=>Y.texture));L.include(r.PhysicallyBasedRenderingParameters,K);L.include(q.PhysicallyBasedRendering,K);R.include(C.MixExternalColor);m.addMainLightIntensity(R);
R.main.add(D.glsl`
      discardBySlice(vpos);
      ${D.If(K.terrainDepthTest,"terrainDepthTest(depth);")}
      vec4 texColor = ${S?`texture(tex, ${Z?"colorUV":"vuv0"})`:" vec4(1.0)"};
      ${D.If(S,`${D.If(K.textureAlphaPremultiplied,"texColor.rgb /\x3d texColor.a;")}\n        discardOrAdjustAlpha(texColor);`)}
      vec3 viewDirection = normalize(vpos - cameraPosition);
      applyPBRFactors();
      float ssao = evaluateAmbientOcclusionInverse();
      ssao *= getBakedOcclusion();

      float additionalAmbientScale = additionalDirectedAmbientLight(vpos + localOrigin);
      vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;
      float shadow = ${ia?"max(lightingGlobalFactor * (1.0 - additionalAmbientScale), readShadowMap(vpos, linearDepth))":ha?"lightingGlobalFactor * (1.0 - additionalAmbientScale)":"0.0"};
      vec3 matColor = max(ambient, diffuse);
      ${K.hasVertexColors?D.glsl`vec3 albedo = mixExternalColor(vColor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
             float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:D.glsl`vec3 albedo = mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
             float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}
      ${D.If(fa,"albedo \x3d mix(albedo, vec3(1), 0.9);")}
      ${D.glsl`vec3 shadingNormal = normalize(vNormalWorld);
             albedo *= 1.2;
             vec3 viewForward = vec3(view[0][2], view[1][2], view[2][2]);
             float alignmentLightView = clamp(dot(viewForward, -mainLightDirection), 0.0, 1.0);
             float transmittance = 1.0 - clamp(dot(viewForward, shadingNormal), 0.0, 1.0);
             float treeRadialFalloff = vColor.r;
             float backLightFactor = 0.5 * treeRadialFalloff * alignmentLightView * transmittance * (1.0 - shadow);
             additionalLight += backLightFactor * mainLightIntensity;`}
      ${D.If(T,`vec3 normalGround = ${ha?"normalize(vpos + localOrigin)":"vec3(0.0, 0.0, 1.0)"};`)}
      ${T?D.glsl`float additionalAmbientIrradiance = additionalAmbientIrradianceFactor * mainLightIntensity[2];
                 ${D.If(fa,D.glsl`mrr = vec3(0.0, 1.0, 0.04);`)}
            vec4 emission = ${fa?"vec4(0.0)":"getEmissions()"};
            vec3 shadedColor = evaluateSceneLightingPBR(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight, viewDirection, normalGround, mrr, emission, additionalAmbientIrradiance);`:D.glsl`vec3 shadedColor = evaluateSceneLighting(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight);`}
      vec4 finalColor = vec4(shadedColor, opacity_);
      outputColorHighlightOID(finalColor, vpos);`)}L.include(x.DefaultMaterialAuxiliaryPasses,K);return L}const O=Object.freeze(Object.defineProperty({__proto__:null,build:Q},Symbol.toStringTag,{value:"Module"}));a.RealisticTree=O;a.build=Q})},"esri/views/3d/layers/graphics/interfaces":function(){define(["exports"],function(a){a.ApplyRendererDiffResult=void 0;var b=a.ApplyRendererDiffResult||(a.ApplyRendererDiffResult={});b[b.RecreateSymbol=0]="RecreateSymbol";b[b.RecreateGraphics=1]="RecreateGraphics";
b[b.FastUpdate=2]="FastUpdate";Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Loadable":function(){define(["exports","../../../../core/maybe","../../../../core/promiseUtils"],function(a,b,n){class k{constructor(p){this.schedule=p;this._abortController=null;this._loadStatus=a.LoadStatus.LOADING;this.logger=this._loader=this._loadError=null}destroy(){this.abortLoad()}get loadStatus(){return this._loadStatus}load(p,h){if(this._loadStatus===a.LoadStatus.LOADED)return p&&
p(),this._loader??Promise.resolve();if(this._loadStatus===a.LoadStatus.FAILED)return h&&h(this._loadError),this._loader??Promise.resolve();null==this._loader&&(this._abortController=new AbortController,this._loader=this.doLoad(this._abortController.signal).then(()=>{this._abortController=null;this._loadStatus=a.LoadStatus.LOADED},e=>{this._loadError=e;this._abortController=null;this._loadStatus=a.LoadStatus.FAILED;!n.isAbortError(e)&&this.logger&&e.message&&this.logger.warn(e.message);throw e;}));
this._loader.then(p,h).catch(()=>{});return this._loader}abortLoad(){null!=this._abortController?this._abortController=b.abortMaybe(this._abortController):this._loadStatus===a.LoadStatus.LOADING&&(this._loadStatus=a.LoadStatus.FAILED);this._loader=null}}a.LoadStatus=void 0;(function(p){p[p.LOADING=0]="LOADING";p[p.LOADED=1]="LOADED";p[p.FAILED=2]="FAILED"})(a.LoadStatus||(a.LoadStatus={}));a.Loadable=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/pointUtils":function(){define("exports ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../geometry/projection/projectPointToVector ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/coordsUtils ../../../../layers/graphics/dehydratedPoint ./elevationAlignmentUtils ./graphicUtils ../../webgl-engine/lib/Object3D".split(" "),
function(a,b,n,k,p,h,e,g,d){function f(w,x){const u=w.clippingExtent;if(!u)return!1;n.projectPointToVector(x,l,w.elevationProvider.spatialReference);return!k.containsPoint(u,l)}function c(w,x){n.projectPointToVector(x,l,w.renderCoordsHelper.spatialReference);return w.localOriginFactory.getOrigin(l)}const l=b.create();a.createStageObject=function(w,x,u,t,m){if(f(w,x))return null;u.localOrigin=c(w,x);u=new d.Object3D({geometries:[u],castShadow:!1,layerUid:w.layer.uid,graphicUid:m,usesVerticalDistanceToGround:!0});
w=e.applyElevationAlignmentForHUD(u,x,w.elevationProvider,w.renderCoordsHelper,t);return{object:u,sampledElevation:w}};a.extendPointGraphicElevationContext=function(w,x,u){w=w.elevationContext;u=u.spatialReference;n.projectPointToVector(x,l,u);w.centerPointInElevationSR=h.makeDehydratedPoint(l[0],l[1],x.hasZ?l[2]:0,null!=u?u:null)};a.getLocalOriginForPoint=c;a.placePointOnGeometry=function(w){switch(w.type){case "point":return w;case "polygon":case "extent":return g.computeCentroid(w);case "polyline":var x=
w.paths[0];if(!x||0===x.length)break;x=p.getPointOnPath(x,p.getPathLength(x)/2);return h.makeDehydratedPoint(x[0],x[1],x[2],w.spatialReference);case "mesh":return w.extent.center}return null};a.updateStageObjectGeometry=function(w,x,u,t){return f(x,u)?null:e.applyElevationAlignmentForHUD(w,u,x.elevationProvider,x.renderCoordsHelper,t)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/Object3D":function(){define("exports ../../../../core/has ../../../../core/libs/gl-matrix-2/math/mat4 ../../../../core/libs/gl-matrix-2/factories/mat4f64 ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../chunks/sphere ../../support/mathUtils ./basicInterfaces ./ContentObject ./ContentObjectType ./Object3DStateID ./Util ./VertexAttribute ../materials/renderers/utils".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w,x,u){class t extends f.ContentObject{get geometries(){return this._geometries}get transformation(){return this._transformation??k.IDENTITY}set transformation(A){this._transformation=n.copy(this._transformation??k.create(),A);this._invalidateBoundingVolume();this._emit("transformationChanged",this)}get shaderTransformation(){return this._shaderTransformation}set shaderTransformation(A){this._shaderTransformation=A?n.copy(this._shaderTransformation??k.create(),A):
null;this._invalidateBoundingVolume();this._emit("shaderTransformationChanged",this)}get effectiveTransformation(){return this.shaderTransformation??this.transformation}constructor(A={}){super();this.type=c.ContentObjectType.Object;this._parentLayer=this._shaderTransformation=null;this._visible=!0;this.castShadow=A.castShadow??!0;this.usesVerticalDistanceToGround=A.usesVerticalDistanceToGround??!1;this.graphicUid=A.graphicUid;this.layerUid=A.layerUid;A.isElevationSource&&(this.lastValidElevationBB=
new m);this._geometries=A.geometries?Array.from(A.geometries):[]}dispose(){this._geometries.length=0}get parentLayer(){return this._parentLayer}set parentLayer(A){w.assert(null==this._parentLayer||null==A,"Object3D can only be added to a single Layer");this._parentLayer=A}addGeometry(A){A.visible=this._visible;this._geometries.push(A);this._emit("geometryAdded",{object:this,geometry:A});this._invalidateBoundingVolume()}removeGeometry(A){if(A=this._geometries.splice(A,1)[0])this._emit("geometryRemoved",
{object:this,geometry:A}),this._invalidateBoundingVolume()}removeAllGeometries(){for(;0<this._geometries.length;)this.removeGeometry(0)}geometryVertexAttributeUpdated(A,C,H=!1){this._emit("attributesChanged",{object:this,geometry:A,attribute:C,sync:H});x.affectsGeometry(C)&&this._invalidateBoundingVolume()}get visible(){return this._visible}set visible(A){if(this._visible!==A){this._visible=A;for(const C of this._geometries)C.visible=this._visible;this._emit("visibilityChanged",this)}}maskOccludee(){const A=
new l.Object3DOccludeeStateID;for(const C of this._geometries)C.occludees=u.addObject3DStateID(C.occludees,A);this._emit("occlusionChanged",this);return A}removeOcclude(A){for(const C of this._geometries)C.occludees=u.removeObject3DStateID(C.occludees,A);this._emit("occlusionChanged",this)}highlight(A){A=new l.Object3DHighlightStateID(A);for(const C of this._geometries)C.addHighlight(A);this._emit("highlightChanged",this);return A}removeHighlight(A){for(const C of this._geometries)C.removeHighlight(A);
this._emit("highlightChanged",this)}removeStateID(A){A.channel===d.Object3DState.Highlight?this.removeHighlight(A):this.removeOcclude(A)}getCombinedStaticTransformation(A,C){return n.multiply(C,this.transformation,A.transformation)}getCombinedShaderTransformation(A,C=k.create()){return n.multiply(C,this.effectiveTransformation,A.transformation)}get boundingVolumeWorldSpace(){this._bvWorldSpace||(this._bvWorldSpace=this._bvWorldSpace||new q,this._validateBoundingVolume(this._bvWorldSpace,z.WorldSpace));
return this._bvWorldSpace}get boundingVolumeObjectSpace(){this._bvObjectSpace||(this._bvObjectSpace=this._bvObjectSpace||new q,this._validateBoundingVolume(this._bvObjectSpace,z.ObjectSpace));return this._bvObjectSpace}_validateBoundingVolume(A,C){C=C===z.ObjectSpace;for(var H of this._geometries){var E=H.boundingInfo;if(E){var F=A,G=C?H.transformation:this.getCombinedShaderTransformation(H),D=E.bbMin;E=E.bbMax;if(n.hasIdentityRotation(G))for(G=p.set(r,G[12],G[13],G[14]),p.add(v,D,G),p.add(y,E,G),
D=0;3>D;++D)F.min[D]=Math.min(F.min[D],v[D]),F.max[D]=Math.max(F.max[D],y[D]);else if(p.transformMat4(v,D,G),p.exactEquals(D,E))for(D=0;3>D;++D)F.min[D]=Math.min(F.min[D],v[D]),F.max[D]=Math.max(F.max[D],v[D]);else{p.transformMat4(y,E,G);for(var I=0;3>I;++I)F.min[I]=Math.min(F.min[I],v[I],y[I]),F.max[I]=Math.max(F.max[I],v[I],y[I]);for(I=0;3>I;++I){p.copy(v,D);p.copy(y,E);v[I]=E[I];y[I]=D[I];p.transformMat4(v,v,G);p.transformMat4(y,y,G);for(let J=0;3>J;++J)F.min[J]=Math.min(F.min[J],v[J],y[J]),F.max[J]=
Math.max(F.max[J],v[J],y[J])}}}}p.lerp(e.getCenter(A.bounds),A.min,A.max,.5);for(const J of this._geometries)H=J.boundingInfo,null!=H&&(D=C?J.transformation:this.getCombinedShaderTransformation(J),F=g.maxScale(D),p.transformMat4(B,H.center,D),D=p.distance(B,e.getCenter(A.bounds)),A.bounds[3]=Math.max(A.bounds[3],D+H.radius*F))}_invalidateBoundingVolume(){const A=this._bvWorldSpace?.bounds;this._bvObjectSpace=this._bvWorldSpace=void 0;this._parentLayer&&A&&this._parentLayer.notifyObjectBBChanged(this,
A)}_emit(A,C){this._parentLayer&&this._parentLayer.events.emit(A,C)}get test(){}}class m{constructor(){this.min=h.fromValues(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE);this.max=h.fromValues(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE)}isEmpty(){return this.max[0]<this.min[0]&&this.max[1]<this.min[1]&&this.max[2]<this.min[2]}}class q extends m{constructor(){super(...arguments);this.bounds=e.create()}}const r=h.create(),v=h.create(),y=h.create(),B=h.create();var z;(function(A){A[A.WorldSpace=
0]="WorldSpace";A[A.ObjectSpace=1]="ObjectSpace"})(z||={});a.Object3D=t;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/renderers/utils":function(){define(["exports","../../../../../core/libs/gl-matrix-2/factories/vec3f64","../../../../webgl/doublePrecisionUtils"],function(a,b,n){const k=b.create(),p=new Float32Array(6);a.addObject3DStateID=function(h,e){null==h&&(h=[]);h.push(e);return h};a.encodeDoubleVec3=function(h,e,g,d,f){k[0]=h.get(e,0);
k[1]=h.get(e,1);k[2]=h.get(e,2);n.encodeDoubleArray(k,p,3);g.set(f,0,p[0]);d.set(f,0,p[1]);g.set(f,1,p[2]);d.set(f,1,p[3]);g.set(f,2,p[4]);d.set(f,2,p[5])};a.removeObject3DStateID=function(h,e){if(null==h)return null;h=h.filter(g=>g!==e);return 0===h.length?null:h};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/LineCalloutMaterial":function(){define("exports ../../../../core/string ../../../../core/libs/gl-matrix-2/factories/vec2f32 ../../../../core/libs/gl-matrix-2/factories/vec4f64 ../../support/buffer/InterleavedLayout ../core/shaderLibrary/ShaderOutput ../core/shaderLibrary/util/AlphaCutoff ../lib/GLMaterial ../lib/Material ../lib/RenderSlot ../lib/VertexAttribute ./internal/bufferWriterUtils ../shaders/LineCalloutTechnique ../shaders/LineCalloutTechniqueConfiguration".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w,x){function u({renderOccluded:B,isDecoration:z,horizontalScreenOffset:A,color:C,size:H,occlusionTest:E,shaderPolygonOffset:F,hudDepthAlignStart:G,centerOffsetUnits:D,hasSlicePlane:I,screenSizePerspective:J,verticalOffset:N,borderColor:M}){return b.safeToString`${B}:${z}:${A}:[${C}]:${H}:${E}:${F}:${G}:${D}:${I}:${null!=J}:{${N.screenLength}:${N.minWorldLength}:${N.maxWorldLength}}:[${M}]`}class t extends d.Material{constructor(B,z){super(B,q);this.produces=new Map([[f.RenderSlot.LINE_CALLOUTS,
A=>A===h.ShaderOutput.Color],[f.RenderSlot.LINE_CALLOUTS_HUD_DEPTH,A=>A===h.ShaderOutput.Color]]);this._configuration=new x.LineCalloutTechniqueConfiguration(z);this._uniqueMaterialIdentifier=u(this.parameters)}passParameters(){return this.parameters}getConfiguration(B,z){B=z.slot===f.RenderSlot.LINE_CALLOUTS_HUD_DEPTH;this._configuration.occlusionTestEnabled=this.parameters.occlusionTest;this._configuration.hasVerticalOffset=null!=this.parameters.verticalOffset;this._configuration.hasScreenSizePerspective=
null!=this.parameters.screenSizePerspective;this._configuration.hudDepth=B;this._configuration.hudDepthAlignStart=!!this.parameters.hudDepthAlignStart;this._configuration.screenCenterOffsetUnitsEnabled="screen"===this.parameters.centerOffsetUnits;this._configuration.hasSlicePlane=this.parameters.hasSlicePlane;this._configuration.terrainDepthTest=z.terrainDepthTest;return this._configuration}get visible(){return this.parameters.color[3]>=e.alphaCutoff||(this.parameters.borderColor?.[3]??0)>=e.alphaCutoff}intersect(){}createGLMaterial(B){return new m(B)}createBufferWriter(){return new y}validateParameters(B){this._uniqueMaterialIdentifier=
u(B)}get uniqueMaterialIdentifier(){return this._uniqueMaterialIdentifier}}class m extends g{beginSlot(B){return this.acquireTechnique(w.LineCalloutTechnique,B)}}class q extends d.MaterialParameters{constructor(){super(...arguments);this.horizontalScreenOffset=0;this.color=k.fromValues(0,0,0,1);this.size=1;this.occlusionTest=!1;this.shaderPolygonOffset=1E-5;this.hudDepthAlignStart=!1;this.centerOffsetUnits="world";this.hasSlicePlane=!1}}const r=p.newLayout().vec3f(c.VertexAttribute.POSITION).vec3f(c.VertexAttribute.NORMAL).vec2f(c.VertexAttribute.UV0).vec4f(c.VertexAttribute.CENTEROFFSETANDDISTANCE),
v=[n.fromValues(0,0),n.fromValues(1,0),n.fromValues(0,1),n.fromValues(1,0),n.fromValues(1,1),n.fromValues(0,1)];class y{constructor(){this.vertexBufferLayout=r}elementCount(B){return 6*B.get(c.VertexAttribute.POSITION).indices.length}write(B,z,A,C,H,E){l.writePosition(A.get(c.VertexAttribute.POSITION),B,H.position,E,6);l.writeNormal(A.get(c.VertexAttribute.NORMAL),z,H.normal,E,6);l.writeBufferVec4(A.get(c.VertexAttribute.CENTEROFFSETANDDISTANCE),H.centerOffsetAndDistance,E,6);for(B=0;B<v.length;++B)H.uv0.setVec(E+
B,v[B])}}a.LineCalloutMaterial=t;a.Parameters=q;a.uniqueMaterialIdentifier=u;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/libs/gl-matrix-2/factories/vec2f32":function(){define(["exports"],function(a){function b(){return new Float32Array(2)}function n(u){const t=new Float32Array(2);t[0]=u[0];t[1]=u[1];return t}function k(u,t){const m=new Float32Array(2);m[0]=u;m[1]=t;return m}function p(u,t){return new Float32Array(u,t,2)}function h(){return b()}function e(){return k(1,
1)}function g(){return k(1,0)}function d(){return k(0,1)}const f=b(),c=e(),l=g(),w=d(),x=Object.freeze(Object.defineProperty({__proto__:null,ONES:c,UNIT_X:l,UNIT_Y:w,ZEROS:f,clone:n,create:b,createView:p,fromValues:k,ones:e,unitX:g,unitY:d,zeros:h},Symbol.toStringTag,{value:"Module"}));a.ONES=c;a.UNIT_X=l;a.UNIT_Y=w;a.ZEROS=f;a.clone=n;a.create=b;a.createView=p;a.fromValues=k;a.ones=e;a.unitX=g;a.unitY=d;a.vec2f32=x;a.zeros=h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/LineCalloutTechnique":function(){define("require exports ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../../../../chunks/LineCallout.glsl ../../../webgl/enums ../../../webgl/renderState".split(" "),
function(a,b,n,k,p,h,e){class g extends k.ShaderTechnique{constructor(d,f,c){super(d,f,new n.ReloadableShaderModule(p.LineCallout,()=>new Promise((l,w)=>a(["./LineCallout.glsl"],l,w))),c)}initializePipeline(d){const f={func:d.terrainDepthTest?h.CompareFunction.ALWAYS:h.CompareFunction.LESS};return e.makePipelineState(d.hudDepth?{depthTest:f,depthWrite:e.defaultDepthWrite}:{blending:e.separateBlendingParams(h.BlendFactor.ONE,h.BlendFactor.SRC_ALPHA,h.BlendFactor.ONE_MINUS_SRC_ALPHA,h.BlendFactor.ONE_MINUS_SRC_ALPHA),
depthTest:f,colorWrite:e.defaultColorWrite})}}b.LineCalloutTechnique=g;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/LineCallout.glsl":function(){define("exports ../core/libs/gl-matrix-2/math/vec2 ../core/libs/gl-matrix-2/factories/vec2f64 ../core/libs/gl-matrix-2/factories/vec4f64 ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/hud/AlignPixel.glsl ../views/3d/webgl-engine/core/shaderLibrary/hud/HUD.glsl ../views/3d/webgl-engine/core/shaderLibrary/hud/HUDVisibility.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MultipassGeometryTest.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/ScreenSizePerspective.glsl ../views/3d/webgl-engine/core/shaderModules/Float2PassUniform ../views/3d/webgl-engine/core/shaderModules/Float4PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w,x,u,t){function m(r){const v=new u.ShaderBuilder,{vertex:y,fragment:B}=v,{terrainDepthTest:z}=r;y.include(h.AlignPixel);v.include(e.HUD,r);v.include(p.SliceDraw,r);v.attributes.add(t.VertexAttribute.UV0,"vec2");y.uniforms.add(new l.Float4PassUniform("viewport",(A,C)=>C.camera.fullViewport),new w.FloatPassUniform("lineSize",(A,C)=>0<A.size?Math.max(1,A.size)*C.camera.pixelRatio:0),new c.Float2PassUniform("pixelToNDC",(A,C)=>b.set(q,2/C.camera.fullViewport[2],2/C.camera.fullViewport[3])),
new w.FloatPassUniform("borderSize",(A,C)=>A.borderColor?C.camera.pixelRatio:0),new c.Float2PassUniform("screenOffset",(A,C)=>b.set(q,A.horizontalScreenOffset*C.camera.pixelRatio,0)));v.varyings.add("coverageSampling","vec4");v.varyings.add("lineSizes","vec2");z&&v.varyings.add("depth","float");r.occlusionTestEnabled&&v.include(g.HUDVisibility);r.hasScreenSizePerspective&&f.addScreenSizePerspectiveAlignment(y);y.main.add(x.glsl`
    ProjectHUDAux projectAux;
    vec4 endPoint = projectPositionHUD(projectAux);

    vec3 vpos = projectAux.posModel;
    if (rejectBySlice(vpos)) {
      gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
      return;
    }
    ${x.If(r.occlusionTestEnabled,x.glsl`if (!testHUDVisibility(endPoint)) {
             gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
             return;
           }`)}

    ${r.hasScreenSizePerspective?x.glsl`vec3 perspectiveFactor = screenSizePerspectiveScaleFactor(projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);
               vec2 screenOffsetScaled = applyScreenSizePerspectiveScaleFactorVec2(screenOffset, perspectiveFactor);`:"vec2 screenOffsetScaled \x3d screenOffset;"}
    // Add view dependent polygon offset to get exact same original starting point. This is mostly used to get the
    // correct depth value
    vec3 posView = (view * vec4(position, 1.0)).xyz;
    ${x.If(z,"depth \x3d posView.z;")}

    applyHUDViewDependentPolygonOffset(centerOffsetAndDistance.w, projectAux.absCosAngle, posView);
    vec4 startPoint = proj * vec4(posView, 1.0);

    // Apply screen offset to both start and end point
    vec2 screenOffsetNorm = screenOffsetScaled * 2.0 / viewport.zw;
    startPoint.xy += screenOffsetNorm * startPoint.w;
    endPoint.xy += screenOffsetNorm * endPoint.w;

    // Align start and end to pixel origin
    vec4 startAligned = alignToPixelOrigin(startPoint, viewport.zw);
    vec4 endAligned = alignToPixelOrigin(endPoint, viewport.zw);
    ${x.If(r.hudDepth,r.hudDepthAlignStart?"endAligned \x3d vec4(endAligned.xy / endAligned.w * startAligned.w, startAligned.zw);":"startAligned \x3d vec4(startAligned.xy / startAligned.w * endAligned.w, endAligned.zw);")}
    vec4 projectedPosition = mix(startAligned, endAligned, uv0.y);

    // The direction of the line in screen space
    vec2 screenSpaceDirection = normalize(endAligned.xy / endAligned.w - startAligned.xy / startAligned.w);
    vec2 perpendicularScreenSpaceDirection = vec2(screenSpaceDirection.y, -screenSpaceDirection.x);
    ${r.hasScreenSizePerspective?x.glsl`float lineSizeScaled = applyScreenSizePerspectiveScaleFactorFloat(lineSize, perspectiveFactor);
               float borderSizeScaled = applyScreenSizePerspectiveScaleFactorFloat(borderSize, perspectiveFactor);`:x.glsl`float lineSizeScaled = lineSize;
               float borderSizeScaled = borderSize;`}
    float halfPixelSize = lineSizeScaled * 0.5;

    // Compute full ndc offset, adding 1px padding for doing anti-aliasing and the border size
    float padding = 1.0 + borderSizeScaled;
    vec2 ndcOffset = (-halfPixelSize - padding + uv0.x * (lineSizeScaled + padding + padding)) * pixelToNDC;

    // Offset x/y from the center of the line in screen space
    projectedPosition.xy += perpendicularScreenSpaceDirection * ndcOffset * projectedPosition.w;

    // Compute a coverage varying which we can use in the fragment shader to determine
    // how much a pixel is actually covered by the line (i.e. to anti alias the line).
    // This works by computing two coordinates that can be linearly interpolated and then
    // subtracted to find out how far away from the line edge we are.
    float edgeDirection = (uv0.x * 2.0 - 1.0);

    float halfBorderSize = 0.5 * borderSizeScaled;
    float halfPixelSizeAndBorder = halfPixelSize + halfBorderSize;
    float outerEdgeCoverageSampler = edgeDirection * (halfPixelSizeAndBorder + halfBorderSize + 1.0);

    float isOneSided = float(lineSizeScaled < 2.0 && borderSize < 2.0);

    coverageSampling = vec4(
      // Edge coordinate
      outerEdgeCoverageSampler,

      // Border edge coordinate
      outerEdgeCoverageSampler - halfPixelSizeAndBorder * isOneSided,

      // Line offset
      halfPixelSize - 0.5,

      // Border offset
      halfBorderSize - 0.5 + halfPixelSizeAndBorder * (1.0 - isOneSided)
    );

    lineSizes = vec2(lineSizeScaled, borderSizeScaled);
    gl_Position = projectedPosition;`);B.uniforms.add(new l.Float4PassUniform("uColor",A=>A.color??k.ZEROS),new l.Float4PassUniform("borderColor",A=>A.borderColor??k.ZEROS));z&&(B.include(d.multipassGeometryTest,r),B.uniforms.add(new c.Float2PassUniform("inverseViewport",(A,C)=>C.inverseViewport)));B.main.add(x.glsl`
    ${x.If(z,"if( geometryDepthTest(gl_FragCoord.xy * inverseViewport, depth) ){ discard; }")}

    vec2 coverage = min(1.0 - clamp(abs(coverageSampling.xy) - coverageSampling.zw, 0.0, 1.0), lineSizes);

    float borderAlpha = uColor.a * borderColor.a * coverage.y;
    float colorAlpha = uColor.a * coverage.x;

    float finalAlpha = mix(borderAlpha, 1.0, colorAlpha);
    ${x.If(!r.hudDepth,x.glsl`vec3 finalRgb = mix(borderColor.rgb * borderAlpha, uColor.rgb, colorAlpha);
           fragColor = vec4(finalRgb, finalAlpha);`)}`);return v}const q=n.create();n=Object.freeze(Object.defineProperty({__proto__:null,build:m},Symbol.toStringTag,{value:"Module"}));a.LineCallout=n;a.build=m})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/MultipassGeometryTest.glsl":function(){define(["exports","../output/ReadDepth.glsl","../../shaderModules/interfaces","../../shaderModules/Texture2DPassUniform"],function(a,b,n,k){a.multipassGeometryTest=function(p){p.include(b.ReadDepth);
p.uniforms.add(new k.Texture2DPassUniform("geometryDepthTexture",(h,e)=>e.geometryDepth?.attachment));p.code.add(n.glsl`bool geometryDepthTest(vec2 pos, float elementDepth) {
float geometryDepth = linearDepthFromTexture(geometryDepthTexture, pos);
return (elementDepth < (geometryDepth - 1.0));
}`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/LineCalloutTechniqueConfiguration":function(){define(["exports","../../../../chunks/tslib.es6","../core/shaderTechnique/ShaderTechniqueConfiguration","../materials/DefaultTechniqueConfiguration"],function(a,b,n,k){class p extends k.DefaultTechniqueConfiguration{constructor(h){super();this.spherical=h;this.screenCenterOffsetUnitsEnabled=!1;this.occlusionTestEnabled=!0;this.terrainDepthTest=this.hasSlicePlane=
this.hudDepthAlignStart=this.hudDepth=this.hasScreenSizePerspective=this.hasVerticalOffset=!1;this.hasSliceInVertexProgram=!0;this.draped=!1}}b.__decorate([n.parameter()],p.prototype,"screenCenterOffsetUnitsEnabled",void 0);b.__decorate([n.parameter()],p.prototype,"occlusionTestEnabled",void 0);b.__decorate([n.parameter()],p.prototype,"hasVerticalOffset",void 0);b.__decorate([n.parameter()],p.prototype,"hasScreenSizePerspective",void 0);b.__decorate([n.parameter()],p.prototype,"hudDepth",void 0);
b.__decorate([n.parameter()],p.prototype,"hudDepthAlignStart",void 0);b.__decorate([n.parameter()],p.prototype,"hasSlicePlane",void 0);b.__decorate([n.parameter()],p.prototype,"terrainDepthTest",void 0);a.LineCalloutTechniqueConfiguration=p;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/graphicSymbolUtils":function(){define(["exports","./Graphics3DSymbol","./Graphics3DWebStyleSymbol"],function(a,b,n){a.getGraphics3DSymbol=function(k){return k instanceof
n.Graphics3DWebStyleSymbol?k.graphics3DSymbol:k instanceof b.Graphics3DSymbol?k:null};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DSymbol":function(){define("require exports ../../../../core/arrayUtils ../../../../core/asyncUtils ../../../../core/has ../../../../core/promiseUtils ./defaultSymbolComplexity ./Graphics3DGraphic ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolCreationContext ./interfaces ./Loadable".split(" "),function(a,
b,n,k,p,h,e,g,d,f,c,l){class w extends l.Loadable{set symbol(u){this._symbol=u;u.symbolLayers.forEach((t,m)=>{m=this.symbolLayers[m];null!=m&&(m.symbol=u,m.symbolLayer=t)})}get symbol(){return this._symbol}constructor(u,t,m){super(t.schedule);this._symbol=u;this._context=t;this._backgroundLayers=m;this._destroyed=!1;this.symbolLayers=[];this._extentPadding=this.referenced=0}async doLoad(u){let t=this._symbol.symbolLayers;this._extentPadding=0;this._backgroundLayers&&(t=this._backgroundLayers.concat(t));
const m=t.length;for(;this.symbolLayers.length<t.length;)this.symbolLayers.push(null);this.symbolLayers.length=t.length;const q=[],{make:r}=await new Promise((y,B)=>a(["./Graphics3DSymbolLayerFactory"],y,B));for(let y=0;y<m;y++){var v=t.at(y);if(!1===v.enabled)continue;x.renderPriority=1-(1+y)/m;x.renderPriorityStep=1/m;x.ignoreDrivers=v.ignoreDrivers;const B=r(this.symbol,v,this._context,x);(v=h.onAbortOrThrow(u,()=>{this.symbolLayers[y]=null;B.destroy()}))&&q.push(v);this.symbolLayers[y]=B}await k.forEach(this.symbolLayers,
async(y,B)=>{if(null!=y)try{await y.load(),this._extentPadding+=Math.max(this._extentPadding,y.extentPadding)}catch{this.symbolLayers[B]=null}});q.forEach(y=>y.remove());h.throwIfAborted(u);if(this.symbolLayers.length&&!this.symbolLayers.some(y=>!!y))throw Error();}getSymbolLayerSize(u){u=this.symbolLayers[u];return null!=u?u.getCachedSize():null}get extentPadding(){return this._extentPadding}get symbologySnappingSupported(){return this.symbolLayers.some(u=>u?.queryForSnapping)}createGraphics3DGraphic(u,
t){const m=u.graphic,q=this.symbolLayers.map(r=>r?.createGraphics3DGraphic(u)??null);return new g.Graphics3DGraphic(m,t||this,q,u.layer,this._context.arcade||this._context.featureExpressionInfoContext?.arcade?.modules||null)}get complexity(){return e.totalSymbolComplexities(this.symbolLayers.map(u=>null!=u?u.complexity:null))}globalPropertyChanged(u,t){const m=this.symbolLayers.length;for(let q=0;q<m;q++){const r=this.symbolLayers[q],v=y=>{y=y.layers[q];return y instanceof d.Graphics3DObject3DGraphicLayer?
y:null};if(null!=r&&!r.globalPropertyChanged(u,t,v))return!1}return!0}applyRendererDiff(u,t){return this.loadStatus!==l.LoadStatus.LOADED?c.ApplyRendererDiffResult.RecreateSymbol:this.symbolLayers.reduce((m,q)=>m!==c.ApplyRendererDiffResult.RecreateSymbol&&null!=q?Math.min(m,q.applyRendererDiff(u,t)):m,c.ApplyRendererDiffResult.FastUpdate)}prepareSymbolPatch(u){if(this.loadStatus!==l.LoadStatus.FAILED&&"partial"===u.diff.type){var t=u.diff.diff;if(t.symbolLayers&&"partial"===t.symbolLayers.type){var m=
t.symbolLayers.diff;this.symbolLayers.forEach((q,r)=>{if(null!=q){var v=m[r];if(v){const y={diff:v,graphics3DGraphicPatches:[],symbolLayerStatePatches:[]};q.prepareSymbolLayerPatch(y);u.symbolStatePatches.push(...y.symbolLayerStatePatches);y.graphics3DGraphicPatches.length&&u.graphics3DGraphicPatches.push((B,z)=>{const A=B.layers[r];null!=A&&y.graphics3DGraphicPatches.forEach(C=>C(A,z))})}}})}}}updateGeometry(u,t){return this._updateGeometryOrTransform(u,(m,q)=>m.updateGeometry(q,t))}updateTransform(u,
t,m,q){return this._updateGeometryOrTransform(u,(r,v)=>r.updateTransform(v,t,m,q))}_updateGeometryOrTransform(u,t){for(let m=0;m<this.symbolLayers.length;m++){const q=this.symbolLayers[m];if(null==q)continue;const r=u.layers[m];if(!r||!t(q,r))return!1}return!0}onRemoveGraphic(u){for(let t=0;t<this.symbolLayers.length;t++){const m=this.symbolLayers[t];if(null==m)continue;const q=u.layers[t];if(null!=q)m.onRemoveGraphic(q)}}getFastUpdateStatus(){let u=0,t=0,m=0;this.symbolLayers.forEach(q=>{null!=q&&
(q.loadStatus===l.LoadStatus.LOADING?u++:q.isFastUpdatesEnabled()?m++:t++)});return{loading:u,slow:t,fast:m}}async queryForSnapping(u,t,m,q){var r=this.symbolLayers.filter(n.isSome).filter(v=>null!=v.queryForSnapping).map(v=>v.queryForSnapping(u,t,m,q));r=await Promise.all(r);h.throwIfAborted(q);return r.flat()}destroy(){if(!this.destroyed){super.destroy();for(const u of this.symbolLayers)null!=u&&u.destroy();this.symbolLayers.length=0;this._destroyed=!0}}get destroyed(){return this._destroyed}}const x=
new f.Graphics3DSymbolLayerCreationContext;b.Graphics3DSymbol=w;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DGraphic":function(){define("exports ../../../../core/arrayUtils ../../../../core/asyncUtils ../../../../core/byteSizeEstimations ../../../../core/has ../../../../core/ObjectPool ../../../../core/libs/gl-matrix-2/math/vec2 ../../../../core/libs/gl-matrix-2/factories/vec2f64 ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../geometry/Polygon ../../../../geometry/projection/projectBoundingRect ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/aaBoundingRect ../../../../geometry/support/spatialReferenceUtils ../../../../layers/graphics/dehydratedFeatures ../../../../layers/graphics/featureConversionUtils ./enums ./featureExpressionInfoUtils".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w,x,u,t,m,q,r){const v=new h(Array,z=>w.set(z,w.zero),null,10,5),y=x.create();class B{get labelLayers(){return this._labelLayers||b.emptyArray}get extent(){return this._extent}get isElevationSource(){return this.layers.some(z=>z?.isElevationSource)}constructor(z,A,C,H,E){this.graphic=z;this.graphics3DSymbol=A;this.layers=C;this._visibleFlags=q.VisibilityFlag.ALL_LABEL;this.deconflictionPriority=0;++A.referenced;this._featureExpressionFeature=E?r.createFeature(E,z,
H):null}initialize(z){this._layer=z;this._forEachSymbolLayerGraphic(A=>{A.initialize(z);A.setVisibility(this.isVisible())})}destroy(){this._forEachSymbolLayerGraphic(z=>z.destroy());this._calloutLayer=null;--this.graphics3DSymbol.referenced;this.graphics3DSymbol=null}get destroyed(){return null==this.layers}clearLabelGraphics(){this._forEachLabelGraphic(z=>z.destroy());this._labelLayers=null}addLabelGraphic(z,A){this._labelLayers||(this._labelLayers=[]);this._labelLayers.push(z);z.initialize(A);z.setVisibility(this.isVisible(q.VisibilityGroup.LABEL))}setCalloutGraphic(z){this._calloutLayer=
z;this._layer&&(z.initialize(this._layer),z.setVisibility(this.isVisible()))}get calloutLayer(){return this._calloutLayer}get isDraped(){let z=!1;this._forEachSymbolLayerGraphic(A=>{"draped"===A.type&&(z=!0)});return z}isVisible(z=q.VisibilityGroup.GRAPHIC,A){A=A?this._visibleFlags|A|q.VisibilityGroup.LABEL*A:this._visibleFlags;return z===q.VisibilityGroup.GRAPHIC?(A&q.VisibilityFlag.ALL_GRAPHIC)===q.VisibilityFlag.ALL_GRAPHIC:(A&q.VisibilityFlag.ALL_LABEL)===q.VisibilityFlag.ALL_LABEL}setVisibilityFlag(z,
A,C){const H=this.isVisible(z);this._visibleFlags=C?this._visibleFlags|z*A:this._visibleFlags&~(z*A);const E=this.isVisible(z);if(H===E)return!1;if(z===q.VisibilityGroup.LABEL)this._forEachLabelGraphic(F=>F.setVisibility(E));else{this._forEachSymbolLayerGraphic(G=>G.setVisibility(E));const F=this.isVisible(q.VisibilityGroup.LABEL);this._forEachLabelGraphic(G=>G.setVisibility(F))}return!0}getVisibilityFlag(z,A){return 0!==(this._visibleFlags&z*A)}computeExtent(z){if(!this._extent){var A=this.graphic.geometry;
if(null==A)return!1;this._extent=x.create();t.computeAABR(A,this._extent);A=A.spatialReference;if(!u.equals(A,z)&&!l.projectBoundingRect(this._extent,A,this._extent,z))return this._extent=null,!1}return!0}getAsOptimizedGeometry(z,A){this._optimizedGeometry||(this._optimizedGeometry=this._convertGraphicToOptimizedGeometry(this.graphic,z,A));return this._optimizedGeometry}_convertGraphicToOptimizedGeometry(z,A,C){z=z.geometry;if("mesh"===z.type||"extent"===z.type)z=c.fromExtent("mesh"===z.type?z.extent:
z);return m.convertFromGeometry(z,A,C)}get usedMemory(){let z=k.estimateAttributesObjectSize(this.graphic.attributes);this._forEachSymbolLayerGraphic(A=>z+=A.graphics3DSymbolLayer.usedMemory);return z}computeAttachmentOrigin(){const z={render:{origin:f.create(),num:0},draped:{origin:g.create(),num:0}};for(const A of this.layers)null!=A&&A.computeAttachmentOrigin(z);1<z.render.num&&d.scale(z.render.origin,z.render.origin,1/z.render.num);1<z.draped.num&&e.scale(z.draped.origin,z.draped.origin,1/z.draped.num);
return z}async getProjectedBoundingBox(z,A,C,H,E){E||={boundingBox:null,requiresDrapedElevation:!1,screenSpaceObjects:[]};E.boundingBox?w.empty(E.boundingBox):E.boundingBox=w.empty();E.requiresDrapedElevation=!1;await n.forEach(this.layers,async F=>{if(null!=F){var G="draped"===F.type?A:z,D=v.acquire();F=await F.getProjectedBoundingBox(G,C,E.screenSpaceObjects,H,D);isFinite(F[2])&&isFinite(F[5])||(E.requiresDrapedElevation=!0);F&&w.expandWithAABB(E.boundingBox,D);v.release(D)}});return w.allFinite(E.boundingBox)||
x.allFinite(w.toRect(E.boundingBox,y))?E:null}needsElevationUpdates(){for(const z of this.layers)if(null!=z&&("object3d"===z.type||"lod-instance"===z.type)&&z.needsElevationUpdates)return!0;return this._labelLayers?.some(z=>z?.needsElevationUpdates??!1)??!1}alignWithElevation(z,A,C){this._forEachRenderedGraphic(H=>{"object3d"!==H.type&&"lod-instance"!==H.type||H.alignWithElevation(z,A,this._featureExpressionFeature,C)})}alignWithAbsoluteElevation(z,A,C){this._forEachRenderedGraphic(H=>{"object3d"===
H.type&&H.alignWithAbsoluteElevation(z,A,C)})}addObjectStateSet(z){this._forEachSymbolLayerGraphic(A=>A.addObjectState(z))}removeObjectState(z){this._forEachSymbolLayerGraphic(A=>A.removeObjectState(z))}_forEachGraphicList(z,A){z?.forEach(C=>C&&A(C))}_forEachSymbolLayerGraphic(z){this._forEachGraphicList(this.layers,z);this._calloutLayer&&z(this._calloutLayer)}_forEachLabelGraphic(z){this._forEachGraphicList(this._labelLayers,z)}_forEachRenderedGraphic(z){this._forEachSymbolLayerGraphic(z);this._forEachLabelGraphic(z)}get test(){}}
a.Graphics3DGraphic=B;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/dehydratedFeatures":function(){define("exports ../../core/byteSizeEstimations ../../core/has ../../core/typedArrayUtil ../../core/uid ../../geometry/SpatialReference ../../geometry/support/aaBoundingBox ../../geometry/support/aaBoundingRect ../../geometry/support/quantizationUtils ../../geometry/support/typeUtils ../support/Field ./dehydratedFeatureComparison".split(" "),function(a,b,n,k,p,
h,e,g,d,f,c,l){function w(v,y,B,z){return{uid:p.generateUID(),objectId:z&&v.attributes?v.attributes[z]:null,attributes:v.attributes,geometry:x(v.geometry,y,B),visible:!0}}function x(v,y,B){if(null==v)return null;switch(y){case "point":return{x:v.x,y:v.y,z:v.z,m:v.m,hasZ:null!=v.z,hasM:null!=v.m,type:"point",spatialReference:B};case "polyline":return{paths:v.paths,hasZ:!!v.hasZ,hasM:!!v.hasM,type:"polyline",spatialReference:B};case "polygon":return{rings:v.rings,hasZ:!!v.hasZ,hasM:!!v.hasM,type:"polygon",
spatialReference:B};case "multipoint":return{points:v.points,hasZ:!!v.hasZ,hasM:!!v.hasM,type:"multipoint",spatialReference:B}}}function u(v){if(null==v)return 0;let y=32;switch(v.type){case "point":y+=42;break;case "polyline":case "polygon":var B=0;const z=2+(v.hasZ?1:0)+(v.hasM?1:0);v="polyline"===v.type?v.paths:v.rings;for(const A of v)B+=A.length;y+=8*B*z+64;y+=128*B;y=y+34+32*(v.length+1);break;case "multipoint":B=v.points.length;y+=8*B*(2+(v.hasZ?1:0)+(v.hasM?1:0))+64;y+=128*B;y=y+34+32;break;
case "extent":y+=98;v.hasM&&(y+=32);v.hasZ&&(y+=32);break;case "mesh":y+=k.estimateSize(v.vertexAttributes.position,v.vertexAttributes.normal,v.vertexAttributes.uv,v.vertexAttributes.tangent)}return y}function t(v,y){return null!=v.objectId?v.objectId:v.attributes&&y?v.attributes[y]:null}function m(v,y,B,z){if(y?.size&&null!=B&&v)for(const A in v){if(!y.has(A))continue;const C=v[A];"string"===typeof C&&C.length>B&&(z(A),v[A]="")}}class q{constructor(v,y,B){this.uid=v;this.geometry=y;this.attributes=
B;this.visible=!0;this.centroid=this.objectId=null}}class r{constructor(){this.exceededTransferLimit=!1;this.features=[];this.fields=[];this.hasZ=this.hasM=!1;this.transform=this.spatialReference=this.geohashFieldName=this.geometryProperties=this.globalIdFieldName=this.objectIdFieldName=this.geometryType=null}}a.equals=l.equals;a.DehydratedFeatureClass=q;a.DehydratedFeatureSetClass=r;a.computeAABB=function(v,y){e.empty(y);"mesh"===v.type&&(v=v.extent);switch(v.type){case "point":y[0]=y[3]=v.x;y[1]=
y[4]=v.y;v.hasZ&&(y[2]=y[5]=v.z);break;case "polyline":for(var B=0;B<v.paths.length;B++)e.expandWithNestedArray(y,v.paths[B],!!v.hasZ);break;case "polygon":for(B=0;B<v.rings.length;B++)e.expandWithNestedArray(y,v.rings[B],!!v.hasZ);break;case "multipoint":e.expandWithNestedArray(y,v.points,!!v.hasZ);break;case "extent":y[0]=v.xmin,y[1]=v.ymin,y[3]=v.xmax,y[4]=v.ymax,null!=v.zmin&&(y[2]=v.zmin),null!=v.zmax&&(y[5]=v.zmax)}};a.computeAABR=function(v,y){g.empty(y);"mesh"===v.type&&(v=v.extent);switch(v.type){case "point":y[0]=
y[2]=v.x;y[1]=y[3]=v.y;break;case "polyline":for(var B=0;B<v.paths.length;B++)g.expandWithNestedArray(y,v.paths[B]);break;case "polygon":for(B=0;B<v.rings.length;B++)g.expandWithNestedArray(y,v.rings[B]);break;case "multipoint":g.expandWithNestedArray(y,v.points);break;case "extent":y[0]=v.xmin,y[1]=v.ymin,y[2]=v.xmax,y[3]=v.ymax}};a.estimateGeometryObjectSize=u;a.estimateSize=function(v){let y;y=32+b.estimateAttributesObjectSize(v.attributes);return y=y+3+(8+u(v.geometry))};a.fromFeatureSetJSON=
function(v,y){const B=f.featureGeometryTypeKebabDictionary.fromJSON(v.geometryType),z=h.fromJSON(v.spatialReference),A=v.transform,C=v.objectIdFieldName,H=y?.maxStringAttributeLength,E=y?.maxStringAttributeFields;let F;y=v.features.map(G=>{const D=w(G,B,z,v.objectIdFieldName);G=D.geometry;m(D.attributes,E,H,I=>{F??=[];const J=t(D,C);null!=J&&F.push({objectId:J,attribute:I})});if(null!=G&&A)switch(G.type){case "point":D.geometry=d.unquantizePoint(A,G,G);break;case "multipoint":D.geometry=d.unquantizeMultipoint(A,
G,G);break;case "polygon":D.geometry=d.unquantizePolygon(A,G,G);break;case "polyline":D.geometry=d.unquantizePolyline(A,G,G);break;case "extent":D.geometry=G;break;case "mesh":D.geometry=G}return D});return{geometryType:B,features:y,spatialReference:z,fields:v.fields?.map(G=>c.fromJSON(G))??[],objectIdFieldName:v.objectIdFieldName,globalIdFieldName:v.globalIdFieldName,geohashFieldName:v.geohashFieldName,geometryProperties:v.geometryProperties,hasZ:v.hasZ,hasM:v.hasM,exceededTransferLimit:v.exceededTransferLimit,
transform:null,missingAttributes:F}};a.fromJSONGeometry=x;a.getObjectId=t;a.hasGeometry=function(v){return null!=v.geometry};a.hasVertices=function(v){if(null==v)return!1;switch(v.type){case "extent":case "point":return!0;case "polyline":for(const y of v.paths)if(0<y.length)return!0;return!1;case "polygon":for(const y of v.rings)if(0<y.length)return!0;return!1;case "multipoint":return 0<v.points.length;case "mesh":return!v.loaded||0<v.vertexAttributes.position.length}};a.numVertices=function(v){if(null==
v)return 0;switch(v.type){case "point":return 1;case "polyline":var y=0;for(var B of v.paths)y+=B.length;return y;case "polygon":B=0;for(y of v.rings)B+=y.length;return B;case "multipoint":return v.points.length;case "extent":return 2;case "mesh":return(v=v.vertexAttributes&&v.vertexAttributes.position)?v.length/3:0}};a.removeLargeStringAttributes=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/dehydratedFeatureComparison":function(){define(["exports","../../core/has",
"../../core/mathUtils","../../geometry/support/spatialReferenceUtils"],function(a,b,n,k){function p(f,c){if(f===c)return!0;if(null==f||null==c||f.length!==c.length)return!1;for(let l=0;l<f.length;l++){const w=f[l],x=c[l];if(w.length!==x.length)return!1;for(let u=0;u<w.length;u++)if(w[u]!==x[u])return!1}return!0}function h(f,c){if(f===c)return!0;if(null==f||null==c||f.length!==c.length)return!1;for(let l=0;l<f.length;l++)if(!p(f[l],c[l]))return!1;return!0}function e(f,c){return f===c||null!=f&&null!=
c&&k.equals(f.spatialReference,c.spatialReference)&&f.x===c.x&&f.y===c.y&&f.z===c.z&&f.m===c.m}function g(f,c){if(f===c)return!0;if(null==f||null==c||f.type!==c.type)return!1;switch(f.type){case "point":return e(f,c);case "extent":return f=f.hasZ!==c.hasZ||f.hasM!==c.hasM?!1:k.equals(f.spatialReference,c.spatialReference)?f.xmin===c.xmin&&f.ymin===c.ymin&&f.zmin===c.zmin&&f.xmax===c.xmax&&f.ymax===c.ymax&&f.zmax===c.zmax:!1,f;case "polyline":return f=f.hasZ!==c.hasZ||f.hasM!==c.hasM?!1:k.equals(f.spatialReference,
c.spatialReference)?h(f.paths,c.paths):!1,f;case "polygon":return f=f.hasZ!==c.hasZ||f.hasM!==c.hasM?!1:k.equals(f.spatialReference,c.spatialReference)?h(f.rings,c.rings):!1,f;case "multipoint":return f=f.hasZ!==c.hasZ||f.hasM!==c.hasM?!1:k.equals(f.spatialReference,c.spatialReference)?p(f.points,c.points):!1,f;case "mesh":return!1}}function d(f,c){if(f===c)return!0;if(!f||!c)return!1;const l=Object.keys(f),w=Object.keys(c);if(l.length!==w.length)return!1;for(const x of l)if(f[x]!==c[x])return!1;
return!0}a.equals=function(f,c){return f===c?!0:null!=f&&null!=c&&f.objectId===c.objectId&&g(f.geometry,c.geometry)&&d(f.attributes,c.attributes)?!0:!1};a.pointEquals=e;a.pointNear=function(f,c,l){return f===c||null!=f&&null!=c&&k.equals(f.spatialReference,c.spatialReference)&&n.floatEqualAbsolute(f.x,c.x,l)&&n.floatEqualAbsolute(f.y,c.y,l)&&n.floatEqualAbsolute(f.z??0,c.z??0,l)&&n.floatEqualAbsolute(f.m??0,c.m??0,l)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DSymbolCreationContext":function(){define(["exports",
"../../../ViewingMode"],function(a,b){class n{constructor(p,h){this.scheduler=p;this.schedule=h;this.featureExpressionInfoContext=this.localOriginFactory=this.graphicsCoreOwner=this.drapeSourceRenderer=this.layer=this.overlaySR=this.renderCoordsHelper=this.clippingExtent=this.stage=this.renderer=this.elevationProvider=this.streamDataRequester=this.sharedResources=null;this.screenSizePerspectiveEnabled=!0;this.isAsync=this.skipHighSymbolLods=this.physicalBasedRenderingEnabled=this.slicePlaneEnabled=
!1}get spherical(){return this.stage.view.state.viewingMode===b.ViewingMode.Global}get doublePrecisionRequiresObfuscation(){return this.stage.renderView.renderingContext.driverTest.doublePrecisionRequiresObfuscation.result}}class k{constructor(){this.renderPriority=0;this.renderPriorityStep=1;this.ignoreDrivers=!1}}a.Graphics3DSymbolCreationContext=n;a.Graphics3DSymbolLayerCreationContext=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DWebStyleSymbol":function(){define(["exports",
"./defaultSymbolComplexity","./interfaces","./Loadable"],function(a,b,n,k){class p extends k.Loadable{constructor(h,e,g){super(e);this.symbol=h;this._convert=g;this.symbologySnappingSupported=!1;this.graphics3DSymbol=null;this.referenced=0}getSymbolLayerSize(h){return null!=this.graphics3DSymbol?this.graphics3DSymbol.getSymbolLayerSize(h):null}get symbolLayers(){return null!=this.graphics3DSymbol?this.graphics3DSymbol.symbolLayers:[]}get extentPadding(){return null!=this.graphics3DSymbol?this.graphics3DSymbol.extentPadding:
0}async doLoad(h){h=await this.symbol.fetchSymbol({signal:h});h.id=this.symbol.id;this.graphics3DSymbol=this._convert(h);null!=this.graphics3DSymbol&&await this.graphics3DSymbol.load()}createGraphics3DGraphic(h){return null!=this.graphics3DSymbol?this.graphics3DSymbol.createGraphics3DGraphic(h,this):null}get complexity(){return null!=this.graphics3DSymbol?this.graphics3DSymbol.complexity:b.emptySymbolComplexity}globalPropertyChanged(h,e){return null!=this.graphics3DSymbol?this.graphics3DSymbol.globalPropertyChanged(h,
e):!1}applyRendererDiff(h,e){return null!=this.graphics3DSymbol?this.graphics3DSymbol.applyRendererDiff(h,e):n.ApplyRendererDiffResult.RecreateSymbol}prepareSymbolPatch(h){null!=this.graphics3DSymbol&&this.graphics3DSymbol.prepareSymbolPatch(h)}updateGeometry(h,e){return null!=this.graphics3DSymbol?this.graphics3DSymbol.updateGeometry(h,e):!1}updateTransform(h,e,g,d){return this.graphics3DSymbol?.updateTransform(h,e,g,d)??!1}onRemoveGraphic(){}getFastUpdateStatus(){return null!=this.graphics3DSymbol?
this.graphics3DSymbol.getFastUpdateStatus():{loading:1,fast:0,slow:0}}destroy(){null!=this.graphics3DSymbol&&this.graphics3DSymbol.destroy();this.graphics3DSymbol=void 0;super.destroy()}get destroyed(){return void 0===this.graphics3DSymbol}}a.Graphics3DWebStyleSymbol=p;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/LabelParameters":function(){define(["exports","../../../../core/libs/gl-matrix-2/factories/vec2f64","../../../../core/libs/gl-matrix-2/factories/vec3f64",
"../../../../core/libs/gl-matrix-2/factories/vec4f64"],function(a,b,n,k){class p{constructor(e,g="center",d=!1,f=b.create(),c=k.fromValues(0,0,0,-1),l="world",w=n.create(),x=0){this.verticalOffset=e;this.anchor=g;this.hasLabelVerticalOffset=d;this.screenOffset=f;this.centerOffset=c;this.centerOffsetUnits=l;this.translation=w;this.elevationOffset=x}}class h{constructor(e,g="center",d="center",f=null,c=b.create()){this.placement=e;this.horizontalPlacement=g;this.verticalPlacement=d;this.text=f;this.displaySize=
c}}a.LabelParameters=h;a.LabelPlacement=p;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/labelPlacement":function(){define("exports ../../../../core/has ../../../../core/Logger ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../geometry/support/aaBoundingBox ./constants ./graphicSymbolUtils ./LabelParameters ../../webgl-engine/lib/TextRenderer ../../webgl-engine/materials/HUDMaterial".split(" "),function(a,b,n,k,
p,h,e,g,d,f,c){function l(A){A=g.getGraphics3DSymbol(A.graphics3DGraphic.graphics3DSymbol);return null!=A?A.symbol.symbolLayers.at(0):null}function w(A,C){var H=C.graphics3DGraphic.graphic.geometry;if(null==H)return null;if(null!=C.disablePlacement)return C.labelClass.labelPlacement?(r().warnOncePerTick(x(A?.placement,C.disablePlacement.logEntityDescription)),u(C)):A;H=H.type;switch(H){case "polyline":case "polygon":case "extent":case "multipoint":if(C.labelClass.labelPlacement)return r().warnOncePerTick(x(A?.placement,
`'${H}' geometries`)),u(C)}return A}function x(A,C){return`the requested label placement '${A}' is currently unsupported for ${C} in SceneView.`}function u(A){const C=A.graphics3DGraphic.graphic.geometry;if(null==C)return null;switch(C.type){case "polyline":case "extent":case "multipoint":return{placement:"center-center",normalizedOffset:p.ZEROS,anchor:"center"};case "polygon":return A=l(A),null!=A&&"extrude"===A.type?y["above-center"]:{placement:"center-center",normalizedOffset:p.ZEROS,anchor:"center"};
case "point":return y["above-center"];case "mesh":return y["above-center"]}}function t(A,C=B){({graphics3DGraphic:A}=A);(A=A.layers[0]?.stageObject.geometries[0].material??null)&&A instanceof c.HUDMaterial?(A=A.parameters.anchorPosition,C[0]=2*(A[0]-.5),C[1]=2*(A[1]-.5)):(C[0]=0,C[1]=0);return C}function m(A,C,H){H=null!=H?H.getBoundingBoxObjectSpace(z):z;H=p.fromValues(H[3]-H[0],H[4]-H[1],H[5]-H[2]);A.centerOffset[0]=Math.sqrt(H[0]*H[0]+H[1]*H[1])/2*C.normalizedOffset[0];const E=A.translation[2],
F=H[2]/2*C.normalizedOffset[1];A.translation[2]=0;A.elevationOffset=E+F;H=k.length(H);A.centerOffset[2]=H/2*C.normalizedOffset[2]}function q(A){const C=A.labelClass.labelPlacement,{labelSymbol:H,graphics3DGraphic:E}=A;var F=g.getGraphics3DSymbol(E.graphics3DSymbol);F="point-3d"===F?.symbol.type?F.symbol:null;A=y[C]||u(A);if(null!=F&&F.supportsCallout()&&F.hasVisibleVerticalOffset()&&!E.isDraped)return{placement:null,hasLabelVerticalOffset:!1,verticalOffset:F.verticalOffset.clone(),anchor:null,normalizedOffset:null};
if(H&&H.hasVisibleVerticalOffset()&&(null==F||!F.supportsCallout()||!F.verticalOffset||E.isDraped)){if(!(F=!A)){a:switch(A.placement){case "above-center":F=!0;break a;default:F=!1}F=!F}return F?(r().errorOncePerTick("Callouts and vertical offset on labels are currently only supported with 'above-center' label placement (not with "+C+" placement)"),null):{placement:"above-center",verticalOffset:H.verticalOffset.clone(),anchor:"bottom",normalizedOffset:[0,A.normalizedOffset[1],0],hasLabelVerticalOffset:!0}}return{placement:null,
verticalOffset:null,anchor:null,normalizedOffset:null,hasLabelVerticalOffset:!1}}const r=()=>n.getLogger("esri.views.3d.layers.graphics.labelPlacement");class v{constructor(A,C,H,E=null){this.graphics3DGraphic=A;this.labelSymbol=C;this.labelClass=H;this.disablePlacement=E}}const y={"above-center":{placement:"above-center",normalizedOffset:[0,1,0],anchor:"bottom"},"above-left":{placement:"above-left",normalizedOffset:[-1,1,0],anchor:"bottom-right"},"above-right":{placement:"above-right",normalizedOffset:[1,
1,0],anchor:"bottom-left"},"below-center":{placement:"below-center",normalizedOffset:[0,-1,2],anchor:"top"},"below-left":{placement:"below-left",normalizedOffset:[-1,-1,0],anchor:"top-right"},"below-right":{placement:"below-right",normalizedOffset:[1,-1,0],anchor:"top-left"},"center-center":{placement:"center-center",normalizedOffset:[0,0,1],anchor:"center"},"center-left":{placement:"center-left",normalizedOffset:[-1,0,0],anchor:"right"},"center-right":{placement:"center-right",normalizedOffset:[1,
0,0],anchor:"left"}};b={"above-center":["default","esriServerPointLabelPlacementAboveCenter"],"above-left":["esriServerPointLabelPlacementAboveLeft"],"above-right":["esriServerPointLabelPlacementAboveRight"],"below-center":["esriServerPointLabelPlacementBelowCenter"],"below-left":["esriServerPointLabelPlacementBelowLeft"],"below-right":["esriServerPointLabelPlacementBelowRight"],"center-center":["esriServerPointLabelPlacementCenterCenter"],"center-left":["esriServerPointLabelPlacementCenterLeft"],
"center-right":["esriServerPointLabelPlacementCenterRight"]};for(const A in b){const C=y[A];b[A].forEach(H=>{y[H]=C})}Object.freeze&&(Object.freeze(y),Object.keys(y).forEach(A=>{Object.freeze(y[A]);Object.freeze(y[A]?.normalizedOffset)}));const B=[0,0],z=h.create();a.LabelInfo=v;a.getLabelPlacement=function(A){var C=q(A);if(null==C)return null;if(C.anchor)var H=C;else{H=A.labelClass.labelPlacement;var E=y[H],F=E||u(A);H&&!E&&r().warnOncePerTick(`the requested label placement '${H}' is currently unsupported in SceneView.`);
H=w(F,A)}if(null==H)return null;C=new d.LabelPlacement(C.verticalOffset,H.anchor,!!C.hasLabelVerticalOffset);E=A.graphics3DGraphic.graphic.geometry;if(null==E)H=null;else{switch(E.type){case "point":F=l(A);if(null!=F)switch(E=A.graphics3DGraphic.layers[0],null!=E?E.getCenterObjectSpace(C.translation):k.set(C.translation,0,0,0),F.type){case "icon":case "text":({graphics3DGraphic:F}=A);E=null!=E?E.getScreenSize():null;F.isDraped||null==E?C.hasLabelVerticalOffset||"center"===C.anchor||(y[A.labelClass.labelPlacement]&&
r().warnOncePerTick(`the requested placement '${H.placement}' is currently unsupported for draped graphics`),C.anchor="center"):(A=t(A),C.screenOffset[0]=E[0]/2*(H.normalizedOffset[0]-A[0]),A=E[1]/2*(H.normalizedOffset[1]-A[1]),C.hasLabelVerticalOffset?(C.centerOffset[1]=A,C.centerOffsetUnits="screen"):C.screenOffset[1]=A);break;case "object":m(C,H,E)}break;case "mesh":E=l(A);if(null!=E)switch(A=A.graphics3DGraphic.layers[0],E.type){case "fill":m(C,H,A)}break;case "polygon":if(E=l(A),null!=E)switch(E.type){case "extrude":A=
A.graphics3DGraphic.layers[0],null!=A?(A.getBoundingBoxObjectSpace(z),h.center(z,C.translation),C.translation[2]=h.height(z)/2):k.set(C.translation,0,0,0),m(C,H,A)}}A=e.labelMarginPx-f.textVerticalPaddingPx;C.screenOffset[0]+=A*H.normalizedOffset[0];C.screenOffset[1]+=A*H.normalizedOffset[1];H=C}return H};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/constants":function(){define(["exports","../../../../core/libs/gl-matrix-2/factories/vec4f64"],function(a,
b){b=b.ZEROS;a.labelMarginPx=4;a.suspendResumeExtentOptimism=1.2;a.transparentUnit=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/TextRenderer":function(){define(["exports","../../../../core/mathUtils","../../support/debugFlags","./FontMetrics","./TextHelperCanvas"],function(a,b,n,k,p){class h{constructor(f,c,l,w){this.text=f;this._alignment=c;this._parameters=l;this._maxSize=w;this._textWidths=[];this._lineWidths=[];this._metricsCached=this._renderPixelRatio=
null;this.key=`${f}--${this._parameters.key}-${this._alignment}`;this._lines=f.replaceAll(" ","\u00a0").split(/\r?\n/)}get displayWidth(){return Math.ceil(this._displayWidth+2*this._horizontalPadding)}get displayHeight(){let f=this._metrics.firstLineAscent;for(let c=0;c<this._lines.length-1;c++)f+=this._lineSpacing;f+=this._metrics.lastLineDescent;return Math.ceil(f+2*this._haloSize+2*this._verticalPadding)}get renderedWidth(){return this._toRoundedRenderUnit(this.displayWidth)}get renderedHeight(){return this._toRoundedRenderUnit(this.displayHeight)}get firstRenderedBaselinePosition(){return this._toRenderUnit(this._firstLineYOffset+
this._metrics.firstLineAscent)}get _firstLineYOffset(){return this._verticalPadding+this._haloSize}get _metrics(){if(null==this._metricsCached){const c=p.getTextHelperCanvas(g,512,512).getContext("2d"),l=this._parameters.definition.pixelRatio;this._parameters.setFontProperties(c,this._fontSize*l);let w=2*this._haloSize;var f=this._parameters.definition.font;if("italic"===f.style||"oblique"===f.style||"bold"===f.weight||"bolder"===f.weight)w+=.3*c.measureText("A").width;this._textWidths.length=0;let x=
this._lineWidths.length=0,u=0,t=0,m=0,q=0;this._lines.forEach((v,y)=>{v=c.measureText(v);const B=v.width/l,z=B+w;this._textWidths.push(B);this._lineWidths.push(z);x=Math.max(x,z);m=Math.max(m,v.actualBoundingBoxAscent/l);q=Math.max(q,v.actualBoundingBoxDescent/l);0===y&&(u=v.actualBoundingBoxAscent/l);y===this._lines.length-1&&(t=v.actualBoundingBoxDescent/l)});f=k.getFontMetrics(this._parameters);const r=Math.max(q,f.maxDescent);this._metricsCached=new d(u,"underline"===this._parameters.definition.font.decoration?
r:t,Math.max(m,f.maxAscent),r,x)}return this._metricsCached}get _lineSpacing(){return(this._midLineHeight+this._linePadding)*this._parameters.definition.lineSpacingFactor}get _midLineHeight(){return this._metrics.midLineHeight}get _linePadding(){return.2*this._midLineHeight}get _midLineAscent(){return this._metrics.maxLineAscent}get _renderedFontSize(){return this._toRenderUnit(this._fontSize)}get _fontSize(){return this._parameters.definition.size}get _renderedHaloSize(){return this._toRenderUnit(this._haloSize)}get _haloSize(){return this._parameters.haloSize}get _horizontalPadding(){return this._hasBackground?
this._parameters.definition.background.padding[0]:0}get _verticalPadding(){return Math.max(this._hasBackground?this._parameters.definition.background.padding[1]:0,1)}get _hasBackground(){return!!this._parameters.backgroundStyle}get renderPixelRatio(){null==this._renderPixelRatio&&(this._renderPixelRatio=Math.min(this._parameters.definition.pixelRatio,Math.min(this._maxSize[0]/this.displayWidth,this._maxSize[1]/this.displayHeight)));return this._renderPixelRatio}_getLineXOffset(f){switch(this._alignment){case a.TextRenderAlignment.Left:return this._horizontalPadding;
case a.TextRenderAlignment.Center:return(this.displayWidth-this._lineWidths[f])/2;case a.TextRenderAlignment.Right:return this.displayWidth-this._horizontalPadding-this._lineWidths[f]}}render(f,c,l){f.save();c/=this.renderPixelRatio;l/=this.renderPixelRatio;const w=c,x=l;var u=this._haloSize;const t=this._firstLineYOffset+this._metrics.firstLineAscent;c+=u;l+=t;const m=0<this._haloSize;m&&this._renderHalo(f,w,x,u,t);this._parameters.setFontProperties(f,this._renderedFontSize);for(u=0;u<this._lines.length;++u){const q=
this._lines[u],r=this._getLineXOffset(u);m&&(f.globalCompositeOperation="destination-out",f.fillStyle="rgb(0, 0, 0)",this._fillText(f,q,c+r,l),this._renderLineDecoration(f,c+r,l,this._textWidths[u]));f.globalCompositeOperation="source-over";f.fillStyle=this._parameters.textStyle;this._fillText(f,q,c+this._getLineXOffset(u),l);this._renderLineDecoration(f,c+r,l,this._textWidths[u]);l+=this._lineSpacing}if(n.debugFlags.TEXT_SHOW_BASELINE)for(f.strokeStyle="rgb(255, 0, 255, 0.5)",f.setLineDash([2,2]),
f.lineWidth=1,c=x+t,l=0;l<this._lines.length;++l)this._drawLine(f,[w,c],[w+this.displayWidth,c]),c+=this._lineSpacing;n.debugFlags.TEXT_SHOW_BORDER&&(f.strokeStyle="rgb(255, 0, 255, 0.5)",f.setLineDash([]),f.lineWidth=1,this._drawBox(f,[w,x],[this.displayWidth,this.displayHeight]));this._hasBackground&&(this._roundedRect(f,w,x,this._parameters.definition.background.borderRadius*this.renderPixelRatio),f.globalCompositeOperation="destination-over",f.fillStyle=this._parameters.backgroundStyle,f.fill());
f.restore()}_renderLineDecoration(f,c,l,w,x=!1){if("none"!==this._parameters.definition.font.decoration&&0!==w){var u=Math.max(this._parameters.definition.size/16,1);switch(this._parameters.definition.font.decoration){case "underline":l+=2*u;break;case "line-through":l-=.33*this._midLineAscent}var t=x?this._haloSize:0;f.strokeStyle=x?this._parameters.haloStyle:this._parameters.textStyle;f.lineWidth=this._toRenderUnit(u+2*t);f.beginPath();f.moveTo(this._toRenderUnit(c-t),this._toRenderUnit(l));f.lineTo(this._toRenderUnit(c+
w+t),this._toRenderUnit(l));f.stroke()}}_roundedRect(f,c,l,w){c=this._toRenderUnit(c);l=this._toRenderUnit(l);const x=this.renderedWidth,u=this.renderedHeight;0===w?f.rect(c,l,x,u):(w=b.clamp(w,0,Math.floor(u/2)),f.beginPath(),f.moveTo(c,l+w),f.arcTo(c,l,c+w,l,w),f.lineTo(c+x-w,l),f.arcTo(c+x,l,c+x,l+w,w),f.lineTo(c+x,l+u-w),f.arcTo(c+x,l+u,c+x-w,l+u,w),f.lineTo(c+w,l+u),f.arcTo(c,l+u,c,l+u-w,w),f.closePath())}_renderHalo(f,c,l,w,x){const u=this.renderedWidth,t=this.renderedHeight,m=p.getTextHelperCanvas(g,
Math.max(u,512),Math.max(t,512)),q=m.getContext("2d");q.clearRect(0,0,u,t);this._parameters.setFontProperties(q,this._renderedFontSize);q.fillStyle=this._parameters.haloStyle;q.strokeStyle=this._parameters.haloStyle;var r=3>this._renderedHaloSize;q.lineJoin=r?"miter":"round";r?this._renderHaloEmulated(q,w,x):this._renderHaloNative(q,w,x);for(r=0;r<this._lines.length;++r){const v=this._getLineXOffset(r);this._renderLineDecoration(q,w+v,x,this._textWidths[r],!0);x+=this._lineSpacing}f.globalAlpha=this._parameters.definition.halo.color[3];
f.drawImage(m,0,0,u,t,this._toRenderUnit(c),this._toRenderUnit(l),u,t);f.globalAlpha=1}_renderHaloEmulated(f,c,l){for(let w=0;w<this._lines.length;++w){const x=this._lines[w],u=this._getLineXOffset(w);for(const [t,m]of e)this._fillText(f,x,c+u+this._haloSize*t,l+this._haloSize*m);l+=this._lineSpacing}}_renderHaloNative(f,c,l){const w=2*this._haloSize;for(let x=0;x<this._lines.length;++x){const u=this._lines[x],t=this._getLineXOffset(x);for(let m=0;5>m;m++)f.lineWidth=this._toRenderUnit((.6+.1*m)*
w),this._strokeText(f,u,c+t,l);l+=this._lineSpacing}}get _displayWidth(){return this._metrics.displayWidth}_toRenderUnit(f){return f*this.renderPixelRatio}_toRoundedRenderUnit(f){return Math.round(f*this.renderPixelRatio)}_fillText(f,c,l,w){f.fillText(c,this._toRenderUnit(l),this._toRenderUnit(w))}_strokeText(f,c,l,w){f.strokeText(c,this._toRenderUnit(l),this._toRenderUnit(w))}_drawLine(f,c,l){f.beginPath();f.moveTo(this._toRoundedRenderUnit(c[0])+.5,this._toRoundedRenderUnit(c[1])+.5);f.lineTo(this._toRoundedRenderUnit(l[0])+
.5,this._toRoundedRenderUnit(l[1])+.5);f.stroke()}_drawBox(f,c,l){var w=this._toRenderUnit(c[0]);c=this._toRenderUnit(c[1]);var x=this._toRenderUnit(l[0]);const u=this._toRenderUnit(l[1]);l=Math.floor(w)+.5;w=Math.ceil(w+x)-.5;x=Math.floor(c)+.5;c=Math.ceil(c+u)-.5;f.beginPath();f.moveTo(l,x);f.lineTo(w,x);f.lineTo(w,c);f.lineTo(l,c);f.lineTo(l,x);f.stroke()}}const e=[];for(let f=0;360>f;f+=22.5)e.push([Math.cos(Math.PI*f/180),Math.sin(Math.PI*f/180)]);a.TextRenderAlignment=void 0;(function(f){f[f.Left=
0]="Left";f[f.Center=1]="Center";f[f.Right=2]="Right"})(a.TextRenderAlignment||(a.TextRenderAlignment={}));const g={canvas:null};class d{get firstLineHeight(){return this.firstLineAscent+this.maxLineDescent}get midLineHeight(){return this.maxLineAscent+this.maxLineDescent}get lastLineHeight(){return this.maxLineAscent+this.lastLineDescent}constructor(f,c,l,w,x){this.firstLineAscent=f;this.lastLineDescent=c;this.maxLineAscent=l;this.maxLineDescent=w;this.displayWidth=x}}a.TextRenderer=h;a.textVerticalPaddingPx=
1;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/FontMetrics":function(){define(["exports","./TextHelperCanvas"],function(a,b){const n=new Map;class k{get maxHeight(){return this.maxAscent+this.maxDescent}constructor(e,g){this.maxAscent=e;this.maxDescent=g}}const p={canvas:null},h=(()=>{let e="";for(let g=32;127>g;g++)e+=String.fromCharCode(g);return e})();a.getFontMetrics=function(e){const {size:g}=e.definition,d=e.fontString(g);var f=n.get(d);f||
(f=b.getTextHelperCanvas(p,0,0).getContext("2d"),e.setFontProperties(f,g),e=f.measureText(h),f=new k(e.actualBoundingBoxAscent,e.actualBoundingBoxDescent),n.set(d,f));return f};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/TextHelperCanvas":function(){define(["exports"],function(a){a.getTextHelperCanvas=function(b,n,k){b.canvas||(b.canvas=document.createElement("canvas"));b.canvas.width=n;b.canvas.height=k;return b.canvas};Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/placementUtils":function(){define(["exports","../../../../core/libs/gl-matrix-2/math/vec2","../../../../core/libs/gl-matrix-2/factories/vec2f64","../../webgl-engine/lib/TextRenderer"],function(a,b,n,k){const p=Object.freeze({left:0,center:.5,right:1}),h=Object.freeze({"bottom-left":n.fromValues(0,0),bottom:n.fromValues(.5,0),"bottom-right":n.fromValues(1,0),left:n.fromValues(0,.5),center:n.fromValues(.5,.5),right:n.fromValues(1,
.5),"top-left":n.fromValues(0,1),top:n.fromValues(.5,1),"top-right":n.fromValues(1,1)});a.anchorFromPlacements=function(e,g){switch(g){case "bottom":return"left"===e?"bottom-left":"right"===e?"bottom-right":"bottom";case "center":return e;case "top":return"left"===e?"top-left":"right"===e?"top-right":"top"}};a.horizontalPlacementFromAnchor=function(e){switch(e){case "bottom-left":case "left":case "top-left":return"left";case "bottom":case "center":case "top":return"center";case "bottom-right":case "right":case "top-right":return"right"}};
a.horizontalPlacementToAnchorX=p;a.namedAnchorToHUDMaterialAnchorPos=h;a.textRenderAlignmentFromHorizontalPlacement=function(e){switch(e){case "left":return k.TextRenderAlignment.Left;case "right":return k.TextRenderAlignment.Right;default:return k.TextRenderAlignment.Center}};a.verticalPlacementFromAlignment=function(e){return"middle"===e?"center":e};a.verticalPlacementFromAnchor=function(e){switch(e){case "bottom-left":case "bottom":case "bottom-right":return"bottom";case "left":case "center":case "right":return"center";
case "top-left":case "top":case "top-right":return"top"}};a.verticalScreenOffsetFromAlignment=function(e,g){switch(e){case "top":return b.set(g,0,k.textVerticalPaddingPx);case "bottom":return b.set(g,0,-k.textVerticalPaddingPx);default:return b.copy(g,n.ZEROS)}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/pipeline/rendering/FeaturePipelineRenderManager":function(){define("exports ../../../../../../chunks/tslib.es6 ../../../../../../core/Accessor ../../../../../../core/handleUtils ../../../../../../core/maybe ../../../../../../core/Logger ../../../../../../core/has ../../../../../../core/RandomLCG ../../../../../../core/Error ../../../../../../core/accessorSupport/decorators/subclass ../../../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../../../core/libs/gl-matrix-2/factories/vec4f64 ../../../../../ViewingMode ../../placementUtils ./DirectRenderer ./LodRenderer ../../../../support/engineContent/sdfPrimitives ../../../../webgl-engine/lib/basicInterfaces ../../../../webgl-engine/materials/DefaultMaterial ../../../../webgl-engine/materials/HUDMaterial ../../../../webgl-engine/materials/pbrUtils".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w,x,u,t,m,q,r,v,y){function B(C,H){const E={anchorPosition:x.namedAnchorToHUDMaterialAnchorPos.center,occlusionTest:!0,hasSlicePlane:!1,color:[1,0,0,1],outlineColor:[0,0,0,1],outlineSize:1};null!=C&&(C=C.fromData("circle-icon",()=>m.createTexture("circle")),E.textureId=C.texture.id,E.textureIsSignedDistanceField=!0,E.sampleSignedDistanceFieldTexelCenter=m.requiresHalfTexelOffset("circle"));E.distanceFieldBoundingBox=A;return[new v.HUDMaterial(E,H),null]}function z(C,
H,E){const F={usePBR:H.physicalBasedRenderingEnabled,isSchematic:!0,mrrFactors:y.schematicMRRFactors,ambient:c.ONES,diffuse:c.ONES,hasSlicePlane:H.slicePlaneEnabled,hasSliceHighlight:!1,castShadows:H.castShadows,offsetTransparentBackfaces:!H.isPrimitive},G=F.opacity??1,D=1>G;F.transparent=D;F.opacity=G;F.cullFace=D?q.CullFaceOptions.None:q.CullFaceOptions.Back;H.screenSizePerspectiveEnabled&&(F.screenSizePerspective=C.screenSizePerspectiveSettings);F.externalColor=l.ONES;F.isInstanced=!0;return new r.DefaultMaterial(F,
{spherical:E,doublePrecisionRequiresObfuscation:!0})}a.FeaturePipelineRenderManager=class extends n{constructor(C){super();this.layerUid=this.view=null;this._renderGeometries=new Map;this._materials=new Map;this._directRenderers=new Map;this._lodRenderers=new Map;this.view=C.view;this.layerUid=C.layerUid}initialize(){}destroy(){}async executeRenderCommands(C){for(const H of C)switch(H.id){case "create-material":await this._createMaterial(H);break;case "create-direct-renderer":await this._createDirectRenderer(H);
break;case "add-direct-renderer-geometry":await this._addDirectRendererGeometry(H);break;case "remove-direct-renderer-geometry":await this._removeDirectRendererGeometry(H);break;case "create-lod-renderer":await this._createLodRenderer(H);break;case "add-lod-instances":await this._addLodInstances(H);break;case "remove-lod-instances":await this._removeLodInstances(H)}}async _createMaterial(C){const {view:H}=this,{sharedSymbolResources:E}=H;if(null==E)throw Error("No shared symbol resources found!");
const {textures:F}=E,G=H.state.viewingMode===w.ViewingMode.Global;let D=null;switch(C.type){case "default":D=z(E,{physicalBasedRenderingEnabled:!0,slicePlaneEnabled:!1,castShadows:!0,isPrimitive:!0,screenSizePerspectiveEnabled:!0,doublePrecisionRequiresObfuscation:H._stage.renderView.renderingContext.driverTest.doublePrecisionRequiresObfuscation.result},G);break;case "hud":const [I,J]=B(F,G);this.addHandles([k.makeHandle(()=>p.releaseMaybe(J))]);D=I;break;default:throw Error(`unable to create unknown material type ${C.type}`);
}this._materials.set(C.materialId,D)}_getMaterial(C){return this._materials.get(C)}async _createDirectRenderer(C){C=C.materialId;var H=this._getMaterial(C);if(null==H)throw Error(`material not found ${C}`);const {view:E}=this;H=new u.DirectRenderer({material:H});this._directRenderers.set(C,H);E._stage.addRenderPlugin(H);E._stage.renderView.renderer.updateHasFlags()}async _addDirectRendererGeometry(C){const H=C.renderGeometryId,E=C.materialId;null!=this._renderGeometries.get(H)&&await this._removeDirectRendererGeometry({renderGeometryId:H});
const F=this._directRenderers.get(E);null==F?console.error("no renderer assigned to provided material"):(C=F.addRenderGeometry(H,C.renderGeometryBuffer,C.localOrigin),this._renderGeometries.set(H,{renderGeometry:C,materialId:E}),this.view._stage.renderView.requestRender())}async _removeDirectRendererGeometry(C){var H=this._renderGeometries.get(C.renderGeometryId);null!=H&&(H=this._directRenderers.get(H.materialId),null==H?console.error("no renderer assigned to provided material"):H.removeRenderGeometry(C.renderGeometryId))}async _createLodRenderer(C){const H=
new t.LodRenderer({view:this.view,layerUid:this.layerUid}),E=new AbortController;await H.doLoad(C.lodRenderGeometry,F=>this._getMaterial(F),E.signal);this._lodRenderers.set(C.lodRendererId,H)}async _addLodInstances(C){const H=this._lodRenderers.get(C.lodRendererId);if(null==H)throw Error("no lod renderer assigned to provided lod renderer Id");H.addInstances(C.data)}async _removeLodInstances(C){const H=this._lodRenderers.get(C.lodRendererId);if(null==H)throw Error("no lod renderer assigned to provided lod renderer Id");
H.removeInstances(C.featureIds)}};a.FeaturePipelineRenderManager=b.__decorate([f.subclass("esri.views.3d.layers.graphics.pipeline.rendering.FeaturePipelineRenderManager")],a.FeaturePipelineRenderManager);b=m.defaultSymbolSizeRatio;const A=[b/2,b/2,1-b/2,1-b/2];a.createDefaultMaterial=z;a.createHudMaterial=B;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/pipeline/rendering/DirectRenderer":function(){define("exports ../../../../../../chunks/tslib.es6 ../../../../../../core/accessorSupport/decorators/property ../../../../../../core/has ../../../../../../core/Logger ../../../../../../core/RandomLCG ../../../../../../core/accessorSupport/decorators/subclass ../../../../support/buffer/glUtil ../../../../webgl-engine/core/shaderLibrary/ShaderOutput ../../../../webgl-engine/effects/RenderPlugin ../../../../webgl-engine/lib/GLMaterials ../../../../webgl-engine/lib/RenderSlot ../../../../webgl-engine/materials/DrawParameters ../../../../webgl-engine/materials/renderers/MergedRenderer".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w,x){a.DirectRenderer=class extends f.SyncRenderPlugin{constructor(u){super(u);this._hasHighlights=!1;this._glMaterials=null;this._produces=new Map;this._renderGeometries=new Map;this._vaoCache=null;this._drawParameters=new w.DrawParameters;this._bufferWriter=null}get produces(){return this._produces}initialize(){this._bufferWriter=this.material.createBufferWriter();this.material.produces.forEach((u,t)=>{this._produces.set(t,m=>m!==d.ShaderOutput.Highlight&&m!==d.ShaderOutput.ShadowHighlight||
this._hasHighlights?u(m):!1)})}destroy(){this._glMaterials.dispose();const u=this._renderGeometries.keys();for(const t of u)this.removeRenderGeometry(t)}acquireTechniques(u){const t=this.material;if(!t.shouldRender(u))return null;const {output:m,bind:q}=u;return t.produces.get(q.slot)?.(m)&&(m!==d.ShaderOutput.Highlight&&m!==d.ShaderOutput.ShadowHighlight||this._hasHighlights)?this._glMaterials.load(u.rctx,q.slot,m)?.beginSlot(q):null}render(u,t){const m=this._renderGeometries;if(0!==m.size){var {bind:q}=
u,r=q.slot===l.RenderSlot.OCCLUDER_MATERIAL||q.slot===l.RenderSlot.TRANSPARENT_OCCLUDER_MATERIAL?q.slot:null;u=u.rctx;u.runAppleAmdDriverHelper();u.bindTechnique(t,q,this.material.parameters);var v=t.program;for(const [,y]of m)this._drawParameters.origin=y.localOrigin,v.bindDraw(q,this.material.parameters,this._drawParameters),t.ensureAttributeLocations(y.vao),u.bindVAO(y.vao),u.setPipelineState(t.getPipeline(!1,r)),u.drawArrays(t.primitiveType,0,y.numElements)}}initializeRenderContext(u,t){this._glMaterials=
new c.GLMaterials(this.material,u.materials);this._vaoCache=u.renderContext.rctx.getVaoCache(this.material.vertexAttributeLocations,g.glLayout(this._bufferWriter.vertexBufferLayout))}uninitializeRenderContext(){}addRenderGeometry(u,t,m){this.removeRenderGeometry(u);const q=this._bufferWriter.vertexBufferLayout.stride,r=this._vaoCache.newVao(x.sizeForVao(t.data.byteLength));r.vertexBuffers.get("geometry").setSubData(new Uint8Array(t.data),0,0,t.elementCount*q);t={localOrigin:m,vao:r,numElements:t.elementCount};
this._renderGeometries.set(u,t);return t}removeRenderGeometry(u){const t=this._renderGeometries.get(u);null!=t&&(this._vaoCache.deleteVao(t.vao),this._renderGeometries.delete(u))}};b.__decorate([n.property({constructOnly:!0})],a.DirectRenderer.prototype,"material",void 0);a.DirectRenderer=b.__decorate([e.subclass("esri.views.3d.layers.graphics.pipeline.rendering.DirectRenderer")],a.DirectRenderer);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/GLMaterials":function(){define(["exports",
"./basicInterfaces"],function(a,b){class n{constructor(k,p){this._material=k;this._repository=p;this._map=new Map}dispose(){this._map.forEach((k,p)=>{null!=k&&this._repository.release(this._material,p)})}load(k,p,h){if(!this._material.produces.get(p)?.(h))return null;this._map.has(h)||this._map.set(h,this._repository.acquire(this._material,p,h));p=this._map.get(h);if(null!=p){if(p.ensureResources(k)===b.ResourceState.LOADED)return p;this._repository.requestRender()}return null}}a.GLMaterials=n;Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/DrawParameters":function(){define(["exports","../../../../core/libs/gl-matrix-2/factories/vec3f64","../core/shaderLibrary/attributes/VertexNormal.glsl"],function(a,b,n){class k extends n.VertexNormalDrawParameters{constructor(p=b.create()){super();this.origin=p}get slicePlaneLocalOrigin(){return this.origin}}a.DrawParameters=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/renderers/MergedRenderer":function(){define("exports ../../../../../chunks/tslib.es6 ../../../../../core/arrayUtils ../../../../../core/has ../../../../../core/mathUtils ../../../../../core/maybe ../../../../../core/NestedMap ../../../../../core/PooledArray ../../../../../core/SetUtils ../../../../../core/accessorSupport/decorators/property ../../../../../core/Logger ../../../../../core/accessorSupport/decorators/subclass ../../../../../core/libs/gl-matrix-2/math/mat4 ../../../../../core/libs/gl-matrix-2/factories/mat4f64 ../../../support/buffer/glUtil ../../core/shaderLibrary/ShaderOutput ../../effects/RenderPlugin ../../lib/GLMaterials ../../lib/ModelDirtyTypes ../../lib/RenderSlot ../../lib/Util ../DrawParameters ./BufferRange ./Instance ./PerBufferData ./PerOriginData".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w,x,u,t,m,q,r,v,y,B,z,A,C,H){function E(O,K){const L=O.find(R=>R.numElements>=K);if(null==L)return null;const P=L.from;L.from+=K;L.from>=L.to&&O.removeUnordered(L);return P}function F(O){M.length<O&&(M=new Float32Array(O));return M}function G(O){O*=4;return 1024>=O?1024:262144>O?p.nextHighestPowerOfTwo(O):Math.max(Math.min(262144*Math.ceil(1.5*O/262144),16777216),O)}a.MergedRenderer=class extends m.SyncRenderPlugin{get _hasAnyHighlight(){return 0<this._highlightGroups.size}constructor(O){super(O);
this._dataByOrigin=new Map;this._drawParameters=new B.DrawParameters;this._highlightGroups=new Set;this.drapedPriority=0;this._produces=new Map;this._hasOccludees=!1}destroy(){this._glMaterials=h.disposeMaybe(this._glMaterials);this._dataByOrigin.forEach(O=>O.dispose());this._dataByOrigin.clear();this._vaoCache=null}initialize(){this.material.produces.forEach((O,K)=>{this._produces.set(K,L=>0!==this._dataByOrigin.size&&(L!==t.ShaderOutput.Highlight&&L!==t.ShaderOutput.ShadowHighlight||this._hasAnyHighlight)?
O(L):!1)})}initializeRenderContext(O,K){this._glMaterials=new q.GLMaterials(this.material,K??O.materials);this._bufferWriter=this.material.createBufferWriter();this._vaoCache=O.renderContext.rctx.getVaoCache(this.material.vertexAttributeLocations,u.glLayout(this._bufferWriter.vertexBufferLayout))}uninitializeRenderContext(){}get produces(){return this._produces}get hasOccludees(){return this._hasOccludees}get hasEmissions(){return this.material.hasEmissions}get isDecoration(){return this.material.parameters.isDecoration}queryRenderOccludedState(O){return this.material.queryRenderOccludedState(O)}get numGeometries(){let O=
0;this._dataByOrigin.forEach(K=>O+=K.buffers.reduce((L,P)=>L+=P.instances.size,0));return O}get usedMemory(){let O=0;this._dataByOrigin.forEach(K=>O+=K.buffers.reduce((L,P)=>L+P.vao.usedMemory,0));return O}forEachGeometry(O){this._dataByOrigin.forEach(K=>K.buffers.forEach(L=>L.instances.forEach(({geometry:P})=>O(P))))}modify(O){this._updateGeometries(O.updates);this._addAndRemoveGeometries(O.adds,O.removes);this._updateDrawCommands()}_updateGeometries(O){const K=this._bufferWriter;if(null!=K){var L=
K.vertexBufferLayout.stride/4;for(const R of O){O=R.renderGeometry;const W=this._dataByOrigin.get(O.localOrigin.id)?.findBuffer(O.id);if(null==W)break;const V=W.instances.get(O.id);if(R.updateType&(r.DirtyState.GEOMETRY|r.DirtyState.TRANSFORMATION)){var P=K.elementCount(V.geometry.geometry.attributes)*L;P=F(P);const ba=K.vertexBufferLayout.createView(P.buffer);this._writeGeometry(O,ba,0);W.vao.vertexBuffers.get("geometry").setSubData(P,V.from*L,0,V.numElements*L)}R.updateType&(r.DirtyState.HIGHLIGHT|
r.DirtyState.OCCLUDEE|r.DirtyState.VISIBILITY)&&(W.drawCommandsDirty=!0)}}}_computeDeltas(O,K){const L=new e.NestedMap;for(var P of O){O=P.localOrigin;if(null==O)continue;let R=L.get(O.id,null);null==R&&(R=new D(O.vec3),L.set(O.id,null,R));R.changes.push(P)}for(const R of K)K=R.localOrigin,null!=K&&(P=this._dataByOrigin.get(K.id)?.findBuffer(R.id),null!=P&&(O=L.get(K.id,P),null==O&&(O=new D(K.vec3),L.set(K.id,P,O)),O.changes.push(R)));return L}_addAndRemoveGeometries(O,K){if(null!=this._bufferWriter&&
null!=this._vaoCache){var {_bufferWriter:L,_dataByOrigin:P}=this,R=L.vertexBufferLayout.stride/4,W=this._computeDeltas(O,K);W.forEach((V,ba)=>{const U=V.get(null),da=U?.changes??[];W.delete(ba,null);let fa=P.get(ba);V.forEach((ha,T)=>{W.delete(ba,T);if(null==T)y.assert(!1,"No VAO for removed geometries");else if(T.instances.size===ha.changes.length)this._vaoCache.deleteVao(T.vao),n.removeUnordered(fa.buffers,T),0===fa.buffers.length&&0===da.length&&P.delete(ba);else{var S=T.numElements,Z=T.vao.byteSize/
4,ia=da.reduce((ea,ka)=>ea+L.elementCount(ka.geometry.attributes),0),Y=ha.changes.reduce((ea,ka)=>ea+L.elementCount(ka.geometry.attributes),0);S=Math.min((S+ia-Y)*R,4194304);ia=S>Z;65536<S&&S<Z/2?(ha.changes.forEach(({id:ea})=>T.deleteInstance(ea)),T.instances.forEach(({geometry:ea})=>da.push(ea)),this._vaoCache.deleteVao(T.vao),n.removeUnordered(fa.buffers,T)):ia?this._applyAndRebuild(T,da,ha):this._applyRemoves(T,ha)}});if(0<da.length)for(null==fa&&(fa=new H.PerOriginData(U.origin),P.set(ba,fa)),
fa.buffers.forEach(ha=>this._applyAdds(ha,da));0<da.length;)fa.buffers.push(this._applyAndRebuild(new C.PerBufferData,da,null))})}}_updateDrawCommands(){this._highlightGroups.clear();this._hasOccludees=!1;this._dataByOrigin.forEach(O=>{O.buffers.forEach(K=>{K.updateIfDrawCommandsDirty(this._bufferWriter.vertexBufferLayout.stride);K.hasHighlights&&d.addMany(this._highlightGroups,K.highlightGroups);this._hasOccludees=this._hasOccludees||K.hasOccludees})})}_applyAndRebuild(O,K,L){if(L)for(var P of L.changes)O.deleteInstance(P.id);
const R=this._bufferWriter;L=R.vertexBufferLayout.stride;P=L/4;var W=Math.floor(4194304/P);let V=O.numElements;for(;0<K.length;){const fa=K.pop();var ba=R.elementCount(fa.geometry.attributes);if(V+ba>W&&0<V){K.push(fa);break}V+=ba;ba=new A.Instance(fa,0,0);y.assert(null==O.instances.get(fa.id));O.addInstance(fa.id,ba)}K=V*P;W=F(K);const U=R.vertexBufferLayout.createView(W.buffer);let da=0;O.resetInstanceSummary();O.instances.forEach((fa,ha)=>{this._writeGeometry(fa.geometry,U,da);const T=da;da+=R.elementCount(fa.geometry.geometry.attributes);
O.updateInstance(ha,T,da);O.updateDrawState(fa)});this._vaoCache.deleteVao(O.vao);O.vao=this._vaoCache.newVao(G(K));O.vao.vertexBuffers.get("geometry").setSubData(W,0,0,da*P);O.holes.clear();K=O.holes.pushNew();K.from=da;K.to=Math.floor(O.vao.byteSize/L);O.updateDrawCommands(L);return O}_applyRemoves(O,K){if(0!==K.changes.length&&null!=this._bufferWriter){for(var L of K.changes){var P=L.id;if(K=O.instances.get(P)){O.deleteInstance(P);if(P=N.back()){if(P.to===K.from){P.to=K.to;continue}if(P.from===
K.to){P.from=K.from;continue}}P=N.pushNew();P.from=K.from;P.to=K.to}}z.mergeAdjacentRanges(N);var R=this._bufferWriter.vertexBufferLayout.stride/4;L=N.reduce((ba,U)=>Math.max(ba,U.numElements),0)*R;var W=F(L);W.fill(0,0,L);var V=O.vao.vertexBuffers.get("geometry");N.forAll(ba=>V.setSubData(W,ba.from*R,0,ba.numElements*R));O.holes.pushArray(N.data,N.length);N.forAll((ba,U)=>N.data[U]=null);N.clear();O.drawCommandsDirty=!0}}_applyAdds(O,K){if(0!==K.length&&null!=this._bufferWriter)if(C.hasVao(O)){var L=
this._bufferWriter,P=L.vertexBufferLayout.stride/4,R=O.numElements,W=K.reduce((Z,ia)=>Z+L.elementCount(ia.geometry.attributes),0);R=Math.min((R+W)*P,4194304);W=4*R;if(O.vao.byteSize<G(4128768)&&W>O.vao.byteSize)this._applyAndRebuild(O,K,null);else{z.mergeAdjacentRanges(O.holes);var V=[];for(var ba of K)W=L.elementCount(ba.geometry.attributes),W=E(O.holes,W),V.push(W);var U=O.vao.vertexBuffers.get("geometry"),da=0,fa=0,ha=0,T=F(R),S=L.vertexBufferLayout.createView(T.buffer);K.forEach((Z,ia)=>{ia=V[ia];
if(null!=ia){if(ha!==ia){var Y=ha-fa;0<Y&&U.setSubData(T,fa*P,0,Y*P);fa=ia;da=0}Y=L.elementCount(Z.geometry.attributes);this._writeGeometry(Z,S,da);da+=Y;ha=ia+Y;ia=new A.Instance(Z,ia,ia+Y);y.assert(null==O.instances.get(Z.id));O.addInstance(Z.id,ia);O.drawCommandsDirty=!0}});ba=ha-fa;0<ba&&U.setSubData(T,fa*P,0,ba*P);n.filterInPlace(K,(Z,ia)=>null==V[ia])}}else this._applyAndRebuild(O,K,null)}_writeGeometry(O,K,L){null!=this._bufferWriter&&(w.copy(I,O.transformation),I[12]-=O.localOrigin.vec3[0],
I[13]-=O.localOrigin.vec3[1],I[14]-=O.localOrigin.vec3[2],w.invert(J,I),w.transpose(J,J),this._bufferWriter.write(I,J,O.geometry.attributes,O.geometry.objectAndLayerIdColor,K,L))}updateAnimation(O){return this.material.update(O)}acquireTechniques(O){if(!this.material.shouldRender(O))return null;const {output:K,bind:L}=O;if(!this.material.produces.get(L.slot)?.(K))return null;const {highlightGroupName:P,slot:R}=L,W=K===t.ShaderOutput.ShadowHighlight,V=K===t.ShaderOutput.Highlight,ba=V||W,U=T=>ba&&
(0===this._highlightGroups.size||V&&!!P&&!T.has(P));if(U(this._highlightGroups))return null;const da=K===t.ShaderOutput.ShadowExcludeHighlight,fa=!(ba||da);for(const {buffers:T}of this._dataByOrigin.values())for(const S of T){if(U(S.highlightGroups))continue;var ha=W?0<S.drawCommandsHighlights.size:ba?P?S.drawCommandsHighlights.get(P):0<S.drawCommandsHighlights.size:((da&&S.needsMultipleCommands()?S.drawCommandsShadowHighlightRest:S.drawCommandsDefault)||null)?.length??!1;const Z=fa&&S.drawCommandsOccludees||
null;if(ha||Z?.length)if(ha=this._glMaterials.load(O.rctx,R,K)?.beginSlot(L))return ha}return null}render(O,K){const {output:L,bind:P}=O,{slot:R,highlightGroupName:W}=P,V=L===t.ShaderOutput.Highlight;if(!V||W){var ba=L===t.ShaderOutput.ShadowHighlight,U=V||ba,da=L===t.ShaderOutput.ShadowExcludeHighlight,fa=!(U||da),ha=R===v.RenderSlot.OCCLUDER_MATERIAL||R===v.RenderSlot.TRANSPARENT_OCCLUDER_MATERIAL?R:null,{rctx:T}=O;T.runAppleAmdDriverHelper();O=T.bindTechnique(K,P,this.material.parameters);for(const ia of this._dataByOrigin.values())for(const Y of ia.buffers){if(V&&
(!Y.hasHighlights||!Y.drawCommandsHighlights.has(W)))continue;if(ba&&!Y.hasHighlights)continue;var S=()=>{const ka=[];for(const ja of Y.drawCommandsHighlights.values())ka.push(ja);return ka},Z=U&&!ba?Y.drawCommandsHighlights.get(W)??null:null;S=ba?S():U?Z?[Z]:Q:da&&Y.needsMultipleCommands()?[Y.drawCommandsShadowHighlightRest]:[Y.drawCommandsDefault];Z=S.some(ka=>0<ka.length);const ea=fa&&Y.drawCommandsOccludees||null;if(Z||ea?.length){this._drawParameters.origin=ia.origin;O.bindDraw(P,this.material.parameters,
this._drawParameters);K.ensureAttributeLocations(Y.vao);T.bindVAO(Y.vao);if(Z)for(const ka of S)T.setPipelineState(K.getPipeline(!1,ha)),ka.forAll(ja=>T.drawArrays(K.primitiveType,ja.first,ja.count));ea?.length&&(T.setPipelineState(K.getPipeline(!0,ha)),ea.forAll(ka=>T.drawArrays(K.primitiveType,ka.first,ka.count)))}}}}get test(){}};b.__decorate([f.property({constructOnly:!0})],a.MergedRenderer.prototype,"material",void 0);a.MergedRenderer=b.__decorate([l.subclass("esri.views.3d.webgl-engine.materials.renderers.MergedRenderer")],
a.MergedRenderer);class D{constructor(O){this.origin=O;this.changes=[]}}const I=x.create(),J=x.create(),N=new g({allocator:O=>O||new z.BufferRange,deallocator:null});let M=new Float32Array(65536);const Q=[];a.sizeForVao=G;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/ModelDirtyTypes":function(){define(["exports"],function(a){a.DirtyOperation=void 0;(function(b){b[b.ADD=0]="ADD";b[b.UPDATE=1]="UPDATE";b[b.REMOVE=2]="REMOVE"})(a.DirtyOperation||(a.DirtyOperation=
{}));a.DirtyState=void 0;(function(b){b[b.NONE=0]="NONE";b[b.VISIBILITY=1]="VISIBILITY";b[b.GEOMETRY=2]="GEOMETRY";b[b.TRANSFORMATION=4]="TRANSFORMATION";b[b.HIGHLIGHT=8]="HIGHLIGHT";b[b.OCCLUDEE=16]="OCCLUDEE"})(a.DirtyState||(a.DirtyState={}));Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/renderers/BufferRange":function(){define(["exports"],function(a){class b{constructor(n=0,k=0){this.from=n;this.to=k}get numElements(){return this.to-this.from}}
a.BufferRange=b;a.mergeAdjacentRanges=function(n){const k=new Map;n.forAll(h=>k.set(h.from,h));for(var p=!0;p;){p=!1;for(let h=0;h<n.length;++h){p=n.data[h];const e=k.get(p.to);if(!e)return;p.to=e.to;k.delete(e.from);n.removeUnordered(e);p=!0}}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/renderers/Instance":function(){define(["exports","./BufferRange"],function(a,b){class n extends b.BufferRange{constructor(k,p,h){super(p,h);this.geometry=
k}get isVisible(){return this.geometry.visible}get hasHighlights(){return this.isVisible&&this.geometry.hasHighlights}foreachHighlightGroup(k){this.isVisible&&this.geometry.foreachHighlightGroup(k)}get hasOccludees(){return null!=this.geometry.occludees}}a.Instance=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/renderers/PerBufferData":function(){define(["exports","../../../../../core/PooledArray","./BufferRange","./DrawCommand"],function(a,
b,n,k){function p(){return new b({allocator:d=>d||new k.DrawCommand,deallocator:d=>d})}function h(d,f){const c=d.back();null==c?(d=d.pushNew(),d.first=f.from,d.count=f.numElements):c.first+c.count>=f.from?c.count=f.from-c.first+f.numElements:(d=d.pushNew(),d.first=f.from,d.count=f.numElements)}class e{constructor(){this._numElements=0;this._instances=new Map;this.holes=new b({allocator:d=>d||new n.BufferRange,deallocator:null});this.hasOccludees=this.hasHiddenInstances=!1;this.drawCommandsDirty=!0;
this.highlightGroups=new Set;this.drawCommandsDefault=p();this.drawCommandsHighlights=new Map;this.drawCommandsOccludees=p();this.drawCommandsShadowHighlightRest=p()}get numElements(){return this._numElements}get instances(){return this._instances}get hasHighlights(){return 0<this.highlightGroups.size}resetInstanceSummary(){this.hasOccludees=this.hasHiddenInstances=!1;this.highlightGroups.clear()}updateIfDrawCommandsDirty(d){if(this.drawCommandsDirty){this.resetInstanceSummary();for(const f of this.instances.values())this.updateDrawState(f);
this.updateDrawCommands(d)}}addInstance(d,f){this.deleteInstance(d);this._instances.set(d,f);this._numElements+=f.numElements}deleteInstance(d){const f=this._instances.get(d);f&&(this._numElements-=f.numElements,this._instances.delete(d))}updateInstance(d,f,c){if(d=this._instances.get(d))this._numElements-=d.numElements,d.from=f,d.to=c,this._numElements+=d.numElements}updateDrawState(d){d.isVisible?(d.foreachHighlightGroup(f=>this.highlightGroups.add(f)),d.hasOccludees&&(this.hasOccludees=!0)):this.hasHiddenInstances=
!0}updateDrawCommands(d){this.drawCommandsDefault.clear();this.drawCommandsHighlights.clear();this.drawCommandsOccludees.clear();this.drawCommandsShadowHighlightRest.clear();this.drawCommandsDirty=!1;if(0!==this._instances.size)if(this.needsMultipleCommands()){d=Array.from(this._instances.values()).sort((c,l)=>c.from===l.from?c.to-l.to:c.from-l.from);var {drawCommandsHighlights:f}=this;for(const c of d)c.isVisible&&(h(c.hasOccludees?this.drawCommandsOccludees:this.drawCommandsDefault,c),c.hasHighlights?
c.foreachHighlightGroup(l=>{let w=f.get(l);w||(w=p(),f.set(l,w));h(w,c)}):h(this.drawCommandsShadowHighlightRest,c))}else{const c=this.drawCommandsDefault.pushNew(),l=this.holes.front();null!=this.vao&&1===this.holes.length&&l.to===Math.floor(this.vao.byteSize/d)?(c.first=0,c.count=l.from):(c.first=Infinity,c.count=0,this._instances.forEach(w=>{c.first=Math.min(c.first,w.from);c.count=Math.max(c.count,w.to)}),c.count-=c.first)}}needsMultipleCommands(){return this.hasOccludees||this.hasHighlights||
this.hasHiddenInstances}}class g extends e{}a.PerBufferData=e;a.PerVaoData=g;a.hasVao=function(d){return null!=d.vao};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/renderers/DrawCommand":function(){define(["exports"],function(a){class b{constructor(){this.count=this.first=0}}a.DrawCommand=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/renderers/PerOriginData":function(){define(["exports"],
function(a){class b{constructor(n){this.origin=n;this.buffers=[]}dispose(){this.buffers.forEach(n=>n.vao.dispose());this.buffers.length=0}findBuffer(n){return this.buffers.find(k=>k.instances.has(n))}}a.PerOriginData=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/pipeline/rendering/LodRenderer":function(){define("exports ../../../../../../chunks/tslib.es6 ../../../../../../core/has ../../../../../../core/promiseUtils ../../../../../../core/Logger ../../../../../../core/RandomLCG ../../../../../../core/Error ../../../../../../core/accessorSupport/decorators/subclass ../../../../webgl-engine/lib/VertexAttribute ../../../../webgl-engine/lib/lodRendering/LodRenderer ../../../../webgl-engine/lib/lodRendering/LodResources".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c){function l(x,u){u=u.levels.map(t=>{const m=t.components.map(q=>{const r=x(q.materialId);if(!w(r))throw Error("LodRenderer only supports DefaultMaterial");const v=r.createBufferWriter().vertexBufferLayout;return new c.LodComponentResources({material:r,vertexBufferLayout:v,buffer:q.renderGeometryBuffer.data,elementCount:q.renderGeometryBuffer.elementCount,boundingInfo:q.boundingInfo})});return new c.LodLevelResources(m,t.minScreenSpaceRadius)});return new c.LodResources(u)}
function w(x){return null!=x&&"materialType"in x&&"default"===x.materialType}a.LodRenderer=class{constructor(x){this._optionalFields=[];this._instanceIndexToFeatureId=new Map;this._featureIdToInstanceIndex=new Map;this._disposeResourceHandles=[];this._lodRendererResources=null;this.layerUid=x.layerUid;this.view=x.view;this.sharedResources=this.view.sharedSymbolResources;this.scheduler=this.view.resourceController.scheduler}async doLoad(x,u,t){n("enable-feature:objectAndLayerId-rendering")&&this._optionalFields.push(d.VertexAttribute.OBJECTANDLAYERIDCOLOR);
x=l(v=>u(v),x);const m=this.view._stage,q=c.materialsFromLodResources(x);m.addMany(q);this._addDisposeResource(()=>m.removeMany(q));const r=c.texturesFromLodResources(x);m.addMany(r);this._addDisposeResource(()=>{r.forEach(v=>v.unload());m.removeMany(r)});await Promise.all(r.map(v=>this.view._stage.schedule(()=>v.load(m.renderView.renderingContext),t)));k.throwIfAborted(t);this._lodRendererResources={lodRenderer:await this._createLodRenderer(x,t),materials:q,textures:r}}addInstances(x){var u=this._lodRendererResources;
if(null!=u){var {featureIds:t,localTransforms:m,globalTransforms:q}=x;x=u.lodRenderer;if(null!=x){x=x.instanceData;u=t.length;for(let r=0;r<u;++r){const v=t[r],y=x.addInstance(),B=x.view,z=16*r;B.localTransform.copyFromTypedBuffer(y,m,z);B.globalTransform.copyFromTypedBuffer(y,q,z);x.updateModelTransform(y);x.setVisible(y,!0);this._instanceIndexToFeatureId.set(y,v);this._featureIdToInstanceIndex.set(v,y)}}}}removeInstances(x){var u=this._lodRendererResources;if(null!=u){u=(u?.lodRenderer).instanceData;
var t=this._instanceIndexToFeatureId,m=this._featureIdToInstanceIndex,q=x.length;for(let r=0;r<q;++r){const v=x[r],y=m.get(v);null!=y&&(u.removeInstance(y),t.delete(y),m.delete(v))}}}_addDisposeResource(x){this._disposeResourceHandles.push(x)}async _createLodRenderer(x,u){const t=this.view._stage,m=new f.LodRenderer({symbol:x,optionalFields:this._optionalFields,metadata:{layerUid:this.layerUid,graphicUid:q=>1,notifyGraphicGeometryChanged:q=>1,notifyGraphicVisibilityChanged:q=>1},shaderTransformation:null},
this.scheduler);m.slicePlaneEnabled=!1;this._addDisposeResource(()=>{t.removeRenderPlugin(m);m.destroy()});await t.addRenderPlugin(m,u);return m}};a.LodRenderer=b.__decorate([g.subclass("esri.views.3d.layers.graphics.pipeline.rendering.LodRenderer")],a.LodRenderer);a.isDefaultMaterial=w;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/lodRendering/LodRenderer":function(){define("exports ../../../../../chunks/tslib.es6 ../../../../../core/arrayUtils ../../../../../core/Error ../../../../../core/MapUtils ../../../../../core/maybe ../../../../../core/promiseUtils ../../../../../core/accessorSupport/decorators/property ../../../../../core/has ../../../../../core/Logger ../../../../../core/accessorSupport/decorators/subclass ../../../../../core/libs/gl-matrix-2/factories/mat4f64 ../../../../../chunks/vec32 ../../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../../core/libs/gl-matrix-2/factories/vec4f64 ../../../support/debugFlags ../../../support/buffer/glUtil ../../../support/buffer/InterleavedLayout ../../../webgl/RenderCamera ../../core/shaderLibrary/ShaderOutput ../../effects/RenderPlugin ../DefaultVertexAttributeLocations ../IntersectorInterfaces ../Octree ../RenderSlot ../Util ../VertexAttribute ./InstanceData ./InstanceOctree ./LevelSelector ./LodLevel ./RenderInstanceData ../../materials/internal/MaterialUtil ../../materials/renderers/utils ../../shaders/DefaultMaterialTechnique ../../../../support/Scheduler ../../../../webgl/Util".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w,x,u,t,m,q,r,v,y,B,z,A,C,H,E,F,G,D,I,J,N,M,Q,O,K){function L(T,S,Z){const ia=T.allocateHead();T=T.view;M.encodeDoubleVec3(S.modelOrigin,Z,T.modelOriginHi,T.modelOriginLo,ia);T.model.copyFrom(ia,S.model,Z);T.modelNormal.copyFrom(ia,S.modelNormal,Z);S.color&&T.color&&T.color.copyFrom(ia,S.color,Z);S.objectAndLayerIdColor&&T.objectAndLayerIdColor&&T.objectAndLayerIdColor.copyFrom(ia,S.objectAndLayerIdColor,Z);S.featureAttribute&&T.featureAttribute&&T.featureAttribute.copyFrom(ia,
S.featureAttribute,Z)}function P(T){let S=q.newLayout().vec3f(E.VertexAttribute.INSTANCEMODELORIGINHI).vec3f(E.VertexAttribute.INSTANCEMODELORIGINLO).mat3f(E.VertexAttribute.INSTANCEMODEL).mat3f(E.VertexAttribute.INSTANCEMODELNORMAL);null!=T&&T.includes("featureAttribute")&&(S=S.vec4f(E.VertexAttribute.INSTANCEFEATUREATTRIBUTE));null!=T&&T.includes("color")&&(S=S.vec4u8(E.VertexAttribute.INSTANCECOLOR));null!=T&&T.includes("objectAndLayerIdColor")&&(S=S.vec4u8(E.VertexAttribute.INSTANCEOBJECTANDLAYERIDCOLOR));
return S}const R=T=>{const S=T.baseBoundingSphere.radius;T=T.levels.map(Z=>Z.minScreenSpaceRadius);return new D.LevelSelector(S,T)};a.LodRenderer=class extends y.AsyncRenderPlugin{constructor(T,S){super(T);this.type=z.IntersectorType.LOD;this.isGround=!1;this._levels=[];this._defaultRenderInstanceData=[];this._highlightRenderInstanceDataMap=new Map;this._cycleStartIndex=this._instanceIndex=0;this._slicePlane=!1;this._camera=new r;this._updateCyclesWithStaticCamera=-1;this._needFullCycle=!1;this.produces=
new Map([[C.RenderSlot.OPAQUE_MATERIAL,Z=>this._produces(Z)],[C.RenderSlot.TRANSPARENT_MATERIAL,Z=>this._hasTransparentLevels()?this._produces(Z):!1]]);this._instanceData=new F.InstanceData({shaderTransformation:T.shaderTransformation},T.optionalFields);this.addHandles(S.registerTask(O.TaskPriority.LOD_RENDERER,this))}initialize(){this._instanceBufferLayout=P(this.optionalFields);this._glInstanceBufferLayout=m.glLayout(this._instanceBufferLayout,1);this.addHandles([this._instanceData.events.on("instances-changed",
()=>this._requestUpdateCycle()),this._instanceData.events.on("instance-transform-changed",({index:T})=>{this._requestUpdateCycle();this.metadata.notifyGraphicGeometryChanged(T)}),this._instanceData.events.on("instance-visibility-changed",({index:T})=>{this._requestUpdateCycle(!0);this.metadata.notifyGraphicVisibilityChanged(T)}),this._instanceData.events.on("instance-highlight-changed",()=>this._requestUpdateCycle(!0))])}get _allRenderInstanceData(){const T=[this._defaultRenderInstanceData];for(const S of this._highlightRenderInstanceDataMap)T.push(S[1]);
return T}get _enableLevelSelection(){return 1<this.symbol.levels.length}get levels(){return this._levels}get baseBoundingBox(){return this._levels[this._levels.length-1].boundingBox}get baseBoundingSphere(){return this._levels[this._levels.length-1].boundingSphere}get baseMaterial(){return this._levels[this._levels.length-1].components[0].material}get slicePlaneEnabled(){return this._slicePlane}set slicePlaneEnabled(T){this._slicePlane=T}get layerUid(){return this.metadata.layerUid}get instanceData(){return this._instanceData}get hasEmissions(){return this.baseMaterial.hasEmissions}get usedMemory(){return this._allRenderInstanceData.reduce((T,
S)=>S.reduce((Z,ia)=>Z+ia.usedMemory,T),0)}get renderStats(){const T=this._instanceData.size,S=[];this._levels.forEach((Z,ia)=>{ia=this._allRenderInstanceData[0][ia].size+this._allRenderInstanceData[1][ia].size;Z=Z.triangleCount;S.push({renderedInstances:ia,renderedTriangles:ia*Z,trianglesPerInstance:Z})});return{totalInstances:T,renderedInstances:S.reduce((Z,ia)=>Z+ia.renderedInstances,0),renderedTriangles:S.reduce((Z,ia)=>Z+ia.renderedTriangles,0),levels:S}}_createRenderInstanceDataArray(T=[]){const {rctx:S}=
this._context.renderContext;this.symbol.levels.map(Z=>{T.push(new J.RenderInstanceData(S,this._instanceBufferLayout))});return T}async initializeRenderContext(T,S){this._context=T;this._createRenderInstanceDataArray(this._defaultRenderInstanceData);const Z=await Promise.allSettled(this.symbol.levels.map(Y=>I.LodLevel.create(T,Y,S))),ia=Z.map(Y=>"fulfilled"===Y.status?Y.value:null).filter(n.isSome);if(e.isAborted(S)||ia.length!==Z.length){ia.forEach(Y=>Y.destroy());e.throwIfAborted(S);for(const Y of Z)if("rejected"===
Y.status)throw Y.reason;}this._levels=ia;this._levelSelector=R(this)}uninitializeRenderContext(){this._invalidateOctree();this._levels.forEach(T=>T.destroy());this._defaultRenderInstanceData.forEach(T=>T.destroy());this._highlightRenderInstanceDataMap.forEach(T=>T.forEach(S=>S.destroy()))}_hasTransparentLevels(){return this._levels.some(T=>T.components.some(S=>S.material.produces.get(C.RenderSlot.TRANSPARENT_MATERIAL)?.(v.ShaderOutput.Color)))}hasHighlights(){return p.someMap(this._highlightRenderInstanceDataMap,
T=>T.some(S=>0<S.size))}_produces(T){return T!==v.ShaderOutput.Highlight&&T!==v.ShaderOutput.ShadowHighlight||this.hasHighlights()}prepareRender(T){if(!t.debugFlags.LOD_INSTANCE_RENDERER_DISABLE_UPDATES){if(this._enableLevelSelection){const S=T.bind.contentCamera.equals(this._camera);this._camera.copyFrom(T.bind.contentCamera);S||this._requestUpdateCycle()}this._needFullCycle&&(this.runTask(O.noBudget),this._needFullCycle=!1)}}acquireTechniques(T){if(!this.baseMaterial.visible||!this.baseMaterial.isVisibleForOutput(T.output))return null;
const S=this._getInstanceDatas(T);if(!S)return null;const Z=[],ia=this.levels;S.forEach(Y=>ia.forEach(({components:ea},ka)=>ea.forEach(ja=>Z.push(this._beginComponent(T,Y[ka],ja)))));return Z}render(T,S){const Z=this._getInstanceDatas(T);if(Z&&null!=S){var ia=0;T.rctx.bindVAO();var Y=this.levels;Z.forEach(ea=>Y.forEach(({components:ka},ja)=>ka.forEach(X=>this._renderComponent(T,S[ia++],ea[ja],X,ja))))}}_getInstanceDatas(T){const {output:S,bind:Z}=T;T=S===v.ShaderOutput.Highlight;const ia=S!==v.ShaderOutput.ShadowExcludeHighlight;
if(!T&&S!==v.ShaderOutput.ShadowHighlight)return ia?this._allRenderInstanceData:[this._defaultRenderInstanceData];if(ia){if(T){var {highlightGroupName:Y}=Z;return Y?(Y=this._highlightRenderInstanceDataMap.get(Y))?[Y]:null:null}T=[];for(Y of this._highlightRenderInstanceDataMap)T.push(Y[1]);return T}return null}intersect(T,S,Z,ia){if(this.baseMaterial.visible&&null!=this._octree){var Y=x.create();w.subtract(Y,ia,Z);var ea=ka=>{this._instanceData.getCombinedModelTransform(ka,ba);T.transform.set(ba);
w.transformMat4(U,Z,T.transform.inverse);w.transformMat4(da,ia,T.transform.inverse);const ja=this._instanceData.getState(ka),X=this._instanceData.getLodLevel(ka),aa=this._levels.length;H.assert(0!==(ja&F.StateFlags.ACTIVE),"invalid instance state");H.assert(0<=X&&X<aa,"invaid lod level");this._levels[X].intersect(T,S,U,da,ka,this.metadata,aa)};this.baseMaterial.parameters.verticalOffset?this._octree.forEach(ea):this._octree.forEachAlongRay(Z,Y,ea)}}notifyShaderTransformationChanged(){this._invalidateOctree();
this._requestUpdateCycle()}get _octree(){if(null==this._octreeCached){const T=this._instanceData,S=T.view?.state;if(!S)return null;this._octreeCached=new G.InstanceOctree(T,this.baseBoundingSphere);for(let Z=0;Z<T.capacity;++Z)S.get(Z)&F.StateFlags.ACTIVE&&this._octreeCached.addInstance(Z)}return this._octreeCached}_invalidateOctree(){this._octreeCached=h.destroyMaybe(this._octreeCached)}queryDepthRange(T){if(null==this._octree)return{near:Infinity,far:-Infinity};var S=T.viewForward,Z=this._octree.findClosest(S,
A.DepthOrder.FRONT_TO_BACK,T.frustum);const ia=this._octree.findClosest(S,A.DepthOrder.BACK_TO_FRONT,T.frustum);if(null==Z||null==ia)return{near:Infinity,far:-Infinity};const Y=T.eye,ea=this._instanceData.view;ea.boundingSphere.getVec(Z,V);w.subtract(V,V,Y);Z=w.dot(V,S)-V[3];ea.boundingSphere.getVec(ia,V);w.subtract(V,V,Y);S=w.dot(V,S)+V[3];return{near:Math.max(T.near,Z),far:Math.min(T.far,S)}}_requestUpdateCycle(T=!1){this._updateCyclesWithStaticCamera=-1;this._cycleStartIndex=this._instanceIndex;
T&&(this._needFullCycle=!0,this._context.requestRender())}_startUpdateCycle(){this._updateCyclesWithStaticCamera++;this._allRenderInstanceData.forEach(T=>T.forEach(S=>S.startUpdateCycle()))}get running(){return 0<this._instanceData.size&&1>this._updateCyclesWithStaticCamera}runTask(T){const {_enableLevelSelection:S,_camera:Z,_levelSelector:ia}=this;this._allRenderInstanceData.forEach(la=>la.forEach(na=>na.beginUpdate()));const Y=this._instanceData,ea=Y.view;let ka=Y.size;const ja=Y.capacity;let X=
this._instanceIndex;const aa=Math.ceil(ja/500);for(let la=0;la<ka&&!T.done;++la){X===this._cycleStartIndex&&this._startUpdateCycle();const na=ea.state.get(X);var pa=0;if(!(na&F.StateFlags.ALLOCATED)){X=X+1===ja?0:X+1;ka++;continue}const qa=ea.lodLevel.get(X);na&F.StateFlags.DEFAULT_ACTIVE&&this._defaultRenderInstanceData[qa].freeTail();na&F.StateFlags.HIGHLIGHT_ACTIVE&&Y.foreachHighlightGroupPrev(X,sa=>{if(sa=this._highlightRenderInstanceDataMap.get(sa))sa[qa].freeTail();else throw new k("Internal error in lodRenderer");
});if(na&F.StateFlags.REMOVE)Y.freeInstance(X);else if(na&F.StateFlags.VISIBLE){let sa=0;S&&(ea.modelOrigin.getVec(X,W),sa=ia.selectLevel(W,Y.getCombinedMedianScaleFactor(X),Z));pa=na&~(F.StateFlags.ACTIVE|F.StateFlags.TRANSFORM_CHANGED);0<=sa&&(na&F.StateFlags.HIGHLIGHT?(Y.foreachHighlightGroup(X,xa=>{let ta=this._highlightRenderInstanceDataMap.get(xa);ta||(ta=this._createRenderInstanceDataArray(),ta.forEach(Ba=>Ba.beginUpdate()),this._highlightRenderInstanceDataMap.set(xa,ta));if(sa>=ta.length)throw new k(`LodRenderer internal error - missing lodLevel ${sa}`);
L(ta[sa],ea,X)}),pa|=F.StateFlags.HIGHLIGHT_ACTIVE):(L(this._defaultRenderInstanceData[sa],ea,X),pa|=F.StateFlags.DEFAULT_ACTIVE));ea.state.set(X,pa);ea.lodLevel.set(X,sa)}else pa=na&~(F.StateFlags.ACTIVE|F.StateFlags.TRANSFORM_CHANGED),ea.state.set(X,pa);if(null!=this._octreeCached){const sa=!!(na&F.StateFlags.ACTIVE);pa=!!(pa&F.StateFlags.ACTIVE);!sa&&pa?this._octreeCached.addInstance(X):sa&&!pa?this._octreeCached.removeInstance(X):sa&&pa&&na&F.StateFlags.TRANSFORM_CHANGED&&(this._octreeCached.removeInstance(X),
this._octreeCached.addInstance(X))}X=X+1===ja?0:X+1;0===X%aa&&T.madeProgress()}this._instanceIndex=X;this._allRenderInstanceData.forEach(la=>la.forEach(na=>na.endUpdate()));this._context.requestRender()}_beginComponent(T,S,Z){return 0===S.size?null:Z.glMaterials.load(T.rctx,T.bind.slot,T.output)?.beginSlot(T.bind)}_renderComponent(T,S,Z,ia,Y){if(S){var {bind:ea,rctx:ka}=T;ka.runAppleAmdDriverHelper();var ja=ka.bindTechnique(S,ea,ia.material.parameters,ha);ka.bindVAO(ia.vao);S.ensureAttributeLocations(ia.vao);
t.debugFlags.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL&&T.output===v.ShaderOutput.Color&&(ja.setUniform4fv("externalColor",fa[Math.min(Y,fa.length-1)]),ja.setUniform1i("colorMixMode",N.colorMixModes.replace));T=Z.capacity;Y=Z.headIndex;ja=Z.tailIndex;var X=Z.firstIndex,aa=this._glInstanceBufferLayout,pa=(la,na)=>{K.bindVertexBufferLayout(ka,B.Default3D,Z.buffer,aa,la);ka.drawArraysInstanced(S.primitiveType,0,ia.vertexCount,na-la);K.unbindVertexBufferLayout(ka,B.Default3D,Z.buffer,aa)};ia.material.parameters.transparent&&
null!=X?Y>ja?(H.assert(X>=ja&&X<=Y,"invalid firstIndex"),pa(X,Y),pa(ja,X)):Y<ja&&(X<=Y?(H.assert(0<=X&&X<=Y,"invalid firstIndex"),pa(X,Y),pa(ja,T),pa(0,X)):(H.assert(X>=ja&&X<=T,"invalid firstIndex"),pa(X,T),pa(0,Y),pa(ja,X))):Y>ja?pa(ja,Y):Y<ja&&(pa(0,Y),pa(ja,T));ka.bindVAO(null)}}};b.__decorate([g.property({constructOnly:!0})],a.LodRenderer.prototype,"symbol",void 0);b.__decorate([g.property({constructOnly:!0})],a.LodRenderer.prototype,"optionalFields",void 0);b.__decorate([g.property({constructOnly:!0})],
a.LodRenderer.prototype,"metadata",void 0);b.__decorate([g.property({constructOnly:!0})],a.LodRenderer.prototype,"shaderTransformation",void 0);b.__decorate([g.property()],a.LodRenderer.prototype,"_instanceData",void 0);b.__decorate([g.property()],a.LodRenderer.prototype,"_cycleStartIndex",void 0);b.__decorate([g.property({readOnly:!0})],a.LodRenderer.prototype,"_enableLevelSelection",null);b.__decorate([g.property()],a.LodRenderer.prototype,"_updateCyclesWithStaticCamera",void 0);b.__decorate([g.property({readOnly:!0})],
a.LodRenderer.prototype,"running",null);a.LodRenderer=b.__decorate([c.subclass("esri.views.3d.webgl-engine.lib.lodRendering.LodRenderer")],a.LodRenderer);const W=x.create(),V=u.create(),ba=l.create(),U=x.create(),da=x.create(),fa=[u.fromValues(1,0,1,1),u.fromValues(0,0,1,1),u.fromValues(0,1,0,1),u.fromValues(1,1,0,1),u.fromValues(1,0,0,1)],ha=new Q.DefaultMaterialDrawParameters;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/Octree":function(){define("../../../../core/ObjectPool ../../../../core/PooledArray ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../geometry/support/frustum ../../../../geometry/support/ray ../../../../chunks/sphere ./Util".split(" "),
function(a,b,n,k,p,h,e,g){function d(R,W){R=z.acquire().init(R);const V=[R];for(;0!==V.length;){R=V.pop();if(W(R)&&!R.isLeaf())for(let ba=0;ba<R.node.children.length;ba++)R.node.children[ba]&&V.push(z.acquire().init(R).advance(ba));z.release(R)}}function f(R,W,V,ba=B.DepthOrder.FRONT_TO_BACK){R=z.acquire().init(R);const U=[R];for(q(V,ba,P);0!==U.length;){R=U.pop();if(W(R)&&!R.isLeaf())for(V=7;0<=V;--V)ba=P[V],R.node.children[ba]&&U.push(z.acquire().init(R).advance(ba));z.release(R)}}function c(R,
W,V){J.clear();W=V.advanceTo(W,(ba,U)=>{J.push(ba.node);J.push(U)})?V.node.terminals:V.node.residents;W.removeUnordered(R);if(0===W.length)for(R=J.length-2;0<=R&&l(J.data[R],J.data[R+1]);R-=2);}function l(R,W){0<=W&&(R.children[W]=null);return u(R)?(null===R.residents&&(R.residents=new b({shrink:!0})),!0):!1}function w(R,W){t(e.getCenter(W.bounds),2*-W.halfSize,D);t(e.getCenter(W.bounds),2*W.halfSize,I);return g.rayBoxTest(R.origin,R.direction,D,I)}function x(R,W,V){t(e.getCenter(W.bounds),2*-W.halfSize,
D);t(e.getCenter(W.bounds),2*W.halfSize,I);V.applyToMinMax(D,I);return g.rayBoxTest(R.origin,R.direction,D,I)}function u(R){if(0!==R.terminals.length)return!1;if(null!==R.residents)return 0===R.residents.length;for(let W=0;W<R.children.length;W++)if(R.children[W])return!1;return!0}function t(R,W,V){V[0]=R[0]+W;V[1]=R[1]+W;V[2]=R[2]+W}function m(R,W,V,ba){if(1===W)R=V(R[0]),e.copy(R,ba);else{D[0]=Infinity;D[1]=Infinity;D[2]=Infinity;I[0]=-Infinity;I[1]=-Infinity;I[2]=-Infinity;for(let ha=0;ha<W;ha++){var U=
V(R[ha]);if(y(U[3])){var da=D,fa=U;da[0]=Math.min(da[0],fa[0]-fa[3]);da[1]=Math.min(da[1],fa[1]-fa[3]);da[2]=Math.min(da[2],fa[2]-fa[3]);da=I;da[0]=Math.max(da[0],U[0]+U[3]);da[1]=Math.max(da[1],U[1]+U[3]);da[2]=Math.max(da[2],U[2]+U[3])}}n.lerp(e.getCenter(ba),D,I,.5);ba[3]=Math.max(I[0]-D[0],I[1]-D[1],I[2]-D[2])/2}}function q(R,W,V){if(!L.length)for(var ba=0;8>ba;++ba)L.push({index:0,distance:0});for(ba=0;8>ba;++ba){const U=A[ba];L.data[ba].index=ba;L.data[ba].distance=v(R,W,U)}L.sort((U,da)=>U.distance-
da.distance);for(R=0;8>R;++R)V[R]=L.data[R].index}function r(R,W){let V=Infinity,ba;for(let U=0;8>U;++U){const da=v(R,W,C[U]);da<V&&(V=da,ba=C[U])}return ba}function v(R,W,V){return W*(R[0]*V[0]+R[1]*V[1]+R[2]*V[2])}function y(R){return!isNaN(R)&&-Infinity!==R&&Infinity!==R&&0<R}class B{get bounds(){return this._root.bounds}get halfSize(){return this._root.halfSize}get root(){return this._root.node}get maximumObjectsPerNode(){return this._maximumObjectsPerNode}get maximumDepth(){return this._maximumDepth}get objectCount(){return this._objectCount}constructor(R,
W){this.objectToBoundingSphere=R;this._maximumObjectsPerNode=10;this._maximumDepth=20;this._degenerateObjects=new Set;this._root=new z;this._objectCount=0;W&&(void 0!==W.maximumObjectsPerNode&&(this._maximumObjectsPerNode=W.maximumObjectsPerNode),void 0!==W.maximumDepth&&(this._maximumDepth=W.maximumDepth))}destroy(){this._degenerateObjects.clear();z.clearPool();E[0]=null;J.prune();L.prune()}add(R,W=R.length){this._objectCount+=W;this._grow(R,W);const V=z.acquire();for(let ba=0;ba<W;ba++){const U=
R[ba];this._isDegenerate(U)?this._degenerateObjects.add(U):(V.init(this._root),this._add(U,V))}z.release(V)}remove(R,W=null){this._objectCount-=R.length;const V=z.acquire();for(const ba of R)R=W??e.copy(this.objectToBoundingSphere(ba),N),y(R[3])?(V.init(this._root),c(ba,R,V)):this._degenerateObjects.delete(ba);z.release(V);this._shrink()}update(R,W){if(y(W[3])||!this._isDegenerate(R))E[0]=R,R=E,this.remove(R,W),this.add(R)}forEachAlongRay(R,W,V){const ba=h.wrap(R,W);d(this._root,U=>{if(!w(ba,U))return!1;
U=U.node;U.terminals.forAll(da=>{this._intersectsObject(ba,da)&&V(da)});null!==U.residents&&U.residents.forAll(da=>{this._intersectsObject(ba,da)&&V(da)});return!0})}forEachAlongRayWithVerticalOffset(R,W,V,ba){const U=h.wrap(R,W);d(this._root,da=>{if(!x(U,da,ba))return!1;da=da.node;da.terminals.forAll(fa=>{this._intersectsObjectWithOffset(U,fa,ba)&&V(fa)});null!==da.residents&&da.residents.forAll(fa=>{this._intersectsObjectWithOffset(U,fa,ba)&&V(fa)});return!0})}forEach(R){d(this._root,W=>{W=W.node;
W.terminals.forAll(R);null!==W.residents&&W.residents.forAll(R);return!0});this._degenerateObjects.forEach(R)}forEachDegenerateObject(R){this._degenerateObjects.forEach(R)}findClosest(R,W,V,ba=()=>!0,U=Infinity){let da=Infinity,fa=Infinity,ha=null;const T=r(R,W),S=Z=>{--U;if(ba(Z)){var ia=this.objectToBoundingSphere(Z);if(p.intersectsSphere(V,ia)){var Y=v(R,W,e.getCenter(ia)),ea=Y-ia[3];ia=Y+ia[3];ea<da&&(da=ea,fa=ia,ha=Z)}}};f(this._root,Z=>{if(0>=U||!p.intersectsSphere(V,Z.bounds))return!1;n.scale(G,
T,Z.halfSize);n.add(G,G,e.getCenter(Z.bounds));if(v(R,W,G)>fa)return!1;Z=Z.node;Z.terminals.forAll(ia=>S(ia));null!==Z.residents&&Z.residents.forAll(ia=>S(ia));return!0},R,W);return ha}forEachInDepthRange(R,W,V,ba,U,da,fa){let ha=-Infinity,T=Infinity;const S={setRange:ka=>{V===B.DepthOrder.FRONT_TO_BACK?(ha=Math.max(ha,ka.near),T=Math.min(T,ka.far)):(ha=Math.max(ha,-ka.far),T=Math.min(T,-ka.near))}};S.setRange(ba);const Z=v(W,V,R),ia=r(W,V),Y=r(W,-V),ea=ka=>{if(fa(ka)){var ja=this.objectToBoundingSphere(ka),
X=e.getCenter(ja);X=v(W,V,X)-Z;var aa=X+ja[3];X-ja[3]>T||aa<ha||!p.intersectsSphere(da,ja)||U(ka,S)}};f(this._root,ka=>{if(!p.intersectsSphere(da,ka.bounds))return!1;n.scale(G,ia,ka.halfSize);n.add(G,G,e.getCenter(ka.bounds));if(v(W,V,G)-Z>T)return!1;n.scale(G,Y,ka.halfSize);n.add(G,G,e.getCenter(ka.bounds));if(v(W,V,G)-Z<ha)return!1;ka=ka.node;ka.terminals.forAll(ja=>ea(ja));null!==ka.residents&&ka.residents.forAll(ja=>ea(ja));return!0},W,V)}forEachNode(R){d(this._root,W=>R(W.node,W.bounds,W.halfSize,
W.depth))}forEachNeighbor(R,W){const V=e.getRadius(W),ba=e.getCenter(W),U=ha=>{const T=this.objectToBoundingSphere(ha);var S=e.getRadius(T);S=V+S;return 0>=n.squaredDistance(e.getCenter(T),ba)-S*S?R(ha):!0};let da=!0;const fa=ha=>{da&&=U(ha)};d(this._root,ha=>{var T=e.getRadius(ha.bounds);T=V+T;if(0<n.squaredDistance(e.getCenter(ha.bounds),ba)-T*T)return!1;ha=ha.node;ha.terminals.forAll(fa);da&&null!==ha.residents&&ha.residents.forAll(fa);return da});da&&this.forEachDegenerateObject(fa)}_intersectsObject(R,
W){W=this.objectToBoundingSphere(W);return 0<W[3]?e.intersectsRay(W,R):!0}_intersectsObjectWithOffset(R,W,V){W=this.objectToBoundingSphere(W);return 0<W[3]?e.intersectsRay(V.applyToBoundingSphere(W),R):!0}_add(R,W){W.advanceTo(this.objectToBoundingSphere(R))?W.node.terminals.push(R):(W.node.residents.push(R),W.node.residents.length>this._maximumObjectsPerNode&&W.depth<this._maximumDepth&&this._split(W))}_split(R){const W=R.node.residents;R.node.residents=null;for(let V=0;V<W.length;V++){const ba=
z.acquire().init(R);this._add(W.at(V),ba);z.release(ba)}}_grow(R,W){0!==W&&(m(R,W,V=>this.objectToBoundingSphere(V),M),y(M[3])&&!this._fitsInsideTree(M)&&(u(this._root.node)?(e.copy(M,this._root.bounds),this._root.halfSize=1.25*this._root.bounds[3],this._root.updateBoundsRadiusFromHalfSize()):(R=this._rootBoundsForRootAsSubNode(M),this._placingRootViolatesMaxDepth(R)?this._rebuildTree(M,R):this._growRootAsSubNode(R),z.release(R))))}_rebuildTree(R,W){n.copy(e.getCenter(Q),e.getCenter(W.bounds));Q[3]=
W.halfSize;m([R,Q],2,V=>V,O);R=z.acquire().init(this._root);this._root.initFrom(null,O,O[3]);this._root.increaseHalfSize(1.25);d(R,V=>{this.add(V.node.terminals.data,V.node.terminals.length);null!==V.node.residents&&this.add(V.node.residents.data,V.node.residents.length);return!0});z.release(R)}_placingRootViolatesMaxDepth(R){const W=Math.log(R.halfSize/this._root.halfSize)*Math.LOG2E;let V=0;d(this._root,ba=>{V=Math.max(V,ba.depth);return V+W<=this._maximumDepth});return V+W>this._maximumDepth}_rootBoundsForRootAsSubNode(R){var W=
R[3],V=-Infinity;const ba=this._root.bounds,U=this._root.halfSize;for(var da=0;3>da;da++){var fa=Math.max(0,Math.ceil((ba[da]-U-(R[da]-W))/(2*U)));const ha=Math.max(0,Math.ceil((R[da]+W-(ba[da]+U))/(2*U)))+1;V=Math.max(V,2**Math.ceil(Math.log(fa+ha)*Math.LOG2E));K[da].min=fa;K[da].max=ha}for(R=0;3>R;R++)W=K[R].min,da=K[R].max,fa=(V-(W+da))/2,W+=Math.ceil(fa),da+=Math.floor(fa),F[R]=ba[R]-U-W*U*2+(da+W)*U;V*=U;F[3]=V*H;return z.acquire().initFrom(null,F,V,0)}_growRootAsSubNode(R){const W=this._root.node;
n.copy(e.getCenter(M),e.getCenter(this._root.bounds));M[3]=this._root.halfSize;this._root.init(R);R.advanceTo(M,null,!0);R.node.children=W.children;R.node.residents=W.residents;R.node.terminals=W.terminals}_shrink(){for(;;){const R=this._findShrinkIndex();if(-1===R)break;this._root.advance(R);this._root.depth=0}}_findShrinkIndex(){if(0!==this._root.node.terminals.length||this._root.isLeaf())return-1;let R=null;const W=this._root.node.children;let V=0,ba=0;for(;ba<W.length&&null==R;)V=ba++,R=W[V];
for(;ba<W.length;)if(W[ba++])return-1;return V}_isDegenerate(R){R=this.objectToBoundingSphere(R)[3];return!y(R)}_fitsInsideTree(R){const W=this._root.bounds,V=this._root.halfSize;return R[3]<=V&&R[0]>=W[0]-V&&R[0]<=W[0]+V&&R[1]>=W[1]-V&&R[1]<=W[1]+V&&R[2]>=W[2]-V&&R[2]<=W[2]+V}toJSON(){const {maximumDepth:R,maximumObjectsPerNode:W,_objectCount:V}=this,ba=this._nodeToJSON(this._root.node);return{maximumDepth:R,maximumObjectsPerNode:W,objectCount:V,root:{bounds:this._root.bounds,halfSize:this._root.halfSize,
depth:this._root.depth,node:ba}}}_nodeToJSON(R){const W=R.children.map(ba=>ba?this._nodeToJSON(ba):null),V=R.residents?.map(ba=>this.objectToBoundingSphere(ba));R=R.terminals?.map(ba=>this.objectToBoundingSphere(ba));return{children:W,residents:V,terminals:R}}static fromJSON(R){const W=new B(V=>V,{maximumDepth:R.maximumDepth,maximumObjectsPerNode:R.maximumObjectsPerNode});W._objectCount=R.objectCount;W._root.initFrom(R.root.node,R.root.bounds,R.root.halfSize,R.root.depth);return W}}class z{constructor(){this.bounds=
e.create();this.halfSize=0;this.initFrom(null,null,0,0)}init(R){return this.initFrom(R.node,R.bounds,R.halfSize,R.depth)}initFrom(R,W,V,ba=this.depth){this.node=null!=R?R:z.createEmptyNode();W&&e.copy(W,this.bounds);this.halfSize=V;this.depth=ba;return this}increaseHalfSize(R){this.halfSize*=R;this.updateBoundsRadiusFromHalfSize()}updateBoundsRadiusFromHalfSize(){this.bounds[3]=this.halfSize*H}advance(R){let W=this.node.children[R];W||(W=z.createEmptyNode(),this.node.children[R]=W);this.node=W;this.halfSize/=
2;this.depth++;R=A[R];this.bounds[0]+=R[0]*this.halfSize;this.bounds[1]+=R[1]*this.halfSize;this.bounds[2]+=R[2]*this.halfSize;this.updateBoundsRadiusFromHalfSize();return this}advanceTo(R,W,V=!1){for(;;){if(this.isTerminalFor(R))return W&&W(this,-1),!0;if(this.isLeaf()){if(!V)return W&&W(this,-1),!1;this.node.residents=null}const ba=this._childIndex(R);W&&W(this,ba);this.advance(ba)}}isLeaf(){return null!=this.node.residents}isTerminalFor(R){return R[3]>this.halfSize/2}_childIndex(R){const W=this.bounds;
return(W[0]<R[0]?1:0)+(W[1]<R[1]?2:0)+(W[2]<R[2]?4:0)}static createEmptyNode(){return{children:[null,null,null,null,null,null,null,null],terminals:new b({shrink:!0}),residents:new b({shrink:!0})}}static acquire(){return z._pool.acquire()}static release(R){z._pool.release(R)}static clearPool(){z._pool.prune()}}z._pool=new a(z);(function(R){R=R.DepthOrder||(R.DepthOrder={});R[R.FRONT_TO_BACK=1]="FRONT_TO_BACK";R[R.BACK_TO_FRONT=-1]="BACK_TO_FRONT"})(B||={});const A=[k.fromValues(-1,-1,-1),k.fromValues(1,
-1,-1),k.fromValues(-1,1,-1),k.fromValues(1,1,-1),k.fromValues(-1,-1,1),k.fromValues(1,-1,1),k.fromValues(-1,1,1),k.fromValues(1,1,1)],C=[k.fromValues(-1,-1,-1),k.fromValues(-1,-1,1),k.fromValues(-1,1,-1),k.fromValues(-1,1,1),k.fromValues(1,-1,-1),k.fromValues(1,-1,1),k.fromValues(1,1,-1),k.fromValues(1,1,1)],H=Math.sqrt(3),E=[null],F=e.create(),G=k.create(),D=k.create(),I=k.create(),J=new b,N=e.create(),M=e.create(),Q=e.create(),O=e.create(),K=[{min:0,max:0},{min:0,max:0},{min:0,max:0}],L=new b,
P=[0,0,0,0,0,0,0,0];return B})},"esri/views/3d/webgl-engine/lib/lodRendering/InstanceData":function(){define("exports ../../../../../chunks/tslib.es6 ../../../../../core/Accessor ../../../../../core/arrayUtils ../../../../../core/Evented ../../../../../core/accessorSupport/decorators/property ../../../../../core/has ../../../../../core/Logger ../../../../../core/accessorSupport/decorators/subclass ../../../../../core/libs/gl-matrix-2/math/mat3 ../../../../../core/libs/gl-matrix-2/factories/mat3f64 ../../../../../core/libs/gl-matrix-2/math/mat4 ../../../../../core/libs/gl-matrix-2/factories/mat4f64 ../../../../../chunks/vec32 ../../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../../geometry/support/buffer/BufferView ../../../support/mathUtils ../../../support/buffer/InterleavedLayout ../Util ../VertexAttribute ./RenderInstanceData".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w,x,u,t,m,q,r,v,y){a.StateFlags=void 0;(function(E){E[E.ALLOCATED=1]="ALLOCATED";E[E.DEFAULT_ACTIVE=2]="DEFAULT_ACTIVE";E[E.VISIBLE=4]="VISIBLE";E[E.HIGHLIGHT=8]="HIGHLIGHT";E[E.HIGHLIGHT_ACTIVE=16]="HIGHLIGHT_ACTIVE";E[E.REMOVE=32]="REMOVE";E[E.TRANSFORM_CHANGED=64]="TRANSFORM_CHANGED";E[E.ACTIVE=18]="ACTIVE"})(a.StateFlags||(a.StateFlags={}));class B{constructor(E){this.localTransform=E.getField(v.VertexAttribute.LOCALTRANSFORM,t.BufferViewMat4f64);this.globalTransform=
E.getField(v.VertexAttribute.GLOBALTRANSFORM,t.BufferViewMat4f64);this.modelOrigin=E.getField(v.VertexAttribute.MODELORIGIN,t.BufferViewVec3f64);this.model=E.getField(v.VertexAttribute.INSTANCEMODEL,t.BufferViewMat3f);this.modelNormal=E.getField(v.VertexAttribute.INSTANCEMODELNORMAL,t.BufferViewMat3f);this.modelScaleFactors=E.getField(v.VertexAttribute.MODELSCALEFACTORS,t.BufferViewVec2f);this.boundingSphere=E.getField(v.VertexAttribute.BOUNDINGSPHERE,t.BufferViewVec4f64);this.featureAttribute=E.getField(v.VertexAttribute.FEATUREATTRIBUTE,
t.BufferViewVec4f);this.color=E.getField(v.VertexAttribute.COLOR,t.BufferViewVec4u8);this.objectAndLayerIdColor=E.getField(v.VertexAttribute.OBJECTANDLAYERIDCOLOR,t.BufferViewVec4u8);this.state=E.getField(v.VertexAttribute.STATE,t.BufferViewUint8);this.lodLevel=E.getField(v.VertexAttribute.LODLEVEL,t.BufferViewUint8)}}a.InstanceData=class extends n{constructor(E,F){super(E);this.events=new p;this._next=this._size=this._capacity=0;this._highlightGroupMap=new Map;this._highlightGroupMapPrev=new Map;
E=q.newLayout().mat4f64(v.VertexAttribute.LOCALTRANSFORM).mat4f64(v.VertexAttribute.GLOBALTRANSFORM).vec4f64(v.VertexAttribute.BOUNDINGSPHERE).vec3f64(v.VertexAttribute.MODELORIGIN).mat3f(v.VertexAttribute.INSTANCEMODEL).mat3f(v.VertexAttribute.INSTANCEMODELNORMAL).vec2f(v.VertexAttribute.MODELSCALEFACTORS);F.includes(v.VertexAttribute.FEATUREATTRIBUTE)&&(E=E.vec4f(v.VertexAttribute.FEATUREATTRIBUTE));F.includes(v.VertexAttribute.COLOR)&&(E=E.vec4u8(v.VertexAttribute.COLOR));F.includes(v.VertexAttribute.OBJECTANDLAYERIDCOLOR)&&
(E=E.vec4u8(v.VertexAttribute.OBJECTANDLAYERIDCOLOR));this._layout=E=E.u8(v.VertexAttribute.STATE).u8(v.VertexAttribute.LODLEVEL);this._capacity=y.initialCapacity;this._buffer=this._layout.createBuffer(this._capacity);this._view=new B(this._buffer)}get capacity(){return this._capacity}get size(){return this._size}get view(){return this._view}addInstance(){this._size+1>this._capacity&&this._grow();const E=this._findSlot();this._view.state.set(E,a.StateFlags.ALLOCATED);this._size++;this.events.emit("instances-changed");
return E}removeInstance(E){const F=this._view.state;r.assert(0<=E&&E<this._capacity&&0!==(F.get(E)&a.StateFlags.ALLOCATED),"invalid instance handle");this._getStateFlag(E,a.StateFlags.ACTIVE)?this._setStateFlags(E,a.StateFlags.REMOVE):this.freeInstance(E);this.events.emit("instances-changed")}freeInstance(E){const F=this._view.state;r.assert(0<=E&&E<this._capacity&&0!==(F.get(E)&a.StateFlags.ALLOCATED),"invalid instance handle");F.set(E,0);this._size--}setLocalTransform(E,F,G=!0){this._view.localTransform.setMat(E,
F);G&&this.updateModelTransform(E)}getLocalTransform(E,F){this._view.localTransform.getMat(E,F)}setGlobalTransform(E,F,G=!0){this._view.globalTransform.setMat(E,F);G&&this.updateModelTransform(E)}getGlobalTransform(E,F){this._view.globalTransform.getMat(E,F)}updateModelTransform(E){const F=this._view;var G=z;const D=A;F.localTransform.getMat(E,C);F.globalTransform.getMat(E,H);const I=l.multiply(H,H,C);x.set(G,I[12],I[13],I[14]);F.modelOrigin.setVec(E,G);f.fromMat4(D,I);F.model.setMat(E,D);G=m.scaleFromMatrix(z,
I);G.sort();F.modelScaleFactors.set(E,0,G[1]);F.modelScaleFactors.set(E,1,G[2]);f.invert(D,D);f.transpose(D,D);F.modelNormal.setMat(E,D);this._setStateFlags(E,a.StateFlags.TRANSFORM_CHANGED);this.events.emit("instance-transform-changed",{index:E})}getModelTransform(E,F){const G=this._view;G.model.getMat(E,A);G.modelOrigin.getVec(E,z);F[0]=A[0];F[1]=A[1];F[2]=A[2];F[3]=0;F[4]=A[3];F[5]=A[4];F[6]=A[5];F[7]=0;F[8]=A[6];F[9]=A[7];F[10]=A[8];F[11]=0;F[12]=z[0];F[13]=z[1];F[14]=z[2];F[15]=1}applyShaderTransformation(E,
F){null!=this.shaderTransformation&&this.shaderTransformation.applyTransform(this,E,F)}getCombinedModelTransform(E,F){this.getModelTransform(E,F);null!=this.shaderTransformation&&this.shaderTransformation.applyTransform(this,E,F);return F}getCombinedLocalTransform(E,F){this._view.localTransform.getMat(E,F);null!=this.shaderTransformation&&this.shaderTransformation.applyTransform(this,E,F)}getCombinedMaxScaleFactor(E){let F=this._view.modelScaleFactors.get(E,1);null!=this.shaderTransformation&&(this.shaderTransformation.scaleFactor(z,
this,E),F*=Math.max(z[0],z[1],z[2]));return F}getCombinedMedianScaleFactor(E){let F=this._view.modelScaleFactors.get(E,0);if(null!=this.shaderTransformation){this.shaderTransformation.scaleFactor(z,this,E);E=z[0];var G=z[1];F*=Math.max(Math.min(E,G),Math.min(Math.max(E,G),z[2]))}return F}getModel(E,F){this._view.model.getMat(E,F)}setFeatureAttribute(E,F){this._view.featureAttribute.setVec(E,F)}getFeatureAttribute(E,F){this._view.featureAttribute.getVec(E,F)}setColor(E,F){this._view.color.setVec(E,
F)}setObjectAndLayerIdColor(E,F){this._view.objectAndLayerIdColor.setVec(E,F)}setVisible(E,F){F!==this.getVisible(E)&&(this._setStateFlag(E,a.StateFlags.VISIBLE,F),this.events.emit("instance-visibility-changed",{index:E}))}getVisible(E){return this._getStateFlag(E,a.StateFlags.VISIBLE)}setHighlight(E,F,G){let D=this._highlightGroupMap.get(E);F?(D||(D=new Set,this._highlightGroupMap.set(E,D)),D.add(G)&&(this._setStateFlag(E,a.StateFlags.HIGHLIGHT,!0),this.events.emit("instance-highlight-changed"))):
D?.delete(G)&&(0===D.size&&(this._highlightGroupMap.delete(E),this._setStateFlag(E,a.StateFlags.HIGHLIGHT,!1)),this.events.emit("instance-highlight-changed"))}getHighlight(E){return this._getStateFlag(E,a.StateFlags.HIGHLIGHT)}foreachHighlightGroupPrev(E,F){this._highlightGroupMapPrev.get(E)?.forEach(F);this._highlightGroupMapPrev.delete(E)}foreachHighlightGroup(E,F){const G=this._highlightGroupMap.get(E);G?.forEach(F);G?this._highlightGroupMapPrev.set(E,new Set(G)):this._highlightGroupMapPrev.delete(E)}getState(E){return this._view.state.get(E)}getLodLevel(E){return this._view.lodLevel.get(E)}countFlags(E){let F=
0;for(let G=0;G<this._capacity;++G)this.getState(G)&E&&++F;return F}_setStateFlags(E,F){const G=this._view.state;F|=G.get(E);G.set(E,F)}_clearStateFlags(E,F){const G=this._view.state;F=G.get(E)&~F;G.set(E,F)}_setStateFlag(E,F,G){G?this._setStateFlags(E,F):this._clearStateFlags(E,F)}_getStateFlag(E,F){return!!(this._view.state.get(E)&F)}_grow(){this._capacity=Math.max(y.initialCapacity,Math.floor(this._capacity*k.reallocGrowthFactor));this._buffer=this._layout.createBuffer(this._capacity).copyFrom(this._buffer);
this._view=new B(this._buffer)}_findSlot(){const E=this._view.state;let F=this._next;for(;E.get(F)&a.StateFlags.ALLOCATED;)F=F+1===this._capacity?0:F+1;this._next=F+1===this._capacity?0:F+1;return F}};b.__decorate([h.property({constructOnly:!0})],a.InstanceData.prototype,"shaderTransformation",void 0);b.__decorate([h.property()],a.InstanceData.prototype,"_size",void 0);b.__decorate([h.property({readOnly:!0})],a.InstanceData.prototype,"size",null);a.InstanceData=b.__decorate([d.subclass("esri.views.3d.webgl-engine.lib.lodRendering.InstanceData")],
a.InstanceData);const z=u.create(),A=c.create(),C=w.create(),H=w.create();a.InstanceDataView=B;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/lodRendering/RenderInstanceData":function(){define("exports ../../../../../core/arrayUtils ../../../../../geometry/support/buffer/BufferView ../Util ../VertexAttribute ./BackedBufferObject".split(" "),function(a,b,n,k,p,h){class e{constructor(d){this.modelOriginHi=d.getField(p.VertexAttribute.INSTANCEMODELORIGINHI,
n.BufferViewVec3f);this.modelOriginLo=d.getField(p.VertexAttribute.INSTANCEMODELORIGINLO,n.BufferViewVec3f);this.model=d.getField(p.VertexAttribute.INSTANCEMODEL,n.BufferViewMat3f);this.modelNormal=d.getField(p.VertexAttribute.INSTANCEMODELNORMAL,n.BufferViewMat3f);this.featureAttribute=d.getField(p.VertexAttribute.INSTANCEFEATUREATTRIBUTE,n.BufferViewVec4f);this.color=d.getField(p.VertexAttribute.INSTANCECOLOR,n.BufferViewVec4u8);this.objectAndLayerIdColor=d.getField(p.VertexAttribute.INSTANCEOBJECTANDLAYERIDCOLOR,
n.BufferViewVec4u8)}}class g{constructor(d,f){this._rctx=d;this._instanceBufferLayout=f;this._tailIndex=this._headIndex=0;this._firstIndex=null;this._captureFirstIndex=!0;this._updating=!1;this._prevHeadIndex=0;this._resized=!1;this._capacity=1}destroy(){this._buffer&&this._buffer.destroy()}get buffer(){return this._buffer.buffer}get view(){return this._view}get capacity(){return this._capacity}get size(){const d=this._headIndex,f=this._tailIndex;return d>=f?d-f:d+this._capacity-f}get isEmpty(){return this._headIndex===
this._tailIndex}get isFull(){return this._tailIndex===(this._headIndex+1)%this._capacity}get headIndex(){return this._headIndex}get tailIndex(){return this._tailIndex}get firstIndex(){return this._firstIndex}get usedMemory(){return this._buffer?.usedMemory??0}reset(){this._tailIndex=this._headIndex=0;this._firstIndex=null}startUpdateCycle(){this._captureFirstIndex=!0}beginUpdate(){k.assert(!this._updating,"already updating");this._updating=!0;this._prevHeadIndex=this._headIndex}endUpdate(){k.assert(this._updating,
"not updating");this.size<b.reallocShrinkThreshold*this.capacity&&this._shrink();this._resized?(this._buffer.transferAll(),this._resized=!1):this._transferRange(this._prevHeadIndex,this._headIndex);this._updating=!1}allocateHead(){k.assert(this._updating,"not updating");this.isFull&&this._grow();const d=this.headIndex;this._captureFirstIndex&&(this._firstIndex=d,this._captureFirstIndex=!1);this._incrementHead();k.assert(this._headIndex!==this._tailIndex,"invalid pointers");return d}freeTail(){k.assert(this._updating,
"not updating");k.assert(0<this.size,"invalid size");const d=this._tailIndex===this._firstIndex;this._incrementTail();d&&(this._firstIndex=this._tailIndex)}_grow(){this._resize(Math.max(64,Math.floor(this._capacity*b.reallocGrowthFactor)))}_shrink(){this._resize(Math.max(64,Math.floor(this._capacity*b.reallocShrinkFactor)))}_resize(d){k.assert(this._updating,"not updating");if(d!==this._capacity){var f=new h(this._rctx,this._instanceBufferLayout.stride,d);if(this._buffer){this._firstIndex&&(this._firstIndex=
(this._firstIndex+this._capacity-this._tailIndex)%this._capacity);const c=this.size,l=this._compactInstances(f);k.assert(l===c,"invalid compaction");this._buffer.destroy();this._tailIndex=0;this._headIndex=l;this._prevHeadIndex=0}this._resized=!0;this._capacity=d;this._buffer=f;this._view=new e(this._instanceBufferLayout.createView(this._buffer.array))}}_compactInstances(d){const f=this._headIndex,c=this._tailIndex;return c<f?(this._buffer.copyRange(c,f,d),f-c):c>f?(this._buffer.copyRange(c,this._capacity,
d),0<f&&this._buffer.copyRange(0,f,d,this._capacity-c),f+(this._capacity-c)):0}_incrementHead(d=1){this._headIndex=(this._headIndex+d)%this._capacity}_incrementTail(d=1){this._tailIndex=(this._tailIndex+d)%this._capacity}_transferRange(d,f){d<f?this._buffer.transferRange(d,f):d>f&&(0<f&&this._buffer.transferRange(0,f),this._buffer.transferRange(d,this._capacity))}}a.RenderInstanceData=g;a.RenderInstanceDataView=e;a.initialCapacity=64;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/webgl-engine/lib/lodRendering/BackedBufferObject":function(){define(["../../../../webgl/BufferObject","../../../../webgl/enums"],function(a,b){class n{constructor(k,p,h){this._elementSize=p;this._buffer=a.BufferObject.createVertex(k,b.Usage.STATIC_DRAW);this.resize(h)}destroy(){this._buffer.dispose()}get elementSize(){return this._elementSize}get capacity(){return this._capacity}get array(){return this._array}get buffer(){return this._buffer}get usedMemory(){return this._array.byteLength+
this._buffer.usedMemory}copyRange(k,p,h,e=0){k=new Uint8Array(this.array,k*this.elementSize,(p-k)*this.elementSize);(new Uint8Array(h.array,e*this.elementSize)).set(k)}transferAll(){this._buffer.setData(this._array)}transferRange(k,p){k*=this._elementSize;p*=this._elementSize;this._buffer.setSubData(new Uint8Array(this._array),k,k,p)}resize(k){const p=k*this._elementSize,h=new ArrayBuffer(p);this._array&&(k>=this._capacity?(new Uint8Array(h)).set(new Uint8Array(this._array)):(new Uint8Array(h)).set((new Uint8Array(this._array)).subarray(0,
k*this._elementSize)));this._array=h;this._buffer.setSize(p);this._capacity=k}}return n})},"esri/views/3d/webgl-engine/lib/lodRendering/InstanceOctree":function(){define("exports ../../../../../core/libs/gl-matrix-2/factories/mat4f64 ../../../../../chunks/vec32 ../../../../../chunks/sphere ../../../support/mathUtils ../Octree".split(" "),function(a,b,n,k,p,h){class e extends h{constructor(g,d){super(f=>k.wrap(this._instanceData.view.boundingSphere.getVec(f,this._tmpSphere)),{maximumDepth:25});this._instanceData=
g;this._boundingSphere=d;this._tmpSphere=k.create();this._tmpMat4=b.create()}addInstance(g){const d=this._instanceData.view.boundingSphere,f=this._instanceData.getCombinedModelTransform(g,this._tmpMat4);n.transformMat4(k.getCenter(this._tmpSphere),this._boundingSphere.center,f);this._tmpSphere[3]=this._boundingSphere.radius*p.maxScale(f);d.setVec(g,this._tmpSphere);this.add([g])}removeInstance(g){this.remove([g])}}a.InstanceOctree=e;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/webgl-engine/lib/lodRendering/LevelSelector":function(){define(["exports"],function(a){class b{constructor(n,k){this._worldSpaceRadius=n;this._minScreenSpaceRadii=k}selectLevel(n,k,p){n=p.computeScreenPixelSizeAt(n);k=this._worldSpaceRadius*k/n;n=0;for(p=1;p<this._minScreenSpaceRadii.length;++p)k>=this._minScreenSpaceRadii[p]&&(n=p);return n}}a.LevelSelector=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/lodRendering/LodLevel":function(){define("exports ../../../../../core/arrayUtils ../../../../../core/promiseUtils ../../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../../geometry/support/aaBoundingBox ./LodComponentData".split(" "),
function(a,b,n,k,p,h){class e{static async create(g,d,f){const c=await Promise.allSettled(d.components.map(w=>g.controller.schedule(()=>new h.LodComponentData(g,w),f))),l=c.map(w=>"fulfilled"===w.status?w.value:null).filter(b.isSome);if(n.isAborted(f)||l.length!==c.length){l.forEach(w=>w.destroy());n.throwIfAborted(f);for(const w of c)if("rejected"===w.status)throw w.reason;}return new e(d.minScreenSpaceRadius,l)}constructor(g,d){this.minScreenSpaceRadius=g;this.components=d}destroy(){this.components.forEach(g=>
g.destroy())}intersect(g,d,f,c,l,w,x){this.components.forEach(u=>u.intersect(g,d,f,c,l,w,this.boundingSphere,x))}get boundingBox(){if(null==this._boundingBox){const g=p.empty();this.components.forEach(d=>{null!=d.boundingInfo&&(p.expandWithVec3(g,d.boundingInfo.bbMin),p.expandWithVec3(g,d.boundingInfo.bbMax))});this._boundingBox=g}return this._boundingBox}get boundingSphere(){if(null==this._boundingSphere){const g=this.boundingBox,d=k.create();p.center(g,d);this._boundingSphere={center:d,radius:.5*
p.diameter(g)}}return this._boundingSphere}get triangleCount(){return this.components.reduce((g,d)=>g+d.triangleCount,0)}}a.LodLevel=e;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/lodRendering/LodComponentData":function(){define("exports ../../../support/buffer/glUtil ../ContentObject ../DefaultVertexAttributeLocations ../GLMaterials ../Intersector ../IntersectorInterfaces ../VertexArrayObject ./Intersector ../../../../webgl/BufferObject ../../../../webgl/enums".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c){function l(x,u,t,m=null){const q=x.createBufferWriter(),r=q.vertexBufferLayout,v=q.elementCount(u),y=r.createBuffer(v);q.write(null,null,u,m,y,0);return{material:x,vertexBufferLayout:r,buffer:y.buffer,elementCount:v,boundingInfo:t}}class w{constructor(x,u){const t=x.renderContext.rctx;u=u.geometry;let m=null;m=u instanceof n.ContentObject?l(u.material,u.attributes,u.boundingInfo):u;const q=m.material;this._materials=x.materials;q.setParameters({instancedDoublePrecision:!0});
this.geometry=u;this.material=q;this.glMaterials=new p.GLMaterials(q,this._materials);this.vertexBufferLayout=m.vertexBufferLayout;this.vbo=f.BufferObject.createVertex(t,c.Usage.STATIC_DRAW,m.buffer);this.vao=new g.VertexArrayObject(t,k.Default3D,new Map([["geometry",b.glLayout(m.vertexBufferLayout)]]),new Map([["geometry",this.vbo]]));this.vertexCount=m.elementCount}destroy(){this.glMaterials.dispose();this.vbo.dispose();this.vao.dispose()}get boundingInfo(){return this.geometry.boundingInfo}get triangleCount(){return this.vertexCount/
3}intersect(x,u,t,m,q,r,v,y){if(this.geometry instanceof n.ContentObject){var B=this.geometry.id;this.material.intersect(this.geometry,x.transform.transform,x,t,m,(z,A,C,H,E)=>{0<=z&&(null==u||u(x.rayBegin,x.rayEnd,z))&&(C=new d.LodTarget(r.layerUid,r.graphicUid(q),B,C,v,y),(null==x.results.min.drapedLayerOrder||E>=x.results.min.drapedLayerOrder)&&(null==x.results.min.dist||z<x.results.min.dist)&&x.results.min.set(e.IntersectorType.LOD,C,z,A,x.transform.transform,E),x.options.store!==e.StoreResults.MIN&&
(null==x.results.max.drapedLayerOrder||E>=x.results.max.drapedLayerOrder)&&(null==x.results.max.dist||z>x.results.max.dist)&&x.results.max.set(e.IntersectorType.LOD,C,z,A,x.transform.transform,E),x.options.store===e.StoreResults.ALL&&(H=h.newIntersectorResult(x.results.min.ray),H.set(e.IntersectorType.LOD,C,z,A,x.transform.transform,E),x.results.all.push(H)))})}}}a.LodComponentData=w;a.createLodComponentRenderGeometry=l;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/lodRendering/Intersector":function(){define(["exports",
"../IntersectorInterfaces","../IntersectorTarget","../intersectorUtils"],function(a,b,n,k){class p extends n.Graphic3DTarget{constructor(h,e,g,d,f,c){super(h,e);this.layerUid=h;this.graphicUid=e;this.geometryId=g;this.triangleNr=d;this.baseBoundingSphere=f;this.numLodLevels=c}}a.LodTarget=p;a.isLodIntersectorResult=function(h){return k.isValidIntersectorResult(h)&&h.intersector===b.IntersectorType.LOD&&!!h.target};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/engineContent/sdfPrimitives":function(){define(["exports",
"../../../../core/has","../../../../core/floatRGBA","../../webgl-engine/lib/Texture","../../../webgl/enums"],function(a,b,n,k,p){function h(r,v=128,y=.5*v,B=0){switch(r){case "circle":return e(v,y);case "square":return g(v,y);case "cross":return f(v,y,B);case "x":return c(v,y,B);case "kite":return d(v,y);case "triangle":return l(v,y);case "arrow":return w(v,y);default:return e(v,y)}}function e(r,v){const y=r/2-.5;return q(r,t(y,y,v/2))}function g(r,v){return x(r,v,!1)}function d(r,v){return x(r,v,
!0)}function f(r,v,y=0){return u(r,v,!1,y)}function c(r,v,y=0){return u(r,v,!0,y)}function l(r,v){return q(r,m(r/2,v,v/2))}function w(r,v){const y=v/2,B=r/2,z=.8*v,A=t(B,(r-v)/2-z,Math.sqrt(z*z+y*y)),C=m(B,v,y);return q(r,(H,E)=>Math.max(C(H,E),-A(H,E)))}function x(r,v,y){y&&(v/=Math.SQRT2);return q(r,(B,z)=>{B=B-.5*r+.25;z=-z+.5*r-.75;if(y){const A=(B+z)/Math.SQRT2;z=(z-B)/Math.SQRT2;B=A}return Math.max(Math.abs(B),Math.abs(z))-.5*v})}function u(r,v,y,B=0){v-=B;y&&(v*=Math.SQRT2);const z=.5*v;return q(r,
(A,C)=>{A-=.5*r;C=-C+.5*r-1;if(y){const H=(A+C)/Math.SQRT2;C=(C-A)/Math.SQRT2;A=H}A=Math.abs(A);C=Math.abs(C);A=A>C?A>z?Math.sqrt((A-z)*(A-z)+C*C):C:C>z?Math.sqrt(A*A+(C-z)*(C-z)):A;return A-=B/2})}function t(r,v,y){return(B,z)=>{B-=r;z-=v;return Math.sqrt(B*B+z*z)-y}}function m(r,v,y){const B=Math.sqrt(v*v+y*y);return(z,A)=>{A=A-r+v/2+.75;return Math.max((v*(Math.abs(z-r)-y)+y*A)/B,-A)}}function q(r,v){const y=new Uint8Array(4*r*r);for(let B=0;B<r;B++)for(let z=0;z<r;z++){const A=z+r*B;let C=v(z,
B);C=C/r+.5;n.packFloatRGBA(C,y,4*A)}return y}a.createArrow=w;a.createCircle=e;a.createCross=f;a.createKite=d;a.createPrimitive=h;a.createSquare=g;a.createTexture=function(r,v=128,y=.5*v,B=0){r=h(r,v,y,B);return new k.Texture(r,{mipmap:!1,wrap:{s:p.TextureWrapMode.CLAMP_TO_EDGE,t:p.TextureWrapMode.CLAMP_TO_EDGE},width:v,height:v,components:4,noUnpackFlip:!0,reloadable:!0})};a.createTriangle=l;a.createX=c;a.defaultSymbolSizeRatio=.5;a.defaultTexSize=128;a.requiresHalfTexelOffset=function(r){return"cross"===
r||"x"===r};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/Texture":function(){define("exports ../../../../core/has ../../../../core/Error ../../../../core/Evented ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/typedArrayUtil ../../../../core/urlUtils ../../../../support/requestImageUtils ../../../../support/requestUtils ./basicInterfaces ./BasisUtil ./ContentObject ./ContentObjectType ./DDSUtil ./textureUtils ./Util ../../../webgl/enums ../../../webgl/Texture ../../../webgl/TextureDescriptor".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w,x,u,t,m,q,r,v){function y(C){return C instanceof HTMLVideoElement?{width:C.videoWidth,height:C.videoHeight}:C}class B extends w.ContentObject{get parameters(){return this._parameters}constructor(C,H){super();this._data=C;this.type=x.ContentObjectType.Texture;this._loadingController=this._loadingPromise=this._glTexture=null;this.events=new k;this._parameters={...A,...H};this._startPreload(C)}dispose(){this.unload();this._data=this.frameUpdate=void 0}_startPreload(C){null!=
C&&(C instanceof HTMLVideoElement?(this.frameUpdate=H=>this._frameUpdate(C,H),this._startPreloadVideoElement(C)):C instanceof HTMLImageElement&&this._startPreloadImageElement(C))}_startPreloadVideoElement(C){if(!(g.isBlobProtocol(C.src)||"auto"===C.preload&&C.crossOrigin)){C.preload="auto";C.crossOrigin="anonymous";const H=!C.paused;C.src=C.src;if(H&&C.autoplay){const E=()=>{C.removeEventListener("canplay",E);C.play()};C.addEventListener("canplay",E)}}}_startPreloadImageElement(C){g.isDataProtocol(C.src)||
g.isBlobProtocol(C.src)||C.crossOrigin||(C.crossOrigin="anonymous",C.src=C.src)}_createDescriptor(C){const H=new v.TextureDescriptor;H.wrapMode=this._parameters.wrap??q.TextureWrapMode.REPEAT;H.flipped=!this._parameters.noUnpackFlip;H.samplingMode=this._parameters.mipmap?q.TextureSamplingMode.LINEAR_MIPMAP_LINEAR:q.TextureSamplingMode.LINEAR;H.hasMipmap=!!this._parameters.mipmap;H.preMultiplyAlpha=!!this._parameters.preMultiplyAlpha;H.maxAnisotropy=this._parameters.maxAnisotropy??(this._parameters.mipmap?
C.parameters.maxMaxAnisotropy:1);return H}get glTexture(){return this._glTexture}get memoryEstimate(){var C;if(!(C=this._glTexture?.usedMemory)){C=this._data;var H=this._parameters;if(null==C)C=0;else if(e.isArrayBuffer(C)||e.isUint8Array(C))C=H.encoding===c.TextureEncodingMimeType.KTX2_ENCODING?l.estimateMemoryKTX2(C,!!H.mipmap):H.encoding===c.TextureEncodingMimeType.BASIS_ENCODING?l.estimateMemoryBasis(C,!!H.mipmap):C.byteLength;else{var {width:E,height:F}=C instanceof Image||C instanceof ImageData||
C instanceof HTMLCanvasElement||C instanceof HTMLVideoElement?y(C):H;C=(H.mipmap?4/3:1)*E*F*(H.components||4)||0}}return C}load(C){if(this._glTexture)return this._glTexture;if(this._loadingPromise)return this._loadingPromise;const H=this._data;if(null==H)return this._glTexture=new r.Texture(C,this._createDescriptor(C),null);this._parameters.reloadable||(this._data=void 0);return"string"===typeof H?this._loadFromURL(C,H):H instanceof Image?this._loadFromImageElement(C,H):H instanceof HTMLVideoElement?
this._loadFromVideoElement(C,H):H instanceof ImageData||H instanceof HTMLCanvasElement?this._loadFromImage(C,H):e.isUint8Array(H)&&this._parameters.encoding===c.TextureEncodingMimeType.DDS_ENCODING?this._loadFromDDSData(C,H):e.isArrayBuffer(H)&&this._parameters.encoding===c.TextureEncodingMimeType.DDS_ENCODING?this._loadFromDDSData(C,new Uint8Array(H)):(e.isArrayBuffer(H)||e.isUint8Array(H))&&this._parameters.encoding===c.TextureEncodingMimeType.KTX2_ENCODING?this._loadFromKTX2(C,H):(e.isArrayBuffer(H)||
e.isUint8Array(H))&&this._parameters.encoding===c.TextureEncodingMimeType.BASIS_ENCODING?this._loadFromBasis(C,H):e.isUint8Array(H)?this._loadFromPixelData(C,H):e.isArrayBuffer(H)?this._loadFromPixelData(C,new Uint8Array(H)):null}_frameUpdate(C,H){if(null==this._glTexture||C.readyState<z.HAVE_CURRENT_DATA||H===C.currentTime)return H;this._glTexture.setData(C);this._glTexture.descriptor.hasMipmap&&this._glTexture.generateMipmap();this._parameters.updateCallback&&this._parameters.updateCallback();return C.currentTime}_loadFromDDSData(C,
H){return this._glTexture=u.createDDSTexture(C,this._createDescriptor(C),H)}_loadFromKTX2(C,H){return this._loadAsync(()=>l.createTextureKTX2(C,this._createDescriptor(C),H).then(E=>this._glTexture=E))}_loadFromBasis(C,H){return this._loadAsync(()=>l.createTextureBasis(C,this._createDescriptor(C),H).then(E=>this._glTexture=E))}_loadFromPixelData(C,H){m.assert(0<this._parameters.width&&0<this._parameters.height);const E=this._createDescriptor(C);E.pixelFormat=1===this._parameters.components?q.PixelFormat.LUMINANCE:
3===this._parameters.components?q.PixelFormat.RGB:q.PixelFormat.RGBA;E.width=this._parameters.width??0;E.height=this._parameters.height??0;return this._glTexture=new r.Texture(C,E,H)}_loadFromURL(C,H){return this._loadAsync(async E=>{const F=await d.requestImage(H,{signal:E});h.throwIfAborted(E);return this._loadFromImage(C,F)})}_loadFromImageElement(C,H){return H.complete?this._loadFromImage(C,H):this._loadAsync(async E=>{const F=await f.loadImageAsync(H,H.src,!1,E);h.throwIfAborted(E);return this._loadFromImage(C,
F)})}_loadFromVideoElement(C,H){return H.readyState>=z.HAVE_CURRENT_DATA?this._loadFromImage(C,H):this._loadFromVideoElementAsync(C,H)}_loadFromVideoElementAsync(C,H){return this._loadAsync(E=>new Promise((F,G)=>{const D=()=>{H.removeEventListener("loadeddata",I);H.removeEventListener("error",J);p.removeMaybe(N)},I=()=>{H.readyState>=z.HAVE_CURRENT_DATA&&(D(),F(this._loadFromImage(C,H)))},J=M=>{D();G(M||new n("Failed to load video"))};H.addEventListener("loadeddata",I);H.addEventListener("error",
J);const N=h.onAbort(E,()=>J(h.createAbortError()))}))}_loadFromImage(C,H){if(!(H instanceof HTMLVideoElement)){var {maxTextureSize:E}=C.parameters;H=this._parameters.downsampleUncompressed?t.downsampleImage(H,E):t.ensureImageMaxSize(H,E)}E=y(H);this._parameters.width=E.width;this._parameters.height=E.height;const F=this._createDescriptor(C);F.pixelFormat=3===this._parameters.components?q.PixelFormat.RGB:q.PixelFormat.RGBA;F.width=E.width;F.height=E.height;return this._glTexture=new r.Texture(C,F,
H)}_loadAsync(C){const H=new AbortController;this._loadingController=H;const E=C(H.signal);this._loadingPromise=E;C=()=>{this._loadingController===H&&(this._loadingController=null);this._loadingPromise===E&&(this._loadingPromise=null)};E.then(C,C);return E}unload(){this._glTexture=p.disposeMaybe(this._glTexture);if(null!=this._loadingController){const C=this._loadingController;this._loadingPromise=this._loadingController=null;C.abort()}this.events.emit("unloaded")}}var z;(function(C){C[C.HAVE_NOTHING=
0]="HAVE_NOTHING";C[C.HAVE_METADATA=1]="HAVE_METADATA";C[C.HAVE_CURRENT_DATA=2]="HAVE_CURRENT_DATA";C[C.HAVE_FUTURE_DATA=3]="HAVE_FUTURE_DATA";C[C.HAVE_ENOUGH_DATA=4]="HAVE_ENOUGH_DATA"})(z||={});const A={wrap:{s:q.TextureWrapMode.REPEAT,t:q.TextureWrapMode.REPEAT},mipmap:!0,noUnpackFlip:!1,preMultiplyAlpha:!1,downsampleUncompressed:!1};a.Texture=B;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/support/requestImageUtils":function(){define(["exports","../request"],function(a,
b){a.requestImage=async function(n,k){({data:n}=await b(n,{responseType:"image",...k}));return n};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/BasisUtil":function(){define("exports ../../../../libs/basisu/BasisU ../../../../libs/basisu/TextureFormat ../../../webgl/enums ../../../webgl/Texture ../../../webgl/Util".split(" "),function(a,b,n,k,p,h){async function e(){null==w&&(w=b.getBasisTranscoder(),l=await w);return w}function g(x,u,t,m,q){u=h.getBytesPerElementFormat(u?
k.CompressedTextureFormat.COMPRESSED_RGBA8_ETC2_EAC:k.CompressedTextureFormat.COMPRESSED_RGB8_ETC2);return Math.ceil(t*m*u*(q&&1<x?(4**x-1)/(3*4**(x-1)):1))}function d(x){return 1<=x.getNumImages()&&!x.isUASTC()}function f(x){return 1<=x.getFaces()&&x.isETC1S()}function c(x,u,t,m,q,r,v,y){const {compressedTextureETC:B,compressedTextureS3TC:z}=x.capabilities,[A,C]=B?m?[n.TextureFormat.ETC2_RGBA,k.CompressedTextureFormat.COMPRESSED_RGBA8_ETC2_EAC]:[n.TextureFormat.ETC1_RGB,k.CompressedTextureFormat.COMPRESSED_RGB8_ETC2]:
z?m?[n.TextureFormat.BC3_RGBA,k.CompressedTextureFormat.COMPRESSED_RGBA_S3TC_DXT5_EXT]:[n.TextureFormat.BC1_RGB,k.CompressedTextureFormat.COMPRESSED_RGB_S3TC_DXT1_EXT]:[n.TextureFormat.RGBA32,k.PixelFormat.RGBA];t=u.hasMipmap?t:Math.min(1,t);m=[];for(let H=0;H<t;H++)m.push(new Uint8Array(v(H,A))),y(H,A,m[H]);u.internalFormat=C;u.hasMipmap=1<m.length;u.samplingMode=u.hasMipmap?k.TextureSamplingMode.LINEAR_MIPMAP_LINEAR:k.TextureSamplingMode.LINEAR;u.width=q;u.height=r;return new p.Texture(x,u,{type:"compressed",
levels:m})}let l=null,w=null;a.createTextureBasis=async function(x,u,t){null==l&&(l=await e());const m=new l.BasisFile(new Uint8Array(t));if(!d(m))return null;m.startTranscoding();x=c(x,u,m.getNumLevels(0),m.getHasAlpha(),m.getImageWidth(0,0),m.getImageHeight(0,0),(q,r)=>m.getImageTranscodedSizeInBytes(0,q,r),(q,r,v)=>m.transcodeImage(v,0,q,r,0,0));m.close();m.delete();return x};a.createTextureKTX2=async function(x,u,t){null==l&&(l=await e());const m=new l.KTX2File(new Uint8Array(t));if(!f(m))return null;
m.startTranscoding();x=c(x,u,m.getLevels(),m.getHasAlpha(),m.getWidth(),m.getHeight(),(q,r)=>m.getImageTranscodedSizeInBytes(q,0,0,r),(q,r,v)=>m.transcodeImage(v,q,0,0,r,0,-1,-1));m.close();m.delete();return x};a.estimateMemoryBasis=function(x,u){if(null==l)return x.byteLength;x=new l.BasisFile(new Uint8Array(x));u=d(x)?g(x.getNumLevels(0),x.getHasAlpha(),x.getImageWidth(0,0),x.getImageHeight(0,0),u):0;x.close();x.delete();return u};a.estimateMemoryKTX2=function(x,u){if(null==l)return x.byteLength;
x=new l.KTX2File(new Uint8Array(x));u=f(x)?g(x.getLevels(),x.getHasAlpha(),x.getWidth(),x.getHeight(),u):0;x.close();x.delete();return u};a.loadBasis=e;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/libs/basisu/BasisU":function(){define(["require","exports","../../assets"],function(a,b,n){let k;b.getBasisTranscoder=function(){k??=(async()=>{const p=await (await new Promise((h,e)=>a(["../../chunks/basis_transcoder"],h,e))).default({locateFile:h=>n.getAssetUrl(`esri/libs/basisu/${h}`)});
p.initializeBasis();return p})();return k};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/libs/basisu/TextureFormat":function(){define(["exports"],function(a){a.TextureFormat=void 0;var b=a.TextureFormat||(a.TextureFormat={});b[b.ETC1_RGB=0]="ETC1_RGB";b[b.ETC2_RGBA=1]="ETC2_RGBA";b[b.BC1_RGB=2]="BC1_RGB";b[b.BC3_RGBA=3]="BC3_RGBA";b[b.BC4_R=4]="BC4_R";b[b.BC5_RG=5]="BC5_RG";b[b.BC7_M6_RGB=6]="BC7_M6_RGB";b[b.BC7_M5_RGBA=7]="BC7_M5_RGBA";b[b.PVRTC1_4_RGB=8]="PVRTC1_4_RGB";b[b.PVRTC1_4_RGBA=
9]="PVRTC1_4_RGBA";b[b.ASTC_4x4_RGBA=10]="ASTC_4x4_RGBA";b[b.ATC_RGB=11]="ATC_RGB";b[b.ATC_RGBA=12]="ATC_RGBA";b[b.FXT1_RGB=17]="FXT1_RGB";b[b.PVRTC2_4_RGB=18]="PVRTC2_4_RGB";b[b.PVRTC2_4_RGBA=19]="PVRTC2_4_RGBA";b[b.ETC2_EAC_R11=20]="ETC2_EAC_R11";b[b.ETC2_EAC_RG11=21]="ETC2_EAC_RG11";b[b.RGBA32=13]="RGBA32";b[b.RGB565=14]="RGB565";b[b.BGR565=15]="BGR565";b[b.RGBA4444=16]="RGBA4444";Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/DDSUtil":function(){define(["exports",
"../../../../core/Logger","../../../webgl/enums","../../../webgl/Texture"],function(a,b,n,k){function p(c){return c.charCodeAt(0)+(c.charCodeAt(1)<<8)+(c.charCodeAt(2)<<16)+(c.charCodeAt(3)<<24)}function h(c,l){var w=new Int32Array(c.buffer,c.byteOffset,31);if(542327876!==w[0])return e().error("Invalid magic number in DDS header"),null;if(!(w[20]&4))return e().error("Unsupported format, must contain a FourCC code"),null;var x=w[21];let u;switch(x){case g:x=8;u=n.CompressedTextureFormat.COMPRESSED_RGB_S3TC_DXT1_EXT;
break;case d:x=16;u=n.CompressedTextureFormat.COMPRESSED_RGBA_S3TC_DXT3_EXT;break;case f:x=16;u=n.CompressedTextureFormat.COMPRESSED_RGBA_S3TC_DXT5_EXT;break;default:return e().error("Unsupported FourCC code:",String.fromCharCode(x&255,x>>8&255,x>>16&255,x>>24&255)),null}let t=1,m=w[4],q=w[3];if(0!==(m&3)||0!==(q&3))e().warn("Rounding up compressed texture size to nearest multiple of 4."),m=m+3&-4,q=q+3&-4;const r=m,v=q;w[2]&131072&&!1!==l&&(t=Math.max(1,w[7]));let y=c.byteOffset+w[1]+4;const B=[];
for(let z=0;z<t;++z)w=(m+3>>2)*(q+3>>2)*x,l=new Uint8Array(c.buffer,y,w),B.push(l),y+=w,m=Math.max(1,m>>1),q=Math.max(1,q>>1);return{textureData:{type:"compressed",levels:B},internalFormat:u,width:r,height:v}}const e=()=>b.getLogger("esri.views.3d.webgl-engine.lib.DDSUtil"),g=p("DXT1"),d=p("DXT3"),f=p("DXT5");a.createDDSTexture=function(c,l,w){w=h(w,l.hasMipmap??!1);if(null==w)throw Error("DDS texture data is null");const {textureData:x,internalFormat:u,width:t,height:m}=w;l.samplingMode=1<x.levels.length?
n.TextureSamplingMode.LINEAR_MIPMAP_LINEAR:n.TextureSamplingMode.LINEAR;l.hasMipmap=1<x.levels.length;l.internalFormat=u;l.width=t;l.height=m;return new k.Texture(c,l,x)};a.createDDSTextureData=h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/textureUtils":function(){define(["exports","../../../../core/Error"],function(a,b){function n(p,h,e){if(p instanceof ImageData)return n(k(p),h,e);const g=document.createElement("canvas");g.width=h;g.height=e;g.getContext("2d").drawImage(p,
0,0,g.width,g.height);return g}function k(p){const h=document.createElement("canvas");h.width=p.width;h.height=p.height;const e=h.getContext("2d");if(null==e)throw new b("Failed to create 2d context from HTMLCanvasElement");e.putImageData(p,0,0);return h}a.applyTextureResizeFloorModulo=function(p){return 16*Math.floor(p/16)};a.applyTextureResizeModulo=function(p){return 16*Math.ceil(p/16)};a.downsampleImage=function(p,h){let e=p.width*p.height;if(4096>e)return p instanceof ImageData?k(p):p;let g=
p.width,d=p.height;do g=Math.ceil(g/2),d=Math.ceil(d/2),e=g*d;while(1048576<e||null!=h&&(g>h||d>h));return n(p,g,d)};a.ensureImageMaxSize=function(p,h){const e=Math.max(p.width,p.height);if(e<=h)return p;h/=e;return n(p,Math.round(p.width*h),Math.round(p.height*h))};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/MaterialCollection":function(){define(["exports"],function(a){class b{constructor(n){this._stage=n;this._materials=new Map}get(n){return this._materials.get(n)}add(n,
k){this._materials.set(n,k);this._stage.add(k)}dispose(){this._stage.removeMany(Array.from(this._materials.values()));this._materials.clear()}}a.MaterialCollection=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/TextRenderParameters":function(){define("exports ../../../../Color ../../../../core/fontUtils ../../../../core/Logger ../../../../core/screenUtils ../../../../core/libs/gl-matrix-2/factories/vec4f64".split(" "),function(a,b,n,k,p,h){function e(c){return`rgb(${c.slice(0,
3).map(l=>Math.floor(255*l)).toString()})`}function g(c){return`rgba(${c.slice(0,3).map(l=>Math.floor(255*l)).toString()},${c[3]})`}class d{constructor(c){this.definition=c;this.key=JSON.stringify(c);this.haloSize=Math.round(c.halo.size);this.textStyle=g(c.color);this.haloStyle=e(c.halo.color);this.backgroundStyle=0!==c.background.color[3]?g(c.background.color):null}fontString(c){const l=this.definition.font;return`${l.style} ${l.weight} ${c}px ${l.family}, ${"sans-serif, Apple Color Emoji, Segoe UI Emoji, Segoe UI Symbol, Noto Color Emoji"}`}setFontProperties(c,
l){c.font=this.fontString(l);c.textAlign="left";c.textBaseline="alphabetic"}static async fromSymbol(c,l){var w=b.toUnitRGBA(c?.material?.color)??h.ZEROS,x=null!=c.size?p.pt2px(c.size):12;const u=c.lineHeight,t=null!=c.background?b.toUnitRGBA(c.background.color):h.ZEROS,m={family:c.font?.family??"sans-serif",decoration:c.font?.decoration??"none",weight:c.font?.weight??"normal",style:c.font?.style??"normal"};var q=c.halo;q=null!=q?.color&&0<q.size?{size:p.pt2px(q.size),color:b.toUnitRGBA(q.color)}:
{size:0,color:h.ZEROS};l=new d({color:w,size:x,background:{color:t,padding:null!=c.background?[.65*x,.5*x]:[0,0],borderRadius:null!=c.background?.375*x:0},lineSpacingFactor:u,font:m,halo:q,pixelRatio:l});if(c.font){w=!1;x=l.fontString(x);try{w=(await document.fonts.load(x)).some(r=>!n.isCachedFontFace(r))}catch(r){k.getLogger("esri.views.3d.webgl-engine.lib.TextRenderParameters").warnOnce(`Failed to preload font '${x}'. Some text symbology may be rendered using the default browser font.`)}if(!w&&
!f.has(c.font.family))try{await n.loadFont(c.font)}catch(r){}}return l}}const f=new Set("Arial;Times New Roman;Courier New;serif;sans-serif;monospace;cursive;fantasy;system-ui;ui-serif;ui-sans-serif;ui-monospace;ui-rounded;math;emoji;fangsong".split(";"));a.TextRenderParameters=d;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/fontUtils":function(){define(["exports","../config"],function(a,b){function n(c){if(!c)return"arial-unicode-ms";c=c.toLowerCase().split(" ").join("-");
switch(c){case "serif":return"noto-serif";case "sans-serif":return"arial-unicode-ms";case "monospace":return"ubuntu-mono";case "fantasy":return"cabin-sketch";case "cursive":return"redressed";default:return c}}function k(c){const l=h(c)+e(c);return n(c.family)+(0<l.length?l:"-regular")}function p(c){const l=h(c)+e(c);return(c.family||"arial-unicode-ms")+(0<l.length?l:"-regular")}function h(c){if(!c.weight)return"";switch(c.weight.toLowerCase()){case "bold":case "bolder":return"-bold"}return""}function e(c){if(!c.style)return"";
switch(c.style.toLowerCase()){case "italic":case "oblique":return"-italic"}return""}const g=new Map,d=new Set;class f{constructor(c,l){this.fontFace=c;this.promise=l}}a.clearFonts=function(){const c=document.fonts;g.forEach(l=>{c.delete(l.fontFace)});g.clear();d.clear()};a.defaultFontFamily="arial-unicode-ms";a.getFontFamily=n;a.getFullyQualifiedFontName=k;a.isCachedFontFace=function(c){return d.has(c)};a.loadFont=async function(c){const l=p(c),w=k(c),x=g.get(l);if(x)return x.promise;const u=new FontFace(c.family,
`url('${b.fontsUrl}/woff2/${w}.${"woff2"}') format('${"woff2"}')`,{style:c.style,weight:c.weight}),t=document.fonts;if(t.has(u)&&"loading"===u.status)return u.loaded;c=u.load().then(()=>{t.add(u);return u});g.set(l,new f(u,c));d.add(u);return c};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/TextTextureAtlas":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Evented ../../../../core/has ../../../../core/maybe ../../../../core/uid ../../../../core/accessorSupport/decorators/property ../../../../core/Logger ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec42 ../../../../core/libs/gl-matrix-2/factories/vec4f64 ./ContentObjectType ./testUtils ./textureUtils ../../../support/Scheduler ../../../support/Yield ../../../webgl/enums ../../../webgl/Texture ../../../webgl/TextureDescriptor".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w,x,u,t,m,q,r,v,y){a.TextTextureAtlas=class extends n{constructor(H){super(H);this.type=x.ContentObjectType.Texture;this.id=e.generateUID();this.events=new k;this._glTexture=null;this._atlas=new z(256,256);this._needsRepack=!1;this._canRepack=!0;this._elementsToRender=new Map;this._elements=new Map;this._uvCallbacks=new Map;this.updating=!1}initialize(){this._canvas=document.createElement("canvas");this._canvas.setAttribute("id","textAtlasCanvas");this._canvas.setAttribute("style",
"display:none");this._ctx=this._canvas.getContext("2d");this._stage=this.view._stage;this._stage.add(this);this._updateCanvasElementSize(this._atlas);this._reset()}unload(){this._glTexture=h.disposeMaybe(this._glTexture);this._frameWorker=h.removeMaybe(this._frameWorker);this.updating=!1;this.events.emit("unloaded")}get glTexture(){return this._glTexture}static get maxSize(){C=u.textTextureAtlas.stableRendering?2:0;return[4094-C,4094-C-2]}load(H){if(this._glTexture)return this._glTexture;const E=
new y.TextureDescriptor;E.wrapMode=r.TextureWrapMode.CLAMP_TO_EDGE;E.samplingMode=r.TextureSamplingMode.LINEAR_MIPMAP_LINEAR;E.hasMipmap=!0;E.preMultiplyAlpha=!0;E.maxAnisotropy=H.parameters.maxMaxAnisotropy;this._glTexture=new v.Texture(H,E,this._canvas);this._frameWorker=this.view.resourceController.scheduler.registerTask(m.TaskPriority.TEXT_TEXTURE_ATLAS,this);this.setDirty();return this._glTexture}dispose(){this._elements.clear();this._elementsToRender.clear();this._frameWorker=h.removeMaybe(this._frameWorker);
this._glTexture&&(this._stage.remove(this),this._glTexture=h.disposeMaybe(this._glTexture));this._canvas.width=0;this._canvas.height=0;this._ctx=this._canvas=null}_updateCanvasElementSize(H){this._canvas.width=H.width;this._canvas.height=H.height}_resizeAtlas(H,E){const {width:F,height:G}=this._atlas;if(F!==H||G!==E)this._atlas.width=H,this._atlas.height=E,this._glTexture?.resize(H,E),this._glTexture?.updateData(0,0,0,F,G,this._canvas),this._updateCanvasElementSize(this._atlas),this._elements.forEach(D=>
this._uvCallbacks.get(D.textRenderer.key)?.forEach(I=>I(D.uv))),this._reset()}_reset(){this._elementsToRender.clear();this._atlas.reset();this._needsRepack=!0;this.setDirty()}_addAtlasElement(H,E,F,G){const D=this._atlas;if(D.width<F||D.height<G)return!1;let I=D.cursors.get(G);if(!I){if(D.height<D.nextY+G)return!1;I=[new A(D.nextY)];D.cursors.set(G,I);D.nextY+=G}let J=I.find(N=>D.width>=N.x+F);if(null==J){if(D.height<D.nextY+G)return!1;J=new A(D.nextY);D.nextY+=G;I.push(J)}H.setNewPosition(J);this._elements.set(E,
H);this._elementsToRender.set(E,H);J.x+=F;return!0}_ensureCallbacks(H){var E=this._uvCallbacks.get(H);if(E)return E;E=new Set;this._uvCallbacks.set(H,E);return E}_addCallback(H,E){this._ensureCallbacks(H).add(E)}_removeCallback(H,E){const F=this._uvCallbacks.get(H);return F?.delete(E)&&0===F.size?(this._uvCallbacks.delete(H),!0):!1}_processAddition(H){const E=H.textRenderer.key;if(this._needsRepack)this._elements.set(E,H);else{var F=this._atlas,G=H.textRenderer.renderedWidth+2,D=H.textRenderer.renderedHeight+
2+2;this._addAtlasElement(H,E,G,D)||(this._canRepack?this._reset():F.width<G?(G=Math.min(t.applyTextureResizeModulo(Math.max(G,1.5*F.width)),4096),this._resizeAtlas(G,F.height)):(G=Math.min(t.applyTextureResizeModulo(Math.max(F.nextY+D,1.5*F.height)),4096),G>F.height?this._resizeAtlas(F.width,G):4096>F.width&&(G=Math.min(t.applyTextureResizeModulo(1.5*F.width),4096),this._resizeAtlas(G,F.height))),this._elements.set(E,H))}}_renderElement(H){const E=H.commitNewPosition(),F=H.textRenderer;this._ctx.clearRect(E[0]-
2,E[1]-2,F.renderedWidth+4,F.renderedHeight+4);F.render(this._ctx,E[0],E[1]);this._uvCallbacks.get(F.key)?.forEach(G=>G(H.uv))}get running(){return this.updating}runTask(H){if(null==this._glTexture)return q.Yield;for(;this._needsRepack&&(this._canRepack||4096>this._atlas.height&&4096>this._atlas.height);){this._canRepack=this._needsRepack=!1;const E=this._elements;this._elements=new Map;E.forEach(F=>this._processAddition(F));H.madeProgress()}if(0<this._elementsToRender.size){for(const [E,F]of this._elementsToRender){if(H.done)break;
this._renderElement(F);this._elementsToRender.delete(E);H.madeProgress()}this._glTexture.setData(this._canvas)}this.updating=0<this._elementsToRender.size}addText(H,E){var F=H.key;this._addCallback(F,E);(F=this._elements.get(F))?l.exactEquals(F.uv,w.ZEROS)||E(F.uv):(F=new B(this._atlas,H),this._processAddition(F),this.setDirty());return{remove:()=>this._removeText(H,E)}}_removeText(H,E){H=H.key;this._elements.get(H)&&this._removeCallback(H,E)&&(this._elements.delete(H),this._elementsToRender.delete(H),
this._canRepack=!0)}setDirty(){this._glTexture&&(this.updating=!0)}get test(){}};b.__decorate([g.property({constructOnly:!0})],a.TextTextureAtlas.prototype,"view",void 0);b.__decorate([g.property({type:Boolean})],a.TextTextureAtlas.prototype,"updating",void 0);a.TextTextureAtlas=b.__decorate([c.subclass("esri.views.3d.webgl-engine.lib.TextTextureAtlas")],a.TextTextureAtlas);class B{constructor(H,E){this._atlas=H;this.textRenderer=E;this._uv=w.create();this._newPosition=[0,0]}get uv(){if(null==this._xOffset||
null==this._yOffset)return w.ZEROS;const {renderedWidth:H,renderedHeight:E}=this.textRenderer;return l.set(this._uv,this._xOffset/this._atlas.width,(this._yOffset+E)/this._atlas.height,(this._xOffset+H)/this._atlas.width,this._yOffset/this._atlas.height)}setNewPosition(H){this._newPosition[0]=H.x;this._newPosition[1]=H.y}commitNewPosition(){this._xOffset=this._newPosition[0];this._yOffset=this._newPosition[1];return this._newPosition}get xOffset(){return this._xOffset}get yOffset(){return this._yOffset}}
class z{constructor(H,E){this.width=H;this.height=E;this.cursors=new Map;this.nextY=0}reset(){this.cursors.clear();this.nextY=C}}class A{constructor(H){this.y=H;this.x=C}}let C=0;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/testUtils":function(){define(["exports"],function(a){a.gridLocalOriginFactory={rootOrigin:null};a.textTextureAtlas={stableRendering:!1};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/WebGLLayer":function(){define("exports ../../../../core/Evented ../../../../core/Handles ../../../../core/maybe ../../../../core/PooledArray ./ContentObject ./ContentObjectType ./DirtyEvents ./Octree ./UpdatePolicy".split(" "),
function(a,b,n,k,p,h,e,g,d,f){class c extends h.ContentObject{constructor(l,w,x=""){super();this.stage=l;this.apiLayerUid=x;this.type=e.ContentObjectType.Layer;this.events=new b;this.visible=!0;this.sliceable=!1;this._objectsAdded=new p;this._handles=new n;this._objects=new p;this._pickable=!0;this.visible=w?.visible??!0;this._pickable=w?.pickable??!0;this.updatePolicy=w?.updatePolicy??f.UpdatePolicy.ASYNC;this._disableOctree=w?.disableOctree??!1;l.add(this);for(const u of g.DirtyEventNames)this._handles.add(this.events.on(u,
t=>l.handleEvent(u,t)))}destroy(){this._handles.size&&(this._handles.destroy(),this.stage.remove(this),this.invalidateSpatialQueryAccelerator())}get objects(){return this._objects}set pickable(l){this._pickable=l}get pickable(){return this._pickable&&this.visible}add(l){this._objects.push(l);l.parentLayer=this;this.events.emit("layerObjectAdded",{layer:this,object:l});null!=this._octree&&this._objectsAdded.push(l)}remove(l){this._objects.removeUnordered(l)&&(l.parentLayer=null,this.events.emit("layerObjectRemoved",
{layer:this,object:l}),null!=this._octree&&(this._objectsAdded.removeUnordered(l)||this._octree.remove([l])))}addMany(l){this._objects.pushArray(l);for(const w of l)w.parentLayer=this;this.events.emit("layerObjectsAdded",{layer:this,objects:l});null!=this._octree&&this._objectsAdded.pushArray(l)}removeMany(l){const w=[];this._objects.removeUnorderedMany(l,l.length,w);if(0!==w.length){for(const x of w)x.parentLayer=null;this.events.emit("layerObjectsRemoved",{layer:this,objects:w});if(null!=this._octree){for(l=
0;l<w.length;)this._objectsAdded.removeUnordered(w[l])?(w[l]=w[w.length-1],--w.length):++l;this._octree.remove(w)}}}sync(){this.updatePolicy!==f.UpdatePolicy.SYNC&&this.stage.syncLayer(this.id)}notifyObjectBBChanged(l,w){null==this._octree||this._objectsAdded.includes(l)||this._octree.update(l,w)}getSpatialQueryAccelerator(){null==this._octree&&50<this._objects.length&&!this._disableOctree?(this._octree=new d(l=>l.boundingVolumeWorldSpace.bounds),this._octree.add(this._objects.data,this._objects.length)):
null!=this._octree&&0<this._objectsAdded.length&&(this._octree.add(this._objectsAdded.data,this._objectsAdded.length),this._objectsAdded.clear());return this._octree}invalidateSpatialQueryAccelerator(){this._octree=k.destroyMaybe(this._octree);this._objectsAdded.clear()}}a.WebGLLayer=c;a.isWebGLLayer=function(l){return null!=l&&l.type===e.ContentObjectType.Layer};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/DirtyEvents":function(){define(["exports"],
function(a){a.DirtyEventNames="layerObjectAdded layerObjectRemoved layerObjectsAdded layerObjectsRemoved transformationChanged shaderTransformationChanged visibilityChanged occlusionChanged highlightChanged geometryAdded geometryRemoved attributesChanged".split(" ");Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/UpdatePolicy":function(){define(["exports"],function(a){a.UpdatePolicy=void 0;var b=a.UpdatePolicy||(a.UpdatePolicy={});b[b.ASYNC=0]="ASYNC";
b[b.SYNC=1]="SYNC";Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/support/FeatureTileTree3D":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Collection ../../../../core/handleUtils ../../../../core/Logger ../../../../core/maybe ../../../../core/PooledArray ../../../../core/reactiveUtils ../../../../core/uid ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ../../../../geometry/support/aaBoundingRect ./FeatureTileDescriptor ./FeatureTileMeasurements3D ../../support/extentUtils ../../../support/Scheduler".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w,x,u,t,m,q,r){a.FeatureTileTree3D=class extends n{constructor(v){super(v);this.tiles=new k;this.tileSize=512;this._idToTile=new Map;this._clients=new Set;this._dirty=!1;this._pendingTiles=null;this._newTiles=new g;this.tileBudget=100}initialize(){const v=()=>this._setDirty(),y=()=>this._reset();this.addHandles([d.watch(()=>this.tilingScheme,y,d.syncAndInitial),d.watch(()=>this.tileSize,y,d.syncAndInitial),d.watch(()=>this.cameraOnSurface?.location,v,d.syncAndInitial),
d.watch(()=>this.viewState?.contentCamera,v,d.syncAndInitial),d.watch(()=>this.focus?.location,v,d.syncAndInitial),d.watch(()=>this.terrain?.baseOpacity??1,v)]);this._frameWorker=this.scheduler?.registerTask(r.TaskPriority.FEATURE_TILE_TREE,this)}destroy(){this._frameWorker=e.removeMaybe(this._frameWorker)}get tilingScheme(){const v=this.tilingSchemeOwner.tilingScheme;return v?v.clone():null}set filterExtent(v){if(null==v||v.spatialReference.equals(this.viewState.spatialReference)){var y=this._get("filterExtent");
y===v||null!=y&&v&&y.equals(v)||(v=null!=v?v.clone():null,this._set("filterExtent",v),this._setDirty())}else h.getLogger(this).error("#extent","extent spatial reference needs to be in the same spatial reference as the view")}get _filterExtentRect(){if(null==this.filterExtent)return null;const v=u.create();q.toBoundingRect(this.filterExtent,v,this.tilingScheme.spatialReference);return v}get _rootTileIds(){const {tilingScheme:v}=this;return this._filterExtentRect&&v?v.rootTilesInExtent(this._filterExtentRect):
[[0,0,0]]}set suspended(v){v!==this._get("suspended")&&(this._set("suspended",v),this._setDirty())}get updating(){return this._dirty||!!this._pendingTiles}addClient(){const v=f.generateUID();this._clients.add(v);1===this._clients.size&&this._setDirty();return p.makeHandle(()=>this._removeClient(v))}_removeClient(v){this._clients.delete(v);this._hasClients||this._clear()}get _hasClients(){return 0<this._clients.size}_setDirty(){!this._hasClients||this.suspended||this._dirty||(this._frameWorker?(this._dirty=
!0,this.notifyChange("updating")):this.runTask(r.noBudget))}_clear(){this.tiles.removeAll();this._idToTile.clear();this._reset();this._dirty=!1;this.notifyChange("updating")}get running(){return this.updating}runTask(v){this._dirty=!1;this._pendingTiles||(this._startUpdate(),null!=this._frameWorker&&(this._frameWorker.priority=r.TaskPriority.FEATURE_TILE_TREE_ACTIVE));this._subdivideTilesForView(v);this._pendingTiles||null==this._frameWorker||(this._frameWorker.priority=r.TaskPriority.FEATURE_TILE_TREE);
this.notifyChange("updating")}_startUpdate(){this.suspended||(this.tilingScheme?(this._tileMeasurements||(this._tileMeasurements=new m.FeatureTileMeasurements3D({renderCoordsHelper:this.renderCoordsHelper,tilingScheme:this.tilingScheme,getIsGroundOpaque:()=>1===(this.terrain?.baseOpacity??1)})),this._tileMeasurements.begin(this.viewState.contentCamera,this.focus.location,this.cameraOnSurface.location.z??0),this._pendingTiles=this._getRootTiles()):this._clear())}_reset(){this._newTiles.clear();this._pendingTiles=
this._tileMeasurements=null;this._setDirty()}_getRootTiles(){const v=this.tilingScheme;return this._rootTileIds.map(y=>new t.FeatureTileDescriptor(y[0],y[1],y[2],v))}_subdivideTilesForView(v){if(this._pendingTiles){for(var {tilingScheme:y}=this;0<this._pendingTiles.length&&!v.done;){const B=this._pendingTiles.shift();v.madeProgress();if(this._filterExtentRect&&!u.intersects(this._filterExtentRect,B.extent))continue;this._tileMeasurements.updateTile(B);const {measures:z}=B;if(z.visibility===t.Visibility.INVISIBLE)continue;
const A=this._newTiles.length+this._pendingTiles.length+1;z.shouldSplit&&A<this.tileBudget?(y.ensureMaxLod(B.lij[0]+1),this._pendingTiles.push(...B.getChildren())):this._newTiles.push(B)}0===this._pendingTiles.length&&(this._updateTiles(this._newTiles.toArray()),this._newTiles.clear(),this._tileMeasurements.end(),this._pendingTiles=null)}}_updateTiles(v){for(var y of this.tiles.items)y.used=!1;v=v.filter(B=>{const z=this._idToTile.get(B.id);z?(z.copyMeasurementsFrom(B),z.used=!0):this._idToTile.set(B.id,
B);return!z});y=this.tiles.items.filter(B=>B.used?!1:(this._idToTile.delete(B.id),!0));this.tiles.removeMany(y);this.tiles.addMany(v);this._sortTiles();this.tiles.emit("change")}_sortTiles(){this.viewState.fixedContentCamera||this.tiles.sort((v,y)=>v.measures.distance-y.measures.distance);this.tiles.forEach((v,y)=>v.loadPriority=y)}};b.__decorate([c.property({constructOnly:!0})],a.FeatureTileTree3D.prototype,"scheduler",void 0);b.__decorate([c.property({constructOnly:!0})],a.FeatureTileTree3D.prototype,
"renderCoordsHelper",void 0);b.__decorate([c.property({constructOnly:!0})],a.FeatureTileTree3D.prototype,"tilingSchemeOwner",void 0);b.__decorate([c.property({constructOnly:!0})],a.FeatureTileTree3D.prototype,"cameraOnSurface",void 0);b.__decorate([c.property({constructOnly:!0})],a.FeatureTileTree3D.prototype,"focus",void 0);b.__decorate([c.property({constructOnly:!0})],a.FeatureTileTree3D.prototype,"viewState",void 0);b.__decorate([c.property({constructOnly:!0})],a.FeatureTileTree3D.prototype,"terrain",
void 0);b.__decorate([c.property()],a.FeatureTileTree3D.prototype,"tiles",void 0);b.__decorate([c.property()],a.FeatureTileTree3D.prototype,"tileSize",void 0);b.__decorate([c.property({readOnly:!0})],a.FeatureTileTree3D.prototype,"tilingScheme",null);b.__decorate([c.property()],a.FeatureTileTree3D.prototype,"filterExtent",null);b.__decorate([c.property({readOnly:!0})],a.FeatureTileTree3D.prototype,"_filterExtentRect",null);b.__decorate([c.property({readOnly:!0})],a.FeatureTileTree3D.prototype,"_rootTileIds",
null);b.__decorate([c.property({value:!1})],a.FeatureTileTree3D.prototype,"suspended",null);b.__decorate([c.property({readOnly:!0})],a.FeatureTileTree3D.prototype,"updating",null);a.FeatureTileTree3D=b.__decorate([x.subclass("esri.views.3d.layers.support.FeatureTileTree3D")],a.FeatureTileTree3D);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/support/FeatureTileDescriptor":function(){define(["exports","../../../../geometry/ellipsoidUtils","../../../../geometry/support/aaBoundingRect"],
function(a,b,n){class k{constructor(h,e,g,d){this.lij=[0,0,0];this.extent=n.create();this.loadPriority=this.resolution=0;this.measures=new p;this.used=!1;this.acquire(h,e,g,d)}get planetRadius(){return b.getReferenceEllipsoid(this.tilingScheme.spatialReference).radius}acquire(h,e,g,d){this.tilingScheme=d;this.id=k.id(h,e,g);this.lij[0]=h;this.lij[1]=e;this.lij[2]=g;d.getExtent(h,e,g,this.extent);this.measures.effectiveLevelForLod=h;this.updateResolution()}updateResolution(){this.resolution=this.tilingScheme.resolutionAtLevel(this.measures.effectiveLevelForLod)}release(){this.tilingScheme=
null}getChildren(h){const e=this.lij[0]+1,g=2*this.lij[1],d=2*this.lij[2];return h?h.acquire(e,g,d,this.tilingScheme):[new k(e,g,d,this.tilingScheme),new k(e,g+1,d,this.tilingScheme),new k(e,g,d+1,this.tilingScheme),new k(e,g+1,d+1,this.tilingScheme)]}copyMeasurementsFrom(h){this.measures.copyFrom(h.measures);this.updateResolution()}static id(h,e,g){return`${h}/${e}/${g}`}}a.Visibility=void 0;(function(h){h[h.INVISIBLE=0]="INVISIBLE";h[h.VISIBLE=1]="VISIBLE"})(a.Visibility||(a.Visibility={}));class p{constructor(){this.visibility=
a.Visibility.VISIBLE;this.distance=0;this.shouldSplit=!1;this.effectiveLevelForLod=0}copyFrom(h){this.visibility=h.visibility;this.distance=h.distance;this.shouldSplit=h.shouldSplit;this.effectiveLevelForLod=h.effectiveLevelForLod;return this}}a.FeatureTileDescriptor=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/support/FeatureTileMeasurements3D":function(){define("exports ../../../../core/mathUtils ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../geometry/support/aaBoundingRect ../../../../geometry/support/frustum ../../../../geometry/support/ray ../../../ViewingMode ./FeatureTileDescriptor ./FeatureTileVisibility3D ../../webgl/RenderCamera".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c){class l{constructor(y){this._camera=new c;this._focusOnMap=[0,0];this._renderCoordsHelper=y.renderCoordsHelper;this._tilingScheme=y.tilingScheme;this._visibility=new f.FeatureTileVisibility3D(y.renderCoordsHelper,y.getIsGroundOpaque)}begin(y,B,z){this._camera.copyFrom(y);this._surfaceElevation=z;this._focusOnMap[0]=B.x;this._focusOnMap[1]=B.y;this._visibility.begin(this._camera)}end(){this._visibility.end()}updateTile(y){const {measures:B}=y;B.visibility=this._visibility.calculate(y);
B.distance=p.distance(y.extent,this._focusOnMap);B.visibility!==d.Visibility.INVISIBLE&&this._updateSplitDecisionAndLod(y)}_calculateTileShouldSplitGlobal(y){var {eye:B}=this._camera,z=n.len(B),A=this._renderCoordsHelper;const C=A.referenceEllipsoid.radius;if(z>2*C)return y.measures.effectiveLevelForLod=0,!1;z=y.lij[0];if(z<=f.globalTileLevelThreshold)return y.measures.effectiveLevelForLod=z,!0;z=w;var {extent:H}=y,{_surfaceElevation:E}=this;n.set(z[0],H[0],H[1],E);n.set(z[1],H[2],H[1],E);n.set(z[2],
H[2],H[3],E);n.set(z[3],H[0],H[3],E);H=n.set(x,.5*(H[0]+H[2]),.5*(H[1]+H[3]),E);E=this._tilingScheme.spatialReference;for(let F=0;4>F;++F)A.toRenderCoords(z[F],E,z[F]);A.toRenderCoords(H,E,H);A=n.normalize(u,H);E=n.dot(B,A);E=n.scale(t,A,E);B=n.len(B)-C;n.copy(v.origin,r);n.copy(v.direction,A);return this._calculateTileShouldSplitCommon(y,z,H,v,B,E)}_calculateTileShouldSplitLocal(y){const B=w;var {extent:z}=y,{_surfaceElevation:A}=this;n.set(B[0],z[0],z[1],A);n.set(B[1],z[2],z[1],A);n.set(B[2],z[2],
z[3],A);n.set(B[3],z[0],z[3],A);z=this._tilingScheme.spatialReference;for(A=0;4>A;++A)this._renderCoordsHelper.toRenderCoords(B[A],z,B[A]);z=n.set(x,.5*(B[0][0]+B[2][0]),.5*(B[0][1]+B[2][1]),.25*(B[0][2]+B[1][2]+B[2][2]+B[3][2]));A=n.set(u,z[0],z[1],0);const {eye:C,far:H}=this._camera,E=n.set(t,A[0],A[1],C[2]),F=C[2];n.set(v.origin,A[0],A[1],C[2]-2*H);n.copy(v.direction,m);return this._calculateTileShouldSplitCommon(y,B,z,v,F,E,q,C[2]-2*H)}_calculateTileShouldSplitCommon(y,B,z,A,C,H,E,F){const G=
Math.max(n.dist(B[0],B[2]),n.dist(B[1],B[3]),n.dist(B[0],z)+n.dist(z,B[2])),D=this._camera,{eye:I,near:J,far:N,fovY:M,viewForward:Q}=D;var O=b.clamp(n.dot(A.direction,Q),.1,1);const K=n.dot(I,Q);var L=n.dot(z,Q)-K;const P=2*Math.tan(.5*M);var R=Math.abs(C)/G;const W=L<=J?1:1/(L*P),V=y.lij[0];var ba=n.dist(I,z),U=0,da=Infinity;for(var fa of B){var ha=n.dist(I,fa);da=Math.min(da,ha);U=Math.max(U,ha)}const {perScreenPixelRatio:T}=D;fa=S=>Math.max(0,V-2,V+Math.ceil(Math.log2(.002*S/T)));ha=300*b.clamp(O,
.1,1);O=n.dist(H,I)>.7*G;ba=fa(O?1*G/ba:L<J?ha*G/Math.abs(C):.8*W*G);C=ba+(da-J>.33*(N-J)?-1:0);y.measures.effectiveLevelForLod=C;if(V+2<C)return!0;if(V>=C)return!1;({frustum:y}=D);R=1>R;if(n.dist(H,I)<J)return R;A=h.intersectsRay(y,A);if(O){if(da=fa(1*G/da),U=fa(1*G/U),2<Math.abs(da-U)||2<Math.abs(ba-U)||2<Math.abs(ba-da))return!0}else if(U=n.dist(I,z),da=.5*G/Math.SQRT2,V<=C+3||.6<U/da)return!0;if(!this.isGlobalMode&&O&&E&&void 0!==F){U=0;for(O=0;4>O;++O)da=E[O],H=F,fa=k.create(),n.scaleAndAdd(fa,
B[O],da,H),da=e.fromValues(fa,da),h.intersectsRay(y,da)&&++U;if(3<=U||2<=U&&A)return!1;if(2>=U&&!A&&V<ba+1)return!0}z=h.intersectsPoint(y,z);E=0;for(F=0;4>F;++F)ba=h.intersectsPoint(y,B[F]),E+=ba?1:0;if(z&&2<=E)return!1;if(!z&&!A&&1>=E&&V<C)return R;for(F=0;4>F;++F)y=n.dot(B[F],Q)-K,L=Math.min(L,y);return L<=J?R:.3>(L<=J?1:1/(L*P))*G?!1:V<C&&.9<W*G&&2>=E&&!z&&!A}_updateSplitDecisionAndLod(y){y.measures.shouldSplit=this.isGlobalMode?this._calculateTileShouldSplitGlobal(y):this._calculateTileShouldSplitLocal(y);
y.updateResolution()}get isGlobalMode(){return this._renderCoordsHelper.viewingMode===g.ViewingMode.Global}}const w=[k.create(),k.create(),k.create(),k.create()],x=k.create(),u=k.create(),t=k.create(),m=k.freeze(0,0,1),q=[m,m,m,m],r=k.ZEROS,v=e.fromValues(k.ZEROS,m);a.FeatureTileMeasurements3D=l;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/support/FeatureTileVisibility3D":function(){define("exports ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../geometry/ellipsoidUtils ../../../../geometry/spatialReferenceEllipsoidUtils ../../../../geometry/projection/projectBuffer ../../../../geometry/projection/projectVec3Array ../../../../geometry/support/frustum ../../../../geometry/support/plane ../../../ViewingMode ./FeatureTileDescriptor ../../state/Frustum".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l){function w(Ca,Ha,Ga){b.cross(Ca,Ha,Ga);b.normalize(Ca,Ca);return Ca}function x(Ca,Ha,Ga){b.sub(Ca,Ha,Ga);b.normalize(Ca,Ca);return Ca}function u(Ca,Ha){b.scale(Ca,Ca,Ha/b.len(Ca));return Ca}function t(Ca,Ha,Ga){for(const $a of A){a:{var Aa=Ca[$a];var Ja=Ha,Sa=Ga;for(let Wa=0;Wa<Sa;++Wa)if(0>=d.signedDistance(Aa,Ja[Wa])){Aa=!1;break a}Aa=!0}if(Aa)return!0}return!1}function m(Ca,Ha,Ga=Ha.length){for(let Aa=0;Aa<Ga;++Aa){const Ja=Ha[Aa];let Sa=!0;for(const $a of Ca)if(0<
d.signedDistance($a,Ja)){Sa=!1;break}if(Sa)return!0}return!1}function q(Ca,Ha,Ga){for(const Aa of Ha)if(b.dot(Aa,Ca)<Ga)return!1;return!0}function r(Ca,Ha,Ga,Aa){if(0===Ga.length||0===Aa.length)return!0;var Ja=Y;w(Ja,Ca,Ha);var Sa=Aa[0]<Ga[0];Ca=Sa?Ga:Aa;Ha=na;Sa=Sa?Aa:Ga;Ga=Infinity;Aa=-Infinity;for(var $a of Sa)Sa=b.dot(Ja,$a),Ga=Math.min(Ga,Sa),Aa=Math.max(Aa,Sa);Ha[0]=Ga;Ha[1]=Aa;a:{$a=Ha[0];Ha=Ha[1];Ga=Infinity;Aa=-Infinity;for(const Wa of Ca)if(Ca=b.dot(Ja,Wa),Ga=Math.min(Ga,Ca),Aa=Math.max(Aa,
Ca),Ga<=Ha&&Aa>=$a){Ja=!1;break a}Ja=!0}return Ja}function v(Ca,Ha,Ga){const Aa={t0:0,t1:1};for(const Ja of A)if(!B(Ca[Ja],Ha,Ga,Aa))return!1;return Aa.t0<Aa.t1}function y(Ca,Ha,Ga){const Aa={t0:0,t1:1};for(const Ja of Ca)if(!B(Ja,Ha,Ga,Aa))return!1;return Aa.t0<Aa.t1}function B(Ca,Ha,Ga,Aa){let {t0:Ja,t1:Sa}=Aa;Ha=d.signedDistance(Ca,Ha);Ca=d.signedDistance(Ca,Ga);if(0<=Ha&&0<=Ca)return!1;if(0>Ha&&0<=Ca){Ca=-Ha/(Ca-Ha);if(Ca<Ja)return!1;Ca<Sa&&(Sa=Ca)}else if(0<=Ha&&0>Ca){Ca=Ha/(Ha-Ca);if(Ca>Sa)return!1;
Ca>Ja&&(Ja=Ca)}Aa.t0=Ja;Aa.t1=Sa;return!0}class z{constructor(Ca,Ha){this._renderCoordsHelper=Ca;this._getIsGroundOpaque=Ha;this._isGroundOpaque=!1;this._cache=new Map;this._cameraForward=n.create();this._cameraEye=n.create();this._cameraFovY=55*Math.PI/180;this._frustumBoundingSphereCenter=n.create();this._frustumBoundingSphereRadius=0;this._frustum=new l.Frustum(Ca);this._renderSR=Ca.spatialReference;Ca=p.getSphericalPCPF(this._renderSR);this._renderSREllipsoidRadius=k.getReferenceEllipsoid(Ca).radius}begin(Ca){this._aboveGround=
Ca.aboveGround;this._isGroundOpaque=this._getIsGroundOpaque();this._frustum.update(Ca);b.normalize(this._cameraForward,Ca.viewForward);b.copy(this._cameraEye,Ca.eye);this._cameraFovY=Ca.fovY;this._updateFrustumBoundingSphere()}end(){this._cache.clear()}calculate(Ca){return this._getOrCalculateSingleTileVisibility(Ca)}_getOrCalculateSingleTileVisibility(Ca){var Ha=this._cache.get(Ca.id);if(null!=Ha)return Ha;Ha=this._calculateSingleTileVisibility(Ca);this._cache.set(Ca.id,Ha);return Ha}_calculateSingleTileVisibility(Ca){return this._calculateSingleTileVisibilitySided(Ca)}_isTileVisibleInFrustum(Ca){return this._renderCoordsHelper.viewingMode===
f.ViewingMode.Local?this._isTileVisibleInFrustumLocal(Ca):this._isTileVisibleInFrustumGlobal(Ca)}_updateFrustumBoundingSphere(){var Ca=this._frustum;const Ha=Ca.origin,Ga=Q;b.normalize(Ga,Ca.direction);var Aa=O;b.sub(Aa,Ca.points[4],Ha);Ca=b.dot(Aa,Aa);Aa=b.dot(Ga,Aa);Aa=.5*Ca/Aa;b.scaleAndAdd(this._frustumBoundingSphereCenter,Ha,Ga,Aa);this._frustumBoundingSphereRadius=1+Aa}_isTileVisibleInFrustumLocal(Ca){var Ha=Ca.tilingScheme.spatialReference,Ga=Ca.extent,Aa=this._renderSR;Ca=H;Ca[0]=Ga[0];Ca[1]=
Ga[1];Ca[2]=0;Ca[3]=Ga[2];Ca[4]=Ga[3];Ca[5]=0;if(!h.projectBuffer(Ca,Ha,0,Ca,Aa,0))return!1;Ha=E;b.set(Ha[0],Ca[0],Ca[1],0);b.set(Ha[1],Ca[3],Ca[1],0);b.set(Ha[2],Ca[3],Ca[4],0);b.set(Ha[3],Ca[0],Ca[4],0);Aa=F;b.set(Aa,.5*(Ca[0]+Ca[3]),.5*(Ca[1]+Ca[4]),.5*(Ca[2]+Ca[5]));Ga=ta;var Ja=.5*b.dist(Ha[0],Ha[2]);Ca=this._frustum;var Sa=this._frustumBoundingSphereRadius,$a=this._frustumBoundingSphereCenter,Wa=L;b.sub(Wa,$a,Aa);Wa=b.dot(Ga,Wa);var Ta=K;b.scaleAndAdd(Ta,Aa,Ga,Wa);if(b.dist(Ta,$a)>Ja+Sa)return!1;
$a=this._cameraForward;Ja=b.dot($a,ta);Aa=this._cameraEye;if(Math.abs(Ja)<Math.abs(Math.cos(.5*this._cameraFovY))){Ja=!0;$a=b.set(Ba,$a[0],$a[1],0);Ta=b.dot(Aa,$a);for(let Da=0;4>Da;++Da)if(0<b.dot(Ha[Da],$a)-Ta){Ja=!1;break}if(Ja)return!1}Ja=Ha[0];$a=Ha[2];if(Ja[0]<=Aa[0]&&Aa[0]<=$a[0]&&Ja[1]<=Aa[1]&&Aa[1]<=$a[1])return!0;Ja=C;$a=Math.min(this._isGroundOpaque&&!this._aboveGround?430:Infinity,Wa+Sa);Sa=Math.max(this._isGroundOpaque&&this._aboveGround?-430:-Infinity,Wa-Sa);for(Wa=0;4>Wa;++Wa)b.scaleAndAdd(Ja[Wa],
Ha[Wa],Ga,$a),b.scaleAndAdd(Ja[Wa+4],Ha[Wa],Ga,Sa);if(t(Ca.planes,Ja,8))return!1;if(m(Ca.planes,Ja,8))return!0;for(Ga=0;4>Ga;++Ga)if(Wa=Ja[Ga],Ta=Ja[Ga+4],v(Ca.planes,Wa,Ta)||v(Ca.planes,Wa,Ja[(Ga+1)%4])||v(Ca.planes,Ta,Ja[4+(Ga+1)%4]))return!0;Ia[0][3]=+Ha[0][0];Ia[1][3]=-Ha[2][0];Ia[2][3]=+Ha[0][1];Ia[3][3]=-Ha[2][1];Ia[4][3]=+Sa;Ia[5][3]=-$a;if(m(Ia,Ca.points)||m(Ia,Ca.points))return!0;for(Ha=0;4>Ha;++Ha)if(Ga=Ca.points[Ha+4],y(Ia,Aa,Ga)||y(Ia,Ga,Ca.points[4+(Ha+1)%4]))return!0;return!1}_isTileVisibleInFrustumGlobal(Ca){if(2>
Ca.lij[0])return!0;var Ha=Ca.tilingScheme.spatialReference,Ga=Ca.extent;const Aa=this._isGroundOpaque&&this._aboveGround,Ja=this._isGroundOpaque&&!this._aboveGround;var Sa=E,$a=.5*(Ga[0]+Ga[2]);b.set(Sa[0],Ga[0],Ga[1],0);b.set(Sa[1],Ga[2],Ga[1],0);b.set(Sa[2],Ga[2],Ga[3],0);b.set(Sa[3],Ga[0],Ga[3],0);b.set(Sa[4],$a,Ga[1],0);b.set(Sa[5],$a,Ga[3],0);if(!e.projectVec3Array(Sa,Ha,0,Sa,this._renderSR,0,6))return!1;var Wa=0<Sa[0][2],Ta=0>Sa[3][2];Ga=this._renderSREllipsoidRadius;if(Wa||Ta){var Da=n.fromValues(0,
0,1),La=D;w(La,Da,Sa[0]);$a=I;w($a,Da,Sa[1]);if(Wa){Wa=G;Ta=Sa[4];var Va=J;w(Va,Ta,Da);w(Wa,Va,Ta);Da=Sa[0];b.cross(Da,La,Wa);u(Da,Ga);La=Sa[1];b.cross(La,$a,Wa);u(La,Ga)}else Ta&&(Wa=G,Ta=Sa[5],Va=J,w(Va,Ta,Da),w(Wa,Ta,Va),Da=Sa[3],b.cross(Da,Wa,La),u(Da,Ga),La=Sa[2],b.cross(La,Wa,$a),u(La,Ga))}Ta=F;$a=b.sub(ba,Sa[3],Sa[0]);b.normalize($a,$a);La=b.add(U,Sa[0],Sa[3]);b.scale(La,La,.5);Da=-b.dot(La,$a);La=b.add(da,Sa[0],Sa[1]);b.scale(La,La,.5);Wa=b.add(fa,Sa[2],Sa[3]);b.scale(Wa,Wa,.5);Wa=b.sub(ha,
Wa,La);b.normalize(Wa,Wa);$a=-(Da+b.dot($a,La))/b.dot($a,Wa);b.scaleAndAdd(Ta,La,Wa,$a);u(Ta,Ga);Wa=this._frustumBoundingSphereRadius;Va=this._frustumBoundingSphereCenter;const ma=this._frustum;La=ma.planes;var za=N;b.normalize(za,Ta);Da=b.dot(Sa[0],za)/b.len(Sa[0]);var Na=ma.origin;$a=ma.points;var Ra=!1;if(Aa){Ra=!0;var Pa=b.normalize(n.create(),Na);for(var ca=0;4>ca;++ca){var cb=$a[4+ca];cb=b.sub(n.create(),cb,Na);b.normalize(cb,cb);var ib=b.cross(n.create(),Pa,cb);b.normalize(ib,ib);cb=b.cross(n.create(),
cb,ib);b.normalize(cb,cb);if(b.dot(Na,cb)>Ga){Ra=!1;break}}if(Ra&&b.dot(Na,za)<Ga*Da-430)return!1;Na=b.normalize(qa,ma.origin);if(0>b.dot(Na,za))return!1;Na=b.normalize(sa,ma.direction);if(b.dot(Na,za)>xa)return!1}Pa=Math.sqrt(1-Da*Da);if(.9<Pa)return!0;Na=!1;cb=b.dot(za,Va);ib=b.len(Va);if(ib<=Wa&&!La.some(xb=>0<d.signedDistance(xb,P)))if(Aa)Na=!0;else return!0;ca=cb/ib;if(!Na&&0>=cb&&-cb>Wa)return!1;cb=Wa/ib;if(Math.sqrt(1-ca*ca)*Math.sqrt(1-cb*cb)-cb*ca>Pa)return!1;if(!Ra&&(Sa.some(xb=>ma.intersectsPoint(xb))||
ma.intersectsPoint(Ta)))return!0;Ta=R;b.sub(Ta,Va,P);Ta=b.dot(Ta,za);Ra=M;b.scale(Ra,za,Ta);Va=b.dist(Ra,Va);Ha=Ha.isWGS84;za=Ca.lij;Ca=Ha&&za[2]===2**za[0]-1;Ha=(za=Ha&&0===za[2])?aa:Ca?ja:ea;Ca=za?pa:Ca?X:ka;if(!Na){za=la;Na=T;Ra=S;Pa=P;for(var nb of Ha)if(Ha=Sa[nb],x(Na,Sa[(nb+1)%4],Ha),x(Ra,Pa,Ha),w(za,Ra,Na),q(za,$a,1))return!1}nb=null;if(!Aa&&Ta<1.01*Wa){nb=2.5*Wa;if(Va>Da*nb+Wa)return!1;Ha=V;nb/=Da;for(Da=0;4>Da;++Da)b.scale(Ha[Da],Sa[Da],nb/Ga);b.set(Ha[4],0,0,0);nb=Ha}else{nb=(Ja?Ga+430:
Ta+Wa)/Da;Ha=Aa?Ga-430:(Ta-Wa)/Da;Da=W;for(Wa=0;4>Wa;++Wa)Ta=Sa[Wa],b.scale(Da[Wa],Ta,Ha/Ga),b.scale(Da[Wa+4],Ta,nb/Ga);nb=Da}if(t(La,nb,nb.length))return!1;Ha=ma.lines;Sa=Z;Ga=ia;for(const xb of Ha){b.normalize(Ga,xb.direction);for(const ya of Ca){Ha=nb[ya];b.normalize(Sa,Ha);if(r(Ga,Sa,nb,$a))return!1;La=(ya+1)%4;if(Aa&&(b.sub(Sa,nb[La],Ha),b.normalize(Sa,Sa),r(Ga,Sa,nb,$a))||Ja&&(b.sub(Sa,nb[4+La],nb[4+ya]),b.normalize(Sa,Sa),r(Ga,Sa,nb,$a)))return!1}}return!0}_calculateSingleTileVisibilitySided(Ca){return this._isTileVisibleInFrustum(Ca)?
c.Visibility.VISIBLE:c.Visibility.INVISIBLE}}const A=[g.PlaneIndex.LEFT,g.PlaneIndex.RIGHT,g.PlaneIndex.BOTTOM,g.PlaneIndex.TOP,g.PlaneIndex.FAR],C=[n.create(),n.create(),n.create(),n.create(),n.create(),n.create(),n.create(),n.create()],H=[0,0,0,0,0,0],E=[n.create(),n.create(),n.create(),n.create(),n.create(),n.create()],F=n.create(),G=n.create(),D=n.create(),I=n.create(),J=n.create(),N=n.create(),M=n.create(),Q=n.create(),O=n.create(),K=n.create(),L=n.create(),P=n.freeze(0,0,0),R=n.create(),W=[n.create(),
n.create(),n.create(),n.create(),n.create(),n.create(),n.create(),n.create()],V=[n.create(),n.create(),n.create(),n.create(),n.create()],ba=n.create(),U=n.create(),da=n.create(),fa=n.create(),ha=n.create(),T=n.create(),S=n.create(),Z=n.create(),ia=n.create(),Y=n.create(),ea=[0,1,2,3],ka=[0,1,2,3],ja=[0,1,3],X=[0,1,3],aa=[1,2,3],pa=[1,2,3],la=n.create(),na=[0,0],qa=n.create(),sa=n.create(),xa=Math.cos(.25*Math.PI),ta=n.fromValues(0,0,1),Ba=n.create(),Ia=[d.fromValues(-1,0,0,1),d.fromValues(1,0,0,-1),
d.fromValues(0,-1,0,1),d.fromValues(0,1,0,-1),d.fromValues(0,0,-1,1),d.fromValues(0,0,1,-1)];a.FeatureTileVisibility3D=z;a.globalTileLevelThreshold=2;a.isAnyVertexInPolyhedron=m;a.isConvexHullOutsideOfFrustum=t;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/projection/projectVec3Array":function(){define(["exports","../../chunks/vec32","./projectors"],function(a,b,n){a.projectVec3Array=function(k,p,h,e,g,d,f=1){p=n.getProjector(p,g,n.projectorCache);if(null==p)return!1;
if(p===n.copy3){if(k===e&&h===d)return!0;f=h+f;for(let c=h,l=d;c<f;++c,++l)b.copy(e[l],k[c]);return!0}f=h+f;for(let c=h,l=d;c<f;++c,++l)p(k[c],0,e[l],0);return!0};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/extentUtils":function(){define(["exports","../../../core/libs/gl-matrix-2/factories/vec3f64","../../../geometry/projection/projectBuffer"],function(a,b,n){const k=b.create();a.projectToBoundingBox=function(p,h,e){if(null==p||null==e)return!1;let g;k[0]=
null!=p.xmin?p.xmin:0;k[1]=null!=p.ymin?p.ymin:0;k[2]=null!=p.zmin?p.zmin:0;g=n.projectBuffer(k,p.spatialReference,0,h,e,0);k[0]=null!=p.xmax?p.xmax:0;k[1]=null!=p.ymax?p.ymax:0;k[2]=null!=p.zmax?p.zmax:0;g=g&&n.projectBuffer(k,p.spatialReference,0,h,e,3);null==p.xmin&&(h[0]=-Infinity);null==p.ymin&&(h[1]=-Infinity);null==p.zmin&&(h[2]=-Infinity);null==p.xmax&&(h[3]=Infinity);null==p.ymax&&(h[4]=Infinity);null==p.zmax&&(h[5]=Infinity);return g};a.toBoundingRect=function(p,h,e){if(null==p||null==e)return!1;
let g;k[0]=null!=p.xmin?p.xmin:0;k[1]=null!=p.ymin?p.ymin:0;k[2]=null!=p.zmin?p.zmin:0;g=n.projectBuffer(k,p.spatialReference,0,k,e,0);h[0]=k[0];h[1]=k[1];k[0]=null!=p.xmax?p.xmax:0;k[1]=null!=p.ymax?p.ymax:0;k[2]=null!=p.zmax?p.zmax:0;g=g&&n.projectBuffer(k,p.spatialReference,0,k,e,0);h[2]=k[0];h[3]=k[1];null==p.xmin&&(h[0]=-Infinity);null==p.ymin&&(h[1]=-Infinity);null==p.xmax&&(h[2]=Infinity);null==p.ymax&&(h[3]=Infinity);return g};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/state/ViewState":function(){define("../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/Evented ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ../../../core/accessorSupport/watch ../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../geometry/ellipsoidUtils ../../ViewAnimation ../../ViewingMode ./Constraints ./controllers/AnimationController ./controllers/CameraController ../webgl/RenderCamera ../webgl-engine/lib/rendererUtils ../../support/PropertiesPool ../../support/RenderState".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w,x,u,t,m,q,r,v,y){function B(A,C){return A.fov!==C.fov||A.fullViewport[0]!==C.fullViewport[0]||A.fullViewport[1]!==C.fullViewport[1]||A.fullViewport[2]!==C.fullViewport[2]||A.fullViewport[3]!==C.fullViewport[3]||A.padding[r.PaddingSide.TOP]!==C.padding[r.PaddingSide.TOP]||A.padding[r.PaddingSide.RIGHT]!==C.padding[r.PaddingSide.RIGHT]||A.padding[r.PaddingSide.BOTTOM]!==C.padding[r.PaddingSide.BOTTOM]||A.padding[r.PaddingSide.LEFT]!==C.padding[r.PaddingSide.LEFT]?
!0:!1}b=class extends b{constructor(A){super(A);this._propertiesPool=new v.PropertiesPool({camera:q},this);this._lastSeenCameraProjectionValues=new q;this.mode=y.RenderState.ANIMATING;this._cssCamera=new q;this._camera=new q;this.contentPixelRatio=this.rasterPixelRatio=1;this.constraints=new u.Constraints({state:this});this.events=new n;this._cameraChanged=!1;this._updateQueue=[];this._processingUpdates=!1}reset(){this.cameraController=null;this._propertiesPool.destroy();this._propertiesPool=new v.PropertiesPool({camera:q},
this)}destroy(){this.cameraController=null;this._propertiesPool?.destroy();this._propertiesPool=null}createInitialCamera(){if(this.viewingMode===x.ViewingMode.Global){const A=l.getReferenceEllipsoid(this.spatialReference).radius;this.camera=new q({eye:c.fromValues(4*A,0,0),center:c.fromValues(A,0,0),up:c.fromValues(0,0,1)})}else this.camera=new q({eye:c.fromValues(0,0,100),center:c.fromValues(0,0,0),up:c.fromValues(0,1,0)})}get animation(){return this.cameraController instanceof t.AnimationController&&
null!=this.cameraController.viewAnimation?this.cameraController.viewAnimation:null}get cssCamera(){const A=this._cssCamera.copyFrom(this.camera),{height:C,width:H,pixelRatio:E}=this.camera;A.pixelRatio=1;A.height=Math.round(C/E);A.width=Math.round(H/E);return A}get camera(){return this._camera}set camera(A){A!==z&&z.copyFrom(A);z.computeUp(this.viewingMode);this.events.emit("before-camera-change",z);A=this._camera;B(this._lastSeenCameraProjectionValues,z)&&(this._lastSeenCameraProjectionValues.copyFrom(z),
this.events.emit("camera-projection-changed",this._lastSeenCameraProjectionValues));if(!A.equals(z)&&(this._camera=this._propertiesPool.get("camera").copyFrom(z),this._cameraChanged=!A.almostEquals(z))){const C=f.afterDispatch(()=>{this._cameraChanged=!1;C.remove()})}}get pixelRatio(){return this.camera.pixelRatio}get alignPixelEnabled(){return this.pixelRatio===this.rasterPixelRatio&&this.mode===y.RenderState.IDLE}get updating(){return this.mode!==y.RenderState.IDLE}get contentCamera(){return this._contentCamera??
this.camera}set contentCamera(A){this._contentCamera=null!=A?A.clone():null}get fixedContentCamera(){return null!=this._contentCamera}get isGlobal(){return this.viewingMode===x.ViewingMode.Global}get isLocal(){return this.viewingMode===x.ViewingMode.Local}get viewingMode(){return x.viewingModeFromString(this.view.viewingMode)}get spatialReference(){return this.view.spatialReference}get navigating(){return!!this.cameraController?.isInteractive}get stationary(){return!this._cameraChanged&&!this.navigating}get cameraController(){return this._get("cameraController")}set cameraController(A){this.stopActiveCameraController()?
(this.cameraController?.destroy(),A&&(this.removeHandles("ViewStateHandles"),this.addHandles(k.when(()=>A.state===m.State.Finished||A.state===m.State.Stopped,()=>{this._set("cameraController",null);this.updateCamera(C=>A.onControllerEnd(C))},{sync:!0,once:!0}),"ViewStateHandles"),A.onControllerStart(this.camera)),this._set("cameraController",A)):A&&(A.state=m.State.Rejected)}switchCameraController(A){this.cameraController=A}stopActiveCameraController(){return!this.cameraController||this.cameraController.stopController()}updateCamera(A){this._updateQueue.push(A);
this._processUpdateQueue()}_processUpdateQueue(){if(0!==this._updateQueue.length&&!this._processingUpdates){this._processingUpdates=!0;var A=this._updateQueue.shift();z.copyFrom(this._get("camera"));A(z);this.camera=z;this._processingUpdates=!1;this._processUpdateQueue()}}};a.__decorate([p.property({constructOnly:!0})],b.prototype,"view",void 0);a.__decorate([p.property()],b.prototype,"mode",void 0);a.__decorate([p.property({readOnly:!0,type:w})],b.prototype,"animation",null);a.__decorate([p.property({type:q})],
b.prototype,"cssCamera",null);a.__decorate([p.property()],b.prototype,"_cssCamera",void 0);a.__decorate([p.property({type:q})],b.prototype,"camera",null);a.__decorate([p.property()],b.prototype,"_camera",void 0);a.__decorate([p.property({readOnly:!0})],b.prototype,"pixelRatio",null);a.__decorate([p.property()],b.prototype,"rasterPixelRatio",void 0);a.__decorate([p.property()],b.prototype,"contentPixelRatio",void 0);a.__decorate([p.property({readOnly:!0})],b.prototype,"alignPixelEnabled",null);a.__decorate([p.property({readOnly:!0})],
b.prototype,"updating",null);a.__decorate([p.property({})],b.prototype,"_contentCamera",void 0);a.__decorate([p.property({type:q})],b.prototype,"contentCamera",null);a.__decorate([p.property({readOnly:!0})],b.prototype,"fixedContentCamera",null);a.__decorate([p.property({readOnly:!0})],b.prototype,"events",void 0);a.__decorate([p.property({readOnly:!0})],b.prototype,"isGlobal",null);a.__decorate([p.property({readOnly:!0})],b.prototype,"isLocal",null);a.__decorate([p.property({readOnly:!0})],b.prototype,
"viewingMode",null);a.__decorate([p.property()],b.prototype,"navigating",null);a.__decorate([p.property()],b.prototype,"stationary",null);a.__decorate([p.property()],b.prototype,"_cameraChanged",void 0);a.__decorate([p.property()],b.prototype,"cameraController",null);a=b=a.__decorate([d.subclass("esri.views.3d.state.ViewState")],b);const z=new q;return a})},"esri/views/3d/state/helpers/SceneIntersectionHelper":function(){define("exports ../../../../core/PooledArray ../../../../core/screenUtils ../../../../core/unitUtils ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../geometry/support/aaBoundingRect ../../../../geometry/support/ray ../../../../geometry/support/vectorStacks ../../../../support/elevationInfoUtils ../../../ViewingMode ../../support/hitTest ../../support/geometryUtils/ray ../../webgl-engine/lib/Intersector ../../webgl-engine/lib/IntersectorInterfaces ../../webgl-engine/lib/intersectorUtils ../../webgl-engine/materials/HUDMaterial".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w,x,u,t,m){function q(E){B&&B.viewingMode===E||(B=x.newIntersector(E));return B}class r{constructor(E,F,G){this.viewingMode=E;this._forEachLayer=F;this._view=G;this._externalIntersectionHandlers=new b;this._tolerance=x.defaultTolerance;this._tmpRay=g.create();this._tmpRegion=e.create();this._validateHUDIntersector=x.newIntersector(this.viewingMode);this._validateHUDIntersector.options.hud=!1}intersectScreen(E,F,G){return this.intersectRay(this._getPickRay(E,this._tmpRay),
q(this.viewingMode),F,G)}intersectScreenFreePointFallback(E,F,G){return this.intersectRayFreePointFallback(this._getPickRay(E,this._tmpRay),F,G)}intersectRayFreePointFallback(E,F,G){return this.intersectRay(E,q(this.viewingMode),F,G)||this._intersectRayFreePointLocal(E,F)}intersectRay(E,F,G,D){F.options.selectionMode=!1;F.options.store=u.StoreResults.MIN;this.computeIntersection(E,F,D);return F.results.min?F.results.min.getIntersectionPoint(G):!1}getCenterRayWithSubpixelOffset(E,F,G=.5,D=.5){E.getRenderCenter(H,
G,D);H[0]+=.0466;H[1]-=.0123;return w.fromRenderAtEye(E,H,F)}intersectIntersectorScreen(E,F,G){this.computeIntersection(this._getPickRay(E,this._tmpRay),F,G)}intersectToolIntersectorScreen(E,F,G){E=this._getPickRay(E,this._tmpRay);this.intersectToolIntersectorRay(E,F,G)}intersectToolIntersectorRay(E,F,G){F.options.selectionMode=!0;this.computeIntersection(E,F,G);const D=F.results.min;this._view.basemapTerrain&&this._view.basemapTerrain.opaque||t.isValidIntersectorResult(D)&&D.intersector!==u.IntersectorType.TERRAIN||
(F.options.selectionMode=!1,this.computeIntersection(E,F,G))}setTolerance(E=x.defaultTolerance){this._tolerance=E}addIntersectionHandler(E){this._externalIntersectionHandlers.push(E);this._externalIntersectionHandlers.sort((F,G)=>F.type===u.IntersectorType.TERRAIN?1:G.type===u.IntersectorType.TERRAIN?-1:0)}removeIntersectionHandler(E){null!=this._externalIntersectionHandlers.removeUnordered(E)&&this._externalIntersectionHandlers.sort((F,G)=>F.type===u.IntersectorType.TERRAIN?1:G.type===u.IntersectorType.TERRAIN?
-1:0)}_getPickRay(E,F){return w.fromScreen(this._view.state.camera,E,F)}_intersectRayFreePointLocal(E,F){if(this.viewingMode!==c.ViewingMode.Local||null==E)return!1;p.add(F,E.origin,p.normalize(d.sv3d.get(),E.direction));return!1}intersectElevationFromScreen(E,F,G=0,D=null){return this._intersectElevation(this._getPickRay(E,this._tmpRay),F,G,D)}_intersectElevation(E,F,G=0,D=null){if(null==E)return null;var I=this._view,{renderCoordsHelper:J}=I,N=k.getMetersPerVerticalUnitForSR(I.spatialReference),
M=null!=F?F.mode:"absolute-height";F=f.getElevationOffsetInMeters(F)/N;const Q=("on-the-ground"!==M?F+G:0)*N/J.unitInMeters;({camera:N}=I.state);if("absolute-height"===M)return G=J?.getAltitude(N.eye),M=p.dot(p.normalize(A,E.direction),J.worldUpAtPosition(N.eye,C)),G<Q&&0>M||G>=Q&&0<M?null:J.intersectInfiniteManifold(E,Q,A)?(I=l.computeMapPointFromVec3d(I,A),I.z??(I.z=0),I.z-=F,I):null;const O=n.castRenderScreenPointArray3(d.sv3d.get());N.projectToRenderScreen(E.origin,O);J=new z(null,this._forEachLayer);
({slicePlane:F}=I);const K=null!=F?t.sliceFilterPredicate(F):null,L=x.newIntersector(this.viewingMode);L.options.store=u.StoreResults.MIN;L.options.verticalOffset=Q;L.options.normalRequired=!1;F=E.origin;E=p.add(d.sv3d.get(),F,E.direction);L.reset(F,E,N);L.point=O;const P=D?"type"in D&&"graphics"===D.type?R=>R.layerUid!==D.uid:R=>R.graphicUid!==D.uid:null;switch(M){case "relative-to-scene":L.intersect(J.layers,O,this._tolerance,null,R=>(!P||P(R))&&!!R.lastValidElevationBB);this._externalIntersectionHandlers.forAll(R=>
{R.type!==u.IntersectorType.I3S&&R.type!==u.IntersectorType.TERRAIN&&R.type!==u.IntersectorType.TILES3D||R.intersect(L,R.slicePlaneEnabled?K:null,L.rayBegin,L.rayEnd,O)});break;case "on-the-ground":case "relative-to-ground":this._externalIntersectionHandlers.forAll(R=>{R.isGround&&R.intersect(L,R.slicePlaneEnabled?K:null,L.rayBegin,L.rayEnd,O)})}return L.results.min.getIntersectionPoint(A)?(I=l.computeMapPointFromVec3d(I,A),I.z=G,I):null}computeIntersection(E,F,G,D){if(null!=E){var I=this._view.state.camera,
J=n.castRenderScreenPointArray3(d.sv3d.get());I.projectToRenderScreen(E.origin,J);var N=new z(G,this._forEachLayer);F.options.selectOpaqueTerrainOnly=!G||!("include"in G||"exclude"in G);var M=E.origin,Q=p.add(d.sv3d.get(),E.origin,E.direction);F.reset(M,Q,I);F.intersect(N.layers,J,this._tolerance);E=this._view.slicePlane;var O=null!=E?t.sliceFilterPredicate(E):null;F.intersect(N.sliceableLayers,J,this._tolerance,O);var K=G&&(G.requiresGroundFeedback||G.enableDraped);this._externalIntersectionHandlers.forAll(L=>
{var P=L.layerUid;const R=Array.isArray(P);P=R?P:[P];R&&(F.options.filteredLayerUids=[]);let W=!1;for(const V of P)N.filterLayerUid(V)?W=!0:R&&F.options.filteredLayerUids.push(V);F.options.isFiltered=!W;(L.isGround&&K||!F.options.isFiltered)&&L.intersect(F,L.slicePlaneEnabled?O:null,M,Q,J,D)});E=d.sv3d.get();I=this._view.basemapTerrain;if(G&&G.enableDraped&&null!=I.spatialReference&&F.results.ground.getIntersectionPoint(E)){G=I.overlayManager.renderer;const L=this._view.renderCoordsHelper.spatialReference,
P=d.sv3d.get();this._view.renderCoordsHelper.fromRenderCoords(E,P,I.spatialReference);P[2]=this._view.elevationProvider?.getElevation(E[0],E[1],E[2],L,"ground")??0;G.intersect(F,P,F.results.ground,R=>N.filterRenderGeometry(R))}F.sortResults();this._processHUDResults(F)}}_processHUDResults(E){var F=E.results.hud;e.copy(this._tmpRegion,e.negativeInfinity);const G=this._view.state.camera,D=[],I=this._tmpRegion;var J=L=>{const P=new y(L),R=P.result.target.object.geometries.every(W=>W.material instanceof
m.HUDMaterial&&W.material.parameters.occlusionTest);D.push({item:P,occlusionTest:R});R&&(G.projectToRenderScreen(L.target.center,P.screenPoint),P.screenPoint[0]=Math.floor(P.screenPoint[0]),P.screenPoint[1]=Math.floor(P.screenPoint[1]),e.expandPointInPlace(I,P.screenPoint))};E.sortResults(F.all);null!=F.min.dist&&J(F.min);for(var N of F.all)F.min.target.object!==N.target.object&&F.max.target.object!==N.target.object&&J(N);null!=F.max.dist&&F.max.target.object!==F.min.target.object&&J(F.max);if(D.length){I[0]===
I[2]&&(I[2]+=1);I[1]===I[3]&&(I[3]+=1);F=G.fullWidth;J=G.fullHeight;var M=Math.max(0,I[0]-1),Q=Math.max(0,I[1]-1);N=Math.min(e.width(I)+2,F-M);var O=Math.min(e.height(I)+2,J-Q),K=0<N&&0<O?new Uint8Array(N*O*4):null;K&&this._view._stage.renderer.readHUDVisibility(M,Q,N,O,K);M=!0;Q=null==E.results.max.dist;O=0;for(const {item:L,occlusionTest:P}of D){let R=!P;if(P&&K)for(const W of v){const V=4*(Math.min(L.screenPoint[0]+W[0],F)-I[0]+(Math.min(L.screenPoint[1]+W[1],J)-I[1])*N);if(0<=V&&V<K.length&&K[V]){R=
!0;break}}R&&(M&&(E.results.min.copy(L.result),M=!1),Q&&E.results.max.copy(L.result),E.options.store===u.StoreResults.ALL&&E.results.all.splice(O++,0,L.result))}}}}const v=(()=>{const E=[];for(let F=-1;1>=F;F++)for(let G=-1;1>=G;G++)E.push([G+1,F+1]);return E})();class y{constructor(E){this.result=E;this.screenPoint=n.createRenderScreenPointArray3()}}let B;class z{constructor(E,F){this.layers=[];this.sliceableLayers=[];this.include=E?.include;this.exclude=E?.exclude;F(G=>{G.pickable&&this.filterLayerUid(G.apiLayerUid)&&
(G.sliceable?this.sliceableLayers:this.layers).push(G)})}filterLayerUid(E){const {include:F,exclude:G}=this;return null==E?null==F&&null==G:(null==F||F.has(E))&&(null==G||!G.has(E))}filterRenderGeometry(E){return this.filterLayerUid(E.layerUid)}}const A=h.create(),C=h.create(),H=n.createRenderScreenPointArray3();a.SceneIntersectionHelper=r;a.isIntersectionHandler=function(E){return"object"===typeof E&&"intersect"in E};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/support/elevationInfoUtils":function(){define(["exports",
"../core/unitUtils","../symbols/support/unitConversionUtils"],function(a,b,n){function k(m,q){return q?.mode?q.mode:(m?u:t).mode}function p(m,q){return null!=q?q:m?u:t}function h(m,q){return k(null==m?!0:m.hasZ??!1,q)}function e(m){const q=f(m);m=h(m.geometry,q);const r=null!=q&&"on-the-ground"!==m?x(q):0;return{mode:m,offset:r,featureExpressionInfo:q?.featureExpressionInfo}}function g(m){return"0"===m?.featureExpressionInfo?.expression}function d(m){if(!m||"on-the-ground"===m.mode)return!1;m=m?.featureExpressionInfo?
m.featureExpressionInfo.expression:null;return!(!m||"0"===m)}function f(m){return m.layer&&"elevationInfo"in m.layer?m.layer.elevationInfo:null}function c(m,q){if(!m?.offset)return 0;const {offset:r,unit:v}=m;if("decimal-degrees"===v)return 0;m="unknown"!==v&&v?v:"meters";return(q=b.verticalLengthUnitFromSpatialReference(q))?b.convertUnit(r,m,q):0}function l(m,q,r,v,y,B,z=null){if(null!=B){var A=null!=z?z.mode:"absolute-height";if("on-the-ground"===A)return 0;({absoluteZ:B}=w(q,r,v,y,m,B));a:{z=c(z,
y);switch(A){case "absolute-height":m=B-z;break a;case "relative-to-ground":m=B-((m.elevationProvider.getElevation(q,r,v,y,"ground")??0)+z);break a;case "relative-to-scene":m=B-((m.elevationProvider.getElevation(q,r,v,y,"scene")??0)+z);break a}m=void 0}return m}}function w(m,q,r,v,y,B){const z=c(B,v);switch(B.mode){case "absolute-height":return{absoluteZ:r+z,elevation:0};case "on-the-ground":return r=y.elevationProvider.getElevation(m,q,0,v,"ground")??0,{absoluteZ:r,elevation:r};case "relative-to-ground":return m=
y.elevationProvider.getElevation(m,q,r,v,"ground")??0,{absoluteZ:r+m+z,elevation:m};case "relative-to-scene":return m=y.elevationProvider.getElevation(m,q,r,v,"scene")??0,{absoluteZ:r+m+z,elevation:m}}}function x(m){return(m?.offset??0)*n.getMetersPerUnit(m?.unit)}const u={mode:"absolute-height",offset:0},t={mode:"on-the-ground",offset:null};a.absoluteHeightElevationInfo=u;a.elevationContextAffectsAlignment=function(m,q){if(null==q)return!1;({mode:q}=q);return null!=q&&("scene"===m&&"relative-to-scene"===
q||"ground"===m&&"absolute-height"!==q)};a.elevationModeRequiredMessage=function(m,q,r){return r&&r.mode!==q?`${m} only support ${q} elevation mode`:null};a.elevationModeUnsupportedMessage=function(m,q,r){return r?.mode===q?`${m} do not support ${q} elevation mode`:null};a.featureExpressionInfoIsZero=g;a.featureExpressionUnsupportedMessage=function(m,q){return null!=q?.featureExpressionInfo&&"0"!==q.featureExpressionInfo.expression?`${m} do not support featureExpressionInfo`:null};a.getConvertedElevation=
function(m,q,r,v=null){return l(m,q.x,q.y,q.hasZ?q.z:0,q.spatialReference,r,v)};a.getConvertedElevationFromVector=function(m,q,r,v,y=null){return l(m,q[0],q[1],2<q.length?q[2]:0,r,v,y)};a.getConvertedElevationFromXYZ=l;a.getEffectiveElevationInfo=p;a.getEffectiveElevationMode=k;a.getElevationOffset=c;a.getElevationOffsetInMeters=x;a.getGeometryEffectiveElevationInfo=function(m,q){return p(null==m?!0:m.hasZ??!1,q)};a.getGeometryEffectiveElevationMode=h;a.getGraphicEffectiveElevationInfo=e;a.getGraphicEffectiveElevationMode=
function(m){const q=f(m);return h(m.geometry,q)};a.getZForElevationMode=function(m,q,r){if(r?.mode){var v=m.hasZ?m.z:0,y=c(r,m.spatialReference);switch(r.mode){case "absolute-height":return v-y;case "on-the-ground":return 0;case "relative-to-ground":return m=(q.elevationProvider.getElevation(m.x,m.y,v,m.spatialReference,"ground")??0)+y,v-m;case "relative-to-scene":return m=(q.elevationProvider.getElevation(m.x,m.y,v,m.spatialReference,"scene")??0)+y,v-m}}};a.hasEffectiveFeatureExpressionInfo=d;a.hasFeatureExpressionInfo=
function(m){return d(m)||g(m)};a.hasGraphicFeatureExpressionInfo=function(m){return d(e(m))};a.logInvalidElevationInfoWarning=function(m,q){q&&m.warn(".elevationInfo\x3d",q)};a.onTheGroundElevationInfo=t;a.zValueInAbsoluteHeightMode=w;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/hitTest":function(){define("exports ../../../geometry ../../../Graphic ../../../core/iteratorUtils ../../../core/screenUtils ../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../geometry/projection/projectVectorToVector ../../../layers/LayerConstants ../../../layers/support/layerUtils ./debugFlags ./ElevationProvider ../webgl-engine/lib/Intersector ../webgl-engine/lib/IntersectorInterfaces ../webgl-engine/lib/intersectorUtils ../webgl-engine/lib/intersectorUtilsConversions ../webgl-engine/lib/verticalOffsetUtils ../../../geometry/SpatialReference ../../../geometry/Point".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w,x,u,t,m,q){function r(G,D,I){return D.getIntersectionPoint(E)?(I=z(G,E,I),D.intersector===w.IntersectorType.TERRAIN&&G.basemapTerrain&&(I.z=c.getElevationAtPoint(G.basemapTerrain,I)??0),I):null}function v(G){var D=G.sourceLayer,I=G.layer;if(D=D&&"objectIdField"in D?D:I&&"objectIdField"in I?I:D)if(I=D.objectIdField??g.fallbackObjectIDAttribute,I=G.attributes?.[I])return`o-${D.id}-${I}`;return`u-${G.uid}`}function y(G,D){D=v(D);return B(G,D)}function B(G,D){return null==
G||(null==G.include||G.include.has(D))&&(null==G.exclude||!G.exclude.has(D))}function z(G,D,I){let J=G.spatialReference||m.WGS84;e.projectVectorToVector(D,G.renderSpatialReference,E,J)?D=E:(J=m.WGS84,e.projectVectorToVector(D,G.renderSpatialReference,E,J)&&(D=E));I?(I.x=D[0],I.y=D[1],I.z=D[2],I.spatialReference=J):I=new q(D,J);return I}function A(G,D){const I=C(G,D.include,F.INCLUDE);G=C(G,D.exclude,F.EXCLUDE);return{include:I.layerUids,exclude:G.layerUids,graphics:{include:I.graphicUids,exclude:G.graphicUids},
mediaElements:{include:I.mediaElements,exclude:G.mediaElements}}}function C(G,D,I,J={layerUids:void 0,graphicUids:void 0,mediaElements:void 0}){if(!D)return J;if(D instanceof n){var N=v(D);J.graphicUids||(J.graphicUids=new Set);J.graphicUids.add(N);I===F.INCLUDE&&(null!=G.graphicsView&&D.layer===G?H(J,G.graphicsView.processor.layer.id):D.layer&&H(J,D.layer.uid))}else if("layer"in D&&"element"in D)G=D.element,J.mediaElements||(J.mediaElements=new Set),J.mediaElements.add(G),I===F.INCLUDE&&H(J,D.layer.uid);
else if(k.isIterable(D))for(N of D)N===G.graphics&&null!=G.graphicsView?H(J,G.graphicsView.processor.layer.id):N===G.map.ground?H(J,t.terrainId):C(G,N,I,J);else"uid"in D&&H(J,D.uid);return J}function H(G,D){G.layerUids||(G.layerUids=new Set);G.layerUids.add(D)}const E=h.create();var F;(function(G){G[G.INCLUDE=0]="INCLUDE";G[G.EXCLUDE=1]="EXCLUDE"})(F||={});a.computeMapPointFromVec3d=z;a.externalToInternalIntersectOptions=A;a.getGraphicFilterUid=v;a.hitTest=async function(G,D,I,J){J=I?A(G,I):J;var N=
p.createScreenPointArray(D.x,D.y);J.requiresGroundFeedback=!0;J.enableDraped=!0;I=l.newIntersector(G.state.viewingMode);I.options.selectionMode=!0;I.options.store=w.StoreResults.ALL;G.sceneIntersectionHelper.intersectIntersectorScreen(N,I,J);N=I.results.all;var M=J.graphics;J=[];let Q=null;for(let P=0;P<N.length;P++){var O=N[P],K=u.toOwner(O,G);if(null!=K&&(K===G.map.ground||"type"in K&&d.isIntegratedMeshLayer(K.type)))break;K=u.toHit(O,G);if(null!=K){if("graphic"===K.type){null==Q&&P!==N.length-
1&&(Q=new Set);if(null!=Q){var L=v(K.graphic);if(Q.has(L))continue;Q.add(L)}if(!y(M,K.graphic))continue}L=r(G,O);O=O.distanceInRenderSpace;if("media"===K.type){const R=K.element.toSource(L);J.push({...K,mapPoint:L,distance:O,sourcePoint:R})}else J.push({...K,mapPoint:L,distance:O})}}N=I.results.ground;M=u.toOwner(N,G);M=null!=M&&"type"in M&&d.isIntegratedMeshLayer(M.type)?M:null;G={screenPoint:D,results:J,ground:{mapPoint:r(G,N),distance:x.isValidIntersectorResult(N)?N.distanceInRenderSpace:0,layer:M}};
f.debugFlags.SCENEVIEW_HITTEST_RETURN_INTERSECTOR&&(G.intersector=I);return G};a.intersectResultToMapPoint=r;a.toMap=function(G,D,I,J){J=I?A(G,I):J;const N=!(!J.graphics?.include&&!J.graphics?.exclude),M=!(!J.mediaElements?.include&&!J.mediaElements?.exclude);D=p.screenPointObjectToArray(D);J.enableDraped=J.include&&!J.include.has(t.terrainId)||J.exclude?.has(t.terrainId);const Q=G.sceneIntersectionHelper,O=l.newIntersector(G.state.viewingMode);O.options.selectionMode=!0;O.options.store=N||M?w.StoreResults.ALL:
w.StoreResults.MIN;O.options.excludeLabels=I?.excludeLabels??!1;Q.intersectIntersectorScreen(D,O,J);if(N||M){for(const K of O.results.all)if(I=u.toHit(K,G),null==I||N&&("graphic"!==I.type||y(J.graphics,I.graphic))||M&&("media"!==I.type||B(J.mediaElements,I.element)))return r(G,K);return null}return r(G,O.results.min)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/LayerConstants":function(){define(["exports"],function(a){a.fallbackObjectIDAttribute="OBJECTID";Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/intersectorUtilsConversions":function(){define("exports ../../../../core/libs/gl-matrix-2/math/mat4 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../geometry/support/aaBoundingBox ../../../../chunks/sphere ../../layers/i3s/Intersector ../../terrain/Intersector ./intersectorUtils ./lodRendering/Intersector".split(" "),function(a,b,n,k,p,h,e,g,d){function f(m,q){return null==m?null:g.isObjectIntersectorResult(m)||
g.isHudIntersectorResult(m)?c(m.target?.object,q):h.isPclIntersectorResult(m)?(m=m.target.createGraphic(),{type:"graphic",graphic:m,layer:m.layer}):h.isVoxelIntersectorResult(m)?(m=m.target.createVoxelGraphic(),{type:"graphic",graphic:m,layer:m.layer}):h.isTiles3DIntersectorResult(m)?(m=m.target.createTiles3DGraphic(),{type:"graphic",graphic:m,layer:m.layer}):e.isOverlayIntersectorResult(m)||d.isLodIntersectorResult(m)?c(m.target,q):h.isI3sIntersectorResult(m)?l(m.target,q):null}function c(m,q){if(null==
m?.graphicUid)return null;const r=u(m,q);if(null==r)return null;if(r===q.graphics)return null==q.graphicsView||"number"!==typeof m.graphicUid?null:q.graphicsView.getHit(m.graphicUid);q=q.allLayerViews.find(v=>v.layer===r);return!q||q.suspended||null==m.graphicUid?null:"getHit"in q?q.getHit(m.graphicUid):null}function l(m,q){const r=u(m,q);return null==r?null:(q=q.allLayerViews.find(v=>v.layer===r))&&!q.suspended&&"getGraphicFromIntersectorTarget"in q?x(q.getGraphicFromIntersectorTarget(m)):null}function w(m,
q){const r=u(m,q);return null==r?null:(q=q.allLayerViews.find(v=>v.layer===r))&&!q.suspended&&"getAABBFromIntersectorTarget"in q?q.getAABBFromIntersectorTarget(m):null}function x(m){return null!=m?{type:"graphic",graphic:m,layer:m.layer}:null}function u(m,q){return null==m?.layerUid?null:null!=q.graphicsView&&m.layerUid===q.graphicsView.processor.layer.id?q.graphics:q.map.allLayers.find(r=>r.uid===m.layerUid)}const t=n.create();a.getIntersectedFeatureBSRadius=function(m,q){return g.isObjectIntersectorResult(m)||
g.isHudIntersectorResult(m)?p.getRadius(m.target.object.boundingVolumeWorldSpace.bounds):d.isLodIntersectorResult(m)?(b.getScaling(t,m.transformation),m.target.baseBoundingSphere.radius*Math.max(t[0],t[1],t[2])):h.isI3sIntersectorResult(m)?(m=w(m.target,q))?.5*k.diameter(m):null:null};a.hasLod=function(m){return g.isObjectIntersectorResult(m)||g.isHudIntersectorResult(m)?!1:d.isLodIntersectorResult(m)?1<m.target.numLodLevels:h.isI3sIntersectorResult(m)?!0:!1};a.toGraphic=function(m,q){m=f(m,q);return null!=
m&&"graphic"===m.type?m.graphic:null};a.toHit=f;a.toOwner=function(m,q){return g.isObjectIntersectorResult(m)||g.isHudIntersectorResult(m)?u(m.target?.object,q):e.isTerrainIntersectorResult(m)?q.map?.ground:h.isPclIntersectorResult(m)||h.isI3sIntersectorResult(m)||e.isOverlayIntersectorResult(m)||h.isVoxelIntersectorResult(m)?u(m.target,q):null};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/Intersector":function(){define(["exports","../../webgl-engine/lib/IntersectorInterfaces",
"../../webgl-engine/lib/IntersectorTarget","../../webgl-engine/lib/intersectorUtils"],function(a,b,n,k){class p extends n.Graphic3DTarget{constructor(d,f,c,l){super(f,c);this.point=d;this.createGraphic=l}}class h extends n.LayerTarget{constructor(d,f,c,l,w){super(d);this.layerUid=d;this.sublayerUid=f;this.nodeIndex=c;this.componentIndex=l;this.triangleNr=w}}class e extends n.Graphic3DTarget{constructor(d,f,c){super(f,null);this.point=d;this.createVoxelGraphic=c}}class g extends n.Graphic3DTarget{constructor(d,
f){super(d,null);this.createTiles3DGraphic=f}}a.I3sTarget=h;a.PclTarget=p;a.Tiles3DTarget=g;a.VoxelTarget=e;a.isI3sIntersectorResult=function(d){return k.isValidIntersectorResult(d)&&d.intersector===b.IntersectorType.I3S&&!!d.target};a.isPclIntersectorResult=function(d){return k.isValidIntersectorResult(d)&&d.intersector===b.IntersectorType.PCL&&!!d.target};a.isTiles3DIntersectorResult=function(d){return k.isValidIntersectorResult(d)&&d.intersector===b.IntersectorType.TILES3D&&!!d.target};a.isVoxelIntersectorResult=
function(d){return k.isValidIntersectorResult(d)&&d.intersector===b.IntersectorType.VOXEL&&!!d.target};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/Intersector":function(){define(["exports","../webgl-engine/lib/IntersectorInterfaces","../webgl-engine/lib/IntersectorTarget","../webgl-engine/lib/intersectorUtils"],function(a,b,n,k){class p extends n.Graphic3DTarget{constructor(h,e,g){super(h,e);this.triangleNr=g}}a.OverlayTarget=p;a.isOverlayIntersectorResult=
function(h){return k.isValidIntersectorResult(h)&&h.intersector===b.IntersectorType.OVERLAY&&!!h.target};a.isTerrainIntersectorResult=function(h){return k.isValidIntersectorResult(h)&&h.intersector===b.IntersectorType.TERRAIN&&!!h.target};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/CombinedElevationProvider":function(){define("exports ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/Evented ../../../core/maybe ../../../core/promiseUtils ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ../../../geometry/SpatialReference ../../../geometry/support/spatialReferenceUtils ../layers/graphics/ElevationQuery ./ElevationRange".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w,x,u){function t(m,q,r,v,y,B,z){for(const A of q)q=A.getElevation(r,v,y,B,z),null!=q&&(m=null!=m?Math.max(q,m):q);return m}a.CombinedElevationProvider=class extends k.EventedMixin(n){get spatialReference(){return this.view?.basemapTerrain?.spatialReference}constructor(m){super(m);this._im=[];this._ground=[];this._scene=[];this.lastElevationQuery=null;this._cacheEnabled=!1}destroy(){this._cachedQuery=p.destroyMaybe(this._cachedQuery)}enableCache(m){m||(this.lastElevationQuery=
null);this._cacheEnabled=m}getElevation(m,q,r,v,y){if(this._cacheEnabled&&null!=this.lastElevationQuery){var B=this.lastElevationQuery;if(m===B.x&&q===B.y&&r===B.z&&w.equals(v,B.spatialReference)&&y===B.queryContext)return B.result}B=t(null,this._im,m,q,r,v,y);null==B&&(B=t(B,this._ground,m,q,r,v,y));"scene"===y&&(B=t(B,this._scene,m,q,r,v,y));this._cacheEnabled&&(this.lastElevationQuery={x:m,y:q,z:r,spatialReference:v,queryContext:y,result:B});return B}getSphereElevationBounds(m,q,r){function v(B){for(const z of B)z.getSphereElevationBounds&&
(B=z.getSphereElevationBounds(m,q,r),null!=B&&y.expandElevationRangeValues(B.elevationRangeMin,B.elevationRangeMax))}const y=new u.ElevationRange;v(this._ground);v(this._im);"scene"===r&&v(this._scene);return y}getRootElevationBounds(){const m=new u.ElevationRange;for(const q of[this._im,this._ground,this._scene])q.forEach(r=>{r.getRootElevationBounds&&(r=r.getRootElevationBounds(),null!=r&&m.expandElevationRangeValues(r.elevationRangeMin,r.elevationRangeMax))});return m}async queryElevation(m,q,
r,v,y,B=null,z=0){const A=this._getElevationQuery(v);try{const C=await A.queryElevation(m,q,B,z);return"scene"===y?t(C,this._scene,m,q,r,v,y):C}catch(C){return h.throwIfAbortError(C),this.getElevation(m,q,r,v,y)}}register(m,q){this.addHandles(q.on("elevation-change",r=>this.emit("elevation-change",r)),q);this._providersFromContext(m).push(q)}unregister(m){this.removeHandles(m);for(const q of[this._im,this._ground,this._scene]){const r=q.indexOf(m);-1<r&&q.splice(r,1)}}_providersFromContext(m){switch(m){case "ground":return this._ground;
case "im":return this._im;case "scene":return this._scene}}_getElevationQuery(m=this.view.spatialReference){const q=this._cachedQuery;if(null!=q&&w.equals(m,q.spatialReference))return q;q?.destroy({completeTasks:!0});const {wkid:r,wkt:v,wkt2:y,latestWkid:B}=m;return this._cachedQuery=m=new x.ElevationQuery(this.view.resourceController.scheduler,new l({wkid:r,wkt:v,wkt2:y,latestWkid:B}),()=>this.view.map?.ground,{maximumAutoTileRequests:4})}};b.__decorate([e.property({constructOnly:!0})],a.CombinedElevationProvider.prototype,
"view",void 0);b.__decorate([e.property()],a.CombinedElevationProvider.prototype,"spatialReference",null);a.CombinedElevationProvider=b.__decorate([c.subclass("esri.views.3d.support.CombinedElevationProvider")],a.CombinedElevationProvider);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/ElevationQuery":function(){define("exports ../../../../geometry ../../../../core/arrayUtils ../../../../core/has ../../../../core/promiseUtils ../../../support/Scheduler ../../../../geometry/Multipoint".split(" "),
function(a,b,n,k,p,h,e){class g{constructor(f,c){this.spatialReference=f;this._view=c}getElevation(f,c,l){return this._view.elevationProvider.getElevation(f,c,0,this.spatialReference,l)}async queryElevation(f,c,l,w,x){return this._view.elevationProvider.queryElevation(f,c,0,this.spatialReference,x,l,w)}}class d{constructor(f,c,l,w){this.spatialReference=c;this._getElevationQueryProvider=l;this._queries=[];this._queryOptions={...w,ignoreInvisibleLayers:!0};this._frameTask=f.registerTask(h.TaskPriority.ELEVATION_QUERY,
this)}destroy({completeTasks:f}={completeTasks:!1}){this._frameTask.remove();if(this.running)if(f)this.runTask(h.noBudget);else for(const c of this._queries)c.result.reject(p.createAbortError())}queryElevation(f,c,l,w=0){const x=p.createResolver(),u={x:f,y:c,minDemResolution:w,result:x,signal:l};this._queries.push(u);p.onAbort(l,()=>{n.remove(this._queries,u);x.reject(p.createAbortError())});return x.promise}get running(){return 0<this._queries.length}runTask(f){const c=this._queries;this._queries=
[];const l=this._getElevationQueryProvider();if(l){var w=c.map(m=>[m.x,m.y]),x=c.reduce((m,q)=>Math.min(m,q.minDemResolution),Infinity);w=new e({points:w,spatialReference:this.spatialReference});var u=1<c.length&&c.some(m=>!!m.signal)?new AbortController:null,t=null!=u?u.signal:c[0].signal;if(null!=u){let m=0;c.forEach(q=>p.onAbort(q.signal,()=>{m++;q.result.reject(p.createAbortError());m===c.length&&u.abort()}))}l.queryElevation(w,{...this._queryOptions,minDemResolution:x,signal:t}).then(m=>{c.forEach((q,
r)=>{null!=q.signal&&q.signal.aborted?q.result.reject(p.createAbortError()):q.result.resolve(m.geometry.points[r][2])})}).catch(m=>{c.forEach(q=>q.result.reject(m))})}else c.forEach(m=>m.result.reject());f.madeProgress()}get test(){}}a.ElevationQuery=d;a.ViewElevationProvider=g;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/ElevationRange":function(){define(["exports"],function(a){class b{constructor(n=Infinity,k=-Infinity){this.elevationRangeMin=n;this.elevationRangeMax=
k}get elevationRangeValid(){return!Number.isNaN(this.elevationRangeMin)}invalidateElevationRange(){this.elevationRangeMin=NaN}expandElevationRangeValues(n,k){this.elevationRangeMin=Math.min(this.elevationRangeMin,n);this.elevationRangeMax=Math.max(this.elevationRangeMax,k)}expandElevationRange(n){this.elevationRangeMin=Math.min(this.elevationRangeMin,n.elevationRangeMin);this.elevationRangeMax=Math.max(this.elevationRangeMax,n.elevationRangeMax)}setElevationRange(n){this.elevationRangeMin=n.elevationRangeMin;
this.elevationRangeMax=n.elevationRangeMax}}a.ElevationRange=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/DisplayQualityProfile":function(){define(["../../../core/has","../../../core/time"],function(a,b){function n(){const h=!!a("esri-mobile"),e=!!a("ios"),g=b.Milliseconds(400);return{low:{graphics3D:{maxTotalNumberOfFeatures:25E3,maxNumberOfDrawCalls:8E3,maxTotalNumberOfVertices:255E4,polygonLodFactor:.5,polylineLodFactor:1,snapshotAvailable:!1,skipHighSymbolLods:!0,
uncompressedTextureDownsamplingEnabled:!0},heatmap:{pixelRatio:.125,maxTotalNumberOfFeatures:5E4},sceneService:{object:{lodFactor:.2},point:{lodFactor:1},integratedMesh:{lodFactor:.6},pointCloud:{lodFactor:.5},uncompressedTextureDownsamplingEnabled:!0},tiledSurface:{lodBias:-1,angledSplitBias:.5,vtlContentZoom:.75,elevationLevelDelta:3,reduceTileLevelDifferences:!0},fadeDuration:b.Milliseconds(0),antialiasingEnabled:!1,physicalBasedRenderingEnabled:!1,highQualityTransparency:!1,highResolutionAtmosphere:!1,
reflections:!1,ambientOcclusion:!1,memoryLimit:200+p.IPhone12Pro,additionalCacheMemory:0,frameRate:0,maximumPixelRatio:1},medium:{graphics3D:{maxTotalNumberOfFeatures:1E5,maxNumberOfDrawCalls:17E3,maxTotalNumberOfVertices:625E4,polygonLodFactor:h?.8:1,polylineLodFactor:h?1.2:1.5,snapshotAvailable:!e,skipHighSymbolLods:!1,uncompressedTextureDownsamplingEnabled:h},heatmap:{pixelRatio:.25,maxTotalNumberOfFeatures:13E4},sceneService:{object:{lodFactor:1},point:{lodFactor:1},integratedMesh:{lodFactor:1},
pointCloud:{lodFactor:1},uncompressedTextureDownsamplingEnabled:h},tiledSurface:{lodBias:0,angledSplitBias:1,vtlContentZoom:1.5,elevationLevelDelta:3,reduceTileLevelDifferences:!a("disable-feature:reduce-map-tile-levels")},fadeDuration:g,antialiasingEnabled:!1,physicalBasedRenderingEnabled:!0,highQualityTransparency:!0,highResolutionAtmosphere:!1,reflections:!1,ambientOcclusion:!1,memoryLimit:h?600+p.GalaxyS20:750+p.FullHD,additionalCacheMemory:h?-100:150,frameRate:0,maximumPixelRatio:1},high:{graphics3D:{maxTotalNumberOfFeatures:1E5,
maxNumberOfDrawCalls:17E3,maxTotalNumberOfVertices:125E5,polygonLodFactor:h?1.2:2,polylineLodFactor:h?1.2:2,snapshotAvailable:!e,skipHighSymbolLods:!1,uncompressedTextureDownsamplingEnabled:!1},heatmap:{pixelRatio:.5,maxTotalNumberOfFeatures:23E4},sceneService:{object:{lodFactor:1},point:{lodFactor:1},integratedMesh:{lodFactor:1},pointCloud:{lodFactor:1},uncompressedTextureDownsamplingEnabled:!1},tiledSurface:{lodBias:0,angledSplitBias:1,vtlContentZoom:1.5,elevationLevelDelta:2,reduceTileLevelDifferences:!a("disable-feature:reduce-map-tile-levels")},
fadeDuration:g,antialiasingEnabled:!0,physicalBasedRenderingEnabled:!0,highQualityTransparency:!0,highResolutionAtmosphere:!0,reflections:!0,ambientOcclusion:!0,memoryLimit:h?900+p.SurfacePro7:1500+p.FullHDRetina,additionalCacheMemory:h?-150:0,frameRate:0,maximumPixelRatio:h?1:Infinity}}}class k{static isValidProfile(h){return h in k.profiles}static getDefaultProfile(){return a("esri-iPhone")?"low":"medium"}static apply(h,e){h=k.profiles[h];e.graphics3D.maxTotalNumberOfFeatures=h.graphics3D.maxTotalNumberOfFeatures;
e.graphics3D.maxNumberOfDrawCalls=h.graphics3D.maxNumberOfDrawCalls;e.graphics3D.maxTotalNumberOfVertices=h.graphics3D.maxTotalNumberOfVertices;e.graphics3D.polygonLodFactor=h.graphics3D.polygonLodFactor;e.graphics3D.polylineLodFactor=h.graphics3D.polylineLodFactor;e.graphics3D.snapshotAvailable=h.graphics3D.snapshotAvailable;e.graphics3D.skipHighSymbolLods=h.graphics3D.skipHighSymbolLods;e.graphics3D.uncompressedTextureDownsamplingEnabled=h.graphics3D.uncompressedTextureDownsamplingEnabled;e.sceneService.object.lodFactor=
h.sceneService.object.lodFactor;e.sceneService.point.lodFactor=h.sceneService.point.lodFactor;e.sceneService.integratedMesh.lodFactor=h.sceneService.integratedMesh.lodFactor;e.sceneService.pointCloud.lodFactor=h.sceneService.pointCloud.lodFactor;e.sceneService.uncompressedTextureDownsamplingEnabled=h.sceneService.uncompressedTextureDownsamplingEnabled;e.tiledSurface.lodBias=h.tiledSurface.lodBias;e.tiledSurface.angledSplitBias=h.tiledSurface.angledSplitBias;e.tiledSurface.vtlContentZoom=h.tiledSurface.vtlContentZoom;
e.tiledSurface.elevationLevelDelta=h.tiledSurface.elevationLevelDelta;e.tiledSurface.reduceTileLevelDifferences=h.tiledSurface.reduceTileLevelDifferences;e.heatmap.pixelRatio=h.heatmap.pixelRatio;e.heatmap.maxTotalNumberOfFeatures=h.heatmap.maxTotalNumberOfFeatures;e.fadeDuration=h.fadeDuration;e.antialiasingEnabled=h.antialiasingEnabled;e.physicallyBasedRenderingEnabled=h.physicalBasedRenderingEnabled;e.highQualityTransparency=h.highQualityTransparency;e.highResolutionAtmosphere=h.highResolutionAtmosphere;
e.reflections=h.reflections;e.ambientOcclusion=h.ambientOcclusion;e.memoryLimit=h.memoryLimit;e.additionalCacheMemory=h.additionalCacheMemory;e.frameRate=h.frameRate;e.maximumPixelRatio=h.maximumPixelRatio}}k.test={reset(){const h=n();for(const e of Object.keys(h))k.profiles[e]=h[e]}};const p={IPhone12Pro:120,GalaxyS20:200,FullHD:240,SurfacePro7:300,FullHDRetina:430};(k||={}).profiles=n();return k})},"esri/views/3d/support/HighlightGroup":function(){define("exports ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/Collection ../../../core/has ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/decorators/subclass ./HighlightOptions ../../support/HighlightDefaults".split(" "),
function(a,b,n,k,p,h,e,g,d){var f;a.HighlightGroup=f=class extends n{constructor(l){super(l)}clone(){return new f({name:this.name,options:this.options.clone()})}};b.__decorate([h.property({type:String,constructOnly:!0})],a.HighlightGroup.prototype,"name",void 0);b.__decorate([h.property({type:g})],a.HighlightGroup.prototype,"options",void 0);a.HighlightGroup=f=b.__decorate([e.subclass("esri.views.3d.support.HighlightGroup")],a.HighlightGroup);const c=k.ofType(a.HighlightGroup);a.makeDefaultHighlightGroups=
function(){return p("enable-feature:multiple-highlights")?new c([new a.HighlightGroup({name:d.defaultHighlightName,options:new g}),new a.HighlightGroup({name:d.temporaryHighlightName,options:new g({color:d.temporaryHighlightColor})})]):new c([new a.HighlightGroup({name:d.defaultHighlightName,options:new g})])};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/HighlightOptions":function(){define("../../../chunks/tslib.es6 ../../../Color ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ../../support/HighlightDefaults ../../support/HighlightOptions".split(" "),
function(a,b,n,k,p,h,e,g,d){var f;k=f=class extends d{constructor(c){super(c);this.shadowColor=g.defaultShadowColor.clone();this.shadowOpacity=g.defaultShadowOpacity;this.shadowDifference=g.defaultShadowDifference}equals(c){return this===c||super.equals(c)&&this.shadowColor.equals(c.shadowColor)&&this.shadowOpacity===c.shadowOpacity&&this.shadowDifference===c.shadowDifference}clone(){return new f({...this,color:this.color.clone(),haloColor:this.haloColor?.clone(),shadowColor:this.shadowColor.clone()})}};
a.__decorate([n.property({type:b})],k.prototype,"shadowColor",void 0);a.__decorate([n.property()],k.prototype,"shadowOpacity",void 0);a.__decorate([n.property()],k.prototype,"shadowDifference",void 0);return k=f=a.__decorate([e.subclass("esri.views.3d.support.HighlightOptions")],k)})},"esri/views/support/HighlightDefaults":function(){define(["exports","../../Color"],function(a,b){const n=new b("cyan"),k=new b("black");b=new b("yellow");a.defaultColor=n;a.defaultFillOpacity=.25;a.defaultHaloOpacity=
1;a.defaultHighlightName="default";a.defaultOccludedFactor=.25;a.defaultShadowColor=k;a.defaultShadowDifference=.2;a.defaultShadowOpacity=.4;a.maximumHighlights=8;a.temporaryHighlightColor=b;a.temporaryHighlightName="temporary";Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/support/HighlightOptions":function(){define("../../chunks/tslib.es6 ../../Color ../../core/Accessor ../../core/accessorSupport/decorators/property ../../core/has ../../core/Logger ../../core/RandomLCG ../../core/accessorSupport/decorators/subclass ./HighlightDefaults".split(" "),
function(a,b,n,k,p,h,e,g,d){n=class extends n{constructor(f){super(f);this.color=d.defaultColor.clone();this.haloOpacity=d.defaultHaloOpacity;this.fillOpacity=d.defaultFillOpacity}equals(f){return this.color.equals(f.color)&&(this.haloColor||this.color).equals(f.haloColor||f.color)&&this.haloOpacity===f.haloOpacity&&this.fillOpacity===f.fillOpacity}};a.__decorate([k.property({type:b})],n.prototype,"color",void 0);a.__decorate([k.property({type:b})],n.prototype,"haloColor",void 0);a.__decorate([k.property()],
n.prototype,"haloOpacity",void 0);a.__decorate([k.property()],n.prototype,"fillOpacity",void 0);return n=a.__decorate([g.subclass("esri.views.support.HighlightOptions")],n)})},"esri/views/3d/support/popupHitTest":function(){define(["exports","../../../layers/support/layerUtils","../terrain/LayerClass","../../support/hitTestSelectUtils"],function(a,b,n,k){function p(g,d){const f=new Set,c=[];var l=g.basemapTerrain.numLayers(n.LayerClass.MAP);for(--l;0<=l;l--){const w=g.basemapTerrain.layerViewByIndex(l,
n.LayerClass.MAP);f.add(w.layer.uid);c.push(w)}g=g.basemapTerrain.overlayManager.renderer.layers;for(const {uid:w}of g)if(g=d.get(w))f.add(w),c.push(g);c.reverse();return{layerUids:f,layerViews:c}}function h(g){const d=new Map;for(const f of g.allLayerViews)d.set(f.layer.uid,f);return d}const e={layerUids:new Set,layerViews:[]};a.popupHitTest=async function(g,d){const {results:f,ground:c}=await k.hitTestSelectSimilarDistance(g,d),l=(!c.layer||!b.isIntegratedMeshLayer(c.layer.type))&&c.mapPoint,w=
[];d=h(g);const x=l?p(g,d):e;let u=0,t=0;const m=()=>{const r=x.layerViews[t];l&&r&&"fetchPopupFeaturesAtLocation"in r&&w.push({mapPoint:c.mapPoint,layerView:r});++t};let q=null;for(;u<f.length||t<x.layerViews.length;){const r=f[u];if(r&&"graphic"!==r.type)++u;else if("scene"===r?.layer?.type&&r?.layer?.parent===g?.map?.basemap)++u;else if(r){const v=x.layerUids.has(r.layer?.uid)&&r.distance===c.distance,y=d.get(r.layer?.uid);q??=r.mapPoint;t<x.layerViews.length&&(v||(r.distance??0)>c.distance)&&
x.layerViews[t]!==y?m():(w.push({graphic:r.graphic,layerView:y}),++u)}else m()}q??=c.mapPoint;return{hits:w,location:q}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/LayerClass":function(){define(["exports"],function(a){a.LayerClass=void 0;var b=a.LayerClass||(a.LayerClass={});b[b.ELEVATION=0]="ELEVATION";b[b.MAP=1]="MAP";a.LayerClasses=[a.LayerClass.ELEVATION,a.LayerClass.MAP];Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/support/hitTestSelectUtils":function(){define(["exports"],
function(a){function b(n){return"graphic"===n?.type}a.filterGraphicHits=function(n){return n.filter(b)};a.findFirstGraphicHit=function(n){return n.find(b)??null};a.hitTestSelectSimilarDistance=async function(n,k){if("2d"===n.type)return n.hitTest(k);n=await n.hitTest(k);if(0===n.results.length)return n;k=n.results[0];const p=1.05*(k.distance??0),h=n.results.findIndex(e=>(e.distance??0)>p);-1!==h&&(n.results=n.results.slice(0,h));k&&n.ground.distance>p&&(n.ground.mapPoint=null);return n};Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/QualitySettings":function(){define("../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/time ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass".split(" "),function(a,b,n,k,p,h,e,g){let d=class extends b{constructor(){super(...arguments);this.minTotalNumberOfFeatures=2E3;this.maxTotalNumberOfFeatures=5E4;this.maxNumberOfDrawCalls=
17E3;this.maxTotalNumberOfVertices=17E5;this.snapshotAvailable=!0;this.polylineLodFactor=this.polygonLodFactor=1;this.uncompressedTextureDownsamplingEnabled=this.skipHighSymbolLods=!1}};a.__decorate([k.property()],d.prototype,"minTotalNumberOfFeatures",void 0);a.__decorate([k.property()],d.prototype,"maxTotalNumberOfFeatures",void 0);a.__decorate([k.property()],d.prototype,"maxNumberOfDrawCalls",void 0);a.__decorate([k.property()],d.prototype,"maxTotalNumberOfVertices",void 0);a.__decorate([k.property()],
d.prototype,"snapshotAvailable",void 0);a.__decorate([k.property()],d.prototype,"polygonLodFactor",void 0);a.__decorate([k.property()],d.prototype,"polylineLodFactor",void 0);a.__decorate([k.property()],d.prototype,"skipHighSymbolLods",void 0);a.__decorate([k.property()],d.prototype,"uncompressedTextureDownsamplingEnabled",void 0);d=a.__decorate([g.subclass("esri.views.3d.support.QualitySettings.Graphics3DSettings")],d);let f=class extends b{constructor(){super(...arguments);this.lodFactor=1}};a.__decorate([k.property()],
f.prototype,"lodFactor",void 0);f=a.__decorate([g.subclass("esri.views.3d.support.QualitySettings.LoDFactorSettings")],f);let c=class extends b{constructor(){super(...arguments);this.object=new f;this.point=new f;this.integratedMesh=new f;this.pointCloud=new f;this.uncompressedTextureDownsamplingEnabled=!1}};a.__decorate([k.property({type:f})],c.prototype,"object",void 0);a.__decorate([k.property({type:f})],c.prototype,"point",void 0);a.__decorate([k.property({type:f})],c.prototype,"integratedMesh",
void 0);a.__decorate([k.property({type:f})],c.prototype,"pointCloud",void 0);a.__decorate([k.property()],c.prototype,"uncompressedTextureDownsamplingEnabled",void 0);c=a.__decorate([g.subclass("esri.views.3d.support.QualitySettings.SceneServiceSettings")],c);let l=class extends b{constructor(){super(...arguments);this.lodBias=0;this.vtlContentZoom=this.angledSplitBias=1;this.elevationLevelDelta=3;this.reduceTileLevelDifferences=!0}};a.__decorate([k.property()],l.prototype,"lodBias",void 0);a.__decorate([k.property()],
l.prototype,"angledSplitBias",void 0);a.__decorate([k.property()],l.prototype,"vtlContentZoom",void 0);a.__decorate([k.property()],l.prototype,"elevationLevelDelta",void 0);a.__decorate([k.property()],l.prototype,"reduceTileLevelDifferences",void 0);l=a.__decorate([g.subclass("esri.views.3d.support.QualitySettings.TiledSurfaceSettings")],l);let w=class extends b{constructor(){super(...arguments);this.pixelRatio=1;this.maxTotalNumberOfFeatures=5E4}};a.__decorate([k.property()],w.prototype,"pixelRatio",
void 0);a.__decorate([k.property()],w.prototype,"maxTotalNumberOfFeatures",void 0);w=a.__decorate([g.subclass("esri.views.3d.support.QualitySettings.HeatmapSettings")],w);b=class extends b{constructor(){super(...arguments);this.graphics3D=new d;this.sceneService=new c;this.tiledSurface=new l;this.heatmap=new w;this.fadeDuration=n.Milliseconds(400);this.antialiasingEnabled=!0;this.physicallyBasedRenderingEnabled=!1;this.highQualityTransparency=!0;this.ambientOcclusion=this.reflections=this.highResolutionAtmosphere=
!1;this.memoryLimit=750;this.additionalCacheMemory=0;this.frameRate=void 0;this.maximumPixelRatio=Infinity}};a.__decorate([k.property({type:d})],b.prototype,"graphics3D",void 0);a.__decorate([k.property({type:c})],b.prototype,"sceneService",void 0);a.__decorate([k.property({type:l})],b.prototype,"tiledSurface",void 0);a.__decorate([k.property({type:w})],b.prototype,"heatmap",void 0);a.__decorate([k.property()],b.prototype,"fadeDuration",void 0);a.__decorate([k.property()],b.prototype,"antialiasingEnabled",
void 0);a.__decorate([k.property()],b.prototype,"physicallyBasedRenderingEnabled",void 0);a.__decorate([k.property()],b.prototype,"highQualityTransparency",void 0);a.__decorate([k.property()],b.prototype,"highResolutionAtmosphere",void 0);a.__decorate([k.property()],b.prototype,"reflections",void 0);a.__decorate([k.property()],b.prototype,"ambientOcclusion",void 0);a.__decorate([k.property()],b.prototype,"memoryLimit",void 0);a.__decorate([k.property()],b.prototype,"additionalCacheMemory",void 0);
a.__decorate([k.property()],b.prototype,"frameRate",void 0);a.__decorate([k.property()],b.prototype,"maximumPixelRatio",void 0);return b=a.__decorate([g.subclass("esri.views.3d.support.QualitySettings")],b)})},"esri/views/3d/support/RenderCoordsHelper":function(){define("exports ../../../core/mathUtils ../../../core/unitUtils ../../../core/libs/gl-matrix-2/math/mat4 ../../../chunks/vec32 ../../../geometry/ellipsoidUtils ../../../geometry/spatialReferenceEllipsoidUtils ../../../geometry/projection/projectPointToVector ../../../geometry/projection/projectVectorToPoint ../../../geometry/projection/projectVectorToVector ../../../geometry/support/aaBoundingRect ../../../geometry/support/Axis ../../../geometry/support/coordinateSystem ../../../geometry/support/plane ../../../geometry/support/vector ../../../geometry/support/vectorStacks ../../../layers/graphics/dehydratedFeatureUtils ../../ViewingMode".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w,x,u,t,m,q){class r{constructor(v,y,B,z){this.viewingMode=v;this.spatialReference=y;this.unitInMeters=B;this._coordinateSystem=z;this._tmpCoordinateSystem=w.create(z);this.referenceEllipsoid=h.getReferenceEllipsoid(y);this.sphericalPCPF=e.getSphericalPCPF(y)}set extent(v){v&&w.setExtent(this._coordinateSystem,v,this._coordinateSystem)}get extent(){return w.getExtent(this._coordinateSystem,c.create())}getAltitude(v){return w.altitudeAt(this._coordinateSystem,v)}setAltitude(v,
y,B=v){return w.setAltitudeAt(this._coordinateSystem,B,y,v)}setAltitudeOfTransformation(v,y){w.setAltitudeOfTransformation(this._coordinateSystem,y,v,y)}worldUpAtPosition(v,y){return w.normalAt(this._coordinateSystem,v,y)}worldBasisAtPosition(v,y,B){return w.axisAt(this._coordinateSystem,v,y,B)}basisMatrixAtPosition(v,y){const B=this.worldBasisAtPosition(v,l.Axis.X,t.sv3d.get()),z=this.worldBasisAtPosition(v,l.Axis.Y,t.sv3d.get());v=this.worldBasisAtPosition(v,l.Axis.Z,t.sv3d.get());k.set(y,B[0],
B[1],B[2],0,z[0],z[1],z[2],0,v[0],v[1],v[2],0,0,0,0,1);return y}headingAtPosition(v,y){const B=this.worldUpAtPosition(v,t.sv3d.get());v=this.worldBasisAtPosition(v,l.Axis.Y,t.sv3d.get());y=u.angleAroundAxis(y,v,B);return b.rad2deg(y)}intersectManifoldClosestSilhouette(v,y,B){w.elevate(this._coordinateSystem,y,this._tmpCoordinateSystem);w.intersectRayClosestSilhouette(this._tmpCoordinateSystem,v,B);return B}intersectManifold(v,y,B){w.elevate(this._coordinateSystem,y,this._tmpCoordinateSystem);y=t.sv3d.get();
return w.intersectRay(this._tmpCoordinateSystem,v,y)?p.copy(B,y):null}intersectInfiniteManifold(v,y,B){if(this.viewingMode===q.ViewingMode.Global)return this.intersectManifold(v,y,B);w.elevate(this._coordinateSystem,y,this._tmpCoordinateSystem);y=this._tmpCoordinateSystem.value;const z=t.sv3d.get();return x.intersectRay(y.plane,v,z)?p.copy(B,z):null}toRenderCoords(v,y,B){return m.isDehydratedPoint(v)?g.projectPointToVector(v,y,this.spatialReference):f.projectVectorToVector(v,y,B,this.spatialReference)}fromRenderCoords(v,
y,B=null){return m.isDehydratedPoint(y)?(null!=B&&(y.spatialReference=B),d.projectVectorToPoint(v,this.spatialReference,y)?y:null):f.projectVectorToVector(v,this.spatialReference,y,B)?y:null}static create(v,y){switch(v){case q.ViewingMode.Local:return new r(q.ViewingMode.Local,y,n.getMetersPerUnitForSR(y),w.createLocal());case q.ViewingMode.Global:return new r(q.ViewingMode.Global,y,1,w.createGlobal(y))}}static renderUnitScaleFactor(v,y){return n.getMetersPerCartesianUnitForSR(v)/n.getMetersPerCartesianUnitForSR(y)}}
a.RenderCoordsHelper=r;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/ResourceController":function(){define("exports ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/handleUtils ../../../core/has ../../../core/maybe ../../../core/reactiveUtils ../../../core/scheduling ../../../core/signal ../../../core/time ../../../core/accessorSupport/decorators/property ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ./index ./MemoryController ./StreamDataLoader ../../support/Scheduler".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w,x,u,t,m,q){n=class extends n{constructor(){super(...arguments);this.updating=!1}};b.__decorate([c.property({readOnly:!0})],n.prototype,"updating",void 0);n=b.__decorate([x.subclass("esri.views.3d.support.ResourceController.ResourceControllerMain")],n);let r=class extends n{constructor(){super(...arguments);this._normalTask=this._immediateTask=q.ImmediateTask;this._updatingObjects=d.signal([]);this._frameTask=null}get immediate(){return this._immediateTask}get normal(){return this._normalTask}initialize(){this._scheduler=
q.newScheduler();this._memoryController=t.newMemoryController(this.view);this._streamDataLoader=new m.StreamDataLoader;this._streamDataLoader.setup(u.maxDownloadSlots,u.downloadSlotsPerClient,this._scheduler);this.addHandles([e.watch(()=>this.view.state?.mode,v=>{null!=v&&(this._scheduler.state=v)},e.sync),e.watch(()=>this.view.stationary,()=>this._stationaryChangedHandler())]);this._frameTask=g.addFrameTask({update:v=>this._frame(v)});this._immediateTask=this._scheduler.registerTask(q.TaskPriority.RESOURCE_CONTROLLER_IMMEDIATE);
this._normalTask=this._scheduler.registerTask(q.TaskPriority.RESOURCE_CONTROLLER)}destroy(){this._immediateTask.remove();this._normalTask.remove();this._frameTask=h.removeMaybe(this._frameTask);this._streamDataLoader=h.destroyMaybe(this._streamDataLoader);this._memoryController=h.destroyMaybe(this._memoryController);this._scheduler=h.destroyMaybe(this._scheduler);this.view=null}get updating(){return!!(this._memoryController?.updating||this._streamDataLoader?.updating||this._immediateTask?.updating)||
this._updatingObjects?.value.some(v=>v.updating)}get scheduler(){return this._scheduler}get memoryController(){return this._memoryController}createStreamDataRequester(v){const y=this._streamDataLoader;return{request(B,z,A){return y.request(B,z,v,A)},get busy(){return!y.hasDownloadSlots(v)}}}addUpdatingObject(v){const y=this._updatingObjects;y.value=[...y.value,v];return k.makeHandle(()=>{y.value=y.value.filter(B=>B!==v)})}_frame(v){if(!this.view.suspended){if(this.view.stateManager&&(this.view.stateManager.step(f.secondsFromMilliseconds(v.deltaTime)),
!this._scheduler))return;this._memoryController.update();this._scheduler.updateBudget(v)&&this._scheduler.frame()}}_stationaryChangedHandler(){this.memoryController.resetStableQuality()}get test(){}};b.__decorate([c.property()],r.prototype,"view",void 0);b.__decorate([c.property()],r.prototype,"_scheduler",void 0);b.__decorate([c.property()],r.prototype,"_memoryController",void 0);b.__decorate([c.property()],r.prototype,"_streamDataLoader",void 0);b.__decorate([c.property()],r.prototype,"_immediateTask",
void 0);b.__decorate([c.property()],r.prototype,"_normalTask",void 0);b.__decorate([c.property()],r.prototype,"_updatingObjects",void 0);b.__decorate([c.property({readOnly:!0})],r.prototype,"updating",null);r=b.__decorate([x.subclass("esri.views.3d.support.ResourceController")],r);a.newResourceController=function(v){return new r({view:v})};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/index":function(){define(["exports"],function(a){a.ClientType=void 0;(function(n){n[n.ELEVATION=
0]="ELEVATION";n[n.BASEMAP=1]="BASEMAP";n[n.I3S_INDEX=2]="I3S_INDEX";n[n.I3S_DATA=3]="I3S_DATA";n[n.SYMBOLOGY=4]="SYMBOLOGY"})(a.ClientType||(a.ClientType={}));const b=(()=>{const n=[];n[a.ClientType.ELEVATION]=10;n[a.ClientType.BASEMAP]=10;n[a.ClientType.I3S_INDEX]=10;n[a.ClientType.I3S_DATA]=10;n[a.ClientType.SYMBOLOGY]=5;return n})();a.downloadSlotsPerClient=b;a.maxDownloadSlots=30;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/MemoryController":function(){define("exports ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/has ../../../core/Logger ../../../core/MemCache ../../../core/scheduling ../../../core/accessorSupport/decorators/property ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ./MemoryManagedView".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c){let l=class extends n{constructor(w){super(w);this._quality=1;this._usedMemory=0;this._updating=!1;this._downscaleMemoryUsed=this._stableQuality=0;this._canFastRecover=!1;this._memoryPredicted=0;this._cacheStorage=new h.MemCacheStorage;this._warnMemoryUsage=null;this._numQualityChanges=0;this._maxMemory=750;this._additionalCacheMemory=0;this.addHandles(e.addFrameTask({prepare:()=>this._updateMemory()}))}destroy(){this._cacheStorage.destroy()}get maxMemory(){return this._maxMemory}set maxMemory(w){null==
w||0>=w||(this._stableQuality=0,this._canFastRecover=!1,this._maxMemory<w&&this._updateQuality(1),this._maxMemory=w)}get additionalCacheMemory(){return this._additionalCacheMemory}set additionalCacheMemory(w){null!=w&&(this._additionalCacheMemory=w)}get memoryFactor(){return this._quality}get updating(){return this._updating}get usedMemory(){return this._usedMemory}get usedCacheMemory(){return this._cacheStorage.size}newCache(w,x){return new h.MemCache(w,this._cacheStorage,x)}resetStableQuality(){this._stableQuality=
0}disableMemCache(){this.additionalCacheMemory=-4096}update(){if(!(0>=this._memoryPredicted)||this._updating){var w=this._layersUpdating();if(.6>this._memoryPredicted&&this._canFastRecover)this._stableQuality=this._downscaleMemoryUsed=0,this._canFastRecover=!1,this._updateQuality(1);else if(w){if(1.1<this._memoryPredicted||1<this._usedMemory)0<this._stableQuality?(this._downscaleMemoryUsed=0,this._updateQuality(this._stableQuality)):.1<this._quality&&this._downscaleMemoryUsed<this._usedMemory&&(this._updateQuality(this._quality/
1.3),this._downscaleMemoryUsed=this._usedMemory,this._canFastRecover=!1)}else this._downscaleMemoryUsed=0,1<this._usedMemory?(this._stableQuality=0,this._canFastRecover=!1,w=this._updateQuality(this._quality/1.3),this._downscaleMemoryUsed=this._memoryPredicted):this._stableQuality!==this._quality&&(.75>this._usedMemory&&1>this._quality?(this._stableQuality=this._quality,w=this._updateQuality(this._quality+.05)):1>this._quality&&(this._canFastRecover=!0));this._updating=w}}_updateQuality(w){w=Math.min(Math.max(w,
.1),1);if(w===this._quality)return!1;this._quality=w;++this._numQualityChanges;return!0}_layersUpdating(){return this.view.allLayerViews.some(w=>!!w.updating)}_updateMemory(){if(this.view){this.view._stage?.renderer?.tick();var w=this.view._stage?.renderer?.usedMemory,x=(this.view.basemapTerrain?.usedMemory??0)+(w?w.fbos+w.edges+w.plugins:0),u=0;this.view.allLayerViews&&this.view.allLayerViews.forEach(m=>{if(c.isMemoryManagedView(m)){const q=m.ignoresMemoryFactor?this._quality:1;x+=m.usedMemory*q;
u+=m.unloadedMemory*q}});var t=null==this._warnMemoryUsage||Math.round(10*x)!==Math.round(10*this._warnMemoryUsage);w=1048576*this.maxMemory;if(x>w&&t){this._warnMemoryUsage=x;t=q=>(q/1048576).toLocaleString(void 0,{maximumFractionDigits:1})+" MB";const m=Math.round(100*this._quality);p.getLogger(this).warn(`Memory Limit exceeded! Limit: ${t(w)} Current: ${t(x)} Projected: ${t(x+u)} Quality: ${m}%`)}this._usedMemory=x/w;this._memoryPredicted=(x+u)/w;this._cacheStorage.maxSize=Math.max(0,w-x+1048576*
this.additionalCacheMemory)}}get test(){}};b.__decorate([g.property({constructOnly:!0})],l.prototype,"view",void 0);b.__decorate([g.property()],l.prototype,"maxMemory",null);b.__decorate([g.property()],l.prototype,"additionalCacheMemory",null);b.__decorate([g.property({readOnly:!0})],l.prototype,"memoryFactor",null);b.__decorate([g.property({readOnly:!0})],l.prototype,"updating",null);b.__decorate([g.property({readOnly:!0})],l.prototype,"usedMemory",null);b.__decorate([g.property({readOnly:!0})],
l.prototype,"usedCacheMemory",null);b.__decorate([g.property()],l.prototype,"_quality",void 0);b.__decorate([g.property()],l.prototype,"_usedMemory",void 0);b.__decorate([g.property()],l.prototype,"_updating",void 0);b.__decorate([g.property()],l.prototype,"_stableQuality",void 0);b.__decorate([g.property()],l.prototype,"_maxMemory",void 0);b.__decorate([g.property()],l.prototype,"_additionalCacheMemory",void 0);l=b.__decorate([f.subclass("esri.views.3d.support.MemoryController")],l);a.minQuality=
.1;a.newMemoryController=function(w){return new l({view:w})};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/MemoryManagedView":function(){define(["exports"],function(a){a.isMemoryManagedView=function(b){return"usedMemory"in b&&"unloadedMemory"in b&&"ignoresMemoryFactor"in b};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/StreamDataLoader":function(){define("exports ../../../chunks/tslib.es6 ../../../request ../../../core/Accessor ../../../core/arrayUtils ../../../core/Error ../../../core/has ../../../core/lang ../../../core/maybe ../../../core/promiseUtils ../../../core/accessorSupport/decorators/property ../../../core/Logger ../../../core/accessorSupport/decorators/subclass ./AsyncWorkerQueue ./ImageWithType ../terrain/TerrainData ../webgl-engine/lib/Util ../../support/Scheduler".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w,x,u,t,m,q){function r(B){if(2>B.byteLength)return"unknown";B=new Uint8Array(B,0,B.byteLength);return 137===B[0]&&80===B[1]?"image/png":71===B[0]&&73===B[1]?"image/gif":66===B[0]&&77===B[1]?"image/bmp":255===B[0]&&216===B[1]?"image/jpeg":"unknown"}a.StreamDataLoader=class extends k{constructor(){super(...arguments);this._tasks=new Map;this._onLoadQueue=[];this._doneQueue=[];this.updating=!1}setup(B,z,A){this._loadQueue=new x.AsyncWorkerQueue((C,H)=>this._startLoading(C,
H),(C,H)=>this._doneLoadingCB(C,H),B,z);A&&(this._frameTask=A.registerTask(q.TaskPriority.STREAM_DATA_LOADER,this))}destroy(){this._frameTask=d.removeMaybe(this._frameTask);this._tasks.forEach(B=>d.abortMaybe(B.abortController));this._loadQueue=d.destroyMaybe(this._loadQueue);this._tasks=this._doneQueue=this._onLoadQueue=null}hasDownloadSlots(B){return this._loadQueue.hasQuota(B)}request(B,z,A,C={}){const H=f.createResolver();H.__signal=null!=C?C.signal:null;const E=this._createOrUpdateTask(B,z,A,
C,H);f.onAbort(C,()=>this._cancelRequest(E,H));return H.promise}_createTask(B,z,A,C,H,E){B=new y(B,z,A,C,H);this._updateTask(B,E);this._tasks.set(H,B);1===this._tasks.size&&this._set("updating",!0);this._loadQueue.push(B);return B}_cancelRequest(B,z){p.removeUnordered(B.resolvers,z);z.reject(f.createAbortError());0===B.resolvers.length&&(B.status===a.TaskStatus.DOWNLOADING&&(B.status=a.TaskStatus.CANCELLED,this._loadQueue.cancel(B),B.abortController?.abort(),B.request=null,B.abortController=null),
B.status=a.TaskStatus.CANCELLED,this._tasks.delete(B.key),0===this._tasks.size&&this._set("updating",!1))}_updateTask(B,z){B.resolvers.push(z)}_createOrUpdateTask(B,z,A,C,H){const E=`${C?.uid||B}:${z}:${A}`,F=this._tasks.get(E);return F?(this._updateTask(F,H),F):this._createTask(B,C,z,A,E,H)}_doneLoadingCB(B,z){this._loadQueue&&(m.assert(B.status===a.TaskStatus.DOWNLOADING),B.status=a.TaskStatus.DOWNLOADED,this._frameTask?this._doneQueue.push({task:B,err:z}):this._doneLoading(B,z))}get running(){return 0<
this._doneQueue.length||0<this._onLoadQueue.length}runTask(B){for(;!B.done&&0<this._onLoadQueue.length;){var z=this._onLoadQueue.shift();f.throwIfAborted(z.task.abortController);z.task.abortController=null;z.callback(z.task);B.madeProgress()}for(;!B.done&&0<this._doneQueue.length;)z=this._doneQueue.shift(),z.task.status!==a.TaskStatus.DOWNLOADED&&(z.err=z.err||f.createAbortError()),this._doneLoading(z.task,z.err),B.madeProgress()}_doneLoading(B,z){if(z&&!f.isAbortError(z)&&0<B.numRetries)--B.numRetries,
this._loadQueue.push(B);else{var A=t.isImageWithType(B.result)||B.result instanceof HTMLImageElement?0:B.resolvers.length;for(const C of B.resolvers)if(z)f.isAbortError(z)?C.reject(z):C.reject(new h("stream-data-loader:request-error",`Failed to request resource at '${B.url}'. ${z}`,{url:B.url,error:z}));else{--A;const H=0<A?g.clone(B.result):B.result;C.resolve(H)}this._tasks.delete(B.key);0===this._tasks.size&&this._set("updating",!1)}}_startLoading(B,z){if(B.status===a.TaskStatus.CANCELLED)return!1;
B.startTime=performance.now();B.status=a.TaskStatus.DOWNLOADING;let A,C;switch(B.docType){case "binary":C="array-buffer";A=0;break;case "image":C="image";break;case "image+type":C="array-buffer";break;default:C="json"}B.abortController=new AbortController;const H=B.abortController.signal;B.request=n(B.url,{...B.options,responseType:C,timeout:A,signal:H});const E=G=>{B.duration=performance.now()-B.startTime;B.size=G instanceof ArrayBuffer?G.byteLength:B.size||0;B.result=G;this._frameTask?this._onLoadQueue.push({callback:z,
task:B}):(B.abortController=null,z(B))},F=G=>{B.status===a.TaskStatus.DOWNLOADING&&z(B,G)};if("image+type"!==B.docType)return B.request.then(G=>E(G.data),F),!0;B.request.then(G=>{G=G.data;const D=r(G);C="image";B.size=G.byteLength;if("unknown"===D)B.request=n(B.url,{responseType:C,timeout:A,signal:H}),B.request.then(J=>E(J.data),F);else{G=new Blob([G],{type:D});var I=window.URL.createObjectURL(G);B.request=n(I,{responseType:C,timeout:A,signal:H});B.request.then(J=>E(new u.ImageWithType(J.data,D)),
F).finally(()=>window.URL.revokeObjectURL(I))}},F);return!0}get test(){}};b.__decorate([c.property({readOnly:!0})],a.StreamDataLoader.prototype,"updating",void 0);a.StreamDataLoader=b.__decorate([w.subclass("esri.views.3d.support.StreamDataLoader")],a.StreamDataLoader);const v={numRetries:0};class y extends x.BaseTask{constructor(B,z,A,C,H){super(C);this.url=B;this.options=z;this.docType=A;this.key=H;this.result=null;this.status=a.TaskStatus.QUEUED;this.abortController=this.request=null;this.resolvers=
[];this.startTime=0;this.numRetries=v.numRetries}}a.TaskStatus=void 0;(function(B){B[B.QUEUED=1]="QUEUED";B[B.DOWNLOADING=2]="DOWNLOADING";B[B.DOWNLOADED=3]="DOWNLOADED";B[B.CANCELLED=4]="CANCELLED"})(a.TaskStatus||(a.TaskStatus={}));a.test=v;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/AsyncWorkerQueue":function(){define(["exports","../../../core/has","../webgl-engine/lib/Util"],function(a,b,n){class k{constructor(g){this.client=g;this._cancelled=!1;this.duration=
this.size=0}}class p{constructor(g){this.typeWorkerQuota=g;this.tasks=[];this.numWorkers=0;this.statistics=new h}}class h{constructor(){this.speed=this.duration=this.size=this.requests=0}}class e{constructor(g,d,f,c){this._workerFunc=g;this._callbackFunc=d;this._maxTotalNumWorkers=f;this._totalNumWorkers=0;this._clients=c.map(l=>new p(l))}destroy(){this._clients.length=0}hasQuota(g){return(g=this._clients[g])?this._totalNumWorkers<this._maxTotalNumWorkers||g.numWorkers+g.tasks.length<g.typeWorkerQuota:
!1}push(g){const d=this._clients[g.client];d&&(this._totalNumWorkers<this._maxTotalNumWorkers?(d.numWorkers++,this._totalNumWorkers++,this._workerFunc(g,(f,c)=>this._taskCallback(f,c))):d.tasks.push(g))}cancel(g){this._taskFinished(g);g._cancelled=!0}_taskFinished(g){const d=this._clients[g.client];this._totalNumWorkers--;d&&(d.numWorkers--,d.statistics.requests++,d.statistics.size+=g.size||0,d.statistics.duration+=g.duration||0,d.statistics.speed=0<d.statistics.duration?d.statistics.size/d.statistics.duration:
0,n.assert(0<=d.numWorkers));this._next()}_next(){for(const g of this._clients)if(g&&g.numWorkers<g.typeWorkerQuota&&this._processQueue(g))return;for(const g of this._clients)if(g&&this._processQueue(g))break}_processQueue(g){for(;0<g.tasks.length;)if(this._workerFunc(g.tasks.shift(),(d,f)=>this._taskCallback(d,f)))return g.numWorkers++,this._totalNumWorkers++,!0;return!1}_taskCallback(g,d){g._cancelled||(this._callbackFunc(g,d),this._taskFinished(g))}getStatsForType(g){return(g=this._clients[g])?
{quota:g.typeWorkerQuota,workers:g.numWorkers,queueSize:g.tasks.length,requestStats:g.statistics}:null}get test(){}}a.AsyncWorkerQueue=e;a.BaseTask=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/ImageWithType":function(){define(["exports"],function(a){class b{constructor(n,k){this.element=n;this.type="image+type";this.isOpaque="image/jpeg"===k}}a.ImageWithType=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/TerrainData":function(){define(["exports"],
function(a){a.isImageWithType=function(b){return null!=b&&"type"in b&&"image+type"===b.type};a.isRasterTile=function(b){return null!=b&&"type"in b&&"raster-tile"===b.type};a.isTileTexture=function(b){return null!=b&&"type"in b&&"tile-texture"===b.type};a.isVectorTile=function(b){return null!=b&&"type"in b&&"vector-tile"===b.type};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/SceneViewPerformanceInfo":function(){define(["../../../core/ByteSizeUnit","../layers/support/LayerViewPerformanceInfo",
"./LayerPerformanceInfo"],function(a,b,n){class k{constructor(p){this.usedMemory=this.totalMemory=0;this.quality=1;this.edgesMemory=this.terrainMemory=this.load=0;this.layerPerformanceInfos=[];this.fboMemory=this.cachedMemory=0;if(null!=p.resourceController){const h=p.resourceController.memoryController;this.totalMemory=(h.maxMemory??0)*a.ByteSizeUnit.MEGABYTES;this.usedMemory=Math.round(h.usedMemory*this.totalMemory);this.quality=p.quality;this.load=p.resourceController.scheduler.load;this.cachedMemory=
h.usedCacheMemory}this.terrainMemory=p.basemapTerrain?.usedMemory??0;this.edgesMemory=p._stage?.renderer.usedMemory.edges??0;this.fboMemory=p._stage?.renderer.usedMemory.fbos??0;p.allLayerViews?.items.forEach(h=>{b.isPerformanceInfoLayerView(h)&&this.layerPerformanceInfos.push(new n(h))});this.layerPerformanceInfos.sort((h,e)=>e.memory-h.memory)}}return k})},"esri/views/3d/layers/support/LayerViewPerformanceInfo":function(){define(["exports"],function(a){class b{constructor(n,k=0,p=0,h=0,e=0,g=null){this.usedMemory=
n;this.displayedFeatures=k;this.totalFeatures=p;this.maximumFeatures=h;this.nodes=e;this.core=g}}a.LayerViewPerformanceInfo=b;a.isPerformanceInfoLayerView=function(n){return"performanceInfo"in n};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/LayerPerformanceInfo":function(){define(function(){class a{constructor(b){this.layer=null;this.displayedNumberOfFeatures=this.memory=0;this.totalNumberOfFeatures=this.maximumNumberOfFeatures=null;this.layer=b.layer;b=b.performanceInfo;
this.memory=b.usedMemory;this.displayedNumberOfFeatures=b.displayedFeatures;this.maximumNumberOfFeatures=b.maximumFeatures;this.totalNumberOfFeatures=b.totalFeatures}}return a})},"esri/views/3d/support/SharedSymbolResources":function(){define("exports ../../../core/arrayUtils ../../../core/Handles ../../../core/handleUtils ../../../core/has ../../../core/maybe ../../../core/reactiveUtils ../../../geometry/ellipsoidUtils ../layers/graphics/ObjectResourceCache ./index ./StreamTextureCollection ../webgl-engine/lib/screenSizePerspectiveUtils".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l){class w{constructor(u){this.streamDataRequester=null;this._graphicsOwners=[];this.cimSymbolRasterizer=this._screenSizePerspectiveHandles=null;this._viewState=u.viewState;this._view=u.view;this._pointsOfInterest=u.pointsOfInterest;this.streamDataRequester=u.resourceController.createStreamDataRequester(f.ClientType.SYMBOLOGY);this.objectResourceCache=new d.ObjectResourceCache((m,q)=>u.resourceController.memoryController.newCache(m,q));this.textures=new c.StreamTextureCollection(this.streamDataRequester,
u.view._stage,u.resourceController.scheduler);const t=g.getReferenceEllipsoid(this._view.spatialReference).radius;this.screenSizePerspectiveSettings=l.getSettings(u.viewingMode,t);this.screenSizePerspectiveSettingsLabels=l.getLabelSettings(u.viewingMode,t)}destroy(){this.textures.destroy();this.streamDataRequester=null}addGraphicsOwner(u){if(!u)return k.makeHandle();this._graphicsOwners.push(u);const t=e.watch(()=>u.layer?.screenSizePerspectiveEnabled,()=>this._updateScreenSizePerspectiveEnabled());
this._updateScreenSizePerspectiveEnabled();return k.makeHandle(()=>{t.remove();b.removeUnordered(this._graphicsOwners,u);this._updateScreenSizePerspectiveEnabled()})}_updateScreenSizePerspectiveEnabled(){var u=this._graphicsOwners.some(t=>!0===t.layer?.screenSizePerspectiveEnabled);u&&!this._screenSizePerspectiveHandles?(this._screenSizePerspectiveHandles=new n,u=()=>this._updateScreenSizePerspectiveSettings(),this._screenSizePerspectiveHandles.add([e.watch(()=>this._pointsOfInterest.centerOnSurfaceInfrequent.distance,
u,e.sync),this._viewState.events.on("camera-projection-changed",u)]),this._updateScreenSizePerspectiveSettings()):u||(this._screenSizePerspectiveHandles=h.destroyMaybe(this._screenSizePerspectiveHandles))}_updateScreenSizePerspectiveSettings(){x.distance=this._pointsOfInterest.centerOnSurfaceInfrequent.distance;x.fovY=this._viewState.camera.fovY;this.screenSizePerspectiveSettings.update(x);this.screenSizePerspectiveSettingsLabels.update(x);this._view._stage.renderView.requestRender()}get test(){}}
const x={distance:0,fovY:0};a.SharedSymbolResources=w;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/ObjectResourceCache":function(){define("require exports ../../../../core/maybe ../../../../core/promiseUtils ../../glTF/DefaultLoadingContext ./wosrLoader".split(" "),function(a,b,n,k,p,h){async function e(d,f,c,l,w){k.throwIfAborted(w);const x=k.onAbort(w,()=>{{const t=d.get(c);null!=t&&0<--t.refCount||(d.delete(c),null!=t&&t.abortController.abort())}});
var u=d.get(c);u?u.refCount++:(u=new AbortController,l=l({...w,signal:u.signal}),u={refCount:1,abortController:u,promise:l},d.set(c,u));try{const t=await u.promise;f.put(c,t,t.size);d.delete(c);k.throwIfAborted(w);return t}finally{n.removeMaybe(x)}}class g{constructor(d){this._gltfLoading=new Map;this._wosrLoading=new Map;this._gltfMemCache=d("gltf-resources",()=>{});this._wosrMemCache=d("wosr-resources",()=>{})}destroy(){this._gltfLoading.forEach(d=>d.abortController.abort());this._wosrLoading.forEach(d=>
d.abortController.abort());this._gltfMemCache.destroy();this._wosrMemCache.destroy()}loadGLTF(d,f,c){const l=c?`gltfPBR:${d}`:`gltf:${d}`,w=this._gltfMemCache.get(l);return null!=w?Promise.resolve(w):e(this._gltfLoading,this._gltfMemCache,l,async x=>{const {loadGLTF:u}=await new Promise((t,m)=>a(["../../glTF/loader"],t,m));return u(new p.DefaultLoadingContext(x.streamDataRequester),d,x,c)},f)}loadWOSR(d,f){const c=`wosr:${d}:${f.disableTextures}`,l=this._wosrMemCache.get(c);return null!=l?Promise.resolve(l):
e(this._wosrLoading,this._wosrMemCache,c,w=>h.load(d,w),f)}}b.ObjectResourceCache=g;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/glTF/DefaultLoadingContext":function(){define("exports ../../../request ../../../core/asyncUtils ../../../core/Error ../../../core/promiseUtils ../../../core/urlUtils".split(" "),function(a,b,n,k,p,h){class e{constructor(d){this._streamDataRequester=d}async loadJSON(d,f){return this._load("json",d,f)}async loadBinary(d,f){return h.isDataProtocol(d)?
(p.throwIfAborted(f),h.dataToArrayBuffer(d)):this._load("binary",d,f)}async loadImage(d,f){return this._load("image",d,f)}async _load(d,f,c){if(null==this._streamDataRequester)return(await b(f,{responseType:g[d]})).data;d=await n.result(this._streamDataRequester.request(f,d,c));if(!0===d.ok)return d.value;p.throwIfAbortError(d.error);throw new k("glt-loader-request-error",`Request for resource failed: ${d.error}`);}}const g={image:"image",binary:"array-buffer",json:"json","image+type":void 0};a.DefaultLoadingContext=
e;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/wosrLoader":function(){define("exports ../../../../request ../../../../core/asyncUtils ../../../../core/byteSizeEstimations ../../../../core/Error ../../../../core/Logger ../../../../core/NestedMap ../../../../core/promiseUtils ../../../../core/Version ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/Indices ../../../../support/requestImageUtils ../../webgl-engine/lib/Attribute ../../webgl-engine/lib/basicInterfaces ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/Texture ../../webgl-engine/lib/VertexAttribute ../../webgl-engine/materials/DefaultMaterial ../../../webgl/enums".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w,x,u,t,m,q,r,v){async function y(I,J){const N=J?.streamDataRequester;if(N)return B(I,N,J);I=await n.result(b(I,J));if(!0===I.ok)return I.value.data;g.throwIfAbortError(I.error);z(I.error)}async function B(I,J,N){I=await n.result(J.request(I,"json",N));if(!0===I.ok)return I.value;g.throwIfAbortError(I.error);z(I.error.details.url)}function z(I){throw new p("",`Request for object resource failed: ${I}`);}function A(I){var J=I.params,N=J.topology;let M=!0;J.vertexAttributes||
(G().warn("Geometry must specify vertex attributes"),M=!1);switch(J.topology){case "PerAttributeArray":break;case "Indexed":case null:case void 0:N=J.faces;if(!N)G().warn("Indexed geometries must specify faces"),M=!1;else if(J.vertexAttributes)for(const Q in J.vertexAttributes)J=N[Q],J?.values?(null!=J.valueType&&"UInt32"!==J.valueType&&(G().warn(`Unsupported indexed geometry indices type '${J.valueType}', only UInt32 is currently supported`),M=!1),null!=J.valuesPerElement&&1!==J.valuesPerElement&&
(G().warn(`Unsupported indexed geometry values per element '${J.valuesPerElement}', only 1 is currently supported`),M=!1)):(G().warn(`Indexed geometry does not specify face indices for '${Q}' attribute`),M=!1);break;default:G().warn(`Unsupported topology '${N}'`),M=!1}I.params.material||(G().warn("Geometry requires material"),M=!1);I=I.params.vertexAttributes;for(const Q in I)I[Q].values||(G().warn("Geometries with externally defined attributes are not yet supported"),M=!1);return M}function C(I){const J=
c.empty();I.forEach(N=>{N=N.boundingInfo;null!=N&&(c.expandWithVec3(J,N.bbMin),c.expandWithVec3(J,N.bbMax))});return J}async function H(I,J){const N=[];for(const O in I){var M=I[O],Q=M.images[0].data;if(!Q){G().warn("Externally referenced texture data is not yet supported");continue}Q=M.encoding+";base64,"+Q;const K="/textureDefinitions/"+O,L="rgba"===M.channels?M.alphaChannelUsage||"transparency":"none",P={noUnpackFlip:!0,wrap:{s:v.TextureWrapMode.REPEAT,t:v.TextureWrapMode.REPEAT},preMultiplyAlpha:E(L)!==
u.AlphaDiscardMode.Opaque};M=J?.disableTextures?Promise.resolve(null):w.requestImage(Q,J);N.push(M.then(R=>({refId:K,image:R,parameters:P,alphaChannelUsage:L})))}I=await Promise.all(N);J={};for(const O of I)J[O.refId]=O;return J}function E(I){switch(I){case "mask":return u.AlphaDiscardMode.Mask;case "maskAndTransparency":return u.AlphaDiscardMode.MaskBlend;case "none":return u.AlphaDiscardMode.Opaque;case "transparency":return u.AlphaDiscardMode.Blend;default:return u.AlphaDiscardMode.Blend}}function F(I){I=
I.params;return{id:1,material:I.material,texture:I.texture,region:I.texture}}const G=()=>h.getLogger("esri.views.3d.layers.graphics.objectResourceUtils"),D=new d.Version(1,2,"wosr");a.createTextureResources=H;a.load=async function(I,J){I=await y(I,J);J=await H(I.textureDefinitions??{},J);let N=0;for(const M in J)if(J.hasOwnProperty(M)){const Q=J[M];N+=Q?.image?Q.image.width*Q.image.height*4:0}return{resource:I,textures:J,size:N+k.estimateNestedObjectSize(I)}};a.processLoadResult=function(I,J){const N=
[],M=[],Q=[],O=new e.NestedMap,K=I.resource;var L=d.Version.parse(K.version||"1.0","wosr");D.validate(L);L=K.model.name;const P=K.model.geometries,R=K.materialDefinitions??{};I=I.textures;let W=0;const V=new Map;for(let Z=0;Z<P.length;Z++){const ia=P[Z];if(!A(ia))continue;var ba=F(ia),U=ia.params.vertexAttributes;const Y=[];var da=ea=>{if("PerAttributeArray"===ia.params.topology)return null;const ka=ia.params.faces;for(const ja in ka)if(ja===ea)return ka[ja].values;return null},fa=U[q.VertexAttribute.POSITION];
fa=fa.values.length/fa.valuesPerElement;for(const ea in U){var ha=U[ea],T=ha.values,S=da(ea)??l.getContinuousIndexArray(fa);Y.push([ea,new x.Attribute(T,S,ha.valuesPerElement,!0)])}U=ba.texture;if((da=I&&I[U])&&!V.has(U)){const {image:ea,parameters:ka}=da;fa=new m.Texture(ea,ka);M.push(fa);V.set(U,fa)}fa=(fa=V.get(U))?fa.id:void 0;ba=ba.material;ha=O.get(ba,U);null==ha&&(ha=ba.slice(ba.lastIndexOf("/")+1),ha=R[ha].params,1===ha.transparency&&(ha.transparency=0),T=da&&da.alphaChannelUsage,T=0<ha.transparency||
"transparency"===T||"maskAndTransparency"===T,S=da?E(da.alphaChannelUsage):void 0,da={ambient:f.fromArray(ha.diffuse),diffuse:f.fromArray(ha.diffuse),opacity:1-(ha.transparency||0),transparent:T,textureAlphaMode:S,textureAlphaCutoff:.33,textureId:fa,initTextureTransparent:!0,doubleSided:!0,cullFace:u.CullFaceOptions.None,colorMixMode:ha.externalColorMixMode||"tint",textureAlphaPremultiplied:da?.parameters.preMultiplyAlpha??!1},J?.materialParameters&&Object.assign(da,J.materialParameters),ha=new r.DefaultMaterial(da,
J),O.set(ba,U,ha));Q.push(ha);U=new t.Geometry(ha,Y);W+=Y.find(ea=>ea[0]===q.VertexAttribute.POSITION)?.[1]?.indices.length??0;N.push(U)}return{engineResources:[{name:L,stageResources:{textures:M,materials:Q,geometries:N},pivotOffset:K.model.pivotOffset,numberOfVertices:W,lodThreshold:null}],referenceBoundingBox:C(N)}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/StreamTextureCollection":function(){define("exports ../../../core/promiseUtils ../../../core/urlUtils ./TextureCollection ../webgl-engine/lib/Texture ../../webgl/enums".split(" "),
function(a,b,n,k,p,h){class e extends k.TextureCollection{constructor(g,d,f){super(d,f);this._streamDataRequester=g}async fromUrl(g,d,f){b.throwIfAborted(f);f=f?.signal;const c=this.makeUid(g,d);let l=this._textureRequests.get(c);if(!l){const w=new AbortController,x=this._streamDataRequester.request(g,"image",{uid:c,signal:w.signal});l=new k.TextureRequest;l.abortController=w;const u=l;this._textureRequests.set(c,l);l.textureAsync=x.then(async t=>{t=this._createTexture(g,t,d);u.texture=t;u.abortController=
null;await t.load(this._stage.renderView.renderingContext);this._stage.add(t);return new k.TextureResult(c,t,()=>this._release(c))},t=>{u.abortController=null;throw t;})}l.referenceCount++;try{return await b.whenOrAbort(l.textureAsync,f)}catch(w){throw this._release(c),w;}}_createTexture(g,d,f){const c={width:d.width,height:d.height,wrap:{s:h.TextureWrapMode.CLAMP_TO_EDGE,t:h.TextureWrapMode.CLAMP_TO_EDGE},preMultiplyAlpha:!0,reloadable:!0};if(n.isSVG(g)){if(f||0===d.width&&0===d.height)g=d.width?
d.height/d.width:1,f=f||64,1<g?(d.width=Math.round(f/g),d.height=f):(d.width=f,d.height=Math.round(f*g));this._stage.renderView?.renderingContext.driverTest.svgPremultipliesAlpha.result&&(c.preMultiplyAlpha=!1)}return new p.Texture(d,c)}}a.StreamTextureCollection=e;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/TextureCollection":function(){define("exports ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/has ../../../core/accessorSupport/decorators/property ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ../../support/Scheduler".split(" "),
function(a,b,n,k,p,h,e,g,d){a.TextureCollection=class extends n{constructor(l,w){super({});this._stage=l;this._textureRequests=new Map;this._frameTask=w?.registerTask(d.TaskPriority.TEXTURE_UNLOAD)??d.ImmediateTask}normalizeCtorArgs(){return{}}destroy(){super.destroy();this._frameTask?.remove();this._textureRequests?.forEach(l=>this._releaseTextureRequest(l));this._textureRequests?.clear()}get updating(){return this._frameTask.updating}fromData(l,w){const x=this.makeUid(l);l=this._textureRequests.get(x);
l||(l=new c,l.texture=w(),this._stage&&(l.texture.load(this._stage.renderView.renderingContext),this._stage.add(l.texture)),this._textureRequests.set(x,l));l.referenceCount++;return new f(x,l.texture,()=>this._release(x))}_release(l){const w=this._textureRequests.get(l);w?(1>w.referenceCount&&console.warn("TextureCollection: reference count is \x3c 1 for "+l),w.referenceCount--,1>w.referenceCount&&this._frameTask.schedule(()=>this._releaseNow(l))):console.warn(`TextureCollection: texture doesn't exist: '${l}'`)}get test(){}_releaseNow(l){if(this._textureRequests){var w=
this._textureRequests.get(l);!w||0<w.referenceCount||(w.texture?.unload(),this._releaseTextureRequest(w),this._textureRequests.delete(l))}}_releaseTextureRequest(l){l.texture?this._stage?.remove(l.texture):l.abortController&&(l.abortController.abort(),l.abortController=null)}makeUid(l,w=null){return null!=w?`${l}.${w}px`:l}};b.__decorate([p.property()],a.TextureCollection.prototype,"_frameTask",void 0);b.__decorate([p.property()],a.TextureCollection.prototype,"updating",null);a.TextureCollection=
b.__decorate([g.subclass("esri.views.3d.support.TextureCollection")],a.TextureCollection);class f{constructor(l,w,x){this.uid=l;this.texture=w;this.release=x}}class c{constructor(){this.referenceCount=0}}a.TextureRequest=c;a.TextureResult=f;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/pointsOfInterest/PointsOfInterest":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/has ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/Logger ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../geometry/support/ray ../debugFlags ../debugUtils ../geometryUtils/ray ./CameraOnSurface ./CenterOnSurface ./ContentGeometryUpdates ./Focus ./StableSurfaceCenter ./SurfaceGeometryUpdates ../../webgl-engine/lib/Intersector ../../webgl-engine/lib/IntersectorInterfaces ../../webgl-engine/lib/verticalOffsetUtils ../../../support/PropertiesPool ../../../support/Scheduler".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w,x,u,t,m,q,r,v,y,B,z,A,C,H){a.PointsOfInterest=class extends n{constructor(I){super(I);this.renderPointOfView=c.create();this._pois=[];this._debugCenters=null;this._tmpRay=l.create();this._centerRayDirty=!0;this._surfaceAltitudeAtCenter=0;this._surfaceAltitudeAtCenterDirty=!0;this._contentAltitudeAtCenter=0;this._contentAltitudeAtCenterDirty=!0;this._propertiesPool=new C.PropertiesPool({renderPointOfView:E},this)}initialize(){const {state:I,basemapTerrain:J,renderCoordsHelper:N,
map:M}=this.view;this._surfaceIntersector=B.newIntersector(I.viewingMode);this._surfaceIntersector.options.invisibleTerrain=!1;this._surfaceIntersector.options.store=z.StoreResults.MIN;this._contentIntersector=B.newIntersector(I.viewingMode);const Q=()=>this._estimateSurfaceAltitudeAtCenter(),O=this.view.resourceController.scheduler,K=this.view.basemapTerrain?.elevationQueryCache,L={state:I,scheduler:O,surface:J,renderCoordsHelper:N};this._set("centerOnSurfaceInfrequent",new m.CenterOnSurface({...L,
task:H.TaskPriority.POINT_OF_INTEREST_INFREQUENT,estimateSurfaceAltitudeAtCenter:Q}));this._set("centerOnSurfaceFrequent",new m.CenterOnSurface({...L,task:H.TaskPriority.POINT_OF_INTEREST_FREQUENT,estimateSurfaceAltitudeAtCenter:Q}));this._set("centerOnContent",new m.CenterOnSurface({...L,task:H.TaskPriority.POINT_OF_INTEREST_FREQUENT,estimateSurfaceAltitudeAtCenter:()=>this._estimateContentAltitudeAtCenter()}));this._set("cameraOnSurface",new t.CameraOnSurface({...L,cache:K,task:H.TaskPriority.POINT_OF_INTEREST_INFREQUENT,
map:M}));this._set("surfaceGeometryUpdates",new y.SurfaceGeometryUpdates({...L,centerOnSurfaces:[this.centerOnSurfaceFrequent,this.centerOnContent,this.centerOnSurfaceInfrequent]}));this._set("contentGeometryUpdates",new q.ContentGeometryUpdates({contentLayerViews:this.view.allLayerViews,renderCoordsHelper:N}));this._set("surfaceOrigin",new v.StableSurfaceCenter({cache:K,view:this.view}));this._set("focus",new r.Focus({state:I,scheduler:O,surface:J,renderCoordsHelper:N,centerOnSurface:this.centerOnSurfaceFrequent,
estimateSurfaceIntersectionAtRenderPoint:(P,R)=>this._estimateSurfaceIntersectionAtRenderPoint(P,this.view.state.contentCamera,R)}));this._pois.push(this.centerOnContent,this.centerOnSurfaceFrequent,this.centerOnSurfaceInfrequent,this.cameraOnSurface,this.focus);this.addHandles([p.watch(()=>I.contentCamera,P=>this._cameraChanged(P),p.sync),p.watch(()=>J.extent,()=>this._updateCenterPointsOfInterest()),p.watch(()=>this.view.map?.ground?.navigationConstraint?.type,P=>{this._surfaceIntersector.options.backfacesTerrain=
"none"===P},p.initial),p.when(()=>!J.updating,()=>this._updateCenterPointsOfInterest(),p.sync),p.on(()=>this.surfaceGeometryUpdates.events,"request-update",()=>this._updateCenterPointsOfInterest()),p.on(()=>this.contentGeometryUpdates.events,"request-update",()=>this._updateCenterOnContent()),p.watch(()=>w.debugFlags.SHOW_POI,P=>this._setDebug(P),p.initial)]);this._cameraChanged(this.view.state.contentCamera);for(const P of this._pois)P.runTask()}destroy(){this._setDebug(!1);this._propertiesPool.destroy();
for(const I of this._pois)I.destroy();this.surfaceOrigin.destroy()}get updating(){return!(!this.surfaceGeometryUpdates?.updating&&!this._pois.some(I=>I.updating))}get _centerRay(){this._centerRayDirty&&(this._centerRayCached=this.view.sceneIntersectionHelper.getCenterRayWithSubpixelOffset(this.view.state.contentCamera,this._tmpRay),this._centerRayDirty=!1);return this._centerRayCached}_estimateContentAltitudeAtCenter(){if(!this._contentAltitudeAtCenterDirty)return this._contentAltitudeAtCenter;this._contentAltitudeAtCenterDirty=
!1;const I=this._centerRay;if(null==I)return this._contentAltitudeAtCenter;this.view.sceneIntersectionHelper.intersectRay(I,this._contentIntersector,F,D)?this._contentAltitudeAtCenter=this.view.renderCoordsHelper.getAltitude(F):this._contentAltitudeAtCenter=this._estimateSurfaceAltitudeAtCenter();return this._contentAltitudeAtCenter}_estimateSurfaceAltitudeAtCenter(){if(!this.view.basemapTerrain)return 0;if(!this._surfaceAltitudeAtCenterDirty)return this._surfaceAltitudeAtCenter;this._surfaceAltitudeAtCenterDirty=
!1;const I=this._centerRay;if(null==I)return this._surfaceAltitudeAtCenter;const J=I.origin,N=f.add(F,I.origin,I.direction);this._surfaceIntersector.resetWithRay(I,this.view.state.contentCamera);this.view.basemapTerrain.intersect(this._surfaceIntersector,null,J,N);this._surfaceIntersector.results.min.getIntersectionPoint(F)&&(this._surfaceAltitudeAtCenter=this.view.renderCoordsHelper.getAltitude(F));return this._surfaceAltitudeAtCenter}_estimateSurfaceIntersectionAtRenderPoint(I,J,N){I=u.fromRenderAtEye(J,
I,G);if(null==I)return null;const M=I.origin,Q=f.add(F,I.origin,I.direction);this._surfaceIntersector.resetWithRay(I,J);this.view.basemapTerrain.intersect(this._surfaceIntersector,null,M,Q);return this._surfaceIntersector.results.min.getIntersectionPoint(N)?N:null}_cameraChanged(I){this._updateCenterPointsOfInterest();I=I.eye;f.exactEquals(this.renderPointOfView,I)||this._set("renderPointOfView",f.copy(this._propertiesPool.get("renderPointOfView"),I))}_updateCenterPointsOfInterest(){this._contentAltitudeAtCenterDirty=
this._surfaceAltitudeAtCenterDirty=this._centerRayDirty=!0;for(const I of this._pois)I.updateRenderLocation()}_updateCenterOnContent(){this._contentAltitudeAtCenterDirty=!0;this.centerOnContent.updateRenderLocation()}_setDebug(I){if(I){this._debugCenters||(this._debugCenters=new Map,I=this.view.graphics,this._debugCenters.set(this.centerOnContent,new x.PointGraphics(I,"red","CenterOnContent")),this._debugCenters.set(this.centerOnSurfaceFrequent,new x.PointGraphics(I,"red","CenterOnSurface")),this._debugCenters.set(this.centerOnSurfaceInfrequent,
new x.PointGraphics(I,"red","CenterOnSurface")),this._debugCenters.set(this.cameraOnSurface,new x.PointGraphics(I,"blue","CameraOnSurface")),this._debugCenters.set(this.focus,new x.PointGraphics(I,"green","Focus")));for(const J of this._pois)this.addHandles(p.watch(()=>J.renderLocation,N=>this._debugCenters?.get(J)?.show(N,J.renderCoordsHelper.spatialReference),p.initial),"debug")}else this._debugCenters?.forEach(J=>J.hide()),this.removeHandles("debug")}get test(){}};b.__decorate([h.property()],a.PointsOfInterest.prototype,
"centerOnContent",void 0);b.__decorate([h.property()],a.PointsOfInterest.prototype,"centerOnSurfaceFrequent",void 0);b.__decorate([h.property()],a.PointsOfInterest.prototype,"centerOnSurfaceInfrequent",void 0);b.__decorate([h.property()],a.PointsOfInterest.prototype,"cameraOnSurface",void 0);b.__decorate([h.property()],a.PointsOfInterest.prototype,"focus",void 0);b.__decorate([h.property()],a.PointsOfInterest.prototype,"renderPointOfView",void 0);b.__decorate([h.property()],a.PointsOfInterest.prototype,
"surfaceOrigin",void 0);b.__decorate([h.property()],a.PointsOfInterest.prototype,"contentGeometryUpdates",void 0);b.__decorate([h.property()],a.PointsOfInterest.prototype,"surfaceGeometryUpdates",void 0);b.__decorate([h.property({constructOnly:!0})],a.PointsOfInterest.prototype,"view",void 0);b.__decorate([h.property()],a.PointsOfInterest.prototype,"updating",null);a.PointsOfInterest=b.__decorate([d.subclass("esri.views.3d.support.pointsOfInterest.PointsOfInterest")],a.PointsOfInterest);const E=Array,
F=c.create(),G=l.create(),D={exclude:new Set([A.terrainId])};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/debugUtils":function(){define("exports ../../../geometry ../../../Graphic ../../../symbols ../../../core/Collection ../../../symbols/PointSymbol3D ../../../symbols/IconSymbol3DLayer ../../../symbols/TextSymbol3DLayer ../../../geometry/Point".split(" "),function(a,b,n,k,p,h,e,g,d){class f{constructor(c,l,w=""){this.graphics=c;this._symbol=new h({symbolLayers:new p([new e({material:{color:l},
outline:{color:[255,255,255],size:1},resource:{primitive:"circle"}}),new g({text:w,halo:{color:"white",size:1/.75},material:{color:l},size:12})])})}show(c,l){null!=l&&(this.hide(),c=new d({x:c[0],y:c[1],z:c[2],spatialReference:l}),this._graphic=new n({geometry:c,symbol:this._symbol}),this.graphics.add(this._graphic))}hide(){null!=this._graphic&&(this.graphics.remove(this._graphic),this._graphic=null)}}a.PointGraphics=f;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/pointsOfInterest/CameraOnSurface":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/Logger ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../geometry/Point ../../../ViewingMode ../cameraUtils ./PointOfInterest ../../../support/PropertiesPool ../../../support/Yield".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w,x,u,t,m,q){const r=Array;a.CameraOnSurface=class extends t.PointOfInterest{constructor(y){super(y);this._dirty=!1;this._propertiesPool=new m.PropertiesPool({location:w,renderLocation:r},this);this._estimatedSurfaceAltitude=0;this._pendingElevationQueryController=null;this.renderLocation=l.create();this._tmpPoint=new w}initialize(){this.scheduler&&this.addHandles(this.scheduler.registerTask(this.task,this));this.runTask();if(this.map){const y=()=>this._setDirty();
this.addHandles(p.on(()=>this.map?.ground?.layers,"change",y,{onListenerAdd:y,onListenerRemove:y}))}this._updateRenderLocation()}destroy(){this._cancelPendingRequest();this._propertiesPool=n.destroyMaybe(this._propertiesPool)}get _camera(){return this.state.contentCamera}get location(){const y=this._propertiesPool.get("location");y.spatialReference=this.state.spatialReference;this.renderCoordsHelper.fromRenderCoords(this.renderLocation,y);return y}get scale(){const y=this._camera,B=c.distance(y.eye,
this.renderLocation);return u.distanceToScale({renderCoordsHelper:this.renderCoordsHelper,state:{camera:y}},B)}get updating(){return this._dirty||null!=this._pendingElevationQueryController}updateRenderLocation(){this._setDirty();this._updateRenderLocation()}_setDirty(){this._dirty||(this._dirty=!0,this.notifyChange("updating"))}_cancelPendingRequest(){const y=this._pendingElevationQueryController;y&&(this._pendingElevationQueryController=null,y.abort(),this.notifyChange("updating"))}get running(){return!this._pendingElevationQueryController&&
this._dirty}runTask(){this._cancelPendingRequest();this._dirty=!1;this.notifyChange("updating");if(!this.map?.ground)return this._updateSurfaceAltitude(0),q.Yield;var y=this.state.spatialReference;this._tmpPoint.spatialReference=y;this.renderCoordsHelper.fromRenderCoords(this._camera.eye,this._tmpPoint);y=1E5<(this._tmpPoint.z??0)&&this.renderCoordsHelper.viewingMode===x.ViewingMode.Global&&(y.isWGS84||y.isWebMercator);let B=new AbortController;this.map.ground.queryElevation(this._tmpPoint,{signal:B.signal,
cache:this.cache,minDemResolution:y?1E6:0}).then(z=>this._updateSurfaceAltitude(z.geometry.z??0)).catch(z=>{k.isAbortError(z)||this._updateSurfaceAltitude(0)}).catch(()=>{}).then(()=>{this._pendingElevationQueryController===B&&(this._pendingElevationQueryController=null,this.notifyChange("updating"));B=null});this._pendingElevationQueryController=B;return q.Yield}_updateSurfaceAltitude(y){this._estimatedSurfaceAltitude!==y&&(this._estimatedSurfaceAltitude=y,this._updateRenderLocation())}_updateRenderLocation(){this.renderCoordsHelper.setAltitude(v,
this._estimatedSurfaceAltitude,this._camera.eye);c.exactEquals(this._get("renderLocation"),v)||(this._set("renderLocation",c.copy(this._propertiesPool.get("renderLocation"),v)),this.notifyChange("renderLocation"))}};b.__decorate([h.property({constructOnly:!0})],a.CameraOnSurface.prototype,"scheduler",void 0);b.__decorate([h.property({constructOnly:!0})],a.CameraOnSurface.prototype,"cache",void 0);b.__decorate([h.property({constructOnly:!0})],a.CameraOnSurface.prototype,"task",void 0);b.__decorate([h.property()],
a.CameraOnSurface.prototype,"location",null);b.__decorate([h.property({constructOnly:!0})],a.CameraOnSurface.prototype,"map",void 0);b.__decorate([h.property()],a.CameraOnSurface.prototype,"renderLocation",void 0);b.__decorate([h.property()],a.CameraOnSurface.prototype,"scale",null);b.__decorate([h.property()],a.CameraOnSurface.prototype,"updating",null);a.CameraOnSurface=b.__decorate([f.subclass("esri.views.3d.support.pointsOfInterest.CameraOnSurface")],a.CameraOnSurface);const v=l.create();Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/pointsOfInterest/PointOfInterest":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/Logger ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass".split(" "),function(a,b,n,k,p,h,e,g){a.PointOfInterest=class extends n{constructor(d){super(d)}};b.__decorate([k.property({constructOnly:!0})],
a.PointOfInterest.prototype,"renderCoordsHelper",void 0);b.__decorate([k.property({constructOnly:!0})],a.PointOfInterest.prototype,"surface",void 0);b.__decorate([k.property({constructOnly:!0})],a.PointOfInterest.prototype,"state",void 0);a.PointOfInterest=b.__decorate([g.subclass("esri.views.3d.support.pointsOfInterest.PointOfInterest")],a.PointOfInterest);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/pointsOfInterest/CenterOnSurface":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/mathUtils ../../../../core/maybe ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/Logger ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../geometry/ellipsoidUtils ../../../../geometry/Point ../../../../geometry/projection/projectBoundingRect ../../../../geometry/support/aaBoundingRect ../debugFlags ./PointOfInterest ../../../support/PropertiesPool ../../../support/Yield".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w,x,u,t,m,q,r){const v=Array;a.CenterOnSurface=class extends m.PointOfInterest{constructor(A){super(A);this._propertiesPool=new q.PropertiesPool({location:w,renderLocation:v},this);this.distance=this._latestSurfaceAltitude=this._currentSurfaceAltitude=0;this.renderLocation=c.create();this.updating=!1}initialize(){this._frameWorker=this.scheduler.registerTask(this.task,this);this.runTask()}destroy(){this._frameWorker=k.removeMaybe(this._frameWorker);this._propertiesPool=
k.destroyMaybe(this._propertiesPool)}get _camera(){return this.state.contentCamera}get location(){const A=this._propertiesPool.get("location");A.spatialReference=this.state.spatialReference;this.renderCoordsHelper.fromRenderCoords(this.renderLocation,A);return A}updateRenderLocation(){this.updating=!0;this._updateRenderLocation()}get estimatedSurfaceAltitude(){return this._latestSurfaceAltitude}get running(){return this.updating}runTask(){this._latestSurfaceAltitude=this.estimateSurfaceAltitudeAtCenter();
this._updateRenderLocation();this.updating=!1;return r.Yield}_updateRenderLocation(){const A=y;let C=this._calculateSurfaceIntersection(this._currentSurfaceAltitude,A);var H=this._currentSurfaceAltitude!==this._latestSurfaceAltitude;!C&&H&&(C=this._calculateSurfaceIntersection(this._latestSurfaceAltitude,A))&&(this._currentSurfaceAltitude=this._latestSurfaceAltitude);H=B;C&&this._latestSurfaceAltitudeChangesDistanceSignificantly(A,H)&&(f.copy(A,H),this._currentSurfaceAltitude=this._latestSurfaceAltitude);
C?this.distance=f.distance(this._camera.eye,A):(f.scale(A,this._camera.viewForward,this._get("distance")),f.add(A,A,this._camera.eye));f.exactEquals(this._get("renderLocation"),A)||this._set("renderLocation",f.copy(this._propertiesPool.get("renderLocation"),A))}_calculateSurfaceIntersection(A,C){var H=this._camera;if(!this.renderCoordsHelper.intersectInfiniteManifold(H.ray,A,C))return!1;if(this.state.isGlobal){const E=l.getReferenceEllipsoid(this.renderCoordsHelper.spatialReference).radius;A=E+A;
const F=f.squaredLength(H.eye),G=F<A*A,D=f.distance(H.eye,C);G&&D>E/4&&(f.scale(C,H.viewForward,A-Math.sqrt(F)),f.add(C,C,H.eye))}else H=this.surface?.ready?this.surface.extent:null,null!=H&&x.projectBoundingRect(H,this.surface?.spatialReference,z,this.renderCoordsHelper.spatialReference)&&(C[0]=n.clamp(C[0],z[0],z[2]),C[1]=n.clamp(C[1],z[1],z[3]));return!0}_latestSurfaceAltitudeChangesDistanceSignificantly(A,C){if(this._latestSurfaceAltitude===this._currentSurfaceAltitude||null==A)return!1;if(this._calculateSurfaceIntersection(this._latestSurfaceAltitude,
C)){if(t.debugFlags.TESTS_DISABLE_OPTIMIZATIONS)return!0;const H=this._camera.eye;A=f.distance(H,A);C=f.distance(H,C);if(.05<Math.abs(C-A)/A)return!0}return!1}};b.__decorate([p.property({constructOnly:!0})],a.CenterOnSurface.prototype,"scheduler",void 0);b.__decorate([p.property({constructOnly:!0})],a.CenterOnSurface.prototype,"task",void 0);b.__decorate([p.property()],a.CenterOnSurface.prototype,"distance",void 0);b.__decorate([p.property({constructOnly:!0})],a.CenterOnSurface.prototype,"estimateSurfaceAltitudeAtCenter",
void 0);b.__decorate([p.property({readOnly:!0})],a.CenterOnSurface.prototype,"location",null);b.__decorate([p.property({readOnly:!0})],a.CenterOnSurface.prototype,"renderLocation",void 0);b.__decorate([p.property()],a.CenterOnSurface.prototype,"updating",void 0);a.CenterOnSurface=b.__decorate([d.subclass("esri.views.3d.support.pointsOfInterest.CenterOnSurface")],a.CenterOnSurface);const y=c.create(),B=c.create(),z=u.create();Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/pointsOfInterest/ContentGeometryUpdates":function(){define(["exports",
"../../../../core/Evented","../../../../core/Handles","../../../../core/maybe"],function(a,b,n,k){class p{constructor(e){this._handles=new n;this.events=new b;this._contentLayerViews=e.contentLayerViews;this._handles.add(this._contentLayerViews.on("change",g=>this._layerViewsChanged(g)));this._layerViewsChanged({added:this._contentLayerViews.toArray(),removed:[],moved:[],target:this._contentLayerViews})}destroy(){this._handles=k.destroyMaybe(this._handles);this._contentLayerViews.destroy()}_layerViewsChanged(e){e.added.forEach(g=>
{"esri.views.3d.layers.SceneLayerView3D"===g.declaredClass&&this._handles.add(g.on("visible-geometry-changed",()=>this._contentChanged()),g.uid)});e.removed.forEach(g=>this._handles.remove(g.uid))}_contentChanged(){this.events.emit("request-update",h)}}const h={};a.ContentGeometryUpdates=p;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/pointsOfInterest/Focus":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/mathUtils ../../../../core/maybe ../../../../core/reactiveUtils ../../../../core/screenUtils ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/Logger ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../geometry/Point ../../../../geometry/support/ray ./PointOfInterest ../../webgl-engine/lib/rendererUtils ../../../support/PropertiesPool ../../../support/Scheduler ../../../support/Yield".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w,x,u,t,m,q,r,v){const y=Array;a.Focus=class extends t.PointOfInterest{constructor(C){super(C);this._propertiesPool=new q.PropertiesPool({location:x,renderLocation:y},this);this._dirty=!0;this.renderLocation=this._propertiesPool.get("renderLocation")}initialize(){this.addHandles([p.watch(()=>this.centerOnSurface.renderLocation,()=>this.updateRenderLocation()),p.watch(()=>this.state.contentCamera,()=>this.updateRenderLocation())]);this.scheduler&&this.addHandles(this.scheduler.registerTask(r.TaskPriority.POINT_OF_INTEREST_FREQUENT,
this))}destroy(){this._propertiesPool=k.destroyMaybe(this._propertiesPool)}get updating(){return this._dirty||this.centerOnSurface.updating}get location(){const C=this._propertiesPool.get("location");C.spatialReference=this.state.spatialReference;this.renderCoordsHelper.fromRenderCoords(this.renderLocation,C);return C}get worldUnitsPerContentPixel(){const {camera:C,contentPixelRatio:H}=this.state;return C.computeRenderPixelSizeAt(this.renderLocation)*(C.pixelRatio/H)}get running(){return this._dirty}runTask(){var C=
this._get("renderLocation");const H=this.centerOnSurface.renderLocation;var E=this.renderCoordsHelper,F=this.state.contentCamera;this._dirty=!1;E.worldUpAtPosition(H,B);E=Math.max(0,(Math.acos(l.dot(B,F.viewForward))-.5*Math.PI)*(F.aboveGround?1:-1));if(Number.isNaN(E))return C&&l.equals(C,H)||(C=this._propertiesPool.get("renderLocation"),l.copy(C,H),this._set("renderLocation",C)),v.Yield;E=1-n.clamp(E/(.5*Math.PI),0,1);E*=E*E;this._calculateScreenHorizontalEdgeOnSurface(A);F=this._propertiesPool.get("renderLocation");
l.lerp(F,H,A,E);C&&l.equals(C,F)||this._set("renderLocation",F);return v.Yield}_calculateScreenHorizontalEdgeOnSurface(C){const H=this.state.contentCamera;var E=H.getRenderCenter(h.createRenderScreenPointArray3());E[1]=H.aboveGround?H.padding[m.PaddingSide.BOTTOM]:H.fullHeight-H.padding[m.PaddingSide.TOP];if(this.estimateSurfaceIntersectionAtRenderPoint(E,C))return C;const F=this.renderCoordsHelper.getAltitude(this.centerOnSurface.renderLocation);return H.unprojectFromRenderScreen(E,z)&&(l.subtract(z,
z,H.eye),E=l.normalize(z,z),this.renderCoordsHelper.intersectInfiniteManifold(u.wrap(H.eye,E),F,C))?C:this.renderCoordsHelper.setAltitude(C,F,H.eye)}updateRenderLocation(){this._dirty=!0}};b.__decorate([e.property()],a.Focus.prototype,"_dirty",void 0);b.__decorate([e.property({constructOnly:!0})],a.Focus.prototype,"scheduler",void 0);b.__decorate([e.property({constructOnly:!0})],a.Focus.prototype,"centerOnSurface",void 0);b.__decorate([e.property({constructOnly:!0})],a.Focus.prototype,"estimateSurfaceIntersectionAtRenderPoint",
void 0);b.__decorate([e.property()],a.Focus.prototype,"updating",null);b.__decorate([e.property()],a.Focus.prototype,"location",null);b.__decorate([e.property()],a.Focus.prototype,"renderLocation",void 0);b.__decorate([e.property()],a.Focus.prototype,"worldUnitsPerContentPixel",null);a.Focus=b.__decorate([c.subclass("esri.views.3d.support.pointsOfInterest.Focus")],a.Focus);const B=w.create(),z=w.create(),A=w.create();Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/pointsOfInterest/StableSurfaceCenter":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/has ../../../../core/Error ../../../../core/Logger ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../geometry/Point ../../../../geometry/support/aaBoundingRect".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w){a.StableSurfaceCenter=class extends n{get surface(){return this.view.map?.ground}get surfaceView(){return this.view.basemapTerrain}get renderLocation(){if(!this.location)return null;const x=c.create();this.view.renderCoordsHelper.toRenderCoords(this.location,x);return x}constructor(x){super(x);this._updateController=this.location=null}initialize(){this.view.state.isLocal&&(this.addHandles([e.watch(()=>[this.surfaceView?.spatialReference,this.surfaceView?.extent],
()=>this._update()),e.on(()=>this.surface?.layers,"change",()=>this._update())]),this._update())}_update(){this._updateController&&(this._updateController.abort(),this._updateController=null);if(null==this.surfaceView?.extent||null==this.surfaceView.spatialReference)this._set("location",null);else{var x=w.center(this.surfaceView.extent);x=new l({x:x[0],y:x[1],z:0,spatialReference:this.surfaceView.spatialReference});this.surface&&0<this.surface.layers.length?(this._set("location",null),this._updateController=
new AbortController,this.surface.queryElevation(x,{noDataValue:0,signal:this._updateController.signal,cache:this.cache}).then(u=>{this._updateController=null;this._set("location",u.geometry)}).catch(u=>{})):this._set("location",x)}}};b.__decorate([g.property({constructOnly:!0})],a.StableSurfaceCenter.prototype,"view",void 0);b.__decorate([g.property({constructOnly:!0})],a.StableSurfaceCenter.prototype,"cache",void 0);b.__decorate([g.property()],a.StableSurfaceCenter.prototype,"surface",null);b.__decorate([g.property()],
a.StableSurfaceCenter.prototype,"surfaceView",null);b.__decorate([g.property({readOnly:!0})],a.StableSurfaceCenter.prototype,"location",void 0);b.__decorate([g.property({readOnly:!0})],a.StableSurfaceCenter.prototype,"renderLocation",null);a.StableSurfaceCenter=b.__decorate([f.subclass("esri.views.3d.support.pointsOfInterest.StableSurfaceCenter")],a.StableSurfaceCenter);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/pointsOfInterest/SurfaceGeometryUpdates":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Evented ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/Logger ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../geometry/support/aaBoundingRect ../../../support/Scheduler ../../../support/Yield".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w){a.SurfaceGeometryUpdates=class extends n{constructor(q){super(q);this._tileGeometryUpdateExtent=c.empty();this._tileGeometryUpdateSpatialReference=null;this.events=new k;this.updating=!1}initialize(){this.addHandles([this.surface.on("elevation-change",q=>this._tileGeometryChanged(q)),this.scheduler.registerTask(l.TaskPriority.SURFACE_GEOMETRY_UPDATES,this)])}get running(){return this.updating}runTask(){if(!this.updating)return w.Yield;this._tileGeometryUpdateSpatialReference&&
this._centerIntersectsExtent(this._tileGeometryUpdateExtent,this._tileGeometryUpdateSpatialReference)&&this.events.emit("request-update",x);c.empty(this._tileGeometryUpdateExtent);this._set("updating",!1);return w.Yield}_tileGeometryChanged(q){this._tileGeometryUpdateSpatialReference=q.spatialReference;c.expand(this._tileGeometryUpdateExtent,q.extent,this._tileGeometryUpdateExtent);this._set("updating",!0)}_furthestCenterOnSurface(){let q=this.centerOnSurfaces[0];for(let r=1;r<this.centerOnSurfaces.length;r++){const v=
this.centerOnSurfaces[r];v.distance>q.distance&&(q=v)}return q}_centerIntersectsExtent(q,r){const v=this.state.contentCamera.eye,y=m,B=this._furthestCenterOnSurface();this.renderCoordsHelper.fromRenderCoords(v,u,r);this.renderCoordsHelper.fromRenderCoords(B.renderLocation,t,r);u[0]<t[0]?(y[0]=u[0],y[2]=t[0]):(y[0]=t[0],y[2]=u[0]);u[1]<t[1]?(y[1]=u[1],y[3]=t[1]):(y[1]=t[1],y[3]=u[1]);return c.intersects(y,q)}};b.__decorate([p.property({constructOnly:!0})],a.SurfaceGeometryUpdates.prototype,"state",
void 0);b.__decorate([p.property({constructOnly:!0})],a.SurfaceGeometryUpdates.prototype,"centerOnSurfaces",void 0);b.__decorate([p.property({constructOnly:!0})],a.SurfaceGeometryUpdates.prototype,"renderCoordsHelper",void 0);b.__decorate([p.property({constructOnly:!0})],a.SurfaceGeometryUpdates.prototype,"scheduler",void 0);b.__decorate([p.property({constructOnly:!0})],a.SurfaceGeometryUpdates.prototype,"surface",void 0);b.__decorate([p.property({readOnly:!0})],a.SurfaceGeometryUpdates.prototype,
"updating",void 0);a.SurfaceGeometryUpdates=b.__decorate([d.subclass("esri.views.3d.support.pointsOfInterest.SurfaceGeometryUpdates")],a.SurfaceGeometryUpdates);const x={},u=f.create(),t=f.create(),m=c.empty();Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/TerrainSurface":function(){define("require ../../../chunks/tslib.es6 ../../../Color ../../../core/Accessor ../../../core/arrayUtils ../../../core/CollectionFlattener ../../../core/Evented ../../../core/has ../../../core/Logger ../../../core/mathUtils ../../../core/maybe ../../../core/MemCachePool ../../../core/ObjectPool ../../../core/PooledArray ../../../core/promiseUtils ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/decorators/subclass ../../../chunks/vec32 ../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../core/support/UpdatingHandles ../../../geometry/ellipsoidUtils ../../../geometry/SpatialReference ../../../geometry/projection/projectors ../../../geometry/projection/projectPointToVector ../../../geometry/projection/projectVectorToVector ../../../geometry/support/aaBoundingRect ../../../geometry/support/frustum ../../../geometry/support/spatialReferenceUtils ../../../chunks/sphere ../../../layers/support/ElevationQueryTileCache ../../../layers/support/layerUtils ../support/debugFlags ../support/ElevationRange ../support/ElevationUpdateEvent ../support/extentUtils ../support/index ../support/updatingProperties ./ElevationBounds ./ElevationData ./ExtentHelper ./interfaces ./LayerClass ./OverlayManager ./PlanarPatch ./RenderOrder ./ScaleRangeQueries ./SphericalPatch ./SplitLimits ./TerrainConst ./TerrainRenderer ./TerrainSurfacePerformanceInfo ./terrainUtils ./Tile ./TilePerLayerInfo ./TileUpdate ./tileUtils ./TilingSchemeLogic ./TransparencyMode ./UpsampleInfo ../webgl-engine/core/shaderLibrary/output/BlendOptions ../webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../webgl-engine/lib/basicInterfaces ../../support/RenderState ../../support/Scheduler ../../support/Yield".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w,x,u,t,m,q,r,v,y,B,z,A,C,H,E,F,G,D,I,J,N,M,Q,O,K,L,P,R,W,V,ba,U,da,fa,ha,T,S,Z,ia,Y,ea,ka,ja,X,aa,pa,la,na,qa,sa,xa,ta,Ba,Ia){function Ca(ma,za,Na){for(const Ra of ma)if(Ra.containsPointXY(za,Na)){for(ma=Ra;ma&&!ma.renderData;)ma=ma.children[(za>ma.extentMidX?1:0)+(Na<ma.extentMidY?2:0)];return R.sampleElevation(za,Na,ma?.renderData?.geometryState.samplerData??null)}return null}function Ha(ma,za){!ma.leaf||ma.level<Z.maxTileNeighborLevelDelta||Ja(ma,Na=>{za&&Ga(Na);
var Ra=0===Na.maxLevelDeltaNeighborCount&&0===Na.unmergableChildCount;Na.maxLevelDeltaNeighborCount++;if(Ra)for(Na=Na.parent;Na;)if(Ra=0===Na.maxLevelDeltaNeighborCount&&0===Na.unmergableChildCount,Na.unmergableChildCount++,Ra)Na=Na.parent;else break})}function Ga(ma){if(!ma.hasPendingUpdate(X.TileUpdate.SPLIT)){for(var za=ma.parent;za?.resetPendingUpdate(X.TileUpdate.MERGE);)za=za.parent;ma.resetPendingUpdate(X.TileUpdate.MERGE);ma.leaf&&ma.setPendingUpdate(X.TileUpdate.SPLIT);ma.level<Z.maxTileNeighborLevelDelta||
Ja(ma,Na=>{Ga(Na)})}}function Aa(ma){ma.level<Z.maxTileNeighborLevelDelta||Ja(ma,za=>{za.maxLevelDeltaNeighborCount--;if(0===za.maxLevelDeltaNeighborCount&&0===za.unmergableChildCount)for(za=za.parent;za;)if(za.unmergableChildCount--,0===za.maxLevelDeltaNeighborCount&&0===za.unmergableChildCount)za=za.parent;else break})}function Ja(ma,za){if(!(ma.level<Z.maxTileNeighborLevelDelta)){var Na=ma.level-Z.maxTileNeighborLevelDelta,Ra=ma.lij[1]>>Z.maxTileNeighborLevelDelta,Pa=ma.lij[2]>>Z.maxTileNeighborLevelDelta,
ca=cb=>cb.leaf||cb.level===Na;for(let cb=0;4>cb;++cb){const ib=ma.findNeighborTile(ea.neighborEdgeIndices[cb],ca);if(!ib||ib.level!==Na)continue;const nb=ib.lij;nb[1]===Ra&&nb[2]===Pa||za(ib)}}}var Sa;k=Sa=class extends e.EventedMixin(k){constructor(ma){super(ma);this._scaleRangeQueries=new ha.ScaleRangeQueries;this._iteratorPool=new w(aa.IteratorPreorder,za=>za.remove=()=>this._iteratorPool.release(za));this._postorderIterator=new aa.IteratorPostorder;this._hasPendingUpdates=!1;this._asyncWorkItems=
this._pendingUpdates=0;this._allTilesSorted=this._allTilesDirty=!0;this._usedMemory=null;this._performanceInfo=new Y;this._viewChanged=!1;this.heading=0;this._viewChangeUpdateDirty=this._inFrameTask=!1;this._eyePosRenderSR=v.create();this._eyePosSurfaceSR=v.create();this._splitLimits=new S.SplitLimits;this._frustum=F.create();this._layerViews=[[],[]];this._layerIndexByUid=[new Map,new Map];this._basemapLayerViewHandles=new Map;this._watchUpdatingTracking=new y.UpdatingHandles;this._frameTask=Ba.ImmediateTask;
this._allTiles=new x;this._upsampleInfoPool=new w(na.UpsampleInfo);this._destroying=this._shouldEmitChangeEvent=!1;this._rootTilesExtent=E.create();this.updatingProgress=.5;this._maxNumUpdating=1;this.maxTextureScale=1.2;this._spatialReference=z.WebMercator;this._elevationProjectorCache=new Map;this.visibleElevationBounds=new P.ElevationBounds(Infinity,-Infinity);this.rootTileElevationBounds=new P.ElevationBounds(Infinity,-Infinity);this._sebProjectorMap=new Map;this._sebProjectorCache=A.createEmptyProjectorCache();
this._tilingSchemeSpatialReference=null;this._radiusModifier=Math.cos(Math.PI/16/16);this._updatingRootTiles=!1;this._pendingTilesForElevationUpdateEvent=new Set;this._pendingTilesToUpdate=new Set;this.totalTileUpdates=this.totalGeometryUpdates=0;this._oneBatchPerFrameTask=!0;this._layerViewsDirty=!1;this.unloadedMemory=0;this._isWebMercatorOnPlateCarree=this._isWebMercator=this.ignoresMemoryFactor=!1;this.overlayManager=new U.OverlayManager({...ma,surface:this});this._isGlobal=!ma.view?.state?.isLocal;
this._isGeographic=this._spatialReference?.isGeographic??!1;this._tileConstructor=this._isGlobal?T.SphericalPatch:da.PlanarPatch;this._ellipsoid=B.getReferenceEllipsoid(ma.view.spatialReference)}initialize(){const ma=this.view,za=ma.resourceController,Na=za.memoryController;this._tileCache=new l.MemCachePool((cb,ib)=>Na.newCache(cb,ib),"terrain-tile");this._upsampleMapCache=Na.newCache("terrain-upsample",cb=>cb.unloadMapData());this._elevationQueryCache=new I.ElevationQueryTileCache(Na.newCache("elevation-query"));
const Ra=this.overlayManager;this._renderer=new ia.TerrainRenderer(Ra.renderer,ma._stage,this._allTiles,this._ellipsoid.radius,Na);this.addHandles([t.watch(()=>Ra.renderer.isEmpty,()=>this._evaluateTransparency()),t.watch(()=>this.renderer.visible,cb=>this.suspended=!cb),t.watch(()=>this.heading,cb=>{this._renderer.updateHeading(cb);this._updateTileTextures(V.TextureUpdate.FADING)}),t.watch(()=>({heading:ma.camera?.heading,state:ma.state?.mode}),({heading:cb,state:ib})=>{if(null!=cb)if(this.isGlobal&&
this.isGeographic||this.isWebMercatorOnPlateCarree)this.heading=90*Math.round(cb/90)%360;else{cb=Math.round(cb)%360;var nb=Math.abs(cb-this.heading);if(ib===ta.RenderState.IDLE||30<=Math.min(nb,360-nb))this.heading=cb}})],"overlayManager");this.addHandles([t.watch(()=>this.baseOpacity,()=>{this._handleLayerViewChanges();this._updateTileTextures(this._evaluateTransparency()?V.TextureUpdate.UNFADED:V.TextureUpdate.IMMEDIATE)},t.syncAndInitial),t.watch(()=>this.hasCompositeBlendMode,()=>this._updateTileTextures(this._evaluateTransparency()?
V.TextureUpdate.UNFADED:V.TextureUpdate.IMMEDIATE),t.syncAndInitial),t.watch(()=>this.backgroundColor,(cb,ib)=>{cb?.equals(ib)||(this._handleLayerViewChanges(),this._renderer.updateTileBackground(cb))},t.sync),t.watch(()=>this.snapLevel,()=>this._viewChanged=!0,t.sync),t.watch(()=>this.view.pointsOfInterest,cb=>{this._renderer.pointsOfInterest=cb;this._watchUpdatingTracking.removeAll();cb&&this._watchUpdatingTracking.add(()=>cb.focus.renderLocation,()=>this._allTilesSorted=!1)}),t.watch(()=>N.debugFlags.TERRAIN_TILE_TREE_SHOW_TILES,
cb=>{cb&&!this._treeDebugger?(new Promise((ib,nb)=>a(["../layers/support/TerrainTileTree3DDebugger"],ib,nb))).then(({TerrainTileTree3DDebugger:ib})=>{!this._treeDebugger&&N.debugFlags.TERRAIN_TILE_TREE_SHOW_TILES&&(this._treeDebugger=new ib({view:ma}))}):cb||(this._treeDebugger=c.destroyMaybe(this._treeDebugger))},t.initial)]);var {spatialReference:Pa}=ma;this._extentHelper=W.create(this.viewingMode,{layers:ma.map.allLayers,layerViews:ma.allLayerViews,viewSpatialReference:Pa});const ca=new h({getCollections:()=>
ma.defaultsFromMap?.mapCollections?.map(({layers:cb})=>cb),getChildrenFunction:cb=>cb&&"layers"in cb?cb.layers:null});Pa=new pa.TilingSchemeLogic({layers:ca,extentHelper:this._extentHelper,viewingMode:this.viewingMode,viewSpatialReference:Pa});this._set("tilingSchemeLogic",Pa);this._updateTilingScheme();this._elevationDataRequester=za.createStreamDataRequester(K.ClientType.ELEVATION);this._mapDataRequester=za.createStreamDataRequester(K.ClientType.BASEMAP);this._frameTask=za.scheduler.registerTask(Ba.TaskPriority.TERRAIN_SURFACE,
this);this.addHandles([t.watch(()=>this._extentHelper.stencilEnabledExtents,cb=>this._renderer.setStencilEnabledLayerExtents(cb),t.initial),t.watch(()=>this.tilingSchemeLogic.tilingScheme,()=>this._updateTilingScheme(),t.sync),t.watch(()=>this.extent,()=>this._updateRootTiles(),t.initial),ma.on("resize",()=>this._viewChangeUpdate()),t.watch(()=>{const cb=ma.state;return[this._lodBias,this.lodSnappingEnabled,ma.quality,cb.camera,cb.contentCamera,cb.fixedContentCamera]},()=>this._viewChangeUpdate(),
t.syncAndInitial),t.watch(()=>ma.qualitySettings?.fadeDuration,cb=>this._renderer.textureFadingEnabled=0<cb,t.initial),t.watch(()=>ma.qualitySettings?.physicallyBasedRenderingEnabled,cb=>this._renderer.pbrMode=cb?sa.PBRMode.Simplified:sa.PBRMode.Disabled,t.initial),t.watch(()=>ma.qualitySettings?.tiledSurface.elevationLevelDelta,()=>this._updateAllTileGeometries()),t.watch(()=>this._userClippingExtent,()=>this._updateClippingExtent(),t.sync)]);this.addHandles(ma.allLayerViews.on("after-changes",()=>
this._layerViewsDirty=!0));this._layerViewsDirty=!0;this._handleLayerViewChanges();this._renderer.updateTileBackground(this.backgroundColor)}destroy(){this._destroying=!0;this._frameTask.remove();this._watchUpdatingTracking.destroy();this._removeAllTiles();this._set("tilingSchemeLogic",c.destroyMaybe(this.tilingSchemeLogic));this._basemapLayerViewHandles.forEach((ma,za)=>this._unregisterTiledLayerView(za));this._mapDataRequester=this._elevationDataRequester=null;this._set("overlayManager",c.destroyMaybe(this.overlayManager));
this._tileCache=c.destroyMaybe(this._tileCache);ka.Tile.prune();this._treeDebugger=c.destroyMaybe(this._treeDebugger);this._renderer=c.destroyMaybe(this._renderer);this._iteratorPool=c.destroyMaybe(this._iteratorPool);this._upsampleMapCache=c.destroyMaybe(this._upsampleMapCache);this._elevationQueryCache=c.destroyMaybe(this._elevationQueryCache);this._set("view",null);this._extentHelper=c.destroyMaybe(this._extentHelper);this._upsampleInfoPool=c.destroyMaybe(this._upsampleInfoPool);ja.printAllocations()}get renderer(){return this._renderer}get frustum(){return this._frustum}get snapLevel(){if(this.lodSnappingEnabled){const {view:za,
tilingScheme:Na}=this;var ma=za.scale;if(Na&&ma){ma=Na.levelAtScale(ma)+za.qualitySettings.tiledSurface.lodBias;const Ra=Na.getMaxLod();return 0>=ma?null:Math.min(ma,Ra||Infinity)}}return null}get lodSnappingEnabled(){return this.view.qualitySettings.tiledSurface.reduceTileLevelDifferences}get upsampleInfoPool(){return this._upsampleInfoPool}get upsampleMapCache(){return this._upsampleMapCache}get elevationQueryCache(){return this._elevationQueryCache}get hasStencilEnabledExtents(){return 0<this._extentHelper.stencilEnabledExtents.length}get _userClippingExtent(){var {spatialReference:ma}=
this,{clippingArea:za}=this.view;if(null==za||null==ma)return null;const Na=E.create();ma=O.toBoundingRect(za,Na,ma)?Na:null;za=this._get("extent");return E.equals(ma,za)?za:ma}get rootTilesExtent(){return this._rootTilesExtent}get extent(){const ma=E.intersection(this.groundExtent,this._userClippingExtent,E.create()),za=this._get("extent");return E.equals(ma,za)?za:ma}get groundExtent(){return null!=this._tilingSchemeExtent?this._tilingSchemeExtent:this._rootTilesExtent}get _tilingSchemeExtent(){return this.tilingSchemeLogic?.extent}get updating(){this._hasPendingUpdates||
(this._maxNumUpdating=1);return!!((this.running||this._watchUpdatingTracking?.updating||0<this._asyncWorkItems)&&this.ready&&!this.suspended||this.overlayManager?.updating)}get running(){return(this._hasPendingUpdates||this._viewChanged||this._allTilesDirty||!this._allTilesSorted||this._layerViewsDirty||this._scaleRangeQueries.updating||this._frameTask.updating)&&this.ready&&!this.suspended}get updatingProgressValue(){this._maxNumUpdating=Math.max(this._pendingUpdates,this._maxNumUpdating);return 1-
this._pendingUpdates/this._maxNumUpdating}get baseOpacity(){return this.view?.map?.ground?.opacity??1}set baseOpacity(ma){this.view.map.ground.opacity=ma}get viewingMode(){return this.view.state.viewingMode}get ready(){return null!=this._rootTiles}set renderOrder(ma){this._renderer.renderOrder=ma;this._set("renderOrder",ma)}get rootTiles(){return this._rootTiles}get spatialReference(){return this.tilingScheme?.spatialReference??null}get backgroundColor(){return this.view?.map?.ground?.surfaceColor}set backgroundColor(ma){this.view.map.ground.surfaceColor=
ma}set slicePlaneEnabled(ma){this._renderer.slicePlaneEnabled=ma;this._set("slicePlaneEnabled",ma);this._evaluateTransparency()}get tilingSchemeLocked(){return this.tilingSchemeLogic?.tilingSchemeLocked??!1}get wireframe(){return this._renderer?.wireframe}set wireframe(ma){ma!==this._renderer.wireframe&&(this._renderer.wireframe=ma,this._updateAllTileGeometries())}get opaque(){return this._renderer.transparency===la.TransparencyMode.Opaque}set suspended(ma){this._set("suspended",ma);this._viewChangeUpdate()}get fadeDuration(){return this.view.qualitySettings.fadeDuration??
0}intersect(ma,za,Na,Ra){this._renderer.intersect(ma,za,Na,Ra)}getElevationLevelDelta(ma){return 4>ma?3:this.view.qualitySettings.tiledSurface.elevationLevelDelta}getElevation(ma,za,Na,Ra){const Pa=this._rootTiles;if(!Pa?.length||0===Pa[0].layerInfo[ba.LayerClass.ELEVATION].length)return null;let ca=this._elevationProjectorCache.get(Ra);void 0===ca&&(ca=A.getProjector(Ra,this._spatialReference)??null,this._elevationProjectorCache.set(Ra,ca));if(null==ca)return d.getLogger(this).error("TerrainSurface.getElevation(): could not project given point to tiling scheme coordinate system"),
null;ma=r.set($a,ma,za,Na);ca(ma,0,ma,0);return Ca(Pa,ma[0],ma[1])}getElevations(ma,za,Na){const Ra=this._rootTiles;var Pa=Ra?Ra[0].layerInfo[ba.LayerClass.ELEVATION].length:0;if(Ra?.length&&0!==Pa)for(Pa=0;Pa<za;++Pa){var ca=3*Pa;ca=Ca(Ra,ma[ca],ma[ca+1]);Na(Pa,ca)}else for(ma=0;ma<za;++ma)Na(ma,null)}getScale(ma){if(!this.tilingScheme)return null;if(!C.projectPointToVector(ma,$a,this.spatialReference))return d.getLogger(this).error("TerrainSurface.getScale(): could not project given point to tiling scheme coordinate system"),
null;ma=this._rootTiles;if(null!=ma)for(var za of ma)if(za?.containsPoint($a)){for(;za.children[0]&&!za.rendered;){ma=za.children[0].extent;let Na=0;$a[0]>ma[2]&&(Na+=1);$a[1]<ma[1]&&(Na+=2);za=za.children[Na]}return this._getLodBiasCorrectedScale(za.level)}return Infinity}_ensureSEBProject(ma){var za=this._sebProjectorMap.get(ma);if(za)return za;za=A.getProjector(ma,this._tilingSchemeSpatialReference,this._sebProjectorCache)??null;this._sebProjectorMap.set(ma,za);return za}getSphereElevationBounds(ma,
za){za=this._ensureSEBProject(za);if(null==za)return d.getLogger(this).error("TerrainSurface.getSphereElevationBounds(): could not project given point to tiling scheme coordinate system"),null;D.copy(ma,Wa);ma=D.getCenter(Wa);za(ma,0,ma,0);ma=new M.ElevationRange;var Na=this._rootTiles;if(null!=Na){za=[];for(var Ra of Na)za.push(Ra);for(Ra=0;Ra<za.length;){Na=za[Ra];++Ra;if(!E.intersectsSphere(Na.extent,Wa))continue;const Pa=Na.children;if(null==Pa[0]||Na.rendered)ma.expandElevationRangeValues(Na.elevationBoundsMin,
Na.elevationBoundsMax);else for(const ca of Pa)za.push(ca)}}return ma}getRootElevationBounds(){return new M.ElevationRange(this.rootTileElevationBounds.min,this.rootTileElevationBounds.max)}getLowerBoundRadius(){return Math.min((this._ellipsoid.radius+this.visibleElevationBounds.min)*this._radiusModifier,this._ellipsoid.radius)}getSphereScale(ma,za){if(!this.tilingScheme)return null;if(!C.projectPointToVector(ma,D.getCenter(Wa),this.spatialReference))return d.getLogger(this).error("TerrainSurface.getSphereScale(): could not project given point to tiling scheme coordinate system"),
null;Wa[3]=za;let Na=null;const Ra=Pa=>{if(Pa&&E.intersectsSphere(Pa.extent,Wa)){const ca=Pa.children;if(ca[0]&&!Pa.rendered)for(const cb of ca)Ra(cb);else Pa=this._getLodBiasCorrectedScale(Pa.level),Na=null==Na?Pa:Math.min(Na,Pa)}};ma=this._rootTiles;if(null!=ma)for(const Pa of ma)Ra(Pa);return Na}queryVisibleScaleRange(ma,za,Na,Ra){za=za?this.tilingScheme.levelAtScale(za):0;Na=Na?this.tilingScheme.levelAtScale(Na):Infinity;const Pa=this._lodBias;this._scaleRangeQueries.queryVisibleLevelRange(ma,
za+Pa,Na+Pa,Ra)}_evaluateTransparency(){var ma=this.baseOpacity;const za=this.overlayManager.renderer.isEmpty,Na=this._renderer.transparency;ma=this._allSurfaceLayersTransparent()?za?la.TransparencyMode.Invisible:la.TransparencyMode.InvisibleWithDraped:1<=ma&&!this.hasCompositeBlendMode&&!this._renderer.slicePlaneEnabled?la.TransparencyMode.Opaque:la.TransparencyMode.Transparent;this._renderer.transparency=ma;return Na!==ma}_updateTilingScheme(){const ma=this.tilingSchemeLogic.tilingScheme;if(ma!==
this.tilingScheme){ea.weakAssert(!!ma,"tiling scheme cannot be reset to undefined");this._isGlobal=!this.view?.state?.isLocal;this.tilingScheme&&this._removeAllTiles();var za=ma?.spatialReference??z.WebMercator;this._spatialReference=za;this._isWebMercatorOnPlateCarree=(this._isWebMercator=!!za?.isWebMercator)&&G.isPlateCarree(this.view?.renderSpatialReference);this._isGeographic=za?.isGeographic??!1;this._set("tilingScheme",ma);this._tilingSchemeSpatialReference=this.tilingScheme?.spatialReference;
this._sebProjectorMap.clear();this._updateClippingExtent();ma&&(this._updateTiledLayers(),this._renderer.setTileSize(ma.pixelSize),this.overlayManager.setSpatialReference(ma.spatialReference),this._updateRootTiles())}}_acquireTile(ma,za,Na,Ra){const Pa=this._tileCache.pop(Sa._tileMemcacheKey);return Pa?(Pa.init(ma,za,Na,Ra,this),Pa):new this._tileConstructor(ma,za,Na,Ra,this)}get updatingRootTiles(){return this._updatingRootTiles}_updateRootTiles(){const {extent:ma,tilingScheme:za}=this;if(za){var Na=
Ta,Ra=za.rootTilesInExtent(ma,Na,5*Z.maxRootTiles);if(null!=this._rootTiles){if(Ra.length>Z.maxRootTiles){d.getLogger(this).warn(Z.tooManyRootTilesAfterChangeError);return}const Pa=this._rootTiles.map(cb=>cb.lij),ca=p.difference(Pa,Ra,ka.lijEquals);this._updatingRootTiles=!0;if(0<ca.removed.length||0<ca.added.length){const cb=this._rootTiles.filter(ib=>-1<ca.removed.findIndex(nb=>ka.lijEquals(nb,ib.lij))?(this._purgeTile(ib),!1):!0);ca.added.forEach(ib=>cb.push(this._newRootTile(ib)));this._setRootTiles(cb)}}else this._updatingRootTiles=
!0,Ra.length>Z.maxRootTiles&&(d.getLogger(this).warn(Z.tooManyRootTilesForLayerError),Ra=za.rootTilesInExtent(ma,Na,Z.maxRootTiles)),this._setRootTiles(Ra.map(Pa=>this._newRootTile(Pa)));E.equals(Na,this._rootTilesExtent)||(this._rootTilesExtent=E.create(Na));this.renderer.visible=!0;this._viewChangeUpdate();this.overlayManager.setPlacementDirty();this.notifyChange("ready");this._updateAllTileGeometries();this._updatingRootTiles=!1;this.checkAllTilesWaterproofness()}}_updateAllTileGeometries(){const ma=
this._allTiles.filter(za=>za.loaded&&za.intersectsClippingArea);ma.sort(aa.compareTilesByLij);ma.forEach(za=>this._renderer.updateTileGeometryState(za));ma.forEach(za=>za.renderData.updateNeighborData());this._updateTilesGeometries(ma);this._pendingTilesToUpdate.clear()}_updateTilesGeometries(ma){if(0!==ma.length){ma.sort(aa.compareTilesByLij);var za=this.renderer;ma.forEach(Na=>za.updateGeometryIfNeeded(Na));ma.forEach(Na=>this._pendingTilesForElevationUpdateEvent.add(Na))}}_shouldSplit(ma){return ma.shouldSplit(this._splitLimits,
this._eyePosRenderSR,this.snapLevel)===X.TileUpdate.SPLIT}_newRootTile(ma){ma=this._acquireTile(0,ma[1],ma[2],null);this._shouldSplit(ma)&&ma.setPendingUpdate(X.TileUpdate.SPLIT);this._loadTile(ma);this._markTileToUpdate(ma);this._updateRootTileElevationBounds();return ma}_setRootTiles(ma){this._rootTiles=ma;this._allTiles.clear();if(null!=ma){const za=this._iteratorPool.acquire();for(za.reset(ma);!za.done;)this._allTiles.push(za.next());za.remove()}this._renderer.setRootTiles(this._rootTiles);this._updateTilesVisibility(ma)}_runViewChangeUpdateIfDirty(){this._viewChangeUpdateDirty&&
(this._viewChangeUpdateDirty=!1,this._viewChangeUpdate())}_viewChangeUpdate(){this.view&&!this.suspended&&this.tilingScheme&&this.renderer.visible&&(this._inFrameTask?this._viewChangeUpdateDirty=!0:(this._viewChangeUpdateDirty=!1,this._updateViewDependentParameters(),this._updateTilesVisibility(this._rootTiles)))}_updateClippingStatus(ma){ma.updateClippingStatus(this.extent)&&ma.resetPendingUpdate(X.TileUpdate.GEOMETRY)&&this._updateTileGeometryState(ma)}_updateTilesVisibility(ma){if(null!=ma){var za=
aa.hasLoadableSiblings(ma),Na=this.visibleElevationBounds,Ra=za?Na.min:Infinity;za=za?Na.max:-Infinity;var Pa=this.extent,ca=this.view.state.contentCamera.viewProjectionMatrix;this.setTileTreeDirty();var cb=this._iteratorPool.acquire();for(cb.reset(ma);!cb.done;)ma=cb.next(),ma.updateClippingStatus(Pa)&&ma.resetPendingUpdate(X.TileUpdate.GEOMETRY)&&this._updateTileGeometryState(ma),ma.computeVisibility(),ma.updateScreenDepth(ca),ma.renderData&&(Ra=Math.min(ma.elevationBoundsMin,Ra),za=Math.max(ma.elevationBoundsMax,
za));cb.remove();this._allTilesDirty=this._viewChanged=!0;this._updatePendingTileGeometries();isFinite(Ra)&&isFinite(za)&&(Na.min!==Ra||Na.max!==za)&&(this.visibleElevationBounds=new P.ElevationBounds(Ra,za))}}_updateRootTileElevationBounds(){let ma=Infinity,za=-Infinity;var Na=this._rootTiles;null!=Na&&Na.forEach(({elevationBoundsMin:Ra,elevationBoundsMax:Pa})=>{ma=Math.min(ma,Ra);za=Math.max(za,Pa)});Na=this.rootTileElevationBounds;if(Na.min!==ma||Na.max!==za)this.rootTileElevationBounds=new P.ElevationBounds(ma,
za)}_updateViewDependentParameters(){const {camera:ma,contentCamera:za}=this.view.state,Na=Math.tan(.5*za.fovX),Ra=Math.tan(.5*za.fovY),Pa=this.tilingScheme.pixelSize,ca=2**-this._lodBias*ma.pixelRatio;this._splitLimits.aboveGround=ma.aboveGround;this._splitLimits.fovX=Na;this._splitLimits.fovY=Ra;this._splitLimits.relativeWidthLimit=Pa/ma.width*this.maxTextureScale*ca;this._splitLimits.relativeHeightLimit=Pa/ma.height*this.maxTextureScale*ca;this._splitLimits.maxLod=this.tilingScheme.getMaxLod();
this._splitLimits.angledSplitBias=this.view.qualitySettings.tiledSurface.angledSplitBias;this._splitLimits.frustum=this.view.state.fixedContentCamera?F.copy(this._splitLimits.frustum??F.create(),za.frustum):null;F.copy(this._frustum,ma.frustum);r.copy(this._eyePosRenderSR,za.eye);H.projectVectorToVector(ma.eye,this.view.renderSpatialReference,this._eyePosSurfaceSR,this.spatialReference)}_updateTileGeometryState(ma){ma.updateVisibility();this._renderer.updateTileGeometryState(ma)&&this._markTileToUpdate(ma);
this._usedMemory=null}_markAllTileNeighborsForUpdate(ma){ma.forEachLoadedNeighbor(za=>{this._layerViews[ba.LayerClass.MAP].some(ea.isVectorTileLayerView)&&za.setPendingUpdate(X.TileUpdate.TEXTURE_FADING);this._pendingTilesToUpdate.add(za)})}_updateTileTexture(ma,za){const Na=ma.resetPendingUpdate(X.TileUpdate.TEXTURE_FADING)?X.TileUpdate.TEXTURE_FADING:ma.resetPendingUpdate(X.TileUpdate.TEXTURE_NOFADING)?X.TileUpdate.TEXTURE_NOFADING:!1;Na&&(this._renderer.updateTileTexture(ma,Na),this._usedMemory=
null,za.madeProgress())}_emitElevationUpdateEventForTiles(){if(this._shouldEmitChangeEvent){var ma=Da.extent;E.empty(ma);this._pendingTilesForElevationUpdateEvent.forEach(za=>E.expand(ma,za.extent,ma));this._pendingTilesForElevationUpdateEvent.clear();Da.spatialReference=this.spatialReference;this.emit("elevation-change",Da);this._shouldEmitChangeEvent=!1}}runTask(ma){this._handleLayerViewChanges(ma);this._frameTask.processQueue(ma);this.renderer.processScaleRangeQueries(this._scaleRangeQueries,ma);
this._inFrameTask=!0;this._pendingUpdates=0;this._hasPendingUpdates=!1;this._updateAllTilesStatus(ma);this._sortTiles(ma);const za=!this.view.state.fixedContentCamera;this._mergeAndSplit(ma,za);this._updateElevation(ma);this._updateTextures(ma);za||this._mergeAndSplit(ma,!0);this._inFrameTask=!1;this._runViewChangeUpdateIfDirty();this._updatePendingTileGeometries();this._emitElevationUpdateEventForTiles();ma.done&&ma.hasProgressed&&this.requestUpdate();this.notifyChange("updatingProgressValue");ea.enableTerrainInternalChecks&&
this._checkTileInvariant();if(!ma.hasProgressed)return Ia.Yield}_checkTileInvariant(){const ma=new Map;this._allTiles.forAll(za=>ma.set(za,new Set));this._allTiles.forAll(za=>{ea.weakAssert(za.rendered===za.leaf,` rendered ${za.rendered} != ${za.leaf} leaf`);if(!za.leaf){var Na=za.children.reduce((ca,cb)=>ca+(0===cb.unmergableChildCount&&0===cb.maxLevelDeltaNeighborCount?0:1),0);ea.weakAssert(za.unmergableChildCount===Na,` Tile[${za.lij.toString()}] unmergeable child count mismatch:`+` actual ${za.unmergableChildCount} vs ${Na}`);
if(za.hasPendingUpdate(X.TileUpdate.MERGE)){ea.weakAssert(!za.hasPendingUpdate(X.TileUpdate.SPLIT),"Tile can be both split and merge at the same time");for(var Ra of za.children)ea.weakAssert(Ra.leaf||Ra.hasPendingUpdate(X.TileUpdate.MERGE),"Child of tile to merge must also merge")}}for(Na=0;4>Na;++Na){if(za.rendered&&(Ra=za.renderData?.geometryState.edgePeerNeighbors[Na],null!=Ra)){var Pa=za.level-Ra.level<=Z.maxTileNeighborLevelDelta;Pa||(console.log(`tile level delta [${za.lij.toString()}] vs [${Ra.lij.toString()}] > ${Z.maxTileNeighborLevelDelta}  (edge[${Na}])`),
ea.weakAssert(Pa,`tile level delta [${za.level}] vs [${Ra.level}] > ${Z.maxTileNeighborLevelDelta}`));ea.weakAssert(za.level-Ra.level<=Z.maxTileNeighborLevelDelta,`Max tile lod delta exceeded: [${za.lij.toString()}] vs [${Ra.lij.toString()}]`)}Pa=za.level-Z.maxTileNeighborLevelDelta;Ra=za.findNeighborTile(ea.neighborEdgeIndices[Na],ca=>ca.leaf||ca.level===za.level);if(null!=Ra){if(za.leaf&&za.level>=Z.maxTileNeighborLevelDelta){let ca=Ra;for(;za.level-ca.level<Z.maxTileNeighborLevelDelta;)ca=ca.parent;
ka.lijEquals([Pa,za.lij[1]>>Z.maxTileNeighborLevelDelta,za.lij[2]>>Z.maxTileNeighborLevelDelta],ca.lij)||(Pa=ma.get(ca),ea.weakAssert(!Pa.has(za),"Cannot already have neighbor"),Pa.add(za))}ea.weakAssert(Ra.rendered||Ra.level===za.level,"Non-same-level-neighbor of rendered must be rendered");ea.weakAssert(za.level-Ra.level<=Z.maxTileNeighborLevelDelta,`Tile level delta [${za.level}] vs [${Ra.level}] > ${Z.maxTileNeighborLevelDelta}`)}}});this._allTiles.forAll(za=>{const Na=za.maxLevelDeltaNeighborCount,
Ra=ma.get(za);ea.weakAssert(Na===Ra.size,`Tile[${za.lij.toString()}] merge-blocker mismatch: actual ${Na} vs ${Ra.size}`)})}_updateAllTilesStatus(ma){if(this._viewChanged&&this._rootTiles&&!ma.done){this._viewChanged=!1;var za=new Va(this._allTiles.length);za.pushAll(this._rootTiles);var Na=this.snapLevel,Ra=this._splitLimits,Pa=this._eyePosRenderSR;this._allTiles.forAll(ib=>{ib.maxLevelDeltaNeighborCount=0;ib.unmergableChildCount=0});for(var ca=this.view.state.contentCamera.viewProjectionMatrix;!za.empty;){const ib=
za.pop();var cb=ib.parent;const nb=(cb=null!=cb&&cb.hasPendingUpdate(X.TileUpdate.MERGE))?X.TileUpdate.MERGE:ib.shouldSplit(Ra,Pa,Na),xb=nb===X.TileUpdate.SPLIT;ib.leaf?Ha(ib,xb):za.pushAll(ib.children);cb?(ib.resetPendingUpdate(X.TileUpdate.SPLIT),ib.leaf||ib.setPendingUpdate(X.TileUpdate.MERGE),this._updateClippingStatus(ib),ib.updateVisibility(),ib.updateScreenDepth(ca)):xb?(ib.resetPendingUpdate(X.TileUpdate.MERGE),ib.leaf&&ib.setPendingUpdate(X.TileUpdate.SPLIT)):(ib.resetPendingUpdate(X.TileUpdate.SPLIT)&&
ib.updateAgentSuspension(),nb===X.TileUpdate.ELEVATION&&ib.updateAgents(ba.LayerClass.ELEVATION),ib.leaf||(ib.setPendingUpdate(X.TileUpdate.MERGE),ib.resetPendingUpdate(X.TileUpdate.SPLIT)))}this.requestUpdate();!this._shortBatches&&this._oneBatchPerFrameTask||this._updatePendingTileGeometries();ma.madeProgress()}}_sortTiles(ma){ma.done||this._allTilesSorted||(aa.sortTilesByPOI(this._allTiles,this.view.pointsOfInterest.focus.renderLocation),this._allTilesSorted=!0,this._treeDebugger&&this._treeDebugger.update(),
ma.madeProgress())}_markTileToUpdate(ma){ea.internalAssert(ma.loaded);ma.intersectsClippingArea&&(this._pendingTilesToUpdate.add(ma),this._markAllTileNeighborsForUpdate(ma))}_updatePendingTileGeometries(){const ma=this._pendingTilesToUpdate,za=Array.from(ma.keys()).filter(Pa=>Pa.loaded&&Pa.intersectsClippingArea);if(0===za.length)ma.clear();else{var Na=(Pa,ca)=>{!ca?.loaded||!ca.intersectsClippingArea||ca.level<Pa.level||ma.has(ca)||(ma.add(ca),za.push(ca),ca.renderData.updateNeighborData())};za.sort(aa.compareTilesByLij);
var Ra=za.length;for(let Pa=0;Pa<Ra;++Pa){const ca=za[Pa];ea.internalAssert(ca.loaded);ea.internalAssert(ca.intersectsClippingArea);const cb=ca.renderData;cb.updateNeighborData();const ib=cb.dirtyEdgeResolutions,nb=cb.geometryState,xb=ya=>{const Ea=ea.neighborCornerIndices[ya];Na(ca,nb.cornerPeerNeighbors[ya]?.findCorner(ea.oppositeCorner(Ea),Qa=>Qa.loaded))};for(let ya=0;4>ya;++ya)if(ib&1<<ya){const Ea=cb.geometryState.edgePeerNeighbors[ya];Ea&&Ea?.level>=ca.level&&Ea.forAllSubtreeOnSide(ea.oppositeEdge(ea.neighborEdgeIndices[ya]),
Qa=>Qa.loaded&&Qa.intersectsClippingArea?(ea.internalAssert(ma.has(Qa)||0>aa.compareTilesByLij(ca,Qa)),Na(ca,Qa),!0):!1);xb((ya+1)%4);xb(ya)}}ma.clear();this._updateTilesGeometries(za);this._shouldEmitChangeEvent=!0;ea.enableTerrainInternalChecks&&ea.enableWaterproofTests&&this.checkAllTilesWaterproofness()}}_mergeAndSplit(ma,za){if(!this.suspended&&!ma.done&&this._allTilesDirty){this._allTilesDirty=!1;this.requestUpdate();for(var Na=!1,Ra=this.view.state.fixedContentCamera,Pa=!1;!ma.done;){Pa=!0;
let ca=!1;const cb=!this._allTiles.some(ib=>{if(!Na&&!Ra&&!ib.visible)return ma.done;var nb=ib;if(ib.hasPendingUpdate(X.TileUpdate.MERGE)){if(!za||0<ib.unmergableChildCount)return ma.done;for(ib.resetPendingUpdate(X.TileUpdate.MERGE);null!=nb.parent&&0===nb.parent.unmergableChildCount&&nb.parent.resetPendingUpdate(X.TileUpdate.MERGE);)nb=nb.parent;this._mergeTile(nb);ca=!0;ma.madeProgress()}else if(ib.resetPendingUpdate(X.TileUpdate.SPLIT)){nb=!0;const xb=ib.level;if(xb>=Z.maxTileNeighborLevelDelta){const ya=
Ea=>Ea.leaf||xb-Ea.level<Z.maxTileNeighborLevelDelta;for(let Ea=0;4>Ea;++Ea){const Qa=ib.findNeighborTile(ea.neighborEdgeIndices[Ea],ya);null!=Qa&&xb-Qa.level===Z.maxTileNeighborLevelDelta&&(nb=!1,ea.enableTerrainInternalChecks&&(ea.internalAssert(Qa.leaf),ea.internalAssert(Qa.hasPendingUpdate(X.TileUpdate.SPLIT))))}}nb?(this._splitTile(ib),ma.madeProgress(),ca=!0):ib.setPendingUpdate(X.TileUpdate.SPLIT)}return ma.done});ca&&(this._allTilesSorted=!1,this._allTilesDirty=!0,!this._oneBatchPerFrameTask&&
this._updatePendingTileGeometries());if(cb)if(!Na)Na=!0;else{if(!ca)break}else this._allTilesDirty=!0}Pa?ma.madeProgress():this._allTilesDirty=!0;!this._oneBatchPerFrameTask&&this._updatePendingTileGeometries();this._sortTiles(ma)}}_updateElevation(ma){ma.done||(this._allTiles.some(za=>{za.resetPendingUpdate(X.TileUpdate.GEOMETRY)&&(this._updateTileGeometryState(za),this._shortBatches&&this._updatePendingTileGeometries(),ma.madeProgress());return ma.done}),!this._oneBatchPerFrameTask&&this._updatePendingTileGeometries())}_updateTextures(ma){ma.done||
this._allTiles.some(za=>{this._updateTileTexture(za,ma);return ma.done})}_updateClippingExtent(){this.spatialReference&&(this.updateTileOverlayParams(xa.RenderRequestType.UPDATE),this.overlayManager.setPlacementDirty(),this._updateRootTiles())}get _lodBias(){return this.view.qualitySettings.tiledSurface.lodBias-(1-this.view.quality)*Z.maxMemoryLodBias}_getLodBiasCorrectedScale(ma){const za=this.tilingScheme.levels;ma=f.clamp(ma-this._lodBias,0,za.length-1);const Na=ma-Math.floor(ma);return za[Math.floor(ma)].scale*
(1-Na)+za[Math.ceil(ma)].scale*Na}_removeAllTiles(){null!=this._rootTiles&&(this._rootTiles.forEach(ma=>this._purgeTile(ma)),this._setRootTiles(null),this.notifyChange("ready"));this._allTiles.clear();this.renderer.visible=!1}_purgeSubtree(ma){const za=ma.children;za[0]&&(this._purgeTile(za[0]),this._purgeTile(za[1]),this._purgeTile(za[2]),this._purgeTile(za[3]),ma.clearChildren())}_purgeTile(ma){ma.leaf?Aa(ma):this._purgeSubtree(ma);this._allTiles.removeUnordered(ma);this._unloadTile(ma);ma.dispose();
this._tileCache.put(Sa._tileMemcacheKey,ma)}_unloadTile(ma){this._pendingTilesToUpdate.delete(ma);this._pendingTilesForElevationUpdateEvent.delete(ma);ma.unload(this._renderer)}_splitTile(ma){ea.weakAssert(ma.leaf,"Tile that is already split should not be split again!");ea.weakAssert(ma.rendered,"Tile marked to split is not rendered");Aa(ma);const za=ma.createChildren();this._allTiles.pushArray(za);ma.updateAgentSuspension();ea.weakAssert(ma.rendered,"parent should be rendered");za.forEach(Na=>this._loadTile(Na));
za.forEach(Na=>this._pendingTilesToUpdate.add(Na));this._unloadTile(ma);this._markAllTileNeighborsForUpdate(ma);this._emitTileScaleChange(ma,ma.level+1);this._allTilesDirty=!0;this._shortBatches&&this._updatePendingTileGeometries();za.forEach(Na=>Ha(Na,Na.hasPendingUpdate(X.TileUpdate.SPLIT)));++this._performanceInfo.numSplit}_emitTileScaleChange(ma,za=ma.level){La.spatialReference=this.spatialReference;La.extent=ma.extent;La.scale=this._getLodBiasCorrectedScale(za);this.emit("scale-change",La)}createTile(ma,
za,Na,Ra){ea.weakAssert(!!Ra,"createTile sanity check");ma=this._acquireTile(ma,za,Na,Ra);ma.updateClippingStatus(this.extent);ma.updateScreenDepth(this.view.state.contentCamera.viewProjectionMatrix);this._shouldSplit(ma)&&ma.setPendingUpdate(X.TileUpdate.SPLIT);return ma}get _shortBatches(){return this.view.state.mode!==ta.RenderState.IDLE}_mergeTile(ma){ea.weakAssert(!ma.hasPendingUpdate(X.TileUpdate.SPLIT),"_mergeTile sanity check");ea.weakAssert(!ma.leaf,"Cannot merge a leaf");ma.leaf||(this._purgeSubtree(ma),
ea.weakAssert(!ma.renderData,"_mergeTile sanity check"),this._loadTile(ma),this._markTileToUpdate(ma),this._emitTileScaleChange(ma),this._shortBatches&&this._updatePendingTileGeometries(),Ha(ma,!1),this._allTilesDirty=!0,++this._performanceInfo.numMerged)}_loadTile(ma){ma.load();this.requestUpdate();this._allTilesDirty=!0;this.overlayManager&&this.overlayManager.hasOverlays&&this.overlayManager.setTileParameters(ma)}_handleLayerViewChanges(ma=Ba.noBudget){if(this._layerViewsDirty){var za=this._layerViewsDirty=
!1,Na=new Set,Ra=-1;for(let ca=this.view.allLayerViews.length-1;0<=ca;ca--){var Pa=this.view.allLayerViews.items[ca];Na.add(Pa.uid);if(ea.isSurfaceLayerView(Pa)||ea.isGroupLayerView(Pa))if(this._basemapLayerViewHandles.has(Pa.uid)&&!ea.isGroupLayerView(Pa)){const cb=this._layerClassFromLayerView(Pa);Pa=this._getLayerIdxByUID(cb,Pa.uid);if(null!=Pa){if(Pa<Ra||null==Ra)za=!0;Ra=Pa}}else this._registerTiledLayerView(Pa),Pa.layer.loaded&&(za=!0)}this._basemapLayerViewHandles.forEach((ca,cb)=>{Na.has(cb)||
(this._unregisterTiledLayerView(cb),za=!0)});za&&this._updateTiledLayers();this.hasCompositeBlendMode=this._hasCompositeBlendMode();this._evaluateTransparency();ma.madeProgress()}}_allSurfaceLayersTransparent(){let ma=0===this.view.map?.ground?.opacity;for(const za of this.view.allLayerViews.items)if(ea.isMapTileLayerView(za)&&!J.isBaseLayer(za.layer)&&0!==za.fullOpacity){ma=!1;break}return ma}_hasCompositeBlendMode(){for(const ma of this.view.allLayerViews.items)if((ea.isBlendableLayerView(ma)||
ea.isGroupLayerView(ma))&&qa.isCompositeBlendMode(qa.blendModeFromString[ma.layer.blendMode]))return!0;return!1}_layerClassFromLayerView(ma){return ea.isElevationLayerView(ma)?ba.LayerClass.ELEVATION:ba.LayerClass.MAP}_registerTiledLayerView(ma){const za=[];(ea.isBlendableLayerView(ma)||ea.isGroupLayerView(ma))&&za.push(t.watch(()=>ma.layer.blendMode,()=>{this.hasCompositeBlendMode=this._hasCompositeBlendMode();this._updateTileTextures(V.TextureUpdate.UNFADED)}));if(!ea.isGroupLayerView(ma)){const Na=
this._layerClassFromLayerView(ma);za.push(t.watch(()=>ma.suspended,()=>this._updateTiledLayers()));za.push(t.watch(()=>ma.fullOpacity,()=>this._updateTileTextures(V.TextureUpdate.UNFADED)));za.push(t.watch(()=>"effectiveScaleRange"in ma.layer?ma.layer.effectiveScaleRange:null,()=>this._restartAllAgents(Na)));za.push(ma.on("data-changed",()=>{const Ra=this._getLayerIdxByUID(Na,ma.uid);null!=Ra&&this._invalidateLayerData(Ra,Na)}))}this._unregisterTiledLayerView(ma.uid);this._basemapLayerViewHandles.set(ma.uid,
za)}_unregisterTiledLayerView(ma){const za=this._basemapLayerViewHandles.get(ma);if(za){for(const Na of za)Na.remove();this._basemapLayerViewHandles.delete(ma)}}_updateTiledLayers(){if(this.tilingScheme&&!this.view.suspended){var ma=[[],[]],za=null;this.view.allLayerViews.forEach(Ra=>{if(Ra.layer&&!Ra.suspended&&ea.isSurfaceLayerView(Ra)&&Ra.fullExtent){var Pa=this._layerClassFromLayerView(Ra);if(Pa===ba.LayerClass.MAP){const ca=Ra.displayLevelRange.maxLevel;Infinity!==ca&&(null===za||ca>za)&&(za=
ca)}ma[Pa].push(Ra)}});for(const Ra of ba.LayerClasses){var Na=this._layerViews[Ra];const Pa=ma[Ra];Pa.reverse();const ca=Pa.length;let cb=Na.length!==ca;const ib=Array(ca),nb=Array(Na.length);this._layerIndexByUid[Ra].clear();for(let xb=0;xb<ca;xb++){this._layerIndexByUid[Ra].set(Pa[xb].uid,xb);const ya=Na.indexOf(Pa[xb]);ib[xb]=ya;xb!==ya&&(cb=!0);-1<ya&&(nb[ya]=xb)}if(cb){Na=this._postorderIterator;for(Na.reset(this._rootTiles);!Na.done;)Na.next().modifyLayers(nb,ib,Ra);this._layerViews[Ra]=Pa;
this._restartAllAgents(Ra);this._updateTilesVisibility(this._rootTiles)}}this.tilingScheme.ensureMaxLod(za)&&(this._viewChangeUpdate(),this.notifyChange("tilingScheme"))}}_restartAllAgents(ma){const za=this._postorderIterator;for(za.reset(this._rootTiles);!za.done;){const Na=za.next();Na.restartAgents(ma);ma===ba.LayerClass.ELEVATION&&Na.computeElevationBounds()}this._updateRootTileElevationBounds()}layerViewByIndex(ma,za){return this._layerViews[za][ma]}numLayers(ma){return this._layerViews[ma].length}_updateTileTextures(ma){this._allTiles.forAll(za=>
{za.updateAgents(ba.LayerClass.MAP);ma===V.TextureUpdate.IMMEDIATE?this.renderer.updateTileTexture(za,X.TileUpdate.TEXTURE_NOFADING):za.updateRenderData(ba.LayerClass.MAP,ma)});this._evaluateTransparency()}_invalidateLayerData(ma,za){this._allTiles.forAll(Na=>Na.removeLayerAgent(ma,za));this._allTiles.forAll(Na=>Na.invalidateLayerData(ma,za))}setTileTreeDirty(){this._allTilesDirty=!0}requestRender(ma=xa.RenderRequestType.UPDATE){this.renderer.setNeedsRender(ma)}requestUpdate(){1===++this._pendingUpdates&&
(this._hasPendingUpdates=!0)}requestTileData(ma,za,Na,Ra){const Pa=this.layerViewByIndex(za,Na);za=Pa.layer;if(!za.tilemapCache||ea.isVectorTileLayerView(Pa))return this._requestTileData(ma,Na,Pa,Ra);++this._asyncWorkItems;return za.tilemapCache.fetchAvailability(ma.lij[0],ma.lij[1],ma.lij[2],{...Ra,timeout:6E3}).then(()=>--this._asyncWorkItems).catch(ca=>{--this._asyncWorkItems;u.throwIfAborted(Ra);u.isAbortError(ca)||this._dataMissing(ma,Na,Pa);throw ca;}).then(()=>this._frameTask.schedule(()=>
this._requestTileData(ma,Na,Pa,Ra),Ra.signal))}_requestTileData(ma,za,Na,Ra){if(this._destroying)return Promise.resolve();za=za===ba.LayerClass.ELEVATION;Ra.requester??(Ra.requester=za?this._elevationDataRequester:this._mapDataRequester);return za?ea.isElevationLayerView(Na)?this._requestElevationTileData(ma,Na,Ra):Promise.reject():ea.isMapTileLayerView(Na)?this._requestMapTileData(ma,Na,Ra):Promise.reject()}_requestElevationTileData(ma,za,Na){++this._asyncWorkItems;const Ra=Pa=>{!u.isAborted(Na)&&
Pa&&(this._usedMemory=null,this.requestUpdate(),this._elevationDataArrived(ma,za,Pa))};return za.fetchTile(ma.lij,Na).then(Pa=>this._frameTask.schedule(()=>Ra(Pa)),Pa=>{u.isAbortError(Pa)||(d.getLogger(this).error(`Tile ${ma.lij.toString()} layer ${ba.LayerClass.ELEVATION}/${za.uid} error ${Pa}`),this._dataMissing(ma,ba.LayerClass.ELEVATION,za),this.requestUpdate())}).finally(()=>--this._asyncWorkItems)}_elevationDataArrived(ma,za,Na){za=this._layerIndexByUid[ba.LayerClass.ELEVATION].get(za.uid);
if(null==za)d.getLogger(this).warn("TerrainSurface: received data from unknown layer %d %s",ba.LayerClass.ELEVATION,ma.lij.toString());else{Na=new R.ElevationData(ma.lij,ma.extent,Na);ma.dataArrived(za,ba.LayerClass.ELEVATION,Na);Na=[ma];ma=ma.level;var Ra=this._iteratorPool.acquire();for(Ra.reset(Na);!Ra.done;){const Pa=Ra.next();Pa.findElevationBoundsForLayer(za,ma);Pa.computeElevationBounds()}0===ma&&this._updateRootTileElevationBounds();Ra.remove();this._updateTilesVisibility(Na)}}_requestMapTileData(ma,
za,Na){++this._asyncWorkItems;const Ra=(ca,cb)=>{ea.releaseTerrainData(cb);u.isAborted(Na)||(console.error(`Tile ${ma.lij.toString()} layer ${ba.LayerClass.MAP}/${za.uid} error ${ca}`),this._dataMissing(ma,ba.LayerClass.MAP,za),this.requestUpdate())},Pa=ca=>cb=>Ra(cb,ca);return za.fetchTile(ma.lij,Na).then(ca=>this._frameTask.schedule(()=>{this.requestUpdate();u.isAborted(Na)?ea.releaseTerrainData(ca):this._mapTileDataArrived(ma,za,ca)},Na.signal,Pa(ca)).catch(Pa(ca)),(ca,cb=null)=>this._frameTask.schedule(()=>
Ra(ca,cb))).finally(()=>--this._asyncWorkItems)}_mapTileDataArrived(ma,za,Na){za=this._getLayerIdxByUID(ba.LayerClass.MAP,za.uid);null==za?(ea.releaseTerrainData(Na),d.getLogger(this).warn("TerrainSurface: received data from unknown layer")):ma.dataArrived(za,ba.LayerClass.MAP,Na)}_getLayerIdxByUID(ma,za){return this._layerIndexByUid[ma].get(za)}_dataMissing(ma,za,Na){Na=this._getLayerIdxByUID(za,Na.uid);null!=Na?ma.dataMissing(Na,za):d.getLogger(this).warn("TerrainSurface: received data from unknown layer")}updateTileOverlayParams(ma){this._rootTiles&&
this.overlayManager&&(this._allTiles.forAll(za=>{za.renderData&&this.overlayManager.setTileParameters(za)}),this._renderer.setNeedsRender(ma))}get performanceInfo(){const ma=this._performanceInfo;ma.numNodes=this._allTiles.length;ma.numLeaves=ma.numVisible=ma.numRendered=ma.numLoadedPerLevel.length=ma.numRenderedPerLevel.length=0;this._allTiles.forAll(za=>{za.leaf&&ma.numLeaves++;const Na=za.level;za.renderData&&(ma.numLoadedPerLevel[Na]=(ma.numLoadedPerLevel[Na]||0)+1);za.visible&&(ma.numVisible++,
za.rendered&&(ma.numRenderedPerLevel[Na]=(ma.numRenderedPerLevel[Na]||0)+1,ma.numRendered++))});return ma}get usedMemory(){if(!this.tilingScheme)return 0;null==this._usedMemory&&(this._usedMemory=this._recalculateUsedMemory());return this._usedMemory??0}_recalculateUsedMemory(){return this.tilingScheme?Math.round(this._allTiles.reduce((ma,za)=>ma+za.usedMemory,0)):null}getUsedMemoryForLayerView(ma){let za=0;const Na=this._layerClassFromLayerView(ma),Ra=this._getLayerIdxByUID(Na,ma.uid);null!=Ra&&
this._allTiles.forAll(Pa=>za+=Pa.getUsedMemoryForLayer(Na,Ra));return za}getTile(ma){if(null==ma||null==this._rootTiles)return null;const za=ma.split("/").map(ca=>+ca);if(0===za[0])return this._rootTiles.find(ca=>ca.lij[1]===za[1]&&ca.lij[2]===za[2]);ma=za[0];const Na=za[1]>>ma,Ra=za[2]>>ma;let Pa;this._rootTiles.some(ca=>ca.lij[1]===Na&&ca.lij[2]===Ra?(Pa=ca,!0):!1);if(Pa){for(ma=1<<za[0]-1;Pa.lij[0]<za[0];){let ca=za[1]&ma?2:0;0<(za[2]&ma)&&ca++;if(!Pa.children[ca])return null;Pa=Pa.children[ca];
ma>>=1}ea.weakAssert(Pa.lij[0]===za[0]&&Pa.lij[1]===za[1]&&Pa.lij[2]===za[2],"not the right tile?");return Pa}return null}get renderPatchBorders(){return this._renderer.renderPatchBorders}set renderPatchBorders(ma){this._renderer.renderPatchBorders=ma}get visualizeNormals(){return this._renderer.visualizeNormals}set visualizeNormals(ma){this._renderer.visualizeNormals=ma}get renderingDisabled(){return this._renderer.renderingDisabled}set renderingDisabled(ma){this._renderer.renderingDisabled=ma}get test(){}checkAllTilesWaterproofness(){if(ea.enableWaterproofTests){var ma=
this._rootTiles;if(null!=ma){var za=Pa=>0<Pa?.renderData?.geometry?.indices?.length,Na=Pa=>{if(Pa.intersectsClippingArea)if(Pa.renderData&&!Pa.renderData.geometryState&&console.error("Tile[",Pa.lij,"] has renderData but not geometryState"),Pa.renderData&&!Pa.renderData.geometry&&console.error("Tile[",Pa.lij,"] has renderData but not geometryInfo"),!Pa.renderData?.geometry||0<(Pa.renderData.geometry.indices?.length??0)||console.error("Tile[",Pa.lij,"] has renderData but no indices - geometryInfo: ",
Pa.renderData.geometry),za(Pa)){Pa.checkGeometryWaterproofness();for(const ib of Pa.children){var ca=ib,cb=Pa;za(ca)&&console.error("Tile[",ca.lij,"] has geometry although parent[",cb.lij,"] has geom")}}else if(Pa.leaf)console.error("Tile[",Pa.lij,"] has no geometry and no children, from root to leaf");else for(ca of Pa.children)Na(ca)},Ra=Pa=>{const ca=Pa.parent?.visible??!0,cb=Pa.visible;Pa.computeVisibility();const ib=Pa.visible;cb!==ib&&ca&&console.error(" Tile[",Pa.lij,"] has out of date visibility: ",
cb," instead of ",ib);if(!Pa.leaf)for(const nb of Pa.children)Ra(nb)};for(const Pa of ma)Na(Pa),Ra(Pa)}}}get isGlobal(){return this._isGlobal}get isGeographic(){return this._isGeographic}get isWebMercator(){return this._isWebMercator}get isWebMercatorOnPlateCarree(){return this._isWebMercatorOnPlateCarree}isEastEndWrap(ma){return this._isGlobal&&ma[2]===this.lijEastEnd(ma[0])-1}isWestEndWrap(ma){return this._isGlobal&&0===ma[2]}lijEastEnd(ma){return 1<<ma+(this._isGeographic?1:0)}wrapEastWest(ma){const za=
this.lijEastEnd(ma[0]),Na=ma[2];return 0<=Na&&Na<za?ma:this._isGlobal?[ma[0],ma[1],(Na+(0>Na?za:0))%za]:null}enableInternalChecks(ma){ea.enableInternalTerrainChecks(ma)}enableWaterproofnessChecks(ma){ea.enableTerrainWaterproofChecks(ma)}};k._tileMemcacheKey="TerrainTileMemcache";b.__decorate([m.property()],k.prototype,"_renderer",void 0);b.__decorate([m.property({constructOnly:!0})],k.prototype,"_scaleRangeQueries",void 0);b.__decorate([m.property({constructOnly:!0})],k.prototype,"view",void 0);b.__decorate([m.property({constructOnly:!0})],
k.prototype,"overlayManager",void 0);b.__decorate([m.property()],k.prototype,"_hasPendingUpdates",void 0);b.__decorate([m.property()],k.prototype,"_asyncWorkItems",void 0);b.__decorate([m.property()],k.prototype,"_allTilesDirty",void 0);b.__decorate([m.property()],k.prototype,"_allTilesSorted",void 0);b.__decorate([m.property()],k.prototype,"_viewChanged",void 0);b.__decorate([m.property({type:Number})],k.prototype,"heading",void 0);b.__decorate([m.property()],k.prototype,"_splitLimits",void 0);b.__decorate([m.property({readOnly:!0})],
k.prototype,"_watchUpdatingTracking",void 0);b.__decorate([m.property()],k.prototype,"_frameTask",void 0);b.__decorate([m.property({readOnly:!0})],k.prototype,"snapLevel",null);b.__decorate([m.property({readOnly:!0})],k.prototype,"lodSnappingEnabled",null);b.__decorate([m.property()],k.prototype,"_userClippingExtent",null);b.__decorate([m.property()],k.prototype,"_rootTilesExtent",void 0);b.__decorate([m.property({readOnly:!0})],k.prototype,"extent",null);b.__decorate([m.property({readOnly:!0})],
k.prototype,"groundExtent",null);b.__decorate([m.property({readOnly:!0})],k.prototype,"_tilingSchemeExtent",null);b.__decorate([m.property({readOnly:!0})],k.prototype,"updating",null);b.__decorate([m.property({readOnly:!0})],k.prototype,"running",null);b.__decorate([m.property(L.updatingProgress)],k.prototype,"updatingProgress",void 0);b.__decorate([m.property({readOnly:!0})],k.prototype,"updatingProgressValue",null);b.__decorate([m.property()],k.prototype,"_maxNumUpdating",void 0);b.__decorate([m.property()],
k.prototype,"baseOpacity",null);b.__decorate([m.property()],k.prototype,"hasCompositeBlendMode",void 0);b.__decorate([m.property({readOnly:!0})],k.prototype,"viewingMode",null);b.__decorate([m.property()],k.prototype,"maxTextureScale",void 0);b.__decorate([m.property({readOnly:!0})],k.prototype,"ready",null);b.__decorate([m.property({value:fa.RenderOrder.FRONT_TO_BACK})],k.prototype,"renderOrder",null);b.__decorate([m.property({readOnly:!0})],k.prototype,"rootTiles",null);b.__decorate([m.property()],
k.prototype,"_rootTiles",void 0);b.__decorate([m.property({readOnly:!0})],k.prototype,"spatialReference",null);b.__decorate([m.property({type:n})],k.prototype,"backgroundColor",null);b.__decorate([m.property({value:!1})],k.prototype,"slicePlaneEnabled",null);b.__decorate([m.property({readOnly:!0})],k.prototype,"tilingScheme",void 0);b.__decorate([m.property({readOnly:!0})],k.prototype,"tilingSchemeLocked",null);b.__decorate([m.property({readOnly:!0})],k.prototype,"tilingSchemeLogic",void 0);b.__decorate([m.property()],
k.prototype,"wireframe",null);b.__decorate([m.property({value:!1})],k.prototype,"suspended",null);b.__decorate([m.property()],k.prototype,"fadeDuration",null);b.__decorate([m.property()],k.prototype,"visibleElevationBounds",void 0);b.__decorate([m.property()],k.prototype,"rootTileElevationBounds",void 0);b.__decorate([m.property()],k.prototype,"_layerViewsDirty",void 0);b.__decorate([m.property()],k.prototype,"renderPatchBorders",null);b.__decorate([m.property()],k.prototype,"visualizeNormals",null);
b.__decorate([m.property()],k.prototype,"renderingDisabled",null);b=k=Sa=b.__decorate([q.subclass("esri.views.3d.terrain.TerrainSurface")],k);const $a=v.create(),Wa=D.create(),Ta=E.create();new x;const Da=new Q.ElevationUpdateEvent("ground"),La={spatialReference:null,extent:null,scale:0};class Va{constructor(ma){this.capacity=ma;this._tail=this._head=0;this._data=Array(ma)}push(ma){const za=this._tail;if(za<this.capacity)this._data[za]=ma,this._tail=za+1;else throw Error("Queue full");}pushAll(ma){const za=
ma.length;if(0!==za){var Na=this._tail;if(Na+za<=this.capacity){for(let Ra=0;Ra<za;++Ra)this._data[Na+Ra]=ma[Ra];this._tail=Na+za}else throw Error("Queue full");}}pop(){const ma=this._head;if(ma<this._tail){const za=this._data[ma];this._head=ma+1;return za}}get empty(){return this._head>=this._tail}get full(){return this._tail>=this._data.length}}return b})},"esri/core/MemCachePool":function(){define(["exports","./MemCache"],function(a,b){class n{constructor(k,p){this._cache=k(p,(h,e,g)=>{switch(e){case b.RemoveMode.ALL:return h.forEach(d=>
d.dispose()),0;case b.RemoveMode.SOME:if(h=h.shift())g-=Math.round(h.usedMemory),h.dispose();return g}})}hitrate(){return this._cache.hitRate}destroy(){this._cache.destroy()}clear(){this._cache.clear()}getSize(k){return this._cache.getSize(k)}pop(k){const p=this._cache.peek(k);if(p){var h=p.pop();if(0<p.length){if(h){const e=this._cache.getSize(k)-Math.round(h.usedMemory);this._cache.updateSize(k,p,e)}}else this._cache.pop(k);return h}}put(k,p,h=b.NoPriority){const e=this._cache.peek(k);e?(e.push(p),
p=this._cache.getSize(k)+Math.round(p.usedMemory),this._cache.updateSize(k,e,p)):this._cache.put(k,[p],p.usedMemory,h)}}a.MemCachePool=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/ElevationQueryTileCache":function(){define(["exports"],function(a){class b{constructor(n){this._store=n}destroy(){this._store.destroy()}get(n){return this._store.get(n)}put(n,k){this._store.put(n,k,k.values.byteLength+256)}}a.ElevationQueryTileCache=b;Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/views/3d/support/ElevationUpdateEvent":function(){define(["exports","../../../geometry/support/aaBoundingRect"],function(a,b){class n{constructor(k="scene"){this.context=k;this.extent=b.empty()}}a.ElevationUpdateEvent=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/updatingProperties":function(){define(["exports"],function(a){a.updatingProgress={readOnly:!0,value:.5,get(){return this.updating?this.updatingProgressValue:1}};a.updatingProgressValue=
{value:.5,readOnly:!0};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/ElevationBounds":function(){define(["exports"],function(a){class b{constructor(n=0,k=0){this.min=n;this.max=k;this.level=0;this.hasNoDataValues=!1}copyFrom(n){this.min=n.min;this.max=n.max;this.level=n.level;this.hasNoDataValues=n.hasNoDataValues}}a.ElevationBounds=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/ElevationData":function(){define(["exports",
"../../../core/mathUtils","../../../layers/support/ElevationSamplerData","../support/mathUtils","./TerrainConst"],function(a,b,n,k,p){class h{constructor(g,d,f){this.type="elevation";this.level=g[0];this.i=g[1];this.j=g[2];this.extent=d;this.samplerData=new n.ElevationSamplerData(f,d)}computeMinMaxValue(g,d,f,c){c.min=Infinity;c.max=-Infinity;c.hasNoDataValues=!1;g-=this.level;if(0>=g)return c;var l=2**g;if(Math.floor(d/l)!==this.i||Math.floor(f/l)!==this.j)return c;var w=Infinity,x=-Infinity,u=this.samplerData.data.width,
t=this.samplerData.data.values,m=.5*p.elevationNoDataValue;g=(u-1)/l;f=(f-this.j*l)*g;let q=(d-this.i*l)*g;if(1>g){const y=Math.floor(f),B=Math.floor(q);var r=y+B*u;d=t[r];l=t[r+1];var v=t[r+u];r=t[r+u+1];if(d+l+v+r<m)return w=f-y,m=q-B,x=k.bilerp(d,l,v,r,w,m),u=k.bilerp(d,l,v,r,w+g,m),t=k.bilerp(d,l,v,r,w,m+g),g=k.bilerp(d,l,v,r,w+g,m+g),c.min=Math.min(x,u,t,g),c.max=Math.max(x,u,t,g),c;f=y;q=B;g=1}else f=Math.floor(f),q=Math.floor(q),g=Math.ceil(g);for(d=f;d<=f+g;d++)for(l=q;l<=q+g;l++)v=t[d+l*
u],v<m?(w=Math.min(w,v),x=Math.max(x,v)):c.hasNoDataValues=!0;c.min=w;c.max=x;return c}}const e=.5*p.elevationNoDataValue;a.ElevationData=h;a.sampleElevation=function(g,d,f){if(null==f)return null;for(const u of f){if(!u)continue;var c=u.safeWidth;f=b.clamp(u.dy*(u.y1-d),0,c);c=b.clamp(u.dx*(g-u.x0),0,c);const t=Math.floor(f),m=Math.floor(c);var l=u.data.width,w=t*l+m,x=u.data.values;const q=x[w],r=x[w+1];w+=l;l=x[w];x=x[w+1];if(q+l+r+x<e)return f-=t,c-=m,g=q+(r-q)*c,g+(l+(x-l)*c-g)*f}return null};
Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/ElevationSamplerData":function(){define(["exports"],function(a){class b{constructor(n,k){this.data=n;this.safeWidth=.99999999*(n.width-1);this.dx=(n.width-1)/(k[2]-k[0]);this.dy=(n.width-1)/(k[3]-k[1]);this.x0=k[0];this.y1=k[3]}}a.ElevationSamplerData=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/ExtentHelper":function(){define("exports ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ../../../geometry/projection ../../../geometry/support/aaBoundingRect ../../../layers/support/layerUtils ../../ViewingMode ./TerrainConst ./terrainUtils".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w,x){function u(q,r){return null==q||q.spatialReference.equals(r)?q:d.projectWithoutEngine(q,q.spatialReference,r)}a.ExtentHelper=class extends n{constructor(q){super(q)}initialize(){this.addHandles([this.layerViews.on("change",()=>this.notifyChange("stencilEnabledExtents"))])}destroy(){}get layerViewsExtent(){return this._computeLayerViewsExtent()}get tiledLayersExtent(){return this._computeTiledLayersExtent()}get stencilEnabledExtents(){return this._computeStencilEnabledExtents()}_computeStencilEnabledExtents(){const q=
[];this.layerViews.forEach(r=>{r=r.layer;"operationalLayerType"in r&&c.isIntegratedMeshOperationalLayer(r.operationalLayerType)&&null!=this.viewSpatialReference&&(r=u(r.fullExtent,this.viewSpatialReference),null!=r&&q.push(f.fromExtent(r)))});return q}};b.__decorate([k.property({readOnly:!0})],a.ExtentHelper.prototype,"layerViewsExtent",null);b.__decorate([k.property({readOnly:!0})],a.ExtentHelper.prototype,"tiledLayersExtent",null);b.__decorate([k.property({readOnly:!0})],a.ExtentHelper.prototype,
"stencilEnabledExtents",null);b.__decorate([k.property()],a.ExtentHelper.prototype,"viewSpatialReference",void 0);b.__decorate([k.property()],a.ExtentHelper.prototype,"tilingScheme",void 0);b.__decorate([k.property()],a.ExtentHelper.prototype,"defaultTiledLayersExtent",void 0);b.__decorate([k.property({constructOnly:!0})],a.ExtentHelper.prototype,"layers",void 0);b.__decorate([k.property({constructOnly:!0})],a.ExtentHelper.prototype,"layerViews",void 0);a.ExtentHelper=b.__decorate([g.subclass("esri.views.3d.terrain.ExtentHelper")],
a.ExtentHelper);let t=class extends a.ExtentHelper{_computeLayerViewsExtent(){return this._globalExtent}_computeTiledLayersExtent(){return this._globalExtent}get _globalExtent(){return this.viewSpatialReference.isWebMercator?w.webMercatorWorldExtent:w.geographicWorldExtent}};t=b.__decorate([g.subclass("esri.views.3d.terrain.ExtentHelper.ExtentHelperGlobal")],t);let m=class extends a.ExtentHelper{_computeLayerViewsExtent(){const q=f.empty(),r=this.viewSpatialReference;this.layerViews.forEach(B=>{const z=
B.layer;!B.isResolved()||"graphics"===z.type&&z.internal||(B=u("fullExtentInLocalViewSpatialReference"in B&&B.fullExtentInLocalViewSpatialReference||B.layer.fullExtent,r),f.expand(q,B,q))});const v=f.allFinite(q)?q:null,y=this._get("layerViewsExtent");return f.equals(v,y)?y:v}_computeTiledLayersExtent(){const q=this.tilingScheme;if(!q)return null;const r=this.viewSpatialReference,v=f.empty();this.layers.forEach(z=>{if(z.loaded&&c.isTiledLayer(z)){var A=x.getTiledLayerInfo(z,r,l.ViewingMode.Local);
if(null!=A){var {tileInfo:C,fullExtent:H}=A;A="tilemapCache"in z?z.tilemapCache?.effectiveMaxLOD:void 0;null!=C&&null!=H&&(x.isProjectableRasterLayer(z)||q.compatibleWith(C,A)&&H.spatialReference.equals(q.spatialReference))&&f.expand(v,H,v)}}});f.expand(v,this.defaultTiledLayersExtent,v);const y=f.allFinite(v)?v:null,B=this._get("tiledLayersExtent");return f.equals(y,B)?B:y}};m=b.__decorate([g.subclass("esri.views.3d.terrain.ExtentHelper.ExtentHelperLocal")],m);a.create=function(q,r){return q===l.ViewingMode.Global?
new t(r):new m(r)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/terrainUtils":function(){define("exports ../../../core/Collection ../../../geometry/support/spatialReferenceUtils ../../../layers/support/layerUtils ../../ViewingMode ./NeighborIndex ./TerrainData ../../../chunks/terrainUtilsPlanar ../../../chunks/terrainUtilsSpherical".split(" "),function(a,b,n,k,p,h,e,g,d){function f(z){return"imagery-tile"===z?.type||"wcs"===z?.type}function c(z){return"imagery-tile-3d"===
z?.type}function l(z){return"tile-3d"===z?.type}function w(z){return"vector-tile-3d"===z?.type}function x(z){return"wmts-3d"===z?.type}function u(z){return"elevation-3d"===z?.type}function t(z){return z&&(l(z)||c(z)||w(z)||x(z))}function m(z){return e.isVectorTile(z?.data)}function q(z,A,C,H,E){return y[H].checkIfTileInfoSupportedForViewSR(z,C,A,E)}function r(z,A,C){z=k.getTileMaxtrixSetFromActiveLayer(z);if(null!=z)if(b.isCollection(z)){if(z=z.find(H=>null==q(H.tileInfo,H.fullExtent,A,C)))return{tileInfo:z.tileInfo,
fullExtent:z.fullExtent}}else return{tileInfo:z.tileInfo,fullExtent:z.fullExtent};return{tileInfo:null,fullExtent:null}}function v(z){return z.isWGS84||z.isWebMercator||n.isCGCS2000(z)||!n.isEarth(z)}const y={[p.ViewingMode.Global]:d.terrainUtilsSpherical,[p.ViewingMode.Local]:g.terrainUtilsPlanar};a.enableTerrainInternalChecks=!1;a.enableWaterproofTests=!1;const B={force512VTL:!1};g=[h.NeighborIndex.NORTH,h.NeighborIndex.EAST,h.NeighborIndex.SOUTH,h.NeighborIndex.WEST];d=[h.NeighborIndex.NORTH_EAST,
h.NeighborIndex.SOUTH_EAST,h.NeighborIndex.SOUTH_WEST,h.NeighborIndex.NORTH_WEST];a.almostEquals=function(z,A,C=1E-5){return Math.abs(z-A)<C};a.checkIfTileInfoSupportedForView=q;a.enableInternalTerrainChecks=function(z){a.enableTerrainInternalChecks=z};a.enableTerrainWaterproofChecks=function(z){a.enableWaterproofTests=z;a.enableTerrainInternalChecks=a.enableTerrainInternalChecks||z};a.eps=1E-5;a.getTileInfoAndExtentFromWMTSLayer=r;a.getTiledLayerInfo=function(z,A,C){var H=null,E=null;"wmts"===z?.type?
(E=r(z,A,C),H=E.tileInfo,E=E.fullExtent):(E=f(z)?z.getCompatibleFullExtent(A):z.fullExtent,H=C===p.ViewingMode.Local,H=f(z)?z.getCompatibleTileInfo(A,E,H):"vector-tile"===z?.type?H&&!v(A)||B.force512VTL?z.tileInfo:z.tileInfo.getCompatibleForVTL(256):z.tileInfo);z="tilemapCache"in z?z.tilemapCache?.effectiveMaxLOD:void 0;return null!=H&&null!=E&&null==q(H,E,A,C,z)?{tileInfo:H,fullExtent:E}:null};a.internalAssert=function(z,A){if(a.enableTerrainInternalChecks&&!z)throw z=Error().stack?.slice(5),console.warn("Terrain internal: "+
(A??"")+" at "+z),Error("Assertion failed"+(A?": "+A:""));};a.isBlendableLayerView=function(z){return z&&(l(z)||x(z)||c(z)||w(z))};a.isEast=function(z){return z===h.NeighborIndex.NORTH_EAST||z===h.NeighborIndex.EAST||z===h.NeighborIndex.SOUTH_EAST};a.isElevationLayer=function(z){return"elevation"===z?.type};a.isElevationLayerView=u;a.isGroupLayerView=function(z){return"group"===z?.type};a.isImageSourceRenderInfo=function(z){z=z?.sourceLayerInfo?.data;return e.isImageWithType(z)||z instanceof HTMLImageElement||
z instanceof HTMLCanvasElement||z instanceof ImageData};a.isImageryTileLayerView=c;a.isImageryTileRenderInfo=function(z){return e.isRasterTile(z?.sourceLayerInfo?.data)};a.isMapTileLayerView=t;a.isNorth=function(z){return z===h.NeighborIndex.NORTH_EAST||z===h.NeighborIndex.NORTH||z===h.NeighborIndex.NORTH_WEST};a.isNorthCorner=function(z){return z===h.NeighborIndex.NORTH_WEST||z===h.NeighborIndex.NORTH_EAST};a.isProjectableRasterLayer=f;a.isSouth=function(z){return z===h.NeighborIndex.SOUTH_EAST||
z===h.NeighborIndex.SOUTH||z===h.NeighborIndex.SOUTH_WEST};a.isSurfaceLayerView=function(z){return t(z)||u(z)};a.isTextureTileRenderInfo=function(z){return e.isTileTexture(z?.sourceLayerInfo?.data)};a.isTileLayerView=l;a.isVectorTileLayerView=w;a.isVectorTilePerLayerInfo=m;a.isVectorTileRenderInfo=function(z){return m(z?.sourceLayerInfo)||!!z?.isVTLBackground};a.isWMTSLayerView=x;a.isWest=function(z){return z===h.NeighborIndex.NORTH_WEST||z===h.NeighborIndex.WEST||z===h.NeighborIndex.SOUTH_WEST};
a.isWestCorner=function(z){return z===h.NeighborIndex.NORTH_WEST||z===h.NeighborIndex.SOUTH_WEST};a.lij2s=function(z){return"["+z[0]+","+z[1]+","+z[2]+"]"};a.neighborCornerIndices=d;a.neighborEdgeIndices=g;a.oppositeCorner=function(z){return z===h.NeighborIndex.NORTH_EAST?h.NeighborIndex.SOUTH_WEST:z===h.NeighborIndex.NORTH_WEST?h.NeighborIndex.SOUTH_EAST:z===h.NeighborIndex.SOUTH_WEST?h.NeighborIndex.NORTH_EAST:h.NeighborIndex.NORTH_WEST};a.oppositeEdge=function(z){return z===h.NeighborIndex.NORTH?
h.NeighborIndex.SOUTH:z===h.NeighborIndex.EAST?h.NeighborIndex.WEST:z===h.NeighborIndex.SOUTH?h.NeighborIndex.NORTH:h.NeighborIndex.EAST};a.releaseTerrainData=function(z){null!=z&&"release"in z&&z.release();return null};a.test=B;a.useFetchTileForLayer=function(z){return z.fetchTile&&!1!==z.hasOverriddenFetchTile};a.v32s=function(z){return"("+z[0]+","+z[1]+","+z[2]+")"};a.vtlAssumes256PixelSizeAsDefault=v;a.weakAssert=function(z,A){z||console.warn("Terrain: "+A)};Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/views/3d/terrain/NeighborIndex":function(){define(["exports"],function(a){a.NeighborIndex=void 0;var b=a.NeighborIndex||(a.NeighborIndex={});b[b.NORTH=0]="NORTH";b[b.NORTH_EAST=1]="NORTH_EAST";b[b.EAST=2]="EAST";b[b.SOUTH_EAST=3]="SOUTH_EAST";b[b.SOUTH=4]="SOUTH";b[b.SOUTH_WEST=5]="SOUTH_WEST";b[b.WEST=6]="WEST";b[b.NORTH_WEST=7]="NORTH_WEST";Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/terrainUtilsPlanar":function(){define("exports ../core/Error ./vec32 ../core/libs/gl-matrix-2/factories/vec3f64 ../geometry/support/aaBoundingRect ../views/3d/support/supportedSpatialReference ../views/3d/terrain/TerrainConst ../views/3d/terrain/TilingScheme".split(" "),
function(a,b,n,k,p,h,e,g){function d(m,q,r=0){m=m.extent;return null==m?!1:0===r?p.containsPoint(m,q):p.containsPointWithMargin(m,q,r*Math.min(m[2]-m[0],m[3]-m[1]))}function f(m,q,r,v){n.copy(w,r);w[v]=q[v];v=n.subtract(w,w,q);var y=n.subtract(x,m,q);y=n.dot(y,v);const B=n.dot(v,v);q=0>=y?q:B<=y?r:n.add(w,q,n.scale(v,v,y/B));m=n.subtract(w,m,q);return Math.PI/2-Math.atan(m[2]/Math.sqrt(m[0]*m[0]+m[1]*m[1]))}function c(m,q,r){m=m.extent;if(null==m)return 0;u[0]=m[0];u[1]=m[1];u[2]=r;t[0]=m[2];t[1]=
m[3];t[2]=r;m=r=Infinity;q[0]<u[0]?r=f(q,u,t,0):q[0]>t[0]&&(r=f(q,t,u,0));q[1]<u[1]?m=f(q,u,t,1):q[1]>t[1]&&(m=f(q,t,u,1));return Math.min(r,m)}function l(m,q,r,v){if(null==m)return g.getMissingTileInfoError();v=m.spatialReference;if(v.isGeographic&&!h.isSupportedEarthGCS(v))return new b("tilingscheme:local-unsupported-spatial-reference","The tiling scheme spatial reference is not supported in local scenes");var y=g.TilingScheme.checkUnsupported(m);if(null!=y)return y;if(null==r)return new b("tilingscheme:extent-not-exist",
"The layer does not provide a layer extent.");{var B=m.lods;y=B[0].resolution*2**B[0].level;var z=[y*m.size[0],y*m.size[1]];const A=[m.origin.x,m.origin.y];r=p.fromExtent(r);const C=p.create();g.TilingScheme.computeRowColExtent(r,z,A,C);z=(C[2]-C[0])*(C[3]-C[1]);z>e.maxRootTiles?(B=B[0].scale*2**B[0].level,m=Math.max((r[3]-r[1])/m.size[1],(r[2]-r[0])/m.size[0])*B/y,y=Math.floor(Math.log(m)/Math.log(10)),m=Math.ceil(m/10**y)*10**y,m=new b("tilingscheme:too-many-root-tiles","Scale of level 0 of the tiling scheme (1:"+
Math.floor(B).toLocaleString()+") is too large for the layer's extent. Suggested scale: 1:"+m.toLocaleString()+".",{level0Scale:B,suggestedLevel0Scale:m,requiredNumRootTiles:z,allowedNumRootTiles:e.maxRootTiles})):m=null}return m?m:null==q||v.equals(q)||q.isWGS84&&v.isWebMercator?null:new b("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the local scene")}const w=k.create(),x=k.create(),u=k.create(),t=k.create();k=Object.freeze(Object.defineProperty({__proto__:null,
checkIfTileInfoSupportedForViewSR:l,isInsideExtent:d,tiltToExtentEdge:c},Symbol.toStringTag,{value:"Module"}));a.checkIfTileInfoSupportedForViewSR=l;a.isInsideExtent=d;a.terrainUtilsPlanar=k;a.tiltToExtentEdge=c})},"esri/views/3d/support/supportedSpatialReference":function(){define(["exports","../../../geometry/support/spatialReferenceUtils"],function(a,b){function n(k){return b.isWGS84(k)||b.isCGCS2000(k)}a.isSupportedEarthGCS=n;a.isSupportedGCSOnGlobe=function(k){return n(k)||b.isMars(k)||b.isMoon(k)};
Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/terrainUtilsSpherical":function(){define(["exports","../core/Error","../views/3d/support/supportedSpatialReference","../views/3d/terrain/TilingScheme"],function(a,b,n,k){function p(){return!0}function h(){return 0}function e(d,f,c,l){if(null==d)return k.getMissingTileInfoError();c=d?.lods.length-1;const w=d.spatialReference;if(w.isWebMercator){if(!k.TilingScheme.makeWebMercatorAuxiliarySphere(c).compatibleWith(d,l))return new b("tilingscheme:incompatible-global-web-mercator",
"The tiling scheme is not compatible with the ArcGIS Online Web Mercator tiling scheme")}else if(n.isSupportedGCSOnGlobe(w)){if(!k.TilingScheme.makeGCSWithTileSize(d.spatialReference,d.size[0],c).compatibleWith(d,l))return d.spatialReference.isWGS84?new b("tilingscheme:incompatible-global-wgs84","The tiling scheme is not compatible with the ArcGIS Online WGS84 tiling scheme"):new b("tilingscheme:incompatible-global","The tiling scheme is not compatible with the ArcGIS Online tiling scheme")}else return new b("tilingscheme:global-unsupported-spatial-reference",
"The tiling scheme spatial reference is not supported in global scenes");return null==f||d.spatialReference.equals(f)?null:new b("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the global scene")}const g=Object.freeze(Object.defineProperty({__proto__:null,checkIfTileInfoSupportedForViewSR:e,isInsideExtent:p,tiltToExtentEdge:h},Symbol.toStringTag,{value:"Module"}));a.checkIfTileInfoSupportedForViewSR=e;a.isInsideExtent=p;a.terrainUtilsSpherical=
g;a.tiltToExtentEdge=h})},"esri/views/3d/terrain/interfaces":function(){define(["exports"],function(a){a.OverlayIndex=void 0;(function(b){b[b.INNER=0]="INNER";b[b.OUTER=1]="OUTER"})(a.OverlayIndex||(a.OverlayIndex={}));a.PatchType=void 0;(function(b){b[b.REGULAR=0]="REGULAR";b[b.HAS_NORTH_POLE=1]="HAS_NORTH_POLE";b[b.HAS_SOUTH_POLE=2]="HAS_SOUTH_POLE";b[b.HAS_BOTH_POLES=3]="HAS_BOTH_POLES"})(a.PatchType||(a.PatchType={}));a.TextureUpdate=void 0;(function(b){b[b.FADING=0]="FADING";b[b.IMMEDIATE=1]=
"IMMEDIATE";b[b.UNFADED=2]="UNFADED"})(a.TextureUpdate||(a.TextureUpdate={}));Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/OverlayManager":function(){define("exports ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/Cyclical ../../../core/has ../../../core/mathUtils ../../../core/maybe ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ../../../core/libs/gl-matrix-2/math/vec2 ../../../chunks/vec32 ../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../chunks/vec42 ../../../core/libs/gl-matrix-2/factories/vec4f64 ../../../geometry/ellipsoidUtils ../../../geometry/projection/projectVectorToVector ../../../geometry/support/aaBoundingRect ../../../geometry/support/ray ../../../chunks/sphere ../../../geometry/support/vector ../../../geometry/support/webMercatorUtils ../state/utils/viewUtils ../support/debugFlags ../support/debugUtils ./interfaces ./OverlayRenderer ../webgl-engine/lib/basicInterfaces ../webgl-engine/lib/Intersector ../webgl-engine/lib/LocalOriginFactory ../webgl-engine/lib/SortedRenderGeometryRenderer ../webgl-engine/lib/textureUtils ../webgl-engine/parts/renderUtils ../../support/Scheduler ../../support/Yield".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w,x,u,t,m,q,r,v,y,B,z,A,C,H,E,F,G,D,I,J,N,M,Q,O,K){const L=[[-.1,-2,3.9,2],[-.1,-3.9,3.9,.1],[-2,-3.9,2,.1],[-3.9,-3.9,.1,.1],[-3.9,-2,.1,2],[-3.9,-.1,.1,3.9],[-2,-.1,2,3.9],[-.1,-.1,3.9,3.9]];let P;a.OverlayManager=class extends n{constructor(T){super(T);this._renderSR=this._spatialReference=null;this._overlaySREqualsRenderSR=!0;this._drapeSources=new Set;this._drapeTargets=new Set;this._drawTexturesAnimateDirty=this._drawTexturesDirty=this._contentUpdated=this._placementDirty=
!1;this._longitudeCyclical=null;this._latestOriginId=0;this._maxResolution=p("esri-mobile")?2048:4096}initialize(){const T=this.view;this.renderer=new G.OverlayRenderer({view:T,worldToPCSRatio:this._worldToPCSRatio,spatialReference:this._spatialReference});T._stage.renderer.plugins.add(this.renderer);const S=()=>this.setDrawTexturesDirty();this._groundIntersector=I.newIntersector(this.view.state.viewingMode);this._groundIntersector.options.backfacesTerrain=!0;this._groundIntersector.options.invisibleTerrain=
!0;this._groundIntersector.options.hud=!1;this.addHandles([g.watch(()=>this.renderer.hasHighlights,S),this.renderer.events.on("has-water",()=>T._stage?.renderer.updateHasFlags()),this.renderer.events.on("content-changed",S),g.watch(()=>T.state.camera.pixelRatio,S),g.watch(()=>T.state.alignPixelEnabled,S),this.renderer.events.on("textures-disposed",()=>this.surface.requestRender()),g.watch(()=>[T.pointsOfInterest?.renderPointOfView,T.pointsOfInterest?.centerOnSurfaceFrequent?.location],()=>this.setPlacementDirty()),
g.watch(()=>[T.state?.pixelRatio,T.state?.contentPixelRatio],()=>this.setPlacementDirty(),g.sync),this.surface.on("elevation-change",()=>this.setPlacementDirty()),T.on("resize",()=>this.setPlacementDirty()),T.resourceController.scheduler.registerTask(O.TaskPriority.OVERLAY,this),T._stage.renderView.events.on("force-camera-for-screenshot",Z=>{this._updateOverlays(O.noBudget,Z.camera,D.RenderRequestType.BACKGROUND);this.renderer.hasOverlays&&this._drawOverlays(D.RenderRequestType.BACKGROUND,Z)})]);
T._stage.renderer.overlay=this}destroy(){this.view?._stage&&(this.view._stage.renderer.plugins.remove(this.renderer),this.view._stage.renderer.overlay=null);P&&(P.hide(),P=null);this.renderer=e.destroyMaybe(this.renderer)}get running(){return this._placementDirty&&(0<this._drapeSources.size||0<this.view.graphics.length||H.debugFlags.OVERLAY_DRAW_DEBUG_TEXTURE)&&!!this._spatialReference&&!this.suspended&&this.surface.ready}get _isSpherical(){return this.view.state.isGlobal}get _worldToPCSRatio(){return null!=
this._spatialReference&&this._spatialReference.isGeographic&&!this.view.state.isLocal?q.getReferenceEllipsoid(this._spatialReference).metersPerDegree:1}get _overlayStretch(){return 1.3/this.view.resolutionScale}get suspended(){return this.surface.suspended}get updating(){return this.running||this.renderer.updating||this._contentUpdated}get rendersOccludedDraped(){return this.renderer.rendersOccludedDraped}render(){this._contentUpdated=!1;this.renderer.processSyncDrapeSources();if(this.renderer.hasOverlays)return this._precompileShaders()?
this._drawOverlays(D.RenderRequestType.UPDATE):null}get hasOverlays(){return this.renderer.hasOverlays}setSpatialReference(T){this._spatialReference=T;this.renderer.spatialReference=T;this._longitudeCyclical=null;const S=this.view.renderSpatialReference;null!=T&&null!=S?(this._renderSR=S,this._overlaySREqualsRenderSR=T.equals(this._renderSR),this._isSpherical&&(this._longitudeCyclical=T.isWebMercator?new k.Cyclical(-2.0037508342787E7,2.0037508342787E7):new k.Cyclical(-180,180),this.renderer.longitudeCyclical=
this._longitudeCyclical),this.renderer&&(this.renderer.worldToPCSRatio=this._worldToPCSRatio)):this.renderer.disposeOverlays()}registerDrapeSource(T,S,Z){this._drapeSources.add(T);this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources);S=this.renderer.createDrapeSourceRenderer(T,S,Z);this._updateDrapeSourceExtent(T);this._setContentDirty();this.notifyChange("running");return S}registerGeometryDrapeSource(T){return this.registerDrapeSource(T,N.SortedRenderGeometryRenderer)}_updateDrapeSourceExtent(T){2===
this.renderer.overlays.length&&null!=T.setDrapingExtent&&null!=this._spatialReference&&T.setDrapingExtent(this.renderer.overlays,this._spatialReference)}unregisterDrapeSource(T){this._drapeSources.has(T)&&(this._drapeSources.delete(T),this.renderer.removeDrapeSourceRenderer(T),this.renderer.ensureDrapeSources(this._drapeSources),this._setContentDirty(),this.notifyChange("running"))}registerDrapeTarget(T){this._drapeTargets.add(T);this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources)}unregisterDrapeTarget(T){this._drapeTargets.delete(T);
this.renderer.ensureDrapeTargets(this._drapeTargets)}_setContentDirty(){this.setPlacementDirty();this.setDrawTexturesDirty()}setPlacementDirty(){this._placementDirty=!0}runTask(T){return this._updateOverlays(T,this.view.state.contentCamera,D.RenderRequestType.UPDATE)}_updateOverlays(T,S,Z){if(!this._spatialReference)return K.Yield;var ia=this._computeOverlayResolution(S);this._computeOverlayExtents(S,ia,ba);this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources,ba.stretch);S=this._updateOverlay(F.OverlayIndex.INNER,
ba.inner,ia,1*ba.pixelRatioAdjustment,ba.mapUnitsPerPixel);const Y=v.width(ba.inner)/v.width(ba.outer);ia=this._updateOverlay(F.OverlayIndex.OUTER,ba.outer,ia,Y*ba.pixelRatioAdjustment,ba.mapUnitsPerPixel);if(S===ha.EXTENT||ia===ha.EXTENT)this._drapeSources.forEach(ea=>this._updateDrapeSourceExtent(ea)),this.surface.updateTileOverlayParams(Z);S===ha.NONE&&ia===ha.NONE||this.setDrawTexturesDirty();this._placementDirty=!1;T.madeProgress()}_computeOverlayResolution(T){const S=this.view.state.contentPixelRatio*
this.view.resolutionScale;return Math.min(M.applyTextureResizeModulo(Math.ceil(1.5*Math.max(T.fullWidth/T.pixelRatio*S,T.fullHeight/T.pixelRatio*S))),this._maxResolution)}_updateOverlay(T,S,Z,ia,Y){if(0===this.renderer.overlays.length)return ha.NONE;T=this.renderer.overlays[T];const ea=T.mapUnitsPerPixel;T.mapUnitsPerPixel=Y;T.pixelRatio=ia;ia=T.extent;const ka=H.debugFlags.TESTS_DISABLE_OPTIMIZATIONS?0:1E-5*Math.max(S[2]-S[0],S[3]-S[1],ia[2]-ia[0],ia[3]-ia[1]);if(Math.abs(ia[0]-S[0])<=ka&&Math.abs(ia[1]-
S[1])<=ka&&Math.abs(ia[2]-S[2])<=ka&&Math.abs(ia[3]-S[3])<=ka&&Z===T.resolution)return ea===Y?ha.NONE:ha.RERENDER_ONLY;v.copy(T.extent,S);T.resolution=Z;S=v.center(T.extent);T.renderLocalOrigin=J.fromValues(S[0],S[1],0,`OV_${this._latestOriginId++}`);return ha.EXTENT}setTileParameters(T){const S=T.renderData.overlay;if(0<this.renderer.overlays.length){const Z=this.renderer.overlays[F.OverlayIndex.INNER],ia=this.renderer.overlays[F.OverlayIndex.OUTER];T=T.extent;this._rectInsideRect(Z.extent,T)||this._rectanglesOverlap(T,
Z.extent)||this._rectanglesOverlap(T,ia.extent)?(this._setTileOverlayData(T,F.OverlayIndex.INNER,S),this._setTileOverlayData(T,F.OverlayIndex.OUTER,S)):(this._clearTileOverlayData(F.OverlayIndex.INNER,S),this._clearTileOverlayData(F.OverlayIndex.OUTER,S))}else this._clearTileOverlayData(F.OverlayIndex.INNER,S),this._clearTileOverlayData(F.OverlayIndex.OUTER,S)}overlayPixelSizeInMapUnits(T,S){if(0===this.renderer.overlays.length)return S();S=this.renderer.overlays[F.OverlayIndex.INNER];const Z=this.renderer.overlays[F.OverlayIndex.OUTER];
T=this._pointIsInExtent(T,S.extent)?S:Z;return(T.extent[2]-T.extent[0])/T.resolution}_setTileOverlayData(T,S,Z){if(0!==this.renderer.overlays.length){var ia=this.renderer.overlays[S].extent,Y=v.width(ia),ea=v.height(ia),ka=T[0];if(this._longitudeCyclical){ka=this._longitudeCyclical.minimalMonotonic(ia[0],ka);const ja=this._longitudeCyclical.minimalMonotonic(ia[0],T[2]);ka>ja&&(ka=ja-(T[2]-T[0]))}Z.setScale(S,v.width(T)/Y,v.height(T)/ea);Z.setOffset(S,(ka-ia[0])/Y,(T[1]-ia[1])/ea)}}_clearTileOverlayData(T,
S){S.setScale(T,-1,-1);S.setOffset(T,-1,-1)}reloadShaders(){Q.removeLoadedShaderModules();this.setDrawTexturesDirty();this.runTask(O.noBudget)}updateAnimation(T){this.renderer.updateAnimation(T)&&(this._drawTexturesAnimateDirty=!0);return this._drawTexturesAnimateDirty}setDrawTexturesDirty(){this.renderer.hasOverlays?(this._drawTexturesDirty=this._contentUpdated=!0,this.view._stage.renderView.requestRender()):this.setPlacementDirty()}_intersectGroundFromView(T,S,Z,ia){Z=this.view.sceneIntersectionHelper.getCenterRayWithSubpixelOffset(T,
fa,S,Z);if(null==Z)return!1;S=Z.origin;Z=x.add(V,Z.origin,Z.direction);this._groundIntersector.reset(S,Z,T);this._groundIntersector.intersect([]);this.view.basemapTerrain.intersect(this._groundIntersector,null,S,Z);return this._groundIntersector.results.min.getIntersectionPoint(ia)}_findHorizonBasedPointOfInterest(T,S){var Z=.5;Z=this.view.renderCoordsHelper.getAltitude(T.eye);const ia=this.view.pointsOfInterest.centerOnSurfaceFrequent;var Y=h.clamp(ia.estimatedSurfaceAltitude,T.aboveGround?-Infinity:
Z+1E-5,T.aboveGround?Z-1E-5:Infinity);Z=T.aboveGround;if("global"===this.view.viewingMode){var ea=V;B.closestPointOnSilhouette(B.fromRadius(B.tmpSphere,q.getReferenceEllipsoid(this.view.spatialReference).radius+Y),y.wrap(T.eye,T.viewForward),ea);x.subtract(ea,ea,T.eye);Y=k.cyclicalPI.normalize(z.angleAroundAxis(T.viewForward,ea,T.viewRight))/T.fovY+.5;ea=0>=Y||1<=Y?.5:.55;Z=Z?ea*Y:Y+ea*(1-Y)}else Y=m.fromValues(0,Math.tan(.5*Math.PI-Math.acos(-T.viewForward[2])),1,0),Y=t.transformMat4(Y,Y,T.projectionMatrix)[1],
Y=h.clamp(.5+.5*Y,0,1),Z=1===Y||0===Y?.5:Z?.55*Y:1-.55*(1-Y);return this._intersectGroundFromView(T,.5,Z,S)?x.sqrDist(S,T.eye)<ia.distance*ia.distance:!1}_computeOverlayExtents(T,S,Z){var ia=this.view.pointsOfInterest.centerOnSurfaceFrequent.renderLocation;const Y=u.create();this._findHorizonBasedPointOfInterest(T,Y)||x.copy(Y,ia);H.debugFlags.OVERLAY_SHOW_CENTER?(null==P&&(P=new E.PointGraphics(this.view.graphics,"red")),P.show(Y,this._renderSR)):null!=P&&P.hide();var ea=Math.max(.1,x.distance(T.eye,
Y));const ka=C.viewAngle(this.view.renderCoordsHelper,ia,T.eye);this._overlaySREqualsRenderSR||r.projectVectorToVector(Y,this._renderSR,Y,this._spatialReference);ia=this.surface.extent;var ja=!this._isSpherical&&this._spatialReference?.isGeographic,X=ja&&this._spatialReference?1/q.getReferenceEllipsoid(this._spatialReference).metersPerDegree:1;ea=T.perScreenPixelRatio/this.view.state.contentPixelRatio*ea*X;Z.mapUnitsPerPixel=ea/this._worldToPCSRatio;Z.stretch=this._overlayStretch;ea=S*ea/2*Z.stretch;
var aa=!1;ja=ja?90:Infinity;this._isSpherical&&ia&&this._spatialReference&&(this._spatialReference.isWebMercator?(ea/=Math.cos(A.y2lat(Y[1])),ja=ia[3]):(aa=!0,ea/=q.getReferenceEllipsoid(this._spatialReference).metersPerDegree,ja=90),ea>=ja&&(ea=ja,Y[1]=0,this._spatialReference.isWebMercator&&(Y[0]=0)));X=1;aa&&(X=1/Math.max(.2,Math.cos(Math.abs(h.deg2rad(Y[1])))),180<ea*X&&(X=180/ea),Z.mapUnitsPerPixel*=X);aa=Math.log(2)/12;ea=Math.exp(Math.round(Math.log(ea)/aa)*aa);const pa=ea*X;aa=.5*S/(32*pa);
var la=.5*S/(32*ea);Y[0]=Math.round(Y[0]*aa)/aa;Y[1]=Math.round(Y[1]*la)/la;aa=Z.inner;aa[0]=Y[0]-pa;aa[1]=Y[1]-ea;aa[2]=Y[0]+pa;aa[3]=Y[1]+ea;this._isSpherical&&this._shiftExtentToFitBounds(aa,Infinity,ja);la=Z.outer;6*pa>v.width(ia)?v.copy(la,ia):Math.PI/2-Math.abs(ka-Math.PI/2)<=.25*Math.PI?(la[0]=aa[0]-pa,la[1]=aa[1]-ea,la[2]=aa[2]+pa,la[3]=aa[3]+ea):(r.projectVectorToVector(T.eye,this._renderSR,V,this._spatialReference),w.subtract(W,Y,V),T=-Math.atan2(W[1],W[0])+.125*Math.PI,0>T&&(T+=2*Math.PI),
t.scale(W,L[Math.floor(T/(.25*Math.PI))],2*ea),W[0]*=X,W[2]*=X,t.add(la,aa,W));this._isSpherical?(la[0]=this._longitudeCyclical.clamp(la[0]),la[2]=this._longitudeCyclical.clamp(la[2]),la[1]=Math.max(la[1],-ja),la[3]=Math.min(la[3],ja)):(T=v.intersection(aa,ia,U),ia=v.intersection(la,ia,da),v.contains(T,ia)&&(la[2]=la[0],la[3]=la[1]));S=Math.abs(aa[2]-aa[0])/S;Z.mapUnitsPerPixel=Math.max(Z.mapUnitsPerPixel,S);Z.pixelRatioAdjustment=Z.mapUnitsPerPixel/S}_precompileShaders(){if(!this.renderer.hasOverlays)return!1;
this.renderer.precompileShaders(this.view.state);return!0}_drawOverlays(T,S=this.view.state){if(!this._drawTexturesDirty&&!this._drawTexturesAnimateDirty)return this.renderer;const Z=this._drawTexturesDirty;this._drawTexturesDirty=this._drawTexturesAnimateDirty=!1;const ia=this.renderer.computeValidity();this.renderer.releaseRenderTargets();this.renderer.drawOverlays(S);S=this.renderer.computeValidity();ia!==S&&this.surface.updateTileOverlayParams(D.RenderRequestType.UPDATE);Z?(this.surface.requestRender(T),
T===D.RenderRequestType.UPDATE&&this.surface.requestUpdate()):this.surface.requestRender(D.RenderRequestType.BACKGROUND);return this.renderer}_rectanglesOverlap(T,S){return null==T?!1:this._longitudeCyclical?(this._longitudeCyclical.contains(S[0],S[2],T[0])||this._longitudeCyclical.contains(S[0],S[2],T[2])||this._longitudeCyclical.contains(T[0],T[2],S[0]))&&!(T[1]>S[3]||T[3]<S[1]):v.intersects(T,S)}_rectInsideRect(T,S){return null==S?!1:this._longitudeCyclical?this._longitudeCyclical.contains(T[0],
T[2],S[0])&&this._longitudeCyclical.contains(T[0],T[2],S[2])&&S[1]>T[1]&&S[3]<T[3]:v.contains(T,S)}_pointIsInExtent(T,S){if(this._longitudeCyclical)return this._longitudeCyclical.contains(S[0],S[2],T.x)&&T.y>=S[1]&&T.y<=S[3];const Z=T.x;T=T.y;return Z>S[0]&&Z<S[2]&&T>S[1]&&T<S[3]}_shiftExtentToFitBounds(T,S,Z){let ia=0,Y=0;T[0]<-S?ia=T[0]+S:T[2]>S&&(ia=S-T[2]);T[1]<-Z?Y=T[1]+Z:T[3]>Z&&(Y=Z-T[3]);v.offset(T,ia,Y)}get test(){}};b.__decorate([d.property()],a.OverlayManager.prototype,"_spatialReference",
void 0);b.__decorate([d.property({readOnly:!0})],a.OverlayManager.prototype,"running",null);b.__decorate([d.property()],a.OverlayManager.prototype,"_placementDirty",void 0);b.__decorate([d.property()],a.OverlayManager.prototype,"_contentUpdated",void 0);b.__decorate([d.property()],a.OverlayManager.prototype,"_isSpherical",null);b.__decorate([d.property()],a.OverlayManager.prototype,"_worldToPCSRatio",null);b.__decorate([d.property()],a.OverlayManager.prototype,"renderer",void 0);b.__decorate([d.property({constructOnly:!0})],
a.OverlayManager.prototype,"view",void 0);b.__decorate([d.property({constructOnly:!0})],a.OverlayManager.prototype,"surface",void 0);b.__decorate([d.property()],a.OverlayManager.prototype,"suspended",null);b.__decorate([d.property()],a.OverlayManager.prototype,"updating",null);b.__decorate([d.property({type:Boolean})],a.OverlayManager.prototype,"rendersOccludedDraped",null);a.OverlayManager=b.__decorate([l.subclass("esri.views.3d.terrain.OverlayManager")],a.OverlayManager);class R{constructor(){this.inner=
v.create();this.outer=v.create();this.mapUnitsPerPixel=0;this.pixelRatioAdjustment=1;this.stretch=1.3}}const W=m.create(),V=u.create(),ba=new R,U=v.create(),da=v.create(),fa=y.create();var ha;(function(T){T[T.NONE=0]="NONE";T[T.EXTENT=1]="EXTENT";T[T.RERENDER_ONLY=2]="RERENDER_ONLY"})(ha||={});Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/OverlayRenderer":function(){define("exports ../../../chunks/tslib.es6 ../../../core/Evented ../../../core/has ../../../core/MapUtils ../../../core/maybe ../../../core/PooledArray ../../../core/reactiveUtils ../../../core/SetUtils ../../../core/accessorSupport/decorators/property ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ../../../core/libs/gl-matrix-2/math/mat4 ../../../chunks/vec32 ../../../core/libs/gl-matrix-2/factories/vec3f64 ../layers/interfaces ../support/debugFlags ./interfaces ./Overlay ./OverlayContent ./OverlayRenderTargets ../webgl/RenderCamera ../webgl-engine/core/shaderLibrary/ShaderOutput ../webgl-engine/core/shaderLibrary/terrain/Overlay.glsl ../../../chunks/TextureOnly.glsl ../webgl-engine/effects/RenderPlugin ../webgl-engine/effects/highlight/Highlight ../webgl-engine/lib/GLMaterialRepository ../webgl-engine/lib/GridLocalOriginFactory ../webgl-engine/lib/Material ../webgl-engine/lib/OITPass ../webgl-engine/lib/RenderContext ../webgl-engine/lib/RenderSlot ../webgl-engine/lib/ShadowMap ../webgl-engine/lib/SortedRenderGeometryRenderer ../webgl-engine/lib/TextureTechnique ../webgl-engine/lib/TextureTechniqueConfiguration ../webgl-engine/lib/Update ../webgl-engine/lib/UpdatePolicy ../webgl-engine/lighting/Lightsources ../../../chunks/OverlayCompositing.glsl ../webgl-engine/shaders/OverlayCompositingTechnique ../../support/Scheduler ../../webgl/enums ../../webgl/Texture ../../webgl/TextureDescriptor".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w,x,u,t,m,q,r,v,y,B,z,A,C,H,E,F,G,D,I,J,N,M,Q,O,K,L,P,R,W,V,ba,U,da,fa,ha){a.OverlayRenderer=class extends E.SyncRenderPlugin{constructor(Y){super(Y);this._renderTargets=this._overlays=null;this._overlayParameters=new V.OverlayCompositingPassParameters;this._hasWater=this.hasHighlights=!1;this._renderers=new Map;this._sortedDrapeSourceRenderersDirty=!1;this._sortedRenderers=new e;this._passParameters=new H.TextureOnlyPassParameters;this._materials=null;this._screenToWorldRatio=
1;this._localOriginFactory=null;this.unloadedMemory=0;this.ignoresMemoryFactor=!1;this._camera=new z;this.worldToPCSRatio=1;this.events=new n;this.longitudeCyclical=null;this.produces=new Map([[M.RenderSlot.DRAPED_MATERIAL,ea=>ea!==A.ShaderOutput.Highlight||this.hasHighlights],[M.RenderSlot.DRAPED_WATER,()=>this._hasWater]]);this._hasDrapedRasterSource=this._hasDrapedFeatureSource=this._hasTargetWithoutRasterImage=!1}initialize(){const {view:Y}=this,{_stage:ea}=Y,ka=ea.renderer.fboCache,{waterTextures:ja,
textures:X}=ea.renderView;this._renderContext=new N.OverlayRenderContext(this._rctx,new Q.ShadowMap(ka,Y.state.viewingMode));this.addHandles([g.watch(()=>ja.updating,()=>this.events.emit("content-changed"),g.syncAndInitial),g.watch(()=>this.spatialReference,la=>this._localOriginFactory=new D.GridLocalOriginFactory(la),g.syncAndInitial),g.on(()=>this.view.allLayerViews,"after-changes",()=>this._sortedDrapeSourceRenderersDirty=!0),g.watch(()=>F.trackHighlightOptions(this.view.highlights),()=>this._sortedDrapeSourceRenderersDirty=
!0,g.syncAndInitial)]);this._materials=new G.GLMaterialRepository(X,this._techniques,()=>{this.notifyChange("rendersOccludedDraped");this.events.emit("content-changed");this.notifyChange("updating");this.notifyChange("isEmpty")},()=>this.events.emit("content-changed"));const {_bindParameters:aa,_camera:pa}=this;aa.slot=M.RenderSlot.DRAPED_MATERIAL;aa.mainDepth=null;pa.near=1;pa.far=1E4;pa.relativeElevation=null;aa.camera=this._camera;aa.oitPass=J.OITPass.NONE;aa.updateLighting([new W.AmbientLight(t.ones())],
0,0,P.Update.Immediate);this.addHandles(this.view.resourceController.scheduler.registerTask(U.TaskPriority.STAGE,this))}destroy(){this._renderers.forEach(Y=>Y.destroy());this._renderers.clear();this._passParameters.texture=h.disposeMaybe(this._passParameters.texture);this.disposeOverlays()}get _bindParameters(){return this._renderContext.bind}get _rctx(){return this.view._stage.renderView.renderingContext}get _techniques(){return this.view._stage.renderView.techniques}get rctx(){return this._rctx}get materials(){return this._materials}get screenToWorldRatio(){return this._screenToWorldRatio}get localOriginFactory(){return this._localOriginFactory}get pluginContext(){return this._pluginContext}initializeRenderContext(Y){this._pluginContext=
Y;this._techniques.precompile(ba.OverlayCompositingTechnique)}uninitializeRenderContext(){}acquireTechniques(){return[]}render(){}get updating(){return this._sortedDrapeSourceRenderersDirty||p.someMap(this._renderers,Y=>Y.updating)}get hasOverlays(){return null!=this._overlays&&null!=this._renderTargets}getMaterialRenderer(Y){for(const ea of this._renderers.values()){const ka=ea.getMaterialRenderer(Y);if(ka)return ka}return null}get layers(){this._sortedDrapeSourceRenderersDirty&&this._updateSortedDrapeSourceRenderers();
return this._sortedRenderers.map(Y=>Y.drapeSource.layer).filter(Y=>!!Y)}createGeometryDrapeSourceRenderer(Y){return this.createDrapeSourceRenderer(Y,O.SortedRenderGeometryRenderer)}createDrapeSourceRenderer(Y,ea,ka){const ja=this._renderers.get(Y);null!=ja&&ja.destroy();ea=new ea({...ka,rendererContext:this,drapeSource:Y});this._renderers.set(Y,ea);this._sortedDrapeSourceRenderersDirty=!0;"fullOpacity"in Y&&this.addHandles(g.watch(()=>Y.fullOpacity,()=>this.events.emit("content-changed")),Y);return ea}removeDrapeSourceRenderer(Y){if(null!=
Y){var ea=this._renderers.get(Y);null!=ea&&(this._sortedDrapeSourceRenderersDirty=!0,this._renderers.delete(Y),this.removeHandles(Y),ea.destroy())}}computeValidity(){return this._renderTargets?.computeValidity()??0}releaseRenderTargets(){this._renderTargets?.dispose()}get overlays(){return this._overlays??[]}ensureDrapeTargets(Y){this._hasTargetWithoutRasterImage=this._overlays?d.someSet(Y,ea=>ea.drapeTargetType===m.DrapeTargetType.WithoutRasterImage):!1}ensureDrapeSources(Y){this._overlays?(this._hasDrapedFeatureSource=
d.someSet(Y,ea=>ea.drapeSourceType===m.DrapeSourceType.Features),this._hasDrapedRasterSource=d.someSet(Y,ea=>ea.drapeSourceType===m.DrapeSourceType.RasterImage)):this._hasDrapedFeatureSource=this._hasDrapedRasterSource=!1}get _needsColorWithoutRasterImage(){return this._hasDrapedRasterSource&&this._hasDrapedFeatureSource&&this._hasTargetWithoutRasterImage}ensureOverlays(Y,ea,ka=this._bindParameters.overlayStretch){null==this._overlays&&(this._renderTargets=new B.OverlayRenderTargets(this.view._stage.renderer.fboCache),
this._overlays=[new v.Overlay,new v.Overlay]);this.ensureDrapeTargets(Y);this.ensureDrapeSources(ea);this._bindParameters.overlayStretch=ka}disposeOverlays(){this._overlays=null;this._renderTargets=h.disposeMaybe(this._renderTargets);this.events.emit("textures-disposed")}getTexture(Y){if(null!=Y)return Y===y.OverlayContent.ColorNoRasterImage&&!this._needsColorWithoutRasterImage&&this._hasDrapedFeatureSource?this._renderTargets?.getTexture(y.OverlayContent.Color):this._renderTargets?.getTexture(Y)}get running(){return this.updating}runTask(Y){this._processDrapeSources(Y,
()=>!0)}_processDrapeSources(Y,ea){let ka=!1;for(const [ja,X]of this._renderers){if(Y.done)break;(ja.destroyed||ea(ja))&&X.commitChanges()&&(ka=!0,Y.madeProgress())}this._sortedDrapeSourceRenderersDirty&&(this._sortedDrapeSourceRenderersDirty=!1,ka=!0,this._updateSortedDrapeSourceRenderers());ka&&(null!=this._overlays&&0===this._renderers.size&&this.disposeOverlays(),this.notifyChange("updating"),this.notifyChange("isEmpty"),this.events.emit("content-changed"),this.hasHighlights=p.someMap(this._renderers,
ja=>ja.hasHighlights),this.notifyChange("rendersOccludedDraped"),this._updateHasWater())}processSyncDrapeSources(){this._processDrapeSources(U.noBudget,Y=>Y.updatePolicy===R.UpdatePolicy.SYNC)}get isEmpty(){return q.debugFlags.OVERLAY_DRAW_DEBUG_TEXTURE?!1:!p.someMap(this._renderers,Y=>!Y.isEmpty)}get hasWater(){return this._hasWater}get rendersOccludedDraped(){const Y=this._renderContext.renderOccludedMask;this._renderContext.renderOccludedMask=Z;++this._techniques.precompiling;const ea=this._sortedRenderers.some(({renderer:ka})=>
ka.precompile(this._renderContext));--this._techniques.precompiling;this._renderContext.renderOccludedMask=Y;return ea}renders(Y){if(q.debugFlags.OVERLAY_DRAW_DEBUG_TEXTURE&&Y!==y.OverlayContent.Occluded&&Y!==y.OverlayContent.Highlight)return!0;++this._techniques.precompiling;Y=this._sortedRenderers.some(({renderer:ea})=>ea.precompile(this._renderContext));--this._techniques.precompiling;return Y}get mode(){return this.isEmpty?C.OverlayMode.Disabled:this._renderTargets?.getTexture(y.OverlayContent.WaterNormal)?
C.OverlayMode.EnabledWithWater:this._renderTargets?.getTexture(y.OverlayContent.Color)?C.OverlayMode.Enabled:C.OverlayMode.Disabled}updateAnimation(Y){let ea=!1;this._renderers.forEach(ka=>ea=ka.updateAnimation(Y)||ea);return ea}updateDrapeSourceOrder(){this._sortedDrapeSourceRenderersDirty=!0}precompileShaders(Y){if(this._renderTargets){this._bindParameters.alignPixelEnabled=Y.alignPixelEnabled;this._bindParameters.highlightGroupName=null;++this._techniques.precompiling;for(const ea of this._renderTargets.targets)if(ea.content!==
y.OverlayContent.ColorNoRasterImage||this._needsColorWithoutRasterImage)Y=ea.output,this._renderContext.output=Y,this._bindParameters.slot=Y===A.ShaderOutput.Normal?M.RenderSlot.DRAPED_WATER:M.RenderSlot.DRAPED_MATERIAL,ea.content===y.OverlayContent.Occluded&&(this._renderContext.renderOccludedMask=Z),this._sortedRenderers.forAll(({drapeSource:ka,renderer:ja})=>{ea.content===y.OverlayContent.ColorNoRasterImage&&ka.drapeSourceType===m.DrapeSourceType.RasterImage||ja.precompile(this._renderContext)}),
this._renderContext.renderOccludedMask=N.defaultRenderOccludedMask;--this._techniques.precompiling}}drawOverlays(Y){if(this._overlays&&this._renderTargets){for(var ea of this._overlays)this.longitudeCyclical?ea.setupGeometryViewsCyclical(this.longitudeCyclical):ea.setupGeometryView();this._bindParameters.alignPixelEnabled=Y.alignPixelEnabled;for(const ka of this._renderTargets.targets){if(ka.content===y.OverlayContent.ColorNoRasterImage&&!this._needsColorWithoutRasterImage)continue;ea=this._drawTarget(r.OverlayIndex.INNER,
ka,Y);const ja=this._drawTarget(r.OverlayIndex.OUTER,ka,Y);(ea||ja)&&ka.fbo.generateMipMap()}}}_drawTarget(Y,ea,ka){var ja=this._overlays[Y],X=ja.canvasGeometries;if(0===X.numViews)return!1;({contentPixelRatio:ka}=ka);this._screenToWorldRatio=ka*ja.mapUnitsPerPixel/this._bindParameters.overlayStretch;var aa=ea.output;if(this.isEmpty||aa===A.ShaderOutput.Normal&&!this.hasWater||!ja.hasSomeSizedView())return!1;const {_rctx:pa,_bindParameters:la}=this;this._camera.pixelRatio=ja.pixelRatio*ka;this._renderContext.output=
aa;la.screenToWorldRatio=this._screenToWorldRatio;la.screenToPCSRatio=this._screenToWorldRatio*this.worldToPCSRatio;la.slot=aa===A.ShaderOutput.Normal?M.RenderSlot.DRAPED_WATER:M.RenderSlot.DRAPED_MATERIAL;ea.content===y.OverlayContent.Occluded&&(this._renderContext.renderOccludedMask=Z);la.highlightGroupName=null;if(!this.renders(ea.content))return this._renderContext.renderOccludedMask=N.defaultRenderOccludedMask,!1;({resolution:aa}=ja);ka=Y===r.OverlayIndex.INNER?0:aa;pa.setViewport(ka,0,aa,aa);
this._bindTargetFBO(ea);Y===r.OverlayIndex.INNER&&(pa.setClearColor(0,0,0,0),pa.clear(da.FramebufferBit.COLOR));if(q.debugFlags.OVERLAY_DRAW_DEBUG_TEXTURE&&ea.content!==y.OverlayContent.Occluded&&ea.content!==y.OverlayContent.Highlight){this._techniques.precompile(K.TextureTechnique,ia);aa=this._techniques.acquire(K.TextureTechnique,ia);for(let na=0;na<X.numViews;na++)this._setViewParameters(X.extents[na],ja),this._ensureDebugPatternResources(ja.resolution,S[Y]),pa.bindTechnique(aa,la,this._passParameters),
pa.screen.draw();aa.release()}ea.output===A.ShaderOutput.Highlight?({fboCache:ja}=this.view._stage.renderer,X=this._resolution,F.renderHighlightBuffer(pa,ja,{width:X,height:X},this.view.highlights,la,()=>this._renderAllGeometry(Y,ea),ka,()=>this._bindTargetFBO(ea))):this._renderAllGeometry(Y,ea);pa.bindFramebuffer(null);this._renderContext.renderOccludedMask=N.defaultRenderOccludedMask;return!0}_renderAllGeometry(Y,ea){const ka=this._overlays[Y],ja=ka.canvasGeometries;this._sortedRenderers.forAll(({drapeSource:X,
renderer:aa})=>{if(ea.content!==y.OverlayContent.ColorNoRasterImage||X.drapeSourceType!==m.DrapeSourceType.RasterImage){var {fullOpacity:pa}=X;X=null!=pa&&1>pa&&ea.output===A.ShaderOutput.Color&&this._bindTemporaryFBO();for(let la=0;la<ja.numViews;la++)this._setViewParameters(ja.extents[la],ka),aa.render(this._renderContext);X&&(this._bindTargetFBO(ea),this._overlayParameters.texture=X.getTexture(),this._overlayParameters.opacity=pa,this._overlayParameters.overlayIndex=Y,aa=this._techniques.acquire(ba.OverlayCompositingTechnique),
this._rctx.bindTechnique(aa,this._bindParameters,this._overlayParameters),this._rctx.screen.draw(),aa.release(),X.release())}})}_bindTargetFBO(Y){const ea=this._resolution;Y.fbo.bind(this._rctx,2*ea,ea)}_bindTemporaryFBO(){var Y=this._resolution;const ea=this.view._stage.renderer.fboCache;Y=ea.acquire(2*Y,Y,"overlay tmp");ea.rctx.bindFramebuffer(Y.fbo);ea.rctx.clear(da.FramebufferBit.COLOR);return Y}get _resolution(){return this._overlays?.[r.OverlayIndex.INNER].resolution??0}notifyContentChanged(){this.events.emit("content-changed")}intersect(Y,
ea,ka,ja){this._sortedDrapeSourceRenderersDirty&&this._updateSortedDrapeSourceRenderers();let X=0;for(const {renderer:aa}of this._sortedRenderers)X=aa.intersect?.(Y,ea,ka,ja,X)??X}_updateSortedDrapeSourceRenderers(){this._sortedRenderers.clear();if(0!==this._renderers.size){var Y=this.view.map.allLayers,ea=Y.length;this._renderers.forEach((ka,ja)=>{const X=Y.indexOf(ja.layer),aa=0<=X;this._sortedRenderers.push(new T(ja,ka,ea*(ja.renderGroup??(aa?m.DrapedRenderGroup.MapLayer:m.DrapedRenderGroup.ViewLayer))+
(aa?X:0)))});this._sortedRenderers.sort((ka,ja)=>ka.index-ja.index)}}_setViewParameters(Y,ea){const ka=this._camera;ka.viewport=[0,0,ea.resolution,ea.resolution];x.ortho(ka.projectionMatrix,0,Y[2]-Y[0],0,Y[3]-Y[1],ka.near,ka.far);x.fromTranslation(ka.viewMatrix,[-Y[0],-Y[1],0])}_updateHasWater(){const Y=p.someMap(this._renderers,ea=>ea.hasWater);Y!==this._hasWater&&(this._hasWater=Y,this.events.emit("has-water"))}_ensureDebugPatternResources(Y,ea){u.set(this._passParameters.color,ea[0],ea[1],ea[2]);
if(!this._passParameters.texture){ea=new Uint8Array(Y*Y*4);var ka=0;for(let ja=0;ja<Y;ja++)for(let X=0;X<Y;X++){const aa=Math.floor(X/10),pa=Math.floor(ja/10);2>aa||2>pa||10*aa>Y-20||10*pa>Y-20?(ea[ka++]=255,ea[ka++]=255,ea[ka++]=255,ea[ka++]=255):(ea[ka++]=255,ea[ka++]=255,ea[ka++]=255,aa&1&&pa&1?ea[ka++]=X&1^ja&1?0:255:ea[ka++]=aa&1^pa&1?0:128)}Y=new ha.TextureDescriptor(Y);Y.samplingMode=da.TextureSamplingMode.NEAREST;this._passParameters.texture=new fa.Texture(this._rctx,Y,ea)}}get test(){}};
b.__decorate([f.property()],a.OverlayRenderer.prototype,"hasHighlights",void 0);b.__decorate([f.property()],a.OverlayRenderer.prototype,"_sortedDrapeSourceRenderersDirty",void 0);b.__decorate([f.property({constructOnly:!0})],a.OverlayRenderer.prototype,"view",void 0);b.__decorate([f.property({readOnly:!0})],a.OverlayRenderer.prototype,"_techniques",null);b.__decorate([f.property()],a.OverlayRenderer.prototype,"worldToPCSRatio",void 0);b.__decorate([f.property()],a.OverlayRenderer.prototype,"spatialReference",
void 0);b.__decorate([f.property({type:Boolean,readOnly:!0})],a.OverlayRenderer.prototype,"updating",null);b.__decorate([f.property()],a.OverlayRenderer.prototype,"isEmpty",null);b.__decorate([f.property({readOnly:!0})],a.OverlayRenderer.prototype,"rendersOccludedDraped",null);a.OverlayRenderer=b.__decorate([w.subclass("esri.views.3d.terrain.OverlayRenderer")],a.OverlayRenderer);class T{constructor(Y,ea,ka){this.drapeSource=Y;this.renderer=ea;this.index=ka}}const S=[[1,.5,.5],[.5,.5,1]],Z=I.RenderOccludedFlag.OccludeAndTransparent,
ia=new L.TextureTechniqueConfiguration;ia.hasAlpha=!0;a.drapedZ=-2;a.overlayRenderOccludedFlag=Z;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/interfaces":function(){define(["exports"],function(a){a.DrapeSourceType=void 0;(function(b){b[b.RasterImage=0]="RasterImage";b[b.Features=1]="Features"})(a.DrapeSourceType||(a.DrapeSourceType={}));a.DrapedRenderGroup=void 0;(function(b){b[b.MapLayer=0]="MapLayer";b[b.ViewLayer=1]="ViewLayer";b[b.Outline=2]="Outline";
b[b.SnappingHint=3]="SnappingHint"})(a.DrapedRenderGroup||(a.DrapedRenderGroup={}));a.DrapeTargetType=void 0;(function(b){b[b.WithRasterImage=0]="WithRasterImage";b[b.WithoutRasterImage=1]="WithoutRasterImage"})(a.DrapeTargetType||(a.DrapeTargetType={}));Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/Overlay":function(){define(["exports","../../../geometry/support/aaBoundingRect","../webgl-engine/lib/LocalOriginFactory"],function(a,b,n){class k{constructor(){this._extent=
b.create();this.resolution=0;this.renderLocalOrigin=n.fromValues(0,0,0,"O");this.mapUnitsPerPixel=this.pixelRatio=1;this.canvasGeometries=new p}get extent(){return this._extent}setupGeometryViewsCyclical(h){this.setupGeometryView();var e=.001*h.range;if(this._extent[0]-e<=h.min){const g=this.canvasGeometries.extents[this.canvasGeometries.numViews++];b.offset(this._extent,h.range,0,g)}this._extent[2]+e>=h.max&&(e=this.canvasGeometries.extents[this.canvasGeometries.numViews++],b.offset(this._extent,
-h.range,0,e))}setupGeometryView(){this.canvasGeometries.numViews=1;b.copy(this.canvasGeometries.extents[0],this._extent)}hasSomeSizedView(){for(let h=0;h<this.canvasGeometries.numViews;h++){const e=this.canvasGeometries.extents[h];if(e[0]!==e[2]&&e[1]!==e[3])return!0}return!1}}class p{constructor(){this.extents=[b.create(),b.create(),b.create()];this.numViews=0}}a.Overlay=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/LocalOriginFactory":function(){define(["exports",
"../../../../core/libs/gl-matrix-2/factories/vec3f64"],function(a,b){class n{constructor(k,p){this.vec3=k;this.id=p}}a.LocalOrigin=n;a.fromValues=function(k,p,h,e){return new n(b.fromValues(k,p,h),e)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/OverlayContent":function(){define(["exports"],function(a){a.OverlayContent=void 0;var b=a.OverlayContent||(a.OverlayContent={});b[b.Color=0]="Color";b[b.ColorNoRasterImage=1]="ColorNoRasterImage";b[b.Highlight=2]=
"Highlight";b[b.WaterNormal=3]="WaterNormal";b[b.Occluded=4]="Occluded";b[b.ObjectAndLayerIdColor=5]="ObjectAndLayerIdColor";Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/OverlayRenderTargets":function(){define("exports ./OverlayContent ./OverlayFramebufferObject ../webgl/formats ../webgl-engine/core/shaderLibrary/ShaderOutput ../webgl-engine/effects/geometry/olidUtils".split(" "),function(a,b,n,k,p,h){class e{constructor(d,f,c,l,w=k.ColorFormat.RGBA_MIPMAP){this.output=
c;this.content=l;this.fbo=new n.OverlayFramebufferObject(d,w,f)}get valid(){return this.fbo.valid}}class g{constructor(d){this.targets=[new e(d,"overlay color",p.ShaderOutput.Color,b.OverlayContent.Color),new e(d,"overlay IM color",p.ShaderOutput.Color,b.OverlayContent.ColorNoRasterImage),new e(d,"overlay highlight",p.ShaderOutput.Highlight,b.OverlayContent.Highlight,k.ColorFormat.RG),new e(d,"overlay water",p.ShaderOutput.Normal,b.OverlayContent.WaterNormal),new e(d,"overlay occluded",p.ShaderOutput.Color,
b.OverlayContent.Occluded)];h.olidEnabled()&&this.targets.push(new e(d,"overlay olid",p.ShaderOutput.ObjectAndLayerIdColor,b.OverlayContent.ObjectAndLayerIdColor,k.ColorFormat.RGBA))}getTexture(d){return this.targets[d]?.fbo.texture}dispose(){for(const d of this.targets)d.fbo.dispose()}computeValidity(){return this.targets.reduce((d,f,c)=>f.valid?d|=1<<c:d,0)}}a.OverlayRenderTargets=g;a.RenderTargetDescriptor=e;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/OverlayFramebufferObject":function(){define(["exports",
"../../../core/maybe"],function(a,b){class n{constructor(k,p,h){this._fbos=k;this._format=p;this._name=h}get valid(){return null!=this._handle?.getTexture()}dispose(){this._handle=b.releaseMaybe(this._handle)}get texture(){return this._handle?.getTexture()}bind(k,p,h){this._handle&&this._handle.fbo?.width===p&&this._handle.fbo?.height===h||(this._handle?.release(),this._handle=this._fbos.acquire(p,h,this._name,this._format));k.bindFramebuffer(this._handle?.fbo)}generateMipMap(){this._handle?.getTexture()?.descriptor?.hasMipmap&&
this._handle?.getTexture()?.generateMipmap()}}a.OverlayFramebufferObject=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/terrain/Overlay.glsl":function(){define("exports ../../../../../../core/libs/gl-matrix-2/factories/vec4f64 ../../../../../../geometry/support/aaBoundingRect ../../../../terrain/interfaces ../../../../terrain/OverlayContent ../../renderPasses/AllRenderPasses ../ShaderOutput ../shading/MainLighting.glsl ../shading/PhysicallyBasedRenderingParameters.glsl ../shading/Water.glsl ../../shaderModules/Float4DrawUniform ../../shaderModules/FloatPassUniform ../../shaderModules/interfaces ../../shaderModules/Texture2DPassUniform ../../shaderModules/Uniform".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w,x,u){function t(v,y){const B=y.pbrMode===d.PBRMode.Water||y.pbrMode===d.PBRMode.WaterOnIntegratedMesh||y.pbrMode===d.PBRMode.TerrainWithWater;B&&v.include(f.Water,y);const {vertex:z,fragment:A}=v;v.varyings.add("vtcOverlay","vec4");z.code.add(w.glsl`void setOverlayVTC(in vec2 uv) {
vtcOverlay = vec4(uv, uv) * overlayTexScale + overlayTexOffset;
}`);A.code.add(w.glsl`bool isValid(vec2 uv, vec2 dxdy) {
return (uv.x >= 0.0 + dxdy.x) && (uv.x <= 1.0 - dxdy.x) && (uv.y >= 0.0 + dxdy.y) && (uv.y <= 1.0 - dxdy.y);
}
vec4 getOverlayColor(sampler2D ov0Tex, vec4 texCoords) {
vec4 color0 = texture(ov0Tex, vec2(texCoords.x * 0.5, texCoords.y));
vec4 color1 = texture(ov0Tex, vec2(texCoords.z * 0.5 + 0.5, texCoords.w));
bool isValid0 = isValid(texCoords.xy, fwidth(texCoords.xy));
bool isValid1 = isValid(texCoords.zw, vec2(0.0, 0.0));
return mix(color1 * float(isValid1), color0, float(isValid0));
}`);A.code.add(w.glsl`vec4 getCombinedOverlayColor() {
return overlayOpacity * getOverlayColor(ovColorTex, vtcOverlay);
}`);A.code.add(w.glsl`vec4 getOverlayColorTexel(vec4 texCoords) {
vec2 texDim =  vec2(textureSize(ovColorTex, 0));
vec4 color0 = texelFetch(ovColorTex, ivec2(vec2(texCoords.x * 0.5, texCoords.y) * texDim), 0);
vec4 color1 = texelFetch(ovColorTex, ivec2(vec2(texCoords.z * 0.5 + 0.5, texCoords.w) * texDim), 0);
bool isValid0 = isValid(texCoords.xy, fwidth(texCoords.xy));
bool isValid1 = isValid(texCoords.zw, vec2(0.0, 0.0));
return mix(color1 * float(isValid1), color0, float(isValid0));
}`);A.code.add(w.glsl`vec2 getAllOverlayHighlightValuesEncoded() {
vec4 texCoords = vtcOverlay;
vec2 uvInner = texCoords.xy;
vec2 uvOuter = texCoords.zw;
bool isValidInner = isValid(uvInner, fwidth(uvInner));
bool isValidOuter = isValid(uvOuter, vec2(0.0, 0.0));
vec2 texelCoordInner = vec2(uvInner.x * 0.5,       uvInner.y);
vec2 texelCoordOuter = vec2(uvOuter.x * 0.5 + 0.5, uvOuter.y);
vec2 texDim =  vec2(textureSize(ovColorTex, 0));
vec2 texelValueInner = texelFetch(ovColorTex, ivec2(texelCoordInner * texDim), 0).rg;
vec2 texelValueOuter = texelFetch(ovColorTex, ivec2(texelCoordOuter * texDim), 0).rg;
return
isValidInner ? texelValueInner :
isValidOuter ? texelValueOuter :
vec2(0.0);
}`);B&&(g.addMainLightDirection(A),g.addMainLightIntensity(A),A.code.add(w.glsl`vec4 getOverlayWaterColor(vec4 maskInput, vec4 colorInput, vec3 vposEyeDir,
float shadow, vec3 localUp, mat3 tbn, vec3 position, vec3 positionWorld) {
vec3 n = normalize(tbn *  (2.0 * maskInput.rgb - vec3(1.0)));
vec3 v = vposEyeDir;
vec3 final = getSeaColor(n, v, mainLightDirection, colorInput.rgb, mainLightIntensity, localUp, 1.0 - shadow, maskInput.w, position, positionWorld);
return vec4(final, colorInput.w);
}`))}function m(v,y){return v.identifier===h.RenderPassIdentifier.Material&&v.output===e.ShaderOutput.Color?y.overlay?.getTexture(p.OverlayContent.ColorNoRasterImage):v.identifier===h.RenderPassIdentifier.Material&&v.output===e.ShaderOutput.ObjectAndLayerIdColor?y.overlay?.getTexture(p.OverlayContent.ObjectAndLayerIdColor):v.identifier===h.RenderPassIdentifier.Highlight?y.overlay?.getTexture(p.OverlayContent.Highlight):null}a.OverlayMode=void 0;(function(v){v[v.Disabled=0]="Disabled";v[v.Enabled=
1]="Enabled";v[v.EnabledWithWater=2]="EnabledWithWater";v[v.COUNT=3]="COUNT"})(a.OverlayMode||(a.OverlayMode={}));const q=b.create();class r extends u.Uniform{constructor(v){super(v,"vec4")}}a.OverlayIM=function(v,y){const {vertex:B,fragment:z}=v;B.uniforms.add(new c.Float4DrawUniform("overlayTexOffset",(A,C)=>{const H=C.overlay?.overlays[k.OverlayIndex.INNER]?.extent;n.hasArea(H)&&(q[0]=A.toMapSpace[0]/n.width(H)-H[0]/n.width(H),q[1]=A.toMapSpace[1]/n.height(H)-H[1]/n.height(H));C=C.overlay?.overlays[k.OverlayIndex.OUTER]?.extent;
n.hasArea(C)&&(q[2]=A.toMapSpace[0]/n.width(C)-C[0]/n.width(C),q[3]=A.toMapSpace[1]/n.height(C)-C[1]/n.height(C));return q}),new c.Float4DrawUniform("overlayTexScale",(A,C)=>{const H=C.overlay?.overlays[k.OverlayIndex.INNER]?.extent;n.hasArea(H)&&(q[0]=A.toMapSpace[2]/n.width(H),q[1]=A.toMapSpace[3]/n.height(H));C=C.overlay?.overlays[k.OverlayIndex.OUTER]?.extent;n.hasArea(C)&&(q[2]=A.toMapSpace[2]/n.width(C),q[3]=A.toMapSpace[3]/n.height(C));return q}));z.constants.add("overlayOpacity","float",1);
z.uniforms.add(new x.Texture2DPassUniform("ovColorTex",(A,C)=>m(A,C)));t(v,y)};a.OverlayTerrain=function(v,y){const {vertex:B,fragment:z}=v;B.uniforms.add(new r("overlayTexOffset"),new r("overlayTexScale"));z.uniforms.add(new l.FloatPassUniform("overlayOpacity",A=>A.overlayOpacity),new x.Texture2DPassUniform("ovColorTex",(A,C)=>C.overlay?.getTexture(A.overlayContent)));t(v,y)};a.getIMColorTexture=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/renderPasses/AllRenderPasses":function(){define(["exports",
"../../../../../core/libs/gl-matrix-2/factories/vec3f64","../shaderLibrary/ShaderOutput","../shaderLibrary/attributes/VertexNormal.glsl"],function(a,b,n,k){class p extends k.VertexNormalPassParameters{constructor(){super(...arguments);this.origin=this.slicePlaneLocalOrigin=b.create();this.modelTransformation=null}}class h extends k.VertexNormalDrawParameters{}a.RenderPassIdentifier=void 0;(function(c){c[c.Material=0]="Material";c[c.ShadowMap=1]="ShadowMap";c[c.Highlight=2]="Highlight";c[c.ViewshedShadowMap=
3]="ViewshedShadowMap"})(a.RenderPassIdentifier||(a.RenderPassIdentifier={}));class e extends p{constructor(){super(...arguments);this.identifier=a.RenderPassIdentifier.Material;this.output=n.ShaderOutput.Color;this.transparent=!1}}class g extends p{constructor(){super(...arguments);this.identifier=a.RenderPassIdentifier.ShadowMap}}class d extends p{constructor(){super(...arguments);this.identifier=a.RenderPassIdentifier.Highlight}}class f extends p{constructor(){super(...arguments);this.identifier=
a.RenderPassIdentifier.ViewshedShadowMap}}a.DrawParameters=h;a.HighlightPassParameters=d;a.MaterialPassParameters=e;a.PassParameters=p;a.ShadowMapPassParameters=g;a.ViewshedShadowMapPassParameters=f;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/Water.glsl":function(){define("exports ./FoamRendering.glsl ./Gamma.glsl ./PhysicallyBasedRendering.glsl ./ScreenSpaceConstants ./ScreenSpaceReflections.glsl ../util/CloudsParallaxShading.glsl ../../shaderModules/FloatPassUniform ../../shaderModules/interfaces ../../shaderModules/Matrix4PassUniform ../../shaderModules/Texture2DPassUniform ../../../shaders/ToneMapping.glsl".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l){a.Water=function(w,x){w.include(k.PhysicallyBasedRenderingWater,x);w.include(n.Gamma);w.include(b.FoamColor);x.cloudReflections&&w.include(e.CloudsParallaxShading);w.include(h.ScreenSpaceReflections,x);w=w.fragment;w.include(l.ToneMapping);w.constants.add("fresnelSky","vec3",[.02,1,15]);w.constants.add("fresnelMaterial","vec2",[.02,.1]);w.constants.add("roughness","float",.015);w.constants.add("foamIntensityExternal","float",1.7);w.constants.add("ssrIntensity","float",
.65);w.constants.add("ssrHeightFadeStart","float",p.distanceFadeStart);w.constants.add("ssrHeightFadeEnd","float",p.distanceFadeEnd);w.constants.add("waterDiffusion","float",.92);w.constants.add("waterSeaColorMod","float",.8);w.constants.add("correctionViewingPowerFactor","float",.4);w.constants.add("skyZenitColor","vec3",[.52,.68,.9]);w.constants.add("skyColor","vec3",[.67,.79,.9]);w.constants.add("cloudFresnelModifier","vec2",[1.2,.01]);w.code.add(d.glsl`PBRShadingWater shadingInfo;
vec3 getSkyGradientColor(in float cosTheta, in vec3 horizon, in vec3 zenit) {
float exponent = pow((1.0 - cosTheta), fresnelSky[2]);
return mix(zenit, horizon, exponent);
}`);w.uniforms.add(new g.FloatPassUniform("lightingSpecularStrength",(u,t)=>t.lighting.mainLight.specularStrength),new g.FloatPassUniform("lightingEnvironmentStrength",(u,t)=>t.lighting.mainLight.environmentStrength));w.code.add(d.glsl`vec3 getSeaColor(in vec3 n, in vec3 v, in vec3 l, vec3 color, in vec3 lightIntensity, in vec3 localUp, in float shadow, float foamIntensity, vec3 viewPosition, vec3 position) {
float reflectionHit = 0.0;
float reflectionHitDiffused = 0.0;
vec3 seaWaterColor = linearizeGamma(color);
vec3 h = normalize(l + v);
shadingInfo.NdotV = clamp(dot(n, v), 0.001, 1.0);
shadingInfo.VdotN = clamp(dot(v, n), 0.001, 1.0);
shadingInfo.NdotH = clamp(dot(n, h), 0.0, 1.0);
shadingInfo.VdotH = clamp(dot(v, h), 0.0, 1.0);
shadingInfo.LdotH = clamp(dot(l, h), 0.0, 1.0);
float upDotV = max(dot(localUp,v), 0.0);
vec3 skyHorizon = linearizeGamma(skyColor);
vec3 skyZenit = linearizeGamma(skyZenitColor);
vec3 skyColor = getSkyGradientColor(upDotV, skyHorizon, skyZenit );
float upDotL = max(dot(localUp,l),0.0);
float daytimeMod = 0.1 + upDotL * 0.9;
skyColor *= daytimeMod;
float shadowModifier = clamp(shadow, 0.8, 1.0);
vec3 fresnelModifier = fresnelReflection(shadingInfo.VdotN, vec3(fresnelSky[0]), fresnelSky[1]);
vec3 reflSky = lightingEnvironmentStrength * fresnelModifier * skyColor * shadowModifier;
vec3 reflSea = seaWaterColor * mix(skyColor, upDotL * lightIntensity * LIGHT_NORMALIZATION, 2.0 / 3.0) * shadowModifier;
vec3 specular = vec3(0.0);
if(upDotV > 0.0 && upDotL > 0.0) {
vec3 specularSun = brdfSpecularWater(shadingInfo, roughness, vec3(fresnelMaterial[0]), fresnelMaterial[1]);
vec3 incidentLight = lightIntensity * LIGHT_NORMALIZATION * shadow;
float NdotL = clamp(dot(n, l), 0.0, 1.0);
specular = lightingSpecularStrength * NdotL * incidentLight * specularSun;
}
vec3 foam = vec3(0.0);
if(upDotV > 0.0) {
foam = foamIntensity2FoamColor(foamIntensityExternal, foamIntensity, skyZenitColor, daytimeMod);
}
float correctionViewingFactor = pow(max(dot(v, localUp), 0.0), correctionViewingPowerFactor);
vec3 normalCorrectedClouds = mix(localUp, n, correctionViewingFactor);
vec3 reflectedWorld = normalize(reflect(-v, normalCorrectedClouds));`);x.cloudReflections&&w.uniforms.add(new g.FloatPassUniform("cloudsOpacity",(u,t)=>t.clouds.opacity)).code.add(d.glsl`vec4 cloudsColor = renderClouds(reflectedWorld, position);
cloudsColor.a = 1.0 - cloudsColor.a;
cloudsColor = pow(cloudsColor, vec4(GAMMA));
cloudsColor *= clamp(fresnelModifier.y * cloudFresnelModifier[0] - cloudFresnelModifier[1], 0.0, 1.0) * cloudsOpacity;`);x.screenSpaceReflections?w.uniforms.add(new f.Matrix4PassUniform("view",(u,t)=>t.camera.viewMatrix),new c.Texture2DPassUniform("lastFrameColorTexture",(u,t)=>t.ssr.lastFrameColor?.getTexture()),new g.FloatPassUniform("fadeFactorSSR",(u,t)=>t.ssr.fadeFactor)).code.add(d.glsl`vec3 viewDir = normalize(viewPosition);
vec4 viewNormalVectorCoordinate = view * vec4(n, 0.0);
vec3 viewNormal = normalize(viewNormalVectorCoordinate.xyz);
vec4 viewUp = view * vec4(localUp, 0.0);
vec3 viewNormalCorrectedSSR = mix(viewUp.xyz, viewNormal, correctionViewingFactor);
vec3 reflected = normalize(reflect(viewDir, viewNormalCorrectedSSR));
vec3 hitCoordinate = screenSpaceIntersection(reflected, viewPosition, viewDir, viewUp.xyz);
vec3 reflectedColor = vec3(0.0);
if (hitCoordinate.z > 0.0)
{
vec2 reprojectedCoordinate = reprojectionCoordinate(hitCoordinate);
vec2 dCoords = smoothstep(0.3, 0.6, abs(vec2(0.5, 0.5) - hitCoordinate.xy));
float heightMod = smoothstep(ssrHeightFadeEnd, ssrHeightFadeStart, -viewPosition.z);
reflectionHit = clamp(1.0 - (1.3 * dCoords.y), 0.0, 1.0) * heightMod * fadeFactorSSR;
reflectionHitDiffused = waterDiffusion * reflectionHit;
reflectedColor = linearizeGamma(texture(lastFrameColorTexture, reprojectedCoordinate).xyz) *
reflectionHitDiffused * fresnelModifier.y * ssrIntensity;
}
float seaColorMod =  mix(waterSeaColorMod, waterSeaColorMod * 0.5, reflectionHitDiffused);
vec3 waterRenderedColor = tonemapACES((1.0 - reflectionHitDiffused) * reflSky + reflectedColor +
reflSea * seaColorMod + specular + foam);`):w.code.add(d.glsl`vec3 waterRenderedColor = tonemapACES(reflSky + reflSea * waterSeaColorMod + specular + foam);`);x.cloudReflections?x.screenSpaceReflections?w.code.add(d.glsl`return waterRenderedColor * (1.0 - (1.0 - reflectionHit) * cloudsColor.a) + (1.0 - reflectionHit) * cloudsColor.xyz;
}`):w.code.add(d.glsl`return waterRenderedColor * (1.0 - cloudsColor.a) + cloudsColor.xyz;
}`):w.code.add(d.glsl`return waterRenderedColor;
}`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/FoamRendering.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,b){a.FoamColor=function(n){n.fragment.code.add(b.glsl`vec3 foamIntensity2FoamColor(float foamIntensityExternal, float foamPixelIntensity, vec3 skyZenitColor, float dayMod){
return foamIntensityExternal * (0.075 * skyZenitColor * pow(foamPixelIntensity, 4.) +  50.* pow(foamPixelIntensity, 23.0)) * dayMod;
}`)};a.FoamIntensity=function(n){n.fragment.code.add(b.glsl`float normals2FoamIntensity(vec3 n, float waveStrength){
float normalizationFactor =  max(0.015, waveStrength);
return max((n.x + n.y)*0.3303545/normalizationFactor + 0.3303545, 0.0);
}`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/Gamma.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,b){a.Gamma=function(n){n.fragment.code.add(b.glsl`const float GAMMA = 2.2;
const float INV_GAMMA = 0.4545454545;
vec4 delinearizeGamma(vec4 color) {
return vec4(pow(color.rgb, vec3(INV_GAMMA)), color.w);
}
vec3 linearizeGamma(vec3 color) {
return pow(color, vec3(GAMMA));
}`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/ScreenSpaceReflections.glsl":function(){define("exports ../output/ReadDepth.glsl ../../shaderModules/Float2PassUniform ../../shaderModules/FloatPassUniform ../../shaderModules/interfaces ../../shaderModules/Matrix4PassUniform ../../shaderModules/Texture2DPassUniform".split(" "),function(a,b,n,k,p,h,e){a.ScreenSpaceReflections=function(g,d){d.screenSpaceReflections&&(g=g.fragment,
g.include(b.ReadDepth),g.uniforms.add(new n.Float2PassUniform("nearFar",(f,c)=>c.camera.nearFar),new e.Texture2DPassUniform("depthMap",(f,c)=>c.depth?.attachment),new h.Matrix4PassUniform("proj",(f,c)=>c.camera.projectionMatrix),new k.FloatPassUniform("invResolutionHeight",(f,c)=>1/c.camera.height),new h.Matrix4PassUniform("reprojectionMatrix",(f,c)=>c.ssr.reprojectionMatrix)).code.add(p.glsl`
  vec2 reprojectionCoordinate(vec3 projectionCoordinate)
  {
    vec4 zw = proj * vec4(0.0, 0.0, -projectionCoordinate.z, 1.0);
    vec4 reprojectedCoord = reprojectionMatrix * vec4(zw.w * (projectionCoordinate.xy * 2.0 - 1.0), zw.z, zw.w);
    reprojectedCoord.xy /= reprojectedCoord.w;
    return reprojectedCoord.xy * 0.5 + 0.5;
  }

  const int maxSteps = ${d.highStepCount?"150":"75"};

  vec4 applyProjectionMat(mat4 projectionMat, vec3 x)
  {
    vec4 projectedCoord =  projectionMat * vec4(x, 1.0);
    projectedCoord.xy /= projectedCoord.w;
    projectedCoord.xy = projectedCoord.xy*0.5 + 0.5;
    return projectedCoord;
  }

  vec3 screenSpaceIntersection(vec3 dir, vec3 startPosition, vec3 viewDir, vec3 normal)
  {
    vec3 viewPos = startPosition;
    vec3 viewPosEnd = startPosition;

    // Project the start position to the screen
    vec4 projectedCoordStart = applyProjectionMat(proj, viewPos);
    vec3  Q0 = viewPos / projectedCoordStart.w; // homogeneous camera space
    float k0 = 1.0/ projectedCoordStart.w;

    // advance the position in the direction of the reflection
    viewPos += dir;

    vec4 projectedCoordVanishingPoint = applyProjectionMat(proj, dir);

    // Project the advanced position to the screen
    vec4 projectedCoordEnd = applyProjectionMat(proj, viewPos);
    vec3  Q1 = viewPos / projectedCoordEnd.w; // homogeneous camera space
    float k1 = 1.0/ projectedCoordEnd.w;

    // calculate the reflection direction in the screen space
    vec2 projectedCoordDir = (projectedCoordEnd.xy - projectedCoordStart.xy);
    vec2 projectedCoordDistVanishingPoint = (projectedCoordVanishingPoint.xy - projectedCoordStart.xy);

    float yMod = min(abs(projectedCoordDistVanishingPoint.y), 1.0);

    float projectedCoordDirLength = length(projectedCoordDir);
    float maxSt = float(maxSteps);

    // normalize the projection direction depending on maximum steps
    // this determines how blocky the reflection looks
    vec2 dP = yMod * (projectedCoordDir)/(maxSt * projectedCoordDirLength);

    // Normalize the homogeneous camera space coordinates
    vec3  dQ = yMod * (Q1 - Q0)/(maxSt * projectedCoordDirLength);
    float dk = yMod * (k1 - k0)/(maxSt * projectedCoordDirLength);

    // initialize the variables for ray marching
    vec2 P = projectedCoordStart.xy;
    vec3 Q = Q0;
    float k = k0;
    float rayStartZ = -startPosition.z; // estimated ray start depth value
    float rayEndZ = -startPosition.z;   // estimated ray end depth value
    float prevEstimateZ = -startPosition.z;
    float rayDiffZ = 0.0;
    float dDepth;
    float depth;
    float rayDiffZOld = 0.0;

    // early outs
    if (dot(normal, dir) < 0.0 || dot(-viewDir, normal) < 0.0)
      return vec3(P, 0.0);

    for(int i = 0; i < maxSteps-1; i++)
    {
      depth = -linearDepthFromTexture(depthMap, P); // get linear depth from the depth buffer

      // estimate depth of the marching ray
      rayStartZ = prevEstimateZ;
      dDepth = -rayStartZ - depth;
      rayEndZ = (dQ.z * 0.5 + Q.z)/ ((dk * 0.5 + k));
      rayDiffZ = rayEndZ- rayStartZ;
      prevEstimateZ = rayEndZ;

      if(-rayEndZ > nearFar[1] || -rayEndZ < nearFar[0] || P.y < 0.0  || P.y > 1.0 )
      {
        return vec3(P, 0.);
      }

      // If we detect a hit - return the intersection point, two conditions:
      //  - dDepth > 0.0 - sampled point depth is in front of estimated depth
      //  - if difference between dDepth and rayDiffZOld is not too large
      //  - if difference between dDepth and 0.025/abs(k) is not too large
      //  - if the sampled depth is not behind far plane or in front of near plane

      if((dDepth) < 0.025/abs(k) + abs(rayDiffZ) && dDepth > 0.0 && depth > nearFar[0] && depth < nearFar[1] && abs(P.y - projectedCoordStart.y) > invResolutionHeight)
      {
        return vec3(P, depth);
      }

      // continue with ray marching
      P = clamp(P + dP, vec2(0.0), vec2(0.999));
      Q.z += dQ.z;
      k += dk;
      rayDiffZOld = rayDiffZ;
    }
    return vec3(P, 0.0);
  }
  `))};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/CloudsParallaxShading.glsl":function(){define("exports ../../../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../../../geometry/support/Ellipsoid ../../../../environment/Clouds ../../../../environment/CloudsParameters ../../../../environment/weather ../shading/MainLighting.glsl ../../shaderModules/BooleanPassUniform ../../shaderModules/Float3PassUniform ../../shaderModules/FloatPassUniform ../../shaderModules/interfaces ../../shaderModules/Matrix4PassUniform ../../shaderModules/TextureCubePassUniform".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w){const x=(n.earth.radius+h.cloudsHeight)**2;a.CloudsParallaxShading=function(u){u=u.fragment;u.constants.add("radiusCloudsSquared","float",x).code.add(c.glsl`vec3 intersectWithCloudLayer(vec3 dir, vec3 cameraPosition, vec3 spherePos) {
float B = 2.0 * dot(cameraPosition, dir);
float C = dot(cameraPosition, cameraPosition) - radiusCloudsSquared;
float det = B * B - 4.0 * C;
float pointIntDist = max(0.0, 0.5 *(-B + sqrt(det)));
return (cameraPosition + dir * pointIntDist) - spherePos;
}`);u.uniforms.add(new f.FloatPassUniform("radiusCurvatureCorrection",(m,q)=>q.clouds.parallax.radiusCurvatureCorrection)).code.add(c.glsl`vec3 correctForPlanetCurvature(vec3 dir) {
dir.z = dir.z * (1.0 - radiusCurvatureCorrection) + radiusCurvatureCorrection;
return dir;
}`);u.code.add(c.glsl`vec3 rotateDirectionToAnchorPoint(mat4 rotMat, vec3 inVec) {
return (rotMat * vec4(inVec, 0.0)).xyz;
}`);e.addMainLightDirection(u);e.addMainLightIntensity(u);const t=b.fromValues(.28,.175,.035);u.constants.add("RIM_COLOR","vec3",t);u.code.add(c.glsl`
    vec3 calculateCloudColor(vec3 cameraPosition, vec3 worldSpaceRay, vec4 clouds) {
      float upDotLight = dot(cameraPosition, mainLightDirection);
      float dirDotLight = max(dot(worldSpaceRay, mainLightDirection), 0.0);
      float sunsetTransition = clamp(pow(max(upDotLight, 0.0), ${c.glsl.float(.3)}), 0.0, 1.0);

      // Base color of the clouds that depends on lighting of the sun and sky
      vec3 ambientLight = calculateAmbientIrradiance(cameraPosition,  0.0);
      vec3 combinedLight = clamp((mainLightIntensity + ambientLight )/PI, vec3(0.0), vec3(1.0));
      vec3 baseCloudColor = pow(combinedLight * pow(clouds.xyz, vec3(GAMMA)), vec3(INV_GAMMA));

      // Rim light around the edge of the clouds simulating scattering of the direct lun light
      float scatteringMod = max(clouds.a < 0.5 ? clouds.a / 0.5 : - clouds.a / 0.5 + 2.0, 0.0);
      float rimLightIntensity = 0.5 + 0.5 * pow(max(upDotLight, 0.0), 0.35);
      vec3 directSunScattering = RIM_COLOR * rimLightIntensity * (pow(dirDotLight, ${c.glsl.float(140)})) * scatteringMod;

      // Brighten the clouds around the sun at the sunsets
      float additionalLight = ${c.glsl.float(.2)} * pow(dirDotLight, ${c.glsl.float(10)}) * (1. - pow(sunsetTransition, ${c.glsl.float(.3)})) ;

      return vec3(baseCloudColor * (1.0 + additionalLight) + directSunScattering);
    }
  `);u.uniforms.add(new g.BooleanPassUniform("readChannelsRG",(m,q)=>q.clouds.readChannels===k.CloudsTextureChannels.RG),new w.TextureCubePassUniform("cubeMap",(m,q)=>q.clouds.data?.cubeMap?.colorTexture??null)).code.add(c.glsl`vec4 sampleCloud(vec3 rayDir, bool readOtherChannel) {
vec4 s = texture(cubeMap, rayDir);
bool readRG = readChannelsRG ^^ readOtherChannel;
s = readRG ? vec4(vec3(s.r), s.g) : vec4(vec3(s.b), s.a);
return length(s) == 0.0 ? vec4(s.rgb, 1.0) : s;
}`);u.uniforms.add(new d.Float3PassUniform("anchorPoint",(m,q)=>q.clouds.parallax.anchorPoint),new d.Float3PassUniform("anchorPointNew",(m,q)=>q.clouds.parallaxNew.anchorPoint),new l.Matrix4PassUniform("rotationClouds",(m,q)=>q.clouds.parallax.transform),new l.Matrix4PassUniform("rotationCloudsNew",(m,q)=>q.clouds.parallaxNew.transform),new f.FloatPassUniform("cloudsOpacity",(m,q)=>q.clouds.opacity),new f.FloatPassUniform("fadeFactor",(m,q)=>q.clouds.fadeFactor),new g.BooleanPassUniform("crossFade",
(m,q)=>q.clouds.fadeState===p.FadeState.CROSS_FADE)).code.add(c.glsl`vec4 renderClouds(vec3 worldRay, vec3 cameraPosition) {
vec3 intersectionPoint = intersectWithCloudLayer(worldRay, cameraPosition, anchorPoint);
vec3 worldRayRotated = rotateDirectionToAnchorPoint(rotationClouds, normalize(intersectionPoint));
vec3 worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
vec4 cloudData = sampleCloud(worldRayRotatedCorrected, crossFade);
vec3 cameraPositionN = normalize(cameraPosition);
vec4 cloudColor = vec4(calculateCloudColor(cameraPositionN, worldRay, cloudData), cloudData.a);
if(crossFade) {
intersectionPoint = intersectWithCloudLayer(worldRay, cameraPosition, anchorPointNew);
worldRayRotated = rotateDirectionToAnchorPoint(rotationCloudsNew, normalize(intersectionPoint));
worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
cloudData = sampleCloud(worldRayRotatedCorrected, false);
vec4 cloudColorNew = vec4(calculateCloudColor(cameraPositionN, worldRay, cloudData), cloudData.a);
cloudColor = mix(cloudColor, cloudColorNew, fadeFactor);
}
float totalTransmittance = length(cloudColor.rgb) == 0.0 ?
1.0 :
clamp(cloudColor.a * cloudsOpacity + (1.0 - cloudsOpacity), 0.0 , 1.0);
return vec4(cloudColor.rgb, totalTransmittance);
}`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/CloudsParameters":function(){define("exports ../../../core/compilerUtils ../../../core/mathUtils ../../../core/signal ../../../core/libs/gl-matrix-2/math/mat4 ../../../core/libs/gl-matrix-2/factories/mat4f64 ../../../chunks/vec32 ../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../geometry/support/axisAngleDegrees ../../../geometry/support/Ellipsoid ./Clouds ./weather".split(" "),function(a,b,n,k,
p,h,e,g,d,f,c,l){class w{constructor(){this.startTime=0;this._data=k.signal(null);this._readChannels=c.CloudsTextureChannels.RG;this.parallax=new x;this.parallaxNew=new x;this._anchorPoint=g.create();this._fadeState=k.signal(a.FadeState.HIDE);this._fadeFactor=k.signal(1)}get data(){return this._data.value}set data(q){this._data.value=q}get readChannels(){return this._readChannels}get fadeState(){return this._fadeState.value}get fadeFactor(){return this._fadeFactor.value}get opacity(){switch(this.fadeState){case a.FadeState.HIDE:return 0;
case a.FadeState.FADE_OUT:return 1-this.fadeFactor;case a.FadeState.FADE_IN:return this.fadeFactor;case a.FadeState.SHOW:case a.FadeState.CROSS_FADE:return 1}}fade(q,r,v){this.isFading&&1>this.fadeFactor&&(this._fadeFactor.value=v?n.clamp((r-this.startTime)/(1.25*v),0,1):1,1===this.fadeFactor&&this._endFade());this._evaluateState(q,r);this._updateParallax(q)}_evaluateState(q,r){const v=q.relativeElevation;q=this._updateAnchorPoint(q);(v>1.7*l.heightLimit||v<-l.heightLimit||2E5<q)&&0<this.opacity?
this._startFade(a.FadeState.HIDE,r):this.isFading||(v>l.heightLimit||v<-.35*l.heightLimit||1E5<q?0<this.opacity&&this._startFade(a.FadeState.FADE_OUT,r):c.ensureClouds(this.data)&&(0===this.opacity?this._startFade(a.FadeState.FADE_IN,r):this.data.state===c.CubeMapState.Ready&&(this.fadeState===a.FadeState.SHOW?this._startFade(a.FadeState.CROSS_FADE,r):this._startFade(a.FadeState.SHOW,r))))}_updateParallax(q){q=e.squaredLength(q.eye);this.parallax.radiusCurvatureCorrection=.84*Math.sqrt(Math.max(q-
f.earth.radius*f.earth.radius,0))/Math.sqrt(q);d.fromPoints(u,this.parallax.anchorPoint,t);p.rotate(this.parallax.transform,h.IDENTITY,t[3],d.axis(t));d.fromPoints(u,this.parallaxNew.anchorPoint,t);p.rotate(this.parallaxNew.transform,h.IDENTITY,t[3],d.axis(t))}_updateAnchorPoint(q){e.normalize(this._anchorPoint,q.eye);e.scale(this._anchorPoint,this._anchorPoint,f.earth.radius);return this.fadeState===a.FadeState.HIDE&&this.data?.state===c.CubeMapState.Ready?(e.copy(this.parallax.anchorPoint,this._anchorPoint),
0):e.length(e.subtract(m,this.parallax.anchorPoint,this._anchorPoint))}requestFade(){this._fadeFactor.value=0}_startFade(q,r){this._fadeState.value=q;this.startTime=r;switch(q){case a.FadeState.CROSS_FADE:this.requestFade();this._switchReadChannels();e.copy(this.parallaxNew.anchorPoint,this._anchorPoint);break;case a.FadeState.FADE_IN:this.requestFade();this._switchReadChannels();e.copy(this.parallax.anchorPoint,this._anchorPoint);e.copy(this.parallaxNew.anchorPoint,this._anchorPoint);break;case a.FadeState.FADE_OUT:this.requestFade();
break;case a.FadeState.SHOW:this._switchReadChannels();e.copy(this.parallax.anchorPoint,this._anchorPoint);e.copy(this.parallaxNew.anchorPoint,this._anchorPoint);this._endFade();break;case a.FadeState.HIDE:this._endFade()}}_endFade(){this._fadeFactor.value=1;this.data&&this.data.state!==c.CubeMapState.Ready&&(this.data.state=c.CubeMapState.Idle);switch(this.fadeState){case a.FadeState.CROSS_FADE:e.copy(this.parallax.anchorPoint,this.parallaxNew.anchorPoint);this._fadeState.value=a.FadeState.SHOW;
break;case a.FadeState.FADE_IN:this._fadeState.value=a.FadeState.SHOW;break;case a.FadeState.FADE_OUT:this._fadeState.value=a.FadeState.HIDE;break;case a.FadeState.SHOW:case a.FadeState.HIDE:break;default:b.neverReached(this.fadeState)}}_switchReadChannels(){this.data?.state===c.CubeMapState.Ready&&(this._readChannels=1-this._readChannels,this.data.state=c.CubeMapState.Fading)}get isFading(){return this.fadeState===a.FadeState.FADE_OUT||this.fadeState===a.FadeState.FADE_IN||this.fadeState===a.FadeState.CROSS_FADE}}
a.FadeState=void 0;(function(q){q[q.HIDE=0]="HIDE";q[q.FADE_IN=1]="FADE_IN";q[q.SHOW=2]="SHOW";q[q.CROSS_FADE=3]="CROSS_FADE";q[q.FADE_OUT=4]="FADE_OUT"})(a.FadeState||(a.FadeState={}));class x{constructor(){this.anchorPoint=g.create();this.radiusCurvatureCorrection=0;this.transform=h.create()}}const u=g.fromValues(0,0,1),t=d.create(),m=g.create();a.CloudsParameters=w;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/TextureCubePassUniform":function(){define(["exports",
"./Uniform","../shaderTechnique/BindType"],function(a,b,n){class k extends b.Uniform{constructor(p,h){super(p,"samplerCube",n.BindType.Pass,(e,g,d)=>e.bindTexture(p,h(g,d)))}}a.TextureCubePassUniform=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/ToneMapping.glsl":function(){define(["exports","../core/shaderModules/interfaces"],function(a,b){a.ToneMapping=function(n){n.code.add(b.glsl`vec3 tonemapACES(vec3 x) {
return clamp((x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14), 0.0, 1.0);
}`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/TextureOnly.glsl":function(){define("exports ../core/libs/gl-matrix-2/factories/vec3f64 ../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass.glsl ../views/3d/webgl-engine/core/shaderModules/Float3PassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform".split(" "),function(a,b,n,
k,p,h,e){function g(){const c=new h.ShaderBuilder;c.include(n.ScreenSpacePass);c.fragment.uniforms.add(new e.Texture2DPassUniform("tex",l=>l.texture),new k.Float3PassUniform("uColor",l=>l.color));c.fragment.main.add(p.glsl`vec4 texColor = texture(tex, uv);
fragColor = texColor * vec4(uColor, 1.0);`);return c}class d extends p.NoParameters{constructor(){super(...arguments);this.color=b.fromValues(1,1,1)}}const f=Object.freeze(Object.defineProperty({__proto__:null,TextureOnlyPassParameters:d,build:g},Symbol.toStringTag,{value:"Module"}));a.TextureOnly=f;a.TextureOnlyPassParameters=d;a.build=g})},"esri/views/3d/webgl-engine/effects/highlight/Highlight":function(){define("exports ../../../../../chunks/tslib.es6 ../../../../../core/has ../../../../../core/maybe ../../../../../core/reactiveUtils ../../../../../core/accessorSupport/decorators/property ../../../../../core/Logger ../../../../../core/RandomLCG ../../../../../core/accessorSupport/decorators/subclass ../../../../../core/libs/gl-matrix-2/math/vec2 ../../../../../core/libs/gl-matrix-2/factories/vec4f64 ../../../webgl ../../../webgl/formats ../../../webgl/RenderNode ./HighlightApplyTechnique ./HighlightDownsampleTechnique ./HighlightPassParameters ./HighlightToSingleTechnique ./SingleHighlightApplyTechnique ./SingleHighlightBlurTechnique ../../lib/basicInterfaces ../../lib/DefaultVertexAttributeLocations ../../lib/DefaultVertexBufferLayouts ../../lib/VertexArrayObject ../../../../../chunks/HighlightDownsample.glsl ../../../../../chunks/SingleHighlightBlur.glsl ../../../../support/HighlightDefaults ../../../../webgl/BufferObject ../../../../webgl/enums ../../../../webgl/Texture ../../../../webgl/TextureDescriptor".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w,x,u,t,m,q,r,v,y,B,z,A,C,H,E,F,G,D,I){function J(W){const V=new Uint8Array(128);N(W,(ba,U)=>{ba=ba.options;const da=4*U;U=4*U+64;const {color:fa}=ba,ha=ba.haloColor??fa;V[da+0]=fa.r;V[da+1]=fa.g;V[da+2]=fa.b;V[da+3]=ba.fillOpacity*fa.a*255;V[U+0]=ha.r;V[U+1]=ha.g;V[U+2]=ha.b;V[U+3]=ba.haloOpacity*ha.a*255});return V}function N(W,V){var ba=Math.min(W.length,E.maximumHighlights),U=E.maximumHighlights;for(--ba;0<=ba;--ba){var da=W.at(ba);da&&(da=da.name,K.includes(da,
U)||(--U,K[U]=da,L[U]=ba))}U=E.maximumHighlights-U;for(ba=0;ba<U;++ba)da=W.at(L[E.maximumHighlights-U+ba]),V(da,ba)}function M(W){let V=0;const ba=Math.min(E.maximumHighlights,W.length);for(let U=0;U<ba;++U){const da=W.at(U);if(da){const {name:fa,options:ha}=da;V+=fa.length;const {color:T,fillOpacity:S,haloColor:Z,haloOpacity:ia}=ha;V+=T.r+(Z?.r??1)+S+ia}}if(W=W.at(0)){const {shadowOpacity:U,shadowDifference:da,shadowColor:fa}=W.options;V+=U+da+fa.r}return P++ +(0<=V?0:1)}function Q(W){const V=new Set;
for(let ba=0;ba<E.maximumHighlights;++ba){const U=W.at(ba)?.name;U&&V.add(U)}return V.size}a.Highlight=class extends x{constructor(W){super(W);this.produces=l.InternalRenderCategory.HIGHLIGHTS;this.consumes={required:[l.InternalRenderCategory.HIGHLIGHTS,"highlights"]};this.useMultipleHighlights=!!n("enable-feature:multiple-highlights");this._optionsTexture=null;this._downsampleDrawParameters=new C.HighlightDownsampleDrawParameters;this._passParameters=new m.HighlightPassParameters;this._singleHighlightBlurDrawParameters=
new H.SingleHighlightBlurDrawParameters;this._grid=new O;W.techniques.precompile(t.HighlightDownsampleTechnique);this.useMultipleHighlights?W.techniques.precompile(u.HighlightApplyTechnique):(W.techniques.precompile(q.HighlightToSingleTechnique),W.techniques.precompile(v.SingleHighlightBlurTechnique),W.techniques.precompile(r.SingleHighlightApplyTechnique))}initialize(){this.addHandles([p.watch(()=>M(this.view.highlights),()=>{this._optionsTexture=k.disposeMaybe(this._optionsTexture);this.requestRender(y.RenderRequestType.UPDATE)},
p.initial)])}destroy(){this._passParameters&&(this._passParameters.highlightOptionsTexture=null);this._grid.coverage=k.releaseMaybe(this._grid.coverage);this._grid.vao=k.disposeMaybe(this._grid.vao);this._optionsTexture=k.releaseMaybe(this._optionsTexture)}_updateOptionsTexture(W){const V=this.renderingContext;var ba=this._optionsTexture;null==ba&&(ba=new I.TextureDescriptor(16,2),ba.internalFormat=G.PixelFormat.RGBA,ba.samplingMode=G.TextureSamplingMode.NEAREST,this._optionsTexture=ba=new D.Texture(V,
ba,null));ba.setData(W);this._passParameters.highlightOptionsTexture=ba}render(W){const V=W.find(({name:Y})=>Y===l.InternalRenderCategory.HIGHLIGHTS),{techniques:ba,bindParameters:U,_passParameters:da,renderingContext:fa}=this;if(!U.decorations)return V;const ha=ba.acquire(t.HighlightDownsampleTechnique);if(!ha.compiled)return ha.release(),this.requestRender(y.RenderRequestType.UPDATE),V;const T=W.find(({name:Y})=>"highlights"===Y).getTexture();W=()=>{var {highlights:Y}=this.view;this._optionsTexture||
this._updateOptionsTexture(J(Y));da.highlightOptionsTexture=this._optionsTexture;this._gridUpdateResources(T);Y=this._gridComputeCoverage(ha,T,U);ha.release();const {horizontalCellCount:ea,verticalCellCount:ka}=Y;da.horizontalCellCount=ea;da.verticalCellCount=ka;da.coverageTexture=Y.coverage?.getTexture();return Y};const S=Y=>{const ea=Y.verticalCellCount*Y.horizontalCellCount;fa.bindVAO(Y.vao);fa.drawElementsInstanced(G.PrimitiveType.TRIANGLES,6,G.DataType.UNSIGNED_BYTE,0,ea)},{camera:Z}=U,ia=()=>
{fa.bindFramebuffer(V.fbo);fa.setViewport4fv(Z.fullViewport)};this.useMultipleHighlights?this._renderMultiple(T,W,S,ia):this._renderSingle(T,W,S,ia);da.highlightTexture=null;da.coverageTexture=null;return V}_renderMultiple(W,V,ba,U){const {techniques:da,bindParameters:fa,_passParameters:ha,renderingContext:T}=this,S=da.acquire(u.HighlightApplyTechnique);S.compiled?(V=V(),ha.highlightTexture=W,ha.pixelRatio=fa.camera.pixelRatio,ha.maxHighlightLevel=Q(this.view.highlights)-1,T.bindTechnique(S,fa,ha),
U(),ba(V),S.release()):(S.release(),this.requestRender(y.RenderRequestType.UPDATE))}_renderSingle(W,V,ba,U){const {fboCache:da,techniques:fa,bindParameters:ha,_passParameters:T,renderingContext:S}=this,Z=fa.acquire(q.HighlightToSingleTechnique),ia=fa.acquire(v.SingleHighlightBlurTechnique),Y=fa.acquire(r.SingleHighlightApplyTechnique);if(Y.compiled&&ia.compiled&&Z.compiled){V=V();var {width:ea,height:ka}=W.descriptor;T.maxHighlightLevel=Q(this.view.highlights)-1;T.highlightTexture=W;({camera:W}=ha);
var {fullWidth:ja,fullHeight:X,pixelRatio:aa}=W;W=Math.ceil(ja/aa);var pa=Math.ceil(X/aa),{_singleHighlightBlurDrawParameters:la}=this;for(let na=0;na<=T.maxHighlightLevel;++na){T.highlightLevel=na;S.setClearColor(0,0,0,0);const qa=da.acquire(ea,ka,"single highlight",w.ColorFormat.RG);S.bindFramebuffer(qa.fbo);S.setViewport(0,0,ea,ka);S.clear(G.FramebufferBit.COLOR);S.bindTechnique(Z,ha,T);ba(V);la.blurInput=qa.getTexture();f.set(la.blurSize,1/W,0);const sa=da.acquire(W,pa,"single highlight blur h",
w.ColorFormat.RG);S.unbindTexture(sa.fbo?.colorTexture);S.bindFramebuffer(sa.fbo);S.setViewport(0,0,W,pa);S.clear(G.FramebufferBit.COLOR);la.blurInput=qa.getTexture();f.set(la.blurSize,1/W,0);S.bindTechnique(ia,ha,T,la);ba(V);qa.release();f.set(la.blurSize,0,1/pa);T.singleHighlightBlurTexture=sa.getTexture();U();S.bindTechnique(Y,ha,T,la);ba(V);sa.release()}Z.release();ia.release();Y.release()}else Y.release(),ia.release(),Z.release(),this.requestRender(y.RenderRequestType.UPDATE)}_gridUpdateResources(W){const V=
this.renderingContext,ba=this._grid,{width:U,height:da}=W.descriptor;ba.horizontalCellCount=Math.ceil(U/C.gridCellPixelSize);ba.verticalCellCount=Math.ceil(da/C.gridCellPixelSize);ba.vao||(W=F.BufferObject.createIndex(V,G.Usage.STATIC_DRAW,R),ba.vao=new A.VertexArrayObject(V,B.Default3D,new Map([["geometry",z.NoVertex]]),new Map([["geometry",F.BufferObject.createVertex(V,G.Usage.STATIC_DRAW)]]),W))}_gridComputeCoverage(W,V,ba){const U=this.renderingContext,da=this._grid;var fa=V.descriptor;const ha=
Math.ceil(fa.width/C.gridCellPixelSize);fa=Math.ceil(fa.height/C.gridCellPixelSize);this._downsampleDrawParameters.input=V;da.coverage?.release();V=this.fboCache.acquire(ha,fa,"highlight coverage",w.ColorFormat.RG);da.coverage=V;U.bindFramebuffer(V.fbo);U.bindTechnique(W,ba,this._passParameters,this._downsampleDrawParameters);U.setViewport(0,0,ha,fa);U.screen.draw();return da}get test(){}};b.__decorate([h.property()],a.Highlight.prototype,"produces",void 0);b.__decorate([h.property()],a.Highlight.prototype,
"consumes",void 0);b.__decorate([h.property({constructOnly:!0})],a.Highlight.prototype,"techniques",void 0);a.Highlight=b.__decorate([d.subclass("esri.views.3d.webgl-engine.effects.highlight.Highlight")],a.Highlight);class O{constructor(){this.vao=this.coverage=null;this.viewportHeight=this.viewportWidth=this.horizontalCellCount=this.verticalCellCount=0}}const K=Array(E.maximumHighlights),L=Array(E.maximumHighlights);let P=0;const R=new Uint8Array([0,1,2,2,1,3]);a.renderHighlightBuffer=function(W,
V,ba,U,da,fa,ha=0,T){const {highlightGroupIndices:S}=da;S.clear();const Z=[];N(U,ea=>{({name:ea}=ea);S.set(ea,Z.length);Z.push(ea)});U=S.size;const {gl:ia}=W;f.set(da.highlightMixOrigin,ha,0);let Y=null;1<U&&(Y=V.acquire(ba.width,ba.height,"highlight mix",w.ColorFormat.RG),W.bindFramebuffer(Y.fbo),W.clearFramebuffer(c.ZEROS));V=Y?.getTexture()??null;da.highlightMixTexture=V;T();for(T=0;T<U;++T)0<T&&(W.bindTexture(V,0),ia.copyTexSubImage2D(G.TextureType.TEXTURE_2D,0,0,0,ha,0,ba.width,ba.height),W.bindTexture(null,
0)),W.clear(G.FramebufferBit.DEPTH),da.highlightLevel=T,da.highlightGroupName=Z[T],fa();Y?.release()};a.trackHighlightOptions=M;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/effects/highlight/HighlightApplyTechnique":function(){define("require exports ../../core/shaderTechnique/ReloadableShaderModule ../../core/shaderTechnique/ShaderTechnique ../../../../../chunks/HighlightApply.glsl ../../../../webgl/renderState".split(" "),function(a,b,n,k,p,h){class e extends k.ShaderTechnique{constructor(g,
d,f){super(g,d,new n.ReloadableShaderModule(p.HighlightApply,()=>new Promise((c,l)=>a(["../../shaders/HighlightApply.glsl"],c,l))),f)}initializePipeline(){return h.makePipelineState({blending:h.premultipliedAlphaToPremultipliedAlpha,colorWrite:h.defaultColorWrite})}}b.HighlightApplyTechnique=e;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/HighlightApply.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderLibrary/HighlightCellGridScreenSpacePass.glsl ../views/3d/webgl-engine/core/shaderLibrary/HighlightReadBitmap.glsl ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/IntegerPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform".split(" "),
function(a,b,n,k,p,h,e,g){function d(){const c=new e.ShaderBuilder;c.include(b.HighlightCellGridScreenSpacePass);const {fragment:l}=c;l.uniforms.add(new g.Texture2DPassUniform("highlightTexture",w=>w.highlightTexture),new g.Texture2DPassUniform("highlightOptionsTexture",w=>w.highlightOptionsTexture),new k.FloatPassUniform("pixelRatio",w=>w.pixelRatio),new k.FloatPassUniform("occludedIntensityFactor",w=>w.occludedFactor),new p.IntegerPassUniform("maxHighlightLevel",w=>w.maxHighlightLevel));l.constants.add("pixelSampleScale",
"float",1);c.include(n.HighlightReadBitmap);l.code.add(h.glsl`const float pascal17[9] = float[9](12870.0, 11440.0, 8008.0, 4368.0, 1820.0, 560.0, 120.0, 16.0, 1.0);
const float denom17 =  65536.0;
float colorWeight[16] = float[16](0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0);
float colorOcclusion[16] = float[16](0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0);
float weights[16] = float[16](0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0);
void applyTexel(vec2 texel, float weight) {
if (texel != vec2(0.0)){
int maxChannel = (maxHighlightLevel >> 2) & 1;
for (int channelIndex = 0; channelIndex <= maxChannel; ++channelIndex){
uint channel = readChannel(texel, channelIndex << 2);
int firstIndex = channelIndex << 2;
int maxIndex  = min(firstIndex + 3, maxHighlightLevel);
for (int highlightIndex = firstIndex; highlightIndex <= maxIndex; ++highlightIndex ) {
uint v = readChannelBits(channel, highlightIndex);
if ((v & 1u) == 1u){
colorWeight[highlightIndex] += weight;
if ((v & 2u) == 2u){
colorOcclusion[highlightIndex] += weight;
}
}
}
}
}
}
vec2 readTexel(ivec2 iuv, int du, int dv) {
return texelFetch(highlightTexture, iuv + ivec2(du, dv), 0).rg;
}
void readAndApplyTexel(ivec2 iuv, int du, int dv, float weight) {
vec2 texel = readTexel(iuv, du, dv);
applyTexel(texel, weight);
}
void readAndApply2TexelsU(ivec2 iuv, int du, int dv, float weight) {
readAndApplyTexel(iuv, -du, dv, weight);
readAndApplyTexel(iuv, +du, dv, weight);
}
float getWeight(int pixelDistance) {
float scaledDistance = float(pixelDistance) * pixelSampleScale / pixelRatio;
float d0f = floor(scaledDistance);
int d0 = int(d0f);
if (d0 >= 8){
return 0.0;
}
float w0 = pascal17[d0];
float w1 = pascal17[d0+1];
float f =  scaledDistance - d0f;
return mix(w0, w1, f);
}`);l.main.add(h.glsl`vec2 highlightTextureSize = vec2(textureSize(highlightTexture,0));
ivec2 iuv = ivec2(sUV * highlightTextureSize);
vec2 centerTexel = texelFetch(highlightTexture, iuv, 0).rg;
bool outlinePossible = false;
if (vOutlinePossible > 0.0){
for (int highlightLevel=0; highlightLevel<= maxHighlightLevel; ++highlightLevel) {
if ((readLevelBits(centerTexel,highlightLevel) & 1u) == 0u) {
outlinePossible = true;
break;
}
}
}
if (outlinePossible) {
int maxPixelDistance = clamp(int(8.0 * pixelRatio / pixelSampleScale), 2, 16);
float weightSum = 0.0;
for(int y = 0; y <= maxPixelDistance; ++y) {
float w = getWeight(y);
weights[y] = w;
weightSum += w * (y == 0 ? 1.0 : 2.0);
}
for(int y = 0; y <= maxPixelDistance; ++y) {
weights[y] = weights[y] / weightSum;
}
float weight0 = weights[0];
applyTexel(centerTexel, weight0 * weight0);
for(int y = 0; y <= maxPixelDistance; y += 1) {
float yFactor = weights[y];
if (y != 0) {
float xFactor = weight0;
float weight = xFactor * yFactor;
if (weight > 0.0) {
readAndApplyTexel(iuv, 0, +y, weight);
readAndApplyTexel(iuv, 0, -y, weight);
}
}
for(int x = 1; x <= maxPixelDistance; x += 1) {
float xFactor = weights[x];
float weight = xFactor * yFactor;
if (weight > 0.0) {
readAndApply2TexelsU(iuv, x, +y, weight);
if (y != 0){
readAndApply2TexelsU(iuv, x, -y, weight);
}
}
}
}
} else {
applyTexel(centerTexel, 1.0);
}
int frontColorIndex = 999;
int maxColorIndex = 0;
for (int i = 0; i <= maxHighlightLevel; ++i) {
if (colorWeight[i] > 0.0){
frontColorIndex = min(frontColorIndex, i);
maxColorIndex = max(maxColorIndex, i);
}
}
if (frontColorIndex == 999){
fragColor = vec4(0.0);
return;
}
vec4 accumulatedColor = vec4(0.0);
for (int curColorIndex = frontColorIndex; curColorIndex <= maxColorIndex; ++curColorIndex) {
float curColorWeight = colorWeight[curColorIndex];
if (curColorWeight <= 0.01){
continue;
}
uint vc = readLevelBits(centerTexel, curColorIndex);
bool centerFilled = (vc & 1u) == 1u;
bool centerOccluded = (vc & 3u) == 3u;
float curColorOcclusion = colorOcclusion[curColorIndex];
bool occluded = centerFilled ? centerOccluded : curColorOcclusion > 0.5 * curColorWeight;
int colorChannel = centerFilled ? 0 : 1;
vec4 colorBase = texelFetch(highlightOptionsTexture, ivec2(curColorIndex, colorChannel), 0);
float occlusionFactor = occluded ? occludedIntensityFactor : 1.0;
float outlineFactor = centerFilled ? 1.0 : smoothstep(0.0, 0.03, curColorWeight);
float intensity = colorBase.a * occlusionFactor * outlineFactor;
vec3 currentColor = colorBase.rgb;
float a0 = accumulatedColor.a;
float a1 = intensity;
float alpha = clamp(a0 + a1 - a0 * a1, 0.0, 1.0);
if (alpha > 0.001){
vec3 blendedColor = ((1.0 - a1) * a0 * accumulatedColor.rgb + a1 * currentColor) / alpha;
accumulatedColor = vec4(blendedColor, alpha);
}
}
fragColor = accumulatedColor;`);return c}const f=Object.freeze(Object.defineProperty({__proto__:null,build:d},Symbol.toStringTag,{value:"Module"}));a.HighlightApply=f;a.build=d})},"esri/views/3d/webgl-engine/core/shaderLibrary/HighlightCellGridScreenSpacePass.glsl":function(){define(["exports","../shaderModules/Integer2PassUniform","../shaderModules/interfaces","../shaderModules/Texture2DPassUniform","../../../../../chunks/HighlightDownsample.glsl"],function(a,b,n,k,p){a.HighlightCellGridScreenSpacePass=
function(h){const {vertex:e}=h;e.uniforms.add(new k.Texture2DPassUniform("coverageTexture",g=>g.coverageTexture),new b.Integer2PassUniform("highlightRenderCellCount",g=>[g.horizontalCellCount,g.verticalCellCount]),new b.Integer2PassUniform("highlightTextureResolution",g=>[g.highlightTexture.descriptor.width,g.highlightTexture.descriptor.height]));e.constants.add("cellSize","int",p.gridCellPixelSize);h.varyings.add("sUV","vec2");h.varyings.add("vOutlinePossible","float");e.code.add(n.glsl`const ivec2 cellVertices[4] = ivec2[4](ivec2(0,0), ivec2(1,0), ivec2(0,1), ivec2(1,1));`);
e.main.add(n.glsl`int cellIndex = gl_InstanceID;
int cellX = cellIndex % highlightRenderCellCount[0];
int cellY = (cellIndex - cellX) / highlightRenderCellCount[0];
ivec2 cellPos = ivec2(cellX, cellY);
vec4 cov = texelFetch(coverageTexture, cellPos, 0);
if (cov.r == 0.0) {
gl_Position = vec4(0.0);
return;
}
vOutlinePossible = cov.g;
ivec2 iPosInCell = cellVertices[gl_VertexID];
vec2 sPos = vec2(cellPos * cellSize + iPosInCell * (cellSize));
vec2 vPos = sPos / vec2(highlightTextureResolution);
sUV = vPos;
gl_Position = vec4(2.0 * vPos - vec2(1.0), 0.0, 1.0);`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/HighlightDownsample.glsl":function(){define(["exports","../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass.glsl","../views/3d/webgl-engine/core/shaderModules/interfaces","../views/3d/webgl-engine/core/shaderModules/ShaderBuilder","../views/3d/webgl-engine/core/shaderModules/Texture2DDrawUniform"],function(a,b,n,k,p){function h(){const d=new k.ShaderBuilder,
{outputs:f,fragment:c}=d;d.include(b.ScreenSpacePass);c.uniforms.add(new p.Texture2DDrawUniform("textureInput",l=>l.input));c.constants.add("outlineWidth","int",9);c.constants.add("cellSize","int",32);f.add("fragGrid","vec2");c.main.add(n.glsl`vec2 inputTextureSize = vec2(textureSize(textureInput, 0));
vec2 cellBottomLeftCornerInput = floor(gl_FragCoord.xy) * vec2(cellSize);
vec2 coordMid =  (cellBottomLeftCornerInput + 0.5 * vec2(cellSize)) / inputTextureSize;
vec2 commonValue = texture(textureInput, coordMid).rg;
int margin = outlineWidth;
float marginSquare = float(margin*margin);
for(int y = -margin; y <= cellSize + margin; y+=2) {
int dy = y < 0 ? -y : y > cellSize ? y-cellSize : 0;
int xMargin = dy > 0 ? int(ceil(sqrt(marginSquare - float(dy*dy)))) : margin;
for(int x = -xMargin; x <= cellSize + xMargin; x+=2) {
vec2 coord = (cellBottomLeftCornerInput + vec2(x, y)) / inputTextureSize;
vec2 value = texture(textureInput, coord).rg;
if (value != commonValue){
fragGrid = vec2(1.0, 1.0);
return;
}
}
}
bool hasAny = commonValue != vec2(0.0);
fragGrid = vec2(hasAny ? 1.0 : 0.0, 0.0);`);return d}class e extends n.NoParameters{}const g=Object.freeze(Object.defineProperty({__proto__:null,HighlightDownsampleDrawParameters:e,blurSize:.4,build:h,gridCellPixelSize:32,outlineSize:9},Symbol.toStringTag,{value:"Module"}));a.HighlightDownsample=g;a.HighlightDownsampleDrawParameters=e;a.blurSize=.4;a.build=h;a.gridCellPixelSize=32;a.outlineSize=9})},"esri/views/3d/webgl-engine/core/shaderLibrary/HighlightReadBitmap.glsl":function(){define(["exports",
"../shaderModules/interfaces"],function(a,b){a.HighlightReadBitmap=function(n){({fragment:n}=n);n.code.add(b.glsl`uint readChannelBits(uint channel, int highlightLevel) {
int llc = (highlightLevel & 3) << 1;
return (channel >> llc) & 3u;
}
uint readChannel(vec2 texel, int highlightLevel) {
int lic = (highlightLevel >> 2) & 1;
return uint(texel[lic] * 255.0);
}
uint readLevelBits(vec2 texel, int highlightLevel) {
return readChannelBits(readChannel(texel, highlightLevel), highlightLevel);
}`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/effects/highlight/HighlightDownsampleTechnique":function(){define("require exports ../../core/shaderTechnique/ReloadableShaderModule ../../core/shaderTechnique/ShaderTechnique ../../../../../chunks/HighlightDownsample.glsl ../../../../webgl/renderState".split(" "),function(a,b,n,k,p,h){class e extends k.ShaderTechnique{constructor(g,d,f){super(g,d,new n.ReloadableShaderModule(p.HighlightDownsample,()=>
new Promise((c,l)=>a(["../../shaders/HighlightDownsample.glsl"],c,l))),f)}initializePipeline(){return h.makePipelineState({colorWrite:h.defaultColorWrite})}}b.HighlightDownsampleTechnique=e;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/effects/highlight/HighlightPassParameters":function(){define(["exports","../../core/shaderModules/interfaces","../../../../support/HighlightDefaults"],function(a,b,n){class k extends b.NoParameters{constructor(){super(...arguments);
this.occludedFactor=n.defaultOccludedFactor;this.maxHighlightLevel=1;this.highlightLevel=this.horizontalCellCount=this.verticalCellCount=0;this.pixelRatio=1}}a.HighlightPassParameters=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/effects/highlight/HighlightToSingleTechnique":function(){define("require exports ../../core/shaderTechnique/ReloadableShaderModule ../../core/shaderTechnique/ShaderTechnique ../../../../../chunks/HighlightToSingle.glsl ../../../../webgl/renderState".split(" "),
function(a,b,n,k,p,h){class e extends k.ShaderTechnique{constructor(g,d,f){super(g,d,new n.ReloadableShaderModule(p.HighlightToSingle,()=>new Promise((c,l)=>a(["../../shaders/HighlightToSingle.glsl"],c,l))),f)}initializePipeline(){return h.makePipelineState({colorWrite:h.defaultColorWrite})}}b.HighlightToSingleTechnique=e;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/HighlightToSingle.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderLibrary/HighlightCellGridScreenSpacePass.glsl ../views/3d/webgl-engine/core/shaderLibrary/HighlightReadBitmap.glsl ../views/3d/webgl-engine/core/shaderModules/IntegerPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform".split(" "),
function(a,b,n,k,p,h,e){function g(){const f=new h.ShaderBuilder;f.include(b.HighlightCellGridScreenSpacePass);f.include(n.HighlightReadBitmap);const {fragment:c}=f;f.outputs.add("fragSingleHighlight","vec2",0);c.uniforms.add(new e.Texture2DPassUniform("highlightTexture",l=>l.highlightTexture),new k.IntegerPassUniform("maxHighlightLevel",l=>l.maxHighlightLevel),new k.IntegerPassUniform("highlightLevel",l=>l.highlightLevel));f.include(n.HighlightReadBitmap);c.main.add(p.glsl`ivec2 iuv = ivec2(gl_FragCoord.xy);
vec2 inputTexel = texelFetch(highlightTexture, iuv, 0).rg;
uint bits = readLevelBits(inputTexel, highlightLevel);
bool hasHighlight = (bits & 1u) == 1u;
bool hasOccluded  = (bits & 2u) == 2u;
fragSingleHighlight = vec2(hasHighlight ? 1.0 : 0.0, hasOccluded ? 1.0 : 0.0);`);return f}const d=Object.freeze(Object.defineProperty({__proto__:null,build:g},Symbol.toStringTag,{value:"Module"}));a.HighlightToSingle=d;a.build=g})},"esri/views/3d/webgl-engine/effects/highlight/SingleHighlightApplyTechnique":function(){define("require exports ../../core/shaderTechnique/ReloadableShaderModule ../../core/shaderTechnique/ShaderTechnique ../../../../../chunks/SingleHighlightApply.glsl ../../../../webgl/renderState".split(" "),
function(a,b,n,k,p,h){class e extends k.ShaderTechnique{constructor(g,d,f){super(g,d,new n.ReloadableShaderModule(p.SingleHighlightApply,()=>new Promise((c,l)=>a(["../../shaders/SingleHighlightApply.glsl"],c,l))),f)}initializePipeline(){return h.makePipelineState({blending:h.premultipliedAlphaToPremultipliedAlpha,colorWrite:h.defaultColorWrite})}}b.SingleHighlightApplyTechnique=e;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/SingleHighlightApply.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderLibrary/HighlightCellGridScreenSpacePass.glsl ../views/3d/webgl-engine/core/shaderLibrary/HighlightReadBitmap.glsl ../views/3d/webgl-engine/core/shaderModules/Float2DrawUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/IntegerPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform ./HighlightDownsample.glsl".split(" "),
function(a,b,n,k,p,h,e,g,d,f){function c(){const w=new g.ShaderBuilder;w.include(b.HighlightCellGridScreenSpacePass);const {fragment:x}=w;x.uniforms.add(new d.Texture2DPassUniform("blurInput",u=>u.singleHighlightBlurTexture),new k.Float2DrawUniform("blurSize",u=>u.blurSize),new d.Texture2DPassUniform("highlightTexture",u=>u.highlightTexture),new d.Texture2DPassUniform("highlightOptionsTexture",u=>u.highlightOptionsTexture),new h.IntegerPassUniform("highlightLevel",u=>u.highlightLevel),new p.FloatPassUniform("occludedIntensityFactor",
u=>u.occludedFactor));x.constants.add("inner","float",1-(f.outlineSize-f.blurSize)/f.outlineSize);w.include(n.HighlightReadBitmap);x.main.add(e.glsl`vec2 highlightTextureSize = vec2(textureSize(highlightTexture,0));
vec2 uv = sUV;
vec2 center = texture(blurInput, uv).rg;
vec2 blurredHighlightValue = (vOutlinePossible == 0.0)
? center
: center * 0.204164
+ texture(blurInput, uv + blurSize * 1.407333).rg * 0.304005
+ texture(blurInput, uv - blurSize * 1.407333).rg * 0.304005
+ texture(blurInput, uv + blurSize * 3.294215).rg * 0.093913
+ texture(blurInput, uv - blurSize * 3.294215).rg * 0.093913;
float highlightIntensity = blurredHighlightValue.r;
float occlusionWeight = blurredHighlightValue.g;
if (highlightIntensity <= 0.01) {
discard;
}
vec4 fillColor    = texelFetch(highlightOptionsTexture, ivec2(highlightLevel, 0), 0);
vec4 outlineColor = texelFetch(highlightOptionsTexture, ivec2(highlightLevel, 1), 0);
vec2 centerTexel = texelFetch(highlightTexture, ivec2(uv * highlightTextureSize), 0).rg;
uint centerBits = readLevelBits(centerTexel, highlightLevel);
bool centerFilled = (centerBits & 1u) == 1u;
bool centerOccluded = (centerBits & 3u) == 3u;
bool occluded = centerOccluded || (0.5 * highlightIntensity < occlusionWeight);
float occlusionFactor = occluded ? occludedIntensityFactor : 1.0;
float outlineFactor = centerFilled ? 1.0 : smoothstep(0.0, inner, highlightIntensity);
float fillFactor = centerFilled ? 1.0 : 0.0;
vec4 baseColor = mix(outlineColor, fillColor, fillFactor);
float intensity = baseColor.a * occlusionFactor * outlineFactor;
fragColor = vec4(baseColor.rgb, intensity);`);return w}const l=Object.freeze(Object.defineProperty({__proto__:null,build:c},Symbol.toStringTag,{value:"Module"}));a.SingleHighlightApply=l;a.build=c})},"esri/views/3d/webgl-engine/effects/highlight/SingleHighlightBlurTechnique":function(){define("require exports ../../core/shaderTechnique/ReloadableShaderModule ../../core/shaderTechnique/ShaderTechnique ../../../../../chunks/SingleHighlightBlur.glsl ../../../../webgl/renderState".split(" "),function(a,
b,n,k,p,h){class e extends k.ShaderTechnique{constructor(g,d,f){super(g,d,new n.ReloadableShaderModule(p.SingleHighlightBlur,()=>new Promise((c,l)=>a(["../../shaders/SingleHighlightBlur.glsl"],c,l))),f)}initializePipeline(){return h.makePipelineState({colorWrite:h.defaultColorWrite})}}b.SingleHighlightBlurTechnique=e;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/SingleHighlightBlur.glsl":function(){define("exports ../core/libs/gl-matrix-2/factories/vec2f64 ../views/3d/webgl-engine/core/shaderLibrary/HighlightCellGridScreenSpacePass.glsl ../views/3d/webgl-engine/core/shaderModules/Float2DrawUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DDrawUniform".split(" "),
function(a,b,n,k,p,h,e){function g(){const c=new h.ShaderBuilder;c.include(n.HighlightCellGridScreenSpacePass);c.fragment.uniforms.add(new k.Float2DrawUniform("blurSize",l=>l.blurSize),new e.Texture2DDrawUniform("blurInput",l=>l.blurInput));c.outputs.add("fragSingleHighlight","vec2",0);c.fragment.main.add(p.glsl`vec2 highlightTextureSize = vec2(textureSize(blurInput,0));
vec2 uv = sUV;
vec2 center = texture(blurInput, uv).rg;
if (vOutlinePossible == 0.0) {
fragSingleHighlight = center;
} else {
vec2 sum = center * 0.204164;
sum += texture(blurInput, uv + blurSize * 1.407333).rg * 0.304005;
sum += texture(blurInput, uv - blurSize * 1.407333).rg * 0.304005;
sum += texture(blurInput, uv + blurSize * 3.294215).rg * 0.093913;
sum += texture(blurInput, uv - blurSize * 3.294215).rg * 0.093913;
fragSingleHighlight = sum;
}`);return c}class d extends p.NoParameters{constructor(){super(...arguments);this.blurSize=b.create()}}const f=Object.freeze(Object.defineProperty({__proto__:null,SingleHighlightBlurDrawParameters:d,build:g},Symbol.toStringTag,{value:"Module"}));a.SingleHighlightBlur=f;a.SingleHighlightBlurDrawParameters=d;a.build=g})},"esri/views/3d/webgl-engine/lib/DefaultVertexBufferLayouts":function(){define(["exports","./VertexAttribute","../../../webgl/enums","../../../webgl/VertexElementDescriptor"],function(a,
b,n,k){const p=[new k.VertexElementDescriptor(b.VertexAttribute.POSITION,3,n.DataType.FLOAT,0,12)],h=[new k.VertexElementDescriptor(b.VertexAttribute.POSITION,2,n.DataType.FLOAT,0,8)];b=[new k.VertexElementDescriptor(b.VertexAttribute.POSITION,2,n.DataType.FLOAT,0,16),new k.VertexElementDescriptor(b.VertexAttribute.UV0,2,n.DataType.FLOAT,8,16)];a.NoVertex=[];a.Pos2=h;a.Pos2Tex=b;a.Pos3=p;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/GLMaterialRepository":function(){define(["exports",
"../../../../core/Logger","../../../../core/maybe","../../../../core/NestedMap","./Util"],function(a,b,n,k,p){class h{constructor(g,d,f,c){this._textures=g;this._techniques=d;this.materialChanged=f;this.requestRender=c;this._id2glMaterialRef=new k.NestedMap}dispose(){this._textures.destroy()}acquire(g,d,f){this._ownMaterial(g);if(!g.produces.get(d)?.(f))return null;d=this._id2glMaterialRef.get(f,g.id);null==d&&(d=g.createGLMaterial({material:g,techniques:this._techniques,textures:this._textures,output:f}),
d=new e(d),this._id2glMaterialRef.set(f,g.id,d));d.ref();return d.glMaterial}release(g,d){const f=this._id2glMaterialRef.get(d,g.id);null!=f&&(f.unref(),f.referenced||(n.disposeMaybe(f.glMaterial),this._id2glMaterialRef.delete(d,g.id)))}_ownMaterial(g){g.repository&&g.repository!==this&&b.getLogger("esri.views.3d.webgl-engine.lib.GLMaterialRepository").error("Material is already owned by a different material repository");g.repository=this}}class e{constructor(g){this.glMaterial=g;this._refCnt=0}ref(){++this._refCnt}unref(){--this._refCnt;
p.assert(0<=this._refCnt)}get referenced(){return 0<this._refCnt}}a.GLMaterialRepository=h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/GridLocalOriginFactory":function(){define("exports ../../../../core/has ../../../../core/uid ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../core/libs/gl-matrix-2/factories/vec4f64 ../../../../geometry/projection/projectBuffer ./Attribute ./ContentObjectType ./Geometry ./LocalOriginFactory ./Object3D ./testUtils ./VertexAttribute ./WebGLLayer ../materials/RibbonLineMaterial".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w,x,u,t){class m{constructor(r){this._originSR=r;this._rootOriginId="root/"+n.generateUID();this._origins=new Map;this._objects=new Map;this._gridSize=5E5}getOrigin(r){var v=this._origins.get(this._rootOriginId);if(null==v){v=w.gridLocalOriginFactory.rootOrigin;if(null!=v)return this._origins.set(this._rootOriginId,c.fromValues(v[0],v[1],v[2],this._rootOriginId)),this.getOrigin(r);r=c.fromValues(r[0]+Math.random()-.5,r[1]+Math.random()-.5,r[2]+Math.random()-.5,this._rootOriginId);
this._origins.set(this._rootOriginId,r);return r}var y=this._gridSize;const B=Math.round(r[0]/y),z=Math.round(r[1]/y),A=Math.round(r[2]/y),C=`${B}/${z}/${A}`;let H=this._origins.get(C);const E=.5*y;k.subtract(q,r,v.vec3);q[0]=Math.abs(q[0]);q[1]=Math.abs(q[1]);q[2]=Math.abs(q[2]);if(q[0]<E&&q[1]<E&&q[2]<E)return H&&(y=Math.max(...q),k.subtract(q,r,H.vec3),q[0]=Math.abs(q[0]),q[1]=Math.abs(q[1]),q[2]=Math.abs(q[2]),Math.max(...q)<y)?H:v;H||(H=c.fromValues(B*y,z*y,A*y,C),this._origins.set(C,H));return H}_drawOriginBox(r,
v=h.fromValues(1,1,0,1)){const y=window.view,B=y._stage;var z=v.toString();if(!this._objects.has(z)){this._material=new t.RibbonLineMaterial({width:2,color:v});B.add(this._material);v=new u.WebGLLayer(B,{pickable:!1});var A=new l.Object3D({castShadow:!1});B.add(A);v.add(A);this._objects.set(z,A)}z=this._objects.get(z);v=[0,1,5,4,0,2,1,7,6,2,0,1,3,7,5,4,6,2,0];A=v.length;const C=Array(3*A),H=[],E=.5*this._gridSize;for(let F=0;F<A;F++)C[3*F]=r[0]+(v[F]&1?E:-E),C[3*F+1]=r[1]+(v[F]&2?E:-E),C[3*F+2]=r[2]+
(v[F]&4?E:-E),0<F&&H.push(F-1,F);e.projectBuffer(C,this._originSR,0,C,y.renderSpatialReference,0,A);r=new f.Geometry(this._material,[[x.VertexAttribute.POSITION,new g.Attribute(C,H,3,!0)]],null,d.ContentObjectType.Line);B.add(r);z.addGeometry(r)}get test(){}}const q=p.create();a.GridLocalOriginFactory=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/RibbonLineMaterial":function(){define("exports ../../../../core/Logger ../../../../core/mathUtils ../../../../core/screenUtils ../../../../core/libs/gl-matrix-2/math/vec2 ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../core/libs/gl-matrix-2/factories/vec4f64 ../../../../geometry/support/frustum ../../../../geometry/support/lineSegment ../../../../geometry/support/plane ../../support/buffer/InterleavedLayout ../core/shaderLibrary/ShaderOutput ../core/shaderLibrary/util/AlphaCutoff ../effects/geometry/olidUtils ../lib/GLMaterial ../lib/Material ../lib/RenderSlot ../lib/Util ../lib/VertexAttribute ./VisualVariablePassParameters ../shaders/LineMarkerTechniqueConfiguration ../../../../chunks/RibbonLine.glsl ../shaders/RibbonLineTechnique ../shaders/RibbonLineTechniqueConfiguration".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w,x,u,t,m,q,r,v,y,B,z,A,C){function H(ea,ka,ja,X,aa){for(let pa=0;pa<aa;pa++)ja[X++]=ea[ka++];return X}function E(ea,ka){return ea.isClosed?2<ka.get(v.VertexAttribute.POSITION).indices.length:!1}var F;(function(ea){ea[ea.LEFT_JOIN_START=-2]="LEFT_JOIN_START";ea[ea.LEFT_JOIN_END=-1]="LEFT_JOIN_END";ea[ea.LEFT_CAP_START=-4]="LEFT_CAP_START";ea[ea.LEFT_CAP_END=-5]="LEFT_CAP_END";ea[ea.RIGHT_JOIN_START=2]="RIGHT_JOIN_START";ea[ea.RIGHT_JOIN_END=1]="RIGHT_JOIN_END";ea[ea.RIGHT_CAP_START=
4]="RIGHT_CAP_START";ea[ea.RIGHT_CAP_END=5]="RIGHT_CAP_END"})(F||={});class G extends m.Material{constructor(ea){super(ea,I);this._configuration=new C.RibbonLineTechniqueConfiguration;this.vertexAttributeLocations=A.vertexAttributeLocations;this.produces=new Map([[q.RenderSlot.OPAQUE_MATERIAL,ka=>w.isHighlightOrOID(ka)||w.isColor(ka)&&this.parameters.renderOccluded===m.RenderOccludedFlag.OccludeAndTransparentStencil],[q.RenderSlot.OPAQUE_MATERIAL_WITHOUT_NORMALS,ka=>w.isDepth(ka)],[q.RenderSlot.OCCLUDER_MATERIAL,
ka=>w.isColorHighlightOIDOrDepth(ka)&&this.parameters.renderOccluded===m.RenderOccludedFlag.OccludeAndTransparentStencil],[q.RenderSlot.TRANSPARENT_OCCLUDER_MATERIAL,ka=>w.isColorHighlightOIDOrDepth(ka)&&this.parameters.renderOccluded===m.RenderOccludedFlag.OccludeAndTransparentStencil],[q.RenderSlot.TRANSPARENT_MATERIAL,ka=>ka===w.ShaderOutput.Color&&this.parameters.writeDepth&&this.parameters.renderOccluded!==m.RenderOccludedFlag.OccludeAndTransparentStencil],[q.RenderSlot.TRANSPARENT_MATERIAL_WITHOUT_DEPTH,
ka=>ka===w.ShaderOutput.Color&&!this.parameters.writeDepth&&this.parameters.renderOccluded!==m.RenderOccludedFlag.OccludeAndTransparentStencil],[q.RenderSlot.DRAPED_MATERIAL,ka=>w.is2DGeometryOutput(ka)]])}getConfiguration(ea,ka){this._configuration.output=ea;this._configuration.oitPass=ka.oitPass;this._configuration.draped=ka.slot===q.RenderSlot.DRAPED_MATERIAL;ea=null!=this.parameters.stipplePattern&&ea!==w.ShaderOutput.Highlight;this._configuration.stippleEnabled=ea;this._configuration.stippleOffColorEnabled=
ea&&null!=this.parameters.stippleOffColor;this._configuration.stipplePreferContinuous=ea&&this.parameters.stipplePreferContinuous;this._configuration.hasSlicePlane=this.parameters.hasSlicePlane;this._configuration.roundJoins="round"===this.parameters.join;this._configuration.capType=this.parameters.cap;ea=this._configuration;if(null!=this.parameters.markerParameters){var ja=this.parameters.markerParameters;ja=ja.anchor===B.LineMarkerAnchor.Tip&&ja.hideOnShortSegments&&"begin-end"===ja.placement&&
ja.worldSpace}else ja=!1;ea.applyMarkerOffset=ja;this._configuration.hasPolygonOffset=this.parameters.hasPolygonOffset;this._configuration.writeDepth=this.parameters.writeDepth;this._configuration.vvSize=!!this.parameters.vvSize;this._configuration.vvColor=!!this.parameters.vvColor;this._configuration.vvOpacity=!!this.parameters.vvOpacity;this._configuration.innerColorEnabled=0<this.parameters.innerWidth&&null!=this.parameters.innerColor;this._configuration.falloffEnabled=0<this.parameters.falloff;
this._configuration.hasOccludees=ka.hasOccludees;this._configuration.occluder=this.parameters.renderOccluded===m.RenderOccludedFlag.OccludeAndTransparentStencil;this._configuration.terrainDepthTest=ka.terrainDepthTest;this._configuration.cullAboveTerrain=ka.cullAboveTerrain;this._configuration.wireframe=this.parameters.wireframe;return this._configuration}get visible(){return this.parameters.color[3]>=x.alphaCutoff||null!=this.parameters.stipplePattern&&(this.parameters.stippleOffColor?.[3]??0)>x.alphaCutoff}intersectDraped({attributes:ea,
screenToWorldRatio:ka},ja,X,aa,pa,la){if(X.options.selectionMode){ja=ea.get(v.VertexAttribute.SIZE);X=this.parameters.width;this.parameters.vvSize?(ja=ea.get(v.VertexAttribute.SIZEFEATUREATTRIBUTE).data[0],X*=n.clamp(this.parameters.vvSize.offset[0]+ja*this.parameters.vvSize.factor[0],this.parameters.vvSize.minSize[0],this.parameters.vvSize.maxSize[0])):ja&&(X*=ja.data[0]);ja=aa[0];aa=aa[1];ka*=X/2+4;X=Number.MAX_VALUE;var na=0,qa=ea.get(v.VertexAttribute.POSITION).data;ea=E(this.parameters,ea)?qa.length-
2:qa.length-5;for(let Ca=0;Ca<ea;Ca+=3){var sa=qa[Ca],xa=qa[Ca+1],ta=(Ca+3)%qa.length,Ba=ja-sa,Ia=aa-xa;sa=qa[ta]-sa;xa=qa[ta+1]-xa;ta=n.clamp((sa*Ba+xa*Ia)/(sa*sa+xa*xa),0,1);Ba=sa*ta-Ba;Ia=xa*ta-Ia;Ia=Ba*Ba+Ia*Ia;Ia<X&&(X=Ia,na=Ca/3)}X<ka*ka&&pa(la.dist,la.normal,na,!1)}}intersect(ea,ka,ja,X,aa,pa){if(ja.options.selectionMode&&ea.visible)if(r.isTranslationMatrix(ka)){var la=ea.attributes;X=la.get(v.VertexAttribute.POSITION).data;ea=this.parameters.width;this.parameters.vvSize?(aa=la.get(v.VertexAttribute.SIZEFEATUREATTRIBUTE).data[0],
ea*=n.clamp(this.parameters.vvSize.offset[0]+aa*this.parameters.vvSize.factor[0],this.parameters.vvSize.minSize[0],this.parameters.vvSize.maxSize[0])):la.has(v.VertexAttribute.SIZE)&&(ea*=la.get(v.VertexAttribute.SIZE).data[0]);var na=ja.camera,qa=K;p.copy(qa,ja.point);aa=ea*na.pixelRatio/2+4*na.pixelRatio;h.set(ha[0],qa[0]-aa,qa[1]+aa,0);h.set(ha[1],qa[0]+aa,qa[1]+aa,0);h.set(ha[2],qa[0]+aa,qa[1]-aa,0);h.set(ha[3],qa[0]-aa,qa[1]-aa,0);for(ea=0;4>ea;ea++)if(!na.unprojectFromRenderScreen(ha[ea],T[ea]))return;
c.fromPoints(na.eye,T[0],T[1],S);c.fromPoints(na.eye,T[1],T[2],Z);c.fromPoints(na.eye,T[2],T[3],ia);c.fromPoints(na.eye,T[3],T[0],Y);var sa=Number.MAX_VALUE;ea=0;la=E(this.parameters,la)?X.length-2:X.length-5;for(let ta=0;ta<la;ta+=3){N[0]=X[ta]+ka[12];N[1]=X[ta+1]+ka[13];N[2]=X[ta+2]+ka[14];var xa=(ta+3)%X.length;M[0]=X[xa]+ka[12];M[1]=X[xa+1]+ka[13];M[2]=X[xa+2]+ka[14];if(!(0>c.signedDistance(S,N)&&0>c.signedDistance(S,M)||0>c.signedDistance(Z,N)&&0>c.signedDistance(Z,M)||0>c.signedDistance(ia,
N)&&0>c.signedDistance(ia,M)||0>c.signedDistance(Y,N)&&0>c.signedDistance(Y,M))){na.projectToRenderScreen(N,L);na.projectToRenderScreen(M,P);if(0>L[2]&&0<P[2])h.subtract(Q,N,M),xa=na.frustum,xa=-c.signedDistance(xa[d.PlaneIndex.NEAR],N)/h.dot(Q,c.getNormal(xa[d.PlaneIndex.NEAR])),h.scale(Q,Q,xa),h.add(N,N,Q),na.projectToRenderScreen(N,L);else if(0<L[2]&&0>P[2])h.subtract(Q,M,N),xa=na.frustum,xa=-c.signedDistance(xa[d.PlaneIndex.NEAR],M)/h.dot(Q,c.getNormal(xa[d.PlaneIndex.NEAR])),h.scale(Q,Q,xa),
h.add(M,M,Q),na.projectToRenderScreen(M,P);else if(0>L[2]&&0>P[2])continue;L[2]=0;P[2]=0;xa=f.distance2(f.fromPoints(L,P,V),qa);xa<sa&&(sa=xa,h.copy(R,N),h.copy(W,M),ea=ta/3)}}ka=ja.rayBegin;ja=ja.rayEnd;sa<aa*aa&&(X=Number.MAX_VALUE,f.closestLineSegmentPoint(f.fromPoints(R,W,V),f.fromPoints(ka,ja,ba),O)&&(h.subtract(O,O,ka),X=h.length(O),h.scale(O,O,1/X),X/=h.distance(ka,ja)),pa(X,O,ea,!1))}else b.getLogger("esri.views.3d.webgl-engine.materials.RibbonLineMaterial").error("intersection assumes a translation-only matrix")}get _layout(){const ea=
l.newLayout().vec3f(v.VertexAttribute.POSITION).vec3f(v.VertexAttribute.PREVPOSITION).vec3f(v.VertexAttribute.NEXTPOSITION).f32(v.VertexAttribute.SUBDIVISIONFACTOR).vec2f(v.VertexAttribute.UV0);this.parameters.vvSize?ea.f32(v.VertexAttribute.SIZEFEATUREATTRIBUTE):ea.f32(v.VertexAttribute.SIZE);this.parameters.vvColor?ea.f32(v.VertexAttribute.COLORFEATUREATTRIBUTE):ea.vec4f(v.VertexAttribute.COLOR);this.parameters.vvOpacity&&ea.f32(v.VertexAttribute.OPACITYFEATUREATTRIBUTE);u.olidEnabled()&&ea.vec4u8(v.VertexAttribute.OBJECTANDLAYERIDCOLOR);
return ea}createBufferWriter(){return new J(this._layout,this.parameters)}createGLMaterial(ea){return new D(ea)}validateParameters(ea){"miter"!==ea.join&&(ea.miterLimit=0);null!=ea.markerParameters&&(ea.markerScale=ea.markerParameters.width/ea.width)}}class D extends t{constructor(){super(...arguments);this._stipplePattern=null}dispose(){super.dispose();this._stippleTextures.release(this._stipplePattern);this._stipplePattern=null}beginSlot(ea){const ka=this._material.parameters.stipplePattern;this._stipplePattern!==
ka&&(this._material.setParameters({stippleTexture:this._stippleTextures.swap(ka,this._stipplePattern)}),this._stipplePattern=ka);return this.acquireTechnique(A.RibbonLineTechnique,ea)}}class I extends y.VisualVariablePassParameters{constructor(){super(...arguments);this.width=0;this.color=g.ONES;this.join="miter";this.cap=C.CapType.BUTT;this.miterLimit=5;this.writeDepth=!0;this.hasPolygonOffset=!1;this.stippleTexture=null;this.stipplePreferContinuous=!0;this.markerParameters=null;this.markerScale=
1;this.isClosed=this.vvFastUpdate=this.hasSlicePlane=!1;this.innerWidth=this.falloff=0;this.wireframe=!1}get transparent(){return 1>this.color[3]||null!=this.stipplePattern&&1>(this.stippleOffColor?.[3]??0)}}class J{constructor(ea,ka){this.vertexBufferLayout=ea;this._parameters=ka;this.numJoinSubdivisions=0;ea=ka.stipplePattern?1:0;switch(this._parameters.join){case "miter":case "bevel":this.numJoinSubdivisions=ea;break;case "round":this.numJoinSubdivisions=z.ribbonlineNumRoundJoinSubdivisions+ea}}_isClosed(ea){return E(this._parameters,
ea)}allocate(ea){return this.vertexBufferLayout.createBuffer(ea)}elementCount(ea){var ka=ea.get(v.VertexAttribute.POSITION).indices.length/2+1;ea=this._isClosed(ea);ka=(ea?2:4)+((ea?ka:ka-1)-(ea?0:1))*(2*this.numJoinSubdivisions+4);ka+=2;this._parameters.wireframe&&(ka=2+4*(ka-2));return ka}write(ea,ka,ja,X,aa,pa){ka=U;const la=da,na=fa,qa=ja.get(v.VertexAttribute.POSITION);var sa=qa.indices;const xa=qa.data.length/3,ta=ja.get(v.VertexAttribute.DISTANCETOSTART)?.data;sa&&sa.length!==2*(xa-1)&&console.warn("RibbonLineMaterial does not support indices");
const Ba=ja.get(v.VertexAttribute.SIZEFEATUREATTRIBUTE)?.data[0]??ja.get(v.VertexAttribute.SIZE)?.data[0]??1;let Ia=[1,1,1,1],Ca=0;const Ha=this.vertexBufferLayout.fields.has(v.VertexAttribute.COLORFEATUREATTRIBUTE);Ha?Ca=ja.get(v.VertexAttribute.COLORFEATUREATTRIBUTE).data[0]:ja.has(v.VertexAttribute.COLOR)&&(Ia=ja.get(v.VertexAttribute.COLOR).data);const Ga=this.vertexBufferLayout.fields.has(v.VertexAttribute.OPACITYFEATUREATTRIBUTE),Aa=Ga?ja.get(v.VertexAttribute.OPACITYFEATUREATTRIBUTE).data[0]:
0,Ja=new Float32Array(aa.buffer),Sa=u.olidEnabled()?new Uint8Array(aa.buffer):null;sa=this.vertexBufferLayout.stride/4;let $a=pa*sa;pa=$a;let Wa=0;const Ta=ta?(za,Na,Ra)=>Wa=ta[Ra]:(za,Na,Ra)=>Wa+=h.distance(za,Na),Da=(za,Na,Ra,Pa,ca,cb,ib)=>{Ja[$a++]=Na[0];Ja[$a++]=Na[1];Ja[$a++]=Na[2];Ja[$a++]=za[0];Ja[$a++]=za[1];Ja[$a++]=za[2];Ja[$a++]=Ra[0];Ja[$a++]=Ra[1];Ja[$a++]=Ra[2];Ja[$a++]=Pa;Ja[$a++]=ib;Ja[$a++]=ca;Ja[$a++]=Ba;Ha?Ja[$a++]=Ca:(za=Math.min(4*cb,Ia.length-4),Ja[$a++]=Ia[za],Ja[$a++]=Ia[za+
1],Ja[$a++]=Ia[za+2],Ja[$a++]=Ia[za+3]);Ga&&(Ja[$a++]=Aa);u.olidEnabled()&&(X&&(Sa[4*$a]=X[0],Sa[4*$a+1]=X[1],Sa[4*$a+2]=X[2],Sa[4*$a+3]=X[3]),$a++)};$a+=sa;h.set(la,qa.data[0],qa.data[1],qa.data[2]);ea&&h.transformMat4(la,la,ea);if(ja=this._isClosed(ja)){var La=qa.data.length-3;h.set(ka,qa.data[La],qa.data[La+1],qa.data[La+2]);ea&&h.transformMat4(ka,ka,ea)}else h.set(na,qa.data[3],qa.data[4],qa.data[5]),ea&&h.transformMat4(na,na,ea),Da(la,la,na,1,F.LEFT_CAP_START,0,0),Da(la,la,na,1,F.RIGHT_CAP_START,
0,0),h.copy(ka,la),h.copy(la,na);La=ja?0:1;const Va=ja?xa:xa-1;for(let za=La;za<Va;za++){var ma=(za+1)%xa*3;h.set(na,qa.data[ma],qa.data[ma+1],qa.data[ma+2]);ea&&h.transformMat4(na,na,ea);Ta(ka,la,za);Da(ka,la,na,0,F.LEFT_JOIN_END,za,Wa);Da(ka,la,na,0,F.RIGHT_JOIN_END,za,Wa);ma=this.numJoinSubdivisions;for(let Na=0;Na<ma;++Na){const Ra=(Na+1)/(ma+1);Da(ka,la,na,Ra,F.LEFT_JOIN_END,za,Wa);Da(ka,la,na,Ra,F.RIGHT_JOIN_END,za,Wa)}Da(ka,la,na,1,F.LEFT_JOIN_START,za,Wa);Da(ka,la,na,1,F.RIGHT_JOIN_START,
za,Wa);h.copy(ka,la);h.copy(la,na)}ja?(h.set(na,qa.data[3],qa.data[4],qa.data[5]),ea&&h.transformMat4(na,na,ea),Wa=Ta(ka,la,Va),Da(ka,la,na,0,F.LEFT_JOIN_END,La,Wa),Da(ka,la,na,0,F.RIGHT_JOIN_END,La,Wa)):(Wa=Ta(ka,la,Va),Da(ka,la,la,0,F.LEFT_CAP_END,Va,Wa),Da(ka,la,la,0,F.RIGHT_CAP_END,Va,Wa));H(Ja,pa+sa,Ja,pa,sa);$a=H(Ja,$a-sa,Ja,$a,sa);this._parameters.wireframe&&this._addWireframeVertices(aa,pa,$a,sa)}_addWireframeVertices(ea,ka,ja,X){const aa=new Float32Array(ea.buffer,ja*Float32Array.BYTES_PER_ELEMENT);
ea=new Float32Array(ea.buffer,ka*Float32Array.BYTES_PER_ELEMENT,ja-ka);ka=0;for(ja=0;ja<ea.length-1;ja+=2*X)ka=H(ea,ja,aa,ka,X),ka=H(ea,ja+2*X,aa,ka,X),ka=H(ea,ja+1*X,aa,ka,X),ka=H(ea,ja+2*X,aa,ka,X),ka=H(ea,ja+1*X,aa,ka,X),ka=H(ea,ja+3*X,aa,ka,X)}}const N=e.create(),M=e.create(),Q=e.create(),O=e.create(),K=e.create(),L=k.createRenderScreenPointArray3(),P=k.createRenderScreenPointArray3(),R=e.create(),W=e.create(),V=f.create(),ba=f.create(),U=e.create(),da=e.create(),fa=e.create(),ha=[k.createRenderScreenPointArray3(),
k.createRenderScreenPointArray3(),k.createRenderScreenPointArray3(),k.createRenderScreenPointArray3()],T=[e.create(),e.create(),e.create(),e.create()],S=c.create(),Z=c.create(),ia=c.create(),Y=c.create();a.Parameters=I;a.RibbonLineMaterial=G;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/LineMarkerTechniqueConfiguration":function(){define("exports ../../../../chunks/tslib.es6 ../core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl ../core/shaderLibrary/output/Emissions.glsl ../core/shaderTechnique/ShaderTechniqueConfiguration ../materials/DefaultTechniqueConfiguration".split(" "),
function(a,b,n,k,p,h){a.LineMarkerSpace=void 0;(function(g){g[g.Draped=0]="Draped";g[g.Screen=1]="Screen";g[g.World=2]="World";g[g.COUNT=3]="COUNT"})(a.LineMarkerSpace||(a.LineMarkerSpace={}));a.LineMarkerAnchor=void 0;(function(g){g[g.Center=0]="Center";g[g.Tip=1]="Tip";g[g.COUNT=2]="COUNT"})(a.LineMarkerAnchor||(a.LineMarkerAnchor={}));class e extends h.DefaultTechniqueConfiguration{constructor(){super(...arguments);this.space=a.LineMarkerSpace.Screen;this.anchor=a.LineMarkerAnchor.Center;this.cullAboveTerrain=
this.terrainDepthTest=this.hasOccludees=this.vvOpacity=this.vvColor=this.vvSize=this.hasTip=this.hasCap=this.hideOnShortSegments=this.writeDepth=this.hasSlicePlane=this.occluder=!1;this.textureCoordinateType=n.TextureCoordinateType.None;this.emissionSource=k.EmissionSource.None;this.discardInvisibleFragments=!0;this.occlusionPass=!1;this.hasSliceTranslatedView=this.hasVvInstancing=!0;this.objectAndLayerIdColorInstanced=!1}get draped(){return this.space===a.LineMarkerSpace.Draped}}b.__decorate([p.parameter({count:a.LineMarkerSpace.COUNT})],
e.prototype,"space",void 0);b.__decorate([p.parameter({count:a.LineMarkerAnchor.COUNT})],e.prototype,"anchor",void 0);b.__decorate([p.parameter()],e.prototype,"occluder",void 0);b.__decorate([p.parameter()],e.prototype,"hasSlicePlane",void 0);b.__decorate([p.parameter()],e.prototype,"writeDepth",void 0);b.__decorate([p.parameter()],e.prototype,"hideOnShortSegments",void 0);b.__decorate([p.parameter()],e.prototype,"hasCap",void 0);b.__decorate([p.parameter()],e.prototype,"hasTip",void 0);b.__decorate([p.parameter()],
e.prototype,"vvSize",void 0);b.__decorate([p.parameter()],e.prototype,"vvColor",void 0);b.__decorate([p.parameter()],e.prototype,"vvOpacity",void 0);b.__decorate([p.parameter()],e.prototype,"hasOccludees",void 0);b.__decorate([p.parameter()],e.prototype,"terrainDepthTest",void 0);b.__decorate([p.parameter()],e.prototype,"cullAboveTerrain",void 0);a.LineMarkerTechniqueConfiguration=e;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/RibbonLine.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderLibrary/ShaderOutput ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/ObjectAndLayerIdColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/RibbonVertexPosition.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/LineStipple.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MarkerSizing.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/PiUtils.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/TerrainDepthTest.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaCutoff ../views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/View.glsl ../views/3d/webgl-engine/core/shaderModules/Float2PassUniform ../views/3d/webgl-engine/core/shaderModules/Float4PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/Matrix4PassUniform ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/lib/VertexAttribute ../views/3d/webgl-engine/shaders/LineMarkerTechniqueConfiguration ../views/3d/webgl-engine/shaders/OutputColorHighlightOID.glsl ../views/3d/webgl-engine/shaders/RibbonLineTechniqueConfiguration".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w,x,u,t,m,q,r,v,y,B){function z(C){const H=new q.ShaderBuilder,{attributes:E,varyings:F,vertex:G,fragment:D}=H,{applyMarkerOffset:I,draped:J,output:N,capType:M,stippleEnabled:Q,falloffEnabled:O,roundJoins:K,wireframe:L,innerColorEnabled:P}=C;H.include(g.PiUtils);H.include(p.RibbonVertexPosition,C);H.include(h.LineStipple,C);H.include(k.ObjectAndLayerIdColor,C);const R=I&&!J;R&&(G.uniforms.add(new u.FloatPassUniform("markerScale",da=>da.markerScale)),H.include(e.MarkerSizing,
{space:v.LineMarkerSpace.World}));l.addProjViewLocalOrigin(G,C);G.uniforms.add(new m.Matrix4PassUniform("inverseProjectionMatrix",(da,fa)=>fa.camera.inverseProjectionMatrix),new w.Float2PassUniform("nearFar",(da,fa)=>fa.camera.nearFar),new u.FloatPassUniform("miterLimit",da=>"miter"!==da.join?0:da.miterLimit),new x.Float4PassUniform("viewport",(da,fa)=>fa.camera.fullViewport));G.constants.add("LARGE_HALF_FLOAT","float",65500);E.add(r.VertexAttribute.POSITION,"vec3");E.add(r.VertexAttribute.PREVPOSITION,
"vec3");E.add(r.VertexAttribute.NEXTPOSITION,"vec3");E.add(r.VertexAttribute.SUBDIVISIONFACTOR,"float");E.add(r.VertexAttribute.UV0,"vec2");F.add("vColor","vec4");F.add("vpos","vec3");F.add("vLineDistance","float");F.add("vLineWidth","float");const W=C.terrainDepthTest&&N===b.ShaderOutput.Color;W&&F.add("depth","float");Q&&F.add("vLineSizeInv","float");const V=M===B.CapType.ROUND,ba=Q&&V,U=O||ba;U&&F.add("vLineDistanceNorm","float");V&&(F.add("vSegmentSDF","float"),F.add("vReverseSegmentSDF","float"));
G.code.add(t.glsl`#define PERPENDICULAR(v) vec2(v.y, -v.x);
float interp(float ncp, vec4 a, vec4 b) {
return (-ncp - a.z) / (b.z - a.z);
}
vec2 rotate(vec2 v, float a) {
float s = sin(a);
float c = cos(a);
mat2 m = mat2(c, -s, s, c);
return m * v;
}`);G.code.add(t.glsl`vec4 projectAndScale(vec4 pos) {
vec4 posNdc = proj * pos;
posNdc.xy *= viewport.zw / posNdc.w;
return posNdc;
}`);G.code.add(t.glsl`
    void clipAndTransform(inout vec4 pos, inout vec4 prev, inout vec4 next, in bool isStartVertex) {
      float vnp = nearFar[0] * 0.99;

      if(pos.z > -nearFar[0]) {
        //current pos behind ncp --> we need to clip
        if (!isStartVertex) {
          if(prev.z < -nearFar[0]) {
            //previous in front of ncp
            pos = mix(prev, pos, interp(vnp, prev, pos));
            next = pos;
          } else {
            pos = vec4(0.0, 0.0, 0.0, 1.0);
          }
        } else {
          if(next.z < -nearFar[0]) {
            //next in front of ncp
            pos = mix(pos, next, interp(vnp, pos, next));
            prev = pos;
          } else {
            pos = vec4(0.0, 0.0, 0.0, 1.0);
          }
        }
      } else {
        //current position visible
        if (prev.z > -nearFar[0]) {
          //previous behind ncp
          prev = mix(pos, prev, interp(vnp, pos, prev));
        }
        if (next.z > -nearFar[0]) {
          //next behind ncp
          next = mix(next, pos, interp(vnp, next, pos));
        }
      }

      ${W?"depth \x3d pos.z;":""}

      pos = projectAndScale(pos);
      next = projectAndScale(next);
      prev = projectAndScale(prev);
    }
  `);l.addPixelRatio(G);G.constants.add("aaWidth","float",Q?0:1).main.add(t.glsl`
    // unpack values from uv0.y
    bool isStartVertex = abs(abs(uv0.y)-3.0) == 1.0;

    float coverage = 1.0;

    // Check for special value of uv0.y which is used by the Renderer when graphics
    // are removed before the VBO is recompacted. If this is the case, then we just
    // project outside of clip space.
    if (uv0.y == 0.0) {
      // Project out of clip space
      gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
    }
    else {
      bool isJoin = abs(uv0.y) < 3.0;
      float lineSize = getSize();

      if (lineSize < 1.0) {
        coverage = lineSize; // convert sub-pixel coverage to alpha
        lineSize = 1.0;
      }
      lineSize += aaWidth;

      float lineWidth = lineSize * pixelRatio;
      vLineWidth = lineWidth;
      ${Q?t.glsl`vLineSizeInv = 1.0 / lineSize;`:""}

      vec4 pos  = view * vec4(position, 1.0);
      vec4 prev = view * vec4(prevPosition, 1.0);
      vec4 next = view * vec4(nextPosition, 1.0);
  `);R&&G.main.add(t.glsl`vec4 other = isStartVertex ? next : prev;
bool markersHidden = areWorldMarkersHidden(pos, other);
if(!isJoin && !markersHidden) {
pos.xyz += normalize(other.xyz - pos.xyz) * getWorldMarkerSize(pos) * 0.5;
}`);G.main.add(t.glsl`clipAndTransform(pos, prev, next, isStartVertex);
vec2 left = (pos.xy - prev.xy);
vec2 right = (next.xy - pos.xy);
float leftLen = length(left);
float rightLen = length(right);`);(Q||V)&&G.main.add(t.glsl`
      float isEndVertex = float(!isStartVertex);
      vec2 segmentOrigin = mix(pos.xy, prev.xy, isEndVertex);
      vec2 segment = mix(right, left, isEndVertex);
      ${V?t.glsl`vec2 segmentEnd = mix(next.xy, pos.xy, isEndVertex);`:""}
    `);G.main.add(t.glsl`left = (leftLen > 0.001) ? left/leftLen : vec2(0.0, 0.0);
right = (rightLen > 0.001) ? right/rightLen : vec2(0.0, 0.0);
vec2 capDisplacementDir = vec2(0, 0);
vec2 joinDisplacementDir = vec2(0, 0);
float displacementLen = lineWidth;
if (isJoin) {
bool isOutside = (left.x * right.y - left.y * right.x) * uv0.y > 0.0;
joinDisplacementDir = normalize(left + right);
joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);
if (leftLen > 0.001 && rightLen > 0.001) {
float nDotSeg = dot(joinDisplacementDir, left);
displacementLen /= length(nDotSeg * left - joinDisplacementDir);
if (!isOutside) {
displacementLen = min(displacementLen, min(leftLen, rightLen)/abs(nDotSeg));
}
}
if (isOutside && (displacementLen > miterLimit * lineWidth)) {`);K?G.main.add(t.glsl`
        vec2 startDir = leftLen < 0.001 ? right : left;
        startDir = PERPENDICULAR(startDir);

        vec2 endDir = rightLen < 0.001 ? left : right;
        endDir = PERPENDICULAR(endDir);

        float factor = ${Q?t.glsl`min(1.0, subdivisionFactor * ${t.glsl.float(1.5)})`:t.glsl`subdivisionFactor`};

        float rotationAngle = acos(clamp(dot(startDir, endDir), -1.0, 1.0));
        joinDisplacementDir = rotate(startDir, -sign(uv0.y) * factor * rotationAngle);
      `):G.main.add(t.glsl`if (leftLen < 0.001) {
joinDisplacementDir = right;
}
else if (rightLen < 0.001) {
joinDisplacementDir = left;
}
else {
joinDisplacementDir = (isStartVertex || subdivisionFactor > 0.0) ? right : left;
}
joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);`);G.main.add(t.glsl`
        displacementLen = lineWidth;
      }
    } else {
      // CAP handling ---------------------------------------------------
      joinDisplacementDir = isStartVertex ? right : left;
      joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);

      ${M!==B.CapType.BUTT?t.glsl`capDisplacementDir = isStartVertex ? -right : left;`:""}
    }
  `);G.main.add(t.glsl`
    // Displacement (in pixels) caused by join/or cap
    vec2 dpos = joinDisplacementDir * sign(uv0.y) * displacementLen + capDisplacementDir * displacementLen;
    float lineDistNorm = sign(uv0.y) * pos.w;

    vLineDistance =  lineWidth * lineDistNorm;
    ${U?t.glsl`vLineDistanceNorm = lineDistNorm;`:""}

    pos.xy += dpos;
  `);V&&G.main.add(t.glsl`vec2 segmentDir = normalize(segment);
vSegmentSDF = (isJoin && isStartVertex) ? LARGE_HALF_FLOAT : (dot(pos.xy - segmentOrigin, segmentDir) * pos.w) ;
vReverseSegmentSDF = (isJoin && !isStartVertex) ? LARGE_HALF_FLOAT : (dot(pos.xy - segmentEnd, -segmentDir) * pos.w);`);Q&&(J?G.uniforms.add(new u.FloatPassUniform("worldToScreenRatio",(da,fa)=>1/fa.screenToPCSRatio)):G.main.add(t.glsl`vec3 segmentCenter = mix((nextPosition + position) * 0.5, (position + prevPosition) * 0.5, isEndVertex);
float worldToScreenRatio = computeWorldToScreenRatio(segmentCenter);`),G.main.add(t.glsl`float segmentLengthScreenDouble = length(segment);
float segmentLengthScreen = segmentLengthScreenDouble * 0.5;
float discreteWorldToScreenRatio = discretizeWorldToScreenRatio(worldToScreenRatio);
float segmentLengthRender = length(mix(nextPosition - position, position - prevPosition, isEndVertex));
vStipplePatternStretch = worldToScreenRatio / discreteWorldToScreenRatio;`),J?G.main.add(t.glsl`float segmentLengthPseudoScreen = segmentLengthScreen / pixelRatio * discreteWorldToScreenRatio / worldToScreenRatio;
float startPseudoScreen = uv0.x * discreteWorldToScreenRatio - mix(0.0, segmentLengthPseudoScreen, isEndVertex);`):G.main.add(t.glsl`float startPseudoScreen = mix(uv0.x, uv0.x - segmentLengthRender, isEndVertex) * discreteWorldToScreenRatio;
float segmentLengthPseudoScreen = segmentLengthRender * discreteWorldToScreenRatio;`),G.uniforms.add(new u.FloatPassUniform("stipplePatternPixelSize",da=>h.computePixelSize(da))),G.main.add(t.glsl`float patternLength = lineSize * stipplePatternPixelSize;
vStippleDistanceLimits = computeStippleDistanceLimits(startPseudoScreen, segmentLengthPseudoScreen, segmentLengthScreen, patternLength);
vStippleDistance = mix(vStippleDistanceLimits.x, vStippleDistanceLimits.y, isEndVertex);
if (segmentLengthScreenDouble >= 0.001) {
vec2 stippleDisplacement = pos.xy - segmentOrigin;
float stippleDisplacementFactor = dot(segment, stippleDisplacement) / (segmentLengthScreenDouble * segmentLengthScreenDouble);
vStippleDistance += (stippleDisplacementFactor - isEndVertex) * (vStippleDistanceLimits.y - vStippleDistanceLimits.x);
}
vStippleDistanceLimits *= pos.w;
vStippleDistance *= pos.w;
vStippleDistanceLimits = isJoin ?
vStippleDistanceLimits :
isStartVertex ?
vec2(-1e34, vStippleDistanceLimits.y) :
vec2(vStippleDistanceLimits.x, 1e34);`));G.main.add(t.glsl`
      // Convert back into NDC
      pos.xy = (pos.xy / viewport.zw) * pos.w;

      vColor = getColor();
      vColor.a *= coverage;

      ${L&&!J?"pos.z -\x3d 0.001 * pos.w;":""}

      // transform final position to camera space for slicing
      vpos = (inverseProjectionMatrix * pos).xyz;
      gl_Position = pos;
      forwardObjectAndLayerIdColor();
    }`);W&&H.include(d.terrainDepthTest,C);H.include(n.SliceDraw,C);H.include(y.outputColorHighlightOID,C);D.include(c.ColorConversion);D.main.add(t.glsl`
    discardBySlice(vpos);
    ${W?"terrainDepthTest(depth);":""}
  `);L?D.main.add(t.glsl`vec4 finalColor = vec4(1.0, 0.0, 1.0, 1.0);`):(V&&D.main.add(t.glsl`
        float sdf = min(vSegmentSDF, vReverseSegmentSDF);
        vec2 fragmentPosition = vec2(
          min(sdf, 0.0),
          vLineDistance
        ) * gl_FragCoord.w;

        float fragmentRadius = length(fragmentPosition);
        float fragmentCapSDF = (fragmentRadius - vLineWidth) * 0.5; // Divide by 2 to transform from double pixel scale
        float capCoverage = clamp(0.5 - fragmentCapSDF, 0.0, 1.0);

        if (capCoverage < ${t.glsl.float(f.alphaCutoff)}) {
          discard;
        }
      `),ba?D.main.add(t.glsl`
      vec2 stipplePosition = vec2(
        min(getStippleSDF() * 2.0 - 1.0, 0.0),
        vLineDistanceNorm * gl_FragCoord.w
      );
      float stippleRadius = length(stipplePosition * vLineWidth);
      float stippleCapSDF = (stippleRadius - vLineWidth) * 0.5; // Divide by 2 to transform from double pixel scale
      float stippleCoverage = clamp(0.5 - stippleCapSDF, 0.0, 1.0);
      float stippleAlpha = step(${t.glsl.float(f.alphaCutoff)}, stippleCoverage);
      `):D.main.add(t.glsl`float stippleAlpha = getStippleAlpha();`),N!==b.ShaderOutput.ObjectAndLayerIdColor&&D.main.add(t.glsl`discardByStippleAlpha(stippleAlpha, ${t.glsl.float(f.alphaCutoff)});`),D.uniforms.add(new x.Float4PassUniform("intrinsicColor",da=>da.color)),D.main.add(t.glsl`vec4 color = intrinsicColor * vColor;`),P&&(D.uniforms.add(new x.Float4PassUniform("innerColor",da=>da.innerColor??da.color),new u.FloatPassUniform("innerWidth",(da,fa)=>da.innerWidth*fa.camera.pixelRatio)),D.main.add(t.glsl`float distToInner = abs(vLineDistance * gl_FragCoord.w) - innerWidth;
float innerAA = clamp(0.5 - distToInner, 0.0, 1.0);
float innerAlpha = innerColor.a + color.a * (1.0 - innerColor.a);
color = mix(color, vec4(innerColor.rgb, innerAlpha), innerAA);`)),D.main.add(t.glsl`vec4 finalColor = blendStipple(color, stippleAlpha);`),O&&(D.uniforms.add(new u.FloatPassUniform("falloff",da=>da.falloff)),D.main.add(t.glsl`finalColor.a *= pow(max(0.0, 1.0 - abs(vLineDistanceNorm * gl_FragCoord.w)), falloff);`)),Q||D.main.add(t.glsl`float featherStartDistance = max(vLineWidth - 2.0, 0.0);
float value = abs(vLineDistance) * gl_FragCoord.w;
float feather = (value - featherStartDistance) / (vLineWidth - featherStartDistance);
finalColor.a *= 1.0 - clamp(feather, 0.0, 1.0);`));D.main.add(t.glsl`outputColorHighlightOID(finalColor, vpos);`);return H}const A=Object.freeze(Object.defineProperty({__proto__:null,build:z,ribbonlineNumRoundJoinSubdivisions:1},Symbol.toStringTag,{value:"Module"}));a.RibbonLine=A;a.build=z;a.ribbonlineNumRoundJoinSubdivisions=1})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/RibbonVertexPosition.glsl":function(){define("exports ../shading/VisualVariables.glsl ../../shaderModules/Float3PassUniform ../../shaderModules/FloatPassUniform ../../shaderModules/FloatsPassUniform ../../shaderModules/interfaces ../../../lib/VertexAttribute".split(" "),
function(a,b,n,k,p,h,e){a.RibbonVertexPosition=function(g,d){const f=g.vertex;f.uniforms.add(new k.FloatPassUniform("intrinsicWidth",c=>c.width));d.vvSize?(g.attributes.add(e.VertexAttribute.SIZEFEATUREATTRIBUTE,"float"),f.uniforms.add(new n.Float3PassUniform("vvSizeMinSize",c=>c.vvSize.minSize),new n.Float3PassUniform("vvSizeMaxSize",c=>c.vvSize.maxSize),new n.Float3PassUniform("vvSizeOffset",c=>c.vvSize.offset),new n.Float3PassUniform("vvSizeFactor",c=>c.vvSize.factor)),f.code.add(h.glsl`float getSize() {
return intrinsicWidth * clamp(vvSizeOffset + sizeFeatureAttribute * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).x;
}`)):(g.attributes.add(e.VertexAttribute.SIZE,"float"),f.code.add(h.glsl`float getSize(){
return intrinsicWidth * size;
}`));d.vvOpacity?(g.attributes.add(e.VertexAttribute.OPACITYFEATUREATTRIBUTE,"float"),f.constants.add("vvOpacityNumber","int",8),f.uniforms.add(new p.FloatsPassUniform("vvOpacityValues",c=>c.vvOpacity.values,8),new p.FloatsPassUniform("vvOpacityOpacities",c=>c.vvOpacity.opacityValues,8)),f.code.add(h.glsl`float interpolateOpacity( float value ){
if (value <= vvOpacityValues[0]) {
return vvOpacityOpacities[0];
}
for (int i = 1; i < vvOpacityNumber; ++i) {
if (vvOpacityValues[i] >= value) {
float f = (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);
return mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f);
}
}
return vvOpacityOpacities[vvOpacityNumber - 1];
}
vec4 applyOpacity( vec4 color ){
return vec4(color.xyz, interpolateOpacity(opacityFeatureAttribute));
}`)):f.code.add(h.glsl`vec4 applyOpacity( vec4 color ){
return color;
}`);d.vvColor?(g.include(b.VisualVariables,d),g.attributes.add(e.VertexAttribute.COLORFEATUREATTRIBUTE,"float"),f.code.add(h.glsl`vec4 getColor(){
return applyOpacity(interpolateVVColor(colorFeatureAttribute));
}`)):(g.attributes.add(e.VertexAttribute.COLOR,"vec4"),f.code.add(h.glsl`vec4 getColor(){
return applyOpacity(color);
}`))};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/LineStipple.glsl":function(){define("exports ../util/RgbaFloatEncoding.glsl ../util/View.glsl ../../shaderModules/Float4PassUniform ../../shaderModules/FloatPassUniform ../../shaderModules/interfaces ../../shaderModules/Texture2DPassUniform ../../../materials/stippleTextureRepository ../../../shaders/ensureColor4".split(" "),function(a,b,n,k,p,h,e,g,d){function f(w,x){const u=
!(x.draped&&x.stipplePreferContinuous),{vertex:t,fragment:m}=w;m.include(b.RgbaFloatEncoding);x.draped||(n.addCameraPosition(t,x),t.uniforms.add(new p.FloatPassUniform("worldToScreenPerDistanceRatio",(q,r)=>1/r.camera.perScreenPixelRatio)),t.code.add(h.glsl`float computeWorldToScreenRatio(vec3 segmentCenter) {
float segmentDistanceToCamera = length(segmentCenter - cameraPosition);
return worldToScreenPerDistanceRatio / segmentDistanceToCamera;
}`));w.varyings.add("vStippleDistance","float");w.varyings.add("vStippleDistanceLimits","vec2");w.varyings.add("vStipplePatternStretch","float");t.code.add(h.glsl`
    float discretizeWorldToScreenRatio(float worldToScreenRatio) {
      float step = ${l};

      float discreteWorldToScreenRatio = log(worldToScreenRatio);
      discreteWorldToScreenRatio = ceil(discreteWorldToScreenRatio / step) * step;
      discreteWorldToScreenRatio = exp(discreteWorldToScreenRatio);
      return discreteWorldToScreenRatio;
    }
  `);t.code.add(h.glsl`vec2 computeStippleDistanceLimits(float startPseudoScreen, float segmentLengthPseudoScreen, float segmentLengthScreen, float patternLength) {`);t.code.add(h.glsl`
    if (segmentLengthPseudoScreen >= ${u?"patternLength":"1e4"}) {
  `);n.addPixelRatio(t);t.code.add(h.glsl`float repetitions = segmentLengthScreen / (patternLength * pixelRatio);
float flooredRepetitions = max(1.0, floor(repetitions + 0.5));
float segmentLengthScreenRounded = flooredRepetitions * patternLength;
float stretch = repetitions / flooredRepetitions;
vStipplePatternStretch = max(0.75, stretch);
return vec2(0.0, segmentLengthScreenRounded);
}
return vec2(startPseudoScreen, startPseudoScreen + segmentLengthPseudoScreen);
}`);m.uniforms.add(new e.Texture2DPassUniform("stipplePatternTexture",q=>q.stippleTexture),new p.FloatPassUniform("stipplePatternSDFNormalizer",q=>(q=q.stipplePattern)?(Math.floor(.5*(g.computeLongestPattern(q)-1))+.5)/q.pixelRatio:1),new p.FloatPassUniform("stipplePatternPixelSizeInv",q=>1/c(q)));m.code.add(h.glsl`float getStippleSDF(out bool isClamped) {
float stippleDistanceClamped = clamp(vStippleDistance, vStippleDistanceLimits.x, vStippleDistanceLimits.y);
vec2 aaCorrectedLimits = vStippleDistanceLimits + vec2(1.0, -1.0) / gl_FragCoord.w;
isClamped = vStippleDistance < aaCorrectedLimits.x || vStippleDistance > aaCorrectedLimits.y;
float u = stippleDistanceClamped * gl_FragCoord.w * stipplePatternPixelSizeInv * vLineSizeInv;
u = fract(u);
float encodedSDF = rgba2float(texture(stipplePatternTexture, vec2(u, 0.5)));
float sdf = (encodedSDF * 2.0 - 1.0) * stipplePatternSDFNormalizer;
return (sdf - 0.5) * vStipplePatternStretch + 0.5;
}
float getStippleSDF() {
bool ignored;
return getStippleSDF(ignored);
}
float getStippleAlpha() {
bool isClamped;
float stippleSDF = getStippleSDF(isClamped);
float antiAliasedResult = clamp(stippleSDF * vLineWidth + 0.5, 0.0, 1.0);
return isClamped ? floor(antiAliasedResult + 0.5) : antiAliasedResult;
}`);x.stippleOffColorEnabled?(m.uniforms.add(new k.Float4PassUniform("stippleOffColor",q=>d.ensureColor4(q.stippleOffColor))),m.code.add(h.glsl`#define discardByStippleAlpha(stippleAlpha, threshold) {}
#define blendStipple(color, stippleAlpha) mix(color, stippleOffColor, stippleAlpha)`)):m.code.add(h.glsl`#define discardByStippleAlpha(stippleAlpha, threshold) if (stippleAlpha < threshold) { discard; }
#define blendStipple(color, stippleAlpha) vec4(color.rgb, color.a * stippleAlpha)`)}function c(w){const x=w.stipplePattern;return x?g.computeTextureSize(w.stipplePattern)/x.pixelRatio:1}const l=h.glsl.float(.4);a.LineStipple=function(w,x){x.stippleEnabled?f(w,x):w.fragment.code.add(h.glsl`float getStippleAlpha() { return 1.0; }
#define discardByStippleAlpha(_stippleAlpha_, _threshold_) {}
#define blendStipple(color, _stippleAlpha_) color`)};a.computePixelSize=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/stippleTextureRepository":function(){define("exports ../../../../core/floatRGBA ./ProceduralTextureRepository ../../../webgl/enums ../../../webgl/Texture ../../../webgl/TextureDescriptor".split(" "),function(a,b,n,k,p,h){function e(f){return f.pattern.map(c=>Math.round(c*f.pixelRatio))}function g(f){if(null==f)return 1;f=e(f);
return Math.floor(f.reduce((c,l)=>c+l))}function d(f){return e(f).reduce((c,l)=>Math.max(c,l))}a.computeLongestPattern=d;a.computeTextureSize=g;a.createStippleTextureRepository=function(f,c){return new n.ProceduralTextureRepository(l=>{var w=e(l),x=1/l.pixelRatio,u=g(l);l=d(l);const t=(Math.floor(.5*(l-1))+.5)*x;l=[];let m=1;for(var q of w){for(let y=0;y<q;y++)l.push(m*(Math.min(y,q-1-y)+.5)*x/t*.5+.5);m=-m}w=Math.round(w[0]/2);w=[...l.slice(w),...l.slice(0,w)];x=new Uint8Array(4*u);q=0;for(const y of w)b.packFloatRGBA(y,
x,q),q+=4;const {encodedData:r,textureSize:v}={encodedData:x,textureSize:u};u=new h.TextureDescriptor;u.internalFormat=k.PixelFormat.RGBA;u.width=v;u.height=1;u.wrapMode=k.TextureWrapMode.REPEAT;return new p.Texture(f,u,r)},l=>`${l.pattern.join(",")}-r${l.pixelRatio}`,c)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/ProceduralTextureRepository":function(){define(["exports","../../../../core/uid"],function(a,b){class n{constructor(p,h,e){this._createTexture=
p;this._parametersKey=h;this._repository=new Map;this._orphanCache=e.newCache(`procedural-texture-repository:${b.generateUID()}`,g=>g.dispose())}destroy(){for(const {texture:p}of this._repository.values())p.dispose();this._repository.clear();this._orphanCache.destroy()}swap(p,h=null){p=this._acquire(p);this.release(h);return p}release(p){if(null!=p){p=this._parametersKey(p);var h=this._repository.get(p);h&&(h.refCount--,0===h.refCount&&(this._repository.delete(p),{texture:h}=h,this._orphanCache.put(p,
h,h.usedMemory)))}}_acquire(p){if(null==p)return null;const h=this._parametersKey(p);var e=this._repository.get(h);if(e)return e.refCount++,e.texture;p=this._orphanCache.pop(h)??this._createTexture(p);e=new k(p);this._repository.set(h,e);return p}}class k{constructor(p){this.texture=p;this.refCount=1}}a.ProceduralTextureRepository=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/ensureColor4":function(){define(["exports","../../../../chunks/vec42",
"../../../../core/libs/gl-matrix-2/factories/vec4f64"],function(a,b,n){const k=n.create();a.ensureColor4=function(p){return null==p?n.ZEROS:4===p.length?p:b.set(k,p[0],p[1],p[2],1)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/MarkerSizing.glsl":function(){define("exports ../../../../support/engineContent/marker ../util/View.glsl ../../shaderModules/FloatPassUniform ../../shaderModules/interfaces ../../../shaders/LineMarkerTechniqueConfiguration".split(" "),
function(a,b,n,k,p,h){a.MarkerSizing=function(e,g){e=e.vertex;n.addPixelRatio(e);null==e.uniforms.get("markerScale")&&e.constants.add("markerScale","float",1);e.constants.add("markerSizePerLineWidth","float",b.markerSizePerLineWidth).code.add(p.glsl`float getLineWidth() {
return max(getSize(), 1.0) * pixelRatio;
}
float getScreenMarkerSize() {
return markerSizePerLineWidth * markerScale * getLineWidth();
}`);g.space===h.LineMarkerSpace.World&&(e.constants.add("maxSegmentLengthFraction","float",.45),e.uniforms.add(new k.FloatPassUniform("perRenderPixelRatio",(d,f)=>f.camera.perRenderPixelRatio)),e.code.add(p.glsl`bool areWorldMarkersHidden(vec4 pos, vec4 other) {
vec3 midPoint = mix(pos.xyz, other.xyz, 0.5);
float distanceToCamera = length(midPoint);
float screenToWorldRatio = perRenderPixelRatio * distanceToCamera * 0.5;
float worldMarkerSize = getScreenMarkerSize() * screenToWorldRatio;
float segmentLen = length(pos.xyz - other.xyz);
return worldMarkerSize > maxSegmentLengthFraction * segmentLen;
}
float getWorldMarkerSize(vec4 pos) {
float distanceToCamera = length(pos.xyz);
float screenToWorldRatio = perRenderPixelRatio * distanceToCamera * 0.5;
return getScreenMarkerSize() * screenToWorldRatio;
}`))};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/engineContent/marker":function(){define(["exports","./sdfPrimitives","../../../webgl/enums","../../../webgl/Texture","../../../webgl/TextureDescriptor"],function(a,b,n,k,p){a.createMarkerTexture=function(h,e){h=b.createPrimitive(h,64,32,6.4);const g=new p.TextureDescriptor;g.internalFormat=n.PixelFormat.RGBA;g.width=64;g.height=64;g.wrapMode=n.TextureWrapMode.CLAMP_TO_EDGE;return new k.Texture(e,g,h)};a.markerSizePerLineWidth=
10;a.markerSymbolSize=32;a.markerTextureSize=64;a.markerThickness=6.4;a.markerTipThicknessFactor=.25;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/RibbonLineTechniqueConfiguration":function(){define("exports ../../../../chunks/tslib.es6 ../core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl ../core/shaderLibrary/output/Emissions.glsl ../core/shaderTechnique/ShaderTechniqueConfiguration ../materials/DefaultTechniqueConfiguration".split(" "),
function(a,b,n,k,p,h){a.CapType=void 0;(function(g){g[g.BUTT=0]="BUTT";g[g.SQUARE=1]="SQUARE";g[g.ROUND=2]="ROUND";g[g.COUNT=3]="COUNT"})(a.CapType||(a.CapType={}));class e extends h.DefaultTechniqueConfiguration{constructor(){super(...arguments);this.capType=a.CapType.BUTT;this.stippleOffColorEnabled=this.stippleEnabled=this.draped=this.writeDepth=this.hasPolygonOffset=this.hasSlicePlane=!1;this.stipplePreferContinuous=!0;this.objectAndLayerIdColorInstanced=this.discardInvisibleFragments=this.wireframe=
this.cullAboveTerrain=this.terrainDepthTest=this.occluder=this.hasOccludees=this.innerColorEnabled=this.falloffEnabled=this.vvOpacity=this.vvColor=this.vvSize=this.applyMarkerOffset=this.roundJoins=!1;this.textureCoordinateType=n.TextureCoordinateType.None;this.emissionSource=k.EmissionSource.None;this.occlusionPass=!1;this.hasSliceTranslatedView=this.hasVvInstancing=!0}}b.__decorate([p.parameter({count:a.CapType.COUNT})],e.prototype,"capType",void 0);b.__decorate([p.parameter()],e.prototype,"hasSlicePlane",
void 0);b.__decorate([p.parameter()],e.prototype,"hasPolygonOffset",void 0);b.__decorate([p.parameter()],e.prototype,"writeDepth",void 0);b.__decorate([p.parameter()],e.prototype,"draped",void 0);b.__decorate([p.parameter()],e.prototype,"stippleEnabled",void 0);b.__decorate([p.parameter()],e.prototype,"stippleOffColorEnabled",void 0);b.__decorate([p.parameter()],e.prototype,"stipplePreferContinuous",void 0);b.__decorate([p.parameter()],e.prototype,"roundJoins",void 0);b.__decorate([p.parameter()],
e.prototype,"applyMarkerOffset",void 0);b.__decorate([p.parameter()],e.prototype,"vvSize",void 0);b.__decorate([p.parameter()],e.prototype,"vvColor",void 0);b.__decorate([p.parameter()],e.prototype,"vvOpacity",void 0);b.__decorate([p.parameter()],e.prototype,"falloffEnabled",void 0);b.__decorate([p.parameter()],e.prototype,"innerColorEnabled",void 0);b.__decorate([p.parameter()],e.prototype,"hasOccludees",void 0);b.__decorate([p.parameter()],e.prototype,"occluder",void 0);b.__decorate([p.parameter()],
e.prototype,"terrainDepthTest",void 0);b.__decorate([p.parameter()],e.prototype,"cullAboveTerrain",void 0);b.__decorate([p.parameter()],e.prototype,"wireframe",void 0);b.__decorate([p.parameter()],e.prototype,"discardInvisibleFragments",void 0);b.__decorate([p.parameter()],e.prototype,"objectAndLayerIdColorInstanced",void 0);a.RibbonLineTechniqueConfiguration=e;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/RibbonLineTechnique":function(){define("require exports ../../../../core/has ../core/shaderLibrary/ShaderOutput ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../lib/OITPass ../lib/OrderIndependentTransparency ../lib/RenderSlot ../lib/StencilUtils ../lib/VertexAttribute ../../../../chunks/RibbonLine.glsl ../../../webgl/enums ../../../webgl/renderState".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w,x){class u extends h.ShaderTechnique{constructor(q,r,v){super(q,r,new p.ReloadableShaderModule(l.RibbonLine,()=>new Promise((y,B)=>a(["./RibbonLine.glsl"],y,B))),v,m);this.primitiveType=r.wireframe?w.PrimitiveType.LINES:w.PrimitiveType.TRIANGLE_STRIP}_makePipelineState(q,r){const {oitPass:v,output:y,hasOccludees:B,hasPolygonOffset:z}=q,A=v===e.OITPass.NONE,C=v===e.OITPass.FrontFace;return x.makePipelineState({blending:q.output===k.ShaderOutput.Color?g.blending(v):
null,depthTest:{func:g.oitDepthTest(v)},depthWrite:g.depthWrite(q),drawBuffers:y===k.ShaderOutput.Depth?{buffers:[w.SpecialDrawBuffers.NONE]}:g.getDrawBuffers(v,y),colorWrite:x.defaultColorWrite,stencilWrite:B?f.stencilWriteMaskOn:null,stencilTest:B?r?f.stencilToolMaskBaseParams:f.stencilBaseAllZerosParams:null,polygonOffset:A||C?z?t:null:g.OITPolygonOffset})}initializePipeline(q){if(q.occluder){const r=q.hasPolygonOffset?t:null;this._occluderPipelineTransparent=x.makePipelineState({blending:x.premultipliedAlphaToPremultipliedAlpha,
polygonOffset:r,depthTest:f.depthCompareAlways,depthWrite:null,colorWrite:x.defaultColorWrite,stencilWrite:null,stencilTest:f.stencilToolTransparentOccluderParams,drawBuffers:q.output===k.ShaderOutput.Depth?{buffers:[w.SpecialDrawBuffers.NONE]}:null});this._occluderPipelineOpaque=x.makePipelineState({blending:x.premultipliedAlphaToPremultipliedAlpha,polygonOffset:r,depthTest:f.depthCompareAlways,depthWrite:null,colorWrite:x.defaultColorWrite,stencilWrite:f.stencilWriteMaskOff,stencilTest:f.stencilToolMaskOccluderParams,
drawBuffers:q.output===k.ShaderOutput.Depth?{buffers:[w.SpecialDrawBuffers.NONE]}:null});this._occluderPipelineMaskWrite=x.makePipelineState({blending:null,polygonOffset:r,depthTest:f.depthCompareLess,depthWrite:null,colorWrite:null,stencilWrite:f.stencilWriteMaskOn,stencilTest:f.stencilToolMaskBaseParams,drawBuffers:q.output===k.ShaderOutput.Depth?{buffers:[w.SpecialDrawBuffers.NONE]}:null})}this._occludeePipeline=this._makePipelineState(q,!0);return this._makePipelineState(q,!1)}getPipeline(q,r){if(q)return this._occludeePipeline;
switch(r){case d.RenderSlot.TRANSPARENT_OCCLUDER_MATERIAL:return this._occluderPipelineTransparent??super.getPipeline();case d.RenderSlot.OCCLUDER_MATERIAL:return this._occluderPipelineOpaque??super.getPipeline();default:case void 0:case null:return this._occluderPipelineMaskWrite??super.getPipeline()}}}const t={factor:0,units:-4},m=new Map([[c.VertexAttribute.POSITION,0],[c.VertexAttribute.PREVPOSITION,1],[c.VertexAttribute.NEXTPOSITION,2],[c.VertexAttribute.SUBDIVISIONFACTOR,3],[c.VertexAttribute.UV0,
4],[c.VertexAttribute.COLOR,5],[c.VertexAttribute.COLORFEATUREATTRIBUTE,5],[c.VertexAttribute.SIZE,6],[c.VertexAttribute.SIZEFEATUREATTRIBUTE,6],[c.VertexAttribute.OPACITYFEATUREATTRIBUTE,7],[c.VertexAttribute.OBJECTANDLAYERIDCOLOR,8]]);b.RibbonLineTechnique=u;b.vertexAttributeLocations=m;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/RenderContext":function(){define("exports ../../../../core/time ../../webgl/RenderCamera ../core/shaderLibrary/ShaderOutput ./BindParameters ./Material".split(" "),
function(a,b,n,k,p,h){class e{constructor(f,c){this.rctx=f;this.lastFrameCamera=new n;this.output=k.ShaderOutput.Color;this.renderOccludedMask=d;this.bind=new p.BindParameters(c);this.bind.alignPixelEnabled=!0}}class g extends e{constructor(f,c,l){super(f,c);this.techniques=l;this.time=b.Milliseconds(0)}}const d=h.RenderOccludedFlag.Occlude|h.RenderOccludedFlag.OccludeAndTransparent|h.RenderOccludedFlag.OccludeAndTransparentStencil;a.OverlayRenderContext=e;a.RenderContext=g;a.defaultRenderOccludedMask=
d;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/BindParameters":function(){define("exports ../../../../core/libs/gl-matrix-2/factories/mat4f64 ../../../../core/libs/gl-matrix-2/factories/vec2f64 ../../environment/CloudsParameters ../../webgl/RenderCamera ../core/shaderLibrary/hud/HUDRenderStyle ./OITPass ./RenderSlot ./Update ../lighting/SceneLighting".split(" "),function(a,b,n,k,p,h,e,g,d,f){class c{constructor(x,u){this.width=x;this.height=u}}class l{constructor(x){this.shadowMap=
x;this.slot=g.RenderSlot.OPAQUE_MATERIAL;this.slicePlane=null;this.hasOccludees=!1;this.enableFillLights=!0;this.oitPass=e.OITPass.NONE;this.alignPixelEnabled=!1;this.decorations=!0;this.overlayStretch=1;this.viewshedEnabled=!1;this._camera=new p;this._inverseViewport=n.create();this._oldLighting=new f.SceneLighting;this._newLighting=new f.SceneLighting;this._fadedLighting=new f.SceneLighting;this._lighting=this._newLighting;this.ssr=new w;this.cullAboveTerrain=this.terrainDepthTest=!1;this.highlightGroupName=
this.highlightMixTexture=null;this.highlightGroupIndices=new Map;this.highlightLevel=0;this.highlightMixOrigin=n.create();this.hudRenderStyle=h.HUDRenderStyle.Occluded;this.clouds=new k.CloudsParameters;this.shadowHighlightsVisible=!1}get camera(){return this._camera}set camera(x){this._camera=x;this._inverseViewport[0]=1/x.fullViewport[2];this._inverseViewport[1]=1/x.fullViewport[3]}get inverseViewport(){return this._inverseViewport}get lighting(){return this._lighting}fadeLighting(){switch(this.clouds.fadeFactor){case 0:this._lighting=
this._oldLighting;break;default:this._fadedLighting.lerpLighting(this._oldLighting,this._newLighting,this.clouds.fadeFactor);this._lighting=this._fadedLighting;break;case 1:this._lighting=this._newLighting,this._oldLighting.copyFrom(this._newLighting)}}updateLighting(x,u,t,m){this._oldLighting.copyFrom(this.lighting);this._newLighting.noonFactor=u;this._newLighting.globalFactor=t;this._newLighting.set(x);m===d.Update.FadeWithWeather&&this.clouds.requestFade();this.fadeLighting()}}class w{constructor(){this.fadeFactor=
1;this.reprojectionMatrix=b.create()}}a.BindParameters=l;a.ViewportSize=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/ShadowMap":function(){define("exports ../../../../core/has ../../../../core/mathUtils ../../../../core/maybe ../../../../core/libs/gl-matrix-2/factories/mat3f64 ../../../../core/libs/gl-matrix-2/math/mat4 ../../../../core/libs/gl-matrix-2/factories/mat4f64 ../../../../core/libs/gl-matrix-2/math/vec2 ../../../../core/libs/gl-matrix-2/factories/vec2f64 ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../chunks/vec42 ../../../../core/libs/gl-matrix-2/factories/vec4f64 ../../../ViewingMode ../../webgl/formats ./CascadeCamera ./textureUtils ./Util ../../../webgl/enums ../../../webgl/Texture".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w,x,u,t,m,q,r,v){function y(Z,ia){g.set(ha,Z[ia],Z[ia+3]);return ha}a.SnapshotSlot=void 0;(function(Z){Z[Z.Highlight=0]="Highlight";Z[Z.ExcludeHighlight=1]="ExcludeHighlight"})(a.SnapshotSlot||(a.SnapshotSlot={}));class B{constructor(){this.camera=new t.CascadeCamera;this.lightMat=e.create()}}class z{constructor(){this.maxNumCascadesLowQuality=this.maxNumCascadesHighQuality=4;this.textureSizeModHighQuality=1.3;this.textureSizeModLowQuality=.9;this.splitSchemeLambda=
0}}class A{constructor(Z,ia){this._fbos=Z;this._viewingMode=ia;this._enabled=!1;this._snapshots=[];this._textureHeight=0;this._numCascades=1;this.settings=new z;this._projectionView=e.create();this._projectionViewInverse=e.create();this._modelViewLight=e.create();this._cascadeDistances=[0,0,0,0,0];this._usedCascadeDistances=w.create();this._cascades=[new B,new B,new B,new B];this._lastOrigin=null;this._maxTextureWidth=Math.min(b("esri-mobile")?4096:16384,Z.rctx.parameters.maxTextureSize)}dispose(){this.enabled=
!1;this.disposeOffscreenBuffers()}get depthTexture(){return this._handle?.getTexture()}get _textureWidth(){return this._textureHeight*this._numCascades}get numCascades(){return this._numCascades}get cascadeDistances(){return l.set(this._usedCascadeDistances,this._cascadeDistances[0],1<this._numCascades?this._cascadeDistances[1]:Infinity,2<this._numCascades?this._cascadeDistances[2]:Infinity,3<this._numCascades?this._cascadeDistances[3]:Infinity)}disposeOffscreenBuffers(){this._handle=k.releaseMaybe(this._handle);
this._discardSnapshots()}set maxCascades(Z){this.settings.maxNumCascadesHighQuality=n.clamp(Math.floor(Z),1,4)}get maxCascades(){return this.settings.maxNumCascadesHighQuality}set enabled(Z){(this._enabled=Z)||this.disposeOffscreenBuffers()}get enabled(){return this._enabled}get ready(){return this._enabled&&null!=this.depthTexture}get cascades(){for(let Z=0;Z<this._numCascades;++Z)M[Z]=this._cascades[Z];M.length=this._numCascades;return M}start(Z,ia,Y,ea,ka){q.assert(this.enabled);let {near:ja,far:X}=
Y;2>ja&&(ja=2);2>X&&(X=2);ja>=X&&(ja=2,X=4);const {near:aa,far:pa}={near:ja,far:X};this._computeCascadeDistances(aa,pa,ea);this._textureHeight=this._computeTextureHeight(Z,ka,ea);this._setupMatrices(Z,ia);const {viewMatrix:la,projectionMatrix:na}=Z;for(Z=0;Z<this._numCascades;++Z)this._constructCascade(Z,na,la,ia);this._lastOrigin=null;this.clear()}finish(){q.assert(this.enabled);this._handle?.detachDepth()}getShadowMapMatrices(Z){if(!this._lastOrigin||!f.exactEquals(Z,this._lastOrigin)){this._lastOrigin=
this._lastOrigin||c.create();f.copy(this._lastOrigin,Z);for(let ia=0;ia<this._numCascades;++ia){h.translate(Q,this._cascades[ia].lightMat,Z);for(let Y=0;16>Y;++Y)O[16*ia+Y]=Q[Y]}}return O}moveSnapshot(Z){q.assert(this.enabled);this._handle?.detachDepth();this._snapshots[Z]?.release();this._snapshots[Z]=this._handle;this._handle=null;this.clear()}copySnapshot(Z){var ia=this._handle?.getTexture()?.descriptor;if(this.enabled&&ia){this._snapshots[Z]?.release();var {width:Y,height:ea}=ia;this._snapshots[Z]=
this._fbos.acquire(Y,ea,Z===a.SnapshotSlot.Highlight?"shadow highlight snapshot":"shadow no highlight snapshot",u.ColorFormat.RGBA4);ia=this._fbos.rctx;this._bindFbo();Z=ia.bindTexture(this._snapshots[Z]?.getTexture(),v.Texture.TEXTURE_UNIT_FOR_UPDATES);ia.gl.copyTexSubImage2D(r.TextureType.TEXTURE_2D,0,0,0,0,0,Y,ea);ia.bindTexture(Z,v.Texture.TEXTURE_UNIT_FOR_UPDATES)}}getSnapshot(Z){return this.enabled?this._snapshots[Z]?.getTexture():null}clear(){const Z=this._fbos.rctx;this._ensureFbo();this._bindFbo();
Z.setClearColor(1,1,1,1);Z.clear(r.FramebufferBit.COLOR|r.FramebufferBit.DEPTH)}_computeTextureHeight(Z,ia,Y){Z=m.applyTextureResizeModulo(Math.floor(Math.min(window.devicePixelRatio,ia)/Z.pixelRatio*Math.max(Z.fullWidth,Z.fullHeight)*(Y?this.settings.textureSizeModHighQuality:this.settings.textureSizeModLowQuality)));return m.applyTextureResizeFloorModulo(Math.min(this._maxTextureWidth,this._numCascades*Z)/this._numCascades)}_ensureFbo(){if(this._handle?.fbo?.width!==this._textureWidth||this._handle?.fbo.height!==
this._textureHeight)this._handle?.release(),this._handle=this._fbos.acquire(this._textureWidth,this._textureHeight,"shadow map",u.ColorFormat.RGBA4);this._handle?.acquireDepth(u.DepthFormat.DEPTH16_BUFFER)}_discardSnapshot(Z){this._snapshots[Z]=k.releaseMaybe(this._snapshots[Z])}_discardSnapshots(){for(let Z=0;Z<this._snapshots.length;++Z)this._discardSnapshot(Z);this._snapshots.length=0}_bindFbo(){this._fbos.rctx.bindFramebuffer(this._handle?.fbo)}_constructCascade(Z,ia,Y,ea){const ka=this._cascades[Z];
var ja=-this._cascadeDistances[Z],X=-this._cascadeDistances[Z+1];ja=(ia[10]*ja+ia[14])/Math.abs(ia[11]*ja+ia[15]);ia=(ia[10]*X+ia[14])/Math.abs(ia[11]*X+ia[15]);q.assert(ja<ia);for(X=0;8>X;++X){l.set(H,0===X%4||3===X%4?-1:1,0===X%4||1===X%4?-1:1,4>X?ja:ia,1);var aa=E[X];l.transformMat4(aa,H,this._projectionViewInverse);aa[0]/=aa[3];aa[1]/=aa[3];aa[2]/=aa[3]}f.negate(N,E[0]);ka.camera.viewMatrix=h.translate(C,this._modelViewLight,N);for(ja=0;8>ja;++ja)f.transformMat4(E[ja],E[ja],ka.camera.viewMatrix);
ja=E[0][2];ia=E[0][2];for(X=1;8>X;++X)ja=Math.min(ja,E[X][2]),ia=Math.max(ia,E[X][2]);ja-=200;ia+=200;ka.camera.near=-ia;ka.camera.far=-ja;X=ka.camera;aa=1/E[0][3];var pa=1/E[4][3];q.assert(aa<pa);aa+=Math.sqrt(aa*pa);var la=Math.sin(n.acosClamped(Y[2]*ea[0]+Y[6]*ea[1]+Y[10]*ea[2]));Y=E;var na=aa/la;ea=F;var qa=G,sa=D;pa=I;aa=J;g.set(K,0,0);for(var xa=0;4>xa;++xa)g.add(K,K,Y[xa]);g.scale(K,K,.25);g.set(L,0,0);for(xa=4;8>xa;++xa)g.add(L,L,Y[xa]);g.scale(L,L,.25);g.lerp(P[0],Y[4],Y[5],.5);g.lerp(P[1],
Y[5],Y[6],.5);g.lerp(P[2],Y[6],Y[7],.5);g.lerp(P[3],Y[7],Y[4],.5);xa=0;var ta=g.squaredDistance(P[0],K);for(var Ba=1;4>Ba;++Ba){var Ia=g.squaredDistance(P[Ba],K);Ia<ta&&(ta=Ia,xa=Ba)}g.subtract(R,P[xa],Y[xa+4]);xa=R[0];R[0]=-R[1];R[1]=xa;g.subtract(W,L,K);0>g.dot(W,R)&&g.negate(R,R);g.lerp(R,R,W,la);g.normalize(R,R);la=xa=g.dot(g.subtract(V,Y[0],K),R);for(ta=1;8>ta;++ta)Ba=g.dot(g.subtract(V,Y[ta],K),R),Ba<la?la=Ba:Ba>xa&&(xa=Ba);g.copy(ea,K);g.scale(V,R,la-na);g.add(ea,ea,V);Ba=-1;Ia=1;na=ta=0;for(let Ca=
0;8>Ca;++Ca){g.subtract(ba,Y[Ca],ea);g.normalize(ba,ba);const Ha=R[0]*ba[1]-R[1]*ba[0];0<Ha?Ha>Ba&&(Ba=Ha,ta=Ca):Ha<Ia&&(Ia=Ha,na=Ca)}q.verify(0<Ba,"leftArea");q.verify(0>Ia,"rightArea");g.scale(U,R,la);g.add(U,U,K);g.scale(da,R,xa);g.add(da,da,K);fa[0]=-R[1];fa[1]=R[0];qa=q.rayRay2D(ea,Y[na],da,g.add(V,da,fa),1,qa);sa=q.rayRay2D(ea,Y[ta],da,V,1,sa);pa=q.rayRay2D(ea,Y[ta],U,g.add(V,U,fa),1,pa);Y=q.rayRay2D(ea,Y[na],U,V,1,aa);q.verify(qa,"rayRay");q.verify(sa,"rayRay");q.verify(pa,"rayRay");q.verify(Y,
"rayRay");sa=F;Y=G;ea=I;pa=J;aa=X.projectionMatrix;g.subtract(T,ea,pa);g.scale(T,T,.5);S[0]=T[0];S[1]=T[1];S[2]=0;S[3]=T[1];S[4]=-T[0];S[5]=0;S[6]=T[0]*T[0]+T[1]*T[1];S[7]=T[0]*T[1]-T[1]*T[0];S[8]=1;S[6]=-g.dot(y(S,0),sa);S[7]=-g.dot(y(S,1),sa);sa=g.dot(y(S,0),ea)+S[6];qa=g.dot(y(S,1),ea)+S[7];na=g.dot(y(S,0),pa)+S[6];pa=g.dot(y(S,1),pa)+S[7];sa=-(sa+na)/(qa+pa);S[0]+=S[1]*sa;S[3]+=S[4]*sa;S[6]+=S[7]*sa;sa=1/(g.dot(y(S,0),ea)+S[6]);qa=1/(g.dot(y(S,1),ea)+S[7]);S[0]*=sa;S[3]*=sa;S[6]*=sa;S[1]*=qa;
S[4]*=qa;S[7]*=qa;S[2]=S[1];S[5]=S[4];S[8]=S[7];S[7]+=1;sa=g.dot(y(S,1),Y)+S[7];qa=g.dot(y(S,2),Y)+S[8];na=g.dot(y(S,1),ea)+S[7];pa=g.dot(y(S,2),ea)+S[8];sa=-.5*(sa/qa+na/pa);S[1]+=S[2]*sa;S[4]+=S[5]*sa;S[7]+=S[8]*sa;sa=g.dot(y(S,1),Y)+S[7];qa=g.dot(y(S,2),Y)+S[8];na=-qa/sa;S[1]*=na;S[4]*=na;S[7]*=na;aa[0]=S[0];aa[1]=S[1];aa[2]=0;aa[3]=S[2];aa[4]=S[3];aa[5]=S[4];aa[6]=0;aa[7]=S[5];aa[8]=0;aa[9]=0;aa[10]=1;aa[11]=0;aa[12]=S[6];aa[13]=S[7];aa[14]=0;aa[15]=S[8];X.projectionMatrix[10]=2/(ja-ia);X.projectionMatrix[14]=
-(ja+ia)/(ja-ia);h.multiply(ka.lightMat,ka.camera.projectionMatrix,ka.camera.viewMatrix);ja=this._textureHeight;ka.camera.viewport=[Z*ja,0,ja,ja]}_setupMatrices(Z,ia){h.multiply(this._projectionView,Z.projectionMatrix,Z.viewMatrix);h.invert(this._projectionViewInverse,this._projectionView);Z=this._viewingMode===x.ViewingMode.Global?Z.eye:f.set(N,0,0,1);h.lookAt(this._modelViewLight,[0,0,0],[-ia[0],-ia[1],-ia[2]],Z)}_computeCascadeDistances(Z,ia,Y){Y=Y?this.settings.maxNumCascadesHighQuality:this.settings.maxNumCascadesLowQuality;
this._numCascades=Math.min(1+Math.floor(q.logWithBase(ia/Z,4)),Y);Y=(ia-Z)/this._numCascades;ia=(ia/Z)**(1/this._numCascades);let ea=Z;for(let ka=0;ka<this._numCascades+1;++ka)this._cascadeDistances[ka]=n.lerp(ea,Z,this.settings.splitSchemeLambda),ea*=ia,Z+=Y}get test(){}}const C=e.create(),H=w.create(),E=[];for(let Z=0;8>Z;++Z)E.push(w.create());const F=d.create(),G=d.create(),D=d.create(),I=d.create(),J=d.create(),N=c.create(),M=[],Q=e.create(),O=e.IDENTITY.concat(e.IDENTITY,e.IDENTITY,e.IDENTITY,
e.IDENTITY),K=d.create(),L=d.create(),P=[d.create(),d.create(),d.create(),d.create()],R=d.create(),W=d.create(),V=d.create(),ba=d.create(),U=d.create(),da=d.create(),fa=d.create(),ha=d.create(),T=d.create(),S=p.create();a.ShadowMap=A;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/CascadeCamera":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/Logger ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ../../../../core/libs/gl-matrix-2/factories/mat4f64 ../../webgl/RenderCamera".split(" "),
function(a,b,n,k,p,h,e,g,d){a.CascadeCamera=class extends d{constructor(){super(...arguments);this._projectionMatrix=g.create()}get projectionMatrix(){return this._projectionMatrix}};b.__decorate([n.property()],a.CascadeCamera.prototype,"_projectionMatrix",void 0);b.__decorate([n.property({readOnly:!0})],a.CascadeCamera.prototype,"projectionMatrix",null);a.CascadeCamera=b.__decorate([e.subclass("esri.views.3d.webgl-engine.lib.CascadeCamera")],a.CascadeCamera);Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/views/3d/webgl-engine/lib/SortedRenderGeometryRenderer":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/has ../../../../core/MapUtils ../../../../core/PooledArray ../../../../core/accessorSupport/decorators/property ../../../../core/Logger ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ../../../../core/libs/gl-matrix-2/factories/vec2f64 ../../../../chunks/sphere ../../terrain/Intersector ../core/shaderLibrary/ShaderOutput ../effects/RenderPlugin ./ChangeSet ./Intersector ./IntersectorInterfaces ./Material ./ModelDirtyTypes ./rendererUtils ./RenderSlot ../materials/renderers/MergedRenderer".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w,x,u,t,m,q,r,v,y,B,z){function A(E,F,G,D,I,J,N){const M=new w.OverlayTarget(J,N,F);F=Q=>{Q.set(q.IntersectorType.OVERLAY,M,E.dist,E.normal,E.transformation,G,D)};(null==I.results.min.drapedLayerOrder||G>=I.results.min.drapedLayerOrder)&&(null==I.results.min.dist||I.results.ground.dist<=I.results.min.dist)&&F(I.results.min);I.options.store!==q.StoreResults.MIN&&(null==I.results.max.drapedLayerOrder||G<I.results.max.drapedLayerOrder)&&(null==I.results.max.dist||I.results.ground.dist>
I.results.max.dist)&&F(I.results.max);I.options.store===q.StoreResults.ALL&&(J=m.newIntersectorResult(I.ray),F(J),I.results.all.push(J))}a.SortedRenderGeometryRenderer=class extends n{constructor(E){super(E);this._pending=new C;this._changes=new t.ChangeSet;this._renderers=new Map;this._sortedRenderers=new h;this._geometries=new Map;this._hasWater=this._hasHighlights=!1}destroy(){this._changes.prune();this._renderers.forEach(E=>E.destroy());this._renderers.clear();this._sortedRenderers.clear();this._geometries.clear();
this._pending.clear()}get updating(){return!this._pending.empty||0<this._changes.updates.length}get rctx(){return this.rendererContext.rctx}get _materials(){return this.rendererContext.materials}get _localOriginFactory(){return this.rendererContext.localOriginFactory}get hasHighlights(){return this._hasHighlights}get hasWater(){return this._hasWater}get rendersOccludedDraped(){for(const E of this._renderers.values())if(0!==E.numGeometries&&!E.queryRenderOccludedState(r.RenderOccludedFlag.Occlude))return!0;
return!1}get isEmpty(){return!this.updating&&0===this._renderers.size&&0===this._geometries.size}getMaterialRenderer(E){return this._renderers.get(E)}get sortedRenderers(){return this._sortedRenderers}commitChanges(){if(!this.updating)return!1;this._processAddsRemoves();let E=!1;y.splitRenderGeometryChangeSetByMaterial(this._changes).forEach((F,G)=>{let D=this._renderers.get(G);!D&&0<F.adds.length&&(D=new z.MergedRenderer({material:G}),D.initializeRenderContext(this.rendererContext.pluginContext,
this._materials),this._renderers.set(G,D),E=!0);D&&(D.modify(F),0===D.numGeometries&&(this._renderers.delete(G),D.destroy(),E=!0))});this._changes.clear();E&&this._updateSortedMaterialRenderers();this._hasHighlights=p.someMap(this._renderers,F=>(F=F.produces.get(B.RenderSlot.DRAPED_MATERIAL))?F(x.ShaderOutput.Highlight):!1);this._hasWater=p.someMap(this._renderers,F=>(F=F.produces.get(B.RenderSlot.DRAPED_WATER))?F(x.ShaderOutput.Normal):!1);this.notifyChange("updating");return!0}addGeometries(E,F){if(0!==
E.length){var G=this._validateRenderGeometries(E);for(var D of G)this._geometries.set(D.id,D);D=this._pending.empty;for(const I of G)this._pending.adds.add(I);D&&this.notifyChange("updating");F===v.DirtyOperation.UPDATE&&this._notifyGraphicGeometryChanged(E)}}removeGeometries(E,F){const G=this._pending.empty,D=this._pending.adds;for(const I of E)D.has(I)?(this._pending.removed.add(I),D.delete(I)):this._pending.removed.has(I)||this._pending.removes.add(I),this._geometries.delete(I.id);G&&!this._pending.empty&&
this.notifyChange("updating");F===v.DirtyOperation.UPDATE&&this._notifyGraphicGeometryChanged(E)}modifyGeometries(E,F){const G=0===this._changes.updates.length;for(const D of E){const I=this._changes.updates.pushNew();I.renderGeometry=this._validateRenderGeometry(D);I.updateType=F}G&&0<this._changes.updates.length&&this.notifyChange("updating");switch(F){case v.DirtyState.TRANSFORMATION:case v.DirtyState.GEOMETRY:return this._notifyGraphicGeometryChanged(E);case v.DirtyState.VISIBILITY:return this._notifyGraphicVisibilityChanged(E)}}updateAnimation(E){let F=
!1;this._sortedRenderers.forAll(G=>F=!!G.updateAnimation&&G.updateAnimation(E)||F);return F}precompile(E){return this._sortedRenderers.reduce((F,G)=>G.precompile(E)||F,!1)}render(E){this._sortedRenderers.forAll(F=>{const G=F.acquireTechniques(E);G&&(F.render(E,G),u.releaseTechniques(G))})}intersect(E,F,G,D,I){for(const J of this._geometries.values()){if(!D(J))continue;this._intersectRenderGeometry(J,G,F,0,E,I);const N=this.rendererContext.longitudeCyclical;N&&(J.boundingSphere[0]-J.boundingSphere[3]<
N.min&&this._intersectRenderGeometry(J,G,F,N.range,E,I),J.boundingSphere[0]+J.boundingSphere[3]>N.max&&this._intersectRenderGeometry(J,G,F,-N.range,E,I));I++}return I}_updateSortedMaterialRenderers(){this._sortedRenderers.clear();let E=0;for(const F of this._renderers.values())F.drapedPriority=E++,this._sortedRenderers.push(F);this._sortedRenderers.sort((F,G)=>G.material?.renderPriority===F.material?.renderPriority?F.drapedPriority-G.drapedPriority:(G.material?.renderPriority||0)-(F.material?.renderPriority||
0))}_processAddsRemoves(){this._changes.adds.clear();this._changes.removes.clear();this._changes.adds.pushArray(Array.from(this._pending.adds));this._changes.removes.pushArray(Array.from(this._pending.removes));this._changes.updates.filterInPlace(({renderGeometry:E})=>!this._pending.has(E));this._pending.clear()}_intersectRenderGeometry(E,F,G,D,I,J){if(E.visible&&E.material.visible){var N=0;D+=E.transformation[12];N=E.transformation[13];H[0]=G[0]-D;H[1]=G[1]-N;E.screenToWorldRatio=this.rendererContext.screenToWorldRatio;
E.material.intersectDraped(E,null,I,H,(M,Q,O)=>{A(F,O,J,E.material.renderPriority,I,E.layerUid,E.graphicUid)},F)}}_notifyGraphicGeometryChanged(E){if(null!=this.drapeSource.notifyGraphicGeometryChanged)for(const {graphicUid:G}of E)if(null!=G&&G!==F){this.drapeSource.notifyGraphicGeometryChanged(G);var F=G}}_notifyGraphicVisibilityChanged(E){if(null!=this.drapeSource.notifyGraphicVisibilityChanged)for(const {graphicUid:G}of E)if(null!=G&&G!==F){this.drapeSource.notifyGraphicVisibilityChanged(G);var F=
G}}_validateRenderGeometries(E){for(const F of E)this._validateRenderGeometry(F);return E}_validateRenderGeometry(E){null==E.localOrigin&&(E.localOrigin=this._localOriginFactory.getOrigin(l.getCenter(E.boundingSphere)));return E}get test(){}};b.__decorate([e.property()],a.SortedRenderGeometryRenderer.prototype,"drapeSource",void 0);b.__decorate([e.property()],a.SortedRenderGeometryRenderer.prototype,"updating",null);b.__decorate([e.property()],a.SortedRenderGeometryRenderer.prototype,"rctx",null);
b.__decorate([e.property({constructOnly:!0})],a.SortedRenderGeometryRenderer.prototype,"rendererContext",void 0);b.__decorate([e.property()],a.SortedRenderGeometryRenderer.prototype,"_materials",null);b.__decorate([e.property()],a.SortedRenderGeometryRenderer.prototype,"_localOriginFactory",null);b.__decorate([e.property({readOnly:!0})],a.SortedRenderGeometryRenderer.prototype,"isEmpty",null);b.__decorate([e.property()],a.SortedRenderGeometryRenderer.prototype,"_renderers",void 0);b.__decorate([e.property()],
a.SortedRenderGeometryRenderer.prototype,"_geometries",void 0);a.SortedRenderGeometryRenderer=b.__decorate([f.subclass("esri.views.3d.webgl-engine.lib.SortedRenderGeometryRenderer")],a.SortedRenderGeometryRenderer);class C{constructor(){this.adds=new Set;this.removes=new Set;this.removed=new Set}get empty(){return 0===this.adds.size&&0===this.removes.size&&0===this.removed.size}has(E){return this.adds.has(E)||this.removes.has(E)||this.removed.has(E)}clear(){this.adds.clear();this.removes.clear();
this.removed.clear()}}const H=c.create();Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/TextureTechnique":function(){define("require exports ../../../../chunks/TextureOnly.glsl ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../../../webgl/renderState".split(" "),function(a,b,n,k,p,h){class e extends p.ShaderTechnique{constructor(g,d,f){super(g,d,new k.ReloadableShaderModule(n.TextureOnly,()=>new Promise((c,l)=>
a(["../core/shaderLibrary/util/TextureOnly.glsl"],c,l))),f)}initializePipeline(g){return g.hasAlpha?h.makePipelineState({blending:h.premultipliedAlphaToPremultipliedAlpha,colorWrite:h.defaultColorWrite}):h.makePipelineState({colorWrite:h.defaultColorWrite})}}b.TextureTechnique=e;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/TextureTechniqueConfiguration":function(){define(["exports","../../../../chunks/tslib.es6","../core/shaderTechnique/ShaderTechniqueConfiguration"],
function(a,b,n){class k extends n.ShaderTechniqueConfiguration{constructor(){super(...arguments);this.hasAlpha=!1}}b.__decorate([n.parameter()],k.prototype,"hasAlpha",void 0);a.TextureTechniqueConfiguration=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/OverlayCompositing.glsl":function(){define("exports ../views/3d/terrain/interfaces ../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass.glsl ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/IntegerPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform".split(" "),
function(a,b,n,k,p,h,e,g){function d(){const l=new e.ShaderBuilder;l.include(n.ScreenSpacePass);l.fragment.uniforms.add(new g.Texture2DPassUniform("tex",w=>w.texture));l.fragment.uniforms.add(new p.IntegerPassUniform("overlayIdx",w=>w.overlayIndex));l.fragment.uniforms.add(new k.FloatPassUniform("opacity",w=>w.opacity));l.fragment.main.add(h.glsl`vec2 overlayUV = overlayIdx == 0 ? vec2(uv.x * 0.5, uv.y) : vec2(uv.x * 0.5 + 0.5, uv.y);
fragColor = texture(tex, overlayUV) * opacity;`);return l}class f extends h.NoParameters{constructor(){super(...arguments);this.overlayIndex=b.OverlayIndex.INNER;this.opacity=1}}const c=Object.freeze(Object.defineProperty({__proto__:null,OverlayCompositingPassParameters:f,build:d},Symbol.toStringTag,{value:"Module"}));a.OverlayCompositing=c;a.OverlayCompositingPassParameters=f;a.build=d})},"esri/views/3d/webgl-engine/shaders/OverlayCompositingTechnique":function(){define(["require","exports","../core/shaderTechnique/ReloadableShaderModule",
"../core/shaderTechnique/ShaderTechnique","../../../../chunks/OverlayCompositing.glsl"],function(a,b,n,k,p){class h extends k.ShaderTechnique{constructor(e,g,d){super(e,g,new n.ReloadableShaderModule(p.OverlayCompositing,()=>new Promise((f,c)=>a(["./OverlayCompositing.glsl"],f,c))),d)}}b.OverlayCompositingTechnique=h;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/parts/renderUtils":function(){define(["exports"],function(a){class b{constructor(n,k){this.screen=
n;this.olid=k}}a.RenderSceneResult=b;a.removeLoadedShaderModules=function(){const n=globalThis.require?.modules;if(n){const k=Object.keys(n);for(const p of k)p.includes(".glsl")&&delete n[p]}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/PlanarPatch":function(){define("exports ../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../geometry/SpatialReference ../../../geometry/projection/projectVectorToVector ../../../geometry/support/aaBoundingBox ../../../geometry/support/aaBoundingRect ../../../geometry/support/spatialReferenceUtils ./PatchGeometryFactory ./Tile ./TileFrustumVisibility ../webgl-engine/lib/RayIntersections".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c){class l extends d.Tile{constructor(x,u,t,m,q){super();this._horizontalScaleFactor=1;this._extentInRenderSR=h.create();this._baseUsedMemory=900;this._subtreeGeometryElevationBoundMax=this._subtreeGeometryElevationBoundMin=0;this.init(x,u,t,m,q)}init(x,u,t,m,q){super.init(x,u,t,m,q);x=q.view.renderSpatialReference;u=q.spatialReference;this._horizontalScaleFactor=x=null!=x&&e.isPlateCarree(x)&&null!=u&&u.isGeographic?this.ellipsoid.radius*Math.PI/180:1;({isWebMercatorOnPlateCarree:t}=
q);q=this._extentInRenderSR;u=this.extent;if(t)x=b.fromValues(u[0],u[1],0),k.projectVectorToVector(x,n.WebMercator,x,n.PlateCarree),u=b.fromValues(u[2],u[3],0),k.projectVectorToVector(u,n.WebMercator,u,n.PlateCarree),q[0]=x[0],q[1]=x[1],q[2]=u[0],q[3]=u[1];else for(t=0;4>t;++t)q[t]=u[t]*x;this.centerAtSeaLevel[0]=.5*(q[0]+q[2]);this.centerAtSeaLevel[1]=.5*(q[1]+q[3]);this.centerAtSeaLevel[2]=0;this._edgeLen=Math.max(q[2]-q[0],q[3]-q[1]);this._edgeLen2=this._edgeLen*this._edgeLen;this.updateRadiusAndCenter()}updateRadiusAndCenter(){this._updateCenter();
var x=this._extentInRenderSR;const u=.5*(x[2]-x[0]);x=.5*(x[3]-x[1]);this._center[d.CenterPosition.MIDDLE][3]=Math.max(Math.sqrt(u*u+x*x),.5*(this.elevationBoundsMax-this.elevationBoundsMin))}_calculateFrustumVisibilityStatus(x){var u=this._aabb();const t=u[0],m=u[1],q=u[2],r=u[3],v=u[4];u=u[5];let y=!0;for(let z=0;6>z;z++){var B=x[z];const A=B[0],C=B[1],H=B[2];B=B[3];if(0<=A*(0<A?t:r)+C*(0<C?m:v)+H*(0<H?q:u)+B)return f.TileFrustumVisibility.OUTSIDE;y=y&&0>=A*(0>A?t:r)+C*(0>C?m:v)+H*(0>H?q:u)+B}return y?
f.TileFrustumVisibility.INSIDE:f.TileFrustumVisibility.INTERSECTS}_aabb(){const x=this._extentInRenderSR;return p.wrap(x[0],x[1],Math.min(this.elevationBoundsMin,this._subtreeGeometryElevationBoundMin),x[2],x[3],Math.max(this.elevationBoundsMax,this._subtreeGeometryElevationBoundMax))}intersectsRay(x,u,t,m){w[0]=1/u[0];w[1]=1/u[1];w[2]=1/u[2];return c.intersectAabbInvDirBefore(this._aabb(),x,w,t,m)}createGeometry(){g.createPlanarGlobePatch(this.renderData,this._horizontalScaleFactor);this._updateSubtreeGeometryElevationsBounds();
this.setMemoryDirty()}_updateSubtreeGeometryElevationsBounds(){var x=this.renderData;let u=this._subtreeGeometryElevationBoundMin;var t=this._subtreeGeometryElevationBoundMax;if(x)t=x.geometry.boundingBox,u=t[2],t=t[5];else if(!this.leaf){u=Infinity;t=-Infinity;for(const m of this.children)x=m,u=Math.min(u,x._subtreeGeometryElevationBoundMin),t=Math.max(t,x._subtreeGeometryElevationBoundMax)}if(u!==this._subtreeGeometryElevationBoundMin||t!==this._subtreeGeometryElevationBoundMax)this._subtreeGeometryElevationBoundMin=
u,this._subtreeGeometryElevationBoundMax=t,this.parent?._updateSubtreeGeometryElevationsBounds()}get minimumVerticesPerSide(){return 9>this.level?3:2}updateCornerElevations(){g.updateCornersPlanar(this.renderData,this._horizontalScaleFactor);this._updateSubtreeGeometryElevationsBounds()}updateEdgeElevations(){g.updateEdgesAndCornersPlanar(this.renderData,this._horizontalScaleFactor);this._updateSubtreeGeometryElevationsBounds()}updateEdgeElevationsAndResolutions(){g.updateEdgeElevationsAndResolutionsPlanar(this.renderData,
this._horizontalScaleFactor);this._updateSubtreeGeometryElevationsBounds()}get horizontalScale(){return this._horizontalScaleFactor}}const w=b.create();a.PlanarPatch=l;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/PatchGeometryFactory":function(){define("exports ../../../core/mathUtils ../../../geometry/support/aaBoundingBox ../../../geometry/support/aaBoundingRect ./ElevationData ./interfaces ./NeighborIndex ./PatchGeometry ./PatchGeometryLUT ./PatchRenderData ./terrainUtils ./Tile ./tileUtils ../webgl-engine/lib/Normals".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w,x){function u(T,S,Z){const {tile:ia,localOrigin:Y,geometry:ea}=T,{extent:ka,ellipsoid:ja}=ia,{boundingBox:X,numVerticesPerSide:aa,vertexAttributes:pa,poleVerticesStartIndex:la}=ea,na=aa-1,qa=Y[0],sa=Y[1],xa=Y[2],ta=ja.radius,Ba=ka[1],Ia=ka[3],Ca=[];let Ha=la;T=(Ga,Aa)=>{Aa*=aa;K(-qa,-sa,-xa+Ga*ta,X);Ca.push(new W(1===Ga,Aa,1===Ga?0:2,Ha,6));Aa=Math.PI/2-2*Math.atan(Math.exp(-(-1===Ga?Ba:Ia)/ta));const Ja=Ga*Math.PI/2-Aa;Ga=.99*(1===Ga?1:-1);const Sa=ta+0,{position:$a,
uv0:Wa}=pa,{typedBuffer:Ta,typedBufferStride:Da}=pa.normalCompressed;for(let Va=1;6>=Va;++Va){var La=Aa+Va/6*Ja;const ma=Math.cos(La);La=Math.sin(La);for(let za=0;za<=na;za++){const Na=za/na,Ra=ba.cosLonLUT[za]*ma,Pa=ba.sinLonLUT[za]*ma,ca=La,cb=Ra*Sa-qa,ib=Pa*Sa-sa,nb=ca*Sa-xa;K(cb,ib,nb,X);$a.setValues(Ha,cb,ib,nb);g.encodeUVInBuffer(Wa,Ha,Na,Ga);x.compressNormal(Ta,Ha,Ra,Pa,ca,Da);++Ha}}};S&&T(-1,0);Z&&T(1,na);return Ca}function t(T){T.tile.intersectsClippingArea&&(J(T),m(T))}function m(T,S=!1){const {geometry:Z,
geometryState:ia,tile:Y,localOrigin:ea}=T,{level:ka,extent:ja,extentInRadians:X,ellipsoid:aa}=Y,pa=aa.radius,la=X[0],na=X[2],qa=X[1],sa=X[3],{samplerData:xa}=ia,ta=ja[0],Ba=ja[2],Ia=ja[1],Ca=ja[3],Ha=q(T),{boundingBox:Ga,vertexAttributes:Aa}=Z,Ja=ea[0],Sa=ea[1],$a=ea[2];var Wa=Aa.position;const Ta=Wa.typedBuffer,Da=Wa.typedBufferStride,La=Aa.uv0;for(let Ra=0;4>Ra;++Ra){const Pa=1===Ra||3===Ra;Wa=ia.edgeResolutions[Ra];c.internalAssert(b.isPowerOfTwo(Wa));const ca=Wa+1;var Va=f.neighborTileIfLoadedOrSelf(Y,
ia.edgePeerNeighbors[Ra]);if(O(Y,Va,Ra)){I(T,Ra,Va);continue}const cb=null!=Va;c.internalAssert(!cb||Va.level===Y.level);c.internalAssert(!cb||0>=w.compareTilesByLij(Y,Va));var ma=Va?.renderData?.geometryState;if(c.enableTerrainInternalChecks){var za=Y.surface;if(!Va&&za&&!za.updatingRootTiles){var Na=c.neighborEdgeIndices[Ra];const ua=Y.findNeighborTile(Na,Ma=>Ma.loaded||Ma.leaf||Ma.level===Y.level);ua?ua.intersectsClippingArea&&(c.internalAssert(!ua.loaded),c.internalAssert(!ua.leaf),c.internalAssert(ua.level===
ka)):c.internalAssert(null==za?.rootTiles||!Y.shouldHaveNeighbor(Na))}}const ib=1===Ra?ja[2]:ja[0],nb=(Va=Va?.extent)&&Pa?1===Ra?Va[0]:Va[2]:ib,xb=0===Ra?ja[3]:ja[1],ya=1===Ra?1:0,Ea=0===Ra?1:0,Qa=1===Ra?na:la,db=0===Ra?sa:qa,lb=Math.sin(Qa),ub=Math.cos(Qa),Oa=Math.sin(db),Xa=Math.cos(db),Za=ma?.samplerData;ma=(ua,Ma,ab)=>p.sampleElevation(ua,Ma,xa);za=(ua,Ma,ab)=>.5*(p.sampleElevation(ua,Ma,xa)+p.sampleElevation(ab,Ma,Za));const hb=cb?za:ma;ma=Z.outerEdgesOffsetAndLength[2*Ra];const jb=S&&3<ca?ca-
3:1;za=null!=xa&&xa.some(ua=>null!=ua);Na=null!=Za&&Za.some(ua=>null!=ua);const ob=za||Na,zb=1/Wa,Db=ma;c.internalAssert(!Va||c.almostEquals(Va[2]-Va[0],ja[2]-ja[0]));(()=>{const ua=1===Ra?-1:3===Ra?1:0,Ma=0===Ra?-1:2===Ra?1:0,ab=(ja[2]-ja[0])*zb,qb=ua*ab,pb=Ma*ab,yb=na-la,Fb=Pa?ua*yb*zb:0,Sb=Pa?0:Ma*zb,Mb=Ea,Hb=Pa?Qa+Fb:Qa,Eb=Pa?Math.sin(Hb):lb,Ob=Pa?Math.cos(Hb):ub,Pb=Pa?Qa-Fb:Qa,Tb=Pa?Math.sin(Pb):lb,mb=Pa?Math.cos(Pb):ub,ra=Pa?db:Ha(Mb+Sb),Fa=Pa?Oa:Math.sin(ra),Ya=Pa?Xa:Math.cos(ra),bb=Pa?db:
Ha(Mb-Sb),fb=Pa?Oa:Math.sin(bb),kb=Pa?Xa:Math.cos(bb);let rb=0,vb=0,Ab=0;const Bb=0*zb,Ib=Pa?ib:ta*(1-Bb)+Ba*Bb,Jb=Pa?nb:Ib,Nb=Pa?Ia*(1-Bb)+Ca*Bb:xb,Qb=Pa?Qa:la*(1-Bb)+na*Bb,wb=Pa?lb:Math.sin(Qb),Cb=Pa?ub:Math.cos(Qb),Gb=Pa?Ha(Bb):db,Vb=Pa?Math.sin(Gb):Oa,ac=Pa?Math.cos(Gb):Xa,bc=pa+hb(Ib,Nb,Jb);rb=Cb*ac*bc;vb=wb*ac*bc;Ab=Vb*bc;let Xb=0,ec=0,Yb=0;const Lb=1*zb,cc=Pa?ib:ta*(1-Lb)+Ba*Lb,$b=Pa?nb:cc,Kb=Pa?Ia*(1-Lb)+Ca*Lb:xb,Ub=Pa?Qa:la*(1-Lb)+na*Lb,kc=Pa?lb:Math.sin(Ub),xc=Pa?ub:Math.cos(Ub),sc=Pa?Ha(Lb):
db,tc=Pa?Math.sin(sc):Oa,dc=Pa?Math.cos(sc):Xa,uc=pa+hb(cc,Kb,$b);Xb=xc*dc*uc;ec=kc*dc*uc;Yb=tc*uc;for(let Rb=1;Rb<ca-1;Rb+=jb){let jc=0,vc=0,zc=0;const wc=(Rb+1)*zb,Hc=Pa?ib:ta*(1-wc)+Ba*wc,Wc=Pa?nb:Hc,Bc=Pa?Ia*(1-wc)+Ca*wc:xb,Ec=Pa?Qa:la*(1-wc)+na*wc,Oc=Pa?lb:Math.sin(Ec),Ic=Pa?ub:Math.cos(Ec),Jc=Pa?Ha(wc):db,Pc=Pa?Math.sin(Jc):Oa,Xc=Pa?Math.cos(Jc):Xa,vd=pa+hb(Hc,Bc,Wc);jc=Ic*Xc*vd;vc=Oc*Xc*vd;zc=Pc*vd;const je=jc,ke=vc,le=zc,wd=Xb,Qc=ec,xd=Yb;Xb=je;ec=ke;Yb=le;const me=Db+Rb,yd=me*Da,ne=wd-Ja,
zd=Qc-Sa,oe=xd-$a;Ta[yd]=ne;Ta[yd+1]=zd;Ta[yd+2]=oe;K(ne,zd,oe,Ga);const pe=Rb*zb;g.encodeUVInBuffer(La,me,Pa?ya:pe,Pa?pe:Ea);const qe=rb,af=vb,re=Ab;rb=wd;vb=Qc;Ab=xd;const Rc=wd,Yc=Qc,Sc=xd,qd=1/Math.sqrt(Rc*Rc+Yc*Yc+Sc*Sc),se=Sc*qd;let Tc=0,Uc=0,Vc=0;if(ob&&.999>se*se){let Ad=0,Bd=0,Cd=0;const Dd=0===Ra?-1:1;Ad=Dd*(je-qe);Bd=Dd*(ke-af);Cd=Dd*(le-re);const Mc=Rb*zb,te=Pa?ib:ta*(1-Mc)+Ba*Mc,bf=Pa?nb:te,ue=Pa?Ia*(1-Mc)+Ca*Mc:xb,ve=Pa?Qa:la*(1-Mc)+na*Mc,we=Pa?lb:Math.sin(ve),xe=Pa?ub:Math.cos(ve),
ye=Pa?Ha(Mc):db,ze=Pa?Math.sin(ye):Oa,Ae=Pa?Math.cos(ye):Xa;let Ed=Rc,Fd=Yc,Gd=Sc;if(cb){const Hd=pa+p.sampleElevation(bf-qb,ue-pb,Za),cf=Pa?Tb:we,df=Pa?ze:fb,Be=Pa?Ae:kb;Ed=(Pa?mb:xe)*Be*Hd;Fd=cf*Be*Hd;Gd=df*Hd}const Id=pa+p.sampleElevation(te+qb,ue+pb,xa),Ce=Pa?Ae:Ya,De=(Pa?Ob:xe)*Ce*Id,Ee=(Pa?Eb:we)*Ce*Id,Fe=(Pa?ze:Fa)*Id;cb||(Ed=2*Rc-De,Fd=2*Yc-Ee,Gd=2*Sc-Fe);const Jd=3===Ra?-1:1,Ge=Jd*(Ed-De),He=Jd*(Fd-Ee),Ie=Jd*(Gd-Fe);Tc=Cd*He-Bd*Ie;Uc=Ad*Ie-Cd*Ge;Vc=Bd*Ge-Ad*He;const Kd=1/Math.sqrt(Tc*Tc+
Uc*Uc+Vc*Vc);Tc*=Kd;Uc*=Kd;Vc*=Kd}else Tc=Rc*qd,Uc=Yc*qd,Vc=Sc*qd;Z.setEdgeNormalFromValues(Ra,Rb,Tc,Uc,Vc)}})()}}function q(T){({tile:T}=T);if(T.surface.isWebMercator){const Z=T.extent,ia=T.ellipsoid.radius;return Y=>Math.PI/2-2*Math.atan(Math.exp(-(Z[1]*(1-Y)+Z[3]*Y)/ia))}const S=T.extentInRadians;return Z=>S[1]*(1-Z)+S[3]*Z}function r(T,S){T.tile.intersectsClippingArea&&(J(T),v(T,!1))}function v(T,S){const {geometry:Z,geometryState:ia,localOrigin:Y}=T,ea=T.tile,{surface:ka,extent:ja}=ea,{clippingArea:X,
samplerData:aa}=ia,pa=null!=X?X:U,la=ja[0],na=ja[2],qa=ja[1],sa=ja[3],xa=[sa>pa[3],na>pa[2],qa<pa[1],la<pa[0]],ta=ea.horizontalScale,Ba=y(ka.isWebMercatorOnPlateCarree,ea.ellipsoid.radius,ta),{minu:Ia,minv:Ca,maxu:Ha,maxv:Ga,boundingBox:Aa}=Z,Ja=Math.max(la,pa[0]),Sa=Math.min(na,pa[2]),$a=Math.max(qa,pa[1]),Wa=Math.min(sa,pa[3]),Ta=Y[0],Da=Y[1],La=Y[2];for(let Va=0;4>Va;++Va){const ma=1===Va||3===Va,za=ia.edgeResolutions[Va];c.internalAssert(b.isPowerOfTwo(za));const Na=za+1,Ra=xa[Va],Pa=f.neighborTileIfLoadedOrSelf(ea,
ia.edgePeerNeighbors[Va]);if(!Ra&&O(ea,Pa,Va)){I(T,Va,Pa);continue}const ca=null!=Pa&&!Ra,cb=Pa?.renderData?.geometryState;if(c.enableTerrainInternalChecks&&(c.internalAssert(!ca||Pa.level===ea.level),c.internalAssert(!ca||0>=w.compareTilesByLij(ea,Pa)),ea&&!Pa&&!ka.updatingRootTiles)){const mb=c.neighborEdgeIndices[Va],ra=ea.findNeighborTile(mb,Fa=>Fa.loaded||Fa.leaf||Fa.level===ea.level);ka.updatingRootTiles||(ra?ra.intersectsClippingArea&&(c.internalAssert(!ra.loaded),c.internalAssert(!ra.leaf),
c.internalAssert(ra.level===ea.level)):c.internalAssert(null==ka?.rootTiles||!ea.shouldHaveNeighbor(mb)))}const ib=b.clamp(1===Va?na:la,Ja,Sa),nb=b.clamp(0===Va?sa:qa,$a,Wa),xb=cb?.samplerData,ya=S&&3<Na?Na-3:1,Ea=b.clamp(1===Va?1:0,Ia,Ha),Qa=b.clamp(0===Va?1:0,Ca,Ga),db=(mb,ra)=>p.sampleElevation(mb,ra,aa),lb=(mb,ra)=>.5*(p.sampleElevation(mb,ra,xb)+p.sampleElevation(mb,ra,aa)),ub=ca?lb:db,Oa=(na-la)/za,Xa=ma?1===Va?Oa:-Oa:0,Za=ma?0:0===Va?Oa:-Oa,hb=-Xa,jb=-Za;let ob=0,zb=0,Db=0;const ua=0/za,Ma=
ma?ib:b.clamp(la*(1-ua)+na*ua,Ja,Sa),ab=ma?b.clamp(qa*(1-ua)+sa*ua,$a,Wa):nb,qb=ub(Ma,ab);ob=Ma*ta;zb=Ba(ab);Db=qb;let pb=0,yb=0,Fb=0;const Sb=1/za,Mb=ma?ib:b.clamp(la*(1-Sb)+na*Sb,Ja,Sa),Hb=ma?b.clamp(qa*(1-Sb)+sa*Sb,$a,Wa):nb,Eb=ub(Mb,Hb),Ob=Mb*ta,Pb=Ba(Hb),Tb=Eb;pb=Ob;yb=Pb;Fb=Tb;for(let mb=1;mb<Na-1;mb+=ya){const ra=mb/za,Fa=pb,Ya=yb,bb=Fb,fb=ma?Ea:b.clamp(ra,Ia,Ha),kb=ma?b.clamp(ra,Ca,Ga):Qa,rb=Fa-Ta,vb=Ya-Da,Ab=bb-La;K(Fa,vb,Ab,Aa);Z.setEdgeVertexFromValuesRawPositionUV(Va,mb,rb,vb,Ab,fb,kb);
const Bb=(mb+1)/za,Ib=ma?ib:b.clamp(la*(1-Bb)+na*Bb,Ja,Sa),Jb=ma?b.clamp(qa*(1-Bb)+sa*Bb,$a,Wa):nb,Nb=ub(Ib,Jb);pb=Ib*ta;yb=Ba(Jb);Fb=Nb;const Qb=pb,wb=yb,Cb=Fb,Gb=ob,Vb=zb,ac=Db;ob=Fa;zb=Ya;Db=bb;let bc=0,Xb=0,ec=0;if(ma){const Lb=wb-Ya,cc=Cb-bb,$b=Vb-Ya,Kb=ac-bb,Ub=b.clamp(qa*(1-ra)+sa*ra,$a,Wa),kc=ib+hb,xc=kc*ta,sc=p.sampleElevation(kc,Ub,aa),tc=xc-Fa,dc=sc-bb,uc=3===Va?-1:1;bc=uc*(-$b+Lb)*dc;Xb=uc*tc*(-Kb+cc);ec=-uc*tc*(-$b+Lb);if(ca){const Rb=ib+Xa,jc=Rb*ta,vc=p.sampleElevation(Rb,Ub,xb),zc=
jc-Fa;bc=(-$b+Lb)*(dc-(vc-bb));Xb=(tc-zc)*(-Kb+cc);ec=-(tc-zc)*(-$b+Lb)}}else{const Lb=Qb-Fa,cc=Cb-bb,$b=Gb-Fa,Kb=ac-bb,Ub=b.clamp(la*(1-ra)+na*ra,Ja,Sa),kc=nb+jb,xc=p.sampleElevation(Ub,kc,aa)-bb,sc=Ba(kc)-Ya,tc=2===Va?-1:1;bc=tc*sc*(-Kb+cc);Xb=tc*(-$b+Lb)*xc;ec=-tc*sc*(-$b+Lb);if(ca){const dc=Ub,uc=nb+Za,Rb=Ba(uc),jc=p.sampleElevation(dc,uc,xb)-bb,vc=Rb-Ya;bc=(-sc+vc)*(-Kb+cc);Xb=(-$b+Lb)*(-xc+jc);ec=-(-sc+vc)*(-$b+Lb)}}const Yb=1/Math.sqrt(bc*bc+Xb*Xb+ec*ec);Z.setEdgeNormalFromValues(Va,mb,bc*
Yb,Xb*Yb,ec*Yb)}}}function y(T,S,Z){return T?ia=>(Math.PI/2-2*Math.atan(Math.exp(-ia/S)))*S:ia=>ia*Z}function B(T,S,Z){const {numVerticesPerSide:ia,vertexAttributes:Y,maxEdgeVertexCount:ea}=T,ka=ia-1;var ja=Y.count;const X=2*(ia-3)*(ia-3);var aa=4*(ka+ea-3);const pa=f.zeroToFour.reduce((qa,sa)=>qa+(ka+T.getEdgeCount(sa)-3),0),la=S.reduce((qa,sa)=>qa+ka*(2*(sa.latitudeResolution-1)+1),0),na=3*(Z?2:1);aa=(X+aa+la)*na;ja=65536<=ja?new Uint32Array(aa):new Uint16Array(aa);for(let qa=0;qa<aa;++qa)ja[qa]=
0;T.indices=ja;T.indexCount=(X+pa+la)*na;T.poleIndicesStartIndex=X*na;T.edgeIndicesStartIndex=(X+la)*na;Z?(H(T),E(T,S),F(T)):(z(T),A(T,S),C(T))}function z(T){const {numVerticesPerSide:S,indices:Z,vertexAttributes:ia}=T;({position:T}=ia);const {typedBuffer:Y,typedBufferStride:ea}=T;T=S-2;const ka=S-3,ja=S-3;let X=0;for(let aa=0;aa<ka;++aa){const pa=aa*T;for(let la=0;la<ja;++la){const na=pa+la,qa=na+1,sa=qa+T,xa=sa-1;P(na,qa,sa,xa,ea,Y)?(Z[X]=na,Z[X+1]=qa,Z[X+2]=sa,Z[X+3]=sa,Z[X+4]=xa,Z[X+5]=na):(Z[X]=
na,Z[X+1]=qa,Z[X+2]=xa,Z[X+3]=xa,Z[X+4]=qa,Z[X+5]=sa);X+=6}}}function A(T,S){const {numVerticesPerSide:Z,indices:ia,poleIndicesStartIndex:Y}=T,ea=Z-1;let ka=Y;for(const ja of S){S=ja.isNorth?1:2;const X=ja.isNorth?2:1,aa=ja.isNorth?3:4,pa=ja.isNorth?4:3;let la=T.getEdgeVertexIndex(ja.connectedOuterEdgeOffset,0),na=1;for(let qa=0;qa<ja.latitudeResolution;++qa){const sa=0===qa?ja.rowOffset:la+Z;for(let xa=0;xa<ea;xa++){const ta=sa+xa;ia[ka]=la;ia[ka+S]=la+1;ia[ka+X]=ta;qa<ja.latitudeResolution-1?(ia[ka+
aa]=la+1,ia[ka+pa]=ta+1,ia[ka+5]=ta,ka+=6):ka+=3;la+=na}la=sa;na=1}}}function C(T){const {indices:S,numVerticesPerSide:Z,edgeIndicesStartIndex:ia}=T,Y=Z-1,ea=Y-2;let ka=ia;for(let pa=0;4>pa;++pa){var ja=ha[pa];let la=0,na=0;const qa=T.getEdgeCount(pa),sa=ja.count;c.internalAssert(sa===Y-1);var X=1===pa||2===pa;const xa=X?1:2;X=X?2:1;const ta=T.getEdgeFirstVertexIndex(pa),Ba=ja.vertex0Index;for(ja=ja.stride;la<qa-1||na<sa-1;){const Ia=Ba+na*ja,Ca=ta+1*la;var aa=la<qa-1;const Ha=na<sa-1,Ga=aa?Y*(la+
.5)/(qa-1):0,Aa=Ha?1+ea*(na+.5)/(sa-1):0;(aa=aa&&(!Ha||Ga<=Aa))?++la:++na;aa=aa?Ca+1:Ia+ja;S[ka]=Ia;S[ka+xa]=Ca;S[ka+X]=aa;ka+=3}}T.indexCount=ka}function H(T){const {indices:S,numVerticesPerSide:Z,vertexAttributes:ia}=T;({position:T}=ia);const {typedBuffer:Y,typedBufferStride:ea}=T;T=Z-2;let ka=0;for(let ja=0;ja<Z-3;++ja){const X=ja*T;for(let aa=0;aa<Z-3;++aa){const pa=ja*T+aa,la=pa+1,na=la+T,qa=na-1,sa=X+aa,xa=sa+1,ta=xa+T;P(sa,xa,ta,ta-1,ea,Y)?(R(S,ka,pa,la,na),ka+=6,R(S,ka,na,qa,pa)):(R(S,ka,
pa,la,qa),ka+=6,R(S,ka,qa,na,la));ka+=6}}}function E(T,S){const {indices:Z,numVerticesPerSide:ia,poleIndicesStartIndex:Y}=T,ea=ia-1;let ka=Y;for(const ja of S){S=T.getEdgeVertexIndex(ja.connectedOuterEdgeOffset,0);let X=1;for(let aa=0;aa<ja.latitudeResolution;++aa){const pa=0===aa?ja.rowOffset:S+ia;for(let la=0;la<ea;la++)R(Z,ka,S,S+1,pa+la),ka+=6,aa<ja.latitudeResolution-1&&(R(Z,ka,S+1,pa+la+1,pa+la),ka+=6),S+=X;S=pa;X=1}}}function F(T){const {indices:S,numVerticesPerSide:Z,edgeIndicesStartIndex:ia}=
T,Y=Z-1,ea=Y-2;let ka=ia;for(let pa=0;4>pa;++pa){var ja=ha[pa];let la=0,na=0;const qa=T.getEdgeCount(pa),sa=ja.count;c.internalAssert(sa===Y-1);var X=1===pa||2===pa;const xa=X?1:3;X=X?3:1;const ta=T.getEdgeFirstVertexIndex(pa),Ba=ja.vertex0Index;for(ja=ja.stride;la<qa-1||na<sa-1;){const Ia=Ba+na*ja,Ca=ta+1*la;var aa=la<qa-1;const Ha=na<sa-1,Ga=aa?Y*(la+.5)/(qa-1):0,Aa=Ha?1+ea*(na+.5)/(sa-1):0;(aa=aa&&(!Ha||Ga<=Aa))?++la:++na;aa=aa?Ca+1:Ia+ja;S[ka]=Ia;S[ka+xa]=Ca;S[ka+xa+1]=Ca;S[ka+X]=aa;S[ka+X+1]=
aa;S[ka+5]=Ia;ka+=6}}T.indexCount=ka}function G(T){const {geometry:S,geometryState:Z}=T;({edgeResolutions:T}=Z);const {numVerticesPerSide:ia,edgeVerticesStartIndex:Y}=S,ea=ia-2;let ka=Y;for(let X=0;4>X;++X){var ja=0===X||2===X;ja=(ja?0:1)*ea+(ja?1:0);const aa=ha[X];aa.vertex0Index=(0===X?ea-1:0)*ea+(1===X?ea-1:0);aa.stride=ja;aa.count=ea;ja=T[X]+1;S.outerEdgesOffsetAndLength[2*X]=ka;S.outerEdgesOffsetAndLength[2*X+1]=ja;ka+=ja}}function D(T){G(T);T.geometryState.wireframe?F(T.geometry):C(T.geometry)}
function I(T,S,Z){const {geometryState:ia,geometry:Y,tile:ea,localOrigin:ka}=T;T=1===S||3===S;const ja=ia.edgeResolutions[S];c.internalAssert(b.isPowerOfTwo(ja));const X=ja+1,{boundingBox:aa,minu:pa,minv:la,maxu:na,maxv:qa,vertexAttributes:sa}=Y,xa=b.clamp(1===S?1:0,pa,na),ta=b.clamp(0===S?1:0,la,qa);var Ba=Z.renderData,Ia=Ba.geometryState,Ca=Ba.geometry,Ha=(S+2)%4,Ga=Ca.getEdgeCount(Ha);const Aa=ea.getNeighborEdgeStartVertexIndex(S,Z)*ja;Z=ja*2**(ea.level-Z.level);c.internalAssert(Ia.edgeResolutions[Ha]===
Z);c.internalAssert(Ga-1===Z);Z=Ba.localOrigin[0]-ka[0];Ia=Ba.localOrigin[1]-ka[1];Ba=Ba.localOrigin[2]-ka[2];S=Y.getEdgeFirstVertexIndex(S);var Ja=sa.position;Ga=Ja.typedBuffer;Ja=Ja.typedBufferStride;var Sa=sa.normalCompressed;const $a=Sa.typedBuffer;Sa=Sa.typedBufferStride;const Wa=sa.uv0;var Ta=Ca.vertexAttributes;Ca=Ca.getEdgeFirstVertexIndex(Ha);Ha=Ta.position.typedBuffer;const Da=Ta.position.typedBufferStride,La=Ta.normalCompressed.typedBuffer;Ta=Ta.normalCompressed.typedBufferStride;for(let Na=
1;Na<X-1;++Na){const Ra=S+Na;var Va=Ca+(Aa+Na),ma=Ra*Ja,za=Va*Da;const Pa=Ha[za]+Z,ca=Ha[za+1]+Ia;za=Ha[za+2]+Ba;Ga[ma]=Pa;Ga[ma+1]=ca;Ga[ma+2]=za;K(Pa,ca,za,aa);ma=Ra*Sa;Va*=Ta;$a[ma]=La[Va];$a[ma+1]=La[Va+1];ma=Na/ja;Va=T?xa:b.clamp(ma,pa,na);ma=T?b.clamp(ma,la,qa):ta;g.encodeUVInBuffer(Wa,Ra,Va,ma)}}function J(T){const {geometry:S,geometryState:Z,localOrigin:ia}=T,{clippingArea:Y,samplerData:ea}=Z,{minu:ka,minv:ja,maxu:X,maxv:aa,boundingBox:pa,vertexAttributes:la}=S,na=T.tile,{surface:qa,ellipsoid:sa,
extent:xa,extentInRadians:ta,horizontalScale:Ba}=na,Ia="local"===qa.view?.viewingMode,Ca=sa.radius;let Ha=0,Ga=0,Aa=0;const Ja=()=>{const Za=null!=Y&&(xa[3]>Y[3]||xa[2]>Y[2]||xa[1]<Y[1]||xa[0]<Y[0]),hb=y(qa.isWebMercatorOnPlateCarree,Ca,Ba);return(jb,ob,zb)=>{jb=0===jb?xa[0]:xa[2];ob=0===ob?xa[1]:xa[3];jb=Za?b.clamp(jb,Y[0],Y[2]):jb;ob=Za?b.clamp(ob,Y[1],Y[3]):ob;Ha=jb*Ba;Ga=hb(ob);Aa=zb}},Sa=(Za,hb,jb)=>{var ob=ta[0===hb?1:3];Za=ta[0===Za?0:2];hb=Math.cos(ob);ob=Math.sin(ob);const zb=Math.sin(Za);
jb=Ca+jb;Ha=Math.cos(Za)*hb*jb;Ga=zb*hb*jb;Aa=ob*jb},$a=Ia?Ja():Sa;let Wa=0,Ta=0,Da=0,La=0,Va=0,ma=0,za=0,Na=0,Ra=0;const Pa=Ia&&qa.isWebMercatorOnPlateCarree,ca=(Za,hb,jb,ob,zb)=>{var Db=0,ua=0;let Ma=0;Ia?(jb=Pa?(Math.PI/2-2*Math.atan(Math.exp(-jb/Ca)))*Ca:jb*Ba,Db=hb*Ba-Ha,ua=jb-Ga,Ma=ob-Aa):(Db=q(Za),Za=Za.tile,ua=Za.extent,Za=Za.extentInRadians,hb=(hb-ua[0])/(ua[2]-ua[0]),hb=Za[0]*(1-hb)+Za[2]*hb,Db=Db((jb-ua[1])/(ua[3]-ua[1])),jb=Math.cos(Db),Za=Math.sin(Db),ua=Math.sin(hb),ob=Ca+ob,Db=Math.cos(hb)*
jb*ob-Ha,ua=ua*jb*ob-Ga,Ma=Za*ob-Aa);switch(zb){case 0:za+=Db;Na+=ua;Ra+=Ma;break;case 1:La-=Db;Va-=ua;ma-=Ma;break;case 2:za-=Db;Na-=ua;Ra-=Ma;break;case 3:La+=Db,Va+=ua,ma+=Ma}},cb=Y??U,ib=xa[0],nb=xa[2],xb=xa[1],ya=xa[3],Ea=[ya>cb[3],nb>cb[2],xb<cb[1],ib<cb[0]],Qa=Math.max(ib,cb[0]),db=Math.min(nb,cb[2]),lb=Math.max(xb,cb[1]),ub=Math.min(ya,cb[3]),Oa=Za=>{var hb=Z.cornerNeighborCornerTiles;Ta=Wa=0;Da=1;Ra=Na=za=ma=Va=La=0;var jb=Infinity;for(var ob=0;4>ob;++ob)jb=Math.min(jb,hb[4*Za+ob]?.level??
Infinity);for(ob=0;4>ob;++ob){var zb=hb[4*Za+ob];da[ob]=zb?.level===jb?zb:null}Za=1;hb=0;for(jb=0;4>jb;++jb)if(ob=da[jb])Za=Math.max(Za,ob?.renderData.geometryState.numVerticesPerSide),hb=ob.extent[2]-ob.extent[0];c.internalAssert(1<Za);Za=hb/Za;for(hb=0;4>hb;++hb){zb=da[(hb+3)%4];var Db=da[hb%4];if(zb||Db){ob=0===hb?1:1===hb?2:2===hb?3:0;var ua=0===hb?2:1===hb?3:2===hb?0:1;if(zb&&Db){var Ma=V[hb][0]*Za,ab=V[hb][1]*Za,qb=zb.extent;jb=Math.max(cb[0],Math.min(cb[2],qb[0===ob||1===ob?2:0]+Ma));ob=Math.max(cb[1],
Math.min(cb[3],qb[0===ob||3===ob?3:1]+ab));qb=Db.extent;Ma=Math.max(cb[0],Math.min(cb[2],qb[0===ua||1===ua?2:0]+Ma));ua=Math.max(cb[1],Math.min(cb[3],qb[0===ua||3===ua?3:1]+ab));zb=zb.renderData;ab=Db.renderData;Db=p.sampleElevation(jb,ob,zb.geometryState.samplerData);ua=p.sampleElevation(Ma,ua,ab.geometryState.samplerData);ca(zb,jb,ob,.5*(Db+ua),hb)}else jb=zb??Db,zb=zb?ob:ua,Db=jb.extent,ua=V[hb],ob=Math.max(cb[0],Math.min(cb[2],Db[0===zb||1===zb?2:0]+ua[0]*Za)),zb=Math.max(cb[1],Math.min(cb[3],
Db[0===zb||3===zb?3:1]+ua[1]*Za)),jb=jb.renderData,Db=p.sampleElevation(ob,zb,jb.geometryState.samplerData),ca(jb,ob,zb,Db,hb)}}Ia||(Za=Math.sqrt(Ha*Ha+Ga*Ga+Aa*Aa),Wa=Ha/Za,Ta=Ga/Za,Da=Aa/Za);if(Ia||.999>Da*Da)Za=Math.sqrt(La*La+Va*Va+ma*ma),La/=Za,Va/=Za,ma/=Za,Za=Math.sqrt(za*za+Na*Na+Ra*Ra),za/=Za,Na/=Za,Ra/=Za,Wa=ma*Na-Va*Ra,Ta=La*Ra-ma*za,Da=Va*za-La*Na,Za=1/Math.sqrt(Wa*Wa+Ta*Ta+Da*Da),Wa*=Za,Ta*=Za,Da*=Za},Xa=Z.cornerNeighborCornerTiles;for(let Za=0;4>Za;++Za){const hb=Za,jb=(Za+1)%4,ob=0===
Za||1===Za?1:0,zb=0===Za||3===Za?1:0,Db=b.clamp(ob,ka,X),ua=b.clamp(zb,ja,aa),Ma=S.getEdgeFirstVertexIndex(hb),ab=S.getEdgeCount(hb),qb=0===Za||3===Za?ab-1:0,pb=S.getEdgeFirstVertexIndex(jb),yb=S.getEdgeCount(jb),Fb=0===Za||1===Za?yb-1:0;let Sb=-1;for(let Eb=0;4>Eb;++Eb){const Ob=Xa[4*Za+Eb],Pb=Xa[4*Za+Sb];Ob&&(-1===Sb||0<w.compareTilesByLij(Pb,Ob))&&(Sb=Eb)}const Mb=Sb,Hb=Xa[4*Za+Mb];if(Hb!==na){const Eb=na.level-Hb.level,Ob=2**Eb,Pb=[Hb.lij[0]+Eb,Hb.lij[1]*Ob,Hb.lij[2]*Ob],Tb=[Pb[1]+Ob===na.lij[1],
0===Za&&(1===Mb||0===Mb&&Hb!==Xa[4*Za+3])||1===Za&&(0===Mb||1===Mb&&Hb!==Xa[4*Za+2]),Pb[1]===na.lij[1]+1,2===Za&&(3===Mb||2===Mb&&Hb!==Xa[4*Za+1])||3===Za&&(2===Mb||3===Mb&&Hb!==Xa[4*Za])],mb=Tb.reduce((Kb,Ub)=>Kb+(Ub?1:0),0);c.internalAssert(1===mb||2===mb);let ra=-1,Fa=-1;const Ya=Hb.renderData;if(1===mb){const Kb=Tb.findIndex(kc=>kc);c.internalAssert(0<=Kb&&3>=Kb);ra=(Kb+2)%4;const Ub=Z.edgeResolutions[Kb];Fa=na.getNeighborEdgeStartVertexIndex(Kb,Hb)*Ub+Ub*(0===Kb&&0===Za||1===Kb&&0===Za||2===
Kb&&1===Za||3===Kb&&3===Za?1:0)}else{c.internalAssert(Tb[1]||Tb[3]);ra=Tb[1]?3:1;const Kb=Ya.geometryState.edgeResolutions[ra];Fa=0===Za||3===Za?0:Kb}const bb=Ya.geometry,fb=Ma+qb,kb=pb+Fb,rb=bb.getEdgeFirstVertexIndex(ra)+Fa,vb=bb.vertexAttributes,Ab=Ya.localOrigin,Bb=vb.position,Ib=Bb.typedBuffer,Jb=rb*Bb.typedBufferStride,Nb=Ib[Jb]+Ab[0]-ia[0],Qb=Ib[Jb+1]+Ab[1]-ia[1],wb=Ib[Jb+2]+Ab[2]-ia[2];K(Nb,Qb,wb,pa);const Cb=la.position,Gb=Cb.typedBuffer,Vb=fb*Cb.typedBufferStride;Gb[Vb]=Nb;Gb[Vb+1]=Qb;Gb[Vb+
2]=wb;const ac=kb*Cb.typedBufferStride;Gb[ac]=Nb;Gb[ac+1]=Qb;Gb[ac+2]=wb;const bc=la.uv0;g.encodeUVInBuffer(bc,fb,Db,ua);g.encodeUVInBuffer(bc,kb,Db,ua);const Xb=vb.normalCompressed.typedBuffer,ec=rb*vb.normalCompressed.typedBufferStride,Yb=la.normalCompressed,Lb=Yb.typedBuffer,cc=fb*Yb.typedBufferStride;Lb[cc]=Xb[ec];Lb[cc+1]=Xb[ec+1];const $b=kb*Yb.typedBufferStride;Lb[$b]=Xb[ec];Lb[$b+1]=Xb[ec+1]}else{const Eb=Ea[jb];let Ob=void 0;if(Ea[hb]||Eb){const ra=b.clamp(ib*(1-ob)+nb*ob,Qa,db),Fa=b.clamp(xb*
(1-zb)+ya*zb,lb,ub);Ob=p.sampleElevation(ra,Fa,ea)}else Ob=N(Xa,Za);$a(ob,zb,Ob);Oa(Za);const Pb=Ha-ia[0],Tb=Ga-ia[1],mb=Aa-ia[2];K(Pb,Tb,mb,pa);S.setEdgeVertexFromValuesRawPositionUVNormal(hb,qb,Pb,Tb,mb,Db,ua,Wa,Ta,Da);S.setEdgeVertexFromValuesRawPositionUVNormal(jb,Fb,Pb,Tb,mb,Db,ua,Wa,Ta,Da)}}for(let Za=0;4>Za;++Za)da[Za]=null}function N(T,S){const Z=4*S;S=f.zeroToFour.reduce((ka,ja)=>Math.min(ka,T[Z+ja]?.level??Infinity),Infinity);c.enableTerrainInternalChecks&&(c.internalAssert(!T[Z+0]||!T[Z+
2]||l.isCornerNeighbor(T[Z+0],T[Z+2],e.NeighborIndex.SOUTH_WEST)),c.internalAssert(!T[Z+1]||!T[Z+3]||l.isCornerNeighbor(T[Z+1],T[Z+3],e.NeighborIndex.NORTH_WEST)));let ia=0,Y=0;for(let ka=0;4>ka;++ka){var ea=T[Z+ka];if(ea&&ea.level===S){const ja=ea.extent;ea=p.sampleElevation(ja[0===ka||1===ka?0:2],ja[0===ka||3===ka?1:3],ea.renderData?.geometryState?.samplerData);Y+=ea;ia++}}S=ia?Y/ia:0;c.internalAssert(null!=S);return S}function M(T){const {vao:S,geometry:Z}=T,{vertexAttributes:ia,edgeVerticesStartIndex:Y}=
Z;T=ia.position.typedBuffer;S.vertexBuffers.get("geometry").setSubData(T,Y,Y,T.length)}function Q(T){const {vao:S,geometry:Z}=T,{indices:ia,indexCount:Y,edgeIndicesStartIndex:ea}=Z;S.indexBuffer.setSubData(ia,ea,ea,Y)}function O(T,S,Z){if(!S)return!1;T=w.compareTilesByLij(T,S);return 0<T||0===T&&2<=Z}function K(T,S,Z,ia){T<ia[0]?ia[0]=T:T>ia[3]&&(ia[3]=T);S<ia[1]?ia[1]=S:S>ia[4]&&(ia[4]=S);Z<ia[2]?ia[2]=Z:Z>ia[5]&&(ia[5]=Z)}function L(T){const {edgeResolutions:S,numVerticesPerSide:Z}=T;T=1+Math.max(...S);
return Math.max(Z,T)}function P(T,S,Z,ia,Y,ea){var ka=T*Y;T=ea[ka];const ja=ea[ka+1];ka=ea[ka+2];var X=S*Y;S=ea[X];const aa=ea[X+1];X=ea[X+2];var pa=Z*Y;Z=ea[pa];const la=ea[pa+1];pa=ea[pa+2];const na=ia*Y;ia=ea[na];Y=ea[na+1];ea=ea[na+2];return(S-ia)*(S-ia)+(aa-Y)*(aa-Y)+(X-ea)*(X-ea)>(T-Z)*(T-Z)+(ja-la)*(ja-la)+(ka-pa)*(ka-pa)}function R(T,S,Z,ia,Y){T[S]=Z;T[S+1]=ia;T[S+2]=ia;T[S+3]=Y;T[S+4]=Y;T[S+5]=Z}class W{constructor(T,S,Z,ia,Y){this.isNorth=T;this.connectedRowOffset=S;this.connectedOuterEdgeOffset=
Z;this.rowOffset=ia;this.latitudeResolution=Y}}const V=[[0,1],[1,0],[0,-1],[-1,0]],ba=new d.PatchGeometryLUT,U=k.fromValues(-Infinity,-Infinity,Infinity,Infinity),da=[null,null,null,null];class fa{constructor(){this.vertex0Index=0;this.stride=1;this.count=0}getVertexIndex(T){c.internalAssert(0<=T&&T<this.count);return this.vertex0Index+this.stride*T}}const ha=[new fa,new fa,new fa,new fa];a.createPlanarGlobePatch=function(T,S){const {tile:Z,geometryState:ia,geometry:Y}=T,{extent:ea,surface:ka}=Z,
{wireframe:ja}=ia,X=ea[0],aa=ea[1],pa=ea[2]-X,la=ea[3]-aa,{numVerticesPerSide:na,clippingArea:qa}=ia,sa=null!=qa?Math.max(0,(qa[0]-X)/pa):0,xa=null!=qa?Math.max(0,(qa[1]-aa)/la):0,ta=null!=qa?Math.min(1,(qa[2]-X)/pa):1,Ba=null!=qa?Math.min(1,(qa[3]-aa)/la):1,Ia=(na-2)**2,Ca=L(ia),Ha=ka.renderer.tileGeometryCache.acquire(Ia+4*Ca),{boundingBox:Ga}=Y;n.empty(Ga);Y.numVerticesPerSide=na;Y.vertexAttributes=Ha;Y.maxEdgeVertexCount=Ca;Y.minu=sa;Y.minv=xa;Y.maxu=ta;Y.maxv=Ba;{const Ob=T.tile;if(Ob.intersectsClippingArea){var {geometry:Aa,
geometryState:Ja,localOrigin:Sa}=T,{samplerData:$a,clippingArea:Wa,numVerticesPerSide:Ta}=Ja,{surface:Da,extent:La,ellipsoid:Va}=Ob,{isWebMercatorOnPlateCarree:ma}=Da,za=null!=Wa?Wa:U,Na=La[0],Ra=La[1],Pa=La[2],ca=La[3],cb=Math.max(Na,za[0]),ib=Math.min(Pa,za[2]),nb=Math.max(Ra,za[1]),xb=Math.min(ca,za[3]),ya=Va.radius,S=Ob.horizontalScale,Ea=Ta-1,Qa=Ta-2,{minu:db,minv:lb,maxu:ub,maxv:Oa,boundingBox:Xa,vertexAttributes:Za}=Aa,hb=Za.position,jb=Za.uv0,{typedBuffer:ob,typedBufferStride:zb}=Za.normalCompressed,
Db=Sa[0],ua=Sa[1],Ma=Sa[2],ab=hb.typedBuffer,qb=hb.typedBufferStride,pb=0,yb=b.clamp(Ra,nb,xb),Fb=ma?(Math.PI/2-2*Math.atan(Math.exp(-yb/ya)))*ya:yb*S,Sb=1/Ea,Mb=b.clamp(Ra*(1-Sb)+ca*Sb,nb,xb),Hb=Fb,Eb=ma?(Math.PI/2-2*Math.atan(Math.exp(-Mb/ya)))*ya:Mb*S;for(let Pb=1;Pb<=Qa;Pb++){const Tb=Pb/Ea,mb=b.clamp(Ra*(1-Tb)+ca*Tb,nb,xb),ra=b.clamp(Tb,lb,Oa),Fa=Eb,Ya=(Pb-1)/Ea,bb=b.clamp(Ra*(1-Ya)+ca*Ya,nb,xb),fb=Hb,kb=(Pb+1)/Ea,rb=b.clamp(Ra*(1-kb)+ca*kb,nb,xb),vb=ma?(Math.PI/2-2*Math.atan(Math.exp(-rb/ya)))*
ya:rb*S,Ab=b.clamp(kb,lb,Oa);Hb=Eb;Eb=vb;const Bb=b.clamp(Na,cb,ib);let Ib=Bb*S,Jb=p.sampleElevation(Bb,mb,$a);const Nb=1/Ea,Qb=b.clamp(Nb,db,ub),wb=b.clamp(Na*(1-Qb)+Pa*Qb,cb,ib);let Cb=Qb,Gb=wb,Vb=wb*S,ac=p.sampleElevation(wb,mb,$a);if(1===Pb){const bc=Vb-Db,Xb=Hb-ua,ec=ac-Ma,Yb=0*qb;ab[Yb]=bc;ab[Yb+1]=Xb;ab[Yb+2]=ec;K(bc,Xb,ec,Xa);const Lb=b.clamp(Nb,db,ub);g.encodeUVInBuffer(jb,pb,Lb,ra)}for(let bc=1;bc<=Qa;bc++){const Xb=Vb,ec=ac,Yb=(bc+1)/Ea,Lb=b.clamp(Yb,db,ub),cc=b.clamp(Na*(1-Yb)+Pa*Yb,cb,
ib),$b=Gb;Gb=cc;const Kb=pb+1,Ub=Kb*qb;if(1===Pb||bc===Qa){const Bc=p.sampleElevation(cc,mb,$a),Ec=cc*S,Oc=Fa,Ic=Bc;if(1===Pb&&bc<Qa){const Jc=Ec-Db,Pc=Oc-ua,Xc=Ic-Ma;ab[Ub]=Jc;ab[Ub+1]=Pc;ab[Ub+2]=Xc;K(Jc,Pc,Xc,Xa);g.encodeUVInBuffer(jb,Kb,Lb,ra)}Vb=Ec;ac=Ic}else Vb=ab[Ub]+Db,ac=ab[Ub+2]+Ma;const kc=Vb,xc=ac,sc=Ib,tc=Jb;Ib=Xb;Jb=ec;const dc=(pb-Qa)*qb,uc=1===Pb?p.sampleElevation($b,bb,$a):ab[dc+2]+Ma,Rb=p.sampleElevation($b,rb,$a);if(Pb<Qa){const Bc=pb+Qa,Ec=Bc*qb,Oc=Xb-Db,Ic=vb-ua,Jc=Rb-Ma;ab[Ec]=
Oc;ab[Ec+1]=Ic;ab[Ec+2]=Jc;K(Oc,Ic,Jc,Xa);const Pc=Cb;Cb=Lb;g.encodeUVInBuffer(jb,Bc,Pc,Ab)}const jc=kc-sc,vc=fb-vb,zc=vc*(xc-tc),wc=jc*(uc-Rb),Hc=-vc*jc,Wc=zc*zc+wc*wc+Hc*Hc;if(0===Wc)x.compressNormal(ob,pb,0,0,1,zb);else{const Bc=1/Math.sqrt(Wc);x.compressNormal(ob,pb,zc*Bc,wc*Bc,Hc*Bc,zb)}++pb}}}}Y.edgeVerticesStartIndex=Ia;G(T);r(T);B(Y,[],ja);T.intersectionData=null};a.createSphericalGlobePatch=function(T,S){const {tile:Z,geometry:ia,geometryState:Y}=T,{extentInRadians:ea,surface:ka}=Z,{isWebMercator:ja,
renderer:X}=ka,{numVerticesPerSide:aa,wireframe:pa}=Y,la=aa-1,na=(aa-2)**2,qa=ja&&(S===h.PatchType.HAS_SOUTH_POLE||S===h.PatchType.HAS_BOTH_POLES),sa=ja&&(S===h.PatchType.HAS_NORTH_POLE||S===h.PatchType.HAS_BOTH_POLES),xa=6*((qa?1:0)+(sa?1:0))*aa,ta=L(Y),Ba=X.tileGeometryCache.acquire(na+xa+4*ta);ia.numVerticesPerSide=aa;ia.vertexAttributes=Ba;ia.maxEdgeVertexCount=ta;const {boundingBox:Ia}=ia;n.empty(Ia);const Ca=q(T);ba.update(la,ea,Ca);{const {tile:Oa}=T;if(Oa.intersectsClippingArea){var {geometry:Ha,
geometryState:Ga,localOrigin:Aa}=T,{numVerticesPerSide:Ja,samplerData:Sa}=Ga,$a=Ja-2,Wa=Ja-1,{vertexAttributes:Ta,boundingBox:Da}=Ha,La=Ta.position,Va=Ta.uv0,{typedBuffer:ma,typedBufferStride:za}=Ta.normalCompressed,{extent:Na}=Oa,Ra=Na[0],Pa=Na[2],ca=Na[1],cb=Na[3],ib=Oa.ellipsoid.radius,nb=Aa[0],xb=Aa[1],ya=Aa[2],Ea=La.typedBuffer,Qa=La.typedBufferStride,db=1/Wa,lb=0;if(1<=$a){const Xa=ca*(1-db)+cb*db,Za=ba.sinLatLUT[1],hb=ba.cosLatLUT[1];for(let jb=1;jb<=$a;jb++){const ob=jb*db,zb=ba.sinLonLUT[jb],
Db=ba.cosLonLUT[jb],ua=ib+p.sampleElevation(Ra*(1-ob)+Pa*ob,Xa,Sa),Ma=-nb+ua*Db*hb,ab=-xb+ua*zb*hb,qb=-ya+ua*Za;K(Ma,ab,qb,Da);const pb=(jb-1)*Qa;Ea[pb]=Ma;Ea[pb+1]=ab;Ea[pb+2]=qb;g.encodeUVInBuffer(Va,jb-1,ob,db)}}for(let Xa=1;Xa<=$a;Xa++){const Za=Xa*db,hb=ca*(1-Za)+cb*Za,jb=ba.sinLatLUT[Xa],ob=ba.cosLatLUT[Xa],zb=Xa+1,Db=zb*db,ua=ca*(1-Db)+cb*Db,Ma=ba.sinLatLUT[zb],ab=ba.cosLatLUT[zb],qb=ba.sinLonLUT[0],pb=ba.cosLonLUT[0],yb=ib+p.sampleElevation(Ra,hb,Sa);let Fb=pb*ob*yb-nb,Sb=qb*ob*yb-xb,Mb=jb*
yb-ya;const Hb=lb*Qa;let Eb=Ea[Hb],Ob=Ea[Hb+1],Pb=Ea[Hb+2];for(let Tb=1;Tb<=$a;Tb++){const mb=Tb*db,ra=Ra*(1-mb)+Pa*mb,Fa=ba.sinLonLUT[Tb],Ya=ba.cosLonLUT[Tb];let bb=0,fb=0,kb=0;if(Tb<$a){const Kb=(lb+1)*Qa;bb=Ea[Kb];fb=Ea[Kb+1];kb=Ea[Kb+2]}else{const Kb=ba.sinLonLUT[Wa],Ub=ba.cosLonLUT[Wa],kc=ib+p.sampleElevation(Pa,hb,Sa);bb=Ub*ob*kc-nb;fb=Kb*ob*kc-xb;kb=jb*kc-ya}const rb=Fb,vb=Sb,Ab=Mb;Fb=Eb;Sb=Ob;Mb=Pb;Eb=bb;Ob=fb;Pb=kb;const Bb=bb-rb,Ib=fb-vb,Jb=kb-Ab;let Nb=0,Qb=0,wb=0;if(1<Xa){const Kb=(lb-
$a)*Qa;Nb=Ea[Kb];Qb=Ea[Kb+1];wb=Ea[Kb+2]}else{const Kb=ba.sinLatLUT[0],Ub=ba.cosLatLUT[0],kc=ib+p.sampleElevation(ra,ca,Sa);Nb=Ya*Ub*kc-nb;Qb=Fa*Ub*kc-xb;wb=Kb*kc-ya}const Cb=ib+p.sampleElevation(ra,ua,Sa),Gb=Ya*ab*Cb-nb,Vb=Fa*ab*Cb-xb,ac=Ma*Cb-ya;if(Xa<$a){const Kb=lb+$a,Ub=Kb*Qa;Ea[Ub]=Gb;Ea[Ub+1]=Vb;Ea[Ub+2]=ac;K(Gb,Vb,ac,Da);g.encodeUVInBuffer(Va,Kb,mb,Db)}const bc=Nb-Gb,Xb=Qb-Vb,ec=wb-ac;let Yb=Ya*ob,Lb=Fa*ob,cc=jb;.999>cc*cc&&(Yb=Jb*Xb-Ib*ec,Lb=Bb*ec-Jb*bc,cc=Ib*bc-Bb*Xb);const $b=1/Math.sqrt(Yb*
Yb+Lb*Lb+cc*cc);x.compressNormal(ma,lb,Yb*$b,Lb*$b,cc*$b,za);++lb}}}}ia.poleVerticesStartIndex=na;const ub=u(T,qa,sa);ia.edgeVerticesStartIndex=na+xa;G(T);t(T);B(ia,ub,pa);T.intersectionData=null};a.updateCornerSpherical=function(T){T.tile.intersectsClippingArea&&(J(T),m(T,!0),M(T),T.intersectionData=null)};a.updateCornersPlanar=function(T,S){T.tile.intersectsClippingArea&&(J(T),v(T,!0),M(T),T.intersectionData=null)};a.updateEdgeElevationsAndResolutionsPlanar=function(T,S){T.tile.intersectsClippingArea&&
(D(T),r(T),M(T),Q(T),T.intersectionData=null)};a.updateEdgeElevationsAndResolutionsSpherical=function(T){T.tile.intersectsClippingArea&&(D(T),t(T),M(T),Q(T),T.intersectionData=null)};a.updateEdgesAndCornersPlanar=function(T,S){T.tile.intersectsClippingArea&&(r(T),M(T),T.intersectionData=null)};a.updateEdgesAndCornersSpherical=function(T){T.tile.intersectsClippingArea&&(t(T),M(T),T.intersectionData=null)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/PatchGeometry":function(){define("exports ../../../core/maybe ../../../chunks/vec32 ../../../geometry/support/aaBoundingBox ./terrainUtils ../webgl-engine/lib/Normals".split(" "),
function(a,b,n,k,p,h){function e(d,f,c,l){d.setValues(f,16384*c,16384*l)}class g{constructor(){this.indices=null;this.poleIndicesStartIndex=this.edgeIndicesStartIndex=this.indexCount=0;this.vertexAttributes=null;this.maxEdgeVertexCount=this.poleVerticesStartIndex=this.edgeVerticesStartIndex=0;this.boundingBox=k.empty();this.minv=this.minu=this.numVerticesPerSide=0;this.maxv=this.maxu=1;this.outerEdgesOffsetAndLength=[0,0,0,0,0,0,0,0]}release(){this.vertexAttributes=b.releaseMaybe(this.vertexAttributes);
this.indices=null}reset(){this.vertexAttributes=this.indices=null;k.empty(this.boundingBox);this.numVerticesPerSide=0}getEdgeFirstVertexIndex(d){return this.outerEdgesOffsetAndLength[2*d]}getEdgeCount(d){return this.outerEdgesOffsetAndLength[2*d+1]}getEdgeVertexIndex(d,f){return this.getEdgeAttributeIndex(d,f)}getEdgeVertexPosition(d,f,c,l){this._getEdgeVertexRaw(this.getEdgeAttributeIndex(d,l),f);n.add(f,f,c)}getEdgeNormal(d,f,c){const {typedBuffer:l,typedBufferStride:w}=this.vertexAttributes.normalCompressed;
h.decompressNormal(f,l,this.getEdgeAttributeIndex(d,c),w)}setEdgeNormalFromValues(d,f,c,l,w){this._setNormal(this.getEdgeAttributeIndex(d,f),c,l,w)}setEdgeVertexFromValuesRawPositionUV(d,f,c,l,w,x,u){d=this.getEdgeAttributeIndex(d,f);this.vertexAttributes.position.setValues(d,c,l,w);this._setUV(d,x,u)}setEdgeVertexFromValuesRawPositionUVNormal(d,f,c,l,w,x,u,t,m,q){d=this.getEdgeAttributeIndex(d,f);this.vertexAttributes.position.setValues(d,c,l,w);this._setUV(d,x,u);this._setNormal(d,t,m,q)}_getEdgeVertexRaw(d,
f){this.vertexAttributes.position.getVec(d,f)}_setNormal(d,f,c,l){const {typedBuffer:w,typedBufferStride:x}=this.vertexAttributes.normalCompressed;h.compressNormal(w,d,f,c,l,x)}_setUV(d,f,c){e(this.vertexAttributes.uv0,d,f,c)}getEdgeAttributeIndex(d,f){p.internalAssert(0<=f&&f<this.getEdgeCount(d));return this.getEdgeFirstVertexIndex(d)+f}}a.PatchGeometry=g;a.encodeUVInBuffer=e;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/Normals":function(){define(["exports",
"../../../../core/mathUtils","../../../../chunks/vec32","../../../../core/libs/gl-matrix-2/factories/vec3f64","../../../../geometry/support/FloatArray"],function(a,b,n,k,p){function h(f,c,l,w,x,u=2){var t=1/(Math.abs(l)+Math.abs(w)+Math.abs(x));l*=t;w*=t;t=0>=x?(0<=w?1:-1)*(1-Math.abs(l)):w;c*=u;f[c]=g(0>=x?(0<=l?1:-1)*(1-Math.abs(w)):l);f[c+1]=g(t)}function e(f,c,l,w=2){w*=l;l=d(c[w]);c=d(c[w+1]);w=1-Math.abs(l)-Math.abs(c);f[2]=w;0>w?(f[0]=(0<=l?1:-1)*(1-Math.abs(c)),f[1]=(0<=c?1:-1)*(1-Math.abs(l))):
(f[0]=l,f[1]=c);n.normalize(f,f)}function g(f){return b.clamp(Math.round(32767*f),-32767,32767)}function d(f){return b.clamp(f/32767,-1,1)}a.compressAndTransformNormals=function(f,c){const l=f.length/3,w=new Int16Array(2*l);let x=0;const u=k.create();for(let t=0;t<l;++t)u[0]=f[x++],u[1]=f[x++],u[2]=f[x++],n.transformMat3(u,u,c),h(w,t,u[0],u[1],u[2]);return w};a.compressNormal=h;a.compressNormals=function(f){const c=f.length/3,l=new Int16Array(2*c);let w=0;for(let x=0;x<c;++x)h(l,x,f[w++],f[w++],f[w++]);
return l};a.decodeInt16=d;a.decompressNormal=e;a.decompressNormals=function(f,c=2){const l=f.length/c,w=p.newFloatArray(3*l),x=k.create();let u=0;for(let t=0;t<l;++t)e(x,f,t,c),w[u++]=x[0],w[u++]=x[1],w[u++]=x[2];return w};a.encodeInt16=g;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/PatchGeometryLUT":function(){define(["exports","./TerrainConst"],function(a,b){class n{constructor(){this.sinLonLUT=Array(b.maxPatchTesselation+1);this.cosLonLUT=Array(b.maxPatchTesselation+
1);this.sinLatLUT=Array(b.maxPatchTesselation+1);this.cosLatLUT=Array(b.maxPatchTesselation+1)}update(k,p,h){const e=p[0];p=p[2];for(let d=0;d<=k;d++){var g=d/k;const f=e*(1-g)+p*g;this.sinLonLUT[d]=Math.sin(f);this.cosLonLUT[d]=Math.cos(f);g=h(g);this.sinLatLUT[d]=Math.sin(g);this.cosLatLUT[d]=Math.cos(g)}}}a.PatchGeometryLUT=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/PatchRenderData":function(){define("exports ../../../core/arrayUtils ../../../core/has ../../../core/mathUtils ../../../core/maybe ../../../chunks/vec32 ../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../geometry/support/aaBoundingRect ../../../geometry/support/Ellipsoid ../support/buffer/glUtil ./GeometryState ./interfaces ./LayerClass ./NeighborIndex ./PatchGeometry ./TerrainConst ./terrainUtils ./TextureFader ./TextureReference ./TileOverlayData ./tileUtils ../webgl-engine/lib/VertexArrayObject ../webgl-engine/shaders/TerrainTechnique ../../webgl/BufferObject ../../webgl/enums".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w,x,u,t,m,q,r,v,y,B,z,A,C){function H(O,K){return K?.loaded||K===O?K:null}class E{constructor(){this.geometry=new u.PatchGeometry;this._texture=this._vao=this.geometryState=this.intersectionData=null;this._textureOpacity=1;this._textureRef=new q.TextureFader(()=>this._tile.surface.fadeDuration);this.overlay=new v;this._localOrigin=null;this._geometryStateChangedSinceLastUpdate=!0;this._hasGeometry=!1;this._modifiedFlags=0}get tile(){return this._tile}get localOrigin(){return this._localOrigin}init(O,
K){this.clear();this._tile=O;this.geometry.reset();this.intersectionData=null;this.geometryState=new c.GeometryState;this._localOrigin=K;this.overlay.clear()}clear(){this.releaseGeometry();this.releaseTexture();this._textureRef.clear();this.geometryState=this.intersectionData=this._tile=null}updateGeometryIfNeeded(O){if(!this._vao||this._geometryStateChangedSinceLastUpdate||this.wireframeChanged||this.clippingAreaChanged||this.samplerDataChanged||this.numVerticesPerSideChanged||this.dirtyCorners||
this.dirtyEdgeResolutions||this.dirtyEdges)this._updateGeometry(O),this._geometryStateChangedSinceLastUpdate=!1;if(m.enableTerrainInternalChecks&&this.tile.intersectsClippingArea)for(O=0;4>O;++O)m.internalAssert(this.geometry.getEdgeCount(O)===this.geometryState.edgeResolutions[O]+1)}_calculateEdgeResolution(O,K){const L=this.tile,P=this.geometryState.numVerticesPerSide-1;if(!L.surface.isGlobal){var R=L.surface.extent;if(null!=R&&(0===O&&L.extent[3]>R[3]||1===O&&L.extent[2]>R[2]||2===O&&L.extent[1]<
R[1]||3===O&&L.extent[0]<R[0]))return P}const W=L.level;R=m.neighborEdgeIndices[O];if(!K)return m.internalAssert(null==L.surface?.rootTiles||L.surface.updatingRootTiles||!L.shouldHaveNeighbor(R)),P;if(K.loaded)return R=K.renderData.geometryState,K=W-K.level,m.internalAssert(0<=K),0===K?Math.max(R.numVerticesPerSide-1,P):Math.max(1,R.edgeResolutions[(O+2)%4]/2**K);m.internalAssert(!K.leaf);let V=P;K.forAllSubtreeOnSide(m.oppositeEdge(R),ba=>{if(ba===L)return!0;if(ba.loaded)return V=Math.max(V,2**(ba.level-
W)),!0;m.internalAssert(!ba.leaf);return!1});return V}updateNeighborData(){const O=this.tile;if(O.intersectsClippingArea){var K=O.renderData.geometryState,L=fa=>(fa.loaded||fa.level===O.level)&&fa?.intersectsClippingArea,P=K.edgePeerNeighbors,R=K.edgePeerNeighborSamplerVersions;for(var W=0;4>W;++W){var V=O.findNeighborTile(m.neighborEdgeIndices[W],L),ba=H(O,V),U=ba?.renderData?.geometryState.samplerDataVersion??-1,da=H(O,P[W]);ba=ba!==da;da=R[W]!==U;m.enableTerrainInternalChecks&&V&&(m.internalAssert(O.level>=
V.level),m.internalAssert(O.level-V.level<=t.maxTileNeighborLevelDelta));P[W]=V;if(ba||da)R[W]=U,this._markEdgeDirty(W);U=K.edgeResolutions[W];V=this._calculateEdgeResolution(W,V);m.internalAssert(k.isPowerOfTwo(V));m.internalAssert(1<=V);K.edgeResolutions[W]=V;U!==V&&this._markEdgeResolutionDirty(W)}for(let fa=0;4>fa;++fa){V=O.findNeighborTile(m.neighborCornerIndices[fa],L);K.cornerPeerNeighbors[fa]=V;R=H(O,P[fa]);W=H(O,P[(fa+1)%4]);V=H(O,V);M[fa]=V;M[(fa+1)%4]=W;M[(fa+2)%4]=O;M[(fa+3)%4]=R;m.internalAssert(M.some(S=>
S?.loaded||S===O));const ha=M.reduce((S,Z)=>Math.min(S,Z?.level??Infinity),Infinity);M.forEach((S,Z)=>{S&&S?.level>ha&&(M[Z]=null)});m.internalAssert(M.some(S=>S?.loaded||S===O));const T=K.cornerNeighborCornerTiles;R=K.cornerNeighborCornerTileSamplerVersions;for(W=0;4>W;++W){V=M[W];U=V?.renderData.geometryState.samplerDataVersion??-1;ba=4*fa+W;da=T[ba]!==V;const S=!da&&R[ba]!==U;if(da||S)T[ba]=V,R[ba]=U,this._markCornerDirty(fa)}m.enableTerrainInternalChecks&&m.internalAssert(Q.some(S=>T[4*fa+S]?.loaded||
T[4*fa+S]===O))}m.enableTerrainInternalChecks&&m.internalAssert(this.geometryState.edgeResolutions.every(fa=>0<fa));for(K=0;4>K;++K)M[K]=null}}_updateGeometry(O){if(this.tile.intersectsClippingArea){m.enableTerrainInternalChecks&&m.internalAssert(!this.tile.intersectsClippingArea||this.geometryState.edgeResolutions.every(da=>0<da));this.intersectionData=null;var {tile:K,_vao:L,geometry:P,geometryState:R}=this,W={geometry:P},V=!L||!W||this.wireframeChanged||this.samplerDataChanged||this.clippingAreaChanged||
this.numVerticesPerSideChanged;W=0!==this.dirtyEdgeResolutions;var ba=R.edgeResolutions.reduce((da,fa)=>da+fa+1,0);V=V||W&&ba>(P?.maxEdgeVertexCount??0);ba=!V&&W;W=!ba&&(0!==this.dirtyEdges||W);var U=!W&&0!==this.dirtyCorners;V?(this.releaseGeometry(),this._createGeometry(O)):ba?K.updateEdgeElevationsAndResolutions():W||U?K.updateEdgeElevations():U?K.updateCornerElevations():console.warn("Update for no reason?");this._modifiedFlags=0}}get hasGeometry(){return this._hasGeometry}releaseGeometry(){this._hasGeometry=
!1;this.intersectionData=null;if(!this._vao)return!1;this._vao=p.disposeMaybe(this._vao);this.geometry.release();return!0}ensureTexture(O,K,L,P){K=K?C.PixelFormat.RGBA:C.PixelFormat.RGB;null!=this._texture&&(L===l.TextureUpdate.FADING&&0<this._tile.surface.fadeDuration&&this._isTextureVisible(this._texture)||this._texture.descriptor.width!==O||this._texture.descriptor.pixelFormat!==K)&&this.releaseTexture();null==this._texture&&(this._texture=P(),this.tile.setMemoryDirty());return this._texture}releaseTexture(){null!=
this._texture&&(this._texture.release(),this._texture=null,this.tile.setMemoryDirty())}reuseTexture(O,K){if(!O||!this._texture)return!1;O.setTextureReference(new r.TextureReference(this._texture,l.TextureUpdate.FADING,K,this._textureOpacity,0,1));return!0}get numVerticesPerSideChanged(){return 0!==(this._modifiedFlags&1)}get samplerDataChanged(){return 0!==(this._modifiedFlags&2)}get clippingAreaChanged(){return 0!==(this._modifiedFlags&4)}get wireframeChanged(){return 0!==(this._modifiedFlags&8)}get dirtyEdges(){return this._modifiedFlags>>
4&15}get dirtyCorners(){return this._modifiedFlags>>8&15}get dirtyEdgeResolutions(){return this._modifiedFlags>>12&15}_markCornerDirty(O){this._modifiedFlags|=1<<O<<8}_markEdgeDirty(O){this._modifiedFlags|=1<<O<<4;this._markCornerDirty((O+0)%4);this._markCornerDirty((O+3)%4)}_markEdgeResolutionDirty(O){this._modifiedFlags|=1<<O<<12;this._markEdgeDirty(O)}_markAllEdgesAndCornersDirty(){this._modifiedFlags|=65520}updateGeometryState(){var O=this._elevationInfo;const K=this.tile;var L=O.samplerData?
K.getElevationVerticesPerSide(O.maxTileLevel):K.minimumVerticesPerSide;const P=Math.max(L,5);let R=K.clippingArea;if(!K.intersectsClippingArea||K.withinClippingArea)R=null;L=this.geometryState;let W=!1;L.numVerticesPerSide!==P&&(this._modifiedFlags|=1,L.numVerticesPerSide=P,L.samplerDataVersion++,W=!0);O.changed&&(this._modifiedFlags|=2,L.samplerData=O.samplerData,L.samplerDataVersion++,W=!0);b.equals(L.clippingArea,R)||(this._modifiedFlags=4,L.clippingArea=R,W=!0);O=K.surface.wireframe;L.wireframe!==
O&&(this._modifiedFlags=8,L.wireframe=O,W=!0);this._geometryStateChangedSinceLastUpdate||(this._geometryStateChangedSinceLastUpdate=W);W&&this._markAllEdgesAndCornersDirty();this._hasGeometry=!0;return this._geometryStateChangedSinceLastUpdate}_createGeometry(O){this.tile.createGeometry();const K=this.geometry.vertexAttributes,L=this.geometry.indices,P=O.gl;this._vao=new B.VertexArrayObject(O,z.vertexAttributeLocations,new Map([["geometry",f.glLayout(K.layout)]]),new Map([["geometry",A.BufferObject.createVertex(O,
P.STATIC_DRAW,K.buffer)]]),A.BufferObject.createIndex(O,P.STATIC_DRAW,L));this._hasGeometry=!0}get vao(){return this._vao}setTextureReference(O,K=q.ActivationTime.Immediate){O?.texture===this._texture?this._textureOpacity=O.opacities[0]:this.releaseTexture();this._textureRef.push(O,K)}get textureReference(){return this._textureRef.current}get nextTextureReference(){return this._textureRef.next}get textureFadeFactor(){return this._textureRef.fadeFactor}get textureIsFading(){return this._textureRef.isFading}_isTextureVisible(O){return this._textureRef.current?.texture===
O||this._textureRef.next?.texture===O&&1>this._textureRef.fadeFactor}get _elevationInfo(){var O=this.geometryState.samplerData;const K=this.tile.layerInfo[w.LayerClass.ELEVATION],L=K.length,P=Array(L);let R=0;var W=0;let V=!1;for(let da=0;da<L;da++){var ba=K[da],U=ba.upsampleInfo?.tile;U?(ba=(ba=U.layerInfo[w.LayerClass.ELEVATION][da].data)&&ba.samplerData,O&&O[R]===ba||(V=!0),P[R++]=ba,W=Math.max(W,U.lij[0])):ba.data&&(U=this.tile.surface.layerViewByIndex(da,w.LayerClass.ELEVATION),y.fallsWithinLayerView(this.tile,
U)&&(W=ba.data,O&&O[R]===W.samplerData||(V=!0),P[R++]=W.samplerData,W=this.tile.level))}null!=O&&O.length!==R&&(V=!0);if(O=0<R)P.length=R;return{changed:V,samplerData:O?P:null,maxTileLevel:W}}get estimatedGeometryMemoryUsage(){return(this.geometry.indices?.byteLength??0)+(this.geometry.vertexAttributes?.byteLength??0)+(this.intersectionData?.estimatedMemoryUsage??0)}get texture(){return this._texture}get test(){}checkGeometryWaterproofness(){if(m.enableTerrainInternalChecks){var O=this.tile;if(O.loaded&&
O.intersectsClippingArea&&0!==O.level){var K=O.surface.extent;if(null==K||O.intersectsExtent(K)){var L=m.neighborEdgeIndices.map((V,ba)=>null!=K?0>(2>ba?-1:1)*(O.extent[3-ba]-K[3-ba]):!1),P=O.level;m.internalAssert(0===this.dirtyCorners);m.internalAssert(0===this.dirtyEdges);m.internalAssert(0===this.dirtyEdgeResolutions);m.internalAssert(!this.numVerticesPerSideChanged);m.internalAssert(!this.samplerDataChanged);m.internalAssert(!this.clippingAreaChanged);m.internalAssert(!this.wireframeChanged);
var R=m.neighborCornerIndices.map(V=>O.findNeighborCornerTileExact(V,ba=>!ba.intersectsClippingArea||ba.loaded||ba.level===O.level)??null).map(V=>V?.intersectsClippingArea?V:null),W=this.geometryState;for(let V=0;4>V;++V){const ba=W.cornerPeerNeighbors[V],U=R[V];m.internalAssert(U===ba,`Tile[${O.lij}].corner[${V}] out of date: cur=[${ba?.lij}] exp=[${U?.lij}]`)}m.neighborEdgeIndices.forEach((V,ba)=>{if(!L[ba]){var U=O.findNeighborTile(V,Ca=>(Ca.level===P||Ca?.loaded)&&Ca?.intersectsClippingArea);
if(U){m.internalAssert(U.loaded||U.level===O.level);m.internalAssert(U===this.geometryState.edgePeerNeighbors[ba]);var da=P-U.level;if(U.loaded){var fa=U.renderData;m.internalAssert(O.isEdgeNeighbor(U,V));m.internalAssert(0<=da);var ha=2**da;if(0>da)m.internalAssert(!1);else{var T=O.renderData,S=T.geometry,Z=T.localOrigin,ia=S.getEdgeCount(ba),Y=S.numVerticesPerSide-1,ea=fa.geometry;if(ea){var ka=fa.localOrigin,ja=this.geometryState.edgePeerNeighbors[ba];ja?.loaded&&(ja=ja.renderData,m.internalAssert(T.geometryState.edgePeerNeighborSamplerVersions[ba]===
ja.geometryState.samplerDataVersion),m.internalAssert(this.geometryState.edgePeerNeighborSamplerVersions[ba]===ja.geometryState.samplerDataVersion));var X=(ba+2)%4,aa=ea.getEdgeCount(X);ja=ia-1;var pa=aa-1;m.internalAssert(ja*ha===pa,`Tile[${O.lij}]:e${ba},res=${ja} edgeRes mismatch with`+` Neighbor[${U.lij}]:e${X},res=${pa} (expected:${ja*ha})`);ja=O.extent;pa=V===x.NeighborIndex.NORTH||V===x.NeighborIndex.SOUTH;var la=aa-1,na=la>>da,qa=ia-1;if(1>na)m.internalAssert(1===qa);else{m.internalAssert(na===
qa);m.internalAssert(k.isPowerOfTwo(na));qa=ea.numVerticesPerSide-1;m.internalAssert(0<da||na===Math.max(qa,Y));da=O.getNeighborEdgeStartVertexIndex(ba,U);m.internalAssert(0<=da&&da<ha);ha=da*na;m.internalAssert(0<=ha&&ha<=la-na);var sa=0,xa=ha;S.getEdgeVertexPosition(ba,F,Z,0);S.getEdgeVertexPosition(ba,G,Z,ia-1);ha=h.distance(F,G);ha=Math.max(1,1E-4*ha);for(da=0;da<=na;++da){S.getEdgeVertexPosition(ba,F,Z,sa);ea.getEdgeVertexPosition(X,G,ka,xa);Y=da/na;var ta=pa?ja[0]+Y*(ja[2]-ja[0]):V===x.NeighborIndex.WEST?
ja[0]:ja[2],Ba=pa?V===x.NeighborIndex.SOUTH?ja[1]:ja[3]:ja[1]+Y*(ja[3]-ja[1]);const Ca=O.surface.extent;if(null==Ca||g.containsXY(Ca,ta,Ba)){Y=h.dist(F,G);la=h.len(F)-d.earth.radius;qa=h.len(G)-d.earth.radius;var Ia=Y<ha;Ia||(console.warn("Tile edge vertex position mismatch: between"+` [${O.lij}].edge${ba}[${sa}/${ia}] and`+` [${U.lij}].edge${X}[${xa}/${aa}]`),null!=Ca&&console.warn("  surface extent\x3d ",Ca," x,y\x3d",ta,",",Ba),ta=e.create(),h.subtract(ta,T.localOrigin,fa.localOrigin),0<h.len(ta)&&
console.warn(`   localOrigins: ${T.localOrigin} vs ${fa.localOrigin}`+` d=${h.len(ta)} [${ta}]`),(()=>{const Ga=e.clone(F),Aa=e.clone(G);O.updateEdgeElevations();U.updateEdgeElevations();S.getEdgeVertexPosition(ba,F,Z,sa);ea.getEdgeVertexPosition(X,G,ka,xa);const Ja=e.create();h.sub(Ja,F,Ga);0<h.len(Ja)&&console.warn(`  XXX Tile[${O.lij}] edge out of date: ${Ga} vs ${F} d=${h.len(Ja)} [${Ja}]`);h.sub(Ja,G,Aa);0<h.len(Ja)&&console.warn(`  XXX Neighbor[${U.lij}] edge out of date: ${Aa} vs ${G} d=${h.len(Ja)} [${Ja}]`)})(),
ta=S.getEdgeCount(ba),Ba=ea.getEdgeCount(aa),m.internalAssert(Ia,"Mismatch in tile"+` [${O.lij}].edge[${ba}][${sa}/${ta}] vs neighbor`+` [${U.lij}].edge[${X}][${xa}/${Ba}]`+` ${m.v32s(F)} vs ${m.v32s(G)}  dist=${Y} h(t|n|d)=${la}|${qa}|${qa-la}`));S.getEdgeNormal(ba,D,sa);ea.getEdgeNormal(X,I,xa);h.normalize(J,D);h.normalize(N,I);const Ha=h.dot(J,N);Y=.01>1-Ha||O===U;if(!Y){const Ga=e.create();h.sub(Ga,D,I);la=()=>`Mismatch in tile edge normal ${m.lij2s(O.lij)} (${sa}/${ia-1}) edge ${ba} vs neighbor ${m.lij2s(U.lij)}  (${xa}/${aa-
1}) nedge ${X} :`+`${m.v32s(D)} vs ${m.v32s(I)}  dot = ${Ha} : ${m.v32s(Ga)}`;console.warn("Mismatch in tile edge normal: ",la());O.updateEdgeElevations();U.updateEdgeElevations();qa=e.create();Ia=e.create();S.getEdgeNormal(ba,qa,sa);ea.getEdgeNormal(X,Ia,xa);h.equals(D,qa)||console.warn("Missing update in tile normal: ",m.v32s(D)," \x3d\x3e ",m.v32s(qa));h.equals(I,Ia)||console.warn("Missing update in neighbor normal: ",m.v32s(I)," \x3d\x3e ",m.v32s(Ia));m.internalAssert(Y,la())}}sa+=1;xa+=1}}}else m.internalAssert(!1)}}else m.internalAssert(!U.leaf),
m.internalAssert(0===da)}else V=!O.surface.updatingRootTiles&&null!=O.surface.rootTiles&&0<O.surface.rootTiles.length&&O.shouldHaveNeighbor(V),m.internalAssert(!V)}})}}else m.internalAssert(O?.loaded)}}}const F=e.create(),G=e.create(),D=e.create(),I=e.create(),J=e.create(),N=e.create(),M=[null,null,null,null],Q=[0,1,2,3];Object.defineProperty(a,"ActivationTime",{enumerable:!0,get:()=>q.ActivationTime});a.PatchRenderData=E;a.neighborTileIfLoadedOrSelf=H;a.zeroToFour=Q;Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/views/3d/terrain/GeometryState":function(){define(["exports"],function(a){class b{constructor(){this.numVerticesPerSide=0;this.samplerData=null;this.samplerDataVersion=0;this.clippingArea=null;this.wireframe=!1;this.cornerPeerNeighbors=[null,null,null,null];this.cornerNeighborCornerTiles=[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null];this.cornerNeighborCornerTileSamplerVersions=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1];this.edgeResolutions=
[-1,-1,-1,-1];this.edgePeerNeighbors=[null,null,null,null];this.edgePeerNeighborSamplerVersions=[-1,-1,-1,-1]}}a.GeometryState=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/TextureFader":function(){define(["exports","../../../core/maybe","./interfaces"],function(a,b,n){class k{constructor(p){this._getFadeDuration=p;this._delayedTime=this._fadeStart=0}clear(){this._current=b.destroyMaybe(this._current);this._next=b.destroyMaybe(this._next);this._waiting=b.destroyMaybe(this._waiting);
this._delayed=b.destroyMaybe(this._delayed)}get current(){if(null==this._current)return null;if(!this._isFadingEnabled){var p=this._delayed||this._waiting||this._next||this._current;p!==this._current&&(this._current=null,this.clear(),this._current=p)}p=k.test.fadeMoment;null!=this._delayed&&(p=p||performance.now(),p>=this._delayedTime&&(this._push(this._delayed,a.ActivationTime.Immediate),this._delayed=null));if(null!=this._next){p=p||performance.now();const h=this._next.type!==n.TextureUpdate.FADING,
e=p-this._fadeStart>=this._fadeDuration;if(null!=this._current&&this._next.texture===this._current.texture||h||e)b.destroyMaybe(this._current),this._current=this._next,this._next=this._waiting,this._waiting=null,this._fadeStart=this._alignFadeStart(p)}return this._current}get next(){return this._next}get fadeFactor(){if(null==this._next)return 1;var p=k.test.fadeMoment||performance.now();p=Math.max(0,p-this._fadeStart);const h=this._fadeDuration;return p>h?0:1-p/h}get isFading(){return null!=this._next||
null!=this._delayed}push(p,h=a.ActivationTime.Immediate){this._delayed=b.destroyMaybe(this._delayed);this._push(p,h)}_push(p,h){this._isFadingEnabled||this.clear();if(null==this._current)this._current=p;else{var e=k.test.fadeMoment||performance.now();h!==a.ActivationTime.Immediate?(this._delayed=p,this._delayedTime=e+h):null==this._next?(this._next=p,this._fadeStart=this._alignFadeStart(e)):null!=p&&(b.destroyMaybe(this._waiting),this._waiting=p)}}get _fadeDuration(){const p=this._getFadeDuration();
return this._waiting?.5*p:p}_alignFadeStart(p){const h=this._getFadeDuration();return p+h-p%h}get _isFadingEnabled(){return 0<this._getFadeDuration()}}k.test={fadeMoment:0};a.ActivationTime=void 0;(function(p){p[p.Immediate=0]="Immediate";p[p.Delayed=5E3]="Delayed"})(a.ActivationTime||(a.ActivationTime={}));a.TextureFader=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/TextureReference":function(){define(["exports","../../../core/libs/gl-matrix-2/factories/vec3f64"],
function(a,b){class n{constructor(k,p,h,e,g,d){this.texture=k;this.type=p;this.offsetAndScale=h;k.retain();this.opacities=b.fromValues(e,g,d)}destroy(){this.texture.release()}}a.TextureReference=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/TileOverlayData":function(){define(["../../../core/libs/gl-matrix-2/factories/vec4f64"],function(a){class b{constructor(){this._scales=a.fromValues(-1,-1,-1,-1);this._offsets=a.fromValues(-1,-1,-1,-1)}clear(){this._scales[0]=
this._scales[1]=this._scales[2]=this._scales[3]=-1;this._offsets[0]=this._offsets[1]=this._offsets[2]=this._offsets[3]=-1}setScale(n,k,p){this._scales[2*n]=k;this._scales[2*n+1]=p}setOffset(n,k,p){this._offsets[2*n]=k;this._offsets[2*n+1]=p}get scales(){return this._scales}get offsets(){return this._offsets}}return b})},"esri/views/3d/terrain/tileUtils":function(){define(["exports","../../../core/PooledArray","./RenderOrder","./terrainUtils"],function(a,b,n,k){function p(u,t){t(u);if(!u.leaf)for(const m of u.children)p(m,
t)}function h(u,t){u=u.lij;t=t.lij;return u[0]-t[0]||u[1]-t[1]||u[2]-t[2]}function e(u,t){const m=t.screenDepth-u.screenDepth;if(0!==m)return m;u=u.lij;t=t.lij;return u[0]-t[0]||u[1]-t[1]||u[2]-t[2]}function g(u,t){const m=u.screenDepth-t.screenDepth;if(0!==m)return m;u=u.lij;t=t.lij;return u[0]-t[0]||u[1]-t[1]||u[2]-t[2]}function d(u,t,m){const q=u.screenDepth,r=t.screenDepth;return q<r?-m:q>r?m:h(u,t)}function f(u,t,m,q){const r=c(u,q);q=c(t,q);return r===q?d(u,t,m):u?m:-m}function c(u,t){for(const m of t)if(u.intersectsExtent(m))return!0;
return!1}function l(u,t){const m=u.distanceToPOI-t.distanceToPOI;if(0!==m)return m;u=u.lij;t=t.lij;return u[0]-t[0]||u[1]-t[1]||u[2]-t[2]}class w{constructor(){this._queue=new b;this.remove=()=>{}}get done(){return 0===this._queue.length&&(!this._last||this._last.leaf)}resetOne(u){this._queue.clear();this._queue.push(u);this._last=void 0}reset(u=null){this._queue.clear();null!=u&&this._queue.pushArray(u);this._last=void 0}skipSubtree(){this._last=void 0}next(){const u=this._last?.children;u?.[0]&&
this._queue.pushArray(u);return this._last=this._queue.pop()}}class x{constructor(){this._q=new b}get done(){return 0===this._q.length}reset(u){this._q.clear();if(null!=u)for(this._q.pushArray(u),u=0;u<this._q.length;++u){const t=this._q.data[u];t.leaf||this._q.pushArray(t.children)}}next(){return this._q.pop()}}a.IteratorPostorder=x;a.IteratorPreorder=w;a.compareTiles=d;a.compareTilesByLij=h;a.compareTilesWithStencil=f;a.computeUpsampleInfo=function(u,t,m){let q=1,r=0,v=0;for(;u!==t;)if(q*=.5,r*=
.5,v*=.5,u.lij[2]&1&&(r+=.5),0===(u.lij[1]&1)&&(v+=.5),u=u.parent,null==u)throw Error("tile was not a descendant of upsampleTile");m.init(t,r,v,q)};a.fallsWithinLayerView=function(u,t){if(null==t)return!1;t=k.isImageryTileLayerView(t)?{fullExtent:t.fullExtent,minScale:t.layer.minScale,maxScale:t.layer.maxScale}:t.layer;if(null==t?.fullExtent)return!1;var m=t.fullExtent;const q=u.extent;if(m.xmin>q[2]||m.ymin>q[3]||m.xmax<q[0]||m.ymax<q[1])return!1;u=u.surface.tilingScheme.levels[u.level].scale;m=
t.minScale;if(0<m&&u>1.00000001*m)return!1;t=t.maxScale;return 0<t&&u<.99999999*t?!1:!0};a.getTileMapCache=function(u){return!k.isImageryTileLayerView(u)&&u.layer&&"tilemapCache"in u.layer?u.layer.tilemapCache:null};a.hasLoadableSiblings=function(u){for(let t=0;t<u.length;t++){const m=u[t],q=m.parent;if(q)for(let r=0;4>r;r++){const v=q.children[r];if(v&&v!==m)return!0}}return!1};a.sortTiles=function(u,t,m=null){null==m||0===m.length?u===n.RenderOrder.BACK_TO_FRONT?t.sort(e):t.sort(g):t.sort((q,r)=>
f(q,r,u,m))};a.sortTilesByPOI=function(u,t){const m=u.length;for(let q=0;q<m;++q)u.at(q).updateDistanceToPOI(t);u.sort(l)};a.tilesAreRelated=function(u,t){if(!u||!t||u[0]===t[0])return!1;const m=u[0]<t[0],q=m?u:t;u=m?t:u;t=1<<u[0]-q[0];return Math.floor(u[1]/t)===q[1]&&Math.floor(u[2]/t)===q[2]};a.traverseTilesPreorder=function(u,t){if(Array.isArray(u))for(let m=0;m<u.length;m++)p(u[m],t);else p(u,t)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/RenderOrder":function(){define(["exports"],
function(a){a.RenderOrder=void 0;var b=a.RenderOrder||(a.RenderOrder={});b[b.BACK_TO_FRONT=-1]="BACK_TO_FRONT";b[b.NONE=0]="NONE";b[b.FRONT_TO_BACK=1]="FRONT_TO_BACK";Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/TerrainTechnique":function(){define("require exports ../core/shaderLibrary/ShaderOutput ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../lib/basicInterfaces ../lib/StencilUtils ../lib/VertexAttribute ../../../../chunks/Terrain.glsl ../../../webgl/enums ../../../webgl/renderState".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c){class l extends p.ShaderTechnique{constructor(x,u,t){super(x,u,new k.ReloadableShaderModule(d.Terrain,()=>new Promise((m,q)=>a(["./Terrain.glsl"],m,q))),t,w);this.type="TerrainTechnique";this.useStencil=!1}initializePipeline(x){this._stencilPipelineState=this._createPipeline(x,!0);return this._createPipeline(x,!1)}_createPipeline(x,u){const {renderOccluded:t,output:m}=x;return c.makePipelineState({blending:t?c.blendWithPremultipliedAlpha:null,culling:x.backfaceCullingEnabled&&
!t?c.backFaceCullingParams:null,depthTest:t?null:{func:f.CompareFunction.LESS},depthWrite:t?null:c.defaultDepthWrite,colorWrite:c.defaultColorWrite,stencilTest:u?e.renderWhenBitIsNotSet(h.StencilBits.IntegratedMeshMaskExcluded):null,drawBuffers:m===n.ShaderOutput.Depth?{buffers:[f.SpecialDrawBuffers.NONE]}:null})}getPipeline(){return this.useStencil?this._stencilPipelineState:super.getPipeline()}}const w=new Map([[g.VertexAttribute.POSITION,0],[g.VertexAttribute.UV0,1],[g.VertexAttribute.NORMALCOMPRESSED,
2]]);b.TerrainTechnique=l;b.vertexAttributeLocations=w;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/Terrain.glsl":function(){define("exports ../core/libs/gl-matrix-2/math/mat4 ../core/libs/gl-matrix-2/factories/mat4f64 ./vec32 ../core/libs/gl-matrix-2/factories/vec3f64 ../views/3d/terrain/OverlayContent ../views/3d/terrain/TransparencyMode ../views/3d/webgl-engine/core/shaderLibrary/ForwardLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/ShaderOutput ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/Transform.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/NormalAttribute.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/PositionAttribute.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VertexTangent.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateAmbientOcclusion.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateSceneLighting.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MainLighting.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/NormalUtils.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ReadShadowMap.glsl ../views/3d/webgl-engine/core/shaderLibrary/terrain/Overlay.glsl ../views/3d/webgl-engine/core/shaderLibrary/terrain/TerrainTexture.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaCutoff ../views/3d/webgl-engine/core/shaderLibrary/util/View.glsl ../views/3d/webgl-engine/core/shaderModules/Float3PassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/Matrix4DrawUniform ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w,x,u,t,m,q,r,v,y,B,z,A,C,H,E,F,G,D,I,J){function N(K){const L=new I.ShaderBuilder,{vertex:P,fragment:R,varyings:W}=L,{output:V,pbrMode:ba,overlayMode:U,tileBorders:da,spherical:fa,transparencyMode:ha,screenSizePerspective:T}=K;L.include(w.PositionAttribute);L.include(l.NormalAttribute,K);L.include(x.TextureCoordinateAttribute,K);var S=()=>{L.include(y.NormalUtils,K);P.code.add(G.glsl`vec3 getNormal() {
float z = 1.0 - abs(normalCompressed.x) - abs(normalCompressed.y);
vec3 n = vec3(normalCompressed + vec2(normalCompressed.x >= 0.0 ? 1.0 : -1.0,
normalCompressed.y >= 0.0 ? 1.0 : -1.0) * min(z, 0.0), z);
return normalize(n);
}`)};E.addProjViewLocalOrigin(P,K);L.include(c.Transform,K);const Z=ha===e.TransparencyMode.InvisibleWithDraped||ha===e.TransparencyMode.Invisible,ia=U!==A.OverlayMode.Disabled;var Y=ia&&Z;switch(V){case d.ShaderOutput.ColorEmission:case d.ShaderOutput.Color:L.include(C.TerrainTexture,K);L.include(r.EvaluateSceneLighting,K);ia&&(K.pbrMode=ba===B.PBRMode.Simplified?B.PBRMode.TerrainWithWater:B.PBRMode.Water,L.include(A.OverlayTerrain,K),K.pbrMode=ba);(Y=U===A.OverlayMode.EnabledWithWater)&&L.include(u.VertexTangent,
K);W.add("vnormal","vec3");W.add("vpos","vec3");W.add("vup","vec3");S();T&&E.addViewNormal(P);(S=K.receiveShadows&&!K.renderOccluded)&&L.include(g.ForwardLinearDepth,K);T&&(W.add("screenSizeDistanceToCamera","float"),W.add("screenSizeCosAngle","float"));P.main.add(G.glsl`
          vpos = position;
          vec3 positionWorld = position + localOrigin;
          gl_Position = transformPosition(proj, view, vpos);
          vnormal = getNormal();
          vup = getLocalUp(position, localOrigin);
          ${G.If(Y,G.glsl`forwardVertexTangent(vnormal);`)}

          vec2 uv = getUV0();
          forwardTextureCoordinatesWithTransform(uv);
          ${G.If(ia,"setOverlayVTC(uv);")}
          ${G.If(da,"forwardTextureCoordinates();")}
          ${G.If(T,G.glsl`vec3 viewPos = (view * vec4(vpos, 1.0)).xyz;
                 screenSizeDistanceToCamera = length(viewPos);
                 vec3 viewSpaceNormal = (viewNormal * vec4(normalize(positionWorld), 1.0)).xyz;
                 screenSizeCosAngle = abs(viewSpaceNormal.z);`)}
          ${G.If(S,"forwardLinearDepth();")}`);L.include(f.SliceDraw,K);L.include(r.EvaluateSceneLighting,K);L.include(q.EvaluateAmbientOcclusion,K);L.include(z.ReadShadowMapDraw,K);E.addCameraPosition(R,K);r.addAmbientBoostFactor(R);r.addLightingGlobalFactor(R);R.uniforms.add(P.uniforms.get("localOrigin"),new F.Float3PassUniform("viewDirection",(ea,ka)=>k.normalize(O,k.set(O,ka.camera.viewMatrix[12],ka.camera.viewMatrix[13],ka.camera.viewMatrix[14]))));Y&&R.uniforms.add(new J.Texture2DPassUniform("ovWaterTex",
(ea,ka)=>ka.overlay?.getTexture(h.OverlayContent.WaterNormal)),new D.Matrix4DrawUniform("view",(ea,ka)=>b.translate(Q,ka.camera.viewMatrix,ea.origin)));R.code.add(G.glsl`float lum(vec3 c) {
return (min(min(c.r, c.g), c.b) + max(max(c.r, c.g), c.b)) * 0.5;
}`);v.addMainLightDirection(R);v.addMainLightIntensity(R);R.main.add(G.glsl`
          vec3 normal = normalize(vnormal);
          float vndl = dot(normal, mainLightDirection);

          float additionalAmbientScale = smoothstep(0.0, 1.0, clamp(vndl*2.5, 0.0, 1.0));
          float shadow = ${S?"max(lightingGlobalFactor * (1.0 - additionalAmbientScale), readShadowMap(vpos, linearDepth))":fa?"lightingGlobalFactor * (1.0 - additionalAmbientScale)":"0.0"};

          float ssao = evaluateAmbientOcclusionInverse();
          vec4 tileColor = getTileColor();

          ${G.If(ia,G.glsl`vec4 overlayColorOpaque = getOverlayColor(ovColorTex, vtcOverlay);
                   vec4 overlayColor = overlayOpacity * overlayColorOpaque;
                   ${G.If(Z,`if (overlayColor.a < ${G.glsl.float(H.alphaCutoff)}) { discard; }`)}
                   vec4 groundColor = tileColor;
                   tileColor = tileColor * (1.0 - overlayColor.a) + overlayColor;`)}

          // If combined alpha is 0 we can discard pixel. The performance impact by having a discard here
          // is neglectable because terrain typically renders first into the framebuffer.
          if(tileColor.a < ${G.glsl.float(H.alphaCutoff)}) {
            discard;
          }

          bool sliced = rejectBySlice(vpos);
          if (sliced) {
            tileColor *= ${G.glsl.float(.2)};
          }

          vec3 albedo = tileColor.rgb;

          // heuristic shading function used in the old terrain, now used to add ambient lighting

          vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;

          ${ba===B.PBRMode.Simplified||ba===B.PBRMode.TerrainWithWater?G.glsl`fragColor = vec4(evaluatePBRSimplifiedLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight, normalize(vpos - cameraPosition), vup), tileColor.a);`:G.glsl`fragColor = vec4(evaluateSceneLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight), tileColor.a);`}
          ${G.If(Y,G.glsl`vec4 overlayWaterMask = getOverlayColor(ovWaterTex, vtcOverlay);
                   float waterNormalLength = length(overlayWaterMask);
                   if (waterNormalLength > 0.95) {
                     mat3 tbnMatrix = mat3(tbnTangent, tbnBiTangent, vnormal);
                     vec4 waterOverlayColor = vec4(overlayColor.w > 0.0 ? overlayColorOpaque.xyz/overlayColor.w : vec3(1.0), overlayColor.w);
                     vec4 viewPosition = view*vec4(vpos, 1.0);
                     vec4 waterColorLinear = getOverlayWaterColor(overlayWaterMask, waterOverlayColor, -normalize(vpos - cameraPosition), shadow, vnormal, tbnMatrix, viewPosition.xyz,  vpos + localOrigin);
                     vec4 waterColorNonLinear = delinearizeGamma(vec4(waterColorLinear.xyz, 1.0));
                     float opacity = sliced ? ${G.glsl.float(.2)} : 1.0;
                     // un-gamma the ground color to mix in linear space
                     fragColor = mix(groundColor, waterColorNonLinear, waterColorLinear.w) * opacity;
                   }`)}
          ${G.If(T,G.glsl`float perspectiveScale = screenSizePerspectiveScaleFloat(1.0, screenSizeCosAngle, screenSizeDistanceToCamera, vec4(0.0));
                   if (perspectiveScale <= 0.25) {
                     fragColor = mix(fragColor, vec4(1.0, 0.0, 0.0, 1.0), perspectiveScale * 4.0);
                   } else if (perspectiveScale <= 0.5) {
                     fragColor = mix(fragColor, vec4(0.0, 0.0, 1.0, 1.0), (perspectiveScale - 0.25) * 4.0);
                   } else if (perspectiveScale >= 0.99) {
                     fragColor = mix(fragColor, vec4(0.0, 1.0, 0.0, 1.0), 0.2);
                   } else {
                     fragColor = mix(fragColor, vec4(1.0, 0.0, 1.0, 1.0), (perspectiveScale - 0.5) * 2.0);
                   }`)}
          ${G.If(K.visualizeNormals,fa?G.glsl`
                  vec3 localUp = normalize(vpos + localOrigin);
                  vec3 right = normalize(cross(vec3(0.0, 0.0, 1.0), localUp));
                  vec3 forward = normalize(cross(localUp, right));
                  mat3 tbn = mat3(right, forward, localUp);
                  vec3 tNormal = normalize(normal * tbn);
                  fragColor = vec4(vec3(0.5) + 0.5 * tNormal, 0.0);`:G.glsl`
                  vec3 tNormal = normalize(normal);
                  fragColor = vec4(vec3(0.5) + 0.5 * tNormal, 0.0);`)}
          ${G.If(da,G.glsl`vec2 dVuv = fwidth(vuv0);
                 vec2 edgeFactors = smoothstep(vec2(0.0), 1.5 * dVuv, min(vuv0, 1.0 - vuv0));
                 float edgeFactor = 1.0 - min(edgeFactors.x, edgeFactors.y);
                 fragColor = mix(fragColor, vec4(1.0, 0.0, 0.0, 1.0), edgeFactor);`)}
          fragColor = highlightSlice(fragColor, vpos);`);break;case d.ShaderOutput.Depth:Y&&L.include(A.OverlayTerrain,K);P.main.add(G.glsl`
        ${G.If(Y,"setOverlayVTC(getUV0());")}
        gl_Position = transformPosition(proj, view, position);`);R.main.add(`${G.If(Y,`if (getCombinedOverlayColor().a < ${G.glsl.float(H.alphaCutoff)}) discard;`)}`);break;case d.ShaderOutput.Shadow:case d.ShaderOutput.ShadowHighlight:case d.ShaderOutput.ShadowExcludeHighlight:case d.ShaderOutput.ViewshedShadow:L.include(t.OutputDepth,K);g.addLinearDepth(L);g.addNearFar(L);P.main.add(G.glsl`gl_Position = transformPositionWithDepth(proj, view, position, nearFar, linearDepth);`);R.main.add(G.glsl`outputDepth(linearDepth);`);
break;case d.ShaderOutput.Normal:Y&&L.include(A.OverlayTerrain,K);W.add("vnormal","vec3");E.addViewNormal(P);S();P.main.add(G.glsl`
        ${G.If(Y,"setOverlayVTC(getUV0());")}
        gl_Position = transformPosition(proj, view, position);
        vnormal = normalize((viewNormal * vec4(getNormal(), 1.0)).xyz);`);R.main.add(G.glsl`
        ${G.If(Y,`if (getCombinedOverlayColor().a < ${G.glsl.float(H.alphaCutoff)}) discard;`)}
        vec3 normal = normalize(vnormal);
        if (gl_FrontFacing == false) {
          normal = -normal;
        }
        fragColor = vec4(vec3(0.5) + 0.5 * normal, 1.0);`);break;case d.ShaderOutput.Highlight:ia&&L.include(A.OverlayTerrain,K),P.main.add(G.glsl`
        ${G.If(ia,"setOverlayVTC(getUV0());")}
        gl_Position = transformPosition(proj, view, position);`),L.include(m.OutputHighlight,K),R.main.add(G.glsl`
        ${G.If(ia,G.glsl`
           vec2 overlayHighlightTexel = getAllOverlayHighlightValuesEncoded();
           outputAllHighlights(overlayHighlightTexel);`,"calculateOcclusionAndOutputHighlight();")}
      `)}V===d.ShaderOutput.ObjectAndLayerIdColor&&(ia?(K.pbrMode=B.PBRMode.Disabled,L.include(A.OverlayTerrain,K),K.pbrMode=ba,P.main.add(G.glsl`gl_Position = transformPosition(proj, view, position);
setOverlayVTC(getUV0());`),R.main.add(G.glsl`fragColor = getOverlayColorTexel(vtcOverlay);`)):(P.main.add(G.glsl`${G.If(ha===e.TransparencyMode.Opaque,"gl_Position \x3d transformPosition(proj, view, position);")}`),R.main.add(G.glsl`fragColor = vec4(0.0);`)));return L}class M extends C.OverlayTerrainPassParameters{}const Q=n.create(),O=p.create();n=Object.freeze(Object.defineProperty({__proto__:null,TerrainPassParameters:M,build:N},Symbol.toStringTag,{value:"Module"}));a.Terrain=n;a.TerrainPassParameters=
M;a.build=N})},"esri/views/3d/terrain/TransparencyMode":function(){define(["exports"],function(a){a.TransparencyMode=void 0;var b=a.TransparencyMode||(a.TransparencyMode={});b[b.Opaque=0]="Opaque";b[b.Transparent=1]="Transparent";b[b.InvisibleWithDraped=2]="InvisibleWithDraped";b[b.Invisible=3]="Invisible";b[b.COUNT=4]="COUNT";Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/VertexTangent.glsl":function(){define(["exports","../../shaderModules/interfaces"],
function(a,b){a.VertexTangent=function(n,k){n.varyings.add("tbnTangent","vec3");n.varyings.add("tbnBiTangent","vec3");k.spherical?n.vertex.code.add(b.glsl`void forwardVertexTangent(vec3 n) {
tbnTangent = normalize(cross(vec3(0.0, 0.0, 1.0), n));
tbnBiTangent = normalize(cross(n, tbnTangent));
}`):n.vertex.code.add(b.glsl`void forwardVertexTangent(vec3 n) {
tbnTangent = vec3(1.0, 0.0, 0.0);
tbnBiTangent = normalize(cross(n, tbnTangent));
}`);n.fragment.code.add(b.glsl`mat3 getTBNMatrix(vec3 n) {
return mat3(tbnTangent, tbnBiTangent, n);
}`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/NormalUtils.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,b){a.NormalUtils=function(n,k){k.spherical?n.vertex.code.add(b.glsl`vec3 getLocalUp(in vec3 pos, in vec3 origin) {
return normalize(pos + origin);
}`):n.vertex.code.add(b.glsl`vec3 getLocalUp(in vec3 pos, in vec3 origin) {
return vec3(0.0, 0.0, 1.0);
}`);k.spherical?n.vertex.code.add(b.glsl`mat3 getTBNMatrix(in vec3 n) {
vec3 t = normalize(cross(vec3(0.0, 0.0, 1.0), n));
vec3 b = normalize(cross(n, t));
return mat3(t, b, n);
}`):n.vertex.code.add(b.glsl`mat3 getTBNMatrix(in vec3 n) {
vec3 t = vec3(1.0, 0.0, 0.0);
vec3 b = normalize(cross(n, t));
return mat3(t, b, n);
}`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/terrain/TerrainTexture.glsl":function(){define("exports ../shading/ReadShadowMap.glsl ./BackgroundGrid.glsl ./TileBlendInput ../../shaderModules/interfaces ../../shaderModules/Uniform".split(" "),function(a,b,n,k,p,h){class e extends b.ReadShadowMapPassParameters{constructor(){super(...arguments);this.overlayOpacity=1}}class g extends h.Uniform{constructor(l){super(l,"float")}}class d extends h.Uniform{constructor(l){super(l,
"vec3")}}class f extends h.Uniform{constructor(l){super(l,"vec4")}}class c extends h.Uniform{constructor(l){super(l,"sampler2D")}}a.Float3Uniform=d;a.OverlayTerrainPassParameters=e;a.TerrainTexture=function(l,w){const {vertex:x,fragment:u,varyings:t}=l;t.add("vtc","vec2");x.uniforms.add(new f("texOffsetAndScale"));u.uniforms.add(new c("tex"));u.uniforms.add(new d("textureOpacities"));if(l=w.textureFadingEnabled&&!w.renderOccluded)x.uniforms.add(new f("nextTexOffsetAndScale")),t.add("nvtc","vec2"),
u.uniforms.add(new c("texNext")),u.uniforms.add(new d("nextTexOpacities")),u.uniforms.add(new g("fadeFactor"));const m=w.tileBlendInput===k.TileBlendInput.ColorComposite;(w=w.tileBlendInput===k.TileBlendInput.GridComposite)&&u.include(n.BackgroundGrid);m&&u.uniforms.add(new d("backgroundColor"));x.code.add(p.glsl`
  void forwardTextureCoordinatesWithTransform(in vec2 uv) {
    vtc = uv * texOffsetAndScale.zw + texOffsetAndScale.xy;
    ${l?p.glsl`nvtc = uv * nextTexOffsetAndScale.zw + nextTexOffsetAndScale.xy;`:p.glsl``}
  }`);u.code.add(p.glsl`
    vec4 getColor(vec4 color, vec2 uv, vec3 opacities) {
      ${w||m?p.glsl`
              if (opacities.y <= 0.0) {
                return color * opacities.z * opacities.x;
              }
              vec4 bg = vec4(${m?p.glsl`backgroundColor`:p.glsl`gridColor(uv)`} * opacities.y, opacities.y);
              vec4 layer = color * opacities.z;
              return (bg * (1.0 - layer.a) + layer) * opacities.x;`:p.glsl`return color;`}
    }`);l?u.code.add(p.glsl`vec4 getTileColor() {
vec4 color = getColor(texture(tex, vtc), vtc, textureOpacities);
if (fadeFactor >= 1.0) {
return color;
}
vec4 nextColor = getColor(texture(texNext, nvtc), nvtc, nextTexOpacities);
return mix(nextColor, color, fadeFactor);
}`):u.code.add(p.glsl`vec4 getTileColor() {
return getColor(texture(tex, vtc), vtc, textureOpacities);
}`)};a.Texture2DUniform=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/terrain/BackgroundGrid.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,b){a.BackgroundGrid=function(n){n.code.add(b.glsl`
    float lineFactorAtPosition(float value) {
      float pos = value * ${b.glsl.float(257)};
      if(pos < 0.5 || pos > ${b.glsl.float(256.5)}) {
        return 1.0;
      }

      pos = pos + 0.5;
      float modulo = mod(pos, 16.0);
      return modulo <= 2.0 ?  1.0 - abs(modulo - 1.0) : 0.0;
    }

    float lineFactorAtUV(vec2 uv) {
      return max(lineFactorAtPosition(uv.x), lineFactorAtPosition(uv.y));
    }

    float lineFactor(vec2 uv) {
      vec2 offset = fwidth(uv) * 0.25;
      return (lineFactorAtUV(vec2(uv.x + offset.x, uv.y + offset.y)) +
              lineFactorAtUV(vec2(uv.x - offset.x, uv.y + offset.y)) +
              lineFactorAtUV(vec2(uv.x + offset.x, uv.y - offset.y)) +
              lineFactorAtUV(vec2(uv.x - offset.x, uv.y - offset.y))) / 4.0;
    }

    vec3 gridColor(vec2 uv) {
      float line = lineFactor(uv) * 0.1 + 0.9;
      return vec3(1.0, 0.972, 0.918) * line;
    }`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/terrain/TileBlendInput":function(){define(["exports"],function(a){a.TileBlendInput=void 0;var b=a.TileBlendInput||(a.TileBlendInput={});b[b.LayerOnly=0]="LayerOnly";b[b.ColorComposite=1]="ColorComposite";b[b.GridComposite=2]="GridComposite";b[b.COUNT=3]="COUNT";Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/Tile":function(){define("exports ../../../core/mathUtils ../../../core/maybe ../../../core/ObjectPool ../../../chunks/vec32 ../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../geometry/ellipsoidUtils ../../../geometry/support/aaBoundingRect ../../../chunks/sphere ../../../layers/support/layerUtils ./ElevationBounds ./ElevationTileAgent ./interfaces ./LayerClass ./MapTileAgent ./NeighborIndex ./TerrainConst ./TerrainData ./terrainUtils ./TileAgent ./TileFrustumVisibility ./TilePerLayerInfo ./TileUpdate ./tileUtils".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w,x,u,t,m,q,r,v,y,B,z,A){function C(K){K.dispose();l.isElevationTileAgent(K)?I.release(K):u.isMapTileAgent(K)&&D.release(K)}function H(K,L){return K[0]===L[0]&&K[1]===L[1]&&K[2]===L[2]}function E(K,L,P){return null==K||null==L||L===K?!1:K.level>=L.level?F(K,L,P):F(L,K,r.oppositeCorner(P))}function F(K,L,P){r.internalAssert(K.level>=L.level);var R=r.isWestCorner(P),W=r.isNorthCorner(P),V=K.extent;P=L.extent;var ba=[R?V[0]:V[2],W?V[3]:V[1]];const U=[R?P[2]:P[0],W?P[1]:
P[3]];R=1E-5*(V[2]-V[0]);W=r.almostEquals(ba[0],U[0],R)||K.surface.isGlobal&&r.almostEquals(ba[0],-U[0],R);ba=r.almostEquals(ba[1],U[1],R);if(W&&ba)return!0;if(K.level===L.level||!W&&!ba)return r.internalAssert(!1),!1;W?(K=V[1],V=V[3],P=P[1]-R<=K&&K<=V&&V<=P[3]+R):(K=V[0],V=V[2],P=P[0]-R<=K&&K<=V&&V<=P[2]+R);r.internalAssert(P);return P}class G{constructor(){this._lij=[0,0,0];this._children=[null,null,null,null];this._pendingUpdates=0;this.renderData=null;this._dirty=!0;this._previouslyRendered=!1;
this.extent=g.create();this._elevationBoundsMin=NaN;this._elevationBoundsMax=0;this.layerInfo=[[],[]];this.extentInRadians=g.create();this.centerAtSeaLevel=h.create();this._center=[h.create(),d.create(),h.create()];this.up=h.unitZ();this._intersectsClippingArea=this._withinClippingArea=!0;this.extentMidY=this.extentMidX=this._curvatureHeight=this._edgeLen2=this._edgeLen=this.renderOrder=this.screenDepth=this._mapDataRefCount=this._vectorTileMemory=this._rasterTileMemory=this._usedMemory=this._maxTesselation=
0;this.distanceToPOI=-1;this._lastPOI=h.create();this.unmergableChildCount=this.maxLevelDeltaNeighborCount=0}get lij(){return this._lij}get elevationLevelDelta(){return this._surface.getElevationLevelDelta(this.level)}static prune(){D.prune(0);I.prune(0);B.TilePerLayerInfo.prune()}get _cached(){return!this.leaf&&0>=this._mapDataRefCount}get withinClippingArea(){return this._withinClippingArea}get intersectsClippingArea(){return this._intersectsClippingArea}get clippingArea(){return this._clippingArea}get parent(){return this._parent}get children(){return this._children}get surface(){return this._surface}get elevationBoundsMin(){return this._elevationBoundsMin}get elevationBoundsMax(){return this._elevationBoundsMax}get level(){return this._lij[0]}get key(){return`${this._lij[0]}/${this._lij[1]}/${this._lij[2]}`}get edgeLen(){return this._edgeLen}get radius(){return this._center[a.CenterPosition.MIDDLE][3]}get visible(){this._dirty&&
this.computeVisibility();return this._visible}get frustumVisibility(){this._dirty&&this.computeVisibility();return this._frustumVisibility}computeVisibility(){this._dirty=!1;var K=this.parent?.frustumVisibility??y.TileFrustumVisibility.INTERSECTS;this._frustumVisibility=K===y.TileFrustumVisibility.INSIDE?y.TileFrustumVisibility.INSIDE:K===y.TileFrustumVisibility.OUTSIDE?y.TileFrustumVisibility.OUTSIDE:this._calculateFrustumVisibilityStatus(this.surface.frustum);K=this._frustumVisibility!==y.TileFrustumVisibility.OUTSIDE&&
this._intersectsClippingArea;K!==this._visible&&(this._visible=K,this._surface.emit("tiles-visibility-changed"),this._surface.renderer.setDirty(),this.updateAgentSuspension())}get loadable(){return this.visible||this._surface.view.state.fixedContentCamera}get rendered(){const K=!!this.renderData;K!==this._previouslyRendered&&(this._surface.emit("tiles-visibility-changed"),this._previouslyRendered=K,this._surface.renderer.setDirty());return K}init(K,L,P,R,W){this._lij[0]=K;this._lij[1]=L;this._lij[2]=
P;this.ellipsoid=e.getReferenceEllipsoid(W.tilingScheme.spatialReference);W.tilingScheme.getExtent(K,L,P,this.extent);W.tilingScheme.convertExtentToRadians(this.extent,this.extentInRadians);this.extentMidX=.5*(this.extent[0]+this.extent[2]);this.extentMidY=.5*(this.extent[1]+this.extent[3]);this._intersectsClippingArea=this._withinClippingArea=!0;this._clippingArea=null;this._mapDataRefCount=0;W.upsampleMapCache.pop(this.key);this._edgeLen2=this._edgeLen=0;this._center[a.CenterPosition.MIDDLE][3]=
0;this.elevationLevel=K;R&&!Number.isNaN(R.elevationBoundsMin)?(this._elevationBoundsMin=R.elevationBoundsMin,this._elevationBoundsMax=R.elevationBoundsMax):this._elevationBoundsMax=this._elevationBoundsMin=0;this._pendingUpdates=0;this.renderData=null;this.screenDepth=0;this._previouslyRendered=this._visible=!1;this._parent=R;this.clearChildren();this._surface=W;this.updateVisibility();this.unmergableChildCount=this.maxLevelDeltaNeighborCount=0;for(const V of x.LayerClasses){K=W.numLayers(V);L=this.layerInfo[V];
for(const ba of L)ba.release();L.length=K;for(P=0;P<K;P++)L[P]=B.TilePerLayerInfo.acquire(this._surface.upsampleInfoPool),V===x.LayerClass.ELEVATION&&this.findElevationBoundsForLayer(P,-1)}this.computeElevationBounds();this._maxTesselation=Math.min(W.tilingScheme.pixelSize,m.maxPatchTesselation)}dispose(){r.weakAssert(!this.renderData,"tile.renderData was not unloaded");this._surface.upsampleMapCache.pop(this.key);this.layerInfo.forEach(K=>{K.forEach(L=>L.release());K.length=0});this._parent=null;
this.clearChildren();this.setMemoryDirty()}refMapData(){++this._mapDataRefCount;this._cached||this._surface.upsampleMapCache.pop(this.key)}unrefMapData(){--this._mapDataRefCount;if(this._cached){const K=this._cachedMemory;0<K&&this._surface.upsampleMapCache.put(this.key,this,K)}}setMemoryDirty(){this._usedMemory=0}get usedMemory(){return this._ensureUsedMemory()+(this._cached?0:this._mapTileMemory)}get _cachedMemory(){this._ensureUsedMemory();return this._cached?this._mapTileMemory:0}get _mapTileMemory(){return this._rasterTileMemory+
this._vectorTileMemory}get _cpuImageMemorySize(){const K=this._surface.tilingScheme.pixelSize;return K*K*4}_ensureUsedMemory(){if(0<this._usedMemory)return this._vectorTileMemory=this.layerInfo[x.LayerClass.MAP].reduce((L,{data:P})=>L+(q.isVectorTile(P)?P.usedMemoryPerReference:0),0),this._usedMemory;this._usedMemory=this._baseUsedMemory;this._vectorTileMemory=this._rasterTileMemory=0;for(var {data:K}of this.layerInfo[x.LayerClass.MAP])q.isVectorTile(K)?this._vectorTileMemory+=K.usedMemoryPerReference:
this._rasterTileMemory+=this._getTerrainDataMemory(K);K=this._cpuImageMemorySize;for(const L of this.layerInfo[x.LayerClass.ELEVATION])this._usedMemory+=L.data?K:0;this.renderData&&(this._usedMemory+=this.renderData.estimatedGeometryMemoryUsage,this._rasterTileMemory+=this.renderData.texture?.usedMemory??0);this._cached&&this._surface.upsampleMapCache.updateSize(this.key,this,this._mapTileMemory);return this._usedMemory}getUsedMemoryForLayer(K,L){L=this.layerInfo[K][L];return L?.data?K===x.LayerClass.MAP?
this._cached?0:this._getTerrainDataMemory(L.data):K===x.LayerClass.ELEVATION?this._cpuImageMemorySize:0:0}_getTerrainDataMemory(K){return q.isTileTexture(K)?K.texture.usedMemory:q.isRasterTile(K)?K.memoryUsage:q.isVectorTile(K)?K.usedMemoryPerReference:q.isImageWithType(K)||K instanceof HTMLImageElement?this._cpuImageMemorySize:0}updateScreenDepth(K){var L=this._center[a.CenterPosition.MIDDLE];const P=L[0],R=L[1];L=L[2];const W=K[2]*P+K[6]*R+K[10]*L+K[14];this.screenDepth=0>W?0:W/(K[3]*P+K[7]*R+K[11]*
L+K[15])}shouldSplit(K,L,P){if(!this.visible||K.frustum&&(!this._intersectsClippingArea||this._calculateFrustumVisibilityStatus(K.frustum)===y.TileFrustumVisibility.OUTSIDE))return z.TileUpdate.NONE;const R=this.level;p.subtract(N,d.getCenter(this._center[a.CenterPosition.MIDDLE]),L);var W=p.squaredLength(N),V=N;let ba=d.getCenter(this._center[a.CenterPosition.MIDDLE]);p.subtract(M,this._center[a.CenterPosition.TOP],L);var U=p.squaredLength(M);U<W&&(W=U,V=M,ba=this._center[a.CenterPosition.TOP]);
p.subtract(Q,this._center[a.CenterPosition.BOTTOM],L);U=p.squaredLength(Q);U<W&&(W=U,V=Q,ba=this._center[a.CenterPosition.BOTTOM]);if(this._edgeLen2>W&&R<K.maxLod)return z.TileUpdate.SPLIT;W=Math.sqrt(W);const da=this._edgeLen/(K.fovX*W*2),fa=()=>{if(R<K.maxLod)return this.elevationLevel=R,z.TileUpdate.NONE;const Z=R+Math.ceil(-Math.log2(K.relativeWidthLimit/da));return Z!==this.elevationLevel?(this.elevationLevel=Z,z.TileUpdate.ELEVATION):z.TileUpdate.NONE},ha=null!=P?P-R:Infinity;if(.5>=ha)return fa();
const T=p.dot(this.up,N);U=this._elevationBoundsMax-this._elevationBoundsMin;const S=U/this.edgeLen;if(K.aboveGround&&0<T&&.001>S&&0<T/W-Math.sin(this._curvatureHeight/(this.edgeLen*Math.SQRT1_2)*Math.PI)-S)return z.TileUpdate.NONE;P=null!=P?3-Math.min(ha,2):1;if(da*P<K.relativeWidthLimit||R>=K.maxLod)return fa();if(7>R)return z.TileUpdate.SPLIT;p.scale(O,this.up,T);p.subtract(O,O,V);V=p.squaredLength(O);if(V<=this.radius*this.radius)return z.TileUpdate.SPLIT;p.scale(O,O,this.radius/Math.sqrt(V));
p.add(O,O,ba);p.subtract(O,L,O);return Math.min(1,(Math.abs(p.dot(O,this.up))+.5*U+this._curvatureHeight)/p.length(O))*(this._edgeLen/(K.fovY*W*2))*P<.1/K.angledSplitBias*K.relativeHeightLimit?z.TileUpdate.NONE:z.TileUpdate.SPLIT}createChildren(){const K=this._children,L=this.lij[0]+1,P=2*this.lij[1],R=2*this.lij[2];K[0]=this.surface.createTile(L,P,R,this);K[1]=this.surface.createTile(L,P,R+1,this);K[2]=this.surface.createTile(L,P+1,R,this);K[3]=this.surface.createTile(L,P+1,R+1,this);return K}clearChildren(){this._children[0]=
this._children[1]=this._children[2]=this._children[3]=null}get loaded(){return this.renderData?.hasGeometry??!1}load(){this.refMapData();for(const K of x.LayerClasses)this._createOrUpdateAgents(0,K);this.surface.renderer.loadTile(this)}unload(K){this.renderData&&this.unrefMapData();K.unloadTile(this);for(const L of x.LayerClasses){K=this.layerInfo[L];for(const P of K)P.loadingAgent&&P.loadingAgent!==v.tileAgentDone&&(C(P.loadingAgent),P.loadingAgent=null),P.pendingUpdates=0}this.resetPendingUpdate(z.TileUpdate.GEOMETRY);
this.resetPendingUpdate(z.TileUpdate.TEXTURE_NOFADING);this.resetPendingUpdate(z.TileUpdate.TEXTURE_FADING)}unloadMapData(){const K=this.layerInfo[x.LayerClass.MAP];for(const L of K)L.loadingAgent&&L.loadingAgent!==v.tileAgentDone&&(C(L.loadingAgent),L.loadingAgent=null),L.pendingUpdates=0,L.invalidateSourceData();this.renderData&&this.renderData.releaseTexture();this.setMemoryDirty()}updateClippingStatus(K){if(g.equals(K,this._clippingArea))return!1;var L=this._intersectsClippingArea;const P=this._withinClippingArea;
null!=K?(this._intersectsClippingArea=this.intersectsExtent(K),this._withinClippingArea=this._isWithinExtent(K)):this._withinClippingArea=this._intersectsClippingArea=!0;this._clippingArea=K;this.updateVisibility();K=P&&this._withinClippingArea;L=!P&&!L&&!this._withinClippingArea&&!this._intersectsClippingArea;!this.renderData||K||L||this.setPendingUpdate(z.TileUpdate.GEOMETRY);return!0}updateVisibility(){this._dirty=!0;this._surface.setTileTreeDirty()}getLayerInfo(K,L){return this.layerInfo[L][K]}hasLayerData(K,
L){K=this.layerInfo[L][K];return!(!K?.data||K.dataInvalidated)}get updating(){if(this.hasPendingUpdates)return!0;for(const K of x.LayerClasses){const L=this.layerInfo[K];for(const P of L)if(P.loadingAgent&&P.loadingAgent!==v.tileAgentDone&&P.loadingAgent.updating)return!0}return!1}_isSuspended(K){return this.hasPendingUpdate(z.TileUpdate.SPLIT)?!0:K===x.LayerClass.ELEVATION?!1:!this.loadable}get hasPendingUpdates(){return 0!==this._pendingUpdates}hasPendingUpdate(K){return(this._pendingUpdates&K)===
K}setPendingUpdate(K){const L=this._pendingUpdates;this._pendingUpdates|=K;K===z.TileUpdate.SPLIT||K===z.TileUpdate.MERGE?this._surface.setTileTreeDirty():this._surface.requestUpdate();return L!==this._pendingUpdates}resetPendingUpdate(K){return this.hasPendingUpdate(K)?(this._pendingUpdates&=~K,!0):!1}requestLayerData(K,L,P){const R=this.layerInfo[L][K];if(R.waitingAgents.has(P))return console.warn("agent already requested this piece of map data (tile %s, agent tile %s, layer: %d/%d)",this._lij.toString(),
P.tile.lij.toString(),L,K),!0;R.waitingAgents.push(P);if(R.data&&!R.dataInvalidated)return console.warn("agent requested existing data (tile %s, agent tile %s, layer: %d/%d)",this._lij.toString(),P.tile.lij.toString(),L,K),K=q.isVectorTile(R.data),P.dataArrived(this,K),!0;if(R.requestPromise)return!0;n.abortMaybe(R.requestAbort);R.requestAbort=new AbortController;const W=this._surface.requestTileData(this,K,L,R.requestAbort);if(!W)return R.requestAbort=null,!1;P=()=>{R.requestPromise===W&&(R.requestPromise=
null,R.requestAbort=null)};R.requestPromise=W;W.then(P,P);return!0}get leaf(){return null==this._children[0]}hasLij(K){return this._lij[0]===K[0]&&this._lij[1]===K[1]&&this._lij[2]===K[2]}findByLij(K){if(this.hasLij(K))return this;const L=this._children;return L[0]?L[0].findByLij(K)||L[1].findByLij(K)||L[2].findByLij(K)||L[3].findByLij(K):null}distanceToSquared(K){return p.squaredLength(p.subtract(O,d.getCenter(this._center[a.CenterPosition.MIDDLE]),K))}containsPoint(K){const L=this.extent;return K[0]>=
L[0]&&K[1]>=L[1]&&K[0]<=L[2]&&K[1]<=L[3]}containsPointXY(K,L){const P=this.extent;return K>=P[0]&&L>=P[1]&&K<=P[2]&&L<=P[3]}unrequestLayerData(K,L,P){K=this.layerInfo[L][K];L=K.waitingAgents;P=null!=L.removeUnordered(P);r.weakAssert(P,"agent has not requested this piece of map data");1>L.length&&(K.abortRequest(),this.setMemoryDirty())}dataArrived(K,L,P){const R=q.isVectorTile(P);K=this.layerInfo[L][K];K.data=P;K.dataInvalidated=!1;K.waitingAgents.forAll(W=>W.dataArrived(this,R));K.waitingAgents.clear();
this.setMemoryDirty()}dataMissing(K,L){K=this.layerInfo[L][K];K.dataMissing=!0;K.waitingAgents.forAll(P=>P.dataMissing());K.waitingAgents.clear();this.setMemoryDirty()}updateRenderData(K,L,P){P&&this.forEachLoadedNeighbor(R=>R.updateRenderData(K,L));switch(K){case x.LayerClass.MAP:return this._updateTexture(L);case x.LayerClass.ELEVATION:return this._updateGeometry()}}_updateTexture(K){this.renderData&&(this.resetPendingUpdate(K===w.TextureUpdate.FADING?z.TileUpdate.TEXTURE_NOFADING:z.TileUpdate.TEXTURE_FADING),
this.setPendingUpdate(K===w.TextureUpdate.FADING?z.TileUpdate.TEXTURE_FADING:z.TileUpdate.TEXTURE_NOFADING))}_updateGeometry(){this.setPendingUpdate(z.TileUpdate.GEOMETRY);for(const K of this.layerInfo[x.LayerClass.ELEVATION])K.pendingUpdates|=z.TileUpdate.GEOMETRY}invalidateLayerData(K,L){this.layerInfo[L][K].invalidateSourceData();this.restartAgents(L)}computeElevationBounds(){const K=this._elevationBoundsMin,L=this._elevationBoundsMax;let P=Infinity,R=-Infinity;const W=this.layerInfo[x.LayerClass.ELEVATION];
let V=!0;for(const ba of W)null!=ba.elevationBounds&&(P=Math.min(P,ba.elevationBounds.min),R=Math.max(R,ba.elevationBounds.max),ba.elevationBounds.hasNoDataValues||(V=!1));V&&(P=Math.min(P,0),R=Math.max(R,0));if(K!==P||L!==R)this._elevationBoundsMin=P,this._elevationBoundsMax=R,this.updateRadiusAndCenter(),this._surface.setTileTreeDirty()}_updateCenter(){const K=this._elevationBoundsMin,L=this._elevationBoundsMax,P=this._center;p.scale(O,this.up,.5*(K+L));p.add(d.getCenter(P[a.CenterPosition.MIDDLE]),
this.centerAtSeaLevel,O);p.scale(O,this.up,K);p.add(P[a.CenterPosition.TOP],this.centerAtSeaLevel,O);p.scale(O,this.up,L);p.add(P[a.CenterPosition.BOTTOM],this.centerAtSeaLevel,O)}findElevationBoundsForLayer(K,L){const P=this.layerInfo[x.LayerClass.ELEVATION][K],R=this.elevationLevelDelta,W=Math.max(this.elevationLevel-R,0);var V=P.elevationBounds;if(!(null!=V&&V.level>=L&&V.level<=W)&&(L=this._surface.layerViewByIndex(K,x.LayerClass.ELEVATION),A.fallsWithinLayerView(this,L))){L=J;V=!1;var ba=P.data;
if(ba&&ba.level<=W)K=P.data,L.min=K.samplerData.data.minValue,L.max=K.samplerData.data.maxValue,L.hasNoDataValues=K.samplerData.data.hasNoDataValues,L.level=this.level,V=!0;else{ba=0;let U,da;for(let fa=this._parent;fa&&(!da||ba<R)&&!(ba=this.elevationLevel-fa.level,U=da||U,da=fa.layerInfo[x.LayerClass.ELEVATION][K].data,!da&&U&&fa.level<=W);fa=fa.parent);if(da=da||U)da.computeMinMaxValue(this._lij[0],this._lij[1],this._lij[2],L),Infinity!==L.min&&(L.level=da.level,V=!0)}V&&(null==P.elevationBounds&&
(P.elevationBounds=new c.ElevationBounds),P.elevationBounds.copyFrom(L))}}modifyLayers(K,L,P){P=this.layerInfo[P];for(var R of P)R.loadingAgent&&R.loadingAgent!==v.tileAgentDone&&(C(R.loadingAgent),R.loadingAgent=null),R.waitingAgents.clear();for(R=0;R<P.length;++R)void 0===K[R]&&P[R].release();K=Array(...P);R=L.length;P.length=R;for(let W=0;W<R;W++){const V=L[W];P[W]=-1<V?K[V]:B.TilePerLayerInfo.acquire(this._surface.upsampleInfoPool)}this.setMemoryDirty()}restartAgents(K){this.renderData&&(this._createOrUpdateAgents(0,
K),this.updateRenderData(K,w.TextureUpdate.FADING))}updateAgents(K){if(this.renderData){const L=this.layerInfo[K];for(const P of L)P.loadingAgent===v.tileAgentDone&&(P.loadingAgent=null);this._createOrUpdateAgents(0,K)}}updateAgentSuspension(){for(const K of x.LayerClasses){const L=this._isSuspended(K);for(const P of this.layerInfo[K])P.loadingAgent&&P.loadingAgent!==v.tileAgentDone&&(P.loadingAgent.setSuspension(L),P.loadingAgent===v.tileAgentDone&&this.updateRenderData(K,w.TextureUpdate.FADING))}}removeLayerAgent(K,
L){K=this.layerInfo[L][K];K.loadingAgent&&K.loadingAgent!==v.tileAgentDone&&K.loadingAgent.dispose();K.loadingAgent=null}agentDone(K,L){const P=this.layerInfo[L][K];P.loadingAgent=v.tileAgentDone;P.data||null!=P.upsampleInfo||this._createOrUpdateAgents(K+1,L)}_hasBlendableAncestor(K){return"normal"!==K.blendMode||f.isGroupLayer(K.parent)&&this._hasBlendableAncestor(K.parent)}_hasBlendModes(K,L,P){for(;K<L;++K){const R=this._surface.layerViewByIndex(K,P);if(r.isBlendableLayerView(R)&&"normal"!==R?.layer?.blendMode||
f.isGroupLayer(R?.layer?.parent)&&this._hasBlendableAncestor(R?.layer?.parent))return!0}return!1}_createOrUpdateAgents(K,L){const P=this.layerInfo[L];if(0!==P.length){var R=this._isSuspended(L);for(let U=K;U<P.length;++U){const da=P[U],fa=this._surface.layerViewByIndex(U,L);var W=!1;if(da.loadingAgent)A.fallsWithinLayerView(this,fa)?(da.loadingAgent!==v.tileAgentDone&&da.loadingAgent.setSuspension(R),da.loadingAgent!==v.tileAgentDone&&(W=da.loadingAgent.update())):da.dispose();else if(A.fallsWithinLayerView(this,
fa)){W=U;var V=L,ba=R;const ha=V===x.LayerClass.ELEVATION?I.acquire():D.acquire();ha.init(this,W,V,ba);da.loadingAgent=ha;(W=da.loadingAgent.startLoading())?da.loadingAgent===v.tileAgentDone&&this.setPendingUpdate(z.TileUpdate.GEOMETRY):(C(da.loadingAgent),da.loadingAgent=v.tileAgentDone)}da.loadingAgent===v.tileAgentDone&&this.updateRenderData(L,w.TextureUpdate.FADING);if(!this._hasBlendModes(K,P.length,L)&&W&&fa.isOpaque)break}}}_isWithinExtent(K){const L=this.extent;return L[0]>=K[0]&&K[2]>=L[2]&&
L[1]>=K[1]&&K[3]>=L[3]}intersectsExtent(K){const L=this.extent;return L[2]>=K[0]&&K[2]>=L[0]&&L[3]>=K[1]&&K[3]>=L[1]}getElevationVerticesPerSide(K){K=b.clamp((this._maxTesselation>>Math.max(this.level-K,this.elevationLevelDelta-(this.elevationLevel-this.level)))+1,2,this._maxTesselation+1);return Math.max(K,this.minimumVerticesPerSide)}_findLIJ(K,L){if(!K)return null;var P=this.surface.rootTiles;if(null!=P)for(var R of P){{P=R.lij;const W=K[0]-P[0];P=0>W?!1:K[1]>>W===P[1]&&K[2]>>W===P[2]}if(P){for(P=
K[0]-R.level-1;0<=P&&!R.leaf&&!L(R);)R=R.children[2*(K[1]>>P&1)+(K[2]>>P&1)],P--;return L(R)?R:null}}return null}findNeighborTile(K,L){const P=this._lij;return(K=this._getNeighborLIJ(P,K))?H(P,K)?L(this)?this:null:this._findLIJ(K,L):null}findCorner(K,L){K=K===t.NeighborIndex.NORTH_EAST?1:K===t.NeighborIndex.NORTH_WEST?0:K===t.NeighborIndex.SOUTH_WEST?2:3;let P=this;for(;P.children[0]&&(!L||!L(P));)P=P.children[K];return P}findNeighborCornerTileExact(K,L){return this.findNeighborTile(K,P=>L(P)||P.level===
this.level)?.findCorner(r.oppositeCorner(K),L)||null}forAllSubtreeOnSide(K,L){const P=K===t.NeighborIndex.NORTH?[0,1]:K===t.NeighborIndex.NORTH_EAST?[1]:K===t.NeighborIndex.EAST?[1,3]:K===t.NeighborIndex.SOUTH_EAST?[3]:K===t.NeighborIndex.SOUTH?[2,3]:K===t.NeighborIndex.SOUTH_WEST?[2]:K===t.NeighborIndex.WEST?[0,2]:[0],R=W=>{const V=W.children;!L(W)&&V[0]&&P.forEach(ba=>R(V[ba]))};R(this)}getNeighborEdgeStartVertexIndex(K,L){if(!L)return 0;var P=this.level-L.level;r.internalAssert(!r.enableTerrainInternalChecks||
0<=P);if(0===P)return 0;P=2**P;var R=(K=1===(K&1))?0:1;L=L.lij[R+1]*P;R=this._lij[R+1];const W=R-L;K=K?P-1-W:W;r.enableTerrainInternalChecks&&(r.internalAssert(L<=R&&R<L+P),r.internalAssert(0<=K&&K<P));return K}forEachLoadedNeighbor(K){const L=this.level,P=R=>R.level===L||R.loaded;r.neighborEdgeIndices.forEach(R=>{const W=this.findNeighborTile(R,P);null!=W&&W!==this&&W.forAllSubtreeOnSide(r.oppositeEdge(R),V=>V.loaded?(K(V,R),!0):!1)});r.neighborCornerIndices.forEach(R=>{const W=this.findNeighborTile(R,
P)?.findCorner(r.oppositeCorner(R),V=>V.loaded);r.internalAssert(!W||E(this,W,R));W?.loaded&&K(W,R)})}_getNeighborLIJ(K,L){const P=r.isNorth(L)?-1:r.isSouth(L)?1:0;L=r.isWest(L)?-1:r.isEast(L)?1:0;K=[K[0],K[1]+P,K[2]+L];return 0>K[1]?null:this.surface.isGlobal?this._wrapLIJ(K):0>K[2]?null:K}_wrapLIJ(K){return!K||0>K[1]||K[1]>=2**K[0]?null:this.surface.wrapEastWest(K)}isEdgeNeighbor(K,L){if(null==K)return!1;if(0===this.level&&0===K.level&&(this._eastEnd&&K._westEnd&&L===t.NeighborIndex.EAST||this._westEnd&&
K._eastEnd&&L===t.NeighborIndex.WEST))return!0;const P=Math.max(1E-6*(this.extent[2]-this.extent[0]),1);switch(L){case t.NeighborIndex.NORTH:return r.almostEquals(this.extent[3],K.extent[1],P);case t.NeighborIndex.SOUTH:return r.almostEquals(this.extent[1],K.extent[3],P);case t.NeighborIndex.EAST:return r.almostEquals(this.extent[2],K.extent[0],P)||r.almostEquals(this.extent[2],-K.extent[0],P);case t.NeighborIndex.WEST:return r.almostEquals(this.extent[0],K.extent[2],P)||r.almostEquals(this.extent[0],
-K.extent[2],P)}}get _eastEnd(){return this._lij[2]===this.surface.lijEastEnd(this.level)-1}get _westEnd(){return 0===this._lij[2]}checkGeometryWaterproofness(){r.enableWaterproofTests&&(r.internalAssert(this.loaded),this.renderData?.checkGeometryWaterproofness())}shouldHaveNeighbor(K){const L=this.extent,P=this.surface.rootTilesExtent,R=.25*(L[2]-L[0]);if(r.isNorth(K)&&L[3]+R>=P[3]||r.isSouth(K)&&L[1]-R<=P[1])return!1;const W=this.surface.isGlobal;return!W&&r.isWest(K)&&L[0]-R<=P[0]||!W&&r.isEast(K)&&
L[2]+R>=P[2]?!1:!0}updateDistanceToPOI(K){var L=this._lastPOI;if(!(0<=this.distanceToPOI&&L[0]===K[0]&&L[1]===K[1]&&L[2]===K[2])){p.copy(this._lastPOI,K);var P=this._center[a.CenterPosition.MIDDLE];L=K[0]-P[0];var R=K[1]-P[1];K=K[2]-P[2];this.distanceToPOI=L*L+R*R+K*K}}}const D=new k(u.MapTileAgent),I=new k(l.ElevationTileAgent),J=new c.ElevationBounds;a.CenterPosition=void 0;(function(K){K[K.TOP=0]="TOP";K[K.MIDDLE=1]="MIDDLE";K[K.BOTTOM=2]="BOTTOM"})(a.CenterPosition||(a.CenterPosition={}));const N=
h.create(),M=h.create(),Q=h.create(),O=h.create();a.Tile=G;a.isCornerNeighbor=E;a.lijEquals=H;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/ElevationTileAgent":function(){define(["exports","./TileAgent"],function(a,b){class n extends b.TileAgent{constructor(){super(...arguments);this.type="elevation";this._scaleRangeEnabled=!1}get _desiredMinLevelDelta(){return this.tile.elevationLevelDelta-(this.tile.elevationLevel-this.tile.level)}get _progressiveLevelModulo(){return 0}}
a.ElevationTileAgent=n;a.isElevationTileAgent=function(k){return"elevation"===k.type};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/TileAgent":function(){define(["exports","../../../core/has","./interfaces","./TerrainConst","./tileUtils"],function(a,b,n,k,p){class h{get updating(){return!!this._tileRequested}init(d,f,c,l){this.tile=d;this._layerIdx=f;this._layerClass=c;this._suspended=l;this._tileLayerInfo=d.getLayerInfo(f,c);this._tileRequested=null;d=this._findAncestorWithData();
this._setUpsampleTile(d)}startLoading(){return this._requestNext()}dispose(){this._tileRequested&&(this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null);this._tileLayerInfo=this.tile=null}setSuspension(d){d!==this._suspended&&((this._suspended=d)?this._tileRequested&&(this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null):this._tileLayerInfo.data||this.update())}update(){const d=this._findAncestorWithData();
this._setUpsampleTile(d);return this._requestNext()}dataArrived(d,f){this._setUpsampleTile(d,f);this._tileRequested=null;d===this.tile?this.tile.updateRenderData(this._layerClass,n.TextureUpdate.FADING,f):this._requestNext()}dataMissing(){this._tileRequested=null;this._tileLayerInfo.data=null;this._requestNext()}_agentDone(){this.tile.agentDone(this._layerIdx,this._layerClass);this.dispose()}_requestNext(){if(this._suspended)return!0;const d=this._findNextDownload();if(this._tileRequested){if(d===
this._tileRequested)return!0;this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this);this._tileRequested=null}null!=d?d.requestLayerData(this._layerIdx,this._layerClass,this)&&(this._tileRequested=d):this._agentDone();return!!this._tileRequested}_findNextDownload(){const d=this._layerIdx,f=this._layerClass;var c=this.tile.surface.layerViewByIndex(d,f);const {minLevel:l,maxLevel:w}=c.dataLevelRange,x=this._desiredMinLevelDelta,u=this._progressiveLevelModulo+x,t=this._scaleRangeEnabled?
p.fallsWithinLayerView:()=>!0;let m=this.tile;const q=m.level;let r;const v=this._tileLayerInfo.upsampleInfo,y=v?.tile?.level??-1,B=null!=v?y-q>=x:!1,z=p.getTileMapCache(c),A="vector-tile-3d"===c.type?c.schemaHelper:null;for(;m&&t(m,c)&&m.level>=l;){const C=m.level,H=q-C,E=m.layerInfo[f][d];if(E.data&&H>=x){(!B||C>y)&&this._setUpsampleTile(m);E.dataInvalidated&&(r=m);break}const F=A?.getLevelRowColumn(m.lij)??m.lij;if("unavailable"!==z?.getAvailability(F[0],F[1],F[2])&&C<=w&&!E.data&&!E.dataMissing){if(!r||
m.level===l||0===C%k.progressiveLoadingModulo||q-r.level<x)r=m;if(H>=u)break}m=m.parent}null!=r&&q-r.level<x&&(v?r=null:(c=this._findAncestorWithData(),null!=c&&(this._setUpsampleTile(c),r=c.layerInfo[f][d].dataInvalidated?c:null)));return r}_findAncestorWithData(){const d=this.tile.elevationLevel,f=this._desiredMinLevelDelta;let c;for(let l=this.tile;l;l=l.parent)if(l.hasLayerData(this._layerIdx,this._layerClass)){if(d-l.level>=f)return l;c=l}return c}_setUpsampleTile(d,f){this._tileLayerInfo.setUpsampleInfo(this.tile,
d);this.tile.updateRenderData(this._layerClass,n.TextureUpdate.FADING,f)}get test(){}}class e extends h{constructor(){super(...arguments);this.type="none"}get _desiredMinLevelDelta(){throw g;}get _progressiveLevelModulo(){throw g;}dispose(){}}const g=Error("Abstract method called on TileAgent");b=new e;a.TileAgent=h;a.tileAgentDone=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/MapTileAgent":function(){define(["exports","./TerrainConst","./TileAgent"],function(a,
b,n){class k extends n.TileAgent{constructor(){super();this.type="map";this._scaleRangeEnabled=!0}get _desiredMinLevelDelta(){return 0}get _progressiveLevelModulo(){return b.progressiveLoadingModulo}}a.MapTileAgent=k;a.isMapTileAgent=function(p){return"map"===p.type};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/TileFrustumVisibility":function(){define(["exports"],function(a){a.TileFrustumVisibility=void 0;var b=a.TileFrustumVisibility||(a.TileFrustumVisibility=
{});b[b.INSIDE=0]="INSIDE";b[b.INTERSECTS=1]="INTERSECTS";b[b.OUTSIDE=2]="OUTSIDE";Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/TilePerLayerInfo":function(){define("exports ../../../core/maybe ../../../core/ObjectPool ../../../core/PooledArray ./terrainUtils ./tileUtils".split(" "),function(a,b,n,k,p,h){class e{constructor(){this.waitingAgents=new k;this.requestAbort=this.requestPromise=this.loadingAgent=this._upsampleInfo=null;this.pendingUpdates=0}get upsampleInfo(){return this._upsampleInfo}static acquire(f){const c=
g.acquire();c._init(f);return c}release(){this.dispose();d.delete(this);g.release(this)}dispose(){this.loadingAgent=b.disposeMaybe(this.loadingAgent);this.abortRequest();this._unsetUpsampleInfo();this.pendingUpdates=0;this._data=p.releaseTerrainData(this._data)}static prune(){g.prune(0)}_init(f){this.waitingAgents.clear();this._data=p.releaseTerrainData(this._data);this.dataInvalidated=this.dataMissing=!1;this._unsetUpsampleInfo();this.abortRequest();this.loadingAgent=null;this.pendingUpdates=0;this._pool=
f;this.elevationBounds=null}invalidateSourceData(){this.dataInvalidated=!0;this.dataMissing=!1;this._unsetUpsampleInfo()}abortRequest(){this.requestAbort=b.abortMaybe(this.requestAbort);this.requestPromise=null}_unsetUpsampleInfo(){this._upsampleInfo&&(this._upsampleInfo.tile?.unrefMapData(),this._pool.release(this._upsampleInfo),this._upsampleInfo=null)}setUpsampleInfo(f,c){if(f===c||null==c)this._unsetUpsampleInfo();else{if(null==this._upsampleInfo)this._upsampleInfo=this._pool.acquire();else{if(this._upsampleInfo.tile===
c)return;this._upsampleInfo.tile?.unrefMapData()}c.refMapData();h.computeUpsampleInfo(f,c,this._upsampleInfo)}}get data(){return this._data}set data(f){p.releaseTerrainData(this._data);this._data=f}}const g=new n(e,null,()=>{}),d=new Map;a.TilePerLayerInfo=e;a.printAllocations=function(){0<d.size&&(console.log(`${d.size} live TilePerLayerInfo allocations:`),d.forEach(f=>console.log(f,"\n")))};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/TileUpdate":function(){define(["exports"],
function(a){a.TileUpdate=void 0;var b=a.TileUpdate||(a.TileUpdate={});b[b.NONE=0]="NONE";b[b.SPLIT=1]="SPLIT";b[b.ELEVATION=2]="ELEVATION";b[b.MERGE=4]="MERGE";b[b.GEOMETRY=8]="GEOMETRY";b[b.TEXTURE_NOFADING=16]="TEXTURE_NOFADING";b[b.TEXTURE_FADING=32]="TEXTURE_FADING";Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/ScaleRangeQueries":function(){define("exports ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/ObjectPool ../../../core/PooledArray ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ../../../chunks/vec42 ../../../core/libs/gl-matrix-2/factories/vec4f64".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l){class w{constructor(){this.extent=l.create();this.maxLevel=this.minLevel=0;this.callback=null}}a.ScaleRangeQueries=class extends n{constructor(){super(...arguments);this._queries=new p({initialSize:10});this._queriesInvPtr=0;this._queryQueue=new p({initialSize:30});this._queryPool=new k(w)}queryVisibleLevelRange(x,u,t,m){const q=this._queryPool.acquire();c.copy(q.extent,x);q.minLevel=null==u?-Number.MAX_VALUE:u;q.maxLevel=null==t?Number.MAX_VALUE:t;q.callback=m;this._queryQueue.push(q);
this.notifyChange("updating")}get updating(){return 0!==this._queryQueue.length}prepare(){for(;this._queries.length<this._queries.data.length&&0<this._queryQueue.length;){const x=this._queryQueue.pop();this._queries.push(x)}this._queriesInvPtr=this._queries.length}process(){for(let x=0;x<this._queries.length;x++){const u=this._queries.data[x];this._queryPool.release(u);u.callback(x>=this._queriesInvPtr);u.callback=null}this._queries.clear();this.notifyChange("updating")}queriesForTile(x){const u=
x.level;let t=0;for(;t<this._queriesInvPtr;){const m=this._queries.data[t],q=m.extent;u>=m.minLevel&&u<=m.maxLevel&&q[0]<=x.extent[2]&&q[2]>=x.extent[0]&&q[1]<=x.extent[3]&&q[3]>=x.extent[1]?(this._queries.swapElements(t,this._queriesInvPtr-1),this._queriesInvPtr--):t++}}};b.__decorate([h.property()],a.ScaleRangeQueries.prototype,"updating",null);a.ScaleRangeQueries=b.__decorate([f.subclass("esri.views.3d.terrain.ScaleRangeQueries")],a.ScaleRangeQueries);Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/views/3d/terrain/SphericalPatch":function(){define("exports ../../../core/mathUtils ../../../chunks/vec32 ../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../geometry/projection/lonLatToSphericalPCPF ../../../geometry/support/DoubleArray ../../../geometry/support/frustum ../../../chunks/sphere ./interfaces ./PatchGeometryFactory ./terrainUtils ./Tile ./TileFrustumVisibility ./tileUtils".split(" "),function(a,b,n,k,p,h,e,g,d,f,c,l,w,x){function u(B,z,A,C,H,E){B=C-B;
z=H-z;A=E-A;return B*B+z*z+A*A}class t extends l.Tile{constructor(B,z,A,C,H){super();this._convexHull=Array(24);this._boundingSphere=g.create();this._baseUsedMemory=1816;this.init(B,z,A,C,H)}init(B,z,A,C,H){super.init(B,z,A,C,H);z=this.ellipsoid.radius;A=this.extentInRadians[0];C=this.extentInRadians[1];H=this.extentInRadians[2];const E=this.extentInRadians[3],F=b.lerp(C,E,.5),G=b.lerp(A,H,.5);this._edgeLen=(H-A)*Math.cos(0===B?0:Math.min(Math.abs(C),Math.abs(E)))*z;this._edgeLen2=this._edgeLen*this._edgeLen;
this._curvatureHeight=z-Math.sqrt(z*z-this._edgeLen2/4);p.lonLatToSphericalPCPF(this.centerAtSeaLevel,G,F,this.ellipsoid.radius);n.normalize(this.up,this.centerAtSeaLevel);this.updateRadiusAndCenter()}updateRadiusAndCenter(){this._updateBoundingVolumes();const B=this._center;if(0===this.lij[0])n.set(g.getCenter(B[l.CenterPosition.MIDDLE]),0,0,0),n.set(B[l.CenterPosition.TOP],0,0,0),n.set(B[l.CenterPosition.BOTTOM],0,0,0),B[l.CenterPosition.MIDDLE][3]=this.ellipsoid.radius+this.elevationBoundsMax;
else{this._updateCenter();const F=B[l.CenterPosition.MIDDLE],G=this.convexHull;var z=0;for(let D=0;8>D;++D){var A=Math,C=A.max;var H=g.getCenter(F);var E=3*D;H=u(H[0],H[1],H[2],G[E],G[E+1],G[E+2]);z=C.call(A,z,H)}B[l.CenterPosition.MIDDLE][3]=Math.sqrt(z)}}_calculateFrustumVisibilityStatus(B){if(!e.intersectsSphere(B,this._boundingSphere))return w.TileFrustumVisibility.OUTSIDE;if(10>this.lij[0])return w.TileFrustumVisibility.INTERSECTS;const z=this.convexHull,A=this.surface.view.state.camera.near;
let C=!0;for(let E=0;E<e.numPlanes;E++){var H=B[E];const F=H[0],G=H[1],D=H[2];H=H[3]-(E===e.PlaneIndex.NEAR?A:0);let I=!1;for(let J=0;8>J;++J){const N=3*J;if(0>F*z[N]+G*z[N+1]+D*z[N+2]+H){if(I=!0,!C)break}else C=!1}if(!I)return w.TileFrustumVisibility.OUTSIDE}return C?w.TileFrustumVisibility.INSIDE:w.TileFrustumVisibility.INTERSECTS}computeElevationBounds(){super.computeElevationBounds();this._updateBoundingVolumes()}createGeometry(){f.createSphericalGlobePatch(this.renderData,this._getPatchType());
this._updateBoundingVolumes();this.setMemoryDirty()}_updateBoundingVolumes(){this._updateConvexHull();this._updateBoundingSphere();c.enableTerrainInternalChecks&&this._checkBVs()}_updateBoundingSphere(){const B=this._boundingSphere,z=g.getCenter(B);var A=this.elevationBoundsMin,C=this.elevationBoundsMax,H=this.ellipsoid.radius;if(0===this.level)n.set(z,0,0,0),B[3]=H+C;else{var E=this.extentInRadians,F=.5*(E[0]+E[2]),G=E[3];q(v,F,E[1],H);q(y,F,G,H);n.add(z,v,y);n.scale(z,z,(H+.5*(A+C))/n.len(z));A=
this.convexHull;C=0;for(H=0;8>H;++H)E=z[0]-A[3*H],F=z[1]-A[3*H+1],G=z[2]-A[3*H+2],C=Math.max(C,Math.sqrt(E*E+F*F+G*G));B[3]=C+2}}_updateConvexHull(){var B=this.extentInRadians,z=this.ellipsoid.radius;if(0!==this.level){var A=this.elevationBoundsMin,C=this.elevationBoundsMax,H=this._getPatchType(),E=this.surface.isWebMercator,F=E&&H===d.PatchType.HAS_NORTH_POLE,G=(H=E&&H===d.PatchType.HAS_SOUTH_POLE)||F;E=Math.PI/2;var D=B[0],I=B[2];H=H?-E:B[1];var J=F?E:B[3],N=.5*(D+I),M=z+(G?Math.min(0,A-1):A);A=
k.create();B=k.create();F=k.create();E=k.create();q(A,D,H,M);q(B,D,J,M);q(F,I,J,M);q(E,I,H,M);D=(P,R)=>{for(let W=0;3>W;++W)this._convexHull[3*R+W]=P[W]};D(A,0);D(B,1);D(F,2);D(E,3);var Q=z+(G?Math.max(0,C+1):C),O=k.create();z=k.create();C=k.create();q(z,N,J,M);q(C,N,H,M);n.add(O,z,C);n.normalize(O,O);var K=k.create(),L=k.create();H=(P,R)=>{n.sub(L,P,R);n.normalize(L,L);R=-n.dot(P,K)/n.dot(L,K);c.internalAssert(0<=R);n.scale(L,L,R);n.add(P,P,L)};2**this.lij[0]>2*this.lij[1]?(z=k.create(),n.cross(z,
r,C),n.normalize(z,z),n.cross(K,C,z),n.normalize(K,K),c.internalAssert(c.almostEquals(n.dot(K,C)/n.len(C),0)),H(A,B),H(E,F),D(A,0),D(E,3)):2**this.lij[0]!==2*this.lij[1]&&(C=k.create(),n.cross(C,r,z),n.normalize(C,C),n.cross(K,C,z),n.normalize(K,K),H(B,A),H(F,E),D(B,1),D(F,2));z=(P,R)=>{const W=Q/n.dot(R,O);for(let V=0;3>V;++V)this._convexHull[3*P+V]=R[V]*W};z(4,A);z(5,B);z(6,F);z(7,E)}}_getPatchType(){const B=this.lij[1],z=B===(1<<this.level)-1;return 0===B?z?d.PatchType.HAS_BOTH_POLES:d.PatchType.HAS_NORTH_POLE:
z?d.PatchType.HAS_SOUTH_POLE:d.PatchType.REGULAR}intersectsRay(B,z,A,C){var H=this._boundingSphere;A=H[3]+A;var E=H[0]-B[0];C=H[1]-B[1];B=H[2]-B[2];H=(E*z[0]+C*z[1]+B*z[2])/(z[0]*z[0]+z[1]*z[1]+z[2]*z[2]);E=z[0]*H-E;C=z[1]*H-C;z=z[2]*H-B;return E*E+C*C+z*z<A*A}get minimumVerticesPerSide(){return this.level<m.length?m[this.level]+1:2}updateCornerElevations(){f.updateCornerSpherical(this.renderData);this._updateBoundingVolumes()}updateEdgeElevations(){f.updateEdgesAndCornersSpherical(this.renderData);
this._updateBoundingVolumes()}updateEdgeElevationsAndResolutions(){f.updateEdgeElevationsAndResolutionsSpherical(this.renderData);this._updateBoundingVolumes()}_checkBVs(){if(c.enableTerrainInternalChecks&&!(2>=this.level)){var B=this._boundingSphere,z=B[3],A=g.getCenter(B);B=k.create();var C=this.ellipsoid.radius,H=this.elevationBoundsMin,E=this.elevationBoundsMax,F=C+H,G=this._center[l.CenterPosition.MIDDLE][3],D=this.convexHull,I=(qa,sa)=>{for(let xa=0;3>xa;++xa)qa[xa]=D[3*sa+xa]},J=k.create(),
N=k.create(),M=k.create(),Q=k.create(),O=k.create(),K=(qa,sa,xa,ta)=>{I(N,qa);I(M,sa);I(Q,xa);n.sub(N,N,M);n.sub(Q,Q,M);n.cross(J,N,Q);n.normalize(J,J);var Ba=n.dot(J,M);I(O,ta);const Ia=n.dot(J,O);Ba=Math.abs(Ia-Ba);c.internalAssert(c.almostEquals(Ba,0),`Non coplanar ${qa},${sa},${xa},${ta} diff = ${Ba}`)};K(0,1,2,3);K(4,5,6,7);K(0,1,4,5);K(1,2,5,6);K(2,3,6,7);K(3,0,7,4);var L=h.newDoubleArray(24),P=k.create(),R=k.create(),W=k.create(),V=k.create();K=(qa,sa,xa,ta)=>{I(P,sa);I(R,xa);I(W,ta);n.sub(P,
P,R);n.normalize(P,P);n.sub(W,W,R);n.normalize(W,W);n.cross(V,P,W);n.normalize(V,V);sa=n.dot(V,R);qa*=4;for(xa=0;3>xa;++xa)L[qa+xa]=V[xa];L[qa+3]=sa};K(0,0,1,2);K(1,1,0,4);K(2,1,5,2);K(3,3,2,6);K(4,4,0,3);K(5,4,6,5);var ba=(qa,sa,xa,ta)=>{qa*=4;return L[qa]*sa+L[qa+1]*xa+L[qa+2]*ta-L[qa+3]},U=(qa,sa,xa,ta)=>-1<=ba(qa,sa,xa,ta),da=2**this.lij[0]>2*this.lij[1];K=(qa,sa,xa)=>Math.sqrt(u(qa,sa,xa,A[0],A[1],A[2]))<z;var fa=this.extentInRadians,ha=.5*(fa[0]+fa[2]),T=fa[1],S=fa[3];fa=k.create();var Z=k.create();
q(fa,ha,S,F);q(Z,ha,T,F);F=da?"Upper":"Lower";da=!0;for(ha=0;6>ha;++ha){for(T=0;8>T;++T)S=3*T,S=-1<=ba(ha,D[S],D[S+1],D[S+2]),da&&=S,c.internalAssert(S,`Tile[${this.lij}] Convex hull point ${T} outside of plane ${ha}`);c.internalAssert(U(ha,Z[0],Z[1],Z[2]),`Tile[${this.lij}] (${F}) bottom mid outside of plane ${ha}`);c.internalAssert(U(ha,fa[0],fa[1],fa[2]),`Tile[${this.lij}] (${F}) top mid outside of plane ${ha}`)}c.internalAssert(da,"Not all convex hull points are inside  convex hull polyhedron");
c.internalAssert(K(Z[0],Z[1],Z[2]),`Tile[${this.lij}] (${F}) bottom mid outside of bounding sphere`);c.internalAssert(K(fa[0],fa[1],fa[2]),`Tile[${this.lij}] (${F}) top mid outside of bounding sphere`);for(U=0;8>U;++U)fa=3*U,fa=K(D[fa],D[fa+1],D[fa+2]),c.internalAssert(fa,`Tile[${this.lij}] Convex hull point ${U} outside of bounding sphere`);for(K=0;6>K;++K)for(U=0;8>U;++U)fa=3*U,-1<=ba(K,D[fa],D[fa+1],D[fa+2])||console.error(`Tile[${this.lij}] Convex hull point ${U} outside of plane ${K}`);({extentInRadians:K}=
this);K=Math.round(Math.max(K[2]-K[0],K[3]-K[1])*C);({renderData:U}=this);if(U){var {geometry:ia,geometryState:Y,localOrigin:ea}=U;if(U=ia.vertexAttributes?.position){fa=k.create();Z=ia.numVerticesPerSide-2;var {indices:ka,indexCount:ja,edgeVerticesStartIndex:X,poleVerticesStartIndex:aa}=ia;if(ka)for(F=new Set,da=0;da<ja;++da){const qa=ka[da];if(F.has(qa))continue;F.add(qa);const sa=qa<aa,xa=qa>=X;let ta=!1;ha=-1;if(xa)for(T=X,S=0;4>S;++S){var pa=Y.edgeResolutions[S];if(qa===T||qa===T+pa-1){ta=!0;
break}T+=pa;if(qa<T){ha=S;break}}ha=xa?Y.edgePeerNeighbors[ha]:null;const Ba=xa&&ha&&0<x.compareTilesByLij(this,ha);U.getVec(qa,B);n.add(fa,B,ea);ha=n.len(fa)-C;T=0;S=!1;pa=H-ha;const Ia=ha-E,Ca=1<pa,Ha=1<Ia;var la=Ca||Ha;const Ga=()=>{const Aa=xa&&!ta;return`Tile[${this.lij}].vertex[${qa}]:${sa?"internal":Aa?"edge":ta?"corner":"pole"}`+(Ca?"(below)":Ha?"(above)":"")+(Ba?"(Neighbor)":"")};var na=n.dist(fa,A);na>=z+0&&(na-=z,la||(console.error(`${Ga()} is out of the bounding sphere by ${na.toFixed(0)} / ${z.toFixed(0)}`+
"[tol\x3d0]"+` h=${ha.toFixed(0)} / [${H.toFixed(0)}..${E.toFixed(0)}] (${(na/z).toFixed(0)})`),S=!0));for(la=0;6>la;++la)if(!(-1<=ba(la,fa[0],fa[1],fa[2]))){na=ba(la,fa[0],fa[1],fa[2]);const Aa=qa%Z,Ja=(qa-Aa)/Z;0===la&&pa||5===la&&Ia||(console.error(`${Ga()} (${Aa},${Ja})|${Z}] is out of the bounding trapezoid plane ${la}`+` h=${Math.round(ha)} / [${Math.round(H)}..${Math.round(E)}] dist=${Math.round(na)}`+` radii = ${Math.round(z)}/${Math.round(G)}} : maxL = ${K}`),++T)}if(S||0<T)break}}}}}get convexHull(){return this._convexHull}}
const m=[128,64,64,32,16,8,8,4],q=(B,z,A,C)=>{const H=Math.sin(z),E=Math.cos(A);A=Math.sin(A);B[0]=C*E*Math.cos(z);B[1]=C*E*H;B[2]=C*A},r=[0,0,1],v=k.create(),y=k.create();a.SphericalPatch=t;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/projection/lonLatToSphericalPCPF":function(){define(["exports"],function(a){a.lonLatToSphericalPCPF=function(b,n,k,p){const h=Math.cos(k);b[0]=Math.cos(n)*h*p;b[1]=Math.sin(n)*h*p;b[2]=Math.sin(k)*p};Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/views/3d/terrain/SplitLimits":function(){define("exports ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass".split(" "),function(a,b,n,k,p,h,e,g){a.SplitLimits=class extends n{constructor(){super(...arguments);this.angledSplitBias=this.maxLod=this.relativeHeightLimit=this.relativeWidthLimit=this.fovY=this.fovX=0;
this.aboveGround=!0}};b.__decorate([k.property()],a.SplitLimits.prototype,"fovX",void 0);b.__decorate([k.property()],a.SplitLimits.prototype,"fovY",void 0);b.__decorate([k.property()],a.SplitLimits.prototype,"relativeWidthLimit",void 0);b.__decorate([k.property()],a.SplitLimits.prototype,"relativeHeightLimit",void 0);b.__decorate([k.property()],a.SplitLimits.prototype,"maxLod",void 0);b.__decorate([k.property()],a.SplitLimits.prototype,"angledSplitBias",void 0);b.__decorate([k.property()],a.SplitLimits.prototype,
"aboveGround",void 0);b.__decorate([k.property()],a.SplitLimits.prototype,"frustum",void 0);a.SplitLimits=b.__decorate([g.subclass("esri.views.3d.terrain.SplitLimits")],a.SplitLimits);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/TerrainRenderer":function(){define("exports ../../../chunks/tslib.es6 ../../../Color ../../../core/has ../../../core/maybe ../../../core/MemCachePool ../../../core/ObjectPool ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ../../../core/libs/gl-matrix-2/factories/mat4f64 ../../../chunks/vec32 ../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../core/libs/gl-matrix-2/factories/vec4f64 ../../../geometry/support/aaBoundingBox ../../../geometry/support/buffer/BufferView ../../ViewingMode ./interfaces ./LayerClass ./OverlayContent ./OverlayRenderer ./PatchRenderData ./RenderOrder ./TerrainAttributesCache ./terrainUtils ./TileRenderer ./TileUpdate ./tileUtils ./TransparencyMode ../webgl-engine/collections/Component/ComponentIntersectionData ../webgl-engine/core/shaderLibrary/ShaderOutput ../webgl-engine/core/shaderLibrary/terrain/TileBlendInput ../webgl-engine/effects/RenderPlugin ../webgl-engine/lib/Attribute ../webgl-engine/lib/basicInterfaces ../webgl-engine/lib/glUtil3D ../webgl-engine/lib/Intersector ../webgl-engine/lib/IntersectorInterfaces ../webgl-engine/lib/Material ../webgl-engine/lib/RayIntersections ../webgl-engine/lib/RenderSlot ../webgl-engine/lib/screenSizePerspectiveUtils ../webgl-engine/lib/VertexAttribute ../webgl-engine/lib/verticalOffsetUtils ../webgl-engine/materials/DrawParameters ../../../chunks/Terrain.glsl ../webgl-engine/shaders/TerrainTechnique ../webgl-engine/shaders/TerrainTechniqueConfiguration ../../webgl/enums".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w,x,u,t,m,q,r,v,y,B,z,A,C,H,E,F,G,D,I,J,N,M,Q,O,K,L,P,R,W,V,ba,U,da,fa,ha,T,S,Z,ia){const Y=m.create();a.TerrainRenderer=class extends Q.SyncRenderPlugin{get _isGlobal(){return this._stage.viewingMode===r.ViewingMode.Global}get _techniques(){return this._context.techniques}get _rctx(){return this._context.renderContext.rctx}constructor(aa,pa,la,na,qa){super({});this._overlayRenderer=aa;this._stage=pa;this._allTiles=la;this._ellipsoidRadius=na;this.type=R.IntersectorType.TERRAIN;
this.isGround=!0;this._tileSize=256;this._passParameters=new T.TerrainPassParameters;this._drawParameters=new ha.DrawParameters;this._renderDataPool=new e(A.PatchRenderData);this._visiblePatchesByOrigin=new Map;this._allPatchesByOrigin=new Map;this._patchSortingDirty=this._patchesByOriginDirty=!0;this._tileIterator=new D.IteratorPreorder;this._inViewshed=this._castShadows=!1;this._tileRenderer=this._emptyTex=null;this._stencilEnabledLayerExtents=[];this._numOriginsRendered=this._numTilesCulled=this._numTilesRendered=
0;this.renderOccludedFlags=W.RenderOccludedFlag.Occlude;this.produces=new Map([[ba.RenderSlot.OPAQUE_TERRAIN,()=>this._produces()&&this.transparency===I.TransparencyMode.Opaque],[ba.RenderSlot.TRANSPARENT_TERRAIN,()=>this._produces()&&(this.transparency===I.TransparencyMode.Transparent||this.transparency===I.TransparencyMode.InvisibleWithDraped)],[ba.RenderSlot.OCCLUDED_TERRAIN,()=>this._produces()]]);this._configuration=new Z.TerrainTechniqueConfiguration(pa.viewingMode===r.ViewingMode.Global);this._tileTextureCache=
new h.MemCachePool((sa,xa)=>qa.newCache(sa,xa),"TileTexture");this.tileGeometryCache=new H.TerrainAttributesCache(qa)}normalizeCtorArgs(){return{}}initialize(){this._stage.addRenderPlugin(this);this.addHandles(g.watch(()=>this._overlayRenderer.rendersOccludedDraped,aa=>{this.renderOccludedFlags=aa?z.overlayRenderOccludedFlag:W.RenderOccludedFlag.Occlude;this.setNeedsRender()},g.sync))}destroy(){this._stage.removeRenderPlugin(this);this._tileTextureCache.destroy();this.tileGeometryCache.destroy()}_produces(){return this.visible&&
!!this._rootTiles&&!this.renderingDisabled}consumes(){return this._overlayRenderer.hasWater?Q.ConsumesDepth:Q.ConsumesNone}set renderingDisabled(aa){this._set("renderingDisabled",!!aa);this.setDirty()}set visible(aa){this._set("visible",!!aa);this.setDirty()}updateHeading(aa){this._tileRenderer?.updateHeading(aa)}set transparency(aa){this._configuration.transparencyMode!==aa&&(this._configuration.transparencyMode=aa,this.setNeedsRender())}get transparency(){return this._configuration.transparencyMode}get renderPatchBorders(){return this._configuration.tileBorders}set renderPatchBorders(aa){this._configuration.tileBorders!==
aa&&(this._configuration.tileBorders=aa,this.setNeedsRender(),this.notifyChange("renderPatchBorders"))}get visualizeNormals(){return this._configuration.visualizeNormals}set visualizeNormals(aa){this._configuration.visualizeNormals!==aa&&(this._configuration.visualizeNormals=aa,this.setNeedsRender(),this.notifyChange("visualizeNormals"))}get cullBackFaces(){return this._configuration.backfaceCullingEnabled}set cullBackFaces(aa){this._configuration.backfaceCullingEnabled!==aa&&(this._configuration.backfaceCullingEnabled=
aa,this.notifyChange("cullBackFaces"),this.setNeedsRender())}set renderOrder(aa){this._set("renderOrder",aa);this._setSortingDirty()}get layerUid(){return fa.terrainId}get slicePlaneEnabled(){return this._configuration.hasSlicePlane}set slicePlaneEnabled(aa){this._configuration.hasSlicePlane!==aa&&(this._configuration.hasSlicePlane=aa,this.setNeedsRender())}set textureFadingEnabled(aa){this._configuration.textureFadingEnabled!==aa&&(this._configuration.textureFadingEnabled=aa,this.setNeedsRender())}set pbrMode(aa){this._configuration.pbrMode!==
aa&&(this._configuration.pbrMode=aa,this.setNeedsRender())}setDebugScreenSizePerspective(aa){this._configuration.screenSizePerspective!==aa&&(this._configuration.screenSizePerspective=aa,this.setNeedsRender())}setRootTiles(aa){this._rootTiles=aa;this.setDirty()}setStencilEnabledLayerExtents(aa){this._stencilEnabledLayerExtents=aa;this._setSortingDirty()}setTileSize(aa){this._tileSize=aa;null!=this._tileRenderer&&(this._tileRenderer.tileSize=aa);this.setDirty()}_ensureRenderData(aa){aa.renderData||
(aa.renderData=this._renderDataPool.acquire(),aa.renderData.init(aa,this._getLocalOriginOfTile(aa)))}loadTile(aa){this._ensureRenderData(aa);this.updateTileGeometryState(aa);this.reuseTextureFromParent(aa)||this.updateTileTexture(aa,G.TileUpdate.TEXTURE_FADING)}reuseTextureFromParent(aa){const pa=aa.parent;if(!pa)return!1;const la=t.fromValues(aa.lij[2]&1?.5:0,aa.lij[1]&1?0:.5,.5,.5);return pa.renderData?.reuseTexture(aa.renderData,la)??!1}updateTileTexture(aa,pa){null!=this._tileRenderer&&(this._tileRenderer.updateTileTexture(aa,
pa===G.TileUpdate.TEXTURE_FADING?v.TextureUpdate.FADING:v.TextureUpdate.UNFADED),this.setNeedsRender(),aa.resetPendingUpdate(pa))}updateTileGeometryState(aa){for(const pa of aa.layerInfo[y.LayerClass.ELEVATION])pa.pendingUpdates&=~G.TileUpdate.GEOMETRY;aa.resetPendingUpdate(G.TileUpdate.GEOMETRY);(aa=aa.renderData.updateGeometryState())&&this.setDirty();return aa}updateGeometryIfNeeded(aa){aa.loaded&&aa.renderData.updateGeometryIfNeeded(this._rctx)}unloadTile(aa){const pa=aa.renderData;pa&&(pa.releaseGeometry(),
this._renderDataPool.release(pa),pa.clear(),aa.renderData=null,aa.setMemoryDirty(),this.setDirty())}_getLocalOriginOfTile(aa){const pa=Math.max(0,7*Math.floor((aa.level-3)/7));if(this._isGlobal&&0===pa)return u.ZEROS;for(;aa.parent&&aa.level>pa;)aa=aa.parent;return aa.centerAtSeaLevel}getStats(){return{numTilesRendered:this._numTilesRendered,numTilesCulled:this._numTilesCulled,numOriginsRendered:this._numOriginsRendered}}set wireframe(aa){this._get("wireframe")!==aa&&(this._set("wireframe",aa),this.setNeedsRender())}setDirty(aa=
K.RenderRequestType.UPDATE){this._patchesByOriginDirty=!0;this._context.requestRender(aa)}_setSortingDirty(aa=K.RenderRequestType.UPDATE){this._patchSortingDirty=!0;this._context.requestRender(aa)}setNeedsRender(aa=K.RenderRequestType.UPDATE){this._context.requestRender(aa)}initializeRenderContext(aa){this._context=aa;this._tileRenderer=new F.TileRenderer(this._rctx,this._tileSize,this._techniques,this._tileTextureCache);this.updateTileBackground();this._emptyTex=L.createEmptyTexture(this._rctx)}uninitializeRenderContext(){this._emptyTex=
p.disposeMaybe(this._emptyTex);this._tileRenderer=p.disposeMaybe(this._tileRenderer)}intersect(aa,pa,la,na){if(!(!this._rootTiles||aa.options.selectOpaqueTerrainOnly&&aa.options.selectionMode&&this.transparency!==I.TransparencyMode.Opaque)){var qa=ea,sa=ka;x.subtract(qa,na,la);x.set(sa,1/qa[0],1/qa[1],1/qa[2]);var xa=aa.results.min,ta=aa.results.max,Ba=aa.results.ground,Ia=aa.options.store===R.StoreResults.MIN,Ca=!!aa.results.ground.target,Ha=fa.getVerticalOffsetTerrain(aa.verticalOffset),Ga=aa.tolerance,
Aa,Ja=Ia&&null!=xa.dist?xa.dist:Infinity,Sa=aa.options,$a=Sa.normalRequired||!Sa.backfacesTerrain,Wa=new V.MeshIntersectionOptions(!1,$a),Ta=La=>{var Va=La.renderData;if(Va?.vao){var ma=Va.geometry;m.set(Y,ma.boundingBox);var za=Va.localOrigin;null!=Ha&&(Ha.localOrigin=za,Ha.applyToAabb(Y));ja[0]=la[0]-za[0];ja[1]=la[1]-za[1];ja[2]=la[2]-za[2];if(V.intersectAabbInvDirBefore(Y,ja,sa,Ga,Ja)){var Na=(cb,ib,nb)=>{cb.set(this.type,La,ib,nb,w.IDENTITY);Ja=Ia&&null!=xa.dist?xa.dist:Infinity};Va=(cb,ib,nb)=>
{(!$a||null!=nb)&&0<=cb&&(Sa.backfacesTerrain||0>x.dot(nb,qa))&&(Sa.invisibleTerrain||!Sa.selectionMode||null==pa||pa(la,na,cb))&&((null==Ba.dist||cb<Ba.dist)&&Na(Ba,cb,nb),Sa.isFiltered||(Sa.store===R.StoreResults.ALL&&(null==Aa?(Aa=P.newIntersectorResult(aa.ray),Na(Aa,cb,nb),aa.results.all.push(Aa)):cb<Aa.dist&&Na(Aa,cb,nb)),(null==xa.dist||cb<xa.dist)&&Na(xa,cb,nb),Sa.store!==R.StoreResults.MIN&&(null==ta.dist||cb>ta.dist)&&Na(ta,cb,nb)))};var Ra=X;x.subtract(Ra,na,za);var {indices:Pa,indexCount:ca}=
ma;ma=ma.vertexAttributes;za=ma.getField(da.VertexAttribute.POSITION,q.BufferViewVec3f);ma=new O.Vertices(za.typedBuffer,3,ma.stride/4);za=ca/3;if(!Ha&&za>J.componentMinimalSizeForIntersectionData){const cb=La.renderData;null==cb.intersectionData&&(cb.intersectionData=new J.ComponentIntersectionData(Pa,0,za,ma));cb.intersectionData.intersectRay(ja,Ra,Wa,Va)}else V.intersectTriangles(ja,Ra,0,za,Pa,ma,Ha,Wa,Va)}}},Da=this._rootTiles;null!=Da&&(()=>{const La=this._tileIterator;La.reset(Da);const Va=
aa.options.invisibleTerrain;for(let ma=La.next();ma;ma=La.next())!(ma.visible||Va&&ma.intersectsClippingArea)||null==Ha&&!ma.intersectsRay(la,qa,Ga,Ja)||Ca&&this._useStencilForTile(ma)?La.skipSubtree():Ta(ma)})()}}processScaleRangeQueries(aa,pa){if(!pa.done)for(this._updatePatchGroups();aa.updating&&!pa.done;){aa.prepare();for(const la of this._visiblePatchesByOrigin.values())for(const na of la)null!=na.renderData?.textureReference&&aa.queriesForTile(na);aa.process();pa.madeProgress()}}acquireTechniques(aa){var pa=
!!k("enable-feature:terrain-shadows")&&aa.bind.shadowMap.enabled;pa!==this._castShadows&&(this._castShadows=pa,this._patchesByOriginDirty=!0);pa=aa.bind.viewshedEnabled;this._inViewshed!==pa&&(this._inViewshed=pa,this._patchesByOriginDirty=!0);if(aa.bind.slot===ba.RenderSlot.OCCLUDED_TERRAIN){if(0===(aa.renderOccludedMask&z.overlayRenderOccludedFlag))return null}else if(aa.bind.slot!==(this.transparency===I.TransparencyMode.Opaque?ba.RenderSlot.OPAQUE_TERRAIN:ba.RenderSlot.TRANSPARENT_TERRAIN))return null;
if(this.transparency===I.TransparencyMode.Invisible)return null;this._configuration.screenSpaceReflections=this._configuration.cloudReflections=this._configuration.receiveShadows=this._configuration.receiveAmbientOcclusion=!1;this._configuration.overlayMode=this._overlayRenderer.mode;switch(aa.output){case N.ShaderOutput.Color:case N.ShaderOutput.ColorEmission:return this._configuration.screenSpaceReflections=null!=aa.bind.ssr.lastFrameColor,this._configuration.cloudReflections=null!=aa.bind.clouds.data,
this._configuration.receiveShadows=aa.bind.shadowMap.ready,this._configuration.receiveAmbientOcclusion=null!=aa.bind.ssao,this._acquireTechnique(aa.output,aa.bind.slot===ba.RenderSlot.OCCLUDED_TERRAIN);case N.ShaderOutput.Shadow:case N.ShaderOutput.ShadowExcludeHighlight:return this._castShadows?this._acquireTechnique(N.ShaderOutput.Shadow,!1):null;case N.ShaderOutput.ViewshedShadow:return this._inViewshed?this._acquireTechnique(N.ShaderOutput.ViewshedShadow,!1):null;case N.ShaderOutput.Depth:case N.ShaderOutput.Normal:return this._acquireTechnique(aa.output,
!1);case N.ShaderOutput.ObjectAndLayerIdColor:return this._acquireTechnique(N.ShaderOutput.ObjectAndLayerIdColor,!1);case N.ShaderOutput.Highlight:return this._overlayRenderer.hasHighlights?this._acquireTechnique(N.ShaderOutput.Highlight,!1):null}return null}render(aa,pa){this._updatePatchGroups();pa.useStencil=!1;switch(aa.output){case N.ShaderOutput.Color:case N.ShaderOutput.ColorEmission:this._renderMaterialPass(aa,pa,aa.bind.slot===ba.RenderSlot.OCCLUDED_TERRAIN?B.OverlayContent.Occluded:B.OverlayContent.Color);
break;case N.ShaderOutput.Depth:case N.ShaderOutput.Normal:this._renderAuxiliaryPass(aa,pa,B.OverlayContent.Color,this._visiblePatchesByOrigin);break;case N.ShaderOutput.Highlight:this._overlayRenderer.hasHighlights&&this._overlayRenderer.renders(B.OverlayContent.Highlight)&&this._renderAuxiliaryPass(aa,pa,B.OverlayContent.Highlight,this._visiblePatchesByOrigin);break;case N.ShaderOutput.Shadow:case N.ShaderOutput.ShadowExcludeHighlight:case N.ShaderOutput.ViewshedShadow:this._renderAuxiliaryPass(aa,
pa,null,this._allPatchesByOrigin);break;case N.ShaderOutput.ObjectAndLayerIdColor:this._renderAuxiliaryPass(aa,pa,B.OverlayContent.ObjectAndLayerIdColor,this._visiblePatchesByOrigin)}}updateTileBackground(aa){if(null!=this._tileRenderer){var pa=this._tileRenderer;if(null!=aa){aa=n.toUnitRGBA(aa);var la=u.fromValues(aa[0]||0,aa[1]||0,aa[2]||0)}pa.setBackground(la);this._allTiles.forAll(na=>pa.updateTileTexture(na,v.TextureUpdate.FADING));this._configuration.tileBlendInput=pa.backgroundIsGrid?M.TileBlendInput.GridComposite:
null!=pa.backgroundColor?M.TileBlendInput.ColorComposite:M.TileBlendInput.LayerOnly;this.setNeedsRender()}}_updatePatchGroups(){this._patchesByOriginDirty&&(this._rebuildPatchGroups(),this._patchesByOriginDirty=!1,this._patchSortingDirty=!0);if(this._patchSortingDirty&&this.renderOrder!==C.RenderOrder.NONE){const aa=Array.from(this._visiblePatchesByOrigin.values()),pa=this._stencilEnabledLayerExtents;for(const la of aa)D.sortTiles(this.renderOrder,la,pa);aa.sort((la,na)=>D.compareTiles(la[0],na[0],
this.renderOrder));this._visiblePatchesByOrigin=new Map(aa.map(la=>[la[0].renderData.localOrigin,la]));this._patchSortingDirty=!1}}_rebuildPatchGroups(){const aa=this._rootTiles;if(null!=aa){aa[0]?.surface.checkAllTilesWaterproofness();this._visiblePatchesByOrigin.clear();this._allPatchesByOrigin.clear();for(const pa of aa)this._rebuildPatchGroupsForRootTile(pa)}}_rebuildPatchGroupsForRootTile(aa){const pa=this._tileIterator;for(pa.resetOne(aa);!pa.done;){aa=pa.next();var la=aa.renderData;if(la){la=
la.localOrigin;if(this._castShadows||this._inViewshed){var na=this._allPatchesByOrigin.get(la);na||(na=[],this._allPatchesByOrigin.set(la,na));na.push(aa)}aa.visible?(na=this._visiblePatchesByOrigin.get(la),na||(na=[],this._visiblePatchesByOrigin.set(la,na)),na.push(aa),pa.skipSubtree()):(this._numTilesCulled++,pa.skipSubtree())}else this._numTilesCulled++}}_useStencilForTile(aa){for(const pa of this._stencilEnabledLayerExtents)if(aa.intersectsExtent(pa))return!0;return!1}_renderAuxiliaryPass(aa,
pa,la,na){const qa=aa.rctx;this._passParameters.overlayContent=la;qa.bindTechnique(pa,aa.bind,this._passParameters);const sa=0<this._stencilEnabledLayerExtents.length;na.forEach(xa=>{this._drawParameters.origin=xa[0].renderData.localOrigin;pa.program.bindDraw(aa.bind,this._passParameters,this._drawParameters);for(let ta=0;ta<xa.length;ta++)this._renderPatch(aa,pa,xa[ta],ia.PrimitiveType.TRIANGLES,sa,la)});aa.rctx.bindVAO(null)}_renderMaterialPass(aa,pa,la){var {rctx:na}=aa;this._passParameters.overlayContent=
la;na.bindTechnique(pa,aa.bind,this._passParameters);this._numOriginsRendered=this._numTilesCulled=this._numTilesRendered=0;var qa=aa.bind.camera;na=pa.program;this._configuration.screenSizePerspective&&this.pointsOfInterest&&U.getSettings(this._stage.viewingMode,this._ellipsoidRadius).update({distance:this.pointsOfInterest.centerOnSurfaceFrequent.distance,fovY:qa.fovY});qa=0<this._stencilEnabledLayerExtents.length;const sa=la===B.OverlayContent.Occluded;sa&&(na.bindTexture("tex",this._emptyTex),
na.setUniform3fv("textureOpacities",u.ZEROS),na.setUniform4fv("texOffsetAndScale",t.ZEROS));var xa=null!=this._tileRenderer?.backgroundColor?this._tileRenderer.backgroundColor:u.ZEROS;this._configuration.tileBlendInput===M.TileBlendInput.ColorComposite&&na.setUniform3fv("backgroundColor",xa);xa=this.wireframe?ia.PrimitiveType.LINES:ia.PrimitiveType.TRIANGLES;this._configuration.textureFadingEnabled&&na.bindTexture("texNext",this._emptyTex);var ta=this._visiblePatchesByOrigin;for(const Ba of ta.values()){this._drawParameters.origin=
Ba[0].renderData.localOrigin;pa.program.bindDraw(aa.bind,this._passParameters,this._drawParameters);this._numOriginsRendered++;for(const Ia of Ba){ta=Ia.renderData;const Ca=ta.textureReference;if(null!=Ca){if(!sa){na.setUniform4fv("texOffsetAndScale",Ca.offsetAndScale);na.bindTexture("tex",Ca.texture.texture);const Ha=ta.textureFadeFactor,Ga=1>Ha?ta.nextTextureReference:null;this._configuration.textureFadingEnabled&&null!=Ga&&1>Ha?(na.setUniform1f("fadeFactor",Ha),na.setUniform4fv("nextTexOffsetAndScale",
Ga.offsetAndScale),na.setUniform3fv("nextTexOpacities",Ga.opacities),na.bindTexture("texNext",Ga.texture.texture)):na.setUniform1f("fadeFactor",1);ta.textureIsFading&&this.setNeedsRender();na.setUniform3fv("textureOpacities",Ca.opacities)}this._renderPatch(aa,pa,Ia,xa,qa,la);Ia.renderOrder=this._numTilesRendered;this._numTilesRendered++}}}aa.rctx.bindVAO(null)}_renderPatch(aa,pa,la,na,qa,sa){const xa=la.renderData,ta=xa.vao,Ba=ta?.indexBuffer;if(ta&&null!=Ba){var Ia=pa.program;null==sa||this._overlayRenderer.isEmpty||
this._bindOverlayPatchData(Ia,xa.overlay);qa&&(pa.useStencil=this._useStencilForTile(la),aa.rctx.setPipelineState(pa.getPipeline()));pa=xa.geometry.indexCount;aa.rctx.bindVAO(ta);Ia.assertCompatibleVertexAttributeLocations(ta);aa.rctx.drawElements(na,pa,Ba.indexType,0)}else E.enableTerrainInternalChecks&&console.error("Rendered tile with no indices: ",la.lij," : ",xa)}_bindOverlayPatchData(aa,pa){aa.setUniform4fv("overlayTexOffset",pa.offsets);aa.setUniform4fv("overlayTexScale",pa.scales)}_acquireTechnique(aa,
pa){this._configuration.output=aa;this._configuration.renderOccluded=pa;return this._techniques.acquire(S.TerrainTechnique,this._configuration)}get test(){}};b.__decorate([d.property({readOnly:!0})],a.TerrainRenderer.prototype,"_isGlobal",null);b.__decorate([d.property()],a.TerrainRenderer.prototype,"renderOccludedFlags",void 0);b.__decorate([d.property({value:!1})],a.TerrainRenderer.prototype,"renderingDisabled",null);b.__decorate([d.property({value:!0})],a.TerrainRenderer.prototype,"visible",null);
b.__decorate([d.property()],a.TerrainRenderer.prototype,"renderPatchBorders",null);b.__decorate([d.property()],a.TerrainRenderer.prototype,"visualizeNormals",null);b.__decorate([d.property()],a.TerrainRenderer.prototype,"cullBackFaces",null);b.__decorate([d.property({value:C.RenderOrder.FRONT_TO_BACK})],a.TerrainRenderer.prototype,"renderOrder",null);b.__decorate([d.property()],a.TerrainRenderer.prototype,"wireframe",null);a.TerrainRenderer=b.__decorate([l.subclass("esri.views.3d.terrain.TerrainRenderer")],
a.TerrainRenderer);const ea=u.create(),ka=u.create(),ja=u.create(),X=u.create();Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/TerrainAttributesCache":function(){define(["exports","../../../core/MemCachePool","./TerrainAttributes"],function(a,b,n){class k{constructor(p){this._storage=new b.MemCachePool((h,e)=>p.newCache(h,e),"TileGeometry")}acquire(p){p=4*Math.ceil(p/4);const h=this._storage,e=p.toString(),g=h.pop(e);if(g)return g;const d=n.terrainAttributesLayout.createBuffer(p);
d.release=()=>h.put(e,d);return d}clear(){this._storage.clear()}destroy(){this._storage.destroy()}}a.TerrainAttributesCache=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/TerrainAttributes":function(){define(["exports","../support/buffer/InterleavedLayout","../webgl-engine/lib/VertexAttribute"],function(a,b,n){b=b.newLayout().vec3f(n.VertexAttribute.POSITION).vec2i16(n.VertexAttribute.UV0).vec2i16(n.VertexAttribute.NORMALCOMPRESSED,{glNormalized:!0});a.terrainAttributesLayout=
b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/TileRenderer":function(){define("exports ../../../core/has ../../../core/maybe ../../../core/libs/gl-matrix-2/math/vec2 ../../../core/libs/gl-matrix-2/factories/vec2f64 ../../../core/libs/gl-matrix-2/factories/vec4f64 ../../../layers/support/layerUtils ./BlendLayersTechnique ./interfaces ./LayerClass ./NeighborIndex ./TerrainData ./terrainUtils ./TextureFader ./TextureReference ./TileCompositor ./TileRenderInfo ./TileTexture ./TileUpdate ./tileUtils ../webgl-engine/core/shaderLibrary/output/BlendOptions ../webgl-engine/core/shaderLibrary/terrain/BlendLayersOutput ../webgl-engine/lib/glUtil3D ../../webgl/enums ../../webgl/Texture ../../webgl/TextureDescriptor".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w,x,u,t,m,q,r,v,y,B,z,A,C,H){function E(L,P,R){Q.layerIndex=P;Q.vtlNeighborInfos.clear();const W=L.layerInfo[f.LayerClass.MAP][P];k.set(Q.offset,0,0);Q.tile=L;Q.scale=1;Q.sourceLod=L.lij;Q.sourceLayerInfo=W;Q.isVTLBackground=R;if(W.data)return R&&L.forEachLoadedNeighbor((U,da)=>{if(U.level===L.level){var fa=U.layerInfo[f.LayerClass.MAP][P];if(w.isVectorTilePerLayerInfo(fa)&&W.data!==fa.data){var ha=Q.vtlNeighborInfos.pushNew();ha.offset=K[da];ha.sourceLod=U.lij;ha.sourceLayerInfo=
fa}}}),Q;const V=W.upsampleInfo,ba=V?.tile?.layerInfo[f.LayerClass.MAP][P];return ba?(Q.tile=V.tile,k.copy(Q.offset,V.offset),Q.scale=V.scale,Q.sourceLod=V.tile.lij,Q.sourceLayerInfo=ba,Q):R?Q:null}function F(L){L=L.sourceLayerInfo.data;return L.source?"nearest"===L.interpolation:!1}function G(L){let P="normal"!==L.blendMode;e.isGroupLayer(L.parent)&&(P=G(L.parent)||P);return P}function D(L,P){e.isGroupLayer(L.parent)&&D(L.parent,P);const R=L.uid;if(null!=R&&""!==R){const W=N.get(R);W?W.start=P:N.set(R,
new I(P,P,L.blendMode,L.opacity,B.BlendLayersOutput.Composite,1))}}class I{constructor(L,P,R,W,V,ba){this.start=L;this.end=P;this.blendMode=R;this.opacity=W;this.output=V;this.baseOpacity=ba}}class J{constructor(L,P,R,W){this._rctx=L;this.tileSize=P;this._techniques=R;this._cache=W;this._passParameters=new g.BlendLayersPassParameters;this._backgroundColor=this._backgroundTexture=null;this._backgroundDirty=!1;this._maxAnisotropy=this._rctx.parameters.maxMaxAnisotropy;this._compositor=new t.TileCompositor(this._rctx,
this._techniques);this._ensureBackgroundTexture(this.tileSize)}dispose(){this._compositor=n.disposeMaybe(this._compositor);this._backgroundTexture=n.releaseMaybe(this._backgroundTexture)}get backgroundIsGrid(){return null==this._backgroundColor}get backgroundColor(){return this._backgroundColor}updateHeading(L){this._compositor?.updateHeading(L)}updateTileTexture(L,P){if(L.renderData){var R=L.surface,W=R.baseOpacity,V=0,ba=0,U=this.tileSize,da=!1,fa=!1,ha=R.view.state.contentPixelRatio,T=!1;N.clear();
M.length=0;for(var S=L.layerInfo[f.LayerClass.MAP],Z=0,ia=null;Z<S.length;Z++){const ja=R.layerViewByIndex(Z,f.LayerClass.MAP),X=ja.layer;var Y=!v.fallsWithinLayerView(L,ja),ea=X.opacity;const aa=ja.fullOpacity;fa=fa||e.isBaseLayer(X);if(w.isBlendableLayerView(ja)){var ka="normal"!==ja.layer.blendMode;if(e.isGroupLayer(X.parent)){const pa=X.parent.uid;null!=pa&&""!==pa&&(ka=G(X.parent)||ka)}ka&&(T=ka,da=!1)}if(!Y&&0!==ea||T){if(++ba,Y=w.isVectorTileLayerView(ja),ea=E(L,Z,Y))S[Z].pendingUpdates&=~(r.TileUpdate.TEXTURE_NOFADING&
r.TileUpdate.TEXTURE_FADING),e.isGroupLayer(X.parent)&&(ka=X.parent.uid,null!=ka&&""!==ka&&D(X.parent,Z)),Y?U=Math.max(U,this.tileSize*ha):1===W&&1===aa&&(ja.isOpaque||this._dataToTexture(ea)&&ea.sourceLayerInfo.data.descriptor.isOpaque)&&(da=!0),++V,null===ia&&(ia=Z)}else S[Z].pendingUpdates&=~(r.TileUpdate.TEXTURE_NOFADING&r.TileUpdate.TEXTURE_FADING)}W=U/this.tileSize;R=this._ensureBackgroundTexture(this.tileSize);0===V||null===ia?(V=L.renderData,P=P===d.TextureUpdate.FADING&&null!=V.textureReference&&
(L.surface.view.layerViewManager.updating||0<ba)?x.ActivationTime.Delayed:x.ActivationTime.Immediate,V.setTextureReference(new u.TextureReference(R,d.TextureUpdate.FADING,O,L.surface.baseOpacity,0,1),P)):1===V&&!T&&this._useLayerTexture(L,ia)||this._composeLayers(L,P,Z-1,fa,U,W,!da||T,N,T)}}_ensureBackgroundTexture(L){null==this._backgroundTexture&&(this._backgroundTexture=this._buildTexture(L,!1),this._backgroundDirty=!0);this._backgroundDirty&&(this._compositor.bind(L),this._passParameters.offset=
p.ZEROS,this._passParameters.scale=1,this._passParameters.opacity=1,this.backgroundColor&&(this._passParameters.backgroundColor=this.backgroundColor),this._compositor.drawBackground(this._passParameters,null!=this.backgroundColor),this._compositor.copyFBOToTexture(this._backgroundTexture),this._compositor.unbind(),this._backgroundDirty=!1);return this._backgroundTexture}_useLayerTexture(L,P){var R=L.surface.layerViewByIndex(P,f.LayerClass.MAP),W=e.isBaseLayer(R.layer);const V=W?L.surface.baseOpacity:
1;W=W?1:L.surface.baseOpacity;R=R.fullOpacity;P=E(L,P,!1);return this._dataToTexture(P)?(L.renderData.setTextureReference(new u.TextureReference(P.sourceLayerInfo.data,d.TextureUpdate.FADING,h.fromValues(P.offset[0],P.offset[1],P.scale,P.scale),V,W,R)),!0):!1}_composeLayers(L,P,R,W,V,ba,U,da,fa){this._compositor.ensureBuffer(V);const ha=L.surface.baseOpacity;let T=!1,S=A.TextureSamplingMode.LINEAR_MIPMAP_LINEAR,Z=!1,ia=0;for(let ja=R;0<=ja;ja--){R=L.surface.layerViewByIndex(ja,f.LayerClass.MAP);var Y=
R.layer,ea=w.isVectorTileLayerView(R);ea=E(L,ja,ea);const X=Y.opacity,aa=!v.fallsWithinLayerView(L,R);if(!ea||(0===X||aa)&&!fa)continue;const pa=!e.isBaseLayer(Y)&&!T;pa&&(T=!0);let la=!1;da.forEach(na=>{na.start===ja&&(na.output=W?B.BlendLayersOutput.Composite:U&&pa?this.backgroundIsGrid?B.BlendLayersOutput.GridComposite:B.BlendLayersOutput.ColorComposite:B.BlendLayersOutput.Composite,na.baseOpacity=pa?ha:1,M.push(na),this._compositor.openGroup(V),la=!0)});Y=0===ia;Y=la?B.BlendLayersOutput.GroupBackgroundComposite:
U&&Y?this.backgroundIsGrid?B.BlendLayersOutput.GridComposite:B.BlendLayersOutput.ColorComposite:B.BlendLayersOutput.Composite;R=y.blendModeFromString[w.isBlendableLayerView(R)?R.layer.blendMode:"normal"];this._passParameters.baseOpacity=pa&&!la&&1>ha?ha:1;this._passParameters.opacity=X;w.isVectorTileRenderInfo(ea)?Z=this._compositor.drawVectorData(this._passParameters,Y,V,R,ea,ba,this.tileSize,Z):w.isImageryTileRenderInfo(ea)?(this._compositor.drawRasterData(this._passParameters,Y,V,R,ea),F(ea)&&
(S=A.TextureSamplingMode.NEAREST)):this._dataToTexture(ea)&&(this._passParameters.texture=ea.sourceLayerInfo.data.texture,this._passParameters.offset=ea.offset,this._passParameters.scale=ea.scale,this._compositor.drawImageData(this._passParameters,Y,V,R));for(;0<M.length&&M[M.length-1].end===ja;)R=M.pop(),this._passParameters.baseOpacity=R.baseOpacity,this._passParameters.opacity=R.opacity,this._passParameters.offset=p.ZEROS,this._passParameters.scale=1,this._compositor.drawGroup(this._passParameters,
R.output,V,y.blendModeFromString[R.blendMode]);ia++}L=L.renderData;const ka=fa||T&&1>ha;fa=L.ensureTexture(V,ka,P,()=>this._buildTexture(V,ka,S));this._compositor.copyFBOToTexture(fa);this._compositor.unbind();L.setTextureReference(new u.TextureReference(fa,P,O,T?1:ha,0,1))}_dataToTexture(L){if(w.isImageSourceRenderInfo(L)){const P=L.sourceLayerInfo;P.data=this._buildTexture(P.data,!0);L.tile.setMemoryDirty()}return w.isTextureTileRenderInfo(L)}setBackground(L){this._backgroundColor!==L&&(this._backgroundColor=
L,this._backgroundDirty=!0)}_buildTexture(L,P,R=A.TextureSamplingMode.LINEAR_MIPMAP_LINEAR){if(null==L)return null;const W=new H.TextureDescriptor;W.wrapMode=A.TextureWrapMode.CLAMP_TO_EDGE;W.samplingMode=R;W.maxAnisotropy=this._maxAnisotropy;W.preMultiplyAlpha=!0;W.flipped=!0;W.hasMipmap=!0;P||(W.pixelFormat=A.PixelFormat.RGB);P=this._rctx;let V;if("number"===typeof L)W.width=W.height=L,V=this._buildTileTexture(W,L);else if(l.isImageWithType(L))W.isOpaque=L.isOpaque,W.isOpaque&&(W.pixelFormat=A.PixelFormat.RGB),
V=this._buildTileTexture(W,L.element.width,L.element);else try{W.width=L.width,W.height=L.height,V=this._buildTileTexture(W,L.width,L)}catch(ba){V=new q(z.createEmptyTexture(P)),console.warn("TileRenderer: failed to execute 'texImage2D', cross-origin image may not be loaded.")}L=P.bindTexture(V.texture,C.Texture.TEXTURE_UNIT_FOR_UPDATES);V.generateMipmap();P.bindTexture(L,C.Texture.TEXTURE_UNIT_FOR_UPDATES);return V}_buildTileTexture(L,P,R){return(P=this._cache.pop(`${P} ${L.pixelFormat}`))?(P.retain(),
P.texture.setData(R),P):new q(new C.Texture(this._rctx,L,R),this._cache)}get test(){}}const N=new Map,M=[],Q=new m.TileRenderInfo,O=h.fromValues(0,0,1,1),K=[];K[c.NeighborIndex.NORTH]=[0,-1];K[c.NeighborIndex.NORTH_EAST]=[-1,-1];K[c.NeighborIndex.EAST]=[-1,0];K[c.NeighborIndex.SOUTH_EAST]=[-1,1];K[c.NeighborIndex.SOUTH]=[0,1];K[c.NeighborIndex.SOUTH_WEST]=[1,1];K[c.NeighborIndex.WEST]=[1,0];K[c.NeighborIndex.NORTH_WEST]=[1,-1];a.GroupInfo=I;a.TileRenderer=J;Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/views/3d/terrain/BlendLayersTechnique":function(){define("require exports ../../../core/libs/gl-matrix-2/factories/vec3f64 ../webgl-engine/core/shaderLibrary/terrain/TileComposite.glsl ../../../chunks/BlendLayers.glsl ../webgl-engine/core/shaderTechnique/ReloadableShaderModule ../webgl-engine/core/shaderTechnique/ShaderTechnique".split(" "),function(a,b,n,k,p,h,e){class g extends k.TileCompositePassParameters{constructor(){super(...arguments);this.baseOpacity=this.opacity=
1;this.fboTexture=this.texture=null;this.backgroundColor=n.ZEROS}}class d extends e.ShaderTechnique{constructor(f,c,l){super(f,c,new h.ReloadableShaderModule(p.BlendLayers,()=>new Promise((w,x)=>a(["../webgl-engine/core/shaderLibrary/util/BlendLayers.glsl"],w,x))),l)}}b.BlendLayersPassParameters=g;b.BlendLayersTechnique=d;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/terrain/TileComposite.glsl":function(){define("exports ../../../../../../core/libs/gl-matrix-2/factories/vec2f64 ../../shaderModules/Float2PassUniform ../../shaderModules/FloatPassUniform ../../shaderModules/interfaces ../../../lib/VertexAttribute".split(" "),
function(a,b,n,k,p,h){class e extends p.NoParameters{constructor(){super(...arguments);this.scale=1;this.offset=b.ZEROS}}a.TileComposite=function(g){g.attributes.add(h.VertexAttribute.POSITION,"vec2");g.attributes.add(h.VertexAttribute.UV0,"vec2");g.varyings.add("uv","vec2");g.varyings.add("vuv","vec2");g.vertex.uniforms.add(new k.FloatPassUniform("scale",d=>d.scale),new n.Float2PassUniform("offset",d=>d.offset));g.vertex.main.add(p.glsl`gl_Position = vec4(position, 0.0, 1.0);
uv = uv0 * scale + offset;
vuv = uv0;`)};a.TileCompositePassParameters=e;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/BlendLayers.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderLibrary/terrain/BackgroundGrid.glsl ../views/3d/webgl-engine/core/shaderLibrary/terrain/BlendLayersOutput ../views/3d/webgl-engine/core/shaderLibrary/terrain/TileBackground.glsl ../views/3d/webgl-engine/core/shaderLibrary/terrain/TileComposite.glsl ../views/3d/webgl-engine/core/shaderModules/Float3PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform".split(" "),
function(a,b,n,k,p,h,e,g,d,f){function c(w){const x=new d.ShaderBuilder,u=x.fragment;x.include(p.TileComposite);if(w.background===a.BackgroundMode.Only)return(w=w.output===n.BlendLayersOutput.ColorComposite)?u.uniforms.add(new h.Float3PassUniform("backgroundColor",t=>t.backgroundColor)):u.include(b.BackgroundGrid),u.main.add(g.glsl`fragColor = vec4(${w?g.glsl`backgroundColor`:g.glsl`gridColor(uv)`}, 1.0);`),x;x.include(k.TileBackground,w);u.uniforms.add(new f.Texture2DPassUniform("tex",t=>t.texture),
new e.FloatPassUniform("opacity",t=>t.opacity));u.main.add(g.glsl`fragColor = blendLayers(uv, texture(tex, uv), opacity);`);return x}a.BackgroundMode=void 0;(function(w){w[w.BelowLayer=0]="BelowLayer";w[w.Only=1]="Only";w[w.COUNT=2]="COUNT"})(a.BackgroundMode||(a.BackgroundMode={}));const l=Object.freeze(Object.defineProperty({__proto__:null,get BackgroundMode(){return a.BackgroundMode},build:c},Symbol.toStringTag,{value:"Module"}));a.BlendLayers=l;a.build=c})},"esri/views/3d/webgl-engine/core/shaderLibrary/terrain/BlendLayersOutput":function(){define(["exports"],
function(a){a.BlendLayersOutput=void 0;var b=a.BlendLayersOutput||(a.BlendLayersOutput={});b[b.Composite=0]="Composite";b[b.ColorComposite=1]="ColorComposite";b[b.GridComposite=2]="GridComposite";b[b.GroupBackgroundComposite=3]="GroupBackgroundComposite";b[b.COUNT=4]="COUNT";Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/terrain/TileBackground.glsl":function(){define("exports ../../../../../../core/libs/gl-matrix-2/factories/vec3f64 ../output/BlendOptions ./BackgroundGrid.glsl ./BaseOpacityMode ./BlendLayersOutput ./PremultipliedAlphaSource ../util/BlendModes.glsl ../../shaderModules/Float3PassUniform ../../shaderModules/FloatPassUniform ../../shaderModules/interfaces ../../shaderModules/Texture2DPassUniform".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l){class w extends c.NoParameters{constructor(){super(...arguments);this.baseOpacity=1;this.backgroundColor=b.ZEROS;this.fboTexture=null}}a.TileBackground=function(x,u){const t=u.output===h.BlendLayersOutput.GridComposite,m=u.output===h.BlendLayersOutput.ColorComposite,q=u.output===h.BlendLayersOutput.GroupBackgroundComposite;var r=u.output===h.BlendLayersOutput.Composite;const v=u.baseOpacityMode===p.BaseOpacityMode.Required;x=x.fragment;v&&x.uniforms.add(new f.FloatPassUniform("baseOpacity",
z=>z.baseOpacity));t?x.include(k.BackgroundGrid):m?x.uniforms.add(new d.Float3PassUniform("backgroundColor",z=>z.backgroundColor)):r&&x.uniforms.add(new l.Texture2DPassUniform("fboColor",z=>z.fboTexture));const y=u.blendMode!==n.LayerBlendMode.Normal,B=u.premultipliedSource===e.PremultipliedAlphaSource.On;r=!y&&!B&&(r&&!v||q);x.include(g.BlendModes,u);x.code.add(c.glsl`
    vec4 getBackground(vec2 uv) {
      return ${v?c.glsl`baseOpacity *`:""} ${q?c.glsl`vec4(0.0, 0.0, 0.0, 0.0)`:m?c.glsl`vec4(backgroundColor, 1.0)`:t?c.glsl`vec4(gridColor(uv), 1.0)`:c.glsl`texelFetch(fboColor, ivec2(gl_FragCoord.xy), 0)`};
    }

    vec4 blendLayers(vec2 bgUV, vec4 colorLayer, float opacity) {
      ${y?c.glsl`
          vec3 cl = colorLayer.a == 0.0 ? colorLayer.rgb : colorLayer.rgb / colorLayer.a;
          vec4 bgColor = getBackground(bgUV);
          vec3 cb = bgColor.a == 0.0 ? bgColor.rgb : bgColor.rgb / bgColor.a;
          return applyBlendMode(clamp(cl, vec3(0.0), vec3(1.0)), colorLayer.a * opacity, cb, bgColor.a);`:c.glsl`
          float composeAlpha = colorLayer.a * opacity;
          ${r?c.glsl`return colorLayer * opacity;`:c.glsl`
            vec4 bgColor = getBackground(bgUV);
            return bgColor * (1.0 - composeAlpha) + colorLayer * opacity;`}`}
    }`)};a.TileBackgroundPassParameters=w;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/output/BlendOptions":function(){define(["exports"],function(a){a.LayerBlendMode=void 0;(function(b){b[b.Normal=0]="Normal";b[b.Average=1]="Average";b[b.Lighten=2]="Lighten";b[b.Lighter=3]="Lighter";b[b.Plus=4]="Plus";b[b.Screen=5]="Screen";b[b.ColorDodge=6]="ColorDodge";b[b.Darken=7]="Darken";b[b.Multiply=8]="Multiply";b[b.ColorBurn=9]="ColorBurn";
b[b.Overlay=10]="Overlay";b[b.SoftLight=11]="SoftLight";b[b.HardLight=12]="HardLight";b[b.VividLight=13]="VividLight";b[b.Hue=14]="Hue";b[b.Saturation=15]="Saturation";b[b.Luminosity=16]="Luminosity";b[b.Color=17]="Color";b[b.DestinationOver=18]="DestinationOver";b[b.DestinationAtop=19]="DestinationAtop";b[b.DestinationIn=20]="DestinationIn";b[b.DestinationOut=21]="DestinationOut";b[b.SourceAtop=22]="SourceAtop";b[b.SourceIn=23]="SourceIn";b[b.SourceOut=24]="SourceOut";b[b.Xor=25]="Xor";b[b.Difference=
26]="Difference";b[b.Exclusion=27]="Exclusion";b[b.Minus=28]="Minus";b[b.Invert=29]="Invert";b[b.Reflect=30]="Reflect";b[b.COUNT=31]="COUNT"})(a.LayerBlendMode||(a.LayerBlendMode={}));a.blendModeFromString={normal:a.LayerBlendMode.Normal,average:a.LayerBlendMode.Average,lighten:a.LayerBlendMode.Lighten,lighter:a.LayerBlendMode.Lighter,screen:a.LayerBlendMode.Screen,plus:a.LayerBlendMode.Plus,"color-dodge":a.LayerBlendMode.ColorDodge,darken:a.LayerBlendMode.Darken,multiply:a.LayerBlendMode.Multiply,
"color-burn":a.LayerBlendMode.ColorBurn,overlay:a.LayerBlendMode.Overlay,"soft-light":a.LayerBlendMode.SoftLight,"hard-light":a.LayerBlendMode.HardLight,"vivid-light":a.LayerBlendMode.VividLight,hue:a.LayerBlendMode.Hue,saturation:a.LayerBlendMode.Saturation,luminosity:a.LayerBlendMode.Luminosity,color:a.LayerBlendMode.Color,difference:a.LayerBlendMode.Difference,exclusion:a.LayerBlendMode.Exclusion,minus:a.LayerBlendMode.Minus,invert:a.LayerBlendMode.Invert,reflect:a.LayerBlendMode.Reflect,"destination-over":a.LayerBlendMode.DestinationOver,
"destination-atop":a.LayerBlendMode.DestinationAtop,"destination-in":a.LayerBlendMode.DestinationIn,"destination-out":a.LayerBlendMode.DestinationOut,"source-atop":a.LayerBlendMode.SourceAtop,"source-in":a.LayerBlendMode.SourceIn,"source-out":a.LayerBlendMode.SourceOut,xor:a.LayerBlendMode.Xor};a.isCompositeBlendMode=function(b){return b===a.LayerBlendMode.DestinationOver||b===a.LayerBlendMode.DestinationAtop||b===a.LayerBlendMode.DestinationIn||b===a.LayerBlendMode.DestinationOut||b===a.LayerBlendMode.SourceAtop||
b===a.LayerBlendMode.SourceIn||b===a.LayerBlendMode.SourceOut||b===a.LayerBlendMode.Xor};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/terrain/BaseOpacityMode":function(){define(["exports"],function(a){a.BaseOpacityMode=void 0;var b=a.BaseOpacityMode||(a.BaseOpacityMode={});b[b.NotRequired=0]="NotRequired";b[b.Required=1]="Required";b[b.COUNT=2]="COUNT";Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/terrain/PremultipliedAlphaSource":function(){define(["exports"],
function(a){a.PremultipliedAlphaSource=void 0;var b=a.PremultipliedAlphaSource||(a.PremultipliedAlphaSource={});b[b.Off=0]="Off";b[b.On=1]="On";b[b.COUNT=2]="COUNT";Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/BlendModes.glsl":function(){define(["exports","../output/BlendOptions","../../shaderModules/interfaces"],function(a,b,n){a.BlendModes=function(k,p){p=p.blendMode;if(p!==b.LayerBlendMode.Normal){p===b.LayerBlendMode.Reflect&&
k.code.add(n.glsl`float reflectBlend(in float cb, in float cl) {
return (cl == 1.0) ? cl : min(cb * cb / (1.0 - cl), 1.0);
}`);p!==b.LayerBlendMode.ColorDodge&&p!==b.LayerBlendMode.VividLight||k.code.add(n.glsl`float colorDodge(in float cb, in float cl) {
return (cb == 0.0) ? 0.0 : (cl == 1.0) ? 1.0 : min(1.0, cb / (1.0 - cl));
}`);p!==b.LayerBlendMode.ColorBurn&&p!==b.LayerBlendMode.VividLight||k.code.add(n.glsl`float colorBurn(in float cb, in float cl) {
return (cb == 1.0) ? 1.0 : (cl == 0.0) ? 0.0 : 1.0 - min(1.0, (1.0 - cb) / cl);
}`);p===b.LayerBlendMode.Overlay&&k.code.add(n.glsl`float overlay(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * (1.0 - 2.0 * (1.0 - cl ) * (1.0 - cb)) + step(0.5, cl) * (2.0 * cl * cb);
}`);p===b.LayerBlendMode.HardLight&&k.code.add(n.glsl`float hardLight(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * (2.0 * cl * cb) + step(0.5, cl) * (1.0 - 2.0 * (1.0 - cl) * (1.0 - cb));
}`);p===b.LayerBlendMode.SoftLight&&k.code.add(n.glsl`float softLight(in float cb, in float cl) {
if (cl <= 0.5) {
return cb - (1.0 - 2.0 * cl) * cb * (1.0 - cb);
}
if (cb <= 0.25) {
return cb + (2.0 * cl - 1.0) * cb * ((16.0 * cb - 12.0) * cb + 3.0);
}
return cb + (2.0 * cl - 1.0) * (sqrt(cb) - cb);
}`);p===b.LayerBlendMode.VividLight&&k.code.add(n.glsl`float vividLight(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * colorBurn(cb, 2.0 * cl) + step(0.5, cl) * colorDodge(cb, (2.0 * (cl - 0.5)));
}`);if(p===b.LayerBlendMode.Hue||p===b.LayerBlendMode.Saturation||p===b.LayerBlendMode.Color||p===b.LayerBlendMode.Luminosity)k.code.add(n.glsl`float minv3(in vec3 c) {
return min(min(c.r, c.g), c.b);
}
float maxv3(in vec3 c) {
return max(max(c.r, c.g), c.b);
}
float lumv3(in vec3 c) {
return dot(c, vec3(0.3, 0.59, 0.11));
}
vec3 clipColor(vec3 color) {
float lum = lumv3(color);
float mincol = minv3(color);
float maxcol = maxv3(color);
if (mincol < 0.0) {
color = lum + ((color - lum) * lum) / (lum - mincol);
}
if (maxcol > 1.0) {
color = lum + ((color - lum) * (1.0 - lum)) / (maxcol - lum);
}
return color;
}
vec3 setLum(vec3 cbase, vec3 clum) {
return clipColor(cbase + vec3(lumv3(clum) - lumv3(cbase)));
}`),p!==b.LayerBlendMode.Hue&&p!==b.LayerBlendMode.Saturation||k.code.add(n.glsl`float satv3(vec3 c) {
return maxv3(c) - minv3(c);
}
vec3 setLumSat(vec3 cbase, vec3 csat, vec3 clum)
{
float minbase = minv3(cbase);
float sbase = satv3(cbase);
float ssat = satv3(csat);
return setLum(sbase > 0.0 ? (cbase - minbase) * ssat / sbase : vec3(0.0), clum);
}`);k.code.add(n.glsl`
    vec4 applyBlendMode(vec3 cl, float ol, vec3 cb, float ob) {
      ${p===b.LayerBlendMode.Multiply?n.glsl`return vec4(cl * ol * cb * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:p===b.LayerBlendMode.Average?n.glsl`return vec4((cb + cl) * 0.5 * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:p===b.LayerBlendMode.Lighten?n.glsl`return vec4(max(cb, cl) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:p===b.LayerBlendMode.Darken?n.glsl`return vec4(min(cl, cb) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:
p===b.LayerBlendMode.Lighter?n.glsl`return vec4(cl * ol + cb * ob, ol + ob);`:p===b.LayerBlendMode.Plus?n.glsl`return clamp(vec4(cl.rgb + cb.rgb, ol + ob), 0.0, 1.0);`:p===b.LayerBlendMode.Minus?n.glsl`return vec4(clamp(vec3(cb.rgb - cl.rgb), 0.0, 1.0), ob * ol);`:p===b.LayerBlendMode.Screen?n.glsl`return vec4((cl + cb - cl * cb) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:p===b.LayerBlendMode.Difference?n.glsl`return vec4(abs(cb - cl) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:
p===b.LayerBlendMode.Invert?n.glsl`return vec4((1.0 - cb) * ol * ob + cb * ob * (1.0 - ol), ob);`:p===b.LayerBlendMode.DestinationOver?n.glsl`return vec4(cl * ol * (1.0 - ob) + cb * ob, ol + ob - ol * ob);`:p===b.LayerBlendMode.DestinationAtop?n.glsl`return vec4(cl * ol * (1.0 - ob) + cb * ob * ol, ol);`:p===b.LayerBlendMode.DestinationOut?n.glsl`return vec4(cb * ob * (1.0 - ol), ob * (1.0 - ol));`:p===b.LayerBlendMode.SourceAtop?n.glsl`return vec4(cl * ol * ob + cb * ob * (1.0 - ol), ob);`:p===b.LayerBlendMode.SourceOut?
n.glsl`return vec4(cl * ol * (1.0 - ob), ol * (1.0 - ob));`:p===b.LayerBlendMode.Xor?n.glsl`return vec4(cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), ol * (1.0 - ob) + ob * (1.0 - ol));`:p===b.LayerBlendMode.DestinationIn?n.glsl`return vec4(cb * ob * ol, ol * ob);`:p===b.LayerBlendMode.SourceIn?n.glsl`return vec4(cl * ol * ob, ol * ob);`:p===b.LayerBlendMode.Hue?n.glsl`
          vec3 f = setLumSat(cl, cb, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:p===b.LayerBlendMode.Saturation?n.glsl`
          vec3 f = setLumSat(cb, cl, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:p===b.LayerBlendMode.Color?n.glsl`
          vec3 f = setLum(cl, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:p===b.LayerBlendMode.Luminosity?n.glsl`
          vec3 f = setLum(cb, cl);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:p===b.LayerBlendMode.Exclusion?n.glsl`
          vec3 f = cl + cb - 2.0 * cl * cb;
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:p===b.LayerBlendMode.Reflect?n.glsl`
          vec3 f = vec3(reflectBlend(cb.r, cl.r), reflectBlend(cb.g, cl.g), reflectBlend(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:p===b.LayerBlendMode.ColorDodge?n.glsl`
          vec3 f = vec3(colorDodge(cb.r, cl.r), colorDodge(cb.g, cl.g), colorDodge(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:p===b.LayerBlendMode.ColorBurn?n.glsl`
          vec3 f = vec3(colorBurn(cb.r, cl.r), colorBurn(cb.g, cl.g), colorBurn(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:p===b.LayerBlendMode.Overlay?n.glsl`
          vec3 f = vec3(overlay(cb.r, cl.r), overlay(cb.g, cl.g), overlay(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:p===b.LayerBlendMode.SoftLight?n.glsl`
          vec3 f = vec3(softLight(cb.r, cl.r), softLight(cb.g, cl.g), softLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:p===b.LayerBlendMode.HardLight?n.glsl`
          vec3 f = vec3(hardLight(cb.r, cl.r), hardLight(cb.g, cl.g), hardLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:p===b.LayerBlendMode.VividLight?n.glsl`
          vec3 f = vec3(vividLight(cb.r, cl.r), vividLight(cb.g, cl.g), vividLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:n.glsl``}
    }
  `)}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/TileCompositor":function(){define("exports ../../../core/Logger ../../../core/maybe ../../../core/libs/gl-matrix-2/factories/vec2f64 ../../2d/engine/imagery/enums ../../2d/engine/vectorTiles/VectorTileRendererHelper3D ./BlendLayersTechnique ./BlendLayersTechniqueConfiguration ./LayerClass ./RasterColorizerTechnique ./RasterColorizerTechniqueConfiguration ./support/MultiSizeFramebuffer ../webgl-engine/core/shaderLibrary/output/BlendOptions ../webgl-engine/core/shaderLibrary/terrain/BaseOpacityMode ../webgl-engine/core/shaderLibrary/terrain/BlendLayersOutput ../webgl-engine/core/shaderLibrary/terrain/PremultipliedAlphaSource ../../../chunks/BlendLayers.glsl ../webgl-engine/lib/BindParameters ../webgl-engine/lib/glUtil3D ../../webgl/enums ../../webgl/Texture ../../webgl/Util".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w,x,u,t,m,q,r,v,y,B){class z{constructor(A,C){this._rctx=A;this._techniques=C;this._fbos=[];this._vectorTileHelper=new h.VectorTileRendererHelper3D;this._bindParameters=new q.BindParameters(null);this._blendLayersTechniqueConfig=new g.BlendLayersTechniqueConfiguration;this._current=0;this._lastUsedIds=[];this._lastCreatedBufferId=0;this._onHoldIds=[];this._vaoQuad=r.createQuadVAO(this._rctx,r.Layout.Pos2Tex)}dispose(){this._fbos.forEach(n.disposeMaybe);this._fbos=
null;this._vtFBO=n.disposeMaybe(this._vtFBO);this._vaoQuad=n.disposeMaybe(this._vaoQuad);this._vectorTileHelper=n.disposeMaybe(this._vectorTileHelper)}updateHeading(A){this._vectorTileHelper?.updateHeading(A)}_acquireBlendLayersTechnique(A,C,H,E=t.PremultipliedAlphaSource.Off,F=m.BackgroundMode.BelowLayer){this._blendLayersTechniqueConfig.output=C;this._blendLayersTechniqueConfig.blendMode=A;this._blendLayersTechniqueConfig.baseOpacityMode=H;this._blendLayersTechniqueConfig.premultipliedSource=E;
this._blendLayersTechniqueConfig.background=F;this._techniques.precompile(e.BlendLayersTechnique,this._blendLayersTechniqueConfig);return this._techniques.acquire(e.BlendLayersTechnique,this._blendLayersTechniqueConfig)}drawBackground(A,C){C=this._acquireBlendLayersTechnique(w.LayerBlendMode.Normal,C?u.BlendLayersOutput.ColorComposite:u.BlendLayersOutput.GridComposite,x.BaseOpacityMode.NotRequired,t.PremultipliedAlphaSource.Off,m.BackgroundMode.Only);A=this._rctx.bindTechnique(C,this._bindParameters,
A);this._render(A);C.release()}_render(A){this._rctx.bindVAO(this._vaoQuad);A.assertCompatibleVertexAttributeLocations(this._vaoQuad);this._rctx.drawArrays(v.PrimitiveType.TRIANGLE_STRIP,0,B.vertexCount(this._vaoQuad,"geometry"))}drawGroup(A,C,H,E,F=t.PremultipliedAlphaSource.On){C===u.BlendLayersOutput.Composite&&(A.fboTexture=this._fbos[this.getLastOnHoldId()].get(H).colorTexture);A.texture=this.currentFBO(H).colorTexture;this.closeGroup(H);C=this._acquireBlendLayersTechnique(E,C,1>A.baseOpacity?
x.BaseOpacityMode.Required:x.BaseOpacityMode.NotRequired,F);A=this._rctx.bindTechnique(C,this._bindParameters,A);this._render(A);C.release()}drawImageData(A,C,H,E,F=t.PremultipliedAlphaSource.Off){if(null!=A.texture){var G=1>A.baseOpacity?x.BaseOpacityMode.Required:x.BaseOpacityMode.NotRequired;A.fboTexture=C===u.BlendLayersOutput.GroupBackgroundComposite||E===w.LayerBlendMode.Normal&&G===x.BaseOpacityMode.NotRequired&&F===t.PremultipliedAlphaSource.Off?null:this.switch(H).colorTexture;C=this._acquireBlendLayersTechnique(E,
C,G,F);A=this._rctx.bindTechnique(C,this._bindParameters,A);this._render(A);C.release()}}drawRasterData(A,C,H,E,F){var G=F.sourceLayerInfo.data;if(G.source&&(F.tile.surface.layerViewByIndex(F.layerIndex,d.LayerClass.MAP).ensureSymbolizerParameters(G),G.bind(this._rctx))){var D=1>A.baseOpacity?x.BaseOpacityMode.Required:x.BaseOpacityMode.NotRequired;A.fboTexture=E===w.LayerBlendMode.Normal&&D===x.BaseOpacityMode.NotRequired?null:this.switch(H).colorTexture;C=this._acquireRasterColorizerTechnique(G,
C,E,D);G.opacity=A.opacity;G=G.getUniforms();G.scale=F.scale;G.offset=F.offset;G.backgroundColor=A.backgroundColor;G.fboTexture=A.fboTexture;G.baseOpacity=A.baseOpacity;A=this._rctx.bindTechnique(C,this._bindParameters,G);this._render(A);C.release()}}_acquireRasterColorizerTechnique(A,C,H,E){const F=A.symbolizerParameters,G=["stretch","lut","hillshade"].indexOf(F.type);null==this._rasterColorizerConfig&&(this._rasterColorizerConfig=new c.RasterColorizerTechniqueConfiguration,this._rctx.gl.getExtension("WEBGL_color_buffer_float"),
this._rctx.gl.getExtension("OES_texture_float"));this._rasterColorizerConfig.output=C;this._rasterColorizerConfig.blendMode=H;this._rasterColorizerConfig.baseOpacityMode=E;this._rasterColorizerConfig.colorizerType=G;this._rasterColorizerConfig.applyColormap=!!F.colormap;this._rasterColorizerConfig.requireBilinearWithNN=A.isBilinearWithStretchColorRamp;this._rasterColorizerConfig.stretchType=A.hasStretchTypeNone()?p.RasterColorizerStretchType.Noop:p.RasterColorizerStretchType.PerBand;this._techniques.precompile(f.RasterColorizerTechnique,
this._rasterColorizerConfig);return this._techniques.acquire(f.RasterColorizerTechnique,this._rasterColorizerConfig)}drawVectorData(A,C,H,E,F,G,D,I){const J=this._rctx,N=F.sourceLayerInfo.data,M=F.tile.surface.layerViewByIndex(F.layerIndex,d.LayerClass.MAP);var Q=1>A.baseOpacity?x.BaseOpacityMode.Required:x.BaseOpacityMode.NotRequired;const O=Q===x.BaseOpacityMode.Required||1>A.opacity||E!==w.LayerBlendMode.Normal||C!==u.BlendLayersOutput.Composite,K=O?t.PremultipliedAlphaSource.On:t.PremultipliedAlphaSource.Off;
Q=this._acquireBlendLayersTechnique(E,C,Q,K);J.setPipelineState(Q.getPipeline());let L=null,P=null;O?(P=this.currentFBO(H),null==this._vtFBO&&(this._vtFBO=new l.MultiSizeFramebuffer(this._rctx)),L=this._vtFBO.get(H),J.bindFramebuffer(L),this._clearCurrentFBO()):I&&J.clear(v.FramebufferBit.DEPTH);try{this._vectorTileHelper.renderBackground(J,F.sourceLod,M.painter,M.layer.styleRepository,M.schemaHelper,Math.round(1/F.scale),F.offset,D,G,M.contentZoom),N&&this._vectorTileHelper.renderContent(J,F.sourceLod,
N,F.vtlNeighborInfos,M.painter,M.layer.styleRepository,M.schemaHelper,Math.round(1/F.scale),F.offset,D,G,M.contentZoom)}catch(R){b.getLogger("esri.views.3d.terrain").warnOnce("A render call containing vector tiles did not resolve correctly.",R)}Q.release();return L?(J.bindFramebuffer(P),A.texture=L.colorTexture,A.offset=k.ZEROS,A.scale=1,this.drawImageData(A,C,H,E,K),I):!0}copyFBOToTexture(A){const C=this._rctx,H=C.bindTexture(A.texture,y.Texture.TEXTURE_UNIT_FOR_UPDATES),E=A.descriptor;C.gl.copyTexImage2D(v.TextureType.TEXTURE_2D,
0,E.pixelFormat,0,0,E.width,E.height,0);A.generateMipmap();C.bindTexture(H,y.Texture.TEXTURE_UNIT_FOR_UPDATES)}_clearCurrentFBO(){this._rctx.setStencilWriteMask(255);this._rctx.setClearColor(0,0,0,0);this._rctx.setClearDepth(1);this._rctx.setClearStencil(0);this._rctx.clear(v.FramebufferBit.COLOR|v.FramebufferBit.DEPTH|v.FramebufferBit.STENCIL)}_initFBO(A,C,H){this._rctx.bindFramebuffer(A);H&&(this._rctx.setViewport(0,0,C,C),this._clearCurrentFBO())}ensureBuffer(A){this._lastUsedIds.length=0;this._lastUsedIds.push(1);
this._lastCreatedBufferId=1;this._onHoldIds.length=0;this.bind(A)}bind(A,C=0,H=!0){this._current=C;if(C>=this._fbos.length)for(let E=this._fbos.length;E<=C;E++)this._fbos.push(new l.MultiSizeFramebuffer(this._rctx));this._initFBO(this._fbos[C].get(A),A,H)}_bindNextFreeBuffer(A){0<this._lastUsedIds.length?this.bind(A,this._lastUsedIds.pop()):(this._lastCreatedBufferId++,this.bind(A,this._lastCreatedBufferId))}openGroup(A){this._onHoldIds.push(this._current);this._bindNextFreeBuffer(A)}switch(A){const C=
this.currentFBO(A),H=this._current;this._bindNextFreeBuffer(A);this._lastUsedIds.push(H);return C}getLastOnHoldId(){return this._onHoldIds[this._onHoldIds.length-1]}closeGroup(A){const C=this._current;this._bindNextFreeBuffer(A);this._lastUsedIds.push(C);this._lastUsedIds.push(this._onHoldIds.pop())}unbind(){this._rctx.bindFramebuffer(null)}currentFBO(A){return this._fbos[this._current].get(A)}}a.TileCompositor=z;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/imagery/enums":function(){define(["exports"],
function(a){a.RasterColorizerType=void 0;(function(b){b[b.Stretch=0]="Stretch";b[b.Lut=1]="Lut";b[b.Hillshade=2]="Hillshade";b[b.COUNT=3]="COUNT"})(a.RasterColorizerType||(a.RasterColorizerType={}));a.RasterColorizerStretchType=void 0;(function(b){b[b.Noop=0]="Noop";b[b.PerBand=1]="PerBand";b[b.COUNT=2]="COUNT"})(a.RasterColorizerStretchType||(a.RasterColorizerStretchType={}));Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/VectorTileRendererHelper3D":function(){define("exports ../../../../core/libs/gl-matrix-2/math/mat3 ../../../../core/libs/gl-matrix-2/factories/mat3f64 ../../../../core/libs/gl-matrix-2/math/common ../../tiling/TileInfoView ../../tiling/TileKey ../../tiling/TileQueue ../../tiling/TileStrategy ./decluttering/jobsUtil ./style/StyleDefinition ../webgl/RenderableTile ../webgl/TileReshuffleManager ../../../webgl/enums".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w){class x{constructor(){this._renderParams={reshuffleManager:new l.TileReshuffleManager,context:null,drawPhase:1,state:new u,stationary:!0,pixelRatio:1,displayLevel:-1,requiredLevel:-1,globalOpacity:1,renderPass:"background",styleLayer:null,styleLayerUID:-1,painter:null,glyphMosaic:null,spriteMosaic:null,profiler:null,renderingOptions:null,requestRender:null,allowDelayedRender:!1,deltaTime:-1,timeline:null,time:0,hasClipping:!1,blendMode:null,dataUploadCounter:0,
effects:null,inFadeTransition:!1,requireFBO:!1,highlightGradient:null,stencilSymbols:!0,is3D:!0,backgroundColor:null};this._backgroundTile=new c.RenderableTile(new h(0,0,0,0),0,0,0,512,512,4096,4096);this._heading=0;this._declutteredForHeading=new WeakMap}dispose(){this._renderParams=null}renderBackground(t,m,q,r,v,y,B,z,A,C){const H=this._backgroundTile;this._updateRenderParameters(t,m,H,q,v,y,B,z,A,C);this._renderParams.stencilSymbols=!1;q.drawBackground(this._renderParams,H,r)}renderContent(t,
m,q,r,v,y,B,z,A,C,H,E){this._declutter(q);r.forAll(({sourceLayerInfo:{data:D}})=>this._declutter(D));const F=0<r.length;F&&this._stencilSymbols(t,m,q,r,v,y,B,z,A,C,H,E);let G=1;q.stencilRef=F?G:0;t.setStencilFunction(w.CompareFunction.EQUAL,q.stencilRef,255);this._render(t,m,q,v,y,B,z,A,C,H,E);r.forAll(({sourceLod:D,offset:I,sourceLayerInfo:{data:J}})=>{J.stencilRef=++G;this._renderSymbols(t,D,J,v,y,B,z,I,C,H,E)})}_stencilSymbols(t,m,q,r,v,y,B,z,A,C,H,E){let F=1;q.stencilRef=F;t.setDepthTestEnabled(!1);
t.setDepthWriteEnabled(!1);t.setStencilTestEnabled(!0);t.setBlendingEnabled(!1);t.setColorMask(!1,!1,!1,!1);t.setStencilOp(w.StencilOperation.KEEP,w.StencilOperation.KEEP,w.StencilOperation.REPLACE);t.setStencilWriteMask(255);t.setStencilFunction(w.CompareFunction.ALWAYS,q.stencilRef,255);this._stencilTileSymbols(t,m,q,v,y,B,z,A,C,H,E);r.forAll(({sourceLod:G,offset:D,sourceLayerInfo:{data:I}})=>{I.stencilRef=++F;t.setStencilFunction(w.CompareFunction.ALWAYS,I.stencilRef,255);this._stencilTileSymbols(t,
G,I,v,y,B,z,D,C,H,E)});t.setStencilWriteMask(0);t.setBlendingEnabled(!0);t.setDepthTestEnabled(!0);t.setColorMask(!0,!0,!0,!0)}_renderSymbols(t,m,q,r,v,y,B,z,A,C,H){t.setStencilFunction(w.CompareFunction.EQUAL,q.stencilRef,255);this._render(t,m,q,r,v,y,B,z,A,C,H,f.StyleLayerType.SYMBOL)}_render(t,m,q,r,v,y,B,z,A,C,H,E){this._updateRenderParameters(t,m,q,r,y,B,z,A,C,H);this._renderParams.stencilSymbols=!1;r.drawTile(this._renderParams,q,v,E)}_stencilTileSymbols(t,m,q,r,v,y,B,z,A,C,H){this._updateRenderParameters(t,
m,q,r,y,B,z,A,C,H);this._renderParams.stencilSymbols=!0;q.triangleCount=0;r.drawSymbols(this._renderParams,q,v)}_updateRenderParameters(t,m,q,r,v,y,B,z,A,C){"type"in q&&"vector-tile"===q.type&&!q.stage&&q.attachWithContext(t);const H=m[0]-v.getLevelShift(m[0]),E=this._renderParams;E.context=t;E.painter=r;E.glyphMosaic=r.glyphMosaic;E.spriteMosaic=r.spriteMosaic;E.pixelRatio=A*C;E.displayLevel=H;E.requiredLevel=H;t=v.getScale(m[0]);const [F,G]=v.getOffset(m,y*t);m=.125*y*t/z;q=q.transforms.displayViewScreenMat3;
q[0]=m;q[4]=-m;q[6]=-1-F-B[0]*y*2;q[7]=1+G+(1-B[1])*y*2-2;y=E.state;z/=C;y.size[0]=z;y.size[1]=z;y.pixelRatio=C;y.rotation=(360-this._heading)%360;C=2/z;b.set(y.displayViewMat3,C,0,0,0,-C,0,-1,1,1);C=b.identity(y.displayMat3);B=k.toRadian(this._heading);b.translate(C,C,[z/2,z/2]);b.rotate(C,C,B);b.translate(C,C,[-z/2,-z/2]);b.multiply(C,y.displayViewMat3,C)}updateHeading(t){this._heading=t}_declutter(t){this._declutteredForHeading.get(t)!==this._heading&&(d.declutterSingleTile(t,(360-this._heading)%
360),this._declutteredForHeading.set(t,this._heading))}}class u{constructor(){this.size=[0,0];this.pixelRatio=1;this.rotation=0;this.displayMat3=n.create();this.displayViewMat3=n.create();this.viewMat3=this.viewMat2d=this.inverseTransform=this.transform=null;this.id=0;this.center=this.extent=null;this.scale=1;this.worldScreenWidth=this.resolution=0;this.toJSON=this.copy=this.clone=this.toScreen=this.toMap=this.getScreenTransform=this.viewpoint=this.spatialReference=null}}a.VectorTileRendererHelper3D=
x;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/tiling/TileInfoView":function(){define(["../../../geometry/support/spatialReferenceUtils","./LODInfo","./TileCoverage","./TileKey","./TileSpan"],function(a,b,n,k,p){const h=new k("0/0/0/0");class e{static create(f,c){f[1]>c[1]&&([f,c]=[c,f]);const [l,w]=f,[x,u]=c;f=x-l;c=u-w;c=0!==c?f/c:0;const t=(Math.ceil(w)-w)*c,m=(Math.floor(w)-w)*c;return new e(l,Math.floor(w),Math.ceil(u),c,0>f?t:m,0>f?m:t,0>f?x:l,0>f?l:x)}constructor(f,
c,l,w,x,u,t,m){this.x=f;this.ymin=c;this.ymax=l;this.invM=w;this.leftAdjust=x;this.rightAdjust=u;this.leftBound=t;this.rightBound=m}incrRow(){this.x+=this.invM}getLeftCol(){return Math.max(this.x+this.leftAdjust,this.leftBound)}getRightCol(){return Math.min(this.x+this.rightAdjust,this.rightBound)}}const g=[[0,0],[0,0],[0,0],[0,0]];class d{constructor(f,c=null,l=f.lods[0].level,w=f.lods[f.lods.length-1].level){this.tileInfo=f;this.fullExtent=c;this.scales=[];this._infoByScale={};this._infoByLevel=
{};const x=f.lods.filter(t=>t.level>=l&&t.level<=w);this.minScale=x[0].scale;this.maxScale=x[x.length-1].scale;const u=this._lodInfos=x.map(t=>b.create(f,t,c));x.forEach((t,m)=>{this._infoByLevel[t.level]=u[m];this._infoByScale[t.scale]=u[m];this.scales[m]=t.scale},this);this._wrap=f.isWrappable}get spatialReference(){return this.tileInfo.spatialReference}getLODInfoAt(f){return this._infoByLevel["number"===typeof f?f:f.level]}getTileBounds(f,c,l=!1){h.set(c);return(c=this._infoByLevel[h.level])?c.getTileBounds(f,
h,l):f}getTileCoords(f,c,l=!1){h.set(c);return(c=this._infoByLevel[h.level])?c.getTileCoords(f,h,l):f}getTileCoverage(f,c=192,l=!0,w="closest"){if(!l&&(f.scale>this.minScale||f.scale<this.maxScale))return null;l="closest"===w?this.getClosestInfoForScale(f.scale):this.getSmallestInfoForScale(f.scale);w=n.pool.acquire(l);const x=this._wrap;var u=Infinity;let t=-Infinity;const m=w.spans;g[0][0]=g[0][1]=g[1][1]=g[3][0]=-c;g[1][0]=g[2][0]=f.size[0]+c;g[2][1]=g[3][1]=f.size[1]+c;for(q of g)f.toMap(q,q),
q[0]=l.getColumnForX(q[0]),q[1]=l.getRowForY(q[1]);f=[];var q=3;for(c=0;4>c;c++)g[c][1]===g[q][1]?q=c:(q=e.create(g[c],g[q]),u=Math.min(q.ymin,u),t=Math.max(q.ymax,t),void 0===f[q.ymin]&&(f[q.ymin]=[]),f[q.ymin].push(q),q=c);if(null==u||null==t||100<t-u)return null;for(c=[];u<t;){null!=f[u]&&(c=c.concat(f[u]));q=Infinity;var r=-Infinity;for(var v=c.length-1;0<=v;v--){var y=c[v];q=Math.min(q,y.getLeftCol());r=Math.max(r,y.getRightCol())}q=Math.floor(q);r=Math.floor(r);if(u>=l.first[1]&&u<=l.last[1])if(x)if(l.size[0]<
l.worldSize[0])for(v=Math.floor(r/l.worldSize[0]),y=Math.floor(q/l.worldSize[0]);y<=v;y++)m.push(new p(u,Math.max(l.getFirstColumnForWorld(y),q),Math.min(l.getLastColumnForWorld(y),r)));else m.push(new p(u,q,r));else q>l.last[0]||r<l.first[0]||(q=Math.max(q,l.first[0]),r=Math.min(r,l.last[0]),m.push(new p(u,q,r)));u+=1;for(q=c.length-1;0<=q;q--)r=c[q],r.ymax>=u?r.incrRow():c.splice(q,1)}return w}getTileParentId(f){h.set(f);f=this._lodInfos.indexOf(this._infoByLevel[h.level])-1;if(0>f)return null;
this._getTileIdAtLOD(h,this._lodInfos[f],h);return h.id}getTileResolution(f){return(f=this._infoByLevel["object"===typeof f?f.level:f])?f.resolution:-1}getTileScale(f){return(f=this._infoByLevel[f.level])?f.scale:-1}intersects(f,c){h.set(c);c=this._infoByLevel[h.level];const l=f.lodInfo;if(l.resolution>c.resolution){this._getTileIdAtLOD(h,l,h);var w=l.denormalizeCol(h.col,h.world);for(var x of f.spans)if(x.row===h.row&&x.colFrom<=w&&x.colTo>=w)return!0}if(l.resolution<c.resolution){const [t,m,q,r]=
f.spans.reduce((v,y)=>{v[0]=Math.min(v[0],y.row);v[1]=Math.max(v[1],y.row);v[2]=Math.min(v[2],y.colFrom);v[3]=Math.max(v[3],y.colTo);return v},[Infinity,-Infinity,Infinity,-Infinity]);w=c.denormalizeCol(h.col,h.world);f=l.getColumnForX(c.getXForColumn(w));x=l.getRowForY(c.getYForRow(h.row));w=l.getColumnForX(c.getXForColumn(w+1))-1;c=l.getRowForY(c.getYForRow(h.row+1))-1;return!(f>r||w<q||x>m||c<t)}const u=l.denormalizeCol(h.col,h.world);return f.spans.some(t=>t.row===h.row&&t.colFrom<=u&&t.colTo>=
u)}normalizeBounds(f,c,l){f[0]=c[0];f[1]=c[1];f[2]=c[2];f[3]=c[3];this._wrap&&(c=a.getInfo(this.tileInfo.spatialReference),l=-l*(c.valid[1]-c.valid[0]),f[0]+=l,f[2]+=l);return f}getSmallestInfoForScale(f){const c=this.scales;if(this._infoByScale[f])return this._infoByScale[f];if(f>c[0])return this._infoByScale[c[0]];for(let l=1;l<c.length-1;l++)if(f>c[l]+1E-6)return this._infoByScale[c[l-1]];return this._infoByScale[c[c.length-1]]}getClosestInfoForScale(f){const c=this.scales;if(this._infoByScale[f])return this._infoByScale[f];
f=c.reduce((l,w)=>Math.abs(w-f)<Math.abs(l-f)?w:l,c[0]);return this._infoByScale[f]}scaleToLevel(f){const c=this.scales;if(this._infoByScale[f])return this._infoByScale[f].level;for(let l=c.length-1;0<=l;l--)if(f<c[l])return l===c.length-1?this._infoByScale[c[c.length-1]].level:this._infoByScale[c[l]].level+(c[l]-f)/(c[l]-c[l+1]);return this._infoByScale[c[0]].level}scaleToZoom(f){return this.tileInfo.scaleToZoom(f)}zoomToScale(f){return this.tileInfo.zoomToScale(f)}_getTileIdAtLOD(f,c,l){const w=
this._infoByLevel[l.level];f.set(l);if(c.resolution<w.resolution)return null;if(c.resolution===w.resolution)return f;f.level=c.level;f.col=Math.floor(l.col*w.resolution/c.resolution+.01);f.row=Math.floor(l.row*w.resolution/c.resolution+.01);return f}}return d})},"esri/views/2d/tiling/LODInfo":function(){define(["../../../geometry/support/spatialReferenceUtils","./TileKey"],function(a,b){function n(h,e,g){h[0]=e;h[1]=g;return h}const k=new b("0/0/0/0");class p{static create(h,e,g=null){const d=a.getInfo(h.spatialReference),
f=e.origin||[h.origin.x,h.origin.y],c=[h.size[0]*e.resolution,h.size[1]*e.resolution],l=[-Infinity,-Infinity],w=[Infinity,Infinity],x=[Infinity,Infinity];null!=g&&(n(l,Math.max(0,Math.floor((g.xmin-f[0])/c[0])),Math.max(0,Math.floor((f[1]-g.ymax)/c[1]))),n(w,Math.max(0,Math.floor((g.xmax-f[0])/c[0])),Math.max(0,Math.floor((f[1]-g.ymin)/c[1]))),n(x,w[0]-l[0]+1,w[1]-l[1]+1));const {cols:u,rows:t}=e;!g&&u&&t&&(n(l,u[0],t[0]),n(w,u[1],t[1]),n(x,u[1]-u[0]+1,t[1]-t[0]+1));let m,q;h.isWrappable?(h=[Math.ceil(Math.round((d.valid[1]-
d.valid[0])/e.resolution)/h.size[0]),x[1]],g=!0,m=d.origin,q=d.valid):(h=x,g=!1);return new p(e.level,e.resolution,e.scale,f,l,w,x,c,h,g,m,q)}constructor(h,e,g,d,f,c,l,w,x,u,t,m){this.level=h;this.resolution=e;this.scale=g;this.origin=d;this.first=f;this.last=c;this.size=l;this.norm=w;this.worldSize=x;this.wrap=u;this._spatialReferenceOrigin=t;this._spatialReferenceValid=m}normalizeCol(h){if(!this.wrap)return h;const e=this.worldSize[0];return 0>h?e-1-Math.abs((h+1)%e):h%e}normalizeKey(h){if(this.wrap){var e=
this.worldSize[0],g=h.col;0>g?(h.col=g+e,--h.world):g>=e&&(h.col=g-e,h.world+=1)}}denormalizeCol(h,e){return this.wrap?this.worldSize[0]*e+h:h}getWorldForColumn(h){return this.wrap?Math.floor(h/this.worldSize[0]):0}getFirstColumnForWorld(h){return h*this.worldSize[0]+this.first[0]}getLastColumnForWorld(h){return h*this.worldSize[0]+this.first[0]+this.size[0]-1}getColumnForX(h){return(h-this.origin[0])/this.norm[0]}getXForColumn(h){const e=this.origin[0]+h*this.norm[0],g=this._spatialReferenceOrigin,
d=this._spatialReferenceValid;return this.wrap&&g&&d?e===g[0]?d[0]:this.origin[0]===g[0]&&h===this.worldSize[0]?d[1]:e:e}getRowForY(h){return(this.origin[1]-h)/this.norm[1]}getYForRow(h){return this.origin[1]-h*this.norm[1]}getTileBounds(h,e,g=!1){k.set(e);var d=g?k.col:this.denormalizeCol(k.col,k.world),f=k.row;e=this.getXForColumn(d);g=this.getYForRow(f+1);d=this.getXForColumn(d+1);f=this.getYForRow(f);h[0]=e;h[1]=g;h[2]=d;h[3]=f;return h}getTileCoords(h,e,g=!1){k.set(e);e=g?k.col:this.denormalizeCol(k.col,
k.world);Array.isArray(h)?n(h,this.getXForColumn(e),this.getYForRow(k.row)):(h.x=this.getXForColumn(e),h.y=this.getYForRow(k.row));return h}}return p})},"esri/views/2d/tiling/TileKey":function(){define(["../../../core/ObjectPool"],function(a){class b{static getId(n,k,p,h){return"object"===typeof n?`${n.level}/${n.row}/${n.col}/${n.world}`:`${n}/${k}/${p}/${h}`}constructor(n,k,p,h){this.set(n,k,p,h)}get key(){return this}get id(){return this.toString()}get normalizedId(){return`${this.level}/${this.row}/${this.col}`}set id(n){this.set(n)}get hash(){return(this.world&
3)<<30|(this.col&4095)<<22|(this.row&4095)<<8|this.level&63}acquire(n,k,p,h){this.set(n,k,p,h)}contains(n){const k=n.level-this.level;return 0<=k&&this.row===n.row>>k&&this.col===n.col>>k&&this.world===n.world}containsChild(n){const k=n.level-this.level;return 0<k&&this.row===n.row>>k&&this.col===n.col>>k&&this.world===n.world}equals(n){return this.level===n.level&&this.row===n.row&&this.col===n.col&&this.world===n.world}clone(){return new b(this)}release(){this.world=this.col=this.row=this.level=
0}set(n,k,p,h){if(null==n)this.world=this.col=this.row=this.level=0;else if("object"===typeof n)this.level=n.level||0,this.row=n.row||0,this.col=n.col||0,this.world=n.world||0;else if("string"===typeof n){const [e,g,d,f]=n.split("/");this.level=parseFloat(e);this.row=parseFloat(g);this.col=parseFloat(d);this.world=parseFloat(f)}else this.level=+n,this.row=+k,this.col=+p,this.world=+h||0;return this}toString(){return`${this.level}/${this.row}/${this.col}/${this.world}`}getParentKey(){return 0>=this.level?
null:new b(this.level-1,this.row>>1,this.col>>1,this.world)}getNormalizedNeighbor(n,k,p){const h=this.clone();h.col+=n;h.row+=k;p.normalizeKey(h);return h}getChildKeys(){const n=this.level+1,k=this.row<<1,p=this.col<<1,h=this.world;return[new b(n,k,p,h),new b(n,k,p+1,h),new b(n,k+1,p,h),new b(n,k+1,p+1,h)]}compareRowMajor(n){return this.row<n.row?-1:this.row>n.row?1:this.col<n.col?-1:this.col>n.col?1:0}}b.pool=new a(b,null,null,25,50);return b})},"esri/views/2d/tiling/TileCoverage":function(){define(["../../../core/ObjectPool",
"./TileKey"],function(a,b){class n{constructor(){this.spans=[]}acquire(k){this.lodInfo=k}release(){this.lodInfo=null;this.spans.length=0}*keys(){const k=this.lodInfo;for(const {row:p,colFrom:h,colTo:e}of this.spans)for(let g=h;g<=e;g++){const d=k.getWorldForColumn(g);yield new b(k.level,p,k.normalizeCol(g),d)}}forEach(k,p){const {spans:h,lodInfo:e}=this,{level:g}=e;if(0!==h.length)for(const {row:d,colFrom:f,colTo:c}of h)for(let l=f;l<=c;l++)k.call(p,g,d,e.normalizeCol(l),e.getWorldForColumn(l))}}
n.pool=new a(n);return n})},"esri/views/2d/tiling/TileSpan":function(){define(function(){class a{constructor(b,n,k){this.row=b;this.colFrom=n;this.colTo=k}}return a})},"esri/views/2d/tiling/TileQueue":function(){define("../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/MapUtils ../../../core/maybe ../../../core/SetUtils ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ../../../core/libs/gl-matrix-2/math/vec2 ../../support/QueueProcessor".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l){const w=[0,0];b=class extends b{constructor(x){super(x);this._keyToItem=new Map;this._tilesByScale=new Map;this.concurrency=6}initialize(){const {concurrency:x,process:u,scheduler:t,priority:m}=this;this._queue=new l.QueueProcessor({concurrency:x,scheduler:t,priority:m,process:(q,r)=>{q=this._keyToItem.get(q);return u(q,{signal:r})},peeker:q=>this._peek(q)})}destroy(){this.clear();this._queue=k.destroyMaybe(this._queue)}get length(){return this._queue?this._queue.length:
0}abort(x){this._queue.abort("string"===typeof x?x:x.id)}clear(){this._queue.clear();this._keyToItem.clear();this._tilesByScale.clear()}has(x){return"string"===typeof x?this._keyToItem.has(x):this._keyToItem.has(x.id)}pause(){this._queue.pause()}push(x){const u=x.key.id;if(this._queue.has(u))return this._queue.get(u);const t=this._queue.push(u),m=this.tileInfoView.getTileScale(x.key),q=n.getOrCreateMapValue(this._tilesByScale,m,()=>new Set),r=()=>{q.delete(x.key);0===q.size&&this._tilesByScale.delete(m);
this._keyToItem.delete(u)};q.add(x.key);this._keyToItem.set(u,x);t.then(r,r);return t}reset(){this._queue.reset()}resume(){this._queue.resume()}_peek(x){if(!this.state)return x.values().next().value;const u=new Set;for(var t of x)u.add(this._keyToItem.get(t).key);t=this.state.scale;let m=Number.POSITIVE_INFINITY,q;for(const [r,v]of this._tilesByScale)if(p.someSet(v,y=>u.has(y))){const y=Math.abs(r-t);y<m&&(q=v,m=y)}return this._getClosestTileKey(q,x).id}_getClosestTileKey(x,u){const t=this.tileInfoView,
m=this.state.center;let q=Number.POSITIVE_INFINITY,r;for(const v of x)u.has(v.id)&&(t.getTileCoords(w,v),x=c.distance(w,m),x<q&&(q=x,r=v));return r}};a.__decorate([h.property({constructOnly:!0})],b.prototype,"concurrency",void 0);a.__decorate([h.property({constructOnly:!0})],b.prototype,"priority",void 0);a.__decorate([h.property({constructOnly:!0})],b.prototype,"process",void 0);a.__decorate([h.property({constructOnly:!0})],b.prototype,"scheduler",void 0);a.__decorate([h.property()],b.prototype,
"state",void 0);a.__decorate([h.property({constructOnly:!0})],b.prototype,"tileInfoView",void 0);return b=a.__decorate([f.subclass("esri.views.2d.tiling.TileQueue")],b)})},"esri/views/support/QueueProcessor":function(){define("exports ../../core/has ../../core/maybe ../../core/promiseUtils ../../core/Queue ../../core/ReactiveMap ../../core/scheduling ../../core/signal".split(" "),function(a,b,n,k,p,h,e,g){class d{constructor(c,l){this.item=c;this.controller=l;this.promise=null}}class f{constructor(c){this._task=
this._schedule=null;this._deferreds=new h;this._controllers=new h;this._processingItems=new h;this._pausedSignal=g.signal(!1);this.concurrency=1;c.concurrency&&(this.concurrency=c.concurrency);this._queue=new p(c.peeker);this.process=c.process;const l=c.scheduler;c.priority&&l&&(this._task=l.registerTask(c.priority,this))}destroy(){this.clear();this._schedule=n.removeMaybe(this._schedule);this._task=n.removeMaybe(this._task)}get updating(){return!!this._task?.updating||this.running}get length(){return this._processingItems.size+
this._queue.length}abort(c){(c=this._controllers.get(c))&&c.abort()}clear(){this._queue.clear();const c=[];this._controllers.forEach(l=>c.push(l));this._controllers.clear();c.forEach(l=>l.abort());this._processingItems.clear();this._cancelNext()}forEach(c){this._deferreds.forEach((l,w)=>c(w))}get(c){return(c=this._deferreds.get(c))?c.promise:void 0}isOngoing(c){return this._processingItems.has(c)}has(c){return this._deferreds.has(c)}pause(){this._pausedSignal.value||(this._pausedSignal.value=!0,this._cancelNext())}push(c,
l){const w=this.get(c);if(w)return w;const x=new AbortController;let u=null;l&&(u=k.onAbort(l,()=>x.abort()));const t=()=>{m.remove();null!=u&&u.remove();this._removeItem(c);this._queue.remove(c);this._scheduleNext()},m=k.onAbortOrThrow(x.signal,()=>{const r=this._processingItems.get(c);r&&r.controller.abort();t();q.reject(k.createAbortError())}),q=k.createResolver();this._deferreds.set(c,q);this._controllers.set(c,x);q.promise.then(t,t);this._queue.push(c);this._scheduleNext();return q.promise}last(){return this._queue.last()}lastPromise(){const c=
this.last();return c?this.get(c):null}peek(){return this._queue.peek()}popLast(){const c=this._queue.popLast();c&&(this._deferreds.get(c)?.reject(k.createAbortError()),this._removeItem(c));return c}reset(){const c=Array.from(this._processingItems.values());this._processingItems.clear();for(const l of c)this._queue.push(l.item),l.controller.abort();this._scheduleNext()}resume(){this._pausedSignal.value&&(this._pausedSignal.value=!1,this._scheduleNext())}takeAll(){const c=[];for(;this._queue.length;)c.push(this._queue.pop());
this.clear();return c}get running(){return!this._pausedSignal.value&&0<this._queue.length&&this._processingItems.size<this.concurrency}runTask(c){for(;!c.done&&0<this._queue.length&&this._processingItems.size<this.concurrency;)this._process(this._queue.pop()),c.madeProgress()}_removeItem(c){this._deferreds.delete(c);this._controllers.delete(c);this._processingItems.delete(c)}_scheduleNext(){this._task||this._pausedSignal.value||this._schedule||(this._schedule=e.schedule(()=>{this._schedule=null;this._next()}))}_next(){for(;0<
this._queue.length&&this._processingItems.size<this.concurrency;)this._process(this._queue.pop())}_cancelNext(){this._schedule&&(this._schedule.remove(),this._schedule=null)}_processResult(c,l){this._canProcessFulfillment(c)&&(this._scheduleNext(),this._deferreds.get(c.item).resolve(l))}_processError(c,l){this._canProcessFulfillment(c)&&(this._scheduleNext(),this._deferreds.get(c.item).reject(l))}_canProcessFulfillment(c){return this._deferreds.get(c.item)&&this._processingItems.get(c.item)===c?!0:
!1}_process(c){if(null!=c){var l=new AbortController,w=new d(c,l);this._processingItems.set(c,w);try{var x=this.process(c,l.signal)}catch(u){this._processError(w,u)}k.isPromiseLike(x)?(w.promise=x,x.then(u=>this._processResult(w,u),u=>this._processError(w,u))):this._processResult(w,x)}}get test(){}}a.QueueProcessor=f;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/tiling/TileStrategy":function(){define(["../../../geometry/support/aaBoundingRect","./TileCache","./TileCoverage",
"./TileKey"],function(a,b,n,k){const p=new k(0,0,0,0),h=new Map,e=[],g=[];class d{constructor(f){this._previousScale=Number.POSITIVE_INFINITY;this.cachePolicy="keep";this.coveragePolicy="closest";this.resampling=!0;this.tileIndex=new Map;this.tiles=[];this.buffer=192;this.acquireTile=f.acquireTile;this.releaseTile=f.releaseTile;this.tileInfoView=f.tileInfoView;null!=f.resampling&&(this.resampling=f.resampling);f.cachePolicy&&(this.cachePolicy=f.cachePolicy);f.coveragePolicy&&(this.coveragePolicy=
f.coveragePolicy);null!=f.buffer&&(this.buffer=f.buffer);f.cacheSize&&(this._tileCache=new b(f.cacheSize,this.tileInfoView,c=>{this.releaseTile(c)}))}destroy(){this.tileIndex.clear()}update(f){const {resampling:c,tileIndex:l}=this,{scale:w,center:x,resolution:u}=f.state,{minScale:t,maxScale:m}=this.tileInfoView,q=!f.stationary&&w>this._previousScale;this._previousScale=w;if(!c&&(w>t||w<m))this.tiles.length=0,this.clear();else if(f=this.tileInfoView.getTileCoverage(f.state,this.buffer,this.resampling,
this.coveragePolicy)){var {spans:r,lodInfo:v}=f,{level:y}=v;this.tiles.length=0;l.forEach(C=>C.visible=!0);var B=0,z=0;if(0<r.length)for(const {row:C,colFrom:H,colTo:E}of r)for(var A=H;A<=E;A++){B++;const F=p.set(y,C,v.normalizeCol(A),v.getWorldForColumn(A)).id;let G=l.get(F);if(G)G.isReady?(h.set(F,G),z++):q||this._addParentTile(F,h);else{if(this._tileCache?.has(F)){if(G=this._tileCache.pop(F),this.tileIndex.set(F,G),G.isReady){h.set(F,G);z++;continue}}else G=this.acquireTile(p),this.tileIndex.set(F,
G);q||this._addParentTile(F,h)}}B=z===B;for(const [C,H]of l)h.has(C)||(p.set(C),z=this.tileInfoView.intersects(f,p),A="purge"===this.cachePolicy?p.level!==y:p.level>y,!z||!q&&B?!A&&z||e.push(H):H.isReady?A&&"purge"===this.cachePolicy&&this._hasReadyAncestor(p,y)?e.push(H):g.push(H):A&&e.push(H));for(const C of g)C.isReady&&h.set(C.key.id,C);for(const C of e)this._tileCache?this._tileCache.add(C):this.releaseTile(C),l.delete(C.key.id);for(const C of h.values())this.tiles.push(C);for(const C of l.values())h.has(C.key.id)||
(C.visible=!1);this._tileCache?.prune(y,x,u);n.pool.release(f);g.length=0;e.length=0;h.clear()}else this.tiles.length=0,this.clear()}clear(){const {tileIndex:f}=this;for(const c of f.values())this.releaseTile(c);f.clear()}refresh(f){for(const c of this.tileIndex.values())f(c);this._tileCache?.clear()}updateCacheSize(f){this._tileCache&&(this._tileCache.maxSize=f)}_addParentTile(f,c){let l=null;for(;;){f=this.tileInfoView.getTileParentId(f);if(!f)break;if(this.tileIndex.has(f)){if(l=this.tileIndex.get(f),
l?.isReady){c.has(l.key.id)||c.set(l.key.id,l);break}}else if(this._tileCache?.has(f)&&(l=this._tileCache.pop(f),this.tileIndex.set(f,l),l?.isReady)){c.has(l.key.id)||c.set(l.key.id,l);break}}}_hasReadyAncestor(f,c){const l=a.create();this.tileInfoView.getTileBounds(l,f,!0);for(const w of this.tileIndex.values())if(w.isReady&&w.key.level>=c&&w.key.level<f.level){const x=a.create();this.tileInfoView.getTileBounds(x,w.key,!0);if(a.contains(x,l))return!0}return!1}}return d})},"esri/views/2d/tiling/TileCache":function(){define(["../../../core/libs/gl-matrix-2/math/vec2"],
function(a){class b{constructor(n,k,p){this.maxSize=n;this._tileInfoView=k;this._removedFunc=p;this._tilePerId=new Map;this._tileKeysPerLevel=[]}clear(){this._tilePerId.clear();this._tileKeysPerLevel=[]}has(n){return this._tilePerId.has(n)}get(n){return this._tilePerId.get(n)}pop(n){const k=this._tilePerId.get(n);if(k){var p=this._tileKeysPerLevel[k.key.level];this._tilePerId["delete"](n);for(let h=0;h<p.length;h++)if(p[h].id===n){p.splice(h,1);break}k.visible=!0;return k}}add(n){n.visible=!1;const k=
n.key,p=k.id;this._tilePerId.has(p)||(this._tilePerId.set(p,n),n=k.level,this._tileKeysPerLevel[n]||(this._tileKeysPerLevel[n]=[]),this._tileKeysPerLevel[n].push(k))}prune(n,k,p){let h=this._tilePerId.size;if(!(h<=this.maxSize)){for(var e=this._tileKeysPerLevel.length-1;h>this.maxSize&&0<=e;)e!==n&&(h=this._pruneAroundCenterTile(h,k,p,e)),e--;h>this.maxSize&&(h=this._pruneAroundCenterTile(h,k,p,n))}}_pruneAroundCenterTile(n,k,p,h){h=this._tileKeysPerLevel[h];if(!h||0===h.length)return n;const {size:e,
origin:g}=this._tileInfoView.tileInfo,d=p*e[0],f=p*e[1],c=[0,0],l=[0,0];for(h.sort((w,x)=>{c[0]=g.x+d*(w.col+.5);c[1]=g.y-f*(w.row+.5);l[0]=g.x+d*(x.col+.5);l[1]=g.y-f*(x.row+.5);return a.squaredDistance(c,k)-a.squaredDistance(l,k)});0<h.length&&(p=h.pop(),this._removeTile(p.id),n--,n!==this.maxSize););return n}_removeTile(n){const k=this._tilePerId.get(n);this._removedFunc&&k&&this._removedFunc(k);this._tilePerId["delete"](n)}}return b})},"esri/views/2d/engine/vectorTiles/decluttering/jobsUtil":function(){define("exports ../../../../../core/libs/gl-matrix-2/math/mat3 ../../../../../core/libs/gl-matrix-2/factories/mat3f32 ../../../../../core/libs/gl-matrix-2/math/common ./core ./jobs ./SymbolDeclutterer ./SymbolRepository ./util ../style/StyleDefinition".split(" "),
function(a,b,n,k,p,h,e,g,d,f){const c=n.create();a.declutterSingleTile=function(l,w){const x=l.transforms.tileUnitsToPixels;var u=k.toRadian(w);const t=Math.ceil(512*(Math.abs(Math.sin(u))+Math.abs(Math.cos(u))));b.identity(c);b.translate(c,c,[t/2,t/2]);b.rotate(c,c,u);b.translate(c,c,[-256,-256]);b.scale(c,c,[.125,.125,1]);l.transforms.tileUnitsToPixels=c;u=[];const m=new g.SymbolRepository(4096,u,()=>new p.VTLUniqueSymbol),q=new e.SymbolDeclutterer(u,m,(r,v,y)=>new h.CollisionJob(r,v,y,l.styleRepository,
l.key.level,w),(r,v)=>{d.writeOpacityToBuffers(r,v,!1)},()=>0,r=>(r=l.styleRepository.getStyleLayerByUID(r).getLayoutProperty("visibility"))&&r.getValue()===f.Visibility.NONE?!1:!0);u.push(l);m.add(l);q.setScreenSize(t,t);q.continue(Infinity);m.removeTile(l);l.transforms.tileUnitsToPixels=x};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/libs/gl-matrix-2/factories/mat3f32":function(){define(["exports"],function(a){function b(){const e=new Float32Array(9);e[0]=1;e[4]=1;
e[8]=1;return e}function n(e){const g=new Float32Array(9);g[0]=e[0];g[1]=e[1];g[2]=e[2];g[3]=e[3];g[4]=e[4];g[5]=e[5];g[6]=e[6];g[7]=e[7];g[8]=e[8];return g}function k(e,g,d,f,c,l,w,x,u){const t=new Float32Array(9);t[0]=e;t[1]=g;t[2]=d;t[3]=f;t[4]=c;t[5]=l;t[6]=w;t[7]=x;t[8]=u;return t}function p(e,g){return new Float32Array(e,g,9)}const h=Object.freeze(Object.defineProperty({__proto__:null,clone:n,create:b,createView:p,fromValues:k},Symbol.toStringTag,{value:"Module"}));a.clone=n;a.create=b;a.createView=
p;a.fromValues=k;a.mat3f32=h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/decluttering/core":function(){define(["exports"],function(a){class b{constructor(k,p){this.sourceTile=p;this.hash=this.yTile=this.xTile=0;this.priority=1;this.featureIndex=0;this.colliders=[];this.textVertexRanges=[];this.iconVertexRanges=[];this.tile=k}}class n{constructor(){this.tileSymbols=[];this.parts=[{startTime:0,startOpacity:0,targetOpacity:0,show:!1},{startTime:0,
startOpacity:0,targetOpacity:0,show:!1}];this.show=!1}}a.VTLSymbol=b;a.VTLUniqueSymbol=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/decluttering/jobs":function(){define(["exports","../../../../../core/libs/gl-matrix-2/factories/mat3f32","./config","./util","../style/StyleDefinition"],function(a,b,n,k,p){class h{constructor(e,g,d,f,c,l){this._symbols=e;this._styleRepository=f;this._zoom=c;this._currentSymbolCursor=this._currentLayerCursor=0;this._styleProps=
new Map;this._allNeededMatrices=new Map;this._gridIndex=new k.GridIndex(g,d,n.collisionGridCellSize);this._si=Math.sin(Math.PI*l/180);this._co=Math.cos(Math.PI*l/180);for(const w of e)for(const x of w.symbols)this._allNeededMatrices.has(x.tile)||this._allNeededMatrices.set(x.tile,b.clone(x.tile.transforms.tileUnitsToPixels))}work(e){const g=this._gridIndex,d=performance.now();for(;this._currentLayerCursor<this._symbols.length;this._currentLayerCursor++,this._currentSymbolCursor=0){const v=this._symbols[this._currentLayerCursor],
y=this._getProperties(v.styleLayerUID);for(;this._currentSymbolCursor<v.symbols.length;this._currentSymbolCursor++){if(99===this._currentSymbolCursor%100&&performance.now()-d>e)return!1;var f=v.symbols[this._currentSymbolCursor];if(!f.unique.show)continue;var c=f,l=this._si,w=this._co,x=this._allNeededMatrices.get(f.tile),u=this._zoom;const {iconRotationAlignment:B,textRotationAlignment:z,iconTranslate:A,iconTranslateAnchor:C,textTranslate:H,textTranslateAnchor:E}=y;var t=0;for(const J of c.colliders){const [N,
M]=0===J.partIndex?A:H;var m=0===J.partIndex?C:E,q=J.minLod<=u&&u<=J.maxLod;t+=q?0:1;J.enabled=q;J.xScreen=J.xTile*x[0]+J.yTile*x[3]+x[6];J.yScreen=J.xTile*x[1]+J.yTile*x[4]+x[7];m===p.TranslateAnchor.MAP?(J.xScreen+=w*N-l*M,J.yScreen+=l*N+w*M):(J.xScreen+=N,J.yScreen+=M);p.RotationAlignment.VIEWPORT===(0===J.partIndex?B:z)?(J.dxScreen=J.dxPixels,J.dyScreen=J.dyPixels):(J.dxScreen=w*(J.dxPixels+J.width/2)-l*(J.dyPixels+J.height/2)-J.width/2,J.dyScreen=l*(J.dxPixels+J.width/2)+w*(J.dyPixels+J.height/
2)-J.height/2)}0<c.colliders.length&&t===c.colliders.length&&(c.unique.show=!1);c=f.unique;if(!c.show)continue;const {iconAllowOverlap:F,iconIgnorePlacement:G,textAllowOverlap:D,textIgnorePlacement:I}=y;for(const J of f.colliders)if(J.enabled&&(l=c.parts[J.partIndex],l.show)){if(w=!(J.partIndex?D:F))a:{w=J.xScreen+J.dxScreen;x=J.yScreen+J.dyScreen;u=w+J.width;t=x+J.height;const [N,M,Q,O]=g.getCellSpan(w,x,u,t);for(m=M;m<=O;m++)for(q=N;q<=Q;q++){var r=g.cells[m][q];for(const K of r){r=K.xScreen+K.dxScreen;
const L=K.yScreen+K.dyScreen,P=r+K.width,R=L+K.height;if(!(u<r||w>P||t<L||x>R)){w=!0;break a}}}w=!1}w&&(J.hard?c.show=!1:l.show=!1)}if(c.show)for(const J of f.colliders){if(!J.enabled)continue;if(J.partIndex?I:G)continue;if(!c.parts[J.partIndex].show)continue;f=J.xScreen+J.dxScreen;l=J.yScreen+J.dyScreen;const [N,M,Q,O]=this._gridIndex.getCellSpan(f,l,f+J.width,l+J.height);for(f=M;f<=O;f++)for(l=N;l<=Q;l++)this._gridIndex.cells[f][l].push(J)}}}return!0}_getProperties(e){var g=this._styleProps.get(e);
if(g)return g;g=this._zoom;const d=this._styleRepository.getStyleLayerByUID(e);var f=d.getLayoutValue("symbol-placement",g)!==p.SymbolPlacement.POINT;let c=d.getLayoutValue("icon-rotation-alignment",g);c===p.RotationAlignment.AUTO&&(c=f?p.RotationAlignment.MAP:p.RotationAlignment.VIEWPORT);let l=d.getLayoutValue("text-rotation-alignment",g);l===p.RotationAlignment.AUTO&&(l=f?p.RotationAlignment.MAP:p.RotationAlignment.VIEWPORT);f=d.getPaintValue("icon-translate",g);const w=d.getPaintValue("icon-translate-anchor",
g),x=d.getPaintValue("text-translate",g),u=d.getPaintValue("text-translate-anchor",g);g={iconAllowOverlap:d.getLayoutValue("icon-allow-overlap",g),iconIgnorePlacement:d.getLayoutValue("icon-ignore-placement",g),textAllowOverlap:d.getLayoutValue("text-allow-overlap",g),textIgnorePlacement:d.getLayoutValue("text-ignore-placement",g),iconRotationAlignment:c,textRotationAlignment:l,iconTranslateAnchor:w,iconTranslate:f,textTranslateAnchor:u,textTranslate:x};this._styleProps.set(e,g);return g}}a.CollisionJob=
h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/decluttering/config":function(){define(["exports"],function(a){a.collisionGridCellSize=32;a.declutterBudget=1.5;a.declutterTiles=!0;a.fadeDuration=200;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/decluttering/util":function(){define(["exports","../enums","../GeometryUtils","./core"],function(a,b,n,k){class p{constructor(h,e,g){this._rows=Math.ceil(e/
g);this._columns=Math.ceil(h/g);this._cellSize=g;this.cells=Array(this._rows);for(h=0;h<this._rows;h++)for(this.cells[h]=Array(this._columns),e=0;e<this._columns;e++)this.cells[h][e]=[]}getCell(h,e){e=Math.min(Math.max(Math.floor(e/this._cellSize),0),this._rows-1);h=Math.min(Math.max(Math.floor(h/this._cellSize),0),this._columns-1);return this.cells[e]&&this.cells[e][h]||null}getCellSpan(h,e,g,d){return[Math.min(Math.max(Math.floor(h/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(e/
this._cellSize),0),this.rows-1),Math.min(Math.max(Math.floor(g/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(d/this._cellSize),0),this.rows-1)]}get cellSize(){return this._cellSize}get columns(){return this._columns}get rows(){return this._rows}}a.GridIndex=p;a.deserializeSymbols=function(h,e,g,d,f,c,l){const w=e[d++];for(let t=0;t<w;t++){const m=new k.VTLSymbol(c,l);m.xTile=e[d++];m.yTile=e[d++];m.hash=e[d++];m.priority=e[d++];m.featureIndex=e[d++];var x=e[d++];for(var u=0;u<x;u++){const q=
e[d++],r=e[d++],v=e[d++],y=e[d++],B=!!e[d++],z=e[d++],A=g[d++],C=g[d++],H=e[d++],E=e[d++];m.colliders.push({xTile:q,yTile:r,dxPixels:v,dyPixels:y,hard:B,partIndex:z,width:H,height:E,minLod:A,maxLod:C})}x=h[d++];for(u=0;u<x;u++)m.textVertexRanges.push([h[d++],h[d++]]);x=h[d++];for(u=0;u<x;u++)m.iconVertexRanges.push([h[d++],h[d++]]);f.push(m)}return d};a.isSearchCircleOverlapingSymbol=function(h,e,g,d){var f=h.colliders;let c,l,w;for(const x of f)if(h.unique.show&&h.unique.parts[x.partIndex].show&&
(f=x.xScreen-d[0]+x.dxScreen,c=x.yScreen-d[1]+x.dyScreen,l=f+x.width,w=c+x.height,n.isCircleOverlapingRect(g,e.x,e.y,f,c,l,w)))return!0;return!1};a.tileCoordChange=function(h,e,g,d,f,c){g-=f;if(0<=g)return(e>>g)+(d-(c<<g))*(h>>g);g=-g;return e-(c-(d<<g))*(h>>g)<<g};a.writeOpacityToBuffers=function(h,e,g){for(const [u,t]of h.symbols){{var d=h,f=e,c=g,l=t;const m=d.layerData.get(u);if(m.type===b.BucketType.SYMBOL){for(const q of l){l=q.unique;var w=void 0;if(q.selectedForRendering){var x=l.parts[0];
w=x.startOpacity;x=x.targetOpacity;d.allSymbolsFadingOut=d.allSymbolsFadingOut&&0===x;w=c?Math.floor(127*w)|x<<7:x?255:0;w|=w<<24|w<<16|w<<8}else w=0;for(const [r,v]of q.iconVertexRanges)for(x=r;x<r+v;x+=4)m.iconOpacity[x/4]=w;q.selectedForRendering?(w=l.parts[1],l=w.startOpacity,w=w.targetOpacity,d.allSymbolsFadingOut=d.allSymbolsFadingOut&&0===w,l=c?Math.floor(127*l)|w<<7:w?255:0,w=l<<24|l<<16|l<<8|l):w=0;for(const [r,v]of q.textVertexRanges)for(l=r;l<r+v;l+=4)m.textOpacity[l/4]=w}m.lastOpacityUpdate=
f;m.opacityChanged=!0}}}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/enums":function(){define(["exports"],function(a){a.BucketType=void 0;(function(b){b[b.FILL=1]="FILL";b[b.LINE=2]="LINE";b[b.SYMBOL=3]="SYMBOL";b[b.CIRCLE=4]="CIRCLE"})(a.BucketType||(a.BucketType={}));a.ShaderProgramType=void 0;(function(b){b[b.BACKGROUND=0]="BACKGROUND";b[b.FILL=1]="FILL";b[b.OUTLINE=2]="OUTLINE";b[b.LINE=3]="LINE";b[b.ICON=4]="ICON";b[b.CIRCLE=5]="CIRCLE";
b[b.TEXT=6]="TEXT";b[b.TILEINFO=7]="TILEINFO"})(a.ShaderProgramType||(a.ShaderProgramType={}));a.StyleUpdateType=void 0;(function(b){b[b.PAINTER_CHANGED=0]="PAINTER_CHANGED";b[b.LAYOUT_CHANGED=1]="LAYOUT_CHANGED";b[b.LAYER_CHANGED=2]="LAYER_CHANGED";b[b.LAYER_REMOVED=3]="LAYER_REMOVED";b[b.SPRITES_CHANGED=4]="SPRITES_CHANGED"})(a.StyleUpdateType||(a.StyleUpdateType={}));Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/GeometryUtils":function(){define(["exports",
"../../../../geometry/support/coordsUtils","../../../../geometry/support/TileClipper"],function(a,b,n){function k(f,c){f%=c;return 0<=f?f:f+c}const p=Number.POSITIVE_INFINITY,h=Math.PI,e=128/h,g=256/360,d=1/Math.LN2;a.between=function(f,c,l){return f>=c&&f<=l||f>=l&&f<=c};a.c2pi=2*h;a.cDegTo256=g;a.cDegToRad=h/180;a.cInfinity=p;a.cPi=h;a.cRadTo256=e;a.degToByte=function(f){return k(f*g,256)};a.distanceFromToPolylineWithinThreshold=function(f,c,l,w){let x,u,t;w*=w;for(const m of l){const q=m.length;
if(!(2>q)){l=m[0].x;x=m[0].y;for(let r=1;r<q;++r){u=m[r].x;t=m[r].y;if(b.distanceToSegmentSquared(f,c,l,x,u,t)<w)return!0;l=u;x=t}}}return!1};a.getTileMargins=function(f){return 8+Math.max(16*(f-14),0)};a.interpolate=function(f,c,l){return f*(1-l)+c*l};a.isCircleOverlapingRect=function(f,c,l,w,x,u,t){c=Math.max(w,Math.min(c,u))-c;l=Math.max(x,Math.min(l,t))-l;return c*c+l*l<=f*f};a.log2=function(f){return Math.log(f)*d};a.offsetLine=function(f,c){if(0===c||Number.isNaN(c))return f;const l=[],w=new n.Point(0,
0),x=new n.Point(0,0),u=new n.Point(0,0);for(let m=0;m<f.length;m++){const q=f[m],r=[];for(let v=0;v<q.length;v++){var t=q[v-1];const y=q[v],B=q[v+1];0===v?w.setCoords(0,0):w.assignSub(y,t).normalize().rightPerpendicular();v===q.length-1?x.setCoords(0,0):x.assignSub(B,y).normalize().rightPerpendicular();u.assignAdd(w,x).normalize();t=u.x*x.x+u.y*x.y;0!==t&&u.scale(1/t);r.push(n.Point.add(y,u.scale(c)))}l.push(r)}return l};a.pointInPolygon=function(f,c,l){let w=0,x,u;for(const t of l){l=t.length;for(let m=
1;m<l;++m)x=t[m-1],u=t[m],x.y>c!==u.y>c&&(0<(u.x-x.x)*(c-x.y)-(u.y-x.y)*(f-x.x)?w++:w--)}return 0!==w};a.positiveMod=k;a.radToByte=function(f){return k(f*e,256)};a.sqr=function(f){return f*f};a.translateAnchor=function(f,c,l,w){f=new n.Point(f[0],f[1]);f.scale(w);"viewport"===c&&(c=Math.PI/180*-l,f.rotate(Math.cos(c),Math.sin(c)));return f};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/TileClipper":function(){define(["exports"],function(a){a.GeometryType=void 0;
(function(d){d[d.Unknown=0]="Unknown";d[d.Point=1]="Point";d[d.LineString=2]="LineString";d[d.Polygon=3]="Polygon"})(a.GeometryType||(a.GeometryType={}));class b{constructor(d,f){this.x=d;this.y=f}clone(){return new b(this.x,this.y)}equals(d,f){return d===this.x&&f===this.y}isEqual(d){return d.x===this.x&&d.y===this.y}setCoords(d,f){this.x=d;this.y=f;return this}normalize(){var d=this.x;const f=this.y;d=Math.sqrt(d*d+f*f);this.x/=d;this.y/=d;return this}rightPerpendicular(){const d=this.x;this.x=
this.y;this.y=-d;return this}leftPerpendicular(){const d=this.x;this.x=-this.y;this.y=d;return this}move(d,f){this.x+=d;this.y+=f;return this}assign(d){this.x=d.x;this.y=d.y;return this}assignAdd(d,f){this.x=d.x+f.x;this.y=d.y+f.y;return this}assignSub(d,f){this.x=d.x-f.x;this.y=d.y-f.y;return this}rotate(d,f){const c=this.x,l=this.y;this.x=c*d-l*f;this.y=c*f+l*d;return this}scale(d){this.x*=d;this.y*=d;return this}length(){const d=this.x,f=this.y;return Math.sqrt(d*d+f*f)}sub(d){this.x-=d.x;this.y-=
d.y;return this}add(d){this.x+=d.x;this.y+=d.y;return this}static distance(d,f){const c=f.x-d.x;d=f.y-d.y;return Math.sqrt(c*c+d*d)}static add(d,f){return new b(d.x+f.x,d.y+f.y)}static sub(d,f){return new b(d.x-f.x,d.y-f.y)}}class n{constructor(d,f,c){this.ratio=d;this.x=f;this.y=c}}class k{constructor(d,f,c,l=8,w=8){this._lines=[];this._starts=[];this.validateTessellation=!0;this._pixelRatio=l;this._pixelMargin=w;this._tileSize=512*l;this._dz=d;this._yPos=f;this._xPos=c}setPixelMargin(d){d!==this._pixelMargin&&
(this._pixelMargin=d,this.setExtent(this._extent))}setExtent(d){this._extent=d;this._finalRatio=this._tileSize/d*(1<<this._dz);let f=this._pixelRatio*this._pixelMargin;f/=this._finalRatio;d>>=this._dz;f>d&&(f=d);this._margin=f;this._xmin=d*this._xPos-f;this._ymin=d*this._yPos-f;this._xmax=this._xmin+d+2*f;this._ymax=this._ymin+d+2*f}reset(d){this._type=d;this._lines=[];this._starts=[];this._line=null;this._start=0}moveTo(d,f){this._pushLine();this._prevIsIn=this._isIn(d,f);this._moveTo(d,f,this._prevIsIn);
this._prevPt=new b(d,f);this._firstPt=new b(d,f);this._dist=0}lineTo(d,f){const c=this._isIn(d,f),l=new b(d,f),w=b.distance(this._prevPt,l);if(c)if(this._prevIsIn)this._lineTo(d,f,!0);else{var x=this._prevPt;var u=l;d=this._intersect(u,x);this._start=this._dist+w*(1-this._r);this._lineTo(d.x,d.y,!0);this._lineTo(u.x,u.y,!0)}else if(this._prevIsIn)u=this._prevPt,x=l,d=this._intersect(u,x),this._lineTo(d.x,d.y,!0),this._lineTo(x.x,x.y,!1);else{const m=this._prevPt;if(!(m.x<=this._xmin&&l.x<=this._xmin||
m.x>=this._xmax&&l.x>=this._xmax||m.y<=this._ymin&&l.y<=this._ymin||m.y>=this._ymax&&l.y>=this._ymax)){d=[];if(m.x<this._xmin&&l.x>this._xmin||m.x>this._xmin&&l.x<this._xmin){f=(this._xmin-m.x)/(l.x-m.x);var t=m.y+f*(l.y-m.y);t<=this._ymin?u=!1:t>=this._ymax?u=!0:d.push(new n(f,this._xmin,t))}if(m.x<this._xmax&&l.x>this._xmax||m.x>this._xmax&&l.x<this._xmax)f=(this._xmax-m.x)/(l.x-m.x),t=m.y+f*(l.y-m.y),t<=this._ymin?u=!1:t>=this._ymax?u=!0:d.push(new n(f,this._xmax,t));if(m.y<this._ymin&&l.y>this._ymin||
m.y>this._ymin&&l.y<this._ymin)f=(this._ymin-m.y)/(l.y-m.y),t=m.x+f*(l.x-m.x),t<=this._xmin?x=!1:t>=this._xmax?x=!0:d.push(new n(f,t,this._ymin));if(m.y<this._ymax&&l.y>this._ymax||m.y>this._ymax&&l.y<this._ymax)f=(this._ymax-m.y)/(l.y-m.y),t=m.x+f*(l.x-m.x),t<=this._xmin?x=!1:t>=this._xmax?x=!0:d.push(new n(f,t,this._ymax));if(0===d.length)x?u?this._lineTo(this._xmax,this._ymax,!0):this._lineTo(this._xmax,this._ymin,!0):u?this._lineTo(this._xmin,this._ymax,!0):this._lineTo(this._xmin,this._ymin,
!0);else if(1<d.length&&d[0].ratio>d[1].ratio)this._start=this._dist+w*d[1].ratio,this._lineTo(d[1].x,d[1].y,!0),this._lineTo(d[0].x,d[0].y,!0);else for(this._start=this._dist+w*d[0].ratio,x=0;x<d.length;x++)this._lineTo(d[x].x,d[x].y,!0)}this._lineTo(l.x,l.y,!1)}this._dist+=w;this._prevIsIn=c;this._prevPt=l}close(){if(2<this._line.length){var d=this._firstPt,f=this._prevPt;d.x===f.x&&d.y===f.y||this.lineTo(d.x,d.y);d=this._line;for(f=d.length;4<=f;)if(d[0].x===d[1].x&&d[0].x===d[f-2].x||d[0].y===
d[1].y&&d[0].y===d[f-2].y)d.pop(),d[0].x=d[f-2].x,d[0].y=d[f-2].y,--f;else break}}result(d=!0){this._pushLine();if(0===this._lines.length)return null;this._type===a.GeometryType.Polygon&&d&&e.simplify(this._tileSize,this._margin*this._finalRatio,this._lines);return this._lines}resultWithStarts(){if(this._type!==a.GeometryType.LineString)throw Error("Only valid for lines");this._pushLine();const d=this._lines,f=d.length;if(0===f)return null;const c=[];for(let l=0;l<f;l++)c.push({line:d[l],start:this._starts[l]||
0});return c}_isIn(d,f){return d>=this._xmin&&d<=this._xmax&&f>=this._ymin&&f<=this._ymax}_intersect(d,f){let c,l,w;if(f.x>=this._xmin&&f.x<=this._xmax)l=f.y<=this._ymin?this._ymin:this._ymax,w=(l-d.y)/(f.y-d.y),c=d.x+w*(f.x-d.x);else if(f.y>=this._ymin&&f.y<=this._ymax)c=f.x<=this._xmin?this._xmin:this._xmax,w=(c-d.x)/(f.x-d.x),l=d.y+w*(f.y-d.y);else{l=f.y<=this._ymin?this._ymin:this._ymax;c=f.x<=this._xmin?this._xmin:this._xmax;const x=(c-d.x)/(f.x-d.x),u=(l-d.y)/(f.y-d.y);x<u?(w=x,l=d.y+x*(f.y-
d.y)):(w=u,c=d.x+u*(f.x-d.x))}this._r=w;return new b(c,l)}_pushLine(){this._line&&(this._type===a.GeometryType.Point?0<this._line.length&&(this._lines.push(this._line),this._starts.push(this._start)):this._type===a.GeometryType.LineString?1<this._line.length&&(this._lines.push(this._line),this._starts.push(this._start)):this._type===a.GeometryType.Polygon&&3<this._line.length&&(this._lines.push(this._line),this._starts.push(this._start)));this._line=[];this._start=0}_moveTo(d,f,c){this._type!==a.GeometryType.Polygon?
c&&(d=Math.round((d-(this._xmin+this._margin))*this._finalRatio),f=Math.round((f-(this._ymin+this._margin))*this._finalRatio),this._line.push(new b(d,f))):(c||(d<this._xmin&&(d=this._xmin),d>this._xmax&&(d=this._xmax),f<this._ymin&&(f=this._ymin),f>this._ymax&&(f=this._ymax)),d=Math.round((d-(this._xmin+this._margin))*this._finalRatio),f=Math.round((f-(this._ymin+this._margin))*this._finalRatio),this._line.push(new b(d,f)),this._isV=this._isH=!1)}_lineTo(d,f,c){if(this._type!==a.GeometryType.Polygon)if(c){d=
Math.round((d-(this._xmin+this._margin))*this._finalRatio);f=Math.round((f-(this._ymin+this._margin))*this._finalRatio);if(0<this._line.length&&(c=this._line[this._line.length-1],c.equals(d,f)))return;this._line.push(new b(d,f))}else this._line&&0<this._line.length&&this._pushLine();else if(c||(d<this._xmin&&(d=this._xmin),d>this._xmax&&(d=this._xmax),f<this._ymin&&(f=this._ymin),f>this._ymax&&(f=this._ymax)),d=Math.round((d-(this._xmin+this._margin))*this._finalRatio),f=Math.round((f-(this._ymin+
this._margin))*this._finalRatio),this._line&&0<this._line.length){c=this._line[this._line.length-1];const l=c.x===d,w=c.y===f;l&&w||(this._isH&&l?(c.x=d,c.y=f,c=this._line[this._line.length-2],c.x===d&&c.y===f?(this._line.pop(),1>=this._line.length?this._isV=this._isH=!1:(c=this._line[this._line.length-2],this._isH=c.x===d,this._isV=c.y===f)):(this._isH=c.x===d,this._isV=c.y===f)):this._isV&&w?(c.x=d,c.y=f,c=this._line[this._line.length-2],c.x===d&&c.y===f?(this._line.pop(),1>=this._line.length?this._isV=
this._isH=!1:(c=this._line[this._line.length-2],this._isH=c.x===d,this._isV=c.y===f)):(this._isH=c.x===d,this._isV=c.y===f)):(this._line.push(new b(d,f)),this._isH=l,this._isV=w))}else this._line.push(new b(d,f))}}class p{setExtent(d){this._ratio=4096===d?1:4096/d}get validateTessellation(){return 1>this._ratio}reset(d){this._lines=[];this._line=null}moveTo(d,f){this._line&&this._lines.push(this._line);this._line=[];const c=this._ratio;this._line.push(new b(d*c,f*c))}lineTo(d,f){const c=this._ratio;
this._line.push(new b(d*c,f*c))}close(){const d=this._line;d&&!d[0].isEqual(d[d.length-1])&&d.push(d[0])}result(){this._line&&this._lines.push(this._line);return 0===this._lines.length?null:this._lines}}var h;(function(d){d[d.sideLeft=0]="sideLeft";d[d.sideRight=1]="sideRight";d[d.sideTop=2]="sideTop";d[d.sideBottom=3]="sideBottom"})(h||={});class e{static simplify(d,f,c){if(c){var l=-f,w=d+f,x=-f,u=d+f;d=[];f=[];var t=c.length;for(let m=0;m<t;++m){const q=c[m];if(!q||2>q.length)continue;let r=q[0],
v;const y=q.length;for(let B=1;B<y;++B)v=q[B],r.x===v.x&&(r.x<=l&&(r.y>v.y?(d.push(m),d.push(B),d.push(h.sideLeft),d.push(-1)):(f.push(m),f.push(B),f.push(h.sideLeft),f.push(-1))),r.x>=w&&(r.y<v.y?(d.push(m),d.push(B),d.push(h.sideRight),d.push(-1)):(f.push(m),f.push(B),f.push(h.sideRight),f.push(-1)))),r.y===v.y&&(r.y<=x&&(r.x<v.x?(d.push(m),d.push(B),d.push(h.sideTop),d.push(-1)):(f.push(m),f.push(B),f.push(h.sideTop),f.push(-1))),r.y>=u&&(r.x>v.x?(d.push(m),d.push(B),d.push(h.sideBottom),d.push(-1)):
(f.push(m),f.push(B),f.push(h.sideBottom),f.push(-1)))),r=v}0!==d.length&&0!==f.length&&(e.fillParent(c,f,d),e.fillParent(c,d,f),l=[],e.calcDeltas(l,f,d),e.calcDeltas(l,d,f),e.addDeltas(l,c))}}static fillParent(d,f,c){const l=c.length,w=f.length;for(let q=0;q<w;q+=4){var x=f[q],u=f[q+1];const r=f[q+2],v=d[x][u-1];x=d[x][u];u=8092;let y=-1;for(let B=0;B<l;B+=4){if(c[B+2]!==r)continue;var t=c[B];const z=c[B+1];var m=d[t][z-1];t=d[t][z];switch(r){case h.sideLeft:case h.sideRight:g(v.y,m.y,t.y)&&g(x.y,
m.y,t.y)&&(m=Math.abs(t.y-m.y),m<u&&(u=m,y=B));break;case h.sideTop:case h.sideBottom:g(v.x,m.x,t.x)&&g(x.x,m.x,t.x)&&(m=Math.abs(t.x-m.x),m<u&&(u=m,y=B))}}f[q+3]=y}}static calcDeltas(d,f,c){const l=f.length;for(let w=0;w<l;w+=4){const x=e.calcDelta(w,f,c,[]);d.push(f[w]);d.push(f[w+1]);d.push(f[w+2]);d.push(x)}}static calcDelta(d,f,c,l){d=f[d+3];if(-1===d)return 0;const w=l.length;if(1<w&&l[w-2]===d)return 0;l.push(d);return e.calcDelta(d,c,f,l)+1}static addDeltas(d,f){const c=d.length;let l=0;for(var w=
0;w<c;w+=4){var x=d[w+3];x>l&&(l=x)}for(w=0;w<c;w+=4){x=f[d[w]];const u=d[w+1],t=l-d[w+3];switch(d[w+2]){case h.sideLeft:x[u-1].x-=t;x[u].x-=t;1===u&&(x[x.length-1].x-=t);u===x.length-1&&(x[0].x-=t);break;case h.sideRight:x[u-1].x+=t;x[u].x+=t;1===u&&(x[x.length-1].x+=t);u===x.length-1&&(x[0].x+=t);break;case h.sideTop:x[u-1].y-=t;x[u].y-=t;1===u&&(x[x.length-1].y-=t);u===x.length-1&&(x[0].y-=t);break;case h.sideBottom:x[u-1].y+=t,x[u].y+=t,1===u&&(x[x.length-1].y+=t),u===x.length-1&&(x[0].y+=t)}}}}
const g=(d,f,c)=>d>=f&&d<=c||d>=c&&d<=f;a.Point=b;a.SimpleBuilder=p;a.TileClipper=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/style/StyleDefinition":function(){define(["exports","../../../../../symbols/cim/enums"],function(a,b){a.StyleLayerType=void 0;(function(k){k[k.BACKGROUND=0]="BACKGROUND";k[k.FILL=1]="FILL";k[k.LINE=2]="LINE";k[k.SYMBOL=3]="SYMBOL";k[k.CIRCLE=4]="CIRCLE"})(a.StyleLayerType||(a.StyleLayerType={}));a.Visibility=void 0;(function(k){k[k.VISIBLE=
0]="VISIBLE";k[k.NONE=1]="NONE"})(a.Visibility||(a.Visibility={}));a.SymbolPlacement=void 0;(function(k){k[k.POINT=0]="POINT";k[k.LINE=1]="LINE";k[k.LINE_CENTER=2]="LINE_CENTER"})(a.SymbolPlacement||(a.SymbolPlacement={}));a.RotationAlignment=void 0;(function(k){k[k.MAP=0]="MAP";k[k.VIEWPORT=1]="VIEWPORT";k[k.AUTO=2]="AUTO"})(a.RotationAlignment||(a.RotationAlignment={}));a.TextJustification=void 0;(function(k){k[k.AUTO=0]="AUTO";k[k.LEFT=1]="LEFT";k[k.CENTER=2]="CENTER";k[k.RIGHT=3]="RIGHT"})(a.TextJustification||
(a.TextJustification={}));a.SymbolAnchor=void 0;(function(k){k[k.CENTER=0]="CENTER";k[k.LEFT=1]="LEFT";k[k.RIGHT=2]="RIGHT";k[k.TOP=3]="TOP";k[k.BOTTOM=4]="BOTTOM";k[k.TOP_LEFT=5]="TOP_LEFT";k[k.TOP_RIGHT=6]="TOP_RIGHT";k[k.BOTTOM_LEFT=7]="BOTTOM_LEFT";k[k.BOTTOM_RIGHT=8]="BOTTOM_RIGHT"})(a.SymbolAnchor||(a.SymbolAnchor={}));a.TextTransform=void 0;(function(k){k[k.NONE=0]="NONE";k[k.UPPERCASE=1]="UPPERCASE";k[k.LOWERCASE=2]="LOWERCASE"})(a.TextTransform||(a.TextTransform={}));a.TranslateAnchor=void 0;
(function(k){k[k.MAP=0]="MAP";k[k.VIEWPORT=1]="VIEWPORT"})(a.TranslateAnchor||(a.TranslateAnchor={}));a.TextWritingMode=void 0;(function(k){k[k.HORIZONTAL=0]="HORIZONTAL";k[k.VERTICAL=1]="VERTICAL"})(a.TextWritingMode||(a.TextWritingMode={}));class n{}n.backgroundLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:a.Visibility.VISIBLE}};n.fillLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:a.Visibility.VISIBLE}};n.lineLayoutDefinition={visibility:{type:"enum",
values:["visible","none"],default:a.Visibility.VISIBLE},"line-cap":{type:"enum",values:["butt","round","square"],default:b.CapType.BUTT},"line-join":{type:"enum",values:["bevel","round","miter"],default:b.JoinType.MITER},"line-miter-limit":{type:"number",default:2},"line-round-limit":{type:"number",default:1.05}};n.symbolLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:a.Visibility.VISIBLE},"symbol-avoid-edges":{type:"boolean",default:!1},"symbol-placement":{type:"enum",
values:["point","line","line-center"],default:a.SymbolPlacement.POINT},"symbol-sort-key":{type:"number",default:-1},"symbol-spacing":{type:"number",minimum:1,default:250},"icon-allow-overlap":{type:"boolean",default:!1},"icon-anchor":{type:"enum",values:"center left right top bottom top-left top-right bottom-left bottom-right".split(" "),default:a.SymbolAnchor.CENTER},"icon-ignore-placement":{type:"boolean",default:!1},"icon-image":{type:"string"},"icon-keep-upright":{type:"boolean",default:!1},"icon-offset":{type:"array",
value:"number",length:2,default:[0,0]},"icon-optional":{type:"boolean",default:!1},"icon-padding":{type:"number",minimum:0,default:2},"icon-rotate":{type:"number",default:0},"icon-rotation-alignment":{type:"enum",values:["map","viewport","auto"],default:a.RotationAlignment.AUTO},"icon-size":{type:"number",minimum:0,default:1},"text-allow-overlap":{type:"boolean",default:!1},"text-anchor":{type:"enum",values:"center left right top bottom top-left top-right bottom-left bottom-right".split(" "),default:a.SymbolAnchor.CENTER},
"text-field":{type:"string"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"]},"text-ignore-placement":{type:"boolean",default:!1},"text-justify":{type:"enum",values:["auto","left","center","right"],default:a.TextJustification.CENTER},"text-keep-upright":{type:"boolean",default:!0},"text-letter-spacing":{type:"number",default:0},"text-line-height":{type:"number",default:1.2},"text-max-angle":{type:"number",minimum:0,default:45},"text-max-width":{type:"number",
minimum:0,default:10},"text-offset":{type:"array",value:"number",length:2,default:[0,0]},"text-optional":{type:"boolean",default:!1},"text-padding":{type:"number",minimum:0,default:2},"text-rotate":{type:"number",default:0},"text-rotation-alignment":{type:"enum",values:["map","viewport","auto"],default:a.RotationAlignment.AUTO},"text-size":{type:"number",minimum:0,default:16},"text-transform":{type:"enum",values:["none","uppercase","lowercase"],default:a.TextTransform.NONE},"text-writing-mode":{type:"array",
value:"enum",values:["horizontal","vertical"],default:[a.TextWritingMode.HORIZONTAL]}};n.circleLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:a.Visibility.VISIBLE}};n.backgroundPaintDefinition={"background-color":{type:"color",default:[0,0,0,1]},"background-opacity":{type:"number",minimum:0,maximum:1,default:1},"background-pattern":{type:"string"}};n.fillPaintDefinition={"fill-antialias":{type:"boolean",default:!0},"fill-color":{type:"color",default:[0,0,0,1]},"fill-opacity":{type:"number",
minimum:0,maximum:1,default:1},"fill-outline-color":{type:"color",default:[0,0,0,0]},"fill-pattern":{type:"string"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0]},"fill-translate-anchor":{type:"enum",values:["map","viewport"],default:a.TranslateAnchor.MAP}};n.linePaintDefinition={"line-blur":{type:"number",minimum:0,default:0},"line-color":{type:"color",default:[0,0,0,1]},"line-dasharray":{type:"array",value:"number",default:[]},"line-gap-width":{type:"number",minimum:0,default:0},
"line-offset":{type:"number",default:0},"line-opacity":{type:"number",minimum:0,maximum:1,default:1},"line-pattern":{type:"string"},"line-translate":{type:"array",value:"number",length:2,default:[0,0]},"line-translate-anchor":{type:"enum",values:["map","viewport"],default:a.TranslateAnchor.MAP},"line-width":{type:"number",minimum:0,default:1}};n.symbolPaintDefinition={"icon-color":{type:"color",default:[0,0,0,1]},"icon-halo-blur":{type:"number",minimum:0,default:0},"icon-halo-color":{type:"color",
default:[0,0,0,0]},"icon-halo-width":{type:"number",minimum:0,default:0},"icon-opacity":{type:"number",minimum:0,maximum:1,default:1},"icon-translate":{type:"array",value:"number",length:2,default:[0,0]},"icon-translate-anchor":{type:"enum",values:["map","viewport"],default:a.TranslateAnchor.MAP},"text-color":{type:"color",default:[0,0,0,1]},"text-halo-blur":{type:"number",minimum:0,default:0},"text-halo-color":{type:"color",default:[0,0,0,0]},"text-halo-width":{type:"number",minimum:0,default:0},
"text-opacity":{type:"number",minimum:0,maximum:1,default:1},"text-translate":{type:"array",value:"number",length:2,default:[0,0]},"text-translate-anchor":{type:"enum",values:["map","viewport"],default:a.TranslateAnchor.MAP}};n.rasterPaintDefinition={"raster-opacity":{type:"number",minimum:0,maximum:1,default:1},"raster-hue-rotate":{type:"number",default:0},"raster-brightness-min":{type:"number",minimum:0,maximum:1,default:0},"raster-brightness-max":{type:"number",minimum:0,maximum:1,default:1},"raster-saturation":{type:"number",
minimum:-1,maximum:1,default:0},"raster-contrast":{type:"number",minimum:-1,maximum:1,default:0},"raster-fade-duration":{type:"number",minimum:0,default:300}};n.circlePaintDefinition={"circle-blur":{type:"number",minimum:0,default:0},"circle-color":{type:"color",default:[0,0,0,1]},"circle-opacity":{type:"number",minimum:0,maximum:1,default:1},"circle-radius":{type:"number",minimum:0,default:5},"circle-stroke-color":{type:"color",default:[0,0,0,1]},"circle-stroke-opacity":{type:"number",minimum:0,
maximum:1,default:1},"circle-stroke-width":{type:"number",minimum:0,default:0},"circle-translate":{type:"array",value:"number",length:2,default:[0,0]},"circle-translate-anchor":{type:"enum",values:["map","viewport"],default:a.TranslateAnchor.MAP}};a.StyleDefinition=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/decluttering/SymbolDeclutterer":function(){define(["exports","./config"],function(a,b){function n(p,h){if(p.priority-h.priority)return p.priority-
h.priority;const e=p.tile.key,g=h.tile.key;return e.world-g.world?e.world-g.world:e.level-g.level?e.level-g.level:e.row-g.row?e.row-g.row:e.col-g.col?e.col-g.col:p.xTile-h.xTile?p.xTile-h.xTile:p.yTile-h.yTile}class k{get running(){return this._running}constructor(p,h,e,g,d,f){this._visibleTiles=p;this._symbolRepository=h;this._createCollisionJob=e;this._assignTileSymbolsOpacity=g;this._symbolLayerSorter=d;this._isLayerVisible=f;this._selectionJob=null;this._selectionJobCompleted=!1;this._collisionJob=
null;this._collisionJobCompleted=!1;this._opacityJob=null;this._opacityJobCompleted=!1;this._running=!0}setScreenSize(p,h){this._screenWidth===p&&this._screenHeight===h||this.restart();this._screenWidth=p;this._screenHeight=h}restart(){this._selectionJob=null;this._selectionJobCompleted=!1;this._collisionJob=null;this._collisionJobCompleted=!1;this._opacityJob=null;this._opacityJobCompleted=!1;this._running=!0}continue(p){this._selectionJob||(this._selectionJob=this._createSelectionJob());if(!this._selectionJobCompleted){var h=
performance.now();if(!this._selectionJob.work(p))return!1;this._selectionJobCompleted=!0;p=Math.max(0,p-(performance.now()-h));if(0===p)return!1}this._collisionJob||(this._collisionJob=this._createCollisionJob(this._selectionJob.sortedSymbols,this._screenWidth,this._screenHeight));if(!this._collisionJobCompleted){h=performance.now();if(!this._collisionJob.work(p))return!1;this._collisionJobCompleted=!0;p=Math.max(0,p-(performance.now()-h));if(0===p)return!1}this._opacityJob||(this._opacityJob=this._createOpacityJob());
if(!this._opacityJobCompleted){h=performance.now();if(!this._opacityJob.work(p))return!1;this._opacityJobCompleted=!0;p=Math.max(0,p-(performance.now()-h));if(0===p)return!1}this._running=!1;return!0}_createSelectionJob(){const p=this._symbolRepository.uniqueSymbols;for(let c=0;c<p.length;c++){const l=p[c];for(let w=0;w<l.uniqueSymbols.length;w++){const x=l.uniqueSymbols[w];for(const u of x.tileSymbols)u.selectedForRendering=!1}}const h=[];let e=0,g=0;const d=this._isLayerVisible,f=this._symbolLayerSorter;
return{work:function(c){const l=performance.now();for(;g<p.length;g++,e=0){const x=p[g];var w=x.styleLayerUID;if(!d(w)){h[g]||(h[g]={styleLayerUID:w,symbols:[]});continue}h[g]=h[g]||{styleLayerUID:w,symbols:[]};const u=h[g];for(;e<x.uniqueSymbols.length;e++){w=x.uniqueSymbols[e];if(99===e%100&&performance.now()-l>c)return!1;let t=null,m=!1,q=!1;for(const r of w.tileSymbols)if(!q||!m){const v=r.tile;if(!t||v.isCoverage||v.neededForCoverage&&!m){t=r;if(v.neededForCoverage||v.isCoverage)q=!0;v.isCoverage&&
(m=!0)}}t.selectedForRendering=!0;if(q){u.symbols.push(t);w.show=!0;for(const r of w.parts)r.show=!0}else w.show=!1}}for(const x of h)x.symbols.sort(n);return!0},get sortedSymbols(){return h.sort(f)}}}_createOpacityJob(){function p(d,f){for(const w of d.symbols.values()){var c=w,l=f;for(const x of c){c=x.unique;for(const u of c.parts)u.startOpacity+=(l-u.startTime)/b.fadeDuration*(.5<u.targetOpacity?1:-1),u.startOpacity=Math.min(Math.max(u.startOpacity,0),1),u.startTime=l,u.targetOpacity=c.show&&
u.show?1:0}}h(d,f);for(const w of d.childrenTiles)p(w,f)}const h=this._assignTileSymbolsOpacity,e=this._visibleTiles;let g=0;return{work(d){const f=performance.now();for(;g<e.length;g++){if(performance.now()-f>d)return!1;const c=e[g];if(null!=c.parentTile)continue;const l=performance.now();p(c,l)}return!0}}}}a.SymbolDeclutterer=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/decluttering/SymbolRepository":function(){define(["exports","./util"],function(a,
b){class n{constructor(k,p,h){this.tileCoordRange=k;this._visibleTiles=p;this._createUnique=h;this._tiles=new Map;this._uniqueSymbolsReferences=new Map}get uniqueSymbols(){null==this._uniqueSymbolLayerArray&&(this._uniqueSymbolLayerArray=this._createUniqueSymbolLayerArray());return this._uniqueSymbolLayerArray}get uniqueSymbolsReferences(){return this._uniqueSymbolsReferences}add(k,p){this._uniqueSymbolLayerArray=null;let h=this._tiles.get(k.id);h||(h={symbols:new Map},this._tiles.set(k.id,h));var e=
new Map;if(p)for(var g of p)h.symbols.has(g)&&(e.set(g,h.symbols.get(g)),h.symbols.delete(g));else for(var [d]of k.layerData)h.symbols.has(d)&&(e.set(d,h.symbols.get(d)),h.symbols.delete(d));this._removeSymbols(e);p=k.symbols;e=new Map;for(const [f,c]of p)if(g=c.length,32<=g){d=this.tileCoordRange;do d/=2,g/=4;while(8<g&&64<d);g=new b.GridIndex(this.tileCoordRange,this.tileCoordRange,d);e.set(f,{flat:c,index:g});h.symbols.set(f,{flat:c,index:g});for(const l of c)g.getCell(l.xTile,l.yTile).push(l)}else e.set(f,
{flat:c}),h.symbols.set(f,{flat:c});this._addSymbols(k.key,p)}deleteStyleLayers(k){this._uniqueSymbolLayerArray=null;for(const [p,h]of this._tiles){const e=new Map;for(const g of k)h.symbols.has(g)&&(e.set(g,h.symbols.get(g)),h.symbols.delete(g));this._removeSymbols(e);0===h.symbols.size&&this._tiles.delete(p)}}removeTile(k){this._uniqueSymbolLayerArray=null;const p=this._tiles.get(k.id);if(p){var h=new Map;for(const [e]of k.symbols)p.symbols.has(e)&&(h.set(e,p.symbols.get(e)),p.symbols.delete(e));
this._removeSymbols(h);0===p.symbols.size&&this._tiles.delete(k.id)}}querySymbols(k,p,h,e){e=[];var g=this.uniqueSymbols;for(const f of g){g=f.styleLayerUID;var d=f.uniqueSymbols;for(const c of d)(d=c.tileSymbols.find(l=>l.selectedForRendering))&&b.isSearchCircleOverlapingSymbol(d,k,p*(window.devicePixelRatio||1),h)&&e.push({vtlSymbol:d,styleLayerUID:g,tileKey:d.tile.key})}return e}_removeSymbols(k){for(const [h,{flat:e}]of k)for(const g of e){k=g.unique;var p=k.tileSymbols;const d=p.length-1;for(let f=
0;f<d;f++)if(p[f]===g){p[f]=p[d];break}p.length=d;0===d&&(p=this._uniqueSymbolsReferences.get(h),p.delete(k),0===p.size&&this._uniqueSymbolsReferences.delete(h));g.unique=null}}_addSymbols(k,p){if(0!==p.size){var h=this._visibleTiles;for(const e of h)e.parentTile||e.key.world!==k.world||e.key.level===k.level&&!e.key.equals(k)||this._matchSymbols(e,k,p);for(const [e,g]of p)for(const d of g)null==d.unique&&(k=this._createUnique(),d.unique=k,k.tileSymbols.push(d),p=this._uniqueSymbolsReferences.get(e),
p||(p=new Set,this._uniqueSymbolsReferences.set(e,p)),p.add(k))}}_matchSymbols(k,p,h){if(k.key.level>p.level){var e=k.key.level-p.level;if(k.key.row>>e!==p.row||k.key.col>>e!==p.col)return}if(p.level>k.key.level&&(e=p.level-k.key.level,p.row>>e!==k.key.row||p.col>>e!==k.key.col))return;if(p.equals(k.key))for(var g of k.childrenTiles)this._matchSymbols(g,p,h);else{g=new Map;for(const [c,l]of h){var d=[];for(const x of l)h=b.tileCoordChange(this.tileCoordRange,x.xTile,p.level,p.col,k.key.level,k.key.col),
e=b.tileCoordChange(this.tileCoordRange,x.yTile,p.level,p.row,k.key.level,k.key.row),0<=h&&h<this.tileCoordRange&&0<=e&&e<this.tileCoordRange&&d.push({symbol:x,xTransformed:h,yTransformed:e});h=[];e=(k.key.level<p.level?1:1<<k.key.level-p.level)+20;const w=this._tiles.get(k.id).symbols.get(c);if(w){const x=w.flat;for(const u of d){var f=!1;let t;const m=u.xTransformed,q=u.yTransformed;t=null!=w.index?w.index.getCell(m,q):x;d=u.symbol;const r=d.hash;for(const v of t)if(r===v.hash&&Math.abs(m-v.xTile)<=
e&&Math.abs(q-v.yTile)<=e){f=v.unique;d.unique=f;f.tileSymbols.push(d);f=!0;break}f||h.push(d)}}0<h.length&&g.set(c,h)}for(const c of k.childrenTiles)this._matchSymbols(c,p,g)}}_createUniqueSymbolLayerArray(){var k=this._uniqueSymbolsReferences;const p=Array(k.size);let h=0;for(const [e,g]of k){const d=Array(g.size);k=0;for(const f of g)d[k++]=f;p[h]={styleLayerUID:e,uniqueSymbols:d};h++}return p}}a.SymbolRepository=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/RenderableTile":function(){define(["exports",
"../../../../core/libs/gl-matrix-2/factories/mat3f32","./TiledDisplayObject"],function(a,b,n){class k extends n.TiledDisplayObject{_createTransforms(){return{displayViewScreenMat3:b.create(),tileMat3:b.create()}}}a.RenderableTile=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/TiledDisplayObject":function(){define(["exports","../../../../core/libs/gl-matrix-2/math/mat3","../DisplayObject","../../tiling/TileKey"],function(a,b,n,k){class p extends n.DisplayObject{constructor(h,
e,g,d,f,c,l=f,w=c){super();this.tileDebugInfoTexture=null;this.debugInfo={display:{length:0,minOrderedLength:0,minUnorderedLength:0,triangleCount:0},memory:{bytesUsed:0,bytesReserved:0}};this._destroyed=!1;this.key=new k(h);this.resolution=e;this.x=g;this.y=d;this.width=f;this.height=c;this.rangeX=l;this.rangeY=w}destroy(){this.tileDebugInfoTexture&&(this.tileDebugInfoTexture.dispose(),this.tileDebugInfoTexture=null);this._destroyed=!0}get debugSlot(){let h=this;for(;h.parent!==this._stage;){if(!h.parent)return 0;
h=h.parent}return this._stage.children.indexOf(h)}setTransform(h){const e=this.resolution/(h.resolution*h.pixelRatio),g=this.transforms.tileMat3,[d,f]=h.toScreenNoRotation([0,0],[this.x,this.y]);b.set(g,this.width/this.rangeX*e,0,0,0,this.height/this.rangeY*e,0,d,f,1);b.multiply(this.transforms.displayViewScreenMat3,h.displayViewMat3,g)}get destroyed(){return this._destroyed}}a.TiledDisplayObject=p;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/DisplayObject":function(){define(["exports",
"../../../core/arrayUtils","../../../core/Evented","./transitions/FadeTransition"],function(a,b,n,k){class p extends n{constructor(){super(...arguments);this._fadeTransition=this._clips=this._transitionables=null;this._isReady=!1;this._opacity=1;this._stage=this.parent=null;this._visible=!0}get computedOpacity(){return this._fadeTransition?.computedOpacity??this.opacity}get clips(){return this._clips}set clips(h){this._clips=h;this.requestRender()}get fadeTransitionEnabled(){return null!==this._fadeTransition}set fadeTransitionEnabled(h){!this._fadeTransition&&
h?(this._fadeTransition=new k.FadeTransition({opacity:this.opacity,visible:this.visible}),this.addTransitionable(this._fadeTransition)):this._fadeTransition&&!h&&(this.removeTransitionable(this._fadeTransition),this._fadeTransition=null)}get inFadeTransition(){return this._fadeTransition?.transitioning??!1}get isReady(){return this._isReady}get opacity(){return this._opacity}set opacity(h){this._opacity!==h&&(this._opacity=Math.min(1,Math.max(h,0)),this._fadeTransition&&(this._fadeTransition.opacity=
this._opacity),this.requestRender())}get stage(){return this._stage}set stage(h){if(this._stage!==h){var e=this._stage;(this._stage=h)?this._stage?.untrashDisplayObject(this)||(this.onAttach(),this.emit("attach")):e?.trashDisplayObject(this)}}get transforms(){null==this._transforms&&(this._transforms=this._createTransforms());return this._transforms}get transitioning(){return this.isTransitioning()}get visible(){return this._visible}set visible(h){this._visible!==h&&(this._visible=h,this._fadeTransition&&
(this._fadeTransition.visible=this._visible),this.requestRender())}get hasLabels(){return!1}get hasHighlight(){return!1}get hasBlending(){return!1}addTransitionable(h){this._transitionables??(this._transitionables=[]);this._transitionables.push(h);this.requestRender()}removeTransitionable(h){h.endTransition();this._transitionables&&b.remove(this._transitionables,h);this.requestRender()}fadeIn(){this.fadeTransitionEnabled=!0;const h=this._fadeTransition.fadeIn();this.opacity=1;this.requestRender();
return h}fadeOut(){this.fadeTransitionEnabled=!0;const h=this._fadeTransition.fadeOut();this.opacity=0;this.requestRender();return h}endTransitions(){if(this._transitionables){for(const h of this._transitionables)h.endTransition();this.requestRender()}}beforeRender(h){this.transitionStep(h.deltaTime,h.state.scale);this.setTransform(h.state)}afterRender(h){this.transitioning&&this.requestRender()}remove(){this.parent?.removeChild(this)}setTransform(h){}processRender(h){this.stage&&(this._fadeTransition?.computedVisible??
this.visible)&&this.doRender(h)}requestRender(){this.stage&&this.stage.requestRender()}processDetach(){this.endTransitions();this.onDetach();this.emit("detach")}isTransitioning(){return this._transitionables?.some(h=>h.transitioning)??!1}transitionStep(h,e){if(this._transitionables)for(const g of this._transitionables)g.transitionStep(h,e)}onAttach(){}onDetach(){}doRender(h){}ready(){this._isReady||(this._isReady=!0,this.emit("isReady"),this.requestRender())}}a.DisplayObject=p;Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/transitions/FadeTransition":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/has ../../../../core/promiseUtils ../../../../core/accessorSupport/decorators/property ../../../../core/Logger ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass".split(" "),function(a,b,n,k,p,h,e,g,d){a.FadeTransition=class extends n{constructor(f){super(f);this.computedOpacity=1;this.computedVisible=
!0;this.opacity=1;this.visible=!0;this._fadeInResolver=this._fadeOutResolver=null}get transitioning(){return(this._fadeOutResolver||!this.visible?0:this.opacity)!==this.computedOpacity}endTransition(){this._fadeInResolver?.();this._fadeOutResolver?.();this._fadeInResolver=this._fadeOutResolver=null;this.computedOpacity=this.visible?this.opacity:0}fadeIn(){if(this._fadeInResolver)return this._fadeInResolver.promise;this.opacity=1;this.computedOpacity=0;this._fadeOutResolver?.();this._fadeOutResolver=
null;this._fadeInResolver=p.createResolver();return this._fadeInResolver.promise}fadeOut(){if(this._fadeOutResolver)return this._fadeOutResolver.promise;this.opacity=0;this._fadeInResolver?.();this._fadeInResolver=null;this._fadeOutResolver=p.createResolver();return this._fadeOutResolver.promise}transitionStep(f,c){const l=(c=k("mapview-transitions-duration"))?1/c:0;if(0===l)this.computedOpacity=this.opacity,this.computedVisible=this.visible;else{c=this._fadeOutResolver||!this.visible?0:this.opacity;
const w=this.computedOpacity;w===c?this.computedVisible=this.visible:(f*=l,this.computedOpacity=w>c?Math.max(c,w-f):Math.min(c,w+f),this.computedVisible=0<this.computedOpacity)}this.transitioning||(this._fadeInResolver?.(),this._fadeOutResolver?.(),this._fadeOutResolver=this._fadeInResolver=null)}};b.__decorate([h.property()],a.FadeTransition.prototype,"computedOpacity",void 0);b.__decorate([h.property()],a.FadeTransition.prototype,"computedVisible",void 0);b.__decorate([h.property()],a.FadeTransition.prototype,
"opacity",void 0);b.__decorate([h.property()],a.FadeTransition.prototype,"visible",void 0);b.__decorate([h.property()],a.FadeTransition.prototype,"transitioning",null);b.__decorate([h.property()],a.FadeTransition.prototype,"_fadeOutResolver",void 0);b.__decorate([h.property()],a.FadeTransition.prototype,"_fadeInResolver",void 0);a.FadeTransition=b.__decorate([d.subclass("esri.views.2d.engine.transitions.FadeTransition")],a.FadeTransition);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/2d/engine/webgl/TileReshuffleManager":function(){define(["exports"],function(a){class b{constructor(){this._candidateTiles=[]}schedule(n){this._candidateTiles.includes(n)||this._candidateTiles.push(n)}reshuffle(n){const k=[];for(const p of this._candidateTiles)0<n?(p.reshuffle(),n--):k.push(p);this._candidateTiles=k}}a.TileReshuffleManager=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/BlendLayersTechniqueConfiguration":function(){define(["exports",
"../../../chunks/tslib.es6","./TileBlendTechniqueConfiguration","../../../chunks/BlendLayers.glsl","../webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration"],function(a,b,n,k,p){class h extends n.TileBlendTechniqueConfiguration{constructor(){super(...arguments);this.background=k.BackgroundMode.BelowLayer}}b.__decorate([p.parameter({count:k.BackgroundMode.COUNT})],h.prototype,"background",void 0);a.BlendLayersTechniqueConfiguration=h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/terrain/TileBlendTechniqueConfiguration":function(){define("exports ../../../chunks/tslib.es6 ./BlendModeTechniqueConfiguration ../webgl-engine/core/shaderLibrary/terrain/BaseOpacityMode ../webgl-engine/core/shaderLibrary/terrain/BlendLayersOutput ../webgl-engine/core/shaderLibrary/terrain/PremultipliedAlphaSource ../webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration".split(" "),function(a,b,n,k,p,h,e){class g extends n.BlendModeTechniqueConfiguration{constructor(){super(...arguments);
this.output=p.BlendLayersOutput.Composite;this.baseOpacityMode=k.BaseOpacityMode.NotRequired;this.premultipliedSource=h.PremultipliedAlphaSource.Off}}b.__decorate([e.parameter({count:p.BlendLayersOutput.COUNT})],g.prototype,"output",void 0);b.__decorate([e.parameter({count:k.BaseOpacityMode.COUNT})],g.prototype,"baseOpacityMode",void 0);b.__decorate([e.parameter({count:h.PremultipliedAlphaSource.COUNT})],g.prototype,"premultipliedSource",void 0);a.TileBlendTechniqueConfiguration=g;Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/BlendModeTechniqueConfiguration":function(){define(["exports","../../../chunks/tslib.es6","../webgl-engine/core/shaderLibrary/output/BlendOptions","../webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration"],function(a,b,n,k){class p extends k.ShaderTechniqueConfiguration{constructor(){super(...arguments);this.blendMode=n.LayerBlendMode.Normal}}b.__decorate([k.parameter({count:n.LayerBlendMode.COUNT})],p.prototype,"blendMode",
void 0);a.BlendModeTechniqueConfiguration=p;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/RasterColorizerTechnique":function(){define(["require","exports","../../../chunks/RasterColorizer.glsl","../webgl-engine/core/shaderTechnique/ReloadableShaderModule","../webgl-engine/core/shaderTechnique/ShaderTechnique"],function(a,b,n,k,p){class h extends p.ShaderTechnique{constructor(e,g,d){super(e,g,new k.ReloadableShaderModule(n.RasterColorizer,()=>new Promise((f,
c)=>a(["../webgl-engine/core/shaderLibrary/raster/RasterColorizer.glsl"],f,c))),d)}}b.RasterColorizerTechnique=h;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/RasterColorizer.glsl":function(){define("exports ../core/libs/gl-matrix-2/factories/vec3f64 ../views/2d/engine/imagery/enums ../views/3d/webgl-engine/core/shaderLibrary/raster/Colormap.glsl ../views/3d/webgl-engine/core/shaderLibrary/raster/Common.glsl ../views/3d/webgl-engine/core/shaderLibrary/terrain/TileBackground.glsl ../views/3d/webgl-engine/core/shaderLibrary/terrain/TileComposite.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl ../views/3d/webgl-engine/core/shaderModules/BooleanPassUniform ../views/3d/webgl-engine/core/shaderModules/Float2PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/FloatsPassUniform ../views/3d/webgl-engine/core/shaderModules/IntegerPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w,x,u,t){function m(A){const C=new u.ShaderBuilder;C.include(e.TileComposite);C.include(p.Common,A);C.include(k.Colormap,A);C.include(h.TileBackground,A);C.fragment.code.add(x.glsl`vec4 applyBackgroundBlend(vec4 layerColor) {
return blendLayers(vuv, layerColor, u_opacity);
}`);A.colorizerType===n.RasterColorizerType.Stretch?q(C,A):A.colorizerType===n.RasterColorizerType.Lut?C.fragment.main.add(x.glsl`vec2 pixelLocation = getPixelLocation(uv);
if (isOutside(pixelLocation)) {
fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
return;
}
vec4 currentPixel = getPixel(pixelLocation);
fragColor = applyBackgroundBlend(colormap(currentPixel, true));`):A.colorizerType===n.RasterColorizerType.Hillshade&&r(C,A);return C}function q(A,C){A.fragment.uniforms.add(new w.IntegerPassUniform("u_bandCount",E=>E.symbolizer.u_bandCount),new l.FloatsPassUniform("u_minCutOff",E=>E.symbolizer.u_minCutOff,3),new l.FloatsPassUniform("u_maxCutOff",E=>E.symbolizer.u_maxCutOff,3),new l.FloatsPassUniform("u_factor",E=>E.symbolizer.u_factor,3),new c.FloatPassUniform("u_minOutput",E=>E.symbolizer.u_minOutput),
new c.FloatPassUniform("u_maxOutput",E=>E.symbolizer.u_maxOutput),new d.BooleanPassUniform("u_useGamma",E=>E.symbolizer.u_useGamma),new l.FloatsPassUniform("u_gamma",E=>E.symbolizer.u_gamma,3),new l.FloatsPassUniform("u_gammaCorrection",E=>E.symbolizer.u_gammaCorrection,3),new c.FloatPassUniform("u_opacity",E=>E.common.u_opacity));A.fragment.code.add(x.glsl`float stretchOneValue(float val, float minCutOff, float maxCutOff, float minOutput, float maxOutput, float factor, bool useGamma, float gamma, float gammaCorrection) {
if (val >= maxCutOff) {
return maxOutput;
} else if (val <= minCutOff) {
return minOutput;
}
float stretchedVal;
if (useGamma) {
float tempf = 1.0;
float outRange = maxOutput - minOutput;
float relativeVal = (val - minCutOff) / (maxCutOff - minCutOff);
if (gamma > 1.0) {
tempf -= pow(1.0 / outRange, relativeVal * gammaCorrection);
}
stretchedVal = (tempf * outRange * pow(relativeVal, 1.0 / gamma) + minOutput) / 255.0;
} else {
stretchedVal = minOutput + (val - minCutOff) * factor;
}
return stretchedVal;
}`);const H=C.applyColormap?x.glsl`fragColor = applyBackgroundBlend(colormap(vec4(grayVal, grayVal, grayVal, currentPixel.a), !u_useGamma));`:x.glsl`fragColor = applyBackgroundBlend(vec4(grayVal, grayVal, grayVal, currentPixel.a));`;A.fragment.main.add(x.glsl`
    vec2 pixelLocation = getPixelLocation(uv);
    if (isOutside(pixelLocation)) {
      fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
      return;
    }

    vec4 currentPixel = getPixel(pixelLocation);
    ${C.stretchType===n.RasterColorizerStretchType.Noop?x.glsl`fragColor = applyBackgroundBlend(currentPixel);`:x.glsl`
    if (currentPixel.a == 0.0) {
      fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
      return;
    }
    if (u_bandCount == 1) {
      float grayVal = stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_useGamma, u_gamma[0], u_gammaCorrection[0]);
      ${H}
    } else {
      float redVal = stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_useGamma, u_gamma[0], u_gammaCorrection[0]);
      float greenVal = stretchOneValue(currentPixel.g, u_minCutOff[1], u_maxCutOff[1], u_minOutput, u_maxOutput, u_factor[1], u_useGamma, u_gamma[1], u_gammaCorrection[1]);
      float blueVal = stretchOneValue(currentPixel.b, u_minCutOff[2], u_maxCutOff[2], u_minOutput, u_maxOutput, u_factor[2], u_useGamma, u_gamma[2], u_gammaCorrection[2]);
      fragColor = applyBackgroundBlend(vec4(redVal, greenVal, blueVal, currentPixel.a));
    }`}`)}function r(A,C){A=A.fragment;A.uniforms.add(new t.Texture2DPassUniform("u_image",H=>H.u_image),new w.IntegerPassUniform("u_hillshadeType",H=>H.symbolizer.u_hillshadeType),new l.FloatsPassUniform("u_sinZcosAs",H=>H.symbolizer.u_sinZcosAs,6),new l.FloatsPassUniform("u_sinZsinAs",H=>H.symbolizer.u_sinZsinAs,6),new l.FloatsPassUniform("u_cosZs",H=>H.symbolizer.u_cosZs,6),new l.FloatsPassUniform("u_weights",H=>H.symbolizer.u_weights,6),new f.Float2PassUniform("u_factor",H=>H.symbolizer.u_factor),
new c.FloatPassUniform("u_minValue",H=>H.symbolizer.u_minValue),new c.FloatPassUniform("u_maxValue",H=>H.symbolizer.u_maxValue),new f.Float2PassUniform("u_srcImageSize",H=>H.common.u_srcImageSize));A.include(g.ColorConversion);A.code.add(x.glsl`vec4 overlay(float val, float minValue, float maxValue, float hillshade, float alpha) {
val = clamp((val - minValue) / (maxValue - minValue), 0.0, 1.0);
vec4 color = colormap(vec4(val, val, val, 1.0), false);
vec3 hsv = rgb2hsv(color.rgb);
hsv.z = hillshade;
return vec4(hsv2rgb(hsv), 1.0) * alpha * color.a;
}`);A.code.add(x.glsl`float getNeighborHoodAlpha(float a, float b, float c, float d, float e, float f, float g, float h, float i){
if (a == 0.0 || a == 0.0 || a==0.0 || a == 0.0 || a == 0.0 || a==0.0 || a == 0.0 || a == 0.0 || a==0.0) {
return 0.0;
}  else {
return e;
}
}`);C=C.applyColormap?x.glsl`fragColor = applyBackgroundBlend(overlay(ve.r, u_minValue, u_maxValue, hillshade, alpha));`:x.glsl`hillshade *= alpha;
fragColor = applyBackgroundBlend(vec4(hillshade, hillshade, hillshade, alpha));`;A.main.add(x.glsl`
      vec2 pixelLocation = getPixelLocation(uv);
      if (isOutside(pixelLocation)) {
        fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
        return;
      }

      vec4 currentPixel = getPixel(pixelLocation);
      if (currentPixel.a == 0.0) {
        fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
        return;
      }

      //mirror edge pixels
      vec2 axy = vec2(-1.0, -1.0);
      vec2 bxy = vec2(0.0, -1.0);
      vec2 cxy = vec2(1.0, -1.0);
      vec2 dxy = vec2(-1.0, 0.0);
      vec2 fxy = vec2(1.0, 0.0);
      vec2 gxy = vec2(-1.0, 1.0);
      vec2 hxy = vec2(0.0, 1.0);
      vec2 ixy = vec2(1.0, 1.0);
      vec2 onePixel = 1.0 / u_srcImageSize;
      if (pixelLocation.s < onePixel.s) {
        axy[0] = 1.0;
        dxy[0] = 1.0;
        gxy[0] = 1.0;
      }
      if (pixelLocation.t < onePixel.t) {
        axy[1] = 1.0;
        bxy[1] = 1.0;
        cxy[1] = 1.0;
      }
      if (pixelLocation.s > 1.0 - onePixel.s) {
        cxy[0] = -1.0;
        fxy[0] = -1.0;
        ixy[0] = -1.0;
      }
      if (pixelLocation.t > 1.0 - onePixel.t) {
        gxy[1] = -1.0;
        hxy[1] = -1.0;
        ixy[1] = -1.0;
      }

      // calculate hillshade
      vec4 va = texture(u_image, pixelLocation + onePixel * axy);
      vec4 vb = texture(u_image, pixelLocation + onePixel * bxy);
      vec4 vc = texture(u_image, pixelLocation + onePixel * cxy);
      vec4 vd = texture(u_image, pixelLocation + onePixel * dxy);
      vec4 ve = texture(u_image, pixelLocation);
      vec4 vf = texture(u_image, pixelLocation + onePixel * fxy);
      vec4 vg = texture(u_image, pixelLocation + onePixel * gxy);
      vec4 vh = texture(u_image, pixelLocation + onePixel * hxy);
      vec4 vi = texture(u_image, pixelLocation + onePixel * ixy);

      // calculate the rate of z change along the x, y, and diagonal direction
      float dzx = (vc + 2.0 * vf + vi - va - 2.0 * vd - vg).r * u_factor.s;
      float dzy = (vg + 2.0 * vh + vi - va - 2.0 * vb - vc).r * u_factor.t;
      float dzd = sqrt(1.0 + dzx * dzx + dzy * dzy);
      float hillshade = 0.0;

      // traditional single light source
      if (u_hillshadeType == 0){
        float cosDelta = u_sinZsinAs[0] * dzy - u_sinZcosAs[0] * dzx;
        float z = (u_cosZs[0] + cosDelta) / dzd;
        if (z < 0.0)  z = 0.0;
        hillshade = z;
      } else {
        // multi-directional with 6 light sources
        for (int k = 0; k < 6; k++) {
        float cosDelta = u_sinZsinAs[k] * dzy - u_sinZcosAs[k] * dzx;
        float z = (u_cosZs[k] + cosDelta) / dzd;
        if (z < 0.0) z = 0.0;
        hillshade = hillshade + z * u_weights[k];
        if (k == 5) break;
        }
      }

      // set color
      float alpha = getNeighborHoodAlpha(va.a, vb.a, vc.a, vd.a, ve.a, vf.a, vg.a, vh.a, vi.a);
      alpha *= u_opacity;
      ${C}`)}class v extends p.CommonPassParameters{constructor(A,C,H,E,F,G){super(A,E,F);this.colormap=C;this.symbolizer=H;this.u_colormap=G;this.backgroundColor=b.ZEROS;this.fboTexture=null;this.baseOpacity=1}}class y extends v{}class B extends v{}const z=Object.freeze(Object.defineProperty({__proto__:null,ColorizerHillshadeUniforms:B,ColorizerStretchUniforms:y,ColorizerUniforms:v,build:m},Symbol.toStringTag,{value:"Module"}));a.ColorizerHillshadeUniforms=B;a.ColorizerStretchUniforms=y;a.ColorizerUniforms=
v;a.RasterColorizer=z;a.build=m})},"esri/views/3d/webgl-engine/core/shaderLibrary/raster/Colormap.glsl":function(){define(["exports","../../shaderModules/FloatPassUniform","../../shaderModules/interfaces","../../shaderModules/Texture2DPassUniform"],function(a,b,n,k){a.Colormap=function(p){p.fragment.uniforms.add(new k.Texture2DPassUniform("u_colormap",h=>h.u_colormap),new b.FloatPassUniform("u_colormapOffset",h=>h.colormap.u_colormapOffset),new b.FloatPassUniform("u_colormapMaxIndex",h=>h.colormap.u_colormapMaxIndex),
new b.FloatPassUniform("u_opacity",h=>h.common.u_opacity));p.fragment.code.add(n.glsl`vec4 colormap(vec4 currentPixel, bool isFloat) {
float colorIndex = isFloat ? currentPixel.r - u_colormapOffset : currentPixel.r * 255.0 - u_colormapOffset;
vec4 result;
if (currentPixel.a == 0.0 || colorIndex > u_colormapMaxIndex) {
result = vec4(0.0, 0.0, 0.0, 0.0);
} else {
vec2 texelCoordinates = vec2((colorIndex + 0.5), 0.5);
result = texelFetch(u_colormap, ivec2(texelCoordinates), 0);
}
return result;
}`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/raster/Common.glsl":function(){define("exports ./Projection.glsl ../terrain/TileComposite.glsl ../../shaderModules/BooleanPassUniform ../../shaderModules/Float2PassUniform ../../shaderModules/interfaces ../../shaderModules/Texture2DPassUniform".split(" "),function(a,b,n,k,p,h,e){class g extends n.TileCompositePassParameters{constructor(d,f,c){super();this.common=d;this.u_image=f;this.u_transformGrid=
c}}a.Common=function(d,f){d.include(b.Projection);d.fragment.uniforms.add(new e.Texture2DPassUniform("u_image",c=>c.u_image),new k.BooleanPassUniform("u_flipY",c=>c.common.u_flipY),new k.BooleanPassUniform("u_applyTransform",c=>c.common.u_applyTransform));({requireBilinearWithNN:f}=f);f&&d.fragment.uniforms.add(new p.Float2PassUniform("u_srcImageSize",c=>c.common.u_srcImageSize));d.fragment.code.add(h.glsl`vec2 getPixelLocation(vec2 coords) {
vec2 targetLocation = u_flipY ? vec2(coords.s, 1.0 - coords.t) : coords;
if (!u_applyTransform) {
return targetLocation;
}
return projectPixelLocation(targetLocation);
}
bool isOutside(vec2 coords){
if (coords.t>1.00001 ||coords.t<-0.00001 || coords.s>1.00001 ||coords.s<-0.00001) {
return true;
} else {
return false;
}
}`);f?d.fragment.code.add(h.glsl`vec4 sampleBilinear(sampler2D sampler, vec2 coords, vec2 texSize) {
vec2 texelStart = floor(coords * texSize);
vec2 coord0 = texelStart / texSize;
vec2 coord1 = (texelStart +  vec2(1.0, 0.0)) / texSize;
vec2 coord2 = (texelStart +  vec2(0.0, 1.0)) / texSize;
vec2 coord3 = (texelStart +  vec2(1.0, 1.0)) / texSize;
vec4 color0 = texture(sampler, coord0);
vec4 color1 = texture(sampler, coord1);
vec4 color2 = texture(sampler, coord2);
vec4 color3 = texture(sampler, coord3);
vec2 blend = fract(coords * texSize);
vec4 color01 = mix(color0, color1, blend.x);
vec4 color23 = mix(color2, color3, blend.x);
vec4 color = mix(color01, color23, blend.y);
float alpha = floor(color0.a * color1.a * color2.a * color3.a + 0.5);
color = color * alpha + (1.0 - alpha) * texture(sampler, coords);
return color;
}
vec4 getPixel(vec2 pixelLocation) {
return sampleBilinear(u_image, pixelLocation, u_srcImageSize);
}`):d.fragment.code.add(h.glsl`vec4 getPixel(vec2 pixelLocation) {
return texture(u_image, pixelLocation);
}`)};a.CommonPassParameters=g;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/raster/Projection.glsl":function(){define(["exports","../../shaderModules/Float2PassUniform","../../shaderModules/interfaces","../../shaderModules/Texture2DPassUniform"],function(a,b,n,k){a.Projection=function(p){p.fragment.uniforms.add(new k.Texture2DPassUniform("u_transformGrid",h=>h.u_transformGrid),new b.Float2PassUniform("u_transformSpacing",h=>h.common.u_transformSpacing),
new b.Float2PassUniform("u_targetImageSize",h=>h.common.u_targetImageSize));p.fragment.code.add(n.glsl`vec2 projectPixelLocation(vec2 coords) {
vec2 index_image = floor(coords * u_targetImageSize);
vec2 oneTransformPixel = vec2(4.0, 1.0);
vec2 index_transform = floor(index_image / u_transformSpacing) * oneTransformPixel;
vec2 pos = fract((index_image + 0.5) / u_transformSpacing);
vec2 transform_location = index_transform + 0.5;
vec2 srcLocation;
if (pos.s <= pos.t) {
vec3 ll_abc = texelFetch(u_transformGrid, ivec2(transform_location), 0).rgb;
vec3 ll_def = texelFetch(u_transformGrid, ivec2(transform_location.s + 1.0, transform_location.t), 0).rgb;
srcLocation.s = dot(ll_abc, vec3(pos, 1.0));
srcLocation.t = dot(ll_def, vec3(pos, 1.0));
} else {
vec3 ur_abc = texelFetch(u_transformGrid, ivec2(transform_location.s + 2.0, transform_location.t), 0).rgb;
vec3 ur_def = texelFetch(u_transformGrid, ivec2(transform_location.s + 3.0, transform_location.t), 0).rgb;
srcLocation.s = dot(ur_abc, vec3(pos, 1.0));
srcLocation.t = dot(ur_def, vec3(pos, 1.0));
}
return srcLocation;
}`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/RasterColorizerTechniqueConfiguration":function(){define(["exports","../../../chunks/tslib.es6","../../2d/engine/imagery/enums","./TileBlendTechniqueConfiguration","../webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration"],function(a,b,n,k,p){class h extends k.TileBlendTechniqueConfiguration{constructor(){super(...arguments);this.colorizerType=n.RasterColorizerType.Stretch;this.stretchType=n.RasterColorizerStretchType.Noop;
this.applyColormap=!0;this.requireBilinearWithNN=!1}}b.__decorate([p.parameter({count:n.RasterColorizerType.COUNT})],h.prototype,"colorizerType",void 0);b.__decorate([p.parameter({count:n.RasterColorizerStretchType.COUNT})],h.prototype,"stretchType",void 0);b.__decorate([p.parameter()],h.prototype,"applyColormap",void 0);b.__decorate([p.parameter()],h.prototype,"requireBilinearWithNN",void 0);a.RasterColorizerTechniqueConfiguration=h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/terrain/support/MultiSizeFramebuffer":function(){define(["exports","../../../webgl/enums","../../../webgl/FramebufferObject","../../../webgl/RenderbufferDescriptor","../../../webgl/TextureDescriptor"],function(a,b,n,k,p){class h{constructor(e){this._rctx=e;this._fbos=new Map}get(e){return this._getPool(e)}dispose(){this._fbos.forEach(e=>e.dispose());this._fbos.clear()}_getPool(e){var g=this._fbos.get(e);if(g)return g;g=new n.FramebufferObject(this._rctx,new p.TextureDescriptor(e),new k.RenderbufferDescriptor(b.RenderbufferFormat.DEPTH24_STENCIL8,
e));this._fbos.set(e,g);return g}}a.MultiSizeFramebuffer=h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/glUtil3D":function(){define("exports ./DefaultVertexAttributeLocations ./DefaultVertexBufferLayouts ./VertexArrayObject ../../../webgl/BufferObject ../../../webgl/enums ../../../webgl/Texture ../../../webgl/TextureDescriptor".split(" "),function(a,b,n,k,p,h,e,g){a.Layout=void 0;(function(f){f[f.Pos2=0]="Pos2";f[f.Pos2Tex=1]="Pos2Tex"})(a.Layout||
(a.Layout={}));const d=new Map([[a.Layout.Pos2,n.Pos2],[a.Layout.Pos2Tex,n.Pos2Tex]]);a.createEmptyTexture=function(f){const c=new g.TextureDescriptor(4);c.samplingMode=h.TextureSamplingMode.NEAREST;return new e.Texture(f,c)};a.createQuadVAO=function(f,c=a.Layout.Pos2,l=b.Default3D,w=-1,x=1){w=c===a.Layout.Pos2?new Float32Array([w,w,x,w,w,x,x,x]):new Float32Array([w,w,0,0,x,w,1,0,w,x,0,1,x,x,1,1]);return new k.VertexArrayObject(f,l,new Map([["geometry",d.get(c)]]),new Map([["geometry",p.BufferObject.createVertex(f,
h.Usage.STATIC_DRAW,w)]]))};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/TileRenderInfo":function(){define(["exports","../../../core/PooledArray"],function(a,b){class n{constructor(){this.sourceLod=[0,0,0];this.offset=[0,0];this.scale=1;this.layerIndex=0;this.isVTLBackground=!1;this.vtlNeighborInfos=new b({allocator:p=>p||new k})}}class k{constructor(){this.sourceLayerInfo=null;this.sourceLod=[0,0,0];this.offset=[-1,0]}}a.TileRenderInfo=n;a.VTLNeighhborInfo=
k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/TileTexture":function(){define(function(){class a{constructor(b,n){this._texture=b;this._cache=n;this.type="tile-texture";this._refCount=1}retain(){++this._refCount}release(){--this._refCount;0===this._refCount&&(this._cache?this._cache.put(`${this._texture.descriptor.width} ${this._texture.descriptor.pixelFormat}`,this):this.dispose())}dispose(){this._texture.dispose()}get texture(){return this._texture}generateMipmap(){this._texture.generateMipmap()}get descriptor(){return this._texture.descriptor}get usedMemory(){return this._texture.usedMemory}}
return a})},"esri/views/3d/webgl-engine/collections/Component/ComponentIntersectionData":function(){define(["exports","../../../../../core/mathUtils","../../../../../core/libs/gl-matrix-2/factories/vec3f64","../../../../../geometry/support/aaBoundingBox","../../lib/RayIntersections"],function(a,b,n,k,p){function h(m,q,r){let v=0,y=Infinity;for(let z=0;3>z;++z){var B=m[z];if(q[z]<B){if(1E-6>=r[z])return!1;v=Math.max(v,(B-q[z])/r[z])}else-1E-6>=r[z]&&(y=Math.min(y,(B-q[z])/r[z]));if(v>y)return!1;B=
m[z+3];if(q[z]>B){if(-1E-6<=r[z])return!1;v=Math.max(v,(B-q[z])/r[z])}else 1E-6<=r[z]&&(y=Math.min(y,(B-q[z])/r[z]));if(v>y)return!1}return!0}function e(m,q,r,v,y,B){let z=v;for(;r<z;){var A=m[r];q[6*A+y+3]<=B?++r:(--z,m[r]=m[z],m[z]=A)}A=r;for(z=v;A<z;)v=m[z-1],q[6*v+y]>=B?--z:(m[z-1]=m[A],m[A]=v,++A);return{next:r,mid:A}}function g(m,q,r,v){if(v<=r)return k.fromValues(NaN,NaN,NaN,NaN,NaN,NaN);var y=6*m[r];for(var B=0;3>B;++B)w[B]=q[y+0+B],x[B]=q[y+3+B];for(r+=1;r<v;++r)for(y=6*m[r],B=0;3>B;++B)w[B]=
Math.min(w[B],q[y+0+B]),x[B]=Math.max(x[B],q[y+3+B]);return k.fromValues(w[0],w[1],w[2],x[0],x[1],x[2])}function d(m){var q=m[3]-m[0];const r=m[4]-m[1],v=m[5]-m[2];q=q>r?q>v?0:r>v?1:2:r>v?1:v>q?2:0;return{axis:q,midValue:(m[q]+m[q+3])/2}}function f(m,q,r,v,y){r-=q;const B=new Float32Array(6*r);for(let A=0;A<r;++A){var z=3*(A+q);const C=m[z]*y,H=m[z+1]*y;z=m[z+2]*y;for(let E=0;3>E;++E){const F=v[C+E],G=v[H+E],D=v[z+E];B[6*A+E]=Math.min(F,G,D);B[6*A+3+E]=Math.max(F,G,D)}}return B}class c{constructor(m,
q,r,v,y){this.aabb=m;this.axis=q;this.d=r;this.midStartIndex=v;this.rightStartIndex=y}}class l{constructor(m,q,r,v){this.globalTriangleVertexIndices=m;this.firstTriangleIndex=q;this.positions=v;this._rayDirection=n.create();this._callback=t;this._intersectionOptions=u;this.bspNodeTree=[];const y=r-q,B=new (255>y?Uint8Array:65535>y?Uint16Array:Uint32Array)(y);this.triangleIndexMap=B;for(let H=0;H<y;++H)B[H]=H;const z=f(m,q,r,v.data,v.stride),A=b.clamp(Math.log2(y/40),2,10),C=(H,E,F)=>{var G=g(B,z,
H,E);const D=E-H;if(40>=D)return H=new c(G,void 0,0,H,E),this.bspNodeTree.push(H),H;const {axis:I,midValue:J}=d(G),N=e(B,z,H,E,I,J),M=(Q,O)=>{if(!(F>A)){var K=O-Q;if(!(40>K||K>=.8*D))return C(Q,O,F+1)}};G=new c(G,I,J,N.next,N.mid);this.bspNodeTree.push(G);G.leftNode=M(H,N.next);G.rightNode=M(N.mid,E);return G};C(0,y,0)}intersectRayTriangleRange(m,q){if(!(m>=q)){var r=this.positions;p.intersectRayTriangles(this._rayFrom,this._rayDirection,m,q,this.globalTriangleVertexIndices,r.data,r.stride,this._intersectionOptions.normalRequired,
this._callback,this.triangleIndexMap,this.firstTriangleIndex);l.numFacesTested+=q-m}}intersectRay(m,q,r,v){l.numFacesTested=0;var y=q[0]-m[0];const B=q[1]-m[1];q=q[2]-m[2];1E-6>y*y+B*B+q*q||(this._rayFrom=m,m=this._rayDirection,m[0]=y,m[1]=B,m[2]=q,y=this.triangleIndexMap.length,this._callback=v,this._intersectionOptions=r,this.intersectRayBSP(this.bspNodeTree[0],0,y),this._callback=t,this._intersectionOptions=u)}intersectRayBSP(m,q,r){const v=this._rayFrom,y=this._rayDirection;if(h(m.aabb,v,y)){var B=
m.axis,z=m.d;if(v[B]<z||0>y[B]){const A=m.midStartIndex;if(q<A){const C=m.leftNode;void 0!==C?this.intersectRayBSP(C,q,A):this.intersectRayTriangleRange(q,A)}}this.intersectRayTriangleRange(m.midStartIndex,m.rightStartIndex);if(v[B]>z||0<y[B])q=m.rightStartIndex,q<r&&(m=m.rightNode,void 0!==m?this.intersectRayBSP(m,q,r):this.intersectRayTriangleRange(q,r))}}get estimatedMemoryUsage(){return this.triangleIndexMap.byteLength}}l.numFacesTested=0;const w=[Infinity,Infinity,Infinity],x=[-Infinity,-Infinity,
-Infinity],u=new p.MeshIntersectionOptions,t=()=>{};a.ComponentIntersectionData=l;a.componentMinimalSizeForIntersectionData=200;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/TerrainTechniqueConfiguration":function(){define("exports ../../../../chunks/tslib.es6 ../../terrain/TransparencyMode ../core/shaderLibrary/attributes/NormalAttribute.glsl ../core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl ../core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../core/shaderLibrary/terrain/Overlay.glsl ../core/shaderLibrary/terrain/TileBlendInput ../core/shaderTechnique/ShaderTechniqueConfiguration ../materials/DefaultTechniqueConfiguration".split(" "),
function(a,b,n,k,p,h,e,g,d,f){class c extends f.DefaultTechniqueConfiguration{constructor(l){super();this.spherical=l;this.overlayMode=e.OverlayMode.Disabled;this.tileBlendInput=g.TileBlendInput.LayerOnly;this.transparencyMode=n.TransparencyMode.Opaque;this.pbrMode=h.PBRMode.Simplified;this.receiveAmbientOcclusion=this.screenSizePerspective=this.visualizeNormals=this.tileBorders=this.cloudReflections=this.screenSpaceReflections=this.renderOccluded=this.textureFadingEnabled=this.backfaceCullingEnabled=
this.hasSlicePlane=this.receiveShadows=this.doublePrecisionRequiresObfuscation=!1;this.normalType=k.NormalType.Compressed;this.textureCoordinateType=p.TextureCoordinateType.Compressed;this.useFillLights=this.useCustomDTRExponentForWater=this.highStepCount=!1;this.canHaveOverlay=this.hasColorTexture=!0}}b.__decorate([d.parameter({count:e.OverlayMode.COUNT})],c.prototype,"overlayMode",void 0);b.__decorate([d.parameter({count:g.TileBlendInput.COUNT})],c.prototype,"tileBlendInput",void 0);b.__decorate([d.parameter({count:n.TransparencyMode.COUNT})],
c.prototype,"transparencyMode",void 0);b.__decorate([d.parameter({count:h.PBRMode.COUNT})],c.prototype,"pbrMode",void 0);b.__decorate([d.parameter()],c.prototype,"doublePrecisionRequiresObfuscation",void 0);b.__decorate([d.parameter()],c.prototype,"receiveShadows",void 0);b.__decorate([d.parameter()],c.prototype,"hasSlicePlane",void 0);b.__decorate([d.parameter()],c.prototype,"backfaceCullingEnabled",void 0);b.__decorate([d.parameter()],c.prototype,"textureFadingEnabled",void 0);b.__decorate([d.parameter()],
c.prototype,"renderOccluded",void 0);b.__decorate([d.parameter()],c.prototype,"screenSpaceReflections",void 0);b.__decorate([d.parameter()],c.prototype,"cloudReflections",void 0);b.__decorate([d.parameter()],c.prototype,"tileBorders",void 0);b.__decorate([d.parameter()],c.prototype,"visualizeNormals",void 0);b.__decorate([d.parameter()],c.prototype,"screenSizePerspective",void 0);b.__decorate([d.parameter()],c.prototype,"receiveAmbientOcclusion",void 0);a.TerrainTechniqueConfiguration=c;Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/TerrainSurfacePerformanceInfo":function(){define(function(){class a{constructor(){this.numMerged=this.numSplit=this.numRendered=this.numVisible=this.numLeaves=this.numNodes=0;this.numRenderedPerLevel=[];this.numLoadedPerLevel=[]}}return a})},"esri/views/3d/terrain/TilingSchemeLogic":function(){define("exports ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/has ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ../../../geometry/support/aaBoundingRect ../../../layers/support/layerUtils ../../ViewingMode ../support/supportedSpatialReference ./terrainUtils ./TilingScheme".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w,x,u){a.TilingSchemeLogic=class extends n{constructor(t){super(t)}initialize(){this.addHandles([this.layers.on("change",()=>this._update()),p.watch(()=>this.extentHelper.layerViewsExtent,()=>this._setAdHocTilingScheme())]);this._update();this.tilingSchemeLocked||this._setAdHocTilingScheme()}destroy(){this._waitTask=null;this.layers.destroy()}_update(){this._waitTask=null;if(!this.tilingSchemeLocked){var t;this.layers.some(q=>!c.isTiledLayer(q)||q.isRejected()?!1:
q.isFulfilled()&&null==x.getTiledLayerInfo(q,this.viewSpatialReference,this.viewingMode)?!1:(t=q,"vector-tile"!==q?.type&&!x.isProjectableRasterLayer(q)));if(t)if(t.isResolved()){var m=x.getTiledLayerInfo(t,this.viewSpatialReference,this.viewingMode);null!=m&&(m=new u.TilingScheme(m.tileInfo),this._lockTilingScheme(m))}else this._updateWhen(t)}}_updateWhen(t){const m=t.when().catch(()=>{}).then(()=>{m!==this._waitTask||this.destroyed||this._update()});this._waitTask=m}_lockTilingScheme(t){if(this.viewingMode===
l.ViewingMode.Global){const m=t.levels.length-1,q=t.spatialReference;q.isWebMercator?t=u.TilingScheme.makeWebMercatorAuxiliarySphere(m):w.isSupportedEarthGCS(q)&&(t=u.TilingScheme.makeGCSWithTileSize(t.spatialReference,t.pixelSize,m))}this.tilingSchemeLocked=!0;this.tilingScheme=t;this.extentHelper.tilingScheme=this.tilingScheme;this._updateTiledLayerExtent();this.removeAllHandles();this.addHandles(p.watch(()=>this.extentHelper.tiledLayersExtent,()=>this._updateTiledLayerExtent()))}_updateTiledLayerExtent(){this._set("extent",
this.extentHelper.tiledLayersExtent)}_setAdHocTilingScheme(){if(this.viewingMode===l.ViewingMode.Global){var t=this.extentHelper.viewSpatialReference;t.isWebMercator?this.tilingScheme=u.TilingScheme.WebMercatorAuxiliarySphere:w.isSupportedGCSOnGlobe(t)&&(this.tilingScheme=u.TilingScheme.makeGCSWithTileSize(t,256));this._set("extent",this.extentHelper.layerViewsExtent)}else t=this.extentHelper.layerViewsExtent,null==t||f.equals(t,this.extent)||(this.tilingScheme=u.TilingScheme.fromExtent(t,this.extentHelper.viewSpatialReference),
this._set("extent",t))}get test(){}};b.__decorate([h.property()],a.TilingSchemeLogic.prototype,"tilingScheme",void 0);b.__decorate([h.property({readOnly:!0})],a.TilingSchemeLogic.prototype,"extent",void 0);b.__decorate([h.property({value:!1})],a.TilingSchemeLogic.prototype,"tilingSchemeLocked",void 0);b.__decorate([h.property({constructOnly:!0})],a.TilingSchemeLogic.prototype,"viewSpatialReference",void 0);b.__decorate([h.property({constructOnly:!0})],a.TilingSchemeLogic.prototype,"layers",void 0);
b.__decorate([h.property({constructOnly:!0})],a.TilingSchemeLogic.prototype,"extentHelper",void 0);b.__decorate([h.property({constructOnly:!0})],a.TilingSchemeLogic.prototype,"viewingMode",void 0);a.TilingSchemeLogic=b.__decorate([d.subclass("esri.views.3d.terrain.TilingSchemeLogic")],a.TilingSchemeLogic);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/UpsampleInfo":function(){define(["exports","../../../core/libs/gl-matrix-2/factories/vec2f64"],function(a,b){class n{constructor(){this._offset=
b.create();this.scale=0}get offset(){return this._offset}init(k,p,h,e){this.tile=k;this._offset[0]=p;this._offset[1]=h;this.scale=e}dispose(){this.tile=null;this._offset[0]=0;this.scale=this._offset[1]=0}}a.UpsampleInfo=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/Stage":function(){define("exports ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/has ../../../core/PooledArray ../../../core/promiseUtils ../../../core/accessorSupport/decorators/property ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ../state/helpers/SceneIntersectionHelper ./lib/ChangeSet ./lib/UpdatePolicy ./lib/WebGLLayer ./parts/Model ./parts/RenderView ../../support/Scheduler ../../support/Yield".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w,x,u,t,m,q){a.Stage=class extends n{constructor(r){super(r);this._model=new u.Model;this._layers=new p;this._asyncChangeSet=new l.ChangeSet;this._syncChangeSet=new l.ChangeSet;this._layerSyncSet=new Set}initialize(){this._set("renderView",new t.RenderView(this));this._frameTask=this.view.resourceController.scheduler.registerTask(m.TaskPriority.STAGE,this);this.addHandles(this._frameTask)}destroy(){this.renderView.destroy()}get viewingMode(){return this.view.state.viewingMode}get updating(){return this.running||
this.renderView.updating||this._frameTask.updating}get renderer(){return this.renderView?.renderer}add(r){this._model.add(r);x.isWebGLLayer(r)&&this._addLayer(r);this.renderView.requestRender()}remove(r){null!=r&&!this.destroyed&&this._model.remove(r)&&(x.isWebGLLayer(r)&&this._removeLayer(r),this.renderView.requestRender())}addMany(r){null!=r&&(this._model.addMany(r),this.renderView.requestRender())}removeMany(r){null!=r&&(this._model?.removeMany(r),this.renderView?.requestRender())}forEachOfType(r,
v){this._model.forEachOfType(r,v)}handleEvent(r,v){this.destroyed||(this._model.dirtySet[r](v),this.renderView.requestRender())}get running(){return this._model.dirtySet.dirty||!this._asyncChangeSet.empty}runTask(r){this._frameTask.processQueue(r);this._commit(r);if(!r.hasProgressed)return q.Yield}_commit(r){const v=this._model.dirtySet;this._asyncChangeSet.empty||r.done||(this.renderer.modify(this._asyncChangeSet,r),this.renderView.requestRender(),r.madeProgress());this._layers.forAll(y=>{if(!r.done){var B=
this._layerSyncSet.has(y.id)||y.updatePolicy===w.UpdatePolicy.SYNC,z=B?this._syncChangeSet:this._asyncChangeSet;v.commitLayer(y.id,z);this._layerSyncSet.delete(y.id);z.empty||(this.renderer.modify(z,B?m.noBudget:r),this.renderView.requestRender(),r.madeProgress())}});this._syncChangeSet.empty||(this.renderer.modify(this._syncChangeSet,m.noBudget),this.renderView.requestRender(),r.madeProgress());this._layers.forAll(y=>{r.done||this._layerSyncSet.has(y.id)||y.updatePolicy!==w.UpdatePolicy.ASYNC||(v.commitLayer(y.id,
this._asyncChangeSet),this._asyncChangeSet.empty||(this.renderer.modify(this._asyncChangeSet,r),this.renderView.requestRender(),r.madeProgress()))});this._layerSyncSet.clear();this.notifyChange("running")}commitSyncLayers(){const r=this._model.dirtySet;this._layers.forAll(v=>{this._layerSyncSet.has(v.id)||v.updatePolicy===w.UpdatePolicy.SYNC?(r.commitLayer(v.id,this._syncChangeSet),this._layerSyncSet.delete(v.id)):r.commitSyncUpdates(v.id,this._syncChangeSet)});for(const v of this._layerSyncSet)r.commitLayer(v,
this._syncChangeSet);this._layerSyncSet.clear();this._syncChangeSet.empty||(this.renderer.modify(this._syncChangeSet,m.noBudget),this.renderView.requestRender())}_commitLayer(r){this._model.dirtySet.commitLayer(r.id,this._syncChangeSet);this._layerSyncSet.delete(r.id);this._syncChangeSet.empty||(this.renderer.modify(this._syncChangeSet,m.noBudget),this.renderView.requestRender())}schedule(r,v){return this._frameTask.schedule(r,v)}reschedule(r,v){return this._frameTask.reschedule(r,v)}syncLayer(r){this._layerSyncSet.add(r);
this.renderView.requestRender()}getObject(r){return this._model.getObject(r)}get layers(){return this._layers}_addLayer(r){this._layers.includes(r)||this._layers.push(r)}_removeLayer(r){this._commitLayer(r);null!=this._layers.removeUnordered(r)&&(this._model.dirtySet.getResidentRenderGeometries(r.id,this._syncChangeSet.removes),this.renderer.modify(this._syncChangeSet,m.noBudget))}addRenderPlugin(r,v){v=this.renderer.plugins.add(r,v);const y=()=>{c.isIntersectionHandler(r)&&this.view.sceneIntersectionHelper.addIntersectionHandler(r)};
if(h.isPromiseLike(v))return v.then(y);y()}removeRenderPlugin(r){this.destroyed||(c.isIntersectionHandler(r)&&this.view.sceneIntersectionHelper.removeIntersectionHandler(r),this.renderer.plugins.remove(r))}get performanceInfo(){return this._model.getStats()}get test(){}};b.__decorate([e.property({constructOnly:!0})],a.Stage.prototype,"view",void 0);b.__decorate([e.property({constructOnly:!0})],a.Stage.prototype,"options",void 0);b.__decorate([e.property({readOnly:!0})],a.Stage.prototype,"viewingMode",
null);b.__decorate([e.property({constructOnly:!0})],a.Stage.prototype,"container",void 0);b.__decorate([e.property({readOnly:!0})],a.Stage.prototype,"updating",null);b.__decorate([e.property({constructOnly:!0})],a.Stage.prototype,"_model",void 0);b.__decorate([e.property()],a.Stage.prototype,"renderView",void 0);b.__decorate([e.property({readOnly:!0})],a.Stage.prototype,"renderer",null);b.__decorate([e.property({readOnly:!0})],a.Stage.prototype,"running",null);a.Stage=b.__decorate([f.subclass("esri.views.3d.webgl-engine.Stage")],
a.Stage);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/parts/Model":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/has ../../../../core/accessorSupport/decorators/property ../../../../core/Logger ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ../../../../core/libs/gl-matrix-2/factories/mat4f64 ../../../../chunks/sphere ../lib/ContentObjectType ../lib/GridLocalOriginFactory ../lib/ModelDirtySet ../lib/RenderGeometry ../lib/Util ../lib/WebGLLayer".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w,x,u,t){a.Model=class extends n{constructor(){super(...arguments);this.dirtySet=new w({model:this});this._content=new Map;this._originFactory=new l.GridLocalOriginFactory(null)}getObject(q){return this._content.get(q)}add(q){const r=q.id;u.assert(!this._content.has(r),"Model/Stage already contains object to be added");this._content.set(r,q);t.isWebGLLayer(q)&&this.dirtySet.layerAdded(q)}remove(q){if(!this._content.has(q.id))return!1;this._content.delete(q.id);t.isWebGLLayer(q)&&
this.dirtySet.layerRemoved(q);return!0}addMany(q){for(const r of q)r&&(u.assert(!this._content.has(r.id),"Model/Stage already contains object to be added"),this._content.set(r.id,r))}removeMany(q){for(const r of q)r&&(u.assert(this._content.has(r.id),"Model/Stage doesn't contain object to be removed"),this._content.delete(r.id))}has(q){return this._content.has(q.id)}forEachOfType(q,r){this._content.forEach(v=>{v.type===q&&r(v)})}getRenderGeometry(q,r){const v=new x.RenderGeometry(r,{castShadow:q.castShadow,
objectShaderTransformation:q.shaderTransformation});v.transformation=q.getCombinedStaticTransformation(r,m);({localOrigin:q}=r);v.localOrigin=null!=q?q:this._originFactory.getOrigin(f.getCenter(v.boundingSphere));return v}updateRenderGeometryTransformation(q,r,v){if(null==q)return!1;v.transformation=q.getCombinedStaticTransformation(r,m);q=this._originFactory.getOrigin(f.getCenter(v.boundingSphere));return v.localOrigin!==q}getStats(){const q={},r=Array.from(this._content.values());for(let v=0;v<
c.ContentObjectType.COUNT;++v)q[v]=r.filter(y=>y.type===v).length;return{contentTypes:q,dirtySet:this.dirtySet.formatDebugInfo()}}get test(){}};b.__decorate([p.property({constructOnly:!0})],a.Model.prototype,"dirtySet",void 0);a.Model=b.__decorate([g.subclass("esri.views.3d.webgl-engine.parts.Model")],a.Model);const m=d.create();Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/ModelDirtySet":function(){define("../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/has ../../../../core/uid ../../../../core/accessorSupport/decorators/property ../../../../core/Logger ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ./ModelDirtyTypes ./Util".split(" "),
function(a,b,n,k,p,h,e,g,d,f){class c{constructor(l,w,x,u){this.operation=l;this.geometry=w;this.states=x;this.sync=u}}b=class extends b{constructor(l){super(l);this._residentGeomRecords=new Map;this._dirtyGeomRecords=new Map;this._dirtyRecordCount=0}get dirty(){return 0<this._dirtyRecordCount}commitLayer(l,w){const x=this._dirtyGeomRecords.get(l);if(x){var u=0;x.forEach((t,m)=>{const q=this._ensureGeomRecord(l,m);u+=t.size;t.forEach(({geometry:r,operation:v,states:y},B)=>{let z=!1;if(v===d.DirtyOperation.UPDATE){const A=
q.get(B);if(A){if(y&d.DirtyState.TRANSFORMATION){const C=this.model.getObject(m);this.model.updateRenderGeometryTransformation(C,r,A)&&(z=!0)}z||w.updates.push({renderGeometry:A,updateType:y})}else f.assert(!1,"ModelDirtySet.commitLayer: invalid update")}if(v===d.DirtyOperation.REMOVE||z)(y=q.get(B))?(w.removes.push(y),q.delete(B)):v===d.DirtyOperation.REMOVE&&f.assert(!1,"ModelDirtySet.commitLayer: invalid remove");if(v===d.DirtyOperation.ADD||z)v=this.model.getObject(m),null!=v&&(r=this.model.getRenderGeometry(v,
r),w.adds.push(r),q.set(B,r))});0===q.size&&this._residentGeomRecords.get(l).delete(m)});0===this._residentGeomRecords.get(l).size&&this._residentGeomRecords.delete(l);this._dirtyGeomRecords.delete(l);this._dirtyRecordCount-=u}}commitSyncUpdates(l,w){const x=this._dirtyGeomRecords.get(l);x&&x.forEach((u,t)=>{const m=this._ensureGeomRecord(l,t);u.forEach(({geometry:q,operation:r,states:v,sync:y},B)=>{let z=!1;r===d.DirtyOperation.UPDATE&&y&&((r=m.get(B))?(v&d.DirtyState.TRANSFORMATION&&(y=this.model.getObject(t),
this.model.updateRenderGeometryTransformation(y,q,r)&&(z=!0)),z||w.updates.push({renderGeometry:r,updateType:v})):f.assert(!1,"ModelDirtySet.commitSyncUpdates: invalid update"))})})}getResidentRenderGeometries(l,w){(l=this._residentGeomRecords.get(l))&&l.forEach(x=>x.forEach(u=>w.push(u)))}_objectStateChanged(l,w){for(const x of w.geometries)this._updateOrCreateDirtyRecord(w,x,null,d.DirtyOperation.UPDATE,l)}visibilityChanged(l){this._objectStateChanged(d.DirtyState.VISIBILITY,l)}highlightChanged(l){this._objectStateChanged(d.DirtyState.HIGHLIGHT,
l)}occlusionChanged(l){this._objectStateChanged(d.DirtyState.OCCLUDEE,l)}attributesChanged({object:l,geometry:w,sync:x}){this._updateOrCreateDirtyRecord(l,w,null,d.DirtyOperation.UPDATE,d.DirtyState.GEOMETRY,x)}layerAdded(l){l.objects.forAll(w=>this._layerObjectAdded(l,w))}layerRemoved(l){l.objects.forAll(w=>this._layerObjectRemoved(l,w))}layerObjectAdded(l){this._layerObjectAdded(l.layer,l.object)}_layerObjectAdded(l,w){l=l.id;for(const x of w.geometries)this._geometryAdded(w,x,l)}layerObjectRemoved(l){this._layerObjectRemoved(l.layer,
l.object)}layerObjectsAdded(l){for(const w of l.objects)this._layerObjectAdded(l.layer,w)}layerObjectsRemoved(l){for(const w of l.objects)this._layerObjectRemoved(l.layer,w)}_layerObjectRemoved(l,w){l=l.id;for(const x of w.geometries)this._geometryRemoved(w,x,l)}transformationChanged(l){const w=this._getParentLayerId(l);this._ensureGeomRecord(w,l.id).forEach(x=>{this._updateOrCreateDirtyRecord(l,x.geometry,w,d.DirtyOperation.UPDATE,d.DirtyState.TRANSFORMATION)})}shaderTransformationChanged(l){const w=
this._getParentLayerId(l);this._ensureGeomRecord(w,l.id).forEach(x=>{x.objectShaderTransformationChanged(l.shaderTransformation)})}geometryAdded(l){this._geometryAdded(l.object,l.geometry)}_geometryAdded(l,w,x=null){this._updateOrCreateDirtyRecord(l,w,x,d.DirtyOperation.ADD)}geometryRemoved(l){this._geometryRemoved(l.object,l.geometry)}_geometryRemoved(l,w,x=null){this._updateOrCreateDirtyRecord(l,w,x,d.DirtyOperation.REMOVE)}_updateOrCreateDirtyRecord(l,w,x,u,t=d.DirtyState.NONE,m=!1){x=x??this._getParentLayerId(l);
const q=w.id;l=this._ensureDirtyRecord(x,l.id);(x=l.get(q))?(w=x.operation,w===d.DirtyOperation.REMOVE&&u===d.DirtyOperation.ADD&&x.states!==d.DirtyState.NONE?x.operation=d.DirtyOperation.UPDATE:w===d.DirtyOperation.REMOVE&&u===d.DirtyOperation.ADD||w===d.DirtyOperation.ADD&&u===d.DirtyOperation.REMOVE?(l.delete(q),this._dirtyRecordCount--):(w!==d.DirtyOperation.UPDATE||u!==d.DirtyOperation.REMOVE&&u!==d.DirtyOperation.UPDATE?f.assert((w===d.DirtyOperation.REMOVE||w===d.DirtyOperation.ADD)&&u===d.DirtyOperation.UPDATE,
"ModelDirtySet.objectGeometryAdded: inconsistent state"):x.operation=u,x.states|=t),x.sync=x.sync||m):(l.set(q,new c(u,w,t,m)),this._dirtyRecordCount++)}_ensureGeomRecord(l,w){let x=this._residentGeomRecords.get(l);x||(x=new Map,this._residentGeomRecords.set(l,x));l=x.get(w);l||(l=new Map,x.set(w,l));return l}_ensureDirtyRecord(l,w){let x=this._dirtyGeomRecords.get(l);x||(x=new Map,this._dirtyGeomRecords.set(l,x));l=x.get(w);l||(l=new Map,x.set(w,l));return l}_getParentLayerId(l){return l.parentLayer?
l.parentLayer.id:k.nullUid}formatDebugInfo(){const l=["ADD","UPD",void 0,"REM"];let w="";this._dirtyGeomRecords.forEach((x,u)=>{x.forEach((t,m)=>{0<w.length&&(w+="\n");w+=u+"."+m;const q=[];t.forEach(r=>{const v=r.operation;q[v]||(q[v]=[]);q[v].push(r.geometry.id)});for(t=0;t<q.length;t++)if(q[t])for(w+=" "+l[t-1]+": ",m=0;m<q[t].length;m++)w+=q[t][m]+", "})});return w}get test(){}};a.__decorate([p.property()],b.prototype,"_dirtyRecordCount",void 0);a.__decorate([p.property({constructOnly:!0})],b.prototype,
"model",void 0);return b=a.__decorate([g.subclass("esri.views.3d.webgl-engine.lib.ModelDirtySet")],b)})},"esri/views/3d/webgl-engine/lib/RenderGeometry":function(){define("exports ../../../../core/uid ../../../../core/libs/gl-matrix-2/math/mat4 ../../../../core/libs/gl-matrix-2/factories/mat4f64 ../../../../chunks/vec32 ../../../../chunks/sphere ../../support/mathUtils".split(" "),function(a,b,n,k,p,h,e){class g{constructor(f,c={}){this.geometry=f;this.screenToWorldRatio=1;this._transformation=k.create();
this._boundingSphere=this._shaderTransformation=null;this.id=b.generateUID();this.layerUid=c.layerUid;this.graphicUid=c.graphicUid;this.castShadow=c.castShadow??!1;c.objectShaderTransformation&&this.objectShaderTransformationChanged(c.objectShaderTransformation)}get transformation(){return this._transformation}set transformation(f){n.copy(this._transformation,f);this._boundingSphere=null}get boundingInfo(){return this.geometry.boundingInfo}objectShaderTransformationChanged(f){null==f?this._shaderTransformation=
null:(this._shaderTransformation??(this._shaderTransformation=k.create()),n.multiply(this._shaderTransformation,f,this.geometry.transformation));this._boundingSphere=null}get boundingSphere(){if(!this.boundingInfo)return h.NullSphere;null==this._boundingSphere&&(this._boundingSphere??(this._boundingSphere=h.create()),p.transformMat4(h.getCenter(this._boundingSphere),this.boundingInfo.center,this.shaderTransformation),this._boundingSphere[3]=this.boundingInfo.radius*e.maxScale(this.shaderTransformation));
return this._boundingSphere}get material(){return this.geometry.material}get type(){return this.geometry.type}get shaderTransformation(){return this._shaderTransformation??this.transformation}get attributes(){return this.geometry.attributes}get highlight(){return this.geometry.highlights}foreachHighlightGroup(f){this.geometry.foreachHighlightGroup(f)}get hasHighlights(){return this.geometry.hasHighlights}get occludees(){return this.geometry.occludees}get visible(){return this.geometry.visible}set visible(f){this.geometry.visible=
f}}class d extends g{}a.RenderGeometry=g;a.ValidatedRenderGeometry=d;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/parts/RenderView":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Evented ../../../../core/floatRGBA ../../../../core/has ../../../../core/Logger ../../../../core/maybe ../../../../core/reactiveUtils ../../../../core/scheduling ../../../../core/time ../../../../core/accessorSupport/decorators/property ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ../../../../geometry/support/spatialReferenceUtils ../../../ViewingMode ../../environment/ChapmanAtmosphere ../../environment/CloudsComposition ../../environment/Fog ../../environment/LocalAtmosphere ../../environment/MarsAtmosphere ../collections/Component/ComponentObjectCollection ../core/shaderTechnique/ShaderTechniqueConstructionContext ../core/shaderTechnique/ShaderTechniqueRepository ../effects/geometry/ObjectAndLayerIDRenderNode ../effects/geometry/olidUtils ../effects/geometry/RenderOccludedRenderNode ../effects/haze/Haze ../effects/highlight/Highlight ../effects/highlight/ShadowHighlight ../effects/magnifier/Magnifier ../effects/smaa/SMAA ../effects/ssao/SSAO ../effects/stars/Stars ../lib/basicInterfaces ../lib/CompositingHelper ../lib/GLMaterialRepository ../lib/ObjectAndLayerIdRenderHelper ../lib/Renderer ../lib/RenderingContext ../lib/TextureRepository ../materials/markerTextureRepository ../materials/stippleTextureRepository ../materials/internal/WaterTextureRepository ./contextCache ./renderUtils ./ScreenshotManager ./testUtils ../../../support/RenderState".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w,x,u,t,m,q,r,v,y,B,z,A,C,H,E,F,G,D,I,J,N,M,Q,O,K,L,P,R,W,V,ba,U,da,fa,ha,T,S){function Z(Y,ea){const ka={disabledExtensions:ea.options.deactivatedWebGLExtensions||{},debugWebGLExtensions:ea.options.debugWebGLExtensions||{},maxAnisotropy:8,newCache:(ja,X)=>ea.view.resourceController.memoryController.newCache(ja,X)};if(T.contextCache.enabled){let ja=ia.get(Y);if(ja)return ja.configure(ka),ja.ref(),ja;ja=new R.RenderingContext(Y,ka);ia.set(Y,ja);ja.ref();return ja}return new R.RenderingContext(Y,
ka)}a.RenderView=class extends n{constructor(Y){super({});this.events=new k;this.waterTextures=new U.WaterTextureRepository;this.olidRenderHelper=H.olidEnabled()?new L.ObjectAndLayerIdRenderHelper:null;this._idleSuspend=this._needsRender=this._needsUpdate=!0;this._needsWaterReflectionUpdate=!1;this._lastAnimationUpdate=0;this._container=Y.container;this._viewingMode=Y.viewingMode;try{this._initializeContext(Y)}catch(ka){console.error("Failed to initialize context",ka);return}const {memoryController:ea}=
Y.view.resourceController;this.stippleTextures=ba.createStippleTextureRepository(this._rctx,ea);this.markerTextures=V.createMarkerTextureRepository(this._rctx,ea);this._techniques=new A.ShaderTechniqueRepository(new z.ShaderTechniqueConstructionContext(this._rctx,Y.viewingMode,this.stippleTextures,this.waterTextures,this.markerTextures));this._textures=new W.TextureRepository(Y,this._techniques,this._rctx);this.addHandles(this._textures.events.on("changed",ka=>this.requestRender(ka)));this._materials=
new K.GLMaterialRepository(this._textures,this._techniques,()=>this.requestRender(),()=>this.requestRender());this._compositingHelper=new O(this._rctx,this._techniques);this.renderer=new P.Renderer(Y,this._materials,this._techniques,this._rctx,this._compositingHelper,ka=>this.requestRender(ka));this.addHandles([d.watch(()=>Y.view.ready,ka=>{ka&&this._createRenderNodes(Y.view,Y.viewingMode)},d.initial),d.watch(()=>this.waterTextures?.updating,()=>this.requestRender(),d.initial),d.watch(()=>Y.view.qualityProfile,
ka=>this.renderer?.updateRenderFeatures(ka),d.syncAndInitial)]);this._screenshotManager=new ha.ScreenshotManager(this._rctx,{renderScene:(ka,ja,X,aa)=>this.renderer.render(ka,ja,X,aa),requestRenderScene:ka=>this.requestRender(ka),prepareOverlay:()=>Y.options.screenshot.prepareOverlay(),renderOverlay:(ka,ja,X)=>Y.options.screenshot.renderOverlay(ka,ja,X)},ka=>this.events.emit("force-camera-for-screenshot",ka));this._registerFrameTask(Y)}normalizeCtorArgs(){return{}}destroy(){this._container.contains(this._canvas)&&
this._container.removeChild(this._canvas);this._frameTask=g.removeMaybe(this._frameTask);this._techniques=g.destroyMaybe(this._techniques);this._componentObjects=g.destroyMaybe(this._componentObjects);this._screenshotManager=g.destroyMaybe(this._screenshotManager);g.destroyMaybe(this.renderer);this._textures=g.destroyMaybe(this._textures);g.destroyMaybe(this.waterTextures);g.destroyMaybe(this.markerTextures);g.destroyMaybe(this.stippleTextures);this._container=this._canvas=null;this._rctx=g.destroyMaybe(this._rctx)}_createRenderNodes(Y,
ea){new M.Stars({view:Y,techniques:this._techniques});u.isMoon(Y.spatialReference)||(ea===t.ViewingMode.Local?new v.LocalAtmosphere({view:Y,techniques:this._techniques}):u.isMars(Y.spatialReference)?new y({view:Y,techniques:this._techniques}):(new m.ChapmanAtmosphere({view:Y,techniques:this._techniques}),new q.CloudsComposition({view:Y,techniques:this._techniques}),new F.Haze({view:Y,techniques:this._techniques}),new r.Fog({view:Y,techniques:this._techniques})));new N.SSAO({view:Y,isEnabled:()=>this.renderer.hasSSAO,
techniques:this._techniques});new J.SMAA({view:Y,isEnabled:()=>this.renderer.hasSMAA,techniques:this._techniques});new I.Magnifier({view:Y,techniques:this._techniques});new G.Highlight({view:Y,techniques:this._techniques});new D.ShadowHighlight({view:Y,viewingMode:ea,techniques:this._techniques});new E.RenderOccludedRenderNode({view:Y,techniques:this._techniques});H.olidEnabled()&&new C.ObjectAndLayerIDRenderNode({view:Y})}requestRender(Y=Q.RenderRequestType.UPDATE){this._needsRender=!0;Y===Q.RenderRequestType.UPDATE&&
(this._needsUpdate=!0)}get updating(){return this._needsUpdate||this._needsWaterReflectionUpdate||this.renderer.updating||this._textures.updating||this.waterTextures.updating}get textures(){return this._textures}get techniques(){return this._techniques}get compositingHelper(){return this._compositingHelper}setIdleSuspend(Y){this._idleSuspend!==Y&&(this._idleSuspend=Y,this.requestRender())}get renderingContext(){return this._rctx}get capabilities(){return this._rctx.capabilities}get canvas(){return this._canvas}takeScreenshot(Y){return this._screenshotManager.takeScreenshot(Y).then(ea=>
ea[0])}takeScreenshotWithOID(Y){Y.objectAndLayerIdColor=!0;return this._screenshotManager.takeScreenshot(Y)}getAlpha(){return!!this._rctx.contextAttributes.alpha}getMinimalDepthForArea(Y,ea,ka,ja,X,aa=X){aa=ja.constrainWindowSize(ea,ka,X*ja.pixelRatio,aa*ja.pixelRatio);const pa=this._ensureLinearDepthArrayBuffer(aa);this.renderer.readMainDepth(aa,pa);X=Number.MAX_VALUE;for(let na=0;na<aa[2]*aa[3];na++){var la=ja.nearFar;la=p.unpackFloatRGBA(pa,4*na)*(la[1]-la[0])+la[0];X>la&&la!==ja.nearFar[0]&&la!==
ja.nearFar[1]&&(X=la)}Y&&(Y=Y.pickDepth(ea*ja.pixelRatio,ka*ja.pixelRatio,ja),null!=Y&&X>Y&&Y!==ja.nearFar[0]&&Y!==ja.nearFar[1]&&(X=Y));return X===Number.MAX_VALUE?void 0:X}_ensureLinearDepthArrayBuffer(Y){Y=4*Y[2]*Y[3];if(null==this._tmpDepthBuffer||this._tmpDepthBuffer.byteLength<Y)this._tmpDepthBuffer=new Uint8Array(Y);return this._tmpDepthBuffer}async reloadShaders(){fa.removeLoadedShaderModules();await this._techniques.reloadAll();this.renderer.overlay?.reloadShaders();this.requestRender()}_registerFrameTask(Y){const ea=
Y.view.state;let ka=!1,ja=Q.RenderRequestType.BACKGROUND,X=!1;this._frameTask=f.addFrameTask({preRender:({time:aa})=>{ka=this.updating;ja=this._needsUpdate?Q.RenderRequestType.UPDATE:Q.RenderRequestType.BACKGROUND;Y.commitSyncLayers();if(c.Milliseconds(aa-this._lastAnimationUpdate)>this.renderer.animationTimestep||null!=ea.forcedAnimationTime||ka||this._needsRender)this.renderer.updateAnimation(ea,aa)&&this.requestRender(Q.RenderRequestType.BACKGROUND),this._lastAnimationUpdate=aa},render:({time:aa})=>
{if((this._needsRender||!this._idleSuspend||!this.renderer.isCameraFinal||this._needsWaterReflectionUpdate)&&0<ea.camera.fullWidth&&0<ea.camera.fullHeight){const pa=this._needsUpdate&&this._idleSuspend&&this.renderer.isCameraFinal;this._needsWaterReflectionUpdate=this._needsUpdate=this._needsRender=!1;this.renderer.render(ea,aa);X=!0;pa&&this.renderer.hasReflections&&(this.requestRender(Q.RenderRequestType.BACKGROUND),this._needsWaterReflectionUpdate=!0)}},update:({time:aa})=>{this._textures.update();
const pa=new ha.ScreenshotContext(ea,this.renderer.fboCache);this._screenshotManager.update(pa,aa)},finish:()=>{X&&(this.renderer.finish(ea.mode===S.RenderState.IDLE?ja:Q.RenderRequestType.UPDATE),X=!1)}})}_initializeContext(Y){const ea=Y.options;this._canvas=ea.canvas;this._canvas||(this._canvas=document.createElement("canvas"));this._canvas.setAttribute("style","width: 100%; height:100%; display:block;");const ka=this._canvas.getContext("webgl2",{alpha:ea.alpha||!1,premultipliedAlpha:!0,antialias:!1,
depth:!0,stencil:ea.stencil??!0,powerPreference:"high-performance",preserveDrawingBuffer:ea.preserveDrawingBuffer??!1});null==ka?e.getLogger(this).error("A WebGL2 context could not be created."):(this._rctx=Z(ka,Y),this._loadShaderOnlyExtensions(),!ea.alpha&&this._rctx.contextAttributes.alpha&&e.getLogger(this).error("WebGL context has alpha channel even though no alpha channel was requested"),!this._rctx.contextAttributes.alpha&&11<=h("safari")&&(this._container.style.backgroundColor="black"),this._container.appendChild(this._canvas))}_loadShaderOnlyExtensions(){this._rctx.capabilities.enable("textureFloatLinear")}getObjectAndLayerIdColor(Y){return this.olidRenderHelper?.getObjectAndLayerIdColor(Y)}get componentObjectCollection(){null==
this._componentObjects&&(this._componentObjects=new B.ComponentObjectCollection(this.renderer.renderPassManager,this._viewingMode));return this._componentObjects}set componentObjectCollection(Y){this._componentObjects=Y}};b.__decorate([l.property({type:Boolean,readOnly:!0})],a.RenderView.prototype,"updating",null);b.__decorate([l.property()],a.RenderView.prototype,"_rctx",void 0);b.__decorate([l.property()],a.RenderView.prototype,"_container",void 0);b.__decorate([l.property()],a.RenderView.prototype,
"_canvas",void 0);b.__decorate([l.property()],a.RenderView.prototype,"stippleTextures",void 0);b.__decorate([l.property()],a.RenderView.prototype,"markerTextures",void 0);b.__decorate([l.property()],a.RenderView.prototype,"waterTextures",void 0);b.__decorate([l.property({readOnly:!0})],a.RenderView.prototype,"olidRenderHelper",void 0);b.__decorate([l.property()],a.RenderView.prototype,"_textures",void 0);b.__decorate([l.property({readOnly:!0})],a.RenderView.prototype,"renderer",void 0);b.__decorate([l.property()],
a.RenderView.prototype,"_screenshotManager",void 0);b.__decorate([l.property()],a.RenderView.prototype,"componentObjectCollection",null);b.__decorate([l.property()],a.RenderView.prototype,"_componentObjects",void 0);b.__decorate([l.property()],a.RenderView.prototype,"_needsUpdate",void 0);b.__decorate([l.property()],a.RenderView.prototype,"_needsWaterReflectionUpdate",void 0);a.RenderView=b.__decorate([x.subclass("esri.views.3d.webgl-engine.parts.RenderView")],a.RenderView);const ia=da.getContextCache();
Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/ChapmanAtmosphere":function(){define("exports ../../../chunks/tslib.es6 ../../../core/colorUtils ../../../core/mathUtils ../../../core/maybe ../../../core/reactiveUtils ../../../core/Logger ../../../core/has ../../../core/RandomLCG ../../../core/Error ../../../core/accessorSupport/decorators/subclass ../../../core/libs/gl-matrix-2/math/vec2 ../../../chunks/vec32 ../../../chunks/vec42 ../../../core/libs/gl-matrix-2/factories/vec4f64 ../../../geometry/support/Ellipsoid ../webgl ./atmosphereUtils ./ChapmanAtmosphereTechnique ./ChapmanAtmosphereTechniqueConfiguration ../webgl/formats ../webgl-engine/effects/OpaqueEnvironment ../webgl-engine/lib/basicInterfaces ../webgl-engine/lib/glUtil3D ../webgl-engine/lib/textureUtils ../../../chunks/AtmosphereCompositing.glsl ../webgl-engine/shaders/AtmosphereCompositingTechnique ../../webgl/enums ../../../webscene/background/ColorBackground".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w,x,u,t,m,q,r,v,y,B,z,A,C,H,E,F,G){a.ChapmanAtmosphere=class extends B.OpaqueEnvironment{constructor(D){super(D);this.requireGeometryDepth=!0;this._compositingPassParameters=new H.AtmosphereCompositingPassParameters;this._vao=null;this._passParameters=new r.ChapmanAtmospherePassParameters;this._configuration=new v.ChapmanAtmosphereTechniqueConfiguration;({techniques:D}=D);D.precompile(r.ChapmanAtmosphereTechnique,this._configuration);D.precompile(E.AtmosphereCompositingTechnique);
this._configuration.reduced=!0;D.precompile(r.ChapmanAtmosphereTechnique,this._configuration);this._configuration.reduced=!1}initialize(){this.addHandles([h.watch(()=>this.view.environment.background,D=>{D=D instanceof G?n.unitRGBAFromColor(D.color):u.ZEROS;w.set(this._passParameters.backgroundColor,D[0]*D[3],D[1]*D[3],D[2]*D[3])},h.syncAndInitial),h.watch(()=>this.view._stage?.renderer?.fullResolutionAtmosphere,D=>this._configuration.reduced=!D,h.syncAndInitial),h.watch(()=>this.view.environment.atmosphereEnabled,
D=>D?this._enable():this._disable(),h.syncAndInitial)])}destroy(){this._vao=p.disposeMaybe(this._vao)}render(D){D=D.find(({name:P})=>P===m.InternalRenderCategory.OPAQUE_ENVIRONMENT);if(!this.bindParameters.mainDepth)return D;const I=this.renderingContext;this._vao??(this._vao=A.createQuadVAO(I,A.Layout.Pos2Tex));const J=D.getAttachment(I.gl.DEPTH_STENCIL_ATTACHMENT);this._update();const N=this.techniques.acquire(r.ChapmanAtmosphereTechnique,this._configuration);if(!N.compiled)return N.release(),this.requestRender(z.RenderRequestType.UPDATE),
D;if(!this._configuration.reduced)return D.detachDepth(),I.bindFramebuffer(D.fbo),I.bindTechnique(N,this.bindParameters,this._passParameters),I.bindVAO(this._vao),I.drawArrays(F.PrimitiveType.TRIANGLE_STRIP,0,4),D.attachDepth(J),N.release(),D;const M=this.techniques.acquire(E.AtmosphereCompositingTechnique);if(!M.compiled)return N.release(),M.release(),this.requestRender(z.RenderRequestType.UPDATE),D;const Q=I.getViewport();var O=this.bindParameters.camera,K=w.length(O.eye)-t.earth.radius;var L=t.earth.atmosphereHeight;
L=K<L?k.lerp(.2,.3,Math.min(1,Math.max(0,K/L))):k.lerp(.3,.6,Math.min(1,Math.max(0,(K-L)/(15*L))));K=C.applyTextureResizeModulo(Math.round(L*O.fullViewport[2]));O=C.applyTextureResizeModulo(Math.round(L*O.fullViewport[3]));I.setViewport(0,0,K,O);O=this.fboCache.acquire(K,O,"chapman",y.ColorFormat.RGBA);I.bindFramebuffer(O.fbo);I.clearFramebuffer([0,0,0,1],!0,!0);I.bindTechnique(N,this.bindParameters,this._passParameters);I.bindVAO(this._vao);I.drawArrays(F.PrimitiveType.TRIANGLE_STRIP,0,4);I.setViewport(Q.x,
Q.y,Q.width,Q.height);this._compositingPassParameters.color=O.getTexture();D.detachDepth();I.bindFramebuffer(D.fbo);I.bindTechnique(M,this.bindParameters,this._compositingPassParameters);I.screen.draw();D.attachDepth(J);N.release();M.release();O.release();return D}_update(){var D=w.squaredLength(this.bindParameters.camera.eye);const I=Math.sqrt(D),J=D-this._passParameters.radii[1]**2,N=k.clamp((I-this._passParameters.radii[0])/t.earth.atmosphereHeight,0,1);x.set(this._passParameters.heightParameters,
I,D,J,N);D=this.view.basemapTerrain.getLowerBoundRadius();l.set(this._passParameters.radii,D,D+t.earth.atmosphereHeight);this._passParameters.innerFadeDistance=2*Math.sqrt((2*D-q.innerAtmosphereDepth)*q.innerAtmosphereDepth);this._passParameters.altitudeFade=q.computeInnerAltitudeFade(I-D)}};a.ChapmanAtmosphere=b.__decorate([c.subclass("esri.views.3d.environment.ChapmanAtmosphere")],a.ChapmanAtmosphere);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/ChapmanAtmosphereTechnique":function(){define("require exports ../../../core/libs/gl-matrix-2/factories/vec3f64 ./ChapmanApproximation.glsl ../../../chunks/ChapmanAtmosphere.glsl ../webgl-engine/core/shaderTechnique/ReloadableShaderModule ../webgl-engine/core/shaderTechnique/ShaderTechnique ../../webgl/enums ../../webgl/renderState".split(" "),
function(a,b,n,k,p,h,e,g,d){class f extends k.ChapmanApproximationParameters{constructor(){super(...arguments);this.altitudeFade=this.innerFadeDistance=0;this.backgroundColor=n.create()}}class c extends e.ShaderTechnique{constructor(l,w,x){super(l,w,new h.ReloadableShaderModule(p.ChapmanAtmosphere,()=>new Promise((u,t)=>a(["./ChapmanAtmosphere.glsl"],u,t))),x)}initializePipeline(l){return d.makePipelineState({blending:l.reduced?d.keepSourceValues:d.simpleBlendingParams(g.BlendFactor.SRC_ALPHA,g.BlendFactor.ONE_MINUS_SRC_ALPHA),
depthTest:{func:l.reduced?g.CompareFunction.ALWAYS:g.CompareFunction.LEQUAL},colorWrite:d.defaultColorWrite})}}b.ChapmanAtmospherePassParameters=f;b.ChapmanAtmosphereTechnique=c;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/ChapmanApproximation.glsl":function(){define("exports ../../../core/libs/gl-matrix-2/factories/vec2f64 ../../../core/libs/gl-matrix-2/factories/vec4f64 ../../../geometry/support/Ellipsoid ../webgl-engine/core/shaderModules/Float2PassUniform ../webgl-engine/core/shaderModules/Float4PassUniform ../webgl-engine/core/shaderModules/interfaces".split(" "),
function(a,b,n,k,p,h,e){class g extends e.NoParameters{constructor(){super(...arguments);this.radii=b.create();this.heightParameters=n.create()}}a.ChapmanApproximation=function(d){d.uniforms.add(new p.Float2PassUniform("radii",f=>f.radii),new h.Float4PassUniform("heightParameters",f=>f.heightParameters));d.constants.add("scaleHeight","float",k.earth.scaleHeight*k.earth.atmosphereHeight);d.code.add(e.glsl`float chapmanApproximation(float thickness, float height, float cosZenith) {
float c = sqrt(thickness + height);
float cExpH = c * exp(-height);
if (cosZenith >= 0.0) {
return cExpH / (c * cosZenith + 1.0);
} else {
float x0 = sqrt(1.0 - cosZenith * cosZenith) * (thickness + height);
float c0 = sqrt(x0);
return 2.0 * c0 * exp(thickness - x0) - cExpH / (1.0 - c * cosZenith);
}
}`);d.code.add(e.glsl`float getOpticalDepth(vec3 position, vec3 dir, float h) {
return scaleHeight * chapmanApproximation(radii[0] / scaleHeight, h, dot(normalize(position), dir));
}`);d.code.add(e.glsl`vec4 planetIntersect(vec3 cameraPos, vec3 rayDir) {
float reducedPlanetRadius = radii[0] - 20000.0;
float rayPlanetDistance = heightParameters[1] - reducedPlanetRadius * reducedPlanetRadius;
vec2 rayPlanetIntersect = sphereIntersect(cameraPos, rayDir, rayPlanetDistance);
vec2 rayAtmosphereIntersect = sphereIntersect(cameraPos, rayDir, heightParameters[2]);
bool hitsAtmosphere = (rayAtmosphereIntersect.x <= rayAtmosphereIntersect.y) && rayAtmosphereIntersect.x > 0.0;
bool insideAtmosphere = heightParameters[0] < radii[1];
if (!(hitsAtmosphere || insideAtmosphere)) {
return vec4(1.0, 0.0, 0.0, 0.0);
}
bool hitsPlanet = (rayPlanetIntersect.x <= rayPlanetIntersect.y) && rayPlanetIntersect.x > 0.0;
float start = insideAtmosphere ? 0.0 : rayAtmosphereIntersect.x;
if (heightParameters[0] < reducedPlanetRadius) {
if (dot(rayDir, normalize(cameraPos)) < -0.025) {
return vec4(1.0, 0.0, 0.0, 0.0);
}
start = rayPlanetIntersect.y;
}
float end = hitsPlanet ? rayPlanetIntersect.x : rayAtmosphereIntersect.y;
return vec4(0.0, hitsPlanet ? 1.0 : 0.0, start, end);
}`)};a.ChapmanApproximationParameters=g;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/ChapmanAtmosphere.glsl":function(){define("exports ../views/3d/environment/ChapmanRaymarching.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/Gamma.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MainLighting.glsl ../views/3d/webgl-engine/core/shaderModules/Float3PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform ../views/3d/webgl-engine/shaders/ScreenSpacePassAtmosphere.glsl ../views/3d/webgl-engine/shaders/SphereIntersect.glsl ../views/3d/webgl-engine/shaders/ToneMapping.glsl".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l){function w(u){const t=new g.ShaderBuilder;t.include(f.ScreenSpacePassAtmosphere);({reduced:u}=u);const {fragment:m}=t;m.uniforms.add(new p.Float3PassUniform("backgroundColor",q=>q.backgroundColor),new h.FloatPassUniform("innerFadeDistance",q=>q.innerFadeDistance),new h.FloatPassUniform("altitudeFade",q=>q.altitudeFade),new d.Texture2DPassUniform("depthTexture",(q,r)=>r.mainDepth));k.addMainLightDirection(m);t.include(n.Gamma);m.include(c.SphereIntersect);m.include(l.ToneMapping);
m.include(b.ChapmanRaymarching,!1);m.code.add(e.glsl`vec4 applyUndergroundAtmosphere(vec3 rayDir, vec3 lightDirection, vec4 fragColor) {
float rayPlanetDistance = heightParameters[1] - radii[0] * radii[0];
vec2 rayPlanetIntersect = sphereIntersect(cameraPosition, rayDir, rayPlanetDistance);
if (!((rayPlanetIntersect.x <= rayPlanetIntersect.y) && rayPlanetIntersect.y > 0.0)) {
return fragColor;
}
float lightAngle = dot(lightDirection, normalize(cameraPosition + rayDir * max(0.0, rayPlanetIntersect.x)));
vec4 surfaceColor = vec4(vec3(max(0.0, (smoothstep(-1.0, 0.8, 2.0 * lightAngle)))), 1.0 - altitudeFade);
float relDist = (rayPlanetIntersect.y - max(0.0, rayPlanetIntersect.x)) / innerFadeDistance;
if (relDist > 1.0) {
return surfaceColor;
}
return mix(fragColor, surfaceColor, smoothstep(0.0, 1.0, relDist * relDist));
}
float getGlow(float dist, float radius, float intensity) {
return pow(radius / max(dist, 1e-6), intensity);
}
vec3 getSun(vec3 cameraPos, vec3 rayDir, vec3 lightDir){
float scaleFract = (length(cameraPos) - radii[0]) / scaleHeight;
float sunOpticalDepth = getOpticalDepth(cameraPos, rayDir, max(scaleFract, 0.0));
vec3 sunTransmittance = exp(-(mix(betaCombined, betaRayleigh, 0.5)) * max(0.0, sunOpticalDepth));
float mu = clamp(dot(rayDir, lightDir), 0.0, 1.0);
float sunDisc = 256.0 * smoothstep(0.0, 128.0, clamp(getGlow(1.0 - mu, 3e-5, 3.0), 0.0, 128.0));
return normalize(sunTransmittance) * sunDisc;
}`);m.main.add(e.glsl`
      vec3 rayDir = normalize(worldRay);
      float terrainDepth = -1.0;
      ${e.If(!u,e.glsl`float depthSample = texture(depthTexture, uv).r;
             if (depthSample != 1.0) {
                fragColor = vec4(0);
                return;
             }`)}

      vec3 col = linearizeGamma(backgroundColor);
      col += raymarchAtmosphere(cameraPosition, rayDir, mainLightDirection, terrainDepth);
      col += getSun(cameraPosition, rayDir, mainLightDirection);
      float alpha = smoothstep(0.0, mix(0.15, 0.01, heightParameters[3]), length(col));

      col = tonemapACES(col);
      fragColor = delinearizeGamma(vec4(col, alpha));
      fragColor = applyUndergroundAtmosphere(rayDir, mainLightDirection, fragColor);
  `);return t}const x=Object.freeze(Object.defineProperty({__proto__:null,build:w},Symbol.toStringTag,{value:"Module"}));a.ChapmanAtmosphere=x;a.build=w})},"esri/views/3d/environment/ChapmanRaymarching.glsl":function(){define(["exports","./atmosphereUtils","./ChapmanApproximation.glsl","../webgl-engine/core/shaderModules/Float3PassUniform","../webgl-engine/core/shaderModules/interfaces"],function(a,b,n,k,p){a.ChapmanRaymarching=function(h,e){h.include(n.ChapmanApproximation);h.uniforms.add(new k.Float3PassUniform("cameraPosition",
(g,d)=>d.camera.eye));h.constants.add("betaRayleigh","vec3",b.betaRayleigh);h.constants.add("betaCombined","vec3",b.betaCombined);h.constants.add("betaMie","float",b.betaMie);h.code.add(p.glsl`
    vec3 raymarchAtmosphere(vec3 cameraPos, vec3 rayDir, vec3 lightDir, float terrainDepth) {
      vec4 ray = planetIntersect(cameraPos, rayDir);
      if(ray.x == 1.0) {
        return vec3(0);
      }
      ${p.If(e,"if (terrainDepth !\x3d -1.0) { ray.w \x3d terrainDepth; }")}

      vec3 samplePoint = cameraPos + rayDir * ray.w;
      float multiplier = ray.y == 1.0 ? -1.0 : 1.0;

      vec3 scattering = vec3(0);
      float scaleFract = (length(samplePoint) - radii[0]) / scaleHeight;
      float lastOpticalDepth = getOpticalDepth(samplePoint, rayDir, scaleFract);
      float stepSize = (ray.w - ray.z) / ${p.glsl.float(6)};

      for (int i = 0; i < ${p.glsl.int(6)}; i++) {
        samplePoint -= stepSize * rayDir;
        scaleFract = (length(samplePoint) - radii[0]) / scaleHeight;
        float opticalDepth = multiplier * getOpticalDepth(samplePoint, rayDir * multiplier, scaleFract);

        if (i > 0) {
          scattering *= exp(-(mix(betaCombined, betaRayleigh, 0.5) + betaMie) * max(0.0, (opticalDepth - lastOpticalDepth)));
          ${p.If(!e,"scattering *\x3d mix(2.5, 1.0, clamp((length(cameraPos) - radii[0]) / 50e3, 0.0, 1.0))")};
        }

        if (dot(normalize(samplePoint), lightDir) > -0.3) {
          float scale = exp(-scaleFract);
          float lightDepth = getOpticalDepth(samplePoint, lightDir, scaleFract);
          scattering += scale * exp(-(betaCombined + betaMie) * lightDepth);
          ${p.If(!e,"scattering +\x3d scale * exp(-(0.25 * betaCombined ) * lightDepth);")}
        }
        lastOpticalDepth = opticalDepth;
      }

      float mu = dot(rayDir, lightDir);
      float mumu = 1.0 + mu * mu;

      float phaseRayleigh = 0.0596831 * mumu;
      ${e?"return 3.0 * scattering * stepSize * phaseRayleigh * betaRayleigh;":p.glsl`const float g = 0.8;
             const float gg = g * g;
             float phaseMie = 0.1193662 * ((1.0 - gg) * mumu) / (pow(1.0 + gg - 2.0 * mu * g, 1.5) * (2.0 + gg));
             phaseMie = clamp(phaseMie, 0.0, 128.0);
             return 3.0 * scattering * stepSize * (phaseRayleigh * betaRayleigh + 0.025 * phaseMie * betaMie);`}
    }`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/ScreenSpacePassAtmosphere.glsl":function(){define("exports ../../../../core/libs/gl-matrix-2/math/mat4 ../../../../core/libs/gl-matrix-2/factories/mat4f64 ../core/shaderModules/interfaces ../core/shaderModules/Matrix4PassUniform ../lib/VertexAttribute".split(" "),function(a,b,n,k,p,h){const e=n.create();a.ScreenSpacePassAtmosphere=function(g,d={needUVs:!0,needEyeDirection:!0}){g.attributes.add(h.VertexAttribute.POSITION,
"vec2");g.varyings.add("worldRay","vec3");const {needUVs:f,needEyeDirection:c}=d;f&&g.varyings.add("uv","vec2");c&&g.varyings.add("eyeDir","vec3");g.vertex.uniforms.add(new p.Matrix4PassUniform("inverseProjectionMatrix",(l,w)=>w.camera.inverseProjectionMatrix),new p.Matrix4PassUniform("inverseViewMatrix",(l,w)=>b.invertOrIdentity(e,w.camera.viewMatrix)));g.vertex.main.add(k.glsl`
    vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1.0, 1.0)).xyz;
    ${k.If(c,"eyeDir \x3d posViewNear;")}
    worldRay = (inverseViewMatrix * vec4(posViewNear, 0)).xyz;
    ${k.If(f,"uv \x3d position * 0.5 + vec2(0.5);")}
    gl_Position = vec4(position, 1, 1);
  `)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/ChapmanAtmosphereTechniqueConfiguration":function(){define(["exports","../../../chunks/tslib.es6","../webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration"],function(a,b,n){class k extends n.ShaderTechniqueConfiguration{constructor(){super(...arguments);this.reduced=!1}}b.__decorate([n.parameter()],k.prototype,"reduced",void 0);a.ChapmanAtmosphereTechniqueConfiguration=k;Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/effects/OpaqueEnvironment":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/Logger ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ../../webgl ../../webgl/RenderNode ../lib/basicInterfaces".split(" "),function(a,b,n,k,p,h,e,g,d,f){a.OpaqueEnvironment=class extends d{constructor(c){super(c);this.produces=
"disabled";this.consumes={required:[g.InternalRenderCategory.OPAQUE_ENVIRONMENT]}}_enable(){this.produces=g.InternalRenderCategory.OPAQUE_ENVIRONMENT;this.requestRender(f.RenderRequestType.UPDATE)}_disable(){this.produces="disabled";this.requestRender(f.RenderRequestType.UPDATE)}};b.__decorate([n.property()],a.OpaqueEnvironment.prototype,"produces",void 0);b.__decorate([n.property()],a.OpaqueEnvironment.prototype,"consumes",void 0);b.__decorate([n.property({constructOnly:!0})],a.OpaqueEnvironment.prototype,
"techniques",void 0);a.OpaqueEnvironment=b.__decorate([e.subclass("esri.views.3d.webgl-engine.effects.OpaqueEnvironment")],a.OpaqueEnvironment);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/AtmosphereCompositing.glsl":function(){define(["exports","../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass.glsl","../views/3d/webgl-engine/core/shaderModules/interfaces","../views/3d/webgl-engine/core/shaderModules/ShaderBuilder","../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform"],
function(a,b,n,k,p){function h(){const d=new k.ShaderBuilder;d.include(b.ScreenSpacePass);d.fragment.uniforms.add(new p.Texture2DPassUniform("colorTexture",f=>f.color),new p.Texture2DPassUniform("depthTexture",(f,c)=>c.mainDepth));d.fragment.main.add(n.glsl`float depthSample = texture(depthTexture, uv).r;
if (depthSample != 1.0 ) {
fragColor = vec4(0);
return;
}
fragColor = texture(colorTexture, uv);`);return d}class e extends n.NoParameters{}const g=Object.freeze(Object.defineProperty({__proto__:null,AtmosphereCompositingPassParameters:e,build:h},Symbol.toStringTag,{value:"Module"}));a.AtmosphereCompositing=g;a.AtmosphereCompositingPassParameters=e;a.build=h})},"esri/views/3d/webgl-engine/shaders/AtmosphereCompositingTechnique":function(){define("require exports ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../../../../chunks/AtmosphereCompositing.glsl ../../../webgl/enums ../../../webgl/renderState".split(" "),
function(a,b,n,k,p,h,e){class g extends k.ShaderTechnique{constructor(d,f,c){super(d,f,new n.ReloadableShaderModule(p.AtmosphereCompositing,()=>new Promise((l,w)=>a(["./AtmosphereCompositing.glsl"],l,w))),c)}initializePipeline(){return e.makePipelineState({blending:e.simpleBlendingParams(h.BlendFactor.SRC_ALPHA,h.BlendFactor.ONE_MINUS_SRC_ALPHA),depthTest:{func:h.CompareFunction.ALWAYS},colorWrite:e.defaultColorWrite})}}b.AtmosphereCompositingTechnique=g;Object.defineProperty(b,Symbol.toStringTag,
{value:"Module"})})},"esri/views/3d/environment/CloudsComposition":function(){define("exports ../../../chunks/tslib.es6 ../../../core/maybe ../../../core/reactiveUtils ../../../core/Logger ../../../core/has ../../../core/RandomLCG ../../../core/Error ../../../core/accessorSupport/decorators/subclass ../../../geometry/ellipsoidUtils ../webgl ./CloudsCompositionTechnique ../webgl-engine/core/shaderModules/interfaces ../webgl-engine/effects/OpaqueEnvironment ../webgl-engine/lib/basicInterfaces ../webgl-engine/lib/glUtil3D ../../webgl/enums".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w,x,u,t,m){a.CloudsComposition=class extends x.OpaqueEnvironment{constructor(r){super(r);r.techniques.precompile(l.CloudsCompositionTechnique);this._planetRadius=f.getReferenceEllipsoid(r.view.spatialReference).radius}initialize(){this.addHandles([k.watch(()=>null!=this.view.environment.weather&&this.view.environment.atmosphereEnabled,r=>r?this._enable():this._disable(),k.initial)])}destroy(){this._vao=n.disposeMaybe(this._vao)}render(r){r=r.find(({name:A})=>A===c.InternalRenderCategory.OPAQUE_ENVIRONMENT);
const v=this.bindParameters.clouds;if(!v.data)return r;const y=this.techniques.acquire(l.CloudsCompositionTechnique);if(!y.compiled)return this.requestRender(u.RenderRequestType.UPDATE),y.release(),r;const B=this.renderingContext;this._vao??(this._vao=t.createQuadVAO(B));const z=B.bindTechnique(y,this.bindParameters,q);B.bindVAO(this._vao);z.assertCompatibleVertexAttributeLocations(this._vao);B.drawArrays(m.PrimitiveType.TRIANGLE_STRIP,0,4);y.release();v.isFading&&this.requestRender(u.RenderRequestType.UPDATE);
return r}};a.CloudsComposition=b.__decorate([d.subclass("esri.views.3d.environment.CloudsComposition")],a.CloudsComposition);const q=new w.NoParameters;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/CloudsCompositionTechnique":function(){define("require exports ../../../chunks/CloudsComposition.glsl ../webgl-engine/core/shaderTechnique/ReloadableShaderModule ../webgl-engine/core/shaderTechnique/ShaderTechnique ../../webgl/enums ../../webgl/renderState".split(" "),
function(a,b,n,k,p,h,e){class g extends p.ShaderTechnique{constructor(d,f,c){super(d,f,new k.ReloadableShaderModule(n.CloudsComposition,()=>new Promise((l,w)=>a(["./CloudsComposition.glsl"],l,w))),c)}initializePipeline(){return e.makePipelineState({blending:e.separateBlendingParams(h.BlendFactor.ONE,h.BlendFactor.ZERO,h.BlendFactor.SRC_ALPHA,h.BlendFactor.ONE),depthTest:{func:h.CompareFunction.LEQUAL},colorWrite:e.defaultColorWrite})}}b.CloudsCompositionTechnique=g;Object.defineProperty(b,Symbol.toStringTag,
{value:"Module"})})},"esri/chunks/CloudsComposition.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateAmbientLighting.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/Gamma.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/PiUtils.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/CloudsParallaxShading.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/RgbaFloatEncoding.glsl ../views/3d/webgl-engine/core/shaderModules/Float3PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/shaders/ScreenSpacePassAtmosphere.glsl".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w){function x(){const t=new l.ShaderBuilder,{fragment:m}=t;t.include(w.ScreenSpacePassAtmosphere,{needUVs:!1,needEyeDirection:!1});m.include(e.ColorConversion);m.include(g.RgbaFloatEncoding);t.include(b.EvaluateAmbientLighting,{pbrMode:k.PBRMode.Disabled,lightingSphericalHarmonicsOrder:2});t.include(p.PiUtils);t.include(n.Gamma);t.include(h.CloudsParallaxShading);m.uniforms.add(new d.Float3PassUniform("cameraPosition",(q,r)=>r.camera.eye),new f.FloatPassUniform("cloudsOpacity",
(q,r)=>r.clouds.opacity)).main.add(c.glsl`vec4 cloudsColor = renderClouds(normalize(worldRay), cameraPosition);
fragColor = vec4(cloudsOpacity * cloudsColor.rgb, cloudsColor.a);`);return t}const u=Object.freeze(Object.defineProperty({__proto__:null,build:x},Symbol.toStringTag,{value:"Module"}));a.CloudsComposition=u;a.build=x})},"esri/views/3d/environment/Fog":function(){define("exports ../../../chunks/tslib.es6 ../../../core/mathUtils ../../../core/reactiveUtils ../../../core/Logger ../../../core/has ../../../core/RandomLCG ../../../core/Error ../../../core/accessorSupport/decorators/subclass ../../../chunks/vec32 ../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../geometry/ellipsoidUtils ../webgl ../../../chunks/Fog.glsl ./FogTechnique ./weather ../webgl-engine/effects/TransparentEnvironment ../webgl-engine/lib/basicInterfaces".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w,x,u,t,m,q){a.Fog=class extends m.TransparentEnvironment{constructor(A){super(A);this.requireGeometryDepth=!0;this._newParameters=new r;this._oldParameters=new r;this._fadedParameters=new r;this._parameters=this._newParameters;this._passParameters=new x.FogPassParameters;const {view:C,techniques:H}=A;A=l.getReferenceEllipsoid(C.spatialReference);this._planetRadius=A.radius;this._atmosphereRadius=A.radius+A.atmosphereHeight;H.precompile(u.FogTechnique)}toogle(){this.view.environment.atmosphereEnabled&&
this.view.environment.weather?this._enable():this._disable()}initialize(){this.addHandles([k.watch(()=>this.view.environment.atmosphereEnabled,()=>this.toogle(),k.syncAndInitial),k.watch(()=>this.view.environment.weather,()=>this.toogle(),k.syncAndInitial),k.watch(()=>this._updateFogParameters(),()=>{},k.syncAndInitial)]);this.addHandles(k.watch(()=>this._fadeFactor,A=>this._fade(A),k.syncAndInitial))}get _fadeFactor(){return this.view._stage?.renderer.renderContext.bind.clouds.fadeFactor??1}_fade(A){const {_newParameters:C,
_oldParameters:H}=this;1<=A?(this._parameters=C,this._oldParameters.copyFrom(this._newParameters)):0>=A?this._parameters=H:(this._fadedParameters.lerp(H,C,A),this._parameters=this._fadedParameters)}_updateFogParameters(){const A=this.view.environment.weather,C="foggy"===A.type||"snowy"===A.type||"rainy"===A.type;this._newParameters.strength="foggy"===A.type?n.lerp(3E-5,.005,A.fogStrength**3):"snowy"===A.type||"rainy"===A.type?n.lerp(4E-6,2E-4,(A.precipitation??0)**3):0;this._newParameters.amount=
C?1:0;"foggy"!==A.type&&"snowy"!==A.type||f.copy(this._newParameters.color,z);"rainy"===A.type&&f.copy(this._newParameters.color,B);1<=this._fadeFactor&&this._oldParameters.copyFrom(this._newParameters);this.requestRender(q.RenderRequestType.UPDATE)}render(A){A=A.find(({name:F})=>F===w.InternalRenderCategory.TRANSPARENT_ENVIRONMENT);if(0===this._parameters.amount)return A;this._update();if(0>=this._passParameters.amount)return A;const C=this.techniques.acquire(u.FogTechnique);if(!C.compiled)return this.requestRender(q.RenderRequestType.UPDATE),
C.release(),A;const H=this.renderingContext,E=A.getAttachment(H.gl.DEPTH_STENCIL_ATTACHMENT);A.attachDepth(null);H.bindFramebuffer(A.fbo);H.bindTechnique(C,this.bindParameters,this._passParameters);H.screen.draw();A.attachDepth(E);C.release();return A}_update(){var A=this.bindParameters.camera;f.normalize(v,A.eye);const C=Math.max(0,f.dot(v,this.bindParameters.lighting.mainLight.direction)),H=this._parameters.color;f.scale(y,H,.1);f.lerp(this._passParameters.color,y,H,C);A=f.length(A.eye);this._passParameters.atmosphereC=
A**2-this._atmosphereRadius**2;this._passParameters.amount=(1-n.smoothstep(.95*t.heightLimit,1*t.heightLimit,Math.abs(A-this._planetRadius)))*this._parameters.amount;this._passParameters.strength=this._parameters.strength}};a.Fog=b.__decorate([d.subclass("esri.views.3d.environment.Fog")],a.Fog);class r{constructor(){this.color=c.create();this.amount=this.strength=0}copyFrom(A){this.amount=A.amount;this.strength=A.strength;f.copy(this.color,A.color)}lerp(A,C,H){this.amount=n.lerp(A.amount,C.amount,
H);this.strength=n.lerp(A.strength,C.strength,H);f.lerp(this.color,A.color,C.color,H)}}const v=c.create(),y=c.create(),B=c.fromValues(.5,.5,.5),z=c.fromValues(1.5,1.5,1.5);a.FogParameters=r;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/Fog.glsl":function(){define("exports ../core/libs/gl-matrix-2/factories/vec3f64 ../views/3d/webgl-engine/core/shaderLibrary/shading/Gamma.glsl ../views/3d/webgl-engine/core/shaderModules/Float2PassUniform ../views/3d/webgl-engine/core/shaderModules/Float3PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform ../views/3d/webgl-engine/shaders/ScreenSpacePassAtmosphere.glsl ../views/3d/webgl-engine/shaders/SphereIntersect.glsl ../views/3d/webgl-engine/shaders/ToneMapping.glsl".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l){function w(){const t=new g.ShaderBuilder;t.include(f.ScreenSpacePassAtmosphere,{needUVs:!0,needEyeDirection:!0});const m=t.fragment;m.uniforms.add(new h.FloatPassUniform("atmosphereC",q=>q.atmosphereC),new p.Float3PassUniform("cameraPosition",(q,r)=>r.camera.eye),new k.Float2PassUniform("nearFar",(q,r)=>r.camera.nearFar),new d.Texture2DPassUniform("depthTexture",(q,r)=>r.mainDepth),new h.FloatPassUniform("fogStrength",q=>q.strength),new h.FloatPassUniform("fogAmount",
q=>q.amount),new p.Float3PassUniform("fogColor",q=>q.color));t.include(n.Gamma);m.include(c.SphereIntersect);m.include(l.ToneMapping);m.code.add(e.glsl`float getFogAmount(float dist, vec3 rayDir) {
if(dist == -1.0){
dist = 0.055 * sphereIntersect(cameraPosition, rayDir, atmosphereC).y;
}
return fogAmount * (1.0 - exp(-dist * fogStrength));
}`);m.main.add(e.glsl`vec3 rayDir = normalize(worldRay);
float terrainDepth = -1.0;
float depthSample = texture(depthTexture, uv).r;
float zNorm = 2.0 * depthSample - 1.0;
float linDepth = 2.0 * nearFar[0] * nearFar[1] / (nearFar[1] + nearFar[0] - zNorm * (nearFar[1] - nearFar[0]));
if(depthSample < 1.0 && depthSample > 0.0){
vec3 cameraSpaceRay = normalize(eyeDir);
cameraSpaceRay /= cameraSpaceRay.z;
cameraSpaceRay *= linDepth;
terrainDepth = max(0.0, length(cameraSpaceRay));
}
float fogAmount = getFogAmount(terrainDepth, rayDir);
vec4 fog = vec4(fogColor, 1.0) * fogAmount;
fragColor = delinearizeGamma(vec4(tonemapACES(fog.rgb), fog.a));`);return t}class x extends e.NoParameters{constructor(){super(...arguments);this.color=b.create();this.strength=4E-6;this.atmosphereC=1;this.amount=0}}const u=Object.freeze(Object.defineProperty({__proto__:null,FogPassParameters:x,build:w},Symbol.toStringTag,{value:"Module"}));a.Fog=u;a.FogPassParameters=x;a.build=w})},"esri/views/3d/environment/FogTechnique":function(){define("require exports ../../../chunks/Fog.glsl ../webgl-engine/core/shaderTechnique/ReloadableShaderModule ../webgl-engine/core/shaderTechnique/ShaderTechnique ../../webgl/enums ../../webgl/renderState".split(" "),
function(a,b,n,k,p,h,e){class g extends p.ShaderTechnique{constructor(d,f,c){super(d,f,new k.ReloadableShaderModule(n.Fog,()=>new Promise((l,w)=>a(["./Fog.glsl"],l,w))),c)}initializePipeline(){return e.makePipelineState({blending:e.separateBlendingParams(h.BlendFactor.SRC_ALPHA,h.BlendFactor.ZERO,h.BlendFactor.ONE_MINUS_SRC_ALPHA,h.BlendFactor.ONE),colorWrite:e.defaultColorWrite})}}b.FogTechnique=g;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/effects/TransparentEnvironment":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/Logger ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ../../webgl ./OpaqueEnvironment ../lib/basicInterfaces".split(" "),
function(a,b,n,k,p,h,e,g,d,f){a.TransparentEnvironment=class extends d.OpaqueEnvironment{constructor(c){super(c);this.consumes={required:[g.InternalRenderCategory.TRANSPARENT_ENVIRONMENT]}}_enable(){this.produces=g.InternalRenderCategory.TRANSPARENT_ENVIRONMENT;this.requestRender(f.RenderRequestType.UPDATE)}};b.__decorate([n.property()],a.TransparentEnvironment.prototype,"consumes",void 0);a.TransparentEnvironment=b.__decorate([e.subclass("esri.views.3d.webgl-engine.effects.TransparentEnvironment")],
a.TransparentEnvironment);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/LocalAtmosphere":function(){define("exports ../../../chunks/tslib.es6 ../../../core/maybe ../../../core/reactiveUtils ../../../core/Logger ../../../core/has ../../../core/RandomLCG ../../../core/Error ../../../core/accessorSupport/decorators/subclass ../../../core/libs/gl-matrix-2/math/mat4 ../../../core/libs/gl-matrix-2/factories/mat4f64 ../webgl ../../../chunks/SimpleAtmosphere.glsl ./SimpleAtmosphereTechnique ./SimpleAtmosphereTechniqueConfiguration ./resources/SimpleAtmosphereTexture ../support/buffer/glUtil ../support/buffer/InterleavedLayout ../webgl-engine/effects/OpaqueEnvironment ../webgl-engine/lib/basicInterfaces ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/GeometryUtil ../webgl-engine/lib/VertexArrayObject ../webgl-engine/lib/VertexAttribute ../../webgl/BufferObject ../../webgl/enums ../../webgl/Texture ../../webgl/TextureDescriptor ../../webgl/Util".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w,x,u,t,m,q,r,v,y,B,z,A,C,H,E,F,G){function D(M){var Q=B.createPolySphereData(1,2,!1);const {data:O,indices:K}=Q[0][1];Q=N.createBuffer(K.length);const L=Q.position;for(let P=0;P<K.length;++P){const R=3*K[0===P%3?P+2:2===P%3?P-2:P];L.set(P,0,O[R]);L.set(P,1,O[R+1]);L.set(P,2,O[R+2])}return new z.VertexArrayObject(M,y.Default3D,new Map([["geometry",m.glLayout(N)]]),new Map([["geometry",C.BufferObject.createVertex(M,H.Usage.STATIC_DRAW,Q.buffer)]]))}function I(M,Q){f.copy(M,
Q);M[12]=0;M[13]=0;M[14]=0;M[15]=1}a.LocalAtmosphere=class extends r.OpaqueEnvironment{constructor(M){super(M);this._configuration=new u.SimpleAtmosphereTechniqueConfiguration;this._passParameters=new w.SimpleAtmospherePassParameters;this._vao=null;this._vaoCount=0;({techniques:M}=M);this._configuration.geometry=u.SimpleAtmosphereGeometry.Cylinder;M.precompile(x.SimpleAtmosphereTechnique,this._configuration)}initialize(){this.addHandles([k.watch(()=>this.view.environment.atmosphereEnabled,M=>M?this._enable():
this._disable(),k.initial)])}destroy(){this._passParameters.texture=n.disposeMaybe(this._passParameters.texture);this._vao=n.disposeMaybe(this._vao)}render(M){M=M.find(({name:L})=>L===l.InternalRenderCategory.OPAQUE_ENVIRONMENT);const Q=this.techniques.acquire(x.SimpleAtmosphereTechnique,this._configuration);if(!Q.compiled)return Q.release(),this.requestRender(v.RenderRequestType.UPDATE),M;const O=this.renderingContext;this._vao||(this._vao=D(O),this._vaoCount=G.vertexCount(this._vao,"geometry"));
if(!this._passParameters.texture){var K=new F.TextureDescriptor;K.wrapMode=H.TextureWrapMode.CLAMP_TO_EDGE;K.flipped=!0;K.width=1;K.height=512;this._passParameters.texture=new E.Texture(O,K,t.earthAtmosphereTextureSimple)}K=O.bindTechnique(Q,this.bindParameters,this._passParameters);I(J,this.bindParameters.camera.viewMatrix);K.setUniformMatrix4fv("view",J);O.bindVAO(this._vao);K.assertCompatibleVertexAttributeLocations(this._vao);O.drawArrays(H.PrimitiveType.TRIANGLES,0,this._vaoCount);Q.release();
return M}};a.LocalAtmosphere=b.__decorate([d.subclass("esri.views.3d.environment.LocalAtmosphere")],a.LocalAtmosphere);const J=c.create(),N=q.newLayout().vec3f(A.VertexAttribute.POSITION);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/SimpleAtmosphere.glsl":function(){define("exports ../core/libs/gl-matrix-2/factories/vec2f64 ../core/libs/gl-matrix-2/factories/vec3f64 ../views/3d/environment/SimpleAtmosphereTechniqueConfiguration ../views/3d/webgl-engine/core/shaderLibrary/Transform.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MainLighting.glsl ../views/3d/webgl-engine/core/shaderModules/Float2PassUniform ../views/3d/webgl-engine/core/shaderModules/Float3PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/Matrix4PassUniform ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w,x){function u(r){const v=new l.ShaderBuilder,{vertex:y,fragment:B}=v;h.addMainLightDirection(y);r.geometry===k.SimpleAtmosphereGeometry.Underground?(v.attributes.add(x.VertexAttribute.POSITION,"vec2"),v.varyings.add("color","vec4"),y.uniforms.add(new g.Float3PassUniform("cameraPosition",(z,A)=>A.camera.eye),new d.FloatPassUniform("undergroundFadeAlpha",z=>z.undergroundFadeAlpha)),y.main.add(f.glsl`float ndotl = dot(normalize(cameraPosition), mainLightDirection);
float lighting = max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));
color = vec4(vec3(lighting), undergroundFadeAlpha);
gl_Position = vec4(position.xy, 1.0, 1.0);`),B.main.add(f.glsl`fragColor = color;`)):(v.include(p.Transform,r),v.attributes.add(x.VertexAttribute.POSITION,"vec3"),v.varyings.add("vtc","vec2"),v.varyings.add("falloff","float"),r=r.geometry===k.SimpleAtmosphereGeometry.Cylinder,y.uniforms.add(new c.Matrix4PassUniform("proj",(z,A)=>A.camera.projectionMatrix),new c.Matrix4PassUniform("view",(z,A)=>A.camera.viewMatrix)),r||(v.varyings.add("innerFactor","float"),y.uniforms.add(new g.Float3PassUniform("silCircleCenter",
z=>z.silhouette.center)),y.uniforms.add(new g.Float3PassUniform("silCircleV1",z=>z.silhouette.v1)),y.uniforms.add(new g.Float3PassUniform("silCircleV2",z=>z.silhouette.v2)),y.uniforms.add(new e.Float2PassUniform("texV",z=>z.texV)),y.uniforms.add(new d.FloatPassUniform("innerScale",z=>z.innerScale))),y.main.add(f.glsl`
      ${r?f.glsl`
      vec3 pos = position;
      float ndotl = mainLightDirection.z;
      vtc = vec2(0.0, position.z + 0.05);`:f.glsl`
      innerFactor = clamp(-position.z, 0.0, 1.0);
      float scale = position.y * (1.0 + innerFactor * innerScale);
      float phi = position.x * ${f.glsl.float(.04908738515625)} + 1.0;
      vec3 pos =  (silCircleCenter + sin(phi) * silCircleV1 + cos(phi) * silCircleV2) * scale;
      float ndotl = dot(normalize(position.y > 0.0 ? pos: silCircleCenter), mainLightDirection);
      vtc.x = position.x  * ${f.glsl.float(.0078125)};
      vtc.y = texV.x * (1.0 - position.z) + texV.y * position.z;
      `}
      falloff = max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));

		  gl_Position = transformPosition(proj, view, pos);
		  gl_Position.z = gl_Position.w; // project atmosphere onto the far plane
	  `),B.uniforms.add(new w.Texture2DPassUniform("tex",z=>z.texture)),r||B.uniforms.add(new d.FloatPassUniform("altitudeFade",z=>z.altitudeFade)),B.main.add(f.glsl`
			vec4 atmosphereColor = texture(tex, vtc) * falloff;
      ${r?f.glsl`fragColor = atmosphereColor;`:f.glsl`
			vec4 innerColor = vec4(atmosphereColor.rgb, 1.0 - altitudeFade);
			fragColor = mix(atmosphereColor, innerColor, smoothstep(0.0, 1.0, innerFactor));`}`));return v}class t extends f.NoParameters{constructor(){super(...arguments);this.texV=b.create();this.undergroundFadeAlpha=this.innerScale=this.altitudeFade=0;this.silhouette=new m}}class m{constructor(){this.center=n.create();this.v1=n.create();this.v2=n.create()}}const q=Object.freeze(Object.defineProperty({__proto__:null,SilhouetteCircle:m,SimpleAtmospherePassParameters:t,build:u},Symbol.toStringTag,{value:"Module"}));
a.SilhouetteCircle=m;a.SimpleAtmosphere=q;a.SimpleAtmospherePassParameters=t;a.build=u})},"esri/views/3d/environment/SimpleAtmosphereTechniqueConfiguration":function(){define(["exports","../../../chunks/tslib.es6","../webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration","../webgl-engine/materials/DefaultTechniqueConfiguration"],function(a,b,n,k){a.SimpleAtmosphereGeometry=void 0;(function(h){h[h.Cone=0]="Cone";h[h.Cylinder=1]="Cylinder";h[h.Underground=2]="Underground";h[h.COUNT=3]="COUNT"})(a.SimpleAtmosphereGeometry||
(a.SimpleAtmosphereGeometry={}));class p extends k.DefaultTechniqueConfiguration{constructor(){super(...arguments);this.geometry=a.SimpleAtmosphereGeometry.Cone}}b.__decorate([n.parameter({count:a.SimpleAtmosphereGeometry.COUNT})],p.prototype,"geometry",void 0);a.SimpleAtmosphereTechniqueConfiguration=p;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/SimpleAtmosphereTechnique":function(){define("require exports ../../../chunks/SimpleAtmosphere.glsl ./SimpleAtmosphereTechniqueConfiguration ../webgl-engine/core/shaderTechnique/ReloadableShaderModule ../webgl-engine/core/shaderTechnique/ShaderTechnique ../../webgl/enums ../../webgl/renderState".split(" "),
function(a,b,n,k,p,h,e,g){class d extends h.ShaderTechnique{constructor(f,c,l){super(f,c,new p.ReloadableShaderModule(n.SimpleAtmosphere,()=>new Promise((w,x)=>a(["./SimpleAtmosphere.glsl"],w,x))),l)}initializePipeline(f){return g.makePipelineState({blending:g.premultipliedAlphaToPremultipliedAlpha,culling:f.geometry===k.SimpleAtmosphereGeometry.Cylinder?g.backFaceCullingParams:void 0,depthTest:{func:e.CompareFunction.LEQUAL},colorWrite:g.defaultColorWrite})}}b.SimpleAtmosphereTechnique=d;Object.defineProperty(b,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/resources/SimpleAtmosphereTexture":function(){define(["exports"],function(a){const b=new Uint8ClampedArray([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,6,0,0,0,6,0,0,0,6,0,0,0,6,0,0,0,6,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,
7,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,10,0,0,0,10,0,0,0,10,0,0,0,10,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,12,0,0,0,12,0,0,0,12,0,0,0,12,0,0,0,13,0,0,0,13,0,0,0,13,0,0,0,13,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,15,0,0,0,15,0,0,0,15,0,0,0,15,0,0,0,15,16,0,0,16,16,0,0,16,16,0,0,16,16,0,0,16,15,0,0,17,15,0,0,17,15,0,0,17,15,0,0,17,14,0,0,18,14,0,0,18,14,0,0,18,13,0,0,19,13,0,0,19,13,0,0,19,13,0,0,19,13,0,0,20,13,0,0,20,13,0,0,20,13,0,
0,20,12,0,0,21,12,0,0,21,12,0,0,21,12,0,0,21,12,0,0,22,12,0,0,22,12,0,0,22,12,0,0,22,11,0,0,23,11,0,0,23,11,0,0,23,11,0,0,24,11,0,0,24,11,0,0,24,11,0,0,24,10,0,0,25,10,0,0,25,10,0,0,25,10,0,0,26,10,0,0,26,10,0,0,26,10,0,0,26,9,0,0,27,9,0,0,27,9,0,0,27,18,0,0,28,18,0,0,28,18,0,0,28,18,0,0,28,18,0,0,29,18,0,0,29,18,0,0,29,17,0,0,30,17,0,0,30,17,0,0,30,17,0,0,30,16,0,0,31,16,0,0,31,16,0,0,31,16,0,0,32,16,0,0,32,16,0,0,32,15,0,0,33,15,0,0,33,15,0,0,33,15,0,0,34,15,8,0,34,15,8,0,34,15,8,0,34,15,7,0,35,
15,7,0,35,15,7,0,35,21,7,0,36,21,7,0,36,21,7,0,36,21,7,0,37,21,7,0,37,21,7,0,37,20,7,0,38,20,7,0,38,20,7,0,38,20,7,0,39,20,7,0,39,20,7,0,39,20,7,0,39,19,6,0,40,19,6,0,40,19,6,0,40,19,6,0,41,19,6,0,41,19,6,0,41,18,6,0,42,18,6,0,42,18,6,0,42,24,6,0,43,24,6,0,43,24,6,0,43,23,6,0,44,23,6,0,44,23,6,0,44,23,6,0,45,23,6,0,45,23,6,0,45,22,6,0,46,22,6,0,46,22,6,0,46,22,5,0,47,22,5,0,47,22,5,0,47,21,5,0,48,21,5,0,48,21,5,0,48,21,5,0,49,21,5,0,49,26,5,0,49,25,5,0,50,25,5,0,50,25,5,0,50,25,5,0,51,25,5,0,51,25,
5,0,51,25,5,0,52,25,5,0,52,25,5,0,52,24,5,0,53,24,5,0,53,24,5,0,53,24,9,0,54,28,9,0,54,28,9,0,54,28,9,0,55,28,9,0,55,27,9,0,56,27,9,0,56,27,9,0,56,27,9,4,57,27,9,4,57,27,9,4,57,26,9,4,58,26,9,4,58,26,9,4,58,26,9,4,59,26,9,4,59,26,9,4,59,26,8,4,60,30,8,4,60,30,8,4,60,29,8,4,61,29,8,4,61,29,8,4,62,29,8,4,62,29,8,4,62,28,8,4,63,28,8,4,63,28,8,4,63,28,12,4,64,28,12,4,64,28,12,4,64,27,12,4,65,27,12,8,65,27,12,8,65,31,12,8,66,31,12,8,66,30,11,8,67,30,11,8,67,30,11,8,67,30,11,8,68,30,11,8,68,30,11,8,68,
30,15,7,69,30,15,7,69,30,15,7,69,33,15,11,70,33,15,11,70,32,14,11,71,32,14,11,71,32,14,11,71,32,18,14,72,32,18,14,72,32,18,14,72,31,17,14,73,35,17,14,73,34,17,17,74,34,21,17,74,34,21,17,74,34,20,17,75,34,20,20,75,34,20,20,75,34,23,20,76,34,23,20,76,36,23,23,77,36,23,23,77,36,23,23,77,36,23,23,78,36,26,26,78,36,26,26,78,36,26,26,79,36,26,29,79,38,26,29,80,38,29,29,80,38,29,29,80,38,28,31,81,38,28,31,81,38,31,31,81,37,31,34,82,37,31,34,82,37,31,37,83,40,34,37,83,40,34,37,83,39,33,39,84,39,33,39,84,
39,36,42,84,39,36,42,85,39,36,42,85,39,36,42,85,39,39,44,86,39,39,44,86,41,38,47,87,41,41,47,87,41,41,50,87,41,41,49,88,41,41,52,88,40,43,52,89,43,43,52,89,43,43,54,89,42,45,54,90,42,45,57,90,42,45,57,90,42,45,59,91,42,48,59,91,44,47,61,92,44,47,61,92,44,50,61,92,44,49,63,93,44,49,63,93,44,52,66,93,43,52,65,94,46,54,68,94,46,54,70,95,46,54,70,95,46,54,70,95,45,56,72,96,45,56,72,96,45,58,74,97,47,58,76,97,47,58,76,97,47,60,78,98,47,60,78,98,47,60,81,98,49,62,80,99,49,62,82,99,48,61,84,100,48,64,84,
100,48,64,84,100,50,63,86,101,50,66,86,101,50,66,88,101,50,65,90,102,52,67,89,103,51,69,91,104,51,68,92,105,52,69,93,107,52,71,94,108,54,70,96,109,53,71,96,111,52,73,98,112,54,72,98,114,53,73,100,115,54,72,100,117,54,73,102,118,55,74,104,120,55,76,105,121,56,77,106,123,56,76,107,124,57,79,107,126,58,78,110,128,57,79,111,129,56,80,113,131,58,79,112,132,57,82,114,134,58,81,116,136,60,82,117,137,59,83,117,139,60,83,119,141,59,84,120,142,60,85,122,144,59,86,122,146,60,86,126,148,62,87,127,149,61,88,127,
151,62,88,128,153,63,89,130,155,62,90,131,156,63,90,132,158,64,91,134,160,65,91,135,162,64,92,136,163,63,93,138,165,66,95,139,167,65,95,140,169,66,95,142,171,67,96,142,172,66,97,144,174,67,99,145,176,67,97,148,178,67,99,147,180,68,100,149,181,68,100,150,183,69,101,152,185,70,102,153,187,71,103,155,188,70,103,156,190,70,104,157,192,71,105,158,194,71,106,160,195,72,106,161,197,72,108,161,199,73,108,163,200,73,109,164,202,74,109,165,204,74,110,167,206,75,111,168,207,74,112,170,209,75,112,170,210,76,
113,171,212,76,114,173,214,77,115,174,215,78,115,175,217,78,116,175,218,78,117,177,220,78,118,178,221,79,118,180,223,80,120,180,224,81,120,181,226,81,120,182,227,82,121,184,229,82,122,185,230,84,123,186,232,83,123,187,233,84,124,189,234,84,125,188,235,85,126,189,237,86,126,190,238,86,127,191,239,87,127,192,240,87,129,193,242,88,129,194,243,89,130,195,244,90,131,196,245,90,132,197,246,91,132,197,247,92,133,198,248,92,134,199,249,93,135,200,250,94,136,201,251,95,137,202,252,96,138,203,253,97,140,204,
254,98,141,205,254,99,142,206,255,101,143,207,255,102,144,208,255,103,146,209,255,104,147,209,255,106,148,210,255,107,149,211,255,108,151,212,255,110,152,213,255,111,153,213,255,112,154,214,255,114,156,215,255,115,157,215,255,117,158,216,255,118,160,217,255,120,161,217,255,121,162,218,255,123,164,218,255,124,165,219,255,125,166,219,255,127,167,220,255,129,169,220,255,130,170,221,255,132,171,221,255,133,173,222,255,134,174,222,255,136,175,223,255,139,178,224,255,142,180,224,255,144,182,225,255,147,
185,226,255,150,187,226,255,153,189,227,255,155,191,228,255,158,194,228,255,160,196,229,255,163,198,229,255,165,200,230,255,168,202,231,255,170,203,231,255,172,205,232,255,174,207,232,255,176,209,233,255,178,210,234,255,180,212,234,255,182,214,235,255,184,215,236,255,186,217,237,255,188,219,238,255,190,220,238,255,192,221,239,255,193,222,240,255,194,224,240,255,196,225,241,255,197,226,241,255,198,226,242,255,199,227,242,255,200,228,242,255,201,228,243,255,202,229,243,255,203,230,243,255,204,230,244,
255,205,231,244,255,207,232,244,255,208,233,245,255,209,233,245,255,211,234,246,255,213,235,246,255,217,238,247,255,222,240,248,255,226,242,249,255,231,245,250,255,236,247,251,255,241,249,252,255,245,251,253,255,249,252,254,255,255,255,255,255]);a.earthAtmosphereTextureSimple=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/MarsAtmosphere":function(){define("../../../chunks/tslib.es6 ../../../core/mathUtils ../../../core/maybe ../../../core/reactiveUtils ../../../core/Logger ../../../core/has ../../../core/RandomLCG ../../../core/Error ../../../core/accessorSupport/decorators/subclass ../../../core/libs/gl-matrix-2/math/mat4 ../../../core/libs/gl-matrix-2/factories/mat4f64 ../../../core/libs/gl-matrix-2/math/vec2 ../../../chunks/vec32 ../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../geometry/ellipsoidUtils ../../../geometry/support/FloatArray ../webgl ./atmosphereUtils ../../../chunks/SimpleAtmosphere.glsl ./SimpleAtmosphereTechnique ./SimpleAtmosphereTechniqueConfiguration ./resources/MarsAtmosphereTexture ../support/mathUtils ../support/buffer/glUtil ../support/buffer/InterleavedLayout ../webgl-engine/effects/OpaqueEnvironment ../webgl-engine/lib/basicInterfaces ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/glUtil3D ../webgl-engine/lib/Util ../webgl-engine/lib/VertexArrayObject ../webgl-engine/lib/VertexAttribute ../../webgl/BufferObject ../../webgl/enums ../../webgl/Texture ../../webgl/TextureDescriptor ../../webgl/Util".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w,x,u,t,m,q,r,v,y,B,z,A,C,H,E,F,G,D,I,J,N,M,Q,O,K){function L(da,fa,ha,T,S){const Z=w.length(da),ia=T*Math.sqrt(Z*Z-T*T)/Z,Y=S.v1,ea=S.v2;w.scale(S.center,da,Math.sqrt(T*T-ia*ia)/Z);w.cross(Y,da,fa);1>w.squaredLength(Y)&&w.cross(Y,da,ha);w.scale(Y,Y,ia/w.length(Y));w.cross(ea,Y,da);w.scale(ea,ea,ia/w.length(ea));return ia}const P=-q.innerAtmosphereDepth,R=z.makePiecewiseLinearFunction([[50,.1015625],[500,.21875],[5E3,.51171875],[5E4,.4140625]]);p=class extends H.OpaqueEnvironment{constructor(da){super(da);
this._passParameters=new r.SimpleAtmospherePassParameters;this._configuration=new y.SimpleAtmosphereTechniqueConfiguration;this._vao=null;this._vaoCount=0;this._fadeVao=null;this._fadeVaoCount=0;this._texV1=1;const {view:fa,techniques:ha}=da;da=u.getReferenceEllipsoid(fa.spatialReference);const {outerAtmosphereRimWidth:T,radius:S}=da;this._planetRadius=S;this._innerRimFactor=1+P/S;this._middleRimFactor=1+0/S;this._outerRimFactor=1+T/S;this._texV0=0/T;this._texVScale=this._texV1-this._texV0;ha.precompile(v.SimpleAtmosphereTechnique,
this._configuration);this._configuration.geometry=y.SimpleAtmosphereGeometry.Underground;ha.precompile(v.SimpleAtmosphereTechnique,this._configuration)}initialize(){this.addHandles(k.watch(()=>this.view.environment.atmosphereEnabled,da=>da?this._enable():this._disable(),k.initial))}destroy(){this._passParameters.texture=n.disposeMaybe(this._passParameters.texture);this._fadeVao=n.disposeMaybe(this._fadeVao);this._vao=n.disposeMaybe(this._vao)}render(da){da=da.find(({name:T})=>T===m.InternalRenderCategory.OPAQUE_ENVIRONMENT);
this._update();const fa=this.renderingContext;if(!this._passParameters.texture){var ha=new O.TextureDescriptor;ha.wrapMode=M.TextureWrapMode.CLAMP_TO_EDGE;ha.flipped=!0;ha.width=1;ha.height=512;this._passParameters.texture=new Q.Texture(fa,ha,B.marsAtmosphereTextureSimple)}if(1>this._passParameters.undergroundFadeAlpha){this._vao||(this._vao=this._createRibbon(fa),this._vaoCount=K.vertexCount(this._vao,"geometry"));this._configuration.geometry=y.SimpleAtmosphereGeometry.Cone;ha=this.techniques.acquire(v.SimpleAtmosphereTechnique,
this._configuration);if(!ha.compiled)return ha.release(),this.requestRender(E.RenderRequestType.UPDATE),da;fa.bindTechnique(ha,this.bindParameters,this._passParameters);fa.bindVAO(this._vao);fa.drawArrays(M.PrimitiveType.TRIANGLES,0,this._vaoCount);ha.release()}if(0<this._passParameters.undergroundFadeAlpha){this._fadeVao||(this._fadeVao=G.createQuadVAO(fa),this._fadeVaoCount=K.vertexCount(this._fadeVao,"geometry"));this._configuration.geometry=y.SimpleAtmosphereGeometry.Underground;ha=this.techniques.acquire(v.SimpleAtmosphereTechnique,
this._configuration);if(!ha.compiled)return ha.release(),this.requestRender(E.RenderRequestType.UPDATE),da;fa.bindTechnique(ha,this.bindParameters,this._passParameters);fa.bindVAO(this._fadeVao);fa.drawArrays(M.PrimitiveType.TRIANGLE_STRIP,0,this._fadeVaoCount);ha.release()}return da}_update(){var da=this.bindParameters.camera,fa=x.create();const ha=this._planetRadius;var T=w.length(da.eye);const S=T-ha;this._passParameters.undergroundFadeAlpha=0>S?Math.min(-S/5E3,1):0;var Z=ha+P,ia=ha+Math.max(50,
S);this._passParameters.innerScale=ia*ia/(Math.sqrt(ia*ia-ha*ha)*Math.sqrt(ia*ia-Z*Z)+ha*Z)-1;this._passParameters.altitudeFade=q.computeInnerAltitudeFade(S);w.scale(fa,da.eye,(ha+50)/T);L(fa,da.center,da.up,ha,this._passParameters.silhouette);fa=this._computeScreenRimWidth(da,fa,da.up,this._passParameters.silhouette);T=R(S);Z=this._texV0+.001953125*this._texVScale;ia=this._texV0+fa*T*this._texVScale;50<S&&(L(da.eye,da.center,da.up,ha,this._passParameters.silhouette),da=this._computeScreenRimWidth(da,
da.eye,da.up,this._passParameters.silhouette),da=b.clamp((da-1.5)/(fa-1.5),0,1),Z=this._texV0+.001953125*da*this._texVScale,ia=this._texV0+b.lerp(this._texV1,fa*T,da)*this._texVScale);l.set(this._passParameters.texV,Z,ia)}_createRibbon(da){const fa=t.newFloatArray(1155),ha=new Uint32Array(1920);fa[0]=0;fa[1]=0;fa[2]=-1;for(var T=0;128>T;T++){var S=9*T+3;fa[S]=T;fa[S+1]=this._innerRimFactor;fa[S+2]=-1;fa[S+3]=T;fa[S+4]=this._middleRimFactor;fa[S+5]=0;fa[S+6]=T;fa[S+7]=this._outerRimFactor;fa[S+8]=
1;S=3*T+1;var Z=127===T?1:S+3,ia=15*T;ha[ia]=S;ha[ia+1]=S+1;ha[ia+2]=Z+1;ha[ia+3]=Z+1;ha[ia+4]=Z;ha[ia+5]=S;ha[ia+6]=S+1;ha[ia+7]=S+2;ha[ia+8]=Z+2;ha[ia+9]=Z+2;ha[ia+10]=Z+1;ha[ia+11]=S+1;ha[ia+12]=S;ha[ia+13]=Z;ha[ia+14]=0}T=U.createBuffer(ha.length);S=T.position;for(Z=0;Z<ha.length;++Z)ia=3*ha[Z],S.set(Z,0,fa[ia]),S.set(Z,1,fa[ia+1]),S.set(Z,2,fa[ia+2]);return new I.VertexArrayObject(da,F.Default3D,new Map([["geometry",A.glLayout(U)]]),new Map([["geometry",N.BufferObject.createVertex(da,M.Usage.STATIC_DRAW,
T.buffer)]]))}_computeScreenRimWidth(da,fa,ha,T){w.add(V,T.center,T.v2);w.scale(ba,V,this._outerRimFactor);f.lookAt(W,fa,V,ha);D.project(V,W,da.projectionMatrix,da.viewport,V);D.project(ba,W,da.projectionMatrix,da.viewport,ba);return w.distance(V,ba)/da.height}};p=a.__decorate([d.subclass("esri.views.3d.environment.MarsAtmosphere")],p);const W=c.create(),V=x.create(),ba=x.create(),U=C.newLayout().vec3f(J.VertexAttribute.POSITION);return p})},"esri/views/3d/environment/resources/MarsAtmosphereTexture":function(){define(["exports"],
function(a){const b=new Uint8ClampedArray([0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,6,0,0,0,6,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,10,0,0,0,10,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,12,0,0,0,12,0,0,0,12,0,0,0,13,0,0,0,13,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,15,0,0,0,15,0,0,0,16,0,0,0,16,0,0,0,16,0,0,0,17,0,0,0,17,0,0,
0,18,0,0,0,18,0,0,0,19,0,0,0,19,0,0,0,19,0,0,0,20,0,0,0,20,0,0,0,21,0,0,0,21,0,0,0,22,0,0,0,22,11,0,0,23,11,0,0,23,11,0,0,23,11,0,0,23,11,0,0,24,11,0,0,24,11,0,0,24,10,0,0,25,10,0,0,25,10,0,0,26,10,0,0,26,9,0,0,27,9,0,0,27,9,0,0,28,9,0,0,28,9,0,0,29,9,0,0,29,8,0,0,30,8,0,0,30,8,0,0,31,8,0,0,31,8,0,0,32,8,0,0,32,8,0,0,32,8,0,0,32,8,0,0,33,8,0,0,33,8,0,0,34,7,0,0,35,7,0,0,35,7,0,0,36,7,0,0,36,7,7,0,37,7,7,0,37,7,7,0,38,7,7,0,38,13,7,0,39,13,7,0,39,13,6,0,40,13,6,0,40,12,6,0,41,12,6,0,41,12,6,0,41,12,
6,0,42,12,6,0,42,12,6,0,43,12,6,0,43,12,6,0,44,12,6,0,44,11,6,0,45,11,6,6,45,11,6,6,46,11,5,5,47,11,5,5,47,11,5,5,48,11,5,5,48,10,5,5,49,10,5,5,49,10,5,5,50,15,5,5,51,15,5,5,51,15,5,5,51,15,5,5,51,15,5,5,52,15,5,5,52,14,5,5,53,14,5,5,54,14,5,5,54,14,5,5,55,14,5,5,55,14,5,5,56,13,4,4,57,13,4,4,57,13,4,4,58,13,4,4,58,13,4,4,59,13,4,4,59,17,4,4,60,17,4,4,60,17,4,4,60,17,4,4,61,17,4,4,61,16,4,4,62,16,4,4,63,16,4,4,63,16,8,4,64,16,8,4,64,16,8,4,65,15,8,4,66,15,8,4,66,15,8,4,67,19,8,4,68,19,8,4,68,18,7,
4,69,18,7,4,69,18,7,4,69,18,7,4,70,18,7,4,70,18,7,4,71,18,7,4,71,18,7,4,72,17,7,3,73,17,7,3,73,21,7,3,74,21,7,3,74,20,7,3,75,20,7,3,76,20,7,3,76,20,7,3,77,20,7,3,77,20,7,3,78,20,7,3,78,20,7,7,78,19,6,6,79,19,10,6,80,19,10,6,80,22,9,6,81,22,9,6,81,22,9,6,82,22,9,6,83,22,9,6,83,21,9,6,84,21,9,6,84,21,9,6,85,21,9,6,86,21,9,6,86,23,9,6,87,23,9,6,87,23,9,6,87,23,9,6,88,23,9,6,88,23,9,6,89,23,8,6,90,23,8,6,90,22,8,6,91,22,8,6,91,25,8,6,92,25,8,5,93,25,8,5,93,24,8,5,94,24,8,5,94,24,11,5,95,24,11,5,96,24,
11,5,96,26,11,5,97,26,11,5,97,26,11,5,97,26,10,5,98,26,10,5,98,26,10,5,99,25,10,5,100,25,10,5,100,25,10,5,101,25,10,5,101,25,10,5,102,27,10,5,103,27,10,5,103,27,10,5,104,27,10,5,104,27,12,5,105,26,12,5,106,26,12,5,106,29,12,5,106,29,12,5,106,29,12,7,107,28,12,7,108,28,12,7,108,28,12,7,109,28,12,7,109,30,12,7,110,30,11,7,111,30,11,7,111,30,11,7,112,30,11,7,112,29,11,7,113,29,11,7,114,29,11,7,114,31,11,7,115,31,11,7,115,31,11,7,115,31,11,7,116,31,11,7,116,33,13,7,117,33,13,9,117,32,13,9,118,32,13,9,
118,32,13,9,119,34,15,8,120,34,15,8,120,34,15,8,121,36,15,8,121,36,15,8,122,36,15,8,122,35,15,8,123,37,14,8,124,37,14,8,124,37,14,8,124,37,14,8,124,39,14,8,125,39,16,8,125,38,16,8,126,38,16,8,127,38,16,8,127,40,16,10,128,40,16,10,128,40,16,10,129,42,18,10,129,41,18,10,130,41,18,10,130,43,18,10,131,43,18,10,131,42,17,10,132,42,17,12,132,42,17,12,133,44,17,12,133,44,17,12,133,46,17,11,134,46,17,11,134,45,19,11,135,45,19,11,135,47,19,11,136,47,19,11,136,47,19,11,137,47,19,11,137,48,20,11,138,48,20,11,
138,50,20,13,139,50,20,13,139,49,20,13,140,49,22,13,140,51,22,13,141,51,22,13,141,50,22,13,142,52,22,13,142,52,21,12,143,53,21,12,143,53,21,12,143,53,21,12,143,53,21,14,144,53,23,14,144,55,23,14,145,55,23,14,145,56,23,14,146,56,23,14,146,57,24,14,147,57,24,14,147,59,24,16,148,59,24,16,148,58,24,15,149,58,26,15,149,58,26,15,149,60,26,15,150,60,26,15,150,61,25,15,151,61,25,15,151,62,25,17,152,62,25,17,152,64,25,17,152,64,27,17,152,63,27,17,153,63,27,17,153,65,27,17,153,66,28,17,154,66,28,17,154,67,
28,16,155,67,28,16,155,67,30,16,155,69,29,18,156,69,29,18,156,68,29,18,157,70,29,18,157,70,29,18,157,71,31,18,158,71,31,18,158,72,30,19,159,72,30,19,159,74,30,19,159,73,30,19,160,73,32,19,160,74,32,19,161,74,32,21,161,76,32,21,161,78,33,21,161,78,33,21,161,79,35,20,162,78,34,20,163,79,34,22,164,81,36,22,164,82,36,22,165,81,35,22,166,82,37,21,167,84,37,21,167,85,36,21,168,86,38,23,169,88,38,23,169,88,38,23,170,88,39,23,170,89,39,24,171,91,40,24,171,92,40,24,172,93,40,24,173,94,41,25,173,95,41,25,174,
96,42,25,175,98,42,25,175,99,43,26,176,99,43,26,177,101,45,26,177,102,44,26,178,103,46,27,179,104,46,27,179,105,46,27,179,106,45,28,180,108,47,28,180,108,46,28,181,109,48,28,182,111,48,29,182,111,49,29,183,114,49,29,184,114,50,30,184,114,50,30,185,116,51,30,185,117,51,30,186,119,52,31,187,119,53,31,187,121,53,31,188,122,54,33,188,123,54,32,189,124,55,32,189,125,55,32,189,126,56,34,190,128,56,34,190,128,57,33,191,130,57,33,191,131,58,35,192,131,58,35,192,133,59,34,193,134,60,35,194,135,60,35,194,136,
61,37,195,139,61,37,195,139,62,36,196,141,62,36,196,141,63,38,197,142,63,38,197,143,64,39,198,144,64,39,198,146,66,39,198,146,67,39,198,147,67,38,199,147,68,40,199,149,68,40,200,150,69,40,200,152,70,41,201,154,71,41,201,154,71,42,202,155,72,42,202,156,73,41,203,157,73,43,203,158,74,42,204,160,75,44,204,161,76,44,204,162,77,44,205,164,77,45,205,165,78,45,206,166,79,45,206,168,80,46,207,169,81,46,207,170,83,47,207,171,83,47,207,172,83,47,207,174,85,48,208,175,85,48,208,177,85,48,209,178,87,49,209,180,
87,49,210,181,87,49,210,182,89,50,210,182,89,50,211,185,91,50,211,186,91,51,212,186,93,51,212,189,94,52,212,190,95,51,213,192,96,51,213,193,96,53,213,194,97,52,214,195,98,54,214,197,98,55,215,198,100,55,215,199,101,55,215,200,102,55,216,202,103,55,216,203,104,55,216,204,105,57,216,205,106,57,216,207,107,58,216,208,108,58,217,209,109,59,217,210,110,60,217,211,111,60,218,212,112,61,218,213,113,61,218,214,114,62,219,217,115,63,219,217,116,64,219,218,118,64,220,219,119,65,220,220,121,66,220,222,121,67,
221,222,122,67,221,222,123,68,221,223,124,69,222,224,125,70,222,225,127,71,222,226,128,72,223,228,129,73,223,228,130,74,223,229,132,75,223,230,135,79,224,231,138,81,224,233,141,84,224,233,144,87,225,235,147,91,225,236,150,94,225,237,154,97,225,238,158,102,225,239,161,107,225,239,165,110,225,240,168,114,226,241,172,118,226,241,176,122,226,241,181,126,226,242,183,130,227,243,186,135,227,243,190,139,227,244,194,143,227,244,197,147,228,244,200,150,228,245,204,154,228,245,207,157,228,245,210,161,229,246,
212,164,229,246,215,167,229,246,217,169,229,246,220,172,230,247,221,174,230]);a.marsAtmosphereTextureSimple=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/collections/Component/ComponentObjectCollection":function(){define("require exports ../../../../../core/Logger ../../../../../core/PooledArray ../../../../../core/typedArrayUtil ../../../../../chunks/vec32 ../../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../../geometry/support/aaBoundingBox ../../../../../geometry/support/Indices ../../../../../chunks/vec3 ../../../../../chunks/vec33 ../../../../ViewingMode ../../../layers/support/symbolColorUtils ../../../support/orientedBoundingBox ../../../support/buffer/glUtil ../../../support/buffer/InterleavedLayout ./ComponentData ./ComponentObject ./IntersectionGeometry ./Renderable ./RenderGeometry ./RenderSubmitSystem ./SourceGeometry ./UniformComponentParameters ./Material/ComponentMaterial ./Material/ComponentTechnique ./Material/shader/ComponentData.glsl ../../effects/geometry/olidUtils ../../lib/ComponentUtils ../../lib/Util ../../lib/VertexAttribute ../../lib/verticalOffsetUtils ../../lib/TextureBackedBuffer/BufferManager ../../../../webgl/BufferObject ../../../../webgl/enums ../../../../webgl/VertexArrayObject".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w,x,u,t,m,q,r,v,y,B,z,A,C,H,E,F,G,D,I,J,N,M,Q,O){function K(V,ba){return V===ba?C.ComponentParameterSummary.All:0===V?C.ComponentParameterSummary.None:C.ComponentParameterSummary.Some}const L=()=>n.getLogger("esri.views.3d.webgl-engine.collections.Component.ComponentObjectCollection");class P{constructor(V,ba){this._renderManager=V;this._viewingMode=ba;this._elevationRangeCacheMax=this._elevationRangeCacheMin=this._elevationRangeCacheVerticalOffset=NaN;this._visible=
new k;this._hidden=new k;this._renderSubmit=new B.RenderSubmitSystem(this);this._renderManager.register(this._renderSubmit);this._componentBufferManager=new N.BufferManager(V.rctx,2+(F.olidEnabled()?1:0))}destroy(){D.assert(0===this._hidden.length&&0===this._visible.length,"ObjectCollection should be empty upon disposal");this._componentBufferManager.destroy();this._visible.forAll(V=>V.destroy());this._hidden.forAll(V=>V.destroy());this._visible.clear();this._hidden.clear()}createObject(V){var ba=
V.geometry;const U=new m(this._componentBufferManager,d.compactIndices(ba.componentOffsets)),da=this._createRenderable(V,U);ba=new r.IntersectionGeometry(this._viewingMode,ba.positionData,U);V=new q.ComponentObject(V.transform,V.toMapSpace,V.obb.clone(),U,da,ba);(V.visible?this._visible:this._hidden).push(V);return V}destroyObject(V){(V.visible?this._visible:this._hidden).removeUnordered(V);V.destroy();this._notifyDirty()}setObjectVisibility(V,ba){ba!==V.visible&&(ba?(this._hidden.removeUnordered(V),
this._visible.push(V)):(this._visible.removeUnordered(V),this._hidden.push(V)),V.visible=ba,this._notifyDirty())}preSubmit(V){const ba=V.camera.eye;this.visibleObjects.forAll(U=>U.renderable.meta.cameraDepthSquared=h.squaredDistance(ba,U.obb.center))}getMaterial(V){return V.renderable.material}updateMaterial(V,ba){V=V.renderable.material;ba(V);V.dirty&&this._notifyDirty()}setAllComponentVisibilities(V,ba){V.components.visibility.reset(ba);V.components.visibilityDirty();this._notifyDirty()}forEachVisibleComponent(V,
ba){return V.components.visibility.forEachComponent(ba)}getComponentCount(V){const ba=V.components.visibility.componentCount;return{visible:ba,invisible:V.components.count-ba}}setComponentData(V,ba){const U=V.renderable.material,da=V.components;var fa=da.materialDataBuffer;const ha=da.materialDataIndices,T=new A.UniformComponentParameters;fa=fa.textureBuffer;const S=new Uint8Array(4),Z=new Uint32Array(S.buffer);let ia=0,Y=0,ea=0,ka=da.verticalOffsets,ja=Infinity,X=-Infinity,aa=!1,pa=!1,la=0;for(let na=
0;na<da.count;na++){ba(na,T);ia+=+(1>T.externalColor[3]);Y+=+(T.externalColorMixMode===w.ColorMixModeEnum.Replace&&1===T.externalColor[3]);ea+=+T.castShadows;w.encodeSymbolColor(T.externalColor,T.externalColorMixMode,S);S[2]=S[2]&254|+T.castShadows;fa.setData(ha[na],0,S[0],S[1],S[2],S[3]);aa||=0<na&&la!==Z[0];la=Z[0];pa||=0!==T.elevationOffset;pa&&null==ka&&(ka=Array(na).fill(0));null!=ka&&(ka[na]=T.elevationOffset);ja=Math.min(ja,T.elevationOffset);X=Math.max(X,T.elevationOffset);E.encodeElevationOffset(T.elevationOffset,
S);fa.setData(ha[na],1,S[0],S[1],S[2],S[3]);const qa=T.objectAndLayerIdColor;null!=qa&&fa.setData(ha[na],2,qa[0],qa[1],qa[2],qa[3]);T.pickable!==G.getVisibility(da.pickability,na)&&(da.pickability=G.updateVisibilityWithCount(da.pickability,da.count,na,T.pickable))}da.verticalOffsets=pa?ka:null;V.offsetObb=pa?x.computeOffsetObb(V.obb,ja,X,this._viewingMode,V.offsetObb??V.obb.clone()):null;aa||pa||F.olidEnabled()?(U.componentParameters=new C.ComponentParametersVarying,U.componentParameters.castShadows=
K(ea,da.count),U.componentParameters.transparent=K(ia,da.count),U.componentParameters.opaqueOverride=K(Y,da.count),U.componentParameters.texture=fa,fa.updateTexture()):(U.componentParameters=new C.ComponentParametersUniform,U.componentParameters.castShadows=T.castShadows?C.ComponentParameterSummary.All:C.ComponentParameterSummary.None,U.componentParameters.externalColor=T.externalColor,U.componentParameters.externalColorMixMode=T.externalColorMixMode);this._elevationRangeCacheVerticalOffset=NaN;this._notifyDirty()}getComponentAabb(V,
ba,U,da=!1){V.intersectionGeometry.getComponentAabb(ba,U);const fa=V.components.verticalOffsets;if(da||null==fa)return U;ba=fa[ba];if(this._viewingMode===l.ViewingMode.Local||0===ba)return U[2]+=ba,U[5]+=ba,U;ba=J.getVerticalOffsetI3S(ba);ba.localOrigin=V.transform.position;return ba.applyToAabb(U)}getComponentObb(V){return V.obb}getObjectTransform(V){return V.transform}getComponentPositions(V,ba,U){return V.intersectionGeometry.getComponentPositions(ba,U)}expandRangeWithComponentObjectElevationRange(V,
ba,U,da){Number.isNaN(this._elevationRangeCacheVerticalOffset)||this._elevationRangeCacheVerticalOffset!==ba||da.expandElevationRangeValues(this._elevationRangeCacheMin,this._elevationRangeCacheMax);var fa=V.components;const ha=fa.count;fa=fa.verticalOffsets;const T=this._viewingMode===l.ViewingMode.Local,S=V.intersectionGeometry.getComponentAabbs(),Z=W;let ia=Infinity,Y=-Infinity;for(let ja=0;ja<ha;ja++){var ea=6*ja,ka=fa?.[ja]??0;let X=Infinity,aa=-Infinity;if(T)X=S[ea+2]+ka+ba,aa=S[ea+5]+ka+ba;
else{Z[0]=S[ea];Z[1]=S[ea+1];Z[2]=S[ea+2];Z[3]=S[ea+3];Z[4]=S[ea+4];Z[5]=S[ea+5];0!==ka&&(ea=J.getVerticalOffsetI3S(ka),ea.localOrigin=V.transform.position,ea.applyToAabb(Z));ea=Math.max(Math.abs(Z[3]),Math.abs(Z[0]));ka=Math.max(Math.abs(Z[4]),Math.abs(Z[1]));const pa=ba+Z[5]+U;da.expandElevationRangeValues(ba+Z[2],Math.sqrt(ea*ea+ka*ka+pa*pa)-U)}da.expandElevationRangeValues(X,aa);ia=Math.min(ia,X);Y=Math.max(Y,aa)}this._elevationRangeCacheVerticalOffset=ba;this._elevationRangeCacheMin=ia;this._elevationRangeCacheMax=
Y}intersect(V,ba,U,da,fa,ha,T){const {transform:S}=V,{position:Z}=S;null!=fa&&(fa.localOrigin=Z);return V.intersectionGeometry.intersect(ba,U,da,fa,V.components.verticalOffsets,S,ha,T)}addEdges(V,ba,U,da,fa){const {indices:ha,positions:T}=V.intersectionGeometry;return ba.addComponentObject(V,T,ha,V.components.offsets,U,da,fa)}async extractEdgeInformation(V,ba,U){var da=V.components.visibility;if(da.allInvisible())return{extractComponentsEdgeLocationsLayout:ba}=await new Promise((Z,ia)=>a(["../../lib/edgeRendering/edgeProcessing"],
Z,ia)),{buffer:ba.createBuffer(0),origin:[0,0,0]};const {indices:fa,positions:ha}=V.intersectionGeometry,T=V.components.offsets;var {EdgeInputBufferLayout:S}=await new Promise((Z,ia)=>a(["../../lib/edgeRendering/bufferLayouts"],Z,ia));S=S.createBuffer(ha.length/3);c.copy(S.position.typedBuffer,ha,S.position.typedBufferStride,3);f.transformMat3View(S.position,S.position,V.transform.rotationScale);this._setComponentIndices(S.componentIndex,fa,T);da=this._computeVisibilityIndices(fa,da,T,S.count);V=
e.clone(V.transform.position);ba=await ba.extractComponentsEdgeLocations({indices:da,indicesLength:da.length,skipDeduplicate:!0,data:S,writerSettings:{reducedPrecision:!1,variants:0}},U);return{origin:V,buffer:ba}}_setComponentIndices(V,ba,U){let da=0;for(let ha=0;ha<U.length-1;ha++){var fa=U[ha];const T=U[ha+1];for(;fa<T;fa++)V.set(ba?ba[fa]:fa,da);da++}}_computeVisibilityIndices(V,ba,U,da){if(V&&ba.allVisible())return V;let fa=0;ba.forEachComponentRange((S,Z)=>{fa+=U[Z]-U[S];return!0});const ha=
p.isArray(V)?Array(fa):2===V?.BYTES_PER_ELEMENT||65536>=da?new Uint16Array(fa):new Uint32Array(fa);let T=0;ba.forEachComponentRange((S,Z)=>{S=U[S];for(Z=U[Z];S<Z;S++)ha[T++]=V?V[S]:S;return!0});return ha}addComponentHighlight(V,ba,U){V=V.components;let da=V.highlightCounts,fa=V.highlightGroups;if(null==da||null==fa)da=new Uint32Array(V.count+1),V.highlightCounts=da,fa=Array(V.count+1),V.highlightGroups=fa;fa[ba]=U;0===da[ba]++&&(V.highlightsDirty(),this._notifyDirty());da[V.count]++}removeComponentHighlight(V,
ba){V=V.components;const U=V.highlightCounts;if(null==U)L().warn("Removing non-existing highlight.");else{var da=U[ba];if(0===da)L().warn("Removing non-existing highlight.");else{var fa=U[V.count];1<da?(U[ba]=da-1,U[V.count]=fa-1):(U[ba]=0,V.highlightsDirty(),this._notifyDirty(),1===fa?(V.highlightCounts=null,V.highlightGroups=null):U[V.count]=fa-1)}}}clearHighlights(V){V=V.components;null!=V.highlightCounts&&(V.highlightCounts=null,V.highlightGroups=null,V.highlightsDirty(),this._notifyDirty())}getObjectGPUMemoryUsage(V){return V.renderable.meta.gpuMemoryEstimate}get visibleObjects(){return this._visible}_createRenderable(V,
ba){var U=this._renderManager.rctx;const da=V.geometry;var fa=da.vertices.layoutParameters;const ha=M.BufferObject.createVertex(U,Q.Usage.STATIC_DRAW,da.vertices.data),T=da.indices?M.BufferObject.createIndex(U,Q.Usage.STATIC_DRAW,da.indices):null,S=u.glLayout(z.createVertexBufferLayout(fa)),Z=new Uint16Array(da.vertices.count);for(let Y=0;Y<ba.count;Y++){var ia=ba.offsets[Y];const ea=ba.offsets[Y+1],ka=ba.materialDataIndices[Y];if(null!=da.indices)for(;ia<ea;ia++)Z[da.indices[ia]]=ka;else for(;ia<
ea;ia++)Z[ia]=ka}ba=M.BufferObject.createVertex(U,Q.Usage.STATIC_DRAW,Z.buffer);V=new C.ComponentMaterial(V.transform,V.toMapSpace);U=new O.VertexArrayObject(U,H.vertexAttributeLocations,new Map([["data",S],["componentIndices",R]]),new Map([["data",ha],["componentIndices",ba]]),T);fa=new y.RenderGeometry(U,Q.PrimitiveType.TRIANGLES,fa,null!=T);return new v.Renderable(V,fa,{cameraDepthSquared:.5,gpuMemoryEstimate:ha.usedMemory+ba.usedMemory+(null!=T?T.usedMemory:0)})}_notifyDirty(){this._renderManager.notifyDirty()}}
const R=u.glLayout(t.newLayout().u16(I.VertexAttribute.COMPONENTINDEX)),W=g.create();b.ComponentObjectCollection=P;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/vec3":function(){define(["exports","../core/has","../core/Logger"],function(a,b,n){function k(x,u,t){p(x.typedBuffer,u.typedBuffer,t,x.typedBufferStride,u.typedBufferStride)}function p(x,u,t,m=3,q=m){if(x.length/m!==Math.ceil(u.length/q))return x;const r=x.length/m,v=t[0],y=t[1],B=t[2],z=t[4],A=t[5],C=t[6],H=
t[8],E=t[9],F=t[10],G=t[12],D=t[13];t=t[14];let I=0,J=0;for(let N=0;N<r;N++){const M=u[I],Q=u[I+1],O=u[I+2];x[J]=v*M+z*Q+H*O+G;x[J+1]=y*M+A*Q+E*O+D;x[J+2]=B*M+C*Q+F*O+t;I+=q;J+=m}return x}function h(x,u,t){e(x.typedBuffer,u.typedBuffer,t,x.typedBufferStride,u.typedBufferStride)}function e(x,u,t,m=3,q=m){if(x.length/m===Math.ceil(u.length/q)){var r=x.length/m,v=t[0],y=t[1],B=t[2],z=t[3],A=t[4],C=t[5],H=t[6],E=t[7];t=t[8];var F=0,G=0;for(let D=0;D<r;D++){const I=u[F],J=u[F+1],N=u[F+2];x[G]=v*I+z*J+
H*N;x[G+1]=y*I+A*J+E*N;x[G+2]=B*I+C*J+t*N;F+=q;G+=m}}}function g(x,u,t){d(x.typedBuffer,u.typedBuffer,t,x.typedBufferStride,u.typedBufferStride)}function d(x,u,t,m=3,q=m){const r=Math.min(x.length/m,u.length/q);let v=0,y=0;for(let B=0;B<r;B++)x[y]=t*u[v],x[y+1]=t*u[v+1],x[y+2]=t*u[v+2],v+=q,y+=m;return x}function f(x,u,t,m=3,q=m){const r=x.length/m;if(r!==Math.ceil(u.length/q))return x;let v=0,y=0;for(let B=0;B<r;B++)x[y]=u[v]+t[0],x[y+1]=u[v+1]+t[1],x[y+2]=u[v+2]+t[2],v+=q,y+=m;return x}function c(x,
u){l(x.typedBuffer,u.typedBuffer,x.typedBufferStride,u.typedBufferStride)}function l(x,u,t=3,m=t){const q=Math.min(x.length/t,u.length/m);let r=0,v=0;for(let B=0;B<q;B++){const z=u[r],A=u[r+1],C=u[r+2];var y=z*z+A*A+C*C;0<y&&(y=1/Math.sqrt(y),x[v]=y*z,x[v+1]=y*A,x[v+2]=y*C);r+=m;v+=t}}function w(x,u,t){const m=Math.min(x.count,u.count),q=x.typedBuffer;x=x.typedBufferStride;const r=u.typedBuffer;u=u.typedBufferStride;let v=0,y=0;for(let B=0;B<m;B++)q[y]=r[v]>>t,q[y+1]=r[v+1]>>t,q[y+2]=r[v+2]>>t,v+=
u,y+=x}b=Object.freeze(Object.defineProperty({__proto__:null,normalize:l,normalizeView:c,scale:d,scaleView:g,shiftRight:w,transformMat3:e,transformMat3View:h,transformMat4:p,transformMat4View:k,translate:f},Symbol.toStringTag,{value:"Module"}));a.normalize=l;a.normalizeView=c;a.scale=d;a.scaleView=g;a.shiftRight=w;a.transformMat3=e;a.transformMat3View=h;a.transformMat4=p;a.transformMat4View=k;a.translate=f;a.vec3=b})},"esri/chunks/vec33":function(){define(["exports"],function(a){function b(h,e){n(h.typedBuffer,
e.typedBuffer,h.typedBufferStride,e.typedBufferStride)}function n(h,e,g=3,d=g){const f=e.length/d;let c=0,l=0;for(let w=0;w<f;++w)h[c]=e[l],h[c+1]=e[l+1],h[c+2]=e[l+2],c+=g,l+=d}function k(h,e,g,d,f){const c=h.typedBuffer,l=h.typedBufferStride;h=f?.count??h.count;f=(f?.dstIndex??0)*l;for(let w=0;w<h;++w)c[f]=e,c[f+1]=g,c[f+2]=d,f+=l}const p=Object.freeze(Object.defineProperty({__proto__:null,copy:n,copyView:b,fill:k},Symbol.toStringTag,{value:"Module"}));a.copy=n;a.copyView=b;a.fill=k;a.vec3=p})},
"esri/views/3d/webgl-engine/collections/Component/ComponentData":function(){define(["./IndexRange/ComponentRangeRunLengthEncoded"],function(a){function b(k,p,h,e){const g=new Map,d=[];let f=e.length;h.forEachComponent(c=>{if(0<k[c]){var l=p[c];let w=g.get(l);void 0===w&&(w=[],g.set(l,w));l=e[c];c=e[c+1];w.push(l);w.push(c-l)}else f!==c-1&&(d.length&&d.push(e[f+1]-d[d.length-1]),d.push(e[c])),f=c;return!0});d.length&&d.push(e[f+1]-d[d.length-1]);return{highlightRangesMap:g,defaultRanges:d}}class n{constructor(k,
p){this.offsets=p;this.cachedDefaultRanges=this.cachedHighlightRangesMap=this.cachedGeometryRanges=this.verticalOffsets=this.highlightGroups=this.highlightCounts=this.pickability=null;p=this.count;this.visibility=new a.ComponentRangeRunLengthEncoded(p);this.materialDataBuffer=k.getBuffer(p);this.materialDataIndices=new Uint16Array(p);for(k=0;k<p;k++)this.materialDataIndices[k]=this.materialDataBuffer.acquireIndex()}destroy(){for(let k=0;k<this.count;k++)this.materialDataBuffer.releaseIndex(this.materialDataIndices[k])}get count(){return this.offsets.length-
1}get geometryRanges(){null==this.cachedGeometryRanges&&(this.cachedGeometryRanges=this.visibility.computeOffsetRanges(this.offsets));return this.cachedGeometryRanges}get highlightRanges(){if(null==this.highlightCounts)return null;this._updateCachedHighlightRanges();return this.cachedHighlightRangesMap}get defaultShadowMapRanges(){if(null==this.highlightCounts)return this.geometryRanges;this._updateCachedHighlightRanges();return this.cachedDefaultRanges}highlightsDirty(){this.cachedDefaultRanges=
this.cachedHighlightRangesMap=null}visibilityDirty(){this.cachedGeometryRanges=null;this.highlightsDirty()}_updateCachedHighlightRanges(){if((null==this.cachedHighlightRangesMap||null==this.cachedDefaultRanges)&&null!=this.highlightCounts&&null!=this.highlightGroups){const {highlightRangesMap:k,defaultRanges:p}=b(this.highlightCounts,this.highlightGroups,this.visibility,this.offsets);this.cachedHighlightRangesMap=k;this.cachedDefaultRanges=p}}}return n})},"esri/views/3d/webgl-engine/collections/Component/IndexRange/ComponentRangeRunLengthEncoded":function(){define(["exports"],
function(a){class b{constructor(n){this._totalCount=n;this._componentCountCache=-1;this._indexRanges=[0,n]}allVisible(){return this.componentCount===this._totalCount}allInvisible(){return 0===this._indexRanges.length}isVisible(n){if(0>n||n>=this._totalCount)return!1;if(this.allVisible())return!0;const k=this._indexRanges;let p=0,h=k.length/2;if(n<k[2*p]||n>k[2*h]+k[2*h+1])return!1;for(;0<h-p;){const e=Math.floor(.5*(p+h)),g=k[2*e];if(n<g){if(1===h-p)break;h=e}else{if(n<g+k[2*e+1])return!0;if(1===
h-p)break;p=e+1}}return!1}get componentCount(){if(-1===this._componentCountCache){const n=this._indexRanges;let k=0;for(let p=0;p<n.length;p+=2)k+=n[p+1];this._componentCountCache=k}return this._componentCountCache}reset(n){if("all"===n||n.length===this._totalCount)this._indexRanges=[0,this._totalCount];else{{const h=[];if(0!==n.length){var k=n[0],p=1;for(let e=1;e<n.length;e++){const g=n[e];k+p===g?p+=1:(h.push(k),h.push(p),k=g,p=1)}h.push(k);h.push(p)}n=h}this._indexRanges=n}this._componentCountCache=
-1}forEachComponent(n){const k=this._indexRanges;for(let h=0;h<k.length;h+=2){var p=k[h];const e=p+k[h+1];for(;p<e;p++)if(!n(p))return!1}return!0}forEachComponentRange(n){const k=this._indexRanges;for(let p=0;p<k.length;p+=2){const h=k[p];if(!n(h,h+k[p+1]))return!1}return!0}computeOffsetRanges(n){const k=Array(this._indexRanges.length),p=this._indexRanges;for(let e=0;e<p.length;e+=2){var h=p[e];const g=n[h];h=n[h+p[e+1]];k[e]=g;k[e+1]=h-g}return k}}a.ComponentRangeRunLengthEncoded=b;Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/collections/Component/ComponentObject":function(){define(["exports","../../../../../core/maybe"],function(a,b){class n{constructor(k,p,h,e,g,d){this.transform=k;this.toMapSpace=p;this.obb=h;this.components=e;this.renderable=g;this.intersectionGeometry=d;this.visible=!1;this.offsetObb=null}destroy(){this.intersectionGeometry=b.destroyMaybe(this.intersectionGeometry);this.renderable=b.destroyMaybe(this.renderable);this.components=b.destroyMaybe(this.components)}}
a.ComponentObject=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/collections/Component/IntersectionGeometry":function(){define("exports ../../../../../core/libs/gl-matrix-2/math/mat3 ../../../../../core/libs/gl-matrix-2/factories/mat3f64 ../../../../../chunks/vec32 ../../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../../geometry/support/FloatArray ../../../../../geometry/support/Indices ../../../../ViewingMode ./ComponentObjectElevationAgnosticComponentBVH".split(" "),
function(a,b,n,k,p,h,e,g,d){class f{constructor(t,m,q){this.viewingMode=t;this.positionData=m;this._components=q;this.componentVerticalOffsets=this.verticalOffset=null;this._planetCenter=p.create();this._componentBvh=null;this._aabb=[0,0,0,0,0,0];this._indices=m.indices?e.compactIndices(m.indices):e.getContinuousIndexArray(m.positions.length/3);this._positions=m.positions}destroy(){this._componentBvh=this._perComponentAabbs=this._indices=this._positions=null}getComponentAabb(t,m){const q=this._ensureComponentAabbs();
t*=6;m[0]=q[t];m[1]=q[t+1];m[2]=q[t+2];m[3]=q[t+3];m[4]=q[t+4];m[5]=q[t+5];return m}getComponentAabbs(){return this._ensureComponentAabbs()}_ensureComponentAabbs(){this._perComponentAabbs||(this._perComponentAabbs=this._computePerComponentAabbs());return this._perComponentAabbs}getComponentPositions(t,m){m.indices=this._indices;m.data=this._positions;m.stride=3;m.startIndex=this._components.offsets[t];m.endIndex=this._components.offsets[t+1]}intersect(t,m,q,r,v,y,B,z){this.verticalOffset=r;this.componentVerticalOffsets=
v;const {position:A}=y;t=k.sub(c,t,A);m=k.sub(l,m,A);y=b.invert(w,y.rotationScale);k.transformMat3(t,t,y);k.transformMat3(m,m,y);const C=b.transpose(u,y);if(this.viewingMode===g.ViewingMode.Global){const H=this._planetCenter;k.negate(H,A);k.transformMat3(H,H,y)}this._intersectComponents(t,m,v,r,(H,E,F,G)=>{z(F,H,G?k.transformMat3(x,G,C):null,E)},q,B)}_computePerComponentAabbs(){var t=this._aabb;const m=.5*(t[0]+t[3]),q=.5*(t[1]+t[4]);t=.5*(t[2]+t[5]);const r=this._components.count,v=h.newFloatArray(6*
r),y=this._indices,B=this._positions,z=this._components.offsets;let A=0,C=Infinity,H=Infinity,E=Infinity,F=-Infinity,G=-Infinity,D=-Infinity;for(let N=0;N<r;N++){var I=z[N];const M=z[N+1];let Q=Infinity,O=Infinity,K=Infinity,L=-Infinity,P=-Infinity,R=-Infinity;if(I<M)for(;I<M;I++){var J=3*y[I];const W=B[J],V=B[J+1];J=B[J+2];Q=Math.min(Q,W);O=Math.min(O,V);K=Math.min(K,J);L=Math.max(L,W);P=Math.max(P,V);R=Math.max(R,J)}else Q=m,O=q,K=t,L=m,P=q,R=t;v[A++]=Q;v[A++]=O;v[A++]=K;v[A++]=L;v[A++]=P;v[A++]=
R;C=Math.min(C,Q);H=Math.min(H,O);E=Math.min(E,K);F=Math.max(F,L);G=Math.max(G,P);D=Math.max(D,R)}this._aabb[0]=C;this._aabb[1]=H;this._aabb[2]=E;this._aabb[3]=F;this._aabb[4]=G;this._aabb[5]=D;return v}_intersectComponents(t,m,q,r,v,y,B){let z=this._componentBvh;null==z&&(this._componentBvh=z=new d.ComponentObjectElevationAgnosticComponentBVH(this._positions,3,this._indices,this._components,this._ensureComponentAabbs(),this.geometryMinZ,this.planetCenterZ,this.localMode));z.intersectRay(t,m,q,r,
v,y,B)}get geometryMinZ(){return this._aabb[2]}get planetCenterZ(){return this._planetCenter[2]}get numTriangles(){return this._indices.length/3}get localMode(){return this.viewingMode===g.ViewingMode.Local}get positions(){return this._positions}get indices(){return this._indices}get aabb(){this._ensureComponentAabbs();return this._aabb}}const c=p.create(),l=p.create(),w=n.create(),x=p.create(),u=n.create();a.IntersectionGeometry=f;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/collections/Component/ComponentObjectElevationAgnosticComponentBVH":function(){define("exports ../../../../../chunks/vec32 ../../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../../geometry/support/aaBoundingBox ./ComponentObjectElevationAgnosticComponentGeometryBVH ./ElevationAgnosticBVH ../../lib/ComponentUtils ../../lib/RayIntersections".split(" "),
function(a,b,n,k,p,h,e,g){class d{constructor(m,q,r,v,y,B,z,A){this.vertexData=m;this.vertexStride=q;this.indexData=r;this._components=v;this._componentAabbs3D=y;this.geometryMinZ=B;this.planetCenterZ=z;this.localMode=A;this.maxBspNodeDepth=6;this.minElementCountForBVH=10;this.minBspNodeElementCount=3;this._ray0=w;this._ray1=x;this._invDir=n.create();this._verticalOffset=this._componentVerticalOffsets=null;this._tolerance=0;this._intersectionOptions=t;this._callback=u;this.rayDirectionC=n.create();
this._componentIndexMap=null;this._bvh=new h.ElevationAgnosticBVH(v.count,this);this.componentIntersectionData=Array(v.count)}get numComponents(){return this._components.count}get minZGlobal(){return this.geometryMinZ-this.planetCenterZ}getAabbs2D(){return this.localMode?this.getAabbs2DLocal():this.getAabbs2DGlobal()}getAabbs2DGlobal(){const {numComponents:m,planetCenterZ:q,minZGlobal:r}=this,v=new Float64Array(4*m),y=this._componentAabbs3D;for(let H=0;H<m;++H){var B=6*H;const E=y[B+0];var z=y[B+
1],A=y[B+3],C=y[B+4];const F=r/(y[B+2]-q);B=r/(y[B+5]-q);z=Math.min(z*F,z*B);A=Math.max(A*F,A*B);C=Math.max(C*F,C*B);const G=4*H;v[G+0]=Math.min(E*F,E*B);v[G+1]=z;v[G+2]=A;v[G+3]=C}return v}getAabbs2DLocal(){const {numComponents:m}=this,q=new Float64Array(4*m),r=this._componentAabbs3D;for(let v=0;v<m;++v){const y=6*v,B=r[y+1],z=r[y+3],A=r[y+4],C=4*v;q[C+0]=r[y+0];q[C+1]=B;q[C+2]=z;q[C+3]=A}return q}intersectRay(m,q,r,v,y,B,z){const {isVerticalRay:A}=z;this._ray0=m;this._ray1=q;this._componentVerticalOffsets=
r;this._verticalOffset=v;this._tolerance=B;this._intersectionOptions=z;this._componentIndexMap=this._bvh.elementIndexMap;g.computeInvDir(m,q,this._invDir);this._callback=y;this._bvh.intersectRay(m,q,A);this._callback=u}intersectRange(m,q){const r=this._componentIndexMap;var v=this._components;const y=v.pickability;for(v=v.visibility;m<q;++m){const B=r?r[m]:m;e.getVisibility(y,B)&&v.isVisible(B)&&this._intersectComponent(B)}}getComponentTriangleCount(m){const q=this._components.offsets;return q[m+
1]/3-q[m]/3}getComponentAabb3D(m,q){const r=this._componentAabbs3D;m*=6;q[0]=r[m];q[1]=r[m+1];q[2]=r[m+2];q[3]=r[m+3];q[4]=r[m+4];q[5]=r[m+5];return q}_intersectComponent(m){if(e.getVisibility(this._components.pickability,m)){var q=this.getComponentAabb3D(m,f),r=!1,{localMode:v,_componentVerticalOffsets:y,_verticalOffset:B,_ray0:z,_ray1:A,_invDir:C,planetCenterZ:H,_tolerance:E,rayDirectionC:F,componentIntersectionData:G}=this,{isVerticalRay:D}=this._intersectionOptions,I=this._components.offsets,
J=b.copy(c,z),N=b.copy(l,A),M=y?.[m]??0,Q=M+(B?.offset??0);0!==Q&&(v?(J[2]=z[2]-Q,N[2]=A[2]-Q,r=!0):null!=B&&(B.componentOffset=M));null==B||r||0===Q||B.applyToAabb(q);if(g.intersectAabbInvDir(q,J,C,E)){b.sub(F,N,J);q=I[m]/3;I=I[m+1]/3;M=(W,V,ba)=>{this._callback(W,V,m,ba)};var {vertexData:O,vertexStride:K,indexData:L,_intersectionOptions:P}=this,{normalRequired:R}=P;if(40<I-q){let W=G[m];null==W&&(W=new p.ComponentObjectElevationAgnosticComponentGeometryBVH(m,O,K,L,q,I,this.geometryMinZ,H,v),G[m]=
W);W.intersectRay(J,N,D,r?0:Q,M,R)}else p.intersectTriangleRangeForComponent(J,F,q,I,L,O,K,r?0:Q,H,R,M)}}}}const f=k.create(),c=n.create(),l=n.create(),w=n.create(),x=n.create(),u=()=>{},t=new g.MeshIntersectionOptions;a.ComponentObjectElevationAgnosticComponentBVH=d;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/collections/Component/ComponentObjectElevationAgnosticComponentGeometryBVH":function(){define("exports ../../../../../chunks/vec32 ../../../../../core/libs/gl-matrix-2/factories/vec3f64 ./ElevationAgnosticBVH ../../lib/RayIntersections ../../lib/triangleIntersectionUtils".split(" "),
function(a,b,n,k,p,h){function e(f,c,l,w,x,u,t,m,q,r,v,y=null,B=0){0!==m?p.intersectRayTrianglesWithVerticalOffsetENUGlobal(f,c,l,w,x,u,t,m,q,r,v,y,B):p.intersectRayTriangles(f,c,l,w,x,u,t,r,v,y,B)}function g(){}class d{constructor(f,c,l,w,x,u,t,m,q){this.componentIndex=f;this.vertexData=c;this.vertexStride=l;this.indexData=w;this.startTriangleNumber=x;this.endTriangleNumber=u;this.geometryMinZ=t;this.planetCenterZ=m;this.localMode=q;this.maxBspNodeDepth=8;this.minElementCountForBVH=20;this.minBspNodeElementCount=
10;this.rayDirection=n.create();this.ray0=n.create();this.isVerticalRay=!1;this._triangleHitCallback=g;this.totalElevationOffset=0;this.normalRequired=!1;this._bvh=new k.ElevationAgnosticBVH(u-x,this)}getAabbs2D(){return this.localMode?h.generateTriangleAabbsLocal(this.startTriangleNumber,this.endTriangleNumber,this.indexData,this.vertexData,this.vertexStride):h.generateTriangleAabbsGlobal(this.startTriangleNumber,this.endTriangleNumber,this.indexData,this.vertexData,this.vertexStride,this.geometryMinZ,
this.planetCenterZ)}get numTriangles(){return this.endTriangleNumber-this.startTriangleNumber}intersectRay(f,c,l,w,x,u){b.copy(this.ray0,f);b.sub(this.rayDirection,c,f);this.isVerticalRay=l;this.totalElevationOffset=w;this.normalRequired=u;this._triangleHitCallback=x;this._bvh.intersectRay(f,c,l);this._triangleHitCallback=g}intersectRange(f,c){e(this.ray0,this.rayDirection,f,c,this.indexData,this.vertexData,this.vertexStride,this.totalElevationOffset,this.planetCenterZ,this.normalRequired,this._triangleHitCallback,
this._bvh.elementIndexMap,this.startTriangleNumber)}getTriangleElevationOffset(f){return this.totalElevationOffset}}a.ComponentObjectElevationAgnosticComponentGeometryBVH=d;a.intersectTriangleRangeForComponent=e;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/collections/Component/ElevationAgnosticBVH":function(){define(["exports","../../../../../core/mathUtils","../../../../../core/libs/gl-matrix-2/factories/vec3f64","../../lib/triangleIntersectionUtils"],
function(a,b,n,k){function p(g,d,f,c){g*=4;const l=c[g+0+d];return c[g+2+d]<f?-1:l>f?1:0}class h{constructor(g,d){this.elementCount=g;this.model=d;this._elementIndexMap=null;this._bspNodes=[];this._generatedBVH=!1;this.localMode=d.localMode;this.planetCenterZ=d.planetCenterZ;this.geometryMinZ=d.geometryMinZ;this.planetCenter=n.fromValues(0,0,this.planetCenterZ);this.maxBspNodeDepth=d.maxBspNodeDepth??8;this.minElementCountForBVH=d.minElementCountForBVH??15;this.minBspNodeElementCount=d.minBspNodeElementCount??
5}get elementIndexMap(){this._ensureBVH();return this._elementIndexMap}get _skipBVH(){return this.elementCount<this.minElementCountForBVH||this.geometryMinZ<.5*this.planetCenterZ}_ensureBVH(){this._generatedBVH||this._skipBVH||0===this._bspNodes.length&&this._generateBsp()}intersectRay(g,d,f){1>this.elementCount||(this._skipBVH?this._intersectRayWithoutBVH(f):this._intersectRayWithBVH(g,d,f))}_intersectRayWithoutBVH(g){this._intersectRange(0,this.elementCount)}_intersectRange(g,d){this.model.intersectRange(g,
d)}_intersectRayWithBVH(g,d,f){this._ensureBVH();f?this._intersectGeometryWithBVHVerticalRay(g):this._intersectGeometryWithBVHGeneralRay(g,d)}_intersectGeometryWithBVHVerticalRay(g){let d=g[0];var f=g[1];if(!this.localMode){const {geometryMinZ:l,planetCenterZ:w}=this;f=(l-w)/(g[2]-w);d=g[0]*f;f*=g[1]}({_bspNodes:g}=this);for(var c=0;0<=c;){c=g[c];const {d:l,dim:w,minIndexIndex:x,minMidIndexIndex:u,maxMidIndexIndex:t,maxIndexIndex:m,aabb2D:q}=c;if(d<q[0]||d>q[2]||f<q[1]||f>q[3])break;if(-1===w||-1===
c.child0&&-1===c.child1){this._intersectRange(x,m);break}else{this._intersectRange(u,t);const r=(0===w?d:f)-l;if(0>r){if(-1===c.child0){this._intersectRange(x,u);break}c=c.child0}else if(0<r){if(-1===c.child1){this._intersectRange(t,m);break}c=c.child1}else break}}}_intersectGeometryWithBVHGeneralRay(g,d){var f=g[0],c=g[1],l=d[0],w=d[1],{geometryMinZ:x}=this;if(!this.localMode){w=0;var u=1;f=Math.min(.5*this.planetCenterZ,x);c=g[2];l=d[2];if(c<f&&l<f)return;c<f&&(w=(f-c)/(l-c));l<f&&(u=(f-c)/(l-c));
if(w>u)return;f=(1-w)*g[0]+w*d[0];c=(1-w)*g[1]+w*d[1];var t=(1-w)*g[2]+w*d[2];l=(1-u)*g[0]+u*d[0];w=(1-u)*g[1]+u*d[1];g=(1-u)*g[2]+u*d[2];({planetCenterZ:d}=this);x-=d;u=x/(t-d);f*=u;c*=u;x/=g-d;l*=x;w*=x}x=l-f;g=w-c;d=this._bspNodes;let m=1;({aabb2D:w}=d[0]);l=(B,z,A,C)=>{if(Math.abs(z)<1E-5*Math.max(C-A,1))return!1;const H=0<z;A=H?C:A;C=B+m*z;return(H?C<A:C>A)?(m=Math.max((A-B)/z,m),!0):!1};Math.abs(x)>=Math.abs(g)?l(f,x,w[0],w[2])||l(c,g,w[1],w[3]):l(c,g,w[1],w[3])||l(f,x,w[0],w[2]);w=[0,0,m];
for(l=0;l<w.length;){var q=w[l];u=w[l+1];t=w[l+2];l+=3;if(u>t)continue;q=d[q];const {minIndexIndex:B,maxIndexIndex:z}=q,{child0:A,child1:C,minMidIndexIndex:H,maxMidIndexIndex:E,aabb2D:F,d:G,dim:D}=q;var r=f+u*x,v=f+t*x;q=Math.min(r,v);r=Math.max(r,v);var y=F[0];v=F[2];if(!(r<y||v<q||(q<y&&(q=(y-f)/x,0<x?u=Math.max(u,q):t=Math.min(t,q)),v<r&&(q=(v-f)/x,0<x?t=Math.min(t,q):u=Math.max(u,q)),r=c+u*g,v=c+t*g,q=Math.min(r,v),r=Math.max(r,v),y=F[1],v=F[3],r<y||v<q)))if(q<y&&(q=(y-c)/g,0<g?u=Math.max(u,q):
t=Math.min(t,q)),v<r&&(q=(v-c)/g,0<g?t=Math.min(t,q):u=Math.max(u,q)),-1===A&&-1===C)this._intersectRange(B,z);else{v=0===D?f:c;q=0===D?x:g;y=v+u*q;const I=v+t*q;r=Math.min(y,I);y=Math.max(y,I);v=b.clamp((G-v)/q,0,m);B<H&&r<=G&&(-1!==A?(w.push(A),w.push(0<=q?u:Math.max(u,v)),w.push(0<=q?Math.min(t,v):t)):this._intersectRange(B,H));this._intersectRange(H,E);E<z&&G<=y&&(-1!==C?(w.push(C),w.push(0<=q?Math.max(u,v):u),w.push(0<=q?t:Math.min(t,v))):this._intersectRange(E,z))}}}_generateBsp(){var {elementCount:g}=
this;if(!(1>g)){var d=k.createUintArray(g,g);this._elementIndexMap=d;for(var f=0;f<g;++f)d[f]=f;var c=this.model.getAabbs2D();f=0;var l=this._bspNodes;l.length=0;var {localMode:w}=this,x=!1;if(!w){const {planetCenterZ:v,geometryMinZ:y}=this;x=0<=v||y<.5*v}var u=[],t=(v,y,B,z,A)=>{u.push(v);u.push(y);u.push(B);u.push(0>z?-1:(A?0:1)+2*z)},{maxBspNodeDepth:m,minBspNodeElementCount:q}=this,r=(v,y,B,z,A)=>{const C=l.length;if(!(0<C&&(x||B>=m||y-v<q))){var H=[0,0,0,0],E=Infinity,F=Infinity,G=-Infinity,
D=-Infinity;for(var I=v;I<y;++I){const O=4*d[I];E=Math.min(E,c[O+0]);F=Math.min(F,c[O+1]);G=Math.max(G,c[O+2]);D=Math.max(D,c[O+3])}H[0]=E;H[1]=F;H[2]=G;H[3]=D;w?(E=H[0],F=H[1],G=H[2],D=H[3],G-E>=D-F?(F=.5*(E+G),E=0):(F=.5*(F+D),E=1),E={d:F,dim:E}):(F=H[0],G=H[1],D=H[2],I=H[3],D-F>=I-G?(E=0,F=.5*(F+D)):(E=1,F=.5*(G+I)),E={dim:E,d:F});var {d:J,dim:N}=E;F=v;for(E=y;F<E;)G=d[F],0>p(G,N,J,c)?++F:(--E,d[F]=d[E],d[E]=G);E=F;for(G=y;F<G;)D=d[G-1],0<p(D,N,J,c)?--G:(d[G-1]=d[F],d[F]=D,++F);var {rangeMidStart:M,
rangeMidEnd:Q}={rangeMidStart:E,rangeMidEnd:G};F=B===m-1;E=!F&&M>=v+q;F=!F&&y>=Q+q;if(E||F||0===C)H=new e(v,M,Q,y,N,J,H),E&&t(v,M,B+1,C,!0),F&&t(Q,y,B+1,C,!1),l.push(H),-1!==z&&(v=l[z],A?v.child0=C:v.child1=C)}};for(t(0,g,0,-1,!1);f<u.length;){g=u[f];const v=u[f+1],y=u[f+2],B=u[f+3];f+=4;const z=B>>1;r(g,v,y,z,0===B-(z<<1))}this._generatedBVH=!0}}}class e{constructor(g,d,f,c,l,w,x){this.minIndexIndex=g;this.minMidIndexIndex=d;this.maxMidIndexIndex=f;this.maxIndexIndex=c;this.dim=l;this.d=w;this.aabb2D=
x;this.child1=this.child0=-1}}a.ElevationAgnosticBVH=h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/triangleIntersectionUtils":function(){define(["exports","../../../../chunks/vec32","../../../../core/libs/gl-matrix-2/factories/vec3f64"],function(a,b,n){function k(x,u,t){x=b.dot(x,u)-t;return 1E-5>=Math.abs(x)}function p(x,u,t){const m=n.create(),q=n.create();b.sub(q,u,x);u=n.create();b.sub(u,t,x);b.cross(m,q,u);b.normalize(m,m);return m}function h(x,
u,t,m){const q=[u,t,m];u=p(u,t,m);t=b.dot(q[0],u);if(!k(x,u,t))return!1;for(x=0;3>x;++x){u=q[x];var r=q[(x+1)%3];t=q[(x+2)%3];m=n.create();b.sub(m,r,u);b.normalize(m,m);r=n.create();b.sub(r,t,u);const v=b.dot(r,m);r=n.create();b.scaleAndAdd(r,u,m,v);m=n.create();b.sub(m,t,r);b.normalize(m,m);u=b.dot(u,m);if(!(-1E-4<=b.dot(m,r)-u))return!1}return!0}function e(x){const u=n.create();b.sub(u,x[1],x[0]);b.normalize(u,u);const t=n.create();b.sub(t,x[2],x[0]);b.normalize(t,t);x=n.create();b.cross(x,u,t);
b.normalize(x,x);return x}function g(x,u,t){const m=n.create();b.sub(m,t,u);b.normalize(m,m);t=n.create();b.sub(t,x,u);x=b.dot(t,m);t=n.create();b.scaleAndAdd(t,u,m,x);return t}function d(x,u,t){const m=n.create();b.sub(m,t,u);const q=b.len(m);b.normalize(m,m);var r=n.create();b.sub(r,x,u);r=b.dot(r,m);if(0>r)return b.dist(u,x);if(r>q)return b.dist(t,x);t=n.create();b.scaleAndAdd(t,u,m,r);return b.dist(t,x)}function f(x,u,t){return b.dot(x,u)-t}function c(x,u,t){const m=n.create(),q=n.create();b.sub(q,
u,x);u=n.create();b.sub(u,t,x);b.cross(m,q,u);b.normalize(m,m);x=b.dot(m,x);return{normal:m,d:x}}function l(x,u,t,m){const {normal:q,d:r}=c(u,t,m),v=f(x,q,r),y=n.create();b.scaleAndAdd(y,x,q,-v);return h(y,u,t,m)?v:Math.min(d(x,u,t),d(x,t,m),d(x,m,u))}function w(x){return 128>x?Uint8Array:32768>x?Uint16Array:-2147483648>x?Uint32Array:Array}a.binarySearchSortedArray=function(x,u){var t=x.length;if(0===t)return 0;if(u<x[0])return-1;if(u>=x[t-1])return t;let m=0;for(--t;1<t-m;){const q=Math.floor(.5*
(t+m));u>=x[q]?m=q:t=q}return m};a.calculateNormalFromVertices=e;a.createUintArray=function(x,u){return new (w(x))(u)};a.distancePointLine=function(x,u,t){u=g(x,u,t);return b.dist(u,x)};a.distancePointPlane=f;a.distancePointSegment=d;a.distancePointTriangle=l;a.elevationAlignVertexGlobal=function(x,u,t,m){const [q,r,v]=m??x;t=v-t;u/=Math.sqrt(q*q+r*r+t*t);x[0]+=q*u;x[1]+=r*u;x[2]+=t*u};a.elevationAlignVertexLocal=function(x,u){x[2]+=u};a.generateTriangleAabbsGlobal=function(x,u,t,m,q,r,v){r-=v;u-=
x;const y=new Float64Array(4*u);for(let F=0;F<u;++F){var B=3*(F+x),z=q*t[B+0],A=r/(m[z+2]-v);const G=m[z+0]*A;z=m[z+1]*A;var C=q*t[B+1],H=r/(m[C+2]-v);A=m[C+0]*H;C=m[C+1]*H;H=q*t[B+2];var E=r/(m[H+2]-v);B=m[H+0]*E;H=m[H+1]*E;E=4*F;y[E+0]=Math.min(G,A,B);y[E+1]=Math.min(z,C,H);y[E+2]=Math.max(G,A,B);y[E+3]=Math.max(z,C,H)}return y};a.generateTriangleAabbsLocal=function(x,u,t,m,q){u-=x;const r=new Float64Array(4*u);for(let A=0;A<u;++A){var v=3*(A+x),y=q*t[v+0];const C=m[y+0];y=m[y+1];var B=q*t[v+1];
const H=m[B+0];B=m[B+1];var z=q*t[v+2];v=m[z+0];z=m[z+1];const E=4*A;r[E+0]=Math.min(C,H,v);r[E+1]=Math.min(y,B,z);r[E+2]=Math.max(C,H,v);r[E+3]=Math.max(y,B,z)}return r};a.getConstructorForValueCount=w;a.getNearestPointOnLine=g;a.getRayTriangleIntersectionDistance=function(x,u,t){const m=n.create();b.sub(m,u,x);var q=e(t);const r=b.dot(q,t[0]),v=b.dot(q,x)-r;u=b.dot(q,u)-r;if(0<v*u)return Infinity;q=n.create();b.scaleAndAdd(q,x,m,(0-v)/(u-v));return h(q,t[0],t[1],t[2])?0:l(q,t[0],t[1],t[2])};a.getTriangleNormal=
p;a.getTrianglePlane=c;a.isPointInPlane=k;a.isPointInTriangle=h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/ComponentUtils":function(){define(["exports","../../../../core/arrayUtils"],function(a,b){function n(k=!0){return{isVisibleBit:!k,data:new Uint32Array(0)}}a.defaultVisibilities=n;a.getVisibility=function(k,p){if(null==k)return!0;const {isVisibleBit:h,data:e}=k,g=8*e.BYTES_PER_ELEMENT;return p<e.length*g?(k=p/g|0,0!==(e[k]&1<<p-k*g)===h):!k.isVisibleBit};
a.updateVisibilityWithCount=function(k,p,h,e){if(h>=p)return k;null==k&&(k=n());let g=k.data;const d=8*g.BYTES_PER_ELEMENT,f=h/d|0,c=h-d*f,l=g;e=e===k.isVisibleBit;h<l.length*d||!e||(h=Math.max(f+1,Math.ceil(l.length*b.reallocGrowthFactor)),h=Math.min(h,((p-1)/d|0)+1),g=new Uint32Array(h),g.set(l));f<g.length&&(g[f]=g[f]&~(1<<c)|(e?1:0)<<c);k.data=g;return k};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/collections/Component/Renderable":function(){define(["exports"],
function(a){class b{constructor(n,k,p){this.material=n;this.geometry=k;this.meta=p}destroy(){this.material.dispose();this.geometry.dispose()}}a.Renderable=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/collections/Component/RenderGeometry":function(){define(["exports"],function(a){class b{constructor(n,k,p,h){this.vao=n;this.primitiveType=k;this.parameters=p;this.indexed=h}dispose(){this.vao.dispose()}}a.RenderGeometry=b;Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/views/3d/webgl-engine/collections/Component/RenderSubmitSystem":function(){define(["exports","./DepthRange"],function(a,b){class n{constructor(k){this._objects=k}submit(k,p){this._objects.preSubmit(p);this._objects.visibleObjects.forAll(h=>h.renderable.material.submit(k,p,h))}queryShadowCasterDepthRange(k){return this._objects.visibleObjects.length?b.computeDepthRange(k,this._objects.visibleObjects):null}get hasEmissions(){return this._objects.visibleObjects.some(k=>k.renderable.material.hasEmissions)}}
a.RenderSubmitSystem=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/collections/Component/DepthRange":function(){define("exports ../../../../../core/PooledArray ../../../../../core/libs/gl-matrix-2/math/mat3 ../../../../../core/libs/gl-matrix-2/factories/mat3f64 ../../../../../core/libs/gl-matrix-2/math/quat ../../../../../core/libs/gl-matrix-2/factories/quatf64 ../../../../../chunks/vec32 ../../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../../geometry/support/plane ../../lib/depthRange".split(" "),
function(a,b,n,k,p,h,e,g,d,f){function c(F,G,D){return e.set(F,G.data[D],G.data[D+1],G.data[D+2])}function l(F,G){F.push(G[0]);F.push(G[1]);F.push(G[2])}function w(F,G,D,I){p.conjugate(B,F.quaternion);e.sub(z,G,F.center);e.transformQuat(z,z,B);G=F.halfSize;const J=8*((z[0]<-G[0]?-1:z[0]>G[0]?1:0)+3*(z[1]<-G[1]?-1:z[1]>G[1]?1:0)+9*(z[2]<-G[2]?-1:z[2]>G[2]?1:0)+13);G=v[J];if(0===G)return G;n.fromQuat(y,F.quaternion);n.scale(y,y,F.halfSize);const N=(M,Q)=>{Q=v[J+Q+1];e.set(M,((Q&1)<<1)-1,(Q&2)-1,((Q&
4)>>1)-1);e.transformMat3(M,M,y);return e.add(M,F.center,M)};D.length=0;l(D,N(A,0));l(D,N(C,1));l(D,N(z,2));l(D,N(H,3));I(D);if(1===G)return G;D.length=0;l(D,A);l(D,H);l(D,N(z,4));l(D,N(E,5));I(D);if(2===G)return G;D.length=0;l(D,A);l(D,E);l(D,N(z,6));l(D,C);I(D);return G}const x=new b({allocator:F=>F||{near:Infinity,far:-Infinity,mask:0,object:null},deallocator:F=>{F.object=null;return F}}),u=f.empty(),t=g.create(),m=g.create(),q=new b({deallocator:null}),r=new b({deallocator:null}),v=(()=>{const F=
Array(216);let G=0;const D=I=>{for(let J=0;J<I.length;J++)F[G+J]=I[J];G+=8};D([3,0,6,2,3,1,5,4]);D([2,0,2,3,1,5,4,0]);D([3,1,0,2,3,7,5,4]);D([2,0,1,3,2,6,4,0]);D([1,0,1,3,2,0,0,0]);D([2,1,5,7,3,2,0,0]);D([3,2,0,1,3,7,6,4]);D([2,2,0,1,3,7,6,0]);D([3,3,0,1,5,7,6,2]);D([2,0,1,5,4,6,2,0]);D([1,0,1,5,4,0,0,0]);D([2,1,3,7,5,4,0,0]);D([1,0,2,6,4,0,0,0]);D([0,0,0,0,0,0,0,0]);D([1,1,3,7,5,0,0,0]);D([2,2,3,7,6,4,0,0]);D([1,2,3,7,6,0,0,0]);D([2,3,1,5,7,6,2,0]);D([3,4,0,1,5,7,6,2]);D([2,5,7,6,4,0,1,0]);D([3,
5,0,1,3,7,6,4]);D([2,4,5,7,6,2,0,0]);D([1,4,5,7,6,0,0,0]);D([2,5,1,3,7,6,4,0]);D([3,6,0,2,3,7,5,4]);D([2,6,2,3,7,5,4,0]);D([3,7,6,2,3,1,5,4]);return F})(),y=k.create(),B=h.create(),z=g.create(),A=g.create(),C=g.create(),H=g.create(),E=g.create();a.computeDepthRange=function(F,G){const D=f.empty(),{eye:I,frustum:J,viewForward:N}=F;G.forAll(M=>{var Q=null!=M.offsetObb?M.offsetObb:M.obb;const O=e.dot(e.sub(z,Q.center,I),N),K=Q.projectedRadius(N);if(!f.within(D,O-K)||!f.within(D,O+K)){a:{var L=0;for(let P=
0;4>P;P++){const R=Q.intersectPlane(J[P]);if(0<R){Q=-1;break a}0===R&&(L|=1<<P)}Q=L}-1!==Q&&(0===Q?(u.far=O+K,u.near=O-K,f.union(D,u)):(L=x.pushNew(),L.near=O-K,L.far=O+K,L.mask=Q,L.object=M))}});for(F=0;F<x.length;F++){const M=x.data[F];f.within(D,M.near)&&f.within(D,M.far)||(u.far=M.far,u.near=Infinity,0===w(null!=M.object.offsetObb?M.object.offsetObb:M.object.obb,I,q,Q=>{var O=r;for(var K=0;4>K&&0<Q.length;K++){if(0===(M.mask&1<<K))continue;var L=J[K],P=Q,R=O;R.length=0;const W=P.length-3;c(t,
P,W);const V=d.signedDistance(L,t);0>=V&&(R.push(t[0]),R.push(t[1]),R.push(t[2]));let ba=0,U=V;for(ba;ba<W;ba+=3){c(m,P,ba);const da=d.signedDistance(L,m);0>U*da&&(e.lerp(t,m,t,da/(da-U)),l(R,t));0>=da&&l(R,m);U=da;e.copy(t,m)}0>U*V&&(c(m,P,W),e.lerp(t,m,t,V/(V-U)),l(R,t));L=Q;Q=O;O=L}for(O=0;O<Q.length;O+=3)e.set(t,Q.data[O],Q.data[O+1],Q.data[O+2]),K=e.dot(e.sub(t,t,I),N),u.near=Math.min(u.near,K)})&&(u.near=0),f.union(D,u))}x.length=0;return D};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/webgl-engine/lib/depthRange":function(){define(["exports"],function(a){function b(p,h){return{near:p,far:h}}function n(p,h,e){p.near=h;p.far=e;return p}class k{constructor(){this.near=Number.MAX_VALUE;this.far=-Number.MAX_VALUE}}a.DepthRange=k;a.create=b;a.empty=function(p){return p?n(p,Infinity,-Infinity):b(Infinity,-Infinity)};a.set=n;a.union=function(p,h){null!=h&&(p.near=Math.min(p.near,h.near),p.far=Math.max(p.far,h.far))};a.within=function(p,h){return p.near<=h&&h<=p.far};a.zero=
{near:0,far:0};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/collections/Component/SourceGeometry":function(){define(["exports","../../../support/buffer/InterleavedLayout","../../core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl","../../core/shaderModules/interfaces","../../lib/VertexAttribute"],function(a,b,n,k,p){class h extends k.NoParameters{constructor(e,g,d,f,c){super();this.colors=e;this.textureCoordinates=g;this.hasNormals=d;this.shadeNormals=
f;this.applySSAO=c}}a.GeometryParameters=h;a.createVertexBufferLayout=function(e){const g=b.newLayout().vec3f(p.VertexAttribute.POSITION);e.hasNormals&&g.vec2i16(p.VertexAttribute.NORMALCOMPRESSED,{glNormalized:!0});e.textureCoordinates===n.TextureCoordinateType.Default?g.vec2f(p.VertexAttribute.UV0):e.textureCoordinates===n.TextureCoordinateType.Atlas&&(g.vec2f(p.VertexAttribute.UV0),g.vec4u16(p.VertexAttribute.UVREGION,{glNormalized:!0}));e.colors&&g.vec4u8(p.VertexAttribute.COLOR,{glNormalized:!0});
return g};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/collections/Component/UniformComponentParameters":function(){define(["exports","../../../../../core/libs/gl-matrix-2/factories/vec4f64","../../../layers/support/symbolColorUtils"],function(a,b,n){class k{constructor(){this.externalColor=b.create();this.externalColorMixMode=n.ColorMixModeEnum.Multiply;this.pickable=this.castShadows=!0;this.elevationOffset=0}}a.UniformComponentParameters=k;Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/collections/Component/Material/ComponentMaterial":function(){define("exports ../../../../../../chunks/tslib.es6 ../../../../../../core/libs/gl-matrix-2/math/mat3 ../../../../../../core/libs/gl-matrix-2/factories/mat3f64 ../../../../../../chunks/vec32 ../../../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../../../chunks/vec42 ../../../../../../core/libs/gl-matrix-2/factories/vec4f64 ../../../../layers/support/symbolColorUtils ../../../../terrain/OverlayContent ./ComponentTechnique ./ComponentTechniqueConfiguration ./shader/ComponentData.glsl ./shader/VertexDiscardByOpacity.glsl ../../../core/material/MaterialBase ../../../core/renderPasses/AllRenderPasses ../../../core/shaderLibrary/ShaderOutput ../../../core/shaderLibrary/attributes/NormalAttribute.glsl ../../../core/shaderLibrary/output/Emissions.glsl ../../../core/shaderLibrary/shading/Normals.glsl ../../../core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../../../core/shaderLibrary/util/AlphaCutoff ../../../core/shaderLibrary/util/EllipsoidMode ../../../core/util/TwoVectorPosition ../../../lib/basicInterfaces ../../../lib/OITPass ../../../materials/pbrUtils".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w,x,u,t,m,q,r,v,y,B,z,A,C,H,E){class F extends u.MaterialBase{constructor(N,M){super();this.toMapSpace=M;this.baseColor=g.freeze(1,1,1,1);this.hasParametersFromSource=this.usePBR=!1;this.mrrFactors=E.advancedMRRFactors;this.emissiveFactor=h.freeze(0,0,0);this.normalTexture=this.occlusionTexture=this.emissionTexture=this.metallicRoughnessTexture=this.baseColorTexture=null;this.objectOpacity=1;this.commonMaterialParameters=new D;this.componentParameters=new I;this.textureAlphaCutoff=
B.alphaCutoff;this.alphaDiscardMode=C.AlphaDiscardMode.Opaque;this.polygonOffsetEnabled=this.isIntegratedMesh=!1;this.ellipsoidMode=z.EllipsoidMode.Earth;this.hasOccludees=!1;M=new A.TwoVectorPosition(N.position);const Q=k.clone(N.rotationScale);n.invert(Q,Q);n.transpose(Q,Q);this.transformNormalGlobalFromModel=Q;this.transformWorldFromModelTL=M.low;this.transformWorldFromModelTH=M.high;this.transformWorldFromModelRS=N.rotationScale}dispose(){this.normalTexture=this.occlusionTexture=this.emissionTexture=
this.metallicRoughnessTexture=this.baseColorTexture=null}get texture(){return this.baseColorTexture?.glTexture}get textureMetallicRoughness(){return this.metallicRoughnessTexture?.glTexture}get textureEmissive(){return this.emissionTexture?.glTexture}get hasEmissions(){return null!=this.emissionTexture||!p.exactEquals(this.emissiveFactor,h.ZEROS)}get textureOcclusion(){return this.occlusionTexture?.glTexture}get textureNormal(){return this.normalTexture?.glTexture}acquireTechnique(N,M,Q,O){const K=
new l.ComponentTechniqueConfiguration(N.context.spherical,N.context.doublePrecisionRequiresObfuscation);K.hasVertexColors=O.colors;K.hasNormals=O.hasNormals;K.textureCoordinateType=O.textureCoordinates;K.hasMetallicRoughnessTexture=null!=this.metallicRoughnessTexture;K.hasOcclusionTexture=null!=this.occlusionTexture;K.hasNormalTexture=null!=this.normalTexture;K.oitPass=M.identifier===t.RenderPassIdentifier.Material&&null!=Q.oitPass?Q.oitPass:H.OITPass.NONE;K.terrainDepthTest=M.identifier===t.RenderPassIdentifier.Material&&
Q.terrainDepthTest;K.cullAboveTerrain=M.identifier===t.RenderPassIdentifier.Material?Q.cullAboveTerrain:!1;K.ellipsoidMode=this.ellipsoidMode;K.componentData=this.componentParameters.type;K.cullFace=this.commonMaterialParameters.cullFace;K.doubleSidedMode=this.commonMaterialParameters.doubleSided?v.NormalsDoubleSidedMode.View:v.NormalsDoubleSidedMode.None;K.hasColorTexture=null!=this.baseColorTexture;const L=this._computeWhichMaterialPass();K.blendingEnabled=L===G.Transparent||L===G.OpaqueAndTransparent;
K.alphaDiscardMode=this.alphaDiscardMode;K.integratedMeshMode=this.isIntegratedMesh?null!=Q.overlay?.getTexture(f.OverlayContent.ColorNoRasterImage)?null!=Q.overlay?.getTexture(f.OverlayContent.WaterNormal)?l.IntegratedMeshMode.ColorOverlayWithWater:l.IntegratedMeshMode.ColorOverlay:l.IntegratedMeshMode.NoOverlay:l.IntegratedMeshMode.None;K.hasPolygonOffset=this.polygonOffsetEnabled;K.pbrMode=K.integratedMeshMode===l.IntegratedMeshMode.ColorOverlayWithWater?y.PBRMode.WaterOnIntegratedMesh:this.usePBR?
this.hasParametersFromSource?O.shadeNormals&&this.isIntegratedMesh?y.PBRMode.Disabled:y.PBRMode.Schematic:y.PBRMode.Normal:y.PBRMode.Disabled;K.emissionSource=null!=this.emissionTexture?r.EmissionSource.Texture:K.pbrMode===y.PBRMode.Normal?r.EmissionSource.Value:r.EmissionSource.None;K.shadeNormals=O.shadeNormals;K.normalType=K.hasNormals?q.NormalType.Compressed:q.NormalType.ScreenDerivative;K.hasSlicePlane=null!=Q.slicePlane&&this.commonMaterialParameters.hasSlicePlane;if(M.identifier===t.RenderPassIdentifier.ShadowMap)K.output=
m.ShaderOutput.Shadow,K.vertexDiscardMode=x.VertexDiscardMode.None;else if(M.identifier===t.RenderPassIdentifier.ViewshedShadowMap)K.output=m.ShaderOutput.ViewshedShadow,K.vertexDiscardMode=x.VertexDiscardMode.None;else if(M.identifier===t.RenderPassIdentifier.Highlight)K.output=m.ShaderOutput.Highlight,K.vertexDiscardMode=x.VertexDiscardMode.None;else{K.vertexDiscardMode=L===G.OpaqueAndTransparent?M.transparent?x.VertexDiscardMode.Opaque:x.VertexDiscardMode.Transparent:x.VertexDiscardMode.None;K.output=
M.output;K.receiveAmbientOcclusion=!1;K.receiveShadows=!1;switch(M.output){case m.ShaderOutput.Color:case m.ShaderOutput.ColorEmission:K.receiveAmbientOcclusion=O.applySSAO&&null!=Q.ssao;K.hasOccludees=Q.hasOccludees;K.receiveShadows=Q.shadowMap.ready;K.screenSpaceReflections=null!=Q.ssr.lastFrameColor;K.cloudReflections=null!=Q.clouds.data;break;case m.ShaderOutput.ObjectAndLayerIdColor:K.objectAndLayerIdColor=!0}K.snowCover=this.hasSnowCover(Q)}N=N.acquire(c.ComponentTechnique,K);this._setClean();
return N}hasSnowCover(N){return null!=N.weather&&N.weatherVisible&&"snowy"===N.weather.type&&"enabled"===N.weather.snowCover}submit(N,M,Q){if(0!==this.objectOpacity){var {components:O,renderable:K}=Q;({geometry:Q}=K);var L=K.meta.cameraDepthSquared,{geometryRanges:P,highlightRanges:R,defaultShadowMapRanges:W}=O;switch(this._computeWhichMaterialPass()){case G.Opaque:N.materialOpaque.submitDraw(this,Q,P,L);break;case G.Transparent:N.materialTransparent.submitDraw(this,Q,P,L);break;case G.OpaqueAndTransparent:N.materialOpaque.submitDraw(this,
Q,P,L);N.materialTransparent.submitDraw(this,Q,P,L);break;case G.IntegratedMesh:N.materialIntegratedMesh.submitDraw(this,Q,P,L),null!=M.overlay?.getTexture(f.OverlayContent.Highlight)&&N.highlightIntegratedMesh.submitDraw(this,Q,P,L)}var V=this.componentParameters.castShadows!==a.ComponentParameterSummary.None;V&&N.shadowMap.submitDraw(this,Q,P,L);if(null!=R)for(const ba of R)N.highlight.submitDraw(this,Q,ba[1],L,ba[0]),V&&N.highlightShadowMap.submitDraw(this,Q,ba[1],L,ba[0]);M.viewshedEnabled&&N.viewshedShadowMap.submitDraw(this,
Q,P,L);V&&null!=W&&N.defaultShadowMap.submitDraw(this,Q,W,L)}}_computeWhichMaterialPass(){return this.isIntegratedMesh?G.IntegratedMesh:1>this.objectOpacity?G.Transparent:this.componentParameters.opaqueOverride===a.ComponentParameterSummary.All?G.Opaque:1>this.baseColor[3]||this.alphaDiscardMode===C.AlphaDiscardMode.Blend||this.alphaDiscardMode===C.AlphaDiscardMode.MaskBlend?G.Transparent:this.componentParameters.transparent===a.ComponentParameterSummary.None?G.Opaque:this.componentParameters.transparent===
a.ComponentParameterSummary.All?G.Transparent:G.OpaqueAndTransparent}}b.__decorate([u.parameter({vectorOps:e.vec4})],F.prototype,"baseColor",void 0);b.__decorate([u.parameter()],F.prototype,"usePBR",void 0);b.__decorate([u.parameter()],F.prototype,"hasParametersFromSource",void 0);b.__decorate([u.parameter({vectorOps:p.vec3})],F.prototype,"mrrFactors",void 0);b.__decorate([u.parameter({vectorOps:p.vec3})],F.prototype,"emissiveFactor",void 0);b.__decorate([u.parameter({dispose:!0})],F.prototype,"baseColorTexture",
void 0);b.__decorate([u.parameter({dispose:!0})],F.prototype,"metallicRoughnessTexture",void 0);b.__decorate([u.parameter({dispose:!0})],F.prototype,"emissionTexture",void 0);b.__decorate([u.parameter({dispose:!0})],F.prototype,"occlusionTexture",void 0);b.__decorate([u.parameter({dispose:!0})],F.prototype,"normalTexture",void 0);b.__decorate([u.parameter()],F.prototype,"objectOpacity",void 0);b.__decorate([u.parameterBlock()],F.prototype,"commonMaterialParameters",void 0);b.__decorate([u.parameterBlock()],
F.prototype,"componentParameters",void 0);b.__decorate([u.parameter()],F.prototype,"textureAlphaCutoff",void 0);b.__decorate([u.parameter()],F.prototype,"alphaDiscardMode",void 0);b.__decorate([u.parameter()],F.prototype,"isIntegratedMesh",void 0);b.__decorate([u.parameter()],F.prototype,"polygonOffsetEnabled",void 0);b.__decorate([u.parameter()],F.prototype,"ellipsoidMode",void 0);b.__decorate([u.parameter()],F.prototype,"hasOccludees",void 0);var G;(function(N){N[N.Opaque=0]="Opaque";N[N.Transparent=
1]="Transparent";N[N.OpaqueAndTransparent=2]="OpaqueAndTransparent";N[N.IntegratedMesh=3]="IntegratedMesh"})(G||={});class D extends u.MaterialParameterBlock{constructor(){super(...arguments);this.doubleSided=!1;this.cullFace=C.CullFaceOptions.Back;this.hasSlicePlane=!0}}b.__decorate([u.parameter()],D.prototype,"doubleSided",void 0);b.__decorate([u.parameter()],D.prototype,"cullFace",void 0);b.__decorate([u.parameter()],D.prototype,"hasSlicePlane",void 0);class I extends u.MaterialParameterBlock{constructor(){super(...arguments);
this.externalColor=g.fromValues(1,1,1,1);this.externalColorMixMode=d.ColorMixModeEnum.Multiply;this.castShadows=a.ComponentParameterSummary.All}get transparent(){return 1>this.externalColor[3]?a.ComponentParameterSummary.All:a.ComponentParameterSummary.None}get opaqueOverride(){return this.externalColorMixMode===d.ColorMixModeEnum.Replace&&1===this.externalColor[3]?a.ComponentParameterSummary.All:a.ComponentParameterSummary.None}get visible(){return 0<this.externalColor[3]?a.ComponentParameterSummary.All:
a.ComponentParameterSummary.None}get type(){return w.ComponentDataType.Uniform}}b.__decorate([u.parameter({vectorOps:e.vec4})],I.prototype,"externalColor",void 0);b.__decorate([u.parameter()],I.prototype,"externalColorMixMode",void 0);b.__decorate([u.parameter()],I.prototype,"castShadows",void 0);a.ComponentParameterSummary=void 0;(function(N){N[N.All=0]="All";N[N.Some=1]="Some";N[N.None=2]="None"})(a.ComponentParameterSummary||(a.ComponentParameterSummary={}));class J extends u.MaterialParameterBlock{constructor(){super(...arguments);
this.texture=null;this.castShadows=this.opaqueOverride=this.transparent=a.ComponentParameterSummary.None}get type(){return w.ComponentDataType.Varying}}b.__decorate([u.parameter()],J.prototype,"texture",void 0);b.__decorate([u.parameter()],J.prototype,"transparent",void 0);b.__decorate([u.parameter()],J.prototype,"opaqueOverride",void 0);b.__decorate([u.parameter()],J.prototype,"castShadows",void 0);a.CommonMaterialParameters=D;a.ComponentMaterial=F;a.ComponentParametersUniform=I;a.ComponentParametersVarying=
J;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/collections/Component/Material/ComponentTechnique":function(){define("require exports ./ComponentTechniqueConfiguration ../../../../../../chunks/ComponentShader.glsl ../../../core/shaderLibrary/ShaderOutput ../../../core/shaderTechnique/ReloadableShaderModule ../../../core/shaderTechnique/ShaderTechnique ../../../lib/basicInterfaces ../../../lib/OITPass ../../../lib/OrderIndependentTransparency ../../../lib/StencilUtils ../../../lib/VertexAttribute ../../../../../webgl/enums ../../../../../webgl/renderState".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w,x){class u extends e.ShaderTechnique{constructor(m,q,r){super(m,q,new h.ReloadableShaderModule(k.ComponentShader,()=>new Promise((v,y)=>a(["./shader/ComponentShader.glsl"],v,y))),r,t)}initializePipeline(m){const {integratedMeshMode:q,output:r,blendingEnabled:v,cullFace:y,hasOccludees:B,hasPolygonOffset:z,oitPass:A}=m;m=q!==n.IntegratedMeshMode.None;const C=A===d.OITPass.NONE,H=A===d.OITPass.FrontFace;return x.makePipelineState({blending:p.isColorOrColorEmission(r)&&
v?f.blending(A):null,culling:x.cullingParams(y),depthTest:{func:f.oitDepthTest(A)},depthWrite:C||H?x.defaultDepthWrite:null,drawBuffers:r===p.ShaderOutput.Depth?{buffers:[w.SpecialDrawBuffers.NONE]}:f.getDrawBuffers(A,r),colorWrite:x.defaultColorWrite,stencilWrite:m||B?c.stencilWriteMaskOn:null,stencilTest:m?c.replaceBitWhenDepthTestPasses(g.StencilBits.IntegratedMeshMaskExcluded):B?c.stencilBaseAllZerosParams:null,polygonOffset:C||H?z?{factor:2,units:2}:null:f.OITPolygonOffset})}}const t=new Map([[l.VertexAttribute.POSITION,
0],[l.VertexAttribute.NORMAL,1],[l.VertexAttribute.NORMALCOMPRESSED,1],[l.VertexAttribute.COLOR,2],[l.VertexAttribute.UV0,3],[l.VertexAttribute.UVREGION,4],[l.VertexAttribute.COMPONENTINDEX,5]]);b.ComponentTechnique=u;b.vertexAttributeLocations=t;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/collections/Component/Material/ComponentTechniqueConfiguration":function(){define("exports ../../../../../../chunks/tslib.es6 ./shader/ComponentData.glsl ./shader/VertexDiscardByOpacity.glsl ../../../core/shaderLibrary/ShaderOutput ../../../core/shaderLibrary/attributes/NormalAttribute.glsl ../../../core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl ../../../core/shaderLibrary/output/Emissions.glsl ../../../core/shaderLibrary/shading/Normals.glsl ../../../core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../../../core/shaderLibrary/util/EllipsoidMode ../../../core/shaderTechnique/BindType ../../../core/shaderTechnique/ShaderTechniqueConfiguration ../../../lib/basicInterfaces ../../../lib/OITPass".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w,x,u){a.IntegratedMeshMode=void 0;(function(m){m[m.None=0]="None";m[m.NoOverlay=1]="NoOverlay";m[m.ColorOverlay=2]="ColorOverlay";m[m.ColorOverlayWithWater=3]="ColorOverlayWithWater";m[m.COUNT=4]="COUNT"})(a.IntegratedMeshMode||(a.IntegratedMeshMode={}));class t extends w.ShaderTechniqueConfiguration{constructor(m,q){super();this.spherical=m;this.doublePrecisionRequiresObfuscation=q;this.output=p.ShaderOutput.Color;this.textureCoordinateType=e.TextureCoordinateType.None;
this.componentData=n.ComponentDataType.Uniform;this.cullFace=x.CullFaceOptions.Back;this.vertexDiscardMode=k.VertexDiscardMode.None;this.doubleSidedMode=d.NormalsDoubleSidedMode.WindingOrder;this.alphaDiscardMode=x.AlphaDiscardMode.Opaque;this.integratedMeshMode=a.IntegratedMeshMode.None;this.oitPass=u.OITPass.NONE;this.ellipsoidMode=c.EllipsoidMode.Earth;this.pbrMode=f.PBRMode.Disabled;this.normalType=h.NormalType.Attribute;this.emissionSource=g.EmissionSource.None;this.hasNormals=this.hasVertexColors=
!1;this.shadeNormals=!0;this.hasColorTexture=this.hasSlicePlane=!1;this.blendingEnabled=this.receiveShadows=this.receiveAmbientOcclusion=!0;this.hasNormalTextureTransform=this.cullAboveTerrain=this.terrainDepthTest=this.hasOccludees=this.hasNormalTexture=this.hasOcclusionTexture=this.hasMetallicRoughnessTexture=this.hasPolygonOffset=this.screenSpaceReflections=!1;this.cloudReflections=!0;this.occlusionPass=this.discardInvisibleFragments=this.objectAndLayerIdColor=this.snowCover=!1;this.bindType=l.BindType.Draw;
this.hasSliceHighlight=!0;this.hasModelTransformation=this.instancedDoublePrecision=this.highStepCount=this.hasVertexTangents=this.useCustomDTRExponentForWater=this.hasSliceInVertexProgram=!1;this.useFillLights=!0;this.objectAndLayerIdColorInstanced=!1;this.canHaveOverlay=!0}}b.__decorate([w.parameter({count:p.ShaderOutput.COUNT})],t.prototype,"output",void 0);b.__decorate([w.parameter({count:e.TextureCoordinateType.COUNT})],t.prototype,"textureCoordinateType",void 0);b.__decorate([w.parameter({count:n.ComponentDataType.COUNT})],
t.prototype,"componentData",void 0);b.__decorate([w.parameter({count:x.CullFaceOptions.COUNT})],t.prototype,"cullFace",void 0);b.__decorate([w.parameter({count:k.VertexDiscardMode.COUNT})],t.prototype,"vertexDiscardMode",void 0);b.__decorate([w.parameter({count:d.NormalsDoubleSidedMode.COUNT})],t.prototype,"doubleSidedMode",void 0);b.__decorate([w.parameter({count:x.AlphaDiscardMode.COUNT})],t.prototype,"alphaDiscardMode",void 0);b.__decorate([w.parameter({count:a.IntegratedMeshMode.COUNT})],t.prototype,
"integratedMeshMode",void 0);b.__decorate([w.parameter({count:u.OITPass.COUNT})],t.prototype,"oitPass",void 0);b.__decorate([w.parameter({count:c.EllipsoidMode.COUNT})],t.prototype,"ellipsoidMode",void 0);b.__decorate([w.parameter({count:f.PBRMode.COUNT})],t.prototype,"pbrMode",void 0);b.__decorate([w.parameter({count:h.NormalType.COUNT})],t.prototype,"normalType",void 0);b.__decorate([w.parameter({count:g.EmissionSource.COUNT})],t.prototype,"emissionSource",void 0);b.__decorate([w.parameter()],t.prototype,
"hasVertexColors",void 0);b.__decorate([w.parameter()],t.prototype,"hasNormals",void 0);b.__decorate([w.parameter()],t.prototype,"shadeNormals",void 0);b.__decorate([w.parameter()],t.prototype,"hasSlicePlane",void 0);b.__decorate([w.parameter()],t.prototype,"hasColorTexture",void 0);b.__decorate([w.parameter()],t.prototype,"receiveAmbientOcclusion",void 0);b.__decorate([w.parameter()],t.prototype,"receiveShadows",void 0);b.__decorate([w.parameter()],t.prototype,"blendingEnabled",void 0);b.__decorate([w.parameter()],
t.prototype,"screenSpaceReflections",void 0);b.__decorate([w.parameter()],t.prototype,"hasPolygonOffset",void 0);b.__decorate([w.parameter()],t.prototype,"hasMetallicRoughnessTexture",void 0);b.__decorate([w.parameter()],t.prototype,"hasOcclusionTexture",void 0);b.__decorate([w.parameter()],t.prototype,"hasNormalTexture",void 0);b.__decorate([w.parameter()],t.prototype,"hasOccludees",void 0);b.__decorate([w.parameter()],t.prototype,"terrainDepthTest",void 0);b.__decorate([w.parameter()],t.prototype,
"cullAboveTerrain",void 0);b.__decorate([w.parameter()],t.prototype,"hasNormalTextureTransform",void 0);b.__decorate([w.parameter()],t.prototype,"cloudReflections",void 0);b.__decorate([w.parameter()],t.prototype,"snowCover",void 0);b.__decorate([w.parameter()],t.prototype,"objectAndLayerIdColor",void 0);a.ComponentTechniqueConfiguration=t;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/collections/Component/Material/shader/VertexDiscardByOpacity.glsl":function(){define(["exports",
"../../../../../../../core/compilerUtils","../../../../core/shaderModules/interfaces"],function(a,b,n){a.VertexDiscardMode=void 0;(function(k){k[k.None=0]="None";k[k.Transparent=1]="Transparent";k[k.Opaque=2]="Opaque";k[k.COUNT=3]="COUNT"})(a.VertexDiscardMode||(a.VertexDiscardMode={}));a.VertexDiscardByOpacity=function(k,p){k=k.vertex;k.code.add(n.glsl`#define VERTEX_DISCARD_CUTOFF (1.0 - 1.0 / 255.0)`);switch(p.vertexDiscardMode){case a.VertexDiscardMode.None:k.code.add(n.glsl`#define vertexDiscardByOpacity(_opacity_) {}`);
break;case a.VertexDiscardMode.Opaque:k.code.add(n.glsl`#define vertexDiscardByOpacity(_opacity_) { if (_opacity_ >  VERTEX_DISCARD_CUTOFF) {  gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`);break;case a.VertexDiscardMode.Transparent:k.code.add(n.glsl`#define vertexDiscardByOpacity(_opacity_) { if (_opacity_ <= VERTEX_DISCARD_CUTOFF) {  gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`);break;case a.VertexDiscardMode.COUNT:break;default:b.neverReached(p.vertexDiscardMode)}};Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/EllipsoidMode":function(){define(["exports","../../../../../../geometry/support/spatialReferenceUtils"],function(a,b){a.EllipsoidMode=void 0;(function(n){n[n.Earth=1]="Earth";n[n.Mars=2]="Mars";n[n.Moon=3]="Moon";n[n.COUNT=4]="COUNT"})(a.EllipsoidMode||(a.EllipsoidMode={}));a.getEllipsoidMode=function(n){return n&&b.isMars(n)?a.EllipsoidMode.Mars:n&&b.isMoon(n)?a.EllipsoidMode.Moon:a.EllipsoidMode.Earth};Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/chunks/ComponentShader.glsl":function(){define("exports ../geometry/support/Ellipsoid ../views/3d/terrain/OverlayContent ../views/3d/webgl-engine/collections/Component/Material/ComponentTechniqueConfiguration ../views/3d/webgl-engine/collections/Component/Material/shader/ComponentData.glsl ../views/3d/webgl-engine/collections/Component/Material/shader/VertexDiscardByOpacity.glsl ../views/3d/webgl-engine/core/shaderLibrary/ForwardLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/ShaderOutput ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VertexColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VertexNormal.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VertexPosition.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ComputeFragmentNormals.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ComputeMaterialColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ComputeNormalTexture.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateSceneLighting.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MainLighting.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ReadBaseColorTexture.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ReadShadowMap.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/TerrainDepthTest.glsl ../views/3d/webgl-engine/core/shaderLibrary/terrain/Overlay.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaCutoff ../views/3d/webgl-engine/core/shaderLibrary/util/DiscardOrAdjustAlpha.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/EllipsoidMode ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform ../views/3d/webgl-engine/shaders/OutputColorHighlightOID.glsl".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w,x,u,t,m,q,r,v,y,B,z,A,C,H,E,F,G,D,I,J){function N(Q){const O=new D.ShaderBuilder;O.include(w.VertexPosition,Q);O.include(l.VertexNormal,Q);O.include(c.VertexColor,Q);O.include(f.TextureCoordinateAttribute,Q);O.include(e.ForwardLinearDepth,Q);O.include(p.ComponentData,Q);O.include(E.DiscardOrAdjustAlphaDraw,Q);O.include(d.SlicePass,Q);O.include(B.ReadBaseColorTexture,Q);O.include(h.VertexDiscardByOpacity,Q);const {vertex:K,fragment:L}=O,{output:P,pbrMode:R,hasNormalTexture:W,
snowCover:V,receiveShadows:ba,spherical:U,ellipsoidMode:da}=Q;var fa=R===y.PBRMode.Normal||R===y.PBRMode.Schematic;fa&&(O.include(y.PhysicallyBasedRenderingParameters,Q),W&&O.include(q.ComputeNormalTexture,Q));var ha=P===g.ShaderOutput.Shadow||P===g.ShaderOutput.ShadowHighlight||P===g.ShaderOutput.ShadowExcludeHighlight;K.code.add(`#define discardShadows(castShadows) { ${G.If(ha&&Q.componentData===p.ComponentDataType.Varying,"if(!castShadows) { gl_Position \x3d vec4(vec3(1e38), 1.0); return; }")} }`);
const T=Q.integratedMeshMode===k.IntegratedMeshMode.ColorOverlay||Q.integratedMeshMode===k.IntegratedMeshMode.ColorOverlayWithWater;if(T){O.include(r.EvaluateSceneLighting,Q);O.include(C.OverlayIM,Q);var S=da===F.EllipsoidMode.Earth;K.code.add(`\n      ${G.If(U,`const float invRadius = ${G.glsl.float(1/(da===F.EllipsoidMode.Earth?b.earth.radius:S?b.mars.radius:b.moon.radius))};`)}\n      vec2 projectOverlay(vec3 pos) { return pos.xy ${G.If(U,"/ (1.0 + invRadius * pos.z);")}; }`)}if(S=T&&g.isColorOrColorEmission(P)&&
R===y.PBRMode.WaterOnIntegratedMesh)O.varyings.add("tbnTangent","vec3"),O.varyings.add("tbnBiTangent","vec3"),O.varyings.add("groundNormal","vec3");K.main.add(G.glsl`
    bool castShadows;
    vec4 externalColor = forwardExternalColor(castShadows);
    discardShadows(castShadows);

    vertexDiscardByOpacity(externalColor.a);

    ${P===g.ShaderOutput.ObjectAndLayerIdColor?G.glsl`externalColor.a = 1.0;`:""}

    if (externalColor.a < ${G.glsl.float(H.alphaCutoff)}) {
      // Discard this vertex
      gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
      return;
    }

    forwardPosition(readElevationOffset());
    forwardNormal();
    forwardTextureCoordinates();
    forwardVertexColor();
    forwardLinearDepth();
    forwardObjectAndLayerIdColor();
    ${S?U?G.glsl`
              groundNormal = normalize(positionWorld());
              tbnTangent = normalize(cross(vec3(0.0, 0.0, 1.0), groundNormal));
              tbnBiTangent = normalize(cross(groundNormal, tbnTangent));`:G.glsl`
              groundNormal = vec3(0.0, 0.0, 1.0);
              tbnTangent = vec3(1.0, 0.0, 0.0);
              tbnBiTangent = vec3(0.0, 1.0, 0.0);`:""}
    ${T?G.glsl`setOverlayVTC(projectOverlay(position));`:""}
  `);if(g.isColorOrColorEmission(P))return O.include(A.terrainDepthTest,Q),O.include(m.ComputeMaterialColor,Q),O.include(t.computeFragmentNormals,Q),O.include(r.EvaluateSceneLighting,Q),O.include(J.outputColorHighlightOID,Q),ba&&O.include(z.ReadShadowMapPass,Q),L.code.add(G.glsl`
      float evaluateShadow() {
        return ${ba?"readShadowMap(vPositionWorldCameraRelative, linearDepth)":"0.0"};
      }`),T&&L.uniforms.add(new I.Texture2DPassUniform("ovColorTex",(ia,Y)=>C.getIMColorTexture(ia,Y))),L.main.add(G.glsl`
      discardBySlice(vPositionWorldCameraRelative);
      terrainDepthTest(vPosition_view.z);

      vec4 textureColor = readBaseColorTexture();
      discardOrAdjustAlpha(textureColor);

      vec4 externalColor;
      int externalColorMixMode;
      readExternalColor(externalColor, externalColorMixMode);

      vec4 materialColor = computeMaterialColor(textureColor, externalColor, externalColorMixMode);
      ${T?G.glsl`vec4 overlayColor = getOverlayColor(ovColorTex, vtcOverlay);`:""}
    `),fa?(v.addMainLightIntensity(L),U&&r.addLightingGlobalFactor(L),L.main.add(G.glsl`
        applyPBRFactors();
        ${G.If(R===y.PBRMode.Normal,G.glsl`if (externalColorMixMode == 3) {
              mrr = vec3(0.0, 0.6, 0.2);
            }`)}
        float additionalIrradiance = 0.02 * mainLightIntensity[2];
        ${G.If(W,"mat3 tangentSpace \x3d computeTangentSpace(fragmentShadingNormal, vPositionWorldCameraRelative, vuv0);")}
        vec3 shadingNormal = ${W?"computeTextureNormal(tangentSpace, vuv0)":"fragmentShadingNormal"};
        vec3 normalGround = ${U?G.glsl`normalize(positionWorld())`:G.glsl`vec3(0.0, 0.0, 1.0)`};

        vec3 viewDir = normalize(vPositionWorldCameraRelative);
        float ssao = 1.0 - occlusion * evaluateAmbientOcclusionInverse();
        ${G.If(V,G.glsl`float snow = smoothstep(0.5, 0.55, dot(fragmentFaceNormal, normalize(positionWorld())));
                 materialColor.rgb = mix(materialColor.rgb, vec3(1.1), snow);
                 ssao = mix(ssao, 0.5 * ssao, snow);
                 shadingNormal = mix(shadingNormal, fragmentFaceNormal, snow);`)}
        ${G.If(T,"materialColor \x3d materialColor * (1.0 - overlayColor.a) + overlayColor;")}

        vec3 additionalLight = evaluateAdditionalLighting(ssao, positionWorld());
        vec4 emission = getEmissions();
        ${G.If(U,"float additionalAmbientScale \x3d additionalDirectedAmbientLight(positionWorld());")}
        ${U?G.glsl`float shadow = max(lightingGlobalFactor * (1.0 - additionalAmbientScale), evaluateShadow());`:"float shadow \x3d evaluateShadow();"}
        vec4 shadedColor = vec4(evaluateSceneLightingPBR(shadingNormal, materialColor.rgb, shadow, ssao, additionalLight, viewDir, normalGround, mrr, emission, additionalIrradiance), materialColor.a);
        `)):(U&&r.addLightingGlobalFactor(L),S&&L.uniforms.add(new I.Texture2DPassUniform("ovNormalTex",(ia,Y)=>Y.overlay?.getTexture(n.OverlayContent.WaterNormal))),L.main.add(G.glsl`
        ${G.If(U,"float additionalAmbientScale \x3d additionalDirectedAmbientLight(positionWorld());")}
        float shadow = ${ba?U?"max(lightingGlobalFactor * (1.0 - additionalAmbientScale), evaluateShadow())":"evaluateShadow()":U?"lightingGlobalFactor * (1.0 - additionalAmbientScale)":"0.0"};

        ${G.If(V,G.glsl`float snow = smoothstep(0.5, 0.55, dot(fragmentFaceNormal, normalize(positionWorld())));
               materialColor.rgb = mix(materialColor.rgb, vec3(1), snow);`)}

        // At global scale we create some additional ambient light based on the main light to simulate global illumination
        float ssao = evaluateAmbientOcclusion();
        vec3 additionalLight = evaluateAdditionalLighting(ssao, positionWorld());

        ${T?G.glsl` materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;`:""}

        vec4 shadedColor = vec4(evaluateSceneLighting(fragmentShadingNormal, materialColor.rgb, shadow, ssao, additionalLight), materialColor.a);
        ${G.If(S,G.glsl`vec4 overlayWaterMask = getOverlayColor(ovNormalTex, vtcOverlay);
                 float waterNormalLength = length(overlayWaterMask);
                 if (waterNormalLength > 0.95) {
                   mat3 tbnMatrix = mat3(tbnTangent, tbnBiTangent, groundNormal);
                   vec4 waterColorLinear = getOverlayWaterColor(overlayWaterMask, overlayColor, -normalize(vPositionWorldCameraRelative), shadow, groundNormal, tbnMatrix, vPosition_view, positionWorld());
                   vec4 waterColorNonLinear = delinearizeGamma(vec4(waterColorLinear.xyz, 1.0));
                   // un-gamma the ground color to mix in linear space
                   shadedColor = mix(shadedColor, waterColorNonLinear, waterColorLinear.w);
                 }`)}
      `)),L.main.add(G.glsl`outputColorHighlightOID(shadedColor, vPositionWorldCameraRelative);`),O;fa=P===g.ShaderOutput.Normal;S=P===g.ShaderOutput.ObjectAndLayerIdColor;const Z=P===g.ShaderOutput.Highlight;(ha=ha||P===g.ShaderOutput.ViewshedShadow)&&O.include(x.OutputDepth,Q);fa&&O.include(t.computeFragmentNormals,Q);O.include(u.OutputHighlight,Q);L.main.add(G.glsl`
    discardBySlice(vPositionWorldCameraRelative);

    vec4 textureColor = readBaseColorTexture();
    discardOrAdjustAlpha(textureColor);

    ${G.If(ha,"outputDepth(linearDepth);")}
    ${G.If(fa,G.glsl`fragColor = vec4(vec3(0.5) + 0.5 * fragmentFaceNormalView, 1.0);`)}
    ${G.If(S,T?"fragColor \x3d getOverlayColorTexel(vtcOverlay);":"outputObjectAndLayerIdColor();")}
    ${G.If(Z,G.glsl`${G.If(T,G.glsl`
           vec2 overlayHighlightTexel = getAllOverlayHighlightValuesEncoded();
           outputAllHighlights(overlayHighlightTexel);`,G.glsl`calculateOcclusionAndOutputHighlight();`)}`)}`);return O}const M=Object.freeze(Object.defineProperty({__proto__:null,build:N},Symbol.toStringTag,{value:"Module"}));a.ComponentShader=M;a.build=N})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/ComputeFragmentNormals.glsl":function(){define("exports ../../../../../../core/compilerUtils ../attributes/NormalAttribute.glsl ../attributes/VertexNormal.glsl ../attributes/VertexPosition.glsl ./Normals.glsl ../../shaderModules/interfaces".split(" "),
function(a,b,n,k,p,h,e){a.computeFragmentNormals=function(g,d){const f=g.fragment;switch(d.doubleSidedMode){case h.NormalsDoubleSidedMode.None:f.code.add(e.glsl`vec3 _adjustDoublesided(vec3 normal) {
return normal;
}`);break;case h.NormalsDoubleSidedMode.View:g.include(p.VertexPosition,d);f.code.add(e.glsl`vec3 _adjustDoublesided(vec3 normal) {
return dot(normal, vPositionWorldCameraRelative) > 0.0 ? -normal : normal;
}`);break;case h.NormalsDoubleSidedMode.WindingOrder:f.code.add(e.glsl`vec3 _adjustDoublesided(vec3 normal) {
return gl_FrontFacing ? normal : -normal;
}`);break;default:b.neverReached(d.doubleSidedMode);case h.NormalsDoubleSidedMode.COUNT:}switch(d.normalType){case n.NormalType.Attribute:case n.NormalType.Compressed:g.include(k.VertexNormal,d);f.main.add(e.glsl`vec3 fragmentFaceNormal = _adjustDoublesided(normalize(vNormalWorld));
vec3 fragmentFaceNormalView = gl_FrontFacing ? normalize(vNormalView) : -normalize(vNormalView);`);break;case n.NormalType.ScreenDerivative:g.include(p.VertexPosition,d),f.main.add(e.glsl`vec3 fragmentFaceNormal = normalize(cross(dFdx(vPositionWorldCameraRelative), dFdy(vPositionWorldCameraRelative)));
vec3 fragmentFaceNormalView = normalize(cross(dFdx(vPosition_view), dFdy(vPosition_view)));`)}d.shadeNormals?f.main.add(e.glsl`vec3 fragmentShadingNormal = fragmentFaceNormal;`):d.spherical?(g.include(p.VertexPosition,d),f.main.add(e.glsl`vec3 fragmentShadingNormal = normalize(positionWorld());`)):f.main.add(e.glsl`vec3 fragmentShadingNormal = vec3(0.0, 0.0, 1.0);`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/ComputeMaterialColor.glsl":function(){define("exports ../attributes/VertexColor.glsl ../util/MixExternalColor.glsl ../../shaderModules/Float4DrawUniform ../../shaderModules/FloatDrawUniform ../../shaderModules/interfaces".split(" "),
function(a,b,n,k,p,h){a.ComputeMaterialColor=function(e,g){e.include(b.VertexColor,g);e.fragment.include(n.MixExternalColor);e=e.fragment;e.uniforms.add(new k.Float4DrawUniform("baseColor",d=>d.baseColor));e.uniforms.add(new p.FloatDrawUniform("objectOpacity",d=>d.objectOpacity));g.hasVertexColors?e.code.add(h.glsl`vec3 _baseColor() {
return baseColor.rgb * vColor.rgb;
}
float _baseOpacity() {
return baseColor.a * vColor.a;
}`):e.code.add(h.glsl`vec3 _baseColor() {
return baseColor.rgb;
}
float _baseOpacity() {
return baseColor.a;
}`);e.code.add(h.glsl`vec4 computeMaterialColor(vec4 textureColor, vec4 externalColor, int externalColorMixMode) {
vec3 baseColor = _baseColor();
float baseOpacity = _baseOpacity();
vec3 color = mixExternalColor(
baseColor,
textureColor.rgb,
externalColor.rgb,
externalColorMixMode
);
float opacity = objectOpacity * mixExternalOpacity(
baseOpacity,
textureColor.a,
externalColor.a,
externalColorMixMode
);
return vec4(color, opacity);
}`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/ReadBaseColorTexture.glsl":function(){define("exports ../ShaderOutput ../attributes/VertexTextureCoordinates.glsl ../../shaderModules/interfaces ../../shaderModules/Texture2DDrawUniform ../../../lib/basicInterfaces".split(" "),function(a,b,n,k,p,h){a.ReadBaseColorTexture=function(e,g){const d=g.hasColorTexture&&(b.isColorOrColorEmission(g.output)||g.alphaDiscardMode!==h.AlphaDiscardMode.Opaque);
d&&(e.include(n.VertexTextureCoordinates,g),e.fragment.uniforms.add(new p.Texture2DDrawUniform("baseColorTexture",f=>f.texture)));e.fragment.code.add(k.glsl`
    vec4 readBaseColorTexture() {
      return ${d?"textureLookup(baseColorTexture, vuv0)":"vec4(1.0)"};
    }
  `)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/material/MaterialBase":function(){define(["exports","../shaderModules/interfaces"],function(a,b){class n extends b.NoParameters{constructor(){super(...arguments);this._dirty=!0}_setDirty(){this._dirty=!0}_setClean(){this._dirty=!1;if(null!=this._parameterBlocks)for(const p of this._parameterBlocks)this[p]._setClean()}get dirty(){return this._dirty||this._checkParameterBlocksDirty()}_checkParameterBlocksDirty(){if(null==
this._parameterBlocks)return!1;for(const p of this._parameterBlocks)if(this[p].dirty)return!0;return!1}}class k{constructor(){this._dirty=!0}_setDirty(){this._dirty=!0}_setClean(){this._dirty=!1}get dirty(){return this._dirty}}a.MaterialBase=n;a.MaterialParameterBlock=k;a.parameter=function(p={}){return(h,e)=>{const g=h._parameterCount??0;h._parameterCount=g+1;if(p.vectorOps){const d=p.vectorOps;Object.defineProperty(h,e,{get(){return this[g]},set(f){const c=this[g];if(null==c)this[g]=[...f];else{if(d.equals(c,
f))return;d.copy(c,f)}this._setDirty()}})}else Object.defineProperty(h,e,{get(){return this[g]},set(d){this[g]!==d&&(p.dispose&&this[g]&&this[g].dispose(),this[g]=d,this._setDirty())}})}};a.parameterBlock=function(){return(p,h)=>{const e=p._parameterCount??0;p._parameterCount=e+1;p._parameterBlocks=p._parameterBlocks||[];p._parameterBlocks.push(e);Object.defineProperty(p,h,{get(){return this[e]},set(g){this[e]!==g&&(this[e]=g,this._setDirty())}})}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/webgl-engine/core/util/TwoVectorPosition":function(){define(["exports","../../../../../chunks/vec32","../../../../../core/libs/gl-matrix-2/factories/vec3f32","../../../../../core/libs/gl-matrix-2/factories/vec3f64"],function(a,b,n,k){class p{constructor(e){this._low=k.create();this._high=k.create();e&&this.set(e)}get low(){return this._low}get high(){return this._high}set(e){b.copy(this._low,b.copy(h,e));e=b.sub(h,e,this._low);b.copy(this._high,e)}get(e){return b.add(e,this._low,this._high)}getLowScaled(e){return b.scale(e,
this._low,1)}}const h=n.create();a.TwoVectorPosition=p;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/TextureBackedBuffer/BufferManager":function(){define(["exports","./ManagedTextureBackedBuffer"],function(a,b){class n{constructor(k,p=1){this._rctx=k;this._fieldCount=p;this._buffers=[]}garbageCollect(){this._buffers=this._buffers.filter(k=>0===k.activeCount?(k.dispose(),!1):!0)}destroy(){this._buffers.forEach(k=>k.dispose());this._buffers=[]}getBuffer(k){for(const p of this._buffers)if(p.availableCount>=
k)return p;if(k>b.maxIndexCount)return null;k=new b.ManagedTextureBackedBuffer(this._rctx,this._fieldCount);this._buffers.push(k);return k}updateTextures(){for(const k of this._buffers)k.textureBuffer.updateTexture()}}a.BufferManager=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/TextureBackedBuffer/ManagedTextureBackedBuffer":function(){define(["exports","./SimpleIndexManager","./TextureBackedBuffer"],function(a,b,n){class k{constructor(p,h=1){this.textureBuffer=
new n.TextureBackedBuffer(p,h);this._indexManager=new b.SimpleIndexManager(65536)}dispose(){this.textureBuffer.dispose();this.textureBuffer=void 0}get availableCount(){return this._indexManager.availableCount}get activeCount(){return this._indexManager.activeCount}acquireIndex(){const p=this._indexManager.acquire();this.textureBuffer.resizeToFit(p);return p}releaseIndex(p){this._indexManager.release(p)}}a.ManagedTextureBackedBuffer=k;a.maxIndexCount=65536;Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/views/3d/webgl-engine/lib/TextureBackedBuffer/SimpleIndexManager":function(){define(["exports"],function(a){class b{constructor(n){this._maxCount=n;this._nextIndex=0;this._recycledIndices=[]}get activeCount(){return this._nextIndex-this._recycledIndices.length}get availableCount(){return this._recycledIndices.length+this._maxCount-this._nextIndex}acquire(){if(0<this._recycledIndices.length)return this._recycledIndices.pop();if(this.availableCount)return this._nextIndex++}release(n){this._recycledIndices.push(n)}}
a.SimpleIndexManager=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/TextureBackedBuffer/TextureBackedBuffer":function(){define(["exports","../../../../../geometry/support/buffer/BufferView","../../../../webgl/enums","../../../../webgl/Texture","../../../../webgl/TextureDescriptor"],function(a,b,n,k,p){class h{constructor(e,g=1){this._rctx=e;this._fieldCount=g;this.textureWidth=4096;this._dirty=!0;e=new p.TextureDescriptor(this.textureWidth,1);e.samplingMode=
n.TextureSamplingMode.NEAREST;e.wrapMode=n.TextureWrapMode.CLAMP_TO_EDGE;this._texture=new k.Texture(this._rctx,e);this._data=new b.BufferViewVec4u8(new ArrayBuffer(4*this.textureWidth))}dispose(){this._texture.dispose();this._data=this._texture=void 0}setData(e,g,d,f,c,l){e=e*this._fieldCount+g;this._dirty=!0;this._data.set(e,0,d);this._data.set(e,1,f);this._data.set(e,2,c);this._data.set(e,3,l)}setDataElement(e,g,d,f){e=e*this._fieldCount+g;this._dirty=!0;this._data.set(e,d,f)}getDataElement(e,
g,d){e=e*this._fieldCount+g;this._dirty=!0;return this._data.get(e,d)}resizeToFit(e){e=(e+1)*this._fieldCount;e>this._data.count&&(e=new b.BufferViewVec4u8(new ArrayBuffer(Math.ceil(e/this.textureWidth)*this.textureWidth*4)),e.typedBuffer.set(this._data.typedBuffer),this._data=e)}updateTexture(){if(this._dirty){var e=this._texture.descriptor.width;this._data.count>e*this._texture.descriptor.height&&this._texture.resize(e,this._data.count/e);this._texture.setData(this._data.typedBuffer);this._dirty=
!1}}get texture(){return this._texture}}a.TextureBackedBuffer=h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderTechnique/ShaderTechniqueConstructionContext":function(){define(["exports","../../../../ViewingMode"],function(a,b){class n{constructor(k,p,h,e,g){this.rctx=k;this.viewingMode=p;this.stippleTextures=h;this.waterTextures=e;this.markerTextures=g}get spherical(){return this.viewingMode===b.ViewingMode.Global}get doublePrecisionRequiresObfuscation(){return this.rctx.driverTest.doublePrecisionRequiresObfuscation.result}}
a.ShaderTechniqueConstructionContext=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderTechnique/ShaderTechniqueRepository":function(){define(["exports","../../../../../core/Error","../../../../../core/has","../../../../../core/NestedMap","./ShaderTechniqueConfiguration"],function(a,b,n,k,p){async function h(f){let c=!0;f.forEach(async l=>{await l.technique.reload(c);c=!1})}class e{constructor(f){this.context=f;this._precompiling=(this._debug=
!1,1);this._cache=new k.NestedMap;this._frameCounter=0;this._keepAliveFrameCount=-1}get precompiling(){return this._precompiling}set precompiling(f){this._precompiling=f;0===f&&this.context.rctx.gl.flush()}get viewingMode(){return this.context.viewingMode}destroy(){this._debug&&this._cache.forEach((f,c)=>{f.forEach(l=>{0<l.refCount&&console.error(`Unreleased ${c} shader technique, refCount ${l.refCount}`)})});this._cache.forAll(f=>f.technique.destroy());this._cache.clear()}precompile(f,c=d){++this.precompiling;
this.acquire(f,c).release();--this.precompiling}acquire(f,c=d){var l=c.key.code;let w=this._cache.get(f,l);if(null==w){if(0===this._precompiling)throw l=`Uncached shader compile in ${Error().stack}\n  for configuration\n${c.decode()}`,f=this._cache.getInner(f),f?.size&&(l=l+"\n\n  cached configurations:\n"+Array.from(f.values()).map(u=>c.decode(u.technique.key)).sort().join("\n\n")),console.log(l),new b(l);const x=new f(this.context,c,()=>this._release(x));w=new g(x);this._cache.set(f,l,w)}++w.refCount;
return w.technique}_release(f){null==f||this._cache.empty||(f=this._cache.get(f.constructor,f.key.code),null!=f&&(--f.refCount,0===f.refCount&&(f.refZeroFrame=this._frameCounter)))}frameUpdate(){this._frameCounter++;-1!==this._keepAliveFrameCount&&this._cache.forEach((f,c)=>{f.forEach((l,w)=>{0===l.refCount&&l.refZeroFrame+this._keepAliveFrameCount<this._frameCounter&&(l.technique.destroy(),this._cache.delete(c,w))})})}async reloadAll(){const f=[];this._cache.forEach(c=>f.push(h(c)));await Promise.all(f)}}
class g{constructor(f){this.technique=f;this.refZeroFrame=this.refCount=0}}const d=new p.ShaderTechniqueConfiguration;a.NoConfiguration=d;a.ShaderTechniqueRepository=e;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/effects/geometry/ObjectAndLayerIDRenderNode":function(){define("exports ../../../../../chunks/tslib.es6 ../../../../../core/accessorSupport/decorators/property ../../../../../core/has ../../../../../core/Logger ../../../../../core/RandomLCG ../../../../../core/accessorSupport/decorators/subclass ../../../../../core/libs/gl-matrix-2/factories/vec4f64 ../../../webgl/RenderNode ../../core/shaderLibrary/ShaderOutput ../../core/shaderLibrary/hud/HUDRenderStyle ../../../../webgl/enums".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l){a.ObjectAndLayerIDRenderNode=class extends d{constructor(w){super(w);this.consumes={required:["olid"]};this.produces="olid"}destroy(){}render(w){w=w.find(({name:u})=>"olid"===u);const x=this.renderingContext;x.bindFramebuffer(w.fbo);x.clearFramebuffer(g.ZEROS,!0,!0);this.view._stage.renderer.renderAllGeometry(f.ShaderOutput.ObjectAndLayerIdColor);x.clear(l.FramebufferBit.DEPTH|l.FramebufferBit.STENCIL);this.view._stage.renderer.renderHUD(c.HUDRenderStyle.NotOccluded);
return w}};b.__decorate([n.property()],a.ObjectAndLayerIDRenderNode.prototype,"consumes",void 0);b.__decorate([n.property()],a.ObjectAndLayerIDRenderNode.prototype,"produces",void 0);a.ObjectAndLayerIDRenderNode=b.__decorate([e.subclass("esri.views.3d.webgl-engine.effects.geometry.ObjectAndLayerIDRenderNode")],a.ObjectAndLayerIDRenderNode);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/effects/geometry/RenderOccludedRenderNode":function(){define("exports ../../../../../chunks/tslib.es6 ../../../../../core/PooledArray ../../../../../core/accessorSupport/decorators/property ../../../../../core/has ../../../../../core/Logger ../../../../../core/RandomLCG ../../../../../core/accessorSupport/decorators/subclass ../../../../../core/libs/gl-matrix-2/factories/vec4f64 ../../../webgl ../../../webgl/formats ../../../webgl/RenderNode ../blit/Blit ../../lib/basicInterfaces ../../lib/Material ../../lib/RenderSlot ../../shaders/CompositingTechniqueConfiguration ../../../../webgl/enums".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w,x,u,t,m,q){a.RenderOccludedRenderNode=class extends l{constructor(y){super(y);this.consumes={required:[f.InternalRenderCategory.OCCLUDED]};this.produces=f.InternalRenderCategory.OCCLUDED;this._blit=new w.Blit(y.view._stage.renderView.techniques,m.BlitMode.PremultipliedAlpha)}precompile(){const y=this.view._stage.renderer;y.plugins.plugins.forAll(B=>{y.precompileSlots(B,t.RenderSlot.OCCLUDED_TERRAIN,t.RenderSlot.TRANSPARENT_OCCLUDER_MATERIAL);B.material&&y.precompileOccludedSlots(B,
v)})}render(y){y=y.find(({name:A})=>A===f.InternalRenderCategory.OCCLUDED);const B=this.view._stage.renderer;let z=0;r.clear();B.plugins.plugins.forAll(A=>{A.material&&A.queryRenderOccludedState(u.RenderOccludedFlag.OccludeAndTransparentStencil)&&(z|=u.RenderOccludedFlag.OccludeAndTransparentStencil,r.push(A))});0<r.length&&(B.renderSlots(r,t.RenderSlot.OCCLUDER_MATERIAL),z&u.RenderOccludedFlag.OccludeAndTransparentStencil&&this._renderAndComposite(y,.5,()=>B.renderSlots(r,t.RenderSlot.TRANSPARENT_OCCLUDER_MATERIAL),
!1,!1));r.clear();B.plugins.plugins.forAll(A=>{if(A.material){var C=A.queryRenderOccludedState(u.RenderOccludedFlag.OccludeAndTransparent),H=A.queryRenderOccludedState(u.RenderOccludedFlag.Transparent),E=A.queryRenderOccludedState(u.RenderOccludedFlag.Opaque);if(C||H||E)z|=C?u.RenderOccludedFlag.OccludeAndTransparent:H?u.RenderOccludedFlag.Transparent:u.RenderOccludedFlag.Opaque,r.push(A)}});z|=B.plugins.renderOccludedFlags;if(!z)return y;for(const A of v)z&A&&this._renderAndComposite(y,A===u.RenderOccludedFlag.Opaque?
1:.5,()=>B.renderOccludedSlots(r,A),!0,x.StencilBits.OutlineVisualElementMask);r.clear();return y}_renderAndComposite(y,B,z,A,C){const H=this.renderingContext,{width:E,height:F}=y.fbo,G=this.fboCache.acquire(E,F,"tmp color"),D=A?this.fboCache.acquireDepth(c.DepthFormat.DEPTH_STENCIL_TEXTURE,E,F,"tmp depth"):y.getAttachment(q.DepthStencilAttachment);G.attachDepth(D);H.bindFramebuffer(G.fbo);H.clearFramebuffer(d.ZEROS,A,C);z();G.detachDepth();this._blit.blend(H,G,y,this.bindParameters,B);A&&D.release();
G.release()}};b.__decorate([k.property()],a.RenderOccludedRenderNode.prototype,"consumes",void 0);b.__decorate([k.property()],a.RenderOccludedRenderNode.prototype,"produces",void 0);b.__decorate([k.property({constructOnly:!0})],a.RenderOccludedRenderNode.prototype,"techniques",void 0);a.RenderOccludedRenderNode=b.__decorate([g.subclass("esri.views.3d.webgl-engine.effects.geometry.RenderOccludedRenderNode")],a.RenderOccludedRenderNode);const r=new n,v=[u.RenderOccludedFlag.OccludeAndTransparent,u.RenderOccludedFlag.Transparent,
u.RenderOccludedFlag.Opaque];Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/effects/blit/Blit":function(){define(["exports","../../../../../chunks/Compositing.glsl","../../shaders/CompositingTechnique","../../shaders/CompositingTechniqueConfiguration","../../../../webgl/enums"],function(a,b,n,k,p){class h{constructor(e,g=k.BlitMode.None){this._techniques=e;this._parameters=new b.CompositingPassParameters;this._configuration=new k.CompositingTechniqueConfiguration;
this._configuration.blitMode=g;e.precompile(n.CompositingTechnique,this._configuration)}blit(e,g,d,f){e.bindFramebuffer(d.fbo);e.setClearColor(0,0,0,1);e.clear(p.FramebufferBit.COLOR);this._parameters.texture=g.getTexture();g=this._techniques.acquire(n.CompositingTechnique,this._configuration);e.bindTechnique(g,f,this._parameters);e.screen.draw();g.release()}blend(e,g,d,f,c=1){this._configuration.hasOpacityFactor=1>c;const l=this._techniques.acquire(n.CompositingTechnique,this._configuration);if(!l.compiled)return l.release(),
!1;e.bindFramebuffer(d.fbo);this._parameters.texture=g.getTexture();this._parameters.opacity=c;e.bindTechnique(l,f,this._parameters);e.screen.draw();l.release();return!0}}a.Blit=h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/Compositing.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/ReadDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/RgbaFloatEncoding.glsl ../views/3d/webgl-engine/core/shaderModules/Float2PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform ../views/3d/webgl-engine/shaders/CompositingTechniqueConfiguration".split(" "),
function(a,b,n,k,p,h,e,g,d,f){function c(x){const u=new g.ShaderBuilder;u.include(b.ScreenSpacePass);u.fragment.uniforms.add(new d.Texture2DPassUniform("tex",m=>m.texture));x.hasOpacityFactor&&u.fragment.uniforms.add(new h.FloatPassUniform("opacity",m=>m.opacity));const t=x.blitMode===f.BlitMode.Depth;t&&(u.fragment.uniforms.add(new p.Float2PassUniform("nearFar",(m,q)=>q.camera.nearFar)),u.fragment.include(n.ReadDepth),u.fragment.include(k.RgbaFloatEncoding));u.fragment.main.add(e.glsl`
    ${t?e.glsl`
          float normalizedLinearDepth = (-linearDepthFromTexture(tex, uv) - nearFar[0]) / (nearFar[1] - nearFar[0]);
          fragColor = float2rgba(normalizedLinearDepth);`:e.glsl`
          fragColor = texture(tex, uv) ${x.hasOpacityFactor?"* opacity":""};`}`);return u}class l extends e.NoParameters{constructor(){super(...arguments);this.opacity=1}}const w=Object.freeze(Object.defineProperty({__proto__:null,CompositingPassParameters:l,build:c},Symbol.toStringTag,{value:"Module"}));a.Compositing=w;a.CompositingPassParameters=l;a.build=c})},"esri/views/3d/webgl-engine/shaders/CompositingTechniqueConfiguration":function(){define(["exports","../../../../chunks/tslib.es6","../core/shaderTechnique/ShaderTechniqueConfiguration"],
function(a,b,n){a.BlitMode=void 0;(function(p){p[p.None=0]="None";p[p.Alpha=1]="Alpha";p[p.PremultipliedAlpha=2]="PremultipliedAlpha";p[p.Depth=3]="Depth";p[p.COUNT=4]="COUNT"})(a.BlitMode||(a.BlitMode={}));class k extends n.ShaderTechniqueConfiguration{constructor(){super(...arguments);this.blitMode=a.BlitMode.None;this.hasOpacityFactor=!1}}b.__decorate([n.parameter({count:a.BlitMode.COUNT})],k.prototype,"blitMode",void 0);b.__decorate([n.parameter()],k.prototype,"hasOpacityFactor",void 0);a.CompositingTechniqueConfiguration=
k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/CompositingTechnique":function(){define("require exports ../../../../core/compilerUtils ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../../../../chunks/Compositing.glsl ./CompositingTechniqueConfiguration ../../../webgl/renderState".split(" "),function(a,b,n,k,p,h,e,g){class d extends p.ShaderTechnique{constructor(f,c,l){super(f,c,new k.ReloadableShaderModule(h.Compositing,
()=>new Promise((w,x)=>a(["./Compositing.glsl"],w,x))),l)}initializePipeline(f){switch(f.blitMode){case e.BlitMode.None:case e.BlitMode.Depth:return g.makePipelineState({colorWrite:g.defaultColorWrite});case e.BlitMode.Alpha:return g.makePipelineState({blending:g.premultipliedAlphaToPremultipliedAlpha,colorWrite:g.defaultColorWrite});default:n.neverReached(f.blitMode);case e.BlitMode.PremultipliedAlpha:case e.BlitMode.COUNT:return g.makePipelineState({blending:g.blendWithPremultipliedAlpha,colorWrite:g.defaultColorWrite})}}}
b.CompositingTechnique=d;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/effects/haze/Haze":function(){define("exports ../../../../../chunks/tslib.es6 ../../../../../core/mathUtils ../../../../../core/maybe ../../../../../core/reactiveUtils ../../../../../core/Logger ../../../../../core/has ../../../../../core/RandomLCG ../../../../../core/Error ../../../../../core/accessorSupport/decorators/subclass ../../../../../core/libs/gl-matrix-2/math/vec2 ../../../../../chunks/vec32 ../../../../../chunks/vec42 ../../../../../geometry/support/Ellipsoid ../../../webgl ../../../webgl/formats ../TransparentEnvironment ../../../../../chunks/HazeCompositing.glsl ./HazeCompositingTechnique ./HazeTechnique ./HazeTechniqueConfiguration ../../lib/glUtil3D ../../lib/textureUtils ../../../../webgl/enums".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w,x,u,t,m,q,r,v,y,B,z,A){a.Haze=class extends m.TransparentEnvironment{constructor(C){super(C);this._compositingPassParameters=new q.HazeCompositingPassParameters;this._passParameters=new v.HazePassParameters;this._hazeConfiguration=new y.HazeTechniqueConfiguration;this._vao=null;this.requireGeometryDepth=!0;this._amount=this._newAmount=this._oldAmount=1;({techniques:C}=C);C.precompile(v.HazeTechnique,this._hazeConfiguration);C.precompile(r.HazeCompositingTechnique);
this._hazeConfiguration.reduced=!0;C.precompile(v.HazeTechnique,this._hazeConfiguration);this._hazeConfiguration.reduced=!1}initialize(){this.addHandles([p.watch(()=>this.view.environment.atmosphereEnabled,C=>C?this._enable():this._disable(),p.syncAndInitial),p.watch(()=>this.view._stage?.renderer.renderContext.bind.clouds.fadeFactor??1,C=>this._fade(C),p.syncAndInitial),p.watch(()=>this.view.environment.weather.type,C=>this._newAmount="rainy"===C?0:1,p.syncAndInitial),p.watch(()=>this.view._stage.renderer?.fullResolutionAtmosphere,
C=>this._hazeConfiguration.reduced=!C,p.syncAndInitial)])}_fade(C){1<=C?this._oldAmount=this._amount=this._newAmount:this._amount=0>=C?this._oldAmount:n.lerp(this._oldAmount,this._newAmount,C)}destroy(){this._vao=k.disposeMaybe(this._vao)}render(C){C=C.find(({name:M})=>M===u.InternalRenderCategory.TRANSPARENT_ENVIRONMENT);if(!this.bindParameters.mainDepth)return C;const H=this.renderingContext;this._vao??(this._vao=B.createQuadVAO(H,B.Layout.Pos2Tex));const E=this.techniques.acquire(v.HazeTechnique,
this._hazeConfiguration);if(!E.compiled)return E.release(),C;const F=C.getAttachment(H.gl.DEPTH_STENCIL_ATTACHMENT);this._update();if(!this._hazeConfiguration.reduced)return C.detachDepth(),H.bindFramebuffer(C.fbo),H.bindTechnique(E,this.bindParameters,this._passParameters),this._renderCommon(H),C.attachDepth(F),E.release(),C;const G=this.techniques.acquire(r.HazeCompositingTechnique);if(!G.compiled)return E.release(),G.release(),C;const D=H.getViewport();var I=this.camera,J=l.length(I.eye)-x.earth.radius;
var N=x.earth.atmosphereHeight;N=J<N?n.lerp(.4,.5,Math.min(1,Math.max(0,J/N))):n.lerp(.5,1,Math.min(1,Math.max(0,(J-N)/(15*N))));J=z.applyTextureResizeModulo(Math.round(N*I.fullViewport[2]));I=z.applyTextureResizeModulo(Math.round(N*I.fullViewport[3]));H.setViewport(0,0,J,I);I=this.fboCache.acquire(J,I,"haze",t.ColorFormat.RGBA);H.bindFramebuffer(I.fbo);H.clearFramebuffer([0,0,0,1],!0,!0);H.bindTechnique(E,this.bindParameters,this._passParameters);this._renderCommon(H);H.setViewport(D.x,D.y,D.width,
D.height);this._compositingPassParameters.color=I.getTexture();C.detachDepth();H.bindFramebuffer(C.fbo);H.bindTechnique(G,this.bindParameters,this._compositingPassParameters);H.screen.draw();C.attachDepth(F);G.release();E.release();I.release();return C}_renderCommon(C){null!=this._vao&&(C.bindVAO(this._vao),C.drawArrays(A.PrimitiveType.TRIANGLE_STRIP,0,4))}_update(){var C=l.squaredLength(this.bindParameters.camera.eye);const H=Math.sqrt(C),E=C-this._passParameters.radii[1]*this._passParameters.radii[1],
F=n.clamp((H-this._passParameters.radii[0])/x.earth.atmosphereHeight,0,1);w.set(this._passParameters.heightParameters,H,C,E,F);C=this.view.basemapTerrain.getLowerBoundRadius();c.set(this._passParameters.radii,C,C+x.earth.atmosphereHeight);this._passParameters.hazeStrength=n.lerp(n.lerp(.6,1,n.smoothstep(9500,10500,H-x.earth.radius)),1,this._amount)}};a.Haze=b.__decorate([f.subclass("esri.views.3d.webgl-engine.effects.haze.Haze")],a.Haze);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/chunks/HazeCompositing.glsl":function(){define(["exports","../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass.glsl","../views/3d/webgl-engine/core/shaderModules/interfaces","../views/3d/webgl-engine/core/shaderModules/ShaderBuilder","../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform"],function(a,b,n,k,p){function h(){const d=new k.ShaderBuilder;d.include(b.ScreenSpacePass);d.fragment.uniforms.add(new p.Texture2DPassUniform("colorTexture",f=>f.color),new p.Texture2DPassUniform("depthTexture",
(f,c)=>c.mainDepth));d.fragment.main.add(n.glsl`float depthSample = texture(depthTexture, uv).r;
if (depthSample == 1.0 ) {
fragColor = vec4(0);
return;
}
fragColor = texture(colorTexture, uv);`);return d}class e extends n.NoParameters{}const g=Object.freeze(Object.defineProperty({__proto__:null,HazeCompositingPassParameters:e,build:h},Symbol.toStringTag,{value:"Module"}));a.HazeCompositing=g;a.HazeCompositingPassParameters=e;a.build=h})},"esri/views/3d/webgl-engine/effects/haze/HazeCompositingTechnique":function(){define("require exports ../../core/shaderTechnique/ReloadableShaderModule ../../core/shaderTechnique/ShaderTechnique ../../../../../chunks/HazeCompositing.glsl ../../../../webgl/enums ../../../../webgl/renderState".split(" "),
function(a,b,n,k,p,h,e){class g extends k.ShaderTechnique{constructor(d,f,c){super(d,f,new n.ReloadableShaderModule(p.HazeCompositing,()=>new Promise((l,w)=>a(["./HazeCompositing.glsl"],l,w))),c)}initializePipeline(){return e.makePipelineState({blending:e.separateBlendingParams(h.BlendFactor.ONE,h.BlendFactor.ZERO,h.BlendFactor.ONE_MINUS_SRC_COLOR,h.BlendFactor.ONE),depthTest:{func:h.CompareFunction.ALWAYS},colorWrite:e.defaultColorWrite})}}b.HazeCompositingTechnique=g;Object.defineProperty(b,Symbol.toStringTag,
{value:"Module"})})},"esri/views/3d/webgl-engine/effects/haze/HazeTechnique":function(){define("require exports ../../../environment/ChapmanApproximation.glsl ../../core/shaderTechnique/ReloadableShaderModule ../../core/shaderTechnique/ShaderTechnique ../../../../../chunks/Haze.glsl ../../../../webgl/enums ../../../../webgl/renderState".split(" "),function(a,b,n,k,p,h,e,g){class d extends n.ChapmanApproximationParameters{constructor(){super(...arguments);this.hazeStrength=1}}class f extends p.ShaderTechnique{constructor(c,
l,w){super(c,l,new k.ReloadableShaderModule(h.Haze,()=>new Promise((x,u)=>a(["./Haze.glsl"],x,u))),w)}initializePipeline(c){return c.reduced?g.makePipelineState({blending:g.keepSourceValues,depthTest:{func:e.CompareFunction.ALWAYS},colorWrite:g.defaultColorWrite}):g.makePipelineState({blending:g.separateBlendingParams(e.BlendFactor.ONE,e.BlendFactor.ZERO,e.BlendFactor.ONE_MINUS_SRC_COLOR,e.BlendFactor.ONE),colorWrite:g.defaultColorWrite})}}b.HazePassParameters=d;b.HazeTechnique=f;Object.defineProperty(b,
Symbol.toStringTag,{value:"Module"})})},"esri/chunks/Haze.glsl":function(){define("exports ../views/3d/environment/ChapmanRaymarching.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/ReadDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/Gamma.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MainLighting.glsl ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform ../views/3d/webgl-engine/shaders/ScreenSpacePassAtmosphere.glsl ../views/3d/webgl-engine/shaders/SphereIntersect.glsl ../views/3d/webgl-engine/shaders/ToneMapping.glsl".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l){function w(u){const t=new g.ShaderBuilder;t.include(f.ScreenSpacePassAtmosphere);({reduced:u}=u);const {fragment:m}=t;m.uniforms.add(new d.Texture2DPassUniform("depthTexture",(q,r)=>r.mainDepth),new h.FloatPassUniform("hazeStrength",q=>q.hazeStrength));p.addMainLightDirection(m);t.include(k.Gamma);m.include(n.ReadDepth);m.include(c.SphereIntersect);m.include(l.ToneMapping);m.include(b.ChapmanRaymarching,!0);u&&m.code.add(e.glsl`float getDepth(vec2 uv){
return linearDepthFromTexture(depthTexture, uv);
}
float textureBilinear(vec2 uv) {
vec2 depthTextureSize = vec2(textureSize(depthTexture, 0));
vec2 texelSize = 1.0 / depthTextureSize;
vec2 depthUV = (uv * depthTextureSize) - vec2(0.5);
vec2 f = fract(depthUV);
vec2 snapUV = (floor(depthUV) + vec2(0.5)) / depthTextureSize;
float d0 = getDepth(snapUV);
float d1 = getDepth(snapUV + vec2(texelSize.x, 0.0));
float d2 = getDepth(snapUV + vec2(0.0, texelSize.y));
float d3 = getDepth(snapUV + texelSize);
return mix(mix(d0, d1, f.x), mix(d2, d3, f.x), f.y);
}`);m.main.add(e.glsl`
      vec3 rayDir = normalize(worldRay);
      float terrainDepth = -1.0;

      float depthSample = texture(depthTexture, uv).r;
      if (depthSample != 1.0) {
        vec3 cameraSpaceRay = normalize(eyeDir);
        cameraSpaceRay /= cameraSpaceRay.z;

        cameraSpaceRay *= ${e.If(u,"-textureBilinear(uv)","-linearDepthFromTexture(depthTexture, uv)")};
        terrainDepth = max(0.0, length(cameraSpaceRay));
      } else {
        discard;
      }

      // Alpha is ignored for haze blending
      vec3 col = vec3(0);
      float fadeOut = smoothstep(-10000.0, -15000.0, heightParameters[0] - radii[0]);
      if(depthSample != 1.0){
        col = (1.0 - fadeOut) * hazeStrength * raymarchAtmosphere(cameraPosition, rayDir, mainLightDirection, terrainDepth);
      }
      float alpha = 1.0;

      col = tonemapACES(col);
      fragColor = delinearizeGamma(vec4(col, alpha));
  `);return t}const x=Object.freeze(Object.defineProperty({__proto__:null,build:w},Symbol.toStringTag,{value:"Module"}));a.Haze=x;a.build=w})},"esri/views/3d/webgl-engine/effects/haze/HazeTechniqueConfiguration":function(){define(["exports","../../../../../chunks/tslib.es6","../../core/shaderTechnique/ShaderTechniqueConfiguration"],function(a,b,n){class k extends n.ShaderTechniqueConfiguration{constructor(){super(...arguments);this.reduced=!1}}b.__decorate([n.parameter()],k.prototype,"reduced",void 0);
a.HazeTechniqueConfiguration=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/effects/highlight/ShadowHighlight":function(){define("exports ../../../../../chunks/tslib.es6 ../../../../../core/colorUtils ../../../../../core/mathUtils ../../../../../core/reactiveUtils ../../../../../core/accessorSupport/decorators/property ../../../../../core/has ../../../../../core/Logger ../../../../../core/RandomLCG ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/vec32 ../../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../ViewingMode ../../../webgl ../../../webgl/RenderNode ./ShadowHighlightTechnique ../../lib/basicInterfaces ../../../../support/HighlightDefaults".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w,x,u,t,m,q){const r=1/512;a.ShadowHighlight=class extends u{constructor(y){super(y);this.produces=x.RenderCategory.COMPOSITE;this.consumes={required:[x.RenderCategory.COMPOSITE,"highlights"]};this._passParameters=new t.ShadowHighlightPassParameters;this._maxOpacity=1;this._shadowDifference=.2;y.techniques.precompile(t.ShadowHighlightTechnique)}initialize(){this.addHandles([p.watch(()=>this.view.highlightOptions.shadowOpacity,y=>{this._passParameters.shadowOpacity=
y??q.defaultShadowOpacity;this._updateOccludedShadowOpacity();this._ensureMaxOpacity()},p.syncAndInitial),p.watch(()=>this.view.highlightOptions.shadowDifference,y=>{this._shadowDifference=y??q.defaultShadowDifference;this._updateOccludedShadowOpacity();this._ensureMaxOpacity()},p.syncAndInitial),p.watch(()=>this.view.highlightOptions.shadowColor,y=>{this._passParameters.shadowColor=n.unitRGBAFromColor(y??q.defaultShadowColor);this._ensureMaxOpacity()},p.syncAndInitial)])}_updateOccludedShadowOpacity(){this._passParameters.occludedShadowOpacity=
this._passParameters.shadowOpacity*(1-this._shadowDifference)}_ensureMaxOpacity(){this._maxOpacity=Math.max(this._passParameters.shadowOpacity,this._passParameters.occludedShadowOpacity)*this._passParameters.shadowColor[3];this.requestRender(m.RenderRequestType.UPDATE)}render(y){const B=y.find(({name:C})=>C===x.RenderCategory.COMPOSITE),z=this.bindParameters;if(!z.shadowHighlightsVisible||!z.depth||!this._ensureIfVisible(z.camera,z.lighting.mainLight.direction))return B;const A=this.techniques.acquire(t.ShadowHighlightTechnique);
A.compiled?(this._passParameters.highlight=y.find(({name:C})=>"highlights"===C)?.getTexture(),this._passParameters.origin=z.camera.center,y=this.renderingContext,y.bindFramebuffer(B.fbo),y.bindTechnique(A,z,this._passParameters),y.screen.draw()):this.requestRender(m.RenderRequestType.UPDATE);A.release();return B}_ensureIfVisible(y,B){this._passParameters.opacityElevation=1-k.smoothstep(4E4,5E4,y.relativeElevation);y=this.viewingMode===w.ViewingMode.Global?c.normalize(v,y.center):c.set(v,0,0,1);B=
c.dot(y,B);this._passParameters.dayNightTerminator=k.smoothstep(0,1,k.clamp(30*B,0,1));return this._maxOpacity*this._passParameters.opacityElevation*this._passParameters.dayNightTerminator>=r}};b.__decorate([h.property()],a.ShadowHighlight.prototype,"produces",void 0);b.__decorate([h.property()],a.ShadowHighlight.prototype,"consumes",void 0);b.__decorate([h.property({constructOnly:!0})],a.ShadowHighlight.prototype,"viewingMode",void 0);b.__decorate([h.property({constructOnly:!0})],a.ShadowHighlight.prototype,
"techniques",void 0);a.ShadowHighlight=b.__decorate([f.subclass("esri.views.3d.webgl-engine.effects.highlight.ShadowHighlight")],a.ShadowHighlight);const v=l.create();Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/effects/highlight/ShadowHighlightTechnique":function(){define("require exports ../../../../../core/libs/gl-matrix-2/factories/vec4f64 ../../core/shaderLibrary/shading/ReadShadowMap.glsl ../../core/shaderTechnique/ReloadableShaderModule ../../core/shaderTechnique/ShaderTechnique ../../../../../chunks/ShadowHighlight.glsl ../../../../webgl/enums ../../../../webgl/renderState".split(" "),
function(a,b,n,k,p,h,e,g,d){class f extends k.ReadShadowMapPassParameters{constructor(){super(...arguments);this.shadowColor=n.fromValues(1,0,1,1);this.shadowOpacity=.2;this.occludedShadowOpacity=.1;this.dayNightTerminator=this.opacityElevation=1}}class c extends h.ShaderTechnique{constructor(l,w,x){super(l,w,new p.ReloadableShaderModule(e.ShadowHighlight,()=>new Promise((u,t)=>a(["../../shaders/ShadowHighlight.glsl"],u,t))),x);this.primitiveType=g.PrimitiveType.TRIANGLE_STRIP}initializePipeline(){return d.makePipelineState({blending:d.premultipliedAlphaToPremultipliedAlpha,
colorWrite:d.defaultColorWrite,depthTest:null,depthWrite:null})}}b.ShadowHighlightPassParameters=f;b.ShadowHighlightTechnique=c;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/ShadowHighlight.glsl":function(){define("exports ../core/libs/gl-matrix-2/math/mat4 ../core/libs/gl-matrix-2/factories/mat4f64 ./vec32 ../core/libs/gl-matrix-2/factories/vec3f64 ../views/3d/webgl-engine/core/shaderLibrary/NormalFromDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ReadShadowMap.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/RgbaFloatEncoding.glsl ../views/3d/webgl-engine/core/shaderModules/Float3PassUniform ../views/3d/webgl-engine/core/shaderModules/Float4PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/Matrix4PassUniform ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform ../views/3d/webgl-engine/lib/ShadowMap ../views/3d/webgl-engine/shaders/ReadShadowMapConfiguration".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w,x,u,t,m,q){function r(){const z=new u.ShaderBuilder;z.include(g.ReadShadowMapPass,B);z.include(e.ScreenSpacePass);z.include(h.NormalFromDepth);const A=z.fragment;A.include(d.RgbaFloatEncoding);A.uniforms.add(new t.Texture2DPassUniform("defaultDepthTex",(C,H)=>H.shadowMap.getSnapshot(m.SnapshotSlot.ExcludeHighlight)),new t.Texture2DPassUniform("highlightDepthTex",(C,H)=>H.shadowMap.getSnapshot(m.SnapshotSlot.Highlight)),new t.Texture2DPassUniform("depthMap",(C,H)=>
H.depth?.attachment),new t.Texture2DPassUniform("highlightTexture",C=>C.highlight),new c.Float4PassUniform("uColor",C=>C.shadowColor),new l.FloatPassUniform("opacity",C=>C.shadowOpacity),new l.FloatPassUniform("occludedOpacity",C=>C.occludedShadowOpacity),new l.FloatPassUniform("terminationFactor",C=>C.opacityElevation*C.dayNightTerminator),new f.Float3PassUniform("lightingMainDirectionView",(C,H)=>k.normalize(y,k.transformMat4(y,H.lighting.mainLight.direction,H.camera.viewInverseTransposeMatrix))),
new x.Matrix4PassUniform("inverseViewMatrix",(C,H)=>b.invert(v,b.translate(v,H.camera.viewMatrix,H.camera.center)))).main.add(w.glsl`
    ivec2 highlightTextureSize = textureSize(highlightTexture, 0);
    ivec2 highlightIUV = ivec2(uv * vec2(highlightTextureSize));
    vec4 highlightInfo = texelFetch(highlightTexture, highlightIUV, 0);

    fragColor = vec4(0.0);

    // Calculate bit mask to check if pixel is highlit unoccluded at any level
    int ored =
         (int(highlightInfo.r*255.0) << 0)
       | (int(highlightInfo.g*255.0) << 8)
       | (int(highlightInfo.b*255.0) << 16)
       | (int(highlightInfo.a*255.0) << 24);
    bool visiblyHighlighted = ((ored & ~(ored >> 1)) & (1+4+16+64)) != 0;
    if (visiblyHighlighted) {
      return;
    }

    // 1.0 is the clear value of depthMap, which means nothing has been drawn there and we should discard
    float depth = depthFromTexture(depthMap, uv);
    if (depth >= 1.0 || depth <= 0.0) {
      return;
    }

    float currentPixelDepth = linearizeDepth(depth);
    vec4 currentPixelPos = vec4(reconstructPosition(gl_FragCoord.xy, currentPixelDepth), 1.0);
    vec4 worldSpacePos = inverseViewMatrix * currentPixelPos;

    mat4 shadowMatrix;
    float linearDepth = -currentPixelDepth;
    int i = chooseCascade(linearDepth, shadowMatrix);
    if (i >= numCascades) {
      return;
    }

    // vertex completely outside? -> no shadow
    vec3 lvpos = lightSpacePosition(worldSpacePos.xyz, shadowMatrix);
    if (lvpos.z >= 1.0 || lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) {
      return;
    }

    ivec2 texSize = textureSize(highlightDepthTex, 0);
    ivec2 uvShadow = ivec2(cascadeCoordinates(i, texSize, lvpos) * vec2(texSize));

    float depthHighlight = readShadowMapDepth(uvShadow, highlightDepthTex);
    bool shadowHighlight = depthHighlight < lvpos.z;
    if (!shadowHighlight) {
      return;
    }

    float depthDefault = readShadowMapDepth(uvShadow, defaultDepthTex);
    bool shadowDefault = depthDefault < lvpos.z;

    vec3 normal = normalFromDepth(depthMap, currentPixelPos.xyz, gl_FragCoord.xy, uv);
    bool shaded = dot(normal, lightingMainDirectionView) < ${w.glsl.float(.025)};

    float fragOpacity = (shadowDefault || shaded) ? occludedOpacity : opacity;
    fragColor = vec4(uColor.rgb, uColor.a * fragOpacity * terminationFactor);
  `);return z}const v=n.create(),y=p.create(),B=new q.ReadShadowMapConfiguration;n=Object.freeze(Object.defineProperty({__proto__:null,build:r},Symbol.toStringTag,{value:"Module"}));a.ShadowHighlight=n;a.build=r})},"esri/views/3d/webgl-engine/core/shaderLibrary/NormalFromDepth.glsl":function(){define(["exports","./output/ReadDepth.glsl","./util/CameraSpace.glsl","../shaderModules/interfaces"],function(a,b,n,k){a.NormalFromDepth=function(p){const h=p.fragment;p.include(n.CameraSpace);h.include(b.ReadDepth);
h.code.add(k.glsl`vec3 normalFromDepth(sampler2D depthMap, vec3 pixelPos, vec2 fragCoord, vec2 uv) {
ivec2 iuv = ivec2(uv * vec2(textureSize(depthMap, 0)));
float leftPixelDepth = linearizeDepth(texelFetch(depthMap, iuv + ivec2(-1, 0), 0).r);
float rightPixelDepth = linearizeDepth(texelFetch(depthMap, iuv + ivec2(1, 0), 0).r);
float bottomPixelDepth = linearizeDepth(texelFetch(depthMap, iuv + ivec2(0, -1), 0).r);
float topPixelDepth = linearizeDepth(texelFetch(depthMap, iuv + ivec2(0, 1), 0).r);
bool pickLeft = abs(pixelPos.z - leftPixelDepth) < abs(pixelPos.z - rightPixelDepth);
bool pickBottom = abs(pixelPos.z - bottomPixelDepth) < abs(pixelPos.z - topPixelDepth);
vec3 fragCoordHorizontal = pickLeft
? vec3(fragCoord + vec2(-1.0, 0.0), leftPixelDepth)
: vec3(fragCoord + vec2(1.0, 0.0), rightPixelDepth);
vec3 fragCoordVertical = pickBottom
? vec3(fragCoord + vec2(0.0, -1.0), bottomPixelDepth)
: vec3(fragCoord + vec2(0.0, 1.0), topPixelDepth);
vec3 verticalPixelPos = reconstructPosition(fragCoordHorizontal.xy, fragCoordHorizontal.z);
vec3 horizontalPixelPos = reconstructPosition(fragCoordVertical.xy, fragCoordVertical.z);
vec3 normal = normalize(cross(verticalPixelPos - pixelPos, horizontalPixelPos - pixelPos));
return pickLeft == pickBottom ? normal : -normal;
}`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/ReadShadowMapConfiguration":function(){define(["exports","../../../../chunks/tslib.es6","../core/shaderTechnique/ShaderTechniqueConfiguration"],function(a,b,n){class k extends n.ShaderTechniqueConfiguration{constructor(){super(...arguments);this.receiveShadows=!0}}b.__decorate([n.parameter()],k.prototype,"receiveShadows",void 0);a.ReadShadowMapConfiguration=k;Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/views/3d/webgl-engine/effects/magnifier/Magnifier":function(){define("exports ../../../../../chunks/tslib.es6 ../../../../../core/asyncUtils ../../../../../core/mathUtils ../../../../../core/maybe ../../../../../core/reactiveUtils ../../../../../core/screenUtils ../../../../../core/urlUtils ../../../../../core/accessorSupport/decorators/property ../../../../../core/has ../../../../../core/Logger ../../../../../core/RandomLCG ../../../../../core/accessorSupport/decorators/subclass ../../../../../support/requestImageUtils ../../../webgl ../../../webgl/RenderNode ./MagnifierTechnique ../../lib/basicInterfaces ../../lib/DefaultVertexAttributeLocations ../../lib/glUtil3D ../../../../../chunks/Magnifier.glsl ../../../../magnifier/resources ../../../../webgl/enums ../../../../webgl/Texture ../../../../webgl/TextureDescriptor".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w,x,u,t,m,q,r,v,y,B,z,A,C){a.Magnifier=class extends t{constructor(H){super(H);this.produces=u.InternalRenderCategory.MAGNIFIER;this.consumes={required:[u.InternalRenderCategory.MAGNIFIER]};this._imageLoadTask=this._imageSources=null;this._passParameters=new y.MagnifierPassParameters;this._magnifier=this._vao=null;this._tmpScreenPoint=e.createScreenPointArray();this._tmpRenderPoint=e.createRenderScreenPointArray()}initialize(){this.addHandles([h.watch(()=>this.view.magnifier,
H=>this._update(H),h.syncAndInitial)])}_update(H){H!==this._magnifier&&(this.removeAllHandles(),this._magnifier=H,H=()=>{const E=this._validMagnifier;E?(this._loadResources(E),this.produces=u.InternalRenderCategory.MAGNIFIER):this.produces="disabled";this.requestRender()},this._magnifier&&this.addHandles(h.watch(()=>this._magnifier?.version,H)),H())}get _validMagnifier(){return this._magnifier?.visible&&this._magnifier?.position&&0<this._magnifier?.size?this._magnifier:null}get _factor(){return this._magnifier?.factor||
1}destroy(){this._magnifier=null;null!=this._imageLoadTask&&(this._imageLoadTask.task.abort(),this._imageLoadTask=null);this._disposeTextures();this._vao=p.disposeMaybe(this._vao)}_disposeTextures(){this._passParameters.mask=p.disposeMaybe(this._passParameters.mask);this._passParameters.overlay=p.disposeMaybe(this._passParameters.overlay);this._passParameters.input=p.disposeMaybe(this._passParameters.input)}precompile(){this._imageSources&&this.techniques.precompile(m.MagnifierTechnique)}render(H){const E=
this._validMagnifier;H=H.find(({name:O})=>O===u.InternalRenderCategory.MAGNIFIER);if(null==E)return H;if(null==this._imageSources)return this.requestRender(q.RenderRequestType.UPDATE),H;const F=this.renderingContext;var G=Math.ceil(this.camera.pixelRatio*E.size);this._vao??(this._vao=v.createQuadVAO(F,v.Layout.Pos2,r.Default3D,0,1));const D=this.techniques.acquire(m.MagnifierTechnique);this._ensureTextureResources(F,G);if(!D.compiled||!this._passParameters.input)return D.release(),this.requestRender(q.RenderRequestType.UPDATE),
H;G=Math.ceil(1/this._factor*G);const I=this._passParameters.input;I.resize(G,G);e.screenPointObjectToArray(E.position,this._tmpScreenPoint);var J=this.camera.screenToRender(this._tmpScreenPoint,this._tmpRenderPoint),N=this.camera.fullHeight;const M=.5*G,Q=.5*G;J[0]=k.clamp(J[0],M,this.camera.fullWidth-M-1);J[1]=k.clamp(J[1],Q,N-Q-1);N=Math.floor(J[0]-M);J=Math.floor(J[1]-Q);F.bindFramebuffer(H.fbo);D.program.bindTexture("textureInput",I);F.gl.copyTexImage2D(I.descriptor.target,0,I.descriptor.pixelFormat,
N,J,G,G,0);this._passParameters.magnifier=E;F.bindTechnique(D,this.bindParameters,this._passParameters);F.bindVAO(this._vao);F.drawArrays(z.PrimitiveType.TRIANGLE_STRIP,0,4);D.release();return H}_loadResources(H){const {maskUrl:E,overlayUrl:F}=H;if(this._imageLoadTask?.maskUrl!==E||this._imageLoadTask?.overlayUrl!==F)this._imageLoadTask?.task.abort(),this._imageLoadTask=this._imageSources=null;this._imageSources||this._imageLoadTask||(this._imageLoadTask={maskUrl:E,overlayUrl:F,task:n.createTask(async G=>
{const D=null==E||null==F?B.loadMagnifierResources(G):null,I=null!=E?x.requestImage(E,{signal:G}):D.then(J=>J.mask);G=null!=F?x.requestImage(F,{signal:G}):D.then(J=>J.overlay);this._imageSources={mask:await I,overlay:await G}})})}_ensureTextureResources(H,E){null==this._imageSources||this._passParameters.size===E&&this._passParameters.input&&this._passParameters.mask&&this._passParameters.overlay||(this._disposeTextures(),this._imageSources.overlay.width=this._imageSources.mask.width=E,this._imageSources.overlay.height=
this._imageSources.mask.height=E,E=new C.TextureDescriptor,E.internalFormat=z.PixelFormat.RGBA,E.wrapMode=z.TextureWrapMode.CLAMP_TO_EDGE,E.flipped=!0,E.preMultiplyAlpha=!g.isSVG(this._imageSources.overlay.src)||!H.driverTest.svgPremultipliesAlpha.result,this._passParameters.overlay=new A.Texture(H,E,this._imageSources.overlay),E.pixelFormat=E.internalFormat=z.PixelFormat.ALPHA,E.preMultiplyAlpha=!1,this._passParameters.mask=new A.Texture(H,E,this._imageSources.mask),E.pixelFormat=E.internalFormat=
z.PixelFormat.RGBA,E.flipped=!1,this._passParameters.input=new A.Texture(H,E))}};b.__decorate([d.property()],a.Magnifier.prototype,"produces",void 0);b.__decorate([d.property()],a.Magnifier.prototype,"consumes",void 0);b.__decorate([d.property()],a.Magnifier.prototype,"_imageSources",void 0);b.__decorate([d.property()],a.Magnifier.prototype,"_imageLoadTask",void 0);b.__decorate([d.property({constructOnly:!0})],a.Magnifier.prototype,"techniques",void 0);a.Magnifier=b.__decorate([w.subclass("esri.views.3d.webgl-engine.effects.magnifier.Magnifier")],
a.Magnifier);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/effects/magnifier/MagnifierTechnique":function(){define("require exports ../../core/shaderTechnique/ReloadableShaderModule ../../core/shaderTechnique/ShaderTechnique ../../../../../chunks/Magnifier.glsl ../../../../webgl/renderState".split(" "),function(a,b,n,k,p,h){class e extends k.ShaderTechnique{constructor(g,d,f){super(g,d,new n.ReloadableShaderModule(p.Magnifier,()=>new Promise((c,l)=>a(["../../shaders/Magnifier.glsl"],
c,l))),f)}initializePipeline(){return h.makePipelineState({blending:h.blendWithPremultipliedAlpha,depthTest:null,depthWrite:null,colorWrite:h.defaultColorWrite})}}b.MagnifierTechnique=e;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/Magnifier.glsl":function(){define("exports ../core/screenUtils ./vec42 ../core/libs/gl-matrix-2/factories/vec4f64 ../views/3d/webgl-engine/core/shaderModules/BooleanPassUniform ../views/3d/webgl-engine/core/shaderModules/Float4PassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,n,k,p,h,e,g,d,f){function c(){const t=new g.ShaderBuilder;t.attributes.add(f.VertexAttribute.POSITION,"vec2");t.vertex.uniforms.add(new h.Float4PassUniform("drawPosition",(m,q)=>{const r=q.camera.pixelRatio,v=m.magnifier.offset.x*r,y=m.magnifier.offset.y*r;b.screenPointObjectToArray(m.magnifier.position,w);const B=q.camera.screenToRender(w,x);m=Math.ceil(r*m.magnifier.size);const {fullWidth:z,fullHeight:A}=q.camera;return n.set(u,-1+(B[0]+v)/z*2,-1+(B[1]-y)/A*2,m/z*2,m/A*2)}));t.varyings.add("vUV",
"vec2");t.vertex.main.add(e.glsl`vUV = position;
gl_Position = vec4(drawPosition.xy + vec2(position - 0.5) * drawPosition.zw, 0.0, 1.0);`);t.fragment.uniforms.add(new d.Texture2DPassUniform("textureInput",m=>m.input));t.fragment.uniforms.add(new d.Texture2DPassUniform("textureMask",m=>m.mask));t.fragment.uniforms.add(new d.Texture2DPassUniform("textureOverlay",m=>m.overlay));t.fragment.uniforms.add(new p.BooleanPassUniform("maskEnabled",m=>m.magnifier.maskEnabled));t.fragment.uniforms.add(new p.BooleanPassUniform("overlayEnabled",m=>m.magnifier.overlayEnabled));
t.fragment.code.add(e.glsl`const float barrelFactor = 1.1;
vec2 barrel(vec2 uv) {
vec2 uvn = uv * 2.0 - 1.0;
if (uvn.x == 0.0 && uvn.y == 0.0) {
return vec2(0.5, 0.5);
}
float theta = atan(uvn.y, uvn.x);
float r = pow(length(uvn), barrelFactor);
return r * vec2(cos(theta), sin(theta)) * 0.5 + 0.5;
}`);t.fragment.main.add(e.glsl`float mask = maskEnabled ? texture(textureMask, vUV).a : 1.0;
vec4 inputColor = texture(textureInput, barrel(vUV)) * mask;
vec4 overlayColor = overlayEnabled ? texture(textureOverlay, vUV) : vec4(0);
fragColor = overlayColor + (1.0 - overlayColor.a) * inputColor;`);return t}class l extends e.NoParameters{constructor(){super(...arguments);this.input=this.overlay=this.mask=null;this.size=0}}const w=b.createScreenPointArray(),x=b.createRenderScreenPointArray(),u=k.create();k=Object.freeze(Object.defineProperty({__proto__:null,MagnifierPassParameters:l,build:c},Symbol.toStringTag,{value:"Module"}));a.Magnifier=k;a.MagnifierPassParameters=l;a.build=c})},"esri/views/magnifier/resources":function(){define(["require",
"exports","../../core/promiseUtils","../../support/requestImageUtils"],function(a,b,n,k){const p=h=>Object.freeze(Object.defineProperty({__proto__:null,default:h},Symbol.toStringTag,{value:"Module"}));b.loadMagnifierResources=async function(h){var e=new Promise((d,f)=>a(["./mask-svg"],c=>d(p(c)),f)),g=new Promise((d,f)=>a(["./overlay-svg"],c=>d(p(c)),f));e=k.requestImage((await e).default,{signal:h});g=k.requestImage((await g).default,{signal:h});g={mask:await e,overlay:await g};n.throwIfAborted(h);
return g};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/effects/smaa/SMAA":function(){define("require exports ../../../../../chunks/tslib.es6 ../../../../../core/maybe ../../../../../core/promiseUtils ../../../../../core/reactiveUtils ../../../../../core/accessorSupport/decorators/property ../../../../../core/has ../../../../../core/Logger ../../../../../core/RandomLCG ../../../../../core/accessorSupport/decorators/subclass ../../../../../support/requestImageUtils ../../../webgl ../../../webgl/formats ../../../webgl/RenderNode ./SMAABlendWeightsTechnique ./SMAABlurTechnique ./SMAAEdgeDetectTechnique ./SMAAPassParameters ../../lib/basicInterfaces ../../../../webgl/enums ../../../../webgl/Texture ../../../../webgl/TextureDescriptor".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w,x,u,t,m,q,r,v,y,B,z){function A(C,H,E,F){const G=new z.TextureDescriptor;G.pixelFormat=E;G.wrapMode=y.TextureWrapMode.CLAMP_TO_EDGE;G.width=F.width;G.height=F.height;G.samplingMode=H;return new B.Texture(C,G,F)}b.SMAA=class extends u{constructor(C){super(C);this.produces="disabled";this.consumes={required:[w.InternalRenderCategory.ANTIALIASING],optional:[w.RenderCategory.COMPOSITE]};this._searchTexture=this._areaTexture=null;this._smaaParameters=new r.SMAAPassParameters;
C.techniques.precompile(q.SMAAEdgeDetectTechnique);C.techniques.precompile(t.SMAABlendWeightsTechnique);C.techniques.precompile(m.SMAABlurTechnique)}initialize(){this.addHandles([h.watch(()=>this.isEnabled(),C=>C?this.enable():this.disable(),h.syncAndInitial)])}async enable(){this.produces=w.InternalRenderCategory.ANTIALIASING;if(!(this._abortController||this._areaTexture&&this._searchTexture)){this._abortController=new AbortController;var C=this._abortController.signal;try{const H=await new Promise((E,
F)=>a(["./SMAAData"],E,F));await this._loadTextures(H,C);this.requestRender(v.RenderRequestType.UPDATE)}catch{}this._abortController=null}}async _loadTextures(C,H){p.throwIfAborted(H);const [E,F]=await Promise.allSettled([l.requestImage(C.areaTexture,{signal:H}),l.requestImage(C.searchTexure,{signal:H})]);p.throwIfAborted(H);"fulfilled"===E.status&&"fulfilled"===F.status&&(C=this.renderingContext,this._areaTexture=A(C,y.TextureSamplingMode.LINEAR,y.PixelFormat.RGB,E.value),this._searchTexture=A(C,
y.TextureSamplingMode.NEAREST,y.PixelFormat.LUMINANCE,F.value))}disable(){this.produces="disabled"}destroy(){this._searchTexture=k.disposeMaybe(this._searchTexture);this._areaTexture=k.disposeMaybe(this._areaTexture)}render(C){const H=C.find(({name:M})=>M===w.InternalRenderCategory.ANTIALIASING);if(!this._areaTexture||!this._searchTexture)return this.requestRender(v.RenderRequestType.UPDATE),H;var E=this.techniques.acquire(q.SMAAEdgeDetectTechnique);const F=this.techniques.acquire(t.SMAABlendWeightsTechnique),
G=this.techniques.acquire(m.SMAABlurTechnique);if(!E.compiled||!F.compiled||!G.compiled)return E.release(),F.release(),G.release(),this.requestRender(v.RenderRequestType.UPDATE),H;var D=C.find(({name:M})=>M===w.RenderCategory.COMPOSITE);if(!D)return H;const I=D.fbo.width,J=D.fbo.height;C=this.renderingContext;C.setViewport(0,0,I,J);const N=this.fboCache.acquire(I,J,"smaa edges",x.ColorFormat.RG);C.bindFramebuffer(N.fbo);C.setClearColor(0,0,0,1);C.clear(y.FramebufferBit.COLOR);this._smaaParameters.color=
D.getTexture();D=this.bindParameters;C.bindTechnique(E,D,this._smaaParameters);C.screen.draw();E.release();E=this.fboCache.acquire(I,J,"smaa blend");C.bindFramebuffer(E.fbo);C.setClearColor(0,0,1,1);C.clear(y.FramebufferBit.COLOR);this._smaaParameters.inputTexture=N.getTexture();this._smaaParameters.areaTexture=this._areaTexture;this._smaaParameters.searchTexture=this._searchTexture;C.bindTechnique(F,D,this._smaaParameters);C.screen.draw();F.release();N.release();C.bindFramebuffer(H.fbo);C.setClearColor(0,
1,0,1);C.clear(y.FramebufferBit.COLOR);this._smaaParameters.inputTexture=E.getTexture();C.bindTechnique(G,D,this._smaaParameters);C.screen.draw();G.release();E.release();return H}};n.__decorate([e.property()],b.SMAA.prototype,"produces",void 0);n.__decorate([e.property()],b.SMAA.prototype,"consumes",void 0);n.__decorate([e.property({constructOnly:!0})],b.SMAA.prototype,"isEnabled",void 0);n.__decorate([e.property({constructOnly:!0})],b.SMAA.prototype,"techniques",void 0);n.__decorate([e.property()],
b.SMAA.prototype,"_abortController",void 0);b.SMAA=n.__decorate([c.subclass("esri.views.3d.webgl-engine.effects.smaa.SMAA")],b.SMAA);Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/effects/smaa/SMAABlendWeightsTechnique":function(){define("require exports ../../core/shaderTechnique/ReloadableShaderModule ../../core/shaderTechnique/ShaderTechnique ../../../../../chunks/BlendWeights.glsl ../../../../webgl/renderState".split(" "),function(a,b,n,k,p,h){class e extends k.ShaderTechnique{constructor(g,
d,f){super(g,d,new n.ReloadableShaderModule(p.BlendWeights,()=>new Promise((c,l)=>a(["../../shaders/BlendWeights.glsl"],c,l))),f)}initializePipeline(){return h.makePipelineState({colorWrite:h.defaultColorWrite})}}b.SMAABlendWeightsTechnique=e;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/BlendWeights.glsl":function(){define(["exports","../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass.glsl","../views/3d/webgl-engine/core/shaderModules/interfaces","../views/3d/webgl-engine/core/shaderModules/ShaderBuilder",
"../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform"],function(a,b,n,k,p){function h(){const g=new k.ShaderBuilder;g.include(b.ScreenSpacePass);g.fragment.uniforms.add(new p.Texture2DPassUniform("edgesTexture",d=>d.inputTexture),new p.Texture2DPassUniform("areaTexture",d=>d.areaTexture),new p.Texture2DPassUniform("searchTexture",d=>d.searchTexture));g.fragment.code.add(n.glsl`
    #define SMAA_AREATEX_PIXEL_SIZE (1.0 / vec2(160.0, 560.0))
    #define SMAA_AREATEX_SUBTEX_SIZE (1.0 / 7.0)

    vec4 sampleLevelZeroOffset(vec2 coord, vec2 offset, vec2 resolution) {
      return texture(edgesTexture, coord + offset.x * resolution);
    }

    float searchLength(vec2 e, float bias, float scale) {
      e.r = bias + e.r * scale;
      return 255.0 * texture(searchTexture, e).r;
    }

    float searchLeft(vec2 texcoord, float end, vec2 resolution) {
      vec2 e = vec2(0.0, 1.0);
      for (int i = 0; i < ${n.glsl.int(8)}; ++i) {
        e = texture(edgesTexture, texcoord).rg;
        texcoord -= vec2(2.0, 0.0) * resolution;
        if (! (texcoord.x > end && e.g > 0.8281 && e.r == 0.0)) break;
      }
      texcoord.x += 0.25 * resolution.x;
      texcoord.x += resolution.x;
      texcoord.x += 2.0 * resolution.x;
      texcoord.x -= resolution.x * searchLength(e, 0.0, 0.5);
      return texcoord.x;
    }

    float searchRight(vec2 texcoord, float end, vec2 resolution) {
      vec2 e = vec2(0.0, 1.0);
      for (int i = 0; i < ${n.glsl.int(8)}; ++i) {
        e = texture(edgesTexture, texcoord).rg;
        texcoord += vec2(2.0, 0.0) * resolution;
        if (! (texcoord.x < end && e.g > 0.8281 && e.r == 0.0)) break;
      }
      texcoord.x -= 0.25 * resolution.x;
      texcoord.x -= resolution.x;
      texcoord.x -= 2.0 * resolution.x;
      texcoord.x += resolution.x * searchLength(e, 0.5, 0.5);
      return texcoord.x;
    }

    float searchUp(vec2 texcoord, float end, vec2 resolution) {
      vec2 e = vec2(1.0, 0.0);
      for (int i = 0; i < ${n.glsl.int(8)}; ++i) {
        e = texture(edgesTexture, texcoord).rg;
        texcoord += vec2(0.0, 2.0) * resolution;
        if (! (texcoord.y > end && e.r > 0.8281 && e.g == 0.0)) break;
      }
      texcoord.y -= 0.25 * resolution.y;
      texcoord.y -= resolution.y;
      texcoord.y -= 2.0 * resolution.y;
      texcoord.y += resolution.y * searchLength(e.gr, 0.0, 0.5);
      return texcoord.y;
    }

    float searchDown(vec2 texcoord, float end, vec2 resolution) {
      vec2 e = vec2(1.0, 0.0);
      for (int i = 0; i < ${n.glsl.int(8)}; ++i) {
        e = texture(edgesTexture, texcoord).rg;
        texcoord -= vec2(0.0, 2.0) * resolution;
        if (! (texcoord.y < end && e.r > 0.8281 && e.g == 0.0)) break;
      }
      texcoord.y += 0.25 * resolution.y;
      texcoord.y += resolution.y;
      texcoord.y += 2.0 * resolution.y;
      texcoord.y -= resolution.y * searchLength(e.gr, 0.5, 0.5);
      return texcoord.y;
    }

    vec2 getArea(sampler2D areaTex, vec2 dist, float e1, float e2, float offset) {
      vec2 texcoord = float(${n.glsl.int(16)}) * round(4.0 * vec2(e1, e2)) + dist;
      texcoord = SMAA_AREATEX_PIXEL_SIZE * texcoord + (0.5 * SMAA_AREATEX_PIXEL_SIZE);
      texcoord.y += SMAA_AREATEX_SUBTEX_SIZE * offset;
      return texture(areaTex, texcoord).rg;
    }`);g.fragment.main.add(n.glsl`
    vec2 size = vec2(textureSize(edgesTexture, 0));
    vec2 resolution = 1.0 / size;
    vec2 pixelCoord = uv * size;
    vec4 offsets[2];
    offsets[0] = uv.xyxy + resolution.xyxy * vec4(-0.25, 0.125, 1.25, 0.125);
    offsets[1] = uv.xyxy + resolution.xyxy * vec4(-0.125, 0.25, -0.125, -1.25);
    vec4 maxOffset = vec4(offsets[0].xz, offsets[1].yw) + vec4(-2.0, 2.0, -2.0, 2.0) * resolution.xxyy * float(${n.glsl.int(8)});
    ivec4 subsampleIndices = ivec4(0.0);
    vec4 weights = vec4(0.0);
    vec2 e = texture(edgesTexture, uv).rg;
    if (e.r > 0.0) {
      vec2 d;
      vec2 coords;
      coords.y = searchUp(offsets[1].xy, maxOffset.z, resolution);
      coords.x = offsets[0].x;
      d.x = coords.y;
      float e1 = texture(edgesTexture, coords).g;
      coords.y = searchDown(offsets[1].zw, maxOffset.w, resolution);
      d.y = coords.y;
      d = d * size.y - pixelCoord.y;
      vec2 sqrt_d = sqrt(abs(d));
      coords.y -= 1.0 * resolution.y;
      float e2 = sampleLevelZeroOffset(coords, vec2(0.0, 1.0), resolution).g;
      weights.ba = getArea(areaTexture, sqrt_d, e1, e2, float(subsampleIndices.x));
      // for some reason the following lines are necessary to prevent
      // texture lookup precision issues on some Intel integrated graphics chips
      vec4 dbg = (offsets[0] + offsets[1] + maxOffset + coords.xyyx);
      weights.r += 0.00000001 * dot(vec4(0, 1, 0, 1), dbg);
    }
    if (e.g > 0.0) {
      vec2 d;
      vec2 coords;
      coords.x = searchLeft(offsets[0].xy, maxOffset.x, resolution);
      coords.y = offsets[1].y;
      d.x = coords.x;
      float e1 = texture(edgesTexture, coords).r;
      coords.x = searchRight(offsets[0].zw, maxOffset.y, resolution);
      d.y = coords.x;
      d = d * size.x - pixelCoord.x;
      vec2 sqrt_d = sqrt(abs(d));
      coords.y -= 1.0 * resolution.y;
      float e2 = sampleLevelZeroOffset(coords, vec2(1.0, 0.0), resolution).r;
      weights.rg = getArea(areaTexture, sqrt_d, e1, e2, float(subsampleIndices.y));
    }
    fragColor = weights;
  `);return g}const e=Object.freeze(Object.defineProperty({__proto__:null,build:h},Symbol.toStringTag,{value:"Module"}));a.BlendWeights=e;a.build=h})},"esri/views/3d/webgl-engine/effects/smaa/SMAABlurTechnique":function(){define("require exports ../../core/shaderTechnique/ReloadableShaderModule ../../core/shaderTechnique/ShaderTechnique ../../../../../chunks/Blur.glsl ../../../../webgl/renderState".split(" "),function(a,b,n,k,p,h){class e extends k.ShaderTechnique{constructor(g,d,f){super(g,d,new n.ReloadableShaderModule(p.Blur,
()=>new Promise((c,l)=>a(["../../shaders/Blur.glsl"],c,l))),f)}initializePipeline(){return h.makePipelineState({colorWrite:h.defaultColorWrite})}}b.SMAABlurTechnique=e;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/Blur.glsl":function(){define(["exports","../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass.glsl","../views/3d/webgl-engine/core/shaderModules/interfaces","../views/3d/webgl-engine/core/shaderModules/ShaderBuilder","../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform"],
function(a,b,n,k,p){function h(){const g=new k.ShaderBuilder;g.include(b.ScreenSpacePass);g.fragment.uniforms.add(new p.Texture2DPassUniform("blendWeightsTexture",d=>d.inputTexture),new p.Texture2DPassUniform("colorTexture",d=>d.color));g.fragment.main.add(n.glsl`vec2 resolution = 1.0 / vec2(textureSize(colorTexture, 0));
vec4 offsets = vec4(uv.x + resolution.x, uv.y, uv.x, uv.y - resolution.y);
vec4 a;
a.rb = texture(blendWeightsTexture, uv).rb;
a.g = texture(blendWeightsTexture, offsets.zw).g;
a.a = texture(blendWeightsTexture, offsets.xy).a;
if ( dot(a, vec4(1.0)) < 1e-5 ) {
fragColor = texture( colorTexture, uv, 0.0 );
} else {
vec2 offset;
offset.x = a.a > a.b ? a.a : -a.b;
offset.y = a.g > a.r ? -a.g : a.r;
if ( abs( offset.x ) > abs( offset.y )) {
offset.y = 0.0;
} else {
offset.x = 0.0;
}
vec4 C = texture( colorTexture, uv, 0.0 );
vec4 Cop = texture( colorTexture, uv + sign( offset ) * resolution.xy, 0.0 );
float s = abs( offset.x ) > abs( offset.y ) ? abs( offset.x ) : abs( offset.y );
fragColor = mix(C, Cop, s);
}`);return g}const e=Object.freeze(Object.defineProperty({__proto__:null,build:h},Symbol.toStringTag,{value:"Module"}));a.Blur=e;a.build=h})},"esri/views/3d/webgl-engine/effects/smaa/SMAAEdgeDetectTechnique":function(){define("require exports ../../core/shaderTechnique/ReloadableShaderModule ../../core/shaderTechnique/ShaderTechnique ../../../../../chunks/EdgeDetect.glsl ../../../../webgl/renderState".split(" "),function(a,b,n,k,p,h){class e extends k.ShaderTechnique{constructor(g,d,f){super(g,d,
new n.ReloadableShaderModule(p.EdgeDetect,()=>new Promise((c,l)=>a(["../../shaders/EdgeDetect.glsl"],c,l))),f)}initializePipeline(){return h.makePipelineState({colorWrite:h.defaultColorWrite})}}b.SMAAEdgeDetectTechnique=e;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/EdgeDetect.glsl":function(){define(["exports","../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass.glsl","../views/3d/webgl-engine/core/shaderModules/interfaces","../views/3d/webgl-engine/core/shaderModules/ShaderBuilder",
"../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform"],function(a,b,n,k,p){function h(){const g=new k.ShaderBuilder;g.include(b.ScreenSpacePass);g.outputs.add("fragEdges","vec2");g.fragment.code.add(n.glsl`float absMax3(vec3 v) {
vec3 t = abs(v);
return max(max(t.r, t.g), t.b);
}`);g.fragment.uniforms.add(new p.Texture2DPassUniform("colorTexture",d=>d.color)).main.add(n.glsl`
    vec2 resolution = 1.0 / vec2(textureSize(colorTexture, 0));
    vec4 offsets[3];
    offsets[0] = vec4(uv.x - resolution.x, uv.y, uv.x, uv.y + resolution.y);
    offsets[1] = vec4(uv.x + resolution.x, uv.y, uv.x, uv.y - resolution.y);
    offsets[2] = vec4(uv.x - 2.0 * resolution.x, uv.y, uv.x, uv.y + 2.0 * resolution.y);

    // Calculate color deltas:
    vec3 C = texture(colorTexture, uv).rgb;
    vec3 Cleft = texture(colorTexture, offsets[0].xy).rgb;
    vec3 Ctop = texture(colorTexture, offsets[0].zw).rgb;
    vec2 delta = vec2(absMax3(C - Cleft), absMax3(C - Ctop));
    vec2 edges = step(vec2(${n.glsl.float(.05)}), delta);

    // discard if there is no edge:
    if (dot(edges, vec2(1.0)) == 0.0) {
      fragEdges = vec2(0.0);
    }
    else {
      // Calculate right and bottom deltas:
      vec3 Cright = texture(colorTexture, offsets[1].xy).rgb;
      float horizontal = absMax3(C - Cright);

      vec3 Cbottom  = texture(colorTexture, offsets[1].zw).rgb;
      float vertical = absMax3(C - Cbottom);

      // Calculate the maximum delta in the direct neighborhood:
      float maxDelta = max(max(max(delta.x, delta.y), horizontal), vertical);

      // Calculate left-left and top-top deltas:
      vec3 Cleftleft  = texture(colorTexture, offsets[2].xy).rgb;
      horizontal = absMax3(C - Cleftleft);

      vec3 Ctoptop = texture(colorTexture, offsets[2].zw).rgb;
      vertical = absMax3(C - Ctoptop);

      // Calculate the final maximum delta:
      maxDelta = max(max(maxDelta, horizontal), vertical);

      // Local contrast adaptation in action:
      fragEdges = edges * step(maxDelta, float(${n.glsl.float(2)}) * delta);
    }
  `);return g}const e=Object.freeze(Object.defineProperty({__proto__:null,build:h},Symbol.toStringTag,{value:"Module"}));a.EdgeDetect=e;a.build=h})},"esri/views/3d/webgl-engine/effects/smaa/SMAAPassParameters":function(){define(["exports","../../core/shaderModules/interfaces"],function(a,b){class n extends b.NoParameters{}a.SMAAPassParameters=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/effects/stars/Stars":function(){define("exports ../../../../../chunks/tslib.es6 ../../../../../assets ../../../../../core/asyncUtils ../../../../../core/Error ../../../../../core/Logger ../../../../../core/maybe ../../../../../core/promiseUtils ../../../../../core/reactiveUtils ../../../../../core/has ../../../../../core/RandomLCG ../../../../../core/accessorSupport/decorators/subclass ../../../../../core/libs/gl-matrix-2/math/mat4 ../../../../../core/libs/gl-matrix-2/factories/mat4f64 ../../../webgl ../../../support/buffer/glUtil ../../../support/buffer/InterleavedLayout ../OpaqueEnvironment ./StarsTechnique ../../lib/basicInterfaces ../../lib/DefaultVertexAttributeLocations ../../lib/VertexArrayObject ../../lib/VertexAttribute ../../../../webgl/BufferObject ../../../../webgl/enums".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w,x,u,t,m,q,r,v,y,B,z,A,C){a.Stars=class extends q.OpaqueEnvironment{constructor(D){super(D);this._loadDataTask=this._starData=null;this._numPoints=0;this._passParameters=new r.StarPassParameters;D.techniques.precompile(r.StarsTechnique)}initialize(){this.addHandles([d.watch(()=>this.view.environment.starsEnabled,D=>D?this._enable():this._disable(),d.initial),d.watch(()=>"virtual"===this.view.environment.lighting.type?null:this.view.environment.lighting.date,D=>this._update(D),
d.syncAndInitial)])}_enable(){super._enable();this._loadDataTask=this._createLoadDataTask()}get loading(){return!!this._loadDataTask&&!this._loadDataTask.finished}destroy(){this._loadDataTask=e.abortMaybe(this._loadDataTask);this._numPoints=0;this._vao=e.disposeMaybe(this._vao);this._starData=null}render(D){D=D.find(({name:N})=>N===u.InternalRenderCategory.OPAQUE_ENVIRONMENT);const I=this.renderingContext;if(this.loading)return this.requestRender(v.RenderRequestType.UPDATE),D;if(!this._starData)return D;
this._vao??(this._vao=this._ensureResources(this._starData,I));const J=this.techniques.acquire(r.StarsTechnique);if(!J.compiled)return this.requestRender(v.RenderRequestType.UPDATE),J.release(),D;I.bindTechnique(J,this.bindParameters,this._passParameters);I.bindVAO(this._vao);I.drawArrays(C.PrimitiveType.POINTS,0,this._numPoints);J.release();return D}_ensureResources(D,I){this._numPoints=D.byteLength/9;const J=new Float32Array(D,0,2*this._numPoints);D=new Uint8Array(D,8*this._numPoints,this._numPoints);
var N=this._numPoints;const M=G.createBuffer(N),Q=M.position,O=M.color,K=M.size;for(let R=0;R<N;R++){var L=J[2*R],P=J[2*R+1];Q.set(R,0,-Math.cos(L)*Math.sin(P));Q.set(R,1,-Math.sin(L)*Math.sin(P));Q.set(R,2,-Math.cos(P));L=D[R];L=192<=L?[2.9,L-192]:160<=L?[2.5,L-160]:128<=L?[2,L-128]:96<=L?[1.5,L-96]:64<=L?[1,L-64]:32<=L?[.7,L-32]:[.4,L];P=H[L[1]];P=[parseInt(P.slice(0,2),16),parseInt(P.slice(2,4),16),parseInt(P.slice(4,6),16)];O.set(R,0,255*P[0]);O.set(R,1,255*P[1]);O.set(R,2,255*P[2]);O.set(R,3,
255);K.set(R,L[0])}return new B.VertexArrayObject(I,y.Default3D,new Map([["geometry",t.glLayout(G)]]),new Map([["geometry",A.BufferObject.createVertex(I,C.Usage.STATIC_DRAW,M.buffer)]]))}_update(D){if(D){var I=D.getHours()/12,J=D.getMinutes()/60*(2/24),N=D.getSeconds()/60*(2/1440);I=(I+J+N-.9972222)%2;J=new Date(D.getFullYear(),0,1,11,58,56);N=new Date(D.getFullYear()+1,0,1,11,58,55);D=(+D-+J)/(+N-+J)*2;J=w.copy(this._passParameters.modelMatrix,F);w.rotateZ(J,J,-D*Math.PI);w.multiply(J,E,J);w.rotateZ(J,
J,-I*Math.PI);this.requestRender(v.RenderRequestType.UPDATE)}}_createLoadDataTask(){if(this._starData)return null;const D=k.createTask(async I=>{({data:I}=await n.fetchAsset("esri/views/3d/environment/resources/stars.wsv",{responseType:"array-buffer",signal:I}));if(!I)throw new p("stars:no-data-received","Failed to create stars because star catalogue is missing");const J=I.byteLength/9;if(0!==J%1||5E4<J||5E3>J)throw new p("stars:invalid-data","Failed to create stars because star catalogue data is invalid");
this._starData=I});D.promise.catch(I=>{g.isAbortError(I)||h.getLogger(this).error(I)}).then(()=>{this.destroyed||this.requestRender(v.RenderRequestType.UPDATE)});return D}};a.Stars=b.__decorate([l.subclass("esri.views.3d.webgl-engine.effects.stars.Stars")],a.Stars);const H="9bb2ff;9eb5ff;aabfff;bbccff;ccd8ff ;dae2ff;e4e9ff;eeefff;f8f6ff;fff9fb;fff5ef;fff1e5;ffeddb;ffe9d2;ffe6ca;ffe3c3;ffe0bb;ffddb4;ffdaad;ffd6a5;ffd29c;ffcc8f;ffc178;ffa94b;ff7b00".split(";"),E=x.fromValues(1,0,0,0,0,.9174771405229186,
.39778850739794974,0,0,-.39778850739794974,.9174771405229186,0,0,0,0,1),F=x.fromValues(1,0,0,0,0,.9174771405229186,-.39778850739794974,0,0,.39778850739794974,.9174771405229186,0,0,0,0,1),G=m.newLayout().vec3f(z.VertexAttribute.POSITION).vec4u8(z.VertexAttribute.COLOR).f32(z.VertexAttribute.SIZE);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/effects/stars/StarsTechnique":function(){define("require exports ../../../../../core/libs/gl-matrix-2/factories/mat4f64 ../../core/shaderModules/interfaces ../../core/shaderTechnique/ReloadableShaderModule ../../core/shaderTechnique/ShaderTechnique ../../../../../chunks/Stars.glsl ../../../../webgl/enums ../../../../webgl/renderState".split(" "),
function(a,b,n,k,p,h,e,g,d){class f extends k.NoParameters{constructor(){super(...arguments);this.modelMatrix=n.create()}}class c extends h.ShaderTechnique{constructor(l,w,x){super(l,w,new p.ReloadableShaderModule(e.Stars,()=>new Promise((u,t)=>a(["./Stars.glsl"],u,t))),x)}initializePipeline(){return d.makePipelineState({blending:d.premultipliedAlphaToPremultipliedAlpha,depthTest:{func:g.CompareFunction.LEQUAL},colorWrite:d.defaultColorWrite})}}b.StarPassParameters=f;b.StarsTechnique=c;Object.defineProperty(b,
Symbol.toStringTag,{value:"Module"})})},"esri/chunks/Stars.glsl":function(){define("exports ../core/libs/gl-matrix-2/math/mat4 ../core/libs/gl-matrix-2/factories/mat4f64 ../views/3d/webgl-engine/core/shaderModules/Float4PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/Matrix4PassUniform ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,n,k,p,h,e,g,d){function f(){const l=new g.ShaderBuilder;l.attributes.add(d.VertexAttribute.POSITION,"vec3");l.attributes.add(d.VertexAttribute.COLOR,"vec4");l.attributes.add(d.VertexAttribute.SIZE,"float");l.varyings.add("vcolor","vec4");l.varyings.add("vsize","float");l.vertex.uniforms.add(new e.Matrix4PassUniform("transform",(w,x)=>{b.copy(c,x.camera.projectionMatrix);c[10]=2.4E-7-1;c[11]=-1;c[14]=(2.4E-7-2)*x.camera.near;b.multiply(c,c,x.camera.viewMatrix);return b.multiply(c,c,w.modelMatrix)}),
new k.Float4PassUniform("viewport",(w,x)=>x.camera.fullViewport),new p.FloatPassUniform("pixelRatio",(w,x)=>x.camera.pixelRatio));l.vertex.main.add(h.glsl`gl_Position = transform * vec4(position, 0);
vcolor = color / 1.2;
vsize = size * 5.0 * pixelRatio;
gl_PointSize = vsize;`);l.fragment.main.add(h.glsl`float cap = 0.7;
float scale = 1.0 / cap;
float helper = clamp(length(abs(gl_PointCoord - vec2(0.5))), 0.0, cap);
float alpha = clamp((cap - helper) * scale, 0.0, 1.0);
float intensity = alpha * alpha * alpha;
if (vsize < 3.0) {
intensity *= 0.5;
}
fragColor = vec4(vcolor.xyz, intensity);`);return l}const c=n.create();n=Object.freeze(Object.defineProperty({__proto__:null,build:f},Symbol.toStringTag,{value:"Module"}));a.Stars=n;a.build=f})},"esri/views/3d/webgl-engine/lib/CompositingHelper":function(){define(["../../../../chunks/Compositing.glsl","../shaders/CompositingTechnique","../shaders/CompositingTechniqueConfiguration","../../../../chunks/HUDCompositing.glsl","../shaders/HUDCompositingTechnique"],function(a,b,n,k,p){class h{constructor(e,
g){this._rctx=e;this._techniques=g;this._configuration=new n.CompositingTechniqueConfiguration;this._passParameters=new a.CompositingPassParameters;this._hudParameters=new k.HUDCompositingPassParameters;this._configuration.blitMode=n.BlitMode.PremultipliedAlpha;this._techniques.precompile(b.CompositingTechnique,this._configuration);this._configuration.hasOpacityFactor=!0;this._techniques.precompile(b.CompositingTechnique,this._configuration);this._configuration.hasOpacityFactor=!1;this._configuration.blitMode=
n.BlitMode.Alpha;this._techniques.precompile(b.CompositingTechnique,this._configuration);this._configuration.blitMode=n.BlitMode.Depth;this._techniques.precompile(b.CompositingTechnique,this._configuration);this._techniques.precompile(p.HUDCompositingTechnique)}compositeHUD(e,g){this._hudParameters.texture=g;g=this._techniques.acquire(p.HUDCompositingTechnique);this._rctx.bindTechnique(g,e,this._hudParameters);this._rctx.screen.draw();g.release()}compositePreMultipliedAlpha(e,g,d=1){this._composite(e,
g,n.BlitMode.PremultipliedAlpha,d)}composite(e,g){this._composite(e,g,n.BlitMode.Alpha,1)}blitDepthToLinearDepth(e,g){this._composite(e,g,n.BlitMode.Depth,1)}_composite(e,g,d,f){this._configuration.blitMode=d;this._configuration.hasOpacityFactor=1!==f;this._passParameters.texture=g;this._passParameters.opacity=f;g=this._techniques.acquire(b.CompositingTechnique,this._configuration);this._rctx.bindTechnique(g,e,this._passParameters);this._rctx.screen.draw();g.release()}}return h})},"esri/chunks/HUDCompositing.glsl":function(){define(["exports",
"../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass.glsl","../views/3d/webgl-engine/core/shaderModules/interfaces","../views/3d/webgl-engine/core/shaderModules/ShaderBuilder","../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform"],function(a,b,n,k,p){function h(){const d=new k.ShaderBuilder;d.include(b.ScreenSpacePass);d.fragment.uniforms.add(new p.Texture2DPassUniform("tex",f=>f.texture));d.fragment.main.add(n.glsl`fragColor = vec4(1.0 - texture(tex, uv).a);`);return d}class e extends n.NoParameters{}
const g=Object.freeze(Object.defineProperty({__proto__:null,HUDCompositingPassParameters:e,build:h},Symbol.toStringTag,{value:"Module"}));a.HUDCompositing=g;a.HUDCompositingPassParameters=e;a.build=h})},"esri/views/3d/webgl-engine/shaders/HUDCompositingTechnique":function(){define("require exports ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../../../../chunks/HUDCompositing.glsl ../../../webgl/renderState".split(" "),function(a,b,n,k,p,h){class e extends k.ShaderTechnique{constructor(g,
d,f){super(g,d,new n.ReloadableShaderModule(p.HUDCompositing,()=>new Promise((c,l)=>a(["./HUDCompositing.glsl"],c,l))),f)}initializePipeline(){return h.makePipelineState({colorWrite:{r:!1,g:!0,b:!1,a:!1}})}}b.HUDCompositingTechnique=e;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/ObjectAndLayerIdRenderHelper":function(){define(["exports","../../../../core/has","../../../../core/NestedMap","../../../../core/libs/gl-matrix-2/factories/vec4f64","../../../../geometry/support/buffer/BufferView"],
function(a,b,n,k,p){class h{constructor(){this.declaredClass="esri.views.3d.webgl-engine.lib.ObjectAndLayerIdRenderHelper";this.colorZero=new p.BufferViewVec4u8(new ArrayBuffer(4));this._layerToOidToColor=new n.NestedMap;this._colorToUID=new Map;this._layerUidToGraphicsUidToObjectId=new n.NestedMap;this._layerUidToId=new Map;this._layerUidToPopupEnabled=new Map}setUidToObjectAndLayerId(e,g,d,f,c,l=null,w=null,x=null){e&&g&&d&&f&&(this._layerUidToId.set(f,d),this._layerUidToPopupEnabled.set(f,c),c&&
this._layerUidToGraphicsUidToObjectId.set(f,g,{objectId:e,attributeNodeId:l,attributeIndex:w,subLayerId:x}))}getObjectAndLayerIdColor(e){e=this.getObjectAndLayerIdColorArray(e);return k.fromValues(e.get(0,1),e.get(0,2),e.get(0,3),255)}getObjectAndLayerIdColorArray(e){if(!e.layerUid||!e.graphicUid)return this.colorZero;var g=this._layerUidToPopupEnabled.get(e.layerUid);if(void 0===g||!1===g)return this.colorZero;const d=this._layerUidToGraphicsUidToObjectId.get(e.layerUid,e.graphicUid)?.objectId;if(!d)return this.colorZero;
g=this._layerToOidToColor.get(e.layerUid,d);if(!g){if(b("enable-feature:objectAndLayerId-screenshot-testing"))g=d;else for(;!g;){const f=Math.floor(16777214*Math.random())+1;this._colorToUID.has(f)||(g=f)}if(16777215<g)throw Error("Object ID Overflow");this._layerToOidToColor.set(e.layerUid,d,g);this._colorToUID.set(g,e)}e=new ArrayBuffer(4);(new DataView(e)).setUint32(0,g,!1);return new p.BufferViewVec4u8(e)}getColorToObjectAndLayerIdMapping(){const e=new Map;for(const [g,d]of this._colorToUID.entries()){const f=
this._layerUidToGraphicsUidToObjectId.get(d.layerUid,d.graphicUid),c=this._layerUidToId.get(d.layerUid);f&&c&&e.set(g,f.attributeNodeId?{type:"object-and-layer-and-i3s-id",olid:f.objectId,lid:c,attrId:f.attributeNodeId,attrIdx:f.attributeIndex,subLayerId:f.subLayerId}:{type:"object-and-layer-id",olid:f.objectId,lid:c})}return e}}a.ObjectAndLayerIdRenderHelper=h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/Renderer":function(){define("require exports ../../../../chunks/tslib.es6 ../../../../core/arrayUtils ../../../../core/asyncUtils ../../../../core/colorUtils ../../../../core/has ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/reactiveUtils ../../../../core/signal ../../../../core/accessorSupport/decorators/property ../../../../core/Logger ../../../../core/accessorSupport/interfaces ../../../../core/accessorSupport/tracking/Flags ../../../../core/Warning ../../../../core/Error ../../../../core/libs/gl-matrix-2/math/mat4 ../../../../core/libs/gl-matrix-2/factories/mat4f64 ../../../../chunks/vec42 ../../../../core/libs/gl-matrix-2/factories/vec4f64 ../../webgl ../../support/debugFlags ../../webgl/formats ../core/FBOCache ../core/renderPasses/RenderPassManager ../core/shaderLibrary/ShaderOutput ../core/shaderLibrary/hud/HUDRenderStyle ../core/shaderLibrary/shading/ScreenSpaceConstants ../effects/RenderNodes ../effects/RenderPlugin ../effects/RenderPluginManager ../effects/blit/Blit ../effects/highlight/Highlight ../effects/transparency/OITBlend ./AnimationTimer ./AnimationTimeStep ./basicInterfaces ./BoundingInfo ./depthRange ./depthRangeUtils ./MainFramebuffer ./Material ./OITPass ./RenderContext ./rendererUtils ./RenderFeature ./RenderPluginInput ./RenderSlot ./ShadowAccumulator ./ShadowMap ./SliceHelper ./edgeRendering/interfaces ../materials/renderers/MergedRenderer ../parts/renderUtils ../statistics/RendererPerformanceInfo ../../../support/RenderState ../../../webgl/enums".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w,x,u,t,m,q,r,v,y,B,z,A,C,H,E,F,G,D,I,J,N,M,Q,O,K,L,P,R,W,V,ba,U,da,fa,ha,T,S,Z,ia,Y,ea,ka,ja,X,aa,pa){function la(Aa){return Ja=>Aa.immediate.schedule(Ja)}class na{constructor(Aa,Ja,Sa,$a,Wa,Ta){this._stage=Aa;this._techniques=Sa;this._rctx=$a;this._compositingHelper=Wa;this._requestRender=Ta;this._pluginsHas={hudElements:!1,water:!1};this._renderers=new Map;this.renderPassManager=new H.RenderPassManager;this._inGlobeView=this._isRendering=!1;this._backgroundColor=
y.fromValues(0,0,0,1);this._sliceHelper=new Y;this._oitblend=this._blit=null;this._state=c.signal(aa.RenderState.IDLE);this._highQualityTransparencyEnabled=!0;this._hasAnimations=this._ssrEnabled=!1;this._animationTimestep=new K.AnimationTimeStep;this._loadEdgeViewTask=null;this._edgeViewCallbacks=[];this._reprojectionMatrixVersion=c.signal(0);this._renderHiddenTransparentEdges=()=>{};this._pluginInput=new T.RenderPluginInput;this._releaseNormals=Da=>{Da.some(({name:La})=>"normals"===La)&&this._pluginInput.release("normals")};
this._debugNeedsDepth=!1;this.fboCache=new C.FBOCache($a);this._renderStateFeatures=c.signal(ha.setupFeatureDefaults(!e("disable-feature:high-quality-idle"),Aa.view.qualityProfile));this._framebuffer=new V.MainFramebuffer(this.fboCache);this.performanceInfo=new X.RendererPerformanceInfo(this._rctx);this._shadowMap=new ia.ShadowMap(this.fboCache,Aa.viewingMode);this._shadowAccumulator=new Z.ShadowAccumulator(this.fboCache,Sa,Aa,Da=>{const La=this.shadowsEnabled;this._shadowMap.enabled=!0;this._ensureBindParametersCamera(Da.camera,
Da.contentCamera);this._plugins.prepareRender();this._shadowMap.enabled=La},(Da,La,Va)=>{Da.shadowMap.start(Da.camera,La,Va,!0,this._stage.view.qualitySettings.maximumPixelRatio);this._renderShadowCascades(E.ShaderOutput.Shadow,Da.shadowMap);Da.shadowMap.finish();Da.camera.setGLViewport(this._rctx);this._ensureBindParametersCamera(Da.camera,Da.contentCamera)},Ta);this._renderContext=new da.RenderContext(this._rctx,this._shadowMap,Sa);this._nodes=new D.RenderNodes(this._renderContext);this._plugins=
new J.RenderPluginManager({renderContext:this._renderContext,techniques:Sa,materials:Ja,requestRender:Ta,controller:Aa,fbos:this.fboCache,isFeatureEnabled:Da=>this.isFeatureEnabled(Da)});this._plugins.add(this.renderPassManager);this._handles=[f.watch(()=>this._stage.view.state.camera,()=>Ta(),f.syncAndInitial),f.watch(()=>z.debugFlags.EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES,Da=>{this._renderHiddenTransparentEdges=Da?()=>this._renderEdges(ea.Transparency.TRANSPARENT):()=>{};Ta()},f.initial),f.watch(()=>
this._stage.view.environment.background?.color,Da=>{Da=Da?h.unitRGBAFromColor(Da):y.ZEROS;v.set(this._backgroundColor,Da[0]*Da[3],Da[1]*Da[3],Da[2]*Da[3],Da[3]);Ta()},f.syncAndInitial),f.watch(()=>this._stage.view.state.camera.relativeElevation,Da=>this._inGlobeView=(Da??Infinity)>=G.distanceFadeEnd,f.syncAndInitial),f.watch(()=>this._bindParameters.clouds.fadeFactor,()=>this._bindParameters.fadeLighting(),f.sync),f.watch(()=>this._bindParameters.clouds.data?.state,()=>this._requestRender(L.RenderRequestType.UPDATE),
f.sync)]}destroy(){this._handles.forEach(Aa=>Aa.remove());this._gpuTimerHandle=g.removeMaybe(this._gpuTimerHandle);this._nodes.destroy();this._framebuffer.dispose();this._shadowMap.dispose();this._shadowAccumulator.dispose();this._loadEdgeViewTask=g.abortMaybe(this._loadEdgeViewTask);this._edgeView=g.destroyMaybe(this._edgeView);this.renderPassManager.dispose();this._releaseFBOs();this._disposeOffscreenBuffers();this.fboCache.destroy();this._plugins.destroy();this._renderers.clear();this._oitblend=
this._blit=null;P.BoundingInfo.prune()}get renderContext(){return this._renderContext}get _bindParameters(){return this._renderContext.bind}get _framebufferSize(){return this._framebuffer.size}updateRenderFeatures(Aa=null,Ja=!e("disable-feature:high-quality-idle")){this._renderStateFeatures.value=ha.setupFeatureDefaults(Ja,Aa);this._plugins.renderFeatureChanged();this._requestRender()}isFeatureEnabled(Aa,Ja=this._state.value){return this._renderStateFeatures.value.get(Ja,Aa)??!1}setFeatureEnabled(Aa,
Ja,Sa){this._renderStateFeatures.mutate($a=>$a.set(Ja,Aa,Sa));this._requestRender()}get _highQualityTransparency(){return this._highQualityTransparencyEnabled||this.isFeatureEnabled(ha.RenderFeature.HighQualityTransparency)}get hasReflections(){return this._pluginsHas.water&&(this._ssrEnabled||this.isFeatureEnabled(ha.RenderFeature.WaterReflection))}get hasHighlights(){return this._plugins.produces(E.ShaderOutput.Highlight,S.RenderSlot.OPAQUE_MATERIAL,S.RenderSlot.TRANSPARENT_MATERIAL,S.RenderSlot.DRAPED_MATERIAL,
S.RenderSlot.HUD_MATERIAL,S.RenderSlot.LABEL_MATERIAL)}get hasHighlightsOnHUD(){return this._plugins.produces(E.ShaderOutput.Highlight,S.RenderSlot.HUD_MATERIAL,S.RenderSlot.LABEL_MATERIAL)}get hasSSAO(){return(this._stage.view.qualitySettings.ambientOcclusion||this.isFeatureEnabled(ha.RenderFeature.SSAO))&&!this._inGlobeView}get hasSMAA(){return this._stage.view.qualitySettings.antialiasingEnabled||this.isFeatureEnabled(ha.RenderFeature.Antialiasing)}get fullResolutionAtmosphere(){return this._stage.view.qualitySettings.highResolutionAtmosphere||
this.isFeatureEnabled(ha.RenderFeature.HighResolutionAtmosphere)}_releaseFBOs(){this._bindParameters.ssr.lastFrameColor=g.releaseMaybe(this._bindParameters.ssr.lastFrameColor);this._bindParameters.terrainDepth=g.releaseMaybe(this._bindParameters.terrainDepth);this._bindParameters.geometryDepth=g.releaseMaybe(this._bindParameters.geometryDepth)}_disposeOffscreenBuffers(){this._framebuffer.dispose();this._disposeBindBuffers()}_disposeBindBuffers(){this._shadowMap.disposeOffscreenBuffers();this._bindParameters.depth=
g.releaseMaybe(this._bindParameters.depth);this._bindParameters.hudVisibility=g.releaseMaybe(this._bindParameters.hudVisibility)}get updating(){return null!=this._edgeView&&this._edgeView.updating||this._shadowAccumulator.running||this._plugins.updating||!this.isCameraFinal}loadEdgeView(){if(this._loadEdgeViewTask)return this._loadEdgeViewTask.promise;this._loadEdgeViewTask=p.createTask(async Aa=>{const {EdgeView:Ja}=await new Promise(($a,Wa)=>a(["./edgeRendering/EdgeView"],$a,Wa));d.throwIfAborted(Aa);
const Sa=this._edgeView=new Ja({rctx:this._rctx,renderSR:this._stage.view.renderSpatialReference,viewingMode:this._stage.viewingMode,techniques:this._techniques,setNeedsRender:()=>this._requestRender(),schedule:la(this._stage.view.resourceController)});this._handles.push(f.watch(()=>Sa.updating,()=>this._requestRender(),f.sync));this._requestRender();this._edgeViewCallbacks.forEach($a=>$a(Sa));this._edgeViewCallbacks.length=0;return Sa});return this._loadEdgeViewTask.promise}withEdgeView(Aa){this.loadEdgeView();
null==this._edgeView?this._edgeViewCallbacks.push(Aa):Aa(this._edgeView)}get edgeView(){return this._edgeView}get isCameraFinal(){return 0<=this._reprojectionMatrixVersion.value&&q.equals(this._bindParameters.ssr.reprojectionMatrix,r.IDENTITY)}set _reprojectionMatrix(Aa){k.update(this._bindParameters.ssr.reprojectionMatrix,Aa)&&this._reprojectionMatrixVersion.value++}get shadowsEnabled(){return!!this._shadowMap?.enabled}setParameters(Aa){const {_shadowMap:Ja,_bindParameters:Sa}=this;void 0!==Aa.qualitySettings?.reflections&&
this._ssrEnabled!==Aa.qualitySettings.reflections&&(this._ssrEnabled=Aa.qualitySettings.reflections,this._requestRender());void 0!==Aa.shadowMap&&this._shadowMap.enabled!==Aa.shadowMap&&(this._shadowMap.enabled=Aa.shadowMap,this._requestRender());void 0!==Aa.shadowMapMaxCascades&&Ja.maxCascades!==Aa.shadowMapMaxCascades&&(Ja.maxCascades=Aa.shadowMapMaxCascades,this._requestRender());if(null!=Aa.environment){null!=Aa.environment.weather&&(this._bindParameters.weather=Aa.environment.weather,this._bindParameters.weatherVisible=
!!Aa.weatherVisible);const $a="virtual"!==Aa.environment.lighting.type;Sa.enableFillLights!==$a&&(Sa.enableFillLights=$a,this._requestRender())}void 0!==Aa.highQualityTransparency&&this._highQualityTransparencyEnabled!==Aa.highQualityTransparency&&(this._highQualityTransparencyEnabled=Aa.highQualityTransparency,this._requestRender());void 0!==Aa.shadowCast&&this._shadowAccumulator.setOptions(Aa.shadowCast)}set slicePlane(Aa){this._sliceHelper.plane!==Aa&&(this._sliceHelper.plane=Aa,this._requestRender())}get plugins(){return this._plugins}getMaterialRenderer(Aa){return this._renderers.get(Aa)}get _hasOITSupport(){return this._rctx.driverTest.floatBufferBlend.result}get _oitEnabled(){return this._highQualityTransparency&&
this._hasOITSupport}modify(Aa,Ja){this._isRendering&&console.warn("Renderer.modify called while rendering");const {adds:Sa,removes:$a,updates:Wa}=Aa;if(0!==Sa.length||0!==$a.length||0!==Wa.length)fa.splitRenderGeometryChangeSetByMaterial(Aa).forEach((Ta,Da)=>{if(!Ja.done){var La=this._renderers.get(Da);null==La&&0<Ta.adds.length&&(La=new ka.MergedRenderer({material:Da}),La.initializeRenderContext(this._plugins.context),this._plugins.add(La),this._renderers.set(Da,La));La&&(La.modify(Ta),0===La.numGeometries&&
(this._renderers.delete(La.material),this._plugins.remove(La),La.destroy()));Ta.removes.forEach(Va=>Aa.removes.removeUnordered(Va));Ta.adds.forEach(Va=>Aa.adds.removeUnordered(Va));Ta.updates.forEach(Va=>Aa.updates.removeUnordered(Va));Ja.madeProgress()}}),this.updateHasFlags()}updateHasFlags(){const Aa=this._pluginsHas;Aa.hudElements=this._plugins.produces(E.ShaderOutput.Color,S.RenderSlot.LINE_CALLOUTS_HUD_DEPTH,S.RenderSlot.HUD_MATERIAL,S.RenderSlot.LABEL_MATERIAL);Aa.water=this._plugins.produces(E.ShaderOutput.Normal,
S.RenderSlot.DRAPED_WATER);this._bindParameters.hasOccludees=this._plugins.hasOccludees;this._requestRender()}updateAnimation(Aa,Ja){this._animationTimer??(this._animationTimer=new O.AnimationTimer(Aa.camera,Ja));this._animationTimer.advance(Aa.camera,Ja,this._animationTimeDilation);null!=Aa.forcedAnimationTime&&this._animationTimer.forceTime(Aa.forcedAnimationTime);Aa=this._hasAnimations;this._hasAnimations=this._plugins.updateAnimation(this._animationTimer);this._hasAnimations=this._nodes.updateAnimation(this._animationTimer)||
this._hasAnimations;this._hasAnimations=this.overlay?.updateAnimation(this._animationTimer)||this._hasAnimations;this._hasAnimations!==Aa&&(this._gpuTimerHandle=Aa?g.removeMaybe(this._gpuTimerHandle):this.performanceInfo.enableGPUPerformanceInfo());return this._hasAnimations}get animationTimestep(){return this._animationTimestep.value}get _animationTimeDilation(){return this._animationTimestep.timeDilation}resetAnimation(){this._animationTimestep.clear()}tick(){this.fboCache.clean()}render(Aa,Ja,
Sa=fa.RendererTarget.Default,$a=!1){try{return this._isRendering=!0,this._render(Aa,Ja,Sa,$a)}catch(Wa){console.error(`Exception during rendering: ${Wa}`)}finally{this._isRendering=!1}return new ja.RenderSceneResult(this._pluginInput.get("final-color"),null)}_render(Aa,Ja,Sa=fa.RendererTarget.Default,$a){this.performanceInfo.startFrame();this.fboCache.frameStart();this.fboCache.interactive=Sa===fa.RendererTarget.Default;this._disposeBindBuffers();const Wa=this._framebuffer,{camera:Ta,contentCamera:Da,
mode:La,alignPixelEnabled:Va}=Aa;this._state.value=La;this._bindParameters.overlay=this.overlay?.render(Ja);this._bindParameters.overlay&&this.performanceInfo.advance(X.PerformanceCategory.OVERLAY);this._renderContext.time=Ja;this._bindParameters.oitPass=U.OITPass.NONE;this._bindParameters.alignPixelEnabled=Va;this._bindParameters.decorations=!$a;this._bindParameters.mainDepth=null;this._bindParameters.viewshedEnabled=this._nodes.produces(B.InternalRenderCategory.VIEWSHED);Aa=this._nodes.produces("magnifier-color");
const ma=this._nodes.produces("final-color");this._bindParameters.slicePlane=this._sliceHelper.plane;Ta.setGLViewport(this._rctx);var za=0<this._nodes.require("emissive")&&this._plugins.hasEmissions,Na=za?E.ShaderOutput.ColorEmission:E.ShaderOutput.Color;za=Wa.initialize(Ta.fullWidth,Ta.fullHeight,this._backgroundColor,za);this.hasReflections?(za?.setName("last frame color"),this._bindParameters.ssr.lastFrameColor=za):za?.release();this._ensureBindParametersCamera(Ta,Da);this._plugins.prepareRender();
this._bindParameters.shadowHighlightsVisible=this._needsShadowHighlight&&!$a;za=this._highQualityTransparency&&this._needsTransparentTerrain;const Ra=this._plugins.produces(E.ShaderOutput.Color,...Ba);this._precompilePrepasses();this.performanceInfo.advance(X.PerformanceCategory.PREPARE);var Pa=this._computeDepthRange(Ta);this._renderShadowMap(Ta,this._bindParameters.lighting.mainLight.direction,Pa);this._ensureBindParametersCamera(Ta,Da);this._pluginInput.set("normals",this._renderNormals());this._renderRemainingGeometryDepth();
this._renderShadowAccumulation(Pa,Ta,Da);this._ensureBindParametersSSR(Ja);this._precompileShaders(za,Ra,Na);this._renderContext.output=Na;Wa.bind();this._bindParameters.mainDepth=Wa.depth.attachment;const ca=this.plugins.produces(E.ShaderOutput.Color,...ta);ca&&this._renderOpaqueGeometry();Wa.update(cb=>this._renderNodes(B.RenderCategory.OPAQUE,cb,ca));this.fboCache.debugCallback?.("opaque-color",Wa.color.fbo);Wa.update(cb=>this._renderNodes(B.InternalRenderCategory.OPAQUE_ENVIRONMENT,cb));this.fboCache.debugCallback?.(B.InternalRenderCategory.OPAQUE_ENVIRONMENT,
Wa.color.fbo);this._renderTerrainDepth(za);this._setMultipassTerrain(za);this._renderEdges(ea.Transparency.OPAQUE);Wa.bind();this._renderPlugins(S.RenderSlot.VOXEL,X.PerformanceCategory.VOXEL);this._renderHiddenTransparentEdges();Ra&&(this._oitEnabled?this._renderOIT(qa.Geometry,Na):this._renderTransparentGeometry());Wa.update(cb=>this._renderNodes(B.RenderCategory.TRANSPARENT,cb,Ra));this.fboCache.debugCallback?.("transparent-color",Wa.color.fbo);this._renderGeometryDepth(za);this._renderHUDVisibility();
za||this._plugins.render(this._pluginInput,S.RenderSlot.LINE_CALLOUTS);Ja=Sa===fa.RendererTarget.ObjectAndLayerID?this._renderObjectAndLayerIdColor():null;this._renderEdges(ea.Transparency.TRANSPARENT);if(Pa=this._needsTransparentTerrain?this._renderTransparentTerrain():null)this.performanceInfo.advance(X.PerformanceCategory.TRANSPARENT_TERRAIN),this._bindParameters.hudVisibility&&(za?this._renderLineCallouts(F.HUDRenderStyle.Occluded):(this._rctx.bindFramebuffer(this._bindParameters.hudVisibility?.fbo),
this._compositingHelper.compositeHUD(this._bindParameters,Pa.getTexture())),this._renderHUD(F.HUDRenderStyle.Occluded,Wa.color,Na));this._cullAboveTerrain(!1);Pa&&(Wa.bind(),this._compositingHelper.compositePreMultipliedAlpha(this._bindParameters,Pa.getTexture()),Pa.release(),za&&(this._renderEdges(ea.Transparency.OPAQUE),Ra&&(this._oitEnabled?this._renderOIT(qa.Geometry,Na):this._renderTransparentGeometry(),this.performanceInfo.advance(X.PerformanceCategory.TRANSPARENT)),this._renderEdges(ea.Transparency.TRANSPARENT)));
this._bindParameters.ssao=g.releaseMaybe(this._bindParameters.ssao);za&&this._renderLineCallouts(F.HUDRenderStyle.NotOccluded);this._setTerrainDepthTest(!1);this._renderTransparentEnvironment();Wa.update(cb=>this._renderNodes(B.InternalRenderCategory.TRANSPARENT_ENVIRONMENT,cb));Wa.update(cb=>this._renderNodes(B.InternalRenderCategory.VIEWSHED,cb));Wa.update(cb=>this._renderNodes(B.InternalRenderCategory.LASERLINES,cb));Wa.update(cb=>this._renderNodes(B.InternalRenderCategory.OCCLUDED,cb));this._pluginInput.set("highlights",
this._renderHighlightPrepass());Wa.update(cb=>this._renderNodes(B.RenderCategory.COMPOSITE,cb));Pa=Sa===fa.RendererTarget.Default&&!ma&&!(Aa&&!$a&&Sa===fa.RendererTarget.Default);za=this._pluginInput.get(B.RenderCategory.COMPOSITE);Pa=Pa?C.defaultWebGLFBO:this.fboCache.acquire(za.fbo.width,za.fbo.height,B.InternalRenderCategory.ANTIALIASING);za=this._nodes.produces(B.InternalRenderCategory.ANTIALIASING)?this._renderNodes(B.InternalRenderCategory.ANTIALIASING,Pa):this._blitFBO(za,Pa,!1);this._pluginInput.set(B.InternalRenderCategory.ANTIALIASING,
za);this.hasHighlightsOnHUD?(this._renderHUD(F.HUDRenderStyle.NotOccluded,za,Na),za=this._renderNodes(B.InternalRenderCategory.HIGHLIGHTS,za)):(za=this._renderNodes(B.InternalRenderCategory.HIGHLIGHTS,za),this._renderHUD(F.HUDRenderStyle.NotOccluded,za,Na));Na=this._renderNodes(B.InternalRenderCategory.MAGNIFIER,za);!Aa||$a||Sa!==fa.RendererTarget.Default||ma||this._blitFBO(Na);ma?(Na.attachDepth(Wa.depth),this._blitFBO(this._renderNodes(B.RenderCategory.FINAL,Na)),Na.detachDepth()):this._pluginInput.set(B.RenderCategory.FINAL,
Na);this._pluginInput.release("highlights");if(this.onPostRender)this.onPostRender();this._releaseFBOs();Wa.releaseDepth();this._renderContext.lastFrameCamera.copyFrom(this._bindParameters.camera);this.fboCache.frameEnd();this.performanceInfo.finishFrame();Sa!==fa.RendererTarget.Default&&(this._releaseFBOs(),this._disposeOffscreenBuffers());return new ja.RenderSceneResult(this._pluginInput.get("final-color"),Ja)}_precompileShaders(Aa,Ja,Sa){++this._plugins.context.techniques.precompiling;this._renderContext.output=
Sa;this._precompileOpaqueGeometry();this._setMultipassTerrain(Aa);this._renderContext.output=E.ShaderOutput.Depth;this._plugins.precompile(S.RenderSlot.TRANSPARENT_TERRAIN);Aa&&(this._precompileOpaqueGeometry(),this._precompileTransparentGeometry());this._renderContext.output=Sa;this._plugins.precompile(S.RenderSlot.TRANSPARENT_TERRAIN);Ja&&(this._precompileTransparentGeometry(),this._needsTransparentTerrain&&(this._cullAboveTerrain(!1),this._precompileTransparentGeometry(),this._cullAboveTerrain(Aa)));
this._needsHUDVisibility&&this._plugins.precompile(S.RenderSlot.OCCLUSION_PIXELS);Aa&&!this._needsHUDVisibility||this._plugins.precompile(S.RenderSlot.LINE_CALLOUTS);this._setMultipassTerrain(!1);this._nodes.precompile(B.InternalRenderCategory.VIEWSHED,B.InternalRenderCategory.LASERLINES,B.InternalRenderCategory.OCCLUDED,B.RenderCategory.COMPOSITE,B.InternalRenderCategory.MAGNIFIER);this._shadowAccumulator.precompile();this._plugins.precompile(S.RenderSlot.TRANSPARENT_MATERIAL_WITHOUT_DEPTH);--this._plugins.context.techniques.precompiling}_renderObjectAndLayerIdColor(){if(!this._nodes.produces("olid"))return null;
++this._techniques.precompiling;var Aa=this._framebufferSize;Aa=this.fboCache.acquire(Aa.width,Aa.height,"olid");Aa.acquireDepth(A.DepthFormat.DEPTH_STENCIL_TEXTURE);Aa=this._nodes.render(Aa,this._pluginInput);--this._techniques.precompiling;this.performanceInfo.advance(X.PerformanceCategory.OBJECT_AND_LAYER_ID_COLOR);return Aa}finish(Aa){this._hasAnimations||this._animationTimestep.clear();const Ja=this.performanceInfo.gpuSamplingEnabled;if((Aa=Aa===L.RenderRequestType.BACKGROUND)||Ja){const Sa=
Aa?this.performanceInfo.elapsedTime:0;let $a=0;Ja?$a=this.performanceInfo.totalGPUTimeSampler.last:this._rctx.gl.finish();this._animationTimestep.frame(Math.max(Sa,$a),Aa)}}readMainDepth(Aa,Ja){const {mainDepth:Sa,camera:$a}=this._bindParameters;if(Sa){var Wa=this.fboCache.acquire(this._framebufferSize.width,this._framebufferSize.height,"linear-depth");this._rctx.bindFramebuffer(Wa.fbo);$a.setGLViewport(this._rctx);this._rctx.setScissorRect(Aa[0],Aa[1],Aa[2],Aa[3]);this._rctx.setScissorTestEnabled(!0);
this._rctx.clearFramebuffer(y.ZEROS);this._compositingHelper.blitDepthToLinearDepth(this._bindParameters,Sa);this._rctx.setScissorTestEnabled(!1);this._rctx.setScissorRect(0,0,this._rctx.gl.canvas.width,this._rctx.gl.canvas.width);Wa.fbo?.readPixels(Aa[0],Aa[1],Aa[2],Aa[3],pa.PixelFormat.RGBA,pa.PixelType.UNSIGNED_BYTE,Ja);Wa.release()}}readHUDVisibility(Aa,Ja,Sa,$a,Wa){this._bindParameters.hudVisibility?.fbo?.readPixels(Aa,Ja,Sa,$a,pa.PixelFormat.RGBA,pa.PixelType.UNSIGNED_BYTE,Wa)}readAccumulatedShadow(Aa){return this._shadowAccumulator.readAccumulatedShadow(Aa[0],
Aa[1])}_setMultipassTerrain(Aa){this._setTerrainDepthTest(Aa);this._cullAboveTerrain(Aa)}_setTerrainDepthTest(Aa){this._bindParameters.terrainDepthTest=Aa}_cullAboveTerrain(Aa){this._bindParameters.cullAboveTerrain=Aa}_renderEdges(Aa){const Ja=this._edgeView;if(Ja?.shouldRender()){var Sa=this._framebufferSize;Sa=this.fboCache.acquire(Sa.width,Sa.height,"edges");this.renderToTargets(()=>Ja.render(this._bindParameters,Aa),Sa,this._bindParameters.geometryDepth??this._framebuffer.depth,y.ZEROS);this._framebuffer.bind();
this._compositingHelper.composite(this._bindParameters,Sa.getTexture());Sa.release();this.performanceInfo.advance(Aa===ea.Transparency.OPAQUE?X.PerformanceCategory.OPAQUE_EDGES:X.PerformanceCategory.TRANSPARENT_EDGES)}}_renderShadowMap(Aa,Ja,Sa){if(this.shadowsEnabled){var $a=this._shadowMap;$a.start(Aa,Ja,Sa,this.isFeatureEnabled(ha.RenderFeature.HighResolutionShadows),this._stage.view.qualitySettings.maximumPixelRatio);this._needsShadowHighlight?(this._renderShadowCascades(E.ShaderOutput.ShadowHighlight,
this._shadowMap),$a.moveSnapshot(ia.SnapshotSlot.Highlight),this._renderShadowCascades(E.ShaderOutput.ShadowExcludeHighlight,this._shadowMap),$a.copySnapshot(ia.SnapshotSlot.ExcludeHighlight),this._renderShadowCascades(E.ShaderOutput.ShadowHighlight,this._shadowMap)):this._renderShadowCascades(E.ShaderOutput.Shadow);$a.finish();Aa.setGLViewport(this._rctx);this.performanceInfo.advance(X.PerformanceCategory.SHADOW_MAP)}}_precompileShadowCascades(Aa){for(const Ja of this._shadowMap.cascades)Ja.camera.setGLViewport(this._rctx),
this._ensureBindParametersCamera(Ja.camera,Ja.camera),this._precompileAllGeometry(Aa)}_renderShadowCascades(Aa,Ja=this._shadowMap){for(const Sa of Ja.cascades)Sa.camera.setGLViewport(this._rctx),this._ensureBindParametersCamera(Sa.camera,Sa.camera),this.renderAllGeometry(Aa)}get _needsDepth(){return this._plugins.consumes(E.ShaderOutput.Depth)||this._nodes.requireGeometryDepth()||this.hasReflections||this._needsShadowHighlight||this._needsShadowAccumulation||this._debugNeedsDepth}_renderRemainingGeometryDepth(){var Aa=
this._pluginInput.get("normals");const Ja=this._needsDepth;Aa?(Aa=Ja?Aa.getAttachment(pa.DepthStencilAttachment):null,Aa?.retain(),this._pluginInput.set(B.InternalRenderCategory.SSAO,this._renderSSAO()),this._renderGeometryWithoutNormalsDepth(Ja,Aa)):this._renderAllGeometryDepth(Ja)}_renderGeometryWithoutNormalsDepth(Aa,Ja){Aa&&Ja?(Aa=this._framebufferSize,Aa=this.fboCache.acquire(Aa.width,Aa.height,"depth"),Aa.attachDepth(Ja),Ja.release(),this._rctx.bindFramebuffer(Aa.fbo),this._rctx.clear(pa.FramebufferBit.STENCIL),
this._renderGeometryWithoutNormals(E.ShaderOutput.Depth),g.releaseMaybe(this._bindParameters.depth),this._bindParameters.depth=Aa.obtainDepthTexture(),Aa.release(),this.performanceInfo.advance(X.PerformanceCategory.DEPTH)):this._bindParameters.depth=g.releaseMaybe(this._bindParameters.depth)}_renderAllGeometryDepth(Aa){Aa?(Aa=this._framebufferSize,Aa=this.fboCache.acquire(Aa.width,Aa.height,"depth").acquireDepth(A.DepthFormat.DEPTH_STENCIL_TEXTURE),this._rctx.bindFramebuffer(Aa.fbo),this._rctx.clear(pa.FramebufferBit.DEPTH|
pa.FramebufferBit.STENCIL),this.renderAllGeometry(E.ShaderOutput.Depth),g.releaseMaybe(this._bindParameters.depth),this._bindParameters.depth=Aa.obtainDepthTexture(),Aa.release(),this.performanceInfo.advance(X.PerformanceCategory.DEPTH)):this._bindParameters.depth=g.releaseMaybe(this._bindParameters.depth)}_renderTerrainDepth(Aa){if(Aa){Aa=this._renderContext.output;this._renderContext.output=E.ShaderOutput.Depth;var Ja=this._framebufferSize;Ja=this.fboCache.acquire(Ja.width,Ja.height,"terrain depth").acquireDepth(A.DepthFormat.DEPTH_STENCIL_TEXTURE);
this._rctx.bindFramebuffer(Ja.fbo);this._rctx.clear(pa.FramebufferBit.DEPTH|pa.FramebufferBit.STENCIL);this._renderTransparentTerrain();g.releaseMaybe(this._bindParameters.terrainDepth);this._bindParameters.terrainDepth=Ja.obtainDepthTexture();this._renderContext.output=Aa;Ja.release()}else this._bindParameters.terrainDepth=g.releaseMaybe(this._bindParameters.terrainDepth)}_renderGeometryDepth(Aa){if(Aa){Aa=this._renderContext.output;var {width:Ja,height:Sa}=this._framebufferSize,$a=this.fboCache.acquire(Ja,
Sa,"geometry depth").acquireDepth(A.DepthFormat.DEPTH_STENCIL_TEXTURE);this._rctx.bindFramebuffer($a.fbo);this._rctx.clear(pa.FramebufferBit.DEPTH|pa.FramebufferBit.STENCIL);this._renderOpaqueAndTransparentGeometry(E.ShaderOutput.Depth);this._renderContext.output=Aa;g.releaseMaybe(this._bindParameters.geometryDepth);this._bindParameters.geometryDepth=$a.obtainDepthTexture();$a.release()}else this._bindParameters.geometryDepth=g.releaseMaybe(this._bindParameters.geometryDepth)}get _needsDepthRange(){return this._shadowMap.enabled||
this._needsShadowAccumulation}_computeDepthRange(Aa){if(!this._needsDepthRange)return R.zero;const Ja=W.depthRangeFromScene(Aa,this._plugins.plugins,this._stage.layers);R.union(Ja,this._plugins.queryDepthRange(Aa));Ja.near=Math.max(Aa.near,Ja.near);Ja.far=Math.min(Aa.far,Ja.far);return Ja}get _normalsRequired(){const Aa=this._nodes.require("normals","final-color",B.RenderCategory.COMPOSITE,"opaque-color","transparent-color","laserline-color");return(this.hasSSAO?1:0)+Aa}_precompilePrepasses(){this._normalsRequired&&
this._precompileAllGeometry(E.ShaderOutput.Normal);this._needsDepth&&this._precompileAllGeometry(E.ShaderOutput.Depth);this.shadowsEnabled&&(this._needsShadowHighlight?(this._precompileShadowCascades(E.ShaderOutput.ShadowHighlight),this._precompileShadowCascades(E.ShaderOutput.ShadowExcludeHighlight),this._precompileShadowCascades(E.ShaderOutput.ShadowHighlight)):this._precompileShadowCascades(E.ShaderOutput.Shadow));this._needsShadowAccumulation&&this._precompileAllGeometry(E.ShaderOutput.Shadow)}_renderNormals(){const Aa=
this._normalsRequired;if(0!==Aa){var Ja=this._framebufferSize;Ja=this.fboCache.acquire(Ja.width,Ja.height,"normals",A.ColorFormat.RGBA);Ja.acquireDepth(A.DepthFormat.DEPTH_STENCIL_TEXTURE);this._rctx.bindFramebuffer(Ja.fbo);this._rctx.clearFramebuffer(y.ZEROS,!0,!0);this._renderGeometryWithNormals(E.ShaderOutput.Normal);var Sa=this._nodes.optional("normals","final-color",B.RenderCategory.COMPOSITE,"opaque-color","transparent-color","viewshed-color");Ja.retain(Aa+Sa-1);this.performanceInfo.advance(X.PerformanceCategory.NORMALS);
return Ja}}_renderSSAO(){const Aa=this._pluginInput.get("normals");if(this.hasSSAO&&Aa){C.defaultWebGLFBO.setName(B.InternalRenderCategory.SSAO);var Ja=this._nodes.render(C.defaultWebGLFBO,this._pluginInput);this._bindParameters.ssao=Ja;Aa.detachDepth();this._pluginInput.release("normals");this.performanceInfo.advance(X.PerformanceCategory.SSAO);return Ja}Aa?.detachDepth()}_precompileAllGeometry(Aa){const Ja=this._renderContext.output;this._renderContext.output=Aa;this._precompileOpaqueGeometry();
this._precompileTransparentGeometry();this._plugins.precompile(S.RenderSlot.TRANSPARENT_TERRAIN);this._renderContext.output=Ja}renderAllGeometry(Aa){this._renderContext.output=Aa;this._renderOpaqueAndTransparentGeometry(Aa);this._renderTransparentTerrain()}precompileSlots(Aa,...Ja){for(const Sa of Ja)this._bindParameters.slot=Sa,Aa.precompile(this._renderContext)}precompileOccludedSlots(Aa,Ja){for(const Sa of Ja)this._renderContext.renderOccludedMask=Sa,this.precompileSlots(Aa,...Ia);this._renderContext.renderOccludedMask=
da.defaultRenderOccludedMask}renderSlots(Aa,...Ja){for(const Sa of Ja)this._bindParameters.slot=Sa,Aa.forAll($a=>{const Wa=$a.acquireTechniques(this._renderContext);Wa&&($a.render(this._renderContext,Wa,this._pluginInput),I.releaseTechniques(Wa))})}renderOccludedSlots(Aa,Ja){this._renderContext.renderOccludedMask=Ja;this.plugins.renderOccludedFlags>ba.RenderOccludedFlag.Occlude&&this._plugins.render(this._pluginInput,S.RenderSlot.OCCLUDED_TERRAIN);this.renderSlots(Aa,...Ia);this._renderContext.renderOccludedMask=
da.defaultRenderOccludedMask}renderHUD(Aa){this._bindParameters.hudRenderStyle=Aa;this._plugins.render(this._pluginInput,S.RenderSlot.HUD_MATERIAL)}precompileViewshedShadowMap(){this._precompileAllGeometry(E.ShaderOutput.ViewshedShadow)}renderViewshedShadowMap(Aa){const {camera:Ja,contentCamera:Sa}=this._bindParameters,$a=this._renderContext.output;Aa.setGLViewport(this._rctx);this._ensureBindParametersCamera(Aa,Aa);this.renderAllGeometry(E.ShaderOutput.ViewshedShadow);this._ensureBindParametersCamera(Ja,
Sa);this._bindParameters.camera.setGLViewport(this._rctx);this._renderContext.output=$a}_renderOpaqueAndTransparentGeometry(Aa){this._renderContext.output=Aa;this._renderOpaqueGeometry();this._renderTransparentGeometry()}_renderGeometryWithNormals(Aa){this._renderContext.output=Aa;this._plugins.render(this._pluginInput,...sa);this._renderTransparentTerrain()}_renderGeometryWithoutNormals(Aa){this._renderContext.output=Aa;this._plugins.render(this._pluginInput,...xa)}_precompileOpaqueGeometry(){this._plugins.precompile(...ta)}_renderOpaqueGeometry(){this._plugins.render(this._pluginInput,
...ta)}_renderTransparentGeometry(){this._plugins.render(this._pluginInput,...Ba)}get _needsTransparentTerrain(){return this._plugins.produces(E.ShaderOutput.Color,S.RenderSlot.TRANSPARENT_TERRAIN)}_renderTransparentTerrain(){const Aa=()=>this._plugins.render(this._pluginInput,S.RenderSlot.TRANSPARENT_TERRAIN);if(E.isColorOrColorEmission(this._renderContext.output)){var Ja=this._framebufferSize;Ja=this.fboCache.acquire(Ja.width,Ja.height,"transparent terrain");this.renderToTargets(Aa,Ja,this._framebuffer.depth,
y.ZEROS);return Ja}Aa()}get _needsHUDVisibility(){return this._plugins.produces(this._renderContext.output,S.RenderSlot.OCCLUSION_PIXELS)}_renderHUDVisibility(){if(this._needsHUDVisibility){var {width:Aa,height:Ja}=this._framebufferSize,Sa=this._bindParameters.hudVisibility;if(Sa?.fbo?.width!==Aa||Sa?.fbo?.height!==Ja)Sa?.release(),Sa=this.fboCache.acquire(Aa,Ja,"hud visibility",A.ColorFormat.RGBA4),this._bindParameters.hudVisibility=Sa;Sa.attachDepth(this._bindParameters.geometryDepth||this._framebuffer.depth);
this._rctx.bindFramebuffer(Sa.fbo);this._rctx.clearFramebuffer([0,1,0,1]);this._plugins.render(this._pluginInput,S.RenderSlot.OCCLUSION_PIXELS);Sa.detachDepth();this._framebuffer.bind();this.performanceInfo.advance(X.PerformanceCategory.HUD_VISIBILITY)}else this._bindParameters.hudVisibility=g.releaseMaybe(this._bindParameters.hudVisibility)}_renderLineCallouts(Aa){this._bindParameters.hudRenderStyle=Aa;Aa===F.HUDRenderStyle.Occluded?(Aa=this._framebufferSize,Aa=this.fboCache.acquireDepth(A.DepthFormat.DEPTH16_BUFFER,
Aa.width,Aa.height,"line callouts"),this.renderToTargets(()=>this._plugins.render(this._pluginInput,S.RenderSlot.LINE_CALLOUTS),this._framebuffer.color,Aa,void 0,!0,!0),Aa.release()):this._plugins.render(this._pluginInput,S.RenderSlot.LINE_CALLOUTS)}_renderHUD(Aa,Ja,Sa){this._pluginsHas.hudElements&&(this._oitEnabled?(Sa=this._renderOIT(qa.HUD,Sa,Aa),this._rctx.bindFramebuffer(Ja.fbo),this._compositingHelper.compositePreMultipliedAlpha(this._bindParameters,Sa.getTexture()),Sa.release()):Aa===F.HUDRenderStyle.Occluded?
(this._renderContext.output=E.ShaderOutput.Color,Ja=this._framebufferSize,Ja=this.fboCache.acquireDepth(A.DepthFormat.DEPTH16_BUFFER,Ja.width,Ja.height,"hud"),this.renderToTargets(()=>this._renderHUDElements(Aa),this._framebuffer.color,Ja,void 0,!0,!0),Ja.release()):(this._renderContext.output=E.ShaderOutput.Color,Ja.acquireDepth(A.DepthFormat.DEPTH16_BUFFER),this._rctx.bindFramebuffer(Ja.fbo),this._renderHUDElements(Aa),Ja.detachDepth()),this.performanceInfo.advance(Aa===F.HUDRenderStyle.Occluded?
X.PerformanceCategory.HUD_OCCLUDED:X.PerformanceCategory.HUD))}_renderHUDElements(Aa){this._bindParameters.hudRenderStyle=Aa;this._plugins.precompile(S.RenderSlot.LINE_CALLOUTS_HUD_DEPTH,S.RenderSlot.HUD_MATERIAL,S.RenderSlot.LABEL_MATERIAL);this._plugins.render(this._pluginInput,S.RenderSlot.LINE_CALLOUTS_HUD_DEPTH,S.RenderSlot.HUD_MATERIAL,S.RenderSlot.LABEL_MATERIAL)}get _needsShadowHighlight(){return this.shadowsEnabled&&this._plugins.produces(E.ShaderOutput.ShadowHighlight,S.RenderSlot.OPAQUE_MATERIAL)}_renderHighlightPrepass(){if(this.hasHighlights){var {fboCache:Aa,
_rctx:Ja,_bindParameters:Sa}=this,$a=this._framebufferSize,Wa=Aa.acquire($a.width,$a.height,"highlights",A.ColorFormat.RG);Wa.acquireDepth(A.DepthFormat.DEPTH_STENCIL_TEXTURE);Ja.bindFramebuffer(Wa.fbo);Ja.clearFramebuffer(y.ZEROS,!0);this._renderContext.output=E.ShaderOutput.Highlight;M.renderHighlightBuffer(Ja,Aa,$a,this._stage.view.highlights,Sa,()=>this._renderHighlightGeometries(),0,()=>Ja.bindFramebuffer(Wa.fbo));this.performanceInfo.advance(X.PerformanceCategory.HIGHLIGHTS);return Wa}}_renderHighlightGeometries(){const Aa=
[S.RenderSlot.TRANSPARENT_MATERIAL,S.RenderSlot.TRANSPARENT_MATERIAL_WITHOUT_NORMALS,S.RenderSlot.OPAQUE_MATERIAL,S.RenderSlot.OPAQUE_MATERIAL_WITHOUT_NORMALS];0===this._bindParameters.highlightLevel&&Aa.push(S.RenderSlot.TRANSPARENT_TERRAIN,S.RenderSlot.INTEGRATED_MESH,S.RenderSlot.OPAQUE_TERRAIN);this._plugins.precompile(...Aa);this._plugins.render(this._pluginInput,...Aa);this._rctx.clear(pa.FramebufferBit.DEPTH);this._renderHUDElements(F.HUDRenderStyle.Both)}get _needsShadowAccumulation(){return this._shadowAccumulator.isAccumulating}_renderShadowAccumulation(Aa,
Ja,Sa){this._needsShadowAccumulation&&this._bindParameters.depth&&this._shadowAccumulator.renderAccumulation(this._bindParameters.depth,Aa,Ja,Sa)&&this.performanceInfo.advance(X.PerformanceCategory.ACCUMULATED_SHADOWS)}_precompileTransparentGeometry(){++this._plugins.context.techniques.precompiling;this._oitEnabled&&E.isColorOrColorEmission(this._renderContext.output)?(this._bindParameters.oitPass=U.OITPass.ColorAlpha,this._plugins.precompile(...Ba),this._bindParameters.oitPass=U.OITPass.FrontFace,
this._plugins.precompile(...Ba),this._bindParameters.oitPass=U.OITPass.NONE):this._plugins.precompile(...Ba);--this._plugins.context.techniques.precompiling}_renderOIT(Aa,Ja,Sa=F.HUDRenderStyle.Both){var $a=Aa===qa.HUD,Wa=this._framebufferSize;Aa=$a?this.fboCache.acquire(Wa.width,Wa.height,"oit hud composite"):null;$a=$a?()=>this._renderHUDElements(Sa):()=>this._renderTransparentGeometry();const Ta=this._bindParameters,Da=this._renderContext.output;this._renderContext.output=Ja;Ta.oitPass=U.OITPass.ColorAlpha;
Ja=this.fboCache.acquire(Wa.width,Wa.height,Aa?"oit hud color alpha":"oit color alpha",A.ColorFormat.RGBA16F);Ja.acquireColor(pa.ColorAttachment.COLOR_ATTACHMENT1,A.ColorFormat.R16F);Aa||Ja.attachDepth(this._framebuffer.depth);this._rctx.bindFramebuffer(Ja.fbo);this._rctx.clearFramebuffer([0,0,0,1]);$a();Ja.detachDepth();Ta.oitPass=U.OITPass.FrontFace;Wa=this.fboCache.acquire(Wa.width,Wa.height,Aa?"oit hud front":"oit front");Aa?Wa.acquireDepth(A.DepthFormat.DEPTH16_BUFFER):Wa.attachDepth(this._framebuffer.depth);
this._rctx.bindFramebuffer(Wa.fbo);this._rctx.clearFramebuffer(y.ZEROS,!!Aa);$a();Wa.detachDepth();Ta.oitPass=U.OITPass.NONE;Aa?(this._rctx.bindFramebuffer(Aa.fbo),this._rctx.setClearColor(0,0,0,1E-13),this._rctx.clear(pa.FramebufferBit.COLOR)):this._framebuffer.bind();this._oitblend??(this._oitblend=new Q.OITBlend(this._techniques));this._oitblend.blend(this._rctx,Ja,Wa,Ta);Aa?.detachDepth();Wa.release();Ja.release();this._renderContext.output=Da;return Aa}_renderTransparentEnvironment(){this._shadowAccumulator.render(this._bindParameters);
this.performanceInfo.advance(X.PerformanceCategory.APPLY_ACCUMULATED_SHADOWS);this._framebuffer.bind();this._plugins.render(this._pluginInput,S.RenderSlot.TRANSPARENT_MATERIAL_WITHOUT_DEPTH);this.performanceInfo.advance(X.PerformanceCategory.TRANSPARENT_MATERIAL_WITHOUT_DEPTH)}_renderPlugins(Aa,Ja){this._plugins.produces(this._renderContext.output,Aa)&&(this._plugins.render(this._pluginInput,Aa),this.performanceInfo.advance(Ja))}_renderNodes(Aa,Ja,Sa=!1){Ja.setName(Aa);this._pluginInput.set(Aa,Ja);
if(!this._nodes.produces(Aa))return Sa&&this.performanceInfo.advance(Aa),Ja;Ja=this._nodes.render(Ja,this._pluginInput,this._releaseNormals);this.performanceInfo.advance(Aa);return Ja}_blitFBO(Aa,Ja=C.defaultWebGLFBO,Sa=!0){this._blit??(this._blit=new N.Blit(this._techniques));this._blit.blit(this._rctx,Aa,Ja,this._bindParameters);this._pluginInput.set(Aa.name,Ja);Sa&&Aa.release();return Ja}_ensureBindParametersCamera(Aa,Ja){this._bindParameters.camera=Aa;this._bindParameters.contentCamera=Ja}_ensureBindParametersSSR(Aa){if(this._bindParameters.ssr.lastFrameColor){null==
this._ssrEnableTime&&(this._ssrEnableTime=Aa);this._renderContext.lastFrameCamera.equals(this._bindParameters.camera)?this._reprojectionMatrix=r.IDENTITY:(q.invert(Ha,this._bindParameters.camera.viewMatrix),q.invert(Ca,this._bindParameters.camera.projectionMatrix),q.multiply(Ga,Ha,Ca),q.multiply(Ga,this._renderContext.lastFrameCamera.viewMatrix,Ga),q.multiply(Ga,this._renderContext.lastFrameCamera.projectionMatrix,Ga),this._reprojectionMatrix=Ga);const Ja=this._stage.view.qualitySettings.fadeDuration;
this._bindParameters.ssr.fadeFactor=0<Ja?Math.min(Ja,Aa-this._ssrEnableTime)/Ja:1;1>this._bindParameters.ssr.fadeFactor&&this._requestRender()}else this._reprojectionMatrix=r.IDENTITY,this._ssrEnableTime=null}addRenderNode(Aa){this._nodes.add(Aa);this._requestRender()}removeRenderNode(Aa){this._nodes.remove(Aa);this._requestRender()}updateLighting(Aa,Ja,Sa,$a){this._bindParameters.updateLighting(Aa,Ja,Sa,$a);this._requestRender(L.RenderRequestType.UPDATE)}get usedMemory(){return{fbos:this.fboCache.usedMemory,
plugins:this._plugins.usedMemory,edges:this.edgeView?.usedMemory??0}}renderToTargets(Aa,Ja,Sa,$a,Wa=!1,Ta=!1){Ja.attachDepth(Sa);this._rctx.bindFramebuffer(Ja.fbo);this._rctx.clearFramebuffer($a,Wa,Ta);Aa();Ja.detachDepth()}get test(){}}n.__decorate([l.property({readOnly:!0})],na.prototype,"fullResolutionAtmosphere",null);n.__decorate([l.property()],na.prototype,"_edgeView",void 0);n.__decorate([l.property()],na.prototype,"updating",null);var qa;(function(Aa){Aa[Aa.Geometry=0]="Geometry";Aa[Aa.HUD=
1]="HUD"})(qa||={});const sa=[S.RenderSlot.INTEGRATED_MESH,S.RenderSlot.OPAQUE_TERRAIN,S.RenderSlot.OPAQUE_MATERIAL,S.RenderSlot.TRANSPARENT_MATERIAL],xa=[S.RenderSlot.OPAQUE_MATERIAL_WITHOUT_NORMALS,S.RenderSlot.TRANSPARENT_MATERIAL_WITHOUT_NORMALS],ta=[S.RenderSlot.INTEGRATED_MESH,S.RenderSlot.OPAQUE_TERRAIN,S.RenderSlot.OPAQUE_MATERIAL,S.RenderSlot.OPAQUE_MATERIAL_WITHOUT_NORMALS],Ba=[S.RenderSlot.TRANSPARENT_MATERIAL,S.RenderSlot.TRANSPARENT_MATERIAL_WITHOUT_NORMALS],Ia=[S.RenderSlot.OPAQUE_MATERIAL,
S.RenderSlot.TRANSPARENT_MATERIAL,S.RenderSlot.TRANSPARENT_MATERIAL_WITHOUT_DEPTH],Ca=r.create(),Ha=r.create(),Ga=r.create();b.Renderer=na;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/FBOCache":function(){define("exports ../../../../core/Error ../../webgl/formats ../../webgl/ManagedColorAttachment ../../webgl/ManagedDepthAttachment ../../webgl/ManagedFBO ../../webgl/ManagedFBObject ./FBOPool ../../../webgl/enums ../../../webgl/FramebufferObject ../../../webgl/Renderbuffer ../../../webgl/RenderbufferDescriptor ../../../webgl/Texture ../../../webgl/TextureDescriptor".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w,x){class u{constructor(H){this.rctx=H;this._acquired=new Set;this._cache=new g.FBOPool(H.newCache,"FBOCache");this._depthCache=new g.FBOPool(H.newCache,"DepthAttachmentCache");this._colorCache=new g.FBOPool(H.newCache,"ColorAttachmentCache")}destroy(){this._cache.destroy();this._depthCache.destroy();this._colorCache.destroy()}clean(){this._cache.clean();this._colorCache.clean();this._depthCache.clean()}frameStart(){this._cache.frame();this._colorCache.frame();this._depthCache.frame();
this.debugCallback&&this.debugCallback()}frameEnd(){const H=this.debugCallback;H&&this._acquired.forEach(E=>E.type===e.AttachmentType.FBO&&H(E.name,E.fbo,E.numberOfColorAttachments))}get usedMemory(){return Array.from(this._acquired.values()).reduce((H,E)=>H+("getTexture"in E?E.getTexture()?.usedMemory??0:E.usedMemory),this._cache.usedMemory+this._colorCache.usedMemory+this._depthCache.usedMemory)}set interactive(H){this._cache.interactive=this._colorCache.interactive=this._depthCache.interactive=
H}acquire(H,E,F,G=n.ColorFormat.RGBA){const D=`${G}x${H}x${E}`;let I=this._cache.pop(D);if(I){I.retain();I.setName(F);F=this.rctx.getBoundFramebufferObject();this.rctx.bindFramebuffer(I.fbo);this.rctx.setDrawBuffers([d.ColorAttachment.COLOR_ATTACHMENT0]);if(I.fbo)this.rctx.unbindTexture(I.fbo.colorTexture);else throw new b("attempt to use a not existing framebuffer");this.rctx.bindFramebuffer(F)}else I=new h(D,F,new f.FramebufferObject(this.rctx,{...A[G],width:H,height:E}),J=>{J??=n.DepthFormat.DEPTH_STENCIL_TEXTURE;
J=this._acquireDepth(J,I.fbo.width,I.fbo.height,`${I.name} depth`);I.attachDepth(J);J.release();return I},(J,N,M)=>{N??=n.ColorFormat.RGBA;N=this._acquireColor(N,H,E,M??`${I.name} color ${J}`);this.rctx.unbindTexture(N.attachment);I.attachColor(N,J);N.release();return I},()=>{this.debugCallback&&this.debugCallback(I.name,I.fbo,I.numberOfColorAttachments);this._acquired.delete(I);I.detachAll();this._cache.put(I)});return this._trackHandle(I)}acquireDepth(H,E,F,G){return this._acquireDepth(H,E,F,G)}_acquireDepth(H,
E,F,G){const D=`${H}x${E}x${F}`,I=this._depthCache.pop(D);if(I)return I.retain(),I.name=G,this._trackHandle(I);const J=H===n.DepthFormat.DEPTH_STENCIL_TEXTURE?new p.ManagedDepthAttachment(D,new w.Texture(this.rctx,{...C[H],width:E,height:F}),()=>{this._acquired.delete(J);this._depthCache.put(J)}):new p.ManagedDepthAttachment(D,new c.Renderbuffer(this.rctx,{...C[H],width:E,height:F}),()=>{this._acquired.delete(J);this._depthCache.put(J)});J.name=G;return this._trackHandle(J)}_acquireColor(H,E,F,G){const D=
`${H}x${E}x${F}`,I=this._colorCache.pop(D);if(I)return I.retain(),I.name=G,this._trackHandle(I);const J=new k.ManagedColorAttachment(D,new w.Texture(this.rctx,{...A[H],width:E,height:F}),()=>{this._acquired.delete(J);this._colorCache.put(J)});J.name=G;return this._trackHandle(J)}_trackHandle(H){this._acquired.add(H);return H}}const t=new h("default","default",null,()=>t,()=>t,()=>{});t.release=()=>!1;const m=new x.TextureDescriptor;m.pixelFormat=d.PixelFormat.RED;m.internalFormat=d.SizedPixelFormat.R8;
m.wrapMode=d.TextureWrapMode.CLAMP_TO_EDGE;const q=new x.TextureDescriptor;q.pixelFormat=d.PixelFormat.RG;q.internalFormat=d.SizedPixelFormat.RG8;q.wrapMode=d.TextureWrapMode.CLAMP_TO_EDGE;const r=new x.TextureDescriptor;r.internalFormat=d.SizedPixelFormat.RGBA4;r.dataType=d.PixelType.UNSIGNED_SHORT_4_4_4_4;r.wrapMode=d.TextureWrapMode.CLAMP_TO_EDGE;const v=new x.TextureDescriptor;v.wrapMode=d.TextureWrapMode.CLAMP_TO_EDGE;const y=new x.TextureDescriptor;y.wrapMode=d.TextureWrapMode.CLAMP_TO_EDGE;
y.samplingMode=d.TextureSamplingMode.LINEAR_MIPMAP_LINEAR;y.hasMipmap=!0;y.maxAnisotropy=8;const B=new x.TextureDescriptor;B.pixelFormat=d.PixelFormat.RED;B.dataType=d.PixelType.HALF_FLOAT;B.internalFormat=d.SizedPixelFormat.R16F;B.samplingMode=d.TextureSamplingMode.NEAREST;const z=new x.TextureDescriptor;z.dataType=d.PixelType.HALF_FLOAT;z.internalFormat=d.SizedPixelFormat.RGBA16F;z.samplingMode=d.TextureSamplingMode.NEAREST;const A={[n.ColorFormat.RED]:m,[n.ColorFormat.RG]:q,[n.ColorFormat.RGBA4]:r,
[n.ColorFormat.RGBA]:v,[n.ColorFormat.RGBA_MIPMAP]:y,[n.ColorFormat.R16F]:B,[n.ColorFormat.RGBA16F]:z};x=new x.TextureDescriptor;x.pixelFormat=d.PixelFormat.DEPTH_STENCIL;x.dataType=d.PixelType.UNSIGNED_INT_24_8;x.samplingMode=d.TextureSamplingMode.NEAREST;x.wrapMode=d.TextureWrapMode.CLAMP_TO_EDGE;x.internalFormat=d.PixelFormat.DEPTH24_STENCIL8;const C={[n.DepthFormat.DEPTH_STENCIL_TEXTURE]:x,[n.DepthFormat.DEPTH16_BUFFER]:new l.RenderbufferDescriptor(d.RenderbufferFormat.DEPTH_COMPONENT16,4)};a.FBOCache=
u;a.defaultWebGLFBO=t;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl/ManagedColorAttachment":function(){define(["exports","./ManagedFBOAttachment","./ManagedFBObject"],function(a,b,n){class k extends b.ManagedFBOAttachment{constructor(p,h,e){super(p,h,e);this.attachment=h;this.type=n.AttachmentType.COLOR}}a.ManagedColorAttachment=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl/ManagedFBOAttachment":function(){define(["exports",
"./ManagedFBObject"],function(a,b){class n extends b.ManagedFBObject{constructor(k,p,h){super(k,h);this.attachment=p;this.name=""}dispose(){this.attachment.dispose()}get usedMemory(){return this.attachment.usedMemory}}a.ManagedFBOAttachment=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl/ManagedFBObject":function(){define(["exports"],function(a){class b{constructor(n,k){this.key=n;this.free=k;this.incarnation=0;this._refCount=1}retain(n=1){this._refCount+=n}release(){if(0===
this._refCount)return console.log(`Releasing already released FBO attachment "${this.name}" in ${Error().stack}`),!0;--this._refCount;return 0===this._refCount?(this.free(),!0):!1}}a.AttachmentType=void 0;(function(n){n[n.FBO=0]="FBO";n[n.DEPTH=1]="DEPTH";n[n.COLOR=2]="COLOR"})(a.AttachmentType||(a.AttachmentType={}));a.ManagedFBObject=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl/ManagedDepthAttachment":function(){define(["exports","./ManagedFBOAttachment",
"./ManagedFBObject"],function(a,b,n){class k extends b.ManagedFBOAttachment{constructor(){super(...arguments);this.type=n.AttachmentType.DEPTH}}a.ManagedDepthAttachment=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl/ManagedFBO":function(){define("../../../core/MapUtils ../../../core/maybe ../webgl ./ManagedDepthTexture ./ManagedFBObject ../../webgl/enums".split(" "),function(a,b,n,k,p,h){class e extends p.ManagedFBObject{constructor(g,d,f,c,l,w){super(g,w);
this.type=p.AttachmentType.FBO;this._colors=new Map;this._name=n.RenderCategory.COMPOSITE;this.acquireColor=this.acquireDepth=null;this._name=d;this.fbo=f;this.acquireDepth=c;this.acquireColor=l}dispose(){this.fbo?.dispose()}get usedMemory(){return this.fbo?.usedMemory||0}get numberOfColorAttachments(){return this._colors.size}get name(){return this._name}setName(g){this._name=g}getTexture(g=h.ColorAttachment.COLOR_ATTACHMENT0){return g===h.DepthStencilAttachment?this.fbo?.depthStencilTexture:this.fbo?.getColorTexture(g)}getAttachment(g=
h.ColorAttachment.COLOR_ATTACHMENT0){return g===h.DepthStencilAttachment?this._depth:this._colors.get(g)}hasAttachment(g){return a.someMap(this._colors,d=>d.name===g)}attachDepth(g){g?.retain();this.detachDepth();g&&this.fbo?.attachDepthStencil(g.attachment);this._depth=g;return this}detachDepth(){this.fbo?.detachDepthStencilTexture();this.fbo?.detachDepthStencilBuffer();this._depth=b.releaseMaybe(this._depth)}obtainDepthTexture(){const g=this._depth;if(!k.isManagedDepthTexture(g))return null;this.fbo?.detachDepthStencilTexture();
this._depth=null;return g}attachColor(g,d){g.retain();this.detachColor(d);this.fbo?.attachColorTexture(g.attachment,d);this._colors.set(d,g);return this}detachColor(g){this.fbo?.detachColorTexture(g);const d=this._colors.get(g);this._colors.delete(g);d?.release()}detachAll(){this._colors.forEach((g,d)=>this.detachColor(d));this.detachDepth()}}return e})},"esri/views/3d/webgl/ManagedDepthTexture":function(){define(["exports","../../webgl/GLObjectType"],function(a,b){a.isManagedDepthTexture=function(n){return n?.attachment.type===
b.GLObjectType.Texture};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/FBOPool":function(){define(["exports","../../../../core/MemCachePool","../../../../core/PooledArray"],function(a,b,n){class k{constructor(p,h){this._last=new n;this._incarnation=0;this._cache=new b.MemCachePool(p,h)}destroy(){this._last?.forAll(p=>p.dispose());this._last=null;this._cache.destroy()}set interactive(p){p&&!this._last?this._last=new n:p||(this._last?.forAll(h=>h.dispose()),
this._last=null)}clean(){this._last?.filterInPlace(p=>p.incarnation<this._incarnation?(this._cache.put(p.key,p),!1):!0)}frame(){++this._incarnation}pop(p){if(this._last){const h=this._last.find(e=>e.key===p);if(h)return this._last.removeUnordered(h),h}return this._cache.pop(p)}put(p){p.incarnation=this._incarnation;this._last?this._last.push(p):this._cache.put(p.key,p)}get usedMemory(){return this._last?.reduce((p,h)=>p+h.usedMemory,0)??0}}a.FBOPool=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/webgl-engine/core/renderPasses/RenderPassManager":function(){define("exports ../../../../../chunks/tslib.es6 ../../../../../core/Logger ../../../../../core/has ../../../../../core/RandomLCG ../../../../../core/Error ../../../../../core/accessorSupport/decorators/subclass ../../../../../core/libs/gl-matrix-2/math/mat3 ../../../../../core/libs/gl-matrix-2/factories/mat3f64 ../../../../../core/libs/gl-matrix-2/math/mat4 ../../../../../chunks/vec32 ../../../../../core/libs/gl-matrix-2/factories/vec3f64 ./AllRenderPasses ./RenderPass ../shaderLibrary/ShaderOutput ../util/TwoVectorPosition ../../effects/RenderPlugin ../../lib/depthRange ../../lib/RenderSlot".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w,x,u,t,m,q,r){a.RenderPassManager=class extends m.SyncRenderPlugin{constructor(){super({});this._passes=null;this.produces=new Map([[r.RenderSlot.OPAQUE_MATERIAL,z=>this._produces(z)],[r.RenderSlot.TRANSPARENT_MATERIAL,z=>this._passes&&0<this._passes.materialTransparent.count?this._produces(z):!1],[r.RenderSlot.INTEGRATED_MESH,z=>this._produces(z)]]);this._materialPassParameters=new w.MaterialPassParameters;this._shadowPassParameters=new w.ShadowMapPassParameters;
this._highlightPassParameters=new w.HighlightPassParameters;this._viewshedPassParameters=new w.ViewshedShadowMapPassParameters;this._systems=new Set}initializeRenderContext(z){this._context=z;const A=z.renderContext.rctx;z=z.techniques;this._passes={materialOpaque:new x.RenderPass(A,z),materialTransparent:new x.RenderPass(A,z,x.RenderPassSorting.BackToFront),materialIntegratedMesh:new x.RenderPass(A,z),shadowMap:new x.RenderPass(A,z),highlight:new x.RenderPass(A,z),highlightIntegratedMesh:new x.RenderPass(A,
z),highlightShadowMap:new x.RenderPass(A,z),viewshedShadowMap:new x.RenderPass(A,z),defaultShadowMap:new x.RenderPass(A,z)}}get rctx(){return this._context.renderContext.rctx}uninitializeRenderContext(){}dispose(){this._context=null;this._systems.clear()}register(z){this._systems.add(z)}_produces(z){return 0===this._systems.size||null===this._passes?!1:z===u.ShaderOutput.Highlight?0<this._passes.highlight.count||0<this._passes.highlightIntegratedMesh.count:z===u.ShaderOutput.ShadowHighlight?0<this._passes.highlight.count:
!0}prepareRender(z){if(0!==this._systems.size&&null!==this._passes){for(const A of Object.values(this._passes))A.prepareSubmit();this._systems.forEach(A=>A.submit(this._passes,z.bind));for(const A of Object.values(this._passes))A.finishSubmit();this._context.techniques.frameUpdate()}}acquireTechniques(z){if(0===this._systems.size)return null;const A=z.bind;this._updateParameters(A.camera,z.output===u.ShaderOutput.Shadow||z.output===u.ShaderOutput.ShadowHighlight||z.output===u.ShaderOutput.ShadowExcludeHighlight?
this._shadowPassParameters:z.output===u.ShaderOutput.ViewshedShadow?this._viewshedPassParameters:z.output===u.ShaderOutput.Highlight?this._highlightPassParameters:this._materialPassParameters,A.slot===r.RenderSlot.TRANSPARENT_MATERIAL);this._materialPassParameters.output=z.output;return this._invoke(z,(C,H)=>C.acquire(H,z.bind))}render(z,A){this._invoke(z,(C,H)=>C.dispatch(H,z.bind,A))}_invoke(z,A){if(null===this._passes)return null;switch(z.bind.slot){case r.RenderSlot.OPAQUE_MATERIAL:switch(z.output){case u.ShaderOutput.Color:case u.ShaderOutput.ColorEmission:case u.ShaderOutput.Depth:case u.ShaderOutput.Normal:case u.ShaderOutput.ObjectAndLayerIdColor:return A(this._passes.materialOpaque,
this._materialPassParameters);case u.ShaderOutput.Highlight:return A(this._passes.highlight,this._highlightPassParameters);case u.ShaderOutput.Shadow:return A(this._passes.shadowMap,this._shadowPassParameters);case u.ShaderOutput.ShadowHighlight:return A(this._passes.highlightShadowMap,this._shadowPassParameters);case u.ShaderOutput.ShadowExcludeHighlight:return A(this._passes.defaultShadowMap,this._shadowPassParameters);case u.ShaderOutput.ViewshedShadow:return A(this._passes.viewshedShadowMap,this._viewshedPassParameters)}break;
case r.RenderSlot.TRANSPARENT_MATERIAL:switch(z.output){case u.ShaderOutput.Color:case u.ShaderOutput.ColorEmission:case u.ShaderOutput.Depth:case u.ShaderOutput.Normal:case u.ShaderOutput.ObjectAndLayerIdColor:return A(this._passes.materialTransparent,this._materialPassParameters)}break;case r.RenderSlot.INTEGRATED_MESH:switch(z.output){case u.ShaderOutput.Color:case u.ShaderOutput.ColorEmission:case u.ShaderOutput.Depth:case u.ShaderOutput.Normal:case u.ShaderOutput.ObjectAndLayerIdColor:return A(this._passes.materialIntegratedMesh,
this._materialPassParameters);case u.ShaderOutput.Highlight:return A(this._passes.highlightIntegratedMesh,this._highlightPassParameters)}}return null}notifyDirty(){this._context.requestRender()}queryDepthRange(z){const A=new q.DepthRange;this._systems.forEach(C=>q.union(A,C.queryShadowCasterDepthRange(z)));return A}get hasEmissions(){let z=!1;this._systems.forEach(A=>z=A.hasEmissions||z);return z}_updateParameters(z,A,C){const H=z.viewInverseTransposeMatrix;c.set(v,H[3],H[7],H[11]);B.set(v);c.copy(A.transformWorldFromViewTH,
B.high);c.copy(A.transformWorldFromViewTL,B.low);c.copy(A.slicePlaneLocalOrigin,v);g.fromMat4(A.transformViewFromCameraRelativeRS,z.viewMatrix);f.copy(A.transformProjFromView,z.projectionMatrix);A.identifier===w.RenderPassIdentifier.Material&&(this._materialPassParameters.transparent=C,g.transpose(y,A.transformViewFromCameraRelativeRS),g.invert(A.transformNormalViewFromGlobal,y))}};a.RenderPassManager=b.__decorate([e.subclass("esri.views.3d.webgl-engine.core.renderPasses.RenderPassManager")],a.RenderPassManager);
const v=l.create(),y=d.create(),B=new t.TwoVectorPosition;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/renderPasses/RenderPass":function(){define(["exports","../../../../../core/PooledArray","./AllRenderPasses","../../lib/OITPass","../../../../webgl/enums"],function(a,b,n,k,p){a.RenderPassSorting=void 0;(function(g){g[g.FrontToBack=0]="FrontToBack";g[g.BackToFront=1]="BackToFront"})(a.RenderPassSorting||(a.RenderPassSorting={}));class h{constructor(g,
d,f=a.RenderPassSorting.FrontToBack){this._rctx=g;this._techniques=d;this._sorting=f;this._draws=new b({initialSize:32,allocator:c=>c??{material:null,geometry:null,geometryRanges:null,bindDrawParams:null,depthSquaredHint:0,indexType:0}});this._previouslyBoundDraw=new Map}submitDraw(g,d,f,c,l){const w=this._draws.pushNew();w.geometry=d;w.geometryRanges=f;w.material=g;w.depthSquaredHint=c;w.indexType=(d.indexed?d.vao.indexBuffer.indexType:null)??0;w.highlightGroupName=l}acquire(g,d){return this._draws.map(f=>
f.material.acquireTechnique(this._techniques,g,d,f.geometry.parameters))}dispatch(g,d,f){const c=this._rctx;this._previouslyBoundDraw.clear();let l=null;const w=this._draws.length;for(let t=0;t<w;t++){var x=this._draws.data[t];if(g.identifier===n.RenderPassIdentifier.Highlight){var {highlightGroupName:u}=x;if(u&&(d.highlightGroupIndices.get(u)??0)!==d.highlightLevel)continue}u=f[t];if(u!==l||d.oitPass!==k.OITPass.NONE)c.bindTechnique(u,d,g),l=u;const {geometryRanges:m,indexType:q,geometry:r,material:v}=
x;c.bindVAO(r.vao);this._previouslyBoundDraw.get(u)!==v&&(u.program.bindDraw(d,g,v),this._previouslyBoundDraw.set(u,v));x=m.length;({primitiveType:u}=r);for(let y=0;y<x;y+=2){const B=m[y],z=m[y+1];if(0!==q){const A=e.get(q);c.drawElements(u,z,q,B*A)}else c.drawArrays(u,B,z)}}}prepareSubmit(){this._draws.clear()}finishSubmit(){const g=this._sorting===a.RenderPassSorting.FrontToBack?1:-1;this._draws.sort((d,f)=>{const c=g*(d.depthSquaredHint-f.depthSquaredHint);return 0!==c?c:d.geometry.vao.byteSize-
f.geometry.vao.byteSize})}get count(){return this._draws.length}}const e=new Map;e.set(p.DataType.UNSIGNED_BYTE,1);e.set(p.DataType.UNSIGNED_SHORT,2);e.set(p.DataType.UNSIGNED_INT,4);a.RenderPass=h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/effects/RenderNodes":function(){define("exports ../../../../core/Logger ../../../../core/PooledArray ../../webgl/utils ../core/FBOCache ../../../webgl/checkWebGLError".split(" "),function(a,b,n,k,p,h){class e{constructor(g){this._context=
g;this._nodes=new n}destroy(){this._nodes.forEach(g=>g.destroy());this._nodes.clear()}add(g){this._nodes.push(g);h.hasFeatureFlagWebGLDebug&&console.log(`Registered render nodes: ${this._nodes.map(({declaredClass:d})=>d).join(", ")}`)}remove(g){this._nodes.remove(g);h.hasFeatureFlagWebGLDebug&&console.log(`Registered render nodes: ${this._nodes.map(({declaredClass:d})=>d).join(", ")}`)}produces(g){return this._nodes.some(({produces:d})=>d===g)}require(g,...d){const f=this._nodes,c=l=>f.reduce((w,
{consumes:x,produces:u})=>w+(!x.required.includes(g)||null!=l&&u!==l?0:1),0);return 0===d.length?c():d.reduce((l,w)=>l+c(w),0)}optional(g,...d){const f=this._nodes,c=l=>f.reduce((w,{consumes:x,produces:u})=>w+(!x.optional?.includes(g)||null!=l&&u!==l?0:1),0);return 0===d.length?c():d.reduce((l,w)=>l+c(w),0)}updateAnimation(g){return this._nodes.reduce((d,f)=>f.updateAnimation(g)||d,!1)}precompile(...g){++this._context.techniques.precompiling;for(const d of g)this._nodes.forEach(f=>{f.produces===d&&
f.precompile()});--this._context.techniques.precompiling}render(g,d,f=()=>{}){const c=g.name,l=this._nodes.filter(({produces:w})=>w===c);if(0===l.length)return k.isManagedFBO(g)?g:p.defaultWebGLFBO;l.forEach(w=>{const x=[g];for(var u of w.consumes.required){if(u===c)continue;const t=d.get(u);if(t)x.push(t);else if("emissive"!==u||!d.get(c)?.hasAttachment(u)){f&&f(x);return}}if(w.consumes.optional)for(const t of w.consumes.optional)t!==c&&(u=d.get(t))&&x.push(u);try{const t=w.doRender(x);t&&t!==g&&
(c!==t.name&&(b.getLogger(w).errorOnce(`RenderNode produced ${t.name}, expected ${c}`),t.setName(c)),g.release(),g=t,d.set(c,g))}catch(t){b.getLogger(w).errorOnce(t)}f&&f(x)});this._context.rctx.enforceState();return g}requireGeometryDepth(){return this._nodes.some(g=>"disabled"!==g.produces&&g.requireGeometryDepth)}get test(){return{nodes:this._nodes}}}a.RenderNodes=e;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl/utils":function(){define(["exports"],function(a){a.isManagedFBO=
function(b){return b.name};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/effects/RenderPluginManager":function(){define("exports ../../../../core/has ../../../../core/PooledArray ../../../../core/promiseUtils ../../../../core/signal ../core/shaderLibrary/ShaderOutput ./RenderPlugin ../lib/depthRange ../lib/Material ../lib/RenderSlot".split(" "),function(a,b,n,k,p,h,e,g,d,f){class c{constructor(l){this.context=l;this._renderPlugins=new n;this._slots=[];
this._version=p.signal(0);for(l=0;l<f.RenderSlot.MAX_SLOTS;++l)this._slots[l]=[]}destroy(){this._renderPlugins.forEach(l=>l.destroy());this._renderPlugins.clear()}get plugins(){return this._renderPlugins}add(l,w){const x=()=>{if(w?.aborted)throw l.uninitializeRenderContext(),k.createAbortError();this._renderPlugins.push(l);l.produces.forEach((t,m)=>this._slots[m].push(l));this.context.requestRender();this._version.value++},u=l.initializeRenderContext(this.context,w);if(k.isPromiseLike(u))return u.then(x);
x()}remove(l){this._renderPlugins.removeUnordered(l);l.uninitializeRenderContext();for(let w=0;w<this._slots.length;++w)this._slots[w]=this._slots[w].filter(x=>x!==l);this.context.requestRender();this._version.value++}prepareRender(){this._renderPlugins.forAll(l=>{l.prepareRender&&l.prepareRender(this.context.renderContext)})}updateAnimation(l){let w=!1;this._renderPlugins.forAll(x=>w=x.updateAnimation?.(l)||w);return w}renderFeatureChanged(){this._renderPlugins.forAll(l=>{l.renderFeatureChanged&&
l.renderFeatureChanged()})}precompile(...l){++this.context.techniques.precompiling;const w=this.context.renderContext.bind.slot;for(const x of l)this.context.renderContext.bind.slot=x,this._slots[x].forEach(u=>{u.produces.get(x)?.(this.context.renderContext.output)&&u.precompile(this.context.renderContext)});this.context.renderContext.bind.slot=w;--this.context.techniques.precompiling}_acquireRenderables(){const l=this.context.renderContext.bind.slot,w=this.context.renderContext.output??h.ShaderOutput.Color,
x=new Map;this._slots[l].forEach(u=>{if(u.produces.get(l)?.(w)&&(!u.isDecoration||this.context.renderContext.bind.decorations)){var t=u.acquireTechniques(this.context.renderContext);t&&x.set(u,t)}});return x}render(l,...w){for(const x of w)this.context.renderContext.bind.slot=x,this._acquireRenderables().forEach((u,t)=>{t.render(this.context.renderContext,u,l);e.releaseTechniques(u)})}queryDepthRange(l){const w=new g.DepthRange;this._renderPlugins.forAll(x=>{x=x.queryDepthRange?.(l);g.union(w,x)});
return w}get updating(){return 0<=this._version.value&&this._renderPlugins.some(l=>l.running)}produces(l,...w){for(const x of w)if(this._slots[x].some(u=>(u=u.produces.get(x))?u(l):!1))return!0;return!1}consumes(l){return this._renderPlugins.some(w=>w.consumes().required.includes(l))}get hasDecorations(){return this._renderPlugins.some(l=>l.isDecoration)}get hasOccludees(){return this._renderPlugins.some(l=>l.hasOccludees)}get hasEmissions(){return this._renderPlugins.some(l=>l.hasEmissions)}get renderOccludedFlags(){return this._renderPlugins.reduce((l,
w)=>l|w.renderOccludedFlags,d.RenderOccludedFlag.None)}get usedMemory(){return this._renderPlugins.reduce((l,w)=>w.material?l:l+(w.usedMemory??0),0)}get test(){}}a.RenderPluginManager=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/effects/transparency/OITBlend":function(){define(["exports","../../../../../chunks/OITBlend.glsl","./OITBlendTechnique","../../../../webgl/enums"],function(a,b,n,k){class p{constructor(h){this._techniques=h;this._parameters=
new b.OITBlendPassParameters;h.precompile(n.OITBlendTechnique)}blend(h,e,g,d){this._parameters.colorTexture=e.getTexture();this._parameters.alphaTexture=e.getTexture(k.ColorAttachment.COLOR_ATTACHMENT1);this._parameters.frontFaceTexture=g.getTexture();e=this._techniques.acquire(n.OITBlendTechnique);h.bindTechnique(e,d,this._parameters);h.screen.draw();e.release()}}a.OITBlend=p;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/OITBlend.glsl":function(){define(["exports",
"../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass.glsl","../views/3d/webgl-engine/core/shaderModules/interfaces","../views/3d/webgl-engine/core/shaderModules/ShaderBuilder","../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform"],function(a,b,n,k,p){function h(){const d=new k.ShaderBuilder;d.include(b.ScreenSpacePass);d.fragment.uniforms.add(new p.Texture2DPassUniform("colorTexture",f=>f.colorTexture),new p.Texture2DPassUniform("alphaTexture",f=>f.alphaTexture),new p.Texture2DPassUniform("frontFaceTexture",
f=>f.frontFaceTexture)).main.add(n.glsl`float srcAlpha = texture(alphaTexture, uv).r;
if(srcAlpha == 0.0){
fragColor = vec4(0.0);
return;
}
vec4 srcColor = texture(colorTexture, uv);
vec4 frontFace = texture(frontFaceTexture, uv);
fragColor = vec4(mix(srcColor.rgb / srcAlpha, frontFace.rgb, frontFace.a), 1.0 - srcColor.a);`);return d}class e extends n.NoParameters{}const g=Object.freeze(Object.defineProperty({__proto__:null,OITBlendPassParameters:e,build:h},Symbol.toStringTag,{value:"Module"}));a.OITBlend=g;a.OITBlendPassParameters=e;a.build=h})},"esri/views/3d/webgl-engine/effects/transparency/OITBlendTechnique":function(){define("require exports ../../core/shaderTechnique/ReloadableShaderModule ../../core/shaderTechnique/ShaderTechnique ../../../../../chunks/OITBlend.glsl ../../../../webgl/renderState".split(" "),
function(a,b,n,k,p,h){class e extends k.ShaderTechnique{constructor(g,d,f){super(g,d,new n.ReloadableShaderModule(p.OITBlend,()=>new Promise((c,l)=>a(["./OITBlend.glsl"],c,l))),f)}initializePipeline(){return h.makePipelineState({blending:h.premultipliedAlphaToPremultipliedAlpha,colorWrite:h.defaultColorWrite})}}b.OITBlendTechnique=e;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/AnimationTimer":function(){define(["exports","../../../../core/time"],
function(a,b){class n{constructor(k,p){this._camera=k;this._dt=b.Milliseconds(0);this._time=b.Milliseconds(0);this._lastUpdate=b.Milliseconds(0);this._time=this._lastUpdate=p}advance(k,p,h){const e=b.Milliseconds(p-this._lastUpdate);this._dt=b.Milliseconds(e/h);this._time=b.Milliseconds(this._time+e);this._lastUpdate=p;this._camera=k}forceTime(k){this._lastUpdate=this._time=k;this._dt=b.Milliseconds(0)}get camera(){return this._camera}get dt(){return this._dt}get time(){return this._time}}a.AnimationTimer=
n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/AnimationTimeStep":function(){define(["exports","../../../../core/has","../../../../core/mathUtils","../../../../core/time"],function(a,b,n,k){class p{constructor(){this._step=g;this._dilation=1;this._firstIdleTime=k.Milliseconds(0)}frame(f,c){c?0===this._firstIdleTime&&(this._firstIdleTime=k.Milliseconds(performance.now())):this._firstIdleTime=k.Milliseconds(0);if(b("disable-feature:high-quality-idle"))this._dilation=
1;else{c=c?performance.now()-this._firstIdleTime:0;if(c>=h+e){this._step=k.Milliseconds(Infinity);this._dilation=1;return}this._dilation=c>=h?10:1}f=n.clamp(f/.5,g,d);this._step=Infinity===this._step?k.Milliseconds(f):k.Milliseconds(.9*this._step+f*(1-.9))}get value(){return this._step}get timeDilation(){return this._dilation}clear(){this._step=this._firstIdleTime=k.Milliseconds(0)}}const h=k.Milliseconds(12E4),e=k.Milliseconds(1E4),g=k.Milliseconds(1E3),d=k.Milliseconds(1E3/30);a.AnimationTimeStep=
p;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/depthRangeUtils":function(){define("exports ../../../../core/PooledArray ../../../../core/libs/gl-matrix-2/math/mat4 ../../../../core/libs/gl-matrix-2/factories/mat4f64 ../../../../chunks/vec32 ../../../../chunks/vec42 ../../../../core/libs/gl-matrix-2/factories/vec4f64 ../../../../geometry/support/frustum ../../../../chunks/sphere ../../support/mathUtils ./depthRange ./Octree ./Util".split(" "),function(a,
b,n,k,p,h,e,g,d,f,c,l,w){function x(I,J,N){var M=J.eye;const Q=J.viewForward,O=J.frustum,K=P=>P.visible;var L=N.objectCount;500>L?(c.set(E,J.near,Math.min(I.near,J.far)),N.forEachInDepthRange(M,Q,l.DepthOrder.FRONT_TO_BACK,E,(P,R)=>{t(I,J,P);E.far=I.near;R.setRange(E)},O,K),c.set(E,Math.max(I.far,J.near),J.far),N.forEachInDepthRange(M,Q,l.DepthOrder.BACK_TO_FRONT,E,(P,R)=>{t(I,J,P);E.near=I.far;R.setRange(E)},O,K)):(L=Math.max(Math.min(L,500),Math.ceil(.1*L)),M=N.findClosest(Q,l.DepthOrder.FRONT_TO_BACK,
O,K,L),N=N.findClosest(Q,l.DepthOrder.BACK_TO_FRONT,O,K,L),M&&N&&(q(I,J,M.boundingVolumeWorldSpace.bounds),q(I,J,N.boundingVolumeWorldSpace.bounds)))}function u(I,J,N){F.clear();N.forAll(M=>{M.visible&&0!==M.geometries.length&&F.add(M)});F.empty||(F.sort(J),c.set(E,J.near,Math.min(I.near,J.far)),F.forEachInDepthRange(E,l.DepthOrder.FRONT_TO_BACK,(M,Q)=>{Q<I.near&&t(I,J,M)}),c.set(E,Math.max(I.far,J.near),J.far),F.forEachInDepthRange(E,l.DepthOrder.BACK_TO_FRONT,(M,Q,O)=>{I.far=Math.max(I.far,O)}))}
function t(I,J,N){if(N.visible&&g.intersectsSphere(J.frustum,N.boundingVolumeWorldSpace.bounds)){var M=N.transformation,Q=H;N.geometries.forEach(O=>{n.multiply(Q,M,O.transformation);const K=f.maxScale(Q);m(I,J,O.boundingInfo,Q,K)})}}function m(I,J,N,M,Q){if(null!=N){p.transformMat4(d.getCenter(C),N.center,M);var {eye:O,viewForward:K}=J,L=K[0]*(C[0]-O[0])+K[1]*(C[1]-O[1])+K[2]*(C[2]-O[2]);C[3]=N.radius*Q;if(!(L-C[3]>I.near&&L+C[3]<I.far)&&g.intersectsSphere(J.frustum,C))if(100<N.radius&&N.getChildren())for(const P of N.getChildren())m(I,
J,P,M,Q);else D.unionDepthRangeWithAABB(I,J.viewProjectionMatrix,M,N.bbMin,N.bbMax)}}function q(I,J,N){var M=J.eye;J=J.viewForward;M=(N[0]-M[0])*J[0]+(N[1]-M[1])*J[1]+(N[2]-M[2])*J[2];I.near=Math.min(I.near,M-N[3]);I.far=Math.max(I.far,M+N[3])}function r(I,J){if(0===J)return I[0]>=-I[3];if(1===J)return I[1]>=-I[3];if(2===J)return I[0]<=I[3];if(3===J)return I[1]<=I[3];w.assert(!1)}function v(I,J,N){let M=0;0===N?M=(-I[3]-I[0])/(J[0]-I[0]+J[3]-I[3]):1===N?M=(-I[3]-I[1])/(J[1]-I[1]+J[3]-I[3]):2===N?
M=(I[3]-I[0])/(J[0]-I[0]-J[3]+I[3]):3===N&&(M=(I[3]-I[1])/(J[1]-I[1]-J[3]+I[3]));return h.lerp(e.create(),I,J,M)}class y{constructor(){this._items=new b({allocator:I=>I||{object:null,distance:0,near:0,far:0},deallocator:I=>{I.object=null;I.distance=0;I.near=0;I.far=0;return I}})}get length(){return this._items.length}get empty(){return 0===this._items.length}clear(){this._items.clear()}add(I){this._items.pushNew().object=I}sort(I){const J=I.eye,N=I.viewForward;this._items.forAll(M=>{const Q=M.object.boundingVolumeWorldSpace.bounds,
O=(Q[0]-J[0])*N[0]+(Q[1]-J[1])*N[1]+(Q[2]-J[2])*N[2];M.distance=O;M.near=O-Q[3];M.far=O+Q[3]});this._items.sort((M,Q)=>M.distance-Q.distance)}forEachInDepthRange(I,J,N){if(J===l.DepthOrder.FRONT_TO_BACK)for(J=0;J<this._items.length;++J){var M=this._items.data[J];M.far<I.near||M.near>I.far||N(M.object,M.near,M.far)}else for(J=this._items.length-1;0<=J;--J)M=this._items.data[J],M.far<I.near||M.near>I.far||N(M.object,M.near,M.far)}}class B{constructor(){this._view=k.create();this._viewProj=k.create();
this._frustum=g.create();this._geometries=[];this._near=[];this._far=[];this._nearCandidates=[];this._farCandidates=[];this._looseRange={near:0,far:0}}compute(I,J){this._reset();n.copy(this._view,I.viewMatrix);n.multiply(this._viewProj,I.projectionMatrix,this._view);g.copy(this._frustum,I.frustum);I=this._view;const N=I[2],M=I[6],Q=I[10],O=I[14];J.forAll(P=>{P.forEachGeometry(R=>{if(R.visible&&R.castShadow){var W=R.boundingSphere,V=N*W[0]+M*W[1]+Q*W[2]+O,ba=V-W[3];W=V+W[3];this._geometries.push(R);
this._near.push(-W);this._far.push(-ba)}})});J=new c.DepthRange;if(0===this._geometries.length)return J;for(I=0;I<this._geometries.length;++I)this._near[I]>J.far&&(J.far=this._near[I]),2<this._near[I]&&this._far[I]<J.near&&(J.near=this._far[I]);I=this._looseRange;I.near=Math.max(.5*J.near,2);I.far=2*J.far;var K=0;let L=0;for(let P=0;P<this._geometries.length;++P)this._near[P]<J.near&&(this._near[P]>=I.near?J.near=this._near[P]:this._nearCandidates[K++]=P),this._far[P]>J.far&&(this._far[P]<=I.far?
J.far=this._far[P]:this._farCandidates[L++]=P);if(0===this._nearCandidates.length&&0===this._farCandidates.length)return J;this._nearCandidates.sort((P,R)=>this._near[P]<this._near[R]?-1:this._near[P]>this._near[R]?1:0);this._farCandidates.sort((P,R)=>this._far[P]<this._far[R]?1:this._far[P]>this._far[R]?-1:0);for(I=0;I<this._nearCandidates.length;++I)K=this._nearCandidates[I],this._near[K]<J.near&&(K=this._geometries[K],this._includeNearBoundingInfoRec(K.boundingInfo,K.shaderTransformation,J));for(I=
0;I<this._farCandidates.length;++I)K=this._farCandidates[I],this._far[K]>J.far&&(K=this._geometries[K],this._includeFarBoundingInfoRec(K.boundingInfo,K.shaderTransformation,J));this._reset();return J}_reset(){this._geometries.length=0;this._near.length=0;this._far.length=0;this._nearCandidates.length=0;this._farCandidates.length=0}_includeNearBoundingInfoRec(I,J,N){if(null!=I){var M=I.center;p.transformMat4(d.getCenter(C),M,J);M=f.maxScale(J);var Q=C[0],O=C[1],K=C[2];M*=I.radius;var L=this._frustum;
if(!(L[0][0]*Q+L[0][1]*O+L[0][2]*K+L[0][3]>M||L[1][0]*Q+L[1][1]*O+L[1][2]*K+L[1][3]>M||L[2][0]*Q+L[2][1]*O+L[2][2]*K+L[2][3]>M||L[3][0]*Q+L[3][1]*O+L[3][2]*K+L[3][3]>M||(Q=this._view[2]*Q+this._view[6]*O+this._view[10]*K+this._view[14],O=Q+M,2>-(Q-M)||-O>=N.near)))if(-O>this._looseRange.near)N.near=-O;else{if(100<M&&(M=I.getChildren(),void 0!==M)){for(const P of M)this._includeNearBoundingInfoRec(P,J,N);return}D.unionDepthRangeWithAABB(N,this._viewProj,J,I.bbMin,I.bbMax)}}}_includeFarBoundingInfoRec(I,
J,N){if(null!=I){var M=I.radius,Q=I.center;p.transformMat4(d.getCenter(C),Q,J);var O=f.maxScale(J);Q=C[0];var K=C[1],L=C[2];M*=O;O=this._frustum;if(!(O[0][0]*Q+O[0][1]*K+O[0][2]*L+O[0][3]>M||O[1][0]*Q+O[1][1]*K+O[1][2]*L+O[1][3]>M||O[2][0]*Q+O[2][1]*K+O[2][2]*L+O[2][3]>M||O[3][0]*Q+O[3][1]*K+O[3][2]*L+O[3][3]>M||(Q=this._view[2]*Q+this._view[6]*K+this._view[10]*L+this._view[14]-M,-Q<=N.far)))if(-Q<this._looseRange.far)N.far=-Q;else{if(100<M&&(M=I.getChildren(),void 0!==M)){for(const P of M)this._includeFarBoundingInfoRec(P,
J,N);return}D.unionDepthRangeWithAABB(N,this._viewProj,J,I.bbMin,I.bbMax)}}}}class z{constructor(){this._modelViewProj=k.create();this._clipPosition=[e.create(),e.create(),e.create(),e.create(),e.create(),e.create(),e.create(),e.create()]}unionDepthRangeWithAABB(I,J,N,M,Q){var O=this._modelViewProj;n.multiply(O,J,N);J=!1;for(N=0;8>N;++N){var K=this._clipPosition[N],L=0===N||3===N||4===N||7===N?M[0]:Q[0],P=0===N||1===N||4===N||5===N?M[1]:Q[1];const R=4>N?M[2]:Q[2];K[0]=O[0]*L+O[4]*P+O[8]*R+O[12];K[1]=
O[1]*L+O[5]*P+O[9]*R+O[13];K[2]=O[2]*L+O[6]*P+O[10]*R+O[14];K[3]=O[3]*L+O[7]*P+O[11]*R+O[15]}for(M=0;12>M;++M){Q=[this._clipPosition[A[M][0]],this._clipPosition[A[M][1]],this._clipPosition[A[M][2]]];for(O=0;4>O;++O)for(N=Q,Q=[],K=0;K<N.length;++K)L=N[K],P=N[(K+1)%N.length],r(P,O)?(r(L,O)||Q.push(v(L,P,O)),Q.push(P)):r(L,O)&&Q.push(v(L,P,O));O=!0;for(N=0;N<Q.length;++N)if(2<=Q[N][3]){O=!1;break}if(!O)for(J=!0,O=0;O<Q.length;++O)N=Q[O][3],Number.isFinite(N)&&(I.near=Math.min(N,I.near),I.far=Math.max(N,
I.far))}return J}}const A=[[0,1,3],[2,3,1],[1,5,2],[6,2,5],[5,4,6],[7,6,4],[4,0,7],[3,7,0],[3,2,7],[6,7,2],[4,5,0],[1,0,5]],C=d.create(),H=k.create(),E=c.empty(),F=new y,G=new B,D=new z;a.DepthRangeFromRenderGeometries=B;a.depthRangeFromScene=function(I,J,N){let M=0;if(!J.some(O=>{if(!O.material)return!1;M+=O.numGeometries;return 1E4<=M}))return G.compute(I,J);const Q=c.empty();N.forAll(O=>{var K=c.union;if(O.visible){var L=c.empty(),P=O.getSpatialQueryAccelerator();P?x(L,I,P):u(L,I,O.objects);O=
L}else O=void 0;return K.call(c,Q,O)});return Q};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/MainFramebuffer":function(){define("exports ../../../../core/maybe ../../../../chunks/vec42 ../../../../core/libs/gl-matrix-2/factories/vec4f32 ../../../../core/libs/gl-matrix-2/factories/vec4f64 ../../webgl/formats ./BindParameters ../../../webgl/enums ../../../webgl/FramebufferObject".split(" "),function(a,b,n,k,p,h,e,g,d){class f{constructor(c){this._fbos=
c;this._requiresEmission=!1;this._size=new e.ViewportSize(0,0);this._clearColor=p.create()}dispose(){this._color=b.releaseMaybe(this._color);this.releaseDepth()}initialize(c,l,w,x){this._size.width=c;this._size.height=l;d.ensureAttachmentMaxSize(this._size,this._fbos.rctx.parameters.maxTextureSize);c=this._color;this._color=null;this.releaseDepth();this._requiresEmission=x;n.copy(this._clearColor,w);return c}releaseDepth(){this._color?.detachDepth();this._depth=b.releaseMaybe(this._depth)}update(c){const l=
this._ensureColor();l.attachDepth(this.depth);this._color=c(l)}bind(){var c=null==this._color;this.color.attachDepth(this.depth);this._fbos.rctx.bindFramebuffer(this.color.fbo);c&&(c=this._fbos.rctx,c.setClearStencil(0),c.setClearColor(this._clearColor[0],this._clearColor[1],this._clearColor[2],this._clearColor[3]),c.clear(g.FramebufferBit.COLOR|g.FramebufferBit.DEPTH|g.FramebufferBit.STENCIL),this._requiresEmission&&c.gl.clearBufferfv(c.gl.COLOR,1,k.ZEROS))}_acquireColor(){return this._requiresEmission?
this._fbos.acquire(this._size.width,this._size.height,"acquired-color").acquireColor(g.ColorAttachment.COLOR_ATTACHMENT1,h.ColorFormat.RGBA,"emissive"):this._fbos.acquire(this._size.width,this._size.height,"acquired-color")}_acquireDepth(){return this._fbos.acquireDepth(h.DepthFormat.DEPTH_STENCIL_TEXTURE,this._size.width,this._size.height,"depth")}get size(){return this._size}get color(){return this._ensureColor()}get depth(){this._depth??(this._depth=this._acquireDepth());return this._depth}_ensureColor(){this._color??
(this._color=this._acquireColor());return this._color}}a.MainFramebuffer=f;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/libs/gl-matrix-2/factories/vec4f32":function(){define(["exports"],function(a){function b(){return new Float32Array(4)}function n(r){const v=new Float32Array(4);v[0]=r[0];v[1]=r[1];v[2]=r[2];v[3]=r[3];return v}function k(r,v,y,B){const z=new Float32Array(4);z[0]=r;z[1]=v;z[2]=y;z[3]=B;return z}function p(r,v){return new Float32Array(r,v,4)}function h(){return b()}
function e(){return k(1,1,1,1)}function g(){return k(1,0,0,0)}function d(){return k(0,1,0,0)}function f(){return k(0,0,1,0)}function c(){return k(0,0,0,1)}const l=b(),w=e(),x=g(),u=d(),t=f(),m=c(),q=Object.freeze(Object.defineProperty({__proto__:null,ONES:w,UNIT_W:m,UNIT_X:x,UNIT_Y:u,UNIT_Z:t,ZEROS:l,clone:n,create:b,createView:p,fromValues:k,ones:e,unitW:c,unitX:g,unitY:d,unitZ:f,zeros:h},Symbol.toStringTag,{value:"Module"}));a.ONES=w;a.UNIT_W=m;a.UNIT_X=x;a.UNIT_Y=u;a.UNIT_Z=t;a.ZEROS=l;a.clone=
n;a.create=b;a.createView=p;a.fromValues=k;a.ones=e;a.unitW=c;a.unitX=g;a.unitY=d;a.unitZ=f;a.vec4f32=q;a.zeros=h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/RenderPluginInput":function(){define(["exports"],function(a){class b{constructor(){this._inputs=new Map}set(n,k){this._inputs.set(n,k)}get(n){return this._inputs.get(n)}has(n){return this._inputs.has(n)}release(n){this._inputs.get(n)?.release()&&this._inputs.delete(n)}}a.RenderPluginInput=b;
Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/ShadowAccumulator":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/arrayUtils ../../../../core/has ../../../../core/mathUtils ../../../../core/maybe ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/Logger ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../core/shaderLibrary/shading/ReadShadowMap.glsl ./BindParameters ./depthRange ./glUtil3D ./ShadowCastRenderer ./ShadowMap ../../../../chunks/ShadowCastAccumulate.glsl ../shaders/ShadowCastAccumulateTechnique ../../../support/Scheduler ../../../webgl/enums ../../../webgl/FramebufferObject ../../../webgl/TextureDescriptor ../../../webgl/Util".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w,x,u,t,m,q,r,v,y,B,z,A,C,H){a.ShadowAccumulator=class extends n{constructor(F,G,D,I,J,N){super({});this.fbos=F;this._techniques=G;this._stage=D;this._prepareForShadowMapPass=I;this._renderToShadowMap=J;this._requestRender=N;this._sampleCount=this._progress=0;this._passParameters=new x.ReadShadowMapPassParameters;this._cachedLightDirections=[];this._depthRange=t.zero;this._cameraForcedForScreenshot=this._previewing=!1;this._shadowAccumulatorKey="shadowAccumulator";
this._rctx=F.rctx;this._bindParameters=new u.BindParameters(new r.ShadowMap(F,D.viewingMode));this._bindParameters.shadowMap.enabled=!0;this._vao=m.createQuadVAO(this._rctx);this._accumulationRenderer=new q.ShadowCastRenderer(G,this._rctx,this,N);this.addHandles([this._stage.view.resourceController.scheduler.registerTask(B.TaskPriority.SHADOW_ACCUMULATOR,this),g.watch(()=>D.renderView,M=>{this.removeHandles("renderView");null!=M&&this.addHandles(M.events.on("force-camera-for-screenshot",()=>this._cameraForcedForScreenshot=
!0),"renderView")},g.syncAndInitial),g.watch(()=>this._previewing,()=>this._requestRenderIfEnabled(),g.sync)],this._shadowAccumulatorKey);G.precompile(y.ShadowCastAccumulateTechnique)}normalizeCtorArgs(){return{}}dispose(){this._disable();this.removeHandles(this._shadowAccumulatorKey);this._accumulationRenderer=e.disposeMaybe(this._accumulationRenderer);this._bindParameters.shadowMap.dispose();this._fbo=e.disposeMaybe(this._fbo);this._vao=e.disposeMaybe(this._vao);this._sampleCount=this._cachedLightDirections.length=
0}get computedSamples(){return this._progress}get shadowCastTexture(){return this._fbo?.colorTexture}get isAccumulating(){return this._isPreviewing||this._isRefining}get _isRefining(){return this._isActive&&!this._isDoneAccumulating&&!this._previewing}get _isPreviewing(){return this._isActive&&this._previewing}get _isActive(){return null!=this._fbo&&0<this._sampleCount}get canAccumulate(){return null!=this._bindParameters.depth&&this._depthRange!==t.zero&&this._opacityFromElevation>q.shadowCastDisabledElevationThreshold}get _isDoneAccumulating(){return this._progress>=
this._sampleCount}get _lightDirections(){return this._cachedLightDirections}set _lightDirections(F){const G=this._cachedLightDirections;if(!k.equals(G,F,l.equals)){var D=Math.min(v.ShadowCastMaxSamples,F.length);this._sampleCount=G.length=D;for(let I=0;I<D;++I)G[I]=l.copy(G[I]??w.create(),F[I]);this._invalidate()}}get _opacityFromElevation(){return this._accumulationRenderer.opacityFromElevation}set _opacityFromElevation(F){this._accumulationRenderer.opacityFromElevation=F}get running(){return this._isRefining&&
this.canAccumulate&&0<this._progress}runTask(F){for(this._prepareForShadowMapPass(this._bindParameters);!F.done&&!this._isDoneAccumulating;)this._accumulateShadow(),F.madeProgress();this._requestRender()}renderAccumulation(F,G,D,I){this._depthRange=G;this._updateCamera(D);this._bindParameters.contentCamera=I;this._bindParameters.depth=F;this._passParameters.origin=this._bindParameters.camera.center;this.notifyChange("canAccumulate");if(!this.isAccumulating||!this.canAccumulate)return!1;(this._previewing||
0===this._progress||this._cameraForcedForScreenshot)&&this._clear();F=this._cameraForcedForScreenshot?this._sampleCount:Math.min(6,this._sampleCount-this._progress);for(G=0;G<F;++G)this._accumulateShadow();this._cameraForcedForScreenshot=!1;this._requestRender();return 0<F}precompile(){this._accumulationRenderer.precompile()}render(F){this._accumulationRenderer.render(F)}setOptions(F){void 0!==F.enabled&&F.enabled!==(null!=this._fbo)&&(F.enabled?this._enable():this._disable());void 0!==F.previewing&&
(this._previewing=F.previewing);void 0!==F.lightDirections&&(this._lightDirections=F.lightDirections);this._accumulationRenderer.setOptions(F)}readAccumulatedShadow(F,G){if(!this._isActive||!this._fbo||1>this._progress||0>F||F>=this._fbo.width||0>G||G>=this._fbo.height)return 0;this._fbo.readPixels(F,G,1,1,z.PixelFormat.RGBA,z.PixelType.UNSIGNED_BYTE,E);return E[0]/this._progress}_enable(){this._progress=0;const F=new C.TextureDescriptor;F.pixelFormat=z.PixelFormat.RED;F.internalFormat=z.SizedPixelFormat.R8;
F.wrapMode=z.TextureWrapMode.CLAMP_TO_EDGE;this._fbo=new A.FramebufferObject(this._rctx,F);this._requestRender()}_disable(){this._fbo=e.disposeMaybe(this._fbo);this._requestRender()}_invalidate(){this._progress=0;this._requestRenderIfEnabled()}_clear(){this._rctx.bindFramebuffer(this._fbo);this._rctx.setClearColor(0,0,0,0);this._rctx.clear(z.FramebufferBit.COLOR);this._progress=0}_accumulateShadow(){this._renderToShadowMap(this._bindParameters,this._lightDirections[this._progress++],this._depthRange);
const F=this._techniques.acquire(y.ShadowCastAccumulateTechnique);this._rctx.bindFramebuffer(this._fbo);this._rctx.bindTechnique(F,this._bindParameters,this._passParameters);this._rctx.bindVAO(this._vao);this._rctx.drawArrays(F.primitiveType,0,H.vertexCount(this._vao,"geometry"));F.release()}_updateCamera(F){const G=this._fbo;if(null!=G){var D=this._bindParameters.camera;F.equals(D)||D.copyFrom(F);G.resize(F.fullWidth,F.fullHeight);this._opacityFromElevation=1-h.smoothstep(q.shadowCastDisableElevationMin,
q.shadowCastDisableElevationMax,F.relativeElevation)}}_requestRenderIfEnabled(){this._fbo&&this._requestRender()}get test(){}};b.__decorate([d.property()],a.ShadowAccumulator.prototype,"_progress",void 0);b.__decorate([d.property()],a.ShadowAccumulator.prototype,"_sampleCount",void 0);b.__decorate([d.property()],a.ShadowAccumulator.prototype,"_fbo",void 0);b.__decorate([d.property()],a.ShadowAccumulator.prototype,"_depthRange",void 0);b.__decorate([d.property()],a.ShadowAccumulator.prototype,"_previewing",
void 0);b.__decorate([d.property()],a.ShadowAccumulator.prototype,"_accumulationRenderer",void 0);b.__decorate([d.property()],a.ShadowAccumulator.prototype,"_isRefining",null);b.__decorate([d.property()],a.ShadowAccumulator.prototype,"_isActive",null);b.__decorate([d.property()],a.ShadowAccumulator.prototype,"canAccumulate",null);b.__decorate([d.property()],a.ShadowAccumulator.prototype,"_isDoneAccumulating",null);b.__decorate([d.property()],a.ShadowAccumulator.prototype,"_opacityFromElevation",null);
b.__decorate([d.property()],a.ShadowAccumulator.prototype,"running",null);a.ShadowAccumulator=b.__decorate([c.subclass("esri.views.3d.webgl-engine.lib.ShadowAccumulator")],a.ShadowAccumulator);const E=new Uint8Array(4);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/ShadowCastRenderer":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/maybe ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/Logger ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec42 ./glUtil3D ../../../../chunks/ShadowCastVisualize.glsl ../shaders/ShadowCastVisualizeTechnique ../shaders/ShadowCastVisualizeTechniqueConfiguration ../../../webgl/Util".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w,x,u){const t=1/512;a.ShadowCastRenderer=class extends n{constructor(m,q,r,v){super({});this._techniques=m;this._rctx=q;this._data=r;this._requestRender=v;this._passParameters=new l.ShadowCastVisualizePassParameters(this._data);this._configuration=new x.ShadowCastVisualizeTechniqueConfiguration;this._enabled=!1;this._vao=c.createQuadVAO(q)}dispose(){this._stop();this._vao=k.disposeMaybe(this._vao)}precompile(){this._showVisualization&&this._techniques.precompile(w.ShadowCastVisualizeTechnique,
this._configuration)}render(m){if(this._showVisualization){this._passParameters.sampleScale=1/this._data.computedSamples;var q=this._techniques.acquire(w.ShadowCastVisualizeTechnique,this._configuration);this._rctx.bindVAO(this._vao);this._rctx.bindTechnique(q,m,this._passParameters);this._rctx.drawArrays(q.primitiveType,0,u.vertexCount(this._vao,"geometry"));q.release()}}setOptions(m){void 0!==m.enabled&&this._setEnabled(m.enabled);void 0!==m.color&&this._setColor(m.color);void 0!==m.threshold&&
(this._threshold=m.threshold);void 0!==m.visualization&&(this._visualization=m.visualization);void 0!==m.bandSize&&(this._bandSize=m.bandSize);void 0!==m.bandsEnabled&&(this._bandsEnabled=m.bandsEnabled)}get opacityFromElevation(){return this._passParameters.opacityFromElevation}set opacityFromElevation(m){this._passParameters.opacityFromElevation!==m&&(this._passParameters.opacityFromElevation=m,this.notifyChange("opacityFromElevation"))}get _showVisualization(){return this._enabled&&0<this._data.computedSamples&&
this.opacityFromElevation>t}get _threshold(){return this._passParameters.threshold}set _threshold(m){this._threshold!==m&&(this._passParameters.threshold=m,this._requestRenderIfEnabled())}get _visualization(){return this._configuration.visualization}set _visualization(m){m!==this._visualization&&(this._configuration.visualization=m,this._requestRenderIfEnabled())}get _bandSize(){return this._passParameters.bandSize}set _bandSize(m){m!==this._bandSize&&(this._passParameters.bandSize=m,this._requestRenderIfEnabled())}get _bandsEnabled(){return this._configuration.bandsEnabled}set _bandsEnabled(m){m!==
this._bandsEnabled&&(this._configuration.bandsEnabled=m,this._requestRenderIfEnabled())}_setColor(m){f.exactEquals(m,this._passParameters.color)||(f.copy(this._passParameters.color,m),this._requestRenderIfEnabled())}_setEnabled(m){m!==this._enabled&&(m?this._start():this._stop())}_requestRenderIfEnabled(){this._enabled&&this._requestRender()}_start(){this._enabled=!0;this._requestRender()}_stop(){this._enabled=!1;this._requestRender()}};b.__decorate([p.property()],a.ShadowCastRenderer.prototype,"opacityFromElevation",
null);a.ShadowCastRenderer=b.__decorate([d.subclass("esri.views.3d.webgl-engine.lib.ShadowCastRenderer")],a.ShadowCastRenderer);a.shadowCastDisableElevationMax=5E4;a.shadowCastDisableElevationMin=4E4;a.shadowCastDisabledElevationThreshold=t;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/ShadowCastVisualize.glsl":function(){define("exports ../core/libs/gl-matrix-2/factories/vec4f64 ../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/CameraSpace.glsl ../views/3d/webgl-engine/core/shaderModules/Float4PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform ./ShadowCastAccumulate.glsl ../views/3d/webgl-engine/shaders/ShadowCastVisualizeTechniqueConfiguration".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c){function l(t){const m=new g.ShaderBuilder,q=m.fragment;m.include(k.CameraSpace);m.include(n.ScreenSpacePass);const {visualization:r,bandsEnabled:v}=t;q.constants.add("inverseSampleValue","float",f.ShadowCastMaxSamples);q.uniforms.add(new d.Texture2DPassUniform("shadowCastMap",B=>B.shadowCastMap),new h.FloatPassUniform("sampleScale",B=>B.sampleScale),new h.FloatPassUniform("opacityFromElevation",B=>B.opacityFromElevation),new p.Float4PassUniform("uColor",B=>B.color));
t=r===c.ShadowCastVisualization.Gradient;const y=r===c.ShadowCastVisualization.Threshold;t&&v?q.uniforms.add(new h.FloatPassUniform("bandSize",B=>B.bandSize)):y&&q.uniforms.add(new h.FloatPassUniform("threshold",B=>B.threshold));q.main.add(e.glsl`
    float record = texture(shadowCastMap, uv).r;
    float pixelSamples = record * inverseSampleValue;

    fragColor = vec4(0.0);
    if (pixelSamples < 1.0) {
      return;
    }

    float strength = pixelSamples * sampleScale;
    ${y?e.glsl`if (strength <= threshold) return;`:""}
    ${t&&v?e.glsl`strength = ceil(strength / bandSize) * bandSize;`:""}
    fragColor = vec4(uColor.xyz, uColor.a * opacityFromElevation ${t?"* strength":""});
  `);return m}class w extends e.NoParameters{constructor(t){super();this._data=t;this.sampleScale=0;this.opacityFromElevation=1;this.color=b.clone(x);this.bandSize=.1;this.threshold=.5}get shadowCastMap(){return this._data.shadowCastTexture}}const x=b.fromValues(.01,0,.25,1),u=Object.freeze(Object.defineProperty({__proto__:null,ShadowCastVisualizePassParameters:w,build:l},Symbol.toStringTag,{value:"Module"}));a.ShadowCastVisualize=u;a.ShadowCastVisualizePassParameters=w;a.build=l})},"esri/chunks/ShadowCastAccumulate.glsl":function(){define("exports ../core/libs/gl-matrix-2/math/mat4 ../core/libs/gl-matrix-2/factories/mat4f64 ../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/ReadDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ReadShadowMap.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/CameraSpace.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/RgbaFloatEncoding.glsl ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/Matrix4PassUniform ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform ../views/3d/webgl-engine/shaders/ReadShadowMapConfiguration".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w){function x(){const q=new c.ShaderBuilder,r=q.fragment;r.include(g.RgbaFloatEncoding);r.include(p.ReadDepth);q.include(e.CameraSpace);q.include(k.ScreenSpacePass);q.include(h.ReadShadowMapPass,m);r.uniforms.add(new l.Texture2DPassUniform("shadowMap",(v,y)=>y.shadowMap.depthTexture),new l.Texture2DPassUniform("depthMap",(v,y)=>y.depth?.attachment),new f.Matrix4PassUniform("inverseViewMatrix",(v,y)=>b.invert(t,b.translate(t,y.camera.viewMatrix,y.camera.center))));
r.constants.add("sampleValue","float",u);q.outputs.add("sampleCount","float");r.main.add(d.glsl`sampleCount = 0.0;
float depth = depthFromTexture(depthMap, uv);
if (depth >= 1.0 || depth <= 0.0) {
return;
}
float currentPixelDepth = linearizeDepth(depth);
vec4 currentPixelPos = vec4(reconstructPosition(gl_FragCoord.xy, currentPixelDepth), 1.0);
vec4 worldSpacePos = inverseViewMatrix * currentPixelPos;
mat4 shadowMatrix;
float linearDepth = -currentPixelDepth;
int i = chooseCascade(linearDepth, shadowMatrix);
if (i >= numCascades) {
return;
}
vec3 lvpos = lightSpacePosition(worldSpacePos.xyz, shadowMatrix);
if (lvpos.z >= 1.0 || lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) {
return;
}
ivec2 texSize = textureSize(shadowMap, 0);
ivec2 uvShadow = ivec2(cascadeCoordinates(i, texSize, lvpos) * vec2(texSize));
float depthShadow = readShadowMapDepth(uvShadow, shadowMap);
bool shadow = depthShadow < lvpos.z;
if (shadow) {
sampleCount = sampleValue;
}`);return q}const u=1/255,t=n.create(),m=new w.ReadShadowMapConfiguration;n=Object.freeze(Object.defineProperty({__proto__:null,ShadowCastMaxSamples:255,build:x},Symbol.toStringTag,{value:"Module"}));a.ShadowCastAccumulate=n;a.ShadowCastMaxSamples=255;a.build=x})},"esri/views/3d/webgl-engine/shaders/ShadowCastVisualizeTechniqueConfiguration":function(){define(["exports","../../../../chunks/tslib.es6","../core/shaderTechnique/ShaderTechniqueConfiguration"],function(a,b,n){a.ShadowCastVisualization=
void 0;(function(p){p[p.Gradient=0]="Gradient";p[p.Threshold=1]="Threshold";p[p.COUNT=2]="COUNT"})(a.ShadowCastVisualization||(a.ShadowCastVisualization={}));class k extends n.ShaderTechniqueConfiguration{constructor(){super(...arguments);this.visualization=a.ShadowCastVisualization.Gradient;this.bandsEnabled=!1}}b.__decorate([n.parameter({count:a.ShadowCastVisualization.COUNT})],k.prototype,"visualization",void 0);b.__decorate([n.parameter()],k.prototype,"bandsEnabled",void 0);a.ShadowCastVisualizeTechniqueConfiguration=
k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/ShadowCastVisualizeTechnique":function(){define("require exports ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../../../../chunks/ShadowCastVisualize.glsl ../../../webgl/enums ../../../webgl/renderState".split(" "),function(a,b,n,k,p,h,e){class g extends k.ShaderTechnique{constructor(d,f,c){super(d,f,new n.ReloadableShaderModule(p.ShadowCastVisualize,()=>new Promise((l,
w)=>a(["./ShadowCastVisualize.glsl"],l,w))),c);this.primitiveType=h.PrimitiveType.TRIANGLE_STRIP}initializePipeline(){return e.makePipelineState({blending:e.premultipliedAlphaToPremultipliedAlpha,colorWrite:e.defaultColorWrite,depthTest:null,depthWrite:null})}}b.ShadowCastVisualizeTechnique=g;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/ShadowCastAccumulateTechnique":function(){define("require exports ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../../../../chunks/ShadowCastAccumulate.glsl ../../../webgl/enums ../../../webgl/renderState".split(" "),
function(a,b,n,k,p,h,e){class g extends k.ShaderTechnique{constructor(d,f,c){super(d,f,new n.ReloadableShaderModule(p.ShadowCastAccumulate,()=>new Promise((l,w)=>a(["./ShadowCastAccumulate.glsl"],l,w))),c);this.primitiveType=h.PrimitiveType.TRIANGLE_STRIP}initializePipeline(){return e.makePipelineState({blending:e.weightedAdd,colorWrite:e.defaultColorWrite,depthTest:null,depthWrite:null})}}b.ShadowCastAccumulateTechnique=g;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/SliceHelper":function(){define(["../../../../chunks/boundedPlane"],
function(a){const b=a.create();class n{constructor(){this._plane=a.create()}get plane(){return this._plane}set plane(k){a.copy(k||b,this._plane)}}return n})},"esri/views/3d/webgl-engine/statistics/RendererPerformanceInfo":function(){define("exports ../../../../core/maybe ../../../../core/PerformanceSampler ../../../../core/time ../../webgl ../../../webgl/TimerPool".split(" "),function(a,b,n,k,p,h){a.PerformanceCategory=void 0;(function(d){d.OVERLAY="overlay";d.PREPARE="prepare";d.SHADOW_MAP="shadow map";
d.DEPTH="depth";d.ACCUMULATED_SHADOWS="accumulated shadows";d.APPLY_ACCUMULATED_SHADOWS="apply accumulated shadows";d.OBJECT_AND_LAYER_ID_COLOR="object/layer id color";d.NORMALS="normals";d.SSAO="SSAO";d.HIGHLIGHTS="highlights";d.OPAQUE_EDGES="opaque edges";d.VOXEL="voxel";d.TRANSPARENT="transparent";d.TRANSPARENT_EDGES="transparent edges";d.HUD_VISIBILITY="HUD visibility";d.TRANSPARENT_TERRAIN="transparent terrain";d.TRANSPARENT_MATERIAL_WITHOUT_DEPTH="transparent material without depth";d.OPAQUE_ENVIRONMENT=
"opaque environment";d.TRANSPARENT_ENVIRONMENT="transparent environment";d.OCCLUDED="occluded";d.HUD="HUD";d.HUD_OCCLUDED="HUD occluded";d.FINISH="finish"})(a.PerformanceCategory||(a.PerformanceCategory={}));const e=Object.values(p.RenderCategory).concat(Object.values(p.InternalRenderCategory)).concat(Object.values(a.PerformanceCategory));class g{constructor(d){this._rctx=d;this._startTimeStampCPU=k.Milliseconds(0);this._lastTimeStampCPU=k.Milliseconds(0);this._totalCPUTime=new n("Total");this._cpuTimeSamplers=
new Map(e.map(f=>[f,new n(f)]));this._enableGPUTimer=0;this._totalGPUTime=new n("GPU");this._gpuTimeSamplers=new Map(e.map(f=>[f,new n(f)]));this._totalTime=k.Milliseconds(0);this._totalFrameCount=0}get totalCPUTimeSampler(){return this._totalCPUTime}get cpuTimeSamplers(){return Array.from(this._cpuTimeSamplers.values())}get totalGPUTimeSampler(){return this._totalGPUTime}get gpuTimeSamplers(){return Array.from(this._gpuTimeSamplers.values())}get gpuSamplingEnabled(){return null!=this._gpuTimerPool}get totalTime(){return this._totalTime}get totalFrameCount(){return this._totalFrameCount}get elapsedTime(){return k.Milliseconds(performance.now()-
this._startTimeStampCPU)}enableGPUPerformanceInfo(){if(null==this._gpuTimerPool){const f=[...e,"Total"];this._gpuTimerPool=h.createElapsedTimerPool(this._rctx,f)}if(null==this._gpuTimerPool)return{hasGPUTimerSupport:!1,remove:()=>{}};++this._enableGPUTimer;let d=!1;return{hasGPUTimerSupport:!0,remove:()=>{d||(d=!0,--this._enableGPUTimer,0===this._enableGPUTimer&&(this._gpuTimerPool=b.disposeMaybe(this._gpuTimerPool)))}}}startFrame(){this._startTimeStampCPU=this._lastTimeStampCPU=k.Milliseconds(performance.now());
this._gpuTimerPool&&(this._gpuTimeSamplers.forEach(d=>d.push(0)),this._gpuTimerPool.start())}advance(d){var f=k.Milliseconds(performance.now());this._cpuTimeSamplers.get(d).push(f-this._lastTimeStampCPU);this._lastTimeStampCPU=f;this._gpuTimerPool&&(f=this._gpuTimerPool.stop(d),this._gpuTimeSamplers.get(d).set(f),this._gpuTimerPool.start())}finishFrame(){if(this._gpuTimerPool){var d=this._gpuTimerPool.stop(a.PerformanceCategory.FINISH);this._gpuTimeSamplers.get(a.PerformanceCategory.FINISH).set(d);
this._rctx.gl.flush()}d=k.Milliseconds(performance.now()-this._startTimeStampCPU);this._totalTime=k.Milliseconds(this._totalTime+d);this._totalCPUTime.push(d);this._gpuTimerPool&&this._totalGPUTime.push(this.gpuTimeSamplers.reduce((f,c)=>f+(c.last||0),0));++this._totalFrameCount}}a.PerformanceCategories=e;a.RendererPerformanceInfo=g;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/TimerPool":function(){define(["exports","./capabilities/DisjointTimerQuery"],function(a,
b){class n{constructor(k,p){this._timer=k;this._queryPool=[];this._queryResults=new Map;this._currentQuery=null;p.forEach(h=>{const e=this._timer.createQuery(),g=this._timer.createQuery();this._queryPool.push(e,g);this._queryResults.set(h,null)})}start(){b.hasRunningElapsedTimer||(this._currentQuery=this._queryPool.pop(),null!=this._currentQuery&&(this._timer.disjoint(),this._timer.beginTimeElapsed(this._currentQuery)))}stop(k){if(this._timer.disjoint()||null==this._currentQuery||!this._queryResults.has(k))return this.abort(),
null;this._timer.endTimeElapsed();const p=this._queryResults.get(k);if(null==p)return this._queryResults.set(k,this._currentQuery),this._currentQuery=null;if(!this._timer.resultAvailable(p))return this._queryPool.unshift(this._currentQuery),this._currentQuery=null;const h=this._timer.getResult(p)/1E6;this._queryPool.unshift(p);this._queryResults.set(k,this._currentQuery);this._currentQuery=null;return h}abort(){null!=this._currentQuery&&(this._timer.deleteQuery(this._currentQuery),this._queryPool.unshift(this._timer.createQuery()),
this._currentQuery=null)}dispose(){null!=this._currentQuery&&this._timer.deleteQuery(this._currentQuery);this._queryPool.forEach(k=>{this._timer.deleteQuery(k)});this._queryResults.forEach(k=>{null!=k&&this._timer.deleteQuery(k)})}}a.createElapsedTimerPool=function(k,p){k=k.capabilities.disjointTimerQuery;return null==k?null:new n(k,p)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/capabilities/DisjointTimerQuery":function(){define(["exports"],function(a){class b{constructor(n,
k,p,h,e,g,d,f,c){this.createQuery=n;this.deleteQuery=k;this.resultAvailable=p;this.getResult=h;this.disjoint=e;this.beginTimeElapsed=g;this.endTimeElapsed=d;this.createTimestamp=f;this.timestampBits=c}}a.hasRunningElapsedTimer=!1;a.DisjointTimerQuery=b;a.createDisjointTimerQuery=function(n,k){if(k.disjointTimerQuery)return null;let p=n.getExtension("EXT_disjoint_timer_query_webgl2");return p?new b(()=>n.createQuery(),h=>{n.deleteQuery(h);a.hasRunningElapsedTimer=!1},h=>n.getQueryParameter(h,n.QUERY_RESULT_AVAILABLE),
h=>n.getQueryParameter(h,n.QUERY_RESULT),()=>n.getParameter(p.GPU_DISJOINT_EXT),h=>{a.hasRunningElapsedTimer||(a.hasRunningElapsedTimer=!0,n.beginQuery(p.TIME_ELAPSED_EXT,h))},()=>{n.endQuery(p.TIME_ELAPSED_EXT);a.hasRunningElapsedTimer=!1},h=>p.queryCounterEXT(h,p.TIMESTAMP_EXT),()=>n.getQuery(p.TIMESTAMP_EXT,p.QUERY_COUNTER_BITS_EXT)):(p=n.getExtension("EXT_disjoint_timer_query"))?new b(()=>p.createQueryEXT(),h=>{p.deleteQueryEXT(h);a.hasRunningElapsedTimer=!1},h=>p.getQueryObjectEXT(h,p.QUERY_RESULT_AVAILABLE_EXT),
h=>p.getQueryObjectEXT(h,p.QUERY_RESULT_EXT),()=>n.getParameter(p.GPU_DISJOINT_EXT),h=>{a.hasRunningElapsedTimer||(a.hasRunningElapsedTimer=!0,p.beginQueryEXT(p.TIME_ELAPSED_EXT,h))},()=>{p.endQueryEXT(p.TIME_ELAPSED_EXT);a.hasRunningElapsedTimer=!1},h=>p.queryCounterEXT(h,p.TIMESTAMP_EXT),()=>p.getQueryEXT(p.TIMESTAMP_EXT,p.QUERY_COUNTER_BITS_EXT)):null};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/RenderingContext":function(){define("exports ../../../../core/has ../../../../core/NestedMap ../effects/ScreenSpaceGeometry ../materials/renderers/VaoCache ../../../webgl/AppleAmdDriverHelper ../../../webgl/RenderingContext".split(" "),
function(a,b,n,k,p,h,e){class g extends e.RenderingContext{constructor(d,f){super(d,f);this.gl=d;this._vaoCaches=new n.NestedMap;this._appleAmdDriverHelper=null;this._refCount=1;this._newCache=f.newCache;this.screen=new k.ScreenSpaceGeometry(this)}configure(d){super.configure(d);this._newCache=d.newCache}destroy(){this._vaoCaches?.forAll(d=>d.dispose());this._vaoCaches?.clear();0<--this._refCount||this.dispose()}ref(){++this._refCount}dispose(){super.dispose();this._appleAmdDriverHelper?.dispose();
this.screen.destroy();this._vaoCaches.forAll(d=>d.dispose());this._vaoCaches.clear()}get newCache(){return this._newCache}getVaoCache(d,f){const c=Array.from(d).join("."),l=JSON.stringify(f),w=this._vaoCaches.get(c,l);if(w)return w;d=new p.VaoCache(this,d,f);this._vaoCaches.set(c,l,d);return d}bindTechnique(d,f,c,l){this.useProgram(d.program);this.setPipelineState(d.getPipeline());c&&(d.program.bindPass(c,f),l&&d.program.bindDraw(f,c,l));return d.program}runAppleAmdDriverHelper(){this.driverTest.drawArraysRequiresIndicesTypeReset.result&&
(this._appleAmdDriverHelper??(this._appleAmdDriverHelper=new h.AppleAmdDriverHelper(this)),this._appleAmdDriverHelper.run())}get test(){}}a.RenderingContext=g;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/effects/ScreenSpaceGeometry":function(){define("exports ../../../../core/has ../../../../core/maybe ../lib/DefaultVertexAttributeLocations ../lib/DefaultVertexBufferLayouts ../lib/VertexArrayObject ../../../webgl/BufferObject ../../../webgl/enums".split(" "),
function(a,b,n,k,p,h,e,g){function d(c,l=p.Pos2,w=k.Default3D){const x=new Float32Array([-1,-1,3,-1,-1,3]);return new h.VertexArrayObject(c,w,new Map([["geometry",l]]),new Map([["geometry",e.BufferObject.createVertex(c,g.Usage.STATIC_DRAW,x)]]))}class f{constructor(c){this._rctx=c;this._vao=d(c)}destroy(){this._vao=n.disposeMaybe(this._vao)}draw(){null!=this._vao&&(this._rctx.bindVAO(this._vao),this._rctx.drawArrays(g.PrimitiveType.TRIANGLES,0,3))}get test(){}}a.ScreenSpaceGeometry=f;Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/renderers/VaoCache":function(){define(["exports","../../../../../core/MemCachePool","../../lib/VertexArrayObject","../../../../webgl/BufferObject","../../../../webgl/enums"],function(a,b,n,k,p){class h{constructor(e,g,d){this._rctx=e;this._locations=g;this._layout=d;this._cache=new b.MemCachePool(e.newCache,"VAOCache")}dispose(){this._cache.destroy()}newVao(e){let g=this._cache.pop(e.toString());if(g)return g;g=new n.VertexArrayObject(this._rctx,
this._locations,new Map([["geometry",this._layout]]),new Map([["geometry",k.BufferObject.createVertex(this._rctx,p.Usage.STATIC_DRAW)]]));g.vertexBuffers.get("geometry")?.setSize(e);return g}deleteVao(e){null!=e&&this._cache.put(e.byteSize.toString(),e)}}a.VaoCache=h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/AppleAmdDriverHelper":function(){define(["exports","../../core/has","./BufferObject","./enums"],function(a,b,n,k){class p{constructor(h){this._rctx=h;this._indexBuffer=
this._createIndexbuffer();this._program=this._createHelperProgram()}static getShaderSources(){return{vertex:"#version 300 es\n    precision highp float;\n\n    void main(void) {\n      gl_Position \x3d vec4(0.0, 0.0, float(gl_VertexID)-2.0, 1.0);\n    }",fragment:"#version 300 es\n    precision highp float;\n\n    out vec4 fragColor;\n\n    void main(void) {\n      fragColor \x3d vec4(0.0, 0.0, 0.0, 1.0);\n    }"}}_createHelperProgram(){const h=p.getShaderSources();return this._rctx.programCache.acquire(h.vertex,
h.fragment,new Map([]))}_createIndexbuffer(){return n.BufferObject.createIndex(this._rctx,k.Usage.STATIC_DRAW,new Uint32Array([0]))}run(){this._program.compiled&&this._indexBuffer&&(this._rctx.bindVAO(null),this._rctx.useProgram(this._program),this._rctx.bindBuffer(this._indexBuffer,k.BufferType.ELEMENT_ARRAY_BUFFER),this._rctx.drawElements(k.PrimitiveType.POINTS,1,k.DataType.UNSIGNED_INT,0))}dispose(){this._program.dispose();this._indexBuffer.dispose()}get test(){}}a.AppleAmdDriverHelper=p;Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/RenderingContext":function(){define("exports ../../core/has ../../core/maybe ../../core/promiseUtils ../../core/time ./checkWebGLError ./ContextState ./enums ./InstanceCounter ./Parameters ./ProgramCache ./renderState ./Texture ./Util ./WebGLDriverTest ./capabilities/Capabilities".split(" "),function(a,b,n,k,p,h,e,g,d,f,c,l,w,x,u,t){function m(r,v,y,B){v?B!==v&&r.bindBuffer(y,v.glName):r.bindBuffer(y,null);return v}function q(r,v){switch(r){case g.PrimitiveType.POINTS:return 2*
v;case g.PrimitiveType.TRIANGLES:return v/3;case g.PrimitiveType.TRIANGLE_STRIP:return v-2;case g.PrimitiveType.TRIANGLE_FAN:return v-2;default:return 0}}a.RenderingContext=class{constructor(r,v){this.gl=r;this.instanceCounter=new d.InstanceCounter;this.programCache=new c.ProgramCache(this);this._transformFeedbackRequestInfo=null;this._state=new e.ContextState;this._numOfTriangles=this._numOfDrawCalls=0;this._loadExtensions();this.configure(v)}configure(r){this._capabilities=new t.Capabilities(this.gl,
r);this._parameters=new f.Parameters(this.gl,this._capabilities,r);w.Texture.TEXTURE_UNIT_FOR_UPDATES=this._parameters.maxTextureImageUnits-1;r=this.gl.getParameter(this.gl.VIEWPORT);this._state=new e.ContextState;this._state.viewport={x:r[0],y:r[1],width:r[2],height:r[3]};this._stateTracker=new l.StateTracker({setBlending:v=>{v?(this.setBlendingEnabled(!0),this.setBlendEquationSeparate(v.opRgb,v.opAlpha),this.setBlendFunctionSeparate(v.srcRgb,v.dstRgb,v.srcAlpha,v.dstAlpha),v=v.color,this.setBlendColor(v.r,
v.g,v.b,v.a)):this.setBlendingEnabled(!1)},setCulling:v=>{v?(this.setFaceCullingEnabled(!0),this.setCullFace(v.face),this.setFrontFace(v.mode)):this.setFaceCullingEnabled(!1)},setPolygonOffset:v=>{v?(this.setPolygonOffsetFillEnabled(!0),this.setPolygonOffset(v.factor,v.units)):this.setPolygonOffsetFillEnabled(!1)},setDepthTest:v=>{v?(this.setDepthTestEnabled(!0),this.setDepthFunction(v.func)):this.setDepthTestEnabled(!1)},setStencilTest:v=>{if(v){this.setStencilTestEnabled(!0);const y=v.function;
this.setStencilFunction(y.func,y.ref,y.mask);v=v.operation;this.setStencilOp(v.fail,v.zFail,v.zPass)}else this.setStencilTestEnabled(!1)},setDepthWrite:v=>{v?(this.setDepthWriteEnabled(!0),this.setDepthRange(v.zNear,v.zFar)):this.setDepthWriteEnabled(!1)},setColorWrite:v=>{v?this.setColorMask(v.r,v.g,v.b,v.a):this.setColorMask(!1,!1,!1,!1)},setStencilWrite:v=>{v?this.setStencilWriteMask(v.mask):this.setStencilWriteMask(0)},setDrawBuffers:v=>{v?this.setDrawBuffers(v.buffers):({drawFramebuffer:v}=this._state,
null===v?this.setDrawBuffers([g.SpecialDrawBuffers.BACK]):0===v.colorAttachments.length?this.setDrawBuffers([g.SpecialDrawBuffers.NONE]):this.setDrawBuffers([g.ColorAttachment.COLOR_ATTACHMENT0]))}});this.enforceState();n.disposeMaybe(this._driverTest);this._driverTest=new u.WebGLDriverTest(this)}dispose(){n.disposeMaybe(this._driverTest);this.programCache.dispose();this.bindVAO(null);this.unbindBuffer(g.BufferType.ARRAY_BUFFER);this.unbindBuffer(g.BufferType.ELEMENT_ARRAY_BUFFER);this.unbindBuffer(g.BufferType.UNIFORM_BUFFER);
this._state.uniformBufferBindingPoints.length=0;this.unbindBuffer(g.BufferType.PIXEL_PACK_BUFFER);this.unbindBuffer(g.BufferType.PIXEL_UNPACK_BUFFER);this.unbindBuffer(g.BufferType.COPY_READ_BUFFER);this.unbindBuffer(g.BufferType.COPY_WRITE_BUFFER);this._state.textureUnitMap.length=0;h.webglDebugEnabled()&&console.log(this.instanceCounter.resourceInformation)}get driverTest(){return this._driverTest}get contextAttributes(){return this.gl.getContextAttributes()}get parameters(){return this._parameters}setPipelineState(r){this._stateTracker.setPipeline(r)}setBlendingEnabled(r){this._state.blend!==
r&&(!0===r?this.gl.enable(this.gl.BLEND):this.gl.disable(this.gl.BLEND),this._state.blend=r,this._stateTracker.invalidateBlending())}externalProgramUpdate(){this._state.program?.stop();this._state.program=null}externalTextureUnitUpdate(r,v){for(let y=0;y<r.length;++y)this._state.textureUnitMap[r[y]]=null;0<=v&&(this._state.activeTexture=v)}externalVertexArrayObjectUpdate(){this.gl.bindVertexArray(null);this._state.vertexArrayObject=null;this._state.vertexBuffer=null;this._state.indexBuffer=null}externalVertexBufferUpdate(){this._state.vertexBuffer=
null}externalIndexBufferUpdate(){this._state.indexBuffer=null}setBlendColor(r,v,y,B){if(r!==this._state.blendColor.r||v!==this._state.blendColor.g||y!==this._state.blendColor.b||B!==this._state.blendColor.a)this.gl.blendColor(r,v,y,B),this._state.blendColor.r=r,this._state.blendColor.g=v,this._state.blendColor.b=y,this._state.blendColor.a=B,this._stateTracker.invalidateBlending()}setBlendFunction(r,v){if(r!==this._state.blendFunction.srcRGB||v!==this._state.blendFunction.dstRGB)this.gl.blendFunc(r,
v),this._state.blendFunction.srcRGB=r,this._state.blendFunction.srcAlpha=r,this._state.blendFunction.dstRGB=v,this._state.blendFunction.dstAlpha=v,this._stateTracker.invalidateBlending()}setBlendFunctionSeparate(r,v,y,B){if(this._state.blendFunction.srcRGB!==r||this._state.blendFunction.srcAlpha!==y||this._state.blendFunction.dstRGB!==v||this._state.blendFunction.dstAlpha!==B)this.gl.blendFuncSeparate(r,v,y,B),this._state.blendFunction.srcRGB=r,this._state.blendFunction.srcAlpha=y,this._state.blendFunction.dstRGB=
v,this._state.blendFunction.dstAlpha=B,this._stateTracker.invalidateBlending()}setBlendEquation(r){this._state.blendEquation.mode!==r&&(this.gl.blendEquation(r),this._state.blendEquation.mode=r,this._state.blendEquation.modeAlpha=r,this._stateTracker.invalidateBlending())}setBlendEquationSeparate(r,v){if(this._state.blendEquation.mode!==r||this._state.blendEquation.modeAlpha!==v)this.gl.blendEquationSeparate(r,v),this._state.blendEquation.mode=r,this._state.blendEquation.modeAlpha=v,this._stateTracker.invalidateBlending()}setColorMask(r,
v,y,B){if(this._state.colorMask.r!==r||this._state.colorMask.g!==v||this._state.colorMask.b!==y||this._state.colorMask.a!==B)this.gl.colorMask(r,v,y,B),this._state.colorMask.r=r,this._state.colorMask.g=v,this._state.colorMask.b=y,this._state.colorMask.a=B,this._stateTracker.invalidateColorWrite()}setClearColor(r,v,y,B){if(this._state.clearColor.r!==r||this._state.clearColor.g!==v||this._state.clearColor.b!==y||this._state.clearColor.a!==B)this.gl.clearColor(r,v,y,B),this._state.clearColor.r=r,this._state.clearColor.g=
v,this._state.clearColor.b=y,this._state.clearColor.a=B}setFaceCullingEnabled(r){this._state.faceCulling!==r&&(!0===r?this.gl.enable(this.gl.CULL_FACE):this.gl.disable(this.gl.CULL_FACE),this._state.faceCulling=r,this._stateTracker.invalidateCulling())}setPolygonOffsetFillEnabled(r){this._state.polygonOffsetFill!==r&&(!0===r?this.gl.enable(this.gl.POLYGON_OFFSET_FILL):this.gl.disable(this.gl.POLYGON_OFFSET_FILL),this._state.polygonOffsetFill=r,this._stateTracker.invalidatePolygonOffset())}setPolygonOffset(r,
v){if(this._state.polygonOffset[0]!==r||this._state.polygonOffset[1]!==v)this._state.polygonOffset[0]=r,this._state.polygonOffset[1]=v,this.gl.polygonOffset(r,v),this._stateTracker.invalidatePolygonOffset()}setCullFace(r){this._state.cullFace!==r&&(this.gl.cullFace(r),this._state.cullFace=r,this._stateTracker.invalidateCulling())}setFrontFace(r){this._state.frontFace!==r&&(this.gl.frontFace(r),this._state.frontFace=r,this._stateTracker.invalidateCulling())}setScissorTestEnabled(r){this._state.scissorTest!==
r&&(!0===r?this.gl.enable(this.gl.SCISSOR_TEST):this.gl.disable(this.gl.SCISSOR_TEST),this._state.scissorTest=r)}setScissorRect(r,v,y,B){if(this._state.scissorRect.x!==r||this._state.scissorRect.y!==v||this._state.scissorRect.width!==y||this._state.scissorRect.height!==B)this.gl.scissor(r,v,y,B),this._state.scissorRect.x=r,this._state.scissorRect.y=v,this._state.scissorRect.width=y,this._state.scissorRect.height=B}setDepthTestEnabled(r){this._state.depthTest!==r&&(!0===r?this.gl.enable(this.gl.DEPTH_TEST):
this.gl.disable(this.gl.DEPTH_TEST),this._state.depthTest=r,this._stateTracker.invalidateDepthTest())}setClearDepth(r){this._state.clearDepth!==r&&(this.gl.clearDepth(r),this._state.clearDepth=r)}setDepthFunction(r){this._state.depthFunction!==r&&(this.gl.depthFunc(r),this._state.depthFunction=r,this._stateTracker.invalidateDepthTest())}setDepthWriteEnabled(r){this._state.depthWrite!==r&&(this.gl.depthMask(r),this._state.depthWrite=r,this._stateTracker.invalidateDepthWrite())}setDepthRange(r,v){if(this._state.depthRange.zNear!==
r||this._state.depthRange.zFar!==v)this.gl.depthRange(r,v),this._state.depthRange.zNear=r,this._state.depthRange.zFar=v,this._stateTracker.invalidateDepthWrite()}setStencilTestEnabled(r){this._state.stencilTest!==r&&(!0===r?this.gl.enable(this.gl.STENCIL_TEST):this.gl.disable(this.gl.STENCIL_TEST),this._state.stencilTest=r,this._stateTracker.invalidateStencilTest())}setClearStencil(r){r!==this._state.clearStencil&&(this.gl.clearStencil(r),this._state.clearStencil=r)}setStencilFunction(r,v,y){if(this._state.stencilFunction.func!==
r||this._state.stencilFunction.ref!==v||this._state.stencilFunction.mask!==y)this.gl.stencilFunc(r,v,y),this._state.stencilFunction.face=g.Face.FRONT_AND_BACK,this._state.stencilFunction.func=r,this._state.stencilFunction.ref=v,this._state.stencilFunction.mask=y,this._stateTracker.invalidateStencilTest()}setStencilFunctionSeparate(r,v,y,B){if(this._state.stencilFunction.face!==r||this._state.stencilFunction.func!==v||this._state.stencilFunction.ref!==y||this._state.stencilFunction.mask!==B)this.gl.stencilFuncSeparate(r,
v,y,B),this._state.stencilFunction.face=r,this._state.stencilFunction.func=v,this._state.stencilFunction.ref=y,this._state.stencilFunction.mask=B,this._stateTracker.invalidateStencilTest()}setStencilWriteMask(r){this._state.stencilWriteMask!==r&&(this.gl.stencilMask(r),this._state.stencilWriteMask=r,this._stateTracker.invalidateStencilWrite())}setStencilOp(r,v,y){if(this._state.stencilOperation.face!==g.Face.FRONT_AND_BACK||this._state.stencilOperation.fail!==r||this._state.stencilOperation.zFail!==
v||this._state.stencilOperation.zPass!==y)this.gl.stencilOp(r,v,y),this._state.stencilOperation.face=g.Face.FRONT_AND_BACK,this._state.stencilOperation.fail=r,this._state.stencilOperation.zFail=v,this._state.stencilOperation.zPass=y,this._stateTracker.invalidateStencilTest()}setStencilOpSeparate(r,v,y,B){if(this._state.stencilOperation.face!==r||this._state.stencilOperation.fail!==v||this._state.stencilOperation.zFail!==y||this._state.stencilOperation.zPass!==B)this.gl.stencilOpSeparate(r,v,y,B),
this._state.stencilOperation.face=r,this._state.stencilOperation.fail=v,this._state.stencilOperation.zFail=y,this._state.stencilOperation.zPass=B,this._stateTracker.invalidateStencilTest()}setActiveTexture(r,v=!1){const y=this._state.activeTexture;0<=r&&(v||r!==this._state.activeTexture)&&(this.gl.activeTexture(g.baseTextureUnit+r),this._state.activeTexture=r);return y}setDrawBuffers(r){const {drawFramebuffer:v}=this._state,y=null===v,B=y?this._state.drawBuffers.defaultFramebuffer:this._state.drawBuffers.fbos.get(v);
if(B?.length!==r.length||!B.every((z,A)=>z===r[A]))if(r.length>this.parameters.maxDrawBuffers)console.error("Setting more active draw buffers than GL.MAX_DRAW_BUFFERS allows.");else{if(y){if(1<r.length){console.error("The default framebuffer can only have one active draw buffer.");return}if(r[0]!==g.SpecialDrawBuffers.BACK&&r[0]!==g.SpecialDrawBuffers.NONE){console.error("The default framebuffer can only use the constants GL.BACK or GL.NONE as draw buffers.");return}}!y&&r.includes(g.SpecialDrawBuffers.BACK)?
console.error("A framebuffer object can only use the constants GL.COLOR_ATTACHMENTi or GL.NONE as draw buffers."):(this.gl.drawBuffers(r),y?this._state.drawBuffers.defaultFramebuffer=r:this._state.drawBuffers.fbos.set(v,r),this._stateTracker.invalidateDrawBuffers())}}clear(r,v=255){if(r){if(r&g.FramebufferBit.COLOR){const y=this._state.drawFramebuffer?.colorAttachments;y&&this.setDrawBuffers(y);this.setColorMask(!0,!0,!0,!0)}r&g.FramebufferBit.DEPTH&&this.setDepthWriteEnabled(!0);r&g.FramebufferBit.STENCIL&&
this.setStencilWriteMask(v);this.gl.clear(r)}}clearFramebuffer(r,v=!1,y=!1){let B=0;r&&(this.setClearColor(r[0],r[1],r[2],Math.max(1E-13,r[3])),B|=g.FramebufferBit.COLOR);v&&(B|=g.FramebufferBit.DEPTH);!1===y?y=0:(!0===y&&(y=255),B|=g.FramebufferBit.STENCIL);B&&this.clear(B,y)}drawArrays(r,v,y){if(this._transformFeedbackRequestInfo){if(r!==this._transformFeedbackRequestInfo.primitiveType)throw Error("DrawArrays called during transform feedback, but primitiveType does not match that of the current transform feedback request");
if(null==this._state.program?.hasTransformFeedbackVaryings)throw Error("DrawArrays called during transform feedback, but the shader program was not linked with a transform feedback varying");}if(h.webglDebugEnabled()){this._numOfDrawCalls++;this._numOfTriangles+=q(r,y);const B=this._state.textureUnitMap;for(let z=0;z<B.length;z++){const A=B[z];if(null!=A&&A===this._state.drawFramebuffer?.colorTexture)throw Error(`Detected readWrite. Texture already bound at index ${z}`);}}this.gl.drawArrays(r,v,y);
h.checkWebGLError(this.gl)}drawArraysInstanced(r,v,y,B){this.gl.drawArraysInstanced(r,v,y,B);h.checkWebGLError(this.gl)}drawElements(r,v,y,B){if(this._transformFeedbackRequestInfo)throw Error("Cannot called drawElements during a transform feedback request");h.webglDebugEnabled()&&(this._numOfDrawCalls++,this._numOfTriangles+=q(r,v));this.gl.drawElements(r,v,y,B);if(h.webglDebugEnabled()){const z=x.getErrorString(this);if(z){const A=this.getBoundVAO(),C=A?.indexBuffer,H=C?.size??0,E=B+v;console.error(`drawElements: ${z}${H<
E?`. Buffer is too small. Attempted to draw index ${E} of ${H}`:""}`,{args:{mode:r,count:v,type:y,offset:B},vao:{indexBuffer:C,vertexBuffers:A?.vertexBuffers}})}}}drawElementsInstanced(r,v,y,B,z){this.gl.drawElementsInstanced(r,v,y,B,z);h.checkWebGLError(this.gl)}logInfo(){h.webglDebugEnabled()&&console.log(`DrawCalls: ${this._numOfDrawCalls}, Triangles: ${this._numOfTriangles}`)}resetInfo(){h.webglDebugEnabled()&&(this._numOfTriangles=this._numOfDrawCalls=0)}get capabilities(){return this._capabilities}setViewport(r,
v,y,B){y=Math.max(Math.round(y),1);B=Math.max(Math.round(B),1);const z=this._state.viewport;if(z.x!==r||z.y!==v||z.width!==y||z.height!==B)z.x=r,z.y=v,z.width=y,z.height=B,this.gl.viewport(r,v,y,B)}setViewport4fv(r){this.setViewport(r[0],r[1],r[2],r[3])}restoreViewport({x:r,y:v,width:y,height:B}){this.setViewport(r,v,y,B)}getViewport(){const r=this._state.viewport;return{x:r.x,y:r.y,width:r.width,height:r.height}}useProgram(r){this._state.program!==r&&(this._state.program?.stop(),this._state.program=
r,this.gl.useProgram(r?.glName??null))}bindTexture(r,v,y=!1){(v>=this.parameters.maxTextureImageUnits||0>v)&&console.error("Input texture unit is out of range of available units!");const B=this._state.textureUnitMap[v];if(null==r?.glName)return null!=B&&(this.setActiveTexture(v,y),this.gl.bindTexture(B.descriptor.target,null)),this._state.textureUnitMap[v]=null,B;if(!y&&B===r)return r.isDirty&&(this.setActiveTexture(v,y),r.applyChanges()),B;this.setActiveTexture(v,y);this.gl.bindTexture(r.descriptor.target,
r.glName);r.applyChanges();this._state.textureUnitMap[v]=r;return B}unbindTexture(r){if(null!=r)for(let v=0;v<this.parameters.maxTextureImageUnits;v++)this._state.textureUnitMap[v]===r&&(this.bindTexture(null,v),this._state.textureUnitMap[v]=null)}bindFramebuffer(r,v=!1){if(v||this._state.readFramebuffer!==r||this._state.drawFramebuffer!==r)this._stateTracker.invalidateDrawBuffers(),null==r?(this.gl.bindFramebuffer(g.FramebufferTarget.FRAMEBUFFER,null),this._state.readFramebuffer=this._state.drawFramebuffer=
null):(r.initializeAndBind(g.FramebufferTarget.FRAMEBUFFER),this._state.readFramebuffer=r,this._state.drawFramebuffer=r)}bindFramebufferSeparate(r,v,y=!1){const B=v===g.FramebufferTarget.READ_FRAMEBUFFER,z=B?this._state.readFramebuffer:this._state.drawFramebuffer;if(y||z!==r)null==r?this.gl.bindFramebuffer(v,null):r.initializeAndBind(v),B?this._state.readFramebuffer=r??null:(this._stateTracker.invalidateDrawBuffers(),this._state.drawFramebuffer=r??null)}blitFramebuffer(r,v,y=0,B=0,z=r.width,A=r.height,
C=0,H=0,E=v.width,F=v.height,G=g.FramebufferBit.COLOR,D=g.TextureSamplingMode.NEAREST){this.bindFramebufferSeparate(r,g.FramebufferTarget.READ_FRAMEBUFFER);this.bindFramebufferSeparate(v,g.FramebufferTarget.DRAW_FRAMEBUFFER);this.gl.blitFramebuffer(y,B,z,A,C,H,E,F,G,D)}bindBuffer(r,v){if(r)switch(v??=r.bufferType,v){case g.BufferType.ARRAY_BUFFER:this._state.vertexBuffer=m(this.gl,r,v,this._state.vertexBuffer);break;case g.BufferType.ELEMENT_ARRAY_BUFFER:this._state.indexBuffer=m(this.gl,r,v,this._state.indexBuffer);
break;case g.BufferType.UNIFORM_BUFFER:this._state.uniformBuffer=m(this.gl,r,v,this._state.uniformBuffer);break;case g.BufferType.PIXEL_PACK_BUFFER:this._state.pixelPackBuffer=m(this.gl,r,v,this._state.pixelPackBuffer);break;case g.BufferType.PIXEL_UNPACK_BUFFER:this._state.pixelUnpackBuffer=m(this.gl,r,v,this._state.pixelUnpackBuffer);break;case g.BufferType.COPY_READ_BUFFER:this._state.copyReadBuffer=m(this.gl,r,v,this._state.copyReadBuffer);break;case g.BufferType.COPY_WRITE_BUFFER:this._state.copyWriteBuffer=
m(this.gl,r,v,this._state.copyWriteBuffer);break;case g.BufferType.TRANSFORM_FEEDBACK_BUFFER:this._state.transformFeedbackBuffer=m(this.gl,r,v,this._state.transformFeedbackBuffer)}}bindRenderbuffer(r){const v=this.gl;r||(v.bindRenderbuffer(v.RENDERBUFFER,null),this._state.renderbuffer=null);this._state.renderbuffer!==r&&(v.bindRenderbuffer(v.RENDERBUFFER,r.glName),this._state.renderbuffer=r)}_getBufferBinding(r,v){if(v>=this.parameters.maxUniformBufferBindings||0>v)return console.error("Uniform buffer binding point is out of range!"),
null;r=r===g.BufferType.UNIFORM_BUFFER?this._state.uniformBufferBindingPoints:this._state.transformBufferBindingPoints;let y=r[v];null==y&&(y={buffer:null,offset:0,size:0},r[v]=y);return y}bindBufferBase(r,v,y){const B=this._getBufferBinding(r,v);null==B||B.buffer===y&&0===B.offset&&0===B.size||(this.gl.bindBufferBase(r,v,y?y.glName:null),B.buffer=y,B.offset=0,B.size=0)}bindBufferRange(r,v,y,B,z){const A=this._getBufferBinding(r,v);null==A||A.buffer===y&&A.offset===B&&A.size===z||(0!==B%this._parameters.uniformBufferOffsetAlignment?
console.error("Uniform buffer binding offset is not a multiple of the context offset alignment"):(this.gl.bindBufferRange(r,v,y.glName,B,z),A.buffer=y,A.offset=B,A.size=z))}bindUBO(r,v,y,B){null==v?this.bindBufferBase(g.BufferType.UNIFORM_BUFFER,r,null):(h.webglDebugEnabled()&&(B??v.byteLength)>this._parameters.maxUniformBlockSize&&console.error("Attempting to bind more data than the maximum uniform block size"),v.initialize(),void 0!==y&&void 0!==B?this.bindBufferRange(g.BufferType.UNIFORM_BUFFER,
r,v.buffer,y,B):this.bindBufferBase(g.BufferType.UNIFORM_BUFFER,r,v.buffer))}unbindUBO(r){for(let v=0,y=this._state.uniformBufferBindingPoints.length;v<y;v++){const B=this._state.uniformBufferBindingPoints[v];null!=B&&B.buffer===r.buffer&&this.bindBufferBase(g.BufferType.UNIFORM_BUFFER,v,null)}}unbindBuffer(r){switch(r){case g.BufferType.ARRAY_BUFFER:this._state.vertexBuffer=m(this.gl,null,r,this._state.vertexBuffer);break;case g.BufferType.ELEMENT_ARRAY_BUFFER:this._state.indexBuffer=m(this.gl,null,
r,this._state.indexBuffer);break;case g.BufferType.UNIFORM_BUFFER:this._state.uniformBuffer=m(this.gl,null,r,this._state.uniformBuffer);break;case g.BufferType.PIXEL_PACK_BUFFER:this._state.pixelPackBuffer=m(this.gl,null,r,this._state.pixelPackBuffer);break;case g.BufferType.PIXEL_UNPACK_BUFFER:this._state.pixelUnpackBuffer=m(this.gl,null,r,this._state.pixelUnpackBuffer);break;case g.BufferType.COPY_READ_BUFFER:this._state.copyReadBuffer=m(this.gl,null,r,this._state.copyReadBuffer);break;case g.BufferType.COPY_WRITE_BUFFER:this._state.copyWriteBuffer=
m(this.gl,null,r,this._state.copyWriteBuffer)}}bindVAO(r=null){null==r?this._state.vertexArrayObject&&(this._state.vertexArrayObject.unbind(),this._state.vertexArrayObject=null):this._state.vertexArrayObject!==r&&(r.bind(),this._state.vertexArrayObject=r)}bindTransformFeedback(r){const {gl:v}=this;v.bindTransformFeedback(v.TRANSFORM_FEEDBACK,r.glName)}beginTransformFeedback(r,v){if(this._transformFeedbackRequestInfo)throw Error("Already in a transform feedback request");const {gl:y}=this;y.bindTransformFeedback(y.TRANSFORM_FEEDBACK,
r.glName);y.beginTransformFeedback(v);this._transformFeedbackRequestInfo={primitiveType:v}}endTransformFeedback(){if(!this._transformFeedbackRequestInfo)throw Error("Not in a transform feedback request");const {gl:r}=this;r.endTransformFeedback();r.bindTransformFeedback(r.TRANSFORM_FEEDBACK,null);this._transformFeedbackRequestInfo=null}async clientWaitAsync(r=p.Milliseconds(10)){const {gl:v}=this,y=v.fenceSync(g.SyncCondition.SYNC_GPU_COMMANDS_COMPLETE,0);if(!y)throw Error("Client wait failed, could not create sync object");
this.instanceCounter.increment(g.ResourceType.Sync,y);v.flush();let B;do await k.after(r),B=v.clientWaitSync(y,0,0);while(B===g.ClientWaitSyncStatus.TIMEOUT_EXPIRED);this.instanceCounter.decrement(g.ResourceType.Sync,y);v.deleteSync(y);if(B===g.ClientWaitSyncStatus.WAIT_FAILED)throw Error("Client wait failed");}getBoundFramebufferObject(r=g.FramebufferTarget.FRAMEBUFFER){return r===g.FramebufferTarget.READ_FRAMEBUFFER?this._state.readFramebuffer:this._state.drawFramebuffer}getBoundVAO(){return this._state.vertexArrayObject}resetState(){this.useProgram(null);
this.bindVAO(null);this.bindFramebuffer(null,!0);this.unbindBuffer(g.BufferType.ARRAY_BUFFER);this.unbindBuffer(g.BufferType.ELEMENT_ARRAY_BUFFER);this.unbindBuffer(g.BufferType.UNIFORM_BUFFER);this._state.uniformBufferBindingPoints.length=0;this.unbindBuffer(g.BufferType.PIXEL_PACK_BUFFER);this.unbindBuffer(g.BufferType.PIXEL_UNPACK_BUFFER);this.unbindBuffer(g.BufferType.COPY_READ_BUFFER);this.unbindBuffer(g.BufferType.COPY_WRITE_BUFFER);for(let r=0;r<this.parameters.maxTextureImageUnits;++r)this.bindTexture(null,
r);this.setBlendingEnabled(!1);this.setBlendFunction(g.BlendFactor.ONE,g.BlendFactor.ZERO);this.setBlendEquation(g.BlendOperation.ADD);this.setBlendColor(0,0,0,0);this.setFaceCullingEnabled(!1);this.setCullFace(g.Face.BACK);this.setFrontFace(g.CullMode.CCW);this.setPolygonOffsetFillEnabled(!1);this.setPolygonOffset(0,0);this.setScissorTestEnabled(!1);this.setScissorRect(0,0,this.gl.canvas.width,this.gl.canvas.height);this.setDepthTestEnabled(!1);this.setDepthFunction(g.CompareFunction.LESS);this.setDepthRange(0,
1);this.setStencilTestEnabled(!1);this.setStencilFunction(g.CompareFunction.ALWAYS,0,0);this.setStencilOp(g.StencilOperation.KEEP,g.StencilOperation.KEEP,g.StencilOperation.KEEP);this.setClearColor(0,0,0,0);this.setClearDepth(1);this.setClearStencil(0);this.setColorMask(!0,!0,!0,!0);this.setStencilWriteMask(4294967295);this.setDepthWriteEnabled(!0);this.setDrawBuffers([g.SpecialDrawBuffers.BACK]);this.setViewport(0,0,this.gl.canvas.width,this.gl.canvas.height)}enforceState(){const {gl:r}=this;r.bindVertexArray(null);
for(var v=0;v<this.parameters.maxVertexAttributes;v++)r.disableVertexAttribArray(v);this._state.vertexBuffer?r.bindBuffer(this._state.vertexBuffer.bufferType,this._state.vertexBuffer.glName):r.bindBuffer(g.BufferType.ARRAY_BUFFER,null);this._state.indexBuffer?r.bindBuffer(this._state.indexBuffer.bufferType,this._state.indexBuffer.glName):r.bindBuffer(g.BufferType.ELEMENT_ARRAY_BUFFER,null);this._state.uniformBuffer?r.bindBuffer(this._state.uniformBuffer.bufferType,this._state.uniformBuffer.glName):
r.bindBuffer(g.BufferType.UNIFORM_BUFFER,null);for(v=0;v<this._parameters.maxUniformBufferBindings;v++){var y=this._state.uniformBufferBindingPoints[v];if(null!=y){const {buffer:B,offset:z,size:A}=y;null!==B?0===z&&0===A?r.bindBufferBase(g.BufferType.UNIFORM_BUFFER,v,B.glName):r.bindBufferRange(g.BufferType.UNIFORM_BUFFER,v,B.glName,z,A):r.bindBufferBase(g.BufferType.UNIFORM_BUFFER,v,null)}}this._state.pixelPackBuffer?r.bindBuffer(this._state.pixelPackBuffer.bufferType,this._state.pixelPackBuffer.glName):
r.bindBuffer(g.BufferType.PIXEL_PACK_BUFFER,null);this._state.pixelUnpackBuffer?r.bindBuffer(this._state.pixelUnpackBuffer.bufferType,this._state.pixelUnpackBuffer.glName):r.bindBuffer(g.BufferType.PIXEL_UNPACK_BUFFER,null);this._state.copyReadBuffer?r.bindBuffer(this._state.copyReadBuffer.bufferType,this._state.copyReadBuffer.glName):r.bindBuffer(g.BufferType.COPY_READ_BUFFER,null);this._state.copyWriteBuffer?r.bindBuffer(this._state.copyWriteBuffer.bufferType,this._state.copyWriteBuffer.glName):
r.bindBuffer(g.BufferType.COPY_WRITE_BUFFER,null);r.bindFramebuffer(g.FramebufferTarget.READ_FRAMEBUFFER,null);r.readBuffer(r.BACK);this._state.readFramebuffer&&(r.bindFramebuffer(g.FramebufferTarget.READ_FRAMEBUFFER,this._state.readFramebuffer.glName),r.readBuffer(g.ColorAttachment.COLOR_ATTACHMENT0));r.bindFramebuffer(g.FramebufferTarget.DRAW_FRAMEBUFFER,this._state.drawFramebuffer?.glName??null);null===this._state.drawFramebuffer?r.drawBuffers(this._state.drawBuffers.defaultFramebuffer??[g.SpecialDrawBuffers.BACK]):
(v=this._state.drawBuffers.fbos.get(this._state.drawFramebuffer),r.drawBuffers(v??[g.ColorAttachment.COLOR_ATTACHMENT0]));if(this._state.vertexArrayObject){if(v=this._state.vertexArrayObject)this._state.vertexArrayObject.unbind(),this._state.vertexArrayObject=null;this.bindVAO(v)}r.useProgram(this._state.program?.glName??null);r.blendColor(this._state.blendColor.r,this._state.blendColor.g,this._state.blendColor.b,this._state.blendColor.a);r.bindRenderbuffer(r.RENDERBUFFER,this._state.renderbuffer?.glName??
null);!0===this._state.blend?r.enable(this.gl.BLEND):r.disable(this.gl.BLEND);r.blendEquationSeparate(this._state.blendEquation.mode,this._state.blendEquation.modeAlpha);r.blendFuncSeparate(this._state.blendFunction.srcRGB,this._state.blendFunction.dstRGB,this._state.blendFunction.srcAlpha,this._state.blendFunction.dstAlpha);r.clearColor(this._state.clearColor.r,this._state.clearColor.g,this._state.clearColor.b,this._state.clearColor.a);r.clearDepth(this._state.clearDepth);r.clearStencil(this._state.clearStencil);
r.colorMask(this._state.colorMask.r,this._state.colorMask.g,this._state.colorMask.b,this._state.colorMask.a);r.cullFace(this._state.cullFace);r.depthFunc(this._state.depthFunction);r.depthRange(this._state.depthRange.zNear,this._state.depthRange.zFar);!0===this._state.depthTest?r.enable(r.DEPTH_TEST):r.disable(r.DEPTH_TEST);r.depthMask(this._state.depthWrite);r.frontFace(this._state.frontFace);r.lineWidth(1);!0===this._state.faceCulling?r.enable(r.CULL_FACE):r.disable(r.CULL_FACE);r.polygonOffset(this._state.polygonOffset[0],
this._state.polygonOffset[1]);!0===this._state.polygonOffsetFill?r.enable(r.POLYGON_OFFSET_FILL):r.disable(r.POLYGON_OFFSET_FILL);r.scissor(this._state.scissorRect.x,this._state.scissorRect.y,this._state.scissorRect.width,this._state.scissorRect.height);!0===this._state.scissorTest?r.enable(r.SCISSOR_TEST):r.disable(r.SCISSOR_TEST);r.stencilFunc(this._state.stencilFunction.func,this._state.stencilFunction.ref,this._state.stencilFunction.mask);r.stencilOpSeparate(this._state.stencilOperation.face,
this._state.stencilOperation.fail,this._state.stencilOperation.zFail,this._state.stencilOperation.zPass);!0===this._state.stencilTest?r.enable(r.STENCIL_TEST):r.disable(r.STENCIL_TEST);r.stencilMask(this._state.stencilWriteMask);for(v=0;v<this.parameters.maxTextureImageUnits;v++)r.activeTexture(g.baseTextureUnit+v),r.bindTexture(g.TextureType.TEXTURE_2D,null),r.bindTexture(g.TextureType.TEXTURE_CUBE_MAP,null),r.bindTexture(g.TextureType.TEXTURE_3D,null),r.bindTexture(g.TextureType.TEXTURE_2D_ARRAY,
null),y=this._state.textureUnitMap[v],null!=y&&r.bindTexture(y.descriptor.target,y.glName);r.activeTexture(g.baseTextureUnit+this._state.activeTexture);v=this._state.viewport;r.viewport(v.x,v.y,v.width,v.height);this.resetInfo()}_loadExtensions(){this.gl.getExtension("KHR_parallel_shader_compile")}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/ContextState":function(){define(["exports","./enums"],function(a,b){class n{constructor(){this.blend=!1;this.blendColor=
{r:0,g:0,b:0,a:0};this.blendFunction={srcRGB:b.BlendFactor.ONE,dstRGB:b.BlendFactor.ZERO,srcAlpha:b.BlendFactor.ONE,dstAlpha:b.BlendFactor.ZERO};this.blendEquation={mode:b.BlendOperation.ADD,modeAlpha:b.BlendOperation.ADD};this.colorMask={r:!0,g:!0,b:!0,a:!0};this.faceCulling=!1;this.cullFace=b.Face.BACK;this.frontFace=b.CullMode.CCW;this.scissorTest=!1;this.scissorRect={x:0,y:0,width:0,height:0};this.depthTest=!1;this.depthFunction=b.CompareFunction.LESS;this.clearDepth=1;this.depthWrite=!0;this.depthRange=
{zNear:0,zFar:1};this.viewport=null;this.polygonOffsetFill=this.stencilTest=!1;this.polygonOffset=[0,0];this.stencilFunction={face:b.Face.FRONT_AND_BACK,func:b.CompareFunction.ALWAYS,ref:0,mask:1};this.clearStencil=0;this.stencilWriteMask=1;this.stencilOperation={face:b.Face.FRONT_AND_BACK,fail:b.StencilOperation.KEEP,zFail:b.StencilOperation.KEEP,zPass:b.StencilOperation.KEEP};this.clearColor={r:0,g:0,b:0,a:0};this.transformFeedbackBuffer=this.copyWriteBuffer=this.copyReadBuffer=this.pixelUnpackBuffer=
this.pixelPackBuffer=this.uniformBuffer=this.indexBuffer=this.vertexBuffer=this.program=null;this.uniformBufferBindingPoints=[];this.transformBufferBindingPoints=[];this.drawFramebuffer=this.readFramebuffer=null;this.drawBuffers={defaultFramebuffer:[b.SpecialDrawBuffers.BACK],fbos:new WeakMap};this.renderbuffer=null;this.activeTexture=0;this.textureUnitMap=[];this.vertexArrayObject=null}}a.ContextState=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/InstanceCounter":function(){define(["exports",
"./AllocationTracer","./enums"],function(a,b,n){const k={RECORD_ALLOCATIONS:!1};class p{constructor(){this._current=[];for(this._allocations=k.RECORD_ALLOCATIONS?new b.AllocationTracer("WebGLObject"):null;this._current.length<n.ResourceType.COUNT;)this._current.push(0)}increment(h,e,g=1){this._current[h]+=g;this._allocations?.add(e)}decrement(h,e,g=1){this._current[h]-=g;this._allocations?.remove(e)}get current(){return this._current}get total(){return this.current.reduce((h,e,g)=>h+(g<n.ResourceType.UNCOUNTED?
e:0),0)}get resourceInformation(){let h="";if(0<this.total){h+="Live objects:\n";for(let e=0;e<n.ResourceType.COUNT;++e){const g=this._current[e];0<g&&(h+=`${n.ResourceType[e]}: ${g}\n`)}}return h+=this._allocations?.resetLog()}}a.InstanceCounter=p;a.test=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/AllocationTracer":function(){define(["exports"],function(a){class b{constructor(k){this._objectType=k;this._active=new Map}get _stack(){const k=Error().stack.split("\n");
k.shift();k.shift();k.shift();return k.join("\n")}add(k){this._active.set(k,new n(this._stack))}remove(k){this._active.delete(k)}addReference(k){(k=this._active.get(k))&&k.retains.push(this._stack)}removeReference(k){(k=this._active.get(k))&&k.releases.push(this._stack)}resetLog(){const k=new Map;let p="";this._active.forEach((g,{usedMemory:d})=>{k.has(g.from)||(k.set(g.from,new Map),0<g.retains.length&&(p+=`  First reference count mismatch:\n  Retain:\n    ${g.retains.join("\n\n    ")}\n\n  Release:    ${g.releases.join("\n\n    ")}\n`));
g=k.get(g.from);g.set(d??0,g.get(d??0)??1)});this._active.clear();let h=0;const e=[];k.forEach((g,d)=>{let f=0;g.forEach((c,l)=>f+=c*l);g.set(-1,f);h+=f;e.push([d,g])});k.clear();e.sort((g,d)=>d[1].get(-1)-g[1].get(-1));return e.reduce((g,[d,f])=>{const c=Math.round(f.get(-1)/1024);f.delete(-1);f=Array.from(f.values()).reduce((l,w)=>l+w,0);return g+=`  ${c}KB from ${f} allocations at ${d}\n`},`Total ${this._objectType} memory: ${Math.round(h/1024)}KB\n${p}`)}}class n{constructor(k){this.from=k;this.retains=
[];this.releases=[]}}a.AllocationTracer=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/Parameters":function(){define(["exports"],function(a){class b{constructor(n,k,p){k=k.textureFilterAnisotropic;p=p.maxAnisotropy??Infinity;this.versionString=n.getParameter(n.VERSION);this.maxVertexTextureImageUnits=n.getParameter(n.MAX_VERTEX_TEXTURE_IMAGE_UNITS);this.maxVertexAttributes=n.getParameter(n.MAX_VERTEX_ATTRIBS);this.maxMaxAnisotropy=k?Math.min(n.getParameter(k.MAX_TEXTURE_MAX_ANISOTROPY),
p):1;this.maxTextureImageUnits=n.getParameter(n.MAX_TEXTURE_IMAGE_UNITS);this.maxTextureSize=n.getParameter(n.MAX_TEXTURE_SIZE);this.maxRenderbufferSize=n.getParameter(n.MAX_RENDERBUFFER_SIZE);this.maxViewportDims=n.getParameter(n.MAX_VIEWPORT_DIMS);this.maxUniformBufferBindings=n.getParameter(n.MAX_UNIFORM_BUFFER_BINDINGS);this.maxVertexUniformBlocks=n.getParameter(n.MAX_VERTEX_UNIFORM_BLOCKS);this.maxFragmentUniformBlocks=n.getParameter(n.MAX_FRAGMENT_UNIFORM_BLOCKS);this.maxUniformBlockSize=n.getParameter(n.MAX_UNIFORM_BLOCK_SIZE);
this.uniformBufferOffsetAlignment=n.getParameter(n.UNIFORM_BUFFER_OFFSET_ALIGNMENT);this.maxArrayTextureLayers=n.getParameter(n.MAX_ARRAY_TEXTURE_LAYERS);this.maxSamples=n.getParameter(n.MAX_SAMPLES);this.maxDrawBuffers=n.getParameter(n.MAX_DRAW_BUFFERS)}}a.Parameters=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/ProgramCache":function(){define(["exports","../../core/has","../../core/NestedMap","./Program"],function(a,b,n,k){class p{constructor(h){this._rctx=
h;this._store=new n.NestedMap}dispose(){this._store.forAll(h=>h.dispose());this._store.clear()}acquire(h,e,g,d){const f=this._store.get(h,e);if(null!=f)return f.ref(),f;g=new k.Program(this._rctx,h,e,g,d);g.ref();this._store.set(h,e,g);return g}get test(){}}a.ProgramCache=p;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/Program":function(){define(["exports","../../core/has","./checkWebGLError","./enums","./ShaderTranspiler"],function(a,b,n,k,p){function h(c,l,w){c=
c.gl;const x=c.createShader(l);c.shaderSource(x,w);c.compileShader(x);n.webglValidateShadersEnabled()&&!c.getShaderParameter(x,c.COMPILE_STATUS)&&(console.error("Compile error in ".concat(l===k.ShaderType.VERTEX_SHADER?"vertex":"fragment"," shader")),console.error(c.getShaderInfoLog(x)),console.error(e(w)));return x}function e(c){let l=2;return c.replaceAll("\n",()=>{var w=l++;w=1E3<=w?w.toString():("  "+w).slice(-3);return"\n"+w+":"})}function g(c,l,w){const x=c.get(l);if(!x)return c.set(l,Array.from(w)),
!0;const u=w.length;if(x.length!==u)return c.set(l,Array.from(w)),!0;for(c=0;c<u;++c)if(l=w[c],x[c]!==l){for(x[c]=l;c<u;++c)x[c]=w[c];return!0}return!1}class d{constructor(c,l,w,x,u=new Map,t=[]){this._context=c;this._locations=x;this._uniformBlockBindings=u;this._transformFeedbackVaryings=t;this._refCount=1;this._compiled=!1;this._linesOfCode=0;this._nameToUniformLocation=new Map;this._nameToUniform1=new Map;this._nameToUniform1v=new Map;this._nameToUniform2=new Map;this._nameToUniform3=new Map;
this._nameToUniform4=new Map;this._nameToUniformMatrix3=new Map;this._nameToUniformMatrix4=new Map;c||console.error("RenderingContext isn't initialized!");0===l.length&&console.error("Shaders source should not be empty!");l=p.transpileShader(l,k.ShaderType.VERTEX_SHADER);w=p.transpileShader(w,k.ShaderType.FRAGMENT_SHADER);this._vShader=h(this._context,k.ShaderType.VERTEX_SHADER,l);this._fShader=h(this._context,k.ShaderType.FRAGMENT_SHADER,w);f.enabled&&(this._linesOfCode=l.match(/\n/g).length+w.match(/\n/g).length+
2,this._context.instanceCounter.increment(k.ResourceType.LinesOfCode,this._vShader,this._linesOfCode));this._vShader&&this._fShader||console.error("Error loading shaders!");this._context.instanceCounter.increment(k.ResourceType.Shader,this);n.webglValidateShadersEnabled()&&(this.vertexShader=l,this.fragmentShader=w);this.usedMemory=l.length+w.length;const m=this._context.gl,q=m.createProgram();m.attachShader(q,this._vShader);m.attachShader(q,this._fShader);this._locations.forEach((r,v)=>m.bindAttribLocation(q,
r,v));this._transformFeedbackVaryings?.length&&m.transformFeedbackVaryings(q,this._transformFeedbackVaryings,m.SEPARATE_ATTRIBS);m.linkProgram(q);n.webglValidateShadersEnabled()&&!m.getProgramParameter(q,m.LINK_STATUS)&&console.error("Could not link shader\n"+`validated: ${m.getProgramParameter(q,m.VALIDATE_STATUS)}`+`, gl error ${m.getError()}`+`, vertex: ${m.getShaderParameter(this._vShader,m.COMPILE_STATUS)}`+`, fragment: ${m.getShaderParameter(this._fShader,m.COMPILE_STATUS)}`+`, info log: ${m.getProgramInfoLog(q)}`+
`, vertex source: ${this.vertexShader}`+`, fragment source: ${this.fragmentShader}`);for(const [r,v]of this._uniformBlockBindings)c=m.getUniformBlockIndex(q,r),4294967295>c&&m.uniformBlockBinding(q,c,v);this._glName=q;this._context.instanceCounter.increment(k.ResourceType.Program,this)}get glName(){return this._glName}get hasGLName(){return null!=this._glName}get hasTransformFeedbackVaryings(){return!!this._transformFeedbackVaryings?.length}get compiled(){if(this._compiled)return!0;const c=this._context.gl.getExtension("KHR_parallel_shader_compile");
return null==c||null==this.glName?this._compiled=!0:this._compiled=!!this._context.gl.getProgramParameter(this.glName,c.COMPLETION_STATUS_KHR)}dispose(){if(!(0<--this._refCount)){var c=this._context.gl,l=this._context.instanceCounter;this._nameToUniformLocation.forEach(w=>w&&l.decrement(k.ResourceType.Uniform,w));this._nameToUniformLocation.clear();this._vShader&&(0<this._linesOfCode&&(l.decrement(k.ResourceType.LinesOfCode,this._vShader,this._linesOfCode),this._linesOfCode=0),c.deleteShader(this._vShader),
this._vShader=null,l.decrement(k.ResourceType.Shader,this));this._fShader&&(c.deleteShader(this._fShader),this._fShader=null);this._glName&&(c.deleteProgram(this._glName),this._glName=null,l.decrement(k.ResourceType.Program,this))}}ref(){++this._refCount}_getUniformLocation(c){var l=this._nameToUniformLocation.get(c);return void 0!==l?l:this.glName?(l=this._context.gl.getUniformLocation(this.glName,c),this._nameToUniformLocation.set(c,l),l&&this._context.instanceCounter.increment(k.ResourceType.Uniform,
l),l):null}hasUniform(c){return null!=this._getUniformLocation(c)}setUniform1i(c,l){const w=this._nameToUniform1.get(c);if(void 0===w||l!==w)this._context.gl.uniform1i(this._getUniformLocation(c),l),this._nameToUniform1.set(c,l)}setUniform1iv(c,l){g(this._nameToUniform1v,c,l)&&this._context.gl.uniform1iv(this._getUniformLocation(c),l)}setUniform2iv(c,l){g(this._nameToUniform2,c,l)&&this._context.gl.uniform2iv(this._getUniformLocation(c),l)}setUniform3iv(c,l){g(this._nameToUniform3,c,l)&&this._context.gl.uniform3iv(this._getUniformLocation(c),
l)}setUniform4iv(c,l){g(this._nameToUniform4,c,l)&&this._context.gl.uniform4iv(this._getUniformLocation(c),l)}setUniform1f(c,l){const w=this._nameToUniform1.get(c);if(void 0===w||l!==w)this._context.gl.uniform1f(this._getUniformLocation(c),l),this._nameToUniform1.set(c,l)}setUniform1fv(c,l){g(this._nameToUniform1v,c,l)&&this._context.gl.uniform1fv(this._getUniformLocation(c),l)}setUniform2f(c,l,w){const x=this._nameToUniform2.get(c);if(void 0===x)this._context.gl.uniform2f(this._getUniformLocation(c),
l,w),this._nameToUniform2.set(c,[l,w]);else if(l!==x[0]||w!==x[1])this._context.gl.uniform2f(this._getUniformLocation(c),l,w),x[0]=l,x[1]=w}setUniform2fv(c,l){g(this._nameToUniform2,c,l)&&this._context.gl.uniform2fv(this._getUniformLocation(c),l)}setUniform3f(c,l,w,x){const u=this._nameToUniform3.get(c);if(void 0===u)this._context.gl.uniform3f(this._getUniformLocation(c),l,w,x),this._nameToUniform3.set(c,[l,w,x]);else if(l!==u[0]||w!==u[1]||x!==u[2])this._context.gl.uniform3f(this._getUniformLocation(c),
l,w,x),u[0]=l,u[1]=w,u[2]=x}setUniform3fv(c,l){const w=this._getUniformLocation(c);null!=w&&g(this._nameToUniform3,c,l)&&this._context.gl.uniform3fv(w,l)}setUniform4f(c,l,w,x,u){const t=this._nameToUniform4.get(c);if(void 0===t)this._context.gl.uniform4f(this._getUniformLocation(c),l,w,x,u),this._nameToUniform4.set(c,[l,w,x,u]);else if(void 0===t||l!==t[0]||w!==t[1]||x!==t[2]||u!==t[3])this._context.gl.uniform4f(this._getUniformLocation(c),l,w,x,u),t[0]=l,t[1]=w,t[2]=x,t[3]=u}setUniform4fv(c,l){const w=
this._getUniformLocation(c);null!=w&&g(this._nameToUniform4,c,l)&&this._context.gl.uniform4fv(w,l)}setUniformMatrix3fv(c,l,w=!1){const x=this._getUniformLocation(c);null!=x&&g(this._nameToUniformMatrix3,c,l)&&this._context.gl.uniformMatrix3fv(x,w,l)}setUniformMatrix4fv(c,l,w=!1){const x=this._getUniformLocation(c);null!=x&&g(this._nameToUniformMatrix4,c,l)&&this._context.gl.uniformMatrix4fv(x,w,l)}stop(){}}const f={enabled:!1};a.Program=d;a.test=f;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/webgl/ShaderTranspiler":function(){define(["exports","../../core/has","./enums","./reservedWordsGLSL3","./testUtils"],function(a,b,n,k,p){function h(){function r(R){R.length&&J.push({type:t[F],data:R,position:Q,line:N,column:M})}function v(){I=I.length?[]:I;if("/"===D&&"*"===G)return Q=E+H-1,F=0,D=G,H+1;if("/"===D&&"/"===G)return Q=E+H-1,F=1,D=G,H+1;if("#"===G)return F=2,Q=E+H,H;if(/\s/.test(G))return F=9,Q=E+H,H;O=/\d/.test(G);K=/[^\w_]/.test(G);Q=E+H;F=O?4:K?3:9999;return H}function y(){if(("\r"===
G||"\n"===G)&&"\\"!==D)return r(I.join("")),F=999,H;I.push(G);D=G;return H+1}function B(){if("."===D&&/\d/.test(G))return F=5,H;if("/"===D&&"*"===G)return F=0,H;if("/"===D&&"/"===G)return F=1,H;if("."===G&&I.length){for(;z(I););F=5;return H}if(";"===G||")"===G||"("===G){if(I.length)for(;z(I););r(G);F=999;return H+1}var R=2===I.length&&"\x3d"!==G;if(/[\w_\d\s]/.test(G)||R){for(;z(I););F=999;return H}I.push(G);D=G;return H+1}function z(R){var W=0;do{var V=x.indexOf(R.slice(0,R.length+W).join(""));var ba=
x[V];if(-1===V){if(0<W--+R.length)continue;ba=R.slice(0,1).join("")}r(ba);Q+=ba.length;I=I.slice(ba.length);return I.length}while(1)}function A(){if("."===G||/[eE]/.test(G))return I.push(G),F=5,D=G,H+1;if("x"===G&&1===I.length&&"0"===I[0])return F=11,I.push(G),D=G,H+1;if(/[^\d]/.test(G))return r(I.join("")),F=999,H;I.push(G);D=G;return H+1}function C(){"f"===G&&(I.push(G),D=G,H+=1);if(/[eE]/.test(G)||"-"===G&&/[eE]/.test(D))return I.push(G),D=G,H+1;if(/[^\d]/.test(G))return r(I.join("")),F=999,H;
I.push(G);D=G;return H+1}var H=0,E=0,F=999,G,D,I=[],J=[],N=1,M=0,Q=0,O=!1,K=!1,L="",P;return function(R){J=[];if(null!==R){R=R.replace?R.replace(/\r\n/g,"\n"):R;H=0;L+=R;for(P=L.length;G=L[H],H<P;){R=H;switch(F){case 0:"/"===G&&"*"===D?(I.push(G),r(I.join("")),F=999):(I.push(G),D=G);H+=1;break;case 1:H=y();break;case 2:H=y();break;case 3:H=B();break;case 4:H=A();break;case 11:/[^a-fA-F0-9]/.test(G)?(r(I.join("")),F=999):(I.push(G),D=G,H+=1);break;case 5:H=C();break;case 9999:if(/[^\d\w_]/.test(G)){var W=
I.join("");F=-1<w.indexOf(W)?8:-1<u.indexOf(W)?7:6;r(I.join(""));F=999}else I.push(G),D=G,H+=1;break;case 9:/[^\s]/g.test(G)?(r(I.join("")),F=999):(I.push(G),D=G,H+=1);break;case 999:H=v()}if(R!==H)switch(L[R]){case "\n":M=0;++N;break;default:++M}}E+=H;L=L.slice(H);return J}I.length&&r(I.join(""));F=10;r("(eof)");return J}}function e(r){return r.map(v=>"eof"!==v.type?v.data:"").join("")}function g(r,v="100",y="300 es"){const B=/^\s*#version\s+([0-9]+(\s+[a-zA-Z]+)?)\s*/;for(const z of r)if("preprocessor"===
z.type){const A=B.exec(z.data);if(A){r=A[1].replaceAll(/\s{2,}/g," ");if(r===y)return r;if(r===v)return z.data="#version "+y,v;throw Error("unknown glsl version: "+r);}}r.splice(0,0,{type:"preprocessor",data:"#version "+y},{type:"whitespace",data:"\n"});return null}function d(r,v,y,B){B=B||y;for(const z of r)if("ident"===z.type&&z.data===y)return B in v?v[B]++:v[B]=0,d(r,v,B+"_"+v[B],B);return y}function f(r,v,y="afterVersion"){const B={data:"\n",type:"whitespace"},z=C=>C<r.length?/[^\r\n]$/.test(r[C].data):
!1;let A=function(C){let H=-1,E=0,F=-1;for(let D=0;D<C.length;D++){var G=C[D];"preprocessor"===G.type&&(/#(if|ifdef|ifndef)\s+.+/.test(G.data)?++E:/#endif\s*.*/.test(G.data)&&--E);("afterVersion"===y||"afterPrecision"===y)&&"preprocessor"===G.type&&G.data.startsWith("#version")&&(F=Math.max(F,D));if("afterPrecision"===y&&"keyword"===G.type&&"precision"===G.data){a:{for(G=D;G<C.length;G++){const I=C[G];if("operator"===I.type&&";"===I.data)break a}G=null}if(null===G)throw Error("precision statement not followed by any semicolons!");
F=Math.max(F,G)}H<F&&0===E&&(H=D)}return H+1}(r);z(A-1)&&r.splice(A++,0,B);for(const C of v)r.splice(A++,0,C);z(A-1)&&z(A)&&r.splice(A,0,B)}function c(r,v,y,B="lowp"){f(r,[{type:"keyword",data:"out"},{type:"whitespace",data:" "},{type:"keyword",data:B},{type:"whitespace",data:" "},{type:"keyword",data:y},{type:"whitespace",data:" "},{type:"ident",data:v},{type:"operator",data:";"}],"afterPrecision")}function l(r,v,y,B,z="lowp"){f(r,[{type:"keyword",data:"layout"},{type:"operator",data:"("},{type:"keyword",
data:"location"},{type:"whitespace",data:" "},{type:"operator",data:"\x3d"},{type:"whitespace",data:" "},{type:"integer",data:B.toString()},{type:"operator",data:")"},{type:"whitespace",data:" "},{type:"keyword",data:"out"},{type:"whitespace",data:" "},{type:"keyword",data:z},{type:"whitespace",data:" "},{type:"keyword",data:y},{type:"whitespace",data:" "},{type:"ident",data:v},{type:"operator",data:";"}],"afterPrecision")}const w="precision highp mediump lowp attribute const uniform varying break continue do for while if else in out inout float int void bool true false discard return mat2 mat3 mat4 vec2 vec3 vec4 ivec2 ivec3 ivec4 bvec2 bvec3 bvec4 sampler1D sampler2D sampler3D samplerCube sampler1DShadow sampler2DShadow struct asm class union enum typedef template this packed goto switch default inline noinline volatile public static extern external interface long short double half fixed unsigned input output hvec2 hvec3 hvec4 dvec2 dvec3 dvec4 fvec2 fvec3 fvec4 sampler2DRect sampler3DRect sampler2DRectShadow sizeof cast namespace using".split(" "),
x="\x3c\x3c\x3d \x3e\x3e\x3d ++ -- \x3c\x3c \x3e\x3e \x3c\x3d \x3e\x3d \x3d\x3d !\x3d \x26\x26 || +\x3d -\x3d *\x3d /\x3d %\x3d \x26\x3d ^^ ^\x3d |\x3d ( ) [ ] . ! ~ * / % + - \x3c \x3e \x26 ^ | ? : \x3d , ; { }".split(" "),u="abs acos all any asin atan ceil clamp cos cross dFdx dFdy degrees distance dot equal exp exp2 faceforward floor fract gl_BackColor gl_BackLightModelProduct gl_BackLightProduct gl_BackMaterial gl_BackSecondaryColor gl_ClipPlane gl_ClipVertex gl_Color gl_DepthRange gl_DepthRangeParameters gl_EyePlaneQ gl_EyePlaneR gl_EyePlaneS gl_EyePlaneT gl_Fog gl_FogCoord gl_FogFragCoord gl_FogParameters gl_FragColor gl_FragCoord gl_FragData gl_FragDepth gl_FragDepthEXT gl_FrontColor gl_FrontFacing gl_FrontLightModelProduct gl_FrontLightProduct gl_FrontMaterial gl_FrontSecondaryColor gl_LightModel gl_LightModelParameters gl_LightModelProducts gl_LightProducts gl_LightSource gl_LightSourceParameters gl_MaterialParameters gl_MaxClipPlanes gl_MaxCombinedTextureImageUnits gl_MaxDrawBuffers gl_MaxFragmentUniformComponents gl_MaxLights gl_MaxTextureCoords gl_MaxTextureImageUnits gl_MaxTextureUnits gl_MaxVaryingFloats gl_MaxVertexAttribs gl_MaxVertexTextureImageUnits gl_MaxVertexUniformComponents gl_ModelViewMatrix gl_ModelViewMatrixInverse gl_ModelViewMatrixInverseTranspose gl_ModelViewMatrixTranspose gl_ModelViewProjectionMatrix gl_ModelViewProjectionMatrixInverse gl_ModelViewProjectionMatrixInverseTranspose gl_ModelViewProjectionMatrixTranspose gl_MultiTexCoord0 gl_MultiTexCoord1 gl_MultiTexCoord2 gl_MultiTexCoord3 gl_MultiTexCoord4 gl_MultiTexCoord5 gl_MultiTexCoord6 gl_MultiTexCoord7 gl_Normal gl_NormalMatrix gl_NormalScale gl_ObjectPlaneQ gl_ObjectPlaneR gl_ObjectPlaneS gl_ObjectPlaneT gl_Point gl_PointCoord gl_PointParameters gl_PointSize gl_Position gl_ProjectionMatrix gl_ProjectionMatrixInverse gl_ProjectionMatrixInverseTranspose gl_ProjectionMatrixTranspose gl_SecondaryColor gl_TexCoord gl_TextureEnvColor gl_TextureMatrix gl_TextureMatrixInverse gl_TextureMatrixInverseTranspose gl_TextureMatrixTranspose gl_Vertex greaterThan greaterThanEqual inversesqrt length lessThan lessThanEqual log log2 matrixCompMult max min mix mod normalize not notEqual pow radians reflect refract sign sin smoothstep sqrt step tan texture2D texture2DLod texture2DProj texture2DProjLod textureCube textureCubeLod texture2DLodEXT texture2DProjLodEXT textureCubeLodEXT texture2DGradEXT texture2DProjGradEXT textureCubeGradEXT textureSize texelFetch".split(" ");
var t="block-comment line-comment preprocessor operator integer float ident builtin keyword whitespace eof integer".split(" ");const m=new Set(["GL_OES_standard_derivatives","GL_EXT_frag_depth","GL_EXT_draw_buffers","GL_EXT_shader_texture_lod"]),q=new Map;a.transpileShader=function(r,v){if(r.startsWith("#version 300"))return r;var y=p.shaderTranspiler.enableCache?q.get(r):null;if(null!=y)return y;y=h();var B=[];B=B.concat(y(r));y=B=B.concat(y(null));if("300 es"===g(y,"100","300 es"))return r;var z=
B=null;const A={},C={};for(let G=0;G<y.length;++G){const D=y[G];switch(D.type){case "keyword":v===n.ShaderType.VERTEX_SHADER&&"attribute"===D.data?D.data="in":"varying"===D.data&&(D.data=v===n.ShaderType.VERTEX_SHADER?"out":"in");break;case "builtin":/^texture(2D|Cube)(Proj)?(Lod|Grad)?(EXT)?$/.test(D.data.trim())&&(D.data=D.data.replaceAll(/(2D|Cube|EXT)/g,""));v===n.ShaderType.FRAGMENT_SHADER&&"gl_FragColor"===D.data&&(B||(B=d(y,A,"fragColor"),c(y,B,"vec4")),D.data=B);if(v===n.ShaderType.FRAGMENT_SHADER&&
"gl_FragData"===D.data){var H=void 0;let I=void 0;var E=y,F=G+1;let J=-1;for(;F<E.length;F++){const N=E[F];if("operator"===N.type&&("["===N.data&&(I=F),"]"===N.data)){H=F;break}"integer"===N.type&&(J=parseInt(N.data,10))}I&&H&&E.splice(I,H-I+1);E=J;H=d(y,A,"fragData");l(y,H,"vec4",E,"mediump");D.data=H}else v===n.ShaderType.FRAGMENT_SHADER&&"gl_FragDepthEXT"===D.data&&(z||=d(y,A,"gl_FragDepth"),D.data=z);break;case "ident":if(k.includes(D.data)){if(E=v===n.ShaderType.VERTEX_SHADER)a:{for(E=G-1;0<=
E;E--)if(H=y[E],"whitespace"!==H.type&&"block-comment"!==H.type)if("keyword"===H.type){if("attribute"===H.data||"in"===H.data){E=!0;break a}}else break;E=!1}if(E)throw Error("attribute in vertex shader uses a name that is a reserved word in glsl 300 es");D.data in C||(C[D.data]=d(y,A,D.data));D.data=C[D.data]}}}for(v=y.length-1;0<=v;--v)B=y[v],"preprocessor"===B.type&&(z=B.data.match(/#extension\s+(.*):/),z?.[1]&&m.has(z[1].trim())&&(z=y[v+1],y.splice(v,z&&"whitespace"===z.type?2:1)),z=B.data.match(/#ifdef\s+(.*)/),
z?.[1]&&m.has(z[1].trim())&&(B.data="#if 1"),z=B.data.match(/#ifndef\s+(.*)/),z?.[1]&&m.has(z[1].trim())&&(B.data="#if 0"));y=e(y);p.shaderTranspiler.enableCache&&q.set(r,y);return y};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/reservedWordsGLSL3":function(){define(function(){return"layout centroid smooth case mat2x2 mat2x3 mat2x4 mat3x2 mat3x3 mat3x4 mat4x2 mat4x3 mat4x4 uint uvec2 uvec3 uvec4 samplerCubeShadow sampler2DArray sampler2DArrayShadow isampler2D isampler3D isamplerCube isampler2DArray usampler2D usampler3D usamplerCube usampler2DArray coherent restrict readonly writeonly resource atomic_uint noperspective patch sample subroutine common partition active filter image1D image2D image3D imageCube iimage1D iimage2D iimage3D iimageCube uimage1D uimage2D uimage3D uimageCube image1DArray image2DArray iimage1DArray iimage2DArray uimage1DArray uimage2DArray image1DShadow image2DShadow image1DArrayShadow image2DArrayShadow imageBuffer iimageBuffer uimageBuffer sampler1DArray sampler1DArrayShadow isampler1D isampler1DArray usampler1D usampler1DArray isampler2DRect usampler2DRect samplerBuffer isamplerBuffer usamplerBuffer sampler2DMS isampler2DMS usampler2DMS sampler2DMSArray isampler2DMSArray usampler2DMSArray trunc round roundEven isnan isinf floatBitsToInt floatBitsToUint intBitsToFloat uintBitsToFloat packSnorm2x16 unpackSnorm2x16 packUnorm2x16 unpackUnorm2x16 packHalf2x16 unpackHalf2x16 outerProduct transpose determinant inverse texture textureSize textureProj textureLod textureOffset texelFetch texelFetchOffset textureProjOffset textureLodOffset textureProjLod textureProjLodOffset textureGrad textureGradOffset textureProjGrad textureProjGradOffset".split(" ")})},
"esri/views/webgl/testUtils":function(){define(["exports"],function(a){a.shaderTranspiler={enableCache:!1};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/WebGLDriverTest":function(){define(["exports","./testAppleAmdDrawArrays","./testDoublePrecisionArithmetic","./testFloatBufferBlend","./testSVGPremultipliedAlpha"],function(a,b,n,k,p){class h{constructor(e){this.rctx=e;this.floatBufferBlend=new k.FloatBufferBlend(e);this.svgPremultipliesAlpha=new p.SVGPremultipliedAlpha(e);
this.doublePrecisionRequiresObfuscation=new n.DoublePrecisionRequiresObfuscation(e);this.drawArraysRequiresIndicesTypeReset=new b.DrawArraysRequiresIndicesTypeReset(e)}dispose(){this.doublePrecisionRequiresObfuscation.dispose();this.svgPremultipliesAlpha.dispose();this.floatBufferBlend.dispose();this.drawArraysRequiresIndicesTypeReset.dispose()}}a.WebGLDriverTest=h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/testAppleAmdDrawArrays":function(){define("exports ../../core/has ../3d/webgl-engine/core/shaderModules/interfaces ./AppleAmdDriverHelper ./BufferObject ./enums ./FramebufferObject ./TextureDescriptor ./WebGLDriverTestModule".split(" "),
function(a,b,n,k,p,h,e,g,d){class f extends d.WebGLDriverTestModule{constructor(c){super();this._rctx=c;this._helperProgram=null;b("mac")&&b("chrome")&&(this._program=this._prepareProgram(),this._helperProgram=this._prepareHelperProgram())}dispose(){super.dispose();this._helperProgram?.dispose();this._helperProgram=null}_test(c){const l=this._rctx,w=l.getBoundFramebufferObject(),{x,y:u,width:t,height:m}=l.getViewport();l.resetState();var q=new g.TextureDescriptor(1);q.wrapMode=h.TextureWrapMode.CLAMP_TO_EDGE;
q.samplingMode=h.TextureSamplingMode.NEAREST;q=new e.FramebufferObject(l,q);const r=p.BufferObject.createIndex(this._rctx,h.Usage.STATIC_DRAW,new Uint8Array([0]));l.bindFramebuffer(q);l.setViewport(0,0,1,1);l.useProgram(this._helperProgram);l.bindBuffer(r,h.BufferType.ELEMENT_ARRAY_BUFFER);l.drawElements(h.PrimitiveType.POINTS,1,h.DataType.UNSIGNED_BYTE,0);l.useProgram(c);l.bindVAO(null);l.drawArrays(h.PrimitiveType.TRIANGLES,0,258);c=new Uint8Array(4);q.readPixels(0,0,1,1,h.PixelFormat.RGBA,h.PixelType.UNSIGNED_BYTE,
c);l.setViewport(x,u,t,m);l.bindFramebuffer(w);q.dispose();r.dispose();return 255===c[0]}_prepareProgram(){const c=`#version 300 es\n    precision highp float;\n\n    out float triangleId;\n\n    const vec3 triangleVertices[3] = vec3[3](vec3(-0.5, -0.5, 0.0), vec3(0.5, -0.5, 0.0), vec3(0.0, 0.5, 0.0));\n\n    void main(void) {\n      triangleId = floor(float(gl_VertexID)/3.0);\n\n      vec3 position = triangleVertices[gl_VertexID % 3];\n      float offset = triangleId / ${n.glsl.float(85)};\n      position.z = 0.5 - offset;\n\n      gl_Position = vec4(position, 1.0);\n    }\n    `,
l=`#version 300 es\n    precision highp float;\n\n    in float triangleId;\n\n    out vec4 fragColor;\n\n    void main(void) {\n      fragColor = triangleId == ${n.glsl.float(85)} ? vec4(0.0, 1.0, 0.0, 1.0) : vec4(1.0, 0.0, 0.0, 1.0);\n    }\n    `;return this._rctx.programCache.acquire(c,l,new Map([]))}_prepareHelperProgram(){const c=k.AppleAmdDriverHelper.getShaderSources();return this._rctx.programCache.acquire(c.vertex,c.fragment,new Map([]))}}a.DrawArraysRequiresIndicesTypeReset=f;Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/WebGLDriverTestModule":function(){define(["exports","../../core/maybe"],function(a,b){class n{constructor(){this._result=!1}dispose(){this._program=b.disposeMaybe(this._program)}get result(){null!=this._program&&(this._result=this._test(this._program),this.dispose());return this._result}}a.WebGLDriverTestModule=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/testDoublePrecisionArithmetic":function(){define("exports ../../core/floatRGBA ../../core/has ../../core/maybe ../../core/libs/gl-matrix-2/factories/vec3f64 ./BufferObject ./doublePrecisionUtils ./enums ./FramebufferObject ./TextureDescriptor ./VertexArrayObject ./VertexElementDescriptor ./WebGLDriverTestModule".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w){function x(t,m){return t.programCache.acquire(`\n\n  precision highp float;\n\n  attribute vec2 position;\n\n  uniform vec3 u_highA;\n  uniform vec3 u_lowA;\n  uniform vec3 u_highB;\n  uniform vec3 u_lowB;\n\n  varying vec4 v_color;\n\n  ${m?"#define DOUBLE_PRECISION_REQUIRES_OBFUSCATION":""}\n\n  #ifdef DOUBLE_PRECISION_REQUIRES_OBFUSCATION\n\n  vec3 dpPlusFrc(vec3 a, vec3 b) {\n    return mix(a, a + b, vec3(notEqual(b, vec3(0))));\n  }\n\n  vec3 dpMinusFrc(vec3 a, vec3 b) {\n    return mix(vec3(0), a - b, vec3(notEqual(a, b)));\n  }\n\n  vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {\n    vec3 t1 = dpPlusFrc(hiA, hiB);\n    vec3 e = dpMinusFrc(t1, hiA);\n    vec3 t2 = dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;\n    return t1 + t2;\n  }\n\n  #else\n\n  vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {\n    vec3 t1 = hiA + hiB;\n    vec3 e = t1 - hiA;\n    vec3 t2 = ((hiB - e) + (hiA - (t1 - e))) + loA + loB;\n    return t1 + t2;\n  }\n\n  #endif\n\n  const float MAX_RGBA_FLOAT =\n    255.0 / 256.0 +\n    255.0 / 256.0 / 256.0 +\n    255.0 / 256.0 / 256.0 / 256.0 +\n    255.0 / 256.0 / 256.0 / 256.0 / 256.0;\n\n  const vec4 FIXED_POINT_FACTORS = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);\n\n  vec4 float2rgba(const float value) {\n    // Make sure value is in the domain we can represent\n    float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);\n\n    // Decompose value in 32bit fixed point parts represented as\n    // uint8 rgba components. Decomposition uses the fractional part after multiplying\n    // by a power of 256 (this removes the bits that are represented in the previous\n    // component) and then converts the fractional part to 8bits.\n    vec4 fixedPointU8 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);\n\n    // Convert uint8 values (from 0 to 255) to floating point representation for\n    // the shader\n    const float toU8AsFloat = 1.0 / 255.0;\n\n    return fixedPointU8 * toU8AsFloat;\n  }\n\n  void main() {\n    vec3 val = dpAdd(u_highA, u_lowA, -u_highB, -u_lowB);\n\n    v_color = float2rgba(val.z / 25.0);\n\n    gl_Position = vec4(position * 2.0 - 1.0, 0.0, 1.0);\n  }\n  `,
"\n  precision highp float;\n\n  varying vec4 v_color;\n\n  void main() {\n    gl_FragColor \x3d v_color;\n  }\n  ",new Map([["position",0]]))}class u extends w.WebGLDriverTestModule{constructor(t){super();this._rctx=t;this._program=x(this._rctx,!1);this._obfuscated=x(this._rctx,!0)}dispose(){super.dispose();this._obfuscated=k.disposeMaybe(this._obfuscated)}_test(t){if(n("force-double-precision-obfuscation"))return!0;if(null==this._obfuscated)return!1;const m=this._rctx,q=m.getBoundFramebufferObject(),
{x:r,y:v,width:y,height:B}=m.getViewport();t=this._runProgram(t);const z=this._runProgram(this._obfuscated);m.setViewport(r,v,y,B);m.bindFramebuffer(q);return 0!==t&&(0===z||5<t/z)}_runProgram(t){var m=this._rctx;m.resetState();var q=new f.TextureDescriptor(1);q.wrapMode=g.TextureWrapMode.CLAMP_TO_EDGE;q.samplingMode=g.TextureSamplingMode.NEAREST;q=new d.FramebufferObject(m,q);var r=h.BufferObject.createVertex(m,g.Usage.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1]));r=new c.VertexArrayObject(m,new Map([["position",
0]]),new Map([["geometry",[new l.VertexElementDescriptor("position",2,g.DataType.UNSIGNED_SHORT,0,4)]]]),new Map([["geometry",r]]));const v=p.fromValues(5633261.287538229,2626832.878767164,1434988.0495278358),y=p.fromValues(5633271.46742708,2626873.6381334523,1434963.231608387),B=new Float32Array(6);e.encodeDoubleArray(v,B,3);const z=new Float32Array(6);e.encodeDoubleArray(y,z,3);m.useProgram(t);t.setUniform3f("u_highA",B[0],B[2],B[4]);t.setUniform3f("u_lowA",B[1],B[3],B[5]);t.setUniform3f("u_highB",
z[0],z[2],z[4]);t.setUniform3f("u_lowB",z[1],z[3],z[5]);m.bindFramebuffer(q);m.setViewport(0,0,1,1);m.bindVAO(r);m.drawArrays(g.PrimitiveType.TRIANGLE_STRIP,0,4);t=new Uint8Array(4);q.readPixels(0,0,1,1,g.PixelFormat.RGBA,g.PixelType.UNSIGNED_BYTE,t);r.dispose();q.dispose();m=(v[2]-y[2])/25;t=b.unpackFloatRGBA(t);return Math.abs(m-t)}}a.DoublePrecisionRequiresObfuscation=u;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/testFloatBufferBlend":function(){define("exports ./BufferObject ./enums ./FramebufferObject ./renderState ./TextureDescriptor ./VertexArrayObject ./VertexElementDescriptor ./WebGLDriverTestModule".split(" "),
function(a,b,n,k,p,h,e,g,d){class f extends d.WebGLDriverTestModule{constructor(c){super();this._rctx=c;c.gl&&c.capabilities.colorBufferFloat?.textureFloat&&c.capabilities.colorBufferFloat?.floatBlend&&(this._program=c.programCache.acquire("\n    precision highp float;\n    attribute vec2 a_pos;\n\n    void main() {\n      gl_Position \x3d vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);\n    }\n    ","\n     precision highp float;\n\n     void main() {\n      gl_FragColor \x3d vec4(0.5, 0.5, 0.5, 0.5);\n     }\n    ",
new Map([["a_pos",0]])))}_test(c){const l=this._rctx;var w=new h.TextureDescriptor(1);w.wrapMode=n.TextureWrapMode.CLAMP_TO_EDGE;w.dataType=n.PixelType.FLOAT;w.internalFormat=n.SizedPixelFormat.RGBA32F;w.samplingMode=n.TextureSamplingMode.NEAREST;w=new k.FramebufferObject(l,w);var x=b.BufferObject.createVertex(l,n.Usage.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1]));x=new e.VertexArrayObject(l,new Map([["a_pos",0]]),new Map([["geometry",[new g.VertexElementDescriptor("a_pos",2,n.DataType.UNSIGNED_SHORT,
0,4)]]]),new Map([["geometry",x]]));l.gl.getError();l.useProgram(c);c=l.getBoundFramebufferObject();const {x:u,y:t,width:m,height:q}=l.getViewport();l.bindFramebuffer(w);l.setViewport(0,0,1,1);l.bindVAO(x);l.drawArrays(n.PrimitiveType.TRIANGLE_STRIP,0,4);var r=p.makePipelineState({blending:p.writeDestinationPremultipliedAlpha});l.setPipelineState(r);l.drawArrays(n.PrimitiveType.TRIANGLE_STRIP,0,4);r=l.gl.getError();l.setViewport(u,t,m,q);l.bindFramebuffer(c);x.dispose();w.dispose();return r===l.gl.INVALID_OPERATION?
(console.warn("Device claims support for WebGL extension EXT_float_blend but does not support it. Using fall back."),!1):!0}}a.FloatBufferBlend=f;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/testSVGPremultipliedAlpha":function(){define("exports ../2d/engine/webgl/DefaultVertexAttributeLayouts ./BufferObject ./enums ./FramebufferObject ./Texture ./TextureDescriptor ./VertexArrayObject ./WebGLDriverTestModule".split(" "),function(a,b,n,k,p,h,e,g,d){class f extends d.WebGLDriverTestModule{constructor(l){super();
this._rctx=l;this._program=l.programCache.acquire("\n    precision highp float;\n\n    attribute vec2 a_pos;\n    varying vec2 v_uv;\n\n    void main() {\n      v_uv \x3d a_pos;\n      gl_Position \x3d vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);\n    }\n    ","\n    precision highp float;\n\n    varying vec2 v_uv;\n\n    uniform sampler2D u_texture;\n\n    void main() {\n      gl_FragColor \x3d texture2D(u_texture, v_uv);\n    }\n    ",new Map([["a_pos",0]]))}dispose(){super.dispose()}_test(l){const w=this._rctx;
if(!w.gl)return l.dispose(),!0;var x=new e.TextureDescriptor(1);x.wrapMode=k.TextureWrapMode.CLAMP_TO_EDGE;x.samplingMode=k.TextureSamplingMode.NEAREST;x=new p.FramebufferObject(w,x);var u=n.BufferObject.createVertex(w,k.Usage.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1]));u=new g.VertexArrayObject(w,new Map([["a_pos",0]]),b.Pos2us,new Map([["geometry",u]]));var t=new e.TextureDescriptor;t.samplingMode=k.TextureSamplingMode.LINEAR;t.wrapMode=k.TextureWrapMode.CLAMP_TO_EDGE;t=new h.Texture(w,t,c);
w.useProgram(l);w.bindTexture(t,0);l.setUniform1i("u_texture",0);l=w.getBoundFramebufferObject();const {x:m,y:q,width:r,height:v}=w.getViewport();w.bindFramebuffer(x);w.setViewport(0,0,1,1);w.setClearColor(0,0,0,0);w.setBlendingEnabled(!1);w.clear(k.FramebufferBit.COLOR);w.bindVAO(u);w.drawArrays(k.PrimitiveType.TRIANGLE_STRIP,0,4);const y=new Uint8Array(4);x.readPixels(0,0,1,1,k.PixelFormat.RGBA,k.PixelType.UNSIGNED_BYTE,y);u.dispose();x.dispose();t.dispose();w.setViewport(m,q,r,v);w.bindFramebuffer(l);
return 255!==y[0]}}const c=new Image;c.src="data:image/svg+xml,%3C%3Fxml version\x3d'1.0' encoding\x3d'UTF-8'%3F%3E%3Csvg width\x3d'5' height\x3d'5' version\x3d'1.1' viewBox\x3d'0 0 5 5' xmlns\x3d'http://www.w3.org/2000/svg'%3E%3Crect width\x3d'5' height\x3d'5' fill\x3d'%23f00' fill-opacity\x3d'.5'/%3E%3C/svg%3E%0A";c.width=5;c.height=5;c.decode();a.SVGPremultipliedAlpha=f;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/DefaultVertexAttributeLayouts":function(){define(["exports",
"../../../webgl/enums","../../../webgl/VertexElementDescriptor"],function(a,b,n){const k=new Map([["geometry",[new n.VertexElementDescriptor("a_pos",2,b.DataType.BYTE,0,2)]]]),p=new Map([["geometry",[new n.VertexElementDescriptor("a_pos",2,b.DataType.BYTE,0,4),new n.VertexElementDescriptor("a_tex",2,b.DataType.BYTE,2,4)]]]);b=new Map([["geometry",[new n.VertexElementDescriptor("a_pos",2,b.DataType.UNSIGNED_SHORT,0,4)]]]);a.Pos2b=k;a.Pos2us=b;a.PosTex2b=p;Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/views/webgl/capabilities/Capabilities":function(){define(["exports","./DisjointTimerQuery","./load","./LoseContext"],function(a,b,n,k){class p{constructor(h,e){this._gl=h;this._textureFloatLinear=this._textureNorm16=this._loseContext=this._colorBufferFloat=this._textureFilterAnisotropic=this._compressedTextureS3TC=this._compressedTextureETC=null;this._disabledExtensions=e.disabledExtensions||{};this._debugWebGLExtensions=e.debugWebGLExtensions||{}}get compressedTextureETC(){this._compressedTextureETC??
(this._compressedTextureETC=n.loadCompressedTextureETC(this._gl,this._disabledExtensions));return this._compressedTextureETC}get compressedTextureS3TC(){this._compressedTextureS3TC??(this._compressedTextureS3TC=n.loadCompressedTextureS3TC(this._gl,this._disabledExtensions));return this._compressedTextureS3TC}get textureFilterAnisotropic(){this._textureFilterAnisotropic??(this._textureFilterAnisotropic=n.loadTextureFilterAnisotropicCapability(this._gl,this._disabledExtensions));return this._textureFilterAnisotropic}get disjointTimerQuery(){this._disjointTimerQuery??
(this._disjointTimerQuery=b.createDisjointTimerQuery(this._gl,this._disabledExtensions));return this._disjointTimerQuery}get colorBufferFloat(){this._colorBufferFloat??(this._colorBufferFloat=n.loadColorBufferFloat(this._gl,this._disabledExtensions));return this._colorBufferFloat}get loseContext(){this._loseContext??(this._loseContext=k.load(this._gl,this._debugWebGLExtensions));return this._loseContext}get textureNorm16(){this._textureNorm16??(this._textureNorm16=n.loadTextureNorm16(this._gl,this._disabledExtensions));
return this._textureNorm16}get textureFloatLinear(){this._textureFloatLinear??(this._textureFloatLinear=n.loadBooleanExtension(this._gl,this._disabledExtensions,"textureFloatLinear",!1,["OES_texture_float_linear"]));return this._textureFloatLinear}enable(h){return this[h]}}a.Capabilities=p;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/capabilities/load":function(){define(["exports"],function(a){a.loadBooleanExtension=function(b,n,k,p,h){if(p)return!0;if(n[k])return!1;
for(const e of h)if(b.getExtension(e))return!0;return!1};a.loadColorBufferFloat=function(b,n){const k=!n.colorBufferHalfFloat&&b.getExtension("EXT_color_buffer_half_float")||!n.colorBufferFloat&&b.getExtension("EXT_color_buffer_float"),p=!n.colorBufferFloat&&b.getExtension("EXT_color_buffer_float");n=!n.floatBlend&&!n.colorBufferFloat&&b.getExtension("EXT_float_blend");return k||p||n?{textureFloat:!!p,textureHalfFloat:!!k,floatBlend:!!n,R16F:b.R16F,RG16F:b.RG16F,RGBA16F:b.RGBA16F,R32F:b.R32F,RG32F:b.RG32F,
RGBA32F:b.RGBA32F,R11F_G11F_B10F:b.R11F_G11F_B10F,RGB16F:b.RGB16F}:null};a.loadCompressedTextureETC=function(b,n){return n.compressedTextureETC?null:(b=b.getExtension("WEBGL_compressed_texture_etc"))?{COMPRESSED_R11_EAC:b.COMPRESSED_R11_EAC,COMPRESSED_SIGNED_R11_EAC:b.COMPRESSED_SIGNED_R11_EAC,COMPRESSED_RG11_EAC:b.COMPRESSED_RG11_EAC,COMPRESSED_SIGNED_RG11_EAC:b.COMPRESSED_SIGNED_RG11_EAC,COMPRESSED_RGB8_ETC2:b.COMPRESSED_RGB8_ETC2,COMPRESSED_SRGB8_ETC2:b.COMPRESSED_SRGB8_ETC2,COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:b.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2,
COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:b.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2,COMPRESSED_RGBA8_ETC2_EAC:b.COMPRESSED_RGBA8_ETC2_EAC,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:b.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC}:null};a.loadCompressedTextureS3TC=function(b,n){return n.compressedTextureS3TC?null:(b=b.getExtension("WEBGL_compressed_texture_s3tc"))?{COMPRESSED_RGB_S3TC_DXT1:b.COMPRESSED_RGB_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT1:b.COMPRESSED_RGBA_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT3:b.COMPRESSED_RGBA_S3TC_DXT3_EXT,
COMPRESSED_RGBA_S3TC_DXT5:b.COMPRESSED_RGBA_S3TC_DXT5_EXT}:null};a.loadTextureFilterAnisotropicCapability=function(b,n){return n.textureFilterAnisotropic?null:(b=b.getExtension("EXT_texture_filter_anisotropic")||b.getExtension("MOZ_EXT_texture_filter_anisotropic")||b.getExtension("WEBKIT_EXT_texture_filter_anisotropic"))?{MAX_TEXTURE_MAX_ANISOTROPY:b.MAX_TEXTURE_MAX_ANISOTROPY_EXT,TEXTURE_MAX_ANISOTROPY:b.TEXTURE_MAX_ANISOTROPY_EXT}:null};a.loadTextureNorm16=function(b,n){return n.textureNorm16?null:
(b=b.getExtension("EXT_texture_norm16"))?{R16:b.R16_EXT,RG16:b.RG16_EXT,RGB16:b.RGB16_EXT,RGBA16:b.RGBA16_EXT,R16_SNORM:b.R16_SNORM_EXT,RG16_SNORM:b.RG16_SNORM_EXT,RGB16_SNORM:b.RGB16_SNORM_EXT,RGBA16_SNORM:b.RGBA16_SNORM_EXT}:null};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/capabilities/LoseContext":function(){define(["exports"],function(a){a.load=function(b,n){const k=n.loseContext&&b.getExtension("WEBGL_lose_context");return k?{loseRenderingContext:()=>k.loseContext()}:
null};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/TextureRepository":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Evented ../../../../core/Logger ../../../../core/promiseUtils ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ./basicInterfaces ./ContentObjectType ./ITexture ./TextureTechnique ./TextureTechniqueConfiguration ./Util ../../../support/Scheduler".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w,x,u,t,m){a.TextureRepository=class extends n{constructor(r,v,y){super({});this._stage=r;this._techniques=v;this._rctx=y;this._textures=new Map;this._loadingCount=0;this._frameUpdates=new Map;this.events=new k;this._frameTask=r.view.resourceController.scheduler.registerTask(m.TaskPriority.TEXTURE_UNLOAD)}normalizeCtorArgs(){return{}}destroy(){this._frameTask.remove();this._stage.forEachOfType(l.ContentObjectType.Texture,r=>r.unload())}get updating(){return 0<this._loadingCount||
this._frameTask.updating}get textureTechnique(){null==this._textureTechnique&&(this._textureTechnique=this._techniques.acquire(x.TextureTechnique,new u.TextureTechniqueConfiguration));return this._textureTechnique}acquire(r){const v=this._textures.get(r);return v?(v.ref(),v.loadingPromise??v):this._createNewRef(r)}update(){let r=!1;this._frameUpdates.forEach(v=>{const y=v.texture.frameUpdate(v.previousToken);0<=y&&y!==v.previousToken&&(v.previousToken=y,r=!0)});r&&this.events.emit("changed",c.RenderRequestType.BACKGROUND)}_createNewRef(r){const v=
this._stage.getObject(r);if(null==v)return t.assert(void 0!==v),null;const y=v.events.on("unloaded",()=>{y.remove();this._onTextureUnloaded(r)}),B=new q(r,()=>{this._frameTask.schedule(()=>{B.isUnreferenced&&v.unload()})});this._textures.set(r,B);B.ref();if(v.glTexture)return this._updateGLTexture(B,v.glTexture),w.isFrameUpdateTexture(v)&&this._frameUpdates.set(r,{texture:v,previousToken:-1}),B;this._loadingCount++;B.loadingPromise=this._stage.schedule(()=>{const z=v.load(this._rctx),A=H=>{this._loadingCount--;
B.loadingPromise=null;this._updateGLTexture(B,H);w.isFrameUpdateTexture(v)&&this._frameUpdates.set(r,{texture:v,previousToken:-1});return B},C=H=>{this._loadingCount--;B.loadingPromise=null;h.isAbortError(H)||p.getLogger(this).error(H);return null};return h.isPromiseLike(z)?z.then(A,C):A(z)});return B.loadingPromise}_updateGLTexture(r,v){r.glTexture=v;this.events.emit("changed",c.RenderRequestType.UPDATE)}_onTextureUnloaded(r){this._textures.delete(r);this._frameUpdates.delete(r)}};b.__decorate([e.property()],
a.TextureRepository.prototype,"_loadingCount",void 0);b.__decorate([e.property()],a.TextureRepository.prototype,"_frameTask",void 0);b.__decorate([e.property()],a.TextureRepository.prototype,"updating",null);a.TextureRepository=b.__decorate([f.subclass("esri.views.3d.webgl-engine.lib.TextureRepository")],a.TextureRepository);class q{constructor(r,v){this.id=r;this._release=v;this._refCount=0}get isUnreferenced(){return 0===this._refCount}ref(){++this._refCount}release(){--this._refCount;0<this._refCount||
(0===this._refCount?this._release():(p.getLogger("esri.views.3d.webgl-engine.lib.TextureRepository.RefCountedTextureImpl").error("Cannot dereference texture that has no references!"),this._refCount=0))}}Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/ITexture":function(){define(["exports"],function(a){a.isFrameUpdateTexture=function(b){return!!b.frameUpdate};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/markerTextureRepository":function(){define(["exports",
"../../support/engineContent/marker","./ProceduralTextureRepository"],function(a,b,n){a.createMarkerTextureRepository=function(k,p){return new n.ProceduralTextureRepository(h=>b.createMarkerTexture(h,k),h=>h,p)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/internal/WaterTextureRepository":function(){define("exports ../../../../../chunks/tslib.es6 ../../../../../assets ../../../../../core/Accessor ../../../../../core/asyncUtils ../../../../../core/Logger ../../../../../core/maybe ../../../../../core/promiseUtils ../../../../../core/accessorSupport/decorators/property ../../../../../core/has ../../../../../core/RandomLCG ../../../../../core/accessorSupport/decorators/subclass ../../../../../support/requestImageUtils ../../core/shaderModules/interfaces ../../lib/basicInterfaces ../../../../webgl/enums ../../../../webgl/Texture ../../../../webgl/TextureDescriptor".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w,x,u,t,m,q){a.WaterTextureRepository=class extends k{constructor(){super(...arguments);this._passParameters=new r;this._resourcesTask=null}get passParameters(){return this._passParameters}destroy(){this._resourcesTask=e.abortMaybe(this._resourcesTask);this._passParameters.waveNormal=e.disposeMaybe(this._passParameters.waveNormal);this._passParameters.wavePerturbation=e.disposeMaybe(this._passParameters.wavePerturbation)}get updating(){return!!this._resourcesTask&&
!this._resourcesTask.finished}ensureResources(v){this._resourcesTask||(this._resourcesTask=p.createTask(async y=>{await Promise.allSettled([this._loadImageResource(v,n.getAssetUrl("esri/images/materials/water/normals.jpg"),B=>this._passParameters.waveNormal=B,y),this._loadImageResource(v,n.getAssetUrl("esri/images/materials/water/perturbation.jpg"),B=>this._passParameters.wavePerturbation=B,y)])}));return this._resourcesTask.finished?u.ResourceState.LOADED:u.ResourceState.LOADING}async _loadImageResource(v,
y,B,z){try{const A=await w.requestImage(y,{signal:z});g.throwIfAborted(z);const C=new q.TextureDescriptor(A.width,A.height);C.pixelFormat=t.PixelFormat.RGB;C.samplingMode=t.TextureSamplingMode.LINEAR_MIPMAP_LINEAR;C.hasMipmap=!0;C.maxAnisotropy=8;B(new m.Texture(v,C,A))}catch(A){h.getLogger(this).error("Failed to load water material normal texture.",A)}}};b.__decorate([d.property()],a.WaterTextureRepository.prototype,"_resourcesTask",void 0);b.__decorate([d.property({type:Boolean,readOnly:!0})],a.WaterTextureRepository.prototype,
"updating",null);a.WaterTextureRepository=b.__decorate([l.subclass("esri.views.3d.webgl-engine.materials.internal.WaterTextureRepository")],a.WaterTextureRepository);class r extends x.NoParameters{}a.WaterTexturePassParameters=r;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/parts/contextCache":function(){define(["exports"],function(a){const b=new Map;a.getContextCache=function(){return b};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/webgl-engine/parts/ScreenshotManager":function(){define("exports ../../../../core/promiseUtils ../../../../core/libs/gl-matrix-2/factories/vec4f64 ../lib/basicInterfaces ../lib/rendererUtils ../../../support/RenderState ../../../support/screenshotUtils ../../../webgl/enums ../../../webgl/FramebufferObject ../../../../core/imageUtils".split(" "),function(a,b,n,k,p,h,e,g,d,f){class c{constructor(w,x){this.parameters=w;this.fbos=x}}class l{constructor(w,x,u){this._rctx=w;this._renderFunctions=
x;this._forceCameraHook=u;this.supersample=!0;this._screenshotQueue=[]}destroy(){this._rctx=null}async takeScreenshot(w){await this._renderFunctions.prepareOverlay();this._renderFunctions.requestRenderScene(k.RenderRequestType.BACKGROUND);const x=b.createResolver();this._screenshotQueue.push({settings:w,resolver:x});return x.promise}update(w,x){for(const u of this._screenshotQueue){if(null==this._rctx){u.resolver.reject();continue}const t=this._renderScreenshot(w,{...u.settings,pixelRatio:u.settings.pixelRatio*
w.parameters.camera.pixelRatio},x);u.resolver(t)}this._screenshotQueue.length=0}_renderScreenshotOverlay(w,x,u){w.width=x.width;w.height=x.height;const t=w.getContext("2d"),m=u.pixelRatio;t.save();t.translate(0,x.height);t.scale(1,-1);u.region&&t.translate(-u.region.x,-u.region.y);t.scale(m,m);x=this._renderFunctions.renderOverlay(w,u.disableDecorations,x);t.restore();return x}_readbackScreenshot(w,x){return w.resample?this._readbackScreenshotResampled({...w,resample:w.resample},x):this._readbackScreenshotImmediate(w,
x)}_readbackScreenshotResampled(w,x){const {framebufferWidth:u,framebufferHeight:t,region:m,resample:q}=w,r=this._ensureScreenshotEncodeCanvas();let v=f.createEmptyImageData(u,t,r);this._rctx.gl.readPixels(0,0,u,t,g.PixelFormat.RGBA,g.DataType.UNSIGNED_BYTE,new Uint8Array(v.data.buffer));x();v=this._renderScreenshotOverlay(r,v,{...w,region:void 0});w=f.createEmptyImageData(m.width,m.height,r);return e.resampleHermite(v,w,!0,q.region.x,t-(q.region.y+q.region.height),q.region.width,q.region.height)}_readbackScreenshotImmediate(w,
x){const {framebufferHeight:u,region:t}=w,m=this._ensureScreenshotEncodeCanvas(),q=f.createEmptyImageData(t.width,t.height,m);this._rctx.gl.readPixels(t.x,u-(t.y+t.height),t.width,t.height,g.PixelFormat.RGBA,g.DataType.UNSIGNED_BYTE,new Uint8Array(q.data.buffer));x();return this._renderScreenshotOverlay(m,q,w)}_renderScreenshot(w,x,u){var t=w.parameters.camera,m={width:x.framebufferWidth,height:x.framebufferHeight};d.ensureAttachmentMaxSize(m,Math.min(this._rctx.parameters.maxTextureSize,this._rctx.parameters.maxRenderbufferSize));
var q=!1,r=x.ignorePadding&&t.pixelRatio!==x.pixelRatio;r=m.width!==t.fullWidth||m.height!==t.fullHeight||x.disableDecorations||r||x.objectAndLayerIdColor;let v=null,y=null;if(r){q=t.clone();if(x.ignorePadding){var B=n.clone(q.padding);for(let z=0;4>z;z++)B[z]=Math.round(B[z]/q.pixelRatio*x.pixelRatio);q.padding=B}q.fullWidth=m.width;q.fullHeight=m.height;q.pixelRatio=x.pixelRatio;m=t.fovX-q.fovX;B=t.fovY-q.fovY;0>m&&m<B?q.fovX=t.fovX:0>B&&B<m&&(q.fovY=t.fovY);t={camera:q,contentCamera:q,mode:h.RenderState.IDLE,
alignPixelEnabled:!0,contentPixelRatio:q.pixelRatio,forcedAnimationTime:w.parameters.forcedAnimationTime};this._forceCameraHook(t);q=!0;u=this._renderFunctions.renderScene(t,u,x.objectAndLayerIdColor?p.RendererTarget.ObjectAndLayerID:p.RendererTarget.Screenshot,x.disableDecorations);y=u.screen;v=u.olid}this._rctx.bindFramebuffer(y?.fbo);u=this._readbackScreenshot(x,()=>{this._rctx.bindFramebuffer(null);y?.release()});t=null;x.objectAndLayerIdColor&&(this._rctx.bindFramebuffer(v?.fbo),t=this._readbackScreenshot(x,
()=>{this._rctx.bindFramebuffer(null);v?.release()}),this._rctx.bindFramebuffer(null));if(r&&!this._rctx.contextAttributes.alpha)for(x=3;x<u.data.length;x+=4)u.data[x]=255;if(t&&!this._rctx.contextAttributes.alpha)for(x=3;x<t.data.length;x+=4)t.data[x]=255;q&&this._forceCameraHook(w.parameters);return[u,t]}_ensureScreenshotEncodeCanvas(){this._screenshotEncodeCanvas||(this._screenshotEncodeCanvas=document.createElement("canvas"));return this._screenshotEncodeCanvas}}a.ScreenshotContext=c;a.ScreenshotManager=
l;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/support/screenshotUtils":function(){define(["exports","../../core/has","../../core/mathUtils","../../core/imageUtils"],function(a,b,n,k){function p(t,m){const {format:q,quality:r,rotation:v,disableDecorations:y}=t||{};var B=f(t,m.padding);var z=m.width-B.left-B.right;m=m.height-B.top-B.bottom;B={x:0,y:0,width:z,height:m};if(t?.area){null!=t.area.x&&(B.x=Math.floor(t.area.x));null!=t.area.y&&(B.y=Math.floor(t.area.y));var A=
null!=t.area.width?Math.floor(t.area.width):null,C=null!=t.area.height?Math.floor(t.area.height):null;B.width=z-B.x;B.height=m-B.y;null!=A&&null!=C?(B.width=Math.min(B.width,A),B.height=Math.min(B.height,C)):null==A&&null!=C?(A=Math.min(B.width,A),B.height*=A/B.width,B.width=A):null!=A&&null==C&&(A=Math.min(B.height,C),B.width*=A/B.height,B.height=A)}B=d(B,t);A=Math.floor(Math.max(B.x,0));C=Math.floor(Math.max(B.y,0));z={x:A,y:C,width:Math.floor(Math.min(B.width,z-A)),height:Math.floor(Math.min(B.height,
m-C))};m=z.width/z.height;B=B.width/B.height;B!==m&&(B>m?(m=Math.floor(z.width/B),z={x:z.x,y:Math.floor(z.y+(z.height-m)/2),width:z.width,height:m}):(m=Math.floor(z.height*B),z={x:Math.floor(z.x+(z.width-m)/2),y:z.y,width:m,height:z.height}));const {width:H,height:E}=g(t,z);m=c(q);B=x[m];B=n.clamp(null!=r?r:B,0,100);return{format:m,quality:B,area:z,width:H,height:E,rotation:v,disableDecorations:!!y,ignoreBackground:!!t?.ignoreBackground,ignorePadding:!!t?.ignorePadding}}function h(t,m){null==l&&(l=
document.createElement("canvas"));var q=l;if(m.premultipliedAlpha){var r=t.data;const y=r.length;for(let B=0;B<y;B+=4){var v=r[B+3];255!==v&&0<v&&(v=255/v,r[B]*=v,r[B+1]*=v,r[B+2]*=v)}}q.width=t.width;q.height=t.height;r=q.getContext("2d",{willReadFrequently:!0});r.putImageData(t,0,0);m.flipY&&(r.save(),r.globalCompositeOperation="copy",r.scale(1,-1),r.translate(0,-r.canvas.height),r.drawImage(r.canvas,0,0),r.restore());return{ctx:r,canvas:q}}function e(t,m){return t.toDataURL(w[m.format],m.quality/
100)}function g(t,m){if(!t)return m;const q=t.width;t=t.height;if(null!=q&&null!=t)return{width:Math.floor(q),height:Math.floor(t)};if(null==q&&null==t)return m;m=m.width/m.height;return null==t?{width:Math.floor(q),height:Math.floor(q/m)}:{width:Math.floor(t*m),height:Math.floor(t)}}function d(t,m){if(null==m?.width||null==m.height)return t;m=m.width/m.height;const q=t.width/t.height;if(q===m)return t;if(q<m)return m=Math.floor(t.height*m),t.x-=(m-t.width)/2,t.width=m,t;m=Math.floor(t.width/m);t.y-=
(m-t.height)/2;t.height=m;return t}function f(t,m){return!m||t?.ignorePadding?u:m}function c(t){switch(t){case "png":case "jpg":case "jpeg":return t;case null:case void 0:return"png";default:return"png"}}let l=null;const w={png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg"},x={png:100,jpg:98,jpeg:98},u={top:0,right:0,bottom:0,left:0};a.createEmptyImageData=k.createEmptyImageData;a.completeUserSettings=p;a.encode=function(t,m,q){const {ctx:r,canvas:v}=h(t,q);t=r.getImageData(0,0,t.width,t.height);
m=e(v,m);v.width=0;v.height=0;return{dataUrl:m,data:t}};a.encodeData=function(t,m){const {ctx:q,canvas:r}=h(t,m);t=q.getImageData(0,0,t.width,t.height);r.width=0;r.height=0;return t};a.getFormatAndQuality=function(t,m){t=c(t);const q=x[t];m=n.clamp(null!=m?m:q,0,100);return{format:t,quality:m}};a.getMaximumResolutionScale=function(t,m){return m/Math.max(t[0],t[1])};a.resampleHermite=function(t,m,q,r=0,v=0,y=t.width-r,B=t.height-v,z=!1){const {data:A}=t,{width:C,height:H,data:E}=m;y/=C;B/=H;const F=
Math.ceil(y/2),G=Math.ceil(B/2);t=t.width;for(let J=0;J<H;J++)for(let N=0;N<C;N++){const M=4*(N+(z?H-J-1:J)*C);let Q=0,O=0,K=0,L=0,P=0,R=0;const W=(J+.5)*B;for(let V=Math.floor(J*B);V<(J+1)*B;V++){var D=Math.abs(W-(V+.5))/G;const ba=(N+.5)*y;D*=D;for(let U=Math.floor(N*y);U<(N+1)*y;U++){var I=Math.abs(ba-(U+.5))/F;I=Math.sqrt(D+I*I);if(1<=I)continue;I=2*I*I*I-3*I*I+1;const da=4*(r+U+(v+V)*t);R+=I*A[da+3];O+=I;!q&&255>A[da+3]&&(I=I*A[da+3]/255);K+=I*A[da];L+=I*A[da+1];P+=I*A[da+2];Q+=I}}E[M]=K/Q;E[M+
1]=L/Q;E[M+2]=P/Q;E[M+3]=R/O}return m};a.screenshotSuperSampleSettings=function(t,m,q){if(!m)return t;const {framebufferWidth:r,framebufferHeight:v,pixelRatio:y,region:B}=t;m=f(t,q);q=m.left+m.right;const z=m.top+m.bottom,A=r-q,C=v-z,H=Math.min(8,Math.min((2048-q)/A,(2048-z)/C));return 1.5>H?t:{...t,framebufferWidth:Math.round(A*H)+q,framebufferHeight:Math.round(C*H)+z,pixelRatio:y*H,resample:{region:{x:Math.round((B.x-m.left)*H)+m.left,y:Math.round((B.y-m.top)*H)+m.top,width:Math.round(B.width*H),
height:Math.round(B.height*H)},width:r,height:v}}};a.toDataUrl=e;a.toRenderSettings=function(t,m){const q=p(t,m),r=q.area,v=q.width/r.width,y=f(q,m.padding),B=y.left+y.right,z=y.top+y.bottom;return{framebufferWidth:Math.floor((m.width-B)*v+B),framebufferHeight:Math.floor((m.height-z)*v+z),region:{x:Math.floor(r.x*v)+y.left,y:Math.floor(r.y*v)+y.top,width:q.width,height:q.height},format:q.format,quality:q.quality,rotation:q.rotation,pixelRatio:v,layers:t?.layers??[],disableDecorations:q.disableDecorations,
ignoreBackground:q.ignoreBackground,ignorePadding:q.ignorePadding,objectAndLayerIdColor:!1}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/imageUtils":function(){define("require exports ../request ./Error ./promiseUtils ./urlUtils ../support/base64Utils".split(" "),function(a,b,n,k,p,h,e){function g(w,x,u){u||(c||(c=document.createElement("canvas"),c.width=1,c.height=1),u=c);return u.getContext("2d").createImageData(w,x)}async function d(w,x){w=window.URL.createObjectURL(w);
try{const {data:u}=await n(w,{...x,responseType:"image"});return u}catch(u){if(!p.isAbortError(u))throw new k("invalid-image",`Could not fetch requested image at ${w}`);throw u;}finally{window.URL.revokeObjectURL(w)}}async function f(w,x){const u=h.dataComponents(w);if(u?.isBase64)return{arrayBuffer:e.base64ToArrayBuffer(u.data),mediaType:u.mediaType};x=await n(w,{responseType:"array-buffer",...x});w=x.data;x=x.getHeader?.("Content-Type")??"";return{arrayBuffer:w,mediaType:x}}let c=null,l=!0;b.createEmptyImageData=
function(w,x,u){if(!w||!x)throw Error("Cannot construct image data without dimensions");if(l)try{return new ImageData(w,x)}catch(t){l=!1}return g(w,x,u)};b.getImageData=async function(w,x){const {arrayBuffer:u,mediaType:t}=await f(w,x);w="image/png"===t;if("image/gif"===t){const {isAnimatedGIF:m,parseGif:q}=await new Promise((r,v)=>a(["./image/gif"],r,v));if(m(u))return q(u,x)}if(w){const {isAnimatedPNG:m,parseApng:q}=await new Promise((r,v)=>a(["./image/apng"],r,v));if(m(u))return q(u,x)}w=new Blob([u],
{type:t});return d(w,x)};b.wrapImageData=function(w,x,u,t){if(!x||!u)throw Error("Cannot construct image data without dimensions");if(l)try{return new ImageData(w,x,u)}catch(m){l=!1}x=g(x,u,t);x.data.set(w,0);return x};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/parts/testUtils":function(){define(["exports","./contextCache"],function(a,b){a.contextCache={enabled:!1,disposeContextCache:()=>{const n=b.getContextCache();n.forEach(k=>k.dispose());n.clear()}};
Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/support/WebGLRequirements":function(){define(["exports","../../core/Error","../webgl/capabilities"],function(a,b,n){a.check=function(k){const p=n.getWebGLCapabilities();return p.available?"3d"===k&&p.majorPerformanceCaveat?new b("webgl:major-performance-caveat-detected","Your WebGL implementation doesn't seem to support hardware accelerated rendering. Check your browser settings or if your GPU is in a blocklist."):p.supportsHighPrecisionFragment?
p.supportsVertexShaderSamplers?null:new b("webgl:vertex-shader-samplers-required","WebGL support for vertex shader samplers is required but not supported."):new b("webgl:high-precision-fragment-required","WebGL support for high precision fragment shaders is required but not supported."):new b("webgl:required","WebGL2 is required but not supported.",Error().stack)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/capabilities":function(){define(["exports"],function(a){function b(p){if("undefined"===
typeof WebGL2RenderingContext)return null;var h=document.createElement("canvas");if(!h)return null;let e=h.getContext("webgl2",{failIfMajorPerformanceCaveat:!0});null==e&&(e=h.getContext("webgl2"),null!=e&&(p.majorPerformanceCaveat=!0));if(null==e)return e;p.available=!0;p.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE);p.supportsVertexShaderSamplers=0<e.getParameter(e.MAX_VERTEX_TEXTURE_IMAGE_UNITS);if(h=e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.HIGH_FLOAT))p.supportsHighPrecisionFragment=
0<h.precision;return e}let n;class k{constructor(){this.majorPerformanceCaveat=this.available=!1;this.maxTextureSize=0;this.supportsColorBufferHalfFloat=this.supportsColorBufferFloatBlend=this.supportsColorBufferFloat=this.supportsHighPrecisionFragment=this.supportsVertexShaderSamplers=!1}}a.getWebGLCapabilities=function(){if(!n){{const p=new k,h=b(p);null!=h&&(p.supportsColorBufferFloat=null!==h.getExtension("EXT_color_buffer_float"),p.supportsColorBufferFloatBlend=null!==h.getExtension("EXT_float_blend"),
p.supportsColorBufferHalfFloat=p.supportsColorBufferFloat||null!==h.getExtension("EXT_color_buffer_half_float"));n=p}}return n};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/ui/DefaultUI":function(){define("../../chunks/tslib.es6 ../../core/has ../../core/Logger ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/RandomLCG ../../core/accessorSupport/decorators/subclass ./Component ./UI ../../widgets/Attribution ../../widgets/Compass ../../widgets/NavigationToggle ../../widgets/Zoom".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w){b=class extends d{constructor(x){super(x);this._defaultPositionLookup={attribution:"manual",compass:"top-left","navigation-toggle":"top-left",zoom:"top-left"};this.components=[];this._updateViewAwareWidgets=u=>{this.components.forEach(t=>{t=this._find(t)?.widget;void 0!==t?.view&&(t.view=u)})};this._componentsWatcher=(u,t)=>{this._removeComponents(t);this._addComponents(u);this._adjustPadding(u)}}initialize(){this.addHandles([k.watch(()=>this.components,this._componentsWatcher,
k.initial),k.watch(()=>this.view,this._updateViewAwareWidgets,k.initial)])}_add(x,u,t,m,q){let r=x;if("string"===typeof x&&this._defaultPositionLookup[x]){if(this._find(x))return;r=this._createComponent(x)}super._add(r,u,t,m,q)}_removeComponents(x){x.forEach(u=>{if(u=this._find(u))this.remove(u),u.destroy()})}_adjustPadding(x){x.includes("attribution")||this._isOverridden("padding")||({top:x}=this.padding,this.padding=x)}_addComponents(x){this.constructed&&x.forEach(u=>this.add(this._createComponent(u),
this._defaultPositionLookup[u]))}_createComponent(x){const u=this._createWidget(x);return new g({id:x,node:u})}_createWidget(x){const u=this.view;switch(x){case "attribution":return new f({view:u});case "compass":return new c({view:u});case "navigation-toggle":return new l({view:u});case "zoom":return new w({view:u})}}};a.__decorate([p.property()],b.prototype,"components",void 0);return b=a.__decorate([e.subclass("esri.views.ui.DefaultUI")],b)})},"esri/views/ui/UI":function(){define("../../chunks/tslib.es6 ../../intl ../../core/Accessor ../../core/arrayUtils ../../core/Evented ../../core/handleUtils ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/accessorSupport/decorators/cast ../../core/has ../../core/accessorSupport/decorators/subclass ../../support/themeUtils ./Component ../../widgets/support/widgetUtils ../../intl/locale".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w,x,u){function t(y){return 0===y?"0":`${y}px`}function m(y){const B="object"===typeof y&&null!==y&&Object.getPrototypeOf(y);return null!==B&&B!==Object.prototype||!("component"in y||"index"in y||"position"in y)?null:y}function q(y,{top:B,bottom:z,left:A,right:C}){y.style.top=B;y.style.bottom=z;y.style.left=A;y.style.right=C}const r={left:0,top:0,bottom:0,right:0},v={bottom:30,top:15,right:15,left:15};b=class extends p.EventedAccessor{constructor(y){super(y);this._cornerNameToContainerLookup=
{};this._positionNameToContainerLookup={};this._components=[];this._componentMap=new Map;this._removeWidgetHandleKey=Symbol("componentOnRemoveSymbol");this._locale=u.getLocale();this.view=null;this._applyViewPadding=()=>{const B=this.container;B&&q(B,this._toPixelPosition(this._getViewPadding()))};this._applyUIPadding=()=>{const B=this._innerContainer;B&&q(B,this._toPixelPosition(this.padding))};this._initContainers()}initialize(){this.addHandles([e.watch(()=>[this.view?.padding,this.container],this._applyViewPadding,
e.initial),e.watch(()=>this.padding,this._applyUIPadding,e.initial),e.watch(()=>[this.container,this._locale],([y,B])=>{y&&y.setAttribute("lang",B)},e.initial),u.onLocaleChange(y=>{this._locale=y})])}destroy(){this.container=null;for(const y of this._components)y.destroy();this._components.length=0;this._componentMap.clear()}set container(y){const B=this._get("container");y!==B&&(y&&(y.classList.add("esri-ui"),l.setCalciteThemeClass(y),this._attachContainers(y)),B&&(B.classList.remove("esri-ui"),
q(B,{top:"",bottom:"",left:"",right:""}),B.textContent=""),this._set("container",y))}get height(){const y=this.view?.height??0;if(0===y)return y;const B=this._getViewPadding(),{top:z,bottom:A}=B;return Math.max(y-z-A,0)}get padding(){return this._get("padding")}set padding(y){this._overrideIfSome("padding",y)}castPadding(y){return"number"===typeof y?{bottom:y,top:y,right:y,left:y}:{...v,...y}}get width(){const y=this.view?.width??0;if(0===y)return y;const B=this._getViewPadding(),{left:z,right:A}=
B;return Math.max(y-z-A,0)}add(y,B){let z,A,C;if(Array.isArray(y))y.forEach(E=>this.add(E,B));else{var H=m(y);H&&({index:z,position:B,component:y,key:A}=H);B&&"object"===typeof B&&({index:z,key:A,position:B,internal:C}=B);!y||B&&!this._isValidPosition(B)||this._add(y,B,z,A,C)}}remove(y,B){if(y){if(Array.isArray(y))return y.map(A=>this.remove(A,B));if((y=this._find(y))&&(!this._componentMap.has(y)||this._componentMap.get(y)?.key===B)){var z=this._components.indexOf(y);y.node.parentNode?.removeChild(y.node);
this._componentMap.delete(y);y.widget?.removeHandlesReference(this._removeWidgetHandleKey);return this._components.splice(z,1)[0]}}}empty(y,B={removeInternal:!1}){if(Array.isArray(y))for(const z of y)this.empty(z,B);else{y=Array.prototype.slice.call(this._positionNameToContainerLookup[y??"manual"].children).map(z=>this._findByNode(z)).filter(z=>null==z?!1:!(this._componentMap.get(z)?.internal??!1)||B.removeInternal);for(const z of y)this.remove(z)}}move(y,B){Array.isArray(y)&&y.forEach(C=>this.move(C,
B));if(y){var z=m(y)||m(B);if(z){var A=z.index;B=z.position;y=z.component||y}(!B||this._isValidPosition(B))&&(y=this.remove(y))&&this.add(y,{position:B,index:A})}}find(y){return y?(y=this._findById(y))&&(y.widget||y.node):null}getComponents(y,B={includeInternal:!1}){return y?Array.isArray(y)?y.flatMap(z=>this._getComponentsAtPosition(z,B)):this._getComponentsAtPosition(y,B):this._components.filter(z=>B.includeInternal||!(this._componentMap.get(z)?.internal??!1)).map(({widget:z,node:A})=>z??A)}getPosition(y){for(const B in this._positionNameToContainerLookup)if(this._positionNameToContainerLookup[B].contains(y))return B;
return null}_add(y,B,z,A,C){y instanceof w||(y=new w({node:y}));const {widget:H}=y;null!=H&&H instanceof n&&H.addHandles(h.makeHandle(()=>{queueMicrotask(()=>this.remove(y))}),this._removeWidgetHandleKey);this._place({component:y,position:B,index:z});this._components.push(y);this._componentMap.set(y,{key:A,internal:C})}_find(y){return y?y instanceof w?this._findByComponent(y):"string"===typeof y?this._findById(y):this._findByNode(y.domNode||y):null}_getViewPadding(){return this.view?.padding??r}_attachContainers(y){y.appendChild(this._innerContainer);
y.appendChild(this._manualContainer)}_initContainers(){var y=document.createElement("div");y.classList.add("esri-ui-inner-container","esri-ui-corner-container");const B=document.createElement("div");B.classList.add("esri-ui-inner-container","esri-ui-manual-container");const z=document.createElement("div");z.classList.add("esri-ui-top-left","esri-ui-corner");y.appendChild(z);const A=document.createElement("div");A.classList.add("esri-ui-top-right","esri-ui-corner");y.appendChild(A);const C=document.createElement("div");
C.classList.add("esri-ui-bottom-left","esri-ui-corner");y.appendChild(C);const H=document.createElement("div");H.classList.add("esri-ui-bottom-right","esri-ui-corner");y.appendChild(H);this._innerContainer=y;this._manualContainer=B;y=x.isRTL();this._cornerNameToContainerLookup={"top-left":z,"top-right":A,"bottom-left":C,"bottom-right":H,"top-leading":y?A:z,"top-trailing":y?z:A,"bottom-leading":y?H:C,"bottom-trailing":y?C:H};this._positionNameToContainerLookup={manual:B,...this._cornerNameToContainerLookup}}_isValidPosition(y){return!!this._positionNameToContainerLookup[y]}_place(y){var B=
y.position??"manual";const {component:z,index:A}=y;y=this._positionNameToContainerLookup[B];B=null!=A&&-1<A;var C=z.widget;C&&!C._started&&"function"===typeof C.postMixInProperties&&"function"===typeof C.buildRendering&&"function"===typeof C.postCreate&&"function"===typeof C.startup&&z.widget.startup();B?(B=Array.from(y.children),0===A?({firstChild:B}=y,B?B.parentNode?.insertBefore(z.node,B):y.appendChild(z.node)):A>=B.length?y.appendChild(z.node):(y=B[A],y.parentNode?.insertBefore(z.node,y))):y.appendChild(z.node)}_toPixelPosition(y){return{top:t(y.top),
left:t(y.left),right:t(y.right),bottom:t(y.bottom)}}_findByComponent(y){return this._components.find(B=>B===y)??null}_findById(y){return this._components.find(({id:B})=>B===y)??null}_findByNode(y){return this._components.find(({node:B})=>B===y)??null}_getComponentsAtPosition(y,B){return Array.prototype.slice.call(this._positionNameToContainerLookup[y].children).map(z=>this._findByNode(z)).filter(k.isSome).filter(z=>B.includeInternal||!(this._componentMap.get(z)?.internal??!1)).map(({widget:z,node:A})=>
z??A)}};a.__decorate([g.property()],b.prototype,"_locale",void 0);a.__decorate([g.property()],b.prototype,"container",null);a.__decorate([g.property()],b.prototype,"height",null);a.__decorate([g.property({value:v})],b.prototype,"padding",null);a.__decorate([d.cast("padding")],b.prototype,"castPadding",null);a.__decorate([g.property()],b.prototype,"view",void 0);a.__decorate([g.property()],b.prototype,"width",null);return b=a.__decorate([c.subclass("esri.views.ui.UI")],b)})},"esri/widgets/Attribution":function(){define("../chunks/tslib.es6 ../core/reactiveUtils ../core/accessorSupport/decorators/property ../core/has ../core/Logger ../core/RandomLCG ../core/accessorSupport/decorators/subclass ./Widget ./Attribution/AttributionViewModel ./support/globalCss ./support/decorators/accessibleHandler ./support/decorators/messageBundle ./support/jsxFactory ./support/widgetUtils".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w,x){k=class extends g{constructor(u,t){super(u,t);this._attributionTextOverflowed=this._isOpen=!1;this._prevSourceNodeHeight=0;this._resizeObserver=new ResizeObserver(m=>m.forEach(({target:q})=>this._checkSourceTextOverflow(q)));this.itemDelimiter=" | ";this.messages=null;this.viewModel=new d}initialize(){this.addHandles(b.on(()=>this.viewModel?.items,"change",()=>this.scheduleRender()))}destroy(){this._resizeObserver?.disconnect()}get _isInteractive(){return this._isOpen||
this._attributionTextOverflowed}get attributionText(){return this.viewModel.items.reduce((u,t)=>{u.includes(t.text)||u.push(t.text);return u},[]).join(this.itemDelimiter)}get icon(){return"description"}set icon(u){this._overrideIfSome("icon",u)}get label(){return this.messages?.widgetLabel??""}set label(u){this._overrideIfSome("label",u)}get view(){return this.viewModel.view}set view(u){this.viewModel.view=u}render(){return w.tsx("div",{bind:this,class:this.classes("esri-attribution",f.globalCss.widget,
{["esri-attribution--open"]:this._isOpen}),dir:"ltr",onclick:this._toggleState,onkeydown:this._toggleState},this._renderSourcesNode(),this._renderPoweredBy())}_renderPoweredBy(){return w.tsx("div",{class:"esri-attribution__powered-by"},"Powered by"," ",w.tsx("a",{class:"esri-attribution__link",href:"https://www.esri.com/",rel:"noreferrer",target:"_blank"},"Esri"))}_renderSourcesNode(){const u=this._isOpen,t=this._isInteractive,m=t?0:void 0,{attributionText:q}=this;return w.tsx("div",{afterCreate:this._afterSourcesNodeCreate,
bind:this,class:this.classes("esri-attribution__sources",{["esri-attribution__sources--open"]:u,[f.globalCss.interactive]:t}),innerHTML:q,tabIndex:m})}_afterSourcesNodeCreate(u){this._prevSourceNodeHeight=u.clientWidth;this._resizeObserver.observe(u)}_checkSourceTextOverflow(u){let t=!1;const {clientHeight:m,clientWidth:q,scrollWidth:r}=u;u=r>q;const v=this._attributionTextOverflowed!==u;this._attributionTextOverflowed=u;v&&(t=!0);this._isOpen&&(u=m<this._prevSourceNodeHeight,this._prevSourceNodeHeight=
m,u&&(this._isOpen=!1,t=!0));t&&this.scheduleRender()}_toggleState(){this._isInteractive&&(this._isOpen=!this._isOpen)}};a.__decorate([n.property()],k.prototype,"_isOpen",void 0);a.__decorate([n.property()],k.prototype,"_isInteractive",null);a.__decorate([n.property()],k.prototype,"_attributionTextOverflowed",void 0);a.__decorate([n.property()],k.prototype,"_prevSourceNodeHeight",void 0);a.__decorate([n.property({readOnly:!0,dependsOn:["viewModel.items.length","itemDelimiter"]})],k.prototype,"attributionText",
null);a.__decorate([n.property()],k.prototype,"icon",null);a.__decorate([n.property()],k.prototype,"itemDelimiter",void 0);a.__decorate([n.property()],k.prototype,"label",null);a.__decorate([n.property(),l.messageBundle("esri/widgets/Attribution/t9n/Attribution")],k.prototype,"messages",void 0);a.__decorate([n.property()],k.prototype,"view",null);a.__decorate([n.property({type:d})],k.prototype,"viewModel",void 0);a.__decorate([c.accessibleHandler()],k.prototype,"_toggleState",null);return k=a.__decorate([e.subclass("esri.widgets.Attribution")],
k)})},"esri/widgets/Attribution/AttributionViewModel":function(){define("../../chunks/tslib.es6 ../../core/Accessor ../../core/asyncUtils ../../core/Collection ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/has ../../core/Logger ../../core/RandomLCG ../../core/accessorSupport/decorators/subclass ../../geometry/Extent ../../geometry/SpatialReference ../../geometry/support/contains ../../geometry/support/webMercatorUtils ../../views/3d/layers/Lyr3DWasm".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w,x,u){function t(v,y){return v&&"copyright"in v&&(!y||"function"===typeof v.originOf&&"user"===v.originOf("copyright"))}function m(v,y){return v.length!==y.length||v.some((B,z)=>B.text!==y[z].text)}function q(v,y,B){B&&y&&(v.find(z=>z.layerView===y&&z.text===B)||v.push({text:B,layerView:y}))}const r=[];b=class extends b{constructor(v){super(v);this._clear=()=>{this._fetchedAttributionData.clear();this._pendingAttributions.clear();this.removeHandles("suspension");
this.notifyChange("state")};this._pendingAttributions=new Set;this._fetchedAttributionData=new Map;this.items=new k;this.view=null;this._allLayerViewsChange=y=>{this.removeHandles("suspension");this.removeHandles("visible-geometry-changed");const B=this.view?.allLayerViews;B&&(this.addHandles(B.map(z=>p.watch(()=>[z.suspended,z.layer?.attributionVisible],()=>this._updateAttributionItems())).toArray(),"suspension"),B.forEach(z=>{"esri.views.3d.layers.Tiles3DLayerView3D"===z.declaredClass&&this.addHandles(z.on("visible-geometry-changed",
()=>this._updateAttributionItems()),"visible-geometry-changed")}));y?.removed&&y.removed.forEach(z=>{this._pendingAttributions.delete(z);this._fetchedAttributionData.delete(z)});this._updateAttributionItems()};this.addHandles([p.on(()=>this.view?.allLayerViews,"change",y=>this._allLayerViewsChange(y),{onListenerAdd:()=>this._allLayerViewsChange(),onListenerRemove:this._clear}),p.when(()=>!0===this.view?.stationary,()=>this._updateAttributionItems())])}destroy(){this.view=null;this._fetchedAttributionData.clear();
this._pendingAttributions.clear();this.items.removeAll()}get state(){return this.view?.ready?0<this._pendingAttributions.size?"loading":"ready":"disabled"}_updateAttributionItems(){const v=this.view;var y=v?.allLayerViews;r.length=0;if(v&&y){y.forEach(z=>{if(!z.suspended&&z.layer?.attributionVisible){var A=z.layer;if(t(A,"user"))q(r,z,A.copyright);else if(A.hasAttributionData)if(this._fetchedAttributionData.has(z)){var C=this._fetchedAttributionData.get(z);C?q(r,z,this._getDynamicAttribution(C,v,
A)):t(A)&&q(r,z,A.copyright)}else this._fetchAttributionData(z);else(C="portalItem"in A?A.portalItem?.accessInformation:void 0)?q(r,z,C):q(r,z,A.copyright)}});y=y.find(z=>"integrated-mesh-3dtiles"===z.layer?.type);if(this.view&&y){var B=u.getLyr3DWasm(this.view);if(B){B=B.getAttributionText();for(let z=0;z<B.length;++z)q(r,y,B[z])}}m(this.items,r)&&(this.items.removeAll(),this.items.addMany(r));r.length=0;this.notifyChange("state")}else this._clear()}async _fetchAttributionData(v){if(!this._pendingAttributions.has(v)){this._pendingAttributions.add(v);
var y=await n.result(v.layer.fetchAttributionData());this._pendingAttributions.has(v)&&(y=y.ok?this._createContributionIndex(y.value,"bing-maps"===v.layer.type):null,this._pendingAttributions.delete(v),this._fetchedAttributionData.set(v,y));this._updateAttributionItems()}}_createContributionIndex(v,y){v=v.contributors;const B={};if(!v)return B;for(let H=0;H<v.length;H++){const E=v[H];var z=E.coverageAreas;if(!z)return;for(const F of z){var A=F.bbox,C=F.zoomMin-(y&&F.zoomMin?1:0);z=F.zoomMax-(y&&F.zoomMax?
1:0);A=new c({xmin:A[1],ymin:A[0],xmax:A[3],ymax:A[2],spatialReference:l.WGS84});for(A={extent:x.geographicToWebMercator(A),attribution:E.attribution||"",score:null!=F.score?F.score:100,id:H};C<=z;C++){let G,D;(G=B)[D=C]??(G[D]=[]);B[C].push(A)}}}B.maxKey=Math.max.apply(null,Object.keys(B));return B}_getDynamicAttribution(v,y,B){const {extent:z,scale:A}=y;y=B.tileInfo?.scaleToZoom(A)??0;y=Math.min(v.maxKey??0,Math.round(y));if(!z||null==y||-1>=y)return"";v=v[y];const C=x.project(z.center.clone().normalize(),
l.WebMercator),H=new Set;return v?v.filter(E=>{const F=E.id;(E=!H.has(F)&&C&&E.extent&&w.extentContainsPoint(E.extent,C))&&H.add(F);return E}).sort((E,F)=>F.score-E.score||E.objectId-F.objectId).map(E=>E.attribution).join(", "):""}};a.__decorate([h.property({readOnly:!0,type:k})],b.prototype,"items",void 0);a.__decorate([h.property({readOnly:!0})],b.prototype,"state",null);a.__decorate([h.property()],b.prototype,"view",void 0);return b=a.__decorate([f.subclass("esri.widgets.Attribution.AttributionViewModel")],
b)})},"esri/views/3d/layers/Lyr3DWasm":function(){define(["require","exports"],function(a,b){let n,k=null;const p=new Map;b.addLayerViewToWasm=async function(h){null==k&&(null==n&&(n=new Promise((d,f)=>a(["../../../layers/Lyr3DWasmPerSceneView"],c=>d(Object.freeze(Object.defineProperty({__proto__:null,default:c},Symbol.toStringTag,{value:"Module"}))),f))),k=await n);const e=h.view;let g=p.get(e);g||(g=new k.default({view:e}),p.set(e,g));await g.initializeWasm(!!e._stage.renderView.renderingContext.capabilities.compressedTextureS3TC);
return g.add3DTilesLayerView(h)};b.getLyr3DWasm=function(h){return p.get(h)};b.removeLayerViewFromWasm=function(h){const e=h.view,g=p.get(e);g&&1>g.remove3DTilesLayerView(h)&&(p.delete(e),0===p.size&&(k=n=null))};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/support/globalCss":function(){define(["exports"],function(a){a.globalCss={anchor:"esri-widget__anchor",anchorDisabled:"esri-widget__anchor--disabled",button:"esri-button",buttonDisabled:"esri-button--disabled",
buttonHalf:"esri-button--half",buttonSecondary:"esri-button--secondary",buttonSmall:"esri-button--small",buttonTertiary:"esri-button--tertiary",buttonThird:"esri-button--third",disabled:"esri-disabled",empty:"esri-widget__content--empty",emptyIllustration:"esri-widget__content-illustration--empty",heading:"esri-widget__heading",hidden:"esri-hidden",input:"esri-input",interactive:"esri-interactive",loader:"esri-widget__loader",loaderAnimation:"esri-widget__loader-animation",loaderText:"esri-widget__loader-text",
menu:"esri-menu",menuHeader:"esri-menu__header",menuItem:"esri-menu__list-item",menuItemActive:"esri-menu__list-item--active",menuItemFocus:"esri-menu__list-item--focus",menuList:"esri-menu__list",panel:"esri-widget--panel",panelHeightOnly:"esri-widget--panel-height-only",primaryTick:"primary-tick",primaryTickAmPm:"primary-tick__ampm",primaryTickLabel:"primary-tick__label",rotating:"esri-rotating",secondaryTick:"secondary-tick",select:"esri-select",table:"esri-widget__table",widget:"esri-widget",
widgetButton:"esri-widget--button",widgetButtonActive:"esri-widget--button-active",widgetDisabled:"esri-widget--disabled"};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/Compass":function(){define("require ../chunks/tslib.es6 ../core/accessorSupport/decorators/property ../core/has ../core/Logger ../core/RandomLCG ../core/accessorSupport/decorators/subclass ./Widget ./Compass/CompassViewModel ./Compass/css ../chunks/componentsUtils ./support/globalCss ./support/widgetUtils ./support/decorators/messageBundle ./support/jsxFactory".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w,x,u){k=class extends g{constructor(t,m){super(t,m);this.messages=null;this.viewModel=new d;this._reset=()=>{this.viewModel.reset()};this._toRotationTransform=q=>({transform:`rotateZ(${q.z}deg)`})}loadDependencies(){return c.loadCalciteComponents({button:()=>new Promise((t,m)=>a(["../chunks/calcite-button"],t,m)),icon:()=>new Promise((t,m)=>a(["../chunks/calcite-icon"],t,m))})}get goToOverride(){return this.viewModel.goToOverride}set goToOverride(t){this.viewModel.goToOverride=
t}get icon(){return"rotation"===this.viewModel.state?"arrow-up":"compass-needle"}set icon(t){this._overrideIfSome("icon",t)}get label(){return this.messages?.widgetLabel??""}set label(t){this._overrideIfSome("label",t)}get view(){return this.viewModel.view}set view(t){this.viewModel.view=t}reset(){return this.viewModel.reset()}render(){const {orientation:t,state:m}=this.viewModel,{messages:q}=this;return u.tsx("div",{class:this.classes(f.css.base,l.globalCss.widget)},u.tsx("calcite-button",{class:l.globalCss.widgetButton,
disabled:"disabled"===m,kind:"neutral",label:q.reset,onclick:this._reset,round:!0,scale:"s",title:q.reset},u.tsx("div",{"aria-hidden":"true",class:f.css.iconContainer,title:q.reset},u.tsx("calcite-icon",{icon:this.icon,styles:this._toRotationTransform(t)}))))}};b.__decorate([n.property()],k.prototype,"goToOverride",null);b.__decorate([n.property()],k.prototype,"icon",null);b.__decorate([n.property()],k.prototype,"label",null);b.__decorate([n.property(),x.messageBundle("esri/widgets/Compass/t9n/Compass")],
k.prototype,"messages",void 0);b.__decorate([n.property()],k.prototype,"view",null);b.__decorate([n.property({type:d})],k.prototype,"viewModel",void 0);return k=b.__decorate([e.subclass("esri.widgets.Compass")],k)})},"esri/widgets/Compass/CompassViewModel":function(){define("../../chunks/tslib.es6 ../../core/Accessor ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/has ../../core/Logger ../../core/RandomLCG ../../core/accessorSupport/decorators/subclass ../../views/2d/navigation/duration ./utils ../support/GoTo".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c){b=class extends c.GoToMixin(b){constructor(l){super(l);this.orientation={x:0,y:0,z:0};this.view=null;this._updateForCamera=this._updateForCamera.bind(this);this._updateForRotation=this._updateForRotation.bind(this);this._updateRotationWatcher=this._updateRotationWatcher.bind(this)}initialize(){this.addHandles(n.watch(()=>this.view,this._updateRotationWatcher,n.initial))}destroy(){this.view=null}get canShowNorth(){return f.canShowNorth(this.view)}get state(){return!this.view?.ready||
"2d"===this.view.type&&!this.view.constraints.rotationEnabled?"disabled":this.canShowNorth?"compass":"rotation"}reset(){this.view?.ready&&("2d"===this.view?.type?this.callGoTo({target:{rotation:0},options:{animationMode:"always",duration:d.getGoToDuration()}}):this.callGoTo({target:{heading:0}}))}_updateForRotation(l){null!=l&&this._set("orientation",{z:l})}_updateForCamera(l){l&&this._set("orientation",{x:0,y:0,z:-l.heading})}_updateRotationWatcher(l){this.removeAllHandles();l&&this.addHandles("2d"===
l.type?n.watch(()=>l?.rotation,this._updateForRotation,n.initial):n.watch(()=>l?.camera,this._updateForCamera,n.initial))}};a.__decorate([k.property({readOnly:!0})],b.prototype,"canShowNorth",null);a.__decorate([k.property({readOnly:!0})],b.prototype,"orientation",void 0);a.__decorate([k.property({readOnly:!0})],b.prototype,"state",null);a.__decorate([k.property()],b.prototype,"view",void 0);return b=a.__decorate([g.subclass("esri.widgets.Compass.CompassViewModel")],b)})},"esri/views/2d/navigation/duration":function(){define(["exports",
"../../../core/has","../../../core/time"],function(a,b,n){a.getGoToDuration=function(){const k=b("mapview-essential-goto-duration");return null==k?k:n.Milliseconds(k)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/Compass/utils":function(){define(["exports"],function(a){a.canShowNorth=function(b){return b?.spatialReference?.isWebMercator||b?.spatialReference?.isGeographic||!1};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/support/GoTo":function(){define("exports ../../chunks/tslib.es6 ../../core/maybe ../../core/accessorSupport/decorators/property ../../core/has ../../core/Logger ../../core/RandomLCG ../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,n,k,p,h,e,g){a.GoToMixin=d=>{d=class extends d{constructor(...f){super(...f);this.view=this.goToOverride=null}callGoTo(f){const {view:c}=this;n.assertIsSome(c);return this.goToOverride?this.goToOverride(c,f):c.goTo(f.target,f.options)}};b.__decorate([k.property()],d.prototype,"goToOverride",void 0);b.__decorate([k.property()],d.prototype,"view",void 0);return d=b.__decorate([g.subclass("esri.widgets.support.GoTo")],d)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/Compass/css":function(){define(["exports"],
function(a){a.css={base:"esri-compass",iconContainer:"esri-compass__icon-container"};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/NavigationToggle":function(){define("require ../chunks/tslib.es6 ../core/accessorSupport/decorators/property ../core/has ../core/Logger ../core/RandomLCG ../core/accessorSupport/decorators/subclass ./Widget ./NavigationToggle/css ./NavigationToggle/NavigationToggleViewModel ../chunks/componentsUtils ./support/globalCss ./support/widgetUtils ./support/decorators/messageBundle ./support/jsxFactory".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w,x,u){k=class extends g{constructor(t,m){super(t,m);this.messages=null;this.viewModel=new f;this.toggle=()=>this.viewModel.toggle();this._rotateButton=this._panButton=null;this._toggle=()=>{w.setFocus("pan"===this.viewModel?.navigationMode?this._rotateButton:this._panButton);this.toggle()}}loadDependencies(){return c.loadCalciteComponents({button:()=>new Promise((t,m)=>a(["../chunks/calcite-button"],t,m))})}get icon(){return"move"}set icon(t){this._overrideIfSome("icon",
t)}get label(){return this.messages?.widgetLabel??""}set label(t){this._overrideIfSome("label",t)}set layout(t){"horizontal"!==t&&(t="vertical");this._set("layout",t)}get view(){return this.viewModel.view}set view(t){this.viewModel.view=t}render(){const t="disabled"===this.viewModel?.state,m="pan"===this.viewModel?.navigationMode,q=this.messages.toggle;return u.tsx("div",{class:this.classes(d.css.base,l.globalCss.widget,{[d.css.isLayoutHorizontal]:"horizontal"===this.layout})},u.tsx("calcite-button",
{afterCreate:r=>{this._panButton=r},appearance:m?"outline-fill":"solid",class:l.globalCss.widgetButton,disabled:t,iconStart:"move",kind:"neutral",label:q,onclick:this._toggle,tabIndex:m?void 0:-1,title:q}),u.tsx("calcite-button",{afterCreate:r=>{this._rotateButton=r},appearance:m?"solid":"outline-fill",class:l.globalCss.widgetButton,disabled:t,iconStart:"rotate",kind:"neutral",label:q,onclick:this._toggle,tabIndex:m?-1:void 0,title:q}))}};b.__decorate([n.property()],k.prototype,"icon",null);b.__decorate([n.property()],
k.prototype,"label",null);b.__decorate([n.property({value:"vertical"})],k.prototype,"layout",null);b.__decorate([n.property(),x.messageBundle("esri/widgets/NavigationToggle/t9n/NavigationToggle")],k.prototype,"messages",void 0);b.__decorate([n.property()],k.prototype,"view",null);b.__decorate([n.property({type:f})],k.prototype,"viewModel",void 0);return k=b.__decorate([e.subclass("esri.widgets.NavigationToggle")],k)})},"esri/widgets/NavigationToggle/css":function(){define(["exports"],function(a){a.css=
{base:"esri-navigation-toggle",isLayoutHorizontal:"esri-navigation-toggle--horizontal"};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/NavigationToggle/NavigationToggleViewModel":function(){define("../../chunks/tslib.es6 ../../core/Accessor ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/has ../../core/Logger ../../core/RandomLCG ../../core/accessorSupport/decorators/subclass".split(" "),function(a,b,n,k,p,h,e,g){b=class extends b{constructor(d){super(d);
this._navigationMode="pan";this.view=null}initialize(){this.addHandles(n.when(()=>this.view?.inputManager,()=>this._setNavigationMode()))}destroy(){this.view=null}get state(){return this.view?.ready&&"3d"===this.view?.type?"ready":"disabled"}get navigationMode(){return this._navigationMode}set navigationMode(d){this._navigationMode=d;this._setNavigationMode()}toggle(){"disabled"!==this.state&&(this.navigationMode="pan"!==this.navigationMode?"pan":"rotate")}_setNavigationMode(){const d=this.view?.inputManager;
d&&(d.primaryDragAction="pan"===this._navigationMode?"pan":"rotate")}};a.__decorate([k.property({readOnly:!0})],b.prototype,"state",null);a.__decorate([k.property()],b.prototype,"_navigationMode",void 0);a.__decorate([k.property()],b.prototype,"view",void 0);return b=a.__decorate([g.subclass("esri.widgets.NavigationToggle.NavigationToggleViewModel")],b)})},"esri/widgets/Zoom":function(){define("require ../chunks/tslib.es6 ../core/accessorSupport/decorators/property ../core/has ../core/Logger ../core/RandomLCG ../core/accessorSupport/decorators/subclass ./Widget ../chunks/componentsUtils ./support/globalCss ./support/widgetUtils ./support/decorators/messageBundle ./support/jsxFactory ./Zoom/ZoomViewModel".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w,x){k=class extends g{constructor(u,t){super(u,t);this.messages=null;this.viewModel=new x;this.zoomIn=()=>this.viewModel.zoomIn();this.zoomOut=()=>this.viewModel.zoomOut()}loadDependencies(){return d.loadCalciteComponents({button:()=>new Promise((u,t)=>a(["../chunks/calcite-button"],u,t))})}get icon(){return"magnifying-glass-plus"}set icon(u){this._overrideIfSome("icon",u)}get label(){return this.messages?.widgetLabel??""}set label(u){this._overrideIfSome("label",
u)}set layout(u){"horizontal"!==u&&(u="vertical");this._set("layout",u)}set view(u){this.viewModel.view=u}get view(){return this.viewModel.view}render(){const u={["esri-zoom--horizontal"]:"horizontal"===this.layout},{canZoomIn:t,canZoomOut:m}=this.viewModel,{zoomIn:q,zoomOut:r}=this.messages;return w.tsx("div",{class:this.classes("esri-zoom",f.globalCss.widget,u)},w.tsx("calcite-button",{class:f.globalCss.widgetButton,disabled:!t,iconStart:"plus",kind:"neutral",label:q,onclick:this.zoomIn,title:q}),
w.tsx("calcite-button",{class:f.globalCss.widgetButton,disabled:!m,iconStart:"minus",kind:"neutral",label:r,onclick:this.zoomOut,title:r}))}};b.__decorate([n.property()],k.prototype,"icon",null);b.__decorate([n.property()],k.prototype,"label",null);b.__decorate([n.property({value:"vertical"})],k.prototype,"layout",null);b.__decorate([n.property(),l.messageBundle("esri/widgets/Zoom/t9n/Zoom")],k.prototype,"messages",void 0);b.__decorate([n.property()],k.prototype,"view",null);b.__decorate([n.property({type:x})],
k.prototype,"viewModel",void 0);return k=b.__decorate([e.subclass("esri.widgets.Zoom")],k)})},"esri/widgets/Zoom/ZoomViewModel":function(){define("../../chunks/tslib.es6 ../../core/Accessor ../../core/promiseUtils ../../core/accessorSupport/decorators/property ../../core/has ../../core/Logger ../../core/RandomLCG ../../core/accessorSupport/decorators/subclass ./ZoomConditions2D ./ZoomConditions3D".split(" "),function(a,b,n,k,p,h,e,g,d,f){b=class extends b{constructor(c){super(c)}destroy(){this.view=
null}get canZoomIn(){return null!=this._zoomConditions&&this._zoomConditions.canZoomIn}get canZoomOut(){return null!=this._zoomConditions&&this._zoomConditions?.canZoomOut}get state(){return this.view?.ready?"ready":"disabled"}set view(c){c?"2d"===c.type?this._zoomConditions=new d({view:c}):"3d"===c.type&&(this._zoomConditions=new f({view:c})):this._zoomConditions=null;this._set("view",c)}zoomIn(){if(this.canZoomIn){var c=this.view;"2d"===c.type?c.mapViewNavigation.zoomIn():n.ignoreAbortErrors(c.goTo({zoomFactor:2}))}}zoomOut(){if(this.canZoomOut){var c=
this.view;"2d"===c.type?c.mapViewNavigation.zoomOut():n.ignoreAbortErrors(c.goTo({zoomFactor:.5}))}}};a.__decorate([k.property()],b.prototype,"_zoomConditions",void 0);a.__decorate([k.property()],b.prototype,"canZoomIn",null);a.__decorate([k.property()],b.prototype,"canZoomOut",null);a.__decorate([k.property({readOnly:!0})],b.prototype,"state",null);a.__decorate([k.property()],b.prototype,"view",null);return b=a.__decorate([g.subclass("esri.widgets.Zoom.ZoomViewModel")],b)})},"esri/widgets/Zoom/ZoomConditions2D":function(){define("../../chunks/tslib.es6 ../../core/Accessor ../../core/accessorSupport/decorators/property ../../core/has ../../core/Logger ../../core/RandomLCG ../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,n,k,p,h,e){b=class extends b{get canZoomIn(){if(!this.view?.ready)return!1;const g=this.view?.constraints?.effectiveMaxScale;return 0===g||this._scale>g}get canZoomOut(){var {view:g}=this;if(!g?.ready)return!1;g=g.constraints?.effectiveMinScale;return 0===g||this._scale<g}get _scale(){const g=this.view?.animation?.target;return(g&&"then"in g?void 0:g?.scale)??this.view?.scale??0}};a.__decorate([n.property({readOnly:!0})],b.prototype,"canZoomIn",null);a.__decorate([n.property({readOnly:!0})],
b.prototype,"canZoomOut",null);a.__decorate([n.property()],b.prototype,"view",void 0);a.__decorate([n.property()],b.prototype,"_scale",null);return b=a.__decorate([e.subclass("esri.widgets.Zoom.ZoomConditions2D")],b)})},"esri/widgets/Zoom/ZoomConditions3D":function(){define("../../chunks/tslib.es6 ../../core/Accessor ../../core/accessorSupport/decorators/property ../../core/has ../../core/Logger ../../core/RandomLCG ../../core/accessorSupport/decorators/subclass".split(" "),function(a,b,n,k,p,h,e){b=
class extends b{get canZoomIn(){return!!this.view.ready}get canZoomOut(){return!!this.view.ready}};a.__decorate([n.property({readOnly:!0})],b.prototype,"canZoomIn",null);a.__decorate([n.property({readOnly:!0})],b.prototype,"canZoomOut",null);a.__decorate([n.property()],b.prototype,"view",void 0);return b=a.__decorate([e.subclass("esri.widgets.Zoom.ZoomConditions3D")],b)})},"esri/views/ui/3d/DefaultUI3D":function(){define("../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ../DefaultUI".split(" "),
function(a,b,n,k,p,h,e){n=class extends e{constructor(g){super(g);this.components=["attribution","zoom","navigation-toggle","compass"]}};a.__decorate([b.property()],n.prototype,"components",void 0);return n=a.__decorate([h.subclass("esri.views.ui.3d.DefaultUI3D")],n)})},"esri/layers/SceneLayer":function(){define("require ../chunks/tslib.es6 ../Graphic ../PopupTemplate ../renderers/ClassBreaksRenderer ../renderers/DictionaryRenderer ../renderers/DotDensityRenderer ../renderers/HeatmapRenderer ../renderers/PieChartRenderer ../renderers/Renderer ../renderers/SimpleRenderer ../renderers/UniqueValueRenderer ../renderers/support/jsonUtils ../renderers/support/types ../core/Clonable ../core/Collection ../core/Error ../core/Logger ../core/maybe ../core/MultiOriginJSONSupport ../core/promiseUtils ../core/reactiveUtils ../core/accessorSupport/decorators/property ../core/has ../core/RandomLCG ../core/accessorSupport/utils ../core/accessorSupport/decorators/reader ../core/accessorSupport/decorators/subclass ../core/accessorSupport/PropertyOrigin ../geometry/Mesh ../geometry/Point ./Layer ./graphics/sources/support/uploadAssetErrors ./mixins/APIKeyMixin ./mixins/ArcGISService ./mixins/CustomParametersMixin ./mixins/EditBusLayer ./mixins/OperationalLayer ./mixins/PortalLayer ./mixins/ScaleRangeLayer ./mixins/SceneService ./mixins/TemporalLayer ./mixins/TemporalSceneLayer ./support/arcgisLayerUrl ./support/associatedFeatureServiceUtils ./support/capabilities ./support/commonProperties ./support/featureLayerUtils ./support/FeatureReduction ./support/FeatureReductionSelection ./support/fieldProperties ./support/FieldsIndex ./support/fieldUtils ./support/I3SLayerDefinitions ./support/infoFor3D ./support/LabelClass ./support/labelingInfo ./support/LayerFloorInfo ./support/lazyLayerLoader ./support/meshSpatialReferenceScaleUtils ./support/RangeInfo ./support/SceneFilter ./support/sceneLayerCacheUtils ./support/sceneLayerStatistics ../renderers/support/styleUtils ../rest/support/Query ../support/elevationInfoUtils ../support/popupUtils ../support/zipUtils ../views/3d/layers/i3s/I3SUtil ../views/layers/support/popupUtils ../webdoc/support/opacityUtils".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w,x,u,t,m,q,r,v,y,B,z,A,C,H,E,F,G,D,I,J,N,M,Q,O,K,L,P,R,W,V,ba,U,da,fa,ha,T,S,Z,ia,Y,ea,ka,ja,X,aa,pa,la,na,qa,sa,xa,ta,Ba,Ia,Ca,Ha,Ga,Aa,Ja,Sa){const $a=new Set(["3DObject","Point"]);p=ia.defineFieldProperties();u=class extends ba.TemporalSceneLayer(K.EditBusLayer(W.SceneService(Q.ArcGISService(L.OperationalLayer(P.PortalLayer(R.ScaleRangeLayer(v.MultiOriginJSONMixin(O.CustomParametersMixin(M.APIKeyMixin(u.ClonableMixin(J))))))))))){constructor(...Da){super(...Da);
this.rangeInfos=this.featureReduction=null;this.operationalLayerType="ArcGISSceneServiceLayer";this.type="scene";this.serviceUpdateTimeStamp=this.geometryDefinitions=this.textureSetDefinitions=this.materialDefinitions=this.nodePages=this.outFields=this.floorInfo=this.fields=null;this.excludeObjectIds=new t;this.path=this.filter=this.definitionExpression=null;this.labelsVisible=!0;this.labelingInfo=null;this.legendEnabled=!0;this.semantic=this.priority=null;this.cachedDrawingInfo={color:!1};this.popupEnabled=
!0;this.globalIdField=this.objectIdField=this.popupTemplate=null;this._fieldUsageInfo={};this.screenSizePerspectiveEnabled=!0;this.serviceItemId=void 0}normalizeCtorArgs(Da,La){return"string"===typeof Da?{url:Da,...La}:Da}destroy(){this._set("renderer",null);this.associatedLayer=r.destroyMaybe(this.associatedLayer)}getField(Da){return this.fieldsIndex.get(Da)}getFieldDomain(Da,La){return(La=this.getFeatureType(La?.feature)?.domains?.[Da])&&"inherited"!==La.type?La:this.getField(Da)?.domain??null}getFeatureType(Da){return Da&&
this.associatedLayer?this.associatedLayer.getFeatureType(Da):null}get types(){return this.associatedLayer?.types??[]}get typeIdField(){return this.associatedLayer?.typeIdField??null}get templates(){return this.associatedLayer?.templates??null}get formTemplate(){return this.associatedLayer?.formTemplate??null}get attributeTableTemplate(){return this.associatedLayer?.attributeTableTemplate??null}get fieldsIndex(){return new Y(this.fields)}readNodePages(Da,La,Va){"Point"===La.layerType&&(Da=La.pointNodePages);
return null==Da||"object"!==typeof Da?null:ka.I3SNodePageDefinition.fromJSON(Da,Va)}set elevationInfo(Da){this._set("elevationInfo",Da);this.loaded&&this._validateElevationInfo()}get effectiveCapabilities(){return this._capabilitiesFromAssociatedFeatureLayer(this.associatedLayer?.effectiveCapabilities)}get effectiveEditingEnabled(){return null!=this.associatedLayer&&T.computeEffectiveEditingEnabled(this.associatedLayer)}get geometryType(){return Ta[this.profile]||"mesh"}set renderer(Da){ea.fixRendererFields(Da,
this.fieldsIndex);this._set("renderer",Da)}readCachedDrawingInfo(Da){if(null==Da||"object"!==typeof Da)Da={};null==Da.color&&(Da.color=!1);return Da}get capabilities(){return this._capabilitiesFromAssociatedFeatureLayer(this.associatedLayer?.capabilities)}_capabilitiesFromAssociatedFeatureLayer(Da){Da=null!=Da?Da:fa.zeroCapabilities;const {query:La,queryRelated:Va,editing:{supportsGlobalId:ma,supportsRollbackOnFailure:za,supportsUploadWithItemId:Na,supportsGeometryUpdate:Ra,supportsReturnServiceEditsInSourceSpatialReference:Pa},
data:{supportsZ:ca,supportsM:cb,isVersioned:ib,supportsAttachment:nb},operations:{supportsEditing:xb,supportsAdd:ya,supportsUpdate:Ea,supportsDelete:Qa,supportsQuery:db,supportsQueryAttachments:lb,supportsAsyncConvert3D:ub}}=Da;Da=Da.operations.supportsChangeTracking;const Oa=!!this.associatedLayer?.infoFor3D;return{query:La,queryRelated:Va,editing:{supportsGlobalId:ma,supportsReturnServiceEditsInSourceSpatialReference:Pa,supportsRollbackOnFailure:za,supportsGeometryUpdate:Oa&&Ra,supportsUploadWithItemId:Na},
data:{supportsAttachment:nb,supportsZ:ca,supportsM:cb,isVersioned:ib},operations:{supportsQuery:db,supportsQueryAttachments:lb,supportsEditing:xb&&Da,supportsAdd:Oa&&ya&&Da,supportsDelete:Oa&&Qa&&Da,supportsUpdate:Ea&&Da,supportsAsyncConvert3D:ub}}}get editingEnabled(){return this._isOverridden("editingEnabled")?this._get("editingEnabled"):this.associatedLayer?.editingEnabled??!1}set editingEnabled(Da){this._overrideIfSome("editingEnabled",Da)}get infoFor3D(){return this.associatedLayer?.infoFor3D??
null}get relationships(){return this.associatedLayer?.relationships}get defaultPopupTemplate(){return this.associatedLayer||this.attributeStorageInfo?this.createPopupTemplate():null}readObjectIdField(Da,La){!Da&&La.fields&&La.fields.some(Va=>{"esriFieldTypeOID"===Va.type&&(Da=Va.name);return!!Da});return Da||void 0}readGlobalIdField(Da,La){!Da&&La.fields&&La.fields.some(Va=>{"esriFieldTypeGlobalID"===Va.type&&(Da=Va.name);return!!Da});return Da||void 0}get displayField(){return this.associatedLayer?.displayField??
null}readProfile(Da,La){Da=La.store.profile;if(null!=Da&&Wa[Da])return Wa[Da];q.getLogger(this).error("Unknown or missing profile",{profile:Da,layer:this});return"mesh-pyramids"}get useViewTime(){return this.associatedLayer?.useViewTime??!0}set useViewTime(Da){this._override("useViewTime",Da)}load(Da){this.addResolvingPromise(this._load(Da));return Promise.resolve(this)}async _load(Da){const La=null!=Da?Da.signal:null;await this.loadFromPortal({supportedTypes:["Scene Service"]},Da).catch(y.throwIfAbortError);
await this._fetchService(La);await Promise.all([this._fetchIndexAndUpdateExtent(this.nodePages,La),this._setAssociatedFeatureLayer(La),this._loadFilterGeometries()]);this._validateElevationInfo();this._applyAssociatedLayerOverrides();this._populateFieldUsageInfo();await this.loadTimeInfoFromService(Da);await Ba.loadStyleRenderer(this,{origin:"service"},La);ea.fixRendererFields(this.renderer,this.fieldsIndex);await this.finishLoadEditablePortalLayer(Da)}async beforeSave(){null!=this.filter&&(this.filter=
this.filter.clone(),await this.load())}async _loadFilterGeometries(){if(this.filter)try{await this.filter.loadGeometries(this.spatialReference)}catch(Da){q.getLogger(this).error("#_loadFilterGeometries()",this,"Failed to load filter geometries. Geometry filter will not be applied for this layer.",{error:Da}),this.filter=null}}createQuery(){const Da=new Ia;"mesh"===this.geometryType?this.associatedLayer?.infoFor3D&&(Da.returnGeometry=!0):(Da.returnGeometry=!0,Da.returnZ=!0);Da.where=this.definitionExpression||
"1\x3d1";Da.sqlFormat="standard";Da.outFields=["*"];return Da}queryExtent(Da,La){return this._getAssociatedLayerForQuery().then(Va=>Va.queryExtent(Da||this.createQuery(),La))}queryFeatureCount(Da,La){return this._getAssociatedLayerForQuery().then(Va=>Va.queryFeatureCount(Da||this.createQuery(),La))}queryFeatures(Da,La){return this._getAssociatedLayerForQuery().then(Va=>Va.queryFeatures(Da||this.createQuery(),La)).then(Va=>{if(Va?.features)for(const ma of Va.features)ma.layer=this,ma.sourceLayer=this;
return Va})}async queryRelatedFeatures(Da,La){await this.load();if(!this.associatedLayer)throw new m("scenelayer:query-not-available","SceneLayer queries are not available without an associated feature layer",{layer:this});return this.associatedLayer.queryRelatedFeatures(Da,La)}async queryRelatedFeaturesCount(Da,La){await this.load();if(!this.associatedLayer)throw new m("scenelayer:query-not-available","SceneLayer queries are not available without an associated feature layer",{layer:this});return this.associatedLayer.queryRelatedFeaturesCount(Da,
La)}async queryCachedAttributes(Da,La){const Va=ea.unpackFieldNames(this.fieldsIndex,await Ja.getRequiredFields(this,Ja.getFetchPopupTemplate(this)));return Aa.queryAttributesFromCachedAttributesId(this.parsedUrl?.path??"",this.attributeStorageInfo??[],Da,La,Va,this.apiKey,this.customParameters)}async queryCachedFeature(Da,La){Da=await this.queryCachedAttributes(Da,[La]);if(!Da||0===Da.length)throw new m("scenelayer:feature-not-in-cached-data","Feature not found in cached data");La=new n;La.attributes=
Da[0];La.layer=this;La.sourceLayer=this;return La}queryObjectIds(Da,La){return this._getAssociatedLayerForQuery().then(Va=>Va.queryObjectIds(Da||this.createQuery(),La))}queryAttachments(Da,La){return this._getAssociatedLayerForQuery().then(Va=>Va.queryAttachments(Da,La))}getFieldUsageInfo(Da){const La={supportsLabelingInfo:!1,supportsRenderer:!1,supportsPopupTemplate:!1,supportsLayerQuery:!1};return this.loaded?this._fieldUsageInfo[Da]||La:(q.getLogger(this).error("#getFieldUsageInfo()","Unavailable until layer is loaded"),
La)}createPopupTemplate(Da){return Ha.createPopupTemplate(this,Da)}_getAssociatedLayerForQuery(){const Da=this.associatedLayer;return Da?.loaded?Promise.resolve(Da):this._loadAssociatedLayerForQuery()}async _loadAssociatedLayerForQuery(){await this.load();if(!this.associatedLayer)throw new m("scenelayer:query-not-available","SceneLayer queries are not available without an associated feature layer",{layer:this});try{await this.associatedLayer.load()}catch(Da){throw new m("scenelayer:query-not-available",
"SceneLayer associated feature layer could not be loaded",{layer:this,error:Da});}return this.associatedLayer}hasCachedStatistics(Da){return null!=this.statisticsInfo&&this.statisticsInfo.some(La=>La.name===Da)}async queryCachedStatistics(Da,La){await this.load(La);return await this.fetchStatistics(Da,La)}async saveAs(Da,La){return this._debouncedSaveOperations(W.SaveOperationType.SAVE_AS,{...La,getTypeKeywords:()=>this._getTypeKeywords(),portalItemLayerType:"scene"},Da)}async save(){return this._debouncedSaveOperations(W.SaveOperationType.SAVE,
{getTypeKeywords:()=>this._getTypeKeywords(),portalItemLayerType:"scene"})}async applyEdits(Da,La){const {applyEdits:Va}=await new Promise((Pa,ca)=>a(["./graphics/editingSupport"],Pa,ca));await this.load();const ma=this.associatedLayer;if(!ma)throw new m(`${this.type}-layer:not-editable`,"Service is not editable");await ma.load();const {globalIdField:za}=ma,Na=!!ma.infoFor3D,Ra=La?.globalIdUsed??!0;if(Na&&null==za)throw new m(`${this.type}-layer:not-editable`,"Valid globalIdField expected on editable SceneLayer");
if(Na&&!Ra)throw new m(`${this.type}-layer:globalid-required`,"globalIdUsed must not be false for SceneLayer editing as globalIds are required.");U.isHostedAgolService(ma.url)&&Na&&null!=Da.deleteFeatures&&null!=za&&(La={...La,globalIdToObjectId:await T.getGlobalIdToObjectIdMap(ma,Da.deleteFeatures,za)});return Va(this,ma.source,Da,La)}async uploadAssets(Da,La){await this.load();if(null==this.associatedLayer)throw new m(`${this.type}-layer:not-editable`,"Service is not editable");await this.associatedLayer.load();
return this.associatedLayer.uploadAssets(Da,La)}on(Da,La){return super.on(Da,La)}async convertMesh(Da,La){La??={};var Va=za=>{q.getLogger(this).error(".convertMesh()",za.message);throw za;};await this.load();this.infoFor3D||Va(new m("invalid:layer","SceneLayer has no capability for mesh conversion"));Da=await this.extractAndFilterFiles(Da);const ma=Da.reduce((za,Na)=>ja.isFileEditFormat(this.infoFor3D,Na)?za+1:za,0);0===ma&&Va(new N.NoModelError);1<ma&&Va(new N.MultipleModelsError);Va=this.spatialReference;
Va=La.location??new I({x:0,y:0,z:0,spatialReference:Va});Da=D.createWithExternalSource(Va,Da,{vertexSpace:Va.spatialReference.isGeographic?"local":"georeferenced",transform:na.getMeshTransformForMetersToSpatialReference(Va.spatialReference),unitConversionDisabled:!0});[La]=await this.uploadAssets([Da],{...La,useAssetOrigin:!La.location});return La}async extractAndFilterFiles(Da){await this.load();const La=this.infoFor3D;return La?(await Ga.extractZipFiles(Da)).filter(Va=>ja.isFileSupported(La,Va)):
Da}validateLayer(Da){if(Da.layerType&&!$a.has(Da.layerType))throw new m("scenelayer:layer-type-not-supported","SceneLayer does not support this layer type",{layerType:Da.layerType});if(isNaN(this.version.major)||isNaN(this.version.minor))throw new m("layer:service-version-not-supported","Service version is not supported.",{serviceVersion:this.version.versionString,supportedVersions:"1.x, 2.x"});if(2<this.version.major)throw new m("layer:service-version-too-new","Service version is too new.",{serviceVersion:this.version.versionString,
supportedVersions:"1.x, 2.x"});Da=this.normalReferenceFrame;var La=this.spatialReference;let Va=!1,ma=!1;if(null==Da)ma=Va=!0;else switch(La=La&&La.isGeographic,Da){case "east-north-up":case "earth-centered":Va=!0;ma=La;break;case "vertex-reference-frame":Va=!0;ma=!La;break;default:Va=!1}if(!Va)throw new m("scenelayer:unsupported-normal-reference-frame","Normal reference frame is invalid.");if(!ma)throw new m("scenelayer:incompatible-normal-reference-frame","Normal reference frame is incompatible with layer spatial reference.");
}_getTypeKeywords(){const Da=[];if("points"===this.profile)Da.push("Point");else if("mesh-pyramids"===this.profile)Da.push("3DObject");else throw new m("scenelayer:unknown-profile","SceneLayer:save() encountered an unknown SceneLayer profile: "+this.profile);return Da}_populateFieldUsageInfo(){this._fieldUsageInfo={};if(this.fields)for(const Da of this.fields){const La=!!this.attributeStorageInfo?.some(ma=>ma.name===Da.name),Va=!!this.associatedLayer?.fields?.some(ma=>ma&&Da.name===ma.name);this._fieldUsageInfo[Da.name]=
{supportsLabelingInfo:La,supportsRenderer:La,supportsPopupTemplate:La||Va,supportsLayerQuery:Va}}}_applyAssociatedLayerOverrides(){this._applyAssociatedLayerFieldsOverrides();this._applyAssociatedLayerPopupOverrides();this._applyAssociatedLayerExtentOverride();this._applyAssociatedLayerPrivileges()}_applyAssociatedLayerFieldsOverrides(){if(this.associatedLayer?.fields){var Da=null;for(const La of this.associatedLayer.fields){const Va=this.getField(La.name);Va?(!Va.domain&&La.domain&&(Va.domain=La.domain.clone()),
Va.editable=La.editable,Va.nullable=La.nullable,Va.length=La.length):(Da||=this.fields?this.fields.slice():[],Da.push(La.clone()))}Da&&this._set("fields",Da)}}_applyAssociatedLayerPopupOverrides(){if(this.associatedLayer){var Da=["popupTemplate","popupEnabled"],La=H.getProperties(this);for(let Va=0;Va<Da.length;Va++){const ma=Da[Va],za=this.originIdOf(ma),Na=this.associatedLayer.originIdOf(ma);za<Na&&(Na===G.OriginId.SERVICE||Na===G.OriginId.PORTAL_ITEM)&&La.setAtOrigin(ma,this.associatedLayer[ma],
Na)}}}_applyAssociatedLayerExtentOverride(){const Da=this.associatedLayer?.getAtOrigin("fullExtent","service");null!=this.associatedLayer?.infoFor3D&&Da&&U.isHostedAgolService(this.associatedLayer?.url)&&xa.cacheIsOutOfSync(this)&&H.getProperties(this).setAtOrigin("fullExtent",Da.clone(),G.OriginId.SERVICE)}_applyAssociatedLayerPrivileges(){const Da=this.associatedLayer;Da&&(this._set("userHasEditingPrivileges",Da.userHasEditingPrivileges),this._set("userHasFullEditingPrivileges",Da.userHasFullEditingPrivileges),
this._set("userHasUpdateItemPrivileges",Da.userHasUpdateItemPrivileges))}async _setAssociatedFeatureLayer(Da){if(["mesh-pyramids","points"].includes(this.profile))try{const {serverUrl:La,layerId:Va,portalItem:ma}=await da.findAssociatedFeatureService(`${this.url}/layers/${this.layerId}`,{sceneLayerItem:this.portalItem,customParameters:this.customParameters,apiKey:this.apiKey,signal:Da});this.associatedLayer=new (await la.layerLookupMap.FeatureLayer())({url:La,customParameters:this.customParameters,
layerId:Va,portalItem:ma});await this.associatedLayer.load()}catch(La){y.isAbortError(La)||this._logWarningOnPopupEnabled()}}async _logWarningOnPopupEnabled(){await B.whenOnce(()=>this.popupEnabled&&null!=this.popupTemplate);const Da=`this SceneLayer: ${this.title}`;null==this.attributeStorageInfo?q.getLogger(this).warn(`Associated FeatureLayer could not be loaded and no binary attributes found. Popups will not work on ${Da}`):q.getLogger(this).info(`Associated FeatureLayer could not be loaded. Falling back to binary attributes for Popups on ${Da}`)}_validateElevationInfo(){const Da=
this.elevationInfo;"mesh-pyramids"===this.profile&&Ca.logInvalidElevationInfoWarning(q.getLogger(this),Ca.elevationModeUnsupportedMessage("Mesh scene layers","relative-to-scene",Da));Ca.logInvalidElevationInfoWarning(q.getLogger(this),Ca.featureExpressionUnsupportedMessage("Scene layers",Da))}async fetchStatistics(Da,La){return await ta.fetchStatistics({fieldName:Da,statisticsInfo:this.statisticsInfo,errorContext:"scenelayer",fieldsIndex:this.fieldsIndex,path:this.parsedUrl?.path??"",customParameters:this.customParameters,
apiKey:this.apiKey,signal:La?.signal})}};b.__decorate([z.property({types:{key:"type",base:S.FeatureReduction,typeMap:{selection:Z}},json:{origins:{"web-scene":{name:"layerDefinition.featureReduction",write:!0},"portal-item":{name:"layerDefinition.featureReduction",write:!0}}}})],u.prototype,"featureReduction",void 0);b.__decorate([z.property({type:[qa.RangeInfo],json:{read:!1,origins:{"web-scene":{name:"layerDefinition.rangeInfos",write:!0},"portal-item":{name:"layerDefinition.rangeInfos",write:!0}}}})],
u.prototype,"rangeInfos",void 0);b.__decorate([z.property({json:{read:!1}})],u.prototype,"associatedLayer",void 0);b.__decorate([z.property({type:["show","hide"]})],u.prototype,"listMode",void 0);b.__decorate([z.property({type:["ArcGISSceneServiceLayer"]})],u.prototype,"operationalLayerType",void 0);b.__decorate([z.property({json:{read:!1},readOnly:!0})],u.prototype,"type",void 0);b.__decorate([z.property({...p.fields,readOnly:!0,json:{read:!1,origins:{service:{read:!0}}}})],u.prototype,"fields",
void 0);b.__decorate([z.property()],u.prototype,"types",null);b.__decorate([z.property()],u.prototype,"typeIdField",null);b.__decorate([z.property()],u.prototype,"templates",null);b.__decorate([z.property()],u.prototype,"formTemplate",null);b.__decorate([z.property()],u.prototype,"attributeTableTemplate",null);b.__decorate([z.property({readOnly:!0,clonable:!1})],u.prototype,"fieldsIndex",null);b.__decorate([z.property({type:pa,json:{read:{source:"layerDefinition.floorInfo"},write:{target:"layerDefinition.floorInfo"}}})],
u.prototype,"floorInfo",void 0);b.__decorate([z.property(p.outFields)],u.prototype,"outFields",void 0);b.__decorate([z.property({type:ka.I3SNodePageDefinition,readOnly:!0,json:{read:!1}})],u.prototype,"nodePages",void 0);b.__decorate([E.reader("service","nodePages",["nodePages","pointNodePages"])],u.prototype,"readNodePages",null);b.__decorate([z.property({type:[ka.I3SMaterialDefinition],readOnly:!0})],u.prototype,"materialDefinitions",void 0);b.__decorate([z.property({type:[ka.I3STextureSetDefinition],
readOnly:!0})],u.prototype,"textureSetDefinitions",void 0);b.__decorate([z.property({type:[ka.I3SGeometryDefinition],readOnly:!0})],u.prototype,"geometryDefinitions",void 0);b.__decorate([z.property({readOnly:!0})],u.prototype,"serviceUpdateTimeStamp",void 0);b.__decorate([z.property({readOnly:!0})],u.prototype,"attributeStorageInfo",void 0);b.__decorate([z.property({readOnly:!0})],u.prototype,"statisticsInfo",void 0);b.__decorate([z.property({type:t.ofType(Number),nonNullable:!0,json:{origins:{service:{read:!1,
write:!1}},name:"layerDefinition.excludeObjectIds",write:{enabled:!0}}})],u.prototype,"excludeObjectIds",void 0);b.__decorate([z.property({type:String,json:{origins:{service:{read:!1,write:!1}},name:"layerDefinition.definitionExpression",write:{enabled:!0,allowNull:!0}}})],u.prototype,"definitionExpression",void 0);b.__decorate([z.property({type:sa,json:{name:"layerDefinition.polygonFilter",write:{enabled:!0,allowNull:!0},origins:{service:{read:!1,write:!1}}}})],u.prototype,"filter",void 0);b.__decorate([z.property({type:String,
json:{origins:{"web-scene":{read:!0,write:!0}},read:!1}})],u.prototype,"path",void 0);b.__decorate([z.property(ha.elevationInfo)],u.prototype,"elevationInfo",null);b.__decorate([z.property({readOnly:!0,json:{read:!1}})],u.prototype,"effectiveCapabilities",null);b.__decorate([z.property({readOnly:!0})],u.prototype,"effectiveEditingEnabled",null);b.__decorate([z.property({type:String})],u.prototype,"geometryType",null);b.__decorate([z.property(ha.labelsVisible)],u.prototype,"labelsVisible",void 0);
b.__decorate([z.property({type:[X],json:{origins:{service:{name:"drawingInfo.labelingInfo",read:{reader:aa.reader},write:!1}},name:"layerDefinition.drawingInfo.labelingInfo",read:{reader:aa.reader},write:!0}})],u.prototype,"labelingInfo",void 0);b.__decorate([z.property(ha.legendEnabled)],u.prototype,"legendEnabled",void 0);b.__decorate([z.property({type:Number,json:{origins:{"web-document":{default:1,write:{enabled:!0,target:{opacity:{type:Number},"layerDefinition.drawingInfo.transparency":{type:Number}}},
read:{source:["opacity","layerDefinition.drawingInfo.transparency"],reader(Da,La){if("number"===typeof Da&&0<=Da&&1>=Da)return Da;Da=La.layerDefinition?.drawingInfo?.transparency;return void 0!==Da?Sa.transparencyToOpacity(Da):void 0}}},"portal-item":{write:!0},service:{read:!1}}}})],u.prototype,"opacity",void 0);b.__decorate([z.property({type:["Low","High"],readOnly:!0,json:{read:!1,origins:{service:{read:!0}}}})],u.prototype,"priority",void 0);b.__decorate([z.property({type:["Labels"],readOnly:!0,
json:{read:!1,origins:{service:{read:!0}}}})],u.prototype,"semantic",void 0);b.__decorate([z.property({types:x.webSceneRendererTypes,json:{origins:{service:{read:{source:"drawingInfo.renderer"}}},name:"layerDefinition.drawingInfo.renderer",write:!0},value:null})],u.prototype,"renderer",null);b.__decorate([z.property({json:{read:!1}})],u.prototype,"cachedDrawingInfo",void 0);b.__decorate([E.reader("service","cachedDrawingInfo")],u.prototype,"readCachedDrawingInfo",null);b.__decorate([z.property({readOnly:!0,
json:{read:!1}})],u.prototype,"capabilities",null);b.__decorate([z.property({type:Boolean,json:{read:!1}})],u.prototype,"editingEnabled",null);b.__decorate([z.property({readOnly:!0,json:{write:!1,read:!1}})],u.prototype,"infoFor3D",null);b.__decorate([z.property({readOnly:!0,json:{write:!1,read:!1}})],u.prototype,"relationships",null);b.__decorate([z.property(ha.popupEnabled)],u.prototype,"popupEnabled",void 0);b.__decorate([z.property({type:k,json:{name:"popupInfo",write:!0}})],u.prototype,"popupTemplate",
void 0);b.__decorate([z.property({readOnly:!0,json:{read:!1}})],u.prototype,"defaultPopupTemplate",null);b.__decorate([z.property({type:String,json:{read:!1}})],u.prototype,"objectIdField",void 0);b.__decorate([E.reader("service","objectIdField",["objectIdField","fields"])],u.prototype,"readObjectIdField",null);b.__decorate([z.property({type:String,json:{read:!1}})],u.prototype,"globalIdField",void 0);b.__decorate([E.reader("service","globalIdField",["globalIdField","fields"])],u.prototype,"readGlobalIdField",
null);b.__decorate([z.property({readOnly:!0,type:String,json:{read:!1}})],u.prototype,"displayField",null);b.__decorate([z.property({type:String,json:{read:!1}})],u.prototype,"profile",void 0);b.__decorate([E.reader("service","profile",["store.profile"])],u.prototype,"readProfile",null);b.__decorate([z.property({readOnly:!0,type:String,json:{origins:{service:{read:{source:"store.normalReferenceFrame"}}},read:!1}})],u.prototype,"normalReferenceFrame",void 0);b.__decorate([z.property(ha.screenSizePerspectiveEnabled)],
u.prototype,"screenSizePerspectiveEnabled",void 0);b.__decorate([z.property({json:{read:!1,origins:{service:{read:!0}}}})],u.prototype,"serviceItemId",void 0);b.__decorate([z.property(V.useViewTimeProperty)],u.prototype,"useViewTime",null);u=b.__decorate([F.subclass("esri.layers.SceneLayer")],u);const Wa={"mesh-pyramids":"mesh-pyramids",meshpyramids:"mesh-pyramids","features-meshes":"mesh-pyramids",points:"points","features-points":"points",lines:"lines","features-lines":"lines",polygons:"polygons",
"features-polygons":"polygons"},Ta={"mesh-pyramids":"mesh",points:"point"};return u})},"esri/geometry/Mesh":function(){define("require ../chunks/tslib.es6 ../core/deprecate ../core/Error ../core/Loadable ../core/Logger ../core/Promise ../core/promiseUtils ../core/reactiveUtils ../core/accessorSupport/decorators/property ../core/has ../core/RandomLCG ../core/accessorSupport/decorators/subclass ../core/libs/gl-matrix-2/factories/vec3f64 ./Geometry ./Point ./Polygon ./support/aaBoundingBox ./support/axisAngleDegrees ./support/MeshComponent ./support/meshErrors ./support/MeshGeoreferencedVertexSpace ./support/MeshLocalVertexSpace ./support/MeshTransform ./support/MeshVertexAttributes ./support/meshVertexSpaceUtils ./support/triangulationUtils ./support/meshUtils/centerAt ./support/meshUtils/extent ./support/meshUtils/loadExternal ./support/meshUtils/Metadata ./support/meshUtils/primitives ./support/meshUtils/rotate ./support/meshUtils/scale".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w,x,u,t,m,q,r,v,y,B,z,A,C,H,E,F,G,D,I,J,N,M){function Q(){return h.getLogger("esri.geometry.Mesh")}var O;c={base:null,key:"type",defaultKeyValue:"georeferenced",typeMap:{georeferenced:B,local:z}};p=O=class extends p.LoadableMixin(e.EsriPromiseMixin(u)){constructor(L){super(L);this.components=null;this.vertexSpace=new B;this.transform=null;this.metadata=new I.Metadata;this.hasZ=!0;this.hasM=!1;this.vertexAttributes=new C.MeshVertexAttributes;this.type="mesh"}initialize(){if(0===
this.metadata.externalSources.length||this.vertexAttributes.position.length)this.loadStatus="loaded";this.when(()=>{this.addHandles(d.watch(()=>({vertexAttributes:this.vertexAttributes,components:this.components?.map(L=>L.clone())}),()=>this._clearSources(),{once:!0,sync:!0}))})}get hasExtent(){return this.loaded?0<this.vertexAttributes.position.length&&(!this.components||0<this.components.length):null!=this.metadata.displaySource?.extent}get _transformedExtent(){const {spatialReference:L,vertexSpace:P}=
this,R=this;return G.computeMeshExtent({get transform(){return R.transform},vertexSpace:P,spatialReference:L,untransformedBounds:this._untransformedBounds})}get _untransformedBounds(){const {vertexAttributes:{position:L},components:P}=this;return 0===L.length||0===P?.length?q.create(q.zero):q.fromBuffer(L)}get origin(){const L=H.vertexSpaceOriginToPoint(this.vertexSpace,this.spatialReference);if(null!=L)return L;const {center:P,zmin:R}=this._transformedExtent;return new t({x:P.x,y:P.y,z:R,spatialReference:this.spatialReference})}get extent(){return this.loaded||
null==this.metadata?.displaySource?.extent?this._transformedExtent:this.metadata.displaySource.extent.clone()}addComponent(L){this._checkIfLoaded("addComponent()")&&(this.components||(this.components=[]),this.components.push(v.from(L)),this.notifyChange("components"))}removeComponent(L){if(this._checkIfLoaded("removeComponent()")){if(this.components&&(L=this.components.indexOf(L),-1!==L)){this.components.splice(L,1);this.notifyChange("components");return}Q().error("removeComponent()",y.componentNotFoundMessage)}}rotate(L,
P,R,W){r.composeAxes(L,P,R,K);N.rotate(this,K,W);return this}offset(L,P,R){if(!this._checkIfLoaded("offset()"))return this;const {vertexSpace:W,vertexAttributes:V}=this,ba=V?.position;if(!ba)return this;if(H.isRelativeVertexSpace(W)){const [U,da,fa]=W.origin;W.origin=x.fromValues(U+L,da+P,fa+R)}else{for(let U=0;U<ba.length;U+=3)ba[U]+=L,ba[U+1]+=P,ba[U+2]+=R;this.vertexAttributesChanged()}return this}scale(L,P){if(!this._checkIfLoaded("scale()"))return this;M.scale(this,L,P);return this}centerAt(L,
P){if(!this._checkIfLoaded("centerAt()"))return this;F.centerAt(this,L,P);return this}load(L){const {metadata:{displaySource:P}}=this;P&&this.addResolvingPromise(D.loadExternal(this,P,L));return Promise.resolve(this)}addExternalSources(L){this.metadata.externalSources.addMany(L)}updateDisplaySource(L){this.metadata.displaySource=L}clone(){return this.cloneAndModifyVertexAttributes(this.vertexAttributes.clone(),this.vertexSpace.clone(),{preserveMetadata:!0})}cloneAndModifyVertexAttributes(L,P,R){let W=
null;if(this.components){const V=new Map,ba=new Map;W=this.components.map(U=>U.cloneWithDeduplication(V,ba))}L={components:W,spatialReference:this.spatialReference,vertexAttributes:L,vertexSpace:P,transform:this.transform?.clone()??null,metadata:R?.preserveMetadata?this.metadata.clone():new I.Metadata};return new O(L)}cloneShallow(){return new O({components:this.components,spatialReference:this.spatialReference,vertexAttributes:this.vertexAttributes,vertexSpace:this.vertexSpace.clone(),transform:this.transform,
metadata:this.metadata})}vertexAttributesChanged(){this.notifyChange("vertexAttributes")}async toBinaryGLTF(L){const [{toBinaryGLTF:P}]=await Promise.all([new Promise((R,W)=>a(["./support/meshUtils/exporters/gltf/gltfexport"],R,W)),this.load(L)]);g.throwIfAborted(L);return await P(this,L)}get memoryUsage(){let L;L=0+this.vertexAttributes.memoryUsage;if(null!=this.components)for(const P of this.components)L+=P.memoryUsage;return L}_clearSources(){this.metadata.clearSources()}_checkIfLoaded(L){return this.loaded?
!0:(Q().error(L,y.meshNotLoadedMessage),!1)}static createBox(L,P){if(!(L instanceof t))return Q().error(".createBox()",y.invalidLocationMessage),null;L=new O(J.convertUnitGeometry(J.createUnitSizeBox(),L,P));return P?.imageFace&&"all"!==P.imageFace?J.extractSingleFaceOfBox(L,P.imageFace):L}static createSphere(L,P){return L instanceof t?new O(J.convertUnitGeometry(J.createUnitSizeSphere(P?.densificationFactor||0),L,P)):(Q().error(".createSphere()",y.invalidLocationMessage),null)}static createCylinder(L,
P){return L instanceof t?new O(J.convertUnitGeometry(J.createUnitSizeCylinder(P?.densificationFactor||0),L,P)):(Q().error(".createCylinder()",y.invalidLocationMessage),null)}static createPlane(L,P){if(!(L instanceof t))return Q().error(".createPlane()",y.invalidLocationMessage),null;const R=P?.facing??"up",W=J.convertPlaneSizeParameter(R,P?.size);return new O(J.convertUnitGeometry(J.createUnitSizePlane(R),L,{...P,size:W}))}static createFromPolygon(L,P){if(!(L instanceof m))return Q().error(".createFromPolygon()",
y.invalidPolygonMessage),null;const R=E.triangulate(L);return new O({vertexAttributes:new C.MeshVertexAttributes({position:R.position}),components:[new v({faces:R.faces,shading:"flat",material:P?.material??null})],spatialReference:L.spatialReference,vertexSpace:new B})}static async createFromGLTF(L,P,R){if(!(L instanceof t))throw L=new y.InvalidLocationError,Q().error(".createfromGLTF()",L.message),L;const {loadGLTFMesh:W}=await g.whenOrAbort(new Promise((V,ba)=>a(["./support/meshUtils/loadGLTFMesh"],
V,ba)),R);return new O(await W(L,P,R))}static async createFromFiles(L,P,R){n.deprecatedFunction(Q(),"`Mesh.createFromFiles` is deprecated in favor of 'SceneLayer.convertMesh'",{replacement:"SceneLayer.convertMesh",version:"4.29"});if(!(L instanceof t))throw L=P=new y.InvalidLocationError,Q().error(".createFromFiles()",L.message),P;if(!R?.layer)throw new k("invalid:no-layer","SceneLayer required for file to mesh conversion.");return R.layer.convertMesh(P,{location:L,...R})}static createWithExternalSource(L,
P,R){const W=R?.extent??null,{spatialReference:V}=L,ba=R?.transform?.clone()??new A;L=H.selectVertexSpace(L,R);P={source:P,extent:W,unitConversionDisabled:R?.unitConversionDisabled};R=new I.Metadata;R.externalSources.push(P);return new O({metadata:R,transform:ba,vertexSpace:L,spatialReference:V})}static createIncomplete(L,P){var {spatialReference:R}=L;const W=P?.transform?.clone()??new A;L=H.selectVertexSpace(L,P);R=new O({transform:W,vertexSpace:L,spatialReference:R});R.addResolvingPromise(Promise.reject(new k("mesh-incomplete",
"Mesh resources are not complete")));return R}};b.__decorate([f.property({type:[v],json:{write:!0}})],p.prototype,"components",void 0);b.__decorate([f.property({nonNullable:!0,types:c,constructOnly:!0,json:{write:!0}})],p.prototype,"vertexSpace",void 0);b.__decorate([f.property({type:A,json:{write:!0}})],p.prototype,"transform",void 0);b.__decorate([f.property({constructOnly:!0})],p.prototype,"metadata",void 0);b.__decorate([f.property()],p.prototype,"hasExtent",null);b.__decorate([f.property()],
p.prototype,"_transformedExtent",null);b.__decorate([f.property()],p.prototype,"_untransformedBounds",null);b.__decorate([f.property()],p.prototype,"origin",null);b.__decorate([f.property({readOnly:!0,json:{read:!1}})],p.prototype,"extent",null);b.__decorate([f.property({readOnly:!0,json:{read:!1,write:!0,default:!0}})],p.prototype,"hasZ",void 0);b.__decorate([f.property({readOnly:!0,json:{read:!1,write:!0,default:!1}})],p.prototype,"hasM",void 0);b.__decorate([f.property({type:C.MeshVertexAttributes,
nonNullable:!0,json:{write:!0}})],p.prototype,"vertexAttributes",void 0);p=O=b.__decorate([w.subclass("esri.geometry.Mesh")],p);const K=r.create();return p})},"esri/geometry/support/MeshComponent":function(){define("../../chunks/tslib.es6 ../../core/JSONSupport ../../core/lang ../../core/Logger ../../core/accessorSupport/decorators/property ../../core/accessorSupport/decorators/cast ../../core/accessorSupport/decorators/subclass ../../core/accessorSupport/ensureType ./MeshMaterial ./MeshMaterialMetallicRoughness ./meshProperties".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c){var l;b=l=class extends b.JSONSupport{static from(w){return g.ensureClass(l,w)}constructor(w){super(w);this.material=this.faces=null;this.name=void 0;this.shading="source";this.trustSourceNormals=!1}castFaces(w){return c.castArray(w,Uint32Array,[Uint16Array],{loggerTag:".faces\x3d",stride:3},k.getLogger(this))}castMaterial(w){return w&&"object"===typeof w&&("metallic"in w||"roughness"in w||"metallicRoughnessTexture"in w)?g.ensureClass(f,w):g.ensureClass(d,w)}clone(){return new l({faces:n.clone(this.faces),
shading:this.shading,material:n.clone(this.material),trustSourceNormals:this.trustSourceNormals,name:this.name})}cloneWithDeduplication(w,x){w={faces:n.clone(this.faces),shading:this.shading,material:this.material?this.material.cloneWithDeduplication(w,x):null,trustSourceNormals:this.trustSourceNormals,name:this.name};return new l(w)}get memoryUsage(){let w=0;null!=this.faces&&(w+=this.faces.byteLength);null!=this.material&&(w+=this.material.memoryUsage);return w}};a.__decorate([p.property({json:{write:c.writeTypedArray}})],
b.prototype,"faces",void 0);a.__decorate([h.cast("faces")],b.prototype,"castFaces",null);a.__decorate([p.property({type:d,json:{write:!0}})],b.prototype,"material",void 0);a.__decorate([h.cast("material")],b.prototype,"castMaterial",null);a.__decorate([p.property({json:{write:!0}})],b.prototype,"name",void 0);a.__decorate([p.property({type:String,json:{write:!0}})],b.prototype,"shading",void 0);a.__decorate([p.property({type:Boolean})],b.prototype,"trustSourceNormals",void 0);return b=l=a.__decorate([e.subclass("esri.geometry.support.MeshComponent")],
b)})},"esri/geometry/support/MeshMaterial":function(){define("../../chunks/tslib.es6 ../../Color ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/has ../../core/Logger ../../core/RandomLCG ../../core/accessorSupport/decorators/subclass ./MeshTexture ./MeshTextureTransform".split(" "),function(a,b,n,k,p,h,e,g,d,f){var c;n=c=class extends n.JSONSupport{constructor(l){super(l);this.colorTextureTransform=this.colorTexture=this.color=null;this.normalTextureTransform=this.normalTexture=
void 0;this.alphaMode="auto";this.alphaCutoff=.5;this.doubleSided=!0}clone(){return this.cloneWithDeduplication(null,new Map)}cloneWithDeduplication(l,w){const x=null!=l?l.get(this):null;if(x)return x;w=new c(this.clonePropertiesWithDeduplication(w));null!=l&&l.set(this,w);return w}clonePropertiesWithDeduplication(l){return{color:null!=this.color?this.color.clone():null,colorTexture:this.colorTexture?.cloneWithDeduplication(l),normalTexture:this.normalTexture?.cloneWithDeduplication(l),alphaMode:this.alphaMode,
alphaCutoff:this.alphaCutoff,doubleSided:this.doubleSided,colorTextureTransform:this.colorTextureTransform?.clone(),normalTextureTransform:this.normalTextureTransform?.clone()}}get memoryUsage(){return this.getMemoryUsage()}getMemoryUsage(){let l;l=null!=this.color?16:0;null!=this.colorTexture&&(l+=this.colorTexture.memoryUsage);l+=null!=this.colorTextureTransform?20:0;null!=this.normalTexture&&(l+=this.normalTexture.memoryUsage);return l+=null!=this.normalTextureTransform?20:0}};a.__decorate([k.property({type:b,
json:{write:!0}})],n.prototype,"color",void 0);a.__decorate([k.property({type:d,json:{write:!0}})],n.prototype,"colorTexture",void 0);a.__decorate([k.property({type:f,json:{write:!0}})],n.prototype,"colorTextureTransform",void 0);a.__decorate([k.property({type:d,json:{write:!0}})],n.prototype,"normalTexture",void 0);a.__decorate([k.property({type:f,json:{write:!0}})],n.prototype,"normalTextureTransform",void 0);a.__decorate([k.property({nonNullable:!0,json:{write:!0}})],n.prototype,"alphaMode",void 0);
a.__decorate([k.property({nonNullable:!0,json:{write:!0}})],n.prototype,"alphaCutoff",void 0);a.__decorate([k.property({nonNullable:!0,json:{write:!0}})],n.prototype,"doubleSided",void 0);return n=c=a.__decorate([g.subclass("esri.geometry.support.MeshMaterial")],n)})},"esri/geometry/support/MeshTexture":function(){define("../../chunks/tslib.es6 ../../core/has ../../core/imageUtils ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/RandomLCG ../../core/accessorSupport/decorators/reader ../../core/accessorSupport/decorators/subclass ../../core/accessorSupport/decorators/writer ../../chunks/persistableUrlUtils".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c){function l(q){let r="";for(let v=0;v<q.data.length;v++)r+=String.fromCharCode(q.data[v]);return{data:btoa(r),width:q.width,height:q.height}}function w(q){const r=atob(q.data),v=new Uint8ClampedArray(r.length);for(let y=0;y<r.length;y++)v[y]=r.charCodeAt(y);return n.wrapImageData(v,q.width,q.height)}function x(q){for(let r=3;r<q.data.length;r+=4)if(255!==q.data[r])return!0;return!1}var u;const t=new WeakMap;let m=0;b=u=class extends k.JSONSupport{constructor(q){super(q);
this.wrap="repeat"}get url(){return this._get("url")||null}set url(q){this._set("url",q);q&&this._set("data",null)}get data(){return this._get("data")||null}set data(q){this._set("data",q);q&&this._set("url",null)}writeData(q,r,v,y){q instanceof HTMLImageElement?(q={type:"image-element",src:c.toJSON(q.src,y),crossOrigin:q.crossOrigin},r[v]=q):q instanceof HTMLCanvasElement?(q=q.getContext("2d").getImageData(0,0,q.width,q.height),q={type:"canvas-element",imageData:l(q)},r[v]=q):q instanceof HTMLVideoElement?
(q={type:"video-element",src:c.toJSON(q.src,y),autoplay:q.autoplay,loop:q.loop,muted:q.muted,crossOrigin:q.crossOrigin,preload:q.preload},r[v]=q):q instanceof ImageData&&(q={type:"image-data",imageData:l(q)},r[v]=q)}readData(q){switch(q.type){case "image-element":var r=new Image;r.src=q.src;r.crossOrigin=q.crossOrigin;return r;case "canvas-element":return q=w(q.imageData),r=document.createElement("canvas"),r.width=q.width,r.height=q.height,r.getContext("2d").putImageData(q,0,0),r;case "image-data":return w(q.imageData);
case "video-element":return r=document.createElement("video"),r.src=q.src,r.crossOrigin=q.crossOrigin,r.autoplay=q.autoplay,r.loop=q.loop,r.muted=q.muted,r.preload=q.preload,r}}get transparent(){const {data:q,url:r}=this;return q instanceof HTMLCanvasElement?x(q.getContext("2d").getImageData(0,0,q.width,q.height)):q instanceof ImageData?x(q):r?.toLowerCase().endsWith(".png")||r?.toLocaleLowerCase().startsWith("data:image/png;")?!0:!1}set transparent(q){this._overrideIfSome("transparent",q)}get contentHash(){const q=
"string"===typeof this.wrap?this.wrap:"object"===typeof this.wrap?`${this.wrap.horizontal}/${this.wrap.vertical}`:"",r=(v="")=>`d:${v},t:${this.transparent},w:${q}`;if(null!=this.url)return r(this.url);if(null!=this.data){if(this.data instanceof HTMLImageElement||this.data instanceof HTMLVideoElement)return r(this.data.src);t.has(this.data)||t.set(this.data,++m);return r(t.get(this.data))}return r()}get memoryUsage(){let q;q=0+(null!=this.url?this.url.length:0);if(null!=this.data){const r=this.data;
"data"in r?q+=r.data.byteLength:r instanceof HTMLImageElement?q+=r.naturalWidth*r.naturalHeight*3:r instanceof HTMLCanvasElement&&(q+=r.width*r.height*3)}return q}clone(){const q={url:this.url,data:this.data,wrap:this._cloneWrap()};return new u(q)}cloneWithDeduplication(q){var r=q.get(this);if(r)return r;r=this.clone();q.set(this,r);return r}_cloneWrap(){return"string"===typeof this.wrap?this.wrap:{horizontal:this.wrap.horizontal,vertical:this.wrap.vertical}}static from(q){return"string"===typeof q?
new u({url:q}):q instanceof HTMLImageElement||q instanceof HTMLCanvasElement||q instanceof ImageData||q instanceof HTMLVideoElement?new u({data:q}):h.ensureClass(u,q)}};a.__decorate([p.property({type:String,json:{write:c.write}})],b.prototype,"url",null);a.__decorate([p.property({json:{write:{overridePolicy(){return{enabled:!this.url}}}}}),p.property()],b.prototype,"data",null);a.__decorate([f.writer("data")],b.prototype,"writeData",null);a.__decorate([g.reader("data")],b.prototype,"readData",null);
a.__decorate([p.property({type:Boolean,json:{write:{overridePolicy(){return{enabled:this._isOverridden("transparent")}}}}})],b.prototype,"transparent",null);a.__decorate([p.property({json:{write:!0}})],b.prototype,"wrap",void 0);a.__decorate([p.property({readOnly:!0})],b.prototype,"contentHash",null);return b=u=a.__decorate([d.subclass("esri.geometry.support.MeshTexture")],b)})},"esri/geometry/support/MeshTextureTransform":function(){define("../../chunks/tslib.es6 ../../core/Clonable ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/has ../../core/Logger ../../core/RandomLCG ../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,n,k,p,h,e,g){b=class extends b.ClonableMixin(n.JSONSupport){constructor(d){super(d);this.offset=[0,0];this.rotation=0;this.scale=[1,1]}};a.__decorate([k.property({type:[Number],nonNullable:!0,json:{write:!0}})],b.prototype,"offset",void 0);a.__decorate([k.property({type:Number,nonNullable:!0,json:{write:!0}})],b.prototype,"rotation",void 0);a.__decorate([k.property({type:[Number],nonNullable:!0,json:{write:!0}})],b.prototype,"scale",void 0);return b=a.__decorate([g.subclass("esri.geometry.support.MeshTextureTransform")],
b)})},"esri/geometry/support/MeshMaterialMetallicRoughness":function(){define("../../chunks/tslib.es6 ../../Color ../../core/accessorSupport/decorators/property ../../core/has ../../core/Logger ../../core/RandomLCG ../../core/accessorSupport/decorators/subclass ./MeshMaterial ./MeshTexture ./MeshTextureTransform".split(" "),function(a,b,n,k,p,h,e,g,d,f){var c;k=c=class extends g{constructor(l){super(l);this.emissiveTexture=this.emissiveColor=null;this.emissiveTextureTransform=void 0;this.occlusionTexture=
null;this.occlusionTextureTransform=void 0;this.roughness=this.metallic=1;this.metallicRoughnessTexture=null;this.metallicRoughnessTextureTransform=void 0}clone(){return this.cloneWithDeduplication(null,new Map)}cloneWithDeduplication(l,w){const x=null!=l?l.get(this):null;if(x)return x;w=new c(this.clonePropertiesWithDeduplication(w));null!=l&&l.set(this,w);return w}getMemoryUsage(){let l=super.getMemoryUsage();l+=null!=this.emissiveColor?16:0;null!=this.emissiveTexture&&(l+=this.emissiveTexture.memoryUsage);
l+=null!=this.emissiveTextureTransform?20:0;null!=this.occlusionTexture&&(l+=this.occlusionTexture.memoryUsage);l+=null!=this.occlusionTextureTransform?20:0;null!=this.metallicRoughnessTexture&&(l+=this.metallicRoughnessTexture.memoryUsage);return l+=null!=this.metallicRoughnessTextureTransform?20:0}clonePropertiesWithDeduplication(l){return{...super.clonePropertiesWithDeduplication(l),emissiveColor:this.emissiveColor?.clone(),emissiveTexture:this.emissiveTexture?.cloneWithDeduplication(l),emissiveTextureTransform:this.emissiveTextureTransform?.clone(),
occlusionTexture:this.occlusionTexture?.cloneWithDeduplication(l),occlusionTextureTransform:this.occlusionTextureTransform?.clone(),metallic:this.metallic,roughness:this.roughness,metallicRoughnessTexture:this.metallicRoughnessTexture?.cloneWithDeduplication(l),metallicRoughnessTextureTransform:this.metallicRoughnessTextureTransform?.clone()}}};a.__decorate([n.property({type:b,json:{write:!0}})],k.prototype,"emissiveColor",void 0);a.__decorate([n.property({type:d,json:{write:!0}})],k.prototype,"emissiveTexture",
void 0);a.__decorate([n.property({type:f,json:{write:!0}})],k.prototype,"emissiveTextureTransform",void 0);a.__decorate([n.property({type:d,json:{write:!0}})],k.prototype,"occlusionTexture",void 0);a.__decorate([n.property({type:f,json:{write:!0}})],k.prototype,"occlusionTextureTransform",void 0);a.__decorate([n.property({type:Number,nonNullable:!0,json:{write:!0},range:{min:0,max:1}})],k.prototype,"metallic",void 0);a.__decorate([n.property({type:Number,nonNullable:!0,json:{write:!0},range:{min:0,
max:1}})],k.prototype,"roughness",void 0);a.__decorate([n.property({type:d,json:{write:!0}})],k.prototype,"metallicRoughnessTexture",void 0);a.__decorate([n.property({type:f,json:{write:!0}})],k.prototype,"metallicRoughnessTextureTransform",void 0);return k=c=a.__decorate([e.subclass("esri.geometry.support.MeshMaterialMetallicRoughness")],k)})},"esri/geometry/support/meshProperties":function(){define(["exports"],function(a){function b(n,k,p,h){const {loggerTag:e,stride:g}=k;return 0!==n.length%g?
(h.error(e,`Invalid array length, expected a multiple of ${g}`),new p([])):n}a.castArray=function(n,k,p,h,e){if(!n)return n;if(n instanceof k)return b(n,h,k,e);for(const g of p)if(n instanceof g)return b(new k(n),h,k,e);if(Array.isArray(n))return b(new k(n),h,k,e);p=p.map(g=>`'${g.name}'`);e.error(`Failed to set property, expected one of ${p}, but got ${n.constructor.name}`);return new k([])};a.writeTypedArray=function(n,k,p){const h=Array(n.length);for(let e=0;e<n.length;e++)h[e]=n[e];k[p]=h};Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/meshErrors":function(){define(["exports","../../core/Error"],function(a,b){class n extends b{constructor(){super("invalid-input:location","Expected location to be a Point instance")}}a.InvalidLocationError=n;a.componentNotFoundMessage="Provided component is not part of the list of components";a.invalidLocationMessage="Expected location to be a Point instance";a.invalidPolygonMessage="Expected polygon to be a Polygon instance";a.meshNotLoadedMessage=
"Mesh must be loaded before applying operations";Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/MeshVertexAttributes":function(){define("exports ../../chunks/tslib.es6 ../../core/JSONSupport ../../core/lang ../../core/Logger ../../core/accessorSupport/decorators/property ../../core/accessorSupport/decorators/cast ../../core/accessorSupport/decorators/subclass ./meshProperties".split(" "),function(a,b,n,k,p,h,e,g,d){var f;a.MeshVertexAttributes=f=class extends n.JSONSupport{constructor(c){super(c);
this.color=null;this.position=new Float64Array(0);this.tangent=this.normal=this.uv=null}castColor(c){return d.castArray(c,Uint8Array,[Uint8ClampedArray],{loggerTag:".color\x3d",stride:4},p.getLogger(this))}castPosition(c){c&&c instanceof Float32Array&&p.getLogger(this).warn(".position\x3d","Setting position attribute from a Float32Array may cause precision problems. Consider storing data in a Float64Array or a regular number array");return d.castArray(c,Float64Array,[Float32Array],{loggerTag:".position\x3d",
stride:3},p.getLogger(this))}castUv(c){return d.castArray(c,Float32Array,[Float64Array],{loggerTag:".uv\x3d",stride:2},p.getLogger(this))}castNormal(c){return d.castArray(c,Float32Array,[Float64Array],{loggerTag:".normal\x3d",stride:3},p.getLogger(this))}castTangent(c){return d.castArray(c,Float32Array,[Float64Array],{loggerTag:".tangent\x3d",stride:4},p.getLogger(this))}clone(){const c={position:k.clone(this.position),uv:k.clone(this.uv),normal:k.clone(this.normal),tangent:k.clone(this.tangent),
color:k.clone(this.color)};return new f(c)}clonePositional(){const c={position:k.clone(this.position),normal:k.clone(this.normal),tangent:k.clone(this.tangent),uv:this.uv,color:this.color};return new f(c)}get memoryUsage(){let c;c=0+this.position.byteLength;null!=this.uv&&(c+=this.uv.byteLength);null!=this.normal&&(c+=this.normal.byteLength);null!=this.tangent&&(c+=this.tangent.byteLength);null!=this.color&&(c+=this.color.byteLength);return c}};b.__decorate([h.property({json:{write:d.writeTypedArray}})],
a.MeshVertexAttributes.prototype,"color",void 0);b.__decorate([e.cast("color")],a.MeshVertexAttributes.prototype,"castColor",null);b.__decorate([h.property({nonNullable:!0,json:{write:d.writeTypedArray}})],a.MeshVertexAttributes.prototype,"position",void 0);b.__decorate([e.cast("position")],a.MeshVertexAttributes.prototype,"castPosition",null);b.__decorate([h.property({json:{write:d.writeTypedArray}})],a.MeshVertexAttributes.prototype,"uv",void 0);b.__decorate([e.cast("uv")],a.MeshVertexAttributes.prototype,
"castUv",null);b.__decorate([h.property({json:{write:d.writeTypedArray}})],a.MeshVertexAttributes.prototype,"normal",void 0);b.__decorate([e.cast("normal")],a.MeshVertexAttributes.prototype,"castNormal",null);b.__decorate([h.property({json:{write:d.writeTypedArray}})],a.MeshVertexAttributes.prototype,"tangent",void 0);b.__decorate([e.cast("tangent")],a.MeshVertexAttributes.prototype,"castTangent",null);a.MeshVertexAttributes=f=b.__decorate([g.subclass("esri.geometry.support.MeshVertexAttributes")],
a.MeshVertexAttributes);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/triangulationUtils":function(){define("exports ../../chunks/earcut ./Axis ./coordsUtils ./DoubleArray ./Indices ./polygonUtils ./meshUtils/deduplicate".split(" "),function(a,b,n,k,p,h,e,g){function d(w,x,u){if(1===w.length)return w[0];x=p.newDoubleArray(x);u=Array(u);let t=0,m=0,q=0;for(const r of w){for(w=0;w<r.position.length;w++)x[t++]=r.position[w];for(const v of r.faces)u[m++]=v+q;q=
t/3}return{position:x,faces:h.compactIndices(u)}}function f(w,x,u,t){const m=w.length,q=Array(m),r=Array(m),v=Array(m);var y=0;for(var B=0;B<m;++B)y+=w[B].length;let z=B=0,A=0;y=p.newDoubleArray(3*y);let C=0;for(let G=m-1;0<=G;G--){var H=w[G],E=u===a.CounterClockwiseMode.CCW_IS_HOLE?l(H,x,t):!1;if(E&&1!==m)q[B++]=H;else{var F=H.length;for(let D=0;D<B;++D)F+=q[D].length;F={index:C,pathLengths:Array(B+1),count:F,holeIndices:Array(B)};F.pathLengths[0]=H.length;0<H.length&&(v[A++]={index:C,count:H.length});
C=E?c(H,H.length-1,-1,y,C,H.length,x):c(H,0,1,y,C,H.length,x);for(H=0;H<B;++H)E=q[H],F.holeIndices[H]=C,F.pathLengths[H+1]=E.length,0<E.length&&(v[A++]={index:C,count:E.length}),C=c(E,0,1,y,C,E.length,x);B=0;0<F.count&&(r[z++]=F)}}for(w=0;w<B;++w)u=q[w],0<u.length&&(v[A++]={index:C,count:u.length}),C=c(u,0,1,y,C,u.length,x);r.length=z;v.length=A;return{position:y,polygons:r,outlines:v}}function c(w,x,u,t,m,q,r){m*=3;for(let v=0;v<q;++v){const y=w[x];t[m++]=y[0];t[m++]=y[1];t[m++]=r&&y[2]?y[2]:0;x+=
u}return m/3}function l(w,x,u){if(!x)return!k.isClockwise(w);switch(e.leastSignificantAxis(w,w.length-1,u)){case n.Axis.X:return!k.isClockwise(w,n.Axis.Y,n.Axis.Z);case n.Axis.Y:return!k.isClockwise(w,n.Axis.X,n.Axis.Z);case n.Axis.Z:return!k.isClockwise(w,n.Axis.X,n.Axis.Y)}}a.CounterClockwiseMode=void 0;(function(w){w[w.NONE=0]="NONE";w[w.CCW_IS_HOLE=1]="CCW_IS_HOLE"})(a.CounterClockwiseMode||(a.CounterClockwiseMode={}));a.isCounterClockwise=l;a.ringsToTriangulationInfo=f;a.triangulate=function(w){w=
f(w.rings,w.hasZ,a.CounterClockwiseMode.CCW_IS_HOLE,w.spatialReference);const x=[];let u=0,t=0;for(var m of w.polygons){const r=m.index,v=p.doubleSubArray(w.position,3*r,3*m.count);var q=m.holeIndices.map(y=>y-r);q=h.compactIndices(b.earcut(v,q,3));x.push({position:v,faces:q});u+=v.length;t+=q.length}m=d(x,u,t);w=Array.isArray(m.position)?g.deduplicate(m.position,3,{originalIndices:m.faces}):g.deduplicate(m.position.buffer,6,{originalIndices:m.faces});m.position=p.doubleArrayFrom(new Float64Array(w.buffer));
m.faces=w.indices;return m};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/earcut":function(){define(["exports"],function(a){function b(z,A,C){C=C||2;var H=A&&A.length,E=H?A[0]*C:z.length,F=n(z,0,E,C,!0),G=[];if(!F||F.next===F.prev)return G;var D;if(H){var I=F;var J=C;F=[];var N;H=0;for(N=A.length;H<N;H++){var M=A[H]*J;var Q=H<N-1?A[H+1]*J:z.length;M=n(z,M,Q,J,!1);M===M.next&&(M.steiner=!0);Q=F;var O=Q.push,K=M,L=M;do{if(K.x<L.x||K.x===L.x&&K.y<L.y)L=K;K=K.next}while(K!==
M);O.call(Q,L)}F.sort(e);for(H=0;H<F.length;H++)J=F[H],A=I,(I=d(J,A))?(N=q(I,J),J=k(I,I.next),N=g(N),k(N,N.next),J=g(J),I=g(A===I?J:A)):I=A,I=k(I,I.next);F=I}if(z.length>80*C){var P=D=z[0];var R=H=z[1];for(J=C;J<E;J+=C)A=z[J],I=z[J+1],A<P&&(P=A),I<R&&(R=I),A>D&&(D=A),I>H&&(H=I);D=Math.max(D-P,H-R);D=0!==D?1/D:0}p(F,G,C,P,R,D);return G}function n(z,A,C,H,E){if(E===0<B(z,A,C,H))for(E=A;E<C;E+=H)var F=r(E,z[E],z[E+1],F);else for(E=C-H;E>=A;E-=H)F=r(E,z[E],z[E+1],F);F&&w(F,F.next)&&(z=F.next,v(F),F=z);
return F}function k(z,A){if(!z)return z;A||=z;do{var C=!1;if(z.steiner||!w(z,z.next)&&0!==l(z.prev,z,z.next))z=z.next;else{A=z.prev;v(z);z=A;if(z===z.next)break;C=!0}}while(C||z!==A);return A}function p(z,A,C,H,E,F,G){if(z){if(!G&&F){var D=z,I=D;do null===I.z&&(I.z=f(I.x,I.y,H,E,F)),I.prevZ=I.prev,I=I.nextZ=I.next;while(I!==D);I.prevZ.nextZ=null;I.prevZ=null;D=I;var J,N,M,Q,O=1;do{I=D;var K=D=null;for(N=0;I;){N++;var L=I;for(J=M=0;J<O&&(M++,L=L.nextZ,L);J++);for(Q=O;0<M||0<Q&&L;)0!==M&&(0===Q||!L||
I.z<=L.z)?(J=I,I=I.nextZ,M--):(J=L,L=L.nextZ,Q--),K?K.nextZ=J:D=J,J.prevZ=K,K=J;I=L}K.nextZ=null;O*=2}while(1<N)}for(D=z;z.prev!==z.next;){I=z.prev;L=z.next;if(F)K=h(z,H,E,F);else a:if(K=z,N=K.prev,M=K,O=K.next,0<=l(N,M,O))K=!1;else{for(J=K.next.next;J!==K.prev;){if(c(N.x,N.y,M.x,M.y,O.x,O.y,J.x,J.y)&&0<=l(J.prev,J,J.next)){K=!1;break a}J=J.next}K=!0}if(K)A.push(I.i/C),A.push(z.i/C),A.push(L.i/C),v(z),D=z=L.next;else if(z=L,z===D){if(!G)p(k(z),A,C,H,E,F,1);else if(1===G){z=k(z);G=A;D=C;I=z;do L=I.prev,
K=I.next.next,!w(L,K)&&x(L,I,I.next,K)&&m(L,K)&&m(K,L)&&(G.push(L.i/D),G.push(I.i/D),G.push(K.i/D),v(I),v(I.next),I=z=K),I=I.next;while(I!==z);z=k(I);p(z,A,C,H,E,F,2)}else if(2===G)a:{G=z;do{for(D=G.next.next;D!==G.prev;){if(I=G.i!==D.i){K=K=K=K=void 0;I=G;L=D;if(K=I.next.i!==L.i&&I.prev.i!==L.i){b:{K=I;do{if(K.i!==I.i&&K.next.i!==I.i&&K.i!==L.i&&K.next.i!==L.i&&x(K,K.next,I,L)){K=!0;break b}K=K.next}while(K!==I);K=!1}K=!K}if(K){if(K=m(I,L)&&m(L,I)){K=I;N=!1;M=(I.x+L.x)/2;O=(I.y+L.y)/2;do K.y>O!==
K.next.y>O&&K.next.y!==K.y&&M<(K.next.x-K.x)*(O-K.y)/(K.next.y-K.y)+K.x&&(N=!N),K=K.next;while(K!==I);K=N}K=K&&(l(I.prev,I,L.prev)||l(I,L.prev,L))||w(I,L)&&0<l(I.prev,I,I.next)&&0<l(L.prev,L,L.next)}I=K}if(I){z=q(G,D);G=k(G,G.next);z=k(z,z.next);p(G,A,C,H,E,F);p(z,A,C,H,E,F);break a}D=D.next}G=G.next}while(G!==z)}break}}}}function h(z,A,C,H){var E=z.prev,F=z.next;if(0<=l(E,z,F))return!1;var G=E.x>z.x?E.x>F.x?E.x:F.x:z.x>F.x?z.x:F.x,D=E.y>z.y?E.y>F.y?E.y:F.y:z.y>F.y?z.y:F.y,I=f(E.x<z.x?E.x<F.x?E.x:
F.x:z.x<F.x?z.x:F.x,E.y<z.y?E.y<F.y?E.y:F.y:z.y<F.y?z.y:F.y,A,C,H);A=f(G,D,A,C,H);C=z.prevZ;for(H=z.nextZ;C&&C.z>=I&&H&&H.z<=A;){if(C!==z.prev&&C!==z.next&&c(E.x,E.y,z.x,z.y,F.x,F.y,C.x,C.y)&&0<=l(C.prev,C,C.next))return!1;C=C.prevZ;if(H!==z.prev&&H!==z.next&&c(E.x,E.y,z.x,z.y,F.x,F.y,H.x,H.y)&&0<=l(H.prev,H,H.next))return!1;H=H.nextZ}for(;C&&C.z>=I;){if(C!==z.prev&&C!==z.next&&c(E.x,E.y,z.x,z.y,F.x,F.y,C.x,C.y)&&0<=l(C.prev,C,C.next))return!1;C=C.prevZ}for(;H&&H.z<=A;){if(H!==z.prev&&H!==z.next&&
c(E.x,E.y,z.x,z.y,F.x,F.y,H.x,H.y)&&0<=l(H.prev,H,H.next))return!1;H=H.nextZ}return!0}function e(z,A){return z.x-A.x}function g(z){if(z.next.prev===z)return z;let A=z;do{const C=A.next;if(C.prev===A||C===A||C===z)break;A=C}while(1);return A}function d(z,A){var C=A,H=z.x,E=z.y,F=-Infinity;do{if(E<=C.y&&E>=C.next.y&&C.next.y!==C.y){var G=C.x+(E-C.y)*(C.next.x-C.x)/(C.next.y-C.y);if(G<=H&&G>F){F=G;if(G===H){if(E===C.y)return C;if(E===C.next.y)return C.next}var D=C.x<C.next.x?C:C.next}}C=C.next}while(C!==
A);if(!D)return null;if(H===F)return D;A=D;G=D.x;var I=D.y,J=Infinity;C=D;do{if(H>=C.x&&C.x>=G&&H!==C.x&&c(E<I?H:F,E,G,I,E<I?F:H,E,C.x,C.y)){var N=Math.abs(E-C.y)/(H-C.x);var M;if((M=m(C,z))&&!(M=N<J)&&(M=N===J)&&!(M=C.x>D.x)&&(M=C.x===D.x)){M=D;var Q=C;M=0>l(M.prev,M,Q.prev)&&0>l(Q.next,M,M.next)}M&&(D=C,J=N)}C=C.next}while(C!==A);return D}function f(z,A,C,H,E){z=32767*(z-C)*E;A=32767*(A-H)*E;z=(z|z<<8)&16711935;z=(z|z<<4)&252645135;z=(z|z<<2)&858993459;A=(A|A<<8)&16711935;A=(A|A<<4)&252645135;A=
(A|A<<2)&858993459;return(z|z<<1)&1431655765|((A|A<<1)&1431655765)<<1}function c(z,A,C,H,E,F,G,D){return 0<=(E-G)*(A-D)-(z-G)*(F-D)&&0<=(z-G)*(H-D)-(C-G)*(A-D)&&0<=(C-G)*(F-D)-(E-G)*(H-D)}function l(z,A,C){return(A.y-z.y)*(C.x-A.x)-(A.x-z.x)*(C.y-A.y)}function w(z,A){return z.x===A.x&&z.y===A.y}function x(z,A,C,H){var E=t(l(z,A,C)),F=t(l(z,A,H)),G=t(l(C,H,z)),D=t(l(C,H,A));return E!==F&&G!==D||0===E&&u(z,C,A)||0===F&&u(z,H,A)||0===G&&u(C,z,H)||0===D&&u(C,A,H)?!0:!1}function u(z,A,C){return A.x<=Math.max(z.x,
C.x)&&A.x>=Math.min(z.x,C.x)&&A.y<=Math.max(z.y,C.y)&&A.y>=Math.min(z.y,C.y)}function t(z){return 0<z?1:0>z?-1:0}function m(z,A){return 0>l(z.prev,z,z.next)?0<=l(z,A,z.next)&&0<=l(z,z.prev,A):0>l(z,A,z.prev)||0>l(z,z.next,A)}function q(z,A){var C=new y(z.i,z.x,z.y),H=new y(A.i,A.x,A.y),E=z.next,F=A.prev;z.next=A;A.prev=z;C.next=E;E.prev=C;H.next=C;C.prev=H;F.next=H;H.prev=F;return H}function r(z,A,C,H){z=new y(z,A,C);H?(z.next=H.next,z.prev=H,H.next.prev=z,H.next=z):(z.prev=z,z.next=z);return z}function v(z){z.next.prev=
z.prev;z.prev.next=z.next;z.prevZ&&(z.prevZ.nextZ=z.nextZ);z.nextZ&&(z.nextZ.prevZ=z.prevZ)}function y(z,A,C){this.i=z;this.x=A;this.y=C;this.nextZ=this.prevZ=this.z=this.next=this.prev=null;this.steiner=!1}function B(z,A,C,H){for(var E=0,F=C-H;A<C;A+=H)E+=(z[F]-z[A])*(z[A+1]+z[F+1]),F=A;return E}b.deviation=function(z,A,C,H){var E=A&&A.length,F=Math.abs(B(z,0,E?A[0]*C:z.length,C));if(E){E=0;for(var G=A.length;E<G;E++)F-=Math.abs(B(z,A[E]*C,E<G-1?A[E+1]*C:z.length,C))}for(E=A=0;E<H.length;E+=3){G=
H[E]*C;var D=H[E+1]*C,I=H[E+2]*C;A+=Math.abs((z[G]-z[I])*(z[D+1]-z[G+1])-(z[G]-z[D])*(z[I+1]-z[G+1]))}return 0===F&&0===A?0:Math.abs((A-F)/F)};b.flatten=function(z){for(var A=z[0][0].length,C={vertices:[],holes:[],dimensions:A},H=0,E=0;E<z.length;E++){for(var F=0;F<z[E].length;F++)for(var G=0;G<A;G++)C.vertices.push(z[E][F][G]);0<E&&(H+=z[E-1].length,C.holes.push(H))}return C};a.earcut=b})},"esri/geometry/support/polygonUtils":function(){define("exports ../../core/mathUtils ../../core/unitUtils ../../chunks/vec32 ./Axis ./plane".split(" "),
function(a,b,n,k,p,h){function e(d,f,c,l){const w=Array.isArray(f[0])?(u,t)=>f[u][t]:(u,t)=>f[3*u+t],x=l?n.getMetersPerUnitForSR(l)/n.getMetersPerVerticalUnitForSR(l):1;return h.fromManyPoints(d,(u,t)=>k.set(u,w(t,0)*x,w(t,1)*x,w(t,2)),c)}const g=h.create();a.fitPlane=e;a.leastSignificantAxis=function(d,f,c){d=e(g,d,f,c)?h.getNormal(g):[0,0,1];return Math.abs(d[2])>Math.cos(b.deg2rad(80))?p.Axis.Z:Math.abs(d[1])>Math.abs(d[0])?p.Axis.Y:p.Axis.X};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/geometry/support/meshUtils/deduplicate":function(){define(["exports","../../../core/mathUtils","../Indices"],function(a,b,n){let k=null;a.deduplicate=function(p,h,e){var g=Array.isArray(p),d=g?p.length/h:p.byteLength/(4*h),f=g?p:new Uint32Array(p,0,d*h),c=e?.minReduction??0;const l=(p=e?.originalIndices||null)?p.length:0;var w=e?.componentOffsets||null;e=0;if(w)for(var x=0;x<w.length-1;x++){var u=w[x+1]-w[x];u>e&&(e=u)}else e=d;var t=Math.floor(1.1*e)+1;if(null==k||k.length<2*t)k=new Uint32Array(b.nextHighestPowerOfTwo(2*
t));for(e=0;e<2*t;e++)k[e]=0;e=0;const m=(u=!!w&&!!p)?l:d;x=n.newIndexArray(d);var q=new Uint32Array(l),r=0!==c?Math.ceil(7.84*1.96/(c*c)*c*(1-c)):m,v=1,y=w?w[1]:m;for(let H=0;H<m;H++){if(H===r){var B=1-e/H;if(B+1.96*Math.sqrt(B*(1-B)/H)<c)return null;r*=2}if(H===y){for(y=0;y<2*t;y++)k[y]=0;if(p)for(y=w[v-1];y<w[v];y++)q[y]=x[p[y]];y=w[++v]}B=u?p[H]:H;const E=B*h;var z=0;for(var A=0;A<h;A++)z=f[E+A]+z|0,z=z+(z<<11)+(z>>>2)|0;z>>>=0;A=z%t;let F=e;for(;0!==k[2*A+1];){if(k[2*A]===z){const G=k[2*A+1]-
1;var C=G*h;a:{for(let D=0;D<h;D++)if(f[E+D]!==f[C+D]){C=!1;break a}C=!0}if(C){F=x[G];break}}A++;A>=t&&(A-=t)}F===e&&(k[2*A]=z,k[2*A+1]=B+1,e++);x[B]=F}if(0!==c&&1-e/d<c)return null;if(u){for(d=w[v-1];d<q.length;d++)q[d]=x[p[d]];x=n.compactIndices(q)}g=g?Array(e):new Uint32Array(e*h);e=0;for(r=0;r<m;r++)if(x[r]===e){d=f;c=(u?p[r]:r)*h;w=g;t=e*h;q=h;for(v=0;v<q;v++)w[t+v]=d[c+v];e++}if(p&&!u){h=new Uint32Array(l);for(f=0;f<h.length;f++)h[f]=x[p[f]];x=n.compactIndices(h)}return{buffer:Array.isArray(g)?
g:g.buffer,indices:x,uniqueCount:e}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/meshUtils/centerAt":function(){define("exports ../../../core/Logger ../../../chunks/vec32 ../../../core/libs/gl-matrix-2/factories/vec3f64 ../../projection/projectPointToVector ../MeshGeoreferencedVertexSpace ../MeshLocalVertexSpace ../meshVertexSpaceUtils ./geographicUtils ./projection ./vertexSpaceConversion".split(" "),function(a,b,n,k,p,h,e,g,d,f,c){const l=()=>b.getLogger("esri.geometry.support.meshUtils.centerAt"),
w=k.create(),x=k.create(),u=k.create();a.centerAt=function(t,m,q){if(t.vertexAttributes?.position){var {vertexSpace:r}=t,v=q?.origin??t.origin;q=d.performGlobalOperation(l,r,v.spatialReference,q?.geographic);if(g.isRelativeVertexSpace(r))({vertexSpace:r}=t),g.isRelativeVertexSpace(r)&&(p.projectPointToVector(m,w,t.spatialReference)?p.projectPointToVector(v,x,t.spatialReference)?(t=n.subtract(u,w,x),r.origin=n.add(k.create(),r.origin,t)):(m=t.origin,x[0]=m.x,x[1]=m.y,x[2]=m.z,f.logProjectionError(l(),
v.spatialReference,t.spatialReference,f.loadProjectErrorMessage)):f.logProjectionError(l(),m.spatialReference,t.spatialReference,f.loadProjectErrorMessage));else if(q){if(v=k.fromValues(v.x,v.y,v.z??0),v=c.convertVertexSpace(t,new e({origin:v})))if(m=k.fromValues(m.x,m.y,m.z??0),m=c.convertVertexSpace({vertexAttributes:v,spatialReference:t.spatialReference,vertexSpace:new e({origin:m})},h.absolute)){var {position:y,normal:B,tangent:z}=m;t.vertexAttributes.position=y;t.vertexAttributes.normal=B;t.vertexAttributes.tangent=
z;t.vertexAttributesChanged()}}else if(p.projectPointToVector(m,w,t.spatialReference))if(p.projectPointToVector(v,x,t.spatialReference)){if(m=t.vertexAttributes.position)for(v=0;v<m.length;v+=3)for(r=0;3>r;r++)m[v+r]+=w[r]-x[r];t.vertexAttributesChanged()}else m=t.origin,x[0]=m.x,x[1]=m.y,x[2]=m.z,f.logProjectionError(l(),v.spatialReference,t.spatialReference,f.loadProjectErrorMessage);else f.logProjectionError(l(),m.spatialReference,t.spatialReference,f.loadProjectErrorMessage)}};Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/meshUtils/geographicUtils":function(){define(["exports","../../../core/deprecate","../meshVertexSpaceUtils"],function(a,b,n){a.isGlobal=function(k,p){return k.isGeographic||k.isWebMercator&&(p??!0)};a.performGlobalOperation=function(k,p,h,e){if(void 0!==e){b.deprecated(k(),"option: geographic",{replacement:"Use mesh `vertexSpace` and spatial reference to control how operations are performed instead.",version:"4.30",warnOnce:!0});const g=
"local"===p.type;if(n.isRelativeVertexSpace(p)&&e!==g)k().warnOnce(`Specifying the 'geographic' parameter (${e}) for a Mesh vertex space of type "${p.type}" is not supported. This parameter will be ignored.`);else return h.isGeographic||h.isWebMercator&&e}switch(p.type){case "georeferenced":return h.isGeographic;case "local":return h.isGeographic||h.isWebMercator}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/meshUtils/projection":function(){define("exports ../../../core/mathUtils ../../../core/libs/gl-matrix-2/math/mat3 ../../../core/libs/gl-matrix-2/factories/mat3f64 ../../../core/libs/gl-matrix-2/math/mat4 ../../../core/libs/gl-matrix-2/factories/mat4f64 ../../../chunks/vec32 ../../../core/libs/gl-matrix-2/factories/vec3f64 ../../projection/computeTranslationToOriginAndRotation ../../projection/projectBuffer ../Ellipsoid ../spatialReferenceUtils ../webMercatorUtils ../buffer/BufferView ../../../chunks/vec3 ../../../chunks/vec4".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w,x,u,t){function m(C,H,E,F,G){H=H===a.VectorType.NORMAL?3:4;const D=[0,0];for(let I=0,J=1;I<C.length;I+=H,J+=3){F(E[J],D);const N=C[I]*D[0],M=C[I+1]*D[1],Q=C[I+2],O=1/Math.sqrt(N*N+M*M+Q*Q);G[I]=N*O;G[I+1]=M*O;G[I+2]=Q*O;4===H&&(G[I+3]=C[I+3])}return G}function q(C,H,E,F,G){d.computeTranslationToOriginAndRotation(F,E,z,F);C===v.FROM_PCPF&&p.invert(z,z);switch(H){case a.VectorType.NORMAL:return n.normalFromMat4(G,z);case a.VectorType.TANGENT:return n.fromMat4(G,z)}}
function r(C,H,E,F,G,D,I,J){if(H){var N=F.count;if(G.isWGS84||l.isCGCS2000(G)||l.isMars(G)||l.isMoon(G))for(F=0;F<N;F++)D.getVec(F,y),H.getVec(F,B),e.transformMat3(B,B,q(C,E,y,I,A)),J.setVec(F,B);else for(G=0;G<N;G++){D.getVec(G,y);H.getVec(G,B);var M=w.y2lat(F.get(G,1));M=Math.cos(M);E===a.VectorType.TANGENT!==(C===v.TO_PCPF)&&(M=1/M);q(C,E,y,I,A);C===v.TO_PCPF?(A[0]*=M,A[1]*=M,A[2]*=M,A[3]*=M,A[4]*=M,A[5]*=M):(A[0]*=M,A[3]*=M,A[6]*=M,A[1]*=M,A[4]*=M,A[7]*=M);e.transformMat3(B,B,A);e.normalize(B,
B);J.setVec(G,B)}return J}}a.VectorType=void 0;(function(C){C[C.NORMAL=0]="NORMAL";C[C.TANGENT=1]="TANGENT"})(a.VectorType||(a.VectorType={}));var v;(function(C){C[C.TO_PCPF=0]="TO_PCPF";C[C.FROM_PCPF=1]="FROM_PCPF"})(v||={});const y=g.create(),B=g.create(),z=h.create(),A=k.create();a.loadProjectErrorMessage="Projection may be possible after calling projection.load().";a.logProjectionError=function(C,H,E,F){C.error(`Failed to project from (wkid:${H.wkid}) to (wkid:${E.wkid}).${F?" ":""}${F}`)};a.projectFromPCPF=
function(C,H,E,F){return f.projectBuffer(C,H,0,E,F,0)?E:null};a.projectNormalFromPCPF=function(C,H,E,F,G,D){return r(v.FROM_PCPF,x.BufferViewVec3f.fromTypedArray(C),a.VectorType.NORMAL,x.BufferViewVec3f64.fromTypedArray(H),E,x.BufferViewVec3f64.fromTypedArray(F),G,x.BufferViewVec3f.fromTypedArray(D))?D:null};a.projectNormalToPCPF=function(C,H,E,F,G,D){return r(v.TO_PCPF,x.BufferViewVec3f.fromTypedArray(C),a.VectorType.NORMAL,x.BufferViewVec3f64.fromTypedArray(H),E,x.BufferViewVec3f64.fromTypedArray(F),
G,x.BufferViewVec3f.fromTypedArray(D))?D:null};a.projectTangentFromPCPF=function(C,H,E,F,G,D){if(!r(v.FROM_PCPF,x.BufferViewVec3f.fromTypedArray(C,16),a.VectorType.TANGENT,x.BufferViewVec3f64.fromTypedArray(H),E,x.BufferViewVec3f64.fromTypedArray(F),G,x.BufferViewVec3f.fromTypedArray(D,16)))return null;for(H=3;H<C.length;H+=4)D[H]=C[H];return D};a.projectTangentToPCPF=function(C,H,E,F,G,D){if(!r(v.TO_PCPF,x.BufferViewVec3f.fromTypedArray(C,4*Float32Array.BYTES_PER_ELEMENT),a.VectorType.TANGENT,x.BufferViewVec3f64.fromTypedArray(H),
E,x.BufferViewVec3f64.fromTypedArray(F),G,x.BufferViewVec3f.fromTypedArray(D,4*Float32Array.BYTES_PER_ELEMENT)))return null;for(H=3;H<C.length;H+=4)D[H]=C[H];return D};a.projectToPCPF=function(C,H,E,F){return f.projectBuffer(C,H,0,E,F,0)?E:null};a.transformNormal=function(C,H,E){n.normalFromMat4(A,E);u.transformMat3(H,C,A);b.hasScaling(A)&&u.normalize(H,H);return H};a.transformTangent=function(C,H,E){n.fromMat4(A,E);t.transformMat3(H,C,A);b.hasScaling(A)&&u.normalize(H,H,4);return H};a.transformVectorENUPlateCarree=
function(C,H,E,F){const G=H===a.VectorType.NORMAL;return m(C,H,E,(D,I)=>{D=Math.cos(b.deg2rad(D));I[0]=G?D:1/D;I[1]=1},F)};a.transformVectorWMPlateCarree=function(C,H,E,F){const G=H===a.VectorType.NORMAL;return m(C,H,E,(D,I)=>{D=Math.cosh(-D/c.earth.radius);I[0]=1;I[1]=G?D:1/D},F)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/vec4":function(){define(["exports","../core/has","../geometry/support/buffer/math/common"],function(a,b,n){function k(c,l,w){if(c.count===l.count){var x=
c.count,u=w[0],t=w[1],m=w[2],q=w[3],r=w[4],v=w[5],y=w[6],B=w[7],z=w[8],A=w[9],C=w[10],H=w[11],E=w[12],F=w[13],G=w[14];w=w[15];var D=c.typedBuffer;c=c.typedBufferStride;var I=l.typedBuffer;l=l.typedBufferStride;for(let N=0;N<x;N++){const M=N*c;var J=N*l;const Q=I[J],O=I[J+1],K=I[J+2];J=I[J+3];D[M]=u*Q+r*O+z*K+E*J;D[M+1]=t*Q+v*O+A*K+F*J;D[M+2]=m*Q+y*O+C*K+G*J;D[M+3]=q*Q+B*O+H*K+w*J}}}function p(c,l,w,x=4,u=x){if(c.length/x!==l.length/u)n.getMathLogger().error("source and destination buffers need to have the same number of elements");
else{var t=c.length/x,m=w[0],q=w[1],r=w[2],v=w[3],y=w[4],B=w[5],z=w[6],A=w[7],C=w[8],H=w[9],E=w[10],F=w[11],G=w[12],D=w[13],I=w[14];w=w[15];var J=0,N=0;for(let M=0;M<t;M++){const Q=l[J],O=l[J+1],K=l[J+2],L=l[J+3];c[N]=m*Q+y*O+C*K+G*L;c[N+1]=q*Q+B*O+H*K+D*L;c[N+2]=r*Q+z*O+E*K+I*L;c[N+3]=v*Q+A*O+F*K+w*L;J+=u;N+=x}}}function h(c,l,w){e(c.typedBuffer,l.typedBuffer,w,c.typedBufferStride,l.typedBufferStride)}function e(c,l,w,x=4,u=x){if(c.length/x===l.length/u){var t=c.length/x,m=w[0],q=w[1],r=w[2],v=w[3],
y=w[4],B=w[5],z=w[6],A=w[7];w=w[8];var C=0,H=0;for(let E=0;E<t;E++){const F=l[C],G=l[C+1],D=l[C+2],I=l[C+3];c[H]=m*F+v*G+z*D;c[H+1]=q*F+y*G+A*D;c[H+2]=r*F+B*G+w*D;c[H+3]=I;C+=u;H+=x}}}function g(c,l){const w=Math.min(c.count,l.count),x=c.typedBuffer;c=c.typedBufferStride;const u=l.typedBuffer;l=l.typedBufferStride;for(let q=0;q<w;q++){const r=q*c;var t=q*l;const v=u[t],y=u[t+1];t=u[t+2];var m=v*v+y*y+t*t;0<m&&(m=1/Math.sqrt(m),x[r]=m*v,x[r+1]=m*y,x[r+2]=m*t)}}function d(c,l,w){f(c.typedBuffer,l,w,
c.typedBufferStride)}function f(c,l,w,x=4){const u=Math.min(c.length/x,l.count),t=l.typedBuffer;l=l.typedBufferStride;let m=0,q=0;for(let r=0;r<u;r++)c[q]=w*t[m],c[q+1]=w*t[m+1],c[q+2]=w*t[m+2],c[q+3]=w*t[m+3],m+=l,q+=x}b=Object.freeze(Object.defineProperty({__proto__:null,normalize:g,scale:f,scaleView:d,transformMat3:e,transformMat3View:h,transformMat4:p,transformMat4View:k},Symbol.toStringTag,{value:"Module"}));a.normalize=g;a.scale=f;a.scaleView=d;a.transformMat3=e;a.transformMat3View=h;a.transformMat4=
p;a.transformMat4View=k;a.vec4=b})},"esri/geometry/support/buffer/math/common":function(){define(["exports","../../../../core/Logger"],function(a,b){a.getMathLogger=()=>b.getLogger("esri.views.3d.support.buffer.math");Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/meshUtils/vertexSpaceConversion":function(){define("exports ../../../core/Logger ../../../core/mathUtils ../../../core/unitUtils ../../../core/libs/gl-matrix-2/math/mat3 ../../../core/libs/gl-matrix-2/factories/mat3f64 ../../../core/libs/gl-matrix-2/math/mat4 ../../../core/libs/gl-matrix-2/factories/mat4f64 ../../../chunks/vec32 ../../../core/libs/gl-matrix-2/factories/vec3f64 ../../spatialReferenceEllipsoidUtils ../../projection/computeTranslationToOriginAndRotation ../../projection/projectPointToVector ../meshVertexSpaceUtils ../spatialReferenceUtils ../../../chunks/vec3 ./projection".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w,x,u,t,m){function q({vertexAttributes:M,transform:Q,spatialReference:O},{origin:K},L,P){const R=C(O,P,N.SOURCE_AND_TARGET);(Q=K||!n.floatEqualUlp(R,1)?e.copy(F,Q?.localMatrix??g.IDENTITY):null)&&A(Q,O,P,N.SOURCE_AND_TARGET);const {position:W,normal:V,tangent:ba}=Q?z(M,Q):M;P=(O=P?.allowBufferReuse)?W:new Float64Array(W.length);Q=W;K&&(Q=t.translate(P,Q,K));L&&(K=d.negate(I,L),Q=t.translate(P,Q,K));return{position:Q!==M.position||O?Q:Q.slice(),normal:V!==M.normal||
O?V:V?.slice(),tangent:ba!==M.tangent||O?ba:ba?.slice()}}function r(M,Q){return Q?.useEllipsoid&&u.isEarth(M)?c.WGS84ECEFSpatialReference:c.getSphericalPCPF(M)}function v({spatialReference:M,vertexAttributes:Q,transform:O},{origin:K},L,P){const R=r(M,P);if(!l.computeTranslationToOriginAndRotation(M,K,F,R))return m.logProjectionError(E(),M,R),null;O&&e.multiply(F,F,O.localMatrix);A(F,M,P,N.SOURCE);O=new Float64Array(Q.position.length);K=Q.position;t.transformMat4(O,K,F);K=new Float64Array(K.length);
m.projectFromPCPF(O,R,K,M)||(m.logProjectionError(E(),R,M),K=null);if(!K)return null;P=Q.normal;var W=F;if(null==P)P=null;else{var V=new Float32Array(P.length);m.transformNormal(P,V,W);m.projectNormalFromPCPF(V,K,M,O,R,V)?P=V:(m.logProjectionError(E(),R,M),P=null)}if(Q.normal&&!P)return null;W=Q.tangent;V=F;if(null==W)M=null;else{var ba=new Float32Array(W.length);m.transformTangent(W,ba,V);m.projectTangentFromPCPF(ba,K,M,O,R,ba)?M=ba:(m.logProjectionError(E(),R,M),M=null)}if(Q.tangent&&!M)return null;
L&&(Q=d.negate(I,L),t.translate(K,K,Q));return{position:K,normal:P,tangent:M}}function y({vertexAttributes:M,spatialReference:Q,transform:O},{origin:K},L,P){const R=r(Q,P);if(!l.computeTranslationToOriginAndRotation(Q,L,F,R))return m.logProjectionError(E(),Q,R),null;L=1/C(Q,P,N.TARGET);e.scale(F,F,[L,L,L]);L=e.invert(G,F);if(K)if(O)O=z(M,O.localMatrix),t.translate(O.position,O.position,K),K=O;else{const {position:U,normal:da,tangent:fa}=M;K={position:t.translate(new Float64Array(U.length),U,K),tangent:fa,
normal:da}}else K=M;const {position:W,normal:V,tangent:ba}=K;K=new Float64Array(W.length);(P=m.projectToPCPF(W,Q,K,R))?(O=new Float64Array(P.length),t.transformMat4(O,P,L)):(m.logProjectionError(E(),Q,R),O=null);if(!O)return null;L=p.normalFromMat4(D,L);null==V?P=null:(P=(V!==M.normal?V:void 0)??new Float32Array(V.length),m.projectNormalToPCPF(V,W,Q,K,R,P)?t.transformMat3(P,P,L):(m.logProjectionError(E(),Q,R),P=null));if(!P&&V)return null;null==ba?Q=null:(M=(ba!==M.tangent?ba:void 0)??new Float32Array(ba.length),
m.projectTangentToPCPF(ba,W,Q,K,R,M)?(t.transformMat3(M,M,L,4),Q=M):(m.logProjectionError(E(),Q,R),Q=null));return!Q&&ba?null:{position:O,normal:P,tangent:Q}}function B({vertexAttributes:M,spatialReference:Q,transform:O},{origin:K},L,P){const R=r(Q,P);if(!l.computeTranslationToOriginAndRotation(Q,K,F,R))return m.logProjectionError(E(),Q,R),null;O&&e.multiply(F,F,O.localMatrix);if(!l.computeTranslationToOriginAndRotation(Q,L,G,R))return m.logProjectionError(E(),R,Q),null;e.invert(G,G);O=e.multiply(F,
G,F);A(O,Q,P,N.SOURCE_AND_TARGET);return z(M,O)}function z(M,Q){const O=new Float64Array(M.position.length);t.transformMat4(O,M.position,Q);const K=M.normal?new Float32Array(M.normal.length):null,L=M.tangent?new Float32Array(M.tangent.length):null;K&&M.normal&&m.transformNormal(M.normal,K,Q);L&&M.tangent&&m.transformTangent(M.tangent,L,Q);return{position:O,normal:K,tangent:L}}function A(M,Q,O,K){Q=C(Q,O,K);n.floatEqualUlp(Q,1)||e.scale(M,M,[Q,Q,Q])}function C(M,Q,O){const K=!!(O&N.SOURCE);O=!!(O&
N.TARGET);const L=Q?.sourceUnit;Q=Q?.targetUnit;if(!L&&!Q)return 1;let P=H(L,M);K||!L||n.floatEqualUlp(P,1)||(E().warn("source unit conversion not supported"),P=1);M=1/H(Q,M);O||!Q||n.floatEqualUlp(M,1)||(E().warn("target unit conversion not supported"),M=1);return P*M}function H(M,Q){if(null==M)return 1;Q=k.getMetersPerCartesianUnitForSR(Q);return 1/k.convertUnit(Q,"meters",M)}const E=()=>b.getLogger("esri.geometry.support.meshUtils.vertexSpaceConversion"),F=g.create(),G=g.create(),D=h.create(),
I=f.create(),J=g.create();var N;(function(M){M[M.NONE=0]="NONE";M[M.SOURCE=1]="SOURCE";M[M.TARGET=2]="TARGET";M[M.SOURCE_AND_TARGET=3]="SOURCE_AND_TARGET"})(N||={});a.convertVertexSpace=function(M,Q,O){const {vertexSpace:K,transform:L,vertexAttributes:P}=M,R=x.isRelativeVertexSpace(K)?L:null,W=C(M.spatialReference,O,N.SOURCE_AND_TARGET);if(x.vertexSpaceEquals(K,Q)&&(!R||e.exactEquals(R.localMatrix,g.IDENTITY))&&n.floatEqualUlp(W,1)){const {position:V,normal:ba,tangent:U}=P;M=O?.allowBufferReuse;return{position:M?
V:V.slice(),normal:M?ba:ba?.slice(),tangent:M?U:U?.slice()}}switch(M.vertexSpace.type){case "local":return"local"===Q.type?B(M,M.vertexSpace,Q.origin,O):v(M,M.vertexSpace,Q.origin,O);case "georeferenced":return"local"===Q.type?y(M,M.vertexSpace,Q.origin,O):q(M,M.vertexSpace,Q.origin,O)}};a.getUnitToSpatialReferenceScaleConversion=H;a.projectPointToVertexSpace=function(M,Q,{vertexSpace:O,spatialReference:K}){if("georeferenced"===O.type){if(!w.projectPointToVector(Q,M,K))return!1;({origin:K}=O);d.subtract(M,
M,K);return!0}const L=c.getSphericalPCPF(K);if(!w.projectPointToVector(Q,M,L))return!1;({origin:Q}=O);if(!l.computeTranslationToOriginAndRotation(K,Q,J,L))return!1;K=e.invert(J,J);if(null==K)return!1;d.transformMat4(M,M,K);return!0};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/meshUtils/extent":function(){define("exports ../../../core/libs/gl-matrix-2/factories/mat4f64 ../../Extent ../../projection ../../spatialReferenceEllipsoidUtils ../../projection/computeTranslationToOriginAndRotation ../../projection/projectBuffer ../aaBoundingBox ../DoubleArray ../meshVertexSpaceUtils ../../../chunks/vec3".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c){const l=b.create(),w=d.newDoubleArray(24);a.computeMeshExtent=function(x){const {spatialReference:u,vertexSpace:t,untransformedBounds:m}=x,q=g.toCorners(m,w);f.isRelativeVertexSpace(t)&&x.transform&&c.transformMat4(q,q,x.transform.localMatrix);if("georeferenced"===t.type)return(x=t.origin)&&c.translate(q,q,x),g.toExtent(g.fromBuffer(q),u);x=p.getSphericalPCPF(u);const r=t.origin;if(!k.canProjectWithoutEngine(x,u)){const [v,y,B]=r;return new n({xmin:v,ymin:y,zmin:B,
xmax:v,ymax:y,zmax:B,spatialReference:u})}h.computeTranslationToOriginAndRotation(u,r,l,x);c.transformMat4(q,q,l);e.projectBuffer(q,x,0,q,u,0);return g.toExtent(g.fromBuffer(q),u)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/meshUtils/loadExternal":function(){define("require exports ../../../core/Error ../../../core/promiseUtils ../../../core/urlUtils ../../Point".split(" "),function(a,b,n,k,p,h){function e(v){const y=p.removeFile(v.url);return B=>{var z=
p.makeRelative(B,y,y);return((z=z?z.replace(/^ *\.\//,""):null)?v.files.get(z):null)??B}}async function g(v,y){if(Array.isArray(v)){if(!v.length)throw new n("mesh-load-external:missing-assets","There must be at least one file to load");return v[0]instanceof File?f(v):c(v,y)}return r.fromBlob(v,x(v.name,v.type))}async function d(v,y){const {parts:B,assetMimeType:z,assetName:A}=v;if(1===B.length)return new r(B[0].partUrl);v=await v.toBlob(y);k.throwIfAborted(y);return r.fromBlob(v,x(A,z))}function f(v){v=
v.map(y=>({name:y.name,mimeType:y.type,source:r.fromBlob(y,x(y.name,y.type))}));return w(v)}async function c(v,y){v=await k.allSettledValues(v.map(async B=>{const z=await d(B);k.throwIfAborted(y);return{name:B.assetName,mimeType:B.assetMimeType,source:z}}));if(k.isAborted(y))throw v.forEach(B=>B.source.dispose()),k.createAbortError();return w(v)}function l({mimeType:v,source:y,name:B}){return u.test(v)||m.test(B)?{url:y.url,type:"gltf"}:t.test(v)||q.test(B)?{url:y.url,type:"glb"}:null}function w(v){const y=
new Map;var B=null;let z=null;for(const A of v){const {source:C,name:H}=A;B??=l(A);"ESRI3DO_NORM.glb"===H&&(z=l(A));y.set(H,C.url);C.files.forEach((E,F)=>y.set(F,E))}B=z??B;if(null==B)throw new n("mesh-load-external:missing-files","Missing files to load external mesh source");return new r(B.url,()=>v.forEach(({source:A})=>A.dispose()),y,B.type)}function x(v,y){return u.test(y)||m.test(v)?"gltf":t.test(y)||m.test(v)?"glb":void 0}const u=/^model\/gltf\+json$/,t=/^model\/gltf-binary$/,m=/\.gltf$/i,q=
/\.glb$/i;class r{constructor(v,y=()=>{},B=new Map,z){this.url=v;this.dispose=y;this.files=B;this.type=z}static fromBlob(v,y){const B=URL.createObjectURL(v);return new r(B,()=>URL.revokeObjectURL(B),void 0,y)}}b.loadExternal=async function(v,y,B){const {source:z}=y,{loadGLTFMesh:A}=await k.whenOrAbort(new Promise((F,G)=>a(["./loadGLTFMesh"],F,G)),B),C=await g(z,B);k.throwIfAborted(B);y=A(new h({x:0,y:0,z:0,spatialReference:v.spatialReference}),C.url,{resolveFile:e(C),signal:B?.signal,expectedType:C.type,
unitConversionDisabled:y.unitConversionDisabled});y.then(()=>C.dispose(),()=>C.dispose());const {vertexAttributes:H,components:E}=await y;v.vertexAttributes=H;v.components=E};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/meshUtils/Metadata":function(){define("exports ../../../chunks/tslib.es6 ../../../core/Clonable ../../../core/Collection ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ./External".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c){a.Metadata=class extends n.Clonable{constructor(l){super(l);this.externalSources=new k;this._explicitDisplaySource=null;this.georeferenced=!1;this.addHandles(p.on(()=>this.externalSources,"after-remove",({item:w})=>{w===this._explicitDisplaySource&&(this._explicitDisplaySource=null)},{sync:!0,onListenerRemove:()=>this._explicitDisplaySource=null}))}get displaySource(){return this._explicitDisplaySource??this._implicitDisplaySource}set displaySource(l){if(null!=l&&!c.isDisplayExternal(l))throw Error("Cannot use this source for display: it is not in a supported format.");
(this._explicitDisplaySource=l)&&this.externalSources.every(w=>!c.externalSourcesAreEqual(w,l))&&this.externalSources.add(l)}clearSources(){this.externalSources.removeAll()}getExternalSourcesOnService(l){return this.externalSources.items.filter(w=>c.externalIsOnService(w,l))}get _implicitDisplaySource(){return this.externalSources.find(c.isDisplayExternal)}};b.__decorate([h.property()],a.Metadata.prototype,"externalSources",void 0);b.__decorate([h.property()],a.Metadata.prototype,"displaySource",
null);b.__decorate([h.property()],a.Metadata.prototype,"_implicitDisplaySource",null);b.__decorate([h.property()],a.Metadata.prototype,"_explicitDisplaySource",void 0);b.__decorate([h.property()],a.Metadata.prototype,"georeferenced",void 0);a.Metadata=b.__decorate([f.subclass("esri.geometry.support.meshUtils.Metadata")],a.Metadata);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/meshUtils/primitives":function(){define("exports ../../../core/libs/gl-matrix-2/factories/mat3f64 ../../../chunks/vec32 ../../../core/libs/gl-matrix-2/factories/vec3f64 ../MeshComponent ../MeshVertexAttributes ../meshVertexSpaceUtils ./vertexSpaceConversion".split(" "),
function(a,b,n,k,p,h,e,g){var d=[-.5,-.5,0,.5,-.5,0,.5,.5,0,-.5,.5,0],f=[0,0,1,0,0,1,0,0,1,0,0,1],c=[0,1,1,1,1,0,0,0],l=[0,1,2,0,2,3],w={east:[3,1,2],west:[-3,-1,2],north:[-1,3,2],south:[1,-3,2],up:[1,2,3],down:[1,-2,-3]};const x={faceDescriptions:[{axis:[0,-1,0],uvOrigin:[0,.625],corners:[[-1,-1],[1,-1],[1,1],[-1,1]]},{axis:[1,0,0],uvOrigin:[.25,.625],corners:[[-1,-1],[1,-1],[1,1],[-1,1]]},{axis:[0,1,0],uvOrigin:[.5,.625],corners:[[1,-1],[-1,-1],[-1,1],[1,1]]},{axis:[-1,0,0],uvOrigin:[.75,.625],
corners:[[1,-1],[-1,-1],[-1,1],[1,1]]},{axis:[0,0,1],uvOrigin:[0,.375],corners:[[-1,-1],[1,-1],[1,1],[-1,1]]},{axis:[0,0,-1],uvOrigin:[0,.875],corners:[[-1,1],[1,1],[1,-1],[-1,-1]]}],uvScales:[[0,0],[1,0],[1,1],[0,1]],faceVertexOffsets:[0,1,2,0,2,3]},u={south:0,east:1,north:2,west:3,up:4,down:5},t=k.create(),m=b.create();a.boxFaceOrder=u;a.convertPlaneSizeParameter=function(q,r){const v="number"===typeof r?r:null!=r?r.width:1;r="number"===typeof r?r:null!=r?r.height:1;switch(q){case "up":case "down":return{width:v,
depth:r};case "north":case "south":return{width:v,height:r};case "east":case "west":return{depth:v,height:r}}};a.convertUnitGeometry=function(q,r,v){if(!q.isPlane)for(var y=0;y<q.position.length;y+=3)q.position[y+2]+=.5;y=v?.size;var B=g.getUnitToSpatialReferenceScaleConversion(v?.unit,r.spatialReference);null==y&&1===B?y=null:null==y?y=[B,B,B]:"number"===typeof y?(y*=B,y=[y,y,y]):y=[null!=y.width?y.width*B:B,null!=y.depth?y.depth*B:B,null!=y.height?y.height*B:B];if(null!=y){m[0]=y[0];m[4]=y[1];m[8]=
y[2];for(B=0;B<q.position.length;B+=3){for(var z=0;3>z;z++)t[z]=q.position[B+z];n.transformMat3(t,t,m);for(z=0;3>z;z++)q.position[B+z]=t[z]}if(y[0]!==y[1]||y[1]!==y[2])for(m[0]=1/y[0],m[4]=1/y[1],m[8]=1/y[2],y=0;y<q.normal.length;y+=3){for(B=0;3>B;B++)t[B]=q.normal[y+B];n.transformMat3(t,t,m);n.normalize(t,t);for(B=0;3>B;B++)q.normal[y+B]=t[B]}}y=e.selectVertexSpace(r,v);B=r.spatialReference.isGeographic?e.selectVertexSpace(r):y;B=g.convertVertexSpace({vertexAttributes:q,vertexSpace:B,spatialReference:r.spatialReference},
y,{allowBufferReuse:!0});return{vertexAttributes:new h.MeshVertexAttributes({...B,uv:q.uv}),vertexSpace:y,components:[new p({faces:q.faces,material:v?.material||null})],spatialReference:r.spatialReference}};a.createUnitSizeBox=function(){const {faceDescriptions:q,faceVertexOffsets:r,uvScales:v}=x;var y=4*q.length;const B=new Float64Array(3*y),z=new Float32Array(3*y);y=new Float32Array(2*y);const A=new Uint32Array(6*q.length);let C=0,H=0,E=0,F=0;for(let D=0;D<q.length;D++){const I=q[D];var G=C/3;for(const J of r)A[F++]=
G+J;G=I.corners;for(let J=0;4>J;J++){const N=G[J];let M=0;y[E++]=.25*v[J][0]+I.uvOrigin[0];y[E++]=I.uvOrigin[1]-.25*v[J][1];for(let Q=0;3>Q;Q++)0!==I.axis[Q]?(B[C++]=.5*I.axis[Q],z[H++]=I.axis[Q]):(B[C++]=.5*N[M++],z[H++]=0)}}return{position:B,normal:z,uv:y,faces:A}};a.createUnitSizeCylinder=function(q=0){q=Math.round(16*2**q);var r=4*(q+1)+2*q;const v=new Float64Array(3*r),y=new Float32Array(3*r);r=new Float32Array(2*r);const B=new Uint32Array(12*q);let z=0,A=0,C=0,H=0,E=0;for(let G=0;5>=G;G++){const D=
0===G||5===G,I=1>=G||4<=G,J=2===G||4===G,N=D?q-1:q;for(let M=0;M<=N;M++){var F=M/N*2*Math.PI;const Q=D?0:.5;t[0]=Q*Math.sin(F);t[1]=Q*-Math.cos(F);t[2]=2>=G?.5:-.5;for(F=0;3>F;F++)v[z++]=t[F],I?y[A++]=2===F?1>=G?1:-1:0:y[A++]=2===F?0:t[F]/Q;r[C++]=(M+(D?.5:0))/q;1>=G?r[C++]=1*G/3:3>=G?r[C++]=(G-2)/3+1/3:r[C++]=(G-4)/3+2/3;J||0===G||M===q||(5!==G&&(B[H++]=E,B[H++]=E+1,B[H++]=E-q),1!==G&&(B[H++]=E,B[H++]=E-q,B[H++]=E-q-1));E++}}return{position:v,normal:y,uv:r,faces:B}};a.createUnitSizePlane=function(q){q=
w[q];const r=new Float64Array(d.length),v=new Float32Array(f.length);let y=0;for(let z=0;4>z;z++){const A=y;for(let C=0;3>C;C++){var B=q[C];const H=Math.abs(B)-1;B=0<=B?1:-1;r[y]=d[A+H]*B;v[y]=f[A+H]*B;y++}}return{position:r,normal:v,uv:new Float32Array(c),faces:new Uint32Array(l),isPlane:!0}};a.createUnitSizeSphere=function(q=0){q=Math.round(8*2**q);const r=2*q;var v=(q-1)*(r+1)+2*r;const y=new Float64Array(3*v),B=new Float32Array(3*v);v=new Float32Array(2*v);const z=new Uint32Array((q-1)*r*6);let A=
0,C=0,H=0,E=0;for(let D=0;D<=q;D++){var F=D/q*Math.PI+.5*Math.PI;const I=Math.cos(F);t[2]=Math.sin(F);const J=(F=0===D||D===q)?r-1:r;for(let N=0;N<=J;N++){var G=N/J*2*Math.PI;t[0]=-Math.sin(G)*I;t[1]=Math.cos(G)*I;for(G=0;3>G;G++)y[A]=.5*t[G],B[A]=t[G],++A;v[C++]=(N+(F?.5:0))/r;v[C++]=D/q;0!==D&&N!==r&&(D!==q&&(z[H++]=E,z[H++]=E+1,z[H++]=E-r),1!==D&&(z[H++]=E,z[H++]=E-r,z[H++]=E-r-1));E++}}return{position:y,normal:B,uv:v,faces:z}};a.extractSingleFaceOfBox=function(q,r){const v=q.components[0];var y=
v.faces,B=u[r],z=6*B;r=Array(6);const A=Array(y.length-6);var C=0;let H=0;for(let E=0;E<y.length;E++)E>=z&&E<z+6?r[C++]=y[E]:A[H++]=y[E];if(null!=q.vertexAttributes.uv){y=new Float32Array(q.vertexAttributes.uv);B*=8;z=[0,1,1,1,1,0,0,0];for(C=0;C<z.length;C++)y[B+C]=z[C];q.vertexAttributes.uv=y}q.components=[new p({faces:r,material:v.material}),new p({faces:A})];return q};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/meshUtils/rotate":function(){define("exports ../../../core/Logger ../../../core/libs/gl-matrix-2/math/mat3 ../../../core/libs/gl-matrix-2/factories/mat3f64 ../../../core/libs/gl-matrix-2/math/mat4 ../../../core/libs/gl-matrix-2/factories/mat4f64 ../../../core/libs/gl-matrix-2/math/quat ../../../core/libs/gl-matrix-2/factories/quatf64 ../../../chunks/vec32 ../../../core/libs/gl-matrix-2/factories/vec3f64 ../../Point ../../spatialReferenceEllipsoidUtils ../../projection/computeTranslationToOriginAndRotation ../../projection/projectPointToVector ../axisAngleDegrees ../MeshTransform ../meshVertexSpaceUtils ./geographicUtils ./projection ./vertexSpaceConversion".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w,x,u,t,m,q,r,v){function y(D,I,J,N=f.ZEROS){if(null!=D)for(p.fromRotation(H,u.angleRad(I),u.axis(I)),I=0;I<D.length;I+=J){for(var M=0;3>M;M++)z[M]=D[I+M]-N[M];d.transformMat4(z,z,H);for(M=0;3>M;M++)D[I+M]=z[M]+N[M]}}const B=()=>b.getLogger("esri.geometry.support.meshUtils.rotate"),z=f.create(),A=h.create(),C=u.create(),H=h.create(),E=k.create(),F=f.create(),G=g.create();a.rotate=function(D,I,J){if(D.vertexAttributes?.position&&0!==I[3]){var {spatialReference:N,vertexSpace:M}=
D,Q=J?.origin??D.origin;J=q.performGlobalOperation(B,M,N,J?.geographic);if(m.isMeshWithRelativeVertexSpace(D))a:{D.transform??(D.transform=new t);const {vertexSpace:K,transform:L,spatialReference:P}=D,[R,W,V]=K.origin;J=new c({x:R,y:W,z:V,spatialReference:P});var O=z;if(J.equals(Q))d.set(O,0,0,0);else if(!v.projectPointToVertexSpace(O,Q,D)){r.logProjectionError(B(),Q.spatialReference,P,r.loadProjectErrorMessage);break a}e.setAxisAngle(G,u.axis(I),u.angleRad(I));D=p.fromRotationTranslationScaleOrigin(A,
G,f.ZEROS,f.ONES,O);({localMatrix:I}=L);D=p.multiply(A,D,I);L.scale=p.getScaling(f.create(),D);p.scale(D,D,d.inverse(z,L.scale));I=L.rotationAxis;L.rotation=u.fromMatrix(D);0===L.rotationAngle&&(L.rotationAxis=I);L.translation=p.getTranslation(f.create(),D)}else if(J)a:{J=D.spatialReference;O=l.getSphericalPCPF(J);if(!x.projectPointToVector(Q,F,O)&&(r.logProjectionError(B(),Q.spatialReference,O,"Falling back to mesh origin"),!x.projectPointToVector(D.origin,F,O))){r.logProjectionError(B(),D.origin.spatialReference,
O);break a}Q=D.vertexAttributes.position;const K=D.vertexAttributes.normal,L=D.vertexAttributes.tangent,P=new Float64Array(Q.length),R=null!=K?new Float32Array(K.length):null,W=null!=L?new Float32Array(L.length):null;w.computeTranslationToOriginAndRotation(O,F,H,O);n.fromMat4(E,H);d.transformMat3(u.axis(C),u.axis(I),E);C[3]=I[3];if(r.projectToPCPF(Q,J,P,O))if(null==K||null==R||r.projectNormalToPCPF(K,Q,J,P,O,R))if(null==L||null==W||r.projectTangentToPCPF(L,Q,J,P,O,W))if(y(P,C,3,F),r.projectFromPCPF(P,
O,Q,J)){if(null!=K&&null!=R&&(y(R,C,3),!r.projectNormalFromPCPF(R,Q,J,P,O,K))){r.logProjectionError(B(),O,J);break a}if(null!=L&&null!=W&&(y(W,C,4),!r.projectTangentFromPCPF(W,Q,J,P,O,L))){r.logProjectionError(B(),O,J);break a}D.vertexAttributesChanged()}else r.logProjectionError(B(),O,J);else r.logProjectionError(B(),J,O);else r.logProjectionError(B(),J,O);else r.logProjectionError(B(),J,O)}else x.projectPointToVector(Q,F,D.spatialReference)?(y(D.vertexAttributes.position,I,3,F),y(D.vertexAttributes.normal,
I,3),y(D.vertexAttributes.tangent,I,4),D.vertexAttributesChanged()):(I=D.origin,F[0]=I.x,F[1]=I.y,F[2]=I.z,r.logProjectionError(B(),Q.spatialReference,D.spatialReference,r.loadProjectErrorMessage))}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/meshUtils/scale":function(){define("exports ../../../core/Logger ../../../core/libs/gl-matrix-2/math/mat4 ../../../core/libs/gl-matrix-2/factories/mat4f64 ../../../core/libs/gl-matrix-2/factories/quatf64 ../../../chunks/vec32 ../../../core/libs/gl-matrix-2/factories/vec3f64 ../../Point ../../spatialReferenceEllipsoidUtils ../../projection/projectPointToVector ../axisAngleDegrees ../MeshTransform ../meshVertexSpaceUtils ./geographicUtils ./projection ./vertexSpaceConversion".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w,x,u,t){function m(z,A,C=e.ZEROS){if(z)for(let E=0;E<z.length;E+=3){for(var H=0;3>H;H++)r[H]=z[E+H]-C[H];h.scale(r,r,A);for(H=0;3>H;H++)z[E+H]=r[H]+C[H]}}const q=()=>b.getLogger("esri.geometry.support.meshUtils.scale"),r=e.create(),v=e.create(),y=k.create(),B=e.create();a.scale=function(z,A,C){if(z.vertexAttributes?.position){var {vertexSpace:H,spatialReference:E}=z,F=C?.origin??z.origin;C=x.performGlobalOperation(q,H,E,C?.geographic);if(w.isMeshWithRelativeVertexSpace(z))a:{z.transform??
(z.transform=new l);const {vertexSpace:D,transform:I,spatialReference:J}=z,[N,M,Q]=D.origin;var G=new g({x:N,y:M,z:Q,spatialReference:J});C=r;if(G.equals(F))h.set(C,0,0,0);else if(!t.projectPointToVertexSpace(C,F,z)){u.logProjectionError(q(),F.spatialReference,J,u.loadProjectErrorMessage);break a}z=h.set(v,A,A,A);z=n.fromRotationTranslationScaleOrigin(y,p.IDENTITY,e.ZEROS,z,C);({localMatrix:A}=I);z=n.multiply(y,z,A);I.scale=n.getScaling(e.create(),z);n.scale(z,z,h.inverse(r,I.scale));A=I.rotationAxis;
I.rotation=c.fromMatrix(z);0===I.rotationAngle&&(I.rotationAxis=A);I.translation=n.getTranslation(e.create(),z)}else if(C)a:{C=z.spatialReference;G=d.getSphericalPCPF(C);if(!f.projectPointToVector(F,B,G)&&(u.logProjectionError(q(),F.spatialReference,G,"Falling back to mesh origin"),!f.projectPointToVector(z.origin,B,G))){u.logProjectionError(q(),z.origin.spatialReference,G);break a}F=z.vertexAttributes.position;const D=z.vertexAttributes.normal,I=z.vertexAttributes.tangent,J=new Float64Array(F.length),
N=null!=D?new Float32Array(D.length):null,M=null!=I?new Float32Array(I.length):null;u.projectToPCPF(F,C,J,G)?null==D||null==N||u.projectNormalToPCPF(D,F,C,J,G,N)?null==I||null==M||u.projectTangentToPCPF(I,F,C,J,G,M)?(m(J,A,B),u.projectFromPCPF(J,G,F,C)?null==D||null==N||u.projectNormalFromPCPF(N,F,C,J,G,D)?null==I||null==M||u.projectTangentFromPCPF(M,F,C,J,G,I)?z.vertexAttributesChanged():u.logProjectionError(q(),G,C):u.logProjectionError(q(),G,C):u.logProjectionError(q(),G,C)):u.logProjectionError(q(),
C,G):u.logProjectionError(q(),C,G):u.logProjectionError(q(),C,G)}else f.projectPointToVector(F,B,z.spatialReference)?(m(z.vertexAttributes.position,A,B),z.vertexAttributesChanged()):(A=z.origin,B[0]=A.x,B[1]=A.y,B[2]=A.z,u.logProjectionError(q(),F.spatialReference,z.spatialReference,u.loadProjectErrorMessage))}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/sources/support/uploadAssetErrors":function(){define(["exports","../../../../core/Error"],function(a,
b){class n extends b{constructor(){super("upload-assets:unsupported","Layer does not support asset uploads.",Error())}}class k extends b{constructor(){super("upload-assets:no-glb-support","Layer does not support glb.",Error())}}class p extends b{constructor(){super("upload-assets:no-supported-source","No supported external source found",Error())}}class h extends b{constructor(){super("upload-assets:not-base-64","Expected gltf data in base64 format after conversion.",Error())}}class e extends b{constructor(){super("upload-assets:unable-to-prepare-options",
"Unable to prepare uploadAsset request options.",Error())}}class g extends b{constructor(x,u){super("upload-assets:bad-response",`Bad response. Uploaded ${x} items and received ${u} results.`,Error())}}class d extends b{constructor(x,u){super("upload-assets-layer:upload-failed",`Failed to upload mesh file ${x}. Error code: ${u?.code??"-1"}. Error message: ${u?.messages??"unknown"}`,Error())}}class f extends b{constructor(x){super("upload-assets-layer:unsupported-format",`The service allowed us to upload an asset of FormatID ${x}, but it does not list it in its supported formats.`,
Error())}}class c extends b{constructor(){super("upload-assets:convert3D-failed","convert3D failed.")}}class l extends b{constructor(){super("invalid-input:no-model","No supported model found")}}class w extends b{constructor(){super("invalid-input:multiple-models","Multiple supported models found")}}a.BadResponseError=g;a.Convert3DFailedError=c;a.MultipleModelsError=w;a.NoGlbSupportError=k;a.NoModelError=l;a.NoSupportedSourceError=p;a.NotBase64Error=h;a.UnableToPrepareOptionsError=e;a.UnsupportedError=
n;a.UnsupportedFormatUploadedError=f;a.UploadFailedError=d;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/mixins/SceneService":function(){define("exports ../../chunks/tslib.es6 ../../request ../../core/Error ../../core/Logger ../../core/promiseUtils ../../core/urlUtils ../../core/accessorSupport/decorators/property ../../core/has ../../core/RandomLCG ../../core/accessorSupport/decorators/reader ../../core/accessorSupport/decorators/subclass ../../core/accessorSupport/decorators/writer ../../core/accessorSupport/originUtils ../../geometry/Extent ../../geometry/HeightModelInfo ../../geometry/SpatialReference ../support/arcgisLayerUrl ../support/commonProperties ../support/I3SIndexInfo ../support/schemaValidatorLoader ../../portal/Portal ../../portal/PortalItem ../../portal/support/jsonContext ../../webdoc/support/resourceUtils ../../webdoc/support/saveUtils".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w,x,u,t,m,q,r,v,y,B,z,A,C,H){function E(I){if(null!=I.spatialReference)return m.fromJSON(I.spatialReference);I=I.store;I=(I=I.indexCRS||I.geographicCRS)&&parseInt(I.slice(I.lastIndexOf("/")+1),10);return null!=I?new m(I):null}function F(I,J,N){I.typeKeywords||(I.typeKeywords=[]);J=J.getTypeKeywords();for(const M of J)I.typeKeywords.push(M);I.typeKeywords&&(I.typeKeywords=I.typeKeywords.filter((M,Q,O)=>O.indexOf(M)===Q),N===G.newItem&&(I.typeKeywords=I.typeKeywords.filter(M=>
"Hosted Service"!==M)))}var G;(function(I){I[I.existingItem=0]="existingItem";I[I.newItem=1]="newItem"})(G||={});const D={getTypeKeywords:()=>[],portalItemLayerType:"unknown",validationOptions:{enabled:!0,ignoreUnsupported:!1,failPolicy:"throw"}};a.SaveOperationType=void 0;(function(I){I[I.SAVE=0]="SAVE";I[I.SAVE_AS=1]="SAVE_AS"})(a.SaveOperationType||(a.SaveOperationType={}));a.SceneService=I=>{I=class extends I{constructor(){super(...arguments);this.heightModelInfo=this.fullExtent=this.spatialReference=
null;this.maxScale=this.minScale=0;this.version={major:Number.NaN,minor:Number.NaN,versionString:""};this.copyright=null;this.sublayerTitleMode="item-title";this.indexInfo=this.layerId=this.title=null;this._debouncedSaveOperations=h.debounce(async(J,N,M)=>{switch(J){case a.SaveOperationType.SAVE:return this._save(N);case a.SaveOperationType.SAVE_AS:return this._saveAs(M,N)}})}readSpatialReference(J,N){return E(N)}readFullExtent(J,N,M){if(null!=J&&"object"===typeof J)return N=null==J.spatialReference?
{...J,spatialReference:E(N)}:J,u.fromJSON(N,M);M=N.store;N=E(N);return null==N||null==M?.extent||!Array.isArray(M.extent)||M.extent.some(Q=>-1E38>Q)?null:new u({xmin:M.extent[0],ymin:M.extent[1],xmax:M.extent[2],ymax:M.extent[3],spatialReference:N})}parseVersionString(J){const N={major:Number.NaN,minor:Number.NaN,versionString:J};J=J.split(".");2<=J.length&&(N.major=parseInt(J[0],10),N.minor=parseInt(J[1],10));return N}readVersion(J,N){J=N.store;return this.parseVersionString(null!=J.version?J.version.toString():
"")}readTitlePortalItem(J){return"item-title"!==this.sublayerTitleMode?void 0:J}readTitleService(J,N){J=this.portalItem?.title;if("item-title"===this.sublayerTitleMode)return this.url?q.titleFromUrlAndName(this.url,N.name):N.name;N=N.name;if(!N&&this.url){const M=q.parse(this.url);null!=M&&(N=M.title)}"item-title-and-service-name"===this.sublayerTitleMode&&J&&(N=J+" - "+N);return q.cleanTitle(N)}set url(J){null==J?this._set("url",J):(J=q.sanitizeUrlWithLayerId({layer:this,url:J,nonStandardUrlAllowed:!1,
logger:p.getLogger(this)}),this._set("url",J.url),null!=J.layerId&&this._set("layerId",J.layerId))}writeUrl(J,N,M,Q){q.writeUrlWithLayerId(this,J,"layers",N,Q)}get parsedUrl(){var J=this._get("url");(J=e.urlToObject(J))&&null!=this.layerId&&(J.path=`${J.path}/layers/${this.layerId}`);return J}async _fetchIndexAndUpdateExtent(J,N){this.indexInfo=v.fetchIndexInfo(this.parsedUrl?.path??"",this.rootNode,J,this.customParameters,this.apiKey,p.getLogger(this),N);null==this.fullExtent||this.fullExtent.hasZ||
this._updateExtent(await this.indexInfo)}_updateExtent(J){if("page"===J?.type){var N=J.rootIndex%J.pageSize;N=J.rootPage?.nodes?.[N];if(null==N?.obb?.center||null==N.obb.halfSize)throw new k("sceneservice:invalid-node-page","Invalid node page.");-1E38>N.obb.center[0]||null==this.fullExtent||this.fullExtent.hasZ||(J=N.obb.halfSize,N=N.obb.center[2],J=Math.sqrt(J[0]*J[0]+J[1]*J[1]+J[2]*J[2]),this.fullExtent.zmin=N-J,this.fullExtent.zmax=N+J)}else if("node"===J?.type&&(N=J.rootNode?.mbs,Array.isArray(N)&&
4===N.length&&!(-1E38>N[0]))){J=N[2];N=N[3];var {fullExtent:M}=this;M&&(M.zmin=J-N,M.zmax=J+N)}}async _fetchService(J){if(null==this.url)throw new k("sceneservice:url-not-set","Scene service can not be loaded without valid portal item or url");if(null==this.layerId&&/SceneServer\/*$/i.test(this.url)){const N=await this._fetchFirstLayerId(J);null!=N&&(this.layerId=N)}return this._fetchServiceLayer(J)}async _fetchFirstLayerId(J){J=await n(this.url??"",{query:{f:"json",...this.customParameters,token:this.apiKey},
responseType:"json",signal:J});if(J.data&&Array.isArray(J.data.layers)&&0<J.data.layers.length)return J.data.layers[0].id}async _fetchServiceLayer(J){J=await n(this.parsedUrl?.path??"",{query:{f:"json",...this.customParameters,token:this.apiKey},responseType:"json",signal:J});J.ssl&&this.url&&(this.url=this.url.replace(/^http:/i,"https:"));let N=!1;J.data.layerType&&"Voxel"===J.data.layerType&&(N=!0);if(N)return this._fetchVoxelServiceLayer();J=J.data;this.read(J,this._getServiceContext());this.validateLayer(J)}async _fetchVoxelServiceLayer(J){J=
(await n(this.parsedUrl?.path+"/layer",{query:{f:"json",...this.customParameters,token:this.apiKey},responseType:"json",signal:J})).data;this.read(J,this._getServiceContext());this.validateLayer(J)}_getServiceContext(){return{origin:"service",portalItem:this.portalItem,portal:this.portalItem?.portal,url:this.parsedUrl}}async _ensureLoadBeforeSave(){await this.load();"beforeSave"in this&&"function"===typeof this.beforeSave&&await this.beforeSave()}validateLayer(J){}async _saveAs(J,N){N={...D,...N};
J=z.from(J);if(!J)throw new k("sceneservice:portal-item-required","_saveAs() requires a portal item to save to");J.id&&(J=J.clone(),J.id=null);const M=J.portal||B.getDefault();await this._ensureLoadBeforeSave();J.type="Scene Service";J.portal=M;const Q=A.createForItemWrite(J,"portal-item",!0),O={layers:[this.write({},Q)]};await Promise.all(Q.resources.pendingOperations??[]);await this._validateAgainstJSONSchema(O,Q,N);this.url&&(J.url=this.url);J.title||(J.title=this.title);F(J,N,G.newItem);await M.signIn();
await M.user.addItem({item:J,folder:N?.folder,data:O});await C.saveResources(this.resourceReferences,Q);this.portalItem=J;x.updateOrigins(Q);return Q.portalItem=J}async _save(J){J={...D,...J};if(!this.portalItem)throw new k("sceneservice:portal-item-not-set","Portal item to save to has not been set on this SceneService");if("Scene Service"!==this.portalItem.type)throw new k("sceneservice:portal-item-wrong-type",'Portal item needs to have type "Scene Service"');await this._ensureLoadBeforeSave();const N=
A.createForItemWrite(this.portalItem,"portal-item",!0),M={layers:[this.write({},N)]};await Promise.all(N.resources.pendingOperations??[]);await this._validateAgainstJSONSchema(M,N,J);this.url&&(this.portalItem.url=this.url);this.portalItem.title||(this.portalItem.title=this.title);F(this.portalItem,J,G.existingItem);await C.updateItemWithResources(this.portalItem,M,this.resourceReferences,N);x.updateOrigins(N);return this.portalItem}async _validateAgainstJSONSchema(J,N,M){var Q=M?.validationOptions;
H.evaluateWriteErrors(N,{errorName:"sceneservice:save"},{ignoreUnsupported:Q?.ignoreUnsupported,supplementalUnsupportedErrors:["scenemodification:unsupported"]});N=Q?.enabled;const O=y.getLoader();if(N&&O&&(M=(await O()).validate(J,M.portalItemLayerType),M.length&&(J=`Layer item did not validate:\n${M.join("\n")}`,p.getLogger(this).error(`_validateAgainstJSONSchema(): ${J}`),"throw"===Q.failPolicy)))throw Q=M.map(K=>new k("sceneservice:schema-validation",K)),new k("sceneservice-validate:error","Failed to save layer item due to schema validation, see `details.errors`.",
{validationErrors:Q});}};b.__decorate([g.property(r.id)],I.prototype,"id",void 0);b.__decorate([g.property({type:m})],I.prototype,"spatialReference",void 0);b.__decorate([c.reader("spatialReference",["spatialReference","store.indexCRS","store.geographicCRS"])],I.prototype,"readSpatialReference",null);b.__decorate([g.property({type:u})],I.prototype,"fullExtent",void 0);b.__decorate([c.reader("fullExtent",["fullExtent","store.extent","spatialReference","store.indexCRS","store.geographicCRS"])],I.prototype,
"readFullExtent",null);b.__decorate([g.property({readOnly:!0,type:t})],I.prototype,"heightModelInfo",void 0);b.__decorate([g.property({type:Number,json:{name:"layerDefinition.minScale",write:!0,origins:{service:{read:{source:"minScale"},write:!1}}}})],I.prototype,"minScale",void 0);b.__decorate([g.property({type:Number,json:{name:"layerDefinition.maxScale",write:!0,origins:{service:{read:{source:"maxScale"},write:!1}}}})],I.prototype,"maxScale",void 0);b.__decorate([g.property({readOnly:!0})],I.prototype,
"version",void 0);b.__decorate([c.reader("version",["store.version"])],I.prototype,"readVersion",null);b.__decorate([g.property({type:String,json:{read:{source:"copyrightText"}}})],I.prototype,"copyright",void 0);b.__decorate([g.property({type:String,json:{read:!1}})],I.prototype,"sublayerTitleMode",void 0);b.__decorate([g.property({type:String})],I.prototype,"title",void 0);b.__decorate([c.reader("portal-item","title")],I.prototype,"readTitlePortalItem",null);b.__decorate([c.reader("service","title",
["name"])],I.prototype,"readTitleService",null);b.__decorate([g.property({type:Number,json:{origins:{service:{read:{source:"id"}},"portal-item":{write:{target:"id",isRequired:!0,ignoreOrigin:!0},read:!1}}}})],I.prototype,"layerId",void 0);b.__decorate([g.property(r.url)],I.prototype,"url",null);b.__decorate([w.writer("url")],I.prototype,"writeUrl",null);b.__decorate([g.property()],I.prototype,"parsedUrl",null);b.__decorate([g.property({readOnly:!0})],I.prototype,"store",void 0);b.__decorate([g.property({type:String,
readOnly:!0,json:{read:{source:"store.rootNode"}}})],I.prototype,"rootNode",void 0);return I=b.__decorate([l.subclass("esri.layers.mixins.SceneService")],I)};a.sceneServiceItemType="Scene Service";Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/accessorSupport/originUtils":function(){define(["exports","../multiOriginJSONSupportUtils"],function(a,b){a.updateOrigins=function(n){n?.writtenProperties&&n.writtenProperties.forEach(({target:k,propName:p,newOrigin:h})=>{b.isMultiOriginJSONMixin(k)&&
h&&k.originOf(p)!==h&&k.updateOrigin(p,h)})};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/multiOriginJSONSupportUtils":function(){define(["exports"],function(a){a.isMultiOriginJSONMixin=function(b){return b&&"getAtOrigin"in b&&"originOf"in b};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/I3SIndexInfo":function(){define(["exports","../../request","../../core/Error"],function(a,b,n){a.fetchIndexInfo=async function(k,p,h,e,g,d,f){var c=
null;if(null!=h){c=`${k}/nodepages/`;const l=c+Math.floor(h.rootIndex/h.nodesPerPage);try{return{type:"page",rootPage:(await b(l,{query:{f:"json",...e,token:g},responseType:"json",signal:f})).data,rootIndex:h.rootIndex,pageSize:h.nodesPerPage,lodMetric:h.lodSelectionMetricType,urlPrefix:c}}catch(w){null!=d&&d.warn("#fetchIndexInfo()","Failed to load root node page. Falling back to node documents.",l,w),c=w}}if(!p)return null;p=p?.split("/").pop();k=`${k}/nodes/`;p=k+p;try{return{type:"node",rootNode:(await b(p,
{query:{f:"json",...e,token:g},responseType:"json",signal:f})).data,urlPrefix:k}}catch(l){throw new n("sceneservice:root-node-missing","Root node missing.",{pageError:c,nodeError:l,url:p});}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/schemaValidatorLoader":function(){define(["exports"],function(a){let b=null;a.getLoader=function(){return b};a.registerLoader=function(n){b=n};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/portal/support/jsonContext":function(){define(["exports",
"../../core/urlUtils","../Portal"],function(a,b,n){function k(p,h){return{origin:h,url:b.urlToObject(p.itemUrl),portal:p.portal||n.getDefault(),portalItem:p}}a.createForItemRead=function(p,h){return{...k(p,h),readResourcePaths:[]}};a.createForItemWrite=function(p,h,e){const g=b.urlToObject(p.itemUrl);return{...k(p,h),messages:[],writtenProperties:[],blockedRelativeUrls:[],verifyItemRelativeUrls:g?{rootPath:g.path,writtenUrls:[]}:null,resources:e?{toAdd:[],toUpdate:[],toKeep:[],pendingOperations:[]}:
null}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/webdoc/support/resourceUtils":function(){define("require exports ../../core/Error ../../core/promiseUtils ../../core/uuid ../../portal/support/resourceUtils".split(" "),function(a,b,n,k,p,h){async function e(d,f,c){if(f?.resources){var l=f.portalItem===d.portalItem?new Set(d.paths):new Set;d.paths.length=0;d.portalItem=f.portalItem;var w=new Set(f.resources.toKeep.map(r=>r.resource.path)),x=new Set,u=[];w.forEach(r=>{l.delete(r);
d.paths.push(r)});var t=[],m=[],q=[];for(const r of f.resources.toUpdate)if(l.delete(r.resource.path),w.has(r.resource.path)||x.has(r.resource.path)){const {resource:v,content:y,finish:B}=r,z=h.getSiblingOfSameTypeI(v,p.generateUUID());d.paths.push(z.path);t.push({resource:z,content:await h.contentToBlob(y),compress:r.compress});B&&q.push(()=>B(z))}else{d.paths.push(r.resource.path);m.push({resource:r.resource,content:await h.contentToBlob(r.content),compress:r.compress});const v=r.finish;v&&q.push(()=>
v(r.resource));x.add(r.resource.path)}for(const r of f.resources.toAdd)if(d.paths.push(r.resource.path),l.has(r.resource.path))l.delete(r.resource.path);else{t.push({resource:r.resource,content:await h.contentToBlob(r.content),compress:r.compress});const v=r.finish;v&&q.push(()=>v(r.resource))}if(t.length||m.length)({addOrUpdateResources:w}=await new Promise((r,v)=>a(["../../portal/support/resourceUtils"],r,v))),await w(f.portalItem,t,"add",c),await w(f.portalItem,m,"update",c);q.forEach(r=>r());
if(0===u.length)return l;f=await k.allSettledErrors(u);k.throwIfAborted(c);if(0<f.length)throw new n("save:resources","Failed to save one or more resources",{errors:f});return l}}async function g(d,f,c){if(d&&f.portalItem){var l=[];for(const w of d)d=f.portalItem.resourceFromPath(w),l.push(d.portalItem.removeResource(d,c));await k.eachAlways(l)}}b.saveResources=async function(d,f,c){d=await e(d,f,c);await g(d,f,c)};b.updateItemWithResources=async function(d,f,c,l,w){c=await e(c,l,w);await d.update({data:f});
await g(c,l,w)};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/portal/support/resourceUtils":function(){define(["exports","../../request","../../core/Error","../../core/urlUtils"],function(a,b,n,k){function p(e){const g=e.lastIndexOf("/");return-1===g?[".",e]:[e.slice(0,g),e.slice(g+1)]}function h(e){{const l=k.getPathExtension(e);e=null==l?[e,""]:[e.slice(0,e.length-l.length-1),`.${l}`]}const [g,d]=e,[f,c]=p(g);return[f,c,d]}a.addOrUpdateResources=async function(e,g,d,f){var c=
new Map;for(const {resource:l,content:w,compress:x,access:u}of g){if(!l.hasPath())throw new n(`portal-item-resource-${d}:invalid-path`,"Resource does not have a valid path");const [t,m]=p(l.path);g=`${t}/${x??""}/${u??""}`;c.has(g)||c.set(g,{prefix:t,compress:x,access:u,files:[]});c.get(g).files.push({fileName:m,content:w})}await e.load(f);d=k.join(e.userItemUrl,"add"===d?"addResources":"updateResources");for(const {prefix:l,compress:w,access:x,files:u}of c.values())for(c=0;c<u.length;c+=25){g=u.slice(c,
c+25);const t=new FormData;l&&"."!==l&&t.append("resourcesPrefix",l);w&&t.append("compress","true");x&&t.append("access",x);let m=0;for(const {fileName:q,content:r}of g)t.append(`file${++m}`,r,q);t.append("f","json");await e.portal.request(d,{method:"post",body:t,signal:f?.signal})}};a.contentToBlob=async function(e){return"blob"===e.type?e.blob:"json"===e.type?new Blob([e.jsonString],{type:"application/json"}):(await b(e.url,{responseType:"blob"})).data};a.fetchResources=async function(e,g={},d){await e.load(d);
const f=k.join(e.itemUrl,"resources"),{start:c=1,num:l=10,sortOrder:w="asc",sortField:x="resource"}=g;g=await e.portal.request(f,{query:{start:c,num:l,sortOrder:w,sortField:x,token:e.apiKey},signal:d?.signal});return{total:g.total,nextStart:g.nextStart,resources:g.resources.map(({created:u,size:t,resource:m})=>({created:new Date(u),size:t,resource:e.resourceFromPath(m)}))}};a.getSiblingOfSameType=function(e,g){if(!e.hasPath())return null;const [d,,f]=h(e.path);return e.portalItem.resourceFromPath(k.join(d,
g+f))};a.getSiblingOfSameTypeI=function(e,g){if(!e.hasPath())return null;const [d,,f]=h(e.path);return e.portalItem.resourceFromPath(k.join(d,g+f))};a.removeAllResources=async function(e,g){await e.load(g);const d=k.join(e.userItemUrl,"removeResources");return e.portal.request(d,{method:"post",query:{deleteAll:!0},signal:g?.signal})};a.removeResource=async function(e,g,d){if(!g.hasPath())throw new n("portal-item-resources-remove:invalid-path","Resource does not have a valid path");await e.load(d);
const f=k.join(e.userItemUrl,"removeResources");await e.portal.request(f,{method:"post",query:{resource:g.path},signal:d?.signal});g.portalItem=null};a.splitPrefixFileNameAndExtension=h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/webdoc/support/saveUtils":function(){define(["exports","../../core/Error"],function(a,b){const n=new Set(["layer:unsupported","property:unsupported","symbol:unsupported","symbol-layer:unsupported","url:unsupported"]);a.beforeSave=async function(k){const p=
[];for(const h of k.allLayers)"beforeSave"in h&&"function"===typeof h.beforeSave&&(k=h.beforeSave())&&p.push(k);await Promise.allSettled(p)};a.evaluateWriteErrors=function(k,p,h){let e=(k.messages??[]).filter(({type:g})=>"error"===g).map(({name:g,message:d,details:f})=>new b(g,d,f));k.blockedRelativeUrls&&(e=e.concat(k.blockedRelativeUrls.map(g=>new b("url:unsupported",`Relative url '${g}' is not supported`))));if(h){const {ignoreUnsupported:g,supplementalUnsupportedErrors:d=[],requiredPropertyChecksDisabled:f}=
h;g&&(e=e.filter(({name:c})=>!(n.has(c)||d.includes(c))));f&&(e=e.filter(c=>"web-document-write:property-required"!==c.name))}if(0<e.length)throw new b(p.errorName,"Failed to save due to unsupported or invalid content. See 'details.errors' for more detailed information",{errors:e});};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/mixins/TemporalSceneLayer":function(){define("exports ../../chunks/tslib.es6 ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/has ../../core/Logger ../../core/RandomLCG ../../core/accessorSupport/decorators/subclass ../support/fieldUtils ../support/sceneLayerCacheUtils ../support/TimeInfo ../../time/TimeExtent ../../time/TimeInterval".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w){let x=class extends n.JSONSupport{constructor(){super(...arguments);this.startTimeField=this.endTimeField=null}};b.__decorate([k.property({type:String})],x.prototype,"endTimeField",void 0);b.__decorate([k.property({type:String})],x.prototype,"startTimeField",void 0);x=b.__decorate([g.subclass("esri.layers.mixins.TemporalSceneLayer.SceneServiceTimeInfo")],x);a.TemporalSceneLayer=u=>{u=class extends u{constructor(){super(...arguments);this.serviceTimeInfo=null}get timeInfo(){var t=
this.associatedLayer?.timeInfo;if(null==t)return null;t=t.clone();d.fixTimeInfoFields(t,this.fieldsIndex);return t}set timeInfo(t){d.fixTimeInfoFields(t,this.fieldsIndex);this._override("timeInfo",t)}get timeExtent(){return this.associatedLayer?.timeExtent}set timeExtent(t){this._override("timeExtent",t)}get timeOffset(){return this.associatedLayer?.timeOffset}set timeOffset(t){this._override("timeOffset",t)}get datesInUnknownTimezone(){return this.associatedLayer?.datesInUnknownTimezone??!1}set datesInUnknownTimezone(t){this._override("datesInUnknownTimezone",
t)}async loadTimeInfoFromService(t){var {serviceTimeInfo:m}=this;if(null!=m){var {startTimeField:q,endTimeField:r}=m;if((null!=q||null!=r)&&!f.cacheIsOutOfSync({associatedLayer:this.associatedLayer,serviceUpdateTimeStamp:this.serviceUpdateTimeStamp})){m=async B=>{let z=null;try{z=(await this.fetchStatistics?.(B,t))?.stats}catch{}if(null==z)return null;const {minTimeStr:A,min:C,maxTimeStr:H,max:E}=z;B=B===q?A??C:H??E;return null!=B?new Date(B):null};var [v,y]=await Promise.all([m(q),m(r)]);null!=q&&
null==v||null!=r&&null==y||(m=new l({start:v,end:y}),this.setAtOrigin("timeInfo",new c({endField:r,startField:q,fullTimeExtent:m}),"service"))}}}};b.__decorate([k.property({type:c,json:{read:!1,write:!1}})],u.prototype,"timeInfo",null);b.__decorate([k.property({type:l,json:{read:!1,write:!1}})],u.prototype,"timeExtent",null);b.__decorate([k.property({type:w,json:{read:!1,write:!1}})],u.prototype,"timeOffset",null);b.__decorate([k.property({type:Boolean,nonNullable:!0,json:{read:!1,write:!1}})],u.prototype,
"datesInUnknownTimezone",null);b.__decorate([k.property({type:x,readOnly:!0,json:{read:{source:"timeInfo"}}})],u.prototype,"serviceTimeInfo",void 0);return u=b.__decorate([g.subclass("esri.layers.mixins.TemporalSceneLayer")],u)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/sceneLayerCacheUtils":function(){define(["exports"],function(a){a.cacheIsOutOfSync=function({associatedLayer:b,serviceUpdateTimeStamp:n}){const k=b?.editingInfo?.lastEditDate;b=b?.serverGens;
const p=null!=k,h=null!=n;n=p&&h&&n.lastUpdate!==k.getTime();return p&&(n||!h&&b?.minServerGen!==b?.serverGen)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/I3SLayerDefinitions":function(){define("exports ../../chunks/tslib.es6 ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/has ../../core/Logger ../../core/RandomLCG ../../core/accessorSupport/decorators/enumeration ../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,n,k,p,h,e,g,d){a.I3SNodePageDefinition=class extends n.JSONSupport{constructor(){super(...arguments);this.nodesPerPage=null;this.rootIndex=0;this.lodSelectionMetricType=null}};b.__decorate([k.property({type:Number})],a.I3SNodePageDefinition.prototype,"nodesPerPage",void 0);b.__decorate([k.property({type:Number})],a.I3SNodePageDefinition.prototype,"rootIndex",void 0);b.__decorate([k.property({type:String})],a.I3SNodePageDefinition.prototype,"lodSelectionMetricType",void 0);a.I3SNodePageDefinition=
b.__decorate([d.subclass("esri.layers.support.I3SLayerDefinitions.I3SNodePageDefinition")],a.I3SNodePageDefinition);a.I3SMaterialTexture=class extends n.JSONSupport{constructor(){super(...arguments);this.factor=1}};b.__decorate([k.property({type:Number,json:{read:{source:"textureSetDefinitionId"}}})],a.I3SMaterialTexture.prototype,"id",void 0);b.__decorate([k.property({type:Number})],a.I3SMaterialTexture.prototype,"factor",void 0);a.I3SMaterialTexture=b.__decorate([d.subclass("esri.layers.support.I3SLayerDefinitions.I3SMaterialTexture")],
a.I3SMaterialTexture);a.I3SMaterialPBRMetallicRoughness=class extends n.JSONSupport{constructor(){super(...arguments);this.baseColorFactor=[1,1,1,1];this.metallicRoughnessTexture=this.baseColorTexture=null;this.roughnessFactor=this.metallicFactor=1}};b.__decorate([k.property({type:[Number]})],a.I3SMaterialPBRMetallicRoughness.prototype,"baseColorFactor",void 0);b.__decorate([k.property({type:a.I3SMaterialTexture})],a.I3SMaterialPBRMetallicRoughness.prototype,"baseColorTexture",void 0);b.__decorate([k.property({type:a.I3SMaterialTexture})],
a.I3SMaterialPBRMetallicRoughness.prototype,"metallicRoughnessTexture",void 0);b.__decorate([k.property({type:Number})],a.I3SMaterialPBRMetallicRoughness.prototype,"metallicFactor",void 0);b.__decorate([k.property({type:Number})],a.I3SMaterialPBRMetallicRoughness.prototype,"roughnessFactor",void 0);a.I3SMaterialPBRMetallicRoughness=b.__decorate([d.subclass("esri.layers.support.I3SLayerDefinitions.I3SMaterialPBRMetallicRoughness")],a.I3SMaterialPBRMetallicRoughness);a.I3SMaterialDefinition=class extends n.JSONSupport{constructor(){super(...arguments);
this.alphaMode="opaque";this.alphaCutoff=.25;this.doubleSided=!1;this.cullFace="none";this.pbrMetallicRoughness=this.emissiveFactor=this.emissiveTexture=this.occlusionTexture=this.normalTexture=null}};b.__decorate([g.enumeration({opaque:"opaque",mask:"mask",blend:"blend"})],a.I3SMaterialDefinition.prototype,"alphaMode",void 0);b.__decorate([k.property({type:Number})],a.I3SMaterialDefinition.prototype,"alphaCutoff",void 0);b.__decorate([k.property({type:Boolean})],a.I3SMaterialDefinition.prototype,
"doubleSided",void 0);b.__decorate([g.enumeration({none:"none",back:"back",front:"front"})],a.I3SMaterialDefinition.prototype,"cullFace",void 0);b.__decorate([k.property({type:a.I3SMaterialTexture})],a.I3SMaterialDefinition.prototype,"normalTexture",void 0);b.__decorate([k.property({type:a.I3SMaterialTexture})],a.I3SMaterialDefinition.prototype,"occlusionTexture",void 0);b.__decorate([k.property({type:a.I3SMaterialTexture})],a.I3SMaterialDefinition.prototype,"emissiveTexture",void 0);b.__decorate([k.property({type:[Number]})],
a.I3SMaterialDefinition.prototype,"emissiveFactor",void 0);b.__decorate([k.property({type:a.I3SMaterialPBRMetallicRoughness})],a.I3SMaterialDefinition.prototype,"pbrMetallicRoughness",void 0);a.I3SMaterialDefinition=b.__decorate([d.subclass("esri.layers.support.I3SLayerDefinitions.I3SMaterialDefinition")],a.I3SMaterialDefinition);a.I3STextureFormat=class extends n.JSONSupport{};b.__decorate([k.property({type:String,json:{read:{source:["name","index"],reader:(f,c)=>null!=f?f:`${c.index}`}}})],a.I3STextureFormat.prototype,
"name",void 0);b.__decorate([g.enumeration({jpg:"jpg",png:"png",dds:"dds","ktx-etc2":"ktx-etc2",ktx2:"ktx2",basis:"basis"})],a.I3STextureFormat.prototype,"format",void 0);a.I3STextureFormat=b.__decorate([d.subclass("esri.layers.support.I3SLayerDefinitions.I3STextureFormat")],a.I3STextureFormat);a.I3STextureSetDefinition=class extends n.JSONSupport{constructor(){super(...arguments);this.atlas=!1}};b.__decorate([k.property({type:[a.I3STextureFormat]})],a.I3STextureSetDefinition.prototype,"formats",
void 0);b.__decorate([k.property({type:Boolean})],a.I3STextureSetDefinition.prototype,"atlas",void 0);a.I3STextureSetDefinition=b.__decorate([d.subclass("esri.layers.support.I3SLayerDefinitions.I3STextureSetDefinition")],a.I3STextureSetDefinition);a.I3SGeometryAttribute=class extends n.JSONSupport{};b.__decorate([g.enumeration({Float32:"Float32",UInt64:"UInt64",UInt32:"UInt32",UInt16:"UInt16",UInt8:"UInt8"})],a.I3SGeometryAttribute.prototype,"type",void 0);b.__decorate([k.property({type:Number})],
a.I3SGeometryAttribute.prototype,"component",void 0);a.I3SGeometryAttribute=b.__decorate([d.subclass("esri.layers.support.I3SLayerDefinitions.I3SGeometryAttribute")],a.I3SGeometryAttribute);a.I3SGeometryCompressedAttributes=class extends n.JSONSupport{};b.__decorate([g.enumeration({draco:"draco"})],a.I3SGeometryCompressedAttributes.prototype,"encoding",void 0);b.__decorate([k.property({type:[String]})],a.I3SGeometryCompressedAttributes.prototype,"attributes",void 0);a.I3SGeometryCompressedAttributes=
b.__decorate([d.subclass("esri.layers.support.I3SLayerDefinitions.I3SGeometryCompressedAttributes")],a.I3SGeometryCompressedAttributes);a.I3SGeometryBuffer=class extends n.JSONSupport{constructor(){super(...arguments);this.offset=0}};b.__decorate([k.property({type:Number})],a.I3SGeometryBuffer.prototype,"offset",void 0);b.__decorate([k.property({type:a.I3SGeometryAttribute})],a.I3SGeometryBuffer.prototype,"position",void 0);b.__decorate([k.property({type:a.I3SGeometryAttribute})],a.I3SGeometryBuffer.prototype,
"normal",void 0);b.__decorate([k.property({type:a.I3SGeometryAttribute})],a.I3SGeometryBuffer.prototype,"uv0",void 0);b.__decorate([k.property({type:a.I3SGeometryAttribute})],a.I3SGeometryBuffer.prototype,"color",void 0);b.__decorate([k.property({type:a.I3SGeometryAttribute})],a.I3SGeometryBuffer.prototype,"uvRegion",void 0);b.__decorate([k.property({type:a.I3SGeometryAttribute})],a.I3SGeometryBuffer.prototype,"featureId",void 0);b.__decorate([k.property({type:a.I3SGeometryAttribute})],a.I3SGeometryBuffer.prototype,
"faceRange",void 0);b.__decorate([k.property({type:a.I3SGeometryCompressedAttributes})],a.I3SGeometryBuffer.prototype,"compressedAttributes",void 0);a.I3SGeometryBuffer=b.__decorate([d.subclass("esri.layers.support.I3SLayerDefinitions.I3SGeometryBuffer")],a.I3SGeometryBuffer);a.I3SGeometryDefinition=class extends n.JSONSupport{};b.__decorate([g.enumeration({triangle:"triangle"})],a.I3SGeometryDefinition.prototype,"topology",void 0);b.__decorate([k.property()],a.I3SGeometryDefinition.prototype,"geometryBuffers",
void 0);a.I3SGeometryDefinition=b.__decorate([d.subclass("esri.layers.support.I3SLayerDefinitions.I3SGeometryDefinition")],a.I3SGeometryDefinition);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/meshSpatialReferenceScaleUtils":function(){define(["exports","../../core/unitUtils","../../geometry/support/MeshTransform"],function(a,b,n){a.getMeshTransformForMetersToSpatialReference=function(k){k=1/b.getMetersPerUnitForSR(k,1);return 1!==k?new n({scale:[k,k,k]}):void 0};
Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/RangeInfo":function(){define("exports ../../chunks/tslib.es6 ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/has ../../core/Logger ../../core/RandomLCG ../../core/accessorSupport/decorators/subclass".split(" "),function(a,b,n,k,p,h,e,g){a.RangeInfo=class extends n.JSONSupport{constructor(){super(...arguments);this.fullRangeExtent=this.currentRangeExtent=this.field=this.name=null;this.type=
"rangeInfo"}};b.__decorate([k.property({type:String,json:{read:!0,write:!0}})],a.RangeInfo.prototype,"name",void 0);b.__decorate([k.property({type:String,json:{read:!0,write:!0}})],a.RangeInfo.prototype,"field",void 0);b.__decorate([k.property({type:[Number],json:{read:!0,write:!0}})],a.RangeInfo.prototype,"currentRangeExtent",void 0);b.__decorate([k.property({type:[Number],json:{read:!0,write:!0}})],a.RangeInfo.prototype,"fullRangeExtent",void 0);b.__decorate([k.property({type:["rangeInfo"],readOnly:!0,
json:{read:!1,write:!0}})],a.RangeInfo.prototype,"type",void 0);a.RangeInfo=b.__decorate([g.subclass("esri.layers.support.RangeInfo")],a.RangeInfo);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/SceneFilter":function(){define("../../chunks/tslib.es6 ../../request ../../core/JSONSupport ../../core/lang ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/has ../../core/Logger ../../core/accessorSupport/decorators/reader ../../core/accessorSupport/decorators/subclass ../../core/accessorSupport/decorators/persistable ./PolygonCollection ../../chunks/persistableUrlUtils".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w){var x;n=x=class extends n.JSONSupport{constructor(u){super(u);this.spatialRelationship="disjoint";this.geometries=new l;this._geometriesSource=null}initialize(){this.addHandles(p.on(()=>this.geometries,"after-changes",()=>this.geometries=this.geometries,p.sync))}readGeometries(u,t,m){Array.isArray(u)?this.geometries=l.fromJSON(u,m):this._geometriesSource={url:w.fromJSON(u,m),context:m}}async loadGeometries(u,t){if(null!=this._geometriesSource){var {url:m,context:q}=
this._geometriesSource;t=await b(m,{responseType:"json",signal:t?.signal});var r=u.toJSON();u=t.data.map(v=>({...v,spatialReference:r}));this.geometries=l.fromJSON(u,q);this._geometriesSource=null}}clone(){const u=new x({geometries:k.clone(this.geometries),spatialRelationship:this.spatialRelationship});u._geometriesSource=this._geometriesSource;return u}};a.__decorate([h.property({type:["disjoint","contains"],nonNullable:!0,json:{write:!0}})],n.prototype,"spatialRelationship",void 0);a.__decorate([h.property({type:l,
nonNullable:!0,json:{write:!0}}),c.persistable({origins:["web-scene","portal-item"],type:"resource",prefix:"geometries",contentAddressed:!0})],n.prototype,"geometries",void 0);a.__decorate([d.reader(["web-scene","portal-item"],"geometries")],n.prototype,"readGeometries",null);return n=x=a.__decorate([f.subclass("esri.layers.support.SceneFilter")],n)})},"esri/core/accessorSupport/decorators/persistable":function(){define("exports ../../Error ../../MD5 ../../multiOriginJSONSupportUtils ../../urlUtils ../../uuid ../metadata ../PropertyOrigin ./property ../../../portal/support/resourceExtension ../../../chunks/persistableUrlUtils".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c){function l(m,q,r){const v=e.getPropertyMetadata(q,r);return{type:String,read:(y,B,z)=>{y=c.read(y,B,z);if(v.type===String)return y;if("function"===typeof v.type)return new v.type({url:y})},write:{writer(y,B,z,A){if(A?.resources){var C=null==y?null:"string"===typeof y?y:y.url;C=c.toJSON(C,{...A,verifyItemRelativeUrls:A?.verifyItemRelativeUrls?{writtenUrls:A.verifyItemRelativeUrls.writtenUrls,rootPath:void 0}:void 0},c.MarkKeep.NO);var H=v.type!==String&&(!k.isMultiOriginJSONMixin(this)||
A?.origin&&this.originIdOf(r)>g.nameToId(A.origin));y={object:this,propertyName:r,value:y,targetUrl:C,dest:B,targetPropertyName:z,context:A,params:m};if(A?.portalItem&&C&&!p.isAbsolute(C))if(H&&m?.contentAddressed)w(y);else if(H){{const {context:E,targetUrl:F,params:G,value:D,dest:I,targetPropertyName:J}=y;E.portalItem&&(B=E.portalItem.resourceFromPath(F),z=t(D,F,E),A=f.getResourceContentExtension(z),C=p.getPathExtension(B.path),H=G?.compress??!1,A!==C?w(y):(E.resources&&u({...y,resource:B,content:z,
compress:H,updates:E.resources.toUpdate}),I[J]=F))}}else x(y);else A?.portalItem&&(null==C||null!=c.itemIdFromResourceUrl(C)||p.isBlobProtocol(C)||H)?w(y):B[z]=C}else B[z]="string"===typeof y?c.toJSON(y,A):y.write({},A)}}}}function w(m){const {targetUrl:q,params:r,value:v,context:y,dest:B,targetPropertyName:z}=m;if(y.portalItem){var A=c.prefixAndFilenameFromResourceUrl(q),C=t(v,q,y);if(r?.contentAddressed&&"json"!==C.type)y.messages?.push(new b("persistable:contentAddressingUnsupported",`Property "${z}" is trying to serializing a resource with content of type ${C.type} with content addressing. Content addressing is only supported for json resources.`,
{content:C}));else{var H=r?.contentAddressed&&"json"===C.type?n.createMD5Hash(C.jsonString):A?.filename??h.generateUUID(),E=p.join(r?.prefix??A?.prefix,H),F=`${E}.${f.getResourceContentExtension(C)}`;if(r?.contentAddressed&&y.resources&&"json"===C.type&&(A=y.resources.toKeep.find(({resource:D})=>D.path===F)??y.resources.toAdd.find(({resource:D})=>D.path===F))){B[z]=A.resource.itemRelativeUrl;return}var G=y.portalItem.resourceFromPath(F);p.isBlobProtocol(q)&&y.resources&&y.resources.pendingOperations.push(p.blobUrlToBlob(q).then(D=>
{G.path=`${E}.${f.getResourceContentExtension({type:"blob",blob:D})}`;B[z]=G.itemRelativeUrl}).catch(()=>{}));y.resources&&u({...m,resource:G,content:C,compress:r?.compress??!1,updates:y.resources.toAdd});B[z]=G.itemRelativeUrl}}}function x({context:m,targetUrl:q,dest:r,targetPropertyName:v}){m.portalItem&&m.resources&&(m.resources.toKeep.push({resource:m.portalItem.resourceFromPath(q),compress:!1}),r[v]=q)}function u({object:m,propertyName:q,updates:r,resource:v,content:y,compress:B}){r.push({resource:v,
content:y,compress:B,finish:z=>{"string"===typeof m[q]?m[q]=z.url:m[q].url=z.url}})}function t(m,q,r){return"string"===typeof m?{type:"url",url:q}:{type:"json",jsonString:JSON.stringify(m.toJSON(r))}}a.persistable=function(m){const q=m?.origins??[void 0];return(r,v)=>{a:if("resource"===m?.type)var y=l(m,r,v);else{switch(m?.type??"other"){case "other":y={read:!0,write:!0};break a;case "url":const {read:B,write:z}=c.persistableUrlUtils;y={read:B,write:z};break a}y=void 0}for(const B of q){const z=d.propertyJSONMeta(r,
B,v);for(const A in y)z[A]=y[A]}}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/portal/support/resourceExtension":function(){define(["exports","../../core/urlUtils"],function(a,b){const n={},k=n["text/plain"],p={png:"image/png",jpeg:"image/jpeg",jpg:"image/jpg",bmp:"image/bmp",gif:"image/gif",json:"application/json",txt:"text/plain",xml:"application/xml",svg:"image/svg+xml",zip:"application/zip",pbf:"application/vnd.mapbox-vector-tile",gz:"application/gzip","bin.gz":"application/octet-stream"};
for(const h in p)n[p[h]]=h;a.getResourceContentExtension=function(h){"json"===h.type?h="application/json":"blob"===h.type?h=h.blob.type:(h=b.getPathExtension(h.url),h=p[h]||"text/plain");return n[h]||k};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/PolygonCollection":function(){define("../../chunks/tslib.es6 ../../core/Collection ../../core/JSONSupport ../../core/Warning ../../core/Logger ../../core/has ../../core/RandomLCG ../../core/Error ../../core/accessorSupport/decorators/subclass ../../geometry/Polygon ../../geometry/projection".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c){var l;b=l=class extends n.JSONSupportMixin(b.ofType(f)){constructor(w){super(w)}clone(){return new l(this.items.map(w=>w.clone()))}write(w,x){return this.toJSON(x)}toJSON(w){const x=w?.layer?.spatialReference;return x?this.toArray().map(u=>{if(!x.equals(u.spatialReference)){if(!c.canProjectWithoutEngine(u.spatialReference,x))return w?.messages?.push(new k("scenefilter:unsupported","Scene filters with incompatible spatial references are not supported",{modification:this,
spatialReference:w.layer.spatialReference,context:w})),null;const t=new f;c.projectPolygon(u,t,x);u=t}u=u.toJSON(w);delete u.spatialReference;return u}).filter(u=>null!=u):(w?.messages?.push(new k("scenefilter:unsupported","Writing Scene filters without context layer is not supported",{modification:this,spatialReference:w.layer.spatialReference,context:w})),this.toArray().map(u=>u.toJSON(w)))}static fromJSON(w,x){const u=new l;w.forEach(t=>u.add(f.fromJSON(t,x)));return u}};return b=l=a.__decorate([d.subclass("esri.layers.support.PolygonCollection")],
b)})},"esri/layers/support/sceneLayerStatistics":function(){define(["exports","../../request","../../core/Error","../../core/urlUtils"],function(a,b,n,k){a.fetchStatistics=async function({fieldName:p,statisticsInfo:h,errorContext:e,fieldsIndex:g,path:d,customParameters:f,apiKey:c,signal:l}){if(null==h)throw new n(`${e}:no-cached-statistics`,"Cached statistics are not available for this layer");const w=g.get(p);if(null==w)throw new n(`${e}:field-unexisting`,`Field '${p}' does not exist on the layer`);
p=h.find(x=>x.name===w.name);if(null==p)throw new n(`${e}:no-cached-statistics`,"Cached statistics for this attribute are not available");e=k.join(d,p.href);({data:f}=await b(e,{query:{f:"json",...f,token:c},responseType:"json",signal:l}));return f};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/support/zipUtils":function(){define(["require","exports"],function(a,b){async function n(k){const {BlobReader:p,ZipReader:h,BlobWriter:e}=await new Promise((d,f)=>a(["./zipjs-wrapper"],
d,f)),g=[];k=new p(k);(await (new h(k)).getEntries()).forEach(d=>{if(!d.directory&&!/^__MACOS/i.test(d.filename)){var f=new e;(f=d.getData?.(f).then(c=>new File([c],d.filename)))&&g.push(f)}});return Promise.all(g)}b.extractZipFile=n;b.extractZipFiles=async function(k){const p=[];for(const h of k)h.name.toLowerCase().endsWith(".zip")?p.push(n(h)):p.push(Promise.resolve(h));return(await Promise.all(p)).flat()};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/I3SUtil":function(){define("exports ../../../../geometry ../../../../request ../../../../core/arrayUtils ../../../../core/Error ../../../../core/has ../../../../core/typedArrayUtil ../../../../core/libs/gl-matrix-2/math/mat4 ../../../../core/libs/gl-matrix-2/factories/mat4f64 ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../geometry/projection ../../../../geometry/projection/projectVectorToVector ../../../../geometry/support/aaBoundingRect ../../../../chunks/sphere ../../../../rest/support/Query ./I3SBinaryReader ./I3SProjectionUtil ../support/edgeUtils ../support/symbolColorUtils ../../support/orientedBoundingBox ../../../support/layerViewUtils ../../../../geometry/SpatialReference".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w,x,u,t,m,q,r,v,y,B,z){function A(ha){return ha?parseInt(ha.slice(ha.lastIndexOf("/")+1),10):void 0}function C(ha,T){var S=T[0],Z=T[1];T=T[3];const ia=ha[0]-S;S-=ha[2];const Y=ha[1]-Z;ha=Z-ha[3];Z=Math.max(ia,S,0);const ea=Math.max(Y,ha,0);Z=Z*Z+ea*ea;return Z>T*T?a.MbsIntersectResult.OUTSIDE:0<Z?a.MbsIntersectResult.INTERSECTS_CENTER_OUTSIDE:-Math.max(ia,S,Y,ha)>T?a.MbsIntersectResult.INSIDE:a.MbsIntersectResult.INTERSECTS_CENTER_INSIDE}function H(ha,T,S){const Z=
[],ia=S?.missingFields;S=S?.originalFields;for(const Y of ha){ha=Y.toLowerCase();let ea=!1;for(const ka of T)if(ha===ka.name.toLowerCase()){Z.push(ka.name);ea=!0;S&&S.push(Y);break}!ea&&ia&&ia.push(Y)}return Z}function E(ha,T,S){const Z=new Map,ia=[];S=S();for(const ka of ha){var Y=ka.attributes[T];for(var ea=0;ea<S.length;ea++){ha=S[ea];const ja=ha.featureIds.indexOf(Y);if(0<=ja){Y=Z.get(ha.node);Y||(Y={node:ha.node,indices:[],graphics:[]},ia.push(Y),Z.set(ha.node,Y));Y.indices.push(ja);for(Y.graphics.push(ka);0<
ea;ea--)S[ea]=S[ea-1];S[0]=ha;break}}}return ia}async function F(ha,T,S,Z,ia){T.sort((ka,ja)=>ka.attributes[S]-ja.attributes[S]);var Y=T.map(ka=>ka.attributes[S]);const ea=[];Z=H(Z,ha.fields,{originalFields:ea});ha=await G(ha,Y,Z,ia);for(ia=0;ia<T.length;ia++){Y=T[ia];const ka=ha[ia],ja={};if(Y.attributes)for(const X in Y.attributes)ja[X]=Y.attributes[X];for(let X=0;X<ea.length;X++)ja[ea[X]]=ka[Z[X]];Y.attributes=ja}return T}function G(ha,T,S,Z){var ia=ha.capabilities.query.maxRecordCount;if(null!=
ia&&T.length>ia)return ia=k.splitIntoChunks(T,ia),Promise.all(ia.map(Y=>G(ha,Y,S,Z))).then(Y=>Y.flat());ia=new t({objectIds:T,outFields:S,orderByFields:[ha.objectIdField]});return ha.queryFeatures(ia,Z).then(Y=>{if(Y&&Y.features&&Y.features.length===T.length)return Y.features.map(ea=>ea.attributes);throw new p("scenelayer:feature-not-in-associated-layer","Feature not found in associated feature layer");})}async function D(ha,T,S,Z,ia,Y,ea,ka){const ja=[];for(const X of T)X&&ia.includes(X.name)&&ja.push({url:`${ha}/nodes/${S}/attributes/${X.key}/0`,
storageInfo:X});ha=await Promise.allSettled(ja.map(X=>n(X.url,{responseType:"array-buffer",query:{...ea,token:Y},signal:ka?.signal}).then(aa=>m.readBinaryAttribute(X.storageInfo,aa.data))));T=[];for(const X of Z){Z={};for(S=0;S<ha.length;S++)ia=ha[S],"fulfilled"===ia.status&&(Z[ja[S].storageInfo.name]=I(ia.value,X));T.push(Z)}return T}function I(ha,T){if(!ha)return null;T=ha[T];return e.isInt16Array(ha)?-32768===T?null:T:e.isInt32Array(ha)?T===L?null:T:T!==T?null:T}function J(ha){var T=ha.store,S=
T.indexCRS||T.geographicCRS;if(T=void 0===S?T.indexWKT:void 0)if(ha.spatialReference){if(T!==ha.spatialReference.wkt)throw new p("layerview:store-spatial-reference-wkt-index-incompatible","The indexWKT of the scene layer store does not match the WKT of the layer spatial reference",{});}else throw new p("layerview:no-store-spatial-reference-wkt-index-and-no-layer-spatial-reference","Found indexWKT in the scene layer store but no layer spatial reference",{});S=S?new z(A(S)):ha.spatialReference;return S.equals(ha.spatialReference)?
ha.spatialReference:S}function N(ha){var T=ha.store,S=T.vertexCRS||T.projectedCRS;if(T=void 0===S?T.vertexWKT:void 0)if(ha.spatialReference){if(T!==ha.spatialReference.wkt)throw new p("layerview:store-spatial-reference-wkt-vertex-incompatible","The vertexWKT of the scene layer store does not match the WKT of the layer spatial reference",{});}else throw new p("layerview:no-store-spatial-reference-wkt-vertex-and-no-layer-spatial-reference","Found vertexWKT in the scene layer store but no layer spatial reference",
{});S=S?new z(A(S)):ha.spatialReference;return S.equals(ha.spatialReference)?ha.spatialReference:S}function M(ha,T,S){if(!l.canProjectWithoutEngine(ha,T))throw B.spatialReferenceIncompatibleError("scene layer",ha?.wkid,T?.wkid);if("local"===S&&!Q(ha,T))throw B.spatialReferenceIncompatibleError("scene layer",ha?.wkid,T?.wkid);}function Q(ha,T){return ha.equals(T)||ha.isWGS84&&T.isWebMercator||ha.isWebMercator&&T.isWGS84}function O(ha,T,S){const Z=J(ha);ha=N(ha);M(Z,T,S);M(ha,T,S)}const K=x.create();
a.MbsIntersectResult=void 0;(function(ha){ha[ha.OUTSIDE=0]="OUTSIDE";ha[ha.INTERSECTS_CENTER_OUTSIDE=1]="INTERSECTS_CENTER_OUTSIDE";ha[ha.INTERSECTS_CENTER_INSIDE=2]="INTERSECTS_CENTER_INSIDE";ha[ha.INSIDE=3]="INSIDE"})(a.MbsIntersectResult||(a.MbsIntersectResult={}));const L=-(2**31);b=r.createSolidEdgeMaterial({color:[0,0,0,0],opacity:0});class P{constructor(){this.material=this.edgeMaterial=null;this.castShadows=!0}}const R=[c.create(),c.create(),c.create(),c.create(),c.create(),c.create(),c.create(),
c.create()],W=x.create(),V=x.create(),ba=new y.Obb,U=c.create(),da={data:Array(72),size:3,exclusive:!0,stride:3},fa=d.create();a.SymbolInfo=P;a.addWraparound=function(ha,T){return(ha|0)+(T|0)|0};a.checkPointCloudLayerCompatibleWithView=function(ha,T){M(ha.spatialReference,T.spatialReference,T.viewingMode)};a.checkPointCloudLayerValid=function(ha){var T;(T=null==ha.store?.defaultGeometrySchema)||(ha=ha.store.defaultGeometrySchema,T=!!(null==ha.geometryType||"points"!==ha.geometryType||null!=ha.topology&&
"PerAttributeArray"!==ha.topology||null!=ha.encoding&&""!==ha.encoding&&"lepcc-xyz"!==ha.encoding||null==ha.vertexAttributes?.position));if(T)throw new p("pointcloud:unsupported-geometry-schema","The geometry schema of this point cloud scene layer is not supported.",{});};a.checkRecyclable=function(ha,T,S){if(ha.serviceUpdateTimeStamp?.lastUpdate!==T.serviceUpdateTimeStamp?.lastUpdate||!S.isEmpty||ha.associatedLayer?.url!==T.associatedLayer?.url)throw new p("layerview:recycle-failed");};a.checkSceneLayerCompatibleWithView=
function(ha,T){O(ha,T.spatialReference,T.viewingMode)};a.checkSceneLayerValid=function(ha){var T;(T=null==ha.store?.defaultGeometrySchema)||(T=ha.store.defaultGeometrySchema,T=!!(null!=T.geometryType&&"triangles"!==T.geometryType||null!=T.topology&&"PerAttributeArray"!==T.topology||null==T.vertexAttributes?.position));if(T)throw new p("scenelayer:unsupported-geometry-schema","The geometry schema of this scene layer is not supported.",{url:ha.parsedUrl.path});};a.checkSpatialReference=M;a.checkSpatialReferences=
O;a.computeVisibilityObb=function(ha,T,S,Z,ia,Y,ea){if(!Y||0===Y.length||null==T||!ha.serviceMbsInIndexSR)return null;const ka=q.computeGlobalTransformation(ha.serviceMbsInIndexSR,ia,"none",S,T);g.invert(fa,ka);let ja=null;const X=()=>{if(!ja)if(ja=R,x.empty(V),null!=ha.serviceObbInIndexSR){ha.serviceObbInIndexSR.transform(ba,S,T,ia,ea);ba.getCorners(ja);for(var na of ja)f.transformMat4(na,na,fa),x.expandPointInPlace(V,na)}else{var qa=ha.serviceMbsInIndexSR;if(qa)for(na=qa[3],w.projectVectorToVector(u.getCenter(qa),
S,U,T),f.transformMat4(U,U,fa),U[2]+=ia,qa=0;8>qa;++qa){const sa=ja[qa];f.copy(sa,[U[0]+(qa&1?na:-na),U[1]+(qa&2?na:-na),U[2]+(qa&4?na:-na)]);x.expandPointInPlace(V,sa)}}};let aa=Infinity,pa=-Infinity;const la=na=>{if("replace"===na.type&&(na=na.geometry,na?.hasZ)){x.empty(W);var qa=na.spatialReference||Z;na=na.rings.reduce((sa,xa)=>xa.reduce((ta,Ba)=>{f.set(U,Ba[0],Ba[1],Ba[2]);w.projectVectorToVector(U,qa,U,T);f.transformMat4(U,U,fa);x.expandPointInPlace(W,U);return Math.min(U[2],ta)},sa),Infinity);
X();x.intersects(V,W)&&(aa=Math.min(aa,na),pa=Math.max(pa,na))}};Y.forEach(na=>la(na));if(Infinity===aa)return null;Y=(na,qa,sa)=>{f.transformMat4(U,sa,ka);na[qa]=U[0];na[qa+1]=U[1];na[qa+2]=U[2];qa+=24;sa[2]=aa;f.transformMat4(U,sa,ka);na[qa]=U[0];na[qa+1]=U[1];na[qa+2]=U[2];qa+=24;sa[2]=pa;f.transformMat4(U,sa,ka);na[qa]=U[0];na[qa+1]=U[1];na[qa+2]=U[2]};for(let na=0;8>na;++na)Y(da.data,3*na,ja[na]);return y.compute(da)};a.containsDraco=function(ha){if(h("disable-feature:i3s-draco")||!ha)return!1;
for(const T of ha)for(const S of T.geometryBuffers)if("draco"===S.compressedAttributes?.encoding)return!0;return!1};a.extractWkid=A;a.filterInPlace=function(ha,T,S){let Z=0,ia=0;for(let Y=0;Y<T.length&&Z<ha.length;Y++)ha[Z]===T[Y]&&(S(Y)&&(ha[ia]=ha[Z],ia++),Z++);ha.length=ia};a.findFieldsCaseInsensitive=H;a.findIntersectingNodes=function(ha,T,S,Z){S.traverse(T,ia=>{const Y=ia.serviceMbsInIndexSR;if((null!=Y&&C(ha,Y))===a.MbsIntersectResult.OUTSIDE)return!1;Z(ia);return!0})};a.getCachedAttributeValue=
I;a.getClipRect=function(ha,T){if(0===T.rotationScale[1]&&0===T.rotationScale[2]&&0===T.rotationScale[3]&&0===T.rotationScale[5]&&0===T.rotationScale[6]&&0===T.rotationScale[7])return K[0]=(ha[0]-T.position[0])/T.rotationScale[0],K[1]=(ha[1]-T.position[1])/T.rotationScale[4],K[2]=(ha[2]-T.position[0])/T.rotationScale[0],K[3]=(ha[3]-T.position[1])/T.rotationScale[4],K};a.getIndexCrs=J;a.getSymbolInfo=function(ha){const T=new P;var S=!1;let Z=!1;for(const Y of ha.symbolLayers.items)if("fill"===Y.type&&
Y.enabled){var ia=Y.material;ha=Y.edges;null==ia||S||(S=ia.color,ia=v.parseColorMixMode(ia.colorMixMode),T.material=null!=S?{color:[S.r/255,S.g/255,S.b/255],alpha:S.a,colorMixMode:ia}:{color:[1,1,1],alpha:1,colorMixMode:v.ColorMixModeEnum.Multiply},T.castShadows=Y.castShadows,S=!0);null==ha||Z||(T.edgeMaterial=r.createMaterialFromEdges(ha,{}),Z=!0)}T.material||(T.material={color:[1,1,1],alpha:1,colorMixMode:v.ColorMixModeEnum.Multiply});return T};a.getVertexCrs=N;a.intersectBoundingRectWithMbs=C;
a.invalidateMbs=function(ha){null!=ha&&(ha[3]=-1)};a.isSupportedLocalModeProjection=Q;a.isValidMbs=function(ha){return 0<=ha[3]};a.objectIdFilter=function(ha,T,S){let Z=0,ia=0;for(;Z<S.length;)0<=k.binaryIndexOf(ha,S[Z])===T&&(S[ia]=S[Z],ia++),Z++;S.length=ia};a.queryAttributesFromCachedAttributesId=D;a.rendererNeedsTextures=function(ha){if(null==ha||"simple"!==ha.type&&"class-breaks"!==ha.type&&"unique-value"!==ha.type||("unique-value"===ha.type||"class-breaks"===ha.type)&&null==ha.defaultSymbol)return!0;
ha=ha.getSymbols();if(0===ha.length)return!0;for(const T of ha){if("mesh-3d"!==T.type||0===T.symbolLayers.length)return!0;for(const S of T.symbolLayers.items)if("fill"!==S.type||null==S.material?.color||"replace"!==S.material.colorMixMode)return!0}return!1};a.transparentEdgeMaterial=b;a.whenGraphicAttributes=async function(ha,T,S,Z,ia,Y){if(0===T.length)return[];const ea=ha.attributeStorageInfo;if(null!=ha.associatedLayer)try{return await F(ha.associatedLayer,T,S,Z,Y)}catch(ka){if(ha.associatedLayer.loaded)throw ka;
}if(ea){T=E(T,S,ia);if(null==T)throw new p("scenelayer:features-not-loaded","Tried to query attributes for unloaded features");const ka=ha.parsedUrl.path;return(await Promise.all(T.map(ja=>D(ka,ea,ja.node.resources.attributes,ja.indices,Z,ha.apiKey,ha.customParameters,Y).then(X=>{for(let aa=0;aa<ja.graphics.length;aa++){const pa=ja.graphics[aa],la=X[aa];if(pa.attributes)for(const na in pa.attributes)na in la||(la[na]=pa.attributes[na]);pa.attributes=la}return ja.graphics})))).flat()}throw new p("scenelayer:no-attribute-source",
"This scene layer does not have a source for attributes available");};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/I3SBinaryReader":function(){define("exports ../../../../core/Error ../../../../core/lang ../../../../core/Logger ./LEPCC ../../webgl-engine/lib/VertexAttribute".split(" "),function(a,b,n,k,p,h){function e(z,A){const C={byteOffset:0,byteCount:0,fields:Object.create(null)};let H=0;for(let E=0;E<A.length;E++){const F=A[E],G=F.valueType||F.type;
C.fields[F.property]=(0,B[G])(z,H);H+=y[G].BYTES_PER_ELEMENT}C.byteCount=H;return C}function g(z,A,C){return d(z,A,C).map(H=>{H=H?Date.parse(H):null;return null==H||Number.isNaN(H)?null:H})}function d(z,A,C){const H=[];let E,F=0,G;for(G=0;G<z;G+=1){E=A[G];if(0<E){var D=H,I=D.push,J=C,N=F,M=E-1;let O="",K=0;for(;K<M;){var Q=J[N+K];if(128>Q)O+=String.fromCharCode(Q),K++;else if(192<=Q&&224>Q){if(K+1>=M)throw new b("utf8-decode-error","UTF-8 Decode failed. Two byte character was truncated.");O+=String.fromCharCode((Q&
31)<<6|J[N+K+1]&63);K+=2}else if(224<=Q&&240>Q){if(K+2>=M)throw new b("utf8-decode-error","UTF-8 Decode failed. Multi byte character was truncated.");O+=String.fromCharCode((Q&15)<<12|(J[N+K+1]&63)<<6|J[N+K+2]&63);K+=3}else if(240<=Q&&248>Q){if(K+3>=M)throw new b("utf8-decode-error","UTF-8 Decode failed. Multi byte character was truncated.");Q=(Q&7)<<18|(J[N+K+1]&63)<<12|(J[N+K+2]&63)<<6|J[N+K+3]&63;O=65536<=Q?O+String.fromCharCode((Q-65536>>10)+55296,(Q&1023)+56320):O+String.fromCharCode(Q);K+=4}else throw new b("utf8-decode-error",
"UTF-8 Decode failed. Invalid multi byte sequence.");}I.call(D,O);if(0!==C[F+E-1])throw new b("string-array-error","Invalid string array: missing null termination.");}else H.push(null);F+=E}return H}function f(z,A){return new y[A.valueType](z,A.byteOffset,A.count*A.valuesPerElement)}function c(z,A){return new Uint8Array(z,A.byteOffset,A.byteCount)}function l(z,A,C){z=null!=A.header?e(z,A.header):{byteOffset:0,byteCount:0,fields:{count:C}};C={header:z,byteOffset:z.byteCount,byteCount:0,entries:Object.create(null)};
let H=z.byteCount;for(let E=0;E<A.ordering.length;E++){const F=A.ordering[E],G=n.clone(A[F]);G.count=z.fields.count??0;if("String"===G.valueType){G.byteOffset=H;G.byteCount=z.fields[F+"ByteCount"];if("UTF-8"!==G.encoding)throw new b("unsupported-encoding","Unsupported String encoding.",{encoding:G.encoding});if(G.timeEncoding&&"ECMA_ISO8601"!==G.timeEncoding)throw new b("unsupported-time-encoding","Unsupported time encoding.",{timeEncoding:G.timeEncoding});}else if(m(G.valueType)){const D=q(G.valueType);
H+=0!==H%D?D-H%D:0;G.byteOffset=H;G.byteCount=D*G.valuesPerElement*G.count}else throw new b("unsupported-value-type","Unsupported binary valueType",{valueType:G.valueType});H+=G.byteCount??0;C.entries[F]=G}C.byteCount=H-C.byteOffset;return C}function w(z,A,C){A!==z&&r().error(`Invalid ${C} buffer size\n expected: ${z}, actual: ${A})`);if(A<z)throw new b("buffer-too-small","Binary buffer is too small",{expectedSize:z,actualSize:A});}function x(z){return{isDraco:!1,isLegacy:!1,color:null!=z.color,normal:null!=
z.normal,uv0:null!=z.uv0,uvRegion:null!=z.uvRegion,featureIndex:null!=z.faceRange&&null!=z.featureId}}function u(z){const A={isDraco:!1,isLegacy:!0,color:!1,normal:!1,uv0:!1,uvRegion:!1,featureIndex:!1};for(const C of z.ordering)if(z.vertexAttributes[C])switch(C){case "normal":A.normal=!0;break;case "color":A.color=!0;break;case "uv0":A.uv0=!0;break;case "region":A.uvRegion=!0}z.featureAttributes&&z.featureAttributeOrder&&(A.featureIndex=!0);return A}function t(z){const A={isDraco:!0,isLegacy:!1,
color:!1,normal:!1,uv0:!1,uvRegion:!1,featureIndex:!1};for(const C of z)switch(C){case "normal":A.normal=!0;break;case "uv0":A.uv0=!0;break;case "color":A.color=!0;break;case "uv-region":A.uvRegion=!0;break;case "feature-index":A.featureIndex=!0}return A}function m(z){return y.hasOwnProperty(z)}function q(z){return m(z)?y[z].BYTES_PER_ELEMENT:0}const r=()=>k.getLogger("esri.views.3d.layers.i3s.I3SBinaryReader"),v={position:h.VertexAttribute.POSITION,normal:h.VertexAttribute.NORMAL,color:h.VertexAttribute.COLOR,
uv0:h.VertexAttribute.UV0,region:h.VertexAttribute.UVREGION},y={Float32:Float32Array,Float64:Float64Array,UInt8:Uint8Array,Int8:Int8Array,UInt16:Uint16Array,Int16:Int16Array,UInt32:Uint32Array,Int32:Int32Array},B={Float32:(z,A)=>(new DataView(z,0)).getFloat32(A,!0),Float64:(z,A)=>(new DataView(z,0)).getFloat64(A,!0),UInt8:(z,A)=>(new DataView(z,0)).getUint8(A),Int8:(z,A)=>(new DataView(z,0)).getInt8(A),UInt16:(z,A)=>(new DataView(z,0)).getUint16(A,!0),Int16:(z,A)=>(new DataView(z,0)).getInt16(A,!0),
UInt32:(z,A)=>(new DataView(z,0)).getUint32(A,!0),Int32:(z,A)=>(new DataView(z,0)).getInt32(A,!0)};a.createAttributeDataIndex=l;a.createGeometryDescriptor=function(z,A){return z&&z.compressedAttributes&&"draco"===z.compressedAttributes.encoding?t(z.compressedAttributes.attributes):z?x(z):u(A)};a.createGeometryDescriptorForDraco=t;a.createGeometryDescriptorFromDefinition=x;a.createGeometryDescriptorFromSchema=u;a.createGeometryIndexFromSchema=function(z,A){var C=e(z,A&&A.header);let H=C.byteCount;
const E={isDraco:!1,header:C,byteOffset:C.byteCount,byteCount:0,vertexAttributes:{}};C=C.fields;var F=null!=C.vertexCount?C.vertexCount:C.count;for(var G of A.ordering){if(!A.vertexAttributes[G])continue;const I={...A.vertexAttributes[G],byteOffset:H,count:F};E.vertexAttributes[v[G]||"_"+G]=I;H+=q(I.valueType)*I.valuesPerElement*F}G=C.faceCount;if(A.faces&&G){E.faces={};for(var D of A.ordering)A.faces[D]&&(F={...A.faces[D],byteOffset:H,count:G},E.faces[D]=F,H+=q(F.valueType)*F.valuesPerElement*G)}D=
C.featureCount;if(A.featureAttributes&&A.featureAttributeOrder&&D){E.featureAttributes={};for(const I of A.featureAttributeOrder)A.featureAttributes[I]&&(C={...A.featureAttributes[I],byteOffset:H,count:D},E.featureAttributes[I]=C,G="UInt64"===C.valueType?8:q(C.valueType),H+=G*C.valuesPerElement*D)}w(H,z.byteLength,"geometry");E.byteCount=H-E.byteOffset;return E};a.createRawView=c;a.createTypedView=f;a.getBytesPerValue=q;a.isValueType=m;a.readBinaryAttribute=function(z,A,C){if("lepcc-rgb"===z.encoding)return p.decodeRGB(A);
if("lepcc-intensity"===z.encoding)return p.decodeIntensity(A);if(null!=z.encoding&&""!==z.encoding)throw new b("unknown-attribute-storage-info-encoding","Unknown Attribute Storage Info Encoding");z["attributeByteCounts "]&&!z.attributeByteCounts&&(r().warn("Warning: Trailing space in 'attributeByteCounts '."),z.attributeByteCounts=z["attributeByteCounts "]);"ObjectIds"===z.ordering[0]&&z.hasOwnProperty("objectIds")&&(r().warn("Warning: Case error in objectIds"),z.ordering[0]="objectIds");C=l(A,z,
C);w(C.byteOffset+C.byteCount,A.byteLength,"attribute");if(z=C.entries.attributeValues||C.entries.objectIds){if("String"===z.valueType){C=C.entries.attributeByteCounts;const H=f(A,C);A=c(A,z);return z.timeEncoding?g(C.count,H,A):d(C.count,H,A)}return f(A,z)}throw new b("bad-attribute-storage-info","Bad attributeStorageInfo specification.");};a.readDateStringArray=g;a.readHeader=e;a.readStringArray=d;a.valueType2ArrayBufferReader=B;a.valueType2TypedArrayClassMap=y;Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/views/3d/layers/i3s/LEPCC":function(){define(["exports","../../../../core/Error"],function(a,b){function n(e,g,d){return{identifier:String.fromCharCode.apply(null,new Uint8Array(e,d+h.identifierOffset,h.identifierLength)),version:g.getUint16(d+h.versionOffset,!0),checksum:g.getUint32(d+h.checksumOffset,!0)}}function k(e,g,d){const f=[];g=p(e,g,f);const c=[];for(let l=0;l<f.length;l++){c.length=0;g=p(e,g,c);for(let w=0;w<c.length;w++)d.push(c[w]+f[l])}return g}function p(e,
g,d){var f=new DataView(e,g),c=f.getUint8(0);const l=c&31;var w=!!(c&32),x=(c&192)>>6;c=0;if(0===x)c=f.getUint32(1,!0),g+=5;else if(1===x)c=f.getUint16(1,!0),g+=3;else if(2===x)c=f.getUint8(1),g+=2;else throw new b("lepcc-decode-error","Bad count type");if(w)throw new b("lepcc-decode-error","LUT not implemented");e=new Uint8Array(e,g,Math.ceil(c*l/8));x=w=f=0;const u=-1>>>32-l;for(let t=0;t<c;t++){for(;w<l;)f|=e[x]<<w,w+=8,x+=1;d[t]=f&u;f>>>=l;w-=l;32<w+l&&(f|=e[x-1]>>8-w)}return g+x}const h={identifierOffset:0,
identifierLength:10,versionOffset:10,checksumOffset:12,byteCount:16};a.decodeIntensity=function(e){const g=new DataView(e,0);var d=0;const {identifier:f,version:c}=n(e,g,d);d+=h.byteCount;if("Intensity "!==f)throw new b("lepcc-decode-error","Bad identifier");if(1<c)throw new b("lepcc-decode-error","Unknown version");var l=d;var w=g.getUint32(l+0,!0);var x=g.getUint32(l+4,!0);var u=g.getUint32(l+8,!0);var t=g.getUint16(l+12,!0);var m=g.getUint8(l+14);g.getUint8(l+15);d+=16;if(x*2**32+w!==e.byteLength)throw new b("lepcc-decode-error",
"Bad size");w=new Uint16Array(u);if(8===m){if(u+d!==e.byteLength)throw new b("lepcc-decode-error","Bad size");e=new Uint8Array(e,d,u);for(d=0;d<u;d++)w[d]=e[d]*t}else if(16===m){if(2*u+d!==e.byteLength)throw new b("lepcc-decode-error","Bad size");e=new Uint16Array(e,d,u);for(d=0;d<u;d++)w[d]=e[d]*t}else{m=[];if(p(e,d,m)!==e.byteLength)throw new b("lepcc-decode-error","Bad size");for(e=0;e<u;e++)w[e]=m[e]*t}return w};a.decodeRGB=function(e){var g=new DataView(e,0),d=0;const {identifier:f,version:c}=
n(e,g,d);d+=h.byteCount;if("ClusterRGB"!==f)throw new b("lepcc-decode-error","Bad identifier");if(1<c)throw new b("lepcc-decode-error","Unknown version");var l=d;var w=g.getUint32(l+0,!0);var x=g.getUint32(l+4,!0);var u=g.getUint32(l+8,!0);var t=g.getUint16(l+12,!0);var m=g.getUint8(l+14);l=g.getUint8(l+15);d+=16;if(x*2**32+w!==e.byteLength)throw new b("lepcc-decode-error","Bad size");if((2===m||1===m)&&0===l){if(3*t+u+d!==e.byteLength||256<t)throw new b("lepcc-decode-error","Bad count");g=new Uint8Array(e,
d,3*t);d=new Uint8Array(e,d+3*t,u);e=new Uint8Array(3*u);for(t=0;t<u;t++)w=d[t],e[3*t]=g[3*w],e[3*t+1]=g[3*w+1],e[3*t+2]=g[3*w+2];return e}if(0===m&&0===l){if(3*u+d!==e.byteLength||0!==t)throw new b("lepcc-decode-error","Bad count");return(new Uint8Array(e,d)).slice()}if(2>=m&&1===l){if(d+3!==e.byteLength||1!==t)throw new b("lepcc-decode-error","Bad count");e=g.getUint8(d);t=g.getUint8(d+1);d=g.getUint8(d+2);g=new Uint8Array(3*u);for(w=0;w<u;w++)g[3*w]=e,g[3*w+1]=t,g[3*w+2]=d;return g}throw new b("lepcc-decode-error",
"Bad method "+m+","+l);};a.decodeXYZ=function(e){var g=new DataView(e,0),d=0;const {identifier:f,version:c}=n(e,g,d);d+=h.byteCount;if("LEPCC     "!==f)throw new b("lepcc-decode-error","Bad identifier");if(1<c)throw new b("lepcc-decode-error","Unknown version");var l=d;var w=g.getUint32(l+0,!0);var x=g.getUint32(l+4,!0);var u=g.getFloat64(l+8,!0);var t=g.getFloat64(l+16,!0);var m=g.getFloat64(l+24,!0);var q=g.getFloat64(l+32,!0);var r=g.getFloat64(l+40,!0);var v=g.getFloat64(l+48,!0);var y=g.getFloat64(l+
56,!0);var B=g.getFloat64(l+64,!0);var z=g.getFloat64(l+72,!0);var A=g.getUint32(l+80,!0);g.getUint32(l+84,!0);d+=88;if(x*2**32+w!==e.byteLength)throw new b("lepcc-decode-error","Bad size");w=new Float64Array(3*A);x=[];A=[];g=[];l=[];d=k(e,d,x);d=k(e,d,A);d=k(e,d,g);d=k(e,d,l);if(d!==e.byteLength)throw new b("lepcc-decode-error","Bad length");d=e=0;for(let C=0;C<x.length;C++){d+=x[C];let H=0;for(let E=0;E<A[C];E++){H+=g[e];const F=l[e];w[3*e]=Math.min(q,u+2*y*H);w[3*e+1]=Math.min(r,t+2*B*d);w[3*e+
2]=Math.min(v,m+2*z*F);e++}}return{errorX:y,errorY:B,errorZ:z,result:w}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/I3SProjectionUtil":function(){define(["exports","../../../../core/libs/gl-matrix-2/factories/mat4f64","../../../../core/libs/gl-matrix-2/factories/vec3f64","../../../../geometry/ellipsoidUtils","../../../../geometry/projection/computeTranslationToOriginAndRotation"],function(a,b,n,k,p){function h(e,g,d){const f=n.create(),c=2**(4*Math.ceil(Math.log(e[3])*
Math.LOG2E/4)+1);if(d.isGeographic){var l=c/k.getReferenceEllipsoid(d).radius*180/Math.PI;d=Math.max(-90,Math.min(90,Math.round(e[1]/l)*l));l/=Math.cos((Math.abs(d)-l/2)/180*Math.PI);f[0]=Math.round(e[0]/l)*l;f[1]=d}else d=Math.round(e[1]/c),f[0]=Math.round(e[0]/c)*c,f[1]=d*c;f[2]=Math.round((e[2]+g)/c)*c;return f}a.computeGlobalTransformation=function(e,g,d,f,c){e="east-north-up"===d?n.clone(e):h(e,g,f);g=b.create();p.computeTranslationToOriginAndRotation(f,e,g,c);return g};a.getLocalOrigin=h;Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/layers/support/popupUtils":function(){define(["exports","../../../layers/support/fieldUtils"],function(a,b){function n(k,p){return k.popupTemplate?k.popupTemplate:null!=p&&p.defaultPopupTemplateEnabled&&null!=k.defaultPopupTemplate?k.defaultPopupTemplate:null}a.getFetchPopupTemplate=n;a.getRequiredFields=async function(k,p=k.popupTemplate){if(null==p)return[];const h=await p.getRequiredFields(k.fieldsIndex);({lastEditInfoEnabled:p}=p);const {objectIdField:e,
typeIdField:g,globalIdField:d,relationships:f}=k;if(h.includes("*"))return["*"];p=p?b.getFeatureEditFields(k):[];const c=b.fixFields(k.fieldsIndex,[...h,...p]);g&&c.push(g);c&&e&&k.fieldsIndex?.has(e)&&!c.includes(e)&&c.push(e);c&&d&&k.fieldsIndex?.has(d)&&!c.includes(d)&&c.push(d);f&&f.forEach(l=>{({keyField:l}=l);c&&l&&k.fieldsIndex?.has(l)&&!c.includes(l)&&c.push(l)});return c};a.hasPopupTemplate=function(k,p){return null!=n(k,{defaultPopupTemplateEnabled:p})};Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/views/3d/layers/ElevationLayerView3D":function(){define("../../../chunks/tslib.es6 ../../../core/Error ../../../core/Logger ../../../core/maybe ../../../core/promiseUtils ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ../../../layers/support/ElevationTileData ../../../layers/support/LercDecoder ./LayerView3D ./TiledLayerView3D ../terrain/TerrainConst ../terrain/terrainUtils ../../layers/LayerView".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w,x,u,t){e=class extends w.TiledLayerView3D(l.LayerView3D(t)){constructor(){super(...arguments);this.type="elevation-3d"}get tileInfo(){return this.layer.tileInfo}initialize(){const m=this.view;var q=m.map?.allLayers;q=q&&q.includes(this.layer);var r=m.map?.ground?.layers;r=r&&r.includes(this.layer);q&&!r&&(q=new b("layerview:elevation-layer-only",`3D elevation layer '${this.layer.id}' can only be added to layers in map.ground`),this.addResolvingPromise(Promise.reject(q)));
this._lercDecoder=c.acquireDecoder(m.resourceController);this._addTilingSchemeMatchPromise()}destroy(){this._lercDecoder=k.releaseMaybe(this._lercDecoder)}async fetchTile(m,q){const r=this.layer;if(u.useFetchTileForLayer(r)){m=await r.fetchTile(m[0],m[1],m[2],{noDataValue:x.elevationNoDataValue,signal:q.signal});if(p.isAborted(q)){n.getLogger(this).warnOnce("A call to fetchTile resolved even though the request was aborted. fetchTile should not resolve if options.signal.aborted is true.");return}return m}m=
this.getTileUrl(m);m=await q.requester.request(m,"binary",q);if(q=await this._lercDecoder.decode(m,{noDataValue:x.elevationNoDataValue},q.signal))return new f.ElevationTileData(q);throw Error("LERC decoding failed");}};a.__decorate([h.property()],e.prototype,"layer",void 0);a.__decorate([h.property()],e.prototype,"tileInfo",null);return e=a.__decorate([d.subclass("esri.views.3d.layers.ElevationLayerView3D")],e)})},"esri/layers/support/ElevationTileData":function(){define(["exports"],function(a){class b{constructor(n,
k,p,h){this._maxValue=this._minValue=this._hasNoDataValues=null;"pixelData"in n?(this.values=n.pixelData,this.width=n.width,this.height=n.height,this.noDataValue=n.noDataValue):(this.values=n,this.width=k,this.height=p,this.noDataValue=h)}get hasNoDataValues(){null==this._hasNoDataValues&&(this._hasNoDataValues=this.values.includes(this.noDataValue));return this._hasNoDataValues}get minValue(){this._ensureBounds();return this._minValue}get maxValue(){this._ensureBounds();return this._maxValue}_ensureBounds(){if(null==
this._minValue){var {noDataValue:n,values:k}=this,p=Infinity,h=-Infinity,e=!0;for(const g of k)g===n?this._hasNoDataValues=!0:(p=g<p?g:p,h=g>h?g:h,e=!1);e?this._maxValue=this._minValue=0:(this._minValue=p,this._maxValue=-3E38<h?h:0)}}}a.ElevationTileData=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/LercDecoder":function(){define(["exports","../../core/workers/WorkerHandle"],function(a,b){class n extends b.WorkerHandle{constructor(p=null){super("LercWorker",
"_decode",{_decode:h=>[h.buffer]},p,{strategy:"dedicated"});this.schedule=p;this.ref=0}decode(p,h,e){return p&&0!==p.byteLength?this.invoke({buffer:p,options:h},e):Promise.resolve(null)}release(){0>=--this.ref&&(k.forEach((p,h)=>{p===this&&k.delete(h)}),this.destroy())}}const k=new Map;a.acquireDecoder=function(p=null){let h=k.get(p);h||(null!=p?(h=new n(e=>p.immediate.schedule(e)),k.set(p,h)):(h=new n,k.set(null,h)));++h.ref;return h};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/core/workers/WorkerHandle":function(){define("exports ../arrayUtils ../handleUtils ../Logger ../promiseUtils ./workers".split(" "),function(a,b,n,k,p,h){class e{constructor(g,d,f,c,l={}){this._mainMethod=d;this._transferLists=f;this._listeners=[];this._promise=h.open(g,{...l,schedule:c}).then(w=>{if(void 0===this._thread){this._thread=w;this._promise=null;l.hasInitialize&&this.broadcast({},"initialize");for(const x of this._listeners)this._connectListener(x)}else w.close()});this._promise.catch(w=>
k.getLogger("esri.core.workers.WorkerHandle").error(`Failed to initialize ${g} worker: ${w}`))}on(g,d){const f={removed:!1,eventName:g,callback:d,threadHandle:null};this._listeners.push(f);this._connectListener(f);return n.makeHandle(()=>{f.removed=!0;b.remove(this._listeners,f);this._thread&&null!=f.threadHandle&&f.threadHandle.remove()})}destroy(){this._thread&&(this._thread.close(),this._thread=null);this._promise=null;this._listeners.length=0;this._transferLists={}}invoke(g,d){return this.invokeMethod(this._mainMethod,
g,d)}invokeMethod(g,d,f){if(this._thread){var c=this._transferLists[g];c=c?c(d):[];return this._thread.invoke(g,d,{transferList:c,signal:f})}return this._promise?this._promise.then(()=>{p.throwIfAborted(f);return this.invokeMethod(g,d,f)}):Promise.reject(null)}broadcast(g,d){return this._thread?Promise.all(this._thread.broadcast(d,g)).then(()=>{}):this._promise?this._promise.then(()=>this.broadcast(g,d)):Promise.reject()}get promise(){return this._promise}_connectListener(g){this._thread&&this._thread.on(g.eventName,
g.callback).then(d=>{g.removed||(g.threadHandle=d)})}}a.WorkerHandle=e;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/LayerView3D":function(){define("exports ../../../chunks/tslib.es6 ../../../core/handleUtils ../../../core/promiseUtils ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ../../../geometry/support/heightModelInfoUtils".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c){a.LayerView3D=l=>{l=class extends l{constructor(){super(...arguments);this.supportsHeightUnitConversion=this.slicePlaneEnabled=!1}postscript(){super.postscript();c.supportsHeightModelInfo(this.layer)&&this.addResolvingPromise(this._validateHeightModelInfo())}async _validateHeightModelInfo(){const w=new AbortController;var x=w.signal;this.addHandles(n.makeHandle(()=>w.abort()));await p.whenOnce(()=>this.view.defaultsFromMap?.heightModelInfoReady,x);k.throwIfAborted(x);
if(x=c.rejectLayerError(this.layer,this.view.heightModelInfo,this.supportsHeightUnitConversion))throw x;}};b.__decorate([h.property()],l.prototype,"view",void 0);b.__decorate([h.property()],l.prototype,"slicePlaneEnabled",void 0);return l=b.__decorate([f.subclass("esri.views.3d.layers.LayerView3D")],l)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/TiledLayerView3D":function(){define("exports ../../../chunks/tslib.es6 ../../../core/Error ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ./support/LayerViewPerformanceInfo ../support/updatingProperties ../terrain/terrainUtils ../../support/layerViewUtils".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w){a.TiledLayerView3D=x=>{x=class extends x{constructor(){super(...arguments);this.hasMixedImageFormats=!0}get imageFormatIsOpaque(){return!1}get fullExtent(){return this.layer.fullExtent}get isOpaque(){return 1<=this.fullOpacity&&this.imageFormatIsOpaque}get visibleAtCurrentScale(){if(!w.isScaleRangeActive(this.layer.minScale,this.layer.maxScale)||!this.view.scale)return!0;const u=Math.round(this.view.basemapTerrain.tilingScheme.levelAtScale(this.view.scale));return u>=
this.displayLevelRange.minLevel&&u<=this.displayLevelRange.maxLevel}get dataScaleRange(){var u=this.tileInfo.lods;let t=u[0].scale;u=u[u.length-1].scale;if("tilemapCache"in this.layer&&this.layer.tilemapCache){const {effectiveMinLOD:m,effectiveMaxLOD:q}=this.layer.tilemapCache;t=this.tileInfo.lodAt(m).scale;u=this.tileInfo.lodAt(q).scale}return{minScale:t,maxScale:u}}canResume(){const u=this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null;return this.visible&&this.layer?.loaded&&
!this.parent?.suspended&&this.view?.ready&&w.validateScaleRange(u)&&this.visibleAtCurrentTimeExtent||!1}get dataLevelRange(){const {minScale:u,maxScale:t}=this.dataScaleRange;return this.levelRangeFromScaleRange(u,t)}get displayLevelRange(){const u=this.levelRangeFromScaleRange(this.layer.minScale||this.dataScaleRange.minScale,this.layer.maxScale||this.dataScaleRange.maxScale);this.layer.maxScale&&u.maxLevel++;return u}get performanceInfo(){return new f.LayerViewPerformanceInfo(this.view.basemapTerrain.getUsedMemoryForLayerView(this))}getTileUrl(u){return this.layer.getTileUrl(u[0],
u[1],u[2])}_addTilingSchemeMatchPromise(){if(null==this.fullExtent)return this.addResolvingPromise(Promise.reject(new n("tilingscheme:extent-not-defined","This layer doesn't define a fullExtent.")));const u=this._getTileInfoSupportError(this.tileInfo,this.fullExtent);if(u)return this.addResolvingPromise(Promise.reject(u));this.addResolvingPromise(k.whenOnce(()=>this.view?.basemapTerrain?.tilingSchemeLocked).then(()=>{const t=this._getTileInfoCompatibilityError(this.tileInfo,this.view.basemapTerrain.tilingScheme,
"tilemapCache"in this.layer?this.layer.tilemapCache?.effectiveMaxLOD:void 0);if(t)throw t;}))}_getTileInfoSupportError(u,t){if(u=l.checkIfTileInfoSupportedForView(u,t,this.view.spatialReference,this.view.state.viewingMode,"tilemapCache"in this.layer?this.layer.tilemapCache?.effectiveMaxLOD:void 0))switch(t={layer:this.layer,error:u},u.name){case "tilingscheme:spatial-reference-mismatch":case "tilingscheme:global-unsupported-spatial-reference":case "tilingscheme:local-unsupported-spatial-reference":return new n("layerview:spatial-reference-incompatible",
"The spatial reference of this layer does not meet the requirements of the view",t);default:return new n("layerview:tiling-scheme-unsupported","The tiling scheme of this layer is not supported by SceneView",t)}}_getTileInfoCompatibilityError(u,t,m){return null!=u&&t.compatibleWith(u,m)?null:new n("layerview:tiling-scheme-incompatible","The tiling scheme of this layer is incompatible with the tiling scheme of the surface")}levelRangeFromScaleRange(u,t){const m={minLevel:0,maxLevel:Infinity};var q=
this.view&&this.view.basemapTerrain&&this.view.basemapTerrain.tilingScheme;if(!q)return m;const r=q.levels[0];q=v=>{v=Math.log(r.scale/v)/Math.LN2;return 1E-9>.5-Math.abs(.5-v%1)?Math.round(v):Math.ceil(v)};null!=u&&0<u&&(m.minLevel=Math.max(0,q(u)));null!=t&&0<t&&(m.maxLevel=Math.max(0,q(t)));return m}isUpdating(){return!!(this.view&&this.view.basemapTerrain&&this.view.basemapTerrain.updating)}};b.__decorate([p.property({readOnly:!0})],x.prototype,"imageFormatIsOpaque",null);b.__decorate([p.property({readOnly:!0})],
x.prototype,"updating",void 0);b.__decorate([p.property(c.updatingProgress)],x.prototype,"updatingProgress",void 0);b.__decorate([p.property(c.updatingProgressValue)],x.prototype,"updatingProgressValue",void 0);b.__decorate([p.property()],x.prototype,"hasMixedImageFormats",void 0);b.__decorate([p.property()],x.prototype,"fullExtent",null);b.__decorate([p.property({readOnly:!0})],x.prototype,"isOpaque",null);b.__decorate([p.property({readOnly:!0})],x.prototype,"visibleAtCurrentScale",null);b.__decorate([p.property()],
x.prototype,"dataScaleRange",null);b.__decorate([p.property({readOnly:!0})],x.prototype,"dataLevelRange",null);b.__decorate([p.property({readOnly:!0})],x.prototype,"displayLevelRange",null);b.__decorate([p.property()],x.prototype,"layer",void 0);return x=b.__decorate([d.subclass("esri.views.3d.layers.TiledLayerView3D")],x)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/FeatureLayerView3D":function(){define("../../../chunks/tslib.es6 ../../../core/Error ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ../../../geometry/projection ../../../layers/support/layerUtils ./FeatureLayerViewBase3D".split(" "),
function(a,b,n,k,p,h,e,g,d,f){k=class extends f{constructor(){super(...arguments);this.type="feature-3d"}initialize(){const {layer:c,view:l}=this;d.getEffectiveLayerCapabilities(c)?.operations.supportsQuery||this.addResolvingPromise(Promise.reject(new b("featurelayerview:query-not-supported","layer view requires a layer with query capability",{layer:c})));null!=c.infoFor3D&&this.addResolvingPromise(Promise.reject(new b("featurelayerview3d:unsupported-geometry-type",`Unsupported geometry type ${c.geometryType}`)));
"mesh"!==c.geometryType||g.canProjectWithoutEngine(c.spatialReference,l.spatialReference)||this.addResolvingPromise(Promise.reject(new b("layerview:spatial-reference-incompatible","The spatial references of the feature layer is incompatible with the spatial reference of the view")))}get featureSpatialReference(){return this.view.featureTiles?.tilingScheme?.spatialReference}};a.__decorate([n.property()],k.prototype,"layer",void 0);return k=a.__decorate([e.subclass("esri.views.3d.layers.FeatureLayerView3D")],
k)})},"esri/views/3d/layers/FeatureLayerViewBase3D":function(){define("require ../../../chunks/tslib.es6 ../../../core/Error ../../../core/has ../../../core/maybe ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ../../../layers/graphics/dehydratedFeatures ./FeatureLikeLayerView3D ./LayerView3D ./graphics/FeatureGraphics3DGraphicsPipeline ../support/updatingProperties ../webgl-engine/lib/UpdatePolicy ../../layers/FeatureLayerView ../../layers/LayerView ../../layers/RefreshableLayerView".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w,x,u,t,m,q,r){g=class extends r(l.FeatureLikeLayerView3D(m(w.LayerView3D(q)))){constructor(v){super(v)}initialize(){this.addHandles(h.watch(()=>this._updatingRequiredFieldsPromise,v=>this._updatingHandles.addPromise(v),h.syncAndInitial))}destroy(){this._updatingHandles.removeAll();this._fetcherContext=p.destroyMaybe(this._fetcherContext)}get maximumNumberOfFeatures(){return this.graphicsPipeline.maximumNumberOfFeatures}set maximumNumberOfFeatures(v){this.graphicsPipeline.maximumNumberOfFeatures=
v}get maximumNumberOfFeaturesExceeded(){return null!=this.graphicsPipeline&&!this.suspended&&this.graphicsPipeline.maximumNumberOfFeaturesExceeded}get updatingProgressValue(){return this.graphicsPipeline?.updatingProgressValue??0}get updatePolicy(){return this.graphicsPipeline?.updatePolicy??t.UpdatePolicy.ASYNC}get hasZ(){const v=this.layer,y=v.capabilities&&v.capabilities.data;return y&&y.supportsZ?"returnZ"in v&&null!=v.returnZ?v.returnZ:y.supportsZ:!1}get hasM(){const v=this.layer,y=v.capabilities&&
v.capabilities.data;return y&&y.supportsM?"returnM"in v&&null!=v.returnM?v.returnM:!1:!1}setVisibility(v,y){this.graphicsPipeline?.setVisibility(v,y)}createQuery(){return super.createQuery()}queryFeatures(v,y){const B=()=>super.queryFeatures(v,y);return"mesh"===this.layer.geometryType?this._queryFeaturesMesh(this._ensureQuery(v),B):B()}async createGraphicsPipeline(){if(k("feature-pipeline-3d-test")){const {Feature3DPipeline:v}=await new Promise((y,B)=>a(["./graphics/pipeline/Feature3DPipeline"],y,
B));return new v({layerView:this})}return new x.FeatureGraphics3DGraphicsPipeline({layerView:this})}async doRefresh(v){return await this.graphicsPipeline.doRefresh(v)}_popupFeatureHasRequiredFields(v,y){if(!super._popupFeatureHasRequiredFields(v,y))return!1;v=c.getObjectId(v,this.layer.objectIdField);if(null==v)return!0;v=this.graphicsPipeline.getMissingAttributesForFeature(v);if(null==v)return!0;for(const B of y)if(v.has(B))return!1;return!0}get usedMemory(){return this.graphicsPipeline?.usedMemory??
0}get unloadedMemory(){return this.graphicsPipeline?.unloadedMemory??0}get ignoresMemoryFactor(){return this.graphicsPipeline?.ignoresMemoryFactor??!1}async _queryFeaturesMesh(v,y){await this._validateQueryFeaturesMesh(v);y=await y();const B=this.graphicsPipeline;if(v?.outStatistics||null==B)return y;v=this.layer.objectIdField;const z=[];for(const A of y.features)if(A.geometry){const C=B.getHydratedGeometry(A.attributes[v]);C&&(A.geometry=C,z.push(A))}else z.push(A);y.features=z;return y}async _validateQueryFeaturesMesh(v){if(v){var y=
z=>{throw new n("feature-layer-view:unsupported-query",`Queries on Mesh feature collection layers do not support '${z}'`);},B=["quantizationParameters","geometryPrecision","maxAllowableOffset"];for(const z of B)null!=v[z]&&y(z);"returnM"in v&&v.returnM&&y("returnM");"returnCentroid"in v&&v.returnCentroid&&y("returnCentroid");null==v.outSpatialReference||v.outSpatialReference.equals(this.view.spatialReference)||y("outSpatialReference")}}get test(){}};b.__decorate([e.property()],g.prototype,"layer",
void 0);b.__decorate([e.property()],g.prototype,"graphicsPipeline",void 0);b.__decorate([e.property()],g.prototype,"maximumNumberOfFeatures",null);b.__decorate([e.property()],g.prototype,"maximumNumberOfFeaturesExceeded",null);b.__decorate([e.property(u.updatingProgress)],g.prototype,"updatingProgress",void 0);b.__decorate([e.property({readOnly:!0})],g.prototype,"updatingProgressValue",null);b.__decorate([e.property({readOnly:!0})],g.prototype,"updatePolicy",null);b.__decorate([e.property({readOnly:!0})],
g.prototype,"hasZ",null);b.__decorate([e.property({readOnly:!0})],g.prototype,"hasM",null);return g=b.__decorate([f.subclass("esri.views.3d.layers.FeatureLayerViewBase3D")],g)})},"esri/views/3d/layers/FeatureLikeLayerView3D":function(){define("exports ../../../chunks/tslib.es6 ../../../core/Error ../../../core/maybe ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ../../../layers/graphics/hydratedFeatures ../../../layers/support/timeSupport ../../../rest/support/Query ./support/projectExtentUtils ../webgl-engine/lib/UpdatePolicy ../../support/HighlightDefaults".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w,x,u){a.FeatureLikeLayerView3D=t=>{t=class extends t{constructor(){super(...arguments);this.updatePolicy=x.UpdatePolicy.SYNC;this.slicePlaneEnabled=!1;this.fullExtentInLocalViewSpatialReference=null;this.supportsHeightUnitConversion=!0}initialize(){const m=this.layer;"isTable"in m&&m.isTable?this.addResolvingPromise(Promise.reject(new n("featurelayerview:table-not-supported","table feature layer can't be displayed",{layer:m}))):(this.addResolvingPromise(this._validateGeometryType()),
this.addResolvingPromise((async()=>{var q=await w.toViewIfLocal(this);this.destroyed||(this.fullExtentInLocalViewSpatialReference=q,q=await this.createGraphicsPipeline(),this.destroyed?q.destroy():(this.graphicsPipeline=q,await q.when()))})()),this.notifyChange("updating"))}destroy(){this.graphicsPipeline=k.destroyMaybe(this.graphicsPipeline)}get dataUpdating(){return!!this.graphicsPipeline?.dataUpdating}get legendEnabled(){return this.canResume()&&this.graphicsPipeline?.legendEnabled}get visibleAtCurrentScale(){return!(this.graphicsPipeline?.scaleVisibilitySuspended??
!1)}get symbologySnappingSupported(){return this.graphicsPipeline.symbologySnappingSupported}get hasAllFeatures(){return this.graphicsPipeline.hasAllFeatures}get hasAllFeaturesInView(){return this.graphicsPipeline.hasAllFeaturesInView}get hasFullGeometries(){return this.graphicsPipeline.hasFullGeometries}get timeExtent(){return c.combineTimeExtent(this.layer,this.view?.timeExtent,this._get("timeExtent"))}getHit(m){var q=this.graphicsPipeline.findGraphic(r=>r.uid===m);if(null==q)return null;q=f.hydrateGraphic(q,
this.layer);return{type:"graphic",graphic:q,layer:q.layer}}whenGraphicBounds(m,q){return this.graphicsPipeline?.whenGraphicBounds(m,q)}computeAttachmentOrigin(m,q){return this.graphicsPipeline?.computeAttachmentOrigin(m,q)}async elevationAlignPointsInFeatures(m,q){return this.graphicsPipeline.elevationAlignPointsInFeatures(m,q)}async queryForSymbologySnapping(m,q){return this.graphicsPipeline.graphicsQuery.queryForSymbologySnapping(m,q)}queryFeatures(m,q){return this.graphicsPipeline.graphicsQuery.executeQuery(this._ensureQuery(m),
q?.signal)}queryObjectIds(m,q){return this.graphicsPipeline.graphicsQuery.executeQueryForIds(this._ensureQuery(m),q?.signal)}queryFeatureCount(m,q){return this.graphicsPipeline.graphicsQuery.executeQueryForCount(this._ensureQuery(m),q?.signal)}queryExtent(m,q){return this.graphicsPipeline.graphicsQuery.executeQueryForExtent(this._ensureQuery(m),q?.signal)}_ensureQuery(m){return null==m?this.createQuery():l.from(m)}highlight(m,q){return this.graphicsPipeline.highlight(m,q??u.defaultHighlightName)}maskOccludee(m){return this.graphicsPipeline.maskOccludee(m)}getSuspendInfo(){return{...super.getSuspendInfo(),
...this.graphicsPipeline.suspendInfo}}isUpdating(){return!this.graphicsPipeline||this.graphicsPipeline.destroyed?!1:!(!this.graphicsPipeline?.updating&&this.view?.basemapTerrain?.ready)}async _validateGeometryType(){switch(this.layer.geometryType){case "multipatch":case "multipoint":throw new n("featurelayerview3d:unsupported-geometry-type","Unsupported geometry type ${geometryType}",{geometryType:this.layer.geometryType});}}get performanceInfo(){return this.graphicsPipeline.performanceInfo}};b.__decorate([p.property()],
t.prototype,"graphicsPipeline",void 0);b.__decorate([p.property({readOnly:!0})],t.prototype,"dataUpdating",null);b.__decorate([p.property()],t.prototype,"suspended",void 0);b.__decorate([p.property({readOnly:!0})],t.prototype,"legendEnabled",null);b.__decorate([p.property({readOnly:!0})],t.prototype,"visibleAtCurrentScale",null);b.__decorate([p.property()],t.prototype,"updating",void 0);b.__decorate([p.property({readOnly:!0})],t.prototype,"updatePolicy",void 0);b.__decorate([p.property({type:Boolean})],
t.prototype,"slicePlaneEnabled",void 0);b.__decorate([p.property({readOnly:!0})],t.prototype,"suspendInfo",void 0);b.__decorate([p.property()],t.prototype,"symbologySnappingSupported",null);b.__decorate([p.property({readOnly:!0})],t.prototype,"hasAllFeatures",null);b.__decorate([p.property({readOnly:!0})],t.prototype,"hasAllFeaturesInView",null);b.__decorate([p.property({readOnly:!0})],t.prototype,"hasFullGeometries",null);b.__decorate([p.property({readOnly:!0})],t.prototype,"timeExtent",null);return t=
b.__decorate([d.subclass("esri.views.3d.layers.FeatureLikeLayerView3D")],t)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/timeSupport":function(){define(["exports","../../support/timeUtils"],function(a,b){a.combineTimeExtent=function(n,k,p){if(null==n?.timeInfo)return null;const {datesInUnknownTimezone:h=!1,timeOffset:e,useViewTime:g}=n;n=n.timeExtent;h&&(n=b.toLocalTimeExtent(n));k=g?k&&n?k.intersection(n):k||n:n;if(!k||k.isEmpty||k.isAllTime)return k;e&&(k=
k.offset(-e.value,e.unit));h&&(k=b.toUTCTimeExtent(k));return k.equals(p)?p:k};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/support/timeUtils":function(){define("exports ../core/arrayUtils ../core/deprecate ../core/lang ../core/Logger ../core/timeUtils ../time/TimeExtent ../webmap/utils ../webscene/utils".split(" "),function(a,b,n,k,p,h,e,g,d){function f(u){return void 0!==u.timeInfo}async function c(u,t){return u.widgets?.timeSlider?.fullTimeExtent??l(u.allLayers,t)}async function l(u,
t){if(0===u.length)return e.allTime;await Promise.all(u.map(v=>v.load({signal:t})));var m=u.filter(f),q=u.filter(v=>!f(v)&&null!=v.visibilityTimeExtent);if(0===m.length&&0===q.length)return e.allTime;u=[];const r=[];for(const v of m)"feature"!==v?.type&&"map-image"!==v?.type||!v.timeInfo?.hasLiveData?r.push(v):u.push(v);m=v=>null==v||v.isAllTime;q=[...r.map(v=>{const y=v.timeInfo?.fullTimeExtent;({visibilityTimeExtent:v}=v);return y?.intersection(v)??v}),...q.map(v=>v.visibilityTimeExtent)];if(q.some(m))return e.allTime;
u=u.map(async v=>{const y=(await v.fetchRecomputedExtents({signal:t}))?.timeExtent??v.timeInfo?.fullTimeExtent;({visibilityTimeExtent:v}=v);return y?.intersection(v)??v});u=(await Promise.allSettled(u)).map(v=>"fulfilled"===v.status?v.value:null);if(u.some(m))return e.allTime;u=[...u,...q].filter(b.isSome);return 0===u.length?e.allTime:u.reduce((v,y)=>v.union(y))}function w(u,t){u=u.currentTimeExtent;if(!u)return null;const {start:m,end:q}=u;u=m??q??null;switch(t){case "time-window":return new e({start:m,
end:q});case "cumulative-from-start":return new e({start:null,end:u});case "cumulative-from-end":return new e({start:u,end:null});case "instant":return new e({start:u,end:u})}}async function x(u,t){if(!g.isWebMap(u)&&!d.isWebScene(u))return null;await u.load({signal:t});var m=u?.widgets?.timeSlider;if(!m)return null;u=await c(u,t);t=m.loop;var q=m.numThumbs??2;var r=m.currentTimeExtent;if(r){const {start:y,end:B}=r;q=null!=y&&null!=B&&y.getTime()===B.getTime()?"instant":2===q?"time-window":null==
y||0===y.getTime()?"cumulative-from-start":"cumulative-from-end"}else q=2===q?"time-window":"cumulative-from-start";r=m.stopDelay??2E3;{const {numStops:y,stopInterval:B,stops:z}=m;var v=z?{dates:k.clone(z)}:B?{interval:B.clone()}:{count:y??5}}m=w(m,q);return{fullTimeExtent:u,loop:t,mode:q,playRate:r,stops:v,timeExtent:m}}a.getTimeExtentFromLayers=l;a.getTimeSliderSettingsFromWebDocument=x;a.getTimeSliderSettingsFromWebMap=async function(u,t){n.deprecatedFunction(p.getLogger("esri.support.timeUtils.getTimeSliderSettingsFromWebMap"),
"`timeUtils.getTimeSliderSettingsFromWebMap` is deprecated in favor of 'timeUtils.getTimeSliderSettingsFromWebDocument'",{replacement:"timeUtils.getTimeSliderSettingsFromWebDocument",version:"4.30",see:"https://developers.arcgis.com/javascript/latest/api-reference/esri-support-timeUtils.html#getTimeSliderSettingsFromWebDocument",warnOnce:!0});return null!=u&&g.isWebMap(u)?await x(u,t):null};a.toLocalTimeExtent=function(u){if(!u)return u;const {start:t,end:m}=u;return new e({start:null!=t?h.offsetDate(t,
t.getTimezoneOffset(),"minutes"):t,end:null!=m?h.offsetDate(m,m.getTimezoneOffset(),"minutes"):m})};a.toUTCTimeExtent=function(u){if(!u)return u;const {start:t,end:m}=u;return new e({start:null!=t?h.offsetDate(t,-t.getTimezoneOffset(),"minutes"):t,end:null!=m?h.offsetDate(m,-m.getTimezoneOffset(),"minutes"):m})};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/webmap/utils":function(){define(["exports","./Version"],function(a,b){b=new b.Version(2,32);a.currentVersion=b;a.isWebMap=
function(n){return null!=n&&"object"===typeof n&&"declaredClass"in n&&"esri.WebMap"===n.declaredClass};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/webmap/Version":function(){define(["exports","../core/Version"],function(a,b){class n extends b.Version{constructor(k,p){super(k,p,"webmap")}}a.Version=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/webscene/utils":function(){define(["exports","../support/tagSymbols"],function(a,b){a.isWebScene=function(n){return null!=
n&&"object"===typeof n&&b.WebSceneTag in n};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/support/tagSymbols":function(){define(["exports"],function(a){const b=Symbol("WebScene");a.WebSceneTag=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/support/projectExtentUtils":function(){define(["exports","../../../../geometry/support/webMercatorUtils","../../../../portal/support/geometryServiceUtils"],function(a,b,n){a.toViewIfLocal=async function(k){const p=
k.view.spatialReference,h=k.layer.fullExtent;var e=null!=h&&h.spatialReference;if(null==h||!e)return null;if(e.equals(p))return h.clone();e=b.project(h,p);if(null!=e)return e;if(k.view.state.isLocal)try{const g=await n.projectGeometry(h,p,k.layer.portalItem);return k.destroyed||null==g?null:g}catch{}return null};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/portal/support/geometryServiceUtils":function(){define("exports ../../config ../../core/Error ../Portal ../../rest/geometryService/project ../../rest/support/ProjectParameters".split(" "),
function(a,b,n,k,p,h){async function e(g=null,d){if(b.geometryServiceUrl)return b.geometryServiceUrl;if(!g)throw new n("internal:geometry-service-url-not-configured");g="portal"in g?g.portal||k.getDefault():g;await g.load({signal:d});d=g.helperServices?.geometry?.url;if(!d)throw new n("internal:geometry-service-url-not-configured");return d}a.getGeometryServiceURL=e;a.projectGeometry=async function(g,d,f=null,c){f=await e(f,c);g=new h({geometries:[g],outSpatialReference:d});if((c=await p.project(f,
g,{signal:c}))&&Array.isArray(c)&&1===c.length)return c[0];throw new n("internal:geometry-service-projection-failed");};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/rest/geometryService/project":function(){define("exports ../../request ../../core/accessorSupport/ensureType ../../geometry/support/jsonUtils ../utils ./utils ../support/ProjectParameters".split(" "),function(a,b,n,k,p,h,e){const g=n.ensureType(e);a.project=async function(d,f,c){f=g(f);d=p.parseUrl(d);const l=
{...d.query,f:"json",...f.toJSON()},w=f.outSpatialReference,x=k.getJsonType(f.geometries[0]);f=p.asValidOptions(l,c);return b(d.path+"/project",f).then(({data:{geometries:u}})=>h.decodeGeometries(u,x,w))};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/rest/support/ProjectParameters":function(){define("../../chunks/tslib.es6 ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/has ../../core/Logger ../../core/RandomLCG ../../core/accessorSupport/decorators/subclass ../../geometry/support/jsonUtils ../../geometry/support/spatialReferenceUtils".split(" "),
function(a,b,n,k,p,h,e,g,d){b=class extends b.JSONSupport{constructor(f){super(f);this.geometries=[];this.transformForward=this.transformation=this.outSpatialReference=null}toJSON(){const f=this.geometries.map(w=>w.toJSON()),c=this.geometries[0],l={};l.outSR=d.srToRESTValue(this.outSpatialReference);l.inSR=d.srToRESTValue(c.spatialReference);l.geometries=JSON.stringify({geometryType:g.getJsonType(c),geometries:f});this.transformation&&(l.transformation=this.transformation.wkid||JSON.stringify(this.transformation));
null!=this.transformForward&&(l.transformForward=this.transformForward);return l}};a.__decorate([n.property()],b.prototype,"geometries",void 0);a.__decorate([n.property({json:{read:{source:"outSR"}}})],b.prototype,"outSpatialReference",void 0);a.__decorate([n.property()],b.prototype,"transformation",void 0);a.__decorate([n.property()],b.prototype,"transformForward",void 0);return b=a.__decorate([e.subclass("esri.rest.support.ProjectParameters")],b)})},"esri/views/3d/layers/graphics/FeatureGraphics3DGraphicsPipeline":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/maybe ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/Logger ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ../../../../layers/graphics/hydratedFeatures ../../../../layers/graphics/controllers/FeatureTileController3D ../FeatureLayerViewPerformanceInfo ./Graphics3DGraphicsPipeline ../support/FeatureTileFetcher3DContext ../../support/EventedSet ../../webgl-engine/lib/UpdatePolicy".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w,x,u,t){a.FeatureGraphics3DGraphicsPipeline=class extends w.Graphics3DGraphicsPipeline{constructor(q){super(q);this._processorTotal=this._controllerTotal=0;this._needsRefresh=!1;this.suspendResumeExtentMode="data"}initialize(){this.addHandles(k.watch(()=>({controller:this.controller,suspended:this.suspended}),({controller:q,suspended:r})=>{q&&!r&&this._needsRefresh&&(q.refetch(),this._needsRefresh=!1)}))}destroy(){this._fetcherContext=n.destroyMaybe(this._fetcherContext)}get maximumNumberOfFeatures(){return this.controller?.maximumNumberOfFeatures??
this._get("maximumNumberOfFeatures")}set maximumNumberOfFeatures(q){this._set("maximumNumberOfFeatures",q);this.controller&&(this.controller.maximumNumberOfFeatures=q)}get maximumNumberOfFeaturesExceeded(){return this.controller?!(this.suspended||!this.controller.maximumNumberOfFeaturesExceeded):!1}get updatingProgressValue(){let q=0;if(this.controller?.updating){var r=this.controller.updatingRemaining,v=Math.max(this.controller.updatingTotal,this._controllerTotal);0<v&&(q=(v-r)/v,this._controllerTotal=
v)}r=0;if(this.processor?.updating){v=this.processor.updatingRemaining;const y=Math.max(v,this._processorTotal);0<y&&(r=(y-v)/y,this._processorTotal=y)}return.5*(q+r)}get updatePolicy(){if(!this.controller)return t.UpdatePolicy.ASYNC;switch(this.controller.mode){case "snapshot":const q=m.get(this.layer.geometryType);return null==q||this.controller.serviceDataCount>q?t.UpdatePolicy.ASYNC:t.UpdatePolicy.SYNC;case "tiles":return t.UpdatePolicy.ASYNC}}get usedMemory(){return(this.processor?.usedMemory??
0)+(this.controller?.memoryForUnusedFeatures??0)}get unloadedMemory(){const q=this.controller?.expectedFeatureDiff??0,r=this.processor?.loadedFeatures??0;return(this.processor?.unprocessedMemoryEstimate??0)+q*(this.processor?.usedMemoryPerFeature??0)*(0<r+q?r/(r+q):1)}get ignoresMemoryFactor(){return this.controller?.hasMaximumNumberOfFeaturesOverride}get performanceInfo(){var q=this.controller?.displayFeatureLimit;q=null!=q?q.averageSymbolComplexity:void 0;return new l.FeatureLayerViewPerformanceInfo(super.performanceInfo,
this.controller?.performanceInfo?.storedFeatures??0,this.controller?.performanceInfo?.totalVertices??0,this.maximumNumberOfFeaturesExceeded,this.controller?.mode??"n/a",null!=q?`f:${q.verticesPerFeature},v:${q.verticesPerCoordinate}`:"n/a")}async doRefresh(q){const {controller:r,processor:v,suspended:y}=this;q&&r&&(y?this._needsRefresh=!0:(r.refetch(),this._needsRefresh=!1));v.refreshFilter()}setVisibility(q,r){this.processor?.setObjectIdVisibility(q,r)}getMissingAttributesForFeature(q){return this.controller.getMissingAttributesForFeature(q)}getHydratedGeometry(q){var r=
this.graphics3DProcessor;if(null==r)return null;r=r.graphics3DGraphicsByObjectID;if(null==r)return null;q=r.get(q);return null==q?null:f.hydrateGeometry(q.graphic.geometry)}createController(){this._fetcherContext=new x.FeatureTileFetcher3DContext({layerView:this.layerView,returnZ:this.hasZ,returnM:this.hasM});const q=new c.FeatureTileController3D({layerView:this.layerView,context:this._fetcherContext,graphics:new u.EventedSet,extent:this.clippingExtent});this.updatingHandles.add(()=>q.serviceDataExtent,
r=>{this.processor&&(this.processor.dataExtent=r)},k.initial);this.addHandles(k.watch(()=>this.suspended&&this.layerView.updateSuspended,r=>{r?q.suspend():q.resume()},k.syncAndInitial));this.updatingHandles.add(()=>this.processor?.displayFeatureLimit,r=>q.displayFeatureLimit=r,k.initial);this.addHandles(k.when(()=>!this.updating,()=>{this._processorTotal=this._controllerTotal=0}));return q}beforeSetController(q){q.maximumNumberOfFeatures=this.maximumNumberOfFeatures}get test(){return{controller:this.controller,
graphics3DProcessor:this.graphics3DProcessor,heatmapProcessor:this.heatmapProcessor,loadedGraphics:this.loadedGraphics}}};b.__decorate([p.property()],a.FeatureGraphics3DGraphicsPipeline.prototype,"layerView",void 0);b.__decorate([p.property()],a.FeatureGraphics3DGraphicsPipeline.prototype,"controller",void 0);b.__decorate([p.property()],a.FeatureGraphics3DGraphicsPipeline.prototype,"_controllerTotal",void 0);b.__decorate([p.property()],a.FeatureGraphics3DGraphicsPipeline.prototype,"_processorTotal",
void 0);b.__decorate([p.property()],a.FeatureGraphics3DGraphicsPipeline.prototype,"_needsRefresh",void 0);b.__decorate([p.property()],a.FeatureGraphics3DGraphicsPipeline.prototype,"maximumNumberOfFeatures",null);b.__decorate([p.property()],a.FeatureGraphics3DGraphicsPipeline.prototype,"maximumNumberOfFeaturesExceeded",null);b.__decorate([p.property()],a.FeatureGraphics3DGraphicsPipeline.prototype,"updatingProgressValue",null);b.__decorate([p.property()],a.FeatureGraphics3DGraphicsPipeline.prototype,
"updatePolicy",null);b.__decorate([p.property()],a.FeatureGraphics3DGraphicsPipeline.prototype,"suspendResumeExtentMode",void 0);a.FeatureGraphics3DGraphicsPipeline=b.__decorate([d.subclass("esri.views.3d.layers.graphics.FeatureGraphics3DGraphicsPipeline")],a.FeatureGraphics3DGraphicsPipeline);const m=new Map([["point",5E3],["polygon",500],["polyline",1E3]]);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/controllers/FeatureTileController3D":function(){define("exports ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/asyncUtils ../../../core/Collection ../../../core/has ../../../core/Error ../../../core/lang ../../../core/Logger ../../../core/maybe ../../../core/Promise ../../../core/promiseUtils ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/decorators/subclass ../../../core/support/UpdatingHandles ../../support/arcgisLayerUrl ../../support/layerUtils ../../../portal/support/geometryServiceUtils ../../../rest/support/StatisticDefinition ../../../views/3d/layers/support/FeatureTileDescriptor ../../../views/3d/layers/support/FeatureTileFetcher3D ../../../views/3d/layers/support/FeatureTileFetcher3DDebugger ../../../views/3d/support/debugFlags".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w,x,u,t,m,q,r,v,y,B,z,A){function C(H,E){if(!E)return!1;for(const F of E)if(!H.has(F))return!0;return!1}a.FeatureTileController3D=class extends c.EsriPromiseMixin(n){get dataUpdating(){return this._tileFetcher?.dataUpdating??!1}set extent(H){if(null==H||H.spatialReference.equals(this.layerView.view.spatialReference)){var E=this._get("extent");E===H||null!=E&&H&&E.equals(H)||(H=null!=H?H.clone():null,this._set("extent",H))}else d.getLogger(this).error("#extent\x3d",
"extent needs to be in the same spatial reference as the view")}get updating(){return!!(this._tileFetcher?.updating||null!=this._fetchDataInfoPromise||"tiles"===this.mode&&this.layerView.view.featureTiles?.updating||this._updatingHandles?.updating)}get updatingTotal(){return this.updating&&null!=this._tileFetcher?this._tileFetcher.updatingTotal:0}get updatingRemaining(){return this.updating&&null!=this._tileFetcher?this._tileFetcher.updatingRemaining:0}get expectedFeatureDiff(){return this.updating&&
null!=this._tileFetcher?this._tileFetcher.expectedFeatureDiff:0}get memoryForUnusedFeatures(){return null!=this._tileFetcher?this._tileFetcher.memoryForUnusedFeatures:0}get maximumNumberOfFeaturesExceeded(){return!(null==this._tileFetcher||!this._tileFetcher.maximumNumberOfFeaturesExceeded)}get maximumNumberOfFeatures(){return this.displayFeatureLimit?.maximumNumberOfFeatures??0}set maximumNumberOfFeatures(H){H!==this.maximumNumberOfFeatures&&this._overrideIfSome("maximumNumberOfFeatures",H)}get hasMaximumNumberOfFeaturesOverride(){return this._isOverridden("maximumNumberOfFeatures")}get hasAllFeatures(){return this.serviceDataCount===
a.FeatureTileController3DConstants.noServiceDataCount&&"snapshot"===this.mode&&this.hasAllFeaturesInView||this.serviceDataCount===this.graphics.length}get hasAllFeaturesInView(){return this._tileFetcher?.hasAllFeatures??!1}get hasFullGeometries(){return this._tileFetcher?.hasFullGeometries??!1}get mode(){var H=this.layerView.layer;if("feature"===H.type&&null!=H.infoFor3D)return"snapshot";if("catalog-footprint"===H.type||this._forceTilesMode)return"tiles";var E=this.layerView.view;if(!1===E.qualitySettings?.graphics3D?.snapshotAvailable||
this.serviceDataCount===a.FeatureTileController3DConstants.noServiceDataCount||this._snapshotLimitExceeded||this.maximumNumberOfFeaturesExceeded||1>E.quality)return"tiles";E=(E=E&&E.featureTiles)&&E.tilingScheme;return H&&H.minScale&&this.serviceDataExtent&&E&&(H=this._approximateExtentSizeAtScale(H.minScale,E),(this.serviceDataExtent.width/H+this.serviceDataExtent.height/H)/2>a.FeatureTileController3DConstants.maxSnapshotMinScaleFactor)?"tiles":!this.maximumNumberOfFeatures||this.serviceDataCount<=
this.maximumNumberOfFeatures?"snapshot":"tiles"}get maxTotalSnapshotVertices(){const H=this._get("maxTotalSnapshotVertices")||0;return Math.max(H,"snapshot"===this.mode&&this._tileFetcher?.totalVertices||0)}_approximateExtentSizeAtScale(H,E){const F=this.layerView.view,G=E.levels[0];return(G.tileSize[0]/(G.scale/H)+G.tileSize[1]/(G.scale/H))/2*Math.ceil((F.width/E.pixelSize+F.height/E.pixelSize)/2)}get tileDescriptors(){if("snapshot"===this.mode){var H=new y.FeatureTileDescriptor(0,0,0,this.layerView.view.featureTiles.tilingScheme);
H.id="dummy-tile-full-extent";return new p([H])}return(H=this.layerView.view.featureTiles)?H.tiles:new p}get test(){}constructor(H){super(H);this.type="feature-tile-3d";this._updatingHandles=new t.UpdatingHandles;this.serviceDataExtent=null;this.serviceDataCount=a.FeatureTileController3DConstants.noServiceDataCount;this._snapshotLimitExceeded=!1;this.displayFeatureLimit=null;this._suspended=this._forceTilesMode=!1;this._fetchDataInfoAbortController=this._fetchDataInfoPromise=this._tileFetcher=null;
this._lifeCycleAbortController=new AbortController}initialize(){this._updatingHandles.add(()=>this.displayFeatureLimit,H=>this._updatingHandles.addPromise(this._updateSnapshotLimit(H,null,this._lifeCycleAbortController.signal)));this._updatingHandles.add(()=>this.mode,()=>this._modeChanged(),w.initial);this._updatingHandles.add(()=>this.mode,(H,E)=>{"tiles"===H&&"snapshot"===E&&(this._forceTilesMode=!0)},w.initial);this.addResolvingPromise(Promise.resolve().then(()=>this._verifyCapabilities()).then(()=>
this._updatingHandles.addPromise(this._fetchServiceDataInfo())).then(()=>this._initializeTileFetcher()))}_verifyCapabilities(){const H=this.layerView.layer;if("ogc-feature"!==H.type&&!q.getEffectiveLayerCapabilities(H)?.operations.supportsQuery)throw new e("graphicscontroller:query-capability-required","Service requires query capabilities to be used as a feature layer",{layer:H});}destroy(){this._cancelFetchServiceDataInfo();this._tileFetcher=f.destroyMaybe(this._tileFetcher);this._tilesHandle=f.removeMaybe(this._tilesHandle);
this._lifeCycleAbortController=f.abortMaybe(this._lifeCycleAbortController);this._updatingHandles.destroy();this._set("_updatingHandles",null)}suspend(){this._suspended||(this._suspended=!0,null!=this._tileFetcher&&this._tileFetcher.suspend())}resume(){this._suspended&&(this._suspended=!1,null!=this._tileFetcher&&this._tileFetcher.resume())}restart(){const H=()=>{null!=this._tileFetcher&&this._tileFetcher.restart()};this._updatingHandles.addPromise(this._fetchServiceDataInfo().then(H,H))}refetch(){this._refetch({resetForceTilesMode:!1})}getMissingAttributesForFeature(H){return this._tileFetcher?.getMissingAttributesForFeature(H)}_refetch(H){const E=
()=>{null!=this._tileFetcher&&(H.resetForceTilesMode&&(this._forceTilesMode=!1),this._tileFetcher.refetch())};this._updatingHandles.addPromise(this._fetchServiceDataInfo().then(E,E))}_initializeTileFetcher(){const H=this.layerView.view;if(H){var E=w.whenOnce(()=>H.featureTiles?.tilingScheme,this._lifeCycleAbortController.signal);this._updatingHandles.addPromise(E);E.then(()=>{const {layerView:F,tileDescriptors:G}=this,D=F.layer,I=new B.FeatureTileFetcher3D({context:this.context,filterExtent:this.extent,
tileDescriptors:G,features:this.graphics});this._tileFetcher=I;this._suspended?I.suspend():I.resume();const J=this.layerView.view;J&&this.addHandles(w.watch(()=>J.quality,M=>I.memoryFactor=M,w.syncAndInitial));const N="polygon"===this.context.geometryType?"polygonLodFactor":"polyline"===this.context.geometryType?"polylineLodFactor":null;N&&this.addHandles(w.watch(()=>this.layerView.view?.qualitySettings?.graphics3D?.[N],M=>I.lodFactor=M||1,w.initial));"ogc-feature"!==D.type&&this._updatingHandles.add(()=>
D.createQueryVersion,()=>this._dataFilterChanged());this._updatingHandles.add(()=>F.availableFields,(M,Q)=>this._availableFieldsChanged(Q,M));this._updatingHandles.add(()=>F.requiredFields,(M,Q)=>this._requiredFieldsChanged(Q,M));"customParameters"in D&&this._updatingHandles.add(()=>D.customParameters,()=>this.restart());this.addHandles([D.on("apply-edits",M=>this._applyEdits(M)),w.watch(()=>this.extent,M=>I.filterExtent=M,w.sync),w.watch(()=>this.tileDescriptors,M=>I.tileDescriptors=M,w.sync),w.watch(()=>
this.maximumNumberOfFeatures,M=>{I.maximumNumberOfFeatures=M;I.useTileCount=this.serviceDataCount>M},w.syncAndInitial),w.watch(()=>this.serviceDataCount,M=>{I.useTileCount=M>this.maximumNumberOfFeatures},w.syncAndInitial),w.watch(()=>A.debugFlags.FEATURE_TILE_FETCH_SHOW_TILES,M=>{M&&I&&!I.debugger?(I.debugger=new z.FeatureTileFetcher3DDebugger(I,J.featureTiles.tilingScheme.toTileInfo(),J),I.debugger.update()):!M&&this._tileFetcher&&I.debugger&&(I.debugger.destroy(),I.debugger=null)},w.syncAndInitial)]);
this._supportsExceedsLimitQuery||this._updatingHandles.add(()=>this.maxTotalSnapshotVertices,()=>this._updatingHandles.addPromise(this._updateSnapshotLimit(this.displayFeatureLimit,null,this._lifeCycleAbortController.signal)))}).catch(()=>{})}}_modeChanged(){switch(this.mode){case "tiles":this._tilesHandle||(this._tilesHandle=this.layerView.view.featureTiles.addClient());break;default:d.getLogger(this).warn("Unhandled feature layer mode "+this.mode);case "snapshot":null!=this._tilesHandle&&(this._tilesHandle.remove(),
this._tilesHandle=null)}}_dataFilterChanged(){this._set("maxTotalSnapshotVertices",0);this.notifyChange("maxTotalSnapshotVertices");this._refetch({resetForceTilesMode:!0})}_applyEdits(H){const E=this.layerView.layer;null!=this._tileFetcher&&this._tileFetcher.applyEdits(H).then(F=>{if(F){if(!this._lifeCycleAbortController)throw l.createAbortError();F.exceededTransferLimit&&"refresh"in E?E.refresh():(F.deletedFeatures.length||F.updatedFeatures.length||F.addedFeatures.length)&&this._updatingHandles.addPromise(this._updateServiceDataExtent(this._lifeCycleAbortController.signal))}}).catch(F=>
{if(!l.isAbortError(F))throw F;})}_availableFieldsChanged(H,E){null!=this._tileFetcher&&C(this._tileFetcher.availableFields,E)&&this._refetch({resetForceTilesMode:!1})}_requiredFieldsChanged(H,E){null!=this._tileFetcher&&C(this._tileFetcher.availableFields,E)&&this.restart()}_createVertexLimitExceededQuery(H){const E=this.layerView.layer,F=E.createQuery();F.returnGeometry=!1;F.outStatistics=[new v({statisticType:"exceedslimit",maxVertexCount:H,outStatisticFieldName:"exceedslimit",maxPointCount:1E8,
maxRecordCount:1E8})];E.capabilities?.query.supportsCacheHint&&(F.cacheHint=!0);return F}_createDataInfoQuery(){const H=this.layerView.layer,E=H.createQuery();E.returnGeometry=!1;E.outSpatialReference=this.layerView.view.spatialReference;H.capabilities?.query.supportsCacheHint&&(E.cacheHint=!0);return E}_fullExtentIsAccurate(){const H=this.layerView.layer;if("definitionExpression"in H&&H.definitionExpression)return!1;switch(H.type){case "feature":case "catalog-footprint":case "oriented-imagery":return m.isHostedAgolService(H.url);
case "csv":case "geojson":case "ogc-feature":case "wfs":return!0}}async _updateServiceDataExtent(H){try{await this._tryUpdateServiceDataExtent(H)}catch(E){l.isAbortError(E)||this._set("serviceDataExtent",g.clone(this.layerView.fullExtentInLocalViewSpatialReference))}}async _tryUpdateServiceDataExtent(H){var E=this.layerView;const F=E.layer,G=F.capabilities?.query.supportsExtent??!1,D=g.clone(E.fullExtentInLocalViewSpatialReference),I=F.fullExtent,J=this._fullExtentIsAccurate(),N=this.serviceDataCount;
G&&N<=a.FeatureTileController3DConstants.maxFeatureCountForExtent&&(!D||!J)&&"queryExtent"in F?(E=this._createDataInfoQuery(),H=await F.queryExtent(E,{timeout:a.FeatureTileController3DConstants.queryExtentTimeout,signal:H}),this._set("serviceDataExtent",H.extent)):D?this._set("serviceDataExtent",D):null!=I?(H=await r.projectGeometry(I,E.view.spatialReference,"portalItem"in F?F.portalItem:null,H),this._set("serviceDataExtent",H)):this._set("serviceDataExtent",null)}async _updateServiceDataCount(H){const E=
this.layerView.layer;if("queryFeatureCount"in E&&h("featurelayer-snapshot-enabled"))if(H=await k.result(E.queryFeatureCount(this._createDataInfoQuery(),{timeout:a.FeatureTileController3DConstants.queryStatisticsTimeout,signal:H})),!0===H.ok)this._set("serviceDataCount",H.value);else{if(l.isAbortError(H.error))throw H.error;this._set("serviceDataCount",a.FeatureTileController3DConstants.noServiceDataCount)}else this._set("serviceDataCount",a.FeatureTileController3DConstants.noServiceDataCount)}get _supportsExceedsLimitQuery(){const H=
this.layerView.layer;return null!=H.capabilities&&H.capabilities.operations&&H.capabilities.operations.supportsExceedsLimitStatistics}get _minimumNumberOfVerticesForGeometry(){switch(this.layerView.layer.geometryType){case "point":return 1;case "multipoint":return 1;case "polygon":return 4;case "polyline":return 2;case "multipatch":case "mesh":return 3;case null:return 0;default:return 0}}async _updateSnapshotLimit(H,E,F){if(null==H?.averageSymbolComplexity)this._snapshotLimitExceeded=!1;else{var {maximumTotalNumberOfVertices:G,
averageSymbolComplexity:D}=H,{verticesPerFeature:I,verticesPerCoordinate:J}=D;H=1<this._minimumNumberOfVerticesForGeometry;if(0>=I||H){0!==I&&null!=E&&await E;var N=Math.min(G,1E6);E=this.serviceDataCount;var M=E!==a.FeatureTileController3DConstants.noServiceDataCount;N=M?Math.ceil((N-E*I)/(J||1)):Math.ceil(N/(J||1));H&&(N=Math.min(N,5E6));if(M&&this._minimumNumberOfVerticesForGeometry*E>N)this._snapshotLimitExceeded=!0;else if(this._supportsExceedsLimitQuery&&h("featurelayer-snapshot-enabled"))if(F=
await k.result(this.layerView.layer.queryFeatures(this._createVertexLimitExceededQuery(N),{timeout:a.FeatureTileController3DConstants.queryStatisticsTimeout,signal:F})),!1===F.ok){if(l.isAbortError(F.error))throw F.error;this._snapshotLimitExceeded=!1}else F=F.value.features[0],this._snapshotLimitExceeded=F?.attributes?!!F.attributes.exceedslimit:!1;else this._snapshotLimitExceeded=this.maxTotalSnapshotVertices>N}else this._snapshotLimitExceeded=!1}}async _fetchServiceDataInfo(){this._cancelFetchServiceDataInfo();
let H=new AbortController;const E=H.signal;var F=this._updateServiceDataCount(E);F=Promise.allSettled([F,this._updateSnapshotLimit(this.displayFeatureLimit,F,E)]);const G=F.then(()=>this._updateServiceDataExtent(E)).catch(D=>{l.isAbortError(D)||d.getLogger(this).error("#fetchServiceDataInfo()",D)}).then(()=>{G===this._fetchDataInfoPromise&&(this._fetchDataInfoAbortController=this._fetchDataInfoPromise=null);H=null});H&&(this._fetchDataInfoPromise=G);this._fetchDataInfoAbortController=H;return F.then(()=>
{},()=>{})}_cancelFetchServiceDataInfo(){const H=this._fetchDataInfoAbortController;H&&(this._fetchDataInfoPromise=this._fetchDataInfoAbortController=null,H.abort())}get performanceInfo(){return{storedFeatures:this._tileFetcher?.storedFeatures??0,totalFeatures:this._tileFetcher?.totalFeatures??0,totalVertices:this._tileFetcher?.totalVertices??0,missingTiles:this._tileFetcher?.missingTiles??0}}};b.__decorate([x.property({readOnly:!0})],a.FeatureTileController3D.prototype,"type",void 0);b.__decorate([x.property({constructOnly:!0})],
a.FeatureTileController3D.prototype,"graphics",void 0);b.__decorate([x.property({constructOnly:!0})],a.FeatureTileController3D.prototype,"layerView",void 0);b.__decorate([x.property({constructOnly:!0})],a.FeatureTileController3D.prototype,"context",void 0);b.__decorate([x.property({readOnly:!0})],a.FeatureTileController3D.prototype,"dataUpdating",null);b.__decorate([x.property()],a.FeatureTileController3D.prototype,"extent",null);b.__decorate([x.property()],a.FeatureTileController3D.prototype,"updating",
null);b.__decorate([x.property({readOnly:!0})],a.FeatureTileController3D.prototype,"_updatingHandles",void 0);b.__decorate([x.property()],a.FeatureTileController3D.prototype,"updatingTotal",null);b.__decorate([x.property()],a.FeatureTileController3D.prototype,"updatingRemaining",null);b.__decorate([x.property()],a.FeatureTileController3D.prototype,"expectedFeatureDiff",null);b.__decorate([x.property()],a.FeatureTileController3D.prototype,"memoryForUnusedFeatures",null);b.__decorate([x.property()],
a.FeatureTileController3D.prototype,"maximumNumberOfFeaturesExceeded",null);b.__decorate([x.property({readOnly:!0})],a.FeatureTileController3D.prototype,"serviceDataExtent",void 0);b.__decorate([x.property({readOnly:!0})],a.FeatureTileController3D.prototype,"serviceDataCount",void 0);b.__decorate([x.property()],a.FeatureTileController3D.prototype,"_snapshotLimitExceeded",void 0);b.__decorate([x.property()],a.FeatureTileController3D.prototype,"displayFeatureLimit",void 0);b.__decorate([x.property({type:Number})],
a.FeatureTileController3D.prototype,"maximumNumberOfFeatures",null);b.__decorate([x.property({readOnly:!0})],a.FeatureTileController3D.prototype,"hasAllFeatures",null);b.__decorate([x.property({readOnly:!0})],a.FeatureTileController3D.prototype,"hasAllFeaturesInView",null);b.__decorate([x.property({readOnly:!0})],a.FeatureTileController3D.prototype,"hasFullGeometries",null);b.__decorate([x.property()],a.FeatureTileController3D.prototype,"_forceTilesMode",void 0);b.__decorate([x.property({readOnly:!0})],
a.FeatureTileController3D.prototype,"mode",null);b.__decorate([x.property({readOnly:!0})],a.FeatureTileController3D.prototype,"maxTotalSnapshotVertices",null);b.__decorate([x.property({readOnly:!0})],a.FeatureTileController3D.prototype,"tileDescriptors",null);b.__decorate([x.property()],a.FeatureTileController3D.prototype,"_tileFetcher",void 0);b.__decorate([x.property()],a.FeatureTileController3D.prototype,"_fetchDataInfoPromise",void 0);a.FeatureTileController3D=b.__decorate([u.subclass("esri.layers.graphics.controllers.FeatureTileController3D")],
a.FeatureTileController3D);a.FeatureTileController3DConstants=void 0;(function(H){H.noServiceDataCount=Infinity;H.maxSnapshotMinScaleFactor=5;H.reset=function(){H.maxFeatureCountForExtent=1E4;H.queryStatisticsTimeout=12E3;H.queryExtentTimeout=1E4}})(a.FeatureTileController3DConstants||(a.FeatureTileController3DConstants={}));a.FeatureTileController3DConstants.reset();Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/support/FeatureTileFetcher3D":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/has ../../../../core/Logger ../../../../core/MapUtils ../../../../core/promiseUtils ../../../../core/ReactiveMap ../../../../core/reactiveUtils ../../../../core/scheduling ../../../../core/signal ../../../../core/accessorSupport/decorators/property ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ../../../../geometry/support/aaBoundingRect ../../../../layers/graphics/dehydratedFeatures ../../../../rest/support/QuantizationParameters ../../../../rest/support/Query ../../../ViewingMode ./featureReference ./FeatureTile ../../terrain/tileUtils ../../../support/Scheduler".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w,x,u,t,m,q,r,v,y,B,z){function A(J){return"dummy-tile-full-extent"===J.id}function C(J){let N=0;for(const M of J)M.features&&0<M.features.length&&M.alive&&(N=Math.max(N,M.descriptor.lij[0]));return N}function H(J){J.setFeatures([],0,null,void 0);J.featuresMissing=!1;return y.FetchStatus.DONE}function E(J){return null==J?new Set:new Set(J.map(N=>N.name))}function F(J,N){if(null==J||null==N)return E(N);const M=new Set;for(const {name:Q}of N)J.has(Q)&&M.add(Q);return M}
function G(J,N){if(!N?.length)return J;J??=new Map;const M=()=>new Set;for(const {objectId:Q,attribute:O}of N)h.getOrCreateMapValue(J,Q,M).add(O);return J}a.FeatureTileFetcher3D=class extends n{set maximumNumberOfFeatures(J){J=J||Infinity;const N=this._get("maximumNumberOfFeatures");J===N||1>J||(this._set("maximumNumberOfFeatures",J),this._maximumFeaturesUpdated(N,J))}set memoryFactor(J){this.memoryFactor!==J&&(this._set("memoryFactor",J),this._setDirty())}set lodFactor(J){this.lodFactor!==J&&(this._set("lodFactor",
J),this._supportsResolution&&this.refetch())}get useTileCount(){return this._useTileCount&&null!=this.context.query.queryFeatureCount}set useTileCount(J){this._useTileCount=J;this.notifyChange("useTileCount")}get updating(){return this._dirty||!!this._pendingEdits||this._isFetching||(this.tileDescriptors?.updating??!1)}get memoryForUnusedFeatures(){let J=0;this._featureTiles.forEach(N=>J+=N.estimatedUnusedSize);return J}get totalVertices(){let J=0;this._featureTiles.forEach(N=>J+=N.numVertices);return J}get totalFeatures(){let J=
0;this._featureTiles.forEach(N=>J+=N.numFeatures);return J}get hasAllFeatures(){if(this._paused||this.dataUpdating)return!1;for(const J of this._featureTiles.values())if(!this.hasFullGeometries&&0!==J.emptyFeatureRatio||!J.hasAllFeatures)return!1;return!0}get hasFullGeometries(){return this._supportsResolution?this.tileDescriptors.some(A)||!this.context.capabilities.supportsQuantization&&"polyline"!==this.context.geometryType:!0}set filterExtent(J){if(null!=J&&this.context.tilingScheme&&!J.spatialReference.equals(this.context.tilingScheme.spatialReference))p.getLogger(this).error("#filterExtent\x3d",
"extent needs to be in the same spatial reference as the tiling scheme");else{var N=this._get("filterExtent");N===J||null!=N&&J&&N.equals(J)||(J=null!=J?J.clone():null,this._set("filterExtent",J),this._reclip(J,N))}}_updateTileZQuantization(J){this.context.viewingMode===r.ViewingMode.Global&&(J=J.computeZQuantizationFactor(),this._zQuantizationFactor.value<J&&(this._zQuantizationFactor.value=J))}get _tileZQuantization(){return this.context.isDraped?1:this._zQuantizationFactor.value}constructor(J){super(J);
this.running=this.dataUpdating=this._useTileCount=!1;this.expectedFeatureDiff=this.updatingRemaining=this.updatingTotal=0;this.maximumNumberOfFeaturesExceeded=!1;this._farRatio=this._fullRatio=1;this._zQuantizationFactor=c.signal(1);this._changes={updates:{adds:[],removes:[]},adds:[],removes:[]};this._frameTask=z.ImmediateTask;this._featureTiles=new g;this._displayingFeatureReferences=new Map;this._numDisplayingFeatureReferences=0;this._dirty=!1;this._suspended=!0;this._pendingEdits=null;this._isFetching=
this._applyEditsTilesUpdated=!1}initialize(){this.addHandles([d.on(()=>this.tileDescriptors,"change",()=>this._setDirty(),{sync:!0,onListenerAdd:()=>this._setDirty()}),d.watch(()=>this._tileZQuantization,()=>this.refetch())]);this._objectIdField=this.context.objectIdField;this.FeatureReferenceClass=this.context.capabilities.supportsMultipleResolutions?v.MultiFeatureReference:v.SingleFeatureReference;const J=this.context.scheduler;null!=J&&(this._frameTask=J.registerTask(z.TaskPriority.FEATURE_TILE_FETCHER,
this));this._setDirty()}destroy(){this._frameTask.remove();this._featureTiles.forEach(J=>{this._cancelFetchTile(J);this._removeTile(J)});this._featureTiles.clear();this._displayingFeatureReferences.clear();this._pendingEdits?.controller.abort();this._pendingEdits=null}get _paused(){return this._suspended||!!this._pendingEdits}restart(){this._featureTiles.forEach(J=>{this._cancelFetchTile(J);this._clearTile(J);this._resetFetchTile(J)});null!=this.context.memoryCache&&this.context.memoryCache.clear();
this._setDirty()}refetch(){this._featureTiles.forEach(J=>{this._cancelFetchTile(J);this._resetFetchTile(J)});null!=this.context.memoryCache&&this.context.memoryCache.clear();this._setDirty()}suspend(){this._suspended||(this._suspended=!0,this._pause(),this._setDirty())}resume(){this._suspended&&(this._suspended=!1,this._unpause())}getMissingAttributesForFeature(J){for(const N of this._featureTiles.values()){const M=N.missingAttributes?.get(J);if(null!=M)return M}}_pause(){this._paused&&(this._featureTiles.forEach(J=>
this._cancelFetchTile(J)),this._updated())}_unpause(){this._paused||this._setDirty()}get availableFields(){let J=null;this._featureTiles.forEach(N=>{null!=N.displayingFeatures&&0!==N.displayingFeatures.length&&(null==J?J=new Set(N.availableFields):J.forEach(M=>{N.availableFields.has(M)||J.delete(M)}))});return null!=J?J:new Set}applyEdits(J){this._pendingEdits||(this._pendingEdits={edits:Promise.resolve(),count:0,controller:new AbortController},this._pause());const N=this._pendingEdits;N.count++;
const M=N.edits.then(()=>J.result.catch(Q=>{if(e.isAbortError(Q))throw Q;return null}).then(Q=>{if(!Q)return Q;this._applyEditsDeleteFeatures(Q.deletedFeatures);return this._applyEditsAddUpdateFeatures(Q.addedFeatures,Q.updatedFeatures,N.controller.signal).then(()=>Q)}).then(Q=>{0===--N.count&&(this._pendingEdits===N&&(this._pendingEdits=null),null!=this.context.memoryCache&&this.context.memoryCache.clear(),this._applyEditsTilesUpdated=!1,this._unpause());return Q}));N.edits=M;this._updated();return M}_applyEditsDeleteFeatures(J){if(0!==
J.length){var N=this.context.globalIdField,M=N&&this.availableFields.has(N),Q=new Set,O=this._objectIdField;J.forEach(({objectId:K,globalId:L})=>{(!K||0>K)&&N&&L&&(M||p.getLogger(this).errorOncePerTick(`Editing the specified service requires the layer's globalIdField, ${N} to be included the layer's outFields for updates to be reflected in the view`),K=this._objectIdFromGlobalId(L,O,N));null!=K&&0<=K&&Q.add(K)});this._featureTiles.forEach(K=>{if(K.features){var L=K.features.filter(P=>!Q.has(t.getObjectId(P,
this._objectIdField)));L.length!==K.features.length&&(this._applyEditsTileUpdated(),K.setFeatures(L,0,K.availableFields,K.missingAttributes),this._updateTileZQuantization(K),this._invalidateCounts())}})}}_objectIdFromGlobalId(J,N,M){if(null==J)return null;const Q=this.features.find(O=>O.attributes?.[M]===J);return Q?t.getObjectId(Q,N):null}async _applyEditsAddUpdateFeatures(J,N,M){const {objectIdField:Q,globalIdField:O}=this.context,K=O&&this.availableFields.has(O),L=new Set,P=new Set;for(const W of J)J=
W.objectId,null!=J&&L.add(J);for(const {objectId:W,globalId:V}of N)N=W,(null==N||0>N)&&O&&(K||p.getLogger(this).errorOncePerTick(`Editing the specified service requires the layer's globalIdField, ${O} to be included the layer's outFields for updates to be reflected in the view`),N=this._objectIdFromGlobalId(V,Q,O)),null!=N&&0<=N&&(L.add(N),P.add(N));if(0!==L.size){var R=[];this._featureTiles.forEach(W=>{(W=this._applyEditsAddUpdateTile(W,L,P,M))&&R.push(W)});this._updated();await Promise.allSettled(R)}}async _applyEditsAddUpdateTile(J,
N,M,Q){if(J.features){var O=this._createQuery(J);O.resultType=void 0;O.cacheHint=!1;O.objectIds=Array.from(N);N=await this._queryFeatures(O,Q);Q=null;0<M.size&&(O=J.features.filter(K=>!M.has(t.getObjectId(K,this._objectIdField))),O.length!==J.features.length&&(Q=O));if(0<N.features.length){Q||=J.features.slice();for(const K of N.features)Q.push(K)}Q&&(J.hasPreciseFeatureCount&&(J.numFeatures=Math.max(J.numFeatures,Q.length)),this._applyEditsTileUpdated(),J.setFeatures(Q,0,F(J.availableFields,N.fields),
G(J.missingAttributes,N.missingAttributes)),this._updateTileZQuantization(J),this._invalidateCounts())}}_applyEditsTileUpdated(){this._applyEditsTilesUpdated||(this._applyEditsTilesUpdated=!0,this._updated())}_queryFeatures(J,N){return this.context.query.queryFeaturesDehydrated(J,{signal:N,timeout:6E5})}_setDirty(){this._dirty=!0;this._updated()}runTask(J){const N=this._frameTask.processQueue(J);if(!this._dirty||!this.initialized)return N;this._dirty=!1;const M=this._getListOfTiles();this._markTilesNotAlive(M);
if(J.run(()=>this._addTiles(M,J))&&J.run(()=>this._filterExtentTiles(M,J))&&J.run(()=>this._removeTiles(M,J))&&!J.done){var Q=this._sortTiles(M);J.run(()=>this._showTiles(Q,J))&&J.run(()=>this._fetchTiles(Q,J))&&J.run(()=>this._updateMemoryEstimates(Q,J))||this._setDirty();this._updated();this.updating||this._updateMaximumNumberOfFeaturesExceeded()}else this._setDirty()}_markTilesNotAlive(J){for(const N of J)N.alive=!1}_addTiles(J,N){if(this._suspended||!this.tileDescriptors)return!1;this.tileDescriptors.forEach(M=>
{const Q=this._featureTiles.get(M.id);Q?Q.alive=!0:N.done||(J.push(this._addTile(M)),N.madeProgress())});return N.hasProgressed}_filterExtentTiles(J,N){for(const M of J){if(N.done)break;M.alive&&(M.filtered=!M.intersects(this.filterExtent),M.filtered&&(this._clearTile(M),N.madeProgress()))}return N.hasProgressed}_removeTiles(J,N){for(let M=J.length-1;0<=M&&!N.done;M--){const Q=J[M];Q.alive||(this._removeTile(Q),M!==J.length-1&&(J[M]=J[J.length-1]),J.pop(),N.madeProgress())}return N.hasProgressed}_sortTiles(J){J.sort((N,
M)=>N.descriptor.loadPriority-M.descriptor.loadPriority);return J}_showTiles(J,N){const M=this._updateRatio(J),Q=O=>{const K=1>this._fullRatio?M(O)*this._farRatio:1;O.reduceFeatures(K,this.memoryFactor,this._objectIdField)&&this._setDirty();0<(O.features?.length??0)&&O.fetchingFeatureResolution!==O.descriptor.resolution&&O.fetchStatus===y.FetchStatus.DONE&&(O.fetchStatus=y.FetchStatus.REFETCH_NEEDED,this._setDirty());return this._showTile(O)};for(const O of J)if(!N.run(()=>Q(O))){this._setDirty();
break}return N.hasProgressed}_fetchTiles(J,N){if(this._paused)return!1;var M=!1;for(const O of J)if(O.needsFetching){var Q=null!=this.context.memoryCache?this.context.memoryCache.pop(O.id):null;if(null!=Q)O.cache=Q,O.numFeatures&&this._notifyDataUpdating(),this._setDirty(),this._scheduleUpdated(),N.madeProgress();else if(this._needsNumFeatures(O)&&(M=new AbortController,Q=this._fetchTileCount(O,M.signal),this._handleRequest(O,Q,M,()=>O.numFeatures=y.failedFeatureCount),M=!0,N.madeProgress()),N.done)return!0}if(M)return N.hasProgressed;
for(const O of J)if(O.needsFetching&&(J=new AbortController,M=this._fetchTile(O,J.signal),this._handleRequest(O,M,J,K=>{O.setFeatures([],0,null,void 0);this._invalidateCounts();O.featuresMissing=!1;O.fetchFailed=!0;this.context.logFetchError(p.getLogger(this),K)}),N.madeProgress()))return!0;return N.hasProgressed}_updateMemoryEstimates(J,N){J.some(M=>N.run(()=>M.updateMemoryEstimates())?!1:(this._setDirty(),!0));return N.hasProgressed}_reclip(J,N){if(this.initialized){var M=[];this._featureTiles.forEach(Q=>
{null!=Q.displayingFeatures&&0!==Q.displayingFeatures.length&&(Q.intersectionIncludingBorrowed(N,D),Q.intersectionIncludingBorrowed(J,I),u.equals(D,I)||M.push(Q))});this._refreshDisplayingFeatures(M);this._updated()}}_refreshDisplayingFeatures(J){const N=new Set,M=this._changes.updates;for(const Q of J)if(null!=Q.displayingFeatures)for(const O of Q.displayingFeatures)J=t.getObjectId(O,this._objectIdField),N.has(J)||(N.add(J),J=this._displayingFeatureReferences.get(J).feature,M.removes.push(J),M.adds.push(J));
this._applyChanges()}_updated(){let J=0;this._paused||this._featureTiles.forEach(N=>N.isFetching?++J:0);this._isFetching=0<J;this._set("running",this._dirty);0<J||this._applyEditsTilesUpdated?this._notifyDataUpdating():this._dirty||this._set("dataUpdating",!1);if(this.updating){let N=0,M=0,Q=0,O=0,K=0;const L=this._displayingFeatureReferences.size/this._numDisplayingFeatureReferences;this._featureTiles.forEach(W=>{++M;if(W.isFetching&&W.hasPreciseFeatureCount){const V=this._maximumFeaturesForTile(W)*
(1-W.emptyFeatureRatio);K+=V-(null!=W.displayingFeatures?W.displayingFeatures.length*L:0)}W.needsFetching?++O:0<W.numFeatures&&(++Q,N+=W.numFeatures)});O+=J;let P=0,R=0;N?(R=N,P=Math.min(O*N/Q,N)):(R=M,P=O);K=Math.min(this.maximumNumberOfFeatures-this.features.length,K);this._set("updatingTotal",R);this._set("updatingRemaining",P);this._set("expectedFeatureDiff",K)}else this._set("updatingTotal",0),this._set("updatingRemaining",0),this._set("expectedFeatureDiff",0);this.debugger&&this.debugger.update()}_updateMaximumNumberOfFeaturesExceeded(){for(const {perTileMaximumNumberOfFeaturesExceeded:J}of this._featureTiles.values())if(J){this._set("maximumNumberOfFeaturesExceeded",
!0);return}this._set("maximumNumberOfFeaturesExceeded",!1)}_updateRatio(J){const N=C(J),M=K=>1/(1<<Math.max(0,N-K.descriptor.lij[0]));let Q=0,O=0;for(const K of J)J=K.numFeatures,Q+=J,O+=J*M(K);this._fullRatio=Math.min(1,this.maximumNumberOfFeatures/Q);this._farRatio=this.maximumNumberOfFeatures/O;this._scheduleUpdated();return M}_maximumFeaturesUpdated(J,N){J!==N&&(N>J&&this._featureTiles.forEach(M=>{if(M.featuresMissing){var Q=this._maximumFeaturesForTile(M);M.features&&(M.features.length>=Q||M.fetchStatus===
y.FetchStatus.FULL)||(this._cancelFetchTile(M),this._resetFetchTile(M))}}),this._setDirty())}_addTile(J){J=new y.FeatureTile(J);this._featureTiles.set(J.id,J);this._resetFetchTile(J);this._referenceDisplayingFeaturesFromRelatedTiles(J);return J}_referenceDisplayingFeaturesFromRelatedTiles(J){const N=J.displayingFeatureResolution;this._featureTiles.forEach(M=>{if(null!=M.displayingFeatures&&J!==M&&B.tilesAreRelated(J.descriptor.lij,M.descriptor.lij)){null==J.displayingFeatures&&(J.displayingFeatures=
[]);J.descriptor.extent&&M.descriptor.extent&&(null==J.extentIncludingBorrowedFeatures&&(J.extentIncludingBorrowedFeatures=u.clone(J.descriptor.extent)),u.expand(J.extentIncludingBorrowedFeatures,M.descriptor.extent,J.extentIncludingBorrowedFeatures));for(const Q of M.displayingFeatures)J.displayingFeatures.push(Q),M=this._displayingFeatureReferences.get(t.getObjectId(Q,this._objectIdField)),M.ref(M.feature,N),this._numDisplayingFeatureReferences++}});J.featureLimit=null!=J.displayingFeatures?J.displayingFeatures.length:
0}_removeTile(J){this._clearTile(J);this._featureTiles.delete(J.id)}_resetFetchTile(J){J.filtered=!J.intersects(this.filterExtent);J.filtered?J.needsFetching&&(J.fetchStatus=y.FetchStatus.DONE):J.fetchStatus=y.FetchStatus.FETCH_NEEDED}_cancelFetchTile(J){const N=J.requestController;null!=N&&(J.requestController=null,J.resetFetching(),N.abort())}async _fetchTileCount(J,N){J.numFeatures=await this._fetchCount(J,N);this._updateRatio(this._getListOfTiles());return J.fetchStatus===y.FetchStatus.REFETCHING?
y.FetchStatus.REFETCH_NEEDED:y.FetchStatus.FETCH_NEEDED}async _fetchTile(J,N){J.fetchFailed=!1;var M=this._maximumFeaturesForTile(J);if(0>=M)return J.hasPreciseFeatureCount&&0===J.numFeatures||(J.fetchFailed=!0),H(J);var Q=this._getMaxRecordCount(J);const O=Math.ceil(M/Q);if(A(J)||!this.context.capabilities.supportsMaxRecordCountFactor||J.numFeatures<=M&&O>q.MAX_MAX_RECORD_COUNT_FACTOR)return this._fetchPagedTile(J,N);J.fetchingFeatureResolution=J.descriptor.resolution;M=this._createQuery(J);M.maxRecordCountFactor=
O;J.isRefetching&&J.features&&0<J.features.length&&(M.maxRecordCountFactor=Math.max(Math.ceil(J.features.length/(1-J.emptyFeatureRatio)/Q)+1,M.maxRecordCountFactor));const {features:K,exceededTransferLimit:L,fields:P,missingAttributes:R}=await this._queryFeatures(M,N);Q=L?M.maxRecordCountFactor>=q.MAX_MAX_RECORD_COUNT_FACTOR?y.FetchStatus.FULL:y.FetchStatus.DONE:y.FetchStatus.FULL;await this._frameTask.schedule(()=>{J.featuresMissing=J.hasPreciseFeatureCount&&K.length<J.numFeatures||!!L;const W=this._removeEmptyFeatures(K);
J.setFeatures(K,W,E(P),G(void 0,R));this._updateTileZQuantization(J)},N);e.throwIfAborted(N);this._invalidateCounts();return Q}async _fetchCount(J,N){return this.context.query.queryFeatureCount(this._createFeatureCountQuery(J),{signal:N})}async _fetchPagedTile(J,N){let M=0,Q=0,O,K=0,L=this._maximumFeaturesForTile(J)-K;const P=this._getMaxRecordCount(J);let R=null,W;for(;;){const V=this._createQuery(J),ba=this._setPagingParameters(V,M,L,P),{features:U,exceededTransferLimit:da,fields:fa,missingAttributes:ha}=
await this._queryFeatures(V,N);await this._frameTask.schedule(()=>{ba&&(M+=V.num);K+=U.length;Q+=this._removeEmptyFeatures(U);J.featuresMissing=ba&&J.hasPreciseFeatureCount&&M<J.numFeatures||!!da;O=O?O.concat(U):U;R=F(R,fa);W=G(W,ha);J.setFeatures(O,Q,R,W);this._updateTileZQuantization(J)},N);e.throwIfAborted(N);this._invalidateCounts();this._setDirty();L=this._maximumFeaturesForTile(J)-K;if(!ba||!da||0>=L)return da?y.FetchStatus.DONE:y.FetchStatus.FULL}}_createFeatureCountQuery(J){J=this._createQuery(J);
this.context.capabilities.supportsCacheHint&&(J.resultType=void 0,J.cacheHint=!0);return J}_createQuery(J){const N=this.context.createQuery();A(J)||(N.geometry=u.toExtent(J.descriptor.extent,this.context.tilingScheme.spatialReference));this._setResolutionParams(N,J);this._useTileQuery(J)?N.resultType="tile":this.context.capabilities.supportsCacheHint&&(N.cacheHint=!0);return N}_setPagingParameters(J,N,M,Q){if(!this.context.capabilities.supportsPagination)return!1;J.start=N;0<M&&this.context.capabilities.supportsMaxRecordCountFactor?
(J.maxRecordCountFactor=Math.ceil(M/Q),J.num=Math.min(J.maxRecordCountFactor*Q,M)):J.num=Math.min(Q);return!0}_getEffectiveTileResolution(J){if(A(J))return null;const N=this.context.viewingMode===r.ViewingMode.Global?this.context.tilingScheme.resolutionAtLevel(3):Infinity;return Math.min(J.fetchingFeatureResolution,N)/this.lodFactor/this._tileZQuantization}get _supportsResolution(){return this.context.capabilities.supportsMultipleResolutions&&"point"!==this.context.geometryType}_setResolutionParams(J,
N){this._supportsResolution&&(N=this._getEffectiveTileResolution(N),null!=N&&(this.context.capabilities.supportsQuantization?J.quantizationParameters=new m({mode:"view",originPosition:"upper-left",tolerance:N,extent:this.context.fullExtent}):"polyline"===this.context.geometryType&&(J.maxAllowableOffset=N)))}_removeEmptyFeatures(J){const N=J.length;for(let M=0;M<J.length;)t.hasVertices(J[M].geometry)?++M:(J[M]=J[J.length-1],--J.length);return N-J.length}_needsNumFeatures(J){return this.useTileCount&&
J.needsFeatureCount&&!A(J)}_getMaxRecordCount(J){const {tileMaxRecordCount:N,maxRecordCount:M}=this.context;return this._useTileQuery(J)&&null!=N&&0<N&&this.context.capabilities.supportsResultType?N:null!=M&&0<M?M:2E3}_useTileQuery(J){return A(J)&&this.context.capabilities.supportsCacheHint?!1:this.context.capabilities.supportsResultType}_handleRequest(J,N,M,Q){J.fetchStatus=J.needsRefetching?y.FetchStatus.REFETCHING:y.FetchStatus.FETCHING;J.requestController=M;let O=!1;N.then(K=>{J.requestController=
null;J.fetchStatus=K}).catch(K=>{J.requestController===M&&(J.requestController=null,J.fetchStatus=y.FetchStatus.DONE);e.isAbortError(K)?O=!0:Q(K)}).then(()=>{O||this._setDirty();this._scheduleUpdated()})}_scheduleUpdated(){this.hasHandles("scheduleUpdated")||this.addHandles(f.schedule(()=>{this.removeHandles("scheduleUpdated");this._updated()}),"scheduleUpdated")}_showTile(J){if(null!=J.displayingFeatures&&!J.needsDisplayUpdate)return!1;var {features:N}=J;if(0===J.featureLimit||!N)return N=null!=
J.displayingFeatures&&0<J.displayingFeatures.length,this._hideTileFeatures(J),J.displayingFeatures=[],N;const {fetchingFeatureResolution:M}=J,{adds:Q,updates:O}=this._changes,K=Math.min(J.featureLimit,N.length);J.featureLimit=K;for(let L=0;L<K;++L){const P=N[L],R=t.getObjectId(P,this._objectIdField),W=this._displayingFeatureReferences.get(R);if(W){const {oldVersion:V,newVersion:ba}=W.ref(P,M);V!==ba&&(V&&O.removes.push(V),ba&&O.adds.push(ba))}else this._displayingFeatureReferences.set(R,new this.FeatureReferenceClass(P,
M)),Q.push(P);this._numDisplayingFeatureReferences++}this._hideTileFeatures(J);J.displayingFeatureResolution=J.fetchingFeatureResolution;this._applyChanges();J.displayingFeatures=N.slice(0,K);return!0}_hideTile(J){this._cancelFetchTile(J);this._hideTileFeatures(J)}_hideTileFeatures(J){if(null!=J.displayingFeatures){var {updates:N,removes:M}=this._changes;for(const Q of J.displayingFeatures){const O=t.getObjectId(Q,this._objectIdField),K=this._displayingFeatureReferences.get(O);if(!K)continue;const {oldVersion:L,
newVersion:P}=K.unref(J.displayingFeatureResolution);this._numDisplayingFeatureReferences--;L!==P&&(null==P?(this._displayingFeatureReferences.delete(O),L&&M.push(L)):(N.adds.push(P),L&&N.removes.push(L)))}this._applyChanges();J.displayingFeatures=null}}_notifyDataUpdating(){this._get("dataUpdating")||this._set("dataUpdating",!0)}_applyChanges(){var J=this._changes.updates;0<J.removes.length&&(this._notifyDataUpdating(),this.features.removeMany(J.removes),J.removes.length=0);0<J.adds.length&&(this._notifyDataUpdating(),
this.features.addMany(J.adds),J.adds.length=0);J=this._changes.adds;const N=this._changes.removes,M=Math.min(J.length,N.length);let Q=0;for(;Q<M;){const O=Math.min(Q+200,M);this._notifyDataUpdating();this.features.addMany(J.slice(Q,O));this.features.removeMany(N.slice(Q,O));Q=O}J.length>M&&(this._notifyDataUpdating(),this.features.addMany(0===Q?J:J.slice(Q)));N.length>M&&(this._notifyDataUpdating(),this.features.removeMany(0===Q?N:N.slice(Q)));J.length=0;N.length=0}_clearTile(J){this._hideTile(J);
J.features&&null!=this.context.memoryCache&&this.context.memoryCache.put(J.id,J.cache,16+J.estimatedSize);J.setFeatures(null,0,null,void 0);this._invalidateCounts()}_invalidateCounts(){this.notifyChange("totalVertices");this.notifyChange("totalFeatures");this.notifyChange("memoryForUnusedFeatures")}_getListOfTiles(){return Array.from(this._featureTiles.values())}get storedFeatures(){return this._getListOfTiles().reduce((J,N)=>J+(N.features?N.features.length:0),0)}get missingTiles(){return Array.from(this._featureTiles.values()).reduce((J,
N)=>J+(N.needsFetching||N.isFetching?1:0),0)}_maximumFeaturesForTile(J){const N=J.hasPreciseFeatureCount?J.numFeatures:Infinity;return Math.min(Math.ceil((J.hasPreciseFeatureCount?N:this.maximumNumberOfFeatures)*(1>this._fullRatio?this._farRatio:1)/(1-J.emptyFeatureRatio)),N)}get test(){}};b.__decorate([l.property({constructOnly:!0})],a.FeatureTileFetcher3D.prototype,"features",void 0);b.__decorate([l.property()],a.FeatureTileFetcher3D.prototype,"tileDescriptors",void 0);b.__decorate([l.property({value:Infinity})],
a.FeatureTileFetcher3D.prototype,"maximumNumberOfFeatures",null);b.__decorate([l.property({value:1})],a.FeatureTileFetcher3D.prototype,"memoryFactor",null);b.__decorate([l.property({value:1})],a.FeatureTileFetcher3D.prototype,"lodFactor",null);b.__decorate([l.property()],a.FeatureTileFetcher3D.prototype,"useTileCount",null);b.__decorate([l.property({readOnly:!0})],a.FeatureTileFetcher3D.prototype,"updating",null);b.__decorate([l.property({readOnly:!0})],a.FeatureTileFetcher3D.prototype,"dataUpdating",
void 0);b.__decorate([l.property({readOnly:!0})],a.FeatureTileFetcher3D.prototype,"running",void 0);b.__decorate([l.property({readOnly:!0})],a.FeatureTileFetcher3D.prototype,"updatingTotal",void 0);b.__decorate([l.property({readOnly:!0})],a.FeatureTileFetcher3D.prototype,"updatingRemaining",void 0);b.__decorate([l.property({readOnly:!0})],a.FeatureTileFetcher3D.prototype,"expectedFeatureDiff",void 0);b.__decorate([l.property({readOnly:!0})],a.FeatureTileFetcher3D.prototype,"memoryForUnusedFeatures",
null);b.__decorate([l.property({readOnly:!0})],a.FeatureTileFetcher3D.prototype,"maximumNumberOfFeaturesExceeded",void 0);b.__decorate([l.property({readOnly:!0})],a.FeatureTileFetcher3D.prototype,"totalVertices",null);b.__decorate([l.property({readOnly:!0})],a.FeatureTileFetcher3D.prototype,"totalFeatures",null);b.__decorate([l.property({readOnly:!0})],a.FeatureTileFetcher3D.prototype,"hasAllFeatures",null);b.__decorate([l.property({readOnly:!0})],a.FeatureTileFetcher3D.prototype,"hasFullGeometries",
null);b.__decorate([l.property()],a.FeatureTileFetcher3D.prototype,"filterExtent",null);b.__decorate([l.property({constructOnly:!0})],a.FeatureTileFetcher3D.prototype,"context",void 0);b.__decorate([l.property()],a.FeatureTileFetcher3D.prototype,"_dirty",void 0);b.__decorate([l.property()],a.FeatureTileFetcher3D.prototype,"_suspended",void 0);b.__decorate([l.property()],a.FeatureTileFetcher3D.prototype,"_pendingEdits",void 0);b.__decorate([l.property()],a.FeatureTileFetcher3D.prototype,"_applyEditsTilesUpdated",
void 0);b.__decorate([l.property()],a.FeatureTileFetcher3D.prototype,"_paused",null);b.__decorate([l.property()],a.FeatureTileFetcher3D.prototype,"_isFetching",void 0);a.FeatureTileFetcher3D=b.__decorate([x.subclass("esri.views.3d.layers.support.FeatureTileFetcher3D")],a.FeatureTileFetcher3D);const D=u.create(),I=u.create();Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/support/featureReference":function(){define("exports ../../../../core/Error ../../../../core/has ../../../../geometry/SpatialReference ../../../../geometry/support/aaBoundingBox ../../../../core/mathUtils ../../../../geometry/Extent ../../../../geometry/Geometry ../../../../geometry/Multipoint ../../../../geometry/Point ../../../../geometry/Polygon ../../../../geometry/Polyline ../../../../geometry/support/typeUtils ../../../../layers/support/Field ../../../../layers/graphics/dehydratedFeatureComparison".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w,x,u){class t{constructor(y,B){this.feature=y;this.resolution=B;this.refCount=1}}class m{get isReferenced(){return 0!==this.versions.length}get isSingle(){return 1===this.versions.length&&1===this.versions[0].refCount}constructor(y,B){this._highestResolutionVersion=null;this.versions=[];this.ref(y,B)}ref(y,B){const z=this.feature;(v.oldVersion=z)&&Object.defineProperty(y,"uid",{value:z.uid,configurable:!0});const A=this._highestResolutionVersion;for(var C of this.versions)if(C.resolution===
B){C.refCount++;if((B=A===C&&!u.equals(y,C.feature))||A!==C)C.feature=y;v.newVersion=B?y:z;return v}C=new t(y,B);this.versions.push(C);!A||B<A.resolution?(v.newVersion=y,this._highestResolutionVersion=C):v.newVersion=z;return v}unref(y){const {versions:B}=this;for(let z=0;z<B.length;z++){const A=B[z];if(A.resolution===y)return A.refCount--,r.oldVersion=this.feature,0===A.refCount&&(B[z]=B[B.length-1],--B.length,this._highestResolutionVersion===A&&(this._recalculateHighestResolutionVersion(),r.oldVersion=
A.feature)),r.newVersion=this.feature,r}y=`Unref feature (SR) with no references: ${this.feature?.uid}`;throw new b(y,y,Error().stack?.slice(6));}get feature(){return this._highestResolutionVersion?.feature??null}_recalculateHighestResolutionVersion(){if(0===this.versions.length)this._highestResolutionVersion=null;else{var y=this.versions[0];for(let B=1;B<this.versions.length;B++){const z=this.versions[B];z.resolution<y.resolution&&(y=z)}this._highestResolutionVersion=y}}}class q{get isReferenced(){return 0!==
this._refCount}get isSingle(){return 1===this._refCount}constructor(y){this._feature=y;this._refCount=1}ref(y){++this._refCount;const B=this._feature;(v.oldVersion=B)&&Object.defineProperty(y,"uid",{value:B.uid,configurable:!0});u.equals(B,y)||(this._feature=y);v.newVersion=this._feature;return v}unref(){r.oldVersion=this._feature;var y=this._refCount;if(0<y){if(this._refCount=y-1,1===y)return r.newVersion=null,r}else throw y=`Unref feature (SR) with no references: ${this._feature?.uid}`,new b(y,
y,Error().stack?.slice(6));r.newVersion=this._feature;return r}get feature(){return this._feature}}const r={oldVersion:null,newVersion:null},v={oldVersion:null,newVersion:null};a.FeatureVersion=t;a.MultiFeatureReference=m;a.SingleFeatureReference=q;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/support/FeatureTile":function(){define("exports ../../../../core/arrayUtils ../../../../core/signal ../../../../geometry/support/aaBoundingRect ../../../../layers/graphics/dehydratedFeatures ../graphics/graphicUtils".split(" "),
function(a,b,n,k,p,h){const e=new Set;class g{constructor(f){this.descriptor=f;this.fetchStatus=a.FetchStatus.FETCH_NEEDED;this.fetchingFeatureResolution=this.displayingFeatureResolution=0;this._featuresLength=n.signal(0);this._numVertices=0;this._featuresMissing=n.signal(!0);this._fetchFailed=n.signal(!1);this._shuffled=!1;this._numFeatures=-1;this._emptyFeatureRatio=n.signal(0);this._estimatedSize=-1;this._estimatedUnusedSize=0;this._estimatedUnusedSizeDirty=!1;this._displayingFeatures=null;this.alive=
!0;this.filtered=!1;this._features=null;this._featureLimit=n.signal(0);this._availableFields=e;this.displayingFeatureResolution=this.fetchingFeatureResolution=f.resolution}get featuresMissing(){return this._featuresMissing.value}set featuresMissing(f){this._featuresMissing.value=f}get missingAttributes(){return this._missingAttributes}get fetchFailed(){return this._fetchFailed.value}set fetchFailed(f){this._fetchFailed.value=f}get displayingFeatures(){return this._displayingFeatures}set displayingFeatures(f){this._displayingFeatures=
f;this.extentIncludingBorrowedFeatures=null}get perTileMaximumNumberOfFeaturesExceeded(){const f=(this.fetchStatus===a.FetchStatus.DONE||this.fetchStatus===a.FetchStatus.FULL)&&this.featuresMissing;return!this.filtered&&(f||this.hasFeatureLimit)}get features(){return this._features}get featureLimit(){return this._featureLimit.value}set featureLimit(f){this._featureLimit.value!==f&&(this._featureLimit.value=f,this._estimatedUnusedSizeDirty=!0)}get hasFeatureLimit(){return this.featureLimit!==this._featuresLength.value}get hasAllFeatures(){return!(this.featuresMissing||
this.fetchFailed||this.hasFeatureLimit)}get availableFields(){return this._availableFields}setFeatures(f,c,l,w){this._availableFields=l??e;this._features=f;this._featuresLength.value=f?.length??0;this._shuffled=!1;this._estimatedSize=-1;this._estimatedUnusedSizeDirty=!0;this._missingAttributes=w;f&&0<f.length?(this._emptyFeatureRatio.value=c/(f.length+c),this._numVertices=f.reduce((x,u)=>x+p.numVertices(u.geometry),0)):this._numVertices=this._emptyFeatureRatio.value=0}computeZQuantizationFactor(){if(this._features&&
0<this._features.length){const f=this._features.reduce((c,{geometry:l})=>Math.max(c,h.computeMaxZ(l)??0),0);return Math.floor(f/this.descriptor.planetRadius)+1}return 1}get emptyFeatureRatio(){return this._emptyFeatureRatio.value}get numFeatures(){return this.hasPreciseFeatureCount?this._numFeatures:this._features?this._features.length:0}set numFeatures(f){this._numFeatures=f}get hasPreciseFeatureCount(){return-1<this._numFeatures}get needsFeatureCount(){return-1===this._numFeatures}get numVertices(){return this._numVertices}get id(){return this.descriptor.id}get estimatedSize(){this.updateMemoryEstimates();
return this._estimatedSize}get estimatedUnusedSize(){return this._estimatedUnusedSize}updateMemoryEstimates(){if(0>this._estimatedSize){this._estimatedUnusedSize=this._estimatedSize=0;if(this._features)for(var f=0;f<this._features.length;++f){const c=p.estimateSize(this._features[f]);this._estimatedSize+=c;f>=this.featureLimit&&(this._estimatedUnusedSize+=c)}return!0}if(this._estimatedUnusedSizeDirty){this._estimatedUnusedSize=0;this._estimatedUnusedSizeDirty=!1;if(this._features)for(f=this.featureLimit;f<
this._features.length;++f)this._estimatedUnusedSize+=p.estimateSize(this._features[f]);return!0}return!1}get isFetching(){return this.fetchStatus===a.FetchStatus.FETCHING||this.fetchStatus===a.FetchStatus.REFETCHING}get isRefetching(){return this.fetchStatus===a.FetchStatus.REFETCHING}get needsFetching(){return this.fetchStatus===a.FetchStatus.FETCH_NEEDED||this.fetchStatus===a.FetchStatus.REFETCH_NEEDED}get needsRefetching(){return this.fetchStatus===a.FetchStatus.REFETCH_NEEDED}get isFetched(){return this.fetchStatus===
a.FetchStatus.DONE||this.fetchStatus===a.FetchStatus.FULL}resetFetching(){this.fetchStatus=this.fetchStatus===a.FetchStatus.REFETCHING?a.FetchStatus.REFETCH_NEEDED:a.FetchStatus.FETCH_NEEDED}get needsDisplayUpdate(){var f;if(f=!!this._features){a:{f=this._features;var c=this.displayingFeatures,l=this.featureLimit;if(null==c||null==f||l!==c.length||l>f.length)f=!1;else{for(let w=0;w<l;++w)if(f[w]!==c[w]){f=!1;break a}f=!0}}f=!f}return f}intersects(f){if(null==f||!this.descriptor.extent)return!0;k.fromExtent(f,
d);return k.intersects(this.descriptor.extent,d)}intersectionIncludingBorrowed(f,c){const l=null!=this.extentIncludingBorrowedFeatures?this.extentIncludingBorrowedFeatures:this.descriptor.extent;if(!f&&!l)return k.copy(c,k.positiveInfinity),c;null!=f?(k.fromExtent(f,c),k.intersection(c,l,c)):k.copy(c,l);return c}_shuffle(f){this._features&&(this._features.sort((c,l)=>p.getObjectId(c,f)-p.getObjectId(l,f)),b.shuffle(this._features,16438),this._estimatedUnusedSizeDirty=this._shuffled=!0)}reduceFeatures(f,
c,l){if(0>=f)return!1;if(!this._features)return this.featureLimit=0,!1;let w=!1;this.featureLimit=Math.ceil(this.numFeatures*f);this.featureLimit>this._features.length&&(this.featureLimit=this._features.length,this.fetchStatus===a.FetchStatus.DONE&&0<this._features.length&&(this.fetchStatus=a.FetchStatus.REFETCH_NEEDED,w=!0));!this._shuffled&&1>f&&this._shuffle(l);f=Math.max(this.featureLimit,Math.ceil(c*this.numFeatures));this._features.length>f&&(this._features.length=f,this._featuresLength.value=
f,this.featuresMissing=!0,this.fetchStatus===a.FetchStatus.FULL&&(this.fetchStatus=a.FetchStatus.DONE));return w}get cache(){return{availableFields:this._availableFields,features:this._features,numFeatures:this._numFeatures,emptyFeatureRatio:this._emptyFeatureRatio.value,fetchStatus:this.fetchStatus,featuresMissing:this.featuresMissing}}set cache(f){this.requestController=null;this._availableFields=f.availableFields;this._features=f.features;this._featuresLength.value=f.features?.length??0;this._numFeatures=
f.numFeatures;this._emptyFeatureRatio.value=f.emptyFeatureRatio;this.fetchStatus=f.fetchStatus;this.featuresMissing=f.featuresMissing;this._estimatedSize=-1;this._estimatedUnusedSizeDirty=!0}}a.FetchStatus=void 0;(function(f){f[f.FETCH_NEEDED=0]="FETCH_NEEDED";f[f.REFETCH_NEEDED=1]="REFETCH_NEEDED";f[f.FETCHING=2]="FETCHING";f[f.REFETCHING=3]="REFETCHING";f[f.DONE=4]="DONE";f[f.FULL=5]="FULL"})(a.FetchStatus||(a.FetchStatus={}));const d=k.create();a.FeatureTile=g;a.failedFeatureCount=-2;Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/support/FeatureTileFetcher3DDebugger":function(){define("exports ../../../../Color ../../../../Graphic ../../../../symbols ../../../../core/Collection ../../../../geometry/Polygon ../../../../symbols/FillSymbol3DLayer ../../../../symbols/PointSymbol3D ../../../../symbols/PolygonSymbol3D ../../../../symbols/TextSymbol3DLayer ../../../../symbols/support/Symbol3DVerticalOffset ../../terrain/TilingScheme ../../../../symbols/callouts/LineCallout3D ../../../../symbols/callouts/LineCallout3DBorder".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w,x){const u=[[0,179,255],[117,62,128],[0,104,255],[215,189,166],[32,0,193],[98,162,206],[102,112,129],[52,125,0],[142,118,246],[138,83,0],[92,122,255],[122,55,83],[0,142,255],[81,40,179],[0,200,244],[13,24,127],[0,170,147],[19,58,241],[22,44,35]];class t{constructor(m,q,r){this._loadingGraphics=new Map;this._loadedGraphics=new Map;this._pendingGraphics=new Map;this._dataExtentGraphic=null;this._enabled=!0;this._tileFetcher=m;this._view=r;this._tilingScheme=new l.TilingScheme(q);
this._loadedSymbols=u.map(v=>new d({symbolLayers:new p([new e({material:{color:[v[0],v[1],v[2],.6]},outline:{color:"black",size:1}})])}));this._loadingSymbols=[new d({symbolLayers:new p([new e({material:{color:[200,200,200,.4]},outline:{color:[30,30,30],size:1}})])})];this._pendingSymbols=[new d({symbolLayers:new p([new e({material:{color:[100,100,100,.4]},outline:{color:[30,30,30],size:1}})])})];this._dataExtentSymbol=new d({symbolLayers:new p([new e({material:{color:[0,0,0,0]},outline:{color:"green",
size:4}})])})}destroy(){this.enabled=!1}get enabled(){return this._enabled}set enabled(m){this._enabled=m;this.update()}update(){this._enabled?(this._synchronizeMaps(this._loadingGraphics,{filter:m=>m.isFetching,symbols:this._loadingSymbols}),this._synchronizeMaps(this._loadedGraphics,{filter:m=>!m.isFetching,symbols:this._loadedSymbols}),this._synchronizeMaps(this._pendingGraphics,{filter:m=>!m.isFetching,symbols:this._pendingSymbols}),this.showDataExtent(this._tileFetcher.filterExtent)):(this._loadingGraphics.forEach(m=>
{this._view.graphics.removeMany(m)}),this._loadingGraphics.clear(),this._loadedGraphics.forEach(m=>{this._view.graphics.removeMany(m)}),this._loadedGraphics.clear(),this._pendingGraphics.forEach(m=>{this._view.graphics.removeMany(m)}),this._pendingGraphics.clear(),this._dataExtentGraphic&&(this._view.graphics.remove(this._dataExtentGraphic),this._dataExtentGraphic=null))}showDataExtent(m){this._dataExtentGraphic&&(this._view.graphics.remove(this._dataExtentGraphic),this._dataExtentGraphic=null);null!=
m&&(m=h.fromExtent(m),this._dataExtentGraphic=new n({geometry:m,symbol:this._dataExtentSymbol}),this._view.graphics.add(this._dataExtentGraphic))}_synchronizeMaps(m,q){const r=[];m.forEach((v,y)=>{const B=this._tileFetcher.test.getFeatureTileById(y);B&&q.filter(B)||(this._view.graphics.removeMany(v),r.push(y))});r.forEach(v=>m.delete(v));this._tileFetcher.test.forEachFeatureTile(v=>{if(q.filter(v)&&!m.has(v.id)){const [z,A,C]=v.descriptor.lij;this._tilingScheme.ensureMaxLod(z);var y=this._tilingScheme.getExtentGeometry(z,
A,C),B=new n({geometry:y,symbol:q.symbols[z%q.symbols.length]});y=new n({geometry:y.center,symbol:new g({verticalOffset:new c({screenLength:40/.75}),callout:new w({color:new b("white"),border:new x({color:new b("black")})}),symbolLayers:new p([new f({text:`${z}/${A}/${C}`,halo:{color:"white",size:1/.75},material:{color:"black"},size:16})])})});B=[B,y];m.set(v.id,B);this._view.graphics.addMany(B)}})}}a.FeatureTileFetcher3DDebugger=t;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/FeatureLayerViewPerformanceInfo":function(){define(["exports",
"./support/LayerViewPerformanceInfo"],function(a,b){class n extends b.LayerViewPerformanceInfo{constructor(k,p,h,e,g,d){super(k.usedMemory,k.displayedFeatures,k.totalFeatures,k.maximumFeatures,k.nodes,k.core);this.storedFeatures=p;this.totalVertices=h;this.partial=e;this.mode=g;this.symbolComplexity=d}}a.FeatureLayerViewPerformanceInfo=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DGraphicsPipeline":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/Error ../../../../core/maybe ../../../../core/Promise ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/Logger ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ../../../../core/support/UpdatingHandles ../../../../layers/graphics/controllers/FeatureTileController3D ../../../../symbols/support/utils ./elevationAlignPointsInFeatures ./Graphics3DFeatureProcessor ./QueryEngine ./queryForSymbologySnapping ../support/HeatmapFeatureProcessor ../support/LayerViewPerformanceInfo ../../webgl-engine/lib/UpdatePolicy ../../../support/Scheduler".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w,x,u,t,m,q,r,v,y,B){a.Graphics3DGraphicsPipeline=class extends p.EsriPromise{constructor(A){super(A);this._dataUpdatingState=z.NONE;this.graphicsQuery={queryForSymbologySnapping:async(C,H)=>this.symbologySnappingSupported?q.queryForSymbologySnapping(this.graphics3DProcessor,C,H):{candidates:[],sourceCandidateIndices:[]},executeQuery:(C,H)=>this.queryEngine.executeQuery(C,H),executeQueryForIds:(C,H)=>this.queryEngine.executeQueryForIds(C,H),executeQueryForCount:(C,
H)=>this.queryEngine.executeQueryForCount(C,H),executeQueryForExtent:(C,H)=>this.queryEngine.executeQueryForExtent(C,H),executeQueryForLatestObservations:(C,H)=>this.queryEngine.executeQueryForLatestObservations(C,H)};this.controller=null;this.updatingHandles=new l.UpdatingHandles;this._controllerCreated=!1;this._pendingController=null}initialize(){this.addResolvingPromise(this._initializeController());this.updatingHandles.add(()=>this.layer.renderer,C=>this._recreateProcessor(C),h.initial);this.updatingHandles.add(()=>
this.updatePolicy,C=>this.processor.preferredUpdatePolicy=C);const A=()=>this.processor.featureStore;this.queryEngine=new m.QueryEngine({context:{spatialReference:this.view.spatialReference,layer:this.layer,scheduler:this.view.resourceController.scheduler,get featureStore(){return A()},hasZ:this.hasZ,hasM:this.hasM},priority:B.TaskPriority.FEATURE_QUERY_ENGINE})}destroy(){this.removeAllHandles();this.updatingHandles.destroy();this._destroyPendingController();this.controller=k.destroyMaybe(this.controller);
this.processor=k.destroyMaybe(this.processor);this.queryEngine=k.destroyMaybe(this.queryEngine);this.loadedGraphics=null}_destroyPendingController(){this._pendingController=k.destroyMaybe(this._pendingController)}get updating(){return this.updatingHandles.updating||!this._controllerCreated||this.controller?.updating||this.processor?.updating}get legendEnabled(){return this.processor.legendEnabled}get layer(){return this.layerView.layer}get view(){return this.layerView.view}get hasZ(){return this.layerView.hasZ}get hasM(){return this.layerView.hasM}get fullOpacity(){return this.layerView.fullOpacity}get suspended(){return this.layerView.suspended}get filter(){return"filter"in
this.layerView?this.layerView.filter:null}get slicePlaneEnabled(){return this.layerView.slicePlaneEnabled}get featureSpatialReference(){return"featureSpatialReference"in this.layerView?this.layerView.featureSpatialReference:null}get graphics3DProcessor(){return"graphics-3d"===this.processor?.type?this.processor:null}get heatmapProcessor(){return"heatmap"===this.processor?.type?this.processor:null}get hasAllFeatures(){return this.controller&&"hasAllFeatures"in this.controller?this.controller.hasAllFeatures:
!1}get hasAllFeaturesInView(){return this.controller&&"hasAllFeaturesInView"in this.controller?this.controller.hasAllFeaturesInView:!1}get hasFullGeometries(){return this.controller&&"hasFullGeometries"in this.controller?this.controller.hasFullGeometries:!1}get symbologySnappingSupported(){return this.layer?.renderer?.getSymbols()?.some(x.symbolHasExtrudeSymbolLayer)??!1}get updatePolicy(){return y.UpdatePolicy.SYNC}get scaleVisibilitySuspended(){return this.processor?.scaleVisibilitySuspended}get timeExtent(){return"timeExtent"in
this.layerView?this.layerView.timeExtent:null}get dataUpdating(){return this._dataUpdatingState!==z.NONE}get suspendInfo(){return this.processor?.suspendInfo??{}}forEachGraphic(A){this.loadedGraphics.forEach(A)}findGraphic(A){return this.loadedGraphics.find(A)}queryObjectIds(A,C){return this.layerView.queryObjectIds(A,C)}whenGraphicBounds(A,C){return this.processor?.whenGraphicBounds(A,C)}computeAttachmentOrigin(A,C){return this.processor?.computeAttachmentOrigin(A,C)}async elevationAlignPointsInFeatures(A,
C){const H=this.graphics3DProcessor;if(null==H)throw new n("featurelayerview3d:missing-processor","A Graphics3D processor is needed to resolve graphics elevation.");return u.elevationAlignPointsInFeatures(this.view,this.layer,E=>H.getGraphics3DGraphicByObjectId(E),A,C)}highlight(A,C){return this.processor.highlight(A,this.layer.objectIdField,C)}maskOccludee(A){return this.processor.maskOccludee(A)}async _initializeController(){const A=this.createController();this._pendingController=A;this._setupDataUpdating(A);
await A.when();this._setControllerWhenInitialized(A)}_setupDataUpdating(A){"dataUpdating"in A&&this.addHandles([h.watch(()=>A.dataUpdating,C=>{C&&this._dataUpdatingState===z.NONE?this._dataUpdatingState=z.CONTROLLER:C||this._dataUpdatingState!==z.CONTROLLER||(this._dataUpdatingState=z.NONE)},h.sync),h.watch(()=>!!this.graphics3DProcessor?.dataUpdating,C=>{C&&this._dataUpdatingState===z.CONTROLLER?this._dataUpdatingState=z.CORE:C||this._dataUpdatingState!==z.CORE||(this._dataUpdatingState=A.dataUpdating?
z.CONTROLLER:z.NONE)},h.sync)])}async _setControllerWhenInitialized(A){try{await this.when()}catch(C){}this._controllerCreated=!0;!this.isResolved()||this.destroyed?this._destroyPendingController():(await h.whenOnce(()=>this.view?.basemapTerrain?.ready),this.beforeSetController(A),this._pendingController=null,this.controller=A,this.loadedGraphics=A.graphics)}_recreateProcessor(A){var C="heatmap"===A?.type;const H="heatmap"===this.processor?.type;A=this.processor;A&&C===H||(this.processor=C=C?new r.HeatmapFeatureProcessor({owner:this}):
new t.Graphics3DFeatureProcessor({owner:this,frustumVisibilityEnabled:!0,scaleVisibilityEnabled:!0,filterVisibilityEnabled:!0,timeExtentEnabled:!0,elevationAlignmentEnabled:!0,elevationFeatureExpressionEnabled:!0,preferredUpdatePolicy:this.updatePolicy,updateClippingExtent:E=>this._updateClippingExtent(E)}),A?.destroy(),this.queryEngine?.clear(),this.addResolvingPromise(C.when()))}_updateClippingExtent(A){this.clippingExtent=A;if(!this.controller)return!1;switch(this.controller.type){case "stream":return!1;
case "feature-tile-3d":return this.controller.extent=A,!0}}get usedMemory(){return this.processor?.usedMemory??0}get performanceInfo(){const A=this.controller instanceof w.FeatureTileController3D?this.controller:null;return new v.LayerViewPerformanceInfo(this.usedMemory,this.loadedGraphics?.length,A?.serviceDataCount??-1,A?.maximumNumberOfFeatures??-1,0,this.processor.performanceInfo)}};b.__decorate([e.property()],a.Graphics3DGraphicsPipeline.prototype,"updating",null);b.__decorate([e.property()],
a.Graphics3DGraphicsPipeline.prototype,"legendEnabled",null);b.__decorate([e.property()],a.Graphics3DGraphicsPipeline.prototype,"layerView",void 0);b.__decorate([e.property()],a.Graphics3DGraphicsPipeline.prototype,"layer",null);b.__decorate([e.property()],a.Graphics3DGraphicsPipeline.prototype,"view",null);b.__decorate([e.property()],a.Graphics3DGraphicsPipeline.prototype,"hasZ",null);b.__decorate([e.property()],a.Graphics3DGraphicsPipeline.prototype,"hasM",null);b.__decorate([e.property()],a.Graphics3DGraphicsPipeline.prototype,
"fullOpacity",null);b.__decorate([e.property()],a.Graphics3DGraphicsPipeline.prototype,"suspended",null);b.__decorate([e.property()],a.Graphics3DGraphicsPipeline.prototype,"filter",null);b.__decorate([e.property()],a.Graphics3DGraphicsPipeline.prototype,"slicePlaneEnabled",null);b.__decorate([e.property()],a.Graphics3DGraphicsPipeline.prototype,"featureSpatialReference",null);b.__decorate([e.property()],a.Graphics3DGraphicsPipeline.prototype,"loadedGraphics",void 0);b.__decorate([e.property()],a.Graphics3DGraphicsPipeline.prototype,
"graphics3DProcessor",null);b.__decorate([e.property()],a.Graphics3DGraphicsPipeline.prototype,"heatmapProcessor",null);b.__decorate([e.property()],a.Graphics3DGraphicsPipeline.prototype,"hasAllFeatures",null);b.__decorate([e.property()],a.Graphics3DGraphicsPipeline.prototype,"hasAllFeaturesInView",null);b.__decorate([e.property()],a.Graphics3DGraphicsPipeline.prototype,"hasFullGeometries",null);b.__decorate([e.property()],a.Graphics3DGraphicsPipeline.prototype,"symbologySnappingSupported",null);
b.__decorate([e.property()],a.Graphics3DGraphicsPipeline.prototype,"updatePolicy",null);b.__decorate([e.property()],a.Graphics3DGraphicsPipeline.prototype,"scaleVisibilitySuspended",null);b.__decorate([e.property()],a.Graphics3DGraphicsPipeline.prototype,"timeExtent",null);b.__decorate([e.property()],a.Graphics3DGraphicsPipeline.prototype,"_dataUpdatingState",void 0);b.__decorate([e.property({readOnly:!0})],a.Graphics3DGraphicsPipeline.prototype,"dataUpdating",null);b.__decorate([e.property()],a.Graphics3DGraphicsPipeline.prototype,
"controller",void 0);b.__decorate([e.property()],a.Graphics3DGraphicsPipeline.prototype,"processor",void 0);b.__decorate([e.property()],a.Graphics3DGraphicsPipeline.prototype,"updatingHandles",void 0);b.__decorate([e.property()],a.Graphics3DGraphicsPipeline.prototype,"_controllerCreated",void 0);a.Graphics3DGraphicsPipeline=b.__decorate([c.subclass("esri.views.3d.layers.graphics.Graphics3DGraphicsPipeline")],a.Graphics3DGraphicsPipeline);var z;(function(A){A[A.NONE=0]="NONE";A[A.CONTROLLER=1]="CONTROLLER";
A[A.CORE=2]="CORE"})(z||={});Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/support/utils":function(){define("require exports ../../Color ../../symbols ../../core/asyncUtils ../../core/has ../../core/screenUtils ../../core/libs/gl-matrix-2/factories/vec3f64 ../../layers/effects/jsonUtils ./cimSymbolUtils ./gfxUtils ./Symbol3DMaterial".split(" "),function(a,b,n,k,p,h,e,g,d,f,c,l){function w(A){A=A.symbolLayers;if(!A)return null;let C=null;A.forEach(H=>{"object"===H.type&&
H.resource?.href||(C="water"===H.type?H.color:H.material?H.material.color:null)});return C?new n(C):null}function x(A,C){if(null==C||null==A)return A;A=A.toRgba();A[3]*=C;return new n(A)}function u(A,C,H){if(A=A.symbolLayers){var E=F=>{C=C??F??(null!=H?z:null);return x(C,H)};A.forEach(F=>{if("object"!==F.type||!F.resource?.href||C)if("water"===F.type)F.color=E(F.color);else{const G=E(null!=F.material?F.material.color:null);null==F.material?F.material=new l.Symbol3DMaterial({color:G}):F.material.color=
G;null!=H&&"outline"in F&&null!=F.outline?.color&&(F.outline.color=x(F.outline.color,H))}})}}async function t(A,C){(A=A.symbolLayers)&&await p.forEach(A,async H=>m(H,C))}async function m(A,C){switch(A.type){case "extrude":A.size="number"===typeof C[2]?C[2]:0;break;case "icon":case "line":case "text":C=q(C);null!=C&&(A.size=C);break;case "path":const H=v(C,g.ONES,[A.width,void 0,A.height]);A.width=B(C[0],A.width,1,H);A.height=B(C[2],A.height,1,H);break;case "object":await r(A,C)}}function q(A){for(const C of A)if("number"===
typeof C)return C;return null}async function r(A,C){const {resourceSize:H,symbolSize:E}=await y(A),F=v(C,H,E);A.width=B(C[0],E[0],H[0],F);A.depth=B(C[1],E[1],H[1],F);A.height=B(C[2],E[2],H[2],F)}function v(A,C,H){for(let E=0;3>E;E++){const F=A[E];switch(F){case "symbol-value":return A=H[E],null!=A?A/C[E]:1;case "proportional":break;default:if(F&&C[E])return F/C[E]}}return 1}async function y(A){var {computeObjectLayerResourceSize:C}=await new Promise((I,J)=>a(["./symbolLayerUtils"],I,J));C=await C(A,
10);const {width:H,height:E,depth:F}=A;A=[H,F,E];let G=1;for(var D=0;3>D;D++){const I=A[D];if(null!=I){G=I/C[D];break}}for(D=0;3>D;D++)null==A[D]&&(A[D]=C[D]*G);return{resourceSize:C,symbolSize:A}}function B(A,C,H,E){switch(A){case "proportional":return H*E;case "symbol-value":return null!=C?C:H;default:return A}}const z=new n("white");b.applyColorToSymbol=function(A,C,H){if(A&&(C||null!=H))if(C&&=new n(C),k.isSymbol3D(A))u(A,C,H);else if(k.isSymbol2D(A)){if(C=C??A.color)A.color=x(C,H);null!=H&&"outline"in
A&&A.outline?.color&&(A.outline.color=x(A.outline.color,H))}};b.applyOpacityToColor=x;b.applyRotationToSymbol=function(A,C,H){A&&null!=C&&(k.isSymbol3D(A)?(A=A.symbolLayers)&&A.forEach(E=>{if("object"===E.type)switch(H){case "tilt":E.tilt=(E.tilt??0)+C;break;case "roll":E.roll=(E.roll??0)+C;break;default:E.heading=(E.heading??0)+C}"icon"===E.type&&(E.angle+=C)}):!k.isSymbol2D(A)||"simple-marker"!==A.type&&"picture-marker"!==A.type&&"text"!==A.type||(A.angle+=C))};b.applySizesToSymbol=async function(A,
C){if(A&&C){if(k.isSymbol3D(A))return t(A,C);if(k.isSymbol2D(A)&&(C=q(C),null!=C))switch(A.type){case "simple-marker":A.size=C;break;case "picture-marker":const H=A.width/A.height;1<H?(A.width=C,A.height=C*H):(A.width=C*H,A.height=C);break;case "simple-line":A.width=C;break;case "text":A.font.size=C}}};b.fetchWebStyleSymbol=async function(A,C){const H=await A.fetchSymbol(C);return H?H:A.fetchCIMSymbol(C)};b.getCSSFilterFromEffectList=function(A){if(!A)return null;A=A.effects.filter(C=>"bloom"!==C.type).map(C=>
C.toJSON());return d.effectFunctionsFromJSON(A)};b.getColorFromSymbol=function(A,C){if(!A)return null;let H=null;k.isSymbol3D(A)?H=w(A):k.isSymbol2D(A)&&(H="cim"===A.type?f.getCIMSymbolColor(A):A.color?new n(A.color):null);return H?x(H,C):null};b.getIconHref=function(A){return A.resource?.href??""};b.getSymbolOutlineSize=function(A){return A?k.isSymbol3D(A)?(A=(A=A.symbolLayers?.at(-1))&&"outline"in A?A?.outline?.size:void 0,null!=A?A:0):e.px2pt(c.getStroke(A)?.width):0};b.isVolumetricSymbol=function(A){if(null==
A||!("symbolLayers"in A)||null==A.symbolLayers)return!1;switch(A.type){case "point-3d":return A.symbolLayers.some(C=>"object"===C.type);case "line-3d":return A.symbolLayers.some(C=>"path"===C.type);case "polygon-3d":return A.symbolLayers.some(C=>"object"===C.type||"extrude"===C.type);default:return!1}};b.symbolHasExtrudeSymbolLayer=function(A){return null!=A&&"polygon-3d"===A.type&&A.symbolLayers.some(C=>"extrude"===C.type)};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/support/cimSymbolUtils":function(){define(["exports",
"../../Color","../cim/utils"],function(a,b,n){function k(l){l=n.toCIMSymbolJSON(l);if("CIMTextSymbol"===l?.type)return l.height??0;let w=0;if(l?.symbolLayers)for(const x of l.symbolLayers)n.isCIMMarker(x)&&null!=x.size&&x.size>w?w=x.size:n.isCIMStroke(x)&&null!=x.width&&x.width>w?w=x.width:n.isCIMFill(x);return w}function p(l,w,x,u){if(l)if("CIMTextSymbol"===l.type)null!=l.height&&(l.height*=w);else{if(x&&l.effects)for(const t of l.effects)g(t,w);if(l.symbolLayers)for(const t of l.symbolLayers)switch(t.type){case "CIMPictureMarker":case "CIMVectorMarker":h(t,
w,u);break;case "CIMPictureStroke":case "CIMSolidStroke":!u?.preserveOutlineWidth&&t.width&&(t.width*=w);break;case "CIMPictureFill":t.height&&(t.height*=w);t.offsetX&&(t.offsetX*=w);t.offsetY&&(t.offsetY*=w);break;case "CIMHatchFill":p(t.lineSymbol,w,!0,{...u,preserveOutlineWidth:!1}),t.offsetX&&(t.offsetX*=w),t.offsetY&&(t.offsetY*=w),t.separation&&(t.separation*=w)}}}function h(l,w,x){if(l&&(l.markerPlacement&&e(l.markerPlacement,w),l.offsetX&&(l.offsetX*=w),l.offsetY&&(l.offsetY*=w),l.anchorPoint&&
"Absolute"===l.anchorPointUnits&&(l.anchorPoint={x:l.anchorPoint.x*w,y:l.anchorPoint.y*w}),l.size=null!=l.size?l.size*w:0,"CIMVectorMarker"===l.type&&l.markerGraphics))for(const u of l.markerGraphics)l.scaleSymbolsProportionally||p(u.symbol,w,!0,x)}function e(l,w){n.isCIMMarkerStrokePlacement(l)&&l.offset&&(l.offset*=w);switch(l.type){case "CIMMarkerPlacementAlongLineRandomSize":case "CIMMarkerPlacementAlongLineSameSize":l.customEndingOffset&&(l.customEndingOffset*=w);l.offsetAlongLine&&(l.offsetAlongLine*=
w);if(l.placementTemplate&&l.placementTemplate.length){var x=l.placementTemplate.map(u=>u*w);l.placementTemplate=x}break;case "CIMMarkerPlacementAlongLineVariableSize":l.maxRandomOffset&&(l.maxRandomOffset*=w);l.placementTemplate&&l.placementTemplate.length&&(x=l.placementTemplate.map(u=>u*w),l.placementTemplate=x);break;case "CIMMarkerPlacementOnLine":l.startPointOffset&&(l.startPointOffset*=w);break;case "CIMMarkerPlacementAtExtremities":l.offsetAlongLine&&(l.offsetAlongLine*=w);break;case "CIMMarkerPlacementAtRatioPositions":l.beginPosition&&
(l.beginPosition*=w);l.endPosition&&(l.endPosition*=w);break;case "CIMMarkerPlacementPolygonCenter":l.offsetX&&(l.offsetX*=w);l.offsetY&&(l.offsetY*=w);break;case "CIMMarkerPlacementInsidePolygon":l.offsetX&&(l.offsetX*=w),l.offsetY&&(l.offsetY*=w),l.stepX&&(l.stepX*=w),l.stepY&&(l.stepY*=w)}}function g(l,w){switch(l.type){case "CIMGeometricEffectArrow":case "CIMGeometricEffectDonut":l.width&&(l.width*=w);break;case "CIMGeometricEffectBuffer":l.size&&(l.size*=w);break;case "CIMGeometricEffectCut":l.beginCut&&
(l.beginCut*=w);l.endCut&&(l.endCut*=w);l.middleCut&&(l.middleCut*=w);break;case "CIMGeometricEffectDashes":l.customEndingOffset&&(l.customEndingOffset*=w);l.offsetAlongLine&&(l.offsetAlongLine*=w);if(l.dashTemplate&&l.dashTemplate.length){const x=l.dashTemplate.map(u=>u*w);l.dashTemplate=x}break;case "CIMGeometricEffectExtension":case "CIMGeometricEffectJog":case "CIMGeometricEffectRadial":l.length&&(l.length*=w);break;case "CIMGeometricEffectMove":l.offsetX&&(l.offsetX*=w);l.offsetY&&(l.offsetY*=
w);break;case "CIMGeometricEffectOffset":case "CIMGeometricEffectOffsetTangent":l.offset&&(l.offset*=w);break;case "CIMGeometricEffectRegularPolygon":l.radius&&(l.radius*=w);break;case "CIMGeometricEffectTaperedPolygon":l.fromWidth&&(l.fromWidth*=w);l.length&&(l.length*=w);l.toWidth&&(l.toWidth*=w);break;case "CIMGeometricEffectWave":l.amplitude&&(l.amplitude*=w),l.period&&(l.period*=w)}}function d(l,w){if(l){var x="CIMTextSymbol"===l.type?l.symbol:l;l="CIMPolygonSymbol"===l.type;if(x?.symbolLayers)for(const u of x.symbolLayers)if(!(u.colorLocked||
l&&(n.isCIMStroke(u)||n.isCIMMarker(u)&&u.markerPlacement&&n.isCIMMarkerStrokePlacement(u.markerPlacement))))switch(u.type){case "CIMPictureMarker":case "CIMPictureStroke":case "CIMPictureFill":u.tintColor&&f(w,u.tintColor);break;case "CIMVectorMarker":u.markerGraphics?.forEach(t=>{d(t.symbol,w)});break;case "CIMSolidStroke":case "CIMSolidFill":f(w,u.color);break;case "CIMHatchFill":d(u.lineSymbol,w)}}}function f(l,w){for(const x of l)if(x.join(".")===w.join("."))return;l.push(w)}function c(l,w,x){if(l){var u=
"CIMTextSymbol"===l.type?l.symbol:l;l="CIMPolygonSymbol"===u?.type;if(u?.symbolLayers)for(const t of u.symbolLayers)if(!t.colorLocked){if(l)if(x){if({layersToColor:u}=x,(n.isCIMStroke(t)||n.isCIMMarker(t)&&t.markerPlacement&&n.isCIMMarkerStrokePlacement(t.markerPlacement))&&"fill"===u||n.isCIMFill(t)&&"outline"===u)continue}else if(n.isCIMStroke(t)||n.isCIMMarker(t)&&t.markerPlacement&&n.isCIMMarkerStrokePlacement(t.markerPlacement))continue;u=w.toArray();switch(t.type){case "CIMPictureMarker":case "CIMPictureStroke":case "CIMPictureFill":t.tintColor=
u;break;case "CIMVectorMarker":t.markerGraphics?.forEach(m=>{c(m.symbol,w,x)});break;case "CIMSolidStroke":case "CIMSolidFill":t.color=u;break;case "CIMHatchFill":c(t.lineSymbol,w,x)}}}}a.applyCIMSymbolColor=function(l,w,x){w instanceof b||(w=new b(w));(l=n.toCIMSymbolJSON(l))&&c(l,w,x)};a.applyCIMSymbolRotation=function(l,w,x=!1){l=n.toCIMSymbolJSON(l);x&&(w=360-w);if("CIMTextSymbol"===l?.type)l.angle=w;else if("CIMPointSymbol"===l?.type&&l.symbolLayers){x=w-(l.angle||0);for(const u of l.symbolLayers)if(n.isCIMMarker(u)){let t=
u.rotation||0;t=u.rotateClockwise?t-x:t+x;u.rotation=t}l.angle=w}};a.getCIMSymbolColor=function(l){l=n.toCIMSymbolJSON(l);const w=[];d(l,w);return w.length?new b(n.normalizeAlpha(w[0])):null};a.getCIMSymbolRotation=function(l,w=!1){l=n.toCIMSymbolJSON(l);return"CIMTextSymbol"===l?.type||"CIMPointSymbol"===l?.type?(l=l.angle,null!=l&&w?360-l:l??0):0};a.getCIMSymbolSize=k;a.getCIMSymbolType=function(l){l=n.toCIMSymbolJSON(l);if(!l)return null;switch(l.type){case "CIMPointSymbol":return"CIMPointSymbol";
case "CIMLineSymbol":return"CIMLineSymbol";case "CIMPolygonSymbol":return"CIMPolygonSymbol";case "CIMTextSymbol":return"CIMTextSymbol";case "CIMMeshSymbol":return"CIMMeshSymbol";default:return null}};a.scaleCIMMarker=h;a.scaleCIMSymbol=p;a.scaleCIMSymbolTo=function(l,w,x){if(l){var u=n.toCIMSymbolJSON(l);l=k(l);if(0===l){if(u)if("CIMTextSymbol"===u.type)u.height=w;else if(u.symbolLayers)for(const t of u.symbolLayers)switch(t.type){case "CIMPictureMarker":case "CIMVectorMarker":t.size=w;break;case "CIMPictureStroke":case "CIMSolidStroke":t.width=
w}}else p(u,w/l,!1,x)}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/support/gfxUtils":function(){define("exports ../../assets ../../Color ../../request ../../core/LRUCache ../../core/screenUtils ./cimSymbolUtils".split(" "),function(a,b,n,k,p,h,e){function g(w){if(!w)return null;let x=null;switch(w.type){case "simple-fill":case "picture-fill":case "simple-marker":x=g(w.outline);break;case "simple-line":const u=h.pt2px(w.width);null!=w.style&&"none"!==w.style&&0!==
u&&(x={color:w.color,style:l(w.style),width:u,cap:w.cap,join:"miter"===w.join?h.pt2px(w.miterLimit):w.join},x.dashArray=d(x).join(",")||"none");break;default:x=null}return x}function d(w){if(!w?.style)return[];const {dashArray:x,style:u,width:t}=w;if("string"===typeof x&&"none"!==x)return x.split(",").map(r=>Number(r));const m=t??0,q=f.has(u)?f.get(u).map(r=>r*m):[];if("butt"!==w.cap)for(const [r,v]of q.entries())q[r]=1===r%2?v+m:Math.max(v-m,1);return q}const f=new Map([["dash",[4,3]],["dashdot",
[4,3,1,3]],["dot",[1,3]],["longdash",[8,3]],["longdashdot",[8,3,1,3]],["longdashdotdot",[8,3,1,3,1,3]],["shortdash",[4,1]],["shortdashdot",[4,1,1,1]],["shortdashdotdot",[4,1,1,1,1,1]],["shortdot",[1,1]],["solid",[]]]),c=new p.LRUCache(1E3),l=(()=>{const w={};return x=>{if(w[x])return w[x];const u=x.replaceAll("-","");return w[x]=u}})();n=new n([128,128,128]);a.defaultThematicColor=n;a.dekebabifyLineStyle=l;a.getDashArray=d;a.getFill=function(w){const x=w.style;let u=null;if(w)switch(w.type){case "simple-marker":"cross"!==
x&&"x"!==x&&(u=w.color);break;case "simple-fill":x&&"solid"!==x?"none"!==x&&(u={type:"pattern",x:0,y:0,src:b.getAssetUrl(`esri/symbols/patterns/${x}.png`),width:5,height:5}):u=w.color;break;case "picture-fill":u={type:"pattern",src:w.url,width:h.pt2px(w.width)*w.xscale,height:h.pt2px(w.height)*w.yscale,x:h.pt2px(w.xoffset),y:h.pt2px(w.yoffset)};break;case "text":u=w.color;break;case "cim":u=e.getCIMSymbolColor(w)}return u};a.getPatternUrlWithColor=function(w,x){const u=w+"-"+x;return void 0!==c.get(u)?
Promise.resolve(c.get(u)):k(w,{responseType:"image"}).then(t=>{t=t.data;const m=t.naturalWidth,q=t.naturalHeight,r=document.createElement("canvas");r.width=m;r.height=q;const v=r.getContext("2d");v.fillStyle=x;v.fillRect(0,0,m,q);v.globalCompositeOperation="destination-in";v.drawImage(t,0,0);t=r.toDataURL();c.put(u,t);return t})};a.getStroke=g;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/elevationAlignPointsInFeatures":function(){define("exports ../../../../geometry ../../../../core/promiseUtils ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../geometry/projection/projectPointToVector ../../../../layers/graphics/dehydratedPoint ../../../../support/elevationInfoUtils ./elevationAlignmentUtils ./ElevationContext ./featureExpressionInfoUtils ../../../../geometry/SpatialReference".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c){a.elevationAlignPointsInFeatures=async function(l,w,x,u,t){const {elevationProvider:m,renderCoordsHelper:q}=l,{elevationInfo:r}=w,{pointsInFeatures:v,spatialReference:y}=u;var B=c.fromJSON(y);u=f.extractExpressionInfo(r,!0);u=await f.createContext(u,B,t);n.throwIfAborted(t);const z=[],A=new Set,C=new Set,H=new d.ElevationContext,E=h.makeDehydratedPoint(0,0,0,c.WGS84),F=new g.SampleElevationInfo,G=k.create();E.spatialReference=B;l=l.elevationProvider.spatialReference??
l.spatialReference;for(const {objectId:D,points:I}of v)if(B=x(D),null==B){for(const J of I)z.push(J.z??0);A.add(D)}else{B.isDraped&&C.add(D);H.setFromElevationInfo(e.getGeometryEffectiveElevationInfo(B.graphic.geometry,r));H.updateFeatureExpressionInfoContext(u,B.graphic,w);for(const {x:J,y:N,z:M}of I)E.x=J,E.y=N,E.z=M??0,await p.projectPointToVectorAsync(E,G,l,0,{signal:t}),g.evaluateElevationInfoAtPoint(G,m,H,q,F),z.push(F.z)}return{elevations:z,drapedObjectIds:C,failedObjectIds:A}};Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DFeatureProcessor":function(){define("exports ../../../../chunks/tslib.es6 ../../../../Graphic ../../../../arcade/functions/hash ../../../../core/compilerUtils ../../../../core/handleUtils ../../../../core/maybe ../../../../core/Promise ../../../../core/promiseUtils ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/Logger ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ../../../../core/accessorSupport/diffUtils ../../../../core/support/UpdatingHandles ../../../../geometry/support/webMercatorUtils ../../../../renderers/support/randomRotationExpression ../../../../renderers/support/renderingInfoUtils ../../../../rest/support/Query ../interfaces ./constants ./DisplayFeatureLimit ./Graphics3DCore ./Graphics3DElevationAlignment ./Graphics3DFrustumVisibility ./Graphics3DObjectStates ./Graphics3DScaleVisibility ./graphicUtils ../support/attributeUtils ../support/FeatureVisibilityFilter ../support/highlightUtils ../../webgl-engine/lib/UpdatePolicy ../../../support/HighlightDefaults".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w,x,u,t,m,q,r,v,y,B,z,A,C,H,E,F,G,D,I,J,N,M){a.Graphics3DFeatureProcessor=class extends g.EsriPromise{constructor(Q){super(Q);this.type="graphics-3d";this._randomRotationRenderers=null;this._updatingHandles=new t.UpdatingHandles;this.timeExtentEnabled=this.elevationAlignmentEnabled=this.frustumVisibilityEnabled=this.filterVisibilityEnabled=this.scaleVisibilityEnabled=this.elevationFeatureExpressionEnabled=!1;this.setUidToIdOnAdd=!0;this.dataExtent=null;this.drapeSourceType=
y.DrapeSourceType.Features;this.preferredUpdatePolicy=N.UpdatePolicy.ASYNC;this._suspendResumeExtent=null}initialize(){const Q=this.owner,O=new A.Graphics3DCore({owner:this,layer:this.layer,preferredUpdatePolicy:this.preferredUpdatePolicy,elevationFeatureExpressionEnabled:this.elevationFeatureExpressionEnabled,graphicSymbolSupported:!1,hasZ:Q.hasZ,hasM:Q.hasM,setUidToIdOnAdd:this.setUidToIdOnAdd,componentFactories:{deconflictor:K=>Q.view.deconflictor.addGraphicsOwner(K),labeler:(K,L)=>Q.view.labeler.addGraphicsOwner(K,
L),elevationAlignment:this.elevationAlignmentEnabled?(K,L)=>new C.Graphics3DElevationAlignment({graphicsCoreOwner:this,graphicsCore:K,queryGraphicUIDsInExtent:L,elevationProvider:Q.view.elevationProvider}):null,scaleVisibility:this.scaleVisibilityEnabled?(K,L)=>new F.Graphics3DScaleVisibility({graphicsCoreOwner:this,layer:this.layer,queryGraphicUIDsInExtent:L,graphicsCore:K,basemapTerrain:Q.view.basemapTerrain}):null,filterVisibility:(this.filterVisibilityEnabled||this.timeExtentEnabled)&&"multipatch"!==
Q.layer.geometryType?K=>new I.FeatureVisibilityFilter({context:{...K,configuration:Q}}):null,objectStates:K=>new E.Graphics3DObjectStates(K)}});this._set("graphicsCore",O);this.frustumVisibilityEnabled&&this._set("frustumVisibility",new H.Graphics3DFrustumVisibility({graphicsCoreOwner:this}));this.elevationAlignment&&this._updatingHandles.add(()=>this.layer.elevationInfo,(K,L)=>{u.diff(K,L)&&this._updatingHandles.addPromise(this.graphicsCore.elevationInfoChange())});this._updatingHandles.add(()=>
this.layer.labelsVisible,()=>this.graphicsCore.updateVisibilityInfo());this._updatingHandles.add(()=>this.layer.labelingInfo,(K,L)=>{u.diff(K,L)&&this.graphicsCore.updateLabelingInfo()});this._updatingHandles.add(()=>this.preferredUpdatePolicy,K=>this.graphicsCore.preferredUpdatePolicy=K);this.addResolvingPromise(this._initializeAsync())}async _initializeAsync(){await d.logOnError(this.graphicsCore.initializePromise);const Q=this.owner;this._updatingHandles.add(()=>this.renderer,O=>this._updatingHandles.addPromise(this.graphicsCore.rendererChange(O)));
this._updatingHandles.add(()=>Q.fullOpacity,()=>this.graphicsCore.opacityChange());this._setupSuspendResumeExtent();this.updateClippingExtent&&(this._updatingHandles.add(()=>Q.view.clippingArea,()=>this._updateClippingExtent()),this._updateClippingExtent());this.graphicsCore.startCreateGraphics();this.graphicsCore.labelsEnabled&&await d.logOnError(this.graphicsCore.updateLabelingInfo())}destroy(){this._updatingHandles.destroy();this._set("frustumVisibility",e.destroyMaybe(this.frustumVisibility));
this._set("graphicsCore",e.destroyMaybe(this.graphicsCore));this._set("owner",null)}get layer(){return this.owner.layer}get dataUpdating(){return this.graphicsCore?.dataUpdating??!1}get renderer(){const {renderer:Q,objectIdField:O}=this.layer;if(!Q||!O||"heatmap"===Q.type||!Q.visualVariables)return Q;const K=Q.visualVariables.findIndex(P=>"rotation"===P.type&&null!=P.valueExpression&&q.matchRandomRotationExpression(P.valueExpression)===O&&(null==P.axis||"heading"===P.axis)&&"geographic"===P.rotationType);
if(0>K)return Q;const L=Q.clone();if(!L.visualVariables)return Q;L.visualVariables.splice(K,1);this._randomRotationRenderers||(this._randomRotationRenderers=new WeakMap);this._randomRotationRenderers.set(L,O);return L}get scaleVisibility(){return this.graphicsCore?.scaleVisibility}get filterVisibility(){return this.graphicsCore?.filterVisibility}get elevationAlignment(){return this.graphicsCore?.elevationAlignment}get suspendResumeExtentMode(){return this.owner.suspendResumeExtentMode??"computed"}get scaleVisibilitySuspended(){return null!=
this.scaleVisibility&&this.scaleVisibility.suspended}get suspended(){return this.owner.suspended}get legendEnabled(){return null==this.frustumVisibility||!this.frustumVisibility.suspended}get suspendInfo(){const Q={};this.scaleVisibilitySuspended&&(Q.outsideScaleRange=!0);null!=this.frustumVisibility&&this.frustumVisibility.suspended&&(Q.outsideOfView=!0);return Q}get updating(){return!!(this.graphicsCore?.updating||this.frustumVisibility?.updating||this._updatingHandles.updating)}get updatingRemaining(){return this.graphicsCore?.updatingRemaining??
0}get featureStore(){return this.graphicsCore?.featureStore}get view(){return this.owner.view}get loadedGraphics(){return this.owner.loadedGraphics}get fullOpacity(){return this.owner?.fullOpacity}get filter(){return"filter"in this.owner?this.owner.filter:null}get slicePlaneEnabled(){return this.owner.slicePlaneEnabled}get updatePolicy(){return this.owner.updatePolicy}get featureSpatialReference(){return"featureSpatialReference"in this.owner?this.owner.featureSpatialReference:this.owner.view.spatialReference}get graphics3DGraphics(){return this.graphicsCore?.graphics3DGraphics}get graphics3DGraphicsByObjectID(){return this.graphicsCore?.graphics3DGraphicsByObjectID}get symbolUpdateType(){return this.graphicsCore?.symbolUpdateType}get displayFeatureLimit(){const Q=
this.view.quality,O=this.graphicsCore?.displayFeatureLimit;return 1===Q?O:new z.DisplayFeatureLimit(O.maximumTotalNumberOfVertices,Math.ceil(O.maximumNumberOfFeatures*Q),O.averageSymbolComplexity)}get usedMemory(){return this.graphicsCore?.usedMemory??0}get loadedFeatures(){return this.graphicsCore?.numberOfGraphics??0}get usedMemoryPerFeature(){return this.graphicsCore?.usedMemoryPerGraphic??0}get unprocessedMemoryEstimate(){return this.graphicsCore?.unprocessedMemoryEstimate??0}get performanceInfo(){return this.graphicsCore.performanceInfo}maskOccludee(Q){const O=
this.graphicsCore?.objectStates;if(!O)return h.makeHandle();const {set:K,handle:L}=O.acquireOccludeeSet(null);O.setUid(K,Q.uid);return L}highlight(Q,O=null,K){const L=this.graphicsCore?.objectStates;if(!L)return J.emptyHighlightHandle;K??=M.defaultHighlightName;if(Q instanceof v){const {set:P,handle:R}=L.acquireHighlightSet(K,O);this.owner.queryObjectIds(Q).then(W=>L.setObjectIds(P,W));return R}Q=J.normalizeHighlightTargetExceptQuery(Q);if(0===Q.length)return J.emptyHighlightHandle;if(Q[0]instanceof
n)if(null!=D.attributeLookup(this.layer.fieldsIndex,Q[0].attributes,O))Q=Q.map(P=>D.attributeLookup(this.layer.fieldsIndex,P.attributes,O));else{Q=Q.map(W=>W.uid);const {set:P,handle:R}=L.acquireHighlightSet(K,null);L.setUids(P,Q);return R}if(J.isObjectId(Q[0])){const {set:P,handle:R}=L.acquireHighlightSet(K,O);L.setObjectIds(P,Q);return R}return J.emptyHighlightHandle}resetObjectStates(){this.graphicsCore?.objectStates?.reset()}whenGraphicBounds(Q,O){return this.graphicsCore?.whenGraphicBounds(Q,
O)}computeAttachmentOrigin(Q,O){return this.graphicsCore?.computeAttachmentOrigin(Q,O)}notifyGraphicGeometryChanged(Q){this.graphicsCore.notifyGraphicGeometryChanged(Q)}notifyGraphicVisibilityChanged(Q){this.graphicsCore.notifyGraphicVisibilityChanged(Q)}getRenderingInfo(Q,O,K){K=r.getRenderingInfo(Q,{renderer:O,arcade:K});if(K?.color){const L=K.color;L[0]/=255;L[1]/=255;L[2]/=255}null!=K&&null!=O&&this._randomRotationRenderers?.has(O)&&(O=this._randomRotationRenderers.get(O),Q=Q.attributes[O],O=
new k.XXH(0),O.updateFloatArray([Q]),O.updateUint8Array([173]),K.heading=8.381E-8*O.digest());return K}getRenderingInfoAsync(Q,O,K,L){return r.getRenderingInfoAsync(Q,{renderer:O,arcade:K,...L})}getSymbolLayerSize(Q,O){return this.graphicsCore?.getSymbolLayerSize(Q,O)}setObjectIdVisibility(Q,O){this.graphicsCore?.setObjectIdVisibility(Q,O)}refreshFilter(){null!=this.filterVisibility&&this.filterVisibility.reapply()}getGraphics3DGraphicByObjectId(Q){return this.graphicsCore?.getGraphics3DGraphicByObjectId(Q)}_updateClippingExtent(){const Q=
this.owner.view.clippingArea;this.graphicsCore.setClippingExtent(Q,this.owner.view.spatialReference)&&(this.updateClippingExtent(Q)||this.graphicsCore.recreateAllGraphics())}_setupSuspendResumeExtent(){(this.frustumVisibility||this.scaleVisibility)&&this.addHandles(f.watch(()=>this.suspendResumeExtentMode,()=>{this.removeHandles("suspendResumeExtentMode");switch(this.suspendResumeExtentMode){case "computed":this.addHandles([f.watch(()=>this.graphicsCore.computedExtent,Q=>this._updateSuspendResumeExtent(Q),
f.initial),f.watch(()=>this.graphicsCore.extentPadding,()=>this._updateSuspendResumeExtent(this.graphicsCore.computedExtent))],"suspendResumeExtentMode");break;case "data":this.addHandles([f.when(()=>this.dataExtent,Q=>this._updateSuspendResumeExtent(Q),f.initial),f.watch(()=>this.graphicsCore.extentPadding,()=>this._updateSuspendResumeExtent(this.dataExtent))],"suspendResumeExtentMode");break;default:p.neverReached(this.suspendResumeExtentMode)}},f.initial))}_updateSuspendResumeExtent(Q){Q?this._suspendResumeExtentChanged(this._extentToSuspendResumeRect(Q,
this._suspendResumeExtent)):this._suspendResumeExtentChanged(null)}_extentToSuspendResumeRect(Q,O){const K=this.owner.view.spatialReference;if(!Q.spatialReference.equals(K)){if(!m.canProject(Q,K))return;Q=m.project(Q,K)}return G.enlargeExtent(Q,O,B.suspendResumeExtentOptimism,this.graphicsCore.extentPadding)}_suspendResumeExtentChanged(Q){null!=this.frustumVisibility&&this.frustumVisibility.setExtent(Q);null!=this.scaleVisibility&&this.scaleVisibility.setExtent(Q)}};b.__decorate([c.property()],a.Graphics3DFeatureProcessor.prototype,
"type",void 0);b.__decorate([c.property({constructOnly:!0})],a.Graphics3DFeatureProcessor.prototype,"owner",void 0);b.__decorate([c.property()],a.Graphics3DFeatureProcessor.prototype,"layer",null);b.__decorate([c.property({readOnly:!0})],a.Graphics3DFeatureProcessor.prototype,"dataUpdating",null);b.__decorate([c.property()],a.Graphics3DFeatureProcessor.prototype,"renderer",null);b.__decorate([c.property({constructOnly:!0})],a.Graphics3DFeatureProcessor.prototype,"updateClippingExtent",void 0);b.__decorate([c.property({constructOnly:!0})],
a.Graphics3DFeatureProcessor.prototype,"elevationFeatureExpressionEnabled",void 0);b.__decorate([c.property({constructOnly:!0})],a.Graphics3DFeatureProcessor.prototype,"graphicsCore",void 0);b.__decorate([c.property({constructOnly:!0})],a.Graphics3DFeatureProcessor.prototype,"scaleVisibilityEnabled",void 0);b.__decorate([c.property({constructOnly:!0})],a.Graphics3DFeatureProcessor.prototype,"filterVisibilityEnabled",void 0);b.__decorate([c.property({constructOnly:!0})],a.Graphics3DFeatureProcessor.prototype,
"frustumVisibilityEnabled",void 0);b.__decorate([c.property({constructOnly:!0})],a.Graphics3DFeatureProcessor.prototype,"elevationAlignmentEnabled",void 0);b.__decorate([c.property({constructOnly:!0})],a.Graphics3DFeatureProcessor.prototype,"timeExtentEnabled",void 0);b.__decorate([c.property({constructOnly:!0})],a.Graphics3DFeatureProcessor.prototype,"setUidToIdOnAdd",void 0);b.__decorate([c.property()],a.Graphics3DFeatureProcessor.prototype,"scaleVisibility",null);b.__decorate([c.property()],a.Graphics3DFeatureProcessor.prototype,
"filterVisibility",null);b.__decorate([c.property()],a.Graphics3DFeatureProcessor.prototype,"elevationAlignment",null);b.__decorate([c.property({constructOnly:!0})],a.Graphics3DFeatureProcessor.prototype,"frustumVisibility",void 0);b.__decorate([c.property()],a.Graphics3DFeatureProcessor.prototype,"suspendResumeExtentMode",null);b.__decorate([c.property()],a.Graphics3DFeatureProcessor.prototype,"dataExtent",void 0);b.__decorate([c.property()],a.Graphics3DFeatureProcessor.prototype,"scaleVisibilitySuspended",
null);b.__decorate([c.property()],a.Graphics3DFeatureProcessor.prototype,"suspended",null);b.__decorate([c.property()],a.Graphics3DFeatureProcessor.prototype,"legendEnabled",null);b.__decorate([c.property()],a.Graphics3DFeatureProcessor.prototype,"suspendInfo",null);b.__decorate([c.property()],a.Graphics3DFeatureProcessor.prototype,"updating",null);b.__decorate([c.property()],a.Graphics3DFeatureProcessor.prototype,"updatingRemaining",null);b.__decorate([c.property()],a.Graphics3DFeatureProcessor.prototype,
"featureStore",null);b.__decorate([c.property()],a.Graphics3DFeatureProcessor.prototype,"view",null);b.__decorate([c.property()],a.Graphics3DFeatureProcessor.prototype,"loadedGraphics",null);b.__decorate([c.property()],a.Graphics3DFeatureProcessor.prototype,"fullOpacity",null);b.__decorate([c.property()],a.Graphics3DFeatureProcessor.prototype,"filter",null);b.__decorate([c.property()],a.Graphics3DFeatureProcessor.prototype,"slicePlaneEnabled",null);b.__decorate([c.property()],a.Graphics3DFeatureProcessor.prototype,
"drapeSourceType",void 0);b.__decorate([c.property()],a.Graphics3DFeatureProcessor.prototype,"updatePolicy",null);b.__decorate([c.property()],a.Graphics3DFeatureProcessor.prototype,"preferredUpdatePolicy",void 0);b.__decorate([c.property({readOnly:!0})],a.Graphics3DFeatureProcessor.prototype,"displayFeatureLimit",null);a.Graphics3DFeatureProcessor=b.__decorate([x.subclass("esri.views.3d.layers.graphics.Graphics3DFeatureProcessor")],a.Graphics3DFeatureProcessor);Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/arcade/functions/hash":function(){define(["exports"],function(a){function b(k){const p=[];for(let h=0,e=k.length;h<e;h++){let g=k.charCodeAt(h);128>g?p.push(g):2048>g?p.push(192|g>>6,128|g&63):55296>g||57344<=g?p.push(224|g>>12,128|g>>6&63,128|g&63):(h++,g=65536+((g&1023)<<10|k.charCodeAt(h)&1023),p.push(240|g>>18,128|g>>12&63,128|g>>6&63,128|g&63))}return new Uint8Array(p)}class n{constructor(k){this._seed=k;this._totallen=0;this._bufs=[];this.init()}init(){this._bufs=
[];this._totallen=0;return this}updateFloatArray(k){const p=[];for(const h of k)isNaN(h)?p.push("NaN"):Infinity===h?p.push("Infinity"):-Infinity===h?p.push("-Infinity"):0===h?p.push("0"):p.push(h.toString(16));this.update(b(p.join("")))}updateIntArray(k){k=Int32Array.from(k);this.update(new Uint8Array(k.buffer))}updateUint8Array(k){this.update(Uint8Array.from(k))}updateWithString(k){return this.update(b(k))}update(k){this._bufs.push(k);this._totallen+=k.length;return this}digest(){const k=new Uint8Array(this._totallen);
let p=0;for(const h of this._bufs)k.set(h,p),p+=h.length;this.init();return this._xxHash32(k,this._seed)}_xxHash32(k,p=0){var h=p+374761393&4294967295;let e=0;if(16<=k.length){h=[p+2654435761+2246822519&4294967295,p+2246822519&4294967295,p+0&4294967295,p-2654435761&4294967295];p=k.length-16;var g=0;for(e=0;(e&4294967280)<=p;e+=4){var d=e;d=h[g]+(2246822519*(k[d]+(k[d+1]<<8))+(2246822519*(k[d+2]+(k[d+3]<<8))<<16))&4294967295;d=d<<13|d>>>19;h[g]=2654435761*(d&65535)+(2654435761*(d>>>16)<<16)&4294967295;
g=g+1&3}h=(h[0]<<1|h[0]>>>31)+(h[1]<<7|h[1]>>>25)+(h[2]<<12|h[2]>>>20)+(h[3]<<18|h[3]>>>14)&4294967295}h=h+k.length&4294967295;for(p=k.length-4;e<=p;e+=4)g=e,h=h+(3266489917*(k[g]+(k[g+1]<<8))+(3266489917*(k[g+2]+(k[g+3]<<8))<<16))&4294967295,h=h<<17|h>>>15,h=668265263*(h&65535)+(668265263*(h>>>16)<<16)&4294967295;for(;e<k.length;++e)h+=374761393*k[e],h=h<<11|h>>>21,h=2654435761*(h&65535)+(2654435761*(h>>>16)<<16)&4294967295;h^=h>>>15;h=(2246822519*(h&65535)&4294967295)+(2246822519*(h>>>16)<<16);
h^=h>>>13;h=(3266489917*(h&65535)&4294967295)+(3266489917*(h>>>16)<<16);h^=h>>>16;return 0>h?h+4294967296:h}}a.XXH=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/renderers/support/renderingInfoUtils":function(){define(["exports","../../Color","../visualVariables/support/visualVariableUtils"],function(a,b,n){function k(h,e){if(!h||h.symbol)return null;e=e?.renderer;return h&&null!=e&&e.getObservationRenderer?e.getObservationRenderer(h):e}async function p(h,e){if(null!=h.symbol)return h.symbol;
const g=k(h,e);return null!=g?g.getSymbolAsync(h,e):null}a.getDriverAxisSizeValue=function(h,e=0){h=h[e];return"number"===typeof h&&isFinite(h)?h:null};a.getDriverAxisSizeValueAny=function(h){for(let e=0;3>e;e++){const g=h[e];if("number"===typeof g)return isFinite(g)?g:0}return 0};a.getRenderer=k;a.getRenderingInfo=function(h,e){const g=k(h,e);if(null!=h.symbol)var d=h.symbol;else d=k(h,e),d=null!=d&&"dot-density"!==d.type?d.getSymbol(h,e):null;if(null==d)return null;d={renderer:g,symbol:d};if(!(null!=
g&&"visualVariables"in g&&g.visualVariables))return d;e=n.getVisualVariableValues(g,h,e)??[];h=["proportional","proportional","proportional"];for(const {variable:f,value:c}of e)switch(f.type){case "color":d.color=c.toRgba();break;case "size":if("outline"===f.target)d.outlineSize=c;else switch(e=f.useSymbolValue?"symbol-value":c,f.axis){case "width":h[0]=e;break;case "depth":h[1]=e;break;case "height":h[2]=e;break;case "width-and-depth":h[0]=h[1]=e;break;default:h[0]=h[1]=h[2]=e}break;case "opacity":d.opacity=
c;break;case "rotation":switch(f.axis){case "tilt":d.tilt=c;break;case "roll":d.roll=c;break;default:d.heading=c}}if("proportional"!==h[0]||"proportional"!==h[1]||"proportional"!==h[2])d.size=h;return d};a.getRenderingInfoAsync=async function(h,e){var g=k(h,e),d=await p(h,e);if(!d)return null;d={renderer:g,symbol:d};if(!(g&&"visualVariables"in g&&g.visualVariables))return d;e=n.getVisualVariableValues(g,h,e)??[];h=["proportional","proportional","proportional"];for(const {variable:f,value:c}of e)"color"===
f.type?d.color=b.toUnitRGBA(c):"size"===f.type?"outline"===f.target?d.outlineSize=c:(e=f.axis,g=f.useSymbolValue?"symbol-value":c,"width"===e?h[0]=g:"depth"===e?h[1]=g:"height"===e?h[2]=g:h[0]="width-and-depth"===e?h[1]=g:h[1]=h[2]=g):"opacity"===f.type?d.opacity=c:"rotation"===f.type&&"tilt"===f.axis?d.tilt=c:"rotation"===f.type&&"roll"===f.axis?d.roll=c:"rotation"===f.type&&(d.heading=c);if(isFinite(h[0])||isFinite(h[1])||isFinite(h[2]))d.size=h;return d};a.getSymbolAsync=p;Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/DisplayFeatureLimit":function(){define(["exports"],function(a){class b{constructor(n,k,p){this.maximumTotalNumberOfVertices=n;this.maximumNumberOfFeatures=k;this.averageSymbolComplexity=p}}a.DisplayFeatureLimit=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DCore":function(){define("exports ../../../../chunks/tslib.es6 ../../../../geometry ../../../../renderers/ClassBreaksRenderer ../../../../renderers/DictionaryRenderer ../../../../renderers/DotDensityRenderer ../../../../renderers/HeatmapRenderer ../../../../renderers/PieChartRenderer ../../../../renderers/Renderer ../../../../renderers/SimpleRenderer ../../../../renderers/UniqueValueRenderer ../../../../renderers/support/jsonUtils ../../../../core/Logger ../../../../symbols ../../../../core/Accessor ../../../../core/arrayUtils ../../../../core/has ../../../../core/Error ../../../../core/handleUtils ../../../../core/MapUtils ../../../../core/maybe ../../../../core/MemCache ../../../../core/PooledArray ../../../../core/promiseUtils ../../../../core/reactiveUtils ../../../../core/scheduling ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/decorators/subclass ../../../../core/accessorSupport/diffUtils ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../geometry/projection ../../../../geometry/projection/projectBuffer ../../../../geometry/projection/projectVectorToVector ../../../../geometry/projection/projectXYZToVector ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/aaBoundingRect ../../../../geometry/support/spatialReferenceUtils ../../../../layers/Layer ../../../../layers/graphics/dehydratedFeatures ../../../../layers/graphics/hydratedFeatures ../../../../layers/support/PromiseQueue ../../../../renderers/support/rendererConversion ../../../../support/arcadeOnDemand ../../../../support/basemapUtils ../../../../symbols/support/defaults3D ../../../../symbols/support/symbolConversion ./defaultSymbolComplexity ./DisplayFeatureLimit ./ElevationQuery ./enums ./featureExpressionInfoUtils ./Graphics3DFeatureStore ./Graphics3DGraphicCreationContext ./Graphics3DSymbolCreationContext ./Graphics3DSymbolFactory ./Graphics3DWebStyleSymbol ./GraphicsCorePerformanceInfo ./GraphicStateTracking ./graphicUtils ./interfaces ./Loadable ./SpatialIndex2D ./symbolMemory ../support/StageLayerElevationProvider ../../support/extentUtils ../../webgl-engine/core/shaderLibrary/util/AlphaCutoff ../../webgl-engine/lib/GridLocalOriginFactory ../../webgl-engine/lib/UpdatePolicy ../../webgl-engine/lib/VertexAttribute ../../webgl-engine/lib/WebGLLayer ../../../layers/support/popupUtils ../../../support/PropertiesPool ../../../support/Scheduler ../../../support/Yield ../../../../geometry/Extent ../../../../geometry/Point ../../../../symbols/LabelSymbol3D ../../../../symbols/TextSymbol ../../../../symbols/WebStyleSymbol".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w,x,u,t,m,q,r,v,y,B,z,A,C,H,E,F,G,D,I,J,N,M,Q,O,K,L,P,R,W,V,ba,U,da,fa,ha,T,S,Z,ia,Y,ea,ka,ja,X,aa,pa,la,na,qa,sa,xa,ta,Ba,Ia,Ca,Ha,Ga,Aa,Ja,Sa,$a,Wa,Ta,Da,La,Va,ma,za){var Na;const Ra=I.create(),Pa=O.create();a.Graphics3DCore=Na=class extends u{get _viewSpatialReference(){return this.owner.view.spatialReference}get spatialIndex(){this._spatialIndex||(this._spatialIndex=new xa.SpatialIndex2D({objectIdField:this.owner.layer?.objectIdField,spatialReference:this._viewSpatialReference,
hasZ:!!this.hasZ,hasM:!!this.hasM}),this._spatialIndex.setup(Array.from(this.graphics3DGraphics.values())));this._spatialIndex.update();return this._spatialIndex}get deconflictor(){return this._deconflictor}get labeler(){return this._labeler}get numberOfGraphics(){return this._numberOfGraphics}get effectiveUpdatePolicy(){return null!=this.currentRenderer&&"dictionary"===this.currentRenderer.type?Ga.UpdatePolicy.ASYNC:this._forcedUpdatePolicy??this.preferredUpdatePolicy}get featureStore(){return this._featureStore}get initializePromise(){return this._initializePromise}get scaleVisibility(){return this._scaleVisibility}get elevationAlignment(){return this._elevationAlignment}get objectStates(){return this._objectStates}get filterVisibility(){return this._filterVisibility}get updating(){return!!(this.dataUpdating||
this._elevationAlignment?.updating||this._scaleVisibility?.updating||this._filterVisibility?.updating||this._rendererChangeAbortController||this._elevationInfoChangeAbortController||this._frameTaskHandle.updating||this.running)}get dataUpdating(){return!!(0<this._graphicsWaitingForSymbol.size||0<this._pendingUpdates.size||this._spatialIndex?.updating||this._updatingPendingLoadedGraphicsChange||this._dataUpdateQueue.running||0<this._loadingSymbols)}get running(){return 0<this._pendingUpdates.size||
!!this._spatialIndex?.updating||this._dataUpdateQueue.running||this._updateQueue.running}get suspendedOrOutsideOfView(){return this.owner.suspended||!!this.owner.suspendInfo?.outsideOfView}get updatingRemaining(){return this.updating?this._pendingUpdates.size+.1*(this._spatialIndex?.updatingRemaining||0)+.1*(this._elevationAlignment?.updatingRemaining||0):0}get displayFeatureLimit(){var ya=this.owner&&this.owner.view&&this.owner.view.qualitySettings,Ea=ya?.graphics3D.maxTotalNumberOfFeatures??0;const Qa=
ya?.graphics3D.maxNumberOfDrawCalls??0,db=ya?.graphics3D.maxTotalNumberOfVertices??0,lb=this.averageSymbolComplexity;ya=Math.max(ya?.graphics3D.minTotalNumberOfFeatures??0,Math.min(Ea,Math.ceil(db/Math.max(1,lb?.verticesPerFeature??1)),lb&&0<lb.drawCallsPerFeature&&0<Qa?Qa/lb.drawCallsPerFeature:Ea));return(Ea=this._get("displayFeatureLimit"))&&Ea.maximumTotalNumberOfVertices===db&&Ea.averageSymbolComplexity===lb&&Ea.maximumNumberOfFeatures===ya?Ea:new S.DisplayFeatureLimit(db,ya,lb)}get averageSymbolComplexity(){const ya=
T.averageSymbolComplexities(this._symbolComplexities),Ea=this._get("averageSymbolComplexity");return 0===ya.numComplexities||null!=Ea&&(ya.estimated&&(Ea.verticesPerFeature>=ya.verticesPerFeature||Ea.verticesPerCoordinate>=ya.verticesPerCoordinate||Ea.drawCallsPerFeature>=ya.drawCallsPerFeature)||Ea.verticesPerFeature===ya.verticesPerFeature&&Ea.verticesPerCoordinate===ya.verticesPerCoordinate&&Ea.drawCallsPerFeature===ya.drawCallsPerFeature)?Ea:ya}get usedMemory(){const ya=null!=this.averageSymbolComplexity&&
this.labelsEnabled?this.averageSymbolComplexity.memory.bytesPerFeatureLabel*this._numberOfGraphics:0,Ea=this._getSymbolComplexitiesUsed().reduce((ub,Oa)=>ub+Oa.memory.resourceBytes,0);if(null==this._symbolMaterials){this._symbolMaterials=[];for(var Qa of this._symbols.values())if(null!=Qa)for(const ub of Qa.symbolLayers)if(ub)for(const Oa of ub.materials)Oa&&this._symbolMaterials.push(Oa)}const db=this.owner.view._stage.renderer,lb=this.owner.view.basemapTerrain.overlayManager.renderer;Qa=this._symbolMaterials.reduce((ub,
Oa)=>ub+((db.getMaterialRenderer(Oa)||lb.getMaterialRenderer(Oa))?.usedMemory??0),0);return this._usedMemory+ya+Ea+Qa}get usedMemoryPerGraphic(){return this._usedMemory&&this._numberOfGraphics?this._usedMemory/this._numberOfGraphics*(this._numberOfGraphics/(this._numberOfGraphics+Math.max(this._pendingAdds,this._pendingRemoves))):null!=this.averageSymbolComplexity?this.averageSymbolComplexity.memory.bytesPerFeature+(this.labelsEnabled?this.averageSymbolComplexity.memory.bytesPerFeatureLabel:0):0}get unprocessedMemoryEstimate(){return(this._pendingAdds-
this._pendingRemoves)*this.usedMemoryPerGraphic}get _symbolComplexities(){return this.currentRenderer?this._getSymbolComplexitiesUsedOrRenderer(this.currentRenderer):this._getSymbolComplexitiesUsed()}get visible(){return this._visible}_getConvertedSymbol(ya){if("web-style"===ya.type)return ya.clone();var Ea=this._symbolConversionCache.get(ya.id);if(null!=Ea)return Ea;Ea=ha.to3D(ya,{geometryType:this.layer?.geometryType??void 0,retainId:!0,hasLabelingContext:this._hasLabelingContext(ya),cimFallbackEnabled:!0});
const Qa=Ea.symbol||null;null==Qa&&Ea.error&&w.getLogger(this).error(Ea.error.message);this._symbolConversionCache.set(ya.id,Qa);return Qa}_getSymbolComplexitiesUsedOrRenderer(ya){if(null==ya)return[];var Ea=ya.getSymbols(),Qa="backgroundFillSymbol"in ya?ya.backgroundFillSymbol:null;if(!Qa&&!Ea?.length)return[];ya=[];Qa=this._getSymbolComplexityUsedOrRenderer(Qa);null!=Qa&&ya.push(Qa);for(const db of Ea)Ea=this._getSymbolComplexityUsedOrRenderer(db),null!=Ea&&ya.push(Ea);return ya}_getSymbolComplexityUsedOrRenderer(ya){if(null==
ya)return null;const Ea=this._symbols.get(ya.id);if(null!=Ea)return Ea.complexity;ya=this._getConvertedSymbol(ya);return null!=ya?T.defaultSymbolComplexity(ya):null}_getSymbolComplexitiesUsed(){const ya=[];this._symbols.forEach(Ea=>{null!=Ea&&ya.push(Ea.complexity)});return ya}get _objectIdField(){return this.layer.objectIdField}constructor(ya){super(ya);this._propertiesPool=new $a.PropertiesPool({computedExtent:Da},this);this.currentRenderer=this.computedExtent=null;this.rendererHasGeometryOperations=
!1;this._graphicStateTracking=null;this.graphics3DGraphics=new Map;this.stage=this.stageLayer=null;this._graphicsDrapedUids=new Set;this._graphicsBySymbol=new Map;this._symbolConversionCache=new Map;this._symbols=new Map;this._graphicsWithoutSymbol=new Map;this._graphicsWaitingForSymbol=new Map;this._graphicsUpdateId=0;this._frameTaskHandle=Wa.ImmediateTask;this._dataUpdateQueue=new V.PromiseQueue;this._updateQueue=new V.PromiseQueue;this._suspendSymbolCleanup=!1;this._spatialIndex=this._filterVisibility=
this._scaleVisibility=this._elevationAlignment=this._initializeAbortController=this._elevationInfoChangeAbortController=this._rendererChangeAbortController=this._arcadeOnDemand=null;this.extentPadding=0;this._sharedSymbolResourcesOwnerHandle=this._stageLayerElevationProvider=this._viewElevationProvider=this._objectStates=this._labeler=this._deconflictor=this._featureStore=this._updatingPendingLoadedGraphicsChange=null;this._whenGraphics3DGraphicRequests={};this._pendingUpdates=new Map;this._pendingRemoves=
this._pendingAdds=this._numberOfGraphicsProvidingElevation=this._numberOfGraphics=0;this._applyPendingRemovesFirst=!1;this._loadingSymbols=0;this._pendingUpdatesPool=new z({allocator:Ea=>Ea||new cb,deallocator:Ea=>{Ea.clear();return Ea}});this._geometryWarningLogged=this._symbolWarningLogged=!1;this._objectIdInvisibleSet=new Set;this._whenSymbolRemoved=new z;this.preferredUpdatePolicy=Ga.UpdatePolicy.SYNC;this._forcedUpdatePolicy=null;this.elevationFeatureExpressionEnabled=!0;this.layer=this.owner=
null;this.graphicSymbolSupported=!0;this.getRenderingInfoWithoutRenderer=!1;this.setUidToIdOnAdd=!0;this.hasM=this.hasZ=null;this._usedMemory=0;this._startCreateGraphics=this._visible=!1;this._unusedSymbolsCache=ya.owner.view.resourceController.memoryController.newCache("graphics-3d-unused-symbols",Ea=>Ea.destroy());this.symbolCreationContext=new ja.Graphics3DSymbolCreationContext(ya.owner.view.resourceController.scheduler,(Ea,Qa)=>this._updateQueue.push(Ea,Qa))}initialize(){this._featureStore=new ea.Graphics3DFeatureStore({objectIdField:this.owner.layer?.objectIdField,
hasZ:!!this.hasZ,hasM:!!this.hasM,viewSpatialReference:this._viewSpatialReference,featureSpatialReference:this.owner.featureSpatialReference,getSpatialIndex:()=>this.spatialIndex,forEach:Qa=>this.graphics3DGraphics.forEach(Qa)});const ya=(Qa,db,lb)=>this.spatialIndex.queryGraphicUIDsInExtent(Qa,db,lb),{componentFactories:Ea}=this;this._elevationAlignment=Ea.elevationAlignment?.(this,ya);this._scaleVisibility=Ea.scaleVisibility?.(this,ya);this._filterVisibility=Ea.filterVisibility?.({featureStore:this._featureStore,
getFeatureCount:()=>this.graphics3DGraphics.size,updateFeatureVisibilities:Qa=>this.modifyGraphics3DGraphicVisibilities(db=>db.setVisibilityFlag(ia.VisibilityGroup.GRAPHIC,ia.VisibilityFlag.FILTER,Qa(R.getObjectId(db.graphic,this._objectIdField)))),setAllFeaturesVisibility:Qa=>this.modifyGraphics3DGraphicVisibilities(db=>db.setVisibilityFlag(ia.VisibilityGroup.GRAPHIC,ia.VisibilityFlag.FILTER,Qa)),clearFeaturesVisibility:()=>this.modifyGraphics3DGraphicVisibilities(Qa=>Qa.setVisibilityFlag(ia.VisibilityGroup.GRAPHIC,
ia.VisibilityFlag.FILTER,!0))});this._deconflictor=Ea.deconflictor?.(this);this._labeler=Ea.labeler?.(this,this._scaleVisibility);this._objectStates=Ea.objectStates?.(this);this._initializeAbortController=new AbortController;this._initializePromise=this._initializeAsync()}async _initializeAsync(){const ya=this._initializeAbortController?.signal,Ea=this.owner.view;this._viewElevationProvider=new Z.ViewElevationProvider(this._viewSpatialReference,Ea);this._initializeStage(Ea,this.layer.uid);var Qa=
Ea.sharedSymbolResources;this.symbolCreationContext.sharedResources=Qa;this._sharedSymbolResourcesOwnerHandle=Qa.addGraphicsOwner(this.owner);null!=this.currentRenderer&&(this.symbolCreationContext.renderer=this.currentRenderer);this.symbolCreationContext.stage=this.stage;this.symbolCreationContext.streamDataRequester=Qa.streamDataRequester;this.symbolCreationContext.renderCoordsHelper=Ea.renderCoordsHelper;this.symbolCreationContext.layer=this.layer;this.symbolCreationContext.graphicsCoreOwner=this.owner;
this.symbolCreationContext.localOriginFactory=new Ha.GridLocalOriginFactory(Ea.renderSpatialReference);this.symbolCreationContext.elevationProvider=Ea.elevationProvider;this.symbolCreationContext.notifyGraphicGeometryChanged=db=>this.notifyGraphicGeometryChanged(db);this.symbolCreationContext.notifyGraphicVisibilityChanged=db=>this.notifyGraphicVisibilityChanged(db);Qa=Y.extractExpressionInfo(this.layer.elevationInfo,this.elevationFeatureExpressionEnabled);this.symbolCreationContext.featureExpressionInfoContext=
await Y.createContext(Qa,this._viewSpatialReference,ya,w.getLogger(this));A.throwIfAborted(ya);this.symbolCreationContext.screenSizePerspectiveEnabled=Ea.screenSizePerspectiveEnabled&&!!this.layer.screenSizePerspectiveEnabled;this.symbolCreationContext.slicePlaneEnabled=!!this.owner.slicePlaneEnabled;this.symbolCreationContext.physicalBasedRenderingEnabled=!!this.owner.view.qualitySettings?.physicallyBasedRenderingEnabled;this.symbolCreationContext.skipHighSymbolLods=!!this.owner.view.qualitySettings?.graphics3D?.skipHighSymbolLods;
if("drapeSourceType"in this.owner){const {owner:db}=this;this.symbolCreationContext.drapeSourceRenderer=Ea.basemapTerrain.overlayManager.registerGeometryDrapeSource(db);this.addHandles(r.makeHandle(()=>Ea.basemapTerrain.overlayManager.unregisterDrapeSource(db)))}this.addHandles([C.watch(()=>this.suspendedOrOutsideOfView,()=>this._updateQueue.unshift(()=>this._updateLayerVisibility(),null).catch(A.ignoreAbortErrors)),C.watch(()=>[this.layer?.screenSizePerspectiveEnabled,this.owner.view?.screenSizePerspectiveEnabled],
()=>{const db=Ea.screenSizePerspectiveEnabled&&!!this.layer.screenSizePerspectiveEnabled;db!==this.symbolCreationContext.screenSizePerspectiveEnabled&&(this.symbolCreationContext.screenSizePerspectiveEnabled=db,this._labeler?.reset(),this.recreateAllGraphicsAndSymbols())}),C.watch(()=>this.owner.slicePlaneEnabled,db=>this._slicePlaneEnabledChange(!!db)),C.watch(()=>this.owner.view.state?.rasterPixelRatio,()=>this._pixelRatioChange()),C.watch(()=>!!this.owner.view.qualitySettings?.physicallyBasedRenderingEnabled,
db=>this._physicalBasedRenderingChange(db)),C.watch(()=>!!this.owner.view.qualitySettings?.graphics3D?.skipHighSymbolLods,db=>this._skipHighSymbolLoDsChange(db)),C.when(()=>Ea.basemapTerrain?.tilingScheme,db=>{db.spatialReference.equals(this.symbolCreationContext.overlaySR)||null==Ea.basemapTerrain.spatialReference||(this.symbolCreationContext.overlaySR=Ea.basemapTerrain.spatialReference);this.hasHandles("loaded-graphics")?this.recreateAllGraphics():this.addHandles([C.on(()=>this.owner?.loadedGraphics,
"change",lb=>{this._graphicsCollectionChanged(lb);this._signalUpdatingDuringAsyncLoadedGraphicsChange()},{onListenerAdd:()=>{this.recreateAllGraphics();this._signalUpdatingDuringAsyncLoadedGraphicsChange()}})],"loaded-graphics")},{initial:!0}),C.watch(()=>this.effectiveUpdatePolicy,db=>{null!=this.stageLayer&&(this.stageLayer.updatePolicy=db);this.symbolCreationContext.isAsync=this.effectiveUpdatePolicy===Ga.UpdatePolicy.ASYNC;db===Ga.UpdatePolicy.SYNC&&this.runTask(Wa.noBudget)},C.syncAndInitial)]);
this._frameTaskHandle=Ea.resourceController.scheduler.registerTask(Wa.TaskPriority.GRAPHICS_CORE,this);this.layer&&"featureReduction"in this.layer&&this.addHandles(C.watch(()=>this.layer.featureReduction,()=>this._deconflictor?.featureReductionChange()));this.notifyChange("averageSymbolComplexity");this.rendererChange(this.owner.renderer).catch(()=>{});this._initializeAbortController=null}_abortInitialize(){this._initializeAbortController&&(this._initializeAbortController.abort(),this._initializeAbortController=
null)}destroy(){this._unusedSymbolsCache.destroy();this._abortInitialize();this._abortRendererChange();this._abortElevationInfoChange();this._frameTaskHandle.remove();this._frameTaskHandle=Wa.ImmediateTask;this._dataUpdateQueue.cancelAll();this._updateQueue.cancelAll();this._deconflictor=y.removeMaybe(this._deconflictor);this._labeler=y.removeMaybe(this._labeler);this._elevationAlignment=y.destroyMaybe(this._elevationAlignment);this._scaleVisibility=y.destroyMaybe(this._scaleVisibility);this._filterVisibility=
y.destroyMaybe(this._filterVisibility);this._objectStates=y.destroyMaybe(this._objectStates);this.clear();this._featureStore=y.destroyMaybe(this._featureStore);this._updatingPendingLoadedGraphicsChange=y.removeMaybe(this._updatingPendingLoadedGraphicsChange);this._graphicStateTracking=y.destroyMaybe(this._graphicStateTracking);this.stage&&(this.stageLayer=y.destroyMaybe(this.stageLayer),this.stage=null);this._set("owner",null);for(const ya in this._whenGraphics3DGraphicRequests)this._whenGraphics3DGraphicRequests[ya].reject(new q("graphic:layer-destroyed",
"Layer has been destroyed"));this._whenGraphics3DGraphicRequests=null;this._sharedSymbolResourcesOwnerHandle=y.removeMaybe(this._sharedSymbolResourcesOwnerHandle);this._propertiesPool=y.destroyMaybe(this._propertiesPool);this._pendingUpdatesPool=null;this._symbolConversionCache.clear();this._objectIdInvisibleSet.clear();this._spatialIndex=y.destroyMaybe(this._spatialIndex)}clear(){this._objectStates?.allGraphicsDeleted();null!=this._graphicStateTracking&&this._graphicStateTracking.allGraphicsDeleted();
this.graphics3DGraphics.forEach(ya=>ya.destroy());this._spatialIndex?.clear();this.graphics3DGraphics.clear();this._usedMemory=this._numberOfGraphics=0;this._updateLayerVisibility();this._symbols.forEach(y.destroyMaybe);this._symbols.clear();this._symbolMaterials=null;this._graphicsBySymbol.clear();this._graphicsWithoutSymbol.clear();this._graphicsWaitingForSymbol.clear();this._pendingUpdates.clear();this._pendingUpdatesPool.clear();this._pendingRemoves=this._pendingAdds=0;this._applyPendingRemovesFirst=
!1;this.notifyChange("dataUpdating");this.notifyChange("running");this.notifyChange("updatingRemaining");this._featureStore.events.emit("changed")}_initializeStage(ya,Ea){this.stage=ya._stage;this.stageLayer=new Ja.WebGLLayer(this.stage,{visible:!this.suspendedOrOutsideOfView,updatePolicy:this.effectiveUpdatePolicy},Ea);ya=this.stageLayer.events;ya.on("transformationChanged",Qa=>this.notifyGraphicGeometryChanged(Qa.graphicUid));ya.on("shaderTransformationChanged",Qa=>this.notifyGraphicGeometryChanged(Qa.graphicUid));
ya.on("visibilityChanged",Qa=>this.notifyGraphicVisibilityChanged(Qa.graphicUid));ya.on("geometryAdded",Qa=>this.notifyGraphicGeometryChanged(Qa.object.graphicUid));ya.on("geometryRemoved",Qa=>this.notifyGraphicGeometryChanged(Qa.object.graphicUid));ya.on("attributesChanged",Qa=>Aa.affectsGeometry(Qa.attribute)&&this.notifyGraphicGeometryChanged(Qa.object.graphicUid))}notifyGraphicGeometryChanged(ya){null!=this._graphicStateTracking&&null!=ya&&(ya=this.graphics3DGraphics.get(ya))&&this._graphicStateTracking.updateGraphicGeometry(ya)}notifyGraphicVisibilityChanged(ya){null!=
this._graphicStateTracking&&null!=ya&&(ya=this.graphics3DGraphics.get(ya))&&this._graphicStateTracking.updateGraphicVisibility(ya)}_updateLayerVisibility(){var ya=this._numberOfGraphics>10*this.displayFeatureLimit.maximumNumberOfFeatures;ya=!this.suspendedOrOutsideOfView&&!ya;ya!==this._visible&&(this._visible=ya,this._updateStageLayerVisibility())}_updateStageLayerVisibility(){const ya=this._visible&&(null==this.layer.opacity||this.layer.opacity>=Ca.alphaCutoff);this.stageLayer.visible!==ya&&((this.stageLayer.visible=
ya)?this.updateGraphicsVisibilities():this._hideAllGraphics())}getGraphics3DGraphicById(ya){return null!=ya?this.graphics3DGraphics.get(ya):void 0}getGraphics3DGraphicByObjectId(ya){return this.owner.layer?.objectIdField?this._findGraphics3DGraphicByObjectId(ya):null}_getGraphicObjectID(ya,Ea=this.owner.layer?.objectIdField){return R.getObjectId(ya,Ea)}get graphics3DGraphicsByObjectID(){const ya=this.owner.layer?.objectIdField;if(ya){var Ea=new Map;this.graphics3DGraphics.forEach(Qa=>{if(Qa){var db=
this._getGraphicObjectID(Qa.graphic,ya);null!=db&&Ea.set(db,Qa)}});return Ea}}get labelsEnabled(){return!!this._labeler?.layerLabelsEnabled()}async updateLabelingInfo(ya){const Ea=this._deconflictor?.labelingInfoChange(ya);ya=this._labeler?.labelingInfoChange(ya);await Promise.allSettled([Ea,ya])}updateVisibilityInfo(){this._deconflictor?.labelingInfoChange();this._labeler?.visibilityInfoChange()}get symbolUpdateType(){if(0<this._pendingUpdates.size)return"unknown";let ya=0,Ea=0;for(const [Qa,db]of this._symbols)if(null!=
db){const lb=db.getFastUpdateStatus();if(0<lb.loading)return"unknown";this._graphicsBySymbol.has(Qa)&&(Ea+=lb.fast,ya+=lb.slow)}return 0<=Ea&&0===ya?"fast":0<=ya&&0===Ea?"slow":"mixed"}runTask(ya){this._dataUpdateQueue.runTask(ya);this._updateQueue.runTask(ya);this._applyPendingUpdates(ya);this.notifyChange("running");this.running||this.notifyChange("dataUpdating");this.notifyChange("updatingRemaining");if(!ya.hasProgressed)return Ta.Yield}setObjectIdVisibility(ya,Ea){Ea?this._objectIdInvisibleSet.delete(ya):
this._objectIdInvisibleSet.add(ya);ya=this._findGraphics3DGraphicByObjectId(ya);null!=ya&&this._updateUserVisibility(ya)}_findGraphics3DGraphicByObjectId(ya){return v.findInMap(this.graphics3DGraphics,Ea=>this._getGraphicObjectID(Ea.graphic)===ya)}_updateUserVisibility(ya){if(null==ya)return!1;var Ea=ya.graphic;const Qa=this._getGraphicObjectID(Ea);Ea=Ea.visible&&!this.owner.suspended&&this.stageLayer.visible&&(null==Qa||!this._objectIdInvisibleSet.has(Qa));return ya.setVisibilityFlag(ia.VisibilityGroup.GRAPHIC,
ia.VisibilityFlag.USER,Ea)}_whenGraphics3DGraphic(ya){var Ea=this.graphics3DGraphics.get(ya.uid);if(Ea)return Promise.resolve(Ea);if(Ea=this._whenGraphics3DGraphicRequests[ya.uid])return Ea.promise;Ea=A.createResolver();this._whenGraphics3DGraphicRequests[ya.uid]=Ea;return Ea.promise}async _boundsForGraphics3DGraphic(ya,Ea){const Qa=this._viewSpatialReference,db=this.owner.view.renderSpatialReference,lb=this.owner.view.basemapTerrain.spatialReference;ya=await ya.getProjectedBoundingBox((Oa,Xa,Za)=>
N.projectBuffer(Oa,db,Xa,Oa,Qa,Xa,Za),(Oa,Xa,Za)=>N.projectBuffer(Oa,lb,Xa,Oa,Qa,Xa,Za),this._viewElevationProvider?{service:this._viewElevationProvider,useViewElevation:null!=Ea?!!Ea.useViewElevation:!1,minDemResolution:null!=Ea?Ea.minDemResolution:null,minDemResolutionForPoints:this.owner.view.resolution}:null,Ea?.signal);if(!ya)return null;Ea=ya.boundingBox;if(ya.requiresDrapedElevation){var ub=this.symbolCreationContext.elevationProvider;ub&&(O.center(Ea,Ra),ub=ub.getElevation(Ra[0],Ra[1],0,Qa,
"ground")??0,Ea[2]=Math.min(Ea[2],ub),Ea[5]=Math.max(Ea[5],ub))}return{boundingBox:Ea,screenSpaceObjects:ya.screenSpaceObjects}}async whenGraphicBounds(ya,Ea){await C.whenOnce(()=>this.owner?.loadedGraphics);const Qa=this.owner.layer?.objectIdField;var db=this.owner.loadedGraphics.find(lb=>lb===ya?!0:null!=Qa&&null!=lb.attributes&&ya.attributes&&lb.attributes[Qa]===ya.attributes[Qa]);if(!db)throw new q("internal:graphic-not-part-of-view","Graphic is not part of this view");db=await this._whenGraphics3DGraphic(db);
return this._boundsForGraphics3DGraphic(db,Ea)}computeAttachmentOrigin(ya,Ea){ya=this.graphics3DGraphics.get(ya.uid);if(!ya)return null;var Qa=ya.computeAttachmentOrigin();if(0===Qa.render.num&&0===Qa.draped.num)return null;D.set(ib,0,0,0);ya=0;if(0<Qa.render.num){if(!M.projectVectorToVector(Qa.render.origin,this.symbolCreationContext.renderCoordsHelper.spatialReference,nb,Ea))return null;D.add(ib,ib,nb);ya++}if(0<Qa.draped.num){const [db,lb]=Qa.draped.origin;Qa=this._viewElevationProvider.getElevation(db,
lb,"ground")??0;D.set(nb,db,lb,Qa);if(!M.projectVectorToVector(nb,this._viewElevationProvider.spatialReference,nb,Ea))return null;D.add(ib,ib,nb);ya++}1<ya&&D.scale(ib,ib,1/ya);return new La({x:ib[0],y:ib[1],z:ib[2],spatialReference:Ea})}getSymbolLayerSize(ya,Ea){var Qa=this._symbols.get(ya.id);if(null==Qa)throw new q("internal:symbol-not-part-of-view","Symbol is not part of this view");ya=ya.symbolLayers.indexOf(Ea);if(-1===ya)throw new q("internal:missing-symbol-layer","Symbol layer is not in symbol");
Qa=Qa.getSymbolLayerSize(ya);if(null==Qa)throw new q("internal:missing-size","Symbol layer has no valid size");return Qa}_graphicsCollectionChanged(ya){this._startCreateGraphics&&(this.add(ya.added),this.remove(ya.removed))}graphicUpdateHandler(ya){const Ea=ya.graphic.uid,Qa=this.graphics3DGraphics.get(Ea);if(null!=Qa||null!=this._graphicsWithoutSymbol.get(Ea))switch(ya.property){case "visible":this._graphicUpdateVisibleHandler(Qa);break;case "geometry":this._graphicUpdateGeometryHandler(Qa,ya);break;
case "symbol":this._graphicUpdateSymbolHandler(Qa,ya);break;case "origin-transform":this._graphicUpdateTransformHandler(Qa,ya)}}_graphicUpdateGeometryHandler(ya,Ea){this._graphicUpdateGeometryOrTransformHandler(ya,Ea,()=>null!=Ea.newValue&&null!=ya&&ya.graphics3DSymbol.updateGeometry(ya,Ea.newValue)&&(this._labeler?.updateGraphicGeometry(ya)??!0)?(this._labeler?.setDirty(),!0):!1);const Qa=Ea.graphic.geometry;null!=Qa&&this._expandComputedExtent(Qa)}_graphicUpdateTransformHandler(ya,Ea){const Qa=
Ea.graphic.geometry;this._graphicUpdateGeometryOrTransformHandler(ya,Ea,()=>null!=Ea.newValue&&null!=ya&&null!=Qa&&ya.graphics3DSymbol.updateTransform(ya,Qa.spatialReference,Ea.newValue,Ea.action))}_graphicUpdateGeometryOrTransformHandler(ya,Ea,Qa){if(null==Ea.graphic.geometry)this._recreateGraphic(Ea.graphic);else if(null==ya){if(ya=Ea.graphic.symbol?.id)if(ya=this._symbols.get(ya),null!=ya&&ya.loadStatus===sa.LoadStatus.LOADING)return;this._recreateGraphic(Ea.graphic)}else Qa()||this._recreateGraphic(ya.graphic)}_graphicUpdateSymbolHandler(ya,
Ea){var Qa=Ea.graphic;const db=null!=ya?ya.graphics3DSymbol:null!=Ea.oldValue?this._symbols.get(Ea.oldValue.id):null;if(null==db||null==Ea.newValue)this._recreateGraphic(Qa);else{var lb=db.symbol;Ea=this._getConvertedSymbol(Ea.newValue);if(null!=Ea&&(Ea.type!==lb.type||"web-style"===Ea.type)||"web-style"===lb.type)this._recreateGraphic(Qa);else{var ub=this._graphicsBySymbol.get(lb.id);if(ub&&1!==ub.size)this._recreateGraphic(Qa);else if(ub=G.diff(lb,Ea),null==ub)this._updateSymbolMapping(lb.id,Ea);
else if(ub={diff:ub,graphics3DGraphicPatches:[],symbolStatePatches:[]},db.prepareSymbolPatch(ub),G.isEmpty(ub.diff)){var Oa=this._getRenderingInfo(Qa);if(null==Oa)this._recreateGraphic(Qa);else{Qa=db.extentPadding;for(const Xa of ub.symbolStatePatches)Xa();Qa!==db.extentPadding&&this._recomputeExtentPadding();if(null!=ya)for(const Xa of ub.graphics3DGraphicPatches)Xa(ya,Oa);this._updateSymbolMapping(lb.id,Ea)}}else this._recreateGraphic(Qa)}}}_graphicUpdateVisibleHandler(ya){this._updateUserVisibility(ya)&&
(this._labeler?.setDirty(),this._deconflictor?.setDirty())}recreateGraphics(ya){this._suspendSymbolCleanup=!0;this.remove(ya);this.add(ya);this._suspendSymbolCleanup=!1;this.effectiveUpdatePolicy===Ga.UpdatePolicy.SYNC&&this._cleanupSymbols()}_recreateGraphic(ya){this.recreateGraphics([ya])}_beginGraphicUpdate(ya){const Ea=this._graphicsUpdateId;this._graphicsUpdateId++;this._graphicsWaitingForSymbol.set(ya.uid,Ea);1===this._graphicsWaitingForSymbol.size&&this.notifyChange("dataUpdating");return Ea}_endGraphicUpdate(ya,
Ea){ya&&(Ea&&this._graphicStateTracking?.updateGraphicError(ya,Ea),this._graphicsWaitingForSymbol.delete(ya.uid),0===this._graphicsWaitingForSymbol.size&&(this._cleanupSymbols(),this.notifyChange("dataUpdating")))}_recomputeExtentPadding(){let ya=0;this._symbols.forEach(Ea=>{null!=Ea&&(ya=Math.max(ya,Ea.extentPadding))});this._set("extentPadding",ya)}_expandComputedExtent(ya){var Ea=ya.spatialReference;R.computeAABB(ya,Pa);ya=this._viewSpatialReference;var Qa=Na.tmpVec;!L.equals(Ea,ya)&&Q.projectXYZToVector(Pa[0],
Pa[1],0,Ea,Qa,ya)&&(Pa[0]=Qa[0],Pa[1]=Qa[1],Q.projectXYZToVector(Pa[3],Pa[4],0,Ea,Qa,ya),Pa[3]=Qa[0],Pa[4]=Qa[1]);if(isFinite(Pa[0])&&isFinite(Pa[3])&&isFinite(Pa[1])&&isFinite(Pa[4])){Ea=this.computedExtent;Qa=null;var db=isFinite(Pa[2])&&isFinite(Pa[5]),lb=db&&(null==Ea?.zmin||Pa[2]<Ea.zmin);db=db&&(null==Ea?.zmax||Pa[5]>Ea.zmax);if(Ea){if(Pa[0]<Ea.xmin||Pa[1]<Ea.ymin||Pa[3]>Ea.xmax||Pa[4]>Ea.ymax||lb||db)Qa=this._propertiesPool.get("computedExtent"),Qa.xmin=Math.min(Pa[0],Ea.xmin),Qa.ymin=Math.min(Pa[1],
Ea.ymin),Qa.xmax=Math.max(Pa[3],Ea.xmax),Qa.ymax=Math.max(Pa[4],Ea.ymax),Qa.spatialReference=ya}else Qa=this._propertiesPool.get("computedExtent"),Qa.xmin=Pa[0],Qa.ymin=Pa[1],Qa.xmax=Pa[3],Qa.ymax=Pa[4],Qa.spatialReference=ya;Qa&&(lb&&(Qa.zmin=Pa[2]),db&&(Qa.zmax=Pa[5]),this._set("computedExtent",Qa))}}_abortElevationInfoChange(){this._elevationInfoChangeAbortController&&(this._elevationInfoChangeAbortController.abort(),this._elevationInfoChangeAbortController=null)}async elevationInfoChange(){this._abortElevationInfoChange();
const ya=new AbortController;this._elevationInfoChangeAbortController=ya;const Ea=Y.extractExpressionInfo(this.layer.elevationInfo,this.elevationFeatureExpressionEnabled);this.symbolCreationContext.featureExpressionInfoContext=await Y.createContext(Ea,this._viewSpatialReference,ya.signal,w.getLogger(this));A.throwIfAborted(ya.signal);this._elevationInfoChangeAbortController=null;this._labeler?.elevationInfoChange();this.forEachGraphics3DSymbol((Qa,db,lb)=>{Qa.globalPropertyChanged("elevationInfo",
db)?db.forEach(ub=>{const Oa=ub.graphic;ub=ub.labelLayers;for(const Xa of ub)Xa.graphics3DSymbolLayer.updateGraphicElevationContext(Oa,Xa)}):this._recreateSymbol(lb)});this.updateStageLayerElevationProvider();this._elevationAlignment?.elevationInfoChange()}updateStageLayerElevationProvider(){if(this._stageLayerElevationProvider){if(this.layer.elevationInfo&&"relative-to-scene"===this.layer.elevationInfo.mode||0===this._numberOfGraphicsProvidingElevation)this.owner.view.elevationProvider.unregister(this._stageLayerElevationProvider),
this._stageLayerElevationProvider=y.disposeMaybe(this._stageLayerElevationProvider)}else(!this.layer.elevationInfo||this.layer.elevationInfo&&"relative-to-scene"!==this.layer.elevationInfo.mode)&&0<this._numberOfGraphicsProvidingElevation&&(this._stageLayerElevationProvider=new Ba.StageLayerElevationProvider({layer:this.layer,stageLayer:this.stageLayer,view:this.owner.view}),this.owner.view.elevationProvider.register("scene",this._stageLayerElevationProvider))}_clearSymbolsAndGraphics(){this.clear();
null!=this._filterVisibility&&this._filterVisibility.clear();this._labeler?.reset();this._deconflictor?.clear();this._elevationAlignment?.clear();this.stageLayer?.invalidateSpatialQueryAccelerator();this._stageLayerElevationProvider&&(this.owner.view.elevationProvider.unregister(this._stageLayerElevationProvider),this._stageLayerElevationProvider=y.disposeMaybe(this._stageLayerElevationProvider))}startCreateGraphics(){this._startCreateGraphics=!0;this.recreateAllGraphics()}recreateAllGraphics(){this._recreateAllGraphics(!1)}recreateAllGraphicsAndSymbols(){this._recreateAllGraphics(!0)}_recreateAllGraphics(ya=
!1){if(this._startCreateGraphics){var {loadedGraphics:Ea,view:Qa}=this.owner,db=Qa.basemapTerrain.tilingScheme&&Ea?.length?Ea.toArray():null;!ya&&db||this._clearSymbolsAndGraphics();this.symbolCreationContext.screenSizePerspectiveEnabled=this.owner.view.screenSizePerspectiveEnabled&&!!this.layer.screenSizePerspectiveEnabled;this.symbolCreationContext.slicePlaneEnabled=!!this.owner.slicePlaneEnabled;this._set("computedExtent",null);db&&(ya?this.add(db):this.recreateGraphics(db))}}_recreateSymbol(ya){var Ea=
this._graphicsBySymbol.get(ya);const Qa=[];Ea&&(Ea.forEach((db,lb)=>{const ub=db.usedMemory;this._conditionalRemove(db,lb);this._spatialIndex?.remove(db);Qa.push(db.graphic);db.destroy();this._removeGraphics3DGraphic(lb,ub);this._updateLayerVisibility();this._featureStore.events.emit("changed")}),this._graphicsBySymbol.set(ya,new Map));Ea=this._symbols.get(ya);y.destroyMaybe(Ea);this._symbols.delete(ya);this._symbolMaterials=null;this.add(Qa)}_recreateGraphicsForSymbol(ya){if(ya=this._graphicsBySymbol.get(ya)){const Ea=
[];ya.forEach(Qa=>Ea.push(Qa.graphic));this.recreateGraphics(Ea)}}_conditionalRemove(ya,Ea){this._graphicsDrapedUids.delete(Ea);this._objectStates?.removeGraphic(ya);this._labeler?.removeGraphic(ya);this._deconflictor?.removeGraphic(ya);null!=this._graphicStateTracking&&this._graphicStateTracking.removeGraphic(ya)}add(ya){ya&&0!==ya.length&&(this.owner.view.basemapTerrain?.tilingScheme?(this._updatePolicyForGraphics(ya)===Ga.UpdatePolicy.ASYNC?this._addDelayed(ya):this._addImmediate(ya),this.notifyChange("dataUpdating")):
w.getLogger(this).error("#add()","Cannot add graphics before terrain surface has been initialized"))}_updatePolicyForGraphics(ya){if(this.effectiveUpdatePolicy===Ga.UpdatePolicy.SYNC&&("mesh"===this.layer.geometryType||null==this.layer.geometryType))for(const Ea of ya)if(null!=Ea.geometry&&"mesh"===Ea.geometry.type&&!Ea.geometry.loaded)return Ga.UpdatePolicy.ASYNC;return this.effectiveUpdatePolicy}_addImmediate(ya){this._symbolWarningLogged=this._geometryWarningLogged=!1;for(const Ea of ya)this._addGraphic(Ea,
this._getRenderingInfo(Ea,w.getLogger(this)),Ga.UpdatePolicy.SYNC);this._cleanupSymbols();this._labeler?.setDirty();this._deconflictor?.setDirty()}_addDelayed(ya){for(const Ea of ya){ya=Ea.uid;let Qa=this._pendingUpdates.get(ya);Qa?Qa.add?Qa.state!==ca.NEW&&Qa.abortController?.abort():this._pendingAdds++:(Qa=this._pendingUpdatesPool.pushNew(),this._pendingAdds++,this._pendingUpdates.set(ya,Qa));Qa.add=Ea}this.notifyChange("running");this.notifyChange("updatingRemaining");this.notifyChange("dataUpdating")}remove(ya){this.effectiveUpdatePolicy===
Ga.UpdatePolicy.ASYNC?this._removeDelayed(ya):this._removeImmediate(ya);this.notifyChange("dataUpdating")}_removeImmediate(ya){for(const Ea of ya)this._removeGraphic(Ea);this._cleanupSymbols();this._labeler?.setDirty();this._deconflictor?.setDirty()}_removeDelayed(ya){for(const Qa of ya){ya=Qa.uid;var Ea=this._pendingUpdates.get(ya);Ea?Ea.add&&(Ea.remove?Ea.add=null:this._pendingUpdates.delete(ya),Ea.state===ca.LOADING&&Ea.abortController?.abort(),this._pendingAdds--):(Ea=this._pendingUpdatesPool.pushNew(),
Ea.remove=Qa,this._pendingUpdates.set(ya,Ea),this._pendingRemoves++,this._applyPendingRemovesFirst=!0)}0===this._pendingUpdates.size&&this._finishPendingUpdates();this.notifyChange("running");this.notifyChange("updatingRemaining");this.notifyChange("dataUpdating")}_finishPendingUpdates(){this._pendingUpdatesPool.clear();this._cleanupSymbols();(this._pendingAdds||this._pendingRemoves)&&w.getLogger(this).warn("pendingAdds/Removes in inconsistent state!");this._pendingRemoves=this._pendingAdds=0;this._applyPendingRemovesFirst=
!1}_applyPendingUpdates(ya){this._symbolWarningLogged=this._geometryWarningLogged=!1;if(0===this._pendingUpdates.size&&this._spatialIndex?.updating)this._spatialIndex.update(),ya.madeProgress();else{if(this._applyPendingRemovesFirst){this._applyPendingRemovesFirst=!1;for(const [Ea,Qa]of this._pendingUpdates){if(ya.done){this._applyPendingRemovesFirst=!0;break}if(Qa.remove&&!Qa.add&&(this._pendingRemoves--,ya.madeProgress(),this._removeGraphic(Qa.remove),Qa.remove=null,this._pendingUpdates.delete(Ea),
0===this._pendingRemoves))break}}for(const [Ea,Qa]of this._pendingUpdates){if(ya.done)break;Qa.add&&Qa.state===ca.NEW&&this._processPendingUpdateNew(Qa);let db=this.effectiveUpdatePolicy;!Qa.remove||Qa.add&&Qa.state!==ca.READY||(this._pendingRemoves--,ya.madeProgress(),this._removeGraphic(Qa.remove),Qa.remove=null,db=Ga.UpdatePolicy.SYNC);if(Qa.add)switch(Qa.state){case ca.READY:this._addGraphic(Qa.add,Qa.renderingInfo,db);Qa.add=null;this._pendingAdds--;ya.madeProgress();break;case ca.REJECTED:Qa.add=
null,this._pendingAdds--}null==Qa.remove&&null==Qa.add&&this._pendingUpdates.delete(Ea)}0===this._pendingUpdates.size&&(this._finishPendingUpdates(),this.notifyChange("running"),this.notifyChange("dataUpdating"))}}_processPendingUpdateNew(ya){if(ya.add){var Ea=ya.add.geometry;null==Ea||"mesh"!==Ea.type||Ea.loaded?this._processPendingUpdateNewRenderingInfo(ya):this._processPendingUpdateNewMesh(ya,Ea)}else ya.state=ca.READY}async _processPendingUpdateNewMesh(ya,Ea){ya.state=ca.LOADING;ya.abortController=
new AbortController;const Qa=ya.abortController.signal;try{await Ea.load({signal:Qa})}catch(db){return this._processPendingUpdateNewError(ya,db)}ya.abortController=null;this._processPendingUpdateNewRenderingInfo(ya)}_processPendingUpdateNewError(ya,Ea){ya.abortController=null;A.isAbortError(Ea)?ya.state=ca.NEW:ya.state=ca.REJECTED}async _processPendingUpdateNewRenderingInfo(ya){if(null==this.layer.renderer||"dictionary"!==this.layer.renderer.type)ya.renderingInfo=this._getRenderingInfo(ya.add,w.getLogger(this));
else{ya.state=ca.LOADING;ya.abortController=new AbortController;var Ea=null;try{Ea=await this._getRenderingInfoAsync(ya.add,{signal:ya.abortController.signal})}catch(Qa){ya.abortController=null;A.isAbortError(Qa)?ya.state=ca.NEW:ya.state=ca.REJECTED;return}null==Ea?.symbol?(this._symbolWarningLogged||(this._symbolWarningLogged=!0,w.getLogger(this).warn(`Graphic in layer ${this.layer.id} has no symbol and will not render`)),ya.renderingInfo=null):ya.renderingInfo=Ea}ya.state=ca.READY}_addGraphic(ya,
Ea,Qa){this._graphicsWithoutSymbol.set(ya.uid,ya);if(null!=Ea?.symbol&&R.hasGeometry(ya)){var db=this.stage.renderView.olidRenderHelper;if(db&&this.setUidToIdOnAdd){const ob=da.isBasemapLayer(this.owner.view.map,this.layer.uid);db.setUidToObjectAndLayerId(ya.objectId,ya.uid,this.layer.id,this.layer.uid,!!this.layer.popupEnabled&&!ob&&Sa.hasPopupTemplate(this.layer,this.owner.view.popup?.defaultPopupTemplateEnabled))}var lb=this.getOrCreateGraphics3DSymbol(Ea.symbol,Ea.renderer);if(null!=lb){this._expandComputedExtent(ya.geometry);
var ub=this._beginGraphicUpdate(ya),Oa=new ka.Graphics3DGraphicCreationContext(ya,Ea,this.layer),Xa=!1,Za=ob=>{ob===lb.symbol.id&&(Xa=!0)};this._whenSymbolRemoved.push(Za);var hb=()=>{--this._loadingSymbols;if(!this.destroyed){this._whenSymbolRemoved.removeUnordered(Za);if(this._graphicsWaitingForSymbol.get(ya.uid)!==ub||Xa||lb.destroyed||this.graphicSymbolSupported&&ya.symbol&&ya.symbol.id!==lb.symbol.id)--lb.referenced,this._cleanupSymbols();else{const ob=this._createGraphics3DGraphic(lb,Oa);this._spatialIndex&&
null!=ob&&this._spatialIndex.add(ob);--lb.referenced;this._endGraphicUpdate(ya)}this._featureStore.events.emit("changed");this._labeler?.setDirty()}},jb=ob=>{--this._loadingSymbols;this.destroyed||(this._whenSymbolRemoved.removeUnordered(Za),Xa||(A.isAbortError(ob)?this.add([ya]):lb.destroyed||this._endGraphicUpdate(ya,ob)))};++this._loadingSymbols;Qa===Ga.UpdatePolicy.ASYNC?lb.load(()=>this._dataUpdateQueue.push(hb,null).catch(A.ignoreAbortErrors),ob=>this._dataUpdateQueue.push(()=>jb(ob),null).catch(A.ignoreAbortErrors)):
lb.load(hb,jb)}}}_removeGraphic(ya){ya=ya.uid;const Ea=this.graphics3DGraphics.get(ya);if(Ea){Ea.graphics3DSymbol.onRemoveGraphic(Ea);const Qa=Ea.usedMemory,db=Ea.isElevationSource;this._conditionalRemove(Ea,ya);this._spatialIndex?.remove(Ea);this._graphicsBySymbol.get(Ea.graphics3DSymbol.symbol.id)?.delete(ya);this._graphicsWithoutSymbol.delete(ya);this._removeGraphics3DGraphic(ya,Qa,db);Ea.destroy();this._featureStore.events.emit("changed")}else this._graphicsWithoutSymbol.delete(ya),this._graphicsWaitingForSymbol.delete(ya),
0===this._graphicsWaitingForSymbol.size&&(this._cleanupSymbols(),this.notifyChange("dataUpdating"))}_hasLabelingContext(ya){if(ya instanceof Va||ya instanceof ma){const Ea=this.symbolCreationContext.layer;return Ea.labelingInfo?Ea.labelingInfo.some(Qa=>Qa.symbol===ya):!1}return!1}_hasValidSymbolCreationContext(ya){return ya instanceof Va&&!this._hasLabelingContext(ya)?(w.getLogger(this).error("LabelSymbol3D is only valid as part of a LabelClass. Using LabelSymbol3D as a renderer symbol is not supported."),
!1):!0}_getRenderingInfo(ya,Ea){const Qa=ya.geometry;if(null==Qa)return Ea&&!this._geometryWarningLogged&&(this._geometryWarningLogged=!0,Ea.warn(`Graphic in layer ${this.layer.id} has no geometry and will not render`)),null;if(!J.canProjectWithoutEngine(Qa.spatialReference,this._viewSpatialReference))return Ea&&!this._geometryWarningLogged&&(this._geometryWarningLogged=!0,Ea.warn(`Graphic in layer ${this.layer.id} has incompatible spatial reference and will not render`)),null;if(!this.graphicSymbolSupported&&
null!=ya.symbol)return Ea&&!this._symbolWarningLogged&&(this._symbolWarningLogged=!0,Ea.warn(`Graphic in layer ${this.layer.id} is not allowed to have a symbol, use a renderer instead`)),null;ya=this.rendererHasGeometryOperations?W.hydrateGraphic(ya,this.layer):ya;ya=this.owner.getRenderingInfo&&(this.getRenderingInfoWithoutRenderer||null!=this.currentRenderer)?this.owner.getRenderingInfo(ya,this.currentRenderer,this._arcadeOnDemand):{symbol:ya.symbol||fa.getDefaultSymbol3D(ya.geometry)};return null==
ya?.symbol?(Ea&&!this._symbolWarningLogged&&(this._symbolWarningLogged=!0,Ea.warn(`Graphic in layer ${this.layer.id} has no symbol and will not render`)),null):ya}_getRenderingInfoAsync(ya,Ea){if(null==ya.geometry)return this._geometryWarningLogged||(this._geometryWarningLogged=!0,w.getLogger(this).warn(`Graphic in layer ${this.layer.id} has no geometry and will not render`)),null;if(!this.graphicSymbolSupported&&null!=ya.symbol)return this._symbolWarningLogged||(this._symbolWarningLogged=!0,w.getLogger(this).warn(`Graphic in layer ${this.layer.id} is not allowed to have a symbol, use a renderer instead`)),
null;ya=this.rendererHasGeometryOperations?W.hydrateGraphic(ya,this.layer):ya;return this.owner.getRenderingInfoAsync(ya,this.currentRenderer,this._arcadeOnDemand,Ea)}_createGraphics3DSymbol(ya,Ea){if(!this._hasValidSymbolCreationContext(ya))return null;ya=this._getConvertedSymbol(ya);if(!ya)return null;let Qa;null!=Ea&&"backgroundFillSymbol"in Ea&&Ea.backgroundFillSymbol&&(Ea=ha.to3D(Ea.backgroundFillSymbol,{ignoreDrivers:!0}),null!=Ea.symbol&&(Qa=Ea.symbol.symbolLayers));const db=X.make(ya,this.symbolCreationContext,
Qa);db.load(()=>{const lb=db.extentPadding;lb>this.extentPadding&&this._set("extentPadding",lb);this.notifyChange("averageSymbolComplexity")},()=>{});return db}getOrCreateGraphics3DSymbol(ya,Ea){var Qa=this._symbols.get(ya.id);void 0===Qa&&(Qa=this._unusedSymbolsCache.pop(ya.id),Qa=null!=Qa?Qa:ya instanceof za?new aa.Graphics3DWebStyleSymbol(ya,db=>this._dataUpdateQueue.push(db,null),db=>this._createGraphics3DSymbol(db,Ea)):this._createGraphics3DSymbol(ya,Ea),this._symbols.set(ya.id,Qa),this._symbolMaterials=
null);null!=Qa&&++Qa.referenced;return Qa}trackGraphicState(ya){null==this._graphicStateTracking&&(this._graphicStateTracking=new la.GraphicStateTracking(this));return this._graphicStateTracking.add(ya)}_addGraphics3DGraphic(ya){this._usedMemory+=ya.usedMemory;this.graphics3DGraphics.set(ya.graphic.uid,ya);this._numberOfGraphics++;ya.isElevationSource&&(this._numberOfGraphicsProvidingElevation++,this.updateStageLayerElevationProvider());this._updateLayerVisibility()}_removeGraphics3DGraphic(ya,Ea,
Qa=!1){this._usedMemory-=Ea;this.graphics3DGraphics.delete(ya);this._numberOfGraphics--;Qa&&(this._numberOfGraphicsProvidingElevation--,this.updateStageLayerElevationProvider());this._updateLayerVisibility()}_createGraphics3DGraphic(ya,Ea){const Qa=Ea.graphic;this._graphicsWithoutSymbol.delete(Qa.uid);if(!this._symbols.has(ya.symbol.id))return this.add([Qa]),null;if(this.graphics3DGraphics.has(Qa.uid))return null;Ea=ya.createGraphics3DGraphic(Ea);if(null==Ea)return null;this._addGraphics3DGraphic(Ea);
ya=ya.symbol.id;this._graphicsBySymbol.has(ya)||this._graphicsBySymbol.set(ya,new Map);this._graphicsBySymbol.get(ya).set(Qa.uid,Ea);Ea.isDraped&&this._graphicsDrapedUids.add(Qa.uid);Ea.centroid=null;null!=Qa.geometry&&"point"!==Qa.geometry.type&&(Ea.centroid=na.computeCentroid(Qa.geometry,this._viewSpatialReference));this._updateUserVisibility(Ea);null!=this._scaleVisibility&&this._scaleVisibility.updateVisibility(Ea);null!=this._filterVisibility&&({defaultVisibility:ya}=this._filterVisibility,Ea.setVisibilityFlag(ia.VisibilityGroup.GRAPHIC,
ia.VisibilityFlag.FILTER,ya),ya||this._filterVisibility.reapply());this._deconflictor?.addGraphic(Ea);this._labeler?.addGraphic(Ea);this._objectStates?.addGraphic(Ea);Ea.initialize(this.stageLayer,this.owner);null!=this._graphicStateTracking&&this._graphicStateTracking.addGraphic(Ea);if(ya=this._whenGraphics3DGraphicRequests[Qa.uid])delete this._whenGraphics3DGraphicRequests[Qa.uid],ya.resolve(Ea);this._symbolMaterials=null;return Ea}_abortRendererChange(){this._rendererChangeAbortController&&(this._rendererChangeAbortController.abort(),
this._rendererChangeAbortController=null)}async rendererChange(ya){this._abortRendererChange();if(ya!==this.currentRenderer)if(this._validateRenderer(ya),null==ya&&this._currentRendererChange(null,!1),ba.isSupportedRenderer3D(ya))if(ya?.arcadeRequired){var Ea=new AbortController;this._rendererChangeAbortController=Ea;const {arcadeUtils:Qa}=await this._ensureArcade();A.throwIfAborted(Ea);const db=Qa.hasGeometryOperations(ya);db&&(await Qa.enableGeometryOperations(),A.throwIfAborted(Ea));this.effectiveUpdatePolicy===
Ga.UpdatePolicy.ASYNC?await this._updateQueue.push(()=>this._currentRendererChange(ya,db),Ea.signal):this._currentRendererChange(ya,db);this._rendererChangeAbortController=null}else this.effectiveUpdatePolicy===Ga.UpdatePolicy.ASYNC?(this._rendererChangeAbortController=Ea=new AbortController,await this._updateQueue.push(()=>this._currentRendererChange(ya,!1),Ea.signal),this._rendererChangeAbortController=null):this._currentRendererChange(ya,!1);else this._currentRendererChange(ya,!1)}async _ensureArcade(){null==
this._arcadeOnDemand&&(this._arcadeOnDemand=await U.loadArcade());return this._arcadeOnDemand}_currentRendererChange(ya,Ea){this.currentRenderer=ya;this.rendererHasGeometryOperations=Ea;this.symbolCreationContext.arcade=this._arcadeOnDemand;Ea=this.symbolCreationContext.renderer;if(ya!==Ea)if(this._symbolConversionCache.clear(),this._unusedSymbolsCache.clear(),null==ya)this.symbolCreationContext.renderer=null,this.recreateAllGraphicsAndSymbols();else{var Qa=G.diff(Ea,ya);this._updateUnchangedSymbolMappings(Qa,
ya,Ea);this.symbolCreationContext.renderer=ya;null!=Qa&&("complete"===Qa.type?this.recreateAllGraphicsAndSymbols():"partial"===Qa.type&&(this._applyRendererDiff(Qa,ya,Ea)?this._labeler?.reset():this.recreateAllGraphicsAndSymbols()),this.notifyChange("averageSymbolComplexity"))}}_diffHasSymbolChange(ya){for(const Ea in ya.diff)switch(Ea){case "visualVariables":case "defaultSymbol":case "uniqueValueInfos":break;case "uniqueValueGroups":case "authoringInfo":case "fieldDelimiter":delete ya.diff[Ea];break;
default:return!0}return!1}_applySymbolSetDiff(ya,Ea,Qa){ya=ya||[];Ea=Ea||[];const db=[];for(const lb of Ea){const ub=this._graphicsBySymbol.get(lb.id);ub&&ub.forEach((Oa,Xa)=>{var Za=Oa.graphic,hb=this.layer instanceof P?this.layer:null;const jb=this._arcadeOnDemand;if(lb!==Qa.defaultSymbol||Qa.getSymbol(W.hydrateGraphic(Za,hb),{arcade:jb})!==Qa.defaultSymbol)hb=Oa.usedMemory,ya.length||Qa.defaultSymbol?db.push(Za):this._graphicsWithoutSymbol.set(Xa,Za),Za=this.graphics3DGraphics.get(Xa),this._conditionalRemove(Za,
Xa),Oa.destroy(),ub.delete(Xa),this._removeGraphics3DGraphic(Xa,hb),this._updateLayerVisibility()});this._whenSymbolRemoved.forAll(Oa=>Oa(lb.id))}if(ya.length||db.length)this._graphicsWithoutSymbol.forEach(lb=>db.push(lb)),this._graphicsWithoutSymbol.clear(),this.add(db);this._cleanupSymbols();this._labeler?.setDirty();this._deconflictor?.setDirty()}_applyUniqueValueRendererDiff(ya,Ea,Qa){const db=ya.diff.defaultSymbol,lb=ya.diff.uniqueValueInfos;if(db||lb){const ub=lb?lb.added.map(Xa=>Xa.symbol).filter(t.isSome):
[],Oa=lb?lb.removed.map(Xa=>Xa.symbol).filter(t.isSome):[];if(lb)for(let Xa=0;Xa<lb.changed.length;Xa++)ub.push(lb.changed[Xa].newValue.symbol),Oa.push(lb.changed[Xa].oldValue.symbol);db?(Qa.defaultSymbol&&Oa.push(Qa.defaultSymbol),Ea.defaultSymbol&&ub.push(Ea.defaultSymbol)):Qa.defaultSymbol&&ub.length&&Oa.push(Ea.defaultSymbol);this._applySymbolSetDiff(ub,Oa,Ea);delete ya.diff.defaultSymbol;delete ya.diff.uniqueValueInfos;return!0}return!1}_calculateUnchangedSymbolMapping(ya,Ea,Qa){if("unique-value"!==
Ea?.type||"unique-value"!==Qa?.type||null!=ya&&"partial"!==ya.type)return[];const db=ub=>null!=ub?ub.id:null;var lb=ya&&ya.diff;ya=lb?.defaultSymbol;if(lb=lb&&lb.uniqueValueInfos)lb=lb.unchanged.map(ub=>({oldId:db(ub.oldValue.symbol),newId:db(ub.newValue.symbol)}));else{lb=[];for(const ub of Qa.uniqueValueInfos??[]){const Oa=db(ub.symbol),Xa=Ea.uniqueValueInfos?.find(Za=>Za.value===ub.value);Xa&&Oa!==db(Xa.symbol)&&lb.push({oldId:Oa,newId:db(Xa.symbol)})}}!ya&&Qa.defaultSymbol&&lb.push({oldId:db(Qa.defaultSymbol),
newId:db(Ea.defaultSymbol)});return lb}_updateSymbolMapping(ya,Ea){const Qa=null!=Ea&&Ea?"string"===typeof Ea?Ea:Ea.id:null;if(null!=ya&&ya!==Qa){var db=this._graphicsBySymbol.get(ya);this._graphicsBySymbol.delete(ya);void 0!==db&&this._graphicsBySymbol.set(Qa,db);db=this._symbols.get(ya);void 0!==db&&(this._symbols.delete(ya),this._symbols.set(Qa,db),this._symbolMaterials=null,null!=db&&(ya="string"===typeof Ea?null:Ea,null!=ya?db.symbol=ya:db.symbol.id=Qa))}}_updateUnchangedSymbolMappings(ya,Ea,
Qa){ya=this._calculateUnchangedSymbolMapping(ya,Ea,Qa);for(const {oldId:db,newId:lb}of ya)this._updateSymbolMapping(db,lb)}_applyRendererDiff(ya,Ea,Qa){if(this._diffHasSymbolChange(ya))return!1;if(Ea instanceof c&&Qa instanceof c&&this._applyUniqueValueRendererDiff(ya,Ea,Qa)&&0===Object.keys(ya.diff).length)return!0;for(const db of this._graphicsBySymbol.keys())if(Qa=this._symbols.get(db),null!=Qa)switch(Qa.applyRendererDiff(ya,Ea)){case qa.ApplyRendererDiffResult.RecreateSymbol:this._recreateSymbol(db);
break;case qa.ApplyRendererDiffResult.RecreateGraphics:this._recreateGraphicsForSymbol(db)}return!0}opacityChange(){this._updateStageLayerVisibility();this.forEachGraphics3DSymbol((ya,Ea)=>ya.globalPropertyChanged("opacity",Ea))}_slicePlaneEnabledChange(ya){ya!==this.symbolCreationContext.slicePlaneEnabled&&(this.symbolCreationContext.slicePlaneEnabled=ya,this.stageLayer.sliceable=ya,this.forEachGraphics3DSymbol((Ea,Qa)=>Ea.globalPropertyChanged("slicePlaneEnabled",Qa)),this._deconflictor?.slicePlaneEnabledChange(),
this._labeler?.slicePlaneEnabledChange())}_physicalBasedRenderingChange(ya){this.symbolCreationContext.physicalBasedRenderingEnabled=ya;this.forEachGraphics3DSymbol((Ea,Qa,db)=>{Ea.globalPropertyChanged("physicalBasedRenderingEnabled",Qa)||this._recreateSymbol(db)})}_skipHighSymbolLoDsChange(ya){this.symbolCreationContext.skipHighSymbolLods=ya;this.forEachGraphics3DSymbol((Ea,Qa,db)=>{Ea.globalPropertyChanged("skipHighSymbolLods",Qa)||this._recreateSymbol(db)})}_pixelRatioChange(){this.forEachGraphics3DSymbol((ya,
Ea,Qa)=>{ya.globalPropertyChanged("pixelRatio",Ea)||this._recreateSymbol(Qa)})}_signalUpdatingDuringAsyncLoadedGraphicsChange(){this._updatingPendingLoadedGraphicsChange&&this._updatingPendingLoadedGraphicsChange.remove();this._updatingPendingLoadedGraphicsChange=H.schedule(()=>{this._updatingPendingLoadedGraphicsChange=null})}setClippingExtent(ya,Ea){const Qa=this.symbolCreationContext.clippingExtent,db=K.create();Ia.toBoundingRect(ya,db,Ea)?this.symbolCreationContext.clippingExtent=O.fromRect(O.create(),
db):this.symbolCreationContext.clippingExtent=null;return!O.equals(this.symbolCreationContext.clippingExtent,Qa)}modifyGraphics3DGraphicVisibilities(ya){if(!this.destroyed){var Ea=!1;this.graphics3DGraphics.forEach(Qa=>{ya(Qa)&&(Ea=!0)});Ea&&(this._labeler?.setDirty(),this._deconflictor?.setDirty())}}forEachGraphics3DSymbol(ya){for(const [Ea,Qa]of this._symbols){if(null==Qa)break;const db=this._graphicsBySymbol.get(Ea);ya(Qa,db||xb,Ea)}}updateGraphicsVisibilities(){null!=this._filterVisibility&&this._filterVisibility.reapply();
this.modifyGraphics3DGraphicVisibilities(ya=>{const Ea=this._updateUserVisibility(ya);ya=null!=this._scaleVisibility&&this._scaleVisibility.updateVisibility(ya);return Ea||ya})}_hideAllGraphics(){this.modifyGraphics3DGraphicVisibilities(ya=>ya.setVisibilityFlag(ia.VisibilityGroup.GRAPHIC,ia.VisibilityFlag.USER,!1))}_validateRenderer(ya){const Ea=()=>`'${this.layer.title?`${this.layer.title}, `:""}id:${this.layer.id}'`;if(ya=ba.validateTo3D(ya,{geometryType:this.layer?.geometryType,logWarning:(Qa,
db)=>w.getLogger(this).warn(Qa,`Symbology conversion for layer ${Ea()}: ${db}`)})){const Qa=`Renderer for layer ${Ea} is not supported in a SceneView`;w.getLogger(this).warn(Qa,ya.message)}}_cleanupSymbols(){if(!(0<this._graphicsWaitingForSymbol.size||this._suspendSymbolCleanup)){var ya=!1;this._symbols.forEach((Ea,Qa)=>{if(!(null==Ea||0<Ea.referenced)){var db=this._graphicsBySymbol.get(Qa);db&&0!==db.size||(this._graphicsBySymbol.delete(Qa),this._symbols.delete(Qa),this._symbolMaterials=null,this._unusedSymbolsCache.put(Qa,
Ea,ta.getSymbolMemorySize(Ea),B.MinPriority),ya=!0)}});ya&&(this._recomputeExtentPadding(),this.notifyChange("averageSymbolComplexity"))}}get test(){}get performanceInfo(){return new pa.GraphicsCorePerformanceInfo(this.graphics3DGraphics.size,this._graphicsWithoutSymbol.size,this._pendingUpdates.size)}};a.Graphics3DCore.tmpVec=I.create();b.__decorate([E.property({readOnly:!0})],a.Graphics3DCore.prototype,"computedExtent",void 0);b.__decorate([E.property()],a.Graphics3DCore.prototype,"currentRenderer",
void 0);b.__decorate([E.property()],a.Graphics3DCore.prototype,"rendererHasGeometryOperations",void 0);b.__decorate([E.property()],a.Graphics3DCore.prototype,"_frameTaskHandle",void 0);b.__decorate([E.property()],a.Graphics3DCore.prototype,"_dataUpdateQueue",void 0);b.__decorate([E.property()],a.Graphics3DCore.prototype,"_updateQueue",void 0);b.__decorate([E.property({readOnly:!0})],a.Graphics3DCore.prototype,"_viewSpatialReference",null);b.__decorate([E.property()],a.Graphics3DCore.prototype,"_rendererChangeAbortController",
void 0);b.__decorate([E.property()],a.Graphics3DCore.prototype,"_elevationInfoChangeAbortController",void 0);b.__decorate([E.property()],a.Graphics3DCore.prototype,"_initializeAbortController",void 0);b.__decorate([E.property()],a.Graphics3DCore.prototype,"_elevationAlignment",void 0);b.__decorate([E.property()],a.Graphics3DCore.prototype,"_scaleVisibility",void 0);b.__decorate([E.property()],a.Graphics3DCore.prototype,"_filterVisibility",void 0);b.__decorate([E.property()],a.Graphics3DCore.prototype,
"_initializePromise",void 0);b.__decorate([E.property()],a.Graphics3DCore.prototype,"_spatialIndex",void 0);b.__decorate([E.property({readOnly:!0})],a.Graphics3DCore.prototype,"extentPadding",void 0);b.__decorate([E.property()],a.Graphics3DCore.prototype,"_updatingPendingLoadedGraphicsChange",void 0);b.__decorate([E.property()],a.Graphics3DCore.prototype,"_featureStore",void 0);b.__decorate([E.property()],a.Graphics3DCore.prototype,"_objectStates",void 0);b.__decorate([E.property()],a.Graphics3DCore.prototype,
"_loadingSymbols",void 0);b.__decorate([E.property()],a.Graphics3DCore.prototype,"preferredUpdatePolicy",void 0);b.__decorate([E.property()],a.Graphics3DCore.prototype,"_forcedUpdatePolicy",void 0);b.__decorate([E.property({readOnly:!0})],a.Graphics3DCore.prototype,"effectiveUpdatePolicy",null);b.__decorate([E.property({constructOnly:!0})],a.Graphics3DCore.prototype,"elevationFeatureExpressionEnabled",void 0);b.__decorate([E.property({constructOnly:!0})],a.Graphics3DCore.prototype,"owner",void 0);
b.__decorate([E.property({constructOnly:!0})],a.Graphics3DCore.prototype,"layer",void 0);b.__decorate([E.property({constructOnly:!0})],a.Graphics3DCore.prototype,"graphicSymbolSupported",void 0);b.__decorate([E.property({constructOnly:!0})],a.Graphics3DCore.prototype,"getRenderingInfoWithoutRenderer",void 0);b.__decorate([E.property({constructOnly:!0})],a.Graphics3DCore.prototype,"componentFactories",void 0);b.__decorate([E.property({constructOnly:!0})],a.Graphics3DCore.prototype,"setUidToIdOnAdd",
void 0);b.__decorate([E.property()],a.Graphics3DCore.prototype,"featureStore",null);b.__decorate([E.property()],a.Graphics3DCore.prototype,"initializePromise",null);b.__decorate([E.property()],a.Graphics3DCore.prototype,"scaleVisibility",null);b.__decorate([E.property()],a.Graphics3DCore.prototype,"elevationAlignment",null);b.__decorate([E.property()],a.Graphics3DCore.prototype,"objectStates",null);b.__decorate([E.property()],a.Graphics3DCore.prototype,"filterVisibility",null);b.__decorate([E.property({readOnly:!0})],
a.Graphics3DCore.prototype,"updating",null);b.__decorate([E.property({readOnly:!0})],a.Graphics3DCore.prototype,"dataUpdating",null);b.__decorate([E.property({readOnly:!0})],a.Graphics3DCore.prototype,"running",null);b.__decorate([E.property({readOnly:!0})],a.Graphics3DCore.prototype,"suspendedOrOutsideOfView",null);b.__decorate([E.property({readOnly:!0,dependsOn:[]})],a.Graphics3DCore.prototype,"updatingRemaining",null);b.__decorate([E.property({readOnly:!0})],a.Graphics3DCore.prototype,"displayFeatureLimit",
null);b.__decorate([E.property({readOnly:!0,dependsOn:[]})],a.Graphics3DCore.prototype,"averageSymbolComplexity",null);b.__decorate([E.property({constructOnly:!0})],a.Graphics3DCore.prototype,"hasZ",void 0);b.__decorate([E.property({constructOnly:!0})],a.Graphics3DCore.prototype,"hasM",void 0);b.__decorate([E.property()],a.Graphics3DCore.prototype,"_objectIdField",null);a.Graphics3DCore=Na=b.__decorate([F.subclass("esri.views.3d.layers.graphics.Graphics3DCore")],a.Graphics3DCore);var ca;(function(ya){ya[ya.NEW=
0]="NEW";ya[ya.LOADING=1]="LOADING";ya[ya.READY=2]="READY";ya[ya.REJECTED=3]="REJECTED"})(ca||={});class cb{constructor(){this.renderingInfo=this.add=null;this.state=ca.NEW;this.remove=this.abortController=null}clear(){this.renderingInfo=this.add=null;this.state=ca.NEW;this.remove=this.abortController=null}}const ib=I.create(),nb=I.create(),xb=new Map;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/renderers/support/rendererConversion":function(){define(["exports","../../core/arrayUtils",
"../../core/has","../../core/Error","../../symbols/support/symbolConversion"],function(a,b,n,k,p){function h(f){return null==f||"simple"===f.type||"unique-value"===f.type||"class-breaks"===f.type||"dictionary"===f.type||"heatmap"===f.type}function e(f,c){if(!c)return null;c=Array.isArray(c)?c:[c];if(0<c.length){const l=c.map(x=>x.details.symbol.type||x.details.symbol.declaredClass).filter(x=>!!x);l.sort();const w=[];l.forEach((x,u)=>{0!==u&&x===l[u-1]||w.push(x)});return new k("renderer-conversion-3d:unsupported-symbols",
`Renderer contains symbols (${w.join(", ")}) which are not supported in 3D`,{renderer:f,symbolErrors:c})}return null}function g(f,c){const l={...p.defaultTo3DOptions,...c,cimFallbackEnabled:!0};c=f.uniqueValueInfos?.map(x=>p.to3D(x.symbol,l).error).filter(b.isSome);const w=p.to3D(f.defaultSymbol,l);w.error&&c?.unshift(w.error);return e(f,c)}function d(f,c){const l={...p.defaultTo3DOptions,...c,cimFallbackEnabled:!0};c=f.classBreakInfos.map(x=>p.to3D(x.symbol,l).error).filter(b.isSome);const w=p.to3D(f.defaultSymbol,
l);w.error&&c.unshift(w.error);return e(f,c)}a.isSupportedRenderer3D=h;a.validateTo3D=function(f,c){if(null==f)return null;if(!h(f))return new k("renderer-conversion-3d:unsupported-renderer",`Unsupported renderer of type '${f.type||f.declaredClass}'`,{renderer:f});switch(f.type){case "simple":return e(f,p.to3D(f.symbol,{...p.defaultTo3DOptions,...c,cimFallbackEnabled:!0}).error);case "unique-value":return g(f,c);case "class-breaks":return d(f,c)}return null};Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DFeatureStore":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Evented ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/Logger ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ../../../../geometry/projection ../../../../geometry/support/aaBoundingBox ../../../../layers/graphics/dehydratedFeatures ../../../../layers/graphics/OptimizedFeature ../../../../layers/graphics/OptimizedGeometry ../../../../layers/graphics/data/optimizedFeatureQueryEngineAdapter".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w,x,u){const t=c.create();a.Graphics3DFeatureStore=class extends n{constructor(q){super(q);this.events=new k;this.objectIdField=this.hasM=this.hasZ=null;this.featureAdapter={getAttribute(r,v){return"graphic"in r?r.graphic.attributes[v]:u.optimizedFeatureQueryEngineAdapter.getAttribute(r,v)},getAttributes(r){return"graphic"in r?r.graphic.attributes:u.optimizedFeatureQueryEngineAdapter.getAttributes(r)},getObjectId:r=>"graphic"in r?l.getObjectId(r.graphic,this.objectIdField)??
void 0:u.optimizedFeatureQueryEngineAdapter.getObjectId(r),getGeometry:r=>"graphic"in r?r.getAsOptimizedGeometry(this.hasZ,this.hasM):u.optimizedFeatureQueryEngineAdapter.getGeometry(r),getCentroid:(r,v)=>{if("graphic"in r){let y=null;null!=r.centroid?y=r.centroid:"point"===r.graphic.geometry.type&&f.projectPoint(r.graphic.geometry,m,this.viewSpatialReference)&&(y=m);r=Array(2+(v.hasZ?1:0)+(v.hasM?1:0));null==y?(r[0]=0,r[1]=0,r[2]=0,r[3]=0):(r[0]=y.x,r[1]=y.y,v.hasZ&&(r[2]=y.hasZ?y.z:0),v.hasM&&(r[v.hasZ?
3:2]=y.hasM?y.m:0));return new x([],r)}return u.optimizedFeatureQueryEngineAdapter.getCentroid(r,v)},cloneWithGeometry:(r,v)=>"graphic"in r?new w.OptimizedFeature(v,this.featureAdapter.getAttributes(r),null,this.featureAdapter.getObjectId(r)):u.optimizedFeatureQueryEngineAdapter.cloneWithGeometry(r,v)}}forEachInBounds(q,r){this.getSpatialIndex().forEachInBounds(q,r)}forEachBounds(q,r){const v=this.getSpatialIndex();for(const y of q)q=this.featureAdapter.getObjectId(y),null!=v.getBounds(q,t)&&r(t)}};
b.__decorate([p.property({constructOnly:!0})],a.Graphics3DFeatureStore.prototype,"getSpatialIndex",void 0);b.__decorate([p.property({constructOnly:!0})],a.Graphics3DFeatureStore.prototype,"forEach",void 0);b.__decorate([p.property({constructOnly:!0})],a.Graphics3DFeatureStore.prototype,"hasZ",void 0);b.__decorate([p.property({constructOnly:!0})],a.Graphics3DFeatureStore.prototype,"hasM",void 0);b.__decorate([p.property({constructOnly:!0})],a.Graphics3DFeatureStore.prototype,"objectIdField",void 0);
b.__decorate([p.property({constructOnly:!0})],a.Graphics3DFeatureStore.prototype,"viewSpatialReference",void 0);b.__decorate([p.property({constructOnly:!0})],a.Graphics3DFeatureStore.prototype,"featureSpatialReference",void 0);a.Graphics3DFeatureStore=b.__decorate([d.subclass("esri.views.3d.layers.graphics.Graphics3DFeatureStore")],a.Graphics3DFeatureStore);const m={type:"point",x:0,y:0,hasZ:!1,hasM:!1,spatialReference:null};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/optimizedFeatureQueryEngineAdapter":function(){define(["exports",
"../centroid","../OptimizedFeature","../OptimizedGeometry"],function(a,b,n,k){a.optimizedFeatureQueryEngineAdapter={getObjectId(p){return p.objectId},getAttributes(p){return p.attributes},getAttribute(p,h){return p.attributes[h]},cloneWithGeometry(p,h){return new n.OptimizedFeature(h,p.attributes,null,p.objectId)},getGeometry(p){return p.geometry},getCentroid(p,h){null==p.centroid&&(p.centroid=b.getCentroidOptimizedGeometry(new k,p.geometry,h.hasZ,h.hasM));return p.centroid}};Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/centroid":function(){define(["exports"],function(a){function b(k,p,h,e,g,d){d=g?d?4:3:d?3:2;let f=h,c=h+d,l=0,w=0,x=h=0,u=0;for(let t=0,m=e-1;t<m;t++,f+=d,c+=d){e=p[f];const q=p[f+1],r=p[f+2],v=p[c],y=p[c+1],B=p[c+2];let z=e*y-v*q;x+=z;l+=(e+v)*z;w+=(q+y)*z;g&&(z=e*B-v*r,h+=(r+B)*z,u+=z);e<k[0]&&(k[0]=e);e>k[1]&&(k[1]=e);q<k[2]&&(k[2]=q);q>k[3]&&(k[3]=q);g&&(r<k[4]&&(k[4]=r),r>k[5]&&(k[5]=r))}0<x&&(x*=-1);0<u&&(u*=-1);if(!x)return null;
k=[l,w,.5*x];g&&(k[3]=h,k[4]=.5*u);return k}function n(k,p,h,e,g){g=e?g?4:3:g?3:2;let d=p,f=p+g,c=0,l=0,w=0,x=0;for(let q=0,r=h-1;q<r;q++,d+=g,f+=g){var u=k[d];const v=k[d+1],y=k[d+2],B=k[f],z=k[f+1],A=k[f+2];if(e){var t=B-u;var m=z-v;const C=A-y;t=Math.sqrt(t*t+m*m+C*C)}else t=B-u,m=z-v,t=Math.sqrt(t*t+m*m);t&&(c+=t,e?(u=[u+.5*(B-u),v+.5*(z-v),y+.5*(A-y)],l+=t*u[0],w+=t*u[1],x+=t*u[2]):(u=[u+.5*(B-u),v+.5*(z-v)],l+=t*u[0],w+=t*u[1]))}return 0<c?e?[l/c,w/c,x/c]:[l/c,w/c]:0<h?e?[k[p],k[p+1],k[p+2]]:
[k[p],k[p+1]]:null}a.getCentroidOptimizedGeometry=function(k,p,h,e){if(!p?.lengths.length)return null;k.lengths.length&&(k.lengths.length=0);k.coords.length&&(k.coords.length=0);const g=k.coords,d=[],f=h?[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY]:[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY],{lengths:c,coords:l}=p;var w=h?e?4:3:e?3:2;
let x=0;for(const u of c){const t=b(f,l,x,u,h,e);t&&d.push(t);x+=u*w}d.sort((u,t)=>{let m=u[2]-t[2];0===m&&h&&(m=u[4]-t[4]);return m});d.length&&(w=6*d[0][2],g[0]=d[0][0]/w,g[1]=d[0][1]/w,h&&(w=6*d[0][4],g[2]=0!==w?d[0][3]/w:0),g[0]<f[0]||g[0]>f[1]||g[1]<f[2]||g[1]>f[3]||h&&(g[2]<f[4]||g[2]>f[5]))&&(g.length=0);if(!g.length)if(p=p.lengths[0]?n(l,0,c[0],h,e):null)g[0]=p[0],g[1]=p[1],h&&2<p.length&&(g[2]=p[2]);else return null;return k};a.lineCentroid=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/layers/graphics/Graphics3DSymbolFactory":function(){define(["exports","./Graphics3DPointSymbol","./Graphics3DSymbol"],function(a,b,n){a.make=function(k,p,h){switch(k.type){case "point-3d":return new b.Graphics3DPointSymbol(k,p,h);default:return new n.Graphics3DSymbol(k,p,h)}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DPointSymbol":function(){define("exports ../../../../core/asyncUtils ../../../../core/maybe ../../../../core/promiseUtils ./Graphics3DCalloutSymbolLayerFactory ./Graphics3DLineCalloutSymbolLayer ./Graphics3DSymbol".split(" "),
function(a,b,n,k,p,h,e){class g extends e.Graphics3DSymbol{constructor(d,f,c){super(d,f,c);this._calloutSymbolLayer=null;this.symbol.hasVisibleCallout()&&(this._calloutSymbolLayer=p.make(this.symbol,f))}async doLoad(d){const f=this._calloutSymbolLayer?b.result(this._calloutSymbolLayer.load()):null;try{await super.doLoad(d),k.throwIfAborted(d)}catch(c){throw this._calloutSymbolLayer?.abortLoad(),c;}f&&await f}destroy(){super.destroy();this._calloutSymbolLayer=n.destroyMaybe(this._calloutSymbolLayer)}createGraphics3DGraphic(d,
f){f=super.createGraphics3DGraphic(d,f);null!=this._calloutSymbolLayer&&null!=f&&(d=this._createCalloutGraphic(d))&&f.setCalloutGraphic(d);return f}globalPropertyChanged(d,f){return super.globalPropertyChanged(d,f)?this._calloutSymbolLayer?this._calloutSymbolLayer.globalPropertyChanged(d,f,c=>c.calloutLayer):!0:!1}updateGeometry(d,f){const c=super.updateGeometry(d,f);return c&&this._calloutSymbolLayer&&(d=d.calloutLayer)?this._calloutSymbolLayer.updateGeometry(d,f):c}_createCalloutGraphic(d){const f=
d.renderingInfo;d.renderingInfo=new h.LineCalloutSymbolLayerRenderingInfo(f.renderer,f.symbol);return this._calloutSymbolLayer.createGraphics3DGraphic(d)}}a.Graphics3DPointSymbol=g;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/GraphicsCorePerformanceInfo":function(){define(["exports"],function(a){class b{constructor(n,k,p){this.visible=n;this.missing=k;this.pending=p}}a.GraphicsCorePerformanceInfo=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/layers/graphics/GraphicStateTracking":function(){define(["exports","../../../../core/arrayUtils","../../../../core/handleUtils","../../../../layers/graphics/dehydratedFeatures"],function(a,b,n,k){class p{constructor(h){this._graphicsCore=h;this._idToState=new Map;this._states=new Set;const e=h.owner.layer?.objectIdField;e?(this._getGraphicId=g=>k.getObjectId(g,e),this._getGraphics3DGraphicById=g=>this._graphicsCore.getGraphics3DGraphicByObjectId(g)):(this._getGraphicId=g=>g.uid,this._getGraphics3DGraphicById=
g=>this._graphicsCore.getGraphics3DGraphicById(g))}destroy(){this._idToState.clear();this._states.forEach((h,e)=>this.remove(e))}add(h){const e=n.makeHandle(()=>this.remove(h));if(this._states.has(h))return e;const g=this._getGraphicId(h.graphic),d=this._getGraphics3DGraphicById(g);this._states.has(h)||this._states.add(h);this._ensureStateList(g).push(h);h.displaying=null!=d?d.isVisible():!1;h.isDraped=null!=d?d.isDraped:!1;h.tracking=!0;null!=d&&h.emit("changed");return e}remove(h){if(this._states.has(h)){if(this._idToState.size){const e=
this._getGraphicId(h.graphic),g=this._idToState.get(e);g&&(b.remove(g,h),0===g.length&&this._idToState.delete(e))}this._states.delete(h);h.tracking=!1;h.displaying=!1}}addGraphic(h){this._forEachState(h.graphic,e=>{e.displaying=h.isVisible();e.isDraped=h.isDraped;e.emit("changed")})}removeGraphic(h){this._forEachState(h.graphic,e=>{e.displaying=!1;e.isDraped=!1})}updateGraphicGeometry(h){this._forEachState(h.graphic,e=>e.emit("changed"))}updateGraphicVisibility(h){this._forEachState(h.graphic,e=>
e.displaying=h.isVisible())}updateGraphicError(h,e){this._forEachState(h,g=>g.error=e)}allGraphicsDeleted(){this._states.forEach(h=>h.displaying=!1)}_ensureStateList(h){var e=this._idToState.get(h);if(e)return e;e=[];this._idToState.set(h,e);return e}_forEachState(h,e){0!==this._states.size&&0!==this._idToState.size&&(h=this._getGraphicId(h),h=this._idToState.get(h),null!=h&&h.forEach(e))}}a.GraphicStateTracking=p;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/SpatialIndex2D":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/has ../../../../core/maybe ../../../../core/accessorSupport/decorators/property ../../../../core/Logger ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ../../../../core/libs/rbush/PooledRBush ../../../../geometry/support/aaBoundingBox ../../../../layers/graphics/dehydratedFeatures".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l){a.SpatialIndex2D=class extends n{constructor(x){super(x);this._index=new f.PooledRBush(9,k("esri-csp-restrictions")?u=>({minX:u.extent[0],minY:u.extent[1],maxX:u.extent[2],maxY:u.extent[3]}):[".extent[0]",".extent[1]",".extent[2]",".extent[3]"]);this._missing=new Set;this._boundsByFeature=new Map;this.objectIdField=this.hasM=this.hasZ=this.spatialReference=null;this.updating=!1}setup(x){this._addMany(x)}destroy(){this._missing.clear();this._index=p.destroyMaybe(this._index);
this._boundsByFeature.clear();this._boundsByFeature=null}update(){0<this._missing.size&&(this._addMany(Array.from(this._missing.values())),this.updating=!1,this._missing.clear())}get updatingRemaining(){return this._missing.size}queryGraphicUIDsInExtent(x,u,t){null!=u&&u.equals(this.spatialReference)&&(w.minX=x[0],w.minY=x[1],w.maxX=x[2],w.maxY=x[3],this.update(),this._index.search(w,m=>t(m.graphic.uid)))}add(x){this._missing.add(x);this.updating=!0}remove(x){this._missing.delete(x)?this.updating=
0<this._missing.size:x.extent&&(this._index.remove(x),x=l.getObjectId(x.graphic,this._get("objectIdField")),null!=x&&this._boundsByFeature.delete(x))}_addMany(x){if(0!==x.length){var u=this._get("objectIdField");for(const t of x){t.computeExtent(this.spatialReference);const m=l.getObjectId(t.graphic,u);null!=m&&this._boundsByFeature.set(m,t.extent)}this._index.load(x)}}clear(){this._index.clear();this._missing.clear();this._boundsByFeature.clear();this.updating=!1}forEachInBounds(x,u){w.minX=x[0];
w.minY=x[1];w.maxX=x[2];w.maxY=x[3];this.update();this._index.search(w,t=>{u(t)})}getBounds(x,u){this.update();return(x=this._boundsByFeature.get(x))?c.fromRect(u,x):null}};b.__decorate([h.property({constructOnly:!0})],a.SpatialIndex2D.prototype,"spatialReference",void 0);b.__decorate([h.property({constructOnly:!0})],a.SpatialIndex2D.prototype,"hasZ",void 0);b.__decorate([h.property({constructOnly:!0})],a.SpatialIndex2D.prototype,"hasM",void 0);b.__decorate([h.property({constructOnly:!0})],a.SpatialIndex2D.prototype,
"objectIdField",void 0);b.__decorate([h.property()],a.SpatialIndex2D.prototype,"updating",void 0);b.__decorate([h.property({readOnly:!0})],a.SpatialIndex2D.prototype,"updatingRemaining",null);a.SpatialIndex2D=b.__decorate([d.subclass("esri.views.3d.layers.graphics.SpatialIndex2D")],a.SpatialIndex2D);const w={minX:0,minY:0,maxX:0,maxY:0};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/libs/rbush/PooledRBush":function(){define(["exports","../../arrayUtils","../../has","../../PooledArray",
"../../../chunks/quickselect"],function(a,b,n,k,p){function h(H,E){for(r.clear();H;){if(!0===H.leaf)for(const F of H.children)E(F);else r.pushArray(H.children);H=r.pop()??null}}function e(H,E){g(H,0,H.children.length,E,H)}function g(H,E,F,G,D){D||=new A([]);D.minX=Infinity;D.minY=Infinity;D.maxX=-Infinity;D.maxY=-Infinity;for(let I=E,J;I<F;I++)J=H.children[I],d(D,H.leaf?G(J):J);return D}function d(H,E){H.minX=Math.min(H.minX,E.minX);H.minY=Math.min(H.minY,E.minY);H.maxX=Math.max(H.maxX,E.maxX);H.maxY=
Math.max(H.maxY,E.maxY)}function f(H,E){return H.minX-E.minX}function c(H,E){return H.minY-E.minY}function l(H){return(H.maxX-H.minX)*(H.maxY-H.minY)}function w(H){return H.maxX-H.minX+(H.maxY-H.minY)}function x(H,E){return H.minX<=E.minX&&H.minY<=E.minY&&E.maxX<=H.maxX&&E.maxY<=H.maxY}function u(H,E){return E.minX<=H.maxX&&E.minY<=H.maxY&&E.maxX>=H.minX&&E.maxY>=H.minY}function t(H,E,F,G,D){for(E=[E,F];E.length;){F=E.pop();const I=E.pop();if(F-I<=G)continue;const J=I+Math.ceil((F-I)/G/2)*G;p.quickselect(H,
J,I,F,D);E.push(I,J,J,F)}}class m{constructor(H=9,E){this._compareMinX=f;this._compareMinY=c;this._toBBox=F=>F;this._maxEntries=Math.max(4,H||9);this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries));E&&("function"===typeof E?this._toBBox=E:this._initFormat(E));this.clear()}destroy(){this.clear();q.prune();r.prune();v.prune();y.prune()}all(H){h(this._data,H)}search(H,E){let F=this._data;const G=this._toBBox;if(u(H,F))for(q.clear();F;){for(let D=0,I=F.children.length;D<I;D++){const J=F.children[D],
N=F.leaf?G(J):J;u(H,N)&&(F.leaf?E(J):x(H,N)?h(J,E):q.push(J))}F=q.pop()}}collides(H){let E=this._data;const F=this._toBBox;if(!u(H,E))return!1;for(q.clear();E;){for(let G=0,D=E.children.length;G<D;G++){const I=E.children[G],J=E.leaf?F(I):I;if(u(H,J)){if(E.leaf||x(H,J))return!0;q.push(I)}}E=q.pop()}return!1}load(H){if(!H.length)return this;if(H.length<this._minEntries){for(let E=0,F=H.length;E<F;E++)this.insert(H[E]);return this}H=this._build(H.slice(),0,H.length-1,0);if(this._data.children.length)if(this._data.height===
H.height)this._splitRoot(this._data,H);else{if(this._data.height<H.height){const E=this._data;this._data=H;H=E}this._insert(H,this._data.height-H.height-1,!0)}else this._data=H;return this}insert(H){H&&this._insert(H,this._data.height-1);return this}clear(){this._data=new A([]);return this}remove(H){if(!H)return this;let E=this._data,F=null,G=0,D=!1,I;const J=this._toBBox(H);v.clear();for(y.clear();E||0<v.length;){E||(E=v.pop(),F=v.data[v.length-1],G=y.pop()??0,D=!0);if(E.leaf&&(I=b.indexOf(E.children,
H,E.children.length,E.indexHint),-1!==I)){E.children.splice(I,1);v.push(E);this._condense(v);break}D||E.leaf||!x(E,J)?F?(G++,E=F.children[G],D=!1):E=null:(v.push(E),y.push(G),G=0,F=E,E=E.children[0])}return this}toJSON(){return this._data}fromJSON(H){this._data=H;return this}_build(H,E,F,G){var D=F-E+1,I=this._maxEntries;if(D<=I)return H=new A(H.slice(E,F+1)),e(H,this._toBBox),H;G||(G=Math.ceil(Math.log(D)/Math.log(I)),I=Math.ceil(D/I**(G-1)));const J=new C([]);J.height=G;D=Math.ceil(D/I);I=D*Math.ceil(Math.sqrt(I));
for(t(H,E,F,I,this._compareMinX);E<=F;E+=I){const N=Math.min(E+I-1,F);t(H,E,N,D,this._compareMinY);for(let M=E;M<=N;M+=D)J.children.push(this._build(H,M,Math.min(M+D-1,N),G-1))}e(J,this._toBBox);return J}_insert(H,E,F){var G=this._toBBox;F=F?H:G(H);v.clear();G=this._data;for(var D=E,I=v;;){I.push(G);if(!0===G.leaf||I.length-1===D)break;let J=Infinity,N=Infinity,M=void 0;for(let Q=0,O=G.children.length;Q<O;Q++){const K=G.children[Q],L=l(K),P=(Math.max(K.maxX,F.maxX)-Math.min(K.minX,F.minX))*(Math.max(K.maxY,
F.maxY)-Math.min(K.minY,F.minY))-L;P<N?(N=P,J=L<J?L:J,M=K):P===N&&L<J&&(J=L,M=K)}G=M||G.children[0]}G.children.push(H);for(d(G,F);0<=E;)if(v.data[E].children.length>this._maxEntries)this._split(v,E),E--;else break;for(H=v;0<=E;E--)d(H.data[E],F)}_split(H,E){const F=H.data[E];var G=F.children.length;const D=this._minEntries;this._chooseSplitAxis(F,D,G);if(G=this._chooseSplitIndex(F,D,G))G=F.children.splice(G,F.children.length-G),G=F.leaf?new A(G):new C(G),G.height=F.height,e(F,this._toBBox),e(G,this._toBBox),
E?H.data[E-1].children.push(G):this._splitRoot(F,G)}_splitRoot(H,E){this._data=new C([H,E]);this._data.height=H.height+1;e(this._data,this._toBBox)}_chooseSplitIndex(H,E,F){let G,D,I=void 0;G=D=Infinity;for(let N=E;N<=F-E;N++){var J=g(H,0,N,this._toBBox);const M=g(H,N,F,this._toBBox),Q=Math.max(0,Math.min(J.maxX,M.maxX)-Math.max(J.minX,M.minX))*Math.max(0,Math.min(J.maxY,M.maxY)-Math.max(J.minY,M.minY));J=l(J)+l(M);Q<G?(G=Q,I=N,D=J<D?J:D):Q===G&&J<D&&(D=J,I=N)}return I}_chooseSplitAxis(H,E,F){const G=
H.leaf?this._compareMinX:f,D=H.leaf?this._compareMinY:c,I=this._allDistMargin(H,E,F,G);E=this._allDistMargin(H,E,F,D);I<E&&H.children.sort(G)}_allDistMargin(H,E,F,G){H.children.sort(G);G=this._toBBox;var D=g(H,0,E,G);const I=g(H,F-E,F,G);let J=w(D)+w(I);for(let N=E;N<F-E;N++){const M=H.children[N];d(D,H.leaf?G(M):M);J+=w(D)}for(F=F-E-1;F>=E;F--)D=H.children[F],d(I,H.leaf?G(D):D),J+=w(I);return J}_condense(H){for(let E=H.length-1;0<=E;E--){const F=H.data[E];if(0===F.children.length)if(0<E){const G=
H.data[E-1],D=G.children;D.splice(b.indexOf(D,F,D.length,G.indexHint),1)}else this.clear();else e(F,this._toBBox)}}_initFormat(H){const E=["return a"," - b",";"];this._compareMinX=new Function("a","b",E.join(H[0]));this._compareMinY=new Function("a","b",E.join(H[1]));this._toBBox=new Function("a","return {minX: a"+H[0]+", minY: a"+H[1]+", maxX: a"+H[2]+", maxY: a"+H[3]+"};")}}const q=new k,r=new k,v=new k,y=new k({deallocator:void 0});class B{constructor(){this.minY=this.minX=Infinity;this.maxY=this.maxX=
-Infinity}}class z extends B{constructor(){super(...arguments);this.height=1;this.indexHint=new b.PositionHint}}class A extends z{constructor(H){super();this.children=H;this.leaf=!0}}class C extends z{constructor(H){super();this.children=H;this.leaf=!1}}a.BBox=B;a.PooledRBush=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/quickselect":function(){define(["exports"],function(a){function b(p,h,e,g,d){for(;g>e;){if(600<g-e){var f=g-e+1,c=h-e+1,l=Math.log(f),w=.5*Math.exp(2*
l/3);l=.5*Math.sqrt(l*w*(f-w)/f)*(0>c-f/2?-1:1);b(p,h,Math.max(e,Math.floor(h-c*w/f+l)),Math.min(g,Math.floor(h+(f-c)*w/f+l)),d)}f=p[h];c=e;w=g;n(p,e,h);for(0<d(p[g],f)&&n(p,e,g);c<w;){n(p,c,w);c++;for(w--;0>d(p[c],f);)c++;for(;0<d(p[w],f);)w--}0===d(p[e],f)?n(p,e,w):(w++,n(p,w,g));w<=h&&(e=w+1);h<=w&&(g=w-1)}}function n(p,h,e){var g=p[h];p[h]=p[e];p[e]=g}function k(p,h){return p<h?-1:p>h?1:0}a.quickselect=function(p,h,e,g,d){b(p,h,e||0,g||p.length-1,d||k)}})},"esri/views/3d/layers/graphics/symbolMemory":function(){define(["exports"],
function(a){a.getSymbolMemorySize=function(b){return 2216+4096*b.symbolLayers.length+b.complexity.memory.resourceBytes};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/support/StageLayerElevationProvider":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Evented ../../../../core/Logger ../../../../core/unitUtils ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../geometry/support/aaBoundingBox ../../../../symbols/support/unitConversionUtils ../../support/ElevationUpdateEvent ../../webgl-engine/lib/Intersector ../../webgl-engine/lib/IntersectorInterfaces ../../webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w,x,u,t,m,q){const r=Symbol("layerHandles");a.StageLayerElevationProvider=class extends k.EventedMixin(n){get spatialReference(){return this.view?.spatialReference}constructor(C){super(C);this._elevationOffset=0}initialize(){this._renderCoordsHelper=this.view.renderCoordsHelper;this._intersectLayers=[this.stageLayer];this._intersector=t.newIntersector(this.view.state.viewingMode);this._intersector.options.store=m.StoreResults.MIN;var C=this._computeLayerExtent(this.spatialReference,
this.stageLayer);this._zmin=C[2];this._zmax=C[5];C=this.stageLayer.events;this.addHandles([C.on(["layerObjectAdded","layerObjectRemoved","geometryAdded","geometryRemoved"],({object:H})=>this._objectChanged(H)),C.on("attributesChanged",({attribute:H,object:E})=>q.affectsGeometry(H)&&this._objectChanged(E)),C.on(["transformationChanged","shaderTransformationChanged"],H=>this._objectChanged(H))],r)}dispose(){this.removeHandles(r)}elevationInfoChanged(){const C=null!=this.layer?this.layer.elevationInfo:
null;if(null!=C&&"on-the-ground"!==C.mode){const H=h.getMetersPerVerticalUnitForSR(this.layer.spatialReference),E=x.getMetersPerUnit(C.unit??"meters");this._elevationOffset=(C.offset??0)*E/H}else this._elevationOffset=0}getElevation(C,H,E,F){B[0]=C;B[1]=H;B[2]=E;if(!this._renderCoordsHelper.toRenderCoords(B,F,B))return p.getLogger(this).error("could not project point for elevation alignment"),null;C=this._elevationOffset;H=this._zmin+C;this._renderCoordsHelper.setAltitude(z,this._zmax+C,B);this._renderCoordsHelper.setAltitude(A,
H,B);this._intersector.reset(z,A,null);this._intersector.intersect(this._intersectLayers,null,1,null,G=>!!G.lastValidElevationBB);return this._intersector.results.min.getIntersectionPoint(B)?this._renderCoordsHelper.getAltitude(B):null}_objectChanged(C){const H=this.spatialReference;if(C.lastValidElevationBB&&H){w.empty(v);var E=C.lastValidElevationBB;E.isEmpty()||this._expandExtent(H,E.min,E.max,v);var {min:F,max:G}=C.boundingVolumeWorldSpace;this._expandExtent(H,F,G,v);w.toRect(v,y.extent);this._zmin=
Math.min(this._zmin,v[2]);this._zmax=Math.max(this._zmax,v[5]);y.spatialReference=H;this.emit("elevation-change",y);c.copy(E.min,F);c.copy(E.max,G)}}_computeLayerExtent(C,H){w.empty(v);null!=C&&H.objects.forAll(E=>this._expandExtent(C,E.boundingVolumeWorldSpace.min,E.boundingVolumeWorldSpace.max,v));return v}_expandExtent(C,H,E,F){for(let G=0;8>G;++G)B[0]=G&1?H[0]:E[0],B[1]=G&2?H[1]:E[1],B[2]=G&4?H[2]:E[2],this._renderCoordsHelper.fromRenderCoords(B,B,C),w.expandWithVec3(F,B);return F}};b.__decorate([e.property({constructOnly:!0})],
a.StageLayerElevationProvider.prototype,"layer",void 0);b.__decorate([e.property({constructOnly:!0})],a.StageLayerElevationProvider.prototype,"stageLayer",void 0);b.__decorate([e.property({constructOnly:!0})],a.StageLayerElevationProvider.prototype,"view",void 0);b.__decorate([e.property()],a.StageLayerElevationProvider.prototype,"spatialReference",null);a.StageLayerElevationProvider=b.__decorate([f.subclass("esri.views.3d.layers.support.StageLayerElevationProvider")],a.StageLayerElevationProvider);
const v=w.empty(),y=new u.ElevationUpdateEvent,B=l.create(),z=l.create(),A=l.create();Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DElevationAlignment":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Evented ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/Logger ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ./ExtentSet ../../webgl-engine/lib/UpdatePolicy ../../../support/Scheduler".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w){function x(u){return null==u?w.TaskPriority.ELEVATION_ALIGNMENT:"relative-to-scene"===u?w.TaskPriority.ELEVATION_ALIGNMENT_SCENE:w.TaskPriority.ELEVATION_ALIGNMENT}a.Graphics3DElevationAlignment=class extends n{constructor(u){super(u);this._dirtyExtents=new c.ExtentSet;this._globalDirty=!1;this._averageExtentUpdateSize=0;this._dirtyGraphicsSet=new Set;this._updateElevation=!1;this.graphicsCore=this.graphicsCoreOwner=null;this.events=new k}initialize(){const u=this.elevationProvider;
this._task=this.graphicsCoreOwner.view.resourceController.scheduler.registerTask(x(this.graphicsCore.layer.elevationInfo?.mode),this);this.addHandles([u.on("elevation-change",t=>this._elevationChanged(t)),p.watch(()=>this.graphicsCoreOwner.suspended,()=>this._suspendedChange()),this._task,p.watch(()=>x(this.graphicsCore.layer.elevationInfo?.mode),t=>this._task.priority=t)])}destroy(){this._dirtyGraphicsSet.clear();this.elevationProvider=this.queryGraphicUIDsInExtent=this.graphicsCore=this.graphicsCoreOwner=
null}clear(){this._dirtyGraphicsSet.clear();this.notifyChange("updating")}_suspendedChange(){!0===this.graphicsCoreOwner.suspended?this._updateElevation=!1:!1===this.graphicsCoreOwner.suspended&&this._updateElevation&&(this._globalDirty=!0,this.notifyChange("updating"))}elevationInfoChange(){this._globalDirty=!0;this.notifyChange("updating")}get updating(){return this.running}get running(){return 0<this._dirtyGraphicsSet.size||this._dirtyExtents&&!this._dirtyExtents.empty||this._globalDirty}get updatingRemaining(){return this._dirtyGraphicsSet.size+
this._dirtyExtents.size*this._averageExtentUpdateSize}runTask(u){this._globalDirty&&(this._markAllGraphicsElevationDirty(),this._globalDirty=!1,u.madeProgress());for(u.run(()=>this._dirtyExtents.merge(u));this.running&&!u.done;)this._updateDirtyGraphics(u),this._updateDirtyExtents(u);this.notifyChange("updating")}_updateDirtyGraphics(u){const t=this.graphicsCoreOwner.view.renderCoordsHelper,m=this.graphicsCore.effectiveUpdatePolicy===l.UpdatePolicy.ASYNC;for(const q of this._dirtyGraphicsSet.keys()){const r=
this.graphicsCore.getGraphics3DGraphicById(q);this._dirtyGraphicsSet.delete(q);null!=r&&(r.alignWithElevation(this.elevationProvider,t,m),this.graphicsCore.deconflictor?.setDirty(),u.madeProgress());if(u.done)break}}_updateDirtyExtents(u){for(;!this._dirtyExtents.empty&&!u.done;){const t=this._dirtyExtents.pop(),m=this.elevationProvider.spatialReference;this.events.emit("invalidate-elevation",{extent:t,spatialReference:m});const q=this._dirtyGraphicsSet.size;this.queryGraphicUIDsInExtent(t,m,r=>{const v=
this.graphicsCore.getGraphics3DGraphicById(r);null!=v&&v.needsElevationUpdates()&&this._dirtyGraphicsSet.add(r)});this._averageExtentUpdateSize=.1*(this._dirtyGraphicsSet.size-q)+.9*this._averageExtentUpdateSize;u.madeProgress()}}_markAllGraphicsElevationDirty(){this._dirtyExtents.clear();this._dirtyGraphicsSet.clear();this.graphicsCore.graphics3DGraphics.forEach((u,t)=>this._dirtyGraphicsSet.add(t))}_elevationChanged(u){if("scene"!==u.context||this.graphicsCore.layer.elevationInfo&&"relative-to-scene"===
this.graphicsCore.layer.elevationInfo.mode){var t=u.extent;if(this.graphicsCoreOwner.suspended){if(!this._updateElevation){const m=this.graphicsCore.computedExtent;m&&t[2]>m.xmin&&t[0]<m.xmax&&t[3]>m.ymin&&t[1]<m.ymax&&(this._updateElevation=!0)}this.events.emit("invalidate-elevation",u)}else-Infinity===t[0]?this._globalDirty=!0:this._dirtyExtents.add(t),this.notifyChange("updating")}}};b.__decorate([h.property()],a.Graphics3DElevationAlignment.prototype,"graphicsCoreOwner",void 0);b.__decorate([h.property()],
a.Graphics3DElevationAlignment.prototype,"graphicsCore",void 0);b.__decorate([h.property()],a.Graphics3DElevationAlignment.prototype,"queryGraphicUIDsInExtent",void 0);b.__decorate([h.property()],a.Graphics3DElevationAlignment.prototype,"elevationProvider",void 0);b.__decorate([h.property({readOnly:!0})],a.Graphics3DElevationAlignment.prototype,"updating",null);b.__decorate([h.property({readOnly:!0})],a.Graphics3DElevationAlignment.prototype,"updatingRemaining",null);a.Graphics3DElevationAlignment=
b.__decorate([f.subclass("esri.views.3d.layers.graphics.Graphics3DElevationAlignment")],a.Graphics3DElevationAlignment);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/ExtentSet":function(){define(["exports","../../../../core/has","../../../../core/PooledArray","../../../../geometry/support/aaBoundingRect","../../../support/Scheduler"],function(a,b,n,k,p){class h{constructor(){this._extents=new n({allocator:e=>e||k.create()});this._tmpExtent=k.create();
this._dirty=!1}get empty(){return 0===this._extents.length}get size(){return this._extents.length}clear(){this._extents.clear()}add(e){this._contains(e)||(this._removeContained(e),k.copy(this._extents.pushNew(),e),this._dirty=!0)}pop(){this._dirty&&this._mergeTight();return this._extents.pop()}merge(e){this._mergeTight(e);return e.hasProgressed}_mergeTight(e=p.noBudget){const g=this._extents,d=new Set;let f=0;for(;f!==g.length;){g.sort((c,l)=>c[0]-l[0]);f=g.length;d.clear();for(let c=0;c<g.length;++c){if(e.done)return;
const l=g.at(c);if(l){for(let w=c+1;w<g.length;++w){const x=g.at(w);if(null==x||x[0]>=l[2])break;d.add(x)}d.forEach(w=>{if(l!==w)if(w[2]<=l[0])d.delete(w);else{var x=k.area(l),u=k.area(w),t=this._tmpExtent;k.expand(l,w,t);x+=u;.05>(k.area(t)-x)/x&&(k.copy(l,t),d.delete(w),g.remove(w),e.madeProgress())}});d.add(l)}}}this._dirty=!1}_contains(e){return this._extents.some(g=>k.contains(g,e))}_removeContained(e){this._extents.filterInPlace(g=>!k.contains(e,g))}get test(){}}a.ExtentSet=h;Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DFrustumVisibility":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/Logger ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ../../../../geometry/ellipsoidUtils ../../support/FrustumExtentIntersection ../../../support/Scheduler ../../../support/Yield".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w){a.Graphics3DFrustumVisibility=class extends n{constructor(x){super(x);this.suspended=!1;this._extent=null;this._extentIntersectionDirty=!0;this._isVisibleBelowSurfaceInternal=!1;this.graphicsCoreOwner=null;this.updating=!0}initialize(){var {graphicsCoreOwner:x}=this;this._extentIntersection=new c.FrustumExtentIntersection({renderCoordsHelper:x.view.renderCoordsHelper});const u=x.view,t=u.basemapTerrain;x=u.resourceController.scheduler;this.addHandles([u.on("resize",
()=>this._viewChange()),k.watch(()=>u.state.camera,()=>this._viewChange(),k.sync),x.registerTask(l.TaskPriority.FRUSTUM_VISIBILITY,this),k.watch(()=>t.visibleElevationBounds,()=>this._elevationBoundsChange())]);"local"===u.viewingMode?this._isVisibleBelowSurface=!0:this.addHandles([k.watch(()=>[t.baseOpacity,t.wireframe,u.map?.ground?.navigationConstraint?.type],()=>this._updateIsVisibleBelowSurface(),k.initial)])}destroy(){this._set("graphicsCoreOwner",null);this._extentIntersection=this._extent=
null}_setDirty(){this.updating||this._set("updating",!0)}setExtent(x){this._extent=x;this._extentIntersectionDirty=!0;this._setDirty()}_viewChange(){this._setDirty()}_elevationBoundsChange(){this._setDirty();this._extentIntersectionDirty=!0}set _isVisibleBelowSurface(x){this._isVisibleBelowSurfaceInternal=x;this._setDirty();this._extentIntersectionDirty=!0}_updateIsVisibleBelowSurface(){const x=this.graphicsCoreOwner.view,u=x.basemapTerrain,t="none"===x.map.ground?.navigationConstraint?.type;this._isVisibleBelowSurface=
"local"===x.viewingMode||!u.opaque||t}_updateExtentIntersection(){if(this._extentIntersectionDirty){this._extentIntersectionDirty=!1;var x=this.graphicsCoreOwner.view;if(this._isVisibleBelowSurfaceInternal)var u=-.3*f.getReferenceEllipsoid(x.spatialReference).radius;else{const {min:t,max:m}=x.basemapTerrain.visibleElevationBounds;u=t-Math.max(1,(m-t)*(1.2-1))}this._extentIntersection.update(this._extent,x.spatialReference,u)}}get running(){return this.updating}runTask(x){this._set("updating",!1);
if(!this._extent)return this._set("suspended",!1),w.Yield;this._updateExtentIntersection();const u=this.graphicsCoreOwner.view.frustum,t=f.getReferenceEllipsoid(this.graphicsCoreOwner.view.spatialReference).radius;this._set("suspended",!this._extentIntersection.isVisibleInFrustum(u,t));x.madeProgress()}};b.__decorate([p.property({readOnly:!0})],a.Graphics3DFrustumVisibility.prototype,"suspended",void 0);b.__decorate([p.property({constructOnly:!0})],a.Graphics3DFrustumVisibility.prototype,"graphicsCoreOwner",
void 0);b.__decorate([p.property({readOnly:!0})],a.Graphics3DFrustumVisibility.prototype,"updating",void 0);a.Graphics3DFrustumVisibility=b.__decorate([d.subclass("esri.views.3d.layers.graphics.Graphics3DFrustumVisibility")],a.Graphics3DFrustumVisibility);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/FrustumExtentIntersection":function(){define("exports ../../../core/compilerUtils ../../../core/mathUtils ../../../core/libs/gl-matrix-2/math/mat4 ../../../core/libs/gl-matrix-2/factories/mat4f64 ../../../chunks/vec32 ../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../geometry/ellipsoidUtils ../../../geometry/projection/computeTranslationToOriginAndRotation ../../../geometry/projection/projectBoundingRect ../../../geometry/projection/projectVectorToVector ../../../geometry/support/aaBoundingBox ../../../geometry/support/aaBoundingRect ../../../geometry/support/frustum ../../../geometry/support/lineSegment ../../../geometry/support/plane ../../../geometry/support/ray ../../ViewingMode ./intersectionUtils".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w,x,u,t,m,q,r){const v=.5*Math.PI,y=v/Math.PI*180;class B{constructor(D){this._renderCoordsHelper=D.renderCoordsHelper;this._extent=Array(4);this._planes=Array(6);this._maxSpan=0;this._center={origin:e.create(),direction:e.create()};for(D=0;4>D;D++)this._extent[D]={origin:e.create(),direction:e.create(),cap:{next:null,direction:e.create()}},this._planes[D]=t.create();this._planes[x.PlaneIndex.NEAR]=t.create();this._planes[x.PlaneIndex.FAR]=t.create();this._planesWithoutFar=
this._planes.slice(0,5)}update(D,I,J,N=!0){const M=this._extent;this._toRenderBoundingExtent(D,I,J);h.add(this._center.origin,M[0].origin,M[2].origin);h.scale(this._center.origin,this._center.origin,.5);this._renderCoordsHelper.worldUpAtPosition(this._center.origin,this._center.direction);N||h.scale(this._center.direction,this._center.direction,-1);for(J=0;4>J;J++){const Q=M[J];this._renderCoordsHelper.worldUpAtPosition(Q.origin,Q.direction);const O=M[3===J?0:J+1];Q.cap.next=O.origin;h.direction(Q.cap.direction,
Q.origin,O.origin);t.fromVectorsAndPoint(Q.direction,Q.cap.direction,Q.origin,this._planes[J]);N||h.scale(Q.direction,Q.direction,-1)}t.fromVectorsAndPoint(M[0].cap.direction,M[1].cap.direction,M[0].origin,this._planes[x.PlaneIndex.NEAR]);N?t.negate(this._planes[x.PlaneIndex.NEAR],this._planes[x.PlaneIndex.FAR]):(t.copy(this._planes[x.PlaneIndex.FAR],this._planes[x.PlaneIndex.NEAR]),t.negate(this._planes[x.PlaneIndex.NEAR],this._planes[x.PlaneIndex.NEAR]));this._maxSpan=Math.max(Math.abs(D[0]-D[2]),
Math.abs(D[1]-D[3]));this._maxSpanSpatialReference=I;this._minGlobalAltitude=.9*g.getReferenceEllipsoid(this._maxSpanSpatialReference).radius}isVisibleInFrustum(D,I,J=!1){if(null==D)return!1;if(this._renderCoordsHelper.viewingMode===q.ViewingMode.Global){if(this._maxSpan>(this._maxSpanSpatialReference.isGeographic?y:v*I))return!0;if(null!=D.altitude&&D.altitude>=this._minGlobalAltitude)return this._isVisibleInFrustumGlobal(D)}if(0===this._maxSpan)return I=this._extent[0],!J&&D.intersectsRay(m.wrap(I.origin,
I.direction))?!0:!1;for(I=0;I<this._extent.length;I++){var N=this._extent[I];if(!J&&D.intersectsRay(m.wrap(N.origin,N.direction))||D.intersectsLineSegment(u.fromPoints(N.origin,N.cap.next,G),N.cap.direction))return!0}J=J?this._planes:this._planesWithoutFar;for(I=0;I<D.lines.length;I++)if(N=D.lines[I],r.frustumLineSegment(J,N.origin,N.endpoint,N.direction))return!0;return!1}_toRenderBoundingExtentGlobal(D,I,J){w.center(D,A);A[2]=J;d.computeTranslationToOriginAndRotation(I,A,C,this._renderCoordsHelper.spatialReference);
k.invert(H,C);l.empty(E);for(const {x0:N,x1:M,y0:Q,y1:O}of z)for(let K=0;5>K;K++){const L=K/4;A[0]=n.lerp(D[N],D[M],L);A[1]=n.lerp(D[Q],D[O],L);A[2]=J;c.projectVectorToVector(A,I,A,this._renderCoordsHelper.spatialReference);h.transformMat4(A,A,H);l.expandWithVec3(E,A)}h.set(this._extent[0].origin,E[0],E[1],E[2]);h.set(this._extent[1].origin,E[3],E[1],E[2]);h.set(this._extent[2].origin,E[3],E[4],E[2]);h.set(this._extent[3].origin,E[0],E[4],E[2]);for(D=0;4>D;++D)h.transformMat4(this._extent[D].origin,
this._extent[D].origin,C)}_toRenderBoundingExtentLocal(D,I,J){f.projectBoundingRect(D,I,F,this._renderCoordsHelper.spatialReference);h.set(this._extent[0].origin,F[0],F[1],J);h.set(this._extent[1].origin,F[2],F[1],J);h.set(this._extent[2].origin,F[2],F[3],J);h.set(this._extent[3].origin,F[0],F[3],J)}_toRenderBoundingExtent(D,I,J){switch(this._renderCoordsHelper.viewingMode){case q.ViewingMode.Global:this._toRenderBoundingExtentGlobal(D,I,J);break;case q.ViewingMode.Local:this._toRenderBoundingExtentLocal(D,
I,J);break;default:b.neverReached(this._renderCoordsHelper.viewingMode)}}_isVisibleInFrustumGlobal(D){if(0>t.signedDistance(D.planes[x.PlaneIndex.NEAR],this._center.origin)&&0>h.dot(this._center.direction,D.direction))return!0;for(let I=0;4>I;I++){const J=this._extent[I];if(0>t.signedDistance(D.planes[x.PlaneIndex.NEAR],J.origin)&&0>h.dot(J.direction,D.direction))return!0}return!1}}const z=[{x0:0,y0:1,x1:2,y1:1},{x0:0,y0:3,x1:2,y1:3},{x0:0,y0:1,x1:0,y1:3},{x0:2,y0:1,x1:2,y1:3}],A=e.create(),C=p.create(),
H=p.create(),E=l.create(),F=w.create(),G=u.create();a.FrustumExtentIntersection=B;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DObjectStates":function(){define(["exports","../../../../core/handleUtils","../../../../core/has","./Graphics3DObjectStateSet"],function(a,b,n,k){class p{constructor(h){this._graphicsCore=h;this._stateSets=[]}destroy(){this.reset();this._stateSets=null}reset(){this._stateSets&&(this._stateSets.forEach(h=>h.objectStateSet.removeAll()),
this._stateSets.length=0)}acquireOccludeeSet(h){const e=new k.Graphics3DOccludeeStateSet(h);this._stateSets.push(e);h=b.makeHandle(()=>this.releaseSet(e));return{set:e,handle:h}}acquireHighlightSet(h,e){const g=new k.Graphics3DObjectHighlightStateSet(h,e);this._stateSets.push(g);h=b.makeHandle(()=>this.releaseSet(g));return{set:g,handle:h}}releaseSet(h){h.objectStateSet.removeAll();h=this._stateSets?this._stateSets.indexOf(h):-1;-1!==h&&this._stateSets.splice(h,1)}setUid(h,e){h.ids.add(e);(e=this._graphicsCore.graphics3DGraphics.get(e))&&
e.addObjectStateSet(h.objectStateSet)}setUids(h,e){e.forEach(g=>this.setUid(h,g))}setObjectIds(h,e){e.forEach(g=>h.ids.add(g));this._initializeSet(h)}addGraphic(h){this._stateSets.forEach(e=>{!e.paused&&e.hasGraphic(h)&&h.addObjectStateSet(e.objectStateSet)})}removeGraphic(h){this._stateSets.forEach(e=>{e.hasGraphic(h)&&h.removeObjectState(e.objectStateSet)})}allGraphicsDeleted(){this._stateSets&&this._stateSets.forEach(h=>h.objectStateSet.removeAll())}_initializeSet(h){const e=this._graphicsCore.graphics3DGraphics;
h.objectIdField?e.forEach(g=>{g&&h.hasGraphic(g)&&g.addObjectStateSet(h.objectStateSet)}):h.ids.forEach(g=>{(g=e.get(g))&&g.addObjectStateSet(h.objectStateSet)})}get test(){}}a.Graphics3DObjectStates=p;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DObjectStateSet":function(){define(["exports","../../webgl-engine/lib/basicInterfaces","../../webgl-engine/lib/Object3DStateSet"],function(a,b,n){class k{constructor(e){this.objectIdField=e;this.ids=
new Set;this.paused=!1}hasGraphic(e){return this.ids.has(this.objectIdField?e.graphic.attributes[this.objectIdField]:e.graphic.uid)}}class p extends k{constructor(e){super(e);this.stateType=b.Object3DState.MaskOccludee;this.objectStateSet=new n.Object3DOccludeeStateSet}}class h extends k{constructor(e,g){super(g);this.highlightGroupName=e;this.stateType=b.Object3DState.Highlight;this.objectStateSet=new n.Object3DHighlightStateSet(e)}}a.Graphics3DObjectHighlightStateSet=h;a.Graphics3DOccludeeStateSet=
p;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/Object3DStateSet":function(){define(["exports","./basicInterfaces"],function(a,b){class n{}class k extends n{constructor(f,c){super();this.objectStateId=f;this.object=c}remove(){this.object.removeStateID(this.objectStateId)}}class p extends n{constructor(f,c,l){super();this.objectStateId=f;this.object=c;this.owner=l}remove(){this.owner.removeRenderGeometryObjectState(this.object,this.objectStateId)}}
class h extends n{constructor(f,c){super();this.objectStateId=f;this._removeCallback=c;this.object=null}remove(){this._removeCallback(this.objectStateId)}}class e{constructor(){this._items=[]}addObject(f,c){this._items.push(new k(c,f))}addRenderGeometry(f,c,l){this._items.push(new p(c,f,l))}addExternal(f,c){this._items.push(new h(c,f))}remove(f){this._remove(c=>c.objectStateId===f)}removeByObject(f){this._remove(c=>c.object===f)}removeAll(){this._items.forEach(f=>f.remove());this._items=[]}_remove(f){const {_items:c}=
this;for(let l=c.length-1;0<=l;--l){const w=c[l];f(w)&&(w.remove(),c.splice(l,1))}}}class g extends e{constructor(){super(...arguments);this.stateType=b.Object3DState.MaskOccludee}}class d extends e{constructor(f){super();this.highlightGroupName=f;this.stateType=b.Object3DState.Highlight}}a.Object3DHighlightStateSet=d;a.Object3DOccludeeStateSet=g;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DScaleVisibility":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Logger ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ../../../../core/support/UpdatingHandles ../../../../geometry/projection/projectBoundingRect ../../../../geometry/support/aaBoundingRect ./enums ../../../support/layerViewUtils ../../../support/Scheduler ../../../support/Yield".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w,x,u){a.Graphics3DScaleVisibility=class extends n{constructor(m){super(m);this._layerScaleRangeVisibilityQuery=this._scaleRangeActive=!1;this._extent=null;this._updatingHandles=new d.UpdatingHandles;this.basemapTerrain=this.graphicsCore=this.queryGraphicUIDsInExtent=this.layer=this.graphicsCoreOwner=null;this.layerScaleEnabled=!0;this.suspended=!1;this._dirty=!0}initialize(){this.updateScaleRangeActive();this.addHandles(this.graphicsCoreOwner.view.resourceController.scheduler.registerTask(x.TaskPriority.SCALE_VISIBILITY,
this));this._updatingHandles.add(()=>this.layer.effectiveScaleRange,()=>this.layerMinMaxScaleChangeHandler())}destroy(){this._updatingHandles.destroy();this.removeHandles();this._dirty=!1;this.basemapTerrain=this.graphicsCore=this.queryGraphicUIDsInExtent=this.layer=this.graphicsCoreOwner=this._extent=null}get updating(){return this._dirty||this._updatingHandles.updating}_setDirty(){this._dirty=!0}setExtent(m){const q=this.graphicsCoreOwner.view.spatialReference,r=this.graphicsCoreOwner.view.basemapTerrain.spatialReference;
if(q===r)this._extent=m??null;else{const v=c.create();f.projectBoundingRect(m,q,v,r)?this._extent=v:this._extent=null}this._setDirty()}scaleRangeActive(){return this._scaleRangeActive}updateScaleRangeActive(){var m=this.layer,q=m.effectiveScaleRange;q=this.layerScaleEnabled&&null!=q&&(0<q.minScale||0<q.maxScale);m.labelingInfo&&!q&&(q=m.labelingInfo.some(r=>r&&(0<(r.minScale??0)||0<(r.maxScale??0))));m=this._scaleRangeActive!==q;(this._scaleRangeActive=q)&&!this.hasHandles("terrain-events")&&this.basemapTerrain?
(this.addHandles(this.basemapTerrain.on("scale-change",r=>this._scaleUpdateHandler(r)),"terrain-events"),this.layerScaleEnabled&&this.addHandles(this.basemapTerrain.on("tiles-visibility-changed",()=>this._setDirty()),"terrain-events")):!q&&this.hasHandles("terrain-events")&&this.removeHandles("terrain-events");return m}get running(){return!(!this.graphicsCoreOwner.view.basemapTerrain||!this.updating)}runTask(m){const q=this.graphicsCoreOwner.view.basemapTerrain;if(this._extent&&q&&q.ready&&this._scaleRangeActive&&
this.layerScaleEnabled){if(this._layerScaleRangeVisibilityQuery)return u.Yield;this._layerScaleRangeVisibilityQuery=!0;const {minScale:r,maxScale:v}=this.layer.effectiveScaleRange;q.queryVisibleScaleRange(this._extent,r,v,y=>this._finishUpdate(y))}else this._finishUpdate(!0);m.madeProgress()}_finishUpdate(m){this._layerScaleRangeVisibilityQuery=!1;this._set("suspended",!m);this._dirty=!1}_visibleAtLayerScale(m){const q=this.layer.effectiveScaleRange;return!this.layerScaleEnabled||w.scaleBoundsPredicate(m,
q.minScale||0,q.maxScale||0)}_visibleAtLabelScale(m,q){return w.scaleBoundsPredicate(m,q.minScale||0,q.maxScale||0)}_graphicScale(m){let q;null!=m.centroid?q=m.centroid:null!=m.graphic.geometry&&"point"===m.graphic.geometry.type&&(q=m.graphic.geometry);return q?this.graphicsCoreOwner.view.basemapTerrain?this.graphicsCoreOwner.view.basemapTerrain.getScale(q):1:null}_graphicVisible(m){if(!this.layerScaleEnabled)return!0;m=this._graphicScale(m);return this._visibleAtLayerScale(m)}updateVisibility(m){if(this._scaleRangeActive){const q=
this._graphicVisible(m);return m.setVisibilityFlag(l.VisibilityGroup.GRAPHIC,l.VisibilityFlag.SCALE_RANGE,q)}return!1}updateGraphicLabelScaleVisibility(m){if(!this._scaleRangeActive||!m.labelLayers||0===m.labelLayers.length)return!1;const q=this._graphicScale(m);if(m=this._updateLabelScaleVisibility(m,q))this.graphicsCore.deconflictor?.setDirty(),this.graphicsCore.labeler?.setDirty();return m}_updateLabelScaleVisibility(m,q){if(!m.labelLayers||0===m.labelLayers.length)return!1;const r=m.labelLayers[0]._labelClass;
return null!=r?.minScale&&null!=r.maxScale&&(q=this._visibleAtLabelScale(q,r),m.setVisibilityFlag(l.VisibilityGroup.LABEL,l.VisibilityFlag.SCALE_RANGE,q))?!0:!1}_scaleUpdateHandler(m){this._setDirty();if(this.graphicsCore.visible){var q=m.extent,r=m.scale,v=this._visibleAtLayerScale(r),y=!1,B=this.graphicsCoreOwner.view.spatialReference;m=m.spatialReference;if(null==m)k.getLogger(this).error("scaleUpdate: Internal error, no SpatialReference given for tiles");else{var z=!m.equals(B);z&&!f.projectBoundingRect(q,
m,t,B)?k.getLogger(this).error("scaleUpdate: Internal error, cannot project AABR from "+m+" to wkid "+B):(this.queryGraphicUIDsInExtent(z?t:q,B,A=>{A=this.graphicsCore.getGraphics3DGraphicById(A);if(null!=A){var C=A.centroid;null!=C&&(q[0]>C.x||q[1]>C.y||q[2]<C.x||q[3]<C.y)||(A.setVisibilityFlag(l.VisibilityGroup.GRAPHIC,l.VisibilityFlag.SCALE_RANGE,v)&&(y=!0),this._updateLabelScaleVisibility(A,r)&&(y=!0))}}),y&&(this.graphicsCore.deconflictor?.setDirty(),this.graphicsCore.labeler?.setDirty()))}}}layerMinMaxScaleChangeHandler(){this.updateScaleRangeActive()&&
!this._scaleRangeActive?this.graphicsCore.modifyGraphics3DGraphicVisibilities(m=>m.setVisibilityFlag(l.VisibilityGroup.GRAPHIC,l.VisibilityFlag.SCALE_RANGE,!0)):this._scaleRangeActive&&this.graphicsCore.updateGraphicsVisibilities();this._setDirty()}};b.__decorate([p.property()],a.Graphics3DScaleVisibility.prototype,"graphicsCoreOwner",void 0);b.__decorate([p.property()],a.Graphics3DScaleVisibility.prototype,"layer",void 0);b.__decorate([p.property()],a.Graphics3DScaleVisibility.prototype,"queryGraphicUIDsInExtent",
void 0);b.__decorate([p.property()],a.Graphics3DScaleVisibility.prototype,"graphicsCore",void 0);b.__decorate([p.property()],a.Graphics3DScaleVisibility.prototype,"basemapTerrain",void 0);b.__decorate([p.property({constructOnly:!0})],a.Graphics3DScaleVisibility.prototype,"layerScaleEnabled",void 0);b.__decorate([p.property({readOnly:!0})],a.Graphics3DScaleVisibility.prototype,"suspended",void 0);b.__decorate([p.property({readOnly:!0})],a.Graphics3DScaleVisibility.prototype,"updating",null);b.__decorate([p.property()],
a.Graphics3DScaleVisibility.prototype,"_dirty",void 0);a.Graphics3DScaleVisibility=b.__decorate([g.subclass("esri.views.3d.layers.graphics.Graphics3DScaleVisibility")],a.Graphics3DScaleVisibility);const t=c.create();Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/support/attributeUtils":function(){define(["exports"],function(a){a.attributeLookup=function(b,n,k){if(!k||null==n)return null;if(!b){a:{b=k.toLowerCase();for(var p in n)if(p.toLowerCase()===b){n=n[p];
break a}n=null}return n}return(p=b.get(k))?n[p.name]:null};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/support/FeatureVisibilityFilter":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Logger ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ../../../../core/support/UpdatingHandles ../../../../layers/support/FeatureFilter ../../../../layers/support/floorFilterUtils ../graphics/QueryEngine ../../../support/Scheduler".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w,x,u,t){a.FeatureVisibilityFilter=class extends n{constructor(m){super(m);this._queryEngine=this._frameTask=null;this._updateRequested=!0;this._updatingHandles=new l.UpdatingHandles;this._abortController=new AbortController}initialize(){const m=t.TaskPriority.FILTER_VISIBILITY,{layer:q,view:r}=this._configuration,{featureStore:v}=this.context;this._queryEngine=new u.QueryEngine({context:{spatialReference:r.spatialReference,layer:q,scheduler:r.resourceController.scheduler,
featureStore:v,hasM:this._configuration.hasM??!1,hasZ:this._configuration.hasZ??!1},priority:m});this._frameTask=r.resourceController.scheduler.registerTask(m);this._updatingHandles.add(()=>[this._compositedFeatureFilter,this._sceneFilter],()=>this._updateRequested=!0,e.initial);this._updatingHandles.addWhen(()=>!this._frameTask.updating&&this._updateRequested,()=>{this._frameTask.schedule(()=>this._updateVisibility(),this._abortController.signal);this._updateRequested=!1},e.initial)}destroy(){this._abortController.abort();
this._updatingHandles.destroy();this.clear();this._frameTask=p.removeMaybe(this._frameTask);this._queryEngine=p.destroyMaybe(this._queryEngine);this._set("context",null)}get updating(){return this._updateRequested||this._updatingHandles.updating||this._frameTask.updating}get defaultVisibility(){return null==this._compositedFeatureFilter&&null==this._sceneFilter}get _featureFilter(){return"filter"in this._configuration?this._configuration.filter:null}get _sceneFilter(){return"layerFilter"in this._configuration?
this._configuration.layerFilter:null}get _floorFilter(){return x.getFloorFilterClause(this._configuration)}get _timeExtent(){return"timeExtent"in this._configuration?this._configuration.timeExtent:null}get _compositedFeatureFilter(){const {_featureFilter:m,_timeExtent:q,_floorFilter:r}=this;if(null==q&&null==r)return m;const v=m?.clone()??new w;null!=q&&(v.timeExtent=v.timeExtent?.intersection(q)??q);null!=r&&(v.where=null==v.where||""===v.where?r:`(${v.where}) AND (${r})`);return v}get _configuration(){return this.context.configuration}reapply(){this._updateRequested=
!0}clear(){this._queryEngine.clear();this.context.clearFeaturesVisibility()}async _updateVisibility(){const m=this._compositedFeatureFilter,q=this._sceneFilter,{signal:r}=this._abortController,v=this._frameTask,{context:y}=this;h.throwIfAborted(r);if(null==m&&null==q||0===y.getFeatureCount())return await v.schedule(()=>this.clear(),r);try{const B=await this._queryEngine.executeQueryForIdSet(m,q,r);h.throwIfAborted(r);return await v.schedule(()=>{y.updateFeatureVisibilities(z=>B.has(z))},r)}catch(B){return h.throwIfAbortError(B),
k.getLogger(this).warn(`FeatureFilter query failed: ${B}`,{error:B}),await v.schedule(()=>{y.setAllFeaturesVisibility(!0)},r)}}};b.__decorate([g.property({constructOnly:!0})],a.FeatureVisibilityFilter.prototype,"context",void 0);b.__decorate([g.property()],a.FeatureVisibilityFilter.prototype,"updating",null);b.__decorate([g.property()],a.FeatureVisibilityFilter.prototype,"defaultVisibility",null);b.__decorate([g.property()],a.FeatureVisibilityFilter.prototype,"_featureFilter",null);b.__decorate([g.property()],
a.FeatureVisibilityFilter.prototype,"_sceneFilter",null);b.__decorate([g.property()],a.FeatureVisibilityFilter.prototype,"_floorFilter",null);b.__decorate([g.property()],a.FeatureVisibilityFilter.prototype,"_timeExtent",null);b.__decorate([g.property()],a.FeatureVisibilityFilter.prototype,"_compositedFeatureFilter",null);b.__decorate([g.property()],a.FeatureVisibilityFilter.prototype,"_configuration",null);b.__decorate([g.property()],a.FeatureVisibilityFilter.prototype,"_updateRequested",void 0);
a.FeatureVisibilityFilter=b.__decorate([c.subclass("esri.views.3d.layers.support.FeatureVisibilityFilter")],a.FeatureVisibilityFilter);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/floorFilterUtils":function(){define(["exports"],function(a){function b(n,k){if(!n?.length)return null;n=n.filter(p=>""!==p).map(p=>`'${p}'`);n.push("''");return`${k} IN (${n.join(",")}) OR ${k} IS NULL`}a.getFloorFilterClause=function(n){const k=n.layer;return"floorInfo"in k&&k.floorInfo?.floorField&&
"floors"in n.view?b(n.view.floors,k.floorInfo.floorField):null};a.getLayerFloorFilterClause=function(n,k){return"floorInfo"in k&&k.floorInfo?.floorField?b(n,k.floorInfo.floorField):null};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/QueryEngine":function(){define("exports ../../../../chunks/tslib.es6 ../../../../geometry ../../../../core/Accessor ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/Logger ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ../../../../geometry/Extent ../../../../layers/graphics/data/QueryEngine ../../../../layers/support/FieldsIndex ../../../../rest/support/FeatureSet ../../../../rest/support/Query ../../../../geometry/support/typeUtils".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w,x,u){const t=c.QueryEngine;a.QueryEngine=class extends k{get layer(){return this.context.layer}get spatialReference(){return this.context.spatialReference}get _queryGeometryType(){switch(this.layer.geometryType){case "multipoint":case "point":case "polygon":case "polyline":return this.layer.geometryType;case "mesh":return"polygon"}}get defaultQueryJSON(){return(new x({outSpatialReference:this.spatialReference})).toJSON()}get _dataQueryEngine(){return this._ensureDataQueryEngine()}constructor(m){super(m);
this._dataQueryEngineInstance=null}destroy(){this.clear()}clear(){return this._dataQueryEngineInstance?(this._dataQueryEngineInstance.destroy(),this._dataQueryEngineInstance=null,!0):!1}async executeQueryForIdSet(m,q,r){return this._dataQueryEngine.executeQueryForIdSet(this._ensureQueryJSON(m,q),r)}async executeQueryForCount(m,q){return this._dataQueryEngine.executeQueryForCount(this._ensureQueryJSON(m),q)}async executeQueryForExtent(m,q){const {count:r,extent:v}=await this._dataQueryEngine.executeQueryForExtent(this._ensureQueryJSON(m),
q);m=f.fromJSON(v);return{count:r,extent:m}}async executeQueryForIds(m,q){return this._dataQueryEngine.executeQueryForIds(this._ensureQueryJSON(m),q)}async executeQueryForLatestObservations(m,q){m=await this._dataQueryEngine.executeQueryForLatestObservations(this._ensureQueryJSON(m),q);m=w.fromJSON(m);m.features.forEach(r=>{r.layer=this.layer;r.sourceLayer=this.layer});return m}async executeQuery(m,q){m=await this._dataQueryEngine.executeQuery(this._ensureQueryJSON(m),q);m=w.fromJSON(m);m.features.forEach(r=>
{r.layer=this.layer;r.sourceLayer=this.layer});return m}_ensureQueryJSON(m,q){let r=this.defaultQueryJSON;null!=m&&("outSpatialReference"in m&&!m.outSpatialReference&&(m.outSpatialReference=this.spatialReference),r=m.toJSON());null!=q&&(m=q.geometries.map(v=>v.toJSON()).reduce((v,y)=>{v.rings=v.rings.concat(y.rings);return v}),r={...r,sceneFilter:{...q,geometry:m}});return r}_ensureDataQueryEngine(){if(this._dataQueryEngineInstance)return this._dataQueryEngineInstance;const m="timeInfo"in this.layer&&
this.layer.timeInfo?.toJSON()||null,q=this.layer.objectIdField,r=u.featureGeometryTypeKebabDictionary.toJSON(this._queryGeometryType),v=this.layer.fieldsIndex?.toJSON()||new l([]),y=this.priority,B=this.spatialReference.toJSON(),{hasZ:z,hasM:A,featureStore:C,scheduler:H}=this.context;return this._dataQueryEngineInstance=new t({hasZ:z,hasM:A,geometryType:r,fieldsIndex:v,timeInfo:m,spatialReference:B,objectIdField:q,featureStore:C,scheduler:H,priority:y})}};b.__decorate([p.property({constructOnly:!0})],
a.QueryEngine.prototype,"context",void 0);b.__decorate([p.property({constructOnly:!0})],a.QueryEngine.prototype,"priority",void 0);b.__decorate([p.property()],a.QueryEngine.prototype,"layer",null);b.__decorate([p.property()],a.QueryEngine.prototype,"spatialReference",null);b.__decorate([p.property()],a.QueryEngine.prototype,"_queryGeometryType",null);b.__decorate([p.property()],a.QueryEngine.prototype,"defaultQueryJSON",null);a.QueryEngine=b.__decorate([d.subclass("esri.views.3d.layers.graphics.QueryEngine")],
a.QueryEngine);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/QueryEngine":function(){define("exports ../../../core/arrayUtils ../../../core/Error ../../../core/JSONSupport ../../../core/lang ../../../core/maybe ../../../core/promiseUtils ../../../core/unitUtils ../../../geometry/projection ../../../geometry/support/aaBoundingBox ../../../geometry/support/aaBoundingRect ../../../geometry/support/boundsUtils ../../../geometry/support/jsonUtils ../../../geometry/support/normalizeUtils ../../../geometry/support/spatialReferenceUtils ../featureConversionUtils ./attributeSupport ./geometryUtils ./projectionSupport ./QueryEngineCache ./QueryEngineCapabilities ./QueryEngineResult ./queryUtils ./queryValidationUtils ./spatialQuerySupport ./timeSupport ../../support/FieldsIndex ../../../views/support/Scheduler".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w,x,u,t,m,q,r,v,y,B,z,A,C,H,E,F){function G(J){if(C.canQueryWithRBush(J)){if(w.isExtent(J))return[c.fromValues(Math.min(J.xmin,J.xmax),Math.min(J.ymin,J.ymax),Math.max(J.xmin,J.xmax),Math.max(J.ymin,J.ymax))];if(w.isPolygon(J))return J.rings.map(N=>c.fromValues(Math.min(N[0][0],N[2][0]),Math.min(N[0][1],N[2][1]),Math.max(N[0][0],N[2][0]),Math.max(N[0][1],N[2][1])))}return[l.getBoundsXY(c.create(),J)]}class D{constructor(J,N=null,M,Q,O){this.attributes=J;this.geometry=
M;this.centroid=Q;this.filterFlags=O;this.groupId=-1;this.displayId=N}}class I{constructor(J){this._cache=new v.QueryEngineCache;this._changeHandle=null;this.capabilities={query:y.queryCapabilities};this.geometryType=J.geometryType;this.hasM=!!J.hasM;this.hasZ=!!J.hasZ;this.objectIdField=J.objectIdField;this.spatialReference=J.spatialReference;this.definitionExpression=J.definitionExpression;this.featureStore=J.featureStore;this.aggregateAdapter=J.aggregateAdapter;this._changeHandle=this.featureStore.events.on("changed",
()=>this.clearCache());this.timeInfo=J.timeInfo;this.fieldsIndex=k.isSerializable(J.fieldsIndex)?J.fieldsIndex:E.fromJSON(J.fieldsIndex);this.availableFields=!J.availableFields||1===J.availableFields.length&&"*"===J.availableFields[0]?new Set(this.fieldsIndex.fields.map(N=>N.name)):new Set(J.availableFields.map(N=>this.fieldsIndex.get(N)?.name).filter(N=>null!=N));J.scheduler&&J.priority&&(this._frameTask=J.scheduler.registerTask(J.priority))}destroy(){this._frameTask=h.removeMaybe(this._frameTask);
this.clearCache();h.destroyMaybe(this._cache);this._changeHandle=h.removeMaybe(this._changeHandle)}get featureAdapter(){return this.featureStore.featureAdapter}clearCache(){this._cache.clear();this._fullExtentPromise=this._timeExtentPromise=this._allFeaturesPromise=null}async executeQuery(J,N){N=e.signalFromSignalOrOptions(N);try{return await (await this._executeQuery(J,{},N)).createQueryResponse()}catch(M){if(M!==z.queryEngineEmptyResult)throw M;return(new B.QueryEngineResult([],J,this)).createQueryResponse()}}async executeQueryForCount(J=
{},N){N=e.signalFromSignalOrOptions(N);try{return(await this._executeQuery(J,{returnGeometry:!1,returnCentroid:!1,outSR:null},N)).createQueryResponseForCount()}catch(M){if(M!==z.queryEngineEmptyResult)throw M;return 0}}async executeQueryForExtent(J,N){N=e.signalFromSignalOrOptions(N);const M=J.outSR;try{const Q=await this._executeQuery(J,{returnGeometry:!0,returnCentroid:!1,outSR:null},N),O=Q.size;if(!O)return{count:0,extent:null};const K=await this._getBounds(Q.items,Q.spatialReference,M||this.spatialReference);
return{count:O,extent:K}}catch(Q){if(Q===z.queryEngineEmptyResult)return{count:0,extent:null};throw Q;}}async executeQueryForIds(J,N){return this.executeQueryForIdSet(J,N).then(M=>Array.from(M))}async executeQueryForIdSet(J,N){N=e.signalFromSignalOrOptions(N);try{const M=await this._executeQuery(J,{returnGeometry:!0,returnCentroid:!1,outSR:null},N),Q=M.items,O=new Set;await this._reschedule(()=>{for(const K of Q)O.add(M.featureAdapter.getObjectId(K))},N);return O}catch(M){if(M===z.queryEngineEmptyResult)return new Set;
throw M;}}async executeQueryForSnapping(J,N){const M=e.signalFromSignalOrOptions(N),{point:Q,distance:O,returnEdge:K,vertexMode:L}=J;if(!K&&"none"===L)return{candidates:[]};let P=p.clone(J.query);P=await this._schedule(()=>z.normalizeQueryLike(P,this.definitionExpression,this.spatialReference),M);P=await this._reschedule(()=>A.validateQuery(P,{availableFields:this.availableFields,fieldsIndex:this.fieldsIndex,geometryType:this.geometryType,spatialReference:this.spatialReference}),M);(N=!u.equals(Q.spatialReference,
this.spatialReference))&&await r.checkProjectionSupport(Q.spatialReference,this.spatialReference);var R="number"===typeof O?O:O.x,W="number"===typeof O?O:O.y;R={xmin:Q.x-R,xmax:Q.x+R,ymin:Q.y-W,ymax:Q.y+W,spatialReference:Q.spatialReference};R=N?r.project(R,this.spatialReference):R;if(!R)return{candidates:[]};W=(await x.normalizeCentralMeridian(w.fromJSON(Q),null,{signal:M}))[0];const V=(await x.normalizeCentralMeridian(w.fromJSON(R),null,{signal:M}))[0];if(null==W||null==V)return{candidates:[]};
const ba=new B.QueryEngineResult(await this._reschedule(()=>this._searchFeatures(G(V.toJSON())),M),P,this);await this._reschedule(()=>this._executeObjectIdsQuery(ba),M);await this._reschedule(()=>this._executeTimeQuery(ba),M);await this._reschedule(()=>this._executeAttributesQuery(ba),M);await this._reschedule(()=>this._executeGeometryQueryForSnapping(ba,M),M);W=W.toJSON();W=N?r.project(W,this.spatialReference):W;return ba.createSnappingResponse({...J,point:W,distance:N?Math.max(R.xmax-R.xmin,R.ymax-
R.ymin)/2:O},Q.spatialReference)}async executeQueryForLatestObservations(J,N){N=e.signalFromSignalOrOptions(N);if(!this.timeInfo?.trackIdField)throw new n("unsupported-query","Missing timeInfo or timeInfo.trackIdField",{query:J,timeInfo:this.timeInfo});try{const M=await this._executeQuery(J,{},N);await this._reschedule(()=>this._filterLatest(M),N);return await M.createQueryResponse()}catch(M){if(M!==z.queryEngineEmptyResult)throw M;return(new B.QueryEngineResult([],J,this)).createQueryResponse()}}async executeQueryForSummaryStatistics(J=
{},N,M){M=e.signalFromSignalOrOptions(M);const {field:Q,normalizationField:O,valueExpression:K}=N;return(await this._executeQueryForStatistics(J,{field:Q,normalizationField:O,valueExpression:K},M)).createSummaryStatisticsResponse(N)}async executeQueryForUniqueValues(J={},N,M){M=e.signalFromSignalOrOptions(M);const {field:Q,field2:O,field3:K,valueExpression:L}=N;return(await this._executeQueryForStatistics(J,{field:Q,field2:O,field3:K,valueExpression:L},M)).createUniqueValuesResponse(N)}async executeQueryForClassBreaks(J=
{},N,M){M=e.signalFromSignalOrOptions(M);const {field:Q,normalizationField:O,valueExpression:K}=N;return(await this._executeQueryForStatistics(J,{field:Q,normalizationField:O,valueExpression:K},M)).createClassBreaksResponse(N)}async executeQueryForHistogram(J={},N,M){M=e.signalFromSignalOrOptions(M);const {field:Q,normalizationField:O,valueExpression:K}=N;return(await this._executeQueryForStatistics(J,{field:Q,normalizationField:O,valueExpression:K},M)).createHistogramResponse(N)}async fetchRecomputedExtents(J){J=
e.signalFromSignalOrOptions(J);this._timeExtentPromise||(this._timeExtentPromise=H.getTimeExtent(this.timeInfo,this.featureStore));const [N,M]=await Promise.all([this._getFullExtent(),this._timeExtentPromise]);e.throwIfAborted(J);return{fullExtent:N,timeExtent:M}}async _getBounds(J,N,M){const Q=f.set(f.create(),f.negativeInfinity);await this.featureStore.forEachBounds(J,O=>f.expandWithAABB(Q,O));J={xmin:Q[0],ymin:Q[1],xmax:Q[3],ymax:Q[4],spatialReference:q.cleanFromGeometryEngine(this.spatialReference)};
this.hasZ&&isFinite(Q[2])&&isFinite(Q[5])&&(J.zmin=Q[2],J.zmax=Q[5],J.hasZ=!0);N=r.project(J,N,M);N.spatialReference=q.cleanFromGeometryEngine(M);0===N.xmax-N.xmin&&(M=g.getMetersPerUnitForSR(N.spatialReference),N.xmin-=M,N.xmax+=M);0===N.ymax-N.ymin&&(M=g.getMetersPerUnitForSR(N.spatialReference),N.ymin-=M,N.ymax+=M);this.hasZ&&null!=N.zmin&&null!=N.zmax&&0===N.zmax-N.zmin&&(M=g.getMetersPerUnitForSR(N.spatialReference),N.zmin-=M,N.zmax+=M);return N}_getFullExtent(){this._fullExtentPromise||(this._fullExtentPromise=
"getFullExtent"in this.featureStore&&this.featureStore.getFullExtent?Promise.resolve(this.featureStore.getFullExtent(this.spatialReference)):this._getAllFeatures().then(J=>this._getBounds(J,this.spatialReference,this.spatialReference)));return this._fullExtentPromise}async _schedule(J,N){return null!=this._frameTask?this._frameTask.schedule(J,N):J(F.noBudget)}async _reschedule(J,N){return null!=this._frameTask?this._frameTask.reschedule(J,N):J(F.noBudget)}async _getAllFeaturesQueryEngineResult(J){return new B.QueryEngineResult(await this._getAllFeatures(),
J,this)}async _getAllFeatures(){if(null==this._allFeaturesPromise){const M=[];this._allFeaturesPromise=(async()=>{await this.featureStore.forEach(Q=>M.push(Q))})().then(()=>M)}const J=this._allFeaturesPromise,N=await J;return J===this._allFeaturesPromise?N.slice():this._getAllFeatures()}async _executeQuery(J,N,M){J=p.clone(J);J=await this._schedule(()=>z.normalizeQuery(J,this.definitionExpression,this.spatialReference),M);J=await this._reschedule(()=>A.validateQuery(J,{availableFields:this.availableFields,
fieldsIndex:this.fieldsIndex,geometryType:this.geometryType,spatialReference:this.spatialReference}),M);J={...J,...N};const Q=await this._reschedule(()=>this._executeSceneFilterQuery(J,M),M),O=await this._reschedule(()=>this._executeGeometryQuery(J,Q,M),M);await this._reschedule(()=>this._executeAggregateIdsQuery(O),M);await this._reschedule(()=>this._executeObjectIdsQuery(O),M);await this._reschedule(()=>this._executeTimeQuery(O),M);await this._reschedule(()=>this._executeAttributesQuery(O),M);return O}async _executeSceneFilterQuery(J,
N){if(null==J.sceneFilter)return null;const {outSR:M,returnGeometry:Q,returnCentroid:O}=J;var K=this.featureStore.featureSpatialReference,L=J.sceneFilter.geometry;const P=null==K||u.equals(K,L.spatialReference)?L:r.project(L,K);if(!P)return null;K=Q||O;K=u.isValid(M)&&!u.equals(this.spatialReference,M)&&K?async ba=>this._project(ba,M):ba=>ba;const R=this.featureAdapter;L=await this._reschedule(()=>this._searchFeatures(G(P)),N);if("disjoint"===J.sceneFilter.spatialRelationship){if(!L.length)return null;
const ba=new Set;for(var W of L)ba.add(R.getObjectId(W));const U=await this._reschedule(()=>this._getAllFeatures(),N);W=await this._reschedule(async()=>{const da=await C.getSpatialQueryOperator("esriSpatialRelDisjoint",P,this.geometryType,this.hasZ,this.hasM),fa=await this._runSpatialFilter(U,ha=>!ba.has(R.getObjectId(ha))||da(R.getGeometry(ha)),N);return new B.QueryEngineResult(fa,J,this)},N);return K(W)}if(!L.length)return new B.QueryEngineResult([],J,this);if(this._canExecuteSinglePass(P,J))return K(new B.QueryEngineResult(L,
J,this));const V=await C.getSpatialQueryOperator("esriSpatialRelContains",P,this.geometryType,this.hasZ,this.hasM);W=await this._runSpatialFilter(L,ba=>V(R.getGeometry(ba)),N);return K(new B.QueryEngineResult(W,J,this))}async _executeGeometryQuery(J,N,M){if(null!=N&&0===N.items.length)return N;J=null!=N?N.query:J;const {geometry:Q,outSR:O,spatialRel:K,returnGeometry:L,returnCentroid:P}=J;var R=this.featureStore.featureSpatialReference;const W=!Q||null==R||u.equals(R,Q.spatialReference)?Q:r.project(Q,
R),V=L||P,ba=u.isValid(O)&&!u.equals(this.spatialReference,O),U=null==N?this._getCacheKey(J):null;R=U?this._cache.get(U):null;if(null!=R)return new B.QueryEngineResult(R,J,this);R=async S=>{ba&&V&&await this._project(S,O);U&&this._cache.put(U,S.items);return S};if(!W)return R(null!=N?N:await this._getAllFeaturesQueryEngineResult(J));const da=this.featureAdapter;let fa=await this._reschedule(()=>this._searchFeatures(G(Q)),M);if("esriSpatialRelDisjoint"===K){if(!fa.length)return R(null!=N?N:await this._getAllFeaturesQueryEngineResult(J));
const S=new Set;for(var ha of fa)S.add(da.getObjectId(ha));const Z=null!=N?N.items:await this._reschedule(()=>this._getAllFeatures(),M);ha=await this._reschedule(async()=>{const ia=await C.getSpatialQueryOperator(K,W,this.geometryType,this.hasZ,this.hasM),Y=await this._runSpatialFilter(Z,ea=>!S.has(da.getObjectId(ea))||ia(da.getGeometry(ea)),M);return new B.QueryEngineResult(Y,J,this)},M);return R(ha)}if(null!=N){const S=new b.PositionHint;fa=fa.filter(Z=>0<=b.indexOf(N.items,Z,N.items.length,S))}if(!fa.length)return R=
new B.QueryEngineResult([],J,this),U&&this._cache.put(U,R.items),R;if(this._canExecuteSinglePass(W,J))return R(new B.QueryEngineResult(fa,J,this));const T=await C.getSpatialQueryOperator(K,W,this.geometryType,this.hasZ,this.hasM);ha=await this._runSpatialFilter(fa,S=>T(da.getGeometry(S)),M);return R(new B.QueryEngineResult(ha,J,this))}async _executeGeometryQueryForSnapping(J,N){const {query:M}=J,{spatialRel:Q}=M;if(J?.items?.length&&M.geometry&&Q){var O=await C.getSpatialQueryOperator(Q,M.geometry,
this.geometryType,this.hasZ,this.hasM);N=await this._runSpatialFilter(J.items,K=>O(K.geometry),N);J.items=N}}_executeAggregateIdsQuery(J){if(0!==J.items.length&&J.query.aggregateIds?.length&&null!=this.aggregateAdapter){var N=new Set;for(const Q of J.query.aggregateIds)this.aggregateAdapter.getFeatureObjectIds(Q).forEach(O=>N.add(O));var M=this.featureAdapter.getObjectId;J.items=J.items.filter(Q=>N.has(M(Q)))}}_executeObjectIdsQuery(J){if(0!==J.items.length&&J.query.objectIds?.length){var N=new Set(J.query.objectIds),
M=this.featureAdapter.getObjectId;J.items=J.items.filter(Q=>N.has(M(Q)))}}_executeTimeQuery(J){if(0!==J.items.length){var N=H.getTimeOperator(this.timeInfo,J.query.timeExtent,this.featureAdapter);null!=N&&(J.items=J.items.filter(N))}}_executeAttributesQuery(J){if(0!==J.items.length){var N=m.getWhereClause(J.query.where,this.fieldsIndex);if(N){if(!N.isStandardized)throw new TypeError("Where clause is not standardized");J.items=J.items.filter(M=>N.testFeature(M,this.featureAdapter))}}}async _runSpatialFilter(J,
N,M){if(!N)return J;if(null==this._frameTask)return J.filter(L=>N(L));let Q=0;const O=[],K=async L=>{for(;Q<J.length;){const P=J[Q++];N(P)&&(O.push(P),L.madeProgress());L.done&&await this._reschedule(R=>K(R),M)}};return this._reschedule(L=>K(L),M).then(()=>O)}_filterLatest(J){const {trackIdField:N,startTimeField:M,endTimeField:Q}=this.timeInfo,O=Q||M,K=new Map,L=this.featureAdapter.getAttribute;for(const P of J.items){const R=L(P,N),W=L(P,O),V=K.get(R);(!V||W>L(V,O))&&K.set(R,P)}J.items=Array.from(K.values())}_getCacheKey(J){const {geometry:N,
spatialRel:M,returnGeometry:Q,returnCentroid:O,outSR:K,resultType:L,cacheHint:P}=J;if("tile"!==L&&!P)return null;J=Q||O;return u.isValid(K)&&!u.equals(this.spatialReference,K)&&J?JSON.stringify([N,M,K]):JSON.stringify([N,M])}_canExecuteSinglePass(J,N){({spatialRel:N}=N);return C.canQueryWithRBush(J)&&("esriSpatialRelEnvelopeIntersects"===N||"esriGeometryPoint"===this.geometryType&&("esriSpatialRelIntersects"===N||"esriSpatialRelContains"===N))}async _project(J,N){if(!N||u.equals(this.spatialReference,
N))return J;const M=this.featureAdapter;let Q=void 0;try{const O=await this._getFullExtent();Q=d.getTransformation(this.spatialReference,N,O)}catch{}N=await r.projectMany(J.items.map(O=>q.getGeometry(this.geometryType,this.hasZ,this.hasM,M.getGeometry(O))),this.spatialReference,N,Q);J.items=N.map((O,K)=>M.cloneWithGeometry(J.items[K],t.convertFromGeometry(O,this.hasZ,this.hasM)));return J}async _searchFeatures(J){const N=new Set;await Promise.all(J.map(M=>this.featureStore.forEachInBounds(M,Q=>N.add(Q))));
J=Array.from(N.values());N.clear();return J}async _executeQueryForStatistics(J,N,M){J=p.clone(J);try{J=await this._schedule(()=>z.normalizeQuery(J,this.definitionExpression,this.spatialReference),M);J=await this._reschedule(()=>A.validateStatisticsQuery(J,N,{availableFields:this.availableFields,fieldsIndex:this.fieldsIndex,geometryType:this.geometryType,spatialReference:this.spatialReference}),M);const Q=await this._reschedule(()=>this._executeSceneFilterQuery(J,M),M),O=await this._reschedule(()=>
this._executeGeometryQuery(J,Q,M),M);await this._reschedule(()=>this._executeAggregateIdsQuery(O),M);await this._reschedule(()=>this._executeObjectIdsQuery(O),M);await this._reschedule(()=>this._executeTimeQuery(O),M);await this._reschedule(()=>this._executeAttributesQuery(O),M);return O}catch(Q){if(Q!==z.queryEngineEmptyResult)throw Q;return new B.QueryEngineResult([],J,this)}}}a.Feature=D;a.QueryEngine=I;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/attributeSupport":function(){define(["exports",
"../../../core/Error","../../../core/sql/WhereClauseCache","../../support/fieldType"],function(a,b,n,k){function p(x,u,t={}){const m=h(u,x);if(!m)throw t=c.getError(u,x),new b("unsupported-query","invalid SQL expression",{expression:u,error:t});x=t.expressionName||"expression";if(t.validateStandardized&&!m.isStandardized)throw new b("unsupported-query",`${x} is not standard`,{expression:u});if(t.validateAggregate&&!m.isAggregate)throw new b("unsupported-query",`${x} does not contain a valid aggregate function`,
{expression:u});return m.fieldNames}function h(x,u){return x?c.get(x,u):null}function e(x){return/\((.*?)\)/.test(x)?x:x.split(" as ")[0]}function g(x,u,t,m={}){const q=new Map;d(q,x,u,m.allowedFieldTypes??w,t);if(q.size)throw new b("unsupported-query",`${m.expressionName??"expression"} contains invalid or missing fields`,{errors:Array.from(q.values()),query:m.query});}function d(x,u,t,m,q){q=q.includes("*")?[...t,...q.filter(r=>"*"!==r)]:q;for(const r of q)if(u.get(r))f(x,u,t,m,r);else try{const v=
e(r),y=p(u,v,{validateStandardized:!0});for(const B of y)f(x,u,t,m,B)}catch(v){x.set(r,{type:"expression-error",expression:r,error:v})}}function f(x,u,t,m,q){(u=u.get(q))?t.has(u.name)?"all"!==m&&!1===m?.has(u.type)&&x.set(q,{type:"invalid-type",fieldName:u.name,fieldType:k.kebabDict.fromJSON(u.type),allowedFieldTypes:Array.from(m,r=>k.kebabDict.fromJSON(r))}):x.set(q,{type:"missing-field",fieldName:u.name}):x.set(q,{type:"invalid-field",fieldName:q})}const c=new n.WhereClauseCache(50,500);n=new Set("esriFieldTypeOID esriFieldTypeSmallInteger esriFieldTypeBigInteger esriFieldTypeInteger esriFieldTypeSingle esriFieldTypeDouble esriFieldTypeLong".split(" "));
const l=new Set(["esriFieldTypeDate","esriFieldTypeDateOnly","esriFieldTypeTimeOnly","esriFieldTypeTimestampOffset"]),w=new Set(["esriFieldTypeString","esriFieldTypeGUID","esriFieldTypeGlobalID",...n,...l]);a.allDateAndTimeFieldTypes=l;a.getAliasFromFieldName=function(x){return x.split(" as ")[1]};a.getExpressionFromFieldName=e;a.getWhereClause=h;a.numericFieldTypes=n;a.validateFields=g;a.validateHaving=function(x,u,t,m,q){if(!t)return!0;const r=p(x,t,{validateAggregate:!0,expressionName:"having clause"});
g(x,u,r,{expressionName:"having clause",query:q});if(!h(t,x)?.getExpressions().every(v=>{const {aggregateType:y,field:B}=v,z=x.get(B)?.name;return m.some(A=>{const {onStatisticField:C,statisticType:H}=A;return x.get(C)?.name===z&&H.toLowerCase().trim()===y})}))throw new b("unsupported-query","expressions in having clause should also exist in outStatistics",{having:t});return!0};a.validateWhere=function(x,u,t,m){if(!t)return!0;t=p(x,t,{validateStandardized:!0,expressionName:"where clause"});g(x,u,
t,{expressionName:"where clause",query:m});return!0};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/sql/WhereClauseCache":function(){define(["exports","../LRUCache","./WhereClause"],function(a,b,n){class k{constructor(p,h){this._cache=new b.LRUCache(p);this._invalidCache=new b.LRUCache(h)}get(p,h){const e=`${h.uid}:${p}`,g=this._cache.get(e);if(g)return g;if(null!=this._invalidCache.get(e))return null;try{const d=n.WhereClause.create(p,{fieldsIndex:h});this._cache.put(e,
d);return d}catch(d){return this._invalidCache.put(e,d),null}}getError(p,h){return this._invalidCache.get(`${h.uid}:${p}`)??null}}a.WhereClauseCache=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/sql/WhereClause":function(){define("exports ../../arcade/ArcadeDate ../has ./AggregateFunctions ./DateOnly ./errorSupport ./sqlArithmeticUtils ./sqlCompareUtils ./sqlDateParsingUtils ./SqlInterval ./SqlTimestampOffset ./StandardizedFunctions ./TimeOnly ./WhereGrammar ../../chunks/datetime".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w,x,u){function t(F){return Array.isArray(F)?F:[F]}function m(F){return null!==F?!0!==F:null}function q(F,G){return null!=F&&null!=G?!0===F&&!0===G:!1===F||!1===G?!1:null}function r(F,G){return null!=F&&null!=G?!0===F||!0===G:!0===F||!0===G?!0:null}function v(F,G,D){if(null==F)return null;D=!1;for(const I of G)if(null==I)D=null;else if(F===I){D=!0;break}else if(g.isDateOrTimeValue(F)&&g.isDateOrTimeValue(I)&&(D=g.sqlCompare(F,I,"\x3d")))break;return D}function y(F,
G,D){if(null==F)return null;let I="",J=H.Normal;for(let N=0;N<G.length;N++){const M=G.charAt(N);switch(J){case H.Normal:M===D?J=H.Escaped:I="-[]/{}()*+?.\\^$|".includes(M)?I+("\\"+M):"%"===M?I+".*":"_"===M?I+".":I+M;break;case H.Escaped:I="-[]/{}()*+?.\\^$|".includes(M)?I+("\\"+M):I+M,J=H.Normal}}return(new RegExp("^"+I+"$","m")).test(F)}function B(F,G,D,I){F=I.getAttribute(F,G);G=D?.get(G);return null==F||"esriFieldTypeDate"!==G?.type&&"date"!==G?.type?null==F||"esriFieldTypeDateOnly"!==G?.type&&
"date-only"!==G?.type?null==F||"esriFieldTypeTimeOnly"!==G?.type&&"time-only"!==G?.type?null==F||"esriFieldTypeTimestampOffset"!==G?.type&&"timestamp-offset"!==G?.type?F:new c.SqlTimeStampOffset(F):w.TimeOnly.fromReader(F):p.DateOnly.fromReader(F):d.convertToExecutingTimeZone(new Date(F),D?.getLuxonTimeZone(G.name)??u.FixedOffsetZone.utcInstance)}const z=new Set(["current_timestamp","current_date","current_time"]);class A{static makeBool(F){return!0===F}static featureValue(F,G,D,I){return B(F,G,D,
I)}static equalsNull(F){return null===F}static applyLike(F,G,D){return y(F,G,D)}static ensureArray(F){return t(F)}static applyIn(F,G,D){return v(F,G)}static currentTimestamp(F){return d.convertToExecutingTimeZone(new Date,F)}static currentDate(F){return p.DateOnly.fromNow(F)}static currentTime(F){F=d.convertToExecutingTimeZone(new Date,F);return w.TimeOnly.fromDateTime(F)}static makeSqlInterval(F,G,D){return f.SqlInterval.createFromValueAndQualifier(F,G,D)}static convertInterval(F){return F instanceof
f.SqlInterval?F.valueInMilliseconds():F}static compare(F,G,D,I){return g.sqlCompare(G,D,F)}static calculate(F,G,D,I){return e.sqlCalculateFunction(F,G,D,I)}static evaluateTime(F){return d.parseTime(F)}static evaluateTimestamp(F,G,D){return d.parseTimestamp(F,G,D)}static evaluateDate(F,G){return d.parseDate(F,G)}static evaluateFunction(F,G,D){return l.evaluateFunction(F,G,D)}static lookup(F,G){F=G[F];return void 0===F?null:F}static between(F,G,D){return null==F||null==G[0]||null==G[1]?null:g.sqlCompare(F,
G[0],"\x3e\x3d")&&g.sqlCompare(F,G[1],"\x3c\x3d")}static notbetween(F,G,D){return null==F||null==G[0]||null==G[1]?null:g.sqlCompare(F,G[0],"\x3c")||g.sqlCompare(F,G[1],"\x3e")}static ternaryNot(F){return m(F)}static ternaryAnd(F,G){return q(F,G)}static ternaryOr(F,G){return r(F,G)}}class C{constructor(F,G,D="UTC",I=null){this.fieldsIndex=G;this.timeZone=D;this.currentUser=I;this.parameters={};this._hasDateFunctions=void 0;this.parseTree=x.WhereGrammar.parse(F);const {isStandardized:J,isAggregate:N,
currentUserRequired:M,referencedFieldNames:Q}=this._extractExpressionInfo(G);this._referencedFieldNames=Q;this.isStandardized=J;this.isAggregate=N;this.currentUserRequired=M}static convertValueToStorageFormat(F,G=null){if(null===G)return d.isDate(F)?F.getTime():d.isDateTime(F)?F.toMillis():d.isTimestampOffset(F)?F.toStorageFormat():d.isTimeOnly(F)?F.toStorageString():d.isDateOnly(F)?F.toStorageFormat():F;switch(G){case "date":if(d.isDate(F))return F.getTime();if(d.isDateTime(F))return F.toMillis();
if(d.isTimestampOffset(F))return F.toMilliseconds();if(d.isDateOnly(F))return F.toNumber();break;case "date-only":if(d.isDate(F))return p.DateOnly.fromDateJS(F).toString();if(d.isTimestampOffset(F))return p.DateOnly.fromSqlTimeStampOffset(F).toString();if(d.isDateTime(F))return p.DateOnly.fromDateTime(F).toString();break;case "time-only":if(d.isDate(F))return w.TimeOnly.fromDateJS(F).toStorageString();if(d.isDateTime(F))return w.TimeOnly.fromDateTime(F).toStorageString();if(d.isTimestampOffset(F))return w.TimeOnly.fromSqlTimeStampOffset(F).toStorageString();
if(d.isTimeOnly(F))return F.toStorageString();break;case "timestamp-offset":if(d.isDate(F))return c.SqlTimeStampOffset.fromJSDate(F).toStorageFormat();if(d.isDateTime(F))return c.SqlTimeStampOffset.fromDateTime(F).toStorageFormat();if(d.isTimestampOffset(F))return F.toStorageFormat()}return F}static create(F,G={}){return new C(F,G.fieldsIndex,G.timeZone??void 0,G.currentUser)}get fieldNames(){return this._referencedFieldNames}testSet(F,G=E,D=this.currentUser){return!!this._evaluateNode(this.parseTree,
null,G,F,D)}calculateValue(F,G=E,D=this.currentUser){F=this._evaluateNode(this.parseTree,F,G,null,D);return F instanceof f.SqlInterval?F.valueInMilliseconds()/864E5:F}calculateValueCompiled(F,G=E,D=this.currentUser){if(null!=this.parseTree._compiledVersion)return this.parseTree._compiledVersion(F,this.parameters,G,this.fieldsIndex,this.timeZone,D??null);if(n("esri-csp-restrictions"))return this.calculateValue(F,G);this._compileMe();return this.parseTree._compiledVersion(F,this.parameters,G,this.fieldsIndex,
this.timeZone,D??null)}testFeature(F,G=E,D=this.currentUser){return!!this._evaluateNode(this.parseTree,F,G,null,D)}testFeatureCompiled(F,G=E,D=this.currentUser){if(null!=this.parseTree._compiledVersion)return!!this.parseTree._compiledVersion(F,this.parameters,G,this.fieldsIndex,this.timeZone,D??null);if(n("esri-csp-restrictions"))return this.testFeature(F,G);this._compileMe();return!!this.parseTree._compiledVersion(F,this.parameters,G,this.fieldsIndex,this.timeZone,D??null)}get hasDateFunctions(){if(null!=
this._hasDateFunctions)return this._hasDateFunctions;this._hasDateFunctions=!1;x.visitAll(this.parseTree,F=>{"current-time"===F.type?this._hasDateFunctions=!0:"function"===F.type&&(this._hasDateFunctions=this._hasDateFunctions||z.has(F.name.toLowerCase()))});return this._hasDateFunctions}getFunctions(){const F=new Set;x.visitAll(this.parseTree,G=>{"function"===G.type&&F.add(G.name.toLowerCase())});return Array.from(F)}getExpressions(){const F=new Map;x.visitAll(this.parseTree,G=>{if("function"===
G.type){const D=G.name.toLowerCase();G=G.args.value[0];if("column-reference"===G.type){G=G.column;const I=`${D}-${G}`;F.has(I)||F.set(I,{aggregateType:D,field:G})}}});return[...F.values()]}getVariables(){const F=new Set;x.visitAll(this.parseTree,G=>{"parameter"===G.type&&F.add(G.value.toLowerCase())});return Array.from(F)}_compileMe(){const F="return this.convertInterval("+this.evaluateNodeToJavaScript(this.parseTree)+")";this.parseTree._compiledVersion=(new Function("feature","lookups","attributeAdapter",
"fieldsIndex","timeZone","currentUser",F)).bind(A)}_extractExpressionInfo(F){const G=[],D=new Set;let I=!0,J=!1,N=!1;x.visitAll(this.parseTree,M=>{switch(M.type){case "column-reference":var Q=F?.get(M.column);let O;Q?Q=O=Q.name??"":(O=M.column,Q=O.toLowerCase());D.has(Q)||(D.add(Q),G.push(O));M.column=O;break;case "current-user":N=!0;break;case "function":const {name:K,args:L}=M;M=L.value.length;I&&=l.isStandardized(K,M);!1===J&&(J=k.isAggregate(K,M))}});return{referencedFieldNames:Array.from(G),
isStandardized:I,isAggregate:J,currentUserRequired:N}}evaluateNodeToJavaScript(F){switch(F.type){case "interval":return"this.makeSqlInterval("+this.evaluateNodeToJavaScript(F.value)+", "+JSON.stringify(F.qualifier)+","+JSON.stringify(F.op)+")";case "case-expression":var G="";if("simple"===F.format){var D=this.evaluateNodeToJavaScript(F.operand);G="( ";for(let I=0;I<F.clauses.length;I++)G+=" (this.compare('\x3d',"+D+","+this.evaluateNodeToJavaScript(F.clauses[I].operand)+") ? ("+this.evaluateNodeToJavaScript(F.clauses[I].value)+
") : "}else for(G="( ",D=0;D<F.clauses.length;D++)G+=" this.makeBool("+this.evaluateNodeToJavaScript(F.clauses[D].operand)+")\x3d\x3d\x3dtrue ? ("+this.evaluateNodeToJavaScript(F.clauses[D].value)+") : ";G=null!==F.else?G+this.evaluateNodeToJavaScript(F.else):G+"null";return G+" )";case "parameter":return"this.lookup("+JSON.stringify(F.value.toLowerCase())+",lookups)";case "expression-list":G="[";for(D of F.value)"["!==G&&(G+=","),G+=this.evaluateNodeToJavaScript(D);return G+"]";case "unary-expression":return"this.ternaryNot("+
this.evaluateNodeToJavaScript(F.expr)+")";case "binary-expression":switch(F.operator){case "AND":return"this.ternaryAnd("+this.evaluateNodeToJavaScript(F.left)+","+this.evaluateNodeToJavaScript(F.right)+" )";case "OR":return"this.ternaryOr("+this.evaluateNodeToJavaScript(F.left)+","+this.evaluateNodeToJavaScript(F.right)+" )";case "IS":if("null"!==F.right.type)throw new h.SqlError(h.SqlErrorCodes.UnsupportedIsRhs);return"this.equalsNull("+this.evaluateNodeToJavaScript(F.left)+")";case "ISNOT":if("null"!==
F.right.type)throw new h.SqlError(h.SqlErrorCodes.UnsupportedIsRhs);return"(!(this.equalsNull("+this.evaluateNodeToJavaScript(F.left)+")))";case "IN":return"this.applyIn("+this.evaluateNodeToJavaScript(F.left)+",this.ensureArray("+this.evaluateNodeToJavaScript(F.right)+"), timeZone)";case "NOT IN":return"this.ternaryNot(this.applyIn("+this.evaluateNodeToJavaScript(F.left)+",this.ensureArray("+this.evaluateNodeToJavaScript(F.right)+"), timeZone))";case "BETWEEN":return"this.between("+this.evaluateNodeToJavaScript(F.left)+
","+this.evaluateNodeToJavaScript(F.right)+", timeZone)";case "NOTBETWEEN":return"this.notbetween("+this.evaluateNodeToJavaScript(F.left)+","+this.evaluateNodeToJavaScript(F.right)+", timeZone)";case "LIKE":return"this.applyLike("+this.evaluateNodeToJavaScript(F.left)+","+this.evaluateNodeToJavaScript(F.right)+","+JSON.stringify(F.escape)+")";case "NOT LIKE":return"this.ternaryNot(this.applyLike("+this.evaluateNodeToJavaScript(F.left)+","+this.evaluateNodeToJavaScript(F.right)+","+JSON.stringify(F.escape)+
"))";case "\x3c\x3e":case "\x3c":case "\x3e":case "\x3e\x3d":case "\x3c\x3d":case "\x3d":return"this.compare("+JSON.stringify(F.operator)+","+this.evaluateNodeToJavaScript(F.left)+","+this.evaluateNodeToJavaScript(F.right)+", timeZone)";case "*":case "-":case "+":case "/":case "||":return"this.calculate("+JSON.stringify(F.operator)+","+this.evaluateNodeToJavaScript(F.left)+","+this.evaluateNodeToJavaScript(F.right)+", timeZone)";default:throw new h.SqlError(h.SqlErrorCodes.UnsupportedOperator,{operator:F.operator});
}case "null":case "boolean":case "string":case "number":return JSON.stringify(F.value);case "time":return"this.evaluateTime("+JSON.stringify(F.value)+")";case "date":return"this.evaluateDate("+JSON.stringify(F.value)+", 'unknown')";case "timestamp":return"this.evaluateTimestamp("+JSON.stringify(F.value)+", 'unknown')";case "current-time":return"date"===F.mode?"this.currentDate(timeZone)":"time"===F.mode?"this.currentTime(timeZone)":"this.currentTimestamp(timeZone)";case "current-user":return"currentUser";
case "column-reference":return"this.featureValue(feature,"+JSON.stringify(F.column)+",fieldsIndex,attributeAdapter)";case "function":return"this.evaluateFunction("+JSON.stringify(F.name)+","+this.evaluateNodeToJavaScript(F.args)+", timeZone)"}throw new h.SqlError(h.SqlErrorCodes.UnsupportedSyntax,{node:F.type});}_evaluateNode(F,G,D,I,J){switch(F.type){case "interval":return D=this._evaluateNode(F.value,G,D,I,J),f.SqlInterval.createFromValueAndQualifier(D,F.qualifier,F.op);case "case-expression":if("simple"===
F.format){var N=this._evaluateNode(F.operand,G,D,I,J);for(var M=0;M<F.clauses.length;M++)if(g.sqlCompare(N,this._evaluateNode(F.clauses[M].operand,G,D,I,J),"\x3d",this.timeZone))return this._evaluateNode(F.clauses[M].value,G,D,I,J)}else for(N=0;N<F.clauses.length;N++)if(!0===this._evaluateNode(F.clauses[N].operand,G,D,I,J))return this._evaluateNode(F.clauses[N].value,G,D,I,J);return null!==F.else?this._evaluateNode(F.else,G,D,I,J):null;case "parameter":return F=this.parameters[F.value.toLowerCase()],
d.isDate(F)?u.DateTime.fromJSDate(F):F instanceof b.ArcadeDate?F.toDateTime():F;case "expression-list":N=[];for(var Q of F.value)N.push(this._evaluateNode(Q,G,D,I,J));return N;case "unary-expression":return m(this._evaluateNode(F.expr,G,D,I,J));case "binary-expression":switch(F.operator){case "AND":return q(this._evaluateNode(F.left,G,D,I,J),this._evaluateNode(F.right,G,D,I,J));case "OR":return r(this._evaluateNode(F.left,G,D,I,J),this._evaluateNode(F.right,G,D,I,J));case "IS":if("null"!==F.right.type)throw new h.SqlError(h.SqlErrorCodes.UnsupportedIsRhs);
return null===this._evaluateNode(F.left,G,D,I,J);case "ISNOT":if("null"!==F.right.type)throw new h.SqlError(h.SqlErrorCodes.UnsupportedIsRhs);return null!==this._evaluateNode(F.left,G,D,I,J);case "IN":return N=t(this._evaluateNode(F.right,G,D,I,J)),v(this._evaluateNode(F.left,G,D,I,J),N,this.timeZone);case "NOT IN":return N=t(this._evaluateNode(F.right,G,D,I,J)),m(v(this._evaluateNode(F.left,G,D,I,J),N,this.timeZone));case "BETWEEN":return N=this._evaluateNode(F.left,G,D,I,J),F=this._evaluateNode(F.right,
G,D,I,J),null==N||null==F[0]||null==F[1]?null:g.sqlCompare(N,F[0],"\x3e\x3d",this.timeZone)&&g.sqlCompare(N,F[1],"\x3c\x3d",this.timeZone);case "NOTBETWEEN":return N=this._evaluateNode(F.left,G,D,I,J),F=this._evaluateNode(F.right,G,D,I,J),null==N||null==F[0]||null==F[1]?null:g.sqlCompare(N,F[0],"\x3c",this.timeZone)||g.sqlCompare(N,F[1],"\x3e",this.timeZone);case "LIKE":return y(this._evaluateNode(F.left,G,D,I,J),this._evaluateNode(F.right,G,D,I,J),F.escape);case "NOT LIKE":return m(y(this._evaluateNode(F.left,
G,D,I,J),this._evaluateNode(F.right,G,D,I,J),F.escape));case "\x3c\x3e":case "\x3c":case "\x3e":case "\x3e\x3d":case "\x3c\x3d":case "\x3d":return g.sqlCompare(this._evaluateNode(F.left,G,D,I,J),this._evaluateNode(F.right,G,D,I,J),F.operator,this.timeZone);case "-":case "+":case "*":case "/":case "||":return e.sqlCalculateFunction(F.operator,this._evaluateNode(F.left,G,D,I,J),this._evaluateNode(F.right,G,D,I,J),this.timeZone)}case "null":case "boolean":case "string":case "number":return F.value;case "date":return F.parsedValue??
(F.parsedValue=d.parseDate(F.value,"unknown")),F.parsedValue;case "timestamp":return F.parsedValue??(F.parsedValue=d.parseTimestamp(F.value,"unknown")),F.parsedValue;case "time":return d.parseTime(F.value);case "current-time":return"date"===F.mode?A.currentDate(this.timeZone):"time"===F.mode?A.currentTime(this.timeZone):A.currentTimestamp(this.timeZone);case "current-user":return J??null;case "column-reference":return B(G,F.column,this.fieldsIndex,D);case "data-type":return F.value;case "function":if(this.isAggregate&&
k.isAggregate(F.name,F.args.value.length)){G=[];for(N of F.args?.value||[]){Q=[];for(M of I||[])Q.push(this._evaluateNode(N,M,D,null,J));G.push(Q)}return k.aggregateFunction(F.name,G)}D=this._evaluateNode(F.args,G,D,I,J);return l.evaluateFunction(F.name,D,this.timeZone)}throw new h.SqlError(h.SqlErrorCodes.UnsupportedSyntax,{node:F.type});}}var H;(function(F){F[F.Normal=0]="Normal";F[F.Escaped=1]="Escaped"})(H||={});const E={getAttribute(F,G){return(F&&"object"===typeof F.attributes?F.attributes:
F)[G]}};a.WhereClause=C;a.defaultAttributeAdapter=E;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/arcade/ArcadeDate":function(){define(["exports","../core/string","../core/sql/UnknownTimeZone","../chunks/datetime"],function(a,b,n,k){function p(f,c,l){return f<c?f-c:f>l?f-l:0}function h(f,c=!0){if(f instanceof k.Zone)return f;if("system"===f.toLowerCase())return"system";if("utc"===f.toLowerCase())return"UTC";if("unknown"===f.toLowerCase())return n.UnknownTimeZone.instance;if(/^[+-]?[0-9]{1,2}([:][0-9]{2})?$/.test(f)){const l=
k.FixedOffsetZone.parseSpecifier("UTC"+(f.startsWith("+")||f.startsWith("-")?"":"+")+f);if(l)return l}f=k.IANAZone.create(f);if(!f.isValid){if(c)throw new g(a.ArcadeDateErrorCodes.TimeZoneNotRecognized);return null}return f}a.ArcadeDateErrorCodes=void 0;(a.ArcadeDateErrorCodes||(a.ArcadeDateErrorCodes={})).TimeZoneNotRecognized="TimeZoneNotRecognized";const e={[a.ArcadeDateErrorCodes.TimeZoneNotRecognized]:"Timezone identifier has not been recognized."};class g extends Error{constructor(f,c){super(b.replace(e[f],
c));this.declaredRootClass="esri.arcade.arcadedate.dateerror";Error.captureStackTrace&&Error.captureStackTrace(this,g)}}class d{constructor(f){this._date=f;this.declaredRootClass="esri.arcade.arcadedate"}static fromParts(f=0,c=1,l=1,w=0,x=0,u=0,t=0,m){if(isNaN(f)||isNaN(c)||isNaN(l)||isNaN(w)||isNaN(x)||isNaN(u)||isNaN(t))return null;const q=k.DateTime.local(f,c).daysInMonth;f=k.DateTime.fromObject({day:1>l?1:l>q?q:l,year:f,month:1>c?1:12<c?12:c,hour:0>w?0:23<w?23:w,minute:0>x?0:59<x?59:x,second:0>
u?0:59<u?59:u,millisecond:0>t?0:999<t?999:t},{zone:h(m)});f=f.plus({months:p(c,1,12),days:p(l,1,q),hours:p(w,0,23),minutes:p(x,0,59),seconds:p(u,0,59),milliseconds:p(t,0,999)});return new d(f)}static get systemTimeZoneCanonicalName(){return Intl.DateTimeFormat().resolvedOptions().timeZone??"system"}static arcadeDateAndZoneToArcadeDate(f,c){c=h(c);return f.isUnknownTimeZone||c===n.UnknownTimeZone.instance?d.fromParts(f.year,f.monthJS+1,f.day,f.hour,f.minute,f.second,f.millisecond,c):new d(f._date.setZone(c))}static dateJSToArcadeDate(f){return new d(k.DateTime.fromJSDate(f,
{zone:"system"}))}static dateJSAndZoneToArcadeDate(f,c="system"){c=h(c);return new d(k.DateTime.fromJSDate(f,{zone:c}))}static unknownEpochToArcadeDate(f){return new d(k.DateTime.fromMillis(f,{zone:n.UnknownTimeZone.instance}))}static unknownDateJSToArcadeDate(f){return new d(k.DateTime.fromMillis(f.getTime(),{zone:n.UnknownTimeZone.instance}))}static epochToArcadeDate(f,c="system"){c=h(c);return new d(k.DateTime.fromMillis(f,{zone:c}))}static dateTimeToArcadeDate(f){return new d(f)}clone(){return new d(this._date)}changeTimeZone(f){f=
h(f);return d.dateTimeToArcadeDate(this._date.setZone(f))}static dateTimeAndZoneToArcadeDate(f,c){c=h(c);return f.zone===n.UnknownTimeZone.instance||c===n.UnknownTimeZone.instance?d.fromParts(f.year,f.month,f.day,f.hour,f.minute,f.second,f.millisecond,c):new d(f.setZone(c))}static nowToArcadeDate(f){f=h(f);return new d(k.DateTime.fromJSDate(new Date,{zone:f}))}static nowUTCToArcadeDate(){return new d(k.DateTime.utc())}get isSystem(){return"system"===this.timeZone||this.timeZone===d.systemTimeZoneCanonicalName}equals(f){return this.isSystem&&
f.isSystem?this.toNumber()===f.toNumber():this.isUnknownTimeZone!==f.isUnknownTimeZone?!1:this._date.equals(f._date)}get isUnknownTimeZone(){return this._date.zone===n.UnknownTimeZone.instance}get isValid(){return this._date.isValid}get hour(){return this._date.hour}get second(){return this._date.second}get day(){return this._date.day}get dayOfWeekISO(){return this._date.weekday}get dayOfWeekJS(){let f=this._date.weekday;6<f&&(f=0);return f}get millisecond(){return this._date.millisecond}get monthISO(){return this._date.month}get weekISO(){return this._date.weekNumber}get yearISO(){return this._date.weekYear}get monthJS(){return this._date.month-
1}get year(){return this._date.year}get minute(){return this._date.minute}get zone(){return this._date.zone}get timeZoneOffset(){return this.isUnknownTimeZone?0:this._date.offset}get timeZone(){if(this.isUnknownTimeZone)return"unknown";if("system"===this._date.zone.type)return"system";const f=this.zone;return"fixed"===f.type?0===f.fixed?"UTC":f.formatOffset(0,"short"):f.name}stringify(){return JSON.stringify(this.toJSDate())}plus(f){return new d(this._date.plus(f))}diff(f,c="milliseconds"){return this._date.diff(f._date,
c)[c]}toISODate(){return this._date.toISODate()}toISOString(f){return f?this._date.toISO({suppressMilliseconds:!0,includeOffset:!this.isUnknownTimeZone}):this._date.toISO({includeOffset:!this.isUnknownTimeZone})}toISOTime(f,c){return this._date.toISOTime({suppressMilliseconds:f,includeOffset:c&&!this.isUnknownTimeZone})}toFormat(f,c){this.isUnknownTimeZone&&(f=f.replaceAll("Z",""));return this._date.toFormat(f,c)}toJSDate(){return this._date.toJSDate()}toSQLValue(){return this._date.toFormat("yyyy-LL-dd HH:mm:ss")}toSQLWithKeyword(){return`timestamp '${this.toSQLValue()}'`}toDateTime(){return this._date}toNumber(){return this._date.toMillis()}getTime(){return this._date.toMillis()}toUTC(){return new d(this._date.toUTC())}toLocal(){return new d(this._date.toLocal())}toString(){return this.toISOString(!0)}static fromReaderAsTimeStampOffset(f){if(!f)return null;
f=k.DateTime.fromISO(f,{setZone:!0});return new d(f)}}a.ArcadeDate=d;a.ArcadeDateError=g;a.arcadeDateErrorMessages=e;a.createDateTimeZone=h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/sql/AggregateFunctions":function(){define("exports ./DateOnly ./errorSupport ./SqlTimestampOffset ./TimeOnly ../../chunks/datetime".split(" "),function(a,b,n,k,p,h){function e(c){if(null===c)return null;let l=0,w=0;for(let x=0;x<c.length;x++){const u=c[x];if(null!==u){if("number"!==typeof u)throw new n.SqlError(n.SqlErrorCodes.InvalidValueForAggregateFunction);
w++;l+=u}}return 0===w?null:l/c.length}function g(c,l){if(null===c)return null;let w=null,x=null;for(const u of c)c=u,c=u instanceof b.DateOnly?u.toNumber():u instanceof p.TimeOnly?u.toNumber():u instanceof h.DateTime?u.toMillis():u instanceof k.SqlTimeStampOffset?u.toMilliseconds():u,null===w?(w=u,x=c):"max"===l&&null!==x&&null!==c&&x<=c?(w=u,x=c):"min"===l&&null!==x&&null!==c&&x>=c&&(w=u,x=c);return w}function d(c){if(null===c)return null;c=c.filter(x=>null!==x);if(0===c.length)return null;const l=
e(c);if(null===l)return null;let w=0;for(const x of c){if("number"!==typeof x)throw new n.SqlError(n.SqlErrorCodes.InvalidValueForAggregateFunction);w+=(l-x)**2}return w/(c.length-1)}const f={min:{minParams:1,maxParams:1,evaluate:c=>g(c[0],"min")},max:{minParams:1,maxParams:1,evaluate:c=>g(c[0],"max")},avg:{minParams:1,maxParams:1,evaluate:c=>e(c[0])},sum:{minParams:1,maxParams:1,evaluate:c=>{c=c[0];if(null===c)c=null;else{var l=0;for(let w=0;w<c.length;w++){const x=c[w];if(null!==x){if("number"!==
typeof x)throw new n.SqlError(n.SqlErrorCodes.InvalidValueForAggregateFunction);l+=x}}c=l}return c}},stddev:{minParams:1,maxParams:1,evaluate:c=>{c=c[0];null===c?c=null:(c=d(c),c=null===c?null:Math.sqrt(c));return c}},count:{minParams:1,maxParams:1,evaluate:c=>null==c[0]?null:c[0].length},var:{minParams:1,maxParams:1,evaluate:c=>d(c[0])}};a.aggregateFunction=function(c,l){const w=f[c.toLowerCase()];if(null==w)throw new n.SqlError(n.SqlErrorCodes.FunctionNotRecognized);if(l.length<w.minParams||l.length>
w.maxParams)throw new n.SqlError(n.SqlErrorCodes.InvalidParameterCount,{name:c.toUpperCase()});return w.evaluate(l)};a.isAggregate=function(c,l){c=f[c.toLowerCase()];return null!=c&&l>=c.minParams&&l<=c.maxParams};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/sql/DateOnly":function(){define(["exports","../../arcade/ArcadeDate","../../intl/locale","../../chunks/datetime"],function(a,b,n,k){function p(e){e=e.replaceAll(/LTS|LT|L{1,4}|l{1,4}/g,"[$\x26]");let g="";const d=
/(\[[^[]*\])|(\\)?([Hh]mm(ss)?|Mo|M{1,4}|Do|DDDo|D{1,4}|d{2,4}|do?|w[o|w]?|W[o|W]?|Qo?|N{1,5}|YYYYYY|YYYYY|YYYY|YY|y{2,4}|yo?|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|kk?|mm?|ss?|S{1,9}|x|X|zz?|ZZ?|.)/g;for(const f of e.match(d)||[])switch(f){case "D":g+="d";break;case "DD":g+="dd";break;case "DDD":g+="o";break;case "d":g+="c";break;case "ddd":g+="ccc";break;case "dddd":g+="cccc";break;case "M":g+="L";break;case "MM":g+="LL";break;case "MMM":g+="LLL";break;case "MMMM":g+="LLLL";break;case "YY":g+="yy";
break;case "Y":case "YYYY":g+="yyyy";break;case "Q":g+="q";break;case "X":case "x":g+=f;break;default:g=2<=f.length&&"["===f.slice(0,1)&&"]"===f.slice(-1)?g+`'${f.slice(1,-1)}'`:g+`'${f}'`}return g}class h{constructor(e,g,d){this._year=e;this._month=g;this._day=d;this.declaredRootClass="esri.core.sql.dateonly"}get month(){return this._month}get monthJS(){return this._month-1}get year(){return this._year}get day(){return this._day}get isValid(){return this.toDateTime("unknown").isValid}equals(e){return e instanceof
h&&e.day===this.day&&e.month===this.month&&e.year===this.year}clone(){return new h(this._year,this._month,this._day)}toDateTime(e){return k.DateTime.fromObject({day:this.day,month:this.month,year:this.year},{zone:b.createDateTimeZone(e)})}toDateTimeLuxon(e){return k.DateTime.fromObject({day:this.day,month:this.month,year:this.year},{zone:b.createDateTimeZone(e)})}toString(){return`${this.year.toString().padStart(4,"0")}-${this.month.toString().padStart(2,"0")}-${this.day.toString().padStart(2,"0")}`}toFormat(e=
null,g=!0){if(null===e||""===e)return this.toString();g&&(e=p(e));if(!e)return"";g=this.toDateTime("unknown");return b.ArcadeDate.dateTimeToArcadeDate(g).toFormat(e,{locale:n.getLocale(),numberingSystem:"latn"})}toArcadeDate(){const e=this.toDateTime("unknown");return b.ArcadeDate.dateTimeToArcadeDate(e)}toNumber(){return this.toDateTime("unknown").toMillis()}toJSDate(){return this.toDateTime("unknown").toJSDate()}toStorageFormat(){return this.toFormat("yyyy-LL-dd",!1)}toSQLValue(){return this.toFormat("yyyy-LL-dd",
!1)}toSQLWithKeyword(){return"date '"+this.toFormat("yyyy-LL-dd",!1)+"'"}plus(e,g){return h.fromDateTime(this.toUTCDateTime().plus({[e]:g}))}toUTCDateTime(){return k.DateTime.utc(this.year,this.month,this.day,0,0,0,0)}difference(e,g){switch(g.toLowerCase()){case "days":case "day":case "d":return this.toUTCDateTime().diff(e.toUTCDateTime(),"days").days;case "months":case "month":return this.toUTCDateTime().diff(e.toUTCDateTime(),"months").months;case "minutes":case "minute":case "m":return"M"===g?
this.toUTCDateTime().diff(e.toUTCDateTime(),"months").months:this.toUTCDateTime().diff(e.toUTCDateTime(),"minutes").minutes;case "seconds":case "second":case "s":return this.toUTCDateTime().diff(e.toUTCDateTime(),"seconds").seconds;case "milliseconds":case "millisecond":case "ms":return this.toUTCDateTime().diff(e.toUTCDateTime(),"milliseconds").milliseconds;case "hours":case "hour":case "h":return this.toUTCDateTime().diff(e.toUTCDateTime(),"hours").hours;case "years":case "year":case "y":return this.toUTCDateTime().diff(e.toUTCDateTime(),
"years").years;default:return this.toUTCDateTime().diff(e.toUTCDateTime(),"milliseconds").milliseconds}}static fromMilliseconds(e){e=k.DateTime.fromMillis(e,{zone:k.FixedOffsetZone.utcInstance});return e.isValid?h.fromParts(e.year,e.month,e.day):null}static fromSeconds(e){e=k.DateTime.fromSeconds(e,{zone:k.FixedOffsetZone.utcInstance});return e.isValid?h.fromParts(e.year,e.month,e.day):null}static fromReader(e){if(!e)return null;e=e.split("-");return 3!==e.length?null:new h(parseInt(e[0],10),parseInt(e[1],
10),parseInt(e[2],10))}static fromParts(e,g,d){e=new h(e,g,d);return!1===e.isValid?null:e}static fromDateJS(e){return h.fromParts(e.getFullYear(),e.getMonth()+1,e.getDay())}static fromDateTime(e){return h.fromParts(e.year,e.month,e.day)}static fromSqlTimeStampOffset(e){return this.fromDateTime(e.toDateTime())}static fromString(e,g=null){if(""===e||null===e)return null;var d=[];if(g)(g=p(g))&&d.push(g);else if(null===g||""===g)return e=k.DateTime.fromISO(e,{setZone:!0}),e.isValid?h.fromParts(e.year,
e.month,e.day):null;for(const f of d)if(d=k.DateTime.fromFormat(e,g??f),d.isValid)return new h(d.year,d.month,d.day);return null}static fromNow(e="system"){e=k.DateTime.fromJSDate(new Date).setZone(b.createDateTimeZone(e));return new h(e.year,e.month,e.day)}}a.DateOnly=h;a.standardizeDateOnlyFormat=p;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/sql/errorSupport":function(){define(["exports","../string"],function(a,b){a.SqlErrorCodes=void 0;(function(p){p.InvalidFunctionParameters=
"InvalidFunctionParameters";p.InvalidValueForAggregateFunction="InvalidValueForAggregateFunction";p.UnsupportedSqlFunction="UnsupportedSqlFunction";p.UnsupportedOperator="UnsupportedOperator";p.UnsupportedSyntax="UnsupportedSyntax";p.UnsupportedIsRhs="UnsupportedIsRhs";p.UnsupportedIsLhs="UnsupportedIsLhs";p.InvalidDataType="InvalidDataType";p.CannotCastValue="CannotCastValue";p.FunctionNotRecognized="FunctionNotRecognized";p.InvalidTime="InvalidTime";p.InvalidParameterCount="InvalidParameterCount";
p.InvalidTimeStamp="InvalidTimeStamp";p.InvalidDate="InvalidDate";p.InvalidOperator="InvalidOperator";p.IllegalInterval="IllegalInterval";p.YearMonthIntervals="YearMonthIntervals";p.PrimarySecondaryQualifiers="PrimarySecondaryQualifiers";p.MissingStatisticParameters="MissingStatisticParameters"})(a.SqlErrorCodes||(a.SqlErrorCodes={}));const n={[a.SqlErrorCodes.InvalidValueForAggregateFunction]:"Invalid value used in aggregate function",[a.SqlErrorCodes.MissingStatisticParameters]:"Statistic does not have 1 or 0 Parameters",
[a.SqlErrorCodes.InvalidFunctionParameters]:"Invalid parameters for call to {function}",[a.SqlErrorCodes.UnsupportedIsLhs]:"Unsupported left hand expression in is statement",[a.SqlErrorCodes.UnsupportedIsRhs]:"Unsupported right hand expression in is statement",[a.SqlErrorCodes.UnsupportedOperator]:"Unsupported operator - {operator}",[a.SqlErrorCodes.UnsupportedSyntax]:"Unsupported syntax - {node}",[a.SqlErrorCodes.UnsupportedSqlFunction]:"Sql function not found \x3d {function}",[a.SqlErrorCodes.InvalidDataType]:"Invalid sql data type",
[a.SqlErrorCodes.InvalidDate]:"Invalid date encountered",[a.SqlErrorCodes.InvalidOperator]:"Invalid operator encountered",[a.SqlErrorCodes.InvalidTime]:"Invalid time encountered",[a.SqlErrorCodes.IllegalInterval]:"Illegal interval",[a.SqlErrorCodes.FunctionNotRecognized]:"Function not recognized",[a.SqlErrorCodes.InvalidTimeStamp]:"Invalid timestamp encountered",[a.SqlErrorCodes.InvalidParameterCount]:"Invalid parameter count for call to {name}",[a.SqlErrorCodes.PrimarySecondaryQualifiers]:"Primary and Secondary SqlInterval qualifiers not supported",
[a.SqlErrorCodes.YearMonthIntervals]:"Year-Month Intervals not supported",[a.SqlErrorCodes.CannotCastValue]:"Cannot cast value to the required data type"};class k extends Error{constructor(p,h){super(b.replace(n[p],h));this.declaredRootClass="esri.arcade.featureset.support.sqlerror";Error.captureStackTrace&&Error.captureStackTrace(this,k)}}a.SqlError=k;a.sqlErrorMessages=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/sql/SqlTimestampOffset":function(){define(["exports",
"../../chunks/datetime"],function(a,b){function n(p){return Number.isNaN(p)||0===p?p:Math.trunc(p)}class k{constructor(p){this._timeStampOffset=p;this._date=null}toDateTime(){this._date??(this._date=b.DateTime.fromISO(this._timeStampOffset,{setZone:!0}));return this._date}get isValid(){return this.toDateTime().isValid}get timezoneOffsetHour(){return n(this.toDateTime().offset/60)}get timezoneOffsetMinutes(){return n(this.toDateTime().offset%60)}toMilliseconds(){return this.toDateTime().toMillis()}get hour(){return this.toDateTime().hour}get minute(){return this.toDateTime().minute}get second(){return this.toDateTime().second}get day(){return this.toDateTime().day}get month(){return this.toDateTime().month}get year(){return this.toDateTime().year}startOfDay(){return k.fromDateTime(this.toDateTime().startOf("day"))}static fromJSDate(p){return new k(b.DateTime.fromJSDate(p).toISO({includeOffset:!0}))}static fromDateTime(p){return new k(p.toISO({includeOffset:!0}))}static fromParts(p,
h,e=0,g=0,d=0,f=0,c=0,l=!1,w=0,x=0){p=`${p.toString().padStart(4,"0")}-${h.toString().padStart(2,"0")}-${e.toString().padStart(2,"0")}`;h="";10>f&&(h="0");g=`${g.toString().padStart(2,"0")}:${d.toString().padStart(2,"0")}:${h+f.toString()}`;0!==c&&(g+="."+c.toString().padStart(3,"0"));c=`${l?"-":"+"}${w.toString().padStart(2,"0")}:${x.toString().padStart(2,"0")}`;return new k(p+"T"+g+c)}toStorageFormat(){return this._timeStampOffset}toString(){return this._timeStampOffset}toSQLValue(){let p=this.toDateTime().toSQL({includeOffset:!0,
includeOffsetSpace:!0});p&&=p.replace(".000","");return p}toSQLWithKeyword(){return`timestamp '${this.toSQLValue()}'`}addMilliseconds(p){p=this.toDateTime().plus(p);return k.fromDateTime(p)}}a.SqlTimeStampOffset=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/sql/TimeOnly":function(){define(["exports","../../arcade/kernel","../../intl/locale","../../chunks/datetime"],function(a,b,n,k){function p(e){if(!e)return"";const g=/(a|A|hh?|HH?|mm?|ss?|SSS|S|.)/g;let d="";for(const f of e.match(g)||
[])switch(f){case "SSS":d+=f;break;case "A":case "a":d+="a";break;case "m":case "mm":case "h":case "hh":case "H":case "HH":case "s":case "ss":d+=f;break;default:d+=`'${f}'`}return d}class h{constructor(e,g,d,f){this._hour=e;this._minute=g;this._second=d;this._millisecond=f;this.declaredRootClass="esri.core.sql.timeonly"}get hour(){return this._hour}get minute(){return this._minute}get second(){return this._second}get millisecond(){return this._millisecond}equals(e){return e instanceof h&&e.hour===
this.hour&&e.minute===this.minute&&e.second===this.second&&e.millisecond===this.millisecond}clone(){return new h(this.hour,this.minute,this.second,this.millisecond)}isValid(){return b.isInteger(this.hour)&&b.isInteger(this.minute)&&b.isInteger(this.second)&&b.isInteger(this.millisecond)&&0<=this.hour&&24>this.hour&&0<=this.minute&&60>this.minute&&0<=this.second&&60>this.second&&0<=this.millisecond&&1E3>this.millisecond}toString(){return`${this.hour.toString().padStart(2,"0")}:${this.minute.toString().padStart(2,
"0")}:${this.second.toString().padStart(2,"0")}`+(0<this.millisecond?"."+this.millisecond.toString().padStart(3,"0"):"")}toSQLValue(){return this.toString()}toSQLWithKeyword(){return`time '${this.hour.toString().padStart(2,"0")}:${this.minute.toString().padStart(2,"0")}:${this.second.toString().padStart(2,"0")}${0<this.millisecond?"."+this.millisecond.toString().padStart(3,"0"):""}'`}toStorageString(){return`${this.hour.toString().padStart(2,"0")}:${this.minute.toString().padStart(2,"0")}:${this.second.toString().padStart(2,
"0")}`}toFormat(e=null){return null===e||""===e?this.toString():(e=p(e))?k.DateTime.local(1970,1,1,this._hour,this._minute,this._second,this._millisecond).toFormat(e,{locale:n.getLocale(),numberingSystem:"latn"}):""}toNumber(){return this.millisecond+1E3*this.second+6E4*this.minute+36E5*this.hour}static fromParts(e,g,d,f){e=new h(e,g,d,f);return e.isValid()?e:null}static fromReader(e){if(!e)return null;e=e.split(":");return 3!==e.length?null:new h(parseInt(e[0],10),parseInt(e[1],10),parseInt(e[2],
10),0)}static fromMilliseconds(e){return 864E5<e||0>e?null:new h(Math.floor(e/36E5%24),Math.floor(e/6E4%60),Math.floor(e/1E3%60),Math.floor(e%1E3))}static fromDateJS(e){return new h(e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds())}static fromDateTime(e){return new h(e.hour,e.minute,e.second,e.millisecond)}static fromSqlTimeStampOffset(e){return this.fromDateTime(e.toDateTime())}static fromString(e,g=null){if(""===e||null===e)return null;const d=[];if(g)(g=p(g))&&d.push(g);else if(null===
g||""===g)d.push("HH:mm:ss"),d.push("HH:mm:ss.SSS"),d.push("hh:mm:ss a"),d.push("hh:mm:ss.SSS a"),d.push("HH:mm"),d.push("hh:mm a"),d.push("H:mm"),d.push("h:mm a"),d.push("H:mm:ss"),d.push("h:mm:ss a"),d.push("H:mm:ss.SSS"),d.push("h:mm:ss.SSS a");for(const f of d)if(g=k.DateTime.fromFormat(e,f),g.isValid)return new h(g.hour,g.minute,g.second,g.millisecond);return null}plus(e,g){switch(e){case "days":case "years":case "months":return this.clone();case "hours":case "minutes":case "seconds":case "milliseconds":return h.fromDateTime(this.toUTCDateTime().plus({[e]:g}))}return null}toUTCDateTime(){return k.DateTime.utc(1970,
1,1,this.hour,this.minute,this.second,this.millisecond)}difference(e,g){switch(g.toLowerCase()){case "days":case "day":case "d":return this.toUTCDateTime().diff(e.toUTCDateTime(),"days").days;case "months":case "month":return this.toUTCDateTime().diff(e.toUTCDateTime(),"months").months;case "minutes":case "minute":case "m":return"M"===g?this.toUTCDateTime().diff(e.toUTCDateTime(),"months").months:this.toUTCDateTime().diff(e.toUTCDateTime(),"minutes").minutes;case "seconds":case "second":case "s":return this.toUTCDateTime().diff(e.toUTCDateTime(),
"seconds").seconds;case "milliseconds":case "millisecond":case "ms":return this.toUTCDateTime().diff(e.toUTCDateTime(),"milliseconds").milliseconds;case "hours":case "hour":case "h":return this.toUTCDateTime().diff(e.toUTCDateTime(),"hours").hours;case "years":case "year":case "y":return this.toUTCDateTime().diff(e.toUTCDateTime(),"years").years;default:return this.toUTCDateTime().diff(e.toUTCDateTime(),"milliseconds").milliseconds}}}a.TimeOnly=h;a.standardizeTimeFormat=p;Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/arcade/kernel":function(){define(["exports","../geometry/Extent"],function(a,b){a.cloneGeometry=function(n){if(null==n)return null;const k=n.clone();void 0!==n.cache._geVersion&&(k.cache._geVersion=n.cache._geVersion);return k};a.convertLinearUnitsToCode=function(n){if(null==n)return null;if("number"===typeof n)return n;n=n.toLowerCase();n=n.replaceAll(/\s/g,"");n=n.replaceAll("-","");switch(n){case "meters":case "meter":case "m":case "squaremeters":case "squaremeter":return 9001;
case "miles":case "mile":case "squaremile":case "squaremiles":return 9093;case "kilometers":case "kilometer":case "squarekilometers":case "squarekilometer":case "km":return 9036;case "yard":case "yd":case "yards":case "squareyards":case "squareyard":return 9096;case "feet":case "ft":case "foot":case "squarefeet":case "squarefoot":return 9002;case "nmi":case "nauticalmile":case "nauticalmiles":case "squarenauticalmile":case "squarenauticalmiles":return 9030}return null};a.convertSquareUnitsToCode=
function(n){if(null==n)return null;if("number"===typeof n)return n;n=n.toLowerCase();n=n.replaceAll(/\s/g,"");n=n.replaceAll("-","");switch(n){case "meters":case "meter":case "m":case "squaremeters":case "squaremeter":return 109404;case "miles":case "mile":case "squaremile":case "squaremiles":return 109439;case "kilometers":case "kilometer":case "squarekilometers":case "squarekilometer":case "km":return 109414;case "acres":case "acre":case "ac":return 109402;case "hectares":case "hectare":case "ha":return 109401;
case "yard":case "yd":case "yards":case "squareyards":case "squareyard":return 109442;case "feet":case "ft":case "foot":case "squarefeet":case "squarefoot":return 109405;case "nmi":case "nauticalmile":case "nauticalmiles":case "squarenauticalmile":case "squarenauticalmiles":return 109409}return null};a.isInteger=function(n){return"number"===typeof n&&isFinite(n)&&Math.floor(n)===n};a.sameGeomType=function(n,k){return n===k||"point"===n&&"esriGeometryPoint"===k||"polyline"===n&&"esriGeometryPolyline"===
k||"polygon"===n&&"esriGeometryPolygon"===k||"extent"===n&&"esriGeometryEnvelope"===k||"multipoint"===n&&"esriGeometryMultipoint"===k||"point"===k&&"esriGeometryPoint"===n||"polyline"===k&&"esriGeometryPolyline"===n||"polygon"===k&&"esriGeometryPolygon"===n||"extent"===k&&"esriGeometryEnvelope"===n||"multipoint"===k&&"esriGeometryMultipoint"===n?!0:!1};a.shapeExtent=function(n){if(null==n)return null;switch(n.type){case "polygon":case "multipoint":case "polyline":return n.extent;case "point":return new b({xmin:n.x,
ymin:n.y,xmax:n.x,ymax:n.y,spatialReference:n.spatialReference});case "extent":return n}return null};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/sql/sqlArithmeticUtils":function(){define(["exports","./errorSupport","./sqlDateParsingUtils","./SqlInterval","./StandardizedFunctions"],function(a,b,n,k,p){function h(ja,X,aa){switch(aa){case "+":return ja+X;case "-":return ja-X;case "*":return ja*X;case "/":return ja/X}throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);
}function e(ja,X,aa){switch(aa){case "+":return X.plus({milliseconds:ja.valueInMilliseconds()});case "-":return ja.valueInMilliseconds()-X.toMillis()}throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);}function g(ja,X,aa){switch(aa){case "+":return X.plus("milliseconds",ja.valueInMilliseconds())}throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);}function d(ja,X,aa){switch(aa){case "+":return X.plus("milliseconds",ja.valueInMilliseconds())}throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);
}function f(ja,X,aa){switch(aa){case "+":return ja.plus("milliseconds",X.valueInMilliseconds());case "-":return ja.plus("milliseconds",-1*X.valueInMilliseconds())}throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);}function c(ja,X,aa){switch(aa){case "+":return X.addMilliseconds(ja.valueInMilliseconds())}throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);}function l(ja,X,aa){switch(aa){case "+":return k.SqlInterval.createFromMilliseconds(ja.valueInMilliseconds()+X.valueInMilliseconds());case "-":return k.SqlInterval.createFromMilliseconds(ja.valueInMilliseconds()-
X.valueInMilliseconds());case "*":return k.SqlInterval.createFromMilliseconds(ja.valueInMilliseconds()*X.valueInMilliseconds());case "/":return k.SqlInterval.createFromMilliseconds(ja.valueInMilliseconds()/X.valueInMilliseconds())}throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);}function w(ja,X,aa){switch(aa){case "+":return k.SqlInterval.createFromMilliseconds(ja.valueInMilliseconds()+X);case "-":return k.SqlInterval.createFromMilliseconds(ja.valueInMilliseconds()-X);case "*":return k.SqlInterval.createFromMilliseconds(ja.valueInMilliseconds()*
X);case "/":return k.SqlInterval.createFromMilliseconds(ja.valueInMilliseconds()/X)}throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);}function x(ja,X,aa){switch(aa){case "+":return k.SqlInterval.createFromMilliseconds(ja+X.valueInMilliseconds());case "-":return k.SqlInterval.createFromMilliseconds(ja-X.valueInMilliseconds());case "*":return k.SqlInterval.createFromMilliseconds(ja*X.valueInMilliseconds());case "/":return k.SqlInterval.createFromMilliseconds(ja/X.valueInMilliseconds())}throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);
}function u(ja,X,aa){switch(aa){case "+":return ja.plus("milliseconds",X.valueInMilliseconds());case "-":return ja.plus("milliseconds",-1*X.valueInMilliseconds())}throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);}function t(ja,X,aa){switch(aa){case "+":return ja.plus({milliseconds:X.valueInMilliseconds()});case "-":return ja.minus({milliseconds:X.valueInMilliseconds()})}throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);}function m(ja,X,aa){switch(aa){case "+":return ja.addMilliseconds(X.valueInMilliseconds());
case "-":return ja.addMilliseconds(-1*X.valueInMilliseconds())}throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);}function q(ja,X,aa){X*=864E5;switch(aa){case "+":return ja.plus({milliseconds:X});case "-":return ja.minus({milliseconds:X})}throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);}function r(ja,X,aa){X*=864E5;switch(aa){case "+":return ja.plus("milliseconds",X);case "-":return ja.plus("milliseconds",-1*X)}throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);}function v(ja,X,aa){X*=
864E5;switch(aa){case "+":return ja.plus("milliseconds",X);case "-":return ja.plus("milliseconds",-1*X)}throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);}function y(ja,X,aa){throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);}function B(ja,X,aa){X*=864E5;switch(aa){case "+":return ja.addMilliseconds(X);case "-":return ja.addMilliseconds(-1*X)}throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);}function z(ja,X,aa){throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);}function A(ja,X,aa){throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);
}function C(ja,X,aa){throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);}function H(ja,X,aa){X=parseFloat(X);if(isNaN(X))throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);return h(ja,X,aa)}function E(ja,X,aa){ja=parseFloat(ja);if(isNaN(ja))throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);return h(ja,X,aa)}function F(ja,X,aa){switch(aa){case "+":return ja+X}throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);}function G(ja,X,aa){throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);}
function D(ja,X,aa){throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);}function I(ja,X,aa){switch(aa){case "-":return ja.toDateTimeLuxon(X.zone).diff(X).as("days")}throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);}function J(ja,X,aa){switch(aa){case "-":return ja.toDateTimeLuxon(X.toDateTime().zone).diff(X.toDateTime()).as("days")}throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);}function N(ja,X,aa){switch(aa){case "-":return ja.toDateTimeLuxon("UTC").diff(X.toDateTimeLuxon("UTC")).as("days")}throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);
}function M(ja,X,aa){throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);}function Q(ja,X,aa){throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);}function O(ja,X,aa){switch(aa){case "-":return ja.toDateTime().diff(X.toDateTimeLuxon(ja.toDateTime().zone)).as("days")}throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);}function K(ja,X,aa){switch(aa){case "-":return ja.toDateTime().diff(X).as("days")}throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);}function L(ja,X,aa){switch(aa){case "-":return ja.toDateTime().diff(X.toDateTime()).as("days")}throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);
}function P(ja,X,aa){throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);}function R(ja,X,aa){throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);}function W(ja,X,aa){throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);}function V(ja,X,aa){throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);}function ba(ja,X,aa){switch(aa){case "-":return ja.diff(X).as("days")}throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);}function U(ja,X,aa){switch(aa){case "-":return ja.diff(X.toDateTimeLuxon(ja.zone)).as("days")}throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);
}function da(ja,X,aa){switch(aa){case "-":return ja.diff(X.toDateTime()).as("days")}throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);}function fa(ja,X,aa){throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);}function ha(ja,X,aa){throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);}function T(ja,X,aa){throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);}function S(ja,X,aa){throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);}function Z(ja,X,aa){throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);
}function ia(ja,X,aa){throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);}function Y(ja,X,aa){throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);}function ea(ja,X,aa){throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);}function ka(ja,X,aa){throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);}a.calculateDateOnlyAndDateOnly=N;a.calculateDateOnlyAndDateTime=I;a.calculateDateOnlyAndNumber=r;a.calculateDateOnlyAndSqlInterval=u;a.calculateDateOnlyAndString=ha;a.calculateDateOnlyAndTimeOnly=M;
a.calculateDateOnlyAndTimestamp=J;a.calculateDateTimeAndDateOnly=U;a.calculateDateTimeAndDateTime=ba;a.calculateDateTimeAndNumber=q;a.calculateDateTimeAndSqlInterval=t;a.calculateDateTimeAndString=S;a.calculateDateTimeAndTimeOnly=fa;a.calculateDateTimeAndTimestamp=da;a.calculateNumberAndDateOnly=C;a.calculateNumberAndDateTime=y;a.calculateNumberAndNumber=h;a.calculateNumberAndSqlInterval=x;a.calculateNumberAndString=H;a.calculateNumberAndTimeOnly=A;a.calculateNumberAndTimestamp=z;a.calculateSqlIntervalAndDateOnly=
d;a.calculateSqlIntervalAndDateTime=e;a.calculateSqlIntervalAndNumber=w;a.calculateSqlIntervalAndSqlInterval=l;a.calculateSqlIntervalAndString=G;a.calculateSqlIntervalAndTimeOnly=g;a.calculateSqlIntervalAndTimestamp=c;a.calculateStringAndDateOnly=Y;a.calculateStringAndDateTime=ea;a.calculateStringAndNumber=E;a.calculateStringAndSqlInterval=D;a.calculateStringAndString=F;a.calculateStringAndTimeOnly=ia;a.calculateStringAndTimestamp=ka;a.calculateTimeOnlyAndDateOnly=R;a.calculateTimeOnlyAndDateTime=
P;a.calculateTimeOnlyAndNumber=v;a.calculateTimeOnlyAndSqlInterval=f;a.calculateTimeOnlyAndString=T;a.calculateTimeOnlyAndTimeOnly=V;a.calculateTimeOnlyAndTimestamp=W;a.calculateTimestampAndDateOnly=O;a.calculateTimestampAndDateTime=K;a.calculateTimestampAndNumber=B;a.calculateTimestampAndSqlInterval=m;a.calculateTimestampAndString=Z;a.calculateTimestampAndTimeOnly=Q;a.calculateTimestampAndTimestamp=L;a.sqlCalculateFunction=function(ja,X,aa,pa){if("||"===ja)return p.evaluateFunction("concat",[X,aa],
pa);if(null===X||null===aa)return null;if(n.isNumber(X)){if(n.isNumber(aa))return h(X,aa,ja);if(n.isSqlInterval(aa))return x(X,aa,ja);if(n.isTimeOnly(aa))return A();if(n.isDateOnly(aa))return C();if(n.isTimestampOffset(aa))return z();if(n.isDateTime(aa))return y();if(n.isString(aa))return H(X,aa,ja)}else if(n.isDateOnly(X)){if(n.isNumber(aa))return r(X,aa,ja);if(n.isSqlInterval(aa))return u(X,aa,ja);if(n.isTimeOnly(aa))return M();if(n.isDateOnly(aa))return N(X,aa,ja);if(n.isTimestampOffset(aa))return J(X,
aa,ja);if(n.isDateTime(aa))return I(X,aa,ja);if(n.isString(aa))return ha()}else if(n.isTimeOnly(X)){if(n.isNumber(aa))return v(X,aa,ja);if(n.isSqlInterval(aa))return f(X,aa,ja);if(n.isTimeOnly(aa))return V();if(n.isDateOnly(aa))return R();if(n.isTimestampOffset(aa))return W();if(n.isDateTime(aa))return P();if(n.isString(aa))return T()}else if(n.isSqlInterval(X)){if(n.isNumber(aa))return w(X,aa,ja);if(n.isSqlInterval(aa))return l(X,aa,ja);if(n.isTimeOnly(aa))return g(X,aa,ja);if(n.isDateOnly(aa))return d(X,
aa,ja);if(n.isTimestampOffset(aa))return c(X,aa,ja);if(n.isDateTime(aa))return e(X,aa,ja);if(n.isString(aa))return G()}else if(n.isDateTime(X)){if(n.isNumber(aa))return q(X,aa,ja);if(n.isSqlInterval(aa))return t(X,aa,ja);if(n.isTimeOnly(aa))return fa();if(n.isDateOnly(aa))return U(X,aa,ja);if(n.isTimestampOffset(aa))return da(X,aa,ja);if(n.isDateTime(aa))return ba(X,aa,ja);if(n.isString(aa))return S()}else if(n.isTimestampOffset(X)){if(n.isNumber(aa))return B(X,aa,ja);if(n.isSqlInterval(aa))return m(X,
aa,ja);if(n.isTimeOnly(aa))return Q();if(n.isDateOnly(aa))return O(X,aa,ja);if(n.isTimestampOffset(aa))return L(X,aa,ja);if(n.isDateTime(aa))return K(X,aa,ja);if(n.isString(aa))return Z()}else if(n.isString(X)){if(n.isNumber(aa))return E(X,aa,ja);if(n.isSqlInterval(aa))return D();if(n.isTimeOnly(aa))return ia();if(n.isDateOnly(aa))return Y();if(n.isTimestampOffset(aa))return ka();if(n.isDateTime(aa))return ea();if(n.isString(aa))return F(X,aa,ja)}throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);
};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/sql/sqlDateParsingUtils":function(){define("exports ./DateOnly ./errorSupport ./SqlInterval ./SqlTimestampOffset ./TimeOnly ./UnknownTimeZone ../../chunks/datetime".split(" "),function(a,b,n,k,p,h,e,g){function d(q,r,v){v=x.exec(q);if(null!==v){const [,y,B,z,A,C,H,E]=v;q=g.DateTime.fromObject({year:parseInt(y,10),month:parseInt(B,10),day:parseInt(z,10),hour:parseInt(A,10),minute:parseInt(C,10),second:parseInt(H,10),millisecond:E?
parseInt(E.replace(".",""),10):0},{zone:e.substituteUnknownTimezone(r)});if(!1===q.isValid)throw new n.SqlError(n.SqlErrorCodes.InvalidTimeStamp);return q}v=u.exec(q);if(null!==v){const [,y,B,z,A,C,H,E,F,G,D]=v;q=p.SqlTimeStampOffset.fromParts(parseInt(y,10),parseInt(B,10),parseInt(z,10),parseInt(A,10),parseInt(C,10),parseInt(H,10),E?parseInt(E.replace(".",""),10):0,"-"===F,parseInt(G,10),parseInt(D,10));if(!1===q.isValid)throw new n.SqlError(n.SqlErrorCodes.InvalidTimeStamp);return q}v=t.exec(q);
if(null!==v){const [,y,B,z,A,C,H,E,F]=v;q=p.SqlTimeStampOffset.fromParts(parseInt(y,10),parseInt(B,10),parseInt(z,10),parseInt(A,10),parseInt(C,10),0,0,"-"===H,parseInt(E,10),parseInt(F,10));if(!1===q.isValid)throw new n.SqlError(n.SqlErrorCodes.InvalidTimeStamp);return q}v=m.exec(q);if(null!==v){const [,y,B,z,A,C]=v;q=g.DateTime.fromObject({year:parseInt(y,10),month:parseInt(B,10),day:parseInt(z,10),hour:parseInt(A,10),minute:parseInt(C,10),second:0},{zone:e.substituteUnknownTimezone(r)});if(!1===
q.isValid)throw new n.SqlError(n.SqlErrorCodes.InvalidTimeStamp);return q}v=w.exec(q);if(null!==v){const [,y,B,z]=v;q=g.DateTime.fromObject({year:parseInt(y,10),month:parseInt(B,10),day:parseInt(z,10),hour:0,minute:0,second:0},{zone:e.substituteUnknownTimezone(r)});if(!1===q.isValid)throw new n.SqlError(n.SqlErrorCodes.InvalidTimeStamp);return q}throw new n.SqlError(n.SqlErrorCodes.InvalidTimeStamp);}const f=/^(\d{1,2}):(\d{1,2}):(\d{1,2})$/,c=/^(\d{1,2}):(\d{1,2})$/,l=/^(\d{1,2}):(\d{1,2}):(\d{1,2}).([0-9]+)$/,
w=/^(\d{4})-(\d{1,2})-(\d{1,2})$/,x=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2}):(\d{1,2})(\.[0-9]+)?$/,u=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2}):(\d{1,2})(\.[0-9]+)?[ ]{0,1}(\+|-)(\d{1,2}):(\d{1,2})$/,t=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2})?[ ]{0,1}(\+|-)(\d{1,2}):(\d{1,2})$/,m=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2})$/;a.convertToExecutingTimeZone=function(q,r){if(r instanceof g.Zone)return r===e.UnknownTimeZone.instance?g.DateTime.fromMillis(q.getTime(),{zone:e.UnknownTimeZone.instance}):
g.DateTime.fromJSDate(q,{zone:r});switch(r){case "system":case "local":case null:return g.DateTime.fromJSDate(q);default:return"unknown"===r?.toLowerCase()?g.DateTime.fromMillis(q.getTime(),{zone:e.UnknownTimeZone.instance}):g.DateTime.fromJSDate(q,{zone:r})}};a.isDate=function(q){return q instanceof Date};a.isDateOnly=function(q){return q instanceof b.DateOnly};a.isDateTime=function(q){return q instanceof g.DateTime};a.isNumber=function(q){return"number"===typeof q};a.isSqlInterval=function(q){return q instanceof
k.SqlInterval};a.isString=function(q){return"string"===typeof q||q instanceof String};a.isTimeOnly=function(q){return q instanceof h.TimeOnly};a.isTimestampOffset=function(q){return q instanceof p.SqlTimeStampOffset};a.parseDate=function(q,r){const v=w.exec(q);if(null===v)try{return d(q,r)}catch{throw new n.SqlError(n.SqlErrorCodes.InvalidDate);}const [,y,B,z]=v;q=b.DateOnly.fromParts(parseInt(y,10),parseInt(B,10),parseInt(z,10));if(null===q)throw new n.SqlError(n.SqlErrorCodes.InvalidDate);return q};
a.parseTime=function(q){let r=f.exec(q);if(null!==r){const [,v,y,B]=r;q=h.TimeOnly.fromParts(parseInt(v,10),parseInt(y,10),parseInt(B,10),0);if(null!==q)return q;throw new n.SqlError(n.SqlErrorCodes.InvalidTime);}r=c.exec(q);if(null!==r){const [,v,y]=r;q=h.TimeOnly.fromParts(parseInt(v,10),parseInt(y,10),0,0);if(null!==q)return q;throw new n.SqlError(n.SqlErrorCodes.InvalidTime);}r=l.exec(q);if(null!==r){const [,v,y,B,z]=r;q=h.TimeOnly.fromParts(parseInt(v,10),parseInt(y,10),parseInt(B,10),parseInt(z,
10));if(null!==q)return q}throw new n.SqlError(n.SqlErrorCodes.InvalidTime);};a.parseTimestamp=d;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/sql/SqlInterval":function(){define(["exports","./errorSupport"],function(a,b){class n{constructor(){this.op="+";this.millis=this.minute=this.year=this.month=this.hour=this.second=this.day=0}static _fixDefaults(k){if(null!==k.precision||null!==k.secondary)throw new b.SqlError(b.SqlErrorCodes.PrimarySecondaryQualifiers);}static _parseSecondsComponent(k,
p){p.includes(".")?(p=p.split("."),k.second=parseFloat(p[0]),k.millis=parseInt(p[1],10)):k.second=parseFloat(p)}static createFromMilliseconds(k){const p=new n;p.second=k/1E3;return p}static createFromValueAndQualifier(k,p,h){let e=null;const g=new n;g.op="-"===h?"-":"+";if("interval-period"===p.type){n._fixDefaults(p);h=RegExp("^[0-9]{1,}$");if("year"===p.period||"month"===p.period)throw new b.SqlError(b.SqlErrorCodes.YearMonthIntervals);if("second"===p.period)if(/^[0-9]{1,}([.]{1}[0-9]{1,}){0,1}$/.test(k))n._parseSecondsComponent(g,
k);else throw new b.SqlError(b.SqlErrorCodes.IllegalInterval);else if(h.test(k))g[p.period]=parseFloat(k);else throw new b.SqlError(b.SqlErrorCodes.IllegalInterval);}else{n._fixDefaults(p.start);n._fixDefaults(p.end);if("year"===p.start.period||"month"===p.start.period||"year"===p.end.period||"month"===p.end.period)throw new b.SqlError(b.SqlErrorCodes.YearMonthIntervals);switch(p.start.period){case "day":switch(p.end.period){case "hour":e=RegExp("^[0-9]{1,} [0-9]{1,}$");if(e.test(k))g[p.start.period]=
parseFloat(k.split(" ")[0]),g[p.end.period]=parseFloat(k.split(" ")[1]);else throw new b.SqlError(b.SqlErrorCodes.IllegalInterval);break;case "minute":e=RegExp("^[0-9]{1,} [0-9]{1,2}:[0-9]{1,}$");if(e.test(k))g[p.start.period]=parseFloat(k.split(" ")[0]),k=k.split(" ")[1].split(":"),g.hour=parseFloat(k[0]),g.minute=parseFloat(k[1]);else throw new b.SqlError(b.SqlErrorCodes.IllegalInterval);break;case "second":e=RegExp("^[0-9]{1,} [0-9]{1,2}:[0-9]{1,2}:[0-9]{1,}([.]{1}[0-9]{1,}){0,1}$");if(e.test(k))g[p.start.period]=
parseFloat(k.split(" ")[0]),k=k.split(" ")[1].split(":"),g.hour=parseFloat(k[0]),g.minute=parseFloat(k[1]),n._parseSecondsComponent(g,k[2]);else throw new b.SqlError(b.SqlErrorCodes.IllegalInterval);break;default:throw new b.SqlError(b.SqlErrorCodes.IllegalInterval);}break;case "hour":switch(p.end.period){case "minute":e=RegExp("^[0-9]{1,}:[0-9]{1,}$");if(e.test(k))g.hour=parseFloat(k.split(":")[0]),g.minute=parseFloat(k.split(":")[1]);else throw new b.SqlError(b.SqlErrorCodes.IllegalInterval);break;
case "second":e=RegExp("^[0-9]{1,}:[0-9]{1,2}:[0-9]{1,}([.]{1}[0-9]{1,}){0,1}$");if(e.test(k))k=k.split(":"),g.hour=parseFloat(k[0]),g.minute=parseFloat(k[1]),n._parseSecondsComponent(g,k[2]);else throw new b.SqlError(b.SqlErrorCodes.IllegalInterval);break;default:throw new b.SqlError(b.SqlErrorCodes.IllegalInterval);}break;case "minute":switch(p.end.period){case "second":e=RegExp("^[0-9]{1,}:[0-9]{1,}([.]{1}[0-9]{1,}){0,1}$");if(e.test(k))k=k.split(":"),g.minute=parseFloat(k[0]),n._parseSecondsComponent(g,
k[1]);else throw new b.SqlError(b.SqlErrorCodes.IllegalInterval);break;default:throw new b.SqlError(b.SqlErrorCodes.IllegalInterval);}break;default:throw new b.SqlError(b.SqlErrorCodes.IllegalInterval);}}return g}valueInMilliseconds(){return("-"===this.op?-1:1)*(this.millis+1E3*this.second+6E4*this.minute+36E5*this.hour+864E5*this.day+365/12*this.month*864E5+31536E6*this.year)}}a.SqlInterval=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/sql/StandardizedFunctions":function(){define("exports ../mathUtils ../string ./DateOnly ./errorSupport ./sqlCompareUtils ./sqlDateParsingUtils ./TimeOnly ../../chunks/datetime".split(" "),
function(a,b,n,k,p,h,e,g,d){function f(m){return"string"===typeof m||m instanceof String}function c(m){return e.isDate(m)||e.isDateOnly(m)||e.isDateTime(m)||e.isTimeOnly(m)||e.isTimestampOffset(m)?!1:!0}function l(m){return e.isDateOnly(m)||e.isTimeOnly(m)?m.toString():e.isTimestampOffset(m)?m.toSQLValue():e.isDateTime(m)?0===m.millisecond?m.toFormat("yyyy-LL-dd HH:mm:ss"):m.toSQL({includeOffset:!1}):e.isDate(m)?l(d.DateTime.fromJSDate(m)):m.toString()}function w(m){if(e.isDate(m))return k.DateOnly.fromDateJS(m);
if(e.isDateTime(m))return k.DateOnly.fromParts(m.year,m.month,m.day);if(e.isDateOnly(m))return m;if(e.isTimeOnly(m))throw new p.SqlError(p.SqlErrorCodes.CannotCastValue);if(e.isTimestampOffset(m)&&null===k.DateOnly.fromParts(m.year,m.month,m.day))throw new p.SqlError(p.SqlErrorCodes.CannotCastValue);if(f(m)&&(m=k.DateOnly.fromReader(m),null!==m&&m.isValid))return m;throw new p.SqlError(p.SqlErrorCodes.CannotCastValue);}function x(m,q,r){if(e.isDate(m))return e.convertToExecutingTimeZone(m,q);if(e.isDateTime(m))return m;
if(e.isDateOnly(m))return m.toDateTimeLuxon("unknown");if(e.isTimeOnly(m))throw new p.SqlError(p.SqlErrorCodes.CannotCastValue);if(e.isTimestampOffset(m))return m;if(f(m))return e.parseTimestamp(m,"unknown",r);throw new p.SqlError(p.SqlErrorCodes.CannotCastValue);}function u(m){if(e.isDate(m))return g.TimeOnly.fromDateJS(m);if(e.isDateTime(m))return g.TimeOnly.fromDateTime(m);if(e.isDateOnly(m))throw new p.SqlError(p.SqlErrorCodes.CannotCastValue);if(e.isTimeOnly(m))return m;if(e.isTimestampOffset(m))return g.TimeOnly.fromSqlTimeStampOffset(m);
if(f(m))return e.parseTime(m);throw new p.SqlError(p.SqlErrorCodes.CannotCastValue);}const t={extract:{minParams:2,maxParams:2,evaluate:([m,q])=>{if(null==q)return null;if(e.isDate(q))switch(m.toUpperCase()){case "SECOND":return q.getSeconds();case "MINUTE":return q.getMinutes();case "HOUR":return q.getHours();case "DAY":return q.getDate();case "MONTH":return q.getMonth()+1;case "YEAR":return q.getFullYear();case "TIMEZONE_HOUR":return 0;case "TIMEZONE_MINUTE":return 0}else if(e.isDateTime(q))switch(m.toUpperCase()){case "SECOND":return q.second;
case "MINUTE":return q.minute;case "HOUR":return q.hour;case "DAY":return q.day;case "MONTH":return q.month;case "YEAR":return q.year}else if(e.isDateOnly(q))switch(m.toUpperCase()){case "DAY":return q.day;case "MONTH":return q.month;case "YEAR":return q.year}else if(e.isTimeOnly(q))switch(m.toUpperCase()){case "SECOND":return q.second;case "MINUTE":return q.minute;case "HOUR":return q.hour}else if(e.isTimestampOffset(q))switch(m.toUpperCase()){case "SECOND":return q.second;case "MINUTE":return q.minute;
case "HOUR":return q.hour;case "DAY":return q.day;case "MONTH":return q.month;case "YEAR":return q.year;case "TIMEZONE_HOUR":return q.timezoneOffsetHour;case "TIMEZONE_MINUTE":return q.timezoneOffsetMinutes}throw new p.SqlError(p.SqlErrorCodes.InvalidFunctionParameters,{function:"EXTRACT"});}},substring:{minParams:2,maxParams:3,evaluate:m=>{if(2===m.length){const [q,r]=m;return null==q||null==r?null:q.toString().substring(r-1)}if(3===m.length){const [q,r,v]=m;return null==q||null==r||null==v?null:
0>=v?"":q.toString().substring(r-1,r+v-1)}}},position:{minParams:2,maxParams:2,evaluate:([m,q])=>null==m||null==q?null:q.indexOf(m)+1},trim:{minParams:2,maxParams:3,evaluate:m=>{var q=3===m.length,r=q?m[1]:" ";q=q?m[2]:m[1];if(null==r||null==q)return null;r=`(${n.escapeRegExpString(r)})`;switch(m[0]){case "BOTH":return q.replaceAll(new RegExp(`^${r}*|${r}*$`,"g"),"");case "LEADING":return q.replaceAll(new RegExp(`^${r}*`,"g"),"");case "TRAILING":return q.replaceAll(new RegExp(`${r}*$`,"g"),"")}throw new p.SqlError(p.SqlErrorCodes.InvalidFunctionParameters,
{function:"TRIM"});}},abs:{minParams:1,maxParams:1,evaluate:m=>null==m[0]?null:Math.abs(m[0])},ceiling:{minParams:1,maxParams:1,evaluate:m=>null==m[0]?null:Math.ceil(m[0])},floor:{minParams:1,maxParams:1,evaluate:m=>null==m[0]?null:Math.floor(m[0])},log:{minParams:1,maxParams:1,evaluate:m=>null==m[0]?null:Math.log(m[0])},log10:{minParams:1,maxParams:1,evaluate:m=>null==m[0]?null:Math.log(m[0])*Math.LOG10E},sin:{minParams:1,maxParams:1,evaluate:m=>null==m[0]?null:Math.sin(m[0])},cos:{minParams:1,maxParams:1,
evaluate:m=>null==m[0]?null:Math.cos(m[0])},tan:{minParams:1,maxParams:1,evaluate:m=>null==m[0]?null:Math.tan(m[0])},asin:{minParams:1,maxParams:1,evaluate:m=>null==m[0]?null:Math.asin(m[0])},acos:{minParams:1,maxParams:1,evaluate:m=>null==m[0]?null:Math.acos(m[0])},atan:{minParams:1,maxParams:1,evaluate:m=>null==m[0]?null:Math.atan(m[0])},sign:{minParams:1,maxParams:1,evaluate:m=>null==m[0]?null:0<m[0]?1:0>m[0]?-1:0},power:{minParams:2,maxParams:2,evaluate:m=>null==m[0]||null==m[1]?null:m[0]**m[1]},
mod:{minParams:2,maxParams:2,evaluate:m=>null==m[0]||null==m[1]?null:m[0]%m[1]},round:{minParams:1,maxParams:2,evaluate:m=>{const q=m[0];m=2===m.length?10**m[1]:1;return null==q?null:Math.round(q*m)/m}},truncate:{minParams:1,maxParams:2,evaluate:m=>null==m[0]?null:1===m.length||0===m[1]?Math.trunc(m[0]):b.decimalAdjust("trunc",m[0],-Number(m[1]))},char_length:{minParams:1,maxParams:1,evaluate:m=>f(m[0])?m[0].length:0},concat:{minParams:1,maxParams:Infinity,evaluate:m=>{let q="";for(let r=0;r<m.length;r++){if(null==
m[r])return null;q+=m[r].toString()}return q}},lower:{minParams:1,maxParams:1,evaluate:m=>null==m[0]?null:m[0].toString().toLowerCase()},upper:{minParams:1,maxParams:1,evaluate:m=>null==m[0]?null:m[0].toString().toUpperCase()},coalesce:{minParams:1,maxParams:Infinity,evaluate:m=>{for(const q of m)if(null!==q)return q;return null}},cosh:{minParams:1,maxParams:1,evaluate:m=>null==m[0]?null:Math.cosh(m[0])},sinh:{minParams:1,maxParams:1,evaluate:m=>null==m[0]?null:Math.sinh(m[0])},tanh:{minParams:1,
maxParams:1,evaluate:m=>null==m[0]?null:Math.tanh(m[0])},nullif:{minParams:2,maxParams:2,evaluate:(m,q)=>h.sqlCompare(m[0],m[1],"\x3d")?null:m[0]},cast:{minParams:2,maxParams:2,evaluate:(m,q)=>{const r=m[0];m=m[1];if(null===r)return null;switch(m.type){case "integer":if(!c(r))throw new p.SqlError(p.SqlErrorCodes.CannotCastValue);q=parseInt(r,10);if(isNaN(q))throw new p.SqlError(p.SqlErrorCodes.CannotCastValue);return q;case "smallint":if(!c(r))throw new p.SqlError(p.SqlErrorCodes.CannotCastValue);
q=parseInt(r,10);if(isNaN(q))throw new p.SqlError(p.SqlErrorCodes.CannotCastValue);if(32767<q||-32767>q)throw new p.SqlError(p.SqlErrorCodes.CannotCastValue);return q;case "float":case "real":if(!c(r))throw new p.SqlError(p.SqlErrorCodes.CannotCastValue);q=parseFloat(r);if(isNaN(q))throw new p.SqlError(p.SqlErrorCodes.CannotCastValue);return q;case "time":return u(r);case "date":return w(r);case "timestamp":return x(r,q,!0===m.withtimezone);case "varchar":q=l(r);if(q.length>m.size)throw new p.SqlError(p.SqlErrorCodes.CannotCastValue);
return q;default:throw new p.SqlError(p.SqlErrorCodes.InvalidDataType);}}}};a.evaluateFunction=function(m,q,r){const v=t[m.toLowerCase()];if(null==v)throw new p.SqlError(p.SqlErrorCodes.FunctionNotRecognized);if(q.length<v.minParams||q.length>v.maxParams)throw new p.SqlError(p.SqlErrorCodes.InvalidParameterCount,{name:m.toUpperCase()});return v.evaluate(q,r)};a.isStandardized=function(m,q){m=t[m.toLowerCase()];return null!=m&&q>=m.minParams&&q<=m.maxParams};Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/core/sql/sqlCompareUtils":function(){define("exports ./errorSupport ./sqlDateParsingUtils ./SqlTimestampOffset ./UnknownTimeZone ../../chunks/datetime".split(" "),function(a,b,n,k,p,h){function e(t){return n.isDateTime(t)||n.isTimestampOffset(t)?!0:!1}function g(t){return n.isDateTime(t)||n.isDateOnly(t)||n.isTimestampOffset(t)||n.isTimeOnly(t)?!0:!1}function d(t){if(n.isDateTime(t))return t.toMillis();if(n.isDateOnly(t))return t.toNumber();if(n.isTimestampOffset(t))return t.toMilliseconds();
throw new b.SqlError(b.SqlErrorCodes.InvalidDataType);}function f(t,m,q){switch(q){case "\x3c\x3e":return t!==m;case "\x3d":return t===m;case "\x3e":return t>m;case "\x3c":return t<m;case "\x3e\x3d":return t>=m;case "\x3c\x3d":return t<=m}}function c(t,m,q){const r=parseFloat(m);if(!isNaN(r))return f(t,r,q);t=t.toString();switch(q){case "\x3c\x3e":return t!==m;case "\x3d":return t===m;case "\x3e":return t>m;case "\x3c":return t<m;case "\x3e\x3d":return t>=m;case "\x3c\x3d":return t<=m}}function l(t,
m,q){const r=parseFloat(t);if(!isNaN(r))return f(r,m,q);m=m.toString();switch(q){case "\x3c\x3e":return t!==m;case "\x3d":return t===m;case "\x3e":return t>m;case "\x3c":return t<m;case "\x3e\x3d":return t>=m;case "\x3c\x3d":return t<=m}}function w(t,m,q){switch(q){case "\x3c\x3e":return t!==m;case "\x3d":return t===m;case "\x3e":return t>m;case "\x3c":return t<m;case "\x3e\x3d":return t>=m;case "\x3c\x3d":return t<=m}}function x(t,m,q){t instanceof k.SqlTimeStampOffset&&(t=t.toDateTime());m instanceof
k.SqlTimeStampOffset&&(m=m.toDateTime());t=u(t);m=u(m);switch(q){case "\x3c\x3e":return t!==m;case "\x3d":return t===m;case "\x3e":return t>m;case "\x3c":return t<m;case "\x3e\x3d":return t>=m;case "\x3c\x3d":return t<=m}}function u(t){return 321408E5*t.year+26784E5*t.month+864E5*t.day+36E5*t.hour+6E4*t.minute+1E3*t.second+t.millisecond}a.dateValueInMilliseconds=d;a.isDateOrTimeValue=g;a.isDateTimeComparableValue=e;a.sqlCompare=function(t,m,q,r){if(null==t||null==m)return null;if(n.isNumber(t)){if(n.isNumber(m))return f(t,
m,q);if(n.isString(m))return c(t,m,q);if(g(m))throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);if(n.isDateOnly(m))throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);}else if(n.isString(t)){if(n.isNumber(m))return l(t,m,q);if(n.isString(m))return w(t,m,q);if(n.isDateTime(m))throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);if(n.isDateOnly(m))throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);if(n.isTimeOnly(m))throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);if(n.isTimestampOffset(m))throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);
}else if(n.isDateTime(t)){if(e(m)){if(t instanceof h.DateTime&&p.isUnknownTimeZone(t.zone)){if(m instanceof h.DateTime&&!1===p.isUnknownTimeZone(m.zone)||m instanceof k.SqlTimeStampOffset)return x(t,m,q)}else if(m instanceof h.DateTime&&p.isUnknownTimeZone(m.zone)&&(t instanceof h.DateTime&&!1===p.isUnknownTimeZone(t.zone)||t instanceof k.SqlTimeStampOffset))return x(t,m,q);return f(d(t),d(m),q)}if(n.isString(m))throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);if(n.isDateOnly(m))return m=m.toDateTimeLuxon(t.zone),
t=t.startOf("day"),f(t.toMillis(),m.toMillis(),q);if(n.isTimeOnly(m))throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);if(n.isNumber(m))throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);}else if(n.isDateOnly(t)){if(n.isTimestampOffset(m))return t=t.toDateTimeLuxon(m.toDateTime().zone),m=m.startOfDay(),f(t.toMillis(),m.toMilliseconds(),q);if(n.isDateTime(m))return t=t.toDateTimeLuxon(m.zone),m=m.startOf("day"),f(t.toMillis(),m.toMillis(),q);if(n.isString(m))throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);
if(n.isDateOnly(m))return f(t.toNumber(),m.toNumber(),q);if(n.isTimeOnly(m))throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);if(n.isNumber(m))throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);}else if(n.isTimeOnly(t)){if(n.isTimeOnly(m))return f(t.toNumber(),m.toNumber(),q);if(n.isString(m))throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);if(n.isNumber(m))throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);if(n.isDateOnly(m))throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);if(e(m))throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);
}else if(n.isTimestampOffset(t)){if(e(m))return m instanceof h.DateTime&&p.isUnknownTimeZone(m.zone)?x(t,m,q):f(d(t),d(m),q);if(n.isString(m))throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);if(n.isDateOnly(m))return m=m.toDateTimeLuxon(t.toDateTime().zone),t=t.startOfDay(),f(t.toMilliseconds(),m.toMillis(),q);if(n.isTimeOnly(m))throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);if(n.isNumber(m))throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);}switch(q){case "\x3c\x3e":return t!==m;
case "\x3d":return t===m;case "\x3e":return t>m;case "\x3c":return t<m;case "\x3e\x3d":return t>=m;case "\x3c\x3d":return t<=m}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/sql/WhereGrammar":function(){define(["exports"],function(a){function b(e,g,d,f){e=Error.call(this,e);Object.setPrototypeOf&&Object.setPrototypeOf(e,b.prototype);e.expected=g;e.found=d;e.location=f;e.name="SyntaxError";return e}function n(e,g,d){d=d||" ";if(e.length>g)return e;g-=e.length;d+=d.repeat(g);
return e+d.slice(0,g)}function k(e,g){function d(){return x(gb,oa)}function f(va,wa){wa=void 0!==wa?wa:x(gb,oa);throw new b(va,null,null,wa);}function c(va,wa){return{type:"literal",text:va,ignoreCase:wa}}function l(va,wa,Ka){return{type:"class",parts:va,inverted:wa,ignoreCase:Ka}}function w(va){var wa=rd[va];if(!wa){if(va>=rd.length)var Ka=rd.length-1;else for(Ka=va;!rd[--Ka];);wa=rd[Ka];for(wa={line:wa.line,column:wa.column};Ka<va;)10===e.charCodeAt(Ka)?(wa.line++,wa.column=1):wa.column++,Ka++;
rd[va]=wa}return wa}function x(va,wa,Ka){Ka=w(va);var Ua=w(wa);return{source:cb,start:{offset:va,line:Ka.line,column:Ka.column},end:{offset:wa,line:Ua.line,column:Ua.column}}}function u(va){oa<Fc||(oa>Fc&&(Fc=oa,Je=[]),Je.push(va))}function t(){var va=oa;ma();var wa=q();wa!==ca?(ma(),gb=va,va=wa):(oa=va,va=ca);return va}function m(){var va;var wa=oa;if(La()!==ca){ma();var Ka=[];for(va=q();va!==ca;){Ka.push(va);var Ua=va=oa;var sb=ma();var tb=Da();tb!==ca?(Ua=ma(),Ua=sb=[sb,tb,Ua]):(oa=Ua,Ua=ca);Ua!==
ca?(Ua=q(),Ua===ca?(oa=va,va=ca):va=Ua):va=Ua}va=ma();Ua=Va();Ua!==ca?(gb=wa,wa=Ra(d(),...Ka)):(oa=wa,wa=ca)}else oa=wa,wa=ca;return wa}function q(){var va=oa;var wa=r();if(wa!==ca){var Ka=[];var Ua=oa;ma();var sb=pa();if(sb!==ca){ma();var tb=r();tb!==ca?(gb=Ua,Ua={op:sb,expr:tb,location:d()}):(oa=Ua,Ua=ca)}else oa=Ua,Ua=ca;for(;Ua!==ca;)Ka.push(Ua),Ua=oa,ma(),sb=pa(),sb!==ca?(ma(),tb=r(),tb!==ca?(gb=Ua,Ua={op:sb,expr:tb,location:d()}):(oa=Ua,Ua=ca)):(oa=Ua,Ua=ca);gb=va;va=Pa(wa,Ka)}else oa=va,va=
ca;return va}function r(){var va=oa;var wa=v();if(wa!==ca){var Ka=[];var Ua=oa;ma();var sb=aa();if(sb!==ca){ma();var tb=v();tb!==ca?(gb=Ua,Ua={op:sb,expr:tb,location:d()}):(oa=Ua,Ua=ca)}else oa=Ua,Ua=ca;for(;Ua!==ca;)Ka.push(Ua),Ua=oa,ma(),sb=aa(),sb!==ca?(ma(),tb=v(),tb!==ca?(gb=Ua,Ua={op:sb,expr:tb,location:d()}):(oa=Ua,Ua=ca)):(oa=Ua,Ua=ca);gb=va;va=Pa(wa,Ka)}else oa=va,va=ca;return va}function v(){var va=oa;var wa=X();if(wa===ca){wa=oa;if(33===e.charCodeAt(oa)){var Ka=xb;oa++}else Ka=ca,0===eb&&
u(Jc);if(Ka!==ca){var Ua=oa;eb++;if(61===e.charCodeAt(oa)){var sb=ya;oa++}else sb=ca,0===eb&&u(Pc);eb--;sb===ca?Ua=void 0:(oa=Ua,Ua=ca);Ua!==ca?wa=Ka=[Ka,Ua]:(oa=wa,wa=ca)}else oa=wa,wa=ca}wa!==ca?(Ka=ma(),Ua=v(),Ua!==ca?(gb=va,va={type:"unary-expression",location:d(),operator:"NOT",expr:Ua}):(oa=va,va=ca)):(oa=va,va=ca);if(va===ca){wa=oa;va=A();if(va!==ca){Ka=oa;ma();Ua=oa;sb=[];var tb=oa;ma();var Wb=y();if(Wb!==ca){ma();var lc=A();lc!==ca?(gb=tb,tb={op:Wb,expr:lc,location:d()}):(oa=tb,tb=ca)}else oa=
tb,tb=ca;if(tb!==ca)for(;tb!==ca;)sb.push(tb),tb=oa,ma(),Wb=y(),Wb!==ca?(ma(),lc=A(),lc!==ca?(gb=tb,tb={op:Wb,expr:lc,location:d()}):(oa=tb,tb=ca)):(oa=tb,tb=ca);else sb=ca;sb!==ca&&(gb=Ua,sb={type:"arithmetic",tail:sb});Ua=sb;if(Ua===ca&&(Ua=oa,sb=z(),sb!==ca?(ma(),tb=m(),tb!==ca?(gb=Ua,Ua={op:sb,right:tb}):(oa=Ua,Ua=ca)):(oa=Ua,Ua=ca),Ua===ca&&(Ua=oa,sb=z(),sb!==ca?(ma(),tb=Q(),tb!==ca?(gb=Ua,Ua={op:sb,right:tb}):(oa=Ua,Ua=ca)):(oa=Ua,Ua=ca)),Ua===ca)){Ua=oa;sb=X();if(sb!==ca)if(ma(),tb=la(),tb!==
ca){var Ld=ma();Wb=oa;lc=A();if(lc!==ca){ma();var yc=aa();yc!==ca?(ma(),sb=A(),sb!==ca?(gb=Wb,Wb=lc,Wb=Ra(d(),Wb,sb)):(oa=Wb,Wb=ca)):(oa=Wb,Wb=ca)}else oa=Wb,Wb=ca;Wb!==ca?(gb=Ua,Ua={op:"NOT"+tb,right:Wb}):(oa=Ua,Ua=ca)}else oa=Ua,Ua=ca;else oa=Ua,Ua=ca;Ua===ca&&(Ua=oa,sb=la(),sb!==ca?(ma(),tb=oa,Ld=A(),Ld!==ca?(Wb=ma(),lc=aa(),lc!==ca?(ma(),yc=A(),yc!==ca?(gb=tb,tb=Ld,Wb=yc,tb=Ra(d(),tb,Wb)):(oa=tb,tb=ca)):(oa=tb,tb=ca)):(oa=tb,tb=ca),tb!==ca?(gb=Ua,Ua={op:sb,right:tb}):(oa=Ua,Ua=ca)):(oa=Ua,Ua=
ca));Ua===ca&&(Ua=oa,sb=ka(),sb!==ca?(ma(),tb=X(),tb!==ca?(ma(),tb=A(),tb!==ca?(gb=Ua,Ua={op:sb+"NOT",right:tb}):(oa=Ua,Ua=ca)):(oa=Ua,Ua=ca)):(oa=Ua,Ua=ca),Ua===ca&&(Ua=oa,sb=ka(),sb!==ca?(ma(),tb=A(),tb!==ca?(gb=Ua,Ua={op:sb,right:tb}):(oa=Ua,Ua=ca)):(oa=Ua,Ua=ca)),Ua===ca&&(Ua=oa,sb=B(),sb!==ca?(ma(),tb=ba(),tb!==ca?(ma(),Wb=oa,lc=e.substr(oa,6),lc.toLowerCase()===pb?oa+=6:(lc=ca,0===eb&&u(Cd)),lc!==ca?(lc=oa,eb++,yc=I(),eb--,yc===ca?lc=void 0:(oa=lc,lc=ca),lc!==ca?(gb=Wb,Wb="ESCAPE"):(oa=Wb,Wb=
ca)):(oa=Wb,Wb=ca),Wb!==ca?(ma(),Wb=U(),Wb!==ca?(gb=Ua,Ua={op:sb,right:tb,escape:Wb.value}):(oa=Ua,Ua=ca)):(oa=Ua,Ua=ca)):(oa=Ua,Ua=ca)):(oa=Ua,Ua=ca),Ua===ca&&(Ua=oa,sb=B(),sb!==ca?(ma(),tb=ba(),tb!==ca?(gb=Ua,Ua={op:sb,right:tb,escape:""}):(oa=Ua,Ua=ca)):(oa=Ua,Ua=ca))))}Ua!==ca?Ka=Ua:(oa=Ka,Ka=ca);Ka===ca&&(Ka=null);gb=wa;wa=Ka;""==wa||void 0==wa||null==wa?wa=va:(Ka=null,wa=Ka="arithmetic"==wa.type?Pa(va,wa.tail):Na(wa.op,va,wa.right,wa.escape,d()))}else oa=wa,wa=ca;va=wa}return va}function y(){if(e.substr(oa,
2)===Ea){var va=Ea;oa+=2}else va=ca,0===eb&&u(Xc);va===ca&&(62===e.charCodeAt(oa)?(va=Qa,oa++):(va=ca,0===eb&&u(vd)),va===ca&&(e.substr(oa,2)===db?(va=db,oa+=2):(va=ca,0===eb&&u(je)),va===ca&&(e.substr(oa,2)===lb?(va=lb,oa+=2):(va=ca,0===eb&&u(ke)),va===ca&&(va=e.charAt(oa),uc.test(va)?oa++:(va=ca,0===eb&&u(le)),va===ca&&(e.substr(oa,2)===ub?(va=ub,oa+=2):(va=ca,0===eb&&u(wd)))))));return va}function B(){var va;var wa=va=oa;var Ka=X();if(Ka!==ca){var Ua=ma();var sb=ja();sb!==ca?wa=Ka=[Ka,Ua,sb]:(oa=
wa,wa=ca)}else oa=wa,wa=ca;wa!==ca&&(gb=va,wa=wa[0]+" "+wa[2]);va=wa;va===ca&&(va=ja());return va}function z(){var va;var wa=va=oa;var Ka=X();if(Ka!==ca){var Ua=ma();var sb=ea();sb!==ca?wa=Ka=[Ka,Ua,sb]:(oa=wa,wa=ca)}else oa=wa,wa=ca;wa!==ca&&(gb=va,wa=wa[0]+" "+wa[2]);va=wa;va===ca&&(va=ea());return va}function A(){var va=oa;var wa=H();if(wa!==ca){var Ka=[];var Ua=oa;ma();var sb=C();if(sb!==ca){ma();var tb=H();tb!==ca?(gb=Ua,Ua={op:sb,expr:tb,location:d()}):(oa=Ua,Ua=ca)}else oa=Ua,Ua=ca;for(;Ua!==
ca;)Ka.push(Ua),Ua=oa,ma(),sb=C(),sb!==ca?(ma(),tb=H(),tb!==ca?(gb=Ua,Ua={op:sb,expr:tb,location:d()}):(oa=Ua,Ua=ca)):(oa=Ua,Ua=ca);gb=va;va=Pa(wa,Ka)}else oa=va,va=ca;return va}function C(){var va=e.charAt(oa);Rb.test(va)?oa++:(va=ca,0===eb&&u(Qc));va===ca&&(e.substr(oa,2)===Oa?(va=Oa,oa+=2):(va=ca,0===eb&&u(xd)));return va}function H(){var va=oa;var wa=F();if(wa!==ca){var Ka=[];var Ua=oa;ma();var sb=E();if(sb!==ca){ma();var tb=F();tb!==ca?(gb=Ua,Ua={op:sb,expr:tb,location:d()}):(oa=Ua,Ua=ca)}else oa=
Ua,Ua=ca;for(;Ua!==ca;)Ka.push(Ua),Ua=oa,ma(),sb=E(),sb!==ca?(ma(),tb=F(),tb!==ca?(gb=Ua,Ua={op:sb,expr:tb,location:d()}):(oa=Ua,Ua=ca)):(oa=Ua,Ua=ca);gb=va;va=Pa(wa,Ka)}else oa=va,va=ca;return va}function E(){var va=e.charAt(oa);jc.test(va)?oa++:(va=ca,0===eb&&u(me));return va}function F(){var va=U();if(va===ca){var wa=oa;var Ka=oa;var Ua=T();if(Ua!==ca){var sb=S();if(sb!==ca){var tb=Z();tb!==ca?(gb=Ka,Ka=parseFloat(Ua+sb+tb)):(oa=Ka,Ka=ca)}else oa=Ka,Ka=ca}else oa=Ka,Ka=ca;Ka===ca&&(Ka=oa,Ua=T(),
Ua!==ca?(sb=S(),sb!==ca?(gb=Ka,Ka=parseFloat(Ua+sb)):(oa=Ka,Ka=ca)):(oa=Ka,Ka=ca),Ka===ca&&(Ka=oa,Ua=T(),Ua!==ca?(sb=Z(),sb!==ca?(gb=Ka,Ka=parseFloat(Ua+sb)):(oa=Ka,Ka=ca)):(oa=Ka,Ka=ca),Ka===ca&&(Ka=oa,Ua=T(),Ua!==ca&&(gb=Ka,Ua=parseFloat(Ua)),Ka=Ua)));var Wb=Ka;if(Wb!==ca){var lc=oa;eb++;var Ld=D();eb--;Ld===ca?lc=void 0:(oa=lc,lc=ca);lc!==ca?(gb=wa,wa={type:"number",location:d(),value:Wb}):(oa=wa,wa=ca)}else oa=wa,wa=ca;va=wa;if(va===ca){var yc=oa;var sd=oa;var Md=e.substr(oa,4);Md.toLowerCase()===
Db?oa+=4:(Md=ca,0===eb&&u(Tc));if(Md!==ca){var Nd=oa;eb++;var Sf=I();eb--;Sf===ca?Nd=void 0:(oa=Nd,Nd=ca);Nd!==ca?sd=Md=[Md,Nd]:(oa=sd,sd=ca)}else oa=sd,sd=ca;var Zc=sd;Zc!==ca&&(gb=yc,Zc={type:"boolean",location:d(),value:!0});yc=Zc;if(yc===ca){yc=oa;var td=oa;var Od=e.substr(oa,5);Od.toLowerCase()===ua?oa+=5:(Od=ca,0===eb&&u(Uc));if(Od!==ca){var Pd=oa;eb++;var Tf=I();eb--;Tf===ca?Pd=void 0:(oa=Pd,Pd=ca);Pd!==ca?td=Od=[Od,Pd]:(oa=td,td=ca)}else oa=td,td=ca;Zc=td;Zc!==ca&&(gb=yc,Zc={type:"boolean",
location:d(),value:!1});yc=Zc}va=yc;if(va===ca){var Uf=oa;var ud=oa;var Qd=e.substr(oa,4);Qd.toLowerCase()===zb?oa+=4:(Qd=ca,0===eb&&u(se));if(Qd!==ca){var Rd=oa;eb++;var Vf=I();eb--;Vf===ca?Rd=void 0:(oa=Rd,Rd=ca);Rd!==ca?ud=Qd=[Qd,Rd]:(oa=ud,ud=ca)}else oa=ud,ud=ca;var ef=ud;ef!==ca&&(gb=Uf,ef={type:"null",location:d(),value:null});va=ef;if(va===ca){var $c=oa;if(xa()!==ca){ma();var Ke=ba();Ke!==ca?(gb=$c,"string"===Ke.type&&!0!==/^(\d{4})-(\d{1,2})-(\d{1,2})$|^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2}):(\d{1,2})(\.[0-9]+)?$|^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2}):(\d{1,2})(\.[0-9]+)?[ ]{0,1}(\+|\-)(\d{1,2}):(\d{1,2})$|^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2})?[ ]{0,1}(\+|\-)(\d{1,2}):(\d{1,2})$|^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2})$/.test(Ke.value)&&
f("Date literal is invalid"),$c={type:"date",location:d(),value:Ke.value}):(oa=$c,$c=ca)}else oa=$c,$c=ca;va=$c;if(va===ca){var ad=oa;if(sa()!==ca){ma();var Le=ba();Le!==ca?(gb=ad,"string"===Le.type&&!0!==/^(\d{4})-(\d{1,2})-(\d{1,2})$|^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2}):(\d{1,2})(\.[0-9]+)?$|^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2}):(\d{1,2})(\.[0-9]+)?[ ]{0,1}(\+|\-)(\d{1,2}):(\d{1,2})$|^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2})?[ ]{0,1}(\+|\-)(\d{1,2}):(\d{1,2})$|^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2})$/.test(Le.value)&&
f("Timestamp literal is invalid"),ad={type:"timestamp",location:d(),value:Le.value}):(oa=ad,ad=ca)}else oa=ad,ad=ca;va=ad;if(va===ca){var pc=oa;var ff=Ba();if(ff!==ca){ma();var bd=e.charAt(oa);Rb.test(bd)?oa++:(bd=ca,0===eb&&u(Qc));if(bd!==ca){ma();var Sd=ba();if(Sd!==ca){ma();var Hf=P();if(Hf!==ca){gb=pc;var Wf=bd,Xf=Sd;pc={type:"interval",location:d(),value:Xf,qualifier:Hf,op:Wf}}else oa=pc,pc=ca}else oa=pc,pc=ca}else oa=pc,pc=ca}else oa=pc,pc=ca;if(pc===ca)if(pc=oa,ff=Ba(),ff!==ca)if(ma(),bd=ba(),
bd!==ca)if(ma(),Sd=P(),Sd!==ca){gb=pc;var Yf=bd,Zf=Sd;pc={type:"interval",location:d(),value:Yf,qualifier:Zf,op:""}}else oa=pc,pc=ca;else oa=pc,pc=ca;else oa=pc,pc=ca;va=pc;if(va===ca){var cd=oa;if(ta()!==ca){ma();var Me=ba();Me!==ca?(gb=cd,"string"===Me.type&&!0!==/^(\d{1,2}):(\d{1,2}):(\d{1,2})$|^(\d{1,2}):(\d{1,2})$|^(\d{1,2}):(\d{1,2}):(\d{1,2}).([0-9]+)$/.test(Me.value)&&f("Time literal is invalid"),cd={type:"time",location:d(),value:Me.value}):(oa=cd,cd=ca)}else oa=cd,cd=ca;va=cd}}}}}}}var fc=
va;if(fc===ca){var dd=oa;if(qa()!==ca){ma();var gc=oa;var gf=La();if(gf!==ca){ma();var Td=L();if(Td!==ca){ma();var hf=na();if(hf!==ca){ma();var Ud=q();if(Ud!==ca){ma();var jf=Va();if(jf!==ca){gb=gc;var $f=Td,ag=Ud;gc=Ra(d(),$f,ag)}else oa=gc,gc=ca}else oa=gc,gc=ca}else oa=gc,gc=ca}else oa=gc,gc=ca}else oa=gc,gc=ca;if(gc===ca)if(gc=oa,gf=La(),gf!==ca)if(ma(),Td=L(),Td!==ca)if(ma(),hf=Da(),hf!==ca)if(ma(),Ud=q(),Ud!==ca)if(ma(),jf=Va(),jf!==ca){gb=gc;var bg=Td,cg=Ud;gc=Ra(d(),bg,cg)}else oa=gc,gc=ca;
else oa=gc,gc=ca;else oa=gc,gc=ca;else oa=gc,gc=ca;else oa=gc,gc=ca;if(gc!==ca){gb=dd;var dg=gc;dd={type:"function",location:d(),name:"extract",args:dg}}else oa=dd,dd=ca}else oa=dd,dd=ca;fc=dd;if(fc===ca){var ed=oa;var fd=oa;var kf=e.substr(oa,9);kf.toLowerCase()===Ob?oa+=9:(kf=ca,0===eb&&u(we));if(kf!==ca){var Ne=oa;eb++;var eg=I();eb--;eg===ca?Ne=void 0:(oa=Ne,Ne=ca);Ne!==ca?(gb=fd,fd="SUBSTRING"):(oa=fd,fd=ca)}else oa=fd,fd=ca;if(fd!==ca){ma();var Zb=oa;var lf=La();if(lf!==ca){ma();var Vd=q();
if(Vd!==ca){ma();var mf=na();if(mf!==ca){ma();var Wd=q();if(Wd!==ca){ma();var Kc=oa;var gd=oa;var nf=e.substr(oa,3);nf.toLowerCase()===Eb?oa+=3:(nf=ca,0===eb&&u(ve));if(nf!==ca){var Oe=oa;eb++;var fg=I();eb--;fg===ca?Oe=void 0:(oa=Oe,Oe=ca);Oe!==ca?(gb=gd,gd="FOR"):(oa=gd,gd=ca)}else oa=gd,gd=ca;var Pe=gd;if(Pe!==ca){var of=ma();var Qe=q();Qe!==ca?(ma(),Kc=Qe):(oa=Kc,Kc=ca)}else oa=Kc,Kc=ca;Kc===ca&&(Kc=null);Pe=Va();if(Pe!==ca){gb=Zb;var gg=Vd,hg=Wd,If=Kc;Zb=Ra(d(),gg,hg,...(If?[If]:[]))}else oa=
Zb,Zb=ca}else oa=Zb,Zb=ca}else oa=Zb,Zb=ca}else oa=Zb,Zb=ca}else oa=Zb,Zb=ca;if(Zb===ca)if(Zb=oa,lf=La(),lf!==ca)if(ma(),Vd=q(),Vd!==ca)if(ma(),mf=Da(),mf!==ca)if(ma(),Wd=q(),Wd!==ca)if(ma(),Kc=Da(),Kc!==ca)if(Pe=ma(),of=q(),of!==ca)if(Qe=Va(),Qe!==ca){gb=Zb;var ig=Vd,jg=Wd,kg=of;Zb=Ra(d(),ig,jg,kg)}else oa=Zb,Zb=ca;else oa=Zb,Zb=ca;else oa=Zb,Zb=ca;else oa=Zb,Zb=ca;else oa=Zb,Zb=ca;else oa=Zb,Zb=ca;else oa=Zb,Zb=ca;if(Zb!==ca){gb=ed;var lg=Zb;ed={type:"function",location:d(),name:"substring",args:lg}}else oa=
ed,ed=ca}else oa=ed,ed=ca;fc=ed;if(fc===ca){var hd=oa;var id=oa;var pf=e.substr(oa,4);pf.toLowerCase()===Tb?oa+=4:(pf=ca,0===eb&&u(ye));if(pf!==ca){var Re=oa;eb++;var mg=I();eb--;mg===ca?Re=void 0:(oa=Re,Re=ca);Re!==ca?(gb=id,id="TRIM"):(oa=id,id=ca)}else oa=id,id=ca;if(id!==ca){ma();var mc=oa;var qf=La();if(qf!==ca){ma();var rf=K();ma();var Xd=q();if(Xd!==ca){ma();var sf=na();if(sf!==ca){ma();var Jf=q();if(Jf!==ca){ma();var ng=Va();if(ng!==ca){gb=mc;var og=rf,pg=Xd;mc=Ra(d(),og,pg,Jf)}else oa=mc,
mc=ca}else oa=mc,mc=ca}else oa=mc,mc=ca}else oa=mc,mc=ca}else oa=mc,mc=ca;if(mc===ca)if(mc=oa,qf=La(),qf!==ca)if(ma(),rf=K(),ma(),Xd=q(),Xd!==ca)if(ma(),sf=Va(),sf!==ca){gb=mc;var qg=rf,rg=Xd;mc=Ra(d(),qg,rg)}else oa=mc,mc=ca;else oa=mc,mc=ca;else oa=mc,mc=ca;if(mc!==ca){gb=hd;var sg=mc;hd={type:"function",location:d(),name:"trim",args:sg}}else oa=hd,hd=ca}else oa=hd,hd=ca;fc=hd;if(fc===ca){var jd=oa;var kd=oa;var tf=e.substr(oa,8);tf.toLowerCase()===mb?oa+=8:(tf=ca,0===eb&&u(ze));if(tf!==ca){var Se=
oa;eb++;var tg=I();eb--;tg===ca?Se=void 0:(oa=Se,Se=ca);Se!==ca?(gb=kd,kd="POSITION"):(oa=kd,kd=ca)}else oa=kd,kd=ca;if(kd!==ca){ma();var hc=oa;var uf=La();if(uf!==ca){ma();var Yd=q();if(Yd!==ca){ma();var vf=ea();if(vf!==ca){ma();var Zd=q();if(Zd!==ca){ma();var wf=Va();if(wf!==ca){gb=hc;var ug=Yd,vg=Zd;hc=Ra(d(),ug,vg)}else oa=hc,hc=ca}else oa=hc,hc=ca}else oa=hc,hc=ca}else oa=hc,hc=ca}else oa=hc,hc=ca;if(hc===ca)if(hc=oa,uf=La(),uf!==ca)if(ma(),Yd=q(),Yd!==ca)if(ma(),vf=Da(),vf!==ca)if(ma(),Zd=q(),
Zd!==ca)if(ma(),wf=Va(),wf!==ca){gb=hc;var wg=Yd,xg=Zd;hc=Ra(d(),wg,xg)}else oa=hc,hc=ca;else oa=hc,hc=ca;else oa=hc,hc=ca;else oa=hc,hc=ca;else oa=hc,hc=ca;if(hc!==ca){gb=jd;var yg=hc;jd={type:"function",location:d(),name:"position",args:yg}}else oa=jd,jd=ca}else oa=jd,jd=ca;fc=jd;if(fc===ca){var ld=oa;var md=oa;var xf=e.substr(oa,4);xf.toLowerCase()===rb?oa+=4:(xf=ca,0===eb&&u(De));if(xf!==ca){var Te=oa;eb++;var zg=I();eb--;zg===ca?Te=void 0:(oa=Te,Te=ca);Te!==ca?(gb=md,md="CAST"):(oa=md,md=ca)}else oa=
md,md=ca;if(md!==ca){ma();var ic=oa;var yf=La();if(yf!==ca){ma();var $d=q();if($d!==ca){ma();var nd=oa;var zf=e.substr(oa,2);zf.toLowerCase()===vb?oa+=2:(zf=ca,0===eb&&u(Ee));if(zf!==ca){var Ue=oa;eb++;var Ag=I();eb--;Ag===ca?Ue=void 0:(oa=Ue,Ue=ca);Ue!==ca?(gb=nd,nd="AS"):(oa=nd,nd=ca)}else oa=nd,nd=ca;var Af=nd;if(Af!==ca){ma();var ae=O();if(ae!==ca){ma();var Bf=Va();if(Bf!==ca){gb=ic;var Bg=$d,Cg=ae;ic=Ra(d(),Bg,Cg)}else oa=ic,ic=ca}else oa=ic,ic=ca}else oa=ic,ic=ca}else oa=ic,ic=ca}else oa=ic,
ic=ca;if(ic===ca)if(ic=oa,yf=La(),yf!==ca)if(ma(),$d=q(),$d!==ca)if(ma(),Af=Da(),Af!==ca)if(ma(),ae=O(),ae!==ca)if(ma(),Bf=Va(),Bf!==ca){gb=ic;var Dg=$d,Eg=ae;ic=Ra(d(),Dg,Eg)}else oa=ic,ic=ca;else oa=ic,ic=ca;else oa=ic,ic=ca;else oa=ic,ic=ca;else oa=ic,ic=ca;if(ic!==ca){gb=ld;var Fg=ic;ld={type:"function",location:d(),name:"cast",args:Fg}}else oa=ld,ld=ca}else oa=ld,ld=ca;fc=ld;if(fc===ca){var Lc;var Ve=Lc=oa;eb++;var We=qa();eb--;We===ca?Ve=void 0:(oa=Ve,Ve=ca);if(Ve!==ca){var Ac=oa;var be=G();
be!==ca&&(gb=Ac);Ac=be;if(Ac===ca)if(Ac=oa,96===e.charCodeAt(oa)?(be=dc,oa++):(be=ca,0===eb&&u(Kf)),be!==ca){var Xe=[];var Gc=e.charAt(oa);Ic.test(Gc)?oa++:(Gc=ca,0===eb&&u(Lf));if(Gc!==ca)for(;Gc!==ca;)Xe.push(Gc),Gc=e.charAt(oa),Ic.test(Gc)?oa++:(Gc=ca,0===eb&&u(Lf));else Xe=ca;Xe!==ca?(96===e.charCodeAt(oa)?(Gc=dc,oa++):(Gc=ca,0===eb&&u(Kf)),Gc!==ca?(gb=Ac,Ac=Xe.join("")):(oa=Ac,Ac=ca)):(oa=Ac,Ac=ca)}else oa=Ac,Ac=ca;We=Ac;if(We!==ca){ma();var Mf=m();if(Mf!==ca){gb=Lc;var Gg=We;Lc={type:"function",
location:d(),name:Gg,args:Mf}}else oa=Lc,Lc=ca}else oa=Lc,Lc=ca}else oa=Lc,Lc=ca;fc=Lc;if(fc===ca){var qc=oa;var Cf=Sa();if(Cf!==ca){ma();var ce=q();if(ce!==ca){ma();var de=[];var nc=oa;var Cc=fa();if(Cc!==ca){var ee=ma();nc=Cc}else oa=nc,nc=ca;for(;nc!==ca;)de.push(nc),nc=oa,Cc=fa(),Cc!==ca?(ee=ma(),nc=Cc):(oa=nc,nc=ca);nc=$a();if(nc!==ca){gb=qc;var Hg=ce,Ig=de;qc={type:"case-expression",location:d(),format:"simple",operand:Hg,clauses:Ig,else:null,elseLocation:null}}else oa=qc,qc=ca}else oa=qc,qc=
ca}else oa=qc,qc=ca;if(qc===ca)if(qc=oa,Cf=Sa(),Cf!==ca)if(ma(),ce=q(),ce!==ca){ma();de=[];nc=oa;Cc=fa();Cc!==ca?(ee=ma(),nc=Cc):(oa=nc,nc=ca);for(;nc!==ca;)de.push(nc),nc=oa,Cc=fa(),Cc!==ca?(ee=ma(),nc=Cc):(oa=nc,nc=ca);nc=ha();if(nc!==ca)if(Cc=ma(),ee=$a(),ee!==ca){gb=qc;var Jg=ce,Kg=de,Nf=nc;qc={type:"case-expression",location:d(),format:"simple",operand:Jg,clauses:Kg,else:Nf.value,elseLocation:Nf.location}}else oa=qc,qc=ca;else oa=qc,qc=ca}else oa=qc,qc=ca;else oa=qc,qc=ca;var Df=qc;if(Df===ca){var rc=
oa;var Ef=Sa();if(Ef!==ca){ma();var fe=[];var oc=oa;var Dc=da();if(Dc!==ca){var ge=ma();oc=Dc}else oa=oc,oc=ca;for(;oc!==ca;)fe.push(oc),oc=oa,Dc=da(),Dc!==ca?(ge=ma(),oc=Dc):(oa=oc,oc=ca);oc=$a();if(oc!==ca){gb=rc;var Lg=fe;rc={type:"case-expression",location:d(),format:"searched",clauses:Lg,else:null,elseLocation:null}}else oa=rc,rc=ca}else oa=rc,rc=ca;if(rc===ca)if(rc=oa,Ef=Sa(),Ef!==ca){ma();fe=[];oc=oa;Dc=da();Dc!==ca?(ge=ma(),oc=Dc):(oa=oc,oc=ca);for(;oc!==ca;)fe.push(oc),oc=oa,Dc=da(),Dc!==
ca?(ge=ma(),oc=Dc):(oa=oc,oc=ca);oc=ha();if(oc!==ca)if(Dc=ma(),ge=$a(),ge!==ca){gb=rc;var Mg=fe,Of=oc;rc={type:"case-expression",location:d(),format:"searched",clauses:Mg,else:Of.value,elseLocation:Of.location}}else oa=rc,rc=ca;else oa=rc,rc=ca}else oa=rc,rc=ca;Df=rc}fc=Df;if(fc===ca){var od=oa;var Ng=oa;var Ye;var he=oa;var Pf=D();if(Pf!==ca){var Qf=[];for(Ye=J();Ye!==ca;)Qf.push(Ye),Ye=J();gb=he;he=Pf+Qf.join("")}else oa=he,he=ca;var Rf=he;Rf!==ca&&(gb=Ng);var Nc=Rf;if(Nc!==ca){gb=od;var ie=Nc;
Nc=/^CURRENT_DATE$/i.test(ie)?{type:"current-time",location:d(),mode:"date"}:/^CURRENT_TIMESTAMP$/i.test(ie)?{type:"current-time",location:d(),mode:"timestamp"}:/^CURRENT_TIME$/i.test(ie)?{type:"current-time",location:d(),mode:"time"}:/^CURRENT_USER$/i.test(ie)?{type:"current-user",location:d()}:{type:"column-reference",location:d(),table:"",column:ie}}od=Nc;if(od===ca){od=oa;var pd=oa;if(M()!==ca){var Ze;var Og=oa;var Ff=[];for(Ze=N();Ze!==ca;)Ff.push(Ze),Ze=N();gb=Og;var Pg=Ff=Ff.join("");var Qg=
M();Qg!==ca?(gb=pd,pd=Pg):(oa=pd,pd=ca)}else oa=pd,pd=ca;Nc=pd;if(Nc!==ca){gb=od;var Rg=Nc;Nc={type:"column-reference",location:d(),table:"",column:Rg,delimited:!0}}od=Nc}fc=od;if(fc===ca&&(fc=Q(),fc===ca)){fc=oa;var Sg=La();if(Sg!==ca){ma();var Gf=q();if(Gf!==ca){ma();var Tg=Va();Tg!==ca?(gb=fc,Gf.paren=!0,fc=Gf):(oa=fc,fc=ca)}else oa=fc,fc=ca}else oa=fc,fc=ca}}}}}}}}}return fc}function G(){var va;var wa=oa;var Ka=D();if(Ka!==ca){var Ua=[];for(va=I();va!==ca;)Ua.push(va),va=I();gb=wa;wa=Ka+Ua.join("")}else oa=
wa,wa=ca;return wa}function D(){var va=e.charAt(oa);vc.test(va)?oa++:(va=ca,0===eb&&u(yd));return va}function I(){var va=e.charAt(oa);zc.test(va)?oa++:(va=ca,0===eb&&u(ne));return va}function J(){var va=e.charAt(oa);wc.test(va)?oa++:(va=ca,0===eb&&u(zd));return va}function N(){var va=e.charAt(oa);wc.test(va)?oa++:(va=ca,0===eb&&u(zd));if(va===ca)if(va=oa,M()!==ca){var wa=M();wa!==ca?(gb=va,va='"'):(oa=va,va=ca)}else oa=va,va=ca;return va}function M(){var va=e.charAt(oa);Hc.test(va)?oa++:(va=ca,0===
eb&&u(oe));return va}function Q(){var va;var wa=va=oa;if(64===e.charCodeAt(oa)){var Ka=Xa;oa++}else Ka=ca,0===eb&&u(pe);if(Ka!==ca){var Ua=G();Ua!==ca?wa=Ka=[Ka,Ua]:(oa=wa,wa=ca)}else oa=wa,wa=ca;wa!==ca&&(gb=va,va=wa,wa={type:"parameter",location:d(),value:va[1]});return wa}function O(){var va=oa;var wa=oa;var Ka=e.substr(oa,7);Ka.toLowerCase()===Ab?oa+=7:(Ka=ca,0===eb&&u(Fe));if(Ka!==ca){Ka=oa;eb++;var Ua=I();eb--;Ua===ca?Ka=void 0:(oa=Ka,Ka=ca);Ka!==ca?(gb=wa,wa="INTEGER"):(oa=wa,wa=ca)}else oa=
wa,wa=ca;wa===ca&&(wa=oa,Ka=e.substr(oa,3),Ka.toLowerCase()===Bb?oa+=3:(Ka=ca,0===eb&&u(Jd)),Ka!==ca?(Ka=oa,eb++,Ua=I(),eb--,Ua===ca?Ka=void 0:(oa=Ka,Ka=ca),Ka!==ca?(gb=wa,wa="INT"):(oa=wa,wa=ca)):(oa=wa,wa=ca));wa!==ca&&(gb=va,wa={type:"data-type",location:d(),value:{type:"integer"}});va=wa;va===ca&&(wa=va=oa,Ka=e.substr(oa,8),Ka.toLowerCase()===Ib?oa+=8:(Ka=ca,0===eb&&u(Ge)),Ka!==ca?(Ka=oa,eb++,Ua=I(),eb--,Ua===ca?Ka=void 0:(oa=Ka,Ka=ca),Ka!==ca?(gb=wa,wa="SMALLINT"):(oa=wa,wa=ca)):(oa=wa,wa=ca),
wa!==ca&&(gb=va,wa={type:"data-type",location:d(),value:{type:"smallint"}}),va=wa,va===ca&&(wa=va=oa,Ka=e.substr(oa,5),Ka.toLowerCase()===Jb?oa+=5:(Ka=ca,0===eb&&u(He)),Ka!==ca?(Ka=oa,eb++,Ua=I(),eb--,Ua===ca?Ka=void 0:(oa=Ka,Ka=ca),Ka!==ca?(gb=wa,wa="FLOAT"):(oa=wa,wa=ca)):(oa=wa,wa=ca),wa!==ca&&(gb=va,wa={type:"data-type",location:d(),value:{type:"float"}}),va=wa,va===ca&&(wa=va=oa,Ka=e.substr(oa,4),Ka.toLowerCase()===Nb?oa+=4:(Ka=ca,0===eb&&u(Ie)),Ka!==ca?(Ka=oa,eb++,Ua=I(),eb--,Ua===ca?Ka=void 0:
(oa=Ka,Ka=ca),Ka!==ca?(gb=wa,wa="REAL"):(oa=wa,wa=ca)):(oa=wa,wa=ca),wa!==ca&&(gb=va,wa={type:"data-type",location:d(),value:{type:"real"}}),va=wa,va===ca&&(va=oa,wa=xa(),wa!==ca&&(gb=va,wa={type:"data-type",location:d(),value:{type:"date"}}),va=wa,va===ca&&(va=oa,wa=sa(),wa!==ca&&(gb=va,wa={type:"data-type",location:d(),value:{type:"timestamp"}}),va=wa,va===ca&&(va=oa,wa=ta(),wa!==ca&&(gb=va,wa={type:"data-type",location:d(),value:{type:"time"}}),va=wa,va===ca&&(wa=va=oa,Ka=e.substr(oa,7),Ka.toLowerCase()===
Qb?oa+=7:(Ka=ca,0===eb&&u(Kd)),Ka!==ca?(Ka=oa,eb++,Ua=I(),eb--,Ua===ca?Ka=void 0:(oa=Ka,Ka=ca),Ka!==ca?(gb=wa,wa="VARCHAR"):(oa=wa,wa=ca)):(oa=wa,wa=ca),wa!==ca?(ma(),wa=La(),wa!==ca?(ma(),wa=ia(),wa!==ca?(ma(),Ka=Va(),Ka!==ca?(gb=va,va={type:"data-type",location:d(),value:{type:"varchar",size:parseInt(wa)}}):(oa=va,va=ca)):(oa=va,va=ca)):(oa=va,va=ca)):(oa=va,va=ca))))))));return va}function K(){var va=oa;var wa=oa;var Ka=e.substr(oa,7);Ka.toLowerCase()===bb?oa+=7:(Ka=ca,0===eb&&u(Gd));if(Ka!==ca){Ka=
oa;eb++;var Ua=I();eb--;Ua===ca?Ka=void 0:(oa=Ka,Ka=ca);Ka!==ca?(gb=wa,wa="LEADING"):(oa=wa,wa=ca)}else oa=wa,wa=ca;wa===ca&&(wa=oa,Ka=e.substr(oa,8),Ka.toLowerCase()===fb?oa+=8:(Ka=ca,0===eb&&u(Id)),Ka!==ca?(Ka=oa,eb++,Ua=I(),eb--,Ua===ca?Ka=void 0:(oa=Ka,Ka=ca),Ka!==ca?(gb=wa,wa="TRAILING"):(oa=wa,wa=ca)):(oa=wa,wa=ca),wa===ca&&(wa=oa,Ka=e.substr(oa,4),Ka.toLowerCase()===kb?oa+=4:(Ka=ca,0===eb&&u(Ce)),Ka!==ca?(Ka=oa,eb++,Ua=I(),eb--,Ua===ca?Ka=void 0:(oa=Ka,Ka=ca),Ka!==ca?(gb=wa,wa="BOTH"):(oa=
wa,wa=ca)):(oa=wa,wa=ca)));wa===ca&&(wa=null);gb=va;va=wa;return wa={type:"string",location:d(),value:null==va?"BOTH":va}}function L(){var va=oa;var wa=Ia();if(wa===ca&&(wa=Ca(),wa===ca&&(wa=Ha(),wa===ca&&(wa=Ga(),wa===ca&&(wa=Aa(),wa===ca&&(wa=Ja(),wa===ca)))))){wa=oa;var Ka=e.substr(oa,13);Ka.toLowerCase()===Vb?oa+=13:(Ka=ca,0===eb&&u(Be));if(Ka!==ca){Ka=oa;eb++;var Ua=I();eb--;Ua===ca?Ka=void 0:(oa=Ka,Ka=ca);Ka!==ca?(gb=wa,wa="TIMEZONE_HOUR"):(oa=wa,wa=ca)}else oa=wa,wa=ca;wa===ca&&(wa=oa,Ka=e.substr(oa,
15),Ka.toLowerCase()===ac?oa+=15:(Ka=ca,0===eb&&u(Ug)),Ka!==ca?(Ka=oa,eb++,Ua=I(),eb--,Ua===ca?Ka=void 0:(oa=Ka,Ka=ca),Ka!==ca?(gb=wa,wa="TIMEZONE_MINUTE"):(oa=wa,wa=ca)):(oa=wa,wa=ca))}wa!==ca&&(gb=va,va=wa,wa={type:"string",location:d(),value:va});return wa}function P(){var va=oa;var wa=oa;var Ka=R();if(Ka!==ca){ma();var Ua=La();if(Ua!==ca)if(ma(),Ua=V(),Ua!==ca){ma();var sb=Va();sb!==ca?(gb=wa,wa=Ka,wa={type:"interval-period",location:d(),period:wa.value,precision:Ua,secondary:null}):(oa=wa,wa=
ca)}else oa=wa,wa=ca;else oa=wa,wa=ca}else oa=wa,wa=ca;wa===ca&&(wa=oa,Ka=R(),Ka!==ca&&(gb=wa,wa=Ka,Ka={type:"interval-period",location:d(),period:wa.value,precision:null,secondary:null}),wa=Ka);if(wa!==ca)if(ma(),Ka=oa,Ua=e.substr(oa,2),Ua.toLowerCase()===wb?oa+=2:(Ua=ca,0===eb&&u(Hd)),Ua!==ca?(Ua=oa,eb++,sb=I(),eb--,sb===ca?Ua=void 0:(oa=Ua,Ua=ca),Ua!==ca?(gb=Ka,Ka="TO"):(oa=Ka,Ka=ca)):(oa=Ka,Ka=ca),Ka!==ca){ma();Ka=oa;Ua=R();Ua!==ca&&(gb=Ka,Ka=Ua,Ua={type:"interval-period",location:d(),period:Ka.value,
precision:null,secondary:null});Ka=Ua;if(Ka===ca){Ka=oa;Ua=Ja();if(Ua!==ca)if(ma(),Ua=La(),Ua!==ca)if(ma(),Ua=V(),Ua!==ca)if(ma(),sb=Da(),sb!==ca)if(ma(),sb=W(),sb!==ca){ma();var tb=Va();tb!==ca?(gb=Ka,Ka=Ua,Ka={type:"interval-period",location:d(),period:"second",precision:Ka,secondary:sb}):(oa=Ka,Ka=ca)}else oa=Ka,Ka=ca;else oa=Ka,Ka=ca;else oa=Ka,Ka=ca;else oa=Ka,Ka=ca;else oa=Ka,Ka=ca;Ka===ca&&(Ka=oa,Ua=Ja(),Ua!==ca?(ma(),Ua=La(),Ua!==ca?(ma(),Ua=V(),Ua!==ca?(ma(),sb=Va(),sb!==ca?(gb=Ka,Ka=Ua,
Ka={type:"interval-period",location:d(),period:"second",precision:Ka,secondary:null}):(oa=Ka,Ka=ca)):(oa=Ka,Ka=ca)):(oa=Ka,Ka=ca)):(oa=Ka,Ka=ca),Ka===ca&&(Ka=oa,Ua=Ja(),Ua!==ca&&(gb=Ka,Ua={type:"interval-period",location:d(),period:"second",precision:null,secondary:null}),Ka=Ua))}Ka!==ca?(gb=va,va={type:"interval-qualifier",location:d(),start:wa,end:Ka}):(oa=va,va=ca)}else oa=va,va=ca;else oa=va,va=ca;va===ca&&(va=oa,Ka=R(),Ka!==ca?(ma(),wa=La(),wa!==ca?(ma(),wa=W(),wa!==ca?(ma(),Ua=Va(),Ua!==ca?
(gb=va,va=Ka,va={type:"interval-period",location:d(),period:va.value,precision:wa,secondary:null}):(oa=va,va=ca)):(oa=va,va=ca)):(oa=va,va=ca)):(oa=va,va=ca),va===ca&&(va=oa,Ka=R(),Ka!==ca&&(gb=va,va=Ka,Ka={type:"interval-period",location:d(),period:va.value,precision:null,secondary:null}),va=Ka,va===ca&&(va=oa,Ka=Ja(),Ka!==ca?(ma(),wa=La(),wa!==ca?(ma(),wa=V(),wa!==ca?(ma(),Ua=Da(),Ua!==ca?(ma(),Ka=W(),Ka!==ca?(ma(),Ua=Va(),Ua!==ca?(gb=va,va=wa,va={type:"interval-period",location:d(),period:"second",
precision:va,secondary:Ka}):(oa=va,va=ca)):(oa=va,va=ca)):(oa=va,va=ca)):(oa=va,va=ca)):(oa=va,va=ca)):(oa=va,va=ca),va===ca&&(va=oa,Ka=Ja(),Ka!==ca?(ma(),wa=La(),wa!==ca?(ma(),wa=W(),wa!==ca?(ma(),Ua=Va(),Ua!==ca?(gb=va,va=wa,va={type:"interval-period",location:d(),period:"second",precision:va,secondary:null}):(oa=va,va=ca)):(oa=va,va=ca)):(oa=va,va=ca)):(oa=va,va=ca),va===ca&&(va=oa,Ka=Ja(),Ka!==ca&&(gb=va,Ka={type:"interval-period",location:d(),period:"second",precision:null,secondary:null}),va=
Ka)))));return va}function R(){var va=oa;var wa=Ha();wa!==ca&&(gb=va,wa={type:"string",location:d(),value:"day"});va=wa;va===ca&&(va=oa,wa=Ga(),wa!==ca&&(gb=va,wa={type:"string",location:d(),value:"hour"}),va=wa,va===ca&&(va=oa,wa=Aa(),wa!==ca&&(gb=va,wa={type:"string",location:d(),value:"minute"}),va=wa,va===ca&&(va=oa,wa=Ca(),wa!==ca&&(gb=va,wa={type:"string",location:d(),value:"month"}),va=wa,va===ca&&(va=oa,wa=Ia(),wa!==ca&&(gb=va,wa={type:"string",location:d(),value:"year"}),va=wa))));return va}
function W(){var va=oa;var wa=ia();wa!==ca&&(gb=va,wa=parseFloat(wa));return wa}function V(){var va=oa;var wa=ia();wa!==ca&&(gb=va,wa=parseFloat(wa));return wa}function ba(){var va=U();va===ca&&(va=Q());return va}function U(){var va=oa;if(39===e.charCodeAt(oa)){var wa=Za;oa++}else wa=ca,0===eb&&u(qe);wa===ca&&(e.substr(oa,2)===hb?(wa=hb,oa+=2):(wa=ca,0===eb&&u(af)));if(wa!==ca){wa=[];var Ka=oa;if(e.substr(oa,2)===jb){var Ua=jb;oa+=2}else Ua=ca,0===eb&&u(re);Ua!==ca&&(gb=Ka,Ua="'");Ka=Ua;Ka===ca&&
(Ka=e.charAt(oa),Wc.test(Ka)?oa++:(Ka=ca,0===eb&&u(Rc)));for(;Ka!==ca;)wa.push(Ka),Ka=oa,e.substr(oa,2)===jb?(Ua=jb,oa+=2):(Ua=ca,0===eb&&u(re)),Ua!==ca&&(gb=Ka,Ua="'"),Ka=Ua,Ka===ca&&(Ka=e.charAt(oa),Wc.test(Ka)?oa++:(Ka=ca,0===eb&&u(Rc)));39===e.charCodeAt(oa)?(Ka=Za,oa++):(Ka=ca,0===eb&&u(qe));Ka!==ca?(gb=va,va={type:"string",location:d(),value:wa.join("")}):(oa=va,va=ca)}else oa=va,va=ca;return va}function da(){var va=oa;if(Wa()!==ca){ma();var wa=q();if(wa!==ca){ma();var Ka=Ta();Ka!==ca?(ma(),
Ka=q(),Ka!==ca?(gb=va,va={type:"when-clause",location:d(),operand:wa,value:Ka}):(oa=va,va=ca)):(oa=va,va=ca)}else oa=va,va=ca}else oa=va,va=ca;return va}function fa(){var va=oa;if(Wa()!==ca){ma();var wa=q();if(wa!==ca){ma();var Ka=Ta();Ka!==ca?(ma(),Ka=q(),Ka!==ca?(gb=va,va={type:"when-clause",location:d(),operand:wa,value:Ka}):(oa=va,va=ca)):(oa=va,va=ca)}else oa=va,va=ca}else oa=va,va=ca;return va}function ha(){var va=oa;var wa=oa;var Ka=e.substr(oa,4);Ka.toLowerCase()===kc?oa+=4:(Ka=ca,0===eb&&
u(Vg));if(Ka!==ca){Ka=oa;eb++;var Ua=I();eb--;Ua===ca?Ka=void 0:(oa=Ka,Ka=ca);Ka!==ca?(gb=wa,wa="ELSE"):(oa=wa,wa=ca)}else oa=wa,wa=ca;wa!==ca?(ma(),wa=q(),wa!==ca?(gb=va,va={type:"else-clause",location:d(),value:wa}):(oa=va,va=ca)):(oa=va,va=ca);return va}function T(){var va=ia();if(va===ca){va=oa;var wa=e.charAt(oa);Rb.test(wa)?oa++:(wa=ca,0===eb&&u(Qc));if(wa!==ca){var Ka=ia();Ka!==ca?(gb=va,va=wa[0]+Ka):(oa=va,va=ca)}else oa=va,va=ca}return va}function S(){var va=oa;if(46===e.charCodeAt(oa)){var wa=
ob;oa++}else wa=ca,0===eb&&u(Yc);wa!==ca?(wa=ia(),wa===ca&&(wa=null),gb=va,va="."+(null!=wa?wa:"")):(oa=va,va=ca);return va}function Z(){var va;var wa=va=oa;var Ka=e.charAt(oa);Ec.test(Ka)?oa++:(Ka=ca,0===eb&&u(qd));Ka!==ca?(Ka=e.charAt(oa),Rb.test(Ka)?oa++:(Ka=ca,0===eb&&u(Qc)),Ka===ca&&(Ka=null),gb=wa,wa="e"+(null===Ka?"":Ka)):(oa=wa,wa=ca);wa!==ca?(Ka=ia(),Ka!==ca?(gb=va,va=wa+Ka):(oa=va,va=ca)):(oa=va,va=ca);return va}function ia(){var va=oa;var wa=[];var Ka=Y();if(Ka!==ca)for(;Ka!==ca;)wa.push(Ka),
Ka=Y();else wa=ca;wa!==ca&&(gb=va,wa=wa.join(""));return wa}function Y(){var va=e.charAt(oa);Bc.test(va)?oa++:(va=ca,0===eb&&u(Sc));return va}function ea(){var va=oa;var wa=e.substr(oa,2);wa.toLowerCase()===Ma?oa+=2:(wa=ca,0===eb&&u(Vc));if(wa!==ca){wa=oa;eb++;var Ka=I();eb--;Ka===ca?wa=void 0:(oa=wa,wa=ca);wa!==ca?(gb=va,va="IN"):(oa=va,va=ca)}else oa=va,va=ca;return va}function ka(){var va=oa;var wa=e.substr(oa,2);wa.toLowerCase()===ab?oa+=2:(wa=ca,0===eb&&u(Ad));if(wa!==ca){wa=oa;eb++;var Ka=I();
eb--;Ka===ca?wa=void 0:(oa=wa,wa=ca);wa!==ca?(gb=va,va="IS"):(oa=va,va=ca)}else oa=va,va=ca;return va}function ja(){var va=oa;var wa=e.substr(oa,4);wa.toLowerCase()===qb?oa+=4:(wa=ca,0===eb&&u(Bd));if(wa!==ca){wa=oa;eb++;var Ka=I();eb--;Ka===ca?wa=void 0:(oa=wa,wa=ca);wa!==ca?(gb=va,va="LIKE"):(oa=va,va=ca)}else oa=va,va=ca;return va}function X(){var va=oa;var wa=e.substr(oa,3);wa.toLowerCase()===yb?oa+=3:(wa=ca,0===eb&&u(Dd));if(wa!==ca){wa=oa;eb++;var Ka=I();eb--;Ka===ca?wa=void 0:(oa=wa,wa=ca);
wa!==ca?(gb=va,va="NOT"):(oa=va,va=ca)}else oa=va,va=ca;return va}function aa(){var va=oa;var wa=e.substr(oa,3);wa.toLowerCase()===Fb?oa+=3:(wa=ca,0===eb&&u(Mc));if(wa!==ca){wa=oa;eb++;var Ka=I();eb--;Ka===ca?wa=void 0:(oa=wa,wa=ca);wa!==ca?(gb=va,va="AND"):(oa=va,va=ca)}else oa=va,va=ca;return va}function pa(){var va=oa;var wa=e.substr(oa,2);wa.toLowerCase()===Sb?oa+=2:(wa=ca,0===eb&&u(te));if(wa!==ca){wa=oa;eb++;var Ka=I();eb--;Ka===ca?wa=void 0:(oa=wa,wa=ca);wa!==ca?(gb=va,va="OR"):(oa=va,va=ca)}else oa=
va,va=ca;return va}function la(){var va=oa;var wa=e.substr(oa,7);wa.toLowerCase()===Mb?oa+=7:(wa=ca,0===eb&&u(bf));if(wa!==ca){wa=oa;eb++;var Ka=I();eb--;Ka===ca?wa=void 0:(oa=wa,wa=ca);wa!==ca?(gb=va,va="BETWEEN"):(oa=va,va=ca)}else oa=va,va=ca;return va}function na(){var va=oa;var wa=e.substr(oa,4);wa.toLowerCase()===Hb?oa+=4:(wa=ca,0===eb&&u(ue));if(wa!==ca){wa=oa;eb++;var Ka=I();eb--;Ka===ca?wa=void 0:(oa=wa,wa=ca);wa!==ca?(gb=va,va="FROM"):(oa=va,va=ca)}else oa=va,va=ca;return va}function qa(){var va=
oa;var wa=e.substr(oa,7);wa.toLowerCase()===Pb?oa+=7:(wa=ca,0===eb&&u(xe));if(wa!==ca){wa=oa;eb++;var Ka=I();eb--;Ka===ca?wa=void 0:(oa=wa,wa=ca);wa!==ca?(gb=va,va="EXTRACT"):(oa=va,va=ca)}else oa=va,va=ca;return va}function sa(){var va=oa;var wa=e.substr(oa,9);wa.toLowerCase()===ra?oa+=9:(wa=ca,0===eb&&u(Ae));if(wa!==ca){wa=oa;eb++;var Ka=I();eb--;Ka===ca?wa=void 0:(oa=wa,wa=ca);wa!==ca?(gb=va,va="TIMESTAMP"):(oa=va,va=ca)}else oa=va,va=ca;return va}function xa(){var va=oa;var wa=e.substr(oa,4);
wa.toLowerCase()===Fa?oa+=4:(wa=ca,0===eb&&u(Ed));if(wa!==ca){wa=oa;eb++;var Ka=I();eb--;Ka===ca?wa=void 0:(oa=wa,wa=ca);wa!==ca?(gb=va,va="DATE"):(oa=va,va=ca)}else oa=va,va=ca;return va}function ta(){var va=oa;var wa=e.substr(oa,4);wa.toLowerCase()===Ya?oa+=4:(wa=ca,0===eb&&u(Fd));if(wa!==ca){wa=oa;eb++;var Ka=I();eb--;Ka===ca?wa=void 0:(oa=wa,wa=ca);wa!==ca?(gb=va,va="TIME"):(oa=va,va=ca)}else oa=va,va=ca;return va}function Ba(){var va=oa;var wa=e.substr(oa,8);wa.toLowerCase()===Cb?oa+=8:(wa=ca,
0===eb&&u(cf));if(wa!==ca){wa=oa;eb++;var Ka=I();eb--;Ka===ca?wa=void 0:(oa=wa,wa=ca);wa!==ca?(gb=va,va="INTERVAL"):(oa=va,va=ca)}else oa=va,va=ca;return va}function Ia(){var va=oa;var wa=e.substr(oa,4);wa.toLowerCase()===Gb?oa+=4:(wa=ca,0===eb&&u(df));if(wa!==ca){wa=oa;eb++;var Ka=I();eb--;Ka===ca?wa=void 0:(oa=wa,wa=ca);wa!==ca?(gb=va,va="YEAR"):(oa=va,va=ca)}else oa=va,va=ca;return va}function Ca(){var va=oa;var wa=e.substr(oa,5);wa.toLowerCase()===bc?oa+=5:(wa=ca,0===eb&&u(Wg));if(wa!==ca){wa=
oa;eb++;var Ka=I();eb--;Ka===ca?wa=void 0:(oa=wa,wa=ca);wa!==ca?(gb=va,va="MONTH"):(oa=va,va=ca)}else oa=va,va=ca;return va}function Ha(){var va=oa;var wa=e.substr(oa,3);wa.toLowerCase()===Xb?oa+=3:(wa=ca,0===eb&&u(Xg));if(wa!==ca){wa=oa;eb++;var Ka=I();eb--;Ka===ca?wa=void 0:(oa=wa,wa=ca);wa!==ca?(gb=va,va="DAY"):(oa=va,va=ca)}else oa=va,va=ca;return va}function Ga(){var va=oa;var wa=e.substr(oa,4);wa.toLowerCase()===ec?oa+=4:(wa=ca,0===eb&&u(Yg));if(wa!==ca){wa=oa;eb++;var Ka=I();eb--;Ka===ca?wa=
void 0:(oa=wa,wa=ca);wa!==ca?(gb=va,va="HOUR"):(oa=va,va=ca)}else oa=va,va=ca;return va}function Aa(){var va=oa;var wa=e.substr(oa,6);wa.toLowerCase()===Yb?oa+=6:(wa=ca,0===eb&&u(Zg));if(wa!==ca){wa=oa;eb++;var Ka=I();eb--;Ka===ca?wa=void 0:(oa=wa,wa=ca);wa!==ca?(gb=va,va="MINUTE"):(oa=va,va=ca)}else oa=va,va=ca;return va}function Ja(){var va=oa;var wa=e.substr(oa,6);wa.toLowerCase()===Lb?oa+=6:(wa=ca,0===eb&&u($g));if(wa!==ca){wa=oa;eb++;var Ka=I();eb--;Ka===ca?wa=void 0:(oa=wa,wa=ca);wa!==ca?(gb=
va,va="SECOND"):(oa=va,va=ca)}else oa=va,va=ca;return va}function Sa(){var va=oa;var wa=e.substr(oa,4);wa.toLowerCase()===cc?oa+=4:(wa=ca,0===eb&&u(ah));if(wa!==ca){wa=oa;eb++;var Ka=I();eb--;Ka===ca?wa=void 0:(oa=wa,wa=ca);wa!==ca?(gb=va,va="CASE"):(oa=va,va=ca)}else oa=va,va=ca;return va}function $a(){var va=oa;var wa=e.substr(oa,3);wa.toLowerCase()===$b?oa+=3:(wa=ca,0===eb&&u(bh));if(wa!==ca){wa=oa;eb++;var Ka=I();eb--;Ka===ca?wa=void 0:(oa=wa,wa=ca);wa!==ca?(gb=va,va="END"):(oa=va,va=ca)}else oa=
va,va=ca;return va}function Wa(){var va=oa;var wa=e.substr(oa,4);wa.toLowerCase()===Kb?oa+=4:(wa=ca,0===eb&&u(ch));if(wa!==ca){wa=oa;eb++;var Ka=I();eb--;Ka===ca?wa=void 0:(oa=wa,wa=ca);wa!==ca?(gb=va,va="WHEN"):(oa=va,va=ca)}else oa=va,va=ca;return va}function Ta(){var va=oa;var wa=e.substr(oa,4);wa.toLowerCase()===Ub?oa+=4:(wa=ca,0===eb&&u(dh));if(wa!==ca){wa=oa;eb++;var Ka=I();eb--;Ka===ca?wa=void 0:(oa=wa,wa=ca);wa!==ca?(gb=va,va="THEN"):(oa=va,va=ca)}else oa=va,va=ca;return va}function Da(){if(44===
e.charCodeAt(oa)){var va=xc;oa++}else va=ca,0===eb&&u(eh);return va}function La(){if(40===e.charCodeAt(oa)){var va=sc;oa++}else va=ca,0===eb&&u(fh);return va}function Va(){if(41===e.charCodeAt(oa)){var va=tc;oa++}else va=ca,0===eb&&u(gh);return va}function ma(){var va;var wa=[];for(va=za();va!==ca;)wa.push(va),va=za();return wa}function za(){var va=e.charAt(oa);Oc.test(va)?oa++:(va=ca,0===eb&&u(hh));return va}function Na(va,wa,Ka,Ua,sb){va={type:"binary-expression",location:sb,operator:va,left:wa,
right:Ka};void 0!==Ua&&(va.escape=Ua);return va}function Ra(va,...wa){return{type:"expression-list",location:va,value:wa}}function Pa(va,wa){for(const {op:Ka,expr:Ua,location:{end:sb}}of wa)va=Na(Ka,va,Ua,void 0,{...va.location,end:sb});return va}g=void 0!==g?g:{};var ca={},cb=g.grammarSource,ib={start:t},nb=t,xb="!",ya="\x3d",Ea="\x3e\x3d",Qa="\x3e",db="\x3c\x3d",lb="\x3c\x3e",ub="!\x3d",Oa="||",Xa="@",Za="'",hb="N'",jb="''",ob=".",zb="null",Db="true",ua="false",Ma="in",ab="is",qb="like",pb="escape",
yb="not",Fb="and",Sb="or",Mb="between",Hb="from",Eb="for",Ob="substring",Pb="extract",Tb="trim",mb="position",ra="timestamp",Fa="date",Ya="time",bb="leading",fb="trailing",kb="both",rb="cast",vb="as",Ab="integer",Bb="int",Ib="smallint",Jb="float",Nb="real",Qb="varchar",wb="to",Cb="interval",Gb="year",Vb="timezone_hour",ac="timezone_minute",bc="month",Xb="day",ec="hour",Yb="minute",Lb="second",cc="case",$b="end",Kb="when",Ub="then",kc="else",xc=",",sc="(",tc=")",dc="`",uc=/^[<-=]/,Rb=/^[+\-]/,jc=/^[*\/]/,
vc=/^[A-Za-z_\x80-\uFFFF]/,zc=/^[A-Za-z0-9_]/,wc=/^[A-Za-z0-9_.\x80-\uFFFF]/,Hc=/^["]/,Wc=/^[^']/,Bc=/^[0-9]/,Ec=/^[eE]/,Oc=/^[ \t\n\r]/,Ic=/^[^`]/,Jc=c("!",!1),Pc=c("\x3d",!1),Xc=c("\x3e\x3d",!1),vd=c("\x3e",!1),je=c("\x3c\x3d",!1),ke=c("\x3c\x3e",!1),le=l([["\x3c","\x3d"]],!1,!1),wd=c("!\x3d",!1),Qc=l(["+","-"],!1,!1),xd=c("||",!1),me=l(["*","/"],!1,!1),yd=l([["A","Z"],["a","z"],"_",["\u0080","\uffff"]],!1,!1),ne=l([["A","Z"],["a","z"],["0","9"],"_"],!1,!1),zd=l([["A","Z"],["a","z"],["0","9"],"_",
".",["\u0080","\uffff"]],!1,!1),oe=l(['"'],!1,!1),pe=c("@",!1),qe=c("'",!1),af=c("N'",!1),re=c("''",!1),Rc=l(["'"],!0,!1),Yc=c(".",!1),Sc=l([["0","9"]],!1,!1),qd=l(["e","E"],!1,!1),se=c("NULL",!0),Tc=c("TRUE",!0),Uc=c("FALSE",!0),Vc=c("IN",!0),Ad=c("IS",!0),Bd=c("LIKE",!0),Cd=c("ESCAPE",!0),Dd=c("NOT",!0),Mc=c("AND",!0),te=c("OR",!0),bf=c("BETWEEN",!0),ue=c("FROM",!0),ve=c("FOR",!0),we=c("SUBSTRING",!0),xe=c("EXTRACT",!0),ye=c("TRIM",!0),ze=c("POSITION",!0),Ae=c("TIMESTAMP",!0),Ed=c("DATE",!0),Fd=
c("TIME",!0),Gd=c("LEADING",!0),Id=c("TRAILING",!0),Ce=c("BOTH",!0),De=c("CAST",!0),Ee=c("AS",!0),Fe=c("INTEGER",!0),Jd=c("INT",!0),Ge=c("SMALLINT",!0),He=c("FLOAT",!0),Ie=c("REAL",!0),Kd=c("VARCHAR",!0),Hd=c("TO",!0),cf=c("INTERVAL",!0),df=c("YEAR",!0),Be=c("TIMEZONE_HOUR",!0),Ug=c("TIMEZONE_MINUTE",!0),Wg=c("MONTH",!0),Xg=c("DAY",!0),Yg=c("HOUR",!0),Zg=c("MINUTE",!0),$g=c("SECOND",!0),ah=c("CASE",!0),bh=c("END",!0),ch=c("WHEN",!0),dh=c("THEN",!0),Vg=c("ELSE",!0),eh=c(",",!1),fh=c("(",!1),gh=c(")",
!1),hh=l([" ","\t","\n","\r"],!1,!1),Kf=c("`",!1),Lf=l(["`"],!0,!1),oa=g.peg$currPos|0,gb=oa,rd=[{line:1,column:1}],Fc=oa,Je=g.peg$maxFailExpected||[],eb=g.peg$silentFails|0;if(g.startRule){if(!(g.startRule in ib))throw Error("Can't start parsing from rule \""+g.startRule+'".');nb=ib[g.startRule]}var $e=nb();if(g.peg$library)return{peg$result:$e,peg$currPos:oa,peg$FAILED:ca,peg$maxFailExpected:Je,peg$maxFailPos:Fc};if($e!==ca&&oa===e.length)return $e;$e!==ca&&oa<e.length&&u({type:"end"});throw function(va,
wa,Ka){return new b(b.buildMessage(va,wa),va,wa,Ka)}(Je,Fc<e.length?e.charAt(Fc):null,Fc<e.length?x(Fc,Fc+1):x(Fc,Fc));}function p(e,g){if(null!=e)switch(g(e),e.type){case "when-clause":p(e.operand,g);p(e.value,g);break;case "case-expression":for(const d of e.clauses)p(d,g);"simple"===e.format&&p(e.operand,g);null!==e.else&&p(e.else,g);break;case "expression-list":for(const d of e.value)p(d,g);break;case "unary-expression":p(e.expr,g);break;case "binary-expression":p(e.left,g);p(e.right,g);break;
case "function":p(e.args,g);break;case "interval":p(e.value,g);p(e.qualifier,g);break;case "interval-qualifier":p(e.start,g),p(e.end,g)}}(function(e,g){function d(){this.constructor=e}d.prototype=g.prototype;e.prototype=new d})(b,Error);b.prototype.format=function(e){var g="Error: "+this.message;if(this.location){var d=null,f;for(f=0;f<e.length;f++)if(e[f].source===this.location.source){d=e[f].text.split(/\r\n|\n|\r/g);break}e=this.location.start;f=this.location.source&&"function"===typeof this.location.source.offset?
this.location.source.offset(e):e;var c=this.location.source+":"+f.line+":"+f.column;if(d){var l=this.location.end,w=n("",f.line.toString().length," ");d=d[e.line-1];l=(e.line===l.line?l.column:d.length+1)-e.column||1;g+="\n --\x3e "+c+"\n"+w+" |\n"+f.line+" | "+d+"\n"+w+" | "+n("",e.column-1," ")+n("",l,"^")}else g+="\n at "+c}return g};b.buildMessage=function(e,g){function d(x){return x.charCodeAt(0).toString(16).toUpperCase()}function f(x){return x.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,
"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(u){return"\\x0"+d(u)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(u){return"\\x"+d(u)})}function c(x){return x.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(u){return"\\x0"+d(u)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(u){return"\\x"+d(u)})}function l(x){return w[x.type](x)}
var w={literal:function(x){return'"'+f(x.text)+'"'},class:function(x){var u=x.parts.map(function(t){return Array.isArray(t)?c(t[0])+"-"+c(t[1]):c(t)});return"["+(x.inverted?"^":"")+u.join("")+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(x){return x.description}};return"Expected "+function(x){x=x.map(l);var u,t;x.sort();if(0<x.length){for(t=u=1;u<x.length;u++)x[u-1]!==x[u]&&(x[t]=x[u],t++);x.length=t}switch(x.length){case 1:return x[0];case 2:return x[0]+
" or "+x[1];default:return x.slice(0,-1).join(", ")+", or "+x[x.length-1]}}(e)+" but "+(g?'"'+f(g)+'"':"end of input")+" found."};class h{static parse(e){return k(e)}}a.WhereGrammar=h;a.visitAll=p;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/geometryUtils":function(){define(["exports","../featureConversionUtils","../OptimizedGeometry"],function(a,b,n){const k=new n,p=new n,h=new n,e={esriGeometryPoint:b.convertToPoint,esriGeometryPolyline:b.convertToPolyline,
esriGeometryPolygon:b.convertToPolygon,esriGeometryMultipoint:b.convertToMultipoint},g=(d,f)=>"_geVersion"!==d?f:void 0;a.cleanFromGeometryEngine=function(d){return d&&"_geVersion"in d?JSON.parse(JSON.stringify(d,g)):d};a.getGeometry=function(d,f,c,l,w,x,u=f,t=c){const m=f&&u,q=c&&t;l=null!=l?"coords"in l?l:l.geometry:null;if(null==l)return null;if(w)return f=b.generalizeOptimizedGeometry(p,l,f,c,d,w,u,t),x&&(f=b.quantizeOptimizedGeometry(h,f,m,q,d,x)),e[d]?.(f,m,q)??null;if(x)return x=b.quantizeOptimizedGeometry(h,
l,f,c,d,x,u,t),e[d]?.(x,m,q)??null;b.removeZMValues(k,l,f,c,u,t);return e[d]?.(k,m,q)??null};a.transformCentroid=function(d,f,c,l=d.hasZ,w=d.hasM){if(null==f)return null;const x=d.hasZ&&l,u=d.hasM&&w;return c?(d=b.quantizeOptimizedGeometry(h,f,d.hasZ,d.hasM,"esriGeometryPoint",c,l,w),b.convertToPoint(d,x,u)):b.convertToPoint(f,x,u)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/projectionSupport":function(){define("exports ../../../core/arrayUtils ../../../core/promiseUtils ../../../geometry/projection ../../../geometry/geometryAdapters/json ../../../geometry/support/spatialReferenceUtils ../../../geometry/support/webMercatorUtils".split(" "),
function(a,b,n,k,p,h,e){function g(t,m){if(!m)return null;if("x"in m){var q={x:0,y:0};[q.x,q.y]=t(m.x,m.y,c);null!=m.z&&(q.z=m.z);null!=m.m&&(q.m=m.m);return q}return"xmin"in m?(q={xmin:0,ymin:0,xmax:0,ymax:0},[q.xmin,q.ymin]=t(m.xmin,m.ymin,c),[q.xmax,q.ymax]=t(m.xmax,m.ymax,c),m.hasZ&&(q.zmin=m.zmin,q.zmax=m.zmax,q.hasZ=!0),m.hasM&&(q.mmin=m.mmin,q.mmax=m.mmax,q.hasM=!0),q):"rings"in m?{rings:d(m.rings,t),hasM:m.hasM,hasZ:m.hasZ}:"paths"in m?{paths:d(m.paths,t),hasM:m.hasM,hasZ:m.hasZ}:"points"in
m?{points:f(m.points,t),hasM:m.hasM,hasZ:m.hasZ}:null}function d(t,m){const q=[];for(const r of t)q.push(f(r,m));return q}function f(t,m){const q=[];for(const r of t)t=m(r[0],r[1],[0,0]),q.push(t),2<r.length&&t.push(r[2]),3<r.length&&t.push(r[3]);return q}const c=[0,0],l=g.bind(null,e.lngLatToXY),w=g.bind(null,e.xyToLngLat);class x{constructor(){this._jobs=[];this._timer=null;this._process=this._process.bind(this)}async push(t,m,q,r){if(!t?.length||!m||!q||h.equals(m,q))return t;t={geometries:t,inSpatialReference:m,
outSpatialReference:q,geographicTransformation:r,resolve:n.createResolver()};this._jobs.push(t);this._timer??(this._timer=setTimeout(this._process,10));return t.resolve.promise}_process(){this._timer=null;const t=this._jobs.shift();if(t){var {geometries:m,inSpatialReference:q,outSpatialReference:r,resolve:v,geographicTransformation:y}=t;e.canProject(q,r)?h.isWebMercator(r)?v(m.map(l)):v(m.map(w)):v(k.projectMany(p.jsonAdapter,m,q,r,y,null));0<this._jobs.length&&(this._timer=setTimeout(this._process,
10))}}}const u=new x;a.checkProjectionSupport=async function(t,m){t&&m&&(t=Array.isArray(t)?t.map(q=>null!=q.geometry?q.geometry.spatialReference:null).filter(b.isSome):[t],await k.initializeProjection(t.map(q=>({source:q,dest:m}))))};a.project=function(t,m,q,r){if(!t)return t;q||(q=m,m=t.spatialReference);return h.isValid(m)&&h.isValid(q)&&!h.equals(m,q)?e.canProject(m,q)?(t=h.isWebMercator(q)?l(t):w(t),t.spatialReference=q,t):k.projectMany(p.jsonAdapter,[t],m,q,null,r)[0]:t};a.projectMany=function(t,
m,q,r){return u.push(t,m,q,r)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/geometryAdapters/json":function(){define(["exports"],function(a){class b{constructor(e,g,d){this.x=e;this.y=g;this.spatialReference=d;this.m=this.z=void 0}}class n{constructor(e,g,d,f){this.rings=e;this.spatialReference=g;this.hasM=this.hasZ=void 0;d&&(this.hasZ=d);f&&(this.hasM=f)}}class k{constructor(e,g,d,f){this.paths=e;this.spatialReference=g;this.hasM=this.hasZ=void 0;d&&(this.hasZ=
d);f&&(this.hasM=f)}}class p{constructor(e,g,d,f){this.points=e;this.spatialReference=g;this.hasM=this.hasZ=void 0;d&&(this.hasZ=d);f&&(this.hasM=f)}}class h{constructor(e,g,d,f,c){this.xmin=e;this.ymin=g;this.xmax=d;this.ymax=f;this.spatialReference=c;this.mmax=this.mmin=this.zmax=this.zmin=void 0}}a.jsonAdapter={convertToGEGeometry:function(e,g){return null==g?null:e.convertJSONToGeometry(g)},exportPoint:function(e,g,d){d=new b(e.getPointX(g),e.getPointY(g),d);const f=e.hasZ(g),c=e.hasM(g);f&&(d.z=
e.getPointZ(g));c&&(d.m=e.getPointM(g));return d},exportPolygon:function(e,g,d){return new n(e.exportPaths(g),d,e.hasZ(g),e.hasM(g))},exportPolyline:function(e,g,d){return new k(e.exportPaths(g),d,e.hasZ(g),e.hasM(g))},exportMultipoint:function(e,g,d){return new p(e.exportPoints(g),d,e.hasZ(g),e.hasM(g))},exportExtent:function(e,g,d){var f=e.hasZ(g);const c=e.hasM(g);d=new h(e.getXMin(g),e.getYMin(g),e.getXMax(g),e.getYMax(g),d);f&&(f=e.getZExtent(g),d.zmin=f.vmin,d.zmax=f.vmax);c&&(e=e.getMExtent(g),
d.mmin=e.vmin,d.mmax=e.vmax);return d}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/QueryEngineCache":function(){define(["exports"],function(a){class b{constructor(){this._storage=new Map;this._purgeInterval=5;this._sweep=()=>{this._timer=void 0;if(this._storage){var p=1E3*this._purgeInterval,h=performance.now()-p;for(const [e,g]of this._storage)if(g.time<h)this._storage.delete(e);else{0<this._storage.size&&(this._timer=setTimeout(this._sweep,p));break}}}}destroy(){this._storage?.clear();
this._storage=null;clearTimeout(this._timer)}get size(){return this._storage?.size??0}put(p,h){this._storage?.set(p,new k(h));this._scheduleSweep()}get(p){if(this._storage){var h=this._storage?.get(p);if(h)return this._storage?.delete(p),h.time=performance.now(),this._storage?.set(p,h),h.items}}clear(){this._storage?.clear()}_scheduleSweep(){this._storage&&(this._timer??(this._timer=setTimeout(this._sweep,1E3*this._purgeInterval)))}}let n=0;class k{constructor(p){this.items=p;this.time=performance.now();
this.id=n++}}a.QueryEngineCache=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/QueryEngineResult":function(){define("require exports ../../../core/lang ../../../geometry/support/centroid ../../../geometry/support/extentUtils ../../../geometry/support/quantizationUtils ../../../geometry/support/spatialReferenceUtils ./AttributesBuilder ./geometryUtils ./projectionSupport ./SnappingCandidate ../../support/fieldUtils ../../../statistics/utils".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w){function x(q,r,v,y){const B=y.x-v.x;y=y.y-v.y;r=Math.min(1,Math.max(0,((r.x-v.x)*B+(r.y-v.y)*y)/(B*B+y*y)));q.x=v.x+B*r;q.y=v.y+y*r}function u(q,r){return q?r?4:3:r?3:2}class t{constructor(q,r,v){this.items=q;this.query=r;this.geometryType=v.geometryType;this.hasM=v.hasM;this.hasZ=v.hasZ;this.fieldsIndex=v.fieldsIndex;this.objectIdField=v.objectIdField;this.spatialReference=v.spatialReference;this.featureAdapter=v.featureAdapter}get size(){return this.items.length}createQueryResponseForCount(){const q=
new g(this.query,this.featureAdapter,this.fieldsIndex);if(!this.query.outStatistics)return q.countDistinctValues(this.items);const {groupByFieldsForStatistics:r,having:v,outStatistics:y}=this.query;if(!r?.length)return 1;const B=new Map,z=new Map,A=new Set;for(const E of y){var {statisticType:C}=E;C="exceedslimit"!==C?E.onStatisticField:void 0;if(!z.has(C)){var H=[];for(const F of r){const G=this._getAttributeValues(q,F,B);H.push(G)}z.set(C,this._calculateUniqueValues(H,q.returnDistinctValues))}C=
z.get(C);for(const F in C){const {data:G,items:D}=C[F];H=G.join(",");v&&!q.validateItems(D,v)||A.add(H)}}return A.size}async createQueryResponse(){let q;q=this.query.outStatistics?this.query.outStatistics.some(r=>"exceedslimit"===r.statisticType)?this._createExceedsLimitQueryResponse(this.query):await this._createStatisticsQueryResponse(this.query):this._createFeatureQueryResponse(this.query);if(this.query.returnQueryGeometry){const r=this.query.geometry;e.isValid(this.query.outSR)&&!e.equals(r.spatialReference,
this.query.outSR)?q.queryGeometry=d.cleanFromGeometryEngine({spatialReference:this.query.outSR,...f.project(r,r.spatialReference,this.query.outSR)}):q.queryGeometry=d.cleanFromGeometryEngine({spatialReference:this.query.outSR,...r})}return q}createSnappingResponse(q,r){const v=this.featureAdapter,y=u(this.hasZ,this.hasM),{point:B,mode:z}=q,A="number"===typeof q.distance?q.distance:q.distance.x,C="number"===typeof q.distance?q.distance:q.distance.y,H={candidates:[]},E="esriGeometryPolygon"===this.geometryType;
r=this._getPointCreator(z,this.spatialReference,r);const F=new m(null,0),G=new m(null,0),D={x:0,y:0,z:0};for(const K of this.items){var I=v.getGeometry(K);if(null==I)continue;const {coords:L,lengths:P}=I;F.coords=L;G.coords=L;if(q.returnEdge){I=0;for(var J=0;J<P.length;J++){var N=P[J];for(var M=0;M<N;M++,I+=y){var Q=F;Q.coordsIndex=I;if(M!==N-1){const R=G;R.coordsIndex=I+y;const W=D;x(D,B,Q,R);var O=(B.x-W.x)/A;const V=(B.y-W.y)/C;O=O*O+V*V;1>=O&&H.candidates.push(c.makeEdgeCandidate(v.getObjectId(K),
r(W),Math.sqrt(O),r(Q),r(R)))}}}}if("none"!==q.vertexMode)if(I=E?L.length-y:L.length,"all"===q.vertexMode)for(J=0;J<I;J+=y)N=F,N.coordsIndex=J,M=(B.x-N.x)/A,Q=(B.y-N.y)/C,M=M*M+Q*Q,1>=M&&H.candidates.push(c.makeVertexCandidate(v.getObjectId(K),r(N),Math.sqrt(M)));else if("ends"===q.vertexMode){I=[0];E||I.push(L.length-y);for(const R of I)I=F,I.coordsIndex=R,J=(B.x-I.x)/A,N=(B.y-I.y)/C,J=J*J+N*N,1>=J&&H.candidates.push(c.makeVertexCandidate(v.getObjectId(K),r(I),Math.sqrt(J)))}}H.candidates.sort((K,
L)=>K.distance-L.distance);return H}_getPointCreator(q,r,v){const y=null==v||e.equals(r,v)?z=>z:z=>f.project(z,r,v),{hasZ:B}=this;return"3d"===q?B?({x:z,y:A,z:C})=>y({x:z,y:A,z:C}):({x:z,y:A})=>y({x:z,y:A,z:0}):({x:z,y:A})=>y({x:z,y:A})}async createSummaryStatisticsResponse(q){const {field:r,valueExpression:v,normalizationField:y,normalizationType:B,normalizationTotal:z,minValue:A,maxValue:C,scale:H,timeZone:E,outStatisticTypes:F}=q;var G=this.fieldsIndex.get(r);q=l.isDateField(G)||l.isDateOnlyField(G)||
l.isTimestampOffsetField(G);const D=await this._getDataValues({field:r,valueExpression:v,normalizationField:y,normalizationType:B,normalizationTotal:z,scale:H,timeZone:E}),I=w.isNullCountSupported({normalizationType:B,normalizationField:y,minValue:A,maxValue:C}),J={value:.5,fieldType:G?.type};G=l.isStringField(G)?w.calculateStringStatistics({values:D,supportsNullCount:I,percentileParams:J,outStatisticTypes:F}):w.calculateStatistics({values:D,minValue:A,maxValue:C,useSampleStdDev:!B,supportsNullCount:I,
percentileParams:J,outStatisticTypes:F});return w.processSummaryStatisticsResult(G,F,q)}async createUniqueValuesResponse(q){const {field:r,valueExpression:v,domains:y,returnAllCodedValues:B,scale:z,timeZone:A}=q;var C=await this._getDataValues({field:r,field2:q.field2,field3:q.field3,fieldDelimiter:q.fieldDelimiter,valueExpression:v,scale:z,timeZone:A},!1);C=w.calculateUniqueValuesCount(C);return w.createUVResult(C,y,B,q.fieldDelimiter)}async createClassBreaksResponse(q){const {field:r,valueExpression:v,
normalizationField:y,normalizationType:B,normalizationTotal:z,classificationMethod:A,standardDeviationInterval:C,minValue:H,maxValue:E,numClasses:F,scale:G,timeZone:D}=q;q=await this._getDataValues({field:r,valueExpression:v,normalizationField:y,normalizationType:B,normalizationTotal:z,scale:G,timeZone:D});q=w.calculateClassBreaks(q,{field:r,normalizationField:y,normalizationType:B,normalizationTotal:z,classificationMethod:A,standardDeviationInterval:C,minValue:H,maxValue:E,numClasses:F});return w.resolveCBResult(q,
A)}async createHistogramResponse(q){const {field:r,valueExpression:v,normalizationField:y,normalizationType:B,normalizationTotal:z,classificationMethod:A,standardDeviationInterval:C,minValue:H,maxValue:E,numBins:F,scale:G,timeZone:D}=q;q=await this._getDataValues({field:r,valueExpression:v,normalizationField:y,normalizationType:B,normalizationTotal:z,scale:G,timeZone:D});return w.calculateHistogram(q,{field:r,normalizationField:y,normalizationType:B,normalizationTotal:z,classificationMethod:A,standardDeviationInterval:C,
minValue:H,maxValue:E,numBins:F})}_sortFeatures(q,r,v){if(1<q.length&&r?.length)for(const y of r.reverse()){r=y.split(" ");const B=r[0],z=this.fieldsIndex.get(B);r=r[1]?"desc"===r[1].toLowerCase():!1;const A=w.getAttributeComparator(z?.type,r);q.sort((C,H)=>{C=v(C,B,z);H=v(H,B,z);return A(C,H)})}}_createFeatureQueryResponse(q){const r=this.items,{geometryType:v,hasM:y,hasZ:B,objectIdField:z,spatialReference:A}=this,{outFields:C,outSR:H,quantizationParameters:E,resultRecordCount:F,resultOffset:G,returnZ:D,
returnM:I}=q,J=null!=F?r.length>(G||0)+F:!1,N=C&&(C.includes("*")?[...this.fieldsIndex.fields]:C.map(M=>this.fieldsIndex.get(M)));return{exceededTransferLimit:J,features:this._createFeatures(q,r),fields:N,geometryType:v,hasM:y&&I,hasZ:B&&D,objectIdFieldName:z,spatialReference:d.cleanFromGeometryEngine(H||A),transform:E&&h.toQuantizationTransform(E)||null}}_createFeatures(q,r){const v=new g(q,this.featureAdapter,this.fieldsIndex),{hasM:y,hasZ:B}=this,{orderByFields:z,quantizationParameters:A,returnGeometry:C,
returnCentroid:H,maxAllowableOffset:E,resultOffset:F,resultRecordCount:G,returnZ:D=!1,returnM:I=!1}=q,J=B&&D,N=y&&I;q=[];var M=0;const Q=[...r];this._sortFeatures(Q,z,(R,W,V)=>v.getFieldValue(R,W,V));if(this.geometryType&&(C||H)){var O=h.toQuantizationTransform(A)??void 0;r="esriGeometryPolygon"===this.geometryType||"esriGeometryPolyline"===this.geometryType;if(C&&!H)for(var K of Q){var L=this.featureAdapter.getGeometry(K),P={attributes:v.getAttributes(K),geometry:d.getGeometry(this.geometryType,
this.hasZ,this.hasM,L,E,O,J,N)};r&&L&&!P.geometry&&(P.centroid=d.transformCentroid(this,this.featureAdapter.getCentroid(K,this),O));q[M++]=P}else if(!C&&H)for(L of Q)q[M++]={attributes:v.getAttributes(L),centroid:d.transformCentroid(this,this.featureAdapter.getCentroid(L,this),O)};else for(P of Q)q[M++]={attributes:v.getAttributes(P),centroid:d.transformCentroid(this,this.featureAdapter.getCentroid(P,this),O),geometry:d.getGeometry(this.geometryType,this.hasZ,this.hasM,this.featureAdapter.getGeometry(P),
E,O,J,N)}}else for(O of Q)(K=v.getAttributes(O))&&(q[M++]={attributes:K});M=F||0;null!=G&&(q=q.slice(M,Math.min(q.length,M+G)));return q}_createExceedsLimitQueryResponse(q){var r=!1;let v=Number.POSITIVE_INFINITY,y=Number.POSITIVE_INFINITY;r=Number.POSITIVE_INFINITY;for(const B of q.outStatistics??[])if("exceedslimit"===B.statisticType){v=null!=B.maxPointCount?B.maxPointCount:Number.POSITIVE_INFINITY;y=null!=B.maxRecordCount?B.maxRecordCount:Number.POSITIVE_INFINITY;r=null!=B.maxVertexCount?B.maxVertexCount:
Number.POSITIVE_INFINITY;break}if("esriGeometryPoint"===this.geometryType)r=this.items.length>v;else if(this.items.length>y)r=!0;else{q=u(this.hasZ,this.hasM);const B=this.featureAdapter;r=this.items.reduce((z,A)=>{A=B.getGeometry(A);return z+(null!=A&&A.coords.length||0)},0)/q>r}return{fields:[{name:"exceedslimit",type:"esriFieldTypeInteger",alias:"exceedslimit",sqlType:"sqlTypeInteger",domain:null,defaultValue:null}],features:[{attributes:{exceedslimit:Number(r)}}]}}async _createStatisticsQueryResponse(q){var r=
{attributes:{}};const v=[],y=new Map,B=new Map,z=new Map,A=new Map,C=new g(q,this.featureAdapter,this.fieldsIndex);var H=q.outStatistics;const {groupByFieldsForStatistics:E,having:F,orderByFields:G,resultRecordCount:D}=q;q=E?.length;const I=!!q,J=I?E[0]:null,N=I&&!this.fieldsIndex.get(J);for(const L of H??[]){const {outStatisticFieldName:P,statisticType:R}=L;H=L;const W="exceedslimit"!==R?L.onStatisticField:void 0,V="percentile_disc"===R||"percentile_cont"===R;var M="EnvelopeAggregate"===R||"CentroidAggregate"===
R||"ConvexHullAggregate"===R;const ba=I&&1===q&&(W===J||N)&&"count"===R;if(I){if(!z.has(W)){var Q=[];for(const U of E){var O=this._getAttributeValues(C,U,y);Q.push(O)}z.set(W,this._calculateUniqueValues(Q,M?!1:C.returnDistinctValues))}Q=z.get(W);if(!Q)continue;O=Object.keys(Q);for(const U of O){const {count:da,data:fa,items:ha,itemPositions:T}=Q[U];O=fa.join(",");if(!F||C.validateItems(ha,F)){const S=A.get(O)||{attributes:{}};if(M){S.aggregateGeometries||(S.aggregateGeometries={});const {aggregateGeometries:ia,
outStatisticFieldName:Y}=await this._getAggregateGeometry(H,ha);S.aggregateGeometries[Y]=ia}else{var K=null;if(ba)K=da;else{const ia=this._getAttributeValues(C,W,y);K=T.map(Y=>ia[Y]);K=V&&"statisticParameters"in H?this._getPercentileValue(H,K):this._getStatisticValue(H,K,null,C.returnDistinctValues)}S.attributes[P]=K}let Z=0;E.forEach((ia,Y)=>S.attributes[this.fieldsIndex.get(ia)?ia:`EXPR_${++Z}`]=fa[Y]);A.set(O,S)}}}else if(M){r.aggregateGeometries||(r.aggregateGeometries={});const {aggregateGeometries:U,
outStatisticFieldName:da}=await this._getAggregateGeometry(H,this.items);r.aggregateGeometries[da]=U}else M=this._getAttributeValues(C,W,y),r.attributes[P]=V&&"statisticParameters"in H?this._getPercentileValue(H,M):this._getStatisticValue(H,M,B,C.returnDistinctValues);H="min"!==R&&"max"!==R||!l.isStringField(this.fieldsIndex.get(W))&&!this._isAnyDateField(W)?null:this.fieldsIndex.get(W)?.type;v.push({name:P,alias:P,type:H||"esriFieldTypeDouble"})}r=I?Array.from(A.values()):[r];this._sortFeatures(r,
G,(L,P)=>L.attributes[P]);D&&(r.length=Math.min(D,r.length));return{fields:v,features:r}}_isAnyDateField(q){q=this.fieldsIndex.get(q);return l.isDateField(q)||l.isDateOnlyField(q)||l.isTimestampOffsetField(q)||l.isTimeOnlyField(q)}async _getAggregateGeometry(q,r){const {convexHull:v,union:y}=await new Promise((D,I)=>a(["../../../geometry/geometryEngineJSON"],D,I)),{statisticType:B,outStatisticFieldName:z}=q,{featureAdapter:A,spatialReference:C,geometryType:H,hasZ:E,hasM:F}=this;r=r.map(D=>d.getGeometry(H,
E,F,A.getGeometry(D)));const G=v(C,r,!0)[0];q={aggregateGeometries:null,outStatisticFieldName:null};"EnvelopeAggregate"===B?(r=G?p.getPolygonExtent(G):p.getGeometryExtent(y(C,r)),q.aggregateGeometries={...r,spatialReference:C},q.outStatisticFieldName=z||"extent"):"CentroidAggregate"===B?(r=G?k.polygonCentroid(G):k.extentCentroid(p.getGeometryExtent(y(C,r))),q.aggregateGeometries={x:r[0],y:r[1],spatialReference:C},q.outStatisticFieldName=z||"centroid"):"ConvexHullAggregate"===B&&(q.aggregateGeometries=
G,q.outStatisticFieldName=z||"convexHull");return q}_getStatisticValue(q,r,v,y){const {onStatisticField:B,statisticType:z}=q;q=null;q=v?.has(B)?v.get(B):l.isStringField(this.fieldsIndex.get(B))||this._isAnyDateField(B)?w.calculateStringStatistics({values:r,returnDistinct:y}):w.calculateStatistics({values:y?[...(new Set(r))]:r,minValue:null,maxValue:null,useSampleStdDev:!0});v&&v.set(B,q);return q["var"===z?"variance":z]}_getPercentileValue(q,r){const {onStatisticField:v,statisticParameters:y,statisticType:B}=
q,{value:z,orderBy:A}=y;q=this.fieldsIndex.get(v);return w.calculatePercentile(r,{value:z,orderBy:A,fieldType:q?.type,isDiscrete:"percentile_disc"===B})}_getAttributeValues(q,r,v){if(v.has(r))return v.get(r);const y=this.fieldsIndex.get(r),B=this.items.map(z=>q.getFieldValue(z,r,y));v.set(r,B);return B}_calculateUniqueValues(q,r){const v={},y=this.items,B=y.length;for(let z=0;z<B;z++){const A=y[z],C=[];for(const E of q)C.push(E[z]);const H=C.join(",");null==v[H]?v[H]={count:1,data:C,items:[A],itemPositions:[z]}:
(r||v[H].count++,v[H].items.push(A),v[H].itemPositions.push(z))}return v}async _getDataValues(q,r=!0){const v=new g(this.query,this.featureAdapter,this.fieldsIndex),{valueExpression:y,scale:B,timeZone:z}=q;return y?v.getExpressionValues(this.items,y,{viewingMode:"map",scale:B,spatialReference:this.query.outSR||this.spatialReference},{geometryType:this.geometryType,hasZ:this.hasZ,hasM:this.hasM},z):v.getDataValues(this.items,n.clone(q),r)}}class m{constructor(q,r){this.coords=q;this.coordsIndex=r}get x(){return this.coords[this.coordsIndex]}get y(){return this.coords[this.coordsIndex+
1]}get z(){return this.coords[this.coordsIndex+2]}}b.QueryEngineResult=t;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/AttributesBuilder":function(){define("./attributeSupport ./geometryUtils ../../support/fieldUtils ../../../smartMapping/statistics/support/utils ../../../statistics/utils ../../../support/arcadeOnDemand".split(" "),function(a,b,n,k,p,h){class e{constructor(g,d,f){this._fieldDataCache=new Map;this._returnDistinctMap=new Map;this.returnDistinctValues=
g.returnDistinctValues??!1;this.fieldsIndex=f;this.featureAdapter=d;if((d=g.outFields)&&!d.includes("*")){this.outFields=d;g=0;for(const l of d){var c=a.getExpressionFromFieldName(l);c=(d=this.fieldsIndex.get(c))?null:a.getWhereClause(c,f);d=d?d.name:a.getAliasFromFieldName(l)||`FIELD_EXP_${g++}`;this._fieldDataCache.set(l,{alias:d,clause:c})}}}countDistinctValues(g){if(!this.returnDistinctValues)return g.length;g.forEach(d=>this.getAttributes(d));return this._returnDistinctMap.size}getAttributes(g){g=
this._processAttributesForOutFields(g);return this._processAttributesForDistinctValues(g)}getFieldValue(g,d,f){const c=f?f.name:d;let l=null;this._fieldDataCache.has(c)?l=this._fieldDataCache.get(c)?.clause:f||(l=a.getWhereClause(d,this.fieldsIndex),this._fieldDataCache.set(c,{alias:c,clause:l}));return f?this.featureAdapter.getAttribute(g,c):l?.calculateValue(g,this.featureAdapter)}getDataValues(g,d,f=!0){const c=d.normalizationType,l=d.normalizationTotal,w=this.fieldsIndex.get(d.field),x=n.isDateOnlyField(w)||
n.isTimestampOffsetField(w),u=n.isTimeOnlyField(w);return g.map(t=>{let m=d.field&&this.getFieldValue(t,d.field,this.fieldsIndex.get(d.field));d.field2?(m=`${p.processNullValue(m)}${d.fieldDelimiter}${p.processNullValue(this.getFieldValue(t,d.field2,this.fieldsIndex.get(d.field2)))}`,d.field3&&(m=`${m}${d.fieldDelimiter}${p.processNullValue(this.getFieldValue(t,d.field3,this.fieldsIndex.get(d.field3)))}`)):"string"===typeof m&&f&&(x?m=m?(new Date(m)).getTime():null:u&&(m=m?k.timeOnlyToMilliseconds(m):
null));c&&Number.isFinite(m)&&(t="field"===c&&d.normalizationField?this.getFieldValue(t,d.normalizationField,this.fieldsIndex.get(d.normalizationField)):null,m=p.getNormalizedValue(m,c,t,l));return m})}async getExpressionValues(g,d,f,c,l){const {arcadeUtils:w}=await h.loadArcade(),x=w.hasGeometryOperations(d);x&&await w.enableGeometryOperations();const u=w.createFunction(d),t=w.getViewInfo(f),m={fields:this.fieldsIndex.fields};return g.map(q=>{q={attributes:this.featureAdapter.getAttributes(q),layer:m,
geometry:x?{...b.getGeometry(c.geometryType,c.hasZ,c.hasM,this.featureAdapter.getGeometry(q)),spatialReference:f?.spatialReference}:null};q=w.createExecContext(q,t,l);return w.executeFunction(u,q)})}validateItem(g,d){this._fieldDataCache.has(d)||this._fieldDataCache.set(d,{alias:d,clause:a.getWhereClause(d,this.fieldsIndex)});return this._fieldDataCache.get(d)?.clause?.testFeature(g,this.featureAdapter)??!1}validateItems(g,d){this._fieldDataCache.has(d)||this._fieldDataCache.set(d,{alias:d,clause:a.getWhereClause(d,
this.fieldsIndex)});return this._fieldDataCache.get(d)?.clause?.testSet(g,this.featureAdapter)??!1}_processAttributesForOutFields(g){const d=this.outFields;if(!d?.length)return this.featureAdapter.getAttributes(g);const f={};for(const c of d){const {alias:l,clause:w}=this._fieldDataCache.get(c);f[l]=w?w.calculateValue(g,this.featureAdapter):this.featureAdapter.getAttribute(g,l)}return f}_processAttributesForDistinctValues(g){if(null==g||!this.returnDistinctValues)return g;var d=this.outFields,f=[];
if(d)for(const l of d){var {alias:c}=this._fieldDataCache.get(l);f.push(g[c])}else for(c in g)f.push(g[c]);d=`${(d||["*"]).join(",")}=${f.join(",")}`;f=this._returnDistinctMap.get(d)||0;this._returnDistinctMap.set(d,++f);return 1<f?null:g}}return e})},"esri/smartMapping/statistics/support/utils":function(){define("exports ../../../geometry ../../../core/Error ../../../core/screenUtils ../../../core/timeUtils ../../../geometry/SpatialReference ../../../geometry/support/quantizationUtils ../../../geometry/support/spatialReferenceUtils ../../../layers/support/fieldUtils ../../../renderers/support/heatmapUtils ../../support/utils ../../../statistics/utils ../../../support/arcadeOnDemand ../../../geometry/Point".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w,x){function u(y){y=v.exec(y);if(!y)return null;const {hh:B,mm:z,ss:A,ms:C}=y.groups;return Number(B)*p.millisecondsPerTimeUnit.hours+Number(z)*p.millisecondsPerTimeUnit.minutes+Number(A)*p.millisecondsPerTimeUnit.seconds+Number(C||0)}function t(y,B){y=null!=y?y:"";null!=B&&B&&(y=y?"("+y+") AND ("+B+")":B);return y}function m(y){const B=y.layer;return y.fields.filter(z=>!B.getField(z))}function q(y){const B=y.layer;return y.fields.filter(z=>{z=B.getFieldUsageInfo(z);
return!z||!z.supportsStatistics})}let r=null;const v=/^(?<hh>([0-1][0-9])|([2][0-3])):(?<mm>[0-5][0-9])(:(?<ss>[0-5][0-9]))?([.](?<ms>\d+))?$/;a.calculateHeatmapStats=function(y,B=18,z,A,C){const H=new Float64Array(A*C);B=Math.round(k.pt2px(B));let E=Number.POSITIVE_INFINITY,F=Number.NEGATIVE_INFINITY;z=f.createValueFunction(z);for(const {geometry:I,attributes:J}of y){const {x:N,y:M}=I;y=Math.max(0,N-B);var G=Math.max(0,M-B);const Q=Math.min(C,M+B),O=Math.min(A,N+B),K=+z(J);for(;G<Q;G++)for(let L=
y;L<O;L++){var D=G*A+L;const P=f.evaluateDensityKernel(L-N,G-M,B)*K;D=H[D]+=P;E=Math.min(E,D);F=Math.max(F,D)}}return{min:E,max:F}};a.getDataValues=async function(y,B,z=!0){if(!B)return[];const {field:A,field2:C,field3:H,fieldDelimiter:E,fieldInfos:F,timeZone:G}=y;var D=A&&F?.find(W=>W.name.toLowerCase()===A.toLowerCase());const I=D?d.isTimeOnlyField(D):!1,J=D?c.isAnyDateField(D):!1,N=y.valueExpression,M=y.normalizationType,Q=y.normalizationField,O=y.normalizationTotal,K=[];D=y.viewInfoParams;let L=
null,P=null;if(N){if(!r){const {arcadeUtils:W}=await w.loadArcade();r=W}r.hasGeometryOperations(N)&&await r.enableGeometryOperations();L=r.createFunction(N);P=D?r.getViewInfo({viewingMode:D.viewingMode,scale:D.scale,spatialReference:new h(D.spatialReference)}):null}y=y.fieldInfos;const R=B[0]&&"declaredClass"in B[0]&&"esri.Graphic"===B[0].declaredClass||!y?null:{fields:y};B.forEach(W=>{var V=W.attributes;if(N){var ba=r.createExecContext(R?{...W,layer:R}:W,P,G);ba=r.executeFunction(L,ba)}else V&&(ba=
V[A],C?(ba=`${l.processNullValue(ba)}${E}${l.processNullValue(V[C])}`,H&&(ba=`${ba}${E}${l.processNullValue(V[H])}`)):"string"===typeof ba&&z&&(J?ba=ba?(new Date(ba)).getTime():null:I&&(ba=ba?u(ba):null)));M&&"number"===typeof ba&&isFinite(ba)&&(V=V&&parseFloat(V[Q]),ba=l.getNormalizedValue(ba,M,V,O));K.push(ba)});return K};a.getRangeExpr=function(y,B,z){B=null!=B?y+" \x3e\x3d "+B:"";y=null!=z?y+" \x3c\x3d "+z:"";z="";return(z=B&&y?t(B,y):B||y)?"("+z+")":""};a.getSQLFilterForNormalization=function(y){const B=
y.field,z=y.normalizationType;y=y.normalizationField;let A;if("field"===z)A="(NOT "+y+" \x3d 0)";else if("log"===z||"natural-log"===z||"square-root"===z)A=`(${B} > 0)`;return A};a.getSumOfAttributesExpr=function(y,B,z){const A=[],C=[],H=[],E=[],F=[];y.forEach((D,I)=>{const J=D.field?"field":"expression",N=D.field||D.valueExpression;D.field?(F.push(N),C.push(`var ${J}${I} = Number($feature["${N}"]);`)):(A.push(`function getValueForExpr${I}() {\n  ${N} \n}`),C.push(`var ${J}${I} = Number(getValueForExpr${I}());`));
z||H.push(`${J}${I} = IIf(${J}${I} < 0, 0, ${J}${I});`);E.push(`${J}${I}`)});y=A.length?null:F.reduce((D,I)=>`${D} + ${I}`);let G=null;B||z?B?z||y&&(G=`(( ${y} ) >= 0)`):y&&(G=`(( ${y} ) <> 0)`):y&&(G=`(( ${y} ) > 0)`);return{valueExpression:[A.length?A.join("\n"):"",C.join("\n"),H.join("\n"),`var total = ${E.join(" + ")};`,"return total;"].filter(Boolean).join("\n\n"),sqlExpression:y,sqlWhere:G}};a.mergeWhereClauses=t;a.quantizeFeatures=function(y,B,z,A){const C=g.isWrappable(z)?g.getInfo(z):null,
H=C?Math.round((C.valid[1]-C.valid[0])/B.scale[0]):null;return y.map(E=>{const F=new x(E.geometry);e.quantizePoint(B,F,F);if(C){var G=H??0,D=A[0];0>F.x?F.x+=G:F.x>D&&(F.x-=G)}E.geometry=F;return E})};a.timeOnlyToMilliseconds=u;a.verifyBasicFieldValidity=function(y,B,z){const A=m({layer:y,fields:B});if(A.length)return new n(z,"Unknown fields: "+A.join(", ")+". You can only use fields defined in the layer schema");y=q({layer:y,fields:B});if(y.length)return new n(z,"Unsupported fields: "+y.join(", ")+
". You can only use fields that can be fetched i.e. AdapterFieldUsageInfo.supportsStatistics must be true")};a.verifyFieldType=function(y,B,z,A){let C;B?B.name!==y.objectIdField&&A.includes(B.type)||(C=new n(z,"'field' should be one of these types: "+A.join(","))):C=new n(z,"'field' is not defined in the layer schema");return C};a.verifyFilterValidity=function(y,B){if(y&&"intersects"!==y.spatialRelationship)return new n(B,"Only 'intersects' spatialRelationship is supported for featureFilter")};a.verifyNumericField=
function(y,B,z){let A;B?B.name!==y.objectIdField&&d.isNumericField(B)||(A=new n(z,"'field' should be one of these numeric types: "+d.numericTypes.join(","))):A=new n(z,"'field' is not defined in the layer schema");return A};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/smartMapping/support/utils":function(){define("exports ../../intl/date ../../layers/support/fieldUtils ../../support/arcadeOnDemand ../../support/basemapUtils ../../time/timeZoneUtils".split(" "),function(a,
b,n,k,p,h){function e(x){return String(x).padStart(2,"0")}function g(x,u,t){if("date"===u||"number"===u){"number"===u&&(x=new Date(x));u=t?x.getFullYear():x.getUTCFullYear();const m=e((t?x.getMonth():x.getUTCMonth())+1),q=e(t?x.getDate():x.getUTCDate()),r=e(t?x.getHours():x.getUTCHours()),v=e(t?x.getMinutes():x.getUTCMinutes());x=e(t?x.getSeconds():x.getUTCSeconds());x=`TIMESTAMP'${u}-${m}-${q} ${r}:${v}:${x}'`}return x}function d(x,u){if(u instanceof Date)return"date";if("number"===typeof u)return"number";
if("string"===typeof u&&(x=x.getField(u),"\x3cnow\x3e"!==u.toLowerCase()&&n.isDateField(x)))return"field"}const f={light:"streets gray topo terrain oceans osm gray-vector streets-vector topo-vector streets-relief-vector streets-navigation-vector topo-3d navigation-3d streets-3d osm-3d gray-3d arcgis-light-gray arcgis-navigation arcgis-streets arcgis-streets-relief arcgis-topographic arcgis-oceans osm-standard osm-standard-relief osm-streets osm-streets-relief osm-light-gray arcgis-terrain arcgis-charted-territory arcgis-community arcgis-colored-pencil arcgis-modern-antique arcgis-midcentury arcgis-newspaper arcgis-hillshade-light".split(" "),
dark:"satellite hybrid dark-gray dark-gray-vector streets-night-vector navigation-dark-3d streets-dark-3d dark-gray-3d arcgis-imagery arcgis-imagery-standard arcgis-dark-gray arcgis-navigation-night arcgis-streets-night osm-dark-gray arcgis-nova arcgis-hillshade-dark".split(" ")},c={years:365,months:30,days:1,hours:1/24,minutes:1/1440,seconds:1/86400,milliseconds:1/864E5},l=new Set(["integer","small-integer"]);let w=null;a.castIntegerFieldToFloat=function(x){return`cast(${x} as float)`};a.dateTypes=
["date","date-only","timestamp-offset"];a.defaultBasemapGroups=f;a.defaultStatisticTypes={exclude:["median"]};a.fieldDelimiter=",";a.formatAnyDate=function(x,u){const {format:t,timeZoneOptions:m,fieldType:q}=u??{};let r;m&&({timeZone:v,timeZoneName:r}=h.getTimeZoneFormattingOptions(m.layerTimeZone,m.datesInUnknownTimezone,m.viewTimeZone,b.convertDateFormatToIntlOptions(t||"short-date-short-time"),q));if("string"===typeof x&&isNaN(Date.parse("time-only"===q?`1970-01-01T${x}Z`:x)))return x;switch(q){case "date-only":var v=
b.convertDateFormatToIntlOptions(t||"short-date");return"string"===typeof x?b.formatDateOnly(x,{...v}):b.formatDate(x,{...v,timeZone:h.utc});case "time-only":return v=b.convertDateFormatToIntlOptions(t||"short-time"),"string"===typeof x?b.formatTimeOnly(x,v):b.formatDate(x,{...v,timeZone:h.utc});case "timestamp-offset":if(!v&&"string"===typeof x&&(new Date(x)).toISOString()!==x)return x;v=(u=t||m?b.convertDateFormatToIntlOptions(t||"short-date-short-time"):void 0)?{...u,timeZone:v,timeZoneName:r}:
void 0;return"string"===typeof x?b.formatTimestamp(x,v):b.formatDate(x,v);default:return u=t||m?b.convertDateFormatToIntlOptions(t||"short-date-short-time"):void 0,b.formatDate("string"===typeof x?new Date(x):x,u?{...u,timeZone:v,timeZoneName:r}:void 0)}};a.getBasemapGroup=function(x,u=f){for(const t in u)if(u[t].includes(x))return t};a.getBasemapId=function(x,u,t=!0){let m=null;x&&("string"===typeof x?u.includes(x)&&(m=x):m=p.getWellKnownBasemapId(x));return t?m||"gray":m};a.getDateDiffSQL=function(x,
u,t,m){const {hasQueryEngine:q}=x;t=g(t,d(x,t),q);x=g(u,d(x,u),q);x=`(${t} - ${x})`;m=c[m];u="/";1>m&&(m=1/m,u="*");return{sqlExpression:1===m?x:`(${x} ${u} ${m})`,sqlWhere:null}};a.getDateType=d;a.getFieldsList=async function(x){const {field:u,field2:t,field3:m,normalizationField:q,valueExpression:r}=x;x=[];r&&(w||({arcadeUtils:x}=await k.loadArcade(),w=x),x=w.extractFieldNames(r));u&&x.push(u);t&&x.push(t);m&&x.push(m);q&&x.push(q);return x};a.getNormalizationType=function(x){let u=x.normalizationType;
u||(x.normalizationField?u="field":null!=x.normalizationTotal&&(u="percent-of-total"));return u??void 0};a.isAnyDateField=function(x){return n.isDateField(x)||n.isDateOnlyField(x)||n.isTimestampOffsetField(x)};a.isIntegerField=function(x,u){x=u&&x.getField(u);return!!x&&l.has(x.type)};a.unitValueInDays=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/statistics/utils":function(){define(["exports","../rest/support/ClassBreaksDefinition","../rest/support/generateRendererUtils"],
function(a,b,n){function k(D){return null==D||"string"===typeof D&&!D?"\x3cNull\x3e":D}function p(D){const I=null!=D.minValue||null!=D.maxValue,J=!!D.sqlExpression&&D.supportsSQLExpression;return!(null!=D.normalizationField||null!=D.normalizationType)&&!I&&!J}function h(D){const {values:I,useSampleStdDev:J,supportsNullCount:N,outStatisticTypes:M}=D;var Q=Number.POSITIVE_INFINITY;let O=Number.NEGATIVE_INFINITY,K=null,L=null;var P=null;let R=null,W=0;const V=null==D.minValue?-Infinity:D.minValue,ba=
null==D.maxValue?Infinity:D.maxValue;for(const U of I)Number.isFinite(U)?U>=V&&U<=ba&&(K=null===K?U:K+U,Q=Math.min(Q,U),O=Math.max(O,U),W++):"string"===typeof U&&W++;if(W&&null!=K){L=K/W;P=0;for(const U of I)Number.isFinite(U)&&U>=V&&U<=ba&&(P+=(U-L)**2);R=J?1<W?P/(W-1):0:0<W?P/W:0;P=Math.sqrt(R)}else O=Q=null;Q={avg:L,count:W,max:O,min:Q,stddev:P,sum:K,variance:R};N&&(Q.nullcount=I.length-W);!D.percentileParams||M?.include?.length&&!M.include.includes("median")||M?.exclude?.length&&M.exclude.includes("median")||
(Q.median=e(I,D.percentileParams));return Q}function e(D,I){const {fieldType:J,value:N,orderBy:M,isDiscrete:Q}=I,O=g(J,"desc"===M);D=[...D].filter(R=>null!=R).sort((R,W)=>O(R,W));if(0===D.length)return null;if(0>=N)return D[0];if(1<=N)return D[D.length-1];var K=(D.length-1)*N,L=Math.floor(K);I=L+1;K%=1;L=D[L];const P=D[I];return I>=D.length||Q||"string"===typeof L||"string"===typeof P?L:L*(1-K)+P*K}function g(D,I){if(D){if(r.has(D))return I?F:G;if(v.has(D))return d(I,!1);if("esriFieldTypeTimestampOffset"===
D)return I?C:A;const O=d(I,!0);if("esriFieldTypeString"===D)return O;if("esriFieldTypeGUID"===D||"esriFieldTypeGlobalID"===D)return(K,L)=>O(f(K),f(L))}const J=I?1:-1,N=I?F:G,M=d(I,!0),Q=I?B:z;return(O,K)=>"number"===typeof O&&"number"===typeof K?N(O,K):"string"===typeof O&&"string"===typeof K?M(O,K):Q(O,K)??J}function d(D,I){if(!I)return D?E:H;const J=D?B:z;return D?(N,M)=>{const Q=J(N,M);if(null!=Q)return Q;N=N.toUpperCase();M=M.toUpperCase();return N>M?-1:N<M?1:0}:(N,M)=>{const Q=J(N,M);if(null!=
Q)return Q;N=N.toUpperCase();M=M.toUpperCase();return N<M?-1:N>M?1:0}}function f(D){return D.slice(24,36)+D.slice(19,23)+D.slice(16,18)+D.slice(14,16)+D.slice(11,13)+D.slice(9,11)+D.slice(6,8)+D.slice(4,6)+D.slice(2,4)+D.slice(0,2)}function c(D){return"coded-value"!==D?.type?[]:D.codedValues.map(I=>I.code)}function l(D,I){const J=x({field:I.field,normalizationType:I.normalizationType,normalizationField:I.normalizationField,classificationMethod:I.classificationMethod,standardDeviationInterval:I.standardDeviationInterval,
breakCount:I.numClasses||5});D=w(D,I.minValue,I.maxValue);return n.createGenerateRendererClassBreaks({definition:J,values:D,normalizationTotal:I.normalizationTotal})}function w(D,I,J){const N=null==I?-Infinity:I,M=null==J?Infinity:J;return D.filter(Q=>Number.isFinite(Q)&&Q>=N&&Q<=M)}function x(D){const {breakCount:I,field:J,normalizationField:N,normalizationType:M}=D,Q=D.classificationMethod||"equal-interval";return new b({breakCount:I,classificationField:J,classificationMethod:Q,normalizationField:"field"===
M?N:void 0,normalizationType:M,standardDeviationInterval:"standard-deviation"===Q?D.standardDeviationInterval||1:void 0,definedInterval:"defined-interval"===Q?D.definedInterval:void 0})}function u(D,I){const {field:J,classificationMethod:N,standardDeviationInterval:M,normalizationType:Q,normalizationField:O,normalizationTotal:K,minValue:L,maxValue:P}=I,R=I.numBins||10;let W=I=null,V=null;N&&"equal-interval"!==N||Q?({classBreaks:D}=l(D,{field:J,normalizationType:Q,normalizationField:O,normalizationTotal:K,
classificationMethod:N,standardDeviationInterval:M,minValue:L,maxValue:P,numClasses:R}),I=D[0].minValue,W=D[D.length-1].maxValue,V=D.map(ba=>[ba.minValue,ba.maxValue])):(null!=L&&null!=P?(I=L,W=P):(D=h({values:D,minValue:L,maxValue:P,useSampleStdDev:!Q,supportsNullCount:p({normalizationType:Q,normalizationField:O,minValue:L,maxValue:P})}),I=D.min??null,W=D.max??null),V=m(I??0,W??0,R));return{min:I,max:W,intervals:V}}function t(D,I){let J=-1;for(let N=D.length-1;0<=N;N--)if(I>=D[N][0]){J=N;break}return J}
function m(D,I,J){const N=(I-D)/J,M=[];let Q;for(let O=1;O<=J;O++)Q=D+N,Q=Number(Q.toFixed(16)),M.push([D,O===J?I:Q]),D=Q;return M}const q=/\s*(\+|-)?((\d+(\.\d+)?)|(\.\d+))\s*/gi,r=new Set("esriFieldTypeDate esriFieldTypeInteger esriFieldTypeSmallInteger esriFieldTypeSingle esriFieldTypeDouble esriFieldTypeLong esriFieldTypeOID esriFieldTypeBigInteger".split(" ")),v=new Set(["esriFieldTypeTimeOnly","esriFieldTypeDateOnly"]),y="min max avg stddev count sum variance nullcount median".split(" "),B=
(D,I)=>null==D?null==I?0:1:null==I?-1:null,z=(D,I)=>null==D?null==I?0:-1:null==I?1:null,A=(D,I)=>z(D,I)??(D===I?0:(new Date(D)).getTime()-(new Date(I)).getTime()),C=(D,I)=>B(D,I)??(D===I?0:(new Date(I)).getTime()-(new Date(D)).getTime()),H=(D,I)=>z(D,I)??(D===I?0:D<I?-1:1),E=(D,I)=>B(D,I)??(D===I?0:D<I?1:-1),F=(D,I)=>B(D,I)??I-D,G=(D,I)=>z(D,I)??D-I;a.calculateClassBreaks=l;a.calculateHistogram=function(D,I){var J=u(D,I);if(null==J.min&&null==J.max)return{bins:[],minValue:J.min,maxValue:J.max,normalizationTotal:I.normalizationTotal};
const N=J.intervals,M=J.min??0;J=J.max??0;const Q=N.map((O,K)=>({minValue:N[K][0],maxValue:N[K][1],count:0}));for(const O of D)null!=O&&O>=M&&O<=J&&(D=t(N,O),-1<D&&Q[D].count++);return{bins:Q,minValue:M,maxValue:J,normalizationTotal:I.normalizationTotal}};a.calculatePercentile=e;a.calculateStatistics=h;a.calculateStringStatistics=function(D){const {outStatisticTypes:I}=D,J=D.returnDistinct?[...(new Set(D.values))]:D.values;var N=J.filter(Q=>null!=Q).sort();const M=N.length;N={count:M,min:N[0],max:N[M-
1]};D.supportsNullCount&&(N.nullcount=J.length-M);!D.percentileParams||I?.include?.length&&!I.include.includes("median")||I?.exclude?.length&&I.exclude.includes("median")||(N.median=e(J,D.percentileParams));return N};a.calculateUniqueValuesCount=function(D){const I={};for(let J of D){if(null==J||"string"===typeof J&&""===J.trim())J=null;null==I[J]?I[J]={count:1,data:J}:I[J].count++}return{count:I}};a.createClassBreaksDefinition=x;a.createUVResult=function(D,I,J,N){D=D.count;const M=[];if(J&&I){J=
[];var Q=c(I[0]);for(const O of Q)if(I[1]){Q=c(I[1]);for(const K of Q)if(I[2]){Q=c(I[2]);for(const L of Q)J.push(`${k(O)}${N}${k(K)}${N}${k(L)}`)}else J.push(`${k(O)}${N}${k(K)}`)}else J.push(O);for(const O of J)D.hasOwnProperty(O)||(D[O]={data:O,count:0})}for(const O in D)I=D[O],M.push({value:I.data,count:I.count,label:I.label});return{uniqueValueInfos:M}};a.getAttributeComparator=g;a.getEqualIntervalBins=m;a.getNormalizedValue=function(D,I,J,N){let M=null;switch(I){case "log":0!==D&&(M=Math.log(D)*
Math.LOG10E);break;case "percent-of-total":Number.isFinite(N)&&0!==N&&(M=D/N*100);break;case "field":Number.isFinite(J)&&0!==J&&(M=D/J);break;case "natural-log":0<D&&(M=Math.log(D));break;case "square-root":0<D&&(M=D**.5)}return M};a.isNullCountSupported=p;a.processNullValue=k;a.processSummaryStatisticsResult=function(D,I,J){let N;for(N in D)I?.include?.length&&!I.include.includes(N)||I?.exclude?.length&&I.exclude.includes(N)?delete D[N]:y.includes(N)&&(Number.isFinite(D[N])||(D[N]=null));if(!J)return D;
["avg","stddev","variance"].forEach(M=>{null!=D[M]&&(D[M]=Math.ceil(D[M]??0))});return D};a.resolveCBResult=function(D,I){let J=D.classBreaks;const N=J[0]?.minValue,M=J[J.length-1]?.maxValue,Q="standard-deviation"===I;J=J.map(O=>{const K=O.label;O={minValue:O.minValue,maxValue:O.maxValue,label:K};if(Q&&K){const L=K.match(q)?.map(P=>+P.trim())??[];2===L.length?(O.minStdDev=L[0],O.maxStdDev=L[1],0>L[0]&&0<L[1]&&(O.hasAvg=!0)):1===L.length&&(K.includes("\x3c")?(O.minStdDev=null,O.maxStdDev=L[0]):K.includes("\x3e")&&
(O.minStdDev=L[0],O.maxStdDev=null))}return O});return{minValue:N,maxValue:M,classBreakInfos:J,normalizationTotal:D.normalizationTotal}};a.statisticTypes=y;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/rest/support/ClassBreaksDefinition":function(){define("../../chunks/tslib.es6 ../../core/jsonMap ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/has ../../core/Logger ../../core/RandomLCG ../../core/accessorSupport/decorators/enumeration ../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,n,k,p,h,e,g,d){p=new b.JSONMap({esriClassifyEqualInterval:"equal-interval",esriClassifyManual:"manual",esriClassifyNaturalBreaks:"natural-breaks",esriClassifyQuantile:"quantile",esriClassifyStandardDeviation:"standard-deviation",esriClassifyDefinedInterval:"defined-interval"});b=new b.JSONMap({esriNormalizeByLog:"log",esriNormalizeByPercentOfTotal:"percent-of-total",esriNormalizeByField:"field"});n=class extends n.JSONSupport{constructor(f){super(f);this.type="class-breaks-definition";
this.normalizationType=this.normalizationField=this.classificationMethod=this.classificationField=this.breakCount=null}set standardDeviationInterval(f){"standard-deviation"===this.classificationMethod&&this._set("standardDeviationInterval",f)}set definedInterval(f){"defined-interval"===this.classificationMethod&&this._set("definedInterval",f)}};a.__decorate([g.enumeration({classBreaksDef:"class-breaks-definition"})],n.prototype,"type",void 0);a.__decorate([k.property({json:{write:!0}})],n.prototype,
"breakCount",void 0);a.__decorate([k.property({json:{write:!0}})],n.prototype,"classificationField",void 0);a.__decorate([k.property({type:String,json:{read:p.read,write:p.write}})],n.prototype,"classificationMethod",void 0);a.__decorate([k.property({json:{write:!0}})],n.prototype,"normalizationField",void 0);a.__decorate([k.property({json:{read:b.read,write:b.write}})],n.prototype,"normalizationType",void 0);a.__decorate([k.property({value:null,json:{write:!0}})],n.prototype,"standardDeviationInterval",
null);a.__decorate([k.property({value:null,json:{write:!0}})],n.prototype,"definedInterval",null);return n=a.__decorate([d.subclass("esri.rest.support.ClassBreaksDefinition")],n)})},"esri/rest/support/generateRendererUtils":function(){define(["exports","../../core/Logger"],function(a,b){function n(l){var w=l.definition;const {classificationMethod:x,normalizationType:u,definedInterval:t}=w;w=w.breakCount??1;const m=[];var q=l.values;if(0===q.length)return[];q=q.sort((A,C)=>A-C);var r=q[0],v=q[q.length-
1];if("equal-interval"===x)if(q.length>=w){q=(v-r)/w;l=r;for(var y=1;y<w;y++){var B=Number((r+y*q).toFixed(6));m.push({minValue:l,maxValue:B,label:k(l,B,u)});l=B}m.push({minValue:l,maxValue:v,label:k(l,v,u)})}else q.forEach(A=>{m.push({minValue:A,maxValue:A,label:k(A,A,u)})});else if("natural-breaks"===x){q=p(q);l=h(q.uniqueValues,l.valueFrequency||q.valueFrequency,w);for(y=1;y<w;y++)q.uniqueValues.length>y&&(B=Number(q.uniqueValues[l[y]].toFixed(6)),m.push({minValue:r,maxValue:B,label:k(r,B,u)}),
r=B);m.push({minValue:r,maxValue:v,label:k(r,v,u)})}else if("quantile"===x)if(q.length>=w&&r!==v){l=Math.ceil(q.length/w);y=0;for(B=1;B<w;B++){var z=l+y-1;z>q.length&&(z=q.length-1);0>z&&(z=0);m.push({minValue:r,maxValue:q[z],label:k(r,q[z],u)});r=q[z];y+=l;l=Math.ceil((q.length-y)/(w-B))}m.push({minValue:r,maxValue:v,label:k(r,v,u)})}else for(w=-1,v=0;v<q.length;v++)r=q[v],r!==w&&(w=r,m.push({minValue:w,maxValue:r,label:k(w,r,u)}),w=r);else if("standard-deviation"===x)if(l=d(q),y=f(q,l),0===y)m.push({minValue:q[0],
maxValue:q[0],label:k(q[0],q[0],u)});else{q=g(r,v,w,l,y)*y;y=0;for(B=w;1<=B;B--)z=Number((l-(B-.5)*q).toFixed(6)),m.push({minValue:r,maxValue:z,label:k(r,z,u)}),r=z,y++;B=Number((l+.5*q).toFixed(6));m.push({minValue:r,maxValue:B,label:k(r,B,u)});r=B;y++;for(z=1;z<=w;z++)B=y===2*w?v:Number((l+(z+.5)*q).toFixed(6)),m.push({minValue:r,maxValue:B,label:k(r,B,u)}),r=B,y++}else if("defined-interval"===x){if(!t)return m;w=q[0];v=q[q.length-1];q=Math.ceil((v-w)/t);r=w;for(l=1;l<q;l++)y=Number((w+l*t).toFixed(6)),
m.push({minValue:r,maxValue:y,label:k(r,y,u)}),r=y;m.push({minValue:r,maxValue:v,label:k(r,v,u)})}return m}function k(l,w,x){let u=null;return u=l===w?x&&"percent-of-total"===x?l+"%":l.toString():x&&"percent-of-total"===x?l+"% - "+w+"%":l+" - "+w}function p(l){const w=[],x=[];let u=Number.MIN_VALUE,t=1,m=-1;for(let q=0;q<l.length;q++){const r=l[q];r===u?(t++,x[m]=t):null!==r&&(w.push(r),u=r,t=1,x.push(t),m++)}return{uniqueValues:w,valueFrequency:x}}function h(l,w,x){var u=l.length;const t=[];x>u&&
(x=u);for(var m=0;m<x;m++)t.push(Math.round(m*u/x-1));t.push(u-1);m=e(t,l,w,x);u=m.mean;m=m.sdcm;var q=x,r=0,v=0;let y=0,B=0,z=!0;for(let C=0;2>C&&z;C++){0===C&&(z=!1);for(var A=0;A<q-1;A++)for(;t[A+1]+1!==t[A+2];)if(t[A+1]+=1,r=c(A,t,l,w),y=r.sbMean,r=r.sbSdcm,v=c(A+1,t,l,w),B=v.sbMean,v=v.sbSdcm,r+v<m[A]+m[A+1])m[A]=r,m[A+1]=v,u[A]=y,u[A+1]=B,z=!0;else{--t[A+1];break}for(A=q-1;0<A;A--)for(;t[A]!==t[A-1]+1;)if(--t[A],r=c(A-1,t,l,w),y=r.sbMean,r=r.sbSdcm,v=c(A,t,l,w),B=v.sbMean,v=v.sbSdcm,r+v<m[A-
1]+m[A])m[A-1]=r,m[A]=v,u[A-1]=y,u[A]=B,z=!0;else{t[A]+=1;break}}z&&(m=e(t,l,w,x));return t}function e(l,w,x,u){let t=[];var m=[],q=[];let r=0;const v=[],y=[];for(var B=0;B<u;B++){var z=c(B,l,w,x);v.push(z.sbMean);y.push(z.sbSdcm);r+=y[B]}z=r;for(B=!0;B||r<z;){B=!1;t=[];for(m=0;m<u;m++)t.push(l[m]);for(q=0;q<u;q++)for(z=l[q]+1;z<=l[q+1];z++)if(m=w[z],0<q&&z!==l[q+1]&&Math.abs(m-v[q])>Math.abs(m-v[q-1]))l[q]=z;else if(q<u-1&&l[q]!==z-1&&Math.abs(m-v[q])>Math.abs(m-v[q+1])){l[q+1]=z-1;break}z=r;r=0;
m=[];q=[];for(let A=0;A<u;A++){m.push(v[A]);q.push(y[A]);const C=c(A,l,w,x);v[A]=C.sbMean;y[A]=C.sbSdcm;r+=y[A]}}if(r>z){for(w=0;w<u;w++)l[w]=t[w],v[w]=m[w],y[w]=q[w];r=z}return{mean:v,sdcm:y}}function g(l,w,x,u,t){l=Math.max(u-l,w-u)/t/x;return 1<=l?1:.5<=l?.5:.25}function d(l){let w=0;for(let x=0;x<l.length;x++)w+=l[x];return w/=l.length}function f(l,w){let x=0;for(let u=0;u<l.length;u++){const t=l[u];x+=(t-w)*(t-w)}x/=l.length;return Math.sqrt(x)}function c(l,w,x,u){var t=0,m=0;for(var q=w[l]+
1;q<=w[l+1];q++){const r=u[q];t+=x[q]*r;m+=r}0>=m&&b.getLogger("esri.rest.support.generateRendererUtils").warn("Exception in Natural Breaks calculation");t/=m;m=0;for(q=w[l]+1;q<=w[l+1];q++)m+=u[q]*(x[q]-t)**2;return{sbMean:t,sbSdcm:m}}a.createGenerateRendererClassBreaks=function(l){const {normalizationTotal:w}=l;return{classBreaks:n(l),normalizationTotal:w}};a.createGenerateRendererUniqueValues=function(l){l=p(l);const w=[],x=l.uniqueValues.length;for(let u=0;u<x;u++){const t=l.uniqueValues[u];w.push({value:t,
count:l.valueFrequency[u],label:t.toString()})}return{uniqueValues:w}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/SnappingCandidate":function(){define(["exports"],function(a){a.makeEdgeCandidate=function(b,n,k,p,h,e=!1){return{objectId:b,target:n,distance:k,type:"edge",start:p,end:h,draped:e}};a.makeVertexCandidate=function(b,n,k){return{objectId:b,target:n,distance:k,type:"vertex"}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/queryUtils":function(){define("require exports ../../../core/jsonMap ../../../core/unitUtils ../../../geometry/projection ../../../geometry/support/extentUtils ../../../geometry/support/jsonUtils ../../../geometry/support/normalizeUtils ../../../geometry/support/spatialReferenceUtils ./projectionSupport".split(" "),
function(a,b,n,k,p,h,e,g,d,f){async function c(m,q,r){if(!m)return null;var {where:v}=m;m.where=v=v?.trim();if(!v||/^1 *= *1$/.test(v)||q&&q===v)m.where=null;if(!m.geometry)return m;q=await w(m);m.distance=0;m.units=null;"esriSpatialRelEnvelopeIntersects"===m.spatialRel&&({spatialReference:v}=m.geometry,q=h.getGeometryExtent(q),q.spatialReference=v);if(q){await f.checkProjectionSupport(q.spatialReference,r);v=q.spatialReference;q=l(q,r)&&e.isExtent(q)?{spatialReference:v,rings:[[[q.xmin,q.ymin],[q.xmin,
q.ymax],[q.xmax,q.ymax],[q.xmax,q.ymin],[q.xmin,q.ymin]]]}:q;v=(await g.normalizeCentralMeridian(e.fromJSON(q)))[0];if(null==v)throw t;const y="quantizationParameters"in m&&m.quantizationParameters?.tolerance||"maxAllowableOffset"in m&&m.maxAllowableOffset||0;q=y&&l(q,r)?{densificationStep:8*y}:void 0;v=v.toJSON();q=f.project(v,v.spatialReference,r,q);if(!q)throw t;q.spatialReference=r;m.geometry=q}return m}function l(m,q){if(!m)return!1;const r=m.spatialReference;return(e.isExtent(m)||e.isPolygon(m)||
e.isPolyline(m))&&!d.equals(r,q)&&!p.canProjectWithoutEngine(r,q)}async function w(m){const {distance:q,units:r}=m,v=m.geometry;if(null==q||"vertexAttributes"in v)return v;var y=v.spatialReference;m=r?u.fromJSON(r):k.getUnitString(y);y=y&&(d.isGeographic(y)||d.isWebMercator(y))?v:await f.checkProjectionSupport(y,d.wgs84).then(()=>f.project(v,d.wgs84));return(await x())(y.spatialReference,y,q,m)}async function x(){return(await new Promise((m,q)=>a(["../../../geometry/geometryEngineJSON"],m,q))).geodesicBuffer}
const u=new n.JSONMap({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"}),t=Object.freeze({});b.normalizeQuery=async function(m,q,r){const {outFields:v,orderByFields:y,groupByFieldsForStatistics:B,outStatistics:z}=m;if(v)for(var A=0;A<v.length;A++)v[A]=v[A].trim();if(y)for(A=0;A<y.length;A++)y[A]=y[A].trim();if(B)for(A=0;A<B.length;A++)B[A]=B[A].trim();
if(z)for(A=0;A<z.length;A++)z[A].onStatisticField&&(z[A].onStatisticField=z[A].onStatisticField.trim());m.geometry&&!m.outSR&&(m.outSR=m.geometry.spatialReference);return c(m,q,r)};b.normalizeQueryLike=c;b.queryEngineEmptyResult=t;b.unitsKebabDict=u;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/queryValidationUtils":function(){define("exports ../../../core/Error ./attributeSupport ./projectionSupport ./spatialQuerySupport ../../../support/arcadeOnDemand".split(" "),
function(a,b,n,k,p,h){function e(l,w,x){const {outFields:u,orderByFields:t,returnDistinctValues:m,outStatistics:q}=x,r=q?q.map(v=>v.outStatisticFieldName&&v.outStatisticFieldName.toLowerCase()).filter(Boolean):[];if(t&&0<t.length){const v=t.map(y=>{const B=y.toLowerCase();return B.includes(" asc")?B.split(" asc")[0]:B.includes(" desc")?B.split(" desc")[0]:y}).filter(y=>!r.includes(y));n.validateFields(l,w,v,{expressionName:"orderByFields",query:x})}if(u&&0<u.length)n.validateFields(l,w,u,{expressionName:"outFields",
query:x,allowedFieldTypes:"all"});else if(m)throw new b("unsupported-query","outFields should be specified for returnDistinctValues",{query:x});n.validateWhere(l,w,x.where,x)}function g(l,w,x){const {outStatistics:u,groupByFieldsForStatistics:t,having:m}=x;var q=t?.length,r=u?.length;if(m){if(!q||!r)throw new b("unsupported-query","outStatistics and groupByFieldsForStatistics should be specified with having",{query:x});n.validateHaving(l,w,m,u,x)}if(r&&f(u)){r=u.map(v=>v.onStatisticField).filter(Boolean);
n.validateFields(l,w,r,{expressionName:"onStatisticFields",query:x});q&&n.validateFields(l,w,t,{expressionName:"groupByFieldsForStatistics",query:x});for(const v of u){const {onStatisticField:y,statisticType:B}=v;if(("percentile_disc"===B||"percentile_cont"===B)&&"statisticParameters"in v){if({statisticParameters:q}=v,!q)throw new b("unsupported-query","statisticParameters should be set for percentile type",{definition:v,query:x});}else l.get(y)&&"count"!==B&&"min"!==B&&"max"!==B&&n.validateFields(l,
w,[y],{expressionName:`outStatistics with '${B}' statistic type`,allowedFieldTypes:c,query:x})}}}async function d(l,w,x,u){var t=[];x.valueExpression&&({arcadeUtils:t}=await h.loadArcade(),t=t.extractFieldNames(x.valueExpression));x.field&&t.push(x.field);x.field2&&t.push(x.field2);x.field3&&t.push(x.field3);x.normalizationField&&t.push(x.normalizationField);if(!t.length&&!x.valueExpression)throw new b("unsupported-query","field or valueExpression is required",{params:x});n.validateFields(l,w,t,{expressionName:"statistics",
query:u})}function f(l){return null!=l&&l.every(w=>"exceedslimit"!==w.statisticType)}const c=new Set([...n.numericFieldTypes,...n.allDateAndTimeFieldTypes]);a.validateQuery=async function(l,{fieldsIndex:w,geometryType:x,spatialReference:u,availableFields:t}){if(0>(l.distance??0)||null!=l.geometryPrecision||l.multipatchOption&&"xyFootprint"!==l.multipatchOption||l.pixelSize||l.relationParam||l.text)throw new b("unsupported-query","Unsupported query options",{query:l});e(w,t,l);g(w,t,l);return Promise.all([p.checkSpatialQuerySupport(l,
x,u),k.checkProjectionSupport(u,l.outSR)]).then(()=>l)};a.validateStatisticsQuery=async function(l,w,{fieldsIndex:x,geometryType:u,spatialReference:t,availableFields:m}){if(0>(l.distance??0)||null!=l.geometryPrecision||l.multipatchOption||l.pixelSize||l.relationParam||l.text||l.outStatistics||l.groupByFieldsForStatistics||l.having||l.orderByFields)throw new b("unsupported-query","Unsupported query options",{query:l});e(x,m,l);return Promise.all([d(x,m,w,l),p.checkSpatialQuerySupport(l,u,t),k.checkProjectionSupport(t,
l.outSR)]).then(()=>l)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/spatialQuerySupport":function(){define("require exports ../../../core/Error ../../../geometry/support/contains ../../../geometry/support/intersects ../../../geometry/support/jsonUtils ../../../geometry/support/spatialReferenceUtils ../contains ../featureConversionUtils ../OptimizedGeometry ./geometryUtils ./projectionSupport".split(" "),function(a,b,n,k,p,h,e,g,d,f,c,l){function w(){return new Promise((q,
r)=>a(["../../../geometry/geometryEngineJSON"],q,r))}const x={esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"intersects",esriSpatialRelIndexIntersects:null,esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:null};var u={esriSpatialRelIntersects:!0,esriSpatialRelContains:!0,esriSpatialRelWithin:!0,esriSpatialRelCrosses:!0,
esriSpatialRelDisjoint:!0,esriSpatialRelTouches:!0,esriSpatialRelOverlaps:!0,esriSpatialRelEnvelopeIntersects:!0,esriSpatialRelIndexIntersects:!1,esriSpatialRelRelation:!1},t={esriGeometryPoint:!0,esriGeometryMultiPatch:!1,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!0},m={esriGeometryPoint:!0,esriGeometryMultiPatch:!0,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!1};b.canQueryWithRBush=function(q){if(h.isExtent(q))return!0;
if(h.isPolygon(q)){for(const r of q.rings)if(5!==r.length||r[0][0]!==r[1][0]||r[0][0]!==r[4][0]||r[2][0]!==r[3][0]||r[0][1]!==r[3][1]||r[0][1]!==r[4][1]||r[1][1]!==r[2][1])return!1;return!0}return!1};b.checkSpatialQuerySupport=async function(q,r,v){const {spatialRel:y,geometry:B}=q;if(B){if(null==y||!0!==u[y])throw new n("unsupported-query","Unsupported query spatial relationship",{query:q});if(e.isValid(B.spatialReference)&&e.isValid(v)){if(null==B||!0!==t[h.getJsonType(B)])throw new n("unsupported-query",
"Unsupported query geometry type",{query:q});if(null==r||!0!==m[r])throw new n("unsupported-query","Unsupported layer geometry type",{query:q});if(q.outSR)return l.checkProjectionSupport(q.geometry?.spatialReference,q.outSR)}}};b.getSpatialQueryOperator=function(q,r,v,y,B){if(h.isPolygon(r)&&"esriGeometryPoint"===v&&("esriSpatialRelIntersects"===q||"esriSpatialRelContains"===q)){const z=d.convertFromPolygon(new f,r,!1,!1);return Promise.resolve(A=>g.polygonContainsPoint(z,!1,!1,A))}if(h.isPolygon(r)&&
"esriGeometryMultipoint"===v){const z=d.convertFromPolygon(new f,r,!1,!1);if("esriSpatialRelContains"===q)return Promise.resolve(A=>g.polygonContainsMultipoint(z,!1,!1,A,y,B))}if(h.isExtent(r)&&"esriGeometryPoint"===v&&("esriSpatialRelIntersects"===q||"esriSpatialRelContains"===q))return Promise.resolve(z=>k.extentContainsPoint(r,c.getGeometry(v,y,B,z)));if(h.isExtent(r)&&"esriGeometryMultipoint"===v&&"esriSpatialRelContains"===q)return Promise.resolve(z=>k.extentContainsMultipoint(r,c.getGeometry(v,
y,B,z)));if(h.isExtent(r)&&"esriSpatialRelIntersects"===q){const z=p.getExtentIntersector(v);return Promise.resolve(A=>z(r,c.getGeometry(v,y,B,A)))}return w().then(z=>{const A=z[x[q]].bind(null,r.spatialReference,r);return C=>A(c.getGeometry(v,y,B,C))})};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/intersects":function(){define(["exports","./intersectsBase"],function(a,b){a.extentIntersectsExtent=b.extentIntersectsExtent;a.extentIntersectsMultipoint=b.extentIntersectsMultipoint;
a.extentIntersectsPoint=b.extentIntersectsPoint;a.extentIntersectsPolygon=b.extentIntersectsPolygon;a.extentIntersectsPolyline=b.extentIntersectsPolyline;a.getFeatureExtentIntersector=b.getFeatureExtentIntersector;a.isSelfIntersecting=b.isSelfIntersecting;a.segmentIntersects=b.segmentIntersects;a.getExtentIntersector=function(n){return"mesh"===n?b.extentIntersectsExtent:b.getFeatureExtentIntersector(n)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/contains":function(){define(["exports"],
function(a){function b(n,k,p,h,e){if(!n)return!1;k=k?p?4:3:p?3:2;const {coords:g,lengths:d}=n;p=!1;n=0;for(const c of d){var f=n;for(let l=n,w=n+c*k;l<w;l+=k){f=l+k;f===w&&(f=n);const x=g[l],u=g[l+1],t=g[f];f=g[f+1];(u<e&&f>=e||f<e&&u>=e)&&x+(e-u)/(f-u)*(t-x)<h&&(p=!p)}n+=c*k}return p}a.polygonContainsCoords=b;a.polygonContainsMultipoint=function(n,k,p,h,e,g){e=e?g?4:3:g?3:2;const {coords:d,lengths:f}=h;if(!f)return!1;for(let c=0,l=0;c<f.length;c++,l+=e)if(!b(n,k,p,d[l],d[l+1]))return!1;return!0};
a.polygonContainsPoint=function(n,k,p,h){return b(n,k,p,h.coords[0],h.coords[1])};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/timeSupport":function(){define(["exports"],function(a){function b(p,h,e,g,d){if(null!=g&&null!=d)return f=>{const c=p(f,h);f=p(f,e);return(null==c||c<=d)&&(null==f||f>=g)};if(null!=g)return f=>{f=p(f,e);return null==f||f>=g};if(null!=d)return f=>{f=p(f,h);return null==f||f<=d}}function n(p,h,e,g){if(null!=e&&null!=g&&e===g)return d=>
p(d,h)===e;if(null!=e&&null!=g)return d=>{d=p(d,h);return null!=d&&d>=e&&d<=g};if(null!=e)return d=>{d=p(d,h);return null!=d&&d>=e};if(null!=g)return d=>{d=p(d,h);return null!=d&&d<=g}}function k(){return()=>!1}a.getTimeExtent=async function(p,h){if(!p)return null;const e=h.featureAdapter,{startTimeField:g,endTimeField:d}=p;let f=Number.POSITIVE_INFINITY,c=Number.NEGATIVE_INFINITY;if(g&&d)await h.forEach(l=>{const w=e.getAttribute(l,g);l=e.getAttribute(l,d);null==w||isNaN(w)||(f=Math.min(f,w));null==
l||isNaN(l)||(c=Math.max(c,l))});else{const l=g||d;await h.forEach(w=>{w=e.getAttribute(w,l);null==w||isNaN(w)||(f=Math.min(f,w),c=Math.max(c,w))})}return{start:f,end:c}};a.getTimeOperator=function(p,h,e){if(!h||!p)return null;const {startTimeField:g,endTimeField:d}=p;if(!g&&!d)return null;const {start:f,end:c}=h;if(null===f&&null===c)return null;if(void 0===f&&void 0===c)return k();p=e.getAttributeAsTimestamp?.bind(e)??e.getAttribute.bind(e);return g&&d?b(p,g,d,f,c):n(p,g||d,f,c)};Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/support/highlightUtils":function(){define(["exports","../../../../chunks/languageUtils","../../../../core/Collection","../../../../core/handleUtils"],function(a,b,n,k){function p(e){return"number"===typeof e||"string"===typeof e}const h=[];k=k.makeHandle();a.emptyHighlightHandle=k;a.isObjectId=p;a.normalizeHighlightTargetExceptQuery=function(e){return p(e)||b.isGraphic(e)?[e]:n.isCollection(e)?e.toArray():Array.isArray(e)?e:h};Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/chunks/languageUtils":function(){define("exports ../config ../kernel ../arcade/ArcadeDate ../arcade/ArcadeModule ../arcade/executionError ../arcade/FunctionWrapper ../arcade/ImmutableArray ../arcade/ImmutablePathArray ../arcade/ImmutablePointArray ../arcade/featureset/support/shared ../core/number ../core/sql/DateOnly ../core/sql/TimeOnly ../geometry/Extent ../geometry/Geometry ../geometry/Multipoint ../geometry/Point ../geometry/Polygon ../geometry/Polyline ../geometry/SpatialReference ../geometry/support/coordsUtils ../geometry/support/jsonUtils ../intl/locale ../rest/support/Query ./datetime".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w,x,u,t,m,q,r,v,y,B,z,A,C,H){function E(ua,Ma,ab){return""===Ma||null===Ma||void 0===Ma||Ma===ab||Ma===ab?ua:ua=ua.split(Ma).join(ab)}function F(ua){return ua instanceof e.ArcadeFunction}function G(ua){return ua instanceof p.ArcadeModule}function D(ua){return N(ua)||Q(ua)||ha(ua)||T(ua)||S(ua)||M(ua)||null===ua||ua===hb||"number"===typeof ua?!0:!1}function I(ua,Ma){return void 0===ua?Ma:ua}function J(ua){return null==ua?"":L(ua)||fa(ua)?"Array":ha(ua)?"Date":S(ua)?
"Time":T(ua)?"DateOnly":N(ua)?"String":M(ua)?"Boolean":Q(ua)?"Number":"esri.arcade.Attachment"===ua?.declaredClass?"Attachment":"esri.arcade.Portal"===ua?.declaredClass?"Portal":"esri.arcade.Dictionary"===ua?.declaredClass?"Dictionary":da(ua)?"KnowledgeGraph":ua instanceof p.ArcadeModule?"Module":P(ua)?"Feature":ua instanceof q?"Point":ua instanceof r?"Polygon":ua instanceof v?"Polyline":ua instanceof m?"Multipoint":ua instanceof u?"Extent":F(ua)?"Function":V(ua)?"FeatureSet":U(ua)?"FeatureSetCollection":
ua===hb?"":"number"===typeof ua&&isNaN(ua)?"Number":"Unrecognized Type"}function N(ua){return"string"===typeof ua||ua instanceof String}function M(ua){return"boolean"===typeof ua}function Q(ua){return"number"===typeof ua}function O(ua){return"number"===typeof ua&&isFinite(ua)&&Math.floor(ua)===ua}function K(ua){return ua instanceof t}function L(ua){return Array.isArray(ua)}function P(ua){return"esri.arcade.Feature"===ua?.arcadeDeclaredClass?!0:!1}function R(ua){return"esri.Graphic"===ua?.declaredClass}
function W(ua){return ua instanceof C}function V(ua){return"esri.arcade.featureset.support.FeatureSet"===ua?.declaredRootClass}function ba(ua){return"esri.arcade.Dictionary"===ua?.declaredClass}function U(ua){return"esri.arcade.featureSetCollection"===ua?.declaredRootClass}function da(ua){return"esri.rest.knowledgeGraph.KnowledgeGraph"===ua?.declaredClass}function fa(ua){return ua instanceof g}function ha(ua){return ua instanceof k.ArcadeDate}function T(ua){return ua instanceof w.DateOnly}function S(ua){return ua instanceof
x.TimeOnly}function Z(ua){return null!=ua&&"object"===typeof ua}function ia(ua){return ua instanceof Date}function Y(ua,Ma,ab,qb,pb){if(ua.length<Ma||ua.length>ab)throw new h.ArcadeExecutionError(qb,h.ExecutionErrorCodes.WrongNumberOfParameters,pb);}function ea(ua){return 0>ua?-Math.round(-ua):Math.round(ua)}function ka(ua,Ma){if(!isNaN(ua)){if(void 0===Ma||null===Ma||""===Ma)return ua.toString();Ma=E(Ma,"\u2030","");Ma=E(Ma,"\u00a4","");return l.format(ua,{pattern:Ma})}return ua.toString()}function ja(ua,
Ma){return void 0===Ma||null===Ma||""===Ma?ua.toISOString(!0):ua.toFormat(X(Ma),{locale:A.getLocale(),numberingSystem:"latn"})}function X(ua,Ma=!1){ua=ua.replaceAll(/LTS|LT|L{1,4}|l{1,4}/g,"[$\x26]");let ab="";const qb=/(\[[^[]*\])|(\\)?([Hh]mm(ss)?|Mo|M{1,4}|Do|DDDo|D{1,4}|d{2,4}|do?|w[o|w]?|W[o|W]?|Qo?|N{1,5}|YYYYYY|YYYYY|YYYY|YY|y{2,4}|yo?|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|kk?|mm?|ss?|S{1,9}|x|X|zz?|Z{1,5}|.)/g;for(const pb of ua.match(qb)||[])switch(pb){case "D":ab+="d";break;case "DD":ab+=
"dd";break;case "DDD":ab+="o";break;case "d":ab+="c";break;case "ddd":ab+="ccc";break;case "dddd":ab+="cccc";break;case "M":ab+="L";break;case "MM":ab+="LL";break;case "MMM":ab+="LLL";break;case "MMMM":ab+="LLLL";break;case "YY":ab+="yy";break;case "Y":case "YYYY":ab+="yyyy";break;case "Q":ab+="q";break;case "Z":ab+="Z";break;case "ZZ":ab+="ZZ";break;case "ZZZ":ab+="ZZZ";break;case "ZZZZ":ab=Ma?ab+"[ZZZZ]":ab+"ZZZZ";break;case "ZZZZZ":ab=Ma?ab+"[ZZZZZ]":ab+"ZZZZZ";break;case "S":ab+="'S'";break;case "SS":ab+=
"'SS'";break;case "SSS":ab+="u";break;case "A":case "a":ab+="a";break;case "m":case "mm":case "h":case "hh":case "H":case "HH":case "s":case "ss":case "X":case "x":ab+=pb;break;default:ab=2<=pb.length&&"["===pb.slice(0,1)&&"]"===pb.slice(-1)?ab+`'${pb.slice(1,-1)}'`:ab+`'${pb}'`}return ab}function aa(ua,Ma,ab){switch(ab){case "\x3e":return ua>Ma;case "\x3c":return ua<Ma;case "\x3e\x3d":return ua>=Ma;case "\x3c\x3d":return ua<=Ma}return!1}function pa(ua,Ma,ab){if(null===ua){if(null===Ma||Ma===hb)return aa(null,
null,ab);if(Q(Ma))return aa(0,Ma,ab);if(N(Ma)||M(Ma))return aa(0,ta(Ma),ab);if(ha(Ma))return aa(0,Ma.toNumber(),ab);if(S(Ma)||T(Ma))return aa(ua,Ma.toNumber(),ab)}if(ua===hb){if(null===Ma||Ma===hb)return aa(null,null,ab);if(Q(Ma))return aa(0,Ma,ab);if(N(Ma)||M(Ma))return aa(0,ta(Ma),ab);if(ha(Ma))return aa(0,Ma.toNumber(),ab);if(S(Ma)||T(Ma))return aa(ua,Ma.toNumber(),ab)}else if(Q(ua)){if(Q(Ma))return aa(ua,Ma,ab);if(M(Ma))return aa(ua,ta(Ma),ab);if(null===Ma||Ma===hb)return aa(ua,0,ab);if(N(Ma))return aa(ua,
ta(Ma),ab);if(ha(Ma)||S(Ma)||T(Ma))return aa(ua,Ma.toNumber(),ab)}else if(N(ua)){if(N(Ma))return aa(na(ua),na(Ma),ab);if(ha(Ma)||S(Ma)||T(Ma))return aa(ta(ua),Ma.toNumber(),ab);if(Q(Ma))return aa(ta(ua),Ma,ab);if(null===Ma||Ma===hb)return aa(ta(ua),0,ab);if(M(Ma))return aa(ta(ua),ta(Ma),ab)}else if(ha(ua)){if(ha(Ma))return ua.timeZone!==Ma.timeZone&&(ua.isUnknownTimeZone?ua=k.ArcadeDate.arcadeDateAndZoneToArcadeDate(ua,Ma.timeZone):Ma.isUnknownTimeZone&&(Ma=k.ArcadeDate.arcadeDateAndZoneToArcadeDate(Ma,
ua.timeZone))),aa(ua.toNumber(),Ma.toNumber(),ab);if(null===Ma||Ma===hb)return aa(ua.toNumber(),0,ab);if(Q(Ma))return aa(ua.toNumber(),Ma,ab);if(M(Ma)||N(Ma))return aa(ua.toNumber(),ta(Ma),ab);if(S(Ma))throw new h.ArcadeExecutionError(null,h.ExecutionErrorCodes.CannotCompareDateAndTime,null);if(T(Ma))return aa(ua.toNumber(),Ma.toNumber(),ab)}else if(M(ua)){if(M(Ma))return aa(ua,Ma,ab);if(Q(Ma))return aa(ta(ua),ta(Ma),ab);if(ha(Ma)||S(Ma)||T(Ma))return aa(ta(ua),Ma.toNumber(),ab);if(null===Ma||Ma===
hb)return aa(ta(ua),0,ab);if(N(Ma))return aa(ta(ua),ta(Ma),ab)}else if(T(ua)){if(ha(Ma))return aa(ua.toNumber(),Ma.toNumber(),ab);if(null===Ma||Ma===hb)return aa(ua.toNumber(),0,ab);if(Q(Ma))return aa(ua.toNumber(),Ma,ab);if(M(Ma)||N(Ma))return aa(ua.toNumber(),ta(Ma),ab);if(S(Ma))throw new h.ArcadeExecutionError(null,h.ExecutionErrorCodes.CannotCompareDateAndTime,null);if(T(Ma))return aa(ua.toNumber(),Ma.toNumber(),ab)}else if(S(ua)){if(ha(Ma))throw new h.ArcadeExecutionError(null,h.ExecutionErrorCodes.CannotCompareDateAndTime,
null);if(null===Ma||Ma===hb)return aa(ua.toNumber(),0,ab);if(Q(Ma))return aa(ua.toNumber(),Ma,ab);if(M(Ma)||N(Ma))return aa(ua.toNumber(),ta(Ma),ab);if(S(Ma))return aa(ua.toNumber(),Ma.toNumber(),ab);if(T(Ma))throw new h.ArcadeExecutionError(null,h.ExecutionErrorCodes.CannotCompareDateAndTime,null);}return!la(ua,Ma)||"\x3c\x3d"!==ab&&"\x3e\x3d"!==ab?!1:!0}function la(ua,Ma){if(ua===Ma||null===ua&&Ma===hb||null===Ma&&ua===hb)return!0;if(ha(ua)&&ha(Ma)||S(ua)&&S(Ma)||T(ua)&&T(Ma))return ua.equals(Ma);
if(ua instanceof d||ua instanceof f)return ua.equalityTest(Ma);if(ua instanceof q&&Ma instanceof q){const ab=ua.cache._arcadeCacheId,qb=Ma.cache._arcadeCacheId;if(void 0!==ab&&null!==ab)return ab===qb}return Z(ua)&&Z(Ma)&&(ua._arcadeCacheId===Ma._arcadeCacheId&&void 0!==ua._arcadeCacheId&&null!==ua._arcadeCacheId||ua._underlyingGraphic===Ma._underlyingGraphic&&void 0!==ua._underlyingGraphic&&null!==ua._underlyingGraphic)?!0:!1}function na(ua,Ma){if(N(ua))return ua;if(null===ua)return"";if(Q(ua))return ka(ua,
Ma);if(M(ua))return ua.toString();if(ha(ua))return ja(ua,Ma);if(S(ua)||T(ua))return ua.toFormat(Ma);if(ua instanceof t)return JSON.stringify(ua.toJSON());if(L(ua)){Ma=[];for(var ab=0;ab<ua.length;ab++)Ma[ab]=xa(ua[ab]);return"["+Ma.join(",")+"]"}if(ua instanceof g){Ma=[];for(ab=0;ab<ua.length();ab++)Ma[ab]=xa(ua.get(ab));return"["+Ma.join(",")+"]"}return null!==ua&&"object"===typeof ua&&void 0!==ua.castToText?ua.castToText():F(ua)?"object, Function":ua===hb?"":G(ua)?"object, Module":""}function qa(ua){const Ma=
[];if(!L(ua))return null;if(ua instanceof g){for(var ab=0;ab<ua.length();ab++)Ma[ab]=ta(ua.get(ab));return Ma}for(ab=0;ab<ua.length;ab++)Ma[ab]=ta(ua[ab]);return Ma}function sa(ua,Ma,ab=!1){if(N(ua))return ua;if(null===ua)return"";if(Q(ua))return ka(ua,Ma);if(M(ua))return ua.toString();if(ha(ua))return ja(ua,Ma);if(S(ua)||T(ua))return ua.toFormat(Ma);if(ua instanceof t)return ua instanceof u?'{"xmin":'+ua.xmin.toString()+',"ymin":'+ua.ymin.toString()+","+(ua.hasZ?'"zmin":'+ua.zmin.toString()+",":
"")+(ua.hasM?'"mmin":'+ua.mmin.toString()+",":"")+'"xmax":'+ua.xmax.toString()+',"ymax":'+ua.ymax.toString()+","+(ua.hasZ?'"zmax":'+ua.zmax.toString()+",":"")+(ua.hasM?'"mmax":'+ua.mmax.toString()+",":"")+'"spatialReference":'+Wa(ua.spatialReference)+"}":Wa(ua.toJSON(),(pb,yb)=>pb.key===yb.key?0:"spatialReference"===pb.key?1:"spatialReference"===yb.key||pb.key<yb.key?-1:pb.key>yb.key?1:0);if(L(ua)){Ma=[];for(var qb=0;qb<ua.length;qb++)Ma[qb]=xa(ua[qb],ab);return"["+Ma.join(",")+"]"}if(ua instanceof
g){Ma=[];for(qb=0;qb<ua.length();qb++)Ma[qb]=xa(ua.get(qb),ab);return"["+Ma.join(",")+"]"}return null!==ua&&"object"===typeof ua&&void 0!==ua.castToText?ua.castToText(ab):F(ua)?"object, Function":ua===hb?"":G(ua)?"object, Module":""}function xa(ua,Ma=!1){return null===ua?"null":M(ua)||Q(ua)||N(ua)?JSON.stringify(ua):ua instanceof t||ua instanceof g||Array.isArray(ua)?sa(ua,null,Ma):ha(ua)?Ma?JSON.stringify(ua.getTime()):JSON.stringify(ja(ua,"")):S(ua)||T(ua)?JSON.stringify(ua.toString()):null!==ua&&
"object"===typeof ua&&void 0!==ua.castToText?ua.castToText(Ma):"null"}function ta(ua,Ma){return Q(ua)?ua:null===ua||""===ua?0:ha(ua)||T(ua)||S(ua)?NaN:M(ua)?ua?1:0:L(ua)||""===ua||void 0===ua?NaN:void 0!==Ma&&N(ua)?(Ma=E(Ma,"\u2030",""),Ma=E(Ma,"\u00a4",""),l.parse(ua,{pattern:Ma})):ua===hb?0:Number(ua)}function Ba(ua,Ma){if(ha(ua))return ua;if(N(ua)){a:{const qb=/ (\d\d)/;var ab=k.createDateTimeZone(Ma);ab=H.DateTime.fromISO(ua,{zone:ab});if(ab.isValid)Ma=ab;else{if(qb.test(ua)&&(ua=ua.replace(qb,
"T$1"),ab=H.DateTime.fromISO(ua,{zone:Ma}),ab.isValid)){Ma=ab;break a}Ma=null}}if(Ma)return k.ArcadeDate.dateTimeToArcadeDate(Ma)}return null}function Ia(ua){return M(ua)?ua:N(ua)?(ua=ua.toLowerCase(),"true"===ua?!0:!1):Q(ua)?0===ua||isNaN(ua)?!1:!0:!1}function Ca(ua,Ma){(ua=JSON.parse(ua))&&!ua.spatialReference&&(ua.spatialReference=Ma);return z.fromJSON(ua)}function Ha(ua,Ma){if(null==ua)return null;if(null===ua.spatialReference||void 0===ua.spatialReference)ua.spatialReference=Ma;return ua}function Ga(ua){if(null===
ua)return null;if(ua instanceof q)return"NaN"===ua.x||null===ua.x||isNaN(ua.x)?null:ua;if(ua instanceof r){if(0===ua.rings.length)return null;for(const Ma of ua.rings)if(0<Ma.length)return ua;return null}if(ua instanceof v){if(0===ua.paths.length)return null;for(const Ma of ua.paths)if(0<Ma.length)return ua;return null}return ua instanceof m?0===ua.points.length?null:ua:ua instanceof u?"NaN"===ua.xmin||null===ua.xmin||isNaN(ua.xmin)?null:ua:null}function Aa(ua,Ma){if(!ua||!ua.domain)return Ma;let ab=
null,qb=null;if(ha(Ma))ab=Ma.toNumber();else if(T(Ma))ab=Ma.toString();else if(S(Ma))ab=Ma.toStorageString();else if("string"===ua.field.type||"esriFieldTypeString"===ua.field.type)ab=na(Ma);else{if(null===Ma||void 0===Ma)return null;if(""===Ma)return Ma;ab=ta(Ma)}for(let pb=0;pb<ua.domain.codedValues.length;pb++){const yb=ua.domain.codedValues[pb];yb.code===ab&&(qb=yb)}return null===qb?na(Ma):qb.name}function Ja(ua,Ma){if(!ua||!ua.domain)return Ma;let ab=null;const qb=na(Ma);for(let pb=0;pb<ua.domain.codedValues.length;pb++){const yb=
ua.domain.codedValues[pb];yb.name===qb&&(ab=yb)}return null===ab?Ma:ab.code}function Sa(ua,Ma,ab=null,qb=null){if(!Ma||!Ma.fields)return null;let pb=null;for(var yb=0;yb<Ma.fields.length;yb++){var Fb=Ma.fields[yb];Fb.name.toLowerCase()===ua.toString().toLowerCase()&&(pb=Fb)}if(null===pb)throw new h.ArcadeExecutionError(null,h.ExecutionErrorCodes.FieldNotFound,null,{key:ua});let Sb,Mb;yb=Ma.typeIdField;let Hb="id";Fb=Ma.types;Ma.subtypeField&&(yb=Ma.subtypeField,Hb="code",Fb=Ma.subtypes??[]);if(null===
qb&&ab&&yb)qb=ab.hasField(yb)?ab.field(yb):null;else if(yb&&null!==qb){let Eb=!1;for(const Ob of Fb||[])if(qb===Ob[Hb]){Eb=!0;break}if(!Eb)for(const Ob of Fb||[])if(qb===Ob.name){qb=Ob[Hb];Eb=!0;break}Eb||(qb=null,ab&&yb&&(qb=ab.hasField(yb)?ab.field(yb):null))}null!==qb&&void 0!==qb&&Fb.some(Eb=>Eb[Hb]===qb?((Sb=Eb.domains?.[pb.name])&&"inherited"===Sb.type&&(Sb=$a(pb.name,Ma),Mb=!0),!0):!1);Mb||Sb||(Sb=$a(ua,Ma));return{field:pb,domain:Sb}}function $a(ua,Ma){let ab;Ma.fields.some(qb=>{qb.name.toLowerCase()===
ua.toLowerCase()&&(ab=qb.domain);return!!ab});return ab}function Wa(ua,Ma){Ma||={};"function"===typeof Ma&&(Ma={cmp:Ma});const ab="boolean"===typeof Ma.cycles?Ma.cycles:!1,qb=Ma.cmp&&function(yb){return function(Fb){return function(Sb,Mb){return yb({key:Sb,value:Fb[Sb]},{key:Mb,value:Fb[Mb]})}}}(Ma.cmp),pb=[];return function Sb(Fb){Fb?.toJSON&&"function"===typeof Fb.toJSON&&(Fb=Fb.toJSON());if(void 0!==Fb){if("number"===typeof Fb)return isFinite(Fb)?""+Fb:"null";if("object"!==typeof Fb)return JSON.stringify(Fb);
var Mb;if(Array.isArray(Fb)){var Hb="[";for(Mb=0;Mb<Fb.length;Mb++)Mb&&(Hb+=","),Hb+=Sb(Fb[Mb])||"null";return Hb+"]"}if(null===Fb)return"null";if(pb.includes(Fb)){if(ab)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON");}var Eb=pb.push(Fb)-1,Ob=Object.keys(Fb).sort(qb?.(Fb));Hb="";for(Mb=0;Mb<Ob.length;Mb++){const Pb=Ob[Mb],Tb=Sb(Fb[Pb]);Tb&&(Hb&&(Hb+=","),Hb+=JSON.stringify(Pb)+":"+Tb)}pb.splice(Eb,1);return"{"+Hb+"}"}}(ua)}function Ta(ua){if(null===
ua)return null;const Ma=[];for(const ab of ua)ab?.arcadeDeclaredClass&&"esri.arcade.Feature"===ab.arcadeDeclaredClass?Ma.push(ab.geometry()):Ma.push(ab);return Ma}function Da(ua,Ma){if(Ma instanceof q)ua.push(Ma.hasZ?Ma.hasM?[Ma.x,Ma.y,Ma.z,Ma.m]:[Ma.x,Ma.y,Ma.z]:[Ma.x,Ma.y]);else throw new h.ArcadeExecutionError(null,h.ExecutionErrorCodes.InvalidParameter,null);}function La(ua,Ma){if(L(ua)||fa(ua)){let ab=!1,qb=!1,pb=[];if(L(ua)){for(const yb of ua)Da(pb,yb);0<pb.length&&(Ma=ua[0].spatialReference,
ab=ua[0].hasZ,qb=ua[0].hasM)}else if(ua instanceof f)pb=ua._elements,0<pb.length&&(ab=ua._hasZ,qb=ua._hasM,Ma=ua.get(0).spatialReference);else if(fa(ua)){for(const yb of ua.toArray())Da(pb,yb);0<pb.length&&(Ma=ua.get(0).spatialReference,ab=!0===ua.get(0).hasZ,qb=!0===ua.get(0).hasM)}else throw new h.ArcadeExecutionError(null,h.ExecutionErrorCodes.InvalidParameter,null);if(0===pb.length)return null;B.isClockwise(pb)||(pb=pb.slice().reverse());return new r({rings:[pb],spatialReference:Ma,hasZ:ab,hasM:qb})}return ua}
function Va(ua,Ma){if(L(ua)||fa(ua)){let ab=!1,qb=!1,pb=[];if(L(ua)){for(const yb of ua)Da(pb,yb);0<pb.length&&(Ma=ua[0].spatialReference,ab=!0===ua[0].hasZ,qb=!0===ua[0].hasM)}else if(ua instanceof f)pb=ua._elements,0<pb.length&&(ab=ua._hasZ,qb=ua._hasM,Ma=ua.get(0).spatialReference);else if(fa(ua)){for(const yb of ua.toArray())Da(pb,yb);0<pb.length&&(Ma=ua.get(0).spatialReference,ab=!0===ua.get(0).hasZ,qb=!0===ua.get(0).hasM)}return 0===pb.length?null:new v({paths:[pb],spatialReference:Ma,hasZ:ab,
hasM:qb})}return ua}function ma(ua,Ma){if(L(ua)||fa(ua)){let ab=!1,qb=!1,pb=[];if(L(ua)){for(const yb of ua)Da(pb,yb);0<pb.length&&(Ma=ua[0].spatialReference,ab=!0===ua[0].hasZ,qb=!0===ua[0].hasM)}else if(ua instanceof f)pb=ua._elements,0<pb.length&&(ab=ua._hasZ,qb=ua._hasM,Ma=ua.get(0).spatialReference);else if(fa(ua)){for(const yb of ua.toArray())Da(pb,yb);0<pb.length&&(Ma=ua.get(0).spatialReference,ab=!0===ua.get(0).hasZ,qb=!0===ua.get(0).hasM)}return 0===pb.length?null:new m({points:pb,spatialReference:Ma,
hasZ:ab,hasM:qb})}return ua}function za(ua,Ma=!1){const ab=[];if(null===ua)return ab;if(!0===L(ua)){for(var qb=0;qb<ua.length;qb++){var pb=na(ua[qb]);""===pb&&!0!==Ma||ab.push(pb)}return ab}if(ua instanceof g){for(qb=0;qb<ua.length();qb++)pb=na(ua.get(qb)),""===pb&&!0!==Ma||ab.push(pb);return ab}return D(ua)?(ua=na(ua),""===ua&&!0!==Ma||ab.push(ua),ab):[]}function Na(ua){zb++;return 0===zb%100?(zb=0,new Promise(Ma=>{setTimeout(()=>{Ma(ua)},0)})):ua}function Ra(ua,Ma,ab){switch(ab){case "\x26":return ua&
Ma;case "|":return ua|Ma;case "^":return ua^Ma;case "\x3c\x3c":return ua<<Ma;case "\x3e\x3e":return ua>>Ma;case "\x3e\x3e\x3e":return ua>>>Ma}}function Pa(ua,Ma=null){if(null!=ua){if(M(ua)||Q(ua)||N(ua))return ua;if(ua instanceof t)return!0===Ma?.keepGeometryType?ua:ua.toJSON();if(ua instanceof g)return ua.toArray().map(ab=>Pa(ab,Ma));if(Array.isArray(ua))return ua.map(ab=>Pa(ab,Ma));if(ia(ua))return ua;if(ha(ua))return ua.toJSDate();if(S(ua))return ua.toString();if(T(ua))return ua.toJSDate();if(null!==
ua&&"object"===typeof ua&&void 0!==ua.castAsJson)return ua.castAsJson(Ma)}return null}async function ca(ua,Ma,ab,qb,pb){ua=await cb(ua,Ma,ab);pb[qb]=ua}async function cb(ua,Ma=null,ab=null){ua instanceof g&&(ua=ua.toArray());if(null!=ua){if(D(ua)||ua instanceof t||ia(ua)||ha(ua))return Pa(ua,ab);if(Array.isArray(ua)){const qb=[],pb=[];for(const yb of ua)null===yb||D(yb)||yb instanceof t||ia(yb)||ha(yb)?pb.push(Pa(yb,ab)):(pb.push(null),qb.push(ca(yb,Ma,ab,pb.length-1,pb)));0<qb.length&&await Promise.all(qb);
return pb}if(null!==ua&&"object"===typeof ua&&void 0!==ua.castAsJsonAsync)return ua.castAsJsonAsync(Ma,ab)}return null}function ib(ua){return nb(ua)?ua.parent:ua}function nb(ua){return ua&&"declaredClass"in ua&&"esri.layers.support.SubtypeSublayer"===ua.declaredClass}function xb(ua){return ua&&"declaredClass"in ua&&"esri.layers.SubtypeGroupLayer"===ua.declaredClass}function ya(ua,Ma,ab){const qb=ib(ua.fullSchema());return null!==qb&&qb.fields?Sa(Ma,qb,ua,ab):null}function Ea(ua){ua=ib(ua.fullSchema());
return null!==ua&&ua.fields?ua.subtypeField?{subtypeField:ua.subtypeField,subtypes:ua.subtypes?ua.subtypes.map(Ma=>({name:Ma.name,code:Ma.code})):[]}:ua.typeIdField?{subtypeField:ua.typeIdField,subtypes:ua.types?ua.types.map(Ma=>({name:Ma.name,code:Ma.id})):[]}:null:null}function Qa(ua,Ma,ab,qb){const pb=ib(ua.fullSchema());if(null===pb||!pb.fields)return null;qb=Sa(Ma,pb,ua,qb);if(void 0===ab)try{ab=ua.field(Ma)}catch(yb){return null}return Aa(qb,ab)}function db(ua,Ma,ab,qb){const pb=ib(ua.fullSchema());
if(null===pb||!pb.fields)return null;if(void 0===ab){try{ab=ua.field(Ma)}catch(yb){return null}return ab}ua=Sa(Ma,pb,ua,qb);return Ja(ua,ab)}function lb(ua){return ua?.timeZone??"system"}function ub(ua){ua=ib(ua.fullSchema());if(null===ua||!ua.fields)return null;const Ma=[];for(const ab of ua.fields)Ma.push(c.esriFieldToJson(ab));return{objectIdField:ua.objectIdField,globalIdField:ua.globalIdField??"",geometryType:void 0===c.layerGeometryEsriRestConstants[ua.geometryType]?"":c.layerGeometryEsriRestConstants[ua.geometryType],
fields:Ma}}function Oa(ua,Ma){"system"===ua&&(ua=k.ArcadeDate.systemTimeZoneCanonicalName);return{version:"1.28",engineVersion:n.version,timeZone:ua,spatialReference:Ma instanceof y?Ma.toJSON():Ma,application:b.applicationName??"",engine:"web",locale:A.getLocale()}}class Xa{constructor(ua){this.value=ua}}class Za{constructor(ua){this.value=ua}}const hb={type:"VOID"},jb=Symbol("BREAK"),ob=Symbol("CONTINUE");let zb=0;const Db=Object.freeze(Object.defineProperty({__proto__:null,ImplicitResult:Za,ReturnResult:Xa,
absRound:ea,arcadeVersion:"1.28",autoCastArrayOfPointsToMultiPoint:ma,autoCastArrayOfPointsToPolygon:La,autoCastArrayOfPointsToPolyline:Va,autoCastFeatureToGeometry:Ta,binaryOperator:Ra,breakResult:jb,castAsJson:Pa,castAsJsonAsync:cb,continueResult:ob,defaultExecutingContext:Oa,defaultTimeZone:lb,defaultUndefined:I,equalityTest:la,featureDomainCodeLookup:db,featureDomainValueLookup:Qa,featureFullDomain:ya,featureSchema:ub,featureSubtypes:Ea,fixNullGeometry:Ga,fixSpatialReference:Ha,formatDate:ja,
formatNumber:ka,getDomain:Sa,getDomainCode:Ja,getDomainValue:Aa,getType:J,greaterThanLessThan:pa,isArray:L,isBoolean:M,isDate:ha,isDateOnly:T,isDictionary:ba,isFeature:P,isFeatureSet:V,isFeatureSetCollection:U,isFunctionParameter:F,isGeometry:K,isGraphic:R,isImmutableArray:fa,isInteger:O,isJsDate:ia,isKnowledgeGraph:da,isModule:G,isNumber:Q,isObject:Z,isQuery:W,isSimpleType:D,isString:N,isSubtypeGrouplayer:xb,isSubtypeSublayer:nb,isTime:S,multiReplace:E,parseGeometryFromJson:Ca,pcCheck:Y,stableStringify:Wa,
standardiseDateFormat:X,tick:Na,toBoolean:Ia,toDate:Ba,toNumber:ta,toNumberArray:qa,toString:na,toStringArray:za,toStringExplicit:sa,voidOperation:hb},Symbol.toStringTag,{value:"Module"}));a.ImplicitResult=Za;a.ReturnResult=Xa;a.absRound=ea;a.arcadeVersion="1.28";a.autoCastArrayOfPointsToMultiPoint=ma;a.autoCastArrayOfPointsToPolygon=La;a.autoCastArrayOfPointsToPolyline=Va;a.autoCastFeatureToGeometry=Ta;a.binaryOperator=Ra;a.breakResult=jb;a.castAsJson=Pa;a.castAsJsonAsync=cb;a.continueResult=ob;
a.defaultExecutingContext=Oa;a.defaultTimeZone=lb;a.defaultUndefined=I;a.equalityTest=la;a.featureDomainCodeLookup=db;a.featureDomainValueLookup=Qa;a.featureFullDomain=ya;a.featureSchema=ub;a.featureSubtypes=Ea;a.fixNullGeometry=Ga;a.fixSpatialReference=Ha;a.formatDate=ja;a.formatNumber=ka;a.getDomain=Sa;a.getDomainCode=Ja;a.getDomainValue=Aa;a.getType=J;a.greaterThanLessThan=pa;a.isArray=L;a.isBoolean=M;a.isDate=ha;a.isDateOnly=T;a.isDictionary=ba;a.isFeature=P;a.isFeatureSet=V;a.isFeatureSetCollection=
U;a.isFunctionParameter=F;a.isGeometry=K;a.isGraphic=R;a.isImmutableArray=fa;a.isInteger=O;a.isJsDate=ia;a.isKnowledgeGraph=da;a.isModule=G;a.isNumber=Q;a.isObject=Z;a.isQuery=W;a.isSimpleType=D;a.isString=N;a.isSubtypeGrouplayer=xb;a.isSubtypeSublayer=nb;a.isTime=S;a.lc=Db;a.multiReplace=E;a.parseGeometryFromJson=Ca;a.pcCheck=Y;a.stableStringify=Wa;a.standardiseDateFormat=X;a.tick=Na;a.toBoolean=Ia;a.toDate=Ba;a.toNumber=ta;a.toNumberArray=qa;a.toString=na;a.toStringArray=za;a.toStringExplicit=sa;
a.voidOperation=hb})},"esri/arcade/ArcadeModule":function(){define(["exports"],function(a){class b{}a.ArcadeModule=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/arcade/executionError":function(){define(["exports","../core/string"],function(a,b){function n(l){return l&&l.loc?`Line : ${l.loc.start?.line}, ${l.loc.start?.column}: `:""}a.ExecutionErrorCodes=void 0;(function(l){l.AsyncNotEnabled="AsyncNotEnabled";l.ModulesNotSupported="ModulesNotSupported";l.CircularModules="CircularModules";
l.CannotCompareDateAndTime="CannotCompareDateAndTime";l.NeverReach="NeverReach";l.UnsupportedHashType="UnsupportedHashType";l.InvalidParameter="InvalidParameter";l.FeatureSetDoesNotHaveSubtypes="FeatureSetDoesNotHaveSubtypes";l.UnexpectedToken="UnexpectedToken";l.Unrecognized="Unrecognized";l.UnrecognizedType="UnrecognizedType";l.MaximumCallDepth="MaximumCallDepth";l.BooleanConditionRequired="BooleanConditionRequired";l.TypeNotAllowedInFeature="TypeNotAllowedInFeature";l.KeyMustBeString="KeyMustBeString";
l.WrongNumberOfParameters="WrongNumberOfParameters";l.CallNonFunction="CallNonFunction";l.NoFunctionInTemplateLiteral="NoFunctionInTemplateLiteral";l.NoFunctionInDictionary="NoFunctionInDictionary";l.NoFunctionInArray="NoFunctionInArray";l.AssignModuleFunction="AssignModuleFunction";l.LogicExpressionOrAnd="LogicExpressionOrAnd";l.LogicalExpressionOnlyBoolean="LogicalExpressionOnlyBoolean";l.FunctionNotFound="FunctionNotFound";l.InvalidMemberAccessKey="InvalidMemberAccessKey";l.UnsupportedUnaryOperator=
"UnsupportUnaryOperator";l.InvalidIdentifier="InvalidIdentifier";l.MemberOfNull="MemberOfNull";l.UnsupportedOperator="UnsupportedOperator";l.Cancelled="Cancelled";l.ModuleAccessorMustBeString="ModuleAccessorMustBeString";l.ModuleExportNotFound="ModuleExportNotFound";l.Immutable="Immutable";l.OutOfBounds="OutOfBounds";l.IllegalResult="IllegalResult";l.FieldNotFound="FieldNotFound";l.PortalRequired="PortalRequired";l.LogicError="LogicError";l.ArrayAccessorMustBeNumber="ArrayAccessMustBeNumber";l.KeyAccessorMustBeString=
"KeyAccessorMustBeString";l.WrongSpatialReference="WrongSpatialReference";l.CannotChangeTimeZoneTime="CannotChangeTimeZoneTime";l.CannotChangeTimeZoneDateOnly="CannotChangeTimeZoneDateOnly"})(a.ExecutionErrorCodes||(a.ExecutionErrorCodes={}));const k={[a.ExecutionErrorCodes.TypeNotAllowedInFeature]:"Feature attributes only support dates, numbers, strings, guids.",[a.ExecutionErrorCodes.LogicError]:"Logic error - {reason}",[a.ExecutionErrorCodes.CannotCompareDateAndTime]:"Cannot compare date or dateonly with timeonly types",
[a.ExecutionErrorCodes.NeverReach]:"Encountered unreachable logic",[a.ExecutionErrorCodes.AsyncNotEnabled]:"Async Arcade must be enabled for this script",[a.ExecutionErrorCodes.ModuleAccessorMustBeString]:"Module accessor must be a string",[a.ExecutionErrorCodes.ModuleExportNotFound]:"Module has no export with provided identifier",[a.ExecutionErrorCodes.ModulesNotSupported]:"Current profile does not support modules",[a.ExecutionErrorCodes.ArrayAccessorMustBeNumber]:"Array accessor must be a number",
[a.ExecutionErrorCodes.FunctionNotFound]:"Function not found",[a.ExecutionErrorCodes.FieldNotFound]:"Key not found - {key}",[a.ExecutionErrorCodes.CircularModules]:"Circular module dependencies are not allowed",[a.ExecutionErrorCodes.Cancelled]:"Execution cancelled",[a.ExecutionErrorCodes.UnsupportedHashType]:"Type not supported in hash function",[a.ExecutionErrorCodes.IllegalResult]:"Value is not a supported return type",[a.ExecutionErrorCodes.PortalRequired]:"Portal is required",[a.ExecutionErrorCodes.InvalidParameter]:"Invalid parameter",
[a.ExecutionErrorCodes.WrongNumberOfParameters]:"Call with wrong number of parameters",[a.ExecutionErrorCodes.Unrecognized]:"Unrecognized code structure",[a.ExecutionErrorCodes.UnrecognizedType]:"Unrecognized type",[a.ExecutionErrorCodes.WrongSpatialReference]:"Cannot work with geometry in this spatial reference. It is different to the execution spatial reference",[a.ExecutionErrorCodes.BooleanConditionRequired]:"Conditions must use booleans",[a.ExecutionErrorCodes.NoFunctionInDictionary]:"Dictionaries cannot contain functions.",
[a.ExecutionErrorCodes.NoFunctionInArray]:"Arrays cannot contain functions.",[a.ExecutionErrorCodes.NoFunctionInTemplateLiteral]:"Template Literals do not expect functions by value.",[a.ExecutionErrorCodes.KeyAccessorMustBeString]:"Accessor must be a string",[a.ExecutionErrorCodes.KeyMustBeString]:"Object keys must be a string",[a.ExecutionErrorCodes.Immutable]:"Object is immutable",[a.ExecutionErrorCodes.UnexpectedToken]:"Unexpected token",[a.ExecutionErrorCodes.MemberOfNull]:"Cannot access property of null object",
[a.ExecutionErrorCodes.MaximumCallDepth]:"Exceeded maximum function depth",[a.ExecutionErrorCodes.OutOfBounds]:"Out of bounds",[a.ExecutionErrorCodes.InvalidIdentifier]:"Identifier not recognized",[a.ExecutionErrorCodes.CallNonFunction]:"Expression is not a function",[a.ExecutionErrorCodes.InvalidMemberAccessKey]:"Cannot access value using a key of this type",[a.ExecutionErrorCodes.AssignModuleFunction]:"Cannot assign function to module variable",[a.ExecutionErrorCodes.UnsupportedUnaryOperator]:"Unsupported unary operator",
[a.ExecutionErrorCodes.UnsupportedOperator]:"Unsupported operator",[a.ExecutionErrorCodes.LogicalExpressionOnlyBoolean]:"Logical expressions must be boolean",[a.ExecutionErrorCodes.LogicExpressionOrAnd]:"Logical expression can only be combined with || or \x26\x26",[a.ExecutionErrorCodes.CannotChangeTimeZoneTime]:"Cannot change the timezone of a Time",[a.ExecutionErrorCodes.CannotChangeTimeZoneDateOnly]:"Cannot change the timezone of a DateOnly",[a.ExecutionErrorCodes.FeatureSetDoesNotHaveSubtypes]:"FeatureSet does not have subtypes"};
class p extends Error{constructor(...l){super(...l)}}class h extends p{constructor(l,w){super(n(w)+l.message,{cause:l});this.loc=null;Error.captureStackTrace&&Error.captureStackTrace(this,h);w?.loc&&(this.loc=w.loc)}}class e extends Error{constructor(l,w,x,u){super("Execution error - "+n(x)+b.replace(k[w],u));this.loc=null;this.declaredRootClass="esri.arcade.arcadeexecutionerror";Error.captureStackTrace&&Error.captureStackTrace(this,e);x?.loc&&(this.loc=x.loc)}}class g extends Error{constructor(l,
w,x,u){super("Compilation error - "+n(x)+b.replace(k[w],u));this.loc=null;this.declaredRootClass="esri.arcade.arcadecompilationerror";Error.captureStackTrace&&Error.captureStackTrace(this,g);x?.loc&&(this.loc=x.loc)}}class d extends Error{constructor(){super("Uncompilable code structures");this.declaredRootClass="esri.arcade.arcadeuncompilableerror";Error.captureStackTrace&&Error.captureStackTrace(this,d)}}a.ModuleErrorCodes=void 0;(function(l){l.UnrecognizedUri="UnrecognizedUri";l.UnsupportedUriProtocol=
"UnsupportedUriProtocol"})(a.ModuleErrorCodes||(a.ModuleErrorCodes={}));const f={[a.ModuleErrorCodes.UnrecognizedUri]:"Unrecognized uri - {uri}",[a.ModuleErrorCodes.UnsupportedUriProtocol]:"Unrecognized uri protocol"};class c extends Error{constructor(l,w){super(b.replace(f[l],w));this.declaredRootClass="esri.arcade.arcademoduleerror";Error.captureStackTrace&&Error.captureStackTrace(this,c)}}a.ArcadeCompilationError=g;a.ArcadeExecutionError=e;a.ArcadeUncompilableError=d;a.ErrorWithCause=p;a.LocatableArcadeExecutionError=
h;a.ModuleError=c;a.ensureArcadeExecutionError=function(l,w,x){return"esri.arcade.arcadeexecutionerror"===x.declaredRootClass||"esri.arcade.arcadecompilationerror"===x.declaredRootClass?null===x.loc&&w?.loc?new h(x,{cause:x}):x:w?.loc?new h(x,{cause:x}):x};a.executionErrorMessages=k;a.moduleErrorMessages=f;a.parsingValidationMessage=function(l,w,x){return"Parsing error - "+n(l)+b.replace(k[w],x)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/arcade/FunctionWrapper":function(){define(["exports",
"../core/promiseUtils"],function(a,b){function n(e,g,d){if(e instanceof k&&!(e instanceof h)){const f=new h;f.fn=e;f.parameterEvaluator=d;f.context=g;return f}return e}class k{constructor(){}}class p extends k{constructor(e){super();this.fn=e}createFunction(e){return(...g)=>this.fn(e,{preparsed:!0,arguments:g})}call(e,g){return this.fn(e,g)}marshalledCall(e,g,d,f){return f(e,g,(c,l,w)=>{w=w.map(x=>x instanceof k&&!(x instanceof h)?n(x,e,f):x);c=this.call(d,{args:w});return b.isPromiseLike(c)?c.then(x=>
n(x,d,f)):c})}}class h extends k{constructor(){super(...arguments);this.context=this.fn=null}createFunction(e){return this.fn.createFunction(this.context)}call(e,g){return this.fn.marshalledCall(e,g,this.context,this.parameterEvaluator)}marshalledCall(e,g,d){return this.fn.marshalledCall(e,g,this.context,this.parameterEvaluator)}}a.ArcadeFunction=k;a.NativeFunction=p;a.ScopeMarshalledFunction=h;a.wrapModuleScopedResponse=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/arcade/ImmutableArray":function(){define(function(){class a{constructor(b=
[]){this._elements=b}length(){return this._elements.length}get(b){return this._elements[b]}toArray(){return this.slice()}slice(b=0,n=this.length()){const k=[];for(;b<n;b++)k.push(this.get(b));return k}}return a})},"esri/arcade/ImmutablePathArray":function(){define(["./ImmutableArray","./ImmutablePointArray"],function(a,b){class n extends a{constructor(k,p,h,e,g){super(k);this._lazyPath=[];this._hasM=this._hasZ=!1;this._hasZ=h;this._hasM=e;this._spRef=p;this._cacheId=g}get(k){if(void 0===this._lazyPath[k]){const p=
this._elements[k];if(void 0===p)return;this._lazyPath[k]=new b(p,this._spRef,this._hasZ,this._hasM,this._cacheId,k)}return this._lazyPath[k]}equalityTest(k){return k===this?!0:null===k||!1===k instanceof n?!1:k.getUniqueHash()===this.getUniqueHash()}getUniqueHash(){return this._cacheId.toString()}}return n})},"esri/arcade/ImmutablePointArray":function(){define(["./ImmutableArray","../geometry/Point"],function(a,b){class n extends a{constructor(k,p,h,e,g,d){super(k);this._lazyPt=[];this._hasM=this._hasZ=
!1;this._spRef=p;this._hasZ=h;this._hasM=e;this._cacheId=g;this._partId=d}get(k){if(void 0===this._lazyPt[k]){var p=this._elements[k];if(void 0===p)return;const h=this._hasZ,e=this._hasM;p=h&&!e?new b(p[0],p[1],p[2],void 0,this._spRef):e&&!h?new b(p[0],p[1],void 0,p[2],this._spRef):h&&e?new b(p[0],p[1],p[2],p[3],this._spRef):new b(p[0],p[1],this._spRef);p.cache._arcadeCacheId=this._cacheId.toString()+"-"+this._partId.toString()+"-"+k.toString();this._lazyPt[k]=p}return this._lazyPt[k]}equalityTest(k){return k===
this?!0:null===k||!1===k instanceof n?!1:k.getUniqueHash()===this.getUniqueHash()}getUniqueHash(){return this._cacheId.toString()+"-"+this._partId.toString()}}return n})},"esri/arcade/featureset/support/shared":function(){define("exports ../../ArcadeDate ../../../core/sql/DateOnly ../../../core/sql/TimeOnly ../../../geometry/Extent ../../../layers/support/Field ../../../chunks/datetime".split(" "),function(a,b,n,k,p,h,e){function g(c){return c instanceof Date}function d(c){return c instanceof b.ArcadeDate}
function f(c){switch(c.type){case "catalog":case "csv":case "feature":case "geojson":case "oriented-imagery":case "subtype-group":case "wfs":return!0;default:return!1}}a.FeatureServiceDatabaseType=void 0;(function(c){c[c.Standardised=0]="Standardised";c[c.StandardisedNoInterval=1]="StandardisedNoInterval";c[c.SqlServer=2]="SqlServer";c[c.Oracle=3]="Oracle";c[c.Postgres=4]="Postgres";c[c.PGDB=5]="PGDB";c[c.FILEGDB=6]="FILEGDB";c[c.NotEvaluated=7]="NotEvaluated"})(a.FeatureServiceDatabaseType||(a.FeatureServiceDatabaseType=
{}));a.IdState=void 0;(function(c){c[c.InFeatureSet=0]="InFeatureSet";c[c.NotInFeatureSet=1]="NotInFeatureSet";c[c.Unknown=2]="Unknown"})(a.IdState||(a.IdState={}));a.callback=function(c,l){return function(){try{c.apply(null,arguments)}catch(w){l.reject(w)}}};a.cloneAttributes=function(c){const l={};for(const w in c)l[w]=c[w];return l};a.cloneField=function(c){return h.fromJSON(c.toJSON())};a.convertLinearUnitsToCode=function(c){if(null==c)return null;if("number"===typeof c||"number"===typeof c)return c;
switch(c.toLowerCase()){case "meters":case "meter":return 9001;case "miles":case "mile":return 9093;case "kilometers":case "kilometer":case "km":return 9036}return null};a.convertSquareUnitsToCode=function(c){if(null==c)return null;if("number"===typeof c)return c;switch(c.toLowerCase()){case "meters":case "meter":return 109404;case "miles":case "mile":return 109439;case "kilometers":case "kilometer":case "km":return 109414}return null};a.defaultMaxRecords=1E3;a.equalityTest=function(c,l){return c===
l?!0:(g(c)||d(c))&&(g(l)||d(l))?c.getTime()===l.getTime():!1};a.errback=function(c){return function(l){c.reject(l)}};a.esriFieldToJson=function(c){return c.toJSON?c.toJSON():c};a.extractServiceUrl=function(c){if(void 0===c)return"";c=c.replace(/\/featureserver\/[0-9]*/i,"/FeatureServer");c=c.replace(/\/mapserver\/[0-9]*/i,"/MapServer");return c=c.split("?")[0]};a.isArcadeDate=d;a.isArcadeDateOnly=function(c){return c instanceof n.DateOnly};a.isArcadeTime=function(c){return c instanceof k.TimeOnly};
a.isArray=function(c){return Array.isArray(c)};a.isBoolean=function(c){return"boolean"===typeof c};a.isDate=g;a.isLuxonDate=function(c){return c instanceof e.DateTime};a.isNumber=function(c){return"number"===typeof c};a.isString=function(c){return"string"===typeof c||c instanceof String};a.isSupportedLayer=function(c){switch(c.type){case "catalog-footprint":case "subtype-sublayer":return!0;default:return f(c)}};a.isSupportedSourceLayer=f;a.layerFieldEsriConstants={"small-integer":"esriFieldTypeSmallInteger",
integer:"esriFieldTypeInteger",long:"esriFieldTypeLong",single:"esriFieldTypeSingle",double:"esriFieldTypeDouble",string:"esriFieldTypeString",date:"esriFieldTypeDate","date-only":"esriFieldTypeDateOnly","time-only":"esriFieldTypeTimeOnly","timestamp-offset":"esriFieldTypeTimestampOffset",oid:"esriFieldTypeOID",geometry:"esriFieldTypeGeometry",blob:"esriFieldTypeBlob",raster:"esriFieldTypeRaster",guid:"esriFieldTypeGUID","global-id":"esriFieldTypeGlobalID",xml:"esriFieldTypeXML","big-integer":"esriFieldTypeBigInteger",
esriFieldTypeSmallInteger:"esriFieldTypeSmallInteger",esriFieldTypeInteger:"esriFieldTypeInteger",esriFieldTypeLong:"esriFieldTypeLong",esriFieldTypeSingle:"esriFieldTypeSingle",esriFieldTypeDouble:"esriFieldTypeDouble",esriFieldTypeString:"esriFieldTypeString",esriFieldTypeDate:"esriFieldTypeDate",esriFieldTypeDateOnly:"esriFieldTypeDateOnly",esriFieldTypeTimeOnly:"esriFieldTypeTimeOnly",esriFieldTypeTimestampOffset:"esriFieldTypeTimestampOffset",esriFieldTypeOID:"esriFieldTypeOID",esriFieldTypeGeometry:"esriFieldTypeGeometry",
esriFieldTypeBlob:"esriFieldTypeBlob",esriFieldTypeRaster:"esriFieldTypeRaster",esriFieldTypeGUID:"esriFieldTypeGUID",esriFieldTypeGlobalID:"esriFieldTypeGlobalID",esriFieldTypeXML:"esriFieldTypeXML",esriFieldTypeBigInteger:"esriFieldTypeBigInteger"};a.layerGeometryEsriConstants={point:"point",polygon:"polygon",polyline:"polyline",multipoint:"multipoint",extent:"extent",esriGeometryPoint:"point",esriGeometryPolygon:"polygon",esriGeometryPolyline:"polyline",esriGeometryMultipoint:"multipoint",esriGeometryEnvelope:"extent",
envelope:"extent"};a.layerGeometryEsriRestConstants={point:"esriGeometryPoint",polygon:"esriGeometryPolygon",polyline:"esriGeometryPolyline",multipoint:"esriGeometryMultipoint",extent:"esriGeometryEnvelope",esriGeometryPoint:"esriGeometryPoint",esriGeometryPolygon:"esriGeometryPolygon",esriGeometryPolyline:"esriGeometryPolyline",esriGeometryMultipoint:"esriGeometryMultipoint",esriGeometryEnvelope:"esriGeometryEnvelope",envelope:"esriGeometryEnvelope"};a.sameGeomType=function(c,l){return c===l||"point"===
c&&"esriGeometryPoint"===l||"polyline"===c&&"esriGeometryPolyline"===l||"polygon"===c&&"esriGeometryPolygon"===l||"extent"===c&&"esriGeometryEnvelope"===l||"multipoint"===c&&"esriGeometryMultipoint"===l||"point"===l&&"esriGeometryPoint"===c||"polyline"===l&&"esriGeometryPolyline"===c||"polygon"===l&&"esriGeometryPolygon"===c||"extent"===l&&"esriGeometryEnvelope"===c||"multipoint"===l&&"esriGeometryMultipoint"===c?!0:!1};a.shapeExtent=function(c){if(null==c)return null;switch(c.type){case "polygon":case "multipoint":case "polyline":return c.extent;
case "point":return new p({xmin:c.x,ymin:c.y,xmax:c.x,ymax:c.y,spatialReference:c.spatialReference});case "extent":return c}return null};a.stableStringify=function(c,l){l||={};"function"===typeof l&&(l={cmp:l});const w="boolean"===typeof l.cycles?l.cycles:!1,x=l.cmp&&function(t){return function(m){return function(q,r){return t({key:q,value:m[q]},{key:r,value:m[r]})}}}(l.cmp),u=[];return function q(m){m?.toJSON&&"function"===typeof m.toJSON&&(m=m.toJSON());if(void 0!==m){if("number"===typeof m)return isFinite(m)?
""+m:"null";if("object"!==typeof m)return JSON.stringify(m);var r;if(Array.isArray(m)){var v="[";for(r=0;r<m.length;r++)r&&(v+=","),v+=q(m[r])||"null";return v+"]"}if(null===m)return"null";if(u.includes(m)){if(w)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON");}var y=u.push(m)-1,B=Object.keys(m).sort(x?.(m));v="";for(r=0;r<B.length;r++){const z=B[r],A=q(m[z]);A&&(v&&(v+=","),v+=JSON.stringify(z)+":"+A)}u.splice(y,1);return"{"+v+"}"}}(c)};a.toEsriGeometryType=
function(c){switch(c){case "point":return"esriGeometryPoint";case "polygon":return"esriGeometryPolygon";case "multipoint":return"esriGeometryMultipoint";case "polyline":return"esriGeometryPolyline";default:return"esriGeometryPoint"}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/number":function(){define(["exports","./string","../intl/locale"],function(a,b,n){function k(c=n.getLocale()){c=c.toLowerCase();let l=c in g;if(!l){const t=c.split("-");1<t.length&&t[0]in g&&(c=
t[0],l=!0);l||(c="en")}const [w,x,u="#,##0.###"]=g[c];return{decimal:w,group:x,pattern:u}}function p(c){c=c||{};var l=k(c.locale);const w=c.pattern||l.pattern,x=l.group,u=l.decimal;let t=1;if(w.includes("%"))t/=100;else if(w.includes("\u2030"))t/=1E3;else if(w.includes("\u00a4"))throw Error("currency notation not supported");l=w.split(";");1===l.length&&l.push("-"+l[0]);return{regexp:f(l,m=>{m="(?:"+b.escapeRegExpString(m,".")+")";return m.replace(d,q=>{const r={signed:!1,separator:c.strict?x:[x,
""],fractional:c.fractional,decimal:u,exponent:!1};q=q.split(".");let v=c.places;1===q.length&&1!==t&&(q[1]="###");1===q.length||0===v?r.fractional=!1:(void 0===v&&(v=c.pattern?q[1].lastIndexOf("0")+1:Infinity),v&&null==c.fractional&&(r.fractional=!0),!c.places&&+v<q[1].length&&(v+=","+q[1].length),r.places=v);q=q[0].split(",");1<q.length&&(r.groupSize=q.pop().length,1<q.length&&(r.groupSize2=q.pop().length));return"("+h(r)+")"})},!0).replaceAll(/[\xa0 ]/g,"[\\s\\xa0]"),group:x,decimal:u,factor:t}}
function h(c){c=c||{};"places"in c||(c.places=Infinity);"string"!==typeof c.decimal&&(c.decimal=".");"fractional"in c&&!String(c.places).startsWith("0")||(c.fractional=[!0,!1]);"exponent"in c||(c.exponent=[!0,!1]);"eSigned"in c||(c.eSigned=[!0,!1]);var l=e(c);const w=f(c.fractional,u=>{let t="";u&&0!==c.places&&(t="\\"+c.decimal,t=Infinity===c.places?"(?:"+t+"\\d+)?":t+("\\d{"+c.places+"}"));return t},!0),x=f(c.exponent,u=>u?"([eE]"+e({signed:c.eSigned})+")":"");l+=w;w&&(l="(?:(?:"+l+")|(?:"+w+"))");
return l+x}function e(c){c=c||{};"signed"in c||(c.signed=[!0,!1]);"separator"in c?"groupSize"in c||(c.groupSize=3):c.separator="";const l=f(c.signed,x=>x?"[-+]":"",!0),w=f(c.separator,x=>{if(!x)return"(?:\\d+)";x=b.escapeRegExpString(x);" "===x?x="\\s":"\u00a0"===x&&(x="\\s\\xa0");const u=c.groupSize,t=c.groupSize2;return t?(x="(?:0|[1-9]\\d{0,"+(t-1)+"}(?:["+x+"]\\d{"+t+"})*["+x+"]\\d{"+u+"})",0<u-t?"(?:"+x+"|(?:0|[1-9]\\d{0,"+(u-1)+"}))":x):"(?:0|[1-9]\\d{0,"+(u-1)+"}(?:["+x+"]\\d{"+u+"})*)"},!0);
return l+w}const g={ar:[".",","],bg:[",","\u00a0"],bs:[",","."],ca:[",","."],cs:[",","\u00a0"],da:[",","."],de:[",","."],"de-ch":[".","\u2019"],el:[",","."],en:[".",","],"en-au":[".",","],es:[",","."],"es-mx":[".",","],et:[",","\u00a0"],fi:[",","\u00a0"],fr:[",","\u202f"],"fr-ch":[",","\u202f"],he:[".",","],hi:[".",",","#,##,##0.###"],hr:[",","."],hu:[",","\u00a0"],id:[",","."],it:[",","."],"it-ch":[".","\u2019"],ja:[".",","],ko:[".",","],lt:[",","\u00a0"],lv:[",","\u00a0"],mk:[",","."],nb:[",","\u00a0"],
nl:[",","."],pl:[",","\u00a0"],pt:[",","."],"pt-pt":[",","\u00a0"],ro:[",","."],ru:[",","\u00a0"],sk:[",","\u00a0"],sl:[",","."],sr:[",","."],sv:[",","\u00a0"],th:[".",","],tr:[",","."],uk:[",","\u00a0"],vi:[",","."],zh:[".",","]},d=/[#0,]*[#0](?:\.0*#*)?/,f=(c,l,w)=>{if(!Array.isArray(c))return l(c);const x=[];for(let u=0;u<c.length;u++)x.push(l(c[u]));c=x.join("|");return"("+(w?"?:":"")+c+")"};a._parseInfo=p;a.format=function(c,l){l={...l};var w=k(l.locale);l.customs=w;w=l.pattern||w.pattern;if(isNaN(c)||
Infinity===Math.abs(c))return null;var x=c;var u=l||{};var t=u.customs.group,m=u.customs.decimal;w=w.split(";");c=w[0];l=w[0>x?1:0]||"-"+c;if(l.includes("%"))x*=100;else if(l.includes("\u2030"))x*=1E3;else{if(l.includes("\u00a4"))throw Error("currency notation not supported");if(l.includes("E"))throw Error("exponential notation not supported");}w=d;var q=c.match(w);if(!q)throw Error("unable to find a number expression in pattern: "+l);!1===u.fractional&&(u.places=0);c=l.replace;q=q[0];u=u={decimal:m,
group:t,places:u.places,round:u.round};!0===u.places&&(u.places=0);Infinity===u.places&&(u.places=6);m=q.split(".");var r="string"===typeof u.places&&u.places.indexOf(",");q=u.places;r?q=u.places.slice(r+1):0<=+q||(q=(m[1]||[]).length);0>u.round||(x=Number(x.toFixed(Number(q))));t=String(Math.abs(x)).split(".");x=t[1]||"";m[1]||u.places?(r&&(u.places=u.places.slice(0,Math.max(0,r))),r=void 0!==u.places?u.places:m[1]&&m[1].lastIndexOf("0")+1,+r>x.length&&(t[1]=x.padEnd(Number(r),"0")),+q<x.length&&
(t[1]=x.slice(0,Math.max(0,Number(q))))):t[1]&&t.pop();x=m[0].replace(",","");q=x.indexOf("0");-1!==q&&(q=x.length-q,q>t[0].length&&(t[0]=t[0].padStart(q,"0")),x.includes("#")||(t[0]=t[0].slice(-q)));x=m[0].lastIndexOf(",");let v;if(-1!==x){var y=m[0].length-x-1;m=m[0].slice(0,x);x=m.lastIndexOf(",");-1!==x&&(v=m.length-x-1)}m=[];for(x=t[0];x;)q=x.length-y,m.push(0<q?x.slice(Math.max(0,q)):x),x=0<q?x.slice(0,q):"",v&&(y=v,v=void 0);t[0]=m.reverse().join(u.group||",");y=t.join(u.decimal||".");return c.call(l,
w,y)};a.getCustoms=k;a.parse=function(c,l){l=p(l);c=(new RegExp("^"+l.regexp+"$")).exec(c);if(!c)return NaN;let w=c[1];if(!c[1]){if(!c[2])return NaN;w=c[2];l.factor*=-1}w=w.replaceAll(new RegExp("["+l.group+"\\s\\xa0]","g"),"").replace(l.decimal,".");return Number(w)*l.factor};a.regexp=function(c){return p(c).regexp};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/queryForSymbologySnapping":function(){define(["exports","../../../../core/promiseUtils",
"../../../../support/arcadeOnDemand"],function(a,b,n){const k={candidates:[],sourceCandidateIndices:[]};a.queryForSymbologySnapping=async function(p,h,e){if(null==p||0===h.candidates.length)return k;var g=p.graphics3DGraphicsByObjectID??p.graphics3DGraphics,d=[];const f=[],{renderer:c}=p,l=null!=c&&"arcadeRequired"in c&&c.arcadeRequired?n.loadArcade():null;var w=async(q,{graphic:r,graphics3DSymbol:v})=>{const y=await l;r=await p.getRenderingInfoAsync(r,c,y,{signal:e});return null==r?[]:v.queryForSnapping(q,
u,r,e)};const {candidates:x,spatialReference:u}=h;for(h=0;h<x.length;++h){var t=x[h],{objectId:m}=t;m="number"===typeof m?g?.get(m):void 0;if(null==m)continue;const {graphics3DSymbol:q}=m;q.symbologySnappingSupported&&(d.push(w(t,m)),f.push(h))}if(0===d.length)return k;g=await Promise.all(d);b.throwIfAborted(e);d=[];w=[];for(h=0;h<g.length;++h){t=g[h];m=f[h];for(const q of t)d.push(q),w.push(m)}return{candidates:d,sourceCandidateIndices:w}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/layers/support/HeatmapFeatureProcessor":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/arrayUtils ../../../../core/byteSizeEstimations ../../../../core/handleUtils ../../../../core/has ../../../../core/Logger ../../../../core/Promise ../../../../core/reactiveUtils ../../../../core/screenUtils ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/decorators/subclass ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../core/support/UpdatingHandles ../../../../geometry/projection/projectPointToVector ../../../../geometry/support/Indices ../../../../geometry/support/scaleUtils ../../../../layers/graphics/dehydratedFeatures ../../../../layers/graphics/featureConversionUtils ../../../../layers/graphics/OptimizedFeature ../../../../layers/graphics/OptimizedGeometry ../../../../layers/graphics/data/FeatureStore ../../../../layers/support/fieldUtils ../../../../renderers/support/heatmapUtils ../interfaces ../graphics/DisplayFeatureLimit ../graphics/GraphicsCorePerformanceInfo ./FeatureVisibilityFilter ./highlightUtils ../../terrain/OverlayRenderer ../../webgl-engine/lib/Attribute ../../webgl-engine/lib/ContentObjectType ../../webgl-engine/lib/DrapedHeatmapRenderer ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/ModelDirtyTypes ../../webgl-engine/lib/RenderGeometry ../../webgl-engine/lib/UpdatePolicy ../../webgl-engine/lib/VertexAttribute ../../webgl-engine/materials/HeatmapDensityMaterial ../../../support/layerViewUtils ../../../webgl/enums ../../../webgl/heatmapTextureUtils".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w,x,u,t,m,q,r,v,y,B,z,A,C,H,E,F,G,D,I,J,N,M,Q,O,K,L,P,R,W,V){a.HeatmapFeatureProcessor=class extends g.EsriPromise{constructor(ba){super(ba);this.type="heatmap";this.preferredUpdatePolicy=K.UpdatePolicy.ASYNC;this.dataExtent=null;this.drapeSourceType=C.DrapeSourceType.Features;this._renderGeometries=new Map;this._fieldTotal=0;this._drapeSourceRenderer=null;this._dataType=W.PixelType.HALF_FLOAT;this._pixelFormat=W.PixelFormat.RGBA;this._updatingHandles=new x.UpdatingHandles}initialize(){try{var ba=
V.loadHeatmapTextureConfiguration(this._renderView.renderingContext,e.getLogger(this))}catch(T){this.addResolvingPromise(Promise.reject(T)),ba=V.fallBackHeatmapConfiguration}const {dataType:U,samplingMode:da,pixelFormat:fa,internalFormat:ha}=ba;this._featureStore=new B({geometryType:"esriGeometryPoint",hasZ:this.hasZ,hasM:this.hasM});this._dataType=U;this._pixelFormat=fa;ba=U!==W.PixelType.FLOAT;this._drapeSourceRenderer=this.view.basemapTerrain.overlayManager.registerDrapeSource(this,N.DrapedHeatmapRenderer,
{...this._rendererParameters,dataType:U,samplingMode:da,pixelFormat:fa,internalFormat:ha});this._material=new P.HeatmapDensityMaterial({usesHalfFloats:ba});this._materialWithField=new P.HeatmapDensityMaterial({usesHalfFloats:ba,isAttributeDriven:!0});this._filterVisibility=new F.FeatureVisibilityFilter({context:{configuration:this.owner,featureStore:this.featureStore,getFeatureCount:()=>this._loadedPointGraphics.length,setAllFeaturesVisibility:T=>this._setAllFeaturesVisibility(T),clearFeaturesVisibility:()=>
this._setAllFeaturesVisibility(!0),updateFeatureVisibilities:T=>this._updateFeatureVisibilities(T)}});this._updatingHandles.addOnCollectionChange(()=>this._loadedPointGraphics,T=>this._onLoadedFeaturesChange(T),d.initial);this._updatingHandles.addWhen(()=>this._materialParameters,T=>this._forEachMaterial(S=>S.setParameters(T)),d.initial);this._updatingHandles.add(()=>this._rendererParameters,T=>this._drapeSourceRenderer.set(T));this._updatingHandles.add(()=>this._heatmapRendererField,()=>{this._recreate()},
d.sync);this._updatingHandles.add(()=>({fieldName:this._heatmapRendererFieldName,numeric:this._heatmapRendererFieldIsNumeric}),({fieldName:T,numeric:S})=>{if(null!=T&&S){let Z=0;this._featureStore.forEach(ia=>Z+=ia.attributes[T]??0);this._fieldTotal=Z}else this._fieldTotal=this._featureStore.numFeatures},d.initial);this.addHandles([d.watch(()=>({fieldName:this._heatmapRendererFieldName,field:this._heatmapRendererField}),({fieldName:T,field:S})=>{T&&!S&&e.getLogger(this).warn(`Heatmap renderer field '${T}' for layer '${this.layer.title??
this.layer.id}' not found`)}),d.watch(()=>({field:this._heatmapRendererField,numeric:this._heatmapRendererFieldIsNumeric}),({field:T,numeric:S})=>{null==T||S||e.getLogger(this).warn(`Heatmap renderer field '${T.name}' for layer '${this.layer.title??this.layer.id}' does not contain numeric values and cannot be used to drive the heatmap density`)}),p.makeHandle(()=>this.view.basemapTerrain.overlayManager.unregisterDrapeSource(this))])}destroy(){this._renderGeometries.clear();this._materialWithField=
this._material=null;this._featureStore.clear();this._featureStore=null;this._updatingHandles.destroy()}get layer(){return this.owner.layer}get featureStore(){return this._featureStore}get updating(){return this._updatingHandles.updating||this.filterVisibility.updating}get updatingRemaining(){return 0}get suspendInfo(){return{}}get legendEnabled(){return!0}get filterVisibility(){return this._filterVisibility}get displayFeatureLimit(){var ba=this.owner?.view?.quality??1;const U=this.owner?.view?.qualitySettings;
ba=U?Math.ceil(U.heatmap.maxTotalNumberOfFeatures*ba):0;return new H.DisplayFeatureLimit(6*ba,ba)}get hasZ(){return"hasZ"in this.layer&&this.layer.hasZ}get hasM(){return"hasM"in this.layer&&this.layer.hasM}get view(){return this.owner.view}get fullOpacity(){return this.owner.fullOpacity}get updatePolicy(){return this.owner.updatePolicy}get scaleVisibilitySuspended(){if(!this._isScaleRangeActive)return!1;const {minScale:ba,maxScale:U}=this.layer.effectiveScaleRange,{scale:da}=this.view;return!R.scaleBoundsPredicate(da,
ba??0,U??0)}get usedMemory(){const ba=Math.ceil((this._overlayRenderer?.overlays[0]?.resolution??0)*this._densityMapPixelRatio)??0;return ba*ba*(this._pixelFormat===W.PixelFormat.RED?1:4)*(this._dataType===W.PixelType.FLOAT?4:2)+this.usedMemoryPerFeature*this._featureStore.numFeatures}get usedMemoryPerFeature(){var ba=this._loadedPointGraphics.find(()=>!0);if(null==ba)return 0;ba=k.estimateAttributesObjectSize(ba);const U=k.estimateNumberByteSize(),da=6*k.estimateFixedArraySize([0,0,0],U),fa=6*k.estimateFixedArraySize([0,
0],U);return da+fa+(this._heatmapRendererFieldIsNumeric?6*U:0)+ba}get loadedFeatures(){return this._featureStore.numFeatures}get unprocessedMemoryEstimate(){return 0}get performanceInfo(){return new E.GraphicsCorePerformanceInfo(this._visibleFeatures,0,0)}get renderer(){return this._heatmapRenderer}get _overlayRenderer(){return this.view.basemapTerrain.overlayManager.renderer}get _overlaySpatialReference(){return this._overlayRenderer.spatialReference}get _rendererParameters(){return{...this._radiusParameter,
...this._densityParameters,...this._colorRampParameter,...this._pixelRatioParameter}}get _materialParameters(){return{...this._radiusParameter,...this._resolutionForScaleParameter}}get _densityParameters(){const ba=this._heatmapRenderer;if(null==ba)return null;const {minDensity:U,maxDensity:da}=ba;return{minDensity:U,maxDensity:da,fieldTotal:this._fieldTotal}}get _radiusParameter(){const ba=this._heatmapRenderer;return ba?{searchRadius:f.pt2px(this._clampSearchRadius(ba.radius))}:null}get _resolutionForScaleParameter(){var ba=
this._heatmapRenderer;if(!ba)return null;({referenceScale:ba}=ba);return{resolutionForScale:0===ba?0:m.getResolutionForScale(ba,this.view.spatialReference)}}get _colorRampParameter(){const ba=this._heatmapRenderer;return ba?{colorRampData:A.generateGradient(ba.colorStops)}:null}get _pixelRatioParameter(){return{pixelRatio:this._densityMapPixelRatio}}get _densityMapPixelRatio(){return this.owner?.view?.qualitySettings.heatmap.pixelRatio??1}get _renderView(){return this.view._stage.renderView}get _featuresArePoints(){return"point"===
this.layer.geometryType}get _loadedPointGraphics(){return this.owner.loadedGraphics}get _heatmapRenderer(){const ba=this.layer.renderer;return"heatmap"===ba?.type?ba:null}get _heatmapRendererFieldName(){return this._heatmapRenderer?.field}get _heatmapRendererField(){const ba=this._heatmapRendererFieldName;return null!=ba?this.layer.fieldsIndex.get(ba):null}get _heatmapRendererFieldIsNumeric(){const ba=this._heatmapRendererField;return null==ba?!1:z.isNumericField(ba)}get _isScaleRangeActive(){const {layer:ba}=
this;if(!("effectiveScaleRange"in ba))return!1;const {minScale:U,maxScale:da}=ba.effectiveScaleRange;return R.isScaleRangeActive(U,da)}get _visibleFeatures(){let ba=0;this._renderGeometries.forEach(U=>{U.visible&&++ba});return ba}async whenGraphicBounds(){return null}computeAttachmentOrigin(){return null}highlight(){return G.emptyHighlightHandle}maskOccludee(){return p.makeHandle()}setObjectIdVisibility(){}refreshFilter(){this.filterVisibility.reapply()}_onLoadedFeaturesChange(ba){if(this._featuresArePoints){var {objectIdField:U}=
this.layer;this._featureStore.removeManyById(ba.removed.map(fa=>q.getObjectId(fa,U)));this._featureStore.addMany(ba.added.map(fa=>{const {attributes:ha,centroid:T,geometry:S}=fa,Z=new v.OptimizedFeature(r.convertFromPoint(new y,S),ha,T?r.convertFromPoint(new y,T):null,q.getObjectId(fa,U));Z.displayId=fa.uid;return Z}));var da=ba.added;ba=ba.removed;this._fieldTotal+=this._computeFieldTotalChange(da,ba);ba=ba.map(({uid:fa})=>{const ha=this._renderGeometries.get(fa);this._renderGeometries.delete(fa);
return ha}).filter(n.isSome);da=da.map(fa=>{const ha=this._pointGraphicToRenderGeometry(fa);this._renderGeometries.set(fa.uid,ha);return ha});0<ba.length&&this._drapeSourceRenderer.removeGeometries(ba,Q.DirtyOperation.REMOVE);0<da.length&&this._drapeSourceRenderer.addGeometries(da,Q.DirtyOperation.ADD);if(0<da.length||0<ba.length)this.filterVisibility.reapply(),this._renderView.requestRender()}}_recreate(){if(this._loadedPointGraphics){var ba=this._loadedPointGraphics.toArray();this._onLoadedFeaturesChange({added:ba,
removed:ba})}}_pointGraphicToRenderGeometry(ba){const U=this._heatmapRendererFieldName,da=null!=U?this._materialWithField:this._material;var fa=w.create();u.projectPointToVector(ba.geometry,fa,this._overlaySpatialReference);fa[2]=D.drapedZ;const ha=t.getContinuousIndexArray(1);fa=[[L.VertexAttribute.POSITION,new I.Attribute(fa,ha,fa.length)]];const T=this._heatmapRendererFieldIsNumeric;null!=U&&fa.push([L.VertexAttribute.FEATUREATTRIBUTE,new I.Attribute([T?ba.attributes[U]??0:0],ha,1)]);ba=new O.RenderGeometry(new M.Geometry(da,
fa,null,J.ContentObjectType.Point),{layerUid:this.layer.uid,graphicUid:ba.uid});ba.visible=this.filterVisibility.defaultVisibility;return ba}_forEachMaterial(ba){ba(this._material);ba(this._materialWithField)}_computeFieldTotalChange(ba,U){if(null==this._heatmapRendererFieldName||!this._heatmapRendererFieldIsNumeric)return ba.length-U.length;const da=this._heatmapRendererFieldName,fa=(ha,T)=>ha+(T.attributes[da]??0);return ba.reduce(fa,0)-U.reduce(fa,0)}_clampSearchRadius(ba){112<ba&&e.getLogger(this).warnOnce("SceneView supports a maximum radius of 112 pt for HeatmapRenderer.");
return Math.min(ba,112)}_updateFeatureVisibilities(ba){const U=[];this._featureStore.forEach(({objectId:da,displayId:fa})=>{da=ba(da);(fa=this._renderGeometries.get(fa))&&fa.visible!==da&&(U.push(fa),fa.visible=da)});this._drapeSourceRenderer.modifyGeometries(U,Q.DirtyState.VISIBILITY)}_setAllFeaturesVisibility(ba){const U=[];for(const da of this._renderGeometries.values())da.visible!==ba&&(U.push(da),da.visible=ba);this._drapeSourceRenderer.modifyGeometries(U,Q.DirtyState.VISIBILITY)}get test(){}};
b.__decorate([c.property()],a.HeatmapFeatureProcessor.prototype,"type",void 0);b.__decorate([c.property({constructOnly:!0})],a.HeatmapFeatureProcessor.prototype,"owner",void 0);b.__decorate([c.property()],a.HeatmapFeatureProcessor.prototype,"layer",null);b.__decorate([c.property()],a.HeatmapFeatureProcessor.prototype,"featureStore",null);b.__decorate([c.property()],a.HeatmapFeatureProcessor.prototype,"updating",null);b.__decorate([c.property()],a.HeatmapFeatureProcessor.prototype,"updatingRemaining",
null);b.__decorate([c.property()],a.HeatmapFeatureProcessor.prototype,"suspendInfo",null);b.__decorate([c.property()],a.HeatmapFeatureProcessor.prototype,"legendEnabled",null);b.__decorate([c.property()],a.HeatmapFeatureProcessor.prototype,"filterVisibility",null);b.__decorate([c.property()],a.HeatmapFeatureProcessor.prototype,"displayFeatureLimit",null);b.__decorate([c.property()],a.HeatmapFeatureProcessor.prototype,"preferredUpdatePolicy",void 0);b.__decorate([c.property()],a.HeatmapFeatureProcessor.prototype,
"hasZ",null);b.__decorate([c.property()],a.HeatmapFeatureProcessor.prototype,"hasM",null);b.__decorate([c.property()],a.HeatmapFeatureProcessor.prototype,"dataExtent",void 0);b.__decorate([c.property()],a.HeatmapFeatureProcessor.prototype,"view",null);b.__decorate([c.property()],a.HeatmapFeatureProcessor.prototype,"fullOpacity",null);b.__decorate([c.property()],a.HeatmapFeatureProcessor.prototype,"updatePolicy",null);b.__decorate([c.property()],a.HeatmapFeatureProcessor.prototype,"drapeSourceType",
void 0);b.__decorate([c.property()],a.HeatmapFeatureProcessor.prototype,"scaleVisibilitySuspended",null);b.__decorate([c.property()],a.HeatmapFeatureProcessor.prototype,"renderer",null);b.__decorate([c.property()],a.HeatmapFeatureProcessor.prototype,"_featureStore",void 0);b.__decorate([c.property()],a.HeatmapFeatureProcessor.prototype,"_filterVisibility",void 0);b.__decorate([c.property()],a.HeatmapFeatureProcessor.prototype,"_overlayRenderer",null);b.__decorate([c.property()],a.HeatmapFeatureProcessor.prototype,
"_overlaySpatialReference",null);b.__decorate([c.property()],a.HeatmapFeatureProcessor.prototype,"_rendererParameters",null);b.__decorate([c.property()],a.HeatmapFeatureProcessor.prototype,"_materialParameters",null);b.__decorate([c.property()],a.HeatmapFeatureProcessor.prototype,"_densityParameters",null);b.__decorate([c.property()],a.HeatmapFeatureProcessor.prototype,"_radiusParameter",null);b.__decorate([c.property()],a.HeatmapFeatureProcessor.prototype,"_resolutionForScaleParameter",null);b.__decorate([c.property()],
a.HeatmapFeatureProcessor.prototype,"_colorRampParameter",null);b.__decorate([c.property()],a.HeatmapFeatureProcessor.prototype,"_pixelRatioParameter",null);b.__decorate([c.property()],a.HeatmapFeatureProcessor.prototype,"_densityMapPixelRatio",null);b.__decorate([c.property()],a.HeatmapFeatureProcessor.prototype,"_renderGeometries",void 0);b.__decorate([c.property()],a.HeatmapFeatureProcessor.prototype,"_material",void 0);b.__decorate([c.property()],a.HeatmapFeatureProcessor.prototype,"_materialWithField",
void 0);b.__decorate([c.property()],a.HeatmapFeatureProcessor.prototype,"_renderView",null);b.__decorate([c.property()],a.HeatmapFeatureProcessor.prototype,"_featuresArePoints",null);b.__decorate([c.property()],a.HeatmapFeatureProcessor.prototype,"_loadedPointGraphics",null);b.__decorate([c.property()],a.HeatmapFeatureProcessor.prototype,"_heatmapRenderer",null);b.__decorate([c.property()],a.HeatmapFeatureProcessor.prototype,"_heatmapRendererFieldName",null);b.__decorate([c.property()],a.HeatmapFeatureProcessor.prototype,
"_heatmapRendererField",null);b.__decorate([c.property()],a.HeatmapFeatureProcessor.prototype,"_heatmapRendererFieldIsNumeric",null);b.__decorate([c.property()],a.HeatmapFeatureProcessor.prototype,"_fieldTotal",void 0);b.__decorate([c.property()],a.HeatmapFeatureProcessor.prototype,"_drapeSourceRenderer",void 0);b.__decorate([c.property()],a.HeatmapFeatureProcessor.prototype,"_isScaleRangeActive",null);a.HeatmapFeatureProcessor=b.__decorate([l.subclass("esri.views.3d.layers.support.HeatmapFeatureProcessor")],
a.HeatmapFeatureProcessor);a.maxRadiusPt=112;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/FeatureStore":function(){define("../../../core/arrayUtils ../../../core/Error ../../../core/Evented ../../../core/Logger ../../../geometry/support/aaBoundingBox ../../../geometry/support/aaBoundingRect ../featureConversionUtils ./BoundsStore ./geometryUtils ./optimizedFeatureQueryEngineAdapter".split(" "),function(a,b,n,k,p,h,e,g,d,f){const c=p.create();class l{constructor(w){this.geometryInfo=
w;this._boundsStore=new g.BoundsStore;this._featuresById=new Map;this.events=new n;this.featureAdapter=f.optimizedFeatureQueryEngineAdapter}get geometryType(){return this.geometryInfo.geometryType}get hasM(){return this.geometryInfo.hasM}get hasZ(){return this.geometryInfo.hasZ}get numFeatures(){return this._featuresById.size}get fullBounds(){return this._boundsStore.fullBounds}get storeStatistics(){let w=0;this._featuresById.forEach(x=>{null!=x.geometry&&x.geometry.coords&&(w+=x.geometry.coords.length)});
return{featureCount:this._featuresById.size,vertexCount:w/(this.hasZ?this.hasM?4:3:this.hasM?3:2)}}getFullExtent(w){if(null==this.fullBounds)return null;const [x,u,t,m]=this.fullBounds;return{xmin:x,ymin:u,xmax:t,ymax:m,spatialReference:d.cleanFromGeometryEngine(w)}}add(w){this._add(w);this._emitChanged()}addMany(w){for(const x of w)this._add(x);this._emitChanged()}upsertMany(w){w=w.map(x=>this._upsert(x));this._emitChanged();return w.filter(a.isSome)}clear(){this._featuresById.clear();this._boundsStore.clear();
this._emitChanged()}removeById(w){w=this._featuresById.get(w);if(!w)return null;this._remove(w);this._emitChanged();return w}removeManyById(w){this._boundsStore.invalidateIndex();for(const x of w)(w=this._featuresById.get(x))&&this._remove(w);this._emitChanged()}forEachBounds(w,x){for(const u of w)(w=this._boundsStore.get(u.objectId))&&x(p.fromRect(c,w))}getFeature(w){return this._featuresById.get(w)}has(w){return this._featuresById.has(w)}forEach(w){this._featuresById.forEach(x=>w(x))}forEachInBounds(w,
x){this._boundsStore.forEachInBounds(w,u=>{x(this._featuresById.get(u))})}_emitChanged(){this.events.emit("changed",void 0)}_add(w){if(w){var x=w.objectId;if(null==x)k.getLogger("esri.layers.graphics.data.FeatureStore").error(new b("featurestore:invalid-feature","feature id is missing",{feature:w}));else{var u=this._featuresById.get(x);if(u){w.displayId=u.displayId;var t=this._boundsStore.get(x);this._boundsStore.delete(x)}else if(null!=this.onFeatureAdd)this.onFeatureAdd(w);w.geometry?.coords?.length?
(t=e.getBoundsOptimizedGeometry(null!=t?t:h.create(),w.geometry,this.geometryInfo.hasZ,this.geometryInfo.hasM),null!=t&&this._boundsStore.set(x,t)):this._boundsStore.set(x,null);this._featuresById.set(x,w)}}}_upsert(w){const x=w?.objectId;if(null==x)return k.getLogger("esri.layers.graphics.data.FeatureStore").error(new b("featurestore:invalid-feature","feature id is missing",{feature:w})),null;const u=this._featuresById.get(x);if(!u)return this._add(w),w;const {geometry:t,attributes:m}=w;for(const q in m)u.attributes[q]=
m[q];t&&(u.geometry=t,this._boundsStore.set(x,e.getBoundsOptimizedGeometry(h.create(),t,this.geometryInfo.hasZ,this.geometryInfo.hasM)??null));return u}_remove(w){if(null!=this.onFeatureRemove)this.onFeatureRemove(w);const x=w.objectId;this._boundsStore.delete(x);this._featuresById.delete(x);return w}}return l})},"esri/layers/graphics/data/BoundsStore":function(){define(["exports","../../../core/has","../../../core/libs/rbush/PooledRBush","../../../geometry/support/aaBoundingRect"],function(a,b,n,
k){function p(g,d,f){h.minX=d[0];h.minY=d[1];h.maxX=d[2];h.maxY=d[3];g.search(h,f)}const h={minX:0,minY:0,maxX:0,maxY:0};class e{constructor(){this._indexInvalid=!1;this._boundsToLoad=[];this._boundsById=new Map;this._idByBounds=new Map;this._index=new n.PooledRBush(9,b("esri-csp-restrictions")?g=>({minX:g[0],minY:g[1],maxX:g[2],maxY:g[3]}):["[0]","[1]","[2]","[3]"]);this._loadIndex=()=>{if(this._indexInvalid){const g=Array(this._idByBounds.size);let d=0;this._idByBounds.forEach((f,c)=>{g[d++]=c});
this._indexInvalid=!1;this._index.clear();this._index.load(g)}else this._boundsToLoad.length&&(this._index.load(Array.from(new Set(this._boundsToLoad.filter(g=>this._idByBounds.has(g))))),this._boundsToLoad.length=0)}}get fullBounds(){if(!this._boundsById.size)return null;const g=k.empty();for(const d of this._boundsById.values())d&&(g[0]=Math.min(d[0],g[0]),g[1]=Math.min(d[1],g[1]),g[2]=Math.max(d[2],g[2]),g[3]=Math.max(d[3],g[3]));return g}get valid(){return!this._indexInvalid}clear(){this._indexInvalid=
!1;this._boundsToLoad.length=0;this._boundsById.clear();this._idByBounds.clear();this._index.clear()}delete(g){const d=this._boundsById.get(g);this._boundsById.delete(g);d&&(this._idByBounds.delete(d),this._indexInvalid||this._index.remove(d))}forEachInBounds(g,d){this._loadIndex();p(this._index,g,f=>d(this._idByBounds.get(f)))}get(g){return this._boundsById.get(g)}has(g){return this._boundsById.has(g)}invalidateIndex(){this._indexInvalid||(this._indexInvalid=!0,this._boundsToLoad.length=0)}set(g,
d){if(!this._indexInvalid){const f=this._boundsById.get(g);f&&(this._index.remove(f),this._idByBounds.delete(f))}this._boundsById.set(g,d);d&&(this._idByBounds.set(d,g),this._indexInvalid||(this._boundsToLoad.push(d),5E4<this._boundsToLoad.length&&this._loadIndex()))}}a.BoundsStore=e;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/DrapedHeatmapRenderer":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/maybe ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/Logger ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ../effects/RenderPlugin ./glUtil3D ./SortedRenderGeometryRenderer ../shaders/HeatmapTechnique ../shaders/HeatmapTechniqueConfiguration ../../../webgl/enums ../../../webgl/FramebufferObject ../../../webgl/Texture ../../../webgl/TextureDescriptor ../../../webgl/Util".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w,x,u,t,m,q,r){a.DrapedHeatmapRenderer=class extends l.SortedRenderGeometryRenderer{constructor(v){super(v);this.pixelRatio=1;this._colorRampData=new Uint8ClampedArray(4);this.type="draped-heatmap";this._heatmapParameters=new w.HeatmapPassParameters;this._configuration=new x.HeatmapTechniqueConfiguration;const y=new q.TextureDescriptor;y.pixelFormat=v.pixelFormat;y.internalFormat=v.internalFormat;y.dataType=v.dataType;y.samplingMode=v.samplingMode;y.wrapMode=u.TextureWrapMode.CLAMP_TO_EDGE;
const B=v.rendererContext.rctx;this._densityMap=new t.FramebufferObject(B,y);this._quad=c.createQuadVAO(B);this._configuration.usesHalfFloat=v.dataType!==u.PixelType.FLOAT;v.rendererContext.pluginContext.techniques.precompile(w.HeatmapTechnique,this._configuration)}initialize(){const v=this._colorRampData,y=new q.TextureDescriptor(v.length/4,1);y.wrapMode=u.TextureWrapMode.CLAMP_TO_EDGE;this._colorRamp=new m.Texture(this.rctx,y,v);this._heatmapParameters.densityMap=this._densityMap.colorTexture;this.addHandles(k.watch(()=>
[this.colorRampData,this.minDensity,this.maxDensity,this.fieldTotal,this.pixelRatio,this.searchRadius],()=>this.rendererContext.notifyContentChanged()))}destroy(){this._densityMap=n.disposeMaybe(this._densityMap);this._quad=n.disposeMaybe(this._quad);this._colorRamp=n.disposeMaybe(this._colorRamp)}get searchRadius(){return this._heatmapParameters.searchRadius}set searchRadius(v){v!==this._heatmapParameters.searchRadius&&(this._heatmapParameters.searchRadius=v,this.notifyChange("searchRadius"))}get minDensity(){return this._heatmapParameters.minDensity}set minDensity(v){v!==
this._heatmapParameters.minDensity&&(this._heatmapParameters.minDensity=v,this.notifyChange("minDensity"))}get maxDensity(){return this._heatmapParameters.maxDensity}set maxDensity(v){v!==this._heatmapParameters.maxDensity&&(this._heatmapParameters.maxDensity=v,this.notifyChange("maxDensity"))}get fieldTotal(){return this._heatmapParameters.fieldTotal}set fieldTotal(v){this._heatmapParameters.fieldTotal=v;this.notifyChange("fieldTotal")}get colorRampData(){return this._colorRampData}set colorRampData(v){const {colorRamp:y}=
this._heatmapParameters;if(null!=y&&v!==this._colorRampData){const B=v.length/4;B!==y.descriptor.width&&y.resize(B,1);y.setData(v)}this._colorRampData=v}get _colorRamp(){return this._heatmapParameters.colorRamp}set _colorRamp(v){this._heatmapParameters.colorRamp=v}get hasHighlights(){return!1}get hasWater(){return!1}get rendersOccludedDraped(){return!1}render(v){var y=this.sortedRenderers;if(0!==y.length){var B=this.rctx.getBoundFramebufferObject(),z=this.rctx.getViewport(),{pixelRatio:A}=this,C=
Math.ceil(z.width*A);A=Math.ceil(z.height*A);this._densityMap.resize(C,A);this.rctx.bindFramebuffer(this._densityMap);this.rctx.setViewport(0,0,C,A);this.rctx.clear(u.FramebufferBit.COLOR);var H=!1;y.forAll(E=>{const F=E.acquireTechniques(v);F&&(E.render(v,F),f.releaseTechniques(F),H=!0)});this.rctx.bindFramebuffer(B);this.rctx.setViewport(z.x,z.y,z.width,z.height);H&&(this.rctx.bindVAO(this._quad),y=this.rendererContext.pluginContext.techniques.acquire(w.HeatmapTechnique,this._configuration),this.rctx.bindTechnique(y,
v.bind,this._heatmapParameters),this.rctx.drawArrays(y.primitiveType,0,r.vertexCount(this._quad,"geometry")),y.release())}}};b.__decorate([p.property()],a.DrapedHeatmapRenderer.prototype,"searchRadius",null);b.__decorate([p.property()],a.DrapedHeatmapRenderer.prototype,"minDensity",null);b.__decorate([p.property()],a.DrapedHeatmapRenderer.prototype,"maxDensity",null);b.__decorate([p.property()],a.DrapedHeatmapRenderer.prototype,"fieldTotal",null);b.__decorate([p.property()],a.DrapedHeatmapRenderer.prototype,
"pixelRatio",void 0);b.__decorate([p.property()],a.DrapedHeatmapRenderer.prototype,"colorRampData",null);b.__decorate([p.property({constructOnly:!0})],a.DrapedHeatmapRenderer.prototype,"dataType",void 0);b.__decorate([p.property({constructOnly:!0})],a.DrapedHeatmapRenderer.prototype,"samplingMode",void 0);b.__decorate([p.property({constructOnly:!0})],a.DrapedHeatmapRenderer.prototype,"pixelFormat",void 0);b.__decorate([p.property({constructOnly:!0})],a.DrapedHeatmapRenderer.prototype,"internalFormat",
void 0);b.__decorate([p.property()],a.DrapedHeatmapRenderer.prototype,"_colorRampData",void 0);a.DrapedHeatmapRenderer=b.__decorate([d.subclass("esri.views.3d.webgl-engine.lib.DrapedHeatmapRenderer")],a.DrapedHeatmapRenderer);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/HeatmapTechnique":function(){define("require exports ../core/shaderModules/interfaces ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../../../../chunks/Heatmap.glsl ../../../webgl/enums ../../../webgl/renderState".split(" "),
function(a,b,n,k,p,h,e,g){class d extends n.NoParameters{constructor(){super(...arguments);this.densityMap=this.colorRamp=null;this.searchRadius=1;this.minDensity=this.fieldTotal=0;this.maxDensity=100}}class f extends p.ShaderTechnique{constructor(c,l,w){super(c,l,new k.ReloadableShaderModule(h.Heatmap,()=>new Promise((x,u)=>a(["./Heatmap.glsl"],x,u))),w);this.primitiveType=e.PrimitiveType.TRIANGLE_STRIP}initializePipeline(){return g.makePipelineState({blending:g.premultipliedAlphaToPremultipliedAlpha,
colorWrite:g.defaultColorWrite,depthTest:null,depthWrite:null})}}b.HeatmapPassParameters=d;b.HeatmapTechnique=f;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/Heatmap.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass.glsl ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform".split(" "),
function(a,b,n,k,p,h){function e(d){const f=new p.ShaderBuilder;f.include(b.ScreenSpacePass);f.fragment.uniforms.add(new h.Texture2DPassUniform("densityMap",c=>c.densityMap),new h.Texture2DPassUniform("tex",c=>c.colorRamp),new n.FloatPassUniform("densityNormalizer",c=>1/(c.maxDensity-c.minDensity)),new n.FloatPassUniform("minDensity",c=>c.minDensity),new n.FloatPassUniform("densityMultiplier",c=>3/(c.searchRadius*c.searchRadius*Math.PI)*(d.usesHalfFloat?4:1))).main.add(k.glsl`float density = texture(densityMap, uv).r * densityMultiplier;
float densityRatio = (density - minDensity) * densityNormalizer;
fragColor = texture(tex, vec2(clamp(densityRatio, 0.0, 1.0), 0.5));`);return f}const g=Object.freeze(Object.defineProperty({__proto__:null,build:e},Symbol.toStringTag,{value:"Module"}));a.Heatmap=g;a.build=e})},"esri/views/3d/webgl-engine/shaders/HeatmapTechniqueConfiguration":function(){define(["exports","../../../../chunks/tslib.es6","../core/shaderTechnique/ShaderTechniqueConfiguration","../materials/DefaultTechniqueConfiguration"],function(a,b,n,k){class p extends k.DefaultTechniqueConfiguration{constructor(){super(...arguments);
this.usesHalfFloat=!1}}b.__decorate([n.parameter()],p.prototype,"usesHalfFloat",void 0);a.HeatmapTechniqueConfiguration=p;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/HeatmapDensityMaterial":function(){define("exports ../../../../core/libs/gl-matrix-2/math/vec2 ../../../../core/libs/gl-matrix-2/factories/vec2f64 ../../support/buffer/InterleavedLayout ../core/shaderLibrary/ShaderOutput ../lib/GLMaterial ../lib/Material ../lib/RenderSlot ../lib/VertexAttribute ./internal/bufferWriterUtils ../shaders/HeatmapDensityTechnique ../shaders/HeatmapDensityTechniqueConfiguration".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l){class w extends c.HeatmapDensityPassParameters{constructor(){super(...arguments);this.usesHalfFloats=this.isAttributeDriven=!1}}class x extends e.Material{constructor(v){super(v,w);this.produces=new Map([[g.RenderSlot.DRAPED_MATERIAL,y=>y===p.ShaderOutput.Color]]);this._configuration=new l.HeatmapDensityTechniqueConfiguration}getConfiguration(){this._configuration.isAttributeDriven=this.parameters.isAttributeDriven;this._configuration.usesHalfFloat=this.parameters.usesHalfFloats;
return this._configuration}get visible(){return!0}createGLMaterial(v){return new u(v)}intersect(){}intersectDraped(v,y,B,z,A,C){y=v.attributes.get(d.VertexAttribute.POSITION);({parameters:B}=this);({searchRadius:B}=B);({screenToWorldRatio:v}=v);v=B*v+2*v;v*=v;B=y.data.length/y.size;for(let E=0;E<B;E++){var H=E*y.size;H=b.set(r,y.data[H],y.data[H+1]);b.squaredDistance(H,z)<v&&A(C.dist,C.normal,-1,!1)}}createBufferWriter(){return new t(this.parameters.isAttributeDriven?q:m)}}class u extends h{beginSlot(v){return this.acquireTechnique(c.HeatmapDensityTechnique,
v)}}class t{constructor(v){this.vertexBufferLayout=v}elementCount(v){return 6*v.get(d.VertexAttribute.POSITION).indices.length}write(v,y,B,z,A,C){f.writePosition(B.get(d.VertexAttribute.POSITION),v,A.position,C,6);v=B.get(d.VertexAttribute.POSITION).indices.length;y=A.uv0;z=C;for(let H=0;H<v;++H)y.setValues(z++,-1,-1),y.setValues(z++,1,-1),y.setValues(z++,1,1),y.setValues(z++,1,1),y.setValues(z++,-1,1),y.setValues(z++,-1,-1);(A=d.VertexAttribute.FEATUREATTRIBUTE in A?A.featureAttribute:null)&&f.writeBufferFloat(B.get(d.VertexAttribute.FEATUREATTRIBUTE),
A,C,6)}}const m=k.newLayout().vec3f(d.VertexAttribute.POSITION).vec2f(d.VertexAttribute.UV0),q=m.clone().f32(d.VertexAttribute.FEATUREATTRIBUTE),r=n.create();a.HeatmapDensityMaterial=x;a.Parameters=w;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/HeatmapDensityTechnique":function(){define("require exports ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../lib/Material ../../../../chunks/HeatmapDensity.glsl ../../../webgl/renderState".split(" "),
function(a,b,n,k,p,h,e){class g extends p.MaterialParameters{constructor(){super(...arguments);this.searchRadius=128;this.resolutionForScale=0}}class d extends k.ShaderTechnique{constructor(f,c,l){super(f,c,new n.ReloadableShaderModule(h.HeatmapDensity,()=>new Promise((w,x)=>a(["./HeatmapDensity.glsl"],w,x))),l)}initializePipeline(){return e.makePipelineState({blending:e.weightedAdd,colorWrite:e.defaultColorWrite,depthTest:null,depthWrite:null})}destroy(){super.destroy()}}b.HeatmapDensityPassParameters=
g;b.HeatmapDensityTechnique=d;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/HeatmapDensity.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderLibrary/util/View.glsl ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),function(a,b,n,k,p,h){function e(d){const f=new p.ShaderBuilder,
{vertex:c,fragment:l,attributes:w,varyings:x}=f;b.addProjViewLocalOrigin(c,d);const {isAttributeDriven:u,usesHalfFloat:t}=d;w.add(h.VertexAttribute.POSITION,"vec3");w.add(h.VertexAttribute.UV0,"vec2");u&&(w.add(h.VertexAttribute.FEATUREATTRIBUTE,"float"),x.add("attributeValue","float"));t&&l.constants.add("compressionFactor","float",.25);x.add("unitCirclePos","vec2");c.uniforms.add(new n.FloatPassUniform("radius",({resolutionForScale:m,searchRadius:q},{camera:r,screenToWorldRatio:v,overlayStretch:y})=>
2*q*(0===m?1:m/v)*r.pixelRatio/r.fullViewport[2]/y));c.main.add(k.glsl`
    unitCirclePos = uv0;

    vec4 posProj = proj * (view * vec4(${h.VertexAttribute.POSITION}, 1.0));
    vec4 quadOffset = vec4(unitCirclePos * radius, 0.0, 0.0);

    ${u?k.glsl`attributeValue = ${h.VertexAttribute.FEATUREATTRIBUTE};`:""}
    gl_Position = posProj + quadOffset;
  `);l.main.add(k.glsl`
    float radiusRatioSquared = dot(unitCirclePos, unitCirclePos);
    if (radiusRatioSquared > 1.0) {
      fragColor = vec4(0.0);
    }
    else {
      float oneMinusRadiusRatioSquared = 1.0 - radiusRatioSquared;
      float density = oneMinusRadiusRatioSquared * oneMinusRadiusRatioSquared ${u?k.glsl` * attributeValue`:""} ${t?k.glsl` * compressionFactor`:""};
      fragColor = vec4(density);
    }
  `);return f}const g=Object.freeze(Object.defineProperty({__proto__:null,build:e},Symbol.toStringTag,{value:"Module"}));a.HeatmapDensity=g;a.build=e})},"esri/views/3d/webgl-engine/shaders/HeatmapDensityTechniqueConfiguration":function(){define(["exports","../../../../chunks/tslib.es6","../core/shaderTechnique/ShaderTechniqueConfiguration","../materials/DefaultTechniqueConfiguration"],function(a,b,n,k){class p extends k.DefaultTechniqueConfiguration{constructor(){super(...arguments);this.usesHalfFloat=
this.isAttributeDriven=!1}}b.__decorate([n.parameter()],p.prototype,"isAttributeDriven",void 0);b.__decorate([n.parameter()],p.prototype,"usesHalfFloat",void 0);a.HeatmapDensityTechniqueConfiguration=p;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/heatmapTextureUtils":function(){define(["exports","../../core/Error","./enums"],function(a,b,n){class k{constructor(h,e,g,d){this.dataType=h;this.samplingMode=e;this.pixelFormat=g;this.internalFormat=d}}const p=new k(n.PixelType.HALF_FLOAT,
n.TextureSamplingMode.NEAREST,n.PixelFormat.RGBA,n.PixelFormat.RGBA);a.HeatmapTextureConfiguration=k;a.fallBackHeatmapConfiguration=p;a.loadHeatmapTextureConfiguration=function(h,e){const {textureFloatLinear:g,colorBufferFloat:d}=h.capabilities,f=d?.textureFloat,c=d?.textureHalfFloat,l=d?.floatBlend;h=h.driverTest.floatBufferBlend.result;if(!f&&!c)throw new b("heatmap:missing-color-buffer-float","HeatmapRenderer requires the WebGL extension EXT_color_buffer_float or EXT_color_buffer_half_float or WEBGL_color_buffer_float.");
if(!(l&&h||c))throw new b("heatmap:missing-float-blend",`HeatmapRenderer requires the WebGL extension EXT_float_blend or EXT_color_buffer_half_float.${h?"":" This device claims support for EXT_float_blend, but does not actually support it."}`);const w=!!d?.R32F,x=!!d?.R16F;if(f&&l&&h&&g)return g||e.warnOnce("Missing WebGL extension OES_texture_float_linear. Heatmap quality may be reduced."),new k(n.PixelType.FLOAT,g?n.TextureSamplingMode.LINEAR:n.TextureSamplingMode.NEAREST,w?n.PixelFormat.RED:n.PixelFormat.RGBA,
w?n.SizedPixelFormat.R32F:n.PixelFormat.RGBA);if(c)return new k(n.PixelType.HALF_FLOAT,n.TextureSamplingMode.LINEAR,x?n.PixelFormat.RED:n.PixelFormat.RGBA,x?n.SizedPixelFormat.R16F:n.PixelFormat.RGBA);throw new b("heatmap:missing-hardware-support","HeatmapRenderer requires WebGL extensions that allow it to render and blend to float or half float textures.");};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/support/FeatureTileFetcher3DContext":function(){define(["exports",
"../../../../core/maybe","./featureTileQuery3D"],function(a,b,n){function k(h){const e=h.capabilities.query;a:switch(h.geometryType){case "polyline":h=!0;break a;case "polygon":h=h.capabilities&&h.capabilities.query&&h.capabilities.query.supportsQuantization;break a;default:h=!1}return{supportsMultipleResolutions:h,supportsPagination:!(!e||!e.supportsPagination),supportsResultType:!(!e||!e.supportsResultType),supportsCacheHint:!(!e||!e.supportsCacheHint),supportsQuantization:!(!e||!e.supportsQuantization),
supportsQuantizationEditMode:!(!e||!e.supportsQuantizationEditMode),supportsMaxRecordCountFactor:!(!e||!e.supportsMaxRecordCountFactor),supportsFormatPBF:!(!e||!e.supportsFormatPBF)}}class p{constructor(h){this._memoryCache=null;const e=h.layerView.layer;this._layerView=h.layerView;this.objectIdField=e.objectIdField;this.globalIdField="globalIdField"in e?e.globalIdField:null;this._returnZ=h.returnZ;this._returnM=h.returnM;h=this._layerView.view.resourceController;this.query=n.createFeatureTileQuery3D(this._layerView,
h.normal);h&&this._memoryCacheEnabled&&(this._memoryCache=h.memoryController.newCache(`fl-${e.uid}`))}get _memoryCacheEnabled(){switch(this._layerView.layer.source.type){case "feature-layer":case "ogc-feature":case "oriented-imagery":return!0;case "csv":case "parquet":case "geojson":case "memory":case "wfs":return!1}}destroy(){this._memoryCache=b.destroyMaybe(this._memoryCache);this.query.destroy()}createQuery(){const h=this._layerView.layer.createQuery();h.outFields=this._layerView.availableFields;
h.returnZ=this._returnZ;h.returnM=this._returnM;h.outSpatialReference=this.tilingScheme.spatialReference;return h}get memoryCache(){return this._memoryCache}get viewingMode(){return this._layerView.view.state.viewingMode}get tilingScheme(){return this._layerView.view.featureTiles.tilingScheme}get scheduler(){return this._layerView.view.resourceController?.scheduler}get geometryType(){return this._layerView.layer.geometryType}get fullExtent(){return this._layerView.layer.fullExtent}get tileMaxRecordCount(){return this._layerView.layer.capabilities.query.tileMaxRecordCount}get maxRecordCount(){return this._layerView.layer.capabilities.query.maxRecordCount}get isDraped(){return"on-the-ground"===
this._layerView.layer.elevationInfo?.mode}get capabilities(){this._capabilities??(this._capabilities=k(this._layerView.layer));return this._capabilities}logFetchError(h,e){h.error("#fetchTile()",this._layerView.layer,e?.message??e)}}a.FeatureTileFetcher3DContext=p;a.contextCapabilitiesFromLayer=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/support/featureTileQuery3D":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/SetUtils ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/Logger ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ../../../../layers/graphics/dehydratedFeatures ../../../../rest/query/operations/query ../../support/PBFDecoder".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w,x){let u=class extends n{constructor(q){super(q)}get implicitFields(){if(!this.layer.outFields?.includes("*"))return new Set;const q=new Set(this.layerView.requiredFields),r=new Set(this.layerView.availableFields);return h.difference(r,q)}get queryFeaturesDehydrated(){const {layer:q}=this;var r=q.capabilities;r=r&&r.query;const v=q.parsedUrl;if(r&&r.supportsFormatPBF){null==this._decoder&&(this._decoder=new x.PBFDecoder(this.controller));const y={sourceSpatialReference:q.spatialReference?.toJSON()??
null,applyTransform:!0,maxStringAttributeFields:this.implicitFields,maxStringAttributeLength:1024};return(B,z)=>w.runQuery(v,B,"pbf",this._createRequestOptions(z)).then(A=>{p.throwIfAborted(z);return null!=this._decoder?this._decoder.invoke({buffer:A.data,options:y},z.signal):Promise.reject(p.createAbortError())})}return(y,B)=>w.executeQuery(v,y,q.spatialReference,this._createRequestOptions(B)).then(z=>l.fromFeatureSetJSON(z.data,{maxStringAttributeFields:this.implicitFields,maxStringAttributeLength:1024}))}queryFeatureCount(q,
r){return this.layer.queryFeatureCount(q,r)}destroy(){this._decoder=k.destroyMaybe(this._decoder)}_createRequestOptions(q){return{...q,query:{...this.layer.customParameters,token:this.layer.apiKey,...q?.query}}}};b.__decorate([e.property({constructOnly:!0})],u.prototype,"layer",void 0);b.__decorate([e.property({constructOnly:!0})],u.prototype,"layerView",void 0);b.__decorate([e.property({constructOnly:!0})],u.prototype,"controller",void 0);b.__decorate([e.property({readOnly:!0})],u.prototype,"implicitFields",
null);b.__decorate([e.property({readOnly:!0})],u.prototype,"queryFeaturesDehydrated",null);u=b.__decorate([c.subclass("esri.views.3d.layers.support.featureTileQuery3D.FeatureTileServiceQuery3D")],u);let t=class extends n{constructor(q){super(q)}queryFeaturesDehydrated(q,r){return this.layer.queryFeatures(q,r)}};b.__decorate([e.property({constructOnly:!0})],t.prototype,"layer",void 0);t=b.__decorate([c.subclass("esri.views.3d.layers.support.featureTileQuery3D.FeatureTileOGCServiceQuery3D")],t);let m=
class extends n{constructor(q){super(q)}queryFeaturesDehydrated(q,r){return this.source.queryFeaturesJSON(q,r).then(l.fromFeatureSetJSON,v=>{if(v&&"query-features-json:unsupported"===v.name)return this.layer.queryFeatures(q,r);throw v;})}queryFeatureCount(q,r){return this.layer.queryFeatureCount(q,r)}};b.__decorate([e.property({constructOnly:!0})],m.prototype,"layer",void 0);b.__decorate([e.property({constructOnly:!0})],m.prototype,"source",void 0);m=b.__decorate([c.subclass("esri.views.3d.layers.support.featureTileQuery3D.FeatureTileClientQuery3D")],
m);a.createFeatureTileQuery3D=function(q,r){const {layer:v}=q;return"feature"===v.type&&"feature-layer"===v.source.type||"catalog-footprint"===v.type?new u({layer:v,layerView:q,controller:r}):"feature"===v.type&&"memory"===v.source.type||"csv"===v.type||"geojson"===v.type||"oriented-imagery"===v.type||"wfs"===v.type?new m({layer:v,source:v.source}):"ogc-feature"===v.type?new t({layer:v}):null};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/PBFDecoder":function(){define("exports ../../../core/typedArrayUtil ../../../core/uid ../../../core/workers/WorkerHandle ../../../geometry/SpatialReference ../../../layers/support/Field".split(" "),
function(a,b,n,k,p,h){function e(f){switch(f.type){case "polyline":f.paths.reduce((c,l)=>c+l.length,0)<b.nativeArrayMaxSize&&(f.paths=f.hasZ||f.hasM?f.paths.map(c=>c.map(l=>[l[0],l[1],l[2]])):f.paths.map(c=>c.map(l=>[l[0],l[1]])));break;case "polygon":f.rings.reduce((c,l)=>c+l.length,0)<b.nativeArrayMaxSize&&(f.rings=f.hasZ||f.hasM?f.rings.map(c=>c.map(l=>[l[0],l[1],l[2]])):f.rings.map(c=>c.map(l=>[l[0],l[1]])))}}class g{constructor(f){this._controller=f;this._handle=new d(c=>f.schedule(c))}destroy(){this._handle.destroy()}invoke(f,
c){if(!f.buffer||0===f.buffer.byteLength)return Promise.resolve(null);f.options.sourceSpatialReference&&f.options.sourceSpatialReference instanceof p&&(f.options={...f.options,sourceSpatialReference:f.options.sourceSpatialReference.toJSON()});return this._handle.invoke(f,c).then(l=>{let w=0,x=0;const u=p.fromJSON(l.spatialReference);l.spatialReference=u;const t=async m=>{var q=l.fields;if(q)for(;w<q.length;)if(q[w]=h.fromJSON(q[w]),w++,m.madeProgress())return this._controller.reschedule(v=>t(v));
for(q=l.features;x<q.length;){var r=q[x];++x;r.uid=n.generateUID();r=r.geometry;if(null!=r&&(r.spatialReference=u,e(r),m.madeProgress()))return this._controller.reschedule(v=>t(v))}return l};return this._controller.schedule(m=>t(m))})}}class d extends k.WorkerHandle{constructor(f){super("PBFDecoderWorker","_parseFeatureQuery",{_parseFeatureQuery:c=>[c.buffer]},f)}}a.PBFDecoder=g;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/EventedSet":function(){define(["exports",
"../../../core/Evented","../../../core/ObservableChangesType","../../../core/signal"],function(a,b,n,k){class p extends b{constructor(){super(...arguments);this._set=new Set;this._length=k.signal(0)}clear(){if(0<this._set.size){const h=this.toArray();this._set.clear();this.emit("after-changes",{type:n.ObservableChangesType.REMOVE});this.emit("change",{added:[],removed:h})}}get length(){return this._length.value}addMany(h){if(0!==h.length){for(const e of h)this._set.add(e);this._length.value=this._set.size;
this.emit("after-changes",{type:n.ObservableChangesType.ADD});this.emit("change",{added:h,removed:[]})}}remove(h){this._set.delete(h)&&(this._length.value=this._set.size,this.emit("after-changes",{type:n.ObservableChangesType.REMOVE}),this.emit("change",{added:[],removed:[h]}))}removeMany(h){const e=[];for(const g of h)this._set.delete(g)&&e.push(g);0<e.length&&(this._length.value=this._set.size,this.emit("after-changes",{type:n.ObservableChangesType.REMOVE}),this.emit("change",{added:[],removed:e}))}toArray(){return Array.from(this._set.values())}find(h){for(const e of this._set.values())if(h(e))return e}some(h){for(const e of this._set.values())if(h(e))return!0;
return!1}forEach(h){this._set.forEach(e=>h(e))}}a.EventedSet=p;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/layers/FeatureLayerView":function(){define("../../chunks/tslib.es6 ../../core/Error ../../core/has ../../core/Logger ../../core/promiseUtils ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/RandomLCG ../../core/accessorSupport/decorators/subclass ../../layers/support/FeatureEffect ../../layers/support/FeatureFilter ../../layers/support/fieldUtils ../../layers/support/floorFilterUtils ../../rest/support/Query ../../support/arcadeOnDemand ./support/popupUtils".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w,x,u,t){return m=>{m=class extends m{constructor(...q){super(...q);this._updatingRequiredFieldsPromise=null;this.dataUpdating=!1;this.layer=this.filter=null;this.requiredFields=[];this.view=null}initialize(){this.addHandles([h.watch(()=>{const q=this.layer;return[q&&"elevationInfo"in q?q.elevationInfo?.featureExpressionInfo:null,q&&"displayField"in q?q.displayField:null,q&&"timeInfo"in q&&q.timeInfo,q&&"renderer"in q&&q.renderer,q&&"labelingInfo"in q&&q.labelingInfo,
q&&"floorInfo"in q&&q.floorInfo,this.filter,this.featureEffect,this.timeExtent]},()=>this._handleRequiredFieldsChange(),h.syncAndInitial),h.on(()=>this.view?.floors,"change",()=>this._handleRequiredFieldsChange()),h.on(()=>{const q=this.layer;return q&&"sublayers"in q?q.sublayers:null},"change",()=>this._handleRequiredFieldsChange())])}get availableFields(){if(!this.layer)return[];const {layer:q,layer:{fieldsIndex:r},requiredFields:v}=this;return"outFields"in q&&q.outFields?l.fixFields(r,[...l.unpackFieldNames(r,
q.outFields),...v]):l.fixFields(r,v)}get featureEffect(){return this.layer&&"featureEffect"in this.layer?this.layer.featureEffect:null}set featureEffect(q){this._override("featureEffect",q)}get maximumNumberOfFeatures(){return 0}set maximumNumberOfFeatures(q){k.getLogger(this).error("#maximumNumberOfFeatures\x3d","Setting maximum number of features is not supported")}get maximumNumberOfFeaturesExceeded(){return!1}highlight(q){throw Error("missing implementation");}createQuery(){var q={outFields:["*"],
returnGeometry:!0,outSpatialReference:this.view.spatialReference};q=null!=this.filter?this.filter.createQuery(q):new x(q);if("floorInfo"in this.layer&&this.layer.floorInfo){const r=w.getFloorFilterClause(this);null!=r&&(q.where=q.where?`(${q.where}) AND (${r})`:r)}null!=this.timeExtent&&(q.timeExtent=null!=q.timeExtent?q.timeExtent.intersection(this.timeExtent):this.timeExtent.clone());return q}createAggregateQuery(){return new x({outFields:["*"],returnGeometry:!0,outSpatialReference:this.view.spatialReference})}queryFeatures(q,
r){throw Error("missing implementation");}queryObjectIds(q,r){throw Error("missing implementation");}queryFeatureCount(q,r){throw Error("missing implementation");}queryExtent(q,r){throw Error("missing implementation");}async fetchPopupFeaturesFromGraphics(q,r){this._validateFetchPopupFeatures(q,r);return this._fetchPopupFeatures(q,r)}_loadArcadeModules(q){return q.expressionInfos?.length||Array.isArray(q.content)&&q.content.some(r=>"expression"===r.type)?u.loadArcade():Promise.resolve()}_handleRequiredFieldsChange(){const q=
this._updateRequiredFields();this._set("_updatingRequiredFieldsPromise",q);q.then(()=>{this._updatingRequiredFieldsPromise===q&&this._set("_updatingRequiredFieldsPromise",null)})}async _updateRequiredFields(){if(this.layer&&this.view){var q="3d"===this.view.type,{layer:r,layer:{fieldsIndex:v,objectIdField:y}}=this,B="renderer"in r&&r.renderer,z="orderBy"in r&&r.orderBy,A="featureReduction"in r?r.featureReduction:null,C=new Set;B=await Promise.allSettled([B?B.collectRequiredFields(C,v):null,l.collectLabelingFields(C,
r),q&&"elevationInfo"in r?l.collectElevationFields(C,r):null,null!=this.filter?l.collectFilterFields(C,r,this.filter):null,q||null==this.featureEffect?null:l.collectFilterFields(C,r,this.featureEffect.filter),!q&&A?l.collectFeatureReductionFields(C,r,A):null,!q&&z?l.collectOrderByInfos(C,r,z):null]);"timeInfo"in r&&r.timeInfo&&this.timeExtent&&l.collectFields(C,r.fieldsIndex,[r.timeInfo.startField,r.timeInfo.endField]);"floorInfo"in r&&r.floorInfo&&l.collectFields(C,r.fieldsIndex,[r.floorInfo.floorField]);
"feature"===r.type&&q&&null!=r.infoFor3D&&(null==r.globalIdField&&k.getLogger(this).error("globalIdField missing on 3DObjectFeatureLayer"),l.collectFields(C,r.fieldsIndex,[r.globalIdField]));"subtype-group"===r.type&&(l.collectField(C,v,r.subtypeField),z=r.sublayers.map(H=>Promise.all([H.renderer?.collectRequiredFields(C,v),l.collectLabelingFields(C,H)])),await Promise.allSettled(z));"catalog-footprint"===r.type&&r.parent&&(z=r.parent,l.collectFields(C,v,[z.itemNameField,z.itemSourceField,z.itemTypeField,
z.maxScaleField,z.minScaleField]));for(const H of B)"rejected"===H.status&&k.getLogger(this).error(H.reason);l.collectField(C,v,y);q&&"displayField"in r&&r.displayField&&l.collectField(C,v,r.displayField);q=Array.from(C).sort();this._set("requiredFields",q)}}_validateFetchPopupFeatures(q,r){if(null!=r)for(const v of q){q=v.origin&&"layer"in v.origin?v.origin.layer:v.layer;if("popupEnabled"in q&&!q.popupEnabled)throw new b("featurelayerview:fetchPopupFeatures","Popups are disabled",{layer:q});if(v.isAggregate){const y=
"featureReduction"in q?q.featureReduction:null;if(!(y&&"popupTemplate"in y&&y.popupEnabled&&y.popupTemplate))throw new b("featurelayerview:fetchPopupFeatures","Popups are disabled",{layer:q});}else if("popupTemplate"in q&&!t.getFetchPopupTemplate(q,r))throw new b("featurelayerview:fetchPopupFeatures","Layer does not define a popup template",{layer:q});}}_popupFeatureHasRequiredFields(q,r){return l.featureHasFields(r,q)}async _fetchPopupFeatures(q,r){const v=Array(q.length),y=new Map,B=await this._createPopupQuery(q.map(A=>
A.origin?.layer??A.layer),r);for(let A=0;A<q.length;A++){const C=q[A];if(C.isAggregate){v[A]=C;continue}var z=C.origin?.layer??C.layer;if(!(z&&"popupEnabled"in z))continue;const H=l.unpackFieldNames(this.layer.fieldsIndex,B.outFields);z=t.getFetchPopupTemplate(z,r);if(null==z)continue;const E=await this._loadArcadeModules(z);p.throwIfAborted(r);E&&E.arcadeUtils.hasGeometryOperations(z)||!this._popupFeatureHasRequiredFields(C,H)?y.set(C.getObjectId(),{graphic:C,index:A}):v[A]=C}if("stream"===this.layer.type||
"parquet"===this.layer.type||0===y.size)return v.filter(Boolean);B.objectIds=Array.from(y.keys());try{const A=await this.layer.queryFeatures(B,r);for(const C of A.features){const {graphic:{geometry:H,origin:E},index:F}=y.get(C.getObjectId());let G;(G=C).geometry||(G.geometry=H);C.origin=E;v[F]=C}}catch{}return v.filter(Boolean)}async _createPopupQuery(q,r){const v=this.layer.createQuery(),y=new Set;var B=!1;q=q??[this.layer];for(const z of q)if("popupEnabled"in z&&(q=t.getFetchPopupTemplate(z,r),
null!=q)){B=await this._loadArcadeModules(q);p.throwIfAborted(r);B=B&&B.arcadeUtils.hasGeometryOperations(q);B=!("point"!==this.layer.geometryType&&!B);q=await t.getRequiredFields(this.layer,q);p.throwIfAborted(r);for(const A of q)y.add(A)}v.returnGeometry=B;v.returnZ=B;v.returnM=B;v.outFields=Array.from(y);v.outSpatialReference=this.view.spatialReference;"floorInfo"in this.layer&&this.layer.floorInfo&&(r=w.getFloorFilterClause(this),null!=r&&(v.where=v.where?`(${v.where}) AND (${r})`:r));return v}canResume(){return!super.canResume()||
null!=this.timeExtent&&this.timeExtent.isEmpty?!1:!0}getTest(){}get test(){}};a.__decorate([e.property()],m.prototype,"_updatingRequiredFieldsPromise",void 0);a.__decorate([e.property({readOnly:!0})],m.prototype,"availableFields",null);a.__decorate([e.property({readOnly:!0})],m.prototype,"dataUpdating",void 0);a.__decorate([e.property({type:f})],m.prototype,"featureEffect",null);a.__decorate([e.property({type:c})],m.prototype,"filter",void 0);a.__decorate([e.property()],m.prototype,"layer",void 0);
a.__decorate([e.property({type:Number})],m.prototype,"maximumNumberOfFeatures",null);a.__decorate([e.property({readOnly:!0,type:Boolean})],m.prototype,"maximumNumberOfFeaturesExceeded",null);a.__decorate([e.property({readOnly:!0})],m.prototype,"requiredFields",void 0);a.__decorate([e.property()],m.prototype,"suspended",void 0);a.__decorate([e.property()],m.prototype,"view",void 0);return m=a.__decorate([d.subclass("esri.views.layers.FeatureLayerView")],m)}})},"esri/views/layers/RefreshableLayerView":function(){define("../../chunks/tslib.es6 ../../core/Logger ../../core/promiseUtils ../../core/reactiveUtils ../../core/has ../../core/RandomLCG ../../core/Error ../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,n,k,p,h,e,g){return d=>{d=class extends d{initialize(){this.addHandles(k.on(()=>this.layer,"refresh",f=>{this.doRefresh(f.dataChanged).catch(c=>{n.isAbortError(c)||b.getLogger(this).error(c)})}),"RefreshableLayerView")}};return d=a.__decorate([g.subclass("esri.views.layers.RefreshableLayerView")],d)}})},"esri/views/3d/layers/PointCloudLayerView3D":function(){define("../../../chunks/tslib.es6 ../../../core/arrayUtils ../../../core/asyncUtils ../../../core/Collection ../../../core/has ../../../core/Logger ../../../core/maybe ../../../core/promiseUtils ../../../core/reactiveUtils ../../../core/screenUtils ../../../core/typedArrayUtil ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/decorators/subclass ../../../chunks/vec32 ../../../core/libs/gl-matrix-2/factories/vec3f32 ../../../geometry/support/aaBoundingBox ../../../geometry/support/plane ../../../layers/support/CodedValue ../../../layers/support/CodedValueDomain ../../../layers/support/Domain ../../../layers/support/InheritedDomain ../../../layers/support/RangeDomain ../../../layers/support/fieldUtils ../../../layers/support/PromiseQueue ../../../support/elevationInfoUtils ./LayerView3D ./PointCloudLayerViewPerformanceInfo ./PointCloudWorkerHandle ./i3s/I3SUtil ./i3s/LoDUtil ./i3s/PagedNodeIndex ./i3s/PointCloudRendererUtil ./i3s/PointCloudWorkerUtil ./i3s/PointGraphic ./i3s/PointRenderer ./support/highlightUtils ./support/PopupSceneLayerView ../support/extentUtils ../support/hitTest ../support/index ../support/orientedBoundingBox ../support/updatingProperties ../../layers/LayerView ../../support/HighlightDefaults ../../support/layerViewUtils ../../support/Scheduler".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w,x,u,t,m,q,r,v,y,B,z,A,C,H,E,F,G,D,I,J,N,M,Q,O,K,L,P,R,W,V,ba,U,da,fa){function ha(S){return Z=>S.immediate.schedule(Z)}const T=m.create();p=class extends K.PopupSceneLayerView(H.LayerView3D(ba)){constructor(){super(...arguments);this.type="point-cloud-3d";this.maximumPointCount=4E6;this.slicePlaneEnabled=!1;this._renderer=null;this._rendererAdded=!1;this._renderedNodes=new Set;this._updateViewNeeded=!0;this._lodFactor=1;this._maxLoggedBoxWarnings=5;this._pageMultiplier=
1;this._nodeLoadEpoch=0;this._indexQueue=[];this._workQueue=[];this._idleQueue=new A.PromiseQueue;this._indexPagesLoading=new Map;this._loadingNodes=new Map;this._recalcWork=!0;this._layerIsVisible=!1;this._codedDomainPopulationAbortController=this._codedDomainPopulationPromise=null;this._totalWork=0;this._index=null;this._loadingInitNodePage=!1;this._nodeIdArray=[];this.ignoresMemoryFactor=!1}get baseUrl(){return this.layer.parsedUrl?.path??""}get pointScale(){const S=J.getSplatSizeAlgorithm(this.layer?.renderer);
return null!=S?.scaleFactor?S.scaleFactor:1}get useRealWorldSymbolSizes(){const S=J.getFixedSizeAlgorithm(this.layer?.renderer);return null!=S?.useRealWorldSymbolSizes?S.useRealWorldSymbolSizes:!1}get pointSize(){const S=J.getFixedSizeAlgorithm(this.layer?.renderer);return null!=S?.size?S.size:0}get inverseDensity(){return this.layer?.renderer?96/this.layer.renderer.pointsPerInch:5}get availableFields(){var S=J.getRendererInfo(this.layer);const Z=new Set;S.primaryAttribute&&Z.add(S.primaryAttribute.name);
S.modulationAttribute&&Z.add(S.modulationAttribute.name);if(S=J.getFilterInfo(this.layer))for(const ia of S)ia.attributeInfo&&Z.add(ia.attributeInfo.name);if(this.layer.outFields)for(const ia of z.unpackFieldNames(this.layer.fieldsIndex,this.layer.outFields))Z.add(ia);return Array.from(Z)}get _clippingBox(){if(!this.view||!this.view.clippingArea)return null;const S=t.create();return L.projectToBoundingBox(this.view.clippingArea,S,this.view.renderSpatialReference)?S:null}get _elevationOffset(){const S=
this.layer&&this.layer.elevationInfo;return S&&"absolute-height"===S.mode?C.getElevationOffset(S,this.layer.spatialReference):0}initialize(){const S=this.view.resourceController;var Z=ha(S);this._worker=new F.PointCloudWorkerHandle(Z);this.addResolvingPromise(this._worker.promise);G.checkPointCloudLayerValid(this.layer);G.checkPointCloudLayerCompatibleWithView(this.layer,this.view);this._indexRequester=S.createStreamDataRequester(R.ClientType.I3S_INDEX);this._dataRequester=S.createStreamDataRequester(R.ClientType.I3S_DATA);
this._initRenderer();Z=this._initNodePages();this._memCache=this.view.resourceController.memoryController.newCache(`pcl-${this.layer.uid}`);this._updatingHandles.add(()=>this._clippingBox,()=>this._setUpdateViewNeeded(),d.initial);this._updatingHandles.add(()=>this._elevationOffset,()=>this._elevationOffsetChanged(),d.initial);this._updatingHandles.add(()=>this.layer.renderer,()=>this._rendererChanged(),d.initial);this._updatingHandles.add(()=>this.layer.filters,()=>this._reload(),d.initial);this._updatingHandles.add(()=>
this.layer.outFields,()=>this._reload(),d.initial);this._updatingHandles.add(()=>this.layer.effectiveScaleRange,()=>this._setUpdateViewNeeded());this._updatingHandles.add(()=>this.view.state.contentCamera,()=>this._setUpdateViewNeeded());this.addHandles([d.watch(()=>this.view.quality,()=>this._setUpdateViewNeeded(),d.sync)]);this.addResolvingPromise(Z);this.when(()=>{this.addHandles([S.scheduler.registerTask(fa.TaskPriority.POINT_CLOUD_LAYER,this),S.scheduler.registerIdleStateCallbacks(()=>this._idleBegin(),
()=>this._idleEnd()),this._updatingHandles.add(()=>this.suspended,ia=>{ia?this._clearNodeState():this._setUpdateViewNeeded()},d.initial)])},()=>{this._updatingHandles.removeAll();this.removeAllHandles()})}_setUpdateViewNeeded(){this._updateViewNeeded=!0;this._updateLoading()}destroy(){this.cancelLoading();this._worker=e.destroyMaybe(this._worker);this._destroyRenderer();this._memCache=e.destroyMaybe(this._memCache);this._codedDomainPopulationAbortController=e.abortMaybe(this._codedDomainPopulationAbortController);
this._codedDomainPopulationPromise=null}_initRenderer(){this._renderer=new Q.PointRenderer({createGraphic:(S,Z,ia)=>this._createGraphic(S,Z,ia)});this._renderer.layerUid=this.layer.uid;this._updatingHandles.add(()=>this._clippingBox,S=>this._renderer.clippingBox=S,d.initial);this._updatingHandles.add(()=>this.suspended,S=>this._setPointsVisible(!S),d.initial);this._updatingHandles.add(()=>this.pointScale,S=>this._renderer.scaleFactor=S,d.initial);this._renderer.minSizePx=Math.sqrt(2);this._updatingHandles.add(()=>
this.useRealWorldSymbolSizes,S=>this._renderer.useRealWorldSymbolSizes=S,d.initial);this._updatingHandles.add(()=>this.pointSize,S=>{const Z=f.pt2px(S);this._renderer.size=S;this._renderer.sizePx=Z},d.initial);this._updatingHandles.add(()=>this.slicePlaneEnabled,S=>this._renderer.slicePlaneEnabled=S,d.initial);this._updatingHandles.add(()=>this.inverseDensity,()=>this._setUpdateViewNeeded(),d.initial);this._updatingHandles.add(()=>this.maximumPointCount,()=>this._setUpdateViewNeeded(),d.initial);
this._updatingHandles.add(()=>this.view.qualitySettings.sceneService.pointCloud.lodFactor,S=>{this._lodFactor=S;this._setUpdateViewNeeded()},d.initial)}_destroyRenderer(){this._renderer.removeAll();this._setPointsVisible(!1)}_createGraphic(S,Z,ia){const Y=null!=S.pointIdFilterMap?S.pointIdFilterMap[Z]:Z;ia=P.computeMapPointFromVec3d(this.view,ia);const ea=this._createGraphicAttributes(S,Y);return new M.PointGraphic({pointCloudMetadata:{nodeId:S.id,pointIndexInNode:Z,attributePointIndexInNode:Y,epoch:this._nodeLoadEpoch},
geometry:ia,attributes:ea,layer:this.layer,sourceLayer:this.layer})}_createGraphicAttributes(S,Z){const ia={};for(const Y of S.attributes)this._encodeGraphicAttribute(Y.attributeInfo,Y.values,Z,ia);return ia}_encodeGraphicAttribute(S,Z,ia,Y){var ea=S.storageInfo?.attributeValues;const ka=ea?.valuesPerElement??1;if(1===ka)Y[S.name]=Z[ia];else if("UInt8"===ea?.valueType&&4>=ka){ea=0;ia*=ka;for(let ja=ia;ja<ia+ka;ja++)ea=(ea<<8)+Z[ja];Y[S.name]=ea}else Y[S.name]=void 0}_setPointsVisible(S){S&&!this._rendererAdded?
(this.view._stage.addRenderPlugin(this._renderer),this._rendererAdded=!0):!S&&this._rendererAdded&&(this.view._stage.removeRenderPlugin(this._renderer),this._rendererAdded=!1)}_rendererChanged(){this._renderer.useFixedSizes=J.rendererUsesFixedSizes(this.layer.renderer);this._reload()}_reload(){this._clearNodeState();this._memCache.clear();this._setUpdateViewNeeded()}_elevationOffsetChanged(){this._clearNodeState();this._memCache.clear();this._initNodePages()}_displayNodes(S){this._workQueue=D.nodeDiff([...this._renderedNodes],
S,this._index);D.sortFrontToBack(this._workQueue,this.view.state.contentCamera.viewForward,this._index);D.splitWorkEntries(this._workQueue,8,this._index);this._updateQueues();this._totalWork=this._computeWork();this._updateLoading();this._layerIsVisible=0<S.length||this._loadingInitNodePage;this.notifyChange("suspended")}cancelLoading(){this._cancelNodeLoading();this._cancelIndexLoading()}_cancelNodeLoading(){const S=[];this._loadingNodes.forEach(({abortController:Z})=>S.push(Z));this._loadingNodes.clear();
for(const Z of S)Z.abort();this._workQueue=[];this._idleQueue.cancelAll();this._totalWork=this._computeWork();this._updateLoading()}_updateQueues(){const S=new Set;this._workQueue.forEach(Y=>Y.load.forEach(ea=>S.add(ea)));const Z=[],ia=new Map;this._loadingNodes.forEach((Y,ea)=>{S.has(ea)?ia.set(ea,Y):Z.push(Y)});this._loadingNodes=ia;for(const {abortController:Y}of Z)Y.abort();this._workQueue=this._workQueue.filter(Y=>{for(const ea of Y.load)if(this._loadingNodes.has(ea))return this._recalcWork=
!0,!1;return!0});this._totalWork=this._computeWork();this._updateLoading()}_cancelIndexLoading(){this._indexQueue=[];this._indexPagesLoading.forEach(({abortController:S})=>S.abort());this._indexPagesLoading.clear();this._totalWork=this._computeWork();this._updateLoading()}_clearNodeState(){this._nodeLoadEpoch++;this._renderedNodes.forEach(S=>this._removeFromRenderer(S));this._cancelNodeLoading()}_idleBegin(){this._setUpdateViewNeeded()}_idleEnd(){this._setUpdateViewNeeded()}get running(){return this.suspended?
this._updateViewNeeded:this._updateViewNeeded||0<this._indexQueue.length||0<this._workQueue.length||this._idleQueue.running}runTask(S){if(this.suspended)this._updateViewNeeded&&(this._updateViewNeeded=!1,S=this._isRootNodeVisible(),S!==this._layerIsVisible&&(this._layerIsVisible=S,this.notifyChange("suspended")),this._updateLoading());else{for(S.run(()=>this._updateWorkQueues());0<this._indexQueue.length&&S.run(()=>this._processIndexQueue()););this._processWorkQueue(S);this._idleQueue.runTask(S)}}_processIndexQueue(){const S=
this._indexQueue.shift(),Z=this._loadNodePage(S);this._indexPagesLoading.set(S,Z);Z.promise.then(ia=>{this._index.addPage(S,ia,this._elevationOffset);this._setUpdateViewNeeded()}).then(()=>{this._indexPagesLoading.delete(S)},()=>{this._indexPagesLoading.delete(S)});return!0}_processWorkQueue(S){for(;!S.done;){const Z=this._scheduleWorkEntry();if(null==Z){S.madeProgress();break}this._processWorkEntry(Z);S.madeProgress()}}_scheduleWorkEntry(){let S=this._workQueue.length;for(;S--;){const Z=this._workQueue.shift();
if(Z.remove.find(ia=>!this._renderedNodes.has(ia)))this._workQueue.push(Z);else return Z}return null}_processWorkEntry(S){if(0===S.load.length)for(const Z of S.remove)this._removeFromRenderer(Z);else Promise.all(S.load.map(Z=>{const ia=new AbortController,Y=this._memCache.pop(Z.toString());null!=Y?this._loadingNodes.set(Z,{abortController:ia,promise:Promise.resolve(Y)}):this._loadingNodes.has(Z)||this._loadingNodes.set(Z,{abortController:ia,promise:this._loadNode(Z,ia.signal)});return this._loadingNodes.get(Z).promise})).then(Z=>
{for(let ia=0;ia<S.load.length;ia++)if(Z[ia]){const Y=this._setupRendererData(S.load[ia],Z[ia]);this._addToRenderer(Y)}for(const ia of S.remove)this._removeFromRenderer(ia)}).catch(()=>{}).then(()=>{for(const Z of S.load)this._loadingNodes.delete(Z);this._updateLoading();this._recalcWork&&!this._idleQueue.running&&0===this._indexQueue.length&&0===this._loadingNodes.size&&(this._recalcWork=!1,this._setUpdateViewNeeded())}),this._updateLoading()}async _populateClassCodeCodedDomain(S,Z){const ia=this.layer.fieldsIndex.get("CLASS_CODE");
ia&&!ia.domain&&S.includes(ia.name)&&(S=await n.result(this.layer.queryCachedStatistics("CLASS_CODE",{signal:Z})),!1!==S.ok&&(S=S.value?.stats?.labels?.labels)&&Array.isArray(S)&&(ia.domain=new r({name:"CLASS_CODE",codedValues:S.map(Y=>new q.CodedValue({code:Y.value,name:Y.label}))})))}async prepareFetchPopupFeatures(S){this._codedDomainPopulationPromise||(this._codedDomainPopulationAbortController=new AbortController,this._codedDomainPopulationPromise=this._populateClassCodeCodedDomain(S,this._codedDomainPopulationAbortController.signal).then(()=>
{this._codedDomainPopulationAbortController=null}));return this._codedDomainPopulationPromise}async whenGraphicAttributes(S,Z){const ia=this._splitGraphicsPerNode(S),Y=this.layer.attributeStorageInfo,ea=Z.map(X=>J.getAttributeInfo(Y,X)).filter(b.isSome),ka=async(X,aa)=>{const pa=this._index.getNode(aa);await n.forEach(ea,async la=>{const na=la.useElevation?await this._loadElevationAttributeFromGeometry(pa.resourceId):await this._loadAndParseAttribute(pa,la);if(na)for(const qa of X)this._isValidPointGraphic(qa)&&
this._encodeGraphicAttribute(la,na,qa.pointCloudMetadata.attributePointIndexInNode,qa.attributes)})},ja=[];ia.forEach((X,aa)=>{ja.push(ka(X,aa))});await Promise.allSettled(ja);return S}_isValidPointGraphic(S){return S instanceof M.PointGraphic&&S.pointCloudMetadata?.epoch===this._nodeLoadEpoch}_splitGraphicsPerNode(S){const Z=new Map;for(const ia of S){if(!this._isValidPointGraphic(ia))continue;S=ia.pointCloudMetadata;const Y=Z.get(S.nodeId);Y?Y.push(ia):Z.set(S.nodeId,[ia])}return Z}async _loadAndParseAttribute(S,
Z){const ia=await this._loadAttribute(S.resourceId,Z,null);return null!=ia?N.getAttributeValues({attributeInfo:Z,buffer:ia},null,S.vertexCount):null}async _loadElevationAttributeFromGeometry(S){S=N.readGeometry(this.layer.store.defaultGeometrySchema,await this._loadGeometry(S,null));return N.elevationFromPositions(S,S.length/3)}highlight(S,Z){if(!S)return O.emptyHighlightHandle;S=k.isCollection(S)?S.toArray():Array.isArray(S)?S:[S];return 0===S.length?O.emptyHighlightHandle:this._renderer.highlight(S.map(ia=>
this._graphicToPointDefinition(ia)),Z??U.defaultHighlightName)}_graphicToPointDefinition(S){if(!this._isValidPointGraphic(S))return null;const {nodeId:Z,pointIndexInNode:ia}=S.pointCloudMetadata;return null!=Z&&null!=ia?{nodeId:Z,pointId:ia}:null}_computeWork(){let S=0;for(const Z of this._workQueue)S+=Z.load.length+Z.remove.length;S+=this._loadingNodes.size;S+=(this._indexQueue.length+this._indexPagesLoading.size)*this._index.pageSize;S+=this._loadingInitNodePage?100:0;return S+=this._updateViewNeeded?
100:0}get updatingProgressValue(){if(this.suspended)return this._updateViewNeeded?0:1;const S=this._computeWork();return 1-Math.min(this._totalWork,S)/this._totalWork}_updateLoading(){this.notifyChange("updating");this.notifyChange("updatingProgressValue")}canResume(){return super.canResume()&&this._layerIsVisible}isUpdating(){return this.suspended?this._updateViewNeeded:0<this._computeWork()}get visibleAtCurrentScale(){return da.isInEffectiveScaleRange(this.layer.effectiveScaleRange,this.view.scale)}_initNodePages(){const S=
this.layer.store.index;this._index=new I.PagedNodeIndex(this.layer.spatialReference,this.view.renderCoordsHelper.spatialReference,S.nodesPerPage||S.nodePerIndexBlock);this._cancelIndexLoading();this._traverseVisible=this._index.createVisibilityTraverse();this._layerIsVisible=this._loadingInitNodePage=!0;this.notifyChange("suspended");this._updateLoading();this._pageMultiplier=null!=S.nodesPerPage?1:S.nodePerIndexBlock;return this._loadNodePage(0).promise.then(Z=>{this._index.addPage(0,Z,this._elevationOffset);
this._loadingInitNodePage=!1;this._setUpdateViewNeeded()})}_loadNodePage(S){const Z=new AbortController;return{promise:this._requestNodePage(`${this.baseUrl}/nodepages/${S*this._pageMultiplier}`,Z.signal).then(ia=>ia.nodes.map((Y,ea)=>({resourceId:null!=Y.resourceId?Y.resourceId:S*this._index.pageSize+ea,obb:W.Obb.fromJSON(Y.obb),obbInRenderSR:new W.Obb,firstChild:Y.firstChild,childCount:Y.childCount,vertexCount:Y.vertexCount??Y.pointCount,lodThreshold:Y.lodThreshold??Y.effectiveArea}))),abortController:Z}}_updateWorkQueues(){if(!this._updateViewNeeded)return!1;
var S=this.view.quality;let Z=this.inverseDensity/this._lodFactor*S;S*=this.maximumPointCount*this._lodFactor;let ia=this._computeNodesForMinimumDensity(Z),Y=this._computePointCount(ia),ea=Math.sqrt(Y/(.75*S));for(;Y>S;)Z*=ea,ia=this._computeNodesForMinimumDensity(Z),Y=this._computePointCount(ia),ea=Math.sqrt(2);this._displayNodes(ia);this._updateViewNeeded=!1;this._updateLoading();return!0}_computePointCount(S){let Z=0;for(let ia=0;ia<S.length;ia++){const Y=this._index.getNode(S[ia]);Y&&(Z+=Y.vertexCount)}return Z}_isRootNodeVisible(){let S=
!1;this._traverseVisible({frustum:this.view.state.contentCamera.frustum,clippingBox:this._clippingBox},{predicate:(Z,ia,Y)=>{S=Y;return!1},pageMiss:()=>{}});return S}_computeNodesForMinimumDensity(S){const Z=this.view.state.contentCamera,ia=Z.frustum,Y=this._clippingBox,ea=Z.viewForward,ka=x.dot(ea,Z.eye),ja=m.fromNormalAndOffset(ea,-ka,T),X=Z.perScreenPixelRatio/2,aa=S*S,pa=this._nodeIdArray;pa.length=0;this._traverseVisible({frustum:ia,clippingBox:Y},{predicate:(la,na,qa)=>{if(!qa)return!1;if(0===
na.childCount)return pa.push(la),!1;qa=this._index.getRenderObb(la);return this._computeAveragePixelArea(qa,na.lodThreshold,na.vertexCount,ja,X)<=aa?(pa.push(la),!1):!0},pageMiss:(la,na)=>{pa.push(la);this._indexQueue.includes(na)||this._indexQueue.push(na)}});return pa}_computeAveragePixelArea(S,Z,ia,Y,ea){S=Math.max(1E-7,S.minimumDistancePlane(Y));return Z/(S*S)/(4*ea*ea)/ia}_loadNode(S,Z){try{return this._loadNodeAsync(S,Z)}catch(ia){throw g.isAbortError(ia)||h.getLogger(this).error(ia),ia;}}async _loadAdditionalUserAttributes(S,
Z,ia){var Y=this.layer.outFields;if(!Y)return[];Y=z.unpackFieldNames(this.layer.fieldsIndex,Y);S=new Set(S.map(ja=>null!=ja?ja.name:null));const ea=this.layer.attributeStorageInfo,ka=[];for(const ja of Y)S.has(ja)||(Y=J.getAttributeInfo(ea,ja))&&ka.push(Z(Y));Z=await g.allSettledValues(ka);g.throwIfAborted(ia);return Z.filter(b.isSome)}async _loadNodeAsync(S,Z){const ia=this._index.getNode(S),Y=J.getRendererInfo(this.layer),ea=J.getFilterInfo(this.layer),ka=ia.resourceId,ja=async X=>{if(!X)return null;
if(X.useElevation)return{attributeInfo:X,buffer:null};const aa=await this._loadAttribute(ka,X,Z);return null!=aa?{attributeInfo:X,buffer:aa}:null};return this._idleQueue.push(async()=>{var X=this._loadGeometry(ka,Z);const {primaryAttribute:aa,modulationAttribute:pa}=Y,la=ja(aa),na=ja(pa);var qa=ea.map(Ha=>Ha.attributeInfo);const sa=qa.map(Ha=>ja(Ha));qa=this._loadAdditionalUserAttributes([aa,pa,...qa],ja,Z);const [xa,ta,Ba,Ia,Ca]=await Promise.all([X,la,na,Promise.all(sa),qa]);g.throwIfAborted(Z);
X={geometryBuffer:xa,primaryAttributeData:ta,modulationAttributeData:Ba,filterAttributesData:Ia,userAttributesData:Ca,schema:this.layer.store.defaultGeometrySchema,rendererInfo:Y,filterInfo:ea,obbData:this._index.getRenderObb(S).data,elevationOffset:this._elevationOffset,inSR:this.layer.spatialReference.toJSON(),outSR:this.view.renderCoordsHelper.spatialReference.toJSON()};return this._worker.invoke(X,Z)},Z)}async _loadGeometry(S,Z){return this._requestData(`${this.baseUrl}/nodes/${S}/geometries/0`,
Z)}async _loadAttribute(S,Z,ia){return Z?.storageInfo?this._requestData(`${this.baseUrl}/nodes/${S}/attributes/${Z.storageInfo.key}`,ia):null}_requestNodePage(S,Z){return this._indexRequester.request(S,"json",{query:{f:"json",...this.layer.customParameters,token:this.layer.apiKey},signal:Z})}_requestData(S,Z){return this._dataRequester.request(S,"binary",{query:{...this.layer.customParameters,token:this.layer.apiKey},signal:Z})}_removeFromRenderer(S){if(this._renderedNodes.has(S)){const Z=this._renderer.removeNode(S);
this._renderedNodes.delete(S);this._memCache.put(Z.id.toString(),Z,5*Z.coordinates.length+128)}}_addToRenderer(S){this._renderedNodes.has(S.id)||(this._renderedNodes.add(S.id),this._renderer.addNode(S))}_setupRendererData(S,Z){const ia=this._index.getNode(S),Y=Math.sqrt(ia.lodThreshold/ia.vertexCount),ea=this._index.getRenderObb(S);if(Q.isPointRendererNode(Z))return Z.splatSize=Y,Z.obb=ea,x.copy(Z.origin,Z.obb.center),Z;const ka=W.Obb.fromData(Z.obbData),ja=ka.halfSize,X=ea.halfSize,aa=.01*Math.max(X[0],
X[1],X[2]);if(ja[0]>X[0]+aa||ja[1]>X[1]+aa||ja[2]>X[2]+aa)0<this._maxLoggedBoxWarnings&&(h.getLogger(this).warn(`Node ${S} reported bounding box too small. got ${`[${ea.halfSize[0]}, ${ea.halfSize[1]}, ${ea.halfSize[2]}]`} but points cover ${`[${ka.halfSize[0]}, ${ka.halfSize[1]}, ${ka.halfSize[2]}]`}`),0===--this._maxLoggedBoxWarnings&&h.getLogger(this).warn("  Too many bounding box errors, stopping reporting for this layer.")),this._index.setRenderObb(S,ka);return new Q.PointRendererNode(S,Y,u.clone(ea.center),
ea,0===ia.childCount,Z.points,Z.rgb,Z.attributes,Z.pointIdFilterMap)}get usedMemory(){let S=0;this._renderer.forEachNode(Z=>{S+=160;S+=c.estimateSize(Z.coordinates);for(const ia of Z.attributes)Z=ia.values,c.isArrayBuffer(Z.buffer)&&(S+=c.estimateSize(Z))});return S}get unloadedMemory(){const S=this._renderedNodes.size;if(4>S)return 0;const Z=[...this._renderedNodes].reduce((Y,ea)=>Y+this._index.getNode(ea).vertexCount);let ia=this._loadingNodes.size;for(let Y=0;Y<this._workQueue.length;Y++)ia+=this._workQueue[Y].load.length,
ia-=this._workQueue[Y].remove.length;return 0>ia?0:ia*Z/S*((this.usedMemory-160*S)/Z)+160*ia}get performanceInfo(){return new E.PointCloudLayerViewPerformanceInfo(this.usedMemory,this._renderedNodes.size,[...this._renderedNodes].reduce((S,Z)=>S+this._index.getNode(Z).vertexCount,0),this.maximumPointCount,new E.QueuePerformanceInfo(this._loadingNodes.size,this._indexQueue.length,this._workQueue.length,this._idleQueue.length))}get test(){}};a.__decorate([l.property()],p.prototype,"layer",void 0);a.__decorate([l.property()],
p.prototype,"baseUrl",null);a.__decorate([l.property()],p.prototype,"pointScale",null);a.__decorate([l.property()],p.prototype,"useRealWorldSymbolSizes",null);a.__decorate([l.property()],p.prototype,"pointSize",null);a.__decorate([l.property()],p.prototype,"inverseDensity",null);a.__decorate([l.property()],p.prototype,"maximumPointCount",void 0);a.__decorate([l.property({readOnly:!0})],p.prototype,"availableFields",null);a.__decorate([l.property({readOnly:!0})],p.prototype,"_clippingBox",null);a.__decorate([l.property({readOnly:!0})],
p.prototype,"_elevationOffset",null);a.__decorate([l.property({type:Boolean})],p.prototype,"slicePlaneEnabled",void 0);a.__decorate([l.property()],p.prototype,"updating",void 0);a.__decorate([l.property(V.updatingProgress)],p.prototype,"updatingProgress",void 0);a.__decorate([l.property({readOnly:!0})],p.prototype,"updatingProgressValue",null);a.__decorate([l.property({readOnly:!0})],p.prototype,"visibleAtCurrentScale",null);return p=a.__decorate([w.subclass("esri.views.3d.layers.PointCloudLayerView3D")],
p)})},"esri/views/3d/layers/PointCloudLayerViewPerformanceInfo":function(){define(["exports","./support/LayerViewPerformanceInfo"],function(a,b){class n extends b.LayerViewPerformanceInfo{constructor(p,h,e,g,d){super(p,h,-1,e,g);this.queue=d}}class k{constructor(p,h,e,g){this.loading=p;this.indexLoading=h;this.processing=e;this.idleProcessing=g}}a.PointCloudLayerViewPerformanceInfo=n;a.QueuePerformanceInfo=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/PointCloudWorkerHandle":function(){define(["exports",
"../../../core/workers/WorkerHandle"],function(a,b){class n extends b.WorkerHandle{constructor(k){super("PointCloudWorker","transform",{transform:p=>{const h=[p.geometryBuffer];null!=p.primaryAttributeData&&p.primaryAttributeData.buffer&&h.push(p.primaryAttributeData.buffer);null!=p.modulationAttributeData&&p.modulationAttributeData.buffer&&h.push(p.modulationAttributeData.buffer);if(null!=p.filterAttributesData)for(const e of p.filterAttributesData)null!=e&&e.buffer&&h.push(e.buffer);for(const e of p.userAttributesData)e.buffer&&
h.push(e.buffer);return h}},k)}}a.PointCloudWorkerHandle=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/LoDUtil":function(){define(["exports","../../../../chunks/vec32"],function(a,b){function n(d,f,c){for(;0<d;){const l=f.indexOf(d);if(0<=l)return l;d=c.getParentId(d)}return f.indexOf(d)}function k(d,f,c){const l=[f.remove[0]],w=[];for(;1===l.length;){const u=l.pop();w.length=0;for(let t=0;t<f.load.length;t++){let m=f.load[t];for(var x=c.getParentId(m);x!==
u;)m=x,x=c.getParentId(m);x=l.indexOf(m);0>x&&(x=l.length,l.push(m),w.push([]));w[x].push(f.load[t])}}f.load=l;for(f=0;f<l.length;f++)1<w[f].length?d.push({remove:[l[f]],load:w[f]}):l[f]=w[f][0]}const p=[!1],h=[null],e=[!1],g=[null];a.nodeDiff=function(d,f,c){for(var l=0;l<f.length;l++)e[l]=!1,g[l]=null;for(l=0;l<d.length;l++)p[l]=!1,h[l]=null;for(l=0;l<f.length;l++){var w=n(f[l],d,c);0<=w&&(e[l]=!0,null!=h[w]?h[w].push(f[l]):h[w]=[f[l]])}for(l=0;l<d.length;l++)w=n(d[l],f,c),0<=w&&(p[l]=!0,null!=
g[w]?g[w].push(d[l]):g[w]=[d[l]]);c=[];for(l=0;l<d.length;l++)null!=h[l]||p[l]||c.push({load:[],remove:[d[l]]});for(l=0;l<f.length;l++)null!=g[l]||e[l]||c.push({load:[f[l]],remove:[]});for(l=0;l<f.length;l++)null!=g[l]&&(1<g[l].length||g[l][0]!==f[l])&&c.push({load:[f[l]],remove:g[l]});for(f=0;f<d.length;f++)null!=h[f]&&(1<h[f].length||h[f][0]!==d[f])&&c.push({load:h[f],remove:[d[f]]});return c};a.sortFrontToBack=function(d,f,c){return d.sort((l,w)=>{if(0===l.load.length&&0===w.load.length)return 0;
if(0===l.load.length)return-1;if(0===w.load.length)return 1;if(0===l.remove.length&&0===w.remove.length)return l=c.getRenderObb(l.load[0]).center,w=c.getRenderObb(w.load[0]).center,b.dot(l,f)-b.dot(w,f);if(0===l.remove.length)return-1;if(0===w.remove.length)return 1;if(1===l.load.length&&1===w.load.length)return l=c.getRenderObb(l.load[0]).center,w=c.getRenderObb(w.load[0]).center,b.dot(l,f)-b.dot(w,f);if(1===l.load.length)return-1;if(1===w.load.length)return 1;l=c.getRenderObb(l.remove[0]).center;
w=c.getRenderObb(w.remove[0]).center;return b.dot(l,f)-b.dot(w,f)})};a.splitWorkEntries=function(d,f,c){for(let l=0;l<d.length;++l){const w=d[l];w.load.length>f&&1===w.remove.length&&k(d,w,c)}};a.splitWorkEntry=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/PagedNodeIndex":function(){define(["exports","../../../../geometry/spatialReferenceEllipsoidUtils","../../../../geometry/support/aaBoundingBox"],function(a,b,n){class k{constructor(p,h,e){this._pages=
[];this.pageSize=0;this._nodeSR=p;this._renderSR=h;this._renderSRSphericalPCPF=b.getSphericalPCPF(h);this.pageSize=e}addPage(p,h,e=0){for(;this._pages.length<p;)this._pages.push(null);var g=this._nodeSR,d=this._renderSR,f=this._renderSRSphericalPCPF;for(var c=0;c<h.length;c++){const l=h[c];l.obb.transform(l.obbInRenderSR,g,d,e,f)}this._pages[p]={nodes:h,parents:new Uint32Array(this.pageSize)};p=this._pages;h=this.pageSize;for(e=[0];e.length;)for(g=e.pop(),d=p[g/h|0].nodes[g%h],f=0;f<d.childCount;f++)c=
d.firstChild+f,null!=p[c/h|0]&&(p[c/h|0].parents[c%h]=g,e.push(c))}hasPage(p){return!!this._pages[p]}getNode(p){const h=this.pageSize;return this._pages[p/h|0].nodes[p%h]}getRenderObb(p){const h=this.pageSize;return this._pages[p/h|0].nodes[p%h].obbInRenderSR}setRenderObb(p,h){const e=this.pageSize;this._pages[p/e|0].nodes[p%e].obbInRenderSR.copy(h)}getParentId(p){const h=this.pageSize;return this._pages[p/h|0].parents[p%h]}hasNodes(p,h){var e=p/this.pageSize|0;for(p=(p+h-1)/this.pageSize|0;e<=p;e++)if(null==
this._pages[e])return!1;return!0}forEachNodeId(p){for(let h=0;h<this._pages.length;h++){const e=this._pages[h];if(e)for(let g=0;g<e.nodes.length;g++)p(h*this.pageSize+g)}}createVisibilityTraverse(){var p=this,h=[],e=[],g=n.create();return(d,f)=>{if(p.hasNodes(0,1))for(h.length=0,h.push(0),e.length=0,e.push(0);0<h.length;){var c=h.pop();let m=e.pop();var l=p.getNode(c),w=p.getRenderObb(c),x=!0;if(null!=d.clippingBox){var u=1<<d.frustum.length;0===(m&u)&&(w.toAaBoundingBox(g),n.contains(d.clippingBox,
g)?m|=u:n.intersects(d.clippingBox,g)||(x=!1))}for(u=0;u<d.frustum.length&&x;u++){var t=1<<u;if(0===(m&t)){const q=w.intersectPlane(d.frustum[u]);0<q?x=!1:0>q&&(m|=t)}}if(f.predicate(c,l,x)){w=l.firstChild;l=l.childCount;x=!1;t=w/p.pageSize|0;for(u=(w+l-1)/p.pageSize|0;t<=u;t++)if(!p.hasPage(t)){f.pageMiss(c,t);x=!0;break}if(!x)for(c=0;c<l;c++)h.push(w+c),e.push(m)}}}}}a.PagedNodeIndex=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/PointCloudRendererUtil":function(){define(["exports"],
function(a){function b(k,p){for(const h of k??[])if(h.name===p&&null!=h.attributeValues&&"UInt8"===h.attributeValues.valueType&&3===h.attributeValues.valuesPerElement)return{name:p,storageInfo:h,useElevation:!1};return null}function n(k,p){for(const h of k??[])if(h.name===p)return(k="embedded-elevation"===h.encoding)?{name:p,storageInfo:null,useElevation:k}:{name:p,storageInfo:h,useElevation:k};return"elevation"===p?.toLowerCase()?{name:p,storageInfo:null,useElevation:!0}:null}a.getAttributeInfo=
n;a.getFilterInfo=function(k){const p=k.filters;return p?p.map(h=>({filterJSON:h.toJSON(),attributeInfo:n(k.attributeStorageInfo,h.field)})):[]};a.getFixedSizeAlgorithm=function(k){return(k=k?.pointSizeAlgorithm)&&"fixed-size"===k.type?k:null};a.getRendererInfo=function(k){const p=k.renderer;var h=p?.type;const e=p?.toJSON()??null;let g=null,d=!1;k=k.attributeStorageInfo;"point-cloud-unique-value"===h?g=n(k,p.field):"point-cloud-stretch"===h?g=n(k,p.field):"point-cloud-class-breaks"===h?g=n(k,p.field):
(g="point-cloud-rgb"===h?b(k,p.field):b(k,"RGB"),d=null!=g);h=null;p?.colorModulation&&(h=n(k,p.colorModulation.field));return{rendererJSON:e,isRGBRenderer:d,primaryAttribute:g,modulationAttribute:h}};a.getSplatSizeAlgorithm=function(k){return(k=k?.pointSizeAlgorithm)&&"splat"===k.type?k:null};a.rendererUsesFixedSizes=function(k){k=k?.pointSizeAlgorithm;return k?.type?"fixed-size"===k.type:!1};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/PointCloudWorkerUtil":function(){define("exports ../../../../core/has ../../../../renderers/PointCloudClassBreaksRenderer ../../../../renderers/PointCloudStretchRenderer ../../../../renderers/PointCloudUniqueValueRenderer ./I3SBinaryReader ./LEPCC".split(" "),
function(a,b,n,k,p,h,e){function g(c,l){const w=new Float64Array(l);for(let x=0;x<l;x++)w[x]=c[3*x+2];return w}function d(c){switch(c){default:case null:case "none":return l=>l;case "low-four-bit":return l=>l&15;case "high-four-bit":return l=>(l&240)>>4;case "absolute-value":return l=>Math.abs(l);case "modulo-ten":return l=>l%10}}function f(c){let l=0;for(const w of c||[])l|=1<<w;return l}a.elevationFromPositions=g;a.evaluateRenderer=function(c,l,w,x){const {rendererJSON:u,isRGBRenderer:t}=c;var m=
c=null;if(l&&t)c=l;else if(l&&"pointCloudUniqueValueRenderer"===u?.type){m=p.fromJSON(u);var q=m.colorUniqueValueInfos;c=new Uint8Array(3*x);var r=d(m.fieldTransformType);for(var v=0;v<x;v++){var y=(r?r(l[v]):l[v])+"";for(var B=0;B<q.length;B++)if(q[B].values.includes(y)){c[3*v]=q[B].color.r;c[3*v+1]=q[B].color.g;c[3*v+2]=q[B].color.b;break}}}else if(l&&"pointCloudStretchRenderer"===u?.type)for(m=k.fromJSON(u),q=m.stops,c=new Uint8Array(3*x),r=d(m.fieldTransformType),v=0;v<x;v++)if(y=r?r(l[v]):l[v],
B=q.length-1,y<q[0].value)c[3*v]=q[0].color.r,c[3*v+1]=q[0].color.g,c[3*v+2]=q[0].color.b;else if(y>=q[B].value)c[3*v]=q[B].color.r,c[3*v+1]=q[B].color.g,c[3*v+2]=q[B].color.b;else for(B=1;B<q.length;B++){if(y<q[B].value){y=(y-q[B-1].value)/(q[B].value-q[B-1].value);c[3*v]=q[B].color.r*y+q[B-1].color.r*(1-y);c[3*v+1]=q[B].color.g*y+q[B-1].color.g*(1-y);c[3*v+2]=q[B].color.b*y+q[B-1].color.b*(1-y);break}}else if(l&&"pointCloudClassBreaksRenderer"===u?.type)for(m=n.fromJSON(u),q=m.colorClassBreakInfos,
c=new Uint8Array(3*x),r=d(m.fieldTransformType),v=0;v<x;v++)for(y=r?r(l[v]):l[v],B=0;B<q.length;B++){if(y>=q[B].minValue&&y<=q[B].maxValue){c[3*v]=q[B].color.r;c[3*v+1]=q[B].color.g;c[3*v+2]=q[B].color.b;break}}else c=(new Uint8Array(3*x)).fill(255);if(w&&m?.colorModulation)for(l=m.colorModulation.minValue,m=m.colorModulation.maxValue,q=0;q<x;q++)r=w[q],r=r>=m?1:r<=l?.3:.3+.7*(r-l)/(m-l),c[3*q]*=r,c[3*q+1]*=r,c[3*q+2]*=r;return c};a.filterInPlace=function(c,l,w,x,u){const t=c.length/3;let m=0;for(let z=
0;z<t;z++){let A=!0;for(let C=0;C<x.length&&A;C++){var {filterJSON:q}=x[C],r=u[C].values[z];switch(q.type){case "pointCloudValueFilter":var v="exclude"===q.mode;q.values.includes(r)===v&&(A=!1);break;case "pointCloudBitfieldFilter":v=f(q.requiredSetBits);q=f(q.requiredClearBits);if((r&v)!==v||0!==(r&q))A=!1;break;case "pointCloudReturnFilter":var y=r&15,B=r>>>4&15;r=1<B;v=1===y;y=y===B;B=!1;for(const H of q.includedReturns)if("last"===H&&y||"firstOfMany"===H&&v&&r||"lastOfMany"===H&&y&&r||"single"===
H&&!r){B=!0;break}B||(A=!1)}}A&&(w[m]=z,c[3*m]=c[3*z],c[3*m+1]=c[3*z+1],c[3*m+2]=c[3*z+2],l[3*m]=l[3*z],l[3*m+1]=l[3*z+1],l[3*m+2]=l[3*z+2],m++)}return m};a.getAttributeValues=function(c,l,w){return c?.attributeInfo.useElevation?l?g(l,w):null:c?.attributeInfo.storageInfo?h.readBinaryAttribute(c.attributeInfo.storageInfo,c.buffer,w):null};a.readGeometry=function(c,l){if(null==c.encoding||""===c.encoding){c=h.createGeometryIndexFromSchema(l,c);if(null==c.vertexAttributes.position)return;l=h.createTypedView(l,
c.vertexAttributes.position);var w=c.header.fields;c=[w.offsetX,w.offsetY,w.offsetZ];w=[w.scaleX,w.scaleY,w.scaleZ];const x=l.length/3,u=new Float64Array(3*x);for(let t=0;t<x;t++)u[3*t]=l[3*t]*w[0]+c[0],u[3*t+1]=l[3*t+1]*w[1]+c[1],u[3*t+2]=l[3*t+2]*w[2]+c[2];return u}if("lepcc-xyz"===c.encoding)return e.decodeXYZ(l).result};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/renderers/PointCloudClassBreaksRenderer":function(){define("../chunks/tslib.es6 ../core/lang ../core/accessorSupport/decorators/property ../core/has ../core/Logger ../core/accessorSupport/decorators/enumeration ../core/accessorSupport/decorators/subclass ./PointCloudRenderer ./support/RendererLegendOptions ./support/pointCloud/ColorClassBreakInfo".split(" "),
function(a,b,n,k,p,h,e,g,d,f){var c;k=c=class extends g{constructor(l){super(l);this.type="point-cloud-class-breaks";this.colorClassBreakInfos=this.fieldTransformType=this.legendOptions=this.field=null}clone(){return new c({...this.cloneProperties(),field:this.field,fieldTransformType:this.fieldTransformType,colorClassBreakInfos:b.clone(this.colorClassBreakInfos),legendOptions:b.clone(this.legendOptions)})}};a.__decorate([h.enumeration({pointCloudClassBreaksRenderer:"point-cloud-class-breaks"})],
k.prototype,"type",void 0);a.__decorate([n.property({json:{write:!0},type:String})],k.prototype,"field",void 0);a.__decorate([n.property({type:d,json:{write:!0}})],k.prototype,"legendOptions",void 0);a.__decorate([n.property({type:g.fieldTransformTypeKebabDict.apiValues,json:{type:g.fieldTransformTypeKebabDict.jsonValues,read:g.fieldTransformTypeKebabDict.read,write:g.fieldTransformTypeKebabDict.write}})],k.prototype,"fieldTransformType",void 0);a.__decorate([n.property({type:[f],json:{write:!0}})],
k.prototype,"colorClassBreakInfos",void 0);return k=c=a.__decorate([e.subclass("esri.renderers.PointCloudClassBreaksRenderer")],k)})},"esri/renderers/PointCloudRenderer":function(){define("../chunks/tslib.es6 ../core/jsonMap ../core/JSONSupport ../core/lang ../core/accessorSupport/decorators/property ../core/has ../core/Logger ../core/accessorSupport/decorators/subclass ./support/pointCloud/ColorModulation ./support/pointCloud/pointSizeAlgorithmTypeUtils".split(" "),function(a,b,n,k,p,h,e,g,d,f){h=
b.strict()({pointCloudClassBreaksRenderer:"point-cloud-class-breaks",pointCloudRGBRenderer:"point-cloud-rgb",pointCloudStretchRenderer:"point-cloud-stretch",pointCloudUniqueValueRenderer:"point-cloud-unique-value"});n=class extends n.JSONSupport{constructor(c){super(c);this.type=void 0;this.colorModulation=this.pointSizeAlgorithm=null;this.pointsPerInch=10}clone(){console.warn(".clone() is not implemented for "+this.declaredClass);return null}cloneProperties(){return{pointSizeAlgorithm:k.clone(this.pointSizeAlgorithm),
colorModulation:k.clone(this.colorModulation),pointsPerInch:k.clone(this.pointsPerInch)}}};a.__decorate([p.property({type:h.apiValues,readOnly:!0,nonNullable:!0,json:{type:h.jsonValues,read:!1,write:h.write}})],n.prototype,"type",void 0);a.__decorate([p.property({types:f.pointSizeAlgorithmTypes,json:{write:!0}})],n.prototype,"pointSizeAlgorithm",void 0);a.__decorate([p.property({type:d,json:{write:!0}})],n.prototype,"colorModulation",void 0);a.__decorate([p.property({json:{write:!0},nonNullable:!0,
type:Number})],n.prototype,"pointsPerInch",void 0);n=a.__decorate([g.subclass("esri.renderers.PointCloudRenderer")],n);(n||={}).fieldTransformTypeKebabDict=new b.JSONMap({none:"none",lowFourBit:"low-four-bit",highFourBit:"high-four-bit",absoluteValue:"absolute-value",moduloTen:"modulo-ten"});return n})},"esri/renderers/support/pointCloud/ColorModulation":function(){define("../../../chunks/tslib.es6 ../../../core/JSONSupport ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,n,k,p,h,e){var g;b=g=class extends b.JSONSupport{constructor(){super(...arguments);this.field=null;this.minValue=0;this.maxValue=255}clone(){return new g({field:this.field,minValue:this.minValue,maxValue:this.maxValue})}};a.__decorate([n.property({type:String,json:{write:!0}})],b.prototype,"field",void 0);a.__decorate([n.property({type:Number,nonNullable:!0,json:{write:!0}})],b.prototype,"minValue",void 0);a.__decorate([n.property({type:Number,nonNullable:!0,json:{write:!0}})],b.prototype,
"maxValue",void 0);return b=g=a.__decorate([e.subclass("esri.renderers.support.pointCloud.ColorModulation")],b)})},"esri/renderers/support/pointCloud/pointSizeAlgorithmTypeUtils":function(){define(["exports","./PointSizeAlgorithm","./PointSizeFixedSizeAlgorithm","./PointSizeSplatAlgorithm"],function(a,b,n,k){a.pointSizeAlgorithmTypes={key:"type",base:b,typeMap:{"fixed-size":n,splat:k}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/renderers/support/pointCloud/PointSizeAlgorithm":function(){define("../../../chunks/tslib.es6 ../../../core/jsonMap ../../../core/JSONSupport ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,n,k,p,h,e,g){b=new b.JSONMap({pointCloudFixedSizeAlgorithm:"fixed-size",pointCloudSplatAlgorithm:"splat"});n=class extends n.JSONSupport{};a.__decorate([k.property({type:b.apiValues,readOnly:!0,nonNullable:!0,json:{type:b.jsonValues,read:!1,write:b.write}})],n.prototype,"type",void 0);return n=a.__decorate([g.subclass("esri.renderers.support.pointCloud.PointSizeAlgorithm")],n)})},"esri/renderers/support/pointCloud/PointSizeFixedSizeAlgorithm":function(){define("../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/enumeration ../../../core/accessorSupport/decorators/subclass ./PointSizeAlgorithm".split(" "),
function(a,b,n,k,p,h,e,g){var d;n=d=class extends g{constructor(){super(...arguments);this.type="fixed-size";this.size=0;this.useRealWorldSymbolSizes=null}clone(){return new d({size:this.size,useRealWorldSymbolSizes:this.useRealWorldSymbolSizes})}};a.__decorate([h.enumeration({pointCloudFixedSizeAlgorithm:"fixed-size"})],n.prototype,"type",void 0);a.__decorate([b.property({type:Number,nonNullable:!0,json:{write:!0}})],n.prototype,"size",void 0);a.__decorate([b.property({type:Boolean,json:{write:!0}})],
n.prototype,"useRealWorldSymbolSizes",void 0);return n=d=a.__decorate([e.subclass("esri.renderers.support.pointCloud.PointSizeFixedSizeAlgorithm")],n)})},"esri/renderers/support/pointCloud/PointSizeSplatAlgorithm":function(){define("../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/enumeration ../../../core/accessorSupport/decorators/subclass ./PointSizeAlgorithm".split(" "),
function(a,b,n,k,p,h,e,g){var d;n=d=class extends g{constructor(){super(...arguments);this.type="splat";this.scaleFactor=1}clone(){return new d({scaleFactor:this.scaleFactor})}};a.__decorate([h.enumeration({pointCloudSplatAlgorithm:"splat"})],n.prototype,"type",void 0);a.__decorate([b.property({type:Number,value:1,nonNullable:!0,json:{write:!0}})],n.prototype,"scaleFactor",void 0);return n=d=a.__decorate([e.subclass("esri.renderers.support.pointCloud.PointSizeSplatAlgorithm")],n)})},"esri/renderers/support/pointCloud/ColorClassBreakInfo":function(){define("../../../chunks/tslib.es6 ../../../Color ../../../core/JSONSupport ../../../core/lang ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,n,k,p,h,e){var g;n=g=class extends n.JSONSupport{constructor(){super(...arguments);this.label=this.description=null;this.maxValue=this.minValue=0;this.color=null}clone(){return new g({description:this.description,label:this.label,minValue:this.minValue,maxValue:this.maxValue,color:k.clone(this.color)})}};a.__decorate([p.property({type:String,json:{write:!0}})],n.prototype,"description",void 0);a.__decorate([p.property({type:String,json:{write:!0}})],n.prototype,"label",void 0);a.__decorate([p.property({type:Number,
json:{read:{source:"classMinValue"},write:{target:"classMinValue"}}})],n.prototype,"minValue",void 0);a.__decorate([p.property({type:Number,json:{read:{source:"classMaxValue"},write:{target:"classMaxValue"}}})],n.prototype,"maxValue",void 0);a.__decorate([p.property({type:b,json:{type:[h.Integer],write:!0}})],n.prototype,"color",void 0);return n=g=a.__decorate([e.subclass("esri.renderers.support.pointCloud.ColorClassBreakInfo")],n)})},"esri/renderers/PointCloudStretchRenderer":function(){define("../chunks/tslib.es6 ../core/lang ../core/accessorSupport/decorators/property ../core/has ../core/Logger ../core/accessorSupport/decorators/enumeration ../core/accessorSupport/decorators/subclass ./PointCloudRenderer ./support/RendererLegendOptions ./visualVariables/support/ColorStop".split(" "),
function(a,b,n,k,p,h,e,g,d,f){var c;k=c=class extends g{constructor(l){super(l);this.type="point-cloud-stretch";this.stops=this.fieldTransformType=this.legendOptions=this.field=null}clone(){return new c({...this.cloneProperties(),field:b.clone(this.field),fieldTransformType:b.clone(this.fieldTransformType),stops:b.clone(this.stops),legendOptions:b.clone(this.legendOptions)})}};a.__decorate([h.enumeration({pointCloudStretchRenderer:"point-cloud-stretch"})],k.prototype,"type",void 0);a.__decorate([n.property({json:{write:!0},
type:String})],k.prototype,"field",void 0);a.__decorate([n.property({type:d,json:{write:!0}})],k.prototype,"legendOptions",void 0);a.__decorate([n.property({type:g.fieldTransformTypeKebabDict.apiValues,json:{type:g.fieldTransformTypeKebabDict.jsonValues,read:g.fieldTransformTypeKebabDict.read,write:g.fieldTransformTypeKebabDict.write}})],k.prototype,"fieldTransformType",void 0);a.__decorate([n.property({type:[f],json:{write:!0}})],k.prototype,"stops",void 0);return k=c=a.__decorate([e.subclass("esri.renderers.PointCloudStretchRenderer")],
k)})},"esri/renderers/PointCloudUniqueValueRenderer":function(){define("../chunks/tslib.es6 ../core/lang ../core/accessorSupport/decorators/property ../core/has ../core/Logger ../core/accessorSupport/decorators/enumeration ../core/accessorSupport/decorators/subclass ./PointCloudRenderer ./support/RendererLegendOptions ./support/pointCloud/ColorUniqueValueInfo".split(" "),function(a,b,n,k,p,h,e,g,d,f){var c;k=c=class extends g{constructor(l){super(l);this.type="point-cloud-unique-value";this.legendOptions=
this.colorUniqueValueInfos=this.fieldTransformType=this.field=null}clone(){return new c({...this.cloneProperties(),field:b.clone(this.field),fieldTransformType:b.clone(this.fieldTransformType),colorUniqueValueInfos:b.clone(this.colorUniqueValueInfos),legendOptions:b.clone(this.legendOptions)})}};a.__decorate([h.enumeration({pointCloudUniqueValueRenderer:"point-cloud-unique-value"})],k.prototype,"type",void 0);a.__decorate([n.property({json:{write:!0},type:String})],k.prototype,"field",void 0);a.__decorate([n.property({type:g.fieldTransformTypeKebabDict.apiValues,
json:{type:g.fieldTransformTypeKebabDict.jsonValues,read:g.fieldTransformTypeKebabDict.read,write:g.fieldTransformTypeKebabDict.write}})],k.prototype,"fieldTransformType",void 0);a.__decorate([n.property({type:[f],json:{write:!0}})],k.prototype,"colorUniqueValueInfos",void 0);a.__decorate([n.property({type:d,json:{write:!0}})],k.prototype,"legendOptions",void 0);return k=c=a.__decorate([e.subclass("esri.renderers.PointCloudUniqueValueRenderer")],k)})},"esri/renderers/support/pointCloud/ColorUniqueValueInfo":function(){define("../../../chunks/tslib.es6 ../../../Color ../../../core/JSONSupport ../../../core/lang ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,n,k,p,h,e){var g;n=g=class extends n.JSONSupport{constructor(){super(...arguments);this.color=this.values=this.label=this.description=null}clone(){return new g({description:this.description,label:this.label,values:k.clone(this.values),color:k.clone(this.color)})}};a.__decorate([p.property({type:String,json:{write:!0}})],n.prototype,"description",void 0);a.__decorate([p.property({type:String,json:{write:!0}})],n.prototype,"label",void 0);a.__decorate([p.property({type:[String],json:{write:!0}})],
n.prototype,"values",void 0);a.__decorate([p.property({type:b,json:{type:[h.Integer],write:!0}})],n.prototype,"color",void 0);return n=g=a.__decorate([e.subclass("esri.renderers.support.pointCloud.ColorUniqueValueInfo")],n)})},"esri/views/3d/layers/i3s/PointGraphic":function(){define("exports ../../../../chunks/tslib.es6 ../../../../Graphic ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/Logger ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,n,k,p,h,e,g){a.PointGraphic=class extends n{constructor(d){super(d);this.pointCloudMetadata=null}};b.__decorate([k.property({constructOnly:!0,clonable:"reference"})],a.PointGraphic.prototype,"pointCloudMetadata",void 0);a.PointGraphic=b.__decorate([g.subclass("esri.views.3d.layers.i3s.PointGraphic")],a.PointGraphic);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/PointRenderer":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/maybe ../../../../core/PooledArray ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/Logger ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../chunks/vec42 ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/plane ../../../../geometry/support/ray ./Intersector ./PointHighlights ../../webgl-engine/core/shaderLibrary/ShaderOutput ../../webgl-engine/effects/RenderPlugin ../../webgl-engine/lib/DefaultVertexAttributeLocations ../../webgl-engine/lib/Intersector ../../webgl-engine/lib/IntersectorInterfaces ../../webgl-engine/lib/RenderSlot ../../webgl-engine/lib/VertexArrayObject ../../webgl-engine/lib/VertexAttribute ../../../../chunks/PointRenderer.glsl ../../webgl-engine/shaders/PointRendererTechnique ../../webgl-engine/shaders/PointRendererTechniqueConfiguration ../../../webgl/BufferObject ../../../webgl/enums ../../../webgl/VertexElementDescriptor".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w,x,u,t,m,q,r,v,y,B,z,A,C,H,E,F,G,D,I){function J(R,W,V,ba,U){if(V.drawScreenSpace)return V.fixedSize*W*ba;U=H.getMaxPointSizeScreenspace(U)*W*ba;return V.useFixedSizes?Math.min(V.fixedSize/2,U):0<V.screenMinSize?Math.min(Math.max(V.screenMinSize*W*ba,R/2),U):Math.min(R/2,U)}function N(R,W,V,ba,U){return V.drawScreenSpace?0:J(R,W,V,ba,U)}function M(R){return null!=R.componentIndex?R.componentIndex:-1}function Q(R){return null!=R.dist&&null!=R.point&&null!=R.pointId&&
null!=R.node}const O=new Map([["positions",[new I.VertexElementDescriptor(C.VertexAttribute.POSITION,3,D.DataType.FLOAT,0,12)]],["colors",[new I.VertexElementDescriptor(C.VertexAttribute.COLOR,3,D.DataType.UNSIGNED_BYTE,0,3,!0)]]]);a.PointRenderer=class extends r.SyncRenderPlugin{constructor(R){super(R);this.type=B.IntersectorType.PCL;this.isGround=!1;this._passParameters=new H.PointRendererPassParameters;this._highlights=new m.PointHighlights({forEachNode:W=>this.forEachNode(W),addHighlight:(W,V,
ba)=>this._addHighlight(W,V,ba),removeHighlight:(W,V)=>this._removeHighlight(W,V)});this.produces=new Map([[z.RenderSlot.OPAQUE_MATERIAL,W=>!q.isDepth(W)&&(W!==q.ShaderOutput.Highlight||!this._highlights.empty)],[z.RenderSlot.OPAQUE_MATERIAL_WITHOUT_NORMALS,W=>q.isDepth(W)]]);this.layerUid="";this._slicePlaneEnabled=!1;this._configuration=new F.PointRendererTechniqueConfiguration;this._nodes=new k}initializeRenderContext(R){this._context=R;R.requestRender()}uninitializeRenderContext(){}intersect(R,
W,V,ba){const U=c.create(),da=c.create(),fa=c.create(),ha=c.create(),T=x.create(),S=R.camera.perScreenPixelRatio/2,Z=R.camera.near;f.subtract(da,ba,V);const ia=1/f.length(da);f.scale(da,da,ia);f.negate(fa,da);l.set(T,da[0],da[1],da[2],-f.dot(da,V));const Y=new L,ea=new L,ka=[],ja=w.create(),X=w.create(this._passParameters.clipBox);w.offset(X,-V[0],-V[1],-V[2],X);this._nodes.forAll(na=>{const qa=na.splatSize*this._passParameters.scaleFactor;var sa=na.obb.minimumDistancePlane(T),xa=na.obb.maximumDistancePlane(T);
sa-=N(qa,sa+Z,this._passParameters,S,na.isLeaf);xa-=N(qa,xa+Z,this._passParameters,S,na.isLeaf);sa=null!=Y.dist&&null!=ea.dist&&Y.dist<sa*ia&&ea.dist>xa*ia;if(!(0>xa||sa)&&(xa=J(qa,xa+Z,this._passParameters,S,na.isLeaf),na.obb.intersectRay(V,da,xa))){xa*=xa;na.obb.toAaBoundingBox(ja);w.offset(ja,-V[0],-V[1],-V[2],ja);sa=!w.contains(X,ja);f.subtract(ha,na.origin,V);var ta=na.coordinates.length/3;for(let Ha=0;Ha<ta;Ha++){U[0]=ha[0]+na.coordinates[3*Ha];U[1]=ha[1]+na.coordinates[3*Ha+1];U[2]=ha[2]+na.coordinates[3*
Ha+2];if(sa&&!w.containsPoint(X,U))continue;var Ba=f.dot(U,da),Ia=f.squaredLength(U)-Ba*Ba;if(Ia>xa)continue;var Ca=Ba+Z;const Ga=N(qa,Ca,this._passParameters,S,na.isLeaf);if(0>Ba-Ga)continue;Ca-=Ga;Ca=J(qa,Ca,this._passParameters,S,na.isLeaf);if(Ia>Ca*Ca)continue;const Aa=(Ba-Ga)*ia;Ba=Ja=>{var Sa=Ha,$a=Ja.point;null==$a&&($a=c.create());$a[0]=na.origin[0]+na.coordinates[3*Sa];$a[1]=na.origin[1]+na.coordinates[3*Sa+1];$a[2]=na.origin[2]+na.coordinates[3*Sa+2];Ja.point=$a;Ja.dist=Aa;Ja.normal=fa;
Ja.node=na;Ja.pointId=Ha;Ja.layerUid=this.layerUid;return Ja};(null==Y.dist||Aa<Y.dist)&&(null==W||W(V,ba,Aa))&&Ba(Y);R.options.store!==B.StoreResults.MIN&&(null==ea.dist||Aa>ea.dist)&&(null==W||W(V,ba,Aa))&&Ba(ea);R.options.store!==B.StoreResults.ALL||null!=W&&!W(V,ba,Aa)||(Ia=new L,ka.push(Ba(Ia)))}}});const aa=na=>{const {layerUid:qa,node:sa,pointId:xa}=na;return new t.PclTarget(na.point,qa,xa,()=>this.createGraphic(sa,xa,na.point))},pa=(na,qa)=>{const sa=aa(qa);na.set(this.type,sa,qa.dist,qa.normal)};
if(Q(Y)){var la=R.results.min;(null==la.dist||Y.dist<la.dist)&&pa(la,Y)}Q(ea)&&R.options.store!==B.StoreResults.MIN&&(la=R.results.max,(null==la.dist||ea.dist>la.dist)&&pa(la,ea));if(R.options.store===B.StoreResults.ALL){la=u.fromPoints(V,ba);for(const na of ka){const qa=y.newIntersectorResult(la);pa(qa,na);R.results.all.push(qa)}}}acquireTechniques(R){if(0===this._nodes.length||!(R.output===q.ShaderOutput.Color||q.isDepth(R.output)&&R.bind.slot===z.RenderSlot.OPAQUE_MATERIAL_WITHOUT_NORMALS||R.output===
q.ShaderOutput.Highlight))return null;this._nodes.forAll(W=>this._initNode(R,W));this._configuration.drawScreenSize=this._passParameters.drawScreenSpace;this._configuration.useFixedSizes=this._passParameters.useFixedSizes;this._configuration.hasSlicePlane=this._slicePlaneEnabled;this._configuration.hasOccludees=R.bind.hasOccludees;this._configuration.clippingEnabled=this._clippingEnabled;this._configuration.output=R.output;return this._context.techniques.acquire(E.PointRendererTechnique,this._configuration)}render(R,
W){const {rctx:V,bind:ba,output:U}=R,da=V.bindTechnique(W,ba,this._passParameters),fa=U===q.ShaderOutput.Highlight;this._nodes.forAll(ha=>{0!==ha.coordinates.length&&(!fa||ha.highlights&&ha.highlights.some(T=>ba.highlightGroupName===T.id.highlightGroupName))&&(da.bindDraw(ba,this._passParameters,ha),V.bindVAO(ha.vao),fa?this._renderHighlightFragments(R,ha):V.drawArrays(D.PrimitiveType.POINTS,0,ha.coordinates.length/3))})}_renderHighlightFragments(R,W){const {highlights:V}=W;if(null!=V){var {rctx:ba,
bind:U}=R,{highlightGroupName:da}=U,fa=0,ha=V[0].componentIndex,T=ha+1;R=()=>{for(;fa<V.length&&V[fa].id.highlightGroupName!==da;)ha=V[fa].componentIndex,++fa;T=ha+1};R();for(W=(Z,ia)=>{ia-=Z;0<ia&&ba.drawArrays(D.PrimitiveType.POINTS,Z,ia)};fa<V.length;){var S=V[fa];S.id.highlightGroupName!==U.highlightGroupName?(W(ha,T),++fa,R()):(S=S.componentIndex,S!==T&&(W(ha,T),ha=S),T=S+1,++fa)}W(ha,T)}}set useFixedSizes(R){this._passParameters.useFixedSizes!==R&&(this._passParameters.useFixedSizes=R,this._requestRender())}get useFixedSizes(){return this._passParameters.useFixedSizes}set scaleFactor(R){this._passParameters.scaleFactor!==
R&&(this._passParameters.scaleFactor=R,this._requestRender())}get scaleFactor(){return this._passParameters.scaleFactor}set minSizePx(R){this._passParameters.minSizePx!==R&&(this._passParameters.minSizePx=R,this._requestRender())}get minSizePx(){return this._passParameters.minSizePx}set useRealWorldSymbolSizes(R){this._passParameters.useRealWorldSymbolSizes!==R&&(this._passParameters.useRealWorldSymbolSizes=R,this._requestRender())}get useRealWorldSymbolSizes(){return this._passParameters.useRealWorldSymbolSizes}set size(R){this._passParameters.size!==
R&&(this._passParameters.size=R,this._requestRender())}get size(){return this._passParameters.size}set sizePx(R){this._passParameters.sizePx!==R&&(this._passParameters.sizePx=R,this._requestRender())}get sizePx(){return this._passParameters.sizePx}set clippingBox(R){w.set(this._passParameters.clipBox,R||w.positiveInfinity)}get _clippingEnabled(){return!w.equals(this._passParameters.clipBox,w.positiveInfinity,(R,W)=>R===W)}get slicePlaneEnabled(){return this._slicePlaneEnabled}set slicePlaneEnabled(R){this._slicePlaneEnabled!==
R&&(this._slicePlaneEnabled=R,this._requestRender())}addNode(R){this._nodes.push(R);this._highlights.nodeAdded(R);this._requestRender()}removeNode(R){let W=null;this._nodes.filterInPlace(V=>V.id===R?(W=V,V.vao=n.disposeMaybe(V.vao),this._highlights.nodeRemoved(V),!1):!0);this._requestRender();return W}forEachNode(R){this._nodes.forAll(R)}removeAll(){this._nodes.forAll(R=>R.vao=n.disposeMaybe(R.vao));this._highlights.removeAll();this._nodes.clear();this._requestRender()}highlight(R,W){return this._highlights.add(R,
W)}_addHighlight(R,W,V){R.addHighlight(W,V);this._requestRender()}_removeHighlight(R,W){R.removeHighlight(W);this._requestRender()}_initNode(R,W){W.vao??(W.vao=new A.VertexArrayObject(R.rctx,v.Default3D,O,new Map([["positions",G.BufferObject.createVertex(R.rctx,D.Usage.STATIC_DRAW,W.coordinates)],["colors",G.BufferObject.createVertex(R.rctx,D.Usage.STATIC_DRAW,W.rgb)]])))}_requestRender(){this._context&&this._context.requestRender()}};b.__decorate([p.property({constructOnly:!0})],a.PointRenderer.prototype,
"createGraphic",void 0);a.PointRenderer=b.__decorate([d.subclass("esri.views.3d.layers.i3s.PointRenderer")],a.PointRenderer);class K extends H.PointRendererDrawParameters{constructor(R,W,V,ba,U,da,fa,ha,T=null){super(V,U,W);this.id=R;this.obb=ba;this.coordinates=da;this.rgb=fa;this.attributes=ha;this.pointIdFilterMap=T;this.highlights=null}addHighlight(R,W){let {highlights:V}=this;null==V&&(this.highlights=V=[]);R=new P(R,W);V.push(R);R=M(R);for(W=V.length-1;0<W&&R<M(V[W-1]);--W)[V[W-1],V[W]]=[V[W],
V[W-1]]}removeHighlight(R){var {highlights:W}=this;null!=W&&(W=W.filter(V=>V.id!==R),0===W.length&&(this.highlights=null),this.highlights=W)}}class L{constructor(){this.normal=this.dist=this.point=this.pointId=this.node=null;this.layerUid=""}}class P{constructor(R,W){this.componentIndex=R;this.id=W}}a.PointRendererNode=K;a.isPointRendererNode=function(R){return R.hasOwnProperty("splatSize")};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/PointHighlights":function(){define(["exports",
"../../../../core/handleUtils","../../webgl-engine/lib/Object3DStateID"],function(a,b,n){class k{constructor(h){this._context=h;this._highlights=new Set}get empty(){return 0===this._highlights.size}destroy(){this._highlights=null}add(h,e){const g=new p(h,e);this._highlights.add(g);this._enableSet(g);return b.makeHandle(()=>this._removeSet(g))}_removeSet(h){this._disableSet(h);this._highlights.delete(h)}_enableSet(h){h.enabled||(h.enabled=!0,this._context.forEachNode(e=>this._enableSetForNode(h,e)))}_enableSetForNode(h,
e){if(h.enabled){var g=h.ids.get(e.id);g&&g.forEach(d=>this._context.addHighlight(e,d,h.id))}}_disableSet(h){h.enabled&&(h.enabled=!1,this._context.forEachNode(e=>this._disableSetForNode(h,e)))}_disableSetForNode(h,e){h.enabled||this._context.removeHighlight(e,h.id)}nodeAdded(h){this._highlights.forEach(e=>this._enableSetForNode(e,h))}nodeRemoved(h){this._highlights.forEach(e=>this._disableSetForNode(e,h))}removeAll(){this._highlights.forEach(h=>this._disableSet(h))}}class p{constructor(h,e){this.ids=
new Map;this.enabled=!1;for(const g of h)null!=g&&this._add(g.nodeId,g.pointId);this.id=new n.Object3DHighlightStateID(e)}_add(h,e){const g=this.ids.get(h);g?g.add(e):this.ids.set(h,new Set([e]))}}a.PointHighlights=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/PointRenderer.glsl":function(){define("exports ../core/mathUtils ../core/libs/gl-matrix-2/math/mat4 ../core/libs/gl-matrix-2/factories/mat4f64 ../core/libs/gl-matrix-2/math/vec2 ../core/libs/gl-matrix-2/factories/vec2f64 ./vec32 ../core/libs/gl-matrix-2/factories/vec3f64 ../geometry/support/aaBoundingBox ../views/3d/webgl-engine/core/shaderLibrary/ShaderOutput ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/RgbaFloatEncoding.glsl ../views/3d/webgl-engine/core/shaderModules/Float2DrawUniform ../views/3d/webgl-engine/core/shaderModules/Float2PassUniform ../views/3d/webgl-engine/core/shaderModules/Float3DrawUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/Matrix4DrawUniform ../views/3d/webgl-engine/core/shaderModules/Matrix4PassUniform ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w,x,u,t,m,q,r,v,y){function B(G){const D=new v.ShaderBuilder,I=G.output===f.ShaderOutput.Color,{vertex:J,fragment:N}=D;D.include(c.SliceDraw,G);D.attributes.add(y.VertexAttribute.POSITION,"vec3");D.attributes.add(y.VertexAttribute.COLOR,"vec3");J.uniforms.add(new q.Matrix4DrawUniform("modelView",(M,Q)=>n.multiply(H,Q.camera.viewMatrix,n.fromTranslation(H,M.origin))),new r.Matrix4PassUniform("proj",(M,Q)=>Q.camera.projectionMatrix),new x.Float2DrawUniform("screenMinMaxSize",
(M,Q,O)=>p.set(F,O.useFixedSizes?0:O.minSizePx*Q.camera.pixelRatio,(M.isLeaf?256:64)*Q.camera.pixelRatio)),G.useFixedSizes?new u.Float2PassUniform("pointScale",(M,Q)=>p.set(F,M.fixedSize*Q.camera.pixelRatio,Q.camera.fullHeight)):new x.Float2DrawUniform("pointScale",(M,Q,O)=>p.set(F,M.splatSize*O.scaleFactor*Q.camera.pixelRatio,Q.camera.fullHeight/Q.camera.pixelRatio)));G.clippingEnabled?J.uniforms.add(new t.Float3DrawUniform("clipMin",(M,Q,O)=>e.set(E,O.clipBox[0]-M.origin[0],O.clipBox[1]-M.origin[1],
O.clipBox[2]-M.origin[2])),new t.Float3DrawUniform("clipMax",(M,Q,O)=>e.set(E,O.clipBox[3]-M.origin[0],O.clipBox[4]-M.origin[1],O.clipBox[5]-M.origin[2]))):(J.constants.add("clipMin","vec3",[-b.numberMaxFloat32,-b.numberMaxFloat32,-b.numberMaxFloat32]),J.constants.add("clipMax","vec3",[b.numberMaxFloat32,b.numberMaxFloat32,b.numberMaxFloat32]));I&&D.varyings.add("vColor","vec3");J.main.add(m.glsl`
    // Move clipped points outside of clipspace
    if (position.x < clipMin.x || position.y < clipMin.y || position.z < clipMin.z ||
      position.x > clipMax.x || position.y > clipMax.y || position.z > clipMax.z) {
      gl_Position = vec4(0.0,0.0,0.0,2.0);
      gl_PointSize = 0.0;
      return;
    }

    if (rejectBySlice(position)) {
      gl_Position = vec4(0.0, 0.0, 0.0, 2.0);
      gl_PointSize = 0.0;
      return;
    }

    // Position in camera space
    vec4 camera = modelView * vec4(position, 1.0);

    float pointSize = pointScale.x;
    vec4 position = proj * camera;
    ${G.drawScreenSize?m.glsl`float clampedScreenSize = pointSize;`:m.glsl`float pointRadius = 0.5 * pointSize;
           vec4 cameraOffset = camera + vec4(0.0, pointRadius, 0.0, 0.0);
           vec4 positionOffset = proj * cameraOffset;
           float radius = abs(positionOffset.y - position.y);
           float viewHeight = pointScale.y;
           // screen diameter = (2 * r / w) * (h / 2)
           float screenPointSize = (radius / position.w) * viewHeight;
           float clampedScreenSize = clamp(screenPointSize, screenMinMaxSize.x, screenMinMaxSize.y);
           // Shift towards camera, to move rendered point out of terrain i.e. to
           // the camera-facing end of the virtual point when considering it as a
           // 3D sphere.
           camera.xyz -= normalize(camera.xyz) * pointRadius * clampedScreenSize / screenPointSize;
           position = proj * camera;`}

    gl_PointSize = clampedScreenSize;
    gl_Position = position;
    ${I?m.glsl`vColor = color;`:""}`);N.include(w.RgbaFloatEncoding,G);D.include(l.OutputHighlight,G);N.main.add(m.glsl`
    vec2 vOffset = gl_PointCoord - vec2(0.5, 0.5);
    float r2 = dot(vOffset, vOffset);

    if (r2 > 0.25) {
      discard;
    }
    calculateOcclusionAndOutputHighlight();
    ${I?m.glsl`fragColor = vec4(vColor, 1.0);`:""}`);return D}function z(G){return G?256:64}class A extends m.NoParameters{constructor(){super(...arguments);this.clipBox=d.create(d.positiveInfinity);this.useRealWorldSymbolSizes=this.useFixedSizes=!1;this.scaleFactor=1;this.sizePx=this.size=this.minSizePx=0}get fixedSize(){return this.drawScreenSpace?this.sizePx:this.size}get screenMinSize(){return this.useFixedSizes?0:this.minSizePx}get drawScreenSpace(){return this.useFixedSizes&&!this.useRealWorldSymbolSizes}}
class C extends c.SlicePlaneParameters{constructor(G,D,I){super(G);this.origin=G;this.isLeaf=D;this.splatSize=I}}const H=k.create(),E=g.create(),F=h.create();k=Object.freeze(Object.defineProperty({__proto__:null,PointRendererDrawParameters:C,PointRendererPassParameters:A,build:B,getMaxPointSizeScreenspace:z},Symbol.toStringTag,{value:"Module"}));a.PointRenderer=k;a.PointRendererDrawParameters=C;a.PointRendererPassParameters=A;a.build=B;a.getMaxPointSizeScreenspace=z})},"esri/views/3d/webgl-engine/shaders/PointRendererTechnique":function(){define("require exports ../core/shaderLibrary/ShaderOutput ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../lib/StencilUtils ../../../../chunks/PointRenderer.glsl ../../../webgl/enums ../../../webgl/renderState".split(" "),
function(a,b,n,k,p,h,e,g,d){class f extends p.ShaderTechnique{constructor(c,l,w){super(c,l,new k.ReloadableShaderModule(e.PointRenderer,()=>new Promise((x,u)=>a(["./PointRenderer.glsl"],x,u))),w)}initializePipeline(c){return d.makePipelineState({depthTest:{func:g.CompareFunction.LESS},depthWrite:d.defaultDepthWrite,colorWrite:d.defaultColorWrite,stencilWrite:c.hasOccludees?h.stencilWriteMaskOn:null,stencilTest:c.hasOccludees?h.stencilBaseAllZerosParams:null,drawBuffers:c.output===n.ShaderOutput.Depth?
{buffers:[g.SpecialDrawBuffers.NONE]}:null})}}b.PointRendererTechnique=f;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/PointRendererTechniqueConfiguration":function(){define(["exports","../../../../chunks/tslib.es6","../core/shaderTechnique/ShaderTechniqueConfiguration","../materials/DefaultTechniqueConfiguration"],function(a,b,n,k){class p extends k.DefaultTechniqueConfiguration{constructor(){super(...arguments);this.clippingEnabled=this.hasOccludees=
this.useFixedSizes=this.drawScreenSize=this.hasSlicePlane=!1;this.hasSliceInVertexProgram=!0}}b.__decorate([n.parameter()],p.prototype,"hasSlicePlane",void 0);b.__decorate([n.parameter()],p.prototype,"drawScreenSize",void 0);b.__decorate([n.parameter()],p.prototype,"useFixedSizes",void 0);b.__decorate([n.parameter()],p.prototype,"hasOccludees",void 0);b.__decorate([n.parameter()],p.prototype,"clippingEnabled",void 0);a.PointRendererTechniqueConfiguration=p;Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/views/3d/layers/support/PopupSceneLayerView":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/Error ../../../../core/Logger ../../../../core/has ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ../../../../layers/support/fieldUtils ../../../layers/support/popupUtils".split(" "),function(a,b,n,k,p,h,e,g,d){a.PopupSceneLayerView=f=>{f=class extends f{_validateFetchPopupFeatures(c){const {layer:l}=this,{popupEnabled:w}=
l;if(!w)throw new n("scenelayerview3d:fetchPopupFeatures","Popups are disabled",{layer:l});if(!d.getFetchPopupTemplate(l,c))throw new n("scenelayerview3d:fetchPopupFeatures","Layer does not define a popup template",{layer:l});}async prepareFetchPopupFeatures(c){}async fetchPopupFeaturesFromGraphics(c,l){this._validateFetchPopupFeatures(l);if(0===c.length)return[];const w="scene"===this.layer.type&&null!=this.layer.associatedLayer?this.layer.associatedLayer:this.layer;var x=[];"fieldsIndex"in this.layer&&
(x=g.unpackFieldNames(this.layer.fieldsIndex,await d.getRequiredFields(w,d.getFetchPopupTemplate(this.layer,l))));await this.prepareFetchPopupFeatures(x);l=new Set;const u=[],t=[];for(const q of c)g.populateMissingFields(x,q,l)?t.push(q):u.push(q);if(0===t.length)return u;const m=new Map;for(x=0;x<c.length;x++)m.set(c[x].getObjectId()??0,x);c=await this.whenGraphicAttributes(t,[...l]).catch(()=>t).then(q=>u.concat(q));c.sort((q,r)=>{q=q.getObjectId()??0;q=m.get(q)??0;r=r.getObjectId()??0;r=m.get(r)??
0;return q-r});return c}};return f=b.__decorate([e.subclass("esri.views.3d.layers.support.PopupSceneLayerView")],f)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/SceneLayerView3D":function(){define("../../../chunks/tslib.es6 ../../../Graphic ../../../core/Logger ../../../core/maybe ../../../core/ReactiveSet ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ../../../core/sql/WhereClause ../../../layers/support/FeatureFilter ../../../layers/support/floorFilterUtils ../../../rest/support/Query ./I3SMeshView3D ./II3SMeshView3D ./LayerView3D ./i3s/featureEditing ./i3s/I3SGeometryUtil ./i3s/I3SMeshViewFilter ./i3s/I3SNode ./i3s/I3SOverrides ./i3s/I3SQueryEngine ./i3s/I3SQueryFeatureAdapter ./i3s/I3SQueryFeatureStore ./i3s/I3SUtil ./support/DefinitionExpressionSceneLayerView ./support/fieldProperties ./support/PopupSceneLayerView ./support/SceneLayerViewRequiredFields ./support/TemporalSceneLayerView ../support/updatingProperties ../../layers/SceneLayerView ../../layers/support/popupUtils ../../support/HighlightDefaults ../../support/layerViewUtils ../../support/Scheduler".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w,x,u,t,m,q,r,v,y,B,z,A,C,H,E,F,G,D,I,J,N,M,Q,O,K){g=F.defineFieldProperties();u=class extends u.I3SMeshView3D(I.TemporalSceneLayerView(E.DefinitionExpressionSceneLayerView(G.PopupSceneLayerView(m.LayerView3D(N))))){constructor(){super(...arguments);this.type="scene-layer-3d";this._setVisibilityHiddenObjectIds=new p;this.progressiveLoadFactor=1;this._elevationContext="scene";this._isIntegratedMesh=!1;this._supportsLabeling=!0;this._pendingEditsQueue=Promise.resolve();
this._interactiveEditingSessions=new Map;this._queryEngine=null}get i3slayer(){return this.layer}tryRecycleWith(L,P){return L.url===this.layer.url&&this.i3sOverrides.isEmpty?L.load(P).then(()=>{H.checkRecyclable(this.layer,L,this.i3sOverrides);this.layer=L;this.i3sOverrides.destroy();this.i3sOverrides=new B.I3SOverrides({view:this.view,layer:L,memoryController:this.view.resourceController?.memoryController});this.resetHighlights()}):null}get layerPopupEnabledAndHasTemplate(){return this.layer.popupEnabled&&
M.hasPopupTemplate(this.layer,this.view.popup?.defaultPopupTemplateEnabled)}get filter(){return this._get("filter")}set filter(L){this._set("filter",v.I3SMeshViewFilter.checkSupport(L)?L:null)}get viewFilter(){const L=this.mergedFilter,P=this.layerFilter;if(null==L&&null==P)return null;const R=this._get("viewFilter");if(null==R)return new v.I3SMeshViewFilter({layerFilter:P,viewFilter:L,layerFieldsIndex:this.layer.fieldsIndex,loadAsyncModule:W=>this._loadAsyncModule(W),addSqlFilter:(W,V)=>this.addSqlFilter(W,
V,this.logError),addTimeFilter:(W,V)=>this.addTimeFilter(W,V)});R.viewFilter=L;R.layerFilter=P;return R}get requiredFields(){return this._fieldsHelper?.requiredFields??[]}get _floorFilterClause(){const L=w.getFloorFilterClause(this);return null!=L?c.WhereClause.create(L,{fieldsIndex:this.layer.fieldsIndex}):null}get _excludeObjectIdsSorted(){const L=this.layer.excludeObjectIds.toArray();return L.length?L.sort((P,R)=>P-R):null}get _setVisibilityHiddenObjectIdsSorted(){return this._setVisibilityHiddenObjectIds.size?
Array.from(this._setVisibilityHiddenObjectIds).sort((L,P)=>L-P):null}get lodFactor(){return this.view?.qualitySettings?.sceneService?.object?.lodFactor??1}get lodCrossfadeUncoveredDuration(){return this.view?.qualitySettings?.fadeDuration??0}get updatingProgressValue(){return this._controller?.updatingProgress??0}get visibleAtCurrentScale(){return O.isInEffectiveScaleRange(this.i3slayer.effectiveScaleRange,this.view.scale)}initialize(){this._fieldsHelper=new D.SceneLayerViewRequiredFields({layerView:this});
this._updatingHandles.add(()=>this.layer.rangeInfos,P=>this._rangeInfosChanged(P),h.initial);this._updatingHandles.add(()=>this.layer.renderer,P=>this._updatingHandles.addPromise(this._rendererChange(P)),h.initial);const L=()=>this._filterChange();this._updatingHandles.add(()=>this.parsedDefinitionExpression,L);this._updatingHandles.add(()=>this.mergedFilter,L);this._updatingHandles.add(()=>this._floorFilterClause,L);this._updatingHandles.add(()=>this._excludeObjectIdsSorted,L);this._updatingHandles.add(()=>
this._setVisibilityHiddenObjectIdsSorted,L);this._updatingHandles.add(()=>this.viewFilter?.sortedObjectIds,L);this._updatingHandles.add(()=>this.viewFilter?.parsedWhereClause,L);this._updatingHandles.add(()=>this.getTimeFilterDependencies(),L);this._updatingHandles.add(()=>[this.viewFilter?.parsedGeometry,this.mergedFilter?.spatialRelationship,this.layer.filter?.spatialRelationship],()=>this._geometryFilterChange());this.i3sOverrides.is3DOFL&&this._updatingHandles.add(()=>this.i3sOverrides.sortedGeometryChangedObjectIds,
L);this.addHandles(this.layer.on("apply-edits",P=>this._updatingHandles.addPromise(P.result)));this.addHandles(this.layer.on("edits",P=>{const R=this._pendingEditsQueue.then(()=>this._handleEdits(P)).then();this._pendingEditsQueue=R;this._updatingHandles.addPromise(R)}))}destroy(){this._fieldsHelper=k.destroyMaybe(this._fieldsHelper)}_rangeInfosChanged(L){null!=L&&0<L.length&&n.getLogger(this).warn("Unsupported property: rangeInfos are currently only serialized to and from web scenes but do not affect rendering.")}createQuery(){const L=
{outFields:["*"],returnGeometry:!1,outSpatialReference:this.view.spatialReference};return this.mergedFilter?.createQuery(L)??new x(L)}queryExtent(L,P){return this._ensureQueryEngine().executeQueryForExtent(this._ensureQuery(L),P?.signal)}queryFeatureCount(L,P){return this._ensureQueryEngine().executeQueryForCount(this._ensureQuery(L),P?.signal)}queryFeatures(L,P){return this._ensureQueryEngine().executeQuery(this._ensureQuery(L),P?.signal).then(R=>{if(!R?.features)return R;const W=this.layer;for(const V of R.features)V.layer=
W,V.sourceLayer=W;return R})}queryObjectIds(L,P){return this._ensureQueryEngine().executeQueryForIds(this._ensureQuery(L),P?.signal)}_ensureQueryEngine(){this._queryEngine||(this._queryEngine=this._createQueryEngine());return this._queryEngine}_createQueryEngine(){const L=r.createGetFeatureExtent(this.view.spatialReference,this.view.renderSpatialReference,this._collection);return new z.I3SQueryEngine({layerView:this,priority:K.TaskPriority.FEATURE_QUERY_ENGINE,spatialIndex:new C.I3SQueryFeatureStore({featureAdapter:new A.I3SQueryFeatureAdapter({objectIdField:this.layer.objectIdField,
attributeStorageInfo:this.layer.attributeStorageInfo??[],getFeatureExtent:L}),forAllFeatures:(P,R)=>this._forAllFeatures((W,V,ba)=>P({id:W,index:V,meta:ba}),R,t.ForAllFeaturesMode.QUERYABLE),getFeatureExtent:L,sourceSpatialReference:H.getIndexCrs(this.layer),viewSpatialReference:this.view.spatialReference})})}highlight(L,P){const R=this._highlights;P??=Q.defaultHighlightName;if(L instanceof x){const {set:W,handle:V}=R.acquireSet(P);this.queryObjectIds(L).then(ba=>R.setFeatureIds(W,ba,P));return V}return super.highlight(L,
P)}createInteractiveEditSession(L){return q.createInteractiveEditSession(this._attributeEditingContext,L)}_createLayerGraphic(L){return new b({attributes:L,layer:this.layer,sourceLayer:this.layer})}getFilters(){const L=super.getFilters();this.i3sOverrides.is3DOFL&&0<this.i3sOverrides.sortedGeometryChangedObjectIds.length&&L.push((W,V)=>{0<=V.node.index&&H.objectIdFilter(this.i3sOverrides.sortedGeometryChangedObjectIds,!1,W)});const P=this._setVisibilityHiddenObjectIdsSorted;null!=P&&L.push(W=>H.objectIdFilter(P,
!1,W));const R=this._excludeObjectIdsSorted;null!=R&&L.push(W=>H.objectIdFilter(R,!1,W));this._floorFilterClause&&this.addSqlFilter(L,this._floorFilterClause,this.logError);this.addSqlFilter(L,this.parsedDefinitionExpression,this.logError);null!=this.viewFilter&&this.viewFilter.addFilters(L,this.view,this._controller.crsIndex,this._collection);return L}setVisibility(L,P){P?this._setVisibilityHiddenObjectIds.delete(L):this._setVisibilityHiddenObjectIds.add(L)}isUpdating(){return super.isUpdating()||
this.layerFilterUpdating||null!=this.viewFilter&&this.viewFilter.updating||null!=this.i3sOverrides&&this.i3sOverrides.updating}_ensureQuery(L){return this._addDefinitionExpressionToQuery(null==L?this.createQuery():x.from(L))}get _attributeEditingContext(){return{sessions:this._interactiveEditingSessions,fieldsIndex:this.layer.fieldsIndex,objectIdField:this._getObjectIdField(),globalIdField:this._getGlobalIdField(),forEachNode:L=>this._forAllNodes(P=>null!=P?L(P.node,P.featureIds):null),attributeStorageInfo:this.i3slayer.attributeStorageInfo??
[],i3sOverrides:this.i3sOverrides,getAttributeData:L=>this.getAttributeData(L),setAttributeData:(L,P)=>this.setAttributeData(L,P),clearMemCache:()=>this.clearMemCache()}}async _handleEdits(L){const P=this._attributeEditingContext;L=await q.normalizeEditResultsEvent(P,L);q.processGeometryEdits(P,L);q.processAttributeEdits(P,L)}get hasGeometryFilter(){return null!=this.viewFilter?.parsedGeometry}computeNodeFiltering(L){const P=this.viewFilter;return null==P||!this.view.spatialReference||P.isMBSGeometryVisible(L,
this.view.spatialReference,this._controller.crsIndex)?y.NodeFilterImpact.Unmodified:y.NodeFilterImpact.Culled}};a.__decorate([e.property()],u.prototype,"i3slayer",null);a.__decorate([e.property(J.updatingProgress)],u.prototype,"updatingProgress",void 0);a.__decorate([e.property({type:l})],u.prototype,"filter",null);a.__decorate([e.property({readOnly:!0})],u.prototype,"viewFilter",null);a.__decorate([e.property(g.requiredFields)],u.prototype,"requiredFields",null);a.__decorate([e.property(g.availableFields)],
u.prototype,"availableFields",void 0);a.__decorate([e.property()],u.prototype,"_fieldsHelper",void 0);a.__decorate([e.property()],u.prototype,"_floorFilterClause",null);a.__decorate([e.property()],u.prototype,"_excludeObjectIdsSorted",null);a.__decorate([e.property()],u.prototype,"_setVisibilityHiddenObjectIds",void 0);a.__decorate([e.property()],u.prototype,"_setVisibilityHiddenObjectIdsSorted",null);a.__decorate([e.property()],u.prototype,"lodFactor",null);a.__decorate([e.property()],u.prototype,
"updatingProgressValue",null);a.__decorate([e.property({readOnly:!0})],u.prototype,"visibleAtCurrentScale",null);return u=a.__decorate([f.subclass("esri.views.3d.layers.SceneLayerView3D")],u)})},"esri/core/ReactiveSet":function(){define(["./accessorSupport/tracking","./accessorSupport/tracking/SimpleObservable"],function(a,b){class n{constructor(k){this._observable=new b.SimpleObservable;this._set=new Set(k)}get size(){a.trackAccess(this._observable);return this._set.size}add(k){const p=this._set.size;
this._set.add(k);this._set.size!==p&&this._observable.notify();return this}clear(){0<this._set.size&&(this._set.clear(),this._observable.notify())}delete(k){(k=this._set.delete(k))&&this._observable.notify();return k}entries(){a.trackAccess(this._observable);return this._set.entries()}forEach(k,p){a.trackAccess(this._observable);this._set.forEach((h,e)=>k.call(p,h,e,this),p)}has(k){a.trackAccess(this._observable);return this._set.has(k)}keys(){a.trackAccess(this._observable);return this._set.keys()}values(){a.trackAccess(this._observable);
return this._set.values()}[Symbol.iterator](){a.trackAccess(this._observable);return this._set[Symbol.iterator]()}get [Symbol.toStringTag](){return this._set[Symbol.toStringTag]}}return n})},"esri/views/3d/layers/I3SMeshView3D":function(){define("require exports ../../../chunks/tslib.es6 ../../../Color ../../../Graphic ../../../chunks/languageUtils ../../../core/arrayUtils ../../../core/ByteSizeUnit ../../../core/has ../../../core/Logger ../../../core/maybe ../../../core/PooledArray ../../../core/promiseUtils ../../../core/reactiveUtils ../../../core/scheduling ../../../core/typedArrayUtil ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/decorators/subclass ../../../core/libs/gl-matrix-2/math/mat3 ../../../core/libs/gl-matrix-2/factories/mat3f64 ../../../core/libs/gl-matrix-2/math/mat4 ../../../core/libs/gl-matrix-2/factories/mat4f64 ../../../core/libs/gl-matrix-2/factories/quatf64 ../../../chunks/vec32 ../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../chunks/vec42 ../../../core/libs/gl-matrix-2/factories/vec4f64 ../../../core/support/UpdatingHandles ../../../geometry/spatialReferenceEllipsoidUtils ../../../geometry/projection/localLinearScaleFactors ../../../geometry/projection/projectBoundingSphere ../../../geometry/projection/projectBuffer ../../../geometry/projection/projectors ../../../geometry/projection/projectVectorToVector ../../../geometry/support/aaBoundingBox ../../../geometry/support/aaBoundingRect ../../../geometry/support/DoubleArray ../../../geometry/support/FloatArray ../../../geometry/support/Indices ../../../chunks/sphere ../../../geometry/support/UByteArray ../../../layers/LayerConstants ../../../layers/graphics/controllers/I3SOnDemandController ../../../layers/support/fieldUtils ../../../layers/support/SceneModification ../../../renderers/visualVariables/support/visualVariableUtils ../../../support/arcadeOnDemand ../../../support/basemapUtils ../../../support/elevationInfoUtils ../../../symbols/MeshSymbol3D ../../../symbols/SimpleFillSymbol ./I3SMeshViewLabeler ./I3SMeshViewPerformanceInfo ./I3SMeshWorkerHandle ./II3SMeshView3D ./SceneLayerWorker ./graphics/graphicUtils ./graphics/Labeler ./i3s/enums ./i3s/Highlights ./i3s/I3SAsyncElevationUpdater ./i3s/I3SCrossfadeHelper ./i3s/I3SGeometryUtil ./i3s/I3SIntersectionHandler ./i3s/I3SMaterialUtil ./i3s/I3SNode ./i3s/I3SOverrides ./i3s/I3SProjectionUtil ./i3s/I3SUtil ./i3s/IDBCache ./i3s/IDBMockCache ./i3s/LayerElevationProvider ./support/attributeUtils ./support/highlightUtils ./support/makeScheduleFunction ./support/symbolColorUtils ../support/debugFlags ../support/ElevationRange ../support/extentUtils ../support/orientedBoundingBox ../support/updatingProperties ../support/buffer/glUtil ../webgl-engine/collections/Component/ObjectParameters ../webgl-engine/collections/Component/SourceGeometry ../webgl-engine/collections/Component/Transform ../webgl-engine/core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl ../webgl-engine/lib/BasisUtil ../webgl-engine/lib/edgeRendering/interfaces ../../support/HighlightDefaults".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w,x,u,t,m,q,r,v,y,B,z,A,C,H,E,F,G,D,I,J,N,M,Q,O,K,L,P,R,W,V,ba,U,da,fa,ha,T,S,Z,ia,Y,ea,ka,ja,X,aa,pa,la,na,qa,sa,xa,ta,Ba,Ia,Ca,Ha,Ga,Aa,Ja,Sa,$a,Wa,Ta,Da,La,Va,ma,za,Na,Ra,Pa,ca,cb,ib,nb,xb,ya){function Ea(mb,ra){w.isAbortError(mb)||f.getLogger("esri.views.3d.layers.I3SMeshView3D").warn("Error while processing edges. Edges on this layer might not display correctly",ra,mb)}function Qa(mb){if(null==mb)return!1;const ra=mb.metallicRoughness;return ra&&0<=ra.baseColorTextureId||
ra&&0<=ra.metallicRoughnessTextureId||0<=mb.normalTextureId||0<=mb.emissiveTextureId||0<=mb.occlusionTextureId}function db(mb){return null!=mb&&t.isArrayBuffer(mb.data)}function lb(mb,ra){mb=1024+mb.interleavedVertexData.byteLength+(mb.indices?mb.indices.byteLength:0)+mb.positionData.data.byteLength+mb.positionData.indices.byteLength;if(null!=ra)for(const Fa of ra)null!=Fa&&t.isArrayBuffer(Fa.data)&&(mb+=Fa.data.byteLength);return mb}function ub(mb,ra){return ra.byteSize>Db?(f.getLogger("esri.views.3d.layers.I3SMeshView3D").warn(`Node is too big to store in IndexedDB cache: ${mb.id} (${ra.byteSize} bytes)`),
!1):0<ra.byteSize}function Oa(mb){if(0!==mb.length){var ra=new Float64Array(10*mb.length),Fa=0;mb.forAll(Ya=>{let bb=Ya.serviceObbInIndexSR;null==bb&&(bb=pb,bb.center=R.getCenter(Ya.serviceMbsInIndexSR),bb.halfSize=[Ya.serviceMbsInIndexSR[3],Ya.serviceMbsInIndexSR[3],Ya.serviceMbsInIndexSR[3]]);Ya=bb.data;ra[Fa++]=Ya[0];ra[Fa++]=Ya[1];ra[Fa++]=Ya[2];ra[Fa++]=Ya[3];ra[Fa++]=Ya[4];ra[Fa++]=Ya[5];ra[Fa++]=Ya[6];ra[Fa++]=Ya[7];ra[Fa++]=Ya[8];ra[Fa++]=Ya[9]});return ra}}function Xa(mb,ra){mb.forEach(Fa=>
Fa.opacity=ra)}function Za(mb,ra,Fa){let Ya=mb.elevationRangeMin,bb=mb.elevationRangeMax;if(0<Fa){ra.getCorners(Pb);for(const kb of Pb){var fb=A.len(kb)-Fa;Ya=Math.min(Ya,fb);bb=Math.max(bb,fb)}}else{ra.getCorners(Pb);for(fb of Pb)Fa=fb[2],Ya=Math.min(Ya,Fa),bb=Math.max(bb,Fa)}mb.expandElevationRangeValues(Ya,bb)}function hb(mb,ra,Fa){const Ya=R.getCenter(ra);Fa=0<Fa?A.len(Ya)-Fa:Ya[2];ra=R.getRadius(ra);mb.expandElevationRangeValues(Fa-ra,Fa+ra)}const jb=[1,1,1,1];class ob extends sa.NodeCrossfadeMetaData{constructor(mb,
ra,Fa,Ya,bb,fb,kb,rb,vb){super();this.node=mb;this.featureIds=ra;this.objectHandle=Fa;this.cachedRendererVersion=Ya;this.attributeInfo=bb;this.material=fb;this.textures=kb;this.anchorIds=rb;this.anchors=vb;this.cachedElevationAnchors=null;this.cachedEdgeMaterials=[];this.edgeMemoryUsage=0}}var zb;(function(mb){mb[mb.CastShadows=4]="CastShadows";mb[mb.Pickable=5]="Pickable"})(zb||={});const Db=100*g.ByteSizeUnit.MEGABYTES;var ua;(function(mb){mb[mb.ADD=0]="ADD";mb[mb.REMOVE=1]="REMOVE";mb[mb.UPDATE=
2]="UPDATE"})(ua||={});const Ma=Q.create(),ab=O.create(),qb=O.create(),pb=new za.Obb,yb=[0,0,0,0],Fb=new k([0,0,0,0]),Sb=R.fromValues(0,0,0,0);class Mb{constructor(mb,ra,Fa){this.attributeInfo=mb;this.meta=ra;this.promise=Fa;this.allowMemCache=!0}}class Hb{constructor(mb,ra){this.mode=mb;this.offset=ra}}const Eb=C.create(),Ob=Q.create(),Pb=[[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0]],Tb=new Va.ElevationRange;b.I3SMeshView3D=mb=>{mb=class extends mb{constructor(){super(...arguments);
this._shadeNormals=this._applySSAO=!0;this._updatingHandles=new F.UpdatingHandles;this._nodeId2Meta=new Map;this._nodeId2MetaReloading=new Map;this._i3sWasmLoaded=!1;this._snappingSourcesTrackers=[];this._hasLoadedPBRTextures=!1;this._asyncModuleLoading=0;this._addTasks=new Map;this._currentRenderer=null;this._rendererVersion=0;this._symbologyOverrideFields=this._symbologyOverride=this._symbologyFields=this._rendererFields=this._opacityVariable=this._colorVariable=null;this._symbolInfos=new Map;this._visibleGeometryChangedSchedulerHandle=
null;this._hasVertexColors=this._hasComponentData=!1;this._nodeColorOverride=null;this.updating=!0;this.holeFilling="auto";this.slicePlaneEnabled=this._hasData=this._hasTextures=this._hasColors=!1;this._modifications=[];this.ignoresMemoryFactor=!1;this._layerUrl="";this._cacheKeySuffix=null;this._planetRadiusInGlobalMode=0;this._elevationTask=null;this._filters=[];this._arcade=null;this._tmpAttributeOnlyGraphic=new p;this._crossfadeHelper=new sa.I3SCrossfadeHelper(this)}get lodCrossfadeoutDuration(){return 0}get lodCrossfadeinDuration(){return 0}get lodCrossfadeUncoveredDuration(){return 0}get layerUid(){return this.i3slayer&&
this.i3slayer.uid}get sublayerUid(){return null}get layerId(){return this.i3slayer&&this.i3slayer.id}get sublayerId(){return null}get contentVisible(){return!this.suspended&&this._controller?.rootNodeVisible}get legendEnabled(){return this.contentVisible&&!0===this.i3slayer?.legendEnabled}get updatingProgressValue(){return this._controller?.updatingProgress??0}get hasTexturesOrVertexColors(){return this._hasData?this._hasTextures||this._hasColors?"yes":"probably-not":"unknown"}get rendererTextureUsage(){return Ga.rendererNeedsTextures(this._currentRenderer)?
this._usePBR||this._hasLoadedPBRTextures?la.TextureUsage.AllTexturesPBR:la.TextureUsage.AllTextures:this._usePBR||this._hasLoadedPBRTextures?la.TextureUsage.GeometryTexturesPBR:la.TextureUsage.GeometryTextures}get elevationOffset(){const ra=null!=this.i3slayer?this.i3slayer.elevationInfo:null;return null!=ra&&"absolute-height"===ra.mode?S.getElevationOffset(ra,this.i3slayer.spatialReference):0}get elevationInfo(){const ra=null!=this.i3slayer?this.i3slayer.elevationInfo:null;if(null==ra)return new Hb(ja.ElevationMode.Absolute,
0);const Fa=S.getElevationOffset(ra,this.i3slayer.spatialReference);switch(ra.mode){case "absolute-height":return new Hb(ja.ElevationMode.Absolute,Fa);case "relative-to-ground":return new Hb(ja.ElevationMode.RelativeToGround,Fa);case "on-the-ground":return new Hb(ja.ElevationMode.OnTheGround,0);default:return new Hb(ja.ElevationMode.Absolute,0)}}get supportedTextureEncodings(){return Ba.getSupportedEncodings(this.view._stage.renderView.capabilities)}get uncompressedTextureDownsamplingEnabled(){const ra=
0===(this.supportedTextureEncodings&la.TextureEncoding.DDS_S3TC);return this.view?.qualitySettings.sceneService.uncompressedTextureDownsamplingEnabled&&ra}get clientGeometry(){return this.i3sOverrides.geometryOverrides}get elevationRange(){var ra=this._nodeId2Meta;const Fa=new Va.ElevationRange;for(const Ya of ra.values()){if(null==Ya)continue;({node:{serviceMbsInIndexSR:ra}}=Ya);const [,,bb,fb]=ra;Fa.expandElevationRangeValues(bb-fb,bb+fb)}return Fa.elevationRangeValid?Fa:null}get fullExtent(){return this.i3slayer.fullExtent}initialize(){var ra=
d("enable-feature:idb-mock-cache");this._idbCache=ra?new Ja.IDBMockCache(this.view,ra):new Aa.IDBCache("esri-scenelayer-cache","geometries");this._preLoadBasis();this.addResolvingPromise(this.i3slayer.indexInfo);ra=this.view.resourceController;this.i3sOverrides=new Ca.I3SOverrides({view:this.view,layer:this.i3slayer,memoryController:ra.memoryController});this._worker=new ka.I3SMeshWorkerHandle(Ta.makeScheduleFunction(ra));this.addResolvingPromise(this._worker.promise);ra=this.i3slayer.store;this.addResolvingPromise(this._worker.setLegacySchema(this.uid,
ra.defaultGeometrySchema).catch(w.ignoreAbortErrors));Ga.checkSceneLayerValid(this.i3slayer);Ga.checkSceneLayerCompatibleWithView(this.i3slayer,this.view);this._layerUrl=this.i3slayer.parsedUrl.path;this._controller=new ba({layerView:this,worker:this._worker});this._geoMemoryEstimate=this._texMemoryEstimate=this._gpuMemoryEstimate=0;this._stage=this.view._stage;this._collection=this._stage.renderView.componentObjectCollection;this.resetHighlights();ra=ra.defaultGeometrySchema;if(this._isIntegratedMesh||
!ra)this._hasComponentData=!1;else{const rb=ra.featureAttributes;this._hasComponentData=!!(rb&&rb.faceRange&&rb.id)}this._hasVertexColors=null!=(ra?.vertexAttributes.color??null)&&!this.i3slayer.cachedDrawingInfo?.color;this._memCache=this.view.resourceController.memoryController.newCache(`sl-${this.uid}`,rb=>this._deleteComponentObject(rb));const Fa=this._controller,Ya=this._nodeId2Meta,bb=this._nodeId2MetaReloading;this._intersectionHandler=new ta.I3SIntersectionHandler({layerUid:this.layerUid,
sublayerUid:this.sublayerUid,collection:this._collection,slicePlaneEnabled:this.slicePlaneEnabled,isGround:this._isIntegratedMesh,traverseNodeHierarchy:rb=>{const vb=Fa.index;if(vb){var Ab=vb.rootNode;Ab&&vb.traverse(Ab,Bb=>{var Ib=Bb.index;Ib=Ya.get(Ib)||bb.get(Ib);return rb(Bb,Ib?.objectHandle??null)})}}});this._updatingHandles.add(()=>this.layerUid,rb=>this._intersectionHandler.layerUid=rb);this._updatingHandles.add(()=>this.sublayerUid,rb=>this._intersectionHandler.sublayerUid=rb);this._elevationProvider=
new Sa.LayerElevationProvider({view:this.view,layerElevationSource:this,intersectionHandler:this._intersectionHandler});this._hasLoadedPBRTextures=this._usePBR;this._updatingHandles.add(()=>this.view.clippingArea,()=>this._clippingAreaChanged(),x.initial);this._updatingHandles.add(()=>this.fullOpacity,rb=>this._opacityChange(rb));this._updatingHandles.add(()=>this.slicePlaneEnabled,rb=>this._slicePlaneEnabledChange(rb));this._updatingHandles.add(()=>this.elevationOffset,(rb,vb)=>{this._reloadAll(vb);
this._controller.invalidateVisibilityObbs()});this._updatingHandles.add(()=>this.elevationInfo,(rb,vb)=>this._elevationInfoChanged(rb,vb),x.initial);this._updatingHandles.add(()=>!this.suspended&&this.elevationInfo.mode!==ja.ElevationMode.Absolute,(rb,vb)=>{rb?this.addHandles(this.view.basemapTerrain.on("elevation-change",({extent:Ab})=>this._ensureElevationTask().addExtent(Ab)),"elevation-change"):vb&&this.removeHandles("elevation-change")},x.initial);this._updatingHandles.add(()=>this._usePBR,rb=>
this._updatePBR(rb));ra=()=>{this._reloadAll();this.clearMemCache()};this._updatingHandles.add(()=>this.rendererTextureUsage,ra);this._updatingHandles.add(()=>this.uncompressedTextureDownsamplingEnabled,ra);this._updatingHandles.add(()=>this.contentVisible,rb=>this._contentVisibleChanged(rb),x.initial);this._updatingHandles.add(()=>this.i3slayer.labelsVisible,()=>this._labelingChanged(),x.initial);this._updatingHandles.add(()=>this.i3slayer.labelingInfo,()=>this._labelingChanged(),x.initial);this._updatingHandles.add(()=>
this._modifications,()=>this._modificationsChanged(),x.initial);this.addHandles([x.watch(()=>La.debugFlags.I3S_TREE_SHOW_TILES,rb=>{if(rb&&!this._treeDebugger){const vb=this._controller.crsIndex;(new Promise((Ab,Bb)=>a(["./support/I3STreeDebugger"],Ab,Bb))).then(({I3STreeDebugger:Ab})=>{!this._treeDebugger&&La.debugFlags.I3S_TREE_SHOW_TILES&&(this._treeDebugger=new Ab({lv:this,view:this.view,nodeSR:vb}))})}else rb||La.debugFlags.I3S_TREE_SHOW_TILES||(this._treeDebugger=c.destroyMaybe(this._treeDebugger))},
x.initial),x.watch(()=>La.debugFlags.I3S_SHOW_MODIFICATIONS,()=>this._showModifications(),x.initial)]);this._cacheKeySuffix=this._getCacheKeySuffix();this._idbCache.init().catch(rb=>f.getLogger("esri.views.3d.layers.I3SMeshView3D").warn(`Failed to initialize IndexedDB cache: ${rb}`));({view:ra}=this);const {viewingMode:fb,renderCoordsHelper:kb}=ra;this._planetRadiusInGlobalMode="local"===fb?0:kb.referenceEllipsoid.radius}destroy(){this._clearAddTasks();this._elevationTask=c.destroyMaybe(this._elevationTask);
this.i3sOverrides=c.destroyMaybe(this.i3sOverrides);this._elevationProvider&&(this._elevationProvider.objectsChanged(this.getVisibleObbs()),this.view.elevationProvider.unregister(this._elevationProvider),this._elevationProvider=null);this._intersectionHandler&&(this._stage.view.sceneIntersectionHelper.removeIntersectionHandler(this._intersectionHandler),this._intersectionHandler=null);const ra=this._worker;ra&&(ra.destroyContext(this.uid).then(()=>ra.destroy()),this._worker=null);this._removeAllNodeDataFromStage();
this._memCache=c.destroyMaybe(this._memCache);this._edgeView=this._stage=this._collection=null;this._labeler=c.destroyMaybe(this._labeler);this._treeDebugger=c.destroyMaybe(this._treeDebugger);this._controller=c.destroyMaybe(this._controller);this._highlights.destroy();this._nodeId2Meta.clear();this._nodeId2MetaReloading.clear();this._crossfadeHelper=c.destroyMaybe(this._crossfadeHelper);this.emit("visible-geometry-changed");this._visibleGeometryChangedSchedulerHandle&&(this._visibleGeometryChangedSchedulerHandle.remove(),
this._visibleGeometryChangedSchedulerHandle=null);this._updatingHandles=c.destroyMaybe(this._updatingHandles)}_memEstimateTextureAdded(ra){ra=ra.memoryEstimate;this._gpuMemoryEstimate+=ra;this._texMemoryEstimate+=ra;return ra}_memEstimateTextureRemoved(ra){null!=ra&&(ra=ra.memoryEstimate,this._gpuMemoryEstimate-=ra,this._texMemoryEstimate-=ra)}_memEstimateGeometryAdded(ra){ra=this._collection.getObjectGPUMemoryUsage(ra);this._gpuMemoryEstimate+=ra;this._geoMemoryEstimate+=ra;return ra}_memEstimateGeometryRemoved(ra){ra=
this._collection.getObjectGPUMemoryUsage(ra);this._gpuMemoryEstimate-=ra;this._geoMemoryEstimate-=ra}isNodeLoaded(ra){return this._nodeId2Meta.has(ra)}isNodeReloading(ra){return this._nodeId2MetaReloading.has(ra)}get usedMemory(){let ra=null!=this._labeler?this._labeler.usedMemory:0;this._nodeId2Meta.forEach(Fa=>ra+=null!=Fa?Fa.node.memory:0);this._nodeId2MetaReloading.forEach(Fa=>ra+=null!=Fa?Fa.node.memory:0);return ra}get unloadedMemory(){return(null!=this._controller?this._controller.unloadedMemoryEstimate:
0)+(null!=this._labeler?this._labeler.unloadedMemoryEstimate:0)}_labelingChanged(){if(!pa.areLabelsVisible(this.i3slayer)||!this._supportsLabeling)null!=this._labeler&&(this._labeler.destroy(),this._labeler=null);else if(null==this._labeler){var ra=new Y({view:this.view,layer:this.i3slayer,collection:this._collection,overrides:this.i3sOverrides});this._nodeId2Meta.forEach(Fa=>null!=Fa&&this._addMetaToLabeler(ra,Fa));this._labeler=ra}}_loadAsyncModule(ra){++this._asyncModuleLoading;return ra.then(Fa=>
{--this._asyncModuleLoading;return Fa},Fa=>{--this._asyncModuleLoading;throw Fa;})}_modificationsChanged(){if(!this._i3sWasmLoaded&&this.hasModifications)this._i3sWasmLoaded=X.initialize().then(()=>{this._i3sWasmLoaded=!0;this._modificationsChanged();this.notifyUpdate()}),this.notifyUpdate();else if(!0===this._i3sWasmLoaded){var ra=this.uid,Fa=this.i3slayer.spatialReference;this._worker.setModifications(ra,this._layerClippingArea,this._modifications,Fa);var Ya=ka.toWasmModification(this._layerClippingArea,
this._modifications,Fa);X.setModificationsSync({context:ra,modifications:Ya,isGeodetic:Fa.isGeographic});this._controller.modificationsChanged();var bb=this.hasModifications?new l:null;this._nodeId2Meta.forEach((fb,kb)=>{null==fb?(this._nodeId2Meta.delete(kb),this._controller.updateLoadStatus(kb,!1)):fb.node.hasModifications?(this._nodeId2Meta.delete(kb),this._nodeId2MetaReloading.set(kb,fb)):null!=bb&&bb.push(fb.node)});this.notifyChange("elevationRange");null!=bb&&this._nodeId2MetaReloading.forEach(fb=>
bb.push(fb.node));null!=bb&&0<bb.length&&(this.updateNodeModificationStatus(bb),bb.forAll(fb=>{if(fb.imModificationImpact!==Ia.NodeIMModificationImpact.Culled){const kb=this._nodeId2Meta.get(fb.index);this._controller.invalidateGeometryVisibility(fb.index);null!=kb?(this._nodeId2Meta.delete(fb.index),this._nodeId2MetaReloading.set(fb.index,kb),this.notifyChange("elevationRange")):this._nodeId2Meta.has(fb.index)&&(this._nodeId2Meta.delete(fb.index),this._controller.updateLoadStatus(fb.index,!1))}}));
this.clearMemCache();this._controller.restartNodeLoading();this._showModifications()}}_showModifications(){null!=this._modificationGraphics&&(this.view.graphics.removeMany(this._modificationGraphics),this._modificationGraphics=null);if(La.debugFlags.I3S_SHOW_MODIFICATIONS&&0!==this._modifications.length){var ra={clip:[227,227,79,.8],mask:[227,139,79,.8],replace:[139,227,79,.8]},Fa={outline:{color:[255,255,255],width:1}};this._modificationGraphics=[];for(const Ya of this._modifications){const bb=Ya.geometry;
bb.spatialReference=this.i3slayer.spatialReference;const fb=new ia({...Fa,color:ra[Ya.type]});this._modificationGraphics.push(new p({geometry:bb,symbol:fb}))}this.view.graphics.addMany(this._modificationGraphics)}}_addMetaToLabeler(ra,Fa){ra.addNodeMeta(Fa,(Ya,bb)=>this._createAttributes(Ya,bb))}_contentVisibleChanged(ra){ra?(this.view.elevationProvider.register(this._elevationContext,this._elevationProvider),this._stage.view.sceneIntersectionHelper.addIntersectionHandler(this._intersectionHandler)):
(this._removeAllNodeDataFromStage(),this.view.elevationProvider&&this.view.elevationProvider.unregister(this._elevationProvider),this._stage.view.sceneIntersectionHelper.removeIntersectionHandler(this._intersectionHandler))}getLoadedAttributes(ra){ra=this._nodeId2Meta.get(ra);if(null!=ra?.attributeInfo)return ra.attributeInfo.loadedAttributes}getAttributeData(ra){ra=this._nodeId2Meta.get(ra);if(null!=ra?.attributeInfo)return ra.attributeInfo.attributeData}setAttributeData(ra,Fa){ra=this._nodeId2Meta.get(ra);
null!=ra?.attributeInfo&&(ra.attributeInfo.attributeData=Fa,this._attributeValuesChanged(ra))}async updateAttributes(ra,Fa,Ya){const bb=this._nodeId2Meta.get(ra);null!=bb&&(await this.i3sOverrides.applyAttributeOverrides(bb.featureIds,Fa,Ya,this._controller.requiredAttributes),bb.attributeInfo=Fa,this._controller.reschedule(()=>this._attributeValuesChanged(bb),Ya).catch(fb=>{w.isAbortError(fb)||f.getLogger("esri.views.3d.layers.I3SMeshView3D").warn("Error while updating attribute values. Layer might not display correctly.",
fb)}))}_attributeValuesChanged(ra){ra.cachedRendererVersion=this._getInvalidRendererVersion();ra.filteredIds=null;null!=this._labeler&&this._labeler.setNodeMetaAttributes(ra,(Fa,Ya)=>this._createAttributes(Fa,Ya));this._updateEngineObject(ra)}clearMemCache(){null!=this._memCache&&this._memCache.clear();this._addTasks.forEach(ra=>ra.allowMemCache=!1)}getVisibleNodes(){const ra=[];this._nodeId2Meta.forEach(Fa=>null!=Fa&&ra.push(Fa.node));return ra}getVisibleObbs(){const ra=[];this._nodeId2Meta.forEach(Fa=>
{null!=Fa&&(Fa=this.getNodeComponentObb(Fa.node),null!=Fa&&ra.push(Fa))});return ra}getNodeComponentObb(ra){ra=this._nodeId2Meta.get(ra.index)??this._nodeId2MetaReloading.get(ra.index);return null!=ra?this._collection.getComponentObb(ra.objectHandle):null}getLoadedNodeIndices(ra){this._nodeId2Meta.forEach((Fa,Ya)=>ra.push(Ya));this._nodeId2MetaReloading.forEach((Fa,Ya)=>ra.push(Ya))}_preLoadBasis(){!d("disable-feature:i3s-basis")&&0!==(this.supportedTextureEncodings&la.TextureEncoding.Basis)&&this.i3slayer.textureSetDefinitions?.some(ra=>
ra.formats.some(Fa=>"basis"===Fa.format||"ktx2"===Fa.format))&&nb.loadBasis()}_getVertexBufferLayout(ra,Fa){return Ra.glLayout(ca.createVertexBufferLayout(this._getGeometryParameters({hasTexture:Qa(ra.params.material),hasNormals:Fa.normal,hasRegions:Fa.uvRegion})))}_getObjectIdField(){return this.i3slayer.objectIdField||V.fallbackObjectIDAttribute}_getGlobalIdField(){return this.i3slayer.associatedLayer?.globalIdField}_findGraphicNodeAndIndex(ra){ra=$a.attributeLookup(this.i3slayer.fieldsIndex,ra.attributes,
this._getObjectIdField());for(const Fa of this._nodeId2Meta.values()){const Ya=Fa?.featureIds.indexOf(ra);if(null!=Ya&&0<=Ya)return{node:Fa.node,index:Ya}}return null}_getGraphicIndices(ra,Fa){ra=this._nodeId2Meta.get(ra.index);if(null==ra)return[];const Ya=[],bb=this._getObjectIdField(),fb=this.i3slayer.fieldsIndex;for(const kb of Fa)Fa=$a.attributeLookup(fb,kb.attributes,bb),Fa=ra.featureIds.indexOf(Fa),-1!==Fa&&Ya.push(Fa);return Ya}whenGraphicBounds(ra){ra=this._findGraphicNodeAndIndex(ra);if(!ra)return Promise.reject();
ra=this._getAABB(ra.node.index,ra.index);return null==ra?Promise.reject():Promise.resolve({boundingBox:ra,screenSpaceObjects:[]})}getAABBFromIntersectorTarget(ra){return null==ra.nodeIndex||null==ra.componentIndex?null:this._getAABB(ra.nodeIndex,ra.componentIndex)}_getAABB(ra,Fa){ra=this._nodeId2Meta.get(ra);if(null==ra?.featureIds||Fa>=ra.featureIds.length)return null;Fa=xa.boundingBoxCornerPoints(Fa,this._collection,ra.objectHandle,K.newDoubleArray(24),0);return J.projectBuffer(Fa,this.view.renderSpatialReference,
0,Fa,this.view.spatialReference,0)?Q.fromBuffer(Fa):null}whenGraphicAttributes(ra,Fa){return Ga.whenGraphicAttributes(this.i3slayer,ra,this._getObjectIdField(),Fa,()=>[...this._nodeId2Meta.values()].filter(e.isSome))}getGraphicFromIntersectorTarget(ra){if(null==ra.nodeIndex||null==ra.componentIndex)return null;const Fa=this._nodeId2Meta.get(ra.nodeIndex);return null==Fa?.featureIds||ra.componentIndex>=Fa.featureIds.length?null:this._createGraphic(ra.componentIndex,Fa)}_getCacheKey(ra){return`${this._layerUrl}/v${26}/${ra}${this._cacheKeySuffix}`}_getCacheKeySuffix(){const ra=
this.view.renderSpatialReference;return null==ra?"@null":ra===G.getSphericalPCPF(ra)?"@ECEF":this.i3slayer.spatialReference.equals(ra)?"":null!=ra.wkid?`@${ra.wkid}`:null}_getMemCacheKey(ra,Fa=this.elevationOffset){return ra+"#"+Fa}get _idbCacheEnabled(){return!this._controller.disableIDBCache&&!this.hasModifications&&0===this.elevationOffset&&null!=this._cacheKeySuffix}loadCachedGPUData(ra){return null!=this._memCache?this._memCache.pop(this._getMemCacheKey(ra)):null}deleteCachedGPUData(ra){null!=
ra&&this._deleteComponentObject(ra)}_cacheGPUData(ra,Fa=this.elevationOffset){if(null==this._memCache)this._deleteComponentObject(ra);else{var Ya=this._controller.indexDepth-ra.node.level;this._memCache.put(this._getMemCacheKey(ra.node.index,Fa),ra,ra.node.memory,Ya)}}loadMissingTextures(ra,Fa,Ya,bb){const fb=ra?.filter((kb,rb)=>{if(0===(kb.usage&this.rendererTextureUsage))return!1;if(null==Fa)return!0;kb=Ba.selectEncoding(kb.encodings,this.supportedTextureEncodings);rb=Fa[rb];return null==rb?.data||
kb&&rb.encoding!==kb.encoding?!0:!1})??[];return 0===fb.length?Promise.resolve(!1):Ya(fb,bb).then(kb=>{let rb=0;for(let vb=0;vb<ra.length;vb++)rb<kb.length&&kb[rb].id===ra[vb].id&&(Fa[vb]=kb[rb],rb++);return!0})}loadCachedNodeData(ra,Fa,Ya){return this._idbCacheEnabled?this._idbCache.get(this._getCacheKey(ra.id),Fa).then(bb=>{if(null==bb)return null;if(bb.nodeVersion!==ra.version)return this._idbCache.remove(this._getCacheKey(ra.id)),null;this.elevationInfo.mode===ja.ElevationMode.Absolute&&(ra.geometryObbInRenderSR=
za.Obb.fromData(bb.geometryObbData));return this.loadMissingTextures(bb.requiredTextures,bb.textureData,Ya,Fa).then(fb=>{fb&&this._idbCache.initialized&&null!=bb.textureData&&(bb.byteSize=lb(bb.transformedGeometry,bb.textureData),bb.textureData.every(db)&&ub(ra,bb)&&this._idbCache.put(this._getCacheKey(ra.id),bb).catch(kb=>f.getLogger("esri.views.3d.layers.I3SMeshView3D").warn(`Failed to update node with textures in IndexedDB cache: ${ra.id}: ${kb}`)));w.throwIfAborted(Fa);return bb})}):Promise.resolve(null)}addNode(ra,
Fa,Ya){return"geometryData"in Fa?null==Fa.geometryBuffer?(this._addNodeMeta(ra.index,null),Promise.resolve()):this._addData(ra,Fa.attributeDataInfo,()=>this._transformNode(ra,Fa,Ya).then(bb=>this._safeReschedule(()=>{if(null==bb)return ra.hasModifications=!1,this._addCachedNodeData(ra,null,Ya);ra.hasModifications=bb.transformedGeometry.hasModifications;const {obb:fb,componentOffsets:kb,featureIds:rb,anchorIds:vb,anchors:Ab,transformedGeometry:Bb,globalTrafo:Ib}=bb;var Jb=A.set(Eb,fb.center.x,fb.center.y,
fb.center.z);A.transformMat4(Jb,Jb,Ib);Jb=new za.Obb(Jb,[fb.extents.x,fb.extents.y,fb.extents.z],z.fromValues(fb.orientation.x,fb.orientation.y,fb.orientation.z,fb.orientation.w));this.elevationInfo.mode===ja.ElevationMode.Absolute&&(ra.geometryObbInRenderSR=Jb);Fa.geometryData.componentOffsets=kb;rb&&(Fa.geometryData.featureIds=Array.from(rb));Fa.geometryData.anchorIds=vb;Fa.geometryData.anchors=Ab;Jb={nodeVersion:ra.version,geometryData:Fa.geometryData,requiredTextures:Fa.requiredTextures,textureData:Fa.textureData,
transformedGeometry:Bb,globalTrafo:Ib,geometryObbData:Jb.data,byteSize:lb(Bb,Fa.textureData)};if(this._idbCacheEnabled&&this._idbCache.initialized&&ub(ra,Jb)){const Nb=null!=Jb.textureData?Jb.textureData.map(Qb=>db(Qb)?Qb:null):null;this._idbCache.put(this._getCacheKey(ra.id),{...Jb,textureData:Nb}).catch(Qb=>f.getLogger("esri.views.3d.layers.I3SMeshView3D").warn(`Failed to store node in IndexedDB cache: ${ra.id}: ${Qb}`))}return this._addCachedNodeData(ra,Jb,Ya)},Ya))):Promise.reject()}getElevationRange(ra){const Fa=
new Va.ElevationRange;var Ya=this._controller;const {index:bb}=Ya;if(!bb)return Fa;const {rootNode:fb}=bb;if(!fb)return Fa;const kb=this._nodeId2Meta,rb=ra[3],vb=Ya.viewportQueries,Ab=this._planetRadiusInGlobalMode;({view:Ya}=this);const {renderCoordsHelper:Bb}=Ya,Ib=Bb.referenceEllipsoid.radius,Jb=this._collection;bb.traverse(fb,Nb=>{const {childrenLoaded:Qb}=Nb;if(0===Qb)return!1;var wb=vb.getAndUpdateVisibilityObbInRenderSR(Nb),Cb=null;let Gb=-1;if(wb){if(Gb=wb.radius,!wb.intersectSphereWithMBS(ra,
Gb))return!1}else(Cb=vb.getServiceMbsInRenderSR(Nb))&&(Gb=Cb[3]);if(0<=Gb&&rb>=1*Gb)return null!=wb?Za(Fa,wb,Ab):null!=Cb&&0<=Cb[3]&&hb(Fa,Cb,Ab),!1;Tb.elevationRangeMin=Infinity;Tb.elevationRangeMax=-Infinity;if(null!=wb||null!=Cb)if(null!=wb?Za(Tb,wb,Ab):null!=Cb&&hb(Tb,Cb,Ab),Tb.elevationRangeMin>=Fa.elevationRangeMin&&Tb.elevationRangeMax<=Fa.elevationRangeMax)return!1;if(wb=kb.get(Nb.index))if({geometryObbInRenderSR:Nb}=Nb,!Nb||Nb.intersectSphereWithMBS(ra)){if(Nb&&rb>0*Nb.radius)return Za(Fa,
Nb,Ab),!1;({objectHandle:Nb}=wb);Cb=Jb.getObjectTransform(Nb);Cb=Bb.getAltitude(Cb.position);Jb.expandRangeWithComponentObjectElevationRange(Nb,Cb,Ib,Fa)}return 0<Qb-(wb?1:0)});return Fa}computeVisibilityObb(ra){return Ga.computeVisibilityObb(ra,this.view.renderSpatialReference,this._controller.crsIndex,this.i3slayer.spatialReference,this.elevationOffset,this._modifications,this.view.renderCoordsHelper.sphericalPCPF)}_transformNode(ra,Fa,Ya){var bb=Fa.geometryData.geometries??[];const fb=Array(bb.length);
for(var kb=0;kb<bb.length;++kb)fb[kb]=this._getVertexBufferLayout(bb[kb],Fa.geometryDescriptor);bb=this.i3slayer.normalReferenceFrame;bb=Fa.normalReferenceFrame??bb??"none";kb=ra.serviceMbsInIndexSR;const rb=this.elevationOffset;var vb=this._controller.crsIndex,Ab=this._controller.crsVertex;const Bb=this.view.renderSpatialReference,Ib=Ha.computeGlobalTransformation(kb,rb,bb,vb,Bb);vb=N.getProjectorName(vb,Ab);Ab=N.getProjectorName(Ab,Bb);return null==vb||null==Ab?Promise.resolve(null):this._worker.invoke({context:this.uid,
geometryBuffer:Fa.geometryBuffer,geometryData:Fa.geometryData,geometryDescriptor:Fa.geometryDescriptor,layouts:fb,globalTrafo:Ib,mbs:kb,obbData:ra.serviceObbInIndexSR?.data,elevationOffset:rb,needNormals:this._controller.isMeshPyramid,normalReferenceFrame:bb,indexToVertexProjector:vb,vertexToRenderProjector:Ab},Ya)}get _supportsNodeCrossFading(){return!this.view?._stage?.renderer.shadowsEnabled}get nodeCrossfadingEnabled(){return this._supportsNodeCrossFading&&(0<this.lodCrossfadeinDuration||0<this.lodCrossfadeoutDuration||
0<this.lodCrossfadeUncoveredDuration)}get nodeFadeoutEnabled(){return this._supportsNodeCrossFading&&0<this.lodCrossfadeoutDuration}_setNewNodeOpacity(ra){this._setNodeOpacity(ra,this.nodeCrossfadingEnabled?0:this.fullOpacity)}addCachedGPUData(ra,Fa,Ya){this.elevationInfo.mode===ja.ElevationMode.Absolute&&(ra.geometryObbInRenderSR=this._collection.getComponentObb(Fa.objectHandle).clone());this._controller.isGeometryVisible(ra)?(null!=this._labeler&&this._addMetaToLabeler(this._labeler,Fa),ra=ra.index,
this._addNodeMeta(ra,Fa),this.updateNodeState(ra,Ya),this._collection.setObjectVisibility(Fa.objectHandle,!0),this._updateMaterial(Fa),this._setNewNodeOpacity(Fa),this.elevationInfo.mode!==ja.ElevationMode.Absolute&&this._ensureElevationTask().schedule(ra),this._updateEngineObject(Fa),this._highlights.objectCreated(Fa),null!=this._treeDebugger&&this._treeDebugger.update()):this._cacheGPUData(Fa)}addCachedNodeData(ra,Fa,Ya,bb){return this._addData(ra,Ya,()=>this._addCachedNodeData(ra,Fa,bb))}async deleteCachedNodeData(ra){if(this._idbCacheEnabled)return this._idbCache.remove(this._getCacheKey(ra))}async _addCachedNodeData(ra,
Fa,Ya){if(this.contentVisible&&this._controller.isGeometryVisible(ra))if(null==Fa)this._addNodeMeta(ra.index,null);else{var bb=this._addTasks.get(ra.index),{geometryData:fb,transformedGeometry:kb,globalTrafo:rb}=Fa;await this.i3sOverrides.applyAttributeOverrides(fb.featureIds,bb.attributeInfo,Ya,this._controller.requiredAttributes);var vb=null!=Fa.textureData?Fa.textureData.filter(Rb=>null!=Rb&&0!==(Rb.usage&this.rendererTextureUsage)):[];!d("disable-feature:i3s-basis")&&vb.some(Rb=>null!=Rb&&(Rb.encoding===
la.TextureEncoding.Basis||Rb.encoding===la.TextureEncoding.KTX2))&&await nb.loadBasis();ra.memory=0;var {componentOffsets:Ab,geometries:Bb,featureIds:Ib,anchorIds:Jb,anchors:Nb}=fb,Qb=this._collection,wb=Bb[0],{layout:Cb,indices:Gb,interleavedVertexData:Vb,positionData:ac,hasColors:bc}=kb,{material:Xb,geometryParameters:ec}=this._materialParameters(wb,Cb),Yb=Ab||new Uint32Array([0,Gb?Gb.length:Vb.byteLength/Cb[0].stride]);Yb={vertices:{data:Vb,count:Vb.byteLength/Cb[0].stride,layoutParameters:ec},
positionData:{positions:L.compactFloatArray(ac.data),indices:P.compactIndices(ac.indices)},indices:Gb,componentOffsets:Yb};var Lb=wb.transformation?B.clone(wb.transformation):B.create();y.multiply(Lb,rb,Lb);wb=y.getTranslation(C.create(),Lb);Lb=r.fromMat4(v.create(),Lb);var cc=this.view.renderSpatialReference,$b=this.view.basemapTerrain.spatialReference,Kb=za.Obb.fromData(Fa.geometryObbData).center,Ub=[1,1,1];D.localLinearScaleFactors(Kb,cc,Ub,$b)||f.getLogger("esri.views.3d.layers.I3SMeshView3D").errorOnce("Unsupported coordinate system for IM overlay");
var kc=C.create();M.projectVectorToVector(Kb,cc,kc,$b);cc=v.create();r.invert(cc,Lb);$b=C.create();A.transformMat3($b,A.sub($b,Kb,wb),cc);var xc=Qb.createObject(new Pa.ObjectParameters(E.fromValues(kc[0]-$b[0]*Ub[0],kc[1]-$b[1]*Ub[1],Ub[0],Ub[1]),new cb.Transform(wb,Lb),za.Obb.fromData(Fa.geometryObbData),Yb)),{textures:sc,texturePromise:tc}=this._initMaterialAndTextures(xc,Xb,vb,ec.textureCoordinates===ib.TextureCoordinateType.Atlas);ra.memory+=this._memEstimateGeometryAdded(xc);ra.memory+=sc.reduce((Rb,
jc)=>Rb+(null!=jc?this._memEstimateTextureAdded(jc):0),0);vb=!!Xb.hasParametersFromSource;Yb="blend"!==Xb.alphaMode&&1<=Xb.metallicRoughness.baseColorFactor[3];var dc=new ob(ra,Ib,xc,this._getInvalidRendererVersion(),bb.attributeInfo,{hasParametersFromSource:vb,isOpaque:Yb},sc,Jb,Nb);bb.meta=dc;!this._hasTextures&&Fa.requiredTextures?.some(({usage:Rb})=>0!==(Rb&la.TextureUsage.ColorTextures))&&(this._hasTextures=!0);this._hasData=!0;this._hasColors=this._hasColors||bc;this._hasTextures=this._hasTextures||
!!ra.resources.texture;this.notifyChange("hasTexturesOrVertexColors");var uc=this.slicePlaneEnabled;return Promise.all([this._addOrUpdateEdgeRendering(dc),tc]).then(([Rb])=>{this._addTasks.has(ra.index)&&Rb?.updateObjectVisibility(dc.objectHandle,!1).catch(jc=>Ea(jc,this.i3slayer.title));return this._safeReschedule(()=>{var jc=this._addTasks.get(ra.index);if(jc)if(this._addNodeMeta(ra.index,dc),jc.meta=null,this.contentVisible){Qb.setObjectVisibility(xc,!0);Rb?.updateObjectVisibility(dc.objectHandle,
!0).catch(Hc=>Ea(Hc,this.i3slayer.title));dc.attributeInfo=jc.attributeInfo;jc=dc.cachedRendererVersion!==this._rendererVersion;var vc=uc!==this.slicePlaneEnabled;this._updateElevationOffsets(dc);var zc=dc.elevationOffsets;this._updateComponentData(dc);var wc=this._applyFiltersToNode(dc);(jc||null!=Rb&&(vc||wc||zc))&&this._addOrUpdateEdgeRendering(dc);null!=this._labeler&&this._addMetaToLabeler(this._labeler,dc);this._visibleGeometryChanged(dc,ua.ADD);this._highlights.objectCreated(dc);this._updateMaterial(dc);
this._setNewNodeOpacity(dc);null!=this._treeDebugger&&this._treeDebugger.update()}else this._removeNodeStageData(ra.index,this.elevationOffset)},Ya)}).catch(Rb=>{const {meta:jc,allowMemCache:vc}=bb;bb.meta=null;jc&&vc?this._cacheGPUData(jc):jc&&this._deleteComponentObject(jc);throw Rb;})}else this._removeNodeStageData(ra.index,this.elevationOffset,this._nodeId2MetaReloading)}_addNodeMeta(ra,Fa){this._removeNodeStageData(ra,this.elevationOffset,this._nodeId2MetaReloading);if(this._nodeId2Meta.has(ra)){f.getLogger("esri.views.3d.layers.I3SMeshView3D").error("Removing duplicated node");
const Ya=this._nodeId2Meta.get(ra);null!=Ya&&this._deleteComponentObject(Ya)}else this._controller.updateLoadStatus(ra,!0);null!=Fa&&(Fa.lodCrossfadeProgress=null,this.nodeCrossfadingEnabled&&Xa(Fa.cachedEdgeMaterials,0));this._nodeId2Meta.set(ra,Fa);this.notifyChange("elevationRange")}_updateElevationOffsets(ra){const Fa=this.view.renderSpatialReference,Ya=this._controller.crsIndex,bb=this.elevationInfo,fb=this.view.basemapTerrain,kb=fb.spatialReference,rb=bb.mode;if(null==Fa||null==kb||rb===ja.ElevationMode.Absolute)ra.elevationOffsets=
null;else{var vb=this._collection.getObjectTransform(ra.objectHandle);ra.elevationOffsets=ra.elevationOffsets??[];var Ab=rb===ja.ElevationMode.OnTheGround,Bb=this.view.renderCoordsHelper,Ib=ra.featureIds.length,Jb=(()=>{if(ra.cachedElevationAnchors)return ra.cachedElevationAnchors;const wb=K.newDoubleArray(3*Ib);ra.cachedElevationAnchors=wb;for(let Cb=0;Cb<Ib;Cb++){const Gb=3*Cb,Vb=ra.anchorIds?.indexOf(Cb)??-1;ra.anchors&&0<=Vb?(A.set(Eb,ra.anchors[3*Vb],ra.anchors[3*Vb+1],ra.anchors[3*Vb+2]),A.add(Eb,
Eb,R.getCenter(ra.node.serviceMbsInIndexSR)),M.projectVectorToVector(Eb,Ya,Eb,kb),wb[Gb]=Eb[0],wb[Gb+1]=Eb[1],wb[Gb+2]=Bb.getAltitude(Eb)):(this._collection.getComponentAabb(ra.objectHandle,Cb,Ob,!0),A.set(Eb,(Ob[0]+Ob[3])/2,(Ob[1]+Ob[4])/2,Ob[2]),A.transformMat3(Eb,Eb,vb.rotationScale),A.add(Eb,Eb,vb.position),wb[Gb+2]=Bb.getAltitude(Eb),M.projectVectorToVector(Eb,Fa,Eb,kb),wb[Gb]=Eb[0],wb[Gb+1]=Eb[1])}return wb})(),Nb=bb.offset,Qb=ra.elevationOffsets;fb.getElevations(Jb,Ib,(wb,Cb)=>{const Gb=Ab?
Jb[3*wb+2]:0;Qb[wb]=Nb+(null!=Cb?Cb-Gb:0)})}}_ensureElevationTask(){return null!=this._elevationTask?this._elevationTask:this._elevationTask=new qa.I3SAsyncElevationUpdater(this.view.resourceController.scheduler,ra=>{ra=this._controller.updateElevationChanged(ra,this.view.basemapTerrain.spatialReference);return null!=ra?ra.filterInPlace(Fa=>null!=this._nodeId2Meta.get(Fa)):null},ra=>{ra=this._nodeId2Meta.get(ra);this._nodeElevationAlignmentChanged(ra)},()=>this.elevationInfo?.mode)}_elevationInfoChanged(ra,
Fa){const Ya=ra.mode!==ja.ElevationMode.Absolute;ra=!!Fa&&Fa!==ra&&Fa.mode!==ja.ElevationMode.Absolute;this._intersectionHandler.updateElevationAlignState(Ya,this.view.state.viewingMode);Ya&&!ra&&this._controller.removeAllGeometryObbs();this._nodeId2Meta.forEach(bb=>this._nodeElevationAlignmentChanged(bb))}_nodeElevationAlignmentChanged(ra){null!=ra&&(this._updateElevationOffsets(ra),this._updateComponentData(ra),this._updateEdgeRendering(ra),null!=this._labeler&&this._labeler.updateLabelPositions(ra),
this._updateSnappingSources(ra,ua.UPDATE))}_safeReschedule(ra,Fa){w.throwIfAborted(Fa);return this._controller.reschedule(ra,Fa)}_materialParameters(ra,Fa){ra=null!=ra.params.material?ra.params.material:Ba.defaultMaterial();const Ya=Fa.some(fb=>"uvRegion"===fb.name);Fa=Fa.some(fb=>"normalCompressed"===fb.name);const bb=Qa(ra);return{geometryParameters:this._getGeometryParameters({hasTexture:bb,hasNormals:Fa,hasRegions:Ya}),material:ra}}_initMaterialAndTextures(ra,Fa,Ya,bb){const fb=this._stage.renderView,
kb=Ya.map(vb=>Ba.createTexture(vb,Fa,bb,fb));this._stage.addMany(kb);let rb=null;this._collection.updateMaterial(ra,vb=>{rb=Ba.configureMaterial(vb,Fa,kb,Ya,this.view._stage.renderView.textures,{rendererTextureUsage:this.rendererTextureUsage,usePBR:this._usePBR,isIntegratedMesh:this._isIntegratedMesh,slicePlaneEnabled:this.slicePlaneEnabled,viewSpatialReference:this.view.spatialReference});this._updateMaterialOverlay(vb)});return{textures:kb,texturePromise:rb}}_getGeometryParameters(ra){return new ca.GeometryParameters(this._hasVertexColors,
ra.hasTexture?ra.hasRegions?ib.TextureCoordinateType.Atlas:ib.TextureCoordinateType.Default:ib.TextureCoordinateType.None,ra.hasNormals,this._shadeNormals,this._applySSAO)}_addData(ra,Fa,Ya){let bb=this._addTasks.get(ra.index);if(bb)bb.attributeInfo=Fa;else{const fb=w.createResolver();bb=new Mb(Fa,null,fb.promise);this._addTasks.set(ra.index,bb);Ya().then(fb.resolve,fb.reject).then(()=>this._addTasks.delete(ra.index)).catch(kb=>{this._addTasks.delete(ra.index);throw kb;})}return bb.promise}_clearAddTasks(){this._addTasks.forEach(ra=>
{null!=ra.meta&&(this._cacheGPUData(ra.meta),ra.meta=null)});this._addTasks.clear()}_clippingAreaChanged(){var ra=this.view.renderSpatialReference;const Fa=this.i3slayer.spatialReference,Ya=O.create();this._renderClippingArea=ma.toBoundingRect(this.view.clippingArea,Ya,ra)?Ya:null;ra=O.create();this._layerClippingArea=ma.toBoundingRect(this.view.clippingArea,ra,Fa)?ra:null;this._filterChange();this._controller&&this._controller.updateClippingArea(this.view.clippingArea);this._isIntegratedMesh&&this._modificationsChanged()}get hasGeometryFilter(){return!1}_geometryFilterChange(){const ra=
this.hasGeometryFilter;this._controller.geometryFilterChanged(ra);this._applyFilters(ra)}_filterChange(){this._applyFilters(this.hasGeometryFilter)}_applyFilters(ra){this._filters=this.getFilters();ra?this._controller&&this._controller.requestUpdate():this._nodeId2Meta.forEach(Fa=>{null!=Fa&&this._applyFiltersToNode(Fa)&&(this._addOrUpdateEdgeRendering(Fa),this._visibleGeometryChanged(Fa,ua.UPDATE))})}getFilters(){const ra=[],Fa=this._renderClippingArea;null!=Fa&&ra.push((Ya,bb)=>this._boundingRectFilter(Ya,
bb,Fa));return ra}addSqlFilter(ra,Fa,Ya){if(null!=Fa){const bb=Fa.fieldNames;ra.push((fb,kb)=>this._sqlFilter(fb,kb,Fa,bb,Ya))}}_sqlFilter(ra,Fa,Ya,bb,fb){const kb={},rb=this._createLayerGraphic(kb),vb=this.i3slayer.objectIdField,Ab=Fa.featureIds,Bb=Fa.attributeInfo?.attributeData;bb.every(Ib=>Ib===vb||null!=Bb?.[Ib])&&Ga.filterInPlace(ra,Ab,Ib=>{kb[vb]=Ab[Ib];for(const Jb of bb)Jb!==vb&&(kb[Jb]=Bb?Ga.getCachedAttributeValue(Bb[Jb],Ib):null);try{return Ya.testFeature(rb)}catch(Jb){return fb(Jb),!1}})}_boundingRectNodeTest(ra,
Fa){I.projectBoundingSphere(ra.node.serviceMbsInIndexSR,this._controller.crsIndex,Sb,this.view.renderSpatialReference);return Ga.intersectBoundingRectWithMbs(Fa,Sb)}_boundingRectFeatureTest(ra,Fa,Ya){this._collection.getComponentAabb(ra.objectHandle,Fa,Ma);Q.toRect(Ma,ab);return O.intersects(Ya,ab)}_boundingRectFilter(ra,Fa,Ya){var bb=this._collection;const fb=this._boundingRectNodeTest(Fa,Ya);if(fb!==Ga.MbsIntersectResult.INSIDE)if(fb===Ga.MbsIntersectResult.OUTSIDE)ra.length=0;else if(bb=bb.getComponentCount(Fa.objectHandle),
bb.invisible+bb.visible===Fa.featureIds.length){var kb=this._transformClippingArea(qb,Ya,Fa.objectHandle);Ga.filterInPlace(ra,Fa.featureIds,rb=>this._boundingRectFeatureTest(Fa,rb,kb))}}_transformClippingArea(ra,Fa,Ya){var bb=this._collection.getObjectTransform(Ya);Ya=bb.position;bb=bb.rotationScale;ra[0]=(Fa[0]-Ya[0])/bb[0];ra[1]=(Fa[1]-Ya[1])/bb[4];ra[2]=(Fa[2]-Ya[0])/bb[0];ra[3]=(Fa[3]-Ya[1])/bb[4];return ra}async _addOrUpdateEdgeRendering(ra,Fa=!0){const Ya=ra.objectHandle,{hasEdges:bb,perFeatureEdgeMaterials:fb}=
this._getFilteredEdgeMaterials(ra);bb&&!this._edgeView&&(this._edgeView=await this._stage.renderer.loadEdgeView());const kb=this._edgeView;if(!kb)return null;var rb=kb.hasObject(Ya);if(bb){if(rb)return this.nodeCrossfadingEnabled&&(rb=this.getNodeOpacity(ra),Xa(fb,rb)),kb.updateAllComponentMaterials(Ya,fb,this.slicePlaneEnabled,Fa).catch(vb=>Ea(vb,this.i3slayer.title)),kb.updateObjectVisibility(Ya,!0).catch(vb=>Ea(vb,this.i3slayer.title)),kb.updateAllVerticalOffsets(Ya,ra.elevationOffsets).catch(vb=>
Ea(vb,this.i3slayer.title)),kb;Fa=await this._collection.addEdges(Ya,kb,fb,this.slicePlaneEnabled,ra.elevationOffsets);ra.edgeMemoryUsage=Fa;ra.node.memory+=Fa;return kb}rb&&(ra.node.memory-=ra.edgeMemoryUsage,ra.edgeMemoryUsage=0,kb.removeObject(Ya));return null}_applyFiltersToNode(ra){return this._applyFiltersToNodeComponents(ra)?(null!=this._labeler&&this._labeler.applyFilterChange(ra),!0):!1}_applyFiltersToNodeComponents(ra){const Fa=this._collection;var Ya=Fa.getComponentCount(ra.objectHandle),
bb=null!=ra.filteredIds;Ya=0===Ya.invisible;Fa.setAllComponentVisibilities(ra.objectHandle,"all");if(0===this._filters.length)return ra.filteredIds=null,!Ya;this._updateCachedFilteredIds(ra);if(bb&&ra.filteredIds===ra.featureIds)return!Ya;bb=this._computeFilteredComponentIndices(ra);Fa.setAllComponentVisibilities(ra.objectHandle,bb);return!0}_updateCachedFilteredIds(ra){if(null==ra.filteredIds||ra.appliedFilters!==this._filters)ra.filteredIds=this._computeFilteredIds(ra),ra.appliedFilters=this._filters}_computeFilteredIds(ra){const Fa=
ra.featureIds.slice();for(const Ya of this._filters)if(Ya(Fa,ra),0===Fa.length)break;return Fa.length===ra.featureIds.length?ra.featureIds:Fa}_computeFilteredComponentIndices(ra){const Fa=[],Ya=ra.filteredIds;null!=Ya&&ra.featureIds.forEach((bb,fb)=>{Ya[Fa.length]===bb&&Fa.push(fb)});return Fa}_removeAllNodeDataFromStage(ra=this.elevationOffset){this._nodeId2Meta.forEach((Fa,Ya)=>this._removeNodeStageData(Ya,ra));this._nodeId2MetaReloading.forEach((Fa,Ya)=>this._removeNodeStageData(Ya,ra,this._nodeId2MetaReloading));
this._elevationTask=c.destroyMaybe(this._elevationTask)}removeNode(ra){const Fa=this.elevationOffset;this._removeNodeStageData(ra,Fa);this._removeNodeStageData(ra,Fa,this._nodeId2MetaReloading);null!=this._elevationTask&&this._elevationTask.remove(ra)}_removeNodeStageData(ra,Fa,Ya=this._nodeId2Meta){Ya.has(ra)&&this._controller.updateLoadStatus(ra,!1);const bb=Ya.get(ra);null==bb?Ya.delete(ra):(this._collection.setObjectVisibility(bb.objectHandle,!1),null!=this._edgeView&&this._edgeView.hasObject(bb.objectHandle)&&
this._edgeView.updateObjectVisibility(bb.objectHandle,!1).catch(fb=>Ea(fb,this.i3slayer.title)),this._visibleGeometryChanged(bb,ua.REMOVE),null!=this._labeler&&this._labeler.removeNodeMeta(bb),Ya.delete(ra),this._highlights.objectDeleted(bb),Ya===this._nodeId2Meta?(this._cacheGPUData(bb,Fa),this.nodeCrossfadingEnabled&&this._crossfadeHelper.stopNodeFading(bb)):this._deleteComponentObject(bb),null!=this._treeDebugger&&this._treeDebugger.update())}_deleteComponentObject(ra){null!=this._edgeView&&this._edgeView.removeObject(ra.objectHandle);
this._memEstimateGeometryRemoved(ra.objectHandle);this._collection.destroyObject(ra.objectHandle);if(ra.textures)for(const Fa of ra.textures)this._memEstimateTextureRemoved(Fa),this._stage.remove(Fa)}updateNodeState(ra,Fa){ra=this._nodeId2Meta.get(ra);null!=ra&&this._collection.updateMaterial(ra.objectHandle,Ya=>Ya.polygonOffsetEnabled=Fa===Ia.NodeState.Hole)}updateNodeIndex(ra,Fa){if(this._nodeId2Meta.has(ra)){var Ya=this._nodeId2Meta.get(ra);this._nodeId2Meta.delete(ra);this._nodeId2Meta.set(Fa,
Ya);this.notifyChange("elevationRange")}if(Ya=this._nodeId2MetaReloading.get(ra))this._nodeId2MetaReloading.delete(ra),this._nodeId2MetaReloading.set(Fa,Ya)}_invalidateAllSymbols(){this._rendererVersion=Ga.addWraparound(this._rendererVersion,1);this._controller&&this._controller.requestUpdate()}_getInvalidRendererVersion(){return Ga.addWraparound(this._rendererVersion,-1)}async _rendererChange(ra){this._currentRenderer=ra;this.notifyChange("rendererTextureUsage");this._rendererVersion=Ga.addWraparound(this._rendererVersion,
1);this._opacityVariable=this._colorVariable=this._rendererFields=null;this._invalidateAllSymbols();ra&&(this._rendererFields=await ra.getRequiredFields(this.i3slayer.fieldsIndex));this._updateSymbologyFields();!this._arcade&&ra&&"arcadeRequired"in ra&&ra.arcadeRequired&&(this._arcade=await ha.loadArcade());if(ra&&"visualVariables"in ra&&ra.visualVariables)for(const Fa of ra.visualVariables)"color"===Fa.type?this._colorVariable=Fa:"opacity"===Fa.type?this._opacityVariable=Fa:f.getLogger("esri.views.3d.layers.I3SMeshView3D").warn(`Unsupported visual variable type for 3D Object Scene Services: ${Fa.type}`);
if(ra)for(const Fa of ra.getSymbols())"mesh-3d"!==Fa.type&&f.getLogger("esri.views.3d.layers.I3SMeshView3D").error(`Symbols of type '${Fa.type}' are not supported for 3D Object Scene Services.`);this._controller&&this._controller.requestUpdate()}_getCachedEdgeMaterials(ra){this._hasComponentData&&ra.cachedRendererVersion!==this._rendererVersion&&this._updateCachedRendererData(ra);return ra.cachedEdgeMaterials}_getComponentParameters(ra){this._hasComponentData&&ra.cachedRendererVersion!==this._rendererVersion&&
this._updateCachedRendererData(ra);const Fa=ra.cachedSymbology;return(Ya,bb)=>{const fb=5*Ya;H.set(bb.externalColor,Fa[fb]/255,Fa[fb+1]/255,Fa[fb+2]/255,Fa[fb+3]/255);const kb=this._stage.renderView.olidRenderHelper;if(kb){const rb=ra.featureIds[Ya],vb=T.isBasemapLayer(this.view.map,this.layerUid);kb.setUidToObjectAndLayerId(rb,rb,this.layerId,this.layerUid+"_"+this.sublayerId,this.layerPopupEnabledAndHasTemplate&&!vb,ra.node.resources.attributes,Ya,this.sublayerId);bb.objectAndLayerIdColor=this._stage.renderView.getObjectAndLayerIdColor({graphicUid:rb,
layerUid:this.layerUid+"_"+this.sublayerId})}bb.externalColorMixMode=Fa[fb+4]&(1<<zb.CastShadows)-1;bb.castShadows=0!==(Fa[fb+4]&1<<zb.CastShadows);bb.pickable=0!==(Fa[fb+4]&1<<zb.Pickable);bb.elevationOffset=ra.elevationOffsets?.[Ya]??0}}_getSymbolInfo(ra,Fa){Fa=ra?.getSymbol(Fa,{arcade:this._arcade});if(!(Fa instanceof Z))return null;ra=Fa.id;if(this._symbolInfos.has(ra))return this._symbolInfos.get(ra);Fa=Ga.getSymbolInfo(Fa);this._symbolInfos.set(ra,Fa);return Fa}_setSymbologyOverride(ra,Fa){this._symbologyOverride!==
ra&&(this._symbologyOverride=ra,this._symbologyOverrideFields=Fa,this._invalidateAllSymbols(),this._updateSymbologyFields())}_updateSymbologyFields(){this._symbologyFields=null!=this._symbologyOverrideFields&&0<this._symbologyOverrideFields.length?null!=this._rendererFields&&0<this._rendererFields.length?U.fixFields(this.i3slayer.fieldsIndex,[...this._rendererFields,...this._symbologyOverrideFields]):this._symbologyOverrideFields:this._rendererFields}_updateCachedRendererData(ra){ra.cachedRendererVersion=
this._rendererVersion;if(this._hasComponentData){var Fa=this._tmpAttributeOnlyGraphic,Ya={};Fa.attributes=Ya;var bb=this._currentRenderer,fb=ra.attributeInfo?.attributeData,kb=null!=ra.featureIds?this.i3slayer.objectIdField:null,rb=null!=fb&&null!=this._symbologyFields&&0<this._symbologyFields.length,vb=null,Ab=null;if(rb&&null!=this._symbologyFields){vb=[];Ab=[];for(var Bb of this._symbologyFields){var Ib=fb[Bb];Ib&&(vb.push(Bb),Ab.push(Ib))}}ra.cachedSymbology||(ra.cachedSymbology=W.newUByteArray(5*
ra.featureIds.length));fb={color:yb,castShadows:!0,pickable:!0,colorMixMode:Da.ColorMixModeEnum.Multiply,edgeMaterial:null};Bb=this.fullOpacity;Bb=this.nodeCrossfadingEnabled?this.getNodeOpacity(ra):Bb;Ib=null;var Jb=xb.Transparency.OPAQUE,Nb=Ga.transparentEdgeMaterial,Qb=0;for(let Vb=0;Vb<ra.featureIds.length;Vb++){null!=kb&&(Ya[kb]=ra.featureIds[Vb]);if(rb&&vb)for(var wb=0;wb<vb.length;wb++)Ya[vb[wb]]=Ga.getCachedAttributeValue(Ab[wb],Vb);var Cb=bb?this._getSymbolInfo(bb,Fa):null;let ac=wb=null;
if(bb&&"visualVariables"in bb){if(this._colorVariable){var Gb=fa.getColor(this._colorVariable,Fa,{color:Fb,arcade:this._arcade});Gb&&(wb=yb,wb[0]=Gb.r/255,wb[1]=Gb.g/255,wb[2]=Gb.b/255,this._opacityVariable||null===Gb.a||(ac=Gb.a))}this._opacityVariable&&(ac=fa.getOpacity(this._opacityVariable,Fa,{arcade:this._arcade}))}Cb?.material&&(Gb=Cb.material,wb=null==wb||null==ac?aa.overrideColor(wb,ac,Gb.color,Gb.alpha,jb,yb):aa.overrideColor(wb,ac,null,null,jb,yb));null==wb&&(wb=yb,wb[0]=1,wb[1]=1,wb[2]=
1,wb[3]=1);fb.pickable=!0;fb.castShadows=Cb?Cb.castShadows:!0;fb.colorMixMode=Cb?.material?Cb.material.colorMixMode:Da.ColorMixModeEnum.Multiply;fb.edgeMaterial=Cb?Cb.edgeMaterial:null;null!=this._symbologyOverride&&(fb.color=wb,this._symbologyOverride(Fa,fb),wb=fb.color);null!=this._nodeColorOverride&&(this._nodeColorOverride(ra.node,wb),fb.colorMixMode=Da.ColorMixModeEnum.Replace);if(null!=fb.edgeMaterial){Cb=1<=wb[3]&&(ra.material.isOpaque||fb.colorMixMode===Da.ColorMixModeEnum.Replace)?xb.Transparency.OPAQUE:
xb.Transparency.TRANSPARENT;if(fb.edgeMaterial!==Ib||Cb!==Jb)Nb={...fb.edgeMaterial,opacity:Bb,objectTransparency:Cb},Ib=fb.edgeMaterial,Jb=Cb;ra.cachedEdgeMaterials[Vb]=Nb}else ra.cachedEdgeMaterials[Vb]=Ga.transparentEdgeMaterial;ra.cachedSymbology[Qb++]=Math.round(255*wb[0]);ra.cachedSymbology[Qb++]=Math.round(255*wb[1]);ra.cachedSymbology[Qb++]=Math.round(255*wb[2]);ra.cachedSymbology[Qb++]=Math.round(255*wb[3]);ra.cachedSymbology[Qb++]=fb.colorMixMode|+fb.castShadows<<zb.CastShadows|+fb.pickable<<
zb.Pickable}}}_getFilteredEdgeMaterials(ra){var Fa=this._getCachedEdgeMaterials(ra);this.nodeCrossfadingEnabled||Xa(Fa,this.fullOpacity);const Ya=ra.filteredIds;if(null==Ya)return{hasEdges:Fa.some(kb=>kb!==Ga.transparentEdgeMaterial),perFeatureEdgeMaterials:Fa};let bb=0,fb=!1;Fa=Fa.map((kb,rb)=>{if(ra.featureIds[rb]!==Ya[bb])return Ga.transparentEdgeMaterial;fb=fb||kb!==Ga.transparentEdgeMaterial;bb++;return kb});return{hasEdges:fb,perFeatureEdgeMaterials:Fa}}_updateComponentData(ra){if(this._hasComponentData){var Fa=
ra.objectHandle;ra=this._getComponentParameters(ra);this._collection.setComponentData(Fa,ra);this._stage.renderView.requestRender()}}_reloadAll(ra=this.elevationOffset){this._removeAllNodeDataFromStage(ra);null!=this._controller&&this._controller.restartNodeLoading()}_opacityChange(ra){this.nodeCrossfadingEnabled&&this._crossfadeHelper.stopAllNodeFading();this._nodeId2Meta.forEach(Fa=>{null!=Fa&&(this._collection.updateMaterial(Fa.objectHandle,Ya=>Ya.objectOpacity=ra),Xa(Fa.cachedEdgeMaterials,ra),
this._updateEdgeRendering(Fa))})}_updateMaterial(ra){this._collection.updateMaterial(ra.objectHandle,Fa=>{Fa.commonMaterialParameters.hasSlicePlane=this.slicePlaneEnabled;Fa.usePBR=this._usePBR;this._updateMaterialOverlay(Fa)})}_updateMaterialOverlay(ra){}_updateEngineObject(ra){this._updateComponentData(ra);this._applyFiltersToNode(ra);this._addOrUpdateEdgeRendering(ra);this._visibleGeometryChanged(ra,ua.UPDATE)}_slicePlaneEnabledChange(ra){this._intersectionHandler&&(this._intersectionHandler.slicePlaneEnabled=
ra);null!=this._labeler&&(this._labeler.slicePlaneEnabled=ra);this._nodeId2Meta.forEach(Fa=>{null!=Fa&&(this._collection.updateMaterial(Fa.objectHandle,Ya=>Ya.commonMaterialParameters.hasSlicePlane=ra),this._updateEdgeRendering(Fa,!1))})}_updatePBR(ra){this._nodeId2Meta.forEach(Fa=>{null!=Fa&&this._collection.updateMaterial(Fa.objectHandle,Ya=>Ya.usePBR=ra)});this._hasLoadedPBRTextures=!0}get _usePBR(){return this._shadeNormals&&this.view.qualitySettings.physicallyBasedRenderingEnabled}_updateEdgeRendering(ra,
Fa=!0){null!=this._edgeView&&this._edgeView.hasObject(ra.objectHandle)&&this._addOrUpdateEdgeRendering(ra,Fa)}_forAllNodes(ra){this._nodeId2Meta.forEach(ra)}_ignoreClientNodeOverriddenFeatures(ra){return this.i3sOverrides.hasGeometryChanges?(Fa,Ya,bb)=>0<=bb.node.index&&this.i3sOverrides.featureHasGeometryChanges(Fa)?ja.ForAllFeaturesReturnType.CONTINUE:ra(Fa,Ya,bb):ra}_forAllFeatures(ra,Fa,Ya){for(const bb of this._nodeId2Meta.values()){if(null==bb)continue;if(null!=Fa)switch(Fa(bb)){case ja.ForAllFeaturesReturnType.EXIT:return;
case ja.ForAllFeaturesReturnType.SKIP:continue}let fb=ja.ForAllFeaturesReturnType.CONTINUE;switch(Ya){case ja.ForAllFeaturesMode.ALL:fb=this._forAllFeaturesOfNode(bb,ra);break;case ja.ForAllFeaturesMode.VISIBLE_ONLY:fb=this._forAllVisibleFeaturesOfNode(bb,ra);break;case ja.ForAllFeaturesMode.QUERYABLE:fb=this._forAllQueryableFeaturesOfNode(bb,ra)}if(fb===ja.ForAllFeaturesReturnType.EXIT)break}}_forAllFeaturesOfNode(ra,Fa){let Ya=ja.ForAllFeaturesReturnType.CONTINUE;const bb=ra.featureIds;for(let fb=
0;fb<bb.length&&(Ya=Fa(bb[fb],fb,ra),Ya!==ja.ForAllFeaturesReturnType.EXIT);fb++);return Ya}_forAllVisibleFeaturesOfNode(ra,Fa){let Ya=ja.ForAllFeaturesReturnType.CONTINUE;const bb=ra.featureIds;this._collection.forEachVisibleComponent(ra.objectHandle,fb=>{Ya=Fa(bb[fb],fb,ra);return Ya===ja.ForAllFeaturesReturnType.CONTINUE});return Ya}_forAllQueryableFeaturesOfNode(ra,Fa){Fa=this._ignoreClientNodeOverriddenFeatures(Fa);if(null==this._renderClippingArea)return this._forAllFeaturesOfNode(ra,Fa);var Ya=
this._boundingRectNodeTest(ra,this._renderClippingArea);if(Ya===Ga.MbsIntersectResult.OUTSIDE)return ja.ForAllFeaturesReturnType.CONTINUE;if(Ya===Ga.MbsIntersectResult.INSIDE)return this._forAllFeaturesOfNode(ra,Fa);Ya=ja.ForAllFeaturesReturnType.CONTINUE;const bb=ra.featureIds,fb=Ga.getClipRect(this._renderClippingArea,this._collection.getObjectTransform(ra.objectHandle));for(let kb=0;kb<bb.length;kb++){if(!this._boundingRectFeatureTest(ra,kb,fb))continue;const rb=Fa(bb[kb],kb,ra);if(rb===ja.ForAllFeaturesReturnType.EXIT)return rb}return Ya}_createAttributes(ra,
Fa){const Ya={};null!=Fa.featureIds&&(Ya[this._getObjectIdField()]=Fa.featureIds[ra]);Fa=Fa.attributeInfo?.attributeData;if(null!=Fa)for(const bb of Object.keys(Fa))Ya[bb]=Ga.getCachedAttributeValue(Fa[bb],ra);return Ya}_createGraphic(ra,Fa){return this._createLayerGraphic(this._createAttributes(ra,Fa))}highlight(ra,Fa){if(h.isQuery(ra))return Wa.emptyHighlightHandle;ra=Wa.normalizeHighlightTargetExceptQuery(ra);if(0===ra.length)return Wa.emptyHighlightHandle;Fa??=ya.defaultHighlightName;if(ra[0]instanceof
p){const Ya=this.i3slayer.fieldsIndex,bb=this._getObjectIdField();ra=ra.map(rb=>$a.attributeLookup(Ya,rb.attributes,bb));const {set:fb,handle:kb}=this._highlights.acquireSet(Fa);this._highlights.setFeatureIds(fb,ra,Fa);return kb}if("number"===typeof ra[0]){const {set:Ya,handle:bb}=this._highlights.acquireSet(Fa);this._highlights.setFeatureIds(Ya,ra,Fa);return bb}return Wa.emptyHighlightHandle}resetHighlights(){c.destroyMaybe(this._highlights);this._highlights=new na({collection:this._collection,forAllFeatures:ra=>
this._forAllFeatures(ra,null,ja.ForAllFeaturesMode.ALL),forAllFeaturesOfNode:(ra,Fa)=>this._forAllFeaturesOfNode(ra,Fa)})}_visibleGeometryChanged(ra,Fa){if(this._elevationProvider){var Ya=this.getNodeComponentObb(ra.node);Ya&&this._elevationProvider.objectChanged(Ya);null==this._visibleGeometryChangedSchedulerHandle&&(this._visibleGeometryChangedSchedulerHandle=u.schedule(()=>{this.emit("visible-geometry-changed");this._visibleGeometryChangedSchedulerHandle=null}));this._updateSnappingSources(ra,
Fa)}}get performanceInfo(){return new ea.I3SMeshViewPerformanceInfo(this.usedMemory,this._nodeId2Meta.size,Math.round(this._gpuMemoryEstimate/1048576),Math.round(this._geoMemoryEstimate/1048576),Math.round(this._texMemoryEstimate/1048576),Math.round(this.unloadedMemory/1048576),this._idbCacheEnabled?Math.round(100*this._idbCache.getHitRate()):0)}get test(){}getNodeOpacityByIndex(ra){ra=this._nodeId2Meta.get(ra);return this.getNodeOpacity(ra)}getNodeOpacity(ra){return null!=ra?this._collection.getMaterial(ra.objectHandle).objectOpacity:
0}isNodeFullyFadedIn(ra){return this._crossfadeHelper.isNodeFullyFadedIn(ra)}getNodeCrossfadeMetaData(ra){return this._nodeId2Meta.get(ra)}markNodeToRemove(ra){this._controller&&this._controller.markNodeToRemove(ra)}removeMarkedNodes(){this._controller&&this._controller.removeMarkedNodes()}foreachCrossfadeNode(ra){this._nodeId2Meta.forEach(ra)}fadeNode(ra,Fa,Ya){if(this.nodeCrossfadingEnabled){var bb=this._nodeId2Meta.get(ra);null!=bb&&this._crossfadeHelper.fadeNode(ra,bb,Fa,Ya)}}setNodeOpacityByIndex(ra,
Fa){ra=this._nodeId2Meta.get(ra);null!=ra&&this._setNodeOpacity(ra,Fa)}_setNodeOpacity(ra,Fa){this._collection.updateMaterial(ra.objectHandle,Ya=>Ya.objectOpacity=Fa);this._setNodeEdgeOpacity(ra,Fa)}_setNodeEdgeOpacity(ra,Fa){null!=this._edgeView&&ra.cachedEdgeMaterials&&(Xa(ra.cachedEdgeMaterials,Fa),ra=ra.objectHandle,this._edgeView.hasObject(ra)&&this._edgeView.updateAllComponentOpacities(ra,Fa).catch(Ya=>Ea(Ya,this.i3slayer.title)))}get hasModifications(){return this._isIntegratedMesh&&null!=
this._layerClippingArea||this._modifications&&0<this._modifications.length}updateNodeModificationStatus(ra){var Fa=ra.length;if(this.hasModifications&&!(0>=Fa)&&!0===this._i3sWasmLoaded){Fa=this.uid;var Ya=Oa(ra);if(Ya){X.filterObbsForModificationsSync({context:Fa,buffer:Ya.buffer});const bb=new Float64Array(Ya.buffer);ra.forAll((fb,kb)=>{kb=X.interpretObbModificationResults(bb[kb]);fb.imModificationImpact=kb;kb!==Ia.NodeIMModificationImpact.Unmodified&&this._controller.invalidateGeometryVisibility(fb.index)})}}}notifyUpdate(){this.notifyChange("updating")}notifyLODUpdate(){this._controller.notifyLODUpdate()}isUpdating(){return!(!this._controller||
!this._controller.updating)||!!this._visibleGeometryChangedSchedulerHandle||null!=this._labeler&&this._labeler.updating||this._crossfadeHelper?.updating||this._i3sWasmLoaded instanceof Promise||0<this._asyncModuleLoading||null!=this._elevationTask&&this._elevationTask.running}trackSnappingSources(ra){const Fa={events:ra,fetchEdgeLocations:async(Ya,bb,fb)=>{Ya=this._nodeId2Meta.get(Ya);if(null==Ya)throw Error("invalid-node");const {origin:kb,buffer:rb}=await this._collection.extractEdgeInformation(Ya.objectHandle,
bb,fb);this._snappingLocationsApplyElevation(Ya,rb,kb);return{type:"components",objectIds:Ya.featureIds,locations:rb,origin:kb}},remove:()=>e.removeUnordered(this._snappingSourcesTrackers,Fa)};this._snappingSourcesTrackers.push(Fa);this._nodeId2Meta.forEach((Ya,bb)=>{null!=Ya&&(Ya=this._controller.getRenderMbs(Ya.node))&&ra.add(bb,Ya)});return Fa}_snappingLocationsApplyElevation(ra,Fa,Ya){if(ra.elevationOffsets&&this.elevationInfo.mode!==ja.ElevationMode.Absolute){var bb=Fa.position0,fb=Fa.position1;
Fa=Fa.componentIndex;var kb=C.create(),rb=C.create(),vb=(Ab,Bb)=>{A.add(Ab,Ab,Ya);this.view.renderCoordsHelper.worldUpAtPosition(Ab,rb);A.add(Ab,Ab,A.scale(rb,rb,Bb));A.subtract(Ab,Ab,Ya)};for(let Ab=0;Ab<bb.count;Ab++){const Bb=ra.elevationOffsets[Fa.get(Ab)];bb.getVec(Ab,kb);vb(kb,Bb);bb.setVec(Ab,kb);fb.getVec(Ab,kb);vb(kb,Bb);fb.setVec(Ab,kb)}}}_updateSnappingSources(ra,Fa){const {index:Ya}=ra.node;ra=this._controller.getRenderMbs(ra.node);if(null!=ra)for(const bb of this._snappingSourcesTrackers)Fa!==
ua.REMOVE&&Fa!==ua.UPDATE||bb.events.remove(Ya),Fa!==ua.ADD&&Fa!==ua.UPDATE||bb.events.add(Ya,ra)}};n.__decorate([m.property()],mb.prototype,"_hasLoadedPBRTextures",void 0);n.__decorate([m.property()],mb.prototype,"_asyncModuleLoading",void 0);n.__decorate([m.property()],mb.prototype,"_visibleGeometryChangedSchedulerHandle",void 0);n.__decorate([m.property()],mb.prototype,"view",void 0);n.__decorate([m.property()],mb.prototype,"i3slayer",void 0);n.__decorate([m.property()],mb.prototype,"_controller",
void 0);n.__decorate([m.property()],mb.prototype,"_labeler",void 0);n.__decorate([m.property()],mb.prototype,"updating",void 0);n.__decorate([m.property()],mb.prototype,"suspended",void 0);n.__decorate([m.property()],mb.prototype,"contentVisible",null);n.__decorate([m.property({readOnly:!0})],mb.prototype,"legendEnabled",null);n.__decorate([m.property()],mb.prototype,"holeFilling",void 0);n.__decorate([m.property(Na.updatingProgress)],mb.prototype,"updatingProgress",void 0);n.__decorate([m.property()],
mb.prototype,"updatingProgressValue",null);n.__decorate([m.property()],mb.prototype,"hasTexturesOrVertexColors",null);n.__decorate([m.property()],mb.prototype,"rendererTextureUsage",null);n.__decorate([m.property()],mb.prototype,"elevationOffset",null);n.__decorate([m.property()],mb.prototype,"elevationInfo",null);n.__decorate([m.property({type:Boolean})],mb.prototype,"slicePlaneEnabled",void 0);n.__decorate([m.property()],mb.prototype,"supportedTextureEncodings",null);n.__decorate([m.property()],
mb.prototype,"uncompressedTextureDownsamplingEnabled",null);n.__decorate([m.property({type:[da]})],mb.prototype,"_modifications",void 0);n.__decorate([m.property({readOnly:!0})],mb.prototype,"clientGeometry",null);n.__decorate([m.property()],mb.prototype,"elevationRange",null);n.__decorate([m.property()],mb.prototype,"fullExtent",null);n.__decorate([m.property()],mb.prototype,"_elevationTask",void 0);n.__decorate([m.property({readOnly:!0})],mb.prototype,"_usePBR",null);return mb=n.__decorate([q.subclass("esri.views.3d.layers.I3SMeshView3D")],
mb)};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/projection/localLinearScaleFactors":function(){define(["exports","../../chunks/vec32","./projectors","../support/Ellipsoid","../support/spatialReferenceUtils"],function(a,b,n,k,p){a.localLinearScaleFactors=function(h,e,g,d){if(null==e||null==d)return!1;const f=n.classifySpatialReference(e,n.sourceClassificationCache);var c=n.classifySpatialReference(d,n.destClassificationCache);if(f===c&&f!==n.ProjectionID.UNKNOWN||
p.equals(e,d))return g[0]=1,g[1]=1,g[2]=1,!0;if(f===n.ProjectionID.SPHERICAL_ECEF){e=b.length(h);h=e/Math.sqrt(h[0]*h[0]+h[1]*h[1]);e/=k.earth.radius;if(c===n.ProjectionID.WEB_MERCATOR)return g[0]=h*e,g[1]=h*e,g[2]=1,!0;if(c===n.ProjectionID.WGS84||c===n.ProjectionID.CGCS2000)return c=n.invPlateCarreeScale,g[0]=c*h*e,g[1]=c*e,g[2]=1,!0}else if(f===n.ProjectionID.PLATE_CARREE){if(c===n.ProjectionID.WGS84||c===n.ProjectionID.CGCS2000)return g[0]=n.invPlateCarreeScale,g[1]=n.invPlateCarreeScale,g[2]=
1,!0;if(c===n.ProjectionID.WEB_MERCATOR)return c=h[1]/k.earth.radius,g[0]=1,g[1]=1/Math.cos(c),g[2]=1,!0}return!1};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/projection/projectBoundingSphere":function(){define(["exports","../../core/mathUtils","../../core/libs/gl-matrix-2/factories/vec3f64","./projectors","../support/Ellipsoid"],function(a,b,n,k,p){function h(f,c,l,w){c=w+c;if(c<w/2||l>c)return Number.MAX_VALUE;f=Math.abs(d*f)+Math.asin(l/c);return f>=Math.PI/2?
Number.MAX_VALUE:l/Math.cos(f)}const e=n.create(),g=k.createEmptyProjectorCache(),d=b.deg2rad(1);a.projectBoundingSphere=function(f,c,l,w){if(null==c||null==w)return!1;c=k.populateProjectorCache(c,w,g);if(c.projector===k.copy3)return l[0]=f[0],l[1]=f[1],l[2]=f[2],l[3]=f[3],!0;if(null==c.projector)return!1;const {source:x,dest:u}=c;if(u.spatialReferenceId===k.ProjectionID.WEB_MERCATOR){c=k.projectionTable[x.spatialReferenceId][k.ProjectionID.WGS84];if(null==c)return!1;c(f,0,e,0);k.wgs84ToWebMercator(e,
0,l,0);l[3]=h(e[1],f[2],f[3],p.earth.radius);return!0}if(x.spatialReferenceId!==k.ProjectionID.WGS84&&x.spatialReferenceId!==k.ProjectionID.CGCS2000||u.spatialReferenceId!==k.ProjectionID.PLATE_CARREE)c.projector(f,0,l,0),l[3]=f[3]*(x.metersPerUnit??1)/(u.metersPerUnit??1);else{w=k.projectionTable[k.ProjectionID.SPHERICAL_ECEF][k.ProjectionID.PLATE_CARREE];let t=f[3];null!=k.projectionTable[x.spatialReferenceId][k.ProjectionID.SPHERICAL_ECEF]&&null!=w&&(t=h(f[1],f[2],f[3],p.earth.radius));c.projector(f,
0,l,0);l[3]=t}return!0};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/UByteArray":function(){define(["exports","../../core/typedArrayUtil"],function(a,b){a.newUByteArray=function(n,k=!1){return n<=b.nativeArrayMaxSize?k?Array(n).fill(0):Array(n):new Uint8Array(n)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/controllers/I3SOnDemandController":function(){define("../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/has ../../../core/Logger ../../../core/PooledArray ../../../core/Promise ../../../core/promiseUtils ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ../../../geometry/projection/projectBoundingRect ../../../geometry/support/aaBoundingRect ../../support/PromiseQueue ../../../views/ViewingMode ../../../views/3d/layers/i3s/I3SClientNodeLoader ../../../views/3d/layers/i3s/I3SFrameTask ../../../views/3d/layers/i3s/I3SIndex ../../../views/3d/layers/i3s/I3SLodHandling ../../../views/3d/layers/i3s/I3SNode ../../../views/3d/layers/i3s/I3SNodeLoader ../../../views/3d/layers/i3s/I3SStreamDataController ../../../views/3d/layers/i3s/I3SUtil ../../../views/3d/layers/i3s/I3SViewportQueries ../../../views/3d/layers/support/I3SLayerView ../../../views/3d/support/extentUtils ../../../views/3d/support/index ../../../views/3d/support/MemoryController ../../../views/support/Scheduler".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w,x,u,t,m,q,r,v,y,B,z,A,C,H,E,F,G){function D(K,L){return null!=K&&K.length===L.length&&K.every(P=>0<=I(L,P.name))}function I(K,L){L=L.toLowerCase();for(let P=0;P<K.length;P++)if(K[P].name.toLowerCase()===L)return P;return-1}b=class extends h.EsriPromiseMixin(b){get isMeshPyramid(){return"mesh-pyramids"===this.layer.profile||"MeshPyramid"===this.layer.store?.lodType}get isGraphics3D(){return"points"===this.layer.profile}get useMaximumNumberOfFeatures(){return!this.isMeshPyramid&&
(null==this.layer.priority||"High"===this.layer.priority)}get indexStreamController(){const K=this.layerView.view.resourceController.createStreamDataRequester(E.ClientType.I3S_INDEX);return new B.I3SStreamDataController(K,this.layer.customParameters,this.layer.apiKey)}get dataStreamController(){const K=this.layerView.view.resourceController.createStreamDataRequester(E.ClientType.I3S_DATA);return new B.I3SStreamDataController(K,this.layer.customParameters,this.layer.apiKey)}get crsVertex(){return z.getVertexCrs(this.layer)}get crsIndex(){return z.getIndexCrs(this.layer)}get layer(){return this.layerView.i3slayer}get running(){return this.updating}get rootNodeVisible(){if(this._index){const K=
this._index.rootNode;if(K)return this._updateViewData(),this._index.isNodeVisible(K.index)}return!0}get index(){return this._index}get requiredAttributes(){return this._requiredAttributes}constructor(K){super(K);this.screenSizeFactor=0;this.featureTarget=5E4;this.fixedFeatureTarget=!1;this.updating=!0;this.updatingProgress=1;this.leavesReached=!1;this.worker=null;this._featureLOD=1;this._isIdle=this._stableFeatureLOD=!1;this._cameraDirty=!0;this._invisibleDirty=!1;this._idleStateCallbacks=null;this._newLoadingNodes=
new p({deallocator:null});this._modificationsNodeFilteringArray=new p;this._downloadingCount=0;this._loadingNodes=new Map;this._updatingNodes=new Map;this._progressMaxNumNodes=1;this._requiredAttributes=[];this._requiredAttributesDirty=!0;this._restartNodeLoading=this._disableMemCache=this.disableIDBCache=this._updatesDisabled=!1;this._attributeStorageInfo=this._fields=null;this._idleQueue=new x.PromiseQueue;this._elevationUpdateNodes=new p({deallocator:null});this._errorCount=0}initialize(){const {layerView:K,
layer:L}=this;this._disableMemCache=!K.loadCachedGPUData||!K.addCachedGPUData;this._lodHandling=new r(K);this._defaultGeometrySchema=L.store.defaultGeometrySchema;this.disableIDBCache=!!n("disable-feature:idb-cache");"fields"in L&&(this._fields=L.fields,this._attributeStorageInfo=L.attributeStorageInfo);this.addResolvingPromise(Promise.all([L.indexInfo,L.when(),K.when()]).then(([P])=>{if(!this.destroyed&&K&&!K.destroyed&&P){var {view:R,clientGeometry:W}=K,{resourceController:V}=R;this._setClippingArea(R.clippingArea);
this.addHandles([g.watch(()=>R?.pointsOfInterest?.focus?.renderLocation,ba=>this._pointOfInterestChanged(ba),g.initial),g.watch(()=>R.quality,()=>this._setCameraDirty(),g.sync),g.watch(()=>K.contentVisible,ba=>{const U=ba?()=>this._updateIdleState(!0):()=>this._updateViewData(),da=ba?()=>this._updateIdleState(!1):()=>{};ba&&null!=this._index&&this._index.invalidateAllElevationRanges();this._idleStateCallbacks?(ba||this.cancelNodeLoading(),this.restartNodeLoading(),this._idleStateCallbacks.idleBegin=
U,this._idleStateCallbacks.idleEnd=da):this._idleStateCallbacks=V.scheduler.registerIdleStateCallbacks(U,da)},g.initial),m.addCallback(K.view.resourceController.scheduler,this),g.watch(()=>K.uncompressedTextureDownsamplingEnabled,()=>this.restartNodeLoading()),g.watch(()=>[this.featureTarget,this.fixedFeatureTarget],()=>{this._setCameraDirty();this._stableFeatureLOD=!1}),g.watch(()=>R.state?.contentCamera,()=>this._setCameraDirty()),g.watch(()=>L.elevationInfo,ba=>this._elevationInfoChanged(ba)),
g.watch(()=>K.lodFactor,()=>this._setCameraDirty()),g.watch(()=>K.availableFields,()=>this._requiredFieldsChange()),g.watch(()=>K.holeFilling,ba=>null!=this._index&&(this._index.holeFilling=ba))]);this._viewportQueries=new A(this.crsIndex,R.renderCoordsHelper,R.state.contentCamera,!R.state.fixedContentCamera||this.isGraphics3D,this._clippingArea,this.isMeshPyramid?R.basemapTerrain:R.elevationProvider,u.viewingModeFromString(R.viewingMode),this.layer.elevationInfo,{progressiveLoadFactor:this._getProgressiveLoadFactor(),
screenspaceErrorBias:this._lod,angleDependentLoD:.5>this._lod});this._clientNodeLoader=new t.I3SClientNodeLoader(this.layer.uid,{indexSR:this.crsIndex,vertexSR:this.crsVertex,renderSR:R.renderCoordsHelper.spatialReference},R.resourceController.memoryController,this.worker);this._index=new q.I3SIndex(u.viewingModeFromString(R.viewingMode),L,P,this.indexStreamController,this._clientNodeLoader,this._viewportQueries,k.getLogger(this),K.holeFilling,ba=>K.isNodeLoaded(ba),ba=>K.isNodeReloading(ba),ba=>
this._shouldLoadNode(ba),ba=>this._enableFromGPUCache(ba,v.NodeState.Leaf),ba=>this._needsUpdate(ba),()=>!this.indexStreamController.busy,ba=>K.computeVisibilityObb?.(ba)??null,K?.computeNodeFiltering?ba=>K.computeNodeFiltering(ba):void 0);this._index.updateElevationInfo(this.layer.elevationInfo,this.isMeshPyramid||this.isGraphics3D);this._index.imModificationsChanged(!!K.hasModifications);this._index.layerFilterChanged(!!K.hasGeometryFilter);if(null!=W){for(const ba of W)this._addMesh(ba.mesh,ba.oid);
this.addHandles(W.on("change",ba=>{for(const U of ba.removed)this._removeMesh(U.oid);for(const U of ba.added)this._addMesh(U.mesh,U.oid)}))}this._startNodeLoading()}}))}updateNodeModificationStatus(K){const L=this._index,P=this.layerView;null!=L&&P?.updateNodeModificationStatus&&(this._modificationsNodeFilteringArray.clear(),K.forAll(R=>{R=L.getNode(R);null!=R&&this._modificationsNodeFilteringArray.push(R)}),P.updateNodeModificationStatus(this._modificationsNodeFilteringArray),this._invisibleDirty=
!0)}destroy(){this.cancelNodeLoading();this._idleStateCallbacks&&(this._isIdle=!1,this._idleStateCallbacks.remove(),this._idleStateCallbacks=null);this._nodeLoader=null;J.prune();null!=N&&(N.hide(),N=null)}get viewportQueries(){return this._viewportQueries}_getRequiredAttributes(){if(null==this._attributeStorageInfo||!this._fields||!this.layerView.availableFields)return[];const K=this._attributeStorageInfo,L=this._fields,P=this.layer.objectIdField;return this.layerView.availableFields.map(R=>{const W=
I(K,R);R=I(L,R);return 0<=W&&0<=R?{index:W,name:L[R].name,field:L[R],attributeStorageInfo:K[W]}:null}).filter(R=>null!=R&&R.name!==P)}_requiredFieldsChange(){const K=this._getRequiredAttributes();D(this._requiredAttributes,K)||(this._requiredAttributes=K,this._requiredAttributesDirty=!1,this.restartNodeLoading())}requestUpdate(){this._requiredAttributesDirty=!0;this.restartNodeLoading()}_setClippingArea(K){const L=w.create();H.toBoundingRect(K,L,this.layerView.view.renderSpatialReference)?this._clippingArea=
L:this._clippingArea=null}_pointOfInterestChanged(K){null!=this._viewportQueries&&(this._viewportQueries.setPointOfInterest(K),null!=this._index&&(this._index.progressiveLoadPenalty=M.distancePenalty*this._viewportQueries.distCameraToPOI(),this._index.requestUpdate()))}updateClippingArea(K){this._setClippingArea(K);null!=this._viewportQueries&&null!=this._index&&(this._viewportQueries.updateClippingArea(this._clippingArea),this._index.invalidateVisibilityCache());this._setCameraDirty()}_setCameraDirty(){this._cameraDirty=
!0;this._lodHandling.setLodGlobalDirty();this._evaluateUpdating()}_addMesh(K,L){null!=this._index&&(K=this._clientNodeLoader.createMeshNodeInfo(K,L),L=this._index.addClientNodeToIndex(K.id,K.mbs),this._clientNodeLoader.addMeshNode(L,K),this._evaluateUpdating(),this.notifyChange("rootNodeVisible"))}_removeMesh(K){K=this._clientNodeLoader.getMeshNodeIndex(K);if(null!=K)if(null!=this._index)this._index.removeClientNodeFromIndex(K,(L,P)=>{this.layerView.removeNode(P);this._clientNodeLoader.removeNode(L);
this.layerView.deleteCachedNodeData&&null!=L&&this.layerView.deleteCachedNodeData(L);this.layerView.deleteCachedGPUData?.(this.layerView.loadCachedGPUData?.(P))},(L,P,R)=>{this._clientNodeLoader.updateNodeIndex(L,P,R);this.layerView.updateNodeIndex&&this.layerView.updateNodeIndex(P,R)}),this.notifyChange("rootNodeVisible");else throw Error("delayed removal of client side i3s node geometry not supported yet.");}updateElevationChanged(K,L){const P=this._index;if(null==P?.rootNode||null==L)return null;
this.crsIndex.equals(L)||(l.projectBoundingRect(K,L,Q,this.crsIndex),K=Q);const R=this._elevationUpdateNodes;R.clear();z.findIntersectingNodes(K,P.rootNode,P,W=>R.push(W.index));R.length&&(R.forAll(W=>P.updateElevationChanged(W)),this._setCameraDirty());return R}removeAllGeometryObbs(){null!=this._index&&this._index.removeAllGeometryObbs()}getRenderMbs(K){return null!=this._viewportQueries?this._viewportQueries.getServiceMbsInRenderSR(K):null}_elevationInfoChanged(K){null!=this._index&&(this._index.updateElevationInfo(K,
this.isMeshPyramid||this.isGraphics3D),this._setCameraDirty())}restartNodeLoading(){this._restartNodeLoading=!0;this.cancelNodeLoading();this._evaluateUpdating()}schedule(K,L){return this._idleQueue.push(K,L)}reschedule(K,L){return this._idleQueue.unshift(K,L)}get _isIntegratedMesh(){return"integrated-mesh"===this.layer.type}get unloadedMemoryEstimate(){return null!=this._index&&this.layerView.contentVisible?this._index.unloadedMemoryEstimate*this._lodDropFactor:0}async _loadNodeData(K,L){return 0>
K.index?this._clientNodeLoader.loadNodeData(K.id,L):this._nodeLoader.loadNodeData(K,L)}async _loadAttributes(K,L,P){return(0>K.index?this._clientNodeLoader:this._nodeLoader).loadAttributes(K,L,P)}get indexDepth(){return null!=this._index?this._index.maxLevel:0}set disableMemCache(K){this._disableMemCache=this.layerView.loadCachedGPUData&&this.layerView.addCachedGPUData?K:!0}runTask(K,L){if(!this.layerView.contentVisible)return this._updateViewData(),this._evaluateUpdating(),-Infinity;if(!this.layerView.visible||
null==this._index)return-Infinity;this._processWithErrorLogging(K,L);return this._index.maxPriority}_processWithErrorLogging(K,L){try{this._process(K,L)}catch(P){50>this._errorCount?k.getLogger(this).error(`Error during processing: ${P} at ${P.stack}`):50===this._errorCount&&k.getLogger(this).error("Too many errors for this layer. Further errors will not be displayed."),this._errorCount++}}_process(K,L){this._restartNodeLoading&&this._startNodeLoading();null!=this._nodeLoader&&null!=this._index&&
(this._updateViewData(),this._invisibleDirty&&this._removeInvisibleNodes(K)&&(this._invisibleDirty=!1),this._isIntegratedMesh&&(K.enabled=!1),K.run(()=>this._processIndex(K)),this._updateFeatureLOD(),K.run(()=>this._processCache(K)),this._isIntegratedMesh&&(K.enabled=!0),K.run(()=>this._processNodes(K,L)),this._idleQueue.runTask(K),K.run(()=>this._prefetchIndex()),L.numIndexLoading+=this._index.indexLoading,L.numNodesLoading+=this._downloadingCount,K.run(()=>this._lodHandling.lodGlobalHandling(K)),
this._evaluateUpdating())}_processIndex(K){if(null==this._index)return!1;this._index.dirty&&(this._newLoadingNodes.clear(),this._index.update(Array.from(this._loadingNodes.keys()),K,L=>this.updateNodeModificationStatus(L)),this._disableMemCache||(this._newLoadingNodes.pushArray(this._index.updates.add.data,this._index.updates.add.length),this._newLoadingNodes.pushArray(this._index.updates.missing.data,this._index.updates.missing.length)),K=this._index.featureEstimate.leavesReached,this._index.isLoading||
K===this._get("leavesReached")||this._set("leavesReached",K));return this._index.load()}_prefetchIndex(){return null==this._index||0<this._loadingNodes.size||0<this._index.updates.add.length?!1:this._index.prefetch()}_updateFeatureLOD(){if(this.useMaximumNumberOfFeatures&&null!=this._index&&null!=this._viewportQueries){var K=!this._index.isLoading,L=this.featureTarget*this._baseLOD,P=this._index.featureEstimate;P.estimate=P.estimate||L/2;if(500<this._index.indexMissing){if(1E-4>=this._featureLOD)return;
this._featureLOD/=1.5;this._stableFeatureLOD=!1}else if(K&&P.estimate<L){if(P.leavesReached||1E4<=this._featureLOD||this._stableFeatureLOD)return;this._featureLOD*=Math.min(10,Math.max(L/P.estimate,1.001));K=this._lod;L=this._index.checkFeatureTarget(L,K);L!==K&&(this._featureLOD=L/this._baseLOD,this._stableFeatureLOD=!0)}else if(P.estimate>1.2*L||K&&P.estimate>L){if(1E-4>=this._featureLOD)return;this._featureLOD/=1+.25*(P.estimate/L-1);this._stableFeatureLOD=!1}else return;this._featureLOD=Math.min(1E4,
Math.max(1E-4,this._featureLOD));this._viewportQueries.updateScreenSpaceErrorBias(this._lod);this._index.requestUpdate()}}_processCache(K){const L=this._index;if(null==L)return!1;for(;0<this._newLoadingNodes.length&&!K.done;){var P=this._newLoadingNodes.pop();for(P=L.getParent(P);null!=P&&!this.layerView.isNodeLoaded(P.index);P=L.getParent(P.index))if(this._enableFromGPUCache(P,v.NodeState.Hole)){K.madeProgress();break}}return K.hasProgressed}_processNodes(K,L){if(null==this._index)return!1;let P=
(this._isIdle?100:2)-this._loadingNodes.size;const R=this._index.updates;R.cancel.forEach(this._cancelNode,this);for(R.cancel=[];0<R.remove.length&&!K.done;)this.layerView.removeNode(R.remove.pop()),K.madeProgress();for(;0<R.update.length&&!K.done;){var W=this._index.getNode(R.update.pop());null!=W&&(this._updateLoadedNode(W),K.madeProgress())}for(;0<R.add.length&&!K.done&&0<P;){--P;W=this._index.getNode(R.add.back());if(null==W||W.cacheState!==v.CacheState.Cached&&!this._hasNodeLoadToken(L))break;
R.add.pop();this._loadNode(W);K.madeProgress()}return K.hasProgressed}_cancelAllNodes(){this._loadingNodes.forEach(K=>K.abort());this._loadingNodes.clear();this._updatingNodes.forEach(K=>K.abort());this._updatingNodes.clear()}_cancelNode(K){const L=this._loadingNodes.get(K);L&&(L.abort(),this._loadingNodes.delete(K))}_hasNodeLoadToken(K){return!this._isIdle&&2<=K.numNodesLoading+this._loadingNodes.size?!1:this._downloadingCount<E.maxDownloadSlots&&!this.dataStreamController.busy}_evaluateUpdating(){let K=
!1;var L=0;this.layerView&&(this.layerView.contentVisible?(L=(null!=this._index?this._index.indexMissing:0)+3*(null!=this._index?this._index.updates.add.length:0)+2*this._loadingNodes.size,K=!!(0<L||0<this._updatingNodes.size||this._restartNodeLoading||this._cameraDirty||this._idleQueue.running||this._lodHandling&&this._lodHandling.requiresLODGlobalHandling||null!=this._index&&this._index.isPrefetching),0===L&&(this._progressMaxNumNodes=1),this._progressMaxNumNodes=Math.max(L,this._progressMaxNumNodes),
L=1-L/this._progressMaxNumNodes):L=(K=this._cameraDirty)?0:1,this.updating=K,this.updatingProgress=L)}_updateViewData(){if(this._cameraDirty&&null!=this._index&&null!=this._viewportQueries){var K=this.layerView.view,{contentCamera:L,fixedContentCamera:P}=K.state;this.screenSizeFactor=1/(L.perScreenPixelRatio/2);this._viewportQueries.updateCamera(L,!P||this.isGraphics3D);this._viewportQueries.setPointOfInterest(K.pointsOfInterest.focus.renderLocation);this._viewportQueries.updateScreenSpaceErrorBias(this._lod);
this._index.invalidateVisibilityCache();this._index.progressiveLoadPenalty=M.distancePenalty*this._viewportQueries.distCameraToPOI();this._index.requestUpdate();this._stableFeatureLOD=!1;this._invisibleDirty=!0;this._cameraDirty=!1;this.notifyChange("rootNodeVisible")}}_getProgressiveLoadFactor(){return 1>this.layerView.view.quality?1:this.layerView.progressiveLoadFactor}get _lod(){return this._featureLOD*this._baseLOD}get _baseLOD(){const K=this.layerView.lodFactor;return this.fixedFeatureTarget?
1:(0<K?K:1)*this.layerView.view.quality}get _lodDropFactor(){return this.fixedFeatureTarget?1:(Math.min(this.layerView.view.quality,.5)-F.minQuality)/(.5-F.minQuality)}isGeometryVisible(K){return!!this._index?.isGeometryVisible(K.index)}updateVisibility(K){this._index?.invalidateNodeVisibilityCache(K)}invalidateGeometryVisibility(K){this._index?.invalidateGeometryVisibility(K)}invalidateVisibilityObbs(){this._index?.invalidateVisibilityObbs()}modificationsChanged(){this._index?.imModificationsChanged(!!this.layerView.hasModifications);
this._invisibleDirty=!0}_shouldLoadNode(K){return this._lodHandling.shouldLoadNode(K)&&!this._shouldDropNode(K)&&null!=this._index&&this._index.isGeometryVisible(K.index)?!0:!1}_shouldDropNode(K){if(null==this._viewportQueries)return!1;const L=this._lodDropFactor;return 1<=L||!this._lodHandling.hasNoVisibleChildren(K)?!1:Math.abs(this._viewportQueries.calcCameraDistanceToCenter(K))-this._viewportQueries.minDistance>(this._viewportQueries.maxDistance-this._viewportQueries.minDistance)*L}_startNodeLoading(){this._restartNodeLoading=
!1;const K=this._index;if(!this._updatesDisabled&&null!=K&&null!=this._viewportQueries){this._updateViewData();this._requiredAttributesDirty&&(this._requiredAttributes=this._getRequiredAttributes(),this._requiredAttributesDirty=!1);var L={textureEncodings:this.layerView.supportedTextureEncodings,uncompressedTextureDownsamplingEnabled:this.layerView.uncompressedTextureDownsamplingEnabled,textureUsageMask:this.layerView.rendererTextureUsage,loadFeatureData:this.useMaximumNumberOfFeatures};this._nodeLoader=
new y(this.layer,this.dataStreamController,k.getLogger(this),this._defaultGeometrySchema,this._requiredAttributes,L);K.requestUpdate();this._lodHandling.startNodeLoading((P,R)=>this._removeNodes(P,R,O.fadeout),K,{maxLodLevel:this._viewportQueries.maxLodLevel});this._evaluateUpdating()}}isNodeLoading(){return null!=this._nodeLoader&&null!=this._index}cancelNodeLoading(){this.isNodeLoading()&&(this.indexStreamController.cancelAll(),this.dataStreamController.cancelAll(),this._idleQueue.cancelAll(),this._cancelAllNodes(),
this._nodeLoader=null,this._evaluateUpdating())}_removeInvisibleNodes(K){const L=this._index;if(null==L||null==this._viewportQueries)return!1;J.clear();this.layerView.getLoadedNodeIndices(J);const P=0===this._viewportQueries.maxDistance,R=P?()=>!1:W=>this._shouldDropNode(W);J.filterInPlace(W=>{const V=L.getNode(W);return null==V||!L.isGeometryVisible(W)||R(V)});0<J.length&&this._lodHandling.setLodGlobalDirty();this._removeNodes(J,K,O.pop);if(P&&1>this._lodDropFactor)return!1;if(0===J.length)return!0;
J.clear();return!1}markNodeToRemove(K){J.push(K)}removeMarkedNodes(){this._removeNodes(J,G.noBudget,O.pop)}_removeNodes(K,L,P){if(0!==K.length&&!L.done)for(null!=this._index&&this._index.requestUpdate();0<K.length&&!L.done;){const R=K.pop(),W=this._index;P===O.fadeout&&this.layerView.nodeFadeoutEnabled&&null!=W&&W.isGeometryVisible(R)?this.layerView.fadeNode(R,C.FadeDirection.FadeOut,!0):this.layerView.removeNode(R);L.madeProgress()}}_needsUpdate(K){if(K.resources.isEmpty||this._updatingNodes.has(K.index))return!1;
K=this.layerView.getLoadedAttributes(K.index);return null!=K&&K!==this._requiredAttributes}async _updateLoadedNode(K){const L=new AbortController;this._updatingNodes.set(K.index,L);this._evaluateUpdating();try{const P=this.layerView.getLoadedAttributes(K.index);let R=null;R=D(P,this._requiredAttributes)?this.layerView.getAttributeData(K.index):await this._loadAttributes(K,this._requiredAttributes,L.signal);await this.schedule(()=>this.layerView.updateAttributes(K.index,{loadedAttributes:this._requiredAttributes,
attributeData:R},L.signal),L.signal)}catch(P){if(!e.isAbortError(P))return this.layerView.updateAttributes(K.index,{loadedAttributes:this._requiredAttributes,attributeData:{}},L.signal)}this._updatingNodes.delete(K.index);this._evaluateUpdating()}_loadNode(K){if(this._loadingNodes.has(K.index))k.getLogger(this).error("already loading node "+K.index);else{var L=new AbortController;this._loadingNodes.set(K.index,L);this._evaluateUpdating();this._loadAndAddNode(K,L.signal).then(P=>{P&&null!=this._index&&
this._loadingNodes.get(K.index)===L&&(this._loadingNodes.delete(K.index),this._index.requestUpdate())}).catch(P=>{if(!e.isAbortError(P))throw P;}).finally(()=>{this._loadingNodes.get(K.index)===L&&this._loadingNodes.delete(K.index);this._evaluateUpdating()})}}_loadAndAddNode(K,L){return K.cacheState===v.CacheState.Uncached?this._loadUncached(K,L).then(()=>!1):this._loadCached(K,L).then(P=>{if(P)return!1;K.cacheState=v.CacheState.Uncached;return!0}).catch(P=>e.isAbortError(P)?!1:(K.cacheState=v.CacheState.Uncached,
!0))}_enableFromGPUCache(K,L){if(this._disableMemCache||null==this._index)return!1;if(L===v.NodeState.Hole&&!this._index.useNodeAsHole(K.index))return!0;const P=this._loadCachedGPUData(K);if(!P)return!1;this.layerView.addCachedGPUData(K,P,L);this._nodeAdded();return!0}_loadCachedGPUData(K){K=this.layerView.loadCachedGPUData(K.index);if(null!=K?.attributeInfo&&D(K.attributeInfo.loadedAttributes,this._requiredAttributes))return K;this.layerView.deleteCachedGPUData(K);return null}_nodeAdded(){null!=
this._index&&this._index.requestUpdate();this._lodHandling.setLodGlobalDirty();this._evaluateUpdating()}updateLoadStatus(K,L){const P=this._index;null!=P&&P.updateChildrenLoaded(K,L?1:-1)}async _loadCached(K,L){if(this._enableFromGPUCache(K,v.NodeState.Leaf))return!0;const P=this.layerView;if(this.disableIDBCache||!P.loadCachedNodeData||!P.addCachedNodeData)return!1;const R=(fa,ha)=>this._nodeLoader.loadTextures(K,fa,ha),W=(fa,ha)=>this._clientNodeLoader.loadTextures(K,fa,ha),V=0<=K.index?R:W,ba=
await this.schedule(()=>P.loadCachedNodeData(K,L,V),L);if(null==ba)return!1;const U=this._requiredAttributes,da=await this.reschedule(()=>this._loadAttributes(K,U,L),L);await this.reschedule(()=>P.addCachedNodeData(K,ba,{loadedAttributes:U,attributeData:da},L),L);this._nodeAdded();return!0}_loadUncached(K,L){this._downloadingCount++;return this._loadNodeData(K,L).catch(P=>{this._downloadingCount--;throw P;}).then(P=>{this._downloadingCount--;return this.schedule(()=>this.layerView.addNode(K,P,L),
L)}).then(()=>{this._nodeAdded();K.cacheState=v.CacheState.Cached}).catch(P=>{if(!e.isAbortError(P))throw k.getLogger(this).error("#loadNodeData()",this.layer,`Failed to load node '${K.id}'`,P),K.failed=!0,null!=this._index&&this._index.requestUpdate(),P;})}_updateIdleState(K){K!==this._isIdle&&(this._isIdle=K,this._evaluateUpdating(),K&&this._index&&null!=this._index&&this._index.resetFailedNodes())}get test(){}notifyLODUpdate(){this._lodHandling.setLodGlobalDirty();this._evaluateUpdating();null!=
this._index&&this._index.requestUpdate()}geometryFilterChanged(K){const L=this._index;null!=L&&L.layerFilterChanged(K);this._setCameraDirty()}};a.__decorate([d.property({readOnly:!0})],b.prototype,"isMeshPyramid",null);a.__decorate([d.property({readOnly:!0})],b.prototype,"isGraphics3D",null);a.__decorate([d.property({readOnly:!0})],b.prototype,"useMaximumNumberOfFeatures",null);a.__decorate([d.property({readOnly:!0})],b.prototype,"indexStreamController",null);a.__decorate([d.property({readOnly:!0})],
b.prototype,"dataStreamController",null);a.__decorate([d.property({readOnly:!0})],b.prototype,"crsVertex",null);a.__decorate([d.property({readOnly:!0})],b.prototype,"crsIndex",null);a.__decorate([d.property()],b.prototype,"screenSizeFactor",void 0);a.__decorate([d.property()],b.prototype,"featureTarget",void 0);a.__decorate([d.property()],b.prototype,"fixedFeatureTarget",void 0);a.__decorate([d.property()],b.prototype,"layerView",void 0);a.__decorate([d.property()],b.prototype,"layer",null);a.__decorate([d.property()],
b.prototype,"updating",void 0);a.__decorate([d.property({readOnly:!0})],b.prototype,"running",null);a.__decorate([d.property()],b.prototype,"updatingProgress",void 0);a.__decorate([d.property({readOnly:!0})],b.prototype,"leavesReached",void 0);a.__decorate([d.property({constructOnly:!0})],b.prototype,"worker",void 0);a.__decorate([d.property({readOnly:!0,dependsOn:[]})],b.prototype,"rootNodeVisible",null);b=a.__decorate([c.subclass("esri.layers.graphics.controllers.I3SOnDemandController")],b);const J=
new p({deallocator:null});let N;const M={factorIM:.2,factor3dObject:.05,distancePenalty:10},Q=w.create();var O;(function(K){K[K.pop=0]="pop";K[K.fadeout=1]="fadeout"})(O||={});return b})},"esri/views/3d/layers/i3s/I3SClientNodeLoader":function(){define("exports ../../../../core/Error ../../../../core/maybe ../../../../core/MemCache ../../../../core/promiseUtils ../../../../core/uuid ../../../../core/libs/gl-matrix-2/math/mat3 ../../../../core/libs/gl-matrix-2/factories/mat3f64 ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../geometry/projection/projectBoundingSphere ../../../../geometry/support/meshVertexSpaceUtils ../../../../chunks/sphere ./I3SClientMaterialUtil".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w,x){async function u(v){return{id:v.id,version:v.meshNodeInfo.version,mbs:v.mbs,obb:null,sharedResource:null,geometryData:null,attributeData:null,featureData:null,children:null,isEmpty:!1}}function t(v,y){var {spatialReference:B}=v;const z=[1,-1],A=[.5*v.width,.5*v.height,v.hasZ?.5*(v.zmax-v.zmin):0];B=B.isGeographic?B.metersPerUnit:1;const C=v.center;let H=0;if(v.hasZ)for(v=0;2>v;++v)for(var E=0;2>E;++E)for(var F=0;2>F;++F){var G=(C.x+z[v]*A[0]-y.x)*B;const D=(C.y+
z[E]*A[1]-y.y)*B,I=C.z+z[F]*A[2]-y.z;H=Math.max(G*G+D*D+I*I,H)}else for(v=0;2>v;++v)for(E=0;2>E;++E)F=(C.x+z[v]*A[0]-y.x)*B,G=(C.y+z[E]*A[1]-y.y)*B,H=Math.max(F*F+G*G,H);return w.fromCenterAndRadius([y.x,y.y,y.z],Math.sqrt(H))}async function m(v,y,B,z){const {transform:A,vertexAttributes:C}=y.loadedMesh;v="source"===v.shading?C.normal:null;if(null==v||null==A||0===A.rotationAngle&&d.exactEquals(A.scale,f.ONES))return{transformed:v,original:C.normal};if(!y.normalsTransformPromise){n.assertIsSome(B,
"SceneLayerWorker is needed to transform mesh normals");const H=g.create();e.normalFromMat4(H,A.localMatrix);y.normalsTransformPromise=B.transformNormals({normalMatrix:H,normals:v},z)}return y.normalsTransformPromise}function q(v,y,B){v[y]=255&B;v[y+1]=255&B>>8;v[y+2]=255&B>>16;v[y+3]=255&B>>24}class r{constructor(v,y,B,z){this._uid=v;this._worker=z;this._id2Meta=new Map;this._oid2Meta=new Map;this._indexSR=y.indexSR;this._vertexSR=y.vertexSR;this._renderSR=y.renderSR;this._memCache=B.newCache(`sl-client-mesh-data-${this._uid}`)}get uid(){return this._uid}get worker(){return this._worker}get indexSR(){return this._indexSR}get renderSR(){return this._renderSR}createMeshNodeInfo(v,
y){const B=`mesh${y}`;var z=v.extent,A=z.spatialReference,C=this._indexSR;z=t(z,v.origin);c.projectBoundingSphere(z,A,z,C);C=v.metadata.displaySource?.source;if(null==C||!Array.isArray(C)||!C.length||C[0]instanceof File)A=h.generateUUID();else{A="";for(var H of C)A+=H.makeHash();H=JSON.stringify(v.transform?.toJSON()??"");C=l.isRelativeVertexSpace(v.vertexSpace)?JSON.stringify(v.vertexSpace.origin):"";var E=JSON.stringify(v.spatialReference);A=A+H+C+E}return{type:"mesh",id:B,version:A,oid:y,mbs:z,
componentNodeIds:[],unloadedMesh:v,nodeIndex:null,loadMeshPromise:null}}addMeshNode(v,y){if(null!=this.getMeshNodeIndex(y.oid))throw new b(`I3SClientNodeLoader: client side mesh for feature oid=${y.oid} already exists`);y.nodeIndex=v;this._id2Meta.set(y.id,y);this._oid2Meta.set(y.oid,y)}getMeshNodeIndex(v){v=this._oid2Meta.get(v);return null==v||"mesh"!==v.type?null:v.nodeIndex}getMeshNodeInfo(v){const y=this._oid2Meta.values();for(const B of y)if("mesh"===B.type&&B.id===v)return B;return null}removeNode(v){const y=
this._id2Meta.get(v);null!=y&&(this._id2Meta.delete(v),"mesh"===y.type&&this._oid2Meta.delete(y.oid))}async loadNodeJSON(v){const y=this._id2Meta.get(v);if(null==y)throw new b(`I3SClientNodeLoader::loadNodeJSON unable to find node ${v}`);switch(y.type){case "mesh":return this._loadMeshNodeJSON(y);case "mesh-component":return u(y);default:throw new b(`I3SClientNodeLoader::loadNodeJSON unable to handle node ${v}`);}}async _loadMeshNodeJSON(v){const y=v.id;var B=(await this._getMeshData(v)).loadedMesh;
if(null==B.components||0===B.components.length)return{id:y,version:null,mbs:v.mbs,obb:null,sharedResource:null,geometryData:null,attributeData:null,featureData:null,children:null};const z=[];B=B.components;for(let A=0;A<B.length;++A){const C=`${y}-component${A}`,H={type:"mesh-component",id:C,mbs:v.mbs,componentIndex:A,meshNodeInfo:v,textureData:new Map};this._id2Meta.set(H.id,H);v.componentNodeIds.push(C);z.push({id:H.id,href:null,mbs:H.mbs,obb:null})}return{id:y,version:null,mbs:v.mbs,obb:null,sharedResource:null,
geometryData:null,attributeData:null,featureData:null,children:z}}updateNodeIndex(v,y,B){(v=this._id2Meta.get(v))&&"mesh"===v.type&&(v.nodeIndex=B)}async loadNodeData(v,y){var B=this._id2Meta.get(v);if(null==B||"mesh-component"!==B.type)throw new b(`Failed to load client node data for node ${v} (unexpected node info)`);var z=B.meshNodeInfo,A=await this._getMeshData(z),C=A.loadedMesh;z=z.oid;if(null==C.components)throw new b(`Failed to load client node data for node ${v} (unexpected null reference)`);
v=C.components[B.componentIndex];const {material:H,requiredTextures:E,textureData:F}=await x.convertMeshMaterialToPBRMaterial(v.material);if(null!=F)for(var G of F)null!=G&&B.textureData.set(G.id,G);B={params:{material:H},type:"ArrayBufferView"};const {vertexSpace:D,origin:I,transform:J}=C;G=[I.x,I.y,I.z??0];A.projectionPromise||(n.assertIsSome(this._worker,"SceneLayerWorker is needed to project mesh"),A.projectionPromise=this._worker.project({positions:C.vertexAttributes.position,localMatrix:J?.localMatrix,
vertexSpace:D.toJSON(),origin:G,inSpatialReference:C.spatialReference.toJSON(),outSpatialReference:this._vertexSR.toJSON()},y));const {projected:N,original:M,projectedOrigin:Q}=await A.projectionPromise;C.vertexAttributes.position=M;const {transformed:O,original:K}=await m(v,A,this._worker,y);C.vertexAttributes.normal=K;p.throwIfAborted(y);y=v.faces;A=C.vertexAttributes.uv;C=C.vertexAttributes.color;v=y.length/3;var L=3*v,P,R=0;G=!1;var W=0;let V=!1;var ba=0;let U=!1;var da=0;let fa=0,ha=0;R=P=8;
P+=12*L;null!=O&&(G=!0,W=P,P+=12*L);null!=A&&(V=!0,ba=P,P+=8*L);null!=C&&(U=!0,da=P,P+=4*L);fa=P;ha=P+=8;P=new ArrayBuffer(P+8);const T=new Uint8Array(P);q(T,0,L);q(T,4,1);L=new Float32Array(P,R);W=null!=O?new Float32Array(P,W):null;ba=null!=A?new Float32Array(P,ba):null;da=null!=C?new Uint8Array(P,da):null;for(R=0;R<v;++R){const ka=3*R;for(let ja=0;3>ja;++ja){var S=y[ka+ja],Z=3*S,ia=9*R+3*ja;L[ia]=N[Z];L[ia+1]=N[Z+1];L[ia+2]=N[Z+2];null!=W&&(W[ia]=O[Z],W[ia+1]=O[Z+1],W[ia+2]=O[Z+2]);null!=ba&&(Z=
2*S,ia=6*R+2*ja,ba[ia]=A[Z],ba[ia+1]=A[Z+1]);null!=da&&(S*=4,Z=12*R+4*ja,da[Z]=C[S],da[Z+1]=C[S+1],da[Z+2]=C[S+2],da[Z+3]=C[S+3])}}q(T,fa,z);q(T,fa+4,z/2**32);q(T,ha,0);q(T,ha+4,v-1);const {geometryBuffer:Y,geometryDescriptor:ea}={geometryBuffer:P,geometryDescriptor:{isDraco:!1,isLegacy:!0,color:U,normal:G,uv0:V,uvRegion:!1,featureIndex:!0}};return{geometryData:{featureDataPosition:Q,featureIds:[],geometries:[B]},attributeDataInfo:{attributeData:{},loadedAttributes:[]},geometryBuffer:Y,geometryDescriptor:ea,
requiredTextures:E,textureData:F,normalReferenceFrame:this._vertexSR.isGeographic?"east-north-up":"vertex-reference-frame"}}async loadAttributes(v,y,B){v=v.numFeatures;B={};for(const {field:{name:z}}of y)B[z]=Array(v);return B}async loadTextures(v,y,B){B=this._id2Meta.get(v.id);if(null==B||"mesh-component"!==B.type)throw Error(`Failed to load textures for node ${v.id} (unexpected node info)`);v=[];for(const z of y)v.push(B.textureData.get(z.id)||null);return v}async _getMeshData(v){const y=v.version,
B=this._memCache.get(y);if(null==B){if(null!=v.loadMeshPromise)return v.loadMeshPromise;const z=async(A,C)=>{var H=v.unloadedMesh.clone();try{await H.load()}catch(E){C(E)}C=H.memoryUsage;H={loadedMesh:H,projectionPromise:null,normalsTransformPromise:null,usedMemoryInBytes:C};this._memCache.put(y,H,C,k.MinPriority);v.loadMeshPromise=null;A(H)};v.loadMeshPromise=new Promise((A,C)=>z(A,C));return v.loadMeshPromise}return B}}a.I3SClientNodeLoader=r;a.createSphereFromExtent=t;a.sizeOfFloat32=4;a.sizeOfInt32=
4;a.sizeOfUInt64=8;a.sizeOfUInt8=1;a.transformNormals=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/I3SClientMaterialUtil":function(){define("exports ../../../../Color ../../../../core/Error ../../../../support/requestUtils ../../glTF/internal/resourceUtils ./enums ../../webgl-engine/core/shaderLibrary/util/AlphaCutoff ../../webgl-engine/lib/basicInterfaces ../../webgl-engine/lib/textureUtils ../../webgl-engine/materials/pbrUtils".split(" "),function(a,
b,n,k,p,h,e,g,d,f){async function c(l,w,x,u){if(null==l)return-1;const t=x.length;var m=l.data;l=l.url;if(null!=m){if(m instanceof HTMLImageElement||m instanceof HTMLCanvasElement)return m=d.downsampleImage(m),x.push({id:t,usage:u,data:m,encoding:h.TextureEncoding.PNG,downsampled:!1}),w.push({id:t,usage:u,encodings:[{name:void 0,encoding:h.TextureEncoding.PNG}]}),t;if(!(m instanceof HTMLVideoElement)){if(m instanceof ImageData)throw new n("ImageData textures not supported yet for client side I3S nodes");
if(m instanceof p.EncodedMeshTexture)return x.push({id:t,usage:u,data:m.data,encoding:h.TextureEncoding.KTX2,downsampled:!1}),w.push({id:t,usage:u,encodings:[{name:void 0,encoding:h.TextureEncoding.KTX2}]}),t}}else if(null!=l)return m=new Image,m.src=l,m=await k.loadImageAsync(m,m.src,!1,void 0),m=d.downsampleImage(m),x.push({id:t,usage:u,data:m,encoding:h.TextureEncoding.PNG,downsampled:!1}),w.push({id:t,usage:u,encodings:[{name:void 0,encoding:h.TextureEncoding.PNG}]}),t;return-1}a.convertMeshMaterialToPBRMaterial=
async function(l){const w=[],x=[];if(null==l)return{material:{alphaMode:"opaque",alphaCutoff:e.alphaCutoff,doubleSided:!0,cullFace:0,normalTextureId:-1,emissiveTextureId:-1,occlusionTextureId:-1,emissiveFactor:[0,0,0],metallicRoughness:{baseColorFactor:[1,1,1,1],baseColorTextureId:-1,metallicRoughnessTextureId:-1,metallicFactor:0,roughnessFactor:.6000000238418579},wrapTextures:!1,hasParametersFromSource:!0},requiredTextures:w,textureData:x};const u=l.hasOwnProperty("metallicRoughnessTexture");"auto"===
l.alphaMode&&console.warn('alphaMode "auto" not supported by I3S PBRMaterial - defaulting to "blend".');const t=f.useSchematicPBR({normalTexture:l.normalTexture,emissiveTexture:u?l.emissiveTexture:null,emissiveFactor:u?b.toUnitRGB(l.emissiveColor):null,occlusionTexture:u?l.occlusionTexture:null,metallicRoughnessTexture:u?l.metallicRoughnessTexture:null,metallicFactor:u?l.metallic:null,roughnessFactor:u?l.roughness:null}),m=t?f.schematicMRRFactors[0]:u?l.metallic:0,q=t?f.schematicMRRFactors[1]:u?l.roughness:
0;return{material:{alphaMode:"auto"===l.alphaMode?"blend":l.alphaMode,alphaCutoff:l.alphaCutoff,doubleSided:l.doubleSided,cullFace:l.doubleSided?g.CullFaceOptions.None:g.CullFaceOptions.Back,normalTextureId:await c(l.normalTexture,w,x,h.TextureUsage.Normal),emissiveTextureId:u?await c(l.emissiveTexture,w,x,h.TextureUsage.Emissive):-1,occlusionTextureId:u?await c(l.occlusionTexture,w,x,h.TextureUsage.Occlusion):-1,emissiveFactor:u&&null!=l.emissiveColor?b.toUnitRGB(l.emissiveColor):[0,0,0],metallicRoughness:{baseColorFactor:null!=
l.color?b.toUnitRGBA(l.color):[1,1,1,1],baseColorTextureId:await c(l.colorTexture,w,x,h.TextureUsage.Color),metallicRoughnessTextureId:u?await c(l.metallicRoughnessTexture,w,x,h.TextureUsage.MetallicRoughness):-1,metallicFactor:m,roughnessFactor:q},wrapTextures:!0,hasParametersFromSource:t},requiredTextures:w,textureData:x}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/glTF/internal/resourceUtils":function(){define(["exports","../../../../core/has","../../webgl-engine/lib/basicInterfaces"],
function(a,b,n){class k{constructor(p){this.data=p;this.type="encoded-mesh-texture";this.encoding=n.TextureEncodingMimeType.KTX2_ENCODING}}a.EncodedMeshTexture=k;a.imageFromBinaryData=async function(p,h){if(h===n.TextureEncodingMimeType.KTX2_ENCODING)return new k(p);p=new Blob([p],{type:h});const e=URL.createObjectURL(p),g=new Image;if(b("esri-iPhone"))return new Promise((d,f)=>{const c=()=>{w();d(g)},l=x=>{w();f(x)},w=()=>{URL.revokeObjectURL(e);g.removeEventListener("load",c);g.removeEventListener("error",
l)};g.addEventListener("load",c);g.addEventListener("error",l);g.src=e});try{g.src=e,await g.decode()}catch(d){console.warn("Failed decoding HTMLImageElement")}URL.revokeObjectURL(e);return g};a.isEncodedMeshTexture=function(p){return"encoded-mesh-texture"===p?.type};a.jsonFromBinaryData=async function(p){p=await (new Blob([p])).text();return JSON.parse(p)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/enums":function(){define(["exports"],function(a){a.TextureEncoding=
void 0;(function(b){b[b.KTX2=1]="KTX2";b[b.Basis=2]="Basis";b[b.DDS_S3TC=4]="DDS_S3TC";b[b.PNG=8]="PNG";b[b.JPG=16]="JPG";b[b.KTX_ETC2=32]="KTX_ETC2"})(a.TextureEncoding||(a.TextureEncoding={}));a.TextureUsage=void 0;(function(b){b[b.None=0]="None";b[b.Color=1]="Color";b[b.MetallicRoughness=2]="MetallicRoughness";b[b.Normal=4]="Normal";b[b.Occlusion=8]="Occlusion";b[b.Emissive=16]="Emissive";b[b.AlphaMask=32]="AlphaMask";b[b.ColorTextures=19]="ColorTextures";b[b.GeometryTextures=36]="GeometryTextures";
b[b.GeometryTexturesPBR=44]="GeometryTexturesPBR";b[b.AllTextures=37]="AllTextures";b[b.AllTexturesPBR=63]="AllTexturesPBR"})(a.TextureUsage||(a.TextureUsage={}));Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/I3SFrameTask":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/arrayUtils ../../../../core/handleUtils ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/Logger ../../../../core/accessorSupport/decorators/subclass ../../../support/Scheduler".split(" "),
function(a,b,n,k,p,h,e,g,d,f){let c=class extends n{constructor(){super();this.referenceCount=0;this.callbacks=[];this.runIndex=0}get running(){return this.callbacks.some(x=>x.running)}runTask(x){this._sort();const u=this.callbacks,t={numIndexLoading:0,numNodesLoading:0};for(let m=0;m<u.length&&!x.done;++m)u[m].priority=u[m].runTask(x,t),this.runIndex=m}_sort(){const x=this.callbacks;let u=x.length;for(let t=this.runIndex;0<t;t--){const m=x[t-1];let q=t;for(;q<x.length&&m.priority<=x[q].priority&&
(q!==u||m.priority<x[q].priority);)x[q-1]=x[q],q++;x[q-1]=m;u=q-1}this.runIndex=0}add(x){this._sort();x.priority=Infinity;this.callbacks.unshift(x);this.notifyChange("running")}remove(x){k.removeUnordered(this.callbacks,x);this.runIndex=this.callbacks.length;this._sort();this.notifyChange("running")}};b.__decorate([h.property({readOnly:!0})],c.prototype,"running",null);c=b.__decorate([d.subclass("esri.views.3d.layers.i3s.I3SFrameTask")],c);class l{constructor(x,u){this.task=x;this.handle=u}}const w=
new Map;a.addCallback=function(x,u){let t=w.get(x);if(null==t){const m=new c,q=x.registerTask(f.TaskPriority.I3S_CONTROLLER,m);t=new l(m,q);w.set(x,t)}t.task.add(u);return p.makeHandle(()=>{null!=t&&(t.task.remove(u),0<t.task.callbacks.length||(w.delete(x),t.handle.remove(),t.task.destroy()),t=null)})};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/I3SIndex":function(){define("exports ../../../../core/has ../../../../core/PooledArray ../../../../core/promiseUtils ../../../../geometry/projection/projectBoundingSphere ../../../../chunks/sphere ./I3SNode ./I3SUtil ./ValidatedNode ../../support/ElevationRange ../../support/orientedBoundingBox".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c){function l(G,D){return 0>G?-1:0<D?G/D|0:0}function w(G,D){return 0>G?-G-1:0===D?G:G%D}function x(G,D,I){return-1===D?-(G+1):0===I?G:D*I+G}function u(G){if(G)for(let D=0;D<G.length;D++)for(const I of B)if(I[0]===G[D].metricType)return{lodMetric:I[1],maxError:G[D].maxError};return{lodMetric:e.LodMetric.None,maxError:0}}function t(G){return Math.sqrt(4/Math.PI*G)}class m{constructor(G,D,I,J,N){this.childOffset=G;this.childCount=D;this.visibilityCache=I;this.ref=J;this.node=
N;this.useAsHole=0;this.filterImpact=e.NodeFilterImpact.NotChecked;this.traversalState=null;this.parent=-1}invalidateBounds(){this.node?.invalidateServiceBVsInRenderSR();this.ref?.invalidateServiceBVsInRenderSR()}}class q{constructor(G=[],D=[]){this.nodes=G;this.children=D;this.numNodesWithLoadedChildren=this.lastTraversed=0}}class r{get _useNodePages(){return 0<this._pageSize}constructor(G,D,I,J,N,M,Q,O,K,L,P,R,W,V,ba,U){this.viewingMode=G;this._layer=D;this._streamDataController=J;this._clientNodeLoader=
N;this._viewportQueries=M;this._logger=Q;this.holeFilling=O;this._isLoaded=K;this._isReloading=L;this._isSelected=P;this._enable=R;this._needsUpdate=W;this._canRequest=V;this._computeVisibilityObb=ba;this._computeNodeFiltering=U;this._dirty=!0;this._nodePages=new Map;this._clientNodePage=null;this._rootIndex=this._pageSize=0;this._lodMetric=e.LodMetric.None;this._lodConversion=da=>da;this._isEditable=!1;this._urlPrefix="";this._loadingNodes=new Set;this._loadingPages=new Set;this._failedNodes=new Set;
this._failedPages=new Set;this._indexMissing=1;this._maxUnloadedPrio=Number.NEGATIVE_INFINITY;this._maxProcessingPrio=Number.POSITIVE_INFINITY;this._version=g.addWraparound(0,2);this._visibilityCacheVersion=g.addWraparound(0,2);this._maxLevel=1;this._featureEstimate={estimate:0,leavesReached:!1};this._unloadedMemoryEstimate=0;this._missingPagesAndNodes=new n({deallocator:null});this._prefetchNodes=new n({deallocator:null});this._updates=new y(this._missingPagesAndNodes);this._imModificationUncategorized=
new n({deallocator:null});this.ignoreServiceObb=!1;this.progressiveLoadPenalty=0;this._pageQueue=[];this._newPages=[];this._layerHasFilter=this.layerHasModifications=this.needNodeElevationRange=!1;this._frameNumber=0;this._traverseDescendantsQueue=[0];this._traverseDescendantsNestingLevel=0;this._isEditable=null!=D.associatedLayer?.infoFor3D;D.serviceUpdateTimeStamp?.lastUpdate&&(this._lastUpdate=`${D.serviceUpdateTimeStamp.lastUpdate}`);this._maxLodLevel=this._viewportQueries?this._viewportQueries.maxLodLevel:
1;this._init(I)}_init(G){if("page"===G.type){var D=G.rootPage;this._urlPrefix=G.urlPrefix;this._pageSize=G.pageSize;switch(G.lodMetric){case "maxScreenThreshold":this._lodMetric=e.LodMetric.MaxScreenThreshold;break;case "maxScreenThresholdSQ":this._lodMetric=e.LodMetric.MaxScreenThreshold,this._lodConversion=t}if(this._isEditable){this._rootIndex=-1;var I=w(G.rootIndex,G.pageSize);I=D.nodes[I];I={nodes:[{index:this._rootIndex,children:[G.rootIndex],mesh:void 0,obb:I.obb,lodThreshold:I.lodThreshold}]};
this._addPage(l(this._rootIndex,this._pageSize),I);this.getNode(-1).serviceObbInIndexSR=void 0}else this._rootIndex=G.rootIndex;this._addPage(l(G.rootIndex,this._pageSize),D);this._updateParentsAndLevel()}else"node"===G.type&&(this._urlPrefix=G.urlPrefix,D=new q,this._nodePages.set(0,D),this._isEditable?(this._clientNodePage=new q,D={id:"-1",version:null,mbs:G.rootNode.mbs,obb:G.rootNode.obb,sharedResource:null,geometryData:null,attributeData:null,featureData:null,children:[{id:"root",href:"../root",
mbs:G.rootNode.mbs,obb:G.rootNode.obb}]},this._rootIndex=this._makeClientRefNode(new e.NodeBase(D.id,null),-1),(D=this._validateNode(D.id,D))&&this._addNode(D,this._rootIndex)):this._rootIndex=this._makeRefNode(new e.NodeBase(G.rootNode.id,null),-1),(G=this._validateNode(G.rootNode.id,G.rootNode))&&this._addNode(G,0))}addClientNodeToIndex(G,D){G=new e.NodeBase(G,D);G=this._makeClientRefNode(G,-1);this._linkChildToParentNode(-1,G);this.requestUpdate();return G}removeClientNodeFromIndex(G,D,I){this._destroyClientRefNode(G,
D,I);this.requestUpdate()}_loadPage(G){this._loadingPages.add(G);this._streamDataController.request(this._urlPrefix+G,"json").then(D=>{this._pageQueue.push({pageIndex:G,page:D})}).catch(D=>{this._loadingPages.delete(G);k.isAbortError(D)||(this._failedPages.add(G),this._logger.error("#loadPage()",this._layer,`Error when loading page ${G}`,D))})}_addQueuedPages(G){for(;0<this._pageQueue.length&&!G.done;){const {pageIndex:D,page:I}=this._pageQueue.shift();this._addPage(D,I);this._loadingPages.delete(D);
G.madeProgress();this.needNodeElevationRange&&this._newPages.push(D)}this._updateParentsAndLevel()}_invalidateElevationRangeForNewPages(G){if(this.needNodeElevationRange)for(;0<this._newPages.length&&!G.done;)this._nodePages.get(this._newPages.shift())?.nodes.forEach(D=>{for(D=D.parent;null!=D&&D!==this._rootIndex;){const I=this.getNode(D);I&&!Number.isNaN(I?.elevationRangeMin)&&(I.invalidateElevationRange(),this.invalidateBoundingVolumeCache(D));D=this.getParentIndex(D)}})}_addPage(G,D){const I=
[],J=[];D=D.nodes.map((N,M)=>{const Q=I.length,O=N.children?N.children.length:0;J.push(this._rootIndex);for(var K=0;K<O;K++)I.push(N.children[K]);const L=`${N.index}`;K=c.Obb.fromJSON(N.obb);const P=h.fromCenterAndRadius(K.center,K.radius);var R=N.mesh?.attribute;const W=N.mesh?.geometry,V=N.mesh?.material;R={hasSharedResource:!1,isEmpty:null==W,attributes:null!=R?.resource?`${R.resource}`:void 0,geometry:null!=W?.resource?`${W.resource}`:void 0,texture:null!=V?.resource?`${V.resource}`:void 0,geometryDefinition:W?
W.definition:-1,materialDefinition:V?V.definition:-1};N=new e.Node(L,x(M,G,this._pageSize),P,O,0,R,this._lastUpdate,this._lodMetric,this._lodConversion(N.lodThreshold),W?W.featureCount:null);N.serviceObbInIndexSR=K;N.visibilityObbInRenderSR=this._computeVisibilityObb(N);N.vertexCount=W?W.vertexCount:0;return new m(Q,O,g.addWraparound(this._visibilityCacheVersion,-2),null,N)});D=new q(D,I);-1===G?this._clientNodePage=D:this._nodePages.set(G,D)}_updateParentsAndLevel(){const G=[],D=(I,J,N)=>{var M=
this._getPage(I);if(null!=M){const Q=w(I,this._pageSize);M=M.nodes[Q];M.parent=null!=J?J:-1;J=M.node;null!=J&&(J.level=N,G.push(I))}};for(D(this._rootIndex,null,0);G.length;){const I=G.pop(),J=this.getNode(I);if(null!=J)for(let N=0;N<J.childCount;N++){const M=this.getChildIndex(J.index,N);D(M,I,J.level+1);this._maxLevel=Math.max(this._maxLevel,J.level+1)}}}_getPage(G){G=l(G,this._pageSize);return this._getPageFromPageIndex(G)}_getPageFromPageIndex(G){return 0>G?this._clientNodePage:this._nodePages.get(G)}_getNodeInternal(G){const D=
this._getPage(G);if(null==D)return null;D.lastTraversed=this._frameNumber;return D.nodes[w(G,this._pageSize)]}_addNode(G,D){G.children&&this.populateChildren(D,G.children);var I=this.getParent(D);const J=null!=I?I.level+1:0;this._maxLevel=Math.max(this._maxLevel,G.children?J+1:J);const {lodMetric:N,maxError:M}=u(G.lodSelection);I=this._getNodeInternal(D);D=new e.Node(G.id,D,G.mbs,I.childCount,J,G.resources,G.version,N,M,G.numFeatures);I.node=D;G.obb&&(D.serviceObbInIndexSR=c.Obb.fromJSON(G.obb));
D.visibilityObbInRenderSR=this._computeVisibilityObb(D);I=I.ref;null!=I&&(null==I.serviceMbsInIndexSR&&(I.serviceMbsInIndexSR=G.mbs),D.shareServiceBVsInRenderSRWith(I),I.visibilityObbInRenderSR=D.visibilityObbInRenderSR);return D}_makeRefNode(G,D){const I=this._nodePages.get(0);if(-1>D)return this._makeClientRefNode(G,D);if(null==I)return-1;const J=I.nodes.length,N=new m(0,0,g.addWraparound(this._visibilityCacheVersion,-2),G,null);I.nodes.push(N);N.parent=D;G.invalidateServiceBVsInRenderSR();return J}_makeClientRefNode(G,
D){const I=this._clientNodePage;if(null==I)return-1;if(0<=D)throw Error("I3SIndex::client side nodes can not be made children of service side nodes.");const J=-(I.nodes.length+1),N=new m(0,0,g.addWraparound(this._visibilityCacheVersion,-2),G,null);I.nodes.push(N);N.parent=D;G.invalidateServiceBVsInRenderSR();return J}_linkChildToParentNode(G,D){const I=this._clientNodePage;if(!(null==I||0<=G)){var J=w(G,this._pageSize),N=w(D,this._pageSize);J=I.nodes[J];var M=J.childOffset;I.children.splice(J.childOffset+
J.childCount,0,D);J.childCount+=1;null!=J.node&&(J.node.childCount+=1);for(const Q of I.nodes)Q.childOffset>M&&(Q.childOffset+=1);I.nodes[N].parent=G;this._updateParentBoundingInformation(G)}}_destroyClientRefNode(G,D,I){const J=this._clientNodePage;if(null!=J){var N=this.getParentIndex(G);if(null!=N){var M=new Set,Q=new Map,O=da=>{var fa=w(da,this._pageSize);fa=J.nodes[fa];if(0<fa.childCount)for(var ha=fa.childOffset;ha<fa.childOffset+fa.childCount;++ha)O(J.children[ha]);ha=fa.node?.id??fa.ref?.id;
if(null==ha)throw Error("Node has no id");D(ha,da);M.add(fa)};O(G);G=J.nodes;var K=J.children,L=J.nodes.map(()=>-1),P=[],R=[];for(var W=0;W<G.length;++W){var V=G[W];if(!M.has(V)){var ba=P.length,U=x(W,-1,this._pageSize);ba=x(ba,-1,this._pageSize);V.node&&(V.node.index=ba);L[W]=ba;P.push(V);if(U!==ba){V=V.node?.id??V.ref?.id;if(null==V)throw Error("Node has no id");I(V,U,ba);Q.set(U,ba)}}}for(I=0;I<P.length;++I){Q=x(I,-1,this._pageSize);W=P[I];U=R.length;for(V=W.childOffset;V<W.childOffset+W.childCount;++V)if(ba=
K[V],0<=ba)R.push(ba);else{ba=w(ba,this._pageSize);const da=G[ba];M.has(da)||(R.push(L[ba]),da.parent=Q)}W.childOffset=U;W.childCount=R.length-U;W.node&&(W.node.childCount=W.childCount)}J.nodes=P;J.children=R;this._updateParentBoundingInformation(L[w(N,this._pageSize)])}}}_updateParentBoundingInformation(G){do{let J=null;var D=this._clientNodeLoader.indexSR;const N=this._clientNodeLoader.renderSR,M=this._getNodeInternal(G);if(null==M)break;for(let Q=0;Q<M.childCount;Q++){var I=this.getChildIndex(G,
Q);I=this._getNodeInternal(I);I=null!=I?I.ref||I.node:null;if(null!=I&&0<I.serviceMbsInIndexSR[3])if(null==J)J=h.copy(I.serviceMbsInIndexSR,A);else{const O=C,K=H,L=E;p.projectBoundingSphere(I.serviceMbsInIndexSR,D,O,N);p.projectBoundingSphere(J,D,K,N);h.union(O,K,L);p.projectBoundingSphere(L,N,J,D)}}D=Q=>{null!=Q&&(Q.serviceObbInIndexSR=null,null!=J?(Q.serviceMbsInIndexSR??(Q.serviceMbsInIndexSR=h.create()),h.copy(J,Q.serviceMbsInIndexSR)):g.invalidateMbs(Q.serviceMbsInIndexSR),Q.invalidateServiceBVsInRenderSR(),
Q.geometryObbInRenderSR=null)};D(M.ref);D(M.node);this.invalidateNodeVisibilityCacheInternal(M);G=this.getParentIndex(G)}while(null!=G)}populateChildren(G,D){var I=this._getNodeInternal(G);const J=this._getPage(G);I.childOffset=J.children.length;I.childCount=D.length;for(I=0;I<D.length;I++){const N=this._makeRefNode(D[I],G);J.children.push(N)}}getNode(G){G=this._getNodeInternal(G);return null!=G?G.node:null}getIndexById(G){let D;this._forAllNodes((I,J)=>{null!=I.node&&I.node.id===G?D=J:null!=I.ref&&
I.ref.id===G&&(D=J)});return D}getNodeById(G){G=this.getIndexById(G);return null!=G&&0<=G?this.getNode(G):null}getChildIndex(G,D){const I=this._getPage(G);if(null==I)return-1;G=I.nodes[w(G,this._pageSize)];return I.children[G.childOffset+D]}getParentIndex(G){const D=this._getPage(G);return null!=D&&G!==this._rootIndex?D.nodes[w(G,this._pageSize)]?.parent:null}getParent(G){G=this.getParentIndex(G);return null!=G?this.getNode(G):null}isLeaf(G){G=this._getNodeInternal(G);return null!=G&&0===G.childCount}get rootNode(){return this.getNode(this._rootIndex)}get isEditable(){return this._isEditable}removeAllGeometryObbs(){this._forAllNodes(G=>
{null!=G.node&&(G.node.geometryObbInRenderSR=null)})}invalidateVisibilityCache(){this._visibilityCacheVersion=g.addWraparound(this._visibilityCacheVersion,2)}invalidateNodeVisibilityCache(G){G=this._getNodeInternal(G);null!=G&&this.invalidateNodeVisibilityCacheInternal(G)}invalidateNodeVisibilityCacheInternal(G){G.visibilityCache=g.addWraparound(this._visibilityCacheVersion,-2)}invalidateBoundingVolumeCache(G){G=this._getNodeInternal(G);null!=G&&(G?.invalidateBounds(),this.invalidateNodeVisibilityCacheInternal(G))}updateElevationChanged(G){const D=
this._getNodeInternal(G);null!=D&&(this.needNodeElevationRange?(G=null!=D.node?D.node:D.ref,null!=G&&G.invalidateElevationRange()):this.invalidateBoundingVolumeCache(G))}invalidateGeometryVisibility(G){if(G=this._getNodeInternal(G)?.node)G.geometryObbInRenderSR=null,G.invalidateServiceBVsInRenderSR()}invalidateVisibilityObbs(){null!=this.rootNode&&this.traverse(this.rootNode,G=>{G.visibilityObbInRenderSR=this._computeVisibilityObb(G);G.geometryObbInRenderSR=null;return!0})}_isElevationRangeUpToDate(G){return this.needNodeElevationRange?
(G=G?.node??G?.ref)?G.elevationRangeValid:!0:!0}updateElevationRange(G){this._updateElevationRangeInternal(G,null)}_updateElevationRangeInternal(G,D){const I=this._getNodeInternal(G);if(!I)return!1;const J=I?.node??I?.ref;if(!J)return!1;if(J.elevationRangeValid)return D?.expandElevationRange(J),!0;const N=new f.ElevationRange;var M=!1;for(let O=0;O<I.childCount;O++){var Q=this.getChildIndex(G,O);Q=this._updateElevationRangeInternal(Q,N);M=M||!Q}(0===I.childCount||M)&&this._viewportQueries.expandElevationRange(J,
!I.node?.resources.isEmpty,N);M=J.elevationRangeMax;if(J.elevationRangeMin===N.elevationRangeMin&&M===N.elevationRangeMax)return D?.expandElevationRange(J),!0;I.node?.setElevationRange(N);I.ref?.setElevationRange(N);this.invalidateBoundingVolumeCache(G);D?.expandElevationRange(J);return!0}isNodeVisible(G){const D=this._getNodeInternal(G);if(null==D)return!0;var I=D.ref;if(null!=I&&!I.serviceMbsInIndexSR)return!0;if(this._isElevationRangeUpToDate(D)&&(D.visibilityCache&-2)===this._visibilityCacheVersion)return 1===
(D.visibilityCache&1);const J=D.node,N=this._viewportQueries;if(J){var M=N.ensureElevationAgnosticBoundingVolume(J),Q=N.isElevationAgnosticBoundingVolumeVisible(M);let O=Q;this.needNodeElevationRange&&Q&&(Q=N.getNodeObbInRenderSRIndependentOfElevationOffset(J),null!=Q&&(O=N.isObbVisibleIndependentOfElevation(M,Q)));if(!O)return D.visibilityCache=this._visibilityCacheVersion+0,!1}this._layerHasFilter&&this._computeNodeFiltering&&(null!=J||null!=I)&&D.filterImpact===e.NodeFilterImpact.NotChecked&&(M=
null!=J?J.serviceMbsInIndexSR:null!=I?I.serviceMbsInIndexSR:null,D.filterImpact=null!=M?this._computeNodeFiltering(M):e.NodeFilterImpact.Unmodified);M=null!=J&&D.filterImpact===e.NodeFilterImpact.Culled;if(M=!(null!=J&&J.imModificationImpact===e.NodeIMModificationImpact.Culled)&&!M)I=!J||I&&!J.visibilityObbInRenderSR?I??null:J,null!=I&&(this.needNodeElevationRange&&this.updateElevationRange(G),M=N.isNodeVisible(I));D.visibilityCache=this._visibilityCacheVersion+(M?1:0);return M}isGeometryVisible(G){if(!this.isNodeVisible(G))return!1;
G=this._getNodeInternal(G);return null==G?.node?.geometryObbInRenderSR||this.layerHasModifications&&G.node.imModificationImpact===e.NodeIMModificationImpact.NotChecked?!0:this._viewportQueries.isGeometryVisible(G.node)}_traverseCoverage(G,D,I,J,N){G=this._getPage(G);if(null!=G&&0!==D.childCount){var M=D.childOffset+D.childCount,Q=[];for(D=D.childOffset;D<M;++D){const O=G.children[D],K=this._getNodeInternal(O);null!=K?.node&&this.isGeometryVisible(O)&&Q.push(K)}J/=Q.length;for(const O of Q)G=O.node.index,
this._isLoaded(G)||this._isReloading(G)?(N.delta=Math.max(N.delta,I),N.coverage+=J):this._traverseCoverage(G,O,I+1,J,N)}}useNodeAsHole(G){if("off"===this.holeFilling)return!1;const D=this._getNodeInternal(G);if(null==D)return!1;if("always"===this.holeFilling)return!0;if((D.useAsHole&-2)===this._version)return 1===(D.useAsHole&1);const I={delta:0,coverage:0};this._traverseCoverage(G,D,0,1,I);G=.5>=I.delta*I.coverage;D.useAsHole=this._version+(G?1:0);return G}get maxLevel(){return this._maxLevel}get dirty(){return this._dirty}destroy(){this._updates.add.prune();
this._updates.update.prune()}requestUpdate(){this._dirty=!0;this._indexMissing=1;this._version=g.addWraparound(this._version,2)}imModificationsChanged(G){this.layerHasModifications=G;this._forAllNodes(({node:D})=>{null!=D&&(D.imModificationImpact=e.NodeIMModificationImpact.NotChecked,D.visibilityObbInRenderSR=this._computeVisibilityObb(D),D.hasModifications&&this.invalidateGeometryVisibility(D.index))});this.invalidateVisibilityCache()}layerFilterChanged(G){this._layerHasFilter=G;this._forAllNodes(D=>
{null!=D&&(D.filterImpact=e.NodeFilterImpact.NotChecked,D=D.node,null!=D&&this.invalidateNodeVisibilityCache(D.index))});this.invalidateVisibilityCache()}update(G,D,I){if(this._dirty){0<this._pageQueue.length&&this._addQueuedPages(D);this._invalidateElevationRangeForNewPages(D);this._maxProcessingPrio=this._maxUnloadedPrio=Number.NEGATIVE_INFINITY;this._missingPagesAndNodes.clear();this._prefetchNodes.clear();this._updates.reset(G);v.clear();var J=!0,N=new z,M=new z,Q=this._imModificationUncategorized;
Q.clear();var O=new Set,K=0;this.traverseVisible((L,P,R)=>{var W=l(L,this._pageSize);if(null==P)L=this._entryPriority(L),Infinity===L&&(L=this._entryPriority(R)),v.set(W,Math.max(L,v.get(W)||0)),this._loadingPages.has(W)||this._failedPages.has(W)||(this._missingPagesAndNodes.push(W),++K),this._maxProcessingPrio=Math.max(this._maxProcessingPrio,L);else{var V=P.node;this._updateNodeFeatureEstimate(V,M);if(null==V)P=this._entryPriority(L),this._loadingNodes.has(L)||this._failedNodes.has(L)||(this._missingPagesAndNodes.push(L),
v.set(L,P)),this._maxProcessingPrio=Math.max(this._maxProcessingPrio,P);else{R=this._getPage(L);if(0===this._missingPagesAndNodes.length&&!this._useNodePages)for(W=0;W<P.childCount;W++){const ba=R.children[P.childOffset+W],U=this._getNodeInternal(ba);null!=U&&!U.node&&!this._loadingNodes.has(ba)&&!this._failedNodes.has(ba)&&0<=ba&&(v.set(ba,this._entryPriority(ba)),this._prefetchNodes.push(ba))}V.failed||V.resources.isEmpty?J&&0<P.childCount&&this._isSelected(V)&&(J=!1):this._isLoaded(L)?(N.known+=
V.memory,++N.knownNodes,this._isSelected(V)?0<P.childCount&&(J=!1):(N.unremoved+=V.memory,J=!1),this._needsUpdate(V)&&(P=this._entryPriority(L),v.set(L,P),this._maxProcessingPrio=Math.max(this._maxProcessingPrio,P),this._updates.update.push(L))):(V.memory&&(N.known+=V.memory,++N.knownNodes),this._isSelected(V)?(0<P.childCount&&(J=!1),V.memory?(N.missing+=V.memory,N.known+=V.memory,++N.knownNodes):++N.missingNodes,G.includes(V.index)?(this._maxProcessingPrio=Math.max(this._maxProcessingPrio,this._entryPriority(L)),
this._updates.cancel=this._updates.cancel.filter(ba=>ba!==V.index)):!D.done&&this._enable(V)?D.madeProgress():(P=this._entryPriority(L),v.set(L,P),this._maxProcessingPrio=Math.max(this._maxProcessingPrio,P),this._updates.add.push(L),this.layerHasModifications&&I&&null!=V&&V.imModificationImpact===e.NodeIMModificationImpact.NotChecked&&Q.push(L))):this._isReloading(L)&&this._updates.remove.push(L))}}},O);this._frameNumber++;this._missingPagesAndNodes.sort((L,P)=>L-P);this._missingPagesAndNodes.filterInPlace((L,
P)=>1>P||this._missingPagesAndNodes.data[P-1]!==L);this._missingPagesAndNodes.sort((L,P)=>v.get(L)-v.get(P));0<this._missingPagesAndNodes.length&&(this._maxUnloadedPrio=v.get(this._missingPagesAndNodes.back()),this._prefetchNodes.clear());this._removeUnusedNodePages(O,K);O=this._updates.add;0<O.length&&this.layerHasModifications&&(0<Q.length&&I?.(Q),O.filterInPlace(L=>{var P=this._getNodeInternal(L);(P=null==P?.node||P.node.imModificationImpact!==e.NodeIMModificationImpact.Culled)||this.invalidateNodeVisibilityCache(L);
return P}));this._unloadedMemoryEstimate=N.missing-N.unremoved;3<N.knownNodes&&0<N.missingNodes&&(this._unloadedMemoryEstimate+=N.known/N.knownNodes*N.missingNodes);this._unloadedMemoryEstimate=.8*Math.max(0,this._unloadedMemoryEstimate);this._featureEstimate.estimate=this._computeFeatureEstimate(M);this._featureEstimate.leavesReached=J;this._updates.add.filterInPlace(L=>v.get(L)>=this._maxUnloadedPrio).sort((L,P)=>v.get(L)-v.get(P));this._updates.update.sort((L,P)=>v.get(L)-v.get(P));this._indexMissing=
this._loadingPages.size+this._loadingNodes.size+this._missingPagesAndNodes.length;this._dirty=0<this._indexMissing;v.clear()}}checkFeatureTarget(G,D){const I=this._viewportQueries.updateScreenSpaceErrorBias(D);let J=D,N=D,M=I,Q=10;for(;Q--;){const O=new z;this._updateFeatureEstimate(J,O);if(this._computeFeatureEstimate(O)<=G){if(J>=D||0<O.missingNodes||0===Q)break;M=J;J=.5*(J+N)}else N=J,J=.5*(J+M)}this._version=g.addWraparound(this._version,2);this._viewportQueries.updateScreenSpaceErrorBias(I);
return Math.min(D,J)}_removeUnusedNodePages(G,D){if(this._useNodePages){var I=G.size,J=this._nodePages;D=J.size+this._loadingPages.size+D;if(D>F&&D>I){I=[];for(const [N,M]of J)0!==M.numNodesWithLoadedChildren||G.has(N)||I.push([M.lastTraversed,N]);I.sort((N,M)=>N[0]-M[0]).some(N=>{this._deleteNodePage(N[1]);return J.size<=F})}}}_updateFeatureEstimate(G,D){this._version=g.addWraparound(this._version,2);this._viewportQueries.updateScreenSpaceErrorBias(G);this.traverseVisible((I,J)=>this._updateNodeFeatureEstimate(null!=
J?J.node:void 0,D))}_updateNodeFeatureEstimate(G,D){null!=G&&!G.failed&&null!=G.numFeatures&&this._isSelected(G)&&(null!=G.numFeatures?(D.missing+=G.numFeatures,D.known+=G.numFeatures,++D.knownNodes):++D.missingNodes)}_computeFeatureEstimate(G){let D=G.known-G.unremoved;3<G.knownNodes&&0<G.missingNodes&&(D+=G.known/G.knownNodes*G.missingNodes);return Math.max(0,D)}load(){return this._load(this._missingPagesAndNodes)}prefetch(){this._prefetchNodes.sort((G,D)=>v.get(G)-v.get(D));return this._load(this._prefetchNodes)}_load(G){if(0===
G.length||!this._canRequest())return!1;for(;0<G.length&&this._canRequest();){const D=G.pop();this._useNodePages?0<=D?this._loadPage(D):this._loadNode(D):this._loadNode(D)}return!0}get isLoading(){return 0<this._indexMissing}get isPrefetching(){return 0<this._prefetchNodes.length}get indexLoading(){return this._loadingPages.size+this._loadingNodes.size}get indexMissing(){return this._indexMissing}get unloadedMemoryEstimate(){return this._unloadedMemoryEstimate}get updates(){return this._updates}get featureEstimate(){return this._featureEstimate}get maxPriority(){return Math.max(this._maxProcessingPrio,
this._maxUnloadedPrio)}nodeTraversalState(G){if(null==G)return null;const D=G.index,I=this._getNodeInternal(D);if(!I)return null;let J=I?.traversalState;if(J&&(J.version&-2)===this._version)return J;const N=this._viewportQueries.getLodLevel(G),M=this._viewportQueries.hasLOD(G);let Q=!0;M?(G=this.getParentIndex(D),null!=G?(G=this._getNodeInternal(G)?.traversalState,Q=!!G&&N>G.lodLevel):Q=0<N):Q=0===G.childCount;if(J)return J.lodLevel=N,J.isChosen=Q,J.version=this._version+1,J;J=new e.NodeTraversalState(M,
Q,N,this._version+1);return I.traversalState=J}async _loadNode(G){this._loadingNodes.add(G);var D=this._getNodeInternal(G).ref;if(null==D)this._failedNodes.add(G);else{D=D.id;var I=this._urlPrefix+D,J=()=>{this._loadingNodes.delete(G);0===this._missingPagesAndNodes.length&&0===this._loadingNodes.size&&this.requestUpdate()},N=null;try{N=0<=G?await this._streamDataController.request(I,"json"):await this._clientNodeLoader.loadNodeJSON(D)}catch(M){J();k.isAbortError(M)||(this._logger.error("#loadNode()",
this._layer,"Error loading node: "+I),this._failedNodes.add(G));return}J();D=this._validateNode(D,N);null!=D&&(D.obb&&this.invalidateNodeVisibilityCache(G),D=this._addNode(D,G),this.nodeTraversalState(D))}}_validateNode(G,D){if(null==D||"object"!==typeof D||D.id!==G)return this._logger.error("#validateNode()",this._layer,`Invalid node. Wrong type or wrong id "${G}"`),null;if(!Array.isArray(D.mbs))return this._logger.error("#validateNode()",this._layer,`Invalid bounding volume on node ${G}.`),null;
D.sharedResource&&"./shared"!==D.sharedResource.href&&"./shared/"!==D.sharedResource.href&&this._logger.warn("#validateNode()",this._layer,`Invalid shared resource href on node "${G}"`);var I=D.geometryData;null==I||Array.isArray(I)&&0===I.length||Array.isArray(I)&&1===I.length&&"./geometries/0"===I[0].href||this._logger.warn("#validateNode()",this._layer,`Invalid geometry data on node "${G}"`);I=D.attributeData;const J=this._layer.attributeStorageInfo;null==I||Array.isArray(I)&&!I.some((O,K)=>O.href!==
`./attributes/${J?.[K]?.key??`f_${K}`}/0`)||this._logger.warn("#validateNode()",this._layer,`Invalid attribute data on node "${G}"`);D.featureData&&1<D.featureData.length&&this._logger.warn("#validateNode()",this._layer,`Node ${G} has ${D.featureData.length} bundles. Only the first bundle will be loaded.`);I=D.hasOwnProperty("obb")&&!this.ignoreServiceObb?D.obb:void 0;const N=D.featureData&&1===D.featureData.length&&D.featureData[0].featureRange?D.featureData[0].featureRange[1]-D.featureData[0].featureRange[0]+
1:void 0;var M=O=>{if(null==O)return null;var K=L=>this._logger.error("#validateNode()",this._layer,`Invalid node reference on node ${G}: ${L}`);if("number"===typeof O.id)K(`id ${O.id} is a number instead of a string.`);else if("string"!==typeof O.id||!Array.isArray(O.mbs))return K("Missing or invalid id."),null;if(!Array.isArray(O.mbs))return K(`Invalid bounding volume on reference ${O.id}.`),null;O.href&&O.href!=="../"+O.id&&this._logger.error("#validateNode()",this._layer,`Invalid node href on node "${G}"`);
K=new e.NodeBase(`${O.id}`,O.mbs);K.serviceObbInIndexSR=!this.ignoreServiceObb&&O.hasOwnProperty("obb")&&O.obb?c.Obb.fromJSON(O.obb):null;K.visibilityObbInRenderSR=this._computeVisibilityObb(K);return K};M=Array.isArray(D.children)?D.children.map(M).filter(O=>null!=O):null;const Q=!0===D.isEmpty;return new d.ValidatedNode(G,D.mbs,I,"string"===typeof D.version?D.version:null,{isEmpty:!(D.featureData?.length??!1)&&Q,hasSharedResource:null!=D.sharedResource,attributes:D.attributeData?G:void 0,texture:D.textureData&&
0<D.textureData.length?G:void 0,geometry:null!=D.geometryData?G:void 0},M,Array.isArray(D.lodSelection)?D.lodSelection:null,N)}resetFailedNodes(){this._failedNodes.clear();this._failedPages.clear();this._forAllNodes(G=>{null!=G.node&&(G.node.failed=!1)})}_entryPriority(G){var D=this._getNodeInternal(G),I=this.getParentIndex(G);if(null==D||null==I&&null==D.node)return null==I?Infinity:this._entryPriority(I);let J=0;D.node&&null!=I&&(I=this._getNodeInternal(I).traversalState,null!=I&&(J=I.lodLevel));
for(I=this.progressiveLoadPenalty;null!=G;G=this.getParentIndex(G))if(this._isLoaded(G)){I=0;break}D=null!=D.ref?this._viewportQueries.distToPOI(D.ref):null!=D.node?this._viewportQueries.distToPOI(D.node):0;return-D-J*(D+this.progressiveLoadPenalty)+I}traverseVisible(G,D){const I=this._getNodeInternal(this._rootIndex);null==I?G(this._rootIndex,null,null):this._traverseVisible(this._rootIndex,null,I,G,D)}_traverseVisible(G,D,I,J,N){var M=l(G,this._pageSize);N&&N.add(M);if(I.node&&0===I.childCount)this.isGeometryVisible(G)&&
J(G,I,D);else if(this.isNodeVisible(G)&&(J(G,I,D),null!=I.node&&(D=this.nodeTraversalState(I.node),!D?.nodeHasLOD||D.lodLevel!==this._maxLodLevel)))for(M=this._getPageFromPageIndex(M),D=0;D<I.childCount;D++){const O=M.children[I.childOffset+D];var Q=this._getNodeInternal(O);Q?this._traverseVisible(O,G,Q,J,N):(N&&(Q=l(O,this._pageSize),N.add(Q)),J(O,null,G))}}traverse(G,D){D(G)&&this.traverseDescendants(G,D)}traverseDescendants(G,D){++this._traverseDescendantsNestingLevel;G=G.index;var I=this._pageSize,
J=l(G,I),N=this._getPageFromPageIndex(J);if(null!=N){var M=this._frameNumber,Q=this._nodePages;N.lastTraversed=M;G=w(G,I);var O=N.nodes[G];({childCount:G}=O);if(0!==G){G=1===this._traverseDescendantsNestingLevel?this._traverseDescendantsQueue:[0];var K=0,L=[],{childOffset:P,childCount:R}=O;({children:O}=N);G.length=2**Math.ceil(Math.log2(K+R));for(var W=P;W<P+R;++W){var V=O[W];0<=V?(G[K]=V,++K):L.push(V)}if(0<L.length&&(O=this._clientNodePage))for(W=O.children,V=0;V<L.length;){var ba=L[V];++V;ba=
O.nodes[-ba-1];var U=ba.node;if(U&&D(U)&&({childCount:U}=ba,0!==U))for({childOffset:ba}=ba,U=ba+U;ba<U;++ba)L.push(W[ba])}if(0<K)if(L=0,0<I)for(J*=I,O=N.nodes;L<K;){V=G[L];++L;if(J<=V&&V<J+I)W=N;else{ba=V/I|0;W=Q.get(ba);if(void 0===W)continue;W.lastTraversed=M;N=W;O=N.nodes;J=I*ba}V=O[V-J];ba=V.node;if(null!=ba&&!1!==D(ba)&&({childCount:ba}=V,0!==ba)){G.length<K+ba&&(G.length=2**Math.ceil(Math.log2(K+ba)));for(;G.length<K+ba;)G.length+=G.length;W=W.children;({childOffset:V}=V);for(ba=V+ba;V<ba;++V)G[K]=
W[V],++K}}else if(I=Q.get(0))for(;L<K;)if(M=G[L],++L,Q=I.nodes[M],(M=Q.node)&&D(M)&&({childCount:N}=Q,0!==N))for(G.length=Math.max(G.length,2**Math.ceil(Math.log2(K+N))),M=I.children,{childOffset:Q}=Q,N=Q+N;Q<N;++Q)G[K]=M[Q],++K;--this._traverseDescendantsNestingLevel}}}updateChildrenLoaded(G,D){for(G=this.getNode(G);null!=G;){var I=G.childrenLoaded;const J=I+D;G.childrenLoaded=J;I=0===I?1:0===J?-1:0;G=G.index;0!==I&&(this._getPage(G).numNodesWithLoadedChildren+=I);G=this.getParent(G)}}checkChildrenLoadedInvariant(){if(null==
this.rootNode)return!0;const G=[],D=I=>{let J=this._isLoaded(I.index)||this._isReloading(I.index)?1:0;this.traverseDescendants(I,N=>{J+=D(N);return!1});I.childrenLoaded!==J&&G.push(I.index);return J};D(this.rootNode);G.length&&this._logger.error("childrenLoaded invariant broken at following nodes: "+G.join(","));return 0<G.length}updateElevationInfo(G,D){this.needNodeElevationRange=D&&!!G&&("relative-to-ground"===G.mode||"relative-to-scene"===G.mode||"on-the-ground"===G.mode);this._viewportQueries.updateElevationInfo(G);
this.invalidateAllElevationRanges()}invalidateAllElevationRanges(){this._forAllNodes(G=>{G?.invalidateBounds();G.node?.invalidateElevationRange();G.ref?.invalidateElevationRange()})}_forAllNodes(G){if(null!=this._clientNodePage){var D=this._clientNodePage;for(var I=0;I<D.nodes.length;I++)G(D.nodes[I],-(I+1))}for(const [J,N]of this._nodePages)for(D=J*this._pageSize,I=0;I<N.nodes.length;I++)G(N.nodes[I],D+I)}clearCaches(){if(this._useNodePages){const G=this._nodePages,D=new Set;this.traverseVisible(I=>
D.add(l(I,this._pageSize)));for(const [I,J]of G)if(0!==J.numNodesWithLoadedChildren||D.has(I))for(const N of J.nodes)N.traversalState=null;else this._deleteNodePage(I)}}_deleteNodePage(G){this._nodePages.delete(G)}get test(){}}const v=new Map;class y{constructor(G){this.missing=G;this.update=new n({deallocator:null});this.add=new n({deallocator:null});this.remove=new n({deallocator:null});this.cancel=[]}reset(G){this.add.clear();this.update.clear();this.cancel=G}}const B=[["maxScreenThreshold",e.LodMetric.MaxScreenThreshold],
["screenSpaceRelative",e.LodMetric.ScreenSpaceRelative],["removedFeatureDiameter",e.LodMetric.RemovedFeatureDiameter],["distanceRangeFromDefaultCamera",e.LodMetric.DistanceRangeFromDefaultCamera]];class z{constructor(){this.unremoved=this.missingNodes=this.missing=this.knownNodes=this.known=0}}const A=h.create(),C=h.create(),H=h.create(),E=h.create(),F=b("esri-mobile")?100:300;a.I3SIndex=r;a.selectErrorMetric=u;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/I3SNode":function(){define(["exports",
"../../../../core/libs/gl-matrix-2/factories/vec4f64","../../../../chunks/sphere","./I3SUtil","../../support/ElevationRange"],function(a,b,n,k,p){class h extends p.ElevationRange{constructor(d,f){super(NaN,NaN);this.id=d;this.serviceMbsInIndexSR=f;this.serviceMbsInRenderSR=n.fromValues(0,0,0,-1)}invalidateServiceBVsInRenderSR(){k.invalidateMbs(this.serviceMbsInRenderSR);this.serviceObbInRenderSR?.invalidate()}shareServiceBVsInRenderSRWith(d){this.serviceObbInRenderSR=d.serviceObbInRenderSR;this.serviceMbsInRenderSR=
d.serviceMbsInRenderSR}}a.NodeFilterImpact=void 0;(function(d){d[d.Unmodified=0]="Unmodified";d[d.Culled=1]="Culled";d[d.NotChecked=2]="NotChecked"})(a.NodeFilterImpact||(a.NodeFilterImpact={}));a.NodeIMModificationImpact=void 0;(function(d){d[d.Unmodified=0]="Unmodified";d[d.PotentiallyModified=1]="PotentiallyModified";d[d.Culled=2]="Culled";d[d.Unknown=3]="Unknown";d[d.NotChecked=4]="NotChecked"})(a.NodeIMModificationImpact||(a.NodeIMModificationImpact={}));class e extends h{constructor(d,f,c,l,
w,x,u,t,m,q){super(d,c);this.index=f;this.childCount=l;this.level=w;this.resources=x;this.version=u;this.lodMetric=t;this.maxError=m;this.numFeatures=q;this.failed=!1;this.cacheState=a.CacheState.Unknown;this.childrenLoaded=this.memory=this.vertexCount=0;this.hasModifications=!1;this.imModificationImpact=a.NodeIMModificationImpact.NotChecked;this.elevationAgnosticBoundingVolume=b.fromValues(0,0,0,-1)}invalidateServiceBVsInRenderSR(){super.invalidateServiceBVsInRenderSR();this.elevationAgnosticBoundingVolume[3]=
-1}}a.CacheState=void 0;(function(d){d[d.Unknown=0]="Unknown";d[d.Uncached=1]="Uncached";d[d.Cached=2]="Cached"})(a.CacheState||(a.CacheState={}));a.LodMetric=void 0;(function(d){d[d.None=0]="None";d[d.MaxScreenThreshold=1]="MaxScreenThreshold";d[d.ScreenSpaceRelative=2]="ScreenSpaceRelative";d[d.RemovedFeatureDiameter=3]="RemovedFeatureDiameter";d[d.DistanceRangeFromDefaultCamera=4]="DistanceRangeFromDefaultCamera"})(a.LodMetric||(a.LodMetric={}));a.NodeState=void 0;(function(d){d[d.Hole=0]="Hole";
d[d.Leaf=1]="Leaf"})(a.NodeState||(a.NodeState={}));class g{constructor(d,f,c,l){this.nodeHasLOD=d;this.isChosen=f;this.lodLevel=c;this.version=l}}a.Node=e;a.NodeBase=h;a.NodeTraversalState=g;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/ValidatedNode":function(){define(["exports"],function(a){class b{constructor(n,k,p,h,e,g,d,f){this.id=n;this.mbs=k;this.obb=p;this.version=h;this.resources=e;this.children=g;this.lodSelection=d;this.numFeatures=f}}a.ValidatedNode=
b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/I3SLodHandling":function(){define(["../../../../core/PooledArray","./I3SNode","../support/I3SLayerView"],function(a,b,n){class k{constructor(h){this._layerView=h;this._lodGlobalDirty=!1}startNodeLoading(h,e,g){this._maxLodLevel=g.maxLodLevel;this._index=e;this._removeNodes=h}shouldLoadNode(h){if(null==h)return!1;const e=this._index.nodeTraversalState(h);return this._isChosenMaxLOD(e)?!0:e.isChosen?this._childrenRequireLoading(h):
!1}setLodGlobalDirty(){this._lodGlobalDirty=!0}get requiresLODGlobalHandling(){return null!=this._index&&!0===this._lodGlobalDirty}lodGlobalHandling(h){if(!this.requiresLODGlobalHandling)return!1;this._lodGlobalDirty=!1;var e=Math.max(0,Math.floor(10*(this._layerView.view.resourceController.memoryController.usedMemory-1)));p.clear();this._lodGlobalHandling(this._index.rootNode,e,!1,!!this._layerView.nodeCrossfadingEnabled);e=p.length;this._removeNodes(p,h);h=p.length<e;0!==p.length&&(this._lodGlobalDirty=
!0);p.clear();return h}_lodGlobalHandling(h,e,g,d){if(null==h)return!1;const f=h.index,c=this._index,l=this._layerView;var w=c.nodeTraversalState(h);w=this._isChosenMaxLOD(w);var x=h.resources.isEmpty;if(w&&x)return 0<h.childrenLoaded&&this._removeChildrenRecursive(h),!0;x=l.isNodeLoaded(f);if(d&&x&&w){var u=!g&&this.hasNoVisibleChildren(h);l.fadeNode(f,n.FadeDirection.FadeIn,!u)}u=x&&(!l.isNodeFullyFadedIn||l.isNodeFullyFadedIn(f));if(x&&(l.updateNodeState(f,w?b.NodeState.Leaf:b.NodeState.Hole),
w))return u&&this._removeChildrenRecursive(h),u;var t=0<h.childCount;let m=t;if(t)for(t=0;t<h.childCount;t++){const q=c.getChildIndex(f,t),r=c.getNode(q);null!=r?c.isGeometryVisible(q)&&!this._lodGlobalHandling(r,e,g||u,d)&&(m=!1):c.isNodeVisible(q)&&(m=!1)}(e=x&&!w&&(m||p.length<e))&&p.push(f);!d||e||!x||g||m||l.fadeNode(f,n.FadeDirection.FadeIn,!1);h=h.resources.isEmpty;return m||u&&!e||h}_removeChildrenRecursive(h){this._index.traverseDescendants(h,e=>{(this._layerView.isNodeLoaded(e.index)||this._layerView.isNodeReloading(e.index))&&
p.push(e.index);return 0<e.childrenLoaded})}hasNoVisibleChildren(h){let e=!0;this._index.traverseDescendants(h,g=>e&&this._index.isNodeVisible(g.index)?this._layerView.isNodeLoaded(g.index)?e=!1:0<g.childrenLoaded:!1);return e}_childrenRequireLoading(h){let e=!1,g=!0;this._index.traverseDescendants(h,d=>{if(!g||!this._index.isNodeVisible(d.index))return!1;const f=this._index.nodeTraversalState(d);this._isChosenMaxLOD(f)&&this._index.isGeometryVisible(d.index)&&(e=!0);return this._layerView.isNodeLoaded(d.index)?
g=!1:0<d.childrenLoaded});return g&&e}_isChosenMaxLOD(h){return h.isChosen&&(!h.nodeHasLOD||h.lodLevel===this._maxLodLevel)}}const p=new a({deallocator:null});return k})},"esri/views/3d/layers/support/I3SLayerView":function(){define(["exports"],function(a){a.FadeDirection=void 0;var b=a.FadeDirection||(a.FadeDirection={});b[b.FadeIn=0]="FadeIn";b[b.FadeOut=1]="FadeOut";Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/I3SNodeLoader":function(){define("../../../../core/asyncUtils ../../../../core/has ../../../../core/lang ../../../../core/promiseUtils ../../../../core/urlUtils ./enums ./I3SBinaryReader ./I3SMaterialUtil".split(" "),
function(a,b,n,k,p,h,e,g){class d{constructor(f,c,l,w,x,u){this._streamDataController=c;this._logger=l;this._defaultGeometrySchema=w;this._requiredAttributes=x;this._options=u;this._logLayer=f;this._layerUrl=f.parsedUrl.path;this._geometryDefinitions=f.geometryDefinitions;if(f.materialDefinitions){const t=f.textureSetDefinitions;this._materialAndTextures=f.materialDefinitions.map(m=>g.getMaterialAndTextures(t,m,"integrated-mesh"===f.type))}}_load(f,c,l){return this._streamDataController.request(f,
c,l)}_loadAttribute(f,c,l){return this._load(`${this._layerUrl}/nodes/${f.resources.attributes}/attributes/${c.key}/0`,"binary",l).then(w=>e.readBinaryAttribute(c,w))}async loadAttributes(f,c,l){const w=await Promise.allSettled(c.map(t=>this._loadAttribute(f,t.attributeStorageInfo,l))),x={};for(let t=0;t<c.length;++t){var u=w[t];const m=c[t];"fulfilled"===u.status?x[m.name]=u.value:(u=u.reason,k.throwIfAbortError(u),this._logger.error("#loadAttributes",this._logLayer,`Failed to load attributeData for '${m.name}' on node '${f.id}'`,
u))}return x}async loadNodeData(f,c){var l=null!=this._requiredAttributes&&f.resources.attributes?a.result(this.loadAttributes(f,this._requiredAttributes,c)):null;var w=this._geometryDefinitions;var x={bufferDefinition:null,bufferIndex:0};var u=f.resources.geometryDefinition;if(!(null==w||null==u||0>u)&&(w=0<=u?w[u].geometryBuffers:null,null!=w))for(u=0;u<w.length;u++){var t=w[u];if(null!=t.compressedAttributes){if("draco"===t.compressedAttributes.encoding&&!b("disable-feature:i3s-draco")){x.bufferIndex=
u;x.bufferDefinition=t;break}}else x.bufferIndex=u,x.bufferDefinition=w[u]}const {bufferDefinition:m,bufferIndex:q}=x;u=(t=!!f.resources.geometry)?a.result(this._loadGeometry(f.resources.geometry,q,c)):null;w=f.resources.hasSharedResource?await this._loadShared(f,c):null;x=f.resources.materialDefinition;x=this._materialAndTextures&&null!=x&&0<=x?this._materialAndTextures[x]:null!=w?g.getMaterialAndTexturesFromShared(w):null;var r=x?.material;x=x?.textures??[];const v=`${f.id}`,y=!t&&this._options.loadFeatureData;
t=y?await this._loadFeatureData(v,c):null;if(y)a:{if(t)for(z of t.featureData)if(r=z.geometries,null!=r)for(var B of r){var z={featureIds:[z.id],featureDataPosition:z.position,geometries:[B]};break a}z=null}else z={featureIds:[],geometries:[{type:"ArrayBufferView",params:{material:r}}],featureDataPosition:[0,0,0]};if(null==z)if(t){B=[];for(A of t.featureData)null!=A.position&&B.push({featureIds:[A.id],featureDataPosition:A.position,geometries:[]});var A=B}else A=null;else A=null;B=0<x.length?a.result(this.loadTextures(f,
x,c)):null;c=f=null;u&&(f=a.assertResult(await u),(c=this._defaultGeometrySchema)&&w?.materialDefinitions&&(u=Object.keys(w.materialDefinitions)[0],!w.materialDefinitions[u].params.vertexRegions&&c.vertexAttributes.region&&(c=n.clone(c),delete c.vertexAttributes.region)),c=e.createGeometryDescriptor(m,c));w=B?a.assertResult(await B):null;l=(l=l?a.assertResult(await l):{})?{attributeData:l,loadedAttributes:this._requiredAttributes}:null;if(null!=z)return{geometryData:z,attributeDataInfo:l,geometryBuffer:f,
geometryDescriptor:c,requiredTextures:x,textureData:w};if(null!=A)return{pointData:A,attributeDataInfo:l,geometryBuffer:f,geometryDescriptor:c,requiredTextures:x,textureData:w};throw Error();}static _addAbsoluteHrefTexture(f,c){f=f.textureDefinitions;if(null!=f)for(const l of Object.keys(f))for(const w of f[l].images)Array.isArray(w.href)?w.hrefConcat=w.href.map(x=>p.makeAbsolute(x,c)):w.hrefConcat=p.makeAbsolute(w.href,c)}static _fixTextureEncodings(f){f=f.textureDefinitions;if(null!=f)for(const l in f){const w=
f[l];if(Array.isArray(w.encoding))for(var c=0;c<w.encoding.length;c++){const x=w.encoding[c];"data:"===x.slice(0,5)&&(w.encoding[c]=x.slice(5))}else c=w.encoding,"data:"===c.slice(0,5)&&(w.encoding=c.slice(5))}}async _loadShared(f,c){if(null==f.resources.geometry)return{};f=`${this._layerUrl}/nodes/${f.resources.geometry}/shared`;c=await this._load(f,"json",c);d._fixTextureEncodings(c);d._addAbsoluteHrefTexture(c,f);return c}_loadTexture(f,c,l,w,x,u){let t=!1;return x===h.TextureEncoding.DDS_S3TC||
x===h.TextureEncoding.KTX2||x===h.TextureEncoding.Basis?this._load(f,"binary",u).then(m=>({id:c,usage:l,data:m,encoding:x,downsampled:t})):this._load(f,"image",u).then(m=>{var q=m;if(w&&4096<=m.width*m.height){q=Math.ceil(m.width/2);const r=Math.ceil(m.height/2),v=document.createElement("canvas");v.width=q;v.height=r;v.getContext("2d").drawImage(m,0,0,q,r);q=v;t=!0}return{id:c,usage:l,data:q,encoding:x,downsampled:t}})}loadTextures(f,c,l){const w=!!this._options.uncompressedTextureDownsamplingEnabled,
x=this._options.textureUsageMask;return Promise.all(c.map(u=>{if(0===(u.usage&x))return null;const t=g.selectEncoding(u.encodings,this._options.textureEncodings);return null==t?(this._logger.error("#loadTextures",this._logLayer,`No known encoding for texture found on node ${f.id}`),Promise.reject()):this._loadTexture(`${this._layerUrl}/nodes/${f.resources.texture||f.id}/textures/${t.name}`,u.id,u.usage,w,t.encoding,l)}))}_loadFeatureData(f,c){return this._load(`${this._layerUrl}/nodes/${f}/features/0`,
"json",c)}_loadGeometry(f,c,l){return this._load(`${this._layerUrl}/nodes/${f}/geometries/${c}`,"binary",l)}}return d})},"esri/views/3d/layers/i3s/I3SMaterialUtil":function(){define("exports ../../../../core/has ../../../../core/mathUtils ./enums ../../webgl-engine/core/material/RenderTexture ../../webgl-engine/core/shaderLibrary/util/AlphaCutoff ../../webgl-engine/core/shaderLibrary/util/EllipsoidMode ../../webgl-engine/lib/basicInterfaces ../../webgl-engine/lib/Texture ../../webgl-engine/materials/pbrUtils ../../../webgl/enums".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c){function l(v){return v.sort((y,B)=>y.encoding-B.encoding)}function w(v,y,B){if(null==v||B===k.TextureUsage.None)return null;for(let z=0;z<v.length;z++){const A=v[z];if(null!=A&&0!==(A.usage&B))return v=y[z],null!=v?v.id:null}return null}function x(v){switch(v){case k.TextureEncoding.KTX2:return g.TextureEncodingMimeType.KTX2_ENCODING;case k.TextureEncoding.Basis:return g.TextureEncodingMimeType.BASIS_ENCODING;case k.TextureEncoding.DDS_S3TC:return g.TextureEncodingMimeType.DDS_ENCODING;
case k.TextureEncoding.PNG:return"image/png";case k.TextureEncoding.JPG:return"image/jpeg";case k.TextureEncoding.KTX_ETC2:return"image/ktx";default:return""}}const u={ktx2:k.TextureEncoding.KTX2,basis:k.TextureEncoding.Basis,dds:k.TextureEncoding.DDS_S3TC,png:k.TextureEncoding.PNG,jpg:k.TextureEncoding.JPG,"ktx-etc2":k.TextureEncoding.KTX_ETC2},t={[g.TextureEncodingMimeType.KTX2_ENCODING]:k.TextureEncoding.Basis,[g.TextureEncodingMimeType.BASIS_ENCODING]:k.TextureEncoding.Basis,[g.TextureEncodingMimeType.DDS_ENCODING]:k.TextureEncoding.DDS_S3TC,
"image/png":k.TextureEncoding.PNG,"image/jpg":k.TextureEncoding.JPG,"image/jpeg":k.TextureEncoding.JPG,"image/ktx":k.TextureEncoding.KTX_ETC2},m=()=>({alphaMode:"opaque",alphaCutoff:h.alphaCutoff,doubleSided:!0,cullFace:g.CullFaceOptions.None,normalTextureId:-1,emissiveTextureId:-1,occlusionTextureId:-1,emissiveFactor:[0,0,0],metallicRoughness:{baseColorFactor:[.8,.8,.8,1],baseColorTextureId:-1,metallicRoughnessTextureId:-1,metallicFactor:0,roughnessFactor:.6},wrapTextures:!1,hasParametersFromSource:!0}),
q={s:c.TextureWrapMode.CLAMP_TO_EDGE,t:c.TextureWrapMode.CLAMP_TO_EDGE},r={s:c.TextureWrapMode.REPEAT,t:c.TextureWrapMode.REPEAT};a.configureMaterial=function(v,y,B,z,A,C){const H=C.rendererTextureUsage;var E=y.metallicRoughness.baseColorFactor,F=n.clamp(y.metallicRoughness.baseColorFactor[3],0,1);v.baseColor=[E[0],E[1],E[2],F];v.hasParametersFromSource=!!y.hasParametersFromSource;v.usePBR=C.usePBR;v.mrrFactors=[y.metallicRoughness.metallicFactor,y.metallicRoughness.roughnessFactor,y.hasParametersFromSource?
f.schematicMRRFactors[2]:f.advancedMRRFactors[2]];v.emissiveFactor=y.emissiveFactor;v.isIntegratedMesh=C.isIntegratedMesh;v.textureAlphaCutoff="mask"===y.alphaMode?y.alphaCutoff:h.alphaCutoff;v.alphaDiscardMode="opaque"===y.alphaMode?g.AlphaDiscardMode.Opaque:"mask"===y.alphaMode?g.AlphaDiscardMode.Mask:g.AlphaDiscardMode.MaskBlend;E=[];F=w(z,B,(k.TextureUsage.Color|k.TextureUsage.AlphaMask)&H);null!=F&&(v.baseColorTexture=new p.RenderTexture(A,F),E.push(v.baseColorTexture.loadPromise));F=w(z,B,k.TextureUsage.MetallicRoughness&
H);null!=F&&(v.metallicRoughnessTexture=new p.RenderTexture(A,F),E.push(v.metallicRoughnessTexture.loadPromise));F=w(z,B,k.TextureUsage.Emissive&H);null!=F&&(v.emissionTexture=new p.RenderTexture(A,F),E.push(v.emissionTexture.loadPromise));F=w(z,B,k.TextureUsage.Occlusion&H);null!=F&&(v.occlusionTexture=new p.RenderTexture(A,F),E.push(v.occlusionTexture.loadPromise));B=w(z,B,k.TextureUsage.Normal&H);null!=B&&(v.normalTexture=new p.RenderTexture(A,B),E.push(v.normalTexture.loadPromise));v.commonMaterialParameters.hasSlicePlane=
C.slicePlaneEnabled;v.commonMaterialParameters.doubleSided=y.doubleSided;v.commonMaterialParameters.cullFace=y.cullFace;v.ellipsoidMode=e.getEllipsoidMode(C.viewSpatialReference);return Promise.all(E)};a.createTexture=function(v,y,B,z){if(null==v?.data)return null;const A=v.data;z=z.renderingContext.parameters.maxMaxAnisotropy;const C=1<z;B=B||!y.wrapTextures?q:r;const H=x(v.encoding);return new d.Texture(A,{mipmap:C,maxAnisotropy:z,encoding:H,wrap:B,components:v.usage&k.TextureUsage.Color?"opaque"===
y.alphaMode?3:4:3,noUnpackFlip:!0})};a.defaultMaterial=m;a.getMaterialAndTextures=function(v,y,B){const z=new Map,A=(I,J)=>{if(null==I)return-1;var N=z.get(I.id);if(N)return N.usage|=J,N.id;N=z.size;z.set(I.id,{id:N,usage:J});return N};var C=y.pbrMetallicRoughness;const H=C?.baseColorFactor,E=y.emissiveFactor,F=(B=b("disable-feature:diffuse-rendering-i3s")||B?f.useSchematicPBRI3S({normalTexture:y.normalTexture,emissiveTexture:y.emissiveTexture,emissiveFactor:y.emissiveFactor,occlusionTexture:y.occlusionTexture,
metallicRoughnessTexture:C?.metallicRoughnessTexture,metallicFactor:C?.metallicFactor,roughnessFactor:C?.roughnessFactor}):f.useSchematicPBR({normalTexture:y.normalTexture,emissiveTexture:y.emissiveTexture,emissiveFactor:y.emissiveFactor,occlusionTexture:y.occlusionTexture,metallicRoughnessTexture:C?.metallicRoughnessTexture,metallicFactor:C?.metallicFactor,roughnessFactor:C?.roughnessFactor}))?f.schematicMRRFactors[0]:C?.metallicFactor??f.advancedMRRFactors[0],G=B?f.schematicMRRFactors[1]:C?.roughnessFactor??
f.advancedMRRFactors[1];C={baseColorFactor:H?[H[0],H[1],H[2],H[3]]:[1,1,1,1],baseColorTextureId:A(C?.baseColorTexture,"mask"===y.alphaMode?k.TextureUsage.Color|k.TextureUsage.AlphaMask:k.TextureUsage.Color),metallicRoughnessTextureId:A(C?.metallicRoughnessTexture,k.TextureUsage.MetallicRoughness),metallicFactor:F,roughnessFactor:G};y={alphaMode:y.alphaMode,alphaCutoff:y.alphaCutoff,doubleSided:y.doubleSided,cullFace:"none"===y.cullFace?g.CullFaceOptions.None:"back"===y.cullFace?g.CullFaceOptions.Back:
"front"===y.cullFace?g.CullFaceOptions.Front:g.CullFaceOptions.None,normalTextureId:A(y.normalTexture,k.TextureUsage.Normal),emissiveTextureId:A(y.emissiveTexture,k.TextureUsage.Emissive),occlusionTextureId:A(y.occlusionTexture,k.TextureUsage.Occlusion),emissiveFactor:E?[E[0],E[1],E[2]]:[0,0,0],metallicRoughness:C,wrapTextures:!1,hasParametersFromSource:B};const D=[];z.forEach(({usage:I},J)=>{var N=null!=v&&v[J]&&v[J].formats;N=N?l(N.map(({name:M,format:Q})=>({name:M,encoding:u[Q]}))):[];D.push({id:J,
usage:I,encodings:N})});return{material:y,textures:D}};a.getMaterialAndTexturesFromShared=function(v){var y=v?.materialDefinitions?Object.keys(v.materialDefinitions)[0]:null,B=v?.textureDefinitions?Object.keys(v.textureDefinitions)[0]:null;y=y?v.materialDefinitions?.[y]:null;B=B?v.textureDefinitions?.[B]:null;v=m();if(null!=y){y=y.params;y.diffuse&&(v.metallicRoughness.baseColorFactor=[y.diffuse[0],y.diffuse[1],y.diffuse[2],1]);null!=y.doubleSided&&(v.doubleSided=y.doubleSided,v.cullFace=y.doubleSided?
g.CullFaceOptions.None:g.CullFaceOptions.Back);if("none"===y.cullFace||"front"===y.cullFace||"back"===y.cullFace)v.cullFace="none"===y.cullFace?g.CullFaceOptions.None:"back"===y.cullFace?g.CullFaceOptions.Back:g.CullFaceOptions.Front;y.transparency&&(v.metallicRoughness.baseColorFactor[3]=n.clamp(1-y.transparency,0,1));if(y.useVertexColorAlpha||1>v.metallicRoughness.baseColorFactor[3])v.alphaMode="blend"}y=[];if(null!=B){!B.wrap||"repeat"!==B.wrap[0]&&"repeat"!==B.wrap[1]||(v.wrapTextures=!0);let z=
k.TextureUsage.Color;"rgba"===B.channels&&(v.alphaMode="blend",z|=k.TextureUsage.AlphaMask);const A=B.images[B.images.length-1];B=Array.isArray(B.encoding)?l(B.encoding.map((C,H)=>({name:A.href[H]?.split("/").pop(),encoding:t[C]||0}))):[{name:A.href?.split("/").pop(),encoding:t[B.encoding]||0}];y.push({id:0,usage:z,encodings:B});v.metallicRoughness.baseColorTextureId=0}return{material:v,textures:y}};a.getSupportedEncodings=function(v){const y=!!v.compressedTextureS3TC;v=!!v.compressedTextureETC;const B=
b("disable-feature:i3s-basis")?0:k.TextureEncoding.Basis|k.TextureEncoding.KTX2,z=B|k.TextureEncoding.DDS_S3TC;return k.TextureEncoding.JPG|k.TextureEncoding.PNG|(y?z:0)|(v?B:0)};a.selectEncoding=function(v,y){if(null!=y)return v.find(B=>0!==(B.encoding&y))};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/material/RenderTexture":function(){define(["exports","../../../../../core/maybe","../../../../../core/promiseUtils"],function(a,b,n){class k{constructor(p,
h){this._textures=p;this.loadPromise=null;this._disposed=!1;p=this._textures.acquire(h);n.isPromiseLike(p)?(p.then(e=>{this._disposed?b.releaseMaybe(e):this._textureRef=e}),this.loadPromise=p):this._textureRef=p}dispose(){this._textureRef=b.releaseMaybe(this._textureRef);this._disposed=!0}get glTexture(){return null!=this._textureRef?this._textureRef.glTexture:null}}a.RenderTexture=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/I3SStreamDataController":function(){define(["exports",
"../../../../core/promiseUtils"],function(a,b){class n{constructor(k,p,h){this._requester=k;this._customParameters=p;this._apiKey=h;this._activeRequests=new Set}get busy(){return this._requester.busy}request(k,p,h){const e=new AbortController;h=b.onAbortOrThrow(h,()=>e.abort());k=this._requester.request(k,p,{signal:e.signal,query:{...this._customParameters,token:this._apiKey}});const g={response:k,abortController:e,abortHandle:h};this._activeRequests.add(g);b.always(k,()=>{g.abortController=null;
g.abortHandle?.remove();g.abortHandle=null;this._activeRequests.delete(g)});return k}cancelAll(){this._activeRequests.forEach(k=>{k.abortController?.abort();k.abortController=null;k.abortHandle?.remove()});this._activeRequests.clear()}}a.I3SStreamDataController=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/I3SViewportQueries":function(){define("../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../chunks/vec42 ../../../../core/libs/gl-matrix-2/factories/vec4f64 ../../../../geometry/ellipsoidUtils ../../../../geometry/spatialReferenceEllipsoidUtils ../../../../geometry/projection/projectBoundingSphere ../../../../geometry/projection/projectors ../../../../geometry/support/frustum ../../../../geometry/support/plane ../../../../geometry/support/spatialReferenceUtils ../../../../chunks/sphere ../../../../layers/graphics/dehydratedPoint ../../../ViewingMode ../graphics/elevationAlignmentUtils ../graphics/ElevationContext ../graphics/featureExpressionInfoUtils ./I3SNode ./I3SUtil ../../support/orientedBoundingBox".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w,x,u,t,m,q,r,v){class y{get _frustumMbsCenter(){return this._frustumMbs}get _frustumMbsRadius(){return this._frustumMbs[3]}get _frustumPlanes(){return this._frustum}constructor(O,K,L,P,R,W,V,ba,U={}){this._indexSR=O;this._renderCoordsHelper=K;this._clippingArea=R;this._elevationProvider=W;this._viewingMode=V;this._options=U;this._frustum=d.create();this._frustumMbs=k.create();this._useFrustumCulling=!1;this._poi=b.create();this._elevationContext=null;this.minDistance=
Infinity;this.maxDistance=0;this.maxLodLevel=2;this._tmpObb=new v.Obb;this._tmp1=b.create();this._tmp2=b.create();this._tmp3=b.create();this._tmp0=b.create();this._screenspaceErrorBias=U.screenspaceErrorBias||1;this._progressiveLoadFactor=U.progressiveLoadFactor||1;this.updateCamera(L,P);this._renderSR=K=this._renderCoordsHelper.spatialReference;this._renderSRSphericalPCPF=h.getSphericalPCPF(K);this._isGlobalMode=K===this._renderSRSphericalPCPF;this.updateElevationInfo(ba);this._tmpPoint=w.makeDehydratedPoint(0,
0,0,O);this._isECEFOBBInLocalMode=this._indexSR.isWGS84&&(K.isWebMercator||c.isPlateCarree(K));this._indexSREllipsoidRadius=p.getReferenceEllipsoid(this._indexSR).radius;this._indexSRSphericalPCPF=h.getSphericalPCPF(O);this._projectorIndexSRToIndexSRSphericalPCPF=g.getProjector(this._indexSR,this._indexSRSphericalPCPF)}updateElevationInfo(O){null==O?this._elevationContext=null:(this._elevationContext=t.ElevationContext.fromElevationInfo(O),this._elevationContext.updateFeatureExpressionInfoContext(m.createContextWithoutExpressionSupport(m.extractExpressionInfo(O,
!1))))}updateCamera(O,K){if(this._useFrustumCulling=K){d.fromMatrix(O.viewMatrix,O.projectionMatrix,this._frustum,z);K=O.eye;const R=B;a.normalize(R,O.viewForward);var L=A;a.sub(L,z[4],K);var P=a.dot(L,L);L=a.dot(R,L);P=.5*P/L;L=this._frustumMbs;a.scaleAndAdd(L,K,R,P);L[3]=1+P}this._screenSizeFactor=1/(O.perScreenPixelRatio/2);this._camPos=O.eye;this.minDistance=Infinity;this.maxDistance=0}setPointOfInterest(O){this._poi=O}updateScreenSpaceErrorBias(O){const K=this._screenspaceErrorBias;this._screenspaceErrorBias=
O;return K}updateClippingArea(O){this._clippingArea=O}expandElevationRange(O,K,L){if(null!=this._elevationContext&&(O=O.serviceMbsInIndexSR)){var P="relative-to-scene"===this._elevationContext.mode?"scene":"ground";this._elevationProvider.getSphereElevationBounds?(K=this._elevationProvider.getSphereElevationBounds(O,this._indexSR,P))&&L.expandElevationRange(K):((O=this._elevationProvider.getElevation(O[0],O[1],O[2],this._indexSR,P))&&L.expandElevationRangeValues(O,O),(K=K?null:this._elevationProvider.getRootElevationBounds?.())&&
L.expandElevationRange(K))}}getServiceMbsInRenderSR(O){const K=O.serviceMbsInRenderSR;if(r.isValidMbs(K))return K;O.serviceMbsInIndexSR&&n.copy(K,O.serviceMbsInIndexSR);const L=O.elevationRangeMin;if(this._elevationContext&&Number.isFinite(L)){let P=0,R=0;O=O.elevationRangeMax;switch(this._elevationContext.mode){case "relative-to-ground":case "relative-to-scene":P=this._elevationContext.geometryZWithOffset(K[2],this._renderCoordsHelper)+L-K[2];R=O-L;break;case "on-the-ground":P=L-K[2],R=O-L}K[2]+=
P+.5*R;K[3]+=.5*R}else this._elevationContext&&1E5>K[3]&&(this._tmpPoint.x=K[0],this._tmpPoint.y=K[1],this._tmpPoint.z=K[2],K[2]=u.evaluateElevationAlignmentAtPoint(this._tmpPoint,this._elevationProvider,this._elevationContext,this._renderCoordsHelper));e.projectBoundingSphere(K,this._indexSR,K,this._renderSR);return K}getAndUpdateVisibilityObbInRenderSR(O){var K=O.visibilityObbInRenderSR;if(K)return K;K=.01*this._indexSREllipsoidRadius;const {serviceMbsInIndexSR:L,serviceObbInIndexSR:P}=O;if(null==
P||!L||!P.isValid||this._isECEFOBBInLocalMode&&(P.halfSizeX>K||P.halfSizeY>K||P.halfSizeZ>K))return null;K=O.serviceObbInRenderSR;if(null==K)K=new v.Obb,O.serviceObbInRenderSR=K;else if(K.isValid)return K;var R=L[3],W=0;let V=0;var ba=P.centerZ;const U=this._renderCoordsHelper,da=this._elevationContext;if(da&&O.elevationRangeValid)switch(R=O.elevationRangeMin,O=O.elevationRangeMax,da.mode){case "relative-to-ground":case "relative-to-scene":W=da.geometryZWithOffset(ba,U)+R-ba;V=O-R;break;case "on-the-ground":W=
R-ba,V=O-R}else da&&1E5>R&&(W=this._tmpPoint,W.x=P.centerX,W.y=P.centerY,W.z=ba,W=u.evaluateElevationAlignmentAtPoint(W,this._elevationProvider,da,U)-ba);ba=(O=0<V)?this._tmpObb:K;P.transform(ba,this._indexSR,this._renderSR,W,this._renderSRSphericalPCPF,this._indexSRSphericalPCPF,this._projectorIndexSRToIndexSRSphericalPCPF);O&&v.computeOffsetObb(ba,0,V,this._viewingMode,K);return K}getNodeObbInRenderSRIndependentOfElevationOffset(O){const K=O.visibilityObbInRenderSR??O.serviceObbInRenderSR??null;
if(K?.isValid)return K;O=O.serviceObbInIndexSR;if(!O)return null;O.transform(G,this._indexSR,this._renderSR,void 0,this._renderSRSphericalPCPF,this._indexSRSphericalPCPF,this._projectorIndexSRToIndexSRSphericalPCPF);return G}ensureElevationAgnosticBoundingVolume(O){-1===O.elevationAgnosticBoundingVolume[3]&&0<O.level&&(this._viewingMode===x.ViewingMode.Global?this._updateElevationAgnosticBoundingVolumeGlobal(O):this._updateElevationAgnosticBoundingVolumeLocal(O));return O.elevationAgnosticBoundingVolume}_updateElevationAgnosticBoundingVolumeGlobal(O){var K=
this.getNodeObbInRenderSRIndependentOfElevationOffset(O);const L=O.elevationAgnosticBoundingVolume;var P=-1;if(K){const W=D;K.getCenter(W);a.normalize(W,W);O=W;K.getCorners(I);for(var R of I){a.normalize(R,R);K=a.dot(R,W);if(0>=K){L[3]=-1;return}P=Math.max(P,Math.sqrt(1-K*K))}}else if(P=O.serviceMbsInRenderSR,r.isValidMbs(P)){R=a.copy(D,l.getCenter(P));P=P[3];K=a.len(R);if(K<P){L[3]=-1;return}P/=K;a.normalize(R,R);O=R}else{L[3]=-1;return}n.copyVec3(L,O);L[3]=P+.001}_updateElevationAgnosticBoundingVolumeLocal(O){const K=
O.elevationAgnosticBoundingVolume;var L=this.getNodeObbInRenderSRIndependentOfElevationOffset(O);if(L){O=L.getCenter(D);O[2]=0;n.copyVec3(K,O);O=0;const R=J;L.getCorners(I);for(var P of I)P[2]=0,L=a.sqrDist(R,P),O=Math.max(O,L);K[3]=Math.sqrt(O)}else P=O.serviceMbsInRenderSR,r.isValidMbs(P)&&(L=a.copy(D,l.getCenter(P)),L[2]=0,n.copyVec3(K,L),K[3]=P[3])}isNodeVisible(O){const K=this.getServiceMbsInRenderSR(O);return this._isMBSinClippingArea(K)?this._useFrustumCulling?(O=this.getAndUpdateVisibilityObbInRenderSR(O))?
O.doesIntersectFrustumConservativeApproximation(this._frustum):d.intersectsSphere(this._frustum,l.wrap(K)):!0:!1}isElevationAgnosticBoundingVolumeVisible(O){return this._useFrustumCulling&&-1!==O[3]?this._viewingMode===x.ViewingMode.Global?this._isConeVisibleInFrustum(O):this._isCylinderVisibleInFrustum(O):!0}_isConeVisibleInFrustum(O){if(!this._isConeVisibleInFrustumMbs(O))return!1;var K=O[3];if(-1===K||.9<K)return!0;var L=this._frustumPlanes,P=a.dot(O,this._frustumMbsCenter),R=this._frustumMbsRadius;
const W=P-R;P+=R;if(0>=W)return!0;R=a.scale(H,O,W);const V=a.scale(E,O,P);K/=Math.sqrt(1-K*K);for(const U of L){L=f.getNormal(U);var ba=a.normalize(F,L);const da=a.dot(ba,O);if(!(.01>Math.abs(1-da)||(L=N,a.scale(L,O,da),a.sub(L,L,ba),a.normalize(L,L),ba=M,a.scaleAndAdd(ba,R,L,W*K),0>=f.signedDistance(U,ba)||(a.scaleAndAdd(ba,V,L,P*K),0>=f.signedDistance(U,ba)))))return!1}return!0}_isConeVisibleInFrustumMbs(O){const K=O[3];if(.9<K)return!0;var L=this._frustumMbsRadius,P=this._frustumMbsCenter;const R=
a.len(P);if(R<=L)return!0;var W=a.dot(O,P);O=a.scale(C,O,W);if(a.dist(O,P)<L)return!0;P=W/R;if(0>=W)return-P<L;W=Math.sqrt(1-P*P);if(W<K)return!0;L/=R;return W*Math.sqrt(1-L*L)-L*P<K}isObbVisibleIndependentOfElevation(O,K){if(!this._useFrustumCulling||-1===O[3])return!0;var L=this._frustumMbsRadius,P=this._frustumMbsCenter,R=this._frustumPlanes;const W=I;K.getCorners(W);if(this._viewingMode===x.ViewingMode.Global){var V=a.dot(O,P),ba=V-L;V+=L;if(0>=ba)return!0;for(var U of R){R=!0;for(var da of W){L=
a.dot(da,O);P=Q;a.scale(P,da,ba/L);if(0>=f.signedDistance(U,P)){R=!1;break}P=Q;a.scale(P,da,V/L);if(0>=f.signedDistance(U,P)){R=!1;break}}if(R)return!1}}else{O=P[2]-L;U=P[2]+L;for(ba of R){da=!0;P=f.getNormal(ba);R=P[0];L=P[1];P=P[2];K=ba[3];for(V of W){const fa=R*V[0]+L*V[1]+K;if(0>=fa+P*O||0>=fa+P*U){da=!1;break}}if(da)return!1}}return!0}_isCylinderVisibleInFrustum(O){const K=this._frustumMbsRadius,L=a.copy(C,this._frustumMbsCenter);L[2]=0;const P=O[3];return a.dist(L,O)<=P+K}isGeometryVisible(O){return this._useFrustumCulling?
O.geometryObbInRenderSR?.doesIntersectFrustumConservativeApproximation(this._frustum)??this.isNodeVisible(O):!0}_isMBSinClippingArea(O){return null==this._clippingArea?!0:r.intersectBoundingRectWithMbs(this._clippingArea,O)!==r.MbsIntersectResult.OUTSIDE}_screenSpaceDiameterMbs(O,K){var L=this.getServiceMbsInRenderSR(O);O=Math.sqrt(a.squaredDistance(l.getCenter(L),this._camPos));L=O-L[3];this._updateMinMaxDistance(O);return 0>L?.5*Number.MAX_VALUE:K/L*this._screenSizeFactor}calcCameraDistance(O){return this.calcCameraDistanceToCenter(O)-
this.getServiceMbsInRenderSR(O)[3]}calcCameraDistanceToCenter(O){O=this.getServiceMbsInRenderSR(O);O=a.distance(l.getCenter(O),this._camPos);this._updateMinMaxDistance(O);return O}calcAngleDependentLoD(O){O=this.getServiceMbsInRenderSR(O);const K=O[3];O=(Math.abs(O[0]*(O[0]-this._camPos[0])+O[1]*(O[1]-this._camPos[1])+O[2]*(O[2]-this._camPos[2]))/a.length(l.getCenter(O))+K)/a.distance(l.getCenter(O),this._camPos);return Math.min(1,O)}hasLOD(O){return O.lodMetric!==q.LodMetric.None}_getDistanceGlobeMode(O,
K){var L=a.length(l.getCenter(K));const P=a.length(O)-L;a.scale(this._tmp0,O,a.dot(O,l.getCenter(K))/a.squaredLength(O));var R=a.squaredDistance(l.getCenter(K),this._tmp0),W=K[3];if(R<=W*W)return Math.abs(P);K=a.scale(this._tmp0,l.getCenter(K),1/L);L=a.scale(this._tmp1,K,L-W*W/2/L);R=a.subtract(this._tmp2,O,L);R=a.subtract(this._tmp2,R,a.scale(this._tmp3,K,a.dot(K,R)));L=a.add(this._tmp2,L,a.scale(this._tmp2,R,W/a.length(R)));W=a.distance(O,L);2E5<=P&&(O=a.subtract(this._tmp1,O,L),O=a.dot(O,K)/a.length(O),
.08>O&&(O=1E-4),W/=O);return W}_getDistance(O,K){if(this._isGlobalMode)return this._getDistanceGlobeMode(O,K);{var L=O[0]-K[0];const P=O[1]-K[1];O=O[2]-K[2];L=L*L+P*P;K=K[3];L<=K*K?O=Math.abs(O):(K=Math.sqrt(L)-K,O=Math.sqrt(O*O+K*K))}return O}_updateMinMaxDistance(O){0<O?(this.minDistance=Math.min(this.minDistance,O),this.maxDistance=Math.max(this.maxDistance,O)):(this.minDistance=0,this.maxDistance=Math.max(this.maxDistance,-O))}getLodLevel(O){if(O.lodMetric===q.LodMetric.None)return 0;if(0===O.childCount)return this.maxLodLevel;
if(this._useFrustumCulling&&1>this._progressiveLoadFactor){const K=this._screenspaceErrorBias;return this.evaluateLODmetric(O,this._progressiveLoadFactor*this._screenspaceErrorBias)?this.evaluateLODmetric(O,K)?2:1:0}return this.evaluateLODmetric(O,this._screenspaceErrorBias)?this.maxLodLevel:0}evaluateLODmetric(O,K){switch(O.lodMetric){case q.LodMetric.ScreenSpaceRelative:const L=this.getServiceMbsInRenderSR(O),P=this._getDistance(this._camPos,L),R=2*P/this._screenSizeFactor;this._updateMinMaxDistance(P+
L[3]);return O.maxError*K<=R;case q.LodMetric.MaxScreenThreshold:return K=this._screenSpaceDiameterMbs(O,O.serviceMbsInIndexSR[3]*K),this._options.angleDependentLoD&&(K*=this.calcAngleDependentLoD(O)),K<O.maxError;case q.LodMetric.RemovedFeatureDiameter:return 10>this._screenSpaceDiameterMbs(O,O.maxError)*K;case q.LodMetric.DistanceRangeFromDefaultCamera:return this.calcCameraDistance(O)>O.maxError*K}return!1}distToPOI(O){O=this.getServiceMbsInRenderSR(O);return a.distance(l.getCenter(O),this._poi)-
O[3]}distCameraToPOI(){return a.distance(this._camPos,this._poi)}}const B=b.create(),z=d.createPoints(),A=b.create(),C=b.create(),H=b.create(),E=b.create(),F=b.create(),G=new v.Obb,D=b.create(),I=[b.create(),b.create(),b.create(),b.create(),b.create(),b.create(),b.create(),b.create()],J=b.create(),N=b.create(),M=b.create(),Q=b.create();return y})},"esri/layers/support/SceneModification":function(){define("../../chunks/tslib.es6 ../../geometry ../../core/JSONSupport ../../core/lang ../../core/Warning ../../core/accessorSupport/decorators/property ../../core/has ../../core/Logger ../../core/accessorSupport/decorators/subclass ../../core/accessorSupport/decorators/writer ../../core/accessorSupport/decorators/persistable ../../geometry/projection ../../geometry/Polygon".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w){var x;b=x=class extends n.JSONSupport{constructor(u){super(u);this.geometry=null;this.type="clip"}writeGeometry(u,t,m,q){if(q.layer?.spatialReference&&!q.layer.spatialReference.equals(this.geometry.spatialReference)){if(!l.canProjectWithoutEngine(u.spatialReference,q.layer.spatialReference)){q?.messages&&q.messages.push(new p("scenemodification:unsupported","Scene modifications with incompatible spatial references are not supported",{modification:this,spatialReference:q.layer.spatialReference,
context:q}));return}const r=new w;l.projectPolygon(u,r,q.layer.spatialReference);t[m]=r.toJSON(q)}else t[m]=u.toJSON(q);delete t[m].spatialReference}clone(){return new x({geometry:k.clone(this.geometry),type:this.type})}};a.__decorate([h.property({type:w}),c.persistable()],b.prototype,"geometry",void 0);a.__decorate([f.writer(["web-scene","portal-item"],"geometry")],b.prototype,"writeGeometry",null);a.__decorate([h.property({type:["clip","mask","replace"],nonNullable:!0}),c.persistable()],b.prototype,
"type",void 0);return b=x=a.__decorate([d.subclass("esri.layers.support.SceneModification")],b)})},"esri/views/3d/layers/I3SMeshViewLabeler":function(){define("../../../chunks/tslib.es6 ../../../symbols ../../../core/Accessor ../../../core/arrayUtils ../../../core/has ../../../core/lang ../../../core/mathUtils ../../../core/maybe ../../../core/reactiveUtils ../../../core/uid ../../../core/accessorSupport/decorators/property ../../../core/Logger ../../../core/accessorSupport/decorators/subclass ../../../core/accessorSupport/diffUtils ../../../geometry/projection/projectBuffer ../../../geometry/support/aaBoundingBox ../../../geometry/support/DoubleArray ../../../layers/graphics/dehydratedPoint ./graphics/Graphics3DCore ./graphics/Graphics3DScaleVisibility ./i3s/I3SGeometryUtil ../support/LimitGraphicsMap ../webgl-engine/lib/UpdatePolicy ../../../symbols/PointSymbol3D".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w,x,u,t,m,q,r,v,y,B,z,A){class C{constructor(D,I){this.meta=D;this.index=I}}class H{constructor(D,I){this.graphic=D;this.geometry=I;this.components=[];this.overridesDirty=!1}}b=class extends n{get updating(){return this._graphicsCore?.updating??!1}constructor(D){super(D);this.loadedGraphics=new B.LimitGraphicsMap(5E4);this.slicePlaneEnabled=!1;this._renderingInfo={symbol:new A};this._featuresMap=new Map}initialize(){const D=this.view.basemapTerrain;this._graphicsCore=
new r.Graphics3DCore({owner:this,layer:this.layer,preferredUpdatePolicy:z.UpdatePolicy.ASYNC,elevationFeatureExpressionEnabled:!1,graphicSymbolSupported:!1,getRenderingInfoWithoutRenderer:!0,hasZ:!0,hasM:!1,componentFactories:{deconflictor:I=>this.view.deconflictor.addGraphicsOwner(I),labeler:(I,J)=>this.view.labeler.addGraphicsOwner(I,J,{emptySymbolLabelSupported:!0,elevationInfoOverride:{mode:"absolute-height",offset:0},disablePlacement:{logEntityDescription:"3D Object Scene Layer features"}}),
scaleVisibility:(I,J)=>new v.Graphics3DScaleVisibility({graphicsCoreOwner:this,layer:this.layer,queryGraphicUIDsInExtent:J,graphicsCore:I,basemapTerrain:D,layerScaleEnabled:!1})}});this._graphicsCore.initializePromise.then(()=>this._graphicsCore.startCreateGraphics()).catch(()=>{});this.addHandles(d.watch(()=>this.layer.labelingInfo,(I,J)=>{x.diff(I,J)&&this._graphicsCore.updateLabelingInfo()}))}destroy(){this._graphicsCore=g.destroyMaybe(this._graphicsCore);this.loadedGraphics=g.destroyMaybe(this.loadedGraphics);
this.view=null}addNodeMeta(D,I){let J=0;const N=D.filteredIds,M=this.view.spatialReference,Q=[];for(let L=0;L<D.featureIds.length;L++){const P=D.featureIds[L];var O=null==N;N&&J<N.length&&P===N[J]&&(O=!0,J++);if(!this._enabledForFeatureInNode(D,L))continue;var K=this._featuresMap.get(P);if(K){K.components.push(new C(D,L));this._updateLabelPosition(P);continue}const R=I(L,D);K=q.makeDehydratedPoint(0,0,0,M);O={objectId:P,uid:f.generateUID(),attributes:R,visible:O,geometry:K};K=new H(O,K);K.components.push(new C(D,
L));this._featuresMap.set(P,K);this._updateLabelGeometry(P);Q.push(O)}this.loadedGraphics.addMany(Q)}updateLabelPositions(D){const I=this.view.renderCoordsHelper;this._forEachGraphic(D,(J,N,M)=>{N=this._graphicsCore.getGraphics3DGraphicById(N.uid);null!=N&&this._updateLabelGeometry(D.featureIds[J])&&N.alignWithAbsoluteElevation(M.z??0,I,!1)})}setNodeMetaAttributes(D,I){const J=[];this._forEachGraphic(D,(N,M)=>{N=I(N,D);h.equalsShallow(M.attributes,N)||(M.attributes=N,J.push(M.uid))});this._graphicsCore.updateLabelingInfo(J)}applyFilterChange(D){this._forEachFeature(D,
(I,J,N)=>{if(this._enabledForFeatureInNode(D,I))I=J.graphic,J=I.visible,J!==N&&(I.visible=N,E.graphic=I,E.property="visible",E.oldValue=J,E.newValue=N,this._graphicsCore.graphicUpdateHandler(E));else switch(N=D.featureIds[I],this._removeFeature(J,D,I)){case F.REMOVED:this.loadedGraphics.removeManyByObjectId([N]);break;case F.MODIFIED:this._updateLabelPosition(N)}})}removeNodeMeta(D){const I=[];this._forEachGraphic(D,J=>{const N=D.featureIds[J],M=this._featuresMap.get(N);if(M)switch(this._removeFeature(M,
D,J)){case F.MODIFIED:this._updateLabelPosition(N);break;case F.REMOVED:I.push(N)}});this.loadedGraphics.removeManyByObjectId(I)}_removeFeature(D,I,J){const N=D.components.length;k.filterInPlace(D.components,M=>!(M.meta===I&&M.index===J));return 0===D.components.length?(this._featuresMap.delete(I.featureIds[J]),F.REMOVED):N!==D.components.length?F.MODIFIED:F.UNMODIFIED}getRenderingInfo(){return this._renderingInfo}notifyGraphicGeometryChanged(){}notifyGraphicVisibilityChanged(){}_updateLabelPosition(D){const I=
this._featuresMap.get(D);I&&this._updateLabelGeometry(D)&&(this.loadedGraphics.removeManyByObjectId([D]),this.loadedGraphics.addMany([I.graphic]))}_updateLabelGeometry(D){D=this._featuresMap.get(D);if(!D)return!1;const I=D.geometry,J=this.view.spatialReference,N=this.view.renderCoordsHelper,M=I.x,Q=I.y,O=I.z??0,K=m.newDoubleArray(D.components.length*y.boundingBoxCornersPointsStride);let L=0;for(const {meta:P,index:R}of D.components)y.boundingBoxCornerPoints(R,this.collection,P.objectHandle,K,L),L+=
y.boundingBoxCornersPointsStride;u.projectBuffer(K,N.spatialReference,0,K,J,0);t.fromBuffer(K,G);I.x=(G[0]+G[3])/2;I.y=(G[1]+G[4])/2;I.z=G[5];return!e.floatEqualUlp(I.x,M)||!e.floatEqualUlp(I.y,Q)||!e.floatEqualUlp(I.z,O)}_forEachGraphic(D,I){this._forEachFeature(D,(J,{graphic:N,geometry:M},Q)=>{this._enabledForFeatureInNode(D,J)&&I(J,N,M,Q)})}_forEachFeature(D,I){let J=0;for(let N=0;N<D.featureIds.length;N++){const M=this._featuresMap.get(D.featureIds[N]);let Q=null==D.filteredIds;D.filteredIds&&
D.filteredIds[J]===D.featureIds[N]&&(Q=!0,J++);M&&I(N,M,Q)}}_enabledForFeatureInNode(D,I){return 0>D.node.index||!this.overrides?.featureHasGeometryChanges(D.featureIds[I])}get updatePolicy(){return this._graphicsCore.effectiveUpdatePolicy}get usedMemory(){return this._graphicsCore.usedMemory}get unloadedMemoryEstimate(){return this._graphicsCore.unprocessedMemoryEstimate}get test(){}};a.__decorate([c.property()],b.prototype,"view",void 0);a.__decorate([c.property()],b.prototype,"layer",void 0);a.__decorate([c.property()],
b.prototype,"collection",void 0);a.__decorate([c.property()],b.prototype,"loadedGraphics",void 0);a.__decorate([c.property()],b.prototype,"overrides",void 0);a.__decorate([c.property()],b.prototype,"updating",null);a.__decorate([c.property()],b.prototype,"slicePlaneEnabled",void 0);a.__decorate([c.property()],b.prototype,"_graphicsCore",void 0);b=a.__decorate([w.subclass("esri.views.3d.layers.I3SMeshViewLabeler")],b);const E={graphic:null,property:null,oldValue:null,newValue:null};var F;(function(D){D[D.UNMODIFIED=
0]="UNMODIFIED";D[D.MODIFIED=1]="MODIFIED";D[D.REMOVED=2]="REMOVED"})(F||={});const G=t.create();return b})},"esri/views/3d/layers/i3s/I3SGeometryUtil":function(){define("exports ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../geometry/projection/projectBuffer ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/DoubleArray".split(" "),function(a,b,n,k,p,h){function e(f,c,l,w,x){f=c.getComponentAabb(l,f,g);c=c.getObjectTransform(l);for(l=
0;8>l;++l)d[0]=l&1?f[0]:f[3],d[1]=l&2?f[1]:f[4],d[2]=l&4?f[2]:f[5],b.transformMat3(d,d,c.rotationScale),b.add(d,d,c.position),w[x++]=d[0],w[x++]=d[1],w[x++]=d[2];return w}const g=p.create(),d=n.create();a.boundingBoxCornerPoints=e;a.boundingBoxCornersPointsStride=24;a.createGetFeatureExtent=function(f,c,l){const w=h.newDoubleArray(24);return x=>{var u=x.meta.featureExtents;if(null==u){u=new Float64Array(6*x.meta.featureIds.length);x.meta.featureExtents=u;for(let t=0;t<u.length;t+=6)u[t]=Number.POSITIVE_INFINITY}u=
new Float64Array(u.buffer,6*x.index*Float64Array.BYTES_PER_ELEMENT,6);u[0]===Number.POSITIVE_INFINITY&&(e(x.index,l,x.meta.objectHandle,w,0),k.projectBuffer(w,c,0,w,f,0)?p.fromBuffer(w,u):p.set(u,p.zero));return u}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/LimitGraphicsMap":function(){define(["exports","../../../core/Evented","../../../core/MapUtils","./GraphicsMap"],function(a,b,n,k){class p extends b{constructor(d){super();this._limit=d;this._all=new k.GraphicsMap;
this._active=new g(this);this._pending=new Map;this._handle=this._all.on("change",f=>this._handleChanges(f))}destroy(){this._handle.remove()}get length(){return this._active.length}toArray(){return this._active.toArray()}find(d){return this._active.find(d)}some(d){return this._active.some(d)}forEach(d){this._active.forEach(d)}addMany(d){this._all.addMany(d)}removeManyByObjectId(d){this._all.removeManyByObjectId(d)}_handleChanges(d){let f=d.removed;if(0<this._pending.size){f=[];for(var c of d.removed)this._pending.delete(c.objectId)||
f.push(c)}c=this._limit-this._active.length+f.length;c<d.added.length&&(this._active.removeMany(f),f=[],e.reset(1-this._limit/(this._active.length+d.added.length)),this._active.forEach(w=>{e.sample()&&(f.push(w),this._pending.set(w.objectId,w))}),c=this._limit-this._active.length+f.length);let l=d.added;if(c<d.added.length){l=[];e.reset(c/d.added.length);for(const w of d.added)e.sample()?l.push(w):this._pending.set(w.objectId,w)}d=c-l.length;0<d&&0<this._pending.size&&(e.reset(d/this._pending.size),
this._pending.forEach(w=>{e.sample()&&(l.push(w),this._pending.delete(w.objectId))}));this._active.addAndRemove(l,f)}}class h{constructor(){this._percentage=1;this._last=-1;this._index=0}reset(d){this._percentage=d;this._last=-1}sample(){const d=Math.floor(this._index*this._percentage);++this._index;if(d===this._last)return!1;this._last=d;return!0}}const e=new h;class g{constructor(d){this._parent=d;this._map=new Map}get length(){return this._map.size}forEach(d){this._map.forEach(f=>d(f))}find(d){return n.findInMap(this._map,
d)}some(d){return n.someMap(this._map,d)}toArray(){return Array.from(this._map.values())}addAndRemove(d,f){for(const c of d)this._map.set(c.objectId,c);for(const c of f)this._map.delete(c.objectId);(0<d.length||0<f.length)&&this._parent.emit("change",{added:d,removed:f})}removeMany(d){for(const f of d)this._map.delete(f.objectId);0<d.length&&this._parent.emit("change",{added:[],removed:d})}}a.LimitGraphicsMap=p;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/GraphicsMap":function(){define(["exports",
"../../../core/Evented","../../../core/MapUtils"],function(a,b,n){class k extends b{constructor(){super(...arguments);this._map=new Map}clear(){if(0<this._map.size){const p=this.toArray();this._map.clear();this.emit("change",{added:[],removed:p})}}get length(){return this._map.size}get(p){return this._map.get(p)}addMany(p){if(0!==p.length){var h=new Set;for(let e=0;e<p.length;e++){const g=p[e],d=g.objectId,f=this._map.get(d);f?(h.add(d),g!==f&&(p[e]=f),f.refCount||(f.refCount=0),++f.refCount):(g.refCount=
1,this._map.set(d,g))}p=0<h.size?p.filter(e=>!h.has(e.objectId)):p;0<p.length&&this.emit("change",{added:p,removed:[]})}}removeMany(p){const h=[];for(const e of p){p=e.objectId;const g=this._map.get(p);null!=g&&(!g.refCount||0>=--g.refCount)&&(this._map.delete(p),h.push(e))}0<h.length&&this.emit("change",{added:[],removed:h})}removeManyByObjectId(p){const h=[];for(const e of p)p=this._map.get(e),null!=p&&(!p.refCount||0>=--p.refCount)&&(this._map.delete(e),h.push(p));0<h.length&&this.emit("change",
{added:[],removed:h})}toArray(){return[...this._map.values()]}find(p){return n.findInMap(this._map,p)}some(p){return n.someMap(this._map,p)}forEach(p){this._map.forEach(h=>p(h))}}a.GraphicsMap=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/I3SMeshViewPerformanceInfo":function(){define(["exports","./support/LayerViewPerformanceInfo"],function(a,b){class n extends b.LayerViewPerformanceInfo{constructor(k,p,h,e,g,d,f){super(k,0,0,0,p);this.gpuMB=h;this.geometryMB=
e;this.textureMB=g;this.unloadedMB=d;this.idbHitRate=f}}a.I3SMeshViewPerformanceInfo=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/I3SMeshWorkerHandle":function(){define("exports ../../../core/Logger ../../../core/PooledArray ../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../core/workers/WorkerHandle ../../../geometry/projection ../../../geometry/projection/projectVectorToVector ../../../libs/i3s/enums".split(" "),function(a,b,n,k,p,h,e,g){function d(w,
x,u){c.clear();var t=Infinity;let m=Infinity,q=-Infinity,r=-Infinity,v=!1;for(const B of x){var y="clip"===B.type?g.ModificationType.Inside:"mask"===B.type?g.ModificationType.Outside:g.ModificationType.Replace;const z=B.geometry;x=A=>A;if(z.spatialReference){if(!h.canProjectWithoutEngine(z.spatialReference,u)){b.getLogger("esri.views.3d.layers.I3SMeshWorkerHandle").warn("Can't project modification polygon into layer spatial reference, ignoring modification");continue}x=A=>{e.projectVectorToVector(A,
z.spatialReference,l,u);return l}}else z.hasZ||(l[2]=0,x=A=>{l[0]=A[0];l[1]=A[1];return l});v=v||y===g.ModificationType.Outside;c.push(y);c.push(z.rings.length);for(const A of z.rings){c.push(A.length);for(const C of A)y=x(C),c.push(y[0]),c.push(y[1]),c.push(y[2]),t=Math.min(t,y[0]),m=Math.min(m,y[1]),q=Math.max(q,y[0]),r=Math.max(r,y[1])}}null!=w&&(v?(c.push(g.ModificationType.Inside),c.push(2),c.push(4),c.push(t-1E-4),c.push(m-1E-4),c.push(0),c.push(q+1E-4),c.push(m-1E-4),c.push(0),c.push(q+1E-4),
c.push(r+1E-4),c.push(0),c.push(t-1E-4),c.push(r+1E-4),c.push(0)):(c.push(g.ModificationType.Outside),c.push(1)),c.push(4),c.push(w[0]),c.push(w[1]),c.push(0),c.push(w[2]),c.push(w[1]),c.push(0),c.push(w[2]),c.push(w[3]),c.push(0),c.push(w[0]),c.push(w[3]),c.push(0));c.push(g.ModificationType.Finished);w=new Float64Array(c.length);for(t=0;t<c.length;++t)w[t]=c.at(t);return w}class f extends p.WorkerHandle{constructor(w){super("SceneLayerWorker","process",{process:x=>[x.geometryBuffer],project:x=>
[x.positions.buffer],transformNormals:x=>[x.normals.buffer]},w,{hasInitialize:!0})}setModifications(w,x,u,t){w={context:w,modifications:d(x,u,t),isGeodetic:t.isGeographic};this.broadcast(w,"setModifications")}setLegacySchema(w,x){x=JSON.stringify(x);return this.broadcast({context:w,jsonSchema:x},"setLegacySchema")}destroyContext(w){return this.broadcast(w,"destroyContext")}project(w,x){return this.invokeMethod("project",w,x)}transformNormals(w,x){return this.invokeMethod("transformNormals",w,x)}}
const c=new n({deallocator:null}),l=k.create();a.I3SMeshWorkerHandle=f;a.toWasmModification=d;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/libs/i3s/enums":function(){define(["exports"],function(a){a.IndexType=void 0;(function(b){b[b.None=0]="None";b[b.Int16=1]="Int16";b[b.Int32=2]="Int32"})(a.IndexType||(a.IndexType={}));a.ModificationType=void 0;(function(b){b[b.Replace=0]="Replace";b[b.Outside=1]="Outside";b[b.Inside=2]="Inside";b[b.Finished=3]="Finished"})(a.ModificationType||
(a.ModificationType={}));Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/II3SMeshView3D":function(){define(["exports"],function(a){a.ForAllFeaturesMode=void 0;(function(b){b[b.VISIBLE_ONLY=0]="VISIBLE_ONLY";b[b.ALL=1]="ALL";b[b.QUERYABLE=2]="QUERYABLE"})(a.ForAllFeaturesMode||(a.ForAllFeaturesMode={}));a.ForAllFeaturesReturnType=void 0;(function(b){b[b.EXIT=0]="EXIT";b[b.CONTINUE=1]="CONTINUE";b[b.SKIP=2]="SKIP"})(a.ForAllFeaturesReturnType||(a.ForAllFeaturesReturnType=
{}));a.ElevationMode=void 0;(function(b){b[b.Absolute=0]="Absolute";b[b.RelativeToGround=1]="RelativeToGround";b[b.OnTheGround=2]="OnTheGround"})(a.ElevationMode||(a.ElevationMode={}));Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/SceneLayerWorker":function(){define("require exports ../../../core/mathUtils ../../../geometry/SpatialReference ../../../geometry/support/MeshGeoreferencedVertexSpace ../../../geometry/support/MeshLocalVertexSpace ../../../chunks/vec3 ../../../libs/i3s/enums ../../../libs/i3s/I3SModule ./i3s/I3SNode".split(" "),
function(a,b,n,k,p,h,e,g,d,f){function c(v){if(q){var y=v.modifications,B=q._malloc(8*y.length),z=new Float64Array(q.HEAPU8.buffer,B,y.length);for(let A=0;A<y.length;++A)z[A]=y[A];q.setModifications(v.context,B,y.length,v.isGeodetic);q._free(B)}}function l(v,y,B){const {context:z,globalTrafo:A,mbs:C,obbData:H,elevationOffset:E,geometryBuffer:F,geometryDescriptor:G,indexToVertexProjector:D,vertexToRenderProjector:I}=y;var J=v._malloc(F.byteLength),N=v._malloc(33*Float64Array.BYTES_PER_ELEMENT),M=new Uint8Array(v.HEAPU8.buffer,
J,F.byteLength);M.set(new Uint8Array(F));var Q=new Float64Array(v.HEAPU8.buffer,N,33);u(Q,[NaN,NaN,NaN]);var O=Q.byteOffset+3*Q.BYTES_PER_ELEMENT,K=new Float64Array(Q.buffer,O);u(K,A);O+=16*Q.BYTES_PER_ELEMENT;K=new Float64Array(Q.buffer,O);u(K,C);O+=4*Q.BYTES_PER_ELEMENT;H&&(K=new Float64Array(Q.buffer,O),u(K,H));Q={isDraco:!1,isLegacy:!1,color:y.layouts.some(R=>R.some(W=>"color"===W.name)),normal:y.needNormals&&y.layouts.some(R=>R.some(W=>"normalCompressed"===W.name)),uv0:y.layouts.some(R=>R.some(W=>
"uv0"===W.name)),uvRegion:y.layouts.some(R=>R.some(W=>"uvRegion"===W.name)),featureIndex:G.featureIndex};M=v.process(z,!!y.obbData,J,M.byteLength,G,Q,N,E,D,I,y.normalReferenceFrame);v._free(N);v._free(J);if(0<M.error.length)throw Error(`i3s.wasm: ${M.error}`);if(M.discarded)return null;v=0<M.componentOffsets.length?M.componentOffsets.slice():null;J=0<M.featureIds.length?M.featureIds.slice():null;N=0<M.anchorIds.length?Array.from(M.anchorIds):null;Q=0<M.anchors.length?Array.from(M.anchors):null;O=
M.interleavedVertedData.slice().buffer;K=M.indicesType===g.IndexType.Int16?(new Uint16Array(M.indices.buffer,M.indices.byteOffset,M.indices.byteLength/2)).slice():(new Uint32Array(M.indices.buffer,M.indices.byteOffset,M.indices.byteLength/4)).slice();const L=M.positions.slice(),P=M.positionIndicesType===g.IndexType.Int16?(new Uint16Array(M.positionIndices.buffer,M.positionIndices.byteOffset,M.positionIndices.byteLength/2)).slice():(new Uint32Array(M.positionIndices.buffer,M.positionIndices.byteOffset,
M.positionIndices.byteLength/4)).slice();y={layout:y.layouts[0],interleavedVertexData:O,indices:K,hasColors:M.hasColors,hasModifications:M.hasModifications,positionData:{data:L,indices:P}};J&&B.push(J.buffer);v&&B.push(v.buffer);B.push(O);B.push(K.buffer);B.push(L.buffer);B.push(P.buffer);return{componentOffsets:v,featureIds:J,anchorIds:N,anchors:Q,transformedGeometry:y,obb:M.obb,globalTrafo:A}}function w(v){if(q){var {context:y,buffer:B}=v;v=q._malloc(B.byteLength);var z=B.byteLength/Float64Array.BYTES_PER_ELEMENT,
A=new Float64Array(q.HEAPU8.buffer,v,z),C=new Float64Array(B);A.set(C);q.filterOBBs(y,v,z);C.set(A);q._free(v)}}function x(v){q&&0===q.destroy(v)&&(q=null)}function u(v,y){for(let B=0;B<y.length;++B)v[B]=y[B]}function t(){if(q)return Promise.resolve(q);m||=d.get().then(v=>{q=v;m=null;return q});return m}let m,q;const r={transform:(v,y)=>q&&l(q,v,y),destroy:x};b.destroyContext=function(v){x(v)};b.dracoDecompressPointCloudData=async function(v){q=await t();const y=[v.geometryBuffer];var {geometryBuffer:B}=
v,z=B.byteLength;v=q._malloc(z);z=new Uint8Array(q.HEAPU8.buffer,v,z);z.set(new Uint8Array(B));B=q.dracoDecompressPointCloudData(v,z.byteLength);q._free(v);if(0<B.error.length)throw Error(`i3s.wasm: ${B.error}`);v=0<B.featureIds?.length?B.featureIds.slice():null;B=B.positions.slice();v&&y.push(v.buffer);y.push(B.buffer);return{result:{positions:B,featureIds:v},transferList:y}};b.filterObbsForModifications=async function(v){await t();w(v);v={buffer:v.buffer};return{result:v,transferList:[v.buffer]}};
b.filterObbsForModificationsSync=w;b.initialize=async function(){q||await t()};b.interpretObbModificationResults=function(v){return 0===v?f.NodeIMModificationImpact.Unmodified:1===v?f.NodeIMModificationImpact.PotentiallyModified:2===v?f.NodeIMModificationImpact.Culled:f.NodeIMModificationImpact.Unknown};b.process=async function(v){q=await t();const y=[v.geometryBuffer];return{result:l(q,v,y),transferList:y}};b.project=async function(v){const {localMatrix:y,origin:B,positions:z,vertexSpace:A}=v;var C=
k.fromJSON(v.inSpatialReference),H=k.fromJSON(v.outSpatialReference);const [{projectBuffer:E},{initializeProjection:F}]=await Promise.all([new Promise((N,M)=>a(["../../../geometry/projection/projectBuffer"],N,M)),new Promise((N,M)=>a(["../../../geometry/projection"],N,M))]);await F(C,H);v=[0,0,0];if(!E(B,C,0,v,H,0))throw Error("Failed to project");if("georeferenced"===A.type&&null==A.origin){var G=new Float64Array(z.length);if(!E(z,C,0,G,H,0,G.length/3))throw Error("Failed to project");}else{G="georeferenced"===
A.type?p.fromJSON(A):h.fromJSON(A);const {projectMeshVertexPositions:N}=await new Promise((M,Q)=>a(["../../../geometry/support/meshUtils/projectMeshVertexPositions"],M,Q));C=N({vertexAttributes:{position:z},transform:y?{localMatrix:y}:void 0,vertexSpace:G,spatialReference:C},H);if(!C)throw Error("Failed to project");G=C}C=G.length;const [D,I,J]=v;for(H=0;H<C;H+=3)G[H]-=D,G[H+1]-=I,G[H+2]-=J;return{result:{projected:G,original:z,projectedOrigin:v},transferList:[G.buffer,z.buffer]}};b.setLegacySchema=
async function(v){q=await t();q.setLegacySchema(v.context,v.jsonSchema)};b.setModifications=async function(v){await t();c(v)};b.setModificationsSync=c;b.test=r;b.transformNormals=async function({normalMatrix:v,normals:y}){const B=new Float32Array(y.length);e.transformMat3(B,y,v);n.hasScaling(v)&&e.normalize(B,B);return{result:{transformed:B,original:y},transferList:[B.buffer,y.buffer]}};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/libs/i3s/I3SModule":function(){define(["require",
"exports","../../assets"],function(a,b,n){function k(h){return n.getAssetUrl(`esri/libs/i3s/${h}`)}let p;b.get=function(){p||=(new Promise(h=>(new Promise((e,g)=>a(["../../chunks/i3s"],e,g))).then(e=>e.i3s).then(({default:e})=>{const g=e({locateFile:k,onRuntimeInitialized:()=>h(g)});delete g.then}))).catch(h=>{throw h;});return p};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/Highlights":function(){define(["../../../../core/arrayUtils","../../../../core/handleUtils",
"../II3SMeshView3D"],function(a,b,n){class k{constructor(){this.ids=new Set}}class p{constructor({collection:h,forAllFeatures:e,forAllFeaturesOfNode:g}){this._highlights=new Map;this._collection=h;this._forAllFeatures=e;this._forAllFeaturesOfNode=g}destroy(){this._highlights.forEach(h=>h.forEach(e=>this._releaseSet(e)));this._highlights=null}acquireSet(h){const e=new k;var g=this._highlights.get(h);g||(g=[],this._highlights.set(h,g));g.push(e);g=b.makeHandle(()=>{if(this._highlights){var d=this._highlights.get(h);
d&&(this._releaseSet(e),a.removeUnordered(d,e))}});return{set:e,handle:g}}setFeatureIds(h,e,g){e.forEach(d=>h.ids.add(d));this._initializeSet(h,g)}_initializeSet(h,e){this._forAllFeatures((g,d,f)=>{h.ids.has(g)&&this._collection.addComponentHighlight(f.objectHandle,d,e);return n.ForAllFeaturesReturnType.CONTINUE})}_releaseSet(h){this._forAllFeatures((e,g,d)=>{h.ids.has(e)&&this._collection.removeComponentHighlight(d.objectHandle,g);return n.ForAllFeaturesReturnType.CONTINUE})}objectCreated(h){this._highlights.forEach((e,
g)=>{e.forEach(d=>{this._forAllFeaturesOfNode(h,(f,c)=>{d.ids.has(f)&&this._collection.addComponentHighlight(h.objectHandle,c,g);return n.ForAllFeaturesReturnType.CONTINUE})})})}objectDeleted(h){this._collection.clearHighlights(h.objectHandle)}}return p})},"esri/views/3d/layers/i3s/I3SAsyncElevationUpdater":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/Logger ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ../II3SMeshView3D ../graphics/ExtentSet ../../../support/Scheduler".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c){a.I3SAsyncElevationUpdater=class extends n{constructor(l,w,x,u){super({});this._updateExtent=w;this._updateNode=x;this._getElevationMode=u;this.running=!1;this._extentSet=new f.ExtentSet;this._nodeSet=new Set;w=this._taskPriority;l=l.registerTask(this._taskPriority,this);this.addHandles(l);this._task=l;this._lastTaskPriority=w}get _taskPriority(){const l=this._getElevationMode();return l?l===d.ElevationMode.RelativeToGround?c.TaskPriority.ELEVATION_ALIGNMENT_SCENE:
c.TaskPriority.ELEVATION_ALIGNMENT:c.TaskPriority.ELEVATION_ALIGNMENT}_updateTaskPriority(){const l=this._taskPriority;l!==this._lastTaskPriority&&(this._lastTaskPriority=this._task.priority=l)}normalizeCtorArgs(){return{}}addExtent(l){this._extentSet.add(l);this._updateTaskPriority();this.running=!0}schedule(l){this._nodeSet.add(l);this._updateTaskPriority();this.running=!0}remove(l){this._nodeSet.delete(l);this._updateRunning()}runTask(l){const w=this._extentSet;for(l.run(()=>w.merge(l));!w.empty&&
!l.done;){var x=this._updateExtent(w.pop());null!=x&&x.forAll(u=>this.schedule(u));l.madeProgress()}if(!l.done){x=this._nodeSet;for(const u of x)if(x.delete(u),this._updateNode(u),l.madeProgress(),l.done)break;this._updateRunning()}}_updateRunning(){this.running=0<this._nodeSet.size||0<this._extentSet.size}};b.__decorate([k.property()],a.I3SAsyncElevationUpdater.prototype,"running",void 0);a.I3SAsyncElevationUpdater=b.__decorate([g.subclass("esri.views.3d.layers.i3s.I3SAsyncElevationUpdater")],a.I3SAsyncElevationUpdater);
Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/I3SCrossfadeHelper":function(){define(["exports","../../../../core/maybe","../../../../core/scheduling","../support/I3SLayerView"],function(a,b,n,k){class p{constructor(){this.lodCrossfadeSignedDuration=0}}class h{constructor(e){this._view=e;this._currentFrameStartTime=this._preRenderFrameTaskHandle=null;this._numFadingNodes=0}destroy(){this._preRenderFrameTaskHandle?.remove();this._view=this._preRenderFrameTaskHandle=
null}get updating(){return 0<this._numFadingNodes}stopNodeFading(e){null!=e.lodCrossfadeProgress&&(this._numFadingNodes--,e.lodCrossfadeProgress=null,0===this._numFadingNodes&&(null!=this._preRenderFrameTaskHandle&&(this._preRenderFrameTaskHandle=b.removeMaybe(this._preRenderFrameTaskHandle)),this._view.notifyLODUpdate(),this._view.notifyUpdate()))}_startNodeFading(e,g,d){0===this._numFadingNodes&&(this._preRenderFrameTaskHandle=n.addFrameTask({preRender:f=>this._updateAllNodeFading(f)}),this._view.notifyLODUpdate());
null==e.lodCrossfadeProgress&&(this._numFadingNodes++,this._view.notifyUpdate());e.lodCrossfadeSignedDuration=d;e.lodCrossfadeProgress=g}_updateAllNodeFading(e){const g=this._view.nodeCrossfadingEnabled;this._view.foreachCrossfadeNode((d,f)=>{if(null!=d?.lodCrossfadeProgress){const c=d.lodCrossfadeSignedDuration,l=d.lodCrossfadeProgress+Math.abs(e.deltaTime/c),w=!g||1<=l||0===c,x=(0<c?this._view.fullOpacity:0)-(w?0:0<c?1:-1)*(1-l);w?(this.stopNodeFading(d),0>c&&this._view.markNodeToRemove(f)):d.lodCrossfadeProgress=
l;this._view.setNodeOpacityByIndex(f,x)}});this._view.removeMarkedNodes()}stopAllNodeFading(){this._view.foreachCrossfadeNode((e,g)=>{null!=e?.lodCrossfadeProgress&&(this.stopNodeFading(e),e=e.lodCrossfadeSignedDuration,0>e&&this._view.markNodeToRemove(g),this._view.setNodeOpacityByIndex(g,0<e?this._view.fullOpacity:0))});this._view.removeMarkedNodes()}fadeNode(e,g,d,f){null==this._currentFrameStartTime&&(this._currentFrameStartTime=Date.now());var c=this._view;const l=c.nodeCrossfadingEnabled,w=
d===k.FadeDirection.FadeIn?c.fullOpacity:0;f=l?f?d===k.FadeDirection.FadeIn?c.lodCrossfadeinDuration:c.lodCrossfadeoutDuration:c.lodCrossfadeUncoveredDuration:0;c=this._view.getNodeOpacityByIndex(e);l&&c!==w&&0<f?this._startNodeFading(g,1-Math.abs(w-c),(d===k.FadeDirection.FadeIn?1:-1)*f):(this.stopNodeFading(g),this._view.setNodeOpacityByIndex(e,w),d===k.FadeDirection.FadeOut&&this._view.removeNode(e))}isNodeFullyFadedIn(e){const g=this._view.getNodeCrossfadeMetaData(e);return null==g||null==g.lodCrossfadeProgress&&
this._view.getNodeOpacityByIndex(e)===this._view.fullOpacity}}a.I3SCrossfadeHelper=h;a.NodeCrossfadeMetaData=p;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/I3SIntersectionHandler":function(){define("exports ../../../ViewingMode ./I3SUtil ./Intersector ../../webgl-engine/lib/Intersector ../../webgl-engine/lib/IntersectorInterfaces ../../webgl-engine/lib/RayIntersections ../../webgl-engine/lib/verticalOffsetUtils".split(" "),function(a,b,n,k,p,h,e,g){function d(c,
l,w,x=0){x=c[3]+x;const u=l[0]-c[0],t=l[1]-c[1];c=l[2]-c[2];l=w[0];const m=w[1];w=w[2];const q=l*u+m*t+w*c;return 0<=q*q-(l*l+m*m+w*w)*(u*u+t*t+c*c-x*x)}class f{constructor(c){this.type=h.IntersectorType.I3S;this._needVerticalOffset=!1;this.layerUid=c.layerUid;this.sublayerUid=c.sublayerUid;this._collection=c.collection;this._traverseNodeHierarchy=c.traverseNodeHierarchy;this.slicePlaneEnabled=c.slicePlaneEnabled;this.isGround=c.isGround}updateElevationAlignState(c,l){this._needVerticalOffset=c&&
l===b.ViewingMode.Global}intersect(c,l,w,x,u,t=!1){const m=c.results,q=c.options.store===h.StoreResults.ALL,r=c.ray.direction,v=c.tolerance;let y=C=>C,B=C=>C;const z=g.getVerticalOffsetI3S(c.verticalOffset??(this._needVerticalOffset?0:null));null!=c.verticalOffset&&null!=z&&(y=C=>z.applyToMbs(C),B=C=>z.applyToObb(C));const A=new e.MeshIntersectionOptions(t,c.options.normalRequired);this._traverseNodeHierarchy((C,H)=>{if(0===C.childrenLoaded)return!1;const E=C.serviceObbInRenderSR?.isValid?C.serviceObbInRenderSR:
null;if(E&&!B(E).intersectRay(w,r,v))return!1;!H||!E&&n.isValidMbs(C.serviceMbsInRenderSR)&&!d(y(C.serviceMbsInRenderSR),w,r,v)||null!=C.geometryObbInRenderSR&&!B(C.geometryObbInRenderSR).intersectRay(w,r,v)||this._collection.intersect(H,w,x,v,z,A,(F,G,D,I)=>{if(!(0>G||null!=l&&!l(w,x,G))){var J=N=>{const M=new k.I3sTarget(this.layerUid,this.sublayerUid,C.index,F,I);N.set(this.type,M,G,D)};this.isGround&&(null==m.ground.dist||G<m.ground.dist)&&J(m.ground);if(!c.options.isFiltered&&((null==m.min.dist||
G<m.min.dist)&&J(m.min),(null==m.max.dist||G>m.max.dist)&&J(m.max),q)){const N=p.newIntersectorResult(c.ray);J(N);c.results.all.push(N)}}});return!0})}}a.I3SIntersectionHandler=f;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/I3SOverrides":function(){define("exports ../../../../chunks/tslib.es6 ../../../../request ../../../../core/Accessor ../../../../core/arrayUtils ../../../../core/asyncUtils ../../../../core/byteSizeEstimations ../../../../core/Collection ../../../../core/handleUtils ../../../../core/has ../../../../core/Logger ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/ReactiveSet ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/decorators/subclass ../../../../geometry/support/spatialReferenceUtils ../../../../intl/number ../../../../layers/support/featureQueryAll ../../../../rest/support/meshFeatureSet ../../../../support/requestUtils ../../../ViewingMode".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w,x,u,t,m,q,r,v,y,B,z){function A(E,F,G,D){return`Displaying the edits of a SceneLayer with a${D===H.Mode?E.isGeographic?" geographic ":" projected ":" "}spatial reference (wkid:${E.wkid}) in ${G} viewing mode${D===H.SpatialReference?` with spatial reference (wkid:${F.wkid}) `:" "}is not supported. No geometry edits will be displayed for this layer.\nPlease consider re-caching the scene service or changing the ${D===H.Mode?"viewing mode":"view spatial reference"} to display edits.`}
a.I3SOverrides=class extends k{constructor(E){super(E);this._warnMaximumChangedObjectsExceeded=!1;this._maximumNumberOfEditOVerrides=5E4;this._definitionExpressionDirty=!0;this._interactiveEditingSessions=new g;this.geometryOverrides=new g;this._clientGeometryCache=new Map;this._attributeChangedObjectIds=new x;this._geometryChangedObjectIds=new x;this._pendingFetchChangedObjectIds=null;this._pendingFetchAbortController=new AbortController;this._applyGeometryOverridesTask=null;this._featureIdLocks=
new Map}initialize(){this._memCache=this.memoryController.newCache(`i3s-attribute-overrides-${this.layer.uid}`);this.addHandles(u.watch(()=>this.layer.definitionExpression,async()=>{this._definitionExpressionDirty=!0;this._pendingFetchChangedObjectIds||(this._applyGeometryOverridesTask=l.abortMaybe(this._applyGeometryOverridesTask),this._applyGeometryOverridesTask=h.createTask(E=>this._queryAndAddGeometryOverrides(E)),await this._applyGeometryOverridesTask.promise)},u.sync));this._pendingFetchChangedObjectIds=
this._fetchChangedObjectIds(this._pendingFetchAbortController?.signal);this._pendingFetchChangedObjectIds.finally(()=>{this._pendingFetchChangedObjectIds=this._pendingFetchAbortController=null})}destroy(){this._set("layer",null);this._memCache=l.destroyMaybe(this._memCache);this._pendingFetchAbortController=l.abortMaybe(this._pendingFetchAbortController);this._pendingFetchChangedObjectIds=null;this._featureIdLocks.clear()}get is3DOFL(){return null!=this._associatedLayer?.infoFor3D}get sortedGeometryChangedObjectIds(){return this.is3DOFL?
[...this._geometryChangedObjectIds].sort((E,F)=>E-F):[]}get _associatedLayer(){return null==this.layer?null:this.layer.associatedLayer}get hasGeometryChanges(){return 0<this._geometryChangedObjectIds.size}get updating(){return this.is3DOFL?this._pendingFetchChangedObjectIds||this._applyGeometryOverridesTask&&!this._applyGeometryOverridesTask.finished?!0:!1:!1}get isEmpty(){return null==this._pendingFetchChangedObjectIds&&0===this._attributeChangedObjectIds.size&&0===this._geometryChangedObjectIds.size}featureHasGeometryChanges(E){return this._geometryChangedObjectIds.has(E)}featureHasAttributeChanges(E){return this._attributeChangedObjectIds.has(E)}createInteractiveEditSession(E){this._attributeChangedObjectIds.add(E);
const F=this._interactiveEditingSessions,G=new C(E,()=>{F.remove(G)});F.unshift(G);return G}async applyAttributeOverrides(E,F,G,D=[]){this._pendingFetchChangedObjectIds&&await w.whenOrAbort(this._pendingFetchChangedObjectIds,G);if(null!=F){var {attributeData:I,loadedAttributes:J}=F;if(null!=J&&null!=I&&0!==this._attributeChangedObjectIds.size){F=new Set;for(var N of J)F.add(N.index);for(const Q of D)F.has(Q.index)||(J.push(Q),I[Q.name]=Array(E.length));D=await this._lockFeatureIds(E);try{N={attributeData:I,
loadedAttributes:J};const Q=this._getOverridesFromCache(E,N,this._attributeChangedObjectIds),{objectIds:O,fieldNames:K}=Q;if(0!==O.length&&0!==K.length){var M=await this._queryAttributeOverridesFromAssociatedLayer(O,K,G);null!=M&&this._processOverridesFromAssociatedLayer(E,M,K,N)}}finally{D.remove()}}}}updateGeometry(E,F){this._geometryChangedObjectIds.add(E);const G=this._clientGeometryCache.get(E);null!=G&&(this.geometryOverrides.remove(G),this._clientGeometryCache.delete(E));null!=F&&(F={oid:E,
mesh:F},this.geometryOverrides.add(F),this._clientGeometryCache.set(E,F))}updateAttributeValue(E,F,G){this._attributeChangedObjectIds.add(E);this._cacheAttributeValue(E,F,G)}featureAdded(E){this.is3DOFL&&this._geometryChangedObjectIds.add(E);this._attributeChangedObjectIds.add(E)}_cacheAttributeValue(E,F,G){this._memCache.put(this._getAttributeCacheKey(E,F),G,this._memCacheAttributeValueSize(G))}_getOverridesFromCache(E,{loadedAttributes:F,attributeData:G},D){const I=new Set,J=[];for(var N of F)J[N.index]=
G[N.name];G=new Set;for(N=0;N<E.length;N++){const M=E[N];if(D.has(M))for(const Q of F){const O=this._attributeFromCache(M,Q.index);void 0!==O?J[Q.index][N]=O:(I.add(M),G.add(Q.name))}}return{objectIds:Array.from(I),fieldNames:Array.from(G)}}_attributeFromCache(E,F){const G=this._fromInteractiveEditingSession(E,F);if(void 0!==G)return G;E=this._getAttributeCacheKey(E,F);return this._memCache.get(E)}_fromInteractiveEditingSession(E,F){if(null!=this._interactiveEditingSessions)for(const G of this._interactiveEditingSessions){if(G.objectId!==
E)continue;const D=G.getAttribute(F);if(void 0!==D)return D}}_getAttributeCacheKey(E,F){return`${E}-${F}`}async _queryAttributeOverridesFromAssociatedLayer(E,F,G){if(0===E.length)return null;this._logWarningIfMaximumObjectsExceeded();const {associatedLayer:D}=this.layer;if(null==D)return null;const I=D.createQuery(),{objectIdField:J}=D;F=[J,...F];I.where=this.layer.definitionExpression||"1\x3d1";I.returnGeometry=!1;I.outFields=F;I.cacheHint=!0;E=await this._executeBatchQuery(D,E,I,G);G=[];for(const N of E)if(N.ok)for(const M of N.value.features)G.push(M);
return G}async _queryGeometryOverridesFromAssociatedLayer(E,F){if(0===E.length||!this.is3DOFL)return null;var G=this.layer.associatedLayer;const D=G.infoFor3D,{spatialReference:I}=G,{state:{viewingMode:J},spatialReference:N}=this.view;var M=J===z.ViewingMode.Global,Q=I.isGeographic;if(M&&!Q)return c.getLogger(this).warn("unsupported-pcs-edits-in-global-view",this.layer.title,A(I,N,this.view.viewingMode,H.Mode)),null;if(!M&&Q)return c.getLogger(this).warn("unsupported-gcs-edits-in-local-view",this.layer.title,
A(I,N,this.view.viewingMode,H.Mode)),null;if(!(q.equals(I,N)||M&&N.isWebMercator&&I.isWGS84))return c.getLogger(this).warn("unsupported-mismatched-spatial-reference-edits",this.layer.title,A(I,N,this.view.viewingMode,H.SpatialReference)),null;this._logWarningIfMaximumObjectsExceeded();const {objectIdField:O,globalIdField:K}=G;M=[O,...(null!=K?[K]:[])];Q=G.createQuery();Q.where=this.layer.definitionExpression||"1\x3d1";Q.returnGeometry=!0;Q.outFields=M;Q.cacheHint=!0;Q.returnZ=G.hasZ;Q.returnM=G.hasM;
F=await this._executeBatchQuery(G,E,Q,F);E=[];for(const L of F){if(!L.ok)continue;const {assetMaps:P,features:R,globalIdFieldName:W}=L.value;if(null!=P){F=y.assetMapFromAssetMapsJSON(D,P);for(const V of R)G=y.extractMesh(V,W,I,D,F),M=V,null==G?M.geometry=null:(M.geometry=G,E.push(M))}}return E}_logWarningIfMaximumObjectsExceeded(){if(this._warnMaximumChangedObjectsExceeded){this._warnMaximumChangedObjectsExceeded=!1;var E=`The number of edited objects that are not yet cached in the scene service exceeds the maximum limit. Attribute changes will only be available for the first ${r.formatNumber(this._maximumNumberOfEditOVerrides)} objects. Please consider re-caching the scene service`,
F=this.layer.portalItem;E=F?.loaded?E+` (${F.portal.url}/home/item.html?id=${F.id}#settings)`:E+` (${this.layer.parsedUrl.path})`;c.getLogger(this).warn("#queryOverrides()",this.layer.title,`${E}.`)}}async _executeBatchQuery(E,F,G,D){if(0===F.length)return[];const I=v.getMaximumQuerySize(E);F=[...F].sort((J,N)=>J-N);F=p.splitIntoChunks(F,I).map(J=>{const N=G.clone();N.objectIds=J;return h.resultOrAbort(v.queryAllJSON(E,N,{signal:D}))});return Promise.all(F)}_processOverridesFromAssociatedLayer(E,
F,G,{loadedAttributes:D,attributeData:I}){var J=this._associatedLayer;if(null!=J){J=J.objectIdField;var N=G.map(O=>{O in I||(I[O]=Array(E.length));return I[O]}),M=new Map(D.map(O=>[O.name,O.index]));D=G.map(O=>M.get(O));var Q=new Map(Array.from(E,(O,K)=>[O,K]));for(const O of F){F=O.attributes[J];for(let K=0;K<G.length;K++){const L=D[K],P=Q.get(F),R=O.attributes[G[K]];N[K][P]=R;this._cacheAttributeValue(F,L,R)}}}}_memCacheAttributeValueSize(E){return"string"===typeof E?e.estimateStringByteSize(E):
e.estimateNumberByteSize()}async _fetchChangedObjectIds(E){var F=this.layer;await F.load({signal:E});this._geometryChangedObjectIds.clear();this._attributeChangedObjectIds.clear();var {associatedLayer:G}=F;if(null!=G&&G.capabilities?.operations?.supportsChangeTracking){var D=this._getFetchChangedObjectIdsServerGen();if(null!=D){var I=G.layerId;F=this.is3DOFL;D={f:"json",returnIdsOnly:!0,layers:`[${I}]`,returnUpdates:!0,returnDeletes:F,returnInserts:F,layerServerGens:JSON.stringify([{id:I,serverGen:D}])};
F&&(I=G.infoFor3D,D.fieldsToCompare=JSON.stringify({fields:[...Object.values(I.transformFieldRoles),I.sourceHashField]}));G=await h.result(n(`${G.url}/extractChanges`,{method:"post",query:D,timeout:1E4,signal:E}));!G.ok&&B.isTimeoutError(G.error)&&(D=this.layer.title,c.getLogger(this).warn("extractChanges:timeout",D,`${D} could not obtain edited features that are not cached in the scene service. Display of features may not be up to date with the latest edits. Consider re-caching the scene service.`));
if(G.ok&&1===G.value.data?.edits?.length){D=G.value.data.edits[0];G=D?.objectIds;I=G?.adds??[];const J=G?.updates??[],N=G?.deletes??[];G=[...I,...J,...N];F=F?[...I,...(D?.fieldUpdates??J),...N]:[];D=Math.min(this._maximumNumberOfEditOVerrides,G.length);D<G.length&&(this._warnMaximumChangedObjectsExceeded=!0);G=G.sort((M,Q)=>M-Q);for(I=0;I<D;++I)this._attributeChangedObjectIds.add(G[I]);for(const M of F)this._geometryChangedObjectIds.add(M);for(;this._definitionExpressionDirty;)await this._queryAndAddGeometryOverrides(E)}}}}async _queryAndAddGeometryOverrides(E){this._definitionExpressionDirty=
!1;const {associatedLayer:F}=this.layer;if(null!=F&&F.capabilities?.operations?.supportsChangeTracking&&this.is3DOFL&&0<this._geometryChangedObjectIds.size&&(E=await this._queryGeometryOverridesFromAssociatedLayer(Array.from(this._geometryChangedObjectIds),E),null!=E))for(const G of E)null!=G.geometry&&this.updateGeometry(G.attributes[F.objectIdField],G.geometry)}_getFetchChangedObjectIdsServerGen(){var E=this.layer;if(null!=E.serviceUpdateTimeStamp?.lastUpdate)return E.serviceUpdateTimeStamp.lastUpdate;
E=E.associatedLayer;return null!=E?.serverGens?.minServerGen?E.serverGens.minServerGen:null}async _lockFeatureIds(E){const F=this._featureIdLocks;for(var G=!0;G;){const I=[];for(const J of E){const N=F.get(J);N&&I.push(N)}0===I.length?G=!1:await Promise.all(I)}const D=w.createResolver();G=D.promise;for(const I of E)F.set(I,G);return d.makeHandle(()=>{for(const I of E)F.delete(I);D.resolve()})}get test(){}};b.__decorate([t.property({constructOnly:!0})],a.I3SOverrides.prototype,"view",void 0);b.__decorate([t.property({constructOnly:!0})],
a.I3SOverrides.prototype,"layer",void 0);b.__decorate([t.property({readOnly:!0})],a.I3SOverrides.prototype,"is3DOFL",null);b.__decorate([t.property()],a.I3SOverrides.prototype,"_interactiveEditingSessions",void 0);b.__decorate([t.property({readOnly:!0})],a.I3SOverrides.prototype,"sortedGeometryChangedObjectIds",null);b.__decorate([t.property({readOnly:!0})],a.I3SOverrides.prototype,"geometryOverrides",void 0);b.__decorate([t.property()],a.I3SOverrides.prototype,"_clientGeometryCache",void 0);b.__decorate([t.property()],
a.I3SOverrides.prototype,"_associatedLayer",null);b.__decorate([t.property({constructOnly:!0})],a.I3SOverrides.prototype,"memoryController",void 0);b.__decorate([t.property()],a.I3SOverrides.prototype,"_attributeChangedObjectIds",void 0);b.__decorate([t.property()],a.I3SOverrides.prototype,"_geometryChangedObjectIds",void 0);b.__decorate([t.property()],a.I3SOverrides.prototype,"hasGeometryChanges",null);b.__decorate([t.property()],a.I3SOverrides.prototype,"_pendingFetchChangedObjectIds",void 0);b.__decorate([t.property()],
a.I3SOverrides.prototype,"_pendingFetchAbortController",void 0);b.__decorate([t.property()],a.I3SOverrides.prototype,"_applyGeometryOverridesTask",void 0);b.__decorate([t.property()],a.I3SOverrides.prototype,"updating",null);b.__decorate([t.property()],a.I3SOverrides.prototype,"isEmpty",null);a.I3SOverrides=b.__decorate([m.subclass("esri.views.3d.layers.i3s.I3SOverrides")],a.I3SOverrides);class C{constructor(E,F){this.objectId=E;this._remove=F;this._updates=new Map;this._isActive=!0}getAttribute(E){return this._updates.get(E)}setAttribute(E,
F){this.isActive&&this._updates.set(E,F)}remove(){this.isActive&&(this._isActive=!1,this._remove())}get isActive(){return this._isActive}}var H;(function(E){E[E.Mode=0]="Mode";E[E.SpatialReference=1]="SpatialReference"})(H||={});Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/rest/support/meshFeatureSet":function(){define("exports ../../Graphic ../../core/Logger ../../core/MapUtils ../../geometry/Extent ../../geometry/Mesh ../../geometry/SpatialReference ../../geometry/support/meshUtils/External ../../layers/support/infoFor3D ./FeatureSet ./meshFeatureAttributes".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c){function l(t){return({attributes:m})=>{if(!m)return{};if(!t)return m;for(const q in m)t.has(q)||delete m[q];return m}}function w(t,m,q,r,v){var y=v.get(t.attributes[m]);if(null==y||!t.geometry)return null;m=c.extractMeshFeatureOrigin(t.attributes,q,r.transformFieldRoles);v=p.fromJSON(t.geometry);v.spatialReference=q;t=c.extractMeshFeatureTransform(t.attributes,r.transformFieldRoles);q=q.isGeographic?"local":"georeferenced";a:{y=Array.from(y.files.values());r=[];for(B of y){if(B.status!==
u.COMPLETED){var B=null;break a}y=[];for(const z of B.parts){if(!z){B=null;break a}y.push(new g.ServiceAssetPart(z.url,z.hash))}r.push(new g.ServiceAsset(B.name,B.mimeType,y))}B=r}return B?h.createWithExternalSource(m,B,{extent:v,transform:t,vertexSpace:q,unitConversionDisabled:!0}):h.createIncomplete(m,{extent:v,transform:t,vertexSpace:q})}function x(t,m){const q=new Map;for(const v of m){var r=v.parentGlobalId;if(null==r)continue;const y=v.assetName,B=v.assetType;m=v.assetHash;const z=v.assetURL,
A=v.conversionStatus,C=v.seqNo,H=d.getFormatIdMimeType(B,t.supportedFormats);H?(r=k.getOrCreateMapValue(q,r,()=>({files:new Map})),k.getOrCreateMapValue(r.files,y,()=>{a:switch(A){case "COMPLETED":case "SUBMITTED":var E=u.COMPLETED;break a;case "INPROGRESS":E=u.PENDING;break a;default:E=u.FAILED}return{name:y,type:B,mimeType:H,status:E,parts:[]}}).parts[C]={hash:m,url:z}):n.getLogger("esri.rest.support.meshFeatureSet").error("mesh-feature-set:unknown-format",`Service returned an asset of type ${B}, but it does not list it as a supported type`)}return q}
var u;(function(t){t[t.FAILED=0]="FAILED";t[t.PENDING=1]="PENDING";t[t.COMPLETED=2]="COMPLETED"})(u||={});a.assetMapFromAssetMapsJSON=x;a.extractMesh=w;a.meshFeatureSetFromJSON=function(t,m,q){var r=q.features;q.features=[];delete q.geometryType;const v=f.fromJSON(q);v.geometryType="mesh";if(!q.assetMaps)return v;const y=x(m,q.assetMaps),B=t.sourceSpatialReference??e.WGS84;q=q.globalIdFieldName;({outFields:t}=t);t=null!=t&&0<t.length?l(t.includes("*")?null:new Set(t)):()=>({});for(const z of r)r=
w(z,q,B,m,y),v.features.push(new b({geometry:r,attributes:t(z)}));return v};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/rest/support/meshFeatureAttributes":function(){define(["exports","../../geometry","../../geometry/support/MeshTransform","../../geometry/Point"],function(a,b,n,k){const p={originX:"originX",originY:"originY",originZ:"originZ",translationX:"translationX",translationY:"translationY",translationZ:"translationZ",scaleX:"scaleX",scaleY:"scaleY",scaleZ:"scaleZ",
rotationX:"rotationX",rotationY:"rotationY",rotationZ:"rotationZ",rotationDeg:"rotationDeg"};a.extractMeshFeatureOrigin=function(h,e,g=p){return new k({x:h[g.originX],y:h[g.originY],z:h[g.originZ],spatialReference:e})};a.extractMeshFeatureTransform=function(h,e=p){return new n({translation:[h[e.translationX],-h[e.translationZ],h[e.translationY]],rotationAxis:[h[e.rotationX],-h[e.rotationZ],h[e.rotationY]],rotationAngle:h[e.rotationDeg],scale:[h[e.scaleX],h[e.scaleZ],h[e.scaleY]]})};Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/IDBCache":function(){define(["exports","../../../../core/ByteSizeUnit","../../../../core/Error","../../../../core/promiseUtils"],function(a,b,n,k){function p(g){return new Promise((d,f)=>{g.oncomplete=()=>d();g.onerror=()=>f(g.error);g.onabort=()=>f(g.error)})}function h(g){return new Promise((d,f)=>{"done"===g.readyState?null!=g.error?f(g.error):d(g.result):(g.onsuccess=()=>d(g.result),g.onerror=()=>f(g.error))})}class e{constructor(g,
d,f=14){this._version=f;this._quotaReductionPromise=this._db=null;this._miss=this._hit=this._gcCounter=0;this._destroyed=!1;this.gcFrequency=50;this.maxByteSize=b.ByteSizeUnit.GIGABYTES;this.quotaReductionFactor=.2;this._dbName=g;this._storeName=d}init(){return Promise.resolve().then(()=>{const g=indexedDB.open(this._dbName,this._version);g.onupgradeneeded=d=>{var f=g.result;const c=g.transaction,l=f.objectStoreNames.contains(this._storeName)?c.objectStore(this._storeName):f.createObjectStore(this._storeName);
f=f.objectStoreNames.contains("last_access")?c.objectStore("last_access"):f.createObjectStore("last_access");f.indexNames.contains("date")||f.createIndex("date","date",{unique:!1});f.indexNames.contains("byteSize")||f.createIndex("byteSize","byteSize",{unique:!1});d.oldVersion<this._version&&(l.clear(),f.clear())};return h(g)}).then(g=>{this._destroyed?g.close():this._db=g})}destroy(){this._db&&(this._db.close(),this._db=null);this._destroyed=!0}get initialized(){return null!=this._db}getHitRate(){return this._hit/
(this._hit+this._miss)}put(g,d){return null==this._db?Promise.reject(new n("indexedb:not-initialized","IndexedDB Cache is not initialized")):(null!=this._quotaReductionPromise?this._quotaReductionPromise:Promise.resolve()).then(()=>this._put(g,d)).catch(f=>{if(f&&"QuotaExceededError"===f.name)return null==this._quotaReductionPromise&&(this._quotaReductionPromise=this._getCacheSize().then(c=>this._removeLeastRecentlyAccessed(d.byteSize+Math.ceil(c*this.quotaReductionFactor))),this._quotaReductionPromise.then(()=>
this._quotaReductionPromise=null,()=>this._quotaReductionPromise=null)),this._quotaReductionPromise.then(()=>this._put(g,d));throw f;}).then(()=>{this._gcCounter--;0>this._gcCounter&&null!=this._db&&(this._gcCounter=this.gcFrequency,this._getCacheSize().then(f=>this._removeLeastRecentlyAccessed(f-this.maxByteSize)))})}get(g,d){const f=this._db;if(null==f)return Promise.resolve(void 0);let c=null;return Promise.resolve().then(()=>{const l=f.transaction(this._storeName,"readonly");c=k.onAbort(d,()=>
{l.abort()});const w=l.objectStore(this._storeName).get(g);return h(w)}).then(l=>{null==l?++this._miss:this._db&&(++this._hit,this._db.transaction("last_access","readwrite").objectStore("last_access").put({date:Date.now(),byteSize:l.byteSize},g));null!=c&&c.remove();return l}).catch(()=>{++this._miss;k.throwIfAborted(d);null!=c&&c.remove()})}remove(g){const d=this._db;return null==d?Promise.resolve():Promise.resolve().then(async()=>{const f=d.transaction([this._storeName,"last_access"],"readwrite");
var c=f.objectStore(this._storeName),l=f.objectStore("last_access");c=c.delete(g);l=l.delete(g);await Promise.all([h(c),h(l),p(f)])})}_put(g,d){var f=this._db;if(null==f)return Promise.resolve();f=f.transaction([this._storeName,"last_access"],"readwrite");var c=f.objectStore(this._storeName);const l=f.objectStore("last_access");c=c.put(d,g);g=l.put({date:Date.now(),byteSize:d.byteSize},g);return Promise.all([h(c),h(g),p(f)])}_removeLeastRecentlyAccessed(g){if(0>=g||!this._db)return Promise.resolve();
const d=this._db.transaction([this._storeName,"last_access"],"readwrite"),f=d.objectStore(this._storeName),c=d.objectStore("last_access");let l=0;const w=c.index("date").openCursor(null,"next");w.onsuccess=()=>{const x=w.result;null!=x&&(null!=x.value.byteSize&&(l+=x.value.byteSize),f.delete(x.primaryKey),c.delete(x.primaryKey),l<g&&x.continue())};return p(d)}_getCacheSize(){var g=this._db;if(null==g)return Promise.resolve(0);g=g.transaction("last_access");let d=0;const f=g.objectStore("last_access").index("byteSize").openKeyCursor();
f.onsuccess=()=>{const c=f.result;if(c){var l=c.key;null!=l&&(d+=l);c.continue()}};return p(g).then(()=>d)}}a.IDBCache=e;a.whenRequest=h;a.whenTransaction=p;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/IDBMockCache":function(){define(["exports"],function(a){const b=new WeakMap;class n{constructor(k,p){this._hit=this._miss=0;this.initialized=!0;switch(p){case "layer":this._data=new Map;break;case "view":(p=b.get(k))?this._data=p:(this._data=p=new Map,b.set(k,
p))}}init(){return Promise.resolve()}async get(k,p){if(this._data.has(k))return this._hit++,this._data.get(k)??void 0;this._miss++}destroy(){}put(k,p){this._data.set(k,p);return Promise.resolve()}remove(k){this._data.delete(k);return Promise.resolve()}getHitRate(){return this._hit/(this._hit+this._miss)}}a.IDBMockCache=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/LayerElevationProvider":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Evented ../../../../core/Logger ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ../../../../core/libs/gl-matrix-2/math/mat4 ../../../../core/libs/gl-matrix-2/factories/mat4f64 ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../geometry/projection/projectBoundingSphere ../../../../geometry/support/aaBoundingRect ../../../../chunks/sphere ../../support/ElevationRange ../../support/ElevationUpdateEvent ../../webgl-engine/lib/Intersector ../../webgl-engine/lib/IntersectorInterfaces".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w,x,u,t,m,q,r,v){a.LayerElevationProvider=class extends k.EventedMixin(n){constructor(H){super(H);this._tmpEvent=new q.ElevationUpdateEvent;this._renderCoordsHelper=H.view.renderCoordsHelper;this._renderSR=this._renderCoordsHelper.spatialReference;this._layerElevationSource=H.layerElevationSource}initialize(){this._intersector=r.newIntersector(this.view.state.viewingMode);this._intersector.options.store=v.StoreResults.MIN;this._intersector.options.normalRequired=!1;
this._tmpEvent.context=this.intersectionHandler.isGround?"ground":"scene"}get spatialReference(){return this.view?.elevationProvider?.spatialReference}getElevation(H,E,F,G){const D=this._renderCoordsHelper;H=l.set(z,H,E,F);if(!D.toRenderCoords(H,G,H))return p.getLogger(this).error("could not project point to compute elevation"),null;const {layerElevationSource:I,_intersector:J,intersectionHandler:N}=this;G=I.fullExtent;E=null!=G&&Number.isFinite(G.xmin)&&Number.isFinite(G.xmax)&&Number.isFinite(G.ymin)&&
Number.isFinite(G.ymax)&&Number.isFinite(G.zmin)&&Number.isFinite(G.zmax)?new m.ElevationRange(G.zmin,G.zmax):I.elevationRange;if(null==E)return null;F=I.elevationOffset;G=E.elevationRangeMin+F;E=D.setAltitude(A,E.elevationRangeMax+F,H);G=D.setAltitude(C,G,H);J.reset(E,G,null);N.intersect(J,null,E,G,null,!0);return J.results.min.getIntersectionPoint(H)?D.getAltitude(H):null}getSphereElevationBounds(H,E){x.projectBoundingSphere(H,E,B,this._renderSR);return this._layerElevationSource.getElevationRange(B)}getRootElevationBounds(){const H=
this.layerElevationSource.fullExtent;return H?.hasZ?new m.ElevationRange(H.zmin,H.zmax):null}objectsChanged(H){this.spatialReference&&(this._computeLayerExtent(H,this._tmpEvent.extent),this._tmpEvent.spatialReference=this.spatialReference,this.emit("elevation-change",this._tmpEvent))}objectChanged(H){this.spatialReference&&(this._computeObjectExtent(H,this._tmpEvent.extent),this._tmpEvent.spatialReference=this.spatialReference,this.emit("elevation-change",this._tmpEvent))}_computeObjectExtent(H,E){u.empty(E);
this._expandExtent(H,E)}_computeLayerExtent(H,E){u.empty(E);for(const F of H)this._expandExtent(F,E)}_expandExtent(H,E){const F=this.spatialReference;if(null!=F&&null!=H){f.fromQuat(y,H.quaternion);y[12]=H.center[0];y[13]=H.center[1];y[14]=H.center[2];H=H.halfSize;for(let G=0;8>G;++G)z[0]=G&1?H[0]:-H[0],z[1]=G&2?H[1]:-H[1],z[2]=G&4?H[2]:-H[2],l.transformMat4(z,z,y),this._renderCoordsHelper.fromRenderCoords(z,z,F),u.expand(E,z,E)}}};b.__decorate([h.property({constructOnly:!0})],a.LayerElevationProvider.prototype,
"layerElevationSource",void 0);b.__decorate([h.property({constructOnly:!0})],a.LayerElevationProvider.prototype,"intersectionHandler",void 0);b.__decorate([h.property({constructOnly:!0})],a.LayerElevationProvider.prototype,"view",void 0);b.__decorate([h.property()],a.LayerElevationProvider.prototype,"spatialReference",null);a.LayerElevationProvider=b.__decorate([d.subclass("esri.views.3d.layers.i3s.LayerElevationProvider")],a.LayerElevationProvider);const y=c.create(),B=t.fromValues(0,0,0,0),z=w.create(),
A=w.create(),C=w.create();Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/support/makeScheduleFunction":function(){define(["exports"],function(a){a.makeScheduleFunction=function(b){return n=>{if(b.immediate)return b.immediate.schedule(n);console.error("No immediate scheduler");throw Error("No immediate scheduler");}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/collections/Component/ObjectParameters":function(){define(["exports"],
function(a){class b{constructor(n,k,p,h){this.toMapSpace=n;this.transform=k;this.obb=p;this.geometry=h}}a.ObjectParameters=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/collections/Component/Transform":function(){define(["exports"],function(a){class b{constructor(n,k){this.position=n;this.rotationScale=k;this.origin=void 0}}a.Transform=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/featureEditing":function(){define(["exports",
"../../../../core/asyncUtils","../../../../core/lang","../../../../core/uuid","../../../../layers/support/featureQueryAll"],function(a,b,n,k,p){function h(x,u,t,m,q=null,r=!0){const v=[];x={gidToFeatureInfo:new Map,oidToFeatureInfo:new Map,featuresResolved:null==t,fieldsIndex:x.fieldsIndex,objectIdField:x.objectIdField,globalIdField:x.globalIdField,featureOrIdentifierList:t};for(const A of u)if(null==A.error){u=A.objectId??-1;t=A.globalId;if(-1===u||r){var y=u;var B=t,z=x;const {gidToFeatureInfo:C,
oidToFeatureInfo:H,fieldsIndex:E,objectIdField:F,globalIdField:G,featureOrIdentifierList:D}=z;if(!z.featuresResolved&&null!=D){for(const I of D){const J={feature:null,oid:-1,gid:null};if("attributes"in I){J.feature=I;const N=I.attributes;if(null!=N)for(const M in N){if(-1!==J.oid&&null!=J.gid)break;const Q=E.normalizeFieldName(M);Q===F&&(J.oid=N[M]??-1);Q===G&&(J.gid=N[M])}}else J.oid=I.objectId??-1,J.gid=I.globalId;null!=J.gid&&C.set(J.gid,J);-1!==J.oid&&H.set(J.oid,J)}z.featuresResolved=!0}y=(-1!==
y?H.get(y):null)??(null!=B?C.get(B):null)}else y=null;y=y??{feature:null,oid:u,gid:t};u={oid:-1===u?y.oid:u,gid:t??y.gid,feature:y.feature,result:A};v.push(u);t=u.gid?k.normalizeGlobalID(u.gid):null;-1===u.oid&&null!=t&&null!=q&&(u.oid=q.get(t)??-1);-1===u.oid&&null!=t&&(y=m.get(t),null==y&&(y={gid:u.gid,edits:[]},m.set(t,y)),y.edits.push(u))}return v}async function e(x,u){x=x.i3sOverrides.layer.associatedLayer;if(null!=x?.globalIdField){var t=x.createQuery(),{objectIdField:m,globalIdField:q}=x;t.where=
Array.from(u.values()).map(({gid:r})=>`${q}='${r}'`).join(" OR ");t.returnGeometry=!1;t.outFields=[m,q];t.cacheHint=!1;x=await b.resultOrAbort(p.queryAllJSON(x,t));if(x.ok){x=x.value.features;for(const r of x)if(t=r.attributes[q],x=r.attributes[m],null!=t&&null!=x&&-1!==x&&(t=u.get(k.normalizeGlobalID(t)),null!=t))for(const v of t.edits)v.oid=x}}}function g(x,u){const t=new Map;u=u.adds;if(!u||0===u.length||null==x.globalIdField)return t;for(const m of u)x=m.oid,u=m.feature,"mesh"===u?.geometry?.type&&
t.set(x,u);return t}function d(x,u){const t=u.updates;if(!t||0===t.length)return new w;const m=new w;u=new Map;for(let q=0;q<x.attributeStorageInfo.length;q++)u.set(x.attributeStorageInfo[q].name,q);x.forEachNode((q,r)=>{for(const A of t){if(null==A.feature)continue;const C=A.feature,H=A.oid,E=r.indexOf(H);for(const F in C.attributes){var v=x.fieldsIndex.normalizeFieldName(F);var y=m;var B=q.index,z=y.get(B);z?y=z:(z=new l,y.set(B,z),y=z);(B=null!=v&&y.get(v))?v=B:(B=[],y.set(v,B),v=B);v.push({featureIndex:E,
featureId:H,value:C.attributes[F]})}}});return m}const f={setAttribute(){},rollback(){},commit(){}};var c;(function(x){x[x.EDITING=0]="EDITING";x[x.ROLLED_BACK=1]="ROLLED_BACK";x[x.COMMITTED=2]="COMMITTED"})(c||={});const l=Map,w=Map;a.createInteractiveEditSession=function(x,u){const t=u.attributes[x.objectIdField];if(null==t)return f;var m=x.sessions.get(t);if(m)return m;const q=n.clone(u.attributes),r=new Set,v=x.i3sOverrides.createInteractiveEditSession(t),y=new Map;let B=c.EDITING;m={setAttribute(z,
A){if(B===c.EDITING){var C=x.fieldsIndex.get(z);if(C){var H=x.attributeStorageInfo.findIndex(G=>G.name===C.name);if(!(0>H)){if(!(z in q))throw Error(`Attribute "${z}" is not an attribute of the edited feature.`);v.setAttribute(H,A);var E=x.attributeStorageInfo[H],F=!1;r.add(z);x.forEachNode((G,D)=>{var I=y.get(G);null==I?(D=D.indexOf(t),y.set(G,D)):D=I;if(-1!==D&&(I=x.getAttributeData(G.index))){const J=I[E.name];J&&(J[D]=A,x.setAttributeData(G.index,I,u),F=!0)}});F&&x.clearMemCache()}}}},rollback(){if(B===
c.EDITING){for(const z of r)this.setAttribute(z,q[z]);v.remove();B=c.ROLLED_BACK;x.sessions.delete(t)}},commit(){B===c.EDITING&&(v.remove(),B=c.COMMITTED,x.sessions.delete(t))}};x.sessions.set(t,m);return m};a.normalizeEditResultsEvent=async function(x,u){const t=new Map,m=h(x,u.addedFeatures,u.edits?.addFeatures,t),q=h(x,u.updatedFeatures,u.edits?.updateFeatures,t);u=h(x,u.deletedFeatures,u.edits?.deleteFeatures,t,u.globalIdToObjectId,!1);0<t.size&&await e(x,t);return{adds:m.filter(r=>-1!==r.oid),
updates:q.filter(r=>-1!==r.oid),deletes:u.filter(r=>-1!==r.oid)}};a.processAttributeEdits=function(x,u){var t=d(x,u);u=g(x,u);if(0!==t.size||0!==u.size){var m=new Map;for(var q=0;q<x.attributeStorageInfo.length;q++)m.set(x.attributeStorageInfo[q].name,q);var r=!1;t.forEach((A,C)=>{const H=x.getAttributeData(C);let E=!1;A.forEach((F,G)=>{const D=null!=H?H[G]:null;G=m.get(G);for(const {featureIndex:I,value:J,featureId:N}of F)D&&(D[I]=J,r=E=!0),x.i3sOverrides.updateAttributeValue(N,G,J)});E&&x.setAttributeData(C,
H,null)});r&&x.clearMemCache();var {fieldsIndex:v,i3sOverrides:y,objectIdField:B,globalIdField:z}=x;t=y.layer.associatedLayer?.infoFor3D;t=new Set(t?[...Object.values(t.assetMapFieldRoles),...Object.values(t.transformFieldRoles)]:[]);for(const [A,C]of u){y.featureAdded(A);({attributes:u}=C);for(const H in u)H!==B&&H!==z&&t.has(H)||(q=v.normalizeFieldName(H),q=null!=q?m.get(q):null,null!=q&&y.updateAttributeValue(A,q,u[H]))}}};a.processGeometryEdits=function(x,u){const t=new Map,m=q=>{for(const {oid:r,
feature:v}of q)q=v?.geometry,"mesh"===q?.type&&t.set(r,q)};m(u.adds);m(u.updates);for(const q of u.deletes)t.set(q.oid,null);for(const [q,r]of t)x.i3sOverrides.updateGeometry(q,r)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/I3SMeshViewFilter":function(){define("require exports ../../../../chunks/tslib.es6 ../../../../geometry ../../../../core/Accessor ../../../../core/arrayUtils ../../../../core/Logger ../../../../core/mathUtils ../../../../core/maybeUpdating ../../../../core/reactiveUtils ../../../../core/unitUtils ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../core/sql/WhereClause ../../../../geometry/ellipsoidUtils ../../../../geometry/projection ../../../../geometry/projection/projectBoundingSphere ../../../../geometry/projection/projectVectorToVector ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/aaBoundingRect ../../../../geometry/support/DoubleArray ../../../../geometry/support/Ellipsoid ../../../../geometry/support/spatialReferenceUtils ../../../../chunks/sphere ../../../../geometry/support/webMercatorUtils ../../../../layers/support/FeatureFilter ./I3SUtil ../../../../geometry/SpatialReference".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w,x,u,t,m,q,r,v,y,B,z,A,C,H,E,F,G,D,I){function J(da,fa,ha){if(null==fa)return null;if("disjoint"===ha&&"polygon"===fa.type){ha=fa.rings.length;const T=fa.spatialReference,S=Array(ha);for(let Y=0;Y<ha;++Y){const ea=z.fromValues(Infinity,Infinity,-Infinity,-Infinity);z.expandWithNestedArray(ea,fa.rings[Y]);S[Y]={type:"polygon",rings:[fa.rings[Y]],spatialReference:T,cache:{},aabr:ea}}S.sort((Y,ea)=>Y.aabr[0]-ea.aabr[0]);const Z=new Set,ia=new h.PositionHint;for(fa=0;fa<
S.length;++fa){const Y=S[fa],ea=Y.aabr[0];Z.forEach(ka=>{ea>=ka.aabr[2]?Z.delete(ka):Y.aabr[1]>ka.aabr[3]||Y.aabr[3]<ka.aabr[1]||!da.intersects(Y,ka)||(Y.rings=Y.rings.concat(ka.rings),z.expand(Y.aabr,ka.aabr,Y.aabr),Y.cache={},Z.delete(ka),ka=h.indexOf(S,ka,S.length,ia),S.splice(ka,1))});Z.add(Y)}for(const Y of S)Y.aabr=void 0;return S}return[fa]}function N(da,fa,ha,T,S){if(fa[3]>=.5*(fa[2]+q.getReferenceEllipsoid(T).radius))return!0;const Z=O(da,fa,T);return ha.every(ia=>K(da,ia,Z,S)!==V.DISCARD)}
function M(da,fa,ha,T,S,Z,ia,Y){const ea=ia[0].spatialReference||S.spatialReference;if(v.projectBoundingSphere(ha.node.serviceMbsInIndexSR,Z,ba,ea)){Z=O(da,ba,ea);var ka=Q(Y,S,ea,T,ha.objectHandle);for(const ja of ia){if(0===fa.length)break;switch(K(da,ja,Z,Y)){case V.DISCARD:fa.length=0;return;case V.KEEP:continue}D.filterInPlace(fa,ha.featureIds,X=>R(da,ja,X,ka))}}else e.getLogger("esri.views.3d.layers.i3s.I3SMeshViewFilter").warnOnce("SceneLayerView.filter.geometry is using unsupported SpatialReference, skipping geometry filter")}
function Q(da,fa,ha,T,S){fa=fa.renderSpatialReference;const Z=new Map,ia={type:"polygon",rings:[[[0,0,0],[0,0,0],[0,0,0],[0,0,0]]],spatialReference:ha};ia.rings[0][3]=ia.rings[0][0];let Y,ea;switch(da){case "intersects":Y=(ka,ja,X)=>ka.intersects(ja,X)?V.KEEP:V.TEST;ea=L;break;case "contains":Y=(ka,ja,X)=>ka.contains(ja,X)?V.TEST:V.DISCARD;ea=L;break;default:Y=(ka,ja,X)=>ka.disjoint(ja,X)?V.TEST:V.DISCARD,ea=P}return{collection:T,object:S,type:da,maskSR:ha,renderSR:fa,aabbCache:Z,triangle:ia,positions:{indices:null,
data:null,stride:0,startIndex:0,endIndex:0},triangleTest:Y,geometryTest:ea}}function O(da,fa,ha){const T={type:"point",x:fa[0],y:fa[1],hasZ:!1,hasM:!1,spatialReference:ha};ha=!H.isWGS84(ha)&&!H.isWebMercator(ha);fa=Number.isNaN(fa[3])?0:g.clamp(fa[3],0,2*C.earth.radius);da=ha?da.buffer(T,fa,1):da.geodesicBuffer(T,fa,1);da.type="polygon";return da}function K(da,fa,ha,T){switch(T){case "intersects":case "contains":return L(da,fa,ha);case "disjoint":return P(da,fa,ha)}}function L(da,fa,ha){return da.intersects(fa,
ha)?da.contains(fa,ha)?V.KEEP:V.TEST:V.DISCARD}function P(da,fa,ha){return da.intersects(fa,ha)?da.contains(fa,ha)?V.DISCARD:V.TEST:V.KEEP}function R(da,fa,ha,T){const {collection:S,object:Z,renderSR:ia,maskSR:Y,geometryTest:ea,aabbCache:ka}=T;var ja=ka.get(ha);if(!ja){ja=S.getObjectTransform(Z);S.getComponentAabb(Z,ha,U);var X=[t.fromValues(U[0],U[1],0),t.fromValues(U[0],U[4],0),t.fromValues(U[3],U[4],0),t.fromValues(U[3],U[1],0)];for(var aa=0;4>aa;++aa)u.transformMat3(X[aa],X[aa],ja.rotationScale),
u.add(X[aa],X[aa],ja.position),y.projectVectorToVector(X[aa],ia,X[aa],Y);ja={type:"polygon",rings:[X],spatialReference:Y,cache:{}};ja.rings[0][4]=ja.rings[0][0];ka.set(ha,ja)}switch(ea(da,fa,ja)){case V.DISCARD:return!1;case V.KEEP:return!0}const {triangle:pa,triangleTest:la,positions:na}=T;ja=pa.rings[0][0];X=pa.rings[0][1];aa=pa.rings[0][2];const qa=S.getObjectTransform(Z);S.getComponentPositions(Z,ha,na);const {indices:sa,data:xa,stride:ta,startIndex:Ba,endIndex:Ia}=na;for(ha=Ba;ha<Ia;ha+=3){const Ca=
ta*sa[ha],Ha=ta*sa[ha+1],Ga=ta*sa[ha+2];u.set(ja,xa[Ca],xa[Ca+1],xa[Ca+2]);u.set(X,xa[Ha],xa[Ha+1],xa[Ha+2]);u.set(aa,xa[Ga],xa[Ga+1],xa[Ga+2]);u.transformMat3(ja,ja,qa.rotationScale);u.transformMat3(X,X,qa.rotationScale);u.transformMat3(aa,aa,qa.rotationScale);u.add(ja,ja,qa.position);u.add(X,X,qa.position);u.add(aa,aa,qa.position);y.projectVectorToVector(ja,ia,ja,Y);y.projectVectorToVector(X,ia,X,Y);y.projectVectorToVector(aa,ia,aa,Y);switch(la(da,fa,pa)){case V.DISCARD:return!1;case V.KEEP:return!0}}switch(T.type){case "intersects":return!1;
default:return!0}}b.I3SMeshViewFilter=class extends p{constructor(da){super(da);this._projectionEngineLoaded=!1}initialize(){f.whenOnce(()=>this.viewFilter?.geometry||null!=this.layerFilter).then(()=>this.loadAsyncModule((new Promise((da,fa)=>a(["../../../../geometry/geometryEngine"],da,fa))).then(da=>{this.destroyed||(this._geometryEngine=da)})))}get sortedObjectIds(){if(null==this.viewFilter?.objectIds)return null;const da=A.doubleArrayFrom(this.viewFilter.objectIds);da.sort();return da}get parsedWhereClause(){const da=
this.viewFilter?.where;if(null==da||!da)return null;try{return m.WhereClause.create(da,{fieldsIndex:this.layerFieldsIndex})}catch(fa){e.getLogger("esri.views.3d.layers.i3s.I3SMeshViewFilter").error(`Failed to parse filter where clause: ${fa}`)}return null}addFilters(da,fa,ha,T){const S=this.sortedObjectIds;null!=S&&da.push(ea=>D.objectIdFilter(S,!0,ea));this.addSqlFilter(da,this.parsedWhereClause);this.addTimeFilter(da,this.viewFilter?.timeExtent);const Z=d.unwrapUpdating(this._layerMaskGeometries),
ia=this._geometryEngine;if(null!=Z&&null!=this.layerFilter&&null!=ia){const ea=this.layerFilter.spatialRelationship;da.push((ka,ja)=>M(ia,ka,ja,T,fa,ha,Z,ea))}const Y=d.unwrapUpdating(this._viewMaskGeometries);if(null!=Y&&null!=this.viewFilter&&null!=ia){const ea=this.viewFilter.spatialRelationship;da.push((ka,ja)=>M(ia,ka,ja,T,fa,ha,Y,ea))}}isMBSGeometryVisible(da,fa,ha){var T=d.unwrapUpdating(this._layerMaskGeometries);const S=this._geometryEngine;if(null!=T&&null!=this.layerFilter&&null!=S){var Z=
this.layerFilter.spatialRelationship;fa=T[0].spatialReference||fa;return v.projectBoundingSphere(da,ha,ba,fa)?N(S,ba,T,fa,Z):(e.getLogger("esri.views.3d.layers.i3s.I3SMeshViewFilter").warnOnce("SceneLayer.mask geometry is using unsupported SpatialReference, skipping geometry filter for MBS"),!0)}T=d.unwrapUpdating(this._viewMaskGeometries);return null!=T&&null!=this.viewFilter&&null!=S?(Z=this.viewFilter.spatialRelationship,fa=T[0].spatialReference||fa,v.projectBoundingSphere(da,ha,ba,fa)?N(S,ba,
T,fa,Z):(e.getLogger("esri.views.3d.layers.i3s.I3SMeshViewFilter").warnOnce("SceneLayerView.filter.geometry is using unsupported SpatialReference, skipping geometry filter for MBS"),!0)):!0}get parsedGeometry(){const da=d.unwrapUpdating(this._viewMaskGeometries),fa=d.unwrapUpdating(this._layerMaskGeometries);return null==da||null==fa?da||fa:fa.concat(da)}get _layerMaskGeometries(){const da=this.layerFilter;return null==da?null:null==this._geometryEngine?d.updating:"disjoint"===da.spatialRelationship?
da.geometries.map(fa=>({type:"polygon",rings:fa.rings,spatialReference:fa.spatialReference,cache:{}})):[da.geometries.reduce((fa,ha)=>{fa.rings=[...fa.rings,...ha.rings];return fa},{type:"polygon",rings:[],spatialReference:da.geometries[0].spatialReference,cache:{}})]}get _viewMaskGeometries(){if(null==this.viewFilter)return null;var {geometry:da}=this.viewFilter;if(null==da)return null;if(null==this.viewFilter||null==this._geometryEngine)return d.updating;const {distance:fa,units:ha}=this.viewFilter,
T=this.viewFilter.spatialRelationship;da="mesh"===da.type?da.extent:da;if(null==fa||0===fa)return J(this._geometryEngine,da,T);const S=ha||c.getUnitString(da.spatialReference);if(da.spatialReference.isWGS84)return da=this._geometryEngine.geodesicBuffer(da,fa,S),J(this._geometryEngine,da,T);var Z=F.project(da,I.WGS84);if(null!=Z)return da=F.project(this._geometryEngine.geodesicBuffer(Z,fa,S),da.spatialReference),J(this._geometryEngine,da,T);if(!this._projectionEngineLoaded&&(this.loadAsyncModule(r.load().then(()=>
this._projectionEngineLoaded=!0)),!this._projectionEngineLoaded))return null;Z=null;try{Z=r.project(da,I.WGS84)}catch(ia){}if(Z)try{Z=r.project(this._geometryEngine.geodesicBuffer(Z,fa,S),da.spatialReference)}catch(ia){Z=null}Z||e.getLogger("esri.views.3d.layers.i3s.I3SMeshViewFilter").error(`Filter by geodesic buffer (distance) unsupported, failed to project input geometry (${da.spatialReference.wkid}) to WGS84.`);return J(this._geometryEngine,Z,T)}get updating(){return d.isUpdating(this._layerMaskGeometries)||
d.isUpdating(this._viewMaskGeometries)}static checkSupport(da){if(null==da)return!1;da=da.spatialRelationship;return null!=da&&W.includes(da)?!0:(e.getLogger("esri.views.3d.layers.i3s.I3SMeshViewFilter").warn(`Filters with spatialRelationship other than ${W.join(", ")} are not supported for mesh scene layers`),!1)}};n.__decorate([l.property()],b.I3SMeshViewFilter.prototype,"layerFilter",void 0);n.__decorate([l.property({type:G})],b.I3SMeshViewFilter.prototype,"viewFilter",void 0);n.__decorate([l.property()],
b.I3SMeshViewFilter.prototype,"layerFieldsIndex",void 0);n.__decorate([l.property()],b.I3SMeshViewFilter.prototype,"loadAsyncModule",void 0);n.__decorate([l.property()],b.I3SMeshViewFilter.prototype,"addSqlFilter",void 0);n.__decorate([l.property()],b.I3SMeshViewFilter.prototype,"addTimeFilter",void 0);n.__decorate([l.property({readOnly:!0})],b.I3SMeshViewFilter.prototype,"sortedObjectIds",null);n.__decorate([l.property({readOnly:!0})],b.I3SMeshViewFilter.prototype,"parsedWhereClause",null);n.__decorate([l.property({readOnly:!0})],
b.I3SMeshViewFilter.prototype,"parsedGeometry",null);n.__decorate([l.property({readOnly:!0})],b.I3SMeshViewFilter.prototype,"_layerMaskGeometries",null);n.__decorate([l.property({readOnly:!0})],b.I3SMeshViewFilter.prototype,"_viewMaskGeometries",null);n.__decorate([l.property()],b.I3SMeshViewFilter.prototype,"updating",null);n.__decorate([l.property()],b.I3SMeshViewFilter.prototype,"_projectionEngineLoaded",void 0);n.__decorate([l.property()],b.I3SMeshViewFilter.prototype,"_geometryEngine",void 0);
b.I3SMeshViewFilter=n.__decorate([x.subclass("esri.views.3d.layers.i3s.I3SMeshViewFilter")],b.I3SMeshViewFilter);const W=["contains","intersects","disjoint"];var V;(function(da){da[da.KEEP=0]="KEEP";da[da.DISCARD=1]="DISCARD";da[da.TEST=2]="TEST"})(V||={});const ba=E.fromValues(0,0,0,0),U=B.create();Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/core/maybeUpdating":function(){define(["exports"],function(a){a.isUpdating=function(b){return"updating"===b};a.unwrapUpdating=function(b){return"updating"===
b?null:b};a.updating="updating";Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/I3SQueryEngine":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Error ../../../../core/maybe ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/Logger ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ../../../../geometry/Extent ../../../../layers/LayerConstants ../../../../layers/graphics/data/QueryEngine ../../../../layers/support/FieldsIndex ../../../../rest/support/FeatureSet ../../../../rest/support/Query".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w,x,u,t){const m=w.QueryEngine;a.I3SQueryEngine=class extends n{get spatialReference(){return this.layerView.view.spatialReference}get layer(){return this.layerView.i3slayer}get defaultQueryJSON(){return(new t({outSpatialReference:this.spatialReference})).toJSON()}get _dataQueryEngine(){return this._ensureDataQueryEngine()}constructor(q){super(q)}initialize(){this.addHandles(this.layerView.on("visible-geometry-changed",()=>this.spatialIndex.events.emit("changed")))}destroy(){this._dataQueryEngineInstance=
p.destroyMaybe(this._dataQueryEngineInstance);this._set("layerView",null)}async executeQueryForCount(q,r){return this._dataQueryEngine.executeQueryForCount(this._ensureQueryJSON(q),r)}async executeQueryForExtent(q,r){const {count:v,extent:y}=await this._dataQueryEngine.executeQueryForExtent(this._ensureQueryJSON(q),r);q=c.fromJSON(y);return{count:v,extent:q}}async executeQueryForIds(q,r){return this._dataQueryEngine.executeQueryForIds(this._ensureQueryJSON(q),r)}async executeQuery(q,r){q=this._ensureQueryJSON(q);
if(q.returnGeometry)throw new k("unsupported-query","returnGeometry is not supported when querying a mesh scene layer view, it is only supported when directly querying a scene layer");if(q.returnCentroid)throw new k("unsupported-query","returnCentroid is not yet supported for mesh scene layer queries");r=await this._dataQueryEngine.executeQuery(q,r);r=u.fromJSON(r);r.features.forEach(v=>v.geometry=null);return r}_ensureQueryJSON(q){return null==q?this.defaultQueryJSON:q.toJSON()}_ensureDataQueryEngine(){if(this._dataQueryEngineInstance)return this._dataQueryEngineInstance;
const q=this.layer.objectIdField||l.fallbackObjectIDAttribute,r=this.layer.fieldsIndex?.toJSON()||new x([]),v=this.layerView.view.resourceController.scheduler,y=this.spatialReference.toJSON();return this._dataQueryEngineInstance=new m({hasZ:!0,hasM:!1,geometryType:"esriGeometryPolygon",fieldsIndex:r,timeInfo:null,spatialReference:y,objectIdField:q,featureStore:this.spatialIndex,scheduler:v,priority:this.priority})}};b.__decorate([h.property({constructOnly:!0})],a.I3SQueryEngine.prototype,"layerView",
void 0);b.__decorate([h.property({constructOnly:!0})],a.I3SQueryEngine.prototype,"priority",void 0);b.__decorate([h.property({constructOnly:!0})],a.I3SQueryEngine.prototype,"spatialIndex",void 0);b.__decorate([h.property()],a.I3SQueryEngine.prototype,"spatialReference",null);b.__decorate([h.property()],a.I3SQueryEngine.prototype,"layer",null);b.__decorate([h.property()],a.I3SQueryEngine.prototype,"defaultQueryJSON",null);a.I3SQueryEngine=b.__decorate([f.subclass("esri.views.3d.layers.i3s.I3SQueryEngine")],
a.I3SQueryEngine);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/I3SQueryFeatureAdapter":function(){define(["exports","../../../../geometry/support/aaBoundingBox","../../../../layers/graphics/centroid","../../../../layers/graphics/OptimizedGeometry","./I3SUtil"],function(a,b,n,k,p){class h{constructor(g){this._objectIdField=g.objectIdField;this._getFeatureExtent=g.getFeatureExtent}getObjectId(g){return g.id}getAttributes(g){const {meta:d,index:f}=g,c={};
this._objectIdField&&(c[this._objectIdField]=g.id);g=d.attributeInfo?.attributeData;if(null!=g)for(const l of Object.keys(g))c[l]=p.getCachedAttributeValue(g[l],f);return c}getAttribute(g,d){if(d===this._objectIdField)return g.id;const {meta:f,index:c}=g;g=f.attributeInfo?.attributeData;return null!=g?p.getCachedAttributeValue(g[d],c):null}getGeometry(g){if(g.geometry)return g.geometry;const [d,f,c,l,w]=this._getFeatureExtent(g,e);return new k([5],[d,f,c,l,f,c,l,w,c,d,w,c,d,f,c])}getCentroid(g,d){if(g.geometry)return n.getCentroidOptimizedGeometry(new k,
g.geometry,d.hasZ,d.hasM);const [f,c,l,w,x,u]=this._getFeatureExtent(g,e);return new k([0],[(f+w)/2,(c+x)/2,(l+u)/2])}cloneWithGeometry(g,d){const {id:f,index:c,meta:l}=g;return{id:f,index:c,meta:l,geometry:d}}}const e=b.create();a.I3SQueryFeatureAdapter=h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/I3SQueryFeatureStore":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Evented ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/Logger ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ../../../../geometry/projection/projectBoundingSphere ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/aaBoundingRect ../../../../chunks/sphere ../II3SMeshView3D".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w,x){const u=c.create();a.I3SQueryFeatureStore=class extends n{constructor(r){super(r);this.events=new k}forEach(r){this.forAllFeatures(v=>{r(v);return x.ForAllFeaturesReturnType.CONTINUE})}forEachBounds(r,v){const y=this.getFeatureExtent;for(const B of r)v(y(B,u))}forEachInBounds(r,v){this.forAllFeatures(y=>{const B=this.getFeatureExtent(y,m);l.intersects(r,c.toRect(B,q))&&v(y);return x.ForAllFeaturesReturnType.CONTINUE},y=>{f.projectBoundingSphere(y.node.serviceMbsInIndexSR,
this.sourceSpatialReference,t,this.viewSpatialReference);if(t[0]>=r[0]&&t[2]<=r[2]&&t[1]>=r[1]&&t[3]<=r[3])return x.ForAllFeaturesReturnType.CONTINUE;y=t[0]-Math.max(r[0],Math.min(t[0],r[2]));const B=t[1]-Math.max(r[1],Math.min(t[1],r[3]));return y*y+B*B<=t[3]*t[3]?x.ForAllFeaturesReturnType.CONTINUE:x.ForAllFeaturesReturnType.SKIP})}};b.__decorate([p.property({constructOnly:!0})],a.I3SQueryFeatureStore.prototype,"featureAdapter",void 0);b.__decorate([p.property({constructOnly:!0})],a.I3SQueryFeatureStore.prototype,
"forAllFeatures",void 0);b.__decorate([p.property({constructOnly:!0})],a.I3SQueryFeatureStore.prototype,"getFeatureExtent",void 0);b.__decorate([p.property({constructOnly:!0})],a.I3SQueryFeatureStore.prototype,"sourceSpatialReference",void 0);b.__decorate([p.property({constructOnly:!0})],a.I3SQueryFeatureStore.prototype,"viewSpatialReference",void 0);a.I3SQueryFeatureStore=b.__decorate([d.subclass("esri.views.3d.layers.i3s.I3SQueryFeatureStore")],a.I3SQueryFeatureStore);const t=w.fromValues(0,0,0,
0),m=c.create(),q=l.create();Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/support/DefinitionExpressionSceneLayerView":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/Logger ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ../../../../core/sql/WhereClause ../i3s/I3SUtil".split(" "),function(a,b,n,k,p,h,e,g,d){a.DefinitionExpressionSceneLayerView=
f=>{f=class extends f{constructor(){super(...arguments);this._definitionExpressionErrors=0;this._maxDefinitionExpressionErrors=20;this.logError=c=>{this._definitionExpressionErrors<this._maxDefinitionExpressionErrors&&n.getLogger(this).error("Error while evaluating definitionExpression: "+c);this._definitionExpressionErrors++;this._definitionExpressionErrors===this._maxDefinitionExpressionErrors&&n.getLogger(this).error("Further errors are ignored")}}get parsedDefinitionExpression(){if(!this.i3slayer?.definitionExpression)return null;
try{const c=g.WhereClause.create(this.i3slayer.definitionExpression,{fieldsIndex:this.i3slayer.fieldsIndex});if(!c.isStandardized)return n.getLogger(this).error("definitionExpression is using non standard function"),null;const l=[];d.findFieldsCaseInsensitive(c.fieldNames,this.i3slayer.fields,{missingFields:l});if(0<l.length)return n.getLogger(this).error(`definitionExpression references unknown fields: ${l.join(", ")}`),null;this._definitionExpressionErrors=0;return c}catch(c){return n.getLogger(this).error("Failed to parse definitionExpression: "+
c),null}}get definitionExpressionFields(){return this.parsedDefinitionExpression?this.parsedDefinitionExpression.fieldNames:[]}_evaluateClause(c,l){try{return c.testFeature(l)}catch(w){return this.logError(w),!1}}_addDefinitionExpressionToQuery(c){if(!this.parsedDefinitionExpression)return c;const l=this.i3slayer.definitionExpression;c=c.clone();c.where=c.where?`(${l}) AND (${c.where})`:l;return c}};b.__decorate([k.property({readOnly:!0})],f.prototype,"parsedDefinitionExpression",null);b.__decorate([k.property({readOnly:!0})],
f.prototype,"definitionExpressionFields",null);return f=b.__decorate([e.subclass("esri.views.3d.layers.support.DefinitionExpressionSceneLayerView")],f)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/support/fieldProperties":function(){define(["exports","../../../../layers/support/fieldUtils"],function(a,b){a.defineFieldProperties=function(){return{requiredFields:{type:[String],readOnly:!0},availableFields:{type:[String],readOnly:!0,get:function(){const {layer:n,
layer:{fieldsIndex:k},requiredFields:p}=this;return n.outFields?b.fixFields(k,[...b.unpackFieldNames(k,n.outFields),...p]):b.fixFields(k,p)}}}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/support/SceneLayerViewRequiredFields":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/AsyncUpdate ../../../../core/Logger ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ../../../../layers/support/fieldUtils".split(" "),
function(a,b,n,k,p,h,e,g,d,f){a.SceneLayerViewRequiredFields=class extends k.AsyncUpdateMixin(n){get layer(){return this.layerView.layer}get requiredFields(){const {layerView:{layer:{fieldsIndex:c},definitionExpressionFields:l},rendererFields:w,labelingFields:x,viewFilterFields:u}=this;return f.fixFields(c,[...(l??[]),...(w??[]),...(x??[]),...(u??[])])}constructor(c){super(c)}initialize(){this.addHandles([this.autoUpdateAsync("rendererFields",async()=>{const {fieldsIndex:c,renderer:l}=this.layer;
return l?this._getFieldsAsync(w=>l.collectRequiredFields(w,c)):null}),this.autoUpdateAsync("labelingFields",async()=>{const {layer:c}=this;return c.labelsVisible?this._getFieldsAsync(l=>f.collectLabelingFields(l,c)):null}),this.autoUpdateAsync("viewFilterFields",()=>{const {layer:c,mergedFilter:l}=this.layerView;return this._getFieldsAsync(w=>f.collectFilterFields(w,c,l))})])}async _getFieldsAsync(c){const l=new Set;try{return await c(l),Array.from(l).sort()}catch(w){return p.getLogger(this).error(w),
null}}};b.__decorate([h.property()],a.SceneLayerViewRequiredFields.prototype,"layerView",void 0);b.__decorate([h.property()],a.SceneLayerViewRequiredFields.prototype,"layer",null);b.__decorate([h.property()],a.SceneLayerViewRequiredFields.prototype,"requiredFields",null);b.__decorate([h.property()],a.SceneLayerViewRequiredFields.prototype,"rendererFields",void 0);b.__decorate([h.property()],a.SceneLayerViewRequiredFields.prototype,"labelingFields",void 0);b.__decorate([h.property()],a.SceneLayerViewRequiredFields.prototype,
"viewFilterFields",void 0);a.SceneLayerViewRequiredFields=b.__decorate([d.subclass("esri.views.3d.layers.support.SceneLayerViewRequiredFields")],a.SceneLayerViewRequiredFields);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/AsyncUpdate":function(){define("exports ../chunks/tslib.es6 ./Accessor ./Logger ./promiseUtils ./reactiveUtils ./accessorSupport/decorators/property ./accessorSupport/decorators/subclass".split(" "),function(a,b,n,k,p,h,e,g){const d=f=>{f=class extends f{constructor(){super(...arguments);
this._numUpdating=0}get updating(){return 0<this._numUpdating}autoUpdateAsync(c,l){const w=p.debounce(async x=>{++this._numUpdating;try{const u=await x;this.destroyed||this._set(c,u)}catch(u){k.getLogger(this).warn(`Async update of "${String(c)}" failed. Async update functions should not throw exceptions.`)}--this._numUpdating});return h.watch(l,w,h.initial)}};b.__decorate([e.property({readOnly:!0})],f.prototype,"updating",null);b.__decorate([e.property()],f.prototype,"_numUpdating",void 0);return f=
b.__decorate([g.subclass("esri.core.AsyncUpdate")],f)};a.AsyncUpdate=class extends d(n){};a.AsyncUpdate=b.__decorate([g.subclass("esri.core.AsyncUpdate")],a.AsyncUpdate);a.AsyncUpdateMixin=d;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/support/TemporalSceneLayerView":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/Logger ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ../../../../layers/graphics/data/timeSupport ../../../../layers/support/FeatureFilter ../../../../layers/support/timeSupport ../i3s/I3SUtil".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c){class l{constructor(w){this.attributeData=w}getAttribute(w,x){return c.getCachedAttributeValue(this.attributeData[x],w)}getAttributeAsTimestamp(w,x){w=this.getAttribute(w,x);return"string"===typeof w?(new Date(w)).getTime():"number"===typeof w||null==w?w:null}}a.TemporalSceneLayerView=w=>{w=class extends w{get timeExtent(){return f.combineTimeExtent(this.i3slayer,this.view?.timeExtent,this._get("timeExtent"))}get mergedFilter(){const {filter:x,timeExtent:u}=this;if(null==
u)return x;const t=x?.clone()??new d;null!=u&&(t.timeExtent=t.timeExtent?.intersection(u)??u);return t}getTimeFilterDependencies(){const {timeInfo:x}=this.i3slayer;if(null==x)return[];const {startField:u,endField:t}=x;return[u,t]}addTimeFilter(x,u){if(null!=u){var {timeInfo:t}=this.i3slayer;if(null!=t){var {startField:m,endField:q,useTime:r}=t;if(r&&(null!=m||null!=q)){var v=t.toJSON(),y=u.toJSON();x.push((B,z)=>{var A=z.attributeInfo?.attributeData;if(null!=A){var {startTimeField:C,endTimeField:H}=
v;null!=C&&null==A[C]||null!=H&&null==A[H]||(A=g.getTimeOperator(v,y,new l(A)),null!=A&&({featureIds:z}=z,c.filterInPlace(B,z,A)))}})}}}}};b.__decorate([n.property({readOnly:!0})],w.prototype,"timeExtent",null);b.__decorate([n.property()],w.prototype,"mergedFilter",null);return w=b.__decorate([e.subclass("esri.views.3d.layers.support.TemporalSceneLayerView")],w)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/layers/SceneLayerView":function(){define("require ../../chunks/tslib.es6 ../../core/arrayUtils ../../core/Logger ../../core/maybe ../../core/maybeUpdating ../../core/promiseUtils ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/has ../../core/accessorSupport/decorators/subclass ../../geometry/projection ./LayerView".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w){f=class extends w{constructor(){super(...arguments);this._geometryEngine=this.filter=this.layer=null;this._projectionEngineLoaded=!1;this._abortController=new AbortController}get availableFields(){return[]}get maximumNumberOfFeatures(){return 0}set maximumNumberOfFeatures(x){throw Error("Not implemented");}get maximumNumberOfFeaturesExceeded(){return!1}get layerFilter(){return h.unwrapUpdating(this._layerFilter)}get _layerFilter(){const x=this.layer?.filter;if(null==
x||1>x.geometries.length)return null;const u=this._geometryEngine;if(null==u||!this._projectionEngineLoaded&&this._filterNeedsProjectionEngine)return h.updating;const t=x.geometries.at(0).spatialReference,m=x.geometries.toArray().map(y=>{try{y=u.simplify(y)}catch(B){return k.getLogger(this).warnOncePerTick("Failed to simplify scene filter mask polygon. Polygon will be ignored."),null}if(null==y)return null;if(y.spatialReference.equals(t))return y;try{return l.project(y,t)}catch(B){return k.getLogger(this).warnOncePerTick("Failed to project scene filter mask polygon. Polygon will be ignored."),
null}}).filter(n.isSome).sort((y,B)=>y.extent.xmin-B.extent.xmin),q=new Set,r=[],v=[];for(let y of m){const B=y.extent.xmin;r.length=0;q.forEach(z=>{B>=z.extent.xmax?(v.push(z),q.delete(z)):y.extent.ymin<=z.extent.ymax&&y.extent.ymax>=z.extent.ymin&&u.intersects(y,z)&&r.push(z)});if(0<r.length){r.push(y);try{y=u.union(r)}catch(z){k.getLogger(this).warnOncePerTick("Failed to unify filter mask polygons. Polygon will be ignored.");continue}r.pop();r.forEach(z=>q.delete(z))}q.add(y)}q.forEach(y=>v.push(y));
return 0<v.length?{spatialRelationship:x.spatialRelationship,geometries:v}:null}get _filterNeedsProjectionEngine(){const x=this.layer.filter;if(null==x||1>=x.geometries.length)return!1;const u=x.geometries.at(0).spatialReference;return x.geometries.some(({spatialReference:t})=>!t.equals(u)&&!l.canProjectWithoutEngine(t,u))}get layerFilterUpdating(){return h.isUpdating(this._layerFilter)}initialize(){const {signal:x}=this._abortController;g.whenOnce(()=>this.destroyed||!this._geometryEngine&&this.layer?.filter?.geometries?.length,
x).then(async()=>{e.throwIfAbortError(x);this._geometryEngine=await new Promise((u,t)=>a(["../../geometry/geometryEngine"],u,t))}).catch(e.throwIfNotAbortError);this._projectionEngineLoaded=l.isLoaded();g.whenOnce(()=>this.destroyed||!this._projectionEngineLoaded&&this._filterNeedsProjectionEngine,x).then(async()=>{e.throwIfAbortError(x);await l.load();this._projectionEngineLoaded=!0}).catch(e.throwIfNotAbortError)}destroy(){this._abortController=p.abortMaybe(this._abortController)}highlight(x){throw Error("Not implemented");
}queryFeatures(x,u){throw Error("Not implemented");}queryObjectIds(x,u){throw Error("Not implemented");}queryFeatureCount(x,u){throw Error("Not implemented");}createQuery(){throw Error("Not implemented");}queryExtent(x,u){throw Error("Not implemented");}};b.__decorate([d.property()],f.prototype,"layer",void 0);b.__decorate([d.property()],f.prototype,"availableFields",null);b.__decorate([d.property()],f.prototype,"maximumNumberOfFeatures",null);b.__decorate([d.property({readOnly:!0})],f.prototype,
"maximumNumberOfFeaturesExceeded",null);b.__decorate([d.property()],f.prototype,"filter",void 0);b.__decorate([d.property({readOnly:!0})],f.prototype,"layerFilter",null);b.__decorate([d.property({readOnly:!0})],f.prototype,"_layerFilter",null);b.__decorate([d.property()],f.prototype,"_geometryEngine",void 0);b.__decorate([d.property()],f.prototype,"_projectionEngineLoaded",void 0);b.__decorate([d.property()],f.prototype,"_filterNeedsProjectionEngine",null);b.__decorate([d.property()],f.prototype,
"layerFilterUpdating",null);return f=b.__decorate([c.subclass("esri.views.layers.SceneLayerView")],f)})},"esri/views/3d/layers/SceneLayerGraphicsView3D":function(){define("require ../../../chunks/tslib.es6 ../../../core/arrayUtils ../../../core/has ../../../core/Logger ../../../core/maybe ../../../core/reactiveUtils ../../../core/typedArrayUtil ../../../core/uid ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/decorators/subclass ../../../chunks/vec32 ../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../geometry/projection/projectBuffer ../../../geometry/projection/projectVectorToVector ../../../geometry/support/contains ../../../geometry/support/DoubleArray ../../../geometry/support/zscale ../../../layers/LayerConstants ../../../layers/graphics/dehydratedFeatures ../../../layers/graphics/dehydratedPoint ../../../layers/graphics/hydratedFeatures ../../../layers/graphics/controllers/I3SOnDemandController ../../../layers/support/FeatureFilter ../../../rest/support/Query ../../../support/basemapUtils ./I3SPointsWorkerHandle ./LayerView3D ./graphics/Graphics3DFeatureProcessor ./graphics/QueryEngine ./i3s/featureEditing ./i3s/I3SGraphicsMap ./i3s/I3SOverrides ./i3s/I3SUtil ./support/DefinitionExpressionSceneLayerView ./support/fieldProperties ./support/LayerViewPerformanceInfo ./support/PopupSceneLayerView ./support/SceneLayerViewRequiredFields ./support/TemporalSceneLayerView ../support/debugFlags ../support/orientedBoundingBox ../support/updatingProperties ../webgl-engine/lib/Attribute ../webgl-engine/lib/UpdatePolicy ../../layers/SceneLayerView ../../layers/support/popupUtils ../../support/HighlightDefaults ../../support/Scheduler".split(" "),
function(a,b,n,k,p,h,e,g,d,f,c,l,w,x,u,t,m,q,r,v,y,B,z,A,C,H,E,F,G,D,I,J,N,M,Q,O,K,L,P,R,W,V,ba,U,da,fa,ha,T,S){function Z(X){return"geometryBuffer"in X&&null!==X.geometryBuffer}function ia(X){const aa=X.attributeInfo,pa=X.node.index;if(null!=aa?.loadedAttributes&&null!=aa.attributeData)for(let la=0;la<X.graphics.length;la++){const na=X.graphics[la];if(na.nodeIndex===pa){na.attributes||(na.attributes={});for(const {name:qa}of aa.loadedAttributes)aa.attributeData[qa]&&(na.attributes[qa]=M.getCachedAttributeValue(aa.attributeData[qa],
la))}}}k=O.defineFieldProperties();class Y{constructor(X,aa,pa,la){this.graphics=X;this.featureIds=aa;this.attributeInfo=pa;this.node=la}}F=class extends R.TemporalSceneLayerView(Q.DefinitionExpressionSceneLayerView(L.PopupSceneLayerView(F.LayerView3D(fa)))){constructor(){super(...arguments);this.type="scene-layer-graphics-3d";this._memCache=this._queryEngine=null;this._interactiveEditingSessions=new Map;this._pendingEditsQueue=Promise.resolve();this.loadedGraphics=new J.I3SGraphicsMap((X,aa,pa)=>
{{const la=aa.attributeInfo;if(null==la?.loadedAttributes||null==la.attributeData)X=!1;else{aa=!1;for(const {name:na}of la.loadedAttributes)if(la.attributeData[na]){const qa=M.getCachedAttributeValue(la.attributeData[na],pa);qa!==X.attributes[na]&&(X.attributes[na]=qa,aa=!0)}X=aa}}return X},X=>this.processor.graphicsCore.recreateGraphics(X));this.holeFilling="always";this.progressiveLoadFactor=1;this.supportsHeightUnitConversion=!0;this._coordinatesOutsideExtentErrors=0;this._maxCoordinatesOutsideExtentErrors=
20}tryRecycleWith(X,aa){return X.url===this.layer.url&&this._i3sOverrides.isEmpty?X.load(aa).then(()=>{M.checkRecyclable(this.layer,X,this._i3sOverrides);this.layer=X;this._i3sOverrides.destroy();this._i3sOverrides=new N.I3SOverrides({view:this.view,layer:X,memoryController:this.view.resourceController?.memoryController});h.destroyMaybe(this._queryEngine);this._setupQueryEngine();this.processor.resetObjectStates()}):null}initialize(){this.addResolvingPromise(this.layer.indexInfo);this._i3sOverrides=
new N.I3SOverrides({view:this.view,layer:this.layer,memoryController:this.view.resourceController?.memoryController});M.checkSpatialReferences(this.layer,this.view.spatialReference,this.view.viewingMode);this._fieldsHelper=new P.SceneLayerViewRequiredFields({layerView:this});this._updatingHandles.add(()=>this.layer.rangeInfos,X=>this._rangeInfosChanged(X),e.initial);this._updatingHandles.add(()=>this.layer.renderer,(X,aa)=>this._rendererChange(X,aa));this._updatingHandles.add(()=>[this.parsedDefinitionExpression,
this._excludeObjectIdsSorted],()=>this._filterChange());this.addHandles(e.watch(()=>W.debugFlags.I3S_TREE_SHOW_TILES,X=>{if(X&&!this._treeDebugger){const aa=this._controller.crsIndex;(new Promise((pa,la)=>a(["./support/I3STreeDebugger"],pa,la))).then(({I3STreeDebugger:pa})=>{!this._treeDebugger&&W.debugFlags.I3S_TREE_SHOW_TILES&&(this._treeDebugger=new pa({lv:this,view:this.view,nodeSR:aa}))})}else X||!this._treeDebugger||W.debugFlags.I3S_TREE_SHOW_TILES||(this._treeDebugger.destroy(),this._treeDebugger=
null)},e.initial));this._set("processor",new G.Graphics3DFeatureProcessor({owner:this,preferredUpdatePolicy:da.UpdatePolicy.ASYNC,scaleVisibilityEnabled:!0,filterVisibilityEnabled:!0,timeExtentEnabled:!1,frustumVisibilityEnabled:!1,elevationAlignmentEnabled:!0,elevationFeatureExpressionEnabled:!1,setUidToIdOnAdd:!1,dataExtent:this.layer.fullExtent,updateClippingExtent:X=>this._updateClippingExtent(X)}));this.processor.elevationAlignment?.events.on("invalidate-elevation",({extent:X,spatialReference:aa})=>
this._controller.updateElevationChanged(X,aa));this.supportsHeightUnitConversion&&(this._verticalScale=q.getGeometryZScaler("point",this.layer.spatialReference,this.view.spatialReference));this.addResolvingPromise(this.processor.when());this._memCache=this.view.resourceController.memoryController.newCache(`psl-${this.uid}`);this._controller=new z({layerView:this});M.containsDraco(this.layer.geometryDefinitions)&&(this._worker=new E.I3SPointsWorkerHandle(X=>this.view.resourceController.immediate.schedule(X)));
this.addHandles(this.layer.on("apply-edits",X=>this._updatingHandles.addPromise(X.result)));this.addHandles(this.layer.on("edits",X=>{const aa=this._pendingEditsQueue.then(()=>this._handleEdits(X)).then();this._pendingEditsQueue=aa;this._updatingHandles.addPromise(aa)}));this.when(()=>{this._setupQueryEngine();this._updatingHandles.add(()=>this.maximumNumberOfFeatures,X=>this._controller.featureTarget=X,e.initial);this._updatingHandles.add(()=>this.suspended,X=>{X&&this._removeAllNodeData()})})}destroy(){this._treeDebugger=
h.destroyMaybe(this._treeDebugger);this._i3sOverrides=h.destroyMaybe(this._i3sOverrides);this._set("processor",h.destroyMaybe(this.processor));this._controller=h.destroyMaybe(this._controller);this._queryEngine=h.destroyMaybe(this._queryEngine);this._worker=h.destroyMaybe(this._worker);this._memCache=h.destroyMaybe(this._memCache);this.loadedGraphics.clear();this._fieldsHelper=h.destroyMaybe(this._fieldsHelper)}get i3slayer(){return this.layer}get updatingProgressValue(){return this._controller?.updatingProgress??
1}get requiredFields(){return this._fieldsHelper?.requiredFields??[]}get maximumNumberOfFeatures(){return this.processor?.graphicsCore?.displayFeatureLimit?.maximumNumberOfFeatures??0}set maximumNumberOfFeatures(X){null!=X?(this._override("maximumNumberOfFeatures",X),this._controller.fixedFeatureTarget=!0):(this._clearOverride("maximumNumberOfFeatures"),this._controller.fixedFeatureTarget=!1)}get maximumNumberOfFeaturesExceeded(){return this.suspended?!1:!!this._controller?.useMaximumNumberOfFeatures&&
!this._controller.leavesReached}get _excludeObjectIdsSorted(){const X=this.layer.excludeObjectIds;return X.length?X.toArray().sort((aa,pa)=>aa-pa):null}get lodFactor(){return"Labels"===this.layer.semantic?1:this.view.qualitySettings.sceneService.point.lodFactor}get hasM(){return!1}get hasZ(){return!0}get contentVisible(){return!this.suspended&&!!this._controller?.rootNodeVisible}get legendEnabled(){return this.contentVisible&&!0===this.i3slayer?.legendEnabled}async whenGraphicAttributes(X,aa){return M.whenGraphicAttributes(this.layer,
X,this._getObjectIdField(),aa,()=>[...this.loadedGraphics.nodes()])}getHit(X){if(!this.loadedGraphics)return null;const aa=B.hydrateGraphic(this.loadedGraphics.find(la=>la.uid===X),this.layer),pa=this._getObjectIdField();if(!aa?.attributes?.[pa])return null;aa.layer=this.layer;aa.sourceLayer=this.layer;return{type:"graphic",graphic:aa,layer:aa.layer}}whenGraphicBounds(X,aa){return this.processor.whenGraphicBounds(X,aa)}computeAttachmentOrigin(X,aa){return this.processor.computeAttachmentOrigin(X,
aa)}isUpdating(){return!!(this._controller?.updating||this.processor?.updating||this._fieldsHelper?.updating||this.layerFilterUpdating)}highlight(X,aa){return this.processor.highlight(X,this.layer.objectIdField,aa??T.defaultHighlightName)}get updatePolicy(){return this.processor.graphicsCore.effectiveUpdatePolicy}createInteractiveEditSession(X){return I.createInteractiveEditSession(this._attributeEditingContext,X)}async _decompressBinaryPointData(X,aa){X={geometryBuffer:X.geometryBuffer};null==this._worker&&
(this._worker=new E.I3SPointsWorkerHandle(pa=>this.view.resourceController.immediate.schedule(pa)));aa=await this._worker.invoke(X,aa);if(null==aa)throw Error("Failed to decompress Draco point data");return{positionData:aa.positions,featureIds:aa.featureIds}}async addNode(X,aa,pa){if(!(Z(aa)||"pointData"in aa))throw Error();if(this.loadedGraphics.hasNode(X.index))p.getLogger(this).error("I3S node "+X.id+" already added");else{if(null!=this.layer.fullExtent){var la=this.layer.fullExtent.clone();la.xmin-=
.5;la.ymin-=.5;la.xmax+=.5;la.ymax+=.5;null!=la.zmin&&null!=la.zmax&&(la.zmin-=.5,la.zmax+=.5);null!=la.mmin&&null!=la.mmax&&(la.mmin-=.5,la.mmax+=.5)}else la=null;var na=la,{featureIds:qa,pointPositions:sa}=Z(aa)?await this._extractBinaryPointPositions(X,aa,pa):this._extractLegacyPointPositions(aa);la=[];this._validatePositions(X,qa,sa,na,la);var xa=this._controller.crsVertex;x.projectBuffer(sa,xa,0,sa,this.view.spatialReference,0,qa.length);na=Z(aa)?X.level:0;na=this._createGraphics(qa,sa,X.index,
na);na=new Y(na,qa,aa.attributeDataInfo,X);await this._i3sOverrides.applyAttributeOverrides(na.featureIds,aa.attributeDataInfo,pa);X.numFeatures=na.graphics.length;this._updateNodeMemory(X);ia(na);0<la.length&&(this._computeObb(X,la,xa),this._controller.updateVisibility(X.index));if(this._controller.isGeometryVisible(X)){if(null!=this._verticalScale)for(var ta of na.graphics)this._verticalScale(ta.geometry);if(aa=this.view._stage.renderView.olidRenderHelper)for(pa=H.isBasemapLayer(this.view.map,this.layer.uid),
ta=0;ta<na.featureIds.length;ta++)aa.setUidToObjectAndLayerId(na.featureIds[ta],na.graphics[ta].uid,this.layer.id,this.layer.uid,this.layer.popupEnabled&&!pa&&ha.hasPopupTemplate(this.layer,this.view.popup?.defaultPopupTemplateEnabled),na.node.resources.attributes,ta);this.loadedGraphics.addNode(X.index,na);this._controller.updateLoadStatus(X.index,!0);this._filterNode(na);this._treeDebugger&&this._treeDebugger.update()}else this._cacheNodeData(na)}}_computeObb(X,aa,pa){const la=this._controller.crsIndex,
na=la.isGeographic?this.view.renderSpatialReference:la;x.projectBuffer(aa,pa,0,aa,na,0);X.serviceObbInIndexSR=V.compute(new U.Vertices(aa,3));la.isGeographic&&(u.projectVectorToVector(X.serviceObbInIndexSR.center,na,ka,la),X.serviceObbInIndexSR.center=ka)}isNodeLoaded(X){return this.loadedGraphics.hasNode(X)}isNodeReloading(){return!1}updateNodeState(){}async _extractBinaryPointPositions(X,aa,pa){aa=await this._decompressBinaryPointData(aa,pa);pa=aa.positionData;const la=pa.length/3,na=m.newDoubleArray(3*
la);X=null!=X.serviceObbInIndexSR?X.serviceObbInIndexSR.center:w.ZEROS;const qa=Math.abs(X[2])*2**-20;for(let sa=0;sa<la;sa++){const xa=3*sa;na[xa]=pa[xa]+X[0];na[xa+1]=pa[xa+1]+X[1];na[xa+2]=pa[xa+2]+X[2];Math.abs(na[xa+2])<qa&&(na[xa+2]=0)}return{featureIds:aa.featureIds?m.doubleArrayFrom(aa.featureIds):[],pointPositions:na}}_extractLegacyPointPositions(X){const aa=X.pointData.length,pa=m.newDoubleArray(3*aa),la=[];for(let sa=0;sa<aa;sa++){var na=X.pointData[sa];const xa=na.featureDataPosition,
ta=xa.length;var qa=na.geometries?.[0]??ea[ta];na=na.featureIds[0];if("Embedded"!==qa.type||"points"!==qa.params.type||2>ta||3<ta)continue;qa=qa.params.vertexAttributes?.position??[0,0,0];const Ba=3*la.length;pa[Ba]=xa[0]+qa[0];pa[Ba+1]=xa[1]+qa[1];pa[Ba+2]=3===ta?xa[2]+qa[2]:NaN;la.push(na)}return{featureIds:la,pointPositions:pa}}_validatePositions(X,aa,pa,la,na){if(null!=la||!X.serviceObbInIndexSR){aa=aa.length;for(let sa=0;sa<aa;sa++){var qa=3*sa;l.set(ka,pa[qa],pa[qa+1],pa[qa+2]);qa=!Number.isNaN(pa[2]);
null==la||(qa?t.extentContainsCoords3D(la,ka):t.extentContainsCoords2D(la,ka))||(this._coordinatesOutsideExtentErrors<this._maxCoordinatesOutsideExtentErrors&&p.getLogger(this).error("Service Error: Coordinates outside of layer extent"),this._coordinatesOutsideExtentErrors+1===this._maxCoordinatesOutsideExtentErrors&&p.getLogger(this).error("Maximum number of errors reached. Further errors are ignored."),this._coordinatesOutsideExtentErrors++);X.serviceObbInIndexSR||na.push(ka[0],ka[1],ka[2])}}}_createGraphics(X,
aa,pa,la){const na=X.length,qa=this._getObjectIdField(),sa=this.processor.graphicsCore,xa=[],ta=this.view.spatialReference;for(let Ha=0;Ha<na;Ha++){var Ba=X[Ha];const Ga={};null!=Ba&&(Ga[qa]=Ba);Ba=null==Ba?d.generateUID():Ba;var Ia=3*Ha,Ca=isNaN(aa[Ia+2])?void 0:aa[Ia+2];Ia=y.makeDehydratedPoint(aa[Ia],aa[Ia+1],Ca,ta);Ca=this.loadedGraphics.get(Ba);if(null!=Ca){if(null==Ca.level||Ca.level<la)ja.property="geometry",ja.graphic=Ca,ja.oldValue=Ca.geometry,ja.newValue=Ia,Ca.geometry=Ia,Ca.level=la,sa.graphicUpdateHandler(ja);
xa.push(Ca)}else Ca=d.generateUID(),xa.push({objectId:Ba,uid:Ca,geometry:Ia,attributes:Ga,visible:!0,nodeIndex:pa,level:la})}return xa}_updateNodeMemory(X){X.memory=4096+(null!=X.numFeatures?X.numFeatures*this.processor.graphicsCore.usedMemoryPerGraphic:0)}_cacheNodeData(X){const aa=X.graphics.reduce((pa,la)=>v.estimateSize(la)+pa,g.estimateSize(X.featureIds)+1024);this._memCache.put(this._getMemCacheKey(X.node),X,aa)}_getMemCacheKey(X){return`${X.index}`}_removeAllNodeData(){this.loadedGraphics.forEachNode((X,
aa)=>{X&&(this._updateNodeMemory(X.node),this._cacheNodeData(X));this._controller.updateLoadStatus(aa,!1)});this._treeDebugger&&this._treeDebugger.update();this.loadedGraphics.clear()}removeNode(X){if(X=this._removeNodeStageData(X))this._updateNodeMemory(X.node),this._cacheNodeData(X)}_removeNodeStageData(X){const aa=this.loadedGraphics.getNode(X);if(null==aa)return null;this._controller.updateLoadStatus(X,!1);this.loadedGraphics.removeNode(X);this._treeDebugger&&this._treeDebugger.update();return aa}async loadCachedNodeData(X){return this._memCache?.pop(this._getMemCacheKey(X))}async addCachedNodeData(X,
aa,pa,la){this.loadedGraphics.hasNode(X.index)?p.getLogger(this).error("I3S node "+X.id+" already added"):(await this._i3sOverrides.applyAttributeOverrides(aa.featureIds,pa,la),aa.attributeInfo=pa,this.loadedGraphics.addNode(X.index,aa),this._controller.updateLoadStatus(X.index,!0),this._updateNodeMemory(X),ia(aa),this._filterNode(aa),this._treeDebugger&&this._treeDebugger.update())}getLoadedNodeIds(){const X=[];this.loadedGraphics.forEachNode(aa=>X.push(aa.node.id));return X.sort()}getVisibleNodes(){const X=
[];this.loadedGraphics.forEachNode(aa=>X.push(aa.node));return X}getLoadedNodeIndices(X){this.loadedGraphics.forEachNode((aa,pa)=>X.push(pa))}getLoadedAttributes(X){X=this.loadedGraphics.getNode(X);if(null!=X?.attributeInfo)return X.attributeInfo.loadedAttributes}getAttributeData(X){X=this.loadedGraphics.getNode(X);if(null!=X?.attributeInfo)return X.attributeInfo.attributeData}_setAttributeData(X,aa){X=this.loadedGraphics.getNode(X);null!=X?.attributeInfo&&(X.attributeInfo.attributeData=aa,this._attributeValuesChanged(X))}async updateAttributes(X,
aa,pa){X=this.loadedGraphics.getNode(X);null!=X&&(await this._i3sOverrides.applyAttributeOverrides(X.featureIds,aa,pa),X.attributeInfo=aa,this._attributeValuesChanged(X))}_attributeValuesChanged(X){ia(X);this._filterNode(X);const {processor:aa}=this,{graphicsCore:pa}=aa;if(pa.labelsEnabled){const la=X.node.index,na=[];X.graphics.forEach(qa=>qa.nodeIndex===la&&na.push(qa.uid));pa.updateLabelingInfo(na)}aa.refreshFilter()}_updateClippingExtent(X){this._controller&&this._controller.updateClippingArea(X);
return!1}_getObjectIdField(){return this.layer.objectIdField||r.fallbackObjectIDAttribute}_getGlobalIdField(){return this.layer.associatedLayer?.globalIdField}async _rendererChange(X,aa){const {layer:{fieldsIndex:pa}}=this,la=new Set;let na;X?(await X.collectRequiredFields(la,pa),na=Array.from(la).sort()):na=[];la.clear();let qa;aa?(await aa.collectRequiredFields(la,pa),qa=Array.from(la).sort()):qa=[];na.length===qa.length&&na.every((sa,xa)=>na[xa]===qa[xa])||this._reloadAllNodes()}_rangeInfosChanged(X){null!=
X&&0<X.length&&p.getLogger(this).warn("Unsupported property: rangeInfos are currently only serialized to and from web scenes but do not affect rendering.")}_filterChange(){this.loadedGraphics.forEachNode(X=>this._filterNode(X))}_reloadAllNodes(){this._removeAllNodeData();this._controller&&this._controller.restartNodeLoading()}_filterNode(X){const aa=this.parsedDefinitionExpression,pa=this._excludeObjectIdsSorted,la=this._getObjectIdField();for(const na of X.graphics){X=na.visible;const qa=!aa||this._evaluateClause(aa,
na),sa=null==pa||0>n.binaryIndexOf(pa,na.attributes[la]);na.visible=qa&&sa;X!==na.visible&&(ja.graphic=na,ja.property="visible",ja.oldValue=X,ja.newValue=na.visible,this.processor.graphicsCore.graphicUpdateHandler(ja))}}createQuery(){const X={outFields:["*"],returnGeometry:!0,outSpatialReference:this.view.spatialReference};return null!=this.filter?this.filter.createQuery(X):new C(X)}queryFeatures(X,aa){return this._queryEngine.executeQuery(this._ensureQuery(X),aa?.signal)}queryObjectIds(X,aa){return this._queryEngine.executeQueryForIds(this._ensureQuery(X),
aa?.signal)}queryFeatureCount(X,aa){return this._queryEngine.executeQueryForCount(this._ensureQuery(X),aa?.signal)}queryExtent(X,aa){return this._queryEngine.executeQueryForExtent(this._ensureQuery(X),aa?.signal)}_ensureQuery(X){return this._addDefinitionExpressionToQuery(null==X?this.createQuery():C.from(X))}_setupQueryEngine(){const X=()=>this.processor.featureStore;this._queryEngine=new D.QueryEngine({context:{spatialReference:this.view.spatialReference,layer:this.layer,scheduler:this.view.resourceController.scheduler,
get featureStore(){return X()},hasZ:this.hasZ,hasM:this.hasM},priority:S.TaskPriority.FEATURE_QUERY_ENGINE})}get usedMemory(){return this.processor?.graphicsCore?.usedMemory??0}get unloadedMemory(){return.8*((this._controller?.unloadedMemoryEstimate??0)+(this.processor?.graphicsCore?.unprocessedMemoryEstimate??0))}get ignoresMemoryFactor(){return this._controller&&this._controller.fixedFeatureTarget}async _handleEdits(X){const aa=this._attributeEditingContext;X=await I.normalizeEditResultsEvent(aa,
X);I.processAttributeEdits(aa,X)}get _attributeEditingContext(){const X=this._getObjectIdField(),aa=this._getGlobalIdField();return{sessions:this._interactiveEditingSessions,fieldsIndex:this.layer.fieldsIndex,objectIdField:X,globalIdField:aa,forEachNode:pa=>this.loadedGraphics.forEachNode(la=>pa(la.node,la.featureIds)),attributeStorageInfo:this.i3slayer.attributeStorageInfo??[],i3sOverrides:this._i3sOverrides,getAttributeData:pa=>this.getAttributeData(pa),setAttributeData:(pa,la,na)=>{this._setAttributeData(pa,
la);pa=this.loadedGraphics.getNode(pa);null!=na?(na=this.loadedGraphics.get(na.attributes[X]),null!=na&&this.processor.graphicsCore.recreateGraphics([na])):null!=pa&&this.processor.graphicsCore.recreateGraphics(pa.graphics)},clearMemCache:()=>{}}}get performanceInfo(){return new K.LayerViewPerformanceInfo(this.usedMemory,this.loadedGraphics.length,-1,this.maximumNumberOfFeatures,this.loadedGraphics.nodeCount,this.processor.graphicsCore.performanceInfo)}get test(){}};b.__decorate([f.property()],F.prototype,
"processor",void 0);b.__decorate([f.property({type:A})],F.prototype,"filter",void 0);b.__decorate([f.property()],F.prototype,"loadedGraphics",void 0);b.__decorate([f.property()],F.prototype,"i3slayer",null);b.__decorate([f.property()],F.prototype,"_controller",void 0);b.__decorate([f.property()],F.prototype,"updating",void 0);b.__decorate([f.property()],F.prototype,"suspended",void 0);b.__decorate([f.property()],F.prototype,"holeFilling",void 0);b.__decorate([f.property(ba.updatingProgress)],F.prototype,
"updatingProgress",void 0);b.__decorate([f.property()],F.prototype,"updatingProgressValue",null);b.__decorate([f.property(k.requiredFields)],F.prototype,"requiredFields",null);b.__decorate([f.property(k.availableFields)],F.prototype,"availableFields",void 0);b.__decorate([f.property()],F.prototype,"_fieldsHelper",void 0);b.__decorate([f.property({type:Number})],F.prototype,"maximumNumberOfFeatures",null);b.__decorate([f.property({readOnly:!0})],F.prototype,"maximumNumberOfFeaturesExceeded",null);
b.__decorate([f.property()],F.prototype,"_excludeObjectIdsSorted",null);b.__decorate([f.property({readOnly:!0})],F.prototype,"lodFactor",null);b.__decorate([f.property({readOnly:!0})],F.prototype,"hasM",null);b.__decorate([f.property({readOnly:!0})],F.prototype,"hasZ",null);b.__decorate([f.property()],F.prototype,"contentVisible",null);b.__decorate([f.property({readOnly:!0})],F.prototype,"legendEnabled",null);b=F=b.__decorate([c.subclass("esri.views.3d.layers.SceneLayerGraphicsView3D")],F);const ea=
{2:{type:"Embedded",params:{type:"points",vertexAttributes:{position:[0,0]}}},3:{type:"Embedded",params:{type:"points",vertexAttributes:{position:[0,0,0]}}}},ka=w.create(),ja={graphic:null,property:null,oldValue:null,newValue:null};return b})},"esri/views/3d/layers/I3SPointsWorkerHandle":function(){define(["exports","../../../core/workers/WorkerHandle"],function(a,b){class n extends b.WorkerHandle{constructor(k){super("SceneLayerWorker","dracoDecompressPointCloudData",{dracoDecompressPointCloudData:p=>
[p.geometryBuffer]},k,{hasInitialize:!0})}}a.I3SPointsWorkerHandle=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/I3SGraphicsMap":function(){define(["exports","../../../../core/Evented","../../../../core/has","../../../../core/MapUtils"],function(a,b,n,k){class p extends b{constructor(h,e){super();this._updateAndCompare=h;this._notifyUpdated=e;this._nodes=new Map;this._graphics=new Map;this._duplicates=new Map}clear(){if(0<this._graphics.size){const h=
this.toArray();this._graphics.clear();this.emit("change",{added:[],removed:h})}this._nodes.clear()}get length(){return this._graphics.size}get(h){return this._graphics.get(h)}getNode(h){return this._nodes.get(h)}hasNode(h){return this._nodes.has(h)}nodes(){return this._nodes.values()}addNode(h,e){this._nodes.set(h,e);const g=e.graphics;if(0!==g.length){var d=new Set;for(let c=0;c<g.length;c++){var f=g[c];const l=f.objectId,w=this._graphics.get(l);w?(d.add(l),f!==w&&(g[c]=w),(f=this._duplicates.get(l))?
f.push(h):this._duplicates.set(l,[w.nodeIndex,h])):(f.nodeIndex=h,this._graphics.set(l,f))}d.size&&this._updateForeignGraphics(e);h=0<d.size?g.filter(c=>!d.has(c.objectId)):g;0<h.length&&this.emit("change",{added:h,removed:[]})}}removeNode(h){var e=this._nodes.get(h);if(e){this._nodes.delete(h);var g=new Set,d=[];for(const l of e.graphics){e=l.objectId;var f=this._graphics.get(e);if(!f)continue;const w=this._duplicates.get(e);if(w){var c=w.indexOf(h);if(-1!==c){w.splice(c,1);if(f.nodeIndex===h){f=
this.getNode(w[0]);for(c=1;c<w.length;c++){const x=this.getNode(w[c]);if(null==f||null!=x&&x.node.level>f.node.level)f=x}null!=f&&g.add(f)}1===w.length&&this._duplicates.delete(e)}}else this._graphics.delete(e),d.push(l)}0<d.length&&this.emit("change",{added:[],removed:d});g.forEach(l=>this._updateForeignGraphics(l))}}_updateForeignGraphics(h){const e=[],g=h.node.index,d=h.node.level;let f=0;for(;f<h.graphics.length;){var c=h.graphics[f].nodeIndex;if(c===g){f++;continue}let l=1;for(;f+l<h.graphics.length&&
h.graphics[f+l].nodeIndex===c;)l++;c=this.getNode(c);if(!(null!=c&&c.node.level>d))for(c=f;c<f+l;c++){const w=h.graphics[c];w.nodeIndex=g;this._updateAndCompare(w,h,c)&&e.push(w)}f+=l}0<e.length&&this._notifyUpdated(e)}toArray(){return Array.from(this._graphics.values())}find(h){return k.findInMap(this._graphics,h)}some(h){return k.someMap(this._graphics,h)}forEach(h){this._graphics.forEach(e=>h(e))}forEachNode(h){this._nodes.forEach((e,g)=>h(e,g))}get nodeCount(){return this._nodes.size}_checkInvariants(){const h=
new Map;this._nodes.forEach((e,g)=>{e.graphics.forEach(d=>{h.set(d.objectId,1+(h.get(d.objectId)??0));this._duplicates.get(d.objectId)})});h.forEach((e,g)=>{(e=this._graphics.get(g))&&this._nodes.get(e.nodeIndex)&&(g=this._duplicates.get(g))&&g.forEach(d=>{this._nodes.get(d)})})}}a.I3SGraphicsMap=p;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"*noref":1}});
define("require ../chunks/tslib.es6 ../Camera ../geometry ../Viewpoint ../core/Collection ../core/domUtils ../core/Error ../core/events ../core/handleUtils ../core/has ../core/Logger ../core/maybe ../core/ObservableChangesType ../core/promiseUtils ../core/reactiveUtils ../core/scheduling ../core/screenUtils ../core/unitUtils ../core/workers/workers ../core/accessorSupport/decorators/property ../core/accessorSupport/decorators/cast ../core/RandomLCG ../core/accessorSupport/decorators/subclass ../core/accessorSupport/ensureType ../core/accessorSupport/overrideDefaultsFrom ../core/libs/gl-matrix-2/factories/vec3f64 ../core/support/OwningCollection ../geometry/HeightModelInfo ../geometry/projection ../geometry/projection/projectBoundingRect ../geometry/projection/projectPointToVector ../geometry/support/aaBoundingRect ../chunks/boundedPlane ../geometry/support/coordinateSystem ../geometry/support/scaleUtils ../layers/support/layerUtils ../support/AnalysesCollection ./BreakpointsOwner ./DOMContainer ./GroundView ./PopupView ./View ./ViewAnimation ./ViewingMode ./3d/layerViewModuleImportUtils ./3d/analysis/AnalysisViewManager3D ./3d/constraints/Constraints ./3d/environment/EnvironmentManager ./3d/environment/SceneViewEnvironment ./3d/input/SceneInputManager ./3d/layers/graphics/GraphicsDeconflictor ./3d/layers/graphics/Labeler ./3d/layers/support/FeatureTileTree3D ./3d/state/ViewState ./3d/state/ViewStateManager ./3d/state/helpers/SceneIntersectionHelper ./3d/support/CombinedElevationProvider ./3d/support/debugFlags ./3d/support/DisplayQualityProfile ./3d/support/ElevationProvider ./3d/support/HighlightGroup ./3d/support/HighlightOptions ./3d/support/hitTest ./3d/support/popupHitTest ./3d/support/QualitySettings ./3d/support/RenderCoordsHelper ./3d/support/ResourceController ./3d/support/SceneViewPerformanceInfo ./3d/support/SharedSymbolResources ./3d/support/TextureCollection ./3d/support/pointsOfInterest/PointsOfInterest ./3d/terrain/TerrainSurface ./3d/terrain/terrainUtils ./3d/webgl-engine/Stage ./3d/webgl-engine/effects/geometry/olidUtils ./3d/webgl-engine/lib/Intersector ./3d/webgl-engine/lib/verticalOffsetUtils ./support/HighlightDefaults ./support/layerViewUtils ./support/PropertiesPool ./support/screenUtils ./support/spatialReferenceSupport ./support/WebGLRequirements ./ui/DefaultUI ./ui/3d/DefaultUI3D ../webscene/Environment ../geometry/Extent ../geometry/SpatialReference ../geometry/Point".split(" "),function(a,
b,n,k,p,h,e,g,d,f,c,l,w,x,u,t,m,q,r,v,y,B,z,A,C,H,E,F,G,D,I,J,N,M,Q,O,K,L,P,R,W,V,ba,U,da,fa,ha,T,S,Z,ia,Y,ea,ka,ja,X,aa,pa,la,na,qa,sa,xa,ta,Ba,Ia,Ca,Ha,Ga,Aa,Ja,Sa,$a,Wa,Ta,Da,La,Va,ma,za,Na,Ra,Pa,ca,cb,ib,nb,xb,ya,Ea){function Qa(Oa,Xa){return null!=Oa&&D.canProjectWithoutEngine(Oa.spatialReference,Xa)?D.project(Oa,Xa):null}k=class extends P.BreakpointsOwner(V.PopupView(R.DOMContainer(ba))){constructor(Oa){super(Oa);this._initialDefaultSpatialReference=this._clippingArea=this._userClippingArea=
null;this._overrideDefaultEnvironmentOnly=!0;this._createGraphicsViewController=null;this._resolveWhenReady=[];this._propertiesPool=new Na.PropertiesPool({slicePlane:M.BoundedPlaneClass},this);this._resourceController=Ha.newResourceController(this);this._defaultToMapOptions={include:new Set};this._defaultHitTestOptions={exclude:new Set};this.deconflictor=new Y.GraphicsDeconflictor({view:this});this.labeler=new ea.Labeler({view:this,deconflictor:this.deconflictor.labels});this.sharedSymbolResources=
null;this.analyses=new L.AnalysesCollection;this.canvas=this.elevationProvider=this.basemapTerrain=null;this.constraints=new T.Constraints;this.environment=new Z;this.environmentManager=new S.EnvironmentManager;this.floors=new h;this.fullOpacity=1;this.graphicsView=null;this.analysisViewManager=new ha({view:this});this.map=this.groundView=null;this.screenSizePerspectiveEnabled=!0;this.state=new ja({view:this});this.spatialReference=null;this.preserveDrawingBufferEnabled=this.alphaCompositingEnabled=
!1;this.supersampleScreenshotsEnabled=!0;this.type="3d";this.ui=new ib;this._lastUpdateTime=this._numUpdating=0;this.updatingProgress=.5;this.highlights=sa.makeDefaultHighlightGroups();v.initialize();const Xa=(Za=null)=>{if(null==Za||Za.type!==x.ObservableChangesType.MOVE)this._updatingChanged(),this.map&&this.map.allLayers.forEach(async hb=>{try{await hb.when()}catch{}this._updatingChanged()})};this.addHandles([t.on(()=>this.map?.allLayers,"after-changes",Za=>Xa(Za),{onListenerAdd:()=>Xa(),onListenerRemove:()=>
Xa(),sync:!0}),this.allLayerViews.on("after-changes",Za=>this._updateUpdatingMonitors(Za)),t.watch(()=>this.map,Za=>{Za&&"load"in Za&&Za.load&&Za.load().catch(()=>{})})]);this.inputManager=new ia({view:this});this.stateManager=new X.ViewStateManager({view:this})}initialize(){this.groundView=new W({view:this});this._updateUpdatingMonitors();const Oa=()=>this._updateDefaultToMapOptions();this.addHandles(t.on(()=>this.map?.allLayers,"after-changes",Oa,{onListenerAdd:Oa,onListenerRemove:Oa}));this.updatingHandles.add(()=>
this.qualitySettings.memoryLimit,Xa=>{this.resourceController&&(this.resourceController.memoryController.maxMemory=Xa)},t.initial);this.updatingHandles.add(()=>this.qualitySettings.additionalCacheMemory,Xa=>{this.resourceController&&(this.resourceController.memoryController.additionalCacheMemory=Xa)},t.initial);this.updatingHandles.add(()=>this.qualitySettings.frameRate??0,Xa=>m.setFrameDuration(0<Xa?1E3/Math.ceil(Xa):0),t.initial);this.updatingHandles.add(()=>this.map?.ground,Oa,t.syncAndInitial);
this.updatingHandles.add(()=>this.map?.ground?.opacity,()=>this._updateDefaultHitTestOptions(),t.syncAndInitial);this.addHandles(t.watch(()=>this.spatialReference,()=>this.notifyChange("clippingArea"),t.sync))}destroy(){this.destroyed||(this.updatingHandles.removeAll(),this.invalidate(),this.activeTool=null,this.layerViewManager.clear(),this._exitSurface(),this._disposeGraphicsView(),this.sharedSymbolResources=w.destroyMaybe(this.sharedSymbolResources),this._set("labeler",w.destroyMaybe(this.labeler)),
this._set("deconflictor",w.destroyMaybe(this.deconflictor)),this._resourceController=w.destroyMaybe(this._resourceController),this._set("stateManager",w.destroyMaybe(this.stateManager)),this._set("inputManager",w.destroyMaybe(this.inputManager)),this.state.destroy(),this._propertiesPool.destroy(),this.removeHandles("updatingMonitors"),this._set("environmentManager",w.destroyMaybe(this.environmentManager)),this._set("environment",w.destroyMaybe(this.environment)),this.groundView=w.destroyMaybe(this.groundView),
this._exitBasemapTerrain(),this._stage?.destroy(),this.highlights.destroy())}get renderSpatialReference(){return this.renderCoordsHelper&&this.renderCoordsHelper.spatialReference}get basemapSpatialReference(){return this.basemapTerrain?.spatialReference}get animation(){return this.state.animation}get camera(){return this.stateManager?.camera}set camera(Oa){this.stateManager&&(this.stateManager.camera=Oa)}get contentCamera(){return this.stateManager?.contentCamera}set contentCamera(Oa){this.stateManager&&
(this.stateManager.contentCamera=Oa)}installContentCameraReset(Oa={sticky:!1}){return this.stateManager.installContentCameraReset(Oa)}get center(){return this.stateManager?.center}set center(Oa){this.stateManager&&(this.stateManager.center=Oa)}get clippingArea(){if("global"===this.viewingMode)return null;const Oa=this.map;let Xa=this._userClippingArea||w.maybeProperty(Oa,"clippingArea");if(!this._userClippingArea&&!w.maybeProperty(Oa,"clippingEnabled")||null==Xa)return this._clippingArea=null;if(!(Xa instanceof
xb))return l.getLogger(this).error("#clippingArea","only clippingArea geometries of type Extent are supported"),this._clippingArea;if(this.spatialReference&&(Xa=Qa(Xa,this.spatialReference),null==Xa))return l.getLogger(this).error("#clippingArea","setting clippingArea with incompatible SpatialReference"),this._clippingArea;Xa=Xa.clone();null==Xa.intersection(this._groundAndLayersExtent)&&(Xa.xmin=Xa.xmax,Xa.ymin=Xa.ymax);Xa.zmin=void 0;Xa.zmax=void 0;Xa.equals(this._clippingArea)||(this._clippingArea=
Xa);return this._clippingArea}set clippingArea(Oa){this.ready&&"global"===this.viewingMode&&null!=Oa?l.getLogger(this).error("#clippingArea\x3d","Clipping area is only supported in local viewingMode"):this._userClippingArea=Oa}get renderDataExtent(){if(this.state.viewingMode===da.ViewingMode.Global)return null;const Oa=this.renderSpatialReference,Xa=this.dataExtent;return null==Xa||null==Oa||Xa.spatialReference.equals(Oa)?Xa:Qa(Xa,Oa)}get tileInfo(){return this.basemapTerrain?.tilingScheme?.toTileInfo()}get dataExtent(){let Oa=
this._groundAndLayersExtent;var Xa=Qa(this.clippingArea,this.spatialReference||ya.WGS84);null!=Xa&&(Oa=null!=Oa?Oa.intersection(Xa):Xa);Xa=this._get("dataExtent");return null!=Oa&&Oa.equals(Xa)?Xa:Oa}get _groundAndLayersExtent(){const Oa=this.spatialReference||ya.WGS84;let Xa;const Za=jb=>{jb=Qa(jb,Oa);null!=jb&&(null!=Xa?Xa.union(jb):Xa=jb.clone())};var hb=this.basemapTerrain;if(hb?.spatialReference){const jb=hb.groundExtent;Za(new xb({xmin:jb[0],ymin:jb[1],zmin:0,xmax:jb[2],ymax:jb[3],zmax:0,spatialReference:hb.spatialReference}))}this.map&&
this.map.allLayers.forEach(jb=>{null==jb.fullExtent||"graphics"===jb.type&&jb.internal||Za(jb.fullExtent)});if(null==Xa)return null;Xa.hasZ?(Xa.zmin=Math.min(0,Xa.zmin??0),Xa.zmax=Math.max(0,Xa.zmax??0)):(Xa.zmin=0,Xa.zmax=0);hb=this._get("_groundAndLayersExtent");return Xa.equals(hb)?hb:Xa}castEnvironment(Oa){return Oa?Oa instanceof Z?Oa:Oa instanceof nb?this.environment?.cloneWithWebsceneEnvironment(Oa)??Z.fromWebsceneEnvironment(Oa):C.ensureType(Z,Oa):new Z}get extent(){return this.stateManager?.extent}set extent(Oa){this.stateManager&&
(this.stateManager.extent=Oa)}get screenCenter(){return this.stateManager?.screenCenter}get frustum(){return this.stateManager?.frustum}get initialExtentRequired(){return this.stateManager&&!this.stateManager.hasInitialView}get defaultsFromMapSettings(){return{required:{tileInfo:!1,heightModelInfo:!0,extent:!1}}}get interacting(){return this.navigating||(this.toolViewManager?.interacting??!1)}get stationary(){return!this.animation&&!this.resizing&&(this.state?.stationary??!0)}get navigating(){return this.state?.navigating??
!1}get padding(){return this.stateManager?.padding}set padding(Oa){this.stateManager&&(this.stateManager.padding=Oa)}set qualityProfile(Oa){na.isValidProfile(Oa)&&(na.apply(Oa,this.qualitySettings),this._set("qualityProfile",Oa))}get qualityProfile(){return this._get("qualityProfile")||na.getDefaultProfile()}set slicePlane(Oa){null!=this._stage&&(this._stage.renderer.slicePlane=Oa);if(null==Oa)this._set("slicePlane",null);else{var Xa=this._propertiesPool.get("slicePlane");M.copy(Oa,Xa);this._set("slicePlane",
Xa)}}get typeSpecificPreconditionsReady(){return this.viewingMode?!!this.stateManager?.preinit(this.spatialReference):!1}get resolution(){return null!=this.spatialReference?O.getResolutionForScale(this.scale,this.spatialReference):0}get scale(){return this.stateManager?.scale}set scale(Oa){this.stateManager&&(this.stateManager.scale=Oa)}get heightModelInfo(){const Oa=this.getDefaultHeightModelInfo();return null!=Oa?G.deriveUnitFromSR(Oa,this.spatialReference):null}get updating(){if(this.destroyed)return!1;
let Oa=0,Xa=this.layerViewManager.updating,Za=Xa?this.layerViewManager.updatingRemaining:0;this.allLayerViews.forEach(ob=>{ob.isFulfilled()?ob.updating&&(Xa=!0,ob.suspended||Wa.isSurfaceLayerView(ob)||(++Za,Oa+=ob.updatingProgress)):++Za});for(var hb of this._updatingObjects)null!=hb&&hb.updating&&(Za+=.1,Oa+=.05);for(var jb of this._updatingObjectsWithProgress)null!=jb&&jb.updating&&(++Za,Oa+=jb.updatingProgress);hb=!this.stateManager.test.updatingIgnoreRenderState&&this.state.updating;(Xa=!!(Xa||
0<Za||this.updatingHandles.updating||!this.ready||!this.stationary||hb||this._createGraphicsViewController||this.inputManager?.updating||this.map?.allLayers?.some(ob=>!ob.isFulfilled())||this.textures?.updating))?(this._numUpdating=Math.max(Za,this._numUpdating),Oa+=this._numUpdating-Za):this._numUpdating=0;Oa=0<this._numUpdating?Oa/this._numUpdating:Xa?0:1;this._get("updatingProgress")!==Oa&&(hb=performance.now(),1>Oa&&(jb=Math.min((hb-this._lastUpdateTime)/2E3,1),Oa=this.updatingProgress*(1-jb)+
Oa*jb),this._set("updatingProgress",Oa),this._lastUpdateTime=Xa&&1>Oa?hb:0);return Xa}get _updatingObjects(){return[this.graphicsView,this.basemapView,this._resourceController,this._stage,this.featureTiles,this.pointsOfInterest,this.environmentManager,this.overlay,this._featureTreeDebugger,this.toolViewManager,this.analysisViewManager]}get _updatingObjectsWithProgress(){return[this.deconflictor,this.labeler,this.basemapTerrain]}get viewingMode(){var Oa=this._predeterminedViewingMode;return null!=
Oa?da.stringFromViewingMode(Oa):(Oa=this.spatialReference)?null!=this.defaultsFromMap?.viewingMode&&Oa.equals(this.defaultsFromMap.spatialReference)?da.stringFromViewingMode(this.defaultsFromMap.viewingMode):Pa.isSpatialReferenceSupported(Oa,da.ViewingMode.Global)?"global":"local":"global"}set viewingMode(Oa){this.ready?l.getLogger(this).error("#viewingMode","viewingMode cannot be set once view is ready"):this._overrideIfSome("viewingMode",Oa)}get viewpoint(){return this.stateManager?.viewpoint}set viewpoint(Oa){this.stateManager&&
(this.stateManager.viewpoint=Oa)}get visibleArea(){return this.stateManager?.visibleArea}get zoom(){return this.stateManager.zoom}set zoom(Oa){this.stateManager&&(this.stateManager.zoom=Oa)}get highlightOptions(){for(const Oa of this.highlights)if(Oa.name===ma.defaultHighlightName)return Oa.options;return new xa}set highlightOptions(Oa){for(const Xa of this.highlights)if(Xa.name===ma.defaultHighlightName){Xa.options=Oa;break}}get resourceController(){return this._resourceController}get quality(){return this._resourceController?.memoryController?.memoryFactor??
1}get resolutionScale(){return Math.sqrt(Math.min(1,this.quality/.75))}get performanceInfo(){return new Ga(this)}on(Oa,Xa,Za,hb){return(Za=this.viewEvents.on(Oa,Xa,Za,hb))?Za:super.on(Oa,Xa)}hasEventListener(Oa){return super.hasEventListener(Oa)||this.viewEvents.hasHandler(Oa)}toMap(Oa,Xa){if(!this.ready)return l.getLogger(this).error("#toMap()","Scene view cannot be used before it is ready"),null;Oa=Ra.isSupportedScreenPointEvent(Oa)?Ra.createScreenPointFromSupportedEvent(this,Oa):Oa;return ta.toMap(this,
Oa,Xa,this._defaultToMapOptions)}toScreen(Oa){if(!this.ready)return l.getLogger(this).error("#toScreen()","Scene view cannot be used before it is ready"),null;const Xa=(null==Oa.z?qa.getElevationAtPoint(this.elevationProvider,Oa):null)??0;J.projectPointToVector(Oa,db,this.renderSpatialReference,Xa);this.state.camera.projectToScreen(db,lb);return q.createScreenPoint(lb[0],lb[1])}pixelSizeAt(Oa,Xa){if(!this.ready)return l.getLogger(this).error("#pixelSizeAt()","Scene view cannot be used before it is ready"),
null;if(!Oa)return 0;const Za=this.renderSpatialReference;J.projectPointToVector(Oa,db,Za);Oa=this.state.camera.computeScreenPixelSizeAt(db);return Xa&&Za!==Xa?Oa*r.getMetersPerUnitForSR(Za)/r.getMetersPerUnitForSR(Xa):Oa}overlayPixelSizeInMapUnits(Oa){const Xa=this.basemapTerrain.overlayManager;return Xa?Xa.overlayPixelSizeInMapUnits(Oa,()=>this.pixelSizeAt(Oa)):1}hitTest(Oa,Xa){if(!this.ready)return l.getLogger(this).error("#hitTest()","Scene view cannot be used before it is ready"),null;Oa=Ra.isSupportedScreenPointEvent(Oa)?
Ra.createScreenPointFromSupportedEvent(this,Oa):Oa;return ta.hitTest(this,Oa,Xa,this._defaultHitTestOptions)}async popupHitTest(Oa){return Ba.popupHitTest(this,Oa)}goTo(Oa,Xa){return this.updatingHandles.addPromise(this.stateManager.goTo(Oa,Xa))}async whenAnalysisView(Oa){if(null==Oa.parent)throw new g("view:no-analysisview-for-analysis","The analysis has not been added to view.analyses",{analysis:Oa});switch(Oa.parent.type){case "line-of-sight":case "dimension":case "viewshed":return(await this.whenLayerView(Oa.parent)).whenAnalysisView();
default:return this.analysisViewManager.whenAnalysisView(Oa)}}whenLayerView(Oa){return super.whenLayerView(Oa)}async takeScreenshot(Oa){Oa=await this._completeSettings(Oa);await this.whenReady();const Xa=await this._stage.renderView.takeScreenshot(Oa);return(await new Promise((Za,hb)=>a(["./support/screenshotUtils"],Za,hb))).encode(Xa,Oa,this._pixelFormat())}async _takeScreenshot(Oa){Oa=await this._completeSettings(Oa);await this.whenReady();Oa=await this._stage.renderView.takeScreenshot(Oa);return(await new Promise((Xa,
Za)=>a(["./support/screenshotUtils"],Xa,Za))).encodeData(Oa,this._pixelFormat())}async _takeScreenshotWithObjectAndLayerId(Oa){Oa=await this._completeSettings(Oa);await this.whenReady();Oa=await this._stage.renderView.takeScreenshotWithOID(Oa);const {encodeData:Xa}=await new Promise((Za,hb)=>a(["./support/screenshotUtils"],Za,hb));return[Xa(Oa[0],this._pixelFormat()),Xa(Oa[1],this._pixelFormat())]}async _completeSettings(Oa){const {toRenderSettings:Xa,screenshotSuperSampleSettings:Za}=await new Promise((hb,
jb)=>a(["./support/screenshotUtils"],hb,jb));Oa=Xa(Oa,this);Oa.pixelRatio/=this.state.pixelRatio;return Za(Oa,this.supersampleScreenshotsEnabled,this.padding)}_pixelFormat(){return{flipY:!0,premultipliedAlpha:this._stage.renderView.getAlpha()}}get test(){}async takeScreenshotWithObjectAndLayerId(Oa){if(!Da.olidEnabled())throw new g("360vr:objectAndLayerId-rendering-disabled","has enable-feature:objectAndLayerId-rendering must be true");var {encode:Xa}=await new Promise((jb,ob)=>a(["./support/screenshotUtils"],
jb,ob)),Za=await this._completeSettings(Oa);await this.whenReady();const hb=await this._stage.renderView.takeScreenshotWithOID(Za);Za=Xa(hb[0],Za,this._pixelFormat());Oa=await this._completeSettings(Oa);Oa.format="png";Xa=Xa(hb[1],Oa,this._pixelFormat());return[Za,Xa]}getColorToObjectAndLayerIdMapping(){const Oa=this._stage.renderView.olidRenderHelper;if(Oa)return Oa.getColorToObjectAndLayerIdMapping();throw new g("360vr:objectAndLayerId-rendering-disabled","has enable-feature:objectAndLayerId-rendering must be true");
}addUpdatingPromise(Oa){return this.updatingHandles.addPromise(Oa)}importLayerView(Oa){return fa.layerView3DImporter.importLayerView(Oa)}hasLayerViewModule(Oa){return fa.layerView3DImporter.hasLayerViewModule(Oa)}forceDOMReadyCycle(){this.forceReadyCycle()}getDefaultSpatialReference(){return this.map&&"initialViewProperties"in this.map&&this.map.initialViewProperties?.spatialReference||this.defaultsFromMap?.spatialReference||this.defaultsFromMap?.ready&&this._initialDefaultSpatialReference||null}async validate(){let Oa=
ca.check(this.type);const Xa=c("safari");Xa&&9>Xa&&(Oa=new g("sceneview:browser-not-supported","This browser is not supported by SceneView (Safari \x3c 9)",{type:"safari",requiredVersion:9,detectedVersion:Xa}));if(null!=Oa)throw l.getLogger(this).warn("#validate()",Oa.message),Oa;}get _predeterminedViewingMode(){const Oa=this._isOverridden("viewingMode")?this._get("viewingMode"):(this.map&&"initialViewProperties"in this.map?this.map.initialViewProperties?.viewingMode:null)??null;return null!=Oa?da.viewingModeFromString(Oa):
null}getSpatialReferenceSupport(Oa,Xa){var Za=this._predeterminedViewingMode;if(null!=Za)return this._validateSpatialReferenceForViewingMode(Oa,Xa,Za)?{constraints:this._makeSpatialReferenceConstraints(Oa,Xa,Za)}:null;Za=this._validateSpatialReferenceForViewingMode(Oa,Xa,da.ViewingMode.Local);const hb=this._validateSpatialReferenceForViewingMode(Oa,Xa,da.ViewingMode.Global);return Za||hb?Za&&hb?{constraints:this._makeSpatialReferenceConstraints(Oa,Xa,null)}:Za?{constraints:this._makeSpatialReferenceConstraints(Oa,
Xa,da.ViewingMode.Local)}:{constraints:this._makeSpatialReferenceConstraints(Oa,Xa,da.ViewingMode.Global)}:null}_validateSpatialReferenceForViewingMode(Oa,Xa,Za){return Pa.isSpatialReferenceSupported(Oa,Za)?null==Xa||K.isImageryTileLayer(Xa)?!0:K.isTiledLayer(Xa)&&null==Wa.getTiledLayerInfo(Xa,Oa,Za)||K.isVoxelLayer(Xa)&&Za===da.ViewingMode.Global?!1:!0:!1}_makeSpatialReferenceConstraints(Oa,Xa,Za){if(null==Xa)return[{spatialReference:Oa,viewingMode:Za}];const {isWebMercator:hb,isWGS84:jb}=Oa;return K.isImageryTileLayer(Xa)&&
(hb||jb)?(jb&&Za!==da.ViewingMode.Local?null===Wa.checkIfTileInfoSupportedForView(Xa.tileInfo,Xa.fullExtent,Oa,da.ViewingMode.Global):1)?[{spatialReference:Oa,viewingMode:Za},{spatialReference:ya.WebMercator,viewingMode:Za}]:[{spatialReference:hb?ya.WGS84:ya.WebMercator,viewingMode:Za}]:K.isTiledLayer(Xa)||K.isVoxelLayer(Xa)||!hb&&!jb?K.isTiledLayer(Xa)&&hb&&Za!==da.ViewingMode.Global?[{spatialReference:Oa,viewingMode:Za},{spatialReference:ya.WGS84,viewingMode:da.ViewingMode.Local}]:[{spatialReference:Oa,
viewingMode:Za}]:[{spatialReference:Oa,viewingMode:Za},{spatialReference:hb?ya.WGS84:ya.WebMercator,viewingMode:Za}]}_validateSpatialReference(Oa){const Xa=null!=this.getSpatialReferenceSupport(Oa),Za=this._predeterminedViewingMode;Xa||(null!=Za?l.getLogger(this).warnOnce(`Spatial reference defined on view not supported in ${da.stringFromViewingMode(Za)} viewing mode.`):Oa.isGeographic&&l.getLogger(this).warnOnce("Spatial reference is geographic but not supported."));return Xa}whenReady(){return new Promise(Oa=>
{this.ready?Oa(this):this._resolveWhenReady.push(Oa)})}trackGraphicState(Oa){if(!Oa.graphic)return l.getLogger(this).error("trackGraphicState","GraphicState.graphic must not be null or undefined to start tracking"),null;const Xa=this.getViewForGraphic(Oa.graphic);let Za=null,hb=!1;const jb=ob=>{!hb&&null!=ob&&"processor"in ob&&"graphics-3d"===ob.processor?.type&&ob.processor.graphicsCore&&(Za=ob.processor.graphicsCore.trackGraphicState(Oa))};null!=Xa?jb(Xa):this.whenViewForGraphic(Oa.graphic,{waitForLayer:!0}).then(ob=>
jb(ob),()=>{}).catch(()=>{});return f.makeHandle(()=>{hb=!0;null!=Za&&(Za.remove(),Za=null)})}highlight(Oa){if(Array.isArray(Oa))return f.handlesGroup(Oa.map(Za=>this.highlight(Za)));if(h.isCollection(Oa))return f.handlesGroup(Oa.toArray().map(Za=>this.highlight(Za)));const Xa=this.getViewForGraphic(Oa);return Xa&&"highlight"in Xa?Xa.highlight(Oa):f.makeHandle()}maskOccludee(Oa){if(!Oa)return l.getLogger(this).error("maskOccludee","GraphicState.graphic must not be null or undefined to mask an occludee"),
null;const Xa=this.getViewForGraphic(Oa);let Za=null,hb=!1;const jb=ob=>{!hb&&null!=ob&&za.occludeesSupported(ob)&&(Za=ob.maskOccludee(Oa))};null!=Xa?jb(Xa):this.whenViewForGraphic(Oa,{waitForLayer:!0}).then(ob=>jb(ob),()=>{}).catch(()=>{});return f.makeHandle(()=>{hb=!0;null!=Za&&(Za.remove(),Za=null)})}getViewForGraphic(Oa){return Oa.layer===this.graphics?this.graphicsView:Oa.layer?this.allLayerViews.find(Xa=>Xa.layer===Oa.layer):null}graphicChanged(Oa){null!=this.graphicsView&&this.graphicsView.graphicChanged(Oa)}async whenViewForGraphic(Oa,
Xa){if(Oa.layer===this)return await t.whenOnce(()=>this.graphicsView),this.graphicsView;if(!Oa.layer||!this.map)throw new g("no-view-for-graphic");return Xa&&Xa.waitForLayer&&!this.map.allLayers.includes(Oa.layer)?new Promise((Za,hb)=>{const jb=this.map.allLayers.on("change",ob=>{ob.added.includes(Oa.layer)&&(jb.remove(),this.whenLayerView(Oa.layer).then(Za,hb))})}):this.whenLayerView(Oa.layer)}_initBasemapTerrain(){this._set("basemapTerrain",new $a({view:this}));this._set("elevationProvider",new pa.CombinedElevationProvider({view:this}));
this.elevationProvider.register("ground",this.basemapTerrain)}_exitBasemapTerrain(){this.basemapTerrain&&(this.elevationProvider.unregister(this.basemapTerrain),this.elevationProvider.destroy(),this._set("elevationProvider",null),this.basemapTerrain.destroy(),this._set("basemapTerrain",null))}_initGlobe(){this._initCoordinateSystem();this.state.createInitialCamera();this._initBasemapTerrain();this._set("pointsOfInterest",new Sa.PointsOfInterest({view:this}));this._set("featureTiles",new ka.FeatureTileTree3D({renderCoordsHelper:this.renderCoordsHelper,
cameraOnSurface:this.pointsOfInterest.cameraOnSurface,focus:this.pointsOfInterest.focus,tilingSchemeOwner:this.basemapTerrain,viewState:this.state,scheduler:this._resourceController.scheduler,terrain:this.basemapTerrain}));const Oa=()=>{var Xa=this.basemapTerrain?.extent;this.clippingArea||Xa?Xa&&this.basemapTerrain.spatialReference?(Xa=null!=this.basemapTerrain.extent&&null!=this.basemapTerrain.spatialReference?D.project(N.toExtent(this.basemapTerrain.extent,this.basemapTerrain.spatialReference),
this.spatialReference):null,this.featureTiles.filterExtent=null!=this.clippingArea?this.clippingArea.intersection(Xa):Xa):this.featureTiles.filterExtent=this.clippingArea:this.featureTiles.filterExtent=null};this.addHandles([this.updatingHandles.add(()=>la.debugFlags.FEATURE_TILE_TREE_SHOW_TILES,Xa=>{Xa&&this.featureTiles&&!this._featureTreeDebugger?this.updatingHandles.addPromise(new Promise((Za,hb)=>a(["./3d/layers/support/FeatureTileTree3DDebugger"],Za,hb))).then(({FeatureTileTree3DDebugger:Za})=>
{!this._featureTreeDebugger&&la.debugFlags.FEATURE_TILE_TREE_SHOW_TILES&&(this._featureTreeDebugger=new Za({view:this}))}):Xa||!this._featureTreeDebugger||la.debugFlags.FEATURE_TILE_TREE_SHOW_TILES||(this._featureTreeDebugger.destroy(),this._featureTreeDebugger=null)},t.syncAndInitial),this.updatingHandles.add(()=>this.clippingArea,Oa,t.syncAndInitial),this.updatingHandles.add(()=>this.basemapTerrain.extent,Oa,t.syncAndInitial)],"feature-tiles");this.stateManager.init()}_exitGlobe(){this.featureTiles&&
(this.stateManager.exit(),this.removeHandles("render-coords-helper"),this.removeHandles("feature-tiles"),this._set("featureTiles",w.destroyMaybe(this.featureTiles)),this._set("pointsOfInterest",w.destroyMaybe(this.pointsOfInterest)),this._exitBasemapTerrain(),this.state.reset(),this._exitCoordinateSystem())}_initCoordinateSystem(){if(this.spatialReference){const Oa=this.state.isGlobal,Xa=Q.renderSRFromViewSR(Oa,this.spatialReference);Xa!==this.renderSpatialReference&&(this._set("renderCoordsHelper",
Ca.RenderCoordsHelper.create(this.state.viewingMode,Xa)),Oa||this.addHandles(t.watch(()=>this.basemapTerrain?.extent,Za=>{const hb=this.renderCoordsHelper.spatialReference;null==Za||0===Za[0]&&0===Za[1]&&0===Za[2]&&0===Za[3]||!I.projectBoundingRect(Za,this.basemapTerrain.spatialReference,ub,hb)||(this.renderCoordsHelper.extent=ub)},t.sync),"render-coords-helper"),this.sceneIntersectionHelper&&this.sceneIntersectionHelper.setTolerance(La.defaultTolerance/this.renderCoordsHelper.unitInMeters))}else this._set("renderCoordsHelper",
null)}_exitCoordinateSystem(){this.removeHandles("render-coords-helper");this._set("renderCoordsHelper",null)}_updatingChanged(){this.notifyChange("updating")}_updateUpdatingMonitors(Oa=null){if(null==Oa||Oa.type!==x.ObservableChangesType.MOVE)this.removeHandles("updatingMonitors"),this.allLayerViews.forEach(Xa=>{Xa.destroyed||(this.addHandles(t.watch(()=>[Xa.updating,Xa.updatingProgress],()=>this._updatingChanged(),t.sync),"updatingMonitors"),Xa.when(()=>this._updatingChanged(),()=>this._updatingChanged()))}),
this._updatingChanged()}async _prepareScreenshotOverlay(){this.overlay&&await this.overlay.prepare()}_renderScreenshotOverlay(Oa,Xa,Za){if(!this.overlay||!this.overlay.hasVisibleItems)return Za;const hb=Oa.getContext("2d");hb.putImageData(Za,0,0);this.overlay.renderCanvas(Oa,{disableDecorations:Xa});return hb.getImageData(0,0,Za.width,Za.height)}_initStage(){const Oa={deactivatedWebGLExtensions:this.deactivatedWebGLExtensions,debugWebGLExtensions:this.debugWebGLExtensions,alpha:this.alphaCompositingEnabled,
preserveDrawingBuffer:this.preserveDrawingBufferEnabled,canvas:this.renderCanvas,screenshot:{prepareOverlay:()=>this._prepareScreenshotOverlay(),renderOverlay:(Za,hb,jb)=>this._renderScreenshotOverlay(Za,hb,jb)}};var Xa=new aa.SceneIntersectionHelper(this.state.viewingMode,Za=>this._stage.layers.forAll(Za),this);this._set("sceneIntersectionHelper",Xa);Xa=e.byId(this.surface);this._stage=new Ta.Stage({view:this,options:Oa,container:Xa});this._stage.renderer.slicePlane=this.slicePlane;this.addHandles([this.updatingHandles.add(()=>
this.qualitySettings.highQualityTransparency,Za=>this._stage.renderer.setParameters({highQualityTransparency:Za}),t.initial),this.on("pointer-move",()=>this._stage?.renderer.resetAnimation()),d.on(this._stage.renderView.canvas,"webglcontextlost",Za=>{this.fatalError=new g("webgl-context-lost",Za.statusMessage)})],"stage");this.renderCoordsHelper&&this.sceneIntersectionHelper.setTolerance(La.defaultTolerance/this.renderCoordsHelper.unitInMeters);this._set("canvas",this._stage.renderView.canvas)}_exitStage(){this._set("sceneIntersectionHelper",
null);this._stage=w.destroyMaybe(this._stage);this.removeHandles("stage");this._set("canvas",null)}_initSurface(Oa){this._exitSurface();this._initStage();this._initGlobe();this.sharedSymbolResources=new Aa.SharedSymbolResources({view:this,viewingMode:Oa,resourceController:this._resourceController,pointsOfInterest:this.pointsOfInterest,viewState:this.state})}_exitSurface(){this.sharedSymbolResources&&(this.sharedSymbolResources.objectResourceCache.destroy(),this.sharedSymbolResources.destroy(),this.sharedSymbolResources=
null,this._exitGlobe(),this._exitStage())}_createGraphicsViewIfNeeded(){if(!this.graphicsView&&!this._createGraphicsViewController&&0!==this.graphics.length){this.removeHandles("graphics-view");this._createGraphicsViewController=new AbortController;var Oa=()=>{this._createGraphicsViewController=null;this._updatingChanged()};this._createGraphicsViewAsync(this._createGraphicsViewController.signal).then(Oa,Oa);this._updatingChanged()}}async _createGraphicsViewAsync(Oa){const Xa=(await new Promise((Za,
hb)=>a(["./3d/layers/GraphicsView3D"],jb=>Za(Object.freeze(Object.defineProperty({__proto__:null,default:jb},Symbol.toStringTag,{value:"Module"}))),hb))).default;u.throwIfAborted(Oa);await t.whenOnce(()=>this.basemapTerrain?.ready,Oa);this._set("graphicsView",new Xa({view:this}))}_disposeGraphicsView(){this._createGraphicsViewController&&(this._createGraphicsViewController.abort(),this._createGraphicsViewController=null);this.removeHandles("graphics-view");null!=this.graphicsView&&(this.removeHandles(this.graphicsView.processor.layer.id),
this.graphicsView.destroy(),this._set("graphicsView",null))}_startup(){var Oa=da.viewingModeFromString(this.viewingMode);Oa===da.ViewingMode.Global&&(this._clippingArea=null);this._initSurface(Oa);this._set("ready",!0);this.addHandles(t.on(()=>this.graphics,"after-changes",()=>this._createGraphicsViewIfNeeded()),"graphics-view");this._createGraphicsViewIfNeeded();Oa=this.map&&"initialViewProperties"in this.map?this.map.initialViewProperties:null;const Xa=Oa?.environment;Xa&&(this._overrideDefaultEnvironmentOnly?
H.overrideDefaultsFrom(this.environment,Xa):this.environment=this.environment.cloneWithWebsceneEnvironment(Xa));this.timeExtent=Oa?.timeExtent;this.labeler.setup();this.environmentManager.connectView(this);this.inputManager.connect();this._set("textures",new Ja.TextureCollection(this._stage,this.resourceController.scheduler));Oa=this._resolveWhenReady;this._resolveWhenReady=[];Oa.forEach(Za=>Za(this))}_teardown(){this._initialDefaultSpatialReference=null;this.inputManager.disconnect();this.environmentManager.disconnectView();
this._overrideDefaultEnvironmentOnly=!1;this.labeler.dispose();this._disposeGraphicsView();this.removeHandles("graphics-view");this._set("textures",w.destroyMaybe(this.textures));this._exitSurface();this._set("ready",!1)}_updateDefaultToMapOptions(){this._defaultToMapOptions.include.clear();if(this.map){this.map.ground&&this._defaultToMapOptions.include.add(Va.terrainId);for(const Oa of this.map.allLayers.items)K.isIntegratedMeshLayer(Oa.type)&&this._defaultToMapOptions.include.add(Oa.uid)}}_updateDefaultHitTestOptions(){this._defaultHitTestOptions.exclude.clear();
if(this.map){this.map.ground&&1>this.map.ground.opacity&&this._defaultHitTestOptions.exclude.add(Va.terrainId);for(const Oa of this.map.allLayers.items)K.isIntegratedMeshLayer(Oa.type)&&1>Oa.opacity&&this._defaultHitTestOptions.exclude.add(Oa.uid)}}};k.type="3d";b.__decorate([y.property()],k.prototype,"_userClippingArea",void 0);b.__decorate([y.property()],k.prototype,"_resourceController",void 0);b.__decorate([y.property()],k.prototype,"_stage",void 0);b.__decorate([y.property({readOnly:!0})],k.prototype,
"deconflictor",void 0);b.__decorate([y.property({readOnly:!0})],k.prototype,"labeler",void 0);b.__decorate([y.property(F.owningCollectionProperty(L.AnalysesCollection,"analyses"))],k.prototype,"analyses",void 0);b.__decorate([y.property({type:U,readOnly:!0})],k.prototype,"animation",null);b.__decorate([y.property({readOnly:!0})],k.prototype,"basemapTerrain",void 0);b.__decorate([y.property({readOnly:!0})],k.prototype,"elevationProvider",void 0);b.__decorate([y.property()],k.prototype,"camera",null);
b.__decorate([y.property({type:n})],k.prototype,"contentCamera",null);b.__decorate([y.property({readOnly:!0})],k.prototype,"canvas",void 0);b.__decorate([y.property({type:Ea})],k.prototype,"center",null);b.__decorate([y.property({type:xb})],k.prototype,"clippingArea",null);b.__decorate([y.property({type:T.Constraints})],k.prototype,"constraints",void 0);b.__decorate([y.property({type:xb,readOnly:!0})],k.prototype,"renderDataExtent",null);b.__decorate([y.property({readOnly:!0})],k.prototype,"tileInfo",
null);b.__decorate([y.property({type:xb,readOnly:!0})],k.prototype,"dataExtent",null);b.__decorate([y.property({type:xb,readOnly:!0})],k.prototype,"_groundAndLayersExtent",null);b.__decorate([y.property({type:Z})],k.prototype,"environment",void 0);b.__decorate([B.cast("environment")],k.prototype,"castEnvironment",null);b.__decorate([y.property({readOnly:!0})],k.prototype,"environmentManager",void 0);b.__decorate([y.property({type:xb})],k.prototype,"extent",null);b.__decorate([y.property()],k.prototype,
"floors",void 0);b.__decorate([y.property()],k.prototype,"screenCenter",null);b.__decorate([y.property()],k.prototype,"frustum",null);b.__decorate([y.property({type:Number,readOnly:!0})],k.prototype,"fullOpacity",void 0);b.__decorate([y.property({readOnly:!0})],k.prototype,"graphicsView",void 0);b.__decorate([y.property({readOnly:!0})],k.prototype,"analysisViewManager",void 0);b.__decorate([y.property()],k.prototype,"groundView",void 0);b.__decorate([y.property({type:Boolean})],k.prototype,"initialExtentRequired",
null);b.__decorate([y.property()],k.prototype,"defaultsFromMapSettings",null);b.__decorate([y.property()],k.prototype,"interacting",null);b.__decorate([y.property()],k.prototype,"stationary",null);b.__decorate([y.property()],k.prototype,"navigating",null);b.__decorate([y.property()],k.prototype,"map",void 0);b.__decorate([y.property()],k.prototype,"padding",null);b.__decorate([y.property({type:Sa.PointsOfInterest,readOnly:!0})],k.prototype,"pointsOfInterest",void 0);b.__decorate([y.property({type:ka.FeatureTileTree3D,
readOnly:!0})],k.prototype,"featureTiles",void 0);b.__decorate([y.property()],k.prototype,"_featureTreeDebugger",void 0);b.__decorate([y.property({type:Boolean})],k.prototype,"screenSizePerspectiveEnabled",void 0);b.__decorate([y.property({constructOnly:!0})],k.prototype,"deactivatedWebGLExtensions",void 0);b.__decorate([y.property({constructOnly:!0})],k.prototype,"debugWebGLExtensions",void 0);b.__decorate([y.property({constructOnly:!0})],k.prototype,"renderCanvas",void 0);b.__decorate([y.property({constructOnly:!0})],
k.prototype,"state",void 0);b.__decorate([y.property({readOnly:!0})],k.prototype,"inputManager",void 0);b.__decorate([y.property({readOnly:!0})],k.prototype,"stateManager",void 0);b.__decorate([y.property({type:["low","medium","high"]})],k.prototype,"qualityProfile",null);b.__decorate([y.property({type:Ia,get(){let Oa=this._get("qualitySettings");Oa||(Oa=new Ia,na.apply(this.qualityProfile,Oa));return Oa}})],k.prototype,"qualitySettings",void 0);b.__decorate([y.property()],k.prototype,"slicePlane",
null);b.__decorate([y.property({readOnly:!0})],k.prototype,"typeSpecificPreconditionsReady",null);b.__decorate([y.property({readOnly:!0})],k.prototype,"renderCoordsHelper",void 0);b.__decorate([y.property({readOnly:!0})],k.prototype,"sceneIntersectionHelper",void 0);b.__decorate([y.property({type:Number,dependsOn:["scale","spatialReference"],readOnly:!0})],k.prototype,"resolution",null);b.__decorate([y.property({type:Number})],k.prototype,"scale",null);b.__decorate([y.property()],k.prototype,"heightModelInfo",
null);b.__decorate([y.property()],k.prototype,"spatialReference",void 0);b.__decorate([y.property({type:Boolean,constructOnly:!0})],k.prototype,"alphaCompositingEnabled",void 0);b.__decorate([y.property({constructOnly:!0})],k.prototype,"preserveDrawingBufferEnabled",void 0);b.__decorate([y.property({type:Boolean})],k.prototype,"supersampleScreenshotsEnabled",void 0);b.__decorate([y.property({readOnly:!0})],k.prototype,"type",void 0);b.__decorate([y.property(),B.cast(Oa=>Oa instanceof cb?Oa:C.ensureClass(ib,
Oa))],k.prototype,"ui",void 0);b.__decorate([y.property({type:Boolean,readOnly:!0,dependsOn:"graphicsView.updating basemapView.updating basemapTerrain.updating layerViewManager.updating layerViewManager.updatingRemaining _resourceController.updating _stage.updating featureTiles.updating pointsOfInterest.updating environmentManager.updating overlay.updating updatingHandles.updating featureTreeDebugger.updating labeler.updating deconflictor.updating ready stationary inputManager.updating toolViewManager.updating analysisViewManager.updating state.updating textures.updating".split(" ")})],
k.prototype,"updating",null);b.__decorate([y.property()],k.prototype,"_updatingObjects",null);b.__decorate([y.property()],k.prototype,"_updatingObjectsWithProgress",null);b.__decorate([y.property({type:Number,readOnly:!0,dependsOn:["updating"]})],k.prototype,"updatingProgress",void 0);b.__decorate([y.property({type:["global","local"]})],k.prototype,"viewingMode",null);b.__decorate([y.property({type:p})],k.prototype,"viewpoint",null);b.__decorate([y.property({readOnly:!0})],k.prototype,"visibleArea",
null);b.__decorate([y.property({type:Number})],k.prototype,"zoom",null);b.__decorate([y.property({type:xa})],k.prototype,"highlightOptions",null);b.__decorate([y.property({type:h.ofType(sa.HighlightGroup)})],k.prototype,"highlights",void 0);b.__decorate([y.property({readOnly:!0})],k.prototype,"quality",null);b.__decorate([y.property({readOnly:!0})],k.prototype,"resolutionScale",null);b.__decorate([y.property()],k.prototype,"textures",void 0);k=b.__decorate([A.subclass("esri.views.SceneView")],k);
const db=E.create(),lb=q.createScreenPointArray(),ub=N.create();return k});