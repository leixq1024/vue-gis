// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.31/esri/copyright.txt for details.
//>>built
define("exports ../../../geometry ../../../arcade/deepClone ../../../core/Error ../../../core/has ../../../core/Logger ../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../geometry/support/plane ./updateElevation ./utils ./worldToImage ../../../geometry/Point ../../../geometry/Polygon".split(" "),function(u,F,B,G,H,I,w,l,t,g,x,m,C){function y(a,c){a=new C({spatialReference:a});a.addRing(c);return[a.extent?.width?a.extent.width/10:1,a.extent?.height?a.extent.height/10:1]}async function z(a,c,
b){a=B.deepClone(a);c=await t(a,c);b.push(...c.map(g.pointToArray))}async function D(a,c,b){c=await t(c,b);b=x.worldToImage(c,b);return{error:Math.abs(b.x-a.x)+Math.abs(b.y-a.y),imagePoint:b,pointWithZ:c}}async function E(a,c,b){c=await t(c,b);b=x.worldToImagePanoramic(c,b);return{error:Math.abs(b.heading-a.heading)+Math.abs(b.pitch-a.pitch),imagePoint:b,pointWithZ:c}}async function A(a,c,b,n){a=[[-a,-c],[a,-c],[a,c],[-a,c]].map(([e,h])=>new m([b.x+e,b.y+h],b.spatialReference));return t(a,n).then(e=>
e.map(h=>h.toArray()))}u.rectifyMapPoint=async function(a,c,b,n=10){const {cameraLocation:e,farPlaneVertices:h}=b,v=g.pointToArray(e),d=[];await z(h,b,d);var f=l.fromPoints(d[0],d[1],d[2]);a=a.clone();for(let p=0;p<n;p++){const k=w.create();if(!l.intersectLine(f,v,g.pointToArray(a),k))break;f=0;({error:f,pointWithZ:a}=await D(c,new m(k,e.spatialReference),b));if(1>=f)break;const [q,r]=y(e.spatialReference,d);if(g.or(1>=q,1>=r))break;d.splice(0,d.length,...(await A(q,r,new m(k,e.spatialReference),
b)));f=l.fromPoints(d[0],d[1],d[2])}return g.pointToArray(a)};u.rectifyMapPointPanoramic=async function(a,c,b,n=10){const {cameraLocation:e,farPlaneVertices:h}=b,v=g.pointToArray(e),d=[];await z(h,b,d);var f=l.fromPoints(d[0],d[1],d[2]);a=a.clone();for(let p=0;p<n;p++){const k=w.create();if(!l.intersectLine(f,v,g.pointToArray(a),k))break;f=0;({error:f,pointWithZ:a}=await E(c,new m(k,e.spatialReference),b));if(1>=f)break;const [q,r]=y(e.spatialReference,d);if(g.or(1>=q,1>=r))break;d.splice(0,d.length,
...(await A(q,r,new m(k,e.spatialReference),b)));f=l.fromPoints(d[0],d[1],d[2])}return g.pointToArray(a)};Object.defineProperty(u,Symbol.toStringTag,{value:"Module"})});