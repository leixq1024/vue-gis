// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.31/esri/copyright.txt for details.
//>>built
define("../chunks/tslib.es6 ../geometry ../request ../core/Error ../core/mathUtils ../core/MultiOriginJSONSupport ../core/reactiveUtils ../core/accessorSupport/decorators/property ../core/has ../core/Logger ../core/RandomLCG ../core/accessorSupport/decorators/reader ../core/accessorSupport/decorators/subclass ../geometry/Polyline ../geometry/SpatialReference ./Layer ./mixins/BlendLayer ./mixins/CustomParametersMixin ./mixins/ScaleRangeLayer ./support/arcgisLayerUrl ./support/commonProperties ./support/PlaybackInfo ./support/serviceCapabilitiesUtils ./support/TelemetryData ./support/TelemetryDisplay ./support/VideoFrame ./video/VideoController ./video/videoUtils ../geometry/Extent".split(" "),
function(b,a,m,n,r,t,k,c,J,K,L,l,u,v,w,x,y,z,A,B,C,D,E,F,p,G,H,g,q){a=class extends y.BlendLayer(A.ScaleRangeLayer(t.MultiOriginJSONMixin(z.CustomParametersMixin(x)))){constructor(d){super(d);this._trailPoints=[];this.connectionInfo=this.capabilities=null;this.controller=new H;this.sourceType=this.sourceQuality=this.sourceJSON=this.serviceItemId=this.qualities=this.posterUrl=this.playbackInfo=this.layerId=this.initialExtent=this.fullExtent=this.frameCount=this.frame=this.elevationSource=this.description=
this.created=this.copyright=null;this.spatialReference=w.WGS84;this.title=this.telemetryDisplay=null;this.type="video";this.videoTimeExtent=this.videoLayersInfo=this.url=null}initialize(){this.telemetryDisplay=new p({frame:!1,frameCenter:!1,frameOutline:!0,lineOfSight:!0,sensorLocation:!0,sensorTrail:!0});this.addHandles([k.watch(()=>this.metadata,()=>{this.notifyChange("telemetry");this.notifyChange("groundControlPoints");this.notifyChange("frameHorizonPoints")}),k.watch(()=>this.telemetry?.sensorLocation,
d=>this._setSensorTrail(d),k.initial)])}load(d){this.addResolvingPromise(this._fetchService(null!=d?d.signal:null));return Promise.resolve(this)}get buffered(){return this.controller.buffered}readCapabilitiesFromService(d,e){return E.getVideoLayerCapabilities(e)}readConnectionInfo(d,e){d=Object.values(e.connectionUrl);d?.length&&(this.controller.playerUrl=d[0]);return e.connectionUrl}get currentTime(){return this.controller.currentTime}get duration(){return this.controller.duration}get ended(){return this.controller.ended}get frameHorizonPoints(){return g.getFrameHorizonPoints(this.metadata)}get groundControlPoints(){return g.getGroundControlPoints(this.metadata)}get loop(){return this.controller.loop}set loop(d){this.controller.loop=
d}get metadata(){return this.controller?.currentMetadata}get mimeType(){return this.controller?.mimeType}get muted(){return this.controller.muted}set muted(d){this.controller.muted=d}get playbackRate(){return this.controller.rate}set playbackRate(d){this.controller.rate=d}get playerUrl(){return this.controller.playerUrl}get playing(){return this.controller.playing}get state(){return this.controller.state}get telemetry(){return g.getTelemetryData(this.metadata)}get videoElement(){return this.controller?.element}get videoHeight(){return this.controller?.videoHeight}readLayerInfosFromService(d,
e){return g.getServiceLayersInfo(e)}get videoWidth(){return this.controller?.videoWidth}get waiting(){return this.controller.waiting}play(){this.controller.play()}pause(){this.controller.pause()}reset(){this.controller.reset()}setCurrentTime(d){this.duration&&(d=r.clamp(d,0,this.duration),this.controller.setCurrentTime(d))}toGround(d,e){return this.controller?.sensorModel?.metadataSupportsTransforms?this.controller.sensorModel.transformImageToGeo(d,e):null}toVideo(d){if(!this.controller?.sensorModel?.metadataSupportsTransforms)return null;
d=this.controller.sensorModel.transformGeoToImage(d.x,d.y,d.z);return{x:d[0],y:d[1]}}async _fetchService(d){if(!this.sourceJSON){var e=B.parse(this.parsedUrl?.path);if(null==e)throw new n("arcgis-layers:url-mismatch","The url is not a valid arcgis resource");var f=null,{data:h,ssl:I}=await m(e.url.path,{query:{f:"json",...this.parsedUrl.query,...this.customParameters},signal:d});this.url=e.url.path;I&&(this.url=this.url.replace(/^http:/i,"https:"));if(h?.currentVersion){f=e?.sublayer;null==f&&h.layers?.length&&
(f=h.layers[0].id);if(null==f)throw new n("arcgis-layers:url-mismatch","The url is not a valid arcgis resource");this.url=`${e.url.path}/${f}`;f=await m(this.url,{query:{f:"json",...this.customParameters},signal:d});this.sourceJSON={...h,...f.data}}else h.currentVersion="11.2",this.sourceJSON=h}this.read(this.sourceJSON,{origin:"service",url:this.parsedUrl})}_setSensorTrail(d){if(d){this._trailPoints=[...g.getSensorTrailPoints(d,this._trailPoints)];var e=this._trailPoints.map(f=>f.toArray());d=new v({hasZ:d.hasZ,
paths:[e]});this.telemetry.sensorTrail=d.clone()}}};b.__decorate([c.property({readOnly:!0})],a.prototype,"buffered",null);b.__decorate([c.property({readOnly:!0,json:{read:!1}})],a.prototype,"capabilities",void 0);b.__decorate([l.reader("service","capabilities","supportsAppend supportsCoverageQuery supportsExportClip supportsExportFrameset supportsMensuration supportsUpdate".split(" "))],a.prototype,"readCapabilitiesFromService",null);b.__decorate([c.property({readOnly:!0})],a.prototype,"connectionInfo",
void 0);b.__decorate([l.reader("connectionInfo",["connectionUrl"])],a.prototype,"readConnectionInfo",null);b.__decorate([c.property()],a.prototype,"controller",void 0);b.__decorate([c.property({type:String})],a.prototype,"copyright",void 0);b.__decorate([c.property({readOnly:!0,type:Date})],a.prototype,"created",void 0);b.__decorate([c.property({type:Number})],a.prototype,"currentTime",null);b.__decorate([c.property({type:String})],a.prototype,"description",void 0);b.__decorate([c.property({type:Number})],
a.prototype,"duration",null);b.__decorate([c.property({readOnly:!0})],a.prototype,"elevationSource",void 0);b.__decorate([c.property({type:Boolean})],a.prototype,"ended",null);b.__decorate([c.property({type:G})],a.prototype,"frame",void 0);b.__decorate([c.property({readOnly:!0,type:Number})],a.prototype,"frameCount",void 0);b.__decorate([c.property({type:q})],a.prototype,"fullExtent",void 0);b.__decorate([c.property({readOnly:!0})],a.prototype,"frameHorizonPoints",null);b.__decorate([c.property({readOnly:!0})],
a.prototype,"groundControlPoints",null);b.__decorate([c.property({type:q})],a.prototype,"initialExtent",void 0);b.__decorate([c.property({readOnly:!0,json:{read:{source:"id"}}})],a.prototype,"layerId",void 0);b.__decorate([c.property({type:Boolean})],a.prototype,"loop",null);b.__decorate([c.property({readOnly:!0})],a.prototype,"metadata",null);b.__decorate([c.property({readOnly:!0})],a.prototype,"mimeType",null);b.__decorate([c.property({type:Boolean})],a.prototype,"muted",null);b.__decorate([c.property({type:D})],
a.prototype,"playbackInfo",void 0);b.__decorate([c.property({type:Number})],a.prototype,"playbackRate",null);b.__decorate([c.property({type:String})],a.prototype,"playerUrl",null);b.__decorate([c.property({readOnly:!0})],a.prototype,"playing",null);b.__decorate([c.property({readOnly:!0,json:{read:{source:"poster"}}})],a.prototype,"posterUrl",void 0);b.__decorate([c.property({readOnly:!0})],a.prototype,"qualities",void 0);b.__decorate([c.property({readOnly:!0})],a.prototype,"serviceItemId",void 0);
b.__decorate([c.property()],a.prototype,"sourceJSON",void 0);b.__decorate([c.property({readOnly:!0})],a.prototype,"sourceQuality",void 0);b.__decorate([c.property({readOnly:!0,json:{name:"serviceType"}})],a.prototype,"sourceType",void 0);b.__decorate([c.property()],a.prototype,"spatialReference",void 0);b.__decorate([c.property({readOnly:!0,type:String})],a.prototype,"state",null);b.__decorate([c.property({readOnly:!0,type:F})],a.prototype,"telemetry",null);b.__decorate([c.property({type:p})],a.prototype,
"telemetryDisplay",void 0);b.__decorate([c.property({readOnly:!1,json:{read:{source:"name"}}})],a.prototype,"title",void 0);b.__decorate([c.property({readOnly:!0})],a.prototype,"type",void 0);b.__decorate([c.property(C.url)],a.prototype,"url",void 0);b.__decorate([c.property({readOnly:!0})],a.prototype,"videoElement",null);b.__decorate([c.property({readOnly:!0})],a.prototype,"videoHeight",null);b.__decorate([c.property({readOnly:!0,json:{read:!1}})],a.prototype,"videoLayersInfo",void 0);b.__decorate([l.reader("service",
"videoLayersInfo",["id","name","poster","serviceType","type"])],a.prototype,"readLayerInfosFromService",null);b.__decorate([c.property({readOnly:!0,nonNullable:!1,json:{read:{reader:g.readVideoTimeExtent,source:"time"}}})],a.prototype,"videoTimeExtent",void 0);b.__decorate([c.property({readOnly:!0})],a.prototype,"videoWidth",null);b.__decorate([c.property({readOnly:!0})],a.prototype,"waiting",null);return a=b.__decorate([u.subclass("esri.layers.VideoLayer")],a)});