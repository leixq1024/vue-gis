// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.31/esri/copyright.txt for details.
//>>built
define("exports ../../../geometry/Extent ../../../geometry/Polygon ../../ogc/crsUtils ../RasterInfo ./multidimensionalUtils ./xmlUtilities".split(" "),function(I,z,V,W,J,X,b){function K(a){let c;a.variables.forEach(d=>d.dimensions.forEach(k=>(c=k).values??(c.values=X.getDimensionValues(k))))}function Y(a){const c=b.getElementValues(a,"requestResponseCRSs").map(d=>d.split(":")[1]);a=b.getElementValues(a,"nativeCRSs").map(d=>d.split(":")[1]);return{requestResponseCRSs:c,nativeCRSs:a}}function R(a,c){const d=
b.getElementValues(a,"1.0.0"===c?"interpolationMethod":"InterpolationMethod"),k="1.0.0"===c?a.getAttribute("default"):b.getElementValue(a,"InterpolationMethods/Default");return null!=k?[k].concat(d.filter(f=>f.toLowerCase()!==k.toLowerCase())):d}function L(a){return null==a?["nearest"]:a.map(c=>{c=c.toLowerCase();return c.includes("nearest")?"nearest":c.includes("linear")?"bilinear":c.includes("cubic")?"cubic":null}).filter(c=>!!c)}function M(a,c){a=b.getElementValues(a,c);return a?.length&&""!==
a[0]&&!isNaN(Number(a[0]))?a.map(d=>Number(d)):null}function Z(a){const c=b.getSpaceDelimitedNumericValues(a,"MinimumValue"),d=b.getSpaceDelimitedNumericValues(a,"MaximumValue");return c.length&&d.length?c.map((k,f)=>({min:k,max:d[f],avg:-1,stddev:-1})):null}function N(a){return null==a?null:a.every(c=>c===a[0])?a[0]:a}function aa(a=null){if(!a)return{resolution:null,units:null};let c=a.toUpperCase();var d=["Y","M","D"];const k=["H","M","S"];a="Years Months Days Hours Minutes Seconds".split(" ");
let f;c.includes("PT")?(c=c.slice(2),d=k.findIndex(g=>c.includes(g)),f=a[3+d]):(c=c.slice(1),d=d.findIndex(g=>c.includes(g)),-1<d&&(f=a[d]));return{resolution:parseFloat(c.slice(0,-1)),units:f}}function E(a){var c=b.getElements(a,"timeposition");if(0<c.length){a=[];for(var d=0;d<c.length;d++)a.push(new Date(b.getElementValue(c[d])));return{begin:a[0],end:a[a.length-1],values:a}}return(d=b.getElement(a,"timePeriod")||b.getElement(a,"TimePeriod"))?(c=new Date(b.getElementValue(d,"beginPosition")||b.getElementValue(d,
"BeginPosition")),a=new Date(b.getElementValue(d,"endPosition")||b.getElementValue(d,"EndPosition")),d=b.getElementValue(d,"timeResolution")||b.getElementValue(d,"TimeResolution"),d=aa(d),{begin:c,end:a,...d}):null}function ba(a){if(!a.temporalDomain)return null;const {begin:c,end:d,values:k,units:f,resolution:g}=a.temporalDomain;a={variables:[{name:"default",description:"",dimensions:[{name:"StdTime",description:"",unit:"ISO8601",values:k?.map(m=>m.getTime()),hasRegularIntervals:!k,interval:g,intervalUnit:f,
extent:[c.getTime(),d.getTime()]}]}]};K(a);return a}function ca(a,c){if(!c.temporalDomain)return null;a=a.filter(k=>!k.identifier.toLowerCase().includes("field_1")&&!k.axis.some(f=>f.identifier.includes("band")));const d=[];a.length&&a.forEach(k=>{const f=k.axis.map(g=>{const m=g.values.map(e=>"ISO8601"===g.uom?(e=e.trim(),e.toLowerCase().includes("z")?(new Date(e)).getTime():(new Date(e+"Z")).getTime()):parseFloat(e.trim())),h=[Math.min.apply(null,m),Math.max.apply(null,m)];return{name:g.identifier.trim(),
description:"",field:g.identifier.trim(),unit:g.uom?g.uom.trim():"",hasRegularIntervals:!1,values:m,extent:h}});d.push({name:k.identifier.trim(),description:k.description?.trim()??"",unit:"",dimensions:f,statistics:k.statistics})});if(c.temporalDomain){const {begin:k,end:f,values:g,units:m,resolution:h}=c.temporalDomain;d.some(e=>e.dimensions.some(l=>"stdtime"===l.name.toLowerCase()))||d.forEach(e=>{e.dimensions.push({name:"StdTime",description:"",unit:"ISO8601",values:g?.map(l=>l.getTime()),hasRegularIntervals:!g,
interval:h,intervalUnit:m,extent:[k.getTime(),f.getTime()]})})}return d.length?(c={variables:d},K(c),c):null}function da(a){var c=b.getElement(a,"SpatialDomain"),d=b.getElement(c,"GridCRS"),k=b.getElementValue(d,"GridBaseCRS");const f=b.getElementValue(d,"GridOrigin")?.split(" ").map(p=>parseFloat(p))??[0,0];d=b.getSpaceDelimitedNumericValues(d,"GridOffsets");c=b.getElements(c,"BoundingBox");let g;for(var m=0;m<c.length;m++){var h=c[m].getAttribute("crs")?.toLowerCase();if(null!=h)if(h.includes("imagecrs")){var e=
b.getSpaceDelimitedNumericValues(c[m],"LowerCorner");h=b.getSpaceDelimitedNumericValues(c[m],"UpperCorner");g=h[0]-e[0]+1;e=h[1]-e[1]+1}else if(0<h.indexOf("epsg")){var l=h.split(":");l=parseInt(l[l.length-1],10);var n=b.getSpaceDelimitedNumericValues(c[m],"LowerCorner");h=b.getSpaceDelimitedNumericValues(c[m],"UpperCorner");n=new z({xmin:n[0],ymin:n[1],xmax:h[0],ymax:h[1],spatialReference:{wkid:l}})}}c=g>e;m=n.xmax-n.xmin>n.ymax-n.ymin;h=!1;W.isAxesOrderReversedForWkid(l)&&(c===m?h=!1:(h=!0,n=new z({xmin:n.ymin,
ymin:n.xmin,xmax:n.ymax,ymax:n.xmax,spatialReference:{wkid:l}})));k={columns:g,rows:e,origin:{x:f[0],y:f[1]},offset:{x:d[0],y:d[d.length-1]},gridBaseCRS:k,envelope:n,useEPSGAxis:h};a=(a=b.getElement(a,"temporalDomain")||b.getElement(a,"TemporalDomain"))?E(a):null;return{spatialDomain:k,temporalDomain:a}}function ea(a){const c=b.getElement(a,"Envelope")||b.getElement(a,"EnvelopeWithTimePeriod");var d=c.getAttribute("srsName"),k=d.slice(d.lastIndexOf("/")+1);d=c.getAttribute("axisLabels").split(" ").map(l=>
l.trim()).filter(l=>""!==l.trim());var f=b.getSpaceDelimitedNumericValues(c,"lowerCorner"),g=b.getSpaceDelimitedNumericValues(c,"upperCorner");const m=!"y lat latitude north nor n b".split(" ").includes(d[0].toLowerCase());k=parseInt(k,10);k=isNaN(k)?null:{wkid:k};k=m?new z({xmin:f[0],ymin:f[1],xmax:g[0],ymax:g[1],spatialReference:k}):new z({xmin:f[1],ymin:f[0],xmax:g[1],ymax:g[0],spatialReference:k});f={mins:f,maxs:g};g=c.getAttribute("uomLabels").trim().split(" ");let h,e;b.isSameTagIgnoreNS(c,
"EnvelopeWithTimePeriod")&&(h=new Date(b.getElementValue(a,"beginPosition")||b.getElementValue(a,"BeginPosition")),e=new Date(b.getElementValue(a,"endPosition")||b.getElementValue(a,"EndPosition")),a=g?.findIndex(l=>"oledatetime"===l?.toLowerCase()),-1<a&&(g[a]="ISO8601"));return{envelope:k,axisLabels:d,uomLabels:g.length?g:null,envelopeAllDims:f,beginPosition:h,endPosition:e,isEastFirst:m}}function fa(a,c){const d=[];a=b.getElements(a,"DataRecord");const k=[];let f=[],g;for(let m=0;m<a.length;m++){const h=
b.getElements(a[m],"field"),e=[];for(let l=0;l<h.length;l++){const n=h[l].getAttribute("name"),p=b.getElementValue(h[l],"description")||"",q=b.getElement(h[l],"uom")?.getAttribute("code")||"",r=b.getSpaceDelimitedNumericValues(h[l],"interval"),t=M(h[l],"nilValue")?.[0];if(!c||n.toLowerCase().includes("band"))k.push(n),r?.length&&(g=g||[],g.push({min:r[0],max:r[1],avg:-1,stddev:-1})),f.push(t);e.push({name:n,description:p,uom:q,allowedValues:r,nilValue:t})}d.push(e)}f.some(m=>null!=m)||(f=null);return{rangeType:d,
bandNames:k,bandStats:g,bandNoDataValues:f}}function ha(a){let c=1,d="";Math.abs(a-1/24)<1/24*.01?d="Hours":.01>Math.abs(a-1)?d="Days":1>a?(c=Math.round(24*a),d="Hours"):27.99<a&&31.01>a?d="Months":12>Math.round(a/30)?d="Months":364.99<a&&366.01>a&&(d="Years");return{interval:c,intervalUnit:d}}function ia(a,c,d){if(2>=d.axisLabels.length)return null;const k=[];for(var f=0;f<a.length;f++){var g=a[f];for(var m=0;m<g.length;m++)g[m].name.toLowerCase().includes("band")||k.push(g[m])}const h=[];if(k.length){const l=
[];for(a=2;a<d.axisLabels.length;a++){f=c.uomLabels?.[a]?.trim()??"";g=d.axisLabels[a].toLowerCase().includes("time")||"iso8601"===f.toLowerCase()||"oledatetime"===f.toLowerCase();var e=void 0;g?(e=ha(d.offset[a]),m=e.interval,e=e.intervalUnit):(m=d.offset[a],e=f);const n=[];g?(n.push((new Date).setTime(864E5*(c.envelopeAllDims.mins[a]-25569))),n.push((new Date).setTime(864E5*(c.envelopeAllDims.maxs[a]-25569)))):(n.push(c.envelopeAllDims.mins[a]),n.push(c.envelopeAllDims.maxs[a]));l.push({name:d.axisLabels[a].trim(),
description:d.axisLabels[a].trim(),unit:g?"ISO8601":f,hasRegularIntervals:!0,extent:n,interval:m,intervalUnit:e})}k.forEach(n=>{var {allowedValues:p}=n;p=2===p?.length?[{min:p[0],max:p[1],avg:-1,stddev:-1}]:null;h.push({name:n.name.trim(),description:n.description?.trim()??"",unit:n.uom.trim(),statistics:p,dimensions:l})});if(h.length)return c={variables:h},K(c),c}return null}function ja(a,c){var d=b.getElement(a,"RectifiedGrid"),k=b.getSpaceDelimitedNumericValues(d,"low"),f=b.getSpaceDelimitedNumericValues(d,
"high");a=[];for(var g=0;g<k.length;g++)a.push(f[g]-k[g]+1);k=b.getElementValue(d,"axisLabels").split(" ");f=b.getSpaceDelimitedNumericValues(d,"origin/pos");g=b.getElements(d,"offsetVector");d=[];for(var m=0;m<g.length;m++){var h=b.getSpaceDelimitedNumericValues(g[m]);const e=h.findIndex(l=>0!==l);d[e]=h[e]}g=!1;c?.length&&k?.length&&(g=[...c].sort((e,l)=>e<l?-1:1).join(","),m=[...k].sort((e,l)=>e<l?-1:1).join(","),g=g===m);"y lat latitude north nor n b".split(" ").includes((g?k:c)[0].toLowerCase())?
(c=a[1],m=a[0],h={y:Math.abs(d[0]),x:Math.abs(d[1])}):(c=a[0],m=a[1],h={x:Math.abs(d[0]),y:Math.abs(d[1])});return{columns:c,rows:m,origin:f,offset:d,resolution:h,gridSamples:a,axisLabels:k,hasSameAxisLabelsAsBoundedBy:g}}function ka(a){var c=b.getElement(a,"EarthObservation");if(!c)return null;var d=b.getElement(c,"phenomenonTime");d=d?E(d):null;var k=b.getElement(c,"phenomenonTime");k=k?E(k):null;var f=b.getElementValue(c,"featureOfInterest/Footprint/multiExtentOf/MultiSurface/surfaceMembers/Polygon/exterior/LinearRing/posList");
c=null;if(f&&(f=f.split(" ").map(m=>m.trim()).filter(m=>null!=m&&""!==m).map(Number),f.length)){c=[];for(var g=0;g<f.length/2;g+=2)c.push(f[g],f[g+1]);c=new V({rings:[[c]]})}f=b.getElementValue(a,"metaDataProperty/EarthObservationMetaData/identifier");g=b.getElementValue(a,"metaDataProperty/EarthObservationMetaData/acquisitionType");a=b.getElementValue(a,"metaDataProperty/EarthObservationMetaData/status");return{observation:{phenomenonTime:d,resultTime:k,footprint:c,identifier:f,acquisitionType:g,
status:a}}}I.parseCoverages=function(a,c){let d=null;d="string"===typeof a?(new DOMParser).parseFromString(a,"text/xml"):a;if("1.0.0"===c)return b.getElements(d,"CoverageOffering").map(k=>{const f={version:"1.0"};var g=[],m;for(var h=0;h<k.childNodes.length;h++){var e=k.childNodes[h];if(1===e.nodeType)if(b.isSameTagIgnoreNS(e,"description"))f.description=b.getElementValue(e);else if(b.isSameTagIgnoreNS(e,"name"))f.name=b.getElementValue(e);else if(b.isSameTagIgnoreNS(e,"label"))f.label=b.getElementValue(e);
else if(b.isSameTagIgnoreNS(e,"supportedFormats"))f.supportedFormats=b.getElementValues(e,"formats");else if(b.isSameTagIgnoreNS(e,"supportedCRSs"))f.supportedCRSs=Y(e);else if(b.isSameTagIgnoreNS(e,"supportedInterpolations"))f.supportedInterpolations=R(e,"1.0.0");else if(b.isSameTagIgnoreNS(e,"lonLatEnvelope")){var l=b.getElements(e,"pos");e=b.getSpaceDelimitedNumericValues(l[0]);l=b.getSpaceDelimitedNumericValues(l[1]);e=new z({xmin:e[0],ymin:e[1],xmax:l[0],ymax:l[1],spatialReference:{wkid:4326}});
f.lonLatEnvelope=e}else if(b.isSameTagIgnoreNS(e,"rangeSet")){g=[];l=b.getElements(e,"RangeSet");e=[];for(var n=0;n<l.length;n++){var p=b.getElementValue(l[n],"name"),q=b.getElementValue(l[n],"label"),r=[],t=M(l[n],"nullValues/singleValue");const x=b.getElements(l[n],"AxisDescription");for(let v=0;v<x.length;v++){const F=b.getElementValue(x[v],"name"),O=b.getElementValue(x[v],"label"),A=b.getElementValues(x[v],"singleValue");if(0===A.length){var y=b.getElementValue(x[v],"min");const C=b.getElementValue(x[v],
"max"),P=Number(b.getElementValue(x[v],"res"))||1;if(null!==y&&null!==C)for(y=parseInt(y,10);y<=parseInt(C,10);y+=P)A.push(y.toString())}"band"===F.toLowerCase()&&(e=A);r.push({name:F,label:O,values:A})}g.push({name:p,label:q,nullValues:t,axis:r})}l=g;g=e;f.rangeSet=l;e=l[0].nullValues;e?.length&&(m=N(e))}else b.isSameTagIgnoreNS(e,"domainSet")&&(l=b.getElement(e,"spatialDomain"),n=b.getElement(l,"Envelope")||b.getElement(l,"EnvelopeWithTimePeriod"),p=n.getAttribute("srsName").split(":"),p=p[p.length-
1],q=b.getElements(n,"pos"),n=b.getSpaceDelimitedNumericValues(q[0]),q=b.getSpaceDelimitedNumericValues(q[1]),p=parseInt(p,10),p=isNaN(p)?null:{wkid:p},n=new z({xmin:n[0],ymin:n[1],xmax:q[0],ymax:q[1],spatialReference:p}),p=b.getElement(l,"RectifiedGrid"),q=b.getElementValue(p,"low").split(" "),r=b.getElementValue(p,"high").split(" "),p=parseInt(r[0],10)-parseInt(q[0],10)+1,q=parseInt(r[1],10)-parseInt(q[1],10)+1,r=b.getSpaceDelimitedNumericValues(l,"origin/pos"),t=b.getElements(l,"offsetVector"),
l=parseFloat(b.getElementValue(t[0]).split(" ")[0]),t=parseFloat(b.getElementValue(t[1]).split(" ")[1]),l={envelope:n,columns:p,rows:q,offset:{x:l,y:t},origin:{x:r[0],y:r[1]}},e=(e=b.getElement(e,"temporalDomain")||b.getElement(e,"TemporalDomain"))?E(e):null,f.domainSet={spatialDomain:l,temporalDomain:e})}k=L(f.supportedInterpolations);const {name:Q,description:w,label:G,lonLatEnvelope:H,supportedFormats:u}=f;({spatialDomain:h}=f.domainSet);e={x:Math.abs(h.offset.x),y:Math.abs(h.offset.y)};l=ba(f.domainSet);
m=new J({width:h.columns,height:h.rows,pixelSize:e,pixelType:"unknown",extent:h.envelope,spatialReference:h.envelope.spatialReference,bandCount:g.length||1,noDataValue:m,multidimensionalInfo:l});return{id:Q,title:f.name,description:w||G,lonLatEnvelope:H,rasterInfo:m,bandNames:g,supportedFormats:u,supportedInterpolations:k,coverageDescription:f,version:"1.0.0",useEPSGAxis:!1}});a=b.getElements(d,"CoverageDescription");return"1.1.0"===c||"1.1.1"===c||"1.1.2"===c?a.map(k=>{const f=[];var g=[];const m=
{supportedFormats:f,supportedCRSs:g,version:"1.1"};var h=[],e;for(var l=0;l<k.childNodes.length;l++){var n=k.childNodes[l];if(1===n.nodeType){var p=b.getNodeNameIgnoreNS(n).toLowerCase();switch(p){case "title":case "abstract":case "identifier":m[p]=b.getElementValue(n);break;case "supportedformat":p=b.getElementValue(n);f.includes(p)||f.push(p);break;case "supportedcrs":p=b.getElementValue(n);g.includes(p)||g.push(p);break;case "range":var q=void 0;h=!!m.domain?.temporalDomain;p=[];n=b.getElements(n,
"Field");let H=[];for(let u=0;u<n.length;u++){const x=b.getElementValue(n[u],"Identifier"),v=b.getElementValue(n[u],"Description"),F=b.getElementValue(n[u],"Definition"),O=b.getElementValue(n[u],"Abstract"),A=b.getElementValue(n[u],"Title"),C=M(n[u],"NullValue");var r=b.getElement(n[u],"AllowedValues");r=r?Z(r):null;const P=R(n[u],"1.1.0"),S=[],D=b.getElements(n[u],"Axis");for(let B=0;B<D.length;B++){const T=D[B].getAttribute("identifier"),la=b.getElementValue(D[B],"UOM"),ma=b.getElementValue(D[B],
"DataType"),U=b.getElementValues(D[B],"Key");if(!h||T.toLowerCase().includes("band"))H=U,q=C;S.push({identifier:T,uom:la,dataType:ma,values:U,bandNoDataValues:q})}p.push({identifier:x,description:v,definition:F,abstract:O,title:A,supportedInterpolations:P,axis:S,nullValues:C,statistics:r})}q={rangeSet:p,bandNames:H,bandNoDataValues:q,statistics:p[0].statistics};m.range=q.rangeSet;h=q.bandNames;({bandNoDataValues:p}=q);p?.length&&(e=N(p));q=q.statistics;break;case "domain":m.domain=da(n)}}}k=L(m.range[0].supportedInterpolations);
const {identifier:t,abstract:y,title:Q,domain:w,range:G}=m;g={x:Math.abs(w.spatialDomain.offset.x),y:Math.abs(w.spatialDomain.offset.y)};if(l=ca(G,w))e=G[0].nullValues,1===e?.length&&(e=e[0]);e=new J({width:w.spatialDomain.columns,height:w.spatialDomain.rows,pixelSize:g,pixelType:"unknown",extent:w.spatialDomain.envelope,spatialReference:w.spatialDomain.envelope.spatialReference,bandCount:h.length||1,noDataValue:e,statistics:q,multidimensionalInfo:l});return{id:t,title:m.title,description:y||Q,bandNames:h,
rasterInfo:e,supportedFormats:f,supportedInterpolations:k,coverageDescription:m,version:c,useEPSGAxis:w.spatialDomain.useEPSGAxis}}):a.map(k=>{const f={version:"2.0"};let g=[];let m;for(let t=0;t<k.childNodes.length;t++){var h=k.childNodes[t];if(1===h.nodeType)if(b.isSameTagIgnoreNS(h,"coverageId"))f.coverageId=b.getElementValue(h);else if(b.isSameTagIgnoreNS(h,"ServiceParameters"))f.serviceParameters={supportedFormats:b.getElementValues(h,"nativeFormat")};else if(b.isSameTagIgnoreNS(h,"boundedBy"))f.boundedBy=
ea(h);else if(b.isSameTagIgnoreNS(h,"rangeType")){h=fa(h,2<f.boundedBy?.axisLabels.length||2<f.domainSet?.axisLabels.length);f.rangeType=h.rangeType;g=h.bandNames;var e=h.bandStats;({bandNoDataValues:h}=h);h?.length&&(m=N(h))}else b.isSameTagIgnoreNS(h,"domainSet")?f.domainSet=ja(h,f.boundedBy?.axisLabels):b.isSameTagIgnoreNS(h,"metadata")&&(h=b.getElement(h,"EOMetadata"),f.eoMetadata=h?ka(h):null)}const {coverageId:l,boundedBy:n,domainSet:p,rangeType:q,serviceParameters:r}=f;k=ia(q,n,p);!e&&k&&(e=
k?.variables[0].statistics);null!=k&&(m=q[0][0].nilValue);e=new J({width:p.columns,height:p.rows,pixelSize:p.resolution,pixelType:"unknown",extent:n.envelope,spatialReference:n.envelope.spatialReference,bandCount:g.length||1,statistics:e,noDataValue:m,multidimensionalInfo:k});return{id:l,title:l,description:l,bandNames:g,rasterInfo:e,supportedFormats:r.supportedFormats,coverageDescription:f,version:"2.0.1",useEPSGAxis:!1}})};I.standardizeInterpolations=L;Object.defineProperty(I,Symbol.toStringTag,
{value:"Module"})});