// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.31/esri/copyright.txt for details.
//>>built
define(["exports","../PixelBlock","../SimpleBandStatistics","./pixelUtils"],function(C,I,M,F){function N(a){let {altitude:d,azimuth:b}=a;const {hillshadeType:k,pixelSizePower:m=1,pixelSizeFactor:u=1,scalingType:v,isGCS:h,resolution:r}=a;var l="multi-directional"===k?2*a.zFactor:a.zFactor;const {x:t,y:n}=r;a=l/(8*t);var p=l/(8*n);h&&.001<l&&(a/=E,p/=E);"adjusted"===v&&(h?(a=t*E,p=n*E,a=(l+a**m*u)/(8*a),p=(l+p**m*u)/(8*p)):(a=(l+t**m*u)/(8*t),p=(l+n**m*u)/(8*n)));var g=(90-d)*Math.PI/180;l=Math.cos(g);
let e=(360-b+90)*Math.PI/180,f=Math.sin(g)*Math.cos(e);g=Math.sin(g)*Math.sin(e);const w=[315,270,225,360,180,0],x=[60,60,60,60,60,90];var q=new Float32Array([3,5,3,2,1,4]);const z=q.reduce((y,H)=>y+H);q=q.map(y=>y/z);const B="multi-directional"===k?w.length:1,D=new Float32Array(6),A=new Float32Array(6),c=new Float32Array(6);if("multi-directional"===k)for(let y=0;y<B;y++)d=x[y],b=w[y],g=(90-d)*Math.PI/180,l=Math.cos(g),e=(360-b+90)*Math.PI/180,f=Math.sin(g)*Math.cos(e),g=Math.sin(g)*Math.sin(e),D[y]=
l,A[y]=f,c[y]=g;else D.fill(l),A.fill(f),c.fill(g);return{resolution:r,factor:[a,p],sinZcosA:f,sinZsinA:g,cosZ:l,sinZcosAs:A,sinZsinAs:c,cosZs:D,weights:q,hillshadeType:["traditional","multi-directional"].indexOf(k)}}function J(a,d){const {width:b,height:k}=a;var m=b*k;const u=new Uint8Array(m),v=null!=a.mask;let h;if(v){h=new Uint8Array(a.mask);for(var r=0;r<h.length;r++)h[r]&&(u[r]=1,h[r]=1)}a=a.pixels[0];r=new Float32Array(m);const l=new Float32Array(m);let t=0;if(d){({resolution:n}=d);var n=n?
(n.x+n.y)/2:1;t=200*d.zFactor/(n*n);n=new Float32Array(m)}d=d?.curvatureType;let p;let g;for(m=1;m<k-1;m++){const D=m*b;for(let A=1;A<b-1;A++){const c=D+A;if(!h||0!==h[c]){if(h){if(7>h[c-b-1]+h[c-b]+h[c-b+1]+h[c-1]+h[c+1]+h[c+b-1]+h[c+b]+h[c+b+1]){u[c]=0;continue}var e=h[c-b-1]?a[c-b-1]:a[c];var f=h[c-b]?a[c-b]:a[c];var w=h[c-b+1]?a[c-b+1]:a[c];var x=h[c-1]?a[c-1]:a[c];var q=h[c+1]?a[c+1]:a[c];p=h[c+b-1]?a[c+b-1]:a[c];var z=h[c+b]?a[c+b]:a[c];g=h[c+b+1]?a[c+b+1]:a[c]}else e=a[c-b-1],f=a[c-b],w=a[c-
b+1],x=a[c-1],q=a[c+1],p=a[c+b-1],z=a[c+b],g=a[c+b+1];r[c]=w+q+q+g-(e+x+x+p);l[c]=p+z+z+g-(e+f+f+w);if(null!=n){var B=a[c];const y=.5*(x+q)-B;B=.5*(f+z)-B;"standard"===d?n[c]=-t*(y+B):(e=(-e+w+p-g)/4,x=(-x+q)/2,f=(f-z)/2,z=x*x,q=f*f,(w=z+q)&&(n[c]="profile"===d?t*(y*z+B*q+e*x*f)/w:-t*(y*q+B*z-e*x*f)/w))}}}}return{outMask:v?u:null,dzxs:r,dzys:l,curvatures:n}}function K(a,d,b){for(var k=0;k<b;k++)a[k*d]=a[k*d+1],a[(k+1)*d-1]=a[(k+1)*d-2];for(k=1;k<d-1;k++)a[k]=a[k+d],a[k+(b-1)*d]=a[k+(b-2)*d]}const E=
1/111E3;C.aspect=function(a,d={}){if(!F.isValidPixelBlock(a))return a;var {resolution:b}=d;d=b?1/b.x:1;b=b?1/b.y:1;const {dzxs:k,dzys:m,outMask:u}=J(a),{width:v,height:h}=a,r=new Float32Array(v*h);for(let t=1;t<h-1;t++){const n=t*v;for(let p=1;p<v-1;p++){var l=n+p;if(!u||u[l]){const g=k[l]*d;l=m[l]*b;let e=-1;if(0!==g||0!==l)e=90-57.29578*Math.atan2(l,-g),0>e&&(e+=360),360===e?e=0:360<e&&(e%=360);r[n+p]=e}}}K(r,v,h);return new I({width:v,height:h,pixels:[r],mask:u,pixelType:"f32",validPixelCount:a.validPixelCount,
statistics:[new M.SimpleBandStatistics(-1,360)]})};C.calculateHillshadeParams=N;C.curvature=function(a,d){if(!F.isValidPixelBlock(a))return a;const {curvatures:b,outMask:k}=J(a,d),{width:m,height:u}=a;K(b,m,u);a=new I({width:m,height:u,pixels:[b],mask:k,pixelType:"f32",validPixelCount:a.validPixelCount});a.updateStatistics();return a};C.gcsFactor=E;C.getHillshadeOptions=function(a,d,b){const {hillshadeType:k,altitude:m,azimuth:u,zFactor:v,pixelSizeFactor:h,pixelSizePower:r,slopeType:l}=a;return{hillshadeType:k,
altitude:m,azimuth:u,zFactor:v,pixelSizePower:r,pixelSizeFactor:h,scalingType:"scaled"===l?"adjusted":"none",resolution:d,isGCS:b}};C.hillshade=function(a,d){if(!F.isValidPixelBlock(a))return a;const {factor:b,sinZcosA:k,sinZsinA:m,cosZ:u,sinZcosAs:v,sinZsinAs:h,cosZs:r,weights:l}=N(d),[t,n]=b;d="traditional"===d.hillshadeType;const {width:p,height:g}=a,e=new Uint8Array(p*g),{dzxs:f,dzys:w,outMask:x}=J(a);for(let z=1;z<g-1;z++){const B=z*p;for(let D=1;D<p-1;D++){const A=B+D;if(!x||x[A]){var q=f[A]*
t;const c=w[A]*n,y=Math.sqrt(1+q*q+c*c);let H=0;if(d)q=255*(u+m*c-k*q)/y,0>q&&(q=0),H=q;else{const O=h.length;for(let G=0;G<O;G++){let L=255*(r[G]+h[G]*c-v[G]*q)/y;0>L&&(L=0);H+=L*l[G]}}e[A]=H&255}}}K(e,p,g);return new I({width:p,height:g,pixels:[e],mask:x,pixelType:"u8",validPixelCount:a.validPixelCount,statistics:[new M.SimpleBandStatistics(0,255)]})};C.slope=function(a,d){if(!F.isValidPixelBlock(a))return a;var b=d.zFactor,k=d.pixelSizePower??1,m=d.pixelSizeFactor??1;const u=d.slopeType;var v=
d.isGCS;const {x:h,y:r}=d.resolution;d=b/(8*h);let l=b/(8*r);v&&1E-4>Math.abs(b-1)&&(d/=E,l/=E);"adjusted"===u&&(d=(b+h**k*m)/(8*h),l=(b+r**k*m)/(8*r));const {dzxs:t,dzys:n,outMask:p}=J(a),{width:g,height:e}=a;b=new Float32Array(g*e);for(k=1;k<e-1;k++)for(m=k*g,v=1;v<g-1;v++){var f=m+v;if(!p||p[f]){var w=t[f]*d;f=n[f]*l;w=Math.sqrt(w*w+f*f);b[m+v]="percent-rise"===u?100*w:57.2957795*Math.atan(w)}}K(b,g,e);a=new I({width:g,height:e,pixels:[b],mask:p,pixelType:"f32",validPixelCount:a.validPixelCount});
a.updateStatistics();return a};C.tintHillshade=function(a,d,b,k){if(F.isValidPixelBlock(a)&&F.isValidPixelBlock(d)){var {min:m,max:u}=k;k=a.pixels[0];var {pixels:v,mask:h}=d;d=v[0];var r=255.00001/(u-m),l=new Uint8ClampedArray(d.length),t=new Uint8ClampedArray(d.length),n=new Uint8ClampedArray(d.length),p=b.length-1;for(let f=0;f<d.length;f++){if(h&&0===h[f])continue;var g=Math.floor((d[f]-m)*r);const [w,x]=b[0>g?0:g>p?p:g];var e=k[f];g=e*x;const q=g*(1-Math.abs(w%2-1));e-=g;switch(Math.floor(w)){case 0:l[f]=
g+e;t[f]=q+e;n[f]=e;break;case 1:l[f]=q+e;t[f]=g+e;n[f]=e;break;case 2:l[f]=e;t[f]=g+e;n[f]=q+e;break;case 3:l[f]=e;t[f]=q+e;n[f]=g+e;break;case 4:l[f]=q+e;t[f]=e;n[f]=g+e;break;case 5:case 6:l[f]=g+e,t[f]=e,n[f]=q+e}}a.pixels=[l,t,n];a.updateStatistics()}};Object.defineProperty(C,Symbol.toStringTag,{value:"Module"})});