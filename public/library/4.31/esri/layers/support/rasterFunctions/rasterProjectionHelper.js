// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.31/esri/copyright.txt for details.
//>>built
define("require exports ../../../geometry ../../../core/arrayUtils ../../../core/Error ../../../core/unitUtils ../../../chunks/pe ../../../geometry/projection ../../../geometry/support/spatialReferenceUtils ../../../geometry/Extent ../../../geometry/Polygon ../../../geometry/Point ../../../geometry/SpatialReference".split(" "),function(sa,y,Fa,ta,ca,H,x,A,ua,J,Q,E,da){function R(a,b,c){return!A.canProjectWithoutEngine(a,b,c)}function G(a,b,c){if((a=R(a,b,c))&&!A.isLoaded())throw new ca("rasterprojectionhelper-project",
"projection engine is not loaded");return a}function ea(a,b,c){G(a.spatialReference,b);return c?A.getTransformation(b,a.spatialReference,a):A.getTransformation(a.spatialReference,b,a)}function N(a,b,c){b=H.getMetersPerUnitForSR(b)/H.getMetersPerUnitForSR(c);return{x:a.x*b,y:a.y*b}}function S(a,b,c){const {spatialReference:d}=c;if(!d||!b||d.equals(b))return a;if(d.isGeographic&&b.isGeographic)return N(a,d,b);G(d,b);if(!O)throw new ca("raster-projection-helper:project-dataset-resolution","geometry engine is not loaded");
let {x:h,y:f}=a;var g=H.getMetersPerUnitForSR(d),k=(h+f)/2*g;g=1;30<k&&(g=30/k,h*=g,f*=g);k=256*h/2;var e=256*f/2;const {x:m,y:l}=c.center;c=[];for(var n=0;256>=n;n++)c.push([m-k,l-e+n*f]);for(n=1;256>=n;n++)c.push([m-k+n*h,l+e]);for(n=1;256>=n;n++)c.push([m+k,l+e-n*f]);for(n=1;256>n;n++)c.push([m+k-n*h,l-e]);c.push(c[0]);k=new Q({rings:[c],spatialReference:d});e=A.project(k,b);if(!e)return N(a,d,b);k=e.extent;c=D(b);if(null==k||null!=c&&k.width>=c)return N(a,d,b);a=O.planarArea(e);a=Math.sqrt(a/
(h*f*65536))/g;g={x:k.width/g/256,y:k.height/g/256};a={x:h*a,y:f*a};b=g.x*g.y;return.1>Math.abs(b-a.x*a.y)/b?g:a}function B(a,b=.01){return H.getMetersPerUnitForSR(a)?b/H.getMetersPerUnitForSR(a):0}function T(a,b,c=null,d=!0){const h=a.spatialReference;if(h.equals(b))return a;G(h,b,c);c=A.project(a,b,c);if(!d||!c)return c;fa([a],[c],h,b);return c}function fa(a,b,c,d){const h=P(c,!0),f=P(d,!0);c=B(c,500);d=B(d,500);if(c&&null!=h&&null!=f)for(let g=0;g<a.length;g++){const k=b[g];if(!k)continue;const {x:e}=
a[g],{x:m}=k;m>=f[1]-d&&Math.abs(e-h[0])<c?k.x-=f[1]-f[0]:m<=f[0]+d&&Math.abs(e-h[1])<c&&(k.x+=f[1]-f[0])}}function ha(a){const {inSR:b,outSR:c,datumTransformation:d,preferPE:h}=a;if(b.equals(c))return{points:a}=U(a,null),a;if(b.isWebMercator&&c.isWGS84||b.isWGS84&&c.isWebMercator){const {cols:e,rows:m,xres:l,yres:n,usePixelCenter:q,inSR:p,outSR:t}=a;let {xmin:u,ymax:v}=a;q&&(u+=l/2,v-=n/2);a=[];const r=[];var f=Math.max(e,m);for(var g=0;g<f;g++){var k=A.project(new E({x:u+l*Math.min(e,g),y:v-n*Math.min(m,
g),spatialReference:p}),t);g<=e&&a.push(k.x);g<=m&&r.push(k.y)}f=[];for(g=0;g<e;g++)for(k=0;k<m;k++)f.push([a[g],r[k]]);return f}return G(b,c,d)&&h&&(b.isGeographic||null!=I(b))?va(a):wa(a)}function wa(a){var {points:b}=U(a,null);const {inSR:c,outSR:d,datumTransformation:h}=a;a=b.map(f=>new E(f[0],f[1],c));b=A.project(a,d,h);h&&fa(a,b,c,d);return b.map(f=>f?[f.x,f.y]:[NaN,NaN])}function va(a){const {inSR:b,outSR:c,datumTransformation:d}=a;var h=I(b);const {points:f,mask:g}=U(a,h);b.isGeographic||
(a=b.wkid?x.PeFactory.coordsys(b.wkid):x.PeFactory.fromString(b.isGeographic?x.PeDefs.PE_TYPE_GEOGCS:x.PeDefs.PE_TYPE_PROJCS,b.wkt2||b.wkt),x.PeCSTransformations.projToGeog(a,f.length,f));if(null!=d&&d.steps.length){var k;c.isGeographic&&(k=f.map(([e])=>179.9955<e?1:-179.9955>e?-1:0));d.steps.forEach(e=>{const m=e.wkid?x.PeFactory.geogtran(e.wkid):x.PeFactory.fromString(x.PeDefs.PE_TYPE_GEOGTRAN,e.wkt);x.PeGTTransformations.geogToGeog(m,f.length,f,null,e.isInverse?x.PeDefs.PE_TRANSFORM_2_TO_1:x.PeDefs.PE_TRANSFORM_1_TO_2)});
if(k)for(a=0;a<f.length;a++){h=k[a];const e=f[a][0],m=179.9955<e?1:-179.9955>e?-1:0;h&&m&&h!==m&&(f[a][0]=0<h?e+360:e-360)}}c.isGeographic||(k=I(c,!0),xa(f,null!=k&&k.isEnvelope?[k.bbox[1],k.bbox[3]]:[-90,90]),k=c.wkid?x.PeFactory.coordsys(c.wkid):x.PeFactory.fromString(c.isGeographic?x.PeDefs.PE_TYPE_GEOGCS:x.PeDefs.PE_TYPE_PROJCS,c.wkt2||c.wkt),x.PeCSTransformations.geogToProj(k,f.length,f));k=f;if(g&&f.length!==g.length){k=[];for(let e=0,m=0;e<g.length;e++)g[e]?k.push(f[m++]):k.push([NaN,NaN])}return k}
function I(a,b=!1){var c=a.wkid||a.wkt2||a.wkt;if(!c||a.isGeographic)return null;c=String(c);if(V.has(c))return c=V.get(c),b?c?.gcs:c?.pcs;var d=a.wkid?x.PeFactory.coordsys(a.wkid):x.PeFactory.fromString(a.isGeographic?x.PeDefs.PE_TYPE_GEOGCS:x.PeDefs.PE_TYPE_PROJCS,a.wkt2||a.wkt);a=B(a,1E-4);a=ia(d,a);d=ia(d,0,!0);V.set(c,{pcs:a,gcs:d});return b?d:a}function ia(a,b=0,c=!1){var d=x.PePCSInfo.generate(a),h=c?a.horizonGcsGenerate():a.horizonPcsGenerate();if(!d||!h?.length)return null;a=!1;var f=h.find(l=>
1===l.getInclusive()&&1===l.getKind());if(!f){f=h.find(l=>1===l.getInclusive()&&0===l.getKind());if(!f)return null;a=!0}c=c?0:(2===d.getNorthPoleLocation()?1:0)|(2===d.getSouthPoleLocation()?2:0);d=d.isPannableRectangle();f=f.getCoord();if(a)return{isEnvelope:a,isPannable:d,vertices:f,coef:null,bbox:[f[0][0]-b,f[0][1]-b,f[1][0]+b,f[1][1]+b],poleLocation:c};b=0;a=[];let [g,k]=f[0],[e,m]=f[0];for(let l=0,n=f.length;l<n;l++){b++;b===n&&(b=0);const [q,p]=f[l],[t,u]=f[b];if(u===p)a.push([q,t,p,u,2]);else{h=
(t-q)/(u-p||1E-4);const v=q-h*p;p<u?a.push([h,v,p,u,0]):a.push([h,v,u,p,1])}g=g<q?g:q;k=k<p?k:p;e=e>q?e:q;m=m>p?m:p}return{isEnvelope:!1,isPannable:d,vertices:f,coef:a,bbox:[g,k,e,m],poleLocation:c}}function U(a,b){const c=[],{cols:d,rows:h,xres:f,yres:g,usePixelCenter:k}=a;let {xmin:e,ymax:m}=a;k&&(e+=f/2,m-=g/2);if(null==b){for(a=0;a<d;a++)for(b=0;b<h;b++)c.push([e+f*a,m-g*b]);return{points:c}}a=new Uint8Array(d*h);if(b.isEnvelope){const {bbox:[v,r,z,C]}=b;for(let F=0,K=0;F<d;F++){var l=e+f*F,n=
b.isPannable||l>=v&&l<=z;for(var q=0;q<h;q++,K++){var p=m-g*q;n&&p>=r&&p<=C&&(c.push([l,p]),a[K]=1)}}return{points:c,mask:a}}l=b.coef;b=[];for(n=0;n<h;n++){var t=m-g*n;q=[];p=[];for(var u=0;u<l.length;u++){const [v,r,z,C,F]=l[u];t===z&&z===C?(q.push(v),q.push(r),p.push(2),p.push(2)):t>=z&&t<=C&&(q.push(v*t+r),p.push(F))}t=q;if(2<q.length){u=2===p[0]?0:p[0];let v=q[0];t=[];for(let r=1;r<p.length;r++)if(2!==p[r]||r===p.length-1)p[r]!==u&&(t.push(0===u?Math.min(v,q[r-1]):Math.max(v,q[r-1])),u=p[r],v=
q[r]),r===p.length-1&&t.push(0===p[r]?Math.min(v,q[r]):Math.max(v,q[r]));t.sort((r,z)=>r-z)}else q[0]>q[1]&&(t=[q[1],q[0]]);b.push(t)}for(let v=0,r=0;v<d;v++)for(l=e+f*v,n=0;n<h;n++,r++)if(q=m-g*n,p=b[n],2===p.length)l>=p[0]&&l<=p[1]&&(c.push([l,q]),a[r]=1);else if(2<p.length){t=!1;for(u=0;u<p.length;u+=2)if(l>=p[u]&&l<=p[u+1]){t=!0;break}t&&(c.push([l,q]),a[r]=1)}return{points:c,mask:a}}function xa(a,b){const [c,d]=b;for(b=0;b<a.length;b++){const h=a[b][1];if(h<c||h>d)a[b]=[NaN,NaN]}}function ja(a,
b){const c=D(a[0].spatialReference);if(2>a.length||null==c)return a[0];b=b??B(a[0].spatialReference);a=a.filter(k=>k.width>b);if(1===a.length)return a[0];let {xmin:d,xmax:h,ymin:f,ymax:g}=a[0];for(let k=1;k<a.length;k++){const e=a[k];h=e.xmax+c*k;f=Math.min(f,e.ymin);g=Math.max(g,e.ymax)}return new J({xmin:d,xmax:h,ymin:f,ymax:g,spatialReference:a[0].spatialReference})}function W(a,b,c=null,d=!0){var h=a.spatialReference;if(h.equals(b))return a;var f=X(a);const g=D(h,!0);var k=D(b);if(0===f||null==
g||null==k)return f=ka(a,b,c,d),null==g&&null!=k&&Math.abs(f.width-k)<B(b)&&A.isLoaded()&&(h=I(h),null!=h&&h.poleLocation===la.None&&a.width<(h.bbox[2]-h.bbox[0])/2)?ya(a,b)||f:f;k=a.clone().normalize();if(1===k.length&&a.xmax<g&&a.xmax-g/2>B(h)){const {xmin:e,xmax:m}=a;for(let l=0;l<=f;l++)k[l]=new J({xmin:0===l?e:-g/2,xmax:l===f?m-g*l:g/2,ymin:a.ymin,ymax:a.ymax,spatialReference:h})}a=k.map(e=>ka(e,b,c,d));return ja(a.filter(ta.isSome))}function ya(a,b){const c=D(b);if(null==c)return null;let {xmin:d,
ymin:h,xmax:f,ymax:g}=a;var k=a.spatialReference;a=new Q({spatialReference:k,rings:[[[d,h],[f,h],[f,g],[d,g],[d,h]]]});a=A.project(a,b);if(2!==a.rings.length||!a.rings[0].length||!a.rings[1].length)return null;({rings:a}=a);k=B(k);b=new J({spatialReference:b});for(let e=0;2>e;e++){d=f=a[e][0][0];h=g=a[e][0][1];for(let m=0;m<a[e].length;m++)d=d>a[e][m][0]?a[e][m][0]:d,f=f<a[e][m][0]?a[e][m][0]:f,h=h>a[e][m][1]?a[e][m][1]:h,g=g<a[e][m][1]?a[e][m][1]:g;if(0===e)b.ymin=h,b.ymax=g,b.xmin=d,b.xmax=f;else if(b.ymin=
Math.min(b.ymin,h),b.ymax=Math.max(b.ymax,g),Math.abs(f-c/2)<k)b.xmin=d,b.xmax+=c;else if(Math.abs(d+c/2)<k)b.xmax=f+c;else return null}return b}function ka(a,b,c=null,d=!0,h=!0){const f=a.spatialReference;if(f.equals(b)||!b)return a;G(f,b,c);const g=A.project(a,b,c);if(h&&b.isWebMercator&&g&&(g.ymax=Math.min(2.0037508342787E7,g.ymax),g.ymin=Math.max(-2.0037508342787E7,g.ymin),g.ymin>=g.ymax))return null;if(!d||!g)return g;var k=P(f,!0);d=P(b,!0);if(null==k||null==d)return g;h=B(f,.001);const e=B(f,
500);var m=B(b,.001);if(Math.abs(g.xmin-d[0])<m&&Math.abs(g.xmax-d[1])<m){m=Math.abs(a.xmin-k[0]);k=Math.abs(k[1]-a.xmax);if(m<h&&k>e){g.xmin=d[0];var l=[];l.push(new E(a.xmax,a.ymin,f));l.push(new E(a.xmax,(a.ymin+a.ymax)/2,f));l.push(new E(a.xmax,a.ymax,f));l=l.map(n=>T(n,b,c)).filter(n=>!isNaN(n?.x)).map(n=>n.x);g.xmax=Math.max.apply(null,l)}k<h&&m>e&&(g.xmax=d[1],d=[],d.push(new E(a.xmin,a.ymin,f)),d.push(new E(a.xmin,(a.ymin+a.ymax)/2,f)),d.push(new E(a.xmin,a.ymax,f)),a=d.map(n=>T(n,b,c)).filter(n=>
!isNaN(n?.x)).map(n=>n.x),g.xmin=Math.min.apply(null,a))}else a=B(b,.001),Math.abs(g.xmin-d[0])<a&&(g.xmin=d[0]),Math.abs(g.xmax-d[1])<a&&(g.xmax=d[1]);return g}function D(a,b=!1){return a?a.isWebMercator?2*(b?2.0037508342787E7:2.0037508342788905E7):a.wkid&&a.isGeographic?360:2*za[a.wkid]||null:null}function P(a,b=!1){if(a.isGeographic)return[-180,180];a=D(a,b);return null!=a?[-a/2,a/2]:null}function ma(a,b,c,d){a=(a-b)/c;0!==a-Math.floor(a)?a=Math.floor(a):d&&--a;return a}function X(a,b=!1){var c=
D(a.spatialReference);if(null==c)return 0;const d=b?0:-(c/2),h=B(a.spatialReference),f=!b&&Math.abs(a.xmin+c/2)<h?-c/2:a.xmin;a=ma(!b&&Math.abs(a.xmax-c/2)<h?c/2:a.xmax,d,c,!0);c=ma(f,d,c,!1);return a-c}function Y(a){const {projectedExtent:b,srcBufferExtent:c,pixelSize:d,datumTransformation:h,rasterTransform:f}=a;var g=b.spatialReference;const k=c.spatialReference;var e=G(g,k);const {xmin:m,ymin:l,xmax:n,ymax:q}=b,p=D(k),t=null!=p&&(a.hasWrapAround||"gcs-shift"===f?.type);a=a.spacing||[32,32];var u=
a[0]*d.x,v=a[1]*d.y;const r=1===a[0],z=Math.ceil((n-m)/u-.1/a[0])+(r?0:1),C=Math.ceil((q-l)/v-.1/a[1])+(r?0:1);u=ha({cols:z,rows:C,xmin:m,ymax:q,xres:u,yres:v,inSR:g,outSR:k,datumTransformation:h,preferPE:4>=a[0],usePixelCenter:r});v=[];let F,K=0;const na=r?-1:NaN,{xmin:oa,xmax:Z,ymax:Aa,width:Ba,height:Ca}=c,Da=B(k,500),Ea=null!=p&&0<oa&&Z>p/2;var L=!1;e&&(L=I(g),L=null!=L&&0<L.poleLocation);for(g=0;g<z;g++){e=[];for(let M=0;M<C;M++){var w=u[g*C+M];t&&w[0]>Z&&w[0]>p/2-Da?w[0]-=p:t&&0===g&&0>w[0]&&
Ea&&!f&&(w[0]+=p);!w||isNaN(w[0])||isNaN(w[1])?(v.push(na),v.push(na),e.push(null),K++):(f&&(w=f.inverseTransform(new E({x:w[0],y:w[1],spatialReference:k})),w=[w.x,w.y]),e.push(w),0<g&&t&&F[M]&&w[0]<F[M][0]&&(w[0]+=p,L&&w[0]>Z&&w[0]>p&&(w[0]-=p)),v.push((w[0]-oa)/Ba),v.push((Aa-w[1])/Ca))}F=e}return{offsets:v,error:null,coefficients:null,outofBoundPointCount:K,spacing:a,size:r?[z,C]:[z-1,C-1]}}function pa(a,b,c){const {cols:d,rows:h}=b;b=new Float32Array((d-1)*(h-1)*12);const f=new Float32Array([-0,
-1,1,-1,1,-0,1,-0,-0]),g=new Float32Array([-1,1,0,0,-1,1,1,0,0]);for(let q=0;q<d-1;q++){for(var k=0;k<h-1;k++){var e=q*h*2+2*k,m=a[e];const p=a[e+1];var l=a[e+2],n=a[e+3];e+=2*h;const t=a[e],u=a[e+1],v=a[e+2];e=a[e+3];let r=0,z=12*(k*(d-1)+q);for(let C=0;3>C;C++)b[z++]=f[r++]*m+f[r++]*l+f[r++]*v;r=0;for(l=0;3>l;l++)b[z++]=f[r++]*p+f[r++]*n+f[r++]*e;r=0;for(n=0;3>n;n++)b[z++]=g[r++]*m+g[r++]*t+g[r++]*v;r=0;for(m=0;3>m;m++)b[z++]=g[r++]*p+g[r++]*u+g[r++]*e}if(c)for(k=0;k<b.length;k++)isNaN(b[k])&&(b[k]=
-1)}return b}function qa(a,b){a=a.clone().normalize();return 1===a.length?a[0]:ja(a,b)}function aa(a,b){const {pixelSize:c,extent:d}=a;a=ea(d,b,!1);const h=qa(d,(c.x+c.y)/16);return W(h,b,a)}var la;(function(a){a[a.None=0]="None";a[a.North=1]="North";a[a.South=2]="South";a[a.Both=3]="Both"})(la||={});const ra=(a,b,c,d=0)=>{if(1===c[0])return[0,0];var h=1,f=-1,g=1,k=-1;for(var e=0;e<a.length;e+=2)isNaN(a[e])||(h=h>a[e]?a[e]:h,f=f>a[e]?f:a[e],g=g>a[e+1]?a[e+1]:g,k=k>a[e+1]?k:a[e+1]);const {cols:m,rows:l}=
b;b=(f-h)/m/c[0];c=(k-g)/l/c[1];d*=2;g=0;k=!1;h=[0,0];for(f=0;f<m-3;f++){for(e=0;e<l-3;e++){var n=f*l*2+2*e;const q=Math.abs(((a[n]+a[n+4]+a[n+4*l]+a[n+4*l+4])/4-a[n+2*l+2])/b);n=Math.abs(((a[n+1]+a[n+5]+a[n+4*l+1]+a[n+4*l+5])/4-a[n+2*l+3])/c);q+n>g&&(g=q+n,h=[q,n]);if(d&&g>d){k=!0;break}}if(k)break}return h},za={3395:2.0037508342789244E7,3410:1.7334193943686873E7,3857:2.0037508342788905E7,3975:1.7367530445161372E7,4087:2.0037508342789244E7,4088:2.0015108787169147E7,6933:1.7367530445161372E7,32662:2.0037508342789244E7,
53001:2.001508679602057E7,53002:1.000754339801029E7,53003:2.001508679602057E7,53004:2.001508679602057E7,53016:1.4152803599503474E7,53017:1.7333573624304302E7,53034:2.001508679602057E7,53079:2.0015114352186374E7,53080:2.0015114352186374E7,54001:2.0037508342789244E7,54002:1.0018754171394624E7,54003:2.0037508342789244E7,54004:2.0037508342789244E7,54016:1.4168658027268292E7,54017:1.736753044516137E7,54034:2.0037508342789244E7,54079:2.0037508342789244E7,54080:2.0037508342789244E7,54100:2.0037508342789244E7,
54101:2.0037508342789244E7},V=new Map,ba=new Map;let O=null;y.computeProjectedScales=function(a,b,c){var d=c?.tileSize??512,h=c?.alignGlobalDatasetWithAGOL??!0,f=!!c?.limitToSrcResolution;const {extent:g,spatialReference:k,pixelSize:e}=a;c=S(e,b,g);if(null==c)return{projectedPixelSize:null,scales:null,srcResolutions:null,isCustomTilingScheme:!1};const m=(c.x+c.y)/2,l=H.getMetersPerUnitForSR(b);var n=m*l*96*39.37,q=b.isGeographic?256/d*2.958287637958547E8:256/d*5.91657527591555E8,p="vector-magdir"===
a.dataType||"vector-uv"===a.dataType,t=aa(a,b),u=Math.min(Math.ceil(Math.log(Math.min(a.width,a.height)/32)/Math.LN2),Math.ceil(Math.log(q/2/n)/Math.LN2));if(!p&&h&&(b.isGeographic||b.isWebMercator)&&(h=D(b),p=0<X(t)||null!=h&&t.width>h/4,!p&&null!=h)){p=-1;if(3>u)p=2**u*m*d;else if(a.storageInfo){const {maximumPyramidLevel:v=0,pyramidScalingFactor:r=2}=a.storageInfo;p=r**v*m*d}d=Math.ceil(h/p);p=1===d||2===d&&h/2-t.xmax<p}d=n;t=Math.min(2,Math.max(1.414,a.storageInfo?.pyramidScalingFactor||2));if(p)d=
q,q=b.isGeographic?1.341104507446289E-6:.29858214164761665,u=96*q*l*39.37,a=aa(a,new da({wkid:b.isGeographic?4326:3857})),a=S({x:q,y:q},k,a),a.x*=d/u,a.y*=d/u;else{a={x:e.x,y:e.y};for(b=0;d<.5005*q&&b<u;)b++,d*=t,a.x*=t,a.y*=t;1.001>=Math.max(d,q)/Math.min(d,q)&&(d=q)}b=[d];q=[{x:a.x,y:a.y}];for(n=Math.min(70.5310735,n)/1.001;d>=n;)d/=t,a.x/=t,a.y/=t,b.push(d),q.push({x:a.x,y:a.y});if(f){const v=.001*e.x;f=q.findIndex(r=>r.x>=e.x-v&&r.x<=e.x+v);-1<f?(q.length=f+1,b.length=f+1):(f=q.findIndex(r=>r.x<=
e.x+v),0<f&&(q.length=f,b.length=f))}return{projectedPixelSize:c,scales:b,srcResolutions:q,isCustomTilingScheme:!p}};y.defaultGridSpacing=32;y.defaultProjectionToleranceInPixels=4;y.getDefaultDatumTransformationForDataset=ea;y.getProjectedGridPoints=ha;y.getProjectionOffsetGrid=function(a){var b=a.isAdaptive&&null==a.spacing;let c=a.spacing||[32,32],d=Y(a);var h={cols:d.size[0]+1,rows:d.size[1]+1};const f=0<d.outofBoundPointCount&&d.outofBoundPointCount<d.offsets.length/2;let g=d.outofBoundPointCount===
d.offsets.length/2||b&&f?[0,0]:ra(d.offsets,h,c,4);const k=(g[0]+g[1])/2;var e=a.projectedExtent.spatialReference;const m=a.srcBufferExtent.spatialReference;b&&(f||4<k)&&(R(e,m,a.datumTransformation)&&(e.isGeographic||null!=I(e)),c=[4,4],d=Y({...a,spacing:c}),h={cols:d.size[0]+1,rows:d.size[1]+1},g=ra(d.offsets,h,c,4));d.error=g;1<c[0]&&(d.coefficients=pa(d.offsets,h,f));!a.includeGCSGrid||e.isGeographic||e.isWebMercator||(m.isGeographic?d.gcsGrid={offsets:d.offsets,coefficients:d.coefficients,spacing:c}:
(b=I(e),null==b||b.isEnvelope||(e&&!e.isGeographic&&(b=String(e.wkid||e.wkt2||e.wkt),ba.has(b)?e=ba.get(b):(e=(e.wkid?x.PeFactory.coordsys(e.wkid):x.PeFactory.fromString(x.PeDefs.PE_TYPE_PROJCS,e.wkt2||e.wkt)).getGeogcs().getCode(),ba.set(b,e)),e=new da({wkid:e})),e=W(a.projectedExtent,e),{offsets:a}=Y({...a,srcBufferExtent:e,spacing:c}),h=pa(a,h,f),d.gcsGrid={offsets:a,coefficients:h,spacing:c})));return d};y.getRasterDatasetAlignmentInfo=function(a){const b=a.storageInfo.origin.x;var c=D(a.spatialReference,
!0);if(null==c)return{originX:b,halfWorldWidth:null,pyramidsInfo:null};const d=c/2,{nativePixelSize:h,storageInfo:f,extent:g}=a,{maximumPyramidLevel:k,blockWidth:e,pyramidScalingFactor:m}=f;let l=h.x;const n=[];a=null!=a.transform&&"gcs-shift"===a.transform.type;const q=b+(a?0:d);c=a?c-b:d-b;for(let p=0;p<=k;p++){const t=(g.xmax-b)/l/e,u=c/l/e;n.push({resolutionX:l,blockWidth:e,datasetColumnCount:0===t-Math.floor(t)?t:Math.ceil(t),worldColumnCountFromOrigin:0===u-Math.floor(u)?u:Math.ceil(u),leftMargin:Math.round(q/
l)%e,rightPadding:(e-Math.round(c/l)%e)%e,originColumnOffset:Math.floor(q/l/e)});l*=m}return{originX:b,halfWorldWidth:d,pyramidsInfo:n,hasGCSSShiftTransform:a}};y.getWorldWidth=D;y.getWorldWrapCount=X;y.load=async function(){O&&A.isLoaded()||(A.isLoaded()||await A.load(),O=await new Promise((a,b)=>sa(["../../../geometry/geometryEngine"],a,b)))};y.minimumGridSpacing=4;y.projectDatasetExtent=aa;y.projectDatasetResolution=S;y.projectExtent=W;y.projectPoint=T;y.projectPolygon=function(a,b,c){if("extent"===
a.type){const {xmin:d,ymin:h,xmax:f,ymax:g,spatialReference:k}=a;a=new Q({rings:[[[d,g],[f,g],[f,h],[d,h],[d,g]]],spatialReference:k})}if(a.spatialReference.equals(b))return a;G(a.spatialReference,b,c);return A.project(a,b,c)};y.projectResolution=function(a,b,c,d=null){const h=a.spatialReference;if(!h||!b||h.equals(b))return a;G(h,b,d);c=c.center;c=new J({xmin:c.x-a.x/2,xmax:c.x+a.x/2,ymin:c.y-a.y/2,ymax:c.y+a.y/2,spatialReference:h});d=A.project(c,b,d);c=D(b);return null==d||null!=c&&d.width>=c?
N(a,h,b):{x:d.width,y:d.height}};y.requirePE=R;y.shiftExtent=function(a){var {spatialReference:b}=a;b=ua.getInfo(b);if(!b)return a;const [c,d]=b.valid;b=d-c;let h=0;a.xmin<c?h=Math.ceil((c-a.xmin)/b):a.xmin>d&&(h=-Math.ceil((a.xmin-d)/b));return new J({spatialReference:a.spatialReference,xmin:a.xmin+h*b,ymin:a.ymin,xmax:a.xmax+h*b,ymax:a.ymax})};y.snapExtent=qa;y.snapPyramid=function(a,b,c){const {storageInfo:d,pixelSize:h}=b;var f=0;let g=!1;var {pyramidResolutions:k}=d,e="mixed"===d.tileInfo.format?.toLowerCase()?
Math.max(1,Math.min(3,d.tileInfo.dpi/96)):1;e=(a.x+a.y)/2/e;if(null!=k&&k.length){a=k[k.length-1];a=(a.x+a.y)/2;var m=(h.x+h.y)/2;if(e<=m)f=0;else if(e>=a)f=k.length,g=8<e/a;else{a=m;for(let l=1;l<=k.length;l++){m=(k[l-1].x+k[l-1].y)/2;if(e<=m){e===m?f=l:"down"===c?(f=l-1,g=8<e/a):f="up"===c?l:e-a>m-e||2<e/a?l:l-1;break}a=m}}c=0===f?h:k[f-1];g&&(k=Math.min(c.x,c.y),e=H.getMetersPerUnitForSR(b.spatialReference),19567<k*e&&(g=!1));return{pyramidLevel:f,pyramidResolution:new E({x:c.x,y:c.y,spatialReference:b.spatialReference}),
excessiveReading:g}}f=Math.log(a.x/h.x)/Math.LN2;e=Math.log(a.y/h.y)/Math.LN2;k=b.storageInfo.maximumPyramidLevel||0;f="down"===c?Math.floor(Math.min(f,e)):"up"===c?Math.ceil(Math.max(f,e)):Math.round((f+e)/2);0>f?f=0:f>k&&(g=f>k+3,f=k);c=2**f;b=new E({x:c*b.nativePixelSize.x,y:c*b.nativePixelSize.y,spatialReference:b.spatialReference});return{pyramidLevel:f,pyramidResolution:b,excessiveReading:g}};Object.defineProperty(y,Symbol.toStringTag,{value:"Module"})});