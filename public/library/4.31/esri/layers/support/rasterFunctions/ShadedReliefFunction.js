// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.31/esri/copyright.txt for details.
//>>built
define("../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ../rasterFormats/pixelRangeUtils ./BaseRasterFunction ./pixelUtils ./ShadedReliefFunctionArguments ./surfaceUtils ../../../renderers/support/colorRampUtils ../../../renderers/support/rasterRendererChecks".split(" "),function(e,h,d,z,A,p,q,r,t,u,f,l,v){d=class extends r{constructor(){super(...arguments);
this.functionName="ShadedRelief";this.functionArguments=null;this.rasterArgumentNames=["raster"];this.isGCS=!1}_bindSourceRasters(){var a=this.sourceRasterInfos[0];if(1<a.bandCount)return{success:!1,supportsGPU:!1,error:"shadedrelief-function: source data must be single band"};let {colorRamp:b,colormap:c}=this.functionArguments;if(!b&&!c?.length)return{success:!1,supportsGPU:!1,error:"shadedrelief-function: a color ramp argument must be specified"};this.outputPixelType=this._getOutputPixelType("u8");
a=a.clone();this._removeStatsHistColormapVAT(a);a.pixelType=this.outputPixelType;a.bandCount=3;a.statistics=[{min:0,max:255,avg:60,stddev:10},{min:0,max:255,avg:60,stddev:10},{min:0,max:255,avg:60,stddev:10}];this.rasterInfo=a;this.isGCS=a.spatialReference?.isGeographic??!1;c?.length||(c=l.convertColorRampToColormap(b,{interpolateAlpha:!0}));const {indexedColormap:g,offset:k}=t.createColormapLUT({colormap:c});if(!g?.length)return{success:!1,supportsGPU:!1,error:"shadedrelief-function: a valid colorramp is required"};
a=l.createHsvMap(g);this.lookup={indexedColormap:g,offset:k,hsvMap:a};return{success:!0,supportsGPU:v.isColormapSupportedByWebGL(g)}}_processPixels(a){const b=a.pixelBlocks?.[0];if(!b||!this.lookup)return null;let c=a.primaryPixelSizes?.[0];null==c&&({extent:a}=a,c=a?{x:a.width/b.width,y:a.height/b.height}:{x:1,y:1});a=f.getHillshadeOptions(this.functionArguments,c,this.isGCS);a=f.hillshade(b,a);f.tintHillshade(a,b,this.lookup.hsvMap,this.sourceRasterInfos[0].statistics?.[0]??{min:0,max:8E3});a.pixelType=
this.outputPixelType;return a}_getWebGLParameters(){var a=f.getHillshadeOptions(this.functionArguments,{x:1,y:1},this.isGCS);a=f.calculateHillshadeParams(a);const {slopeType:b,zFactor:c,pixelSizeFactor:g,pixelSizePower:k}=this.functionArguments,m="scaled"===b,{indexedColormap:w,offset:x}=this.lookup,n=this.sourceRasterInfos[0].statistics?.[0],y=q.isIntegerPixelType(this.outputPixelType);return{...a,indexedColormap:w,offset:x,zFactor:c,gcsFactor:this.isGCS?f.gcsFactor:1,pixelSizeFactor:m?g:0,pixelSizePower:m?
k:0,minValue:n?.min??0,maxValue:n?.max??8E3,isOutputRounded:y}}};e.__decorate([h.property({json:{write:!0,name:"rasterFunction"}})],d.prototype,"functionName",void 0);e.__decorate([h.property({type:u,json:{write:!0,name:"rasterFunctionArguments"}})],d.prototype,"functionArguments",void 0);e.__decorate([h.property()],d.prototype,"rasterArgumentNames",void 0);e.__decorate([h.property({json:{write:!0}})],d.prototype,"isGCS",void 0);e.__decorate([h.property({json:{write:!0}})],d.prototype,"lookup",void 0);
return d=e.__decorate([p.subclass("esri.layers.support.rasterFunctions.ShadedReliefFunction")],d)});