// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.31/esri/copyright.txt for details.
//>>built
define("../../chunks/tslib.es6 ../../request ../../core/Error ../../core/events ../../core/Logger ../../core/urlUtils ../../core/accessorSupport/decorators/property ../../core/has ../../core/RandomLCG ../../core/accessorSupport/decorators/subclass ../../core/accessorSupport/decorators/writer ./MediaElementBase ./mediaUtils ../../chunks/persistableUrlUtils".split(" "),function(e,m,k,n,p,f,g,c,v,q,r,t,l,u){c=class extends t{constructor(a){super(a);this.autoplay=!0;this.content=null;this.type="video"}load(){const a=
this.video;"string"===typeof a?this.addResolvingPromise(this._preProcessVideoUrl(a).then(h=>{const b=document.createElement("video");b.src=h;b.crossOrigin="anonymous";b.autoplay=!0;b.muted=!0;b.loop=!0;b.playsInline=!0;return this._loadVideo(b).then(()=>{this._set("content",b)})})):a instanceof HTMLVideoElement?this.addResolvingPromise(this._loadVideo(a).then(()=>{this._set("content",a)})):this.addResolvingPromise(Promise.reject(new k("video-element:invalid-video-type","Invalid video type",{video:a})));
return Promise.resolve(this)}get contentWidth(){return this.content?.videoWidth??0}get contentHeight(){return this.content?.videoHeight??0}set video(a){"not-loaded"!==this.loadStatus?p.getLogger(this).error("#video","video cannot be changed after the element is loaded."):this._set("video",a)}writeVideo(a,h,b,d){a?(a="string"!==typeof a||f.isDataProtocol(a)||f.isBlobProtocol(a)?null:a)?(!f.isAbsolute(a)&&d?.blockedRelativeUrls&&d.blockedRelativeUrls.push(a),a=f.makeAbsolute(a),u.itemIdFromResourceUrl(a)?
d?.messages&&d.messages.push(new k("video-element:unsupported-video","video source cannot be an item resource")):h[b]=a):d?.messages&&d.messages.push(new k("video-element:unsupported-video","video source must be an absolute url")):d?.messages&&d.messages.push(new k("video-element:unsupported-video","video source is missing"))}async _preProcessVideoUrl(a){if(f.getProxyRule(a))return f.addProxy(a);try{return await m(a,{method:"head"}),a}catch{return f.addProxy(a,!0)}}_loadVideo(a){return new Promise((h,
b)=>{const d=n.once(a,"canplay",()=>{this.removeHandles("canplay");this.autoplay?a.play().then(h,b):h()});this.addHandles(d,"canplay");"anonymous"!==a.crossOrigin&&(a.crossOrigin="anonymous",f.isBlobProtocol(a.src)||(a.src=a.src))})}};e.__decorate([g.property()],c.prototype,"autoplay",void 0);e.__decorate([g.property({readOnly:!0})],c.prototype,"content",void 0);e.__decorate([g.property({readOnly:!0})],c.prototype,"contentWidth",null);e.__decorate([g.property({readOnly:!0})],c.prototype,"contentHeight",
null);e.__decorate([g.property(l.mediaElementUrlProperty)],c.prototype,"video",null);e.__decorate([r.writer("video")],c.prototype,"writeVideo",null);e.__decorate([g.property(l.mediaTypeProperty)],c.prototype,"type",void 0);return c=e.__decorate([q.subclass("esri.layers.support.VideoElement")],c)});