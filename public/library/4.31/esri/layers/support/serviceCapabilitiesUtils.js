// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.31/esri/copyright.txt for details.
//>>built
define(["exports","../../core/has","./arcgisLayerUrl","../../rest/support/jsonUtils"],function(q,t,r,b){function u(a){a=a?.supportedSpatialAggregationStatistics?.map(d=>d.toLowerCase());return{envelope:!!a?.includes("envelopeaggregate"),centroid:!!a?.includes("centroidaggregate"),convexHull:!!a?.includes("convexhullaggregate")}}function n(a,d){return!!a?.supportedOperationsWithCacheHint?.map(c=>c.toLowerCase())?.includes(d.toLowerCase())}function v(a){a=a?.supportedStatisticTypes?.map(d=>d.toLowerCase());
return{count:!!a?.includes("count"),sum:!!a?.includes("sum"),min:!!a?.includes("min"),max:!!a?.includes("max"),avg:!!a?.includes("avg"),var:!!a?.includes("var"),stddev:!!a?.includes("stddev"),percentileContinuous:!!a?.includes("percentile_continuous"),percentileDiscrete:!!a?.includes("percentile_discrete"),envelope:!!a?.includes("envelopeaggregate"),centroid:!!a?.includes("centroidaggregate"),convexHull:!!a?.includes("convexhullaggregate")}}function w(a){const d=a.attachmentProperties,c={supportsName:!1,
supportsSize:!1,supportsContentType:!1,supportsKeywords:!1,supportsExifInfo:!1,supportsCacheHint:n(a.advancedQueryCapabilities,"queryAttachments"),supportsResize:b.readBoolean(a,"supportsAttachmentsResizing",!1)};d&&Array.isArray(d)&&d.forEach(e=>{const g=x[e.name];g&&(c[g]=!!e.isEnabled)});return c}function y(a,d,c){a=a?a.toLowerCase().split(",").map(m=>m.trim()):[];c=c?r.parse(c):null;c=a.includes(null!=c&&"MapServer"===c.serverType?"data":"query");const e=a.includes("editing")&&!d.datesInUnknownTimezone;
let g=e&&a.includes("create"),k=e&&a.includes("delete"),l=e&&a.includes("update");const f=a.includes("changetracking"),h=d.advancedQueryCapabilities;!e||g||k||l||(g=k=l=!0);return{supportsCalculate:b.readBoolean(d,"supportsCalculate",!1),supportsTruncate:b.readBoolean(d,"supportsTruncate",!1),supportsValidateSql:b.readBoolean(d,"supportsValidateSql",!1),supportsAdd:g,supportsDelete:k,supportsEditing:e,supportsChangeTracking:f,supportsQuery:c,supportsQueryAnalytics:b.readBoolean(h,"supportsQueryAnalytic",
!1),supportsQueryAttachments:b.readBoolean(h,"supportsQueryAttachments",!1),supportsQueryBins:b.readBoolean(h,"supportsQueryBins",!1),supportsQueryTopFeatures:b.readBoolean(h,"supportsTopFeaturesQuery",!1),supportsResizeAttachments:b.readBoolean(d,"supportsAttachmentsResizing",!1),supportsSync:a.includes("sync"),supportsUpdate:l,supportsExceedsLimitStatistics:b.readBoolean(d,"supportsExceedsLimitStatistics",!1),supportsAsyncConvert3D:b.readBoolean(d,"supportsAsyncConvert3D",!1)}}function z(a,d){const c=
a.advancedQueryCapabilities,e=a.ownershipBasedAccessControlForFeatures,g=a.archivingInfo;var k=a.currentVersion;k=!d?.includes("MapServer")||k>=t("mapserver-pbf-version-support");d=r.isHostedAgolService(d);const l=new Set((a.supportedQueryFormats??"").split(",").map(f=>f.toLowerCase().trim()));return{maxRecordCount:b.readNumber(a,"maxRecordCount",void 0),maxRecordCountFactor:b.readNumber(a,"maxRecordCountFactor",void 0),standardMaxRecordCount:b.readNumber(a,"standardMaxRecordCount",void 0),supportedSpatialAggregationStatistics:u(c),
supportsCacheHint:b.readBoolean(c,"supportsQueryWithCacheHint",!1)||n(c,"query"),supportsCentroid:b.readBoolean(c,"supportsReturningGeometryCentroid",!1),supportsCompactGeometry:d,supportsDefaultSpatialReference:b.readBoolean(c,"supportsDefaultSR",!1),supportsDisjointSpatialRelationship:b.readBoolean(c,"supportsDisjointSpatialRel",!1),supportsDistance:b.readBoolean(c,"supportsQueryWithDistance",!1),supportsDistinct:b.readBoolean(c,"supportsDistinct",a.supportsAdvancedQueries),supportsExtent:b.readBoolean(c,
"supportsReturningQueryExtent",!1),supportsFormatPBF:k&&l.has("pbf"),supportsFullTextSearch:b.readBoolean(c,"supportsFullTextSearch",!1),supportsGeometryProperties:b.readBoolean(c,"supportsReturningGeometryProperties",!1),supportsHavingClause:b.readBoolean(c,"supportsHavingClause",!1),supportsHistoricMoment:b.readBoolean(g,"supportsQueryWithHistoricMoment",!1),supportsMaxRecordCountFactor:b.readBoolean(c,"supportsMaxRecordCountFactor",!1),supportsOrderBy:b.readBoolean(c,"supportsOrderBy",a.supportsAdvancedQueries),
supportsPagination:b.readBoolean(c,"supportsPagination",!1),supportsPercentileStatistics:b.readBoolean(c,"supportsPercentileStatistics",!1),supportsQuantization:b.readBoolean(a,"supportsCoordinatesQuantization",!1),supportsQuantizationEditMode:b.readBoolean(a,"supportsQuantizationEditMode",!1),supportsQueryByAnonymous:b.readBoolean(e,"allowAnonymousToQuery",!0),supportsQueryByOthers:b.readBoolean(e,"allowOthersToQuery",!0),supportsQueryGeometry:b.readBoolean(a,"supportsReturningQueryGeometry",!1),
supportsResultType:b.readBoolean(c,"supportsQueryWithResultType",!1),supportsSpatialAggregationStatistics:b.readBoolean(c,"supportsSpatialAggregationStatistics",!1),supportsSqlExpression:b.readBoolean(c,"supportsSqlExpression",!1),supportsStandardizedQueriesOnly:b.readBoolean(a,"useStandardizedQueries",!1),supportsStatistics:b.readBoolean(c,"supportsStatistics",a.supportsStatistics),supportsTopFeaturesQuery:b.readBoolean(c,"supportsTopFeaturesQuery",!1),tileMaxRecordCount:b.readNumber(a,"tileMaxRecordCount",
void 0)}}const x={name:"supportsName",size:"supportsSize",contentType:"supportsContentType",keywords:"supportsKeywords",exifInfo:"supportsExifInfo"};q.getFeatureLayerCapabilities=function(a,d){var c={supportsCacheHint:n(a.advancedQueryCapabilities,"queryAnalytics")},e=w(a);var g={isVersioned:b.readBoolean(a,"isDataVersioned",!1),isBranchVersioned:b.readBoolean(a,"isDataBranchVersioned",!1),supportsAttachment:b.readBoolean(a,"hasAttachments",!1),supportsM:b.readBoolean(a,"hasM",!1),supportsZ:b.readBoolean(a,
"hasZ",!1)};var k={supportsAdvancedFieldProperties:b.readBoolean(a,"supportsFieldDescriptionProperty",!1)},l=y(a.capabilities,a,d);d=z(a,d);var f=a?a.queryBinsCapabilities:void 0;f={supportsDate:b.readBoolean(f,"supportsDateBin",!1),supportsFixedInterval:b.readBoolean(f,"supportsFixedIntervalBin",!1),supportsAutoInterval:b.readBoolean(f,"supportsAutoIntervalBin",!1),supportsFixedBoundaries:b.readBoolean(f,"supportsFixedBoundariesBin",!1),supportedStatistics:v(f)};var h=a.advancedQueryCapabilities;
var m=b.readBoolean(h,"supportsAdvancedQueryRelated",!1);h={supportsPagination:b.readBoolean(h,"supportsQueryRelatedPagination",!1),supportsCount:m,supportsOrderBy:m,supportsCacheHint:n(h,"queryRelated")};m={supportsCacheHint:n(a.advancedQueryCapabilities,"queryTopFilter")};const p=a.ownershipBasedAccessControlForFeatures,A=a?a.advancedEditingCapabilities:void 0;a={supportsGeometryUpdate:b.readBoolean(a,"allowGeometryUpdates",!0),supportsGlobalId:b.readBoolean(a,"supportsApplyEditsWithGlobalIds",
!1),supportsReturnServiceEditsInSourceSpatialReference:b.readBoolean(a,"supportsReturnServiceEditsInSourceSR",!1),supportsRollbackOnFailure:b.readBoolean(a,"supportsRollbackOnFailureParameter",!1),supportsUpdateWithoutM:b.readBoolean(a,"allowUpdateWithoutMValues",!1),supportsUploadWithItemId:b.readBoolean(a,"supportsAttachmentsByUploadId",!1),supportsDeleteByAnonymous:b.readBoolean(p,"allowAnonymousToDelete",!0),supportsDeleteByOthers:b.readBoolean(p,"allowOthersToDelete",!0),supportsUpdateByAnonymous:b.readBoolean(p,
"allowAnonymousToUpdate",!0),supportsUpdateByOthers:b.readBoolean(p,"allowOthersToUpdate",!0),supportsAsyncApplyEdits:b.readBoolean(A,"supportsAsyncApplyEdits",!1),zDefault:b.readNumber(a,"zDefault",void 0)};return{analytics:c,attachment:e,data:g,metadata:k,operations:l,query:d,queryBins:f,queryRelated:h,queryTopFeatures:m,editing:a}};q.getVideoLayerCapabilities=function(a){return{operations:{supportsAppend:b.readBoolean(a,"supportsAppend",!1),supportsCoverageQuery:a?.playbackInfo?.klv["0601"]??!1,
supportsExportClip:b.readBoolean(a,"supportsExportClip",!1),supportsExportFrameset:b.readBoolean(a,"supportsExportFrameset",!1),supportsMensuration:b.readBoolean(a,"supportsMensuration",!1),supportsUpdate:b.readBoolean(a,"supportsUpdate",!1)}}};Object.defineProperty(q,Symbol.toStringTag,{value:"Module"})});