// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.31/esri/copyright.txt for details.
//>>built
require({cache:{"esri/geometry/support/scaleUtils":function(){define(["exports","../../core/mathUtils","../../core/unitUtils"],function(k,c,d){function w(e,n){n=d.getMetersPerUnitForSR(n);return e/(n*d.inchesPerMeter*96)}k.getExtentForScale=function(e,n){const g=e.extent;e=e.width-(e.padding?e.padding.left+e.padding.right:0);n=w(n,g.spatialReference);return g.clone().expand(n*e/g.width)};k.getResolutionForScale=w;k.getResolutionInMetersForScale=function(e){return e/(96*d.inchesPerMeter)};k.getScale=
function(e,n){n=n||e.extent;e=e.width;const g=d.getMetersPerUnitForSR(n?.spatialReference);return n&&e?n.width/e*g*d.inchesPerMeter*96:0};k.getScaleForResolution=function(e,n){n=d.getMetersPerUnitForSR(n);return e*n*d.inchesPerMeter*96};k.isInScaleRange=function(e,n,g){if(n=0===n||c.floatEqualAbsolute(e,n)||e<n)n=0===g||c.floatEqualAbsolute(e,g)||e>g;return n};Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/layers/mixins/ArcGISMapService":function(){define("exports ../../chunks/tslib.es6 ../../request ../../core/MapUtils ../../core/promiseUtils ../../core/urlUtils ../../core/Version ../../core/accessorSupport/decorators/property ../../core/has ../../core/Logger ../../core/RandomLCG ../../core/accessorSupport/decorators/reader ../../core/accessorSupport/decorators/subclass ../../core/accessorSupport/PropertyOrigin ../../geometry/Extent ../../geometry/SpatialReference ../support/arcgisLayerUrl ../support/commonProperties ../../portal/support/portalItemUtils".split(" "),
function(k,c,d,w,e,n,g,x,W,ba,X,V,C,p,D,K,M,u,F){k.ArcGISMapService=r=>{r=class extends r{constructor(){super(...arguments);this.capabilities=void 0;this.fullExtent=this.copyright=null;this.legendEnabled=!0;this.spatialReference=null;this.version=void 0;this._allLayersAndTablesMap=null}readCapabilities(h,l){var t=l.capabilities&&l.capabilities.split(",").map(A=>A.toLowerCase().trim());if(!t)return{operations:{supportsExportMap:!1,supportsExportTiles:!1,supportsIdentify:!1,supportsQuery:!1,supportsTileMap:!1},
exportMap:null,exportTiles:null};var v=this.type;h="tile"!==v&&!!l.supportsDynamicLayers;const G=t.includes("query"),P=t.includes("map"),q=!!l.exportTilesAllowed,R=t.includes("tilemap");t=t.includes("data");const N="tile"!==v&&(!l.tileInfo||h),Y="tile"!==v&&(!l.tileInfo||h);v="tile"!==v;var z=l.cimVersion?g.Version.parse(l.cimVersion):null;const Q=z?.greaterEqual(1,4)??!1;z=z?.greaterEqual(2,0)??!1;return{operations:{supportsExportMap:P,supportsExportTiles:q,supportsIdentify:G,supportsQuery:t,supportsTileMap:R},
exportMap:P?{supportsArcadeExpressionForLabeling:Q,supportsSublayersChanges:v,supportsDynamicLayers:h,supportsSublayerVisibility:N,supportsSublayerDefinitionExpression:Y,supportsCIMSymbols:z}:null,exportTiles:q?{maxExportTilesCount:+l.maxExportTilesCount}:null}}readVersion(h,l){(h=l.currentVersion)||(h=l.hasOwnProperty("capabilities")||l.hasOwnProperty("tables")?10:l.hasOwnProperty("supportedImageFormatTypes")?9.31:9.3);return h}async fetchRelatedService(h){var l=this.portalItem;if(!l||!F.isHostedLayer(l))return null;
this._relatedFeatureServicePromise||(this._relatedFeatureServicePromise=l.fetchRelatedItems({relationshipType:"Service2Service",direction:"reverse"},h).then(t=>t.find(v=>"Feature Service"===v.type)??null,()=>null));l=await this._relatedFeatureServicePromise;e.throwIfAborted(h);return l?{itemId:l.id,url:l.url}:null}async fetchSublayerInfo(h,l){const {source:t}=h;if(this?.portalItem&&"tile"===this.type&&"map-layer"===t?.type&&F.isHostedLayer(this.portalItem)&&h.originIdOf("url")<p.OriginId.SERVICE){var v=
await this.fetchRelatedService(l);v&&(h.url=n.join(v.url,t.mapLayerId.toString()),h.layerItemId=v.itemId)}({url:v}=h);let G;if("data-layer"===t.type)G=(await d(v,{responseType:"json",query:{f:"json",...this.customParameters,token:this.apiKey},...l})).data;else if(v&&h.originIdOf("url")>p.OriginId.SERVICE)try{const P=await this._fetchAllLayersAndTablesFromService(v),q=M.parse(v)?.sublayer??t.mapLayerId;G=P.get(q)}catch{}else{h=h.id;"map-layer"===t?.type&&(h=t.mapLayerId);try{G=(await this.fetchAllLayersAndTables(l)).get(h)}catch{}}return G}async fetchAllLayersAndTables(h){return this._fetchAllLayersAndTablesFromService(this.parsedUrl?.path,
h)}async _fetchAllLayersAndTablesFromService(h,l){await this.load(l);this._allLayersAndTablesMap||(this._allLayersAndTablesMap=new Map);const t=M.parse(h);h=await w.getOrCreateMapValue(this._allLayersAndTablesMap,t?.url.path,()=>d(n.join(t?.url.path,"/layers"),{responseType:"json",query:{f:"json",...this.customParameters,token:this.apiKey}}).then(v=>{const G=new Map,{layers:P,tables:q}=v.data;v=[...(P??[]),...(q??[])];for(const R of v)G.set(R.id,R);return{result:G}},v=>({error:v})));e.throwIfAborted(l);
if("result"in h)return h.result;throw h.error;}};c.__decorate([x.property({readOnly:!0})],r.prototype,"capabilities",void 0);c.__decorate([V.reader("service","capabilities",["capabilities","exportTilesAllowed","maxExportTilesCount","supportsDynamicLayers","tileInfo"])],r.prototype,"readCapabilities",null);c.__decorate([x.property({json:{read:{source:"copyrightText"}}})],r.prototype,"copyright",void 0);c.__decorate([x.property({type:D})],r.prototype,"fullExtent",void 0);c.__decorate([x.property(u.id)],
r.prototype,"id",void 0);c.__decorate([x.property({type:Boolean,json:{origins:{service:{read:{enabled:!1}}},read:{source:"showLegend"},write:{target:"showLegend"}}})],r.prototype,"legendEnabled",void 0);c.__decorate([x.property(u.popupEnabled)],r.prototype,"popupEnabled",void 0);c.__decorate([x.property({type:K})],r.prototype,"spatialReference",void 0);c.__decorate([x.property({readOnly:!0})],r.prototype,"version",void 0);c.__decorate([V.reader("service","version",["currentVersion","capabilities",
"tables","supportedImageFormatTypes"])],r.prototype,"readVersion",null);return r=c.__decorate([C.subclass("esri.layers.mixins.ArcGISMapService")],r)};Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/layers/mixins/SublayersOwner":function(){define("exports ../../chunks/tslib.es6 ../../core/Collection ../../core/CollectionFlattener ../../core/Error ../../core/Logger ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/has ../../core/RandomLCG ../../core/accessorSupport/utils ../../core/accessorSupport/decorators/subclass ../../core/accessorSupport/PropertyOrigin ../support/Sublayer ../support/sublayerUtils".split(" "),
function(k,c,d,w,e,n,g,x,W,ba,X,V,C,p,D){function K(F,r){const h=[],l={};if(!F)return h;F.forEach(t=>{const v=new p;v.read(t,r);l[v.id]=v;null!=t.parentLayerId&&-1!==t.parentLayerId?(t=l[t.parentLayerId],t.sublayers||(t.sublayers=[]),t.sublayers.unshift(v)):h.unshift(v)});return h}function M(F,r){F&&F.forEach(h=>{r(h);h.sublayers&&h.sublayers.length&&M(h.sublayers,r)})}const u=d.ofType(p);k.SublayersOwner=F=>{F=class extends F{constructor(...r){super(...r);this.allSublayers=new w({getCollections:()=>
[this.sublayers],getChildrenFunction(h){return h.sublayers}});this.sublayersSourceJSON={[C.OriginId.SERVICE]:{},[C.OriginId.PORTAL_ITEM]:{},[C.OriginId.WEB_SCENE]:{},[C.OriginId.WEB_MAP]:{}};this.subtables=null;this.addHandles([g.watch(()=>this.sublayers,(h,l)=>this._handleSublayersChange(h,l),g.sync),g.watch(()=>this.subtables,(h,l)=>this._handleSublayersChange(h,l),g.sync)])}destroy(){this.allSublayers.destroy()}readSublayers(r,h){if(h&&r){var {sublayersSourceJSON:l}=this,t=C.nameToId(h.origin);
if(!(t<C.OriginId.SERVICE||(l[t]={context:h,visibleLayers:r.visibleLayers||l[t].visibleLayers,layers:r.layers||l[t].layers},t>C.OriginId.SERVICE))){this._set("serviceSublayers",this.createSublayersForOrigin("service").sublayers);var {sublayers:v,origin:G}=this.createSublayersForOrigin("web-document");r=X.getProperties(this);r.setDefaultOrigin(G);this._set("sublayers",new u(v));r.setDefaultOrigin("user")}}}findSublayerById(r){return this.allSublayers.find(h=>h.id===r)}createServiceSublayers(){return this.createSublayersForOrigin("service").sublayers}createSublayersForOrigin(r){const h=
"web-document"===r?C.nameToId("web-map"):C.nameToId(r);let l=C.OriginId.SERVICE;r=this.sublayersSourceJSON[C.OriginId.SERVICE].layers;let t=this.sublayersSourceJSON[C.OriginId.SERVICE].context,v=null;var G=[C.OriginId.PORTAL_ITEM,C.OriginId.WEB_SCENE,C.OriginId.WEB_MAP].filter(z=>z<=h);for(var P of G)G=this.sublayersSourceJSON[P],D.isSublayerOverhaul(G.layers)&&(l=P,r=G.layers,t=G.context,G.visibleLayers&&(v={visibleLayers:G.visibleLayers,context:G.context}));P=[C.OriginId.PORTAL_ITEM,C.OriginId.WEB_SCENE,
C.OriginId.WEB_MAP].filter(z=>z>l&&z<=h);let q=null;for(var R of P){const {layers:z,visibleLayers:Q,context:A}=this.sublayersSourceJSON[R];z&&(q={layers:z,context:A});Q&&(v={visibleLayers:Q,context:A})}R=K(r,t);const N=new Map,Y=new Set;if(q)for(const z of q.layers)N.set(z.id,z);if(v?.visibleLayers)for(const z of v.visibleLayers)Y.add(z);M(R,z=>{q&&z.read(N.get(z.id),q.context);v&&z.read({defaultVisibility:Y.has(z.id)},v.context)});return{origin:C.idToName(l),sublayers:new u({items:R})}}read(r,h){super.read(r,
h);this.readSublayers(r,h)}_handleSublayersChange(r,h){h&&(h.forEach(l=>{l.parent=null;l.layer=null}),this.removeHandles("sublayers-owner"));r&&(r.forEach(l=>{l.parent=this;l.layer=this}),this.addHandles([r.on("after-add",({item:l})=>{l.parent=this;l.layer=this}),r.on("after-remove",({item:l})=>{l.parent=null;l.layer=null})],"sublayers-owner"),"tile"===this.type&&this.addHandles(r.on("before-changes",l=>{n.getLogger("esri.layers.TileLayer").error(new e("tilelayer:sublayers-non-modifiable","ISublayer can't be added, moved, or removed from the layer's sublayers",
{layer:this}));l.preventDefault()}),"sublayers-owner"))}};c.__decorate([x.property({readOnly:!0})],F.prototype,"allSublayers",void 0);c.__decorate([x.property({readOnly:!0,type:d.ofType(p)})],F.prototype,"serviceSublayers",void 0);c.__decorate([x.property({value:null,type:u,json:{read:!1,write:{allowNull:!0,ignoreOrigin:!0}}})],F.prototype,"sublayers",void 0);c.__decorate([x.property({readOnly:!0})],F.prototype,"sublayersSourceJSON",void 0);c.__decorate([x.property({type:u,json:{read:{source:"tables"}}})],
F.prototype,"subtables",void 0);return F=c.__decorate([V.subclass("esri.layers.mixins.SublayersOwner")],F)};k.forEachSublayer=M;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/Sublayer":function(){define("require ../../chunks/tslib.es6 ../../geometry ../../PopupTemplate ../../renderers/ClassBreaksRenderer ../../renderers/DictionaryRenderer ../../renderers/DotDensityRenderer ../../renderers/HeatmapRenderer ../../renderers/PieChartRenderer ../../renderers/Renderer ../../renderers/SimpleRenderer ../../renderers/UniqueValueRenderer ../../renderers/support/jsonUtils ../../renderers/support/types ../../request ../../symbols ../../core/Collection ../../core/Error ../../core/has ../../core/Identifiable ../../core/lang ../../core/Loadable ../../core/Logger ../../core/MultiOriginJSONSupport ../../core/sql ../../core/urlUtils ../../core/accessorSupport/decorators/property ../../core/accessorSupport/decorators/cast ../../core/accessorSupport/decorators/reader ../../core/accessorSupport/decorators/subclass ../../core/accessorSupport/decorators/writer ../../core/accessorSupport/ensureType ../../core/accessorSupport/PropertyOrigin ../../core/accessorSupport/utils ../graphics/sources/support/QueryTask ./featureLayerUtils ./FeatureType ./Field ./FieldsIndex ./fieldUtils ./LabelClass ./labelingInfo ./LayerFloorInfo ./Relationship ./serviceCapabilitiesUtils ./source/DataLayerSource ./source/MapLayerSource ../../rest/utils ../../rest/support/AttachmentQuery ../../rest/support/Query ../../support/popupUtils ../../geometry/Extent ../../geometry/SpatialReference ../../geometry/support/typeUtils".split(" "),
function(k,c,d,w,e,n,g,x,W,ba,X,V,C,p,D,K,M,u,F,r,h,l,t,v,G,P,q,R,N,Y,z,Q,A,ca,ia,ja,ea,m,B,L,I,H,O,da,Z,J,U,qa,ra,sa,ta,ua,va,ka){function la(a,b,f){a=this.originIdOf(b)>=A.nameToId(f.origin);return{ignoreOrigin:!0,allowNull:a,enabled:f?"map-image"===f.layer?.type&&(f.writeSublayerStructure||a):!1}}function ma(a,b,f){return{enabled:f?"tile"===f.layer?.type&&(f.origin&&this.originIdOf(b)>=A.nameToId(f.origin)||this._isOverridden(b)):!1}}function T(a,b,f){return{ignoreOrigin:!0,enabled:f&&f.writeSublayerStructure||
!1}}function fa(a,b,f){return{ignoreOrigin:!0,enabled:f?f.writeSublayerStructure||this.originIdOf(b)>=A.nameToId(f.origin):!1}}var ha;let wa=0;const xa=new Set("layer parent loaded loadStatus loadError loadWarnings".split(" "));d=ha=class extends v.MultiOriginJSONMixin(r.IdentifiableMixin(l)){constructor(a){super(a);this.capabilities=void 0;this.maxScaleRange={minScale:0,maxScale:0};this.globalIdField=this.geometryType=this.fullExtent=this.fields=null;this.isTable=!1;this.legendEnabled=!0;this.parent=
this.objectIdField=null;this.popupEnabled=!0;this.typeIdField=this.title=this.spatialReference=this.sourceJSON=this.relationships=this.popupTemplate=null;this.type="sublayer";this._lastParsedUrl=this.types=null}async load(a){this.addResolvingPromise((async()=>{const {layer:b,url:f}=this;if(!b&&!f)throw new u("sublayer:missing-layer","Sublayer can't be loaded without being part of a layer",{sublayer:this});const y=b?await b.fetchSublayerInfo(this,a):(await D(f,{responseType:"json",query:{f:"json"},
...a})).data;y&&(this.sourceJSON=y,this.read({layerDefinition:y},{origin:"service",layer:b,url:qa.parseUrl(f)}))})());return this}readCapabilities(a,b){b=b.layerDefinition||b;const {operations:{supportsQuery:f,supportsQueryAttachments:y},query:{supportsFormatPBF:E,supportsOrderBy:S,supportsPagination:aa},data:{supportsAttachment:na},queryRelated:oa}=Z.getFeatureLayerCapabilities(b,this.url);return{exportMap:{supportsModification:!!b.canModifyLayer},operations:{supportsQuery:f,supportsQueryAttachments:y},
data:{supportsAttachment:na},query:{supportsFormatPBF:E,supportsOrderBy:S,supportsPagination:aa},queryRelated:oa}}get defaultPopupTemplate(){return this.createPopupTemplate()}set definitionExpression(a){this._setAndNotifyLayer("definitionExpression",a)}get effectiveScaleRange(){const {minScale:a,maxScale:b}=this;return{minScale:a,maxScale:b}}readMaxScaleRange(a,b){b=b.layerDefinition||b;return{minScale:b.minScale??0,maxScale:b.maxScale??0}}get fieldsIndex(){return new B(this.fields||[])}set floorInfo(a){this._setAndNotifyLayer("floorInfo",
a)}readGlobalIdFieldFromService(a,b){b=b.layerDefinition||b;if(b.globalIdField)return b.globalIdField;if(b.fields)for(const f of b.fields)if("esriFieldTypeGlobalID"===f.type)return f.name}get id(){const a=this._get("id");return null==a?wa++:a}set id(a){this._get("id")!==a&&(!1===this.layer?.capabilities?.exportMap?.supportsDynamicLayers?this._logLockedError("id","capability not available 'layer.capabilities.exportMap.supportsDynamicLayers'"):this._set("id",a))}readIsTable(a,b){return"Table"===b.type}set labelingInfo(a){this._setAndNotifyLayer("labelingInfo",
a)}writeLabelingInfo(a,b,f,y){a&&a.length&&(b.layerDefinition={drawingInfo:{labelingInfo:a.map(E=>E.write({},y))}})}set labelsVisible(a){this._setAndNotifyLayer("labelsVisible",a)}set layer(a){this._set("layer",a);this.sublayers?.forEach(b=>b.layer=a)}set listMode(a){this._set("listMode",a)}set minScale(a){this._setAndNotifyLayer("minScale",a)}readMinScale(a,b){return b.minScale||b.layerDefinition?.minScale||0}set maxScale(a){this._setAndNotifyLayer("maxScale",a)}readMaxScale(a,b){return b.maxScale||
b.layerDefinition?.maxScale||0}readObjectIdFieldFromService(a,b){b=b.layerDefinition||b;return b.objectIdField?b.objectIdField:b.fields?.find(f=>"esriFieldTypeOID"===f.type)?.name}set opacity(a){this._setAndNotifyLayer("opacity",a)}readOpacity(a,b){({layerDefinition:a}=b);return 1-.01*(a?.transparency??a?.drawingInfo?.transparency??0)}writeOpacity(a,b,f,y){b.layerDefinition={drawingInfo:{transparency:100-100*a}}}writeParent(a,b){b.parentLayerId=this.parent&&this.parent!==this.layer?Q.ensureInteger(this.parent.id):
-1}get queryTask(){if(!this.layer)return null;const {capabilities:a,fieldsIndex:b,layer:f,url:y}=this,{spatialReference:E}=f,S="gdbVersion"in f?f.gdbVersion:void 0,aa=F("featurelayer-pbf")&&a?.query.supportsFormatPBF;return new ia({fieldsIndex:b,gdbVersion:S,pbfSupported:aa,queryAttachmentsSupported:a?.operations?.supportsQueryAttachments??!1,sourceSpatialReference:E,url:y})}set renderer(a){L.fixRendererFields(a,this.fieldsIndex);if(a)for(const b of a.getSymbols())if(K.isSymbol3D(b)){t.getLogger(this).warn("Sublayer renderer should use 2D symbols");
break}this._setAndNotifyLayer("renderer",a)}get source(){return this._get("source")||new U.MapLayerSource({mapLayerId:this.id})}set source(a){this._setAndNotifyLayer("source",a)}set sublayers(a){this._handleSublayersChange(a,this._get("sublayers"));this._set("sublayers",a)}castSublayers(a){return Q.ensureType(M.ofType(ha),a)}writeSublayers(a,b,f){this.sublayers?.length&&(b[f]=this.sublayers.map(y=>y.id).toArray().reverse())}readTitle(a,b){return b.layerDefinition?.name??b.name}readTypeIdField(a,b){b=
b.layerDefinition||b;let f=b.typeIdField;f&&b.fields&&(f=f.toLowerCase(),a=b.fields.find(y=>y.name.toLowerCase()===f))&&(f=a.name);return f}get url(){const a=this.layer?.parsedUrl??this._lastParsedUrl;var b=this.source;if(!a)return null;this._lastParsedUrl=a;if("map-layer"===b?.type)return`${a.path}/${b.mapLayerId}`;b={layer:JSON.stringify({source:this.source})};return`${a.path}/dynamicLayer?${P.objectToQuery(b)}`}set url(a){this._overrideIfSome("url",a)}set visible(a){this._setAndNotifyLayer("visible",
a)}writeVisible(a,b,f,y){b[f]=this.getAtOrigin("defaultVisibility","service")||a}clone(){const {store:a}=ca.getProperties(this),b=new ha;ca.getProperties(b).store=a.clone(xa);this.commitProperty("url");b._lastParsedUrl=this._lastParsedUrl;return b}createPopupTemplate(a){return ta.createPopupTemplate(this,a)}createQuery(){return new sa({returnGeometry:!0,where:this.definitionExpression||"1\x3d1"})}async createFeatureLayer(){if(this.hasOwnProperty("sublayers"))return null;var a=(await new Promise((y,
E)=>k(["../FeatureLayer"],S=>y(Object.freeze(Object.defineProperty({__proto__:null,default:S},Symbol.toStringTag,{value:"Module"}))),E))).default;const {layer:b,url:f}=this;if(f&&this.originIdOf("url")>A.OriginId.SERVICE)a=new a({url:f});else if(b?.parsedUrl){const y=b.parsedUrl;a=new a({url:y.path});y&&this.source&&("map-layer"===this.source.type?a.layerId=this.source.mapLayerId:a.dynamicDataSource=this.source)}else throw new u("createFeatureLayer:missing-information","Cannot create a FeatureLayer without a url or a parent layer");
null!=b?.refreshInterval&&(a.refreshInterval=b.refreshInterval);this.definitionExpression&&(a.definitionExpression=this.definitionExpression);this.floorInfo&&(a.floorInfo=h.clone(this.floorInfo));this.originIdOf("labelingInfo")>A.OriginId.SERVICE&&(a.labelingInfo=h.clone(this.labelingInfo));this.originIdOf("labelsVisible")>A.OriginId.DEFAULTS&&(a.labelsVisible=this.labelsVisible);this.originIdOf("legendEnabled")>A.OriginId.DEFAULTS&&(a.legendEnabled=this.legendEnabled);this.originIdOf("visible")>
A.OriginId.DEFAULTS&&(a.visible=this.visible);this.originIdOf("minScale")>A.OriginId.DEFAULTS&&(a.minScale=this.minScale);this.originIdOf("maxScale")>A.OriginId.DEFAULTS&&(a.maxScale=this.maxScale);this.originIdOf("opacity")>A.OriginId.DEFAULTS&&(a.opacity=this.opacity);this.originIdOf("popupTemplate")>A.OriginId.DEFAULTS&&(a.popupTemplate=h.clone(this.popupTemplate));this.originIdOf("renderer")>A.OriginId.SERVICE&&(a.renderer=h.clone(this.renderer));"data-layer"===this.source?.type&&(a.dynamicDataSource=
this.source.clone());this.originIdOf("title")>A.OriginId.DEFAULTS&&(a.title=this.title);"map-image"===b?.type&&b.originIdOf("customParameters")>A.OriginId.DEFAULTS&&(a.customParameters=b.customParameters);"tile"===b?.type&&b.originIdOf("customParameters")>A.OriginId.DEFAULTS&&(a.customParameters=b.customParameters);return a}getField(a){return this.fieldsIndex.get(a)}getFeatureType(a){return ja.getFeatureType(this.types,this.typeIdField,a)}getFieldDomain(a,b){return(b=this.getFeatureType(b?.feature))&&
(b=b.domains&&b.domains[a])&&"inherited"!==b.type?b:this._getLayerDomain(a)}async queryAttachments(a,b){await this.load();a=ra.from(a);const f=this.capabilities;if(!f?.data?.supportsAttachment)throw new u("queryAttachments:not-supported","this layer doesn't support attachments");const {attachmentTypes:y,objectIds:E,globalIds:S,num:aa,size:na,start:oa,where:pa}=a;if(!f?.operations?.supportsQueryAttachments&&(0<y?.length||0<S?.length||0<na?.length||aa||oa||pa))throw new u("queryAttachments:option-not-supported",
"when 'capabilities.operations.supportsQueryAttachments' is false, only objectIds is supported",a);if(!(E?.length||S?.length||pa))throw new u("queryAttachments:invalid-query","'objectIds', 'globalIds', or 'where' are required to perform attachment query",a);return this.queryTask.executeAttachmentQuery(a,b)}async queryFeatureCount(a=this.createQuery(),b){await this.load();if(!this.capabilities.operations.supportsQuery)throw new u("queryFeatureCount:not-supported","this layer doesn't support queries.");
if(!this.url)throw new u("queryFeatureCount:not-supported","this layer has no url.");return await this.queryTask.executeForCount(a,{...b,query:{...this.layer?.customParameters,token:this.layer?.apiKey}})}async queryFeatures(a=this.createQuery(),b){await this.load();if(!this.capabilities.operations.supportsQuery)throw new u("queryFeatures:not-supported","this layer doesn't support queries.");if(!this.url)throw new u("queryFeatures:not-supported","this layer has no url.");a=await this.queryTask.execute(a,
{...b,query:{...this.layer?.customParameters,token:this.layer?.apiKey}});if(a?.features)for(const f of a.features)f.sourceLayer=this;return a}async queryObjectIds(a=this.createQuery(),b){await this.load();if(!this.capabilities.operations.supportsQuery)throw new u("queryObjectIds:not-supported","this layer doesn't support queries.");if(!this.url)throw new u("queryObjectIds:not-supported","this layer has no url.");return await this.queryTask.executeForIds(a,{...b,query:{...this.layer?.customParameters,
token:this.layer?.apiKey}})}async queryRelatedFeatures(a,b){await this.load();if(!this.capabilities.operations.supportsQuery)throw new u("queryRelatedFeatures:not-supported","this layer doesn't support queries.");if(!this.url)throw new u("queryRelatedFeatures:not-supported","this layer has no url.");return await this.queryTask.executeRelationshipQuery(a,{...b,query:{...this.layer?.customParameters,token:this.layer?.apiKey}})}async queryRelatedFeaturesCount(a,b){await this.load();if(!this.capabilities.operations.supportsQuery)throw new u("queryRelatedFeaturesCount:not-supported",
"this layer doesn't support queries.");if(!this.capabilities.queryRelated.supportsCount)throw new u("queryRelatedFeaturesCount:not-supported","this layer doesn't support query related counts.");if(!this.url)throw new u("queryRelatedFeaturesCount:not-supported","this layer has no url.");return await this.queryTask.executeRelationshipQueryForCount(a,{...b,query:{...this.layer?.customParameters,token:this.layer?.apiKey}})}toExportImageJSON(a){const b={id:this.id,source:this.source?.toJSON()||{mapLayerId:this.id,
type:"mapLayer"}};a=G.sqlAnd(a,this.definitionExpression);null!=a&&(b.definitionExpression=a);const f=["renderer","labelingInfo","opacity","labelsVisible"].reduce((y,E)=>{y[E]=this.originIdOf(E);return y},{});if(Object.keys(f).some(y=>f[y]>A.OriginId.SERVICE)){a=b.drawingInfo={};f.renderer>A.OriginId.SERVICE&&(a.renderer=this.renderer?this.renderer.toJSON():null);f.labelsVisible>A.OriginId.SERVICE&&(a.showLabels=this.labelsVisible);if(this.labelsVisible&&f.labelingInfo>A.OriginId.SERVICE)if(this.labelingInfo){!this.loaded&&
this.labelingInfo?.some(E=>!E.labelPlacement)&&t.getLogger(this).warnOnce(`A Sublayer (title: ${this.title}, id: ${this.id}) has an undefined 'labelPlacement' `+"and so labels cannot be displayed. Either define a valid 'labelPlacement' or call Sublayer.load() to use a default value based on geometry type.",{sublayer:this});let y=this.labelingInfo;null!=this.geometryType&&(y=H.validateLabelingInfo(this.labelingInfo,ka.featureGeometryTypeKebabDictionary.toJSON(this.geometryType)));a.showLabels=!0;a.labelingInfo=
y.filter(E=>E.labelPlacement).map(E=>E.toJSON({origin:"service",layer:this.layer}))}else a.showLabels=!1;f.opacity>A.OriginId.SERVICE&&(a.transparency=100-100*this.opacity);this._assignDefaultSymbolColors(a.renderer)}return b}_assignDefaultSymbolColors(a){this._forEachSimpleMarkerSymbols(a,b=>{b.color||"esriSMSX"!==b.style&&"esriSMSCross"!==b.style||(b.color=b.outline?.color?b.outline.color:[0,0,0,0])})}_forEachSimpleMarkerSymbols(a,b){if(a){const f=("uniqueValueInfos"in a?a.uniqueValueInfos:"classBreakInfos"in
a?a.classBreakInfos:null)??[];for(const y of f)"esriSMS"===y.symbol?.type&&b(y.symbol);"symbol"in a&&"esriSMS"===a.symbol?.type&&b(a.symbol);"defaultSymbol"in a&&"esriSMS"===a.defaultSymbol?.type&&b(a.defaultSymbol)}}_setAndNotifyLayer(a,b){const f=this.layer,y=this._get(a);let E,S;switch(a){case "definitionExpression":case "floorInfo":E="supportsSublayerDefinitionExpression";break;case "minScale":case "maxScale":case "visible":E="supportsSublayerVisibility";break;case "labelingInfo":case "labelsVisible":case "opacity":case "renderer":case "source":E=
"supportsDynamicLayers",S="supportsModification"}const aa=ca.getProperties(this).getDefaultOrigin();if("service"!==aa){if(E&&!1===this.layer?.capabilities?.exportMap?.[E]){this._logLockedError(a,`capability not available 'layer.capabilities.exportMap.${E}'`);return}if(S&&!1===this.capabilities?.exportMap[S]){this._logLockedError(a,`capability not available 'capabilities.exportMap.${S}'`);return}}"source"===a&&"not-loaded"!==this.loadStatus?this._logLockedError(a,"'source' can't be changed after calling sublayer.load()"):
(this._set(a,b),"service"!==aa&&y!==b&&f&&f.emit&&f.emit("sublayer-update",{propertyName:a,target:this}))}_handleSublayersChange(a,b){b&&(b.forEach(f=>{f.parent=null;f.layer=null}),this.removeAllHandles());a&&(a.forEach(f=>{f.parent=this;f.layer=this.layer}),this.addHandles([a.on("after-add",({item:f})=>{f.parent=this;f.layer=this.layer}),a.on("after-remove",({item:f})=>{f.parent=null;f.layer=null}),a.on("before-changes",f=>{(this.layer?.capabilities?.exportMap?.supportsSublayersChanges??!0)||(t.getLogger(this).error(new u("sublayer:sublayers-non-modifiable",
"Sublayer can't be added, moved, or removed from the layer's sublayers",{sublayer:this,layer:this.layer})),f.preventDefault())})]))}_logLockedError(a,b){const {layer:f,declaredClass:y}=this;t.getLogger(y).error(new u("sublayer:locked",`Property '${String(a)}' can't be changed on Sublayer from the layer '${f?.id}'`,{reason:b,sublayer:this,layer:f}))}_getLayerDomain(a){return this.fieldsIndex.get(a)?.domain??null}};d.test={isMapImageLayerOverridePolicy:a=>a===T||a===la,isTileImageLayerOverridePolicy:a=>
a===ma};c.__decorate([q.property({readOnly:!0})],d.prototype,"capabilities",void 0);c.__decorate([N.reader("service","capabilities",["layerDefinition.canModifyLayer","layerDefinition.capabilities"])],d.prototype,"readCapabilities",null);c.__decorate([q.property()],d.prototype,"defaultPopupTemplate",null);c.__decorate([q.property({type:String,value:null,json:{name:"layerDefinition.definitionExpression",write:{allowNull:!0,overridePolicy:la}}})],d.prototype,"definitionExpression",null);c.__decorate([q.property({readOnly:!0})],
d.prototype,"effectiveScaleRange",null);c.__decorate([N.reader("service","maxScaleRange",["minScale","maxScale"])],d.prototype,"readMaxScaleRange",null);c.__decorate([q.property({type:[m],json:{origins:{service:{read:{source:"layerDefinition.fields"}}}}})],d.prototype,"fields",void 0);c.__decorate([q.property({readOnly:!0})],d.prototype,"fieldsIndex",null);c.__decorate([q.property({type:O,value:null,json:{name:"layerDefinition.floorInfo",read:{source:"layerDefinition.floorInfo"},write:{target:"layerDefinition.floorInfo",
overridePolicy:la},origins:{"web-scene":{read:!1,write:!1}}}})],d.prototype,"floorInfo",null);c.__decorate([q.property({type:ua,json:{read:{source:"layerDefinition.extent"}}})],d.prototype,"fullExtent",void 0);c.__decorate([q.property({type:ka.featureGeometryTypeKebabDictionary.apiValues,json:{origins:{service:{name:"layerDefinition.geometryType",read:{reader:ka.featureGeometryTypeKebabDictionary.read}}}}})],d.prototype,"geometryType",void 0);c.__decorate([q.property({type:String})],d.prototype,"globalIdField",
void 0);c.__decorate([N.reader("service","globalIdField",["layerDefinition.globalIdField","layerDefinition.fields"])],d.prototype,"readGlobalIdFieldFromService",null);c.__decorate([q.property({type:Q.Integer,json:{write:{ignoreOrigin:!0}}})],d.prototype,"id",null);c.__decorate([q.property({readOnly:!0})],d.prototype,"isTable",void 0);c.__decorate([N.reader("service","isTable",["type"])],d.prototype,"readIsTable",null);c.__decorate([q.property({value:null,type:[I],json:{read:{source:"layerDefinition.drawingInfo.labelingInfo"},
write:{target:"layerDefinition.drawingInfo.labelingInfo",overridePolicy:T}}})],d.prototype,"labelingInfo",null);c.__decorate([z.writer("labelingInfo")],d.prototype,"writeLabelingInfo",null);c.__decorate([q.property({type:Boolean,value:!0,json:{read:{source:"layerDefinition.drawingInfo.showLabels"},write:{target:"layerDefinition.drawingInfo.showLabels",overridePolicy:T}}})],d.prototype,"labelsVisible",null);c.__decorate([q.property({value:null})],d.prototype,"layer",null);c.__decorate([q.property({type:String,
json:{write:{overridePolicy:ma}}})],d.prototype,"layerItemId",void 0);c.__decorate([q.property({type:Boolean,value:!0,json:{origins:{service:{read:{enabled:!1}}},read:{source:"showLegend"},write:{target:"showLegend",overridePolicy:fa}}})],d.prototype,"legendEnabled",void 0);c.__decorate([q.property({type:["show","hide","hide-children"],value:"show",json:{read:!1,write:!1,origins:{"web-scene":{read:!0,write:!0}}}})],d.prototype,"listMode",null);c.__decorate([q.property({type:Number,value:0,json:{write:{overridePolicy:T}}})],
d.prototype,"minScale",null);c.__decorate([N.reader("minScale",["minScale","layerDefinition.minScale"])],d.prototype,"readMinScale",null);c.__decorate([q.property({type:Number,value:0,json:{write:{overridePolicy:T}}})],d.prototype,"maxScale",null);c.__decorate([N.reader("maxScale",["maxScale","layerDefinition.maxScale"])],d.prototype,"readMaxScale",null);c.__decorate([q.property()],d.prototype,"objectIdField",void 0);c.__decorate([N.reader("service","objectIdField",["layerDefinition.objectIdField",
"layerDefinition.fields"])],d.prototype,"readObjectIdFieldFromService",null);c.__decorate([q.property({type:Number,value:1,json:{write:{target:"layerDefinition.drawingInfo.transparency",overridePolicy:T}}})],d.prototype,"opacity",null);c.__decorate([N.reader("opacity",["layerDefinition.drawingInfo.transparency","layerDefinition.transparency"])],d.prototype,"readOpacity",null);c.__decorate([z.writer("opacity")],d.prototype,"writeOpacity",null);c.__decorate([q.property({json:{type:Q.Integer,write:{target:"parentLayerId",
writerEnsuresNonNull:!0,overridePolicy:T}}})],d.prototype,"parent",void 0);c.__decorate([z.writer("parent")],d.prototype,"writeParent",null);c.__decorate([q.property({type:Boolean,value:!0,json:{read:{source:"disablePopup",reader(a,b){return!b.disablePopup}},write:{target:"disablePopup",overridePolicy:fa,writer(a,b,f){b[f]=!a}}}})],d.prototype,"popupEnabled",void 0);c.__decorate([q.property({type:w,json:{read:{source:"popupInfo"},write:{target:"popupInfo",overridePolicy:fa}}})],d.prototype,"popupTemplate",
void 0);c.__decorate([q.property({readOnly:!0})],d.prototype,"queryTask",null);c.__decorate([q.property({type:[da],readOnly:!0,json:{origins:{service:{read:{source:"layerDefinition.relationships"}}}}})],d.prototype,"relationships",void 0);c.__decorate([q.property({types:p.rendererTypes,value:null,json:{name:"layerDefinition.drawingInfo.renderer",write:{overridePolicy:T},origins:{"web-scene":{types:p.webSceneRendererTypes,name:"layerDefinition.drawingInfo.renderer",write:{overridePolicy:T}}}}})],d.prototype,
"renderer",null);c.__decorate([q.property({types:{key:"type",base:null,typeMap:{"data-layer":J.DataLayerSource,"map-layer":U.MapLayerSource}},cast(a){if(a){if("mapLayerId"in a)return Q.ensureClass(U.MapLayerSource,a);if("dataSource"in a)return Q.ensureClass(J.DataLayerSource,a)}return a},json:{name:"layerDefinition.source",write:{overridePolicy:T}}})],d.prototype,"source",null);c.__decorate([q.property()],d.prototype,"sourceJSON",void 0);c.__decorate([q.property({type:va,json:{origins:{service:{read:{source:"layerDefinition.extent.spatialReference"}}}}})],
d.prototype,"spatialReference",void 0);c.__decorate([q.property({value:null,json:{type:[Q.Integer],write:{target:"subLayerIds",allowNull:!0,overridePolicy:T}}})],d.prototype,"sublayers",null);c.__decorate([R.cast("sublayers")],d.prototype,"castSublayers",null);c.__decorate([z.writer("sublayers")],d.prototype,"writeSublayers",null);c.__decorate([q.property({type:String,json:{name:"name",write:{overridePolicy:fa}}})],d.prototype,"title",void 0);c.__decorate([N.reader("service","title",["name","layerDefinition.name"])],
d.prototype,"readTitle",null);c.__decorate([q.property({type:String})],d.prototype,"typeIdField",void 0);c.__decorate([q.property({json:{read:!1},readOnly:!0,value:"sublayer"})],d.prototype,"type",void 0);c.__decorate([N.reader("typeIdField",["layerDefinition.typeIdField"])],d.prototype,"readTypeIdField",null);c.__decorate([q.property({type:[ea],json:{origins:{service:{read:{source:"layerDefinition.types"}}}}})],d.prototype,"types",void 0);c.__decorate([q.property({type:String,json:{name:"layerUrl",
write:{overridePolicy:ma}}})],d.prototype,"url",null);c.__decorate([q.property({type:Boolean,value:!0,json:{read:{source:"defaultVisibility"},write:{target:"defaultVisibility",overridePolicy:T}}})],d.prototype,"visible",null);c.__decorate([z.writer("visible")],d.prototype,"writeVisible",null);return d=ha=c.__decorate([Y.subclass("esri.layers.support.Sublayer")],d)})},"esri/layers/support/sublayerUtils":function(){define(["exports","../../core/accessorSupport/PropertyOrigin"],function(k,c){function d(w,
e){if(!w?.length||null==e)return!0;e=e.slice().reverse().flatten(({sublayers:x})=>x&&x.toArray().reverse()).map(x=>x.id).toArray();if(w.length>e.length)return!1;let n=0;const g=e.length;for(const {id:x}of w){for(;n<g&&e[n]!==x;)n++;if(n>=g)return!1}return!0}k.isExportDynamic=function(w,e,n){return w.some(g=>{var x=g.source;x=!x||"map-layer"===x.type&&x.mapLayerId===g.id&&(null==x.gdbVersion||x.gdbVersion===n);g.commitProperty("renderer");g.commitProperty("labelingInfo");g.commitProperty("opacity");
g.commitProperty("labelsVisible");return!x||g.originIdOf("renderer")>c.OriginId.SERVICE||g.originIdOf("labelingInfo")>c.OriginId.SERVICE||g.originIdOf("opacity")>c.OriginId.SERVICE||g.originIdOf("labelsVisible")>c.OriginId.SERVICE})?!0:!d(w,e)};k.isSublayerOverhaul=function(w){return!!w&&w.some(e=>null!=e.minScale||null!=e.layerDefinition?.minScale)};k.shouldWriteSublayerStructure=function(w,e,n){return e.flatten(({sublayers:g})=>g).length!==w.length||w.some(g=>g.originIdOf("minScale")>n||g.originIdOf("maxScale")>
n||g.originIdOf("renderer")>n||g.originIdOf("labelingInfo")>n||g.originIdOf("opacity")>n||g.originIdOf("labelsVisible")>n||g.originIdOf("source")>n)?!0:!d(w,e)};Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/ExportImageParameters":function(){define("exports ../../chunks/tslib.es6 ../../core/Accessor ../../core/sql ../../core/accessorSupport/decorators/property ../../core/has ../../core/Logger ../../core/RandomLCG ../../core/accessorSupport/decorators/subclass ../../geometry/support/scaleUtils ./floorFilterUtils ./sublayerUtils".split(" "),
function(k,c,d,w,e,n,g,x,W,ba,X,V){const C={visible:"visibleSublayers",definitionExpression:"layerDefs",labelingInfo:"hasDynamicLayers",labelsVisible:"hasDynamicLayers",opacity:"hasDynamicLayers",minScale:"visibleSublayers",maxScale:"visibleSublayers",renderer:"hasDynamicLayers",source:"hasDynamicLayers"};k.ExportImageParameters=class extends d{constructor(p){super(p);this.floors=null;this.scale=0}destroy(){this.layer=null}get dynamicLayers(){if(!this.hasDynamicLayers)return null;const p=this.visibleSublayers.map(D=>
{const K=X.getLayerFloorFilterClause(this.floors,D);return D.toExportImageJSON(K)});return p.length?JSON.stringify(p):null}get hasDynamicLayers(){return this.layer&&V.isExportDynamic(this.visibleSublayers,this.layer.serviceSublayers,this.layer.gdbVersion)}set layer(p){this._get("layer")!==p&&(this._set("layer",p),this.removeHandles("layer"),p&&this.addHandles([p.allSublayers.on("change",()=>this.notifyChange("visibleSublayers")),p.on("sublayer-update",D=>this.notifyChange(C[D.propertyName]))],"layer"))}get layers(){const p=
this.visibleSublayers;return p?p.length?"show:"+p.map(D=>D.id).join(","):"show:-1":null}get layerDefs(){const p=!!this.floors?.length,D=this.visibleSublayers.filter(K=>null!=K.definitionExpression||p&&null!=K.floorInfo);return D.length?JSON.stringify(D.reduce((K,M)=>{var u=X.getLayerFloorFilterClause(this.floors,M);u=w.sqlAnd(u,M.definitionExpression);null!=u&&(K[M.id]=u);return K},{})):null}get version(){this.commitProperty("layers");this.commitProperty("layerDefs");this.commitProperty("dynamicLayers");
const p=this.layer;p&&(p.commitProperty("dpi"),p.commitProperty("imageFormat"),p.commitProperty("imageTransparency"),p.commitProperty("gdbVersion"));return(this._get("version")||0)+1}get visibleSublayers(){const p=[];if(!this.layer)return p;var D=this.layer.sublayers;const K=this.scale,M=u=>{u.visible&&(0===K||ba.isInScaleRange(K,u.minScale,u.maxScale))&&(u.sublayers?u.sublayers.forEach(M):p.unshift(u))};D&&D.forEach(M);D=this._get("visibleSublayers");return!D||D.length!==p.length||D.some((u,F)=>
p[F]!==u)?p:D}toJSON(){var p=this.layer;p={dpi:p.dpi,format:p.imageFormat,transparent:p.imageTransparency,gdbVersion:p.gdbVersion||null};this.hasDynamicLayers&&this.dynamicLayers?p.dynamicLayers=this.dynamicLayers:p={...p,layers:this.layers,layerDefs:this.layerDefs};return p}};c.__decorate([e.property({readOnly:!0})],k.ExportImageParameters.prototype,"dynamicLayers",null);c.__decorate([e.property()],k.ExportImageParameters.prototype,"floors",void 0);c.__decorate([e.property({readOnly:!0})],k.ExportImageParameters.prototype,
"hasDynamicLayers",null);c.__decorate([e.property()],k.ExportImageParameters.prototype,"layer",null);c.__decorate([e.property({readOnly:!0})],k.ExportImageParameters.prototype,"layers",null);c.__decorate([e.property({readOnly:!0})],k.ExportImageParameters.prototype,"layerDefs",null);c.__decorate([e.property({type:Number})],k.ExportImageParameters.prototype,"scale",void 0);c.__decorate([e.property({readOnly:!0})],k.ExportImageParameters.prototype,"version",null);c.__decorate([e.property({readOnly:!0})],
k.ExportImageParameters.prototype,"visibleSublayers",null);k.ExportImageParameters=c.__decorate([W.subclass("esri.layers.support.ExportImageParameters")],k.ExportImageParameters);Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/floorFilterUtils":function(){define(["exports"],function(k){function c(d,w){if(!d?.length)return null;d=d.filter(e=>""!==e).map(e=>`'${e}'`);d.push("''");return`${w} IN (${d.join(",")}) OR ${w} IS NULL`}k.getFloorFilterClause=function(d){const w=
d.layer;return"floorInfo"in w&&w.floorInfo?.floorField&&"floors"in d.view?c(d.view.floors,w.floorInfo.floorField):null};k.getLayerFloorFilterClause=function(d,w){return"floorInfo"in w&&w.floorInfo?.floorField?c(d,w.floorInfo.floorField):null};Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/imageBitmapUtils":function(){define(["exports","../../core/Error","../../core/promiseUtils"],function(k,c,d){k.createBitmap=async function(w,e,n){let g;try{g=await createImageBitmap(w)}catch(x){throw new c("request:server",
`Unable to load ${e}`,{url:e,error:x});}d.throwIfAborted(n);return g};k.createTileBitmap=async function(w,e,n,g,x){let W;try{W=await createImageBitmap(w)}catch(ba){throw new c("request:server",`Unable to load tile ${e}/${n}/${g}`,{error:ba,level:e,row:n,col:g});}d.throwIfAborted(x);return W};Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"*noref":1}});
define("../chunks/tslib.es6 ../request ../core/Error ../core/loadAll ../core/MultiOriginJSONSupport ../core/promiseUtils ../core/accessorSupport/decorators/property ../core/accessorSupport/ensureType ../core/RandomLCG ../core/has ../core/accessorSupport/decorators/reader ../core/accessorSupport/decorators/subclass ../core/accessorSupport/decorators/writer ../core/accessorSupport/PropertyOrigin ../geometry/Extent ../geometry/support/scaleUtils ../geometry/support/spatialReferenceUtils ./Layer ./mixins/APIKeyMixin ./mixins/ArcGISMapService ./mixins/ArcGISService ./mixins/BlendLayer ./mixins/CustomParametersMixin ./mixins/OperationalLayer ./mixins/PortalLayer ./mixins/RefreshableLayer ./mixins/ScaleRangeLayer ./mixins/SublayersOwner ./mixins/TemporalLayer ./support/commonProperties ./support/ExportImageParameters ./support/imageBitmapUtils ./support/Sublayer ./support/sublayerUtils ./support/versionUtils ../time/TimeExtent ../time/timeZoneUtils".split(" "),function(k,
c,d,w,e,n,g,x,W,ba,X,V,C,p,D,K,M,u,F,r,h,l,t,v,G,P,q,R,N,Y,z,Q,A,ca,ia,ja,ea){e=class extends l.BlendLayer(N.TemporalLayer(q.ScaleRangeLayer(R.SublayersOwner(r.ArcGISMapService(h.ArcGISService(v.OperationalLayer(G.PortalLayer(e.MultiOriginJSONMixin(P.RefreshableLayer(F.APIKeyMixin(t.CustomParametersMixin(u)))))))))))){constructor(...m){super(...m);this._exportImageParameters=new z.ExportImageParameters({layer:this});this.dateFieldsTimeZone=null;this.datesInUnknownTimezone=!1;this.dpi=96;this.gdbVersion=
null;this.imageFormat="png24";this.imageMaxWidth=this.imageMaxHeight=2048;this.imageTransparency=!0;this.isReference=null;this.labelsVisible=!1;this.operationalLayerType="ArcGISMapServiceLayer";this.sublayers=this.sourceJSON=this.preferredTimeZone=null;this.type="map-image";this.url=null}normalizeCtorArgs(m,B){return"string"===typeof m?{url:m,...B}:m}load(m){const B=null!=m?m.signal:null;this.addResolvingPromise(this.loadFromPortal({supportedTypes:["Map Service"]},m).catch(n.throwIfAbortError).then(()=>
this._fetchService(B)));return Promise.resolve(this)}destroy(){this._exportImageParameters.destroy()}readImageFormat(m,B){return(m=B.supportedImageFormatTypes)&&m.includes("PNG32")?"png32":"png24"}writeSublayers(m,B,L,I){if(this.loaded&&m){m=m.slice().reverse().flatten(({sublayers:J})=>J&&J.toArray().reverse()).toArray();var H=!1;L=p.nameToId(I.origin);this.capabilities?.operations.supportsExportMap&&this.capabilities?.exportMap?.supportsDynamicLayers&&(L===p.OriginId.PORTAL_ITEM?(H=this.createSublayersForOrigin("service").sublayers,
H=ca.shouldWriteSublayerStructure(m,H,p.OriginId.SERVICE)):L>p.OriginId.PORTAL_ITEM&&(H=this.createSublayersForOrigin("portal-item"),H=ca.shouldWriteSublayerStructure(m,H.sublayers,p.nameToId(H.origin))));var O=[],da={writeSublayerStructure:H,...I},Z=H||this.hasVisibleLayersForOrigin(L);m.forEach(J=>{const U=J.write({},da);O.push(U);Z=Z||"user"===J.originOf("visible")});O.some(J=>1<Object.keys(J).length)&&(B.layers=O);Z&&(B.visibleLayers=m.filter(J=>J.visible).map(J=>J.id))}}createExportImageParameters(m,
B,L,I){var H=I?.pixelRatio||1;m&&10<=this.version&&(m=m.clone().shiftCentralMeridian());this._exportImageParameters.floors=I?.floors??null;this._exportImageParameters.scale=K.getScale({extent:m,width:B})*H;const O=this._exportImageParameters.toJSON(),da=!I?.rotation||10.3>this.version?{}:{rotation:-I.rotation},Z=M.srToRESTValue(m?.spatialReference);O.dpi*=H;H={};if(I?.timeExtent){const {start:J,end:U}=I.timeExtent.toJSON();H.time=J&&U&&J===U?""+J:`${null==J?"null":J},${null==U?"null":U}`}else this.timeInfo&&
!this.timeInfo.hasLiveData&&(H.time="null,null");return{bbox:m&&m.xmin+","+m.ymin+","+m.xmax+","+m.ymax,bboxSR:Z,imageSR:Z,size:B+","+L,...O,...da,...H}}async fetchImage(m,B,L,I){({data:m}=await this._fetchImage("image",m,B,L,I));return m}async fetchImageBitmap(m,B,L,I){const {data:H,url:O}=await this._fetchImage("blob",m,B,L,I);return Q.createBitmap(H,O,I?.signal)}async fetchRecomputedExtents(m={}){({data:m}=await c(this.url,{...m,query:{returnUpdates:!0,f:"json",...this.customParameters,token:this.apiKey}}));
const {extent:B,fullExtent:L,timeExtent:I}=m;m=B||L;return{fullExtent:m&&D.fromJSON(m),timeExtent:I&&ja.fromJSON({start:I[0],end:I[1]})}}loadAll(){return w.loadAll(this,m=>{m(this.allSublayers);m(this.subtables)})}serviceSupportsSpatialReference(m){return ia.serviceSupportsSpatialReference(this,m)}async _fetchImage(m,B,L,I,H){m={responseType:m,signal:H?.signal??null,query:{...this.parsedUrl.query,...this.createExportImageParameters(B,L,I,H),f:"image",...this.refreshParameters,...this.customParameters,
token:this.apiKey}};B=this.parsedUrl.path+"/export";if(null!=m.query?.dynamicLayers&&!this.capabilities?.exportMap?.supportsDynamicLayers)throw new d("mapimagelayer:dynamiclayer-not-supported",`service ${this.url} doesn't support dynamic layers, which is required to be able to change the sublayer's order, rendering, labeling or source.`,{query:m.query});try{const {data:O}=await c(B,m);return{data:O,url:B}}catch(O){if(n.isAbortError(O))throw O;throw new d("mapimagelayer:image-fetch-error",`Unable to load image: ${B}`,
{error:O});}}async _fetchService(m){if(this.sourceJSON)this.read(this.sourceJSON,{origin:"service",url:this.parsedUrl});else{var {data:B,ssl:L}=await c(this.parsedUrl.path,{query:{f:"json",...this.parsedUrl.query,...this.customParameters,token:this.apiKey},signal:m});L&&(this.url=this.url.replace(/^http:/i,"https:"));this.sourceJSON=B;this.read(B,{origin:"service",url:this.parsedUrl})}}hasVisibleLayersForOrigin(m){return!(null==m||!this.sublayersSourceJSON[m]?.visibleLayers)}};k.__decorate([g.property(ea.timeZoneProperty("dateFieldsTimeReference"))],
e.prototype,"dateFieldsTimeZone",void 0);k.__decorate([g.property({type:Boolean})],e.prototype,"datesInUnknownTimezone",void 0);k.__decorate([g.property()],e.prototype,"dpi",void 0);k.__decorate([g.property()],e.prototype,"gdbVersion",void 0);k.__decorate([g.property()],e.prototype,"imageFormat",void 0);k.__decorate([X.reader("imageFormat",["supportedImageFormatTypes"])],e.prototype,"readImageFormat",null);k.__decorate([g.property({json:{origins:{service:{read:{source:"maxImageHeight"}}}}})],e.prototype,
"imageMaxHeight",void 0);k.__decorate([g.property({json:{origins:{service:{read:{source:"maxImageWidth"}}}}})],e.prototype,"imageMaxWidth",void 0);k.__decorate([g.property()],e.prototype,"imageTransparency",void 0);k.__decorate([g.property({type:Boolean,json:{read:!1,write:{enabled:!0,overridePolicy:()=>({enabled:!1})}}})],e.prototype,"isReference",void 0);k.__decorate([g.property({json:{read:!1,write:!1}})],e.prototype,"labelsVisible",void 0);k.__decorate([g.property({type:["ArcGISMapServiceLayer"]})],
e.prototype,"operationalLayerType",void 0);k.__decorate([g.property({json:{read:!1,write:!1}})],e.prototype,"popupEnabled",void 0);k.__decorate([g.property(ea.timeZoneProperty("preferredTimeReference"))],e.prototype,"preferredTimeZone",void 0);k.__decorate([g.property()],e.prototype,"sourceJSON",void 0);k.__decorate([g.property({json:{write:{ignoreOrigin:!0}}})],e.prototype,"sublayers",void 0);k.__decorate([C.writer("sublayers",{layers:{type:[A]},visibleLayers:{type:[x.Integer]}})],e.prototype,"writeSublayers",
null);k.__decorate([g.property({type:["show","hide","hide-children"]})],e.prototype,"listMode",void 0);k.__decorate([g.property({json:{read:!1},readOnly:!0,value:"map-image"})],e.prototype,"type",void 0);k.__decorate([g.property(Y.url)],e.prototype,"url",void 0);return e=k.__decorate([V.subclass("esri.layers.MapImageLayer")],e)});