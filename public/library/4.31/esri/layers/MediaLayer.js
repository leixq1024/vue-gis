// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.31/esri/copyright.txt for details.
//>>built
require({cache:{"esri/layers/support/ControlPointsGeoreference":function(){define("../../chunks/tslib.es6 ../../core/Clonable ../../core/Error ../../core/JSONSupport ../../core/Logger ../../core/perspectiveUtils ../../core/screenUtils ../../core/accessorSupport/decorators/property ../../core/has ../../core/RandomLCG ../../core/accessorSupport/decorators/reader ../../core/accessorSupport/decorators/subclass ../../core/accessorSupport/decorators/writer ../../core/libs/gl-matrix-2/math/mat3 ../../core/libs/gl-matrix-2/factories/mat3f64 ../../core/libs/gl-matrix-2/math/vec2 ../../core/libs/gl-matrix-2/factories/vec2f64 ../../geometry/Point ../../geometry/Polygon ../../geometry/projection ../../geometry/SpatialReference ./GeoreferenceBase".split(" "),
function(e,F,R,P,I,x,J,q,H,T,Q,E,C,N,h,y,w,A,M,K,c,r){function u(p){return null!=p?.sourcePoint&&null!=p.mapPoint}function v(p,D,U){y.set(p,U.sourcePoint.x,U.sourcePoint.y);y.set(D,U.mapPoint.x,U.mapPoint.y)}function S(p,D,U){v(B,b,D);v(O,m,U);y.rotate(Y,O,B,f);y.rotate(a,B,O,f);y.rotate(G,m,b,-f);y.rotate(d,b,m,-f);D=b;U=m;var V=G,X=d;return x.getProjectiveTransform(p,z(n,B,O,Y,a),z(L,D,U,V,X))}function k(p,D,U,V){v(B,b,D);v(O,m,U);v(Y,G,V);y.lerp(a,B,O,.5);y.rotate(a,Y,a,Math.PI);y.lerp(d,b,m,.5);
y.rotate(d,G,d,Math.PI);D=b;U=m;V=G;var X=d;return x.getProjectiveTransform(p,z(n,B,O,Y,a),z(L,D,U,V,X))}function g(p,D,U,V,X){v(B,b,D);v(O,m,U);v(Y,G,V);v(a,d,X);D=b;U=m;V=G;X=d;return x.getProjectiveTransform(p,z(n,B,O,Y,a),z(L,D,U,V,X))}function z(p,D,U,V,X){p[0]=D[0];p[1]=D[1];p[2]=U[0];p[3]=U[1];p[4]=V[0];p[5]=V[1];p[6]=X[0];p[7]=X[1];return p}const l=h.create(),t=w.create();H=class extends P.JSONSupport{};e.__decorate([q.property({type:Number,json:{write:!0}})],H.prototype,"x",void 0);e.__decorate([q.property({type:Number,
json:{write:!0}})],H.prototype,"y",void 0);H=e.__decorate([E.subclass("esri.layers.support.ControlPointsGeoreference.ControlPointJSONType")],H);F=class extends F.Clonable{constructor(){super(...arguments);this.mapPoint=this.sourcePoint=null}};e.__decorate([q.property()],F.prototype,"sourcePoint",void 0);e.__decorate([q.property({type:A})],F.prototype,"mapPoint",void 0);F=e.__decorate([E.subclass("esri.layers.support.ControlPointsGeoreference.ControlPoint")],F);P=class extends P.JSONSupportMixin(r){constructor(p){super(p);
this.controlPoints=null;this.height=0;this.type="control-points";this.width=0}readControlPoints(p,D){const U=c.fromJSON(D.spatialReference),V=h.fromValues(...D.coefficients,1);return p.map(X=>{y.set(t,X.x,X.y);x.transformProjective(t,t,V);return{sourcePoint:X,mapPoint:new A({x:t[0],y:t[1],spatialReference:U})}})}writeControlPoints(p,D,U,V){null==this.transform?(p=new R("web-document-write:invalid-georeference","Invalid 'controlPoints', 'width', 'height' configuration. Make sure the parent media element is loaded i.e. the ImageElement or VideoElement set as 'MediaLayer.source'.",
{layer:V?.layer,georeference:this}),V?.messages?V.messages.push(p):I.getLogger(this).error(p.name,p.message)):null!=p&&u(p[0])&&(D.controlPoints=p.map(X=>{X=X.sourcePoint;return{x:X.x,y:X.y}}),D.spatialReference=p[0].mapPoint.spatialReference.toJSON(),D.coefficients=this.transform.slice(0,8))}get coords(){if(null==this.controlPoints)return null;const p=this._updateTransform(l);if(null==p||!u(this.controlPoints[0]))return null;var D=this.width,U=this.height,V=this.controlPoints[0].mapPoint.spatialReference;
const X=w.fromValues(0,U),W=w.fromValues(0,0),ba=w.fromValues(D,0);D=w.fromValues(D,U);x.transformProjective(X,X,p);x.transformProjective(W,W,p);x.transformProjective(ba,ba,p);x.transformProjective(D,D,p);return new M({rings:[[X,W,ba,D,X]],spatialReference:V})}set coords(p){if(null!=this.controlPoints&&u(this.controlPoints[0])){var D=this.controlPoints[0].mapPoint.spatialReference;p=this.projectOrWarn(p,D);if(null!=p){var {width:U,height:V}=this,{rings:[[X,W,ba,da]]}=p;p={sourcePoint:J.createScreenPoint(0,
V),mapPoint:new A({x:X[0],y:X[1],spatialReference:D})};var aa={sourcePoint:J.createScreenPoint(0,0),mapPoint:new A({x:W[0],y:W[1],spatialReference:D})},ca={sourcePoint:J.createScreenPoint(U,0),mapPoint:new A({x:ba[0],y:ba[1],spatialReference:D})},Z={sourcePoint:J.createScreenPoint(U,V),mapPoint:new A({x:da[0],y:da[1],spatialReference:D})};u(p)&&u(aa)&&u(ca)&&u(Z)&&(g(l,p,aa,ca,Z),this.controlPoints=this.controlPoints.map(({sourcePoint:ea})=>{y.set(t,ea.x,ea.y);x.transformProjective(t,t,l);return{sourcePoint:ea,
mapPoint:new A({x:t[0],y:t[1],spatialReference:D})}}))}}}get inverseTransform(){return null==this.transform?null:N.invert(h.create(),this.transform)}get transform(){return this._updateTransform()}toMap(p){if(null==p||null==this.transform||null==this.controlPoints||!u(this.controlPoints[0]))return null;y.set(t,p.x,p.y);p=this.controlPoints[0].mapPoint.spatialReference;x.transformProjective(t,t,this.transform);return new A({x:t[0],y:t[1],spatialReference:p})}toSource(p){if(null==p||null==this.inverseTransform||
null==this.controlPoints||!u(this.controlPoints[0]))return null;const D=this.controlPoints[0].mapPoint.spatialReference;p=p.normalize();p=K.projectOrLoad(p,D).geometry;if(null==p)return null;y.set(t,p.x,p.y);x.transformProjective(t,t,this.inverseTransform);return J.createScreenPoint(t[0],t[1])}toSourceNormalized(p){p=this.toSource(p);null!=p&&(p.x/=this.width,p.y/=this.height);return p}_updateTransform(p){const {controlPoints:D,width:U,height:V}=this;if(!(null!=D&&0<U&&0<V))return null;const [X,W,
ba,da]=D;if(!u(X))return null;var aa=X.mapPoint.spatialReference;const ca=this._projectControlPoint(W,aa),Z=this._projectControlPoint(ba,aa);aa=this._projectControlPoint(da,aa);if(!(ca.valid&&Z.valid&&aa.valid&&u(ca.controlPoint)))return null;null==p&&(p=h.create());let ea=null;ea=u(Z.controlPoint)&&u(aa.controlPoint)?g(p,X,ca.controlPoint,Z.controlPoint,aa.controlPoint):u(Z.controlPoint)?k(p,X,ca.controlPoint,Z.controlPoint):S(p,X,ca.controlPoint);return ea.every(fa=>0===fa)?null:ea}_projectControlPoint(p,
D){if(!u(p))return{valid:!0,controlPoint:p};const {sourcePoint:U,mapPoint:V}=p,{geometry:X,pending:W}=K.projectOrLoad(V,D);return W?{valid:!1,controlPoint:null}:W||X?{valid:!0,controlPoint:{sourcePoint:U,mapPoint:X}}:(I.getLogger(this).warn("map point could not be projected to the spatial reference",{georeference:this,controlPoint:p,sourceSpatialReference:V.spatialReference,targetSpatialReference:D}),{valid:!1,controlPoint:null})}};e.__decorate([q.property({type:[F],json:{write:{allowNull:!1,isRequired:!0,
target:{controlPoints:{type:[H]},coefficients:{type:[Number]},spatialReference:{type:c}}}}})],P.prototype,"controlPoints",void 0);e.__decorate([Q.reader("controlPoints")],P.prototype,"readControlPoints",null);e.__decorate([C.writer("controlPoints")],P.prototype,"writeControlPoints",null);e.__decorate([q.property({clonable:!1})],P.prototype,"coords",null);e.__decorate([q.property({type:Number,nonNullable:!0,json:{write:!0}})],P.prototype,"height",void 0);e.__decorate([q.property({readOnly:!0})],P.prototype,
"inverseTransform",null);e.__decorate([q.property({readOnly:!0})],P.prototype,"transform",null);e.__decorate([q.property({type:Number,nonNullable:!0,json:{write:!0}})],P.prototype,"width",void 0);P=e.__decorate([E.subclass("esri.layers.support.ControlPointsGeoreference")],P);const B=w.create(),O=w.create(),Y=w.create(),a=w.create(),b=w.create(),m=w.create(),G=w.create(),d=w.create(),f=Math.PI/2,n=Array(8).fill(0),L=Array(8).fill(0);return P})},"esri/core/perspectiveUtils":function(){define("exports ./libs/gl-matrix-2/math/mat3 ./libs/gl-matrix-2/factories/mat3f64 ./libs/gl-matrix-2/math/vec2 ../chunks/vec32 ./libs/gl-matrix-2/factories/vec3f64".split(" "),
function(e,F,R,P,I,x){function J(E,C,N,h,y,w,A,M,K){F.set(E,C,h,w,N,y,A,1,1,1);I.set(q,M,K,1);F.adjoint(H,E);const [c,r,u]=I.transformMat3(q,q,F.transpose(H,H));F.set(H,c,0,0,0,r,0,0,0,u);return F.multiply(E,H,E)}const q=x.create(),H=R.create(),T=R.create(),Q=R.create();e.getProjectiveTransform=function(E,C,N){J(T,C[0],C[1],C[2],C[3],C[4],C[5],C[6],C[7]);J(Q,N[0],N[1],N[2],N[3],N[4],N[5],N[6],N[7]);F.multiply(E,F.adjoint(T,T),Q);0!==E[8]&&(E[0]/=E[8],E[1]/=E[8],E[2]/=E[8],E[3]/=E[8],E[4]/=E[8],E[5]/=
E[8],E[6]/=E[8],E[7]/=E[8],E[8]/=E[8]);return E};e.transformProjective=function(E,C,N){I.set(q,C[0],C[1],1);I.transformMat3(q,q,F.transpose(H,N));return 0===q[2]?P.set(E,q[0],q[1]):P.set(E,q[0]/q[2],q[1]/q[2])};Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/core/libs/gl-matrix-2/math/mat3":function(){define(["exports","./common"],function(e,F){function R(a,b){a[0]=b[0];a[1]=b[1];a[2]=b[2];a[3]=b[4];a[4]=b[5];a[5]=b[6];a[6]=b[8];a[7]=b[9];a[8]=b[10];return a}function P(a,b){a[0]=
b[0];a[1]=b[1];a[2]=b[2];a[3]=b[3];a[4]=b[4];a[5]=b[5];a[6]=b[6];a[7]=b[7];a[8]=b[8];return a}function I(a,b,m,G,d,f,n,L,p,D){a[0]=b;a[1]=m;a[2]=G;a[3]=d;a[4]=f;a[5]=n;a[6]=L;a[7]=p;a[8]=D;return a}function x(a){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=1;a[5]=0;a[6]=0;a[7]=0;a[8]=1;return a}function J(a,b){if(a===b){const m=b[1],G=b[2],d=b[5];a[1]=b[3];a[2]=b[6];a[3]=m;a[5]=b[7];a[6]=G;a[7]=d}else a[0]=b[0],a[1]=b[3],a[2]=b[6],a[3]=b[1],a[4]=b[4],a[5]=b[7],a[6]=b[2],a[7]=b[5],a[8]=b[8];return a}function q(a,
b){const m=b[0],G=b[1],d=b[2],f=b[3],n=b[4],L=b[5],p=b[6],D=b[7];b=b[8];const U=b*n-L*D,V=-b*f+L*p,X=D*f-n*p;let W=m*U+G*V+d*X;if(!W)return null;W=1/W;a[0]=U*W;a[1]=(-b*G+d*D)*W;a[2]=(L*G-d*n)*W;a[3]=V*W;a[4]=(b*m-d*p)*W;a[5]=(-L*m+d*f)*W;a[6]=X*W;a[7]=(-D*m+G*p)*W;a[8]=(n*m-G*f)*W;return a}function H(a,b){const m=b[0],G=b[1],d=b[2],f=b[3],n=b[4],L=b[5],p=b[6],D=b[7];b=b[8];a[0]=n*b-L*D;a[1]=d*D-G*b;a[2]=G*L-d*n;a[3]=L*p-f*b;a[4]=m*b-d*p;a[5]=d*f-m*L;a[6]=f*D-n*p;a[7]=G*p-m*D;a[8]=m*n-G*f;return a}
function T(a){const b=a[3],m=a[4],G=a[5],d=a[6],f=a[7],n=a[8];return a[0]*(n*m-G*f)+a[1]*(-n*b+G*d)+a[2]*(f*b-m*d)}function Q(a,b,m){const G=b[0],d=b[1],f=b[2],n=b[3],L=b[4],p=b[5],D=b[6],U=b[7];b=b[8];const V=m[0],X=m[1],W=m[2],ba=m[3],da=m[4],aa=m[5],ca=m[6],Z=m[7];m=m[8];a[0]=V*G+X*n+W*D;a[1]=V*d+X*L+W*U;a[2]=V*f+X*p+W*b;a[3]=ba*G+da*n+aa*D;a[4]=ba*d+da*L+aa*U;a[5]=ba*f+da*p+aa*b;a[6]=ca*G+Z*n+m*D;a[7]=ca*d+Z*L+m*U;a[8]=ca*f+Z*p+m*b;return a}function E(a,b,m){const G=b[0],d=b[1],f=b[2],n=b[3],
L=b[4],p=b[5],D=b[6],U=b[7];b=b[8];const V=m[0];m=m[1];a[0]=G;a[1]=d;a[2]=f;a[3]=n;a[4]=L;a[5]=p;a[6]=V*G+m*n+D;a[7]=V*d+m*L+U;a[8]=V*f+m*p+b;return a}function C(a,b,m){const G=b[0],d=b[1],f=b[2],n=b[3],L=b[4],p=b[5],D=b[6],U=b[7];b=b[8];const V=Math.sin(m);m=Math.cos(m);a[0]=m*G+V*n;a[1]=m*d+V*L;a[2]=m*f+V*p;a[3]=m*n-V*G;a[4]=m*L-V*d;a[5]=m*p-V*f;a[6]=D;a[7]=U;a[8]=b;return a}function N(a,b,m){const G=m[0],d=m[1];m=m[2];a[0]=G*b[0];a[1]=G*b[1];a[2]=G*b[2];a[3]=d*b[3];a[4]=d*b[4];a[5]=d*b[5];a[6]=
m*b[6];a[7]=m*b[7];a[8]=m*b[8];return a}function h(a,b,m){const G=m[0];m=m[1];a[0]=G*b[0];a[1]=G*b[1];a[2]=G*b[2];a[3]=m*b[3];a[4]=m*b[4];a[5]=m*b[5];return a}function y(a,b){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=1;a[5]=0;a[6]=b[0];a[7]=b[1];a[8]=1;return a}function w(a,b){const m=Math.sin(b);b=Math.cos(b);a[0]=b;a[1]=m;a[2]=0;a[3]=-m;a[4]=b;a[5]=0;a[6]=0;a[7]=0;a[8]=1;return a}function A(a,b){a[0]=b[0];a[1]=0;a[2]=0;a[3]=0;a[4]=b[1];a[5]=0;a[6]=0;a[7]=0;a[8]=1;return a}function M(a,b){a[0]=b[0];a[1]=
b[1];a[2]=0;a[3]=b[2];a[4]=b[3];a[5]=0;a[6]=b[4];a[7]=b[5];a[8]=1;return a}function K(a,b){var m=b[0],G=b[1],d=b[2];b=b[3];var f=m+m,n=G+G;const L=d+d;m*=f;const p=G*f;G*=n;const D=d*f,U=d*n;d*=L;f*=b;n*=b;b*=L;a[0]=1-G-d;a[3]=p-b;a[6]=D+n;a[1]=p+b;a[4]=1-m-d;a[7]=U-f;a[2]=D-n;a[5]=U+f;a[8]=1-m-G;return a}function c(a,b){const m=b[0],G=b[1],d=b[2],f=b[4],n=b[5],L=b[6],p=b[8],D=b[9];b=b[10];const U=b*n-L*D,V=-b*f+L*p,X=D*f-n*p;var W=m*U+G*V+d*X;if(!W)return null;W=1/W;a[0]=U*W;a[1]=(-b*G+d*D)*W;a[2]=
(L*G-d*n)*W;a[3]=V*W;a[4]=(b*m-d*p)*W;a[5]=(-L*m+d*f)*W;a[6]=X*W;a[7]=(-D*m+G*p)*W;a[8]=(n*m-G*f)*W;return a}function r(a,b){const m=b[0],G=b[1],d=b[2],f=b[3],n=b[4],L=b[5],p=b[6],D=b[7];var U=b[8],V=b[9],X=b[10],W=b[11];const ba=b[12],da=b[13],aa=b[14];b=b[15];const ca=m*L-G*n,Z=m*p-d*n,ea=m*D-f*n,fa=G*p-d*L,ha=G*D-f*L,ia=d*D-f*p,ja=U*da-V*ba,ka=U*aa-X*ba;U=U*b-W*ba;const la=V*aa-X*da;V=V*b-W*da;X=X*b-W*aa;W=ca*X-Z*V+ea*la+fa*U-ha*ka+ia*ja;if(!W)return null;W=1/W;a[0]=(L*X-p*V+D*la)*W;a[1]=(p*U-
n*X-D*ka)*W;a[2]=(n*V-L*U+D*ja)*W;a[3]=(d*V-G*X-f*la)*W;a[4]=(m*X-d*U+f*ka)*W;a[5]=(G*U-m*V-f*ja)*W;a[6]=(da*ia-aa*ha+b*fa)*W;a[7]=(aa*ea-ba*ia-b*Z)*W;a[8]=(ba*ha-da*ea+b*ca)*W;return a}function u(a,b,m){a[0]=2/b;a[1]=0;a[2]=0;a[3]=0;a[4]=-2/m;a[5]=0;a[6]=-1;a[7]=1;a[8]=1;return a}function v(a){return"mat3("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+")"}function S(a){return Math.sqrt(a[0]**2+a[1]**2+a[2]**2+a[3]**2+a[4]**2+a[5]**2+a[6]**2+a[7]**2+a[8]**2)}
function k(a,b,m){a[0]=b[0]+m[0];a[1]=b[1]+m[1];a[2]=b[2]+m[2];a[3]=b[3]+m[3];a[4]=b[4]+m[4];a[5]=b[5]+m[5];a[6]=b[6]+m[6];a[7]=b[7]+m[7];a[8]=b[8]+m[8];return a}function g(a,b,m){a[0]=b[0]-m[0];a[1]=b[1]-m[1];a[2]=b[2]-m[2];a[3]=b[3]-m[3];a[4]=b[4]-m[4];a[5]=b[5]-m[5];a[6]=b[6]-m[6];a[7]=b[7]-m[7];a[8]=b[8]-m[8];return a}function z(a,b,m){a[0]=b[0]*m;a[1]=b[1]*m;a[2]=b[2]*m;a[3]=b[3]*m;a[4]=b[4]*m;a[5]=b[5]*m;a[6]=b[6]*m;a[7]=b[7]*m;a[8]=b[8]*m;return a}function l(a,b,m,G){a[0]=b[0]+m[0]*G;a[1]=
b[1]+m[1]*G;a[2]=b[2]+m[2]*G;a[3]=b[3]+m[3]*G;a[4]=b[4]+m[4]*G;a[5]=b[5]+m[5]*G;a[6]=b[6]+m[6]*G;a[7]=b[7]+m[7]*G;a[8]=b[8]+m[8]*G;return a}function t(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]&&a[3]===b[3]&&a[4]===b[4]&&a[5]===b[5]&&a[6]===b[6]&&a[7]===b[7]&&a[8]===b[8]}function B(a,b){const m=a[0],G=a[1],d=a[2],f=a[3],n=a[4],L=a[5],p=a[6],D=a[7];a=a[8];const U=b[0],V=b[1],X=b[2],W=b[3],ba=b[4],da=b[5],aa=b[6],ca=b[7];b=b[8];const Z=F.getEpsilon();return Math.abs(m-U)<=Z*Math.max(1,Math.abs(m),
Math.abs(U))&&Math.abs(G-V)<=Z*Math.max(1,Math.abs(G),Math.abs(V))&&Math.abs(d-X)<=Z*Math.max(1,Math.abs(d),Math.abs(X))&&Math.abs(f-W)<=Z*Math.max(1,Math.abs(f),Math.abs(W))&&Math.abs(n-ba)<=Z*Math.max(1,Math.abs(n),Math.abs(ba))&&Math.abs(L-da)<=Z*Math.max(1,Math.abs(L),Math.abs(da))&&Math.abs(p-aa)<=Z*Math.max(1,Math.abs(p),Math.abs(aa))&&Math.abs(D-ca)<=Z*Math.max(1,Math.abs(D),Math.abs(ca))&&Math.abs(a-b)<=Z*Math.max(1,Math.abs(a),Math.abs(b))}function O(a){const b=F.getEpsilon(),m=a[0],G=a[1],
d=a[2],f=a[3],n=a[4],L=a[5],p=a[6],D=a[7];a=a[8];return Math.abs(1-(m*m+f*f+p*p))<=b&&Math.abs(1-(G*G+n*n+D*D))<=b&&Math.abs(1-(d*d+L*L+a*a))<=b}const Y=Object.freeze(Object.defineProperty({__proto__:null,add:k,adjoint:H,copy:P,determinant:T,equals:B,exactEquals:t,frob:S,fromMat2d:M,fromMat4:R,fromQuat:K,fromRotation:w,fromScaling:A,fromTranslation:y,identity:x,invert:q,isOrthoNormal:O,mul:Q,multiply:Q,multiplyScalar:z,multiplyScalarAndAdd:l,normalFromMat4:r,normalFromMat4Legacy:c,projection:u,rotate:C,
scale:N,scaleByVec2:h,set:I,str:v,sub:g,subtract:g,translate:E,transpose:J},Symbol.toStringTag,{value:"Module"}));e.add=k;e.adjoint=H;e.copy=P;e.determinant=T;e.equals=B;e.exactEquals=t;e.frob=S;e.fromMat2d=M;e.fromMat4=R;e.fromQuat=K;e.fromRotation=w;e.fromScaling=A;e.fromTranslation=y;e.identity=x;e.invert=q;e.isOrthoNormal=O;e.mat3=Y;e.mul=Q;e.multiply=Q;e.multiplyScalar=z;e.multiplyScalarAndAdd=l;e.normalFromMat4=r;e.normalFromMat4Legacy=c;e.projection=u;e.rotate=C;e.scale=N;e.scaleByVec2=h;e.set=
I;e.str=v;e.sub=g;e.subtract=g;e.translate=E;e.transpose=J;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/core/libs/gl-matrix-2/math/vec2":function(){define(["exports","./common"],function(e,F){function R(d,f){d[0]=f[0];d[1]=f[1];return d}function P(d,f,n){d[0]=f;d[1]=n;return d}function I(d,f,n){d[0]=f[0]+n[0];d[1]=f[1]+n[1];return d}function x(d,f,n){d[0]=f[0]-n[0];d[1]=f[1]-n[1];return d}function J(d,f,n){d[0]=f[0]*n[0];d[1]=f[1]*n[1];return d}function q(d,f,n){d[0]=f[0]/
n[0];d[1]=f[1]/n[1];return d}function H(d,f){d[0]=Math.ceil(f[0]);d[1]=Math.ceil(f[1]);return d}function T(d,f){d[0]=Math.floor(f[0]);d[1]=Math.floor(f[1]);return d}function Q(d,f,n){d[0]=Math.min(f[0],n[0]);d[1]=Math.min(f[1],n[1]);return d}function E(d,f,n){d[0]=Math.max(f[0],n[0]);d[1]=Math.max(f[1],n[1]);return d}function C(d,f){d[0]=Math.round(f[0]);d[1]=Math.round(f[1]);return d}function N(d,f,n){d[0]=f[0]*n;d[1]=f[1]*n;return d}function h(d,f,n,L){d[0]=f[0]+n[0]*L;d[1]=f[1]+n[1]*L;return d}
function y(d,f){const n=f[0]-d[0];d=f[1]-d[1];return Math.sqrt(n*n+d*d)}function w(d,f){const n=f[0]-d[0];d=f[1]-d[1];return n*n+d*d}function A(d){const f=d[0];d=d[1];return Math.sqrt(f*f+d*d)}function M(d){const f=d[0];d=d[1];return f*f+d*d}function K(d,f){d[0]=-f[0];d[1]=-f[1];return d}function c(d,f){d[0]=1/f[0];d[1]=1/f[1];return d}function r(d,f){var n=f[0];const L=f[1];n=n*n+L*L;0<n&&(n=1/Math.sqrt(n),d[0]=f[0]*n,d[1]=f[1]*n);return d}function u(d,f){return d[0]*f[0]+d[1]*f[1]}function v(d,
f,n){f=f[0]*n[1]-f[1]*n[0];d[0]=d[1]=0;d[2]=f;return d}function S(d,f,n,L){const p=f[0];f=f[1];d[0]=p+L*(n[0]-p);d[1]=f+L*(n[1]-f);return d}function k(d,f=1){const n=2*F.RANDOM()*Math.PI;d[0]=Math.cos(n)*f;d[1]=Math.sin(n)*f;return d}function g(d,f,n){const L=f[0];f=f[1];d[0]=n[0]*L+n[2]*f;d[1]=n[1]*L+n[3]*f;return d}function z(d,f,n){const L=f[0];f=f[1];d[0]=n[0]*L+n[2]*f+n[4];d[1]=n[1]*L+n[3]*f+n[5];return d}function l(d,f,n){const L=f[0];f=f[1];d[0]=n[0]*L+n[3]*f+n[6];d[1]=n[1]*L+n[4]*f+n[7];return d}
function t(d,f,n){const L=f[0];f=f[1];d[0]=n[0]*L+n[4]*f+n[12];d[1]=n[1]*L+n[5]*f+n[13];return d}function B(d,f,n,L){const p=f[0]-n[0];f=f[1]-n[1];const D=Math.sin(L);L=Math.cos(L);d[0]=p*L-f*D+n[0];d[1]=p*D+f*L+n[1];return d}function O(d,f){var n=d[0];d=d[1];const L=f[0];f=f[1];let p=n*n+d*d;0<p&&(p=1/Math.sqrt(p));let D=L*L+f*f;0<D&&(D=1/Math.sqrt(D));n=(n*L+d*f)*p*D;return 1<n?0:-1>n?Math.PI:Math.acos(n)}function Y(d){return"vec2("+d[0]+", "+d[1]+")"}function a(d,f){return d[0]===f[0]&&d[1]===
f[1]}function b(d,f){const n=d[0];d=d[1];const L=f[0];f=f[1];const p=F.getEpsilon();return Math.abs(n-L)<=p*Math.max(1,Math.abs(n),Math.abs(L))&&Math.abs(d-f)<=p*Math.max(1,Math.abs(d),Math.abs(f))}function m(d,f,n,L,p){let D=f[0]-n[0];n=f[1]-n[1];p=(L[0]*D+L[1]*n)*(p-1);D=L[0]*p;n=L[1]*p;d[0]=f[0]+D;d[1]=f[1]+n;return d}const G=Object.freeze(Object.defineProperty({__proto__:null,add:I,angle:O,ceil:H,copy:R,cross:v,dist:y,distance:y,div:q,divide:q,dot:u,equals:b,exactEquals:a,floor:T,inverse:c,len:A,
length:A,lerp:S,max:E,min:Q,mul:J,multiply:J,negate:K,normalize:r,projectAndScale:m,random:k,rotate:B,round:C,scale:N,scaleAndAdd:h,set:P,sqrDist:w,sqrLen:M,squaredDistance:w,squaredLength:M,str:Y,sub:x,subtract:x,transformMat2:g,transformMat2d:z,transformMat3:l,transformMat4:t},Symbol.toStringTag,{value:"Module"}));e.add=I;e.angle=O;e.ceil=H;e.copy=R;e.cross=v;e.dist=y;e.distance=y;e.div=q;e.divide=q;e.dot=u;e.equals=b;e.exactEquals=a;e.floor=T;e.inverse=c;e.len=A;e.length=A;e.lerp=S;e.max=E;e.min=
Q;e.mul=J;e.multiply=J;e.negate=K;e.normalize=r;e.projectAndScale=m;e.random=k;e.rotate=B;e.round=C;e.scale=N;e.scaleAndAdd=h;e.set=P;e.sqrDist=w;e.sqrLen=M;e.squaredDistance=w;e.squaredLength=M;e.str=Y;e.sub=x;e.subtract=x;e.transformMat2=g;e.transformMat2d=z;e.transformMat3=l;e.transformMat4=t;e.vec2=G;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/core/libs/gl-matrix-2/factories/vec2f64":function(){define(["exports"],function(e){function F(){return[0,0]}function R(y){return[y[0],
y[1]]}function P(y,w){return[y,w]}function I(y,w=[0,0]){const A=Math.min(2,y.length);for(let M=0;M<A;++M)w[M]=y[M];return w}function x(y,w){return new Float64Array(y,w,2)}function J(){return[0,0]}function q(){return[1,1]}function H(){return[1,0]}function T(){return[0,1]}const Q=[0,0],E=[1,1],C=[1,0],N=[0,1],h=Object.freeze(Object.defineProperty({__proto__:null,ONES:E,UNIT_X:C,UNIT_Y:N,ZEROS:Q,clone:R,create:F,createView:x,fromArray:I,fromValues:P,ones:q,unitX:H,unitY:T,zeros:J},Symbol.toStringTag,
{value:"Module"}));e.ONES=E;e.UNIT_X=C;e.UNIT_Y=N;e.ZEROS=Q;e.clone=R;e.create=F;e.createView=x;e.fromArray=I;e.fromValues=P;e.ones=q;e.unitX=H;e.unitY=T;e.vec2f64=h;e.zeros=J;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/GeoreferenceBase":function(){define("../../chunks/tslib.es6 ../../core/Clonable ../../core/Logger ../../core/has ../../core/RandomLCG ../../core/Error ../../core/accessorSupport/decorators/subclass ../../geometry/projection".split(" "),function(e,
F,R,P,I,x,J,q){F=class extends F.Clonable{projectOrWarn(H,T){if(null==H)return H;const {geometry:Q,pending:E}=q.projectOrLoad(H,T);return E?null:E||Q?Q:(R.getLogger(this).warn("geometry could not be projected to the spatial reference",{georeference:this,geometry:H,sourceSpatialReference:H.spatialReference,targetSpatialReference:T}),null)}};return F=e.__decorate([J.subclass("esri.layers.support.GeoreferenceBase")],F)})},"esri/layers/support/ImageElement":function(){define("../../chunks/tslib.es6 ../../request ../../core/Error ../../core/imageUtils ../../core/urlUtils ../../core/uuid ../../core/accessorSupport/decorators/property ../../core/has ../../core/Logger ../../core/RandomLCG ../../core/accessorSupport/decorators/reader ../../core/accessorSupport/decorators/subclass ../../core/accessorSupport/decorators/writer ./MediaElementBase ./mediaUtils ../../portal/support/resourceExtension ../../chunks/persistableUrlUtils".split(" "),
function(e,F,R,P,I,x,J,q,H,T,Q,E,C,N,h,y,w){function A(c){return"string"===typeof c&&!I.isDataProtocol(c)&&!I.isBlobProtocol(c)}async function M(c){return"string"===typeof c?I.isDataProtocol(c)?I.dataToBlob(c):(await F(c,{responseType:"blob"})).data:new Promise(r=>{if(c instanceof HTMLCanvasElement)var u=c;else{u=c instanceof HTMLImageElement?c.naturalWidth:c.width;var v=c instanceof HTMLImageElement?c.naturalHeight:c.height,S=document.createElement("canvas"),k=S.getContext("2d");S.width=u;S.height=
v;c instanceof HTMLImageElement?k.drawImage(c,0,0,c.width,c.height):c instanceof ImageData&&k.putImageData(c,0,0);u=S}return u.toBlob(r)})}function K(c,r){const u=x.generateUUID();c=`${I.join("media",u)}.${y.getResourceContentExtension({type:"blob",blob:c})}`;return r.resourceFromPath(c)}q=class extends N{constructor(c){super(c);this.image=this.content=this.animationOptions=null;this.type="image";this.image=null}load(){const c=this.image;if("string"===typeof c){var r=P.getImageData(c).then(u=>{this._set("content",
u)});this.addResolvingPromise(r)}else c instanceof HTMLImageElement?(r=c.decode().then(()=>{this._set("content",c)}),this.addResolvingPromise(r)):c?this._set("content",c):this.addResolvingPromise(Promise.reject(new R("image-element:invalid-image-type","Invalid image type",{image:c})));return Promise.resolve(this)}get contentWidth(){return null==this.content?0:this.content instanceof HTMLImageElement?this.content.naturalWidth:this.content.width}get contentHeight(){return null==this.content?0:this.content instanceof
HTMLImageElement?this.content.naturalHeight:this.content.height}readImage(c,r,u){return w.fromJSON(r.url,u)}writeImage(c,r,u,v){if(null!=c){var S=v?.portalItem,k=v?.resources;if(S&&k){var g=A(c)?c:null;if(g){if(null==w.itemIdFromResourceUrl(g)){r[u]=g;return}v=w.toJSON(g,{...v,verifyItemRelativeUrls:v?.verifyItemRelativeUrls?{writtenUrls:v.verifyItemRelativeUrls.writtenUrls,rootPath:void 0}:void 0},w.MarkKeep.NO);if(S&&v&&!I.isAbsolute(v)){k.toKeep.push({resource:S.resourceFromPath(v),compress:!1});
r[u]=v;return}}r[u]="\x3cpending\x3e";k.pendingOperations.push(M(c).then(z=>{const l=K(z,S);r[u]=l.itemRelativeUrl;k.toAdd.push({resource:l,content:{type:"blob",blob:z},compress:!1,finish:t=>{this.image=t.url}})}))}else"string"===typeof c&&(r[u]=w.toJSON(c,v))}}};e.__decorate([J.property()],q.prototype,"animationOptions",void 0);e.__decorate([J.property({readOnly:!0})],q.prototype,"content",void 0);e.__decorate([J.property({readOnly:!0})],q.prototype,"contentWidth",null);e.__decorate([J.property({readOnly:!0})],
q.prototype,"contentHeight",null);e.__decorate([J.property(h.mediaElementUrlProperty)],q.prototype,"image",void 0);e.__decorate([Q.reader("image",["url"])],q.prototype,"readImage",null);e.__decorate([C.writer("image")],q.prototype,"writeImage",null);e.__decorate([J.property(h.mediaTypeProperty)],q.prototype,"type",void 0);return q=e.__decorate([E.subclass("esri.layers.support.ImageElement")],q)})},"esri/core/imageUtils":function(){define("require exports ../request ./Error ./promiseUtils ./urlUtils ../support/base64Utils".split(" "),
function(e,F,R,P,I,x,J){function q(C,N,h){h||(Q||(Q=document.createElement("canvas"),Q.width=1,Q.height=1),h=Q);return h.getContext("2d").createImageData(C,N)}async function H(C,N){C=window.URL.createObjectURL(C);try{const {data:h}=await R(C,{...N,responseType:"image"});return h}catch(h){if(!I.isAbortError(h))throw new P("invalid-image",`Could not fetch requested image at ${C}`);throw h;}finally{window.URL.revokeObjectURL(C)}}async function T(C,N){const h=x.dataComponents(C);if(h?.isBase64)return{arrayBuffer:J.base64ToArrayBuffer(h.data),
mediaType:h.mediaType};N=await R(C,{responseType:"array-buffer",...N});C=N.data;N=N.getHeader?.("Content-Type")??"";return{arrayBuffer:C,mediaType:N}}let Q=null,E=!0;F.createEmptyImageData=function(C,N,h){if(!C||!N)throw Error("Cannot construct image data without dimensions");if(E)try{return new ImageData(C,N)}catch(y){E=!1}return q(C,N,h)};F.getImageData=async function(C,N){const {arrayBuffer:h,mediaType:y}=await T(C,N);C="image/png"===y;if("image/gif"===y){const {isAnimatedGIF:w,parseGif:A}=await new Promise((M,
K)=>e(["./image/gif"],M,K));if(w(h))return A(h,N)}if(C){const {isAnimatedPNG:w,parseApng:A}=await new Promise((M,K)=>e(["./image/apng"],M,K));if(w(h))return A(h,N)}C=new Blob([h],{type:y});return H(C,N)};F.wrapImageData=function(C,N,h,y){if(!N||!h)throw Error("Cannot construct image data without dimensions");if(E)try{return new ImageData(C,N,h)}catch(w){E=!1}N=q(N,h,y);N.data.set(C,0);return N};Object.defineProperty(F,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/MediaElementBase":function(){define("../../chunks/tslib.es6 ../../core/Error ../../core/Identifiable ../../core/Loadable ../../core/Logger ../../core/MultiOriginJSONSupport ../../core/accessorSupport/decorators/property ../../core/has ../../core/RandomLCG ../../core/accessorSupport/decorators/reader ../../core/accessorSupport/decorators/subclass ../../core/accessorSupport/decorators/writer ./ControlPointsGeoreference ./mediaUtils".split(" "),
function(e,F,R,P,I,x,J,q,H,T,Q,E,C,N){R=class extends R.NumericIdentifiableMixin(x.MultiOriginJSONMixin(P)){constructor(h){super(h);this.georeference=null;this.opacity=1}readGeoreference(h){return C.fromJSON(h)}writeGeoreference(h,y,w,A){const M=A?.resources?.pendingOperations,K=()=>{const c=N.toControlPointsGeoreference(this.georeference,this.contentWidth,this.contentHeight);c&&("control-points"!==h.type&&I.getLogger(this).warn(`only georeference of type 'control-points' may be persisted. The georeference of type '${h.type}' has been automatically converted.`),
4!==c.controlPoints?.length&&A?.messages?A.messages.push(new F("property:unsupported","only 'control-points' georeference with 4 control points may be persisted.")):y[w]=c.write({},A))};"control-points"!==h.type&&!this.loaded&&M?(y[w]={},M.push(this.load().then(K))):K()}get contentWidth(){return 0}get contentHeight(){return 0}toSource(h){const {georeference:y,contentWidth:w,contentHeight:A}=this;if(null==h||null==y||0===w||0===A)return null;h=y.toSourceNormalized(h);if(null==h)return null;h.x*=w;
h.y*=A;return h}};e.__decorate([J.property(N.mediaGeoreferenceProperty)],R.prototype,"georeference",void 0);e.__decorate([T.reader("georeference")],R.prototype,"readGeoreference",null);e.__decorate([E.writer("georeference")],R.prototype,"writeGeoreference",null);e.__decorate([J.property({json:{read:!1,write:!1}})],R.prototype,"opacity",void 0);return R=e.__decorate([Q.subclass("esri.layers.support.MediaElementBase")],R)})},"esri/layers/support/mediaUtils":function(){define("exports ../../geometry ../../core/screenUtils ../../core/accessorSupport/PropertyOrigin ../../geometry/support/spatialReferenceUtils ./ControlPointsGeoreference ./CornersGeoreference ./ExtentAndRotationGeoreference ./GeoreferenceBase ../../geometry/Extent ../../geometry/Point".split(" "),
function(e,F,R,P,I,x,J,q,H,T,Q){function E(h,y){y=P.nameToId(y);return"media"===h?.type&&!!h.portalItem&&null!=y&&y>P.OriginId.PORTAL_ITEM}function C(h,y,w){return{enabled:!E(w?.layer,w?.origin),ignoreOrigin:!0}}F={json:{name:"url",type:String,write:{overridePolicy:C}}};const N={readOnly:!0,json:{read:!1,write:{target:"mediaType",overridePolicy:C}}};J={types:{key:"type",base:H,typeMap:{"control-points":x,corners:J,"extent-and-rotation":q}},json:{types:{key:"type",base:H,typeMap:{"control-points":x}},
write:{overridePolicy(){return{enabled:!0,ignoreOrigin:!0}}}}};e.createDefaultControlPointsGeoreference=async function(h,y){h.loaded||await h.load();const {contentWidth:w,contentHeight:A}=h;({spatialReference:h}=y);var M=I.getInfo(h),K=!1;M&&y.width>M.valid[1]-M.valid[0]&&(y=new T({xmin:M.valid[0],ymin:y.ymin,xmax:M.valid[1],ymax:y.ymax,spatialReference:y.spatialReference}),K=!0);y=y.expand(.5);const {center:c,width:r,height:u}=y;M=w/A;var v=K||1<M;K=v?100:100*M;y=v?100/M:100;var S=v?r:u*M;v=v?r/
M:u;M=c.x-S/2;S=c.x+S/2;const k=c.y+v/2;v=c.y-v/2;return new x({controlPoints:[{sourcePoint:{x:K,y:A-y},mapPoint:new Q({x:M,y:v,spatialReference:h})},{sourcePoint:{x:K,y},mapPoint:new Q({x:M,y:k,spatialReference:h})},{sourcePoint:{x:w-K,y},mapPoint:new Q({x:S,y:k,spatialReference:h})},{sourcePoint:{x:w-K,y:A-y},mapPoint:new Q({x:S,y:v,spatialReference:h})}],width:w,height:A})};e.createLocalModeControlPointsGeoreference=function(h){h=h.georeference;if("control-points"!==h.type)return null;const y=
{wkid:0},{width:w,height:A}=h;return new x({controlPoints:h.controlPoints.map(M=>{const {x:K,y:c}=M.sourcePoint;return{sourcePoint:{x:K,y:c},mapPoint:new Q({x:K,y:A-c,spatialReference:y})}}),width:w,height:A})};e.isWritingLayerFromItemToWebDocument=E;e.mediaElementUrlProperty=F;e.mediaGeoreferenceProperty=J;e.mediaTypeProperty=N;e.toControlPointsGeoreference=function(h,y,w){if(!h||"control-points"===h.type)return h;({coords:h}=h);if(5!==h?.rings[0]?.length)return null;const [A,M,K,c]=h.rings[0];({spatialReference:h}=
h);return new x({controlPoints:[{mapPoint:new Q({x:A[0],y:A[1],spatialReference:h}),sourcePoint:R.createScreenPoint(0,w)},{mapPoint:new Q({x:M[0],y:M[1],spatialReference:h}),sourcePoint:R.createScreenPoint(0,0)},{mapPoint:new Q({x:K[0],y:K[1],spatialReference:h}),sourcePoint:R.createScreenPoint(y,0)},{mapPoint:new Q({x:c[0],y:c[1],spatialReference:h}),sourcePoint:R.createScreenPoint(y,w)}],width:y,height:w})};Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/CornersGeoreference":function(){define("../../chunks/tslib.es6 ../../core/perspectiveUtils ../../core/screenUtils ../../core/accessorSupport/decorators/property ../../core/has ../../core/Logger ../../core/RandomLCG ../../core/accessorSupport/decorators/subclass ../../core/libs/gl-matrix-2/factories/mat3f64 ../../core/libs/gl-matrix-2/math/vec2 ../../core/libs/gl-matrix-2/factories/vec2f64 ../../geometry/Point ../../geometry/Polygon ../../geometry/projection ./GeoreferenceBase".split(" "),
function(e,F,R,P,I,x,J,q,H,T,Q,E,C,N,h){const y=Q.create();I=class extends h{constructor(w){super(w);this.topRight=this.topLeft=this.bottomRight=this.bottomLeft=null;this.type="corners"}get coords(){let {topLeft:w,topRight:A,bottomLeft:M,bottomRight:K}=this;if(null==w||null==A||null==M||null==K)return null;const c=w.spatialReference;A=this.projectOrWarn(A,c);M=this.projectOrWarn(M,c);K=this.projectOrWarn(K,c);return null==A||null==M||null==K?null:new C({rings:[[[M.x,M.y],[w.x,w.y],[A.x,A.y],[K.x,
K.y],[M.x,M.y]]],spatialReference:c})}set coords(w){var {topLeft:A}=this;if(null!=A&&(A=A.spatialReference,w=this.projectOrWarn(w,A),null!=w)){var {rings:[[M,K,c,r]]}=w;this.bottomLeft=new E({x:M[0],y:M[1],spatialReference:A});this.topLeft=new E({x:K[0],y:K[1],spatialReference:A});this.topRight=new E({x:c[0],y:c[1],spatialReference:A});this.bottomRight=new E({x:r[0],y:r[1],spatialReference:A})}}toSourceNormalized(w){const {topLeft:A,topRight:M,bottomRight:K,bottomLeft:c}=this;if(null==w||null==A||
null==M||null==K||null==c)return null;const r=A.spatialReference;w=w.normalize();w=N.projectOrLoad(w,r).geometry;if(null==w)return null;T.set(y,w.x,w.y);w=F.getProjectiveTransform(H.create(),[A.x,A.y,c.x,c.y,M.x,M.y,K.x,K.y],[0,0,0,1,1,0,1,1]);F.transformProjective(y,y,w);return R.createScreenPoint(y[0],y[1])}};e.__decorate([P.property({clonable:!1})],I.prototype,"coords",null);e.__decorate([P.property({type:E})],I.prototype,"bottomLeft",void 0);e.__decorate([P.property({type:E})],I.prototype,"bottomRight",
void 0);e.__decorate([P.property({type:E})],I.prototype,"topLeft",void 0);e.__decorate([P.property({type:E})],I.prototype,"topRight",void 0);return I=e.__decorate([q.subclass("esri.layers.support.CornersGeoreference")],I)})},"esri/layers/support/ExtentAndRotationGeoreference":function(){define("../../chunks/tslib.es6 ../../core/mathUtils ../../core/screenUtils ../../core/accessorSupport/decorators/property ../../core/has ../../core/Logger ../../core/RandomLCG ../../core/accessorSupport/decorators/subclass ../../core/libs/gl-matrix-2/math/common ../../geometry/Extent ../../geometry/Polygon ../../geometry/projection ./GeoreferenceBase".split(" "),
function(e,F,R,P,I,x,J,q,H,T,Q,E,C){function N(h,y,w){w=H.toRadian(w);const A=Math.cos(w),M=Math.sin(w);return(K,c)=>[A*(K-h)+M*(c-y)+h,A*(c-y)-M*(K-h)+y]}I=class extends C{constructor(h){super(h);this.extent=null;this.rotation=0;this.type="extent-and-rotation"}get coords(){if(null==this.extent)return null;const {xmin:h,ymin:y,xmax:w,ymax:A,spatialReference:M}=this.extent;if(this.rotation){const {x:c,y:r}=this.extent.center;var K=N(c,r,this.rotation);K=[K(h,y),K(h,A),K(w,A),K(w,y)];K.push(K[0])}else K=
[[h,y],[h,A],[w,A],[w,y],[h,y]];return new Q({rings:[K],spatialReference:M})}set coords(h){if(null!=h&&null!=this.extent){var y=this.extent.spatialReference;h=this.projectOrWarn(h,y);if(null!=h?.extent){var {rings:[[w,A,M]],extent:{center:{x:K,y:c}}}=h;h=F.rad2deg(Math.PI/2-Math.atan2(A[1]-w[1],A[0]-w[0]));var r=N(K,c,-h),[u,v]=r(w[0],w[1]),[S,k]=r(M[0],M[1]);this.extent=new T({xmin:u,ymin:v,xmax:S,ymax:k,spatialReference:y});this.rotation=h}}}toSourceNormalized(h){const {extent:y,rotation:w}=this;
if(null==h||null==y)return null;const {xmin:A,ymin:M,xmax:K,ymax:c,center:r,spatialReference:u}=y;h=h.normalize();var v=E.projectOrLoad(h,u).geometry;if(null==v)return null;h=v.x;v=v.y;w&&([h,v]=N(r.x,r.y,-w)(h,v));return R.createScreenPoint(F.scale(h,A,K,0,1),F.scale(v,c,M,0,1))}};e.__decorate([P.property({clonable:!1})],I.prototype,"coords",null);e.__decorate([P.property({type:T})],I.prototype,"extent",void 0);e.__decorate([P.property({type:Number})],I.prototype,"rotation",void 0);return I=e.__decorate([q.subclass("esri.layers.support.ExtentAndRotationGeoreference")],
I)})},"esri/portal/support/resourceExtension":function(){define(["exports","../../core/urlUtils"],function(e,F){const R={},P=R["text/plain"],I={png:"image/png",jpeg:"image/jpeg",jpg:"image/jpg",bmp:"image/bmp",gif:"image/gif",json:"application/json",txt:"text/plain",xml:"application/xml",svg:"image/svg+xml",zip:"application/zip",pbf:"application/vnd.mapbox-vector-tile",gz:"application/gzip","bin.gz":"application/octet-stream"};for(const x in I)R[I[x]]=x;e.getResourceContentExtension=function(x){"json"===
x.type?x="application/json":"blob"===x.type?x=x.blob.type:(x=F.getPathExtension(x.url),x=I[x]||"text/plain");return R[x]||P};Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/LocalMediaElementSource":function(){define("../../chunks/tslib.es6 ../../geometry ../../core/Collection ../../core/collectionUtils ../../core/Evented ../../core/Loadable ../../core/Logger ../../core/Promise ../../core/promiseUtils ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/has ../../core/RandomLCG ../../core/accessorSupport/decorators/subclass ../../geometry/Extent ../../geometry/projection ../../geometry/support/aaBoundingRect ../../geometry/support/intersectsBase ../../geometry/support/spatialReferenceUtils ../graphics/data/BoundsStore ./ImageElement ./MediaElementBase ./MediaElementView ./VideoElement ../../geometry/SpatialReference".split(" "),
function(e,F,R,P,I,x,J,q,H,T,Q,E,C,N,h,y,w,A,M,K,c,r,u,v,S){const k=R.ofType({key:"type",defaultKeyValue:"image",base:r,typeMap:{image:c,video:v}});F=class extends x.LoadableMixin(q.EsriPromiseMixin(I.EventedAccessor)){constructor(g){super(g);this._index=new K.BoundsStore;this._elementViewsMap=new Map;this._elementsIndexes=new Map;this._elementsChangedHandler=z=>{for(var l of z.removed){const t=this._elementViewsMap.get(l);this._elementViewsMap.delete(l);this._index.delete(t);this.removeHandles(t);
t.destroy();this.notifyChange("fullExtent")}({spatialReference:l}=this);for(const t of z.added){if(this._elementViewsMap.get(t))continue;const B=new u.MediaElementView({spatialReference:l,element:t});this._elementViewsMap.set(t,B);z=T.watch(()=>B.coords,()=>this._updateIndexForElement(B,!1));this._updateIndexForElement(B,!0);this.addHandles(z,B)}this._elementsIndexes.clear();this.elements.forEach((t,B)=>this._elementsIndexes.set(t,B));this.emit("refresh")};this.elements=new k}async load(g){H.throwIfAborted(g);
this.spatialReference||(g=this.elements.find(z=>null!=z.georeference?.coords),this._set("spatialReference",g?g.georeference.coords.spatialReference:S.WGS84));this._elementsChangedHandler({added:this.elements.items,removed:[]});this.addHandles(this.elements.on("change",this._elementsChangedHandler));return this}destroy(){this._index.clear();this._elementViewsMap.clear();this._elementsIndexes.clear()}set elements(g){this._set("elements",P.referenceSetter(g,this._get("elements"),k))}get fullExtent(){if("not-loaded"===
this.loadStatus)return null;const g=this._index.fullBounds;return null==g?null:new h({xmin:g[0],ymin:g[1],xmax:g[2],ymax:g[3],spatialReference:this.spatialReference})}set spatialReference(g){"not-loaded"!==this.loadStatus?J.getLogger(this).error("#spatialReference","spatialReference cannot be changed after the source is loaded."):this._set("spatialReference",g)}async queryElements(g,z){await this.load();await y.initializeProjection(g.spatialReference,this.spatialReference,null,z);g=M.equals(g.spatialReference,
this.spatialReference)?g:y.project(g,this.spatialReference);if(!g)return[];g=g.normalize();const l=[];for(const t of g)this._index.forEachInBounds(w.fromExtent(t),({normalizedCoords:B,element:O})=>{null!=B&&A.extentIntersectsPolygon(t,B)&&l.push(O)});l.sort((t,B)=>this._elementsIndexes.get(t)-this._elementsIndexes.get(B));return l}hasElement(g){return this.elements.includes(g)}_updateIndexForElement(g,z){const l=g.normalizedBounds,t=this._index.has(g),B=null!=l;this._index.delete(g);B&&this._index.set(g,
l);this.notifyChange("fullExtent");z||(t!==B?this.emit("refresh"):this.emit("change",{element:g.element}))}};e.__decorate([Q.property()],F.prototype,"elements",null);e.__decorate([Q.property({readOnly:!0})],F.prototype,"fullExtent",null);e.__decorate([Q.property()],F.prototype,"spatialReference",null);return F=e.__decorate([N.subclass("esri.layers.support.LocalMediaElementSource")],F)})},"esri/layers/graphics/data/BoundsStore":function(){define(["exports","../../../core/has","../../../core/libs/rbush/PooledRBush",
"../../../geometry/support/aaBoundingRect"],function(e,F,R,P){function I(q,H,T){x.minX=H[0];x.minY=H[1];x.maxX=H[2];x.maxY=H[3];q.search(x,T)}const x={minX:0,minY:0,maxX:0,maxY:0};class J{constructor(){this._indexInvalid=!1;this._boundsToLoad=[];this._boundsById=new Map;this._idByBounds=new Map;this._index=new R.PooledRBush(9,F("esri-csp-restrictions")?q=>({minX:q[0],minY:q[1],maxX:q[2],maxY:q[3]}):["[0]","[1]","[2]","[3]"]);this._loadIndex=()=>{if(this._indexInvalid){const q=Array(this._idByBounds.size);
let H=0;this._idByBounds.forEach((T,Q)=>{q[H++]=Q});this._indexInvalid=!1;this._index.clear();this._index.load(q)}else this._boundsToLoad.length&&(this._index.load(Array.from(new Set(this._boundsToLoad.filter(q=>this._idByBounds.has(q))))),this._boundsToLoad.length=0)}}get fullBounds(){if(!this._boundsById.size)return null;const q=P.empty();for(const H of this._boundsById.values())H&&(q[0]=Math.min(H[0],q[0]),q[1]=Math.min(H[1],q[1]),q[2]=Math.max(H[2],q[2]),q[3]=Math.max(H[3],q[3]));return q}get valid(){return!this._indexInvalid}clear(){this._indexInvalid=
!1;this._boundsToLoad.length=0;this._boundsById.clear();this._idByBounds.clear();this._index.clear()}delete(q){const H=this._boundsById.get(q);this._boundsById.delete(q);H&&(this._idByBounds.delete(H),this._indexInvalid||this._index.remove(H))}forEachInBounds(q,H){this._loadIndex();I(this._index,q,T=>H(this._idByBounds.get(T)))}get(q){return this._boundsById.get(q)}has(q){return this._boundsById.has(q)}invalidateIndex(){this._indexInvalid||(this._indexInvalid=!0,this._boundsToLoad.length=0)}set(q,
H){if(!this._indexInvalid){const T=this._boundsById.get(q);T&&(this._index.remove(T),this._idByBounds.delete(T))}this._boundsById.set(q,H);H&&(this._idByBounds.set(H,q),this._indexInvalid||(this._boundsToLoad.push(H),5E4<this._boundsToLoad.length&&this._loadIndex()))}}e.BoundsStore=J;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/core/libs/rbush/PooledRBush":function(){define(["exports","../../arrayUtils","../../has","../../PooledArray","../../../chunks/quickselect"],function(e,
F,R,P,I){function x(k,g){for(M.clear();k;){if(!0===k.leaf)for(const z of k.children)g(z);else M.pushArray(k.children);k=M.pop()??null}}function J(k,g){q(k,0,k.children.length,g,k)}function q(k,g,z,l,t){t||=new v([]);t.minX=Infinity;t.minY=Infinity;t.maxX=-Infinity;t.maxY=-Infinity;for(let B=g,O;B<z;B++)O=k.children[B],H(t,k.leaf?l(O):O);return t}function H(k,g){k.minX=Math.min(k.minX,g.minX);k.minY=Math.min(k.minY,g.minY);k.maxX=Math.max(k.maxX,g.maxX);k.maxY=Math.max(k.maxY,g.maxY)}function T(k,
g){return k.minX-g.minX}function Q(k,g){return k.minY-g.minY}function E(k){return(k.maxX-k.minX)*(k.maxY-k.minY)}function C(k){return k.maxX-k.minX+(k.maxY-k.minY)}function N(k,g){return k.minX<=g.minX&&k.minY<=g.minY&&g.maxX<=k.maxX&&g.maxY<=k.maxY}function h(k,g){return g.minX<=k.maxX&&g.minY<=k.maxY&&g.maxX>=k.minX&&g.maxY>=k.minY}function y(k,g,z,l,t){for(g=[g,z];g.length;){z=g.pop();const B=g.pop();if(z-B<=l)continue;const O=B+Math.ceil((z-B)/l/2)*l;I.quickselect(k,O,B,z,t);g.push(B,O,O,z)}}
class w{constructor(k=9,g){this._compareMinX=T;this._compareMinY=Q;this._toBBox=z=>z;this._maxEntries=Math.max(4,k||9);this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries));g&&("function"===typeof g?this._toBBox=g:this._initFormat(g));this.clear()}destroy(){this.clear();A.prune();M.prune();K.prune();c.prune()}all(k){x(this._data,k)}search(k,g){let z=this._data;const l=this._toBBox;if(h(k,z))for(A.clear();z;){for(let t=0,B=z.children.length;t<B;t++){const O=z.children[t],Y=z.leaf?l(O):O;h(k,
Y)&&(z.leaf?g(O):N(k,Y)?x(O,g):A.push(O))}z=A.pop()}}collides(k){let g=this._data;const z=this._toBBox;if(!h(k,g))return!1;for(A.clear();g;){for(let l=0,t=g.children.length;l<t;l++){const B=g.children[l],O=g.leaf?z(B):B;if(h(k,O)){if(g.leaf||N(k,O))return!0;A.push(B)}}g=A.pop()}return!1}load(k){if(!k.length)return this;if(k.length<this._minEntries){for(let g=0,z=k.length;g<z;g++)this.insert(k[g]);return this}k=this._build(k.slice(),0,k.length-1,0);if(this._data.children.length)if(this._data.height===
k.height)this._splitRoot(this._data,k);else{if(this._data.height<k.height){const g=this._data;this._data=k;k=g}this._insert(k,this._data.height-k.height-1,!0)}else this._data=k;return this}insert(k){k&&this._insert(k,this._data.height-1);return this}clear(){this._data=new v([]);return this}remove(k){if(!k)return this;let g=this._data,z=null,l=0,t=!1,B;const O=this._toBBox(k);K.clear();for(c.clear();g||0<K.length;){g||(g=K.pop(),z=K.data[K.length-1],l=c.pop()??0,t=!0);if(g.leaf&&(B=F.indexOf(g.children,
k,g.children.length,g.indexHint),-1!==B)){g.children.splice(B,1);K.push(g);this._condense(K);break}t||g.leaf||!N(g,O)?z?(l++,g=z.children[l],t=!1):g=null:(K.push(g),c.push(l),l=0,z=g,g=g.children[0])}return this}toJSON(){return this._data}fromJSON(k){this._data=k;return this}_build(k,g,z,l){var t=z-g+1,B=this._maxEntries;if(t<=B)return k=new v(k.slice(g,z+1)),J(k,this._toBBox),k;l||(l=Math.ceil(Math.log(t)/Math.log(B)),B=Math.ceil(t/B**(l-1)));const O=new S([]);O.height=l;t=Math.ceil(t/B);B=t*Math.ceil(Math.sqrt(B));
for(y(k,g,z,B,this._compareMinX);g<=z;g+=B){const Y=Math.min(g+B-1,z);y(k,g,Y,t,this._compareMinY);for(let a=g;a<=Y;a+=t)O.children.push(this._build(k,a,Math.min(a+t-1,Y),l-1))}J(O,this._toBBox);return O}_insert(k,g,z){var l=this._toBBox;z=z?k:l(k);K.clear();l=this._data;for(var t=g,B=K;;){B.push(l);if(!0===l.leaf||B.length-1===t)break;let O=Infinity,Y=Infinity,a=void 0;for(let b=0,m=l.children.length;b<m;b++){const G=l.children[b],d=E(G),f=(Math.max(G.maxX,z.maxX)-Math.min(G.minX,z.minX))*(Math.max(G.maxY,
z.maxY)-Math.min(G.minY,z.minY))-d;f<Y?(Y=f,O=d<O?d:O,a=G):f===Y&&d<O&&(O=d,a=G)}l=a||l.children[0]}l.children.push(k);for(H(l,z);0<=g;)if(K.data[g].children.length>this._maxEntries)this._split(K,g),g--;else break;for(k=K;0<=g;g--)H(k.data[g],z)}_split(k,g){const z=k.data[g];var l=z.children.length;const t=this._minEntries;this._chooseSplitAxis(z,t,l);if(l=this._chooseSplitIndex(z,t,l))l=z.children.splice(l,z.children.length-l),l=z.leaf?new v(l):new S(l),l.height=z.height,J(z,this._toBBox),J(l,this._toBBox),
g?k.data[g-1].children.push(l):this._splitRoot(z,l)}_splitRoot(k,g){this._data=new S([k,g]);this._data.height=k.height+1;J(this._data,this._toBBox)}_chooseSplitIndex(k,g,z){let l,t,B=void 0;l=t=Infinity;for(let Y=g;Y<=z-g;Y++){var O=q(k,0,Y,this._toBBox);const a=q(k,Y,z,this._toBBox),b=Math.max(0,Math.min(O.maxX,a.maxX)-Math.max(O.minX,a.minX))*Math.max(0,Math.min(O.maxY,a.maxY)-Math.max(O.minY,a.minY));O=E(O)+E(a);b<l?(l=b,B=Y,t=O<t?O:t):b===l&&O<t&&(t=O,B=Y)}return B}_chooseSplitAxis(k,g,z){const l=
k.leaf?this._compareMinX:T,t=k.leaf?this._compareMinY:Q,B=this._allDistMargin(k,g,z,l);g=this._allDistMargin(k,g,z,t);B<g&&k.children.sort(l)}_allDistMargin(k,g,z,l){k.children.sort(l);l=this._toBBox;var t=q(k,0,g,l);const B=q(k,z-g,z,l);let O=C(t)+C(B);for(let Y=g;Y<z-g;Y++){const a=k.children[Y];H(t,k.leaf?l(a):a);O+=C(t)}for(z=z-g-1;z>=g;z--)t=k.children[z],H(B,k.leaf?l(t):t),O+=C(B);return O}_condense(k){for(let g=k.length-1;0<=g;g--){const z=k.data[g];if(0===z.children.length)if(0<g){const l=
k.data[g-1],t=l.children;t.splice(F.indexOf(t,z,t.length,l.indexHint),1)}else this.clear();else J(z,this._toBBox)}}_initFormat(k){const g=["return a"," - b",";"];this._compareMinX=new Function("a","b",g.join(k[0]));this._compareMinY=new Function("a","b",g.join(k[1]));this._toBBox=new Function("a","return {minX: a"+k[0]+", minY: a"+k[1]+", maxX: a"+k[2]+", maxY: a"+k[3]+"};")}}const A=new P,M=new P,K=new P,c=new P({deallocator:void 0});class r{constructor(){this.minY=this.minX=Infinity;this.maxY=this.maxX=
-Infinity}}class u extends r{constructor(){super(...arguments);this.height=1;this.indexHint=new F.PositionHint}}class v extends u{constructor(k){super();this.children=k;this.leaf=!0}}class S extends u{constructor(k){super();this.children=k;this.leaf=!1}}e.BBox=r;e.PooledRBush=w;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/quickselect":function(){define(["exports"],function(e){function F(I,x,J,q,H){for(;q>J;){if(600<q-J){var T=q-J+1,Q=x-J+1,E=Math.log(T),C=.5*Math.exp(2*
E/3);E=.5*Math.sqrt(E*C*(T-C)/T)*(0>Q-T/2?-1:1);F(I,x,Math.max(J,Math.floor(x-Q*C/T+E)),Math.min(q,Math.floor(x+(T-Q)*C/T+E)),H)}T=I[x];Q=J;C=q;R(I,J,x);for(0<H(I[q],T)&&R(I,J,q);Q<C;){R(I,Q,C);Q++;for(C--;0>H(I[Q],T);)Q++;for(;0<H(I[C],T);)C--}0===H(I[J],T)?R(I,J,C):(C++,R(I,C,q));C<=x&&(J=C+1);x<=C&&(q=C-1)}}function R(I,x,J){var q=I[x];I[x]=I[J];I[J]=q}function P(I,x){return I<x?-1:I>x?1:0}e.quickselect=function(I,x,J,q,H){F(I,x,J||0,q||I.length-1,H||P)}})},"esri/layers/support/MediaElementView":function(){define("exports ../../chunks/tslib.es6 ../../core/Accessor ../../core/accessorSupport/decorators/property ../../core/has ../../core/Logger ../../core/RandomLCG ../../core/accessorSupport/decorators/subclass ../../geometry/Polygon ../../geometry/projection ../../geometry/support/aaBoundingRect ../../geometry/support/normalizeUtilsSync".split(" "),
function(e,F,R,P,I,x,J,q,H,T,Q,E){e.MediaElementView=class extends R{constructor(C){super(C)}get bounds(){const C=this.coords;return null==C?.extent?null:Q.fromExtent(C.extent)}get coords(){return T.projectOrLoad(this.element.georeference?.coords,this.spatialReference).geometry}get normalizedCoords(){return H.fromJSON(E.normalizeCentralMeridianSync(this.coords))}get normalizedBounds(){const C=null!=this.normalizedCoords?this.normalizedCoords.extent:null;return null!=C?Q.fromExtent(C):null}};F.__decorate([P.property()],
e.MediaElementView.prototype,"spatialReference",void 0);F.__decorate([P.property()],e.MediaElementView.prototype,"element",void 0);F.__decorate([P.property()],e.MediaElementView.prototype,"bounds",null);F.__decorate([P.property()],e.MediaElementView.prototype,"coords",null);F.__decorate([P.property()],e.MediaElementView.prototype,"normalizedCoords",null);F.__decorate([P.property()],e.MediaElementView.prototype,"normalizedBounds",null);e.MediaElementView=F.__decorate([q.subclass("esri.layers.support.MediaElementView")],
e.MediaElementView);Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/normalizeUtilsSync":function(){define("exports ../../core/JSONSupport ./aaBoundingRect ./boundsUtils ./coordsUtils ./jsonUtils ./normalizeUtilsCommon ./spatialReferenceUtils".split(" "),function(e,F,R,P,I,x,J,q){function H(c,r){if(null==c)return null;var u=c.spatialReference,v=q.getInfo(u);c=F.isSerializable(c)?c.toJSON():c;if(!v)return c;u=q.isWebMercator(u)?102100:4326;const S=J.cutParams[u].maxX,
k=J.cutParams[u].minX;if(x.isPoint(c))return Q(c,S,k);if(x.isMultipoint(c))c.points=c.points.map(g=>Q(g,S,k));else{if(x.isExtent(c))return T(c,v);if(x.isPolygon(c)||x.isPolyline(c)){u=P.getBoundsXY(M,c);v=u[0];u=u[2];const g=2*J.offsetMagnitude(v,k)*S;c=0===g?c:J.updatePolyGeometry(c,g);v+=g;u+=g;return u>S?y(c,S,r):v<k?y(c,k,r):c}}return c}function T(c,r){if(!r)return c;const u=E(c,r).map(v=>v.extent);return 2>u.length?u[0]||c:2<u.length?(c.xmin=r.valid[0],c.xmax=r.valid[1],c):{rings:u.map(v=>[[v.xmin,
v.ymin],[v.xmin,v.ymax],[v.xmax,v.ymax],[v.xmax,v.ymin],[v.xmin,v.ymin]])}}function Q(c,r,u){if(Array.isArray(c)){var v=c[0];v>r?(u=J.offsetMagnitude(v,r),c[0]=v+-2*u*r):v<u&&(r=J.offsetMagnitude(v,u),c[0]=v+-2*r*u)}else v=c.x,v>r?(u=J.offsetMagnitude(v,r),c.x+=-2*u*r):v<u&&(r=J.offsetMagnitude(v,u),c.x+=-2*r*u);return c}function E(c,r){const u=[],{ymin:v,ymax:S,xmin:k,xmax:g}=c;var z=c.xmax-c.xmin;const [l,t]=r.valid,{x:B,frameId:O}=C(c.xmin,r),{x:Y,frameId:a}=C(c.xmax,r);c=B===Y&&0<z;if(z>2*t){z=
{xmin:k<g?B:Y,ymin:v,xmax:t,ymax:S};c={xmin:l,ymin:v,xmax:k<g?Y:B,ymax:S};r={xmin:0,ymin:v,xmax:t,ymax:S};const b={xmin:l,ymin:v,xmax:0,ymax:S},m=[],G=[];N(z,r)&&m.push(O);N(z,b)&&G.push(O);N(c,r)&&m.push(a);N(c,b)&&G.push(a);for(let d=O+1;d<a;d++)m.push(d),G.push(d);u.push(new A(z,[O]),new A(c,[a]),new A(r,m),new A(b,G))}else B>Y||c?u.push(new A({xmin:B,ymin:v,xmax:t,ymax:S},[O]),new A({xmin:l,ymin:v,xmax:Y,ymax:S},[a])):u.push(new A({xmin:B,ymin:v,xmax:Y,ymax:S},[O]));return u}function C(c,r){const [u,
v]=r.valid;r=2*v;var S=0;c>v?(S=Math.ceil(Math.abs(c-v)/r),c-=S*r):c<u&&(S=Math.ceil(Math.abs(c-u)/r),c+=S*r,S=-S);return{x:c,frameId:S}}function N(c,r){const {xmin:u,ymin:v,xmax:S,ymax:k}=r;return h(c,u,v)&&h(c,u,k)&&h(c,S,k)&&h(c,S,v)}function h(c,r,u){return r>=c.xmin&&r<=c.xmax&&u>=c.ymin&&u<=c.ymax?!0:!1}function y(c,r,u=!0){const v=!x.isPolyline(c);v&&I.closeRings(c);if(u)return(new K).cut(c,r);u=v?c.rings:c.paths;const S=v?4:2,k=u.length;r*=-2;for(let g=0;g<k;g++){const z=u[g];if(z&&z.length>=
S){const l=[];for(const t of z)l.push([t[0]+r,t[1]]);u.push(l)}}v?c.rings=u:c.paths=u;return c}function w(c,r,u){const v=c.length;1<v&&c[v-1][0]===r&&c[v-2][0]===r?c[v-1][1]=u:c.push([r,u])}class A{constructor(c,r){this.extent=c;this.frameIds=r}}const M=R.create();class K{constructor(){this._linesIn=[];this._linesOut=[]}cut(c,r){this._xCut=r;if(c.rings)this._closed=!0,r=c.rings,this._minPts=4;else if(c.paths)this._closed=!1,r=c.paths,this._minPts=2;else return null;for(var u of r)if(u&&!(u.length<
this._minPts)){r=!0;for(const v of u)r?(this.moveTo(v),r=!1):this.lineTo(v);this._closed&&this.close()}this._pushLineIn();this._pushLineOut();r=[];for(const v of this._linesIn)v&&v.length>=this._minPts&&r.push(v);u=-2*this._xCut;for(const v of this._linesOut)if(v&&v.length>=this._minPts){for(const S of v)S[0]+=u;r.push(v)}this._closed?c.rings=r:c.paths=r;return c}moveTo(c){this._pushLineIn();this._pushLineOut();this._prevSide=this._side(c[0]);this._moveTo(c[0],c[1],this._prevSide);this._firstPt=this._prevPt=
c}lineTo(c){const r=this._side(c[0]);if(-1===r*this._prevSide){const u=this._intersect(this._prevPt,c);this._lineTo(this._xCut,u,0);this._prevSide=0}this._lineTo(c[0],c[1],r);this._prevSide=r;this._prevPt=c}close(){const c=this._firstPt,r=this._prevPt;c[0]===r[0]&&c[1]===r[1]||this.lineTo(c);this._checkClosingPt(this._lineIn);this._checkClosingPt(this._lineOut)}_moveTo(c,r,u){this._closed?(this._lineIn.push([0>=u?c:this._xCut,r]),this._lineOut.push([0<=u?c:this._xCut,r])):(0>=u&&this._lineIn.push([c,
r]),0<=u&&this._lineOut.push([c,r]))}_lineTo(c,r,u){this._closed?(w(this._lineIn,0>=u?c:this._xCut,r),w(this._lineOut,0<=u?c:this._xCut,r)):0>u?(0===this._prevSide&&this._pushLineOut(),this._lineIn.push([c,r])):0<u?(0===this._prevSide&&this._pushLineIn(),this._lineOut.push([c,r])):0>this._prevSide?(this._lineIn.push([c,r]),this._lineOut.push([c,r])):0<this._prevSide&&(this._lineOut.push([c,r]),this._lineIn.push([c,r]))}_checkClosingPt(c){const r=c.length;3<r&&c[0][0]===this._xCut&&c[r-2][0]===this._xCut&&
c[1][0]===this._xCut&&(c[0][1]=c[r-2][1],c.pop())}_side(c){return c<this._xCut?-1:c>this._xCut?1:0}_intersect(c,r){return c[1]+(this._xCut-c[0])/(r[0]-c[0])*(r[1]-c[1])}_pushLineIn(){this._lineIn&&this._lineIn.length>=this._minPts&&this._linesIn.push(this._lineIn);this._lineIn=[]}_pushLineOut(){this._lineOut&&this._lineOut.length>=this._minPts&&this._linesOut.push(this._lineOut);this._lineOut=[]}}e.CutVertical=K;e.normalizeCentralMeridianForDisplay=function(c){return H(c,!1)};e.normalizeCentralMeridianSync=
function(c){return H(c,!0)};Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/VideoElement":function(){define("../../chunks/tslib.es6 ../../request ../../core/Error ../../core/events ../../core/Logger ../../core/urlUtils ../../core/accessorSupport/decorators/property ../../core/has ../../core/RandomLCG ../../core/accessorSupport/decorators/subclass ../../core/accessorSupport/decorators/writer ./MediaElementBase ./mediaUtils ../../chunks/persistableUrlUtils".split(" "),
function(e,F,R,P,I,x,J,q,H,T,Q,E,C,N){q=class extends E{constructor(h){super(h);this.autoplay=!0;this.content=null;this.type="video"}load(){const h=this.video;"string"===typeof h?this.addResolvingPromise(this._preProcessVideoUrl(h).then(y=>{const w=document.createElement("video");w.src=y;w.crossOrigin="anonymous";w.autoplay=!0;w.muted=!0;w.loop=!0;w.playsInline=!0;return this._loadVideo(w).then(()=>{this._set("content",w)})})):h instanceof HTMLVideoElement?this.addResolvingPromise(this._loadVideo(h).then(()=>
{this._set("content",h)})):this.addResolvingPromise(Promise.reject(new R("video-element:invalid-video-type","Invalid video type",{video:h})));return Promise.resolve(this)}get contentWidth(){return this.content?.videoWidth??0}get contentHeight(){return this.content?.videoHeight??0}set video(h){"not-loaded"!==this.loadStatus?I.getLogger(this).error("#video","video cannot be changed after the element is loaded."):this._set("video",h)}writeVideo(h,y,w,A){h?(h="string"!==typeof h||x.isDataProtocol(h)||
x.isBlobProtocol(h)?null:h)?(!x.isAbsolute(h)&&A?.blockedRelativeUrls&&A.blockedRelativeUrls.push(h),h=x.makeAbsolute(h),N.itemIdFromResourceUrl(h)?A?.messages&&A.messages.push(new R("video-element:unsupported-video","video source cannot be an item resource")):y[w]=h):A?.messages&&A.messages.push(new R("video-element:unsupported-video","video source must be an absolute url")):A?.messages&&A.messages.push(new R("video-element:unsupported-video","video source is missing"))}async _preProcessVideoUrl(h){if(x.getProxyRule(h))return x.addProxy(h);
try{return await F(h,{method:"head"}),h}catch{return x.addProxy(h,!0)}}_loadVideo(h){return new Promise((y,w)=>{const A=P.once(h,"canplay",()=>{this.removeHandles("canplay");this.autoplay?h.play().then(y,w):y()});this.addHandles(A,"canplay");"anonymous"!==h.crossOrigin&&(h.crossOrigin="anonymous",x.isBlobProtocol(h.src)||(h.src=h.src))})}};e.__decorate([J.property()],q.prototype,"autoplay",void 0);e.__decorate([J.property({readOnly:!0})],q.prototype,"content",void 0);e.__decorate([J.property({readOnly:!0})],
q.prototype,"contentWidth",null);e.__decorate([J.property({readOnly:!0})],q.prototype,"contentHeight",null);e.__decorate([J.property(C.mediaElementUrlProperty)],q.prototype,"video",null);e.__decorate([Q.writer("video")],q.prototype,"writeVideo",null);e.__decorate([J.property(C.mediaTypeProperty)],q.prototype,"type",void 0);return q=e.__decorate([T.subclass("esri.layers.support.VideoElement")],q)})},"*noref":1}});
define("require ../chunks/tslib.es6 ../core/Collection ../core/Error ../core/Logger ../core/MultiOriginJSONSupport ../core/promiseUtils ../core/accessorSupport/decorators/property ../core/accessorSupport/decorators/cast ../core/RandomLCG ../core/has ../core/accessorSupport/decorators/reader ../core/accessorSupport/decorators/subclass ../core/accessorSupport/decorators/writer ../core/accessorSupport/PropertyOrigin ./Layer ./mixins/BlendLayer ./mixins/OperationalLayer ./mixins/PortalLayer ./mixins/ScaleRangeLayer ./support/ControlPointsGeoreference ./support/ImageElement ./support/LocalMediaElementSource ./support/mediaUtils ./support/VideoElement ../webdoc/interfaces".split(" "),function(e,
F,R,P,I,x,J,q,H,T,Q,E,C,N,h,y,w,A,M,K,c,r,u,v,S,k){function g(l){return"object"===typeof l&&null!=l&&"type"in l}function z(l){return g(l)&&("image"===l.type||"video"===l.type)}x=class extends w.BlendLayer(K.ScaleRangeLayer(A.OperationalLayer(M.PortalLayer(x.MultiOriginJSONMixin(y))))){constructor(l){super(l);this.copyright=this.georeference=this.effectiveSource=null;this.operationalLayerType="MediaLayer";this.spatialReference=null;this.type="media";this._debouncedSaveOperations=J.debounce(async(t,
B,O)=>{const {save:Y,saveAs:a}=await new Promise((b,m)=>e(["./save/mediaLayerUtils"],b,m));switch(t){case k.SaveOperationType.SAVE:return Y(this,B);case k.SaveOperationType.SAVE_AS:return a(this,O,B)}});this.source=new u}load(l){this.addResolvingPromise(this._doLoad(l));return Promise.resolve(this)}async _doLoad(l){await this.loadFromPortal({supportedTypes:["Media Layer"]},l);var t=this.source;if(!t)throw new P("media-layer:source-missing","Set 'MediaLayer.source' before loading the layer.");const B=
this._getSourceOverride(t,this.georeference);B&&(this.setAtOrigin("source",B,"web-map"),this.setAtOrigin("source",B,"web-scene"),t=B);t=g(t)?new u({elements:new R([t])}):t;this._set("effectiveSource",t);this.spatialReference&&(t.spatialReference=this.spatialReference);await t.load(l);this.spatialReference=t.spatialReference}destroy(){this.effectiveSource?.destroy();this.effectiveSource!==this.source&&this.source?.destroy()}readGeoreference(l,t){return l&&"itemId"in t&&t.itemId?l:void 0}get fullExtent(){return this.loaded?
this.effectiveSource.fullExtent:null}set source(l){"loaded"===this.loadStatus||"failed"===this.loadStatus?I.getLogger(this).error("#source","source cannot be changed after the layer is loaded."):this._set("source",l)}castSource(l){return l?Array.isArray(l)?new u({elements:new R(l)}):l instanceof R?new u({elements:l}):l:null}readSource(l,t,B){if(!("itemId"in t&&t.itemId))return l=this._createSource(t),l?.read(t,B),l}writeSource(l,t,B,O){if(l&&l instanceof u){B=l.elements.length;if(1!==B){O?.messages&&
O.messages.push(new P("media-layer:unsupported-source",`local media element source can only be persisted if it contains exactly one ImageElement, but it has ${B}.`));return}l=l.elements.at(0)}z(l)?l.write(t,O):O?.messages&&(l?O.messages.push(new P("media-layer:unsupported-source","only media elements of type 'ImageElement' or 'VideoElement' can be persisted")):O.messages.push(new P("media-layer:unsupported-source","the media layer is missing a source")))}async save(l){return this._debouncedSaveOperations(k.SaveOperationType.SAVE,
l)}async saveAs(l,t){return this._debouncedSaveOperations(k.SaveOperationType.SAVE_AS,t,l)}_createSource(l){if("mediaType"in l)switch(l.mediaType){case "image":return new r;case "video":return new S}return null}_getSourceOverride(l,t){if(g(l)&&this.originIdOf("source")===h.OriginId.PORTAL_ITEM&&t&&(this.originIdOf("georeference")===h.OriginId.WEB_MAP||this.originIdOf("georeference")===h.OriginId.WEB_SCENE)){l=l.toJSON();const B=this._createSource(l);B.read({...l},{origin:"portal-item"});B.read({georeference:t},
{origin:"web-map"});B.read({georeference:t},{origin:"web-scene"});return B}return null}};F.__decorate([q.property({readOnly:!0})],x.prototype,"effectiveSource",void 0);F.__decorate([q.property({readOnly:!0,json:{read:!1,write:!1,origins:{"web-document":{read:!0}}}})],x.prototype,"georeference",void 0);F.__decorate([E.reader("web-document","georeference")],x.prototype,"readGeoreference",null);F.__decorate([q.property({type:String})],x.prototype,"copyright",void 0);F.__decorate([q.property({readOnly:!0})],
x.prototype,"fullExtent",null);F.__decorate([q.property({type:["MediaLayer"]})],x.prototype,"operationalLayerType",void 0);F.__decorate([q.property({type:["show","hide"]})],x.prototype,"listMode",void 0);F.__decorate([q.property({nonNullable:!0,json:{write:{enabled:!0,allowNull:!1,target:{url:{type:String},mediaType:{type:["image","video"]},georeference:{type:c}},overridePolicy(l,t,B){return{enabled:!0,allowNull:!1,ignoreOrigin:v.isWritingLayerFromItemToWebDocument(this,B?.origin)&&z(l)&&!!l.georeference&&
l.originIdOf("georeference")>h.OriginId.PORTAL_ITEM}}}}})],x.prototype,"source",null);F.__decorate([H.cast("source")],x.prototype,"castSource",null);F.__decorate([E.reader("source",["url"])],x.prototype,"readSource",null);F.__decorate([N.writer("source")],x.prototype,"writeSource",null);F.__decorate([q.property()],x.prototype,"spatialReference",void 0);F.__decorate([q.property({readOnly:!0})],x.prototype,"type",void 0);return x=F.__decorate([C.subclass("esri.layers.MediaLayer")],x)});