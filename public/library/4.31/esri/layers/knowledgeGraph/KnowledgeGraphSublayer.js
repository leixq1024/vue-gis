// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.31/esri/copyright.txt for details.
//>>built
define("../../chunks/tslib.es6 ../../geometry ../../PopupTemplate ../../renderers/ClassBreaksRenderer ../../renderers/DictionaryRenderer ../../renderers/DotDensityRenderer ../../renderers/HeatmapRenderer ../../renderers/PieChartRenderer ../../renderers/Renderer ../../renderers/SimpleRenderer ../../renderers/UniqueValueRenderer ../../renderers/support/jsonUtils ../../renderers/support/types ../../core/lang ../../core/MultiOriginJSONSupport ../../core/workers/workers ../../core/accessorSupport/decorators/property ../../core/has ../../core/Logger ../../core/accessorSupport/decorators/subclass ../../core/accessorSupport/decorators/writer ../../core/accessorSupport/PropertyOrigin ../../geometry/projection ../../geometry/SpatialReference ../../geometry/support/spatialReferenceUtils ../Layer ../graphics/data/FeatureStore ../graphics/data/QueryEngine ../graphics/sources/support/clientSideDefaults ./KnowledgeGraphSublayerBase ./layerUtils ../mixins/BlendLayer ../mixins/FeatureEffectLayer ../mixins/FeatureReductionLayer ../mixins/OrderedLayer ../mixins/RefreshableLayer ../mixins/ScaleRangeLayer ../mixins/TemporalLayer ../support/commonProperties ../support/featureReductionUtils ../support/Field ../support/fieldUtils ../support/LabelClass ../support/labelingInfo ../support/TimeInfo ../../rest/support/FeatureSet ../../rest/support/Query ../../support/popupUtils ../../core/workers/RemoteClient ../../geometry/Extent ../../geometry/Polygon ../../geometry/Polyline ../../geometry/Point ../../geometry/support/typeUtils".split(" "),
function(d,c,I,ja,ka,la,ma,na,oa,pa,qa,v,J,h,K,ra,e,sa,ta,L,M,N,w,O,x,P,Q,R,t,S,l,y,A,T,B,U,V,C,m,W,u,D,X,Y,Z,aa,p,ba,ca,E,da,ea,fa,n){function k(a){if(!a.json)return a;a.json.write=F(a.json.write);const b=a.json.origins;if(!b)return a;let f;for(f in b){const g=b[f];g&&(g.write=F(g.write))}return a}function F(a){return"object"===typeof a&&a?(!1!==a.enabled&&(a.overridePolicy=ha(a)),a):!0===a?q():a}function ha(a){const {target:b,writer:f,overridePolicy:g,...z}=a;return function(r,ia){r=G.call(this,
r,ia);return r.enabled?{...z,...r}:r}}function q(){return{overridePolicy:G}}function G(a,b){const f=!!this.geometryType;let g={enabled:f};f&&(g={...g,...H.call(this,a,b)});return g}function H(a,b){return{ignoreOrigin:this.originIdOf(b)>N.OriginId.DEFAULTS}}c=class extends S.KnowledgeGraphSublayerBase(T.FeatureReductionLayer(A.FeatureEffectLayer(y.BlendLayer(B.OrderedLayer(C.TemporalLayer(V.ScaleRangeLayer(U.RefreshableLayer(K.MultiOriginJSONMixin(P))))))))){constructor(a){super(a);this.blendMode=
"normal";this.capabilities=t.createCapabilities(!1,!1);this.definitionExpression=this.charts=null;this.displayField="";this.graphType=this.featureEffect=this.elevationInfo=this.effect=null;this.labelsVisible=!0;this.layerType=this.labelingInfo=null;this.legendEnabled=!0;this.minScale=this.maxScale=0;this.objectIdField=l.systemOidFieldName;this.objectType=null;this.opacity=1;this.parentCompositeLayer=this.parent=this.orderBy=null;this.popupEnabled=this.persistenceEnabled=!0;this.popupTemplate=null;
this.refreshInterval=0;this.source={openPorts:()=>this.load().then(()=>{const b=new MessageChannel;new ca(b.port1,{channel:b,client:{queryFeatures:(f,g={})=>{f=p.fromJSON(f);return this.queryFeaturesJSON(f,g)}}});return[b.port2]})};this.type="knowledge-graph-sublayer";this.visible=this.useViewTime=!0}get defaultPopupTemplate(){return this.createPopupTemplate()}set featureReduction(a){a=this._normalizeFeatureReduction(a);this._set("featureReduction",a)}get fields(){const a=[];this.objectType?.properties?.forEach(b=>
{a.push(u.fromJSON({name:b.name,type:"esriFieldTypeOID"===b.fieldType?"esriFieldTypeInteger":b.fieldType,alias:b.alias,defaultValue:b.defaultValue,editable:b.editable,nullable:b.nullable}))});a.push(u.fromJSON({name:this.objectIdField,type:"esriFieldTypeString",alias:this.objectIdField,editable:!1}),u.fromJSON({name:l.systemAggregationCountFieldName,type:"esriFieldTypeInteger",alias:l.systemAggregationCountFieldName,editable:!1}),u.fromJSON({name:l.systemIsSpatialFieldName,type:"esriFieldTypeInteger",
alias:l.systemIsSpatialFieldName,editable:!1}));return a}get geometryType(){if("link-chart"===this.parentCompositeLayer?.type)return"relationship"===this.graphType?"polyline":"point";const a=this.parentCompositeLayer?.dataManager.geographicLookup.get(this.objectType?.name)?.geometryType;return a&&"esriGeometryNull"!==a?n.featureGeometryTypeKebabDictionary.fromJSON(a):null}get geometryFieldName(){return"link-chart"===this.parentCompositeLayer?.type?l.systemLayoutGeometryFieldName:this.parentCompositeLayer?.dataManager.geographicLookup.get(this.objectType?.name)?.name??
null}get graphTypeName(){return this.objectType?.name}get hasM(){const a=this.parentCompositeLayer?.dataManager.geographicLookup.get(this.objectType?.name)?.name;return(a?this.objectType?.properties?.[a]:null)?.hasM??!1}get hasZ(){const a=this.parentCompositeLayer?.dataManager.geographicLookup.get(this.objectType?.name)?.name;return(a?this.objectType?.properties?.[a]:null)?.hasZ??!1}set renderer(a){D.fixRendererFields(a,this.fieldsIndex);this._set("renderer",a)}get renderer(){return this._isOverridden("renderer")?
this._get("renderer"):"link-chart"===this.parentCompositeLayer?.type?"relationship"===this.graphType?v.fromJSON(t.createDrawingInfo(n.featureGeometryTypeKebabDictionary.toJSON("polyline")).renderer):v.fromJSON(t.createDrawingInfo(n.featureGeometryTypeKebabDictionary.toJSON("point")).renderer):v.fromJSON(t.createDrawingInfo(n.featureGeometryTypeKebabDictionary.toJSON(this.geometryType)).renderer)}get spatialReference(){return this.parentCompositeLayer?.dataManager?.knowledgeGraph?.dataModel?.spatialReference??
O.WGS84}set timeInfo(a){this._set("timeInfo",a)}get title(){return this._isOverridden("title")?this._get("title"):this.graphTypeName}set title(a){this._set("title",a)}writeTitle(a,b){b.title=a??"Layer"}createPopupTemplate(a){return ba.createPopupTemplate(this,a)}createQuery(){return new p({where:"1\x3d1",outFields:["*"]})}getField(a){for(let b=0;b<this.fields.length;b++)if(this.fields[b].name===a)return this.fields[b];return null}getFieldDomain(a,b){return null}async queryFeatures(a,b){const {resolvedQuery:f,
queryEngine:g}=await this._setupQueryObjects(a);a=aa.fromJSON(await g.executeQuery(f.toJSON(),b?.signal));a.features.forEach(z=>{z.sourceLayer=this});return a}async queryFeaturesJSON(a,b){const {resolvedQuery:f,queryEngine:g}=await this._setupQueryObjects(a);return await g.executeQuery(f.toJSON(),b?.signal)}async queryFeatureCount(a,b){const {resolvedQuery:f,queryEngine:g}=await this._setupQueryObjects(a);return g.executeQueryForCount(f.toJSON(),b?.signal)}async queryExtent(a={},b){const {resolvedQuery:f,
queryEngine:g}=await this._setupQueryObjects({...a,returnGeometry:!0});a=await g.executeQueryForExtent(f.toJSON(),b?.signal);b=null!=a.extent?.xmin&&null!=a.extent?.xmax&&null!=a.extent?.ymin&&null!=a.extent?.ymax?new E(a.extent):new E;return{count:a.count,extent:b}}async queryObjectIds(a,b){a=p.from(a);if("link-chart"===this.parentCompositeLayer.type&&this._cachedQueryEngine)var f=this._cachedQueryEngine;else f=await this.parentCompositeLayer.dataManager.getData(a,this,b),f=this.loadQueryEngine(f);
return f.executeQueryForIds(a.toJSON(),b?.signal)}loadQueryEngine(a){var b=new Q({geometryType:n.featureGeometryTypeKebabDictionary.toJSON(this.geometryType),hasM:this.hasM,hasZ:this.hasZ});b=new R.QueryEngine({fieldsIndex:this.fieldsIndex.toJSON(),geometryType:n.featureGeometryTypeKebabDictionary.toJSON(this.geometryType),hasM:this.hasM,hasZ:this.hasZ,objectIdField:this.objectIdField,spatialReference:this.spatialReference.toJSON(),timeInfo:this.timeInfo?.toJSON(),featureStore:b});b.featureStore.addMany(a);
return b}async refreshCachedQueryEngine(){const a=await this.parentCompositeLayer.dataManager.getData(new p({where:"1\x3d1",outFields:[l.systemOidFieldName]}),this);this._cachedQueryEngine=this.loadQueryEngine(a)}load(a){this.addResolvingPromise(this.parent.load(a).then(()=>{D.fixTimeInfoFields(this.timeInfo,this.fieldsIndex)}));return Promise.resolve(this)}async _setupQueryObjects(a,b){a=p.from(a);const f=a.geometry;f&&!f.spatialReference?.isWGS84&&(await w.initializeProjection(f.spatialReference,
x.wgs84),a.geometry=f instanceof da||f instanceof ea||f instanceof fa?w.project(f,x.wgs84):w.project(f.extent,x.wgs84));"link-chart"===this.parentCompositeLayer.type&&this._cachedQueryEngine?b=this._cachedQueryEngine:(b=await this.parentCompositeLayer.dataManager.getData(a,this,b),b=this.loadQueryEngine(b));return{resolvedQuery:a,queryEngine:b}}};d.__decorate([e.property(k(h.clone(y.blendModeProperty)))],c.prototype,"blendMode",void 0);d.__decorate([e.property()],c.prototype,"capabilities",void 0);
d.__decorate([e.property({json:{origins:{"web-scene":{write:!1}},write:q()}})],c.prototype,"charts",void 0);d.__decorate([e.property({readOnly:!0})],c.prototype,"defaultPopupTemplate",null);d.__decorate([e.property({type:String,json:{origins:{service:{read:!1}},name:"layerDefinition.definitionExpression",write:{ignoreOrigin:!0}}})],c.prototype,"definitionExpression",void 0);d.__decorate([e.property()],c.prototype,"displayField",void 0);d.__decorate([e.property(k(h.clone(y.effectProperty)))],c.prototype,
"effect",void 0);d.__decorate([e.property()],c.prototype,"elevationInfo",void 0);d.__decorate([e.property(k(h.clone(A.featureEffectProperty)))],c.prototype,"featureEffect",void 0);d.__decorate([e.property(k(h.clone(W.featureReductionProperty)))],c.prototype,"featureReduction",null);d.__decorate([e.property()],c.prototype,"fields",null);d.__decorate([e.property()],c.prototype,"geometryType",null);d.__decorate([e.property()],c.prototype,"geometryFieldName",null);d.__decorate([e.property({type:["entity",
"relationship"],nonNullable:!0,json:{write:{isRequired:!0,ignoreOrigin:!0}}})],c.prototype,"graphType",void 0);d.__decorate([e.property({type:String,nonNullable:!0,json:{write:{isRequired:!0,ignoreOrigin:!0}}})],c.prototype,"graphTypeName",null);d.__decorate([e.property()],c.prototype,"hasM",null);d.__decorate([e.property()],c.prototype,"hasZ",null);d.__decorate([e.property({type:String,json:{origins:{service:{read:!1},"portal-item":{read:!1}},write:{ignoreOrigin:!0}}})],c.prototype,"id",void 0);
d.__decorate([e.property(k(h.clone(m.labelsVisible)))],c.prototype,"labelsVisible",void 0);d.__decorate([e.property({type:[X],json:{name:"layerDefinition.drawingInfo.labelingInfo",read:Y.reader,write:q()}})],c.prototype,"labelingInfo",void 0);d.__decorate([e.property({readOnly:!0,json:{read:!1,write:{writer(a,b){switch(this.parentCompositeLayer.type){case "link-chart":b.layerType="LinkChartSubLayer";break;case "knowledge-graph":b.layerType=this.geometryType?"KnowledgeGraphSubLayer":"KnowledgeGraphSubTable"}},
isRequired:!0,ignoreOrigin:!0,writerEnsuresNonNull:!0}}})],c.prototype,"layerType",void 0);d.__decorate([e.property(k(h.clone(m.legendEnabled)))],c.prototype,"legendEnabled",void 0);d.__decorate([e.property(k(h.clone(m.maxScale)))],c.prototype,"maxScale",void 0);d.__decorate([e.property(k(h.clone(m.minScale)))],c.prototype,"minScale",void 0);d.__decorate([e.property()],c.prototype,"objectIdField",void 0);d.__decorate([e.property()],c.prototype,"objectType",void 0);d.__decorate([e.property(k(h.clone(m.opacity)))],
c.prototype,"opacity",void 0);d.__decorate([e.property(k(h.clone(B.orderByProperty)))],c.prototype,"orderBy",void 0);d.__decorate([e.property({clonable:!1})],c.prototype,"parent",void 0);d.__decorate([e.property()],c.prototype,"parentCompositeLayer",void 0);d.__decorate([e.property(k(h.clone(m.popupEnabled)))],c.prototype,"popupEnabled",void 0);d.__decorate([e.property({type:I,json:{name:"popupInfo",write:{ignoreOrigin:!0}}})],c.prototype,"popupTemplate",void 0);d.__decorate([e.property({type:Number,
json:{write:{overridePolicy:H}}})],c.prototype,"refreshInterval",void 0);d.__decorate([e.property({types:J.rendererTypes,json:{name:"layerDefinition.drawingInfo.renderer",write:q()}})],c.prototype,"renderer",null);d.__decorate([e.property()],c.prototype,"source",void 0);d.__decorate([e.property()],c.prototype,"spatialReference",null);d.__decorate([e.property({type:Z,json:{name:"layerDefinition.timeInfo",write:!0,origins:{"web-document":{name:"layerDefinition.timeInfo",read:!0,write:!0},"portal-item":{name:"layerDefinition.timeInfo",
read:!0,write:!0}}}})],c.prototype,"timeInfo",null);d.__decorate([e.property({type:String,json:{write:{isRequired:!0,ignoreOrigin:!0,writerEnsuresNonNull:!0}}})],c.prototype,"title",null);d.__decorate([M.writer("title")],c.prototype,"writeTitle",null);d.__decorate([e.property({json:{read:!1}})],c.prototype,"type",void 0);d.__decorate([e.property(k(h.clone(C.useViewTimeProperty)))],c.prototype,"useViewTime",void 0);d.__decorate([e.property({type:Boolean,json:{name:"visibility",write:q()}})],c.prototype,
"visible",void 0);return c=d.__decorate([L.subclass("esri.layers.knowledgeGraph.KnowledgeGraphSublayer")],c)});