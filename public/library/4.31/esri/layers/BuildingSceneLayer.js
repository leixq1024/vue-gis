// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.31/esri/copyright.txt for details.
//>>built
define("../chunks/tslib.es6 ../core/Collection ../core/CollectionFlattener ../core/Error ../core/lang ../core/loadAll ../core/Logger ../core/MultiOriginJSONSupport ../core/promiseUtils ../core/urlUtils ../core/accessorSupport/decorators/property ../core/has ../core/accessorSupport/decorators/reader ../core/accessorSupport/decorators/subclass ../geometry/SpatialReference ./Layer ./buildingSublayers/BuildingComponentSublayer ./buildingSublayers/BuildingGroupSublayer ./mixins/APIKeyMixin ./mixins/ArcGISService ./mixins/CustomParametersMixin ./mixins/OperationalLayer ./mixins/PortalLayer ./mixins/ScaleRangeLayer ./mixins/SceneService ./support/associatedFeatureServiceUtils ./support/BuildingFilter ./support/BuildingSummaryStatistics ./support/commonProperties ../support/elevationInfoUtils".split(" "),
function(e,l,A,t,u,B,p,c,C,D,f,q,v,E,F,G,w,k,H,I,J,K,L,M,r,N,O,x,m,n){function P(a,b){b.forEach(d=>y(a,d))}function y(a,b){const {overrides:d,context:g}=b;k.forEachSublayer(a,h=>h.read(d.get(h.id),g))}function Q(a,b,d){const g=[];k.forEachSublayer(a,h=>{h=h.write({},d);1<Object.keys(h).length&&g.push(h)});0<g.length&&(b.sublayers=g)}function R(a,b,d){if(a=d?.origin&&a.get(d.origin))b.sublayers=[],a.overrides.forEach(g=>{b.sublayers.push(u.clone(g))})}const z=l.ofType(O);l=u.clone(k.sublayersProperty);
if(q=l.json?.origins)q["web-scene"]={type:[w],write:{enabled:!0,overridePolicy:()=>({enabled:!1})}},q["portal-item"]={type:[w],write:{enabled:!0,overridePolicy:()=>({enabled:!1})}};c=class extends r.SceneService(I.ArcGISService(K.OperationalLayer(L.PortalLayer(M.ScaleRangeLayer(c.MultiOriginJSONMixin(J.CustomParametersMixin(H.APIKeyMixin(G)))))))){constructor(a){super(a);this.operationalLayerType="BuildingSceneLayer";this.allSublayers=new A({getCollections:()=>[this.sublayers],getChildrenFunction:b=>
"building-group"===b.type?b.sublayers:null});this._allSublayerOverrides=this.sublayers=null;this.filters=new z;this.outFields=this.summaryStatistics=this.activeFilterId=null;this.legendEnabled=!0;this.type="building-scene"}normalizeCtorArgs(a){return"string"===typeof a?{url:a}:a??{}}destroy(){this.allSublayers.destroy()}readSublayers(a,b,d){a=k.readSublayers(a,b,d);k.forEachSublayer(a,g=>g.layer=this);this._allSublayerOverrides&&(P(a,this._allSublayerOverrides),this._allSublayerOverrides=null);return a}write(a,
b){a=super.write(a,b);!b||"web-scene"!==b.origin&&"portal-item"!==b.origin||(this.sublayers?Q(this.sublayers,a,b):this._allSublayerOverrides&&R(this._allSublayerOverrides,a,b));return a}read(a,b){super.read(a,b);if(("web-scene"===b?.origin||"portal-item"===b?.origin)&&Array.isArray(a?.sublayers)){a=a.sublayers;const g=new Map;for(d of a)null==d||"object"!==typeof d||"number"!==typeof d.id?b.messages?.push(new t("building-scene-layer:invalid-sublayer-override","Invalid value for sublayer override. Not an object or no id specified.",
{value:d})):g.set(d.id,d);var d={overrides:g,context:b};this.sublayers?y(this.sublayers,d):(this._allSublayerOverrides??(this._allSublayerOverrides=new Map),this._allSublayerOverrides.set(b.origin,d))}}readSummaryStatistics(a,b){return"string"===typeof b.statisticsHRef?(a=D.join(this.parsedUrl?.path,b.statisticsHRef),new x({url:a})):null}set elevationInfo(a){this._set("elevationInfo",a);this._validateElevationInfo()}load(a){const b=null!=a?a.signal:null;a=this.loadFromPortal({supportedTypes:["Scene Service"]},
a).catch(C.throwIfAbortError).then(()=>this._fetchService(b)).then(()=>this._fetchAssociatedFeatureService(b));this.addResolvingPromise(a);return Promise.resolve(this)}loadAll(){return B.loadAll(this,a=>{k.forEachSublayer(this.sublayers,b=>{"building-group"!==b.type&&a(b)});this.summaryStatistics&&a(this.summaryStatistics)})}async saveAs(a,b){return this._debouncedSaveOperations(r.SaveOperationType.SAVE_AS,{...b,getTypeKeywords:()=>this._getTypeKeywords(),portalItemLayerType:"building-scene"},a)}async save(){return this._debouncedSaveOperations(r.SaveOperationType.SAVE,
{getTypeKeywords:()=>this._getTypeKeywords(),portalItemLayerType:"building-scene"})}validateLayer(a){if(!a.layerType||"Building"!==a.layerType)throw new t("buildingscenelayer:layer-type-not-supported","BuildingSceneLayer does not support this layer type",{layerType:a.layerType});}_getTypeKeywords(){return["Building"]}async _fetchAssociatedFeatureService(a){try{const {portalItem:b}=await N.findAssociatedFeatureService(`${this.url}/layers/${this.layerId}`,{sceneLayerItem:this.portalItem,customParameters:this.customParameters,
apiKey:this.apiKey,signal:a});this.associatedFeatureServiceItem=b}catch(b){p.getLogger(this).warn("Associated feature service item could not be loaded",b)}}_validateElevationInfo(){const a=this.elevationInfo;n.logInvalidElevationInfoWarning(p.getLogger(this),n.elevationModeRequiredMessage("Building scene layers","absolute-height",a));n.logInvalidElevationInfoWarning(p.getLogger(this),n.featureExpressionUnsupportedMessage("Building scene layers",a))}};e.__decorate([f.property({type:["BuildingSceneLayer"]})],
c.prototype,"operationalLayerType",void 0);e.__decorate([f.property({readOnly:!0})],c.prototype,"allSublayers",void 0);e.__decorate([f.property(l)],c.prototype,"sublayers",void 0);e.__decorate([v.reader("service","sublayers")],c.prototype,"readSublayers",null);e.__decorate([f.property({type:z,nonNullable:!0,json:{write:!0}})],c.prototype,"filters",void 0);e.__decorate([f.property({type:String,json:{write:!0}})],c.prototype,"activeFilterId",void 0);e.__decorate([f.property({readOnly:!0,type:x})],c.prototype,
"summaryStatistics",void 0);e.__decorate([v.reader("summaryStatistics",["statisticsHRef"])],c.prototype,"readSummaryStatistics",null);e.__decorate([f.property({type:[String],json:{read:!1}})],c.prototype,"outFields",void 0);e.__decorate([f.property(m.sceneLayerFullExtent)],c.prototype,"fullExtent",void 0);e.__decorate([f.property(m.legendEnabled)],c.prototype,"legendEnabled",void 0);e.__decorate([f.property({type:["show","hide","hide-children"]})],c.prototype,"listMode",void 0);e.__decorate([f.property(m.readOnlyService(F))],
c.prototype,"spatialReference",void 0);e.__decorate([f.property(m.elevationInfo)],c.prototype,"elevationInfo",null);e.__decorate([f.property({json:{read:!1},readOnly:!0})],c.prototype,"type",void 0);e.__decorate([f.property()],c.prototype,"associatedFeatureServiceItem",void 0);return c=e.__decorate([E.subclass("esri.layers.BuildingSceneLayer")],c)});