// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.31/esri/copyright.txt for details.
//>>built
define(["exports","../../../../core/date","../../../../core/number","../../../support/fieldUtils","../../../support/locationUtils"],function(l,C,D,q,E){function*r(a,d,b){let c=0;for(;c<=a.length;){var f=a.indexOf(d,c);f=a.slice(c,-1<f?f:void 0);c+=f.length+d.length;if(!b||f.trim())yield f}}function t(a){const d=a.includes("\r\n")?"\r\n":"\n";return r(a,d,!0)}function n(a,d){return r(a,d,!1)}function*u(a,d,b,c=()=>Object.create(null)){var f=t(a);f.next();var e="";a="";let g=0,h=c(),k=0;a:for(const p of f){f=
n(p,b);for(const v of f)if(e+=a+v,a="",g+=w(v),0===g%2){if(0<g)if(e=x.exec(e))h[d[k]]=e[1].replaceAll(y,'"'),k++;else{h=c();k=0;e="";g=0;continue a}else h[d[k]]=e,k++;e="";g=0}else a=b;0===g?(yield h,h=c(),k=0):a="\n"}}function z(a,d){a=m(a,d).filter(b=>null!=b);d=a.map(b=>q.normalizeFieldName(b));for(let b=d.length-1;0<=b;b--)d[b]||(d.splice(b,1),a.splice(b,1));return{names:d,aliases:a}}function m(a,d){if(!a?.length)return[];const b=[];var c="";let f="",e=0;a=n(a,d);for(const g of a)c+=f+g,f="",
e+=w(g),0===e%2?(0<e?(c=x.exec(c))&&b.push(c[1].replaceAll(y,'"')):b.push(c),c="",e=0):f=d;return b}function w(a){let d=0,b;for(b=a.indexOf('"',0);0<=b;)d++,b=a.indexOf('"',b+1);return d}function A(a){if(!a.length)return"string";const d=/[^+\-.,0-9]/;return a.map(b=>{if(""!==b){if(!d.test(b)){let c=B(b);if(!isNaN(c))return/[.,]/.test(b)||!Number.isInteger(c)||214783647<c||-214783648>c?"double":"integer";if(b.includes("E"))if(c=Number(b),Number.isNaN(c)){if(b.includes(",")&&(b=b.replace(",","."),c=
Number(b),!Number.isNaN(c)))return"double"}else return"double"}return C.isDateString(b)?"date":"string"}}).reduce((b,c)=>{if(void 0===b)return c;if(void 0===c)return b;if(b===c)return c;if("string"===b||"string"===c)return"string";if("double"===b||"double"===c)return"double"})}const x=/^\s*"([\S\s]*)"\s*$/,y=/""/g,F=[","," ",";","|","\t"],B=function(){const a=D._parseInfo(),d=new RegExp("^"+a.regexp+"$"),b=new RegExp("["+a.group+"\\s\\xa0]","g"),c=a.factor;return f=>{f=d.exec(f);a.factor=c;if(!f)return NaN;
let e=f[1];if(!f[1]){if(!f[2])return NaN;e=f[2];a.factor*=-1}e=e.replace(b,"").replace(a.decimal,".");return+e*a.factor}}();l.extractFieldNamesAndAliasesFromRow=z;l.inferDelimiterAndLocationInfo=function(a,d,b){a=a.trim();d=d?.trim();var c=[],f=Array.from(new Set([b?.delimiter,...F])).filter(e=>null!=e);for(const e of f){f=m(a,e).length;const g=m(d,e).length??f;1<f&&c.push({weight:Math.min(f,g),delimiter:e})}d=c.sort(({weight:e},{weight:g})=>g-e).map(({delimiter:e})=>e);for(const e of d)if(c=z(a,
e).names,c=E.inferLocationInfo(c,b?.longitudeField,b?.latitudeField),c.longitudeFieldName&&c.latitudeFieldName)return{delimiter:e,locationInfo:c};return{delimiter:d[0],locationInfo:null}};l.inferFieldType=A;l.inferFields=function(a,d,b,c,f){const e=[];d=u(a,b,d);a=[];for(var g of d){if(10===a.length)break;a.push(g)}for(g=0;g<b.length;g++){const k=b[g];d=c[g];if(k===f.longitudeFieldName||k===f.latitudeFieldName)e.push({name:k,type:"esriFieldTypeDouble",alias:d});else{var h=a.map(p=>p[k]);switch(A(h)){case "integer":h=
"esriFieldTypeInteger";break;case "double":h="esriFieldTypeDouble";break;case "date":h="esriFieldTypeDate";break;default:h="esriFieldTypeString"}e.push({name:k,type:h,alias:d,length:q.getFieldDefaultLength(h)})}}return e};l.parseNumber=B;l.parseRows=u;l.readRowParts=n;l.readRows=t;l.severSlicedString=function(a){return JSON.parse(JSON.stringify(a))};l.splitSingleRow=m;Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})});