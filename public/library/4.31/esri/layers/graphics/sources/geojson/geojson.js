// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.31/esri/copyright.txt for details.
//>>built
define("exports ../../../../core/date ../../../../core/Error ../../../../geometry/support/spatialReferenceUtils ../../OptimizedFeature ../../OptimizedGeometry ../../../support/fieldUtils".split(" "),function(p,F,v,G,H,I,w){function*y(a){switch(a.type){case "Feature":yield a;break;case "FeatureCollection":for(const b of a.features)b&&(yield b)}}function*J(a){if(a)switch(a.type){case "Point":yield a.coordinates;break;case "LineString":case "MultiPoint":yield*a.coordinates;break;case "MultiLineString":case "Polygon":for(const b of a.coordinates)yield*b;
break;case "MultiPolygon":for(const b of a.coordinates)for(const c of b)yield*c}}function*K(a,b={}){const {geometryType:c,objectIdField:d}=b;for(const f of a){const {geometry:g,properties:e,id:m}=f;if(g&&t[g.type]!==c)continue;a=e||{};let l=void 0;d&&(l=a[d],null==m||l||(a[d]=l=m));yield new H.OptimizedFeature(g?L(new I,g,b):null,a,null,l??void 0)}}function M(a){for(const b of a)if(2<b.length)return!0;return!1}function z(a){let b=0;for(let c=0;c<a.length;c++){const d=a[c],f=a[(c+1)%a.length];b+=d[0]*
f[1]-f[0]*d[1]}return 0>=b}function A(a){const b=a[0],c=a[a.length-1];b[0]===c[0]&&b[1]===c[1]&&b[2]===c[2]||a.push(b);return a}function L(a,b,c){switch(b.type){case "LineString":return q(a,b.coordinates,c),a;case "MultiLineString":for(const f of b.coordinates)q(a,f,c);return a;case "MultiPoint":return q(a,b.coordinates,c),a;case "MultiPolygon":for(var d of b.coordinates)for(B(a,d[0],c),b=1;b<d.length;b++)C(a,d[b],c);return a;case "Point":return x(a,b.coordinates,c),a;case "Polygon":d=b.coordinates;
B(a,d[0],c);for(b=1;b<d.length;b++)C(a,d[b],c);return a}}function B(a,b,c){b=A(b);z(b)?q(a,b,c):D(a,b,c)}function C(a,b,c){b=A(b);z(b)?D(a,b,c):q(a,b,c)}function q(a,b,c){for(const d of b)x(a,d,c);a.lengths.push(b.length)}function D(a,b,c){for(let d=b.length-1;0<=d;d--)x(a,b[d],c);a.lengths.push(b.length)}function x(a,b,c){const [d,f,g]=b;a.coords.push(d,f);c.hasZ&&a.coords.push(g||0)}function N(a){switch(typeof a){case "string":return F.isISO8601Date(a)?"esriFieldTypeDate":"esriFieldTypeString";
case "number":return"esriFieldTypeDouble";default:return"unknown"}}const t={LineString:"esriGeometryPolyline",MultiLineString:"esriGeometryPolyline",MultiPoint:"esriGeometryMultipoint",Point:"esriGeometryPoint",Polygon:"esriGeometryPolygon",MultiPolygon:"esriGeometryPolygon"};p.createOptimizedFeatures=function(a,b){return Array.from(K(y(a),b))};p.getGeometryType=function(a){return t[a]};p.inferLayerProperties=function(a,b={}){const c=[];var d=new Set;const f=new Set;var g=!1;let e=null,m=!1,l=void 0;
({geometryType:b=null}=b);for(const r of y(a)){const {geometry:u,properties:k,id:n}=r;if(u&&(b||=t[u.type],t[u.type]!==b))continue;g||(g=J(u),g=M(g));!m&&(m=null!=n)&&(l=typeof n,k&&(e=Object.keys(k).filter(h=>k[h]===n)));k&&e&&m&&null!=n&&(1<e.length?e=e.filter(h=>k[h]===n):1===e.length&&(e=k[e[0]]===n?e:[]));if(k)for(const h in k){if(d.has(h))continue;a=N(k[h]);if("unknown"===a){f.add(h);continue}f.delete(h);d.add(h);const E=w.normalizeFieldName(h);E&&c.push({name:E,alias:h,type:a})}}if(d=w.normalizeFieldName(1===
e?.length&&e[0]||null)??void 0)for(const r of c)if(r.name===d&&w.isNumericField(r)){r.type="esriFieldTypeOID";break}return{fields:c,geometryType:b,hasZ:g,objectIdFieldName:d,objectIdFieldType:l,unknownFields:Array.from(f)}};p.validateGeoJSON=function(a,b=4326){if(!a)throw new v("geojson-layer:empty","GeoJSON data is empty");if("Feature"!==a.type&&"FeatureCollection"!==a.type)throw new v("geojson-layer:unsupported-geojson-object","missing or not supported GeoJSON object type",{data:a});({crs:a}=a);
if(a){var c="string"===typeof a?a:"name"===a.type?a.properties.name:"EPSG"===a.type?a.properties.code:null;b=G.isWGS84({wkid:b})?RegExp(".*(CRS84H?|4326)$","i"):new RegExp(`.*(${b})$`,"i");if(!c||!b.test(c))throw new v("geojson:unsupported-crs","unsupported GeoJSON 'crs' member",{crs:a});}};Object.defineProperty(p,Symbol.toStringTag,{value:"Module"})});