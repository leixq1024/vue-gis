// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.31/esri/copyright.txt for details.
//>>built
define("exports ../../../core/Logger ../../../core/libs/gl-matrix-2/math/mat4 ../../../core/libs/gl-matrix-2/factories/mat4f64 ../../../core/libs/gl-matrix-2/factories/quatf64 ../../../chunks/vec32 ../../../core/libs/gl-matrix-2/factories/vec3f64 ../../Point ../../spatialReferenceEllipsoidUtils ../../projection/projectPointToVector ../axisAngleDegrees ../MeshTransform ../meshVertexSpaceUtils ./geographicUtils ./projection ./vertexSpaceConversion".split(" "),function(y,B,v,C,D,w,p,E,F,x,G,H,I,J,c,
K){function z(a,e,b=p.ZEROS){if(a)for(let q=0;q<a.length;q+=3){for(var h=0;3>h;h++)r[h]=a[q+h]-b[h];w.scale(r,r,e);for(h=0;3>h;h++)a[q+h]=r[h]+b[h]}}const k=()=>B.getLogger("esri.geometry.support.meshUtils.scale"),r=p.create(),L=p.create(),A=C.create(),m=p.create();y.scale=function(a,e,b){if(a.vertexAttributes?.position){var {vertexSpace:h,spatialReference:q}=a,f=b?.origin??a.origin;b=J.performGlobalOperation(k,h,q,b?.geographic);if(I.isMeshWithRelativeVertexSpace(a))a:{a.transform??(a.transform=
new H);const {vertexSpace:n,transform:g,spatialReference:l}=a,[t,u,M]=n.origin;var d=new E({x:t,y:u,z:M,spatialReference:l});b=r;if(d.equals(f))w.set(b,0,0,0);else if(!K.projectPointToVertexSpace(b,f,a)){c.logProjectionError(k(),f.spatialReference,l,c.loadProjectErrorMessage);break a}a=w.set(L,e,e,e);a=v.fromRotationTranslationScaleOrigin(A,D.IDENTITY,p.ZEROS,a,b);({localMatrix:e}=g);a=v.multiply(A,a,e);g.scale=v.getScaling(p.create(),a);v.scale(a,a,w.inverse(r,g.scale));e=g.rotationAxis;g.rotation=
G.fromMatrix(a);0===g.rotationAngle&&(g.rotationAxis=e);g.translation=v.getTranslation(p.create(),a)}else if(b)a:{b=a.spatialReference;d=F.getSphericalPCPF(b);if(!x.projectPointToVector(f,m,d)&&(c.logProjectionError(k(),f.spatialReference,d,"Falling back to mesh origin"),!x.projectPointToVector(a.origin,m,d))){c.logProjectionError(k(),a.origin.spatialReference,d);break a}f=a.vertexAttributes.position;const n=a.vertexAttributes.normal,g=a.vertexAttributes.tangent,l=new Float64Array(f.length),t=null!=
n?new Float32Array(n.length):null,u=null!=g?new Float32Array(g.length):null;c.projectToPCPF(f,b,l,d)?null==n||null==t||c.projectNormalToPCPF(n,f,b,l,d,t)?null==g||null==u||c.projectTangentToPCPF(g,f,b,l,d,u)?(z(l,e,m),c.projectFromPCPF(l,d,f,b)?null==n||null==t||c.projectNormalFromPCPF(t,f,b,l,d,n)?null==g||null==u||c.projectTangentFromPCPF(u,f,b,l,d,g)?a.vertexAttributesChanged():c.logProjectionError(k(),d,b):c.logProjectionError(k(),d,b):c.logProjectionError(k(),d,b)):c.logProjectionError(k(),b,
d):c.logProjectionError(k(),b,d):c.logProjectionError(k(),b,d)}else x.projectPointToVector(f,m,a.spatialReference)?(z(a.vertexAttributes.position,e,m),a.vertexAttributesChanged()):(e=a.origin,m[0]=e.x,m[1]=e.y,m[2]=e.z,c.logProjectionError(k(),f.spatialReference,a.spatialReference,c.loadProjectErrorMessage))}};Object.defineProperty(y,Symbol.toStringTag,{value:"Module"})});