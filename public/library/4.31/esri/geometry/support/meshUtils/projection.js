// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.31/esri/copyright.txt for details.
//>>built
define("exports ../../../core/mathUtils ../../../core/libs/gl-matrix-2/math/mat3 ../../../core/libs/gl-matrix-2/factories/mat3f64 ../../../core/libs/gl-matrix-2/math/mat4 ../../../core/libs/gl-matrix-2/factories/mat4f64 ../../../chunks/vec32 ../../../core/libs/gl-matrix-2/factories/vec3f64 ../../projection/computeTranslationToOriginAndRotation ../../projection/projectBuffer ../Ellipsoid ../spatialReferenceUtils ../webMercatorUtils ../buffer/BufferView ../../../chunks/vec3 ../../../chunks/vec4".split(" "),
function(h,x,u,H,I,J,y,D,K,E,L,z,M,m,A,N){function F(b,a,f,d,e){a=a===h.VectorType.NORMAL?3:4;const g=[0,0];for(let l=0,q=1;l<b.length;l+=a,q+=3){d(f[q],g);const r=b[l]*g[0],k=b[l+1]*g[1],B=b[l+2],C=1/Math.sqrt(r*r+k*k+B*B);e[l]=r*C;e[l+1]=k*C;e[l+2]=B*C;4===a&&(e[l+3]=b[l+3])}return e}function G(b,a,f,d,e){K.computeTranslationToOriginAndRotation(d,f,t,d);b===p.FROM_PCPF&&I.invert(t,t);switch(a){case h.VectorType.NORMAL:return u.normalFromMat4(e,t);case h.VectorType.TANGENT:return u.fromMat4(e,t)}}
function v(b,a,f,d,e,g,l,q){if(a){var r=d.count;if(e.isWGS84||z.isCGCS2000(e)||z.isMars(e)||z.isMoon(e))for(d=0;d<r;d++)g.getVec(d,w),a.getVec(d,n),y.transformMat3(n,n,G(b,f,w,l,c)),q.setVec(d,n);else for(e=0;e<r;e++){g.getVec(e,w);a.getVec(e,n);var k=M.y2lat(d.get(e,1));k=Math.cos(k);f===h.VectorType.TANGENT!==(b===p.TO_PCPF)&&(k=1/k);G(b,f,w,l,c);b===p.TO_PCPF?(c[0]*=k,c[1]*=k,c[2]*=k,c[3]*=k,c[4]*=k,c[5]*=k):(c[0]*=k,c[3]*=k,c[6]*=k,c[1]*=k,c[4]*=k,c[7]*=k);y.transformMat3(n,n,c);y.normalize(n,
n);q.setVec(e,n)}return q}}h.VectorType=void 0;(function(b){b[b.NORMAL=0]="NORMAL";b[b.TANGENT=1]="TANGENT"})(h.VectorType||(h.VectorType={}));var p;(function(b){b[b.TO_PCPF=0]="TO_PCPF";b[b.FROM_PCPF=1]="FROM_PCPF"})(p||={});const w=D.create(),n=D.create(),t=J.create(),c=H.create();h.loadProjectErrorMessage="Projection may be possible after calling projection.load().";h.logProjectionError=function(b,a,f,d){b.error(`Failed to project from (wkid:${a.wkid}) to (wkid:${f.wkid}).${d?" ":""}${d}`)};h.projectFromPCPF=
function(b,a,f,d){return E.projectBuffer(b,a,0,f,d,0)?f:null};h.projectNormalFromPCPF=function(b,a,f,d,e,g){return v(p.FROM_PCPF,m.BufferViewVec3f.fromTypedArray(b),h.VectorType.NORMAL,m.BufferViewVec3f64.fromTypedArray(a),f,m.BufferViewVec3f64.fromTypedArray(d),e,m.BufferViewVec3f.fromTypedArray(g))?g:null};h.projectNormalToPCPF=function(b,a,f,d,e,g){return v(p.TO_PCPF,m.BufferViewVec3f.fromTypedArray(b),h.VectorType.NORMAL,m.BufferViewVec3f64.fromTypedArray(a),f,m.BufferViewVec3f64.fromTypedArray(d),
e,m.BufferViewVec3f.fromTypedArray(g))?g:null};h.projectTangentFromPCPF=function(b,a,f,d,e,g){if(!v(p.FROM_PCPF,m.BufferViewVec3f.fromTypedArray(b,16),h.VectorType.TANGENT,m.BufferViewVec3f64.fromTypedArray(a),f,m.BufferViewVec3f64.fromTypedArray(d),e,m.BufferViewVec3f.fromTypedArray(g,16)))return null;for(a=3;a<b.length;a+=4)g[a]=b[a];return g};h.projectTangentToPCPF=function(b,a,f,d,e,g){if(!v(p.TO_PCPF,m.BufferViewVec3f.fromTypedArray(b,4*Float32Array.BYTES_PER_ELEMENT),h.VectorType.TANGENT,m.BufferViewVec3f64.fromTypedArray(a),
f,m.BufferViewVec3f64.fromTypedArray(d),e,m.BufferViewVec3f.fromTypedArray(g,4*Float32Array.BYTES_PER_ELEMENT)))return null;for(a=3;a<b.length;a+=4)g[a]=b[a];return g};h.projectToPCPF=function(b,a,f,d){return E.projectBuffer(b,a,0,f,d,0)?f:null};h.transformNormal=function(b,a,f){u.normalFromMat4(c,f);A.transformMat3(a,b,c);x.hasScaling(c)&&A.normalize(a,a);return a};h.transformTangent=function(b,a,f){u.fromMat4(c,f);N.transformMat3(a,b,c);x.hasScaling(c)&&A.normalize(a,a,4);return a};h.transformVectorENUPlateCarree=
function(b,a,f,d){const e=a===h.VectorType.NORMAL;return F(b,a,f,(g,l)=>{g=Math.cos(x.deg2rad(g));l[0]=e?g:1/g;l[1]=1},d)};h.transformVectorWMPlateCarree=function(b,a,f,d){const e=a===h.VectorType.NORMAL;return F(b,a,f,(g,l)=>{g=Math.cosh(-g/L.earth.radius);l[0]=1;l[1]=e?g:1/g},d)};Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})});