// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.31/esri/copyright.txt for details.
//>>built
define(["exports","../../../chunks/SimpleGeometryCursor","../../../chunks/Geometry","../../../chunks/QuadraticBezier","../../../chunks/Transformation2D"],function(h,k,g,d,n){function l(a){a&&a.checkProgress()}class p{getOperatorType(){return 10012}accelerateGeometry(a,b,c){return!1}canAccelerateGeometry(a){return!1}supportsCurves(){return!0}executeMany(a,b,c,e){return new q(a,b,c,e)}}class q extends k.OverlayGeometryCursor{constructor(a,b,c,e){super();this.m_curveStitcher=this.m_topoGraph=this.m_shape=
null;this.m_stitchMaxDeviation=0;this.m_chainStack=[];this.m_chainsLists=this.m_bitsetToChains=null;this.m_geometryIndex=this.m_index=this.m_visitedChainsIndex=-1;this.m_progressCounter=0;this.m_currentIds=[];this.m_currentEdgeIds=[];a||g.throwInvalidArgumentException("");this.m_progressTracker=e;this.m_options=0!==c?c:3;(0>=this.m_options||63<this.m_options)&&g.throwInvalidArgumentException("options");this.m_inputGeometryCursor=a;this.m_sr=b}tock(){return!0}getRank(){return 1}next(){if(-1===this.m_index){this.m_shape=
new d.EditShape;var a=new d.Envelope2D;a.setEmpty();this.m_geometryIndex=this.m_shape.createGeometryUserIndex();for(var b=this.m_inputGeometryCursor.next();null!==b;b=this.m_inputGeometryCursor.next()){g.throwIfMesh(b);var c=this.m_shape.addGeometry(b);b.getGeometryType()!==g.GeometryType.enumPolygon&&g.throwInvalidArgumentException("Polygon Overlay only supports Polygons");this.m_shape.setGeometryUserIndex(c,this.m_geometryIndex,this.m_inputGeometryCursor.getGeometryID());var e=this.m_inputGeometryCursor.getRank();
e>d.defaultRank&&this.m_shape.assignRankToGeometryVertices(c,e);c=new d.Envelope2D;b.queryLooseEnvelope(c);a.mergeEnvelope2D(c);l(this.m_progressTracker)}this.m_inputGeometryCursor=null;b=d.calculateToleranceFromGeometryForOp(this.m_sr,a,!0);c=d.calculateToleranceFromGeometryForOp(this.m_sr,a,!1);a.inflate(10*b.total());this.m_shape.forceSetEnvelope2D(a);e=this.m_stitchMaxDeviation=0;this.m_shape.hasCurves()&&(this.m_curveStitcher=new d.CurveStitcher,a=d.densificationDeviationFromTolerance(b.total(),
a),this.m_stitchMaxDeviation=d.stitchingDensificationDeviationFromTolerance(b.total()),e=d.extraToleranceForCrackingAndClustering(a,this.m_stitchMaxDeviation),d.buildSegmentParentage(this.m_shape,a,b.total(),12E3,this.m_curveStitcher,null,this.m_progressTracker));if(d.needsCrackingAndClustering(this.m_shape,c,this.m_progressTracker))for(d.execute(this.m_shape,b.add(e),this.m_progressTracker,!0,!1),a=this.m_shape.getFirstGeometry();a!==d.nullHandle;a=this.m_shape.getNextGeometry(a))this.m_shape.getGeometryType(a)===
g.GeometryType.enumPolygon&&d.execute$1(this.m_shape,a,-1,!1,d.nullHandle,this.m_progressTracker);this.m_topoGraph=new d.TopoGraph;this.m_topoGraph.buildGeometryParentageSets();this.m_topoGraph.setEditShape(this.m_shape,this.m_progressTracker);a=this.m_topoGraph.getFirstChain();for(a=this.m_topoGraph.getChainFirstIsland(a);a!==d.nullHandle;a=this.m_topoGraph.getChainNextInParent(a))for(b=this.m_topoGraph.getChainFirstIsland(a);b!==d.nullHandle;b=this.m_topoGraph.getChainNextInParent(b))this.m_chainStack.push(b);
if(this.m_options&16)for(this.m_visitedChainsIndex=this.m_topoGraph.createUserIndexForChains(),this.m_bitsetToChains=new Map,this.m_chainsLists=new d.IndexMultiList,a=[],b=this.m_topoGraph.getFirstChain(),a.push(b);0<a.length;)for(b=a.at(-1),a.pop(),b=this.m_topoGraph.getChainFirstIsland(b);b!==d.nullHandle;b=this.m_topoGraph.getChainNextInParent(b))for(c=this.m_topoGraph.getChainFirstIsland(b);c!==d.nullHandle;c=this.m_topoGraph.getChainNextInParent(c)){e=this.m_topoGraph.getChainBitSet(c);if(null!==
e&&!e.isZero()){let f;this.m_bitsetToChains.has(e)?f=this.m_bitsetToChains.get(e):(f=this.m_chainsLists.createList(),this.m_bitsetToChains.set(e,f));this.m_chainsLists.addElement(f,c)}a.push(c)}}return this.makeNextGeometry()}getGeometryID(){return this.m_index}getGeometryIDs(){return this.m_currentIds.slice()}getBoundaryIDs(){return this.m_currentEdgeIds.slice()}buildIdsFromBitset(a,b){if(a&&(a=this.m_topoGraph.getGeometriesFromBits(a),0<a.length)){for(let c=0,e=a.length;c<e;c++)b.push(this.m_shape.getGeometryUserIndex(a[c],
this.m_geometryIndex));n.numericSort(b)}}makeGeometryFromChainSinglePart(a){this.m_index++;const b=new d.EditShape;null!==this.m_curveStitcher&&b.setCurveStitcherPointer(this.m_curveStitcher);a=this.m_topoGraph.extractPolygonFromChainAndIslands(b,d.nullHandle,a,d.nullHandle);null!==this.m_curveStitcher&&this.m_curveStitcher.stitchCurves(b,a,this.m_stitchMaxDeviation,!1);return b.getGeometry(a)}makeGeometryFromChainMultiPart(a,b){this.m_index++;a=new d.EditShape;null!==this.m_curveStitcher&&a.setCurveStitcherPointer(this.m_curveStitcher);
var c=this.m_bitsetToChains.has(b);g.geometryReleaseAssert(c);c=this.m_bitsetToChains.get(b);b=d.nullHandle;for(c=this.m_chainsLists.getFirst(c);c!==d.IndexMultiList.st_nullNode();c=this.m_chainsLists.getNext(c)){const e=this.m_chainsLists.getElement(c);b=this.m_topoGraph.extractPolygonFromChainAndIslands(a,b,e,d.nullHandle);this.m_topoGraph.setChainUserIndex(e,this.m_visitedChainsIndex,1)}null!==this.m_curveStitcher&&this.m_curveStitcher.stitchCurves(a,b,this.m_stitchMaxDeviation,!1);return a.getGeometry(b)}makeNextGeometry(){for(l(this.m_progressTracker);0<
this.m_chainStack.length;){this.m_currentIds.length=0;this.m_currentEdgeIds.length=0;var a=this.m_chainStack.at(-1);this.m_chainStack.pop();var b=this.m_topoGraph.getChainArea(a);if(0!==b)if(0>b)for(a=this.m_topoGraph.getChainFirstIsland(a);a!==d.nullHandle;a=this.m_topoGraph.getChainNextInParent(a))0<this.m_topoGraph.getChainArea(a)&&this.m_chainStack.push(a);else{for(b=this.m_topoGraph.getChainFirstIsland(a);b!==d.nullHandle;b=this.m_topoGraph.getChainNextInParent(b))0>this.m_topoGraph.getChainArea(b)&&
this.m_chainStack.push(b);if(-1===this.m_visitedChainsIndex||1!==this.m_topoGraph.getChainUserIndex(a,this.m_visitedChainsIndex)){b=e=>{e=e.getUnorderedBitIterator();let f=0;for(;e.next()!==d.UnorderedBitIterator.npos()&&!(f++,1<f););return f};var c=b(this.m_topoGraph.getChainBitSet(a));if(0<c){if(1===c&&this.m_options&2||1<c&&this.m_options&1)return b=this.m_topoGraph.getChainBitSet(a),this.buildIdsFromBitset(b,this.m_currentIds),0===(this.m_options&16)?this.makeGeometryFromChainSinglePart(a):this.makeGeometryFromChainMultiPart(a,
b)}else{if(12===(this.m_options&12))return this.m_options&32&&(b=this.m_topoGraph.getChainBoundaryBitSet(a),this.buildIdsFromBitset(b,this.m_currentEdgeIds)),this.makeGeometryFromChainSinglePart(a);if(this.m_options&4){if(c=this.m_topoGraph.getChainBoundaryBitSet(a),1<b(c))return this.m_options&32&&this.buildIdsFromBitset(c,this.m_currentEdgeIds),this.makeGeometryFromChainSinglePart(a)}else if(this.m_options&8&&(c=this.m_topoGraph.getChainBoundaryBitSet(a),1===b(c)))return this.m_options&32&&this.buildIdsFromBitset(c,
this.m_currentEdgeIds),this.makeGeometryFromChainSinglePart(a)}}}}return null}}const m=new p;h.executeMany=function(a,b,c){a=m.executeMany(new k.SimpleGeometryCursor(a),b,c,null);return Array.from(a)};h.supportsCurves=function(){return m.supportsCurves()};Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})});