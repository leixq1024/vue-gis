// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.31/esri/copyright.txt for details.
//>>built
define(["exports","../../../chunks/SimpleGeometryCursor","../../../chunks/QuadraticBezier","../../../chunks/Geometry","../../../chunks/Transformation2D"],function(w,y,u,r,m){class t{static construct(a,b,d){const c=new t;c.x=a.x;c.y=a.y;c.m_next=-1;c.m_prev=-1;c.z=b;c.m=d;c.type=0;return c}clone(){const a=new t;a.x=this.x;a.y=this.y;a.m_next=this.m_next;a.m_prev=this.m_prev;a.z=this.z;a.m=this.m;a.type=this.type;return a}asPoint2D(){return new m.Point2D(this.x,this.y)}}class n{constructor(a){this.m_tolerance=
this.m_distance=-1;this.m_miterLimit=10;this.m_progressCounter=this.m_joins=0;this.m_bUseM=this.m_bUseZ=!1;this.m_srcPts=[];this.m_srcPtCount=0;this.m_offsetPts=[];this.m_a2=this.m_a1=this.m_offsetPtCount=0;this.m_progressTracker=a}constructOffset(){var a=this.m_inputGeometry.getGeometryType();if(a===r.GeometryType.enumLine)return this.offsetLine();if(a===r.GeometryType.enumEnvelope)return this.offsetEnvelope();if(r.isSegment(a))return a=new u.Polyline,a.addSegment(this.m_inputGeometry,!0),this.m_inputGeometry=
a,this.constructOffset();if(a===r.GeometryType.enumPolyline)return a=new u.Polyline,this.offsetMultiPath(a),a;if(a===r.GeometryType.enumPolygon)return a=new u.Polygon,this.offsetMultiPath(a),a;r.throwNotImplementedException("")}offsetLine(){var a=this.m_inputGeometry;const b=a.getStartXY(),d=a.getEndXY(),c=new m.Point2D;c.setSub(d,b);c.normalize();c.leftPerpendicularThis();c.scale(this.m_distance);b.addThis(c);d.addThis(c);a=a.clone();a.setStartXY(b);a.setEndXY(d);return a}offsetEnvelope(){var a=
this.m_inputGeometry;if(0<this.m_distance&&2!==this.m_joins){const b=new u.Polygon;b.addEnvelope(a,!1);this.m_inputGeometry=b;return this.constructOffset()}a=a.clone();a.inflateCoords(this.m_distance,this.m_distance);return a}progress(){}static buildPoint(a,b,d,c){c.x=a.x+b*Math.cos(d);c.y=a.y+b*Math.sin(d);c.type=a.type;c.z=a.z;c.m=a.m;c.m_next=-1;c.m_prev=-1}addPoint(a){this.m_offsetPts.push(a.clone());this.m_offsetPtCount++}addPointEx(a,b){if(0===this.m_offsetPtCount)this.addPoint(a);else{var d=
this.m_srcPtCount,c=this.m_srcPts[0===b?d-1:b-1],f=this.m_srcPts[b],e=n.dotSign(c,f,this.m_offsetPts[this.m_offsetPtCount-1],a);0<e?this.addPoint(a):0>e&&(0<n.dotSign(c,f,f,this.m_offsetPts[this.m_offsetPtCount-1])?(f=new t,d=this.m_srcPts[0===b?d-2:1===b?d-1:b-2],n.buildPoint(c,this.m_distance,Math.atan2(c.y-d.y,c.x-d.x)-m.geometryHalfPi,f),this.m_offsetPts[this.m_offsetPtCount-1]=f,1===this.m_joins||2===this.m_joins?(f.x=.5*(f.x+c.x),f.y=.5*(f.y+c.y),this.addPoint(f),n.buildPoint(c,this.m_distance,
this.m_a1+m.geometryHalfPi,f),d=f.clone(),d.x=.5*(d.x+c.x),d.y=.5*(d.y+c.y),d.type|=256,this.addPoint(d)):(n.buildPoint(c,this.m_distance,this.m_a1+m.geometryHalfPi,f),f.type|=256),this.addPoint(f),this.addPointEx(a,b)):(a=new t,n.buildPoint(f,this.m_distance,this.m_a1+m.geometryHalfPi,a),this.addPoint(a),1===this.m_joins||2===this.m_joins?(a.x=.5*(a.x+f.x),a.y=.5*(a.y+f.y),this.addPoint(a),n.buildPoint(f,this.m_distance,this.m_a2-m.geometryHalfPi,a),b=a.clone(),b.x=.5*(b.x+f.x),b.y=.5*(b.y+f.y),
b.type|=256,this.addPoint(b)):(n.buildPoint(f,this.m_distance,this.m_a2-m.geometryHalfPi,a),a.type|=256),this.addPoint(a)))}}buildOffset(){const a=new t,b=this.m_srcPtCount;this.m_offsetPtCount=0;const d=.5*this.m_tolerance;let c=0,f=0;for(let q=0;q<b;q++){var e=this.m_srcPts[q],h=0===q?this.m_srcPts[b-1]:this.m_srcPts[q-1],g=q===b-1?this.m_srcPts[0]:this.m_srcPts[q+1],p=0,k=void 0,l=void 0;l=g.x-e.x;p=g.y-e.y;k=Math.atan2(h.y-e.y,h.x-e.x);l=Math.atan2(p,l);this.m_a1=k;this.m_a2=l;0===q&&(c=k,f=l);
p=m.Point2D.orientationRobust(e.asPoint2D(),h.asPoint2D(),g.asPoint2D());var v=l;l<k&&(l+=m.geometry2Pi);if(0<p*this.m_distance)1===this.m_joins||2===this.m_joins?(n.buildPoint(e,this.m_distance,k+m.geometryHalfPi,a),this.addPoint(a),a.x=e.x+.001*(a.x-e.x),a.y=e.y+.001*(a.y-e.y),this.addPoint(a),n.buildPoint(e,this.m_distance,l-m.geometryHalfPi,a),k=a.clone(),k.x=e.x+.001*(k.x-e.x),k.y=e.y+.001*(k.y-e.y),k.type|=256,this.addPoint(k),this.addPoint(a)):(g=.5*(l-k),n.buildPoint(e,0===g?this.m_distance:
this.m_distance/Math.abs(Math.sin(g)),.5*(k+l),a),this.addPointEx(a,q));else if(e.type&512){p=1-d/Math.abs(this.m_distance);h=1;g=0>this.m_distance?-Math.PI:Math.PI;-1<p&&1>p&&(h=2*Math.acos(p),.017453292519943295>h&&(h=.017453292519943295),h=Math.trunc(Math.PI/h+1.5),1<h&&(g/=h));1>=h&&(h=2,g/=2);k+=m.geometryHalfPi;n.buildPoint(e,this.m_distance,k,a);0===q&&(a.type|=1024);this.addPointEx(a,q);p=this.m_distance/Math.cos(g/2);k+=g/2;n.buildPoint(e,p,k,a);a.type|=1024;for(this.addPoint(a);0<--h;)k+=
g,n.buildPoint(e,p,k,a),a.type|=1024,this.addPoint(a);n.buildPoint(e,this.m_distance,l-m.geometryHalfPi,a);a.type|=1024;this.addPoint(a)}else if(1===this.m_joins)n.buildPoint(e,this.m_distance,k+m.geometryHalfPi,a),this.addPointEx(a,q),n.buildPoint(e,this.m_distance,l-m.geometryHalfPi,a),this.addPoint(a);else if(0===this.m_joins)for(h=1-d/Math.abs(this.m_distance),g=1,l=l-m.geometryHalfPi-(k+m.geometryHalfPi),-1<h&&1>h&&(g=2*Math.acos(h),.017453292519943295>g&&(g=.017453292519943295),g=Math.trunc(Math.abs(l)/
g+1.5),1<g&&(l/=g)),h=this.m_distance/Math.cos(.5*l),k=k+m.geometryHalfPi+.5*l,n.buildPoint(e,h,k,a),this.addPointEx(a,q);0<--g;)k+=l,n.buildPoint(e,h,k,a),this.addPoint(a);else 2===this.m_joins?(p=h.x-e.x,h=h.y-e.y,v=g.x-e.x,g=g.y-e.y,g=(p*v+h*g)/Math.sqrt(p*p+h*h)/Math.sqrt(v*v+g*g),.99999999<g?(n.buildPoint(e,1.4142135623730951*this.m_distance,l-.25*Math.PI,a),this.addPointEx(a,q),n.buildPoint(e,1.4142135623730951*this.m_distance,l+.25*Math.PI,a),this.addPoint(a)):(g=Math.abs(this.m_distance/Math.sin(.5*
Math.acos(g))),h=Math.abs(this.m_miterLimit*this.m_distance),g>h?(n.buildPoint(e,this.m_distance/Math.abs(Math.sin(.5*(l-k))),.5*(k+l),a),k=m.Point2D.construct(a.x,a.y),l=m.Point2D.construct(e.x,e.y),e=new m.Point2D,e.setSub(k,l),k=new m.Point2D,k.scaleAddOther(h/e.length(),e,l),l=(g-h)*Math.abs(this.m_distance)/Math.sqrt(g*g-this.m_distance*this.m_distance),0<this.m_distance?e.leftPerpendicularThis():e.rightPerpendicularThis(),e.scale(l/e.length()),l=new m.Point2D,l.setAdd(k,e),g=new m.Point2D,g.setSub(k,
e),a.x=l.x,a.y=l.y,this.addPointEx(a,q),a.x=g.x,a.y=g.y,this.addPoint(a)):(n.buildPoint(e,this.m_distance/Math.abs(Math.sin(.5*(l-k))),.5*(k+l),a),this.addPointEx(a,q)))):(l=v,0<this.m_distance?(l>k&&(l-=m.geometry2Pi),g=k-l<m.geometryHalfPi):(l<k&&(l+=m.geometry2Pi),g=l-k<m.geometryHalfPi),g?(g=1.4142135623730951*this.m_distance,k=0>g?k+.25*Math.PI:k+.75*Math.PI,n.buildPoint(e,g,k,a),this.addPointEx(a,q),k=0>g?l-.25*Math.PI:l-.75*Math.PI,n.buildPoint(e,g,k,a),this.addPoint(a)):(g=this.m_distance/
Math.abs(Math.sin(.5*(l-k))),l<k&&(l+=m.geometry2Pi),n.buildPoint(e,g,(k+l)/2,a),this.addPointEx(a,q)))}this.m_a1=c;this.m_a2=f;this.addPointEx(this.m_offsetPts[0],0);this.m_offsetPts[0]=this.m_offsetPts[this.m_offsetPtCount-1].clone();return this.removeBadSegsFast()}removeBadSegsFast(){let a=!1;for(var b=0;b<this.m_offsetPtCount;b++){var d=this.m_offsetPts[b];d.m_next=b+1;d.m_prev=b-1}this.m_offsetPts[0].m_prev=this.m_offsetPtCount-2;b=this.m_offsetPts[this.m_offsetPtCount-2].m_next=0;for(d=0;d<
this.m_offsetPtCount;d++)if(this.m_offsetPts[b].type&256){const c=this.deleteClosedSeg(b);if(-1!==c)b=c;else{a=!0;break}}else b=this.m_offsetPts[b].m_next;if(a)return!1;this.compressOffsetArray(b);return!0}deleteClosedSeg(a){const b=this.m_offsetPtCount-1;let d=a,c,f;for(let e=1;e<=b-2;e++){c=d=this.m_offsetPts[d].m_next;f=a;for(let h=1;h<=e;h++){f=this.m_offsetPts[f].m_prev;if(0===(this.m_offsetPts[f].type&256)&&0===(this.m_offsetPts[c].type&256)){const g=this.handleClosedIntersection(f,c);if(-1!==
g)return g}c=this.m_offsetPts[c].m_prev}}return-1}handleClosedIntersection(a,b){var d=this.m_offsetPts[this.m_offsetPts[a].m_prev];const c=this.m_offsetPts[a];var f=this.m_offsetPts[this.m_offsetPts[b].m_prev],e=this.m_offsetPts[b];if(!this.sectGraphicRect(d,c,f,e))return-1;const h={pt:new t,bAtExistingPt:!1};if(0>((c.x-d.x)*(e.y-f.y)-(c.y-d.y)*(e.x-f.x))*this.m_distance&&this.findIntersection(d,c,f,e,h)&&!h.bAtExistingPt){var g=Math.sqrt((c.x-d.x)*(c.x-d.x)+(c.y-d.y)*(c.y-d.y)),p=(c.x-d.x)/g;g=(c.y-
d.y)/g;d=Math.sqrt((e.x-f.x)*(e.x-f.x)+(e.y-f.y)*(e.y-f.y));const k=(e.x-f.x)/d,l=(e.y-f.y)/d;e=!1;d=h.pt.clone();d.x+=1E-8*(p+k);d.y+=1E-8*(g+l);p=h.pt;for(g=this.m_offsetPts[a].m_prev;;){p.y>d.y!==f.y>d.y&&d.x<(f.x-p.x)*(d.y-p.y)/(f.y-p.y)+p.x&&(e=!e);f=p;g=this.m_offsetPts[g].m_next;if(g===b)break;p=this.m_offsetPts[g]}if(e)return-1;f=this.m_offsetPts[a].m_prev;h.pt.type=c.type;h.pt.m_next=b;h.pt.m_prev=f;this.m_offsetPts[a]=h.pt;this.m_offsetPts[b].m_prev=a;return b}return-1}sectGraphicRect(a,
b,d,c){return Math.max(a.x,b.x)>=Math.min(d.x,c.x)&&Math.max(d.x,c.x)>=Math.min(a.x,b.x)&&Math.max(a.y,b.y)>=Math.min(d.y,c.y)&&Math.max(d.y,c.y)>=Math.min(a.y,b.y)}findIntersection(a,b,d,c,f){f.bAtExistingPt=!1;let e,h;var g=(b.y-a.y)*(c.x-d.x)-(b.x-a.x)*(c.y-d.y);e=(d.y-a.y)*(b.x-a.x)-(d.x-a.x)*(b.y-a.y);g=0===g?2:e/g;return 0<=g&&1>=g&&(h=g,g=(c.y-d.y)*(b.x-a.x)-(c.x-d.x)*(b.y-a.y),e=(a.y-d.y)*(c.x-d.x)-(a.x-d.x)*(c.y-d.y),g=0===g?2:e/g,0<=g&&1>=g)?(f.pt.x=a.x+g*(b.x-a.x),f.pt.y=a.y+g*(b.y-a.y),
this.m_bUseZ&&(f.pt.z=d.z+h*(c.z-d.z)),this.m_bUseM&&(f.pt.m=d.m+h*(c.m-d.m)),0!==h&&1!==h||0!==g&&1!==g||(f.bAtExistingPt=!0),(0===h||1===h)&&0<g&&1>g||(0===g||1===g)&&0<h&&1>h?!1:!0):!1}compressOffsetArray(a){for(;this.m_offsetPts[a].m_prev<a;)a=this.m_offsetPts[a].m_prev;let b=0;var d=a;do d=this.m_offsetPts[d].clone(),this.m_offsetPts[b]=d,d=d.m_next,b++;while(d!==a);this.m_offsetPts[b]=this.m_offsetPts[0].clone();this.m_offsetPtCount=b+1}addPart(a,b){if(!(2>b))for(let d=0;d<b;d++){const c=this.m_offsetPts[a+
d];d?this.m_bUseZ?this.m_resultPath.lineTo3DCoords(c.x,c.y,c.z):this.m_resultPath.lineToCoords(c.x,c.y):this.m_bUseZ?this.m_resultPath.startPath3DCoords(c.x,c.y,c.z):this.m_resultPath.startPathCoords(c.x,c.y);if(this.m_bUseM){const f=this.m_resultPath.getPointCount()-1;this.m_resultPath.setAttribute(2,f,0,c.m)}}}offsetMultiPath(a){const b=u.densify$1(this.m_inputGeometry,0,this.m_tolerance,0,this.m_progressTracker,12E3),d=b.querySegmentIterator();d.resetToFirstPath();let c=-1;for(;d.nextPath();)c++,
this.offsetPath(b,c,a)}offsetPath(a,b,d){var c=a.getPathStart(b),f=a.getPathEnd(b);this.m_resultPath=d;if(a.isClosedPath(b)){for(b=a.getXY(c);f>c&&a.getXY(f-1).equals(b);)f--;if(2<=f-c){this.m_srcPtCount=f-c;this.m_srcPts.length=this.m_srcPtCount;for(b=c;b<f;b++)this.progress(),this.m_srcPts[b-c]=t.construct(a.getXY(b),this.m_bUseZ?a.getAttributeAsDbl(1,b,0):0,this.m_bUseM?a.getAttributeAsDbl(2,b,0):0);this.buildOffset()&&this.addPart(0,this.m_offsetPtCount-1)}}else{for(b=a.getXY(c);c<f-1&&a.getXY(c+
1).equals(b);)c++;for(d=a.getXY(f-1);c<f-1&&a.getXY(f-2).equals(d);)f--;if(2<=f-c){this.m_srcPtCount=2*(f-c)-2;this.m_srcPts.length=this.m_srcPtCount;b=t.construct(b,this.m_bUseZ?a.getAttributeAsDbl(1,c,0):0,this.m_bUseM?a.getAttributeAsDbl(2,c,0):0);b.type|=1536;this.m_srcPts[0]=b;d=1;let e=this.m_srcPtCount-1;for(c+=1;c<f-1;c++,d++,e--)this.progress(),b=t.construct(a.getXY(c),this.m_bUseZ?a.getAttributeAsDbl(1,c,0):0,this.m_bUseM?a.getAttributeAsDbl(2,c,0):0),this.m_srcPts[d]=b.clone(),b.type|=
1024,this.m_srcPts[e]=b.clone();b=t.construct(a.getXY(f-1),this.m_bUseZ?a.getAttributeAsDbl(1,f-1,0):0,this.m_bUseM?a.getAttributeAsDbl(2,f-1,0):0);b.type|=512;this.m_srcPts[d]=b.clone();if(this.buildOffset())if(2<=this.m_offsetPts.length){b=a=-1;(b=0!==(this.m_offsetPts[this.m_offsetPtCount-1].type&1024))||(a=0);for(f=1;f<this.m_offsetPtCount;f++)this.progress(),c=0!==(this.m_offsetPts[f].type&1024),c?b||(b=f-1,1<b-a+1&&this.addPart(a,b-a+1)):b&&(a=f-1),b=c;b||(b=this.m_offsetPtCount-1,1<b-a+1&&
this.addPart(a,b-a+1))}else a=this.m_offsetPtCount-1,1<=a-0&&this.addPart(0,a-0+1)}}this.m_srcPtCount=this.m_srcPts.length=0;this.m_offsetPtCount=this.m_offsetPts.length=0}static dotSign(a,b,d,c){a=m.compensatedDot(b.x-a.x,b.y-a.y,c.x-d.x,c.y-d.y);return m.sign(a)}}class A{getOperatorType(){return 10108}accelerateGeometry(a,b,d){return!1}canAccelerateGeometry(a){return!1}supportsCurves(){return!0}executeMany(a,b,d,c,f,e,h){return new z(a,b,d,c,f,e,h)}execute(a,b,d,c,f,e,h){return(new z(null,b,d,c,
f,e,h)).offset(a)}}class z extends y.GeometryCursor{constructor(a,b,d,c,f,e,h){super();this.m_progressTracker=h;this.m_index=-1;this.m_inputGeoms=a;this.m_spatialReference=b;this.m_distance=d;this.m_joins=c;this.m_miterLimit=f;this.m_flattenError=e}tock(){return!0}getRank(){return 1}next(){if(!this.m_inputGeoms)return null;let a;for(;a=this.m_inputGeoms.next();)return this.m_index=this.m_inputGeoms.getGeometryID(),this.offset(a);return null}getGeometryID(){return this.m_index}offset(a){r.throwIfMesh(a);
let b;b=0>=this.m_flattenError?u.calculateToleranceFromGeometryForOpFromGeom(this.m_spatialReference,a,!0).total():this.m_flattenError;var d=this.m_distance,c=this.m_joins,f=this.m_miterLimit,e=this.m_progressTracker;null===a&&r.throwInvalidArgumentException("");1>a.getDimension()&&r.throwInvalidArgumentException("");0<b||r.throwInvalidArgumentException("");r.throwIfMesh(a);0===d||a.isEmpty()||(e=new n(e),e.m_bUseZ=a.hasAttribute(1),e.m_bUseM=a.hasAttribute(2),e.m_inputGeometry=a,e.m_distance=d,e.m_tolerance=
b,e.m_joins=c,e.m_miterLimit=f,e.m_progressCounter=0,a=e.constructOffset());return a}}const x=new A;w.execute=function(a,b,d,c,f,e){return x.execute(a,b,d,c,f,e,null)};w.executeMany=function(a,b,d,c,f,e){a=x.executeMany(new y.SimpleGeometryCursor(a),b,d,c,f,e,null);return Array.from(a)};w.supportsCurves=function(){return x.supportsCurves()};Object.defineProperty(w,Symbol.toStringTag,{value:"Module"})});