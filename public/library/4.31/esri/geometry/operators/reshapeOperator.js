// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.31/esri/copyright.txt for details.
//>>built
define(["exports","../../chunks/Geometry","../../chunks/QuadraticBezier","./support/converterAPI"],function(v,p,h,t){function D(c,b,e,a){1<b.getPathCount()&&p.throwNotImplementedException("");if(c.isEmpty()||b.isEmpty())return null;p.throwIfCurves(c);p.throwIfCurves(b);var d=null;d=new h.Envelope2D;c.queryEnvelope(d);var f=new h.Envelope2D;b.queryEnvelope(f);var g=new h.Envelope2D;g.setCoords({env2D:d});g.mergeEnvelope2D(f);d=h.calculateToleranceFromGeometryForOp(e,g,!1).total();a=new E(a);if(f=a.setIndicesAndScalars(c,
b,d)){b=a.getTrimmedPolyline(c,b);if(b.isEmpty())return null;d=a.getReshapedMultiPath(c,b,e)}else{if(Number.isNaN(a.m_scalarB0)||c.getGeometryType()===p.GeometryType.enumPolyline)return null;g=new h.Polyline;g.add(b,!0);a.clearIndicesAndScalars();f=a.setIndicesAndScalars(c,g,d);if(!f)return null;b=a.getTrimmedPolyline(c,g);if(b.isEmpty())return null;d=a.getReshapedMultiPath(c,b,e)}return d}class E{constructor(c){this.m_progressTracker=c;this.clearIndicesAndScalars()}setIndicesAndScalars(c,b,e){var a=
new h.Envelope2D,d=new h.Envelope2D;c.queryEnvelope(a);c.queryEnvelope(d);a.inflateCoords(e,e);if(!a.intersect(d))return!1;a=c.getImpl().querySegmentIterator();b=b.getImpl().querySegmentIterator();d=[0,0];const f=[0,0];let g=-1,k=-1;var l=-1;let u=-1;var r=-1;let x=-1;var n=Number.NaN;let y=Number.NaN;var m=Number.NaN;let q=Number.NaN;for(b.nextPath();b.hasNextSegment();){const z=b.nextSegment(),w=new h.Envelope2D;z.queryEnvelope(w);w.inflateCoords(e,e);for(a.resetToFirstPath();a.nextPath();){for(;a.hasNextSegment();){const A=
a.nextSegment(),B=new h.Envelope2D;A.queryEnvelope(B);if(w.isIntersecting(B)&&0!==z.intersect(A,null,f,d,e)&&(Number.isNaN(m)||f[0]<m)&&(g=a.getPathIndex(),l=a.getStartPointIndex(),r=b.getStartPointIndex(),n=d[0],m=f[0],0===m))break}if(0===m)break}if(!Number.isNaN(m)&&1!==m)break}if(Number.isNaN(m))return!1;this.m_pathA0=g;this.m_vertexA0=l;this.m_vertexB0=r;this.m_scalarA0=n;this.m_scalarB0=m;c=c.getGeometryType();for(b.resetToLastSegment();b.hasPreviousSegment();){l=b.previousSegment();r=new h.Envelope2D;
l.queryEnvelope(r);r.inflateCoords(e,e);for(c===p.GeometryType.enumPolygon?a.resetToPath(g):a.resetToFirstPath();a.nextPath();){for(;a.hasNextSegment()&&(n=a.nextSegment(),m=new h.Envelope2D,n.queryEnvelope(m),!r.isIntersecting(m)||(n=l.intersect(n,null,f,d,e),0===n||!(Number.isNaN(q)||f[n-1]>q)||b.getStartPointIndex()===this.m_vertexB0&&f[n-1]===this.m_scalarB0||(k=a.getPathIndex(),u=a.getStartPointIndex(),x=b.getStartPointIndex(),y=d[n-1],q=f[n-1],1!==q))););if(1===q)break;if(c===p.GeometryType.enumPolygon)break}if(!Number.isNaN(q))break}if(Number.isNaN(q))return!1;
this.m_pathA1=k;this.m_vertexA1=u;this.m_vertexB1=x;this.m_scalarA1=y;this.m_scalarB1=q;return!0}getTrimmedPolyline(c,b){var e=new h.SegmentBuffer;const a=b.createInstance();var d=!0;b=b.getImpl().querySegmentIterator();b.resetToVertex(this.m_vertexB0,0);if(this.m_vertexB0>this.m_vertexB1)return a;if(this.m_vertexB0===this.m_vertexB1)b.nextSegment().queryCut(this.m_scalarB0,this.m_scalarB1,e,!1),a.addSegment(e.get(),!0);else for(;;){const f=b.nextSegment(),g=b.getStartPointIndex();if(g===this.m_vertexB0)1!==
this.m_scalarB0&&(f.queryCut(this.m_scalarB0,1,e,!1),a.addSegment(e.get(),d),d=!1);else if(g===this.m_vertexB1){0!==this.m_scalarB1&&(f.queryCut(0,this.m_scalarB1,e),a.addSegment(e.get(),d),d=!1);break}else a.addSegment(f,d)}if(a.isEmpty())return a;1<c.getDescription().getAttributeCount()&&(c=c.getImpl().querySegmentIterator(),e=new h.Point,d=a.getPointCount(),c.resetToVertex(this.m_vertexA0,this.m_pathA0),c.nextSegment().queryCoord(this.m_scalarA0,e),a.setPointByVal(0,e),c.resetToVertex(this.m_vertexA1,
this.m_pathA1),c.nextSegment().queryCoord(this.m_scalarA1,e),a.setPointByVal(d-1,e),a.interpolateAttributesRange(0,0,0,d-1));return a}getReshapedMultiPath(c,b,e){return c.getGeometryType()===p.GeometryType.enumPolygon?this.getReshapedPolygon(c,b,e):this.getReshapedPolyline(c,b)}getReshapedPolygon(c,b,e){var a=c.getImpl().querySegmentIterator();a.setCirculator(!0);var d=new h.SegmentBuffer;new h.Point;const f=new h.Polygon({vd:c.getDescription()});f.addSegmentsFromPath(b,0,0,b.getSegmentCountPath(0),
!0);a.resetToVertex(this.m_vertexA1,this.m_pathA0);if(this.m_vertexA1===this.m_vertexA0&&this.m_scalarA1<=this.m_scalarA0)a.nextSegment().queryCut(this.m_scalarA1,this.m_scalarA0,d),f.addSegment(d.get(),!1);else{var g=a.nextSegment();1!==this.m_scalarA1&&(g.queryCut(this.m_scalarA1,1,d),f.addSegment(d.get(),!1));for(;;){g=a.nextSegment();if(a.getStartPointIndex()===this.m_vertexA0){0!==this.m_scalarA0&&(g.queryCut(0,this.m_scalarA0,d),f.addSegment(d.get(),!1));break}f.addSegment(g,!1)}}g=new h.Polygon({vd:c.getDescription()});
b=b.clone();b.reversePath(0);g.addSegmentsFromPath(b,0,0,b.getSegmentCountPath(0),!0);a.resetToVertex(this.m_vertexA0,this.m_pathA0);if(this.m_vertexA0===this.m_vertexA1&&this.m_scalarA0<this.m_scalarA1)a.nextSegment().queryCut(this.m_scalarA0,this.m_scalarA1,d),g.addSegment(d.get(),!1);else for(b=a.nextSegment(),1!==this.m_scalarA0&&(b.queryCut(this.m_scalarA0,1,d),g.addSegment(d.get(),!1));;){b=a.nextSegment();if(a.getStartPointIndex()===this.m_vertexA1){0!==this.m_scalarA1&&(b.queryCut(0,this.m_scalarA1,
d),g.addSegment(d.get(),!1));break}g.addSegment(b,!1)}a=Math.abs(f.calculateArea2D());d=Math.abs(g.calculateArea2D());b=c.createInstance();for(let k=0;k<c.getPathCount();k++)k===this.m_pathA0?a>=d?b.add(f,!1):b.add(g,!1):b.addPath(c,k,!0);return b=(new h.OperatorSimplify).execute(b,e,!1,this.m_progressTracker)}getReshapedPolyline(c,b){var e=c.getImpl().querySegmentIterator();const a=new h.Polyline;var d=new h.SegmentBuffer,f=!1;let g=-1;var k=Number.NaN;(f=this.m_pathA0>this.m_pathA1?!0:this.m_pathA0===
this.m_pathA1?this.m_vertexA0>this.m_vertexA1?!0:this.m_vertexA0===this.m_vertexA1?this.m_scalarA0>this.m_scalarA1?!0:!1:!1:!1)?(g=this.m_vertexA1,k=this.m_scalarA1,e.resetToPath(this.m_pathA1)):(g=this.m_vertexA0,k=this.m_scalarA0,e.resetToPath(this.m_pathA0));let l=!0;for(e.nextPath()||p.throwInternalErrorException("reshaper");;){const u=e.nextSegment();if(e.getStartPointIndex()===g){0!==k&&(u.queryCut(0,k,d),a.addSegment(d.get(),l),l=!1);break}else a.addSegment(u,l),l=!1}f?(k=b.clone(),k.reversePath(0),
a.addSegmentsFromPath(k,0,0,k.getSegmentCount(),l)):a.addSegmentsFromPath(b,0,0,b.getSegmentCount(),l);f?(k=this.m_scalarA0,e.resetToVertex(this.m_vertexA0,this.m_pathA0)):(k=this.m_scalarA1,e.resetToVertex(this.m_vertexA1,this.m_pathA1));f=e.nextSegment();1!==k&&(f.queryCut(k,1,d),a.addSegment(d.get(),!1));for(;e.hasNextSegment();)d=e.nextSegment(),a.addSegment(d,!1);e=c.createInstance();d=!1;for(f=0;f<c.getPathCount();f++)f===this.m_pathA0||f===this.m_pathA1?d||(e.add(a,!1),d=!0):e.addPath(c,f,
!0);return e}clearIndicesAndScalars(){this.m_vertexB1=this.m_vertexB0=this.m_vertexA1=this.m_vertexA0=this.m_pathA1=this.m_pathA0=-1;this.m_scalarB1=this.m_scalarB0=this.m_scalarA1=this.m_scalarA0=Number.NaN}}class F{getOperatorType(){return 10006}accelerateGeometry(c,b,e){return!1}canAccelerateGeometry(c){return!1}supportsCurves(){return!1}execute(c,b,e,a){return D(c,b,e,a)}}const C=new F;v.execute=function(c,b){const e=t.getSpatialReference(c);c=C.execute(t.fromGeometry(c),t.fromPolyline(b),t.fromSpatialReference(e),
null);return t.toGeometry(c,e)};v.supportsCurves=function(){return C.supportsCurves()};Object.defineProperty(v,Symbol.toStringTag,{value:"Module"})});