// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.31/esri/copyright.txt for details.
//>>built
define("require exports ../../core/Error ../../core/has ../../core/promiseUtils ../../layers/support/infoFor3D ../../layers/support/source/DataLayerSource ./executeQueryJSON ./executeQueryPBF ../support/FeatureSet ../support/Query".split(" "),function(r,h,t,u,v,m,w,x,y,z,A){async function n(d,b,c,e){e={...e};var a=A.from(b);a.sourceSpatialReference=a.sourceSpatialReference??c?.sourceSpatialReference??null;if(c?.gdbVersion||c?.dynamicDataSource)a=a===b?a.clone():a,a.gdbVersion=b.gdbVersion||c.gdbVersion,
a.dynamicDataSource=b.dynamicDataSource?w.DataLayerSource.from(b.dynamicDataSource):c.dynamicDataSource;const f=c?.infoFor3D;if(null!=f&&p(b,f)){a=a===b?a.clone():a;a.formatOf3DObjects=null;const k=m.getGlbFormatId(f),B=m.getGltfFormatId(f);for(g of f.queryFormats){if(g===k){a.formatOf3DObjects=g;break}g!==B||a.formatOf3DObjects||(a.formatOf3DObjects=g)}if(!a.formatOf3DObjects)throw new t("query:unsupported-3d-query-formats","Could not find any supported 3D object query format. Only supported formats are 3D_glb and 3D_gltf");
if(null==a.outFields||!a.outFields.includes("*")){a=a===b?a.clone():a;null==a.outFields&&(a.outFields=[]);const {originX:C,originY:D,originZ:E,translationX:F,translationY:G,translationZ:H,scaleX:I,scaleY:J,scaleZ:K,rotationX:L,rotationY:M,rotationZ:N,rotationDeg:O}=f.transformFieldRoles;a.outFields.push(C,D,E,F,G,H,I,J,K,L,M,N,O)}}var g=a;b=null!=b.outStatistics?.[0];a=u("featurelayer-pbf-statistics");b=!b||a;let l;if("pbf"===c?.format&&b)try{l=await y.executeRawQueryPBF(d,g,e)}catch(k){if("query:parsing-pbf"===
k.name)c.format="json";else throw k;}"json"!==c?.format&&b||(l=await x.executeRawQueryJSON(d,g,e));q(c?.fieldsIndex,l.fields);return l}function q(d,b){if(null!=d&&null!=b)for(const c of b)(b=d.get(c.name))&&Object.assign(c,b.toJSON())}async function P(d,b,c,e){c=c?.infoFor3D;if(!p(d,c)||null==c||!b.assetMaps||!b.features?.length)return z.fromJSON(b);({meshFeatureSetFromJSON:e}=await v.whenOrAbort(new Promise((a,f)=>r(["../support/meshFeatureSet"],a,f)),e));return e(d,c,b)}function p(d,b){return null!=
b&&!0===d.returnGeometry&&"xyFootprint"!==d.multipatchOption&&!d.outStatistics}h.executeQuery=async function(d,b,c,e){d=await n(d,b,c,e);return P(b,d,c,e)};h.executeRawQuery=n;h.normalizeFields=q;Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})});