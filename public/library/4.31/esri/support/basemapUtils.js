// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.31/esri/copyright.txt for details.
//>>built
define("exports ../Basemap ../config ../core/Collection ../core/Logger ../core/maybe ../core/urlUtils ../core/accessorSupport/ensureType ../layers/effects/utils ./basemapDefinitions".split(" "),function(e,k,H,r,I,t,l,J,K,h){function u(a,b){let c;if("string"===typeof a){const d=a in h.esriBasemapDefinitions,f=!d&&a.includes("/");if(!d&&!f)return H.apiKey?m().warn(`Unable to find basemap definition for: ${a}. See available styles at https://developers.arcgis.com/rest/basemap-styles/`):(b=Object.entries(h.esriBasemapDefinitions).filter(([,
g])=>g.classic||g.is3d).map(([g])=>`"${g}"`).sort().join(", "),m().warn(`Unable to find basemap definition for: ${a}. Try one of these: ${b}`)),null;b&&(c=b[a]);c||(c=d?k.fromId(a):new k({style:{id:a}}),b&&(b[a]=c))}else c=J.ensureType(k,a);c?.destroyed&&(m().warn("The provided basemap is already destroyed",{basemap:c}),c=null);return c}function v(a){if(n)return n(a);let b=null;a=p(a);const c=!a?.baseLayers.length;for(const f in h.esriBasemapDefinitions){var d=w(h.esriBasemapDefinitions[f]);d=x(a,
d,{mustMatchReferences:c});if("equal"===d){b=f;break}"base-layers-equal"===d&&(b=f)}return b}function y(a,b){const c=new r;a.forEach(d=>{const f=b.find(g=>"scene"!==g.type&&z(q(d),q(g)))||d;c.includes(f)?c.push(d):c.push(f)});return c}function A(a){if(B(a.url))return!0;if("vector-tile"===a.type)for(const b in a.sourceNameToSource)if(B(a.sourceNameToSource[b]?.sourceUrl))return!0;return!1}function B(a){if(!a)return!1;a=new l.Url(l.makeAbsolute(a));return!!a.authority&&L.test(a.authority)}function p(a){return a?
!a.loaded&&a.resourceInfo?w(a.resourceInfo.data):{baseLayers:C(a.baseLayers),referenceLayers:C(a.referenceLayers)}:null}function C(a){return(r.isCollection(a)?a.toArray():a).map(q)}function q(a){return{type:a.type,effect:"effect"in a?a.effect:void 0,url:D("urlTemplate"in a&&a.urlTemplate||a.url||"styleUrl"in a&&a.styleUrl||""),minScale:"minScale"in a&&null!=a.minScale?a.minScale:0,maxScale:"maxScale"in a&&null!=a.maxScale?a.maxScale:0,opacity:null!=a.opacity?a.opacity:1,visible:null!=a.visible?!!a.visible:
!0,sublayers:"map-image"!==a.type&&"wms"!==a.type||null==a.sublayers?void 0:a.sublayers?.map(b=>({id:b.id,visible:b.visible})),activeLayerId:"wmts"===a.type?a.activeLayer?.id:void 0}}function E(a){return a.isReference||"ArcGISSceneServiceLayer"===a.layerType}function w(a){return a?{baseLayers:F((a.baseMapLayers??[]).filter(b=>!E(b))),referenceLayers:F((a.baseMapLayers??[]).filter(b=>E(b)))}:null}function F(a){return a.map(b=>{let c;switch(b.layerType){case "VectorTileLayer":c="vector-tile";break;
case "ArcGISTiledMapServiceLayer":c="tile";break;case "ArcGISSceneServiceLayer":c="scene";break;default:c="unknown"}return{type:c,effect:b.effect,url:D(b.templateUrl||b.urlTemplate||b.styleUrl||b.url),minScale:b.minScale??0,maxScale:b.maxScale??0,opacity:b.opacity??1,visible:null!=b.visibility?!!b.visibility:!0,sublayers:void 0,activeLayerId:void 0}})}function x(a,b,c){return null!=a!==(null!=b)?"not-equal":a&&b?G(a.baseLayers,b.baseLayers)?G(a.referenceLayers,b.referenceLayers)?"equal":c.mustMatchReferences?
"not-equal":"base-layers-equal":"not-equal":"equal"}function G(a,b){if(a.length!==b.length)return!1;for(let c=0;c<a.length;c++)if(!z(a[c],b[c]))return!1;return!0}function z(a,b){if(a.type!==b.type||a.url!==b.url||a.minScale!==b.minScale||a.maxScale!==b.maxScale||a.visible!==b.visible||a.opacity!==b.opacity||!K.effectEquals(a.effect,b.effect))return!1;if(null!=a.activeLayerId||null!=b.activeLayerId)return a.activeLayerId===b.activeLayerId;if(null!=a.sublayers||null!=b.sublayers){if(null==a.sublayers||
null==b.sublayers||a.sublayers.length!==b.sublayers.length)return!1;for(let c=0;c<a.sublayers.length;c++){const d=a.sublayers.at(c),f=b.sublayers.at(c);if(d?.id!==f?.id||d?.visible!==f?.visible)return!1}}return!0}function D(a){return a?l.normalize(a).replace(/^\s*https?:/i,"").toLowerCase():""}function M(a){return"portalItem"in a?a.portalItem?.thumbnailUrl:void 0}const m=()=>I.getLogger("esri.support.basemapUtils");let n;const L=/^(basemaps|ibasemaps).*-api\.arcgis\.com$/i;e.clonePreservingTiledLayers=
function(a,b=null){a=u(a);if(!a)return null;a=a.clone();b&&(a.baseLayers=y(a.baseLayers,b.baseLayers),a.referenceLayers=y(a.referenceLayers,b.referenceLayers));return a};e.contentEquals=function(a,b){if(a===b||null!=a?.portalItem?.id&&a.portalItem.id===b?.portalItem?.id)return!0;a=p(a);b=p(b);return"equal"===x(a,b,{mustMatchReferences:!0})};e.createCache=function(){return{}};e.destroyCache=function(a){for(const b in a)t.destroyMaybe(a[b]),delete a[b]};e.ensureType=u;e.findSpatialReference=function(a,
b){if(null==b||null==a)return{spatialReference:null,updating:!1};if("not-loaded"===b.loadStatus)return b.load(),{spatialReference:null,updating:!0};if(b.spatialReference)return{spatialReference:b.spatialReference,updating:!1};if(0===b.baseLayers.length)return{spatialReference:null,updating:!1};b=b.baseLayers.at(0);switch(b.loadStatus){case "not-loaded":b.load();case "loading":return{spatialReference:null,updating:!0};case "failed":return{spatialReference:null,updating:!1}}b=(("supportedSpatialReferences"in
b?b.supportedSpatialReferences:null)||["tileInfo"in b?b.tileInfo?.spatialReference:b.spatialReference]).filter(Boolean);const c=a.spatialReference;return c?{spatialReference:b.find(d=>c.equals(d))??b[0]??null,updating:!1}:{spatialReference:b[0],updating:!1}};e.getBasemapThumbnailUrl=function(a){if(!a)return null;var {thumbnailUrl:b}=a;return b?b:(b=v(a))?h.esriBasemapDefinitions[b].thumbnailUrl:t.mappedFind(a.baseLayers,M)};e.getWellKnownBasemapId=v;e.hasDeveloperBasemapLayer=function(a){return!!a?.baseLayers.concat(a.referenceLayers).some(A)};
e.isBasemap3D=function(a){return"Web Scene"===a.portalItem?.type||a.referenceLayers.some(b=>"scene"===b.type)};e.isBasemapInBeta=function(a){return!!a?.portalItem?.tags?.some(b=>"beta"===b.toLowerCase())};e.isBasemapLayer=function(a,b){return a.basemap?.referenceLayers?.some(c=>c.uid===b)||a.basemap?.baseLayers?.some(c=>c.uid===b)};e.isDeveloperBasemapLayer=A;e.overrideGetWellKnownBasemapId=function(a){n=a};Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})});