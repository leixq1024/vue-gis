// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.31/esri/copyright.txt for details.
//>>built
define("exports ../geometry ../core/Cyclical ../core/mathUtils ../core/libs/gl-matrix-2/math/mat4 ../core/libs/gl-matrix-2/factories/mat4f64 ./vec32 ../core/libs/gl-matrix-2/factories/vec3f64 ./vec42 ../core/libs/gl-matrix-2/factories/vec4f64 ../core/libs/gl-matrix-2/math/common ../geometry/ellipsoidUtils ../geometry/Extent ../geometry/SpatialReference ../geometry/support/coordsUtils ../geometry/support/frustum ../geometry/support/lineSegment ../geometry/support/plane ../geometry/support/ray ./sphere ../geometry/support/webMercatorUtils ../views/3d/state/Frustum ../views/3d/state/utils/viewUtils ../views/3d/support/cameraUtilsInternal ../views/3d/support/earthUtils ../views/3d/support/mathUtils ../geometry/Polygon".split(" "),
function(z,R,S,n,T,la,k,q,U,ma,V,na,oa,pa,qa,ra,W,t,sa,M,ta,D,ua,N,va,wa,xa){function O(b,c,f,h=N.createDirectionUp()){k.cross(A,b,X);0===k.dot(A,A)&&k.cross(A,b,Y);T.fromRotation(G,-n.deg2rad(c),b);T.rotate(G,G,-n.deg2rad(f),A);const {up:a,direction:d}=h;k.cross(a,A,b);k.normalize(a,a);k.transformMat4(a,a,G);k.normalize(d,b);k.negate(d,d);k.transformMat4(d,d,G);return h}function Z(b,c,f,h){const a=A,d=E;k.normalize(a,b);k.cross(E,a,X);0===k.dot(E,E)&&k.cross(E,a,Y);k.cross(d,E,a);return N.directionToHeadingTilt(c,
f,h,a,d)}function aa(b,c,f,h){const a={eye:q.create(),up:null,tilt:h,heading:f},d=A;d[0]=b[0];d[1]=b[2];d[2]=-b[1];f=n.deg2rad(f);var e=n.deg2rad(h);h=Math.sin(f);f=Math.cos(f);var g=Math.sin(e),l=Math.cos(e);const m=k.length(d);if(1E-8>Math.abs(e))e=c+m;else{var p=m/g,w=n.asinClamped(c/p);e=p*Math.sin(Math.PI-e-w)}l*=c;p=c*c*g*g;w=f*f*p;const F=e-l,C=F*F;var u=w*(w+C-d[1]*d[1]);if(0>u)return k.scale(a.eye,d,e/m),a.tilt=0,H(a,b);var x=Math.sqrt(u);const I=d[1]*F;u=w+C;x=0<f?-x+I:x+I;if(1E-8>Math.abs(u))return 1E-8>
m?(a.eye[0]=0,a.eye[1]=0,a.eye[2]=c):k.scale(a.eye,d,e/m),a.tilt=0,P(a.eye),H(a,b);a.eye[1]=x/u;c*=g;x=a.eye[1]*a.eye[1];g=1-x;u=Math.sqrt(g);p=w*x+h*h*p-2*f*c*a.eye[1]*u*F+g*C;if(1E-8>Math.abs(p))return k.scale(a.eye,d,e/m),a.tilt=0,P(a.eye),H(a,b);a.eye[0]=(g*(e*d[0]-l*d[0])-c*u*(d[0]*a.eye[1]*f+d[2]*h))/p;a.eye[2]=(g*(e*d[2]-l*d[2])-c*u*(d[2]*a.eye[1]*f-d[0]*h))/p;k.scale(a.eye,a.eye,e);P(a.eye);return H(a,b)}function P(b){const c=b[1];b[1]=-b[2];b[2]=c}function H(b,c){c=O(c,b.heading,b.tilt);
b.up=c.up;return b}function ba(b,c,f){c=k.length(c);f=n.asinClamped(f/(Math.sqrt(f*f+c*c-2*f*c*Math.cos(Math.PI-b))/Math.sin(b)));return n.rad2deg(b-f)}function ca(b,c,f){b=n.deg2rad(b);c=k.length(c);return n.asinClamped(f/(c/Math.sin(b)))+b}function da(b,c,f,h,a){function d(m){const p=Math.PI/2;m=S.cyclical2PI.normalize(m,-p);m>p&&(m=Math.PI-m);return m}var e=c.latitude;var g=na.getReferenceEllipsoid(b.spatialReference).radius;c=c.longitude;var l=va.getLonDeltaForDistance(e,f,g)/2;f=c-l;c+=l;e=n.deg2rad(e);
e=(1+Math.sin(e))/(1-Math.sin(e));l=(e+1)*Math.tan(h/g/2);e=1.5*Math.PI-2*Math.atan(.5*(l+Math.sqrt(4*e+l*l)));h=e+h/g;e=d(e);h=d(h);h<e&&(g=h,h=e,e=g);e=Math.max(n.rad2deg(e),-90);h=Math.min(n.rad2deg(h),90);c=ya.monotonic(f,c);180<c-f&&(g=(c-f-180)/2,f+=g,c-=g);g=b.spatialReference&&b.spatialReference.isGeographic?b.spatialReference:pa.WGS84;a?(a.xmin=f,a.ymin=e,a.xmax=c,a.ymax=h,a.spatialReference=g):a=new oa(f,e,c,h,g);b.spatialReference&&b.spatialReference.isWebMercator&&ta.geographicToWebMercator(a,
!1,a);return a}function ea(b,c){var f=b.frustum,{renderCoordsHelper:h}=b,a=h.getAltitude(c);const d=b.spatialReference;var e=h.referenceEllipsoid.radius,g=b.state.camera;const l=g.eye;c=1+k.distance(l,c)/(e+a);c=Math.sqrt(c*c-1);const {minCurvature:m,maxCurvature:p,minSamples:w,maxSamples:F}=za,{renderCoordsHelper:C,state:{camera:u}}=b,{center:x,eye:I}=u;b=Math.abs(C.getAltitude(x));e=Math.abs(Math.PI/2-ua.viewAngle(C,x,I));M.fromRadius(fa,C.referenceEllipsoid.radius+b);b=M.cameraFrustumCoverage(fa,
e,u.distance,u.fovY);c=n.clamp((c-m)/(p-m),0,1);c=Math.round(n.lerp(w,F,c));e=g.aboveGround;const Aa=f.planes[ra.PlaneIndex.FAR],B=[],ha=t.fromPositionAndNormal(q.ZEROS,Ba,t.create());g=t.fromPositionAndNormal(q.ZEROS,Ca,t.create());U.set(Q,0,0,0,0);for(let v=0;4>v;v++){const Da=v===D.LineIndex.NEAR_FAR_BOTTOM_RIGHT&&!e||v===D.LineIndex.NEAR_FAR_TOP_LEFT&&e?1-b:0,Ea=v===D.LineIndex.NEAR_FAR_BOTTOM_RIGHT&&e||v===D.LineIndex.NEAR_FAR_TOP_LEFT&&!e?b:1,ia=f.lines[v],ja=f.lines[3===v?0:v+1];for(let J=
0;J<c;J++){var y=J/c;y=v===D.LineIndex.NEAR_FAR_BOTTOM_RIGHT?1-(1-y)**2:v===D.LineIndex.NEAR_FAR_TOP_LEFT?y**2:y;var K=0===J?0:n.lerp(Da,Ea,y);y=k.lerp(Fa,ia.origin,ja.origin,K);K=wa.slerp(ia.direction,ja.direction,K,Ga);h.intersectManifoldClosestSilhouette(sa.wrap(y,K),a,r);N.clampLineSegmentToPlane(r,l,r,Aa);B.push(q.clone(r));0!==B.length&&k.sqrDist(B.at(-1),r);y=(t.isPointInside(ha,r)?1:0)|(t.isPointInside(g,r)?2:0);Q[y]=1}}2<B.length&&k.sqrDist(B[0],B.at(-1));if(1<U.squaredLength(Q)){f=ka(B,
ha);a=[];for(L of f)a.push(...ka(L,g));var L=a}else L=[B];h=Ha(L,h,d);return new xa({rings:h,spatialReference:d})}function Ha(b,c,f){const h=2*V.getEpsilon();return b.map(a=>{const d=[];var e=!1;for(var g of a)c.fromRenderCoords(g,r,f),Math.abs(g[0])<h&&Math.abs(g[1])<h?(d.push([null,r[1]]),d.push([null,r[1]]),e=!0):d.push([r[0],r[1]]);if(e)for(a=0;a<d.length;a++){g=d[a];if(null!=g[0])continue;e=d[a+1];const l=d.at(0===a?-1:a-1);g[0]=l[0];a++;g=d.at(a===d.length-1?0:a+1);e[0]=g[0]}d.push(d[0]);qa.isClockwise(d)||
d.reverse();return d})}function ka(b,c){const f=[],h=[],a=V.getEpsilon();for(let g=0;g<b.length;g++){const l=b[g];var d=W.fromPoints(l,g===b.length-1?b[0]:b[g+1],Ia);d=t.intersectLineOrRay(c,d.origin,d.vector,t.IntersectFlags.NONE,r);switch(d){case t.IntersectResult.INSIDE:f.push(l);break;case t.IntersectResult.OUTSIDE:h.push(l);break;case t.IntersectResult.INTERSECTS_INSIDE_OUT:case t.IntersectResult.INTERSECTS_OUTSIDE_IN:const [m,p,w]=d===t.IntersectResult.INTERSECTS_INSIDE_OUT?[1,f,h]:[-1,h,f];
var e=t.getNormal(c);d=k.scaleAndAdd(q.create(),r,e,m*a);e=k.scaleAndAdd(q.create(),r,e,m*-a);p.push(l);p.push(d);w.push(e)}}b=[];f.length&&b.push(f);h.length&&b.push(h);return b}const X=q.fromValues(0,0,1),Y=k.normalize(q.create(),q.fromValues(1,1,1)),ya=new S.Cyclical(-180,180),G=la.create(),A=q.create(),E=q.create(),za={minCurvature:n.deg2rad(5),maxCurvature:n.deg2rad(50),minSamples:1,maxSamples:6},Ba=q.fromValues(1,0,0),Ca=q.fromValues(0,1,0),Ga=q.create(),Fa=q.create(),r=q.create(),fa=M.create(),
Ia=W.create(),Q=ma.create();R=Object.freeze(Object.defineProperty({__proto__:null,directionToHeadingTilt:Z,eyeForCenterWithHeadingTilt:aa,eyeTiltToLookAtTilt:ca,headingTiltToDirectionUp:O,lookAtTiltToEyeTilt:ba,toArea:ea,toExtent:da},Symbol.toStringTag,{value:"Module"}));z.cameraUtilsSpherical=R;z.directionToHeadingTilt=Z;z.eyeForCenterWithHeadingTilt=aa;z.eyeTiltToLookAtTilt=ca;z.headingTiltToDirectionUp=O;z.lookAtTiltToEyeTilt=ba;z.toArea=ea;z.toExtent=da});