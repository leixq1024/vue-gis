// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.31/esri/copyright.txt for details.
//>>built
define(["exports","./Geometry","./Transformation2D","./tslib.es6","./SimpleGeometryCursor"],function(F,p,l,Ka,bb){function Of(a){return dd.getInstance().FindOrAdd(a)}function Id(a,b){if(!a||!b)return b?b:a;const c=a.getSemanticsBitArray()|b.getSemanticsBitArray();return(c&a.getSemanticsBitArray())===c?a:(c&b.getSemanticsBitArray())===c?b:Of(c)}function Jd(a,b){b=a.getSemanticsBitArray()|1<<b;return(b&a.getSemanticsBitArray())===b?a:Of(b)}function Pf(a,b){b=(a.getSemanticsBitArray()|1<<b)-(1<<b);return b===
a.getSemanticsBitArray()?(p.geometryReleaseAssert(0),a):Of(b)}function cb(){return dd.getInstance().GetVD2D()}function Kd(){return dd.getInstance().GetVD3D()}function ye(a,b,c){c.fill(-1);if(null!==a&&null!==b)for(let d=0,e=a.getAttributeCount();d<e;d++)c[d]=b.getAttributeIndex(a.getSemantics(d))}function Gh(a,b,c){switch(a){case 0:return new Qf(b,c);case 1:return new ic(b,c);case 2:return new za(b,c);case 3:throw Error("64 bit int attribute stream not implemented");case 4:return new Db(b,c);default:p.throwInvalidArgumentException("")}}
function Hh(a,b){const c=ed.getComponentCount(a),d=ed.getPersistence(a);return Gh(d,b*c,ed.getDefaultValue(a))}function ze(a,b){const c=ed.getComponentCount(a);a=ed.getPersistence(a);return Gh(a,b*c)}function hb(a,b){return new za(a,b)}function Lc(a,b){return new ic(a,b)}function Wl(a,b,c){return d=>0===c?(d+a)*b:(d-a*b)/b}function Ae(a,b){const c=new D;a.queryLooseEnvelope(c);c.mergeEnvelope2D(b);return c}function Ld(a,b){const c=D.constructEmpty();a.queryLooseEnvelope(c);a=D.constructEmpty();b.queryLooseEnvelope(a);
c.mergeEnvelope2D(a);return c}function Ih(a,b,c){const d=D.constructEmpty();d.setFromPoints(a,b);a=d.calculateToleranceFromEnvelope();return Be(0,null,a,c,!1)}function Ma(a,b,c){b=b.calculateToleranceFromEnvelope();return Be(0,a,b,c,!1)}function Md(a,b,c){b=b.calculateToleranceFromEnvelope();return Be(1,a,b,c,!1)}function Jh(a,b,c){b=b.queryInterval(1,0);return Md(a,b,c)}function ib(a,b,c){const d=D.constructEmpty();b.queryEnvelope(d);return Ma(a,d,c)}function oc(a,b,c=!1){b=b.calculateToleranceFromEnvelope();
return Be(0,a,b,c,!0).total()}function Nd(a,b,c){const d=D.constructEmpty();b.queryEnvelope(d);return oc(a,d,c)}function Be(a,b,c,d,e){const f=new jb(0,0);null!==b&&(f.tolerance=b.getTolerance(a),e&&!d||null===b||(a=b.getResolution(a),f.resolution=a,d&&(f.resolution*=2)));d&&(c*=4,f.tolerance*=1.01,f.resolution*=1.01);return f.total()<c?new jb(c,0):f}function kb(a){return Math.sqrt(2)*(2*a.tolerance+a.resolution)}function Rf(a){return Math.sqrt(2)*(a.tolerance+a.resolution)}function Kh(a,b){return 3<=
a.getImpl().getIsSimple(b,[0])}function Lh(a,b,c){var d=D.constructEmpty(),e=D.constructEmpty();a.queryLooseEnvelope(d);b.queryEnvelope(e);d.inflateCoords(c,c);e.inflateCoords(c,c);const f=D.constructEmpty();f.setCoords({env2D:d});f.intersect(e);e=a.querySegmentIterator();a=new Od;a.setTolerance(c);c=!1;for(a.startRedConstruction();e.nextPath();)for(;e.hasNextSegment();)e.nextSegment().queryLooseEnvelope(d),d.isIntersecting(f)&&(c=!0,a.addRedEnvelope(e.getStartPointIndex(),d));a.endRedConstruction();
if(!c)return null;d=!1;a.startBlueConstruction();for(let g=0,h=b.getPointCount();g<h;g++)c=b.getXY(g),f.contains(c)&&(d=!0,a.addBlueEnvelope(g,D.construct(c.x,c.y,c.x,c.y)));a.endBlueConstruction();return d?a:null}function fd(a,b){if(!b){b=new D;a.queryLooseEnvelope(b);for(var c=new fb(b,8),d=-1,e=new D,f=a.querySegmentIterator(),g=!1;f.nextPath();)for(;f.hasNextSegment();){var h=f.nextSegment(),k=f.getStartPointIndex();h.queryLooseEnvelope(e);d=c.insertEx(k,e,d);if(-1===d){g&&p.throwInternalErrorException("");
b.assign(a.calculateEnvelope2D(!1));g=!0;c.reset(b,8);f.resetToFirstPath();break}}return c}c=new D;a.queryLooseEnvelope(c);d=new fb(c,8);e=-1;f=new D;g=a.querySegmentIterator();for(h=!1;g.nextPath();)for(;g.hasNextSegment();){k=g.nextSegment();const m=g.getStartPointIndex();k.queryLooseEnvelope(f);if(f.isIntersecting(b)&&(e=d.insertEx(m,f,e),-1===e)){h&&p.throwInternalErrorException("");c.assign(a.calculateEnvelope2D(!1));h=!0;d.reset(c,8);g.resetToFirstPath();break}}return d}function Mh(a,b){if(b){const c=
new fb(b,8),d=new l.Point2D,e=new D;let f=!1;for(let g=0;g<a.getPointCount();g++)d.setCoordsPoint2D(a.getXY(g)),b.contains(d)&&(e.setCoords({pt:d}),-1===c.insert(g,e)&&(f&&p.throwInternalErrorException(""),f=!0,c.reset(a.calculateEnvelope2D(),8),g=-1));return c}p.geometryReleaseAssert(0);return null}function Nh(a,b,c,d,e){let f=!1;const g=e.vmin;for(e=e.vmax;c<b;c+=d){const h=a.read(c);h<g?(f=!0,a.write(c,g)):h>e&&(f=!0,a.write(c,e))}return f}function Sf(a,b,c,d){if(!a.hasAttribute(c))return!1;var e=
a.getGeometryType();if(e===p.GeometryType.enumGeometryCollection){var f=a.getGeometryCount(),g=0;for(e=0;e<f;++e){var h=a.getGeometry(e);g|=Sf(h,b,c,d)?1:0}return!!g}if(p.isMultiVertex(e)){h=Oh.getPersistence(c);f=Oh.getComponentCount(c);g=a.getPointCount();if(1===h||2===h)return c=a.getAttributeStreamRef(c),(b=Nh(c,g*f,d,f,b))&&a.notifyModified(),b;p.throwInternalErrorException("snap_coordinate not implemented")}if(e===p.GeometryType.enumEnvelope)return f=a.queryInterval(c,d),g=!1,f.vmin<b.vmin&&
(g=!0,f.vmin=b.vmin),f.vmax>b.vmax&&(g=!0,f.vmax=b.vmax),g&&a.setIntervalEnvelope(c,d,f),g;if(e===p.GeometryType.enumPoint)return f=a.getAttributeAsDbl(c,d),g=!1,f<b.vmin&&(g=!0,f=b.vmin),f>b.vmax&&(g=!0,f=b.vmax),g&&a.setAttributeBasic(c,d,f),g;if(p.isSegment(e))return f=a.getStartAttributeAsDbl(c,d),g=!1,f<b.vmin&&(g=!0,f=b.vmin),f>b.vmax&&(g=!0,f=b.vmax),g&&a.setStartAttribute(c,d,f),f=a.getEndAttributeAsDbl(c,d),f<b.vmin&&(g=!0,f=b.vmin),f>b.vmax&&(g=!0,f=b.vmax),g&&a.setEndAttribute(c,d,f),g;
p.throwInternalErrorException("snap_coordinate not implemented")}function Ph(a,b){a=l.nextRand(a);const c=b.length/l.intMax();for(let d=0;d<b.length;++d){const e=Math.trunc(a*c);a=l.nextRand(a);const f=Math.trunc(a*c),g=b[e];b[e]=b[f];b[f]=g}}function Qh(a,b,c){if(!(c<=b))for(;b<c;)a[c]=l.swap(a[b],a[b]=a[c]),b++,c--}function Pd(a){return a.x-a.y}function Qd(a){return a.x+a.y}function Rh(a,b=-1){return new Xl(a,b)}function zc(a,b){const c=a.getStartXY();if(c.equals(b.getStartXY())||c.equals(b.getEndXY()))return!0;
a=a.getEndXY();return a.equals(b.getStartXY())||a.equals(b.getEndXY())?!0:!1}function Ce(a,b){let c=a.calculateLowerLength2D();if(c>b)return!1;if(a.isLine())return!0;c=a.calculateUpperLength2D();return c<=b?!0:0===b?!1:a.calculateLength2D()<=b}function Tf(a,b){const c=a.getEndXY().sub(a.getStartXY()).length();a=a.calculateUpperLength2D()-c<=b[0];b[0]*=.1;return a}function Sh(a,b,c,d,e,f,g,h){var k=a.calculateUpperLength2D(),m=b.calculateUpperLength2D();let n=!1;k>m&&(b=l.swap(a,a=b),d=l.swap(c,c=
d),m=l.swap(k,k=m),n=!0);c=0===c;g[0]=c?1:0;m=a.getCoord2D(g[0]);h[0]=b.getClosestCoordinate(m,!1);var q=b.getCoord2D(h[0]);if(l.Point2D.distance(m,q)<=e){q=[.5,.75,.25,.1,.9];var r=!0;for(var t=0;t<q.length;t++)if(m.assign(a.getCoord2D(q[t])),!b.isCloserThanDistance(m,new l.Envelope1D(0,1),e)){r=!1;break}if(r)return n&&(h[0]=l.swap(g[0],g[0]=h[0])),1}if(k<=3*e)return 0;k=l.snap(Math.max(e/k,.1),0,.5);m=.01*e;r=q=0;t=k;let u=-1,v=0,w=.03125;for(let y=0;;y++){p.geometryReleaseAssert(4095>y);const z=
c?k:1-k;var x=a.getCoord2D(z);const A=b.getClosestCoordinate(x,!1);if(A===d)return v;const C=b.getCoord2D(A);x=l.Point2D.distance(x,C);0===y&&(u=x);x<=m?(w=.5,r=x,q=k):(t=k,u=x);if(Math.abs(r-u)>.1*m&&1E-16<t-q)k=l.lerp(q,t,w);else{g[v]=z;h[v]=A;n&&(h[v]=l.swap(g[v],g[v]=h[v]));if(1===f||1===v)return 1===v&&g[0]>g[1]&&(g[1]=l.swap(g[0],g[0]=g[1]),h[1]=l.swap(h[0],h[0]=h[1])),v+1;v++;q=t;r=u;t=.8;u=-1;k=.8;w=.03125;m=10*e;y=0}}}function Rd(a,b,c,d,e,f,g,h,k){if(l.isOneOf(c,0,1)&&l.isOneOf(d,0,1)&&
0===l.Point2D.distance(a.getCoord2D(c),b.getCoord2D(d))){k=new S;var m=l.doubleEps();a.queryDerivative(new l.ECoordinate(c,m),k);if(k.isTrueZero()){var n=1===c?-1E-12:1E-12;a.queryDerivative((new l.ECoordinate(c,m)).add(n),k)}1===c&&k.negateThis();n=new S;b.queryDerivative(new l.ECoordinate(d,m),n);if(n.isTrueZero()){const q=1===c?-1E-12:1E-12;b.queryDerivative((new l.ECoordinate(d,m)).add(q),n)}1===d&&n.negateThis();k.isZero()||k.normalize();n.isZero()||n.normalize();m=k.dotProduct(n);k=k.crossProduct(n);
k.scaleError(3);(m=m.ge(l.s_zero))&&!(m=k.isZero())&&(k=Math.abs(k.value()),m=a.calculateUpperLength2D(),n=b.calculateUpperLength2D(),m=Math.min(.01*e/Math.min(m,n),1E-10),m=k<m);if(m)return Sh(a,b,c,d,e,f,g,h)}return 0}function Th(a,b,c){a.m_description.hasZ()||a.addAttribute(1);if(b){if(a.m_XEnd!==c.x||a.m_YEnd!==c.y)a.m_XEnd=c.x,a.m_YEnd=c.y,a.endPointModified()}else if(a.m_XStart!==c.x||a.m_YStart!==c.y)a.m_XStart=c.x,a.m_YStart=c.y,a.endPointModified();a.m_attributes[(a.m_description.getTotalComponentCount()-
2)*b]=c.z}function Uh(a,b,c){c.assignVertexDescription(a.m_description);c.setXYCoords(0===b?a.m_XStart:a.m_XEnd,0===b?a.m_YStart:a.m_YEnd);for(let d=1;d<a.m_description.getAttributeCount();d++){const e=a.m_description.getSemantics(d);for(let f=0,g=Mc.getComponentCount(e);f<g;f++){const h=Xb(a,b,e,f);c.setAttributeBasic(e,f,h)}}}function Vh(a,b,c){c.isEmpty()&&p.throwEmptyGeometryException("");var d=c.getXY();if(b){if(a.m_XEnd!==d.x||a.m_YEnd!==d.y)a.m_XEnd=d.x,a.m_YEnd=d.y,a.endPointModified()}else if(a.m_XStart!==
d.x||a.m_YStart!==d.y)a.m_XStart=d.x,a.m_YStart=d.y,a.endPointModified();d=c.getDescription();d!==a.m_description&&a.mergeVertexDescription(d);for(let e=1,f=d.getAttributeCount();e<f;e++){const g=d.getSemantics(e),h=Mc.getComponentCount(g);for(let k=0;k<h;k++){const m=c.getAttributeAsDbl(g,k);pc(a,b,g,k,m)}}}function Xb(a,b,c,d){(0>b||1<b)&&p.throwOutOfRangeException("");if(0===c)return(0>d||2<=d)&&p.throwOutOfRangeException(""),0===b?0===d?a.m_XStart:a.m_YStart:0===d?a.m_XEnd:a.m_YEnd;var e=Mc.getComponentCount(c);
(0>d||d>=e)&&p.throwOutOfRangeException("");e=a.m_description.getAttributeIndex(c);return 0<=e?a.m_attributes[b*(a.m_description.getTotalComponentCount()-2)+a.m_description.getPointAttributeOffset(e)-2+d]:Mc.getDefaultValue(c)}function pc(a,b,c,d,e){(0>b||1<b)&&p.throwOutOfRangeException("");if(0===c)0===b?0===d?a.m_XStart=e:1===d?a.m_YStart=e:p.throwOutOfRangeException(""):1===b?0===d?a.m_XEnd=e:1===d?a.m_YEnd=e:p.throwOutOfRangeException(""):p.throwOutOfRangeException(""),a.endPointModified();else{var f=
Mc.getComponentCount(c);(0>d||d>=f)&&p.throwOutOfRangeException("");f=a.m_description.getAttributeIndex(c);0>f&&(a.addAttribute(c),f=a.m_description.getAttributeIndex(c));a.m_attributes[b*(a.m_description.getTotalComponentCount()-2)+a.m_description.getPointAttributeOffset(f)-2+d]=e}}function jc(a){return a.absNorm()*l.geomEpsFactor()}function rb(a,b){return Math.max(a.absNorm(),b.absNorm())*l.geomEpsFactor()}function Eb(a,b,c){const d=new Va;a.queryEnvelopeW(l.Envelope1D.unit(),d);a=new Va;b.queryEnvelopeW(l.Envelope1D.unit(),
a);a.inflate(c);return!d.isIntersectingW(a)}function Uf(a,b,c){a=l.cloneObjectArray(a,c);b=l.cloneObjectArray(b,c);a.sort((d,e)=>d.compare(e));b.sort((d,e)=>d.compare(e));for(c=0;3>c;c++){if(0>a[c].compare(b[c]))return-1;if(0!==a[c].compare(b[c]))return 1}return 0}function sb(a,b,c){var d=a.getStartXY();a=a.getEndXY();l.lerpPoint2D(d,a,b,c)}function Wh(a,b,c){.5>=b.value()?l.lerpLoPointE(2,S.constructPoint2D(a.getStartXY()),S.constructPoint2D(a.getEndXY()),b,c):l.lerpHiPointE(2,S.constructPoint2D(a.getStartXY()),
S.constructPoint2D(a.getEndXY()),b,c)}function Xh(a){if(a.m_YEnd<a.m_YStart||a.m_YEnd===a.m_YStart&&a.m_XEnd<a.m_XStart){a.m_XEnd=l.swap(a.m_XStart,a.m_XStart=a.m_XEnd);a.m_YEnd=l.swap(a.m_YStart,a.m_YStart=a.m_YEnd);for(let b=0,c=a.m_description.getTotalComponentCount()-2;b<c;b++)a.m_attributes[b+c]=l.swap(a.m_attributes[b],a.m_attributes[b]=a.m_attributes[b+c])}}function De(a,b,c,d,e,f,g,h){null!==d&&(d.length=2);null!==e&&(e.length=2);null!==c&&(c.length=2);{var k=d,m=e,n=gd(a,b.getStartXY(),f,
!1);const r=gd(a,b.getEndXY(),f,!1),t=gd(b,a.getStartXY(),f,!1),u=gd(b,a.getEndXY(),f,!1);let v=0,w=0;if(!Number.isNaN(n)){var q=!1;g&&l.isOneOf(n,0,1)&&a.getCoord2D(n).isEqualPoint2D(b.getStartXY())&&(v++,q=!0);q||(k&&(k[w]=n),m&&(m[w]=0),c&&(c[w]=l.Point2D.construct(b.m_XStart,b.m_YStart)),w++)}Number.isNaN(r)||(q=!1,g&&l.isOneOf(r,0,1)&&a.getCoord2D(r).isEqualPoint2D(b.getEndXY())&&(v++,q=!0),q||(2>w&&(k&&(k[w]=r),m&&(m[w]=1),c&&(c[w]=l.Point2D.construct(b.m_XEnd,b.m_YEnd))),w++));2===w||Number.isNaN(t)||
0===n&&0===t||0===r&&1===t||(q=!1,g&&l.isOneOf(t,0,1)&&b.getCoord2D(t).isEqualPoint2D(a.getStartXY())&&(v++,q=!0),q||(2>w&&(k&&(k[w]=0),m&&(m[w]=t),c&&(c[w]=l.Point2D.construct(a.m_XStart,a.m_YStart))),w++));2===w||Number.isNaN(u)||1===n&&0===u||1===r&&1===u||(n=!1,g&&l.isOneOf(u,0,1)&&b.getCoord2D(u).isEqualPoint2D(a.getEndXY())&&(v++,n=!0),n||(2>w&&(k&&(k[w]=1),m&&(m[w]=u),c&&(c[w]=l.Point2D.construct(b.m_XEnd,b.m_YEnd))),w++));0<w?(h&&(m=l.swap(k,k=m)),2===w&&k&&k[0]>k[1]&&(k[1]=l.swap(k[0],k[0]=
k[1]),m&&(m[1]=l.swap(m[0],m[0]=m[1])),c&&(c[1]=l.swap(c[0],c[0]=c[1]))),a=w):0<v?a=0:(b=Yl(a,b,f),Number.isNaN(b.x)?a=0:(c&&(c[0]=a.getCoord2D(b.x)),k&&(k[0]=b.x),m&&(m[0]=b.y),a=1))}d&&(d.length=a);e&&(e.length=a);c&&(c.length=a);return a}function gd(a,b,c,d){const e=l.Point2D.getNAN(),f=l.Point2D.getNAN();let g=!1;a.m_YEnd<a.m_YStart||a.m_YEnd===a.m_YStart&&a.m_XEnd<a.m_XStart?(e.setCoords(a.m_XEnd,a.m_YEnd),f.setCoords(a.m_XStart,a.m_YStart),g=!0):(e.setCoords(a.m_XStart,a.m_YStart),f.setCoords(a.m_XEnd,
a.m_YEnd));a=g?1:0;const h=g?0:1;var k=l.Point2D.getNAN();k.setSub(b,e);var m=k.length(),n=3*m*l.doubleEps();if(m<=Math.max(c,n))return d&&0===m?Number.NaN:a;k.setSub(b,f);m=k.length();n=3*m*l.doubleEps();if(m<=Math.max(c,n))return d&&0===m?Number.NaN:h;k.setCoords(f.x-e.x,f.y-e.y);d=k.length();if(0<d){m=1/d;k.scale(m);const r=l.Point2D.getNAN();r.setSub(b,e);n=r.dotProduct(k);var q=8*r.dotProductAbs(k)*l.doubleEps();k.leftPerpendicularThis();const t=r.dotProduct(k);k=8*r.dotProductAbs(k)*l.doubleEps();
q=Math.max(c,q);if(n<-q||n>d+q)return Number.NaN;if(Math.abs(t)<=Math.max(c,k)&&(k=l.snap(n*m,0,1),d=l.Point2D.getNAN(),l.lerpPoint2D(e,f,k,d),l.Point2D.distance(d,b)<=c)){if(.5>k){if(l.Point2D.distance(d,e)<=c&&l.Point2D.distance(b,e)<=c)return a}else if(l.Point2D.distance(d,f)<=c&&l.Point2D.distance(b,f)<=c)return h;return g?1-k:k}}return Number.NaN}function Ee(a,b,c){var d=l.Point2D.getNAN();d.setCoords(b,c);d.subThis(a.getStartXY());b=l.Point2D.getNAN();b.setSub(a.getEndXY(),a.getStartXY());a=
b.crossProduct(d);d=4*l.doubleEps()*(Math.abs(b.x*d.y)+Math.abs(b.y*d.x));return a>d?-1:a<-d?1:0}function Yh(a,b,c,d){const e=d?a.m_XStart:a.m_XEnd;d=d?a.m_YStart:a.m_YEnd;a=l.Point2D.getNAN();a.x=b.getEndX()-e;a.y=b.getEndY()-d;const f=c.dotProduct(a),g=3*l.doubleEps()*c.dotProductAbs(a);return f>g?(a.x=b.getStartX()-e,a.y=b.getStartY()-d,b=c.dotProduct(a),c=3*l.doubleEps()*c.dotProductAbs(a),b<=c):!0}function Zh(a,b){const c=l.Point2D.getNAN();c.x=a.m_XEnd-a.m_XStart;c.y=a.m_YEnd-a.m_YStart;if(!Yh(a,
b,c,!1))return!1;c.negateThis();return Yh(a,b,c,!0)?!0:!1}function Vf(a){const b=a.m_XStart-a.m_XEnd;a=a.m_YStart-a.m_YEnd;return b*b+a*a}function Yl(a,b,c){var d=a.m_XEnd-a.m_XStart,e=a.m_YEnd-a.m_YStart,f=b.m_XEnd-b.m_XStart,g=b.m_YEnd-b.m_YStart,h=f*e-d*g;if(0===h)return l.Point2D.getNAN();var k=4*l.doubleEps()*(Math.abs(f*e)+Math.abs(d*g));const m=b.m_XStart-a.m_XStart,n=b.m_YStart-a.m_YStart;var q=f*n-m*g;const r=4*l.doubleEps()*(Math.abs(f*n)+Math.abs(m*g));f=q/h;g=Math.abs(h);q=(r*g+k*Math.abs(q))/
(h*h)+l.doubleEps()*Math.abs(f);if(f<-q||f>1+q)return l.Point2D.getNAN();q=d*n-m*e;e=4*l.doubleEps()*(Math.abs(d*n)+Math.abs(m*e));d=q/h;h=(e*g+k*Math.abs(q))/(h*h)+l.doubleEps()*Math.abs(d);if(d<-h||d>1+h)return l.Point2D.getNAN();h=l.snap(f,0,1);k=l.snap(d,0,1);f=l.Point2D.getNAN();sb(a,h,f);d=l.Point2D.getNAN();sb(b,k,d);if(!c||l.Point2D.distance(f,d)>c)if(k=l.Point2D.getNAN(),l.lerpPoint2D(f,d,.5,k),h=a.getClosestCoordinate(k,!1),k=b.getClosestCoordinate(k,!1),f=l.Point2D.getNAN(),sb(a,h,f),d=
l.Point2D.getNAN(),sb(b,k,d),f.subThis(d),f=f.length(),a=(a.absNorm()+b.absNorm())*l.geomEpsFactor(),f>Math.max(c,a))return l.Point2D.getNAN();return new l.Point2D(h,k)}function Fe(a){return a.isEmpty()||a.getGeometryType()!==p.GeometryType.enumPolyline&&a.getGeometryType()!==p.GeometryType.enumPolygon||20>a.getPointCount()?!1:!0}function $h(a){return a.isEmpty()||a.getGeometryType()!==p.GeometryType.enumPolyline&&a.getGeometryType()!==p.GeometryType.enumPolygon||20>a.getPointCount()?!1:!0}function Wf(a){a=
a.getGeometryType();if(a===p.GeometryType.enumEllipticArc)return 10;if(a===p.GeometryType.enumBezier)return 4;if(a===p.GeometryType.enumRationalBezier2)return 5;if(a===p.GeometryType.enumBezier2)return 2;p.throwInternalErrorException("")}function Ob(a){a&=31;return 4===a?10:2===a?4:8===a?5:16===a?2:0}function qc(a,b,c,d){const e=4*l.doubleEps()*(Math.abs(b.vmin)+Math.abs(b.vmax)),f=l.doubleEps();if(1===a.getMaxDerivative())return p.geometryReleaseAssert(0<c),a=ai(a,0,b,l.doubleEps(),e),d[0]=a.root,
a.cRoots;let g=[];var h=new l.Envelope1D(b.vmin-e,b.vmax+e);g.push(new l.Point2D(h.vmin,h.vmax));let k=0;for(let z=a.getMaxDerivative()-1;0<=z;z--){h=g;g=[];for(let A=0,C=h.length;A<C;A++){if(h[A][0]<h[A][1]){var m=void 0,n=void 0;if(z===a.getMaxDerivative()-1)({root:m,cRoots:n}=ai(a,z,l.Envelope1D.construct(h[A][0],h[A][1]),f,.5*e));else{a:{m=a;n=z;var q=l.Envelope1D.construct(h[A][0],h[A][1]),r=.5*e;const B={root:0,funcAtRoot:0,cRoots:0};let E=q.vmin;var t=m.getValue(n,E);q=q.vmax;var u=m.getValue(n,
q);if(0<=t&&0<=u||0>=t&&0>=u){Math.abs(t)<Math.abs(u)?(B.funcAtRoot=t,B.root=E,B.cRoots=0===t?1:0):(B.funcAtRoot=u,B.root=q,B.cRoots=0===u?1:0);m=B;break a}0>u&&(u=l.swap(t,t=u),q=l.swap(E,E=q));let G=.5*(E+q),I=Math.abs(q-E);var v=I;let H=m.getValue(n,G);var w=m.getValue(n+1,G);let L=4,M=1,N=0,Q=0,O=1,P=0;for(;100>++P;){32<P||0===w||2===O&&1<N||1===O&&4>L?(O=1,1<M&&M--):(O=2,1<Q&&Math.abs(2*H)>Math.abs(I*w)&&M++);I=v;u=!1;if(1===O){do{if(2<Q&&(v=16*Math.abs(I),.5*Math.abs(E-q)>v)){w=Math.min(E,q);
var x=Math.max(E,q);if(G===w){t=G;G=w+v;v=G-t;break}else if(G===x){t=G;G=x-v;v=G-t;break}}v=.5*(q-E);t=G;G=E+v;u=E===G||q===G}while(0)}else for(;;){v=M*H/w;t=G;G-=v;u=G===t;x=Math.min(E,q);var y=Math.max(E,q);if(G<x){if(1<M){G=t;M--;continue}v=t-x;G=x}else if(G>y){if(1<M){G=t;M--;continue}v=t-y;G=y}break}if(u||Math.abs(v)<r){t!==G&&(H=m.getValue(n,G));break}H=m.getValue(n,G);w=m.getValue(n+1,G);x=E;y=q;0>H?(t=H,E=G):(u=H,q=G);2===O&&(E===x&&q===y||1<Q&&Math.abs(v)>=.5001*Math.abs(I))?N++:N=0;1===
O?(L++,Q=0):(L=0,Q++)}100===P&&p.throwInternalErrorException("Root_finder iterations exceeded");B.root=G;B.funcAtRoot=H;B.cRoots=1;m=B}({root:m,cRoots:n}=m)}if(1===n){0===z?k<c&&(h[A][0]<=b.vmin&&h[A][1]>=b.vmin&&m!==b.vmin&&0===a.getValue(0,b.vmin)&&(m=b.vmin),h[A][0]<=b.vmax&&h[A][1]>=b.vmax&&m!==b.vmax&&0===a.getValue(0,b.vmax)&&(m=b.vmax),d[k]=b.snapClip(m),0<k?d[k]-d[k-1]>e&&k++:k++):(n=l.Point2D.getNAN(),n[0]=h[A][0],n[1]=m,g.push(n),n=l.Point2D.getNAN(),n[0]=m,n[1]=h[A][1],g.push(n));continue}}g.push(h[A])}}return k}
function Ac(a,b,c,d,e,f){const g=l.makeObjectArray(l.ECoordinate,2);a=tb(new l.ECoordinate(a),new l.ECoordinate(b),new l.ECoordinate(c),d,e,g);f[0]=g[0].value();f[1]=g[1].value();return a}function bi(a,b,c,d,e,f,g){const h=l.makeObjectArray(l.ECoordinate,3);a=Ge(new l.ECoordinate(a),new l.ECoordinate(b),new l.ECoordinate(c),new l.ECoordinate(d),e,f,h);g[0]=h[0].value();g[1]=h[1].value();g[2]=h[2].value();return a}function ci(a,b,c,d,e,f,g,h){g=Array(c*c);g.fill(0);l.memcpy(h,d,0,0,c);d=Array(c);const k=
Array(c),m=Array(c);let n=a(h,c,b),q=0;for(q=0;100>q;q++){const w=n;for(var r=0;r<c;++r)k[r]=h[r];if(0===q%c)for(g.fill(0),r=0;r<c;r++)g[r*c+r]=1;var t=0;r=0;for(var u=0;u<c;++u){for(var v=0;v<c;++v)d[v]=g[u*c+v];v=n;n=di(a,b,h,d,e,f,c);v-=n;v>t&&(r=u,t=v)}for(u=0;u<c;u++)d[u]=h[u]-k[u],m[u]=h[u]+(h[u]-k[u]);v=a(m,c,b);if(v<w&&(u=2*(w-2*n+v)*l.sqr(w-n-t),t*=l.sqr(w-v),u<t))for(n=di(a,b,h,d,e,f,c),t=0;t<c;++t)g[r*c+t]=g[(c-1)*c+t],g[(c-1)*c+t]=d[t];if(w<=n)return a(h,c,b)}return n}function ai(a,b,
c,d,e){const f={root:0,funcAtRoot:0,cRoots:0};let g=c.vmin;c=c.vmax;let h=0;var k=Number.MAX_VALUE;let m=a.getValue(b,g),n=a.getValue(b,c);var q=0;let r=0;var t=0;if(0<=m&&0<=n||0>=m&&0>=n)return Math.abs(m)<Math.abs(n)?(f.funcAtRoot=m,f.root=g,f.cRoots=0===m?1:0):(f.funcAtRoot=n,f.root=c,f.cRoots=0===n?1:0),f;Math.abs(m)<Math.abs(n)&&(c=l.swap(g,g=c),n=l.swap(m,m=n));h=g;q=m;var u=!0;let v=0;for(;0!==n&&Math.abs(g-c)>d*Math.abs(c)+e;v++){var w=64<v;w||(r=m!==q&&n!==q?g*n*q/((m-n)*(m-q))+c*m*q/((n-
m)*(n-q))+h*m*n/((q-m)*(q-n)):c-n*(c-g)/(n-m),t=(3*g+c)/4,w=!(r>t&&r<c||r>c&&r<t),w||(t=d*Math.abs(c)+e,u?(u=Math.abs(c-h),w=Math.abs(r-c)>=.5*u||u<t):(u=Math.abs(h-k),w=Math.abs(r-c)>=.5*u||u<t)));w?(r=(g+c)/2,u=!0):u=!1;t=a.getValue(b,r);if(0===t)return f.root=r,f.funcAtRoot=t,f.cRoots=1,f;if(!w)if(k=g-r,q=r-c,Math.abs(k)>10*Math.abs(q))for(k=c+3*q,q=0;2>q;q++)w=a.getValue(b,k),0<l.sign(m)*l.sign(w)?(g=k,m=w):k=l.lerp(g,c,.75);else if(Math.abs(q)>10*Math.abs(k))for(k=g-3*k,q=0;2>q;++q)w=a.getValue(b,
k),0<l.sign(n)*l.sign(w)?(c=k,n=w):k=l.lerp(g,c,.25);k=h;h=c;q=n;0>l.sign(m)*l.sign(t)?(c=r,n=t):(g=r,m=t);Math.abs(m)<Math.abs(n)&&(c=l.swap(g,g=c),n=l.swap(m,m=n));128===v&&p.throwInternalErrorException("Root_finder iterations exceeded")}f.root=c;f.funcAtRoot=n;f.cRoots=1;return f}function di(a,b,c,d,e,f,g){function h(v,w){for(let x=0,y=g;x<y;x++)t[x]=c[x]+v*u[x];return a(t,g,b)}const k=d.slice(0,g);var m=0;for(var n=0;n<g;n++)m+=d[n]*d[n];m=Math.sqrt(m);if(0<m)for(d=0;d<g;d++)k[d]/=m;m=Number.NEGATIVE_INFINITY;
d=Number.POSITIVE_INFINITY;n=Array(g);for(var q=0;q<g;q++)n[q]=q;n.sort((v,w)=>{v=Math.abs(k[v]);w=Math.abs(k[w]);return v<w?-1:v>w?1:0});for(q=0;q<g;q++){var r=n[q];if(0===k[r])continue;let v=(e[r]-c[r])/k[r];r=(f[r]-c[r])/k[r];r<v&&(r=l.swap(v,v=r));v>m&&(m=v);r<d&&(d=r)}n=0;q=(Math.abs(m)+Math.abs(d))*l.doubleEps()*100;const t=Array(g),u=k.slice();0<q&&(n=Zl(h,null,m,0,d,q));m=h(n);for(let v=0,w=g;v<w;v++)c[v]=l.snap(t[v],e[v],f[v]);return m}function Zl(a,b,c,d,e,f){const g=l.goldenRatio();let h=
a(d,b);var k=a(c,b),m=a(e,b);h>k&&(h=k,d=c);h>m&&(h=m,d=e);let n=c,q=e,r=k,t=m;r>t&&(r=l.swap(t,t=r),q=l.swap(n,n=q));let u=d-n,v=n-q;f=.5*Math.min(f,e-c);const w=2*f;let x=0,y;for(y=0;100>y&&!(e-c<=w);++y){k=c+.5*(e-c);m=0<x;!m&&Math.abs(v)<=f&&(m=!0,x=3);if(!m){var z=d-n;const B=d-q;var A=z*(h-t),C=B*(h-r);z=B*C-z*A;C=2*(C-A);0<C&&(z=-z);C=Math.abs(C);0===C||Math.abs(z)>=Math.abs(C*v/2)||z<=C*(c-d)||z>=C*(e-d)?(m=!0,x=3):(v=u,u=z/C)}m&&(v=d>=k?c-d:e-d,u=g*v,x--);A=d+u;A<c+f?A=c+f:A>e-f&&(A=e-f);
C=a(A,b);if(C<h)A>=d?(c=d,k=h):(e=d,m=h),q=n,n=d,d=A,t=r,r=h,h=C;else if(A<d?(c=A,k=C):(e=A,m=C),C<=r||n===d)q=n,n=A,t=r,r=C;else if(C<=t||q===d||q===n)q=A,t=C}return d}function Sd(a,b,c,d){if(a.isZero())return b.isZero()?-1:0;d.setE(b.clone().negateThis().divThisE(a));return c.containsCoordinate(d.value())?1:0}function tb(a,b,c,d,e,f){if(0===a.value())return e?(f[0].set(1),d.containsCoordinate(f[0].value())?1:0):Sd(b,c,d,f[0]);if(e)return b=2,f[0].set(1),f[1].setE(c).divThisE(a),f[1].eq(f[0])&&(f[1].set(1),
b=1),d.containsCoordinate(f[1].value())||(b=1),d.containsCoordinate(f[0].value())||(b--,f[0].setE(f[1])),2===b&&f[0].value()>f[1].value()&&(f[1]=l.swap(f[0],f[0]=f[1])),b;e=b.clone().sqrThis().subThisE(a.clone().mulThisE(c).mulThisE(l.s_four));if(e.lt(l.s_zero))return 0;var g=new l.ECoordinate(0<=b.value()?1:-1);e=e.clone().sqrtThis();const h=(new l.ECoordinate(-.5)).mulThisE(b.clone().addThisE(g.clone().mulThisE(e)));g=0;f[0].setE(h.divE(a));const k=new l.ECoordinate(f[0].value()),m=(new l.ECoordinate(a.value())).mulE(k).addE((new l.ECoordinate(b.value())).mulE(k).addE(new l.ECoordinate(c.value())));
if(!m.isZero()){var n=f[0];Xf(0,0,f[0].value(),new ei(a,b,c),n,!0)}d.containsCoordinate(f[0].value())&&g++;0!==e.value()&&0!==h.value()&&(f[g].assign(c.divE(h)),k.set(f[g].value()),m.assign((new l.ECoordinate(a.value())).mulE(k).addE((new l.ECoordinate(b.value())).mulE(k).addE(new l.ECoordinate(c.value())))),m.isZero()||(e=f[g],Xf(0,0,f[g].value(),new ei(a,b,c),e,!0)),d.containsCoordinate(f[g].value())&&g++,2===g&&f[0].value()>f[1].value()&&(f[1]=l.swap(f[0],f[0]=f[1])));return g}function Ge(a,b,
c,d,e,f,g){if(0===a.value())return tb(b,c,d,e,f,g);if(f){c=1;g[0].set(1);f=g.slice(c);a=tb(a,b.addE(a),d.negate(),e,!1,f);if(0<a)for(c+=a,a=1;a<c;a++)g[a].eq(l.s_one)&&(g[c-1]=l.swap(g[a],g[a]=g[c-1]),c--);a=g.slice(0,c);a.sort((h,k)=>h.value()<k.value()?-1:h.value()>k.value()?1:0);for(b=0;b<c;++b)g[b]=a[b];return c}return $l(a,b,c,d,e,g)}function fi(a,b,c,d,e,f){(f<b||0>b)&&p.throwInvalidArgumentException("nth_degree_real_roots");a:{f=new am(a,b,c,l.doubleEps());let g=0;if(2===f.truePower)g=tb(a[2],
a[1],a[0],c,d,e);else if(1===f.truePower)g=Sd(a[1],a[0],c,e[0]);else if(0===f.truePower){e=a[0].value()?0:-1;break a}else for(a=[],a.length=b,g=qc(f,c,b,a),b=0;b<g;b++)e[b].set(a[b]);for(b=0;b<g;b++)e[b].setError(f.getError(e[b].value()));e=g}return e}function Yf(a,b,c,d){return{coef0:a.clone(),coef1:b.clone(),coef2:c.clone(),coef3:d.clone(),calcF(e){return this.coef0.clone().mulThis(e).addThisE(this.coef1).mulThis(e).addThisE(this.coef2).mulThis(e).addThisE(this.coef3)},calcDF(e){return this.coef0.clone().mulThis(3).mulThis(e).addThisE(this.coef1.clone().mulThisByPower2(2)).mulThis(e).addThisE(this.coef2)},
estimateError(e){var f=Math.abs(e);f=((this.coef0.eps()*f+this.coef1.eps())*f+this.coef2.eps())*f+this.coef3.eps()+this.calcF(e).eps();const g=this.coef0.clone().mulThis(e).mulThis(3).addThisE(this.coef1.clone().mulThis(2)).mulThis(e).addThisE(this.coef2);return g.isZero()?(e=this.coef0.clone().mulThis(e).mulThis(6).addThisE(this.coef1.clone().mulThis(2)),e.isZero()?(e=this.coef0.clone().mulThis(6),Math.pow(6*f/Math.abs(e.value()),1/3)):Math.sqrt(2*f/Math.abs(e.value()))):f/Math.abs(g.value())}}}
function Xf(a,b,c,d,e,f){let g=a,h=b,k=h-g;if(!f){a=d.calcF(a).value();b=d.calcF(b).value();if(0<a||a>b)h=l.swap(g,g=h),b=l.swap(a,a=b);if(0<=a||0>=b)return!1}b=!1;a=c;for(c=0;100>c;c++){const n=d.calcF(a);var m=d.calcDF(a);if(m.isZero())return!1;if(!n.value()||3<c&&n.isZero()){b=!0;break}f||(0>n.value()?g=a:h=a);m=n.value()/m.value();a-=m;f||(a>=g&&a<=h||a>=h&&a<=g)&&Math.abs(m)<=.5*k?k=Math.abs(m):(k=Math.abs(.5*(h-g)),a=.5*(g+h))}if(!b)return!1;e.set(a,d.estimateError(a));return!0}function bm(a,
b,c,d,e,f,g,h){return Xf(a,b,c.value(),Yf(d,e,f,g),h,!1)}function $l(a,b,c,d,e,f){var g=l.makeObjectArray(l.ECoordinate,3),h=0,k=b.negate().divThisE(a.clone().mulThis(3));e.containsCoordinate(k.value())&&(g[0].setE(k),h=1);k=l.makeObjectArray(l.ECoordinate,2);var m=tb(a.mul(3),b.mul(2),c,e,!1,k);if(0>m)return d.isZero()?-1:0;for(var n=0;n<m;n++)e.containsCoordinate(k[n].value())&&g[h++].setE(k[n]);l.sortRange(g,0,h,(r,t)=>r.value()<t.value()?-1:r.value()>t.value()?1:0);k=l.makeObjectArray(l.ECoordinate,
5);k[0].set(e.vmin);for(m=0;m<h;m++)k[1+m].setE(g[m]);k[1+h].set(e.vmax);g=h+2;m=1;h=0;n=k[0].clone();if(a.clone().mulThisE(n).addThisE(b).mulThisE(n).addThisE(c).mulThisE(n).addThisE(d).isZero()){var q=Yf(a,b,c,d);n.setError(q.estimateError(n.value()));f[h]=n;h++;m++}for(;m<g;m++)if(n=k[m].clone(),(q=a.clone().mulThisE(n).addThisE(b).mulThisE(n).addThisE(c).mulThisE(n).addThisE(d).isZero())||!k[m].eq(k[m-1])){if(q||bm(k[m-1].value(),k[m].value(),k[m-1].clone().addThisE(k[m]).divThisByPower2(2),a,
b,c,d,n)){if(0<h&&n.eq(f[h-1]))continue;3<=h&&p.throwInternalErrorException("cubic_polynomial_solver_too_many_roots");if(q){const r=Yf(a,b,c,d);n.setError(r.estimateError(n.value()))}f[h]=n;h++}if(k[m].value()===e.vmax)break;q&&m++}return h}function hd(a,b,c,d,e,f,g,h,k,m,n,q,r,t,u,v,w,x=!1){var y=new gb,z=new gb,A=new ja,C=new ja,B=new ja,E=new ja,G=new gb,I=new gb,H=new gb,L=new gb,M=new gb,N=new gb,Q=new ja,O=null,P=new gb,ia=new gb,ka=new gb;new gb;var Aa=new gb,J=new ja,V=new ja,ha=new ja;A.construct(g,
h);C.construct(k,m);G.constructFromMPValues(a,b);I.constructFromMPValues(c,d);P.assignCopy(G);ia.assignCopy(I);n&&(Q.construct(n,q),P.mulElementThis(Q),ia.mulElementThis(Q));e?(M.constructFromMPValues(e,f),N=new gb({copy:M}),N.derivative1This(),ka.assignCopy(M),ka.mulElementThis(A),P.subThis(ka),ka.assignCopy(M),ka.mulElementThis(C),ia.subThis(ka)):(P.sub0This(A),ia.sub0This(C));H.assignCopy(G);H.derivative1This();L.assignCopy(I);L.derivative1This();e&&(H.mulThis(M),Aa.assignCopy(N),Aa.mulThis(G),
H.subThis(Aa),L.mulThis(M),Aa.assignCopy(N),Aa.mulThis(I),L.subThis(Aa));B.assignCopy(A);B.derivative1This();E.assignCopy(C);E.derivative1This();n&&(p.geometryReleaseAssert(null===O),O=new ja({copy:Q}),O.derivative1This(),B.mulThis(Q),V.assignCopy(O),V.mulThis(A),B.subThis(V),E.mulThis(Q),V.assignCopy(O),V.mulThis(C),E.subThis(V));y.assignCopy(P);y.mulElementThis(B);ka.assignCopy(ia);ka.mulElementThis(E);y.addThis(ka);z.assignCopy(H);z.mulElementThis(E);ka.assignCopy(L);ka.mulElementThis(B);z.subThis(ka);
a=[];b=[];w||=[];v||=[];Zf(P,ia,J);c=57;d=.25*Number.EPSILON;f=[];e=Bc(J,r,u,d,c,f);if(0>e)return-1;for(g=0;g<e;g++)if(ja.evaluateCoefs(P,l.MPValue.constructDouble(f[g]),V),h=[],k=Bc(V,r,t,d,c,h),0!==k)if(ja.evaluateCoefs(ia,l.MPValue.constructDouble(f[g]),ha),0>k)for(k=Bc(ha,r,t,d,c,h),0>k&&p.throwInternalErrorException("mp_curve_proximity"),m=0;m<k;m++)b.push(l.makePair(h[m],f[g]));else for(m=ha.absEvaluate(l.s_one$1),m.mulThis(l.MPValue.constructDouble(1E-12)),n=0;n<k;n++)q=ha.evaluate(l.MPValue.constructDouble(h[n])),
q.absThis(),q.lt(m)&&b.push(l.makePair(h[n],f[g]));e=b.length;Zf(y,z,J);c=57;d=.25*Number.EPSILON;P=[];u=Bc(J,r,u,d,c,P);0>u&&(u=0);for(J=0;J<u;J++)if(ja.evaluateCoefs(y,l.MPValue.constructDouble(P[J]),V),ia=[],f=Bc(V,r,t,d,c,ia),0!==f)if(ja.evaluateCoefs(z,l.MPValue.constructDouble(P[J]),ha),0>f){if(f=Bc(ha,r,t,d,c,ia),!(0>f))for(g=0;g<f;g++)a.push(l.makePair(ia[g],P[J]))}else for(g=ha.absEvaluate(l.s_one$1),g.mulThis(l.MPValue.constructDouble(1E-12)),h=0;h<f;h++)k=ha.evaluate(l.MPValue.constructDouble(ia[h])),
k.absThis(),k.lt(g)&&a.push(l.makePair(ia[h],P[J]));u=a.length;if(0===e&&0===u)return 0;a=a.concat(b);a.sort((ea,da)=>x?l.standardNumericCompare(ea.second,da.second):l.standardNumericCompare(ea.first,da.first));r=l.unique(a,(ea,da)=>ea.first===da.first&&ea.second===da.second);a=a.slice(0,r);v.length=0;w.length=0;for(const ea of a)v.push(ea.first),w.push(ea.second);p.geometryReleaseAssert(v.length===w.length);return w.length}function gi(a,b,c,d,e,f,g,h,k,m,n){var q=new ja,r=new ja,t=new ja,u=new ja,
v=new ja;new ja;new ja;e=new ja;var w=new ja;new ja;f=new gb;m=new gb;r.construct(a,b);t.construct(c,d);u.assignCopy(r);u.derivative1This();v.assignCopy(t);v.derivative1This();q.assignCopy(r);q.mulThis(r);q.mulElementThis(g[0]);e.assignCopy(t);e.mulThis(t);e.mulElementThis(g[1]);q.addThis(e);q.add0(g[2]);const x=g[0].clone(),y=x.clone();y.sqrThis();const z=g[1].clone(),A=z.clone();A.sqrThis();g=g[2].clone();const C=x.clone();C.subThis(z);r.construct(a,b);u.assignCopy(r);u.derivative1This();t.construct(c,
d);v.assignCopy(t);v.derivative1This();e.assignCopy(r);e.mulThis(r);e.mulElementThis(A);e.mulElementThis(g);f.construct0(e);e.assignCopy(r);e.mulThis(z.mul(C).mul(g).ldexpThis(1));f.addElement(e);e.assignCopy(r);e.mulThis(r);e.mulElementThis(x.mul(A));w.assignCopy(t);w.mulThis(t);w.mulElementThis(y.mul(z));e.addThis(w);e.add0(C.mul(C).mul(g));f.addElement(e);e.assignCopy(r);e.mulElementThis(C.mul(x).mul(z).ldexpThis(1));f.addElement(e);e.construct0(x.mul(C).mul(C));f.addElement(e);f.updatePower();
e.construct0(l.s_zero$1);m.construct0(e);e.assignCopy(r);e.mulThis(u);w.assignCopy(t);w.mulThis(v);e.addThis(w);e.mulElementThis(x.mul(z));m.addElement(e);e.assignCopy(u);e.mulElementThis(C.mul(x));m.addElement(e);m.updatePower();a=[];b=[];n||=[];c=2*q.power()+58;d=.5*Number.EPSILON;q=Bc(q,h,k,d,c,b);if(0>q)return-1;Zf(f,m,e);c=2*e.power()+58;h=Bc(e,h,k,d,c,a);0>h&&(h=0);if(0===q&&0===h)return 0;h=a.concat(b);n.length=h.length;l.memcpy(n,h,0,0,h.length);l.numericSort(n);h=l.unique(n,(B,E)=>0===l.standardNumericCompare(B,
E));n.length=h;return n.length}function hi(a,b,c,d){if(a.isZero())return b.isZero()?-1:0;d.setThis(b);d.negateThis();d.divThis(a);return c.isEmpty()?1:c.containsCoordinate(d.value())?1:0}function Td(a,b,c,d,e,f,g){if(a.isZero())return f?(g[0].setInt32(1),e.containsCoordinate(1)?1:0):hi(b,c,e,g[0]);if(f)return d=2,g[0].setInt32(1),c.equals(a)?(g[1].setInt32(1),d=1):g[1].setThis(c.div(a)),e.containsCoordinate(g[1].value())||(d=1),e.containsCoordinate(g[0].value())||(d--,g[0].setThis(g[1])),2===d&&g[0].value()>
g[1].value()&&(g[1]=l.swap(g[0],g[0]=g[1])),d;f=b.clone();f.sqrThis();var h=a.clone();h.mulThis(c).ldexpThis(2).negateThis().addThis(f);if(h.LZ())return 0;f=d+2;h=l.MPValue.sqrt(h,f);const k=h.clone();b.LZ()&&k.negateThis();k.addThis(b).limitPrecisionThis(f).ldexpThis(-1).negateThis();b=0;g[0].setThis(k).divThis(l.MPValue.constructAssign(a,f)).limitPrecisionThis(d);(e.isEmpty()||e.containsCoordinate(g[0].value()))&&b++;h.isZero()||k.isZero()||(g[b].setThis(c).divThis(k).limitPrecisionThis(d),(e.isEmpty()||
e.containsCoordinate(g[b].value()))&&b++,2===b&&g[0].gt(g[1])&&(g[1]=l.swap(g[0],g[0]=g[1])));return b}function Ud(a,b,c,d,e,f,g,h){if(a.isZero())return Td(b,c,d,e,f,g,h);var k=(r,t)=>{if(0<r){r=t+r;for(t=1;t<r;t++)h[t].equals(h[0])&&(h[r-1]=l.swap(h[t],h[t]=h[r-1]),r--);t=r}l.sortRange(h,0,t,(u,v)=>u.compare(v));return t};if(d.isZero())return d=0,f.containsCoordinate(0)&&(h[0].setInt32(0),d=1),e=Td(a,b,c,e,f,g,h.slice(1)),k(e,d);if(g)return c=0,f.containsCoordinate(1)&&(h[0].setInt32(1),c=1),b=b.add(a),
d=d.negate(),g=a.add(b).add(d).isZero(),e=Td(a,b,d,e,f,g,h.slice(c)),k(e,c);var m=new l.MPValue,n=new l.MPValue;g=new l.MPValue;k=b.clone();if(k.isZero())n.setThis(c),n.divThis(a),g.setThis(d),n.divThis(a);else{k.divThis(a).divDoubleThis(3).negateThis();var q=b.clone();q.sqrThis();const r=a.clone();r.sqrThis();n.setThis(a);n.mulThis(c).mulDoubleThis(3).subThis(q).divThis(r).divDoubleThis(3);g.setThis(q);g.mulThis(b);g.ldexpThis(1);m.setThis(a);m.mulThis(b).mulThis(c).mulDoubleThis(9);g.subThis(m);
m.setThis(r);m.mulThis(d).mulDoubleThis(27);g.addThis(m);g.divThis(r).divThis(a).divDoubleThis(27)}if(n.isZero()){a=g.clone();a.negateThis();if(a.isZero())return h[0].setThis(k),Vd(f,e,h,1);h[0].setThis(l.MPValue.cubicRoot(g,e).add(k));return Vd(f,e,h,1)}q=g.clone();q.sqrThis().ldexpThis(-2);m.setThis(n.clone());m.sqrThis().mulThis(n).divDoubleThis(27);q.addThis(m);if(q.isZero())return h[0].setThis(g),h[0].mulDoubleThis(3).divThis(n),h[1].setThis(h[0]),h[1].negateThis(),h[1].ldexpThis(-1),h[0].addThis(k),
h[1].addThis(k),Vd(f,e,h,2);if(q.GZ())return q.setThis(l.MPValue.sqrt(q,e+8)),m.setThis(g),m.ldexpThis(-1).negateThis(),m.addThis(q),h[0].setThis(l.MPValue.cubicRoot(m,e+8)),m.setThis(g),m.ldexpThis(-1).negateThis(),m.subThis(q),h[0].addThis(l.MPValue.cubicRoot(m,e+8)),h[0].addThis(k),Vd(f,e,h,1);m.setThis(n);m.divDoubleThis(3).negateThis();p.geometryReleaseAssert(m.GEZ());g=l.MPValue.sqrt(m,e+8);m=g.clone();m.negateThis();m.addThis(k);g.addThis(k);n=l.MPValue.constructDouble(f.isEmpty()?-Number.MAX_VALUE:
f.vmin);q=l.MPValue.constructDouble(f.isEmpty()?Number.MAX_VALUE:f.vmax);k=new ja({zeroCtor:l.MPValue});k.construct0(d);k.addElement(c);k.addElement(b);k.addElement(a);a=new ja({copy:k});a.derivative1This();b=0;d=l.makeObjectArray(l.MPValue,4);d[b++].setThis(n);m.gt(n)&&m.lt(q)&&d[b++].setThis(m);g.gt(n)&&g.lt(q)&&d[b++].setThis(g);d[b++].setThis(q);c=3*e;g=52;for(m=Number.EPSILON;g<c;)2*g<=c?(m*=m,g*=2):(m*=Number.EPSILON,g+=52);g+=2;c=0;n=!1;for(q=1;q<b;q++)if($f(k,a,d[q-1],d[q],m,g,h[0])){c=1;
n=q+1<b;break}if(!c)return 0;n&&(a=new ja({zeroCtor:l.MPValue,coef0:h[0]}),a.negateThis(),a.addElement(l.s_one$1),b=new ja({zeroCtor:l.MPValue}),d=new ja({zeroCtor:l.MPValue}),k.div(a,b,d),p.geometryReleaseAssert(2===b.power()),p.geometryReleaseAssert(0===d.power()),a=Td(b.getElement(2),b.getElement(1),b.getElement(0),e,f,!1,h.slice(1)),p.geometryReleaseAssert(0<=a&&2>=a),c+=a);return Vd(f,e,h,c)}function ii(a,b,c,d,e,f,g,h,k){if(a.isZero())return Ud(b,c,d,e,f,g,h,k);var m=(n,q)=>{if(0<n){n=q+n;for(q=
1;q<n;q++)k[q].equals(k[0])&&(k[n-1]=l.swap(k[q],k[q]=k[n-1]),n--);q=n}l.sortRange(k,0,q,(r,t)=>r.compare(t));return q};if(e.isZero())return e=0,g.containsCoordinate(0)&&(k[0].setInt32(0),e=1),g=Ud(a,b,c,d,f,g,h,k.slice(e)),m(g,e);e=new ja({zeroCtor:l.MPValue,coef0:e});e.addElement(d);e.addElement(c);e.addElement(b);e.addElement(a);if(h)return h=0,g.containsCoordinate(1)&&(k[0].setInt32(1),h=1),b=new ja({zeroCtor:l.MPValue,coef0:l.MPValue.constructInt32(-1)}),b.addElement(l.MPValue.constructInt32(1)),
a=new ja({zeroCtor:l.MPValue}),c=new ja({zeroCtor:l.MPValue}),e.div(b,a,c),e=3===a.power()?a.getElement(3):l.s_zero$1.clone(),b=2<=a.power()?a.getElement(2):l.s_zero$1.clone(),c=1<=a.power()?a.getElement(1):l.s_zero$1.clone(),d=a.getElement(0),a=a.evaluate(l.s_one$1).isZero(),g=Ud(e,b,c,d,f,g,a,k.slice(h)),m(g,h);if(e.getElement(0).isZero()){m=0;g.containsCoordinate(0)&&(m=1,k[0].setDouble(0));for(;e.getElement(0).isZero()&&0<e.power();)e.shiftRight(1);h=3===e.power()?e.getElement(3):l.s_zero$1.clone();
a=2<=e.power()?e.getElement(2):l.s_zero$1.clone();b=1<=e.power()?e.getElement(1):l.s_zero$1.clone();e=e.getElement(0);g=Ud(h,a,b,e,f,g,!1,k.slice(m));0<g&&(m+=g);l.sortRange(k,0,m,(n,q)=>n.compare(q));return m}m=52;for(a=Number.EPSILON;m<f;)2*m<=f?(a*=a,m*=2):(a*=Number.EPSILON,m+=52);m+=2;f=ji(e);b=l.MPValue.constructDouble(Math.max(Math.abs(g.vmax),Math.abs(g.vmin)));a=(f.lt(b)?f:b).mul(l.MPValue.constructDouble(a)).toDouble();return ki(e,g,a,m,h,!1,k,4)}function ag(a){let b=0;for(;b<a.power()&&
a.getElement(b).isZero();)b++;return 0<b?(a.shiftRight(b),!0):!1}function Zf(a,b,c){a=a.clone();b=b.clone();ag(a);for(ag(b);0!==a.power()||0!==b.power();){let e=a,f=b;f.power()>e.power()&&(f=l.swap(e,e=f));const g=e.power()-f.power(),h=new ja({copy:e.getElement(e.power())});e.mulThis(f.getElement(f.power()));for(let k=0,m=e.power();k<m;k++)if(k>=g){var d=new ja({copy:f.getElement(k-g)});d.mulThis(h);d=e.getElement(k).sub(d);e.setElement(k,d)}e.setElement(e.power(),e.getElement(e.power()).setZero());
e.updatePower();ag(e)}c.assignMove(a.getElement(0))}function Bc(a,b,c,d,e,f){f.length=0;b=a.power();b=l.makeObjectArray(l.MPValue,2*b+4);c=c?c:l.Envelope1D.unit();var g=b.length;if(0===a.power())e=a.isZero()?-1:0;else{var h=a.evaluate(l.MPValue.constructInt32(1)).isZero();1===a.power()?(d=a.getElement(1),a=a.getElement(0),a=hi(d,a,c,b.at(0)),b[0].limitPrecisionThis(e),1!==a?e=0:(b[0].limitPrecisionThis(e),e=1)):e=2===a.power()?Td(a.getElement(2),a.getElement(1),a.getElement(0),e,c,h,b):3===a.power()?
Ud(a.getElement(3),a.getElement(2),a.getElement(1),a.getElement(0),e,c,h,b):4===a.power()?ii(a.getElement(4),a.getElement(3),a.getElement(2),a.getElement(1),a.getElement(0),e,c,h,b):ki(a,c,d,e,h,!1,b,g)}if(0<e){f.length=0;for(a=0;a<e;a++)d=b[a].value(),0<a&&d<=f.at(-1)||f.push(d);return f.length}return e}function li(a,b,c){p.geometryReleaseAssert(1<=c);if(0===a.power())return a.isZero()?-1:0;c=a.getElement(0);c.negateThis();c.divThis(a.getElement(1));b[0].setThis(c);return 1}function cm(a,b,c,d){if(2>
a.power())return li(a,c,d);p.geometryReleaseAssert(1<=d);var e=a.getElement(1);e.mulThis(a.getElement(1));var f=a.getElement(0);f.mulThis(a.getElement(2));f.ldexpThis(2);e.subThis(f);if(e.LZ())return 0;if(e.isZero())return e=a.getElement(1),e.negateThis(),e.divThis(a.getElement(2)),e.ldexpThis(-1),e.limitPrecisionThis(b),c[0].setThis(e),1;p.geometryReleaseAssert(2<=d);e=l.MPValue.sqrt(e,b+8);f=a.getElement(1);f.negateThis();d=f.clone();d.subThis(e);d.divThis(a.getElement(2));d.ldexpThis(-1);d.limitPrecisionThis(b);
f=f.clone();f.addThis(e);f.divThis(a.getElement(2));f.ldexpThis(-1);f.limitPrecisionThis(b);d.lt(f)?(c[0].setThis(d),c[1].setThis(f)):(c[1].setThis(d),c[0].setThis(f));return 2}function $f(a,b,c,d,e,f,g){c=c.clone();d=d.clone();c.limitPrecisionThis(f);d.limitPrecisionThis(f);let h=a.evaluate(c);h.limitPrecisionThis(f+2);let k=a.evaluate(d);k.limitPrecisionThis(f+2);if(h.GEZ()&&k.GEZ()||h.LEZ()&&k.LEZ()){if(h.absLessAbs(k))return g=c,h.isZero();g=d;return k.isZero()}var m=k.LZ();m&&(k=l.swap(h,h=k),
d=l.swap(c,c=d));const n=m?d:c;m=m?c:d;const q=c.add(d).ldexpThis(-1);q.limitPrecisionThis(f);const r=d.sub(c);r.limitPrecisionThis(f);r.absThis();const t=r.clone();var u=a.evaluate(q);let v=b.evaluate(q);const w=new ja({copy:a}),x=new ja({copy:b});var y=Math.max(a.hiBitIndex(),b.hiBitIndex()),z=l.s_one$1.clone();z.ldexpThis(-(f+2));for(var A=64;A<y;){w.limitPrecisionThis(A);x.limitPrecisionThis(A);var C=w.evaluate(q),B=x.evaluate(q);C=C.sub(u);B=B.sub(v);if(C.divThis(u).absThis().lt(z)&&(v.isZero()||
B.divThis(v).absThis().lt(z)))break;w.assignCopy(a);x.assignCopy(b);A=Math.min(A+64,y)}u.limitPrecisionThis(f+2);v.limitPrecisionThis(f+2);a=4;b=1;z=y=0;A=1;e=l.MPValue.constructDouble(.25*e);B=l.MPValue.constructDouble(.5001);for(C=0;300>++C;){if(32<C&&0<y||v.isZero()||2===A&&1<y||1===A&&4>a)A=1,1<b&&b--;else if(A=2,1<z){var E=r.mul(v);E.absThis();E.ldexpThis(-3);E.absLessAbs(u)&&b++}r.setThis(t);E=new l.MPValue;var G=!1;if(1===A){do{if(2<z&&(u=r.clone(),u.absThis(),u.ldexpThis(4),m.sub(n).ldexpThis(-1).gt(u)))if(q.equals(n)){E.setThis(q);
q.setThis(n.add(u));q.limitPrecisionThis(f);t.setThis(q.sub(E));break}else if(q.equals(m)){E.setThis(q);q.setThis(m.sub(u));q.limitPrecisionThis(f);t.setThis(q.sub(E));break}t.setThis(d.sub(c));t.ldexpThis(-1);t.limitPrecisionThis(f);E.setThis(q);q.setThis(c.add(t));q.limitPrecisionThis(f);q.lt(n)?q.setThis(n):q.gt(m)&&q.setThis(m);G=c.equals(q)||d.equals(q)}while(0)}else for(;;){t.setThis(u.div(v));t.limitPrecisionThis(f);1!==b&&t.mulDoubleThis(b);E.setThis(q);q.subThis(t);q.limitPrecisionThis(f);
G=q.equals(E);if(q.lt(n)){if(1<b){q.setThis(E);b--;continue}t.setThis(E.sub(n));q.setThis(n)}else if(q.gt(m)){if(1<b){q.setThis(E);b--;continue}t.setThis(E.sub(m));q.setThis(m)}break}if(G||t.absLessAbs(e)){E.equals(q)||(u=w.evaluate(q),u.limitPrecisionThis(f+2));break}u=w.evaluate(q);u.limitPrecisionThis(f+2);v=x.evaluate(q);v.limitPrecisionThis(f+2);E=c.clone();G=d.clone();u.LZ()?(h.setThis(u),c.setThis(q)):(k.setThis(u),d.setThis(q));2===A&&(c.equals(E)&&d.equals(G)||1<z&&!t.absLessAbs(B.mul(r)))?
y++:y=0;1===A?(a++,z=0):(a=0,z++)}300<=C&&p.throwInternalErrorException("Root_finder iterations exceeded");g.setThis(q);return!0}function dm(a,b,c,d,e){b=a.evaluate(c);if(b.isZero())return!0;e=l.MPValue.constructDouble(.5*d);d=c.clone();d.subThis(e);d=a.evaluate(d);c=c.clone();c.addThis(e);a=a.evaluate(c);if(d.LZ()&&a.GZ()||d.GZ()&&a.LZ()||(b.GZ()?d.LEZ()||a.LEZ():d.GEZ()||a.GEZ()))return!0;c=d.LEZ()&&a.LEZ();e=d.GEZ()&&a.GEZ();let f=!1;c?b.gt(d)&&b.gt(a)&&(f=!0):e&&b.lt(d)&&b.lt(a)&&(f=!0);return f?
b.absThis().lt(l.MPValue.constructDouble(1E-17)):!1}function ki(a,b,c,d,e,f,g,h){p.geometryReleaseAssert(0<c);p.geometryReleaseAssert(h>=a.power());f=[];let k=[];const m=new ja({zeroCtor:a.m_zeroCtor});var n=new ja({zeroCtor:a.m_zeroCtor}),q=new ja({zeroCtor:a.m_zeroCtor}),r=l.MPValue.constructDouble(c);const t=l.MPValue.constructDouble(b.vmin);b=l.MPValue.constructDouble(b.vmax);const u=t.sub(r),v=b.add(r);var w=ji(a),x=w.clone();x.negateThis();if(u.lt(x))u.setThis(x.sub(r));else if(u.gt(w))return 0;
if(v.gt(w))v.setThis(w.add(r));else if(v.lt(x))return 0;w=a;x=null;if(e){var y=new ja({coef0:l.MPValue.constructInt32(-1)});y.addElement(l.s_one$1);w=x=new ja;var z=new ja,A=new ja;a.div(y,z,A);for(x.assignCopy(z);w.evaluate(l.s_one$1).isZero();)w.div(y,z,A),x.assignCopy(z)}a=!1;if(0<w.power()&&w.getElement(0).isZero())for(a=!0,x||(w=x=new ja({copy:w}));w.getElement(0).isZero();)x.shiftRight(1);x=d+2*w.power()+2;y=c/Math.pow(2,w.power()+2);z=x;if(l.s_zero$1.gt(u)&&l.s_zero$1.lt(v))for(let E=0,G=w.power();E<
G;E++)if(w.getElement(E).isZero()){f.push(l.s_zero$1.clone());break}for(A=w.power()-1;0<A;A--)if(y*=2,x-=2,z-=2,1===w.power()-A)n.assignMove(w.derivative(A)),1===li(n,g,h)&&(g[0].gt(u)&&g[0].lt(v)&&!g[0].isZero()&&f.push(g[0].clone()),m.assignMove(n),q.assignMove(w.derivative(A-1)));else if(2===w.power()-A){n.assignMove(w.derivative(A));var C=cm(n,x,g,h);p.geometryReleaseAssert(0<=C&&2>=C);for(var B=0;B<C;B++)g[B].gt(u)&&g[B].lt(v)&&!g[B].isZero()&&f.push(g[B].clone());1<f.length&&f.sort((E,G)=>E.compare(G));
0<f.length?(C=f[0].sub(r),C.limitPrecisionThis(z),k.push(l.makePair(u.clone(),C)),B=1===f.length?v.clone():f[1].sub(r),C=f[0].add(r),C.limitPrecisionThis(z),B.limitPrecisionThis(z),k.push(l.makePair(C,B)),1<f.length&&(B=2===f.length?v.clone():f[2].sub(r),B.limitPrecisionThis(z),C=f[1].add(r),C.limitPrecisionThis(z),k.push(l.makePair(C,B)),2<f.length&&(C=f[2].add(r),C.limitPrecisionThis(z),k.push(l.makePair(C,v.clone()))))):k.push(l.makePair(u.clone(),v.clone()));m.assignCopy(n);q.assignMove(w.derivative(A-
1))}else{n.assignMove(q);q.assignMove(w.derivative(A-1));C=[];for(let E=0,G=k.length;E<G;++E)if(k[E].first.lte(k[E].second))if(B=new l.MPValue,$f(n,m,k[E].first,k[E].second,y,x,B)){f.push(B);let I=B.sub(r);I.limitPrecisionThis(z);C.push(l.makePair(k[E].first,I));I=B.add(r);I.limitPrecisionThis(z);C.push(l.makePair(I,k[E].second))}else C.push(k[E]);k=C;C=[];m.assignMove(n)}f.sort((E,G)=>E.compare(G));0===k.length&&(m.assignMove(w.derivative(w.power())),m.isZero()||k.push(l.makePair(u.clone(),v.clone())));
q=n=h=0;for(r=new l.MPValue;;){if(n<k.length){if(k[n].first.gt(k[n].second)){n++;continue}x=!1;q<f.length&&f[q].lt(k[n].first)&&(x=!0);if(!x){$f(w,m,k[n].first,k[n].second,c,d,r)&&(r.lt(t)?g[h++].setThis(t):r.gt(b)?g[h++].setThis(b):g[h++].setThis(r));n++;continue}}if(q<f.length)0!==q&&f[q-1].equals(f[q])||!dm(w,m,f[q],c)||(r.setThis(f[q]),r.lt(t)?r.setThis(t):r.gt(b)&&r.setThis(b),0!==h&&g[h].equals(r)||g[h++].setThis(r)),q++;else break}a&&l.s_zero$1.gt(u)&&l.s_zero$1.lt(v)&&(g[h++].setThis(l.s_zero$1),
l.sortRange(g,0,h,(E,G)=>E.compare(G)));e&&l.s_one$1.gt(u)&&l.s_one$1.lt(v)&&(g[h++].setThis(l.s_one$1),l.sortRange(g,0,h,(E,G)=>E.compare(G)));return h}function ji(a){const b=a.getElement(a.power());b.limitPrecisionThis(53);const c=l.s_zero$1.clone();for(let d=0,e=a.power();d<e;d++){const f=a.getElement(d);f.limitPrecisionThis(53);f.divThis(b).absThis();f.gt(c)&&c.setThis(f)}c.addThis(l.s_one$1);c.mulThis(l.MPValue.constructDouble(1+100*Number.EPSILON));return c}function Vd(a,b,c,d){let e=d;if(!a.isEmpty()){e=
0;for(let f=0;f<d;++f)a.containsCoordinate(c[f].value())&&(e!==f&&c[e].setThis(c[f]),e++)}1<e&&(c[0].gt(c[1])&&(c[1]=l.swap(c[0],c[0]=c[1])),2<e&&(c[0].gt(c[2])&&(c[2]=l.swap(c[0],c[0]=c[2])),c[1].gt(c[2])&&(c[2]=l.swap(c[1],c[1]=c[2]))));for(a=0;a<e;++a)c[a].limitPrecisionThis(b);return e}function Nc(a,b,c,d,e,f){a:if(c<b&&p.throwInvalidArgumentException("xTo \x3c xFrom"),c===b)a=0;else{var g=[0],h=Number.MAX_VALUE,k=[Number.MAX_VALUE],m=0,n=l.makePrimitiveArray(33,Number.NaN),q=l.makePrimitiveArray(33,
Number.NaN),r=[0];n[0]=1;var t=0,u=0;for(let L=0;32>L;L++){var v=b,w=c,x=f,y=r;if(0===L)y[0]=1,m=.5*(w-v)*(x(v)+x(w));else{var z=y[0],A=(w-v)/z,C=new l.KahanSummator(0);for(var B=1;B<=y[0];++B)C.add(x(v+(B-.5)*A));m=.5*(m+(w-v)*C.getResult()/z);y[0]*=2}q[L]=m;if(L+1>=a){b:{v=L+1-a;w=a;x=n;var E=q;y=g;z=k;A=0;var G=Math.abs(0-x[v]);C=l.makePrimitiveArray(w,Number.NaN);B=l.makePrimitiveArray(w,Number.NaN);for(var I=0;I<w;++I){var H=Math.abs(0-x[v+I]);H<G&&(A=I,G=H);C[I]=E[v+I];B[I]=E[v+I]}I=G=H=0;y[0]=
E[v+A];A--;for(E=1;E<w;E++){for(let M=0;M<w-E;M++){G=x[v+M]-0;I=x[v+M+E]-0;H=G-I;if(0===H){v=!1;break b}H=(C[M+1]-B[M])/H;C[M]=G*H;B[M]=I*H}2*(A+1)<w-E?z[0]=C[A+1]:(z[0]=B[A],A--);y[0]+=z[0]}v=!0}v||p.throwInternalErrorException("polynomial_interpolation");v=d*Math.abs(g[0])+e;h=Math.abs(h-g[0]);if(h<=v&&Math.abs(k[0])<=v){if(t++,1<t&&(h<=.1*u||0===u||2<t)){a=g[0];break a}}else t=0;u=h;h=g[0]}q[L+1]=q[L];n[L+1]=.25*n[L]}a=g[0]}return a}function em(a,b,c,d,e){const f=l.makeObjectArray(l.Point2D,3);
a.queryControlPoints(f);let g=0,h=f[1][g]-f[0][g],k=f[2][g]-f[0][g];a=Nc(5,b,c,d,e,m=>{if(.5>=m){var n=l.lerpLo(0,h,m);var q=l.lerpLo(h,k,m);n=l.lerpLo(n,q,m)}else n=l.lerpHi(0,h,m),q=l.lerpHi(h,k,m),n=l.lerpHi(n,q,m);m=mi(f,1,m);return n*m.length()});g=1;h=f[1][g]-f[0][g];k=f[2][g]-f[0][g];b=Nc(5,b,c,d,e,m=>{if(.5>=m){var n=l.lerpLo(0,h,m);var q=l.lerpLo(h,k,m);n=l.lerpLo(n,q,m)}else n=l.lerpHi(0,h,m),q=l.lerpHi(h,k,m),n=l.lerpHi(n,q,m);m=mi(f,1,m);return n*m.length()});return new l.Point2D(a,b)}
function He(a){a.m_cachedValues=null}function ni(a){if(a.m_cachedValues)return a.m_cachedValues;const b=new fm;oi(a,b.specialPoints);return a.m_cachedValues=b}function oi(a,b){var c=l.makeObjectArray(l.Point2D,3);a.queryControlPoints(c);a=l.makeObjectArray(l.ECoordinate,8);a[0].set(0);let d=1;var e=l.makeObjectArray(l.ECoordinate,3);gm(c,e,!1);var f=l.makeObjectArray(l.ECoordinate,2),g=new l.Envelope1D(0,1);e=Sd(e[2].mul(2),e[1],g,f[0]);0>e&&(e=0);for(g=0;g<e;g++)l.isOneOf(f[g].value(),0,1)||(a[d]=
f[g],d++);f=l.makeObjectArray(l.ECoordinate,3);hm(c,f,!1);c=l.makeObjectArray(l.ECoordinate,2);e=new l.Envelope1D(0,1);f=Sd(f[2].mul(2),f[1],e,c[0]);0>f&&(f=0);for(e=0;e<f;e++)l.isOneOf(c[e].value(),0,1)||(a[d]=c[e],d++);a[d].set(1);d++;if(2<d){l.sortRange(a,0,d,(h,k)=>h.value()-k.value());c=0;f=a[0].value();e=1;for(g=1;g<d;g++)a[g].eq(a[g-1])?(f+=a[g].value(),e++):(1<e&&(f/=e,a[c].set(f)),c++,a[c]=a[g],f=a[g].value(),e=1);c++;d=c}a[0].set(0);a[d-1].set(1);b.length=d;for(c=0;c<d;c++)b[c]=a[c].value()}
function Ie(a,b,c){const d=l.makeObjectArray(l.Point2D,3);a.queryControlPoints(d);return pi(d,b,c)}function pi(a,b,c){if(c){if(0>b)return b;if(1<b)return b-1+pi(a,1,!1)}if(1===b)return qi(a);c=l.makeObjectArray(l.Point2D,3);bg(a,b,c,null);return qi(c)}function qi(a){if(a[0].equals(a[1]))return l.Point2D.distance(a[2],a[0]);if(a[1].equals(a[2]))return l.Point2D.distance(a[0],a[2]);var b=l.Point2D.distance(a[0],a[1])+l.Point2D.distance(a[2],a[1]),c=l.Point2D.distance(a[0],a[2]);if(b-c<=b*Number.EPSILON)return c;
b=l.makeObjectArray(l.Point2D,3);cg(a,b,!0);a=4*(l.sqr(b[2].x)+l.sqr(b[2].y));c=2*(b[2].x*b[1].x+b[2].y*b[1].y);var d=l.sqr(b[1].x)+l.sqr(b[1].y);if(1E-14*(Math.abs(c)+Math.abs(d))>=Math.abs(a)){if(1E-14*Math.abs(d)>=Math.abs(c))return 1*Math.sqrt(d);p.geometryReleaseAssert(0);return 2/(3*c)*(Math.pow(1*c+d,1.5)-Math.pow(d,1.5))}b=c/a;var e=d/a;c=e-b*b;d=1+b;if(0===c)return 0<=b&&0<=d||0>=b&&0>=d?Math.abs(.5*Math.sqrt(a)*(d*d-b*b)):.5*Math.sqrt(a)*(d*d+b*b);const f=Math.sqrt(c+d*d);e=Math.sqrt(e);
return.5*Math.sqrt(a)*(d*f-b*e+c*Math.log(Math.abs((d+f)/(b+e))))}function mi(a,b,c){a=a[1].sub(a[0]).mul(1-c).add(a[2].sub(a[1]).mul(c));a.mulThis(2);return a}function ri(a){const b=l.makeObjectArray(l.Point2D,3);a.queryControlPoints(b);return si(b)}function si(a){return-a[1].sub(a[0]).crossProduct(a[2].sub(a[0]))/3}function Je(a,b,c,d,e){p.checkAndThrow(l.Envelope1D.unit().contains(c),"QuadraticBezierHelper::getClosestCoordinateSegment");var f=l.makeObjectArray(l.Point2D,3);a.queryControlPoints(f);
e=Number.MAX_VALUE;const g=[0],h=Ke(f,b,g);if(c.containsCoordinate(g[0]))e=l.Point2D.distance(b,h);else{g[0]=c.vmin;Pb(f,g[0],h);e=l.Point2D.distance(h,b);var k=new l.Point2D;Pb(f,c.vmax,k);f=l.Point2D.distance(k,b);e>f&&(h.setCoordsPoint2D(k),g[0]=c.vmax,e=f)}if(!d)return g[0];0>=c.vmin&&(d=new l.Point2D,a.queryCoord2DExtended(-1,d,!0),k=new l.Point2D,a.queryCoord2D(c.vmin,k),k=new Z({start:d,end:k}),d=k.getClosestCoordinate(b,!0),1>d&&(k=k.getCoord2D(d),f=l.Point2D.distance(k,b),f<e&&(e=f,g[0]=
d-1,h.assign(k))));1<=c.vmin&&(d=new l.Point2D,a.queryCoord2DExtended(2,d,!0),k=new l.Point2D,a.queryCoord2D(c.vmax,k),c=new Z({start:k,end:d}),a=c.getClosestCoordinate(b,!0),0<a&&(c=c.getCoord2D(a),b=l.Point2D.distance(c,b),b<e&&(e=b,g[0]=1+a,h.assign(c))));return g[0]}function Ke(a,b,c){var d=a[2].sub(a[1]).sub(a[1].sub(a[0])),e=a[1].sub(a[0]),f=a[0].sub(b),g=f.dotProduct(e);f=f.dotProduct(d)+2*e.dotProduct(e);e=3*e.dotProduct(d);var h=d.dotProduct(d);d=Array(3);g=bi(h,e,f,g,l.Envelope1D.unit(),
!1,d);f=a[0].clone();e=0;h=l.Point2D.sqrDistance(a[0],b);let k=l.Point2D.sqrDistance(a[2],b);k<h&&(e=1,f.assign(a[2]),h=k);for(let m=0;m<g;m++){const n=new l.Point2D;Pb(a,d[m],n);k=l.Point2D.sqrDistance(n,b);k<h&&(h=k,f.assign(n),e=d[m])}c&&(c[0]=e);return f}function Wd(a,b,c){if(b.equalsRange(0,1))c.setFromPoints(a,3);else{var d=l.makeObjectArray(l.Point2D,3);Xd(a,b.vmin,b.vmax,d);c.setFromPoints(d,3)}}function ti(a,b,c){c.setEmpty();const d=[];d.push(new l.Envelope1D(0,1));const e=.5*Math.max(b.width(),
b.height());for(;d.length;){const g=d.at(-1);d.pop();var f=new Va;Wd(a,g,f);if(f.isIntersectingW(b)){const h=Math.max(f.width(),f.height());b.containsW(f)||h<=e||1E-12>g.width()?c.merge(g):(f=g.getCenter(),d.push(l.Envelope1D.construct(g.vmin,f)),d.push(l.Envelope1D.construct(f,g.vmax)))}}}function dg(a){const b=l.makeObjectArray(l.Point2D,3);a.queryControlPoints(b);const c=Yd(b);c&&(a.m_cp.setCoordsPoint2D(b[1]),a.afterCompletedModification());return c}function Yd(a){let b=!1;for(let c=0;2>c;c++){const d=
l.compareNoNANs(a[0][c],a[2][c]);0<d?(0>l.compareNoNANs(a[0][c],a[1][c])&&(a[1][c]=a[0][c],b=!0),0>l.compareNoNANs(a[1][c],a[2][c])&&(a[1][c]=a[2][c],b=!0)):0>d?(0<l.compareNoNANs(a[0][c],a[1][c])&&(a[1][c]=a[0][c],b=!0),0<l.compareNoNANs(a[1][c],a[2][c])&&(a[1][c]=a[2][c],b=!0)):a[1][c]!==a[0][c]&&(a[1][c]=a[0][c],b=!0)}return b}function bg(a,b,c,d){(new l.Point2D).setCoordsPoint2D(a[0]);(new l.Point2D).setCoordsPoint2D(a[1]);(new l.Point2D).setCoordsPoint2D(a[2]);const e=new l.Point2D,f=new l.Point2D,
g=new l.Point2D;l.lerpPoint2D(a[0],a[1],b,e);l.lerpPoint2D(a[1],a[2],b,f);l.lerpPoint2D(e,f,b,g);c&&(c[0].assign(a[0]),c[1].assign(e),c[2].assign(g));d&&(a=a[2],d[0].assign(g),d[1].assign(f),d[2].assign(a))}function Xd(a,b,c,d){if(b===c)c=new l.Point2D,Pb(a,b,c),d[0]=c,d[1]=c,d[2]=c;else{var e=l.makeObjectArray(l.Point2D,3);bg(a,c,e,null);bg(e,b/c,null,e);Pb(a,b,e[0]);Pb(a,c,e[2]);d[0].setCoordsPoint2D(e[0]);d[1].setCoordsPoint2D(e[1]);d[2].setCoordsPoint2D(e[2])}}function Le(a,b,c,d,e,f,g,h,k,m){null!=
e&&(e.length=0);null!==f&&(f.length=0);null!==d&&(d.length=0);if(c.isDegenerate(0)){h=[0,0];c=b.intersectPoint(c.getStartXY(),h,g);if(0<c){if(null!==e)for(g=0;g<c;g++)e.push(h[g]);if(null!==f)for(e=0;e<c;e++)f.push(0);if(null!==d)for(e=0;e<c;e++)f=new l.Point2D,b.queryCoord2D(h[e],f),d.push(f)}return c}var n=rb(b,c);g=Math.max(g,n);if(b.isDegenerateToLineHelper(n)){a=new Z({start:b.getStartXY(),end:b.getEndXY()});d=De(a,c,d,e,f,g,h,m);if(e)for(f=0;f<d;++f)c=a.getCoord2D(e[f]),e[f]=b.getClosestCoordinate(c,
!1);return d}if(Eb(b,c,g))return 0;var q=ua.constructPoint2D(c.getStartXY()),r=ua.constructPoint2D(c.getEndXY()).sub(q);n=r.clone();n.leftPerpendicularThis();var t=ua.constructPoint2D(b.m_cp).sub(ua.constructPoint2D(b.getStartXY())),u=ua.constructPoint2D(b.getEndXY()).sub(ua.constructPoint2D(b.m_cp)),v=t.dotProduct(n).toDouble(),w=u.sub(t).dotProduct(n).toDouble();n=l.makePrimitiveArray(12,Number.NaN);t=l.makePrimitiveArray(12,Number.NaN);u=w;w=v;var x=l.Envelope1D.unit();v=new l.ECoordinate;u=Sd(new l.ECoordinate(u),
new l.ECoordinate(w),x,v);n[0]=v.value();v=u;0>v&&(n[0]=0,n[1]=1,v=2);u=0;for(let y=0,z=u;y<v;++y)w=b.getCoord2D(n[y+z]),t[u]=c.getClosestCoordinate(w,!1),l.Point2D.distance(w,c.getCoord2D(t[u]))<=g&&(n[u]=n[y+z],u++);v=l.makeObjectArray(l.Point2D,3);b.queryControlPoints(v);x=l.makeObjectArray(ua,3);id(v,x,!1);x[0]=x[0].sub(q);r.x.abs().gte(r.y.abs())?(q=r.y.div(r.x),w=x[2].y.sub(x[2].x.mul(q)).toDouble(),v=x[1].y.sub(x[1].x.mul(q)).toDouble(),r=x[0].y.sub(x[0].x.mul(q)).toDouble()):(q=r.x.div(r.y),
w=x[2].x.sub(x[2].y.mul(q)).toDouble(),v=x[1].x.sub(x[1].y.mul(q)).toDouble(),r=x[0].x.sub(x[0].y.mul(q)).toDouble());x=b.getEndXY().equals(c.getStartXY())||b.getEndXY().equals(c.getEndXY());q=[0,0];v=Ac(w,v,r,l.Envelope1D.unit(),x,q);for(let y=0,z=u;y<v;++y)n[y+z]=q[y],r=b.getCoord2D(n[y+z]),t[u]=c.getClosestCoordinate(r,!1),l.Point2D.distance(r,c.getCoord2D(t[u]))<=g&&(n[u]=n[y+z],u++);p.geometryReleaseAssert(u<n.length+4);v=b.intersectPoint(c.getStartXY(),q,g);for(r=0;r<v;r++)n[u]=q[r],t[u++]=
0;v=b.intersectPoint(c.getEndXY(),q,g);for(r=0;r<v;r++)n[u]=q[r],t[u++]=1;v=c.intersectPoint(b.getStartXY(),q,g);for(r=0;r<v;r++)t[u]=q[r],n[u++]=0;v=c.intersectPoint(b.getEndXY(),q,g);for(r=0;r<v;r++)t[u]=q[r],n[u++]=0;return 0===u?0:Fb(a,b,c,n,t,u,d,e,f,g,h,k,m)}function ui(a,b,c,d,e,f,g,h,k,m){if(Ha(c))return c=new Z({start:c.getStartXY(),end:c.getEndXY()}),Le(a,b,c,d,e,f,g,h,k,m);var n=rb(b,c);g=Math.max(g,n);if(Eb(b,c,g))return 0;n=[];const q=[],r=l.makeObjectArray(l.Point2D,3);b.queryControlPoints(r);
var t=l.makeObjectArray(l.Point2D,3),u=new l.Transformation2D;c.canonicToWorldTransformation(u);var v=new l.Transformation2D;v.setInvert(u);v.transformPoints2D(r,3,t);u=l.makeObjectArray(ua,3);id(t,u);t=[u[0].x,u[1].x,u[2].x];u=[u[0].y,u[1].y,u[2].y];v=l.makeObjectArray(l.MPValue,3);v[0].setDouble(c.getSemiMinorAxis());v[0].sqrThis();v[1].setDouble(c.getSemiMajorAxis());v[1].sqrThis();v[2]=v[0];v[2].mul(v[1]);v[2].negate();t=gi(t,2,u,2,null,0,v,!0,l.Envelope1D.unit(),l.Envelope1D.unit(),n);if(0<t){u=
0;for(v=0;v<t;v++){var w=new l.Point2D;b.queryCoord2D(n[v],w);var x=c.getClosestCoordinate(w,!1);const y=new l.Point2D;c.queryCoord2D(x,y);l.Point2D.distance(w,y)<=g&&(n[u]=n[v],q.push(x),u++)}n.length=u}t=[0,1];for(u=0;2>u;u++)v=0===u?c.getStartXY():c.getEndXY(),w=[0],Ke(r,v,w),x=new l.Point2D,Pb(r,w[0],x),l.Point2D.distance(v,x)<=g&&(n.push(w[0]),q.push(t[u]));for(u=0;2>u;u++)v=[0,2],w=c.getClosestCoordinate(r[v[u]],!1),x=new l.Point2D,c.queryCoord2D(w,x),l.Point2D.distance(r[v[u]],x)<=g&&(n.push(t[u]),
q.push(w));return Fb(a,b,c,n,q,n.length,d,e,f,g,h,k,m)}function vi(a,b,c,d,e,f,g,h,k,m){var n=l.makeObjectArray(l.Point2D,3);b.queryControlPoints(n);const q=l.makeObjectArray(l.Point2D,3);c.queryControlPoints(q);if(0>Uf(n,q,3))return vi(a,c,b,d,f,e,g,h,k,!m);var r=rb(b,c);g=Math.max(g,r);if(Eb(b,c,g))return 0;a:{r=l.makeObjectArray(l.Point2D,3);b.queryControlPoints(r);var t=l.makeObjectArray(l.Point2D,3);c.queryControlPoints(t);if(r[0].equals(t[0])){if(r[1].equals(t[1])&&r[2].equals(t[2])){d&&(d.length=
0,d.push(r[0]),d.push(r[2]));e&&(e.length=0,e.push(0),e.push(1));f&&(f.length=0,f.push(0),f.push(1));r=!0;break a}if(!r[0].equals(t[2])){r=!1;break a}}r[0].equals(t[2])&&r[1].equals(t[1])&&r[2].equals(t[0])?(e&&(e.length=0,e.push(0),e.push(1),m&&(e[1]=l.swap(e[0],e[0]=e[1]))),f&&(f.length=0,f.push(1),f.push(0),m&&(f[1]=l.swap(f[0],f[0]=f[1]))),d&&(d.length=0,d.push(r[0]),d.push(r[2]),m&&(d[1]=l.swap(d[0],d[0]=d[1]))),r=!0):r=!1}if(r)return 2;t=new l.Envelope1D(0,1);r=new l.Envelope1D(0,1);var u=new Va;
Wd(n,l.Envelope1D.unit(),u);var v=new Va;Wd(q,l.Envelope1D.unit(),v);var w=Math.max(u.maxDim(),v.maxDim());u.inflate(3*g);v.inflate(3*g);if(!u.intersectW(v))return 0;if(u.maxDim()<.1*w){ti(n,u,t);ti(q,u,r);if(t.isEmpty()||r.isEmpty())return 0;Xd(n,t.vmin,t.vmax,n);Xd(q,r.vmin,r.vmax,q)}w=jd(n,2,q,2,g);if(0===w)return 0;u=[];v=[];if(-1===w){var x=l.makeObjectArray(ua,3);id(n,x);w=[x[0].x,x[1].x,x[2].x];x=[x[0].y,x[1].y,x[2].y];var y=l.makeObjectArray(ua,3);id(q,y);w=hd(w,2,x,2,null,0,[y[0].x,y[1].x,
y[2].x],2,[y[0].y,y[1].y,y[2].y],2,null,0,!0,l.Envelope1D.unit(),l.Envelope1D.unit(),u,v,m);if(0<w){x=0;for(y=0;y<w;y++){var z=new l.Point2D,A=new l.Point2D;Pb(q,v[y],A);Pb(n,u[y],z);l.Point2D.distance(z,A)<=g&&(u[x]=u[y],v[x]=v[y],x++)}u.length=x;v.length=x}}for(w=0;2>w;w++)for(x=0===w?n:q,y=0===w?q:n,z=0;2>z;z++){A=0===z?0:2;const C=[0];Ke(y,x[A],C);const B=new l.Point2D;Pb(y,C[0],B);l.Point2D.distance(x[A],B)<=g&&(0===w?(u.push(0===A?0:1),v.push(C[0])):(v.push(0===A?0:1),u.push(C[0])))}if(0===
u.length)return 0;if(!t.equalsRange(0,1))for(n=0;n<u.length;++n)u[n]=rc.recalculateParentT(t.vmin,t.vmax,u[n]);if(!r.equalsRange(0,1))for(n=0;n<v.length;++n)v[n]=rc.recalculateParentT(r.vmin,r.vmax,v[n]);return Fb(a,b,c,u,v,u.length,d,e,f,g,h,k,m)}function cg(a,b,c=!1){const d=a[1].sub(a[0]);b[1].assign(d.mul(2));b[2].assign(a[2].sub(a[1]).sub(d));c?b[0].setCoords(0,0):b[0].assign(a[0])}function im(a,b,c=!1){const d=l.makeObjectArray(l.Point2D,3);a.queryControlPoints(d);cg(d,b,c)}function gm(a,b,
c=!1){const d=(new l.ECoordinate(a[1][0])).subE(new l.ECoordinate(a[0][0]));b[1]=d.mul(2);b[2]=(new l.ECoordinate(a[2][0])).subE(new l.ECoordinate(a[1][0])).subE(d);c?b[0].set(0):b[0].set(a[0][0])}function hm(a,b,c=!1){const d=(new l.ECoordinate(a[1][1])).subE(new l.ECoordinate(a[0][1]));b[1]=d.mul(2);b[2]=(new l.ECoordinate(a[2][1])).subE(new l.ECoordinate(a[1][1])).subE(d);c?b[0].set(0):b[0].set(a[0][1])}function id(a,b,c=!1){const d=ua.constructPoint2D(a[1]),e=d.sub(ua.constructPoint2D(a[0]));
b[1]=e.mul(l.MPValue.constructInt32(2));b[2]=ua.constructPoint2D(a[2]).sub(d).sub(e);b[0]=c?new ua(l.s_zero$1,l.s_zero$1):ua.constructPoint2D(a[0])}function Pb(a,b,c,d){if(d){if(0>b){d=a[0];a=a[0];var e=a.add;p.geometryReleaseAssert(0);var f=l.Point2D.getNAN();a=new Z({start:d,end:e.call(a,f.getUnitVector())});sb(a,b,c);return}if(1<b){d=a[2];a=a[2];e=a.add;p.geometryReleaseAssert(0);f=l.Point2D.getNAN();a=new Z({start:d,end:e.call(a,f.getUnitVector())});sb(a,b-1,c);return}}.5>=b?(f=a[1].clone(),d=
new l.Point2D,l.lerpPointLo(2,a[0],f,b,d),e=new l.Point2D,l.lerpPointLo(2,f,a[2],b,e),a=new l.Point2D,l.lerpPointLo(2,d,e,b,a),c.assign(a)):(f=a[1].clone(),d=new l.Point2D,l.lerpPointHi(2,a[0],f,b,d),e=new l.Point2D,l.lerpPointHi(2,f,a[2],b,e),a=new l.Point2D,l.lerpPointHi(2,d,e,b,a),c.assign(a))}function kc(a,b,c,d){d=.5*(d-c);c+=d;const e=new l.KahanSummator(0);for(let g=0,h=Math.trunc(a/2);g<h;++g){var f=void 0;let k;switch(a){case 4:f=wi[g][0];k=wi[g][1];break;case 8:f=xi[g][0];k=xi[g][1];break;
case 16:f=yi[g][0];k=yi[g][1];break;case 32:f=zi[g][0];k=zi[g][1];break;case 64:f=Ai[g][0];k=Ai[g][1];break;case 128:f=Bi[g][0];k=Bi[g][1];break;default:throw Error("Quadrature_integral: invalid n");}const m=l.fma(-d,f,c);f=l.fma(d,f,c);e.pe(b(m)*k);e.pe(b(f)*k)}return e.getResult()*d}function eg(a,b,c,d,e,f,g,h){for(;;){var k=l.Point2D.distance(b[0],b[2]),m=l.Point2D.distance(b[0],b[1])+l.Point2D.distance(b[1],b[2]);if(m-k<=e+d*m)return a+l.lerp(k,m,.5);const t=l.makeObjectArray(l.Point2D,4);k=u=>
{kd(b,c,1,u,t);return t[1].length()};if(0===g&&8>h){p.geometryReleaseAssert(8>h);var n=k(0),q=k(1);f[0]+=2;n>q&&(q=l.swap(n,n=q),b[2]=l.swap(b[0],b[0]=b[2]),c[2]=l.swap(c[0],c[0]=c[2]));var r=n/(n+q);q=1;let u=m;for(;.03125>r&&u>=e+d*u;){q/=4;r=k(q);f[0]++;r=n/(r+n);const v=new l.Point2D;Na(b,c,.5*q,v);u=l.Point2D.distance(v,b[0]);if(u<=e){const w=new l.Point2D;Na(b,c,q,w);u+=l.Point2D.distance(w,v)}}if(1!==q){m=l.makeObjectArray(l.Point2D,3);k=[0,0,0];Ci(b,c,q,b,c,m,k);a=eg(a,m,k,d,e,f,0,h+1);g++;
h++;continue}}q=!1;f[0]+=8;q=kc(8,k,0,1);f[0]+=16;n=kc(16,k,0,1);q=Math.abs(q-n)>e+d*m;if(!q)return a+n;if(8>g&&9>h)m=l.makeObjectArray(l.Point2D,3),k=[0,0,0],Ci(b,c,.5,b,c,m,k),a=eg(a,m,k,d,e,f,g+1,h+1),g++,h++;else{f[0]+=32;g=kc(32,k,0,1);q=Math.abs(n-g)>e+d*m;if(!q)return a+g;f[0]+=64;h=kc(64,k,0,1);q=Math.abs(g-h)>e+d*m;if(!q)return a+h;f[0]+=128;f=kc(128,k,0,1);q=Math.abs(h-f)>e+d*m;return a+f}}}function jm(a,b,c,d,e){let f=!0;const g=l.makeObjectArray(l.Point2D,4),h=Nc(5,b,c,d,e,k=>{Di(a,1,
k,g);return(f?a.getCoordX(k)-a.getStartX():a.getCoordY(k)-a.getStartY())*g[1].length()});f=!1;b=Nc(5,b,c,d,e,k=>{Di(a,1,k,g);return(f?a.getCoordX(k)-a.getStartX():a.getCoordY(k)-a.getStartY())*g[1].length()});return new l.Point2D(h,b)}function Me(a){a.m_cachedValues=null}function Zd(a){if(a.m_cachedValues)return a.m_cachedValues;const b=new km,c=l.makeObjectArray(l.Point2D,3);a.queryControlPoints(c);const d=[0,0,0];a.queryWeights(d);Ei(c,d,b.specialPoints);return a.m_cachedValues=b}function Ei(a,
b,c){if(0===b[1])c.length=2,c[0]=0,c[1]=1;else{var d=l.makeObjectArray(l.ECoordinate,8);d[0].set(0);var e=1,f=(new l.ECoordinate(a[1].x)).subThis(a[0].x).mulThis(b[1]).mulThis(b[0]),g=(new l.ECoordinate(a[2].x)).subThis(a[0].x).mulThis(b[2]).mulThis(b[0]),h=f.subE(g).addThisE((new l.ECoordinate(a[2].x)).subThis(a[1].x).mulThis(b[2]).mulThis(b[1]));g.subThisE(f.mul(2));var k=l.makeObjectArray(l.ECoordinate,2),m=new l.Envelope1D(0,1);f=tb(h,g,f,m,!1,k);0>f&&(f=0);for(g=0;g<f;g++)l.isOneOf(k[g].value(),
0,1)||(d[e]=k[g],e++);k=(new l.ECoordinate(a[1].y)).subThis(a[0].y).mulThis(b[1]).mulThis(b[0]);f=(new l.ECoordinate(a[2].y)).subThis(a[0].y).mulThis(b[2]).mulThis(b[0]);b=k.subE(f).addThisE((new l.ECoordinate(a[2].y)).subThis(a[1].y).mulThis(b[2]).mulThis(b[1]));f.subThisE(k.mul(2));a=l.makeObjectArray(l.ECoordinate,2);g=new l.Envelope1D(0,1);b=tb(b,f,k,g,!1,a);0>b&&(b=0);for(k=0;k<b;k++)l.isOneOf(a[k].value(),0,1)||(d[e]=a[k],e++);d[e].set(1);e++;if(2<e){l.sortRange(d,0,e,(n,q)=>l.standardNumericCompare(n.value(),
q.value()));a=0;b=d[0].value();k=1;for(f=1;f<e;f++)d[f].eq(d[f-1])?(b+=d[f].value(),k++):(1<k&&(b/=k,d[a].set(b)),a++,d[a]=d[f],b=d[f].value(),k=1);a++;e=a}d[0].set(0);d[e-1].set(1);c.length=e;for(a=0;a<e;a++)c[a]=d[a].value()}}function $d(a,b,c){if(c){if(0>b)return b;if(1<b)return b-1+$d(a,1,!1)}if(a.isDegenerate(0))return 0;c=1===b;const d=Zd(a);if(c&&!Number.isNaN(d.length))return d.length;const e=Fi(a),f=e/a.calculateUpperLength2D();let g=0;var h=0;for(let r=1,t=d.specialPointsCount();r<t;r++){const u=
d.specialPoints[r];a:{var k=a,m=Math.min(b,u),n=f,q=e;if(m===h){h=0;break a}const v=l.makeObjectArray(l.Point2D,3),w=[0,0,0];k.queryControlPoints(v);k.queryWeights(w);k=[0,0,0];const x=l.makeObjectArray(l.Point2D,3);Oc(v,w,h,m,x,k);h=eg(0,x,k,n,q,[0],0,0)}g+=h;if(b<=u)break;h=u}c&&(d.length=g);return g}function Di(a,b,c,d){const e=l.makeObjectArray(l.Point2D,3);a.queryControlPoints(e);const f=[0,0,0];a.queryWeights(f);kd(e,f,b,c,d)}function kd(a,b,c,d,e){var f=[a[0],a[1],a[2]];a=[b[0],b[1],b[2]];
b=l.makeObjectArray(l.Point2D,4);p.geometryReleaseAssert(0<c);var g=[f[0].clone(),f[1].clone(),f[2].clone()];if(!g[0].isZero()){for(var h=1;3>h;++h)g[h].subThis(g[0]);g[0].setCoords(0,0)}h=Ne(g,a,0,d);g=fg(a,0,d);h=h.divide(g);b[0].assign(h);if(0!==c){var k=[a[1]*a[0],a[2]*a[0]*.5,a[1]*a[2]],m=[f[1].sub(f[0]),f[2].sub(f[0]),f[2].sub(f[1])];h=Ne(m,k,0,d).mul(2);f=g*g;h=h.divide(f);b[1].assign(h);if(1!==c){var n=fg(a,1,d),q=Ne(m,k,1,d).mul(2),r=2*g*n;q=q.sub(h.mul(r)).divide(f);b[2].assign(q);2!==c&&
(k=Ne(m,k,2,d).mul(2),d=fg(a,2,d),d=2*(n*n+g*d),d=k.sub(q.mul(r).mul(2)).sub(h.mul(d)).divide(f),b[3].assign(d),3!==c&&p.throwInternalErrorException(""))}}for(d=0;d<=c;d++)e[d].setCoords(b[d].x,b[d].y)}function Ne(a,b,c,d){if(0===c){if(.5>=d){c=new l.Point2D;l.lerpPointLo(2,a[0].mul(b[0]),a[1].mul(b[1]),d,c);var e=new l.Point2D;l.lerpPointLo(2,a[1].mul(b[1]),a[2].mul(b[2]),d,e);a=new l.Point2D;l.lerpPointLo(2,c,e,d,a);return a}c=new l.Point2D;l.lerpPointHi(2,a[0].mul(b[0]),a[1].mul(b[1]),d,c);e=new l.Point2D;
l.lerpPointHi(2,a[1].mul(b[1]),a[2].mul(b[2]),d,e);a=new l.Point2D;l.lerpPointHi(2,c,e,d,a);return a}if(1===c)return c=a[1].mul(b[1]),d=c.sub(a[0].mul(b[0])).mul(1-d).add(a[2].mul(b[2]).sub(c).mul(d)),d.mulThis(2),d;if(2===c)return d=a[1].mul(b[1]),d=a[2].mul(b[2]).sub(d).sub(d.sub(a[0].mul(b[0]))),d.mulThis(2),d;p.throwInternalErrorException("")}function Gi(a,b,c,d){if(.5>=d.toDouble()){c=new S;l.lerpLoPointE(2,a[0].mulE(b[0]),a[1].mulE(b[1]),d,c);var e=new S;l.lerpLoPointE(2,a[1].mulE(b[1]),a[2].mulE(b[2]),
d,e);a=new S;l.lerpLoPointE(2,c,e,d,a);return a}c=new S;l.lerpHiPointE(2,a[0].mulE(b[0]),a[1].mulE(b[1]),d,c);e=new S;l.lerpHiPointE(2,a[1].mulE(b[1]),a[2].mulE(b[2]),d,e);a=new S;l.lerpHiPointE(2,c,e,d,a);return a}function fg(a,b,c){if(0===b)return b=l.lerp(a[0],a[1],c),a=l.lerp(a[1],a[2],c),l.lerp(b,a,c);if(1===b)return 2*((1-c)*(a[1]-a[0])+(a[2]-a[1])*c);if(2===b)return 2*(a[2]-a[1]-(a[1]-a[0]));p.throwInternalErrorException("")}function gg(a,b,c){c=l.snap(c,0,1);const d=l.makeObjectArray(l.Point2D,
4);kd(a,b,3,c,d);if(d[1].isZero()){if(d[2].isZero())return d[3];a=d[2].clone();1===c&&a.negateThis();return a}return d[1]}function Hi(a){const b=l.makeObjectArray(l.Point2D,3),c=[0,0,0];a.queryControlPoints(b);a.queryWeights(c);return lm(b,c)}function lm(a,b){b=Yb(b);if(1===b)return si(a);if(0===b)return 0;var c=[new l.Point2D(0,0),a[1].sub(a[0]),a[2].sub(a[0])];a=c[1].crossProduct(c[2]);if(1>b){p.geometryReleaseAssert(0<b);var d=1-b;.01>d?b=-1/3+d*(2/15+d*(3/35+d*(16/315+d*(20/693+d*(16/1001+56/
6435*d))))):(c=d*(1+b),d=Math.atan2(Math.sqrt(d),Math.sqrt(1+b)),b=b*(.5*b-l.rsqrt(c)*d)/c);return a*b}d=(b-1)*(b+1);return.25*b/Math.pow(d,1.5)*(-2*b*Math.sqrt(d)*a-4*c[1].y*c[2].x*Math.atanh(Math.sqrt((b-1)/(b+1)))-c[1].x*c[2].y*Math.log(-1+2*b*(b-Math.sqrt(d))))}function mm(a,b){var c=Yb(b);if(1===c){c=l.makeObjectArray(l.Point2D,3);cg(a,c);b=c[2].clone();a=c[1].clone();c=new l.Point2D;var d=b.y*a.x-b.x*a.y;c.x=-((4*b.x+5*a.x)*d)/60;c.y=-((4*b.y+5*a.y)*d)/60;return c}if(0===c)return new l.Point2D(0,
0);p.geometryReleaseAssert(0<c);b=a[1].sub(a[0]);a=a[2].sub(a[0]);if(1>c){var e=Math.sqrt(1-c),f=Math.sqrt(1+c);d=(b.y*a.x-b.x*a.y)*c/Math.pow(e*f,5)/12;var g=Math.atan2(e,f);e=c*e*f;c*=c;f=b.mul(2*(2+c));var h=a.mul(2*c-5);e=f.add(h).mul(e);b=a.sub(b.mul(2*c)).mul(6*g);return e.add(b).mul(d)}e=Math.sqrt(c-1);f=Math.sqrt(c+1);d=(b.y*a.x-b.x*a.y)*c/Math.pow(e*f,5)/12;g=Math.atanh(e/f);e=c*e*f;c*=c;f=b.mul(4).sub(a.mul(5));h=b.add(a).mul(2*c);e=f.add(h).mul(e);b=a.sub(b.mul(2*c)).mul(6*g);return e.add(b).mul(d)}
function Fi(a){a=a.calculateUpperLength2D();return 256*l.doubleEps()*a}function hg(a,b,c,d,e){c=l.makeObjectArray(l.Point2D,3);a.queryControlPoints(c);const f=[0,0,0];a.queryWeights(f);a=[0];return 1===ig(c,f,b,l.Envelope1D.unit(),d,e,1,a)?a[0]:Number.NaN}function ig(a,b,c,d,e,f,g,h){p.checkAndThrow(l.Envelope1D.unit().contains(d)&&0<g,"");if(0>f||Number.isNaN(f))f=Number.MAX_VALUE;var k=Array(3);for(var m=0;3>m;++m)k[m]=a[m].sub(c);a=Yb(b);c=ua.constructPoint2D(k[0]);var n=ua.constructPoint2D(k[1]),
q=ua.constructPoint2D(k[2]),r=l.MPValue.constructDouble(a),t=r.clone();t.ldexpThis(1);a=c.dotProduct(n.sub(c)).mul(r);m=r.mul(r.addDouble(2));m=q.sub(n.mul(m.ldexp(1)));m=n.sqrLength().mul(r.mul(r).ldexp(1)).add(c.sqrLength().mul(r.ldexp(2).subDouble(1))).add(c.dotProduct(m));var u=q.sub(n.mul(t)).add(c.mul(t.subDouble(1)));u=n.mul(r).sub(c).dotProduct(u).mulDouble(3);var v=n.dotProduct(q).mul(r.subDouble(3).mul(r)).ldexp(1),w=n.sqrLength().mul(r.mul(r).ldexp(2));const x=c.sqrLength().mul(r.ldexp(2).subDouble(3)),
y=c.dotProduct(q.sub(n.mul(r.mulDouble(3).subDouble(1)).mul(r))).ldexp(1);v=q.sqrLength().addThis(v).addThis(w).addThis(x).addThis(y);n=c.add(q).sub(n.mul(t));r=r.subDouble(1);w=q.sub(c).dotProduct(n).mul(r);q=new l.Point2D(0,0);c=[];n=new l.Point2D;Na(k,b,d.vmin,n);r=l.Point2D.distance(n,q);r<=f&&c.push(new l.Point2D(d.vmin,r));d.vmin!==d.vmax&&(Na(k,b,d.vmax,n),r=l.Point2D.distance(n,q),r<=f&&c.push(new l.Point2D(d.vmax,r)));if(0<d.width())for(r=k[2].isZero(),t=l.makeObjectArray(l.MPValue,4),a=
ii(w,v,u,m,a,58,d,r,t),m=0;m<a;m++)d.containsExclusiveCoordinate(t[m].toDouble())&&(u=t[m].toDouble(),u=ld(b,u),v=new l.Point2D,Na(k,b,u,v),r=l.Point2D.distance(v,q),r<=f&&c.push(new l.Point2D(u,r)));e&&(p.geometryReleaseAssert(d.equals(l.Envelope1D.unit())),Na(k,b,-1,n,!0),e=new l.Point2D,Na(k,b,0,e),a=new Z({start:n,end:e}),e=a.getClosestCoordinate(q,!0),1>e&&(n=a.getCoord2D(e),r=l.Point2D.distance(n,q),r<=f&&c.push(new l.Point2D(e-1,r))),Na(k,b,2,n,!0),e=new l.Point2D,Na(k,b,d.vmax,e),d=new Z({start:e,
end:n}),b=d.getClosestCoordinate(q,!0),0<b&&(n=d.getCoord2D(b),r=l.Point2D.distance(n,q),r<=f&&c.push(new l.Point2D(1+b,r))));if(!c.length)return 0;c.sort((z,A)=>z.compare(A));f=0;b=c[0].x;h[f++]=b;if(f<g){k=Ih(k,4,!1).total();f=c[0].y;for(let z=1,A=c.length;z<A;z++)if(c[z].y>f+k){c.length=z;break}c.sort((z,A)=>l.standardNumericCompare(z.x,A.x));f=0;h[f++]=c[0].x;for(let z=1,A=c.length;z<A;z++)c[z].x!==h[f-1]&&f<g&&(h[f++]=c[z].x)}return f}function Ii(a,b,c){const d=l.makeObjectArray(l.Point2D,3);
a.queryControlPoints(d);const e=[0,0,0];a.queryWeights(e);ae(d,e,b,c)}function ae(a,b,c,d){if(c.equalsRange(0,1))d.setFromPoints(a,3);else{var e=l.makeObjectArray(l.Point2D,3);Oc(a,b,c.vmin,c.vmax,e,[0,0,0]);d.setFromPoints(e,3)}}function Oe(a){var b=l.compareNoNANs(a[0].y,a[1].y);const c=l.compareNoNANs(a[1].y,a[2].y);if(0<=b&&0<=c||0>=b&&0>=c)if(b=l.compareNoNANs(a[0].x,a[1].x),a=l.compareNoNANs(a[1].x,a[2].x),0<=b&&0<=a||0>=b&&0>=a)return!0;return!1}function jg(a){const b=l.makeObjectArray(l.Point2D,
3);a.queryControlPoints(b);const c=md(b);c&&(a.m_cp.setCoordsPoint2D(b[1]),a.afterCompletedModification());return c}function md(a){let b=!1;for(let c=0;2>c;c++){const d=l.compareNoNANs(a[0][c],a[2][c]);0<d?(0>l.compareNoNANs(a[0][c],a[1][c])&&(a[1][c]=a[0][c],b=!0),0>l.compareNoNANs(a[1][c],a[2][c])&&(a[1][c]=a[2][c],b=!0)):0>d?(0<l.compareNoNANs(a[0][c],a[1][c])&&(a[1][c]=a[0][c],b=!0),0<l.compareNoNANs(a[1][c],a[2][c])&&(a[1][c]=a[2][c],b=!0)):a[1][c]!==a[0][c]&&(a[1][c]=a[0][c],b=!0)}return b}
function Ci(a,b,c,d,e,f,g){p.geometryReleaseAssert(0<=c&&1>=c&&d!==f&&e!==g);p.geometryReleaseAssert(0<b[0]&&0<b[2]&&0<=b[1]);var h=[1,Yb(b),1];const k=be(b,c);a=l.cloneObjectArray(a,3);const m=l.makeObjectArray(X,3);Ji(a,h,m);const n=l.makeObjectArray(X,3);h=l.makeObjectArray(X,3);kg(m,k,d?n:null,f?h:null);lg(b,c,e,g);b=Oe(a);if(d){for(c=0;3>c;++c)mg(n[c],d[c]);ng(a,d);b&&md(d)}if(f){for(d=0;3>d;++d)mg(h[d],f[d]);ng(a,f);b&&md(f)}}function Oc(a,b,c,d,e,f){p.geometryReleaseAssert(0<=c&&1>=d&&c<=d);
if(c===d)d=new l.Point2D,b=Ki(a,b,c,d),og(a,d),e[0].assign(d),e[1].assign(d),e[2].assign(d),f[0]=b,f[1]=b,f[2]=b;else if(0===c&&1===d)e[0].assign(a[0]),e[1].assign(a[1]),e[2].assign(a[2]),f[0]=b[0],f[1]=b[1],f[2]=b[2];else{var g=l.makeObjectArray(X,3),h=[1,Yb(b),1],k=be(b,c),m=be(b,d);Ji(a,h,g);kg(g,m,g,null);kg(g,k>=m?1:k/m,null,g);h=[0,0,0];lg(b,d,h,null);lg(h,c/d,null,h);k=Oe(a);m=l.makeObjectArray(l.Point2D,3);mg(g[1],m[1]);Na(a,b,c,m[0]);Na(a,b,d,m[2]);ng(a,m);for(a=0;3>a;++a)e[a].assign(m[a]),
f[a]=h[a];k&&md(e)}}function Li(a,b,c,d,e){if(e){if(0!==sc(b,c))return a?4:2}else if(zc(b,c))return 1;return 0!==nd(a,b,c,null,null,null,d,void 0===e?!1:e,!0,!1)?4:0}function nm(a,b,c,d,e){if(e){const f=sc(b,c);if(0!==f){if(a){if(1===f){if(b.m_weights[0]===c.m_weights[0]&&b.m_weights[1]===c.m_weights[1]&&b.m_weights[2]===c.m_weights[2])return 2}else if(b.m_weights[0]===c.m_weights[2]&&b.m_weights[1]===c.m_weights[1]&&b.m_weights[2]===c.m_weights[0])return 2;return 4}return 2}}else if(zc(b,c))return 1;
return 0!==ce(a,b,c,null,null,null,d,void 0===e?!1:e,!0,!1)?4:0}function nd(a,b,c,d,e,f,g,h,k,m){null!==e&&(e.length=0);null!==f&&(f.length=0);null!==d&&(d.length=0);if(c.isDegenerate(0)){h=[0,0];c=b.intersectPoint(c.getStartXY(),h,g);if(0<c){if(null!==e)for(g=0;g<c;g++)e.push(h[g]);if(null!=f)for(e=0;e<c;e++)f.push(0);if(null!=d)for(e=0;e<c;e++)f=new l.Point2D,b.queryCoord2D(h[e],f),d.push(f)}return c}var n=rb(b,c);g=Math.max(g,n);if(b.isDegenerateToLineHelper(n)){a=new Z({start:b.getStartXY(),end:b.getEndXY()});
d=De(a,c,d,e,f,g,h,m);if(e)for(f=0;f<d;++f)c=a.getCoord2D(e[f]),e[f]=b.getClosestCoordinate(c,!1);return d}if(Eb(b,c,g))return 0;var q=l.makeObjectArray(l.Point2D,3);b.queryControlPoints(q);n=[0,0,0];b.queryWeights(n);const r=[1,Yb(n),1];var t=c.getEndXY().sub(c.getStartXY()),u=t.clone();u.leftPerpendicularThis();var v=q[0].clone(),w=q[1].clone(),x=q[2].clone(),y=w.sub(v);v=x.sub(v);w=x.sub(w);var z=r[0],A=r[1];const C=r[2];x=z*A;z*=C;A*=C;x*=y.dotProduct(u);v=v.dotProduct(u)*z;w=w.dotProduct(u)*
A;u=Array(13);y=Array(13);w=Ac(w+v-v,v-2*x,x,l.Envelope1D.unit(),!1,u);0>w&&(u[0]=0,u[1]=1,w=2);v=0;for(let B=0,E=v;B<w;++B)x=new l.Point2D,Na(q,r,u[B+E],x),y[v]=c.getClosestCoordinate(x,!1),l.Point2D.distance(x,c.getCoord2D(y[v]))<=g&&(u[v]=u[B+E],v++);z=l.makeObjectArray(l.Point2D,3);w=l.makeObjectArray(l.Point2D,3);b.queryControlPoints(w);w[0].subThis(c.getStartXY());w[1].subThis(c.getStartXY());w[2].subThis(c.getStartXY());om(w,r,z,!1);Math.abs(t.x)>=Math.abs(t.y)?(t=t.y/t.x,x=z[2].y-z[2].x*t,
w=z[1].y-z[1].x*t,z=z[0].y-z[0].x*t):(t=t.x/t.y,x=z[2].x-z[2].y*t,w=z[1].x-z[1].y*t,z=z[0].x-z[0].y*t);A=b.getEndXY().equals(c.getStartXY())||b.getEndXY().equals(c.getEndXY());t=[0,0];w=Ac(x,w,z,l.Envelope1D.unit(),A,t);for(let B=0,E=v;B<w;++B)u[B+E]=t[B],x=new l.Point2D,Na(q,r,u[B+E],x),y[v]=c.getClosestCoordinate(x,!1),l.Point2D.distance(x,c.getCoord2D(y[v]))<=g&&(u[v]=u[B+E],v++);p.geometryReleaseAssert(v<u.length+4);for(q=0;q<v;q++)u[q]=ld(n,u[q]);w=b.intersectPoint(c.getStartXY(),t,g);for(n=
0;n<w;n++)u[v]=t[n],y[v++]=0;w=b.intersectPoint(c.getEndXY(),t,g);for(n=0;n<w;n++)u[v]=t[n],y[v++]=1;w=c.intersectPoint(b.getStartXY(),t,g);for(n=0;n<w;n++)y[v]=t[n],u[v++]=0;w=c.intersectPoint(b.getEndXY(),t,g);for(n=0;n<w;n++)y[v]=t[n],u[v++]=1;return 0===v?0:Fb(a,b,c,u,y,v,d,e,f,g,h,k,m)}function ce(a,b,c,d,e,f,g,h,k,m){var n=l.makeObjectArray(l.Point2D,3);b.queryControlPoints(n);const q=l.makeObjectArray(l.Point2D,3);c.queryControlPoints(q);if(0>Uf(n,q,3))return ce(a,c,b,d,f,e,g,h,k,!m);var r=
rb(b,c);if(b.isDegenerateToLineHelper(r)){r=new Z({start:b.getStartXY(),end:b.getEndXY()});c=nd(a,c,r,d,f,e,g,h,k,!m);if(e)for(f=0;f<c;++f)a=r.getCoord2D(e[f]),e[f]=b.getClosestCoordinate(a,!1);return c}if(c.isDegenerateToLineHelper(r)){r=new Z({start:c.getStartXY(),end:c.getEndXY()});b=nd(a,b,r,d,e,f,g,h,k,m);if(f)for(e=0;e<b;++e)a=r.getCoord2D(f[e]),f[e]=c.getClosestCoordinate(a,!1);return b}g=Math.max(g,r);if(Eb(b,c,g))return 0;var t=Array(3);b.queryWeights(t);r=Array(3);c.queryWeights(r);const u=
[1,Yb(t),1],v=[1,Yb(r),1],w=new l.Envelope1D(0,1);var x=new l.Envelope1D(0,1),y=Va.constructEmpty();ae(n,u,new l.Envelope1D(0,1),y);var z=Va.constructEmpty();ae(q,v,new l.Envelope1D(0,1),z);var A=Math.max(y.maxDim(),z.maxDim());y.inflate(3*g);z.inflate(3*g);if(!y.intersectW(z))return 0;if(y.maxDim()<.1*A){pg(n,u,y,w);pg(q,v,y,x);if(w.isEmpty()||x.isEmpty())return 0;Oc(n,u,w.vmin,w.vmax,n,u);Oc(q,v,x.vmin,x.vmax,q,v)}A=jd(n,2,q,2,g);if(0===A)return 0;y=[];z=[];if(-1===A){var C=l.makeObjectArray(l.MPValue,
3),B=l.makeObjectArray(l.MPValue,3),E=l.makeObjectArray(l.MPValue,3);Pe(n,u,C,B,E);var G=l.makeObjectArray(l.MPValue,3),I=l.makeObjectArray(l.MPValue,3),H=l.makeObjectArray(l.MPValue,3);Pe(q,v,G,I,H);A=[];var L=[];C=hd(C,2,B,2,E,2,G,2,I,2,H,2,!0,l.Envelope1D.unit(),l.Envelope1D.unit(),A,L);if(0<C)for(B=0;B<C;B++)E=new l.Point2D,Na(q,v,L[B],E),G=new l.Point2D,Na(n,u,A[B],G),l.Point2D.distance(G,E)<=g&&(y.push(A[B]),z.push(L[B]))}for(A=0;2>A;A++)for(0===A?(L=n,C=q,B=v):(L=q,C=n,B=u),E=0;2>E;E++){G=
0===E?0:L.length-1;I=new l.Point2D;H=[0];const M=ig(C,B,L[G],l.Envelope1D.unit(),!1,-1,1,H);p.geometryReleaseAssert(1===M);Na(C,B,H[0],I);l.Point2D.distance(L[G],I)<=g&&(0===A?(y.push(0===G?0:1),z.push(H[0])):(z.push(0===G?0:1),y.push(H[0])))}if(0===y.length)return 0;if(!w.equalsRange(0,1))for(n=0;n<y.length;++n)y[n]=lb.recalculateParentT(w.vmin,w.vmax,y[n]);if(!x.equalsRange(0,1))for(n=0;n<z.length;++n)z[n]=lb.recalculateParentT(x.vmin,x.vmax,z[n]);for(x=0;x<y.length;++x)y[x]=ld(t,y[x]);for(t=0;t<
z.length;++t)z[t]=ld(r,z[t]);return Fb(a,b,c,y,z,y.length,d,e,f,g,h,k,m)}function Mi(a,b,c,d,e,f,g,h,k,m){if(b.isLine())return b=new Z({start:b.getStartXY(),end:b.getEndXY()}),Le(a,c,b,d,f,e,g,h,k,!m);if(c.isLine())return c=new Z({start:c.getStartXY(),end:c.getEndXY()}),nd(a,b,c,d,e,f,g,h,k,m);var n=rb(b,c);g=Math.max(g,n);if(Eb(b,c,g))return 0;n=l.makeObjectArray(l.Point2D,3);b.queryControlPoints(n);const q=l.makeObjectArray(l.Point2D,3);c.queryControlPoints(q);var r=jd(n,2,q,2,g);if(0===r)return 0;
const t=[],u=[];if(-1===r){r=l.makeObjectArray(l.MPValue,3);var v=l.makeObjectArray(l.MPValue,3),w=l.makeObjectArray(l.MPValue,3),x=[0,0,0];b.queryWeights(x);Pe(n,x,r,v,w);x=l.makeObjectArray(ua,3);id(q,x);r=hd(r,2,v,2,w,2,[x[0].x,x[1].x,x[2].x],2,[x[0].y,x[1].y,x[2].y],2,null,0,!0,l.Envelope1D.unit(),l.Envelope1D.unit(),t,u);if(0<r){v=0;for(w=0;w<r;w++){x=new l.Point2D;c.queryCoord2D(u[w],x);var y=new l.Point2D;b.queryCoord2D(t[w],y);l.Point2D.distance(y,x)<=g&&(t[v]=t[w],u[v]=u[w],v++)}t.length=
v;u.length=v}}for(r=0;2>r;r++)for(v=0===r?n:q,w=0;2>w;w++){x=0===w?0:v.length-1;const z=new l.Point2D;0===r?(y=Je(c,v[x],l.Envelope1D.unit(),!1),c.queryCoord2D(y,z)):(y=hg(b,v[x],l.Envelope1D.unit(),!1,-1),b.queryCoord2D(y,z));l.Point2D.distance(v[x],z)<=g&&(0===r?(t.push(0===x?0:1),u.push(y)):(u.push(0===x?0:1),t.push(y)))}return Fb(a,b,c,t,u,t.length,d,e,f,g,h,k,m)}function om(a,b,c,d=!1){const e=l.makeObjectArray(l.Point2D,3);d?(e[0].setCoordsPoint2D(a[0]),e[1].setCoordsPoint2D(a[1]),e[1].subThis(e[0]),
e[2].setCoordsPoint2D(a[2]),e[2].subThis(e[0]),e[0].setCoords(0,0)):(e[0].setCoordsPoint2D(a[0]),e[1].setCoordsPoint2D(a[1]),e[2].setCoordsPoint2D(a[2]));e[0].mulThis(b[0]);e[1].mulThis(b[1]);e[2].mulThis(b[2]);c[1].setCoords(e[1].x-e[0].x,e[1].y-e[0].y);c[2].setCoordsPoint2D(e[2].sub(e[1]));c[2].subThis(c[1]);c[1].x*=2;c[1].y*=2;c[0].setCoordsPoint2D(e[0])}function Pe(a,b,c,d,e){const f=l.MPValue.constructDouble(b[0]),g=l.MPValue.constructDouble(b[1]),h=l.MPValue.constructDouble(b[2]);c[0].setDouble(a[0].x);
c[0].mulThis(f);c[1].setDouble(a[1].x);c[1].mulThis(g);c[2].setDouble(a[2].x);c[2].mulThis(h);c[2].subThis(c[1]);c[1].subThis(c[0]);c[2].subThis(c[1]);c[1].ldexpThis(1);d[0].setDouble(a[0].y);d[0].mulThis(f);d[1].setDouble(a[1].y);d[1].mulThis(g);d[2].setDouble(a[2].y);d[2].mulThis(h);d[2].subThis(d[1]);d[1].subThis(d[0]);d[2].subThis(d[1]);d[1].ldexpThis(1);e[0].setDouble(b[0]);e[1].setDouble(b[1]);e[2].setThis(e[1]);e[2].ldexpThis(1);e[2].negateThis();e[2].addThis(e[0]);e[2].addDoubleThis(b[2]);
e[1].subThis(e[0]);e[1].ldexpThis(1)}function Ji(a,b,c){for(let d=0;3>d;++d)c[d].setCoordsPoint2DZ(a[d].mul(b[d]),b[d])}function Ki(a,b,c,d){if(0===c)return d.assign(a[0]),b[0];if(1===c)return d.assign(a[2]),b[2];var e=[a[0].x*b[0],a[1].x*b[1],a[2].x*b[2]],f=[a[0].y*b[0],a[1].y*b[1],a[2].y*b[2]];b=[b[0],b[1],b[2]];if(.5>=c){var g=l.lerpLo(e[0],e[1],c);e=l.lerpLo(e[1],e[2],c);e=l.lerp(g,e,c);g=l.lerpLo(f[0],f[1],c);f=l.lerpLo(f[1],f[2],c);f=l.lerp(g,f,c);g=l.lerpLo(b[0],b[1],c);b=l.lerpLo(b[1],b[2],
c);c=l.lerpLo(g,b,c)}else g=l.lerpHi(e[0],e[1],c),e=l.lerpHi(e[1],e[2],c),e=l.lerpHi(g,e,c),g=l.lerpHi(f[0],f[1],c),f=l.lerpHi(f[1],f[2],c),f=l.lerpHi(g,f,c),g=l.lerpHi(b[0],b[1],c),b=l.lerpHi(b[1],b[2],c),c=l.lerpHi(g,b,c);d.setCoords(e/c,f/c);og(a,d);return c}function mg(a,b){b.setCoords(a.x/a.z,a.y/a.z);return a.z}function Na(a,b,c,d,e){if(e){if(0>c){a=new Z({start:a[0],end:a[0].add(gg(a,b,0).getUnitVector())});sb(a,c,d);return}if(1<c){a=new Z({start:a[2],end:a[2].add(gg(a,b,1).getUnitVector())});
sb(a,c-1,d);return}}Ki(a,b,c,d)}function pg(a,b,c,d){d.setEmpty();const e=[];e.push(new l.Envelope1D(0,1));const f=.5*Math.max(c.width(),c.height());for(;e.length;){const h=e.at(-1);e.pop();var g=new Va;ae(a,b,h,g);if(g.isIntersectingW(c)){const k=Math.max(g.width(),g.height());c.containsW(g)||k<=f||1E-12>h.width()?d.merge(h):(g=h.getCenter(),e.push(l.Envelope1D.construct(h.vmin,g)),e.push(l.Envelope1D.construct(g,h.vmax)))}}}function Yb(a){return a[1]/Math.sqrt(a[0]*a[2])}function ld(a,b){a=l.lerp(Math.sqrt(a[2]/
a[0]),1,b);return b/a}function be(a,b){a=l.lerp(Math.sqrt(a[0]/a[2]),1,b);return b/a}function kg(a,b,c,d){p.geometryReleaseAssert(0<=b&&1>=b);(new X).setCoordsPoint3D(a[0]);(new X).setCoordsPoint3D(a[1]);(new X).setCoordsPoint3D(a[2]);const e=new X,f=new X,g=new X;l.lerpPoint(3,a[0],a[1],b,e);l.lerpPoint(3,a[1],a[2],b,f);l.lerpPoint(3,e,f,b,g);b=a[2].clone();c&&(c[0].assign(a[0]),c[1].assign(e),c[2].assign(g));d&&(d[0].assign(g),d[1].assign(f),d[2].assign(b))}function lg(a,b,c,d){a=[a[0],a[1],a[2]];
p.geometryReleaseAssert(0<=b&&1>=b&&c!==d);const e=l.lerp(a[0],a[1],b),f=l.lerp(a[1],a[2],b);b=l.lerp(e,f,b);c&&(c[0]=a[0],c[1]=e,c[2]=b);d&&(d[0]=b,d[1]=f,d[2]=a[2])}function og(a,b){const c=l.Envelope1D.constructEmpty();c.vmin=c.vmax=a[0].x;c.mergeNeCoordinate(a[1].x);c.mergeNeCoordinate(a[2].x);b.x=l.snap(b.x,c.vmin,c.vmax);c.vmin=c.vmax=a[0].y;c.mergeNeCoordinate(a[1].y);c.mergeNeCoordinate(a[2].y);b.y=l.snap(b.y,c.vmin,c.vmax)}function ng(a,b){const c=new l.Envelope1D;c.vmin=c.vmax=a[0].x;c.mergeNeCoordinate(a[1].x);
c.mergeNeCoordinate(a[2].x);b[0].x=l.snap(b[0].x,c.vmin,c.vmax);b[1].x=l.snap(b[1].x,c.vmin,c.vmax);b[2].x=l.snap(b[2].x,c.vmin,c.vmax);c.vmin=c.vmax=a[0].y;c.mergeNeCoordinate(a[1].y);c.mergeNeCoordinate(a[2].y);b[0].y=l.snap(b[0].y,c.vmin,c.vmax);b[1].y=l.snap(b[1].y,c.vmin,c.vmax);b[2].y=l.snap(b[2].y,c.vmin,c.vmax)}function Ni(a){a=a.calculateUpperLength2D();return 256*l.doubleEps()*a}function qg(a,b,c=!1){b[1].setCoords(a.m_cp[0].x-a.getStartX(),a.m_cp[0].y-a.getStartY());b[1].mulThis(3);b[2].setCoords(a.m_cp[1].x-
a.m_cp[0].x,a.m_cp[1].y-a.m_cp[0].y);b[2].mulThis(3);b[3]=a.getEndXY().sub(a.getStartXY());b[3].subThis(b[2]);b[2].subThis(b[1]);c?b[0].setCoords(0,0):b[0]=a.getStartXY()}function Qe(a,b,c){let d=a[1].x;d-=a[0].x;d*=3;let e=a[2].x;e-=a[1].x;e*=3;let f=a[3].x;f-=a[0].x;f-=e;e-=d;b[3].setWithEps(f);b[2].setWithEps(e);b[1].setWithEps(d);c?b[0].set(0):b[0].set(a[0].x)}function Re(a,b,c){let d=a[1].y;d-=a[0].y;d*=3;let e=a[2].y;e-=a[1].y;e*=3;let f=a[3].y;f-=a[0].y;f-=e;e-=d;b[3].setWithEps(f);b[2].setWithEps(e);
b[1].setWithEps(d);c?b[0].set(0):b[0].set(a[0].y)}function od(a,b,c=!1){const d=l.makeObjectArray(ua,4);d[0].assignPoint2D(a[0]);d[1].assignPoint2D(a[1]);d[2].assignPoint2D(a[2]);d[3].assignPoint2D(a[3]);b[1].setCoords(d[1].x.sub(d[0].x),d[1].y.sub(d[0].y));b[1].mulThis(l.MPValue.constructInt32(3));b[2].setCoords(d[2].x.sub(d[1].x),d[2].y.sub(d[1].y));b[2].mulThis(l.MPValue.constructInt32(3));b[3]=d[3].sub(d[0]);b[3]=b[3].sub(b[2]);b[2]=b[2].sub(b[1]);c?b[0].setCoords(l.s_zero$1,l.s_zero$1):b[0]=
d[0].clone()}function de(a,b,c){if(c){if(0>b)return b;if(1<b)return b-1+de(a,1,!1)}if(a.isDegenerate(0))return 0;c=1===b;const d=ee(a);if(c&&!Number.isNaN(d.length)&&!Number.isNaN(d.length))return d.length;const e=Ni(a),f=e/a.calculateUpperLength2D();let g=0;var h=0;for(let r=1,t=d.specialPointsCount();r<t;r++){const u=d.specialPoints[r];a:{var k=a;var m=Math.min(b,u),n=f,q=e;if(m===h){k=0;break a}const v=l.makeObjectArray(l.Point2D,4);k.queryControlPoints(v);k=l.makeObjectArray(l.Point2D,4);Pc(v,
h,m,k);k=rg(0,k,n,q,[0],0,0)}g+=k;if(b<=u)break;h=u}c&&(d.length=g);return g}function ee(a){if(a.m_cachedValues)return a.m_cachedValues;const b=new pm,c=l.makeObjectArray(l.ECoordinate,8);var d=l.makeObjectArray(l.Point2D,4);a.queryControlPoints(d);d=Oi(d,c);b.specialPoints=[];for(let e=0;e<d;e++)b.specialPoints.push(c[e].value());return a.m_cachedValues=b}function Pi(a){let b=null;return b=a.m_cachedValues}function sg(a){a.m_cachedValues=null}function Qi(a,b){var c=l.makeObjectArray(l.ECoordinate,
4),d=l.makeObjectArray(l.Point2D,4);a.queryControlPoints(d);Qe(d,c,!0);d=l.makeObjectArray(l.ECoordinate,4);var e=l.makeObjectArray(l.Point2D,4);a.queryControlPoints(e);Re(e,d,!0);e=c[3].clone();var f=c[2].clone(),g=c[1].clone();c=d[3].clone();var h=d[2].clone();const k=d[1].clone();d=f.mulE(g).addE(h.mulE(k)).mul(4);g=f.mulE(f).mul(8).addE(e.mulE(g).mul(12)).addE(h.mulE(h).mul(8).addE(c.mulE(k).mul(12)));f=e.mulE(f).addE(c.mulE(h)).mul(36);c=e.mulE(e).addE(c.mulE(c)).mul(36);e=l.makeObjectArray(l.ECoordinate,
3);h=new l.Envelope1D(0,1);d=Ge(c,f,g,d,h,!1,e);p.geometryReleaseAssert(3>=d);if(0<d)for(f=Qc(a,1,0).sqrLength(),c=Qc(a,1,1).sqrLength(),b.set(0),f<c&&(f=c,b.set(1)),c=0;c<d;c++)b=Qc(a,1,e[c].value()).sqrLength(),b<f&&(f=b,b=e[c])}function Wa(a,b,c){const d=new l.Point2D;if(1===b){b=1-c;var e=b*b;const f=c*c,g=a[1].sub(a[0]),h=a[2].sub(a[1]);a=a[3].sub(a[2]);c=g.mul(e).add(h.mul(2*b*c)).add(a.mul(f));d.assign(c.mul(3))}else 2===b?(b=1-c,e=a[2].sub(a[1]).sub(a[1].sub(a[0])),a=a[3].sub(a[2]).sub(a[2].sub(a[1])),
c=e.mul(b).add(a.mul(c)),d.assign(c.mul(6))):3===b?(c=a[2].sub(a[1]),c=a[3].sub(c.mul(3)).sub(a[0]),d.assign(c.mul(6))):d.setCoords(0,0);return d}function Qc(a,b,c){const d=l.makeObjectArray(l.Point2D,4);a.queryControlPoints(d);return Wa(d,b,c)}function Ri(a){const b=a.m_cp[0].sub(a.getStartXY()),c=a.m_cp[1].sub(a.m_cp[0]);a=a.getEndXY().sub(a.getStartXY());b.mulThis(3);c.mulThis(3);a.subThis(c);c.subThis(b);return(3*a.x*(2*c.y+5*b.y)-3*a.y*(2*c.x+5*b.x)+10*(c.x*b.y-c.y*b.x))/60}function fe(a){const b=
l.makeObjectArray(l.Point2D,4);a.queryControlPoints(b);const c=Se(b);c&&(a.m_cp[0].setCoordsPoint2D(b[1]),a.m_cp[1].setCoordsPoint2D(b[2]),a.afterCompletedModification());return c}function Se(a){let b=!1;for(let c=0;2>c;c++){const d=l.compareNoNANs(a[0][c],a[3][c]);if(0<d)0>l.compareNoNANs(a[0][c],a[1][c])&&(a[1][c]=a[0][c],b=!0),0>l.compareNoNANs(a[1][c],a[3][c])&&(a[1][c]=a[3][c],b=!0),0>l.compareNoNANs(a[0][c],a[2][c])&&(a[2][c]=a[0][c],b=!0),0>l.compareNoNANs(a[2][c],a[3][c])&&(a[2][c]=a[3][c],
b=!0),0>l.compareNoNANs(a[1][c],a[2][c])&&(a[2][c]=a[1][c],b=!0);else if(0>d)0<l.compareNoNANs(a[0][c],a[1][c])&&(a[1][c]=a[0][c],b=!0),0<l.compareNoNANs(a[1][c],a[3][c])&&(a[1][c]=a[3][c],b=!0),0<l.compareNoNANs(a[0][c],a[2][c])&&(a[2][c]=a[0][c],b=!0),0<l.compareNoNANs(a[2][c],a[3][c])&&(a[2][c]=a[3][c],b=!0),0<l.compareNoNANs(a[1][c],a[2][c])&&(a[2][c]=a[1][c],b=!0);else if(a[1][c]!==a[0][c]||a[2][c]!==a[0][c])a[1][c]=a[0][c],a[2][c]=a[0][c],b=!0}return b}function Te(a,b,c){const d=new l.Point2D,
e=new l.Point2D,f=new l.Point2D,g=new l.Point2D,h=new l.Point2D;.5>=b?(l.lerpPointLo(2,a[0],a[1],b,d),l.lerpPointLo(2,a[1],a[2],b,e),l.lerpPointLo(2,a[2],a[3],b,f),l.lerpPointLo(2,d,e,b,g),l.lerpPointLo(2,e,f,b,h),l.lerpPointLo(2,g,h,b,c)):(l.lerpPointHi(2,a[0],a[1],b,d),l.lerpPointHi(2,a[1],a[2],b,e),l.lerpPointHi(2,a[2],a[3],b,f),l.lerpPointHi(2,d,e,b,g),l.lerpPointHi(2,e,f,b,h),l.lerpPointHi(2,g,h,b,c))}function ge(a,b,c,d){p.geometryReleaseAssert(0<=b&&1>=b);const e=new l.Point2D,f=new l.Point2D,
g=new l.Point2D,h=new l.Point2D,k=new l.Point2D,m=new l.Point2D;.5>=b?(l.lerpPointLo(2,a[0],a[1],b,e),l.lerpPointLo(2,a[1],a[2],b,f),l.lerpPointLo(2,a[2],a[3],b,g),l.lerpPointLo(2,e,f,b,h),l.lerpPointLo(2,f,g,b,k),l.lerpPointLo(2,h,k,b,m)):(l.lerpPointHi(2,a[0],a[1],b,e),l.lerpPointHi(2,a[1],a[2],b,f),l.lerpPointHi(2,a[2],a[3],b,g),l.lerpPointHi(2,e,f,b,h),l.lerpPointHi(2,f,g,b,k),l.lerpPointHi(2,h,k,b,m));b=a[3].clone();c&&(c[0].assign(a[0]),c[1].assign(e),c[2].assign(h),c[3].assign(m));d&&(d[0].assign(m),
d[1].assign(k),d[2].assign(g),d[3].assign(b))}function Pc(a,b,c,d){p.geometryReleaseAssert(0<=b&&1>=c&&b<=c);if(b===c)c=new l.Point2D,Ia(a,b,c),d[0].assign(c),d[1].assign(c),d[2].assign(c),d[3].assign(c);else if(0===b&&1===c)for(b=0;4>b;++b)d[b].assign(a[b]);else{var e=l.makeObjectArray(l.Point2D,4);ge(a,c,e,null);ge(e,0<c?b/c:0,null,e);Ia(a,b,e[0]);Ia(a,c,e[3]);d[0].setCoordsPoint2D(e[0]);d[1].setCoordsPoint2D(e[1]);d[2].setCoordsPoint2D(e[2]);d[3].setCoordsPoint2D(e[3])}}function Ia(a,b,c,d){if(d){if(0>
b){a=new Z({start:a[0],end:a[0].add(tg(a,0).getUnitVector())});sb(a,b,c);return}if(1<b){a=new Z({start:a[3],end:a[3].add(tg(a,1).getUnitVector())});sb(a,b-1,c);return}}if(.5>=b){var e=new l.Point2D;l.lerpPointLo(2,a[0],a[1],b,e);d=new l.Point2D;l.lerpPointLo(2,a[1],a[2],b,d);var f=new l.Point2D;l.lerpPointLo(2,a[2],a[3],b,f);a=new l.Point2D;l.lerpPointLo(2,e,d,b,a);e=new l.Point2D;l.lerpPointLo(2,d,f,b,e);l.lerpPointLo(2,a,e,b,c)}else e=new l.Point2D,l.lerpPointHi(2,a[0],a[1],b,e),d=new l.Point2D,
l.lerpPointHi(2,a[1],a[2],b,d),f=new l.Point2D,l.lerpPointHi(2,a[2],a[3],b,f),a=new l.Point2D,l.lerpPointHi(2,e,d,b,a),e=new l.Point2D,l.lerpPointHi(2,d,f,b,e),l.lerpPointHi(2,a,e,b,c)}function tg(a,b){b=l.snap(b,0,1);let c=Wa(a,1,b);c.isZero()&&(c=Wa(a,2,b),c.isZero()?c=Wa(a,3,b):1===b&&c.negateThis());return c}function Si(a,b,c){0>b.value()&&b.set(0,b.eps());1<b.value()&&b.set(1,b.eps());var d=c.setE;const e=[S.constructPoint2D(a[0]),S.constructPoint2D(a[1]),S.constructPoint2D(a[2]),S.constructPoint2D(a[3])];
a=new S;const f=l.s_one.subE(b),g=f.sqr(),h=b.sqr();b=e[1].subE(e[0]).mulE(g).addE(e[2].subE(e[1]).mulE((new l.ECoordinate(2)).mulE(f).mulE(b))).addE(e[3].subE(e[2]).mulE(h));a.setE(b.mulE(new l.ECoordinate(3)));d.call(c,a)}function Ti(a,b,c,d,e){if(e){if(0!==sc(b,c))return a?4:2}else if(zc(b,c))return 1;return 0!==he(a,b,c,null,null,null,d,void 0===e?!1:e,!0,!1)?4:0}function Ui(a,b,c,d,e){if(e){if(0!==sc(b,c))return a?4:2}else if(zc(b,c))return 1;return 0!==ug(a,b,c,null,null,null,d,void 0===e?!1:
e,!0,!1)?4:0}function Vi(a,b,c,d,e){if(e){if(0!==sc(b,c))return a?4:2}else if(zc(b,c))return 1;return 0!==vg(a,b,c,null,null,null,d,void 0===e?!1:e,!0,!1)?4:0}function he(a,b,c,d,e,f,g,h,k,m){null!==e&&(e.length=0);null!=f&&(f.length=0);null!==d&&(d.length=0);if(c.isDegenerate(0)){a=[0,0,0];c=b.intersectPoint(c.getStartXY(),a,g);if(0<c){if(null!==e)for(g=0;g<c;g++)e.push(a[g]);if(null!==f)for(e=0;e<c;e++)f.push(0);if(null!=d)for(f=0;f<c;f++)e=new l.Point2D,b.queryCoord2D(a[f],e),d.push(e)}return c}var n=
rb(b,c);g=Math.max(g,n);if(Eb(b,c,g))return 0;var q=l.makeObjectArray(l.Point2D,4);qg(b,q);var r=c.getEndXY();r.subThis(c.getStartXY());n=r.clone();n.leftPerpendicularThis();var t=3*q[3].dotProduct(n),u=2*q[2].dotProduct(n);let v=q[1].dotProduct(n);n=Array(15);const w=Array(15);t=Ac(t,u,v,l.Envelope1D.unit(),!1,n);0>t&&(n[0]=0,n[1]=1,t=2);let x=0;for(let z=0,A=x;z<t;++z)u=b.getCoord2D(n[z+A]),w[x]=c.getClosestCoordinate(u,!1),l.Point2D.distance(u,c.getCoord2D(w[x]))<=g&&(n[x]=n[z+A],x++);q[0].subThis(c.getStartXY());
Math.abs(r.x)>=Math.abs(r.y)?(r=r.y/r.x,t=q[3].y-q[3].x*r,u=q[2].y-q[2].x*r,v=q[1].y-q[1].x*r,r=q[0].y-q[0].x*r):(r=r.x/r.y,t=q[3].x-q[3].y*r,u=q[2].x-q[2].y*r,v=q[1].x-q[1].y*r,r=q[0].x-q[0].y*r);const y=b.getEndXY().equals(c.getStartXY())||b.getEndXY().equals(c.getEndXY());q=[0,0,0];t=bi(t,u,v,r,l.Envelope1D.unit(),y,q);for(let z=0,A=x;z<t;++z)n[z+A]=q[z],u=b.getCoord2D(n[z+A]),w[x]=c.getClosestCoordinate(u,!1),l.Point2D.distance(u,c.getCoord2D(w[x]))<=g&&(n[x]=n[z+A],x++);t=b.intersectPoint(c.getStartXY(),
q,g);for(u=0;u<t;u++)n[x]=q[u],w[x++]=0;t=b.intersectPoint(c.getEndXY(),q,g);for(u=0;u<t;u++)n[x]=q[u],w[x++]=1;0!==c.intersectPoint(b.getStartXY(),q,g)&&(w[x]=q[0],n[x++]=0);0!==c.intersectPoint(b.getEndXY(),q,g)&&(w[x]=q[0],n[x++]=1);return 0===x?0:Fb(a,b,c,n,w,x,d,e,f,g,h,k,m)}function ug(a,b,c,d,e,f,g,h,k,m){if(Ha(c))return c=new Z({start:c.getStartXY(),end:c.getEndXY()}),he(a,b,c,d,e,f,g,h,k,m);var n=rb(b,c);g=Math.max(g,n);if(Eb(b,c,g))return 0;n=[];const q=[],r=[],t=l.makeObjectArray(l.Point2D,
4);b.queryControlPoints(t);var u=l.makeObjectArray(l.Point2D,4),v=new l.Transformation2D;c.canonicToWorldTransformation(v);var w=new l.Transformation2D;w.setInvert(v);w.transformPoints2D(t,4,u);v=l.makeObjectArray(ua,4);od(u,v);u=[v[0].x,v[1].x,v[2].x,v[3].x];v=[v[0].y,v[1].y,v[2].y,v[3].y];w=l.makeObjectArray(l.MPValue,3);w[0].setDouble(c.getSemiMinorAxis());w[0].sqrThis();w[1].setDouble(c.getSemiMajorAxis());w[1].sqrThis();w[2].setThis(w[0]);w[2].mulThis(w[1]);w[2].negateThis();u=gi(u,3,v,3,null,
0,w,!0,l.Envelope1D.unit(),l.Envelope1D.unit(),q);if(0<u){v=0;for(w=0;w<u;w++){var x=new l.Point2D;b.queryCoord2D(q[w],x);var y=c.getClosestCoordinate(x,!1);const z=new l.Point2D;c.queryCoord2D(y,z);l.Point2D.distance(x,z)<=g&&(n.push(x.clone()),q[v]=q[w],r.push(y),v++)}q.length=v;n.length=v}u=[0,1];for(v=0;2>v;v++)w=0===v?c.getStartXY():c.getEndXY(),x=[0],pd(t,w,l.Envelope1D.unit(),!1,-1,1,x),y=new l.Point2D,Ia(t,x[0],y),l.Point2D.distance(w,y)<=g&&(q.push(x[0]),r.push(u[v]),n.push(y.clone()));for(v=
0;2>v;v++)w=[0,3],x=c.getClosestCoordinate(t[w[v]],!1),y=new l.Point2D,c.queryCoord2D(x,y),l.Point2D.distance(t[w[v]],y)<=g&&(q.push(u[v]),r.push(x),n.push(y.clone()));return Fb(a,b,c,q,r,q.length,d,e,f,g,h,k,m)}function wg(a,b,c,d,e,f,g,h,k,m){var n=l.makeObjectArray(l.Point2D,4);b.queryControlPoints(n);const q=l.makeObjectArray(l.Point2D,4);c.queryControlPoints(q);if(0>Uf(n,q,4))return wg(a,c,b,d,f,e,g,h,k,!m);var r=rb(b,c);g=Math.max(g,r);if(Eb(b,c,g))return 0;a:{r=l.makeObjectArray(l.Point2D,
4);b.queryControlPoints(r);var t=l.makeObjectArray(l.Point2D,4);c.queryControlPoints(t);if(r[0].equals(t[0])){if(r[1].equals(t[1])&&r[2].equals(t[2])&&r[3].equals(t[3])){d&&(d.length=0,d.push(r[0]),d.push(r[3]));e&&(e.length=0,e.push(0),e.push(1));f&&(f.length=0,f.push(0),f.push(1));r=!0;break a}if(!r[0].equals(t[3])){r=!1;break a}}r[0].equals(t[3])&&r[1].equals(t[2])&&r[2].equals(t[1])&&r[3].equals(t[0])?(e&&(e.length=0,e.push(0),e.push(1),m&&(e[1]=l.swap(e[0],e[0]=e[1]))),f&&(f.length=0,f.push(1),
f.push(0),m&&(f[1]=l.swap(f[0],f[0]=f[1]))),d&&(d.length=0,d.push(r[0]),d.push(r[3]),m&&(d[1]=l.swap(d[0],d[0]=d[1]))),r=!0):r=!1}if(r)return 2;t=new l.Envelope1D(0,1);r=new l.Envelope1D(0,1);var u=new Va;qd(n,new l.Envelope1D(0,1),u);var v=new Va;qd(q,new l.Envelope1D(0,1),v);var w=Math.max(u.maxDim(),v.maxDim());u.inflate(3*g);v.inflate(3*g);if(!u.intersectW(v))return 0;if(u.maxDim()<.1*w){xg(n,u,t);xg(q,u,r);if(t.isEmpty()||r.isEmpty())return 0;Pc(n,t.vmin,t.vmax,n);Pc(q,r.vmin,r.vmax,q)}var x=
jd(n,3,q,3,g);if(0===x)return 0;w=[];u=[];v=[];var y=!1;if(-1===x){x=l.makeObjectArray(ua,4);od(n,x);var z=[x[0].x,x[1].x,x[2].x,x[3].x],A=[x[0].y,x[1].y,x[2].y,x[3].y],C=l.makeObjectArray(ua,4);od(q,C);x=[];var B=[];z=hd(z,3,A,3,null,0,[C[0].x,C[1].x,C[2].x,C[3].x],3,[C[0].y,C[1].y,C[2].y,C[3].y],3,null,0,!0,l.Envelope1D.unit(),l.Envelope1D.unit(),x,B);if(0<z)for(A=0;A<z;A++){C=new l.Point2D;Ia(q,B[A],C);var E=new l.Point2D;Ia(n,x[A],E);l.Point2D.distance(E,C)<=g&&(w.push(E.clone()),v.push(B[A]),
u.push(x[A]))}else-1===z&&(y=!0)}for(x=0;2>x;x++)for(B=0===x?n:q,z=0===x?q:n,A=0;2>A;A++){C=0===A?0:3;E=[0];pd(z,B[C],l.Envelope1D.unit(),!1,-1,1,E);const G=new l.Point2D;Ia(z,E[0],G);l.Point2D.distance(B[C],G)<=g&&(0===x?(u.push(0===C?0:1),v.push(E[0])):(v.push(0===C?0:1),u.push(E[0])),w.push(G.clone()))}0===u.length&&y&&(y=b.calculateUpperLength2D(),x=c.calculateUpperLength2D(),y=y>x,x=[0,0],2===qm(y?b:c,x,!0)&&(p.geometryReleaseAssert(l.Envelope1D.unit().containsCoordinate(x[0])),l.Envelope1D.unit().containsCoordinate(x[1])||
(B=new l.Point2D,Ia(y?n:q,x[0],B),z=[0,0],1===pd(y?q:n,B,l.Envelope1D.unit(),!1,-1,2,z)&&(w.push(B.clone()),u.push(y?x[0]:z[0]),v.push(y?z[0]:x[0])))));if(0===u.length)return 0;if(!t.equalsRange(0,1))for(n=0;n<u.length;++n)u[n]=Gb.recalculateParentT(t.vmin,t.vmax,u[n]);if(!r.equalsRange(0,1))for(n=0;n<v.length;++n)v[n]=Gb.recalculateParentT(r.vmin,r.vmax,v[n]);return Fb(a,b,c,u,v,u.length,d,e,f,g,h,k,m)}function vg(a,b,c,d,e,f,g,h,k,m){var n=rb(b,c);if(c.isDegenerateToLineHelper(n)){n=new Z({start:c.getStartXY(),
end:c.getEndXY()});a=he(a,b,n,d,e,f,g,h,k,m);if(f)for(b=0;b<a;++b)d=n.getCoord2D(f[b]),f[b]=c.getClosestCoordinate(d,!1);return a}g=Math.max(g,n);if(Eb(b,c,g))return 0;var q=l.makeObjectArray(l.Point2D,4);b.queryControlPoints(q);const r=l.makeObjectArray(l.Point2D,3);c.queryControlPoints(r);var t=new l.Envelope1D(0,1),u=new l.Envelope1D(0,1);n=[0,0,0];c.queryWeights(n);const v=[1,Yb(n),1];var w=new Va;qd(q,new l.Envelope1D(0,1),w);var x=new Va;ae(r,v,new l.Envelope1D(0,1),x);var y=Math.max(w.maxDim(),
x.maxDim());w.inflate(3*g);x.inflate(3*g);if(!w.intersectW(x))return 0;if(w.maxDim()<.1*y){xg(q,w,t);pg(r,v,w,u);if(t.isEmpty()||u.isEmpty())return 0;Pc(q,t.vmin,t.vmax,q);Oc(r,v,u.vmin,u.vmax,r,v)}var z=jd(q,3,r,2,g);if(0===z)return 0;y=[];w=[];x=[];if(-1===z){z=l.makeObjectArray(ua,4);od(q,z);var A=[z[0].x,z[1].x,z[2].x,z[3].x],C=[z[0].y,z[1].y,z[2].y,z[3].y],B=l.makeObjectArray(l.MPValue,3),E=l.makeObjectArray(l.MPValue,3),G=l.makeObjectArray(l.MPValue,3);Pe(r,v,B,E,G);z=[];var I=[];A=hd(B,2,E,
2,G,2,A,3,C,3,null,0,!0,l.Envelope1D.unit(),l.Envelope1D.unit(),I,z);if(0<A)for(C=0;C<A;C++)B=new l.Point2D,Ia(q,z[C],B),E=new l.Point2D,Na(r,v,I[C],E),l.Point2D.distance(B,E)<=g&&(y.push(B.clone()),w.push(z[C]),x.push(I[C]))}for(z=0;2>z;z++)for(0===z?(I=q,A=r):(A=q,I=r),C=0;2>C;C++){B=0===C?0:I.length-1;E=[0];G=new l.Point2D;if(0===z){var H=ig(A,v,I[B],l.Envelope1D.unit(),!1,-1,1,E);p.geometryReleaseAssert(1===H);Na(A,v,E[0],G)}else H=pd(A,I[B],l.Envelope1D.unit(),!1,-1,1,E),p.geometryReleaseAssert(1===
H),Ia(A,E[0],G);l.Point2D.distance(I[B],G)<=g&&(0===z?(w.push(0===B?0:1),x.push(E[0])):(x.push(0===B?0:1),w.push(E[0])),y.push(G.clone()))}if(0===w.length)return 0;if(!t.equalsRange(0,1))for(q=0;q<w.length;++q)w[q]=Gb.recalculateParentT(t.vmin,t.vmax,w[q]);if(!u.equalsRange(0,1))for(t=0;t<x.length;++t)x[t]=lb.recalculateParentT(u.vmin,u.vmax,x[t]);for(u=0;u<x.length;++u)x[u]=ld(n,x[u]);return Fb(a,b,c,w,x,w.length,d,e,f,g,h,k,m)}function Wi(a,b,c,d,e,f,g,h,k,m){var n=rb(b,c);g=Math.max(g,n);if(Eb(b,
c,g))return 0;n=l.makeObjectArray(l.Point2D,4);b.queryControlPoints(n);const q=l.makeObjectArray(l.Point2D,3);c.queryControlPoints(q);var r=jd(n,3,q,2,g);if(0===r)return 0;const t=[],u=[],v=[];if(-1===r){var w=l.makeObjectArray(ua,4);od(n,w);r=[w[0].x,w[1].x,w[2].x,w[3].x];w=[w[0].y,w[1].y,w[2].y,w[3].y];var x=l.makeObjectArray(ua,3);id(q,x);r=hd([x[0].x,x[1].x,x[2].x],2,[x[0].y,x[1].y,x[2].y],2,null,0,r,3,w,3,null,0,!0,l.Envelope1D.unit(),l.Envelope1D.unit(),v,u);if(0<r){w=0;for(x=0;x<r;x++){var y=
new l.Point2D;b.queryCoord2D(u[x],y);var z=new l.Point2D;c.queryCoord2D(v[x],z);l.Point2D.distance(y,z)<=g&&(t.push(y.clone()),u[w]=u[x],v[w]=v[x],w++)}u.length=w;t.length=w}}for(r=0;2>r;r++)for(0===r?(w=n,x=q):(x=n,w=q),y=0;2>y;y++){z=0===y?0:w.length-1;const A=[0],C=new l.Point2D;if(0===r)Ke(x,w[z],A),Pb(x,A[0],C);else{const B=pd(x,w[z],l.Envelope1D.unit(),!1,-1,1,A);p.geometryReleaseAssert(1===B);Ia(x,A[0],C)}l.Point2D.distance(w[z],C)<=g&&(0===r?(u.push(0===z?0:1),v.push(A[0])):(v.push(0===z?
0:1),u.push(A[0])),t.push(C.clone()))}return Fb(a,b,c,u,v,u.length,d,e,f,g,h,k,m)}function qd(a,b,c){if(b.equalsRange(0,1))c.setFromPoints(a,4);else{var d=l.makeObjectArray(l.Point2D,4);Pc(a,b.vmin,b.vmax,d);c.setFromPoints(d,4)}}function pd(a,b,c,d,e,f,g){p.checkAndThrow(l.Envelope1D.unit().contains(c)&&0<f,"getClosestCoordinate");if(0>e||Number.isNaN(e))e=Number.MAX_VALUE;const h=[],k=new l.Point2D;Ia(a,c.vmin,k);var m=l.Point2D.distance(k,b);m<=e&&h.push(new l.Point2D(c.vmin,m));c.vmin!==c.vmax&&
(Ia(a,c.vmax,k),m=l.Point2D.distance(k,b),m<=e&&h.push(new l.Point2D(c.vmax,m)));if(0<c.width()){const n=Array(18);m=new Xi(a,b);const q=qc(m,c,18,n);for(let r=0;r<q;r++)Ia(a,n[r],k),m=l.Point2D.distance(k,b),m>e||h.push(new l.Point2D(n[r],m))}d&&(p.geometryReleaseAssert(c.equals(l.Envelope1D.unit())),Ia(a,-1,k,!0),m=new l.Point2D,Ia(a,0,m),m=new Z({start:k,end:m}),d=m.getClosestCoordinate(b,!0),1>d&&(k.assign(m.getCoord2D(d)),m=l.Point2D.distance(k,b),m<=e&&h.push(new l.Point2D(d-1,m))),Ia(a,2,k,
!0),m=new l.Point2D,Ia(a,c.vmax,m),m=new Z({start:m,end:k}),c=m.getClosestCoordinate(b,!0),0<c&&(k.assign(m.getCoord2D(c)),m=l.Point2D.distance(k,b),m<=e&&h.push(new l.Point2D(1+c,m))));if(!h.length)return 0;h.sort((n,q)=>n.compare(q));b=0;e=h[0].x;g[b++]=e;if(b<f){a=Ih(a,4,!1).total();b=h[0].y;for(let n=1,q=h.length;n<q;n++)if(h[n].y>b+a){h.length=n;break}h.sort((n,q)=>l.standardNumericCompare(n.x,q.x));b=0;g[b++]=h[0].x;for(let n=1,q=h.length;n<q;n++)h[n].x!==g[b-1]&&b<f&&(g[b++]=h[n].x)}return b}
function Ue(a,b,c,d,e,f,g){const h=l.makeObjectArray(l.Point2D,4);a.queryControlPoints(h);return pd(h,b,c,d,e,f,g)}function rm(a){return a[0].norm(1)+a[1].norm(1)+a[2].norm(1)+a[3].norm(1)}function sm(a,b,c){p.geometryReleaseAssert(2<=c);if(2===c){var d=new l.Point2D;l.lerpPoint2D(b[0],b[c-1],1/3,d);var e=new l.Point2D;l.lerpPoint2D(b[0],b[c-1],2/3,e);a.construct(b[0],d,e,b[c-1])}else{var f=b[0],g=b[c-1];e=[0,0];var h=Ue(a,f,l.Envelope1D.unit(),!1,Number.NaN,2,e),k=[0,0],m=Ue(a,g,l.Envelope1D.unit(),
!1,Number.NaN,2,k);d=[];for(var n=0;n<h;n++)for(let q=0;q<m;q++){const r=e[n],t=k[q],u=new l.Point2D,v=new l.Point2D,w=((y,z)=>{const A=[];A.length=c-2;var C=()=>{let Q=0;for(let O=1,P=c-1;O<P;O++)Q+=l.Point2D.distance(b[O-1],b[O]),A[O-1]=Q;Q+=l.Point2D.distance(b[c-2],b[c-1]);for(let O=1,P=c-1;O<P;O++)A[O-1]/=Q};let B=!1,E=!1;var G=new W;r<=t?(a.queryCut(r,t,G,!0),y.assign(G.get().getControlPoint1()),z.assign(G.get().getControlPoint2())):(a.queryCut(t,r,G,!0),y.assign(G.get().getControlPoint2()),
z.assign(G.get().getControlPoint1()));f.equals(y)&&(B=!0);g.equals(z)&&(E=!0);C();G=Number.MAX_VALUE;const I=y.clone(),H=z.clone();for(var L=0;5>L;L++)G=yg(!0,!1,f,I,H,g,B,E,A,c-2,b,c);for(L=0;30>L;L++){var M=I.clone();H.clone();var N=yg(!0,!0,f,I,H,g,B,E,A,c-2,b,c);if(G<=N&&M.equals(I)&&M.equals(H))break;G=N}C();C=!1;L=Number.EPSILON;M=y.clone();N=z.clone();for(let Q=0;30>Q;Q++){const O=M.clone();N.clone();const P=yg(C,!0,f,M,N,g,B,E,A,c-2,b,c);if(L<=P&&O.equals(M)&&O.equals(N))break;C=!0;L=P}L<
G?(y.assign(M),z.assign(N)):(y.assign(I),z.assign(H),L=G);return L})(u,v),x=l.Point2D.distance(f,u)+l.Point2D.distance(u,v)+l.Point2D.distance(v,g);d.splice(d.length,0,...[w,x,u.x,u.y,v.x,v.y])}e=d[0];h=d[1];k=0;for(m=6;m<d.length;m+=6)d[m]<e&&(e=d[m],h=d[m+1],k=m);m=k;for(n=0;n<d.length;n+=6)n!==k&&d[n+1]<h&&Math.abs(e-d[n])<10*e&&(h=d[n+1],m=n);a.construct(f,new l.Point2D(d[m+2],d[m+3]),new l.Point2D(d[m+4],d[m+5]),g)}}function qm(a,b,c=!1){var d=l.makeObjectArray(l.Point2D,4);a.queryControlPoints(d);
var e=l.makeObjectArray(ua,4);od(d,e,!0);let f;d=e[3].x.isZero();var g=e[3].y.isZero();if(d||g)if(d&&!g){if(e[2].x.isZero())return 0;d=e[1].x.div(e[2].x).negate();g=e[2].y.div(e[3].y);f=e[1].y.div(e[3].y)}else if(!d&&g){if(e[2].y.isZero())return 0;d=e[1].y.div(e[2].y).negate();g=e[2].x.div(e[3].x);f=e[1].x.div(e[3].x)}else return 0;else{e[2].x.divThis(e[3].x);e[1].x.divThis(e[3].x);e[2].y.divThis(e[3].y);e[1].y.divThis(e[3].y);d=e[2].x.sub(e[2].y);if(d.isZero())return 0;d=e[1].x.sub(e[1].y).div(d).negate();
g=e[2].x.clone();f=e[1].x.clone()}if(!c&&2<d.abs().value())return 0;e=[0,0];a=a.getStartXY().equals(a.getEndXY());a=Ac(1,-d.toDouble(),d.add(g).mul(d).add(f).toDouble(),l.Envelope1D.unit(),a,e);return 0===a?0:0<=e[0]&&1>=e[0]&&(g=d.toDouble()-e[0],c||0<=g&&1>=g)?(b[0]=e[0],b[1]=g,b[0]>b[1]&&(b[1]=l.swap(b[0],b[0]=b[1])),2):2===a&&0<=e[1]&&1>=e[1]&&(a=d.toDouble()-e[1],c||0<=a&&1>=a)?(b[0]=e[1],b[1]=a,b[0]>b[1]&&(b[1]=l.swap(b[0],b[0]=b[1])),2):0}function tm(a,b,c){var d=a[1].mulE(b[2]).subThisE(a[2].mulE(b[1])),
e=a[1].mulE(b[3]).subThisE(a[3].mulE(b[1])).mulThis(3);b=a[2].mulE(b[3]).subThisE(a[3].mulE(b[2])).mulThis(3);a=l.makeObjectArray(l.ECoordinate,2);const f=new l.Envelope1D(0,1);d=tb(b,e,d,f,!1,a);0>d&&(d=0);e=0;for(b=0;b<d;b++)l.isOneOf(a[b].value(),0,1)||(c[e].setE(a[b]),e++);return e}function Oi(a,b){b[0].set(0);let c=1;var d=l.makeObjectArray(l.ECoordinate,4);Qe(a,d,!0);var e=l.makeObjectArray(l.ECoordinate,4);Re(a,e,!0);var f=d[3].mul(3),g=d[2].mul(2),h=d[1].clone(),k=l.makeObjectArray(l.ECoordinate,
2),m=new l.Envelope1D(0,1);f=tb(f,g,h,m,!1,k);0>f&&(f=0);for(g=0;g<f;g++)l.isOneOf(k[g].value(),0,1)||(b[c]=k[g],c++);f=e[3].mul(3);g=e[2].mul(2);h=e[1].clone();k=l.makeObjectArray(l.ECoordinate,2);m=new l.Envelope1D(0,1);f=tb(f,g,h,m,!1,k);0>f&&(f=0);for(g=0;g<f;g++)l.isOneOf(k[g].value(),0,1)||(b[c]=k[g],c++);d=tm(d,e,b.slice(c));c+=d;b[c].set(1);c++;if(2<c){l.sortRange(b,0,c,(n,q)=>{n=n.value();q=q.value();return n<q?-1:n>q?1:0});d=0;e=b[0].clone();m=0;k=rm(a)*l.doubleEps();f=new l.Point2D;Te(a,
b[0].value(),f);for(g=1;g<c;g++)if(h=new l.Point2D,Te(a,b[g].value(),h),b[g].eq(e)||h.isEqualPoint2D(f,k)){if(0!==d){if(0===b[g].eps())e.setE(b[g]),m=0;else if(0!==m){h=l.sqr(1/b[g].eps());m=1/m;const n=h+m;e.set((b[g].value()*h+e.value()*m)/n);m=1/n;e.setError(Math.sqrt(m))}b[d].setE(e);Te(a,e.value(),f)}}else d++,b[d].setE(b[g]),e.setE(b[g]),Te(a,e.value(),f),m=l.sqr(b[g].eps());d++;c=d}1===c&&(c=2,b[1].set(1));p.geometryReleaseAssert(0===b[0].value());p.geometryReleaseAssert(1===b[c-1].value());
return c}function xg(a,b,c){c.setEmpty();const d=[];d.push(new l.Envelope1D(0,1));const e=.5*Math.max(b.width(),b.height());for(;d.length;){const g=d.at(-1);d.pop();var f=new Va;qd(a,g,f);if(f.isIntersectingW(b)){const h=Math.max(f.width(),f.height());b.containsW(f)||h<=e||1E-12>g.width()?c.merge(g):(f=g.getCenter(),d.push(l.Envelope1D.construct(g.vmin,f)),d.push(l.Envelope1D.construct(f,g.vmax)))}}}function rg(a,b,c,d,e,f,g){for(;;){var h=l.Point2D.distance(b[0],b[3]),k=l.Point2D.distance(b[0],b[1])+
l.Point2D.distance(b[1],b[2])+l.Point2D.distance(b[2],b[3]);if(k-h<=d+c*k)return a+l.lerp(h,k,.5);h=r=>Wa(b,1,r).length();if(0===f){p.geometryReleaseAssert(8>g);var m=Wa(b,1,0).length(),n=Wa(b,1,1).length();e[0]+=2;m>n&&(n=l.swap(m,m=n),b[3]=l.swap(b[0],b[0]=b[3]),b[2]=l.swap(b[1],b[1]=b[2]));var q=m/(m+n);n=1;let r=k;for(;.03125>q&&r>=32*(d+c*r);){n/=4;q=Wa(b,1,n).length();e[0]++;q=m/(q+m);const t=new l.Point2D;Ia(b,.5*n,t);r=l.Point2D.distance(t,b[0]);if(r<=d){const u=new l.Point2D;Ia(b,n,u);r+=
l.Point2D.distance(u,t)}}if(1!==n){k=l.makeObjectArray(l.Point2D,4);ge(b,n,b,k);a=rg(a,k,c,d,e,0,g+1);f++;g++;continue}}e[0]+=8;m=kc(8,h,0,1);e[0]+=16;n=kc(16,h,0,1);m=Math.abs(m-n)>d+c*k;if(!m)return a+n;if(3>f)k=l.makeObjectArray(l.Point2D,4),ge(b,.5,b,k),a=rg(a,k,c,d,e,f+1,g+1),f++,g++;else{e[0]+=32;f=kc(32,h,0,1);m=Math.abs(n-f)>d+c*k;if(!m)return a+f;e[0]+=64;g=kc(64,h,0,1);m=Math.abs(f-g)>d+c*k;if(!m)return a+g;e[0]+=128;e=kc(128,h,0,1);m=Math.abs(g-e)>d+c*k;return a+e}}}function um(a,b,c,d,
e){let f=!0;const g=Nc(5,b,c,d,e,h=>{const k=Qc(a,1,h);return(f?a.getCoordX(h)-a.getStartX():a.getCoordY(h)-a.getStartY())*k.length()});f=!1;b=Nc(5,b,c,d,e,h=>{const k=Qc(a,1,h);return(f?a.getCoordX(h)-a.getStartX():a.getCoordY(h)-a.getStartY())*k.length()});return new l.Point2D(g,b)}function yg(a,b,c,d,e,f,g,h,k,m,n,q){let r=m=0,t=0,u=0,v=0,w=0,x=0;for(let C=1,B=q-1;C<B;C++){let E,G,I,H,L,M;var y=-1,z=k[C-1];a&&(2<C?(z=l.snap(2*k[C-2]-k[C-3],0,1),k[C-1]=z):2===C&&z<=k[0]&&(z=k[0]));for(z=0;11>z;z++){E=
k[C-1];G=E*E;I=G*E;H=1-E;L=H*H;M=L*H;if(!a)break;if(1E-12>Math.abs(E-y))break;if(10===z)break;y=c.x-2*d.x+e.x;var A=c.x-3*d.x+3*e.x-f.x;const N=c.y-2*d.y+e.y,Q=c.y-3*d.y+3*e.y-f.y,O=c.x-d.x-2*y*E+A*G,P=-n[C].x+c.x*M+E*(3*d.x*L+E*(3*e.x-3*e.x*E+f.x*E)),ia=c.y-d.y-2*N*E+Q*G,ka=-n[C].y+c.y*M+E*(3*d.y*L+E*(3*e.y-3*e.y*E+f.y*E)),Aa=-6*(O*P+ia*ka);A=6*(3*l.sqr(O)-(-2*y+2*A*E)*P)+6*(3*l.sqr(ia)-(-2*N+2*Q*E)*ka);y=E;k[C-1]=l.snap(E-Aa/A,1<C?k[C-2]:0,1)}m+=3*G*L*L;r+=3*I*M;t+=3*G*G*L;z=-(M*c.x+I*f.x-n[C].x);
u+=z*E*L;v+=z*G*H;z=-(M*c.y+I*f.y-n[C].y);w+=z*E*L;x+=z*G*H}b&&(a=m*t-r*r,Math.abs(a)>=1E-12*(Math.abs(m*t)+Math.abs(r*r))+1E-10?(g||(d.x=(u*t-v*r)/a,d.y=(w*t-x*r)/a),h||(e.x=(m*v-r*u)/a,e.y=(m*x-r*w)/a)):(l.lerpPoint2D(c,f,.3,d),l.lerpPoint2D(c,f,.6,e)));g=0;for(let C=1,B=q-1;C<B;C++)a=k[C-1],b=1-a,q=c.mul(l.cube(b)),h=d.mul(3*a*b*b),b=e.mul(3*a*a*b),a=f.mul(l.cube(a)),q=q.add(h).add(b).add(a).sub(n[C]),g+=q.sqrLength();return g}function Yi(a,b,c,d){var e=a.getPathStart(b);a=a.getPathEnd(b);if(!(3>
a-e)){e*=2;b=l.Point2D.getNAN();c.queryPoint2D(e,b);var f=b.x,g=b.y,h=l.Point2D.getNAN();c.queryPoint2D(e+2,h);var k=l.Point2D.getNAN();for(let m=e+4,n=2*a;m<n;m+=2)c.queryPoint2D(m,k),d.pe((k.x-b.x)*(h.y-g)),b.setCoordsPoint2D(h),h.setCoordsPoint2D(k);d.pe((f-b.x)*(h.y-g))}}function rd(a,b){if(a.isEmpty())return!1;const c=a.getGeometryType();if(c===Cc.enumPolygon)return 0===a.calculateArea2D()?!1:!0;if(c===Cc.enumPolyline)return Zi(a.getImpl(),b,!0).bNotEmpty;if(c===Cc.enumEnvelope)return!0;if(p.isSegment(c))return a.isClosed()?
!0:!1;if(p.isPoint(c))return!1;if(c===Cc.enumGeometryCollection){for(let d=0,e=a.getGeometryCount();d<e;d++)if(rd(a.getGeometry(d),b))return!0;return!1}p.throwNotImplementedException("")}function Qb(a,b){var c=a.getGeometryType();if(c===Cc.enumPolygon)return b=new ma({vd:a.getDescription()}),a.isEmpty()||a.copyToUnchecked(b),b;if(c===Cc.enumPolyline)return Zi(a.getImpl(),b,!1).boundary;if(c===Cc.enumEnvelope)return b=new ma({vd:a.getDescription()}),a.isEmpty()||b.addEnvelope(a,!1),b;if(p.isSegment(c))return b=
new Oa({vd:a.getDescription()}),a.isEmpty()||a.isClosed()||(c=new Y,b.reserve(2),a.queryStart(c),b.add(c),a.queryEnd(c),b.add(c)),b;if(c===Cc.enumGeometryCollection){c=null;for(let d=0,e=a.getGeometryCount();d<e;d++){const f=Qb(a.getGeometry(d),b);null!==f&&(null===c&&(c=a.createInstance()),c.addGeometry(f))}return c}if(p.isPoint(c))return new Y({vd:a.getDescription()});p.throwNotImplementedException("")}function Zi(a,b,c){b=null;c||(b=new Oa({vd:a.getDescription()}));if(!a.isEmpty()){const e=new za(0);
for(let f=0,g=a.getPathCount();f<g;f++)if(0<a.getPathSize(f)&&!a.isClosedPathInXYPlane(f)){var d=a.getPathStart(f);e.add(d);d=a.getPathEnd(f)-1;e.add(d)}if(0<e.size()){d=new Zb;const f=a.getAttributeStreamRef(0);d.sort(e,0,e.size(),{userSort(m,n,q){const r=l.Point2D.getNAN(),t=l.Point2D.getNAN();q.sort(m,n,(u,v)=>{f.queryPoint2D(2*u,r);f.queryPoint2D(2*v,t);return r.compare(t)})},getValue(m){return f.read(2*m+1)}});d=f.readPoint2D(2*e.read(0));let g=0,h=1;const k=new Y;for(let m=1,n=e.size();m<n;m++){const q=
f.readPoint2D(2*e.read(m));if(q.isEqualPoint2D(d))e.read(g)>e.read(m)?(e.write(g,l.indexTypeMax()),g=m):e.write(m,l.indexTypeMax()),h++;else{if(0===(h&1))e.write(g,l.indexTypeMax());else if(c)return{bNotEmpty:!0,boundary:new Oa({})};d=q;g=m;h=1}}if(0===(h&1))e.write(g,l.indexTypeMax());else if(c)return{bNotEmpty:!0,boundary:new Oa({})};if(!c){e.sort(0,e.size());for(let m=0,n=e.size();m<n&&e.read(m)!==l.indexTypeMax();m++)a.getPointByVal(e.read(m),k),b.add(k)}}}return c?{bNotEmpty:!1,boundary:new Oa({})}:
{bNotEmpty:!1,boundary:b}}function zg(a){-360<=a&&720>a?0>a?a+=360:360<=a&&(a-=360):(a=l.fmod(a,360),0>a&&(a+=360));180<a&&(a-=360);return a}function $i(a){const b=l.twoPi();if(a>=-b&&a<2*b)return 0>a&&(a+=b),a>=b&&(a-=b),a;a=l.fmod(a,b);0>a&&(a+=b);return a}function aj(a){const b=l.pi();if(a>-b&&a<=b)return a;a=$i(a);a>b&&(a-=l.twoPi());return a}function vm(a,b){return!1}function Ag(a,b,c,d,e=100,f=vm){p.geometryReleaseAssert(0<d);let g,h,k;let m;let n=0,q=0,r,t;const u=l.goldenRatio();b>c&&(c=l.swap(b,
b=c));var v=a(b);var w=a(c);v<w?(g=h=k=b,v=w=m=v):(g=h=k=c,v=w=m=w);let x=0;for(;x<e;++x){var y=.5*(c-b);var z=b+y;r=d*(Math.abs(g)+.25);t=2*r;if(f(g,v)||Math.abs(g-z)<=t-y)break;if(Math.abs(q)>r){var A=(g-h)*(v-m);y=(g-k)*(v-w);let C=(g-k)*y-(g-h)*A;y=2*(y-A);0<y&&(C=-C);y=Math.abs(y);A=q;q=n;if(Math.abs(C)>=Math.abs(y*A*.5)||C<=y*(b-g)||C>=y*(c-g))q=g>=z?b-g:c-g,n=l.goldenRatio()*q;else if(n=C/y,y=g+n,y-b<t||c-y<t)n=0>z-g?-Math.abs(r):Math.abs(r)}else q=g>=z?b-g:c-g,n=q*u;y=g+n;z=a(y);if(z<v)y>=
g?b=g:c=g,k=h,h=g,g=y,m=w,w=v,v=z;else if(y<g?b=y:c=y,z<=w||h===g)k=h,h=y,m=w,w=z;else if(z<=m||k===g||k===h)k=y,m=z}return l.makePair(g,v)}function Bg(a,b,c){a>c?a-=Math.ceil((a-c)/l.geometry2Pi)*l.geometry2Pi:a<b&&(a+=Math.ceil((b-a)/l.geometry2Pi)*l.geometry2Pi);return a}function mb(a,b,c){const d=c.x;c=c.y;return bj(a,b,Math.cos(d),Math.sin(d),Math.cos(c),Math.sin(c),0)}function bj(a,b,c,d,e,f,g){a/=Math.sqrt(1-b*f*f);const h=a+g;return X.construct(h*e*c,h*e*d,(a*(1-b)+g)*f)}function Ve(a,b,c){var d=
new l.ECoordinate,e=new l.ECoordinate;const f=new l.ECoordinate,g=new l.ECoordinate;d.setCos(c.x);e.setSin(c.x);f.setCos(c.y);g.setSin(c.y);c=g.negate().mulE(g.mul(b)).add(1).sqrt();a=(new l.ECoordinate(a)).divE(c);d=a.mulE(f).mulE(d);e=a.mulE(f).mulE(e);b=a.mul(1-b).mulE(g);return new Dc(d,e,b)}function sd(a,b,c){a=c.x;const d=c.y;return l.Point2D.construct(Math.atan2(d,a),Math.atan2(c.z,(1-b)*Math.sqrt(a*a+d*d)))}function ie(a,b,c){b=1-b;b=Math.sqrt(l.sqr(c.x)+l.sqr(c.y)+l.sqr(c.z)/b);return c.mul(a/
b)}function Cg(a,b,c){const d=new X;d.setCrossProductVector(b,c);return Math.abs(Math.atan2(d.length(),b.dotProduct(c)))*a}function Dg(a,b,c,d,e,f=0,g){if(2===f||3===f)return wm(a,b,c,d,e,3===f,g);const h=sd(a,b,c);c=m=>{m=sd(a,b,X.lerp(d,e,m));a:{p.geometryReleaseAssert(h.isFinite()&&m.isFinite());switch(f){case 0:b:{var n={stack:[],error:void 0,hasError:!1};try{const r=Ka.__addDisposableResource(n,new F.PeDoubleClass,!1);F.peLineType.geodeticDistance(a,b,h.x,h.y,m.x,m.y,r,null,null,F.peDefs.PE_LINETYPE_GEODESIC);
var q=r.val;break b}catch(r){n.error=r,n.hasError=!0}finally{Ka.__disposeResources(n)}q=void 0}break a;case 1:b:{m={stack:[],error:void 0,hasError:!1};try{n=Ka.__addDisposableResource(m,new F.PeDoubleClass,!1);F.peLineType.greatEllipticDistance(a,b,h.x,h.y,h.x,h.y,n,null,null);q=n.val;break b}catch(r){m.error=r,m.hasError=!0}finally{Ka.__disposeResources(m)}q=void 0}break a;case 2:case 3:q=mb(a,b,h);m=mb(a,b,m);q=X.distance(q,m);break a;default:p.throwNotImplementedException("")}q=void 0}return q};
var k=X.distance(d,e);if(0<k){k=cj(a,k);const {first:m,second:n}=Ag(c,0,1,k);g&&g.assign(ie(a,b,X.lerp(d,e,m)));return l.makePair(m,n)}c=c(0);g&&g.assign(d);return l.makePair(.5,c)}function wm(a,b,c,d,e,f=!1,g){const h=ie(a,b,c);if(f){f=new xm({pt0:new X(0,0,0),pt1:d,pt2:e});c=f.closestCoordinate(c);var k=f.closestCoordinate(d);f=f.closestCoordinate(e);c=l.Point2D.getClosestCoordinate(k,f,c);f=ie(a,b,X.lerp(d,e,c));k=X.distance(f,h);g&&g.assign(f);return l.makePair(c,k)}f=m=>{m=ie(a,b,X.lerp(d,e,
m));return X.distance(m,h)};k=X.distance(d,e);if(0<k){c=cj(a,k);const {first:m,second:n}=Ag(f,0,1,c);g&&g.assign(ie(a,b,X.lerp(d,e,m)));return l.makePair(m,n)}f=X.distance(c,d);g&&g.assign(c);return l.makePair(.5,f)}function dj(a,b,c,d,e,f){f[0]=Number.NaN;f[1]=Number.NaN;if(Math.abs(c.x-d.x)>Math.PI||Math.abs(c.y)>l.geometryHalfPi||Math.abs(d.y)>l.geometryHalfPi||(Math.abs(c.y)===l.geometryHalfPi||Math.abs(d.y)===l.geometryHalfPi)&&c.x!==d.x||Math.abs(e)>=l.geometryHalfPi||0<c.y&&0<d.y&&c.y>e&&d.y>
e||0>c.y&&0>d.y&&c.y<e&&d.y<e)return 0;var g=S.constructPoint2D(c);a=S.constructPoint2D(d);g=Ve(1,b,g);a=Ve(1,b,a);g=g.crossProductVector(a);if(g.z.isZero())return l.Envelope1D.construct(c.y,d.y).containsCoordinate(e)?(f[0]=c.x,1):0;a=g.x.divE(g.z.negate());g=g.y.divE(g.z.negate());var h=a.mulE(a).addE(g.mulE(g)).sqrt();if(h.isZero()||a.isZero()&&g.isZero())return 0===e?(f[0]=c.x,f[1]=d.x,2):0;b=(1-b)*Math.tan(e)/h.value();if(1<Math.abs(b))return 0;h=Math.acos(b);a=Math.atan2(g.value(),a.value());
b=a-h;a+=h;g=Math.min(c.x,d.x);c=Math.max(c.x,d.x);Bg(b,g,c);0!==e?Bg(a,g,c):a=b;e=0;g<=b&&b<=c&&(f[e]=b,e++);a!==b&&g<=a&&a<=c&&(f[e]=a,e++);return e}function ej(a,b){b[0]>.5*Math.PI?(a[0]+=Math.PI,b[0]=Math.PI-b[0]):b[0]<.5*-Math.PI&&(a[0]-=Math.PI,b[0]=-Math.PI-b[0]);p.geometryReleaseAssert(b[0]>=.5*-Math.PI&&b[0]<=.5*Math.PI)}function ym(a,b,c){let d=1;0>b&&(d=-1,b=-b,c=-c);if(0!==a){var e=a*a;const f=e*a,g=[1,(1+11*a)/12,(1+118*a+241*e)/360,(1+1089*a+10419*e+8651*f)/20160,(1+9836*a+318246*e+
1027436*f+458881*f*a)/1814400];e=h=>{let k=0;const m=l.sqr(h)/(a-1);for(let n=g.length-1;0<=n;--n)k=g[n]+k*m;return k*=-l.sqr(h/(1-a))};b=e(l.geometryHalfPi-b);return(e(l.geometryHalfPi-c)-b)*d}c=l.geometryHalfPi-c;b=-4*l.sqr(Math.sin((l.geometryHalfPi-b)/2));return(-4*l.sqr(Math.sin(c/2))-b)*d}function fj(a,b){if(0===b)return 0;let c=b=Math.sin(b),d=b;0!==a&&(c/=1-a*b*b,d=b*l.atanhUOverU(Math.sqrt(a)*b));return c+d}function gj(a,b,c){a=c/(2*(1-b)*a);a*=a;return c*(1-a*(.16666666666666666-.008333333333333333*
a))}function cj(a,b){return 0!==b?(a*=l.geographyEpsFactor(),Math.min(a/b,1E-10)):0}function ra(a,b,c,d,e){return hj(a,b,null,c,d,e)}function hj(a,b,c,d,e,f){var g=a.getGeometryType();if(g===p.GeometryType.enumPoint){var h=a.getXY();return b.contains(h)?a:a.createInstance()}if(g===p.GeometryType.enumEnvelope)return h=D.constructEmpty(),a.queryEnvelope(h),h.intersect(b)?(a=a.clone(),a.setEnvelope(h),a):a.createInstance();if(a.isEmpty())return a;if(b.isEmpty())return a.createInstance();b=b.clone();
const k=new D;a.queryLooseEnvelope(k);if(b.containsEnvelope(k))return a;if(!b.isIntersecting(k))return a.createInstance();0===e&&(k.intersect(b),k.inflate(Math.max(.1*k.maxDimension(),1)),k.intersect(b),b.assign(k));if(null!==c||Number.isNaN(d))d=Ma(c,b,!1).total();if(g===p.GeometryType.enumGeometryCollection){h=a.createInstance();for(let m=0,n=a.getGeometryCount();m<n;m++)g=a.getGeometry(m),g.isEmpty()||(c=ra(g,b,d,e,f),c.isEmpty()||(c===g?h.addGeometry(c.clone()):h.addGeometry(c)));return h}p.isMultiVertex(g)||
p.throwInvalidArgumentException("Clip: geometry not supported");c=a.getImpl().getAccelerators();null!==c&&(c=c.getRasterizedGeometry(),p.geometryReleaseAssert(null===c));switch(g){case p.GeometryType.enumMultiPoint:e=a.getPointCount();f=a.getImpl().getAttributeStreamRef(0);g=0;for(d=0;d<e;d++)c=f.readPoint2D(2*d),b.contains(c)||(0===g&&(h=a.createInstance()),g<d&&h.addPoints(a,g,d),g=d+1);0<g&&h.addPoints(a,g,e);if(0===g)return a;p.geometryReleaseAssert(null!==h);return h;case p.GeometryType.enumPolygon:case p.GeometryType.enumPolyline:return h=
d,(new Rb(b,f)).clipMultiPath2(a,h,e);default:p.throwInternalErrorException("")}}function ij(a,b,c,d,e,f){return(new Eg(0,0,0,null,!1,l.intMax())).densifyEx(a,b,c,d,!1,f)}function We(a,b,c,d,e,f,g,h){f&&(f.length=0);g&&(g.length=0);h=a.getGeometryType();if(h===p.GeometryType.enumLine)return f&&(f.push(a.getStartXY()),f.push(l.Point2D.getNAN()),f.push(l.Point2D.getNAN()),f.push(a.getEndXY())),g&&(g.push(0),g.push(1)),1;if(h===p.GeometryType.enumBezier){if(!d)return f&&(f.push(a.getStartXY()),f.push(a.getControlPoint1()),
f.push(a.getControlPoint2()),f.push(a.getEndXY())),g&&(g.push(0),g.push(1)),1;b=[];b.length=9;d=a.getMonotonicPartParams(b.length,b);b.length=d;d=Ec(a,c,b);2===d&&e&&(b[1]=.5,b.push(1),d=3);g&&g.splice(0,0,...b.slice(0,d));if(f)for(g=new W,c=1;c<d;c++)a.queryCut(b[c-1],b[c],g,!0),h=g.get(),fe(h),1===c&&f.push(h.getStartXY()),f.push(h.getControlPoint1()),f.push(h.getControlPoint2()),f.push(h.getEndXY());return d-1}if(h===p.GeometryType.enumEllipticArc){if(a.isDegenerateToLine()||a.isDegenerate(0))return f&&
(f.push(a.getStartXY()),f.push(l.Point2D.getNAN()),f.push(l.Point2D.getNAN()),f.push(a.getEndXY())),g&&(g.push(0),g.push(1)),1;if(d&&(e||!a.isMonotoneQuickAndDirty())){h=[];h.length=6;var k=a.getMonotonicPartParams(h.length,h);h.length=k;k=Ec(a,c,h);2===k&&e&&(h[1]=.5,h.push(1),k=3);e=0;if(2<k){var m=new W,n=[];n=g?g:n;var q=0;for(var r=1;r<k;r++){a.queryCut(h[q],h[r],m,!0);if(m.get().isDegenerate(0))continue;var t=n.length,u=Fg(1===r,m.get(),b,c,d,f,g);p.geometryReleaseAssert(0<u);e+=u;u=r===k-1;
q=h[q];const v=m.get().getSweepAngle()/a.getSweepAngle();for(let w=t,x=n.length;w<x;w++)if(n[w]=!u||w+1<x?q+n[w]*v:1,f){t=3*w;const y=a.getCoord2D(n[w]);f[t].setCoordsPoint2D(y);0<t&&(t=f.slice(t-3),Se(t))}q=r}return e}}return Fg(!0,a,b,c,d,f,g)}if(h===p.GeometryType.enumRationalBezier2){if(d&&(e||!a.isMonotoneQuickAndDirty())&&(b=[],b.length=6,d=a.getMonotonicPartParams(b.length,b),b.length=d,d=Ec(a,c,b),2===d&&e&&(b[1]=.5,b.push(1),d=3),h=0,2<d)){c=new W;k=[];g=g?g:k;for(k=1;k<d;k++){a.queryCut(b[k-
1],b[k],c,!0);n=g.length;c.get();p.geometryReleaseAssert(0);h+=0;e=k===d-1;m=b[k-1];for(let v=n,w=g.length;v<w;v++)g[v]=!e||v+1<w?m+g[v]:1,f&&(n=3*v,r=a.getCoord2D(g[v]),f[n].setCoordsPoint2D(r),0<n&&(n=f.slice(n-3),Yd(n)))}return h}p.geometryReleaseAssert(0);return 0}if(h===p.GeometryType.enumBezier2)return h=l.makeObjectArray(l.Point2D,3),a.queryControlPoints(h),a=new Gb,a.constructFromQuadratic(h),We(a,b,c,d,e,f,g);p.throwNotImplementedException("")}function zm(a,b,c,d,e,f,g,h){f&&(f.length=0);
g&&(g.length=0);h=a.getGeometryType();if(h===p.GeometryType.enumLine)return f&&(f.push(a.getStartXY()),f.push(l.Point2D.getNAN()),f.push(a.getEndXY())),g&&(g.push(0),g.push(1)),1;if(h===p.GeometryType.enumBezier2){b=[];b.length=9;h=a.getMonotonicPartParams(b.length,b);b.length=h;h=Ec(a,c,b);2===h&&e&&(b[1]=.5,b.push(1),h=3);g&&g.splice(0,0,...b.slice(0,h));if(f){g=new W;for(var k=1;k<h;k++)a.queryCut(b[k-1],b[k],g,!0),e=g.get(),dg(e),1===k&&f.push(e.getStartXY()),f.push(e.getControlPoint1()),f.push(e.getEndXY())}return h-
1}if(h===p.GeometryType.enumEllipticArc){if(a.isDegenerateToLine()||a.isDegenerate(0))return f&&(f.push(a.getStartXY()),f.push(l.Point2D.getNAN()),f.push(a.getEndXY())),g&&(g.push(0),g.push(1)),1;if(!a.isMonotoneQuickAndDirty()&&(h=[],h.length=6,k=a.getMonotonicPartParams(h.length,h),h.length=k,k=Ec(a,c,h),2===k&&e&&(h[1]=.5,h.push(1),k=3),e=0,2<k)){c=new W;d=[];d=g?g:d;for(var m=1;m<k;m++){a.queryCut(h[m-1],h[m],c,!0);var n=d.length;a:{var q=1===m;var r=c.get(),t=b,u=f,v=g,w=r.clone();w.dropAllAttributes();
if(w.isDegenerateToLine()||0===w.getSweepAngle()){u&&(q&&u.push(r.getStartXY()),u.push(l.Point2D.getNAN()),u.push(r.getEndXY()));v&&(q&&v.push(0),v.push(1));q=1;break a}r=w.getStartXY();const C=w.getEndXY();var x=w.getSemiAxes();const B=new l.Transformation2D;if(w.isCircular())B.setIdentity();else{var y=w.getAxisXRotation();B.setScaleCoords(1,w.getMinorMajorRatio());B.rotateAngle(y)}y=w.getCenter();B.shift(y);var z=B.clone();z.invertThis();w.applyTransformation(z);z=D.constructEmpty();z.setCoords({center:y,
width:2*x.x,height:2*x.x});y=.05*z.calculateToleranceFromEnvelope();t=Math.max(t/x.x,y/x.x);x=Math.sqrt(2*t+t*t);t=2*Math.sqrt(2*x*(1+t-x));t=Math.min(t,Math.PI/2);z=w.getSweepAngle();t=Math.max(Math.ceil(Math.abs(z)/t),1);x=1/t;y=Math.tan(Math.abs(z/t)/2);0<z&&(y=-y);v&&q&&v.push(0);z=new l.Point2D;w.queryCoord2D(0,z);for(let E=0;E<t;E++){const G=z.clone();var A=(E+1)*x;v&&v.push(A);u&&(w.queryCoord2D(A,z),A=l.makeObjectArray(l.Point2D,3),A[0].assign(G),A[2].assign(z),A[1].rightPerpendicularOther(A[0]),
A[1].mulThis(y),A[1].addThis(A[0]),B.transformPoints2D(A,3,A),0===E&&A[0].setCoordsPoint2D(r),E===t-1&&A[2].setCoordsPoint2D(C),0===E&&q&&u.push(A[0]),u.push(A[1]),u.push(A[2]))}q=t}e+=q;q=m===k-1;u=h[m-1];v=c.get().getSweepAngle()/a.getSweepAngle();for(let C=n,B=d.length;C<B;C++)d[C]=!q||C+1<B?u+d[C]*v:1,f&&(n=2*C,w=a.getCoord2D(d[C]),f[n].setCoordsPoint2D(w),0<n&&(n=f.slice(n-2),Yd(n)))}return e}return Fg(!0,a,b,c,d,f,g)}if(h===p.GeometryType.enumBezier){if(!a.isMonotoneQuickAndDirty()&&(b=[],b.length=
6,h=a.getMonotonicPartParams(b.length,b),b.length=h,h=Ec(a,c,b),2===h&&e&&(b[1]=.5,b.push(1),h=3),e=0,2<h)){k=new W;c=[];g=g?g:c;for(c=1;c<h;c++){a.queryCut(b[c-1],b[c],k,!0);n=g.length;k.get();p.geometryReleaseAssert(0);e+=0;d=c===h-1;m=b[c-1];for(let C=n,B=g.length;C<B;C++)g[C]=!d||C+1<B?m+g[C]:1,f&&(n=2*C,q=a.getCoord2D(g[C]),f[n].setCoordsPoint2D(q),0<n&&(n=f.slice(n-2),Yd(n)))}return e}p.geometryReleaseAssert(0);return 0}if(h===p.GeometryType.enumRationalBezier2){if(!a.isMonotoneQuickAndDirty()&&
(b=[],b.length=6,h=a.getMonotonicPartParams(b.length,b),b.length=h,h=Ec(a,c,b),2===h&&e&&(b[1]=.5,b.push(1),h=3),e=0,2<h)){k=new W;c=[];g=g?g:c;for(c=1;c<h;c++){a.queryCut(b[c-1],b[c],k,!0);n=g.length;k.get();p.geometryReleaseAssert(0);e+=0;d=c===h-1;m=b[c-1];for(let C=n,B=g.length;C<B;C++)g[C]=!d||C+1<B?m+g[C]:1,f&&(n=2*C,q=a.getCoord2D(g[C]),f[n].setCoordsPoint2D(q),0<n&&(n=f.slice(n-2),Yd(n)))}return e}p.geometryReleaseAssert(0);return 0}p.throwNotImplementedException("")}function td(a,b,c,d,e,
f,g,h,k){b=a.getGeometryType();f&&(f.length=0,g.length=0);h&&(h.length=0);if(b===p.GeometryType.enumEllipticArc&&(a.isDegenerateToLine()||a.isDegenerate(0)))return f&&(f.push(a.getStartXY()),f.push(l.Point2D.getNAN()),f.push(a.getEndXY()),g.push(Number.NaN),g.push(Number.NaN),g.push(Number.NaN)),h&&(h.push(0),h.push(1)),1;k=l.makePrimitiveArray(9,Number.NaN);let m;e?(m=a.getMonotonicPartParams(k.length,k),k.length=m,m=Ec(a,c,k)):(m=2,k[0]=0,k[1]=1,b===Hb.type?(c=a.getSweepAngle(),c>.9*Math.PI&&(2<
Math.min(3,Math.trunc(c/(2*Math.PI/3)+.5))?(k[0]=0,k[1]=1/3,k[2]=2/3,k[3]=1,m=4):(k[0]=0,k[1]=.5,k[2]=1,m=3))):p.geometryReleaseAssert(b===lb.type),k.length=m);2===m&&d&&(k[1]=.5,k.push(1),m=3);if(f)for(d=new W,c=1;c<m;){var n=k[c-1];const r=k[c];a.queryCut(n,r,d,!0);var q=l.makeObjectArray(l.Point2D,3);const t=[1,1,1];if(b===p.GeometryType.enumEllipticArc){const u=d.get();if(Math.abs(u.getSweepAngle())>.9*Math.PI){q=(r-n)/3;k.splice(c,0,n+q);k.splice(c+1,0,n+2*q);m+=2;continue}t[1]=jj(u,q)}else n=
d.get(),n.queryControlPoints(q),n.queryWeights(t);e&&md(q);1===c&&(f.push(q[0].clone()),g.push(t[0]));f.push(q[1].clone());f.push(q[2].clone());g.push(t[1]);g.push(t[2]);c++}h&&(h.length=m,l.memcpy(h,k,0,0,m));return m-1}function Ec(a,b,c){var d=c.length;if(0>=b||2>=d)return d;var e=0;const f=[];f.length=d-1;for(let g=1,h=d;g<h;g++)d=a.tToLength(c[g]),f[g-1]=d-e,e=d;for(;1<f.length;){a=f.findIndex(g=>g<=2*b);if(-1===a)break;e=a+1;d=a+1;if(0<a){const g=a-1;if(d===f.length||f[g]>f[d])d=g,e--}f[d]+=
f[a];f.splice(a,1);c.splice(e,1)}return c.length}function Fg(a,b,c,d,e,f,g,h){h=b.clone();h.dropAllAttributes();var k=(B,E,G,I)=>{E&&(B&&E.push(I.getStartXY()),E.push(l.Point2D.getNAN()),E.push(l.Point2D.getNAN()),E.push(I.getEndXY()));G&&(B&&G.push(0),G.push(1));return 1};if(h.isDegenerateToLine()||h.isDegenerate(0))return k(a,f,g,b);const m=h.getStartXY(),n=h.getEndXY();var q=h.getSemiAxes();const r=new l.Transformation2D;if(h.isCircular())r.setIdentity();else{var t=h.getAxisXRotation();r.setScaleCoords(1,
h.getMinorMajorRatio());r.rotateAngle(t)}var u=h.getCenter();r.shift(u);t=r.clone();t.invertThis();h.applyTransformation(t);t=h.getSweepAngle();if(0===t)return k(a,f,g,b);k=D.constructEmpty();k.setCoords({center:u,width:2*q.x,height:2*q.x});k=.05*k.calculateToleranceFromEnvelope();q=4*Math.pow(Math.max(c/q.x,k/q.x)/.0741,1/6);q=Math.min(q,Math.PI/2);k=$i(h.getStartAngle());u=0<t?Math.floor(k/q):Math.ceil(k/q);u*=q;c=0<t?q:-q;u+c===k&&(u+=c);c=4/3*Math.tan(Math.abs(q)/4);0<t&&(c=-c);g&&a&&g.push(0);
q/=Math.abs(t);k=(u-k)/t;u=m.clone();const v=new l.Point2D;h.queryCoord2D(0,v);const w=v.clone(),x=1-.01*q;let y=0,z=0;for(;1>k;){k+=q;var A=void 0;0<z&&k<x?A=c:(k>=x&&(k=1),A=4/3*Math.tan(Math.abs((k-z)*t)/4),0<t&&(A=-A));h.queryCoord2D(k,v);var C=new l.Point2D;r.queryTransform(v,C);const B=b.getClosestCoordinate(C,!1);b.queryCoord2D(B,C);if(1!==k&&(l.Point2D.distance(u,C)<=2*d||l.Point2D.distance(C,n)<=2*d))continue;u.setCoordsPoint2D(C);const E=l.makeObjectArray(l.Point2D,4);E[0].assign(w);E[3].assign(v);
E[1].rightPerpendicularOther(w);E[1].scaleAddThis(A,w);E[2].leftPerpendicularOther(v);E[2].scaleAddThis(A,v);r.transformPoints2D(E,3,E);E[3].assign(C);0===z&&E[0].setCoordsPoint2D(m);1===k&&E[3].setCoordsPoint2D(n);e&&Se(E);A=!0;for(C=1;4>C;C++)if(!E[C].isEqualPoint2D(E[0])){A=!1;break}A||(g&&g.push(B),f&&(0===z&&a&&f.push(E[0].clone()),f.push(E[1].clone()),f.push(E[2].clone()),f.push(E[3].clone())),y++);z=k;w.setCoordsPoint2D(v)}return y}function Am(a,b){const c=a.length;if(c!==b.length)return!1;
var d=a[0].parentage;if(d!==b[0].parentage)return!1;if(-1===d)return!0;for(d=1;d<c;++d)if(a[d].parentage!==b[d].parentage)return!1;return!0}function kj(a,b,c){c.length=0;let d=!1;for(var e=a.getHalfEdgeVertexIterator(b);-1!==e;){var f=a.getVertexFromVertexIterator(e),g=a.getShape().getSegmentRank(f);f=a.getShape().getSegmentParentage(f);d||=0<=f;c.push({parentage:f,rank:g});e=a.incrementVertexIterator(e)}for(b=a.getHalfEdgeVertexIterator(a.getHalfEdgeTwin(b));-1!==b;)g=a.getVertexFromVertexIterator(b),
e=a.getShape().getSegmentRank(g),g=a.getShape().getSegmentParentage(g),d||=0<=g,c.push({parentage:g,rank:e}),b=a.incrementVertexIterator(b);d&&c.sort((h,k)=>h.rank>k.rank?-1:h.rank<k.rank?1:h.parentage<k.parentage?-1:h.parentage>k.parentage?1:0);-1===c[0].parentage&&(c.length=1)}function Bm(){return new Cm(a=>a.getHashCode(),(a,b)=>a.equals(b))}function Gg(a=-1){return{m_value:a,m_line:new Z,m_segment:null,m_segmentInfo:new Hg(-1),m_env:new l.Envelope1D(0,0),m_dxdy:55555555,m_bHorizontal:!1,m_bCurve:!1}}
function lj(a,b,c,d,e){e=new mj(e);e.m_shape=a;e.m_sqrTolerance=b*b;e.m_cellSize=2*b;e.m_invCellSize=1/e.m_cellSize;e.m_geometry=c;e.m_bTrackChanges=d;e.m_bHasSegmentParentage=a.hasSegmentParentage();return e.clusterNonReciprocal()}function Ig(a,b,c,d,e){a-=c;b-=d;return a*a+b*b<=e}function nj(a,b,c,d,e,f){const g={pt:new l.Point2D,weight:0,rank:0,bMerged:!1},h=c+e;let k=!1,m=a.x;a.x!==b.x&&(d===f&&(m=(a.x*c+b.x*e)/h),k=!0);let n=a.y;a.y!==b.y&&(d===f&&(n=(a.y*c+b.y*e)/h),k=!0);d!==f?d>f?(g.rank=
d,g.weight=c,g.pt=a):(g.rank=f,g.weight=e,g.pt=b):(g.pt.setCoords(m,n),g.weight=h,g.rank=d);g.bMerged=k;return g}function oj(a,b){a=l.hashForClustering(a);return l.hashForClustering2(a,b)}function Xe(){return{bBigMove:!1,bIsBreak:!1}}function Fc(a,b,c,d){return{edge1:a,edge2:b,recursion:c,bIsIntersecting:d}}function ud(a,b,c){let d=0;switch(a){case p.GeometryType.enumLine:d=0;break;case p.GeometryType.enumBezier:d=2;break;case p.GeometryType.enumRationalBezier2:d=3;break;case p.GeometryType.enumBezier2:d=
1;break;case p.GeometryType.enumEllipticArc:d=0===b.projectionBehavior()?5:4;break;default:p.throwInternalErrorException("")}return c?5-d:d}function pj(a){for(let b=a.getFirstGeometry();-1!==b;b=a.getNextGeometry(b))if(p.isMultiPath(a.getGeometryType(b)))return!0;return!1}function Jg(a,b,c,d,e){if(!pj(b))return!1;let f=new vd(e);f.m_shape=b;f.m_tolerance=c;f.m_bAllowCoincident=a;f.m_bNeedsNonSimpleResult=null!==d;if(f.needsCrackingImpl_())return d&&d.assign(f.m_nonSimpleResult),!0;const g=new l.Transformation2D;
g.setSwapCoordinates();b.applyTransformation(g);f=new vd(e);f.m_shape=b;f.m_tolerance=c;f.m_bAllowCoincident=a;f.m_bNeedsNonSimpleResult=null!==d;a=f.needsCrackingImpl_();b.applyTransformation(g);return a?(d&&d.assign(f.m_nonSimpleResult),!0):!1}function Dm(a,b){a=a.getPointCount();return 16>a?!1:2*a+Math.log(a)/Math.log(2)*b<1*a*b}function Ye(a,b,c){if(a.isEmpty())return 0;var d=D.constructEmpty();a.queryLooseEnvelope(d);d.inflateCoords(c,c);if(!d.contains(b))return 0;if(d=a.getImpl().getAccelerators())if(d.getRasterizedGeometry()&&
p.geometryReleaseAssert(0),d=d.getQuadTree()){a:{var e=new D;a.queryLooseEnvelope(e);e.inflateCoords(c,c);var f=0===a.getFillRule();f=new qj(f,c);f.setInputPoint(b);e=e.clone();e.xmax=b.x+c;e.ymin=b.y-c;e.ymax=b.y+c;a=a.getImpl().querySegmentIterator();b=d.getIterator(e,c);for(c=b.next();-1!==c;c=b.next())if(a.resetToVertex(d.getElement(c),-1),a.hasNextSegment()&&(c=a.nextSegment(),f.processSegment(c))){a=-1;break a}a=f._Result()?1:0}return a}a:{d=0===a.getFillRule();c=new qj(d,c);c.setInputPoint(b);
for(a=a.getImpl().querySegmentIterator();a.nextPath();)for(;a.hasNextSegment();)if(b=a.nextSegment(),c.processSegment(b)){a=-1;break a}a=c._Result()?1:0}return a}function Gc(a,b){a=a.getPointCount();return 16>a?!1:2*a+Math.log(a)/Math.log(2)*b<1*a*b}function tc(a,b,c,d,e,f){f=new Em(f);f.m_shape=a;f.m_geometry=b;f.m_knownSimpleResult=c;f.m_bFixSelfTangency=d;f.m_polylineDegeneracies=e;f.m_bHasSegmentParentage=a.hasSegmentParentage();f.m_bHasSegments=a.hasCurves();return f.simplify_()}function Ib(a,
b,c,d,e,f=!0){switch(rj(d)){case 0:break;case 1:p.throwInvalidArgumentException("relation string length has to be 9 characters");break;default:p.throwInvalidArgumentException("relation string")}if(f&&(f=Fm(d,a.getDimension(),b.getDimension()),0!==f))return uc(a,b,c,f,e);f=0;if("number"===typeof c)f=c;else{f=D.constructEmpty();a.queryEnvelope(f);var g=D.constructEmpty();b.queryEnvelope(g);var h=D.constructEmpty();h.setCoords({env2D:f});h.mergeEnvelope2D(g);f=oc(c,h,!1)}a=sj(a,f);b=sj(b,f);if(a.isEmpty()||
b.isEmpty())return e=l.makePrimitiveArray(9,-1),a.isEmpty()&&b.isEmpty()||(c=!1,a.isEmpty()?c=!0:b=a,e[0]=-1,e[1]=-1,e[3]=-1,e[4]=-1,e[6]=-1,e[7]=-1,e[8]=2,a=b.getGeometryType(),p.isMultiPath(a)?a===p.GeometryType.enumPolygon?0!==b.calculateArea2D()?(e[2]=2,e[5]=1):(e[5]=-1,a=D.constructEmpty(),b.queryEnvelope(a),e[2]=a.height()||a.width()?1:0):(a=0!==b.calculateLength2D(),e[2]=a?1:0,e[5]=rd(b)?0:-1):(e[2]=0,e[5]=-1),c&&(b=e,a=b[1],c=b[2],f=b[5],b[1]=b[3],b[2]=b[6],b[5]=b[7],b[3]=a,b[6]=c,b[7]=f)),
e=nb(e,d),e;c=a.getGeometryType();g=b.getGeometryType();h=!1;switch(c){case p.GeometryType.enumPolygon:switch(g){case p.GeometryType.enumPolygon:c=f;f=new $b;f.resetMatrix_();f.setPredicates_(d);f.setAreaAreaPredicates_();d=D.constructEmpty();g=D.constructEmpty();a.queryEnvelope(d);b.queryEnvelope(g);h=!1;lc(d,g,c)&&(f.areaAreaDisjointPredicates_(a,b),h=!0);h||pa(a,b);h||(d=new Fa,a=d.addGeometry(a),b=d.addGeometry(b),f.setEditShapeCrackAndCluster_(d,new jb(c,0),e),f.computeMatrixTopoGraphHalfEdges_(a,
b),f.m_topoGraph.removeShape());h=nb(f.m_matrix,f.m_scl);break;case p.GeometryType.enumPolyline:h=tj(a,b,f,d,e);break;case p.GeometryType.enumPoint:h=uj(a,b,f,d);break;case p.GeometryType.enumMultiPoint:h=vj(a,b,f,d,e)}break;case p.GeometryType.enumPolyline:switch(g){case p.GeometryType.enumPolygon:h=tj(b,a,f,wd(d),e);break;case p.GeometryType.enumPolyline:c=f;f=new $b;f.resetMatrix_();f.setPredicates_(d);f.setLineLinePredicates_();d=D.constructEmpty();g=D.constructEmpty();a.queryEnvelope(d);b.queryEnvelope(g);
h=!1;lc(d,g,c)&&(f.lineLineDisjointPredicates_(a,b),h=!0);h||pa(a,b);h||(d=new Fa,a=d.addGeometry(a),b=d.addGeometry(b),f.setEditShapeCrackAndCluster_(d,new jb(c,0),e),f.m_clusterIndexA=f.m_topoGraph.createUserIndexForClusters(),f.m_clusterIndexB=f.m_topoGraph.createUserIndexForClusters(),Ze(a,f.m_topoGraph,f.m_clusterIndexA),Ze(b,f.m_topoGraph,f.m_clusterIndexB),f.computeMatrixTopoGraphHalfEdges_(a,b),f.m_topoGraph.deleteUserIndexForClusters(f.m_clusterIndexA),f.m_topoGraph.deleteUserIndexForClusters(f.m_clusterIndexB),
f.m_topoGraph.removeShape());h=nb(f.m_matrix,f.m_scl);break;case p.GeometryType.enumPoint:h=wj(a,b,f,d,e);break;case p.GeometryType.enumMultiPoint:h=xj(a,b,f,d,e)}break;case p.GeometryType.enumPoint:switch(g){case p.GeometryType.enumPolygon:h=uj(b,a,f,wd(d));break;case p.GeometryType.enumPolyline:h=wj(b,a,f,wd(d),e);break;case p.GeometryType.enumPoint:e=f;a=a.getXY();b=b.getXY();c=l.makePrimitiveArray(9,-1);l.Point2D.sqrDistance(a,b)<=e*e?c[0]=0:(c[2]=0,c[6]=0);c[8]=2;h=nb(c,d);break;case p.GeometryType.enumMultiPoint:h=
yj(b,a,f,wd(d))}break;case p.GeometryType.enumMultiPoint:switch(g){case p.GeometryType.enumPolygon:h=vj(b,a,f,wd(d),e);break;case p.GeometryType.enumPolyline:h=xj(b,a,f,wd(d),e);break;case p.GeometryType.enumMultiPoint:c=f;f=new $b;f.resetMatrix_();f.setPredicates_(d);f.setPointPointPredicates_();d=new D;g=new D;a.queryEnvelope(d);b.queryEnvelope(g);h=!1;lc(d,g,c)&&(f.pointPointDisjointPredicates_(),h=!0);h||(d=new Fa,a=d.addGeometry(a),b=d.addGeometry(b),f.setEditShapeCrackAndCluster_(d,new jb(c,
0),e),f.computeMatrixTopoGraphClusters_(a,b),f.m_topoGraph.removeShape());h=nb(f.m_matrix,f.m_scl);break;case p.GeometryType.enumPoint:h=yj(a,b,f,d)}break;default:h=!1}return h}function rj(a){if(9!==a.length)return 1;for(let b=0;9>b;b++){const c=a[b];if("*"!==c&&"T"!==c&&"F"!==c&&"0"!==c&&"1"!==c&&"2"!==c)return 2}return 0}function tj(a,b,c,d,e){const f=new $b;f.resetMatrix_();f.setPredicates_(d);f.setAreaLinePredicates_();d=D.constructEmpty();const g=D.constructEmpty();a.queryEnvelope(d);b.queryEnvelope(g);
let h=!1;lc(d,g,c)&&(f.areaLineDisjointPredicates_(a,b),h=!0);h||pa(a,b);h||(d=new Fa,a=d.addGeometry(a),b=d.addGeometry(b),f.setEditShapeCrackAndCluster_(d,new jb(c,0),e),f.m_clusterIndexB=f.m_topoGraph.createUserIndexForClusters(),Ze(b,f.m_topoGraph,f.m_clusterIndexB),f.computeMatrixTopoGraphHalfEdges_(a,b),f.m_topoGraph.deleteUserIndexForClusters(f.m_clusterIndexB),f.m_topoGraph.removeShape());return nb(f.m_matrix,f.m_scl)}function vj(a,b,c,d,e){const f=new $b;f.resetMatrix_();f.setPredicates_(d);
f.setAreaPointPredicates_();d=D.constructEmpty();const g=D.constructEmpty();a.queryEnvelope(d);b.queryEnvelope(g);let h=!1;lc(d,g,c)&&(f.areaPointDisjointPredicates_(a),h=!0);h||pa(a,b);h||(d=new Fa,a=d.addGeometry(a),b=d.addGeometry(b),f.setEditShapeCrackAndCluster_(d,new jb(c,0),e),f.computeMatrixTopoGraphClusters_(a,b),f.m_topoGraph.removeShape());return nb(f.m_matrix,f.m_scl)}function xj(a,b,c,d,e){const f=new $b;f.resetMatrix_();f.setPredicates_(d);f.setLinePointPredicates_();d=D.constructEmpty();
const g=D.constructEmpty();a.queryEnvelope(d);b.queryEnvelope(g);let h=!1;lc(d,g,c)&&(f.linePointDisjointPredicates_(a),h=!0);h||pa(a,b);h||(d=new Fa,a=d.addGeometry(a),b=d.addGeometry(b),f.setEditShapeCrackAndCluster_(d,new jb(c,0),e),f.m_clusterIndexA=f.m_topoGraph.createUserIndexForClusters(),Ze(a,f.m_topoGraph,f.m_clusterIndexA),f.computeMatrixTopoGraphClusters_(a,b),f.m_topoGraph.deleteUserIndexForClusters(f.m_clusterIndexA),f.m_topoGraph.removeShape());return nb(f.m_matrix,f.m_scl)}function uj(a,
b,c,d,e){e=new $b;e.resetMatrix_();e.setPredicates_(d);e.setAreaPointPredicates_();const f=D.constructEmpty();a.queryEnvelope(f);b=b.getXY();let g=!1;$e(b,f,c)&&(e.areaPointDisjointPredicates_(a),g=!0);g||(c=ob(a,b,c),1===c?(e.m_matrix[0]=0,e.m_matrix[2]=2,e.m_matrix[3]=-1,e.m_matrix[5]=1,e.m_matrix[6]=-1):2===c?(e.m_matrix[6]=-1,0!==a.calculateArea2D()?(e.m_matrix[0]=-1,e.m_matrix[3]=0,e.m_matrix[2]=2,e.m_matrix[5]=1):(e.m_matrix[0]=0,e.m_matrix[3]=-1,e.m_matrix[5]=-1,c=D.constructEmpty(),a.queryEnvelope(c),
e.m_matrix[2]=c.height()||c.width()?1:-1)):e.areaPointDisjointPredicates_(a));return nb(e.m_matrix,d)}function wj(a,b,c,d,e){const f=new $b;f.resetMatrix_();f.setPredicates_(d);f.setLinePointPredicates_();d=D.constructEmpty();a.queryEnvelope(d);var g=b.getXY(),h=!1;$e(g,d,c)&&(f.linePointDisjointPredicates_(a),h=!0);if(!h){d=null;h=g=!1;if(f.m_performPredicates[0]||f.m_performPredicates[6])uc(a,b,c,4,e)?(f.m_matrix[0]=-1,f.m_matrix[6]=0):(f.m_performPredicates[0]&&(d=Qb(a),h=!uc(d,b,c,4,e),g=!0,f.m_matrix[0]=
h?-1:0),f.m_matrix[6]=-1);f.m_performPredicates[3]&&(null!==d&&d.isEmpty()?f.m_matrix[3]=-1:(g||(null==d&&(d=Qb(a)),h=!uc(d,b,c,4,e),g=!0),f.m_matrix[3]=h?0:-1));f.m_performPredicates[5]&&(null!==d&&d.isEmpty()?f.m_matrix[5]=-1:g&&!h?f.m_matrix[5]=0:(null===d&&(d=Qb(a)),d=uc(d,b,c,3,e),f.m_matrix[5]=d?-1:0));f.m_performPredicates[2]&&(0!==a.calculateLength2D()?f.m_matrix[2]=1:(d=new Oa({vd:a.getDescription()}),d.addPoints(a,0,a.getPointCount()),a=uc(d,b,c,3,e),f.m_matrix[2]=a?-1:0))}return nb(f.m_matrix,
f.m_scl)}function yj(a,b,c,d,e){e=new $b;e.resetMatrix_();e.setPredicates_(d);e.setPointPointPredicates_();var f=D.constructEmpty();a.queryEnvelope(f);b=b.getXY();const g=new l.Point2D;var h=!1;$e(b,f,c)&&(e.pointPointDisjointPredicates_(),h=!0);if(!h){f=!1;h=!0;c*=c;for(let k=0;k<a.getPointCount()&&(a.queryXY(k,g),l.Point2D.sqrDistance(g,b)<=c?f=!0:h=!1,!f||h);k++);f?(e.m_matrix[0]=0,e.m_matrix[2]=h?-1:0,e.m_matrix[6]=-1):(e.m_matrix[0]=-1,e.m_matrix[2]=0,e.m_matrix[6]=0)}return nb(e.m_matrix,d)}
function nb(a,b){for(let c=0;9>c;c++)switch(b[c]){case "T":if(-1===a[c])return!1;break;case "F":if(-1!==a[c])return!1;break;case "0":if(0!==a[c])return!1;break;case "1":if(1!==a[c])return!1;break;case "2":if(2!==a[c])return!1}return!0}function Fm(a,b,c){return"T*F**FFF*"===a?3:"FF*FF****"===a?4:(0===b&&0===c?0:2===b&&2===c?"F***T****"===a:2!==b&&1!==b||0!==c?0:"F**T*****"===a)?8:(b>c?"T*****T**"===a:1===b&&1===c&&"0********"===a)?16:"T**FF*FF*"===a?64:"T*****FF*"===a?1:b===c&&(1!==b?"T*T***T**"===
a:"1*T***T**"===a)?32:0}function Ze(a,b,c){a=b.getGeometryID(a);for(let e=b.getFirstCluster();-1!==e;e=b.getNextCluster(e)){if(0===(b.getClusterParentage(e)&a))continue;const f=b.getClusterHalfEdge(e);if(-1===f){b.setClusterUserIndex(e,c,0);continue}var d=f;let g=0;do 0!==(b.getHalfEdgeParentage(d)&a)&&g++,d=b.getHalfEdgeNext(b.getHalfEdgeTwin(d));while(d!==f);b.setClusterUserIndex(e,c,g)}}function sj(a,b,c){c=a.getGeometryType();if(p.isSegment(c))return b=new ma({vd:a.getDescription()}),b.addSegment(a,
!0),b;if(c===p.GeometryType.enumEnvelope){c=D.constructEmpty();a.queryEnvelope(c);if(c.height()<=b&&c.width()<=b)return b=new Y({vd:a.getDescription()}),a.getCenter(b),b;if(c.height()<=b||c.width()<=b)return b=new ma({vd:a.getDescription()}),c=new Y,a.queryCornerByVal(0,c),b.startPathPoint(c),a.queryCornerByVal(2,c),b.lineToPoint(c),b;b=new ba({vd:a.getDescription()});b.addEnvelope(a,!1);return b}return a}function wd(a){return`${a[0]}${a[3]}${a[6]}${a[1]}${a[4]}${a[7]}${a[2]}${a[5]}${a[8]}`}function Kg(a){return 2===
a?1:1===a?2:128===a?64:64===a?128:a}function zj(a,b,c){if(a instanceof Sb||null===a){const d=D.constructEmpty();d.setCoords({env2D:b});d.mergeEnvelope2D(c);a=oc(a,d,!1)}return a}function uc(a,b,c,d,e){if(a.isEmpty()||b.isEmpty())return 4===d?!0:!1;p.throwIfMesh(a);p.throwIfMesh(b);let f=a.getGeometryType(),g=b.getGeometryType();if(f===p.GeometryType.enumEnvelope){if(g===p.GeometryType.enumEnvelope)return Gm(a,b,c,d);if(g===p.GeometryType.enumPoint)return Aj(b,a,c,Kg(d))}else if(f===p.GeometryType.enumPoint){if(g===
p.GeometryType.enumEnvelope)return Aj(a,b,c,d);if(g===p.GeometryType.enumPoint)return Hm(a,b,c,d)}var h=D.constructEmpty();a.queryEnvelope(h);var k=D.constructEmpty();b.queryEnvelope(k);c=zj(c,h,k);if(lc(h,k,c))return 4===d?!0:!1;h=!1;var m=k=null;m=k=null;p.isSegment(f)?(k=new ma({vd:a.getDescription()}),k.addSegment(a,!0),f=p.GeometryType.enumPolyline):k=a;p.isSegment(g)?(m=new ma({vd:b.getDescription()}),m.addSegment(b,!0),g=p.GeometryType.enumPolyline):m=b;if(f!==p.GeometryType.enumEnvelope&&
g!==p.GeometryType.enumEnvelope){if(k.getDimension()<m.getDimension()||f===p.GeometryType.enumPoint&&g===p.GeometryType.enumMultiPoint)d=Kg(d)}else f!==p.GeometryType.enumPolygon&&g!==p.GeometryType.enumEnvelope&&(d=Kg(d));switch(f){case p.GeometryType.enumPolygon:switch(g){case p.GeometryType.enumPolygon:h=Im(k,m,c,d,e);break;case p.GeometryType.enumPolyline:h=Bj(k,m,c,d,e);break;case p.GeometryType.enumPoint:h=Cj(k,m,c,d);break;case p.GeometryType.enumMultiPoint:h=Dj(k,m,c,d);break;case p.GeometryType.enumEnvelope:h=
Ej(k,m,c,d,e)}break;case p.GeometryType.enumPolyline:switch(g){case p.GeometryType.enumPolygon:h=Bj(m,k,c,d,e);break;case p.GeometryType.enumPolyline:h=Jm(k,m,c,d,e);break;case p.GeometryType.enumPoint:h=Fj(k,m,c,d);break;case p.GeometryType.enumMultiPoint:h=Gj(k,m,c,d);break;case p.GeometryType.enumEnvelope:h=Hj(k,m,c,d,e)}break;case p.GeometryType.enumPoint:switch(g){case p.GeometryType.enumPolygon:h=Cj(m,k,c,d);break;case p.GeometryType.enumPolyline:h=Fj(m,k,c,d);break;case p.GeometryType.enumMultiPoint:h=
Ij(m,k,c,d)}break;case p.GeometryType.enumMultiPoint:switch(g){case p.GeometryType.enumPolygon:h=Dj(m,k,c,d);break;case p.GeometryType.enumPolyline:h=Gj(m,k,c,d);break;case p.GeometryType.enumMultiPoint:h=Km(k,m,c,d);break;case p.GeometryType.enumPoint:h=Ij(k,m,c,d);break;case p.GeometryType.enumEnvelope:h=Jj(k,m,c,d)}break;case p.GeometryType.enumEnvelope:switch(g){case p.GeometryType.enumPolygon:h=Ej(m,k,c,d,e);break;case p.GeometryType.enumPolyline:h=Hj(m,k,c,d,e);break;case p.GeometryType.enumMultiPoint:h=
Jj(m,k,c,d)}}return h}function Gm(a,b,c,d,e){if(a.isEmpty()||b.isEmpty())return 4===d?!0:!1;e=D.constructEmpty();a.queryEnvelope(e);a=D.constructEmpty();b.queryEnvelope(a);b=zj(c,e,a);switch(d){case 4:return lc(e,a,b);case 2:return af(a,e,b,!1);case 128:return af(a,e,b,!0);case 1:return af(e,a,b,!1);case 64:return af(e,a,b,!0);case 3:return vc(e,a,b);case 8:return e.height()<=b||e.width()<=b||a.height()<=b||a.width()<=b?e=!1:(d=new D,d.setCoords({env2D:e}),d.inflateCoords(-b,-b),d.intersect(a),!d.isEmpty()&&
d.height()>b&&d.width()>b?e=!1:(d.setCoords({env2D:e}),d.inflateCoords(b,b),d.intersect(a),e=!d.isEmpty())),e;case 32:return e.height()<=b||e.width()<=b||a.height()<=b||a.width()<=b?e=!1:Sa(e,a,b)?e=!1:Sa(a,e,b)?e=!1:(d=new D,d.setCoords({env2D:e}),d.inflateCoords(-b,-b),d.intersect(a),e=!d.isEmpty()&&(d.height()>b||d.width()>b)),e}return!1}function Aj(a,b,c,d,e){if(a.isEmpty()||b.isEmpty())return 4===d?!0:!1;a=a.getXY();e=D.constructEmpty();b.queryEnvelope(e);if(c instanceof Sb||null===c)b=D.constructEmpty(),
b.setCoords({pt:a}),b.mergeEnvelope2D(e),c=oc(c,b,!1);switch(d){case 4:return $e(a,e,c);case 2:case 128:return e.height()<=c||e.width()<=c?a=!1:(d=D.constructEmpty(),d.setCoords({env2D:e}),d.inflateCoords(-c,-c),a=d.containsExclusive(a)),a;case 3:return d=new D,d.setCoords({pt:a}),vc(d,e,c);case 8:return e.height()<=c||e.width()<=c?a=!1:(d=new D,b=new D,d.setCoords({env2D:e}),d.inflateCoords(c,c),d.contains(a)?(b.setCoords({env2D:e}),b.inflateCoords(-c,-c),a=b.containsExclusive(a)?!1:!0):a=!1),a}return!1}
function Hm(a,b,c,d,e){if(a.isEmpty()||b.isEmpty())return 4===d?!0:!1;a=a.getXY();b=b.getXY();if(c instanceof Sb||null===c)e=D.constructEmpty(),e.setCoords({pt:a}),e.merge(b),c=oc(c,e,!1);switch(d){case 4:return d=c,d=l.Point2D.sqrDistance(a,b)>d*d?!0:!1,d;case 2:case 128:return Lg(b,a,c);case 1:case 64:return Lg(a,b,c);case 3:return Lg(a,b,c)}return!1}function lc(a,b,c){const d=D.constructEmpty();d.setCoords({env2D:b});d.inflateCoords(c,c);return!a.isIntersecting(d)}function pa(a,b,c,d){d=a.getGeometryType();
c=b.getGeometryType();p.isMultiVertex(d)&&(a=a.getImpl().getAccelerators(),null!==a&&(a=a.getRasterizedGeometry(),p.geometryReleaseAssert(null===a)));p.isMultiVertex(c)&&(b=b.getImpl().getAccelerators(),null!==b&&(b=b.getRasterizedGeometry(),p.geometryReleaseAssert(null===b)));return 0}function $e(a,b,c,d){d=D.constructEmpty();d.setCoords({env2D:b});d.inflateCoords(c,c);return!d.contains(a)}function Im(a,b,c,d,e){switch(d){case 4:return pa(a,b,c,!0),1===je(a,b,c,!0);case 2:return Kj(b,a,c,e);case 128:return Lj(b,
a,c);case 1:return Kj(a,b,c,e);case 64:return Lj(a,b,c);case 3:return Mj(a,b,c,e);case 8:return pa(a,b),Nj(a,b,c,null);case 32:return pa(a,b),Oj(a,b,c,e)}return!1}function Bj(a,b,c,d,e){switch(d){case 4:return pa(a,b,c,!0),1===je(a,b,c,!0);case 1:d=D.constructEmpty();var f=D.constructEmpty();a.queryEnvelope(d);b.queryEnvelope(f);if(Sa(d,f,c))b:if(pa(a,b),d=[!1],f=Pj(a,b,c,d),d[0])c=f;else{d=D.constructEmpty();b.queryEnvelope(d);d.inflateCoords(1E3*c,1E3*c);if(10<a.getPointCount()&&(a=ra(a,d,c,0,e),
a.isEmpty())){c=!1;break b}{d=a;a=new $b;a.resetMatrix_();a.setPredicates_("T*****F**");a.setAreaLinePredicates_();f=D.constructEmpty();const g=D.constructEmpty();d.queryEnvelope(f);b.queryEnvelope(g);let h=!1;lc(f,g,c)&&(a.areaLineDisjointPredicates_(d,b),h=!0);h||pa(d,b);h?c=nb(a.m_matrix,a.m_scl):(f=new Fa,d=f.addGeometry(d),b=f.addGeometry(b),a.setEditShapeCrackAndCluster_(f,new jb(c,0),e),0===f.getPointCount(d)?c=!1:(a.computeMatrixTopoGraphHalfEdges_(d,b),a.m_topoGraph.removeShape(),c=nb(a.m_matrix,
a.m_scl)))}}else c=!1;return c;case 64:return e=D.constructEmpty(),d=D.constructEmpty(),a.queryEnvelope(e),b.queryEnvelope(d),Sa(e,d,c)?(pa(a,b),c=2===je(a,b,c,!1)):c=!1,c;case 8:return pa(a,b),Qj(a,b,c,e);case 16:return pa(a,b),Lm(a,b,c,null)}return!1}function Cj(a,b,c,d,e){switch(d){case 4:return a=0===Rj(a,b,c)?!0:!1,a;case 1:case 64:return b=b.getXY(),1===ob(a,b,c)?!0:!1;case 8:return b=b.getXY(),2===ob(a,b,c)?!0:!1}return!1}function Dj(a,b,c,d,e){switch(d){case 4:pa(a,b);a:{d=D.constructEmpty();
a.queryEnvelope(d);d.inflateCoords(c,c);e=new l.Point2D;var f=a.getImpl(),g=new ba,h=a,k=!1,m=!1,n=!1;for(var q=0;q<b.getPointCount();q++){b.queryXY(q,e);if(d.contains(e)){n=ob(h,e,c);if(1===n){m=!0;a=4;break a}if(2===n){a=4;break a}}n=!0;k||(!Gc(a,b.getPointCount()-1)||null!==f.getAccelerators()&&null!=f.getAccelerators().getQuadTree()?h=a:(a.copyTo(g),g.getImpl().buildQuadTreeAccelerator(1),h=g),k=!0)}a=m?n?4:2:1}return 1===a;case 1:return Sj(a,b,c,!1);case 64:return Sj(a,b,c,!0);case 8:a:{pa(a,
b);d=D.constructEmpty();a.queryEnvelope(d);d.inflateCoords(c,c);e=new l.Point2D;f=!1;g=a.getImpl();h=new ba;k=a;m=!1;for(q=0;q<b.getPointCount();q++){b.queryXY(q,e);if(d.contains(e))if(n=ob(k,e,c),2===n)f=!0;else if(1===n){a=!1;break a}m||(!Gc(a,b.getPointCount()-1)||null!==g.getAccelerators()&&null!==g.getAccelerators().getQuadTree()?k=a:(a.copyTo(h),h.getImpl().buildQuadTreeAccelerator(1),k=h),m=!0)}a=f?!0:!1}return a;case 16:a:{pa(a,b);e=new D;d=new D;f=new D;a.queryEnvelope(e);b.queryEnvelope(f);
d.setCoords({env2D:e});d.inflateCoords(c,c);f=e=!1;g=new l.Point2D;h=a.getImpl();k=new ba;m=a;q=!1;for(n=0;n<b.getPointCount();n++){b.queryXY(n,g);if(d.contains(g)){const r=ob(m,g,c);0===r?f=!0:1===r&&(e=!0)}else f=!0;if(e&&f){a=!0;break a}q||(!Gc(a,b.getPointCount()-1)||null!==h.getAccelerators()&&null!==h.getAccelerators().getQuadTree()?m=a:(a.copyTo(k),k.getImpl().buildQuadTreeAccelerator(1),m=k),q=!0)}a=!1}return a}return!1}function Ej(a,b,c,d,e){pa(a,b);var f=D.constructEmpty();var g=D.constructEmpty();
a.queryEnvelope(f);b.queryEnvelope(g);Sa(g,f,c)?g=!1:(f=g.getLowerLeft(),g=0!==ob(a,f,0)?!1:g.contains(a.getXY(0))?!1:!Tj(a,g,c));if(g)return 4===d?!0:!1;if(4===d)return!1;switch(d){case 2:return Uj(a,b,c,!1);case 128:return Uj(a,b,c,!0);case 1:return Vj(a,b,c,!1,e);case 64:return Vj(a,b,c,!0,e);case 3:return d=new D,g=new D,a.queryEnvelope(d),b.queryEnvelope(g),vc(d,g,c)?(d=new ba,d.addEnvelope(b,!1),a=Mj(a,d,c,e)):a=!1,a;case 8:return pa(a,b),d=new D,g=new D,a.queryEnvelope(d),b.queryEnvelope(g),
Sa(g,d,c)?a=!1:g.height()<=c||g.width()<=c?a=!1:(d=new ba,d.addEnvelope(b,!1),a=Nj(a,d,c,e)),a;case 32:return pa(a,b),d=new D,g=new D,a.queryEnvelope(d),b.queryEnvelope(g),Sa(g,d,c)?a=!1:g.height()<=c||g.width()<=c?a=!1:(d=new ba,d.addEnvelope(b,!1),a=Oj(a,d,c,e)),a}return!1}function Jm(a,b,c,d,e){switch(d){case 4:return pa(a,b),e=a.getImpl(),d=b.getImpl(),c=(new vb(e,d,c,!0)).next()?!Wj(a,b,c):!0,c;case 2:return Xj(b,a,c,e);case 128:return Yj(b,a,c,e);case 1:return Xj(a,b,c,e);case 64:return Yj(a,
b,c,e);case 3:d=D.constructEmpty();var f=D.constructEmpty();a.queryEnvelope(d);b.queryEnvelope(f);vc(d,f,c)?(pa(a,b),c=Zj(a,b,c)?!0:a.hasNonLinearSegments()||b.hasNonLinearSegments()?Ib(a,b,c,"**F**FFF*",e,!1):wc(a,b,c,!1)&&wc(b,a,c,!1)):c=!1;return c;case 8:a:if(pa(a,b),d=[],f=Mg(a,b,c,d),-2===f){f=D.constructEmpty();var g=D.constructEmpty();d=D.constructEmpty();a.queryEnvelope(f);b.queryEnvelope(g);f.inflateCoords(1E3*c,1E3*c);g.inflateCoords(1E3*c,1E3*c);d.setCoords({env2D:f});d.intersect(g);if(10<
a.getPointCount()&&(a=ra(a,d,c,0,e),a.isEmpty())){c=!1;break a}if(10<b.getPointCount()&&(b=ra(b,d,c,0,e),b.isEmpty())){c=!1;break a}c=Ib(a,b,c,"F********",e,!1)}else if(0!==f)c=!1;else{e=new Oa;for(f=0;f<d.length;f+=2)e.addXY(d[f],d[f+1]);a=a.getBoundary();b=b.getBoundary();a.addPoints(b,0,b.getPointCount());c=a.isEmpty()?!1:Rc(a,e,c)}return c;case 32:return Mm(a,b,c,e);case 16:a:if(pa(a,b),d=[],f=Mg(a,b,c,d),-2===f){f=D.constructEmpty();g=D.constructEmpty();d=D.constructEmpty();a.queryEnvelope(f);
b.queryEnvelope(g);f.inflateCoords(1E3*c,1E3*c);g.inflateCoords(1E3*c,1E3*c);d.setCoords({env2D:f});d.intersect(g);if(10<a.getPointCount()&&(a=ra(a,d,c,0,e),a.isEmpty())){c=!1;break a}if(10<b.getPointCount()&&(b=ra(b,d,c,0,e),b.isEmpty())){c=!1;break a}c=Ib(a,b,c,"0********",e,!1)}else if(0!==f)c=!1;else{e=new Oa;for(f=0;f<d.length;f+=2)e.addXY(d[f],d[f+1]);a=a.getBoundary();b=b.getBoundary();a.addPoints(b,0,b.getPointCount());c=a.isEmpty()?!0:!Rc(a,e,c)}return c}return!1}function Fj(a,b,c,d,e){switch(d){case 4:return pa(a,
b),b=b.getXY(),!ak(a,b,c);case 1:case 64:return pa(a,b),b=b.getXY(),ak(a,b,c)&&!bk(a,b,c);case 8:return pa(a,b),b=b.getXY(),bk(a,b,c)}return!1}function Gj(a,b,c,d,e){switch(d){case 4:return pa(a,b),!ck(a,b,c,!1);case 1:case 64:return d=D.constructEmpty(),e=D.constructEmpty(),a.queryEnvelope(d),b.queryEnvelope(e),Sa(d,e,c)?(pa(a,b),(d=ck(a,b,c,!0))?(a=a.getBoundary(),c=a.isEmpty()?d:!Rc(a,b,c)):c=d):c=!1,c;case 8:pa(a,b);var f=a.getImpl();d=b.getImpl();b=new Oa;e=new vb(f,d,c,!1);f=f.querySegmentIterator();
for(var g=!1;e.next();){var h=e.getRedElement(),k=e.getBlueElement();f.resetToVertex(h,-1);h=f.nextSegment();k=d.getXY(k);h.isIntersectingPoint(k,c)&&(g=!0,b.addPoint2D(k))}g?(a=a.getBoundary(),c=a.isEmpty()?!1:Rc(a,b,c)):c=!1;return c;case 16:pa(a,b);g=a.getImpl();b=b.getImpl();d=b.getPointCount();e=l.makePrimitiveArray(d,!1);f=new vb(g,b,c,!1);g=g.querySegmentIterator();for(k=!1;f.next();){var m=f.getRedElement();h=f.getBlueElement();g.resetToVertex(m,-1);m=g.nextSegment();const n=b.getXY(h);m.isIntersectingPoint(n,
c)&&(k=!0,e[h]=!0)}if(k){f=!1;for(g=0;g<d;g++)if(!e[g]){f=!0;break}if(f)if(a=a.getBoundary(),a.isEmpty())c=!0;else{f=new Oa;for(g=0;g<d;g++)e[g]&&f.addPoint2D(b.getXY(g));c=!Rc(a,f,c)}else c=!1}else c=!1;return c}return!1}function Hj(a,b,c,d,e){var f=D.constructEmpty();var g=D.constructEmpty();a.queryEnvelope(f);b.queryEnvelope(g);var h=g;var k=D.constructEmpty();k.setCoords({env2D:h});k.inflateCoords(c,c);h=k.containsEnvelope(f)?1073741824:k.isIntersecting(f)?h.isIntersecting(f)?h.xmin<f.xmin&&f.xmax<
h.xmax?f.ymin<h.ymin&&f.ymax>h.ymax?0:1073741824:h.ymin<f.ymin&&f.ymax<h.ymax&&!(f.xmin<h.xmin&&f.xmax>h.xmax)?1073741824:0:0:4;g=0===h?!Tj(a,g,c):4===h;if(g)return 4===d?!0:!1;if(4===d)return!1;switch(d){case 2:return dk(a,b,c,!1);case 128:return dk(a,b,c,!0);case 3:return d=new D,e=new D,a.queryEnvelope(d),b.queryEnvelope(e),c=e.height()>c&&e.width()>c?!1:vc(d,e,c),c;case 8:return Nm(a,b,c,e);case 16:d=new D;h=new D;a.queryEnvelope(d);b.queryEnvelope(h);if(h.height()<=c||h.width()<=c)c=!1;else if(b=
new D,b.setCoords({env2D:h}),b.inflateCoords(c,c),b.containsEnvelope(d))c=!1;else if(b=new D,b.setCoords({env2D:h}),b.inflateCoords(-c,-c),b.isIntersecting(d)){d=a.getImpl().querySegmentIterator();d.stripAttributes();f=a.getImpl().getAccelerators();g=e=null;null!==f&&(e=f.getQuadTree(),null!==e&&(g=e.getIterator(h,c)));g||(h=d.nextPath(),p.geometryReleaseAssert(h));h=!1;var m=null;f=new l.Point2D;k=new l.Point2D;var n=null,q=null,r=null,t=null;a.hasNonLinearSegments()&&(n=new Z,q=new Z,r=new Z,t=
new Z,b.querySide(0,n),b.querySide(1,q),b.querySide(2,r),b.querySide(3,t));for(;;){if(null!==g){a=g.next();if(-1===a)break;d.resetToVertex(e.getElement(a),-1)}else{for(;!d.hasNextSegment()&&d.nextPath(););if(!d.hasNextSegment())break}m=d.nextSegment();if(m.getGeometryType()===p.GeometryType.enumLine){if(f.assign(m.getStartXY()),k.assign(m.getEndXY()),0!==b.clipLine(f,k)){h=!0;break}}else{if(n.isIntersecting(m,c)){h=!0;break}if(q.isIntersecting(m,c)){h=!0;break}if(r.isIntersecting(m,c)){h=!0;break}if(t.isIntersecting(m,
c)){h=!0;break}}}c=h&&!0}else c=!1;return c}return!1}function Km(a,b,c,d,e){switch(d){case 4:a:{d=new vb(a,b,c,!1);c*=c;e=new l.Point2D;for(var f=new l.Point2D;d.next();){var g=d.getRedElement(),h=d.getBlueElement();a.queryXY(g,e);b.queryXY(h,f);if(l.Point2D.sqrDistance(e,f)<=c){a=!1;break a}}a=!0}return a;case 2:case 128:return Rc(b,a,c);case 1:case 64:return Rc(a,b,c);case 3:d=D.constructEmpty();e=D.constructEmpty();a.queryEnvelope(d);b.queryEnvelope(e);if(vc(d,e,c)){if(a.getPointCount()!==b.getPointCount())d=
!1;else{d=new l.Point2D;e=new l.Point2D;f=!0;g=c*c;for(h=0;h<a.getPointCount();h++)if(a.queryXY(h,d),b.queryXY(h,e),l.Point2D.sqrDistance(d,e)>g){f=!1;break}d=f?!0:!1}a=d?!0:Ng(a,b,c,!1,!0,!1)}else a=!1;return a;case 32:return Ng(a,b,c,!1,!1,!0)}return!1}function Ij(a,b,c,d,e){switch(d){case 4:return b=b.getXY(),Og(a,b,c);case 2:case 128:return ek(a,b,c);case 1:case 64:return b=b.getXY(),!Og(a,b,c);case 3:return ek(a,b,c)}return!1}function Jj(a,b,c,d,e){switch(d){case 4:a:if(e=D.constructEmpty(),
d=D.constructEmpty(),a.queryEnvelope(e),b.queryEnvelope(d),Sa(d,e,c))a=!1;else{b=D.constructEmpty();b.setCoords({env2D:d});b.inflateCoords(c,c);c=new l.Point2D;for(d=0;d<a.getPointCount();d++)if(a.queryXY(d,c),b.contains(c)){a=!1;break a}a=!0}return a;case 2:return fk(a,b,c,!1);case 128:return fk(a,b,c,!0);case 3:return d=new D,e=new D,a.queryEnvelope(d),b.queryEnvelope(e),a=e.height()>c||e.width()>c?!1:vc(d,e,c),a;case 8:a:{var f=new D;d=new D;e=new D;b.queryEnvelope(f);if(f.height()<=c||f.width()<=
c)a=!1;else{d.setCoords({env2D:f});e.setCoords({env2D:f});d.inflateCoords(c,c);e.inflateCoords(-c,-c);c=new l.Point2D;b=!1;for(f=0;f<a.getPointCount();f++)if(a.queryXY(f,c),d.contains(c)){if(e.containsExclusive(c)){a=!1;break a}b=!0}a=b}}return a;case 16:a:{d=new D;e=new D;a.queryEnvelope(d);b.queryEnvelope(e);if(!(Sa(e,d,c)||e.height()<=c||e.width()<=c)){b=new D;d=new D;b.setCoords({env2D:e});b.inflateCoords(-c,-c);d.setCoords({env2D:e});d.inflateCoords(c,c);c=new l.Point2D;f=e=!1;for(let g=0;g<
a.getPointCount();g++)if(a.queryXY(g,c),!e&&b.containsExclusive(c)&&(e=!0),f||d.contains(c)||(f=!0),e&&f){a=!0;break a}}a=!1}return a}return!1}function Mj(a,b,c,d){var e=D.constructEmpty(),f=D.constructEmpty();a.queryEnvelope(e);b.queryEnvelope(f);if(!vc(e,f,c))return!1;pa(a,b);if(Zj(a,b,c))return!0;e=a.calculateLength2D();f=b.calculateLength2D();const g=Math.max(a.getPointCount(),b.getPointCount());return Math.abs(e-f)>4*g*c?!1:a.hasNonLinearSegments()||b.hasNonLinearSegments()?Ib(a,b,c,"**F**FFF*",
d,!1):wc(a,b,c,!0)&&wc(b,a,c,!0)}function Kj(a,b,c,d){const e=D.constructEmpty(),f=D.constructEmpty();a.queryEnvelope(e);b.queryEnvelope(f);if(!Sa(e,f,c))return!1;pa(a,b);return gk(a,b,c,d)}function Lj(a,b,c,d){d=D.constructEmpty();const e=D.constructEmpty();a.queryEnvelope(d);b.queryEnvelope(e);if(!Sa(d,e,c))return!1;pa(a,b);return 2===je(a,b,c,!1)}function Sj(a,b,c,d,e){e=D.constructEmpty();var f=D.constructEmpty();a.queryEnvelope(e);b.queryEnvelope(f);if(!Sa(e,f,c))return!1;pa(a,b);f=!1;const g=
new l.Point2D,h=a.getImpl(),k=new ba;let m=a,n=!1;for(let q=0;q<b.getPointCount();q++){b.queryXY(q,g);if(!e.contains(g))return!1;const r=ob(m,g,c);if(1===r)f=!0;else if(0===r)return!1;if(d&&2===r)return!1;n||(!Gc(a,b.getPointCount()-1)||null!==h.getAccelerators()&&null!==h.getAccelerators().getQuadTree()?m=a:(a.copyTo(k),k.getImpl().buildQuadTreeAccelerator(1),m=k),n=!0)}return f}function Uj(a,b,c,d,e){e=D.constructEmpty();const f=D.constructEmpty();a.queryEnvelope(e);b.queryEnvelope(f);return d?
bf(f,e,c):Sa(f,e,c)}function Vj(a,b,c,d,e){var f=D.constructEmpty();const g=D.constructEmpty();a.queryEnvelope(f);b.queryEnvelope(g);if(!Sa(f,g,c))return!1;pa(a,b);f=new ba;f.addEnvelope(b,!1);return d?2===je(a,f,c,!1):gk(a,f,c,e)}function Mm(a,b,c,d){pa(a,b);var e=D.constructEmpty();const f=D.constructEmpty();a.queryEnvelope(e);b.queryEnvelope(f);const g=ke(e,f,c),h=ke(f,e,c);var k=a.hasNonLinearSegments(),m=b.hasNonLinearSegments(),n=Mg(a,b,c,null);if(-1===n)return!1;if(1===n){if(g&&h)return!0;
if(!k&&!m)return g&&!h?!wc(b,a,c,!1):h&&!g?!wc(a,b,c,!1):!wc(a,b,c,!1)&&!wc(b,a,c,!1)}m=D.constructEmpty();n=D.constructEmpty();k=D.constructEmpty();m.setCoords({env2D:e});m.inflateCoords(1E3*c,1E3*c);n.setCoords({env2D:f});n.inflateCoords(1E3*c,1E3*c);k.setCoords({env2D:m});k.intersect(n);e="1*";if(g){if(10<b.getPointCount()&&(b=ra(b,k,c,0,d),b.isEmpty()))return!1;e+="****"}else e+="T***";if(h){if(10<a.getPointCount()&&(a=ra(a,k,c,0,d),a.isEmpty()))return!1;e+="***"}else e+="T**";return Ib(a,b,c,
e,d,!1)}function Xj(a,b,c,d){const e=D.constructEmpty(),f=D.constructEmpty();a.queryEnvelope(e);b.queryEnvelope(f);if(!Sa(e,f,c))return!1;pa(a,b);return a.hasNonLinearSegments()||b.hasNonLinearSegments()?Ib(a,b,c,"******FF*",d,!1):wc(b,a,c,!1)}function Yj(a,b,c,d){const e=D.constructEmpty(),f=D.constructEmpty();a.queryEnvelope(e);b.queryEnvelope(f);if(!Sa(e,f,c))return!1;pa(a,b);return Ib(a,b,c,"T**FF*FF*",d,!1)}function Nm(a,b,c,d){var e=new D;const f=new D;a.queryEnvelope(e);b.queryEnvelope(f);
if(f.height()<=c||f.width()<=c)return!1;b=new D;const g=new D;b.setCoords({env2D:f});g.setCoords({env2D:f});b.inflateCoords(c,c);g.inflateCoords(-c,-c);if(g.containsEnvelope(e)||!e.isIntersecting(b))return!1;e=a.getImpl().querySegmentIterator();e.stripAttributes();var h=a.getImpl().getAccelerators();let k=null,m=null;null!==h&&(k=h.getQuadTree(),null!==k&&(m=k.getIterator(f,c)));m||e.nextPath()||p.throwInternalErrorException("relational_operations");h=!1;var n=null;const q=new l.Point2D,r=new l.Point2D,
t=a.hasNonLinearSegments();let u=!1;for(;;){if(null!==m){n=m.next();if(-1===n)break;e.resetToVertex(k.getElement(n),-1)}else{for(;!e.hasNextSegment()&&e.nextPath(););if(!e.hasNextSegment())break}n=e.nextSegment();if(t&&n.getGeometryType()!==p.GeometryType.enumLine){const v=new D;n.queryEnvelope(v);if(g.containsEnvelope(v))return!1;if(b.isIntersecting(v)){u=!0;break}}else{q.assign(n.getStartXY());r.assign(n.getEndXY());n=g.clipLine(q,r);if(0!==n)return!1;h||(n=b.clipLine(q,r),0!==n&&(h=!0))}}if(!u)return h;
b=new ba;b.addEnvelope(f,!1);pa(b,a);return Qj(b,a,c,d)}function dk(a,b,c,d,e){e=D.constructEmpty();var f=D.constructEmpty();a.queryEnvelope(e);b.queryEnvelope(f);if(f.height()<=c||f.width()<=c)return!1;if(d)return bf(f,e,c);if(!Sa(f,e,c))return!1;b=D.constructEmpty();b.setCoords({env2D:f});b.inflateCoords(-c,-c);d=D.constructEmpty();d.setCoords({env2D:f});d.inflateCoords(c,c);if(b.containsEnvelope(e))return!0;e=a.getImpl().querySegmentIterator();e.stripAttributes();e.nextPath()||p.throwInternalErrorException("relational_operations");
f=!1;let g,h,k,m;if(d=a.hasNonLinearSegments())g=new Z,h=new Z,k=new Z,m=new Z,b.querySide(0,g),b.querySide(1,h),b.querySide(2,k),b.querySide(3,m);for(;;){for(;!e.hasNextSegment()&&e.nextPath(););if(!e.hasNextSegment())break;var n=e.nextSegment();if(d&&n.getGeometryType()!==p.GeometryType.enumLine){if(n.isIntersecting(g,c)){f=!0;break}if(n.isIntersecting(h,c)){f=!0;break}if(n.isIntersecting(k,c)){f=!0;break}if(n.isIntersecting(m,c)){f=!0;break}}else if(a=n.getStartXY(),n=n.getEndXY(),0!==b.clipLine(a,
n)){f=!0;break}}return f}function Rc(a,b,c,d){d=D.constructEmpty();const e=D.constructEmpty();a.queryEnvelope(d);b.queryEnvelope(e);return Sa(d,e,c)?Ng(b,a,c,!0,!1,!1):!1}function ek(a,b,c,d){d=D.constructEmpty();const e=D.constructEmpty();a.queryEnvelope(d);b.queryEnvelope(e);return vc(d,e,c)}function fk(a,b,c,d,e){var f=D.constructEmpty();e=D.constructEmpty();a.queryEnvelope(f);b.queryEnvelope(e);if(e.height()<=c||e.width()<=c)return!1;if(d)return bf(e,f,c);if(!Sa(e,f,c))return!1;b=!1;d=D.constructEmpty();
f=D.constructEmpty();d.setCoords({env2D:e});f.setCoords({env2D:e});d.inflateCoords(-c,-c);f.inflateCoords(c,c);c=new l.Point2D;for(e=0;e<a.getPointCount();e++){a.queryXY(e,c);if(!f.contains(c))return!1;d.containsExclusive(c)&&(b=!0)}return b}function Lg(a,b,c,d){return l.Point2D.sqrDistance(a,b)<=c*c?!0:!1}function vc(a,b,c,d){return Sa(a,b,c)&&Sa(b,a,c)}function af(a,b,c,d,e){if(a.height()<=c||a.width()<=c)return!1;if(d)return bf(a,b,c);if(!Sa(a,b,c))return!1;d=D.constructEmpty();d.setCoords({env2D:a});
d.inflateCoords(-c,-c);d.intersect(b);return!d.isEmpty()}function je(a,b,c,d,e){e=new l.Point2D;const f=new l.Point2D,g=D.constructEmpty(),h=D.constructEmpty(),k=a.getImpl(),m=b.getImpl(),n=m.getGeometryType(),q=new vb(k,m,c,!0);if(!q.next())return 1;if(Wj(a,b,c))return d?4:0;const r=new ba;let t=a;const u=new ba;var v=null;n===p.GeometryType.enumPolygon&&(v=b);const w=n===p.GeometryType.enumPolygon?l.makePrimitiveArray(k.getPathCount(),!1):[],x=l.makePrimitiveArray(m.getPathCount(),!1);let y=!1,
z=!1,A=!1,C=!1,B=!1,E=!1;do{if(A&&B||C&&E)break;if(A&&C)break;const G=q.getRedElement(),I=q.getBlueElement();if(!x[I]&&(f.assign(b.getXY(b.getPathStart(I))),g.setCoords({env2D:q.getRedEnvelope()}),g.inflateCoords(c,c),g.contains(f))){if(0!==ob(t,f,0)){if(C=!0,d)return 4}else E=!0;x[I]=!0}if(n===p.GeometryType.enumPolygon&&!w[G]&&(e.assign(a.getXY(a.getPathStart(G))),h.setCoords({env2D:q.getBlueEnvelope()}),h.inflateCoords(c,c),h.contains(e))){if(0!==ob(v,e,0)){if(A=!0,d)return 4}else B=!0;w[G]=!0}y||
(!Gc(a,b.getPathCount()-1)||null!==k.getAccelerators()&&null!==k.getAccelerators().getQuadTree()?t=a:(a.copyTo(r),r.getImpl().buildQuadTreeAccelerator(1),t=r),y=!0);n!==p.GeometryType.enumPolygon||z||(v=b,!Gc(v,a.getPathCount()-1)||null!==m.getAccelerators()&&null!==m.getAccelerators().getQuadTree()?v=b:(v.copyTo(u),u.getImpl().buildQuadTreeAccelerator(1),v=u),z=!0)}while(q.next());if(!A&&!C)return 1;if(!B||!E){if(n===p.GeometryType.enumPolygon)for(let G=0,I=k.getPathCount();G<I;G++)if(!w[G]){B=!0;
break}for(let G=0,I=m.getPathCount();G<I;G++)if(!x[G]){E=!0;break}}return A&&B||C&&E||A&&C?4:C?2:3}function Pj(a,b,c,d,e){d[0]=!1;var f=a.getImpl();e=b.getImpl();var g=f.querySegmentIterator(),h=e.querySegmentIterator(),k=[0,0],m=[0,0];const n=new vb(f,e,c);let q=!1;for(;n.next();){var r=n.getRedElement(),t=n.getBlueElement();g.resetToVertex(r,-1);h.resetToVertex(t,-1);r=g.nextSegment();t=h.nextSegment();let u=0;xd(r,t)?!q&&t.isIntersecting(r,c)&&(q=!0):u=t.intersect(r,null,m,k,c);if(0!==u&&(q=!0,
1===u&&(r=k[0],t=m[0],0<r&&1>r&&0<t&&1>t)))return d[0]=!0,!1}if(!q){d[0]=!0;d=D.constructEmpty();a.queryEnvelope(d);d.inflateCoords(c,c);g=new ba;h=a;k=!1;for(let u=0,v=b.getPathCount();u<v;u++)if(0<b.getPathSize(u)){m=D.constructEmpty();b.queryPathEnvelope(u,m);if(d.isIntersecting(m)){if(m=b.getXY(b.getPathStart(u)),m=Ye(h,m,0),p.geometryReleaseAssert(-1!==m),0===m)return!1}else return!1;k||(!Gc(a,b.getPathCount()-1)||null!==f.getAccelerators()&&null!==f.getAccelerators().getQuadTree()?h=a:(a.copyTo(g),
g.getImpl().buildQuadTreeAccelerator(1),h=g),k=!0)}if(1===a.getPathCount()||b.getGeometryType()===p.GeometryType.enumPolyline)return!0;f=D.constructEmpty();b.queryEnvelope(f);f.inflateCoords(c,c);c=new ba;d=b;g=!1;for(let u=0,v=a.getPathCount();u<v;u++)if(0<a.getPathSize(u)){h=D.constructEmpty();a.queryPathEnvelope(u,h);if(f.isIntersecting(h)&&(h=a.getXY(a.getPathStart(u)),h=Ye(d,h,0),p.geometryReleaseAssert(-1!==h),1===h))return!1;g||(!Gc(b,a.getPathCount()-1)||null!==e.getAccelerators()&&null!==
e.getAccelerators().getQuadTree()?d=b:(b.copyTo(c),c.getImpl().buildQuadTreeAccelerator(1),d=c),g=!0)}return!0}return!1}function Sa(a,b,c){const d=D.constructEmpty();d.setCoords({env2D:a});d.inflateCoords(c,c);return d.containsEnvelope(b)}function bf(a,b,c){const d=D.constructEmpty();d.setCoords({env2D:b});d.inflateCoords(c,c);return a.containsExclusiveEnvelope(d)}function ke(a,b,c){const d=D.constructEmpty();d.setCoords({env2D:b});d.inflateCoords(c,c);return d.contains(a.getLowerLeft())&&d.contains(a.getLowerRight())&&
d.contains(a.getUpperLeft())&&d.contains(a.getUpperRight())?!1:!0}function Zj(a,b,c,d){if(a.getPathCount()!==b.getPathCount()||a.getPointCount()!==b.getPointCount())return!1;if(a.hasNonLinearSegments()||b.hasNonLinearSegments())return a.equals(b);d=new l.Point2D;const e=new l.Point2D;let f=!0;c*=c;for(let g=0;g<a.getPathCount();g++){if(a.getPathEnd(g)!==b.getPathEnd(g)){f=!1;break}for(let h=a.getPathStart(g);h<b.getPathEnd(g);h++)if(a.queryXY(h,d),b.queryXY(h,e),l.Point2D.sqrDistance(d,e)>c){f=!1;
break}if(!f)break}return f?!0:!1}function Ng(a,b,c,d,e,f,g){var h=a.getImpl(),k=b.getImpl();g=h.getPointCount();b=k.getPointCount();var m=l.makePrimitiveArray(g,!1);a=e||f?l.makePrimitiveArray(b,!1):[];var n=c*c;for(c=new vb(h,k,c);c.next();){const q=c.getRedElement(),r=c.getBlueElement(),t=h.getXY(q),u=k.getXY(r);l.Point2D.sqrDistance(t,u)<=n&&(m[q]=!0,e||f)&&(a[r]=!0)}h=f=!1;for(k=0;k<g;k++)if(n=m[k],f||=!n,h||=n,(e||d)&&f)return!1;if(d)return!0;g=d=!1;for(m=0;m<b;m++)if(k=a[m],d||=!k,g||=k,e&&
d)return!1;return e?!0:f&&h&&d&&g}function wc(a,b,c,d){p.throwIfCurves(a);p.throwIfCurves(b);if(b.isEmpty())return!1;let e=!0;const f=l.makePrimitiveArray(2,Number.NaN),g=l.makePrimitiveArray(2,Number.NaN),h=[],k=new Om;const m=D.constructEmpty(),n=D.constructEmpty(),q=D.constructEmpty();a.queryEnvelope(m);b.queryEnvelope(n);m.inflateCoords(c,c);n.inflateCoords(c,c);q.setCoords({env2D:m});q.intersect(n);const r=a.getImpl().querySegmentIterator(),t=b.getImpl().querySegmentIterator();var u=b.getImpl().getAccelerators();
let v=null;var w=null;let x=null,y=null;null!==u&&(v=u.getQuadTree(),w=u.getQuadTreeForPaths(),null!==w&&(y=w.getIteratorForQT()));null===v&&(a=a.getPointCount(),u=b.getPointCount(),10<a&&10<u&&(v=fd(b.getImpl(),q)));for(null!==v&&(x=v.getIteratorForQT());r.nextPath();)for(;r.hasNextSegment();){b=r.nextSegment();b.queryEnvelope(m);if(!m.isIntersecting(q))return e=!1;if(null!==y&&(y.resetIterator(m,c),-1===y.next()))continue;var z=0;var A=null;if(null!=x)x.resetIterator(b,c);else if(t.resetToFirstPath(),
!t.nextPath())return e=!1;do if(z=0,null!==x){a=x.next();if(-1===a)return e=!1;t.resetToVertex(v.getElement(a),-1);A=t.nextSegment();z=b.intersect(A,null,f,g,c)}else{for(;!t.hasNextSegment();)if(!t.nextPath())return e=!1;A=t.nextSegment();A.queryEnvelope(n);n.inflateCoords(c,c);m.isIntersecting(n)&&(z=b.intersect(A,null,f,g,c))}while(2!==z||0!==f[0]||d&&!(g[0]<=g[1]));a=Number.NaN;u=!1;do{w=!1;if(1===f[1]){if(!r.hasNextSegment()){u=!0;break}b=r.nextSegment();w=!0}if(1===g[1]&&g[0]<=g[1]){if(-1===
a)break;a=1;if(!t.hasNextSegment())break;A=t.nextSegment();w=!0}if(0===g[1]&&g[0]>g[1]){if(1===a)break;if(Number.isNaN(a)){if(!t.hasPreviousSegment())break;t.previousSegment();a=-1}if(!t.hasPreviousSegment())break;A=t.previousSegment();w=!0}if(!w)break;z=b.intersect(A,null,f,g,c)}while(2===z&&(!d||g[0]<=g[1]));if(u)continue;a=b.calculateLength2D();b.queryEnvelope(m);h.length=0;k.m_overlapEvents.length=0;let C=!1,B=!1;u=0;w=oc(null,m,!0);null!==x?x.resetIterator(b,c):(t.resetToFirstPath(),t.nextPath()||
p.throwInternalErrorException("relational_operations"));for(;;){z=0;if(null!==x){A=x.next();if(-1===A)break;t.resetToVertex(v.getElement(A),-1);A=t.nextSegment();z=b.intersect(A,null,f,g,c)}else{for(;!t.hasNextSegment()&&t.nextPath(););if(!t.hasNextSegment())break;A=t.nextSegment();A.queryEnvelope(n);n.inflateCoords(c,c);m.isIntersecting(n)&&(z=b.intersect(A,null,f,g,c))}if(2===z&&(!d||g[0]<=g[1])){A=r.getStartPointIndex();z=r.getPathIndex();const E=t.getStartPointIndex(),G=t.getPathIndex();A={m_ivertexA:A,
m_ipathA:z,m_scalarA0:f[0],m_scalarA1:f[1],m_ivertexB:E,m_ipathB:G,m_scalarB0:g[0],m_scalarB1:g[1]};k.m_overlapEvents.push(A);h.push(h.length);if(!(C||A.m_scalarA0<u&&A.m_scalarA1<u))if(0===u&&a*(A.m_scalarA0-u)>c)C=!0;else if(0!==u&&a*(A.m_scalarA0-u)>w)C=!0;else if(u=A.m_scalarA1,a*(1-u)<=c||1===u){B=!0;break}}}if(!B){if(!C)return e=!1;1<h.length&&h.sort((E,G)=>k.compareOverlapEvents(E,G));u=0;for(b=0;b<k.m_overlapEvents.length;b++)if(A=k.m_overlapEvents[h[b]],!(A.m_scalarA0<u&&A.m_scalarA1<u)){if(0===
u&&a*(A.m_scalarA0-u)>c||0!==u&&a*(A.m_scalarA0-u)>w)return e=!1;u=A.m_scalarA1;if(a*(1-u)<=c||1===u)break}if(a*(1-u)>c)return e=!1;h.length=0;k.m_overlapEvents.length=0}}return e}function Wj(a,b,c){var d=a.getImpl(),e=b.getImpl();b=d.querySegmentIterator();a=e.querySegmentIterator();for(d=new vb(d,e,c);d.next();){e=d.getRedElement();const f=d.getBlueElement();b.resetToVertex(e,-1);a.resetToVertex(f,-1);e=b.nextSegment();if(a.nextSegment().isIntersecting(e,c))return!0}return!1}function Mg(a,b,c,d){var e=
a.getImpl(),f=b.getImpl();b=e.querySegmentIterator();a=f.querySegmentIterator();const g=l.makePrimitiveArray(2,Number.NaN);e=new vb(e,f,c);f=!1;let h=-1;for(;e.next();){var k=e.getRedElement(),m=e.getBlueElement();b.resetToVertex(k,-1);a.resetToVertex(m,-1);k=b.nextSegment();m=a.nextSegment();var n=0;if(xd(k,m)){if(m.isIntersecting(k,c))return-2}else n=k.intersect(m,null,g,null,c);if(n)if(2===n){if(k.calculateLength2D()*(g[1]-g[0])>c)return h=1;f=!0}else h=0,d&&(m=g[0],n=new l.Point2D,k.queryCoord2D(m,
n),d.push(n.x),d.push(n.y))}return f?-2:h}function ck(a,b,c,d){var e=a.getImpl();a=b.getPointCount();const f=d?l.makePrimitiveArray(a,!1):[],g=new vb(e,b,c,!1);for(e=e.querySegmentIterator();g.next();){var h=g.getRedElement();const k=g.getBlueElement();e.resetToVertex(h,-1);h=e.nextSegment();const m=b.getXY(k);if(h.isIntersectingPoint(m,c)){if(!d)return!0;f[k]=!0}}if(!d)return!1;for(b=0;b<a;b++)if(!f[b])return!1;return!0}function ak(a,b,c){const d=new l.Point2D,e=c*c,f=a.querySegmentIterator();a=
a.getImpl().getAccelerators();if(null!==a&&(a=a.getQuadTree(),null!==a)){var g=D.constructEmpty();g.setCoords({pt:b});c=a.getIterator(g,c);for(g=c.next();-1!==g;g=c.next())if(f.resetToVertex(a.getElement(g),-1),f.hasNextSegment()){g=f.nextSegment();var h=g.getClosestCoordinate(b,!1);g.queryCoord2D(h,d);if(l.Point2D.sqrDistance(b,d)<=e)return!0}return!1}for(a=D.constructEmpty();f.nextPath();)for(;f.hasNextSegment();)if(g=f.nextSegment(),g.queryEnvelope(a),a.inflateCoords(c,c),a.contains(b)&&(h=g.getClosestCoordinate(b,
!1),g.queryCoord2D(h,d),l.Point2D.sqrDistance(b,d)<=e))return!0;return!1}function Tj(a,b,c,d){var e=a.querySegmentIterator(),f=a.getImpl().getAccelerators(),g=a.hasNonLinearSegments(),h=d=null,k=null,m=null;if(null!==f&&(f=f.getQuadTree(),null!==f)){a=f.getIterator(b,c);g&&(d=new Z,h=new Z,k=new Z,m=new Z,b.querySide(0,d),b.querySide(1,h),b.querySide(2,k),b.querySide(3,m));g=D.constructEmpty();g.setCoords({env2D:b});g.inflateCoords(c,c);for(var n=a.next();-1!==n;n=a.next())if(e.resetToVertex(f.getElement(n),
-1),e.hasNextSegment()){var q=e.nextSegment();if(q.getGeometryType()===p.GeometryType.enumLine){if(n=q.getStartXY(),q=q.getEndXY(),g.clipLine(n,q))return!0}else if(b.contains(q.getStartXY())||b.contains(q.getEndXY())||q.isIntersecting(d,c)||q.isIntersecting(h,c)||q.isIntersecting(k,c)||q.isIntersecting(m,c))return!0}return!1}if(g)for(d=new Z,h=new Z,k=new Z,m=new Z,b.querySide(0,d),b.querySide(1,h),b.querySide(2,k),b.querySide(3,m),e=a.querySegmentIterator();e.nextPath();)for(;e.hasNextSegment();){if(f=
e.nextSegment(),b.contains(f.getStartXY())||b.contains(f.getEndXY())||f.isIntersecting(d,c)||f.isIntersecting(h,c)||f.isIntersecting(k,c)||f.isIntersecting(m,c))return!0}else{d=D.constructEmpty();d.setCoords({env2D:b});d.inflateCoords(c,c);b=a.getImpl();c=b.getAttributeStreamRef(0);h=new l.Point2D;for(let r=0,t=b.getPathCount();r<t;r++){k=!0;m=new l.Point2D;e=new l.Point2D;f=new l.Point2D;a=b.getPathStart(r);g=new l.Point2D;for(let u=a,v=b.getPathEnd(r);u<v;u++)if(k)c.queryPoint2D(2*u,m),g.assign(m),
k=!1;else{c.queryPoint2D(2*u,h);e.setCoordsPoint2D(m);f.setCoordsPoint2D(h);if(d.clipLine(e,f))return!0;m.assign(h)}if(b.isClosedPath(r)&&!k&&(e.setCoordsPoint2D(m),f.setCoordsPoint2D(g),d.clipLine(e,f)))return!0}}return!1}function Nj(a,b,c,d){var e=a.getImpl(),f=b.getImpl(),g=[0];g=3<=e.getIsSimple(0,g)&&3<=f.getIsSimple(0,g);var h=e.querySegmentIterator(),k=f.querySegmentIterator();const m=l.makePrimitiveArray(2,0),n=l.makePrimitiveArray(2,0);e=new vb(e,f,c);for(f=!1;e.next();){var q=e.getRedElement(),
r=e.getBlueElement();h.resetToVertex(q,-1);k.resetToVertex(r,-1);q=h.nextSegment();r=k.nextSegment();let t=0;if(xd(q,r)){if(r.isIntersecting(q,c)){f=!0;break}}else t=r.intersect(q,null,n,m,c);if(2===t){f=m[0];r=m[1];q=q.calculateLength2D();if(g&&(r-f)*q>c)return!1;f=!0}else if(t){f=m[0];q=n[0];if(0<f&&1>f&&0<q&&1>q)return!1;f=!0}}if(!f)return!1;h=D.constructEmpty();k=D.constructEmpty();g=D.constructEmpty();a.queryEnvelope(h);b.queryEnvelope(k);h.inflateCoords(1E3*c,1E3*c);k.inflateCoords(1E3*c,1E3*
c);g.setCoords({env2D:h});g.intersect(k);return 10<a.getPointCount()&&(a=ra(a,g,c,0,d),a.isEmpty())||10<b.getPointCount()&&(b=ra(b,g,c,0,d),b.isEmpty())?!1:Ib(a,b,c,"F********",d,!1)}function Oj(a,b,c,d){var e=a.getImpl(),f=b.getImpl(),g=[0],h=3<=e.getIsSimple(0,g)&&3<=f.getIsSimple(0,g),k=D.constructEmpty();const m=D.constructEmpty();g=D.constructEmpty();a.queryEnvelope(k);b.queryEnvelope(m);let n=!1;const q=ke(k,m,c),r=ke(m,k,c);var t=e.querySegmentIterator();const u=f.querySegmentIterator(),v=
l.makePrimitiveArray(2,Number.NaN),w=l.makePrimitiveArray(2,Number.NaN);for(e=new vb(e,f,c);e.next();){f=e.getRedElement();var x=e.getBlueElement();t.resetToVertex(f,-1);u.resetToVertex(x,-1);f=t.nextSegment();x=u.nextSegment();var y=0;if(xd(f,x)){if(x.isIntersecting(f,c))break}else y=x.intersect(f,null,w,v,c);if(2===y){if(x=v[0],y=v[1],f=f.calculateLength2D(),h&&(y-x)*f>c&&(n=!0,q&&r))return!0}else if(y&&(f=v[0],x=w[0],0<f&&1>f&&0<x&&1>x))return!0}h=D.constructEmpty();t=D.constructEmpty();h.setCoords({env2D:k});
h.inflateCoords(1E3*c,1E3*c);t.setCoords({env2D:m});t.inflateCoords(1E3*c,1E3*c);g.setCoords({env2D:h});g.intersect(t);k="";k=n?k+"**":k+"T*";if(q){if(10<b.getPointCount()&&(b=ra(b,g,c,0,d),b.isEmpty()))return!1;k+="****"}else k+="T***";if(r){if(10<a.getPointCount()&&(a=ra(a,g,c,0,d),a.isEmpty()))return!1;k+="***"}else k+="T**";return Ib(a,b,c,k,d,!1)}function gk(a,b,c,d){var e=[!1],f=Pj(a,b,c,e);if(e[0])return f;e=D.constructEmpty();b.queryEnvelope(e);e.inflateCoords(1E3*c,1E3*c);if(10<a.getPointCount()&&
(a=ra(a,e,c,0,d),a.isEmpty()))return!1;a:{var g=a;a=new $b;a.resetMatrix_();a.setPredicates_("T*****F**");a.setAreaAreaPredicates_();e=D.constructEmpty();f=D.constructEmpty();g.queryEnvelope(e);b.queryEnvelope(f);var h=!1;lc(e,f,c)&&(a.areaAreaDisjointPredicates_(g,b),h=!0);h||pa(g,b);if(h)d=nb(a.m_matrix,a.m_scl);else{e=new Fa;f=e.addGeometry(g);h=e.addGeometry(b);var k=null,m=0;if(g.hasNonLinearSegments()||b.hasNonLinearSegments())k=new wb,b=e.getEnvelope2D(d),b=xb(c,b),m=3*b,Jb(e,b,c,k,null,d);
ac(e,(new jb(c,0)).add(m),d,!1,!1);c=e.getGeometry(h).getBoundary();e.filterClosePoints(0,!0,!0,!1,-1);tc(e,f,-1,!1,-1,d);if(0===e.getPointCount(f))d=!1;else{tc(e,h,-1,!1,-1,d);a.setEditShape_(e,d);b=0===e.getPointCount(h);if(!b&&(a.computeMatrixTopoGraphHalfEdges_(f,h),a.m_topoGraph.removeShape(),h=nb(a.m_matrix,a.m_scl),!h)){d=h;break a}f=e.getGeometry(f);e=new Fa;f=e.addGeometry(f);h=e.addGeometry(c);a.setEditShape_(e,d);a.m_predicateCount=0;a.resetMatrix_();a.setPredicates_(b?"T*****F**":"******F**");
a.setAreaLinePredicates_();a.computeMatrixTopoGraphHalfEdges_(f,h);a.m_topoGraph.removeShape();d=nb(a.m_matrix,a.m_scl)}}}return d}function Qj(a,b,c,d){var e=a.getImpl(),f=b.getImpl(),g=e.querySegmentIterator(),h=f.querySegmentIterator(),k=l.makePrimitiveArray(2,Number.NaN);const m=l.makePrimitiveArray(2,Number.NaN);e=new vb(e,f,c);for(f=!1;e.next();){var n=e.getRedElement(),q=e.getBlueElement();g.resetToVertex(n,-1);h.resetToVertex(q,-1);n=g.nextSegment();q=h.nextSegment();let r=0;xd(n,q)?!f&&q.isIntersecting(n,
c)&&(f=!0):r=q.intersect(n,null,m,k,c);if(2===r)f=!0;else if(r){f=k[0];n=m[0];if(0<f&&1>f&&0<n&&1>n)return!1;f=!0}}if(!f)return!1;h=D.constructEmpty();k=D.constructEmpty();g=D.constructEmpty();a.queryEnvelope(h);b.queryEnvelope(k);h.inflateCoords(1E3*c,1E3*c);k.inflateCoords(1E3*c,1E3*c);g.setCoords({env2D:h});g.intersect(k);return 10<a.getPointCount()&&(a=ra(a,g,c,0,d),a.isEmpty())||10<b.getPointCount()&&(b=ra(b,g,c,0,d),b.isEmpty())?!1:Ib(a,b,c,"F********",d,!1)}function Lm(a,b,c,d){var e=a.getImpl(),
f=b.getImpl(),g=e.querySegmentIterator(),h=f.querySegmentIterator(),k=l.makePrimitiveArray(2,Number.NaN),m=l.makePrimitiveArray(2,Number.NaN);e=new vb(e,f,c);for(f=!1;e.next();){var n=e.getRedElement(),q=e.getBlueElement();g.resetToVertex(n,-1);h.resetToVertex(q,-1);n=g.nextSegment();q=h.nextSegment();let r=0;xd(n,q)?!f&&q.isIntersecting(n,c)&&(f=!0):r=q.intersect(n,null,m,k,c);if(2===r)f=!0;else if(r){f=k[0];n=m[0];if(0<f&&1>f&&0<n&&1>n)return!0;f=!0}}if(!f)return!1;h=D.constructEmpty();k=D.constructEmpty();
m=D.constructEmpty();e=D.constructEmpty();g=D.constructEmpty();a.queryEnvelope(h);b.queryEnvelope(k);return ke(k,h,c)?(m.setCoords({env2D:h}),m.inflateCoords(1E3*c,1E3*c),e.setCoords({env2D:k}),e.inflateCoords(1E3*c,1E3*c),g.setCoords({env2D:m}),g.intersect(e),10<a.getPointCount()&&(a=ra(a,g,c,0,d),a.isEmpty())||10<b.getPointCount()&&(b=ra(b,g,c,0,d),b.isEmpty())?!1:Ib(a,b,c,"T********",d,!1)):Ib(a,b,c,"T*****T**",d,!1)}function Og(a,b,c,d){d=new l.Point2D;c*=c;for(let e=0;e<a.getPointCount();e++)if(a.queryXY(e,
d),l.Point2D.sqrDistance(d,b)<=c)return!1;return!0}function bk(a,b,c){a=a.getBoundary();return a.isEmpty()?!1:!Og(a,b,c)}function xd(a,b){return a.getGeometryType()!==p.GeometryType.enumLine||b.getGeometryType()!==p.GeometryType.enumLine}function Rj(a,b,c){a=b.isEmpty()?0:Ye(a,b.getXY(),c);return a?1===a?1:2:0}function ob(a,b,c){return(a=Ye(a,b,c))?1===a?1:2:0}function Pg(a,b,c,d,e){if(a.getGeometryType()===p.GeometryType.enumPolygon)for(var f=0;f<c;f++)e[f]=ob(a,b[f],d);else if(a.getGeometryType()===
p.GeometryType.enumEnvelope)if(f=D.constructEmpty(),a.queryEnvelope(f),f.isEmpty())for(b=0;b<c;b++)e[b]=0;else for(a=f.clone(),a.inflateCoords(.5*-d,.5*-d),f=f.clone(),f.inflateCoords(.5*d,.5*d),d=0;d<c;d++)a.contains(b[d])?e[d]=1:f.contains(b[d])?e[d]=2:e[d]=0;else p.throwInvalidCallException("")}function hk(a,b,c,d,e){var f=a.getGeometryType();if(f===p.GeometryType.enumPolyline)a:{var g=a.getImpl(),h=g.getAccelerators();f=null;h&&(f=h.getRasterizedGeometry());a=c;for(var k=0;k<c;k++)e[k]=1,f&&p.geometryReleaseAssert(0);
if(a){if(h&&(f=null,null!==h&&null!==h.getQuadTree()&&(f=h.getQuadTree()),h=g.getPointCount(),null===f&&20<h&&h*c>4*h+Math.log(h)*c&&(f=fd(g)),f)){h=null;g=g.querySegmentIterator();k=new D;for(let m=0;m<c&&a;m++)if(1===e[m]){k.setCoords(b[m]);null===h?h=f.getIterator(k,d):h.resetIterator(k,d);let n=-1;for(let q=h.next();-1!==q;q=h.next())if(g.resetToVertex(f.getElement(q),n),n=g.getPathIndex(),g.nextSegment().isIntersectingPoint(b[m],d)){e[m]=2;a--;break}else e[m]=0}break a}for(f=g.querySegmentIterator();f.nextPath()&&
a;)for(;f.hasNextSegment()&&a;)for(h=f.nextSegment(),g=0;g<c&&a;g++)1===e[g]&&h.isIntersectingPoint(b[g],d)&&(e[g]=2,a--)}for(b=0;b<c;b++)1===e[b]&&(e[b]=0)}else p.isSegment(f)?p.geometryReleaseAssert(0):p.throwInvalidCallException("")}function Pm(){return Number.isNaN(this.radius.value())}function le(a,b,c,d){return{pt:a.clone(),t:b,err:c,checkCount:d}}function Jb(a,b,c,d,e,f){a.hasCurves()?(a.setCurveStitcherPointer(d),d.m_impl=new Sc(f,!1,null),d.m_impl.buildMonotonicCurveParentage(a,b,c,e)):d.m_impl=
null}function ik(a,b,c,d,e,f,g,h){a.hasCurves()?(a.setCurveStitcherPointer(f),f.m_impl=new Sc(h,!0,e),f.m_impl.buildMonotonicCurveParentage(a,b,c,g),Qg.fixCurveTwoPointLoops(a,c,h)):f.m_impl=null}function xb(a,b){b||=D.constructEmpty();b=b.isEmpty()?a:Ma(null,b,!0).total();b>a&&(b=a);return.125*b}function bc(a,b){return.125*a}function ac(a,b,c,d,e){return(new Qg(a,c,b,d,e)).do_()}function Qm(a,b,c=1,d=1,e=1,f=1){if(d>f)return a;if(f>d)return b;const g=new Y;var h=g;a.equals(b);d>f?h.assignCopy(a):
f>d?h=b:(h.assignCopy(a),a=nj(a.getXY(),b.getXY(),c,d,e,f),h.setXY(a.pt));return g}function Rg(a,b){return{otherPt:a,seg:b,vert:-1,dir:0}}function Rm(a,b){p.geometryReleaseAssert(a.otherPt.equals(b.otherPt));if(null===a.seg)return null===b.seg;if(null===b.seg)return!1;var c=a.seg.getGeometryType(),d=b.seg.getGeometryType();if(c!==d)return!1;if(c===p.GeometryType.enumBezier){var e=a.seg;d=b.seg;c=e.getControlPoint1();e=e.getControlPoint2();-1===a.dir&&(e=l.swap(c,c=e));a=d.getControlPoint1();d=d.getControlPoint2();
-1===b.dir&&(d=l.swap(a,a=d));return c.equals(a)&&e.equals(d)}if(c===p.GeometryType.enumRationalBezier2){d=a.seg;c=b.seg;e=d.getControlPoint1();const f=c.getControlPoint1();if(!e.equals(f))return!1;e=[0,0,0];d.queryWeights(e);-1===a.dir&&(e[2]=l.swap(e[0],e[0]=e[2]));a=[0,0,0];c.queryWeights(a);-1===b.dir&&(a[2]=l.swap(a[0],a[0]=a[2]));return e[0]===a[0]&&e[1]===a[1]&&e[2]===a[2]}p.throwInternalErrorException("")}function yd(){return{unsplitBehavior:0,allCrossRoadsImpassable:!1,ogcRule:!1}}function Sg(a,
b,c,d,e,f,g){const h=new yb(e);h.m_bOGCOutput=!0;const k=a.getGeometryType()===p.GeometryType.enumPolygon&&1===a.getFillRule()&&!(3<=d);return h.planarSimplifyImpl_(a,b,k,c,d,e,f,g)}function cf(a,b,c,d,e,f,g,h){return(new yb(f)).planarSimplifyImpl_(a,b,c,d,e,f,g,h)}function Tg(a,b,c,d,e,f=!1){0===b&&p.throwInvalidArgumentException("not enough geometries to dissolve");let g=0;for(let m=0,n=b;m<n;m++)g=Math.max(a[m].getDimension(),g);if(2===g||1===g)return(new yb(d)).dissolveMultiPaths_(g,!1,a,b,c,
e,f);e=0;var h=-1;for(let m=0,n=b;m<n;m++)a[m].getDimension()===g&&(-1===h&&(h=m),a[m].isEmpty()||(h=m,e++));if(2>e)return Ta(a[h]);h=ub.constructEmpty();e=new Fa;let k=-1;for(let m=0,n=b;m<n;m++)a[m].getDimension()!==g||a[m].isEmpty()||(-1===k?k=e.addGeometry(Ta(a[m])):e.appendGeometry(k,Ta(a[m])),b=ub.constructEmpty(),a[m].queryLooseEnvelope(b),h.mergeEnv3D(b));a=Ma(c,h.getEnvelope2D(),!0);d=new yb(d);if(f)return c=Md(c,h.getEnvelopeZs(),!0),d.planarSimplify3DImpl_(e,a,c,0,!0);d.m_bOGCOutput=!0;
return d.planarSimplifyMultiPoints(e,a,!1,-1)}function Sm(a,b,c,d,e,f=!1){2>b&&p.throwInvalidArgumentException("not enough geometries to dissolve");let g=0;for(let q=0,r=b;q<r;q++)g=Math.max(a[q].getDimension(),g);if(2===g||1===g)return(new yb(d)).dissolveMultiPaths_(g,!0,a,b,c,e,f);const h=ub.constructEmpty();e=new Fa;let k=-1,m=0,n=-1;for(let q=0,r=b;q<r;q++)a[q].getDimension()===g&&(-1===n&&(n=q),a[q].isEmpty()||(n=q,-1===k?k=e.addGeometry(Ta(a[q])):e.appendGeometry(k,Ta(a[q])),b=ub.constructEmpty(),
a[q].queryLooseEnvelope(b),h.mergeEnv3D(b),m++));if(2>m)return Ta(a[n]);c=0===g?c:null;a=Ma(c,h.getEnvelope2D(),!0);d=new yb(d);return f?(f=Md(c,h.getEnvelopeZs(),!0),d.m_bOGCOutput=!0,d.planarSimplify3DImpl_(e,a,f,0,!0)):d.planarSimplifyMultiPoints(e,a,!0,-1)}function jk(a,b,c,d){if(a.isEmpty())return a.createInstance();if(b.isEmpty())return d?a.createInstance():new Y({copy:a});const e=[new l.Point2D],f=[0],g=2===b.getDimension();1!==b.getDimension()&&2!==b.getDimension()&&p.throwInternalErrorException("");
e[0]=a.getXY();g?Pg(b,e,1,c.total(),f):hk(b,e,1,c.total(),f);b=0===f[0];d||(b=!b);return b?a.createInstance():a}function kk(a,b,c,d){d=a.createInstance();const e=l.makeObjectArray(l.Point2D,100),f=Array(100),g=a.getPointCount();let h=!0;const k=2===b.getDimension();1!==b.getDimension()&&2!==b.getDimension()&&p.throwInternalErrorException("");for(let m=0;m<g;){const n=a.queryCoordinates(e,e.length,m,-1)-m;k?Pg(b,e,n,c.total(),f):hk(b,e,n,c.total(),f);let q=0;for(let r=0;r<n;r++)0===f[r]&&(h&&(h=!1,
d.addPoints(a,0,m)),q!==r&&d.addPoints(a,m+q,m+r),q=r+1);h||q===n||d.addPoints(a,m+q,m+n);m+=n}return h?a:d}function Kb(a,b,c,d){c=a.getGeometryType();return c===p.GeometryType.enumEnvelope?(b=new ba({vd:a.getDescription()}),a.isEmpty()||b.addEnvelope(a,!1),b):c!==p.GeometryType.enumPoint||"|"!==d&&"^"!==d?c===p.GeometryType.enumLine?(b=new ma({vd:a.getDescription()}),a.isEmpty()||b.addSegment(a,!0),b):c===p.GeometryType.enumMultiPoint&&"-"===d&&b.getGeometryType()===p.GeometryType.enumPoint||c===
p.GeometryType.enumMultiPoint&&"\x26"===d&&b.getGeometryType()===p.GeometryType.enumPoint?(b=new Y({vd:a.getDescription()}),a.isEmpty()||a.getPointByVal(0,b),b):a:(b=new Oa({vd:a.getDescription()}),a.isEmpty()||b.add(a),b)}function Ta(a){var b=a.getGeometryType();if(b===p.GeometryType.enumEnvelope)return b=new ba({vd:a.getDescription()}),a.isEmpty()||b.addEnvelope(a,!1),b;if(b===p.GeometryType.enumPoint)return b=new Oa({vd:a.getDescription()}),a.isEmpty()||b.add(a),b;if(Tm(b))return b=new ma({vd:a.getDescription()}),
a.isEmpty()||b.addSegment(a,!0),b;b!==p.GeometryType.enumMultiPoint&&b!==p.GeometryType.enumPolyline&&b!==p.GeometryType.enumPolygon&&p.throwInvalidArgumentException("Unexpected geometry type");return a}function Ug(a,b,c,d){let e=c=-1===c?a.getClusterHalfEdge(b):c;p.geometryReleaseAssert(a.getHalfEdgeOrigin(c)===b);do d(e),e=a.getHalfEdgeNext(a.getHalfEdgeTwin(e));while(e!==c)}function Um(a,b,c,d,e){d&&(d.m_reason=0,d.m_vertexIndex1=-1,d.m_vertexIndex2=-1);if(a.isEmpty())return 5;const f=a.getGeometryType();
if(f===p.GeometryType.enumPoint)return me(a,d);var g=ib(b,a,!1).total();if(f===p.GeometryType.enumEnvelope)return b=new D,a.queryEnvelope(b),b.isDegenerate(g)?(d&&(d.m_reason=4,d.m_vertexIndex1=-1,d.m_vertexIndex2=-1),0):5;if(p.isSegment(f))return g=new ma({vd:a.getDescription()}),g.addSegment(a,!0),Vg(g,b,c,d,e);const h=a.getImpl().getIsSimple(g,[0]);c=c?-1:h;if(4<=c||0===c)return c;b=new cc(a,b,c,e,!1);f===p.GeometryType.enumMultiPoint||f===p.GeometryType.enumPolyline||f===p.GeometryType.enumPolygon?
c=b.isSimplePlanarImpl():p.throwInternalErrorException("");a.getImpl().setIsSimple(c,g);d&&d.assign(b.m_nonSimpleResult);return c}function lk(a,b,c,d,e){d&&(d.m_reason=0,d.m_vertexIndex1=-1,d.m_vertexIndex2=-1);if(a.isEmpty())return 5;const f=a.getGeometryType();if(f===p.GeometryType.enumPoint)return me(a,d);var g=ib(b,a,!1).total();if(f===p.GeometryType.enumEnvelope)return b=new D,a.queryEnvelope(b),b.isDegenerate(g)?(d&&(d.m_reason=4,d.m_vertexIndex1=-1,d.m_vertexIndex2=-1),0):5;if(p.isSegment(f))return g=
new ma({vd:a.getDescription()}),g.addSegment(a,!0),lk(g,b,c,d,e);p.throwIfGeometryCollectionType(f);p.isMultiVertex(f)||p.throwNotImplementedException("OGC simplify is not implemented for this geometry type");const h=a.getImpl().getIsSimple(g,[0]);c=c?-1:h;if(5===c||0===c)return c;b=new cc(a,b,c,e,!0);f===p.GeometryType.enumMultiPoint||f===p.GeometryType.enumPolyline||f===p.GeometryType.enumPolygon?(c=b.isSimplePlanarImpl(),4<=c&&(c=5)):p.throwInternalErrorException("");a.getImpl().setIsSimple(c,
g);d&&d.assign(b.m_nonSimpleResult);return c}function Vg(a,b,c,d,e){d&&(d.m_reason=0,d.m_vertexIndex1=-1,d.m_vertexIndex2=-1);if(a.isEmpty())return 5;const f=a.getGeometryType();if(f===p.GeometryType.enumPoint)return me(a,d);var g=ib(b,a,!1).total();if(f===p.GeometryType.enumEnvelope)return b=D.constructEmpty(),a.queryEnvelope(b),b.isDegenerate(g)?(d&&(d.m_reason=4,d.m_vertexIndex1=-1,d.m_vertexIndex2=-1),0):5;if(p.isSegment(f))return g=new ma({vd:a.getDescription()}),g.addSegment(a,!0),Vg(g,b,c,
d,e);const h=a.getImpl().getIsSimple(g,[0]);c=c?-1:h;if(-1!==c)return c;b=new cc(a,b,c,e,!1);f===p.GeometryType.enumMultiPoint?c=b.multipointIsSimpleAsFeature():f===p.GeometryType.enumPolyline?c=b.polylineIsSimpleAsFeature():f===p.GeometryType.enumPolygon?c=b.polygonIsSimpleAsFeature():p.throwInternalErrorException("");a.getImpl().setIsSimple(c,g);d&&d.assign(b.m_nonSimpleResult);return c}function mk(a,b,c,d){if(a.isEmpty())return a;var e=a.getGeometryType();if(e===p.GeometryType.enumPoint)return b=
new va,me(a,b),3===b.m_reason?(a=a.clone(),a.replaceNaNs(1,0),a):2===b.m_reason?a.createInstance():a;if(e===p.GeometryType.enumEnvelope)return b=ib(b,a,!0).total(),d=D.constructEmpty(),a.queryEnvelope(d),d.isDegenerate(b)?a.createInstance():a;if(p.isSegment(e))return e=new ma({vd:a.getDescription()}),e.addSegment(a,!0),mk(e,b,c,d);p.throwIfGeometryCollectionType(e);var f=ib(b,a,!1).total();f=a.getImpl().getIsSimple(f,[0]);c=c?-1:f;if(4<=c)return e===p.GeometryType.enumPolygon&&0!==a.getFillRule()?
(a=a.clone(),a.setFillRule(0),a):a;if((e===p.GeometryType.enumMultiPoint||e===p.GeometryType.enumPolyline)&&1<=c)return a;a=new cc(a,b,c,d,!1);let g;e===p.GeometryType.enumMultiPoint?g=a.multipointSimplifyAsFeature():e===p.GeometryType.enumPolyline?g=a.polylineSimplifyAsFeature():e===p.GeometryType.enumPolygon?g=a.polygonSimplifyAsFeature():p.throwInternalErrorException("");return g}function nk(a,b,c,d){if(a.isEmpty())return a;var e=a.getGeometryType();if(e===p.GeometryType.enumPoint)return b=new va,
me(a,b),3===b.m_reason?(a=a.clone(),a.replaceNaNs(1,0),a):2===b.m_reason?a.createInstance():a;if(e===p.GeometryType.enumEnvelope)return d=new D,a.queryEnvelope(d),b=ib(b,a,!0).total(),d.isDegenerate(b)?a.createInstance():a;if(p.isSegment(e))return e=new ma({vd:a.getDescription()}),e.addSegment(a,!0),nk(e,b,c,d);p.throwIfGeometryCollectionType(e);p.isMultiVertex(e)||p.throwNotImplementedException("OGC simplify is not implemented for this geometry type");var f=ib(b,a,!1).total();f=a.getImpl().getIsSimple(f,
[0]);c=c?-1:f;if(5===c)return e===p.GeometryType.enumPolygon&&0!==a.getFillRule()?(a=a.clone(),a.setFillRule(0),a):a;b=ib(b,a,!0);return Sg(a,b,!1,c,d,0,!0)}function me(a,b){const c=a.getX(),d=a.getY();return Number.isFinite(c)&&Number.isFinite(d)?a.hasAttribute(1)&&(a=a.getZ(),!Number.isFinite(a))?(b&&(b.m_reason=Number.isNaN(a)?3:2,b.m_vertexIndex1=-1,b.m_vertexIndex2=-1),0):5:(b&&(b.m_reason=2,b.m_vertexIndex1=-1,b.m_vertexIndex2=-1),0)}function Vm(a,b,c,d,e){a.m_projector.transformInPlaceZ(b,
null,c,d,null,e);a=d.slice(0,c).filter(f=>!f.isNAN());for(let f=0,g=a.length;f<g;++f)d[f].assign(a[f]);return a.length}function Wg(a,b,c,d,e){return a.m_projector.transformInPlaceZ(b,null,c,d,null,e)}function Xg(a,b,c,d){a&&b&&b.isPannable()||p.throwInvalidArgumentException("fold_into_360_range_geodetic");if(a.isEmpty())return a;if(4===c)return df(a,b,d);var e=a,f=e.getGeometryType();if(p.isMultiPath(f)){e=zd(a,b);a=new D;e.queryEnvelope(a);f=Ma(b,a,!1).total();const g=b.getPannableExtent();let h=
Math.floor((a.xmin-g.xmin)/g.width())*g.width()+g.xmin;for(;h<a.xmax;)h>a.xmin+f&&h<a.xmax-f&&(e=ok(e,b,c,!0,h)),h+=g.width()}else{if(f===p.GeometryType.enumEnvelope)return a=new ba({vd:e.getDescription()}),a.addEnvelope(e,!1),Xg(a,b,c,d);if(p.isSegment(f))return a=new ma({vd:e.getDescription()}),a.addSegment(e,!0),Xg(a,b,c,d)}return df(e,b,d)}function df(a,b,c){a&&b&&b.isPannable()||p.throwInvalidArgumentException("");if(a.isEmpty())return a;var d=a.getGeometryType();d===p.GeometryType.enumEnvelope?
(d=new ba({vd:a.getDescription()}),d.addEnvelope(a,!1)):p.isSegment(d)?(d=new ma({vd:a.getDescription()}),d.addSegment(a,!0)):d=a;d=zd(d,b);return d.isEmpty()?d:Ad(d,b,0,d!==a,0,c)}function Wm(a,b,c){if(!b.isPannable()||a.isEmpty())return a;b=b.getPannableExtent().width();var d=.5*b,e=a.queryInterval(0,0);if(e.width()<d||!p.isMultiVertex(a.getGeometryType())){if(Number.isNaN(c))return a;e=e.getCenter();if(Math.abs(e-c)<=d)return a;d=new l.Transformation2D;c=l.round((c-e)/b)*b;d.setShiftCoords(c,0);
a=a.clone();a.applyTransformation(d);return a}e=a.getGeometryType();const f=a.getAttributeStreamRef(0),g=a.clone(),h=g.getAttributeStreamRef(0);let k=0,m=0;var n=0;let q=p.isMultiPath(e)?0:-1;const r=l.Envelope1D.constructEmpty();let t=!1;for(let u=0,v=a.getPointCount();u<v;u++){const w=f.read(2*u);u===m&&(p.isMultiPath(e)?(0===q&&Number.isNaN(c)&&(t=!0),0<q&&Number.isNaN(c)&&(c=r.getCenter(),t=!1),m=a.getPathEnd(q),q++):m=a.getPointCount(),Number.isNaN(c)?n=w:(n=c,k=0));n=w-n;Math.abs(n)>d&&(n=l.round(n/
b)*b,k-=n,Math.abs(k)<.1*b&&(k=0));n=w+k;h.write(2*u,n);t&&r.mergeCoordinate(n);n=w}g.notifyModified();return g}function Xm(a,b,c,d){var e=b.getCoordinateSystemType();if(0===e)return d=new zb,b.queryPrecisionDescriptor(d),pk(a,d,b,c);2!==d&&3!==d||!b.isPannable()||(a=df(a,b,c));var f=new zb;b.queryPrecisionDescriptor(f);a=pk(a,f,b,c);if(0===d||a.isEmpty())return a;if(1===e)return 1===d?(d=new D,a.queryLooseEnvelope(d),e=b.getPannableExtent(),f=.01*e.width(),e.xmin=d.xmin-f,e.xmax=d.xmax+f,(new Tc).execute(a,
e,b,c)):a;if(2===e)return e=b.getPCSHorizon(),1===d||2===d?(b=(new Uc).execute(a,e,b,c),b===e?b.clone():b):a;if(3===e)return a;p.throwInternalErrorException("missing implementation")}function pk(a,b,c,d){const e=b.getXYGridRange();var f=a.hasAttribute(1),g=a.hasAttribute(2);let h=new l.Envelope1D,k=new l.Envelope1D;f&&(h=b.getZGridRange());g&&(k=b.getMGridRange());b=(new Tc).execute(a,e,c,d);f&&(f=b.queryInterval(1,0),h.contains(f)||(a===b&&(b=b.clone()),Sf(b,h,1,0)));g&&(g=b.queryInterval(2,0),k.contains(g)||
(a===b&&(b=b.clone()),Sf(b,k,2,0)));return b}function ef(a){if(2!==a.getCoordinateSystemType())return 0;let b=0;var c=a.getPCSInfo();a=c.getNorthPoleLocation();const d=c.getSouthPoleLocation(),e=c.getNorthPoleGeometry();c=c.getSouthPoleGeometry();e===Xa.PE_POLE_POINT&&a!==Xa.PE_POLE_OUTSIDE_BOUNDARY&&(b=1);c===Xa.PE_POLE_POINT&&d!==Xa.PE_POLE_OUTSIDE_BOUNDARY&&(b|=2);return b}function Yg(a,b,c,d,e,f,g=!1){a||p.throwInvalidArgumentException("Geometry.Geodetic_densify.densify");var h=a.getGeometryType();
p.throwIfMesh(a);p.throwIfCurves(a);if(a.isEmpty()||p.isPoint(h))return a;var k=new Ym;k.m_sr=b;k.m_gcs=b.getGCS();k.m_transform=k.m_gcs!==b?b.getSRToGCSTransform():null;k.m_progressTracker=f;const m=Bd();k.m_gcs.querySpheroidData(m);k.m_a=m.majorSemiAxis;k.m_eSquared=m.e2;k.m_rpu=k.m_gcs.getUnit().getUnitToBaseFactor();k.m_gcsTolerance=k.m_gcs.getTolerance(0);k.m_radTolerance=k.m_gcsTolerance*k.m_rpu;k.m_maxLength=d;k.m_maxDeviation=e;k.m_curveType=c;h===p.GeometryType.enumEnvelope?(h=new ba({vd:a.getDescription()}),
h.addEnvelope(a,!1),a=h,h=p.GeometryType.enumPolygon):p.isSegment(h)&&(h=new ma({vd:a.getDescription()}),h.addSegment(a,!0),a=h,h=p.GeometryType.enumPolyline);if(4!==k.m_curveType){b=k.m_transform&&!k.m_transform.isIdentity()?(new xc).execute(a,k.m_transform,f):zd(a,k.m_gcs);if(b.isEmpty())return b;b=qk(k.m_rpu,b);b=k.geodeticDensify(b);g||(b=(new xc).foldInto360RangeGeodetic(b,k.m_gcs,k.m_curveType));k=k.m_transform&&!k.m_transform.isIdentity()?(new xc).execute(b,k.m_transform.getInverse(),f):b}else{b.isPannable()?
f=zd(a,b):(g=b.getPCSHorizon(),f=(new Uc).execute(a,g,b,f),f===g&&(f=g.clone()));b=f;if(b.isEmpty())return b;k=k.shapePreservingDensify(b)}return k}function qk(a,b){var c=new D;b.queryLooseEnvelope(c);if(c.width()*a<Math.PI)return b;var d=!1;c=b.querySegmentIterator();const e=new l.Point2D,f=new l.Point2D;for(;c.nextPath();)for(;c.hasNextSegment();){var g=c.nextSegment();e.setCoordsPoint2D(g.getStartXY());f.setCoordsPoint2D(g.getEndXY());e.scale(a);f.scale(a);if(Math.abs(e.x-f.x)>Math.PI)if(!Zg(e,
f)){d=!0;break}else if(Math.abs(e.x-f.x)>2*Math.PI){d=!0;break}}if(!d)return b;d=b.createInstance();d.reserve(b.getPointCount());b=1<b.getDescription().getAttributeCount();g=new l.Point2D;const h=new l.Point2D,k=new l.Point2D(0,0),m=new l.Point2D(0,0),n=new Y;for(c.resetToFirstPath();c.nextPath();){let r=Number.NaN,t=0;for(;c.hasNextSegment();){const u=c.nextSegment();e.setCoordsPoint2D(u.getStartXY());f.setCoordsPoint2D(u.getEndXY());e.scale(a);f.scale(a);Number.isNaN(r)?(t=Vc(e.x,Number.NaN,t),
k.setCoordsPoint2D(e)):k.setCoordsPoint2D(m);r=k.x;if(Zg(e,f)){if(f.x-e.x>2*Math.PI)for(;f.x-e.x>2*Math.PI;)f.x-=2*Math.PI;else if(f.x-e.x<2*-Math.PI)for(;f.x-e.x<2*-Math.PI;)f.x+=2*Math.PI;t=Vc(f.x,Number.NaN,t);m.setCoordsPoint2D(f)}else{g.setCoordsPoint2D(f);var q=g;if(q.x<-Math.PI)for(;q.x<-Math.PI;)q.x+=2*Math.PI;else if(q.x>Math.PI)for(;q.x>Math.PI;)q.x-=2*Math.PI;t=Vc(g.x,r,t);m.setCoords(t+g.x,g.y)}.5>Math.abs(m.x-f.x)&&m.setCoordsPoint2D(f);b?(u.queryCoord(0,n),h.setCoordsPoint2D(k),h.scale(1/
a),n.setXY(h),c.isFirstSegmentInPath()?d.startPathPoint(n):d.lineToPoint(n),c.isLastSegmentInPath()&&!c.isPathClosed()&&(u.queryCoord(1,n),h.setCoordsPoint2D(m),h.scale(1/a),n.setXY(h),d.lineToPoint(n))):(c.isFirstSegmentInPath()&&d.insertPath2D(-1,null,0,0,!0),q=d.getPathCount()-1,h.setCoordsPoint2D(k),h.scale(1/a),d.insertPoint2D(q,-1,h),c.isLastSegmentInPath()&&!c.isPathClosed()&&(h.setCoordsPoint2D(m),h.scale(1/a),d.insertPoint2D(q,-1,h)))}}return d}function Zg(a,b){return sa(a.y,l.geometryHalfPi)&&
sa(b.y,l.geometryHalfPi)||sa(a.y,-l.geometryHalfPi)&&sa(b.y,-l.geometryHalfPi)?!0:!1}function rk(a,b){return sa(a.y,l.geometryHalfPi)&&!sa(b.y,l.geometryHalfPi)||sa(a.y,-l.geometryHalfPi)&&!sa(b.y,-l.geometryHalfPi)?!0:!1}function sk(a,b){return sa(b.y,l.geometryHalfPi)&&!sa(a.y,l.geometryHalfPi)||sa(b.y,-l.geometryHalfPi)&&!sa(a.y,-l.geometryHalfPi)?!0:!1}function tk(a,b,c,d){a&&d.insertPath2D(-1,null,0,0,!0);a=d.getPathCount()-1;d.insertPointsFromPoints(a,-1,c,0,c.length-1,!0);b&&d.insertPoint2D(a,
-1,c.at(-1))}function uk(a,b,c,d,e,f,g){g.reserve(g.getPointCount()+f.length-1);const h=new Y;c.queryStart(h);a?g.startPathPoint(h):g.lineToPoint(h);if(2<f.length){a=d.calculateLength2D();for(let k=1;k<f.length-1;k++){const m=d.lengthToT(e[k]*a);d.queryCoord(m,h);h.setXY(f[k]);g.lineToPoint(h)}}b&&(c.queryEnd(h),g.lineToPoint(h))}function vk(a,b,c,d,e,f,g,h,k,m,n,q,r){const t={stack:[],error:void 0,hasError:!1};try{var u=Ka.__addDisposableResource(t,new F.PeDoubleClass,!1);const w=Ka.__addDisposableResource(t,
new F.PeDoubleClass,!1),x=Ka.__addDisposableResource(t,new F.PeDoubleClass,!1);F.peLineType.geodeticDistance(a,b,d.x,d.y,e.x,e.y,x,u,w,c);const y=x.val,z=u.val;u=z;let A=w.val;0>u&&(u+=2*Math.PI);0>A&&(A+=2*Math.PI);k&&(k[0]=u);m&&(m[0]=A);let C=Number.NaN,B=Number.NaN;if(null!==n){const P=F.peMath.q90(a,b),ia=F.peMath.q(a,b,d.y);C=(P-ia)/y;B=(P+ia)/y}const E=rk(d,e),G=sk(d,e);k=E||G;var v=!(Math.abs(Math.abs(d.x-e.x)-Math.PI)<=h)||sa(d.y,l.geometryHalfPi)||sa(d.y,-l.geometryHalfPi)||sa(e.y,l.geometryHalfPi)||
sa(e.y,-l.geometryHalfPi)?!1:!0;const I=Ka.__addDisposableResource(t,new l.SimpleDisposableArray(new F.PeDoubleClass,new F.PeDoubleClass),!1),H=new l.Point2D,L=new l.Point2D,M=new l.Point2D;r[0]=Vc(d.x,Number.NaN,r[0]);let N=r[0];if(y<=f)return q.push(d.clone()),r[0]=Vc(e.x,Number.NaN,r[0]),null!=n&&n.push(0),k?(E&&wk(d,e,n,q),G&&xk(d,e,n,q)):v?yk(d,e,z,C,B,n,q):0<g&&(L.setCoords(d.x-N,d.y),H.setCoords(e.x-r[0],e.y),p.geometryReleaseAssert(0),N=0),q.push(e.clone()),y;const Q=1+Math.ceil(y/f);f=y/
(Q-1);const O=new l.Point2D;q.push(d.clone());O.setCoordsPoint2D(d);L.setCoords(d.x-r[0],d.y);null!==n&&n.push(0);for(m=1;m<Q;m++){let P;m<Q-1?(F.peLineType.geodeticCoordinate(a,b,d.x,d.y,m*f,z,I.at(0),I.at(1),c),H.setCoords(I.at(0).val,I.at(1).val),r[0]=Vc(H.x,O.x,r[0]),M.setCoords(r[0]+H.x,H.y),P=m/(Q-1)):(r[0]=Vc(e.x,Number.NaN,r[0]),H.setCoords(e.x-r[0],e.y),M.setCoordsPoint2D(e),P=1);k?(1===m&&E&&wk(d,M,n,q),m===Q-1&&G&&xk(O,e,n,q)):v?Math.abs(Math.abs(O.x-M.x)-Math.PI)<=h&&(d.x<e.x?O.x>M.x&&
(r[0]+=2*Math.PI,M.setCoords(r[0]+H.x,H.y)):O.x<M.x&&(r[0]-=2*Math.PI,M.setCoords(r[0]+H.x,H.y)),yk(O,M,z,C,B,n,q)):0<g&&p.geometryReleaseAssert(0);q.push(M.clone());null!=n&&n.push(P);O.setCoordsPoint2D(M);L.setCoordsPoint2D(H);N=r[0]}return y}catch(w){t.error=w,t.hasError=!0}finally{Ka.__disposeResources(t)}}function $g(a,b,c,d){c=mb(a,b,c);a=mb(a,b,d);return X.distance(c,a)}function ah(a,b,c,d){d.reverse();null!==c&&c.reverse();a&&(c=a[0],a[0]=b[0],b[0]=c)}function zk(a,b,c){if(!a)return b;c.create(b.getGeometryType());
b.copyTo(c.get());c.get().reverse();return c.get()}function Vc(a,b,c){if(Number.isNaN(b)){for(;c-a>Math.PI;)c-=2*Math.PI;for(;a-c>Math.PI;)c+=2*Math.PI;return c}c+a-b>Math.PI?c-=2*Math.PI:b-(c+a)>Math.PI&&(c+=2*Math.PI);return c}function wk(a,b,c,d){if(0<a.y){var e=new l.Point2D;e.setCoords(b.x,l.geometryHalfPi);sa(a.x,e.x)||sa(b.y,e.y)||(d.push(e),null!==c&&c.push(0))}else e=new l.Point2D,e.setCoords(b.x,-l.geometryHalfPi),sa(a.x,e.x)||sa(b.y,e.y)||(d.push(e),null!==c&&c.push(0))}function xk(a,b,
c,d){if(0<b.y){var e=new l.Point2D;e.setCoords(a.x,l.geometryHalfPi);sa(b.x,e.x)||sa(a.y,e.y)||(d.push(e),null!==c&&c.push(1))}else e=new l.Point2D,e.setCoords(a.x,-l.geometryHalfPi),sa(b.x,e.x)||sa(a.y,e.y)||(d.push(e),null!==c&&c.push(1))}function yk(a,b,c,d,e,f,g){0===c||3.552713678800501E-15>=Math.abs(c)?(0<l.geometryHalfPi-a.y&&(e=new l.Point2D,e.setCoords(a.x,l.geometryHalfPi),g.push(e),null!==f&&f.push(d)),0<l.geometryHalfPi-b.y&&(a=new l.Point2D,a.setCoords(b.x,l.geometryHalfPi),g.push(a),
null!==f&&f.push(d))):(0<l.geometryHalfPi+a.y&&(d=new l.Point2D,d.setCoords(a.x,-l.geometryHalfPi),g.push(d),null!==f&&f.push(e)),0<l.geometryHalfPi+b.y&&(a=new l.Point2D,a.setCoords(b.x,-l.geometryHalfPi),g.push(a),null!==f&&f.push(e)))}function Ak(a,b,c,d,e){var f=new D;c.queryEnvelope(f);d=ib(null,c,!0).total();if(b.xmin-f.xmin<=d&&f.xmax-b.xmax<=d)return c;d=b.width();for(var g=0;b.xmin+g*d<f.xmin;)g++;for(;b.xmin+g*d>f.xmin;)g--;g*=d;f=new l.Transformation2D;f.setShiftCoords(-g,0);c.applyTransformation(f);
g=new D;c.queryEnvelope(g);let h=null;if(g.xmax>b.xmax){let m=0;const n=new D;n.setCoords({env2D:b});--n.ymin;for(n.ymax+=1;n.xmin<g.xmax;){g.xmax>n.xmax&&(c=ok(c,a,2,!0,n.xmax));var k=Ae(c,n);k=Ma(null,k,!0).total();k=ra(c,n,k,Number.NaN,e);null===h?h=k===c?k.clone():k:(f.setShiftCoords(-m*d,0),k.applyTransformation(f),h.add(k,!1));m++;n.xmin=n.xmax;n.xmax=b.xmax+m*d}}else h=c;return h}function Bk(a,b,c,d,e,f){var g=b.getAttributeStreamRef(0),h=b.getPointCount(),k=!1,m=new l.Point2D;for(var n=0;n<
h;++n){g.queryPoint2D(2*n,m);if(f&1&&m.y>=c){k=!0;break}if(f&2&&m.y<=-c){k=!0;break}}if(!k)return!1;n=!1;a&&(n=b.getImpl().isClosedPathInXYPlane(0));a=new Fa;g=a.addGeometry(b);h=a.getFirstPath(g);var q=-1;let r=!0;const t=new l.Point2D;k=new Y;var u=-1;e=210*e/360;for(let x=a.getFirstVertex(h);-1!==x;x=a.getNextVertex(x)){a.queryXY(x,m);let y=f&1&&m.y>=c?1:0;y|=f&2&&m.y<=-c?2:0;if(0<q&&q!==y){if(t.x!==m.x){var v=a.getPrevVertex(x);a.queryPoint(v,k);v=a.insertVertex(h,x,k);t.x=m.x;a.setXY(v,t)}if(n){var w=
-1!==u?a.getNextVertex(u):a.getFirstVertex(h);for(v=a.getPrevVertex(x);w!==v;)w=a.removeVertex(w,!1);if(-1!==u){w=a.getXY(u);const z=a.getXY(v);Math.abs(w.x-z.x)>e&&(a.queryPoint(u,k),u=a.insertVertex(h,v,k),w.x=l.lerp(w.x,z.x,.5),a.setXY(u,w))}}u=-1}y&&(m.y=l.copySign(d,m.y),a.setXY(x,m),r||q===y||(m.x!==t.x?(a.queryPoint(x,k),q=a.insertVertex(h,x,k),a.setXYCoords(q,t.x,m.y),u=q):u=x));q=y;t.assign(m);r=!1}if(n){if(-1!==u)for(c=a.getNextVertex(u);-1!==c;)c=a.removeVertex(c,!1);f=a.getFirstVertex(h);
m=a.getLastVertex(h);c=a.getXY(f);d=a.getXY(m);c.equals(d)||(a.queryPoint(f,k),m=a.insertVertex(h,-1,k),Math.abs(c.x-d.x)>e&&(f=a.insertVertex(h,m,k),c.x=l.lerp(c.x,d.x,.5),a.setXY(f,c)))}b.assignCopy(a.getGeometry(g));return!0}function Zm(a,b,c,d,e){if(!b.isPannable()||a.isEmpty())return a;var f=a.getGeometryType();f===p.GeometryType.enumGeometryCollection&&p.geometryReleaseAssert(0);var g=b.getPannableExtent();Number.isNaN(c)&&(c=g.getCenterX());g=g.width();var h=.5*g,k=0<e,m=a.queryInterval(0,
0);if(!k&&m.width()<h||!p.isMultiVertex(a.getGeometryType())){var n=m.getCenter();if(Math.abs(n-c)<=h)return a;b=new l.Transformation2D;c=l.round((c-n)/g)*g;b.setShiftCoords(c,0);a=a.clone();a.applyTransformation(b);return a}if(f===p.GeometryType.enumPolygon){g=new ma({vd:a.getDescription()});g.addAndExplicitlyOpenAllPaths(a,!1);k&&(g=Yg(g,b,2,e,Number.NaN,null,!0));h=[];if(!d){n=a;k&&(n=new ba,n.add(g,!1));{k=h;e=Bd();b.querySpheroidData(e);f=b.getGCS()!==b?b.getSRToGCSTransform():null;m=l.makeObjectArray(l.Point2D,
100);const r=new X(0,0,0);var q=a.getPointCount();d=b.getGCS().getUnit().getUnitToBaseFactor();for(let t=0,u=q;t<u;){q=Math.min(100,u-t);a.queryCoordinates(m,q,t,t+q);f&&(new xc).transform(f,m,q,m,!1);for(let v=0;v<q;v++){if(m[v].isNAN())continue;m[v].scale(d);const w=mb(e.majorSemiAxis,e.e2,m[v]);r.addThis(w)}t+=q}e=sd(e.majorSemiAxis,e.e2,r);e.scale(1/d);if((new Ck(b.getGCS(),e)).project(a)){k.length=a.getPathCount();d=0>a.calculateArea2D();for(let t=0,u=a.getPathCount();t<u;t++)e=a.calculateRingArea2D(t),
k[t]=d?0>e:0<e;a=d?-1:1}else a=0}if(a)0>a&&g.reverseAllPaths();else for(a=n.getPathCount(),k=0;k<a;k++)h.push(0<n.calculateRingArea2D(k));d=h}return(new ff(null,d,g,null,b,c,3,0,null)).geoNormalizePolygonGeometry(!0)}if(f===p.GeometryType.enumPolyline)return g=new ma({vd:a.getDescription()}),g.addAndExplicitlyOpenAllPaths(a,!1),k&&(g=Yg(g,b,2,e,Number.NaN,null,!0)),(new ff(null,null,g,null,b,c,3,0,null)).geoNormalizePolylineGeometry(!0);if(f===p.GeometryType.enumMultiPoint){b=a.getAttributeStreamRef(0);
k=null;f=c;c=0;d=.1*g;for(let r=0,t=(void 0).getPointCount();r<t;r++)e=b.read(2*r),f=e-f,Math.abs(f)>h&&(f=l.round(f/g)*g,c-=f,Math.abs(c)<d&&(c=0)),0!==c&&(k||(n=a.clone(),k=n.getAttributeStreamRef(0)),k.write(2*r,e+c)),f=e;return k?(n.notifyModified(),n):a}p.throwInternalErrorException("")}function Dk(a,b,c){if(!bh(a))return!1;Nd(b,a,!1);b=0;const d=a.getGeometryType();p.isMultiPath(d)&&Fe(a)&&0!==c&&(b|=a.getImpl().buildQuadTreeAccelerator(c)?1:0);p.isMultiPath(d)&&$h(a)&&0!==c&&(b|=a.getImpl().buildQuadTreeForPathsAccelerator(c)?
1:0);return 0<b}function bh(a){return Fe(a)||$h(a)}function $m(a,b,c,d){if(a.isEmpty()||b.isEmpty())return a;const e=a.getDimension(),f=b.getDimension();if(e>f)return a;const g=a.getGeometryType(),h=b.getGeometryType(),k=new D,m=new D,n=new D;a.queryEnvelope(k);b.queryEnvelope(m);n.setCoords({env2D:k});n.mergeEnvelope2D(m);const q=Ma(c,n,!0),r=kb(q),t=new D;t.setCoords({env2D:k});t.inflateCoords(r,r);if(!t.isIntersecting(m))return a;if(1===e&&2===f){var u;const aa=new Ya;a.queryEnvelope(aa);const ca=
new D;b.queryEnvelope(ca);aa.merge(ca);const na=.1*aa.width(),la=.1*aa.height();aa.inflateCoords(na,la);const fa=new ba;fa.addEnvelope(aa,!1);const T=fa.getImpl();if(h===p.GeometryType.enumPolygon){const xa=b.getImpl();T.add(xa,!0)}else T.addEnvelope(b,!0);if(u=(new Wc(fa,c,-1,d)).tryFastImplementation(a))return u}if(g===p.GeometryType.enumPoint){let aa;p.isSegment(h)?(aa=new ma({vd:b.getDescription()}),aa.addSegment(b,!0)):aa=b;switch(h){case p.GeometryType.enumPolygon:var v=0===Rj(aa,a,q.total())?
a:a.createInstance();return v;case p.GeometryType.enumPolyline:a:{var w=aa;const ca=a.getXY(),na=w.querySegmentIterator(),la=kb(q),fa=la*la;for(;na.nextPath();)for(;na.hasNextSegment();){const T=na.nextSegment(),xa=new D;T.queryEnvelope(xa);xa.inflateCoords(la,la);if(!xa.contains(ca))continue;if(T.isIntersectingPoint(ca,q.total())){var x=a.createInstance();break a}let oa=T.getStartXY();if(l.Point2D.sqrDistance(ca,oa)<=fa){x=a.createInstance();break a}oa=T.getEndXY();if(l.Point2D.sqrDistance(ca,oa)<=
fa){x=a.createInstance();break a}}x=a}return x;case p.GeometryType.enumMultiPoint:a:{var y=aa;const ca=y.getImpl().getAttributeStreamRef(0),na=y.getPointCount(),la=a.getXY(),fa=kb(q),T=fa*fa,xa=new l.Point2D;for(let oa=0;oa<na;oa++)if(ca.queryPoint2D(2*oa,xa),l.Point2D.sqrDistance(xa,la)<=T){var z=a.createInstance();break a}z=a}return z;case p.GeometryType.enumEnvelope:{var A=aa;const ca=new D;A.queryEnvelope(ca);ca.inflate(q.total());const na=a.getXY();var C=ca.contains(na)?a.createInstance():a}return C;
case p.GeometryType.enumPoint:{var B=aa;const ca=kb(q),na=ca*ca,la=a.getXY(),fa=B.getXY();var E=l.Point2D.sqrDistance(la,fa)<=na?a.createInstance():a}return E;default:p.throwInvalidArgumentException("invalid shape type")}}else if(g===p.GeometryType.enumMultiPoint)switch(h){case p.GeometryType.enumPolygon:{const aa=new D;b.queryEnvelope(aa);aa.inflate(q.total());const ca=a.getPointCount();let na=!1;const la=l.makePrimitiveArray(ca,!1),fa=new l.Point2D;for(let T=0;T<ca;T++)a.queryXY(T,fa),aa.contains(fa)&&
0!==ob(b,fa,q.total())&&(na=!0,la[T]=!0);if(na){var G=a.createInstance();for(let T=0;T<ca;T++)la[T]||G.addPoints(a,T,T+1);var I=G}else I=a}return I;case p.GeometryType.enumEnvelope:{const aa=new D;b.queryEnvelope(aa);aa.inflate(q.total());const ca=a.getPointCount();let na=!1;const la=l.makePrimitiveArray(ca,!1),fa=new l.Point2D;for(let T=0;T<ca;T++)a.queryXY(T,fa),aa.contains(fa)&&(na=!0,la[T]=!0);if(na){var H=a.createInstance();for(let T=0;T<ca;T++)la[T]||H.addPoints(a,T,T+1);var L=H}else L=a}return L;
case p.GeometryType.enumPoint:{const aa=a.getImpl().getAttributeStreamRef(0),ca=a.getPointCount(),na=b.getXY();let la=!1;const fa=l.makePrimitiveArray(ca,!1),T=kb(q),xa=T*T,oa=new l.Point2D;for(let Ba=0;Ba<ca;Ba++)aa.queryPoint2D(2*Ba,oa),l.Point2D.sqrDistance(oa,na)<=xa&&(la=!0,fa[Ba]=!0);if(la){var M=a.createInstance();for(let Ba=0;Ba<ca;Ba++)fa[Ba]||M.addPoints(a,Ba,Ba+1);var N=M}else N=a}return N}const Q=new D(k);Q.inflate(100*q.total());const O=ra(b,Q,0,0,d);if(a.isEmpty()||O.isEmpty()||a.getDimension()>
O.getDimension())var P=Kb(Ta(a),a,O,"-");else{var ia=new D;a.queryEnvelope(ia);var ka=new D;O.queryEnvelope(ka);var Aa=new D;Aa.setCoords({env2D:ia});Aa.mergeEnvelope2D(ka);var J=Ma(c,Aa,!0),V=ka.clone(),ha=kb(J);V.inflateCoords(ha,ha);if(ia.isIntersecting(V)){var ea=new yb(d),da=new Fa,Ga=da.addGeometry(Ta(a)),ta=da.addGeometry(Ta(O)),Da=0,qa=0,Ca=null;if(da.hasCurves()){Ca=new wb;const aa=da.getEnvelope2D(d);qa=bc(J.total());const ca=xb(J.total(),aa);Da=3*ca+3*qa;var $a=J.total();Jb(da,ca,$a,Ca,
null,d)}ea.setEditShapeCrackAndCluster(da,J.add(Da));var ya=ea.difference(Ga,ta);null!==Ca&&Ca.stitchCurves(da,ya,qa,!0);var Pa=da.getGeometry(ya),La=Kb(Pa,a,O,"-");gf(La.getGeometryType())&&(La.getImpl().setIsSimple(4,J.total()),La.getGeometryType()===p.GeometryType.enumPolygon&&La.getImpl().updateOGCFlagsProtected());P=La}else P=Kb(Ta(a),a,O,"-")}return P}function Ek(a,b,c){var d=b.getGCSSplitLines();if(null===d)return a;b=b.getGCS();var e=b.getPannableExtent().width(),f=D.constructEmpty();a.queryLooseEnvelope(f);
var g=l.Envelope1D.constructEmpty();f.queryIntervalX(g);f=d.querySegmentIterator();d=null;const h=new l.Transformation2D;for(;f.nextPath();)for(;f.hasNextSegment();){const m=f.nextSegment();var k=m.queryInterval(0,0);const n=l.Envelope1D.constructEmpty();n.setCoordsFromEnvelope(k);for(k=0;n.vmax>g.vmin;)n.move(-e),k--;for(;n.vmin<=g.vmax;){if(n.isIntersecting(g)){null===d&&(d=new ma);const q=new Z({start:m.getStartXY(),end:m.getEndXY()});0!==k&&(h.setShiftCoords(k*e,0),q.applyTransformation(h));d.addSegment(q,
!0)}n.move(e);++k}}return null!==d?(b=ib(b,d,!0),e=kb(b),b=d,g=b.getGeometryType(),p.isMultiPath(g)?a=(new vd(c)).crackAWithBMultiPath_(a,b,e):(p.throwNotImplementedException("crack_A_with_B"),a=void 0),a):a}function ch(a,b,c){let d=a.getName();if(d.startsWith(Fk()))return d;c||0<b?(d=a.toString(F.peDefs.PE_STR_NAME_CANON|F.peDefs.PE_STR_AUTH_NONE),d=d.toLocaleUpperCase("en-US")):d=a.toString(F.peDefs.PE_STR_AUTH_TOP);return d}function Gk(a,b=-1){(1<b||-1>b)&&p.throwInvalidArgumentException("verbosity");
return-1===b?a.toString():a.toString(0===b?F.peDefs.PE_STR_AUTH_TOP:F.peDefs.PE_STR_AUTH_ALL)}function dh(a,b,c,d){if(a.isEmpty()||1===c)return a;var e=a.getGeometryType();if(e===p.GeometryType.enumPoint){var f=a.getXY();0===eh([f],1,b,c)||f.isNAN()?a.setEmpty():a.setXY(f);return a}if(e===p.GeometryType.enumMultiPoint){f=a.createInstance();d=a.getPointCount();f.reserve(d);var g=a.getAttributeStreamRef(0),h=1<a.getDescription().getAttributeCount(),k=new Y;g=Float64Array.from(g.getArray());if(0<eh(g,
d,b,c))for(let w=0,x=2*d;w<x;w+=2)Number.isNaN(g[w])||(h?(a.getPointByVal(w>>1,k),k.setXYCoords(g[w],g[w+1]),f.add(k)):f.addXY(g[w],g[w+1]));return f}var m=b.getOneDegreeGCSUnit(),n=90*m;const q=180*m;f=360*m;var r=b.getCentralMeridian(),t=.5*m;h=D.constructEmpty();a.queryEnvelope(h);g=b.getGCSHorizon();var u=b.getGCSHorisonIsInclusive();const v=g.getGeometryType()===p.GeometryType.enumEnvelope;k=D.constructEmpty();g.queryEnvelope(k);b=b.getGCS();if(2===c||4===c)k.xmin=r-q,k.xmax=k.xmin+f;if(4===
c)if(h.width()>f-m)c=2;else{g=D.constructEmpty();g.setCoords({xmin:h.xmin-m,ymin:k.ymin,xmax:h.xmax+m,ymax:k.ymax});a=(new Tc).execute(a,g,b,d);d=Math.floor((r-h.getCenterX())/f);for(h.move(d*f,0);h.xmin>k.xmax;)--d,h.move(-f,0);for(;h.xmin<k.xmin;)d+=1,h.move(f,0);0!==d&&(h=new l.Transformation2D,h.setShiftCoords(d*f,0),a.applyTransformation(h));return a}2===c&&(k.xmin=r-q,k.xmax=k.xmin+f);if(h.ymin<-n||h.ymax>n){c=D.constructEmpty();c.setCoords({xmin:h.xmin-m,ymin:-n,xmax:h.xmax+m,ymax:n});a=(new Tc).execute(a,
c,b,d);if(a.isEmpty())return a;a.queryEnvelope(h)}if(u&&(k.ymax<h.ymin||k.ymin>h.ymax))return a.createInstance();h.width()>f&&(a=ne(a,r-q,f,b,!0,0,!0,d),a.queryEnvelope(h));c=h.xmin;m=h.xmax;r=k.xmin;n=k.xmax;c=c>=r&&m<=n?0:l.round((.5*(n+r)-.5*(m+c))/f)*f;m=c;0!==m&&h.move(m,0);if(h.xmax>k.xmax||h.xmin<k.xmin){if(h.xmax>k.xmax)for(;h.xmin>=k.xmax;)h.move(-f,0),m-=f;for(;h.xmin<k.xmax-f;)h.move(f,0),m+=f}c=Nd(b,g,!1);0!==m&&(r=new l.Transformation2D,r.setShiftCoords(m,0),a.applyTransformation(r),
m=0);if(u){if(v&&k.containsEnvelope(h))return a;u=Array(2);for(m=0;2>m;m++){v?r=p.isMultiPath(e)?ra(a,k,c,t,d):ra(a,k,c,0,d):(r=(new Uc).execute(a,g,b,d),r===g&&(r=r.clone()));if(k.xmin<=h.xmin&&k.xmax>=h.xmax||k.xmin>=h.xmin&&k.xmax<=h.xmax)return r;u[m]=r;0===m&&(h.move(-f,0),r=new l.Transformation2D,r.setShiftCoords(-f,0),a.applyTransformation(r))}p.isMultiPath(e)?u[0].add(u[1],!1):p.throwInternalErrorException("intersect_with_GCS_horizon: unexpected geometry type");return u[0]}if(k.ymax<h.ymin||
k.ymin>h.ymax)return a;for(e=0;!a.isEmpty()&&h.xmax>k.xmin;)0!==e&&(t=new l.Transformation2D,t.setShiftCoords(e,0),a.applyTransformation(t)),(new fh).execute(a,g,b,d)||(a=(new hf).execute(a,g,b,d),g===a&&(a=a.clone())),0!==e&&(t=new l.Transformation2D,t.setShiftCoords(-e,0),a.applyTransformation(t)),e-=f,h.move(-f,0);return a}function gh(a,b,c,d){for(let e=0,f=0;e<d;e++,f+=2)b[c+e].x=a[f],b[c+e].y=a[f+1]}function eh(a,b,c,d){if(0===b||1===d)return b;if(Array.isArray(a)){var e=new Float64Array(2*b);
for(let q=0,r=0;q<b;q++,r+=2)e[r]=a[q].x,e[r+1]=a[q].y}else e=a;if(2===d){d=c.getPannableExtentInGCS();var f=b;for(let q=0,r=2*b;q<r;q+=2)if(e[q+1]>d.ymax||e[q+1]<d.ymin)e[q]=Number.NaN,f--;if(!f)return 0;jf(e,b,d.xmin,d.width(),!0);a!==e&&gh(e,a,0,b);return f}f=c.getOneDegreeGCSUnit();d=90*f;var g=180*f;f*=360;var h=b;for(let q=0,r=2*b;q<r;q+=2)if(e[q+1]>d||e[q+1]<-d)e[q]=Number.NaN,h--;if(!h)return 0;h=D.constructEmpty();h.setFromPoints(e,b);d=c.getGCSHorizon();const k=c.getGCSHorisonIsInclusive();
var m=d.getGeometryType()===p.GeometryType.enumEnvelope;const n=D.constructEmpty();d.queryEnvelope(n);if(k&&(n.ymax<h.ymin||n.ymin>h.ymax))return 0;if(k)if(h=n.getCenterX(),jf(e,b,h-g,f,!0),h=b,m)for(let q=0,r=2*b;q<r;q+=2)n.containsCoords(e[q],e[q+1])||(e[q]=Number.NaN,h--);else{f=Nd(c.getGCS(),d,!1);c=new l.Point2D;for(let q=0,r=2*b;q<r;q+=2)c.setCoords(e[q],e[q+1]),0===ob(d,c,f)&&(e[q]=Number.NaN,h--)}else{jf(e,b,-g,f,!0);h=b;c=Nd(c.getGCS(),d,!1);g=new l.Point2D;for(let q=0,r=2*b;q<r;q+=2)g.setCoords(e[q],
e[q+1]),g.isNAN()&&h--,m=f,m*=l.round((.5*(n.xmax+n.xmin)-g.x)/m),g.x+=m,0!==ob(d,g,c)&&(e[q]=Number.NaN,h--)}0<h&&Array.isArray(a)&&gh(e,a,0,b);return h}function Ad(a,b,c,d,e,f){b.isPannable()||p.throwInvalidArgumentException("fold_into_360_degree_range");if(a.isEmpty())return a;if(2===b.getCoordinateSystemType()){var g=b.getPannableExtent();c=g.xmin;g=g.width()}else{const h=b.getOneDegreeGCSUnit();g=360*h;c-=180*h}return ne(a,c,g,b,d,e,!0,f)}function Hk(a,b,c,d){if(2===c.getCoordinateSystemType())c=
c.getPannableExtent(),d=c.xmin,c=c.width();else{const e=c.getOneDegreeGCSUnit();c=360*e;d-=180*e}jf(a,b,d,c)}function kf(a,b){const c=b.width();a=l.fmod(a-b.vmin,c);0>a&&(a+=c);return b.snapClip(a+b.vmin)}function Xc(a,b,c){return a>b.xmax&&a-b.xmax<c?b.xmax:a<b.xmin&&b.xmin-a<c?b.xmin:a}function lf(a,b,c){return a[0]<b.vmin||a[0]>b.vmax||c&&a[0]===b.vmax?(c=b.width(),a[0]+=Math.ceil((b.vmin-a[0])/c)*c,a[0]=b.snapClip(a[0]),!0):!1}function ok(a,b,c,d,e){const f=new Fa,g=f.addGeometry(a);a=Nd(b,a,
!1);Cd(f,g,b,a,c,d,e);return f.getGeometry(g)}function Cd(a,b,c,d,e,f,g){const h={stack:[],error:void 0,hasError:!1};try{p.geometryReleaseAssert(oe());c.isPannable()||p.throwInvalidCallException("insert_geodetic_points");var k=c.getPannableExtent(),m=c.getGCS(),n=Bd();m.querySpheroidData(n);const A=m.getUnit().getUnitToBaseFactor(),C=n.majorSemiAxis,B=n.e2;m=0;const E=new l.Envelope1D;k.queryIntervalX(E);n=null;const G=Array(4);2===c.getCoordinateSystemType()?(n=c.getPECoordSys(),f?(G[0]=kf(g,E),
G[1]=k.getCenterY(),F.peCSTransformations.projToGeog(n,1,G),m=G[0]*A):(G[0]=k.getCenterX(),G[1]=g,F.peCSTransformations.projToGeog(n,1,G),m=G[1]*A)):m=g*A;f||0===m||2===e||p.throwInvalidCallException("insert_geodetic_points: 1");const I=Ka.__addDisposableResource(h,new F.PeDoubleClass,!1),H=new l.Point2D,L=new l.Point2D,M=new l.Point2D,N=new l.Point2D,Q=new l.Point2D,O=new l.Point2D;for(let P=a.getFirstPath(b);-1!==P;P=a.getNextPath(P)){const ia=a.getFirstVertex(P);a.queryXY(ia,M);b=!1;const ka=a.getNextVertex(ia);
for(k=ka;-1!==k;k=a.getNextVertex(k)){if(k===ka){if(b)break;b=!0}a.queryXY(k,N);if(f&&(d<g-M.x&&N.x-g>d||d<g-N.x&&M.x-g>d)||!f&&(0!==g||d<-M.y&&N.y>d||d<-N.y&&M.y>d)){do{if(Math.abs(M.x-N.x)>=.5*E.width())break;2===c.getCoordinateSystemType()?(G[0]=kf(M.x,E),G[1]=M.y,G[2]=kf(N.x,E),G[3]=N.y,mf(n,2,G,0),Q.x=G[0]*A,Q.y=G[1]*A,O.y=G[3]*A):(Q.x=M.x*A,Q.y=M.y*A,O.y=N.y*A);O.x=(N.x-M.x)*Math.PI*2/E.width()+Q.x;let Aa=0;const J=l.makeObjectArray(l.Point2D,2);if(f){L.x=m;a:{var q=C,r=B,t=Q,u=O,v=m,w=e,x=
{stack:[],error:void 0,hasError:!1};try{if(2===w){b:{q=void 0;if(Math.abs(t.x-u.x)>Math.PI||Math.abs(t.y)>l.geometryHalfPi||Math.abs(u.y)>l.geometryHalfPi||(Math.abs(t.y)===l.geometryHalfPi||Math.abs(u.y)===l.geometryHalfPi)&&t.x!==u.x){var y=Number.NaN;break b}const {first:qa,second:Ca}=l.minMax(t.x,u.x);q=Bg(v,qa,Ca);if(!l.Envelope1D.construct(t.x,u.x).containsCoordinate(q)){y=Number.NaN;break b}const $a=S.constructPoint2D(t),ya=S.constructPoint2D(u),Pa=Ve(1,r,$a),La=Ve(1,r,ya),aa=Pa.crossProductVector(La);
if(aa.z.isZero()){y=t.y;break b}const ca=aa.x.divE(aa.z.negate()),na=aa.y.divE(aa.z.negate()),la=ca.mulE(ca).addE(na.mulE(na)).sqrt();if(la.isZero()||ca.isZero()&&na.isZero()){y=t.y;break b}const fa=Math.atan2(na.value(),ca.value());let T=Math.atan2(la.value()*Math.cos(fa-q),1-r);const xa=mb(1,r,l.Point2D.construct(q,T)),oa=X.construct(xa.x,xa.y,-xa.z),Ba=aa.value().dotProduct(xa),Lb=aa.value().dotProduct(oa);Math.abs(Lb)<Math.abs(Ba)&&(T=-T);y=T}break a}if(Math.abs(t.x-u.x)>=Math.PI||!hh(t.x,u.x,
v)){y=Number.NaN;break a}t.x>u.x&&(u=l.swap(t,t=u));const V=Ka.__addDisposableResource(x,new F.PeDoubleClass,!1),ha=Ka.__addDisposableResource(x,new F.PeDoubleClass,!1),ea=Ka.__addDisposableResource(x,new F.PeDoubleClass,!1),da=t.clone();F.peLineType.geodeticDistance(q,r,t.x,t.y,u.x,u.y,ha,V,null,w);const Ga=ha.val;let ta=0,Da=1;for(;Ga*(Da-ta)>1E-12*q;){const qa=.5*(ta+Da);F.peLineType.geodeticCoordinate(q,r,t.x,t.y,Ga*qa,V.val,ha,ea,w);da.x=ha.val;da.y=ea.val;if(da.x===v){y=da.y;break a}if(hh(t.x,
da.x,v))Da=qa;else if(hh(u.x,da.x,v))ta=qa;else{y=Number.NaN;break a}}y=da.y;break a}catch(V){x.error=V,x.hasError=!0}finally{Ka.__disposeResources(x)}y=void 0}L.y=y;if(Number.isNaN(L.y))break;J[0]=L;Aa=1}else if(2===e){x=[0,0];Aa=dj(C,B,Q,O,m,x);if(!Aa)break;J[0].x=x[0];J[0].y=m;2===Aa&&(J[1].x=x[1],J[1].y=m)}else{a:{x=C;v=B;r=O;t=e;u={stack:[],error:void 0,hasError:!1};try{const V=Q.clone(),ha=r.clone();if(2===t){t=[0,0];dj(x,v,V,ha,0,t);var z=t[0];break a}if(V.y>ha.y){const Ca=new l.Point2D;Ca.assign(V);
V.assign(ha);ha.assign(Ca)}const ea=Ka.__addDisposableResource(u,new F.PeDoubleClass,!1),da=Ka.__addDisposableResource(u,new F.PeDoubleClass,!1),Ga=Ka.__addDisposableResource(u,new F.PeDoubleClass,!1),ta=new l.Envelope1D;ta.setCoords(V.y,ha.y);if(!ta.containsCoordinate(0)||Math.abs(V.x-ha.x)>=Math.PI){z=Number.NaN;break a}if(V.x===ha.x){z=V.x;break a}F.peLineType.geodeticDistance(x,v,V.x,V.y,ha.x,ha.y,da,ea,null,t);const Da=da.val;r=0;q=1;const qa=V.clone();for(;Da*(q-r)>1E-12*x;){w=.5*(r+q);F.peLineType.geodeticCoordinate(x,
v,V.x,V.y,Da*w,ea.val,da,Ga,t);qa.x=da.val;qa.y=Ga.val;ta.setCoords(V.y,qa.y);if(0===qa.y)break;if(ta.containsCoordinate(0))q=w;else if(ta.setCoords(ha.y,qa.y),ta.containsCoordinate(0))r=w;else{p.geometryReleaseAssert(!1);z=Number.NaN;break a}}z=qa.x;break a}catch(V){u.error=V,u.hasError=!0}finally{Ka.__disposeResources(u)}z=void 0}L.x=z;if(Number.isNaN(L.x))break;L.y=0;J[0]=L;Aa=1}x=-1;for(v=0;v<Aa;v++){F.peLineType.geodeticDistance(C,B,Q.x,Q.y,O.x,O.y,I,null,null,e);const V=I.val;F.peLineType.geodeticDistance(C,
B,Q.x,Q.y,J[v].x,J[v].y,I,null,null,e);const ha=I.val;2===c.getCoordinateSystemType()?(G[0]=J[v].x/A,G[1]=J[v].y/A,F.peCSTransformations.geogToProj(n,1,G),f?(H.y=G[1],H.x=g):(H.x=Ik(G[0],M.x,N.x,E),H.y=g)):f?(H.x=g,H.y=J[v].y/A):(H.x=Ik(J[v].x/A,M.x,N.x,E),H.y=g);const ea=0<V?l.snap(ha/V,0,1):.5;if(0===ea||1===ea)continue;if(x>ea)continue;const da=a.getPrevVertex(k);a.splitSegment(da,[ea],1);const Ga=a.getNextVertex(da);a.setXYCoords(Ga,H.x,H.y);x=ea}}while(0)}M.setCoordsPoint2D(N)}}}catch(A){h.error=
A,h.hasError=!0}finally{Ka.__disposeResources(h)}}function zd(a,b){p.geometryReleaseAssert(b.isPannable());var c=b.getPannableExtent();if(a.getGeometryType()===p.GeometryType.enumPoint){var d=a.getY();return c.ymin<=d&&d<=c.ymax?a:a.createInstance()}d=D.constructEmpty();a.queryEnvelope(d);const e=D.constructEmpty();e.setCoords({env2D:c});e.xmin=d.xmin;e.xmax=d.xmax;e.inflateCoords(.01*e.height(),0);c=oc(b,d,!1);return e.containsEnvelope(d)?a:ra(a,e,c,0,null)}function ne(a,b,c,d,e,f,g,h){var k=a.getGeometryType(),
m=l.Envelope1D.constructEmpty();m.setCoords(b,b+c);var n=[0];if(k===p.GeometryType.enumPoint)return n[0]=a.getX(),lf(n,m,g)?(c=e?a:a.clone(),c.setX(n[0]),c):a;var q=D.constructEmpty();a.queryEnvelope(q);if(q.isEmpty())return a;if(k===p.GeometryType.enumMultiPoint){c=e?a:a.clone();q=c.getImpl();d=q.getAttributeStreamRef(0);h=2*q.getPointCount();k=!1;for(a=0;a<h;a+=2)n[0]=d.read(a),lf(n,m,g)&&(d.write(a,n[0]),k=!0);k&&q.notifyModifiedFlags(2001);return c}var r=l.Envelope1D.constructEmpty();q.queryIntervalX(r);
if(m.contains(r))return a;n=D.constructEmpty();n.setCoords({env2D:q});if(0===r.width())return q=r.vmin,q+=Math.ceil((m.vmin-q)/c)*c,q=m.snapClip(q),c=e?a:a.clone(),c.setAttributeBasic(0,0,q),c;if(k===p.GeometryType.enumEnvelope)return c=e?a:a.clone(),q.intersect(n),c.setEnvelope(q),c;e=.1*Math.max(q.height(),q.width());n.inflateCoords(0,e);m=a;g=d.getTolerance(0);for(a=new l.Transformation2D;;){var t=Math.floor((r.vmin-b)/c),u=Math.ceil((r.vmax-b)/c);if(3<u-t){t=Math.floor(.5*(u+t));n.xmin=q.xmin-
e;n.xmax=b+c*t;const v=ra(m,n,g,f,h);n.xmin=n.xmax;n.xmax=q.xmax+e;const w=ra(m,n,g,f,h);a.setShiftCoords((t-u)*c,0);w.applyTransformation(a);k===p.GeometryType.enumPolygon?m=(new nf).execute(v,w,d,h):(m=v,m.add(w,!1));m.queryEnvelope(q);q.queryIntervalX(r)}else break}n.xmin=b;n.xmax=b+c;b=D.constructEmpty();b.setCoords({env2D:n});b.inflateCoords(g,0);(b=Math.floor((q.xmin-n.xmin)/c)*c)?(n.move(b,0),a.setShiftCoords(-b,0)):a.setIdentity();b=k===p.GeometryType.enumPolyline?new ma({vd:m.getDescription()}):
new ba({vd:m.getDescription()});f=D.constructEmpty();for(r=D.constructEmpty();q.xmax>n.xmin;){e=ra(m,n,g,0,h);e.queryEnvelope(r);u=!1;if(u=k===p.GeometryType.enumPolyline?!e.isEmpty()&&(r.width()>g||r.height()>g):!e.isEmpty()&&(k!==p.GeometryType.enumPolygon||r.width()>g))e.applyTransformation(a),e.queryEnvelope(r),b.queryEnvelope(f),f.inflateCoords(g,g),f.isIntersecting(r)&&k===p.GeometryType.enumPolygon?b=(new nf).execute(b,e,d,h):b.add(e,!1);n.move(c,0);a.shiftCoords(-c,0)}return b}function jf(a,
b,c,d,e=!0){const f=new l.Envelope1D;f.setCoords(c,c+d);c=[0];if(Array.isArray(a))for(d=0;d<b;d++)f.containsRightExclusive(a[d].x)||(c[0]=a[d].x,lf(c,f,e),a[d].x=c[0]);else for(d=0;d<b;d++){const g=d<<1;f.containsRightExclusive(a[g])||(c[0]=a[g],lf(c,f,e),a[g]=c[0])}}function of(a,b,c,d=!0){if(!a.isEmpty()){var e=a.getGeometryType();if(!d||e!==p.GeometryType.enumPolygon)if(p.isMultiVertex(e)){d=!1;if(p.isMultiPath(e)&&a.hasNonLinearSegments()){e=a.getImpl();var f=e.getAttributeStreamRef(0),g=e.getSegmentFlagsStreamRef();
p.geometryReleaseAssert(null!==g);for(let m=0,n=e.getPathCount();m<n;m++){var h=!0,k=e.isClosedPath(m);const q=e.getPathEnd(m);k&&0<e.getPathSize(m)&&(h=1===(g.read(q-1)&31));for(k=e.getPathStart(m);k<q;k++)if(1===(g.read(k)&31)){if(h){h=f.read(2*k);const r=Xc(h,b,c);r!==h&&(d=!0,f.write(2*k,r))}h=!0}else h=!1}}else{f=a.getImpl();e=f.getAttributeStreamRef(0);for(let m=0,n=f.getPointCount();m<n;m++)f=e.read(2*m),g=Xc(f,b,c),g!==f&&(d=!0,e.write(2*m,g))}d&&a.getImpl().notifyModifiedFlags(2001)}else e===
p.GeometryType.enumEnvelope?(d=D.constructEmpty(),a.queryEnvelope(d),d.xmin=Xc(d.xmin,b,c),d.xmax=Xc(d.xmax,b,c),a.setEnvelope(d)):e===p.GeometryType.enumPoint?a.setX(Xc(a.getX(),b,c)):p.throwInternalErrorException("")}}function an(a,b){if(b.isEmpty())return 0;var c=a.getPECoordSys();if(c.getProjection().getCode()===F.peDefs.PE_PRJ_AZIMUTHAL_EQUIDISTANT){var d=Bd();a.querySpheroidData(d);var e=c.getParameters();if(null===e[F.peDefs.PE_PARM_LAM0]||null===e[F.peDefs.PE_PARM_PHI0])return 0;e=[e[F.peDefs.PE_PARM_LAM0].getValue(),
e[F.peDefs.PE_PARM_PHI0].getValue()];F.peCSTransformations.geogToProj(c,1,e);c=new l.Point2D(e[0],e[1]);e=D.constructEmpty();b.queryEnvelope(e);b=l.makeObjectArray(l.Point2D,4);e.queryCorners(b);let g=0;var f=a.getOneMeter();a=Math.max(d.majorSemiAxis,d.minorSemiAxis)*Math.PI;d=Math.min(d.majorSemiAxis,d.minorSemiAxis)*Math.PI;a*=f;d=(d-a/180)*f;for(f=0;4>f;f++){const h=l.Point2D.distance(b[f],c);if(h>a)g++;else if(h>d)return-1}if(0===g)return 1;if(4===g)return d=D.constructEmpty(),d.setCoords({center:c,
width:a,height:a}),e.isIntersectingNe(d)?-1:0}return-1}function pf(a,b,c,d){var e=a.getGeometryType();p.geometryReleaseAssert(e===p.GeometryType.enumPolygon||e===p.GeometryType.enumPolyline||e===p.GeometryType.enumMultiPoint);var f=b.getCoordinateSystemType();if(2===f){f=a;if(0===c){e=an(b,a);if(0===e)return a.createInstance();if(1===e)return a;e=b.getPCSHorizon();var g=e.getGeometryType();c=b.getDefaultPrecisionSR();g===p.GeometryType.enumEnvelope?(f=D.constructEmpty(),e.queryEnvelope(f),e=oc(c,
f,!1),f=ra(a,f,e,5E4*b.getOneMeterPCSUnit(),d)):(new Jk).execute(e,a,c,d)||(f=(new Uc).execute(f,e,c,d),f===e&&(f=f.clone()))}else if(b.isPannable()&&(a=D.constructEmpty(),f.queryEnvelope(a),g=b.getPannableExtent(),!g.containsEnvelope(a))){of(f,g,b.getTolerance(0));if(2===c||4===c)f=zd(f,b);4!==c?f=Ad(f,b,0,!0,1E5*b.getOneMeterPCSUnit(),d):e===p.GeometryType.enumPolygon&&a.width()>2*g.width()&&(f=ne(f,-2*g.width(),2*g.width(),b,!0,0,!0,d))}return f}p.geometryReleaseAssert(1===f);if(e===p.GeometryType.enumMultiPoint)return of(a,
b.getPannableExtent(),b.getTolerance(0)),a;f=D.constructEmpty();a.queryEnvelope(f);c=b.getPannableExtent();if(f.ymin<c.ymin||f.ymax>c.ymax)if(g=Math.max(1,f.calculateToleranceFromEnvelope()),g=new D(f.xmin-g,c.ymin,f.xmax+g,c.ymax),a=(new Tc).execute(a,g,b,d),a.isEmpty())return a;e===p.GeometryType.enumPolygon&&f.width()>2*c.width()&&(a=ne(a,-2*c.width(),2*c.width(),b,!0,0,!0,d));return a}function Dd(a,b,c,d){if(c){var e=a.getPECoordSys();if(1===c){c=[b[0].x,b[0].y];F.peCSTransformations.geogToProj(e,
1,c);if(d){const {first:t,second:u}=a.m_peCoordSysVal.getGeogToProjFactors();c[0]=t*(b[0].x-a.getCentralMeridian())+u}b[0].setCoords(c[0],c[1])}else{var f=a.isPannable(),g=f?a.getPannableExtent().width():0,h=179*g/360,k=0;f&&(k=a.getCentralMeridian());var m=new Float64Array(512);for(let t=0;t<c;){for(var n=t;n<c&&b[n].isNAN();++n)t++;n=Math.min(256,c-t);if(0<n){for(let u=1,v=t+1;u<n;++u,++v)if(b[v].isNAN()){n=u;break}for(var q=0;q<n;++q){var r=q<<1;m[r]=b[t+q].x;m[r+1]=b[t+q].y}F.peCSTransformations.geogToProj(e,
n,m);if(d){const {first:u,second:v}=a.m_peCoordSysVal.getGeogToProjFactors();for(q=0;q<n;++q)m[q<<1]=u*(b[t+q].x-k)+v}if(f)for(let u=0,v=t;u<n;u++,v++){q=u<<1;r=m[q];const w=l.sign(r);0>w*l.sign(b[v].x-k)&&Math.abs(r)>h&&(m[q]-=w*g)}gh(m,b,t,n);t+=n}}}}}function Kk(a,b,c){p.geometryReleaseAssert(!c||a.isPannable());const d=b.getPointCount();if(d){b=b.getImpl();var e=b.getAttributeStreamRef(0),f=a.getPECoordSys(),g=0,h=e.readRange(0,2*d),k=()=>{F.peCSTransformations.geogToProj(f,d,h)},m=a.isPannable()&&
!c,n=m?a.getPannableExtent().width():0,q=179*n/360;if(a.isPannable()&&(g=a.getCentralMeridian(),c)){a=a.m_peCoordSysVal.getGeogToProjFactors();const r=a.first,t=a.second;k=()=>{F.peCSTransformations.geogToProj(f,d,h);for(let u=0;u<d;u++){const v=u<<1,w=e.read(v);h[v]=r*(w-g)+t}}}k();if(m)for(a=0;a<d;a++){c=a<<1;m=h[c];k=l.sign(m);const r=e.read(c)-g;0>k*l.sign(r)&&Math.abs(m)>q&&(h[c]+=-k*n)}e.writeRangeFromArray(0,2*d,h,!0,1);b.notifyModifiedFlags(2001)}}function Lk(a,b,c){if(b.hasNonLinearSegments()){if(p.geometryReleaseAssert(!c||
a.isPannable()),!b.isEmpty()){var d=a.getPECoordSys(),e=a.isPannable(),f=e?a.getPannableExtent().width():0,g=179*f/360,h=0;e&&(h=a.getCentralMeridian());var k=b.createInstance();k.reserveParts(b.getPointCount(),b.getPathCount());var m=b.getImpl(),n=new W;for(let C=0,B=b.getPathCount();C<B;++C)if(m.hasNonLinearSegmentsPath(C)){var q=!0,r=-1,t=m.getPathStart(C),u=t+m.getSegmentCountPath(C);m.isClosedPath(C)&&(r=u-1);for(var v=new l.Point2D;t<u;++t){m.getSegmentBuffer(t,n,!1);var w=a,x=n.get(),y=c;switch(x.getGeometryType()){case p.GeometryType.enumLine:var z=
[x.getStartXY(),x.getEndXY()];Dd(w,z,2,y);x.setStartXY(z[0]);x.setEndXY(z[1]);x.normalizeAfterEndpointChange();break;case p.GeometryType.enumBezier:z=l.makeObjectArray(l.Point2D,4);x.queryControlPoints(z);Dd(w,z,4,y);x.setControlPoints(z);break;case p.GeometryType.enumEllipticArc:if(0===x.projectionBehavior())Mk(!0,w,0,x,y);else{z=x.isClosed()&&x.isMajor();var A=[x.getStartXY(),z?x.getCenter():x.getEndXY()];const E=[A[0].clone(),A[1].clone()];Dd(w,E,2,y);w=new l.Transformation2D;w.initializeFromTwoPointsArray(A,
E);x.applyTransformation(w);x.setCoordsForIntersector(E[0],E[z?0:1],!1)}break;case p.GeometryType.enumBezier2:p.geometryReleaseAssert(0);break;case p.GeometryType.enumRationalBezier2:p.geometryReleaseAssert(0);break;default:p.throwInternalErrorException("")}q||n.get().getStartXY().equals(v)||n.get().moveTo(v);t!==r?k.addSegment(n.get(),q):(q&&(q=new Y,n.get().queryStart(q),k.startPathPoint(q)),k.closeLastPathWithSegment(n.get()));v.assign(n.get().getEndXY());q=!1}}else{r=m.getPathSize(C);u=Math.min(r,
1024);k.insertPath(-1,b,C,!0);q=m.getAttributeStreamRef(0);t=k.getAttributeStreamRef(0);for(let E=m.getPathStart(C),G=m.getPathEnd(C);E<G;){v=q.readRange(E,u);F.peCSTransformations.geogToProj(d,u,v);if(e)for(x=0;x<u;x++)w=x<<1,y=v[w],z=l.sign(y),A=q.read(2*(0+x))-h,0>z*l.sign(A)&&Math.abs(y)>g&&(v[w]+=-z*f);t.writeRangeFromArray(E,u,v,!0,1);E+=u;r-=u;u=Math.min(r,1024)}}b.assignMove(k)}}else Kk(a,b,c)}function Nk(a,b,c){let d=c.getPointCount();if(d){c=c.getImpl();var e=c.getAttributeStreamRef(0),
f=Math.min(d,1E3),g=0,h=a.getPECoordSys();Number.isNaN(b)&&(b=0);var k=a.isPannable(),m=a.getOneDegreeGCSUnit();a=360*m;m*=179;for(var n;d;){n=e.readRange(2*g,2*f);mf(h,f,n,b);if(k)for(let q=0;q<f;q++){const r=q<<1,t=n[r]-b,u=l.sign(t),v=e.read(2*(g+q));0>u*l.sign(v)&&Math.abs(t)>m&&(n[r]+=-u*a)}e.writeRangeFromArray(2*g,2*f,n,!0,1);g+=f;d-=f;f=Math.min(d,1E3)}c.notifyModifiedFlags(2001)}}function mf(a,b,c,d){a=F.peCSTransformations.projToGeogCenter(a,b,c,d);for(d=0;d<b;++d){const e=d<<1;p.geometryReleaseAssert(Number.isFinite(c[e]+
c[e+1]))}return a}function qf(a,b,c){if(!c.hasNonLinearSegments())Nk(a,b,c);else if(!c.isEmpty()){var d=a.getPECoordSys();Number.isNaN(b)&&(b=0);var e=a.isPannable(),f=a.getOneDegreeGCSUnit(),g=360*f;f*=179;var h=c.createInstance();h.reserveParts(c.getPointCount(),c.getPathCount());var k=c.getImpl(),m=new W;for(let A=0,C=c.getPathCount();A<C;++A)if(k.hasNonLinearSegmentsPath(A)){var n=!0,q=-1,r=k.getPathStart(A),t=r+k.getSegmentCountPath(A);k.isClosedPath(A)&&(q=t-1);for(var u=new l.Point2D;r<t;++r){k.getSegmentBuffer(r,
m,!1);var v=a,w=b,x=m.get();switch(x.getGeometryType()){case p.GeometryType.enumLine:var y=[x.getStartXY(),x.getEndXY()];rf(v,w,y,2);x.setStartXY(y[0]);x.setEndXY(y[1]);x.normalizeAfterEndpointChange();break;case p.GeometryType.enumBezier:y=l.makeObjectArray(l.Point2D,4);x.queryControlPoints(y);ih(v,w,y,4);x.setControlPoints(y);break;case p.GeometryType.enumEllipticArc:if(0===x.projectionBehavior())Mk(!1,v,w,x,!1);else{y=x.isClosed()&&x.isMajor();var z=[x.getStartXY(),y?x.getCenter():x.getEndXY()];
const B=[z[0].clone(),z[1].clone()];ih(v,w,B,2);v=new l.Transformation2D;v.initializeFromTwoPointsArray(z,B);x.applyTransformation(v);x.setCoordsForIntersector(B[0],B[y?0:1],!1)}break;case p.GeometryType.enumBezier2:p.geometryReleaseAssert(0);break;case p.GeometryType.enumRationalBezier2:p.geometryReleaseAssert(0);break;default:p.throwInternalErrorException("")}n||m.get().getStartXY().equals(u)||m.get().moveTo(u);r!==q?h.addSegment(m.get(),n):(n&&(n=new Y,m.get().queryStart(n),h.startPathPoint(n)),
h.closeLastPathWithSegment(m.get()));u.assign(m.get().getEndXY());n=!1}}else{q=k.getPathSize(A);t=Math.min(q,1E3);h.insertPath(-1,c,A,!0);n=k.getAttributeStreamRef(0);r=h.getAttributeStreamRef(0);for(let B=k.getPathStart(A),E=k.getPathEnd(A);B<E;){u=n.readRange(2*B,2*t);mf(d,t,u,b);if(e)for(x=0;x<t;x++)v=x<<1,w=u[v]-b,y=l.sign(w),z=n.read(2*B),0>y*l.sign(z)&&Math.abs(w)>f&&(u[v]+=-y*g);r.writeRangeFromArray(2*B,2*t,u,!0,1);B+=t;q-=t;t=Math.min(q,1E3)}}c.assignMove(h)}}function rf(a,b,c,d){const e=
a.getPECoordSys();Number.isNaN(b)&&(b=0);const f=a.isPannable();var g=a.getOneDegreeGCSUnit();a=360*g;g*=179;const h=new Float64Array(512);for(let q=0;q<d;){for(var k=q;k<d&&c[k].isNAN();++k)q++;k=Math.min(256,d-q);if(0<k){for(let r=1,t=q+1;r<k;++r,++t)if(c[t].isNAN()){k=r;break}for(var m=0;m<k;m++){var n=m<<1;h[n]=c[q+m].x;h[n+1]=c[q+m].y}mf(e,k,h,b);if(f)for(let r=0,t=q;r<k;++r,++t){m=r<<1;n=c[t].x;const u=h[m]-b,v=l.sign(u);0>v*l.sign(n)&&Math.abs(u)>g&&(h[m]-=v*a)}for(m=0;m<k;m++)n=m<<1,c[q+m].x=
h[n],c[q+m].y=h[n+1];q+=k}}}function Ok(a,b,c){var d=b.getPointCount();if(!d)return!1;const e=b.getImpl();var f=e.getAttributeStreamRef(0),g=null,h=a.getInputSR(),k=a.getOutputSR();h.getVCS();k.getVCS();var m=h.getOneDegreeGCSUnit(),n=k.getOneDegreeGCSUnit(),q=a.isVertical();q&&b.hasAttribute(1)&&(g=e.getAttributeStreamRef(1));b=(a=a.getDatumTransformation())?1===a.getType():!1;b||null===g||(g.getArray(),p.geometryReleaseAssert(0),g=null);if(!a||0===a.count()){c=h.getGcsUnitFactor();g=k.getGcsUnitFactor();
c/=g;g=(h.getPrimeMeridian()-k.getPrimeMeridian())*n;a=-90*m;b=90*m;q=0;h=f.getArray();k=[0];for(let E=1,G=2*d;E<G;)k[0]=h[E],q|=l.querySnap(k,a,b)?1:0,h[E]=k[0],E+=2;if(0!==g||1!==c){q=1;f=f.getArray();for(let E=0,G=2*d;E<G;)d=f[E],d*=c,d+=g,f[E]=d,f[E+1]*=c,E+=2}0!==q&&e.notifyModifiedFlags(2001);return!!q}h=Math.min(d,1E3);k=Array(h);const r=Array(h);let t=null;null!==g&&(t=new Float64Array(h));let u=0,v=Number.NaN,w=Number.NaN;const x=360*n,y=n/m;c&&(w=90*n,v=89.9*m,r.fill(0));m=!0;for(n=0;d;){var z=
!1;const E=f.readRange(2*u,2*h);for(var A=0;A<h;A++)k[A]=E[A<<1];if(c)for(A=0;A<h;A++){var C=(A<<1)+1,B=Math.abs(E[C])-v;0<B&&(z=E[C],E[C]=l.copySign(v,z),r[A]=l.copySign(B,z),z=!0)}A=E[0];b?(C=a,t&&g.queryRange(u,h,t,!0,1),C.transform(!1,E,t,h),t&&g.writeRangeFromArray(u,h,t,!0,1)):a.transform(!1,E,h);m&&(n=E[0]-y*A,m=!1);for(A=0;A<h;A++)C=A<<1,B=E[C]-k[A]*y-n,200<Math.abs(B)&&(E[C]=0<B?E[C]+-x:E[C]+x);if(z){for(z=0;z<h;z++)r[z]&&(A=(z<<1)+1,E[A]+=y*r[z],E[A]>w?E[A]=w:E[A]<-w&&(E[A]=-w));r.fill(0)}f.writeRangeFromArray(2*
u,2*h,E,!0,1);q&&g&&g.writeRangeFromArray(u,h,t,!0,1);u+=h;d-=h;h=Math.min(d,1E3)}e.notifyModifiedFlags(2001);return!0}function bn(a,b,c){switch(b.getGeometryType()){case p.GeometryType.enumLine:var d=[b.getStartXY(),b.getEndXY()],e=[0,0],f=null;b.hasAttribute(1)&&(f=e,f[0]=b.getAttributeAsDbl(0,1,0),f[1]=b.getAttributeAsDbl(1,1,0));a=Ed(a,d,f,2,c);b.setStartXY(d[0]);b.setEndXY(d[1]);f&&(b.setStartAttribute(1,0,f[0]),b.setEndAttribute(1,0,f[1]));b.normalizeAfterEndpointChange();return a;case p.GeometryType.enumBezier:return d=
l.makeObjectArray(l.Point2D,4),b.queryControlPoints(d),e=[0,0,0,0],f=null,b.hasAttribute(1)&&(f=e,f[0]=b.getAttributeAsDbl(0,1,0),f[3]=b.getAttributeAsDbl(1,1,0),f[1]=l.lerp(f[0],f[3],.5),f[2]=f[1]),a=Ed(a,d,f?f:null,d.length,c),b.setControlPoints(d),f&&(b.setStartAttribute(1,0,f[0]),b.setEndAttribute(1,0,f[3])),b.normalizeAfterEndpointChange(),a;case p.GeometryType.enumEllipticArc:if(0===b.projectionBehavior()){d=[b.getStartXY(),b.getEndXY(),b.getInteriorPoint(),b.getCenter()];e=4;b.isDegenerateToLine()&&
(e=2);var g=[0,0,0,0];f=null;b.hasAttribute(1)&&(f=g,f[0]=b.getAttributeAsDbl(0,1,0),f[1]=b.getAttributeAsDbl(1,1,0),g=l.lerp(f[0],f[1],.5),f[2]=g,f[3]=g);g=b.getStartXY().equals(b.getEndXY())&&!b.isDegenerateToLine();a=Ed(a,d,f,e,c);g?b.constructCircleCenterAndPoint(d[3],d[0],!b.isClockwise()):b.isDegenerateToLine()?b.constructLineCircularArc(d[0],d[1]):b.constructCircularArcThreePoint(d[0],d[1],d[2]);f&&(b.setStartAttribute(1,0,f[0]),b.setEndAttribute(1,0,f[1]));b=a}else{d=b.getStartXY().equals(b.getEndXY());
f=l.makeObjectArray(l.Point2D,3);e=l.makeObjectArray(l.Point2D,3);var h=[0,0,0];g=null;f[0].assign(b.getStartXY());f[1].assign(d?b.getCenter():b.getEndXY());var k=!1;b.hasAttribute(1)&&(g=h,g[0]=b.getAttributeAsDbl(0,1,0),g[1]=b.getAttributeAsDbl(1,1,0),g[2]=l.lerp(g[0],g[1],.5),d&&(g[1]=g[2]));e[0].setCoordsPoint2D(f[0]);e[1].setCoordsPoint2D(f[1]);h=new l.Transformation2D;d||b.isDegenerateToLine()?(k=Ed(a,e,g,2,c),h.initializeFromTwoPoints(f[0],f[1],e[0],e[1])):(k=new l.Point2D,b.queryCoord2D(.5,
k),f[2].setCoordsPoint2D(k),e[2].setCoordsPoint2D(k),k=Ed(a,e,g,3,c),h.setFromTwoTriangles(f,e));h.isIdentity()||(b.applyTransformation(h),b.setStartXY(e[0]),b.setEndXY(d?e[0]:e[1]),b.normalizeAfterEndpointChange());g&&(b.setStartAttribute(1,0,g[0]),b.setEndAttribute(1,0,d?g[0]:g[1]));b=k}return b;case p.GeometryType.enumBezier2:return p.geometryReleaseAssert(0),!1;case p.GeometryType.enumRationalBezier2:return p.geometryReleaseAssert(0),!1;default:p.throwInternalErrorException("")}}function sf(a,
b,c){if(!b.hasNonLinearSegments())return Ok(a,b,c);if(b.isEmpty())return!1;const d=b.createInstance();d.reserveParts(b.getPointCount(),b.getPathCount());const e=b.getImpl(),f=new W;for(let k=0,m=b.getPathCount();k<m;++k){var g=!0;let n=-1;var h=e.getPathStart(k);const q=h+e.getSegmentCountPath(k);e.isClosedPath(k)&&(n=q-1);const r=new l.Point2D;for(;h<q;++h)e.getSegmentBuffer(h,f,!1),bn(a,f.get(),c),g||f.get().getStartXY().equals(r)||f.get().moveTo(r),h!==n?d.addSegment(f.get(),g):(g&&(g=new Y,f.get().queryStart(g),
d.startPathPoint(g)),d.closeLastPathWithSegment(f.get())),r.assign(f.get().getEndXY()),g=!1}b.assignMove(d);return!0}function Pk(a,b,c,d,e,f){if(a.isIdentityGeogToGeog()){c=90*a.getInputSR().getOneDegreeGCSUnit();e=0;a=[0];for(f=0;f<d;f++)a[0]=b[f].y,e|=l.querySnap(a,-c,c)?1:0,b[f].y=a[0];return e}var g=a.getInputSR(),h=a.getOutputSR(),k=g.getVCS(),m=h.getVCS(),n=g.getOneDegreeGCSUnit(),q=90*n,r=h.getOneDegreeGCSUnit(),t=a.isVertical();f=(a=a.getDatumTransformation())?1===a.getType():!1;t||(c=null);
if(!a||0===a.count()){e=0;a=[0];for(f=0;f<d;f++)a[0]=b[f].y,e|=l.querySnap(a,-q,q)?1:0,b[f].y=a[0];g=g.getGCS();a=h.getGCS();f=null;k&&(f=k.getPEVerticalCoordSys());k=null;g&&(k=g.getPECoordSys());h=null;m&&(h=m.getPEVerticalCoordSys());m=null;a&&(m=a.getPECoordSys());if(k||f||m||h)if(a=Qk(),a.initFromGcsAndVcsPe(k,f),f=Qk(),f.initFromGcsAndVcsPe(m,h),a.equals(f))b=!1;else{if(c)for(h=1,m=0,q=g=1,k=0,t=1,Number.isNaN(a.m_heightMetersPerUnit)||(h=a.m_heightMetersPerUnit,m=a.m_heightZ0,g=a.m_heightSign,
q=f.m_heightMetersPerUnit,k=f.m_heightZ0,t=f.m_heightSign),h=g*t*h/q,g=0;g<d;g++)c[g]=(c[g]-m)*h+k;c=1;m=0;Number.isNaN(a.m_XYToRadians)||(c=a.m_XYToRadians/f.m_XYToRadians,m=a.m_PrimeMeridianDegrees-f.m_PrimeMeridianDegrees,0!==m&&(m*=jh,m/=f.m_XYToRadians));if(Array.isArray(b))for(a=0;a<d;a++)b[a][0]=b[a][0]*c+m,b[a][1]*=c;else for(a=0;a<d;a++)f=a<<1,b[f]=b[f]*c+m,b[f+1]*=c;b=!0}else b=!1;return e|(b?1:0)}f||null===c||p.geometryReleaseAssert(0);m=Math.min(d,1024);k=Array(m);h=l.makePrimitiveArray(m,
0);g=0;t=q=Number.NaN;const u=360*r,v=r/n;e&&(t=90*r,q=89.9*n);n=!0;for(r=0;d;){var w=!1;for(var x=0;x<m;x++)k[x]=b[x+g].x;if(e)for(x=0;x<m;x++){var y=Math.abs(b[x+g].y)-q;0<y&&(w=b[x+g].y,b[x+g].y=l.copySign(q,w),h[x]=l.copySign(y,w),w=!0)}x=b[0].x;f?a.transform(!1,b,c,m):a.transform(!1,b,m);n&&(r=b[0].x-v*x,n=!1);for(x=0;x<m;x++)y=b[g+x].x-k[x]*v-r,200<Math.abs(y)&&(b[g+x].x=0<y?b[g+x].x-u:b[g+x].x+u);if(w){for(w=0;w<m;w++)h[w]&&(b[g+w].y+=v*h[w],b[g+w].y>t?b[g+w].y=t:b[g+w].y<-t&&(b[g+w].y=-t));
h.fill(0,0,m)}g+=m;d-=m;m=Math.min(d,1024)}return 1}function Ed(a,b,c,d,e,f){f=0;let g=!0,h=0;for(let k=0;k<d;++k)b[k].isNAN()?g||(f|=Pk(a,b.slice(h,k-h),c?c.slice(h,k-h):null,k-h,e),h=k,g=!0):g&&(h=k,g=!1);g||(f|=Pk(a,0===h?b:b.slice(h),c?0===h?c:c.slice(h):null,d-h,e));return 0!==f}function ih(a,b,c,d){rf(a,b,c,d);const e=new D;e.setFromPoints(c,d);var f=a.getOneDegreeGCSUnit();a=360*f;f*=180;if(e.width()>f){for(let g=0;g<d;g++)for(;c[g].x<b;)c[g].x+=a;e.setFromPoints(c,d);if(e.xmax>f+b)for(b=0;b<
d;b++)c[b].x-=a}}function Mk(a,b,c,d,e){const f=l.makeObjectArray(l.Point2D,3);let g=0,h=!1,k=!1;const m=d.isDegenerateToLine();m?(f[0].assign(d.getStartXY()),f[1].assign(d.getEndXY()),f[2].setCoords(0,0),g=2):d.isClosed()&&d.isMajor()?(h=!0,k=!d.isClockwise(),f[0].assign(d.getStartXY()),f[1].assign(d.getCenter()),f[2].setCoords(0,0),g=2):(f[0].assign(d.getStartXY()),f[1].assign(d.getEndXY()),f[2].assign(d.getInteriorPoint()),g=3);a?Dd(b,f,g,e):ih(b,c,f,g);m?d.constructLineCircularArc(f[0],f[1]):
h?d.constructCircleCenterAndPoint(f[1],f[0],k):d.constructCircularArcThreePoint(f[0],f[1],f[2])}function hh(a,b,c){a*=tf;b=zg(b*tf-a);c=zg(c*tf-a);return 0===c||0<b&&0<c&&c<=b||0>b&&0>c&&c>=b?!0:!1}function Ik(a,b,c,d){var e=new l.Envelope1D;e.setCoords(b,c);c=d.width();a=Math.floor((a-b)/c)*c+a;for(e=e.getCenter();Math.abs(a-e)>Math.abs(a+c-e);)a+=c;return a}function uf(a,b,c,d){return new Rk(2,a,b,c,d,void 0)}function cn(){return{centralMeridianOfOutputGCS:Number.NaN,densificationStep:Number.NaN,
clipWithInputHorizon:!0,clipWithOutputHorizon:!0,legacyHorizonClipping:!1,normalizeResultGeometry:!1,equals(a){return l.isEqualNonIEEE(this.centralMeridianOfOutputGCS,a.centralMeridianOfOutputGCS)&&l.isEqualNonIEEE(this.densificationStep,a.densificationStep)&&this.clipWithInputHorizon===a.clipWithInputHorizon&&this.clipWithOutputHorizon===a.clipWithOutputHorizon&&this.legacyHorizonClipping===a.legacyHorizonClipping&&this.normalizeResultGeometry===a.normalizeResultGeometry}}}function dn(){return{flagsMask:0,
setFlag(a,b){this.flagsMask=b?this.flagsMask|a:this.flagsMask&~a},hasFlag(a){return 0!==(this.flagsMask&a)}}}function pe(){return{m_extendedParams:cn(),m_extendedParamsInternal:dn()}}function Sk(a){var b=a.getCode();if(0<b)return(a=kh(b))?a:vf(F.peFactory.coordsys(b));b=a.getName();if(qe.has(b)&&(b=qe.get(b))&&b.deref()&&(b=b.deref(),b.m_peCoordSys.isEqual(a)))return b;b=F.peFactory.getCode(a);return 0<b?vf(F.peFactory.coordsys(b)):vf(a)}function vf(a){var b=wf(a),c=a.getCode();if(0<c){var d=kh(c);
if(d)return d}d=a.getName();var e=qe.get(d);if(e&&(e=e.deref())&&e.m_peCoordSys.isEqual(a))return e;b=new lh(b.release());if(0<c)return b.setCached(),mh.set(c,new WeakRef(b)),qe.set(d,new WeakRef(b)),b;a=ch(a,0,!1);if(e=nh.get(a))if(c=e.deref())return c;b.setCached();nh.set(a,new WeakRef(b));return b}function kh(a){if(a=mh.get(a))return a.deref()}function Tk(a,b,c,d){d=[];Uk(b,d);return Vk(a,d,b,c)}function en(a){return{at(b){return a.getXY(b)}}}function Uk(a,b){b.length=a;for(let c=0;c<b.length;++c)b[c]=
c;3<a&&Ph(a,b)}function Vk(a,b,c,d,e){e=0;const f=[0,0,0];let g=0;var h=0;for(let q=0;3>q;++q){for(var k=!1;h<c;){var m=a.at(b[h]),n=1;3===e?n=l.Point2D.inCircleRobust(a.at(d[0]),a.at(d[1]),a.at(d[2]),m):2===e?n=l.Point2D.inCircleRobust3Point(a.at(d[0]),a.at(d[1]),m):1===e&&m.equals(a.at(d[0]))&&(n=0);if(0>=n){if(0>n&&3>q+1){b[g]=l.swap(b[h],b[h]=b[g]);for(m=0;m<e;m++)if(d[m]===b[h]){f[m]=h;break}g++}h++}else{k=!0;m=0;for(n=0;n<e;n++)f[n]>h&&(d[m]=d[n],f[m]=f[n],m++);e=m;d[e]=b[h];f[e]=h;e++;3>e?
h=g:(1===l.Point2D.orientationRobust(a.at(d[0]),a.at(d[1]),a.at(d[2]))&&(d[2]=l.swap(d[0],d[0]=d[2]),f[2]=l.swap(f[0],f[0]=f[2])),h++)}}if(!k)break;if(3>q+1){g=0;h=!1;for(k=0;k<e;k++)for(m=k+1;m<e;m++)f[k]>f[m]&&(f[m]=l.swap(f[k],f[k]=f[m]),d[m]=l.swap(d[k],d[k]=d[m]),h=!0);for(k=0;k<e;k++)b[f[k]]=l.swap(b[k],b[k]=b[f[k]]),f[k]=k;h&&3===e&&1===l.Point2D.orientationRobust(a.at(d[0]),a.at(d[1]),a.at(d[2]))&&(d[2]=l.swap(d[0],d[0]=d[2]),f[2]=l.swap(f[0],f[0]=f[2]))}h=e}return e}function Yc(a){let b=
!1;a<=-l.pi()?(a+=l.twoPi(),b=!0):a>l.pi()&&(a-=l.twoPi(),b=!0);a<=-l.pi()?(a=l.fmod(a,l.twoPi()),a<=-l.pi()&&(a+=l.twoPi()),b=!0):a>l.pi()&&(a=l.fmod(a,l.twoPi()),a>l.pi()&&(a-=l.twoPi()),b=!0);b&&(a>l.pi()||a<=-l.pi())&&(a=l.pi());return a}function Wk(a,b,c){b=c.getSemiAxes();a=new l.Point2D(b.x*Math.cos(a[0]),b.y*Math.sin(a[0]));a=c.convertFromCanonic(a);return l.Point2D.sqrDistance(a,c.getStartXY())}function Xk(a,b,c){b=c.getSemiAxes();a=a[0]+c.getStartAngle();a=new l.Point2D(b.x*Math.cos(a),
b.y*Math.sin(a));a=c.convertFromCanonic(a);return l.Point2D.sqrDistance(a,c.getEndXY())}function oh(a){if(a.m_center.isNAN())a.m_startAngle=0,a.m_sweepAngle=0;else{var b=a.getStartXY(),c=a.getEndXY(),d=b.equals(c),e=0!==(a.m_bits&2),f=0!==(a.m_bits&1),g=a.projectionBehavior();if(d)b=a.convertToCanonic(b),c=new l.Point2D(a.m_semiMajorAxis,a.m_semiMajorAxis*a.m_minorMajorRatio),b.x/=c.x,b.y/=c.y,a.m_startAngle=Yc(Math.atan2(b.y,b.x)),a.m_sweepAngle=e?f?l.twoPi():-l.twoPi():0;else{d=a.convertToCanonic(b);
const h=new l.Point2D(a.m_semiMajorAxis,a.m_semiMajorAxis*a.m_minorMajorRatio);d.x/=h.x;d.y/=h.y;const k=a.convertToCanonic(c);k.x/=h.x;k.y/=h.y;a.m_startAngle=Math.atan2(d.y,d.x);a.m_sweepAngle=l.Point2D.calculateAngle(d,k);f?0>a.m_sweepAngle&&(a.m_sweepAngle+=l.twoPi()):0<a.m_sweepAngle&&(a.m_sweepAngle-=l.twoPi());a.m_startAngle=Yc(a.m_startAngle);d=Wk([a.m_startAngle],1,a);d=Math.sqrt(d);d>.25*jc(a)&&(d=[0],ci(Wk,a,1,[a.m_startAngle],[a.m_startAngle-1E-4],[a.m_startAngle+1E-4],1E-14,d),a.m_startAngle=
Yc(d[0]));d=Xk([a.m_sweepAngle],1,a);d=Math.sqrt(d);d>.25*jc(a)&&(d=[0],ci(Xk,a,1,[a.m_sweepAngle],[a.m_sweepAngle-1E-4],[a.m_sweepAngle+1E-4],1E-14,d),a.m_sweepAngle=d[0]);d=Math.abs(a.m_sweepAngle)>l.pi();Fd(a,d);e!==d&&!e&&Math.abs(a.m_sweepAngle)>1.5*l.pi()?Tb(a,b,c,g):0!==a.m_sweepAngle&&f===0<a.m_sweepAngle||Tb(a,b,c,g)}}}function Ja(a,b){{var c=new l.Envelope1D(a.getStartAngle(),a.getEndAngle());c.normalize();const e=l.twoPi();b=l.fmod(b,e);if(b<c.vmin){for(var d=b+e;d<c.vmin;)d+=e;c=c.containsCoordinate(d)?
d:c.vmin-b<d-c.vmax?b:d}else if(b>c.vmax){for(d=b-e;d>c.vmax;)d-=e;c=c.containsCoordinate(d)?d:c.vmin-d<b-c.vmax?d:b}else c=b}return(c-a.getStartAngle())/a.getSweepAngle()}function mc(a,b){return a.m_startAngle+b*a.m_sweepAngle}function ph(a){if(a.m_cachedValues)return a.m_cachedValues;const b={e2:0,completeE:0};b.e2=1-l.sqr(a.m_minorMajorRatio);b.completeE=l.completeEllipticE(b.e2);return a.m_cachedValues=b}function Yk(a,b,c,d){if(!b.isEqual(a.m_XStart,a.m_YStart)||!c.isEqual(a.m_XEnd,a.m_YEnd))if(Ha(a))a.m_XStart=
b.x,a.m_YStart=b.y,a.m_XEnd=c.x,a.m_YEnd=c.y,re(a),a.afterCompletedModification();else{if(d&&Math.abs(a.getSweepAngle())<=1.01*l.halfPi()){d=l.makeObjectArray(l.Point2D,3);var e=jj(a,d);if(Oe(d)){d[0].assign(b);d[2].assign(c);md(d);if(0!==a.projectionBehavior())xf(d,e*e,null,!1,a);else{e=l.Point2D.sqrDistance(d[1],d[0]);var f=l.Point2D.sqrDistance(d[1],d[2]);b=0;c=2;e<f&&(c=l.swap(b,b=c));e=d[c].sub(d[b]);var g=e.length();e.divThis(g);f=d[1].sub(d[b]);var h=f.length(),k=f.dotProduct(e)/h;h=f.crossProduct(e)/
h;f=new l.Point2D;l.lerpPoint2D(d[b],d[c],.5,f);g=.5*g/h*l.snap(1-k,0,1);b=d[1].side(d[b],d[c]);c=e.clone();b?c.leftPerpendicularThis():c.rightPerpendicularThis();b=f.sub(c.mul(g));a.constructCircularArcThreePoint(d[0],d[2],b)}return}}0===a.projectionBehavior()?(e=a.getStartXY(),f=a.getEndXY(),d=e.equals(f),g=b.equals(c),d||g?(f=new l.Point2D,a.queryCoord2D(.5,f),g?d?(d=a.m_center.add(b.sub(e)),a.constructEllipticArcEndPointsCenter(b,c,a.getSemiMajorAxis(),1,0,!0,!a.isClockwise(),d),a.setProjectionBehavior(0)):
a.isMajor()?(d=f.sub(b).getUnitVector().mul(2*a.getSemiMajorAxis()).add(b),a.constructCircularArcThreePoint(b,c,d)):a.constructCircularArcThreePoint(b,c,b):(d=b.add(c).mul(.5),e=c.sub(b),e.rightPerpendicularThis(),f=d.add(e),g=l.Point2D.getClosestCoordinate(d,f,a.getCenter(),!0),e=new l.Point2D,l.lerpPoint2D(d,f,g,e),d=l.Point2D.distance(b,e),a.constructEllipticArcEndPointsCenter(b,c,d,1,0,!0,!a.isClockwise(),e),a.setProjectionBehavior(0))):(d=new l.Transformation2D,d.setShiftCoords(-a.m_XStart,-a.m_YStart),
g=l.Point2D.distance(b,c),k=l.Point2D.distance(e,f),h=g/k,d.scale(h,h),e=f.sub(e),e.divThis(k),f=c.sub(b),f.divThis(g),g=e.crossProduct(f),e=f.dotProduct(e),d.rotate(e,g),d.shiftCoords(b.x,b.y),qh(a,d,!0),a.m_XStart=b.x,a.m_YStart=b.y,a.m_XEnd=c.x,a.m_YEnd=c.y)):Zk(a,b,c)}}function $k(a,b,c,d,e,f,g,h,k){a.m_bits=0;a.m_rotation=f;a.m_XStart=b.x;a.m_YStart=b.y;a.m_XEnd=c.x;a.m_YEnd=c.y;a.m_cosr=Math.cos(f);a.m_sinr=Math.sin(f);Fd(a,g);yf(a,h);void 0!==k?a.m_center.assign(k):a.m_center.setNAN();a.setProjectionBehavior(1);
a.m_semiMajorAxis=d;a.m_minorMajorRatio=e;return al(a,void 0===k)}function Tb(a,b,c,d){a.m_bits=0;a.m_rotation=0;a.m_XStart=b.x;a.m_YStart=b.y;a.m_XEnd=c.x;a.m_YEnd=c.y;a.m_interior.assign(b.add(c).mul(.5));a.m_startAngle=0;a.m_sweepAngle=0;a.m_cosr=1;a.m_sinr=0;Fd(a,!1);yf(a,!1);a.m_center.setNAN();a.m_semiMajorAxis=1;a.m_minorMajorRatio=0;a.setProjectionBehavior(d);a.afterCompletedModification()}function Ha(a){return a.m_center.isNAN()}function rh(a,b){if(0===b)return 0;var c=ph(a);const d=mc(a,
b),e=l.halfPi();b=bl(a);c=l.ellipticE(d+e,c.e2,c.completeE);return Math.abs(a.m_semiMajorAxis*(c-b))}function fn(a,b){if(Ha(a))return a=l.Point2D.distance(a.getStartXY(),a.getEndXY()),0===a?0:b/a;if(1===a.m_minorMajorRatio)return a=Math.abs(a.getSweepAngle()*a.m_semiMajorAxis),0===a?0:b/a;if(0===b)return 0;const c=a.getSweepAngle();if(0===c)return.5;const d=ph(a),e=l.halfPi(),f=bl(a);0>c&&(b=-b);b=l.inverseEllipticE(b/a.m_semiMajorAxis+f,d.e2,d.completeE);b=b-e-a.getStartAngle();return b/c}function bl(a){const b=
ph(a);return l.ellipticE(a.getStartAngle()+l.halfPi(),b.e2,b.completeE)}function qh(a,b,c){p.geometryReleaseAssert(0===(a.m_bits&8));if(!b.isIdentity()){a.m_cachedValues=null;var d=l.Point2D.getNAN();d.x=a.m_XStart;d.y=a.m_YStart;b.transformInPlace(d);var e=l.Point2D.getNAN();e.x=a.m_XEnd;e.y=a.m_YEnd;b.transformInPlace(e);if(Ha(a))a.m_XStart=d.x,a.m_YStart=d.y,a.m_XEnd=e.x,a.m_YEnd=e.y;else{var f=a.m_center.clone();b.transformInPlace(f);if(c||b.isUniformNoRotation())if(c=0!==(a.m_bits&1),b.isReflective()&&
(c=!c),0===a.projectionBehavior())if(d.equals(e)){var g=c;b=.5*(f.sub(d).length()+f.sub(e).length());a.m_center.assign(f);a.m_startAngle=Math.atan2(d.y-a.m_center.y,d.x-a.m_center.x);c=Math.atan2(e.y-a.m_center.y,e.x-a.m_center.x);for(var h=!1,k=a.m_startAngle,m=a.m_sweepAngle;k>l.pi();)k-=2*l.pi();for(;k<=-l.pi();)k+=2*l.pi();if(!Number.isNaN(c)){for(;c>l.pi();)c-=2*l.pi();for(;c<=-l.pi();)c+=2*l.pi();!g&&c>k&&(c-=2*l.pi());g&&c<k&&(c+=2*l.pi());m=c-k;1E-12>Math.abs(m)&&!h&&(m=g?2*l.pi():-2*l.pi());
Math.abs(m)>2*l.pi()-1E-12&&h&&(m=0)}Math.abs(m)>2*l.pi()-1E-12&&(m=0<=m?2*l.pi():-2*l.pi(),a.setEndXY(a.getStartXY()));1E-12>Math.abs(m)&&(m=0,a.setEndXY(a.getStartXY()));h=Math.abs(m)<=l.pi();m&&(g=0<m);a.m_startAngle=Yc(k);a.m_sweepAngle=m;Fd(a,!h);yf(a,g);a.constructEllipticArcEndPointsCenter(d,e,b,1,0,Math.abs(a.m_sweepAngle)>Math.PI,0<a.m_sweepAngle,f);a.setProjectionBehavior(0)}else f=a.m_interior.clone(),b.transformInPlace(f),a.constructCircularArcThreePoint(d,e,f);else f=new l.Point2D(a.m_cosr,
a.m_sinr),b.transformWithoutTranslateInPlace(f),f=Math.atan2(f.y,f.x),g=a.getSemiAxes(),b.transformWithoutTranslateInPlace(g),h=a.m_center.clone(),b.transformInPlace(h),a.constructEllipticArcEndPointsCenter(d,e,g.x,g.y/g.x,f,a.isMajor(),c,h);else{g=c=Array(4);m=(new l.ECoordinate(a.m_cosr)).sqrThis();var n=(new l.ECoordinate(a.m_sinr)).sqrThis();const q=new l.ECoordinate(a.m_minorMajorRatio),r=new l.ECoordinate(1/a.m_minorMajorRatio);h=q.mulE(m).addThisE(r.mulE(n));k=q.subE(r).mulThis(2*a.m_cosr*
a.m_sinr);m=q.mulE(n).addThisE(r.mulE(m));g[0]=h;g[1]=k;g[2]=m;g[3]=(new l.ECoordinate(-a.m_semiMajorAxis)).mulThis(a.m_semiMajorAxis).mulThis(a.m_minorMajorRatio);k=new zf;k.a11.setE(c[0]);k.a12.setE(c[1]);k.a12.mulThisByPower2(.5);k.a21.setE(k.a12);k.a22.setE(c[2]);if(!k.det().isZero()&&(g=new zf,g.a11.set(b.xx),g.a12.set(b.xy),g.a21.set(b.yx),g.a22.set(b.yy),g.invertThis()&&(h=g.clone(),h.transposeThis(),k=k.clone(),k.mulThis(g),k.mulLeftThis(h),!k.det().isZero()))){g=l.makeObjectArray(l.ECoordinate,
4);g[0].setE(k.a11);g[1].setE(k.a12);g[1].mulThisByPower2(2);g[2].setE(k.a22);g[3].setE(c[3]);c=l.Point2D.getNAN();m=g;g=c;n=new zf;n.a11.setE(m[0]);n.a12=l.ECoordinate.st_mulByPower2(m[1],.5);n.a21.setE(n.a12);n.a22.setE(m[2]);h=[l.Point2D.getNAN(),l.Point2D.getNAN()];k=[new l.ECoordinate,new l.ECoordinate];n.eigenSymmetric(k,h);m=m[3].clone();m.negateThis();m.invThis();k[0].mulThisE(m);k[1].mulThisE(m);k[0].sqrtThis().invThis();k[1].sqrtThis().invThis();g.x=k[0].toDouble();g.y=k[1].toDouble();g=
Math.atan2(h[0].y,h[0].x);h=0!==(a.m_bits&1);b.isReflective()&&(h=!h);a.constructEllipticArcEndPointsCenter(d,e,c.x,c.y/c.x,g,a.isMajor(),h,f);return}c=[l.Point2D.getNAN(),l.Point2D.getNAN(),l.Point2D.getNAN()];c[0].setCoords(a.getSemiMajorAxis(),0);c[0].rotateDirect(a.m_cosr,a.m_sinr);c[1].setCoords(a.getSemiMajorAxis(),a.getSemiMinorAxis());c[1].rotateDirect(a.m_cosr,a.m_sinr);c[2].setCoords(0,a.getSemiMinorAxis());c[2].rotateDirect(a.m_cosr,a.m_sinr);(g=a.isClockwise())&&(c[2]=l.swap(c[0],c[0]=
c[2]));b.transformWithoutTranslateArray(c,3,c);b.isReflective()&&(g=!g);b=new l.Point2D(0,0);h=a.createInstance();xf(c,.5,b,!1,h);a.constructEllipticArcEndPointsCenter(d,e,h.getSemiMajorAxis(),h.getMinorMajorRatio(),h.getAxisXRotation(),a.isMajor(),!g,f)}}}}function yf(a,b){a.m_bits=a.m_bits&-2|(b?1:0)}function Fd(a,b){a.m_bits=a.m_bits&-3|(b?1:0)<<1}function al(a,b){a.m_bits&=-9;const c=a.getStartXY();var d=a.getEndXY();let e=!1;var f=0!==(a.m_bits&2);const g=0!==(a.m_bits&1);var h=a.projectionBehavior(),
k=c.equals(d),m=0===a.m_minorMajorRatio||0===a.m_semiMajorAxis;Number.isNaN(a.m_minorMajorRatio)&&(0===a.m_semiMajorAxis?a.m_minorMajorRatio=1:p.throwCorruptedGeometryException("NAN minor major ratio and non-zero major axis"));b?m||=k:m||=a.m_center.isNAN();if(m)return Tb(a,c,d,h),!0;a.m_semiMajorAxis=Math.abs(a.m_semiMajorAxis);a.m_minorMajorRatio=Math.abs(a.m_minorMajorRatio);1<a.m_minorMajorRatio&&(a.m_semiMajorAxis*=a.m_minorMajorRatio,a.m_minorMajorRatio=1/a.m_minorMajorRatio);b=new l.Point2D(a.m_semiMajorAxis,
a.m_semiMajorAxis*a.m_minorMajorRatio);if(k){d=a.convertToCanonic(c);d.x/=b.x;d.y/=b.y;h=Math.sqrt(l.sqr(d.x)+l.sqr(d.y));e=1!==h;a.m_semiMajorAxis*=h;b.mulThis(h);a.m_startAngle=Yc(Math.atan2(d.y,d.x));if(!f)return a.m_interior.assign(c),a.m_sweepAngle=0,a.afterCompletedModification(),e;a.m_sweepAngle=g?l.twoPi():-l.twoPi()}else{if(!(k=a.m_center.isNAN()))if(a.m_center.isNAN())k=!1;else{k=new S;k.setWithEps(a.getStartXY(),8);k.subThisE((new S).setWithEps(a.m_center,8));m=new l.ECoordinate;m.setWithEps(a.m_rotation,
8);var n=new l.ECoordinate,q=new l.ECoordinate;l.ECoordinate.st_cosAndSin(m,n,q);k.rotateReverse(n,q);m=new S;m.setWithEps(a.getEndXY());m.subThisE(S.constructPoint2D(a.m_center));m.rotateReverse(n,q);n=new l.ECoordinate;n.setWithEps(a.m_semiMajorAxis,8);q=n.clone();var r=new l.ECoordinate;r.setWithEps(a.m_minorMajorRatio);q.mulThisE(r);k.x.divThisE(n);k.y.divThisE(q);m.x.divThisE(n);m.y.divThisE(q);k=k.x.sqr().addThisE(k.y.sqr()).subThisE(l.s_one);m=m.x.sqr().addThisE(m.y.sqr()).subThisE(l.s_one);
k=!k.isZero()||!m.isZero()}k||(k=a.convertToCanonic(c),k.x/=b.x,k.y/=b.y,m=new l.Point2D(1,0),a.m_startAngle=l.Point2D.calculateAngle(m,k),m=a.convertToCanonic(d),m.x/=b.x,m.y/=b.y,a.m_sweepAngle=l.Point2D.calculateAngle(k,m),k=!cl(a));k&&(e=!0,k=c.sub(d).mulThis(.5),k.rotateReverse(a.m_cosr,a.m_sinr),m=l.sqr(k.x/b.x)+l.sqr(k.y/b.y),1<m&&(m=Math.sqrt(m),a.m_semiMajorAxis*=m,b.mulThis(m)),m=new l.Point2D(0,0),q=b.x*b.x,r=b.y*b.y,n=q*k.y*k.y+r*k.x*k.x,q=q*r-n,0<q&&(n=Math.sqrt(q/n),m.setCoords(b.x*
k.y/b.y,-b.y*k.x/b.x),m.mulThis(n),f===g&&m.negateThis()),f=new l.Point2D(m.x,m.y),f.rotateDirect(a.m_cosr,a.m_sinr),f.addThis(c.add(d).mulThis(.5)),a.m_center.assign(f));oh(a);if(!cl(a))return Tb(a,c,d,h),!0}re(a);a.afterCompletedModification();return e}function jj(a,b){p.geometryReleaseAssert(Math.abs(a.getSweepAngle())<15*Math.PI/16);var c=a.getSemiMajorAxis();const d=a.getSemiMinorAxis();if(0===c)return b[0].setCoordsPoint2D(a.getStartXY()),b[1].setCoordsPoint2D(a.getStartXY()),b[2].setCoordsPoint2D(a.getStartXY()),
1;if(0===d)return b[0].setCoordsPoint2D(a.getStartXY()),b[2].setCoordsPoint2D(a.getEndXY()),b[1]=l.Point2D.lerp(b[0],b[2],.5),1;const e=a.getSweepAngle();var f=a.getStartAngle();const g=f+e;f=new l.Point2D(-c*Math.sin(f),d*Math.cos(f));c=new l.Point2D(-c*Math.sin(g),d*Math.cos(g));f.normalize();c.normalize();f.rotateDirect(a.m_cosr,a.m_sinr);c.rotateDirect(a.m_cosr,a.m_sinr);b[0].setCoordsPoint2D(a.getStartXY());b[2].setCoordsPoint2D(a.getEndXY());b[1].setSub(b[2],b[0]);a=f.crossProduct(c);b[1].assign(f.mul(b[1].crossProduct(c)/
a));b[1].addThis(b[0]);return Math.cos(.5*e)}function xf(a,b,c,d,e){var f=a[0].sub(a[1]);const g=a[2].sub(a[1]);var h=f.crossProduct(g),k=f.dotProduct(g);p.geometryReleaseAssert(1>=b);p.geometryReleaseAssert(0<b);d=.5/(1-b);var m=f.sqrLength(),n=g.sqrLength();h=l.sqr(h);var q=f.sub(g).sqrLength();if(0===h||k<=-(Math.sqrt(m)*Math.sqrt(n)))return Tb(e,a[0],a[2],1),!1;const r=[0,0],t=new l.Envelope1D;t.setInfinite();h=Ac(2*h,-(q/b+4*k),2*(1-b)/b,t,!1,r);if(0===h)return Tb(e,a[0],a[2],1),!1;1===h&&(r[1]=
r[0]);h=Math.sqrt(d/r[0]);q=Math.sqrt(d/r[1]);b=.5/b;n=b-n*r[0];m=b-m*r[0];Math.abs(n)>Math.abs(m)?m=k*r[0]-b+1:n=k*r[0]-b+1;k=f.mul(n).add(g.mul(m));k=k.norm(1)<1E-15*h?0:Math.atan2(k.y,k.x)+Math.PI;f=f.add(g);c=c?c.clone():a[1].add(f.mul(d));d=a[0].sub(c);f=a[2].sub(c);d=0>d.crossProduct(f);new Hb;return e.constructEllipticArcEndPointsCenter(a[0],a[2],h,q/h,k,!1,!d,c)}function cl(a){var b=!1;b=new l.Point2D(a.m_semiMajorAxis*Math.cos(a.m_startAngle),a.getSemiMinorAxis()*Math.sin(a.m_startAngle));
b.rotateDirect(a.m_cosr,a.m_sinr);b.addThis(a.m_center);b=l.Point2D.distance(a.getStartXY(),b)>jc(a);var c=!1;b||(c=new l.Point2D(a.m_semiMajorAxis*Math.cos(a.m_startAngle+a.m_sweepAngle),a.getSemiMinorAxis()*Math.sin(a.m_startAngle+a.m_sweepAngle)),c.rotateDirect(a.m_cosr,a.m_sinr),c.addThis(a.m_center),c=l.Point2D.distance(a.getEndXY(),c)>jc(a));return!b&&!c}function dl(a){if(Ha(a)||a.isDegenerate(0))return 0;var b=a.m_semiMajorAxis;const c=a.getSemiMinorAxis(),d=b*b+c*c,e=a.getStartAngle(),f=a.getEndAngle(),
g=a.m_center.y-a.m_YStart;var h=a.m_cosr;const k=a.m_sinr;let m=1,n=0;a.m_rotation&&(m=(h-k)*(h+k),n=2*h*k);b=((-.5*(f-e)+.5*m*Math.cos(f+e)*Math.sin(f-e))*c+-2*Math.sin(.5*(f+e))*Math.sin(.5*(f-e))*h*g)*b/d;h=0;a.m_rotation&&(h=-.25*Math.sin(f+e)*Math.sin(f-e)*n-c*g/d*2*Math.cos(.5*(f+e))*Math.sin(.5*(f-e))*k);return d*(b+h)+-.5*(a.m_XEnd-a.m_XStart)*(a.m_YEnd-a.m_YStart)}function re(a){a.queryCoord2D(.5,a.m_interior)}function el(a,b,c,d,e){if(e){if(0!==sc(b,c))return 2}else if(zc(b,c))return 1;
return 0!==se(a,b,c,null,null,null,d,void 0===e?!1:e,!0,!1)?4:0}function se(a,b,c,d,e,f,g,h,k,m){if(Ha(b))return a=new Z({start:b.getStartXY(),end:b.getEndXY()}),De(a,c,d,e,f,g,h,m);null!==e&&(e.length=0);null!==f&&(f.length=0);null!==d&&(d.length=0);var n=rb(b,c);g=Math.max(n,g);if(Eb(b,c,g))return 0;var q=c.getStartXY();q.subThis(b.m_center);n=c.getEndXY();n.subThis(b.m_center);q.rotateReverse(b.m_cosr,b.m_sinr);n.rotateReverse(b.m_cosr,b.m_sinr);var r=n.clone();r.subThis(q);n=b.m_semiMajorAxis;
const t=1/n;var u=b.getSemiMinorAxis();const v=1/u;var w=r.clone();w.leftPerpendicularThis();var x=Math.atan2(u*w.y,n*w.x);n=Array(16);u=Array(16);w=0;x=[x,x+Math.PI];for(var y=0;2>y;++y){var z=Ja(b,x[y]);0<=z&&1>=z&&(n[w]=z,z=b.getCoord2D(n[w]),u[w]=c.getClosestCoordinate(z,!1),l.Point2D.distance(z,c.getCoord2D(u[w]))<=g&&w++)}x=q.x*t;y=q.y*v;z=r.x*t;const A=r.y*v;x=Ac(z*z+A*A,2*(x*z+y*A),x*x+y*y-1,l.Envelope1D.unit(),!1,u);p.geometryReleaseAssert(0<=x);for(y=0;y<x;y++)z=r.mul(u[y]).add(q),z.x*=
t,z.y*=v,z=Ja(b,Math.atan2(z.y,z.x)),0<=z&&1>=z&&(n[w]=z,z=b.getCoord2D(z),u[w]=c.getClosestCoordinate(z,!1),l.Point2D.distance(z,c.getCoord2D(u[w]))<=g&&w++);p.geometryReleaseAssert(w<n.length+4);q=Array(16);x=b.intersectPoint(c.getStartXY(),q,g);for(r=0;r<x;r++,w++)n[w]=q[r],u[w]=0;x=b.intersectPoint(c.getEndXY(),q,g);for(r=0;r<x;r++,w++)n[w]=q[r],u[w]=1;x=c.intersectPoint(b.getStartXY(),q,g);for(r=0;r<x;r++,w++)n[w]=0,u[w]=q[r];x=c.intersectPoint(b.getEndXY(),q,g);for(r=0;r<x;r++,w++)n[w]=1,u[w]=
q[r];return 0===w?0:Fb(a,b,c,n,u,w,d,e,f,g,h,k,m)}function fl(a,b,c,d,e,f,g,h,k,m){if(Ha(b)){var n=new Z({start:b.getStartXY(),end:b.getEndXY()});return se(a,c,n,d,f,e,g,h,k,!m)}if(Ha(c))return n=new Z({start:c.getStartXY(),end:c.getEndXY()}),se(a,b,n,d,e,f,g,h,k,m);var q=rb(b,c);g=Math.max(g,q);q=!1;var r=b.getSemiAxes(),t=b.getCenter(),u=c.getSemiAxes(),v=c.getCenter();t=l.Point2D.distance(v,t);v=r.x+u.x;if(t>v+g)return 0;if(r.y>u.x){if(t+u.x+g<r.y)return 0}else if(u.y>r.x&&t+r.x+g<u.y)return 0;
if(k&&!h){var w=1===b.m_minorMajorRatio&&b.isClosed()&&b.isMajor(),x=1===c.m_minorMajorRatio&&c.isClosed()&&c.isMajor();if(w&&x&&(q=!0,t<=v&&Math.max(r.x,u.x)<=Math.min(r.x,u.x)+t))return p.geometryReleaseAssert(!e&&!f),1}if(!q&&Eb(b,c,g))return 0;t=[];v=[];w=td(b,0,0,!1,!1,t,v,null);r=[];u=[];x=td(c,0,0,!1,!1,r,u,null);if(1===w&&1===x){a=new lb({points:t,weights:v});n=new lb({points:r,weights:u});q=[];r=[];d=ce(!1,a,n,d,null===e?null:q,null===f?null:r,g,h,k,m);if(0<d&&null!==e||null!==f)for(e&&(e.length=
0),f&&(f.length=0),g=0;g<d;++g)e&&(l.isOneOf(q[g],0,1)?e.push(q[g]):(h=a.tToLength(q[g]),h=b.lengthToT(h),e.push(h))),f&&(l.isOneOf(r[g],0,1)?f.push(r[g]):(h=n.tToLength(r[g]),h=c.lengthToT(h),f.push(h)));return d}q=[];const y=[];let z=0;const A=k&&!h;for(let B=0;B<w;B++){const E=new lb({points:t.slice(2*B,2*B+3),weights:v.slice(2*B,2*B+3)});let G=0;for(let I=0;I<x;I++){y.length<=I&&y.push(new lb({points:r.slice(2*I,2*I+3),weights:u.slice(2*I,2*I+3)}));const H=[],L=[],M=ce(!1,E,y[I],null,A?null:H,
A?null:L,g,!1,A,!1);if(0<M&&A)return 1;for(let N=0;N<M;++N){if(0===H[N]&&0===B)H[N]=0;else if(1===H[N]&&B===w-1)H[N]=1;else{var C=E.tToLength(H[N])+z;C=b.lengthToT(C);H[N]=C}0===L[N]&&0===I?L[N]=0:1===L[N]&&I===x-1?L[N]=1:(C=y[I].tToLength(L[N])+G,C=c.lengthToT(C),L[N]=C);q.push(l.makePair(H[N],L[N]))}G+=y[I].calculateLength2D()}z+=E.calculateLength2D()}if(0===q.length)return 0;h&&(q=q.filter(B=>l.isOneOf(B.first,0,1)&&l.isOneOf(B.second,0,1)?!b.getCoord2D(B.first).equals(c.getCoord2D(B.second)):
!0));if(k)return q.length;r=[];u=[];for(n of q)r.push(n.first),u.push(n.second);return Fb(a,b,c,r,u,r.length,d,e,f,g,h,k,m)}function gl(a,b,c){c.setCoords(a.getCoord2D(b.vmin));c.mergeNe(a.getCoord2D(b.vmax));if(!Ha(a)){var d=a.getSemiAxes(),e=[0,0,0,0],f=Math.atan2(-d.y*a.m_sinr,d.x*a.m_cosr),g=f+Math.PI;d=Math.atan2(d.y*a.m_cosr,d.x*a.m_sinr);var h=d+Math.PI;e[0]=Ja(a,f);e[1]=Ja(a,g);e[2]=Ja(a,d);e[3]=Ja(a,h);f=new l.Point2D;for(g=0;4>g;g++)d=e[g],b.containsExclusiveCoordinate(d)&&(a.queryCoord2D(d,
f),c.mergeNe(f))}}function hl(a,b,c,d,e){if(0===a.m_semiMajorAxis)return c.vmin;var f=l.Point2D.getNAN();a.queryCoord2D(c.vmin,f);e=l.Point2D.getNAN();a.queryCoord2D(c.vmax,e);if(Ha(a))return(new Z({start:f,end:e})).getClosestCoordinate(b,d);var g=a.convertToCanonic(b);f=a.convertToCanonic(f);e=a.convertToCanonic(e);if(1===a.m_minorMajorRatio){if(g.isEqual(0,0))return c.vmin;a=Ja(a,Math.atan2(g.y,g.x));if(d||c.containsCoordinate(a))return a;a=l.Point2D.distance(g,f);b=l.Point2D.distance(g,e);return a<=
b?c.vmin:c.vmax}var h=a.getSemiMajorAxis(),k=a.getSemiMinorAxis();const m=(h-k)*(h+k);var n=l.sqr(m),q=g.x;const r=g.y;var t=l.sqr(k*r);k=k*m*r*2;n=[new l.ECoordinate(t),new l.ECoordinate(k),new l.ECoordinate(n-l.sqr(h*q)-t),new l.ECoordinate(-k),new l.ECoordinate(-n)];h=l.makeObjectArray(l.ECoordinate,4);q=fi(n,4,new l.Envelope1D(-1,1),!1,h,4);n=c.vmin;f=l.Point2D.sqrDistance(g,f);e=l.Point2D.sqrDistance(g,e);e<f&&(n=c.vmax,f=e);p.geometryReleaseAssert(!d);d=Array(8);for(e=0;e<q;++e)g=h[e].value(),
t=Math.sqrt(1-g*g),k=Math.atan2(g,-t),d[2*e]=Ja(a,Math.atan2(g,t)),d[2*e+1]=Ja(a,k);d=d.slice(0,2*q);l.numericSort(d);for(let u=0,v=2*q;u<v;++u)d[u]>c.vmin&&d[u]<c.vmax&&(e=l.Point2D.sqrDistance(b,a.getCoord2D(d[u])),f>e&&(f=e,n=d[u]));return n}function Zk(a,b,c,d){d=a.getStartXY();var e=a.getEndXY(),f=d.equals(e),g=b.equals(c);f||g?a.isMajor()?f&&g?(d=a.m_center.add(b.sub(d)),a.constructEllipticArcEndPointsCenter(b,c,a.getSemiMajorAxis(),a.getMinorMajorRatio(),a.getAxisXRotation(),!0,!a.isClockwise(),
d)):f?(f=l.Point2D.sqrDistance(b,c),g=l.Point2D.sqrDistance(a.getCoord2D(.25),a.getCoord2D(.75)),e=.25,d=.75,f<g&&(g=new gn(a,f),f=[0],g=qc(g,l.Envelope1D.construct(0,.25),1,f),0<g&&(p.geometryReleaseAssert(1===g),e=f[0],d=1-f[0])),e=a.getCoord2D(e),d=a.getCoord2D(d),p.geometryReleaseAssert(!e.equals(d)),a.constructEllipticArcEndPointsCenter(e,d,a.getSemiMajorAxis(),a.getMinorMajorRatio(),a.getAxisXRotation(),!0,!a.isClockwise(),a.m_center),Zk(a,b,c)):(d=.5*(l.twoPi()-Math.abs(a.getSweepAngle())),
d=(a.getSweepAngle()+d*l.sign(a.getSweepAngle()))/a.getSweepAngle(),e=new l.Point2D,a.queryCoord2D(d,e),a.constructEllipticArcEndPointsCenter(e,e,a.getSemiMajorAxis(),a.getMinorMajorRatio(),a.getAxisXRotation(),!0,!a.isClockwise(),a.getCenter()),d=a.getCenter().add(b.sub(e)),a.constructEllipticArcEndPointsCenter(b,c,a.getSemiMajorAxis(),a.getMinorMajorRatio(),a.getAxisXRotation(),!0,!a.isClockwise(),d)):Tb(a,b,c,1):(f=new l.Transformation2D,f.initializeFromTwoPoints(d,e,b,c),qh(a,f,!0),a.m_XStart=
b.x,a.m_YStart=b.y,a.m_XEnd=c.x,a.m_YEnd=c.y,a.endPointModified(),a.normalizeAfterEndpointChange())}function il(a,b,c){if(262144>=b)return hn(a,b,c);p.geometryReleaseAssert(0);const d=new sh({points:a,n:b});for(var e=1,f=a[0].clone();e<b&&a[e].equals(f);)e++;d.m_treeHull.addElement(0);if(e<b)for(d.m_treeHull.addBiggestElement(e),e+=1;e<b;e++)f=d.treeHull(a[e]),-1!==f&&d.m_treeHull.setElement(f,e);a=0;for(b=d.m_treeHull.getFirst();-1!==b;b=d.m_treeHull.getNext(b))c[a++]=d.m_treeHull.getElement(b);
return a}function jn(a,b,c){var d=b.sub(a);const e=c.sub(b);if(0===d.x)return 0<e.x?-1:0;if(0===d.y)return 0<e.y?1:0>e.y?-1:0;const f=d.crossProduct(e);d=4*Number.EPSILON*(Math.abs(e.x*d.y)+Math.abs(e.y*d.x));return f>d?1:f<-d?-1:l.Point2D.orientationRobust(a,b,c)}function kn(a,b,c){var d=b.sub(a);const e=c.sub(b);if(0===d.x)return 0>e.x?-1:0;if(0===d.y)return 0<e.y?-1:0>e.y?1:0;const f=d.crossProduct(e);d=4*Number.EPSILON*(Math.abs(e.x*d.y)+Math.abs(e.y*d.x));return f>d?1:f<-d?-1:l.Point2D.orientationRobust(a,
b,c)}function hn(a,b,c){const d=new za(0);for(var e=0;e<b;e++)d.add(e);Zb.sortEx(d,0,b,{userSort(m,n,q){q.sort(m,n,(r,t)=>a[r].compareX(a[t]))},getValue(m){return a[m].x}});e=0;a:for(var f=0;f<b;++f){for(var g=d.read(f);2<=e;){var h=c[e-2],k=c[e-1];if(a[k].equals(a[g])){d.write(f,-1);continue a}if(0<=jn(a[h],a[k],a[g]))e--;else{k===d.read(f-1)&&d.write(f-1,-1);break}}c[e++]=g;2===e&&a[g].equals(a[c[0]])&&(d.write(1,-1),e--)}f=e+1;a:for(b-=2;0<=b;--b)if(g=d.read(b),!(0>g)){for(;e>=f;){h=c[e-2];k=c[e-
1];if(a[k].equals(a[g]))continue a;if(0<=kn(a[h],a[k],a[g]))e--;else break}0!==b&&(h=c[e-1],c[e++]=g,a[g].equals(a[h])&&e--)}1<e&&a[c[0]].equals(a[c[e-1]])&&e--;return e}function jl(a){a=a.clone();a.divThis(Math.max(Math.abs(a.x),Math.abs(a.y)));a.normalize();return a}function th(a,b,c){a.inc(b,0)===c&&a.set(b,0,0);a.inc(b,1)===c&&a.set(b,1,0)}function Hc(a,b,c,d,e,f){const g=c.getGeometryType(),h=d.getGeometryType();e=Math.max(e,rb(c,d));if(g===p.GeometryType.enumLine&&h===p.GeometryType.enumLine){a:{a=
0;if(c.m_XStart===d.m_XStart&&c.m_YStart===d.m_YStart||c.m_XStart===d.m_XEnd&&c.m_YStart===d.m_YEnd)if(a++,!f){c=1;break a}if(c.m_XEnd===d.m_XStart&&c.m_YEnd===d.m_YStart||c.m_XEnd===d.m_XEnd&&c.m_YEnd===d.m_YEnd){a++;if(2===a){c=2;break a}if(!f){c=1;break a}}d.isIntersectingPoint(c.getStartXY(),e,!0)||d.isIntersectingPoint(c.getEndXY(),e,!0)||c.isIntersectingPoint(d.getStartXY(),e,!0)||c.isIntersectingPoint(d.getEndXY(),e,!0)?c=4:f&&a?c=0:(f=Ee(c,d.m_XStart,d.m_YStart),a=Ee(c,d.m_XEnd,d.m_YEnd),
0>f&&0>a||0<f&&0<a?c=!1:(f=Ee(d,c.m_XStart,c.m_YStart),a=Ee(d,c.m_XEnd,c.m_YEnd),0>f&&0>a||0<f&&0<a?c=!1:(f=Vf(c),a=Vf(d),c=f>a?Zh(c,d):Zh(d,c))),c=c?4:0)}return c}let k=c,m=d,n=c.getStartXY(),q=c.getEndXY();0<n.compare(q)&&(k=c.clone().reverse());n=d.getStartXY();q=d.getEndXY();0<n.compare(q)&&(m=d.clone().reverse());if(b){if(c.equals(d))return 2;p.geometryReleaseAssert(c.isCurve()||d.isCurve());if(c.getStartXY().equals(d.getStartXY())&&Rd(c,d,0,0,e,2,[0,0],[0,0])||c.getEndXY().equals(d.getEndXY())&&
Rd(c,d,1,1,e,2,[0,0],[0,0])||c.getStartXY().equals(d.getEndXY())&&Rd(c,d,0,1,e,2,[0,0],[0,0])||c.getEndXY().equals(d.getStartXY())&&Rd(c,d,1,0,e,2,[0,0],[0,0]))return 4}switch(g){case p.GeometryType.enumLine:switch(h){case p.GeometryType.enumEllipticArc:return el(a,m,k,e,f);case p.GeometryType.enumBezier:return Ti(a,m,k,e,f);case p.GeometryType.enumRationalBezier2:return Li(a,m,k,e,f);case p.GeometryType.enumBezier2:return p.geometryReleaseAssert(0),0;default:p.throwInternalErrorException("")}break;
case p.GeometryType.enumEllipticArc:switch(h){case p.GeometryType.enumLine:return el(a,k,m,e,f);case p.GeometryType.enumEllipticArc:a:{c=k;d=m;if(f){if(0!==sc(c,d)){c=2;break a}}else if(zc(c,d)){c=1;break a}c=0!==fl(a,c,d,null,null,null,e,void 0===f?!1:f,!0,!1)?4:0}return c;case p.GeometryType.enumBezier:return Ui(a,m,k,e,f);case p.GeometryType.enumRationalBezier2:return p.geometryReleaseAssert(0),0;case p.GeometryType.enumBezier2:return p.geometryReleaseAssert(0),0;default:p.throwInternalErrorException("")}break;
case p.GeometryType.enumBezier:switch(h){case p.GeometryType.enumLine:return Ti(a,k,m,e,f);case p.GeometryType.enumEllipticArc:return Ui(a,k,m,e,f);case p.GeometryType.enumBezier:a:{c=k;d=m;if(f){if(0!==sc(c,d)){c=2;break a}}else if(zc(c,d)){c=1;break a}c=0!==wg(a,c,d,null,null,null,e,void 0===f?!1:f,!0,!1)?4:0}return c;case p.GeometryType.enumRationalBezier2:return Vi(a,k,m,e,f);case p.GeometryType.enumBezier2:return p.geometryReleaseAssert(0),0;default:p.throwInternalErrorException("")}break;case p.GeometryType.enumRationalBezier2:switch(h){case p.GeometryType.enumLine:return Li(a,
k,m,e,f);case p.GeometryType.enumEllipticArc:return p.geometryReleaseAssert(0),0;case p.GeometryType.enumBezier:return Vi(a,m,k,e,f);case p.GeometryType.enumRationalBezier2:return nm(a,k,m,e,f);case p.GeometryType.enumBezier2:return p.geometryReleaseAssert(0),0;default:p.throwInternalErrorException("")}break;case p.GeometryType.enumBezier2:switch(h){case p.GeometryType.enumLine:return p.geometryReleaseAssert(0),0;case p.GeometryType.enumEllipticArc:return p.geometryReleaseAssert(0),0;case p.GeometryType.enumBezier:return p.geometryReleaseAssert(0),
0;case p.GeometryType.enumRationalBezier2:return p.geometryReleaseAssert(0),0;case p.GeometryType.enumBezier2:return p.geometryReleaseAssert(0),0;default:p.throwInternalErrorException("")}break;default:p.throwInternalErrorException("")}}function sc(a,b,c=!0){if(!c&&!kl(a,b))return 0;c=a.isLine()&&b.isLine();if(a.getStartXY().equals(b.getStartXY())&&a.getEndXY().equals(b.getEndXY())){if(c)return 1;c=a.getGeometryType();if(c!==b.getGeometryType())return 0;if(c===p.GeometryType.enumBezier){if(a.getControlPoint1().equals(b.getControlPoint1())&&
a.getControlPoint2().equals(b.getControlPoint2()))return 1}else if(c===p.GeometryType.enumEllipticArc)p.geometryReleaseAssert(0);else if(c===p.GeometryType.enumRationalBezier2){if(a.getControlPoint1().equals(b.getControlPoint1())&&a.getStandardFormWeight()===b.getStandardFormWeight())return 1}else if(c===p.GeometryType.enumBezier2&&a.getControlPoint1().equals(b.getControlPoint1()))return 1;return 0}if(a.getStartXY().equals(b.getEndXY())&&a.getEndXY().equals(b.getStartXY())){if(c)return-1;c=a.getGeometryType();
if(c!==b.getGeometryType())return 0;if(c===p.GeometryType.enumBezier){if(a.getControlPoint1().equals(b.getControlPoint2())&&a.getControlPoint2().equals(b.getControlPoint1()))return-1}else{if(c===p.GeometryType.enumEllipticArc)return p.geometryReleaseAssert(0),-1;if(c===p.GeometryType.enumRationalBezier2){if(a.getControlPoint1().equals(b.getControlPoint1())&&a.getStandardFormWeight()===b.getStandardFormWeight())return-1}else if(c===p.GeometryType.enumBezier2&&a.getControlPoint1().equals(b.getControlPoint1()))return-1}}return 0}
function kl(a,b){const c=a.getGeometryType();return c!==b.getGeometryType()||c===p.GeometryType.enumEllipticArc&&a.projectionBehavior()!==b.projectionBehavior()?!1:!0}function Zc(a,b,c,d,e,f,g){!e&&f&&p.throwInvalidArgumentException("");const h=b.getGeometryType(),k=c.getGeometryType(),m=Math.max(g,rb(b,c));d&&(d.length=0);e&&(e.length=0);f&&(f.length=0);if(h===p.GeometryType.enumLine&&k===p.GeometryType.enumLine)return De(b,c,d,e,f,m,!1,!1);let n=b,q=c,r=b.getStartXY(),t=b.getEndXY(),u=!1;g=!1;0<
r.compare(t)&&(n=b.clone(!0).reverse(),u=!0);r=c.getStartXY();t=c.getEndXY();0<r.compare(t)&&(q=c.clone(!0).reverse(),g=!0);b=0;switch(h){case p.GeometryType.enumLine:switch(k){case p.GeometryType.enumEllipticArc:b=se(a,q,n,d,f,e,m,!1,!1,!0);break;case p.GeometryType.enumBezier:b=he(a,q,n,d,f,e,m,!1,!1,!0);break;case p.GeometryType.enumRationalBezier2:b=nd(a,q,n,d,f,e,m,!1,!1,!0);break;case p.GeometryType.enumBezier2:b=Le(a,q,n,d,f,e,m,!1,!1,!0);break;default:p.throwInternalErrorException("")}break;
case p.GeometryType.enumEllipticArc:switch(k){case p.GeometryType.enumLine:b=se(a,n,q,d,e,f,m,!1,!1,!1);break;case p.GeometryType.enumEllipticArc:b=fl(a,n,q,d,e,f,m,!1,!1,!1);break;case p.GeometryType.enumBezier:b=ug(a,q,n,d,f,e,m,!1,!1,!0);break;case p.GeometryType.enumRationalBezier2:p.geometryReleaseAssert(0);b=0;break;case p.GeometryType.enumBezier2:b=ui(a,q,n,d,f,e,m,!1,!1,!0);break;default:p.throwInternalErrorException("")}break;case p.GeometryType.enumRationalBezier2:switch(k){case p.GeometryType.enumLine:b=
nd(a,n,q,d,e,f,m,!1,!1,!1);break;case p.GeometryType.enumEllipticArc:p.geometryReleaseAssert(0);b=0;break;case p.GeometryType.enumBezier:b=vg(a,q,n,d,f,e,m,!1,!1,!0);break;case p.GeometryType.enumRationalBezier2:b=ce(a,n,q,d,e,f,m,!1,!1,!1);break;case p.GeometryType.enumBezier2:b=Mi(a,n,q,d,e,f,m,!1,!1,!1);break;default:p.throwInternalErrorException("")}break;case p.GeometryType.enumBezier2:switch(k){case p.GeometryType.enumLine:b=Le(a,n,q,d,e,f,m,!1,!1,!1);break;case p.GeometryType.enumEllipticArc:b=
ui(a,n,q,d,e,f,m,!1,!1,!1);break;case p.GeometryType.enumBezier:b=Wi(a,q,n,d,f,e,m,!1,!1,!0);break;case p.GeometryType.enumRationalBezier2:b=Mi(a,q,n,d,f,e,m,!1,!1,!0);break;case p.GeometryType.enumBezier2:b=vi(a,n,q,d,e,f,m,!1,!1,!1);break;default:p.throwInternalErrorException("")}break;case p.GeometryType.enumBezier:switch(k){case p.GeometryType.enumLine:b=he(a,n,q,d,e,f,m,!1,!1,!1);break;case p.GeometryType.enumEllipticArc:b=ug(a,n,q,d,e,f,m,!1,!1,!1);break;case p.GeometryType.enumBezier:b=wg(a,
n,q,d,e,f,m,!1,!1,!1);break;case p.GeometryType.enumRationalBezier2:b=vg(a,n,q,d,e,f,m,!1,!1,!1);break;case p.GeometryType.enumBezier2:b=Wi(a,n,q,d,e,f,m,!1,!1,!1);break;default:p.throwInternalErrorException("")}break;default:p.throwInternalErrorException("")}if(u){if(e){for(a=0;a<b;a++)e[a]=1-e[a];e.reverse()}d&&d.reverse();f&&f.reverse()}if(g&&f)for(d=0;d<b;d++)f[d]=1-f[d];return b}function Af(a,b,c){if(b===c)return 0;b>c&&(c=l.swap(b,b=c));return a.cut(b,c,!0).calculateUpperLength2D()}function ln(a,
b,c,d,e){const f=[],g=[];var h=[];for(let n=0,q=e;n<q;n++)f.push(a.calculateSubLengthFromStart(c[n])),g.push(b.calculateSubLengthFromStart(d[n])),l.isOneOf(c[n],0,1)&&l.isOneOf(d[n],0,1)&&a.getCoord2D(c[n]).equals(b.getCoord2D(d[n]))&&h.push(n);if(0!==h.length&&h.length!==e){h.sort((n,q)=>c[n]<c[q]?-1:c[n]>c[q]?1:d[n]<d[q]?-1:d[n]>d[q]?1:0);var k=-1;for(const n of h)if(0<=k&&c[n]===c[k]&&c[n]===c[k])k=n;else{k=n;h=[];h.length=e;for(var m=0;m<h.length;++m)h[m]=m;h.sort((q,r)=>{var t=f[n];const u=g[n];
var v=f[q]-t;q=g[q]-u;v=v*v+q*q;t=f[r]-t;r=g[r]-u;r=t*t+r*r;return v<r?-1:v>r?1:0});for(m=0;m<e;m++){const q=h[m];if(q===n||c[q]===c[n]&&d[q]===d[n]||l.isOneOf(c[q],0,1)&&l.isOneOf(d[q],0,1))continue;const r=(C,B,E,G)=>{const I=new S,H=new l.ECoordinate;H.setWithEps(1);const L=new l.ECoordinate;L.set(B,H.eps());a.queryCoord2DE(L,I);B=new S;a.queryCoord2DE(new l.ECoordinate(C),B);C=!1;I.eq(B)&&(L.set(G,H.eps()),b.queryCoord2DE(L,I),b.queryCoord2DE(new l.ECoordinate(E),B),C=I.eq(B));return!C},t=l.Point2D.getNAN();
a.queryCoord2D(c[q],t);const u=l.Point2D.getNAN();b.queryCoord2D(d[q],u);if(0===l.Point2D.distance(t,u)&&r(c[n],c[q],d[n],d[q]))break;const v=new l.Envelope1D(d[q],d[n]);v.normalizeNoNAN();const w=new l.Envelope1D(c[q],c[n]);w.normalizeNoNAN();let x=-1,y=Number.POSITIVE_INFINITY,z=Number.POSITIVE_INFINITY,A=c[q];t.assign(a.getCoord2D(A));for(let C=0;5>C;C++){const B=b.getClosestCoordinateOnInterval(t,v,-1);u.assign(b.getCoord2D(B));const E=l.Point2D.distance(t,u);A=a.getClosestCoordinateOnInterval(u,
w,-1);if(A===c[n]&&B===d[n]){x=1;break}t.assign(a.getCoord2D(A));const G=l.Point2D.distance(u,t);if(G<z&&E<y){if(0===G&&0===E){r(c[n],c[q],d[n],d[q])?(c[q]=A,d[q]=B,x=0):x=1;break}z=G;y=E}else{x=0;break}}-1===x&&(x=l.isOneOf(c[q],0,1)||l.isOneOf(d[q],0,1)?0:1);if(1===x)c[q]=c[n],d[q]=d[n];else break}}}}function Fb(a,b,c,d,e,f,g,h,k,m,n,q,r){if(!f)return 0;q=(A,C)=>{for(let B=0;B<f;++B){let E=C[B];if(l.isOneOf(E,0,1)){E=l.normalizeSignedZero(E);continue}const G=A.getCoord2D(E);.5>E?G.equals(A.getStartXY())&&
Af(A,0,E)<=jc(A)&&(C[B]=0):G.equals(A.getEndXY())&&Af(A,E,1)<=jc(A)&&(C[B]=1)}};q(b,d);q(c,e);ln(b,c,d,e,f);q=[];for(let A=0,C=f;A<C;A++)q.push(A);const t=(A,C)=>r?l.standardNumericCompare2(e[A],d[A],e[C],d[C]):l.standardNumericCompare2(d[A],e[A],d[C],e[C]);if(1<q.length){q.sort(t);var u=Math.max(jc(b),jc(c)),v=0;for(let A=1,C=q.length;A<C;A++){var w=d[q[v]],x=d[q[A]],y=e[q[v]],z=e[q[A]];if(w!==x||y!==z)Af(b,w,x)<=u&&Af(c,y,z)<=u&&!(l.isOneOf(w,0,1)&&l.isOneOf(y,0,1)||l.isOneOf(x,0,1)&&l.isOneOf(z,
0,1))?(w=l.Point2D.distance(b.getCoord2D(w),c.getCoord2D(y)),x=l.Point2D.distance(b.getCoord2D(x),c.getCoord2D(z)),w<=x||x<w&&(q[v]=q[A])):(v++,q[v]=q[A])}q.length=v+1;1===q.length&&0!==q[0]&&(d[0]=d[q[0]],e[0]=e[q[0]],q[0]=0);if(2<q.length){u=l.Envelope1D.constructEmpty();v=l.Envelope1D.constructEmpty();u.setCoords(d[q[0]],d[q.at(-1)]);v.setCoords(e[q[0]],e[q.at(-1)]);x=!0;for(let A=1,C=q.length-1;A<C;A++)if(!u.containsCoordinate(d[q[A]])||!v.containsCoordinate(e[q[A]])){x=!1;break}if(x)for(z=[.5,
.2,.7,.1,.3,.4,.6,.8,.9],w=0;w<z.length;w++){y=l.lerp(u.vmin,u.vmax,z[w]);y=b.getCoord2D(y);if(!c.isCloserThanDistance(y,v,m)){x=!1;break}y=l.lerp(v.vmin,v.vmax,z[w]);y=c.getCoord2D(y);if(!b.isCloserThanDistance(y,u,m)){x=!1;break}}x&&(q[1]=q.at(-1),q.length=2)}}1===q.length&&a&&Rd(b,c,d[0],e[0],m,1,[0],[0])&&(q.push(1),d[1]=0,e[1]=0,q.sort(t));if(n&&1===q.length){a=!0;for(let A=0,C=q.length;A<C;A++)if(!l.isOneOf(d[q[A]],0,1)||!l.isOneOf(e[q[A]],0,1)||0!==l.Point2D.distance(b.getCoord2D(d[q[A]]),
c.getCoord2D(e[q[A]]))){a=!1;break}if(a)return 0}c=0;for(let A=0,C=q.length;A<C;A++)h&&h.push(d[q[A]]),k&&k.push(e[q[A]]),g&&(a=l.Point2D.getNAN(),b.queryCoord2D(d[q[A]],a),g.push(a)),c++;return c}function Bf(a,b,c,d,e,f,g,h,k){if(l.isOneOf(c,0,1)&&l.isOneOf(d,0,1)&&0===l.Point2D.distance(a.getCoord2D(c),b.getCoord2D(d))){var m=new S,n=Number.EPSILON;a.queryDerivative(new l.ECoordinate(c,n),m);if(m.isTrueZero()){var q=1===c?-1E-12:1E-12;a.queryDerivative((new l.ECoordinate(c,n)).add(q),m)}1===c&&
m.negateThis();q=new S;b.queryDerivative(new l.ECoordinate(d,n),q);if(q.isTrueZero()){const r=1===c?-1E-12:1E-12;b.queryDerivative((new l.ECoordinate(d,n)).add(r),q)}1===d&&q.negateThis();m.isZero()||m.normalize();q.isZero()||q.normalize();n=m.dotProduct(q);m=m.crossProduct(q);m.scaleError(3);(n=n.ge(l.s_zero))&&!(n=m.isZero())&&(m=Math.abs(m.value()),k?k=.001:(k=a.calculateUpperLength2D(),n=b.calculateUpperLength2D(),k=Math.min(.01*e/Math.min(k,n),1E-10)),n=m<k);if(n)return Sh(a,b,c,d,e,f,g,h)}return 0}
function jd(a,b,c,d,e){var f=-1,g=-1,h=-1,k=-1,m=[0,b],n=[b,0],q=[0,d],r=[d,0];for(var t=0;2>t&&-1===f;++t)for(let w=0;2>w;++w)if(a[m[t]].equals(c[q[w]])){f=m[t];g=n[t];h=q[w];k=r[w];break}if(-1===f)return f=new Va,f.setFromPoints(a,b+1),a=new Va,a.setFromPoints(c,d+1),a.inflate(e),f.isIntersectingW(a)?-1:0;m=Array(b+1);b=il(a,b+1,m);p.geometryReleaseAssert(1<b);n=q=0;for(r=0;r<b;++r)f===m[r]&&(n=r,q++),g===m[r]&&q++;if(2!==q)return-1;g=Array(d+1);d=il(c,d+1,g);p.geometryReleaseAssert(1<d);r=q=0;
for(t=0;t<d;++t)h===g[t]&&(r=t,q++),k===g[t]&&q++;if(2!==q)return-1;q=a[m[(n+b-1)%b]];k=a[m[(n+1)%b]];h=c[g[(r+d-1)%d]];c=c[g[(r+1)%d]];const u=a[f],v=[q,k,h,c];a=[0,1,2,3];a.sort((w,x)=>l.Point2D.compareVectorsOrigin(u,v[w],v[x]));f=a[0];for(d=1;4>d;d++){if(a[d]!==(f+1)%4)return-1;f=a[d]}a=q.sub(u);c=c.sub(u);f=c.dotProduct(a);if(0<f&&(d=c.crossProduct(a),f=Math.abs(Math.atan2(d,f)),a=f*a.length(),c=f*c.length(),a<=e||c<=e))return-1;a=k.sub(u);c=h.sub(u);f=c.dotProduct(a);return 0<f&&(h=c.crossProduct(a),
f=Math.abs(Math.atan2(h,f)),a=f*a.length(),c=f*c.length(),a<=e||c<=e)?-1:1}function ll(a,b,c,d,e){for(p.geometryReleaseAssert(d>>5<e.length);0<=d;d-=2){const f=d&31,g=d>>5,h=.5*(c+b);a>=h?(e[g]|=1<<f,b=h):c=h}}function Bd(){return{majorSemiAxis:0,e2:0,minorSemiAxis:0,flattening:0,isSphere(){return 0===this.e2}}}function oe(){return!!F.peFactory}function uh(a,b,c){p.geometryReleaseAssert(!!F.peFactory||!!$c);return Cf(a,0,null,!1)}function ml(a,b){p.geometryReleaseAssert(!!F.peFactory||!!$c);b=new Sb;
if(oe()){var c=wf(F.peFactory.fromString(F.peDefs.PE_TYPE_COORDSYS,a));c.get()||p.throwInvalidWktException(a);c=Sk(c.release());b.setHorzProj_(c);b.m_vertcs=null;b.m_userWKID=c.getLatestID()}else c=vh(a),b.m_unit=c.isPCS?new ad(c.metersOrRadiansPerUnit):new te(c.metersOrRadiansPerUnit);Df(b.m_precisionDescriptor,c,null,1);b.m_bDefaultDescriptor=!0;b.m_userWKT=a;b.calculateHashCode();b.initDbgName();return b}function nl(a,b,c,d,e=!0){c=null;b&&(p.geometryReleaseAssert(0),c={});b=c;a||p.throwInvalidArgumentException("!PE_coord_sys");
c=new Sb;a=e?Sk(a):new lh(a,!1);Df(c.m_precisionDescriptor,a,b,d);c.m_bDefaultDescriptor=!0;c.setHorzProj_(a);c.m_vertcs=b;c.m_userWKID=a.getLatestID();c.calculateHashCode();c.initDbgName();return c}function mn(a,b,c=!1){3===a.getCoordinateSystemType()&&p.throwInvalidArgumentException("image spatial reference cannot be altered");const d=new Sb;d.m_peCoordSysVal=a.m_peCoordSysVal;d.m_vertcs=a.m_vertcs;d.m_unit=a.m_unit;d.m_precisionDescriptor.assign(b);d.m_localZToXYFactor=a.m_localZToXYFactor;if(Number.isNaN(d.m_precisionDescriptor.m_falseX)||
Number.isNaN(d.m_precisionDescriptor.m_falseY))d.m_precisionDescriptor.m_falseX=a.m_precisionDescriptor.m_falseX,d.m_precisionDescriptor.m_falseY=a.m_precisionDescriptor.m_falseY;d.m_precisionDescriptor.snapPrecision();d.m_precisionDescriptor.fixTolerance();d.m_userWKID=a.m_userWKID;d.m_precisionDescriptor.equals(a.m_precisionDescriptor)?d.m_bDefaultDescriptor=a.m_bDefaultDescriptor:d.m_bDefaultDescriptor=!1;c&&(d.m_bDefaultDescriptor=!0);d.calculateHashCode();d.initDbgName();return d}function wh(a){const b=
a.getCoordinateSystemType();if(1===b)return a;3===b&&p.geometryReleaseAssert(0);return a.getGCS()}function Fk(){if(!xh){const a=Math.trunc(Math.random()*l.intMax()),b=Date.now();xh=`|abba_000|${a.toString(16)}|${b.toString(16)}|`}return xh}function ol(){pl||=Cf(3857,0,null,!0);return pl}function ql(){rl||=Cf(102100,0,null,!0);return rl}function sl(){tl||=Cf(4326,0,null,!0);return tl}function yh(a){a.m_falseX=0;a.m_falseY=0;a.m_unitsXY=1;a.m_falseZ=0;a.m_unitsZ=1;a.m_falseM=0;a.m_unitsM=1;a.m_toleranceXY=
100*l.doubleEps();a.m_toleranceZ=100*l.doubleEps();a.m_toleranceM=100*l.doubleEps();a.m_precision=2}function Df(a,b,c,d){const e=b instanceof lh;yh(a);a.m_precision=d;a.m_falseX=Number.NaN;a.m_falseY=Number.NaN;const f=e?b.m_csType:b.isPCS?2:1;if(1===f){var g=(0===d?1/18E5:1E-9)*(e?b.getOneDegreeGCSUnit():Math.PI/b.metersOrRadiansPerUnit/180);a.m_unitsXY=1/g}else 2===f?(g=(0===d?.001:1E-4)*(e?b.getOneMeterPCSUnit():1/b.metersOrRadiansPerUnit),a.m_unitsXY=1/g):p.throwInvalidArgumentException("unrecognized cs type");
a.m_falseM=-1E5;a.m_unitsM=1/(0===d?.001:1E-4);a.m_unitsM=Math.max(1,a.m_unitsM);a.m_unitsXY=Math.max(1,a.m_unitsXY);let h=g=0;if(0===d||1===d)g=2/a.m_unitsXY,h=2/a.m_unitsM;a.m_toleranceXY=Math.max(g,e?b.getUnitsPerMillimeter():2===f?.001/b.metersOrRadiansPerUnit:.001/(b.semiMajor*b.metersOrRadiansPerUnit));a.m_toleranceM=Math.max(.001,h);ul(a,c)}function ul(a,b){a.m_falseZ=-1E5;if(b){var c=(0===a.m_precision?.001:1E-4)*b.getOneMeter();a.m_unitsZ=1/c}else a.m_unitsZ=1/(0===a.m_precision?.001:1E-4);
a.m_unitsZ=Math.max(1,a.m_unitsZ);c=0;if(0===a.m_precision||1===a.m_precision)c=2/a.m_unitsZ;a.m_toleranceZ=Math.max(b?.001*b.getOneMeter():.001,c)}function vl(a,b,c,d){yh(a);a.m_precision=d;const e=0===d?2147483645n:9007199254740990n;let f=1,g=1,h=.001;b&&(g=b.getUnitToBaseFactor());b&&1===b.getUnitType()?(f=400*Math.PI/180,h=8.983152841195215E-9*Math.PI/180/g):(f=(0===d?.001:1E-4)*Number(e)*.5,h=.001/g);f/=g;a.m_falseX=-f;a.m_falseY=-f;a.m_unitsXY=Number(e)/(2*f);a.m_falseM=-1E5;a.m_unitsM=1/(0===
d?.001:1E-4);a.m_unitsM=Math.max(1,a.m_unitsM);a.snapPrecision();d=b=0;if(0===a.m_precision||1===a.m_precision)d=2/a.m_unitsM,b=2/a.m_unitsXY;a.m_toleranceXY=Math.max(b,h);a.m_toleranceM=Math.max(.001,d);ul(a,c)}function Cf(a,b,c,d){if(!d&&0===b&&!c){if(3857===a)return ol();if(102100===a)return ql();if(4326===a)return sl()}c=new Sb;d=null;if(oe()){0>=a&&p.throwInvalidWkidException(a);var e=kh(a);e||(e=wf(F.peFactory.coordsys(a)),e.get()||p.throwInvalidWkidException(a),e=vf(e.release()),e.getLatestID()!==
a&&mh.set(a,new WeakRef(e)));0<b?d=null:b=0;c.setHorzProj_(e);c.m_vertcs=d}else e=vh(a),c.m_unit=e.isPCS?new ad(e.metersOrRadiansPerUnit):new te(e.metersOrRadiansPerUnit);Df(c.m_precisionDescriptor,e,d,1);c.m_bDefaultDescriptor=!0;c.m_userWKID=a;c.calculateHashCode();c.initDbgName();return c}function Gd(a,b,c){return l.round((a-b)*c)/c+b}function sa(a,b){return a===b||Math.abs(a-b)<=3.552713678800501E-15*(1+(Math.abs(a)+Math.abs(b))/2)}function wf(a){return{_this:a,get(){return this._this},reset(b){this._this=
b},release(){const b=this._this;this._this=null;return b}}}function vh(a){p.geometryReleaseAssert($c);const b=$c(a);if(b.isPCS)a=Number.NaN;else if(F.peFactory&&p.throwInvalidCallException("pe has been loaded. no-pe methods should not be used at this point."),"string"===typeof a)(a=a.match(nn))&&2===a.length||p.throwInvalidArgumentException("bad gcs wkt"),a=Number.parseFloat(a[1]),Number.isFinite(a)||p.throwInvalidArgumentException("bad gcs wkt");else{if(!Hd){Hd=new Map;for(const c in Ef){const d=
Number.parseFloat(c),e=Ef[c];if(Array.isArray(e))for(const f of e)Hd.set(f,d);else Hd.set(e,d)}for(const c in Ef)delete Ef[c]}Hd.has(a)||p.throwInvalidCallException("gcs wkid not found");a=Hd.get(a)}b.semiMajor=a;return b}function on(a){F.peFactory=a.PeFactory;p.geometryReleaseAssert(F.peFactory);wl=a.PeGCSExtent;p.geometryReleaseAssert(wl);F.peLineType=a.PeLineType;p.geometryReleaseAssert(F.peLineType);F.peMath=a.PeMath;p.geometryReleaseAssert(F.peMath);F.PeDoubleClass=a.PeDouble;p.geometryReleaseAssert(F.PeDoubleClass);
F.peDefs=a.PeDefs;p.geometryReleaseAssert(F.peDefs);F.peCSTransformations=a.PeCSTransformations;p.geometryReleaseAssert(F.peCSTransformations);xl=a.PeGTTransformations;p.geometryReleaseAssert(xl);Xa=a.PePCSInfo;p.geometryReleaseAssert(Xa);yl=a.PeGTlistExtended;p.geometryReleaseAssert(yl);F.peFactory.initialize();zl=a.PeGTlistExtendedEntry;p.geometryReleaseAssert(zl);F.peDefs.PE_TYPE_ANGUNIT=512;F.peDefs.PE_STR_AUTH_ALL=2;Xa.PE_POLE_LINE_STRAIGHT=2;Xa.PE_POLE_LINE_CURVED=3;F.peDefs.PE_PARM_LAM0=2;
F.peDefs.PE_PARM_PHI0=6;F.peDefs.PE_PRJ_AZIMUTHAL_EQUIDISTANT=43032;F.peDefs.PE_PRJ_LAMBERT_AZIMUTHAL_EQAREA=43033;F.peDefs.PE_PRJ_ALBERS=43007;F.peDefs.PE_PRJ_CYLINDRICAL_EQAREA=43034;F.peDefs.PE_TYPE_VERTCS=8;F.peDefs.PE_LINETYPE_GEODESIC=0;F.peDefs.PE_LINETYPE_LOXODROME=1;F.peDefs.PE_LINETYPE_GREAT_ELLIPTIC=2;F.peDefs.PE_LINETYPE_NORMAL_SECTION=3;$c=null}function Qk(){return{m_heightMetersPerUnit:0,m_heightSign:0,m_heightZ0:0,m_XYToRadians:0,m_PrimeMeridianDegrees:0,assign(a){this.m_heightMetersPerUnit=
a.m_heightMetersPerUnit;this.m_heightSign=a.m_heightSign;this.m_heightZ0=a.m_heightZ0;this.m_XYToRadians=a.m_XYToRadians;this.m_PrimeMeridianDegrees=a.m_PrimeMeridianDegrees},equals(a){return l.isEqualNonIEEE(this.m_heightSign,a.m_heightSign)&&l.isEqualNonIEEE(this.m_heightMetersPerUnit,a.m_heightMetersPerUnit)&&l.isEqualNonIEEE(this.m_heightZ0,a.m_heightZ0)&&l.isEqualNonIEEE(this.m_XYToRadians,a.m_XYToRadians)&&l.isEqualNonIEEE(this.m_PrimeMeridianDegrees,a.m_PrimeMeridianDegrees)},initFromGcsAndVcsPe(a,
b){this.m_heightSign=1;this.m_heightMetersPerUnit=Number.NaN;this.m_heightZ0=0;this.m_PrimeMeridianDegrees=this.m_XYToRadians=Number.NaN;b&&p.geometryReleaseAssert(0);a&&(this.m_XYToRadians=a.getUnit().getUnitFactor(),this.m_PrimeMeridianDegrees=a.getPrimem().getLongitude())},initFromGcsAndVcs(a,b){a=a?a.getPECoordSys():null;b=b?b.getPEVerticalCoordSys():null;this.initFromGcsAndVcsPe(a,b)},processUnitParams(a){Number.isNaN(this.m_heightMetersPerUnit)&&(this.m_heightMetersPerUnit=a.m_heightMetersPerUnit,
this.m_heightSign=a.m_heightSign,this.m_heightZ0=a.m_heightZ0);Number.isNaN(this.m_XYToRadians)&&(this.m_XYToRadians=a.m_XYToRadians,this.m_PrimeMeridianDegrees=a.m_PrimeMeridianDegrees)}}}class D{static construct(a,b,c,d){return new D(a,b,c,d)}constructor(a,b,c,d){void 0===a?this.ymax=this.xmax=this.ymin=this.xmin=Number.NaN:"number"===typeof a?(this.xmin=a,this.ymin=b,this.xmax=c,this.ymax=d):(this.xmin=a.xmin,this.ymin=a.ymin,this.xmax=a.xmax,this.ymax=a.ymax);this.normalize()}static constructEmpty(){return new D(Number.NaN,
Number.NaN,Number.NaN,Number.NaN)}clone(){return new D(this)}assign(a){this.xmin=a.xmin;this.xmax=a.xmax;this.ymin=a.ymin;this.ymax=a.ymax;return this}width(){return this.xmax-this.xmin}height(){return this.ymax-this.ymin}maxDimension(){return Math.max(this.width(),this.height())}minDimension(){return Math.min(this.width(),this.height())}sqrDiagonal(){p.geometryReleaseAssert(0);return 0}diagonal(){p.geometryReleaseAssert(0);return 0}getCenterX(){return.5*(this.xmin+this.xmax)}getCenterY(){return.5*
(this.ymin+this.ymax)}getCenter(){return l.Point2D.construct(this.getCenterX(),this.getCenterY())}queryCenter(a){p.geometryReleaseAssert(0)}setEmpty(){this.ymax=this.xmax=this.ymin=this.xmin=Number.NaN}setInfinite(){p.geometryReleaseAssert(0)}isDegenerate(a){return!this.isEmpty()&&(this.width()<=a||this.height()<=a)}isZero(){p.geometryReleaseAssert(0);return!1}isEmpty(){return Number.isNaN(this.xmin)||Number.isNaN(this.ymin)||Number.isNaN(this.xmax)||Number.isNaN(this.ymax)}mergeNeCoords(a,b){this.xmin>
a?this.xmin=a:this.xmax<a&&(this.xmax=a);this.ymin>b?this.ymin=b:this.ymax<b&&(this.ymax=b)}mergeNe(a){this.mergeNeCoords(a.x,a.y)}mergeCoords(a,b){this.isEmpty()?(this.xmin=a,this.ymin=b,this.xmax=a,this.ymax=b):(this.xmin>a?this.xmin=a:this.xmax<a&&(this.xmax=a),this.ymin>b?this.ymin=b:this.ymax<b&&(this.ymax=b))}merge(a){this.mergeCoords(a.x,a.y)}mergeEnvelope2D(a){a.isEmpty()||(this.mergeCoords(a.xmin,a.ymin),this.mergeNeCoords(a.xmax,a.ymax))}mergePoints(a,b){for(var c=0;c<b;)if(this.isEmpty())this.setCoords(a[c]),
c++;else{for(;c<b;c++)this.mergeNe(a[c]);break}}mergePointsInterleaved(a,b,c){for(let d=2*b,e=d+2*c;d<e;d+=2)this.mergeCoords(a.read(d),a.read(d+1))}inflateCoords(a,b){this.isEmpty()||(this.xmin-=a,this.xmax+=a,this.ymin-=b,this.ymax+=b,(this.xmin>this.xmax||this.ymin>this.ymax)&&this.setEmpty())}getInflatedCoords(a,b){p.geometryReleaseAssert(0);return new D(0,0,0,0)}inflate(a){this.inflateCoords(a,a)}getInflated(a){p.geometryReleaseAssert(0);return new D(0,0,0,0)}zoom(a,b){p.geometryReleaseAssert(0)}scale(a){p.geometryReleaseAssert(0)}equals(a,
b){return this.isEmpty()&&a.isEmpty()?!0:b?Math.abs(this.xmin-a.xmin)<=b&&Math.abs(this.ymin-a.ymin)<=b&&Math.abs(this.xmax-a.xmax)<=b&&Math.abs(this.ymax-a.ymax)<=b:this.xmin===a.xmin&&this.ymin===a.ymin&&this.xmax===a.xmax&&this.ymax===a.ymax}setCoords(a){void 0!==a.xmin?(this.xmin=a.xmin,this.xmax=a.xmax,this.ymin=a.ymin,this.ymax=a.ymax):void 0!==a.x?(this.xmax=this.xmin=a.x,this.ymax=this.ymin=a.y):void 0!==a.pt1?(this.xmin=a.pt1.x,this.ymin=a.pt1.y,this.xmax=a.pt2.x,this.ymax=a.pt2.y,this.normalize()):
void 0!==a.env2D?(this.xmin=a.env2D.xmin,this.xmax=a.env2D.xmax,this.ymin=a.env2D.ymin,this.ymax=a.env2D.ymax,this.normalize()):void 0!==a.pt?(this.xmax=this.xmin=a.pt.x,this.ymax=this.ymin=a.pt.y):void 0!==a.center?(this.xmin=a.center.x-.5*a.width,this.xmax=this.xmin+a.width,this.ymin=a.center.y-.5*a.height,this.ymax=this.ymin+a.height,this.normalize()):p.geometryReleaseAssert(0);this.normalize()}queryIntervalX(a){this.isEmpty()?a.setEmpty():a.setCoords(this.xmin,this.xmax)}queryIntervalY(a){this.isEmpty()?
a.setEmpty():a.setCoords(this.ymin,this.ymax)}setFromPoints(a,b){if(0===b)this.setEmpty();else if(Array.isArray(a)){this.setCoords(a[0]);for(var c=1;c<b;)if(this.isEmpty())this.setCoords(a[c]),c++;else{for(;c<b;c++)this.mergeNe(a[c]);break}}else{this.setCoords({x:a[0],y:a[1]});for(let d=1,e=2*b;d<e;d+=2)if(this.isEmpty())this.setCoords({x:a[d],y:a[d+1]}),d+=2;else{for(let f=d,g=2*b;f<g;f+=2)this.mergeNeCoords(a[f],a[f+1]);break}}}normalize(){let a=!1;this.xmin<=this.xmax||([this.xmin,this.xmax]=[this.xmax,
this.xmin],a=!0);this.ymin<=this.ymax||([this.ymin,this.ymax]=[this.ymax,this.ymin],a=!0);a&&(this.xmin<=this.xmax&&this.ymin<=this.ymax||this.setEmpty())}isValid(){return this.isEmpty()||this.xmin<=this.xmax&&this.ymin<=this.ymax}getLowerLeft(){return new l.Point2D(this.xmin,this.ymin)}getLowerRight(){return new l.Point2D(this.xmax,this.ymin)}getUpperLeft(){return new l.Point2D(this.xmin,this.ymax)}getUpperRight(){return new l.Point2D(this.xmax,this.ymax)}move(a,b){this.isEmpty()||(this.xmin+=a,
this.ymin+=b,this.xmax+=a,this.ymax+=b)}centerAtCoords(a,b){this.move(a-this.getCenterX(),b-this.getCenterY())}centerAt(a){this.centerAtCoords(a.x,a.y)}containsCoords(a,b){return a>=this.xmin&&a<=this.xmax&&b>=this.ymin&&b<=this.ymax}contains(a){return this.containsCoords(a.x,a.y)}containsEnvelope(a){return a.xmin>=this.xmin&&a.xmax<=this.xmax&&a.ymin>=this.ymin&&a.ymax<=this.ymax}containsExclusiveCoords(a,b){return a>this.xmin&&a<this.xmax&&b>this.ymin&&b<this.ymax}containsExclusive(a){return this.containsExclusiveCoords(a.x,
a.y)}containsExclusiveEnvelope(a){return a.xmin>this.xmin&&a.xmax<this.xmax&&a.ymin>this.ymin&&a.ymax<this.ymax}isIntersecting(a){return(this.xmin<=a.xmin?this.xmax>=a.xmin:a.xmax>=this.xmin)&&(this.ymin<=a.ymin?this.ymax>=a.ymin:a.ymax>=this.ymin)}isIntersectingNe(a){return(this.xmin<=a.xmin?this.xmax>=a.xmin:a.xmax>=this.xmin)&&(this.ymin<=a.ymin?this.ymax>=a.ymin:a.ymax>=this.ymin)}intersect(a){if(this.isEmpty())return!1;if(a.isEmpty())return this.setEmpty(),!1;a.xmin>this.xmin&&(this.xmin=a.xmin);
a.xmax<this.xmax&&(this.xmax=a.xmax);a.ymin>this.ymin&&(this.ymin=a.ymin);a.ymax<this.ymax&&(this.ymax=a.ymax);(a=this.xmin<=this.xmax&&this.ymin<=this.ymax)||this.setEmpty();return a}queryCorner(a){switch(a&3){case 0:return new l.Point2D(this.xmin,this.ymin);case 1:return new l.Point2D(this.xmin,this.ymax);case 2:return new l.Point2D(this.xmax,this.ymax);default:return new l.Point2D(this.xmax,this.ymin)}}queryCorners(a){a[0].setCoords(this.xmin,this.ymin);a[1].setCoords(this.xmin,this.ymax);a[2].setCoords(this.xmax,
this.ymax);a[3].setCoords(this.xmax,this.ymin)}queryCornersReversed(a){a[0].setCoords(this.xmin,this.ymin);a[1].setCoords(this.xmax,this.ymin);a[2].setCoords(this.xmax,this.ymax);a[3].setCoords(this.xmin,this.ymax)}reaspect(a,b){p.geometryReleaseAssert(0)}getArea(){return this.isEmpty()?0:this.width()*this.height()}getLength(){p.geometryReleaseAssert(0);return 0}clipCode(a){return(a.x<this.xmin?1:0)|(a.x>this.xmax?1:0)<<1|(a.y<this.ymin?1:0)<<2|(a.y>this.ymax?1:0)<<3}clipLine(a,b){let c=this.clipCode(a),
d=this.clipCode(b);if(c&d)return 0;if(!(c|d))return 4;const e=(c?1:0)|(d?2:0);do{const f=b.x-a.x,g=b.y-a.y;Math.abs(f)>Math.abs(g)?c&D.XMASK?(c&D.XLESSXMIN?(a.y+=g*(this.xmin-a.x)/f,a.x=this.xmin):(a.y+=g*(this.xmax-a.x)/f,a.x=this.xmax),c=this.clipCode(a)):d&D.XMASK?(d&D.XLESSXMIN?(b.y+=g*(this.xmin-b.x)/f,b.x=this.xmin):(b.y+=g*(this.xmax-b.x)/f,b.x=this.xmax),d=this.clipCode(b)):c?(c&D.YLESSYMIN?(a.x+=f*(this.ymin-a.y)/g,a.y=this.ymin):(a.x+=f*(this.ymax-a.y)/g,a.y=this.ymax),c=this.clipCode(a)):
(d&D.YLESSYMIN?(b.x+=f*(this.ymin-b.y)/g,b.y=this.ymin):(b.x+=f*(this.ymax-b.y)/g,b.y=this.ymax),d=this.clipCode(b)):c&D.YMASK?(c&D.YLESSYMIN?(a.x+=f*(this.ymin-a.y)/g,a.y=this.ymin):(a.x+=f*(this.ymax-a.y)/g,a.y=this.ymax),c=this.clipCode(a)):d&D.YMASK?(d&D.YLESSYMIN?(b.x+=f*(this.ymin-b.y)/g,b.y=this.ymin):(b.x+=f*(this.ymax-b.y)/g,b.y=this.ymax),d=this.clipCode(b)):c?(c&D.XLESSXMIN?(a.y+=g*(this.xmin-a.x)/f,a.x=this.xmin):(a.y+=g*(this.xmax-a.x)/f,a.x=this.xmax),c=this.clipCode(a)):(d&D.XLESSXMIN?
(b.y+=g*(this.xmin-b.x)/f,b.x=this.xmin):(b.y+=g*(this.xmax-b.x)/f,b.x=this.xmax),d=this.clipCode(b));if(c&d)return 0}while(c|d);return e}distanceFromEnvelope(a){return Math.sqrt(this.sqrDistanceEnvelope(a,null,null))}distance(a){return Math.sqrt(this.sqrDistance(a))}sqrDistanceEnvelope(a,b,c){if(!b&&!c){if(this.isEmpty()||a.isEmpty())return Number.NaN;c=b=0;var d=this.xmin-a.xmax;d>b&&(b=d);d=this.ymin-a.ymax;d>c&&(c=d);d=a.xmin-this.xmax;d>b&&(b=d);d=a.ymin-this.ymax;d>c&&(c=d);return b*b+c*c}if(this.isEmpty()||
a.isEmpty())return b&&b.setNAN(),c&&c.setNAN(),Number.NaN;let e=d=0;var f=Math.max(this.xmin,a.xmin);const g=Math.max(this.ymin,a.ymin);b&&b.setCoords(f,g);c&&c.setCoords(f,g);f=this.xmin-a.xmax;f>d&&(d=f,b&&(b.x=this.xmin),c&&(c.x=a.xmax));f=this.ymin-a.ymax;f>e&&(e=f,b&&(b.y=this.ymin),c&&(c.y=a.ymax));f=a.xmin-this.xmax;f>d&&(d=f,b&&(b.x=this.xmax),c&&(c.x=a.xmin));f=a.ymin-this.ymax;f>e&&(e=f,b&&(b.y=this.ymax),c&&(c.y=a.ymin));return d*d+e*e}sqrDistance(a,b){if(void 0===b){if(this.isEmpty()||
a.isNAN())return Number.NaN;var c=b=0;var d=this.xmin-a.x;d>b&&(b=d);d=this.ymin-a.y;d>c&&(c=d);d=a.x-this.xmax;d>b&&(b=d);d=a.y-this.ymax;d>c&&(c=d);return b*b+c*c}if(this.isEmpty()||a.isNAN())return b.setNAN(),Number.NaN;b.assign(a);d=c=0;let e;e=this.xmin-a.x;e>c&&(c=e,b.x=this.xmin);e=this.ymin-a.y;e>d&&(d=e,b.y=this.ymin);e=a.x-this.xmax;e>c&&(c=e,b.x=this.xmax);e=a.y-this.ymax;e>d&&(d=e,b.y=this.ymax);return c*c+d*d}sqrMaxMinDistanceEnvelope(a){if(this.isEmpty()||a.isEmpty())return Number.NaN;
let b=Number.MAX_VALUE;var c=l.Point2D.sqrDistanceCoords(this.xmin,this.ymin,a.xmax,a.ymin),d=l.Point2D.sqrDistanceCoords(this.xmin,this.ymin,a.xmax,a.ymax),e=l.Point2D.sqrDistanceCoords(this.xmin,this.ymax,a.xmax,a.ymin),f=l.Point2D.sqrDistanceCoords(this.xmin,this.ymax,a.xmax,a.ymax);b=Math.min(Math.max(Math.max(c,d),Math.max(e,f)),b);c=l.Point2D.sqrDistanceCoords(this.xmin,this.ymin,a.xmin,a.ymax);d=l.Point2D.sqrDistanceCoords(this.xmin,this.ymin,a.xmax,a.ymax);e=l.Point2D.sqrDistanceCoords(this.xmax,
this.ymin,a.xmin,a.ymax);f=l.Point2D.sqrDistanceCoords(this.xmax,this.ymin,a.xmax,a.ymax);b=Math.min(Math.max(Math.max(c,d),Math.max(e,f)),b);c=l.Point2D.sqrDistanceCoords(this.xmax,this.ymin,a.xmin,a.ymin);d=l.Point2D.sqrDistanceCoords(this.xmax,this.ymin,a.xmin,a.ymax);e=l.Point2D.sqrDistanceCoords(this.xmax,this.ymax,a.xmin,a.ymin);f=l.Point2D.sqrDistanceCoords(this.xmax,this.ymax,a.xmin,a.ymax);b=Math.min(Math.max(Math.max(c,d),Math.max(e,f)),b);c=l.Point2D.sqrDistanceCoords(this.xmin,this.ymax,
a.xmin,a.ymin);d=l.Point2D.sqrDistanceCoords(this.xmin,this.ymax,a.xmax,a.ymin);e=l.Point2D.sqrDistanceCoords(this.xmax,this.ymax,a.xmin,a.ymin);a=l.Point2D.sqrDistanceCoords(this.xmax,this.ymax,a.xmax,a.ymin);return b=Math.min(Math.max(Math.max(c,d),Math.max(e,a)),b)}sqrMaxDistanceEnvelope(a){if(this.isEmpty()||a.isEmpty())return Number.NaN;let b=0;const c=l.makeObjectArray(l.Point2D,4);this.queryCorners(c);const d=l.makeObjectArray(l.Point2D,4);a.queryCorners(d);for(a=0;4>a;a++)for(let e=0;4>e;e++){const f=
l.Point2D.sqrDistance(c[a],d[e]);f>b&&(b=f)}return b}sqrMaxMinDistance(a){var b=l.Point2D.sqrDistance(a,this.getLowerLeft());const c=l.Point2D.sqrDistance(a,this.getUpperLeft()),d=l.Point2D.sqrDistance(a,this.getLowerRight());a=l.Point2D.sqrDistance(a,this.getUpperRight());let e=Math.max(b,c);b=Math.max(b,d);e>b&&(e=b);b=Math.max(c,a);e>b&&(e=b);b=Math.max(d,a);e>b&&(e=b);return e}sqrMinDistance(a){p.geometryReleaseAssert(0);return 0}sqrMaxDistance(a){p.geometryReleaseAssert(0);return 0}snapToBoundary(a){p.geometryReleaseAssert(0);
return!1}snapClip(a){const b=l.snap(a.x,this.xmin,this.xmax);a=l.snap(a.y,this.ymin,this.ymax);return l.Point2D.construct(b,a)}boundaryDistance(a){p.geometryReleaseAssert(0);return 0}envelopeSide(a){p.geometryReleaseAssert(0);return 0}querySide(a,b){switch(a){case 0:b.constructFromCoords(this.xmin,this.ymin,this.xmin,this.ymax);break;case 1:b.constructFromCoords(this.xmin,this.ymax,this.xmax,this.ymax);break;case 2:b.constructFromCoords(this.xmax,this.ymax,this.xmax,this.ymin);break;case 3:b.constructFromCoords(this.xmax,
this.ymin,this.xmin,this.ymin);break;default:p.throwInvalidArgumentException("query_side")}return b}isPointOnBoundary(a,b){p.geometryReleaseAssert(0);return!1}calculateToleranceFromEnvelope(){return this.isEmpty()?l.geomEpsFactor():(Math.abs(this.xmin)+Math.abs(this.xmax)+Math.abs(this.ymin)+Math.abs(this.ymax)+1)*l.geomEpsFactor()}notEquals(a){p.geometryReleaseAssert(0);return!1}toString(){return`[${this.xmin}, ${this.ymin}, ${this.xmax}, ${this.ymax}]`}}D.XLESSXMIN=1;D.YLESSYMIN=4;D.XMASK=3;D.YMASK=
12;class ub{static constructEmpty(){return new ub(Number.NaN,Number.NaN,Number.NaN,Number.NaN,Number.NaN,Number.NaN)}constructor(a,b,c,d,e,f){this.xmin=a;this.ymin=b;this.zmin=c;this.xmax=d;this.ymax=e;this.zmax=f;this.normalize()}inflate(a){this.inflateCoords(a,a,a)}inflateCoords(a,b,c){p.geometryReleaseAssert(0)}getEnvelope2D(){return new D(this.xmin,this.ymin,this.xmax,this.ymax)}getEnvelopeZs(){return new l.Envelope1D(this.zmin,this.zmax)}setEmptyZ(){this.zmax=this.zmin=Number.NaN}normalize(){let a=
!1;this.xmin<=this.xmax||(this.xmax=l.swap(this.xmin,this.xmin=this.xmax),a=!0);this.ymin<=this.ymax||(this.ymax=l.swap(this.ymin,this.ymin=this.ymax),a=!0);!a||this.xmin<=this.xmax&&this.ymin<=this.ymax?this.zmin<=this.zmax||(this.zmax=l.swap(this.zmin,this.zmin=this.zmax),this.zmin<=this.zmax||this.setEmptyZ()):this.setEmpty()}isEmpty(){return Number.isNaN(this.xmin)||Number.isNaN(this.ymin)||Number.isNaN(this.xmax)||Number.isNaN(this.ymax)}isEmptyZ(){return Number.isNaN(this.zmin)||Number.isNaN(this.zmax)}setEmpty(){this.zmax=
this.ymax=this.xmax=this.zmin=this.ymin=this.xmin=Number.NaN}mergeEnv3D(a){a.isEmpty()||(this.mergeCoords(a.xmin,a.ymin,a.zmin),this.mergeCoords(a.xmax,a.ymax,a.zmax))}mergeNe(a){this.mergeNeCoords(a.x,a.y,a.z)}mergeNeCoords(a,b,c){this.xmin>a?this.xmin=a:this.xmax<a&&(this.xmax=a);this.ymin>b?this.ymin=b:this.ymax<b&&(this.ymax=b);this.zmin>c?this.zmin=c:this.zmax<c&&(this.zmax=c)}mergeCoords(a,b,c){this.isEmpty()?(this.xmax=this.xmin=a,this.ymax=this.ymin=b,this.zmax=this.zmin=c):(this.isEmptyZ()&&
(this.zmax=this.zmin=c),this.mergeNeCoords(a,b,c))}setCoords(a,b,c,d,e,f){this.xmin=a;this.ymin=b;this.zmin=c;this.xmax=d;this.ymax=e;this.zmax=f;this.normalize()}sqrDistance(a,b){p.geometryReleaseAssert(0);return 0}sqrDistanceAndPoint(a,b,c){p.geometryReleaseAssert(0);return 0}sqrDistanceEnvelope3D(a,b){p.geometryReleaseAssert(0);return 0}sqrDistanceEnvelope3DAndPoints(a,b,c,d){p.geometryReleaseAssert(0);return 0}sqrMaxDistance(a,b){p.geometryReleaseAssert(0);return 0}}const Al=[0,0,Number.NaN,0,
0,0,0,0,-1,-1,0,0,0,0],pn=[2,1,1,1,3,1,2,3,2,4,1,1,2,1],qn=[1,1,1,0,2,1,1,1,0,0,0,0,0,1],rn=[1,1,1,2,0,0,0,0,2,2,4,2,2,1],sn=[4,8,4,8,1];let K=class a{getAttributeCount(){return this.m_attributeCount}getSemantics(b){return this.m_indexToSemantics[b]}getSemanticsBitArray(){return this.m_semanticsBitArray}getAttributeIndex(b){return this.m_semanticsToIndexMap[b]}static getInterpolation(b){return qn[b]}static getPersistence(b){return rn[b]}static getPersistenceSize(b){return sn[b]}static getPersistenceSizeFromSemantics(b){return a.getPersistenceSize(a.getPersistence(b))*
a.getComponentCount(b)}static getComponentCount(b){return pn[b]}static maxComponentCount(){return 4}static isInteger(b){return 2===b||3===b||4===b}static isIntegerSemantics(b){return a.isInteger(a.getPersistence(b))}static isTexture(b){return 5===b||6===b||7===b}hasAttribute(b){return 0!==(this.m_semanticsBitArray&1<<b)}hasAttributesFrom(b){return(this.m_semanticsBitArray&b.m_semanticsBitArray)===b.m_semanticsBitArray}hasZ(){return this.hasAttribute(1)}hasM(){return this.hasAttribute(2)}hasID(){return this.hasAttribute(3)}getTotalComponentCount(){return this.m_totalComponentCount}static getDefaultValue(b){return Al[b]}static isDefaultValue(b,
c){return l.isEqualNonIEEE(Al[b],c)}equals(b){return this===b}getDefaultPointAttributes(){return this.m_defaultPointAttributes}getPointAttributeOffset(b){return this.m_pointAttributeOffsets[b]}constructor(b){this.m_semanticsBitArray=b;this.m_totalComponentCount=this.m_attributeCount=0;this.m_semanticsToIndexMap=new Int32Array(14);this.m_indexToSemantics=new Int32Array(14);this.m_pointAttributeOffsets=new Int32Array(14);this.m_defaultPointAttributes=Array(25);this.m_semanticsToIndexMap.fill(-1);this.m_indexToSemantics.fill(-1);
let c=0;var d=1;let e=14;for(;c<e;c++)b&d&&(this.m_semanticsToIndexMap[c]=this.m_attributeCount,this.m_indexToSemantics[this.m_attributeCount]=c,this.m_attributeCount++,this.m_totalComponentCount+=a.getComponentCount(c)),d<<=1;c=b=0;for(e=this.getAttributeCount();c<e;c++){var f=this.getSemantics(c);d=a.getComponentCount(f);f=a.getDefaultValue(f);this.m_pointAttributeOffsets[c]=b;for(let g=0;g<d;g++)this.m_defaultPointAttributes[b]=f,b++}}};class dd{static getInstance(){return dd.s_thisInstance}constructor(){this.m_map=
new Map;this.m_vd2D=new K(1);this.m_map.set(1,this.m_vd2D);this.m_vd3D=new K(3);this.m_map.set(3,this.m_vd2D)}GetVD2D(){return this.m_vd2D}GetVD3D(){return this.m_vd3D}FindOrAdd(a){if(1===a)return this.GetVD2D();if(3===a)return this.GetVD3D();var b=this.m_map.get(a);if(b)return b;b=new K(a);this.m_map.set(a,b);return b}}dd.s_thisInstance=new dd;class X{static construct(a,b,c){return new X(a,b,c)}constructor(a,b,c){void 0===a?this.x=this.y=this.z=Number.NaN:(this.x=a,this.y=b,this.z=c)}get 0(){return this.x}get 1(){return this.y}get 2(){return this.z}set 0(a){this.x=
a}set 1(a){this.y=a}set 2(a){this.z=a}clone(){return new X(this.x,this.y,this.z)}assign(a){this.x=a.x;this.y=a.y;this.z=a.z;return this}setCoords(a,b,c){this.x=a;this.y=b;this.z=c;return this}setCoordsPoint2DZ(a,b){return this.setCoords(a.x,a.y,b)}setCoordsPoint3D(a){this.x=a.x;this.y=a.y;this.z=a.z}setZero(){this.z=this.y=this.x=0}setNormalized(a){this.assign(a);this.normalizeThis()}normalizeThis(){const a=this.length();a?(this.x/=a,this.y/=a,this.z/=a):(this.x=1,this.z=this.y=0);return this}getUnitVector(){const a=
new X;a.setNormalized(this);return a}sqrLength(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}lengthXY(){p.geometryReleaseAssert(0);return 0}static sqrDistance(a,b){return l.sqr(a.x-b.x)+l.sqr(a.y-b.y)+l.sqr(a.z-b.z)}static sqrDistanceCoords(a,b,c,d,e,f){p.geometryReleaseAssert(0);return 0}static distance(a,b){return Math.sqrt(X.sqrDistance(a,b))}isEqual(a,b){void 0===b&&(b=0);return Math.abs(this.x-a.x)<=b&&Math.abs(this.y-
a.y)<=b&&l.isEqualNonIEEETol(this.z,a.z,b)}static compareByLength(a,b,c,d){p.geometryReleaseAssert(0);return 0}isEqualCoords(a,b,c,d){p.geometryReleaseAssert(0);return this.x===a&&this.y===b&&this.z===c}isEqualsTols(a,b,c){p.geometryReleaseAssert(0);return!1}isEqualCoordsTols(a,b,c,d,e){p.geometryReleaseAssert(0);return!1}static st_isEqual(a,b,c,d){p.geometryReleaseAssert(0);return!1}equals(a,b){p.geometryReleaseAssert(0);return!1}equalsTols(a,b,c){p.geometryReleaseAssert(0);return!1}divThis(a){this.x/=
a;this.y/=a;this.z/=a;return this}subThis(a){this.x-=a.x;this.y-=a.y;this.z-=a.z;return this}setSub(a,b){this.x=a.x-b.x;this.y=a.y-b.y;this.z=a.z-b.z;return this}sub(a){return X.construct(this.x-a.x,this.y-a.y,this.z-a.z)}addThis(a){this.x+=a.x;this.y+=a.y;this.z+=a.z;return this}add(a){return this.clone().addThis(a)}setAdd(a,b){this.x=a.x+b.x;this.y=a.y+b.y;this.z=a.z+b.z;return this}mul(a){return X.construct(this.x*a,this.y*a,this.z*a)}dotProduct(a){return this.x*a.x+this.y*a.y+this.z*a.z}crossProductVector(a){return new X(this.y*
a.z-a.y*this.z,a.x*this.z-this.x*a.z,this.x*a.y-a.x*this.y)}setCrossProductVector(a,b){const c=b.x*a.z-a.x*b.z,d=a.x*b.y-b.x*a.y;this.x=a.y*b.z-b.y*a.z;this.y=c;this.z=d;return this}setScaled(a,b){this.x=a*b.x;this.y=a*b.y;this.z=a*b.z;return this}scaleThis(a){this.x*=a;this.y*=a;this.z*=a;return this}scaleZThis(a){this.z*=a;return this}setNAN(){p.geometryReleaseAssert(0);return this}isNAN(){return Number.isNaN(this.x)||Number.isNaN(this.y)||Number.isNaN(this.z)}static getNAN(){return X.construct(Number.NaN,
Number.NaN,Number.NaN)}isFinite(){p.geometryReleaseAssert(0);return!1}isZero(){return 0===this.x&&0===this.y&&0===this.z}norm(a){p.geometryReleaseAssert(0);return 0}sqrDistanceFromCenterToSpheroidSurface(a,b){p.geometryReleaseAssert(0);return 0}distanceFromCenterToSpheroidSurface(a,b){return Math.sqrt(this.sqrDistanceFromCenterToSpheroidSurface(a,b))}static getClosestCoordinate(a,b,c,d){p.geometryReleaseAssert(0);return 0}compare(a){p.geometryReleaseAssert(0);return 0}compareXYZ(a){p.geometryReleaseAssert(0);
return 0}negateThis(){this.x=-this.x;this.y=-this.y;this.z=-this.z}static averageFast(a,b){p.geometryReleaseAssert(0);return{}}static average(a,b){p.geometryReleaseAssert(0);return{}}static size(){return X.dimensions}static lerp(a,b,c){const d=new X;l.lerpPoint3D(a,b,c,d);return d}static slerp(a,b,c){p.geometryReleaseAssert(0);return{}}static compareVectors(a,b){p.geometryReleaseAssert(0);return 0}static selectRightHandedBasisFromNormal(a,b,c){a=a.getUnitVector();const d=a.createAPerpendicular(),
e=new X;e.setCrossProductVector(a,d);e.normalizeThis();b.setCoordsPoint3D(d);c.setCoordsPoint3D(e)}createAPerpendicular(){var a=[this.crossProductVector(new X(0,0,1)),this.crossProductVector(new X(1,0,0)),this.crossProductVector(new X(0,1,0))];const b=[a[0].sqrLength(),a[1].sqrLength(),a[2].sqrLength()],c=b.reduce((d,e,f)=>b[d]>b[f]?d:f,0);a=a[c];a.normalizeThis();return a}calculateAngle(a){p.geometryReleaseAssert(0);return 0}static crossDotSign(a,b,c){p.geometryReleaseAssert(0);return 0}static isBisectorRobust(a,
b,c){p.geometryReleaseAssert(0);return 0}static compareZOrder(a,b){p.geometryReleaseAssert(0);return!1}}X.dimensions=3;class Y{constructor(a){this.m_description=null;this.y=this.x=Number.NaN;this.m_attribs=null;a?a.copy?a.copy.copyTo(this):a.move?(this.m_description=a.move.m_description,a.move.m_description=null,this.m_attribs=a.move.m_attribs,a.move.m_attribs=null,this.x=a.move.x,this.y=a.move.y):a.vd?(this.m_description=a.vd,a.attribBuffer?(this.m_attribs=a.attribBuffer,a.initDefaultValues&&this.setDefaultAttributeValues()):
this.ensureAttributes()):a.pt?(this.m_description=cb(),this.setXY(a.pt)):"x"in a&&("z"in a?(this.m_description=Kd(),this.ensureAttributes(),this.setXYZ(new X(a.x,a.y,a.z))):(this.m_description=cb(),this.setXYCoords(a.x,a.y))):this.m_description=cb()}assignCopy(a){this.m_attribs=null;a.copyTo(this);return this}assignMove(a){p.geometryReleaseAssert(0);return this}vertexCount(){p.geometryReleaseAssert(0);return 1}getXY(){return new l.Point2D(this.x,this.y)}setXY(a){this.x=a.x;this.y=a.y}setXYCoords(a,
b){this.x=a;this.y=b}getXYZ(){const a=new X;a.x=this.x;a.y=this.y;a.z=this.getZ();return a}setXYZ(a){this.addAttribute(1);this.x=a.x;this.y=a.y;this.m_attribs[0]=a.z}getX(){return this.x}setX(a){this.x=a}getY(){return this.y}setY(a){this.y=a}getZ(){return this.m_description.hasZ()?this.m_attribs[0]:K.getDefaultValue(1)}setZ(a){this.addAttribute(1);this.m_attribs[0]=a}getM(){return this.getAttributeAsDbl(2,0)}setM(a){this.addAttribute(2);this.m_description.hasZ()?this.m_attribs[1]=a:this.m_attribs[0]=
a}getID(){return this.getAttributeAsInt(3,0)}setID(a){this.setAttributeBasic(3,0,a)}isEqualXY(a,b){p.geometryReleaseAssert(0);return!1}isEqualXYCoords(a,b,c){void 0===c&&(c=0);return Math.abs(a-this.x)<=c&&Math.abs(b-this.y)<=c}getAttributeAsDbl(a,b){if(0===a){if(0===b)return this.x;if(1===b)return this.y;p.throwOutOfRangeException("")}var c=K.getComponentCount(a);(0>b||b>=c)&&p.throwOutOfRangeException("");c=this.m_description.getAttributeIndex(a);return 0<=c?this.m_attribs[this.m_description.getPointAttributeOffset(c)-
2+b]:K.getDefaultValue(a)}getAttributeAsInt(a,b){return Math.trunc(this.getAttributeAsDbl(a,b))}setAttributeBasic(a,b,c){if(0===a)0===b?this.x=c:1===b?this.y=c:p.throwOutOfRangeException("");else{var d=K.getComponentCount(a);(0>b||b>=d)&&p.throwOutOfRangeException("");d=this.m_description.getAttributeIndex(a);0>d&&(this.addAttribute(a),d=this.m_description.getAttributeIndex(a));this.m_attribs[this.m_description.getPointAttributeOffset(d)-2+b]=c}}copyAttributesFrom(a,b){p.geometryReleaseAssert(0)}getAttributeArray(){return this.m_attribs}getDescription(){return this.m_description}assignVertexDescription(a){this.m_description!==
a&&this.assignVertexDescriptionImpl(a)}mergeVertexDescription(a){p.geometryReleaseAssert(0)}hasAttribute(a){return this.m_description.hasAttribute(a)}addAttribute(a){this.m_description.hasAttribute(a)||(a=Jd(this.m_description,a),this.assignVertexDescription(a))}dropAttribute(a){p.geometryReleaseAssert(0)}dropAllAttributes(){const a=cb();a!==this.m_description&&this.assignVertexDescription(a)}getGeometryType(){return p.GeometryType.enumPoint}getDimension(){return 0}queryEnvelope(a){if(a instanceof
Ya)a.setEmpty(),a.assignVertexDescription(this.m_description),a.merge(this);else if(a instanceof ub)if(this.isEmpty())a.setEmpty();else{var b=this.getXYZ();a.xmin=b.x;a.ymin=b.y;a.zmin=b.z;a.xmax=b.x;a.ymax=b.y;a.zmax=b.z}else this.isEmpty()?a.setEmpty():(a.xmin=this.x,a.ymin=this.y,a.xmax=this.x,a.ymax=this.y)}queryLooseEnvelope(a){this.queryEnvelope(a)}queryInterval(a,b){const c=new l.Envelope1D;if(this.isEmpty())return c.setEmpty(),c;a=this.getAttributeAsDbl(a,b);c.vmin=a;c.vmax=a;return c}applyTransformation(a){if(!this.isEmpty())if(a instanceof
l.Transformation2D){const b=this.getXY();a.transformInPlace(b);this.setXY(b)}else p.geometryReleaseAssert(0)}transformAttribute(a,b,c,d,e){p.geometryReleaseAssert(0)}createInstance(){return new Y({vd:this.m_description})}copyTo(a){this!==a&&(a.getGeometryType()!==p.GeometryType.enumPoint&&p.throwInvalidArgumentException(),a.x=this.x,a.y=this.y,this.m_attribs?(a.assignVertexDescription(this.m_description),a.m_attribs=this.m_attribs.slice()):(a.releaseAttributes(),a.assignVertexDescription(this.m_description)))}isEmpty(){return Number.isNaN(this.x)||
Number.isNaN(this.y)}setEmpty(){this.m_description||(this.m_description=cb(),this.releaseAttributes());this.y=this.x=Number.NaN;this.m_attribs&&l.memcpy(this.m_attribs,this.m_description.getDefaultPointAttributes(),0,2,this.m_description.getTotalComponentCount()-2)}calculateArea2D(){return 0}calculateLength2D(){return 0}calculateLength3D(a){return 0}equals(a,b){if(a===this)return!0;if(a.getGeometryType()!==p.GeometryType.enumPoint||this.m_description!==a.m_description||this.isEmpty()!==a.isEmpty())return!1;
if(this.isEmpty())return!0;void 0===b&&(b=0);if(Math.abs(this.x-a.x)>b||Math.abs(this.y-a.y)>b)return!1;for(let c=0,d=this.m_description.getTotalComponentCount()-2;c<d;c++)if(!l.isEqualNonIEEETol(this.m_attribs[c],a.m_attribs[c],b))return!1;return!0}getBoundary(){return null}clone(){const a=new Y({vd:this.m_description});this.copyTo(a);return a}swap(a){p.geometryReleaseAssert(0)}replaceNaNs(a,b){p.geometryReleaseAssert(0)}lerp(a,b,c){p.geometryReleaseAssert(0);return new Y({x:0,y:0})}setDefaultAttributeValues(){const a=
this.m_description.getTotalComponentCount()-2;0<a&&(this.m_attribs?l.memcpy(this.m_attribs,this.m_description.getDefaultPointAttributes(),0,2,a):this.m_attribs=this.m_description.getDefaultPointAttributes().slice(2))}static sqrDistance2D(a,b){p.geometryReleaseAssert(0);return 0}getImpl(){return this}hasNonLinearSegments(){p.geometryReleaseAssert(0);return!1}mergeVertexDescriptionImpl(a){p.geometryReleaseAssert(0)}releaseAttributes(){this.m_attribs=null}assignVertexDescriptionImpl(a){this.m_description||
(this.m_description=cb());const b=Array(14);ye(a,this.m_description,b);let c=null;0<a.getTotalComponentCount()-2&&(c=a.getDefaultPointAttributes().slice(2));for(let e=1,f=a.getAttributeCount();e<f;e++){var d=b[e];if(-1!==d){d=this.m_description.getPointAttributeOffset(d)-2;const g=a.getPointAttributeOffset(e)-2,h=K.getComponentCount(a.getSemantics(e));for(let k=0;k<h;k++)c[g+k]=this.m_attribs[d+k]}}this.m_attribs=c;this.m_description=a}ensureAttributes(){0<this.m_description.getTotalComponentCount()-
2&&null===this.m_attribs&&(this.m_attribs=this.m_description.getDefaultPointAttributes().slice(2))}queryValues(a,b){}copyCommonAttributesTo(a){a.x=this.x;a.y=this.y;const b=a.getDescription();if(b===this.m_description)this.m_attribs&&l.memcpy(a.m_attribs,this.m_attribs,0,0,this.m_description.getTotalComponentCount()-2);else{let d=0;for(let e=1,f=b.getAttributeCount();e<f;e++){var c=b.getSemantics(e);let g=K.getComponentCount(c);if(this.m_description.hasAttribute(c))for(c=this.m_description.getPointAttributeOffset(this.m_description.getAttributeIndex(c))-
2;0!==g;)a.m_attribs[d++]=this.m_attribs[c++],g--;else for(c=K.getDefaultValue(c);0!==g;)a.m_attribs[d++]=c,g--}}}setValues(a,b){}dbgDefaultAttribs(){}}Y.type=p.GeometryType.enumPoint;class Ub{constructor(a){this.m_attributes=null;if(a)if(void 0!==a.xmin)this.m_envelope2D=new D(a.xmin,a.ymin,a.xmax,a.ymax);else if(void 0!==a.env2D)this.m_envelope2D=new D(a.env2D);else if(a.move)this.m_envelope2D=new D(a.move.m_envelope2D),this.m_attributes=a.move.m_attributes,a.move.m_attributes=null;else if(a.moveEnv)a=
a.moveEnv.accessEnvelopeData(),this.m_envelope2D=new D(a.m_envelope2D),this.m_attributes=a.m_attributes,a.m_attributes=null;else throw Error("unrecognized EnvelopeData constructor options");else this.m_envelope2D=D.constructEmpty()}ensureAttributes(a){a=a.getTotalComponentCount()-2;!this.m_attributes&&a&&(this.m_attributes=Array(2*a),this.m_attributes.fill(Number.NaN))}copyTo(a,b){const c=a.getTotalComponentCount()-2;b.m_description!==a&&(b.releaseAttributes_(),b.m_description=a,c&&(b.m_data.m_attributes=
Array(2*c)));c&&(p.geometryReleaseAssert(this.m_attributes&&b.m_data.m_attributes),l.memcpy(b.m_data.m_attributes,this.m_attributes,0,0,2*c));b.m_data.m_envelope2D=new D(this.m_envelope2D)}copyToIfNotNull(a,b){b.m_envelope2D=new D(this.m_envelope2D);b.releaseAttributes();a.getTotalComponentCount()-2&&this.m_attributes&&(b.m_attributes=this.m_attributes.slice())}releaseAttributes(){this.m_attributes=null}isEmpty(){return this.m_envelope2D.isEmpty()}transformAttribute(a,b,c,d,e){p.geometryReleaseAssert(0)}queryInterval(a,
b,c,d){if(this.isEmpty())d.setEmpty();else if(0===b)0===c?this.m_envelope2D.queryIntervalX(d):1===c?this.m_envelope2D.queryIntervalY(d):p.throwOutOfRangeException("");else{var e=K.getComponentCount(b);(0>c||c>=e)&&p.throwOutOfRangeException("");e=a.getAttributeIndex(b);0<=e?(d.vmin=this.m_attributes[0*(a.getTotalComponentCount()-2)+a.getPointAttributeOffset(e)-2+c],d.vmax=this.m_attributes[a.getTotalComponentCount()-2+a.getPointAttributeOffset(e)-2+c]):(a=K.getDefaultValue(b),d.setCoords(a,a))}}queryEnvelope3D(a,
b){const c=new l.Envelope1D;this.queryInterval(a,1,0,c);b.setCoords(this.m_envelope2D.xmin,this.m_envelope2D.ymin,c.vmin,this.m_envelope2D.xmax,this.m_envelope2D.ymax,c.vmax)}setEmpty(a){this.m_envelope2D.setEmpty();if(a=a.getTotalComponentCount()-2)this.m_attributes?this.dbgAssertSize(a):this.m_attributes=Array(2*a),this.m_attributes.fill(Number.NaN)}dbgAssertSize(a){}}class Ya{constructor(a){this.m_description=cb();if(void 0===a)this.m_data=new Ub;else if(void 0!==a.vd)this.m_description=a.vd,this.m_data=
new Ub,this.ensureAttributes_();else if(a?.env2D)this.m_data=new Ub({env2D:a.env2D});else if(void 0!==a.xmin)this.m_data=new Ub({xmin:a.xmin,ymin:a.ymin,xmax:a.xmax,ymax:a.ymax});else if(a.copy)this.m_data=new Ub,a.copy.copyTo(this);else if(a.move)this.m_description=a.move.m_description,a.move.m_description=null,this.m_data=new Ub({move:a.move.m_data});else if(a.centerPoint)this.m_description=a.centerPoint.getDescription(),this.m_data=new Ub,this.ensureAttributes_(),this.setFromPoint(a.centerPoint,
a.width,a.height);else throw Error("unrecognized Envelope constructor options");}accessEnvelopeData(){this.m_description=null;return this.m_data}assignMove(a){if(this===a)return this;this.m_description=a.m_description;a.m_description=null;this.m_data=new Ub({move:a.m_data});return this}assignCopy(a){if(this===a)return this;a.copyTo(this);return this}transformAttribute(a,b,c,d,e){p.geometryReleaseAssert(0)}vertexCount(){p.geometryReleaseAssert(0);return 0}setAttributeBasic(a,b,c){this.addAttribute(a);
if(!this.m_data.isEmpty()){var d=this.queryInterval(a,b);d.vmin=c;d.vmax=c;this.setIntervalEnvelope(a,b,d)}}hasNonLinearSegments(){p.geometryReleaseAssert(0);return!0}mergeVertexDescriptionImpl(a){const b=this.getDescription();a=Id(b,a);this.assignVertexDescription(a)}asEnvelope2D(){return new D(this.m_data.m_envelope2D)}assignVertexDescription(a){this.m_description!==a&&this.assignVertexDescriptionImpl(a)}getGeometryType(){return p.GeometryType.enumEnvelope}getDimension(){return 2}getXMin(){return this.m_data.m_envelope2D.xmin}getYMin(){return this.m_data.m_envelope2D.ymin}getXMax(){return this.m_data.m_envelope2D.xmax}getYMax(){return this.m_data.m_envelope2D.ymax}width(){return this.m_data.isEmpty()?
Number.NaN:this.m_data.m_envelope2D.width()}height(){return this.m_data.isEmpty()?Number.NaN:this.m_data.m_envelope2D.height()}getCenterX(){p.geometryReleaseAssert(0);return 0}getCenterY(){p.geometryReleaseAssert(0);return 0}getCenterXY(){return this.m_data.isEmpty()?new l.Point2D:this.m_data.m_envelope2D.getCenter()}getCenter(a){a.assignVertexDescription(this.m_description);if(this.m_data.isEmpty())a.setEmpty();else{var b=this.m_description.getAttributeCount();for(let c=1;c<b;c++){const d=this.m_description.getSemantics(c),
e=K.getComponentCount(d);for(let f=0;f<e;f++){const g=.5*(this.getAttributeAsDblImpl(0,d,f)+this.getAttributeAsDblImpl(1,d,f));a.setAttributeBasic(d,f,g)}}a.setXY(this.m_data.m_envelope2D.getCenter())}}setCoords(a,b,c,d){this.m_data.m_envelope2D.setCoords({xmin:a,ymin:b,xmax:c,ymax:d})}setEnvelope(a){if(a instanceof D)this.m_data.m_envelope2D=new D(a),this.m_data.m_envelope2D.normalize();else{this.addAttribute(1);this.m_data.m_envelope2D=a.getEnvelope2D();this.m_data.m_envelope2D.normalize();const b=
l.Envelope1D.constructEmpty();b.setCoords(a.zmin,a.zmax);this.setInterval(1,0,b.vmin,b.vmax)}}merge(a){if(a instanceof D)a.isValid()||p.throwInvalidArgumentException(""),this.m_data.m_envelope2D.mergeEnvelope2D(a);else if(a instanceof Ya){if(!a.m_data.isEmpty()){var b=a.getDescription();this.mergeVertexDescription(b);this.m_data.m_envelope2D.mergeEnvelope2D(a.m_data.m_envelope2D);for(let h=1,k=b.getAttributeCount();h<k;h++){var c=b.getSemantics(h),d=K.getComponentCount(c);for(var e=0;e<d;e++){var f=
a.queryInterval(c,e),g=this.queryInterval(c,e);g.merge(f);this.setIntervalEnvelope(c,e,g)}}}}else if(a instanceof Y){if(!a.isEmpty())if(b=a.getDescription(),this.mergeVertexDescription(b),this.m_data.isEmpty())this.setFromPoint(a);else{this.m_data.m_envelope2D.merge(a.getXY());for(let h=1,k=b.getAttributeCount();h<k;h++)for(c=b.getSemantics(h),d=K.getComponentCount(c),e=0;e<d;e++)f=a.getAttributeAsDbl(c,e),g=this.queryInterval(c,e),g.mergeCoordinate(f),this.setIntervalEnvelope(c,e,g)}}else p.geometryReleaseAssert(0)}intersect(a){if(!this.m_data.m_envelope2D.intersect(a.m_data.m_envelope2D))return this.setEmpty(),
!1;var b=a.getDescription();this.mergeVertexDescription(b);for(let c=1,d=this.m_description.getAttributeCount();c<d;c++){b=this.m_description.getSemantics(c);const e=K.getComponentCount(b);for(let f=0;f<e;f++){const g=a.queryInterval(b,f),h=this.queryInterval(b,f);h.intersect(g);this.setIntervalEnvelope(b,f,h)}}return!0}intersectCommonAttributes(a){if(!this.m_data.m_envelope2D.intersect(a.m_data.m_envelope2D))return this.setEmpty(),!1;const b=a.getDescription();for(let c=1,d=this.m_description.getAttributeCount();c<
d;c++){const e=this.m_description.getSemantics(c);if(!b.hasAttribute(e))continue;const f=K.getComponentCount(e);for(let g=0;g<f;g++){const h=a.queryInterval(e,g),k=this.queryInterval(e,g);k.intersect(h);this.setIntervalEnvelope(e,g,k)}}return!0}move(a,b){p.geometryReleaseAssert(0)}centerAt(a,b){this.m_data.m_envelope2D.centerAtCoords(a,b)}centerAtPoint(a){}reaspect(a,b){p.geometryReleaseAssert(0)}inflateCoords(a,b){this.m_data.m_envelope2D.inflateCoords(a,b)}containsCoords(a,b){p.geometryReleaseAssert(0);
return!1}contains(a){p.geometryReleaseAssert(0);return!1}containsPoint(a){p.geometryReleaseAssert(0);return!1}containsEnvelope(a){p.geometryReleaseAssert(0);return!1}setIntervalEnvelope(a,b,c){this.addAttribute(a);this.m_data.isEmpty()||(c=new l.Envelope1D(c),c.normalize(),0===a?c.isEmpty()?this.setEmpty():0===b?(this.m_data.m_envelope2D.xmin=c.vmin,this.m_data.m_envelope2D.xmax=c.vmax):1===b?(this.m_data.m_envelope2D.ymin=c.vmin,this.m_data.m_envelope2D.ymax=c.vmax):p.throwOutOfRangeException(""):
(this.setAttributeAsDblImpl(0,a,b,c.vmin),this.setAttributeAsDblImpl(1,a,b,c.vmax)))}setInterval(a,b,c,d){this.setIntervalEnvelope(a,b,new l.Envelope1D(c,d))}queryInterval(a,b){const c=new l.Envelope1D;this.m_data.queryInterval(this.m_description,a,b,c);return c}queryEnvelope(a){a instanceof D?a.setCoords({env2D:this.m_data.m_envelope2D}):a instanceof ub?this.m_data.queryEnvelope3D(this.m_description,a):a instanceof Ya?this.copyTo(a):p.geometryReleaseAssert(0)}applyTransformation(a){a instanceof l.Transformation2D?
a.transformEnvInPlace(this.m_data.m_envelope2D):p.geometryReleaseAssert(0)}createInstance(){p.geometryReleaseAssert(0);return this}copyTo(a){a!==this&&this.m_data.copyTo(this.m_description,a)}isEmpty(){return this.m_data.isEmpty()}setEmpty(){this.m_description||(this.m_description=cb());this.m_data.setEmpty(this.m_description)}calculateArea2D(){return this.m_data.m_envelope2D.getArea()}calculateLength2D(){p.geometryReleaseAssert(0);return 0}calculateLength3D(a){p.geometryReleaseAssert(0);return 0}equals(a,
b){if(a===this)return!0;if(this.m_description!==a.m_description||this.m_data.isEmpty()!==a.m_data.isEmpty())return!1;if(this.m_data.isEmpty())return!0;void 0===b&&(b=0);if(Math.abs(this.m_data.m_envelope2D.xmin-a.m_data.m_envelope2D.xmin)>b||Math.abs(this.m_data.m_envelope2D.ymin-a.m_data.m_envelope2D.ymin)>b||Math.abs(this.m_data.m_envelope2D.xmax-a.m_data.m_envelope2D.xmax)>b||Math.abs(this.m_data.m_envelope2D.ymax-a.m_data.m_envelope2D.ymax)>b)return!1;for(let c=0,d=2*(this.m_description.getTotalComponentCount()-
2);c<d;c++)if(!l.isEqualNonIEEETol(this.m_data.m_attributes[c],a.m_data.m_attributes[c],b))return!1;return!0}getBoundary(){p.throwNotImplementedException("getBoundary not available in this context. Use the boundary operator with an envelope parameter");return null}clone(){return new Ya({copy:this})}swap(a){p.geometryReleaseAssert(0)}queryCoordinates(a){p.geometryReleaseAssert(0)}queryCornerByVal(a,b){(0>a||3<a)&&p.throwOutOfRangeException("");b.assignVertexDescription(this.m_description);const c=
this.getDescription().getAttributeCount();for(let d=1;d<c;d++){const e=this.m_description.getSemantics(d),f=K.getComponentCount(e);for(let g=0;g<f;g++)b.setAttributeBasic(e,g,this.getAttributeAsDblImpl(a%2,e,g))}b.setXY(this.m_data.m_envelope2D.queryCorner(a))}queryCorner(a,b){b.assign(this.m_data.m_envelope2D.queryCorner(a))}getDescription(){return this.m_description}mergeVertexDescription(a){this.m_description!==a&&(this.m_description&&this.m_description.hasAttributesFrom(a)||this.mergeVertexDescriptionImpl(a))}hasAttribute(a){return this.m_description.hasAttribute(a)}addAttribute(a){this.m_description.hasAttribute(a)||
(a=Jd(this.m_description,a),this.assignVertexDescription(a))}dropAttribute(a){this.m_description.hasAttribute(a)&&(a=Pf(this.m_description,a),this.assignVertexDescription(a))}dropAllAttributes(){p.geometryReleaseAssert(0)}queryLooseEnvelope(a){this.queryEnvelope(a)}replaceNaNs(a,b){p.geometryReleaseAssert(0)}getImpl(){return this}setFromPoint(a,b,c){this.m_data.m_envelope2D.setCoords({center:a.getXY(),width:b??0,height:c??0});b=a.getDescription();for(let d=1,e=b.getAttributeCount();d<e;d++){c=b.getSemantics(d);
const f=K.getComponentCount(c);for(let g=0;g<f;g++){const h=a.getAttributeAsDbl(c,g);this.setInterval(c,g,h,h)}}}assignVertexDescriptionImpl(a){const b=Array(14);ye(a,this.m_description,b);let c=null;const d=a.getTotalComponentCount()-2,e=this.m_description?this.m_description.getTotalComponentCount()-2:0;0<d&&(c=Array(2*d),c.fill(Number.NaN));for(let g=1;g<a.getAttributeCount();g++){var f=b[g];if(-1!==f){const h=a.getPointAttributeOffset(g)-2,k=K.getComponentCount(a.getSemantics(g));f=this.m_description.getPointAttributeOffset(f)-
2;l.memcpy(c,this.m_data.m_attributes,h,f,k);l.memcpy(c,this.m_data.m_attributes,d+h,e+f,k)}}this.releaseAttributes_();this.m_data.m_attributes=c;this.m_description=a}getAttributeAsDblImpl(a,b,c){this.m_data.isEmpty()&&p.throwEmptyGeometryException("");if(0===b)return a?c?this.m_data.m_envelope2D.ymax:this.m_data.m_envelope2D.xmax:c?this.m_data.m_envelope2D.ymin:this.m_data.m_envelope2D.xmin;var d=K.getComponentCount(b);c>=d&&p.throwOutOfRangeException("");d=this.m_description.getAttributeIndex(b);
return 0<=d?this.m_data.m_attributes[a*(this.m_description.getTotalComponentCount()-2)+this.m_description.getPointAttributeOffset(d)-2+c]:K.getDefaultValue(b)}setAttributeAsDblImpl(a,b,c,d){0===b&&(a?1===c?this.m_data.m_envelope2D.ymax=d:0===c?this.m_data.m_envelope2D.xmax=d:p.throwOutOfRangeException(""):1===c?this.m_data.m_envelope2D.ymin=d:0===c?this.m_data.m_envelope2D.xmin=d:p.throwOutOfRangeException(""));const e=K.getComponentCount(b);(0>c||c>=e)&&p.throwOutOfRangeException("");this.addAttribute(b);
b=this.m_description.getAttributeIndex(b);this.m_data.m_attributes[a*(this.m_description.getTotalComponentCount()-2)+this.m_description.getPointAttributeOffset(b)-2+c]=d}releaseAttributes_(){this.m_data.releaseAttributes()}ensureAttributes_(){this.m_data.ensureAttributes(this.m_description)}}Ya.type=p.GeometryType.enumEnvelope;var ed=K;class Ic{size(){return this.m_size}checkResize(a,b){a>this.m_size&&this.resize(a,b)}resize(a,b){a=Math.trunc(a);if(a!==this.m_size){var c=!!b||Number.isNaN(b);if(a<
this.m_a.length)this.m_a.length>Ic.s_resizeMin&&1.25*a<this.m_a.length&&(this.m_a=this.m_a.slice(0,a)),c&&a>this.m_size&&this.m_a.fill(b,this.m_size,a);else if(a>=this.m_a.length){const d=new this.m_a.constructor(1.25*a);d.set(this.m_a);this.m_a=d;c&&this.m_a.fill(b,this.m_size,a)}this.m_size=a}}resizeRounded(a,b){return this.resize(a,b)}reserve(a){}read(a){p.geometryReleaseAssert(0<=a&&a<this.m_size);return this.m_a[a]}readAsDbl(a){return this.read(a)}write(a,b){this.m_a[a]=b}writeAsDbl(a,b){this.write(a,
b)}setRange(a,b,c){(0>b||0>c||c+b>this.size())&&p.throwInvalidArgumentException();this.m_a.fill(a,b,b+c)}add(a){this.resize(this.m_size+1);this.m_a[this.m_size-1]=a}addArray(a,b){const c=this.m_size;void 0===b?(this.resize(this.m_size+a.length),this.m_a.set(a,c)):(this.resize(this.m_size+b),this.m_a.set(a.slice(0,b),c))}equals(a,b,c,d){if(this.getPersistence()!==a.getPersistence())return!1;a:if(this.getPersistence()!==a.getPersistence())a=!1;else{var e=1>=this.getPersistence(),f=this.size(),g=a.size();
if(c>f||c>g)a=!1;else{if(d)for(e=b;e<c;e++){if(b=this.read(e)-a.read(e),0>b&&(b=-b),b>d){a=!1;break a}}else for(d=b;d<c;d++)if(b=this.read(d),f=a.read(d),b!==f&&!(e&&Number.isNaN(b)&&Number.isNaN(f))){a=!1;break a}a=!0}}return a}insertRange(a,b,c,d){c&&this.checkResize(d+c);this.m_a.copyWithin(a+c,a,d?d:this.m_size);this.m_a.fill(b,a,a+c)}readRange(a,b){return this.m_a.slice(a,a+b)}insertRangeFromStream(a,b,c,d,e,f,g){p.geometryReleaseAssert(this.getPersistence()===b.getPersistence());d&&this.checkResize(g+
d);this.m_a.copyWithin(a+d,a,g?g:this.m_size);this.m_a.set(b.readRange(c,d),a);e||this.reverseRange(a,d,f)}writeRange(a,b,c,d,e,f){p.geometryReleaseAssert(this.getPersistence()===c.getPersistence());(0>a||0>b||0>d)&&p.throwInvalidArgumentException();c.size()<d+b&&p.throwInvalidArgumentException();0!==b&&(this.size()<b+a&&this.resize(b+a),c=c.m_a.subarray(d,d+b),d=this.m_a,(0>a||0>b)&&p.throwInvalidArgumentException(),0!==b&&(1===b?d[a]=c[0]:(e=c,b<c.length&&(e=c.subarray(0,b)),d.set(e,a))))}insertAttributes(a,
b,c,d){const e=ed.getComponentCount(c);this.m_a.copyWithin(a+e,a,d?d:this.m_size);for(d=0;d<e;d++)this.m_a[a+d]=b.getAttributeAsDbl(c,d)}insertAttributesFromPoints(a,b,c,d,e){p.geometryReleaseAssert(0)}eraseRange(a,b,c){this.m_size<a+b&&p.throwInvalidArgumentException();this.m_a.copyWithin(a,a+b);this.m_size-=b}reverseRange(a,b,c){(1>c||0!==b%c)&&p.throwInvalidArgumentException();this.m_a.subarray(a,a+b).reverse();if(1<c)for(let d=a,e=a+b;d<e;d+=c)for(a=d,b=d+c-1;a<b;){const f=this.m_a[a];this.m_a[a]=
this.m_a[b];this.m_a[b]=f;a++;b--}}rotate(a,b,c){(b<a||b>c||a>c)&&p.throwOutOfRangeException("rotate");b!==a&&b!==c&&(this.reverseRange(a,b-a,1),this.reverseRange(b,c-b,1),this.reverseRange(a,c-a,1))}adjacentDifference(a,b,c){p.geometryReleaseAssert(0);return 0}sort(a,b,c){this.m_a.subarray(a,b).sort(c)}constructor(a){a.move?(this.m_a=a.move.m_a,this.m_size=a.move.m_size,a.move.m_a=a.move.m_a.slice(0,0),a.move.m_size=0):a.copy?(this.m_size=a.copy.m_size,a.maxSize&&(this.m_size=Math.min(a.maxSize,
this.m_size)),this.m_a=a.copy.m_a.slice(0,this.m_size)):(this.m_a=new a.ctor(Math.max(a.size,Ic.s_constructMin)),(a.defaultValue||Number.isNaN(a.defaultValue))&&this.m_a.fill(a.defaultValue),this.m_size=a.size)}}Ic.s_constructMin=2;Ic.s_resizeMin=30;class Db extends Ic{setBits(a,b){this.m_a[a]|=b}clearBits(a,b){this.m_a[a]&=~b}getPersistence(){return 4}clone(){return new Db({ctor:Int8Array,copy:this})}restrictedClone(a){return new Db({ctor:Int8Array,copy:this,maxSize:a})}constructor(a,b){"number"===
typeof a?super({ctor:Int8Array,size:a,defaultValue:b}):super(a)}}class za extends Ic{getPersistence(){return 2}clone(){return new za({ctor:Int32Array,copy:this})}restrictedClone(a){return new za({ctor:Int32Array,copy:this,maxSize:a})}write(a,b){p.geometryReleaseAssert(b<=l.intMax());super.write(a,b)}constructor(a,b){"number"===typeof a?super({ctor:Int32Array,size:a,defaultValue:b}):super(a)}}class Qf extends Ic{getPersistence(){return 0}clone(){return new Qf({ctor:Float32Array,copy:this})}restrictedClone(a){return new Qf({ctor:Float32Array,
copy:this,maxSize:a})}constructor(a,b){"number"===typeof a?super({ctor:Float32Array,size:a,defaultValue:b}):super(a)}}class ic extends Ic{getPersistence(){return 1}getArray(){return this.m_a}applyTransformation(a,b,c){(0!==(b&1)||b+2*c>this.size())&&p.throwInvalidArgumentException();b=0===b?this.m_a:this.m_a.subarray(b);a.transformInterleavedPoints(b,c,b)}readPoint2D(a){return new l.Point2D(this.m_a[a],this.m_a[a+1])}queryPoint2D(a,b){b.x=this.m_a[a];b.y=this.m_a[a+1];return b}writePoint2D(a,b){this.write(a,
b.x);this.write(a+1,b.y)}insert(a,b,c){if(c+2>=this.m_a.length)throw RangeError("AttributeStreamOfDbl::insert");this.m_a.copyWithin(a+2,a,c?c:this.m_size);this.m_a[a]=b.x;this.m_a[a+1]=b.y}insertRangeFromPoints(a,b,c,d,e,f){this.m_a.copyWithin(a+2*d,a,f?f:this.m_size);if(e)for(let g=c,h=a,k=0;k<d;++k,++g)a=b[g],this.m_a[h++]=a.x,this.m_a[h++]=a.y;else for(let g=c+d-1,h=a,k=0;k<d;++k,--g)a=b[g],this.m_a[h++]=a.x,this.m_a[h++]=a.y}queryRange(a,b,c,d,e){(0>a||0>b)&&p.throwInvalidArgumentException();
!d&&(0>=e||0!==b%e)&&p.throwInvalidArgumentException();0!==b&&(1===b?c[0]=this.m_a[a]:(a=this.m_a.subarray(a,a+b),c.set(a)))}writeRangeFromArray(a,b,c,d,e){(0>a||0>b)&&p.throwInvalidArgumentException();0!==b&&(1===b?this.m_a[a]=c[0]:(d=c,b<c.length&&(d=c.subarray(0,b)),this.m_a.set(d,a)))}clone(){return new ic({ctor:Float64Array,copy:this})}restrictedClone(a){return new ic({ctor:Float64Array,copy:this,maxSize:a})}constructor(a,b){"number"===typeof a?super({ctor:Float64Array,size:a,defaultValue:b}):
super(a)}}class Ff{constructor(a){this.streams=this.posStream=null;void 0!==a&&p.geometryReleaseAssert(0)}assignMove(a){p.geometryReleaseAssert(0);return this}get(a){return 0<a?this.streams[a-1]:this.posStream}set(a,b){0<a?this.streams[a-1]=b:this.posStream=b}destroyAndSetSize(a){this.streams=null;if(1<a){this.streams=Array(a-1);for(let b=0;b<a-1;++b)this.streams[b]=null}this.posStream=null}swap(a){[this.streams,a.streams]=[a.streams,this.streams];[this.posStream,a.posStream]=[a.posStream,this.posStream]}empty(){return null===
this.posStream&&null===this.streams}}class Zb{constructor(){this.m_maxValue=this.m_minValue=-1;this.m_dy=Number.NaN;this.m_buckets=new za(0);this.m_bucketedIndices=new za(0)}static sortEx(a,b,c,d,e=32){c-b<=e?d.userSort(b,c,a):(new Zb).sort(a,b,c,d,e)}sort(a,b,c,d,e=32){if(c-b<=e)d.userSort(b,c,a);else{e=!0;var f=Number.POSITIVE_INFINITY,g=Number.NEGATIVE_INFINITY;for(var h=b;h<c;h++){const k=d.getValue(a.read(h));k<f&&(f=k);k>g&&(g=k)}if(this.reset(c-b,f,g,c-b)){for(e=b;e<c;e++)f=a.read(e),g=d.getValue(f),
g=this.getBucket(g),this.m_buckets.write(g,this.m_buckets.read(g)+1),this.m_bucketedIndices.write(e-b,f);e=this.m_buckets.read(0);this.m_buckets.write(0,0);for(let k=1,m=this.m_buckets.size();k<m;k++)f=this.m_buckets.read(k),this.m_buckets.write(k,e),e+=f;for(e=b;e<c;e++)f=this.m_bucketedIndices.read(e-b),g=d.getValue(f),g=this.getBucket(g),h=this.m_buckets.read(g),a.write(h+b,f),this.m_buckets.write(g,h+1);e=!1}if(e)d.userSort(b,c,a);else{c=0;for(let k=0,m=this.m_buckets.size();k<m;k++)e=c,c=this.m_buckets.read(k),
c>e&&d.userSort(b+e,b+c,a);100<this.m_buckets.size()&&(this.m_buckets.resize(0),this.m_bucketedIndices.resize(0))}}}reset(a,b,c,d){if(2>a||c===b)return!1;a=Math.min(Zb.c_maxBuckets,a);this.m_buckets.resize(a);this.m_buckets.setRange(0,0,this.m_buckets.size());this.m_minValue=b;this.m_maxValue=c;this.m_bucketedIndices.resize(d);this.m_dy=(c-b)/(a-1);return!0}getBucket(a){return Math.trunc((a-this.m_minValue)/this.m_dy)}getBucketCount(){return this.m_buckets.size()}}Zb.c_maxBuckets=65536;class U{constructor(a){this.m_buffer=
null;this.m_firstFree=-1;this.m_stride=this.m_bufferSize=this.m_capacity=this.m_size=this.m_last=0;this.m_realStride=this.m_stride=a;this.m_blockSize=Math.trunc(U.st_realBlockSize/this.m_realStride)}dbgdelete_(a){this.m_buffer[a>>U.st_blockPower][(a&U.st_blockMask)+1]=U.st_deadVertex;return!0}deleteElement(a){(a>>U.st_blockPower)*this.m_blockSize*this.m_realStride+(a&U.st_blockMask)<this.m_last*this.m_realStride?(this.m_buffer[a>>U.st_blockPower][a&U.st_blockMask]=this.m_firstFree,this.m_firstFree=
a):this.m_last--;this.m_size--}getField(a,b){return this.m_buffer[a>>U.st_blockPower][(a&U.st_blockMask)+b]}setField(a,b,c){this.m_buffer[a>>U.st_blockPower][(a&U.st_blockMask)+b]=c}getStride(){return this.m_stride}newElement(){let a=this.m_firstFree;-1===a?(this.m_last===this.m_capacity&&this.grow(0!==this.m_capacity?Math.trunc(2*(this.m_capacity+1)):1),a=(this.m_last/this.m_blockSize<<U.st_blockPower)+this.m_last%this.m_blockSize*this.m_realStride,this.m_last++):this.m_firstFree=this.m_buffer[a>>
U.st_blockPower][a&U.st_blockMask];this.m_size++;const b=this.m_buffer[a>>U.st_blockPower],c=a&U.st_blockMask;for(let d=0;d<this.m_stride;d++)b[c+d]=-1;return a}elementToIndex(a){return(a>>U.st_blockPower)*this.m_blockSize+(a&U.st_blockMask)/this.m_realStride}deleteAll(a){this.m_firstFree=-1;this.m_size=this.m_last=0;a&&(this.m_buffer=null,this.m_capacity=0)}size(){return this.m_size}setCapacity(a){a>this.m_capacity&&this.grow(a)}capacity(){return this.m_capacity}swap(a,b){const c=this.m_buffer[a>>
U.st_blockPower],d=this.m_buffer[b>>U.st_blockPower];a&=U.st_blockMask;b&=U.st_blockMask;for(let e=0;e<this.m_stride;e++){const f=c[a+e];c[a+e]=d[b+e];d[b+e]=f}}swapField(a,b,c){const d=this.m_buffer[a>>U.st_blockPower],e=this.m_buffer[b>>U.st_blockPower];a=(a&U.st_blockMask)+c;b=(b&U.st_blockMask)+c;c=d[a];d[a]=e[b];e[b]=c}static impossibleIndex2(){return-2}static impossibleIndex3(){return-3}static isValidElement(a){return 0<=a}ensureBufferBlocksCapacity(a){if(this.m_buffer.length<a){a=Array(a);
for(let b=0;b<this.m_buffer.length;b++)a[b]=this.m_buffer[b];this.m_buffer=a}}grow(a){null===this.m_buffer&&(this.m_bufferSize=0,this.m_buffer=Array(8));var b=Math.trunc((a+this.m_blockSize-1)/this.m_blockSize);this.ensureBufferBlocksCapacity(b);if(1===b){b=0;for(a*=this.m_realStride;a>U.st_sizes[b];)b++;a=new Int32Array(U.st_sizes[b]);1===this.m_bufferSize?(a.set(this.m_buffer[0]),this.m_buffer[0]=a):(this.m_buffer[this.m_bufferSize]=a,this.m_bufferSize++);this.m_capacity=Math.trunc(a.length/this.m_realStride)}else for(1===
this.m_bufferSize&&this.m_buffer[0].length<U.st_realBlockSize&&(a=new Int32Array(U.st_realBlockSize),a.set(this.m_buffer[0]),this.m_buffer[0]=a,this.m_capacity=this.m_blockSize);this.m_bufferSize<b;)this.m_buffer[this.m_bufferSize++]=new Int32Array(U.st_realBlockSize),this.m_capacity+=this.m_blockSize}}U.st_realBlockSize=16384;U.st_blockMask=16383;U.st_blockPower=14;U.st_sizes=[16,32,64,128,256,512,1024,2048,4096,8192,16384];U.st_deadVertex=-2125315821;class fb{constructor(a,b,c){this.m_extent=new D;
this.m_dataExtent=new D;this.m_childExtents=[new D,new D,new D,new D];this.m_elementNodes=new U(4);this.m_data=[];this.m_freeData=[];this.m_root=-1;this.m_height=8;void 0===c&&(c=!1);this.m_quadTreeNodes=new U(c?11:10);this.m_bStoreDuplicates=c;this.reset_(a,b)}reset(a,b){p.geometryReleaseAssert(0)}insert(a,b){-1===this.m_root&&this.createRoot_();if(this.m_bStoreDuplicates)return a=this.insertDuplicates_(a,b,0,this.m_extent,this.m_root,!1,-1),-1!==a&&(this.m_dataExtent.isEmpty()?this.m_dataExtent.setCoords({env2D:b}):
this.m_dataExtent.mergeEnvelope2D(b)),a;a=this.insert_(a,b,0,this.m_extent,this.m_root,!1,-1);-1!==a&&(this.m_dataExtent.isEmpty()?this.m_dataExtent.setCoords({env2D:b}):this.m_dataExtent.mergeEnvelope2D(b));return a}insertEx(a,b,c){-1===this.m_root&&this.createRoot_();if(this.m_bStoreDuplicates)return a=this.insertDuplicates_(a,b,0,this.m_extent,this.m_root,!1,-1),-1!==a&&(this.m_dataExtent.isEmpty()?this.m_dataExtent.setCoords({env2D:b}):this.m_dataExtent.mergeEnvelope2D(b)),a;c=-1===c?this.m_root:
this.getQuad_(c);const d=this.getHeight(c),e=this.getExtent(c);a=this.insert_(a,b,d,e,c,!1,-1);-1!==a&&(this.m_dataExtent.isEmpty()?this.m_dataExtent.setCoords({env2D:b}):this.m_dataExtent.mergeEnvelope2D(b));return a}removeElement(a){p.geometryReleaseAssert(0)}getElement(a){return this.getElementValue_(this.getData_(a))}getElementAtIndex(a){p.geometryReleaseAssert(0);return 0}getElementExtent(a){a=this.getData_(a);return this.getBoundingBoxValue_(a).clone()}getElementExtentAtIndex(a){p.geometryReleaseAssert(0);
return{}}getDataExtent(){return this.m_dataExtent.clone()}getQuadTreeExtent(){p.geometryReleaseAssert(0);return{}}getHeight(a){return this.m_quadTreeNodes.getField(a,6)>>fb.m_heightBitShift}getMaxHeight(){return this.m_height}getExtent(a){const b=new D;b.setCoords({env2D:this.m_extent});if(a===this.m_root)return b;const c=[];do c.push(this.getQuadrant_(a)),a=this.getParent_(a);while(a!==this.m_root);a=c.length;for(let d=0;d<a;d++){const e=c.at(-1);c.pop();0===e?(b.xmin=.5*(b.xmin+b.xmax),b.ymin=.5*
(b.ymin+b.ymax)):1===e?(b.xmax=.5*(b.xmin+b.xmax),b.ymin=.5*(b.ymin+b.ymax)):(2===e?b.xmax=.5*(b.xmin+b.xmax):b.xmin=.5*(b.xmin+b.xmax),b.ymax=.5*(b.ymin+b.ymax))}return b}getQuad(a){return this.getQuad_(a)}getElementCount(){return-1===this.m_root?0:this.getSubTreeElementCount_(this.m_root)}getSubTreeElementCount(a){return this.getSubTreeElementCount_(a)}getContainedSubTreeElementCount(a){return this.m_bStoreDuplicates?this.getContainedSubTreeElementCount_(a):this.getSubTreeElementCount_(a)}getIntersectionCount(a,
b,c){if(-1===this.m_root)return 0;const d=new D;d.setCoords({env2D:a});d.inflateCoords(b,b);a=[];b=[];a.push(this.m_root);b.push(this.m_extent.clone());const e=l.makeObjectArray(D,4);let f=0;for(;0<a.length;){var g=!1;const k=a.at(-1);var h=b.at(-1);a.pop();b.pop();if(d.containsEnvelope(h)){if(f+=this.getSubTreeElementCount(k),0<c&&f>=c)return c}else if(d.isIntersecting(h)){for(g=this.getFirstElement_(k);-1!==g;g=this.getNextElement_(g)){const m=this.getData_(g);if(this.getBoundingBoxValue_(m).isIntersecting(d)&&
(f++,0<c&&f>=c))return c}g=this.getHeight(k)+1<=this.m_height}if(g)for(fb.setChildExtents_(h,e),h=0;4>h;h++)g=this.getChild_(k,h),-1!==g&&0<this.getSubTreeElementCount_(g)&&d.isIntersecting(e[h])&&(a.push(g),b.push(e[h].clone()))}return f}hasData(a,b){return 1<=this.getIntersectionCount(a,b,1)}getIterator(a,b){return new Bl(this,a,b)}getIteratorForQT(){return new Bl(this)}getSortedIterator(a,b){return new Cl(this.getIterator(a,b))}getSortedIteratorForQT(){return new Cl(this.getIteratorForQT())}visitLeavesNearest(a,
b,c,d){p.geometryReleaseAssert(0)}reset_(a,b){(0>b||127<b)&&p.throwInvalidArgumentException("invalid height");this.m_height=b;this.m_extent.setCoords({env2D:a});this.m_dataExtent.setEmpty();this.m_root=-1}insert_(a,b,c,d,e,f,g){if(!d.containsEnvelope(b))return 0===c?-1:this.insert_(a,b,0,this.m_extent,this.m_root,f,g);if(!f)for(var h=e;-1!==h;h=this.getParent_(h))this.setSubTreeElementCount_(h,this.getSubTreeElementCount_(h)+1);h=new D;h.setCoords({env2D:d});for(d=e;c<this.m_height&&this.canPushDown_(d);c++){fb.setChildExtents_(h,
this.m_childExtents);let k=!1;for(let m=0;4>m;m++)if(this.m_childExtents[m].containsEnvelope(b)){k=!0;let n=this.getChild_(d,m);-1===n&&(n=this.createChild_(d,m));this.setSubTreeElementCount_(n,this.getSubTreeElementCount_(n)+1);d=n;h.setCoords({env2D:this.m_childExtents[m]});break}if(!k)break}return this.insertAtQuad_(a,b,c,h,d,f,e,g,-1)}insertDuplicates_(a,b,c,d,e,f,g){if(!f){if(!d.containsEnvelope(b))return-1;this.setSubTreeElementCount_(e,this.getSubTreeElementCount_(e)+1);this.setContainedSubTreeElementCount_(e,
this.getContainedSubTreeElementCount_(e)+1)}const h=Math.max(b.width(),b.height());let k=-1;const m=[],n=[],q=[];m.push(e);n.push(d.clone());q.push(c);for(c=l.makeObjectArray(D,4);0<m.length;){var r=!1;d=m.at(-1);var t=n.at(-1);const v=q.at(-1);m.pop();n.pop();q.pop();if(v+1<this.m_height&&this.canPushDown_(d)){var u=Math.max(t.width(),t.height());h<=u/2&&(r=!0)}if(r){fb.setChildExtents_(t,c);r=!1;for(t=0;4>t;t++)if(r=c[t].containsEnvelope(b)){u=this.getChild_(d,t);-1===u&&(u=this.createChild_(d,
t));m.push(u);n.push(c[t].clone());q.push(v+1);this.setSubTreeElementCount_(u,this.getSubTreeElementCount_(u)+1);this.setContainedSubTreeElementCount_(u,this.getContainedSubTreeElementCount_(u)+1);break}if(!r)for(r=0;4>r;r++)c[r].isIntersecting(b)&&(t=this.getChild_(d,r),-1===t&&(t=this.createChild_(d,r)),m.push(t),n.push(c[r].clone()),q.push(v+1),this.setSubTreeElementCount_(t,this.getSubTreeElementCount_(t)+1))}else k=this.insertAtQuad_(a,b,v,t,d,f,e,g,k),f=!1}return 0}insertAtQuad_(a,b,c,d,e,f,
g,h,k){this.getFirstElement_(e);const m=this.getLastElement_(e);let n=-1;if(f){if(e===g)return h;this.disconnectElementHandle_(h);n=h}else-1===k?(n=this.createElement_(),this.setDataValues_(this.getData_(n),a,b)):n=this.createElementFromDuplicate_(k);this.setQuad_(n,e);-1!==m?(this.setPrevElement_(n,m),this.setNextElement_(m,n)):this.setFirstElement_(e,n);this.setLastElement_(e,n);this.setLocalElementCount_(e,this.getLocalElementCount_(e)+1);this.canFlush_(e)&&this.flush_(c,d,e);return n}static setChildExtents_(a,
b){const c=.5*(a.xmin+a.xmax),d=.5*(a.ymin+a.ymax);b[0].setCoords({xmin:c,ymin:d,xmax:a.xmax,ymax:a.ymax});b[1].setCoords({xmin:a.xmin,ymin:d,xmax:c,ymax:a.ymax});b[2].setCoords({xmin:a.xmin,ymin:a.ymin,xmax:c,ymax:d});b[3].setCoords({xmin:c,ymin:a.ymin,xmax:a.xmax,ymax:d})}disconnectElementHandle_(a){const b=this.getQuad_(a),c=this.getFirstElement_(b),d=this.getLastElement_(b),e=this.getPrevElement_(a),f=this.getNextElement_(a);c===a?(-1!==f?this.setPrevElement_(f,-1):this.setLastElement_(b,-1),
this.setFirstElement_(b,f)):d===a?(this.setNextElement_(e,-1),this.setLastElement_(b,e)):(this.setPrevElement_(f,e),this.setNextElement_(e,f));this.setPrevElement_(a,-1);this.setNextElement_(a,-1);this.setLocalElementCount_(b,this.getLocalElementCount_(b)-1)}canFlush_(a){return this.getLocalElementCount_(a)===fb.m_flushingCount&&!this.hasChildren_(a)}flush_(a,b,c){let d;const e=new D;let f=this.getFirstElement_(c);var g=-1;g=-1;do g=this.getData_(f),d=this.getElementValue_(g),e.setCoords({env2D:this.getBoundingBoxValue_(g)}),
g=this.getNextElement_(f),this.m_bStoreDuplicates?this.insertDuplicates_(d,e,a,b,c,!0,f):this.insert_(d,e,a,b,c,!0,f),f=g;while(-1!==f)}canPushDown_(a){return this.getLocalElementCount_(a)>=fb.m_flushingCount||this.hasChildren_(a)}hasChildren_(a){return-1!==this.getChild_(a,0)||-1!==this.getChild_(a,1)||-1!==this.getChild_(a,2)||-1!==this.getChild_(a,3)}createChild_(a,b){const c=this.m_quadTreeNodes.newElement();this.setChild_(a,b,c);this.setSubTreeElementCount_(c,0);this.setLocalElementCount_(c,
0);this.setParent_(c,a);this.setHeightAndQuadrant_(c,this.getHeight_(a)+1,b);this.m_bStoreDuplicates&&this.setContainedSubTreeElementCount_(c,0);return c}createRoot_(){this.m_root=this.m_quadTreeNodes.newElement();this.setSubTreeElementCount_(this.m_root,0);this.setLocalElementCount_(this.m_root,0);this.setHeightAndQuadrant_(this.m_root,0,0);this.m_bStoreDuplicates&&this.setContainedSubTreeElementCount_(this.m_root,0)}createElement_(){const a=this.m_elementNodes.newElement();let b;0<this.m_freeData.length?
(b=this.m_freeData.at(-1),this.m_freeData.pop()):(b=this.m_data.length,this.m_data.length=b+1);this.setData_(a,b);return a}createElementFromDuplicate_(a){const b=this.m_elementNodes.newElement();a=this.getData_(a);this.setData_(b,a);return b}freeElementAndBoxNode_(a){p.geometryReleaseAssert(0)}getChild_(a,b){return this.m_quadTreeNodes.getField(a,b)}setChild_(a,b,c){this.m_quadTreeNodes.setField(a,b,c)}getFirstElement_(a){return this.m_quadTreeNodes.getField(a,4)}setFirstElement_(a,b){this.m_quadTreeNodes.setField(a,
4,b)}getLastElement_(a){return this.m_quadTreeNodes.getField(a,5)}setLastElement_(a,b){this.m_quadTreeNodes.setField(a,5,b)}getQuadrant_(a){return this.m_quadTreeNodes.getField(a,6)&fb.m_quadrantMask}getHeight_(a){return this.m_quadTreeNodes.getField(a,6)>>fb.m_heightBitShift}setHeightAndQuadrant_(a,b,c){this.m_quadTreeNodes.setField(a,6,b<<fb.m_heightBitShift|c)}getLocalElementCount_(a){return this.m_quadTreeNodes.getField(a,7)}setLocalElementCount_(a,b){this.m_quadTreeNodes.setField(a,7,b)}getSubTreeElementCount_(a){return this.m_quadTreeNodes.getField(a,
8)}setSubTreeElementCount_(a,b){this.m_quadTreeNodes.setField(a,8,b)}getParent_(a){return this.m_quadTreeNodes.getField(a,9)}setParent_(a,b){this.m_quadTreeNodes.setField(a,9,b)}getContainedSubTreeElementCount_(a){return this.m_quadTreeNodes.getField(a,10)}setContainedSubTreeElementCount_(a,b){this.m_quadTreeNodes.setField(a,10,b)}getData_(a){return this.m_elementNodes.getField(a,0)}setData_(a,b){this.m_elementNodes.setField(a,0,b)}getPrevElement_(a){return this.m_elementNodes.getField(a,1)}getNextElement_(a){return this.m_elementNodes.getField(a,
2)}setPrevElement_(a,b){this.m_elementNodes.setField(a,1,b)}setNextElement_(a,b){this.m_elementNodes.setField(a,2,b)}getQuad_(a){return this.m_elementNodes.getField(a,3)}setQuad_(a,b){this.m_elementNodes.setField(a,3,b)}getElementValue_(a){return this.m_data[a].element}getBoundingBoxValue_(a){return this.m_data[a].box}setDataValues_(a,b,c){this.m_data[a]={element:b,box:c.clone()}}}fb.m_quadrantMask=3;fb.m_heightBitShift=2;fb.m_flushingCount=5;class Bl{constructor(a,b,c){this.m_bLinear=!1;this.m_queryStart=
new l.Point2D;this.m_queryEnd=new l.Point2D;this.m_queryBox=new D;this.m_tolerance=0;this.m_nextElementHandle=this.m_currentElementHandle=-1;this.m_quadsStack=[];this.m_extentsStack=[];this.m_childExtents=[new D,new D,new D,new D];this.m_quadTree=a;b&&this.resetIterator(b,c)}resetIterator(a,b){void 0===b&&(b=0);a instanceof D?(this.m_quadsStack.length=0,this.m_extentsStack.length=0,this.m_currentElementHandle=-1,this.m_queryBox.setCoords({env2D:a}),this.m_queryBox.inflateCoords(b,b),this.m_tolerance=
Number.NaN,-1!==this.m_quadTree.m_root&&this.m_queryBox.isIntersecting(this.m_quadTree.m_extent)?(this.m_quadsStack.push(this.m_quadTree.m_root),this.m_extentsStack.push(this.m_quadTree.m_extent.clone()),this.m_nextElementHandle=this.m_quadTree.getFirstElement_(this.m_quadTree.m_root),this.m_bLinear=!1):this.m_nextElementHandle=-1):(this.m_quadsStack.length=0,this.m_extentsStack.length=0,this.m_currentElementHandle=-1,a.queryLooseEnvelope(this.m_queryBox),this.m_queryBox.inflateCoords(b,b),-1!==this.m_quadTree.m_root&&
this.m_queryBox.isIntersecting(this.m_quadTree.m_extent)?((this.m_bLinear=a.getGeometryType()===p.GeometryType.enumLine)?(this.m_queryStart.assign(a.getStartXY()),this.m_queryEnd.assign(a.getEndXY()),this.m_tolerance=b):this.m_tolerance=Number.NaN,this.m_quadsStack.push(this.m_quadTree.m_root),this.m_extentsStack.push(this.m_quadTree.m_extent.clone()),this.m_nextElementHandle=this.m_quadTree.getFirstElement_(this.m_quadTree.m_root)):this.m_nextElementHandle=-1)}next(){if(0===this.m_quadsStack.length)return-1;
this.m_currentElementHandle=this.m_nextElementHandle;const a=new l.Point2D,b=new l.Point2D,c=new D;let d=!1;for(;!d;){for(;-1!==this.m_currentElementHandle;){var e=this.m_quadTree.getData_(this.m_currentElementHandle);c.setCoords({env2D:this.m_quadTree.getBoundingBoxValue_(e)});if(c.isIntersecting(this.m_queryBox))if(this.m_bLinear){if(a.setCoordsPoint2D(this.m_queryStart),b.setCoordsPoint2D(this.m_queryEnd),c.inflateCoords(this.m_tolerance,this.m_tolerance),0<c.clipLine(a,b)){d=!0;break}}else{d=
!0;break}this.m_currentElementHandle=this.m_quadTree.getNextElement_(this.m_currentElementHandle)}if(-1===this.m_currentElementHandle){e=this.m_quadsStack.at(-1);var f=this.m_extentsStack.at(-1);fb.setChildExtents_(f,this.m_childExtents);this.m_quadsStack.pop();this.m_extentsStack.pop();for(f=0;4>f;f++){const g=this.m_quadTree.getChild_(e,f);if(-1!==g&&0<this.m_quadTree.getSubTreeElementCount(g)&&this.m_childExtents[f].isIntersecting(this.m_queryBox))if(this.m_bLinear){a.setCoordsPoint2D(this.m_queryStart);
b.setCoordsPoint2D(this.m_queryEnd);const h=new D;h.setCoords({env2D:this.m_childExtents[f]});h.inflateCoords(this.m_tolerance,this.m_tolerance);0<h.clipLine(a,b)&&(this.m_quadsStack.push(g),this.m_extentsStack.push(this.m_childExtents[f].clone()))}else this.m_quadsStack.push(g),this.m_extentsStack.push(this.m_childExtents[f].clone())}if(0===this.m_quadsStack.length)return-1;this.m_currentElementHandle=this.m_quadTree.getFirstElement_(this.m_quadsStack.at(-1))}}this.m_nextElementHandle=this.m_quadTree.getNextElement_(this.m_currentElementHandle);
return this.m_currentElementHandle}clone(){p.geometryReleaseAssert(0);return{}}}class Cl{constructor(a){this.m_bucketSort=new Zb;this.m_sortedHandles=new za(0);this.m_index=-1;this.m_quadTreeIteratorImpl=a}resetIterator(a,b){this.m_quadTreeIteratorImpl.resetIterator(a,b);this.m_sortedHandles.resize(0);this.m_index=-1}next(){if(-1===this.m_index){let a=-1;for(;-1!==(a=this.m_quadTreeIteratorImpl.next());)this.m_sortedHandles.add(a);const b=this;this.m_bucketSort.sort(this.m_sortedHandles,0,this.m_sortedHandles.size(),
{userSort(c,d,e){e.sort(c,d,(f,g)=>b.m_quadTreeIteratorImpl.m_quadTree.getElement(f)-b.m_quadTreeIteratorImpl.m_quadTree.getElement(g))},getValue(c){return b.m_quadTreeIteratorImpl.m_quadTree.getElement(c)}})}if(this.m_index===this.m_sortedHandles.size()-1)return-1;this.m_index++;return this.m_sortedHandles.read(this.m_index)}clone(){p.geometryReleaseAssert(0);return{}}}class bd{constructor(a=!1){this.m_bNotifyOnActions=a}onDelete(a){}onSet(a){}onEndSearch(a){}onAddUniqueElementFailed(a){}onDeleteImpl(a,
b){if(this.m_bNotifyOnActions)this.onDelete(a.getElement(b))}onSetImpl(a,b){if(this.m_bNotifyOnActions)this.onSet(a.getElement(b))}onAddUniqueElementFailedImpl(a){if(this.m_bNotifyOnActions)this.onAddUniqueElementFailed(a)}onEndSearchImpl(a){if(this.m_bNotifyOnActions)this.onEndSearch(a)}}class R{static st_nullNode(){return-1}constructor(){this.m_defaultTreap=-1;this.m_random=124234251;this.m_comparator=null;this.m_treapData=new U(7);this.m_maxDepthEver=this.m_treapCount=0;this.m_bBalancing=!0}setComparator(a){this.m_comparator=
a}getComparator(){return this.m_comparator}disableBalancing(){this.m_bBalancing=!1}enableBalancing(){this.m_bBalancing||(p.geometryReleaseAssert(1>=this.m_treapCount),this.rebalance(-1),this.m_bBalancing=!0)}isAutoBalancing(){return this.m_bBalancing}rebalance(a){if(!this.m_bBalancing&&(-1===a&&(a=this.m_defaultTreap),0!==this.size(a))){var b=[];for(let c=this.getFirst(a);-1!==c;c=this.getNext(c))b.push(c),this.setParent_(c,-1),this.setRight_(c,-1),this.setLeft_(c,-1);this.setRoot_(-1,a);this.setFirst_(-1,
a);this.setLast_(-1,a);this.setSize_(0,a);this.m_bBalancing=!0;for(const c of b)this.addBiggestElement_(c,a);this.m_bBalancing=!1}}setCapacity(a){this.m_treapData.setCapacity(a)}createTreap(a){const b=this.m_treapData.newElement();this.setSize_(0,b);this.setTreapData_(a,b);this.m_treapCount++;return b}deleteTreap(a){this.m_treapData.deleteElement(a);this.m_treapCount--}addElement(a,b=-1){-1===b&&(this.m_defaultTreap===R.st_nullNode()&&(this.m_defaultTreap=this.createTreap(-1)),b=this.m_defaultTreap);
return this.addElement_(a,0,b)}addUniqueElement(a,b=-1){-1===b&&(this.m_defaultTreap===R.st_nullNode()&&(this.m_defaultTreap=this.createTreap(-1)),b=this.m_defaultTreap);return this.addElement_(a,1,b)}addBiggestElement(a,b=-1){-1===b&&(this.m_defaultTreap===R.st_nullNode()&&(this.m_defaultTreap=this.createTreap(-1)),b=this.m_defaultTreap);a=this.newNode_(a);this.addBiggestElement_(a,b);return a}addElementAtPosition(a,b,c,d,e,f=-1){-1===f&&(this.m_defaultTreap===R.st_nullNode()&&(this.m_defaultTreap=
this.createTreap(-1)),f=this.m_defaultTreap);if(this.getRoot_(f)===R.st_nullNode())return c=this.newNode_(c),this.setRoot_(c,f),this.addToList_(-1,c,f),c;let g;e?(e=b!==R.st_nullNode()?this.m_comparator.compare(this,c,b):-1,g=a!==R.st_nullNode()?this.m_comparator.compare(this,c,a):1):(e=-1,g=1);if(d&&(0===e||0===g))return this.m_comparator.onAddUniqueElementFailedImpl(c),this.setDuplicateElement_(0===e?b:a,f),-1;(b!==R.st_nullNode()&&a!==R.st_nullNode()?this.m_random>l.nextRand(this.m_random)>>1:
b!==R.st_nullNode())?(d=e,a=b):d=g;e=b=-1;for(b=!0;;){if(0>d)if(e=this.getLeft(a),e!==R.st_nullNode())a=e;else{e=a;b=this.newNode_(c);this.setLeft_(a,b);this.setParent_(b,a);break}else if(e=this.getRight(a),e!==R.st_nullNode())a=e;else{e=this.getNext(a);b=this.newNode_(c);this.setRight_(a,b);this.setParent_(b,a);break}b&&(d*=-1,b=!1)}this.bubbleUp_(b);this.getParent(b)===R.st_nullNode()&&this.setRoot_(b,f);this.addToList_(e,b,f);return b}replaceElementAtPosition(a,b,c,d,e=-1){if(d){d=this.getNext(a);
let f=-1;d!==R.st_nullNode()&&(f=this.m_comparator.compare(this,b,d));const g=this.getPrev(a);let h=-1;g!==R.st_nullNode()&&(h=this.m_comparator.compare(this,b,g));if(c&&(0===f||0===h))return this.m_comparator.onAddUniqueElementFailedImpl(b),a=0===f?d:g,e===R.st_nullNode()&&(this.m_defaultTreap===R.st_nullNode()&&(this.m_defaultTreap=this.createTreap(-1)),e=this.m_defaultTreap),this.setDuplicateElement_(a,e),-1}this.setElement_(a,b);return a}getDuplicateElement(a=-1){return-1===a?this.getDuplicateElement_(this.m_defaultTreap):
this.getDuplicateElement_(a)}deleteNode(a,b=-1){if(this.m_comparator)this.m_comparator.onDeleteImpl(this,a);-1===b&&(b=this.m_defaultTreap);this.m_bBalancing?this.deleteNode_(a,b):this.unbalancedDelete_(a,b)}search(a,b=-1){for(b=this.getRoot(b);b!==R.st_nullNode();){const c=this.m_comparator.compare(this,a,b);if(c)b=0>c?this.getLeft(b):this.getRight(b);else return b}this.m_comparator.onEndSearchImpl(a);return R.st_nullNode()}searchLowerBound(a,b=-1){b=this.getRoot(b);let c=-1;for(;b!==R.st_nullNode();){const d=
a.compare(this,b);if(d)0>d?b=this.getLeft(b):(c=b,b=this.getRight(b));else return b}return c}searchUpperBound(a,b=-1){b=this.getRoot(b);let c=-1;for(;b!==R.st_nullNode();){const d=a.compare(this,b);if(d)0>d?(c=b,b=this.getLeft(b)):b=this.getRight(b);else return b}return c}getElement(a){return this.m_treapData.getField(a,3)}getLeft(a){return this.m_treapData.getField(a,0)}getRight(a){return this.m_treapData.getField(a,1)}getParent(a){return this.m_treapData.getField(a,2)}getNext(a){return this.m_treapData.getField(a,
6)}getPrev(a){return this.m_treapData.getField(a,5)}getFirst(a=-1){return-1===a?this.getFirst_(this.m_defaultTreap):this.getFirst_(a)}getLast(a=-1){return-1===a?this.getLast_(this.m_defaultTreap):this.getLast_(a)}getTreapData(a=-1){return-1===a?this.getTreapData_(this.m_defaultTreap):this.getTreapData_(a)}setElement(a,b){if(null!==this.m_comparator)this.m_comparator.onSetImpl(this,a);this.setElement_(a,b)}getRoot(a=-1){return-1===a?this.getRoot_(this.m_defaultTreap):this.getRoot_(a)}clear(){this.m_treapData.deleteAll(!1);
this.m_defaultTreap=R.st_nullNode();this.m_maxDepthEver=this.m_treapCount=0}addToList_(a,b,c){let d;-1!==a?(d=this.getPrev(a),this.setPrev_(a,b)):d=this.getLast_(c);this.setPrev_(b,d);-1!==d&&this.setNext_(d,b);this.setNext_(b,a);a===this.getFirst_(c)&&this.setFirst_(b,c);-1===a&&this.setLast_(b,c);this.setSize_(this.getSize_(c)+1,c)}size(a=-1){return-1===a?this.getSize_(this.m_defaultTreap):this.getSize_(a)}getMaxDepth(a=-1){return this.getMaxDepthHelper_(this.getRoot(a))}getMaxDepthEver(){return this.m_maxDepthEver}static st_isValidNode(a){return U.isValidElement(a)}dbgCheck_(a){p.geometryReleaseAssert(0)}getPriority_(a){return this.m_treapData.getField(a,
4)}bubbleDown_(a){let b=this.getLeft(a);var c=this.getRight(a);const d=this.getPriority_(a);for(;b!==R.st_nullNode()||c!==R.st_nullNode();){const e=b!==R.st_nullNode()?this.getPriority_(b):l.indexTypeMax();c=c!==R.st_nullNode()?this.getPriority_(c):l.indexTypeMax();if(d<=Math.min(e,c))break;e<=c?this.rotateRight_(b):this.rotateLeft_(a);b=this.getLeft(a);c=this.getRight(a)}}bubbleUp_(a){if(this.m_bBalancing)for(var b=this.getPriority_(a),c=this.getParent(a);c!==R.st_nullNode()&&this.getPriority_(c)>
b;)this.getLeft(c)===a?this.rotateRight_(a):this.rotateLeft_(c),c=this.getParent(a)}rotateLeft_(a){const b=this.getRight(a);let c;this.setParent_(b,this.getParent(a));this.setParent_(a,b);c=this.getLeft(b);this.setRight_(a,c);c!==R.st_nullNode()&&this.setParent_(c,a);this.setLeft_(b,a);c=this.getParent(b);c!==R.st_nullNode()&&(this.getLeft(c)===a?this.setLeft_(c,b):this.setRight_(c,b))}rotateRight_(a){const b=this.getParent(a);let c;this.setParent_(a,this.getParent(b));this.setParent_(b,a);c=this.getRight(a);
this.setLeft_(b,c);c!==R.st_nullNode()&&this.setParent_(c,b);this.setRight_(a,b);c=this.getParent(a);c!==R.st_nullNode()&&(this.getLeft(c)===b?this.setLeft_(c,a):this.setRight_(c,a))}setParent_(a,b){this.m_treapData.setField(a,2,b)}setLeft_(a,b){this.m_treapData.setField(a,0,b)}setRight_(a,b){this.m_treapData.setField(a,1,b)}setPriority_(a,b){this.m_treapData.setField(a,4,b)}setPrev_(a,b){this.m_treapData.setField(a,5,b)}setNext_(a,b){this.m_treapData.setField(a,6,b)}setRoot_(a,b){this.m_treapData.setField(b,
0,a)}setFirst_(a,b){this.m_treapData.setField(b,1,a)}setLast_(a,b){this.m_treapData.setField(b,2,a)}setDuplicateElement_(a,b){this.m_treapData.setField(b,3,a)}setSize_(a,b){this.m_treapData.setField(b,4,a)}setTreapData_(a,b){this.m_treapData.setField(b,5,a)}getRoot_(a){return-1===a?R.st_nullNode():this.m_treapData.getField(a,0)}getFirst_(a){return-1===a?R.st_nullNode():this.m_treapData.getField(a,1)}getLast_(a){return-1===a?R.st_nullNode():this.m_treapData.getField(a,2)}getDuplicateElement_(a){return-1===
a?R.st_nullNode():this.m_treapData.getField(a,3)}getSize_(a){return-1===a?0:this.m_treapData.getField(a,4)}getTreapData_(a){return this.m_treapData.getField(a,5)}newNode_(a){const b=this.m_treapData.newElement();this.setPriority_(b,this.generatePriority_());this.setElement_(b,a);return b}freeNode_(a,b){a!==R.st_nullNode()&&this.m_treapData.deleteElement(a)}generatePriority_(){this.m_random=l.nextRand(this.m_random);return this.m_random&l.indexTypeMax()>>1}maxPriority(){p.geometryReleaseAssert(0);
return 0}getMaxDepthHelper_(a){return a===R.st_nullNode()?0:1+Math.max(this.getMaxDepthHelper_(this.getLeft(a)),this.getMaxDepthHelper_(this.getRight(a)))}addElement_(a,b,c){if(this.getRoot(c)===R.st_nullNode())return a=this.newNode_(a),this.setRoot_(a,c),this.addToList_(-1,a,c),this.m_maxDepthEver=Math.max(this.m_maxDepthEver,1),a;let d=this.getRoot_(c);var e=-1;let f=-1,g=1;for(;;){e=-1===b?1:this.m_comparator.compare(this,a,d);if(0>e)if(e=this.getLeft(d),e!==R.st_nullNode())d=e;else{f=d;e=this.newNode_(a);
this.setLeft_(d,e);this.setParent_(e,d);break}else{if(1===b&&0===e)return this.m_comparator.onAddUniqueElementFailedImpl(a),this.setDuplicateElement_(d,c),-1;e=this.getRight(d);if(e!==R.st_nullNode())d=e;else{f=this.getNext(d);e=this.newNode_(a);this.setRight_(d,e);this.setParent_(e,d);break}}g++}this.bubbleUp_(e);this.getParent(e)===R.st_nullNode()&&this.setRoot_(e,c);this.addToList_(f,e,c);this.m_maxDepthEver=Math.max(g,this.m_maxDepthEver);return e}removeFromList_(a,b){const c=this.getPrev(a);
a=this.getNext(a);-1!==c?this.setNext_(c,a):this.setFirst_(a,b);-1!==a?this.setPrev_(a,c):this.setLast_(c,b);this.setSize_(this.getSize_(b)-1,b)}unbalancedDelete_(a,b){this.removeFromList_(a,b);var c=this.getLeft(a);let d=this.getRight(a),e=this.getParent(a),f=a;if(-1!==c&&-1!==d){this.m_random=l.nextRand(this.m_random);let g;g=this.m_random>l.indexTypeMax()>>1?this.getNext(a):this.getPrev(a);const h=this.getParent(g)===a;this.m_treapData.swapField(a,g,0);this.m_treapData.swapField(a,g,1);this.m_treapData.swapField(a,
g,2);-1!==e?this.getLeft(e)===a?this.setLeft_(e,g):this.setRight_(e,g):this.setRoot_(g,b);h?(c===g?(this.setLeft_(g,a),this.setParent_(d,g)):d===g&&(this.setRight_(g,a),this.setParent_(c,g)),this.setParent_(a,g),e=g):(this.setParent_(c,g),this.setParent_(d,g),e=this.getParent(a),f=g);c=this.getLeft(a);d=this.getRight(a);-1!==c&&this.setParent_(c,a);-1!==d&&this.setParent_(d,a)}c=-1!==c?c:d;-1===e?this.setRoot_(c,b):this.getLeft(e)===f?this.setLeft_(e,c):this.setRight_(e,c);-1!==c&&this.setParent_(c,
e);this.freeNode_(a,b)}deleteNode_(a,b){this.setPriority_(a,l.indexTypeMax());let c=R.st_nullNode(),d=R.st_nullNode();var e=this.getRoot_(b);const f=e===a;if(f&&(c=this.getLeft(e),d=this.getRight(e),c===R.st_nullNode()&&d===R.st_nullNode())){this.removeFromList_(e,b);this.freeNode_(e,b);this.setRoot_(R.st_nullNode(),b);return}this.bubbleDown_(a);e=this.getParent(a);e!==R.st_nullNode()&&(this.getLeft(e)===a?this.setLeft_(e,R.st_nullNode()):this.setRight_(e,R.st_nullNode()));this.removeFromList_(a,
b);this.freeNode_(a,b);f&&this.setRoot_(c===R.st_nullNode()||this.getParent(c)!==R.st_nullNode()?d:c,b)}setElement_(a,b){this.m_treapData.setField(a,3,b)}addBiggestElement_(a,b){if(this.getRoot_(b)===R.st_nullNode())this.setRoot_(a,b);else{var c=this.getLast_(b);this.setRight_(c,a);this.setParent_(a,c);this.bubbleUp_(a);this.getParent(a)===R.st_nullNode()&&this.setRoot_(a,b)}this.addToList_(-1,a,b)}}class ab{constructor(a){this.m_lists=new U(6);this.m_listOfLists=ab.st_nullNode();void 0===a?(this.m_listNodes=
new U(3),this.m_bStoreListIndexWithNode=!1):(this.m_listNodes=new U(a?4:3),this.m_bStoreListIndexWithNode=a)}freeNode_(a){this.m_listNodes.deleteElement(a)}newNode_(){return this.m_listNodes.newElement()}freeList_(a){p.geometryReleaseAssert(0)}newList_(){return this.m_lists.newElement()}setPrev_(a,b){this.m_listNodes.setField(a,1,b)}setNext_(a,b){this.m_listNodes.setField(a,2,b)}setData_(a,b){p.geometryReleaseAssert(0)}setList_(a,b){return this.m_listNodes.setField(a,3,b)}setListSize_(a,b){this.m_lists.setField(a,
4,b)}setNextList_(a,b){p.geometryReleaseAssert(0)}setPrevList_(a,b){this.m_lists.setField(a,2,b)}createList(a){const b=this.newList_();this.m_lists.setField(b,3,this.m_listOfLists);this.m_lists.setField(b,4,0);this.m_lists.setField(b,5,a);this.m_listOfLists!==ab.st_nullNode()&&this.setPrevList_(this.m_listOfLists,b);return this.m_listOfLists=b}deleteList(a){this.clear(a);const b=this.m_lists.getField(a,2),c=this.m_lists.getField(a,3);b!==ab.st_nullNode()?this.setNextList_(b,c):this.m_listOfLists=
c;c!==ab.st_nullNode()&&this.setPrevList_(c,b);this.freeList_(a);return c}reserveLists(a){p.geometryReleaseAssert(0)}getListData(a){return this.m_lists.getField(a,5)}getList(a){p.geometryReleaseAssert(0);return 0}setListData(a,b){this.m_lists.setField(a,5,b)}addElement(a,b){return this.insertElement(a,-1,b)}insertElement(a,b,c){const d=this.newNode_();var e=-1;b!==ab.st_nullNode()&&(e=this.getPrev(b),this.setPrev_(b,d));this.setNext_(d,b);e!==ab.st_nullNode()&&this.setNext_(e,d);e=this.m_lists.getField(a,
0);b===e&&this.m_lists.setField(a,0,d);b===ab.st_nullNode()&&(b=this.m_lists.getField(a,1),this.setPrev_(d,b),-1!==b&&this.setNext_(b,d),this.m_lists.setField(a,1,d));this.setData(d,c);this.setListSize_(a,this.getListSize(a)+1);this.m_bStoreListIndexWithNode&&this.setList_(d,a);return d}deleteElement(a,b){const c=this.getPrev(b),d=this.getNext(b);c!==ab.st_nullNode()?this.setNext_(c,d):this.m_lists.setField(a,0,d);d!==ab.st_nullNode()?this.setPrev_(d,c):this.m_lists.setField(a,1,c);this.freeNode_(b);
this.setListSize_(a,this.getListSize(a)-1);return d}reserveNodes(a){this.m_listNodes.setCapacity(a)}getData(a){return this.m_listNodes.getField(a,0)}getElement(a){return this.getData(a)}setData(a,b){this.m_listNodes.setField(a,0,b)}getNext(a){return this.m_listNodes.getField(a,2)}getPrev(a){return this.m_listNodes.getField(a,1)}getFirst(a){return this.m_lists.getField(a,0)}getLast(a){return this.m_lists.getField(a,1)}static st_nullNode(){return-1}clear(a){if(void 0!==a){let b=this.getLast(a);for(;b!==
ab.st_nullNode();){const c=b;b=this.getPrev(c);this.freeNode_(c)}this.m_lists.setField(a,0,-1);this.m_lists.setField(a,1,-1);this.setListSize_(a,0)}else for(a=this.getFirstList();-1!==a;)a=this.deleteList(a)}isEmpty(a){p.geometryReleaseAssert(0);return!1}getNodeCount(){return this.m_listNodes.size()}getListCount(){return this.m_lists.size()}getListSize(a){return this.m_lists.getField(a,4)}getFirstList(){return this.m_listOfLists}getNextList(a){return this.m_lists.getField(a,3)}}class tn extends bd{constructor(a){super();
this.m_intervalTree=a}compare(a,b,c){a=a.getElement(c);c=this.m_intervalTree.getValue_(b);const d=this.m_intervalTree.getValue_(a);return c<d?-1:c===d?pb.isLeft_(b)&&pb.isRight_(a)?-1:pb.isLeft_(a)&&pb.isRight_(b)?1:0:1}}class pb{constructor(a){this.m_bEnvelopesRef=!1;this.m_intervals=[];this.m_envelopesRef=null;this.m_intervalNodes=new U(3);this.m_intervalHandles=[];this.m_endIndicesUnique=[];this.m_root=this.m_cCount=-1;this.m_bConstructionEnded=this.m_bConstructing=this.m_bSortIntervals=!1;this.m_bOfflineDynamic=
a;this.m_tertiaryNodes=new U(this.m_bOfflineDynamic?5:4);this.m_secondaryTreaps=new R;this.m_secondaryTreaps.setComparator(new tn(this));this.m_secondaryLists=new ab}addEnvelopesRef(a){this.reset_(!0,!0);this.m_bEnvelopesRef=!0;this.m_envelopesRef=a;this.m_bConstructing=!1;this.m_bConstructionEnded=!0;this.m_bOfflineDynamic||(this.insertIntervalsStatic_(),this.m_cCount=this.m_envelopesRef.length)}startConstruction(){this.reset_(!0,!1)}addInterval(a){this.m_bConstructing||p.throwInvalidCallException("");
this.m_intervals.push(a.clone())}addIntervalCoords(a,b){p.geometryReleaseAssert(0)}endConstruction(){this.m_bConstructing||p.throwInvalidCallException("");this.m_bConstructing=!1;this.m_bConstructionEnded=!0;this.m_bOfflineDynamic||(this.insertIntervalsStatic_(),this.m_cCount=this.m_intervals.length)}insert(a){this.m_bOfflineDynamic&&this.m_bConstructionEnded||p.throwInvalidCallException("");if(-1===this.m_root){var b=this.m_bEnvelopesRef?this.m_envelopesRef.length:this.m_intervals.length;if(this.m_bSortIntervals){var c=
new za(0);this.querySortedEndPointIndices_(c);this.m_endIndicesUnique.length=0;this.querySortedDuplicatesRemoved_(c);this.m_intervalHandles.length=b;this.m_intervalHandles.fill(-1);this.m_bSortIntervals=!1}else this.m_intervalHandles.fill(-1,0,b);this.m_root=this.createRoot_()}b=this.insertIntervalEnd_(a<<1,this.m_root);c=this.getSecondaryFromInterval_(b);c=this.m_secondaryTreaps.addElement((a<<1)+1,c);this.setRightEnd_(b,c);this.m_intervalHandles[a]=b;this.m_cCount++}remove(a){this.m_bOfflineDynamic&&
this.m_bConstructionEnded||p.throwInvalidCallException("");var b=this.m_intervalHandles[a];-1===b&&p.throwInvalidArgumentException("the interval does not exist in the interval tree");this.m_intervalHandles[a]=-1;this.m_cCount--;var c=this.getSecondaryFromInterval_(b);let d=-1;d=this.m_secondaryTreaps.getTreapData(c);this.m_secondaryTreaps.deleteNode(this.getLeftEnd_(b),c);this.m_secondaryTreaps.deleteNode(this.getRightEnd_(b),c);a=this.m_secondaryTreaps.size(c);0===a&&(this.m_secondaryTreaps.deleteTreap(c),
this.setSecondaryToTertiary_(d,-1));this.m_intervalNodes.deleteElement(b);b=this.getPptr_(d);c=this.getLptr_(d);let e=this.getRptr_(d);for(;!(0<a||d===this.m_root||-1!==c&&-1!==e);)d===this.getLptr_(b)?-1!==c?(this.setLptr_(b,c),this.setPptr_(c,b),this.setLptr_(d,-1)):-1!==e?(this.setLptr_(b,e),this.setPptr_(e,b),this.setRptr_(d,-1)):this.setLptr_(b,-1):-1!==c?(this.setRptr_(b,c),this.setPptr_(c,b),this.setLptr_(d,-1)):-1!==e?(this.setRptr_(b,e),this.setPptr_(e,b),this.setRptr_(d,-1)):this.setRptr_(b,
-1),this.setPptr_(d,-1),this.m_tertiaryNodes.deleteElement(d),d=b,c=this.getSecondaryFromTertiary_(d),a=-1!==c?this.m_secondaryTreaps.size(c):0,c=this.getLptr_(d),e=this.getRptr_(d),b=this.getPptr_(d)}size(){return this.m_cCount}getIteratorQuery(a,b){if(a instanceof l.Envelope1D)return new Dl(this,a,b);p.geometryReleaseAssert(0);return{}}getIterator(){return new Dl(this)}querySortedEndPointIndices_(a){const b=this.m_bEnvelopesRef?this.m_envelopesRef.length:this.m_intervals.length;for(let c=0;c<2*
b;c++)a.add(c);this.sortEndIndices_(a,0,2*b)}querySortedDuplicatesRemoved_(a){let b=Number.NaN;for(let c=0;c<a.size();c++){const d=a.read(c),e=this.getValue_(d);e!==b&&(this.m_endIndicesUnique.push(d),b=e)}}insertIntervalsStatic_(){var a=this.m_bEnvelopesRef?this.m_envelopesRef.length:this.m_intervals.length;const b=new za(0);this.querySortedEndPointIndices_(b);this.m_endIndicesUnique.length=0;this.querySortedDuplicatesRemoved_(b);this.m_intervalNodes.setCapacity(a);this.m_secondaryLists.reserveNodes(2*
a);a=l.makePrimitiveArray(a,-1);this.m_root=this.createRoot_();for(let c=0;c<b.size();c++){const d=b.read(c);let e=a[d>>1];if(-1!==e){const f=this.getSecondaryFromInterval_(e);this.setRightEnd_(e,this.m_secondaryLists.addElement(f,d))}else e=this.insertIntervalEnd_(d,this.m_root),a[d>>1]=e}}createRoot_(){const a=this.calculateDiscriminantIndex1_(0,this.m_endIndicesUnique.length-1);return this.createTertiaryNode_(a)}insertIntervalEnd_(a,b){let c=-1;var d=-1;let e=-1,f=0,g=this.m_endIndicesUnique.length-
1,h=0;var k=a>>1;let m=Number.NaN;var n=Number.NaN;d=!0;var q=this.getMin_(k);const r=this.getMax_(k);let t=-1;for(;d;)if(h=f+(g-f>>1),t=this.calculateDiscriminantIndex1_(f,g),k=this.getDiscriminantFromIndex1_(t),r<k)-1!==b&&(t===this.getDiscriminantIndex1_(b)?(c=b,m=k,b=this.getLptr_(b),n=-1!==b?this.getDiscriminant_(b):Number.NaN):n>k&&(n=this.createTertiaryNode_(t),k<m?this.setLptr_(c,n):this.setRptr_(c,n),this.setRptr_(n,b),this.m_bOfflineDynamic&&(this.setPptr_(n,c),this.setPptr_(b,n)),c=n,m=
k,b=-1,n=Number.NaN)),g=h;else if(q>k)-1!==b&&(t===this.getDiscriminantIndex1_(b)?(c=b,m=k,b=this.getRptr_(b),n=-1!==b?this.getDiscriminant_(b):Number.NaN):n<k&&(n=this.createTertiaryNode_(t),k<m?this.setLptr_(c,n):this.setRptr_(c,n),this.setLptr_(n,b),this.m_bOfflineDynamic&&(this.setPptr_(n,c),this.setPptr_(b,n)),c=n,m=k,b=-1,n=Number.NaN)),f=h+1;else{q=-1;q=-1===b||t!==this.getDiscriminantIndex1_(b)?this.createTertiaryNode_(t):b;d=this.getSecondaryFromTertiary_(q);-1===d&&(d=this.createSecondary_(q),
this.setSecondaryToTertiary_(q,d));a=this.addEndIndex_(d,a);e=this.createIntervalNode_();this.setSecondaryToInterval_(e,d);this.setLeftEnd_(e,a);if(-1===b||t!==this.getDiscriminantIndex1_(b))k<m?this.setLptr_(c,q):this.setRptr_(c,q),this.m_bOfflineDynamic&&this.setPptr_(q,c),-1!==b&&(n<k?this.setLptr_(q,b):this.setRptr_(q,b),this.m_bOfflineDynamic&&this.setPptr_(b,q));d=!1;break}return e}createTertiaryNode_(a){const b=this.m_tertiaryNodes.newElement();this.setDiscriminantIndex1_(b,a);return b}createSecondary_(a){return this.m_bOfflineDynamic?
this.m_secondaryTreaps.createTreap(a):this.m_secondaryLists.createList(a)}createIntervalNode_(){return this.m_intervalNodes.newElement()}reset(){this.m_bOfflineDynamic&&this.m_bConstructionEnded||p.throwInvalidCallException("");this.reset_(!1,this.m_bEnvelopesRef)}reset_(a,b){a?(this.m_bEnvelopesRef=!1,this.m_envelopesRef=null,this.m_bConstructing=this.m_bSortIntervals=!0,this.m_bConstructionEnded=!1,this.m_endIndicesUnique.length=0,b?(this.m_intervals.length=0,this.m_bEnvelopesRef=!0):this.m_intervals.length=
0):this.m_bSortIntervals=!1;this.m_bOfflineDynamic?this.m_secondaryTreaps.clear():this.m_secondaryLists.clear();this.m_intervalNodes.deleteAll(!1);this.m_tertiaryNodes.deleteAll(!1);this.m_root=-1;this.m_cCount=0}getDiscriminant_(a){a=this.getDiscriminantIndex1_(a);return this.getDiscriminantFromIndex1_(a)}getDiscriminantFromIndex1_(a){if(-1===a)return Number.NaN;if(0<a){var b=a-2;a=this.m_endIndicesUnique[b+1];b=this.getValue_(this.m_endIndicesUnique[b]);a=this.getValue_(a);return.5*(b+a)}return this.getValue_(this.m_endIndicesUnique[-a-
2])}calculateDiscriminantIndex1_(a,b){return a<b?a+(b-a>>1)+2:-(a+2)}setDiscriminantIndex1_(a,b){this.m_tertiaryNodes.setField(a,0,b)}setSecondaryToTertiary_(a,b){this.m_tertiaryNodes.setField(a,1,b)}setLptr_(a,b){this.m_tertiaryNodes.setField(a,2,b)}setRptr_(a,b){this.m_tertiaryNodes.setField(a,3,b)}setPptr_(a,b){this.m_tertiaryNodes.setField(a,4,b)}setSecondaryToInterval_(a,b){this.m_intervalNodes.setField(a,0,b)}addEndIndex_(a,b){let c=-1;return c=this.m_bOfflineDynamic?this.m_secondaryTreaps.addElement(b,
a):this.m_secondaryLists.addElement(a,b)}setLeftEnd_(a,b){this.m_intervalNodes.setField(a,1,b)}setRightEnd_(a,b){this.m_intervalNodes.setField(a,2,b)}getFirst_(a){return this.m_bOfflineDynamic?this.m_secondaryTreaps.getFirst(a):this.m_secondaryLists.getFirst(a)}getLast_(a){return this.m_bOfflineDynamic?this.m_secondaryTreaps.getLast(a):this.m_secondaryLists.getLast(a)}static isLeft_(a){return 0===(a&1)}static isRight_(a){return 1===(a&1)}getDiscriminantIndex1_(a){return this.m_tertiaryNodes.getField(a,
0)}getSecondaryFromTertiary_(a){return this.m_tertiaryNodes.getField(a,1)}getLptr_(a){return this.m_tertiaryNodes.getField(a,2)}getRptr_(a){return this.m_tertiaryNodes.getField(a,3)}getPptr_(a){return this.m_tertiaryNodes.getField(a,4)}getSecondaryFromInterval_(a){return this.m_intervalNodes.getField(a,0)}getLeftEnd_(a){return this.m_intervalNodes.getField(a,1)}getRightEnd_(a){return this.m_intervalNodes.getField(a,2)}getMin_(a){return this.m_bEnvelopesRef?this.m_envelopesRef[a].xmin:this.m_intervals[a].vmin}getMax_(a){return this.m_bEnvelopesRef?
this.m_envelopesRef[a].xmax:this.m_intervals[a].vmax}sortEndIndices_(a,b,c){const d=this;(new Zb).sort(a,b,c,{userSort(e,f,g){d.sortEndIndicesHelper_(g,e,f)},getValue(e){return d.getValue_(e)}})}sortEndIndicesHelper_(a,b,c){a.sort(b,c,(d,e)=>{const f=this.getValue_(d),g=this.getValue_(e);return f<g||f===g&&pb.isLeft_(d)&&pb.isRight_(e)?-1:1})}getValue_(a){if(!this.m_bEnvelopesRef){var b=this.m_intervals[a>>1];return pb.isLeft_(a)?b.vmin:b.vmax}b=this.m_envelopesRef[a>>1];return pb.isLeft_(a)?b.xmin:
b.xmax}checkValidation_(){p.geometryReleaseAssert(0);return!1}checkValidationHelper_(a){p.geometryReleaseAssert(0);return 0}}class Dl{constructor(a,b,c){this.m_query=l.Envelope1D.constructEmpty();this.m_nextEndHandle=this.m_currentEndHandle=this.m_forkedHandle=this.m_nextTertiaryHandle=this.m_tertiaryHandle=-1;this.m_tertiaryStack=[];this.m_functionIndex=0;this.m_intervalTree=a;this.m_functionStack=Array(2);this.m_functionStack[0]=this.nullFunc_;this.m_functionStack[1]=this.nullFunc_;void 0!==b&&
this.resetIterator(b,c)}nullFunc_(){p.geometryReleaseAssert(0);return!1}resetIterator(a,b){if("number"===typeof a){const c=new l.Envelope1D;c.setCoords(a,a);this.resetIterator(c,b)}else void 0===b&&(b=0),this.m_query.vmin=a.vmin-b,this.m_query.vmax=a.vmax+b,this.m_functionIndex=this.m_tertiaryStack.length=0,this.m_functionStack[0]=this.initialize_}next(){this.m_intervalTree.m_bConstructionEnded||p.throwInvalidCallException("");if(0>this.m_functionIndex)return-1;for(;this.m_fi=this.m_functionStack[this.m_functionIndex],
this.m_fi(););return-1!==this.m_currentEndHandle?this.getCurrentEndIndex_()>>1:-1}initialize_(){this.m_currentEndHandle=this.m_forkedHandle=this.m_nextTertiaryHandle=this.m_tertiaryHandle=-1;if(0<this.m_intervalTree.m_tertiaryNodes.size())return this.m_functionStack[0]=this.pIn_,this.m_nextTertiaryHandle=this.m_intervalTree.m_root,!0;this.m_functionIndex=-1;return!1}pIn_(){this.m_tertiaryHandle=this.m_nextTertiaryHandle;if(-1===this.m_tertiaryHandle)return this.m_currentEndHandle=this.m_functionIndex=
-1,!1;var a=this.m_intervalTree.getDiscriminant_(this.m_tertiaryHandle);if(this.m_query.vmax<a)return a=this.m_intervalTree.getSecondaryFromTertiary_(this.m_tertiaryHandle),this.m_nextTertiaryHandle=this.m_intervalTree.getLptr_(this.m_tertiaryHandle),-1!==a&&(this.m_nextEndHandle=this.m_intervalTree.getFirst_(a),this.m_functionStack[++this.m_functionIndex]=this.left_),!0;if(a<this.m_query.vmin)return a=this.m_intervalTree.getSecondaryFromTertiary_(this.m_tertiaryHandle),this.m_nextTertiaryHandle=
this.m_intervalTree.getRptr_(this.m_tertiaryHandle),-1!==a&&(this.m_nextEndHandle=this.m_intervalTree.getLast_(a),this.m_functionStack[++this.m_functionIndex]=this.right_),!0;this.m_functionStack[this.m_functionIndex]=this.pL_;this.m_forkedHandle=this.m_tertiaryHandle;a=this.m_intervalTree.getSecondaryFromTertiary_(this.m_tertiaryHandle);this.m_nextTertiaryHandle=this.m_intervalTree.getLptr_(this.m_tertiaryHandle);-1!==a&&(this.m_nextEndHandle=this.m_intervalTree.getFirst_(a),this.m_functionStack[++this.m_functionIndex]=
this.all_);return!0}pL_(){this.m_tertiaryHandle=this.m_nextTertiaryHandle;if(-1===this.m_tertiaryHandle)return this.m_functionStack[this.m_functionIndex]=this.pR_,this.m_nextTertiaryHandle=this.m_intervalTree.getRptr_(this.m_forkedHandle),!0;if(this.m_intervalTree.getDiscriminant_(this.m_tertiaryHandle)<this.m_query.vmin){var a=this.m_intervalTree.getSecondaryFromTertiary_(this.m_tertiaryHandle);this.m_nextTertiaryHandle=this.m_intervalTree.getRptr_(this.m_tertiaryHandle);-1!==a&&(this.m_nextEndHandle=
this.m_intervalTree.getLast_(a),this.m_functionStack[++this.m_functionIndex]=this.right_);return!0}a=this.m_intervalTree.getSecondaryFromTertiary_(this.m_tertiaryHandle);this.m_nextTertiaryHandle=this.m_intervalTree.getLptr_(this.m_tertiaryHandle);-1!==a&&(this.m_nextEndHandle=this.m_intervalTree.getFirst_(a),this.m_functionStack[++this.m_functionIndex]=this.all_);a=this.m_intervalTree.getRptr_(this.m_tertiaryHandle);-1!==a&&this.m_tertiaryStack.push(a);return!0}pR_(){this.m_tertiaryHandle=this.m_nextTertiaryHandle;
if(-1===this.m_tertiaryHandle)return this.m_functionStack[this.m_functionIndex]=this.pT_,!0;var a=this.m_intervalTree.getDiscriminant_(this.m_tertiaryHandle);if(this.m_query.vmax<a)return a=this.m_intervalTree.getSecondaryFromTertiary_(this.m_tertiaryHandle),this.m_nextTertiaryHandle=this.m_intervalTree.getLptr_(this.m_tertiaryHandle),-1!==a&&(this.m_nextEndHandle=this.m_intervalTree.getFirst_(a),this.m_functionStack[++this.m_functionIndex]=this.left_),!0;a=this.m_intervalTree.getSecondaryFromTertiary_(this.m_tertiaryHandle);
this.m_nextTertiaryHandle=this.m_intervalTree.getRptr_(this.m_tertiaryHandle);-1!==a&&(this.m_nextEndHandle=this.m_intervalTree.getFirst_(a),this.m_functionStack[++this.m_functionIndex]=this.all_);a=this.m_intervalTree.getLptr_(this.m_tertiaryHandle);-1!==a&&this.m_tertiaryStack.push(a);return!0}pT_(){if(0===this.m_tertiaryStack.length)return this.m_currentEndHandle=this.m_functionIndex=-1,!1;this.m_tertiaryHandle=this.m_tertiaryStack.at(-1);this.m_tertiaryStack.pop();const a=this.m_intervalTree.getSecondaryFromTertiary_(this.m_tertiaryHandle);
-1!==a&&(this.m_nextEndHandle=this.m_intervalTree.getFirst_(a),this.m_functionStack[++this.m_functionIndex]=this.all_);-1!==this.m_intervalTree.getLptr_(this.m_tertiaryHandle)&&this.m_tertiaryStack.push(this.m_intervalTree.getLptr_(this.m_tertiaryHandle));-1!==this.m_intervalTree.getRptr_(this.m_tertiaryHandle)&&this.m_tertiaryStack.push(this.m_intervalTree.getRptr_(this.m_tertiaryHandle));return!0}left_(){this.m_currentEndHandle=this.m_nextEndHandle;if(-1!==this.m_currentEndHandle&&pb.isLeft_(this.getCurrentEndIndex_())&&
this.m_intervalTree.getValue_(this.getCurrentEndIndex_())<=this.m_query.vmax)return this.m_nextEndHandle=this.getNext_(),!1;this.m_functionIndex--;return!0}right_(){this.m_currentEndHandle=this.m_nextEndHandle;if(-1!==this.m_currentEndHandle&&pb.isRight_(this.getCurrentEndIndex_())&&this.m_intervalTree.getValue_(this.getCurrentEndIndex_())>=this.m_query.vmin)return this.m_nextEndHandle=this.getPrev_(),!1;this.m_functionIndex--;return!0}all_(){this.m_currentEndHandle=this.m_nextEndHandle;if(-1!==this.m_currentEndHandle&&
pb.isLeft_(this.getCurrentEndIndex_()))return this.m_nextEndHandle=this.getNext_(),!1;this.m_functionIndex--;return!0}getNext_(){return this.m_intervalTree.m_bOfflineDynamic?this.m_intervalTree.m_secondaryTreaps.getNext(this.m_currentEndHandle):this.m_intervalTree.m_secondaryLists.getNext(this.m_currentEndHandle)}getPrev_(){return this.m_intervalTree.m_bOfflineDynamic?this.m_intervalTree.m_secondaryTreaps.getPrev(this.m_currentEndHandle):this.m_intervalTree.m_secondaryLists.getPrev(this.m_currentEndHandle)}getCurrentEndIndex_(){return this.m_intervalTree.m_bOfflineDynamic?
this.m_intervalTree.m_secondaryTreaps.getElement(this.m_currentEndHandle):this.m_intervalTree.m_secondaryLists.getData(this.m_currentEndHandle)}}class Od{constructor(){this.m_tolerance=0;this.m_envelopeHandleB=this.m_envelopeHandleA=this.m_sweepIndexBlue=this.m_sweepIndexRed=-1;this.m_iteratorBlue=this.m_iteratorRed=this.m_intervalTreeBlue=this.m_intervalTreeRed=null;this.m_envelopesRed=[];this.m_envelopesBlue=[];this.m_elementsRed=[];this.m_elementsBlue=[];this.m_sortedEndIndicesRed=new za(0);this.m_sortedEndIndicesBlue=
new za(0);this.m_queuedListBlue=this.m_queuedListRed=-1;this.m_queuedEnvelopes=new ab;this.m_queuedIndicesRed=[];this.m_queuedIndicesBlue=[];this.m_bAddRedRed=this.m_bAddBlue=this.m_bAddRed=!1;this.m_bDone=!0;this.m_function=this.nullFunc_;this.reset_()}startConstruction(){this.reset_();this.m_bAddRedRed=!0;this.m_elementsRed.length=0;this.m_envelopesRed.length=0}addEnvelope(a,b){this.m_bAddRedRed||p.throwInvalidCallException("");this.m_elementsRed.push(a);this.m_envelopesRed.push(new D(b))}endConstruction(){this.m_bAddRedRed||
p.throwInvalidCallException("");this.m_bAddRedRed=!1;0<this.m_envelopesRed.length&&(this.m_function=this.initialize_,this.m_bDone=!1)}startRedConstruction(){this.reset_();this.m_bAddRed=!0;this.m_elementsRed.length=0;this.m_envelopesRed.length=0}addRedEnvelope(a,b){this.m_bAddRed||p.throwInvalidCallException("");this.m_elementsRed.push(a);this.m_envelopesRed.push(b.clone())}endRedConstruction(){this.m_bAddRed||p.throwInvalidCallException("");this.m_bAddRed=!1;0<this.m_envelopesRed.length&&0<this.m_envelopesBlue.length&&
(this.m_function===this.nullFunc_?this.m_function=this.initializeRedBlue_:this.m_function===this.initializeBlue_?this.m_function=this.initializeRedBlue_:this.m_function!==this.initializeRedBlue_&&(this.m_function=this.initializeRed_),this.m_bDone=!1)}startBlueConstruction(){this.reset_();this.m_bAddBlue=!0;this.m_elementsBlue.length=0;this.m_envelopesBlue.length=0}addBlueEnvelope(a,b){this.m_bAddBlue||p.throwInvalidCallException("");this.m_elementsBlue.push(a);this.m_envelopesBlue.push(b.clone())}endBlueConstruction(){this.m_bAddBlue||
p.throwInvalidCallException("");this.m_bAddBlue=!1;0<this.m_envelopesRed.length&&0<this.m_envelopesBlue.length&&(this.m_function===this.nullFunc_?this.m_function=this.initializeRedBlue_:this.m_function===this.initializeRed_?this.m_function=this.initializeRedBlue_:this.m_function!==this.initializeRedBlue_&&(this.m_function=this.initializeBlue_),this.m_bDone=!1)}next(){if(this.m_bDone)return!1;for(;this.m_function(););return this.m_bDone?!1:!0}getHandleA(){return this.m_envelopeHandleA}getHandleB(){return this.m_envelopeHandleB}setTolerance(a){this.m_tolerance=
a}getEnvelope(a){p.geometryReleaseAssert(0);return{}}getElement(a){return this.m_elementsRed[a]}getRedEnvelope(a){return this.m_envelopesRed[a]}getBlueEnvelope(a){return this.m_envelopesBlue[a]}getRedElement(a){return this.m_elementsRed[a]}getBlueElement(a){return this.m_elementsBlue[a]}isTop_(a){return 1===(a&1)}isBottom_(a){return 0===(a&1)}reset_(){this.m_bAddRedRed=this.m_bAddBlue=this.m_bAddRed=!1;this.m_queuedListBlue=this.m_queuedListRed=this.m_sweepIndexBlue=this.m_sweepIndexRed=-1;this.m_bDone=
!0}initialize_(){this.m_envelopeHandleB=this.m_envelopeHandleA=-1;if(10>this.m_envelopesRed.length)return this.m_sweepIndexRed=this.m_envelopesRed.length,this.m_function=this.sweepBruteForce_,!0;this.m_intervalTreeRed||(this.m_intervalTreeRed=new pb(!0));this.m_intervalTreeRed.addEnvelopesRef(this.m_envelopesRed);null===this.m_iteratorRed&&(this.m_iteratorRed=this.m_intervalTreeRed.getIterator());this.m_sortedEndIndicesRed.resize(0);for(let a=0;a<2*this.m_envelopesRed.length;a++)this.m_sortedEndIndicesRed.add(a);
this.sortYEndIndices_(this.m_sortedEndIndicesRed,0,2*this.m_envelopesRed.length,!0);this.m_sweepIndexRed=2*this.m_envelopesRed.length;this.m_function=this.sweep_;return!0}initializeRed_(){this.m_envelopeHandleB=this.m_envelopeHandleA=-1;if(10>this.m_envelopesRed.length||10>this.m_envelopesBlue.length)return this.m_sweepIndexRed=this.m_envelopesRed.length,this.m_function=this.sweepRedBlueBruteForce_,!0;this.m_intervalTreeRed||(this.m_intervalTreeRed=new pb(!0));this.m_intervalTreeRed.addEnvelopesRef(this.m_envelopesRed);
null===this.m_iteratorRed&&(this.m_iteratorRed=this.m_intervalTreeRed.getIterator());this.m_sortedEndIndicesRed.resize(0);for(let a=0;a<2*this.m_envelopesRed.length;a++)this.m_sortedEndIndicesRed.add(a);this.sortYEndIndices_(this.m_sortedEndIndicesRed,0,this.m_sortedEndIndicesRed.size(),!0);this.m_sweepIndexRed=this.m_sortedEndIndicesRed.size();-1!==this.m_queuedListRed&&(this.m_queuedEnvelopes.deleteList(this.m_queuedListRed),this.m_queuedIndicesRed.length=0,this.m_queuedListRed=-1);this.m_function=
this.sweepRedBlue_;return this.resetBlue_()}initializeBlue_(){this.m_envelopeHandleB=this.m_envelopeHandleA=-1;if(10>this.m_envelopesRed.length||10>this.m_envelopesBlue.length)return this.m_sweepIndexRed=this.m_envelopesRed.length,this.m_function=this.sweepRedBlueBruteForce_,!0;this.m_intervalTreeBlue||(this.m_intervalTreeBlue=new pb(!0));this.m_intervalTreeBlue.addEnvelopesRef(this.m_envelopesBlue);null==this.m_iteratorBlue&&(this.m_iteratorBlue=this.m_intervalTreeBlue.getIterator());this.m_sortedEndIndicesBlue.resize(0);
for(let a=0;a<2*this.m_envelopesBlue.length;a++)this.m_sortedEndIndicesBlue.add(a);this.sortYEndIndices_(this.m_sortedEndIndicesBlue,0,this.m_sortedEndIndicesBlue.size(),!1);this.m_sweepIndexBlue=this.m_sortedEndIndicesBlue.size();-1!==this.m_queuedListBlue&&(this.m_queuedEnvelopes.deleteList(this.m_queuedListBlue),this.m_queuedIndicesBlue.length=0,this.m_queuedListBlue=-1);this.m_function=this.sweepRedBlue_;return this.resetRed_()}initializeRedBlue_(){this.m_envelopeHandleB=this.m_envelopeHandleA=
-1;if(10>this.m_envelopesRed.length||10>this.m_envelopesBlue.length)return this.m_sweepIndexRed=this.m_envelopesRed.length,this.m_function=this.sweepRedBlueBruteForce_,!0;this.m_intervalTreeRed||(this.m_intervalTreeRed=new pb(!0));this.m_intervalTreeBlue||(this.m_intervalTreeBlue=new pb(!0));this.m_intervalTreeRed.addEnvelopesRef(this.m_envelopesRed);this.m_intervalTreeBlue.addEnvelopesRef(this.m_envelopesBlue);null===this.m_iteratorRed&&(this.m_iteratorRed=this.m_intervalTreeRed.getIterator());null===
this.m_iteratorBlue&&(this.m_iteratorBlue=this.m_intervalTreeBlue.getIterator());this.m_sortedEndIndicesRed.resize(0);this.m_sortedEndIndicesBlue.resize(0);for(var a=0;a<2*this.m_envelopesRed.length;a++)this.m_sortedEndIndicesRed.add(a);for(a=0;a<2*this.m_envelopesBlue.length;a++)this.m_sortedEndIndicesBlue.add(a);this.sortYEndIndices_(this.m_sortedEndIndicesRed,0,this.m_sortedEndIndicesRed.size(),!0);this.sortYEndIndices_(this.m_sortedEndIndicesBlue,0,this.m_sortedEndIndicesBlue.size(),!1);this.m_sweepIndexRed=
this.m_sortedEndIndicesRed.size();this.m_sweepIndexBlue=this.m_sortedEndIndicesBlue.size();-1!==this.m_queuedListRed&&(this.m_queuedEnvelopes.deleteList(this.m_queuedListRed),this.m_queuedIndicesRed.length=0,this.m_queuedListRed=-1);-1!==this.m_queuedListBlue&&(this.m_queuedEnvelopes.deleteList(this.m_queuedListBlue),this.m_queuedIndicesBlue.length=0,this.m_queuedListBlue=-1);this.m_function=this.sweepRedBlue_;return!0}sweep_(){var a=this.m_sortedEndIndicesRed.read(--this.m_sweepIndexRed);const b=
a>>1;if(this.isBottom_(a))return this.m_intervalTreeRed.remove(b),0===this.m_sweepIndexRed?(this.m_envelopeHandleB=this.m_envelopeHandleA=-1,this.m_bDone=!0,!1):!0;a=l.Envelope1D.construct(this.m_envelopesRed[b].xmin,this.m_envelopesRed[b].xmax);this.m_iteratorRed.resetIterator(a,this.m_tolerance);this.m_envelopeHandleA=b;this.m_function=this.iterate_;return!0}sweepBruteForce_(){if(-1===--this.m_sweepIndexRed)return this.m_envelopeHandleB=this.m_envelopeHandleA=-1,this.m_bDone=!0,!1;this.m_sweepIndexBlue=
this.m_envelopeHandleA=this.m_sweepIndexRed;this.m_function=this.iterateBruteForce_;return!0}sweepRedBlueBruteForce_(){if(-1===--this.m_sweepIndexRed)return this.m_envelopeHandleB=this.m_envelopeHandleA=-1,this.m_bDone=!0,!1;this.m_envelopeHandleA=this.m_sweepIndexRed;this.m_sweepIndexBlue=this.m_envelopesBlue.length;this.m_function=this.iterateRedBlueBruteForce_;return!0}sweepRedBlue_(){const a=this.m_sortedEndIndicesRed.read(this.m_sweepIndexRed-1),b=this.m_sortedEndIndicesBlue.read(this.m_sweepIndexBlue-
1),c=this.getAdjustedValue_(a,!0),d=this.getAdjustedValue_(b,!1);return c>d?this.sweepRed_():c<d?this.sweepBlue_():this.isTop_(a)?this.sweepRed_():this.isTop_(b)?this.sweepBlue_():this.sweepRed_()}sweepRed_(){var a=this.m_sortedEndIndicesRed.read(--this.m_sweepIndexRed);const b=a>>1;if(this.isBottom_(a))return-1!==this.m_queuedListRed&&-1!==this.m_queuedIndicesRed[b]?(this.m_queuedEnvelopes.deleteElement(this.m_queuedListRed,this.m_queuedIndicesRed[b]),this.m_queuedIndicesRed[b]=-1):this.m_intervalTreeRed.remove(b),
0===this.m_sweepIndexRed?(this.m_envelopeHandleB=this.m_envelopeHandleA=-1,this.m_bDone=!0,!1):!0;if(-1!==this.m_queuedListBlue&&0<this.m_queuedEnvelopes.getListSize(this.m_queuedListBlue))for(a=this.m_queuedEnvelopes.getFirst(this.m_queuedListBlue);-1!==a;){var c=this.m_queuedEnvelopes.getData(a);this.m_intervalTreeBlue.insert(c);this.m_queuedIndicesBlue[c]=-1;c=this.m_queuedEnvelopes.getNext(a);this.m_queuedEnvelopes.deleteElement(this.m_queuedListBlue,a);a=c}0<this.m_intervalTreeBlue.size()?(a=
l.Envelope1D.construct(this.m_envelopesRed[b].xmin,this.m_envelopesRed[b].xmax),this.m_iteratorBlue.resetIterator(a,this.m_tolerance),this.m_envelopeHandleA=b,this.m_function=this.iterateBlue_):(-1===this.m_queuedListRed&&(this.m_queuedIndicesRed.length=this.m_envelopesRed.length,this.m_queuedIndicesRed.fill(-1),this.m_queuedListRed=this.m_queuedEnvelopes.createList(1)),this.m_queuedIndicesRed[b]=this.m_queuedEnvelopes.addElement(this.m_queuedListRed,b),this.m_function=this.sweepRedBlue_);return!0}sweepBlue_(){var a=
this.m_sortedEndIndicesBlue.read(--this.m_sweepIndexBlue);const b=a>>1;if(this.isBottom_(a))return-1!==this.m_queuedListBlue&&-1!==this.m_queuedIndicesBlue[b]?(this.m_queuedEnvelopes.deleteElement(this.m_queuedListBlue,this.m_queuedIndicesBlue[b]),this.m_queuedIndicesBlue[b]=-1):this.m_intervalTreeBlue.remove(b),0===this.m_sweepIndexBlue?(this.m_envelopeHandleB=this.m_envelopeHandleA=-1,this.m_bDone=!0,!1):!0;if(-1!==this.m_queuedListRed&&0<this.m_queuedEnvelopes.getListSize(this.m_queuedListRed))for(a=
this.m_queuedEnvelopes.getFirst(this.m_queuedListRed);-1!==a;){var c=this.m_queuedEnvelopes.getData(a);this.m_intervalTreeRed.insert(c);this.m_queuedIndicesRed[c]=-1;c=this.m_queuedEnvelopes.getNext(a);this.m_queuedEnvelopes.deleteElement(this.m_queuedListRed,a);a=c}0<this.m_intervalTreeRed.size()?(a=l.Envelope1D.construct(this.m_envelopesBlue[b].xmin,this.m_envelopesBlue[b].xmax),this.m_iteratorRed.resetIterator(a,this.m_tolerance),this.m_envelopeHandleB=b,this.m_function=this.iterateRed_):(-1===
this.m_queuedListBlue&&(this.m_queuedIndicesBlue.length=this.m_envelopesBlue.length,this.m_queuedIndicesBlue.fill(-1),this.m_queuedListBlue=this.m_queuedEnvelopes.createList(0)),this.m_queuedIndicesBlue[b]=this.m_queuedEnvelopes.addElement(this.m_queuedListBlue,b),this.m_function=this.sweepRedBlue_);return!0}iterate_(){this.m_envelopeHandleB=this.m_iteratorRed.next();if(-1!==this.m_envelopeHandleB)return!1;const a=this.m_sortedEndIndicesRed.read(this.m_sweepIndexRed)>>1;this.m_intervalTreeRed.insert(a);
this.m_function=this.sweep_;return!0}iterateRed_(){this.m_envelopeHandleA=this.m_iteratorRed.next();if(-1!==this.m_envelopeHandleA)return!1;this.m_envelopeHandleB=this.m_envelopeHandleA=-1;const a=this.m_sortedEndIndicesBlue.read(this.m_sweepIndexBlue)>>1;this.m_intervalTreeBlue.insert(a);this.m_function=this.sweepRedBlue_;return!0}iterateBlue_(){this.m_envelopeHandleB=this.m_iteratorBlue.next();if(-1!==this.m_envelopeHandleB)return!1;const a=this.m_sortedEndIndicesRed.read(this.m_sweepIndexRed)>>
1;this.m_intervalTreeRed.insert(a);this.m_function=this.sweepRedBlue_;return!0}iterateBruteForce_(){if(-1===--this.m_sweepIndexBlue)return this.m_function=this.sweepBruteForce_,!0;const a=this.m_envelopesRed[this.m_sweepIndexRed].clone(),b=this.m_envelopesRed[this.m_sweepIndexBlue];a.inflateCoords(this.m_tolerance,this.m_tolerance);return a.isIntersecting(b)?(this.m_envelopeHandleB=this.m_sweepIndexBlue,!1):!0}iterateRedBlueBruteForce_(){if(-1===--this.m_sweepIndexBlue)return this.m_function=this.sweepRedBlueBruteForce_,
!0;const a=this.m_envelopesRed[this.m_sweepIndexRed].clone(),b=this.m_envelopesBlue[this.m_sweepIndexBlue];a.inflateCoords(this.m_tolerance,this.m_tolerance);return a.isIntersecting(b)?(this.m_envelopeHandleB=this.m_sweepIndexBlue,!1):!0}resetRed_(){this.m_sweepIndexRed=this.m_sortedEndIndicesRed.size();0<this.m_intervalTreeRed.size()&&this.m_intervalTreeRed.reset();-1!==this.m_queuedListRed&&(this.m_queuedEnvelopes.deleteList(this.m_queuedListRed),this.m_queuedIndicesRed.length=0,this.m_queuedListRed=
-1);this.m_bDone=!1;return!0}resetBlue_(){this.m_sweepIndexBlue=this.m_sortedEndIndicesBlue.size();0<this.m_intervalTreeBlue.size()&&this.m_intervalTreeBlue.reset();-1!==this.m_queuedListBlue&&(this.m_queuedEnvelopes.deleteList(this.m_queuedListBlue),this.m_queuedIndicesBlue.length=0,this.m_queuedListBlue=-1);this.m_bDone=!1;return!0}nullFunc_(){p.geometryReleaseAssert(0);return!1}sortYEndIndices_(a,b,c,d){const e=this;(new Zb).sort(a,b,c,{userSort(f,g,h){e.sortYEndIndicesHelper_(h,f,g,d)},getValue(f){return e.getAdjustedValue_(f,
d)}})}sortYEndIndicesHelper_(a,b,c,d){a.sort(b,c,(e,f)=>{const g=this.getAdjustedValue_(e,d),h=this.getAdjustedValue_(f,d);return g<h||g===h&&this.isBottom_(e)&&this.isTop_(f)?-1:1})}getAdjustedValue_(a,b){const c=.5*this.m_tolerance;if(b)return b=this.m_envelopesRed[a>>1],this.isBottom_(a)?b.ymin-c:b.ymax+c;b=this.m_envelopesBlue[a>>1];return this.isBottom_(a)?b.ymin-c:b.ymax+c}}var Oh=K;class jb{constructor(a,b){this.tolerance=void 0!==a?a:Number.NaN;this.resolution=void 0!==b?b:Number.NaN}add(a){return new jb(this.tolerance+
a,this.resolution)}scale(a){return new jb(this.tolerance*a,this.resolution*a)}total(){return this.tolerance+this.resolution}}class El{constructor(a){this.m_accelerators=null;void 0!==a&&a.move?(this.m_description=a.move.m_description,a.move.m_description=cb(),this.m_vertexAttributes=a.move.m_vertexAttributes,a.move.m_vertexAttributes=new Ff,this.m_envelopeData=a.move.m_envelopeData,a.move.m_envelopeData=new Ub,this.m_pointCount=a.move.m_pointCount,this.m_reservedPointCount=a.move.m_reservedPointCount,
this.m_flags=a.move.m_flags,this.m_bFillRule=a.move.m_bFillRule,this.m_bPathStarted=a.move.m_bPathStarted,this.m_bPolygon=a.move.m_bPolygon,this.m_simpleTolerance=a.move.m_simpleTolerance):(this.m_description=void 0!==a&&a.vd?a.vd:cb(),this.m_vertexAttributes=new Ff,this.m_envelopeData=new Ub,this.m_pointCount=0,this.m_reservedPointCount=-1,this.m_flags=4063,this.m_bFillRule=this.m_bPathStarted=this.m_bPolygon=!1,this.m_simpleTolerance=0,void 0!==a&&a.copy&&a.copy.copyTo(this))}equalsBase(a,b){if(!p.isMultiVertex(a.getGeometryType()))return!1;
if(this===a)return!0;if(!this.m_description.equals(a.getDescription())||this.isEmptyImpl()!==a.isEmptyImpl())return!1;if(this.isEmptyImpl())return!0;const c=this.getPointCount();var d=a.getPointCount();if(c!==d)return!1;for(d=0;d<this.m_description.getAttributeCount();d++){var e=this.m_description.getSemantics(d);const f=this.getAttributeStreamRef(e),g=a.getAttributeStreamRef(e);e=K.getComponentCount(e);if(!f.equals(g,0,c*e,b))return!1}if(b){if(!this.equalsImplTol(a,b))return!1}else if(!this.equalsImpl(a))return!1;
return!0}vertexCount(){p.geometryReleaseAssert(0);return 0}transformAttribute(a,b,c,d,e){this.addAttribute(a);if(!this.isEmpty()&&(0!==c||1!==d)){var f=this.getAttributeStreamRef(a),g=this.getPointCount();a=K.getComponentCount(a);c=Wl(c,d,e);(0>b||0>g||1>a||b+a*(g-1)+1>f.size())&&p.throwInvalidArgumentException("Index out of bound");for(let h=b,k=b+a*(g-1)+1;h<k;h+=a)f.writeAsDbl(h,c(f.readAsDbl(h)));this.notifyModified()}}getDescription(){return this.m_description}assignVertexDescription(a){this.m_description!==
a&&this.assignVertexDescriptionImpl(a)}mergeVertexDescriptionImpl(a){const b=this.getDescription();a=Id(b,a);this.assignVertexDescription(a)}mergeVertexDescription(a){this.m_description!==a&&(this.m_description.hasAttributesFrom(a)||this.mergeVertexDescriptionImpl(a))}hasAttribute(a){return this.m_description.hasAttribute(a)}addAttribute(a){this.m_description.hasAttribute(a)||(a=Jd(this.m_description,a),this.assignVertexDescription(a))}dropAttribute(a){this.m_description.hasAttribute(a)&&(a=Pf(this.m_description,
a),this.assignVertexDescription(a))}dropAllAttributes(){const a=cb();a!==this.m_description&&this.assignVertexDescription(a)}getAttributeStreamRef(a){this.throwIfEmpty();this.m_description.hasAttribute(a)||p.throwInvalidArgumentException("AttributeStream : Geometry does not have the attribute");a=this.m_description.getAttributeIndex(a);return this.m_vertexAttributes.get(a)}setAttributeStreamRef(a,b){b||p.throwInvalidArgumentException("stream");b&&K.getPersistence(a)!==b.getPersistence()&&p.throwInvalidArgumentException("");
this.addAttribute(a);a=this.m_description.getAttributeIndex(a);this.m_vertexAttributes.empty()&&this.m_vertexAttributes.destroyAndSetSize(this.m_description.getAttributeCount());this.m_vertexAttributes.set(a,b);this.notifyModifiedFlags(2001)}notifyModifiedFlags(a){65535===a&&(this.m_reservedPointCount=-1,this.notifyModifiedAllImpl());this.setDirtyFlagProtected(a,!0);this.clearAccelerators();a&32&&this.verifyAllStreamsAfterSizeChange()}notifyModified(){this.notifyModifiedFlags(2001)}getPointCount(){return this.m_pointCount}getPointByVal(a,
b){b.assignVertexDescription(this.m_description);for(let c=0;c<this.m_description.getAttributeCount();c++){const d=this.m_description.getSemantics(c);for(let e=0,f=K.getComponentCount(d);e<f;e++){const g=this.m_vertexAttributes.get(c).readAsDbl(f*a+e);b.setAttributeBasic(d,e,g)}}}setPointByVal(a,b){b.isEmpty()&&p.throwInvalidArgumentException("can not assign an empty point to a vertex");var c=b.getDescription();c!==this.m_description&&this.mergeVertexDescription(c);c=this.m_vertexAttributes.get(0);
c.write(2*a,b.getX());c.write(2*a+1,b.getY());for(let d=1,e=this.m_description.getAttributeCount();d<e;d++){c=this.m_description.getSemantics(d);const f=K.getComponentCount(c);for(let g=0;g<f;g++){const h=b.getAttributeAsDbl(c,g);this.m_vertexAttributes.get(d).writeAsDbl(a*f+g,h)}}this.notifyModifiedFlags(2001)}setPointByValFromArray(a,b,c,d){p.geometryReleaseAssert(0)}getPointByValAsArray(a,b,c,d){p.geometryReleaseAssert(0)}isEmpty(){return this.isEmptyImpl()}isEmptyImpl(){return 0===this.m_pointCount}getAttributeAsDbl(a,
b,c){const d=K.getComponentCount(a);c>=d&&p.throwOutOfRangeException("");const e=this.m_description.getAttributeIndex(a);return 0<=e?this.m_vertexAttributes.get(e).readAsDbl(b*d+c):K.getDefaultValue(a)}queryAttributeAsDbl(a,b,c,d){const e=K.getComponentCount(a);d<e&&p.throwOutOfRangeException("");d=this.m_description.getAttributeIndex(a);if(0<=d)for(a=b*e,b=this.m_vertexAttributes.get(d),d=0;d<e;d++)c[d]=b.readAsDbl(a+d);else for(a=K.getDefaultValue(a),b=0;b<e;b++)c[b]=a}getAttributeAsInt(a,b,c){return Math.trunc(this.getAttributeAsDbl(a,
b,c))}queryAttributeAsInt(a,b,c,d){p.geometryReleaseAssert(0)}setAttribute(a,b,c,d){const e=K.getComponentCount(a);c>=e&&p.throwOutOfRangeException("");this.addAttribute(a);a=this.m_description.getAttributeIndex(a);this.notifyModifiedFlags(2001);this.m_vertexAttributes.get(a).writeAsDbl(b*e+c,d)}setAttributeFromArray(a,b,c,d){(0>b||b>=this.m_pointCount)&&p.throwOutOfRangeException("");const e=K.getComponentCount(a);d!==e&&p.throwOutOfRangeException("");this.addAttribute(a);a=this.m_description.getAttributeIndex(a);
this.notifyModifiedFlags(2001);a=this.m_vertexAttributes.get(a);for(d=0;d<e;++d)a.writeAsDbl(b*e+d,c[d])}getXY(a){return this.m_vertexAttributes.get(0).readPoint2D(2*a)}queryXY(a,b){return this.m_vertexAttributes.get(0).queryPoint2D(2*a,b)}setXY(a,b){this.m_vertexAttributes.get(0).writePoint2D(2*a,b);this.notifyModifiedFlags(2001)}setXYCoords(a,b,c){const d=this.m_vertexAttributes.get(0);d.write(2*a,b);d.write(2*a+1,c);this.notifyModifiedFlags(2001)}getXYZ(a){const b=this.m_vertexAttributes.get(0),
c=X.getNAN();c.x=b.read(2*a);c.y=b.read(2*a+1);this.m_description.hasAttribute(1)?c.z=this.m_vertexAttributes.get(1).read(a):c.z=K.getDefaultValue(1);return c}setXYZ(a,b){this.addAttribute(1);this.notifyModifiedFlags(2001);const c=this.m_vertexAttributes.get(0);c.write(2*a,b.x);c.write(2*a+1,b.y);this.m_vertexAttributes.get(1).write(a,b.z)}queryEnvelope(a){a instanceof D||a instanceof ub?this.updateEnvelope(a):(this.updateAllDirtyIntervals(!0),this.m_envelopeData.copyTo(this.m_description,a))}queryLooseEnvelope(a){this.updateLooseEnvelope(a)}queryInterval(a,
b){const c=l.Envelope1D.constructEmpty();if(this.isEmptyImpl())return c;this.updateAllDirtyIntervals(!0);this.m_envelopeData.queryInterval(this.m_description,a,b,c);return c}setAttributeBasic(a,b,c){this.setAttributeImpl(a,b,c)}setAttributeImpl(a,b,c){this.addAttribute(a);if(!this.isEmpty()){var d=!1,e=K.getComponentCount(a);a=this.getAttributeStreamRef(a);var f=Number.isNaN(c);if(1===a.getPersistence())for(let g=b,h=this.m_pointCount*e;g<h;g+=e){if(b=a.read(g),!f&&b!==c||!Number.isNaN(b))a.write(g,
c),d=!0}else for(let g=b,h=this.m_pointCount*e;g<h;g+=e)a.readAsDbl(g)!==c&&(a.writeAsDbl(g,c),d=!0);d&&this.notifyModifiedFlags(2001)}}replaceNaNs(a,b){this.addAttribute(a);if(!this.isEmpty()){var c=!1,d=K.getComponentCount(a);a=this.getAttributeStreamRef(a);for(let f=0;f<d;f++)if(1===a.getPersistence()){var e=a;for(let g=0,h=this.m_pointCount*d;g<h;g++){const k=e.read(g);Number.isNaN(k)&&(e.write(g,b),c=!0)}}else for(let g=0,h=this.m_pointCount*d;g<h;g++)e=a.readAsDbl(g),Number.isNaN(e)&&(a.writeAsDbl(g,
b),c=!0);c&&this.notifyModifiedFlags(2001)}}calculateLength3D(a){p.geometryReleaseAssert(0);return 0}setEnvelopeForImport(a){this.m_description.equals(a.getDescription())||p.throwInvalidArgumentException("");this.m_envelopeData=new Ub({moveEnv:a});this.setDirtyFlagProtected(192,!1)}copyTo(a){a.getGeometryType()!==this.getGeometryType()&&p.throwInvalidArgumentException("");this!==a&&this.copyToUnchecked(a,!1)}queryCoordinates(a,b,c,d){d=0>d?this.m_pointCount:d;d=Math.min(d,c+b);(0>c||d<c||0<this.m_pointCount&&
c>=this.m_pointCount)&&p.throwInvalidArgumentException("");if(0===this.m_pointCount)return d;b=this.getAttributeStreamRef(0);for(let e=2*c,f=2*d,g=0;e<f;e+=2,g++)b.queryPoint2D(e,a[g]);return d}queryCoordinates3D(a,b,c,d){d=0>d?this.m_pointCount:d;d=Math.min(d,c+b);(0>c||d<c||0<this.m_pointCount&&c>=this.m_pointCount)&&p.throwInvalidArgumentException("");if(0===this.m_pointCount)return d;b=this.getAttributeStreamRef(0);let e=null;const f=K.getDefaultValue(1),g=this.m_description.hasAttribute(1);g&&
(e=this.getAttributeStreamRef(1));let h=0;for(;c<d;c++,h++)a[h].x=b.read(2*c),a[h].y=b.read(2*c+1),a[h].z=g?e.read(c):f;return d}clearAndSetDirtyFlagProtected(a,b){let c=0;a&=~b;c=this.m_flags;(c&(b|a))!==b&&(this.m_flags=c&~a|b)}getIsSimple(a,b){b[0]=0;let c=-1;const d=this.m_flags,e=this.m_simpleTolerance;0===(d&1)&&(c=(d&14)>>1,b[0]=e,e<a&&(c=-1));return c}setIsSimple(a,b,c=!1){2===a?p.geometryReleaseAssert(this.getGeometryType()===p.GeometryType.enumPolyline):1===a?p.geometryReleaseAssert(this.getGeometryType()===
p.GeometryType.enumMultiPoint||this.getGeometryType()===p.GeometryType.enumPolyline):3===a&&p.geometryReleaseAssert(this.getGeometryType()===p.GeometryType.enumPolygon);-1===a?this.setDirtyFlagProtected(17,!0):(a<<=1,c||(a|=16),this.clearAndSetDirtyFlagProtected(31,a),this.m_simpleTolerance!==b&&(this.m_simpleTolerance=b))}attributeStreamIsAllocated(a){this.throwIfEmpty();a=this.m_description.getAttributeIndex(a);return 0<=a&&null!==this.m_vertexAttributes.get(a)?!0:!1}capacity(){return-1===this.m_reservedPointCount&&
0===this.m_pointCount?0:this.m_reservedPointCount}getDescriptionImpl(){return this.m_description}copyToUnchecked(a,b=!1){b&&this.hasDirtyFlag(32)&&p.throwLogicErrorException("Cannot do shallow clone on unprepared geometry");var c=this.getGeometryType();const d=a.getGeometryType();p.geometryReleaseAssert(c===d||c===p.GeometryType.enumPolygon&&d===p.GeometryType.enumPolyline,"failure in copyToUnchcked");a.clearAccelerators();a.m_description=this.m_description;a.m_vertexAttributes.destroyAndSetSize(0);
a.m_envelopeData.releaseAttributes();const e=this.m_description.getAttributeCount(),f=new Ff;if(!this.m_vertexAttributes.empty()){f.destroyAndSetSize(e);for(let g=0;g<e;g++)if(this.m_vertexAttributes.get(g))if(b)f.set(g,this.m_vertexAttributes.get(g));else{const h=K.getComponentCount(this.m_description.getSemantics(g));f.set(g,this.m_vertexAttributes.get(g).restrictedClone(this.getPointCount()*h))}}this.m_envelopeData.copyToIfNotNull(this.m_description,a.m_envelopeData);a.m_flags=this.m_flags;a.m_simpleTolerance=
this.m_simpleTolerance;c!==d&&(c=[0],3<=a.getIsSimple(0,c)?a.setIsSimple(1,c[0]):a.setIsSimple(-1,0));a.m_vertexAttributes.swap(f);f.destroyAndSetSize(0);a.m_pointCount=this.m_pointCount;a.hasDirtyFlag(32)?(p.geometryReleaseAssert(!b),a.m_reservedPointCount=-1):a.m_reservedPointCount=a.m_pointCount;try{this.copyToImpl(a,b)}catch(g){throw a.setEmpty(),g;}a.verifyAllStreamsAfterSizeChange()}buildRasterizedGeometryAccelerator(a,b){return!1}getAccelerators(){return this.m_accelerators}clearAccelerators(){this.m_accelerators&&
this.m_accelerators.release();this.m_accelerators=null}ensureUniqueAccelerators(){if(this.m_accelerators&&!this.m_accelerators.uniqueUse()){const a=this.m_accelerators.clone();this.m_accelerators.release();this.m_accelerators=a}}interpolateTwoVertices(a,b,c,d){(0>a||a>=this.m_pointCount)&&p.throwOutOfRangeException("");(0>b||b>=this.m_pointCount)&&p.throwOutOfRangeException("");d.assignVertexDescription(this.m_description);const e=Array(K.maxComponentCount()),f=Array(K.maxComponentCount()),g=Array(25);
let h=0;for(let k=0;k<this.m_description.getAttributeCount();k++){const m=this.m_description.getSemantics(k),n=K.getInterpolation(m),q=K.getComponentCount(m),r=K.getDefaultValue(m);this.queryAttributeAsDbl(m,a,e,q);this.queryAttributeAsDbl(m,b,f,q);p.geometryReleaseAssert(25>=h+q);l.interpolateArray(n,e,f,g,h,q,c,r);h+=q}a=h;b=d.getDescription().getTotalComponentCount();p.geometryReleaseAssert(b<=a);d.setX(g[0]);d.setY(g[1]);l.memcpy(d.getAttributeArray(),g,0,2,b-2)}getShortestDistance(a,b){return l.Point2D.distance(this.getXY(a),
this.getXY(b))}getShortestSqrDistance(a,b){return l.Point2D.sqrDistance(this.getXY(a),this.getXY(b))}resizeImpl(a){0>a&&p.throwInvalidArgumentException();a=Math.ceil(a);a!==this.m_pointCount&&(this.m_pointCount=a,this.notifyModifiedFlags(this.m_pointCount<=this.m_reservedPointCount?2001:4095))}verifyPointIndex(a){p.geometryReleaseAssert(0)}assignVertexDescriptionImpl(a){if(!this.m_vertexAttributes.empty()){const b=Array(14);ye(a,this.m_description,b);const c=new Ff;c.destroyAndSetSize(a.getAttributeCount());
for(let d=0;d<a.getAttributeCount();d++){const e=b[d];-1!==e?c.set(d,this.m_vertexAttributes.get(e)):this.m_reservedPointCount=-1}c.swap(this.m_vertexAttributes)}this.m_description=a;this.m_envelopeData.releaseAttributes();this.notifyModifiedFlags(4095)}hasDirtyFlag(a){return 0!==(this.m_flags&a)}setDirtyFlagProtected(a,b){this.m_flags=b?this.m_flags|a:this.m_flags&~a}notifyModifiedAllImpl(){}verifyAllStreamsAfterSizeChange(){this.hasDirtyFlag(32)&&this.verifyAllStreamsAfterSizeChangeImpl()}verifyAllStreamsAfterSizeChangeImpl(){if(this.hasDirtyFlag(32)){if(this.m_reservedPointCount<
this.m_pointCount){this.m_vertexAttributes.empty()&&this.m_vertexAttributes.destroyAndSetSize(this.m_description.getAttributeCount());this.m_reservedPointCount=Number.MAX_SAFE_INTEGER;let a=0;a=4>this.m_pointCount?3:128>=this.m_pointCount?2*this.m_pointCount:(4*this.m_pointCount+2)/3;for(let b=0;b<this.m_description.getAttributeCount();b++){const c=this.m_description.getSemantics(b);let d=0;if(null!==this.m_vertexAttributes.get(b)){const e=K.getComponentCount(c);d=this.m_vertexAttributes.get(b).size()/
e;d<this.m_pointCount&&(this.m_vertexAttributes.get(b).resize(a*e,K.getDefaultValue(c)),d=a)}else this.m_vertexAttributes.set(b,Hh(c,a)),d=a;d<this.m_reservedPointCount&&(this.m_reservedPointCount=d)}}this.verifyStreamsAfterSizeChangeExtraImpl();this.setDirtyFlagProtected(32,!1)}}verifyStreamsAfterSizeChangeExtraImpl(){}updateAllDirtyIntervals(a){if(a?this.hasDirtyFlag(192):this.hasDirtyFlag(128))if(this.isEmpty())this.hasDirtyFlag(192)&&this.m_envelopeData.setEmpty(this.m_description),this.setDirtyFlagProtected(192,
!1);else{var b=this.updateXYImpl(a),c=new Ya({vd:this.m_description});c.setEnvelope(b);for(b=1;b<this.m_description.getAttributeCount();b++){const d=this.m_description.getSemantics(b),e=K.getComponentCount(d),f=this.m_vertexAttributes.get(b);for(let g=0;g<e;g++){const h=new l.Envelope1D;h.setEmpty();for(let k=0;k<this.m_pointCount;k++){const m=f.readAsDbl(k*e+g);h.mergeCoordinate(m)}c.setIntervalEnvelope(d,g,h)}}if(a?this.hasDirtyFlag(192):this.hasDirtyFlag(128))this.m_envelopeData=new Ub({moveEnv:c}),
this.clearDirtyIntervalsFlag(a)}}updateXYImpl(a){a=D.constructEmpty();const b=this.m_vertexAttributes.get(0);a.mergePointsInterleaved(b,0,this.m_pointCount);return a}updateEnvelope3D(a){p.geometryReleaseAssert(0)}updateLooseEnvelope(a){this.updateAllDirtyIntervals(!1);a instanceof D?a.assign(this.m_envelopeData.m_envelope2D):this.m_envelopeData.queryEnvelope3D(this.m_description,a)}updateEnvelope(a){this.updateAllDirtyIntervals(!0);a.assign(this.m_envelopeData.m_envelope2D)}setEmptyImpl(){this.m_pointCount=
0;this.m_reservedPointCount=-1;this.m_vertexAttributes.destroyAndSetSize(0);this.notifyModifiedFlags(4095)}clearDirtyIntervalsFlag(a){this.setDirtyFlagProtected(192,!1)}reserveImpl(a,b){0>a&&p.throwInvalidArgumentException("");if(0!==a&&(a=Math.ceil(a),this.m_reservedPointCount<a)){this.m_vertexAttributes.empty()&&this.m_vertexAttributes.destroyAndSetSize(this.m_description.getAttributeCount());b?(null===this.m_vertexAttributes.get(0)&&this.m_vertexAttributes.set(0,ze(0,0)),this.m_vertexAttributes.get(0).resizeRounded(2*
a),a=this.m_vertexAttributes.get(0).size()>>1):null===this.m_vertexAttributes.get(0)?this.m_vertexAttributes.set(0,ze(0,a)):this.m_vertexAttributes.get(0).resize(2*a);for(let c=1;c<this.m_description.getAttributeCount();c++){const d=this.m_description.getSemantics(c),e=K.getComponentCount(d);null!==this.m_vertexAttributes.get(c)?this.m_vertexAttributes.get(c).resize(a*e):this.m_vertexAttributes.set(c,ze(d,a))}this.reserveImplImpl(a,b);this.m_reservedPointCount=a}}reserveRounded(a){0>a&&p.throwInvalidArgumentException();
a=Math.ceil(a);this.reserveImpl(a,!0)}reserveImplImpl(a,b){}throwIfEmpty(){this.isEmptyImpl()&&p.throwEmptyGeometryException("")}}class Oa extends El{constructor(a){super(a);a&&(a.points?this.addPoints2D(a.points,a.pointsSize,0,-1):a.point&&this.add(a.point))}assignCopy(a){p.geometryReleaseAssert(0);return this}assignMove(a){p.geometryReleaseAssert(0);return this}insertPoint2D(a,b){p.geometryReleaseAssert(0)}insertPoint(a,b){p.geometryReleaseAssert(0)}insertPoints(a,b,c){p.geometryReleaseAssert(0)}insertPoints2D(a,
b,c){p.geometryReleaseAssert(0)}removePoints(a,b){p.geometryReleaseAssert(0)}removePoint(a){for(let c=0,d=this.m_description.getAttributeCount();c<d;c++)if(this.m_vertexAttributes.get(c)){var b=this.m_description.getSemantics(c);b=K.getComponentCount(b);this.m_vertexAttributes.get(c).eraseRange(b*a,b,b*this.m_pointCount)}this.m_pointCount--;0<this.m_reservedPointCount&&this.m_reservedPointCount--;this.notifyModifiedFlags(2001)}calculateEnvelope2D(){p.geometryReleaseAssert(0);return new D(0,0,0,0)}resizeNoInit(a){this.resizeImpl(a)}resizeAndInitNonPositionAttributes(a){const b=
this.m_pointCount;this.resizeImpl(a);if(this.m_pointCount>b)for(let d=1,e=this.m_description.getAttributeCount();d<e;d++){var c=this.m_description.getSemantics(d);a=K.getDefaultValue(c);c=K.getComponentCount(c);this.m_vertexAttributes.get(d).insertRange(c*b,a,c*(this.m_pointCount-b),c*b)}}queryCoordinates3D(a,b,c,d){p.geometryReleaseAssert(0);return 0}queryAttributeAsInt(a,b,c,d){p.geometryReleaseAssert(0)}add(a){a.isEmpty()&&p.throwInvalidArgumentException("can not assign an empty point to a vertex");
this.resizeAndInitNonPositionAttributes(this.m_pointCount+1);this.setPointByVal(this.m_pointCount-1,a)}addXY(a,b){this.resizeAndInitNonPositionAttributes(this.m_pointCount+1);a=new l.Point2D(a,b);this.setXY(this.m_pointCount-1,a)}addXYZ(a,b,c){this.resizeAndInitNonPositionAttributes(this.m_pointCount+1);const d=new X;d.setCoords(a,b,c);this.setXYZ(this.m_pointCount-1,d)}addPoint2D(a){this.addXY(a.x,a.y)}addPoint3D(a){this.addXYZ(a.x,a.y,a.z)}addPoints(a,b,c){this===a&&p.throwInvalidArgumentException("Multi_point_impl.add");
var d=0>c?a.getPointCount():c;(0>b||b>a.getPointCount()||d<b)&&p.throwInvalidArgumentException("");if(b!==d){c=a.getDescription();this.mergeVertexDescription(c);d-=b;var e=this.m_pointCount;this.resizeNoInit(this.m_pointCount+d);for(let g=0,h=this.m_description.getAttributeCount();g<h;g++){var f=this.m_description.getSemantics(g);const k=K.getComponentCount(f),m=this.getAttributeStreamRef(f);c.hasAttribute(f)?(f=a.getAttributeStreamRef(f),m.insertRangeFromStream(e*k,f,b*k,d*k,!0,1,e*k)):(f=K.getDefaultValue(f),
m.insertRange(e*k,f,d*k,e*k))}}}addPoints2D(a,b,c,d){d=0>d?b:d;(0>b||0>c||c>b||d<c)&&p.throwInvalidArgumentException("");if(c!==d){b=d-c;d=this.m_pointCount;this.resizeAndInitNonPositionAttributes(this.m_pointCount+b);var e=this.getAttributeStreamRef(0);for(let f=0;f<b;++f)e.writePoint2D(2*(d+f),a[c+f]);this.notifyModifiedFlags(2001)}}addPoints3D(a,b,c,d){p.geometryReleaseAssert(0)}getGeometryType(){return p.GeometryType.enumMultiPoint}getDimension(){return 0}createInstance(){return new Oa({vd:this.getDescription()})}setEmpty(){this.setEmptyImpl()}applyTransformation(a){if(!this.isEmpty()&&
!a.isIdentity()){var b=this.m_vertexAttributes.get(0);a instanceof l.Transformation2D?b.applyTransformation(a,0,this.m_pointCount):p.geometryReleaseAssert(0);this.notifyModifiedFlags(2001)}}calculateArea2D(){p.geometryReleaseAssert(0);return 0}calculateLength2D(){p.geometryReleaseAssert(0);return 0}calculateLength3D(a){p.geometryReleaseAssert(0);return 0}equals(a,b){return a.getGeometryType()!==p.GeometryType.enumMultiPoint?!1:this.equalsBase(a,b)}queryEnvelope(a){a instanceof Ya?(this.updateAllDirtyIntervals(!0),
this.m_envelopeData.copyTo(this.m_description,a)):a instanceof D?this.updateEnvelope(a):p.geometryReleaseAssert(0)}getImpl(){return this}getBoundary(){return null}reserve(a){this.reserveImpl(a)}clone(){const a=this.createInstance();this.copyTo(a);return a}swap(a){p.geometryReleaseAssert(0)}buildQuadTreeAccelerator(a){return!1}getHashCodeImpl(){p.geometryReleaseAssert(0);return 0}equalsImpl(a){return!0}equalsImplTol(a,b){return!0}copyToImpl(a,b){}}Oa.type=p.GeometryType.enumMultiPoint;class Va{constructor(){this.envAabb=
D.constructEmpty();this.envRot=D.constructEmpty()}static constructEmpty(){return new Va}width(){return this.envAabb.width()}height(){return this.envAabb.height()}maxDim(){return Math.max(this.width(),this.height())}isEmpty(){p.geometryReleaseAssert(0);return!1}setEmpty(){this.envAabb.setEmpty();this.envRot.setEmpty()}setCoords(a){this.envAabb.setCoords(a);this.envRot.setCoords({x:Pd(a),y:Qd(a)})}setFromPoints(a,b){this.setEmpty();this.mergePoints(a,b)}mergePoint2D(a){p.geometryReleaseAssert(0)}mergeNe(a){this.envAabb.mergeNe(a);
this.envRot.mergeNeCoords(Pd(a),Qd(a))}mergeCoords(a,b){p.geometryReleaseAssert(0)}mergeW(a){p.geometryReleaseAssert(0)}mergeE2D(a){p.geometryReleaseAssert(0)}mergePoints(a,b){this.envAabb.mergePoints(a,b);for(var c=0;c<b;)if(this.envRot.isEmpty()){var d=Pd(a[c]),e=Qd(a[c]);this.envRot.setCoords({x:d,y:e});c++}else{for(;c<b;c++)d=Pd(a[c]),e=Qd(a[c]),this.envRot.mergeNeCoords(d,e);break}}isIntersectingPoint2D(a){return this.envAabb.contains(a)&&this.envRot.containsCoords(Pd(a),Qd(a))?!0:!1}isIntersectingW(a){return this.envAabb.isIntersecting(a.envAabb)&&
this.envRot.isIntersecting(a.envRot)}containsW(a){return this.envAabb.containsEnvelope(a.envAabb)&&this.envRot.containsEnvelope(a.envRot)?!0:!1}containsPoint2D(a){return this.isIntersectingPoint2D(a)}intersectW(a){const b=this.envAabb.intersect(a.envAabb);a=this.envRot.intersect(a.envRot);b&&!a&&this.envAabb.setEmpty();a&&!b&&this.envRot.setEmpty();return b&&a}inflate(a){this.envAabb.inflateCoords(a,a);a*=l.sqrt2();this.envRot.inflateCoords(a,a);0>a&&Va.st_reduceEmpty(this)}sqrMaxMinDistance(a){p.geometryReleaseAssert(0);
return 0}sqrMinDistance(a){p.geometryReleaseAssert(0);return 0}sqrMaxDistance(a){p.geometryReleaseAssert(0);return 0}getEnvelope2D(){p.geometryReleaseAssert(0);return new D(this.envAabb)}static st_reduceEmpty(a){const b=a.envAabb.isEmpty(),c=a.envRot.isEmpty();b&&!c?a.envRot.setEmpty():c&&!b&&a.envAabb.setEmpty()}}class Fl{constructor(a){this.m_factor=1;this.m_wkid=0;this.m_peUnit=null;a&&(this.m_peUnit=a,this.m_factor=a.getUnitFactor(),this.m_wkid=a.getCode(),0>this.m_wkid&&(this.m_wkid=0))}getName(){return this.m_peUnit.getName()}getID(){return this.m_wkid}getConversionFactor(a){this.getUnitType()!==
a.getUnitType()&&p.throwInvalidArgumentException("unit type mismatch");return this.getUnitToBaseFactor()/a.getUnitToBaseFactor()}getUnitToBaseFactor(){return this.m_factor}getHashCode(){return l.hashCombine(l.hashInt32(this.getUnitType()),l.hashInt32(this.getUnitToBaseFactor()))}equals(a){return a?this.getUnitType()===a.getUnitType()&&this.getUnitToBaseFactor()===a.getUnitToBaseFactor()&&this.getID()===a.getID()&&this.getName()===a.getName():!1}static isValidWkid(a){return!1}}class Xl extends bb.GeometryCursor{constructor(a,
b){super();this.m_index=-1;this.gc=a;this.dim=b}next(){for(;!(this.m_index>=this.gc.getGeometryCount());){this.m_index++;if(this.m_index===this.gc.getGeometryCount())break;const a=this.gc.getGeometry(this.m_index);if(-1===this.dim||0!==(1<<a.getDimension()&this.dim))return a}return null}getGeometryID(){return this.m_index}tock(){return!0}getRank(){return 1}}class ue{constructor(a){this.m_geoms=[];this.m_description=cb();a&&(a.vd?this.m_description=a.vd:a.copy?a.copy.copyTo(this):p.geometryReleaseAssert(0))}assignCopy(a){p.geometryReleaseAssert(0);
return this}assignMove(a){p.geometryReleaseAssert(0);return this}getGeometryCount(){return this.m_geoms.length}reserve(a){p.geometryReleaseAssert(0)}addGeometry(a){if(a.getGeometryType()===p.GeometryType.enumGeometryCollection)for(let b=0,c=a.getGeometryCount();b<c;b++)this.addGeometry(a.getGeometry(b));else this.m_geoms.push(a.clone()),this.mergeVertexDescription(a.getDescription())}addGeometryMove(a){p.geometryReleaseAssert(0)}addCursor(a){p.geometryReleaseAssert(0)}getGeometry(a){(0>a||a>=this.m_geoms.length)&&
p.throwInvalidArgumentException("Geometry_collection.get_geometry");return this.m_geoms[a]}modifiedElementIndex(a){p.geometryReleaseAssert(0)}modifiedElement(a){p.geometryReleaseAssert(0)}getGeometryType(){return p.GeometryType.enumGeometryCollection}getDimension(){let a=0;for(const b of this.m_geoms)a=Math.max(a,b.getDimension());return a}getDescription(){return this.m_description}assignVertexDescription(a){this.m_description!==a&&this.assignVertexDescriptionImpl(a)}assignVertexDescriptionImpl(a){for(const b of this.m_geoms)b.assignVertexDescription(a);
this.m_description=a}mergeVertexDescription(a){this.m_description!==a&&(this.m_description.hasAttributesFrom(a)||this.mergeVertexDescriptionImpl(a))}hasAttribute(a){return this.m_description.hasAttribute(a)}addAttribute(a){this.m_description.hasAttribute(a)||(a=Jd(this.m_description,a),this.assignVertexDescription(a))}dropAttribute(a){p.geometryReleaseAssert(0)}dropAllAttributes(){p.geometryReleaseAssert(0)}queryInterval(a,b){p.geometryReleaseAssert(0);return new l.Envelope1D(0,0)}queryEnvelope(a){p.geometryReleaseAssert(0)}queryLooseEnvelope(a){p.geometryReleaseAssert(0)}isEmpty(){return 0===
this.m_geoms.length}setEmpty(){p.geometryReleaseAssert(0)}applyTransformation(a){if(a instanceof l.Transformation2D)for(const b of this.m_geoms)b.applyTransformation(a);p.geometryReleaseAssert(0)}transformAttribute(a,b,c,d,e){p.geometryReleaseAssert(0)}createInstance(){return new ue({vd:this.getDescription()})}copyTo(a){a.getGeometryType()!==p.GeometryType.enumGeometryCollection&&p.throwInvalidArgumentException("");if(a!==this){a.m_geoms.length=0;a.assignVertexDescription(this.m_description);for(const b of this.m_geoms)a.m_geoms.push(b.clone())}}calculateArea2D(){p.geometryReleaseAssert(0);
return 0}calculateLength2D(){p.geometryReleaseAssert(0);return 0}calculateLength3D(a){p.geometryReleaseAssert(0);return 0}getBoundary(){p.geometryReleaseAssert(0);return this}clone(){return new ue({copy:this})}equals(a,b){if(a===this)return!0;if(a.getGeometryType()!==p.GeometryType.enumGeometryCollection||this.m_description!==a.m_description||this.m_geoms.length!==a.m_geoms.length)return!1;for(let c=0;c<this.m_geoms.length;++c)if(!this.m_geoms[c].equals(a.m_geoms[c],b))return!1;return!0}swap(a){p.geometryReleaseAssert(0)}setAttributeBasic(a,
b,c){p.geometryReleaseAssert(0)}replaceNaNs(a,b){p.geometryReleaseAssert(0)}getImpl(){return this}vertexCount(){p.geometryReleaseAssert(0);return 0}hasNonLinearSegments(){p.geometryReleaseAssert(0);return!1}mergeVertexDescriptionImpl(a){const b=this.getDescription();a=Id(b,a);this.assignVertexDescription(a)}}ue.type=p.GeometryType.enumGeometryCollection;class va{assign(a){this.m_reason=a.m_reason;this.m_vertexIndex1=a.m_vertexIndex1;this.m_vertexIndex2=a.m_vertexIndex2}constructor(a,b,c){void 0!==
a?(this.m_reason=a,this.m_vertexIndex1=b,this.m_vertexIndex2=c):(this.m_reason=0,this.m_vertexIndex1=-1,this.m_vertexIndex2=-2)}clear(){p.geometryReleaseAssert(0)}}class Gl{constructor(a){this.m_geom=this.m_sr=null;a&&(a.move?(this.m_geom=a.move.m_geom,a.move.m_geom=null,this.m_sr=a.move.m_sr,a.move.m_sr=null):a.copy?(this.m_geom=a.copy.m_geom?a.copy.m_geom.clone():null,this.m_sr=a.copy.m_sr):(a.geom&&(this.m_geom=a.geom),a.sr&&(this.m_sr=a.sr)))}assignCopy(a){p.geometryReleaseAssert(0);return this}assignMove(a){p.geometryReleaseAssert(0);
return this}getGeometry(){return this.m_geom}getSpatialReference(){return this.m_sr}setGeometry(a){this.m_geom=a}setSpatialReference(a){this.m_sr=a}getHashCode(){p.geometryReleaseAssert(0);return 0}equals(a,b){p.geometryReleaseAssert(0);return!1}clone(){p.geometryReleaseAssert(0);return this}hasGeom(){return!!this.m_geom}}const Ef={330:104878,500:104879,1300:104899,1450:104986,2230:104988,3800:104978,5E3:104919,6200:104906,8200:104909,9500:104927,9600:104977,1E4:[104911,104936],11E3:104941,11080:104872,
11100:104907,12E3:104920,12400:104995,13E3:104948,14E3:[104923,104989],15E3:[104913,104954],15100:104976,16E3:[104926,104931],18E3:[104922,104982],21E3:104947,21500:104877,27E3:[104950,104957],29E3:104964,3E4:104921,31E3:104949,33E3:104946,4E4:[104914,104967],40600:104897,41900:104937,42E3:104951,43100:104993,49300:104924,50100:104939,54E3:104955,58200:104981,59500:104930,74E3:104961,77E3:104956,79E3:104962,83500:104910,85E3:104917,88800:104934,89200:104985,96E3:104997,104E3:104963,106500:104898,
11E4:104938,133E3:104932,135E3:104983,17E4:104965,198200:104987,198630:104935,208E3:104966,235800:104952,249400:104929,252100:104980,255E3:104973,47E4:104972,529800:104942,531E3:104996,56E4:104928,561400:104979,578900:104945,584700:104959,593E3:104970,606E3:104999,718E3:104933,745700:104984,761400:104953,763500:104994,764E3:104940,788900:104958,1188300:104998,1195E3:104969,1352600:104968,1560800:104874,1562090:104915,1737400:104903,1821460:104918,1821490:104876,2409300:104912,2410300:104873,2439400:104974,
2439700:104900,2575E3:104943,2631200:104875,2632345:104916,3393400:104904,3396190:[104905,104971],6051E3:104901,6051800:104902,637E4:104128,6370997:[4052,37008],6371E3:4035,6371007:4047,6371228:[4053,10346],6376045:[8042,8043],6376523:[4027,4901,4902],6376896:37007,6378135:[4122,4322,4324,4720,4985,4987],6378136:[4740,4923,7678,7680,9474,9475,104017,104018],6378137:[3823,3824,3888,3889,4017,4019,4023,4031,4040,4046,4055,4074,4075,4080,4081,4121,4126,4130,4133,4140,4141,4148,4151,4152,4163,4166,4167,
4170,4171,4172,4173,4176,4180,4189,4190,4258,4269,4283,4318,4319,4326,4463,4466,4469,4470,4480,4482,4483,4490,4557,4558,4612,4617,4619,4624,4627,4659,4661,4667,4669,4670,4674,4686,4687,4693,4694,4702,4737,4742,4747,4749,4750,4755,4756,4757,4758,4759,4761,4762,4763,4764,4765,4883,4885,4887,4889,4893,4895,4898,4907,4909,4921,4925,4927,4929,4931,4933,4935,4937,4939,4941,4943,4945,4947,4949,4951,4953,4955,4957,4959,4961,4963,4965,4967,4971,4975,4977,4979,4981,4983,4989,4997,4999,5012,5013,5245,5246,5251,
5252,5263,5264,5323,5324,5340,5342,5353,5354,5359,5360,5364,5365,5370,5371,5372,5373,5380,5381,5392,5393,5488,5489,5545,5546,5592,5593,5885,5886,6134,6135,6310,6311,6318,6319,6321,6322,6324,6325,6364,6365,6667,6668,6705,6706,6782,6783,6980,6982,6983,6987,6989,6990,7034,7035,7036,7037,7038,7039,7040,7041,7042,7072,7073,7084,7085,7086,7087,7133,7135,7136,7138,7139,7372,7373,7657,7659,7661,7663,7665,7685,7686,7797,7798,7816,7843,7844,7880,7881,7885,7886,7900,7901,7902,7903,7904,7905,7906,7907,7908,7909,
7910,7911,7912,7915,7917,7919,7921,7923,7925,7927,7929,7931,8085,8086,8231,8232,8235,8237,8239,8240,8244,8246,8248,8249,8251,8252,8254,8255,8399,8403,8426,8427,8449,8542,8544,8545,8684,8685,8698,8699,8817,8818,8860,8888,8899,8900,8901,8902,8906,8907,8916,8918,8920,8922,8924,8926,8928,8930,8932,8934,8936,8938,8940,8942,8944,8946,8948,8949,8972,8973,8974,8975,8976,8977,8978,8979,8980,8981,8982,8983,8984,8985,8986,8987,8988,8989,8990,8991,8992,8993,8994,8995,8996,8997,8998,8999,9E3,9002,9003,9005,9006,
9008,9009,9011,9012,9013,9014,9016,9017,9018,9019,9053,9054,9055,9056,9057,9059,9060,9061,9062,9063,9064,9065,9066,9067,9068,9069,9071,9072,9074,9075,9139,9140,9147,9148,9152,9153,9183,9184,9293,9294,9299,9308,9309,9332,9333,9364,9372,9379,9380,9384,9453,9469,9470,9546,9547,9695,9696,9701,9702,9739,9754,9755,9758,9763,9776,9777,9778,9779,9781,9782,9783,9784,9866,9871,9939,9964,9969,9974,9989,9990,10175,10177,10178,10185,10191,10196,10204,10209,10214,10219,10224,10229,10237,10272,10277,10283,10284,
10298,10299,10300,10304,10305,10307,10309,10310,10311,10312,10327,10328,10413,10414,10468,10474,10475,10570,10571,10605,10606,10623,10628,20033,20040,20041,20045,20046,104009,104010,104011,104012,104013,104014,104015,104016,104019,104020,104021,104022,104024,104027,104028,104050,104100,104107,104108,104110,104111,104114,104115,104116,104117,104118,104119,104120,104121,104122,104123,104124,104129,104133,104134,104137,104141,104142,104143,104144,104145,104179,104180,104181,104182,104183,104184,104185,
104186,104199,104223,104257,104258,104259,104260,104286,104287,104602,104613,104644,104645,104646,104647,104653,104804,104896,104991],6378140:4610,6378145:[4025,4276,4760,4891,37001],6378150:37003,6378155:[37004,37207],6378160:[3821,4003,4021,4036,4202,4203,4237,4238,4291,4618,4708,5527,37231,104023,104136],6378166:37002,6378200:[4020,4229,4286,4303,4706],6378245:[4024,4147,4164,4178,4179,4191,4200,4205,4214,4284,4317,4555,4676,4677,4678,4991,4993,5560,5561,37257,104135],6378270:[4732,37005,37229],
6378273:[4054,10345],6378300:[4029,4168,4174],6378388:[4022,4123,4153,4154,4158,4159,4160,4161,4165,4181,4182,4183,4184,4185,4192,4194,4195,4196,4199,4204,4207,4208,4215,4218,4221,4224,4225,4230,4231,4233,4235,4236,4247,4248,4249,4254,4255,4259,4264,4265,4271,4272,4274,4285,4287,4288,4292,4297,4309,4311,4313,4316,4472,4475,4611,4614,4615,4616,4621,4622,4623,4625,4626,4628,4629,4630,4631,4632,4633,4636,4637,4639,4641,4642,4643,4644,4645,4646,4658,4660,4662,4663,4664,4665,4668,4672,4673,4684,4688,4689,
4690,4691,4692,4698,4704,4705,4707,4709,4710,4711,4712,4714,4715,4716,4718,4719,4721,4722,4724,4725,4727,4728,4729,4730,4733,4734,4735,4739,4741,4753,4754,4802,4803,4806,4809,4810,4823,4824,4900,5524,6883,8428,8430,8431,9248,9251,9253,9403,9893,10158,10249,10252,37201,37204,37205,37212,37213,37214,37215,37216,37217,37218,37219,37221,37222,37224,37226,37227,37230,37232,37233,37234,37235,37237,37238,37241,37242,37245,37246,37247,37249,37250,37251,37253,37259,104104,104106,104125,104126,104127,104130,
104138,104248],6378523:104786,24764E3:104960,25559E3:104944,60268E3:104925,71492E3:104908,6957E5:104975,"6377397.155":[3819,3906,4004,4120,4124,4125,4149,4150,4156,4162,4211,4219,4257,4262,4280,4289,4294,4295,4301,4306,4308,4312,4314,4613,4666,4745,4746,4801,4804,4805,4808,4813,4814,4815,4818,4820,4904,5132,5228,5229,5681,5830,8351,9267,10268,37255,104101,104102,104105,104131,104648,104696,104697,104990,104992],"6377563.396":[4001,4188,4277,4278,4279],"6377340.189":[4002,4299,4300],"6377492.018":[4005,
4273,4817],"6377483.865280418":[4006,4293],"6378293.645208759":[4007,4157,4302,4738,5464],"6378206.4":[4008,4127,4128,4129,4135,4136,4137,4138,4139,4169,4216,4242,4253,4267,4608,4609,4638,4675,4683,4695,4717,4723,4726,4995,5451,5467,37220,37239,37243,37252,37260,104E3,104109,104112,104113,104132],"6378450.047":[4009,4268],"6378300.789":[4010,4281],"6378249.2":[4011,4014,4155,4193,4206,4213,4223,4226,4227,4228,4252,4261,4266,4275,4282,4296,4304,4310,4315,4671,4807,4811,4816,4821,37223,37225,104139,
104140,104261,104304],"6378249.145":[4012,4013,4132,4134,4142,4143,4175,4197,4198,4201,4209,4210,4212,4220,4222,4232,4234,4246,4250,4251,4256,4260,4263,4270,4305,4307,4600,4601,4602,4603,4604,4605,4606,4607,4620,4679,4680,4696,4697,4699,4700,4701,4703,4713,4731,4736,4743,4744,4812,4819,6881,6882,6892,6894,8694,37206,37208,37211,37228,37240,37254,104025,104026,104103,104305],"6377276.345":[4015,4131,4144,4239,4240,4244,4682,5233,6207,37202,104256,104664,104693],"6377298.556":[4016,4298],"6377304.063":[4018,
4245],"6378298.3":[4028,4903],"6378136.2":4032,"6378136.3":4033,"6378249.144808011":[4034,4241],"20922931.8":[4042,4243],"6377301.243":[4044,4145,37203],"6377299.151":[4045,4146],"6377019.27":[4657,10256,10260,10265],"6378306.3696":[4748,4752],"6377295.664":[4751,37006],"6378136.5":[7682,7683],"6371008.7714":104047,"6378418.941":[104700,104726,104760],"6378586.581":[104701,104743],"6378505.809":104702,"6378544.823":104703,"6378490.569":104704,"6378470.757":[104705,104776],"6378403.701":[104706,104750],
"6378434.181":[104707,104724,104739,104764],"6378454.907":104708,"6378400.653":104709,"6378567.378":104710,"6378546.957":[104711,104717,104780],"6378476.853":[104712,104736],"6378411.321":[104713,104728],"6378647.541":[104714,104715],"6378514.953":[104716,104782],"6378421.989":[104718,104770],"6378481.425":[104719,104753,104774,104781],"6378518.001":[104720,104725],"6378521.049":[104721,104723,104731,104745,104748],"6378464.661":104722,"6378436.619":104727,"6378574.389":[104729,104730],"6378472.281":[104732,
104756],"6378498.189":[104733,104746],"6378449.421":[104734,104766],"6378525.621":[104735,104754],"6378466.185":104737,"6378496.665":104738,"6378643.579":104740,"6378559.758":104741,"6378414.369":[104742,104763,104772],"6378441.801":104744,"6378502.761":[104747,104759,104773,104775],"6378617.061":104749,"6378624.681":[104751,104765],"6378468.623":104752,"6378445.763":[104755,104758,104761],"6378670.401":104757,"6378438.753":104762,"6378543.909":104767,"6378605.783":104768,"6378540.861":104769,"6378443.325":[104771,
104784],"6378548.481":104777,"6378463.746":104778,"6378426.561":104779,"6378453.688":104783,"6378530.193":104785,"6378376.271":[104800,104828],"6378471.92":104801,"6378472.931":104802,"6378411.351":104803,"6378380.991":104805,"6378414.96":104806,"6378345.09":[104807,104819,104844,104870],"6378412.542":104808,"6378470.401":104809,"6378376.331":104810,"6378379.031":104811,"6378407.621":104812,"6378376.811":[104813,104827],"6378313.92":104814,"6378414.93":104815,"6378413.021":104816,"6378380.381":104817,
"6378530.851":104818,"6378591.521":104820,"6378378.881":104821,"6378408.481":[104822,104832],"6378375.601":[104823,104838],"6378408.041":104824,"6378655.071":104825,"6378409.151":104826,"6378315.7":[104829,104840,104845,104851],"6378285.86":[104830,104835,104859],"6378379.301":104831,"6378560.121":104833,"6378531.821":104834,"6378500.6":104836,"6378376.041":104837,"6378406.601":104839,"6378438.991":104841,"6378345.42":104842,"6378593.86":104843,"6378381.271":[104846,104847],"6378413.671":104848,"6378344.377":104849,
"6378563.891":104850,"6378408.091":104852,"6378377.671":104853,"6378472.751":104854,"6378412.511":104855,"6378407.281":104856,"6378534.451":104857,"6378406.051":104858,"6378532.921":104860,"6378380.091":104861,"6378408.941":104862,"6378624.171":104863,"6378377.411":104864,"6378474.591":104865,"6378407.141":104866,"6378376.871":104867,"6378375.251":104868,"6378405.971":104869,"6378437.651":104871};class S{constructor(){this.x=l.ECoordinate.getNAN();this.y=l.ECoordinate.getNAN()}static getNAN(){return new S}static constructPoint2D(a){const b=
new S;b.x.set(a.x);b.y.set(a.y);return b}static constructCoords(a,b){const c=new S;c.x.set(a);c.y.set(b);return c}static constructCoordsE(a,b){const c=new S;c.setCoordsE(a,b);return c}get 0(){return this.x.clone()}set 0(a){this.x.setE(a)}get 1(){return this.y.clone()}set 1(a){this.y.setE(a)}clone(){return(new S).setE(this)}setCoords(a,b){this.x.set(a);this.y.set(b);return this}setCoordsE(a,b){this.x.setE(a);this.y.setE(b);return this}set(a){this.x.set(a.x);this.y.set(a.y);return this}setE(a){this.x.setE(a.x);
this.y.setE(a.y);return this}setWithEps(a,b){this.x.setWithEps(a.x,b);this.y.setWithEps(a.y,b);return this}getUnitVector(){const a=this.clone();a.normalize();return a}sqrLength(){return this.x.sqr().addE(this.y.sqr())}length(){return this.sqrLength().sqrt()}mulE(a){const b=new S;b.setCoordsE(this.x.mulE(a),this.y.mulE(a));return b}mul(a){const b=new S;b.setCoordsE(this.x.mul(a),this.y.mul(a));return b}mulThis(a){this.x.mulThis(a);this.y.mulThis(a);return this}divE(a){return this.clone().divThisE(a)}divThisE(a){this.x.divThisE(a);
this.y.divThisE(a);return this}normalize(){const a=this.length();0===a.value()?(this.x=l.s_one.clone(),this.y=l.s_zero.clone()):(this.x.divThisE(a),this.y.divThisE(a))}addE(a){return this.clone().addThisE(a)}addThisE(a){this.x.addThisE(a.x);this.y.addThisE(a.y);return this}subE(a){return this.clone().subThisE(a)}subThisE(a){this.x.subThisE(a.x);this.y.subThisE(a.y);return this}static distance(a,b){return a.subE(b).length()}negateThis(){this.x.negateThis();this.y.negateThis();return this}eq(a){return this.x.eq(a.x)&&
this.y.eq(a.y)}isZero(){return this.x.isZero()&&this.y.isZero()}isTrueZero(){return!this.x.value()&&!this.y.value()}rotateDirect(a,b){const c=this.x.mulE(a).subThisE(this.y.mulE(b));a=this.x.mulE(b).addThisE(this.y.mulE(a));this.x.setE(c);this.y.setE(a);return this}rotateReverse(a,b){const c=this.x.mulE(a).addThisE(this.y.mulE(b));a=this.x.negate().mulThisE(b).addThisE(this.y.mulE(a));this.x.setE(c);this.y.setE(a);return this}dotProduct(a){return this.x.mulE(a.x).addE(this.y.mulE(a.y))}crossProduct(a){return this.x.mulE(a.y).subE(this.y.mulE(a.x))}value(){return l.Point2D.construct(this.x.value(),
this.y.value())}}class zf{constructor(){this.a11=new l.ECoordinate(1);this.a12=new l.ECoordinate(0);this.a21=new l.ECoordinate(0);this.a22=new l.ECoordinate(1)}clone(){const a=new zf;a.a11.setE(this.a11);a.a12.setE(this.a12);a.a21.setE(this.a21);a.a22.setE(this.a22);return a}assign(a){this.a11.setE(a.a11);this.a12.setE(a.a12);this.a21.setE(a.a21);this.a22.setE(a.a22);return this}mulThis(a){const b=this.a11.mulE(a.a11).addThisE(this.a12.mulE(a.a21)),c=this.a11.mulE(a.a12).addThisE(this.a12.mulE(a.a22)),
d=this.a21.mulE(a.a11).addThisE(this.a22.mulE(a.a21));a=this.a21.mulE(a.a12).addThisE(this.a22.mulE(a.a22));this.a11=b;this.a12=c;this.a21=d;this.a22=a;return this}mulLeftThis(a){a=a.clone();this.assign(a.mulThis(this));return this}det(){return this.a11.mulE(this.a22).subThisE(this.a12.mulE(this.a21))}invertThis(){const a=this.det();if(0!==a.value()){const b=this.a22.divE(a),c=this.a12.negate().divThisE(a),d=this.a21.negate().divThisE(a),e=this.a11.divE(a);this.a11=b;this.a12=c;this.a21=d;this.a22=
e}else this.setZero();return!a.isZero()}transposeThis(){this.a21=l.swap(this.a12,this.a12=this.a21);return this}transformPoint(a){p.geometryReleaseAssert(0);return new S}eigenValues(a){p.geometryReleaseAssert(0);return 0}eigenVectors(a,b){p.geometryReleaseAssert(0);return 0}eigenSymmetric(a,b){var c=this.a12.clone();c.addThisE(this.a21);c.mulThisByPower2(.5);let d=new l.ECoordinate(1);var e=new l.ECoordinate(0);if(c.isZero())a[0].setE(this.a11),a[1].setE(this.a22);else{const g=new l.ECoordinate(1);
if(this.a11.ne(this.a22)){e=this.a11.subE(this.a22).divE(c);e.mulThisByPower2(.5);var f=e.sqr();g.setE(e);g.absThis();g.subThisE(f.add(1).sqrtThis());e.gt(l.s_zero)&&g.negateThis();f=g.sqr().addThis(1).sqrtThis().invThis();e=g.mulE(f);d.setE(f);c=g.mulE(c);a[0]=this.a11.addE(c);a[1]=this.a22.subE(c)}else d=new l.ECoordinate(1/Math.sqrt(2)),e=d.clone(),a[0]=this.a11.addE(c),a[1]=this.a22.subE(c)}b[0].x=d.toDouble();b[0].y=e.toDouble();b[1].x=e.negate().toDouble();b[1].y=d.toDouble();Math.abs(a[0].toDouble())>
Math.abs(a[1].toDouble())&&(a[1]=l.swap(a[0],a[0]=a[1]),b[1]=l.swap(b[0],b[0]=b[1]))}setZero(){this.a11.set(0);this.a21.set(0);this.a12.set(0);this.a22.set(0)}}var Mc=K;class ve{constructor(a){a.copy?(this.m_XStart=a.copy.m_XStart,this.m_YStart=a.copy.m_YStart,this.m_XEnd=a.copy.m_XEnd,this.m_YEnd=a.copy.m_YEnd,this.m_description=a.copy.m_description,this.m_attributes=null,this.m_description&&this.m_description.getTotalComponentCount()-2&&(this.m_attributes=a.copy.m_attributes.slice())):a.move?(this.m_description=
a.move.m_description,a.move.m_description=null,this.m_attributes=a.move.m_attributes,a.move.m_attributes=null,this.m_XStart=a.move.m_XStart,this.m_YStart=a.move.m_YStart,this.m_XEnd=a.move.m_XEnd,this.m_YEnd=a.move.m_YEnd):void 0!==a.XStart?(this.m_XStart=a.XStart,this.m_YStart=a.YStart,this.m_XEnd=a.XEnd,this.m_YEnd=a.YEnd,this.m_attributes=null,this.m_description=a.vd?a.vd:cb(),a.vd&&this.setDefaultAttributeValues()):void 0!==a.ZStart?(this.m_XStart=a.XStart,this.m_YStart=a.YStart,this.m_XEnd=a.XEnd,
this.m_YEnd=a.YEnd,this.m_description=a.vd?a.vd:Kd(),a.vd?(this.setDefaultAttributeValues(),this.addAttribute(1),this.m_attributes[0]=a.ZStart,this.m_attributes[this.m_description.getTotalComponentCount()-2]=a.ZEnd):this.m_attributes=[a.ZStart,a.ZEnd]):a.start?(this.m_XStart=a.start.x,this.m_YStart=a.start.y,this.m_XEnd=a.end.x,this.m_YEnd=a.end.y,this.m_attributes=null,this.m_description=cb()):a.start3D?(this.m_XStart=a.start3D.x,this.m_YStart=a.start3D.y,this.m_XEnd=a.end3D.x,this.m_YEnd=a.end3D.y,
this.m_description=a.vd?a.vd:Kd(),a.vd?(this.setDefaultAttributeValues(),this.addAttribute(1),this.m_attributes[0]=a.start3D.z,this.m_attributes[this.m_description.getTotalComponentCount()-2]=a.end3D.z):this.m_attributes=[a.start3D.z,a.end3D.z]):(p.geometryReleaseAssert(0),this.m_XStart=this.m_YStart=this.m_XEnd=this.m_YEnd=Number.NaN)}setDefaultAttributeValues(){const a=this.m_description.getTotalComponentCount()-2;0<a&&(null===this.m_attributes&&(this.m_attributes=l.makePrimitiveArray(2*a,Number.NaN)),
l.memcpy(this.m_attributes,this.m_description.getDefaultPointAttributes(),0,2,a),l.memcpy(this.m_attributes,this.m_description.getDefaultPointAttributes(),a,2,a))}absNormXYZ(a){p.throwNotImplementedException("not implemented");return 0}snapControlPoints3D(){p.throwNotImplementedException("not implemented");return!1}setCoordsForIntersector3D(a,b,c){p.throwNotImplementedException("not implemented")}transformAttribute(a,b,c,d,e){p.throwNotImplementedException("")}mergeVertexDescriptionImpl(a){const b=
this.getDescription();a=Id(b,a);this.assignVertexDescription(a)}changeEndPoints(a,b){var c=a.getXY(),d=b.getXY();this.changeEndPoints2D(c,d);c=a.getDescription();c!==this.getDescription()&&this.mergeVertexDescription(c);c=b.getDescription();c!==this.getDescription()&&this.mergeVertexDescription(c);for(let f=1,g=c.getAttributeCount();f<g;f++){d=c.getSemantics(f);const h=K.getComponentCount(d);for(let k=0;k<h;k++){var e=a.getAttributeAsDbl(d,k);pc(this,0,d,k,e);e=b.getAttributeAsDbl(d,k);pc(this,1,
d,k,e)}}}getStartXY(){return new l.Point2D(this.m_XStart,this.m_YStart)}setStartXY(a){this.m_XStart=a.x;this.m_YStart=a.y;this.endPointModified()}setStartXYCoords(a,b){this.m_XStart=a;this.m_YStart=b;this.endPointModified()}getStartXYZ(){p.geometryReleaseAssert(0);return new X(0,0,0)}setStartXYZ(a){p.geometryReleaseAssert(0)}setStartXYZCoords(a,b,c){Th(this,0,X.construct(a,b,c))}queryStart(a){Uh(this,0,a)}setStart(a){Vh(this,0,a)}setStart2D(a){this.setStartXY(a)}getStartAttributeAsDbl(a,b){return Xb(this,
0,a,b)}getStartAttributeAsInt(a,b){p.geometryReleaseAssert(0);return 0}setStartAttribute(a,b,c){pc(this,0,a,b,c)}setStartAttributesFromPoint(a,b){p.geometryReleaseAssert(0)}setEndAttributesFromPoint(a,b){p.geometryReleaseAssert(0)}getStartX(){return this.m_XStart}getStartY(){return this.m_YStart}getStartZ(){p.geometryReleaseAssert(0);return 0}getEndX(){return this.m_XEnd}getEndY(){return this.m_YEnd}getEndZ(){p.geometryReleaseAssert(0);return 0}getEndXY(){return new l.Point2D(this.m_XEnd,this.m_YEnd)}setEndXY(a){this.m_XEnd=
a.x;this.m_YEnd=a.y;this.endPointModified()}setEndXYCoords(a,b){this.m_XEnd=a;this.m_YEnd=b;this.endPointModified()}getEndXYZ(){p.geometryReleaseAssert(0);return new X(0,0,0)}setEndXYZ(a){p.geometryReleaseAssert(0)}setEndXYZCoords(a,b,c){Th(this,1,X.construct(a,b,c))}queryEnd(a){Uh(this,1,a)}setEnd(a){Vh(this,1,a)}setEnd2D(a){this.setEndXY(a)}getEndAttributeAsDbl(a,b){return Xb(this,1,a,b)}getEndAttributeAsInt(a,b){p.geometryReleaseAssert(0);return 0}setEndAttribute(a,b,c){pc(this,1,a,b,c)}getDimension(){return 1}copyTo(a){this!==
a&&(a.getGeometryType()!==this.getGeometryType()&&p.throwInvalidArgumentException(""),a.assignVertexDescription(this.m_description),a.m_attributes&&l.memcpy(a.m_attributes,this.m_attributes,0,0,2*(this.m_description.getTotalComponentCount()-2)),a.m_XStart=this.m_XStart,a.m_YStart=this.m_YStart,a.m_XEnd=this.m_XEnd,a.m_YEnd=this.m_YEnd,this.copyToImpl(a))}isEmpty(){return this.isEmptyImpl()}isClosed(){return this.m_XStart===this.m_XEnd&&this.m_YStart===this.m_YEnd}setEmpty(){}calculateArea2D(){return 0}queryInterval(a,
b){const c=l.Envelope1D.constructEmpty();c.vmin=Xb(this,0,a,b);c.vmax=c.vmin;c.mergeNeCoordinate(Xb(this,1,a,b));return c}calculateLength3D(a){p.geometryReleaseAssert(0);return 0}getCoord3D(a){p.geometryReleaseAssert(0);return{}}getCoord2D(a){const b=l.Point2D.getNAN();this.queryCoord2D(a,b);return b}queryCoord3D(a,b){p.geometryReleaseAssert(0)}getCoordZ(a){p.geometryReleaseAssert(0);return 0}queryCoord(a,b){b.assignVertexDescription(this.m_description);b.setXY(this.getCoord2D(a));for(let c=1,d=this.m_description.getAttributeCount();c<
d;c++){const e=this.m_description.getSemantics(c),f=K.getComponentCount(e);for(let g=0;g<f;g++){const h=this.getAttributeAsDbl(a,e,g);b.setAttributeBasic(e,g,h)}}}isCloserThanDistance(a,b,c){const d=D.constructEmpty();this.queryLooseEnvelopeOnInterval(b,d);if(d.distance(a)>c)return!1;b=this.getClosestCoordinateOnInterval(a,b,c);return!Number.isNaN(b)&&l.Point2D.distance(a,this.getCoord2D(b))<=c}isMonotoneQuickAndDirty(){return!1}isTrue3D(){return!1}getReversed(){const a=this.clone();a.reverse();return a}reverse(){this.m_XEnd=
l.swap(this.m_XStart,this.m_XStart=this.m_XEnd);this.m_YEnd=l.swap(this.m_YStart,this.m_YStart=this.m_YEnd);this.reverseImpl();for(let a=1,b=this.m_description.getAttributeCount();a<b;a++){const c=this.m_description.getSemantics(a);for(let d=0,e=K.getComponentCount(c);d<e;d++){const f=Xb(this,0,c,d),g=Xb(this,1,c,d);pc(this,0,c,d,g);pc(this,1,c,d,f)}}this.afterCompletedModification();return this}isEmptyImpl(){return!1}isCircular(){return!1}distance(a,b,c,d){if(!b&&this.isIntersecting(a,0,!1)){if(null!==
c||null!==d){b=Array(9);var e=Array(9);a=this.intersect(a,null,b,e,0);p.geometryReleaseAssert(9>=a);0===a&&p.throwInternalErrorException("");null!==c&&(c[0]=b[0]);null!==d&&(d[0]=e[0])}return 0}b=Number.MAX_VALUE;e=-1;var f=b;f=this.getStartXY();e=a.getClosestCoordinate(f,!1);f.subThis(a.getCoord2D(e));f=f.length();f<b&&(b=f,null!==d&&(d[0]=e),null!==c&&(c[0]=0));f=this.getEndXY();e=a.getClosestCoordinate(f,!1);f.subThis(a.getCoord2D(e));f=f.length();f<b&&(b=f,null!==d&&(d[0]=e),null!==c&&(c[0]=1));
f=a.getStartXY();e=this.getClosestCoordinate(f,!1);f.subThis(this.getCoord2D(e));f=f.length();f<b&&(b=f,null!==c&&(c[0]=e),null!==d&&(d[0]=0));f=a.getEndXY();e=this.getClosestCoordinate(f,!1);f.subThis(this.getCoord2D(e));f=f.length();f<b&&(b=f,null!==c&&(c[0]=e),null!==d&&(d[0]=1));return b}calculateSubLengthFromStart(a){return this.tToLength(a)}calculateSubLength(a,b){return b===a?0:this.tToLength(b)-this.tToLength(a)}static recalculateParentT(a,b,c){return l.lerp(a,b,c)}moveTo(a){const b=this.isClosed(),
c=new l.Transformation2D;c.setShift(a.sub(this.getStartXY()));this.applyTransformation(c);b?this.changeEndPoints2D(a,a):this.changeEndPoints2D(a,this.getEndXY())}moveTo3D(a){p.geometryReleaseAssert(0)}getDescription(){return this.m_description}assignVertexDescription(a){const b=Array(14);ye(a,this.m_description,b);let c=null;const d=a.getTotalComponentCount()-2,e=this.m_description?this.m_description.getTotalComponentCount()-2:0;if(0<d&&(c=Array(2*d),l.memcpy(c,a.getDefaultPointAttributes(),0,2,d),
l.memcpy(c,a.getDefaultPointAttributes(),d,2,d),null!==this.m_description))for(let g=1;g<a.getAttributeCount();g++){var f=b[g];if(-1!==f){f=this.m_description.getPointAttributeOffset(f)-2;const h=a.getPointAttributeOffset(g)-2,k=Mc.getComponentCount(a.getSemantics(g));for(let m=0;m<k;++m)c[h]=this.m_attributes[f],c[d+h]=this.m_attributes[e+f]}}this.m_attributes=c;this.m_description=a}mergeVertexDescription(a){this.m_description!==a&&(this.m_description.hasAttributesFrom(a)||this.mergeVertexDescriptionImpl(a))}hasAttribute(a){return this.m_description.hasAttribute(a)}addAttribute(a){this.m_description.hasAttribute(a)||
(a=Jd(this.m_description,a),this.assignVertexDescription(a))}dropAttribute(a){this.m_description.hasAttribute(a)&&(a=Pf(this.m_description,a),this.assignVertexDescription(a))}dropAllAttributes(){const a=cb();a!==this.m_description&&this.assignVertexDescription(a)}swap(a){p.geometryReleaseAssert(0)}equals(a,b){if(this.getGeometryType()!==a.getGeometryType())return!1;const c=void 0===b;c&&(b=0);if(this===a)return!0;if(this.m_description!==a.m_description||Math.abs(this.m_XStart-a.m_XStart)>b||Math.abs(this.m_XEnd-
a.m_XEnd)>b||Math.abs(this.m_YStart-a.m_YStart)>b||Math.abs(this.m_YEnd-a.m_YEnd)>b)return!1;for(let d=0,e=2*(this.m_description.getTotalComponentCount()-2);d<e;d++)if(!l.isEqualNonIEEETol(this.m_attributes[d],a.m_attributes[d],b))return!1;return c?this.equalsImpl(a):this.equalsImplTol(a,b)}getImpl(){return this}setAttributeBasic(a,b,c){this.addAttribute(a);0===a&&this.isCurve()?((0>b||1<b)&&p.throwInvalidArgumentException(""),a=new l.Transformation2D,a.setShiftCoords(0===b?c:0,1===b?c:0),0===b?a.xx=
0:a.yy=0,this.applyTransformation(a)):(this.setStartAttribute(a,b,c),this.setEndAttribute(a,b,c))}replaceNaNs(a,b){p.geometryReleaseAssert(0)}}ve.s_maxMonotonicPartParams=8;class we extends ve{constructor(a){super(a)}}class un extends we{isTrue3D(){return!0}constructor(a){super(a)}}class zh{constructor(a){this.m_xyStream=this.m_segFlagStream=null;this.m_bCirculator=!1;this.m_currentSegmentIndex=-1;this.m_nextPathIndex=this.m_nextSegmentIndex=0;this.m_currentPathIndex=-1;this.m_parent=a.parent;this.m_buffer=
new this.m_parent.m_segmentBufferCTor;this.m_description=a.parent.getDescription();this.m_segmentCount=this.getSegmentCount(this.m_nextPathIndex);if(void 0!==a.pointIndex){(0>a.pointIndex||a.pointIndex>=a.parent.getPointCount())&&p.throwOutOfRangeException("");var b=a.parent.getPathIndexFromPointIndex(a.pointIndex);this.m_currentPathIndex=b;this.m_nextPathIndex=b+1;this.m_nextSegmentIndex=a.pointIndex-a.parent.getPathStart(b);this.m_segmentCount=this.getSegmentCount(this.m_currentPathIndex)}else void 0!==
a.pathIndex&&((0>a.pathIndex||a.pathIndex>=a.parent.getPathCount()||0>a.segmentIndex)&&p.throwOutOfRangeException(""),b=a.parent.isClosedPath(a.pathIndex)?0:1,a.segmentIndex>=a.parent.getPathSize(a.pathIndex)-b&&p.throwOutOfRangeException(""),this.m_nextSegmentIndex=a.segmentIndex,this.m_currentPathIndex=a.pathIndex,this.m_nextPathIndex=this.m_nextSegmentIndex+1,this.m_segmentCount=this.getSegmentCount(this.m_nextPathIndex));this.prepare();this.m_pathBegin=-1;this.m_bStripAttributes=this.m_bCurrentPathClosed=
!1;this.m_prevSegmentIndex=this.m_prevPathIndex=-1;this.m_bNeedsUpdate=!1;-1<this.m_currentPathIndex&&(this.m_pathBegin=this.m_parent.getPathStart(this.m_currentPathIndex),this.m_bCurrentPathClosed=this.m_parent.isClosedPath(this.m_currentPathIndex))}stripAttributes(){this.m_bStripAttributes=!0}clone(){p.geometryReleaseAssert(0);return this}prepare(){this.m_bCirculator=!1;this.m_parent.isEmptyImpl()?this.m_xyStream=this.m_segFlagStream=null:(this.m_segFlagStream=this.m_parent.getSegmentFlagsStreamRef(),
this.m_xyStream=this.m_parent.getAttributeStreamRef(0))}nextPath(){this.m_currentPathIndex=this.m_nextPathIndex;if(this.m_currentPathIndex>=this.m_parent.getPathCount())return!1;this.m_currentSegmentIndex=-1;this.m_nextSegmentIndex=0;this.m_segmentCount=this.getSegmentCount(this.m_currentPathIndex);this.m_pathBegin=this.m_parent.getPathStart(this.m_currentPathIndex);this.m_bCurrentPathClosed=this.m_parent.isClosedPath(this.m_currentPathIndex);this.m_nextPathIndex++;return!0}previousPath(){if(0===
this.m_nextPathIndex)return!1;this.m_nextPathIndex--;this.m_currentSegmentIndex=-1;this.m_nextSegmentIndex=0;this.m_segmentCount=this.getSegmentCount(this.m_nextPathIndex);this.m_currentPathIndex=this.m_nextPathIndex;this.m_pathBegin=this.m_parent.getPathStart(this.m_currentPathIndex);this.m_bCurrentPathClosed=this.m_parent.isClosedPath(this.m_currentPathIndex);this.resetToLastSegment();return!0}getSegmentCount(a){return this.m_parent.isEmptyImpl()?0:this.m_parent.getSegmentCountPath(a)}resetToFirstPath(){this.m_segmentCount=
this.m_nextSegmentIndex=this.m_currentSegmentIndex=-1;this.m_nextPathIndex=0;this.m_pathBegin=this.m_currentPathIndex=-1;this.m_bCurrentPathClosed=!1}resetToLastPath(){this.m_nextPathIndex=this.m_parent.getPathCount();this.m_pathBegin=this.m_segmentCount=this.m_nextSegmentIndex=this.m_currentSegmentIndex=this.m_currentPathIndex=-1}resetToPath(a){(0>a||a>this.m_parent.getPathCount())&&p.throwOutOfRangeException("");this.m_nextPathIndex=a;this.m_pathBegin=this.m_segmentCount=this.m_nextSegmentIndex=
this.m_currentSegmentIndex=this.m_currentPathIndex=-1;this.m_bCurrentPathClosed=!1}isLastPath(){return this.m_currentPathIndex===this.m_parent.getPathCount()-1}isFirstSegmentInPath(){return 0===this.m_currentSegmentIndex}isLastSegmentInPath(){return this.m_currentSegmentIndex===this.m_segmentCount-1}resetToFirstSegment(){this.m_currentSegmentIndex=-1;this.m_nextSegmentIndex=0}resetToLastSegment(){this.m_nextSegmentIndex=this.m_segmentCount;this.m_currentSegmentIndex=-1}resetTo(a){this.m_parent!==
a.m_parent&&p.throwInvalidCallException("");this.m_currentSegmentIndex=a.m_currentSegmentIndex;this.m_nextSegmentIndex=a.m_nextSegmentIndex;this.m_currentPathIndex=a.m_currentPathIndex;this.m_nextPathIndex=a.m_nextPathIndex;this.m_segmentCount=a.m_segmentCount;this.m_bCirculator=a.m_bCirculator;this.m_pathBegin=a.m_pathBegin;this.m_bCurrentPathClosed=a.m_bCurrentPathClosed;this.m_bStripAttributes=a.m_bStripAttributes;this.m_description=a.m_description}resetToVertex(a,b){if(0<=this.m_currentPathIndex&&
this.m_currentPathIndex<this.m_parent.getPathCount()){const c=this.getPathBegin();if(a>=c&&a<this.m_parent.getPathEnd(this.m_currentPathIndex)){this.m_currentSegmentIndex=-1;this.m_nextSegmentIndex=a-c;return}}b=0<=b&&b<this.m_parent.getPathCount()&&a>=this.m_parent.getPathStart(b)&&a<this.m_parent.getPathEnd(b)?b:this.m_parent.getPathIndexFromPointIndex(a);this.m_nextPathIndex=b+1;this.m_currentPathIndex=b;this.m_currentSegmentIndex=-1;this.m_nextSegmentIndex=a-this.m_parent.getPathStart(b);this.m_segmentCount=
this.getSegmentCount(b);this.m_pathBegin=this.m_parent.getPathStart(this.m_currentPathIndex);this.m_bCurrentPathClosed=this.m_parent.isClosedPath(this.m_currentPathIndex)}hasNextSegment(){return this.m_nextSegmentIndex<this.m_segmentCount}hasPreviousSegment(){return 0<this.m_nextSegmentIndex}nextSegment(){this.m_currentSegmentIndex!==this.m_nextSegmentIndex&&this.updateSegment();this.m_bCirculator?this.m_nextSegmentIndex=(this.m_nextSegmentIndex+1)%this.m_segmentCount:(this.m_nextSegmentIndex===this.m_segmentCount&&
p.throwOutOfRangeException("Segment_iterator_impl::next_segment"),this.m_nextSegmentIndex++);return this.m_buffer.get()}previousSegment(){this.m_bCirculator?this.m_nextSegmentIndex=(this.m_segmentCount+this.m_nextSegmentIndex-1)%this.m_segmentCount:(0===this.m_nextSegmentIndex&&p.throwOutOfRangeException(""),this.m_nextSegmentIndex--);this.m_nextSegmentIndex!==this.m_currentSegmentIndex&&this.updateSegment();return this.m_buffer.get()}nextCurve(){if(!this.m_parent.hasNonLinearSegments())return this.resetToLastSegment(),
null;let a=0;for(;;){if(this.m_nextSegmentIndex===this.m_segmentCount||a===this.m_segmentCount)return null;const b=this.getPathBegin()+this.m_nextSegmentIndex;if(1===(this.m_segFlagStream.read(b)&31))this.m_bCirculator?this.m_nextSegmentIndex=(this.m_nextSegmentIndex+1)%this.m_segmentCount:this.m_nextSegmentIndex++,a++;else{this.updateSegment();break}}this.m_currentSegmentIndex!==this.m_nextSegmentIndex&&this.updateSegment();this.m_bCirculator?this.m_nextSegmentIndex=(this.m_nextSegmentIndex+1)%this.m_segmentCount:
(this.m_nextSegmentIndex===this.m_segmentCount&&p.throwOutOfRangeException(""),this.m_nextSegmentIndex++);return this.m_buffer.get()}getPathBegin(){return this.m_pathBegin}getPathIndex(){return this.m_currentPathIndex}getStartPointIndex(){return this.getPathBegin()+this.m_currentSegmentIndex}getEndPointIndex(){return this.isClosingSegment()?this.getPathBegin():this.getStartPointIndex()+1}updateSegment(){(0>this.m_nextSegmentIndex||this.m_nextSegmentIndex>=this.m_segmentCount||0>this.m_currentPathIndex)&&
p.throwOutOfRangeException("");this.m_currentSegmentIndex=this.m_nextSegmentIndex;this.m_parent.getSegmentFromPath(this.m_currentPathIndex,this.m_currentSegmentIndex,this.m_buffer,this.m_bStripAttributes)}isClosingSegment(){return this.m_bCurrentPathClosed&&this.m_currentSegmentIndex===this.m_segmentCount-1}isCurve(){return null!==this.m_segFlagStream?1!==(this.m_segFlagStream.read(this.m_currentSegmentIndex)&31):!1}isPathClosed(){return this.m_bCurrentPathClosed}setCirculator(a){this.m_bCirculator=
a}getImpl(){return this}}class Ah{constructor(a){this.m_quadTreeForPaths=this.m_quadTree=this.m_rasterizedGeometry=null;this.m_refCount=1;a&&a.copyTo(this)}assignCopy(a){p.geometryReleaseAssert(0);return this}getRasterizedGeometry(){return this.m_rasterizedGeometry}copyTo(a){a!==this&&(p.geometryReleaseAssert(a.uniqueUse()),a.m_quadTree=this.m_quadTree,a.m_quadTreeForPaths=this.m_quadTreeForPaths,a.m_rasterizedGeometry=this.m_rasterizedGeometry)}clone(){const a=new Ah;this.copyTo(a);return a}uniqueUse(){return 1===
this.m_refCount}addRef(){++this.m_refCount}release(){0===--this.m_refCount&&(this.m_quadTreeForPaths=this.m_quadTree=this.m_rasterizedGeometry=null)}setRasterizedGeometry(a){p.geometryReleaseAssert(this.uniqueUse())}setQuadTree(a){p.geometryReleaseAssert(this.uniqueUse());this.m_quadTree=a}setQuadTreeForPaths(a){p.geometryReleaseAssert(this.uniqueUse());this.m_quadTreeForPaths=a}getQuadTree(){return this.m_quadTree}getQuadTreeForPaths(){return this.m_quadTreeForPaths}}class am{updateCoefs(a){if(this.lastDeriv1===
a)this.curCoefs=this.derivCoefs1,this.lastUsed=1;else if(this.lastDeriv2===a)this.curCoefs=this.derivCoefs2,this.lastUsed=2;else{if(1===this.lastUsed){var b=this.derivCoefs2;this.lastDeriv2=a;this.lastUsed=2}else b=this.derivCoefs1,this.lastDeriv1=a,this.lastUsed=1;b.length=this.truePower-a+1;for(let c=0,d=this.truePower-a;c<=d;++c){b[c]=this.coefs[c+a].clone();let e=c+a,f=e--;for(let g=1;g<a;g++)f*=e--;b[c].mulThis(f)}this.curCoefs=b}}constructor(a,b,c,d){this.derivCoefs1=[];this.derivCoefs2=[];
this.lastUsed=this.lastDeriv2=this.lastDeriv1=-1;this.curCoefs=null;this.coefs=a;this.power=b;this.truePower=0;for(a=b;1<=a;a--)if(0!==this.coefs[a].value()){this.truePower=a;break}}getMaxDerivative(){return this.truePower+1}getValue(a,b){let c=this.coefs;0===a?c=this.coefs:(this.updateCoefs(a),c=this.curCoefs);const d=new l.KahanSummator(0);let e=1;for(let f=0,g=this.truePower-a;f<=g;++f)d.pe(e*c[f].value()),e*=b;return d.getResult()}getError(a){var b=Math.abs(a);const c=new l.KahanSummator(0);var d=
new l.ECoordinate(1),e=new l.ECoordinate(0);for(let f=0,g=this.power;f<=g;++f)e.addThisE(this.coefs[f].mulE(d)),c.pe(d.value()*this.coefs[f].eps()),d.mulThis(b);c.pe(e.eps());b=1;for(d=1;d<=this.truePower;++d){b*=d;this.updateCoefs(d);e=new l.ECoordinate(1);const f=new l.ECoordinate(0);for(let g=0,h=this.truePower-d;g<=h;++g)f.addThisE(this.curCoefs[g].mulE(e)),e.mulThis(a);if(!f.isZero())return Math.pow(b*c.getResult()/Math.abs(f.value()),1/d)}return 0}}class ei{constructor(a,b,c){this.coefs=l.makeObjectArray(l.ECoordinate,
3);this.coefs[0].setE(a);this.coefs[1].setE(b);this.coefs[2].setE(c)}calcF(a){a=new l.ECoordinate(a);return this.coefs[0].mulE(a).addE(this.coefs[1]).mulE(a).addE(this.coefs[2])}calcDF(a){a=new l.ECoordinate(a);return l.ECoordinate.st_mulByPower2(this.coefs[0],2).mulE(a).addE(this.coefs[1])}estimateError(a){var b=Math.abs(a);b=(this.coefs[0].eps()*b+this.coefs[1].eps())*b+this.coefs[2].eps()+this.calcF(a).eps();a=(new l.ECoordinate(2)).mulE(this.coefs[0]).mul(a).addE(this.coefs[1]);return a.isZero()?
(a=this.coefs[0].value(),Math.sqrt(b/Math.abs(a))):b/Math.abs(a.value())}}class rc extends we{constructor(a){void 0===a||l.isOnlyProperty(a,"vd")?(super({vd:a?.vd,XStart:0,YStart:0,XEnd:0,YEnd:0}),this.m_cp=new l.Point2D(0,0)):a.from?(super({XStart:a.from.x,YStart:a.from.y,XEnd:a.to.x,YEnd:a.to.y,...a.vd}),this.m_cp=a.cp.clone()):a.points?(super({XStart:a.points[0].x,YStart:a.points[0].y,XEnd:a.points[2].x,YEnd:a.points[2].y,...a.vd}),this.m_cp=a.points[1].clone()):a.copy?(super(a),this.m_cp=a.copy.m_cp.clone()):
(p.geometryReleaseAssert(0),super({XStart:0,YStart:0,XEnd:0,YEnd:0,...a.vd}),this.m_cp=new l.Point2D(0,0))}getBoundary(){return Qb(this)}assignMove(a){p.geometryReleaseAssert(0);return this}assignCopy(a){this!==a&&a.copyTo(this);return this}construct(a,b,c){this.setStartXY(a);this.m_cp.assign(b);this.setEndXY(c);He(this)}constructPoints(a){this.setStartXY(a[0]);this.m_cp.assign(a[1]);this.setEndXY(a[2]);He(this)}getGeometryType(){return p.GeometryType.enumBezier2}queryEnvelope(a){if(a instanceof D){if(a.setCoords(this.getStartXY()),
a.mergeNe(this.getEndXY()),!a.contains(this.m_cp)){var b=this.m_cachedValues;if(null!==b){var c=new l.Point2D;for(var d of b.specialPoints)this.queryCoord2D(d,c),a.mergeNe(c)}else{b=[];oi(this,b);d=new l.Point2D;for(c of b)this.queryCoord2D(c,d),a.mergeNe(d)}}}else p.geometryReleaseAssert(0)}applyTransformation(a){if(a instanceof l.Transformation2D){const b=l.makeObjectArray(l.Point2D,3);this.queryControlPoints(b);a.transformPoints2D(b,3,b);this.setStartXY(b[0]);this.m_cp.assign(b[1]);this.setEndXY(b[2]);
this.afterCompletedModification()}else p.geometryReleaseAssert(0)}createInstance(){return new rc({vd:this.m_description})}calculateLength2D(){return Ie(this,1,!1)}calculateLowerLength2D(){return l.Point2D.distance(this.getStartXY(),this.getEndXY())}calculateUpperLength2D(){return this.calculateUpperLength2D_()}calculateUpperLength2D_(){return l.Point2D.distance(this.getStartXY(),this.m_cp)+l.Point2D.distance(this.getEndXY(),this.m_cp)}queryCoord2D(a,b){this.queryCoord2DExtended(a,b,!1)}queryCoord2DExtended(a,
b,c){const d=l.makeObjectArray(l.Point2D,3);this.queryControlPoints(d);Pb(d,a,b,c)}queryCoord2DE(a,b){p.geometryReleaseAssert(0)}getCoordX(a){if(0>a||1<a){var b=new l.Point2D;this.queryCoord2DExtended(a,b,!0);return b.x}if(.5>=a){b=l.lerpLo(this.getStartX(),this.m_cp.x,a);var c=l.lerpLo(this.m_cp.x,this.getEndX(),a);return l.lerpLo(b,c,a)}b=l.lerpHi(this.getStartX(),this.m_cp.x,a);c=l.lerpHi(this.m_cp.x,this.getEndX(),a);return l.lerpHi(b,c,a)}getCoordY(a){if(0>a||1<a){var b=new l.Point2D;this.queryCoord2DExtended(a,
b,!0);return b.y}if(.5>=a){b=l.lerpLo(this.getStartX(),this.m_cp.x,a);var c=l.lerpLo(this.m_cp.x,this.getEndX(),a);return l.lerpLo(b,c,a)}b=l.lerpHi(this.getStartY(),this.m_cp.y,a);c=l.lerpHi(this.m_cp.y,this.getEndY(),a);return l.lerpHi(b,c,a)}cut(a,b,c){const d=new W;this.queryCut(a,b,d,c);return d.releaseSegment()}queryCut(a,b,c,d){c=c.createQuadraticBezier();this.cutBezierIgnoreAttributes(a,b,c);if(!d&&(c.assignVertexDescription(this.m_description),d=this.m_description.getAttributeCount(),1<d)){for(var e=
1;e<d;e++){var f=this.m_description.getSemantics(e),g=K.getComponentCount(f);for(var h=0;h<g;h++){const k=this.getAttributeAsDbl(a,f,h);c.setStartAttribute(f,h,k)}}for(a=1;a<d;a++)for(e=this.m_description.getSemantics(a),f=K.getComponentCount(e),g=0;g<f;g++)h=this.getAttributeAsDbl(b,e,g),c.setEndAttribute(e,g,h)}}queryDerivative(a,b){p.geometryReleaseAssert(0)}cutBezierIgnoreAttributes(a,b,c){(0>a||1<b||a>b)&&p.throwInvalidArgumentException("Quadratic_bezier.cut_bezier_ignore_attributes");if(0===
a&&1===b)c.setStartXY(this.getStartXY()),c.m_cp.assign(this.m_cp),c.setEndXY(this.getEndXY());else{var d=l.makeObjectArray(l.Point2D,3);this.queryControlPoints(d);Xd(d,a,b,d);c.constructPoints(d)}}splitBezierIgnoreAttributes(a,b,c){p.geometryReleaseAssert(0)}getAttributeAsDbl(a,b,c){p.geometryReleaseAssert(0);return 0}getClosestCoordinate(a,b){return Je(this,a,l.Envelope1D.unit(),b)}getClosestCoordinateOnInterval(a,b,c){return Je(this,a,b,!1)}getYMonotonicParts(a,b){p.geometryReleaseAssert(0);return 0}getMonotonicParts(a,
b){2>a.length&&p.throwInvalidArgumentException("");var c=ni(this);let d=0;if(2===c.specialPointsCount())return 0;p.geometryReleaseAssert(a.length>=c.specialPointsCount()-1);for(let e=1,f=c.specialPointsCount();e<f;++e)this.queryCut(c.specialPoints[e-1],c.specialPoints[e],a[d],b),d++;for(b=0;b<d;++b)c=a[b].get(),dg(c);return d}intersectionWithAxis2D(a,b,c,d){const e=l.makeObjectArray(l.ECoordinate,3),f=l.makeObjectArray(l.ECoordinate,2),g=new l.Envelope1D(0,1);let h=0;if(a){if(e[0]=(new l.ECoordinate(this.getStartY())).sub(b),
e[1]=(new l.ECoordinate(this.m_cp.y)).subE(new l.ECoordinate(this.getStartY())).mulThisByPower2(2),e[2]=(new l.ECoordinate(this.getStartY())).add(this.getEndY()).subE((new l.ECoordinate(this.m_cp.y)).mulThisByPower2(2)),h=tb(e[2],e[1],e[0],g,!1,f),c)for(a=0;a<h;a++)c[a]=this.getCoordX(f[a].value())}else if(e[0]=(new l.ECoordinate(this.getStartX())).sub(b),e[1]=(new l.ECoordinate(this.m_cp.x)).subE(new l.ECoordinate(this.getStartX())).mulThisByPower2(2),e[2]=(new l.ECoordinate(this.getStartX())).add(this.getEndX()).subE((new l.ECoordinate(this.m_cp.x)).mulThisByPower2(2)),
h=tb(e[2],e[1],e[0],g,!1,f),c)for(a=0;a<h;a++)c[a]=this.getCoordY(f[a].value());if(d)for(c=0;c<h;c++)d[c]=f[c].value();else c&&l.numericSortRange(c,h);return h}intersectionOfYMonotonicWithAxisX(a,b){if(this.m_YStart===this.m_YEnd)return a===this.m_YStart?b:Number.NaN;if(a===this.m_YStart)return this.m_XStart;if(a===this.m_YEnd)return this.m_XEnd;const c=[0,0];a=this.intersectionWithAxis2D(!0,a,c,null);p.geometryReleaseAssert(2!==a);return-1===a?b:c[0]}isCurve(){return!0}isLine(){return!1}isDegenerate(a){return Ce(this,
a)}isDegenerate3D(a,b){p.geometryReleaseAssert(0);return!1}queryLooseEnvelope(a){p.geometryReleaseAssert(0)}clone(a){a=this.createInstance();this.copyTo(a);return a}queryInterval(a,b){if(0===a){a=new D;this.queryEnvelope(a);const c=new l.Envelope1D;0===b?a.queryIntervalX(c):a.queryIntervalY(c);return c}return super.queryInterval(a,b)}queryLooseEnvelopeOnInterval(a,b){const c=l.makeObjectArray(l.Point2D,4);this.queryControlPoints(c);Xd(c,a.vmin,a.vmax,c);b.setFromPoints(c,4)}changeEndPoints2D(a,b){if(!a.isEqual(this.m_XStart,
this.m_YStart)||!b.isEqual(this.m_XEnd,this.m_YEnd)){var c=this.m_cp.isEqual(this.m_XStart,this.m_YStart),d=this.m_cp.isEqual(this.m_XEnd,this.m_YEnd);this.setStartXY(a);this.setEndXY(b);c?this.m_cp.setCoordsPoint2D(a):d&&this.m_cp.setCoordsPoint2D(b);this.normalizeAfterEndpointChange()}}tToLength(a){return Ie(this,a,!0)}lengthToT(a){var b=Ie(this,1,!1);0>=a||(a>=b?a=a-b+1:(a=new vn(this,a),b=[0],1!==qc(a,l.Envelope1D.unit(),1,b)&&p.throwInternalErrorException(""),a=b[0]));return a}calculateWeightedAreaCentroid2D(a){const b=
l.makeObjectArray(l.Point2D,3);im(this,b);var c=b[2];const d=b[1],e=new l.Point2D,f=c.y*d.x-c.x*d.y;e.x=-((4*c.x+5*d.x)*f)/60;e.y=-((4*c.y+5*d.y)*f)/60;c=ri(this);e.x+=(b[0].x-a.x)*c;e.y+=(b[0].y-a.y)*c;return e}calculateWeightedCentroid2D(){const a=new l.Point2D;if(this.isDegenerate(0))return a.setCoords(0,0),a;var b=l.Point2D.distance(this.getStartXY(),this.getEndXY()),c=this.calculateUpperLength2D();if(c-b<=8*Number.EPSILON*c)return a.assign(this.getCoord2D(.5).mul(this.calculateLength2D())),a;
b=a.assign;{var d=1;c=void 0;void 0===c&&(c=d,d=0);const m=new l.Point2D;if(0>d||1<c)m.setNAN(),c=m;else if(d>c&&p.throwInvalidArgumentException("calculate_sub_weighted_centroid"),d===c||this.isDegenerate(0))m.setCoords(0,0),c=m;else{var e=ni(this),f=jc(this),g=Math.min(f/this.calculateUpperLength2D(),1E-7),h=d,k=0;for(let n=1,q=e.specialPointsCount();n<q;n++)if(d<e.specialPoints[n]){k=n-1;break}m.setCoords(0,0);for(let n=k+1,q=e.specialPointsCount();n<q&&!(d=Math.min(e.specialPoints[n],c),h=em(this,
h,d,g,f),m.addThis(h),h=d,c<=e.specialPoints[n]);n++);c=m.add(this.getStartXY().mul(this.calculateLength2D()))}}b.call(a,c);return a}getControlPoint1(){return this.m_cp.clone()}setControlPoint1(a){this.m_cp.setCoordsPoint2D(a);this.afterCompletedModification()}queryControlPoints(a){a[0].assign(this.getStartXY());a[1].assign(this.m_cp);a[2].assign(this.getEndXY())}setControlPoints(a){p.geometryReleaseAssert(0)}getTangent(a){p.geometryReleaseAssert(0);return l.Point2D.getNAN()}getDerivative(a){p.geometryReleaseAssert(0);
return l.Point2D.getNAN()}getCurvature(a){p.geometryReleaseAssert(0);return 0}isIntersecting(a,b,c){p.geometryReleaseAssert(0);return!1}isIntersectingPoint(a,b,c){p.geometryReleaseAssert(0);return!1}isIntersectingPoint3D(a,b,c,d,e){p.geometryReleaseAssert(0);return!1}queryAttributeAsDbl(a,b,c,d){p.geometryReleaseAssert(0)}isMonotoneQuickAndDirty(){return!1}getMonotonicPartParams(a,b){p.geometryReleaseAssert(0);return 0}normalizeAfterEndpointChange(){return!1}orientBottomUp(){p.geometryReleaseAssert(0)}isDegenerateToLineHelper(a){a=
[a];if(!Tf(this,a))return!1;const b=this.getEndXY().sub(this.getStartXY()),c=b.length(),d=this.getControlPoint1();d.sub(this.getStartXY());return Math.abs(d.crossProduct(b))/c>a[0]?!1:!0}copyIgnoreAttributes(a){p.geometryReleaseAssert(0)}calculateArea2DHelper(){return ri(this)}absNorm(){return this.getStartXY().norm(1)+this.getEndXY().norm(1)+this.m_cp.norm(1)}queryEnvelopeW(a,b){const c=l.makeObjectArray(l.Point2D,3);this.queryControlPoints(c);Wd(c,a,b)}setSegmentFromCoords(a,b){p.geometryReleaseAssert(0)}snapControlPoints(a){p.geometryReleaseAssert(0);
return!1}writeInBufferStream(a,b){const c=new Float64Array(2);c[0]=this.m_cp.x;c[1]=this.m_cp.y;a.writeRangeFromArray(b,c.length,c,!0,1);return b+=c.length}readFromBufferStream(a,b){const c=new Float64Array(2);a.queryRange(b,c.length,c,!0,1);this.m_cp.x=c[0];this.m_cp.y=c[1];this.m_cachedValues=null}needsSnapControlPoints(a){p.geometryReleaseAssert(0);return!1}calculateSpecialPointsForCracking(a,b){p.geometryReleaseAssert(0);return 0}ensureXYMonotone(){p.geometryReleaseAssert(0);return!1}setCoordsForIntersector(a,
b,c){if(!a.isEqual(this.m_XStart,this.m_YStart)||!b.isEqual(this.m_XEnd,this.m_YEnd)){c=c?this.isMonotoneQuickAndDirty():!1;var d=new l.Transformation2D,e=l.makeObjectArray(l.Point2D,3);e[0].setCoords(this.m_XStart,this.m_YStart);e[2].setCoords(this.m_XEnd,this.m_YEnd);var f=new l.Point2D;f.setSub(e[2],e[0]);f.leftPerpendicularThis();e[1].setAdd(e[0],f);var g=l.makeObjectArray(l.Point2D,3);g[0].setCoordsPoint2D(a);g[2].setCoordsPoint2D(b);f.setSub(g[2],g[0]);f.leftPerpendicularThis();g[1].setAdd(g[0],
f);d.setFromTwoTriangles(e,g)?d.transformInPlace(this.m_cp):l.lerpPoint2D(a,b,.5,this.m_cp);this.changeEndPoints2D(a,b);c&&dg(this)}}copyToImpl(a){a.m_cp.setCoordsPoint2D(this.m_cp);a.m_cachedValues=this.m_cachedValues}reverseImpl(){}equalsImplTol(a,b){p.geometryReleaseAssert(0);return!1}equalsImpl(a){return this.m_cp.equals(a.m_cp)?!0:!1}getHashCodeImpl(){p.geometryReleaseAssert(0);return 0}swapImpl(a){p.geometryReleaseAssert(0)}afterCompletedModification(){He(this)}intersect(a,b,c,d,e){return Zc(!1,
this,a,b,c,d,e)}intersectPoint(a,b,c){{const f=new Va;var d=l.Envelope1D.unit(),e=f;const g=l.makeObjectArray(l.Point2D,3);this.queryControlPoints(g);Wd(g,d,e);f.inflate(c);f.isIntersectingPoint2D(a)?(d=new l.Point2D,e=Je(this,a,l.Envelope1D.unit(),!1),this.queryCoord2D(e,d),l.Point2D.distance(d,a)<=c?(b&&(b[0]=e),a=1):a=0):a=0}return a}intersect_(a,b,c,d){p.geometryReleaseAssert(0);return 0}endPointModified(){He(this)}clearEndPointModified(){p.geometryReleaseAssert(0)}}rc.type=p.GeometryType.enumBezier2;
class Hl{constructor(a){a.coefsT?(this.m_zeroCtor=a.zeroCtor,this.m_elements=a.coefsT.map(b=>b.clone()),p.geometryReleaseAssert(this.m_elements.length===a.power+1),this.updatePower()):a.coef0?(this.m_zeroCtor=a.zeroCtor,this.m_elements=[a.coef0.clone()]):a.copy?(this.m_zeroCtor=a.copy.m_zeroCtor,this.m_elements=a.copy.m_elements.map(b=>b.clone())):(this.m_zeroCtor=a.zeroCtor,this.m_elements=[new this.m_zeroCtor])}construct(a,b){this.m_elements=a.map(c=>c.clone());this.updatePower();return this}construct0(a){this.m_elements.length=
0;this.m_elements.push(a.clone());this.updatePower();return this}assignCopy(a){this.m_elements=a.m_elements.map(b=>b.clone());this.updatePower();return this}assignMove(a){this.m_elements=a.m_elements;a.m_elements=[];this.updatePower();return this}power(){return this.m_elements.length-1}addElement(a){this.m_elements.push(a.clone())}fmSubThis(a,b){p.geometryReleaseAssert(0);return this}addThis(a){var b=Math.min(this.power(),a.power());for(var c=0;c<=b;++c)this.m_elements[c].addThis(a.m_elements[c]);
c=a.power();this.m_elements.length=Math.max(this.power(),a.power())+1;for(b+=1;b<=c;++b)this.m_elements[b]=a.m_elements[b];this.updatePower();return this}add0(a){this.m_elements[0].addThis(a);this.updatePower();return this}addNumber0(a){p.geometryReleaseAssert(0);return this}sub(a){var b=Math.min(this.power(),a.power());for(var c=0;c<=b;++c)this.m_elements[c].subThis(a.m_elements[c]);c=a.power();this.m_elements.length=Math.max(this.power(),a.power())+1;for(b+=1;b<=c;++b)this.m_elements[b]=a.m_elements[b].clone(),
this.m_elements[b].negateThis();this.updatePower();return this}sub0(a){p.geometryReleaseAssert(0);return this}subNumber0(a){p.geometryReleaseAssert(0);return this}subShifted(a,b){var c=this.power();const d=a.power()+b;var e=Math.min(this.power(),d);let f=0;for(;b<=e;++b)this.m_elements[b].subThis(a.m_elements[f]),f++;if(d<=c)return this.updatePower(),this;this.m_elements.length=d+1;for(c+=1;c<this.m_elements.length;++c)this.m_elements[c]=new this.m_zeroCtor;for(e+=1;e<=d;++e)this.m_elements[e].subThis(a.m_elements[f++]);
this.updatePower();return this}subShiftedWithCoef(a,b,c){var d=this.power();const e=a.power()+c;var f=Math.min(this.power(),e);let g=0;for(;c<=f;++c)this.m_elements[c].fmSubThis(a.m_elements[g],b),g++;if(e<=d)return this.updatePower(),this;this.m_elements.length=e+1;for(d+=1;d<this.m_elements.length;++d)this.m_elements[d]=new this.m_zeroCtor;for(f+=1;f<=e;++f)this.m_elements[f].fmSubThis(a.m_elements[g++],b);this.updatePower();return this}mulThis(a){if(this.constructor===a.constructor){const b=[];
for(let c=0,d=this.power();c<=d;c++)for(let e=0,f=a.power();e<=f;e++){const g=this.m_elements[c].clone();g.mulThis(a.m_elements[e]);c+e<b.length?b[c+e].addThis(g):b.push(g)}this.m_elements=b}else for(let b=0,c=this.power();b<=c;b++)this.m_elements[b].mulThis(a);this.updatePower();return this}mulElementThis(a){for(let b=0,c=this.power();b<=c;b++)this.m_elements[b].mulThis(a);this.updatePower();return this}mulNumber0(a){p.geometryReleaseAssert(0);return this}mulBigint0(a){p.geometryReleaseAssert(0);
return this}mulBigIntThis(a){p.geometryReleaseAssert(0);return this}mulInt320(a){p.geometryReleaseAssert(0);return this}div0(a){p.geometryReleaseAssert(0);return this}absThis(){p.geometryReleaseAssert(0);return this}div(a,b,c){if(this.power()<a.power())c.assignCopy(this),b.setZero();else{c.setZero();b.setZero();var d=a.getElement(a.power()),e=this.clone(),f=e.power(),g=e.power()-a.power(),h=g;for(b.m_elements=l.makeObjectArray(b.m_zeroCtor,g+1);;){if(f<a.power()){c.assignMove(e);break}f===e.power()&&
(g=e.getElement(e.power()),g.divThis(d),e.subShiftedWithCoef(a,g,e.power()-a.power()),b.m_elements[h]=g.clone());h--;f--}c.updatePower();b.updatePower()}}divThis(a){p.geometryReleaseAssert(0);return this}subThis(a){var b=Math.min(this.power(),a.power());for(var c=0;c<=b;++c)this.m_elements[c].subThis(a.m_elements[c]);c=a.power();this.m_elements.length=Math.max(this.power(),a.power())+1;for(b+=1;b<=c;++b)this.m_elements[b]=a.m_elements[b].clone(),this.m_elements[b].negateThis();this.updatePower();
return this}sub0This(a){this.m_elements[0].subThis(a);this.updatePower();return this}subFrom(a,b){p.geometryReleaseAssert(0)}isZero(){return 0===this.power()&&this.m_elements[0].isZero()}negateThis(){for(let a=this.m_elements.length-1;0<=a;a--)this.m_elements[a].negateThis();return this}getElement(a){return this.m_elements[a].clone()}setElement(a,b){this.m_elements[a]=b.clone();return this}evaluate(a){var b=this.power();const c=this.m_elements[b].clone();for(--b;0<=b;--b)c.mulThis(a),c.addThis(this.m_elements[b]);
return c}equals(a){if(this===a)return!0;if(this.power()!==a.power())return!1;for(let b=this.m_elements.length-1;0<=b;b--)if(!this.m_elements[b].equals(a.m_elements[b]))return!1;return!0}updatePower(){for(let a=this.m_elements.length-1;0<a;a--)if(this.m_elements[a].isZero())this.m_elements.pop();else break;return this}setZero(){this.m_elements.length=1;this.m_elements[0]=new this.m_zeroCtor;this.updatePower();return this}derivative(a){if(this.power()<a)return this.clone().setZero();if(0===a)return this.clone();
const b=new this.constructor({coefsT:this.m_elements.slice(a),power:this.power()-a});for(let c=a,d=this.power();c<=d;c++){let e=BigInt(c);for(let f=c-1,g=c-a;f>g;--f)e*=BigInt(f);b.m_elements[c-a].mulBigIntThis(e)}b.updatePower();return b}derivative1This(){if(1<this.m_elements.length){this.m_elements=this.m_elements.slice(1);for(let a=1,b=this.power();a<=b;a++)this.m_elements[a].mulThis(l.MPValue.constructInt32(a+1))}else this.m_elements.length=0,this.m_elements.push(new this.m_zeroCtor);return this}limitPrecisionThis(a){for(var b=
this.power();0<=b;--b)this.m_elements[b].limitPrecisionThis(a);this.updatePower();return this}hiBitIndex(){return this.m_elements.reduce((a,b)=>{b=b.hiBitIndex();return a<b?b:a},0)}shiftRight(a){this.m_elements.splice(0,a);this.updatePower();return this}static evaluateCoefs(a,b,c){const d=a.power();c.construct0(a.getElement(0).evaluate(b));for(let e=1;e<=d;++e)c.addElement(a.getElement(e).evaluate(b));c.updatePower()}}class ja extends Hl{constructor(a){void 0===a?super({zeroCtor:l.MPValue}):super({...a,
zeroCtor:l.MPValue})}clone(){return new ja({copy:this})}absEvaluate(a){var b=this.power();const c=this.m_elements[b].clone();c.absThis();a=a.clone();a.absThis();for(--b;0<=b;--b)c.mulThis(a),c.addThis(this.m_elements[b].abs());return c}}class gb extends Hl{constructor(a){void 0===a?super({zeroCtor:ja}):super({...a,zeroCtor:ja})}clone(){return new gb({copy:this})}constructFromMPValues(a,b){this.m_elements.length=0;for(let c=0;c<=b;++c)this.m_elements.push(new ja({coef0:a[c]}));this.updatePower();return this}}
class ua{static constructPoint2D(a){return new ua(l.MPValue.constructDouble(a.x),l.MPValue.constructDouble(a.y))}constructor(a,b){void 0===a?(this.x=(new l.MPValue).setNAN(),this.y=(new l.MPValue).setNAN()):(this.x=a.clone(),this.y=b.clone())}assignPoint2D(a){this.x.setDouble(a.x);this.y.setDouble(a.y);return this}setCoords(a,b){this.x.setThis(a);this.y.setThis(b);return this}asPoint2D(){return new l.Point2D(this.x.value(),this.y.value())}crossProduct(a){return this.x.mul(a.y).sub(this.y.mul(a.x))}leftPerpendicularThis(){const a=
this.x.clone();this.x=this.y.clone().negate();this.y=a}clone(){return new ua(this.x,this.y)}dotProduct(a){return this.x.mul(a.x).add(this.y.mul(a.y))}add(a){return new ua(this.x.add(a.x),this.y.add(a.y))}sub(a){return new ua(this.x.sub(a.x),this.y.sub(a.y))}sqrLength(){return this.x.sqr().addThis(this.y.sqr())}mulThis(a){this.x.mulThis(a);this.y.mulThis(a);return this}mul(a){return this.clone().mulThis(a)}}class fm{constructor(){this.centroid_x=this.area=Number.NaN;this.centroid_y=0;this.specialPoints=
[];this.specialPointsLength=[]}specialPointsCount(){return this.specialPoints.length}}let vn=class{constructor(a,b){this.b=a;this.len=b}getMaxDerivative(){return 1}getValue(a,b){return 0===a?this.len-Ie(this.b,b,!1):0}getError(a){p.geometryReleaseAssert(0);return 0}};class Gb extends we{constructor(a){a&&a.cp?(super({start:a.cp[0],end:a.cp[3],vd:a.vd}),this.m_cp=l.makeObjectArray(l.Point2D,2),this.m_cp[0].assign(a.cp[1]),this.m_cp[1].assign(a.cp[2])):void 0===a||l.isOnlyProperty(a,"vd")?(super({vd:a?.vd,
XStart:0,YStart:0,XEnd:0,YEnd:0}),this.m_cp=l.makeObjectArray(l.Point2D,2),this.m_cp[0].setCoords(0,0),this.m_cp[1].setCoords(0,0)):a.from?(super({start:a.from,end:a.to,vd:a.vd}),this.m_cp=l.makeObjectArray(l.Point2D,2),this.m_cp[0].assign(a.cp1),this.m_cp[1].assign(a.cp2)):(super({XStart:0,YStart:0,XEnd:0,YEnd:0,vd:a.vd}),p.geometryReleaseAssert(0),this.m_cp=l.makeObjectArray(l.Point2D,2),this.m_cp[0].setCoords(0,0),this.m_cp[1].setCoords(0,0));this.m_cachedValues=0}getBoundary(){return Qb(this)}assignMove(a){p.geometryReleaseAssert(0);
return this}assignCopy(a){p.geometryReleaseAssert(0);return this}construct(a,b,c,d){this.m_XStart=a.x;this.m_YStart=a.y;this.m_XEnd=d.x;this.m_YEnd=d.y;this.m_cp[0].assign(b);this.m_cp[1].assign(c);this.afterCompletedModification()}constructPoints(a){this.m_XStart=a[0].x;this.m_YStart=a[0].y;this.m_XEnd=a[3].x;this.m_YEnd=a[3].y;this.m_cp[0].assign(a[1]);this.m_cp[1].assign(a[2]);this.afterCompletedModification()}constructFromQuadratic(a){const b=l.makeObjectArray(l.Point2D,4);b[0].assign(a[0]);b[3].assign(a[2]);
l.lerpPoint2D(a[0],a[1],2/3,b[1]);l.lerpPoint2D(a[1],a[2],1/3,b[2]);this.constructPoints(b)}constructFromQuadraticSegment(a){this.dropAllAttributes();this.assignVertexDescription(a.getDescription());this.m_XStart=a.getStartX();this.m_YStart=a.getStartY();this.m_XEnd=a.getEndX();this.m_YEnd=a.getEndY();l.lerpPoint(2,a.getStartXY(),a.getControlPoint1(),2/3,this.m_cp[0]);l.lerpPoint(2,a.getControlPoint1(),a.getEndXY(),1/3,this.m_cp[1]);this.afterCompletedModification();if(this!==a){a.isEmpty()&&p.throwEmptyGeometryException("");
var b=a.getDescription();b!==this.m_description&&this.mergeVertexDescription(b);for(let c=1,d=b.getAttributeCount();c<d;c++){const e=b.getSemantics(c),f=Mc.getComponentCount(e);for(let g=0;g<f;g++){let h=Xb(a,0,e,g);pc(this,0,e,g,h);h=Xb(a,1,e,g);pc(this,1,e,g,h)}}}}getGeometryType(){return p.GeometryType.enumBezier}queryEnvelope(a){if(a instanceof D){if(a.setCoords(this.getStartXY()),a.mergeNe(this.getEndXY()),!a.contains(this.m_cp[0])||!a.contains(this.m_cp[1])){var b=Pi(this);if(null!==b){var c=
new l.Point2D;for(var d of b.specialPoints)this.queryCoord2D(d,c),a.mergeNe(c)}else{b=l.makeObjectArray(l.ECoordinate,8);c=l.makeObjectArray(l.Point2D,4);this.queryControlPoints(c);c=Oi(c,b);d=new l.Point2D;for(let e=1;e<c-1;e++)this.queryCoord2D(b[e].value(),d),a.mergeNe(d)}}}else p.geometryReleaseAssert(0)}applyTransformation(a){if(a instanceof l.Transformation2D){const b=l.makeObjectArray(l.Point2D,4);this.queryControlPoints(b);a.transformPoints2D(b,4,b);this.setStartXY(b[0]);this.m_cp[0].assign(b[1]);
this.m_cp[1].assign(b[2]);this.setEndXY(b[3]);sg(this)}else p.geometryReleaseAssert(0)}createInstance(){return new Gb({vd:this.m_description})}calculateLength2D(){return de(this,1,!1)}calculateLowerLength2D(){return l.Point2D.distance(this.getStartXY(),this.getEndXY())}calculateUpperLength2D(){return l.Point2D.distance(this.getStartXY(),this.m_cp[0])+l.Point2D.distance(this.m_cp[0],this.m_cp[1])+l.Point2D.distance(this.getEndXY(),this.m_cp[1])}calculateUpperLength2D_(){p.geometryReleaseAssert(0);
return 0}queryCoord2D(a,b){return this.queryCoord2DExtends(a,b,!0)}queryCoord2DExtends(a,b,c){const d=l.makeObjectArray(l.Point2D,4);this.queryControlPoints(d);Ia(d,a,b,c)}queryCoord2DE(a,b){var c=l.makeObjectArray(l.Point2D,4);this.queryControlPoints(c);if(.5>=a.value()){var d=new S;l.lerpLoPointE(2,S.constructPoint2D(c[0]),S.constructPoint2D(c[1]),a,d);var e=new S;l.lerpLoPointE(2,S.constructPoint2D(c[1]),S.constructPoint2D(c[2]),a,e);var f=new S;l.lerpLoPointE(2,S.constructPoint2D(c[2]),S.constructPoint2D(c[3]),
a,f);c=new S;l.lerpLoPointE(2,d,e,a,c);d=new S;l.lerpLoPointE(2,e,f,a,d);l.lerpLoPointE(2,c,d,a,b)}else d=new S,l.lerpHiPointE(2,S.constructPoint2D(c[0]),S.constructPoint2D(c[1]),a,d),e=new S,l.lerpHiPointE(2,S.constructPoint2D(c[1]),S.constructPoint2D(c[2]),a,e),f=new S,l.lerpHiPointE(2,S.constructPoint2D(c[2]),S.constructPoint2D(c[3]),a,f),c=new S,l.lerpHiPointE(2,d,e,a,c),d=new S,l.lerpHiPointE(2,e,f,a,d),l.lerpHiPointE(2,c,d,a,b)}getCoordX(a){if(0>a||1<a){var b=new l.Point2D;this.queryCoord2DExtends(a,
b,!0);return b.x}var c=l.lerp(this.getStartX(),this.m_cp[0].x,a);b=l.lerp(this.m_cp[0].x,this.m_cp[1].x,a);const d=l.lerp(this.m_cp[1].x,this.getEndX(),a);c=l.lerp(c,b,a);b=l.lerp(b,d,a);return l.lerp(c,b,a)}getCoordY(a){if(0>a||1<a){var b=new l.Point2D;this.queryCoord2DExtends(a,b,!0);return b.y}var c=l.lerp(this.getStartY(),this.m_cp[0].y,a);b=l.lerp(this.m_cp[0].y,this.m_cp[1].y,a);const d=l.lerp(this.m_cp[1].y,this.getEndY(),a);c=l.lerp(c,b,a);b=l.lerp(b,d,a);return l.lerp(c,b,a)}cut(a,b,c){const d=
new W;this.queryCut(a,b,d,c);return d.releaseSegment()}queryCut(a,b,c,d){c=c.createCubicBezier();this.cutBezierIgnoreAttributes(a,b,c);if(!d&&(c.assignVertexDescription(this.m_description),d=this.m_description.getAttributeCount(),1<d)){for(var e=1;e<d;e++){var f=this.m_description.getSemantics(e),g=K.getComponentCount(f);for(var h=0;h<g;h++){const k=this.getAttributeAsDbl(a,f,h);c.setStartAttribute(f,h,k)}}for(a=1;a<d;a++)for(e=this.m_description.getSemantics(a),f=K.getComponentCount(e),g=0;g<f;g++)h=
this.getAttributeAsDbl(b,e,g),c.setEndAttribute(e,g,h)}}queryDerivative(a,b){const c=l.makeObjectArray(l.Point2D,4);this.queryControlPoints(c);Si(c,a,b)}cutBezierIgnoreAttributes(a,b,c){(0>a||1<b||a>b)&&p.throwInvalidArgumentException("Cubic_bezier.cut_bezier_ignore_attributes");const d=l.makeObjectArray(l.Point2D,4);this.queryControlPoints(d);const e=l.makeObjectArray(l.Point2D,4);Pc(d,a,b,e);c.setControlPoints(e)}splitBezierIgnoreAttributes(a,b,c){this===b&&this===c&&p.throwInvalidArgumentException("Cubic_bezier.split_bezier_ignore_attributes");
const d=l.makeObjectArray(l.Point2D,4);this.queryControlPoints(d);const e=l.makeObjectArray(l.Point2D,4),f=l.makeObjectArray(l.Point2D,4);ge(d,a,e,f);b&&b.setControlPoints(e);c&&c.setControlPoints(f)}getAttributeAsDbl(a,b,c){if(0===b)return 0===c?this.getCoordX(a):this.getCoordY(a);if(0===a)return this.getStartAttributeAsDbl(b,c);if(1===a)return this.getEndAttributeAsDbl(b,c);const d=this.getStartAttributeAsDbl(b,c);c=this.getEndAttributeAsDbl(b,c);var e=this.calculateLength2D();a=0<e?this.tToLength(a)/
e:0;e=K.getInterpolation(b);return l.interpolate(e,d,c,a,K.getDefaultValue(b))}getClosestCoordinate(a,b){const c=[Number.NaN];Ue(this,a,l.Envelope1D.unit(),b,-1,1,c);return c[0]}getClosestCoordinateOnInterval(a,b,c=-1){const d=[Number.NaN];return 0===Ue(this,a,b,!1,c,1,d)?Number.NaN:d[0]}getYMonotonicParts(a,b){p.geometryReleaseAssert(0);return 0}getMonotonicParts(a,b){2>a.length&&p.throwInvalidArgumentException("");var c=ee(this);if(2===c.specialPointsCount()&&this.isMonotoneQuickAndDirty())return 0;
let d=0;p.geometryReleaseAssert(a.length>=c.specialPointsCount()-1);for(let e=1,f=c.specialPointsCount();e<f;++e)this.queryCut(c.specialPoints[e-1],c.specialPoints[e],a[d],b),d++;for(b=0;b<d;++b)c=a[b].get(),fe(c);return d}intersectionWithAxis2D(a,b,c,d){const e=l.makeObjectArray(l.Point2D,4);this.queryControlPoints(e);const f=l.makeObjectArray(l.ECoordinate,4),g=l.makeObjectArray(l.ECoordinate,3),h=new l.Envelope1D(0,1);let k=0;if(a){if(Re(e,f,!1),k=Ge(f[3],f[2],f[1],f[0].sub(b),h,!1,g),c)for(a=
0;a<k;a++)b=new l.Point2D,Ia(e,g[a].value(),b),c[a]=b.x}else if(Qe(e,f,!1),k=Ge(f[3],f[2],f[1],f[0].sub(b),h,!1,g),c)for(a=0;a<k;a++)b=new l.Point2D,Ia(e,g[a].value(),b),c[a]=b.y;if(d)for(c=0;c<k;c++)d[c]=g[c].value();else c&&l.sortRange(c,0,k,l.standardNumericCompare);return k}intersectionOfYMonotonicWithAxisX(a,b){if(this.m_YStart===this.m_YEnd)return a===this.m_YStart?b:Number.NaN;if(a===this.m_YStart)return this.m_XStart;if(a===this.m_YEnd)return this.m_XEnd;const c=[0,0];a=this.intersectionWithAxis2D(!0,
a,c,null);p.geometryReleaseAssert(2!==a);return-1===a?b:c[0]}isCurve(){return!0}isDegenerate(a){return Ce(this,a)}isDegenerate3D(a,b){p.geometryReleaseAssert(0);return!1}queryLooseEnvelope(a){a instanceof D?(a.setCoords({pt:this.getStartXY()}),a.mergeNe(this.m_cp[0]),a.mergeNe(this.m_cp[1]),a.mergeNe(this.getEndXY())):p.geometryReleaseAssert(0)}clone(a){a=this.createInstance();this.copyTo(a);return a}queryInterval(a,b){if(0===a){a=D.constructEmpty();this.queryEnvelope(a);const c=l.Envelope1D.constructEmpty();
0===b?a.queryIntervalX(c):a.queryIntervalY(c);return c}return super.queryInterval(a,b)}queryLooseEnvelopeOnInterval(a,b){const c=l.makeObjectArray(l.Point2D,4);this.queryControlPoints(c);Pc(c,a.vmin,a.vmax,c);b.setFromPoints(c,4)}changeEndPoints2D(a,b){if(!a.isEqual(this.m_XStart,this.m_YStart)||!b.isEqual(this.m_XEnd,this.m_YEnd)){var c=this.m_cp[0].isEqual(this.m_XStart,this.m_YStart),d=this.m_cp[0].isEqual(this.m_XEnd,this.m_YEnd),e=this.m_cp[1].isEqual(this.m_XStart,this.m_YStart),f=this.m_cp[1].isEqual(this.m_XEnd,
this.m_YEnd);this.setStartXY(a);this.setEndXY(b);c?this.m_cp[0].setCoordsPoint2D(a):d&&this.m_cp[0].setCoordsPoint2D(b);f?this.m_cp[1].setCoordsPoint2D(b):e&&this.m_cp[1].setCoordsPoint2D(a);this.normalizeAfterEndpointChange()}}tToLength(a){return de(this,a,!0)}lengthToT(a){var b=de(this,1,!1);0>=a||(a>=b?a=a-b+1:(a=new wn(this,a),b=[0],1!==qc(a,l.Envelope1D.unit(),1,b)&&p.throwInternalErrorException(""),a=b[0]));return a}calculateWeightedAreaCentroid2D(a){const b=l.makeObjectArray(l.Point2D,4);qg(this,
b);var c=b[3];const d=b[2],e=b[1],f=new l.Point2D;f.x=(5*c.x*c.x*(7*d.y+16*e.y)+c.x*(-35*c.y*d.x+40*d.x*d.y-80*c.y*e.x+140*d.x*e.y+112*e.x*e.y)-2*(c.y*(20*d.x*d.x+70*d.x*e.x+56*e.x*e.x)-7*(4*d.x+5*e.x)*(-(d.y*e.x)+d.x*e.y)))/840;f.y=(-5*c.y*c.y*(7*d.x+16*e.x)+c.y*(5*c.x*(7*d.y+16*e.y)-4*(10*d.x*d.y+35*d.y*e.x+28*e.x*e.y))+2*(-7*(4*d.y+5*e.y)*(d.y*e.x-d.x*e.y)+c.x*(20*d.y*d.y+70*d.y*e.y+56*e.y*e.y)))/840;c=Ri(this);f.x+=(b[0].x-a.x)*c;f.y+=(b[0].y-a.y)*c;return f}calculateWeightedCentroid2D(){const a=
new l.Point2D;if(this.isDegenerate(0))return a.setCoords(0,0),a;var b=l.Point2D.distance(this.getStartXY(),this.getEndXY()),c=this.calculateUpperLength2D();if(c-b<=8*Number.EPSILON*c)return a.assign(this.getCoord2D(.5).mul(this.calculateLength2D())),a;b=a.assign;{var d=1;c=void 0;void 0===c&&(c=d,d=0);const m=new l.Point2D;if(0>d||1<c)m.setNAN(),c=m;else if(d>c&&p.throwInvalidArgumentException("calculate_sub_weightedCentroid"),d===c||this.isDegenerate(0))m.setCoords(0,0),c=m;else{var e=ee(this),f=
Ni(this),g=f/this.calculateUpperLength2D(),h=d,k=0;for(let n=1,q=e.specialPointsCount();n<q;n++)if(d<e.specialPoints[n]){k=n-1;break}m.setCoords(0,0);for(let n=k+1,q=e.specialPointsCount();n<q&&!(d=Math.min(e.specialPoints[n],c),h=um(this,h,d,g,f),m.addThis(h),h=d,c<=e.specialPoints[n]);n++);c=m.add(this.getStartXY().mul(this.calculateLength2D()))}}b.call(a,c);return a}getControlPoint1(){return this.m_cp[0].clone()}setControlPoint1(a){this.m_cp[0].setCoordsPoint2D(a);this.afterCompletedModification()}getControlPoint2(){return this.m_cp[1].clone()}setControlPoint2(a){this.m_cp[1].setCoordsPoint2D(a);
this.afterCompletedModification()}queryControlPoints(a){a[0].assign(this.getStartXY());a[1].assign(this.m_cp[0]);a[2].assign(this.m_cp[1]);a[3].assign(this.getEndXY())}setControlPoints(a){for(let b=0;4>b;b++)a[b].isNAN()&&p.throwInvalidArgumentException("NAN control points in bezier are not supported");this.m_XStart=a[0].x;this.m_YStart=a[0].y;this.m_cp[0].setCoordsPoint2D(a[1]);this.m_cp[1].setCoordsPoint2D(a[2]);this.m_XEnd=a[3].x;this.m_YEnd=a[3].y;this.afterCompletedModification()}getTangent(a){const b=
l.makeObjectArray(l.Point2D,4);this.queryControlPoints(b);return tg(b,a)}getDerivative(a){p.geometryReleaseAssert(0);return l.Point2D.getNAN()}getCurvature(a){const b=Qc(this,1,a);a=Qc(this,2,a);const c=b.sqrLength();if(0===c)return Number.NaN;b.divThis(Math.sqrt(c));return b.crossProduct(a)/c}isIntersectingPoint(a,b,c){if(c&&(a.equals(this.getStartXY())||a.equals(this.getEndXY())))return!1;c=new D;this.queryLooseEnvelope(c);c.inflateCoords(b,b);if(!c.contains(a))return!1;c=this.getClosestCoordinate(a,
!1);const d=new l.Point2D;this.queryCoord2D(c,d);return l.Point2D.distance(d,a)<=b}isIntersectingPoint3D(a,b,c,d,e){p.geometryReleaseAssert(0);return!1}queryAttributeAsDbl(a,b,c,d){p.geometryReleaseAssert(0)}isMonotoneQuickAndDirty(){var a=l.makeObjectArray(l.Point2D,4);this.queryControlPoints(a);a:{var b=l.compareNoNANs(a[0].y,a[1].y),c=l.compareNoNANs(a[1].y,a[2].y);const d=l.compareNoNANs(a[2].y,a[3].y);if(0<=b&&0<=c&&0<=d||0>=b&&0>=c&&0>=d)if(b=l.compareNoNANs(a[0].x,a[1].x),c=l.compareNoNANs(a[1].x,
a[2].x),a=l.compareNoNANs(a[2].x,a[3].x),0<=b&&0<=c&&0<=a||0>=b&&0>=c&&0>=a){a=!0;break a}a=!1}return a}getMonotonicPartParams(a,b){const c=ee(this),d=c.specialPointsCount();p.geometryReleaseAssert(ve.s_maxMonotonicPartParams>=d);if(!b)return c.specialPointsCount();a<d&&p.throwInvalidArgumentException("");for(a=0;a<d;a++)b[a]=c.specialPoints[a];return d}normalizeAfterEndpointChange(){return!1}orientBottomUp(){if(this.m_YEnd<this.m_YStart||this.m_YEnd===this.m_YStart&&this.m_XEnd<this.m_XStart){this.m_XEnd=
l.swap(this.m_XStart,this.m_XStart=this.m_XEnd);this.m_YEnd=l.swap(this.m_YStart,this.m_YStart=this.m_YEnd);for(let a=0,b=this.m_description.getTotalComponentCount()-2;a<b;a++)this.m_attributes[a+b]=l.swap(this.m_attributes[a],this.m_attributes[a]=this.m_attributes[a+b]);this.m_cp[1]=l.swap(this.m_cp[0],this.m_cp[0]=this.m_cp[1]);this.m_cachedValues=null}}findMinDeriv(){const a=new l.ECoordinate;Qi(this,a);return a.value()}queryConvexHull2D(a){p.geometryReleaseAssert(0);return 0}isLine(){return!1}isDegenerateToLineHelper(a){p.geometryReleaseAssert(0);
return!1}copyIgnoreAttributes(a){const b=l.makeObjectArray(l.Point2D,4);this.queryControlPoints(b);a.setControlPoints(b)}calculateArea2DHelper(){return Ri(this)}absNorm(){return this.getStartXY().norm(1)+this.getEndXY().norm(1)+this.m_cp[0].norm(1)+this.m_cp[1].norm(1)}queryEnvelopeW(a,b){const c=l.makeObjectArray(l.Point2D,4);this.queryControlPoints(c);qd(c,a,b)}setSegmentFromCoords(a,b){sm(this,a,b)}writeInBufferStream(a,b){const c=new Float64Array(4);this.writeInBuffer_(c);a.writeRangeFromArray(b,
c.length,c,!0,1);return b+=c.length}writeInBuffer_(a){a[0]=this.m_cp[0].x;a[1]=this.m_cp[0].y;a[2]=this.m_cp[1].x;a[3]=this.m_cp[1].y;return 4}readFromBufferStream(a,b){const c=new Float64Array(4);a.queryRange(b,c.length,c,!0,1);this.readFromBuffer_(c)}readFromBuffer_(a){this.m_cp=l.makeObjectArray(l.Point2D,2);this.m_cp[0].x=a[0];this.m_cp[0].y=a[1];this.m_cp[1].x=a[2];this.m_cp[1].y=a[3];this.m_cachedValues=null}snapControlPoints(a){const b=l.makeObjectArray(l.Point2D,4);this.queryControlPoints(b);
var c=(e,f,g)=>{let h=!1;l.Point2D.sqrDistance(e,g)<=a&&(h=!e.equals(g),e.setCoordsPoint2D(g),l.Point2D.sqrDistance(f,g)<=a&&(h||=!f.equals(g),f.setCoordsPoint2D(g)));return h};const d=c(b[1],b[2],b[0]);c=c(b[2],b[1],b[3]);(d||c)&&this.setControlPoints(b);return d||c}needsSnapControlPoints(a){if(!a)return!1;var b=l.makeObjectArray(l.Point2D,4);this.queryControlPoints(b);const c=(e,f,g)=>{let h=!1;l.Point2D.sqrDistance(e,g)<=a&&(h=!e.equals(g),e.setCoordsPoint2D(g),l.Point2D.sqrDistance(f,g)<=a&&(h||=
!f.equals(g),f.setCoordsPoint2D(g)));return h},d=c(b[1],b[2],b[0]);b=c(b[2],b[1],b[3]);return d||b}calculateSpecialPointsForCracking(a,b){a:{b.length=0;var c=new l.ECoordinate;Qi(this,c);var d=new S,e=c,f=d,g=l.makeObjectArray(l.Point2D,4);this.queryControlPoints(g);Si(g,e,f);if(d.isZero())c.isZero()||c.eq(new l.ECoordinate(1))?b=0:(b.push(c.value()),b=1);else{e=l.makeObjectArray(l.ECoordinate,4);f=l.makeObjectArray(l.Point2D,4);this.queryControlPoints(f);Qe(f,e,!0);f=l.makeObjectArray(l.ECoordinate,
4);c=l.makeObjectArray(l.Point2D,4);this.queryControlPoints(c);Re(c,f,!0);c=l.makeObjectArray(l.ECoordinate,6);d=e[3].negate().mulE(f[1]).addE(e[2].mulE(f[2]).mul(2)).addE(e[1].mulE(f[3]));g=e[3].negate().mulE(f[1]).subE(e[2].mulE(f[2]).mul(2)).addE(e[1].mulE(f[3]));var h=e[2].mulE(e[2]).subE(f[2].mulE(f[2]));c[0]=f[1].mulE(f[1]).mulE(d).addE(e[1].mulE(e[1]).mulE(g)).addE(e[1].mulE(f[1]).mulE(h).mul(2)).mul(6);c[1]=e[2].mulE(f[1]).subE(e[1].mulE(f[2])).mulE(e[2].mulE(e[2]).addE(e[1].mulE(e[3]).mul(2)).addE(f[2].mulE(f[2])).addE(f[1].mulE(f[3]).mul(2))).mul(24);
d=e[1].mulE(f[2]).mulE(f[2]).mulE(f[3]);d=e[2].mulE(e[2]).mulE(e[3]).mulE(f[1]).subE(d).mul(156);g=e[3].mulE(f[1]).subE(e[1].mulE(f[3]));h=e[3].mulE(f[1]).subE(e[1].mulE(f[3]));g=e[1].mulE(e[3]).mulE(h).addE(f[1].mulE(f[3]).mulE(g)).mul(72);h=f[1].mulE(f[3]).subE(e[1].mulE(e[3]));h=e[2].mulE(f[2]).mulE(h).mul(120);var k=e[1].mulE(e[2]).mulE(e[2]).mulE(f[3]);k=e[3].mulE(f[1]).mulE(f[2]).mulE(f[2]).subE(k).mul(36);c[2]=d.addE(g).addE(h).addE(k);d=e[2].mulE(e[3]).mulE(e[3]).mulE(f[1]).subE(e[1].mulE(f[2]).mulE(f[3]).mulE(f[3])).mul(360);
g=e[2].mulE(f[2]).mulE(e[2].mulE(e[3]).subE(f[2].mulE(f[3]))).addE(e[3].mulE(f[2]).mulE(f[2]).mulE(f[2])).subE(e[2].mulE(e[2]).mulE(e[2]).mulE(f[3])).mul(24);h=e[2].mulE(f[1]).mulE(f[3]).mulE(f[3]).subE(e[1].mulE(e[3]).mulE(e[3]).mulE(f[2])).mul(72);k=e[3].mulE(f[3]).mulE(f[1].mulE(f[2]).subE(e[1].mulE(e[2]))).mul(288);c[3]=d.addE(g).addE(h).addE(k);c[4]=f[3].mulE(f[3]).addE(e[3].mulE(e[3])).mulE(e[3].mulE(f[1]).subE(e[1].mulE(f[3]))).mul(270).addE(e[3].mulE(f[2]).subE(e[2].mulE(f[3]))).mulE(e[2].mulE(e[3]).addE(f[2].mulE(f[3]))).mul(180);
c[5]=e[3].mulE(f[2]).subE(e[2].mulE(f[3])).mulE(e[3].mulE(e[3]).addE(f[3].mulE(f[3]))).mul(216);e=l.makeObjectArray(l.ECoordinate,5);c=fi(c,5,new l.Envelope1D(0,1),!1,e,5);if(0<c){d=Math.abs(this.getCurvature(0));f=0;g=Math.abs(this.getCurvature(1));if(g>d||!Number.isFinite(g))f=1;for(g=0;g<c;g++)if(h=Math.abs(this.getCurvature(e[g].value())),this.getCoord2D(e[g].value()),h>d||!Number.isFinite(h))d=h,f=e[g].value();if((!Number.isFinite(d)||1/d<a)&&!l.isOneOf(f,0,1)&&(a=this.getCoord2D(f),!a.equals(this.getStartXY())&&
!a.equals(this.getEndXY()))){b.push(f);b=1;break a}}b=0}}return b}ensureXYMonotone(){return fe(this)}setCoordsForIntersector(a,b,c){if(!a.isEqual(this.m_XStart,this.m_YStart)||!b.isEqual(this.m_XEnd,this.m_YEnd)){c=c?this.isMonotoneQuickAndDirty():!1;var d=new l.Transformation2D,e=l.makeObjectArray(l.Point2D,3);e[0].setCoords(this.m_XStart,this.m_YStart);e[2].setCoords(this.m_XEnd,this.m_YEnd);var f=new l.Point2D;f.setSub(e[2],e[0]);f.leftPerpendicularThis();e[1].setAdd(e[0],f);var g=l.makeObjectArray(l.Point2D,
3);g[0].setCoordsPoint2D(a);g[2].setCoordsPoint2D(b);f.setSub(g[2],g[0]);f.leftPerpendicularThis();g[1].setAdd(g[0],f);d.setFromTwoTriangles(e,g)?d.transformPoints2D(this.m_cp,2,this.m_cp):(l.lerpPoint2D(a,b,1/3,this.m_cp[0]),l.lerpPoint2D(a,b,2/3,this.m_cp[1]));this.changeEndPoints2D(a,b);c&&fe(this)}}copyToImpl(a){a.m_cp[0].assign(this.m_cp[0]);a.m_cp[1].assign(this.m_cp[1]);var b=Pi(this);a.m_cachedValues=b}reverseImpl(){this.m_cp[1]=l.swap(this.m_cp[0],this.m_cp[0]=this.m_cp[1])}equalsImpl(a){return this.m_cp[0].equals(a.m_cp[0])&&
this.m_cp[1].equals(a.m_cp[1])?!0:!1}equalsImplTol(a,b){return this.m_cp[0].isEqualPoint2D(a.m_cp[0],b)&&this.m_cp[1].isEqualPoint2D(a.m_cp[1],b)?!0:!1}getHashCodeImpl(){p.geometryReleaseAssert(0);return 0}swapImpl(a){p.geometryReleaseAssert(0)}afterCompletedModification(){sg(this)}isIntersecting(a,b,c){return 0!==Hc(!1,!1,this,a,b,c)}intersect(a,b,c,d,e){return Zc(!1,this,a,b,c,d,e)}intersectPoint(a,b,c){var d=new Va,e=l.Envelope1D.unit(),f=d,g=l.makeObjectArray(l.Point2D,4);this.queryControlPoints(g);
qd(g,e,f);d.inflate(c);if(d.isIntersectingPoint2D(a)){f=ee(this);e=0;var h=f.specialPoints[0];d=[];for(let t=1,u=f.specialPoints.length;t<u;++t){g=f.specialPoints[t];var k=a,m=g;const v=Array(18);var n=l.makeObjectArray(l.Point2D,4);this.queryControlPoints(n);n=new Xi(n,k);var q=l.Envelope1D.construct(h,m);n=qc(n,q,18,v);q=new l.Point2D;this.queryCoord2D(h,q);let w=h,x=l.Point2D.distance(q,k);const y=new l.Point2D;this.queryCoord2D(m,y);var r=l.Point2D.distance(y,k);r<x&&(x=r,w=m,q.assign(y));for(r=
0;r<n;r++){this.queryCoord2D(v[r],y);const z=l.Point2D.distance(y,k);z<x&&(x=z,w=v[r],q.assign(y))}k={tmin:h,tmax:m,t:w,d:x,pt:q.clone()};0===d.length?d.push(k):k.t===k.tmin?(p.geometryReleaseAssert(d.at(-1).d<=k.d),d.at(-1).tmax=k.tmax):d.at(-1).t===d.at(-1).tmax?(p.geometryReleaseAssert(d.at(-1).d>=k.d),h=d.at(-1).tmin,d[d.length-1]=k,d.at(-1).tmin=h):d.push(k);h=g}for(const t of d)t.d<=c&&(a=t.t,b&&(e>=b.length&&p.throwOutOfRangeException(""),b[e]=a),e++);b=e}else b=0;return b}intersect_(a,b,c,
d){p.geometryReleaseAssert(0);return 0}endPointModified(){sg(this)}clearEndPointModified(){p.geometryReleaseAssert(0)}}Gb.type=p.GeometryType.enumBezier;const wi=[[.33998104358485626,.6521451548625461],[.8611363115940526,.34785484513745385]],xi=[[.1834346424956498,.362683783378362],[.525532409916329,.31370664587788727],[.7966664774136267,.22238103445337448],[.9602898564975363,.10122853629037626]],yi=[[.09501250983763744,.1894506104550685],[.2816035507792589,.18260341504492358],[.45801677765722737,
.16915651939500254],[.6178762444026438,.14959598881657674],[.755404408355003,.12462897125553388],[.8656312023878318,.09515851168249279],[.9445750230732326,.062253523938647894],[.9894009349916499,.027152459411754096]],zi=[[.04830766568773832,.0965400885147278],[.1444719615827965,.09563872007927486],[.23928736225213706,.09384439908080457],[.33186860228212767,.09117387869576389],[.42135127613063533,.08765209300440381],[.5068999089322294,.08331192422694675],[.5877157572407623,.07819389578707031],[.6630442669302152,
.0723457941088485],[.7321821187402897,.06582222277636185],[.7944837959679424,.058684093478535544],[.84936761373257,.050998059262376175],[.8963211557660521,.04283589802222668],[.9349060759377397,.03427386291302143],[.9647622555875064,.02539206530926206],[.9856115115452684,.01627439473090567],[.9972638618494816,.007018610009470096]],Ai=[[.024350292663424433,.048690957009139724],[.07299312178779904,.04857546744150343],[.12146281929612056,.048344762234802954],[.16964442042399283,.04799938859645831],[.21742364374000708,
.04754016571483031],[.2646871622087674,.04696818281621002],[.31132287199021097,.046284796581314416],[.3572201583376681,.04549162792741814],[.4022701579639916,.044590558163756566],[.4463660172534641,.04358372452932345],[.48940314570705296,.04247351512365359],[.5312794640198946,.04126256324262353],[.571895646202634,.03995374113272034],[.6111553551723933,.038550153178615626],[.6489654712546573,.03705512854024005],[.6852363130542333,.035472213256882386],[.7198818501716109,.033805161837141606],[.7528199072605319,
.03205792835485155],[.7839723589433414,.030234657072402478],[.8132653151227975,.028339672614259483],[.8406292962525803,.02637746971505466],[.8659993981540928,.024352702568710874],[.8893154459951141,.022270173808383253],[.9105221370785028,.02013482315353021],[.9295691721319396,.017951715775697343],[.9464113748584028,.015726030476024718],[.9610087996520538,.013463047896718643],[.973326827789911,.011168139460131128],[.983336253884626,.008846759826363947],[.9910133714767443,.006504457968978363],[.9963401167719553,
.004147033260562468],[.9993050417357722,.001783280721696433]],Bi=[[.012223698960615764,.024446180196262518],[.03666379096873349,.024431569097850044],[.06108196960413957,.02440235563384958],[.08546364050451549,.024358557264690626],[.10979423112764375,.024300200167971867],[.13405919946118777,.02422731922281525],[.15824404271422493,.024139957989019287],[.18233430598533718,.024038168681024052],[.2063155909020792,.023922012136703457],[.23017356422666,.023791557781003402],[.2538939664226943,.023646883584447616],
[.2774626201779044,.02348807601653591],[.3008654388776772,.02331522999406276],[.32408843502441337,.023128448824387027],[.3471177285976355,.022927844143686846],[.369939555349859,.02271353585023646],[.39254027503326744,.022485652032744968],[.414906379552275,.022244328893799764],[.43702450103710416,.02198971066846049],[.4588814198335522,.021721949538052076],[.48046407240417205,.02144120553920846],[.5017595591361445,.02114764646822135],[.5227551520511755,.02084144778075115],[.5434383024128103,.02052279248696007],
[.5637966482266181,.020191871042130043],[.5838180216287631,.01984888123283086],[.6034904561585486,.019494028058706602],[.6228021939105849,.019127523609950944],[.6417416925623075,.01874958694054471],[.660297632272646,.01836044393733134],[.6784589224477192,.017960327185008687],[.6962147083695144,.017549475827117706],[.7135543776835874,.01712813542311138],[.7304675667419088,.016696557801589205],[.746944166797062,.016255000909785187],[.7629743300440948,.015803728659399347],[.7785484755064119,.015343010768865144],
[.7936572947621933,.014873122602147314],[.8082917575079137,.014394345004166847],[.8224431169556439,.013906964132951985],[.8361029150609068,.013411271288616333],[.8492629875779689,.012907562739267348],[.8619154689395485,.012396139543950923],[.8740527969580318,.01187730737274028],[.8856677173453972,.011351376324080417],[.8967532880491582,.010818660739503076],[.9073028834017568,.010279479015832158],[.9173101980809605,.009734153415006806],[.9267692508789478,.009183009871660874],[.9356743882779164,.00862637779861675],
[.9440202878302202,.008064589890486059],[.9518019613412644,.0074979819256347285],[.9590147578536999,.006926892566898814],[.9656543664319652,.006351663161707189],[.9717168187471366,.005772637542865698],[.9771984914639074,.00519016183267633],[.9820961084357185,.004604584256702955],[.9864067427245862,.004016254983738642],[.9901278184917344,.0034255260409102157],[.9932571129002129,.0028327514714579912],[.9957927585349812,.0022382884309626186],[.997733248625514,.0016425030186690294],[.9990774599773758,
.0010458126793403489],[.9998248879471319,4.4938096029209035E-4]];class km{constructor(){this.centroidX=this.area=this.length=Number.NaN;this.centroidY=0;this.specialPoints=[];this.specialPointsLength=[]}specialPointsCount(){return this.specialPoints.length}}let xn=class{constructor(a,b,c){this.controlPoints=l.cloneObjectArray(a,3);this.weights=[0,0,0];l.memcpy(this.weights,b,0,0,3);this.point=c.clone()}getMaxDerivative(){return 3}getValue(a,b){if(0===a){a=new l.Point2D;Na(this.controlPoints,this.weights,
b,a);var c=l.makeObjectArray(l.Point2D,4);kd(this.controlPoints,this.weights,1,b,c);return 2*a.sub(this.point).dotProduct(c[1])}return 1===a?(a=new l.Point2D,Na(this.controlPoints,this.weights,b,a),c=l.makeObjectArray(l.Point2D,4),kd(this.controlPoints,this.weights,2,b,c),2*(a.sub(this.point).dotProduct(c[2])+c[1].dotProduct(c[1]))):2===a?(a=new l.Point2D,Na(this.controlPoints,this.weights,b,a),c=l.makeObjectArray(l.Point2D,4),kd(this.controlPoints,this.weights,3,b,c),2*(a.sub(this.point).dotProduct(c[3])+
3*c[1].dotProduct(c[2]))):0}getError(a){p.geometryReleaseAssert(0);return 0}};class yn{constructor(a,b){this.len=0;this.b=a;this.len=b}getMaxDerivative(){return 1}getValue(a,b){return 0===a?this.len-$d(this.b,b,!1):0}getError(a){p.geometryReleaseAssert(0);return 0}}class lb extends we{constructor(a){void 0===a||l.isOnlyProperty(a,"vd")?(super({vd:a?.vd,XStart:0,YStart:0,XEnd:0,YEnd:0}),this.m_cp=new l.Point2D(0,0),this.m_weights=[1,0,1]):(a.fromPoint&&a.weight?a={fromPoint:a.fromPoint,controlPoint1:a.controlPoint1,
toPoint:a.toPoint,weight0:1,weight1:a.weight,weight2:1}:a.points&&a.weight?a={fromPoint:a.points[0],controlPoint1:a.points[1],toPoint:a.points[2],weight0:1,weight1:a.weight,weight2:1}:a.points&&a.weights&&(a={fromPoint:a.points[0],controlPoint1:a.points[1],toPoint:a.points[2],weight0:a.weights[0],weight1:a.weights[1],weight2:a.weights[2]}),a.fromPoint&&a.weight0?(super({start:a.fromPoint,end:a.toPoint}),(0>=a.weight0||0>a.weight1||0>=a.weight2)&&p.throwInvalidArgumentException("weights"),this.m_cp=
a.controlPoint1.clone(),this.m_weights=[a.weight0,a.weight1,a.weight2]):a.copy?(super(a),this.m_cp=a.copy.m_cp.clone(),this.m_weights=a.copy.m_weights.slice()):a.move?(super(a),this.m_cp=a.move.m_cp.clone(),this.m_weights=a.move.m_weights.slice()):p.geometryReleaseAssert(0))}getBoundary(){return Qb(this)}assignMove(a){return this}assignCopy(a){a.copyTo(this);return this}construct(a,b,c,d){this.dropAllAttributes();this.setCpsAndWeights(a,b,c,1,d,1);Me(this)}constructWeights(a,b,c,d,e,f){}constructArray(a,
b){this.construct(a[0],a[1],a[2],b)}constructArrayWeights(a,b){this.dropAllAttributes();this.setCpsAndWeightsArray(a,b);Me(this)}convertToStandardForm(){}getStandardFormWeight(){return this.m_weights[1]/Math.sqrt(this.m_weights[0]*this.m_weights[2])}getGeometryType(){return p.GeometryType.enumRationalBezier2}queryEnvelope(a){if(a instanceof D&&(a.setCoords(this.getStartXY()),a.mergeNe(this.getEndXY()),!a.contains(this.m_cp))){var b=this.m_cachedValues;if(null!==b){var c=new l.Point2D;for(var d of b.specialPoints)this.queryCoord2D(d,
c),a.mergeNe(c)}else{b=[];d=l.makeObjectArray(l.Point2D,3);this.queryControlPoints(d);Ei(d,this.m_weights,b);d=new l.Point2D;for(c of b)this.queryCoord2D(c,d),a.mergeNe(d)}}}applyTransformation(a){if(a instanceof l.Transformation2D){const b=l.makeObjectArray(l.Point2D,3);this.queryControlPoints(b);a.transformPoints2D(b,3,b);this.setStartXY(b[0]);this.m_cp.assign(b[1]);this.setEndXY(b[2]);this.afterCompletedModification()}}createInstance(){return new lb({vd:this.m_description})}calculateLength2D(){return $d(this,
1,!1)}calculateLowerLength2D(){return l.Point2D.distance(this.getStartXY(),this.getEndXY())}calculateUpperLength2D(){return this.calculateUpperLength2D_()}calculateUpperLength2D_(){return 0<this.m_weights[1]?l.Point2D.distance(this.getStartXY(),this.m_cp)+l.Point2D.distance(this.getEndXY(),this.m_cp):l.Point2D.distance(this.getStartXY(),this.getEndXY())}queryCoord2D(a,b){return this.queryCoord2DExtension(a,b,!0)}queryCoord2DE(a,b){var c=l.makeObjectArray(l.Point2D,3);this.queryControlPoints(c);var d=
[0,0,0];this.queryWeights(d);c=[S.constructPoint2D(c[0]),S.constructPoint2D(c[1]),S.constructPoint2D(c[2])];d=[new l.ECoordinate(d[0]),new l.ECoordinate(d[1]),new l.ECoordinate(d[2])];if(0===a.value())b.setE(c[0]);else if(1===a.value())b.setE(c[2]);else{var e=[c[0].x.mulE(d[0]),c[1].x.mulE(d[1]),c[2].x.mulE(d[2])],f=[c[0].y.mulE(d[0]),c[1].y.mulE(d[1]),c[2].y.mulE(d[2])],g=[d[0].clone(),d[1].clone(),d[2].clone()];d=new l.ECoordinate;var h=new l.ECoordinate,k=new l.ECoordinate;if(.5>=a.value()){var m=
l.lerpLoE(e[0],e[1],a);e=l.lerpLoE(e[1],e[2],a);d.setE(l.lerpLoE(m,e,a));e=l.lerpLoE(f[0],f[1],a);f=l.lerpLoE(f[1],f[2],a);h.setE(l.lerpLoE(e,f,a));f=l.lerpLoE(g[0],g[1],a);g=l.lerpLoE(g[1],g[2],a);k.setE(l.lerpLoE(f,g,a))}else m=l.lerpHiE(e[0],e[1],a),e=l.lerpHiE(e[1],e[2],a),d.setE(l.lerpHiE(m,e,a)),e=l.lerpHiE(f[0],f[1],a),f=l.lerpHiE(f[1],f[2],a),h.setE(l.lerpHiE(e,f,a)),f=l.lerpHiE(g[0],g[1],a),g=l.lerpHiE(g[1],g[2],a),k.setE(l.lerpHiE(f,g,a));d.divThisE(k);h.divThisE(k);a=new l.Point2D(d.value(),
h.value());c=[c[0].value(),c[1].value(),c[2].value()];og(c,a);b.x.set(a.x,d.eps());b.y.set(a.y,h.eps())}}queryCoord2DExtension(a,b,c){if(c){if(0>a){c=new Z({start:this.getStartXY(),end:this.getStartXY().add(this.getTangent(0).getUnitVector())});sb(c,a,b);return}if(1<a){c=new Z({start:this.getEndXY(),end:this.getEndXY().add(this.getTangent(1).getUnitVector())});sb(c,a-1,b);return}}c=l.makeObjectArray(l.Point2D,3);this.queryControlPoints(c);Na(c,this.m_weights,a,b)}getCoordX(a){const b=new l.Point2D;
this.queryCoord2DExtension(a,b,!0);return b.x}getCoordY(a){const b=new l.Point2D;this.queryCoord2DExtension(a,b,!0);return b.y}cut(a,b,c){const d=new W;this.queryCut(a,b,d,c);return d.releaseSegment()}queryCut(a,b,c,d){c=c.createQuadraticRationalBezier();this.cutBezierIgnoreAttributes(a,b,c);if(!d&&(c.assignVertexDescription(this.m_description),d=this.m_description.getAttributeCount(),1<d)){for(var e=1;e<d;e++){var f=this.m_description.getSemantics(e),g=K.getComponentCount(f);for(var h=0;h<g;h++){const k=
this.getAttributeAsDbl(a,f,h);c.setStartAttribute(f,h,k)}}for(a=1;a<d;a++)for(e=this.m_description.getSemantics(a),f=K.getComponentCount(e),g=0;g<f;g++)h=this.getAttributeAsDbl(b,e,g),c.setEndAttribute(e,g,h)}}queryDerivative(a,b){var c=l.makeObjectArray(l.Point2D,3);this.queryControlPoints(c);var d=Array(3);this.queryWeights(d);0>a.value()&&a.set(0,a.eps());1<a.value()&&a.set(1,a.eps());const e=l.makeObjectArray(S,4);c=[S.constructPoint2D(c[0]),S.constructPoint2D(c[1]),S.constructPoint2D(c[2])];
c[2].subThisE(c[0]);c[1].subThisE(c[0]);c[0].setCoords(0,0);d=[new l.ECoordinate(d[0]),new l.ECoordinate(d[1]),new l.ECoordinate(d[2])];p.geometryReleaseAssert(!0);var f=[c[0].clone(),c[1].clone(),c[2].clone()];if(!f[0].isZero()){for(var g=1;3>g;++g)f[g].subThisE(f[0]);f[0]=S.constructCoords(0,0)}f=Gi(f,d,0,a);if(.5>=a.toDouble()){g=l.lerpLoE(d[0],d[1],a);var h=l.lerpLoE(d[1],d[2],a);g=l.lerpLoE(g,h,a)}else g=l.lerpHiE(d[0],d[1],a),h=l.lerpHiE(d[1],d[2],a),g=l.lerpHiE(g,h,a);f=f.divE(g);e[0].setE(f);
d=[d[1].mulE(d[0]),d[2].mulE(d[0]).mul(.5),d[1].mulE(d[2])];c=[c[1].subE(c[0]),c[2].subE(c[0]),c[2].subE(c[1])];a=Gi(c,d,0,a).mul(2);c=g.sqr();a=a.divE(c);e[1].setE(a);b.setE(e[1])}cutBezierIgnoreAttributes(a,b,c){(0>a||1<b||a>b)&&p.throwInvalidArgumentException("Quadratic_rational_bezier.cut_bezier_ignore_attributes");const d=l.makeObjectArray(l.Point2D,3);this.queryControlPoints(d);const e=[0,0,0];Oc(d,this.m_weights,a,b,d,e);c.setControlPointsAndWeights(d,e)}splitBezierIgnoreAttributes(a,b,c){}getAttributeAsDbl(a,
b,c){if(0===b)return 0===c?this.getCoordX(a):this.getCoordY(a);var d=this.calculateLength2D();a=0<d?this.tToLength(a)/d:0;d=K.getInterpolation(b);const e=this.getStartAttributeAsDbl(b,c);c=this.getEndAttributeAsDbl(b,c);return l.interpolate(d,e,c,a,K.getDefaultValue(b))}getClosestCoordinate(a,b){return hg(this,a,l.Envelope1D.unit(),b,-1)}getClosestCoordinateOnInterval(a,b,c=-1){return hg(this,a,b,!1,c)}getYMonotonicParts(a,b){return 0}getMonotonicParts(a,b){2>a.length&&p.throwInvalidArgumentException("");
var c=Zd(this);let d=0;if(2===c.specialPointsCount())return 0;p.geometryReleaseAssert(a.length>=c.specialPointsCount()-1);for(let e=1,f=c.specialPointsCount();e<f;++e)this.queryCut(c.specialPoints[e-1],c.specialPoints[e],a[d],b),d++;for(b=0;b<d;++b)c=a[b].get(),jg(c);return d}intersectionWithAxis2D(a,b,c,d){c&&(c.length=9);d&&(d.length=9);const e=Array(3),f=l.makeObjectArray(l.ECoordinate,2),g=new l.Envelope1D(0,1);var h=0;h=l.makeObjectArray(l.Point2D,3);this.queryControlPoints(h);if(a){if(e[0]=
(new l.ECoordinate(h[0].y)).sub(b).mul(this.m_weights[0]),e[1]=(new l.ECoordinate(h[1].y)).sub(b).mul(this.m_weights[1]),e[2]=e[0].subE(e[1].mul(2)).addE((new l.ECoordinate(h[2].y)).sub(b).mul(this.m_weights[2])),e[1]=e[1].subE(e[0]).mulThisByPower2(2),h=tb(e[2],e[1],e[0],g,!1,f),c)for(a=0;a<h;a++)c[a]=this.getCoordX(f[a].value())}else if(e[0]=(new l.ECoordinate(h[0].x)).sub(b).mul(this.m_weights[0]),e[1]=(new l.ECoordinate(h[1].x)).sub(b).mul(this.m_weights[1]),e[2]=e[0].subE(e[1].mul(2)).addE((new l.ECoordinate(h[2].x)).sub(b).mul(this.m_weights[2])),
e[1]=e[1].subE(e[0]).mulThisByPower2(2),h=tb(e[2],e[1],e[0],g,!1,f),c)for(a=0;a<h;a++)c[a]=this.getCoordY(f[a].value());if(d)for(c=0;c<h;c++)d[c]=f[c].value();else c&&l.sortRange(c,0,h,l.standardNumericCompare);return h}intersectionOfYMonotonicWithAxisX(a,b){if(this.m_YStart===this.m_YEnd)return a===this.m_YStart?b:Number.NaN;if(a===this.m_YStart)return this.m_XStart;if(a===this.m_YEnd)return this.m_XEnd;const c=[Number.NaN,Number.NaN];a=this.intersectionWithAxis2D(!0,a,c,null);p.geometryReleaseAssert(2!==
a);return-1===a?b:c[0]}isCurve(){return!0}isDegenerate(a){return Ce(this,a)}isDegenerate3D(a,b){return!1}queryLooseEnvelope(a){a instanceof D&&(a.setCoords({pt:this.getStartXY()}),a.mergeNe(this.m_cp),a.mergeNe(this.getEndXY()))}clone(a){a=this.createInstance();this.copyTo(a);return a}queryInterval(a,b){if(0===a){a=D.constructEmpty();this.queryEnvelope(a);const c=l.Envelope1D.constructEmpty();0===b?a.queryIntervalX(c):a.queryIntervalY(c);return c}return super.queryInterval(a,b)}queryLooseEnvelopeOnInterval(a,
b){const c=l.makeObjectArray(l.Point2D,3);this.queryControlPoints(c);Oc(c,this.m_weights,a.vmin,a.vmax,c,[0,0,0]);b.setFromPoints(c,3)}changeEndPoints2D(a,b){if(!a.isEqual(this.m_XStart,this.m_YStart)||!b.isEqual(this.m_XEnd,this.m_YEnd)){var c=this.m_cp.isEqual(this.m_XStart,this.m_YStart),d=this.m_cp.isEqual(this.m_XEnd,this.m_YEnd);this.setStartXY(a);this.setEndXY(b);c?this.m_cp.setCoordsPoint2D(a):d&&this.m_cp.setCoordsPoint2D(b);this.normalizeAfterEndpointChange()}}tToLength(a){return $d(this,
a,!0)}lengthToT(a){var b=$d(this,1,!1);0>=a||(a>=b?a=a-b+1:(a=new yn(this,a),b=[0],1!==qc(a,l.Envelope1D.unit(),1,b)&&p.throwInternalErrorException(""),a=b[0]));return a}calculateWeightedAreaCentroid2D(a){var b=l.makeObjectArray(l.Point2D,3);var c=[0,0,0];this.queryControlPoints(b);this.queryWeights(c);b=mm(b,c);c=Hi(this);b.x+=(this.getStartX()-a.x)*c;b.y+=(this.getStartY()-a.y)*c;return b}calculateWeightedCentroid2D(){const a=new l.Point2D;if(this.isDegenerate(0))return a.setCoords(0,0),a;if(0===
this.m_weights[1])var b=!0;else{b=l.Point2D.distance(this.getStartXY(),this.getEndXY());var c=this.calculateUpperLength2D();b=c-b<=8*Number.EPSILON*c}if(b)return a.assign(this.getCoord2D(.5).mul(this.calculateLength2D())),a;b=a.assign;{var d=1;c=void 0;void 0===c&&(c=d,d=0);const m=new l.Point2D;if(0>d||1<c)m.setNAN(),c=m;else if(d>c&&p.throwInvalidArgumentException("calculate_sub_weighted_centroid"),d===c||this.isDegenerate(0))m.setCoords(0,0),c=m;else{var e=Zd(this),f=Fi(this),g=f/this.calculateUpperLength2D(),
h=d,k=0;for(let n=1,q=e.specialPointsCount();n<q;n++)if(d<e.specialPoints[n]){k=n-1;break}m.setCoords(0,0);for(let n=k+1,q=e.specialPointsCount();n<q&&!(d=Math.min(e.specialPoints[n],c),h=jm(this,h,d,g,f),m.addThis(h),h=d,c<=e.specialPoints[n]);n++);c=m.add(this.getStartXY().mul(this.calculateLength2D()))}}b.call(a,c);return a}getControlPoint1(){return this.m_cp.clone()}setControlPoint1(a){this.m_cp.setCoordsPoint2D(a);this.afterCompletedModification()}queryWeights(a){for(let b=0;3>b;++b)a[b]=this.m_weights[b]}setWeights(a){}queryControlPoints(a){a[0].assign(this.getStartXY());
a[1].assign(this.m_cp);a[2].assign(this.getEndXY())}setControlPointsAndWeights(a,b){this.setCpsAndWeightsArray(a,b);this.afterCompletedModification()}getTangent(a){const b=l.makeObjectArray(l.Point2D,3);this.queryControlPoints(b);return gg(b,this.m_weights,a)}getDerivative(a){return l.Point2D.getNAN()}getCurvature(a){return 0}isIntersecting(a,b,c){return!1}isIntersectingPoint(a,b,c){return!1}isIntersectingPoint3D(a,b,c,d,e){return!1}queryAttributeAsDbl(a,b,c,d){}isMonotoneQuickAndDirty(){const a=
l.makeObjectArray(l.Point2D,3);this.queryControlPoints(a);return Oe(a)}getMonotonicPartParams(a,b){const c=Zd(this),d=c.specialPointsCount();if(!b)return c.specialPointsCount();a<d&&p.throwInvalidArgumentException("");for(a=0;a<d;a++)b[a]=c.specialPoints[a];return d}normalizeAfterEndpointChange(){return!1}orientBottomUp(){if(this.m_YEnd<this.m_YStart||this.m_YEnd===this.m_YStart&&this.m_XEnd<this.m_XStart){this.m_XEnd=l.swap(this.m_XStart,this.m_XStart=this.m_XEnd);this.m_YEnd=l.swap(this.m_YStart,
this.m_YStart=this.m_YEnd);this.m_weights[2]=l.swap(this.m_weights[0],this.m_weights[0]=this.m_weights[2]);for(let a=0,b=this.m_description.getTotalComponentCount()-2;a<b;a++)this.m_attributes[a+b]=l.swap(this.m_attributes[a],this.m_attributes[a]=this.m_attributes[a+b]);this.m_cachedValues=null}}isLine(){return!1}isDegenerateToLineHelper(a){a=[a];if(!Tf(this,a))return!1;{a=a[0];const b=this.getEndXY().sub(this.getStartXY()),c=b.length(),d=this.getControlPoint1();d.subThis(this.getStartXY());a=Math.abs(d.crossProduct(b))/
c>a?!1:!0}return a}copyIgnoreAttributes(a){const b=l.makeObjectArray(l.Point2D,3);this.queryControlPoints(b);const c=[0,0,0];this.queryWeights(c);a.setControlPointsAndWeights(b,c)}calculateArea2DHelper(){return Hi(this)}absNorm(){return this.getStartXY().norm(1)+this.getEndXY().norm(1)+this.m_cp.norm(1)}absNormXYZ(a){p.geometryReleaseAssert(0);return 0}queryEnvelopeW(a,b){Ii(this,a,b)}setSegmentFromCoords(a,b){}writeInBufferStream(a,b){const c=new Float64Array(5);c[0]=this.m_cp.x;c[1]=this.m_cp.y;
c[2]=this.m_weights[0];c[3]=this.m_weights[1];c[4]=this.m_weights[2];a.writeRangeFromArray(b,c.length,c,!0,1);return b+=c.length}readFromBufferStream(a,b){const c=new Float64Array(5);a.queryRange(b,c.length,c,!0,1);this.m_cp.x=c[0];this.m_cp.y=c[1];this.m_weights[0]=c[2];this.m_weights[1]=c[3];this.m_weights[2]=c[4];this.m_cachedValues=null}snapControlPoints(a){var b=l.makeObjectArray(l.Point2D,3);this.queryControlPoints(b);const c=l.Point2D.sqrDistance(b[1],b[0]),d=l.Point2D.sqrDistance(b[1],b[2]);
let e=b[0].clone(),f=c;c>d&&(e=b[2].clone(),f=d);b=!1;f<=a&&0!==f&&(b=!0,this.setControlPoint1(e));return b}needsSnapControlPoints(a){if(!a)return!1;const b=l.makeObjectArray(l.Point2D,3);this.queryControlPoints(b);const c=l.Point2D.sqrDistance(b[1],b[0]),d=l.Point2D.sqrDistance(b[1],b[2]);b[0].clone();let e=c;c>d&&(b[2].clone(),e=d);return e<=a&&0!==e?!0:!1}calculateSpecialPointsForCracking(a,b){return 0}ensureXYMonotone(){return jg(this)}setCoordsForIntersector(a,b,c){if(!a.isEqual(this.m_XStart,
this.m_YStart)||!b.isEqual(this.m_XEnd,this.m_YEnd)){c=c?this.isMonotoneQuickAndDirty():!1;var d=new l.Transformation2D,e=l.makeObjectArray(l.Point2D,3);e[0].setCoords(this.m_XStart,this.m_YStart);e[2].setCoords(this.m_XEnd,this.m_YEnd);var f=new l.Point2D;f.setSub(e[2],e[0]);f.leftPerpendicularThis();e[1].setAdd(e[0],f);var g=l.makeObjectArray(l.Point2D,3);g[0].setCoordsPoint2D(a);g[2].setCoordsPoint2D(b);f.setSub(g[2],g[0]);f.leftPerpendicularThis();g[1].setAdd(g[0],f);d.setFromTwoTriangles(e,g)?
d.transformInPlace(this.m_cp):l.lerpPoint2D(a,b,.5,this.m_cp);this.changeEndPoints2D(a,b);c&&jg(this)}}copyToImpl(a){a.m_cp.setCoordsPoint2D(this.m_cp);a.m_weights[0]=this.m_weights[0];a.m_weights[1]=this.m_weights[1];a.m_weights[2]=this.m_weights[2];a.m_cachedValues=this.m_cachedValues}reverseImpl(){this.m_weights[2]=l.swap(this.m_weights[0],this.m_weights[0]=this.m_weights[2])}equalsImpl(a){if(!this.m_cp.equals(a.m_cp))return!1;for(let b=0;3>b;b++)if(this.m_weights[b]!==a.m_weights[b])return!1;
return!0}equalsImplTol(a,b){if(!this.m_cp.isEqualPoint2D(a.m_cp,b))return!1;const c=l.makeObjectArray(l.Point2D,3);this.queryControlPoints(c);const d=l.makeObjectArray(l.Point2D,3);a.queryControlPoints(d);a=[a.m_weights[0],a.m_weights[1],a.m_weights[2]];for(let e=0;3>e;e++){const f=new X;f.setCoordsPoint2DZ(c[e].mul(this.m_weights[e]),this.m_weights[e]);const g=new X;g.setCoordsPoint2DZ(d[e].mul(a[e]),a[e]);if(!f.isEqual(g,b))return!1}return!0}getHashCodeImpl(){return 0}swapImpl(a){}afterCompletedModification(){Me(this)}intersect(a,
b,c,d,e){return Zc(!1,this,a,b,c,d,e)}intersectPoint(a,b,c){var d=new Va;Ii(this,l.Envelope1D.unit(),d);d.inflate(c);if(d.isIntersectingPoint2D(a)){var e=Zd(this);d=0;var f=[],g=e.specialPoints[0];for(let t=1,u=e.specialPoints.length;t<u;++t){const v=e.specialPoints[t];var h=a,k=g,m=v;g={tmin:0,tmax:0,t:0,d:0,pt:l.Point2D.getNAN().clone()};var n=Array(18);const w=l.makeObjectArray(l.Point2D,3);this.queryControlPoints(w);w[2].subThis(h);w[1].subThis(h);w[0].subThis(h);h=[0,0,0];this.queryWeights(h);
const x=[1,Yb(h),1];var q=be(h,k);m=be(h,m);k=new xn(w,x,new l.Point2D(0,0));var r=l.Envelope1D.construct(q,m);k=qc(k,r,18,n);Na(w,x,q,g.pt);g.t=q;g.d=l.Point2D.distance(g.pt,new l.Point2D(0,0));q=new l.Point2D;Na(w,x,m,q);r=l.Point2D.distance(q,new l.Point2D(0,0));r<g.d&&(g.d=r,g.t=m,g.pt.assign(q));for(m=0;m<k;m++)Na(w,x,n[m],q),r=l.Point2D.distance(q,new l.Point2D(0,0)),r<g.d&&(g.d=r,g.t=ld(h,n[m]),g.pt.assign(q));0===f.length?f.push(g):g.t===g.tmin?(p.geometryReleaseAssert(f.at(-1).d<=g.d),f.at(-1).tmax=
g.tmax):f.at(-1).t===f.at(-1).tmax?(p.geometryReleaseAssert(f.at(-1).d>=g.d),n=f.at(-1).tmin,f[f.length-1]=g,f.at(-1).tmin=n):f.push(g);g=v}for(const t of f)t.d<=c&&(a=t.t,b&&(b[d]=a),d++);b=d}else b=0;return b}intersect_(a,b,c,d){return 0}endPointModified(){Me(this)}clearEndPointModified(){}setCpsAndWeights(a,b,c,d,e,f){(0>=d||0>=f||0>e)&&p.throwInvalidArgumentException("weights");(a.isNAN()||b.isNAN()||c.isNAN())&&p.throwInvalidArgumentException("NAN control points in bezier are not supported");
this.setStartXY(a);this.m_cp.assign(b);this.m_weights[0]=d;this.m_weights[1]=e;this.m_weights[2]=f;this.setEndXY(c)}setCpsAndWeightsArray(a,b){this.setCpsAndWeights(a[0],a[1],a[2],b[0],b[1],b[2])}}lb.type=p.GeometryType.enumRationalBezier2;class pm{constructor(){this.length=Number.NaN;this.specialPoints=[]}specialPointsCount(){return this.specialPoints.length}}class Xi{constructor(a,b){this.controlPoints=a;this.point=b.clone()}getMaxDerivative(){return 6}getValue(a,b){switch(a){case 0:return a=new l.Point2D,
Ia(this.controlPoints,b,a),b=Wa(this.controlPoints,1,b),2*a.sub(this.point).dotProduct(b);case 1:a=new l.Point2D;Ia(this.controlPoints,b,a);var c=Wa(this.controlPoints,1,b);b=Wa(this.controlPoints,2,b);return 2*(a.sub(this.point).dotProduct(b)+c.dotProduct(c));case 2:a=new l.Point2D;Ia(this.controlPoints,b,a);c=Wa(this.controlPoints,1,b);const d=Wa(this.controlPoints,2,b);b=Wa(this.controlPoints,3,b);return 2*(a.sub(this.point).dotProduct(b)+3*c.dotProduct(d));case 3:return a=Wa(this.controlPoints,
1,b),c=Wa(this.controlPoints,2,b),b=Wa(this.controlPoints,3,b),2*(4*a.dotProduct(b)+3*c.sqrLength());case 4:return a=Wa(this.controlPoints,2,b),b=Wa(this.controlPoints,3,b),20*a.dotProduct(b);case 5:return b=Wa(this.controlPoints,3,b),20*b.dotProduct(b);default:return 0}}getError(a){p.geometryReleaseAssert(0);return 0}}class wn{constructor(a,b){this.b=a;this.len=b}getMaxDerivative(){return 1}getValue(a,b){return 0===a?this.len-de(this.b,b,!1):0}getError(a){p.geometryReleaseAssert(0);return 0}}class yc{static toSegType(a){let b=
0;switch(a){case p.GeometryType.enumLine:b=1;break;case p.GeometryType.enumBezier:b=2;break;case p.GeometryType.enumEllipticArc:b=4;break;case p.GeometryType.enumRationalBezier2:b=8;break;case p.GeometryType.enumBezier2:b=16;break;default:p.throwInternalErrorException("")}return b}constructor(){this.m_segmentParams=this.m_segmentParamIndex=this.m_segmentFlags=null;this.m_curveParamWritePoint=this.m_bezier2Count=this.m_rbezier2Count=this.m_arcCount=this.m_bezierCount=this.m_curveCount=0}assignCopy(a){this.m_segmentFlags=
a.m_segmentFlags;this.m_segmentParamIndex=a.m_segmentParamIndex;this.m_segmentParams=a.m_segmentParams;this.m_curveCount=a.m_curveCount;this.m_bezierCount=a.m_bezierCount;this.m_arcCount=a.m_arcCount;this.m_rbezier2Count=a.m_rbezier2Count;this.m_bezier2Count=a.m_bezier2Count;this.m_curveParamWritePoint=a.m_curveParamWritePoint;return this}}class db extends El{constructor(a){super(a);this.m_curveData=this.m_pathFlags=this.m_paths=this.m_cachedRingAreas2D=null;a.move?(this.m_bPolygon=a.move.m_bPolygon,
this.m_cachedLength2D=a.move.m_cachedLength2D,this.m_cachedArea2D=a.move.m_cachedArea2D,this.m_currentPathIndex=a.move.m_currentPathIndex,this.m_cachedRingAreas2D=a.move.m_cachedRingAreas2D,this.m_paths=a.move.m_paths,this.m_pathFlags=a.move.m_pathFlags,this.m_curveData=a.move.m_curveData,a.move.m_curveData=null,a.move.setEmpty()):(this.m_bPolygon=a.bPolygon,this.m_currentPathIndex=this.m_cachedArea2D=this.m_cachedLength2D=0)}getGeometryType(){return this.m_bPolygon?p.GeometryType.enumPolygon:p.GeometryType.enumPolyline}getDimension(){return this.m_bPolygon?
2:1}changeRingStartPoint(a){p.geometryReleaseAssert(this.m_bPolygon);var b=this.getPathIndexFromPointIndex(a);const c=this.getPathStart(b);if(c!==a){b=this.getPathEnd(b);(a>=b||a<c)&&p.throwInvalidArgumentException("change_ring_start_point");for(let e=0,f=this.m_description.getAttributeCount();e<f;e++){var d=this.m_description.getSemantics(e);d=K.getComponentCount(d);this.m_vertexAttributes.get(e).rotate(c*d,a*d,b*d)}this.hasNonLinearSegments()&&(this.m_curveData.m_segmentFlags.rotate(c,a,b),this.m_curveData.m_segmentParamIndex.rotate(c,
a,b))}}setFillRule(a){this.m_bFillRule=1===a}getFillRule(){return this.m_bFillRule?1:0}isExteriorRingOGC(a){if(!this.m_bPolygon)return!1;this.updateOGCFlagsProtected();return 0!==(this.m_pathFlags.read(a)&8)}isExteriorRing(a){return 0<this.calculateRingArea2D(a)}calculateRingArea2D(a){if(!this.m_bPolygon)return 0;this.updateRingAreas2DProtected();return this.m_cachedRingAreas2D.read(a)}updateRingAreas2DProtected(){if(this.hasDirtyFlag(1024)){var a=this.getPathCount();if(0===a)this.hasDirtyFlag(1024)&&
(this.m_cachedArea2D=0),this.setDirtyFlagProtected(1024,!1);else{var b=new ic(a),c=new l.KahanSummator(0),d=new l.KahanSummator(0);if(0!==this.m_pointCount){const h=this.getAttributeStreamRef(0);if(this.hasNonLinearSegments())for(a=new zh({parent:this}),a.stripAttributes();a.nextPath();){d.reset();var e=a.getPathIndex();Yi(this,e,h,d);for(var f=a,g=d;f.hasNextSegment();){const k=f.nextCurve();if(null===k)break;g.pe(2*k.calculateArea2DHelper())}f=.5*d.getResult();c.add(f);b.write(e,f)}else for(e=0;e<
a;e++)d.reset(),Yi(this,e,h,d),f=.5*d.getResult(),c.add(f),b.write(e,f)}this.hasDirtyFlag(1024)&&(this.m_cachedArea2D=c.getResult(),this.m_cachedRingAreas2D=b,this.setDirtyFlagProtected(1024,!1))}}}getOGCPolygonCount(){if(!this.m_bPolygon)return 0;this.updateOGCFlagsProtected();let a=0;const b=this.getPathCount();for(let c=0;c<b;c++)0!==(this.m_pathFlags.read(c)&8)&&a++;return a}getHashCodeImpl(){p.geometryReleaseAssert(0);return 0}equalsImpl(a){var b=this.getPathCount(),c=a.getPathCount();if(b!==
c)return!1;c=this.hasNonLinearSegments();if(c!==a.hasNonLinearSegments()||c&&(this.m_curveData.m_curveCount!==a.m_curveData.m_curveCount||this.m_curveData.m_bezierCount!==a.m_curveData.m_bezierCount)||this.m_paths&&!this.m_paths.equals(a.m_paths,0,b+1)||this.m_bFillRule!==a.m_bFillRule||!this.m_bPolygon&&this.m_pathFlags&&!this.m_pathFlags.equals(a.m_pathFlags,0,b))return!1;if(this.hasNonLinearSegments()){if(!this.m_curveData.m_segmentFlags.equals(a.m_curveData.m_segmentFlags,0,this.getPointCount()))return!1;
for(let e=0,f=this.getPointCount();e<f;e++){var d=this.m_curveData.m_segmentFlags.read(e);if(db.isNonLinearSegmentFlag(d)){b=this.m_curveData.m_segmentParamIndex.read(e);c=a.m_curveData.m_segmentParamIndex.read(e);d=Ob(d);for(let g=0;g<d;g++){const h=this.m_curveData.m_segmentParams.read(b+g),k=a.m_curveData.m_segmentParams.read(c+g);if(!l.isEqualNonIEEE(h,k))return!1}}}}return!0}equalsImplTol(a,b){var c=this.getPathCount(),d=a.getPathCount();if(c!==d)return!1;d=this.hasNonLinearSegments();if(d!==
a.hasNonLinearSegments()||d&&(this.m_curveData.m_curveCount!==a.m_curveData.m_curveCount||this.m_curveData.m_bezierCount!==a.m_curveData.m_bezierCount)||this.m_paths&&!this.m_paths.equals(a.m_paths,0,c+1)||this.m_bFillRule!==a.m_bFillRule||!this.m_bPolygon&&this.m_pathFlags&&!this.m_pathFlags.equals(a.m_pathFlags,0,c))return!1;if(!d)return!0;if(!this.m_curveData.m_segmentFlags.equals(a.m_curveData.m_segmentFlags,0,this.getPointCount()))return!1;c=this.querySegmentIterator();for(a=a.querySegmentIterator();c.nextPath();){if(!a.nextPath())return!1;
for(;c.hasNextSegment();){d=c.nextCurve();const e=a.nextCurve();if(!(d&&e&&d.equals(e,b))){if(!d&&!e)break;return!1}}}return!0}reserveImplImpl(a,b){this.m_curveData&&this.m_curveData.m_segmentFlags&&(this.m_curveData.m_segmentFlags.resize(a,1),this.m_curveData.m_segmentParamIndex.resize(a,-1),this.checkCompactSegmentParams())}verifyStreamsAfterSizeChangeExtraImpl(){this.m_paths||(this.m_paths=hb(1,0),this.m_pathFlags=new Db(1,0));this.m_curveData&&this.m_curveData.m_segmentFlags&&(this.m_curveData.m_segmentFlags.resize(this.m_reservedPointCount,
1),this.m_curveData.m_segmentParamIndex.resize(this.m_reservedPointCount,-1),this.checkCompactSegmentParams())}copyToImpl(a,b){a.m_bPathStarted=!1;a.m_bFillRule=this.m_bFillRule;a.m_paths=this.m_paths?b?this.m_paths:this.m_paths.clone():null;a.m_pathFlags=this.m_pathFlags?b?this.m_pathFlags:this.m_pathFlags.clone():null;this.m_curveData&&(a.m_curveData||(a.m_curveData=new yc),a.m_curveData.assignCopy(this.m_curveData),a.m_curveData.m_curveCount=0,a.updateCurveCounter(this.m_curveData.m_curveCount),
b||(a.m_curveData.m_segmentParamIndex=this.m_curveData.m_segmentParamIndex?this.m_curveData.m_segmentParamIndex.clone():null,a.m_curveData.m_segmentFlags=this.m_curveData.m_segmentFlags?this.m_curveData.m_segmentFlags.clone():null,a.m_curveData.m_segmentParams=this.m_curveData.m_segmentParams?this.m_curveData.m_segmentParams.clone():null));a.hasDirtyFlag(512)||(a.m_cachedLength2D=this.m_cachedLength2D);a.m_cachedRingAreas2D=null;a.hasDirtyFlag(1024)||(a.m_cachedArea2D=this.m_cachedArea2D,null!==this.m_cachedRingAreas2D&&
(a.m_cachedRingAreas2D=b?this.m_cachedRingAreas2D:this.m_cachedRingAreas2D.clone()))}calculateArea2D(){if(!this.m_bPolygon)return 0;this.updateRingAreas2DProtected();return this.m_cachedArea2D}calculateLength2D(){if(!this.hasDirtyFlag(512))return this.m_cachedLength2D;const a=this.querySegmentIterator(),b=new l.KahanSummator(0);for(;a.nextPath();)for(;a.hasNextSegment();)b.add(a.nextSegment().calculateLength2D());this.hasDirtyFlag(512)&&(this.m_cachedLength2D=b.getResult());this.setDirtyFlagProtected(512,
!1);return b.getResult()}calculatePathLength2D(a){a=this.querySegmentIteratorAtVertex(this.getPathStart(a));const b=new l.KahanSummator(0);for(;a.hasNextSegment();)b.add(a.nextSegment().calculateLength2D());return b.getResult()}calculateLength3D(a){p.geometryReleaseAssert(0);return 0}calculatePathLength3D(a,b){p.geometryReleaseAssert(0);return 0}copyTo(a){p.isMultiPath(a.getGeometryType())||p.throwInvalidArgumentException("");this!==a&&super.copyTo(a)}swap(a){p.geometryReleaseAssert(0)}hasNonLinearSegments(){return 0!==
this.getCurveCount()}getSegmentCount(){let a=this.getPointCount();if(!this.m_bPolygon){a-=this.getPathCount();for(let b=0,c=this.getPathCount();b<c;b++)this.isClosedPath(b)&&a++}return a}getSegmentCountPath(a){let b=this.getPathSize(a);!this.isClosedPath(a)&&0<b&&b--;return b}add(a,b){this===a&&p.throwInvalidArgumentException("Multi_path_impl::add");for(let c=0,d=a.getPathCount();c<d;c++)this.addPath(a,c,!b)}addPath(a,b,c){this.insertPath(-1,a,b,c)}addPathPoint2D(a,b,c){this.insertPath2D(-1,a,0,b,
c)}addSegmentsFromPath(a,b,c,d,e){this===a&&p.throwInvalidArgumentException("Multi_path_impl.add_segments_from_path");e||0!==this.getPathCount()||(e=!0);0>b&&(b=a.getPathCount()-1);(b>=a.getPathCount()||0>c||0>d||c+d>a.getSegmentCountPath(b))&&p.throwOutOfRangeException("add_segments_from_path");if(0!==d){var f=a.getPathStart(b),g=a.isClosedPath(b)&&c+d===a.getSegmentCountPath(b);this.m_bPathStarted=!1;this.mergeVertexDescription(a.getDescription());var h=d,k=f+c,m=k+1;e&&(h++,m--);!e&&a.hasNonLinearSegments()&&
1!==a.m_curveData.m_segmentFlags.read(k)&&(a.getXY(k).equals(this.getXY(this.m_pointCount-1))||p.throwInvalidArgumentException("add_segments_from_path: start point mismatch"));c=this.m_pointCount;this.resizeImpl(this.m_pointCount+h);this.verifyAllStreamsAfterSizeChange();if(e){if(0===h)return;this.m_paths.add(this.m_pointCount);b=a.m_pathFlags.read(b);this.m_bPolygon&&(b|=1);this.m_pathFlags.write(this.m_pathFlags.size()-1,b);this.m_pathFlags.add(0)}else this.m_paths.write(this.m_pathFlags.size()-
1,this.m_pointCount);h=g?h-1:h;for(let r=0,t=this.m_description.getAttributeCount();r<t;r++){var n=this.m_description.getSemantics(r);b=K.getComponentCount(n);var q=a.m_description.getAttributeIndex(n);if(0<h){if(0>q||!a.m_vertexAttributes.get(q)){n=K.getDefaultValue(n);this.m_vertexAttributes.get(r).insertRange(b*c,n,h*b,b*c);g&&this.m_vertexAttributes.get(r).insertRange(b*c+h*b,n,b,b*c);continue}this.m_vertexAttributes.get(r).insertRangeFromStream(b*c,a.m_vertexAttributes.get(q),b*m,h*b,!0,b,b*
c)}g&&this.m_vertexAttributes.get(r).insertRangeFromStream(b*(c+h),a.m_vertexAttributes.get(q),b*f,b,!0,b,b*(c+h))}this.hasNonLinearSegments()&&this.initSegmentData(0);if(a.hasNonLinearSegments()){f=0;for(let r=0,t=k;r<d;r++)m=a.m_curveData.m_segmentFlags.read(t),f+=Ob(m),t++;if(0<f){this.initSegmentData(f);e=c-(e?0:1);c=0;for(f=0;f<d;f++){m=a.m_curveData.m_segmentFlags.read(k);this.m_curveData.m_segmentFlags.write(e,m);if(db.isNonLinearSegmentFlag(m)){c++;h=a.m_curveData.m_segmentParamIndex.read(k);
b=Ob(m);this.m_curveData.m_segmentParamIndex.write(e,this.m_curveData.m_curveParamWritePoint);for(n=0;n<b;n++)q=a.m_curveData.m_segmentParams.read(h),this.m_curveData.m_segmentParams.write(this.m_curveData.m_curveParamWritePoint,q),this.m_curveData.m_curveParamWritePoint++,h++;this.incCurveType(m,1)}else this.m_curveData.m_segmentParamIndex.write(e,-1);e++;k++}this.modifyCurveCounter(c)}}g&&(a=this.getPathCount()-1,g=this.getPathStart(a),d=this.getPathEnd(a)-1,g=this.getXY(g),d=this.getXY(d),g.isEqualPoint2D(d)&&
(--this.m_pointCount,this.m_paths.write(a+1,this.m_pointCount)));this.notifyModifiedFlags(2001)}}reverseAllPaths(){for(let a=0,b=this.getPathCount();a<b;a++)this.reversePath(a)}reversePath(a){var b=this.getPathCount();a>=b&&p.throwInvalidArgumentException("");b=this.getPathSize(a);if(0!==b){var c=this.getPathStart(a),d=this.isClosedPath(a);if(this.hasNonLinearSegments()){var e=c;const g=new this.m_segmentBufferCTor;let h=!1;for(let k=0;k<b;k++,e++){var f=this.m_curveData.m_segmentFlags.read(e);db.isNonLinearSegmentFlag(f)&&
(h=!0,this.querySegment(e,g,!0),g.get().reverse(),f=this.m_curveData.m_segmentParamIndex.read(e),g.get().writeInBufferStream(this.m_curveData.m_segmentParams,f))}h&&(e=d?0:1,this.m_curveData.m_segmentFlags.reverseRange(c,b-e,1),this.m_curveData.m_segmentParamIndex.reverseRange(c,b-e,1))}d=d?1:0;for(let g=0,h=this.m_description.getAttributeCount();g<h;g++)this.m_vertexAttributes.get(g)&&(e=this.m_description.getSemantics(g),e=K.getComponentCount(e),this.m_vertexAttributes.get(g).reverseRange(e*(c+
d),e*(b-d),e));if(b=this.m_pathFlags.read(a)&6)c=0,b&4&&(c|=2),b&2&&(c|=4),this.m_pathFlags.clearBits(a,6),this.m_pathFlags.setBits(a,c);this.notifyModifiedFlags(1233)}}removePath(a){const b=this.getPathCount();0>a&&(a=b-1);a>=b&&p.throwInvalidArgumentException("");var c=this.getPathStart(a);const d=this.getPathSize(a);for(let f=0,g=this.m_description.getAttributeCount();f<g;f++)if(this.m_vertexAttributes.get(f)){var e=this.m_description.getSemantics(f);e=K.getComponentCount(e);this.m_vertexAttributes.get(f).eraseRange(e*
c,e*d,e*this.m_pointCount)}if(this.hasNonLinearSegments()){e=0;for(let f=c,g=c+d;f<g;f++){const h=this.m_curveData.m_segmentFlags.read(f);db.isNonLinearSegmentFlag(h)&&(this.incCurveType(h,-1),e++)}this.modifyCurveCounter(-e);this.m_curveData.m_segmentFlags.eraseRange(c,d,this.m_pointCount);this.m_curveData.m_segmentParamIndex.eraseRange(c,d,this.m_pointCount)}for(c=a+1;c<=b;c++)e=this.m_paths.read(c),this.m_paths.write(c-1,e-d);if(this.m_pathFlags)for(c=a+1;c<=b;c++)e=this.m_pathFlags.read(c),this.m_pathFlags.write(c-
1,e);this.m_paths.resize(b);this.m_pathFlags.resize(b);this.m_pointCount-=d;this.m_reservedPointCount-=d;a===b-1&&(this.m_bPathStarted=!1);this.notifyModifiedFlags(2001);this.checkCompactSegmentParams();this.dbgVerifyCurves()}dbgVerifyCurves(){}insertPath(a,b,c,d){this===b&&p.throwInvalidArgumentException("Multi_path_impl::insert_path");var e=this.getPathCount();if(!d&&b.hasNonLinearSegmentsPath(c))return a=this.insertPath(a,b,c,!0),this.reversePath(a),a;c>=b.getPathCount()&&p.throwInvalidArgumentException("");
a>e&&p.throwInvalidArgumentException("");0>a&&(a=e);0>c&&(c=b.getPathCount()-1);this.m_bPathStarted=!1;this.mergeVertexDescription(b.getDescription());var f=b.getPathStart(c);const g=b.getPathSize(c);if(0===g)return this.insertPath2D(a,null,0,0,!0);var h=this.m_pointCount,k=b.isClosedPath(c)&&!d?1:0;this.resizeImpl(this.m_pointCount+g);this.verifyAllStreamsAfterSizeChange();var m=a<e?this.getPathStart(a):h;for(let r=0,t=this.m_description.getAttributeCount();r<t;r++){var n=this.m_description.getSemantics(r);
const u=b.getDescription().getAttributeIndex(n);var q=K.getComponentCount(n);0<=u&&b.m_vertexAttributes.get(u)?(0!==k&&this.m_vertexAttributes.get(r).insertRangeFromStream(m*q,b.m_vertexAttributes.get(u),q*f,q,!0,q,q*h),this.m_vertexAttributes.get(r).insertRangeFromStream((m+k)*q,b.m_vertexAttributes.get(u),q*(f+k),q*(g-k),d,q,q*(h+k))):(n=K.getDefaultValue(n),this.m_vertexAttributes.get(r).insertRange(m*q,n,q*g,q*h))}this.m_paths.add(h+g);for(d=e;d>=a+1;d--)k=this.m_paths.read(d-1),this.m_paths.write(d,
k+g);this.m_pathFlags.add(0);for(--e;e>=a+1;e--)d=this.m_pathFlags.read(e),d&=-9,this.m_pathFlags.write(e+1,d);c=b.getPathFlagsStreamRef().read(c);c&=-9;this.m_bPolygon&&(c|=1);this.m_pathFlags.write(a,c);if(b.hasNonLinearSegments()){this.initSegmentData(0);c=f;e=0;for(d=0;d<g;d++)k=b.m_curveData.m_segmentFlags.read(c),e+=Ob(k),c++;if(0<e){null===this.m_curveData.m_segmentFlags?(this.m_curveData.m_segmentFlags=new Db(this.m_pointCount,1),this.m_curveData.m_segmentParamIndex=hb(this.m_pointCount,-1)):
(this.m_curveData.m_segmentFlags.insertRange(m,1,g,h),this.m_curveData.m_segmentParamIndex.insertRange(m,-1,g,h));this.m_curveData.m_segmentParams?this.m_curveData.m_segmentParams.resize(this.m_curveData.m_curveParamWritePoint+e):this.m_curveData.m_segmentParams=Lc(e);c=f;f=m;h=0;for(m=0;m<g;m++){e=b.m_curveData.m_segmentFlags.read(c);if(db.isNonLinearSegmentFlag(e)){this.m_curveData.m_segmentFlags.write(f,e);this.m_curveData.m_segmentParamIndex.write(f,this.m_curveData.m_curveParamWritePoint);d=
Ob(e);k=b.m_curveData.m_segmentParamIndex.read(c);for(q=0;q<d;q++)n=b.m_curveData.m_segmentParams.read(k),this.m_curveData.m_segmentParams.write(this.m_curveData.m_curveParamWritePoint,n),this.m_curveData.m_curveParamWritePoint++,k++;h++;this.incCurveType(e,1)}c++;f++}this.modifyCurveCounter(h)}}this.notifyModifiedFlags(2001);return a}insertPath2D(a,b,c,d,e){var f=this.getPathCount();(a>f||0>c)&&p.throwInvalidArgumentException("");0>a&&(a=f);this.m_bPathStarted=!1;const g=this.m_pointCount;this.resizeImpl(this.m_pointCount+
d);0===d&&this.notifyModifiedFlags(32);this.verifyAllStreamsAfterSizeChange();const h=a<f?this.getPathStart(a):g;b?this.m_vertexAttributes.get(0).insertRangeFromPoints(2*h,b,c,d,e,2*g):(b=K.getDefaultValue(0),this.m_vertexAttributes.get(0).insertRange(2*h,b,2*d,2*g));for(let k=1,m=this.m_description.getAttributeCount();k<m;k++)c=this.m_description.getSemantics(k),b=K.getComponentCount(c),c=K.getDefaultValue(c),this.m_vertexAttributes.get(k).insertRange(h*b,c,b*d,b*g);this.m_paths.add(this.m_pointCount);
for(b=f;b>=a+1;b--)c=this.m_paths.read(b-1),this.m_paths.write(b,c+d);this.m_pathFlags.add(0);for(--f;f>=a+1;f--)b=this.m_pathFlags.read(f),b&=-9,this.m_pathFlags.write(f+1,b);this.m_bPolygon&&this.m_pathFlags.write(a,1);this.hasNonLinearSegments()&&(this.m_curveData.m_segmentFlags.insertRange(h,1,d,g),this.m_curveData.m_segmentParamIndex.insertRange(h,-1,d,g));this.notifyModifiedFlags(2001);return a}insertPathFromMultipoint(a,b,c,d,e){const f=b.getImpl();b=this.getPathCount();(a>b||0>c)&&p.throwInvalidArgumentException("");
d=0>d?f.getPointCount()-c:d;d>f.getPointCount()&&p.throwInvalidArgumentException("");c>=f.getPointCount()&&p.throwInvalidArgumentException("pointsOffset");0>a&&(a=b);this.m_bPathStarted=!1;this.mergeVertexDescription(f.getDescription());if(0===d)this.insertPath2D(a,null,0,0,!0);else{var g=this.m_pointCount;this.resizeImpl(this.m_pointCount+d);this.verifyAllStreamsAfterSizeChange();var h=a<b?this.getPathStart(a):g;for(let m=0,n=this.m_description.getAttributeCount();m<n;m++){var k=this.m_description.getSemantics(m);
const q=f.getDescription().getAttributeIndex(k),r=K.getComponentCount(k);0<=q?(k=f.getAttributeStreamRef(k),this.m_vertexAttributes.get(m).insertRangeFromStream(h*r,k,r*c,r*d,e,r,r*g)):(k=K.getDefaultValue(k),this.m_vertexAttributes.get(m).insertRange(h*r,k,r*d,r*g))}this.m_paths.add(g+d);for(c=b;c>=a+1;c--)e=this.m_paths.read(c-1),this.m_paths.write(c,e+d);this.m_pathFlags.add(0);for(--b;b>=a+1;b--)c=this.m_pathFlags.read(b),c&=-9,this.m_pathFlags.write(b+1,c);b=0;this.m_bPolygon&&(b|=1);this.m_pathFlags.write(a,
b);this.notifyModifiedFlags(2001)}}insertPoints(a,b,c,d,e,f,g){this===c&&p.throwInvalidArgumentException("Multi_path_impl.insert_points");0>a&&(a=this.getPathCount());0>d&&(d=c.getPathCount()-1);(a>this.getPathCount()||0<=b&&b>this.getPathSize(a)||d>=c.getPathCount()||f>c.getPathSize(d))&&p.throwOutOfRangeException("");if(f){this.mergeVertexDescription(c.m_description);if(a===this.getPathCount()){this.m_paths.add(this.m_pointCount);var h=c.m_pathFlags.read(d);h&=-9;this.m_bPolygon?this.m_pathFlags.add(h|
1):this.m_pathFlags.add(h)}0>b&&(b=this.getPathSize(a));h=this.m_pointCount;this.resizeImpl(this.m_pointCount+f);this.verifyAllStreamsAfterSizeChange();var k=this.getPathStart(a),m=k+b;0>f&&(f=c.getPathSize(d));d=c.getPathStart(d);var n=d+f;for(let r=0,t=this.m_description.getAttributeCount();r<t;r++){var q=this.m_description.getSemantics(r);const u=K.getComponentCount(q),v=c.m_description.getAttributeIndex(q);0>v||!c.m_vertexAttributes.get(v)?(q=K.getDefaultValue(q),this.m_vertexAttributes.get(r).insertRange(u*
m,q,n*u,u*h)):this.m_vertexAttributes.get(r)?.insertRangeFromStream(u*(k+b),c.m_vertexAttributes.get(v),u*(d+e),f*u,g,u,u*h)}this.hasNonLinearSegments()&&(this.m_curveData.m_segmentFlags.insertRange(k+b,1,f,h),this.m_curveData.m_segmentParamIndex.insertRange(k+b,-1,f,h),0<b&&this.isNonLinearSegment(k+b-1)&&(this.incCurveType(this.m_curveData.m_segmentFlags.read(k+b-1),-1),this.m_curveData.m_segmentFlags.write(k+b-1,1),this.m_curveData.m_segmentParamIndex.write(k+b-1,-1),this.modifyCurveCounter(-1)));
for(let r=a+1,t=this.getPathCount();r<=t;r++)a=this.m_paths.read(r),this.m_paths.write(r,a+f);this.notifyModifiedFlags(2001)}}insertPointsFromPoints(a,b,c,d,e,f){0>a&&(a=this.getPathCount());(a>this.getPathCount()||b>this.getPathSize(a)||0>d)&&p.throwOutOfRangeException("");if(e){a===this.getPathCount()&&(this.m_paths.add(this.m_pointCount),this.m_bPolygon?this.m_pathFlags.add(1):this.m_pathFlags.add(0));0>b&&(b=this.getPathSize(a));var g=this.m_pointCount;this.resizeImpl(this.m_pointCount+e);this.verifyAllStreamsAfterSizeChange();
var h=this.getPathStart(a);this.m_vertexAttributes.get(0).insertRangeFromPoints(2*(h+b),c,d,e,f,2*g);for(let k=1,m=this.m_description.getAttributeCount();k<m;k++)d=this.m_description.getSemantics(k),c=K.getComponentCount(d),d=K.getDefaultValue(d),this.m_vertexAttributes.get(k).insertRange((h+b)*c,d,c*e,c*g);this.hasNonLinearSegments()&&(this.m_curveData.m_segmentFlags.insertRange(h+b,1,e,g),this.m_curveData.m_segmentParamIndex.insertRange(h+b,-1,e,g),0<b&&this.isNonLinearSegment(h+b-1)&&(this.incCurveType(this.m_curveData.m_segmentFlags.read(h+
b-1),-1),this.m_curveData.m_segmentFlags.write(h+b-1,1),this.m_curveData.m_segmentParamIndex.write(h+b-1,-1),this.modifyCurveCounter(-1)));for(let k=a+1,m=this.getPathCount();k<=m;k++)this.m_paths.write(k,this.m_paths.read(k)+e);this.notifyModifiedFlags(2001)}}insertPointsFromMultipoint(a,b,c,d,e,f){const g=c.getImpl();0>a&&(a=this.getPathCount());0>e&&(e=c.getPointCount());(a>this.getPathCount()||0<=b&&b>this.getPathSize(a)||e>c.getPointCount())&&p.throwOutOfRangeException("");if(e){this.mergeVertexDescription(g.getDescription());
a===this.getPathCount()&&(this.m_paths.add(this.m_pointCount),this.m_bPolygon?this.m_pathFlags.add(1):this.m_pathFlags.add(0));0>b&&(b=this.getPathSize(a));c=this.m_pointCount;this.resizeImpl(this.m_pointCount+e);this.verifyAllStreamsAfterSizeChange();var h=this.getPathStart(a),k=h+b,m=0+e;for(let q=0,r=this.m_description.getAttributeCount();q<r;q++){var n=this.m_description.getSemantics(q);const t=K.getComponentCount(n);0>g.getDescription().getAttributeIndex(n)?(n=K.getDefaultValue(n),this.m_vertexAttributes.get(q).insertRange(t*
k,n,m*t,t*c)):(n=g.getAttributeStreamRef(n),this.m_vertexAttributes.get(q).insertRangeFromStream(t*(h+b),n,t*(0+d),e*t,f,t,t*c))}this.hasNonLinearSegments()&&(this.m_curveData.m_segmentFlags.insertRange(h+b,1,e,c),this.m_curveData.m_segmentParamIndex.insertRange(h+b,-1,e,c),0<b&&this.isNonLinearSegment(h+b-1)&&(this.incCurveType(this.m_curveData.m_segmentFlags.read(h+b-1),-1),this.m_curveData.m_segmentFlags.write(h+b-1,1),this.m_curveData.m_segmentParamIndex.write(h+b-1,-1),this.modifyCurveCounter(-1)));
for(let q=a+1,r=this.getPathCount();q<=r;q++)a=this.m_paths.read(q),this.m_paths.write(q,a+e);this.notifyModifiedFlags(2001)}}insertPoint2D(a,b,c){const d=this.getPathCount();0>a&&(a=d);(a>d||a<d&&b>this.getPathSize(a))&&p.throwOutOfRangeException("");a===d&&this.addPathPoint2D(null,0,!0);const e=this.m_pointCount;this.resizeImpl(this.m_pointCount+1);this.verifyAllStreamsAfterSizeChange();const f=this.getPathStart(a);b=0>b?this.getPathSize(a)+f:b+f;var g=this.m_vertexAttributes.get(0);if(b===e)this.m_paths.write(a+
1,e+1),g.writePoint2D(2*b,c);else{g.insert(2*b,c,2*e);for(let h=1,k=this.m_description.getAttributeCount();h<k;h++)g=this.m_description.getSemantics(h),c=K.getComponentCount(g),g=K.getDefaultValue(g),this.m_vertexAttributes.get(h).insertRange(c*b,g,c,c*e);this.m_curveData&&this.m_curveData.m_segmentFlags&&(this.m_curveData.m_segmentFlags.insertRange(b,1,1,e),this.m_curveData.m_segmentParamIndex.insertRange(b,-1,1,e));for(let h=a+1,k=d;h<=k;h++)this.m_paths.write(h,this.m_paths.read(h)+1)}this.m_curveData&&
this.m_curveData.m_segmentFlags&&b>f&&this.isNonLinearSegment(b-1)&&(this.incCurveType(this.m_curveData.m_segmentFlags.read(b-1),-1),this.modifyCurveCounter(-1),this.m_curveData.m_segmentFlags.write(b-1,1),this.m_curveData.m_segmentParamIndex.write(b-1,-1));this.notifyModifiedFlags(2001)}insertPoint(a,b,c){const d=this.getPathCount();0>a&&(a=d);(a>d||a<d&&b>this.getPathSize(a))&&p.throwOutOfRangeException("");a===d&&this.addPathPoint2D(null,0,!0);const e=this.m_pointCount;this.resizeImpl(this.m_pointCount+
1);this.verifyAllStreamsAfterSizeChange();const f=this.getPathStart(a);b=0>b?this.getPathSize(a)+f:b+f;if(b===e)this.m_paths.write(a+1,e+1),this.setPointByVal(b,c);else{const h=c.getDescription();this.m_description!==h&&this.mergeVertexDescription(h);for(let k=0,m=this.m_description.getAttributeCount();k<m;k++){var g=this.m_description.getSemantics(k);const n=K.getComponentCount(g);h.hasAttribute(g)?this.m_vertexAttributes.get(k).insertAttributes(n*b,c,g,n*e):(g=K.getDefaultValue(g),this.m_vertexAttributes.get(k).insertRange(n*
b,g,n,n*e))}this.m_curveData&&this.m_curveData.m_segmentFlags&&(this.m_curveData.m_segmentFlags.insertRange(b,1,1,e),this.m_curveData.m_segmentParamIndex.insertRange(b,-1,1,e));for(let k=a+1,m=d;k<=m;k++)this.m_paths.write(k,this.m_paths.read(k)+1)}this.m_curveData&&this.m_curveData.m_segmentFlags&&b>f&&this.isNonLinearSegment(b-1)&&(this.incCurveType(this.m_curveData.m_segmentFlags.read(b-1),-1),this.modifyCurveCounter(-1),this.m_curveData.m_segmentFlags.write(b-1,1),this.m_curveData.m_segmentParamIndex.write(b-
1,-1));this.notifyModifiedFlags(2001)}removePointFromPath(a,b){var c=this.getPathCount();0>a&&(a=c-1);(a>=c||b>=this.getPathSize(a))&&p.throwOutOfRangeException("Multi_path.remove_point");var d=this.getPathStart(a);const e=this.isClosedPath(a);0>b&&(b=this.getPathSize(a)-1);0>b&&p.throwOutOfRangeException("Multi_path.remove_point");b=d+b;for(let g=0,h=this.m_description.getAttributeCount();g<h;g++)if(this.m_vertexAttributes.get(g)){var f=this.m_description.getSemantics(g);f=K.getComponentCount(f);
this.m_vertexAttributes.get(g).eraseRange(f*b,f,f*this.m_pointCount)}if(this.m_curveData&&this.m_curveData.m_segmentFlags){this.checkCompactSegmentParams();f=0;if(b>d&&this.isNonLinearSegment(b-1))f+=1,this.incCurveType(this.m_curveData.m_segmentFlags.read(b-1),-1),this.m_curveData.m_segmentFlags.write(b-1,1),this.m_curveData.m_segmentParamIndex.write(b-1,-1);else{const g=this.getPathEnd(a);e&&d+1<g&&this.isNonLinearSegment(g-1)&&(this.incCurveType(this.m_curveData.m_segmentFlags.read(g-1),-1),this.m_curveData.m_segmentFlags.write(g-
1,1),this.m_curveData.m_segmentParamIndex.write(g-1,-1),f+=1)}this.isNonLinearSegment(b)&&(this.incCurveType(this.m_curveData.m_segmentFlags.read(b),-1),f+=1);0<f&&this.modifyCurveCounter(-f);this.m_curveData.m_segmentFlags.eraseRange(b,1,this.m_pointCount);this.m_curveData.m_segmentParamIndex.eraseRange(b,1,this.m_pointCount)}for(;c>=a+1;c--)d=this.m_paths.read(c),this.m_paths.write(c,d-1);this.m_pointCount--;this.m_reservedPointCount--;this.notifyModifiedFlags(2001)}removePoint(a){let b;b=0>a?this.getPathCount()-
1:this.getPathIndexFromPointIndex(a);this.removePointFromPath(b,a-this.getPathStart(b))}getNumberOfCurves(a){if(!this.hasNonLinearSegments())return 0;let b=0;for(let c=this.getPathStart(a),d=this.getPathEnd(a);c<d;c++)db.isNonLinearSegmentFlag(this.m_curveData.m_segmentFlags.read(c))&&++b;return b}getPathCount(){return this.m_paths?this.m_paths.size()-1:0}getPathSize(a){return this.m_paths.read(a+1)-this.m_paths.read(a)}getPathStart(a){return this.m_paths.read(a)}getPathEnd(a){return this.m_paths.read(a+
1)}getPathIndexFromPointIndex(a,b=-1){-1===b&&(b=this.m_currentPathIndex);const c=this.getPathCount();return this.m_currentPathIndex=a=db.getPathIndexFromPointIndexImpl(this.m_paths,c,a,b)}startPathCoords(a,b){this.startPathPoint(new Y({x:a,y:b}))}startPath(a){this.startPathPoint(new Y({pt:a}))}startPath3D(a){this.startPathPoint(new Y({x:a.x,y:a.y,z:a.z}))}startPath3DCoords(a,b,c){this.startPathPoint(new Y({x:a,y:b,z:c}))}startPathPoint(a){a.isEmpty()&&p.throwInvalidArgumentException("");var b=a.getDescription();
this.m_description!==b&&(this.mergeVertexDescription(b),b=new Y({vd:this.m_description}),a.copyCommonAttributesTo(b),a=b);this.m_bPathStarted?this.setPointByVal(this.m_pointCount-1,a):(this.insertPoint(-1,-1,a),this.m_bPathStarted=!0)}beforeNewSegmentHelper2(){this.m_paths=hb(2);this.m_paths.write(0,0);this.m_pathFlags=new Db(2,0);this.m_bPolygon&&this.m_pathFlags.write(0,1)}beforeNewSegmentHelper1(){null!==this.m_paths?(this.m_paths.add(0),this.m_pathFlags.add(0),this.m_bPolygon&&this.m_pathFlags.write(this.m_pathFlags.size()-
2,1)):this.beforeNewSegmentHelper2()}beforeNewSegment(a){0!==this.m_pointCount||this.m_bPathStarted||this.startPathCoords(0,0);const b=this.m_pointCount,c=this.m_paths.size()-1;a=b+a;this.m_paths.write(c,a);this.resizeImpl(a);this.m_bPathStarted&&(this.m_bPathStarted=!1)}finishLineTo(){if(this.hasNonLinearSegments()){const a=this.m_curveData.m_segmentFlags.read(this.m_pointCount-1);1!==a&&(this.m_curveData.m_segmentFlags.write(this.m_pointCount-1,1),this.m_curveData.m_segmentParamIndex.write(this.m_pointCount-
1,-1),this.modifyCurveCounter(-1),this.incCurveType(a,-1))}}lineToCoords(a,b){this.beforeNewSegment(1);if(1===this.m_description.getAttributeCount())this.setXYCoords(this.m_pointCount-1,a,b);else{const c=new Y({vd:this.m_description,attribBuffer:Array(25),initDefaultValues:!0});c.setXYCoords(a,b);this.setPointByVal(this.m_pointCount-1,c)}this.finishLineTo()}lineTo(a){this.lineToCoords(a.x,a.y)}lineTo3D(a){this.beforeNewSegment(1);var b=Id(this.m_description,Kd());b=new Y({vd:b,attribBuffer:Array(25),
initDefaultValues:!0});b.setXYZ(a);this.setPointByVal(this.m_pointCount-1,b);this.finishLineTo()}lineTo3DCoords(a,b,c){this.lineTo3D(new X(a,b,c))}lineToPoint(a){this.beforeNewSegment(1);if(this.m_description===a.getDescription())this.setPointByVal(this.m_pointCount-1,a);else{this.mergeVertexDescription(a.getDescription());const b=new Y({vd:this.m_description,attribBuffer:Array(25),initDefaultValues:!1});a.copyCommonAttributesTo(b);this.setPointByVal(this.m_pointCount-1,b)}this.finishLineTo()}openPathAndDuplicateStartVertex(a){this.m_bPolygon&&
p.throwInternalErrorException("");var b=this.getPathCount();a>b&&p.throwInvalidArgumentException("");if(this.isClosedPath(a)){this.m_pathFlags||p.throwInternalErrorException("");var c=this.m_pointCount,d=this.getPathStart(a),e=this.getPathEnd(a);if(0!==e-d){this.resizeImpl(this.m_pointCount+1);this.verifyAllStreamsAfterSizeChange();for(let g=0,h=this.m_description.getAttributeCount();g<h;g++)if(this.m_vertexAttributes.get(g)){var f=this.m_description.getSemantics(g);f=K.getComponentCount(f);this.m_vertexAttributes.get(g).insertRangeFromStream(f*
e,this.m_vertexAttributes.get(g),f*d,f,!0,1,f*c)}for(;b>a;b--)d=this.m_paths.read(b),this.m_paths.write(b,d+1);this.hasNonLinearSegments()&&(this.m_curveData.m_segmentFlags.insertRange(e,1,1,c),this.m_curveData.m_segmentParamIndex.insertRange(e,-1,1,c));this.m_pathFlags.clearBits(a,1)}}}openPath(a){p.geometryReleaseAssert(0)}isStrongPathStart(a){return 0!==(this.m_pathFlags.read(a)&2)}setStrongPathStart(a,b){b?this.m_pathFlags.setBits(a,2):this.m_pathFlags.clearBits(a,2)}isStrongPathEnd(a){return 0!==
(this.m_pathFlags.read(a)&4)}setStrongPathEnd(a,b){b?this.m_pathFlags.setBits(a,4):this.m_pathFlags.clearBits(a,4)}clearStrongPathEnds(){for(let a=0,b=this.getPathCount();a<b;++a)this.m_pathFlags.clearBits(a,6)}openAllPathsAndDuplicateStartVertex(){this.m_bPolygon&&p.throwInternalErrorException("");if(!this.isEmpty()){this.m_pathFlags||p.throwInternalErrorException("");var a=0,b=this.getPathCount();for(var c=0;c<b;c++)this.isClosedPath(c)&&(0<this.getPathSize(c)?a++:this.m_pathFlags.clearBits(c,1));
if(0!==a){b=this.hasNonLinearSegments();var d=0,e=this.getPathCount();c=this.m_description.getAttributeCount();var f=Array(c),g=null,h=null;for(let m=0;m<e;++m){const n=this.getPathStart(m),q=this.getPathSize(m),r=this.isClosedPath(m);if(0<q){const t=n+d;for(let u=0;u<c;u++)if(this.m_vertexAttributes.get(u)){var k=this.m_description.getSemantics(u);const v=K.getComponentCount(k);f[u]||(k=ze(k,v*(this.m_pointCount+a)),f[u]=k);f[u].writeRange(t*v,q*v,this.m_vertexAttributes.get(u),n*v,!0,1);r&&f[u].writeRange((t+
q)*v,v,this.m_vertexAttributes.get(u),n*v,!0,1)}b&&(null===g&&(h=this.m_pointCount+a,g=new Db(h,void 0),h=hb(h)),g.writeRange(t,q,this.m_curveData.m_segmentFlags,n,!0,1),h.writeRange(t,q,this.m_curveData.m_segmentParamIndex,n,!0,1),r&&(g.write(t+q,1),h.write(t+q,-1)))}this.m_paths.write(m,n+d);r&&(this.m_pathFlags.clearBits(m,1),++d)}this.m_paths.write(e,this.m_pointCount+a);this.m_pathFlags.clearBits(e,1);for(d=0;d<c;d++)this.m_vertexAttributes.get(d)&&this.m_vertexAttributes.set(d,f[d]);b&&(this.m_curveData.m_segmentFlags=
g,this.m_curveData.m_segmentParamIndex=h);this.m_pointCount+=a;0<this.m_reservedPointCount&&(this.m_reservedPointCount=this.m_pointCount)}}}closePathWithLine(a){void 0===a&&(a=this.getPathCount()-1);this.throwIfEmpty();(0>a||a>=this.getPathCount())&&p.throwInvalidArgumentException("close_path_with_line");a===this.getPathCount()-1&&(this.m_bPathStarted=!1);var b=this.m_pathFlags.read(a);this.m_pathFlags.write(a,b|1);this.m_curveData&&this.m_curveData.m_segmentFlags&&(a=this.getPathEnd(a)-1,b=this.m_curveData.m_segmentFlags.read(a),
this.m_curveData.m_segmentFlags.write(a,1),this.m_curveData.m_segmentParamIndex.write(a,-1),1!==b&&(this.incCurveType(b,-1),this.modifyCurveCounter(-1)));this.notifyModifiedFlags(2001)}closeLastPathWithSegment(a){this.closePathWithSegment(this.getPathCount()-1,a)}closePathWithSegment(a,b){this.throwIfEmpty();(0>a||a>=this.getPathCount())&&p.throwInvalidArgumentException("close_path_with_line");b.getEndXY().equals(this.getXY(this.getPathStart(a)))||p.throwInvalidArgumentException("close_path_with_segment: end point mismatch");
if(a===this.getPathCount()-1)this.m_bPathStarted=!1,this.addSegment(b,!1),--this.m_pointCount,this.m_paths.write(a+1,this.m_pointCount);else{this.mergeVertexDescription(b.getDescription());var c=b.getStartXY();const e=this.getPathEnd(a)-1;c.equals(this.getXY(e))||p.throwInvalidArgumentException("close_path_with_segment: start point mismatch");var d=b.getGeometryType();if(d===p.GeometryType.enumLine){this.closePathWithLine(a);return}c=Wf(b);this.initSegmentData(c);d=yc.toSegType(d);const f=this.m_curveData.m_segmentFlags.read(e);
f!==d?(this.m_curveData.m_segmentParamIndex.write(e,this.m_curveData.m_curveParamWritePoint),b.writeInBufferStream(this.m_curveData.m_segmentParams,this.m_curveData.m_curveParamWritePoint),this.m_curveData.m_curveParamWritePoint+=c,this.incCurveType(d,1),1!==f?this.incCurveType(f,-1):this.modifyCurveCounter(1)):(c=this.m_curveData.m_segmentParamIndex.read(e),b.writeInBufferStream(this.m_curveData.m_segmentParams,c));this.m_curveData.m_segmentFlags.write(e,d)}b=this.m_pathFlags.read(a);this.m_pathFlags.write(a,
b|1);this.notifyModifiedFlags(2001)}closeAllPaths(){if(!this.m_bPolygon&&!this.isEmptyImpl()){var a=this.m_bPathStarted=!1;for(let b=0,c=this.m_paths.size()-1;b<c;b++)this.isClosedPath(b)||(a=this.m_pathFlags.read(b),this.m_pathFlags.write(b,a|1),a=!0);a&&this.notifyModifiedFlags(512)}}isClosedPath(a){return 0!==(this.m_pathFlags.read(a)&1)}isClosedPathInXYPlane(a){if(this.isClosedPath(a))return!0;var b=this.getPathStart(a);a=this.getPathEnd(a)-1;if(b>a)return!1;b=this.getXY(b);a=this.getXY(a);return b.isEqualPoint2D(a)}isClosedPathIn3D(a){p.geometryReleaseAssert(0);
return!1}hasNonLinearSegmentsPath(a){if(!this.hasNonLinearSegments())return!1;for(let b=this.getPathStart(a),c=this.getPathEnd(a);b<c;b++)if(db.isNonLinearSegmentFlag(this.m_curveData.m_segmentFlags.read(b)))return!0;return!1}isNonLinearSegment(a){return 0===(this.getSegmentFlags(a)&1)}addEnvelope(a,b){if(!a.isEmpty()){var c=0===this.m_pointCount;if(a instanceof D)this.startPathCoords(a.xmin,a.ymin),b?(this.lineToCoords(a.xmax,a.ymin),this.lineToCoords(a.xmax,a.ymax),this.lineToCoords(a.xmin,a.ymax)):
(this.lineToCoords(a.xmin,a.ymax),this.lineToCoords(a.xmax,a.ymax),this.lineToCoords(a.xmax,a.ymin));else{var d=a.getDescription();d=new Y({vd:d,attribBuffer:Array(25),initDefaultValues:!1});for(let e=0,f=4;e<f;e++)a.queryCornerByVal(b?f-e-1:e,d),0===e?this.startPathPoint(d):this.lineToPoint(d)}this.closePathWithLine();this.m_bPathStarted=!1;c&&!b&&(this.setDirtyFlagProtected(256,!1),this.m_bPolygon&&0<Math.min(a.width(),a.height())&&this.setIsSimple(3,0))}}addPathFromClosedSegment(a,b){a.isClosed()||
p.throwInvalidArgumentException("add_path_from_closedSegment: segment must be closed");b?(a=a.getReversed(),b=new Y,a.queryStart(b),this.startPathPoint(b),this.closeLastPathWithSegment(a)):(b=new Y,a.queryStart(b),this.startPathPoint(b),this.closeLastPathWithSegment(a))}addSegment_(a,b){var c=a.getDescription();this.mergeVertexDescription(c);const d=new Y({vd:c,attribBuffer:Array(25),initDefaultValues:!1});c=a.getGeometryType();if(c===p.GeometryType.enumLine){if(b||this.isEmptyImpl())a.queryStart(d),
this.startPathPoint(d);a.queryEnd(d);this.lineToPoint(d)}else{let e=!1;if(b||this.isEmptyImpl())e=!0;e||a.getStartXY().equals(this.getXY(this.m_pointCount-1))||p.throwInvalidArgumentException("add_segment: start point mismatch");e&&(a.queryStart(d),this.startPathPoint(d));this.beforeNewSegment(1);a.queryEnd(d);d.getDescription()===this.m_description?this.setPointByVal(this.m_pointCount-1,d):(b=new Y({vd:this.m_description,attribBuffer:Array(25),initDefaultValues:!1}),d.copyCommonAttributesTo(b),this.setPointByVal(this.m_pointCount-
1,b));b=Wf(a);this.initSegmentData(b);this.m_curveData.m_segmentParamIndex.write(this.m_pointCount-2,this.m_curveData.m_curveParamWritePoint);a.writeInBufferStream(this.m_curveData.m_segmentParams,this.m_curveData.m_curveParamWritePoint);this.m_curveData.m_curveParamWritePoint+=b;a=yc.toSegType(c);this.incCurveType(a,1);this.modifyCurveCounter(1);this.m_curveData.m_segmentFlags.write(this.m_pointCount-2,a)}}addSegment(a,b,c){c?b?this.addPathFromClosedSegment(a,!1):this.closeLastPathWithSegment(a):
this.addSegment_(a,b)}interpolateAttributesRange(a,b,c,d){for(var e=a;e<c-1;e++)this.isClosedPath(e)&&p.throwInvalidArgumentException("cannot interpolate across closed paths");e=this.m_description.getAttributeCount();if(1!==e){var f=this.calculateSubLength2D(a,b,c,d);if(0!==f)for(let g=1;g<e;g++){const h=this.m_description.getSemantics(g);this.interpolateAttributesSemanticsImpl(h,a,b,c,d,f)}}}interpolateAttributesSemantics(a,b,c,d,e){if(0!==a){this.hasAttribute(a)||p.throwInvalidArgumentException("does not have the given attribute");
2===K.getInterpolation(a)&&p.throwInvalidArgumentException("angular interpolation");for(var f=b;f<d-1;f++)this.isClosedPath(f)&&p.throwInvalidArgumentException("cannot interpolate across closed paths");f=this.calculateSubLength2D(b,c,d,e);0!==f&&this.interpolateAttributesSemanticsImpl(a,b,c,d,e,f)}}interpolateAttributesPath(a,b,c){const d=this.m_description.getAttributeCount();if(1!==d&&b!==c){var e=this.calculatePathSubLength2D(a,b,c);for(let f=1;f<d;f++){const g=this.m_description.getSemantics(f);
this.interpolateAttributesSemanticsPathImpl(g,a,b,c,e)}}}interpolateAttributesSemanticsPath(a,b,c,d){if(0!==a){this.hasAttribute(a)||p.throwInvalidArgumentException("does not have the given attribute");2===K.getInterpolation(a)&&p.throwInvalidArgumentException("angular interpolation");var e=this.calculatePathSubLength2D(b,c,d);0!==e&&this.interpolateAttributesSemanticsPathImpl(a,b,c,d,e)}}interpolateAttributesSemanticsImpl(a,b,c,d,e,f){const g=this.querySegmentIterator();c=this.getPathStart(b)+c;
d=this.getPathStart(d)+e;e=K.getComponentCount(a);const h=Array(K.maxComponentCount());this.queryAttributeAsDbl(a,c,h,e);const k=Array(K.maxComponentCount());this.queryAttributeAsDbl(a,d,k,e);const m=Array(K.maxComponentCount());l.memcpy(m,h,0,0,e);let n=0;const q=K.getDefaultValue(a),r=K.getInterpolation(a);g.resetToVertex(c,b);do if(g.hasNextSegment()){g.nextSegment();if(g.getStartPointIndex()===d)break;this.setAttributeFromArray(a,g.getStartPointIndex(),m,e);g.previousSegment();do{b=g.nextSegment();
if(g.getEndPointIndex()===d)return;b=b.calculateLength2D();n+=b;l.interpolateArray(r,h,k,m,0,e,n/f,q);g.isClosingSegment()||this.setAttributeFromArray(a,g.getEndPointIndex(),m,e)}while(g.hasNextSegment())}while(g.nextPath())}interpolateAttributesSemanticsPathImpl(a,b,c,d,e){const f=this.querySegmentIterator(),g=K.getInterpolation(a);var h=this.getPathStart(b)+c;d=this.getPathStart(b)+d;if(d!==h){c=K.getComponentCount(a);var k=Array(K.maxComponentCount());this.queryAttributeAsDbl(a,h,k,c);var m=Array(K.maxComponentCount());
this.queryAttributeAsDbl(a,d,m,c);var n=new l.KahanSummator(0);f.resetToVertex(h,b);f.setCirculator(this.isClosedPath(b));b=K.getDefaultValue(a);h=Array(K.maxComponentCount());l.memcpy(h,k,0,0,c);var q=0===e,r=.5;do{const t=f.nextSegment();this.setAttributeFromArray(a,f.getStartPointIndex(),h,c);q||(r=t.calculateLength2D(),n.pe(r),r=n.getResult()/e);l.interpolateArray(g,k,m,h,0,c,r,b)}while(f.getEndPointIndex()!==d)}}querySegment(a,b,c){const d=this.getPathIndexFromPointIndex(a);a-=this.getPathStart(d);
a>=this.getSegmentCountPath(d)&&p.throwInvalidArgumentException("get_segment");this.getSegmentFromPath(d,a,b,c)}getSegment(a,b){const c=new this.m_segmentBufferCTor;this.getSegmentBuffer(a,c,b);return c.releaseSegment()}getSegmentType(a){const b=this.getPathIndexFromPointIndex(a);a-=this.getPathStart(b);a>=this.getSegmentCountPath(b)&&p.throwInvalidArgumentException("get_segment");return this.getSegmentTypeFromPath(b,a)}getSegmentFromPath(a,b,c,d){b=this.getPathStart(a)+b;var e=this.getSegmentFlagsStreamRef();
let f=1;e&&(f=e.read(b)&31);switch(f){case 1:c.createLine();break;case 2:c.createCubicBezier();break;case 4:c.createEllipticArc();break;case 8:c.createQuadraticRationalBezier();break;case 16:c.createQuadraticBezier();break;default:p.throwInternalErrorException("")}c=c.get();e=null;d?(e=cb(),c.assignVertexDescription(e)):c.assignVertexDescription(this.m_description);a=b===this.getPathEnd(a)-1&&this.isClosedPath(a)?this.getPathStart(a):b+1;e=this.getXY(b);c.m_XStart=e.x;c.m_YStart=e.y;e=this.getXY(a);
c.m_XEnd=e.x;c.m_YEnd=e.y;if(!d)for(let h=1,k=this.m_description.getAttributeCount();h<k;h++){d=this.m_description.getSemantics(h);e=K.getComponentCount(d);for(let m=0;m<e;m++){var g=this.getAttributeAsDbl(d,b,m);c.setStartAttribute(d,m,g);g=this.getAttributeAsDbl(d,a,m);c.setEndAttribute(d,m,g)}}db.isNonLinearSegmentFlag(f)&&(b=this.m_curveData.m_segmentParamIndex.read(b),c.readFromBufferStream(this.m_curveData.m_segmentParams,b))}replaceLinearEllipticalArcsWithTrueLines(){if(!this.hasNonLinearSegments()||
0===this.m_curveData.m_arcCount)return!1;let a=!1;for(let b=0,c=this.getPointCount();b<c;b++)if(4===this.m_curveData.m_segmentFlags.read(b)){const d=this.m_curveData.m_segmentParamIndex.read(b);this.m_curveData.m_segmentParams.readPoint2D(d+4).isNAN()&&(this.m_curveData.m_segmentFlags.write(b,1),this.m_curveData.m_segmentParamIndex.write(b,-1),this.incCurveType(4,-1),this.modifyCurveCounter(-1),a=!0)}a&&this.checkCompactSegmentParams();return a}queryPointAlongPath(a,b,c,d=!1){const e={iSegment:-1};
var f={iSegment:-1,tSegment:0};d=d?e:f;c.setEmpty();if(this.isEmpty())return e;(0>a||a>=this.getPathCount())&&p.throwInvalidArgumentException("query_point_along_path");if(0>b)return e;f=this.getPathSize(a);if(0===f)return e;if(1===f)return this.getPointByVal(this.getPathStart(a),c),d.tSegment=0,e.iSegment=this.getPathStart(a),e;f=this.querySegmentIteratorAtVertex(this.getPathStart(a));const g=new l.KahanSummator(0);for(;f.hasNextSegment();){const h=f.nextSegment(),k=h.calculateLength2D(),m=g.getResult();
g.add(k);if(g.getResult()>=b)return a=b-m,a>k&&(a=k),a=h.lengthToT(a),h.queryCoord(a,c),d.tSegment=a,e.iSegment=f.getStartPointIndex(),e}this.isClosedPath(a)?(b=this.getPathStart(a),this.getPointByVal(b,c),d.tSegment=1,e.iSegment=this.getPathEnd(a)-1):(b=this.getPathEnd(a)-1,this.getPointByVal(b,c),1<this.getPathSize(a)?(d.tSegment=1,e.iSegment=this.getPathEnd(a)-2):(d.tSegment=0,e.iSegment=this.getPathStart(a)));return e}queryPointsAlongPath(a,b,c,d,e,f){var g=0;for(var h=0;h<b;++h)d&&d[h].setEmpty(),
e&&(e[h]=-1),f&&(f[h]=0),g>c[h]&&p.throwInvalidArgumentException("query_points_along"),g=c[h];g=this.getPathSize(a);if(0===b||0===g)return 0;if(1===g)return a=this.getPathStart(a),d&&this.getPointByVal(a,d[0]),f&&(f[0]=0),e&&(e[0]=a),1;g=this.getPathStart(a);h=new l.KahanSummator(0);const k=this.querySegmentIteratorAtVertex(g);let m=0;g=0;for(var n=c[m];k.hasNextSegment();){const q=k.nextSegment(),r=q.calculateLength2D(),t=h.getResult();for(h.add(r);h.getResult()>=n;)if(n-=t,n>r&&(n=r),n=q.lengthToT(n),
d&&q.queryCoord(n,d[g]),f&&(f[g]=n),e&&(e[g]=k.getStartPointIndex()),g++,m++,n=c[m],m===b)return g}this.isClosedPath(a)?(a=this.getPathStart(a),d&&this.getPointByVal(a,d[g]),f&&(f[g]=0),e&&(e[g]=a),g++):1<this.getPathSize(a)&&(a=this.getPathEnd(a)-2,d&&this.getPointByVal(a+1,d[g]),f&&(f[g]=1),e&&(e[g]=a),g++);return g}queryPointsAlong(a,b,c,d,e){var f=0;for(var g=0;g<a;++g)c&&c[g].setEmpty(),d&&(d[g]=-1),e&&(e[g]=0),f>b[g]&&p.throwInvalidArgumentException("query_points_along"),f=b[g];if(0===a)return 0;
g=new l.KahanSummator(0);const h=this.querySegmentIterator();let k=-1,m=0;f=0;for(var n=b[m];h.nextPath();)for(;h.hasNextSegment();){k=h.getPathIndex();const q=h.nextSegment(),r=q.calculateLength2D(),t=g.getResult();for(g.add(r);g.getResult()>=n;)if(n-=t,n>r&&(n=r),n=q.lengthToT(n),c&&q.queryCoord(n,c[f]),e&&(e[f]=n),d&&(d[f]=h.getStartPointIndex()),f++,m++,n=b[m],m===a)return f}if(0>k)return 0;this.isClosedPath(k)?(a=this.getPathStart(k),c&&this.getPointByVal(a,c[f]),e&&(e[f]=0),d&&(d[f]=a),f++):
1<this.getPathSize(k)&&(a=this.getPathEnd(k)-2,c&&this.getPointByVal(a+1,c[f]),e&&(e[f]=1),d&&(d[f]=a),f++);return f}querySegmentIterator(){return new zh({parent:this})}querySegmentIteratorAtVertex(a){return new zh({parent:this,pointIndex:a})}queryPathEnvelope(a,b){this.queryPathEnvelopeImpl(a,b,!0)}queryLoosePathEnvelope(a,b){this.queryPathEnvelopeImpl(a,b,!1)}queryPathEnvelopeImpl(a,b,c){b instanceof Ya&&p.geometryReleaseAssert(0,"not implemented for Envelope");b instanceof ub&&p.geometryReleaseAssert(0,
"not implemented for Envelope3D");(a>=this.getPathCount()||0>a)&&p.throwInvalidArgumentException("");if(this.isEmpty())b.setEmpty();else{var d=this.getAttributeStreamRef(0),e=D.constructEmpty();e.setEmpty();for(let f=2*this.getPathStart(a),g=2*this.getPathEnd(a);f<g;){const h=g-f;p.geometryReleaseAssert(0===(h&1));e.mergePointsInterleaved(d,f/2,h/2);f+=h}b.setCoords({env2D:e});if(this.hasNonLinearSegmentsPath(a))if(d=this.querySegmentIterator(),d.resetToPath(a),d.nextPath())for(;d.hasNextSegment();)if(a=
d.nextCurve())e=D.constructEmpty(),c?a.queryEnvelope(e):a.queryLooseEnvelope(e),b.mergeEnvelope2D(e);else break;else p.geometryReleaseAssert(0)}}checkCompactSegmentParams(){if(!this.m_curveData||null===this.m_curveData.m_segmentParams||this.m_curveData.m_segmentParams.size()<=this.m_vertexAttributes.get(0).size())return!1;const a=Ob(4)*this.m_curveData.m_arcCount+Ob(2)*this.m_curveData.m_bezierCount+Ob(8)*this.m_curveData.m_rbezier2Count+Ob(16)*this.m_curveData.m_bezier2Count;if(this.m_curveData.m_segmentParams.size()>
Math.max(3*a>>1,10))return this.forceCompactSegmentParams(),!0;0===this.m_pointCount&&(this.m_curveData.m_curveParamWritePoint=0);return!1}forceCompactSegmentParams(){var a=0;for(let d=0,e=this.getPointCount();d<e;d++){var b=this.m_curveData.m_segmentFlags.read(d);db.isNonLinearSegmentFlag(b)&&(b=Ob(b),a+=b)}a=Lc(a);b=0;for(let d=0,e=this.getPointCount();d<e;d++){var c=this.m_curveData.m_segmentFlags.read(d);if(db.isNonLinearSegmentFlag(c)){let f=this.m_curveData.m_segmentParamIndex.read(d);this.m_curveData.m_segmentParamIndex.write(d,
b);c=Ob(c);for(let g=0;g<c;g++)a.write(b,this.m_curveData.m_segmentParams.read(f)),b++,f++}}this.m_curveData.m_segmentParams=a;this.m_curveData.m_curveParamWritePoint=b}setPathsFromJsonArrays(a,b,c){p.geometryReleaseAssert(!1===b);p.geometryReleaseAssert(!1===a);this.setEmpty();a=c.length;if(0!==a){b=0;for(var d of c)b+=d.length;var e=this.getGeometryType()===p.GeometryType.enumPolygon;d=new ic(2*b);var f=new za(a+1),g=0,h=0;for(let k=0;k<a;++k){f.write(k,g);const m=c[k],n=m.length;for(let q=0;q<
n;++q)d.write(h++,m[q][0]),d.write(h++,m[q][1]);e&&2<n&&d.read(2*g)===d.read(h-2)&&d.read(2*g+1)===d.read(h-1)&&(h-=2,b--,g--);g+=c[k].length}f.write(a,b);c=new Db(f.size());c.setRange(this.getGeometryType()===p.GeometryType.enumPolygon?1:0,0,a);c.write(a,0);this.setAttributeStreamRef(0,d);this.setPathFlagsStreamRef(c);this.setPathStreamRef(f);this.notifyModifiedFlags(65535)}}setEmpty(){this.m_curveData&&(this.removeAllCurvesFromGlobalCounter(),this.m_curveData=null);this.m_bPathStarted=!1;this.m_pathFlags=
this.m_paths=null;this.setEmptyImpl()}applyTransformation(a){this.applyTransformationToPath(a,-1)}applyTransformation3D(a){p.geometryReleaseAssert(0)}getImpl(){return this}reserve(a){this.reserveImpl(a);0<a&&!this.m_paths&&(this.m_paths=hb(0),this.m_pathFlags=new Db(0,void 0),this.m_paths.reserve(2),this.m_pathFlags.reserve(2),this.m_paths.resize(1,0),this.m_pathFlags.resize(1,0))}reserveParts(a,b){this.reserveImpl(a);0<b&&(this.m_paths?(this.m_paths.reserve(b+1),this.m_pathFlags.reserve(b+1)):(this.m_paths=
hb(0),this.m_pathFlags=new Db(0,void 0),this.m_paths.reserve(b+1),this.m_pathFlags.reserve(b+1),this.m_paths.resize(1,0),this.m_pathFlags.resize(1,0)))}clone(){const a=this.createInstance();this.copyTo(a);return a}createShallowClone(){p.geometryReleaseAssert(0);return this}queryLimitedSegmentIterator(a){return new zn(this,a)}getPathStreamRef(){this.throwIfEmpty();return this.m_paths}setPathStreamRef(a){this.m_paths=a}getSegmentFlagsStreamRef(){this.throwIfEmpty();return null!=this.m_curveData?this.m_curveData.m_segmentFlags:
null}getPathFlagsStreamRef(){this.throwIfEmpty();return this.m_pathFlags}setPathFlagsStreamRef(a){this.m_pathFlags=a}getSegmentIndexStreamRef(){this.throwIfEmpty();return null!==this.m_curveData?this.m_curveData.m_segmentParamIndex:null}getSegmentDataStreamRef(){this.throwIfEmpty();return null!==this.m_curveData?this.m_curveData.m_segmentParams:null}setSegmentData(a,b,c,d){this.m_curveData||(this.m_curveData=new yc);this.m_curveData.m_segmentFlags=c;this.m_curveData.m_segmentParams=b;this.m_curveData.m_segmentParamIndex=
a;this.m_curveData.m_curveParamWritePoint=d}static getPathIndexFromPointIndexImpl(a,b,c,d){if(0<=d&&d<b){if(c>=a.read(d)){if(c<a.read(d+1))return d;d++}else d--;if(0<=d&&d<b&&c>=a.read(d)&&c<a.read(d+1))return d}if(5>b){for(d=0;d<b;d++)if(c<a.read(d+1))return d;p.throwCorruptedGeometryException("")}d=0;for(--b;b>d;){const e=d+(b-d>>1),f=a.read(e);if(c<f)b=e-1;else if(d=a.read(e+1),c>=d)d=e+1;else return e}return d}getHighestPointIndex(a){p.geometryReleaseAssert(0<=a&&a<this.getPathCount());const b=
this.getAttributeStreamRef(0),c=this.getPathEnd(a);var d=this.getPathStart(a);a=-1;const e=new l.Point2D;e.y=Number.NEGATIVE_INFINITY;e.x=Number.NEGATIVE_INFINITY;for(d+=0;d<c;d++){const f=b.readPoint2D(2*d);-1===e.compare(f)&&(a=d,e.setCoordsPoint2D(f))}return a}applyTransformationToPath(a,b){b>=this.getPathCount()&&p.throwInvalidArgumentException("apply_transformation");if(!this.isEmpty()&&!a.isIdentity()){var c=this.m_vertexAttributes.get(0);if(0>b?this.hasNonLinearSegments():this.hasNonLinearSegmentsPath(b)){var d=
new this.m_segmentBufferCTor,e=this.getPathCount(),f=0>b?0:b;do{const h=this.getPathStart(f),k=this.getPathEnd(f),m=this.isClosedPath(f),n=c.readPoint2D(2*h);if(!this.hasNonLinearSegmentsPath(f)){c.applyTransformation(a,2*h,k-h);continue}const q=l.Point2D.getNAN();for(let r=h;r<k;++r)if(1!==(this.m_curveData.m_segmentFlags.read(r)&31)){var g=m&&r+1===k;g&&c.writePoint2D(2*h,n);this.getSegmentBuffer(r,d,!0);d.get().applyTransformation(a);const t=this.m_curveData.m_segmentParamIndex.read(r);d.get().writeInBufferStream(this.m_curveData.m_segmentParams,
t);c.writePoint2D(2*r,d.get().getStartXY());g&&c.writePoint2D(2*h,d.get().getEndXY())}else g=2*r,c.queryPoint2D(g,q),a.transformInPlace(q),c.writePoint2D(g,q);if(f===b)break}while(++f<e)}else 0>b?(d=0,b=this.m_pointCount):(d=this.getPathStart(b),b=this.getPathEnd(b)),c.applyTransformation(a,2*d,b-d);this.notifyModifiedFlags(2001)}}calculateSubLength2D(a,b,c,d){b=this.getPathStart(a)+b;c=this.getPathStart(c)+d;(c<b||0>b||c>this.getPointCount()-1)&&p.throwInvalidCallException("");d=this.querySegmentIterator();
let e=0;d.resetToVertex(b,a);do{for(;d.hasNextSegment();){a=d.nextSegment();if(d.getStartPointIndex()===c)break;a=a.calculateLength2D();e+=a}if(d.getStartPointIndex()===c)break}while(d.nextPath());return e}calculatePathSubLength2D(a,b,c){b=this.getPathStart(a)+b;c=this.getPathStart(a)+c;(0>b||c>this.getPointCount()-1)&&p.throwInvalidCallException("");const d=this.querySegmentIterator();b>c&&(this.isClosedPath(a)||p.throwInvalidArgumentException("cannot iterate across an open path"),d.setCirculator(!0));
if(b===c)return 0;let e=0,f=0;d.resetToVertex(b,a);do f+=e,e=d.nextSegment().calculateLength2D();while(d.getStartPointIndex()!==c);return f}calculateEnvelope2D(a){p.geometryReleaseAssert(0);return new D(0,0,0,0)}updateXYImpl(a){const b=super.updateXYImpl(a);if(this.hasNonLinearSegments()){const c=D.constructEmpty(),d=this.querySegmentIterator();for(;d.nextPath();)for(;d.hasNextSegment();){const e=d.nextCurve();if(e)a?e.queryEnvelope(c):e.queryLooseEnvelope(c),b.mergeEnvelope2D(c);else break}}return b}notifyModifiedAllImpl(){null!==
this.m_paths&&this.m_paths.size()?this.m_pointCount=this.m_paths.read(this.m_paths.size()-1):this.m_pointCount=0}setDirtyOGCFlags(a){this.setDirtyFlagProtected(16,a)}hasDirtyOGCStartFlags(){return this.hasDirtyFlag(16)}setDirtyRingAreas2D(a){this.setDirtyFlagProtected(1024,a)}hasDirtyRingAreas2D(){return this.hasDirtyFlag(1024)}static isNonLinearSegmentFlag(a){return 0===(a&1)}addAndExplicitlyOpenAllPaths(a,b){this===a&&p.throwInvalidArgumentException("Multi_path_impl::add");let c=this.getPathCount();
for(let d=0,e=a.getPathCount();d<e;d++)this.addPath(a,d,!b),this.openPathAndDuplicateStartVertex(c),c++}getSegmentFlags(a){return null!==this.m_curveData&&null!==this.m_curveData.m_segmentFlags?this.m_curveData.m_segmentFlags.read(a):1}getSegmentBuffer(a,b,c){const d=this.getPathIndexFromPointIndex(a);a-=this.getPathStart(d);a>=this.getSegmentCountPath(d)&&p.throwInvalidArgumentException("getSegmentBuffer");this.getSegmentFromPath(d,a,b,c)}getSegmentTypeFromPath(a,b){a=this.getPathStart(a)+b;b=this.getSegmentFlagsStreamRef();
let c=1;b&&(c=b.read(a)&31);switch(c){case 1:return p.GeometryType.enumLine;case 2:return p.GeometryType.enumBezier;case 4:return p.GeometryType.enumEllipticArc;case 8:return p.GeometryType.enumRationalBezier2;case 16:return p.GeometryType.enumBezier2;default:p.throwInternalErrorException("")}}ensureXYMonotoneSegments(){if(!this.m_curveData)return!1;let a=!1;for(let c=0,d=this.getPathCount();c<d;c++){const e=this.getPathStart(c),f=this.getPathEnd(c),g=f-e;for(let h=e;h<f;h++){var b=this.m_curveData.m_segmentFlags.read(h)&
31;if(1===b)continue;2!==b&&p.throwNotImplementedException("ensure_xy_monotone_segments");b=(h-e+1)%g+e;const k=this.m_curveData.m_segmentParamIndex.read(h),m=l.makeObjectArray(l.Point2D,4);m[0]=this.getXY(h);m[3]=this.getXY(b);m[1].x=this.m_curveData.m_segmentParams.read(k);m[1].y=this.m_curveData.m_segmentParams.read(k+1);m[2].x=this.m_curveData.m_segmentParams.read(k+2);m[2].y=this.m_curveData.m_segmentParams.read(k+3);Se(m)&&(a=!0,this.m_curveData.m_segmentParams.write(k,m[1].x),this.m_curveData.m_segmentParams.write(k+
1,m[1].y),this.m_curveData.m_segmentParams.write(k+2,m[2].x),this.m_curveData.m_segmentParams.write(k+3,m[2].y))}}a&&this.notifyModifiedFlags(2001);return a}buildRasterizedGeometryAccelerator(a,b){return!1}buildQuadTreeAccelerator(a){this.m_accelerators||(this.m_accelerators=new Ah);if(null!==this.m_accelerators.getQuadTree())return!0;this.ensureUniqueAccelerators();this.m_accelerators.setQuadTree(null);a=fd(this);this.m_accelerators.setQuadTree(a);return!0}buildQuadTreeForPathsAccelerator(a){this.m_accelerators||
(this.m_accelerators=new Ah);if(null!==this.m_accelerators.getQuadTreeForPaths())return!0;this.ensureUniqueAccelerators();this.m_accelerators.setQuadTreeForPaths(null);a=new D;this.queryLooseEnvelope(a);a.inflateCoords(1,1);{const f=new D;this.queryLooseEnvelope(f);if(f.isEmpty())a=null;else{this.getGeometryType();var b=new fb(f,8),c=-1,d=new D,e=!1;do for(let g=0,h=this.getPathCount();g<h;g++)if(this.queryLoosePathEnvelope(g,d),d.isIntersecting(a))if(c=b.insertEx(g,d,c),-1===c){e&&p.throwInternalErrorException("build_quad_tree_for_paths");
f.assign(this.calculateEnvelope2D(!1));e=!0;b.reset(f,8);break}else e=!1;while(e);a=b}}this.m_accelerators.setQuadTreeForPaths(a);return!0}updateCurveCounter(a){this.modifyCurveCounter(a-this.getCurveCount())}removeAllCurvesFromGlobalCounter(){this.m_curveData&&(db.st_totalCurveCount-=this.m_curveData.m_curveCount,this.m_curveData.m_curveCount=0,this.m_curveData.m_bezierCount=0,this.m_curveData.m_arcCount=0,this.m_curveData.m_bezier2Count=0,this.m_curveData.m_rbezier2Count=0,this.m_curveData.m_curveParamWritePoint=
0)}modifyCurveCounter(a){a&&(this.m_curveData||(this.m_curveData=new yc),db.st_totalCurveCount+=a,this.m_curveData.m_curveCount+=a)}getCurveCount(){return this.m_curveData?this.m_curveData.m_curveCount:0}incCurveType(a,b){this.m_curveData||(this.m_curveData=new yc);a&2?this.m_curveData.m_bezierCount+=b:a&4?this.m_curveData.m_arcCount+=b:a&8?this.m_curveData.m_rbezier2Count+=b:a&16&&(this.m_curveData.m_bezier2Count+=b)}getCurveWritePoint(){p.geometryReleaseAssert(0);return 0}initSegmentData(a){null===
this.m_curveData&&(this.m_curveData=new yc);const b=0<this.m_reservedPointCount?this.m_reservedPointCount:this.m_pointCount;null===this.m_curveData.m_segmentParamIndex&&(this.m_curveData.m_segmentFlags=new Db(b,1),this.m_curveData.m_segmentParamIndex=hb(b,-1));a=this.m_curveData.m_curveParamWritePoint+a;null===this.m_curveData.m_segmentParams?this.m_curveData.m_segmentParams=Lc(a):a!==this.m_curveData.m_segmentParams.size()&&this.m_curveData.m_segmentParams.resize(a,0);this.m_curveData.m_segmentFlags.size()<
b&&(this.m_curveData.m_segmentFlags.resize(b,1),this.m_curveData.m_segmentParamIndex.resize(b,-1))}updateCurveWritePoint(a){null===this.m_curveData&&(this.m_curveData=new yc);this.m_curveData.m_curveParamWritePoint=a}updateOGCFlagsHelper(){const a=this.getPathCount();if(0!==a){var b=this.m_pathFlags,c=0;for(let d=0;d<a;d++){const e=this.m_cachedRingAreas2D.read(d);0===c&&(c=l.sign(e));0<e*c||0===c?b.setBits(d,8):b.clearBits(d,8)}}}updateOGCFlagsProtected(){this.hasDirtyFlag(16)&&(this.updateRingAreas2DProtected(),
this.updateOGCFlagsHelper(),this.setDirtyFlagProtected(16,!1))}replaceSegment(a,b,c){(0>a||a>=this.getPointCount())&&p.throwInvalidArgumentException("Multi_path_impl.replace_segment");p.geometryReleaseAssert(b.isCurve());var d=this.getPathIndexFromPointIndex(a),e=this.getPathStart(d);d=(a-e+1)%this.getPathSize(d)+e;e=this.getXY(a);var f=this.getXY(d);e=!e.isEqualPoint2D(b.getStartXY())||!f.isEqualPoint2D(b.getEndXY());p.geometryReleaseAssert(!e);e=b.getDescription();this.mergeVertexDescription(e);
e=new Y({vd:e,attribBuffer:Array(32),initDefaultValues:!1});f=null===this.m_curveData?1:this.m_curveData.m_segmentFlags.read(a)&31;var g=Ob(f);const h=Wf(b);let k=!1;g>=h?(p.geometryReleaseAssert(null!==this.m_curveData),k=!0,g=this.m_curveData.m_segmentParamIndex.read(a)):(this.initSegmentData(h),k=!1,g=this.m_curveData.m_curveParamWritePoint);var m=b.getGeometryType();m=yc.toSegType(m);c||(b.queryStart(e),this.setPointByVal(a,e),b.queryEnd(e),this.setPointByVal(d,e));this.m_curveData.m_segmentParamIndex.write(a,
1!==m?g:-1);this.m_curveData.m_segmentFlags.write(a,m);1!==m&&b.writeInBufferStream(this.m_curveData.m_segmentParams,g);k||(this.m_curveData.m_curveParamWritePoint+=h);f!==m&&(this.incCurveType(f,-1),this.incCurveType(m,1),this.modifyCurveCounter(1===f?1:-1))}verifyPathIndex(a){p.geometryReleaseAssert(0)}setAttributeImpl(a,b,c){this.addAttribute(a);this.isEmpty()||(this.hasNonLinearSegments()&&0===a?((0>b||1<b)&&p.throwInvalidArgumentException(""),a=new l.Transformation2D,a.setShiftCoords(0===b?c:
0,0===b?0:1),0===b?a.xx=0:a.yy=0,this.applyTransformation(a)):super.setAttributeImpl(a,b,c))}}db.st_totalCurveCount=0;class zn{constructor(a,b){this.m_qtIter=this.m_quadTree=this.m_segIter=null;this.m_extentOfInterest=new D(b);this.m_bfirst=!0;this.m_prevIndex=-100;this.m_parent=a}nextSegment(){this.m_bfirst&&this.prepare_();return this.m_quadTree?this.nextSegmentQt():this.nextSegmentNoQt()}getPathIndex(){return this.m_segIter.getPathIndex()}getStartPointIndex(){return this.m_segIter.getStartPointIndex()}getEndPointIndex(){return this.m_segIter.getEndPointIndex()}isClosingSegment(){return this.m_segIter.isClosingSegment()}isPathClosed(){return this.m_segIter.isPathClosed()}prepare_(){const a=
this.m_parent.getAccelerators();a&&(this.m_quadTree=a.getQuadTree())&&(this.m_qtIter=this.m_quadTree.getSortedIterator(this.m_extentOfInterest,0));this.m_segIter=this.m_parent.querySegmentIterator()}nextSegmentQt(){this.m_bfirst=!1;var a=this.m_qtIter.next();if(-1===a)return null;a=this.m_quadTree.getElement(a);if(a!==this.m_prevIndex+1||this.m_segIter.isLastSegmentInPath())this.m_segIter.resetToVertex(a,this.m_segIter.getPathIndex()),this.m_prevIndex=a;return this.m_segIter.nextSegment()}nextSegmentNoQt(){do{if(!this.m_bfirst&&
this.m_segIter.hasNextSegment()){const a=this.m_segIter.nextSegment(),b=D.constructEmpty();a.queryLooseEnvelope(b);if(!b.isIntersecting(this.m_extentOfInterest))continue;return a}this.m_bfirst=!1;if(!this.m_segIter.nextPath())return null}while(1)}}class ma extends db{constructor(a){a?a.vd?(super({vd:a.vd,bPolygon:!1}),this.m_segmentBufferCTor=W):a.copy?(super({vd:a.copy.getDescription(),bPolygon:!1}),this.m_segmentBufferCTor=W,a.copy.copyTo(this)):a.move?(super({move:a.move}),this.m_segmentBufferCTor=
W):a.start?(super({vd:a.start.getDescription(),bPolygon:!1}),this.m_segmentBufferCTor=W,this.startPathPoint(a.start),this.lineToPoint(a.end)):a.path?(super({bPolygon:!1}),this.m_segmentBufferCTor=W,this.addPathPoint2D(a.path,a.pointCount,a.bForward)):p.geometryReleaseAssert(0):(super({bPolygon:!1}),this.m_segmentBufferCTor=W)}getBoundary(){return Qb(this)}assignCopy(a){this!==a&&a.copyTo(this);return this}assignMove(a){a.copyTo(this);return this}getGeometryType(){return ma.type}getDimension(){return 1}createInstance(){return new ma({vd:this.getDescription()})}equals(a,
b){return this.equalsBase(a,b)}}ma.type=p.GeometryType.enumPolyline;var Cc=p.GeometryType;const jh=l.geometryPi/180,tf=180/l.geometryPi;class Hb extends we{constructor(a){void 0===a||l.isOnlyProperty(a,"vd")?(super({vd:a?.vd,XStart:0,YStart:0,XEnd:0,YEnd:0}),this.m_semiMajorAxis=0,this.m_minorMajorRatio=1,this.m_rotation=0,this.m_cosr=1,this.m_sinr=0,this.m_center=new l.Point2D(0,0),this.m_startAngle=this.m_sweepAngle=0,this.m_interior=new l.Point2D(0,0),this.m_bits=0):a.copy?(super(a),this!==a.copy&&
(this.m_center=new l.Point2D(0,0),this.m_interior=new l.Point2D(0,0),a.copy.copyToImpl(this))):a.move?(super(a),this.m_semiMajorAxis=a.move.m_semiMajorAxis,this.m_minorMajorRatio=a.move.m_minorMajorRatio,this.m_rotation=a.move.m_rotation,this.m_cosr=a.move.m_cosr,this.m_sinr=a.move.m_sinr,this.m_center=a.move.m_center.clone(),this.m_sweepAngle=a.move.m_sweepAngle,this.m_startAngle=a.move.m_startAngle,this.m_interior=a.move.m_interior.clone(),this.m_bits=a.move.m_bits,this.m_cachedValues=a.move.m_cachedValues,
a.move.m_cachedValues=null):a.fromPoint?(super({XStart:0,YStart:0,XEnd:0,YEnd:0}),this.m_center=new l.Point2D(0,0),this.m_interior=new l.Point2D(0,0),this.constructCircularArcThreePoint(a.fromPoint,a.toPoint,a.interiorPoint)):a.center?(super({XStart:0,YStart:0,XEnd:0,YEnd:0}),this.m_center=new l.Point2D(0,0),this.m_interior=new l.Point2D(0,0),this.constructCircleRadius(a.radius,a.center,a.bIsCounterClockwise)):a.semiMajorAxis&&(super({XStart:0,YStart:0,XEnd:0,YEnd:0}),this.constructEllipticArcEndPoints(a.fromPoint,
a.toPoint,a.semiMajorAxis,a.minorMajorRatio,a.axisXRotationRad,a.bBigArc,a.bIsCounterClockwise))}getBoundary(){return Qb(this)}assignMove(a){p.geometryReleaseAssert(0);return this}assignCopy(a){this!==a&&a.copyTo(this);return this}constructCircleRadius(a,b,c=!1){this.constructEllipse(a,1,b,0,c);this.setProjectionBehavior(0);this.afterCompletedModification();return this}constructCircleCenterAndPoint(a,b,c=!1){const d=l.Point2D.distance(a,b);this.constructEllipticArcEndPointsCenter(b,b,d,1,0,!0,c,a);
this.setProjectionBehavior(0);this.afterCompletedModification();return this}constructTwoPointCircle(a,b,c=!1){b=l.Point2D.lerp(a,b,.5);this.constructCircleCenterAndPoint(b,a,c);return this}constructLineEllipticArc(a,b){Tb(this,a,b,1);return this}constructLineCircularArc(a,b){Tb(this,a,b,0);return this}constructEllipse(a,b,c,d,e=!1){this.m_semiMajorAxis=Math.abs(a);this.m_minorMajorRatio=Math.abs(b);1<this.m_minorMajorRatio&&(this.m_semiMajorAxis*=this.m_minorMajorRatio,this.m_minorMajorRatio=1/this.m_minorMajorRatio);
a=new l.Point2D(0,this.m_minorMajorRatio*this.m_semiMajorAxis);a.rotateDirect(Math.cos(d),Math.sin(d));a.addThis(c);this.constructEllipticArcEndPointsCenter(a,a,this.m_semiMajorAxis,this.m_minorMajorRatio,d,!0,e,c);return this}inflate(a){if(!this.isDegenerateToLine()){var b=this.getSemiMinorAxis()+a;b=0>=b?0:(this.getSemiMajorAxis()+a)/this.getSemiMajorAxis();if(this.isCircular())a=new l.Transformation2D,a.setShiftCoords(-this.m_center.x,-this.m_center.y),a.scale(b,b),a.shiftCoords(this.m_center.x,
this.m_center.y),this.applyTransformation(a);else{a=new l.Transformation2D;this.canonicToWorldTransformation(a);const c=a.clone();c.invertPreciseThis();c.scale(b,b);c.multiply(a);this.applyTransformation(c)}}}constructEnclosingCircle(a,b,c=!1){0===b&&p.throwInvalidArgumentException("construct_enclosing_circle");const d=[0,0,0];b=Tk(a,b,d);if(1===b)this.constructCircleRadius(0,a[d[0]],c);else if(2===b){b=l.Point2D.lerp(a[d[0]],a[d[1]],.5);var e=l.Point2D.distance(a[d[0]],b);a=l.Point2D.distance(a[d[1]],
b);this.constructCircleRadius(Math.max(e,a),b,c)}else if(3===b){b=l.Point2D.calculateCircleCenterFromThreePoints(a[d[0]],a[d[1]],a[d[2]]);e=l.Point2D.distance(a[d[0]],b);const f=l.Point2D.distance(a[d[1]],b);a=l.Point2D.distance(a[d[2]],b);this.constructCircleRadius(Math.max(e,f,a),b,c)}else p.throwInternalErrorException("unexpected");return this}constructThreePointCircle(a,b,c,d=!1){if(a.equals(b)||b.equals(c)||a.equals(c))return a=a.clone(),b=b.clone(),c=c.clone(),a.equals(b)&&b.assign(c),this.constructTwoPointCircle(a,
b,d);const e=l.Point2D.calculateCircleCenterFromThreePoints(a,b,c);if(!e.isFinite()||!Number.isFinite(l.Point2D.distance(a,e))){const f=l.Point2D.distance(a,b),g=l.Point2D.distance(a,c);this.constructLineCircularArc(a,f>=g?b:c)}return this.constructCircleCenterAndPoint(e,a,d)}constructCircularArcThreePoint(a,b,c){var d=new l.ECoordinate(a.x),e=new l.ECoordinate(b.x),f=new l.ECoordinate(c.x),g=new l.ECoordinate(a.y),h=new l.ECoordinate(b.y),k=new l.ECoordinate(c.y),m=new l.ECoordinate(.5);e=e.subE(d);
h=h.subE(g);f=f.subE(d);const n=k.subE(g);k=e.mulE(n).subThisE(h.mulE(f));k.scaleError(10);if(k.isZero()){if(e.isZero()&&h.isZero())g=a.clone().addThis(b).mulThis(.5).addThis(c).mulThis(.5),e=c.sub(g).length(),this.constructEllipticArcEndPointsCenter(a,b,e,1,0,!0,!1,g),this.m_interior.assign(c);else return Tb(this,a,b,0),this;this.setProjectionBehavior(0);return this}var q=e.sqr().addThisE(h.sqr()).mulThisE(m);m=f.sqr().addThisE(n.sqr()).mulThisE(m);h=q.mulE(n).subThisE(m.mulE(h));m=e.mulE(m).subThisE(f.mulE(q));
h.divThisE(k);m.divThisE(k);e=h.sqr().addThisE(m.sqr());e.sqrtThis();d=h.addE(d);g=m.addE(g);f=a.x-d.value();k=a.y-g.value();m=Math.atan2(k,f);f=b.x-d.value();k=b.y-g.value();h=Math.atan2(k,f);f=c.x-d.value();k=c.y-g.value();k=Math.atan2(k,f);for(q=k-2*l.pi();q<m;)q+=2*l.pi();for(f=h-2*l.pi();f<q;)f+=2*l.pi();for(k+=2*l.pi();k>m;)k-=2*l.pi();for(h+=2*l.pi();h>k;)h-=2*l.pi();m=f-m<m-h?f-m:h-m;g=new l.Point2D(d.value(),g.value());this.constructEllipticArcEndPointsCenter(a,b,e.value(),1,0,Math.abs(m)>
l.pi(),0<m,g);this.m_interior.assign(c);this.setProjectionBehavior(0);this.afterCompletedModification();return this}constructCircularArc(a,b,c,d){this.constructEllipticArcGeneral(a,1,b,c,d,0);this.setProjectionBehavior(0);this.afterCompletedModification();return this}constructEllipticArcEndPoints(a,b,c,d,e,f,g){return $k(this,a,b,c,d,e,f,g)}constructEllipticArcEndPointsCenter(a,b,c,d,e,f,g,h){return $k(this,a,b,c,d,e,f,g,h)}constructEllipticArcGeneral(a,b,c,d,e,f){this.m_semiMajorAxis=Math.abs(a);
this.m_minorMajorRatio=Math.abs(b);1<this.m_minorMajorRatio&&(this.m_semiMajorAxis*=this.m_minorMajorRatio,this.m_minorMajorRatio=1/this.m_minorMajorRatio);a=aj(f);b=Math.cos(a);f=Math.sin(a);const g=new l.Point2D(this.m_semiMajorAxis,this.m_minorMajorRatio*this.m_semiMajorAxis),h=l.Point2D.getNAN();d=aj(d);h.x=g.x*Math.cos(d);h.y=g.y*Math.sin(d);h.rotateDirect(b,f);h.addThis(c);let k=e=l.snapMagnitude(e,l.twoPi());Math.abs(k)===l.twoPi()&&(k=0);const m=l.Point2D.getNAN();m.x=g.x*Math.cos(d+k);m.y=
g.y*Math.sin(d+k);m.rotateDirect(b,f);m.addThis(c);return this.constructEllipticArcEndPointsCenter(h,m,this.m_semiMajorAxis,this.m_minorMajorRatio,a,Math.abs(e)>l.pi(),0<e,c)}constructEllipticArcAsNURB(a,b,c,d){(1<=d||0>d)&&p.throwInvalidArgumentException("construct_elliptic_arc_as_NURB: weight");b.isFinite()||p.throwInvalidArgumentException("construct_elliptic_arc_as_NURB: control_point");xf([a,b,c],d*d,null,!1,this);return this}constructCanonic(a){p.geometryReleaseAssert(0);return this}isCircular(){return 1===
this.m_minorMajorRatio&&0===this.m_rotation&&!this.isDegenerateToLine()}isDegenerateToLineHelper(a){return Tf(this,[a])?Ha(this):!1}isDegenerateToLine(){return Ha(this)}getCenter(){return this.m_center.clone()}setCenter(a){p.geometryReleaseAssert(0)}getAxisXRotation(){return this.m_rotation}getSemiAxes(){return l.Point2D.construct(this.m_semiMajorAxis,this.m_semiMajorAxis*this.m_minorMajorRatio)}getSemiMajorAxis(){return this.m_semiMajorAxis}getSemiMinorAxis(){return this.m_semiMajorAxis*this.m_minorMajorRatio}getMinorMajorRatio(){return this.m_minorMajorRatio}isClockwise(){return 0===
(this.m_bits&1)}isMajor(){return 0!==(this.m_bits&2)}getSweepAngle(){return this.m_sweepAngle}getStartAngle(){return this.m_startAngle}getEndAngle(){return this.m_startAngle+this.m_sweepAngle}getGeometryType(){return p.GeometryType.enumEllipticArc}queryEnvelope(a){if(a instanceof Ya){a.setEmpty();a.assignVertexDescription(this.m_description);var b=D.constructEmpty();this.queryEnvelope(b);a.setEnvelope(b);for(let c=1,d=this.m_description.getAttributeCount();c<d;c++){b=this.m_description.getSemantics(c);
for(let e=0,f=K.getComponentCount(b);c<f;c++){const g=this.queryInterval(b,e);a.setIntervalEnvelope(b,e,g)}}}else a instanceof D?gl(this,l.Envelope1D.unit(),a):p.geometryReleaseAssert(0)}applyTransformation(a){qh(this,a,!1)}createInstance(){return new Hb}calculateLength2D(){if(Ha(this))var a=1*l.Point2D.distance(this.getStartXY(),this.getEndXY());else 1===this.m_minorMajorRatio?a=Math.abs(-1*this.getSweepAngle())*this.m_semiMajorAxis:(a=rh(this,0),a=rh(this,1)-a);return a}queryCoord2D(a,b){if(Ha(this)){var c=
this.getStartXY(),d=this.getEndXY();l.lerpPoint2D(c,d,a,b)}else 0===a?b.assign(l.Point2D.construct(this.m_XStart,this.m_YStart)):1===a?b.assign(l.Point2D.construct(this.m_XEnd,this.m_YEnd)):(a=mc(this,a),a=new l.Point2D(this.m_semiMajorAxis*Math.cos(a),this.getSemiMinorAxis()*Math.sin(a)),a.rotateDirect(this.m_cosr,this.m_sinr),a.addThis(this.m_center),b.assign(a))}queryCoord2DE(a,b){if(Ha(this)){var c=new Z({start:this.getStartXY(),end:this.getEndXY()});Wh(c,a,b)}else if(0===a.value())b.set(this.getStartXY());
else if(1===a.value())b.set(this.getEndXY());else{var d=new l.ECoordinate;d.assign((new l.ECoordinate(this.m_startAngle)).addE(a.mulE(new l.ECoordinate(this.m_sweepAngle))));a=new l.ECoordinate;c=new l.ECoordinate;l.ECoordinate.st_cosAndSin(d,a,c);d=S.constructCoordsE((new l.ECoordinate(this.m_semiMajorAxis)).mulThisE(a),(new l.ECoordinate(this.m_semiMajorAxis)).mulThis(this.m_minorMajorRatio).mulThisE(c));const e=new l.ECoordinate(this.m_rotation);l.ECoordinate.st_cosAndSin(e,a,c);d.rotateDirect(a,
c);d.addThisE(S.constructPoint2D(this.m_center));b.setE(d)}}getCoordX(a){const b=new l.Point2D;this.queryCoord2D(a,b);return b.x}getCoordY(a){const b=new l.Point2D;this.queryCoord2D(a,b);return b.y}cut(a,b,c){const d=new W;this.queryCut(a,b,d,c);return d.releaseSegment()}queryCut(a,b,c,d){c=c.createEllipticArc();var e=0===a&&1===b;if(e&&!d)this.copyTo(c);else{var f=l.Point2D.getNAN();this.queryCoord2D(a,f);var g=l.Point2D.getNAN();this.queryCoord2D(b,g);if(!e)if(f.equals(g)).5<b-a&&this.isMajor()&&
this.isClosed()?(e=!0,a=0,b=1):1===b?a=b:b=a;else if(0<a&&f.isEqual(this.m_XStart,this.m_YStart)&&(a=0),1>b&&g.isEqual(this.m_XEnd,this.m_YEnd)&&(b=1),(e=0===a&&1===b)&&!d){this.copyTo(c);return}c.m_center.assign(this.m_center);c.m_semiMajorAxis=this.m_semiMajorAxis;c.m_minorMajorRatio=this.m_minorMajorRatio;c.m_interior.assign(this.m_interior);c.m_rotation=this.m_rotation;c.m_cosr=this.m_cosr;c.m_sinr=this.m_sinr;c.m_sweepAngle=this.m_sweepAngle;c.m_startAngle=this.m_startAngle;c.m_bits=this.m_bits;
d=f.y;c.m_XStart=f.x;c.m_YStart=d;d=g.y;c.m_XEnd=g.x;c.m_YEnd=d;if(e)c.m_cachedValues=this.m_cachedValues;else{c.m_startAngle=mc(this,a);c.m_sweepAngle=mc(this,b)-c.m_startAngle;c.m_startAngle=Yc(c.m_startAngle);Fd(c,Math.abs(c.m_sweepAngle)>l.pi());c.assignVertexDescription(this.m_description);re(c);oh(c);e=this.m_description.getAttributeCount();if(1<e){for(g=1;g<e;g++){d=this.m_description.getSemantics(g);f=K.getComponentCount(d);for(var h=0;h<f;h++){const k=this.getAttributeAsDbl(a,d,h);c.setStartAttribute(d,
h,k)}}for(a=1;a<e;a++)for(g=this.m_description.getSemantics(a),d=K.getComponentCount(g),f=0;f<d;f++)h=this.getAttributeAsDbl(b,g,f),c.setEndAttribute(g,f,h)}c.afterCompletedModification()}}}queryDerivative(a,b){p.geometryReleaseAssert(0)}cutArcIgnoreAttributes(a,b,c){let d=0===a&&1===b;var e=new l.Point2D;this.queryCoord2D(a,e);const f=new l.Point2D;this.queryCoord2D(b,f);d||(e.equals(f)?.5<b-a&&this.isMajor()&&this.isClosed()?(d=!0,a=0,b=1):1===b?a=b:b=a:(0<a&&e.isEqual(this.m_XStart,this.m_YStart)&&
(a=0),1>b&&f.isEqual(this.m_XEnd,this.m_YEnd)&&(b=1),d=0===a&&1===b));c.m_center.assign(this.m_center);c.m_semiMajorAxis=this.m_semiMajorAxis;c.m_minorMajorRatio=this.m_minorMajorRatio;c.m_interior.assign(this.m_interior);c.m_rotation=this.m_rotation;c.m_cosr=this.m_cosr;c.m_sinr=this.m_sinr;c.m_sweepAngle=this.m_sweepAngle;c.m_startAngle=this.m_startAngle;c.m_bits=this.m_bits;var g=e.y;c.m_XStart=e.x;c.m_YStart=g;e=f.y;c.m_XEnd=f.x;c.m_YEnd=e;d?c.m_cachedValues=this.m_cachedValues:(c.m_startAngle=
mc(this,a),c.m_sweepAngle=mc(this,b)-c.m_startAngle,c.m_startAngle=Yc(c.m_startAngle),Fd(c,Math.abs(c.m_sweepAngle)>Math.PI),re(c),c.afterCompletedModification())}changeEndPoints2D(a,b){Yk(this,a,b,!1)}getAttributeAsDbl(a,b,c){if(0===b)return 0===c?this.getCoordX(a):this.getCoordY(a);if(0===a)return this.getStartAttributeAsDbl(b,c);if(1===a)return this.getEndAttributeAsDbl(b,c);var d=this.calculateLength2D();a=0<d?this.tToLength(a)/d:0;d=K.getInterpolation(b);const e=this.getStartAttributeAsDbl(b,
c);c=this.getEndAttributeAsDbl(b,c);return l.interpolate(d,e,c,a,K.getDefaultValue(b))}getClosestCoordinate(a,b){return hl(this,a,l.Envelope1D.unit(),b)}getClosestCoordinateOnInterval(a,b,c){return hl(this,a,b,!1)}getYMonotonicParts(a,b=!1){2>a.length&&p.throwInvalidArgumentException("");var c=this.getSemiAxes(),d=Math.atan2(c.y*this.m_cosr,c.x*this.m_sinr),e=d+l.pi();c=Array(3);let f=0;c[0]=Ja(this,d);0<c[0]&&1>c[0]&&f++;c[1]=Ja(this,e);0<c[1]&&1>c[1]&&(c[f]=c[1],f++);if(0===f)return 0;c[f]=1;f++;
p.geometryReleaseAssert(a.length>=f);d=0;for(e=0;e<f;e++){const g=c[e];this.queryCut(d,g,a[e],b);d=g}return f}getMonotonicParts(a,b){4>a.length&&p.throwInvalidArgumentException("");if(this.isDegenerateToLine())return a[0].createEllipticArc().assignCopy(this),b&&a[0].get().dropAllAttributes(),1;var c=this.getSemiAxes(),d=Array(4);d[0]=Math.atan2(c.y*this.m_cosr,c.x*this.m_sinr);d[1]=d[0]+l.pi();d[2]=Math.atan2(-c.y*this.m_sinr,c.x*this.m_cosr);d[3]=d[2]+l.pi();c=Array(5);let e=0;for(var f=0;4>f;f++)c[e]=
Ja(this,d[f]),0<c[e]&&1>c[e]&&e++;if(0===e)return 0;l.numericSortRange(c,e);1>c[e-1]&&(c[e]=1,e++);p.geometryReleaseAssert(a.length>=e);d=0;for(f=0;f<e;f++){const g=c[f];this.queryCut(d,g,a[f],b);d=g}return e}intersectionWithAxis2D(a,b,c,d){if(Ha(this))return(new Z({start:this.getStartXY(),end:this.getEndXY()})).intersectionWithAxis2D(a,b,c,d);const e=new l.ECoordinate(b);var f=this.getSemiAxes();if(a){if(b>this.m_center.y+f.x||b<this.m_center.y-f.x)return 0;b=(new l.ECoordinate(f.x)).mulThis(this.m_sinr);
f=(new l.ECoordinate(f.y)).mulThis(this.m_cosr);e.subThis(this.m_center.y)}else{if(b>this.m_center.x+f.x||b<this.m_center.x-f.x)return 0;b=(new l.ECoordinate(f.x)).mulThis(this.m_cosr);f=(new l.ECoordinate(f.y)).mulThis(-this.m_sinr);e.subThis(this.m_center.x)}var g=b.sqr(),h=f.sqr(),k=g.addE(h),m=f.mulE(e).mulThis(-2),n=e.sqr().subThisE(g);g=m.sqr().subThisE(k.mulE(n).mulThis(4));var q=b.mulE(e).mulThis(-2);h=e.sqr().subThisE(h);var r=q.sqr().subThisE(k.mulE(h).mulThis(4));(g=g.eps()*Math.abs(r.value())<=
r.eps()*Math.abs(g.value()))?b.isZero()&&(g=!1):f.isZero()&&(g=!0);g||(m.setE(q),n.setE(h));q=l.makeObjectArray(l.ECoordinate,2);h=l.Envelope1D.construct(-1,1);k=tb(k,m,n,h,!1,q);if(0===k)return 0;m=[0,0];n=0;for(h=0;h<k;h++){r=new l.ECoordinate;const t=new l.ECoordinate;g?(r.setE(q[h]),t.setE(e.subE(f.mulE(q[h])).divThisE(b))):(t.setE(q[h]),r.setE(e.subE(b.mulE(q[h])).divThisE(f)));r=Math.atan2(r.value(),t.value());r=Ja(this,r);0<=r&&1>=r&&(m[n]=r,n++)}k=n;if(0===k)return 0;2===k&&m[0]>m[1]&&(m[1]=
l.swap(m[0],m[0]=m[1]));d&&l.memcpy(d,m,0,0,k);c&&(c[0]=a?this.getCoordX(m[0]):this.getCoordY(m[0]),1<k&&(c[1]=a?this.getCoordX(m[1]):this.getCoordY(m[1]),!d&&c[0]>c[1]&&(c[1]=l.swap(c[0],c[0]=c[1]))));return k}intersectionOfYMonotonicWithAxisX(a,b){if(this.m_YStart===this.m_YEnd)return a===this.m_YStart?b:Number.NaN;if(a===this.m_YStart)return this.m_XStart;if(a===this.m_YEnd)return this.m_XEnd;const c=[0,0];return-1===this.intersectionWithAxis2D(!0,a,c,null)?b:c[0]}isCurve(){return!0}isDegenerate(a){return Ce(this,
a)}isDegenerate3D(a,b){p.geometryReleaseAssert(0);return!1}queryLooseEnvelope(a){a instanceof ub?p.geometryReleaseAssert(0):this.queryLooseEnvelopeOnInterval(new l.Envelope1D(0,1),a)}clone(a){a=new Hb;this.copyTo(a);return a}queryInterval(a,b){if(0===a){if(Ha(this))return 0===b?l.Envelope1D.construct(this.getStartX(),this.getEndX()):l.Envelope1D.construct(this.getStartY(),this.getEndY());a=this.getSemiAxes();var c=0===b?Math.atan2(-a.y*this.m_sinr,a.x*this.m_cosr):Math.atan2(a.y*this.m_cosr,a.x*this.m_sinr);
var d=c+Math.PI;a=[0,0];a[0]=Ja(this,c);a[1]=Ja(this,d);c=0===b?l.Envelope1D.construct(this.getStartX(),this.getEndX()):l.Envelope1D.construct(this.getStartY(),this.getEndY());d=new l.Point2D;for(let e=0;2>e;e++){const f=a[e];0<f&&1>f&&(this.queryCoord2D(f,d),c.mergeNeCoordinate(0===b?d.x:d.y))}return c}return super.queryInterval(a,b)}queryLooseEnvelopeOnInterval(a,b){var c=new l.Envelope1D(0,1);c.intersect(a);if(c.isEmpty())b.setEmpty();else if(Ha(this))b.setCoords(this.getCoord2D(c.vmin)),b.mergeNe(this.getCoord2D(c.vmax));
else{a=this.getCoord2D(c.vmin);var d=this.getCoord2D(c.vmax);if(1===this.m_minorMajorRatio&&Math.abs(this.m_sweepAngle)*c.width()<=l.geometryHalfPi){c=l.Point2D.lerp(a,d,.5);const e=c.sub(this.m_center);e.normalize();c=c.add(e.mul(.5*l.Point2D.distance(a,d)));b.setCoords(a);b.mergeNe(d);b.mergeNe(c)}else gl(this,c,b)}}tToLength(a){return Ha(this)?a*l.Point2D.distance(this.getStartXY(),this.getEndXY()):1===this.m_minorMajorRatio?Math.abs(this.getSweepAngle()*a)*this.m_semiMajorAxis:rh(this,a)}parametricAngleToT(a){return Ja(this,
a)}tToParametricAngle(a){return mc(this,a)}lengthToT(a){if(Ha(this)){var b=l.Point2D.distance(this.getStartXY(),this.getEndXY());return 0===b?0:a/b}return 1===this.m_minorMajorRatio?(b=Math.abs(this.getSweepAngle())*this.m_semiMajorAxis,0===b?0:a/b):fn(this,a)}calculateWeightedAreaCentroid2D(a){if(Ha(this))return a=new l.Point2D,a.setCoords(0,0),a;const b=dl(this);var c=this.getStartXY().sub(this.m_center);const d=this.getEndXY().sub(this.m_center),e=this.m_semiMajorAxis,f=this.getSemiMinorAxis(),
g=this.m_startAngle+this.m_sweepAngle,h=new l.Point2D;h.x=e*f*(e*this.m_cosr*(-Math.sin(g)+Math.sin(this.m_startAngle))+f*(-Math.cos(g)+Math.cos(this.m_startAngle))*this.m_sinr)/3;h.y=e*f*(f*(Math.cos(g)-Math.cos(this.m_startAngle))*this.m_cosr+e*(-Math.sin(g)+Math.sin(this.m_startAngle))*this.m_sinr)/3;c=d.add(c).mul(d.crossProduct(c)/6);h.x-=c.x;h.y-=c.y;return h.add(this.m_center.sub(a).mul(b))}calculateWeightedCentroid2D(){const a=new l.Point2D;if(this.isDegenerate(0))return a.setCoords(0,0),
a;if(Ha(this))return a.assign(this.getCoord2D(.5).mul(this.calculateLength2D())),a;var b=this.m_startAngle,c=this.m_startAngle+this.m_sweepAngle;if(c<b){var d=b;b=c;c=d}d=Math.sin(b);const e=Math.sin(c);b=Math.cos(b);c=Math.cos(c);if(1===this.m_minorMajorRatio){var f=this.getSemiMajorAxis();f*=f;a.setCoords(f*(e-d),f*(b-c))}else{f=this.getSemiMajorAxis();var g=this.getSemiMinorAxis(),h=f*f,k=g*g;f*=g;g=h-k;k=g/k;h=g/h;g=Math.sqrt(k);const m=Math.sqrt(h);a.setCoords(.5*f*(Math.asinh(g*e)/g+e*Math.sqrt(1+
k*e*e))-.5*f*(Math.asinh(g*d)/g+d*Math.sqrt(1+k*d*d)),-.5*f*(Math.asin(m*c)/m+c*Math.sqrt(1-h*c*c))- -.5*f*(Math.asin(m*b)/m+b*Math.sqrt(1-h*b*b)))}a.rotateDirect(this.m_cosr,this.m_sinr);a.assign(a.add(this.m_center.mul(this.calculateLength2D())));return a}isIntersectingPoint(a,b,c){if(c&&(a.isEqualPoint2D(this.getStartXY())||a.isEqualPoint2D(this.getEndXY())))return!1;if(!Ha(this)){c=l.Point2D.distance(a,this.m_center);var d=this.getSemiAxes();if(c<d.x-b||c>d.y+b)return!1}c=this.getClosestCoordinate(a,
!1);d=new l.Point2D;this.queryCoord2D(c,d);return l.Point2D.distance(d,a)<=b}isIntersectingPoint3D(a,b,c,d,e){p.geometryReleaseAssert(0);return!1}getTangent(a){if(Ha(this))return this.getEndXY().sub(this.getStartXY());a=mc(this,a);const b=new l.Point2D;b.setCoords(-this.m_semiMajorAxis*Math.sin(a),this.getSemiMinorAxis()*Math.cos(a));this.m_rotation&&b.rotateDirect(this.m_cosr,this.m_sinr);b.scale(this.getSweepAngle());return b}getDerivative(a){p.geometryReleaseAssert(0);return l.Point2D.getNAN()}normalizeAfterEndpointChange(){return 0===
(this.m_bits&8)?!1:Ha(this)?(this.m_bits&=-9,!1):al(this,!1)}projectionBehavior(){return(this.m_bits&4)>>2}setProjectionBehavior(a){this.m_bits=this.m_bits&-5|a<<2}convertToCanonic(a){a=new l.Point2D(a.x,a.y);a.subThis(this.m_center);a.rotateReverse(this.m_cosr,this.m_sinr);return a}convertFromCanonic(a){a=new l.Point2D(a.x,a.y);a.rotateDirect(this.m_cosr,this.m_sinr);a.addThis(this.m_center);return a}canonicToWorldTransformation(a){a.setRotate(this.m_cosr,this.m_sinr);a.shiftCoords(this.m_center.x,
this.m_center.y)}queryAttributeAsDbl(a,b,c,d){p.geometryReleaseAssert(0)}getCurvature(a){p.geometryReleaseAssert(0);return 0}getMonotonicPartParams(a,b){const c=Array(6);c[0]=0;let d=1;if(this.isDegenerateToLine())c[1]=1,d=2;else{var e=this.getSemiAxes();const f=Array(4);this.m_rotation?(f[0]=Math.atan2(e.y*this.m_cosr,e.x*this.m_sinr),f[1]=f[0]+Math.PI,f[2]=Math.atan2(-e.y*this.m_sinr,e.x*this.m_cosr),f[3]=f[2]+Math.PI):(f[0]=0,f[1]=Math.PI,f[2]=.5*Math.PI,f[3]=l.threeHalfPi());for(e=0;4>e;e++){const g=
Ja(this,f[e]);0<g&&1>g&&(c[d]=g,d++)}2<d&&l.numericSortRange(c,d);c[d]=1;d++}if(b)for(a<d&&p.throwInvalidArgumentException(""),a=0;a<d;a++)b[a]=c[a];return d}calculateLowerLength2D(){const a=l.Point2D.distance(this.getStartXY(),this.getEndXY());if(this.isDegenerateToLine())return a;const b=Math.abs(this.m_sweepAngle)*this.getSemiMinorAxis();return Math.max(b,a)}calculateUpperLength2D(){const a=l.Point2D.distance(this.getStartXY(),this.getEndXY());if(this.isDegenerateToLine())return a;const b=Math.abs(this.m_sweepAngle)*
this.getSemiMajorAxis();return Math.max(b,a)}orientBottomUp(){p.geometryReleaseAssert(0)}isLine(){return Ha(this)}copyIgnoreAttributes(a){a.m_XStart=this.m_XStart;a.m_YStart=this.m_YStart;a.m_XEnd=this.m_XEnd;a.m_YEnd=this.m_YEnd;a.m_center.assign(this.m_center);a.m_semiMajorAxis=this.m_semiMajorAxis;a.m_minorMajorRatio=this.m_minorMajorRatio;a.m_interior.assign(this.m_interior);a.m_rotation=this.m_rotation;a.m_cosr=this.m_cosr;a.m_sinr=this.m_sinr;a.m_sweepAngle=this.m_sweepAngle;a.m_startAngle=
this.m_startAngle;a.m_bits=this.m_bits;a.m_cachedValues=null}calculateArea2DHelper(){return dl(this)}absNorm(){let a=this.getStartXY().norm(1)+this.getEndXY().norm(1);this.isDegenerateToLine()||(a+=this.m_center.norm(1),a+=this.m_semiMajorAxis);return a}queryEnvelopeW(a,b){b.setCoords(this.getCoord2D(a.vmin));b.mergeNe(this.getCoord2D(a.vmax));if(!Ha(this)){var c=this.getSemiAxes(),d=Array(8),e=Math.atan2(-c.y*this.m_sinr,c.x*this.m_cosr),f=e+Math.PI,g=Math.atan2(c.y*this.m_cosr,c.x*this.m_sinr),
h=g+Math.PI;d[0]=Ja(this,e);d[1]=Ja(this,f);d[2]=Ja(this,g);d[3]=Ja(this,h);g=this.m_cosr+this.m_sinr;h=this.m_cosr-this.m_sinr;e=Math.atan2(-c.y*g,c.x*h);f=e+Math.PI;c=Math.atan2(c.y*h,c.x*g);g=c+Math.PI;d[4]=Ja(this,e);d[5]=Ja(this,f);d[6]=Ja(this,c);d[7]=Ja(this,g);c=l.Point2D.getNAN();for(e=0;8>e;e++)f=d[e],a.containsExclusiveCoordinate(f)&&(this.queryCoord2D(f,c),b.mergeNe(c))}}setSegmentFromCoords(a,b){var c=0===this.projectionBehavior();if(2>=b)Tb(this,a[0],a[b-1],c?0:1);else if(c)this.constructCircularArcThreePoint(a[0],
a[b-1],a[Math.trunc(b/2)]),a=new l.Point2D,this.queryCoord2D(.5,a),this.m_interior.setCoordsPoint2D(a);else{c=this.getSemiMajorAxis();var d=this.getMinorMajorRatio(),e=this.getAxisXRotation(),f=this.getCenter(),g=Array(4);g[0]=this.isMajor();g[1]=!g[0];g[2]=g[0];g[3]=!g[0];var h=Array(4);h[0]=this.isClockwise();h[1]=h[0];h[2]=!h[0];h[3]=!h[0];var k=Math.trunc(5>b?1:(b+4)/5),m=l.makeObjectArray(Hb,4),n=Array(4),q=0;for(let r=0;4>r;r++){m[r].constructEllipticArcEndPointsCenter(a[0],a[b-1],c,d,e,g[r],
h[r],f);let t=n[r]=0;for(let u=k;u<b-1;u+=k){const v=m[r].getClosestCoordinate(a[u],!1);n[r]+=l.Point2D.sqrDistance(m[r].getCoord2D(v),a[u]);t++}n[r]/=t;n[r]<n[q]&&(q=r)}this.assignCopy(m[q])}}writeInBufferStream(a,b){const c=new Float64Array(10);c[0]=this.m_bits;c[1]=this.m_semiMajorAxis;c[2]=this.m_minorMajorRatio;c[3]=this.m_rotation;c[4]=this.m_center.x;c[5]=this.m_center.y;c[6]=this.m_sweepAngle;c[7]=this.m_startAngle;c[8]=this.m_interior.x;c[9]=this.m_interior.y;a.writeRangeFromArray(b,c.length,
c,!0,1);return b+c.length}readFromBufferStream(a,b){const c=new Float64Array(10);a.queryRange(b,c.length,c,!0,1);this.m_bits=c[0];this.m_semiMajorAxis=c[1];this.m_minorMajorRatio=c[2];this.m_rotation=c[3];this.m_center.x=c[4];this.m_center.y=c[5];this.m_sweepAngle=c[6];this.m_startAngle=c[7];this.m_interior.x=c[8];this.m_interior.y=c[9];this.m_cosr=Math.cos(this.m_rotation);this.m_sinr=Math.sin(this.m_rotation);this.m_cachedValues=null}snapControlPoints(a){return!1}needsSnapControlPoints(a){p.geometryReleaseAssert(0);
return!1}calculateSpecialPointsForCracking(a,b){p.geometryReleaseAssert(0);return 0}ensureXYMonotone(){p.geometryReleaseAssert(0);return!1}setCoordsForIntersector(a,b,c){Yk(this,a,b,c)}getInteriorPoint(){return this.m_interior.clone()}copyToImpl(a){a.m_center.assign(this.m_center);a.m_semiMajorAxis=this.m_semiMajorAxis;a.m_minorMajorRatio=this.m_minorMajorRatio;a.m_interior.assign(this.m_interior);a.m_rotation=this.m_rotation;a.m_cosr=this.m_cosr;a.m_sinr=this.m_sinr;a.m_sweepAngle=this.m_sweepAngle;
a.m_startAngle=this.m_startAngle;a.m_bits=this.m_bits;a.m_cachedValues=this.m_cachedValues}reverseImpl(){yf(this,0===(this.m_bits&1));oh(this);(0!==this.projectionBehavior()||this.getStartXY().equals(this.getEndXY()))&&re(this)}equalsImpl(a){return this.m_bits===a.m_bits&&this.m_semiMajorAxis===a.m_semiMajorAxis&&this.m_minorMajorRatio===a.m_minorMajorRatio&&(this.m_center.isEqualPoint2D(a.m_center)||this.m_center.isNAN()&&a.m_center.isNAN())&&this.m_rotation===a.m_rotation&&this.m_interior.equals(a.m_interior)&&
this.m_sweepAngle===a.m_sweepAngle&&this.m_startAngle===a.m_startAngle?!0:!1}equalsImplTol(a,b){if(this.m_bits!==a.m_bits)return!1;if(this.m_center.isNAN()&&a.m_center.isNAN())return!0;if(this.m_center.isNAN()!==a.m_center.isNAN()||!this.getSemiAxes().isEqualPoint2D(a.getSemiAxes(),b)||!this.m_center.isEqualPoint2D(a.m_center,b))return!1;var c=Math.abs(zg((this.m_rotation-a.m_rotation)*tf)*jh);const d=Math.abs(l.pi()-c);if(this.m_semiMajorAxis*Math.abs(Math.min(c,d))>b)return!1;c=this.getCoord2D(.5);
a=a.getCoord2D(.5);return c.isEqualPoint2D(a,b)?!0:!1}getHashCodeImpl(){p.geometryReleaseAssert(0);return 0}swapImpl(a){p.geometryReleaseAssert(0)}afterCompletedModification(){this.m_bits&=-9;this.m_cachedValues=null}intersect(a,b,c,d,e){return Zc(!1,this,a,b,c,d,e)}intersectPoint(a,b,c){2>b.length&&p.throwOutOfRangeException("");if(Ha(this))return(new Z({start:this.getStartXY(),end:this.getEndXY()})).intersectPoint(a,b,c);var d=l.Point2D.distance(a,this.m_center);if(d>this.m_semiMajorAxis+c||d<this.getSemiMinorAxis()-
c)return 0;d=this.getClosestCoordinate(a,!1);const e=l.Point2D.getNAN();this.queryCoord2D(d,e);if(l.Point2D.distance(e,a)<=c){if(l.isOneOf(d,0,1)&&(this.queryCoord2D(0===d?1:0,e),l.Point2D.distance(e,a)<=c))return b&&(b[0]=0,b[1]=1),2;b&&(b[0]=d);return 1}return 0}isIntersecting(a,b,c){return 0!==Hc(!1,!1,this,a,b,c)}intersect_(a,b,c,d){p.geometryReleaseAssert(0);return 0}endPointModified(){this.m_bits|=8;this.m_cachedValues=null}clearEndPointModified(){this.m_bits&=-9}}Hb.type=p.GeometryType.enumEllipticArc;
class ba extends db{constructor(a){a?a.vd?(super({vd:a.vd,bPolygon:!0}),this.m_segmentBufferCTor=W):a.copy?(super({vd:a.copy.getDescription(),bPolygon:!0}),this.m_segmentBufferCTor=W,a.copy.copyTo(this)):a.move?(super({move:a.move}),this.m_segmentBufferCTor=W):p.geometryReleaseAssert(0):(super({bPolygon:!0}),this.m_segmentBufferCTor=W)}assignMove(a){a.copyTo(this);return this}assignCopy(a){a.copyTo(this);return this}getBoundary(){return Qb(this)}getExteriorRingCount(){return this.getOGCPolygonCount()}getGeometryType(){return ba.type}getDimension(){return 2}createInstance(){return new ba({vd:this.getDescription()})}equals(a,
b){return this.equalsBase(a,b)}}ba.type=p.GeometryType.enumPolygon;class te extends Fl{constructor(a){"number"===typeof a?(super(),this.m_factor=a,this.m_wkid=0):super(a)}getUnitType(){return 1}convertFromRadians(a){return a/this.getUnitToBaseFactor()}convertToRadians(a){return a*this.getUnitToBaseFactor()}}class An{constructor(a){this.m_shape=a}userSort(a,b,c){this.m_shape.sortVerticesSimpleByYHelper(c,a,b)}getValue(a){return this.m_shape.getY(a)}}class Gf{constructor(a){void 0!==a.parent?(this.m_parent=
a.parent,this.m_geometry=a.geometry,this.m_path=a.path,this.m_vertex=a.vertex,this.m_firstVertex=a.firstVertex,this.m_index=a.selection?0:a.index,this.m_bSkipMultiPoints=a.bSkipMultiPoints,this.m_selection=a.selection,this.m_bOneGeom=a.bOneGeom,this.m_bFirst=!0):(this.m_parent=a.copy.m_parent,this.m_geometry=a.copy.m_geometry,this.m_path=a.copy.m_path,this.m_vertex=a.copy.m_vertex,this.m_index=a.copy.m_index,this.m_bSkipMultiPoints=a.copy.m_bSkipMultiPoints,this.m_firstVertex=a.copy.m_firstVertex,
this.m_bFirst=!0,this.m_selection=a.copy.m_selection,this.m_bOneGeom=a.copy.m_bOneGeom)}moveToNextHelper(){this.m_path=this.m_parent.getNextPath(this.m_path);for(this.m_index=0;-1!==this.m_geometry;){for(;-1!==this.m_path;this.m_path=this.m_parent.getNextPath(this.m_path))if(this.m_firstVertex=this.m_vertex=this.m_parent.getFirstVertex(this.m_path),-1!==this.m_vertex)return this.m_vertex;if(this.m_bOneGeom)break;this.m_geometry=this.m_parent.getNextGeometry(this.m_geometry);if(-1===this.m_geometry)break;
if(!this.m_bSkipMultiPoints||p.isMultiPath(this.m_parent.getGeometryType(this.m_geometry)))this.m_path=this.m_parent.getFirstPath(this.m_geometry)}return-1}nextSelection(){for(;this.m_index<this.m_parent.m_selectedVertices.length;){const a=this.m_parent.m_selectedVertices[this.m_index++];if(-1!==a&&(this.m_path=this.m_parent.getPathFromVertex(a),!this.m_bOneGeom||this.m_geometry===this.m_parent.getGeometryFromPath(this.m_path)))return this.m_geometry=this.m_parent.getGeometryFromPath(this.m_path),
a}return-1}next(){return this.m_selection?this.nextSelection():this.m_bFirst?(this.m_bFirst=!1,this.m_vertex):-1!==this.m_vertex?(this.m_vertex=this.m_parent.getNextVertex(this.m_vertex),this.m_index++,-1!==this.m_vertex&&this.m_vertex!==this.m_firstVertex?this.m_vertex:this.moveToNextHelper()):-1}currentGeometry(){return this.m_geometry}currentPath(){p.geometryReleaseAssert(0);return 0}static create_(a,b,c,d,e,f,g,h,k){return new Gf({parent:a,geometry:b,path:c,vertex:d,firstVertex:e,index:f,bSkipMultiPoints:g,
selection:h,bOneGeom:k})}}class Hg{constructor(a){this.parentage=a}equals(a){return this.parentage===a.parentage}}class Fa{setPrevPath(a,b){this.m_pathIndexList.setField(a,1,b)}setNextPath(a,b){this.m_pathIndexList.setField(a,2,b)}setPathFlags(a,b){this.m_pathIndexList.setField(a,6,b)}getPathFlags(a){return this.m_pathIndexList.getField(a,6)}setPathGeometry(a,b){this.m_pathIndexList.setField(a,7,b)}getPathIndex(a){return this.m_pathIndexList.getField(a,0)}setNextGeometry(a,b){this.m_geometryIndexList.setField(a,
1,b)}setPrevGeometry(a,b){this.m_geometryIndexList.setField(a,0,b)}getGeometryIndex(a){return this.m_geometryIndexList.getField(a,7)}setFirstPath(a,b){this.m_geometryIndexList.setField(a,3,b)}setLastPath(a,b){this.m_geometryIndexList.setField(a,4,b)}newGeometry(a){const b=this.m_geometryIndexList.newElement();this.m_geometryIndexList.setField(b,2,a);this.m_geometryIndexList.setField(b,5,0);this.m_geometryIndexList.setField(b,6,0);this.m_geometryIndexList.setField(b,7,this.m_geometryIndexList.elementToIndex(b));
return b}freeGeometry(a){this.m_geometryIndexList.deleteElement(a)}newPath(a){const b=this.m_pathIndexList.newElement(),c=this.m_pathIndexList.elementToIndex(b);this.m_pathIndexList.setField(b,0,c);this.m_pathIndexList.setField(b,3,0);this.m_pathIndexList.setField(b,6,0);this.setPathGeometry(b,a);c>=this.m_pathAreas.length&&(a=Math.trunc(16>c?16:3*c/2),this.m_pathAreas.length=a,this.m_pathLengths.length=a);this.m_pathAreas[c]=0;this.m_pathLengths[c]=0;this.m_pathCount++;return b}freePath(a){this.m_pathIndexList.deleteElement(a);
this.m_pathCount--}newVertex(a){const b=this.m_vertexIndexList.newElement(),c=0<=a?a:this.m_vertexIndexList.elementToIndex(b);this.m_vertexIndexList.setField(b,0,c);0>a&&(c>=this.m_vertices.getPointCount()&&(a=Math.trunc(16>c?16:3*c/2),this.m_vertices.reserveRounded(a),this.m_vertices.resizeNoInit(a),null!==this.m_segments&&(this.m_segments.length=a),this.m_xyStream=this.m_vertices.getAttributeStreamRef(0)),this.m_segments&&(this.m_segments[c]=null));this.m_pointCount++;return b}freeVertex(a){this.unselect(a);
const b=this.getVertexIndex(a);this.m_vertexIndexList.deleteElement(a);this.m_pointCount--;for(let c=0,d=this.m_indices.length;c<d;c++)c!==this.m_selectionIndex&&(a=this.m_indices[c],null!==a&&a.size()>b&&a.write(b,-1));this.m_weights&&this.m_weights.size()>b&&this.m_weights.write(b,1);this.m_ranks&&this.m_ranks.size()>b&&this.m_ranks.write(b,1);this.m_segmentWeights&&this.m_segmentWeights.size()>b&&this.m_segmentWeights.write(b,1);this.m_segmentRanks&&this.m_segmentRanks.size()>b&&this.m_segmentRanks.write(b,
1);this.m_segments&&this.setSegmentToIndex(b,null)}insertVertex_(a,b,c,d){this.m_bHasForceSetEnvelope=!1;var e=-1!==b?this.getPrevVertex(b):this.getLastVertex(a);const f=-1!==e?this.getNextVertex(e):-1,g=this.newVertex(null===c?this.m_pointCount:-1),h=this.getVertexIndex(g);null!==c&&this.m_vertices.setPointByVal(h,c);this.setPathToVertex(g,a);this.setNextVertex(g,f);this.setPrevVertex(g,e);-1!==f&&this.setPrevVertex(f,g);-1!==e&&this.setNextVertex(e,g);c=this.isClosedPath(a);e=this.getFirstVertex(a);
-1===b&&this.setLastVertex(a,g);b===e&&(c&&d&&-1!==e||this.setFirstVertex(a,g));c&&-1===f&&(this.setNextVertex(g,g),this.setPrevVertex(g,g));this.setPathSize(a,this.getPathSize(a)+1);a=this.getGeometryFromPath(a);this.setGeometryVertexCount(a,this.getPointCount(a)+1);return g}getHelperPoint(){this.m_helperPoint||(this.m_helperPoint=new Y({vd:this.m_vertices.getDescription()}),this.m_helperPoint.setXYCoords(0,0));return this.m_helperPoint}addMultiPath_(a){p.geometryReleaseAssert(0);return 0}addMultiPoint(a,
b){const c=this.createGeometry(a.getGeometryType(),a.getDescription());this.appendMultiPoint(c,a,b);return c}addPoint_(a,b){const c=this.createGeometry(p.GeometryType.enumMultiPoint,a.getDescription());this.appendPoint(c,a,b);return c}appendMultiPath_(a,b){if(!b.isEmpty()){var c=b.getImpl();this.m_vertices.reserveRounded(this.m_vertices.getPointCount()+c.getPointCount());this.m_verticesMp.addPoints(b,0,c.getPointCount());this.m_xyStream=this.m_vertices.getAttributeStreamRef(0);b=null!==this.m_segments||
null!==c.getSegmentFlagsStreamRef();this.m_vertexIndexList.setCapacity(this.m_vertexIndexList.size()+c.getPointCount());this.m_pathIndexList.setCapacity(this.m_pathIndexList.size()+c.getPathCount());for(let e=0,f=c.getPathCount();e<f;e++){if(0===c.getPathSize(e))continue;const g=this.insertPath(a,-1);this.setClosedPath(g,c.isClosedPath(e));for(let h=c.getPathStart(e),k=c.getPathEnd(e);h<k;h++){var d=this.insertVertex_(g,-1,null,!1);if(b)if(d=this.getVertexIndex(d),c.getSegmentFlags(h)&1)this.setSegmentToIndex(d,
null);else{const m=new W;c.querySegment(h,m,!0);this.setSegmentToIndex(d,m.releaseSegment())}}c.isStrongPathStart(e)&&this.setStrongPathStart(g,!0);c.isStrongPathEnd(e)&&this.setStrongPathEnd(g,!0)}}}addMultiPath(a,b){const c=this.createGeometry(a.getGeometryType(),a.getDescription());a.getGeometryType()===p.GeometryType.enumPolygon&&this.setFillRule(c,a.getFillRule());this.appendMultiPath(c,a,b);return c}appendMultiPathPolyline(a,b,c){p.geometryReleaseAssert(0)}appendMultiPathPolygon(a,b,c){const d=
b.getImpl(),e=null!==this.m_segments||null!==d.getSegmentFlagsStreamRef();var f=D.constructEmpty();b.queryEnvelope(f);p.geometryReleaseAssert(c.isIntersecting(f)&&!c.containsEnvelope(f));var g=D.construct(Number.NEGATIVE_INFINITY,c.ymin,Number.POSITIVE_INFINITY,c.ymax);c=D.construct(c.xmin,Number.NEGATIVE_INFINITY,c.xmax,Number.POSITIVE_INFINITY);if((f=d.getAccelerators())&&f.getQuadTree()){var h=f.getQuadTree();f=h.getIntersectionCount(g,0,0);h=h.getIntersectionCount(c,0,f+1);f>h&&(c=l.swap(g,g=
c))}else g.height()>c.width()&&(c=l.swap(g,g=c));f=[];g=d.queryLimitedSegmentIterator(g);h=-1;var k=-100;let m=-1;var n=0;let q=-1,r=-1,t=-1;var u=!0;let v=g.nextSegment();if(null!==v)for(;;v=g.nextSegment()){var w=null===v,x=null!==v?g.getPathIndex():h;const z=null!==v?g.getStartPointIndex():k;w||(x===h?k+1===z?n++:w=!0:(w=0<=h,0>h&&(h=x,m=d.getSegmentCountPath(h),q=z,t=-1,n=1)));if(w){if(0!==f.length||m!==n){if(0===f.length||f[0].first!==q)this.m_vertices.reserveRounded(this.m_vertices.getPointCount()+
1),this.m_verticesMp.addPoints(b,q,q+1),-1===r&&(r=q),-1===t&&(t=this.insertPath(a,-1),this.setClosedPath(t,!0)),this.m_xyStream=this.m_vertices.getAttributeStreamRef(0),this.insertVertex_(t,-1,null,!1);for(const {first:A,second:C}of f){-1===r&&(r=A);u=k=-1;k=A+C-1;if(C===m)w=k+1,u=w-A,this.m_vertices.reserveRounded(this.m_vertices.getPointCount()+u),this.m_verticesMp.addPoints(b,A,w),p.geometryReleaseAssert(1===f.length);else if(k+1<d.getPathEnd(h))w=k+2,u=w-A,this.m_vertices.reserveRounded(this.m_vertices.getPointCount()+
u),this.m_verticesMp.addPoints(b,A,w);else{w=d.getPathStart(h);var y=w!==r?1:0;const B=k+1;u=B-A+y;this.m_vertices.reserveRounded(this.m_vertices.getPointCount()+(B-A)+y);this.m_verticesMp.addPoints(b,A,B);0<y&&this.m_verticesMp?.addPoints(b,w,w+1)}this.m_xyStream=this.m_vertices.getAttributeStreamRef(0);-1===t&&(t=this.insertPath(a,-1),this.setClosedPath(t,!0));for(let B=0,E=A;B<u;B++,E++)w=this.insertVertex_(t,-1,null,!1),e&&(w=this.getVertexIndex(w),d.getSegmentFlags(E)&1||E>k?this.setSegmentToIndex(w,
null):(y=new W,d.getSegmentBuffer(E,y,!0),this.setSegmentToIndex(w,y.releaseSegment())))}if(0===f.length||f.at(-1).first+f.at(-1).second!==q+n)n=q+n,n===b.getPathEnd(h)&&(n=b.getPathStart(h)),r!==n&&(this.m_vertices.reserveRounded(this.m_vertices.getPointCount()+1),this.m_verticesMp.addPoints(b,n,n+1),this.insertVertex_(t,-1,null,!1))}f.length=0;u=!0;x!==h&&(h=x,m=d.getSegmentCountPath(h),r=t=-1);q=z;n=1}if(v)x=D.constructEmpty(),v.queryLooseEnvelope(x),c.isIntersecting(x)?(u?f.push(l.makePair(z,
1)):f.at(-1).second++,u=!1):u=!0;else break;k=z}}appendMultiPath(a,b,c){if(void 0===c)this.appendMultiPath_(a,b);else if(!b.isEmpty()){var d=b.getGeometryType()===p.GeometryType.enumPolygon,e=D.constructEmpty();b.queryEnvelope(e);c.isIntersecting(e)&&(!c.containsEnvelope(e)&&10<b.getPointCount()?d?this.appendMultiPathPolygon(a,b,c):this.appendMultiPathPolyline(a,b,c):this.appendMultiPath_(a,b))}}appendPoint(a,b,c){b.isEmpty()||void 0!==c&&!c.contains(b.getXY())||(this.m_vertices.reserveRounded(this.m_vertices.getPointCount()+
1),this.m_verticesMp.add(b),this.m_xyStream=this.m_vertices.getAttributeStreamRef(0),this.m_vertexIndexList.setCapacity(this.m_vertexIndexList.size()+1),a=this.insertPath(a,-1),this.insertVertex_(a,-1,null,!1))}appendMultiPoint_(a,b){this.m_vertices.reserveRounded(this.m_vertices.getPointCount()+b.getPointCount());this.m_verticesMp.addPoints(b,0,b.getPointCount());this.m_xyStream=this.m_vertices.getAttributeStreamRef(0);this.m_vertexIndexList.setCapacity(this.m_vertexIndexList.size()+b.getPointCount());
a=this.insertPath(a,-1);for(let c=0,d=b.getPointCount();c<d;c++)this.insertVertex_(a,-1,null,!1)}appendMultiPoint(a,b,c){if(void 0===c)this.appendMultiPoint_(a,b);else{var d=b.getAttributeStreamRef(0),e=0;for(let k=0,m=b.getPointCount();k<m;k++){var f=d.readPoint2D(2*k);c.contains(f)&&e++}this.m_vertices.reserveRounded(this.m_vertices.getPointCount()+e);var g=f=-1,h=0;for(let k=0,m=b.getPointCount();k<m;k++){const n=d.readPoint2D(2*k);c.contains(n)?(-1===f&&(g=f=k),g++):0<=f&&(this.m_verticesMp.addPoints(b,
f,g-f),f=-1,h++)}0<f&&(this.m_verticesMp.addPoints(b,f,g-f),h++);if(h){this.m_xyStream=this.m_vertices.getAttributeStreamRef(0);this.m_vertexIndexList.setCapacity(this.m_vertexIndexList.size()+e);a=this.insertPath(a,-1);for(let k=0,m=b.getPointCount();k<m;k++)b=d.readPoint2D(2*k),c.contains(b)&&this.insertVertex_(a,-1,null,!1)}}}splitSegmentForward(a,b,c,d,e){d=this.getNextVertex(a);-1===d&&p.throwInvalidArgumentException("Edit_shape.split_segment_forward_");const f=this.getHelperPoint(),g=this.getPathFromVertex(a);
var h=a;a=this.hasSegmentParentage();for(let m=0,n=b.getResultSegmentCount(c);m<n;m++){const q=this.getVertexIndex(h);var k=this.getNextVertex(h);const r=b.getResultSegment(c,m);let t=null;r.getGeometryType()!==p.GeometryType.enumLine&&(t=r.clone(),t.dropAllAttributes());0===m&&(r.queryStart(f),this.setSegmentToIndex(q,null),this.setPointEx(h,f,b.getResultSegmentStartPointRank(c,m),b.getResultSegmentStartPointWeight(c,m),e));this.setSegmentRank(h,b.getResultSegmentInteriorRank(c,m));this.setSegmentWeight(h,
b.getResultSegmentInteriorWeight(c,m));if(a){const u=b.getResultSegmentSegmentParentage(c,m),v=b.getResultSegmentStartPointIsBreak(c,m);this.setSegmentParentageAndBreak(h,u,v)}r.queryEnd(f);m<n-1?(this.setSegmentToIndex(q,t),h=this.insertVertex(g,k,f),this.setWeight(h,b.getResultSegmentEndPointWeight(c,m)),this.setRank(h,b.getResultSegmentEndPointRank(c,m)),this.select(h)):(this.setPointEx(d,f,b.getResultSegmentEndPointRank(c,m),b.getResultSegmentEndPointWeight(c,m),e),k=b.getResultSegmentEndPointIsBreak(c,
m),this.setSegmentParentageBreakVertex(d,k),this.setSegmentToIndex(q,t))}}splitSegmentBackward(a,b,c,d,e){d=this.getNextVertex(a);-1===d&&p.throwInvalidArgumentException("Edit_shape.split_segment_backward_");const f=this.getHelperPoint(),g=this.getPathFromVertex(a),h=this.hasSegmentParentage();for(let m=0,n=b.getResultSegmentCount(c);m<n;m++){const q=n-m-1;var k=this.getVertexIndex(a);const r=this.getNextVertex(a),t=b.getResultSegment(c,q);let u=null;t.getGeometryType()!==p.GeometryType.enumLine&&
(u=t.clone(),u.reverse(),u.dropAllAttributes());0===m&&(t.queryEnd(f),this.setSegmentToIndex(k,null),this.setPointEx(a,f,b.getResultSegmentEndPointRank(c,q),b.getResultSegmentEndPointWeight(c,q),e),this.setSegmentParentageAndBreak(a,b.getResultSegmentSegmentParentage(c,q),b.getResultSegmentEndPointIsBreak(c,q)));t.getGeometryType()===p.GeometryType.enumLine?this.setSegmentToIndex(k,null):this.setSegmentToIndex(k,u);this.setSegmentRank(a,b.getResultSegmentInteriorRank(c,q));this.setSegmentWeight(a,
b.getResultSegmentInteriorWeight(c,q));t.queryStart(f);m<n-1?(k=this.insertVertex(g,r,f),this.setWeight(k,b.getResultSegmentStartPointWeight(c,q)),this.setRank(k,b.getResultSegmentStartPointRank(c,q)),this.select(k),a=k,h&&this.setSegmentParentageAndBreak(k,b.getResultSegmentSegmentParentage(c,q),b.getResultSegmentEndPointIsBreak(c,q))):this.setPointEx(d,f,b.getResultSegmentStartPointRank(c,q),b.getResultSegmentStartPointWeight(c,q),e)}}selected_(a){p.geometryReleaseAssert(0);return!1}allocateIndex(a=
!0){if(this.m_deletedIndices.length){const b=this.m_deletedIndices.pop();a&&b.setRange(-1,0,b.size());return b}return a?hb(0,-1):hb(0)}recycleUserIndex(a){this.m_deletedIndices.push(a)}allocatePathIndex(){if(this.m_deletedPathIndices.length){const a=this.m_deletedPathIndices.at(-1);this.m_deletedPathIndices.pop();return a}return hb(0)}recyclePathUserIndex(a){this.m_deletedPathIndices.push(a)}peelALoop_(a,b,c){var d=this.getNextVertex(a),e=this.getNextVertex(b),f=this.getVertexIndex(a),g=this.getVertexIndex(b);
this.setNextVertex(a,e);this.setPrevVertex(e,a);this.setNextVertex(b,d);this.setPrevVertex(d,b);if(this.m_segments){const h=this.getSegmentFromIndex(f),k=this.getSegmentFromIndex(g);this.setSegmentToIndex(g,null);this.setSegmentToIndex(f,k);this.setSegmentToIndex(g,h)}this.hasSegmentParentage()&&(f=this.getSegmentParentage(b),g=this.getSegmentParentage(a),-1!==f||-1!==g)&&(g=l.swap(f,f=g),this.setSegmentParentageAndBreak(a,g),this.setSegmentParentageAndBreak(b,f));return c?(a=this.getPathFromVertex(a),
c=this.getGeometryFromPath(a),b=[!1],d=this.insertClosedPath(c,-1,d,this.getFirstVertex(a),b),b[0]&&this.setFirstVertex(a,e),e=this.getPathSize(a),b=this.getPathSize(d),this.setPathSize(a,e-b),d):-1}sortVerticesSimpleByYHelper(a,b,c){a.sort(b,c,(d,e)=>{let f=this.compareVerticesSimpleY(d,e);0===f&&(d=this.getPathInternalIndexFromVertex(d),e=this.getPathInternalIndexFromVertex(e),f=d<e?-1:d>e?1:0);return f})}sortVerticesSimpleByYHelper3D(a,b,c){p.geometryReleaseAssert(0)}constructor(){this.m_segmentRanks=
this.m_segmentWeights=this.m_ranks=this.m_weights=this.m_segments=this.m_vertexDescription=this.m_xyStream=this.m_vertices=this.m_verticesMp=null;this.m_indices=[];this.m_deletedIndices=[];this.m_pathAreas=[];this.m_pathLengths=[];this.m_pathindices=[];this.m_deletedPathIndices=[];this.m_geometryIndices=[];this.m_selectedVertices=[];this.m_helperPoint=null;this.m_forceSetEnvelope=ub.constructEmpty();this.m_bHasForceSetEnvelope=!1;this.m_workPoint2D=l.Point2D.getNAN();this.m_workPoint2_2D=l.Point2D.getNAN();
this.m_curveStitcher=null;this.m_pointCount=this.m_pathCount=0;this.m_lastGeometry=this.m_firstGeometry=-1;this.m_vertexIndexList=new U(5);this.m_pathIndexList=new U(8);this.m_geometryIndexList=new U(8);this.m_bHasAttributes=!1;this.m_selectedCount=0;this.m_selectionIndex=-1;this.m_selection=!1;this.m_bucketSort=new Zb;this.m_bHasForceSetEnvelope=!1;this.m_segmentParentageIndex=-1}getTotalPointCount(){return this.m_pointCount}getEnvelope2D(a){if(this.m_bHasForceSetEnvelope)return new D(this.m_forceSetEnvelope.xmin,
this.m_forceSetEnvelope.ymin,this.m_forceSetEnvelope.xmax,this.m_forceSetEnvelope.ymax);a=this.hasCurves();const b=D.constructEmpty(),c=this.queryVertexIterator();var d=!0;for(var e=c.next();-1!==e;e=c.next())d?b.merge(this.getXY(e)):b.mergeNe(this.getXY(e)),a&&(d=this.getSegment(e),null!==d&&(e=D.constructEmpty(),d.queryLooseEnvelope(e),b.mergeEnvelope2D(e))),d=!1;return b}getEnvelope3D(a){p.geometryReleaseAssert(0);return ub.constructEmpty()}forceSetEnvelope2D(a){this.m_bHasForceSetEnvelope=!0;
this.m_forceSetEnvelope.setCoords(a.xmin,a.ymin,0,a.xmax,a.ymax,0)}forceSetEnvelope3D(a){p.geometryReleaseAssert(0)}forgetForceSetEnvelope2D(){p.geometryReleaseAssert(0)}getGeometryCount(){return this.m_geometryIndexList.size()}addGeometry(a,b){var c=a.getGeometryType();if(p.isMultiPath(c))return this.addMultiPath(a,b);if(c===p.GeometryType.enumMultiPoint)return this.addMultiPoint(a,b);if(c===p.GeometryType.enumPoint)return this.addPoint_(a,b);if(c===p.GeometryType.enumEnvelope)return c=new ba,c.addEnvelope(a,
!1),this.addMultiPath(c,b);p.throwInvalidArgumentException("")}appendGeometry(a,b){this.mergeVertexDescription(b.getDescription());const c=b.getGeometryType();p.isMultiPath(c)?this.appendMultiPath(a,b):c===p.GeometryType.enumMultiPoint?this.appendMultiPoint(a,b):p.throwInvalidArgumentException("")}assignRankToGeometryVertices(a,b){p.geometryReleaseAssert(0)}collapseAllGeometriesToFirst(){this.collapseGeometriesToFirst(p.GeometryType.enumUnknown)}collapseGeometriesToFirst(a){this.dbgVerifyVertexCounts();
let b=-1,c=-1,d=-1;for(let f=this.getFirstGeometry();-1!==f;)if(a===p.GeometryType.enumUnknown||this.getGeometryType(f)===a){if(-1===b){b=f;c=this.getPathCount(b);d=this.getPointCount(b);f=this.getNextGeometry(f);continue}for(var e=this.getFirstPath(f);-1!==e;e=this.getNextPath(e))this.setPathGeometry(e,b);c+=this.getPathCount(f);d+=this.getPointCount(f);e=this.getLastPath(b);const g=this.getFirstPath(f);-1!==e?this.setNextPath(e,g):this.setFirstPath(b,g);-1!==g&&(this.setPrevPath(g,e),this.setLastPath(b,
this.getLastPath(f)));this.setFirstPath(f,-1);this.setLastPath(f,-1);e=f;f=this.getNextGeometry(f);this.setGeometryVertexCount(e,0);this.removeGeometry(e)}else f=this.getNextGeometry(f);-1!==b&&(this.setGeometryVertexCount(b,d),this.setGeometryPathCount(b,c),this.dbgVerifyVertexCounts());return b}setFillRule(a,b){let c=this.m_geometryIndexList.getField(a,2);this.m_geometryIndexList.setField(a,2,c&-134217729|(1===b?134217728:0))}getFillRule(a){return 0!==(this.m_geometryIndexList.getField(a,2)&134217728)?
1:0}setGeometryModified(a,b){let c=this.m_geometryIndexList.getField(a,2);!!(c&67108864)!==b&&this.m_geometryIndexList.setField(a,2,c&-67108865|(b?67108864:0))}getGeometryModified(a){return 0!==(this.m_geometryIndexList.getField(a,2)&67108864)}setGeometryModifiedWithVertex(a,b){a=this.getPathFromVertex(a);a=this.getGeometryFromPath(a);this.setGeometryModified(a,b)}getGeometryModifiedWithVertex(a){p.geometryReleaseAssert(0);return!0}swapGeometry(a,b){p.geometryReleaseAssert(0)}addPathFromMultiPath(a,
b,c){const d=this.createGeometry(c?p.GeometryType.enumPolygon:p.GeometryType.enumPolyline,a.getDescription()),e=a.getImpl();if(2>a.getPathSize(b))return d;this.m_vertices.reserveRounded(this.m_vertices.getPointCount()+a.getPathSize(b));this.m_verticesMp.addPoints(a,a.getPathStart(b),e.getPathEnd(b));this.m_xyStream=this.m_vertices.getAttributeStreamRef(0);a=this.insertPath(d,-1);this.setClosedPath(a,e.isClosedPath(b)||c);c=null!==this.m_segments||null!==e.getSegmentFlagsStreamRef();for(let g=e.getPathStart(b),
h=e.getPathEnd(b);g<h;g++){var f=this.insertVertex_(a,-1,null,!1);if(c)if(f=this.getVertexIndex(f),e.getSegmentFlags(g)&1)this.setSegmentToIndex(f,null);else{const k=new W;e.querySegment(g,k,!0);this.setSegmentToIndex(f,k.releaseSegment())}}e.isStrongPathStart(b)&&this.setStrongPathStart(a,!0);e.isStrongPathEnd(b)&&this.setStrongPathEnd(a,!0);return d}getGeometry(a){var b=this.getGeometryType(a);var c=this.m_verticesMp.getDescription();var d=null;c||(c=d=p.isMesh(b)?Kd():cb());d=null;switch(b){case p.GeometryType.enumPoint:d=
new Y({vd:c});break;case p.GeometryType.enumLine:d=new Z({vd:c});break;case p.GeometryType.enumBezier:d=new Gb({vd:c});break;case p.GeometryType.enumEllipticArc:d=new Hb({vd:c});break;case p.GeometryType.enumRationalBezier2:d=new lb({vd:c});break;case p.GeometryType.enumBezier2:d=new rc({vd:c});break;case p.GeometryType.enumEnvelope:d=new Ya({vd:c});break;case p.GeometryType.enumMultiPoint:d=new Oa({vd:c});break;case p.GeometryType.enumPolyline:d=new ma({vd:c});break;case p.GeometryType.enumPolygon:d=
new ba({vd:c});break;case p.GeometryType.enumMultipatch:p.geometryReleaseAssert(0);break;case p.GeometryType.enumGeometryCollection:d=new ue({vd:c});break;default:p.throwInvalidArgumentException("Geometry.create")}c=d;d=this.getPointCount(a);if(0===d)return c;if(p.isMultiPath(b)){b=c.getImpl();var e=this.getPathCount(a),f=hb(e+1),g=new Db(e+1,0),h=c.getDescription(),k=this.hasCurves();for(let y=0,z=h.getAttributeCount();y<z;y++){var m=h.getSemantics(y),n=K.getComponentCount(m),q=Hh(m,d),r=this.m_vertices.getAttributeStreamRef(m),
t=0;let A=0,C=0;for(let B=this.getFirstPath(a);-1!==B;B=this.getNextPath(B)){var u=0;this.isClosedPath(B)&&(u|=1);this.isExterior(B)&&(u|=8);this.isStrongPathStart(B)&&(u|=2);this.isStrongPathEnd(B)&&(u|=4);u&&g.setBits(A,u);u=this.getPathSize(B);f.write(A++,C);C+=u;if(0===m){u=r;var v=q,w=void 0;for(var x=this.getFirstVertex(B);t<C;x=this.getNextVertex(x),t++)w=this.getVertexIndex(x),w=u.readPoint2D(2*w),v.writePoint2D(2*t,w)}else for(u=this.getFirstVertex(B);t<C;u=this.getNextVertex(u),t++)for(v=
this.getVertexIndex(u),x=0;x<n;x++)w=r.readAsDbl(v*n+x),q.writeAsDbl(t*n+x,w)}b.setAttributeStreamRef(m,q);f.write(e,d)}b.setPathFlagsStreamRef(g);b.setPathStreamRef(f);b.notifyModifiedFlags(65535);if(k)for(e=d=0,a=this.getFirstPath(a);-1!==a;a=this.getNextPath(a))for(f=this.getPathSize(a),d+=f,f=this.getFirstVertex(a);e<d;f=this.getNextVertex(f))g=this.getSegment(f),null!==g&&g.isCurve()&&b.replaceSegment(e,g,!0),e++}else if(b===p.GeometryType.enumMultiPoint){b=c.getImpl();e=c.getDescription();b.reserve(d);
b.resizeNoInit(d);for(let y=0,z=e.getAttributeCount();y<z;y++){d=e.getSemantics(y);f=K.getComponentCount(d);g=b.getAttributeStreamRef(d);h=this.m_vertices.getAttributeStreamRef(d);k=0;n=this.getFirstPath(a);m=this.getPathSize(n);for(n=this.getFirstVertex(n);k<m;n=this.getNextVertex(n),k++)for(q=this.getVertexIndex(n),r=0;r<f;r++)t=h.readAsDbl(q*f+r),g.writeAsDbl(k*f+r,t);b.setAttributeStreamRef(d,g)}b.notifyModifiedFlags(65535)}else p.geometryReleaseAssert(0);return c}queryPointGeometryOnly(a,b){this.getGeometryType(a)!==
p.GeometryType.enumMultiPoint&&p.throwInvalidArgumentException("get_point_geometry_only");const c=this.getPointCount(a);1<c&&p.throwInvalidArgumentException("get_point_geometry_only");0===c?(b.assignVertexDescription(this.m_vertexDescription),b.setEmpty()):(a=this.getFirstPath(a),a=this.getFirstVertex(a),this.queryPoint(a,b))}removeGeometry(a){for(var b=this.getFirstPath(a);-1!==b;b=this.removePath(b));b=this.getPrevGeometry(a);const c=this.getNextGeometry(a);-1!==b?this.setNextGeometry(b,c):this.m_firstGeometry=
c;-1!==c?this.setPrevGeometry(c,b):this.m_lastGeometry=b;this.freeGeometry(a);return c}createGeometry(a,b){void 0===b&&(b=cb());a=this.newGeometry(a);this.m_vertices||(this.m_verticesMp=new Oa({vd:b}),this.m_vertices=this.m_verticesMp.getImpl());this.mergeVertexDescription(b);-1===this.m_firstGeometry?this.m_firstGeometry=a:(this.setPrevGeometry(a,this.m_lastGeometry),this.setNextGeometry(this.m_lastGeometry,a));return this.m_lastGeometry=a}getFirstGeometry(){return this.m_firstGeometry}getLastGeometry(){return this.m_lastGeometry}getNextGeometry(a){return this.m_geometryIndexList.getField(a,
1)}getPrevGeometry(a){return this.m_geometryIndexList.getField(a,0)}getGeometryType(a){return this.m_geometryIndexList.getField(a,2)&16777215}setGeometryUserIndex(a,b,c){b=this.m_geometryIndices[b];a=this.getGeometryIndex(a);a>=b.size()&&b.resize(Math.max(1.25*a,16),-1);b.write(a,c)}getGeometryUserIndex(a,b){a=this.getGeometryIndex(a);b=this.m_geometryIndices[b];return a<b.size()?b.read(a):-1}createGeometryUserIndex(){for(var a=0;a<this.m_geometryIndices.length;a++)if(null===this.m_geometryIndices[a])return this.m_geometryIndices[a]=
hb(0),a;this.m_geometryIndices.push(hb(0));a=this.m_geometryIndices.length-1;p.geometryReleaseAssert(0<=a&&a<=Number.MAX_SAFE_INTEGER);return a}removeGeometryUserIndex(a){for(this.m_geometryIndices[a]=null;0<this.m_geometryIndices.length&&null===this.m_geometryIndices.at(-1);)this.m_geometryIndices.pop()}getFirstPath(a){return this.m_geometryIndexList.getField(a,3)}getLastPath(a){return this.m_geometryIndexList.getField(a,4)}hasPointFeatures(){for(let a=this.getFirstGeometry();-1!==a;a=this.getNextGeometry(a))if(!p.isMultiPath(this.getGeometryType(a)))return!0;
return!1}getPointCount(a){return this.m_geometryIndexList.getField(a,5)}getPathCount(a){return this.m_geometryIndexList.getField(a,6)}filterClosePoints(a,b,c,d,e){a*=a;let f=0;const g=this.hasCurves(),h=this.hasSegmentParentage();for(let v=-1===e?this.getFirstGeometry():e;-1!==v;v=-1===e?this.getNextGeometry(v):-1){var k=this.getGeometryType(v);if(!p.isMultiPath(k))continue;if(c&&k!==p.GeometryType.enumPolygon)continue;k=this.getGeometryType(v)===p.GeometryType.enumPolygon;let w=this.getGeometryModified(v);
for(let x=this.getFirstPath(v);-1!==x;){var m=0;for(var n=this.getFirstVertex(x);m<Math.trunc(this.getPathSize(x)/2);){var q=this.getNextVertex(n);if(-1===q)break;var r=this.getXY(n),t=this.getXY(q);r=l.Point2D.sqrDistance(r,t);t=!0;do if(r<=a){if(g){var u=this.getSegment(n);if(null!==u&&(r=u.calculateLength2D(),r*=r,r>a))break}0===r?0===f&&(f=-1):f=1;q!==this.getLastVertex(x)&&(t=h&&(this.getSegmentParentageBreakVertex(n)||this.getSegmentParentageBreakVertex(q)),this.transferAllDataToTheVertex(q,
n),this.removeVertex(q,!1),d&&!w&&(this.setGeometryModified(v,!0),w=!0),h&&n!==q&&(this.setSegmentParentageBreakVertex(n,t),t=this.getNextVertex(n),p.geometryReleaseAssert(-1!==t),this.isDiscontinuousSegmentParentage(t)&&this.setSegmentParentageBreakVertex(t,!0)));t=!1}while(0);t&&(n=this.getNextVertex(n));m++}m=this.getFirstVertex(x);for(n=this.isClosedPath(x)?m:this.getLastVertex(x);0<this.getPathSize(x);)if(q=this.getPrevVertex(n),-1!==q){r=this.getXY(q);t=this.getXY(n);r=l.Point2D.sqrDistance(r,
t);t=!0;do if(r<=a){if(g&&(u=this.getSegment(q),null!==u&&(r=u.calculateLength2D(),r*=r,r>a)))break;0===r?0===f&&(f=-1):f=1;t=h&&(this.getSegmentParentageBreakVertex(n)||this.getSegmentParentageBreakVertex(q));this.removeVertex(q,!0);d&&!w&&(this.setGeometryModified(v,!0),w=!0);h&&q!==n&&(t||this.isDiscontinuousSegmentParentage(n))&&this.setSegmentParentageBreakVertex(n,!0);m===q&&(m=this.getFirstVertex(x));t=!1}while(0);if(t&&(n=this.getPrevVertex(n),n===m))break}else break;m=this.getPathSize(x);
(n=b&&m<(k?3:2))&&k&&2===m&&g&&(n=!this.pathHasCurves(x));n?(x=this.removePath(x),0===f&&(f=-1),d&&!w&&(this.setGeometryModified(v,!0),w=!0)):x=this.getNextPath(x)}}return f}filterClosePoints3D(a,b,c,d,e,f){p.geometryReleaseAssert(0);return 0}hasDegenerateSegments(a){for(let d=this.getFirstGeometry();-1!==d;d=this.getNextGeometry(d))if(p.isMultiPath(this.getGeometryType(d)))for(let e=this.getFirstPath(d);-1!==e;){const f=this.getPathSize(e);if(0===f)return!0;var b=this.getFirstVertex(e);for(let g=
0;g<f;g++){const h=this.getNextVertex(b);if(-1===h)break;b=this.getVertexIndex(b);var c=this.getSegmentFromIndex(b);let k=0;if(null!==c){if(k=c.calculateLowerLength2D(),k<=a){k=c.calculateUpperLength2D();if(k<=a)return!0;k=c.calculateLength2D();if(k<=a)return!0}}else if(c=this.getVertexIndex(h),k=this.m_vertices.getShortestDistance(b,c),k<=a)return!0;b=h}e=this.getNextPath(e)}return!1}hasDegenerateSegments3D(a,b){p.geometryReleaseAssert(0);return!1}transferAllDataToTheVertex(a,b){var c=this.getVertexIndex(a),
d=this.getVertexIndex(b);if(this.m_weights){var e=this.getWeightWithIndex(c);this.setWeightWithIndex(d,e)}this.m_ranks&&(e=this.getRankWithIndex(c),this.setRankWithIndex(d,e));this.m_segmentWeights&&(e=this.getSegmentWeightWithIndex(c),this.setSegmentWeightWithIndex(d,e));this.m_segmentRanks&&(c=this.getSegmentRankWithIndex(c),this.setSegmentRankWithIndex(d,c));for(let f=0,g=this.m_indices.length;f<g;f++)f!==this.m_selectionIndex&&null!==this.m_indices[f]&&(d=this.getUserIndex(a,f),-1!==d&&this.setUserIndex(b,
f,d));a=this.selected(a);d=this.selected(b);a!==d&&(a?this.select(b):this.unselect(b))}splitSegmentAxisAware(a,b,c,d,e){e=0;const f=this.getNextVertex(a);-1===f&&p.throwInvalidArgumentException("");const g=this.getVertexIndex(a),h=this.getVertexIndex(f);var k=this.getSegmentFromIndex(g),m=this.m_vertices.getShortestDistance(g,h);const n=this.getPathFromVertex(a),q=this.m_bHasAttributes;q&&k&&(m=k.calculateLength2D());a=this.getSegmentParentage(a);const r=this.getHelperPoint();if(k){var t=0;let w=
0;var u=-1;for(let x=0;x<c;x++){const y=b[x];if(t<y&&1>y){t=k.cut(t,y);null!==d&&(0<x&&t.setStartXY(d[x-1]),t.setEndXY(d[x]),t.normalizeAfterEndpointChange(),w=x);q&&(u=0<m?k.calculateSubLengthFromStart(y)/m:0,this.m_vertices.interpolateTwoVertices(g,h,u,r));r.setXY(t.getEndXY());u=this.insertVertex(n,f,r);e++;var v=this.getPrevVertex(u);v=this.getVertexIndex(v);this.setSegmentToIndex(v,t);-1!==a&&this.setSegmentParentageAndBreak(u,a,!1);t=y}}-1!==u&&(b=k.cut(t,1),null!==d&&(b.setStartXY(d[w]),b.normalizeAfterEndpointChange()),
c=this.getVertexIndex(u),this.setSegmentToIndex(c,b))}else for(m=0,d=0;d<c;d++)k=b[d],m<k&&1>k&&(this.m_vertices.interpolateTwoVertices(g,h,k,r),m=this.insertVertex(n,f,r),e++,-1!==a&&this.setSegmentParentageAndBreak(m,a,!1)),m=k;return e}splitSegment(a,b,c,d=null){return this.splitSegmentAxisAware(a,b,c,d,-1)}snapControlPoints(a,b,c){p.geometryReleaseAssert(0);return!1}snapControlPointsOnSelection(a){if(!this.hasCurves())return!1;let b=0;const c=this.queryVertexIteratorOnSelection();for(var d=c.next();-1!==
d;d=c.next())d=this.getVertexIndex(d),(d=this.getSegmentFromIndex(d))&&(b|=d.snapControlPoints(a)?1:0);return 0!==b}calculateSubLength2D(a,b,c){p.geometryReleaseAssert(0);return 0}setPoint(a,b,c){this.setPointOnly(a,b);if(null!==this.m_segments){var d=this.getVertexIndex(a);d=this.getSegmentFromIndex(d);null!==d&&(d.setStartXY(b.getXY()),d.normalizeAfterEndpointChange(),c&&d.ensureXYMonotone());a=this.getPrevVertex(a);-1!==a&&(a=this.getVertexIndex(a),a=this.getSegmentFromIndex(a),null!==a&&(a.setEndXY(b.getXY()),
a.normalizeAfterEndpointChange(),c&&a.ensureXYMonotone()))}}setPointEx(a,b,c,d,e){this.setPoint(a,b,e);a=this.getVertexIndex(a);this.setWeightWithIndex(a,d);this.setRankWithIndex(a,c)}setPointOnly(a,b){a=this.getVertexIndex(a);this.m_vertices.setPointByVal(a,b)}setPointOnlyEx(a,b,c,d){p.geometryReleaseAssert(0)}queryPoint(a,b){a=this.getVertexIndex(a);this.m_vertices.getPointByVal(a,b)}setXY(a,b){this.setXYCoords(a,b.x,b.y)}setXYCoords(a,b,c){var d=this.getVertexIndex(a);this.m_vertices?.setXYCoords(d,
b,c);null!==this.m_segments&&(d=this.getSegmentFromIndex(d),null!==d&&(d.setStartXYCoords(b,c),d.normalizeAfterEndpointChange()),a=this.getPrevVertex(a),-1!==a&&(a=this.getVertexIndex(a),a=this.getSegmentFromIndex(a),null!=a&&(a.setEndXYCoords(b,c),a.normalizeAfterEndpointChange())))}setXYMonotonic(a,b,c){var d=this.getVertexIndex(a);this.m_vertices.setXYCoords(d,b,c);if(null!==this.m_segments){d=this.getSegmentFromIndex(d);if(null!==d){const e=d.getEndXY();d.setCoordsForIntersector(new l.Point2D(b,
c),e,!1);d.ensureXYMonotone()}a=this.getPrevVertex(a);-1!==a&&(a=this.getVertexIndex(a),a=this.getSegmentFromIndex(a),null!==a&&(d=a.getStartXY(),a.setCoordsForIntersector(d,new l.Point2D(b,c),!1),a.ensureXYMonotone()))}}setXYMonotonicPoint2D(a,b){this.setXYMonotonic(a,b.x,b.y)}queryXY(a,b){a=this.getVertexIndex(a);return this.m_vertices.queryXY(a,b)}getXY(a){a=this.getVertexIndex(a);return this.m_vertices.getXY(a)}getXYWithIndex(a){return this.m_xyStream.readPoint2D(2*a)}static setSegDefault(a,b,
c){p.geometryReleaseAssert(0)}setXYZ(a,b,c){p.geometryReleaseAssert(0)}setXYZCoords(a,b,c,d){p.geometryReleaseAssert(0)}queryXYZ(a,b){p.geometryReleaseAssert(0)}getXYZ(a){p.geometryReleaseAssert(0);return X.getNAN()}getXYZWithIndex(a){p.geometryReleaseAssert(0);return X.getNAN()}mergeVertexDescription(a){this.m_verticesMp.mergeVertexDescription(a);this.m_vertexDescription=this.m_verticesMp.getDescription();this.m_bHasAttributes=1<this.m_vertexDescription.getAttributeCount()}addAttribute(a){p.geometryReleaseAssert(0)}getAttributeAsDbl(a,
b,c){return this.m_vertices.getAttributeAsDbl(a,this.getVertexIndex(b),c)}queryAttributeAsDbl(a,b,c,d){p.geometryReleaseAssert(0)}setAttribute(a,b,c,d){p.geometryReleaseAssert(0)}setAttributeInt(a,b,c,d){p.geometryReleaseAssert(0)}getVertexDescription(){return this.m_vertexDescription}getMinPathVertexY(a){p.geometryReleaseAssert(0);return 0}getVertexIndex(a){return this.m_vertexIndexList.getField(a,0)}getY(a){a=this.getVertexIndex(a);this.m_vertices.queryXY(a,this.m_workPoint2D);return this.m_workPoint2D.y}getX(a){return this.getXY(a).x}isEqualXY(a,
b){this.queryXY(a,this.m_workPoint2D);this.queryXY(b,this.m_workPoint2_2D);return this.m_workPoint2D.isEqualPoint2D(this.m_workPoint2_2D)}isEqualXYPoint2D(a,b){this.queryXY(a,this.m_workPoint2D);return this.m_workPoint2D.isEqualPoint2D(b)}isEqualXYZPoint3D(a,b){p.geometryReleaseAssert(0);return!1}setWeight(a,b){1>b&&(b=1);const c=1===b;if(null==this.m_weights){if(c)return;this.m_weights=Lc(this.m_vertices.getPointCount(),1)}a=this.getVertexIndex(a);if(a>=this.m_weights.size()){if(c)return;this.m_weights.resize(a+
1,1)}this.m_weights.write(a,b)}setWeightWithIndex(a,b){1>b&&(b=1);const c=1===b;if(null===this.m_weights){if(c)return;this.m_weights=Lc(this.m_vertices.getPointCount(),1)}if(a>=this.m_weights.size()){if(c)return;this.m_weights.resize(a+1,1)}this.m_weights.write(a,b)}getWeight(a){if(null===this.m_weights)return 1;a=this.getVertexIndex(a);return a>=this.m_weights.size()?1:this.m_weights.read(a)}getWeightWithIndex(a){return null===this.m_weights||a>=this.m_weights.size()?1:this.m_weights.read(a)}getRank(a){if(null===
this.m_ranks)return 1;a=this.getVertexIndex(a);return a>=this.m_ranks.size()?1:this.m_ranks.read(a)}getRankWithIndex(a){return null===this.m_ranks||a>=this.m_ranks.size()?1:this.m_ranks.read(a)}setRank(a,b){1>b&&(b=1);const c=1===b;if(null===this.m_ranks){if(c)return;this.m_ranks=hb(this.m_vertices.getPointCount(),1)}a=this.getVertexIndex(a);if(a>=this.m_ranks.size()){if(c)return;this.m_ranks.resize(a+1,1)}this.m_ranks.write(a,b)}setRankWithIndex(a,b){1>b&&(b=1);const c=1===b;if(null===this.m_ranks){if(c)return;
this.m_ranks=hb(this.m_vertices.getPointCount(),1)}if(a>=this.m_ranks.size()){if(c)return;this.m_ranks.resize(a+1,1)}this.m_ranks.write(a,b)}setSegmentWeight(a,b){1>b&&(b=1);const c=1===b;if(null===this.m_segmentWeights){if(c)return;this.m_segmentWeights=Lc(this.m_vertices.getPointCount(),1)}a=this.getVertexIndex(a);if(a>=this.m_segmentWeights.size()){if(c)return;this.m_segmentWeights.resize(a+1,1)}this.m_segmentWeights.write(a,b)}setSegmentWeightWithIndex(a,b){1>b&&(b=1);const c=1===b;if(null==this.m_segmentWeights){if(c)return;
this.m_segmentWeights=Lc(this.m_vertices.getPointCount(),1)}if(a>=this.m_segmentWeights.size()){if(c)return;this.m_segmentWeights.resize(a+1,1)}this.m_segmentWeights.write(a,b)}getSegmentWeight(a){if(null===this.m_segmentWeights)return 1;a=this.getVertexIndex(a);return a>=this.m_segmentWeights.size()?1:this.m_segmentWeights.read(a)}getSegmentWeightWithIndex(a){return null==this.m_segmentWeights||a>=this.m_segmentWeights.size()?1:this.m_segmentWeights.read(a)}getSegmentRank(a){if(null===this.m_segmentRanks)return Fa.st_defaultRank;
a=this.getVertexIndex(a);return a>=this.m_segmentRanks.size()?Fa.st_defaultRank:this.m_segmentRanks.read(a)}getSegmentRankWithIndex(a){return null===this.m_segmentRanks||a>=this.m_segmentRanks.size()?1:this.m_segmentRanks.read(a)}setSegmentRank(a,b){1>b&&(b=1);const c=1===b;if(null===this.m_segmentRanks){if(c)return;this.m_segmentRanks=hb(this.m_vertices.getPointCount(),1)}a=this.getVertexIndex(a);if(a>=this.m_segmentRanks.size()){if(c)return;this.m_segmentRanks.resize(a+1,1)}this.m_segmentRanks.write(a,
b)}setSegmentRankWithIndex(a,b){p.geometryReleaseAssert(0)}removeWeights(){p.geometryReleaseAssert(0);this.m_weights=new ic(0);this.m_segmentWeights=new ic(0)}removeRanks(){p.geometryReleaseAssert(0);this.m_ranks=new za(0);this.m_segmentRanks=new za(0)}setUserIndex(a,b,c){b=this.m_indices[b];a=this.getVertexIndex(a);if(b.size()<=a)if(-1!==c)b.resize(this.m_vertices.getPointCount(),-1);else return;b.write(a,c)}getUserIndex(a,b){a=this.getVertexIndex(a);b=this.m_indices[b];return a<b.size()?b.read(a):
-1}addToUserIndex(a,b,c){b=this.m_indices[b];a=this.getVertexIndex(a);b.size()<=a&&b.resize(this.m_vertices.getPointCount(),-1);const d=b.read(a);b.write(a,d+c)}createUserIndex(){for(var a=0;a<this.m_indices.length;a++)if(null===this.m_indices[a])return this.m_indices[a]=this.allocateIndex(),a;this.m_indices.push(this.allocateIndex());a=this.m_indices.length-1;p.geometryReleaseAssert(0<=a&&a<=l.intMax());return a}createUserIndexUninitialized(){for(var a=0;a<this.m_indices.length;a++)if(null===this.m_indices[a])return this.m_indices[a]=
this.allocateIndex(!1),a;this.m_indices.push(this.allocateIndex(!1));a=this.m_indices.length-1;p.geometryReleaseAssert(0<=a&&a<=Number.MAX_SAFE_INTEGER);return a}fillUserIndexForGeometry(a,b,c){b=this.m_indices[b];const d=b.size();for(a=this.getFirstPath(a);-1!==a;a=this.getNextPath(a)){let e=this.getFirstVertex(a);for(let f=0,g=this.getPathSize(a);f<g;f++,e=this.getNextVertex(e)){const h=this.getVertexIndex(e);h<d&&b.write(h,c)}}}fillUserIndexForSelection(a,b){p.geometryReleaseAssert(0)}removeUserIndex(a){this.recycleUserIndex(this.m_indices[a]);
for(this.m_indices[a]=null;0<this.m_indices.length&&null===this.m_indices[this.m_indices.length-1];)this.m_indices.pop()}replaceCurveWithLine(a){null!==this.m_segments&&(a=this.getVertexIndex(a),this.setSegmentToIndex(a,null))}queryLineConnector(a,b,c=!1){var d=this.getNextVertex(a);if(-1===d)return!1;!this.m_bHasAttributes||c?(a=this.getXY(a),b.setStartXY(a),d=this.getXY(d),b.setEndXY(d)):(c=new Y({vd:this.getVertexDescription()}),this.queryPoint(a,c),b.setStart(c),this.queryPoint(d,c),b.setEnd(c));
return!0}queryLineConnector3D(a,b,c){p.geometryReleaseAssert(0);return!1}hasCurves(){return null!==this.m_segments}geometryHasCurves(a){p.geometryReleaseAssert(0);return!1}pathHasCurves(a){if(!this.hasCurves())return!1;var b=this.getFirstVertex(a);if(-1===b)return!1;a=this.getPathSize(a);for(let c=0;c<a;c++,b=this.getNextVertex(b)){const d=this.getSegment(b);if(null!==d&&d.getGeometryType()!==p.GeometryType.enumLine)return!0}return!1}insertPath(a,b){let c=-1;-1!==b?(a!==this.getGeometryFromPath(b)&&
p.throwInvalidArgumentException(""),c=this.getPrevPath(b)):c=this.getLastPath(a);const d=this.newPath(a);-1!==b&&this.setPrevPath(b,d);this.setNextPath(d,b);this.setPrevPath(d,c);-1!==c?this.setNextPath(c,d):this.setFirstPath(a,d);-1===b&&this.setLastPath(a,d);this.setGeometryPathCount(a,this.getPathCount(a)+1);return d}removePath(a){const b=this.getPrevPath(a),c=this.getNextPath(a),d=this.getGeometryFromPath(a);-1!==b?this.setNextPath(b,c):this.setFirstPath(d,c);-1!==c?this.setPrevPath(c,b):this.setLastPath(d,
b);this.clearPath(a);this.setGeometryPathCount(d,this.getPathCount(d)-1);this.freePath(a);return c}clearPath(a){var b=this.getFirstVertex(a);if(-1!==b){for(let c=0,d=this.getPathSize(a);c<d;c++){const e=b;b=this.getNextVertex(b);this.freeVertex(e)}b=this.getGeometryFromPath(a);this.setGeometryVertexCount(b,this.getPointCount(b)-this.getPathSize(a))}this.setPathSize(a,0)}getNextPath(a){return this.m_pathIndexList.getField(a,2)}getPrevPath(a){return this.m_pathIndexList.getField(a,1)}getPathSize(a){return this.m_pathIndexList.getField(a,
3)}isClosedPath(a){return 0!==(this.getPathFlags(a)&1)}setClosedPath(a,b){if(this.isClosedPath(a)!==b){if(0<this.getPathSize(a)){var c=this.getFirstVertex(a);const d=this.getLastVertex(a);b?(this.setNextVertex(d,c),this.setPrevVertex(c,d),c=this.getVertexIndex(d),this.setSegmentToIndex(c,null)):(this.setNextVertex(d,-1),this.setPrevVertex(c,-1),c=this.getVertexIndex(d),this.setSegmentToIndex(c,null))}c=this.getPathFlags(a);this.setPathFlags(a,(c|1)-1|(b?1:0))}}closeAllPaths(a){p.geometryReleaseAssert(0)}isStrongPathStart(a){return 0!==
(this.getPathFlags(a)&8)}isStrongPathEnd(a){return 0!==(this.getPathFlags(a)&16)}setStrongPathStart(a,b){const c=this.getPathFlags(a);this.setPathFlags(a,(c|8)-8|(b?8:0))}setStrongPathEnd(a,b){const c=this.getPathFlags(a);this.setPathFlags(a,(c|16)-16|(b?16:0))}getGeometryFromPath(a){return this.m_pathIndexList.getField(a,7)}isExterior(a){return 0!==(this.getPathFlags(a)&2)}setExterior(a,b){const c=this.getPathFlags(a);this.setPathFlags(a,(c|2)-2|(b?2:0))}getRingArea(a){if(this.isRingAreaValid(a))return this.m_pathAreas[this.getPathIndex(a)];
var b=this.getFirstVertex(a);if(-1===b)return 0;var c=this.getXY(b),d=new l.KahanSummator(0);const e=this.getPathSize(a);if(2<e){c=c.clone();var f=c.x;const g=c.y;let h=this.getNextVertex(b);const k=this.getXY(h);h=this.getNextVertex(h);const m=l.Point2D.getNAN();for(let n=2;n<e;n++,h=this.getNextVertex(h))this.queryXY(h,m),d.pe((m.x-c.x)*(k.y-g)),c.setCoordsPoint2D(k),k.setCoordsPoint2D(m);d.pe((f-c.x)*(k.y-g))}if(this.hasCurves())for(c=0;c<e;c++,b=this.getNextVertex(b))f=this.getSegment(b),null!==
f&&f.getGeometryType()!==p.GeometryType.enumLine&&(f=2*f.calculateArea2DHelper(),d.pe(f));this.setRingAreaValid(a,!0);d=.5*d.getResult();return this.m_pathAreas[this.getPathIndex(a)]=d}getPathIndexInternal(a){return this.getPathIndex(a)}getPathInternalIndexFromVertex(a){return this.getPathIndex(this.getPathFromVertex(a))}setPathUserIndex(a,b,c){b=this.m_pathindices[b];a=this.getPathIndex(a);b.size()<this.m_pathAreas.length&&b.resize(this.m_pathAreas.length,-1);b.write(a,c)}getPathUserIndex(a,b){a=
this.getPathIndex(a);b=this.m_pathindices[b];return a<b.size()?b.read(a):-1}createPathUserIndex(){for(var a=0;a<this.m_pathindices.length;a++)if(null===this.m_pathindices[a])return this.m_pathindices[a]=this.allocatePathIndex(),a;this.m_pathindices.push(this.allocatePathIndex());a=this.m_pathindices.length-1;p.geometryReleaseAssert(0<=a&&a<=Number.MAX_SAFE_INTEGER);return a}fillPathUserIndexForGeometry(a,b,c){b=this.m_pathindices[b];const d=b.size();for(a=this.getFirstPath(a);-1!==a;a=this.getNextPath(a)){const e=
this.getPathIndex(a);e<d&&b.write(e,c)}}removePathUserIndex(a){this.recyclePathUserIndex(this.m_pathindices[a]);for(this.m_pathindices[a]=null;0<this.m_pathindices.length&&null===this.m_pathindices.at(-1);)this.m_pathindices.pop()}movePath(a,b,c){-1===c&&p.throwInvalidArgumentException("");if(b!==c){var d=this.getNextPath(c),e=this.getPrevPath(c),f=this.getGeometryFromPath(c);-1===e?this.setFirstPath(f,d):this.setNextPath(e,d);-1===d?this.setLastPath(f,e):this.setPrevPath(d,e);this.setGeometryVertexCount(f,
this.getPointCount(f)-this.getPathSize(c));this.setGeometryPathCount(f,this.getPathCount(f)-1);e=-1===b?this.getLastPath(a):this.getPrevPath(b);this.setPrevPath(c,e);this.setNextPath(c,b);-1===b?this.setLastPath(a,c):this.setPrevPath(b,c);-1===e?this.setFirstPath(a,c):this.setNextPath(e,c);this.setGeometryVertexCount(a,this.getPointCount(a)+this.getPathSize(c));this.setGeometryPathCount(a,this.getPathCount(a)+1);this.setPathGeometry(c,a)}}addVertex(a,b){this.m_vertices.getPointByVal(this.getVertexIndex(b),
this.getHelperPoint());return this.insertVertex_(a,-1,this.getHelperPoint(),!1)}insertVertex(a,b,c){return this.insertVertex_(a,b,c,!0)}removeVertex(a,b){var c=this.getPathFromVertex(a),d=this.getPrevVertex(a);const e=this.getNextVertex(a);-1!==d&&this.setNextVertex(d,e);const f=this.getPathSize(c);a===this.getFirstVertex(c)&&this.setFirstVertex(c,1<f?e:-1);-1!==e&&this.setPrevVertex(e,d);a===this.getLastVertex(c)&&this.setLastVertex(c,1<f?d:-1);if(this.hasCurves()&&-1!==d&&-1!==e){var g=this.getVertexIndex(a);
d=this.getVertexIndex(d);const h=this.getVertexIndex(e);b?(d=this.getSegmentFromIndex(d),null!==d&&(b=this.m_vertices.getXY(h),d.setEndXY(b),d.normalizeAfterEndpointChange()),this.setSegmentToIndex(g,null)):(b=this.getSegmentFromIndex(g),this.setSegmentToIndex(g,null),null!==b&&(g=this.m_vertices.getXY(d),b.setStartXY(g),b.normalizeAfterEndpointChange()),this.setSegmentToIndex(d,b))}this.setPathSize(c,f-1);c=this.getGeometryFromPath(c);this.setGeometryVertexCount(c,this.getPointCount(c)-1);this.freeVertex(a);
return e}removeVertices(a,b){p.geometryReleaseAssert(a!==b);const c=this.getPathFromVertex(a);var d=this.getPrevVertex(a);const e=this.getPrevVertex(b);-1!==d&&this.setNextVertex(d,b);let f=this.getPathSize(c);var g=this.getVertexIndex(a);this.setSegmentToIndex(g,null);this.setPrevVertex(b,d);this.setPrevVertex(a,-1);this.setNextVertex(e,-1);d=0;g=this.getFirstVertex(c);let h=!1;for(;;){const k=this.getNextVertex(a);h||=g===a;this.freeVertex(a);d++;if(a===e)break;a=k}f-=d;h&&this.setFirstVertex(c,
0<f?b:-1);this.setPathSize(c,f);b=this.getGeometryFromPath(c);this.setGeometryVertexCount(b,this.getPointCount(b)-d)}getFirstVertex(a){return this.m_pathIndexList.getField(a,4)}getLastVertex(a){return this.m_pathIndexList.getField(a,5)}getNextVertex(a){return this.m_vertexIndexList.getField(a,2)}getPrevVertex(a){return this.m_vertexIndexList.getField(a,1)}getNextVertexEx(a,b){return 0<b?this.m_vertexIndexList.getField(a,2):this.m_vertexIndexList.getField(a,1)}getPrevVertexEx(a,b){return 0<b?this.m_vertexIndexList.getField(a,
1):this.m_vertexIndexList.getField(a,2)}getPathFromVertex(a){return this.m_vertexIndexList.getField(a,3)}addPoint(a,b){return this.insertVertex_(a,-1,b,!1)}getGeometryFromVertex(a){return this.getGeometryFromPath(this.getPathFromVertex(a))}replaceNaNs(a,b){this.m_vertexDescription.hasAttribute(a)||p.throwInternalErrorException("");this.m_vertices.replaceNaNs(a,b)}removeNaNVertices(){for(let a=this.getFirstGeometry();-1!==a;a=this.getNextGeometry(a))for(let b=this.getFirstPath(a);-1!==b;b=this.getNextPath(b)){let c=
this.getFirstVertex(b);for(let d=0,e=this.getPathSize(b);d<e;d++)c=this.getXY(c).isFinite()?this.getNextVertex(c):this.removeVertex(c,!0)}}queryVertexIterator(a=-1){return this.queryVertexIteratorEx(!1,a)}queryVertexIteratorEx(a,b=-1){let c=-1,d=-1,e=-1,f=-1,g=0,h=!1;for(c=-1!==b?b:this.getFirstGeometry();-1!==c;c=this.getNextGeometry(c))if(!a||p.isMultiPath(this.getGeometryType(c))){for(d=this.getFirstPath(c);-1!==d;d=this.getNextPath(d))if(f=e=this.getFirstVertex(d),g=0,-1!==e){h=!0;break}if(h||
-1!==b)break}h||(c=-1);return Gf.create_(this,c,d,e,f,g,a,!1,-1!==b)}queryVertexIteratorOnSelection(a=-1){return this.m_selection?Gf.create_(this,a,-1,-1,-1,-1,!1,!0,-1!==a):this.queryVertexIteratorEx(!1,a)}hasSelection(){return this.m_selection}createEmptySelection(){p.geometryReleaseAssert(0)}removeSelection(){this.m_selection&&(this.m_selectedVertices.length=0,this.removeUserIndex(this.m_selectionIndex),this.m_selectionIndex=-1,this.m_selection=!1,this.m_selectedCount=0)}select(a){if(this.selected(a))return!0;
this.setUserIndex(a,this.m_selectionIndex,this.m_selectedVertices.length);this.m_selectedVertices.push(a);this.m_selectedCount++;return!1}unselect(a){if(this.m_selection){var b=this.getUserIndex(a,this.m_selectionIndex);0<=b&&(this.m_selectedVertices[b]=-1,this.setUserIndex(a,this.m_selectionIndex,-1),this.m_selectedCount--)}}selected(a){return!this.m_selection||this.selected_(a)}getSelectedCount(){return this.m_selection?this.m_selectedCount:this.getTotalPointCount()}createSelectionForCrackingAndClustering(a,
b){p.geometryReleaseAssert(0);return!1}peelALoop(a,b){this.peelALoop_(a,b,!1)}peelALoopIntoAPath(a,b){return this.peelALoop_(a,b,!0)}applyTransformation(a){this.m_verticesMp.applyTransformation(a);if(null!==this.m_segments)for(let b=0,c=this.m_segments.length;b<c;b++)this.m_segments[b]&&this.m_segments[b].applyTransformation(a)}setGeometryType(a,b){this.m_geometryIndexList.setField(a,2,b)}splitSegmentWithIntersector(a,b,c,d,e){d?this.splitSegmentForward(a,b,c,!0,e):this.splitSegmentBackward(a,b,c,
!0,e)}setPrevVertex(a,b){this.m_vertexIndexList.setField(a,1,b)}setNextVertex(a,b){this.m_vertexIndexList.setField(a,2,b)}setPathToVertex(a,b){this.m_vertexIndexList.setField(a,3,b)}setPathSize(a,b){this.m_pathIndexList.setField(a,3,b)}setFirstVertex(a,b){this.m_pathIndexList.setField(a,4,b)}setLastVertex(a,b){this.m_pathIndexList.setField(a,5,b)}getSegment(a){return null!=this.m_segments?(a=this.getVertexIndex(a),this.getSegmentFromIndex(a)):null}isCurve(a){p.geometryReleaseAssert(0);return!1}querySegment(a,
b,c=!0,d=!1){const e=this.getNextVertex(a);if(-1===e)return!1;const f=this.getSegment(a);if(!f){if(c)return!1;this.queryLineConnector(a,b.createLine(),d);return!0}b.copyFrom(f,!0);if(d)return!0;1<this.m_vertexDescription.getAttributeCount()&&(c=this.getHelperPoint(),this.queryPoint(a,c),b.get().setStart(c),this.queryPoint(e,c),b.get().setEnd(c));return!0}getSegmentFromIndex(a){return(a=null!==this.m_segments&&this.m_segments.length>a?this.m_segments[a]:null)?a:null}getAndClearSegmentFromIndex(a){return(a=
null!==this.m_segments&&this.m_segments.length>a?this.m_segments[a]:null)?a:null}setSegmentToIndex(a,b){this.m_bHasForceSetEnvelope=!1;if(null===this.m_segments){if(!b)return;this.m_segments=[];this.m_segments.length=this.m_vertices.getPointCount()}a>=this.m_segments.length&&(this.m_segments.length=a+1);this.m_segments[a]=b}setGeometryPathCount(a,b){this.m_geometryIndexList.setField(a,6,b)}setGeometryVertexCount(a,b){this.m_geometryIndexList.setField(a,5,b)}ringParentageCheckInternal(a,b){p.geometryReleaseAssert(0);
return!1}reverseRingInternal(a){const b=this.hasCurves(),c=this.hasSegmentParentage();var d=null;let e=-1;var f=a;b&&(d=this.getVertexIndex(f),d=this.getAndClearSegmentFromIndex(d));c&&(e=this.getSegmentParentage(f));do{var g=this.getPrevVertex(f);const h=this.getNextVertex(f);this.setNextVertex(f,g);this.setPrevVertex(f,h);b&&(f=this.getVertexIndex(h),g=this.getSegmentFromIndex(f),d&&d.reverse(),this.setSegmentToIndex(f,d),d=g);c&&(f=this.getSegmentParentage(h),this.setSegmentParentagePreserveBreak(h,
e),e=f);f=h}while(f!==a);this.dbgVerifyIntegrity(a)}setTotalPointCount(a){this.m_pointCount=a}removePathOnly(a){const b=this.getPrevPath(a),c=this.getNextPath(a),d=this.getGeometryFromPath(a);-1!==b?this.setNextPath(b,c):this.setFirstPath(d,c);-1!==c?this.setPrevPath(c,b):this.setLastPath(d,b);this.setFirstVertex(a,-1);this.setLastVertex(a,-1);this.freePath(a)}insertClosedPath(a,b,c,d,e){a=this.insertPath(a,-1);b=0;var f=c;for(e[0]=!1;f===d&&(e[0]=!0),this.setPathToVertex(f,a),b++,f=this.getNextVertex(f),
f!==c;);this.setClosedPath(a,!0);this.setPathSize(a,b);e[0]&&(c=d);this.setFirstVertex(a,c);this.setLastVertex(a,this.getPrevVertex(c));this.setRingAreaValid(a,!1);return a}findVertex2D(a,b){p.geometryReleaseAssert(0);return 0}findVertex3D(a,b,c){p.geometryReleaseAssert(0);return 0}dbgVerifyMonotone(){}dbgCheckSelection(){}dbgVerifySegment(a){}dbgVerifyIntegrity(a,b){}dbgVerifyVertexCounts(){}dbgVerifyCurves(){}dbgDumpGeometry(a,b){p.geometryReleaseAssert(0)}removeVertexInternal(a,b){var c=this.getPrevVertex(a);
const d=this.getNextVertex(a);-1!==c&&this.setNextVertex(c,d);-1!==d&&this.setPrevVertex(d,c);if(this.hasCurves()&&-1!==c&&-1!==d){var e=this.getVertexIndex(a);c=this.getVertexIndex(c);const f=this.getVertexIndex(d);b?(c=this.getSegmentFromIndex(c),null!==c&&(b=this.m_vertices.getXY(f),c.setEndXY(b),c.normalizeAfterEndpointChange()),this.setSegmentToIndex(e,null)):(b=this.getSegmentFromIndex(e),this.setSegmentToIndex(e,null),null!==b&&(e=this.m_vertices.getXY(c),b.setStartXY(e),b.normalizeAfterEndpointChange()),
this.setSegmentToIndex(c,b))}this.freeVertex(a);return d}isRingAreaValid(a){return 0!==(this.getPathFlags(a)&4)}setRingAreaValid(a,b){const c=this.getPathFlags(a);this.setPathFlags(a,(c|4)-4|(b?4:0))}compareVerticesSimpleY(a,b){this.queryXY(a,this.m_workPoint2D);this.queryXY(b,this.m_workPoint2_2D);return this.m_workPoint2D.compare(this.m_workPoint2_2D)}compareVerticesSimpleY3D(a,b){return this.getXYZ(a).compare(this.getXYZ(b))}compareVerticesSimpleX(a,b){return this.getXY(a).compareX(this.getXY(b))}sortVerticesSimpleByYHeapMerge(a,
b){p.geometryReleaseAssert(0)}sortVerticesSimpleByY(a,b,c){this.m_bucketSort.sort(a,b,c,new An(this))}sortVerticesSimpleByX(a,b,c){p.geometryReleaseAssert(0)}sortVerticesSimpleByY3D(a,b,c){p.geometryReleaseAssert(0)}snapVertexForPoleClipping(a,b){var c=this.getPrevVertex(a);-1!==c&&this.replaceCurveWithLine(c);-1!==this.getNextVertex(a)&&this.replaceCurveWithLine(a);c=new l.Point2D;this.queryXY(a,c);c.y=b;this.setXY(a,c)}setSegmentParentageAndBreak(a,b,c=!0){if(-1===this.m_segmentParentageIndex){if(-1===
b)return;this.m_segmentParentageIndex=this.createUserIndex()}0<=b&&(p.geometryReleaseAssert(b<=l.indexTypeMax()>>1),b=b<<1|(c?1:0));this.setUserIndex(a,this.m_segmentParentageIndex,b)}setSegmentParentagePreserveBreak(a,b){p.geometryReleaseAssert(-1<=b);if(-1===this.m_segmentParentageIndex){if(-1===b)return;this.m_segmentParentageIndex=this.createUserIndex()}if(0<=b){p.geometryReleaseAssert(b<=l.indexTypeMax()>>1);b<<=1;const c=this.getSegmentParentageBreakVertex(a);b|=c?1:0}this.setUserIndex(a,this.m_segmentParentageIndex,
b)}getSegmentParentage(a){if(-1===this.m_segmentParentageIndex)return-1;a=this.getUserIndex(a,this.m_segmentParentageIndex);return 0>a?a:a>>1}getOriginalSegmentInfo(a){return-1!==this.m_segmentParentageIndex?(a=this.getSegmentParentage(a),new Hg(a)):new Hg(-1)}setSegmentParentageBreakVertex(a,b){if(-1!==this.m_segmentParentageIndex){var c=this.getUserIndex(a,this.m_segmentParentageIndex);0>c||!!(c&1)===b||(c=b?c|1:c&l.indexTypeMax()>>1<<1,this.setUserIndex(a,this.m_segmentParentageIndex,c))}}getSegmentParentageBreakVertex(a){if(-1===
this.m_segmentParentageIndex)return!0;a=this.getUserIndex(a,this.m_segmentParentageIndex);return 0>a||0!==(a&1)}isDiscontinuousSegmentParentage(a){var b=this.getPrevVertex(a);if(-1===b)return!1;b=this.getSegmentParentage(b);a=this.getSegmentParentage(a);return b!==a}setCurveStitcherPointer(a){this.m_curveStitcher=a}hasSegmentParentage(){return-1!==this.m_segmentParentageIndex}deleteSegmentParentage(){-1!==this.m_segmentParentageIndex&&(this.removeUserIndex(this.m_segmentParentageIndex),this.m_segmentParentageIndex=
-1);this.m_curveStitcher=null}clearSegments(){this.m_segments=null}}Fa.st_defaultRank=1;class Dc{constructor(a,b,c){void 0===a?(this.x=new l.ECoordinate,this.y=new l.ECoordinate,this.z=new l.ECoordinate):a instanceof X?(this.x=new l.ECoordinate(a.x),this.y=new l.ECoordinate(a.y),this.z=new l.ECoordinate(a.z)):a instanceof l.ECoordinate?(this.x=a.clone(),this.y=b.clone(),this.z=c.clone()):p.throwInvalidArgumentException("EPoint3D constructor")}dotProduct(a){return this.x.mulE(a.x).addE(this.y.mulE(a.y)).addE(this.z.mulE(a.z))}crossProduct(a){return new Dc(this.y.mulE(a.z).subE(this.z.mulE(a.y)),
this.z.mulE(a.x).subE(this.x.mulE(a.z)),this.x.mulE(a.y).subE(this.y.mulE(a.x)))}crossProductVector(a){const b=this.y.mulE(a.z).subE(a.y.mulE(this.z)),c=a.x.mulE(this.z).subE(this.x.mulE(a.z));a=this.x.mulE(a.y).subE(a.x.mulE(this.y));return new Dc(b,c,a)}sqrLength(){return this.x.mulE(this.x).addE(this.y.mulE(this.y)).addE(this.z.mulE(this.z))}length(){return this.sqrLength().sqrt()}static distance(a,b){return a.sub(b).length()}negate(){return new Dc(this.x.negate(),this.y.negate(),this.z.negate())}add(a){return new Dc(this.x.addE(a.x),
this.y.addE(a.y),this.z.addE(a.z))}sub(a){return new Dc(this.x.subE(a.x),this.y.subE(a.y),this.z.subE(a.z))}subThis(a){this.x.subThisE(a.x);this.y.subThisE(a.y);this.z.subThisE(a.z);return this}addThis(a){this.x.addThisE(a.x);this.y.addThisE(a.y);this.z.addThisE(a.z);return this}mul(a){return new Dc(this.x.mulE(a),this.y.mulE(a),this.z.mulE(a))}div(a){return new Dc(this.x.divE(a),this.y.divE(a),this.z.divE(a))}eq(a){return this.x.eq(a.x)&&this.y.eq(a.y)&&this.z.eq(a.z)}isZero(){return this.x.isZero()&&
this.y.isZero()&&this.z.isZero()}value(){return X.construct(this.x.value(),this.y.value(),this.z.value())}}class xm{constructor(a){this.m_origin=new X;this.m_normal=new X;this.m_axisX=new X;this.m_axisY=new X;p.geometryReleaseAssert(0)}assign(a){p.geometryReleaseAssert(0);return this}set(a,b,c,d){p.geometryReleaseAssert(0)}setFromPoints(a,b,c){p.geometryReleaseAssert(0);return!1}getCoord(a,b){p.geometryReleaseAssert(0);return{}}getCoord2D(a){p.geometryReleaseAssert(0);return{}}getCoordX(a,b){p.geometryReleaseAssert(0);
return 0}getCoordY(a,b){p.geometryReleaseAssert(0);return 0}getCoordZ(a,b){p.geometryReleaseAssert(0);return 0}setPreferredAxisX(a){p.geometryReleaseAssert(0)}getOrigin(){p.geometryReleaseAssert(0);return{}}getNormal(){p.geometryReleaseAssert(0);return{}}getAxisX(){return this.m_axisX.clone()}getAxisY(){return this.m_axisY.clone()}setAxisX(a,b){p.geometryReleaseAssert(0)}setAxisY(a,b){p.geometryReleaseAssert(0)}recalculateAxisY(){p.geometryReleaseAssert(0)}setOrigin(a){p.geometryReleaseAssert(0)}setNormal(a,
b){p.geometryReleaseAssert(0)}intersect(a,b){p.geometryReleaseAssert(0);return!1}intersectLine(a){p.geometryReleaseAssert(0);return 0}intersectLineEx(a,b){p.geometryReleaseAssert(0);return 0}closestCoordinate(a){p.geometryReleaseAssert(0);return{}}projectVector(a){p.geometryReleaseAssert(0);return{}}signedDistance(a){p.geometryReleaseAssert(0);return 0}distance(a){p.geometryReleaseAssert(0);return 0}}class Rb{constructor(a,b){this.m_shape=new Fa;this.m_verticesOnExtentIndex=this.m_geometry=-1;this.m_verticesOnExtent=
[];this.m_progressCounter=0;this.m_extent=new D(a);this.m_progressTracker=b}progress_(){}clipMultiPath2(a,b,c){return a.getGeometryType()===p.GeometryType.enumPolygon?this.clipPolygonOrProjectedPolyline2(a,c):this.clipPolyline(a,b)}clipPolygonOrProjectedPolyline2(a,b){const c=a.getGeometryType()===p.GeometryType.enumPolyline;if(0===this.m_extent.width()||0===this.m_extent.height())return a.createInstance();const d=D.constructEmpty();a.queryLooseEnvelope(d);this.m_geometry=c?this.m_shape.addGeometry(a):
this.m_shape.addGeometry(a,this.m_extent);const e=D.constructEmpty(),f=D.constructEmpty(),g=new l.Point2D,h=new l.Point2D,k=Array(9),m=Array(9),n=l.makeObjectArray(l.Point2D,9);var q=null;const r=new Z,t=[];let u=!1;for(let E=0;!u&&4>E;E++){var v=!1;const G=0!==(E&1);let I=0;switch(E){case 0:I=this.m_extent.xmin;v=d.xmin<=I&&d.xmax>=I;break;case 1:I=this.m_extent.ymin;v=d.ymin<=I&&d.ymax>=I;break;case 2:I=this.m_extent.xmax;v=d.xmin<=I&&d.xmax>=I;break;case 3:I=this.m_extent.ymax,v=d.ymin<=I&&d.ymax>=
I}if(v)for(u=!0,v=this.m_shape.getFirstPath(this.m_geometry);-1!==v;){let H=!0;var w=-1;let L=-1;const M=this.m_shape.getFirstVertex(v);let N=M;do{this.progress_();var x=q=this.m_shape.getSegment(N);if(null===x){var y=this.m_shape.getNextVertex(N);if(-1===y){p.geometryReleaseAssert(c);0===w&&t.push(N);break}this.m_shape.queryXY(N,g);r.setStartXY(g);this.m_shape.queryXY(y,h);r.setEndXY(h);x=r}x.queryLooseEnvelope(e);y=Rb.checkSegmentIntersection(e,E,I);x.isCurve()&&0===y&&x.isCurve()&&(r.setStartXY(x.getStartXY()),
r.setEndXY(x.getEndXY()),this.m_shape.replaceCurveWithLine(N),x=r,r.queryEnvelope(e),y=Rb.checkSegmentIntersection(e,E,I));var z=0;q=-1;if(-1===y){z=x.intersectionWithAxis2D(G,I,k,m);if(0<z){var A=null;if(x.isCurve()){A=n;p.geometryReleaseAssert(9>=z);for(var C=0;C<z;C++)G?n[C].setCoords(k[C],I):n[C].setCoords(I,k[C]);z=this.m_shape.splitSegmentAxisAware(N,m,z,A,G?1:0)}else z=this.m_shape.splitSegmentAxisAware(N,m,z,null,-1)}else z=0;z+=1;A=N;C=this.m_shape.getNextVertex(A);x=null;for(x=0;x<z;x++){this.m_shape.queryXY(A,
g);this.m_shape.queryXY(C,h);var B=q=this.m_shape.getSegment(A);null===B&&(r.setStartXY(g),r.setEndXY(h),B=r);B.queryEnvelope(f);q=Rb.checkSegmentIntersection(f,E,I);B.isCurve()&&0===q&&(this.m_shape.replaceCurveWithLine(A),r.setStartXY(g),r.setEndXY(h),B=r,B.queryEnvelope(f),q=Rb.checkSegmentIntersection(f,E,I));-1===q&&(G?Math.abs(g.y-I)<Math.abs(h.y-I)?(g.y=I,this.m_shape.setXY(A,g)):(h.y=I,this.m_shape.setXY(C,h)):Math.abs(g.x-I)<Math.abs(h.x-I)?(g.x=I,this.m_shape.setXY(A,g)):(h.x=I,this.m_shape.setXY(C,
h)),B=q=this.m_shape.getSegment(A),null===B&&(r.setStartXY(g),r.setEndXY(h),B=r),B.queryEnvelope(f),q=Rb.checkSegmentIntersection(f,E,I),-1===q&&(q=Rb.checkSegmentIntersectionLoose(f,E,I)));B=w;w=q;-1===L&&(L=w);0===B&&1===w||1===B&&0===w||0!==B||0!==w||t.push(A);1===w&&(H=u=!1);q=A=C;C=this.m_shape.getNextVertex(C)}}0===z&&(z=w,w=y,-1===L&&(L=w),0===z&&1<=w||1<=z&&0===w||0===z&&0===w&&t.push(N),1===w&&(H=u=!1),q=this.m_shape.getNextVertex(N));N=q;if(256<=t.length){for(let Q=1,O=t.length-1;Q<O;Q++)y=
t[Q],c?this.m_shape.snapVertexForPoleClipping(y,I):this.m_shape.removeVertex(y,!1);t[1]=t.at(-1);t.length=2}}while(N!==M);if(!H){0!==L||!c&&0!==w&&2!==w||t.push(M);for(let Q=0,O=t.length;Q<O;Q++)w=t[Q],c?this.m_shape.snapVertexForPoleClipping(w,I):this.m_shape.removeVertex(w,!1)}t.length=0;v=H||0===this.m_shape.getPathSize(v)?this.m_shape.removePath(v):this.m_shape.getNextPath(v)}}if(u)return a.createInstance();q=null;c?this.removeSpikesAlongPoles():this.resolveBoundaryOverlaps();0<b&&this.densifyAlongClipExtent(b);
b=this.m_shape.getGeometry(this.m_geometry);b.getGeometryType()===p.GeometryType.enumPolygon&&b.setFillRule(a.getFillRule());return b}clipPolyline(a,b){b=D.constructEmpty();const c=D.constructEmpty(),d=Array(9),e=Array(9),f=new W;let g=a;const h=D.constructEmpty();a.queryLooseEnvelope(h);for(let t=0;4>t;t++){var k=!1;const u=0!==(t&1);let v=0;switch(t){case 0:v=this.m_extent.xmin;k=h.xmin<=v&&h.xmax>=v;break;case 1:v=this.m_extent.ymin;k=h.ymin<=v&&h.ymax>=v;break;case 2:v=this.m_extent.xmax;k=h.xmin<=
v&&h.xmax>=v;break;case 3:v=this.m_extent.ymax,k=h.ymin<=v&&h.ymax>=v}if(!k)continue;k=g;g=a.createInstance();k=k.getImpl().querySegmentIterator();k.resetToFirstPath();const w=new l.Point2D,x=new l.Point2D;for(;k.nextPath();){var m=-1;let y=!0;for(;k.hasNextSegment();){this.progress_();const z=k.nextSegment(),A=z.isDegenerate(0);z.queryLooseEnvelope(b);var n=Rb.checkSegmentIntersection(b,t,v);if(-1===n){n=z.intersectionWithAxis2D(u,v,d,e);var q=0;w.assign(z.getStartXY());for(let C=0;C<=n;C++){m=C<
n?e[C]:1;if(q===m)continue;z.queryCut(q,m,f,!1);const B=f.get();var r=!1;B.getStartXY().equals(w)||(B.setStartXY(w),r=!0);C<n&&(u?(x.x=d[C],x.y=v):(x.x=v,x.y=d[C]),B.getEndXY().equals(x)||(B.setEndXY(x),r=!0));r&&B.normalizeAfterEndpointChange();if(A||!B.isDegenerate(0)){B.queryEnvelope(c);r=Rb.checkSegmentIntersection(c,t,v);if(-1===r){q=B.getStartXY();const E=B.getEndXY();r=!1;u?Math.abs(q.y-v)<Math.abs(E.y-v)?(q.y=v,B.setStartXY(q),q.equals(B.getStartXY())||(B.setStartXY(q),r=!0)):(E.y=v,E.equals(B.getEndXY())||
(B.setEndXY(E),r=!0)):Math.abs(q.x-v)<Math.abs(E.x-v)?(q.x=v,q.equals(B.getStartXY())||(B.setStartXY(q),r=!0)):(E.x=v,E.equals(B.getEndXY())||(B.setEndXY(E),r=!0));r&&B.normalizeAfterEndpointChange();B.queryEnvelope(c);r=Rb.checkSegmentIntersection(c,t,v);-1===r&&(r=Rb.checkSegmentIntersectionLoose(c,t,v))}w.assign(B.getEndXY());q=m;m=r;1<=m?(g.addSegment(B,y),y=!1):y=!0}}}else m=n,1<=m?(g.addSegment(z,y),y=!1):y=!0}}}return g}static checkSegmentIntersection(a,b,c){switch(b){case 0:return a.xmin<
c&&a.xmax<=c?0:a.xmin>=c?a.xmax===c?2:1:-1;case 1:return a.ymin<c&&a.ymax<=c?0:a.ymin>=c?a.ymax===c?2:1:-1;case 2:return a.xmin>=c&&a.xmax>c?0:a.xmax<=c?a.xmin===c?2:1:-1;case 3:return a.ymin>=c&&a.ymax>c?0:a.ymax<=c?a.ymin===c?2:1:-1}p.geometryReleaseAssert(0);return 0}static checkSegmentIntersectionLoose(a,b,c){p.geometryReleaseAssert(0);return 0}resolveBoundaryOverlaps(){this.m_verticesOnExtentIndex=-1;this.splitSegments(!1,this.m_extent.xmin);this.splitSegments(!1,this.m_extent.xmax);this.splitSegments(!0,
this.m_extent.ymin);this.splitSegments(!0,this.m_extent.ymax);this.m_verticesOnExtent.length=0;this.m_verticesOnExtentIndex=this.m_shape.createUserIndex();const a=new l.Point2D;for(let b=this.m_shape.getFirstPath(this.m_geometry);-1!==b;b=this.m_shape.getNextPath(b)){let c=this.m_shape.getFirstVertex(b);for(let d=0,e=this.m_shape.getPathSize(b);d<e;d++,c=this.m_shape.getNextVertex(c))if(this.progress_(),this.m_shape.queryXY(c,a),this.m_extent.xmin===a.x||this.m_extent.xmax===a.x||this.m_extent.ymin===
a.y||this.m_extent.ymax===a.y)this.m_shape.setUserIndex(c,this.m_verticesOnExtentIndex,this.m_verticesOnExtent.length),this.m_verticesOnExtent.push(c)}this.dbgCheckPathFirst();this.resolveOverlaps(!1,this.m_extent.xmin);this.dbgCheckPathFirst();this.resolveOverlaps(!1,this.m_extent.xmax);this.dbgCheckPathFirst();this.resolveOverlaps(!0,this.m_extent.ymin);this.dbgCheckPathFirst();this.resolveOverlaps(!0,this.m_extent.ymax);this.fixPaths()}densifyAlongClipExtent(a){const b=new l.Point2D(0,0),c=new l.Point2D(0,
0),d=Array(2048);for(let h=this.m_shape.getFirstPath(this.m_geometry);-1!==h;h=this.m_shape.getNextPath(h)){const k=this.m_shape.getFirstVertex(h);let m=k;do{const n=this.m_shape.getNextVertex(m);this.m_shape.queryXY(m,b);let q=-1;b.x===this.m_extent.xmin?(this.m_shape.queryXY(n,c),c.x===this.m_extent.xmin&&(q=1)):b.x===this.m_extent.xmax&&(this.m_shape.queryXY(n,c),c.x===this.m_extent.xmax&&(q=1));b.y===this.m_extent.ymin?(this.m_shape.queryXY(n,c),c.y===this.m_extent.ymin&&(q=0)):b.y===this.m_extent.ymax&&
(this.m_shape.queryXY(n,c),c.y===this.m_extent.ymax&&(q=0));if(-1===q){m=n;continue}if(this.isCurve(m)){m=n;continue}const r=b.clone(),t=new l.Point2D(0,0);if(q){var e=b.y-this.m_extent.ymin;t.y=l.sign(c.y-b.y);r.y=a*l.copySign(Math.floor(Math.abs(e)/a),e)+this.m_extent.ymin;0>t.y&&(r.y+=a)}else e=b.x-this.m_extent.xmin,t.x=l.sign(c.x-b.x),r.x=a*l.copySign(Math.floor(Math.abs(e)/a),e)+this.m_extent.xmin,0>t.x&&(r.x+=a);e=q?c.y-b.y:c.x-b.x;var f=Math.abs(e);65536<f/a&&p.throwInternalErrorException("");
if(0<f){f=Math.trunc(f/a)+2;d.length<f&&(d.length=f);f=0;for(let u=0;;u++){var g=r.add(t.mul(u*a));g=(q?g.y-b.y:g.x-b.x)/e;if(1<=g)break;0>=g||(p.geometryReleaseAssert(f<=d.length),d[f]=g,f++)}0!==f&&this.m_shape.splitSegment(m,d,f)}m=n}while(m!==k)}}splitSegments(a,b){var c=-1;const d=new l.Point2D,e=[];for(var f=this.m_shape.getFirstPath(this.m_geometry);-1!==f;f=this.m_shape.getNextPath(f)){var g=this.m_shape.getFirstVertex(f),h=-1;for(let v=0,w=this.m_shape.getPathSize(f);v<w;v++,g=h)if(this.progress_(),
h=this.m_shape.getNextVertex(g),this.m_shape.queryXY(g,d),a?d.y===b:d.x===b)this.m_shape.queryXY(h,d),(a?d.y!==b:d.x!==b)||this.isCurve(g)||(-1===c&&(c=this.m_shape.createUserIndex()),1!==this.m_shape.getUserIndex(g,c)&&(e.push(g),this.m_shape.setUserIndex(g,c,1)),1!==this.m_shape.getUserIndex(h,c)&&(e.push(h),this.m_shape.setUserIndex(h,c,1)))}-1!==c&&this.m_shape.removeUserIndex(c);if(!(3>e.length)){e.sort((v,w)=>this.compareVertices(v,w));c=new l.Point2D;f=new l.Point2D;g=new l.Point2D;f.setNAN();
var k=-1;h=[];var m=[],n=this.m_shape.createUserIndex(),q=this.m_shape.createUserIndex();for(let v=0,w=e.length;v<w;v++)if(this.m_shape.queryXY(e[v],d),!d.isEqualPoint2D(f))if(-1===k)k=v,f.setCoordsPoint2D(d);else{for(;k<v;k++){var r=e[k],t=this.m_shape.getNextVertex(r),u=this.m_shape.getPrevVertex(r);let x=!1;this.m_shape.queryXY(t,c);0>f.compare(c)&&(a?c.y===b:c.x===b)&&!this.isCurve(r)&&(h.push(r),x=!0,this.m_shape.setUserIndex(r,q,1));this.m_shape.queryXY(u,c);0>f.compare(c)&&(a?c.y===b:c.x===
b)&&!this.isCurve(u)&&(x||h.push(r),this.m_shape.setUserIndex(r,n,1))}for(let x=0,y=h.length;x<y;x++)k=h[x],t=this.m_shape.getUserIndex(k,n),r=this.m_shape.getUserIndex(k,q),1===t&&(t=this.m_shape.getPrevVertex(k),this.m_shape.queryXY(t,g),u=0,g.isEqualPoint2D(d)||(u=l.Point2D.distance(f,g),u=l.Point2D.distance(g,d)/u,0===u?u=Number.EPSILON:1===u&&(u=1-Number.EPSILON),this.m_shape.splitSegment(t,[u],1),t=this.m_shape.getPrevVertex(k),this.m_shape.setXY(t,d),m.push(t),this.m_shape.setUserIndex(t,n,
1),this.m_shape.setUserIndex(t,q,-1))),1===r&&(r=this.m_shape.getNextVertex(k),this.m_shape.queryXY(r,g),r=0,g.isEqualPoint2D(d)||(r=l.Point2D.distance(f,g),r=l.Point2D.distance(f,d)/r,0===r?r=Number.EPSILON:1===r&&(r=1-Number.EPSILON),this.m_shape.splitSegment(k,[r],1),k=this.m_shape.getNextVertex(k),this.m_shape.setXY(k,d),m.push(k),this.m_shape.setUserIndex(k,n,-1),this.m_shape.setUserIndex(k,q,1)));k=h;h=m;m=k;m.length=0;k=v;f.setCoordsPoint2D(d)}this.m_shape.removeUserIndex(n);this.m_shape.removeUserIndex(q)}}resolveOverlaps(a,
b){const c=new l.Point2D,d=[];let e=-1;for(let r=0,t=this.m_verticesOnExtent.length;r<t;r++){this.progress_();var f=this.m_verticesOnExtent[r];if(-1!==f){var g=this.m_shape.getNextVertex(f);this.m_shape.queryXY(f,c);if(a?c.y===b:c.x===b)this.m_shape.queryXY(g,c),(a?c.y!==b:c.x!==b)||this.isCurve(f)||(-1===e&&(e=this.m_shape.createUserIndex()),-2!==this.m_shape.getUserIndex(f,e)&&(d.push(f),this.m_shape.setUserIndex(f,e,-2)),-2!==this.m_shape.getUserIndex(g,e)&&(d.push(g),this.m_shape.setUserIndex(g,
e,-2)))}}if(0===d.length)-1!==e&&this.m_shape.removeUserIndex(e);else{p.geometryReleaseAssert(-1!==e);d.sort((r,t)=>this.compareVertices(r,t));for(let r=0,t=d.length;r<t;r++)this.m_shape.setUserIndex(d[r],e,r);f=new l.Point2D;g=new l.Point2D;g.setNAN();var h=-1;for(let r=0,t=d.length;r<t;r++){this.progress_();var k=d[r];if(-1!==k&&(this.m_shape.queryXY(k,c),!c.isEqualPoint2D(g))){if(-1!==h)for(;;){k=!1;const u=r;for(let v=h;v<u;v++){const w=d[v];if(-1===w)continue;let x=-1;var m=this.m_shape.getNextVertex(w);
this.m_shape.queryXY(m,f);0>g.compare(f)&&(a?f.y===b:f.x===b)&&(this.isCurve(w)||(x=m));m=-1;var n=this.m_shape.getPrevVertex(w);this.m_shape.queryXY(n,f);0>g.compare(f)&&(a?f.y===b:f.x===b)&&(this.isCurve(n)||(m=n));if(-1!==x&&-1!==m)this.beforeRemoveVertex(w,d,e),this.m_shape.removeVertex(w,!1),this.beforeRemoveVertex(x,d,e),this.m_shape.removeVertex(x,!1),k=!0;else if(-1!==x||-1!==m){for(n=v+1;n<r;n++){const y=d[n];if(-1===y)continue;var q=this.m_shape.getNextVertex(y);let z=-1;this.m_shape.queryXY(q,
f);0>g.compare(f)&&(a?f.y===b:f.x===b)&&(this.isCurve(y)||(z=q));q=this.m_shape.getPrevVertex(y);let A=-1;this.m_shape.queryXY(q,f);0>g.compare(f)&&(a?f.y===b:f.x===b)&&(this.isCurve(q)||(A=q));if(-1!==z&&-1!==A){this.beforeRemoveVertex(y,d,e);this.m_shape.removeVertex(y,!1);this.beforeRemoveVertex(z,d,e);this.m_shape.removeVertex(z,!1);k=!0;break}if(-1!==x&&-1!==A){this.removeOverlap(d,w,x,y,A,e);k=!0;break}else if(-1!==m&&-1!==z){this.removeOverlap(d,y,z,w,m,e);k=!0;break}}if(k)break}}if(!k)break}h=
r;g.setCoordsPoint2D(c)}}this.m_shape.removeUserIndex(e)}}beforeRemoveVertex(a,b,c){c=this.m_shape.getUserIndex(a,c);p.geometryReleaseAssert(0<=c);b[c]=-1;c=this.m_shape.getUserIndex(a,this.m_verticesOnExtentIndex);p.geometryReleaseAssert(0<=c);this.m_verticesOnExtent[c]=-1;b=this.m_shape.getPathFromVertex(a);-1!==b&&this.m_shape.getFirstVertex(b)===a&&(this.m_shape.setFirstVertex(b,-1),this.m_shape.setLastVertex(b,-1))}removeOverlap(a,b,c,d,e,f){this.m_shape.setNextVertex(b,d);this.m_shape.setPrevVertex(d,
b);this.m_shape.setPrevVertex(c,e);this.m_shape.setNextVertex(e,c);this.beforeRemoveVertex(d,a,f);this.m_shape.removeVertexInternal(d,!1);this.beforeRemoveVertex(e,a,f);this.m_shape.removeVertexInternal(e,!0)}removeSpikesAlongPoles(){this.removeSpikesOnPole(this.m_extent.ymin);this.removeSpikesOnPole(this.m_extent.ymax)}removeSpikesOnPole(a){for(let c=this.m_shape.getFirstPath(this.m_geometry);-1!==c;c=this.m_shape.getNextPath(c)){var b=this.m_shape.getPathSize(c);if(3>b)continue;let d=this.m_shape.getFirstVertex(c);
const e=new l.Point2D;this.m_shape.queryXY(d,e);let f=e.y===a&&!this.isCurve(d);d=this.m_shape.getNextVertex(d);const g=new l.Point2D;this.m_shape.queryXY(d,g);let h=g.y===a&&!this.isCurve(d);d=this.m_shape.getNextVertex(d);const k=new l.Point2D;for(let m=0,n=b-2;m<n;m++,d=this.m_shape.getNextVertex(d))this.progress_(),this.m_shape.queryXY(d,k),b=k.y===a,h&&f&&b&&0>=(g.x-e.x)*(k.x-g.x)?this.m_shape.removeVertex(this.m_shape.getPrevVertex(d),!1):(e.setCoordsPoint2D(g),f=h),g.setCoordsPoint2D(k),h=
b&&!this.isCurve(d)}}fixPaths(){for(let h=0,k=this.m_verticesOnExtent.length;h<k;h++){var a=this.m_verticesOnExtent[h];-1!==a&&this.m_shape.setPathToVertex(a,-1)}a=this.m_shape.hasCurves();var b=0;let c=0;for(var d=this.m_shape.getFirstPath(this.m_geometry);-1!==d;){var e=this.m_shape.getFirstVertex(d);if(-1===e||d!==this.m_shape.getPathFromVertex(e))e=d,d=this.m_shape.getNextPath(d),this.m_shape.setFirstVertex(e,-1),this.m_shape.removePathOnly(e);else{var f=e,g=0;do this.m_shape.setPathToVertex(f,
d),g++,f=this.m_shape.getNextVertex(f);while(f!==e);this.m_shape.setRingAreaValid(d,!1);this.m_shape.setLastVertex(d,this.m_shape.getPrevVertex(e));this.m_shape.setPathSize(d,g);c+=g;b++;d=this.m_shape.getNextPath(d)}}for(let h=0,k=this.m_verticesOnExtent.length;h<k;h++){g=this.m_verticesOnExtent[h];if(-1===g)continue;d=this.m_shape.getPathFromVertex(g);if(-1!==d)continue;d=this.m_shape.insertPath(this.m_geometry,-1);let m=!1;e=0;f=g;do this.m_shape.setPathToVertex(g,d),e++,a&&2>=e&&(m||=this.isCurve(g)),
g=this.m_shape.getNextVertex(g);while(g!==f);(m?0===e:2>=e)?(g=this.m_shape.getUserIndex(f,this.m_verticesOnExtentIndex),p.geometryReleaseAssert(0<=g),this.m_verticesOnExtent[g]=-1,f=this.m_shape.removeVertex(f,!1),2===e&&(g=this.m_shape.getUserIndex(f,this.m_verticesOnExtentIndex),0<=g&&(this.m_verticesOnExtent[g]=-1),this.m_shape.removeVertex(f,!1)),e=d,d=this.m_shape.getNextPath(d),this.m_shape.setFirstVertex(e,-1),this.m_shape.removePathOnly(e)):(this.m_shape.setClosedPath(d,!0),this.m_shape.setPathSize(d,
e),this.m_shape.setFirstVertex(d,f),this.m_shape.setLastVertex(d,this.m_shape.getPrevVertex(f)),this.m_shape.setRingAreaValid(d,!1),c+=e,b++)}this.m_shape.setGeometryPathCount(this.m_geometry,b);this.m_shape.setGeometryVertexCount(this.m_geometry,c);a=0;for(b=this.m_shape.getFirstGeometry();-1!==b;b=this.m_shape.getNextGeometry(b))a+=this.m_shape.getPointCount(b);this.m_shape.setTotalPointCount(a)}dbgCheckPathFirst(){}isCurve(a){return null!==this.m_shape.getSegment(a)?!0:!1}compareVertices(a,b){const c=
new l.Point2D;this.m_shape.queryXY(a,c);a=new l.Point2D;this.m_shape.queryXY(b,a);return c.compare(a)}clipPolesOut(a,b){return this.clipPolygonOrProjectedPolyline2(a,b)}}let Eg=class a{static constructDefault(b){return new a(0,0,0,b,!1,l.intMax())}constructor(b,c,d,e,f,g){this.m_segmentBuffer=null;this.m_dummyPoint=new Y;this.m_progressCounter=0;this.m_progressTracker=e;this.m_bSetDensifyFlag=f;this.m_maxLength=b;this.m_maxDeviation=c;this.m_maxAngle=d>l.halfPi()?l.halfPi():d;this.m_cosMaxAngle=Math.cos(this.m_maxAngle);
this.m_bOnlyCurveDensify=0<this.m_maxAngle||0<this.m_maxDeviation;this.m_maxSegmentsPerCurve=g;p.checkAndThrow(0<this.m_maxSegmentsPerCurve,"this.m_maxSegmentsPerCurve \x3e 0");this.m_minStep=1/this.m_maxSegmentsPerCurve}densify(b){return this.densifyGeom(b)}densifySegment(b,c){p.geometryReleaseAssert(0)}densifyEx(b,c,d,e,f,g){this.m_maxLength=c;this.m_maxDeviation=d;this.m_maxAngle=e>l.halfPi()?l.halfPi():e;this.m_cosMaxAngle=Math.cos(this.m_maxAngle);this.m_bOnlyCurveDensify=0<this.m_maxAngle||
0<this.m_maxDeviation;this.m_bSetDensifyFlag=f;this.m_maxSegmentsPerCurve=g;p.checkAndThrow(0<this.m_maxSegmentsPerCurve,"this.m_maxSegmentsPerCurve \x3e 0");this.m_minStep=1/this.m_maxSegmentsPerCurve;return this.densifyGeom(b)}densifyGeom(b){if(b.isEmpty()||1>b.getDimension())return b;const c=b.getGeometryType();if(p.isMesh(c))return b;if(p.isMultiPath(c))return this.densifyMultiPath(b);if(p.isSegment(c))return this.densifySegmentImpl(b);if(c===p.GeometryType.enumEnvelope)return this.densifyEnvelope(b);
p.throwInternalErrorException("")}densifySegmentEx(b,c,d,e,f){var g=b.getGeometryType();0<this.m_maxLength||this.m_bOnlyCurveDensify&&g!==p.GeometryType.enumLine||e&&!d?g===p.GeometryType.enumBezier?this.densifyCubicBezier(b,c,d,e,f):g===p.GeometryType.enumRationalBezier2?this.densifyRationalBezier2(b,c,d,e,f):g===p.GeometryType.enumBezier2?this.densifyBezier2(b,c,d,e,f):g===p.GeometryType.enumEllipticArc&&!b.isLine()&&.25>b.getMinorMajorRatio()?this.densifyEllipticArc(b,c,d,e,f):(g=1,0<this.m_maxLength&&
(g=this.calculateLengthSubdivisionStep(b,this.m_maxLength)),0<this.m_maxDeviation&&(g=Math.min(g,this.calculateDeviationSubdivisionStep(b,this.m_maxDeviation))),0<this.m_maxAngle&&(g=Math.min(g,this.calculateAngularSubdivisionStep(b,this.m_maxAngle))),this.densifySegmentByLength(b,g,c,d,e,f)):c?g===p.GeometryType.enumLine?c.addSegment(b,d):(d&&(b.queryStart(this.m_dummyPoint),c.startPathPoint(this.m_dummyPoint)),b.queryEnd(this.m_dummyPoint),c.lineToPoint(this.m_dummyPoint)):(d&&f.push(0),f.push(1))}densifyMultiPath(b){if(!b.hasNonLinearSegments()){if(1===
b.getDescription().getAttributeCount())return this.densifyMultiPathLinear(b);if(!(0<this.m_maxLength))return b}const c=b.createInstance();c.getGeometryType()===p.GeometryType.enumPolygon&&c.setFillRule(b.getFillRule());c.reserve(b.getPointCount());for(b=b.getImpl().querySegmentIterator();b.nextPath();){let d=!0;for(;b.hasNextSegment();){const e=b.nextSegment(),f=b.isClosingSegment();this.densifySegmentEx(e,c,d,f,null);f&&c.closePathWithLine();d=!1}}return c}densifySegmentImpl(b){const c=new ma({vd:b.getDescription()});
this.densifySegmentEx(b,c,!0,!1,[0]);return c}densifyEnvelope(b){const c=new ba({vd:b.getDescription()});c.addEnvelope(b,!1);var d=D.constructEmpty();b.queryEnvelope(d);b=d.width();d=d.height();return!(0<this.m_maxLength)||b<=this.m_maxLength&&d<=this.m_maxLength?c:this.densifyMultiPath(c)}densifyMultiPathLinear(b){if(!(0<this.m_maxLength))return b;const c=b.createInstance();c.getGeometryType()===p.GeometryType.enumPolygon&&c.setFillRule(b.getFillRule());c.reserve(b.getPointCount());const d=c.getImpl();
b=b.getImpl();const e=b.getAttributeStreamRef(0),f=new Z;for(let r=0,t=b.getPathCount();r<t;r++){var g=b.isClosedPath(r);if(0!==b.getPathSize(r)){var h=b.getPathStart(r),k=e.readPoint2D(2*h),m=k.clone();d.startPath(k);for(let u=h+1,v=b.getPathEnd(r);u<v;u++){h=e.readPoint2D(2*u);var n=l.Point2D.distance(m,h);if(n>this.m_maxLength){var q=Math.ceil(n/this.m_maxLength);q>l.intMax()&&(q=l.intMax());n=1/q;let w,x;0>m.compare(h)?(f.setStartXY(m),f.setEndXY(h),w=0,x=1):(f.setStartXY(h),f.setEndXY(m),w=q-
2,x=-1);for(let y=0,z=q-1;y<z;y++,w+=x){this.progress_();q=n*(w+1);const A=new l.Point2D;f.queryCoord2D(q,A);d.lineTo(A);this.m_bSetDensifyFlag&&d.setAttribute(10,d.getPointCount()-1,0,1)}}else this.progress_();c.lineTo(h);m.assign(h)}if(g){g=l.Point2D.distance(m,k);if(g>this.m_maxLength){h=k;g=Math.ceil(g/this.m_maxLength);g>l.intMax()&&(g=l.intMax());k=1/g;0>m.compare(h)?(f.setStartXY(m),f.setEndXY(h),m=0,h=1):(f.setStartXY(h),f.setEndXY(m),m=g-2,h=-1);n=new l.Point2D(0,0);for(let u=0,v=g-1;u<v;u++,
m+=h)this.progress_(),g=k*(m+1),f.queryCoord2D(g,n),d.lineTo(n),this.m_bSetDensifyFlag&&d.setAttribute(10,d.getPointCount()-1,0,1)}d.closePathWithLine()}}}return c}densifySegmentByLength(b,c,d,e,f,g){p.geometryReleaseAssert(b.getGeometryType()!==p.GeometryType.enumBezier);let h=b.getStartXY().compare(b.getEndXY());0===h&&1>c&&(b.getGeometryType()===p.GeometryType.enumEllipticArc?h=0>b.getSweepAngle()?1:-1:p.geometryReleaseAssert(0));let k=0;e&&(d?(b.queryStart(this.m_dummyPoint),d.startPathPoint(this.m_dummyPoint)):
g.push(0),++k);1>c*this.m_maxSegmentsPerCurve&&(c=1/this.m_maxSegmentsPerCurve);if(1>c){this.m_segmentBuffer||(this.m_segmentBuffer=new W);var m=Math.ceil(1/c);m>l.intMax()&&(m=l.intMax());c=1/m;this.m_segmentBuffer.create(b.getGeometryType());let n=b,q,r;0>h?(q=0,r=1):(b.copyTo(this.m_segmentBuffer.get()),this.m_segmentBuffer.get().reverse(),q=m-2,r=-1,n=this.m_segmentBuffer.get());const t=m-1;for(let u=0;u<t;u++,q+=r)m=c*(q+1),d?(n.queryCoord(m,this.m_dummyPoint),d.lineToPoint(this.m_dummyPoint),
this.m_bSetDensifyFlag&&1!==m&&0!==m&&d.setAttribute(10,d.getPointCount()-1,0,1)):g.push(0<h?1-m:m),this.progress_();m=1;k+=t}if(!f||f&&e&&2>k)d?(b.queryEnd(this.m_dummyPoint),d.lineToPoint(this.m_dummyPoint)):g.push(1)}densifyCubicBezier(b,c,d,e,f){var g=new Gb;let h=b;var k=b.calculateUpperLength2D(),m=b.getStartXY().compare(b.getEndXY());0===m&&0<k&&(k=l.makeObjectArray(l.Point2D,4),b.queryControlPoints(k),m=k[1].compare(k[2]),0===m&&(m=k[1].compare(k[0])));0<m&&(b.copyTo(g),g.reverse(),h=g);g=
0;d&&(c?(b.queryStart(this.m_dummyPoint),c.startPathPoint(this.m_dummyPoint)):f.push(0),++g);b=[];k=[];const n=Math.trunc(Math.log2(this.m_maxSegmentsPerCurve));let q=!0,r=0;if(0<m)for(b.push([h.getStartXY(),h.getControlPoint1(),h.getControlPoint2(),h.getEndXY(),new l.Point2D(0,1)]),k.push(0);b.length;){this.progress_();var t=b.at(-1);m=k.at(-1);var u=t[4].x,v=t[4].y;if(m<n&&this.bezierNeedsSplit(t)){q&&(r=h.findMinDeriv(),q=!1);var w=.5*(u+v);Math.abs(r-w)<.4*(v-u)&&(w=r);var x=(w-u)/(v-u),y=t[0].mul(1-
x).add(t[1].mul(x)),z=t[1].mul(1-x).add(t[2].mul(x)),A=t[2].mul(1-x).add(t[3].mul(x)),C=y.mul(1-x).add(z.mul(x));z=z.mul(1-x).add(A.mul(x));x=C.mul(1-x).add(z.mul(x));var B=t[3];t[1]=y;t[2]=C;t[3]=x;t[4].setCoords(u,w);t=[x,z,A,B,new l.Point2D(w,v)];b.push(t);k[k.length-1]=m+1;k.push(m+1)}else if(b.pop(),k.pop(),0<b.length||!e||e&&d&&2>g)c?(h.queryCoord(u,this.m_dummyPoint),c.lineToPoint(this.m_dummyPoint),this.m_bSetDensifyFlag&&1!==u&&0!==u&&c.setAttribute(10,c.getPointCount()-1,0,1)):f.push(1-
u),++g}else for(b.push([h.getStartXY(),h.getControlPoint1(),h.getControlPoint2(),h.getEndXY(),new l.Point2D(0,1)]),k.push(0);b.length;)if(this.progress_(),t=b.at(-1),m=k.at(-1),u=t[4].x,v=t[4].y,m<n&&this.bezierNeedsSplit(t))q&&(r=h.findMinDeriv(),q=!1),w=.5*(u+v),Math.abs(r-w)<.4*(v-u)&&(w=r),x=(w-u)/(v-u),y=t[0].mul(1-x).add(t[1].mul(x)),z=t[1].mul(1-x).add(t[2].mul(x)),A=t[2].mul(1-x).add(t[3].mul(x)),C=y.mul(1-x).add(z.mul(x)),z=z.mul(1-x).add(A.mul(x)),x=C.mul(1-x).add(z.mul(x)),B=t[0],t[0]=
x,t[1]=z,t[2]=A,t[4].setCoords(w,v),t=[B,y,C,x,new l.Point2D(u,w)],b.push(t),k[k.length-1]=m+1,k.push(m+1);else if(b.pop(),k.pop(),0<b.length||!e||e&&d&&2>g)c?(h.queryCoord(v,this.m_dummyPoint),c.lineToPoint(this.m_dummyPoint),this.m_bSetDensifyFlag&&1!==v&&0!==v&&c.setAttribute(10,c.getPointCount()-1,0,1)):f.push(v),++g}densifyRationalBezier2(b,c,d,e,f){var g=new lb;let h=b;var k=b.calculateUpperLength2D();let m=b.getStartXY().compare(b.getEndXY());0===m&&0<k&&(m=0);0<m&&(b.copyTo(g),g.reverse(),
h=g);g=0;d&&(c?(b.queryStart(this.m_dummyPoint),c.startPathPoint(this.m_dummyPoint)):f.push(0),++g);b=Math.trunc(Math.log2(this.m_maxSegmentsPerCurve));k=new lb;const n=[],q=[];n.push(new l.Envelope1D(0,1));for(q.push(0);n.length;){this.progress_();var r=n.at(-1).clone();const t=q.at(-1);if(t<b&&this.rationalBezier2NeedsSplit(h,k,r.vmin,r.vmax)){const u=r.getCenter();0<m?(n.at(-1).vmax=u,n.push(new l.Envelope1D(u,r.vmax))):(n.at(-1).vmin=u,n.push(new l.Envelope1D(r.vmin,u)));q[q.length-1]=t+1;q.push(t+
1)}else if(n.pop(),q.pop(),0<n.length||!e||e&&d&&2>g)r=0<m?r.vmin:r.vmax,c?(h.queryCoord(r,this.m_dummyPoint),c.lineToPoint(this.m_dummyPoint),this.m_bSetDensifyFlag&&1!==r&&0!==r&&c.setAttribute(10,c.getPointCount()-1,0,1)):f.push(0<m?1-r:r),++g}}densifyBezier2(b,c,d,e,f){var g=new rc;let h=b;var k=b.calculateUpperLength2D();let m=b.getStartXY().compare(b.getEndXY());0===m&&0<k&&(m=0);0<m&&(b.copyTo(g),g.reverse(),h=g);g=0;d&&(c?(b.queryStart(this.m_dummyPoint),c.startPathPoint(this.m_dummyPoint)):
f.push(0),++g);b=Math.ceil(Math.log2(this.m_maxSegmentsPerCurve));k=new rc;const n=[],q=[];n.push(new l.Envelope1D(0,1));for(q.push(0);n.length;){this.progress_();var r=n.at(-1).clone();const t=q.at(-1);if(t<b&&this.bezier2NeedsSplit(h,k,r.vmin,r.vmax)){const u=r.getCenter();0<m?(n.at(-1).vmax=u,n.push(new l.Envelope1D(u,r.vmax))):(n.at(-1).vmin=u,n.push(new l.Envelope1D(r.vmin,u)));q[q.length-1]=t+1;q.push(t+1)}else if(n.pop(),q.pop(),0<n.length||!e||e&&d&&2>g)r=0<m?r.vmin:r.vmax,c?(h.queryCoord(r,
this.m_dummyPoint),c.lineToPoint(this.m_dummyPoint),this.m_bSetDensifyFlag&&1!==r&&0!==r&&c.setAttribute(10,c.getPointCount()-1,0,1)):f.push(0<m?1-r:r),++g}}densifyEllipticArc(b,c,d,e,f){var g=new Hb;let h=b;var k=b.calculateUpperLength2D();let m=b.getStartXY().compare(b.getEndXY());0===m&&0<k&&(m=b.isClockwise()?0:1);0<m&&(b.copyTo(g),g.reverse(),h=g);g=0;d&&(c?(b.queryStart(this.m_dummyPoint),c.startPathPoint(this.m_dummyPoint)):f.push(0),++g);b=Math.trunc(Math.log2(this.m_maxSegmentsPerCurve));
k=new Hb;const n=[],q=[];n.push(new l.Envelope1D(0,1));for(q.push(0);n.length;){this.progress_();var r=n.at(-1).clone();const t=q.at(-1);if(t<b&&this.ellipticArcNeedsSplit(h,k,r.vmin,r.vmax)){const u=r.getCenter();0<m?(n.at(-1).vmax=u,n.push(new l.Envelope1D(u,r.vmax))):(n.at(-1).vmin=u,n.push(new l.Envelope1D(r.vmin,u)));q[q.length-1]=t+1;q.push(t+1)}else if(n.pop(),q.pop(),0<n.length||!e||e&&d&&2>g)r=0<m?r.vmin:r.vmax,c?(h.queryCoord(r,this.m_dummyPoint),c.lineToPoint(this.m_dummyPoint),this.m_bSetDensifyFlag&&
1!==r&&0!==r&&c.setAttribute(10,c.getPointCount()-1,0,1)):f.push(0<m?1-r:r),++g}}calculateLengthSubdivisionStep(b,c){const d=b.calculateUpperLength2D();if(!b.isCurve())return d?c/d:1;if(b.getGeometryType()===p.GeometryType.enumEllipticArc)return b.isCircular()||b.isDegenerate(0)||b.isDegenerateToLine()?(b=c/d,b<this.m_minStep&&(b=this.m_minStep),b):c/d*b.getSemiAxes().y/b.getSemiAxes().x;b.getGeometryType()===p.GeometryType.enumBezier&&p.throwNotImplementedException("");p.throwNotImplementedException("")}calculateDeviationSubdivisionStep(b,
c){if(!b.isCurve())return 1;if(b.getGeometryType()===p.GeometryType.enumEllipticArc){if(b.isDegenerate(0)||b.isDegenerateToLine())return 1;const d=b.getSemiMajorAxis();let e=Math.PI/2;0<1-c/d&&(e=Math.min(Math.PI/2,Math.abs(4*Math.sqrt(c/d*.5))));e=Math.max(e,2*Math.PI/this.m_maxSegmentsPerCurve);return this.calculateLengthSubdivisionStep(b,e*d)}p.throwNotImplementedException("")}calculateAngularSubdivisionStep(b,c){if(!b.isCurve())return 1;if(b.getGeometryType()===p.GeometryType.enumEllipticArc)return b.isDegenerate(0)||
b.isDegenerateToLine()?1:this.calculateLengthSubdivisionStep(b,c*b.getSemiMinorAxis());p.throwNotImplementedException("")}rationalBezier2NeedsSplit(b,c,d,e){b.cutBezierIgnoreAttributes(d,e,c);b=!1;if(0<this.m_maxLength&&c.calculateUpperLength2D()>this.m_maxLength)return b=!0;d=l.makeObjectArray(l.Point2D,3);c.queryControlPoints(d);e=[0,0,0];c.queryWeights(e);!b&&0<this.m_maxDeviation&&(b=!a.checkRationalBezier2MaxDeviation(d,e,this.m_maxDeviation));!b&&0<this.m_maxAngle&&(b=!a.checkRationalBezier2MaxAngle(d,
e,this.m_cosMaxAngle));return b}bezier2NeedsSplit(b,c,d,e){b.cutBezierIgnoreAttributes(d,e,c);b=!1;if(0<this.m_maxLength&&c.calculateUpperLength2D()>this.m_maxLength)return b=!0;d=l.makeObjectArray(l.Point2D,3);c.queryControlPoints(d);!b&&0<this.m_maxDeviation&&(b=!a.checkBezier2MaxDeviation(d,this.m_maxDeviation));!b&&0<this.m_maxAngle&&(b=!a.checkBezier2MaxAngle(d,this.m_cosMaxAngle));return b}ellipticArcNeedsSplit(b,c,d,e){b.cutArcIgnoreAttributes(d,e,c);b=!1;if(0<this.m_maxLength&&c.calculateUpperLength2D()>
this.m_maxLength)return b=!0;!b&&0<this.m_maxDeviation&&(b=!a.checkEllipticArcMaxDeviation(c,this.m_maxDeviation));!b&&0<this.m_maxAngle&&(b=!a.checkEllipticArcMaxAngle(c,this.m_cosMaxAngle));return b}bezierNeedsSplit(b){let c=!1;if(0<this.m_maxLength&&l.Point2D.distance(b[0],b[1])+l.Point2D.distance(b[1],b[2])+l.Point2D.distance(b[2],b[3])>this.m_maxLength)return c=!0;!c&&0<this.m_maxDeviation&&(c=!a.checkBezierMaxDeviation(b,this.m_maxDeviation));!c&&0<this.m_maxAngle&&(c=!a.checkBezierMaxAngle(b,
this.m_cosMaxAngle));return c}progress_(){}static checkBezierMaxDeviation(b,c){const d=b[3].sub(b[0]);if(0<d.sqrLength()){var e=d.clone();e.leftPerpendicularThis();e.normalize();const f=e.dotProduct(b[0].sub(b[1]));e=e.dotProduct(b[0].sub(b[2]));return Math.max(Math.abs(f),Math.abs(e))<=c&&(c=new l.Point2D,Ia(b,.5,c,!1),b=c.sub(b[0]).dotProduct(d),0<=b&&b<=d.sqrLength())?!0:!1}return Math.max(b[0].sub(b[1]).sqrLength(),b[0].sub(b[2]).sqrLength())<=c*c}static checkBezierMaxAngle(b,c){if(b[0].equals(b[3]))return b[0].equals(b[1])&&
b[1].equals(b[2])?!0:!1;var d=b[3].sub(b[0]);d.normalize();var e=b[1].sub(b[0]),f=e.dotProduct(d);if(0>f||e.length()*c>f)return!1;e=b[2].sub(b[0]);f=e.dotProduct(d);if(0>f||e.length()*c>f)return!1;b=b[2].sub(b[1]);d=b.dotProduct(d);return 0>d||b.length()*c>d?!1:!0}static checkRationalBezier2MaxDeviation(b,c,d){if(0===c[1])return!1;c=b[2].sub(b[0]);if(0<c.sqrLength()){var e=c.clone();e.leftPerpendicularThis();e.normalize();e=e.dotProduct(b[0].sub(b[1]));return Math.abs(e)<=d&&(b=b[1].sub(b[0]).dotProduct(c),
0<=b&&b<=c.sqrLength())?!0:!1}return b[0].sub(b[1]).sqrLength()<=d*d}static checkRationalBezier2MaxAngle(b,c,d){p.geometryReleaseAssert(0);return!1}static checkBezier2MaxDeviation(b,c){const d=b[2].sub(b[0]);if(0<d.sqrLength()){var e=d.clone();e.leftPerpendicularThis();e.normalize();e=e.dotProduct(b[0].sub(b[1]));return Math.abs(e)<=c&&(b=b[1].sub(b[0]).dotProduct(d),0<=b&&b<=d.sqrLength())?!0:!1}return b[0].sub(b[1]).sqrLength()<=c*c}static checkBezier2MaxAngle(b,c){p.geometryReleaseAssert(0);return!1}static checkEllipticArcMaxDeviation(b,
c){if(Math.abs(b.getSweepAngle())<Math.PI){var d=[0,0],e=b.getEndXY().sub(b.getStartXY()),f=d;p.geometryReleaseAssert(!Ha(b));var g=new l.Transformation2D;g.setRotateAngle(-b.getAxisXRotation());var h=new l.Point2D;g.queryTransform(e,h);e=Math.atan2(-h.x*b.getMinorMajorRatio(),h.y);g=e+l.pi();e=Ja(b,e);g=Ja(b,g);g<e&&(g=l.swap(e,e=g));h=0;0<=e&&1>=e&&(f[h++]=e);0<=g&&1>=g&&(f[h++]=g);if(1===h)return f=b.getCoord2D(d[0]),d=l.Point2D.getClosestCoordinate(b.getStartXY(),b.getEndXY(),f),e=new l.Point2D,
l.lerpPoint2D(b.getStartXY(),b.getEndXY(),d,e),l.Point2D.distance(f,e)<=c}f=b.getCoord2D(.5);d=new l.Point2D;l.lerpPoint2D(b.getEndXY(),b.getStartXY(),.5,d);return l.Point2D.distance(f,d)<=c}static checkEllipticArcMaxAngle(b,c){p.geometryReleaseAssert(0);return!1}static checkTypeForReplace(b,c){p.geometryReleaseAssert(0);return!1}};var Bn=Eg;class Cn extends bb.GeometryCursor{constructor(a,b,c,d,e,f){super();this.m_densificator=new Bn(b,c,d,f,!1,e);this.m_index=-1;this.m_inputGeoms=a}tock(){return!0}getRank(){return 1}next(){let a=
null;for(;a=this.m_inputGeoms.next();)return p.throwIfMesh(a),this.m_index=this.m_inputGeoms.getGeometryID(),this.densify(a);return null}getGeometryID(){return this.m_index}densify(a){return this.m_densificator.densify(a)}}class Jc{getOperatorType(){return 10202}accelerateGeometry(a,b,c){return!1}canAccelerateGeometry(a){return!1}supportsCurves(){return!0}executeMany(a,b,c,d,e,f=12E3){return new Cn(a,b,c,d,f,e)}execute(a,b,c,d,e,f=12E3){return ij(a,b,c,d,e,f)}}class Hf{constructor(a){this.m_currentShift=
63n;this.m_currentElt=0n;this.m_iCurrentElt=-1;this.m_parent=a;this.m_aiSetElts=a.m_bits.flatMap((b,c)=>c)}next(){this.m_currentShift++;if(64n===this.m_currentShift){this.m_iCurrentElt++;if(this.m_iCurrentElt===this.m_aiSetElts.length)return Hf.npos();this.m_currentShift=0n;this.m_currentElt=this.m_parent.m_bits[this.m_aiSetElts[this.m_iCurrentElt]]}for(;63n>this.m_currentShift&&!(this.m_currentElt&1n<<this.m_currentShift);)this.m_currentShift++;return this.m_currentElt&1n<<this.m_currentShift?64*
this.m_aiSetElts[this.m_iCurrentElt]+Number(this.m_currentShift):this.next()}static npos(){return Number.MAX_SAFE_INTEGER}}class dc{constructor(a){this.m_bits=[];void 0!==a&&a.copy&&(this.m_bits=a.copy.m_bits.slice())}assignMove(){return this}assignCopy(){return this}hasBit(a){const b=a>>6;return void 0===this.m_bits[b]?!1:this.m_bits[b]&1n<<(BigInt(a)&63n)?!0:!1}setBit(a){const b=1n<<(BigInt(a)&63n);a>>=6;void 0===this.m_bits[a]&&(this.m_bits[a]=0n);this.m_bits[a]|=b}clearBit(a){}flipBit(a){const b=
1n<<(BigInt(a)&63n);a>>=6;void 0===this.m_bits[a]&&(this.m_bits[a]=0n);this.m_bits[a]^=b;return!0}clear(){this.m_bits.length=0}isZero(){let a=0;this.m_bits.forEach(b=>{a|=b?2:1});return a&2?!1:!0}equals(a){if(this===a)return!0;if(this.m_bits.length!==a.m_bits.length)return!1;let b=0;this.m_bits.forEach((c,d)=>{b|=c===a.m_bits[d]?2:1});if(b&1)return!1;a.m_bits.forEach((c,d)=>{b|=c===this.m_bits[d]?2:1});return b&1?!1:!0}notEquals(a){return!this.equals(a)}assignOr(a){a.m_bits.forEach((b,c)=>{this.m_bits[c]=
void 0===this.m_bits[c]?b:this.m_bits[c]|b});return this}assignSubtract(a){a.m_bits.forEach((b,c)=>{void 0!==this.m_bits[c]&&(this.m_bits[c]&=~b)});return this}assignAnd(a){a.m_bits.forEach((b,c)=>{void 0!==this.m_bits[c]&&(this.m_bits[c]&=b)});return this}assignXor(a){a.m_bits.forEach((b,c)=>{this.m_bits[c]=void 0===this.m_bits[c]?b:this.m_bits[c]^b});return this}getHashCode(){return this.m_bits.reduce((a,b)=>l.hashCombineInt64(a,b),l.hashInt32(0))}getUnorderedBitIterator(){return new Hf(this)}}
class Cm{constructor(a,b){this.m_map=new Map;this.m_hf=a;this.m_ef=b}add(a){const b=this.m_hf(a);if(!this.m_map.has(b))return this.m_map.set(b,a),this;const c=this.m_map.get(b);c instanceof Array?c.find(d=>this.m_ef(d,a))||c.push(a):this.m_ef(c,a)||this.m_map.set(b,[c,a]);return this}clear(){this.m_map.clear()}delete(a){return!1}has(a){var b=this.m_hf(a);if(!this.m_map.has(b))return!1;b=this.m_map.get(b);return b instanceof Array?void 0!==b.find(c=>this.m_ef(c,a)):this.m_ef(b,a)}get(a){var b=this.m_hf(a);
b=this.m_map.get(b);if(void 0!==b)return b instanceof Array?b.find(c=>this.m_ef(c,a)):b}get size(){let a=0;for(const b of this.m_map.values())a+=b instanceof Array?b.length:1;return a}forEach(a,b){}[Symbol.iterator](){return(new Set)[Symbol.iterator]()}entries(){return(new Set).entries()}keys(){return(new Set).keys()}values(){return(new Set).values()}get [Symbol.toStringTag](){return"ValueSet"}}class Dn extends bd{constructor(a){super();this.m_bufferLeft=new W;this.m_bufferRight=new W;this.m_intervalLeft=
l.Envelope1D.constructEmpty();this.m_intervalRight=l.Envelope1D.constructEmpty();this.m_yScanline=Number.NaN;this.m_helper=a}compare(a,b,c){a=a.getElement(c);this.m_helper.querySegmentXY(b,this.m_bufferLeft);this.m_helper.querySegmentXY(a,this.m_bufferRight);b=this.m_bufferLeft.get();a=this.m_bufferRight.get();this.m_intervalLeft.setCoords(b.getStartX(),b.getEndX());this.m_intervalRight.setCoords(a.getStartX(),a.getEndX());if(this.m_intervalLeft.vmax<this.m_intervalRight.vmin)return-1;if(this.m_intervalLeft.vmin>
this.m_intervalRight.vmax)return 1;c=b.getStartY()===b.getEndY();var d=a.getStartY()===a.getEndY();if(c||d){if(c&&d)return 0;if(b.getStartY()===a.getStartY()&&b.getStartX()===a.getStartX())return c?1:-1;if(b.getEndY()===a.getEndY()&&b.getEndX()===a.getEndX())return c?-1:1}c=b.intersectionOfYMonotonicWithAxisX(this.m_yScanline,this.m_intervalLeft.vmin);d=a.intersectionOfYMonotonicWithAxisX(this.m_yScanline,this.m_intervalRight.vmin);c===d&&(c=b.getEndY(),d=a.getEndY(),c=Math.min(c,d),d=.5*(c+this.m_yScanline),
d===this.m_yScanline&&(d=c),c=b.intersectionOfYMonotonicWithAxisX(d,this.m_intervalLeft.vmin),d=a.intersectionOfYMonotonicWithAxisX(d,this.m_intervalRight.vmin));return c<d?-1:c>d?1:0}setY(a){this.m_yScanline=a}}class En{constructor(a){this.m_segmentBuffer=new W;this.m_point=l.Point2D.getNAN();this.m_parent=a}setPointXY(a){this.m_point.assign(a)}compare(a,b){a=a.getElement(b);this.m_parent.querySegmentXY(a,this.m_segmentBuffer);a=this.m_segmentBuffer.get();b=new l.Envelope1D;b.setCoords(a.getStartX(),
a.getEndX());if(this.m_point.x<b.vmin)return-1;if(this.m_point.x>b.vmax)return 1;a=a.intersectionOfYMonotonicWithAxisX(this.m_point.y,this.m_point.x);return this.m_point.x<a?-1:this.m_point.x>a?1:0}}var qb;(function(a){a[a.enumInputModeBuildGraph=0]="enumInputModeBuildGraph";a[a.enumInputModeSimplifyAlternate=1]="enumInputModeSimplifyAlternate";a[a.enumInputModeSimplifyWinding=2]="enumInputModeSimplifyWinding"})(qb||={});var cd;(function(a){a[a.enumSegmentParentageBreakNode=1]="enumSegmentParentageBreakNode";
a[a.enumPathBreakNode=2]="enumPathBreakNode"})(cd||={});class ec{constructor(){this.m_shape=null;this.m_clusterData=new U(8);this.m_clusterVertices=new U(2);this.m_lastCluster=this.m_firstCluster=-1;this.m_halfEdgeData=new U(8);this.m_chainData=new U(8);this.m_chainPerimeters=this.m_chainAreas=null;this.m_simplifiedGeometry=this.m_universeChain=-1;this.m_edgeIndices=[];this.m_clusterIndices=[];this.m_chainIndices=[];this.m_bBuildGeometryParentageSets=!1;this.m_edgeBitSetIndexLeft=this.m_edgeBitSetIndex=
this.m_chainBitSetIndex=-1;this.m_uniqueBitSets=this.m_geometryMapID=this.m_emptyBitSet=null;this.m_chainBitSets=[];this.m_edgeBitSets=[];this.m_checkDirtyPlanesweepTolerance=Number.NaN;this.m_universeGeomID=this.m_clusterBreakNodeIndex=this.m_segmentIndexHe=this.m_segmentParentageIndex=this.m_tmpHalfEdgeOddEvenNumberIndex=this.m_tmpHalfEdgeWindingNumberIndex=this.m_tmpHalfEdgeParentageIndexLeft=this.m_tmpHalfEdgeParentageIndex=this.m_halfEdgeIndex=this.m_clusterIndex=this.m_geometryIDIndex=-1;this.m_progressCounter=
this.m_pointCount=0;this.m_bBuildChains=!0;this.m_bDirtyCheckFailed=!1}setCheckDirtyPlanesweepTolerance(a){this.m_checkDirtyPlanesweepTolerance=a}dirtyCheckFailed(){return this.m_bDirtyCheckFailed}getShape(){return this.m_shape}setEditShape(a,b,c=!0,d=!1){d?this.setEditShapeImpl3D_(a,qb.enumInputModeBuildGraph,null,b,!1):this.setEditShapeImpl_(a,qb.enumInputModeBuildGraph,null,b,c)}setAndSimplifyEditShapeAlternate(a,b,c=null,d=!1){const e=[];e.push(b);this.m_simplifiedGeometry=b;d?this.setEditShapeImpl3D_(a,
qb.enumInputModeSimplifyAlternate,e,c,!1):this.setEditShapeImpl_(a,qb.enumInputModeSimplifyAlternate,e,c,a.getGeometryType(b)===p.GeometryType.enumPolygon)}setAndSimplifyEditShapeWinding(a,b,c=null){const d=[];d.push(b);this.m_simplifiedGeometry=b;this.setEditShapeImpl_(a,qb.enumInputModeSimplifyWinding,d,c,!0)}removeShape(){null!==this.m_shape&&(-1!==this.m_geometryIDIndex&&(this.m_shape.removeGeometryUserIndex(this.m_geometryIDIndex),this.m_geometryIDIndex=-1),-1!==this.m_clusterIndex&&(this.m_shape.removeUserIndex(this.m_clusterIndex),
this.m_clusterIndex=-1),-1!==this.m_halfEdgeIndex&&(this.m_shape.removeUserIndex(this.m_halfEdgeIndex),this.m_halfEdgeIndex=-1),-1!==this.m_tmpHalfEdgeParentageIndex&&(this.deleteUserIndexForHalfEdges(this.m_tmpHalfEdgeParentageIndex),this.m_tmpHalfEdgeParentageIndex=-1),-1!==this.m_tmpHalfEdgeParentageIndexLeft&&(this.deleteUserIndexForHalfEdges(this.m_tmpHalfEdgeParentageIndexLeft),this.m_tmpHalfEdgeParentageIndexLeft=-1),-1!==this.m_tmpHalfEdgeWindingNumberIndex&&(this.deleteUserIndexForHalfEdges(this.m_tmpHalfEdgeWindingNumberIndex),
this.m_tmpHalfEdgeWindingNumberIndex=-1),-1!==this.m_tmpHalfEdgeOddEvenNumberIndex&&(this.deleteUserIndexForHalfEdges(this.m_tmpHalfEdgeOddEvenNumberIndex),this.m_tmpHalfEdgeOddEvenNumberIndex=-1),-1!==this.m_segmentParentageIndex&&(this.deleteUserIndexForHalfEdges(this.m_segmentParentageIndex),this.m_segmentParentageIndex=-1),-1!==this.m_segmentIndexHe&&(this.deleteUserIndexForHalfEdges(this.m_segmentIndexHe),this.m_segmentIndexHe=-1),-1!==this.m_clusterBreakNodeIndex&&(this.deleteUserIndexForClusters(this.m_clusterBreakNodeIndex),
this.m_clusterBreakNodeIndex=-1),this.deleteEdgeBitSets_(),this.deleteChainBitSets_(),this.m_shape=this.m_geometryMapID=this.m_emptyBitSet=null,this.m_clusterData.deleteAll(!0),this.m_clusterVertices.deleteAll(!0),this.m_lastCluster=this.m_firstCluster=-1,this.m_halfEdgeData.deleteAll(!0),this.m_edgeIndices.length=0,this.m_clusterIndices.length=0,this.m_chainIndices.length=0,this.m_chainData.deleteAll(!0),this.m_universeChain=-1,this.m_chainAreas=null)}getClusterHalfEdge(a){return this.m_clusterData.getField(a,
2)}queryXY(a,b){a=this.getClusterVertexIndex_(a);b.assign(this.m_shape.getXYWithIndex(a))}queryXYZ(a,b){p.geometryReleaseAssert(0)}getClusterParentage(a){return this.m_clusterData.getField(a,1)}getFirstCluster(){return this.m_firstCluster}getPrevCluster(a){return this.m_clusterData.getField(a,3)}getNextCluster(a){return this.m_clusterData.getField(a,4)}getClusterChain(a){return this.m_clusterData.getField(a,6)}getClusterVertexIterator(a){return this.m_clusterData.getField(a,7)}incrementVertexIterator(a){return this.m_clusterVertices.getField(a,
1)}getVertexFromVertexIterator(a){return this.m_clusterVertices.getField(a,0)}getClusterUserIndex(a,b){a=this.getClusterIndex_(a);b=this.m_clusterIndices[b];return b.size()<=a?-1:b.read(a)}setClusterUserIndex(a,b,c){a=this.getClusterIndex_(a);b=this.m_clusterIndices[b];b.size()<=a&&b.resize(this.m_clusterData.size(),-1);b.write(a,c)}hasClusterUserIndexFlags(a,b,c){if(-1===b)return!1;a=this.getClusterUserIndex(a,b);return-1===a?!1:0!==(c&a)}setClusterUserIndexFlags(a,b,c){a=this.getClusterIndex_(a);
b=this.m_clusterIndices[b];b.size()<=a&&b.resize(this.m_clusterData.size(),-1);let d=b.read(a);-1===d&&(d=0);b.write(a,c|d)}clearClusterUserIndexFlags(a,b,c){p.geometryReleaseAssert(0)}createUserIndexForClusters(a=-1){a=new za(this.m_clusterData.capacity(),a);for(let b=0,c=this.m_clusterIndices.length;b<c;b++)if(null===this.m_clusterIndices[b])return this.m_clusterIndices[b]=a,b;this.m_clusterIndices.push(a);return this.m_clusterIndices.length-1}deleteUserIndexForClusters(a){this.m_clusterIndices[a]=
null}getHalfEdgeOrigin(a){return this.m_halfEdgeData.getField(a,1)}getHalfEdgeTo(a){return this.getHalfEdgeOrigin(this.getHalfEdgeTwin(a))}getHalfEdgeTwin(a){return this.m_halfEdgeData.getField(a,4)}getHalfEdgePrev(a){return this.m_halfEdgeData.getField(a,5)}getHalfEdgeNext(a){return this.m_halfEdgeData.getField(a,6)}getHalfEdgeChain(a){return this.m_halfEdgeData.getField(a,2)}getHalfEdgeFaceParentage(a){return this.getChainParentage(this.getHalfEdgeChain(a))}getHalfEdgeVertexIterator(a){return this.m_halfEdgeData.getField(a,
7)}getHalfEdgeFromXY(a,b){this.queryXY(this.getHalfEdgeOrigin(a),b)}getHalfEdgeToXY(a,b){this.queryXY(this.getHalfEdgeTo(a),b)}isHalfEdgeCurve(a){return-1!==this.m_segmentIndexHe?-1!==this.getHalfEdgeUserIndex(a,this.m_segmentIndexHe):!1}getHalfEdgeFromXYZ(a,b){p.geometryReleaseAssert(0)}getHalfEdgeToXYZ(a,b){p.geometryReleaseAssert(0)}getHalfEdgeParentage(a){return this.m_halfEdgeData.getField(a,3)&ec.c_EdgeParentageMask}getHalfEdgeUserIndex(a,b){a=this.getHalfEdgeIndex_(a);b=this.m_edgeIndices[b];
return b.size()<=a?-1:b.read(a)}setHalfEdgeUserIndex(a,b,c){a=this.getHalfEdgeIndex_(a);b=this.m_edgeIndices[b];b.size()<=a&&b.resize(this.m_halfEdgeData.size(),-1);b.write(a,c)}createUserIndexForHalfEdges(a){void 0===a&&(a=-1);a=new za(this.m_halfEdgeData.capacity(),a);for(let b=0,c=this.m_edgeIndices.length;b<c;b++)if(null===this.m_edgeIndices[b])return this.m_edgeIndices[b]=a,b;this.m_edgeIndices.push(a);a=this.m_edgeIndices.length-1;p.geometryReleaseAssert(0<=a&&a<=Number.MAX_SAFE_INTEGER);return a}deleteUserIndexForHalfEdges(a){this.m_edgeIndices[a]=
null}deleteEdgesBreakFaces_(a){for(let c=0,d=a.length;c<d;c++){const e=a[c],f=this.getHalfEdgeChain(e);var b=this.getHalfEdgeTwin(e);b=this.getHalfEdgeChain(b);this.setChainHalfEdge_(f,-1);this.setChainHalfEdge_(b,-1);this.updateVertexToHalfEdgeConnection_(e,!0);this.deleteEdgeImpl_(e)}}doesHalfEdgeBelongToAPolygonInterior(a,b){p.geometryReleaseAssert(0);return!1}doesHalfEdgeBelongToAPolygonExterior(a,b){p.geometryReleaseAssert(0);return!1}doesHalfEdgeBelongToAPolygonBoundary(a,b){p.geometryReleaseAssert(0);
return!1}doesHalfEdgeBelongToAPolylineInterior(a,b){p.geometryReleaseAssert(0);return!1}doesHalfEdgeBelongToAPolylineExterior(a,b){p.geometryReleaseAssert(0);return!1}doesClusterBelongToAPolygonInterior(a,b){p.geometryReleaseAssert(0);return!1}doesClusterBelongToAPolygonExterior(a,b){p.geometryReleaseAssert(0);return!1}doesClusterBelongToAPolygonBoundary(a,b){p.geometryReleaseAssert(0);return!1}getFirstChain(){return this.m_universeChain}getChainHalfEdge(a){return this.m_chainData.getField(a,1)}getChainParentage(a){return this.m_chainData.getField(a,
2)}getChainParent(a){return this.m_chainData.getField(a,3)}getChainFirstIsland(a){return this.m_chainData.getField(a,4)}getChainNextInParent(a){return this.m_chainData.getField(a,5)}getChainNext(a){return this.m_chainData.getField(a,7)}getChainArea(a){const b=this.getChainIndex_(a);let c=this.m_chainAreas.read(b);Number.isNaN(c)&&(this.updateChainAreaAndPerimeter_(a),c=this.m_chainAreas.read(b));return c}getChainPerimeter(a){p.geometryReleaseAssert(0);return 0}getChainUserIndex(a,b){a=this.getChainIndex_(a);
b=this.m_chainIndices[b];return b.size()<=a?-1:b.read(a)}setChainUserIndex(a,b,c){a=this.getChainIndex_(a);b=this.m_chainIndices[b];b.size()<=a&&b.resize(this.m_chainData.size(),-1);b.write(a,c)}createUserIndexForChains(){const a=new za(this.m_chainData.capacity(),-1);for(let b=0,c=this.m_chainIndices.length;b<c;b++)if(null===this.m_chainIndices[b])return this.m_chainIndices[b]=a,b;this.m_chainIndices.push(a);return this.m_chainIndices.length-1}deleteUserIndexForChains(a){p.geometryReleaseAssert(0)}extractPolygonFromChainAndIslands(a,
b,c,d){b=-1===b?a.createGeometry(p.GeometryType.enumPolygon):b;const e=new W;this.extractPolygonPathFromChain_(a,b,c,d,e);for(c=this.getChainFirstIsland(c);-1!==c;c=this.getChainNextInParent(c))this.extractPolygonPathFromChain_(a,b,c,d,e);return b}getGeometryID(a){a=this.m_shape.getGeometryUserIndex(a,this.m_geometryIDIndex);p.geometryReleaseAssert(0<=a);return 1<<Math.min(a,31)}getClusterFromVertex(a){return this.m_shape.getUserIndex(a,this.m_clusterIndex)}getHalfEdgeFromVertex(a){return this.m_shape.getUserIndex(a,
this.m_halfEdgeIndex)}buildGeometryParentageSets(){this.m_bBuildGeometryParentageSets=!0}getChainBitSet(a){p.geometryReleaseAssert(this.m_bBuildGeometryParentageSets);if(-1===this.m_chainBitSetIndex)return this.getEmptySet();a=this.getChainUserIndex(a,this.m_chainBitSetIndex);p.geometryReleaseAssert(0<=a);(a=this.m_chainBitSets.at(a))||(a=this.getEmptySet());return a}getChainBoundaryBitSet(a){p.geometryReleaseAssert(this.m_bBuildGeometryParentageSets);const b=new dc,c=d=>{let e=d=this.getChainHalfEdge(d);
do{var f=this.getEdgeBitSet_(e);null!==f&&b.assignOr(f);f=this.getEdgeBitSet_(this.getHalfEdgeTwin(e));null!==f&&b.assignOr(f);e=this.getHalfEdgeNext(e)}while(e!==d)};c(a);for(let d=this.getChainFirstIsland(a);-1!==d;d=this.getChainNextInParent(d))c(a);return b}getChainPolygons(a){p.geometryReleaseAssert(0);return[]}getGeometriesFromBits(a){if(!this.m_bBuildGeometryParentageSets||null===a)return[];if(null===this.m_geometryMapID){this.m_geometryMapID=new Map;for(var b=this.m_shape.getFirstGeometry();-1!==
b;b=this.m_shape.getNextGeometry(b))this.m_geometryMapID.set(this.m_shape.getGeometryUserIndex(b,this.m_geometryIDIndex),b)}b=[];a=a.getUnorderedBitIterator();for(let c=a.next();c!==Hf.npos();c=a.next())p.geometryReleaseAssert(this.m_geometryMapID.has(c)),b.push(this.m_geometryMapID.get(c));return b}getVertexDominant(a,b){if(-1===b)return a;a=this.getClusterFromVertex(a);return this.getVertexDominantFromCluster(a,b)}getVertexDominantFromCluster(a,b){if(-1!==b){let c=-1;for(a=this.getClusterVertexIterator(a);-1!==
a;a=this.incrementVertexIterator(a)){const d=this.getVertexFromVertexIterator(a);-1===c&&(c=d);const e=this.m_shape.getPathFromVertex(d);if(this.m_shape.getGeometryFromPath(e)===b){c=d;break}}return c}b=this.getClusterVertexIterator(a);return-1!==b?this.getVertexFromVertexIterator(b):-1}isBreakNode(a){return this.hasClusterUserIndexFlags(a,this.m_clusterBreakNodeIndex,cd.enumSegmentParentageBreakNode)}setBreakNode(a,b){p.geometryReleaseAssert(-1!==this.m_clusterBreakNodeIndex);b?this.setClusterUserIndexFlags(a,
this.m_clusterBreakNodeIndex,cd.enumSegmentParentageBreakNode):this.clearClusterUserIndexFlags(a,this.m_clusterBreakNodeIndex,cd.enumSegmentParentageBreakNode)}isStrongPathNode(a){return this.hasClusterUserIndexFlags(a,this.m_clusterBreakNodeIndex,cd.enumPathBreakNode)}setStrongPathNode(a,b){if(-1===this.m_clusterBreakNodeIndex){if(!b)return;this.m_clusterBreakNodeIndex=this.createUserIndexForClusters()}b?this.setClusterUserIndexFlags(a,this.m_clusterBreakNodeIndex,cd.enumPathBreakNode):this.clearClusterUserIndexFlags(a,
this.m_clusterBreakNodeIndex,cd.enumPathBreakNode)}getSegmentParentage(a){if(-1===this.m_segmentParentageIndex)return-1;a=this.getHalfEdgeUserIndex(a,this.m_segmentParentageIndex);return 0<=a?a:-1}isCrossroadAhead(a){var b=this.getHalfEdgeNext(a);if(this.isStrongPathNode(this.getHalfEdgeOrigin(b)))return!0;b=this.getHalfEdgeTwin(b);b=this.getHalfEdgeNext(b);b=this.getHalfEdgeTwin(b);return a!==b}isCrossroadBehind(a){p.geometryReleaseAssert(0);return!1}getHalfEdgeConnector(a,b){const c=this.getClusterHalfEdge(a);
if(-1===c)return-1;let d=c,e=-1,f=-1;do{if(this.getHalfEdgeTo(d)===b)return d;if(-1===e){e=this.getClusterHalfEdge(b);if(-1===e)break;f=e}if(this.getHalfEdgeTo(f)===a)return d=this.getHalfEdgeTwin(f);d=this.getHalfEdgeNext(this.getHalfEdgeTwin(d));f=this.getHalfEdgeNext(this.getHalfEdgeTwin(f))}while(d!==c&&f!==e);return-1}querySegmentXY(a,b){if(-1!==this.m_segmentIndexHe){var c=this.getHalfEdgeUserIndex(a,this.m_segmentIndexHe);if(-1!==c){-2!==c?(a=this.m_shape.getSegmentFromIndex(c),b.copyFrom(a,
!0)):(c=this.getHalfEdgeUserIndex(this.getHalfEdgeTwin(a),this.m_segmentIndexHe),a=this.m_shape.getSegmentFromIndex(c),b.copyFrom(a,!0),b.get().reverse());return}}b.createLine();b=b.get();c=l.Point2D.getNAN();this.getHalfEdgeFromXY(a,c);b.setStartXY(c);this.getHalfEdgeToXY(a,c);b.setEndXY(c)}isCurveEdge(a){return-1!==this.m_segmentIndexHe?-1!==this.getHalfEdgeUserIndex(a,this.m_segmentIndexHe):!1}compareEdgeAnglesCurveHelper_(a,b,c){c=new W;var d=new W;this.querySegmentXY(a,c);this.querySegmentXY(b,
d);c=c.get();d=d.get();if(c.equals(d))return 0;var e=new l.Point2D;this.getHalfEdgeFromXY(a,e);e=new l.Point2D;this.getHalfEdgeToXY(a,e);a=new l.Point2D;this.getHalfEdgeToXY(b,a);p.geometryReleaseAssert(!e.isEqualPoint2D(a));b=c.getTangent(0);a=d.getTangent(0);return l.Point2D.compareVectors(b,a)}compareEdgeAnglesHelper_(a,b,c){if(a===b)return 0;if(this.isHalfEdgeCurve(a)||this.isHalfEdgeCurve(b))return this.compareEdgeAnglesCurveHelper_(a,b,c);var d=l.Point2D.getNAN();this.getHalfEdgeToXY(a,d);const e=
l.Point2D.getNAN();this.getHalfEdgeToXY(b,e);if(d.isEqualPoint2D(e))return 0;b=l.Point2D.getNAN();this.getHalfEdgeFromXY(a,b);a=l.Point2D.getNAN();a.setSub(d,b);d=l.Point2D.getNAN();d.setSub(e,b);return!c||0<=d.y&&0<a.y?l.Point2D.compareVectors(a,d):0}compareEdgeAngles_(a,b){return this.compareEdgeAnglesHelper_(a,b,!1)}compareEdgeAnglesForPair_(a,b){return this.compareEdgeAnglesHelper_(a,b,!0)}compareEdgeAngles3D_(a,b){p.geometryReleaseAssert(0);return 0}compareEdgeAnglesForPair3D_(a,b){p.geometryReleaseAssert(0);
return 0}dbgDumpChains_(){}dbgDumpChainToPolygon_(a,b){p.geometryReleaseAssert(0)}deleteEdgeInternal_(a){const b=this.getHalfEdgeChain(a),c=this.getHalfEdgeTwin(a);var d=this.getHalfEdgeChain(c);p.geometryReleaseAssert(d===b);p.geometryReleaseAssert(a===this.getHalfEdgeNext(c)||c===this.getHalfEdgeNext(a));d=this.getHalfEdgeNext(a);d===c&&(d=this.getHalfEdgeNext(d),d===a&&(d=-1));var e=this.getChainIndex_(b);e=this.m_chainAreas.read(e);Number.isNaN(e)||(this.setChainArea_(b,Number.NaN),this.setChainPerimeter_(b,
Number.NaN));e=this.getChainHalfEdge(b);e!==a&&e!==c||this.setChainHalfEdge_(b,d);this.updateVertexToHalfEdgeConnection_(a,!0);this.deleteEdgeImpl_(a)}getFirstUnvisitedHalfEdgeOnCluster_(a,b,c){b=-1!==b?b:this.getClusterHalfEdge(a);if(-1===b)return-1;for(a=b;;){if(1!==this.getHalfEdgeUserIndex(b,c))return b;b=this.getHalfEdgeNext(this.getHalfEdgeTwin(b));if(b===a)return-1}}removeSpikes_(){let a=!1;const b=this.createUserIndexForHalfEdges();for(let c=this.getFirstCluster();-1!==c;c=this.getNextCluster(c)){let d=
-1;for(;;){let e=this.getFirstUnvisitedHalfEdgeOnCluster_(c,d,b);if(-1===e)break;d=this.getHalfEdgeNext(this.getHalfEdgeTwin(e));let f=e;for(;;){const g=this.getHalfEdgeNext(f),h=this.getHalfEdgePrev(f),k=this.getHalfEdgeTwin(f);if(h===k){this.deleteEdgeInternal_(f);a=!0;if(d===f||d===k)d=-1;if(f===e||h===e){e=g;if(f===e||h===e)break;f=g;continue}}else this.setHalfEdgeUserIndex(f,b,1);f=g;if(f===e)break}}}this.deleteUserIndexForHalfEdges(b);return a}progress_(a,b){}newCluster_(){const a=this.m_clusterData.newElement();
this.m_clusterData.setField(a,1,0);return a}newHalfEdgePair_(){const a=this.m_halfEdgeData.newElement();this.m_halfEdgeData.setField(a,2,0);this.m_halfEdgeData.setField(a,3,0);const b=this.m_halfEdgeData.newElement();this.m_halfEdgeData.setField(b,2,0);this.m_halfEdgeData.setField(b,3,0);this.setHalfEdgeTwin_(a,b);this.setHalfEdgeTwin_(b,a);return a}newChain_(){const a=this.m_chainData.newElement();this.m_chainData.setField(a,2,0);return a}deleteChain_(a){p.geometryReleaseAssert(0);return 0}getClusterIndex_(a){return this.m_clusterData.elementToIndex(a)}setClusterVertexIterator_(a,
b){this.m_clusterData.setField(a,7,b)}setClusterHalfEdge_(a,b){this.m_clusterData.setField(a,2,b)}setClusterParentage_(a,b){this.m_clusterData.setField(a,1,b)}setPrevCluster_(a,b){this.m_clusterData.setField(a,3,b)}setNextCluster_(a,b){this.m_clusterData.setField(a,4,b)}setClusterVertexIndex_(a,b){this.m_clusterData.setField(a,5,b)}getClusterVertexIndex_(a){return this.m_clusterData.getField(a,5)}setClusterChain_(a,b){this.m_clusterData.setField(a,6,b)}addClusterToExteriorChain_(a,b){this.setClusterChain_(b,
a)}getHalfEdgeIndex_(a){return this.m_halfEdgeData.elementToIndex(a)}setHalfEdgeOrigin_(a,b){this.m_halfEdgeData.setField(a,1,b)}setHalfEdgeTwin_(a,b){this.m_halfEdgeData.setField(a,4,b)}setHalfEdgePrev_(a,b){this.m_halfEdgeData.setField(a,5,b)}setHalfEdgeNext_(a,b){this.m_halfEdgeData.setField(a,6,b)}setHalfEdgeChain_(a,b){this.m_halfEdgeData.setField(a,2,b)}setHalfEdgeParentage_(a,b){this.m_halfEdgeData.setField(a,3,b)}getHalfEdgeParentageMask_(a){return this.m_halfEdgeData.getField(a,3)}setHalfEdgeVertexIterator_(a,
b){this.m_halfEdgeData.setField(a,7,b)}updateVertexToHalfEdgeConnectionHelper_(a,b){b=b?-1:a;for(a=this.getHalfEdgeVertexIterator(a);-1!==a;a=this.incrementVertexIterator(a)){const c=this.getVertexFromVertexIterator(a);this.m_shape.setUserIndex(c,this.m_halfEdgeIndex,b)}}updateVertexToHalfEdgeConnection_(a,b){-1!==a&&(this.updateVertexToHalfEdgeConnectionHelper_(a,b),this.updateVertexToHalfEdgeConnectionHelper_(this.getHalfEdgeTwin(a),b))}getChainIndex_(a){return this.m_chainData.elementToIndex(a)}setChainHalfEdge_(a,
b){this.m_chainData.setField(a,1,b)}setChainParentage_(a,b){this.m_chainData.setField(a,2,b)}setChainParent_(a,b){this.m_chainData.setField(a,3,b);const c=this.getChainFirstIsland(b);this.setChainNextInParent_(a,c);this.setChainFirstIsland_(b,a)}setChainFirstIsland_(a,b){this.m_chainData.setField(a,4,b)}setChainNextInParent_(a,b){this.m_chainData.setField(a,5,b)}setChainPrev_(a,b){this.m_chainData.setField(a,6,b)}setChainNext_(a,b){this.m_chainData.setField(a,7,b)}setChainArea_(a,b){a=this.getChainIndex_(a);
this.m_chainAreas.write(a,b)}setChainPerimeter_(a,b){a=this.getChainIndex_(a);this.m_chainPerimeters.write(a,b)}updateChainAreaAndPerimeter_(a){var b=this.m_shape.hasCurves();const c=new l.KahanSummator(0),d=new l.KahanSummator(0),e=this.getChainHalfEdge(a);var f=l.Point2D.getNAN();const g=l.Point2D.getNAN(),h=l.Point2D.getNAN();this.getHalfEdgeFromXY(e,f);g.setCoordsPoint2D(f);let k=e;do this.getHalfEdgeToXY(k,h),b&&this.isCurveEdge(k)||d.pe(l.Point2D.distance(g,h)),this.getHalfEdgeChain(this.getHalfEdgeTwin(k))!==
a&&c.pe((h.x-f.x-(g.x-f.x))*(h.y-f.y+(g.y-f.y))*.5),g.setCoordsPoint2D(h),k=this.getHalfEdgeNext(k);while(k!==e);if(b){b=new W;k=e;do{this.getHalfEdgeToXY(k,h);if(f=this.isCurveEdge(k))this.querySegmentXY(k,b),d.pe(b.get().calculateLength2D());this.getHalfEdgeChain(this.getHalfEdgeTwin(k))!==a&&f&&(f=b.get().calculateArea2DHelper(),c.pe(f));k=this.getHalfEdgeNext(k)}while(k!==e)}a=this.getChainIndex_(a);this.m_chainAreas.write(a,c.getResult());this.m_chainPerimeters.write(a,d.getResult())}getChainTopmostEdge_(a){p.geometryReleaseAssert(0);
return 0}planeSweepParentage_(a,b){const c=new Dn(this),d=new R;d.setCapacity(Math.trunc(this.m_pointCount/2));d.setComparator(c);const e=[],f=this.createUserIndexForHalfEdges();let g=null;const h=l.Point2D.getNAN();for(let q=this.getFirstCluster();-1!==q;q=this.getNextCluster(q)){this.progress_(b);var k=this.getClusterHalfEdge(q);if(-1!==k){e.length=0;if(!this.tryOptimizedInsertion_(d,f,e,q,k)){this.queryXY(q,h);c.setY(h.y);var m=k;do{var n=this.getHalfEdgeUserIndex(m,f);-1!==n&&(d.deleteNode(n),
this.setHalfEdgeUserIndex(m,f,U.impossibleIndex2()));m=this.getHalfEdgeNext(this.getHalfEdgeTwin(m))}while(k!==m);m=k;do-1===this.getHalfEdgeUserIndex(m,f)&&(n=d.addElement(m),e.push(n)),m=this.getHalfEdgeNext(this.getHalfEdgeTwin(m));while(k!==m)}for(k=e.length-1;0<=k;k--)m=e[k],n=d.getElement(m),n=this.getHalfEdgeTwin(n),this.setHalfEdgeUserIndex(n,f,m),this.planeSweepParentagePropagateParentage_(d,m,a)}else-1===this.getClusterChain(q)&&(null===g&&(g=new En(this)),this.queryXY(q,h),g.setPointXY(h),
k=d.searchLowerBound(g),m=this.m_universeChain,-1!==k&&(n=d.getElement(k),this.getHalfEdgeChain(n)===this.getHalfEdgeChain(this.getHalfEdgeTwin(n))&&(n=this.getLeftSkipPolylines_(d,k)),-1!==n&&(m=this.getHalfEdgeChain(n))),this.addClusterToExteriorChain_(m,q))}this.deleteUserIndexForHalfEdges(f)}planeSweepParentagePropagateParentage_(a,b,c){const d=a.getElement(b),e=this.getHalfEdgeChain(d);if(-1===this.getChainParent(e)){var f=this.getLeftSkipPolylines_(a,b),g=this.getHalfEdgeTwin(d),h=this.getHalfEdgeChain(g),
k=this.getChainParent(e),m=this.getChainParent(h);if(-1===f)-1===k&&(h===e?(this.setChainParent_(h,this.m_universeChain),k=m=this.m_universeChain):(-1===m&&(this.setChainParent_(h,this.m_universeChain),m=this.m_universeChain),this.setChainParent_(e,h),k=h));else{const n=this.getHalfEdgeChain(f);-1===m&&(0>=this.getChainArea(n)?(m=this.getChainParent(n),this.setChainParent_(h,m)):(this.setChainParent_(h,n),m=n),h===e&&(k=m))}-1===k&&(this.trySetChainParentFromTwin_(e,h),k=this.getChainParent(e));p.geometryReleaseAssert(-1!==
k);c===qb.enumInputModeBuildGraph?this.propagateParentageBuildGraph_(a,b,d,f):c===qb.enumInputModeSimplifyWinding?this.propagateParentageWinding_(a,b,d,f,g,e,h):c===qb.enumInputModeSimplifyAlternate&&this.propagateParentageAlternate_(a,b,d,f,g,e,h)}}propagateParentageBuildGraph_(a,b,c,d){-1===d?(b=a.getNext(b),c=this.getHalfEdgeChain(c)):c=this.getHalfEdgeChain(d);d=null;var e=this.getChainParentage(c);for(this.m_bBuildGeometryParentageSets&&(d=this.getChainBitSet(c));-1!==b;b=a.getNext(b)){var f=
a.getElement(b),g=this.getHalfEdgeTwin(f);c=this.getHalfEdgeChain(f);g=this.getHalfEdgeChain(g);if(this.m_bBuildGeometryParentageSets){var h=this.getChainBitSet(g);h=new dc({copy:h});h.assignOr(d);this.setChainBitSet_(g,h);h=this.getChainBitSet(c);var k=this.getLeftEdgeBitSet_(f);d=new dc({copy:d});d.assignSubtract(k);if(d.isZero())break;h=new dc({copy:h});h.assignOr(d);this.setChainBitSet_(c,h);d=h}h=this.getChainParentage(g);k=h|e;k!==h&&this.setChainParentage_(g,k);g=this.getChainParentage(c);
f=this.getHalfEdgeUserIndex(f,this.m_tmpHalfEdgeParentageIndexLeft);if(e&=~f)g|=e,this.setChainParentage_(c,g);if(0===e)break;e=g}}propagateParentageWinding_(a,b,c,d,e,f,g){if(f!==g){c=this.getHalfEdgeUserIndex(c,this.m_tmpHalfEdgeWindingNumberIndex);c+=this.getHalfEdgeUserIndex(e,this.m_tmpHalfEdgeWindingNumberIndex);e=0;d=[];var h=[];h.push(0);for(let n=a.getFirst();n!==b;n=a.getNext(n)){var k=a.getElement(n),m=this.getHalfEdgeTwin(k);const q=this.getHalfEdgeChain(k),r=this.getHalfEdgeChain(m);
q!==r&&(k=this.getHalfEdgeUserIndex(k,this.m_tmpHalfEdgeWindingNumberIndex),k+=this.getHalfEdgeUserIndex(m,this.m_tmpHalfEdgeWindingNumberIndex),e+=k,m=!1,0!==d.length&&d.at(-1)===r&&(h.pop(),d.pop(),m=!0),p.geometryReleaseAssert(-1!==this.getChainParent(r)),m&&this.getChainParent(r)===q||(h.push(e),d.push(q)))}e+=c;0!==d.length&&d.at(-1)===g&&(h.pop(),d.pop());0!==e?0===h.at(-1)&&(a=this.getGeometryID(this.m_simplifiedGeometry),this.setChainParentage_(f,a)):0!==h.at(-1)&&(a=this.getGeometryID(this.m_simplifiedGeometry),
this.setChainParentage_(f,a))}}propagateParentageAlternate_(a,b,c,d,e,f,g){a=this.getGeometryID(this.m_simplifiedGeometry);-1===d?(this.setChainParentage_(g,this.m_universeGeomID),0!==(this.getHalfEdgeUserIndex(c,this.m_tmpHalfEdgeOddEvenNumberIndex)&1)?this.setChainParentage_(f,a):this.setChainParentage_(f,this.m_universeGeomID)):(b=this.getChainParentage(g),0===b?(d=this.getHalfEdgeChain(d),d=this.getChainParentage(d),this.setChainParentage_(g,d),0!==(this.getHalfEdgeUserIndex(c,this.m_tmpHalfEdgeOddEvenNumberIndex)&
1)?this.setChainParentage_(f,d===a?this.m_universeGeomID:a):this.setChainParentage_(f,d)):0!==(this.getHalfEdgeUserIndex(c,this.m_tmpHalfEdgeOddEvenNumberIndex)&1)?this.setChainParentage_(f,b===a?this.m_universeGeomID:a):this.setChainParentage_(f,b))}tryOptimizedInsertion_(a,b,c,d,e){d=e;let f=-1,g=-1,h=0;do{if(2===h)return!1;const k=this.getHalfEdgeUserIndex(d,b);if(-1!==k){if(-1!==f)return!1;f=k}else{if(-1!==g)return!1;g=d}h++;d=this.getHalfEdgeNext(this.getHalfEdgeTwin(d))}while(e!==d);if(-1===
g||-1===f)return!1;this.setHalfEdgeUserIndex(a.getElement(f),b,U.impossibleIndex2());a.setElement(f,g);c.push(f);return!0}trySetChainParentFromTwin_(a,b){const c=this.getChainArea(a);if(0===c)return!1;const d=this.getChainArea(b);if(0<c&&0>d||0>c&&0<d)return this.setChainParent_(a,b),!0;b=this.getChainParent(b);return-1!==b?(this.setChainParent_(a,b),!0):!1}createHalfEdges_(a,b){this.m_halfEdgeIndex=this.m_shape.createUserIndex();for(let n=0,q=b.size();n<q;n++){var c=b.read(n),d=this.m_shape.getUserIndex(c,
this.m_clusterIndex),e=this.m_shape.getPathFromVertex(c),f=this.m_shape.getGeometryFromPath(e),g=this.m_shape.getGeometryType(f);if(p.isMultiPath(g)){var h=this.m_shape.getNextVertex(c);if(-1===h)continue;var k=this.m_shape.getUserIndex(h,this.m_clusterIndex);if(d===k)continue;e=this.newHalfEdgePair_();const r=this.getHalfEdgeTwin(e);var m=this.m_clusterVertices.newElement();this.m_clusterVertices.setField(m,0,c);this.m_clusterVertices.setField(m,1,-1);this.setHalfEdgeVertexIterator_(e,m);this.m_shape.setUserIndex(c,
this.m_halfEdgeIndex,e);this.setHalfEdgeOrigin_(e,d);m=this.getClusterHalfEdge(d);-1===m?(this.setClusterHalfEdge_(d,e),this.setHalfEdgePrev_(e,r),this.setHalfEdgeNext_(r,e)):(d=this.getHalfEdgePrev(m),this.setHalfEdgePrev_(m,r),this.setHalfEdgeNext_(r,m),this.setHalfEdgeNext_(d,e),this.setHalfEdgePrev_(e,d));this.setHalfEdgeOrigin_(r,k);d=this.getClusterHalfEdge(k);-1===d?(this.setClusterHalfEdge_(k,r),this.setHalfEdgeNext_(e,r),this.setHalfEdgePrev_(r,e)):(k=this.getHalfEdgePrev(d),this.setHalfEdgePrev_(d,
e),this.setHalfEdgeNext_(e,d),this.setHalfEdgeNext_(k,r),this.setHalfEdgePrev_(r,k));k=this.getGeometryID(f);a===qb.enumInputModeBuildGraph?(c=g===p.GeometryType.enumPolygon?k:0,this.setHalfEdgeUserIndex(r,this.m_tmpHalfEdgeParentageIndex,0),this.setHalfEdgeUserIndex(e,this.m_tmpHalfEdgeParentageIndex,c),this.setHalfEdgeUserIndex(r,this.m_tmpHalfEdgeParentageIndexLeft,c),this.setHalfEdgeUserIndex(e,this.m_tmpHalfEdgeParentageIndexLeft,0),this.m_bBuildGeometryParentageSets&&(c=new dc,f=this.m_shape.getGeometryUserIndex(f,
this.m_geometryIDIndex),c.setBit(f),this.setEdgeBitSet_(e,c),this.setEdgeBitSet_(r,null),this.setLeftEdgeBitSet_(r,c),this.setLeftEdgeBitSet_(e,null))):a===qb.enumInputModeSimplifyWinding?(f=this.m_shape.getXY(c),c=this.m_shape.getXY(h),d=h=0,0>f.compare(c)?h=1:d=-1,this.setHalfEdgeUserIndex(e,this.m_tmpHalfEdgeWindingNumberIndex,h),this.setHalfEdgeUserIndex(r,this.m_tmpHalfEdgeWindingNumberIndex,d)):a===qb.enumInputModeSimplifyAlternate&&(this.setHalfEdgeUserIndex(e,this.m_tmpHalfEdgeOddEvenNumberIndex,
1),this.setHalfEdgeUserIndex(r,this.m_tmpHalfEdgeOddEvenNumberIndex,1));g=g===p.GeometryType.enumPolygon?ec.c_EdgeBitMask:0;this.setHalfEdgeParentage_(e,k|g);this.setHalfEdgeParentage_(r,k|g)}}if(this.m_shape.hasCurves()){this.m_segmentIndexHe=this.createUserIndexForHalfEdges();for(let n=0,q=b.size();n<q;n++)a=b.read(n),this.m_shape.getSegment(a)&&(e=this.m_shape.getUserIndex(a,this.m_halfEdgeIndex),-1!==e&&(this.setHalfEdgeUserIndex(e,this.m_segmentIndexHe,this.m_shape.getVertexIndex(a)),this.setHalfEdgeUserIndex(this.getHalfEdgeTwin(e),
this.m_segmentIndexHe,-2)))}}mergeVertexListsOfEdges_(a,b){var c=this.getHalfEdgeVertexIterator(b);if(-1!==c){var d=this.getHalfEdgeVertexIterator(a);this.m_clusterVertices.setField(c,1,d);this.setHalfEdgeVertexIterator_(a,c);this.setHalfEdgeVertexIterator_(b,-1)}c=this.getHalfEdgeTwin(a);d=this.getHalfEdgeTwin(b);var e=this.getHalfEdgeVertexIterator(d);if(-1!==e){const f=this.getHalfEdgeVertexIterator(c);this.m_clusterVertices.setField(e,1,f);this.setHalfEdgeVertexIterator_(c,e);this.setHalfEdgeVertexIterator_(d,
-1)}-1!==this.m_segmentIndexHe&&(e=this.getHalfEdgeUserIndex(a,this.m_segmentIndexHe),-1!==e&&(-2===e&&(b=this.getHalfEdgeUserIndex(b,this.m_segmentIndexHe),this.setHalfEdgeUserIndex(a,this.m_segmentIndexHe,b)),e=this.getHalfEdgeUserIndex(c,this.m_segmentIndexHe),-2===e&&(a=this.getHalfEdgeUserIndex(d,this.m_segmentIndexHe),this.setHalfEdgeUserIndex(c,this.m_segmentIndexHe,a))))}sortHalfEdgesByAngle_(a){const b=[];for(let n=this.getFirstCluster();-1!==n;n=this.getNextCluster(n)){b.length=0;var c=
this.getClusterHalfEdge(n);if(-1!==c){var d=c;do b.push(d),d=this.getHalfEdgeNext(this.getHalfEdgeTwin(d));while(d!==c);if(1<b.length){var e=!0;2<b.length?(b.sort((r,t)=>this.compareEdgeAngles_(r,t)),b.push(b[0])):0<this.compareEdgeAnglesForPair_(b[0],b[1])?b[1]=l.swap(b[0],b[0]=b[1]):e=!1;var f=d=b[0],g=this.getHalfEdgeTo(f);let q=this.getHalfEdgeTwin(f);var h=-1;for(let r=1,t=b.length;r<t;r++){const u=b[r];var k=this.getHalfEdgeTwin(u),m=this.getHalfEdgeOrigin(k);m===g&&u!==f?(a===qb.enumInputModeBuildGraph?
(h=this.getHalfEdgeParentageMask_(f)|this.getHalfEdgeParentageMask_(u),this.setHalfEdgeParentage_(f,h),this.setHalfEdgeParentage_(q,h),this.setHalfEdgeUserIndex(f,this.m_tmpHalfEdgeParentageIndex,this.getHalfEdgeUserIndex(f,this.m_tmpHalfEdgeParentageIndex)|this.getHalfEdgeUserIndex(u,this.m_tmpHalfEdgeParentageIndex)),this.setHalfEdgeUserIndex(q,this.m_tmpHalfEdgeParentageIndex,this.getHalfEdgeUserIndex(q,this.m_tmpHalfEdgeParentageIndex)|this.getHalfEdgeUserIndex(k,this.m_tmpHalfEdgeParentageIndex)),
this.setHalfEdgeUserIndex(f,this.m_tmpHalfEdgeParentageIndexLeft,this.getHalfEdgeUserIndex(f,this.m_tmpHalfEdgeParentageIndexLeft)|this.getHalfEdgeUserIndex(u,this.m_tmpHalfEdgeParentageIndexLeft)),this.setHalfEdgeUserIndex(q,this.m_tmpHalfEdgeParentageIndexLeft,this.getHalfEdgeUserIndex(q,this.m_tmpHalfEdgeParentageIndexLeft)|this.getHalfEdgeUserIndex(k,this.m_tmpHalfEdgeParentageIndexLeft)),this.m_bBuildGeometryParentageSets&&(m=this.getEdgeBitSet_(f),h=this.getEdgeBitSet_(u),m=new dc({copy:m}),
m.assignOr(h),this.setEdgeBitSet_(f,m),m=this.getEdgeBitSet_(q),h=this.getEdgeBitSet_(k),m=new dc({copy:m}),m.assignOr(h),this.setEdgeBitSet_(q,m),m=this.getLeftEdgeBitSet_(f),h=this.getLeftEdgeBitSet_(u),m=new dc({copy:m}),m.assignOr(h),this.setLeftEdgeBitSet_(f,m),m=this.getLeftEdgeBitSet_(q),h=this.getLeftEdgeBitSet_(k),m=new dc({copy:m}),m.assignOr(h),this.setLeftEdgeBitSet_(q,m))):-1!==this.m_tmpHalfEdgeWindingNumberIndex?(h=this.getHalfEdgeUserIndex(f,this.m_tmpHalfEdgeWindingNumberIndex)+this.getHalfEdgeUserIndex(u,
this.m_tmpHalfEdgeWindingNumberIndex),k=this.getHalfEdgeUserIndex(q,this.m_tmpHalfEdgeWindingNumberIndex)+this.getHalfEdgeUserIndex(k,this.m_tmpHalfEdgeWindingNumberIndex),this.setHalfEdgeUserIndex(f,this.m_tmpHalfEdgeWindingNumberIndex,h),this.setHalfEdgeUserIndex(q,this.m_tmpHalfEdgeWindingNumberIndex,k)):-1!==this.m_tmpHalfEdgeOddEvenNumberIndex&&(h=this.getHalfEdgeUserIndex(f,this.m_tmpHalfEdgeOddEvenNumberIndex)+this.getHalfEdgeUserIndex(u,this.m_tmpHalfEdgeOddEvenNumberIndex),k=this.getHalfEdgeUserIndex(q,
this.m_tmpHalfEdgeOddEvenNumberIndex)+this.getHalfEdgeUserIndex(k,this.m_tmpHalfEdgeOddEvenNumberIndex),this.setHalfEdgeUserIndex(f,this.m_tmpHalfEdgeOddEvenNumberIndex,h),this.setHalfEdgeUserIndex(q,this.m_tmpHalfEdgeOddEvenNumberIndex,k)),this.mergeVertexListsOfEdges_(f,u),this.deleteEdgeImpl_(u),h=f,b[r]=-1,u===d&&(d=b[0]=-1)):(this.updateVertexToHalfEdgeConnection_(h,!1),h=-1,f=u,g=m,q=k)}this.updateVertexToHalfEdgeConnection_(h,!1);h=-1;if(e){d=-1;for(let r=0,t=b.length;r<t;r++)g=b[r],-1!==g&&
(-1===d?(f=d=g,g=this.getHalfEdgeTo(f),q=this.getHalfEdgeTwin(f)):g!==f&&(c=this.getHalfEdgeTwin(g),e=this.getHalfEdgeOrigin(c),this.setHalfEdgeNext_(q,g),this.setHalfEdgePrev_(g,q),f=g,g=e,q=c));this.setClusterHalfEdge_(n,d)}else{d=-1;for(let r=0,t=b.length;r<t;r++)if(f=b[r],-1!==f){d=f;break}c!==d&&this.setClusterHalfEdge_(n,d)}}}}}sortHalfEdgesByAngleHelper_(a){p.geometryReleaseAssert(0)}sortHalfEdgesByAngle3D_(a){p.geometryReleaseAssert(0)}buildChains_(a){this.m_universeChain=this.newChain_();
this.setChainHalfEdge_(this.m_universeChain,-1);a=this.m_universeChain;const b=this.createUserIndexForHalfEdges();for(let c=this.getFirstCluster();-1!==c;c=this.getNextCluster(c)){const d=this.getClusterHalfEdge(c);if(-1!==d){let e=d;do{if(1!==this.getHalfEdgeUserIndex(e,b)){const f=this.newChain_();this.setChainHalfEdge_(f,e);this.setChainPrev_(f,a);this.setChainNext_(a,f);let g=null;this.m_bBuildGeometryParentageSets&&(g=new dc);a=f;let h=0,k=e;do-1!==this.m_tmpHalfEdgeParentageIndex&&(h|=this.getHalfEdgeUserIndex(k,
this.m_tmpHalfEdgeParentageIndex)),this.m_bBuildGeometryParentageSets&&g.assignOr(this.getEdgeBitSet_(k)),this.setHalfEdgeChain_(k,f),this.setHalfEdgeUserIndex(k,b,1),k=this.getHalfEdgeNext(k);while(k!==e);this.m_bBuildGeometryParentageSets&&this.setChainBitSet_(f,g);this.setChainParentage_(f,h)}e=this.getHalfEdgeNext(this.getHalfEdgeTwin(e))}while(e!==d)}}this.m_chainAreas=new ic(this.m_chainData.size(),Number.NaN);this.m_chainPerimeters=new ic(this.m_chainData.size(),Number.NaN);this.setChainArea_(this.m_universeChain,
Number.POSITIVE_INFINITY);this.setChainPerimeter_(this.m_universeChain,Number.POSITIVE_INFINITY);this.deleteUserIndexForHalfEdges(b)}simplify_(a){p.geometryReleaseAssert(0)}simplifyAlternate_(){p.geometryReleaseAssert(0)}simplifyWinding_(){p.geometryReleaseAssert(0)}setEditShapeImpl_(a,b,c,d,e){this.removeShape();this.m_bBuildChains=e;this.m_shape=a;this.m_geometryIDIndex=this.m_shape.createGeometryUserIndex();a=this.m_shape.getTotalPointCount();if(c){a=0;for(let r=0,t=c.length;r<t;r++)a+=this.m_shape.getPointCount(c[r])}a=
new za(0);for(var f=e=0,g=null!=c?c[0]:this.m_shape.getFirstGeometry(),h=1;-1!==g;){this.m_shape.setGeometryUserIndex(g,this.m_geometryIDIndex,f++);for(var k=this.m_shape.getFirstPath(g);-1!==k;k=this.m_shape.getNextPath(k)){var m=this.m_shape.getFirstVertex(k);for(let r=0,t=this.m_shape.getPathSize(k);r<t;r++)a.add(m),m=this.m_shape.getNextVertex(m)}p.isPoint(this.m_shape.getGeometryType(g))||(e+=this.m_shape.getPathCount(g));null!=c?(g=h<c.length?c[h]:-1,h++):g=this.m_shape.getNextGeometry(g)}this.m_universeGeomID=
1<<Math.min(f,31);this.m_pointCount=a.size();this.m_shape.sortVerticesSimpleByY(a,0,this.m_pointCount);this.m_clusterVertices.setCapacity(this.m_pointCount);this.progress_(d,!0);this.m_clusterData.setCapacity(this.m_pointCount+10);this.m_halfEdgeData.setCapacity(2*this.m_pointCount+32);this.m_chainData.setCapacity(Math.max(32,e));this.m_clusterIndex=this.m_shape.createUserIndex();e=l.Point2D.getNAN();var n=0;f=l.Point2D.getNAN();for(g=0;g<=this.m_pointCount;g++)if(g<this.m_pointCount?(h=a.read(g),
this.m_shape.queryXY(h,f)):f.setNAN(),!e.isEqualPoint2D(f)){if(n<g){h=this.newCluster_();for(m=k=-1;n<g;n++){m=a.read(n);this.m_shape.setUserIndex(m,this.m_clusterIndex,h);var q=this.m_clusterVertices.newElement();this.m_clusterVertices.setField(q,0,m);this.m_clusterVertices.setField(q,1,k);k=q;q=this.m_shape.getPathFromVertex(m);q=this.m_shape.getGeometryFromPath(q);q=this.getGeometryID(q);this.setClusterParentage_(h,this.getClusterParentage(h)|q)}this.setClusterVertexIterator_(h,k);this.setClusterVertexIndex_(h,
this.m_shape.getVertexIndex(m));-1!==this.m_lastCluster&&this.setNextCluster_(this.m_lastCluster,h);this.setPrevCluster_(h,this.m_lastCluster);this.m_lastCluster=h;-1===this.m_firstCluster&&(this.m_firstCluster=h)}n=g;e.setCoordsPoint2D(f)}if(this.m_shape.hasSegmentParentage())for(-1===this.m_clusterBreakNodeIndex&&(this.m_clusterBreakNodeIndex=this.createUserIndexForClusters()),e=0;e<this.m_pointCount;e++)f=a.read(e),this.m_shape.getSegmentParentageBreakVertex(f)&&(f=this.getClusterFromVertex(f),
this.setBreakNode(f,!0));this.progress_(d,!0);e=null!=c?c[0]:this.m_shape.getFirstGeometry();for(f=1;-1!==e;){for(g=this.m_shape.getFirstPath(e);-1!==g;g=this.m_shape.getNextPath(g))this.m_shape.isStrongPathStart(g)&&(h=this.m_shape.getFirstVertex(g),h=this.getClusterFromVertex(h),this.setStrongPathNode(h,!0)),this.m_shape.isStrongPathEnd(g)&&(h=this.m_shape.isClosedPath(g)?this.m_shape.getFirstVertex(g):this.m_shape.getLastVertex(g),h=this.getClusterFromVertex(h),this.setStrongPathNode(h,!0));null!=
c?(e=f<c.length?c[f]:-1,f++):e=this.m_shape.getNextGeometry(e)}b===qb.enumInputModeBuildGraph&&(this.m_tmpHalfEdgeParentageIndex=this.createUserIndexForHalfEdges(),this.m_tmpHalfEdgeParentageIndexLeft=this.createUserIndexForHalfEdges());b===qb.enumInputModeSimplifyWinding&&(this.m_tmpHalfEdgeWindingNumberIndex=this.createUserIndexForHalfEdges());b===qb.enumInputModeSimplifyAlternate&&(this.m_tmpHalfEdgeOddEvenNumberIndex=this.createUserIndexForHalfEdges());this.createHalfEdges_(b,a);this.dbgNavigate_();
this.sortHalfEdgesByAngle_(b);Number.isNaN(this.m_checkDirtyPlanesweepTolerance)||this.checkStructureAfterDirtySweep_()?(this.buildChains_(b),-1!==this.m_tmpHalfEdgeParentageIndex&&(this.deleteUserIndexForHalfEdges(this.m_tmpHalfEdgeParentageIndex),this.m_tmpHalfEdgeParentageIndex=-1),this.m_bBuildChains&&this.planeSweepParentage_(b,d),-1!==this.m_tmpHalfEdgeParentageIndexLeft&&(this.deleteUserIndexForHalfEdges(this.m_tmpHalfEdgeParentageIndexLeft),this.m_tmpHalfEdgeParentageIndexLeft=-1),this.dbgChkChainParents_(),
this.dbgDumpChains_(),this.mergeSegmentParentage_(),this.dbgNavigate_(),this.dbgDumpChains_()):this.m_bDirtyCheckFailed=!0;this.cleanSetEditShapeImpl_()}setEditShapeImpl3D_(a,b,c,d,e){p.geometryReleaseAssert(0)}cleanSetEditShapeImpl_(){-1!==this.m_tmpHalfEdgeParentageIndex&&(this.deleteUserIndexForHalfEdges(this.m_tmpHalfEdgeParentageIndex),this.m_tmpHalfEdgeParentageIndex=-1);-1!==this.m_tmpHalfEdgeParentageIndexLeft&&(this.deleteUserIndexForHalfEdges(this.m_tmpHalfEdgeParentageIndexLeft),this.m_tmpHalfEdgeParentageIndexLeft=
-1);-1!==this.m_tmpHalfEdgeWindingNumberIndex&&(this.deleteUserIndexForHalfEdges(this.m_tmpHalfEdgeWindingNumberIndex),this.m_tmpHalfEdgeWindingNumberIndex=-1);-1!==this.m_tmpHalfEdgeOddEvenNumberIndex&&(this.deleteUserIndexForHalfEdges(this.m_tmpHalfEdgeOddEvenNumberIndex),this.m_tmpHalfEdgeOddEvenNumberIndex=-1)}cleanSetEditShapeImpl3D_(){p.geometryReleaseAssert(0)}dbgNavigate_(){}dbgChkChainParents_(){}deleteEdgeImpl_(a){const b=this.getHalfEdgeNext(a);var c=this.getHalfEdgePrev(a);const d=this.getHalfEdgeTwin(a);
var e=this.getHalfEdgeNext(d);const f=this.getHalfEdgePrev(d);b!==d&&(this.setHalfEdgeNext_(f,b),this.setHalfEdgePrev_(b,f));c!==d&&(this.setHalfEdgeNext_(c,e),this.setHalfEdgePrev_(e,c));c=this.getHalfEdgeOrigin(a);this.getClusterHalfEdge(c)===a&&(e!==a?this.setClusterHalfEdge_(c,e):this.setClusterHalfEdge_(c,-1));e=this.getHalfEdgeOrigin(d);this.getClusterHalfEdge(e)===d&&(b!==d?this.setClusterHalfEdge_(e,b):this.setClusterHalfEdge_(e,-1));this.m_halfEdgeData.deleteElement(a);this.m_halfEdgeData.deleteElement(d)}getLeftSkipPolylines_(a,
b){for(;;)if(b=a.getPrev(b),-1!==b){const c=a.getElement(b);if(this.getHalfEdgeChain(c)!==this.getHalfEdgeChain(this.getHalfEdgeTwin(c)))return c}else return-1}checkStructureAfterDirtySweep_(){const a=l.sqr(this.m_checkDirtyPlanesweepTolerance),b=new l.Point2D,c=new l.Point2D,d=new l.Point2D,e=new l.Point2D,f=new l.Point2D;for(let h=this.getFirstCluster();-1!==h;h=this.getNextCluster(h)){const k=this.getClusterHalfEdge(h);if(-1!==k){let m=k;this.getHalfEdgeFromXY(m,b);this.getHalfEdgeToXY(m,c);d.setSub(c,
b);let n=d.sqrLength();do{var g=m;m=this.getHalfEdgeNext(this.getHalfEdgeTwin(m));if(m!==g){this.getHalfEdgeToXY(m,e);f.setSub(e,b);g=f.sqrLength();const q=f.crossProduct(d);if(q*q/(g*n)*Math.min(g,n)<=a&&0<=f.dotProduct(d))return!1;d.assign(f);n=g;c.assign(e)}}while(m!==k)}}return!0}extractPolygonPathFromChain_(a,b,c,d,e){const f=this.m_shape.hasSegmentParentage(),g=this.getChainHalfEdge(c);let h=g,k=-1;const m=new Y;do{var n=this.getHalfEdgeTwin(h);if(this.getHalfEdgeChain(n)!==c){var q=-1;n=this.getHalfEdgeOrigin(h);
if(-1===d)q=this.getClusterVertexIterator(n),q=this.getVertexFromVertexIterator(q);else for(var r=this.getClusterVertexIterator(n);-1!==r;r=this.incrementVertexIterator(r)){const t=this.getVertexFromVertexIterator(r);-1===q&&(q=t);const u=this.m_shape.getPathFromVertex(t);if(this.m_shape.getGeometryFromPath(u)===d){q=t;break}}-1===k&&(k=a.insertPath(b,-1),a.setClosedPath(k,!0));this.m_shape===a?q=a.addVertex(k,q):(this.m_shape.queryPoint(q,m),q=a.addPoint(k,m));this.isHalfEdgeCurve(h)&&(this.querySegmentXY(h,
e),a.setSegmentToIndex(a.getVertexIndex(q),e.get().clone()));f&&(r=this.getSegmentParentage(h),a.setSegmentParentageAndBreak(q,r,this.isBreakNode(n)))}h=this.getHalfEdgeNext(h)}while(h!==g)}mergeSegmentParentage_(){if(this.m_shape.hasSegmentParentage()){p.geometryReleaseAssert(-1!==this.m_clusterBreakNodeIndex);p.geometryReleaseAssert(-1===this.m_segmentParentageIndex);for(var a=this.getFirstCluster();-1!==a;a=this.getNextCluster(a)){var b=0,c=this.getClusterHalfEdge(a);if(-1!==c){var d=c;do b++,
d=this.getHalfEdgeNext(this.getHalfEdgeTwin(d));while(d!==c&&3>b)}2!==b&&this.setBreakNode(a,!0)}a=[];b=[];this.m_segmentParentageIndex=this.createUserIndexForHalfEdges();c=this.createUserIndexForHalfEdges();for(d=this.getFirstCluster();-1!==d;d=this.getNextCluster(d)){const g=this.getClusterHalfEdge(d);if(-1!==g){var e=!1;let h=g;do{let k=h;for(;-1===this.getHalfEdgeUserIndex(k,c);){const m=this.getHalfEdgeNext(k),n=this.getHalfEdgeTwin(k);kj(this,k,b);const q=b.at(-1).parentage;if(!e){var f=this.getHalfEdgeOrigin(k);
this.isBreakNode(f)||(f=this.getHalfEdgePrev(k),k!==f&&(kj(this,f,a),e=!0))}e&&!Am(b,a)&&(e=this.getHalfEdgeOrigin(k),this.setBreakNode(e,!0));a=l.swap(b,b=a);e=!0;f=this.getHalfEdgeOrigin(m);this.isBreakNode(f)&&(e=!1);this.setHalfEdgeUserIndex(k,this.m_segmentParentageIndex,q);this.setHalfEdgeUserIndex(n,this.m_segmentParentageIndex,q);this.setHalfEdgeUserIndex(k,c,1);this.setHalfEdgeUserIndex(n,c,1);k=m}h=this.getHalfEdgeNext(this.getHalfEdgeTwin(h))}while(h!==g)}}this.deleteUserIndexForHalfEdges(c)}}registerNewBitSet(a){null===
this.m_uniqueBitSets&&(this.m_uniqueBitSets=Bm(),this.m_uniqueBitSets.add(this.getEmptySet()));if(null===a)return this.getEmptySet();if(this.m_uniqueBitSets.has(a))return this.m_uniqueBitSets.get(a);this.m_uniqueBitSets.add(a);return a}getLeftEdgeBitSet_(a){a=this.getHalfEdgeUserIndex(a,this.m_edgeBitSetIndexLeft);p.geometryReleaseAssert(0<=a);p.geometryReleaseAssert(this.m_edgeBitSets.at(a));return this.m_edgeBitSets.at(a)}getEdgeBitSet_(a){a=this.getHalfEdgeUserIndex(a,this.m_edgeBitSetIndex);p.geometryReleaseAssert(0<=
a);return this.m_edgeBitSets.at(a)}setEdgeBitSet_(a,b){p.geometryReleaseAssert(this.m_bBuildGeometryParentageSets);b=this.registerNewBitSet(b);-1===this.m_edgeBitSetIndex&&(this.m_edgeBitSetIndex=this.createUserIndexForHalfEdges());const c=this.getHalfEdgeUserIndex(a,this.m_edgeBitSetIndex);-1!==c?this.m_edgeBitSets[c]=b:(this.setHalfEdgeUserIndex(a,this.m_edgeBitSetIndex,this.m_edgeBitSets.length),this.m_edgeBitSets.push(b))}setLeftEdgeBitSet_(a,b){p.geometryReleaseAssert(this.m_bBuildGeometryParentageSets);
b=this.registerNewBitSet(b);-1===this.m_edgeBitSetIndexLeft&&(this.m_edgeBitSetIndexLeft=this.createUserIndexForHalfEdges());const c=this.getHalfEdgeUserIndex(a,this.m_edgeBitSetIndexLeft);-1!==c?this.m_edgeBitSets[c]=b:(this.setHalfEdgeUserIndex(a,this.m_edgeBitSetIndexLeft,this.m_edgeBitSets.length),this.m_edgeBitSets.push(b))}setChainBitSet_(a,b){p.geometryReleaseAssert(this.m_bBuildGeometryParentageSets);b=this.registerNewBitSet(b);-1===this.m_chainBitSetIndex&&(this.m_chainBitSetIndex=this.createUserIndexForChains());
const c=this.getChainUserIndex(a,this.m_chainBitSetIndex);-1!==c?this.m_chainBitSets[c]=b:(this.setChainUserIndex(a,this.m_chainBitSetIndex,this.m_chainBitSets.length),this.m_chainBitSets.push(b))}getEmptySet(){this.m_emptyBitSet||(this.m_emptyBitSet=new dc);return this.m_emptyBitSet}deleteEdgeBitSets_(){-1!==this.m_edgeBitSetIndex&&(this.deleteUserIndexForHalfEdges(this.m_edgeBitSetIndex),this.m_edgeBitSetIndex=-1);-1!==this.m_edgeBitSetIndexLeft&&(this.deleteUserIndexForHalfEdges(this.m_edgeBitSetIndexLeft),
this.m_edgeBitSetIndexLeft=-1);this.m_edgeBitSets.length=0;this.m_uniqueBitSets=null}deleteChainBitSets_(){-1!==this.m_chainBitSetIndex&&(this.deleteUserIndexForChains(this.m_chainBitSetIndex),this.m_chainBitSetIndex=-1,this.m_chainBitSets.length=0)}dbgPrintEdge_(a){p.geometryReleaseAssert(0)}dbgVerifyEdgeSegment(a){p.geometryReleaseAssert(0)}}ec.c_EdgeParentageMask=2147483647;ec.c_EdgeBitMask=-2147483648;class wa{freeNode_(a){this.m_listNodes.deleteElement(a)}newNode_(){return this.m_listNodes.newElement()}freeList_(a){this.m_lists.deleteElement(a)}newList_(){return this.m_lists.newElement()}Init_(a){p.geometryReleaseAssert(0)}constructor(a){this.m_listNodes=
new U(2);this.m_listOfLists=wa.st_nullNode();this.m_bAllowNavigationBetweenLists=!0;void 0===a&&(a=!0);this.m_bAllowNavigationBetweenLists=a;this.m_lists=new U(this.m_bAllowNavigationBetweenLists?4:2)}createList(){const a=this.newList_();this.m_bAllowNavigationBetweenLists&&(this.m_lists.setField(a,3,this.m_listOfLists),this.m_listOfLists!==wa.st_nullNode()&&this.m_lists.setField(this.m_listOfLists,2,a),this.m_listOfLists=a);return a}deleteList(a){for(var b=this.getFirst(a);b!==wa.st_nullNode();){var c=
b;b=this.getNext(b);this.freeNode_(c)}this.m_bAllowNavigationBetweenLists&&(b=this.m_lists.getField(a,2),c=this.m_lists.getField(a,3),b!==wa.st_nullNode()?this.m_lists.setField(b,3,c):this.m_listOfLists=c,c!==wa.st_nullNode()&&this.m_lists.setField(c,2,b));this.freeList_(a)}reserveLists(a){this.m_lists.setCapacity(a)}addElement(a,b){this.m_lists.getField(a,0);const c=this.m_lists.getField(a,1),d=this.newNode_();c!==wa.st_nullNode()?this.m_listNodes.setField(c,1,d):this.m_lists.setField(a,0,d);this.m_lists.setField(a,
1,d);this.m_listNodes.setField(d,0,b);return d}reserveNodes(a){this.m_listNodes.setCapacity(a)}deleteElementDirect(a,b,c){b!==wa.st_nullNode()?(this.m_listNodes.setField(b,1,this.m_listNodes.getField(c,1)),this.m_lists.getField(a,1)===c&&this.m_lists.setField(a,1,b)):(this.m_lists.setField(a,0,this.m_listNodes.getField(c,1)),this.m_lists.getField(a,1)===c&&this.m_lists.setField(a,1,wa.st_nullNode()));this.freeNode_(c)}deleteElementSearch(a,b){let c=-1,d=this.getFirst(a);for(;d!==b;)c=d,d=this.getNext(d);
this.deleteElementDirect(a,c,b)}concatenateLists(a,b){var c=this.m_lists.getField(a,1),d=this.m_lists.getField(b,0);d!==wa.st_nullNode()&&(c!==wa.st_nullNode()?this.m_listNodes.setField(c,1,d):this.m_lists.setField(a,0,d),this.m_lists.setField(a,1,this.m_lists.getField(b,1)));this.m_bAllowNavigationBetweenLists&&(c=this.m_lists.getField(b,2),d=this.m_lists.getField(b,3),c!==wa.st_nullNode()?this.m_lists.setField(c,3,d):this.m_listOfLists=d,d!==wa.st_nullNode()&&this.m_lists.setField(d,2,c));this.freeList_(b);
return a}getElement(a){return this.m_listNodes.getField(a,0)}getData(a){return this.getElement(a)}setElement(a,b){p.geometryReleaseAssert(0)}getNext(a){return this.m_listNodes.getField(a,1)}getFirst(a){return this.m_lists.getField(a,0)}getFirstElement(a){a=this.getFirst(a);return this.getElement(a)}static st_nullNode(){return-1}clear(){this.m_listNodes.deleteAll(!0);this.m_lists.deleteAll(!0);this.m_listOfLists=wa.st_nullNode()}isEmpty(a){p.geometryReleaseAssert(0);return!1}getNodeCount(){return this.m_listNodes.size()}getListCount(){return this.m_lists.size()}getFirstList(){return this.m_listOfLists}getNextList(a){return this.m_lists.getField(a,
3)}}class Il extends bd{constructor(a,b,c){super(!0);this.m_bIntersectionDetected=!1;this.m_nonSimpleResult=new va;this.m_tempSimpleEdge1=Gg();this.m_tempSimpleEdge2=Gg();this.m_currentNode=this.m_vertex2=this.m_vertex1=this.m_prev2=this.m_prev1=-1;this.m_prevY=this.m_prevX2=this.m_prevX1=Number.NaN;this.m_prevX=0;this.m_sweepY=Number.NaN;this.m_sweepX=0;this.m_ptSweep=new l.Point2D;this.m_simpleEdgesCache=[];this.m_simpleEdgesRecycle=[];this.m_cOutstandingConstructedEdges=0;this.m_shape=a;this.m_bShapeHasSegments=
this.m_shape.hasCurves();this.m_tolerance=b;this.m_tolerance10=10*b;this.m_bIsSimple=c;a=Math.trunc(Math.min(3*a.getTotalPointCount()/2,67));this.m_simpleEdgesCache.length=Math.min(7,a)}tryGetCachedEdge_(a){const b=this.m_simpleEdgesCache[(a&l.indexTypeMax())%this.m_simpleEdgesCache.length];return b&&b.m_value===a?b:null}tryDeleteCachedEdge_(a){const b=(a&l.indexTypeMax())%this.m_simpleEdgesCache.length,c=this.m_simpleEdgesCache[b];c&&c.m_value===a&&(this.m_simpleEdgesRecycle.push(c),this.m_simpleEdgesCache[b]=
null)}tryCreateCachedEdge_(a){const b=(a&l.indexTypeMax())%this.m_simpleEdgesCache.length;let c=this.m_simpleEdgesCache[b];return c?null:(0===this.m_simpleEdgesRecycle.length?(c=Gg(),this.m_cOutstandingConstructedEdges++):c=this.m_simpleEdgesRecycle.pop(),c.m_value=a,this.m_simpleEdgesCache[b]=c)}initSimpleEdge_(a,b){this.m_bShapeHasSegments&&this.initSimpleEdgeHelper_(a,b)||a.m_bCurve||(this.m_shape.queryLineConnector(b,a.m_line,!0),a.m_segment=a.m_line,a.m_env.setCoordsNoNAN(a.m_line.getStartX(),
a.m_line.getEndX()),a.m_env.vmax+=this.m_tolerance,a.m_line.orientBottomUp(),a.m_bHorizontal=a.m_line.getEndY()===a.m_line.getStartY(),a.m_bHorizontal||(a.m_dxdy=(a.m_line.getEndX()-a.m_line.getStartX())/(a.m_line.getEndY()-a.m_line.getStartY())))}initSimpleEdgeHelper_(a,b){a.m_segment=this.m_shape.getSegment(b);a.m_segmentInfo=this.m_shape.getOriginalSegmentInfo(b);a.m_bCurve=null!==a.m_segment;return a.m_bCurve?(b=a.m_segment.clone(),b.orientBottomUp(),a.m_segment=b,a.m_env=a.m_segment.queryInterval(0,
0),a.m_env.vmax+=this.m_tolerance,!0):!1}compareTwoSegments_(a,b){var c=a.getStartXY(),d=a.getEndXY(),e=b.getStartXY(),f=b.getEndXY();this.m_ptSweep.setCoords(this.m_sweepX,this.m_sweepY);if(c.isEqualPoint2D(e)&&this.m_sweepY===c.y){this.m_ptSweep.assign(0>d.compare(f)?d:f);var g=a.intersectionOfYMonotonicWithAxisX(this.m_ptSweep.y,this.m_ptSweep.x),h=b.intersectionOfYMonotonicWithAxisX(this.m_ptSweep.y,this.m_ptSweep.x);if(Math.abs(g-h)>this.m_tolerance)return g<h?-1:1}c=0>c.compare(e)?e:c;d=0>d.compare(f)?
d:f;e=f=0;for(g=1;5>g;g++){l.lerpPoint2D(c,d,g/5,this.m_ptSweep);h=a.intersectionOfYMonotonicWithAxisX(this.m_ptSweep.y,this.m_ptSweep.x);const k=b.intersectionOfYMonotonicWithAxisX(this.m_ptSweep.y,this.m_ptSweep.x),m=Math.abs(h-k);m>f&&(f=m,e=h<k?-1:1)}return 0===e?this.errorCracking():e}compareNonHorizontal_(a,b){if(a.m_line.getStartY()===b.m_line.getStartY()&&a.m_line.getStartX()===b.m_line.getStartX())return a.m_line.getEndY()===b.m_line.getEndY()&&a.m_line.getEndX()===b.m_line.getEndX()?this.m_bIsSimple?
this.errorCoincident():0:this.compareNonHorizontalUpperEnd_(a,b);if(a.m_line.getEndY()===b.m_line.getEndY()&&a.m_line.getEndX()===b.m_line.getEndX())return this.compareNonHorizontalLowerEnd_(a,b);const c=this.compareNonHorizontalLowerEnd_(a,b);a=this.compareNonHorizontalUpperEnd_(a,b);return 0>c&&0>a?-1:0<c&&0<a?1:this.errorCracking()}compareHorizontal1Case1_(a,b){if(a.getEndX()>b.getEndX()){if(b.getEndX()>b.getStartX()&&b.getEndY()-b.getStartY()<2*this.m_tolerance&&a.isIntersectingPoint(b.getEndXY(),
this.m_tolerance,!0))return this.errorCracking()}else if((b.getEndY()-b.getStartY())/(b.getEndX()-b.getStartX())*(a.getEndX()-a.getStartX())<this.m_tolerance10&&b.isIntersectingPoint(a.getEndXY(),this.m_tolerance,!0))return this.errorCracking();return 1}compareHorizontal1Case2_(a,b){if(a.getStartX()<b.getStartX()){if(b.getEndX()>b.getStartX()&&b.getEndY()-b.getStartY()<2*this.m_tolerance&&a.isIntersectingPoint(b.getEndXY(),this.m_tolerance,!0))return this.errorCracking()}else if((b.getEndY()-b.getStartY())/
(b.getEndX()-b.getStartX())*(a.getStartX()-a.getEndX())<this.m_tolerance10&&b.isIntersectingPoint(a.getStartXY(),this.m_tolerance,!0))return this.errorCracking();return-1}compareHorizontal1Case3_(a,b){var c=l.Point2D.getNAN();c.setSub(b.getEndXY(),b.getStartXY());c.rightPerpendicularThis();c.normalize();var d=l.Point2D.getNAN();d.setSub(a.getStartXY(),b.getStartXY());var e=l.Point2D.getNAN();e.setSub(a.getEndXY(),b.getStartXY());d=d.dotProduct(c);c=e.dotProduct(c);e=Math.abs(d);const f=Math.abs(c);
if(e<f){if(e<this.m_tolerance10&&b.isIntersectingPoint(a.getStartXY(),this.m_tolerance,!0))return this.errorCracking()}else if(f<this.m_tolerance10&&b.isIntersectingPoint(a.getEndXY(),this.m_tolerance,!0))return this.errorCracking();return 0>d&&0>c?-1:0<d&&0<c?1:this.errorCracking()}compareHorizontal1_(a,b){return a.getStartY()===b.getStartY()&&a.getStartX()===b.getStartX()?this.compareHorizontal1Case1_(a,b):a.getEndY()===b.getEndY()&&a.getEndX()===b.getEndX()?this.compareHorizontal1Case2_(a,b):this.compareHorizontal1Case3_(a,
b)}compareHorizontal2_(a,b){return a.getEndY()===b.getEndY()&&a.getEndX()===b.getEndX()&&a.getStartY()===b.getStartY()&&a.getStartX()===b.getStartX()?this.m_bIsSimple?this.errorCoincident():0:this.errorCracking()}compareNonHorizontalLowerEnd_(a,b){let c=1;if(a.m_line.getStartY()<b.m_line.getStartY()){c=-1;var d=a;a=b;b=d}a=a.m_line;d=b.m_line;const e=a.getStartX()-d.getStartX();b=b.m_dxdy*(a.getStartY()-d.getStartY());const f=this.m_tolerance10;return e<b-f?-c:e>b+f?c:d.isIntersectingPoint(a.getStartXY(),
this.m_tolerance,!0)?this.errorCracking():e<b?-c:c}compareNonHorizontalUpperEnd_(a,b){let c=1;if(b.m_line.getEndY()<a.m_line.getEndY()){c=-1;var d=a;a=b;b=d}a=a.m_line;d=b.m_line;const e=a.getEndX()-d.getStartX();b=b.m_dxdy*(a.getEndY()-d.getStartY());const f=this.m_tolerance10;return e<b-f?-c:e>b+f?c:d.isIntersectingPoint(a.getEndXY(),this.m_tolerance,!0)?this.errorCracking():e<b?-c:c}errorCoincident(){this.m_bIntersectionDetected=!0;this.m_nonSimpleResult=new va(7,this.m_vertex1,this.m_vertex2);
return-1}errorCracking(){this.m_bIntersectionDetected=!0;this.m_bIsSimple?this.m_nonSimpleResult=new va(6,this.m_vertex1,this.m_vertex2):this.m_vertex2=this.m_vertex1=this.m_prev2=this.m_prev1=-1;return-1}compareSegments_(a,b,c,d){if(c.m_env.vmax<d.m_env.vmin)return-1;if(d.m_env.vmax<c.m_env.vmin)return 1;if(!c.m_bCurve&&!d.m_bCurve){var e=c.m_bHorizontal?1:0;e|=d.m_bHorizontal?2:0;return 0===e?this.compareNonHorizontal_(c,d):1===e?this.compareHorizontal1_(c.m_line,d.m_line):2===e?-1*this.compareHorizontal1_(d.m_line,
c.m_line):this.compareHorizontal2_(c.m_line,d.m_line)}if(this.m_bIntersectionDetected)return-1;var f=this.m_prevY===this.m_sweepY&&this.m_prevX===this.m_sweepX;f&&a===this.m_prev1?e=this.m_prevX1:(e=Number.NaN,this.m_prev1=-1);f&&b===this.m_prev2?f=this.m_prevX2:(f=Number.NaN,this.m_prev2=-1);this.m_prevY=this.m_sweepY;this.m_prevX=this.m_sweepX;Number.isNaN(e)&&(this.m_prev1=a,this.m_prevX1=e=a=c.m_segment.intersectionOfYMonotonicWithAxisX(this.m_sweepY,this.m_sweepX));Number.isNaN(f)&&(this.m_prev2=
b,this.m_prevX2=f=b=d.m_segment.intersectionOfYMonotonicWithAxisX(this.m_sweepY,this.m_sweepX));b=Hc(!0,!0,c.m_segment,d.m_segment,this.m_tolerance,!0);if(0!==b){if(2===b){if(this.m_bIsSimple)return this.errorCoincident();if(c.m_segmentInfo.equals(d.m_segmentInfo))return 0}return this.errorCracking()}return Math.abs(e-f)<=this.m_tolerance?this.compareTwoSegments_(c.m_segment,d.m_segment):e<f?-1:e>f?1:0}clearIntersectionDetectedFlag(){this.m_bIntersectionDetected=!1}intersectionDetected(){return this.m_bIntersectionDetected}getLastComparedNode(){return this.m_currentNode}getResult(){return this.m_nonSimpleResult}setSweepY(a,
b){this.m_sweepY=a;this.m_sweepX=b;this.m_vertex2=this.m_vertex1=this.m_prev2=this.m_prev1=-1}compare(a,b,c){if(this.m_bIntersectionDetected)return-1;a=a.getElement(c);this.m_currentNode=c;return this.compareSegments(b,b,a,a)}compareSegments(a,b,c,d){let e=this.tryGetCachedEdge_(a);null===e?this.m_vertex1===b?e=this.m_tempSimpleEdge1:(this.m_vertex1=b,e=this.tryCreateCachedEdge_(a),null===e&&(e=this.m_tempSimpleEdge1,this.m_tempSimpleEdge1.m_value=a),this.initSimpleEdge_(e,b)):this.m_vertex1=b;a=
this.tryGetCachedEdge_(c);null===a?this.m_vertex2===d?a=this.m_tempSimpleEdge2:(this.m_vertex2=d,a=this.tryCreateCachedEdge_(c),null===a&&(a=this.m_tempSimpleEdge2,this.m_tempSimpleEdge2.m_value=c),this.initSimpleEdge_(a,d)):this.m_vertex2=d;return this.compareSegments_(b,d,e,a)}onDelete(a){this.tryDeleteCachedEdge_(a)}onSet(a){this.tryDeleteCachedEdge_(a)}onEndSearch(a){this.tryDeleteCachedEdge_(a)}onAddUniqueElementFailed(a){this.tryDeleteCachedEdge_(a)}}class Jl{constructor(a,b){this.m_bIntersectionDetected=
!1;this.m_pointOfInterest=l.Point2D.getNAN();this.m_line1=new Z;this.m_seg1=null;this.m_env=l.Envelope1D.constructEmpty();this.m_currentNode=this.m_vertex1=-1;this.m_minDist=Number.MAX_VALUE;this.m_shape=a;this.m_tolerance=b}getCurrentNode(){return this.m_currentNode}clearIntersectionDetectedFlag(){this.m_bIntersectionDetected=!1;this.m_minDist=Number.MAX_VALUE}intersectionDetected(){return this.m_bIntersectionDetected}setPoint(a){this.m_pointOfInterest.assign(a)}compare(a,b){const c=a.getElement(b);
return this.compareVertex(a,b,c)}compareVertex(a,b,c){a=this.m_shape.getSegment(c);var d=!0;null==a?(this.m_shape.queryLineConnector(c,this.m_line1,!0),this.m_env.setCoordsNoNAN(this.m_line1.getStartX(),this.m_line1.getEndX()),a=this.m_line1,c=this.m_line1.getStartY()===this.m_line1.getEndY()):(d=D.constructEmpty(),a.queryLooseEnvelope(d),d.queryIntervalX(this.m_env),c=0===d.height(),d=!1);if(this.m_pointOfInterest.x+this.m_tolerance<this.m_env.vmin)return-1;if(this.m_pointOfInterest.x-this.m_tolerance>
this.m_env.vmax)return 1;if(c)return this.m_currentNode=b,this.m_bIntersectionDetected=!0,0;c=0;if(d){Xh(this.m_line1);c=this.m_line1.getStartXY();d=new l.Point2D;d.setSub(this.m_line1.getEndXY(),c);d.rightPerpendicularThis();const e=new l.Point2D;e.setSub(this.m_pointOfInterest,c);c=d.dotProduct(e);c/=d.length()}else c=a.intersectionOfYMonotonicWithAxisX(this.m_pointOfInterest.y,this.m_pointOfInterest.x)-this.m_pointOfInterest.x;if(c<10*-this.m_tolerance)return-1;if(c>10*this.m_tolerance)return 1;
a.isIntersectingPoint(this.m_pointOfInterest,this.m_tolerance)&&(Math.abs(c)<this.m_minDist&&(this.m_currentNode=b,this.m_minDist=c),this.m_bIntersectionDetected=!0);return 0>c?-1:0<c?1:0}}class xe{constructor(a,b){this.m_lists=new wa(!1);this.m_hash=b;this.m_hashBuckets=new Int32Array(a);this.m_hashBuckets.fill(xe.st_nullNode());this.m_bitFilter=new Int32Array(10*a+31>>5)}reserveElements(a){this.m_lists.reserveLists(Math.min(this.m_hashBuckets.length,a));this.m_lists.reserveNodes(a)}addElement(a,
b){void 0===b&&(b=this.m_hash.getHash(a));var c=b%(this.m_bitFilter.length<<5);this.m_bitFilter[c>>5]|=1<<(c&31);b%=this.m_hashBuckets.length;c=this.m_hashBuckets[b];c===wa.st_nullNode()&&(c=this.m_lists.createList(),this.m_hashBuckets[b]=c);return this.m_lists.addElement(c,a)}deleteElement(a,b){void 0===b&&(b=this.m_hash.getHash(a));b%=this.m_hashBuckets.length;const c=this.m_hashBuckets[b];c===wa.st_nullNode()&&p.throwInvalidArgumentException("");let d=this.m_lists.getFirst(c),e=wa.st_nullNode();
for(;d!==wa.st_nullNode();){const f=this.m_lists.getData(d),g=this.m_lists.getNext(d);f===a?(this.m_lists.deleteElementDirect(c,e,d),this.m_lists.getFirst(c)===wa.st_nullNode()&&(this.m_lists.deleteList(c),this.m_hashBuckets[b]=wa.st_nullNode())):e=d;d=g}}getFirstInBucket(a){const b=a%(this.m_bitFilter.length<<5);if(0===(this.m_bitFilter[b>>5]&1<<(b&31)))return wa.st_nullNode();a=this.m_hashBuckets[a%this.m_hashBuckets.length];return a===wa.st_nullNode()?wa.st_nullNode():this.m_lists.getFirst(a)}getNextInBucket(a){return this.m_lists.getNext(a)}findNode(a){var b=
this.m_hash.getHash(a);for(b=this.getFirstInBucket(b);b!==wa.st_nullNode();){const c=this.m_lists.getData(b);if(this.m_hash.equal(c,a))return b;b=this.m_lists.getNext(b)}return wa.st_nullNode()}getNextNode(a){p.geometryReleaseAssert(0);return 0}deleteNode(a){var b=this.getElement(a);b=this.m_hash.getHash(b)%this.m_hashBuckets.length;const c=this.m_hashBuckets[b];c===wa.st_nullNode()&&p.throwInvalidArgumentException("");this.m_lists.deleteElementSearch(c,a);this.m_lists.getFirst(c)===wa.st_nullNode()&&
(this.m_lists.deleteList(c),this.m_hashBuckets[b]=wa.st_nullNode())}getElement(a){return this.m_lists.getData(a)}static st_nullNode(){return wa.st_nullNode()}clear(){p.geometryReleaseAssert(0)}size(){return this.m_lists.getNodeCount()}dbgPrintBucketHistogram(){p.geometryReleaseAssert(0)}}class Kl{constructor(a,b,c,d,e){this.m_workPt=new l.Point2D;this.m_shape=a;this.m_sqrTolerance=c;this.m_invCellSize=d;this.m_origin=b.clone();this.m_hashValues=e}getHash(a){return this.m_shape.getUserIndex(a,this.m_hashValues)}calculateHash(a){p.geometryReleaseAssert(0);
return 0}calculateHashFromVertex(a){this.m_shape.queryXY(a,this.m_workPt);return oj(Math.trunc((this.m_workPt.x-this.m_origin.x)*this.m_invCellSize+.5),Math.trunc((this.m_workPt.y-this.m_origin.y)*this.m_invCellSize+.5))}dbgCalculateHashFromXy(a,b){p.geometryReleaseAssert(0);return 0}equal(a,b){p.geometryReleaseAssert(0);return!1}}class mj{constructor(a){this.m_origin=l.Point2D.getNAN();this.m_invCellSize=this.m_cellSize=this.m_sqrTolerance=0;this.m_geometry=-1;this.m_bucketArray=Array(4);this.m_bucketHash=
Array(4);this.m_dbgCandidateCheckCount=0;this.m_nsr=new va;this.m_newClusters=this.m_hashValues=-1;this.m_bHasSegmentParentage=this.m_bTrackChanges=!1;this.m_shape=null;this.m_clusters=new wa;this.m_hashTable=this.m_hashFunction=null;this.m_progressCounter=0;this.m_progressTracker=a}progress_(){}getNearestNeighbourCandidate(a,b,c,d,e){p.geometryReleaseAssert(0)}findClusterCandidate(a,b){p.geometryReleaseAssert(0)}collectClusterCandidates(a,b){const c=l.Point2D.getNAN();this.m_shape.queryXY(a,c);var d=
Math.trunc((c.x-this.m_origin.x)*this.m_invCellSize),e=Math.trunc((c.y-this.m_origin.y)*this.m_invCellSize);let f=0;for(var g=0;1>=g;g+=1)for(let h=0;1>=h;h+=1){const k=oj(d+g,e+h),m=this.m_hashTable.getFirstInBucket(k);m!==xe.st_nullNode()&&(this.m_bucketArray[f]=m,this.m_bucketHash[f]=k,f++)}for(d=f-1;1<=d;d--)for(e=this.m_bucketArray[d],g=d-1;0<=g;g--)if(e===this.m_bucketArray[g]){this.m_bucketHash[g]=-1;f--;d!==f&&(this.m_bucketHash[d]=this.m_bucketHash[f],this.m_bucketArray[d]=this.m_bucketArray[f]);
break}for(d=0;d<f;d++)this.collectNearestNeighbourCandidates(a,this.m_bucketHash[d],c,this.m_bucketArray[d],b)}collectNearestNeighbourCandidates(a,b,c,d,e){const f=l.Point2D.getNAN();for(;d!==xe.st_nullNode();d=this.m_hashTable.getNextInBucket(d)){const g=this.m_hashTable.getElement(d);a===g||-1!==b&&this.m_shape.getUserIndex(g,this.m_hashValues)!==b||(this.m_shape.queryXY(g,f),Ig(c.x,c.y,f.x,f.y,this.m_sqrTolerance)&&e.push(d))}}mergeClusters(a,b,c){let d=this.m_shape.getUserIndex(a,this.m_newClusters);
const e=this.m_shape.getUserIndex(b,this.m_newClusters);-1===d&&(d=this.m_clusters.createList(),this.m_clusters.addElement(d,a),this.m_shape.setUserIndex(a,this.m_newClusters,d));-1===e?this.m_clusters.addElement(d,b):this.m_clusters.concatenateLists(d,e);this.m_shape.setUserIndex(b,this.m_newClusters,U.impossibleIndex2());b=this.mergeVertices(a,b);c&&(c=this.m_hashFunction.calculateHashFromVertex(a),this.m_shape.setUserIndex(a,this.m_hashValues,c));return b}mergeVertices(a,b){var c=l.Point2D.getNAN();
this.m_shape.queryXY(a,c);const d=l.Point2D.getNAN();this.m_shape.queryXY(b,d);var e=this.m_shape.getRank(a);const f=this.m_shape.getRank(b),g=this.m_shape.getWeight(a),h=this.m_shape.getWeight(b);let k,m,n,q=!1;e===f?(k=g+h,m=c.x,c.x!==d.x&&(m=(c.x*g+d.x*h)/k,q=!0),n=c.y,c.y!==d.y&&(n=(c.y*g+d.y*h)/k,q=!0)):(e>f?(m=c.x,n=c.y,k=g):(m=d.x,n=d.y,k=h,e=f),q=!c.equals(d));q&&(this.m_shape.setXYMonotonic(a,m,n),this.m_bTrackChanges&&this.m_shape.setGeometryModifiedWithVertex(a,!0),this.m_bHasSegmentParentage&&
(c=this.m_shape.getSegmentParentageBreakVertex(a)||this.m_shape.getSegmentParentageBreakVertex(b),this.m_shape.setSegmentParentageBreakVertex(a,c),this.m_shape.setSegmentParentageBreakVertex(b,c)));this.m_shape.setWeight(a,k);this.m_shape.setRank(a,e);return q}clusterReciprocal(){p.geometryReleaseAssert(0);return!1}needsClustering(){const a={stack:[],error:void 0,hasError:!1};try{Ka.__addDisposableResource(a,l.makeScopedCall(()=>{this.m_hashFunction=this.m_hashTable=null;this.m_shape.removeUserIndex(this.m_hashValues);
this.m_shape.removeUserIndex(this.m_newClusters)}),!1);var b=this.m_shape.getSelectedCount(),c=this.m_shape.getEnvelope2D(this.m_progressTracker);this.m_origin.assign(c.getLowerLeft());var d=Math.max(c.height(),c.width())/(l.intMax()-1);this.m_cellSize<d&&(this.m_cellSize=d,this.m_invCellSize=1/this.m_cellSize);this.m_clusters.clear();this.m_clusters.reserveLists(this.m_shape.getSelectedCount()/3+1);this.m_clusters.reserveNodes(this.m_shape.getSelectedCount()/3+1);this.m_hashValues=this.m_shape.createUserIndex();
this.m_newClusters=this.m_shape.createUserIndex();this.m_hashFunction=new Kl(this.m_shape,this.m_origin,this.m_sqrTolerance,this.m_invCellSize,this.m_hashValues);this.m_hashTable=new xe(4*b/3,this.m_hashFunction);this.m_hashTable.reserveElements(this.m_shape.getSelectedCount());b=!1;for(c=0;2>c;c++){d=[];const e=this.m_shape.queryVertexIteratorOnSelection(this.m_geometry);for(let f=e.next();-1!==f;f=e.next()){this.progress_();if(0<c&&this.m_shape.getUserIndex(f,this.m_newClusters)===U.impossibleIndex2())continue;
let g;0===c?(g=this.m_hashFunction.calculateHashFromVertex(f),this.m_shape.setUserIndex(f,this.m_hashValues,g)):g=this.m_shape.getUserIndex(f,this.m_hashValues);this.collectClusterCandidates(f,d);if(0!==d.length){for(let h=0,k=d.length;h<k;h++){this.progress_();const m=d[h],n=this.m_hashTable.getElement(m);this.m_hashTable.deleteNode(m);if(!this.m_shape.isEqualXY(f,n))return this.m_nsr=new va(5,this.m_shape.getVertexIndex(f),this.m_shape.getVertexIndex(n)),b=!0;this.mergeClusters(f,n,!1)}d.length=
0}0===c&&this.m_hashTable.addElement(f,g)}}return b}catch(e){a.error=e,a.hasError=!0}finally{Ka.__disposeResources(a)}}clusterNonReciprocal(){var a=this.m_shape.getSelectedCount(),b=this.m_shape.getEnvelope2D(this.m_progressTracker);this.m_origin=b.getLowerLeft();b=Math.max(b.height(),b.width())/(l.intMax()-1);this.m_cellSize<b&&(this.m_cellSize=b,this.m_invCellSize=1/this.m_cellSize);this.m_clusters.clear();this.m_clusters.reserveLists(Math.trunc(this.m_shape.getSelectedCount()/3+1));this.m_clusters.reserveNodes(Math.trunc(this.m_shape.getSelectedCount()/
3+1));this.m_hashValues=this.m_shape.createUserIndex();this.m_newClusters=this.m_shape.createUserIndex();this.m_hashFunction=new Kl(this.m_shape,this.m_origin,this.m_sqrTolerance,this.m_invCellSize,this.m_hashValues);this.m_hashTable=new xe(Math.trunc(4*a/3),this.m_hashFunction);this.m_hashTable.reserveElements(this.m_shape.getSelectedCount());a=!1;b=this.m_shape.queryVertexIteratorOnSelection(this.m_geometry);for(var c=b.next();-1!==c;c=b.next()){this.progress_();var d=this.m_hashFunction.calculateHashFromVertex(c);
this.m_shape.setUserIndex(c,this.m_hashValues,d);this.m_hashTable.addElement(c,d)}b=[];c=this.m_shape.queryVertexIteratorOnSelection(this.m_geometry);for(d=c.next();-1!==d;d=c.next()){if(this.m_shape.getUserIndex(d,this.m_newClusters)===U.impossibleIndex2())continue;let e=this.m_shape.getUserIndex(d,this.m_hashValues);this.m_hashTable.deleteElement(d,e);let f=!1;for(;;){this.collectClusterCandidates(d,b);if(0===b.length)break;let g=0;for(let h=0,k=b.length;h<k;h++){this.progress_();const m=b[h],n=
this.m_hashTable.getElement(m);this.m_hashTable.deleteNode(m);g|=this.mergeClusters(d,n,h+1===k)?1:0}f||=0!==g;a||=0!==g;b.length=0;if(!g)break}f&&(e=this.m_shape.getUserIndex(d,this.m_hashValues));this.m_hashTable.addElement(d,e)}b.length=0;a&&this.applyClusterPositions_();this.m_hashFunction=this.m_hashTable=null;this.m_shape.removeUserIndex(this.m_hashValues);this.m_shape.removeUserIndex(this.m_newClusters);return a}applyClusterPositions_(){const a=l.Point2D.getNAN();for(let b=this.m_clusters.getFirstList();b!==
wa.st_nullNode();b=this.m_clusters.getNextList(b)){let c=this.m_clusters.getFirst(b);const d=this.m_clusters.getElement(c);this.m_shape.queryXY(d,a);const e=this.m_shape.getRank(d),f=this.m_shape.getWeight(d);for(c=this.m_clusters.getNext(c);c!==wa.st_nullNode();c=this.m_clusters.getNext(c)){const g=this.m_clusters.getElement(c);this.m_bTrackChanges?this.m_shape.isEqualXYPoint2D(g,a)||(this.m_shape.setXYMonotonicPoint2D(g,a),this.m_shape.setGeometryModifiedWithVertex(g,!0)):this.m_shape.setXYMonotonicPoint2D(g,
a);if(this.m_bHasSegmentParentage){const h=this.m_shape.getSegmentParentageBreakVertex(d)||this.m_shape.getSegmentParentageBreakVertex(g);this.m_shape.setSegmentParentageBreakVertex(d,h);this.m_shape.setSegmentParentageBreakVertex(g,h)}this.m_shape.setWeight(g,f);this.m_shape.setRank(g,e)}}}}class Ab{constructor(){this.m_inputParts=[];this.m_resultParts1=[];this.m_resultParts2=[];this.m_resultSegments=[];this.m_freeSegments=[];this.m_inputSegments=[];this.m_param1=[];this.m_param2=[];this.m_toleranceZ=
this.m_tolerance=0;this.m_point=new Y;this.m_pointWeight=1;this.m_pointRank=this.m_maxDensifyLimit=0;this.m_adaptiveDensify=this.m_changed2=this.m_changed1=!1}clear(){this.freeAllResultSegments();this.m_inputSegments.length=0;this.m_inputParts.length=0;this.m_resultParts1.length=0;this.m_resultParts2.length=0;this.m_param1.length=0;this.m_param2.length=0;this.m_changed2=this.m_changed1=this.m_adaptiveDensify=!1}newIntersectionPart_(a,b,c,d,e,f,g,h,k,m){return{segmentIndex:a,weightStart:b,rankStart:c,
weightEnd:d,rankEnd:e,weightInterior:f,rankInterior:g,segmentParentage:m,u:{bBigMoveStart:!1,bBigMoveEnd:!1,bBreakStart:h,bBreakEnd:k}}}pushSegment(a,b,c,d,e,f,g,h,k,m){this.m_inputParts.push(this.newIntersectionPart_(this.m_inputSegments.length,b,c,d,e,f,g,h,k,m));this.m_inputSegments.push(a);return this.m_inputParts.length-1}getResultSegmentCount(a){return this.m_adaptiveDensify?0===a?this.m_param1.length-1:this.m_param2.length-1:0===a?this.m_resultParts1.length:this.m_resultParts2.length}getResultPart_(a,
b){return 0===a?this.m_resultParts1[b]:this.m_resultParts2[b]}getResultSegment(a,b){return this.m_resultSegments[this.getResultPart_(a,b).segmentIndex].get()}getSegmentChanged(a){return 0===a?this.m_changed1:this.m_changed2}getResultSegmentStartPointWeight(a,b){return this.getResultPart_(a,b).weightStart}getResultSegmentStartPointRank(a,b){return this.getResultPart_(a,b).rankStart}getResultSegmentSegmentParentage(a,b){return this.getResultPart_(a,b).segmentParentage}getResultSegmentStartPointIsBreak(a,
b){return this.getResultPart_(a,b).u.bBreakStart}getResultSegmentEndPointWeight(a,b){return this.getResultPart_(a,b).weightEnd}getResultSegmentEndPointRank(a,b){return this.getResultPart_(a,b).rankEnd}getResultSegmentEndPointIsBreak(a,b){return this.getResultPart_(a,b).u.bBreakEnd}getResultSegmentInteriorRank(a,b){return this.getResultPart_(a,b).rankInterior}getResultSegmentInteriorWeight(a,b){return this.getResultPart_(a,b).weightInterior}getResultPoint(){return this.m_point}getResultPointWeight(){return this.m_pointWeight}getResultPointRank(){return this.m_pointRank}getResultPointChanged(){return this.m_changed2}intersectLines(a,
b){2!==this.m_inputSegments.length&&p.throwInternalErrorException("");this.m_changed2=this.m_changed1=!1;this.m_tolerance=a;var c=l.sqr(a*Ab.c_smallToleranceFactor);let d=!1;var e=this.m_inputParts[0];const f=this.m_inputParts[1];var g=this.m_inputSegments[e.segmentIndex];const h=this.m_inputSegments[f.segmentIndex];if(b||0!==(Hc(!0,!1,g,h,a,!0)&5)){b=Zc(!0,g,h,null,this.m_param1,this.m_param2,a);0===b&&p.throwInternalErrorException("");const G=Array(b);for(var k=0;k<b;++k)G[k]=l.Point2D.getNAN();
k=new Float64Array(b);const I=new Int32Array(b);var m=Array(b);const H=Array(b);for(var n=0;n<b;++n)m[n]=Xe(),H[n]=Xe();for(n=0;n<b;n++){var q=this.m_param1[n],r=this.m_param2[n],t=e.rankInterior,u=e.weightInterior,v=void 0;0===q?(t=e.rankStart,u=e.weightStart,v=e.u.bBreakStart):1===q?(t=e.rankEnd,u=e.weightEnd,v=e.u.bBreakEnd):(this.m_changed1=!0,v=!1);var w=f.rankInterior,x=f.weightInterior,y=void 0;0===r?(w=f.rankStart,x=f.weightStart,y=f.u.bBreakStart):1===r?(w=f.rankEnd,x=f.weightEnd,y=f.u.bBreakEnd):
(this.m_changed2=!0,y=!1);var z=t,A=w,C=1,B=0,E=l.Point2D.getNAN();z===A?(q=g.getCoord2D(q),r=h.getCoord2D(r),C=u+x,u=x/C,B=t,l.lerpPoint2D(q,r,u,E),t=l.Point2D.sqrDistance(E,q),u=l.Point2D.sqrDistance(E,r),m[n].bBigMove=t>c,H[n].bBigMove=u>c,this.m_changed1||q.equals(E)||(this.m_changed1=!0),this.m_changed2||r.equals(E)||(this.m_changed2=!0)):z>A?(E=g.getCoord2D(q),x=h.getCoord2D(r),C=u,B=t,t=l.Point2D.sqrDistance(E,x),m[n].bBigMove=!1,H[n].bBigMove=t>c,this.m_changed2||x.equals(E)||(this.m_changed2=
!0)):(E=h.getCoord2D(r),C=x,B=w,t=g.getCoord2D(q),u=l.Point2D.sqrDistance(E,t),m[n].bBigMove=u>c,H[n].bBigMove=!1,this.m_changed1||t.equals(E)||(this.m_changed1=!0));G[n].assign(E);k[n]=C;I[n]=B;m[n].bIsBreak=v||y;H[n].bIsBreak=v||y;d||=m[n].bBigMove||H[n].bBigMove}n=e.rankInterior;v=e.weightInterior;t=0;c=-1;for(y=0;y<=b;y++)if(C=y<b?this.m_param1[y]:1,C!==t){B=this.allocResultSegment();E=this.m_resultSegments[B];g.queryCut(t,C,E,!1);E.get().snapControlPoints(a*a);let L;z=w=q=u=t=!1;A=l.Point2D.getNAN();
let M=l.Point2D.getNAN();-1!==c?(r=I[c],x=k[c],t=m[c].bBigMove,A.assign(G[c]),q=m[c].bIsBreak,z=!0):(x=e.weightStart,r=e.rankStart,A=E.get().getStartXY(),q=e.u.bBreakStart);y<b?(L=I[y],c=k[y],u=m[y].bBigMove,M.assign(G[y]),w=m[y].bIsBreak,z=!0):(c=e.weightEnd,L=e.rankEnd,M=E.get().getEndXY(),w=e.u.bBreakEnd);z&&E.get().setCoordsForIntersector(A,M,!0);this.m_resultParts1.push(this.newIntersectionPart_(B,x,r,c,L,v,n,q,w,e.segmentParentage));c=this.m_resultParts1.at(-1);c.u.bBigMoveStart=t;c.u.bBigMoveEnd=
u;t=C;c=y}else-1===c&&(c=y);e=Array(b);for(g=0;g<b;g++)e[g]=g;2<b?(e.sort((L,M)=>this.m_param2[L]<this.m_param2[M]?-1:this.m_param2[L]>this.m_param2[M]?1:0),l.numericSort(this.m_param2)):2===b&&this.m_param2[0]>this.m_param2[1]&&(this.m_param2[1]=l.swap(this.m_param2[0],this.m_param2[0]=this.m_param2[1]),e[1]=l.swap(e[0],e[0]=e[1]));g=f.rankInterior;m=f.weightInterior;t=0;c=-1;for(n=0;n<=b;n++)v=n<b?this.m_param2[n]:1,v!==t?(y=this.allocResultSegment(),C=this.m_resultSegments[y],h.queryCut(t,v,C,
!1),C.get().snapControlPoints(a*a),t=l.Point2D.getNAN(),u=l.Point2D.getNAN(),A=E=B=z=r=!1,-1!==c?(r=e[c],c=k[r],x=I[r],t.assign(G[r]),B=H[r].bBigMove,r=H[r].bIsBreak,A=!0):(c=f.weightStart,x=f.rankStart,t=C.get().getStartXY(),r=f.u.bBreakStart),n!==b?(z=e[n],q=k[z],w=I[z],u.assign(G[z]),E=H[z].bBigMove,z=H[z].bIsBreak,A=!0):(q=f.weightEnd,w=f.rankEnd,u=C.get().getEndXY(),z=f.u.bBreakEnd),A&&C.get().setCoordsForIntersector(t,u,!0),this.m_resultParts2.push(this.newIntersectionPart_(y,c,x,q,w,m,g,r,
z,f.segmentParentage)),c=this.m_resultParts2.at(-1),c.u.bBigMoveStart=B,c.u.bBigMoveEnd=E,t=v,c=n):-1===c&&(c=n);return d?3:2}return 0}intersectLines3D(a,b,c,d){p.geometryReleaseAssert(0);return 1}intersect2D(a,b){var c=this.m_inputParts[1];const d=this.m_inputSegments[this.m_inputParts[0].segmentIndex].getGeometryType();c=this.m_inputSegments[c.segmentIndex].getGeometryType();return d!==p.GeometryType.enumLine||c!==p.GeometryType.enumLine?(new Fn(this)).intersectCurves(a,b):this.intersectLines(a,
b)}intersect2DEx(a,b,c,d,e){this.m_point.assignCopy(b);1!==this.m_inputSegments.length&&p.throwInternalErrorException("");this.m_tolerance=a;this.m_changed2=this.m_changed1=!1;var f=l.sqr(a*Ab.c_smallToleranceFactor),g=!1;const h=this.m_inputParts[0],k=this.m_inputSegments[h.segmentIndex];if(e||k.isIntersectingPoint(b.getXY(),a,!0)){this.m_param1=l.makePrimitiveArray(16,Number.NaN);var m=k.getClosestCoordinate(b.getXY(),!1);this.m_param1[0]=m;var n=h.rankInterior,q=h.weightInterior;0===m?(n=h.rankStart,
q=h.weightStart):1===m?(n=h.rankEnd,q=h.weightEnd):this.m_changed1=!0;var r=n;r===c&&k.isCurve()&&(r=c+1);e=1;let t=0;const u=new l.Point2D;r===c?(g=k.getCoord2D(m),b=b.getXY(),e=q+d,t=n,l.lerpPoint2D(g,b,d/e,u),this.m_changed1||g.equals(u)||(this.m_changed1=!0),this.m_changed2||b.equals(u)||(this.m_changed2=!0),g=l.Point2D.sqrDistance(u,g)>f):r>c?(u.assign(k.getCoord2D(m)),e=q,t=n,this.m_changed2||u.equals(b.getXY())||(this.m_changed2=!0)):(u.assign(k.getCoord2D(m)),e=d,t=c,this.m_changed1||u.equals(b.getXY())||
(this.m_changed1=!0),g=l.Point2D.sqrDistance(u,b.getXY())>f);d=0;f=-1;for(b=0;1>=b;b++){n=1>b?this.m_param1[0]:1;if(n!==d){q=this.allocResultSegment();c=this.m_resultSegments[q];k.queryCut(d,n,c);c.get().snapControlPoints(a*a);m=h.weightStart;r=h.weightEnd;let v=h.rankStart,w=h.rankEnd;const x=h.rankInterior,y=h.weightInterior;let z=h.u.bBreakStart,A=h.u.bBreakEnd;-1!==f&&(m=e,v=t,z=!0,c.get().setCoordsForIntersector(u,c.get().getEndXY(),!0));1!==b&&(r=e,w=t,A=!0,c.get().setCoordsForIntersector(c.get().getStartXY(),
u,!0));d=n;this.m_resultParts1.push(this.newIntersectionPart_(q,m,v,r,w,y,x,z,A,h.segmentParentage))}f=b}this.m_point.setXY(u);this.m_pointWeight=e;this.m_pointRank=t;return g?3:2}return 0}intersect_3D(a,b,c,d){p.geometryReleaseAssert(0);return 1}intersect3DEx(a,b,c,d,e,f,g){p.geometryReleaseAssert(0);return 1}getTolerance(){return this.m_tolerance}getToleranceZ(){p.geometryReleaseAssert(0);return 0}freeAllResultSegments(){this.m_resultSegments.length=0;this.m_freeSegments.length=0}freeResultSegment(a){this.m_freeSegments.push(a)}allocResultSegment(){if(this.m_freeSegments.length)return this.m_freeSegments.pop();
const a=new W,b=this.m_resultSegments.length;this.m_resultSegments.push(a);return b}allocResultSegmentFromBuffer(a){if(this.m_freeSegments.length)return this.m_freeSegments.pop();a=new W({copy:a});const b=this.m_resultSegments.length;this.m_resultSegments.push(a);return b}allocResultSegmentFromSegment(a){if(this.m_freeSegments.length)return this.m_freeSegments.pop();a=new W({segment:a});const b=this.m_resultSegments.length;this.m_resultSegments.push(a);return b}}Ab.maxWeight=.1*Number.MAX_VALUE;Ab.c_smallToleranceFactor=
.01;Ab.c_maxGeometryTypeToRankDelta=8;let Ll=class{constructor(){this.equalEdge=this.end=this.start=null;this.segmentParentage=this.segmentIndex=-1;this.rank=this.weight=0}hasSegment(){return 0<=this.segmentIndex}transferAttributes(a,b,c){if(1!==b.getDescription().getAttributeCount()){var d=a.parent.m_resultSegments[this.segmentIndex].get().getStartXY(),e=a.parent.m_resultSegments[this.segmentIndex].get().getEndXY(),f=new Y;b.queryStart(f);c?(f.setXY(d),a.parent.m_resultSegments[this.segmentIndex].get().setStart(f)):
(f.setXY(e),a.parent.m_resultSegments[this.segmentIndex].get().setEnd(f));b.queryEnd(f);c?(f.setXY(e),a.parent.m_resultSegments[this.segmentIndex].get().setEnd(f)):(f.setXY(d),a.parent.m_resultSegments[this.segmentIndex].get().setStart(f))}}copyFromWhenOverlap(a,b,c){this.equalEdge=b;b.equalEdge=this;this.segmentIndex=a.parent.allocResultSegmentFromBuffer(a.parent.m_resultSegments[b.segmentIndex]);this.segmentParentage=b.segmentParentage;this.weight=b.weight;this.rank=b.rank;c?(this.start.copyFrom(b.start),
this.end.copyFrom(b.end)):(this.start.copyFrom(b.end),this.end.copyFrom(b.start),a.parent.m_resultSegments[this.segmentIndex].get().reverse())}getEnd(){p.geometryReleaseAssert(0);return{}}getNextInChain(){return this.end.nextInChain}getPrevInChain(){return this.start.prevInChain}};class Ml{constructor(){this.hash=0;this.pt=new l.Point2D;this.nextEqual=this.prevEqual=this.nextInHash=this.prevInHash=this.nextInChain=this.prevInChain=null;this.rank=this.weight=0;this.bIsBreak=this.bBigMove=!1}copyFrom(a){this.pt.assign(a.pt);
this.weight=a.weight;this.rank=a.rank;this.bBigMove=a.bBigMove;this.bIsBreak=a.bIsBreak}nextNode(){p.geometryReleaseAssert(0);return{}}prevNode(){p.geometryReleaseAssert(0);return{}}equalListHead(){let a=this;for(;null!==a.prevEqual;a=a.prevEqual);return a}}class Fn{constructor(a){this.m_pairs=[];this.m_chainOrigin2=this.m_chainOrigin1=null;this.m_newNodes=[];this.m_hashTableOfEquals=[];this.m_hashTableOfEqualsSize=0;this.m_origin=new l.Point2D;this.m_cell=new l.Point2D;this.parent=a}addSegment(a,
b,c,d,e,f,g,h,k,m,n){b=this.newNode(this.parent.m_resultSegments[a].get().getStartXY(),c,d,k);e=this.newNode(this.parent.m_resultSegments[a].get().getEndXY(),e,f,m);this.newEdge(b,e,a,g,h,n);null===this.m_chainOrigin1?this.m_chainOrigin1=b:null===this.m_chainOrigin2?this.m_chainOrigin2=b:p.geometryReleaseAssert(0)}intersectCurvesHelper(a,b,c,d,e){const f=this.getSegment(a).get(),g=this.getSegment(b).get();if(f.isDegenerate(0)||g.isDegenerate(0))return 0;const h=this.tryOverlapIntersectCurves(a,b,
c,d);if(0!==h)return h;const k=l.sqr(.01*c);let m=!1,n=this.processSharpCorners(f,g,c,4<e);const q=0<n;if(!q){if(!d&&0===(Hc(!0,!1,f,g,c,!0)&5))return 0;n=Zc(!0,f,g,null,this.parent.m_param1,this.parent.m_param2,c)}0===n&&p.throwInternalErrorException("");const r=f.getGeometryType(),t=g.getGeometryType(),u=l.makeObjectArray(l.Point2D,n),v=l.makeObjectArray(l.Point2D,n),w=Array(n),x=Array(n),y=Array(n),z=Array(n),A=l.makeStructArray(Xe,n),C=l.makeStructArray(Xe,n);let B=!1,E=!1;for(let J=0;J<n;J++){const V=
this.parent.m_param1[J],ha=this.parent.m_param2[J];let ea=a.rank,da=a.weight,Ga=!0,ta=!1;0===V?(ea=a.start.rank,da=a.start.weight,ta=a.start.bIsBreak):1===V?(ea=a.end.rank,da=a.end.weight,ta=a.end.bIsBreak):(B=!0,Ga=!1);let Da=b.rank,qa=b.weight,Ca=!1,$a=!0;0===ha?(Da=b.start.rank,qa=b.start.weight,Ca=b.start.bIsBreak):1===ha?(Da=b.end.rank,qa=b.end.weight,Ca=b.end.bIsBreak):(E=!0,$a=!1);let ya=ea,Pa=Da;ya===Pa&&(ya*=Ab.c_maxGeometryTypeToRankDelta,Pa*=Ab.c_maxGeometryTypeToRankDelta,ya+=ud(r,f,!1),
Pa+=ud(t,g,!1));if(Ga&&$a&&Pa===ya){const oa=f.getCoord2D(V),Ba=g.getCoord2D(ha);oa.equals(Ba)&&(Pa=ya-1)}let La=1,aa=0,ca=1,na=0;const la=new l.Point2D,fa=new l.Point2D,T=f.getCoord2D(V),xa=g.getCoord2D(ha);if(q&&l.Point2D.distance(T,xa)>c)la.setCoordsPoint2D(T),fa.setCoordsPoint2D(xa),La=da,ca=qa,aa=ea,na=Da,A[J].bBigMove=!1,C[J].bBigMove=!1,Ca=ta=!0;else if(ya===Pa){ca=La=da+qa;na=aa=ea;l.lerpPoint2D(T,xa,qa/La,la);fa.setCoordsPoint2D(la);const oa=l.Point2D.sqrDistance(la,T),Ba=l.Point2D.sqrDistance(la,
xa);A[J].bBigMove=oa>k;C[J].bBigMove=Ba>k;B||T.equals(la)||(B=!0);E||xa.equals(fa)||(E=!0)}else if(ya>Pa){la.setCoordsPoint2D(T);fa.setCoordsPoint2D(la);ca=La=da;na=aa=ea;const oa=l.Point2D.sqrDistance(la,xa);A[J].bBigMove=!1;C[J].bBigMove=oa>k;E||xa.equals(fa)||(E=!0)}else{fa.setCoordsPoint2D(xa);la.setCoordsPoint2D(fa);ca=La=qa;na=aa=Da;const oa=l.Point2D.sqrDistance(la,T);A[J].bBigMove=oa>k;C[J].bBigMove=!1;B||T.equals(la)||(B=!0)}u[J].assign(la);v[J].assign(fa);w[J]=La;x[J]=ca;y[J]=aa;z[J]=na;
A[J].bIsBreak=ta||Ca;C[J].bIsBreak=ta||Ca;m||=A[J].bBigMove||C[J].bBigMove;if(0<J&&(V===this.parent.m_param1[J-1]||ha===this.parent.m_param2[J-1]))if(y[J]<=y[J-1]){u[J].assign(v[J-1]);w[J]=x[J-1];y[J]=z[J-1];v[J].assign(v[J-1]);x[J]=x[J-1];z[J]=z[J-1];let oa;(oa=A[J]).bBigMove||(oa.bBigMove=A[J-1].bBigMove);let Ba;(Ba=C[J]).bBigMove||(Ba.bBigMove=C[J-1].bBigMove);let Lb;(Lb=A[J]).bIsBreak||(Lb.bIsBreak=A[J-1].bIsBreak);let eb;(eb=C[J]).bIsBreak||(eb.bIsBreak=C[J-1].bIsBreak)}else{u[J-1].assign(u[J]);
w[J-1]=w[J];y[J-1]=y[J];v[J-1].assign(v[J]);x[J-1]=x[J];z[J-1]=z[J];let oa;(oa=A[J-1]).bBigMove||(oa.bBigMove=A[J].bBigMove);let Ba;(Ba=C[J-1]).bBigMove||(Ba.bBigMove=C[J].bBigMove);let Lb;(Lb=A[J-1]).bIsBreak||(Lb.bIsBreak=A[J].bIsBreak);let eb;(eb=C[J-1]).bIsBreak||(eb.bIsBreak=C[J].bIsBreak)}}if(!B&&!E&&2===n){if(r!==p.GeometryType.enumLine||t!==p.GeometryType.enumLine){if(this.processDoublyConnectedEdges(a,b,e+1,c))return this.parent.m_changed1=!0,this.parent.m_changed2=!0,2;p.geometryReleaseAssert(0)}p.geometryReleaseAssert(0)}let G;
(G=this.parent).m_changed1||(G.m_changed1=B);let I;(I=this.parent).m_changed2||(I.m_changed2=E);let H=a,L=a.end.weight,M=a.end.rank,N=a.end.bBigMove,Q=a.end.bIsBreak,O=0,P=-1;for(let J=0;J<=n;J++){const V=J<n?this.parent.m_param1[J]:1;if(V!==O){const ha=this.parent.allocResultSegment(),ea=this.parent.m_resultSegments[ha];f.queryCut(O,V,ea,!1);ea.get().snapControlPoints(c*c);let da,Ga,ta,Da,qa=!1,Ca=!1,$a=!1,ya=!1;const Pa=new l.Point2D,La=new l.Point2D;-1!==P?(Ga=y[P],da=w[P],$a=A[P].bBigMove,qa=
A[P].bIsBreak,Pa.assign(u[P])):(da=a.start.weight,Ga=a.start.rank,$a=a.start.bBigMove,qa=a.start.bIsBreak,Pa.assign(ea.get().getStartXY()));J<n?(Da=y[J],ta=w[J],ya=A[J].bBigMove,Ca=A[J].bIsBreak,La.assign(u[J])):(ta=L,Da=M,ya=N,Ca=Q,La.assign(ea.get().getEndXY()));let aa=H;1>V&&(this.splitEdgeInPlace(H),aa=H.getNextInChain());this.updateSegmentOnly(H,ha);0===H.start.hash||H.start.pt.equals(Pa)||(this.m_newNodes.push(H.start),this.removeNodeFromHash(H.start),H.start.hash=0);0===H.end.hash||H.end.pt.equals(La)||
(this.m_newNodes.push(H.end),this.removeNodeFromHash(H.end),H.end.hash=0);H.start.pt.assign(Pa);H.end.pt.assign(La);let ca;(ca=H.start).bBigMove||(ca.bBigMove=$a);let na;(na=H.end).bBigMove||(na.bBigMove=ya);let la;(la=H.start).bIsBreak||(la.bIsBreak=qa);let fa;(fa=H.end).bIsBreak||(fa.bIsBreak=Ca);H.start.weight=da;H.start.rank=Ga;H.end.weight=ta;H.end.rank=Da;H=aa;O=V;P=J}else-1===P&&(P=J)}const ia=H.getNextInChain(),ka=[];ka.length=n;for(let J=0;J<n;J++)ka[J]=J;2<n?(ka.sort((J,V)=>l.standardNumericCompare(this.parent.m_param2[J],
this.parent.m_param2[V])),this.parent.m_param2.sort(l.standardNumericCompare)):2===n&&this.parent.m_param2[0]>this.parent.m_param2[1]&&(this.parent.m_param2[1]=l.swap(this.parent.m_param2[0],this.parent.m_param2[0]=this.parent.m_param2[1]),ka[1]=l.swap(ka[0],ka[0]=ka[1]));H=b;L=b.end.weight;M=b.end.rank;N=b.end.bBigMove;Q=b.end.bIsBreak;O=0;P=-1;for(let J=0;J<=n;J++){const V=J<n?this.parent.m_param2[J]:1;if(V!==O){const ha=this.parent.allocResultSegment(),ea=this.parent.m_resultSegments[ha];g.queryCut(O,
V,ea,!1);ea.get().snapControlPoints(c*c);let da,Ga,ta,Da;const qa=new l.Point2D,Ca=new l.Point2D;let $a=!1,ya=!1,Pa=!1,La=!1;if(-1!==P){const T=ka[P];da=x[T];Ga=z[T];qa.assign(v[T]);Pa=C[T].bBigMove;$a=C[T].bIsBreak}else da=b.start.weight,Ga=b.start.rank,Pa=b.start.bBigMove,$a=b.start.bIsBreak,qa.assign(ea.get().getStartXY());if(J!==n){const T=ka[J];ta=x[T];Da=z[T];Ca.assign(v[T]);La=C[T].bBigMove;ya=C[T].bIsBreak}else ta=L,Da=M,La=N,ya=Q,Ca.assign(ea.get().getEndXY());let aa=H;1>V&&(this.splitEdgeInPlace(H),
aa=H.getNextInChain());this.updateSegmentOnly(H,ha);0===H.start.hash||H.start.pt.equals(qa)||(this.m_newNodes.push(H.start),this.removeNodeFromHash(H.start),H.start.hash=0);0===H.end.hash||H.end.pt.equals(Ca)||(this.m_newNodes.push(H.end),this.removeNodeFromHash(H.end),H.end.hash=0);H.start.pt.assign(qa);H.end.pt.assign(Ca);let ca;(ca=H.start).bBigMove||(ca.bBigMove=Pa);let na;(na=H.end).bBigMove||(na.bBigMove=La);let la;(la=H.start).bIsBreak||(la.bIsBreak=$a);let fa;(fa=H.end).bIsBreak||(fa.bIsBreak=
ya);H.start.weight=da;H.start.rank=Ga;H.end.weight=ta;H.end.rank=Da;H=aa;O=V;P=J}else-1===P&&(P=J)}const Aa=H.getNextInChain();this.postProcessResultPartsForCurves(a,ia,b,Aa,e+1);return m?3:2}intersectCurves(a,b){2!==this.parent.m_inputSegments.length&&p.throwInternalErrorException("");this.parent.m_changed1=!1;this.parent.m_changed2=!1;this.parent.m_tolerance=a;this.m_hashTableOfEqualsSize=0;this.m_hashTableOfEquals=l.makeNullArray(16);var c=D.constructEmpty();for(var d=0;2>d;d++){const f=this.parent.allocResultSegmentFromSegment(this.parent.m_inputSegments[this.parent.m_inputParts[d].segmentIndex]);
var e=D.constructEmpty();this.parent.m_inputSegments[this.parent.m_inputParts[d].segmentIndex].queryLooseEnvelope(e);c.mergeEnvelope2D(e);e=this.parent.m_inputParts[d];this.addSegment(f,0,e.weightStart,e.rankStart,e.weightEnd,e.rankEnd,e.weightInterior,e.rankInterior,e.u.bBreakStart,e.u.bBreakEnd,e.segmentParentage)}c.inflateCoords(100*a,100*a);this.m_origin.assign(c.getLowerLeft());this.m_cell.setCoords(2*a,2*a);this.m_pairs.push(Fc(this.m_chainOrigin1.nextInChain,this.m_chainOrigin2.nextInChain,
0,b));b=0;for(c=!0;this.m_pairs.length;)d=this.m_pairs.at(-1),this.m_pairs.pop(),p.geometryReleaseAssert(0<=d.recursion),p.geometryReleaseAssert(256>=d.recursion),this.clusterNodes(a),d=this.intersectCurvesHelper(d.edge1,d.edge2,a,d.bIsIntersecting,d.recursion),c&&(c=!1,b=d);for(a=0;2>a;a++)for(c=0===a?this.parent.m_resultParts1:this.parent.m_resultParts2,d=0===a?this.m_chainOrigin1:this.m_chainOrigin2,d=d.nextInChain;null!=d;d=d.getNextInChain())c.push(this.parent.newIntersectionPart_(d.segmentIndex,
d.start.weight,d.start.rank,d.end.weight,d.end.rank,d.weight,d.rank,d.start.bIsBreak,d.end.bIsBreak,d.segmentParentage)),c.at(-1).u.bBigMoveStart=d.start.bBigMove,c.at(-1).u.bBigMoveEnd=d.end.bBigMove;return b}tryOverlapIntersectCurves(a,b,c,d){d=this.parent.m_resultSegments[a.segmentIndex].get();const e=this.parent.m_resultSegments[b.segmentIndex].get(),f=d.getStartXY().equals(e.getStartXY())&&d.getEndXY().equals(e.getEndXY());var g=d.getStartXY().equals(e.getEndXY())&&d.getEndXY().equals(e.getStartXY());
if(!f&&!g)return 0;var h=sc(d,e,!0);if(0!==h&&kl(d,e)&&a.segmentParentage===b.segmentParentage&&(g=!1,0<h?g=d.equals(e):(p.geometryReleaseAssert(-1===h),g=new W({segment:e}),g.get().reverse(),g=d.equals(g.get())),g))return 1;var k=c*Ab.c_smallToleranceFactor;g=!1;if(0===h){h=[.5,.25,.75,.125,.375,.625,.875,.5625,.3125];for(let r=0,t=h.length;r<t;++r){var m=h[r],n=new l.Point2D;d.queryCoord2D(m,n);m=e.getClosestCoordinate(n,!1);var q=new l.Point2D;e.queryCoord2D(m,q);n=l.Point2D.distance(n,q);if(n>
c)return 0;g||=n>k}for(let r=0,t=h.length;r<t;++r){m=h[r];n=new l.Point2D;e.queryCoord2D(m,n);m=d.getClosestCoordinate(n,!1);q=new l.Point2D;d.queryCoord2D(m,q);n=l.Point2D.distance(n,q);if(n>c)return 0;g||=n>k}}c=a.rank;k=b.rank;c===k&&(c*=Ab.c_maxGeometryTypeToRankDelta,k*=Ab.c_maxGeometryTypeToRankDelta,c+=ud(d.getGeometryType(),d,!0),k+=ud(e.getGeometryType(),e,!0));c>k?(b.copyFromWhenOverlap(this,a,f),b.transferAttributes(this,d,f)):k>c?(a.copyFromWhenOverlap(this,b,f),a.transferAttributes(this,
e,f)):a.segmentParentage<=b.segmentParentage?(a.weight+=b.weight,b.copyFromWhenOverlap(this,a,f),b.transferAttributes(this,d,f)):(b.weight=a.weight+b.weight,a.copyFromWhenOverlap(this,b,f),a.transferAttributes(this,e,f));return g?3:2}postProcessResultPartsForCurves(a,b,c,d,e){e===l.shortMax()&&p.throwInternalErrorException("curve_helper");for(var f=a;f!==b;f=f.getNextInChain())this.updateSegmentToNodes(f);for(f=c;f!==d;f=f.getNextInChain())this.updateSegmentToNodes(f);for(f=a;f!==b;f=f.getNextInChain()){var g=
f.end.pt.sub(f.start.pt);for(let t=c;t!==d;t=t.getNextInChain()){var h=0;f.start.pt.equals(t.start.pt)&&f.end.pt.equals(t.end.pt)?h=1:f.start.pt.equals(t.end.pt)&&f.end.pt.equals(t.start.pt)&&(h=-1);if(!h){h=f.start.pt.equals(t.start.pt)?1:0;h||(h=f.end.pt.equals(t.end.pt)?2:0,h||(h=f.end.pt.equals(t.start.pt)?3:0)||(h=f.start.pt.equals(t.end.pt)?4:0));if(h){var k=t.end.pt.sub(t.start.pt);k=g.dotProduct(k);let v;switch(h){case 1:case 2:v=0<k;break;case 3:case 4:v=0>k;break;default:p.throwInternalErrorException("post_process_result_parts_for_curves_")}v&&
this.m_pairs.push(Fc(f,t,e,!1))}continue}k=this.parent.m_resultSegments[f.segmentIndex];const u=this.parent.m_resultSegments[t.segmentIndex];var m=[.5,.25,.75];for(let v=0,w=m.length;v<w;++v){var n=m[v],q=new l.Point2D;k.get().queryCoord2D(n,q);n=u.get().getClosestCoordinate(q,!1);var r=new l.Point2D;u.get().queryCoord2D(n,r);if(l.Point2D.distance(q,r)>this.parent.m_tolerance){h=0;break}}if(h){for(let v=0,w=m.length;v<w;++v)if(n=m[v],q=new l.Point2D,u.get().queryCoord2D(n,q),n=k.get().getClosestCoordinate(q,
!1),r=new l.Point2D,k.get().queryCoord2D(n,r),l.Point2D.distance(q,r)>this.parent.m_tolerance){h=0;break}if(h){f.equalEdge=t;t.equalEdge=f;g=f.rank;m=t.rank;g===m&&(g*=Ab.c_maxGeometryTypeToRankDelta,m*=Ab.c_maxGeometryTypeToRankDelta,g+=ud(k.get().getGeometryType(),k.get(),!0),m+=ud(u.get().getGeometryType(),u.get(),!0));g>m||g===m&&f.segmentParentage<=t.segmentParentage?(k.copyTo(u,!1),t.segmentParentage=f.segmentParentage,-1===h&&u.get().reverse()):(u.copyTo(k,!1),f.segmentParentage=t.segmentParentage,
-1===h&&k.get().reverse());break}else this.m_pairs.push(Fc(f,t,e,!1))}else this.m_pairs.push(Fc(f,t,e,!1))}}this.updateAttachedEdgesAfterNodeChange(a.start);b&&this.updateAttachedEdgesAfterNodeChange(b.start);this.updateAttachedEdgesAfterNodeChange(c.start);d&&this.updateAttachedEdgesAfterNodeChange(d.start)}processDoublyConnectedEdges(a,b,c,d){c===l.shortMax()&&p.throwInternalErrorException("curve_helper");var e=this.getSegment(a).get();const f=this.getSegment(b).get(),g=e.getStartXY().equals(f.getStartXY())&&
e.getEndXY().equals(f.getEndXY())?1:e.getEndXY().equals(f.getStartXY())&&e.getStartXY().equals(f.getEndXY())?-1:0;if(0!==g){const h=new W;e.queryCut(0,.5,h);h.get().snapControlPoints(d*d);const k=new W;e.queryCut(.5,1,k);k.get().snapControlPoints(d*d);this.splitEdgeInPlace(a);a.end.pt=h.get().getEndXY();a.segmentIndex=this.parent.allocResultSegmentFromBuffer(h);a.getNextInChain().segmentIndex=this.parent.allocResultSegmentFromBuffer(k);e=f.getClosestCoordinate(a.end.pt,!1);.2<Math.abs(e-.5)&&(e=.5);
f.queryCut(0,e,h);h.get().snapControlPoints(d*d);f.queryCut(e,1,k);k.get().snapControlPoints(d*d);this.splitEdgeInPlace(b);b.end.pt=h.get().getEndXY();b.segmentIndex=this.parent.allocResultSegmentFromBuffer(h);b.getNextInChain().segmentIndex=this.parent.allocResultSegmentFromBuffer(k);0<g?(this.m_pairs.push(Fc(a,b,c,!1)),this.m_pairs.push(Fc(a.getNextInChain(),b.getNextInChain(),c,!1))):(this.m_pairs.push(Fc(a,b.getNextInChain(),c,!1)),this.m_pairs.push(Fc(a.getNextInChain(),b,c,!1)));return!0}return!1}getNext(a){p.geometryReleaseAssert(0);
return{}}newNode(a,b,c,d){const e=new Ml;this.m_newNodes.push(e);e.pt=a;e.rank=c;e.weight=b;e.bIsBreak=d;return e}newEdge(a,b,c,d,e,f){const g=new Ll;g.start=a;g.end=b;a.nextInChain=g;b.prevInChain=g;g.segmentIndex=c;g.segmentParentage=f;g.rank=e;g.weight=d;return g}splitEdgeInPlace(a){a.segmentIndex=-1;const b=new Ll,c=new Ml;this.m_newNodes.push(c);c.pt.setNAN();c.nextInChain=b;c.prevInChain=a;c.prevInHash=null;c.nextInHash=null;c.prevEqual=null;c.nextEqual=null;c.weight=a.weight;c.rank=a.rank;
c.bIsBreak=!1;c.bBigMove=!1;b.start=c;b.segmentIndex=-1;b.end=a.end;b.end.prevInChain=b;b.rank=a.rank;b.weight=a.weight;b.segmentParentage=a.segmentParentage;a.end=c;a.equalEdge&&(a.equalEdge.equalEdge=null);a.equalEdge=null}updateSegmentOnly(a,b){a.segmentIndex=b}updateAttachedEdgesAfterNodeChange(a){for(a=a.equalListHead();null!==a;a=a.nextEqual)this.updateAttachedEdgesAfterNodeChangeImpl(a)}updateAttachedEdgesAfterNodeChangeImpl(a){var b=a.prevInChain;if(b&&b.hasSegment()){var c=this.getSegment(b).get();
a.pt.equals(c.getEndXY())||(c.setCoordsForIntersector(b.start.pt,b.end.pt,!1),c.ensureXYMonotone())}(b=a.nextInChain)&&b.hasSegment()&&(c=this.getSegment(b).get(),a.pt.equals(c.getStartXY())||(c.setCoordsForIntersector(b.start.pt,b.end.pt,!1),c.ensureXYMonotone()))}updateSegmentToNodes(a){const b=this.getSegment(a).get();a.start.pt.equals(b.getStartXY())&&a.end.pt.equals(b.getEndXY())||(b.setCoordsForIntersector(a.start.pt,a.end.pt,!1),b.ensureXYMonotone());this.updateAttachedEdgesAfterNodeChange(a.start);
this.updateAttachedEdgesAfterNodeChange(a.end)}getSegment(a){return this.parent.m_resultSegments[a.segmentIndex]}clusterNodes(a){var b=!1;const c=[],d=[],e=[];for(let m=0,n=this.m_newNodes.length;m<n;m++){var f=this.m_newNodes[m];if(null!==f){var g=f;for(var h=m+1;h<n;h++){var k=this.m_newNodes[h];null!==k&&f.pt.equals(k.pt)&&(g.nextInHash=k,k.prevInHash=g,g=k,this.m_newNodes[h]=null)}}}for(let m=0,n=this.m_newNodes.length;m<n;m++)if(f=this.m_newNodes[m],null!=f){for(f.hash=this.calculateHash(f.pt);;){g=
l.makeNullArray(4);h=this.hashTableBinsToCheck(f,g);for(k=0;k<h;k++)if(null!==g[k])for(let q=g[k];null!==q;){const r=q.nextInHash;l.Point2D.distance(f.pt,q.pt)<=a&&(c.push(q),this.removeNodeFromHash(q),q.hash=0,e.push(q),d.push(q));q=r}g=!1;for(const q of c)f.pt.equals(q.pt)||(b=nj(f.pt,q.pt,f.weight,f.rank,q.weight,q.rank),f.pt.assign(b.pt),f.weight=b.weight,f.rank=b.rank,b=g=!0);c.length=0;if(g)f.hash=this.calculateHash(f.pt);else break}e.push(f);d.push(f);for(g=f.nextInHash;null!==g;)g.prevInHash=
null,h=g.nextInHash,g.nextInHash=null,e.push(g),d.push(g),g=h;h=f.hash;k=g=null;for(const q of d){f!==q&&(q.hash=h,q.pt.assign(f.pt),q.rank=f.rank,q.weight=f.weight);if(q.prevInHash=g)g.nextInHash=q;q.prevEqual=k;q.nextEqual=null;k&&(k.nextEqual=q);g=k=q}f=h%this.m_hashTableOfEquals.length;g.nextInHash=this.m_hashTableOfEquals[f];null!==this.m_hashTableOfEquals[f]&&(this.m_hashTableOfEquals[f].prevInHash=g);this.m_hashTableOfEquals[f]=d[0];this.m_hashTableOfEqualsSize+=d.length;d.length=0;this.rehashIfNeeded()}this.m_newNodes.length=
0;if(b)for(const m of e)this.updateAttachedEdgesAfterNodeChange(m)}addNodeToHash(a){p.geometryReleaseAssert(0)}rehashIfNeeded(){if(2*this.m_hashTableOfEqualsSize>this.m_hashTableOfEquals.length){var a=this.m_hashTableOfEquals;this.m_hashTableOfEquals=l.makeNullArray(2*a.length);this.m_hashTableOfEqualsSize=0;for(const b of a)for(a=b;a;){const c=a.nextInHash;a.nextInHash=null;a.prevInHash=null;this.addNodeToHashImpl(a);a=c}}}addNodeToHashImpl(a){const b=a.hash%this.m_hashTableOfEquals.length,c=this.m_hashTableOfEquals[b];
a.nextInHash=c;null!==c&&(c.prevInHash=a);this.m_hashTableOfEquals[b]=a;this.m_hashTableOfEqualsSize++}removeNodeFromHash(a){const b=a.hash%this.m_hashTableOfEquals.length,c=a.prevInHash,d=a.nextInHash;c?c.nextInHash=d:this.m_hashTableOfEquals[b]=d;d&&(d.prevInHash=c);this.m_hashTableOfEqualsSize--;a.prevInHash=null;a.nextInHash=null}hashTableBinsToCheck(a,b){var c=(a.pt.x-this.m_origin.x)/this.m_cell.x;a=(a.pt.y-this.m_origin.y)/this.m_cell.y;var d=l.intMax()-1;c=Math.round(l.snap(c,-d,d));d=Math.round(l.snap(a,
-d,d));a=l.hashInt32(c|d<<32);b[0]=this.m_hashTableOfEquals[a%this.m_hashTableOfEquals.length];var e=l.hashInt32(c+1|d<<32);a=1;b[1]=this.m_hashTableOfEquals[e%this.m_hashTableOfEquals.length];b[1]!==b[0]&&(a=2);e=l.hashInt32(c+1|d+1<<32);b[a]=this.m_hashTableOfEquals[e%this.m_hashTableOfEquals.length];for(e=0;e<a;e++)if(b[a]===b[e]){a--;break}a++;c=l.hashInt32(c|d+1<<32);b[a]=this.m_hashTableOfEquals[c%this.m_hashTableOfEquals.length];for(c=0;c<a;c++)if(b[a]===b[c]){a--;break}a++;return a}calculateHash(a){var b=
(a.x-this.m_origin.x)/this.m_cell.x;a=(a.y-this.m_origin.y)/this.m_cell.y;const c=l.intMax()-1;b=Math.round(l.snap(b,-c,c));a=Math.round(l.snap(a,-c,c));b=l.hashInt32(b|a<<32);0===b&&(b=1);return b}processSharpCorners(a,b,c,d){this.parent.m_param1.length=0;this.parent.m_param2.length=0;if(a.getStartXY().equals(b.getStartXY())){var e=[0,0],f=[0,0],g=Bf(a,b,0,0,c,2,e,f,d);if(g){this.parent.m_param1.push(0);this.parent.m_param2.push(0);for(a=0;a<g;a++)this.parent.m_param1.push(e[a]),this.parent.m_param2.push(f[a]);
return g+1}}if(a.getEndXY().equals(b.getEndXY())&&(e=[0,0],f=[0,0],g=Bf(a,b,1,1,c,2,e,f,d))){for(a=0;a<g;a++)this.parent.m_param1.push(e[a]),this.parent.m_param2.push(f[a]);this.parent.m_param1.push(1);this.parent.m_param2.push(1);return g+1}if(a.getStartXY().equals(b.getEndXY())&&(e=[0,0],f=[0,0],g=Bf(a,b,0,1,c,2,e,f,d))){this.parent.m_param1.push(0);this.parent.m_param2.push(1);for(a=0;a<g;a++)this.parent.m_param1.push(e[a]),this.parent.m_param2.push(f[a]);return g+1}if(a.getEndXY().equals(b.getStartXY())&&
(e=[0,0],f=[0,0],a=Bf(a,b,1,0,c,2,e,f,d))){for(b=0;b<a;b++)this.parent.m_param1.push(e[b]),this.parent.m_param2.push(f[b]);this.parent.m_param1.push(1);this.parent.m_param2.push(0);return a+1}return 0}}class Gn extends Il{constructor(a){super(a.m_shape,a.m_tolerance,!1);this.m_parent=a}compare(a,b,c){if(this.m_bIntersectionDetected)return-1;a=a.getElement(c);var d=this.m_parent.getEdgeOriginVertices(b);d=this.m_parent.m_edgeVertices.getFirstElement(d);var e=this.m_parent.getEdgeOriginVertices(a);
e=this.m_parent.m_edgeVertices.getFirstElement(e);this.m_currentNode=c;return this.compareSegments(b,d,a,e)}}class Hn extends Jl{constructor(a){super(a.m_shape,a.m_tolerance);this.m_parent=a}compare(a,b){if(this.m_bIntersectionDetected)return-1;var c=a.getElement(b);c=this.m_parent.getEdgeOriginVertices(c);c=this.m_parent.m_edgeVertices.getFirstElement(c);this.m_currentNode=b;return this.compareVertex(a,b,c)}}class In extends bd{constructor(a){super();this.pt1=l.Point2D.getNAN();this.pt2=l.Point2D.getNAN();
this.m_shape=a}compare(a,b,c){this.m_shape.queryXY(b,this.pt1);a=a.getElement(c);this.m_shape.queryXY(a,this.pt2);return this.pt1.compare(this.pt2)}}class Jn{constructor(a){this.m_point=l.Point2D.getNAN();this.m_pt=l.Point2D.getNAN();this.m_shape=a}setPoint(a){this.m_point.setCoordsPoint2D(a)}compare(a,b){a=a.getElement(b);this.m_shape.queryXY(a,this.m_pt);return this.m_point.compare(this.m_pt)}}class Bh{constructor(a,b){this.m_progressTracker=this.m_shape=null;this.m_edges=new U(8);this.m_clusters=
new U(5);this.m_clusterVertices=new wa(!1);this.m_edgeVertices=new wa(!1);this.m_helperPoint=new Y;this.m_eventQ=new R;this.m_sweepStructure=new R;this.m_bComplications=!1;this.m_sweepComparator=null;this.m_tempEdgeBuffer=[];this.m_modifiedClusters=[];this.m_edgesToInsertInSweepStructure=[];this.m_nextNeighbour=this.m_prevNeighbour=-1;this.m_bContinuingSegmentChainOptimization=!1;this.m_progressCounter=0;this.m_segmentIntersector=new Ab;this.m_segBuf1=new W;this.m_segBuf2=new W;this.m_sweepPoint=
new l.Point2D(0,0);this.m_toleranceSqr=this.m_tolerance=0;this.m_vertexClusterIndex=this.m_sweepPointCluster=-1;this.m_bSweepPointClusterWasModified=this.m_bCracked=!1;this.m_progressTracker=a;this.m_bTrackChanges=b}hadComplications(){return this.m_bComplications}sweep(a,b){const c=new l.Transformation2D;c.setSwapCoordinates();a.applyTransformation(c);this.setEditShape_(a);this.m_bCracked=!1;this.m_tolerance=b;this.m_toleranceSqr=b*b;b=this.sweepImpl_();a.applyTransformation(c);b||(this.fillEventQueuePass2(),
b=this.sweepImpl_()||b);this.m_shape.removeUserIndex(this.m_vertexClusterIndex);this.m_shape=null;return this.m_bCracked}sweepVertical(a,b){this.setEditShape_(a);this.m_bCracked=!1;this.m_tolerance=b;this.m_toleranceSqr=b*b;this.m_bComplications=!1;let c=this.sweepImpl_();this.m_bComplications||(a=a.filterClosePoints(b,!0,!1,this.m_bTrackChanges,-1),this.m_bComplications=1===a,c||=1===a);-1!==this.m_vertexClusterIndex&&(this.m_shape.removeUserIndex(this.m_vertexClusterIndex),this.m_vertexClusterIndex=
-1);this.m_shape=null;return c}getEdgeCluster(a,b){return this.m_edges.getField(a,0+b)}setEdgeCluster_(a,b,c){this.m_edges.setField(a,0+b,c)}getEdgeOriginVertices(a){return this.m_edges.getField(a,2)}setEdgeOriginVertices_(a,b){this.m_edges.setField(a,2,b)}getNextEdgeEx(a,b){return this.m_edges.getField(a,3+b)}setNextEdgeEx_(a,b,c){this.m_edges.setField(a,3+b,c)}getEdgeSweepNode(a){return this.m_edges.getField(a,7)}setEdgeSweepNode_(a,b){this.m_edges.setField(a,7,b)}getNextEdge(a,b){b=this.getEdgeEnd(a,
b);return this.m_edges.getField(a,3+b)}setNextEdge_(a,b,c){b=this.getEdgeEnd(a,b);this.m_edges.setField(a,3+b,c)}getPrevEdge(a,b){b=this.getEdgeEnd(a,b);return this.m_edges.getField(a,5+b)}setPrevEdge_(a,b,c){b=this.getEdgeEnd(a,b);this.m_edges.setField(a,5+b,c)}getClusterVertices(a){return this.m_clusters.getField(a,0)}setClusterVertices_(a,b){this.m_clusters.setField(a,0,b)}getClusterSweepEdgeList(a){return this.m_clusters.getField(a,2)}setClusterSweepEdgeList_(a,b){this.m_clusters.setField(a,2,
b)}getClusterFirstEdge(a){return this.m_clusters.getField(a,1)}setClusterFirstEdge_(a,b){this.m_clusters.setField(a,1,b)}getClusterEventQNode(a){return this.m_clusters.getField(a,3)}setClusterEventQNode_(a,b){this.m_clusters.setField(a,3,b)}newCluster_(a){const b=this.m_clusters.newElement(),c=this.m_clusterVertices.createList();this.setClusterVertices_(b,c);-1!==a&&(this.m_clusterVertices.addElement(c,a),this.m_shape.setUserIndex(a,this.m_vertexClusterIndex,b));return b}deleteCluster_(a){this.m_clusters.deleteElement(a)}addVertexToCluster_(a,
b){const c=this.getClusterVertices(a);this.m_clusterVertices.addElement(c,b);this.m_shape.setUserIndex(b,this.m_vertexClusterIndex,a)}newEdge_(a){const b=this.m_edges.newElement(),c=this.m_edgeVertices.createList();this.setEdgeOriginVertices_(b,c);-1!==a&&this.m_edgeVertices.addElement(c,a);return b}addVertexToEdge_(a,b){a=this.getEdgeOriginVertices(a);this.m_edgeVertices.addElement(a,b)}deleteEdge_(a){this.m_edges.deleteElement(a);const b=this.m_edgesToInsertInSweepStructure.findIndex(c=>c===a);
0<=b&&l.unorderedPop(this.m_edgesToInsertInSweepStructure,b)}addEdgeToCluster(a,b){-1===this.getEdgeCluster(a,0)?this.setEdgeCluster_(a,0,b):-1===this.getEdgeCluster(a,1)?this.setEdgeCluster_(a,1,b):p.throwInternalErrorException("");this.addEdgeToClusterImpl_(a,b)}addEdgeToClusterImpl_(a,b){const c=this.getClusterFirstEdge(b);if(-1!==c){const d=this.getNextEdge(c,b);this.setPrevEdge_(d,b,a);this.setNextEdge_(a,b,d);this.setNextEdge_(c,b,a);this.setPrevEdge_(a,b,c)}else this.setPrevEdge_(a,b,a),this.setNextEdge_(a,
b,a),this.setClusterFirstEdge_(b,a)}getEdgeEnd(a,b){return this.getEdgeCluster(a,0)===b?0:1}mergeClusters_(a,b){this.dbgCheckCluster_(a);this.dbgCheckCluster_(b);var c=this.getClusterEventQNode(b);-1!==c&&(this.m_eventQ.deleteNode(c),this.setClusterEventQNode_(b,-1));var d=this.getClusterFirstEdge(a);c=this.getClusterFirstEdge(b);if(-1!==c){var e=d=c,f=!1;do{this.dbgCheckEdge_(d);f=!1;var g=this.getEdgeEnd(d,b),h=this.getNextEdgeEx(d,g);if(this.getEdgeCluster(d,g+1&1)===a){this.disconnectEdge_(d);
g=this.getEdgeOriginVertices(d);this.m_edgeVertices.deleteList(g);this.deleteEdge_(d);if(d===h){c=-1;break}c===d&&(c=this.getClusterFirstEdge(b),e=h,f=!0)}d=h}while(d!==e||f);if(-1!==c){do f=this.getEdgeEnd(d,b),h=this.getNextEdgeEx(d,f),this.setEdgeCluster_(d,f,a),d=h;while(d!==e);d=this.getClusterFirstEdge(a);-1!==d?(e=this.getNextEdge(d,a),f=this.getNextEdge(c,a),e===d?(this.setClusterFirstEdge_(a,c),this.addEdgeToClusterImpl_(d,a),this.setClusterFirstEdge_(a,d)):f===c&&this.addEdgeToClusterImpl_(c,
a),this.setNextEdge_(c,a,e),this.setPrevEdge_(e,a,c),this.setNextEdge_(d,a,f),this.setPrevEdge_(f,a,d)):this.setClusterFirstEdge_(a,c)}}c=this.getClusterVertices(a);d=this.getClusterVertices(b);for(e=this.m_clusterVertices.getFirst(d);-1!==e;e=this.m_clusterVertices.getNext(e))f=this.m_clusterVertices.getElement(e),this.m_shape.setUserIndex(f,this.m_vertexClusterIndex,a);this.m_clusterVertices.concatenateLists(c,d);this.deleteCluster_(b);this.dbgCheckCluster_(a)}mergeEdges_(a,b){this.dbgCheckEdge_(a);
this.dbgCheckEdge_(b);const c=this.getEdgeCluster(a,0),d=this.getEdgeCluster(a,1),e=this.getEdgeCluster(b,0),f=this.getEdgeCluster(b,1);var g=this.getEdgeOriginVertices(a);const h=this.getEdgeOriginVertices(b);this.m_edgeVertices.concatenateLists(g,h);b===this.getClusterFirstEdge(c)&&this.setClusterFirstEdge_(c,a);b===this.getClusterFirstEdge(d)&&this.setClusterFirstEdge_(d,a);this.disconnectEdge_(b);this.deleteEdge_(b);c===e&&d===f||d===e&&c===f||(b=this.getClusterXY(c),g=this.getClusterXY(e),b.isEqualPoint2D(g)?
(c!==e&&this.mergeClusters_(c,e),d!==f&&this.mergeClusters_(d,f)):(d!==e&&this.mergeClusters_(d,e),c!==f&&this.mergeClusters_(c,f)));this.dbgCheckEdge_(a)}disconnectEdge_(a){const b=this.getEdgeCluster(a,0),c=this.getEdgeCluster(a,1);this.disconnectEdgeFromCluster_(a,b);this.disconnectEdgeFromCluster_(a,c)}disconnectEdgeFromCluster_(a,b){const c=this.getNextEdge(a,b),d=this.getPrevEdge(a,b),e=this.getClusterFirstEdge(b);c!==a?(this.setNextEdge_(d,b,c),this.setPrevEdge_(c,b,d),e===a&&this.setClusterFirstEdge_(b,
c)):this.setClusterFirstEdge_(b,-1)}applyIntersectorToEditShape_(a,b,c){var d=this.m_edgeVertices.getFirst(a),e=this.m_edgeVertices.getElement(d);const f=this.getClusterFromVertex(e);var g=this.m_shape.getNextVertex(e);a=this.getClusterFromVertex(g);var h=this.m_shape.getXY(e),k=this.m_shape.getXY(g);let m=!1,n=!1;const q=b.getResultSegment(c,0).getStartXY();g=b.getResultSegment(c,b.getResultSegmentCount(c)-1).getEndXY();h.equals(q)||(m=!0);k.equals(g)||(n=!0);this.m_shape.splitSegmentWithIntersector(e,
b,c,!0,!0);(h=this.m_bTrackChanges&&b.getSegmentChanged(c))&&this.m_shape.setGeometryModifiedWithVertex(e,!0);for(d=this.m_edgeVertices.getNext(d);-1!==d;d=this.m_edgeVertices.getNext(d))e=this.m_edgeVertices.getElement(d),k=this.getClusterFromVertex(e)===f,this.m_shape.splitSegmentWithIntersector(e,b,c,k,!0),h&&this.m_shape.setGeometryModifiedWithVertex(e,!0);m&&this.updateClusterXY(!0,f,q,b.getResultSegmentStartPointWeight(c,0),b.getResultSegmentStartPointRank(c,0));n&&(d=b.getResultSegmentCount(c)-
1,this.updateClusterXY(!0,a,g,b.getResultSegmentEndPointWeight(c,d),b.getResultSegmentEndPointRank(c,d)))}createEdgesAndClustersFromSplitEdge_(a,b,c){this.dbgCheckNewEdgesArray_();var d=this.getEdgeOriginVertices(a);const e=this.getEdgeCluster(a,0);a=this.getEdgeCluster(a,1);var f=this.newEdge_(-1);this.m_edgesToInsertInSweepStructure.push(f);var g=U.impossibleIndex3();this.setEdgeSweepNode_(f,g);this.m_tempEdgeBuffer.push(f);this.addEdgeToCluster(f,e);b=b.getResultSegmentCount(c);for(c=1;c<b;c++){const h=
this.newCluster_(-1);this.m_modifiedClusters.push(h);this.m_tempEdgeBuffer.push(h);this.addEdgeToCluster(f,h);f=this.newEdge_(-1);this.m_edgesToInsertInSweepStructure.push(f);this.setEdgeSweepNode_(f,g);this.m_tempEdgeBuffer.push(f);this.addEdgeToCluster(f,h)}this.addEdgeToCluster(f,a);for(d=this.m_edgeVertices.getFirst(d);-1!==d;d=this.m_edgeVertices.getNext(d))if(a=this.m_edgeVertices.getElement(d),this.getClusterFromVertex(a)===e){g=0;f=this.m_tempEdgeBuffer.length;do 0<g&&this.addVertexToCluster_(this.m_tempEdgeBuffer[g-
1],a),b=this.m_tempEdgeBuffer[g],g+=2,this.addVertexToEdge_(b,a),a=this.m_shape.getNextVertex(a);while(g<f)}else{g=this.m_tempEdgeBuffer.length-1;do g<this.m_tempEdgeBuffer.length-2&&this.addVertexToCluster_(this.m_tempEdgeBuffer[g+1],a),f=this.m_tempEdgeBuffer[g],g-=2,this.addVertexToEdge_(f,a),a=this.m_shape.getNextVertex(a);while(0<=g)}this.m_tempEdgeBuffer.length=0;this.dbgCheckNewEdgesArray_()}getVertexFromClusterIndex(a){a=this.getClusterVertices(a);return this.m_clusterVertices.getFirstElement(a)}getClusterFromVertex(a){return this.m_shape.getUserIndex(a,
this.m_vertexClusterIndex)}processSplitHelper1_(a,b,c){var d=this.getEdgeCluster(b,0);const e=this.getClusterXY(d);var f=this.getEdgeCluster(b,1),g=this.getClusterXY(f);const h=c.getResultSegmentCount(a);var k=c.getResultSegment(a,0),m=k.getStartXY();if(!e.isEqualPoint2D(m)){if(!this.m_bComplications){const n=e.compare(this.m_sweepPoint);m=m.compare(this.m_sweepPoint);0>n*m&&(this.m_bComplications=!0)}this.getAffectedEdges(d,this.m_tempEdgeBuffer);this.m_modifiedClusters.push(d)}!this.m_bComplications&&
1<h&&(d=e.compare(g),k=k.getEndXY(),e.compare(k)!==d||k.compare(g)!==d?this.m_bComplications=!0:0>k.compare(this.m_sweepPoint)&&(this.m_bComplications=!0));k=c.getResultSegment(a,h-1);a=k.getEndXY();g.isEqualPoint2D(a)||(this.m_bComplications||(g=g.compare(this.m_sweepPoint),a=a.compare(this.m_sweepPoint),0>g*a&&(this.m_bComplications=!0)),this.getAffectedEdges(f,this.m_tempEdgeBuffer),this.m_modifiedClusters.push(f));this.m_tempEdgeBuffer.push(b);for(let n=0,q=this.m_tempEdgeBuffer.length;n<q;n++)f=
this.m_tempEdgeBuffer[n],g=this.getEdgeSweepNode(f),U.isValidElement(g)&&(this.m_sweepStructure.deleteNode(g),this.setEdgeSweepNode_(f,-1)),g=U.impossibleIndex3(),f!==b&&this.getEdgeSweepNode(f)!==g&&(this.m_edgesToInsertInSweepStructure.push(f),this.setEdgeSweepNode_(f,g));this.m_tempEdgeBuffer.length=0}checkAndFixIntersection_(a,b){const c=this.m_sweepStructure.getElement(a);this.m_sweepComparator.compare(this.m_sweepStructure,c,b);return this.m_sweepComparator.intersectionDetected()?(this.m_sweepComparator.clearIntersectionDetectedFlag(),
this.fixIntersection_(a,b),!0):!1}fixIntersection_(a,b){this.m_bCracked=!0;a=this.m_sweepStructure.getElement(a);b=this.m_sweepStructure.getElement(b);var c=null,d=null;c=this.getEdgeOriginVertices(a);var e=this.m_edgeVertices.getFirstElement(c);c=this.getEdgeOriginVertices(b);var f=this.m_edgeVertices.getFirstElement(c);c=this.m_shape.querySegment(e,this.m_segBuf1,!1,!1);p.geometryReleaseAssert(c);c=this.m_segBuf1.get();var g=this.m_shape.getNextVertex(e);const h=this.m_shape.getWeight(e),k=this.m_shape.getSegmentParentageBreakVertex(e),
m=this.m_shape.getWeight(g),n=this.m_shape.getSegmentParentageBreakVertex(g),q=this.m_shape.getSegmentWeight(e),r=this.m_shape.getRank(e);g=this.m_shape.getRank(g);const t=this.m_shape.getSegmentRank(e);e=this.m_shape.getSegmentParentage(e);d=this.m_shape.querySegment(f,this.m_segBuf2,!1,!1);p.geometryReleaseAssert(d);d=this.m_segBuf2.get();var u=this.m_shape.getNextVertex(f);const v=this.m_shape.getWeight(f),w=this.m_shape.getSegmentParentageBreakVertex(f),x=this.m_shape.getWeight(u),y=this.m_shape.getSegmentParentageBreakVertex(u),
z=this.m_shape.getSegmentWeight(f),A=this.m_shape.getRank(f);u=this.m_shape.getRank(u);const C=this.m_shape.getSegmentRank(f);f=this.m_shape.getSegmentParentage(f);this.m_segmentIntersector.pushSegment(c,h,r,m,g,q,t,k,n,e);this.m_segmentIntersector.pushSegment(d,v,A,x,u,z,C,w,y,f);3===this.m_segmentIntersector.intersect2D(this.m_tolerance,!0)&&(this.m_bComplications=!0);this.splitEdge_(a,b,-1,this.m_segmentIntersector);this.m_segmentIntersector.clear()}fixIntersectionPointSegment_(a,b){this.m_bCracked=
!0;b=this.m_sweepStructure.getElement(b);var c=null;c=this.getEdgeOriginVertices(b);var d=this.m_edgeVertices.getFirstElement(c);c=this.m_shape.querySegment(d,this.m_segBuf1,!1,!1);p.geometryReleaseAssert(c);c=this.m_segBuf1.get();var e=this.m_shape.getNextVertex(d),f=this.m_shape.getWeight(d);const g=this.m_shape.getSegmentParentageBreakVertex(d),h=this.m_shape.getWeight(e),k=this.m_shape.getSegmentParentageBreakVertex(e),m=this.m_shape.getSegmentWeight(d),n=this.m_shape.getRank(d);e=this.m_shape.getRank(e);
const q=this.m_shape.getSegmentRank(d),r=this.m_shape.getSegmentParentage(d);d=this.getClusterFirstVertex(a);this.m_segmentIntersector.pushSegment(c,f,n,h,e,m,q,g,k,r);this.m_shape.queryPoint(d,this.m_helperPoint);c=this.m_shape.getWeight(d);f=this.m_shape.getRank(d);this.m_segmentIntersector.intersect2DEx(this.m_tolerance,this.m_helperPoint,f,c,!0);this.splitEdge_(b,-1,a,this.m_segmentIntersector);this.m_segmentIntersector.clear()}insertNewEdges_(){if(0===this.m_edgesToInsertInSweepStructure.length)return!0;
this.dbgCheckNewEdgesArray_();let a=!0,b=0;const c=Math.max(2*this.m_edgesToInsertInSweepStructure.length+200,this.m_sweepStructure.size()+200);for(;this.m_edgesToInsertInSweepStructure.length;){if(this.m_edgesToInsertInSweepStructure.length>Math.max(100,this.m_shape.getTotalPointCount())||b>c){this.m_edgesToInsertInSweepStructure.length=0;this.m_bComplications=!0;a=!1;break}const d=this.m_edgesToInsertInSweepStructure.at(-1);this.m_edgesToInsertInSweepStructure.pop();this.setEdgeSweepNode_(d,-1);
const e=this.isEdgeOnSweepLine_(d);U.isValidElement(e)?(this.insertNewEdgeToSweepStructure_(d,e),b++):e!==U.impossibleIndex2()&&(a=!1);this.m_bContinuingSegmentChainOptimization=!1}return a}insertNewEdgeToSweepStructure_(a,b){this.m_bContinuingSegmentChainOptimization?(b=this.m_sweepStructure.addElementAtPosition(this.m_prevNeighbour,this.m_nextNeighbour,a,!0,!0),this.m_bContinuingSegmentChainOptimization=!1):b=this.m_sweepStructure.addUniqueElement(a);if(-1===b)return b=this.m_sweepStructure.getDuplicateElement(),
b=this.m_sweepStructure.getElement(b),this.mergeEdges_(b,a),!1;this.setEdgeSweepNode_(a,b);return this.m_sweepComparator.intersectionDetected()?(this.m_sweepComparator.clearIntersectionDetectedFlag(),a=this.m_sweepComparator.getLastComparedNode(),this.m_prevNeighbour===a&&(this.m_prevNeighbour=-1),this.m_nextNeighbour===a&&(this.m_nextNeighbour=-1),this.fixIntersection_(a,b),!0):!1}isEdgeOnSweepLine_(a){const b=this.getEdgeCluster(a,0);a=this.getEdgeCluster(a,1);var c=this.getClusterXY(b),d=this.getClusterXY(a);
if(l.Point2D.sqrDistance(c,d)<=this.m_toleranceSqr)return this.m_bComplications=!0,-1;c=c.compare(this.m_sweepPoint);d=d.compare(this.m_sweepPoint);return 0>=c&&0<d?a:0>=d&&0<c?b:0<c&&0<d?U.impossibleIndex2():-1}fillEventQueue(){const a=new za(0);var b=this.m_shape.queryVertexIteratorOnSelection();for(var c=b.next();-1!==c;c=b.next())-1!==this.m_shape.getUserIndex(c,this.m_vertexClusterIndex)&&a.add(c);this.m_shape.sortVerticesSimpleByY(a,0,a.size());this.progress_(!0);this.m_eventQ.clear();this.m_eventQ.setCapacity(a.size());
this.m_eventQ.setComparator(new In(this.m_shape));b=l.Point2D.getNAN();b.setNAN();c=-1;for(let e=0,f=a.size();e<f;e++){var d=a.read(e);this.m_shape.getXY(d).isEqualPoint2D(b)?(d=this.m_shape.getUserIndex(d,this.m_vertexClusterIndex),this.mergeClusters_(c,d)):(c=this.getClusterFromVertex(d),this.m_shape.queryXY(d,b),d=this.m_eventQ.addBiggestElement(d),this.setClusterEventQNode_(c,d))}}fillEventQueuePass2(){const a=new za(0);for(var b=this.m_eventQ.getFirst();-1!==b;b=this.m_eventQ.getNext(b)){var c=
this.m_eventQ.getElement(b);a.add(c)}this.m_eventQ.clear();this.m_shape.sortVerticesSimpleByY(a,0,a.size());this.progress_(!0);for(let d=0,e=a.size();d<e;d++)c=a.read(d),b=this.getClusterFromVertex(c),c=this.m_eventQ.addBiggestElement(c),this.setClusterEventQNode_(b,c)}getAffectedEdges(a,b){const c=this.getClusterFirstEdge(a);if(-1!==c){var d=c;do{const e=this.getEdgeSweepNode(d);U.isValidElement(e)&&b.push(d);d=this.getNextEdge(d,a)}while(d!==c)}}updateClusterXY(a,b,c,d,e){b=this.getClusterVertices(b);
for(b=this.m_clusterVertices.getFirst(b);-1!==b;b=this.m_clusterVertices.getNext(b)){const f=this.m_clusterVertices.getElement(b);this.m_shape.setXYMonotonicPoint2D(f,c);this.m_shape.setWeight(f,d);this.m_shape.setRank(f,e);a&&this.m_bTrackChanges&&this.m_shape.setGeometryModifiedWithVertex(f,!0);this.m_shape.setSegmentParentageBreakVertex(f,!0)}}splitEdge_(a,b,c,d){this.dbgCheckEdge_(a);-1!==b&&this.dbgCheckEdge_(b);this.disconnectEdge_(a);-1!==b&&this.disconnectEdge_(b);this.processSplitHelper1_(0,
a,d);-1!==b&&this.processSplitHelper1_(1,b,d);-1!==c&&d.getResultPointChanged()&&this.m_modifiedClusters.push(c);for(let g=0,h=this.m_modifiedClusters.length;g<h;g++){var e=this.m_modifiedClusters[g],f=this.getClusterEventQNode(e);-1!==f&&(this.m_eventQ.deleteNode(f),this.setClusterEventQNode_(e,-1))}e=this.getEdgeOriginVertices(a);f=-1!==b?this.getEdgeOriginVertices(b):-1;this.applyIntersectorToEditShape_(e,d,0);if(-1!==f)this.applyIntersectorToEditShape_(f,d,1);else{const g=d.getResultPoint().getXY();
this.updateClusterXY(d.getResultPointChanged(),c,g,d.getResultPointWeight(),d.getResultPointRank())}this.createEdgesAndClustersFromSplitEdge_(a,d,0);-1!==b&&this.createEdgesAndClustersFromSplitEdge_(b,d,1);this.m_edgeVertices.deleteList(e);this.deleteEdge_(a);-1!==b&&(this.m_edgeVertices.deleteList(f),this.deleteEdge_(b));for(let g=0,h=this.m_modifiedClusters.length;g<h;g++)a=this.m_modifiedClusters[g],a===this.m_sweepPointCluster&&(this.m_bSweepPointClusterWasModified=!0),b=this.getClusterEventQNode(a),
-1===b&&(b=this.getClusterFirstVertex(a),b=this.m_eventQ.addUniqueElement(b),-1===b?(b=this.m_eventQ.getDuplicateElement(),b=this.m_eventQ.getElement(b),b=this.getClusterFromVertex(b),this.mergeClusters_(b,a)):this.setClusterEventQNode_(a,b));this.m_modifiedClusters.length=0}getClusterXY(a){a=this.getClusterFirstVertex(a);return this.m_shape.getXY(a)}getClusterFirstVertex(a){a=this.getClusterVertices(a);return this.m_clusterVertices.getFirstElement(a)}dbgCheckEdge_(a){}dbgCheckCluster_(a){}dbgCheckNewEdgesArray_(){}dbgSaveSweepStructure_(a){p.geometryReleaseAssert(0)}sweepImpl_(){this.progress_(!0);
this.m_bSweepPointClusterWasModified=!1;this.m_sweepPointCluster=-1;null===this.m_sweepComparator&&(this.m_sweepStructure.disableBalancing(),this.m_sweepComparator=new Gn(this),this.m_sweepStructure.setComparator(this.m_sweepComparator));const a=[];let b=null,c=null;this.m_nextNeighbour=this.m_prevNeighbour=-1;this.m_bContinuingSegmentChainOptimization=!1;const d=U.impossibleIndex2(),e=U.impossibleIndex3();for(let m=this.m_eventQ.getFirst();-1!==m;){this.progress_();this.dbgCheckSweepStructure_();
this.m_bContinuingSegmentChainOptimization=!1;this.m_nextNeighbour=this.m_prevNeighbour=-1;var f=this.m_eventQ.getElement(m);this.m_sweepPointCluster=this.getClusterFromVertex(f);this.m_shape.queryXY(f,this.m_sweepPoint);this.m_sweepComparator.setSweepY(this.m_sweepPoint.y,this.m_sweepPoint.x);f=!1;var g=this.getClusterFirstEdge(this.m_sweepPointCluster);f=-1===g;if(!f){var h=g;do{var k=this.getEdgeSweepNode(h);-1===k?(this.m_edgesToInsertInSweepStructure.push(h),this.setEdgeSweepNode_(h,e)):k!==
e&&a.push(k);h=this.getNextEdge(h,this.m_sweepPointCluster)}while(h!==g)}!this.m_sweepStructure.isAutoBalancing()&&(4<this.m_sweepStructure.getMaxDepthEver()||10<this.m_edgesToInsertInSweepStructure.length)&&this.m_sweepStructure.enableBalancing();if(0<a.length){this.m_bContinuingSegmentChainOptimization=1===a.length&&1===this.m_edgesToInsertInSweepStructure.length;for(let n=0,q=a.length;n<q;n++)f=this.m_sweepStructure.getElement(a[n]),this.setEdgeSweepNode_(f,d);g=f=d;for(let n=0,q=a.length;n<q;n++){h=
a[n];if(f===d)if(k=this.m_sweepStructure.getPrev(h),-1!==k){const r=this.m_sweepStructure.getElement(k);this.getEdgeSweepNode(r)!==d&&(f=k)}else f=-1;g===d&&(h=this.m_sweepStructure.getNext(h),-1!==h?(k=this.m_sweepStructure.getElement(h),this.getEdgeSweepNode(k)!==d&&(g=h)):g=-1);if(f!==d&&g!==d)break}for(let n=0,q=a.length;n<q;n++)h=a[n],k=this.m_sweepStructure.getElement(h),this.m_sweepStructure.deleteNode(h),this.setEdgeSweepNode_(k,-1);a.length=0;this.m_prevNeighbour=f;this.m_nextNeighbour=g;
-1!==f&&-1!==g?this.m_bContinuingSegmentChainOptimization||this.checkAndFixIntersection_(f,g):-1===f&&-1===g&&(this.m_bContinuingSegmentChainOptimization=!1)}else f&&(null===b&&(b=new Hn(this)),b.setPoint(this.m_sweepPoint),this.m_sweepStructure.searchUpperBound(b),b.intersectionDetected()&&(b.clearIntersectionDetectedFlag(),this.fixIntersectionPointSegment_(this.m_sweepPointCluster,b.getCurrentNode())));f=this.m_bContinuingSegmentChainOptimization;!this.insertNewEdges_()&&f&&-1!==this.m_prevNeighbour&&
-1!==this.m_nextNeighbour&&this.checkAndFixIntersection_(this.m_prevNeighbour,this.m_nextNeighbour);this.m_bSweepPointClusterWasModified?(this.m_bSweepPointClusterWasModified=!1,null===c&&(c=new Jn(this.m_shape)),c.setPoint(this.m_sweepPoint),m=this.m_eventQ.searchUpperBound(c)):m=this.m_eventQ.getNext(m)}return this.m_bCracked}setEditShape_(a){this.m_shape=a;this.m_vertexClusterIndex=this.m_shape.createUserIndex();this.m_edges.setCapacity(a.getSelectedCount()+32);this.m_clusters.setCapacity(a.getSelectedCount());
this.m_clusterVertices.reserveLists(a.getSelectedCount());this.m_clusterVertices.reserveNodes(a.getSelectedCount());this.m_edgeVertices.reserveLists(a.getSelectedCount()+32);this.m_edgeVertices.reserveNodes(a.getSelectedCount()+32);for(let h=this.m_shape.getFirstGeometry();-1!==h;h=this.m_shape.getNextGeometry(h))if(p.isMultiPath(this.m_shape.getGeometryType(h)))for(var b=this.m_shape.getFirstPath(h);-1!==b;b=this.m_shape.getNextPath(b)){var c=this.m_shape.getPathSize(b),d=this.m_shape.getFirstVertex(b);
if(-1!==d){var e=this.m_shape.getNextVertex(d);if(-1!==e&&e!==d){var f=-1;a.selected(d)&&(f=this.newCluster_(d));var g=-1;-1!==f&&a.selected(e)&&(g=this.newEdge_(d),this.addEdgeToCluster(g,f));d=g;for(let k=0,m=c-2;k<m;k++){c=this.m_shape.getNextVertex(e);g=-1;if(this.m_shape.selected(e)){const n=this.newCluster_(e);-1!==d&&this.addEdgeToCluster(d,n);this.m_shape.selected(c)&&(g=this.newEdge_(e),this.addEdgeToCluster(g,n))}d=g;e=c}this.m_shape.isClosedPath(b)?(g=this.m_shape.getNextVertex(e),this.m_shape.selected(e)&&
(c=this.newCluster_(e),-1!==d&&this.addEdgeToCluster(d,c),this.m_shape.selected(g)&&(e=this.newEdge_(e),this.addEdgeToCluster(e,c),this.addEdgeToCluster(e,f)))):(f=-1,this.m_shape.selected(e)&&(f=this.newCluster_(e),-1!==d&&this.addEdgeToCluster(d,f)))}}}else for(b=this.m_shape.getFirstPath(h);-1!==b;b=this.m_shape.getNextPath(b)){e=this.m_shape.getFirstVertex(b);for(let k=0,m=this.m_shape.getPathSize(b);k<m;k++)this.m_shape.selected(e)&&this.newCluster_(e),e=this.m_shape.getNextVertex(e)}this.fillEventQueue()}progress_(a){}dbgCheckSweepStructure_(){}}
class Kn{constructor(a){this.m_shape=null;this.m_spikes=[];this.m_points=new za(0);this.m_pointsIndex=-1;this.m_dissolvedEdges=0;this.m_progressTracker=a}executeImpl_(a,b){this.m_shape=a;if(!(2>a.getPathCount(b)&&6>a.getPointCount(b))){this.m_points.resize(0);for(var c=a.getFirstPath(b);-1!==c;c=a.getNextPath(c)){var d=a.getFirstVertex(c);for(let q=0,r=a.getPathSize(c);q<r;q++,d=a.getNextVertex(d))this.m_points.add(d)}this.m_pointsIndex=a.createUserIndex();for(let q=0,r=this.m_points.size();q<r;++q)a.setUserIndex(this.m_points.read(q),
this.m_pointsIndex,q);a.sortVerticesSimpleByY(this.m_points,0,this.m_points.size());var e=this.m_points.read(0);c=a.getXY(e);var f=1,g=0;d=[];for(var h=1;h<this.m_points.size();h++)if(e=this.m_points.read(h),-1!==e&&-1!==a.getUserIndex(e,this.m_pointsIndex)){var k=a.getXY(e);if(k.isEqualPoint2D(c))f++;else{if(1<f){for(f=g;f<h;f++)if(g=this.m_points.read(f),-1!==a.getUserIndex(g,this.m_pointsIndex)){var m=a.getNextVertex(g),n=a.getPrevVertex(g);g===m||a.isEqualXYPoint2D(m,c)||d.push({vertex0:g,vertex1:m,
dir:1});g===n||n===m||a.isEqualXYPoint2D(n,c)||d.push({vertex0:g,vertex1:n,dir:-1})}0<d.length&&this.processBunch_(d,c)}c.assign(k);f=1;g=h}}if(0===this.m_dissolvedEdges)a.removeUserIndex(this.m_pointsIndex),this.m_pointsIndex=-1;else{c=a.getPointCount(b);for(d=0;d<this.m_points.size();d++)h=this.m_points.read(d),-1!==h&&(-1!==a.getUserIndex(h,this.m_pointsIndex)?a.setUserIndex(h,this.m_pointsIndex,-1):(k=a.getPathFromVertex(h),a.getFirstVertex(k)===h&&a.setFirstVertex(k,-1),a.freeVertex(h),this.m_points.write(d,
-1),c--));d=a.createPathUserIndex();h=a.getPathCount(b);for(let q=0,r=this.m_points.size();q<r;++q)if(-1!==this.m_points.read(q)&&(k=this.m_points.read(q),-1===a.getUserIndex(k,this.m_pointsIndex))){e=a.getPathFromVertex(k);f=-1;if(2===a.getPathUserIndex(e,d)){e=-1;for(f=a.getNextVertex(k);f!==k;f=a.getNextVertex(f))if(g=a.getPathFromVertex(f),2!==a.getPathUserIndex(g,d)){e=g;k=f;break}-1===e&&(e=a.insertPath(b,-1),a.setClosedPath(e,!0),h++);p.geometryReleaseAssert(-1!==e)}a.setPathUserIndex(e,d,
2);f=a.getFirstVertex(e);g=0;m=!1;n=k;do{f===n&&(m=!0);a.setUserIndex(n,this.m_pointsIndex,1);const t=a.getPathFromVertex(n);t!==e&&(2!==a.getPathUserIndex(t,d)&&(a.setPathUserIndex(t,d,1),a.setFirstVertex(t,-1)),a.setPathToVertex(n,e));g++;n=a.getNextVertex(n)}while(n!==k);m||a.setFirstVertex(e,k);a.setPathSize(e,g)}for(k=a.getFirstPath(b);-1!==k;){e=a.getNextPath(k);if(1===a.getPathUserIndex(k,d)||-1===a.getFirstVertex(k))a.removePathOnly(k),h--;k=e}a.setGeometryVertexCount(b,c);a.setGeometryPathCount(b,
h);a.removePathUserIndex(d);a.removeUserIndex(this.m_pointsIndex);this.m_pointsIndex=-1;a.dbgVerifyVertexCounts();a.filterClosePoints(0,!0,!1,!1,b)}}}processBunch_(a,b){a.sort((k,m)=>{var n=this.m_shape.getXY(k.vertex1).sub(b);const q=this.m_shape.getXY(m.vertex1).sub(b);n=l.Point2D.compareVectors(n,q);return 0===n?k.dir<m.dir?-1:1:n});var c=0;const d=this.m_shape.getXY(a[0].vertex1);var e=1;const f=this.m_shape.hasCurves();for(let k=1,m=a.length;k<m;k++){const n=this.m_shape.getXY(a[k].vertex1);
if(n.isEqualPoint2D(d)&&(e++,k+1<m))continue;if(2===e){e=a[c];c=a[c+1];var g=e.dir;if(g!==c.dir){var h=!0;f&&(h=!this.m_shape.isCurve(1===e.dir?e.vertex0:e.vertex1)&&!this.m_shape.isCurve(1===c.dir?c.vertex0:c.vertex1));h&&(1===g?(g=e.vertex0,h=c.vertex0,this.m_shape.setNextVertex(g,h),this.m_shape.setPrevVertex(h,g),this.m_shape.getPrevVertex(g)===h&&(this.m_shape.setUserIndex(g,this.m_pointsIndex,-1),this.m_shape.setUserIndex(h,this.m_pointsIndex,-1)),e=e.vertex1,c=c.vertex1,this.m_shape.setPrevVertex(e,
c),this.m_shape.setNextVertex(c,e),this.m_shape.getNextVertex(e)===c&&(this.m_shape.setUserIndex(e,this.m_pointsIndex,-1),this.m_shape.setUserIndex(c,this.m_pointsIndex,-1))):(g=e.vertex0,h=c.vertex0,this.m_shape.setPrevVertex(g,h),this.m_shape.setNextVertex(h,g),this.m_shape.getNextVertex(g)===h&&(this.m_shape.setUserIndex(g,this.m_pointsIndex,-1),this.m_shape.setUserIndex(h,this.m_pointsIndex,-1)),e=e.vertex1,c=c.vertex1,this.m_shape.setNextVertex(e,c),this.m_shape.setPrevVertex(c,e),this.m_shape.getPrevVertex(e)===
c&&(this.m_shape.setUserIndex(e,this.m_pointsIndex,-1),this.m_shape.setUserIndex(c,this.m_pointsIndex,-1))),this.m_dissolvedEdges+=2)}}d.assign(n);c=k;e=1}a.length=0}}class vd{crackBruteForce_(){let a=this.crackBruteForceImpl_();if(!a&&this.m_shape.hasCurves()){const b=new l.Transformation2D;b.setSwapCoordinates();this.m_shape.applyTransformation(b);a=this.crackBruteForceImpl_();this.m_shape.applyTransformation(b)}return a}crackBruteForceImpl_(){let a=!1;const b=new W,c=new W,d=D.constructEmpty(),
e=D.constructEmpty(),f=new Y,g=new Ab;var h=this.m_shape.getTotalPointCount();h=h*h*2;const k=this.m_shape.queryVertexIteratorOnSelection();for(let y=k.next();-1!==y;y=k.next()){var m=this.m_shape.getGeometryType(k.currentGeometry());let z=1;var n=1;let A=1,C=0,B=0,E=0;const G=this.m_shape.getSegmentParentage(y);let I=!1;var q=!1;let H=null,L=!1;if(p.isPoint(m))z=this.m_shape.getWeight(y),C=this.m_shape.getRank(y);else{H=this.getSegment_(y,b);if(null===H)continue;n=this.m_shape.getVertexIndex(y);
z=this.m_shape.getWeightWithIndex(n);C=this.m_shape.getRankWithIndex(n);A=this.m_shape.getSegmentWeightWithIndex(n);E=this.m_shape.getSegmentRankWithIndex(n);I=this.m_shape.getSegmentParentageBreakVertex(y);q=this.m_shape.getNextVertex(y);n=this.m_shape.getWeight(q);B=this.m_shape.getRank(q);q=this.m_shape.getSegmentParentageBreakVertex(q);H.queryLooseEnvelope(d);d.inflateCoords(this.m_tolerance,this.m_tolerance);if(H.isDegenerate(this.m_tolerance))if(H.isDegenerate(0))L=!0,H=null;else continue}m=
new Gf({copy:k});var r=m.next();-1!==r&&(r=m.next());let M=0;for(;-1!==r;r=m.next()){if(0!==M){M--;continue}if(this.m_shape.getTotalPointCount()>h)return a;this.progress_();var t=this.m_shape.getGeometryType(m.currentGeometry()),u=null,v=!1,w=0;let N=0,Q=0;var x=0;let O=0,P=0,ia=!1,ka=!1;const Aa=this.m_shape.getSegmentParentage(r);if(p.isPoint(t))w=this.m_shape.getWeight(r),x=this.m_shape.getRank(r);else{u=this.getSegment_(r,c);if(null===u)continue;t=this.m_shape.getVertexIndex(r);w=this.m_shape.getWeightWithIndex(t);
x=this.m_shape.getRankWithIndex(t);Q=this.m_shape.getSegmentWeightWithIndex(t);P=this.m_shape.getSegmentRankWithIndex(t);ia=this.m_shape.getSegmentParentageBreakVertex(r);t=this.m_shape.getNextVertex(r);N=this.m_shape.getWeight(t);O=this.m_shape.getRank(t);ka=this.m_shape.getSegmentParentageBreakVertex(t);u.queryLooseEnvelope(e);if(u.isDegenerate(this.m_tolerance))if(u.isDegenerate(0))v=!0,u=null;else continue}let J=t=0;if(null!==H&&null!==u)d.isIntersectingNe(e)&&0!==Hc(!0,!0,H,u,this.m_tolerance,
!0)&&(g.pushSegment(H,z,C,n,B,A,E,I,q,G),g.pushSegment(u,w,x,N,O,Q,P,ia,ka,Aa),g.intersect2D(this.m_tolerance,!0),a||=g.getSegmentChanged(0)||g.getSegmentChanged(1),t=g.getResultSegmentCount(0),J=g.getResultSegmentCount(1),0<t+J&&(this.m_shape.splitSegmentWithIntersector(y,g,0,!0,!0),this.m_shape.splitSegmentWithIntersector(r,g,1,!0,!0),this.m_bTrackChanges&&(g.getSegmentChanged(0)&&this.m_shape.setGeometryModifiedWithVertex(y,!0),g.getSegmentChanged(1)&&this.m_shape.setGeometryModifiedWithVertex(r,
!0))),1<J&&(M+=J-1),g.clear());else if(null!==H){if(u=this.m_shape.getXY(r),d.contains(u)){g.pushSegment(H,z,C,n,B,A,E,I,q,G);this.m_shape.queryPoint(r,f);g.intersect2DEx(this.m_tolerance,f,x,w,!1);a||=g.getSegmentChanged(0)||g.getResultPointChanged();t=g.getResultSegmentCount(0);if(0<t)if(this.m_bTrackChanges&&(g.getSegmentChanged(0)&&this.m_shape.setGeometryModifiedWithVertex(y,!0),g.getSegmentChanged(1)&&this.m_shape.setGeometryModifiedWithVertex(r,!0)),this.m_shape.splitSegmentWithIntersector(y,
g,0,!0,!0),v){w=-1;for(x=this.m_shape.getNextVertex(r);-1!==x&&x!==r&&(u=this.getSegment_(x,c),w=x,null!=u&&u.isDegenerate(0));x=this.m_shape.getNextVertex(x));for(u=r;-1!==u&&(this.m_shape.setPoint(u,g.getResultPoint(),!0),u!==w);u=this.m_shape.getNextVertex(u));}else this.m_shape.setPoint(r,g.getResultPoint(),!0);g.clear()}}else if(null!==u){if(v=this.m_shape.getXY(y),e.inflateCoords(this.m_tolerance,this.m_tolerance),e.contains(v)){g.pushSegment(u,w,x,N,O,Q,P,ia,ka,Aa);this.m_shape.queryPoint(y,
f);g.intersect2DEx(this.m_tolerance,f,C,z,!1);a||=g.getSegmentChanged(0)||g.getResultPointChanged();J=g.getResultSegmentCount(0);if(0<J)if(this.m_bTrackChanges&&(g.getSegmentChanged(0)&&this.m_shape.setGeometryModifiedWithVertex(r,!0),g.getSegmentChanged(1)&&this.m_shape.setGeometryModifiedWithVertex(y,!0)),this.m_shape.splitSegmentWithIntersector(r,g,0,!0,!0),M+=J-1,L){r=-1;for(w=this.m_shape.getNextVertex(y);-1!==w&&w!==y&&(u=this.getSegment_(w,c),r=w,null!=u&&u.isDegenerate(0));w=this.m_shape.getNextVertex(w));
for(u=y;-1!==u&&(this.m_shape.setPoint(u,g.getResultPoint(),!0),u!==r);u=this.m_shape.getNextVertex(u));}else this.m_shape.setPoint(y,g.getResultPoint(),!0);g.clear()}}else continue;if(0!==t+J&&0!==t){for(u=!1;;){H=this.getSegment_(y,b);if(null==H)break;H.queryEnvelope(d);if(H.isDegenerate(this.m_tolerance))if(1<t)y=k.next(),t--,p.geometryReleaseAssert(-1!==y);else{u=!0;break}else break}if(u)break}}}return a}crackerPlaneSweep_(){return this.planesweep_()}planesweep_(){return(new Bh(this.m_progressTracker,
this.m_bTrackChanges)).sweep(this.m_shape,this.m_tolerance)}needsCrackingImpl_(){let a=!1;const b=new za(0);b.resize(this.m_shape.getSelectedCount());var c=this.m_shape.queryVertexIteratorOnSelection();for(let t=0,u=c.next();-1!==u;++t,u=c.next())b.write(t,u);this.m_shape.sortVerticesSimpleByY(b,0,b.size());b.add(-1);c=this.m_shape.createUserIndex();const d=this.m_shape.createUserIndex();this.m_sweepComparator=new Il(this.m_shape,this.m_tolerance,!this.m_bAllowCoincident);this.m_sweepStructure.setComparator(this.m_sweepComparator);
let e=null;const f=[],g=[];let h=0;const k=new l.Point2D;for(let t=b.read(h++);-1!==t;){this.m_shape.queryXY(t,k);var m=!1;do{var n=this.m_shape.getNextVertex(t),q=this.m_shape.getPrevVertex(t);m||=-1!==n||-1!==q;-1===n||this.m_shape.selected(n)||(n=-1);-1===q||this.m_shape.selected(q)||(q=-1);-1!==n&&0>this.m_shape.compareVerticesSimpleY(t,n)&&(g.push(t),g.push(n));-1!==q&&0>this.m_shape.compareVerticesSimpleY(t,q)&&(g.push(q),g.push(q));n=this.m_shape.getUserIndex(t,c);-1!==n&&(f.push(n),this.m_shape.setUserIndex(t,
c,-1));n=this.m_shape.getUserIndex(t,d);-1!==n&&(f.push(n),this.m_shape.setUserIndex(t,d,-1));t=b.read(h++)}while(-1!==t&&this.m_shape.isEqualXYPoint2D(t,k));if(!m&&(null===e&&(e=new Jl(this.m_shape,this.m_tolerance)),e.setPoint(k),this.m_sweepStructure.searchUpperBound(e),e.intersectionDetected())){a=!0;this.m_bNeedsNonSimpleResult&&(p.geometryReleaseAssert(0),this.m_nonSimpleResult=new va(6,-1,-1));break}m=1===f.length&&2===g.length;32<f.length&&l.numericSort(f);q=n=-1;if(!m)for(let u=0,v=f.length;u<
v;u++){var r=f[u];const w=this.m_sweepStructure.getPrev(r);if(-1!==w&&-1===f.indexOf(w))if(-1===n)n=w;else if(a=!0,this.m_bNeedsNonSimpleResult)this.m_nonSimpleResult=new va(6,-1,-1);else break;r=this.m_sweepStructure.getNext(r);if(-1!==r&&-1===f.indexOf(r))if(-1===q)q=r;else if(a=!0,this.m_bNeedsNonSimpleResult)this.m_nonSimpleResult=new va(6,-1,-1);else break;if(-1!==n&&-1!==q)break}if(a&&!this.m_bNeedsNonSimpleResult)break;this.m_sweepComparator.setSweepY(k.y,k.x);if(!m){for(let u=0,v=f.length;u<
v;u++)this.m_sweepStructure.deleteNode(f[u]);f.length=0}if(!m&&-1!==n&&-1!==q&&this.checkForIntersections_(n,q)){a=!0;this.m_bNeedsNonSimpleResult&&(this.m_nonSimpleResult=this.m_sweepComparator.getResult());break}for(let u=0,v=g.length;u<v;u+=2){q=g[u];n=g[u+1];m?(q=this.m_sweepStructure.replaceElementAtPosition(f[0],q,!0,!0),f.length=0,m=!1):q=this.m_sweepStructure.addElement(q);if(this.m_sweepComparator.intersectionDetected()){this.m_bNeedsNonSimpleResult&&(this.m_nonSimpleResult=this.m_sweepComparator.getResult());
a=!0;break}-1===this.m_shape.getUserIndex(n,c)?this.m_shape.setUserIndex(n,c,q):this.m_shape.setUserIndex(n,d,q)}if(a)break;g.length=0}this.m_shape.removeUserIndex(c);this.m_shape.removeUserIndex(d);return a}checkForIntersections_(a,b){a=this.m_sweepStructure.getElement(a);this.m_sweepComparator.compare(this.m_sweepStructure,a,b);b=this.m_sweepComparator.intersectionDetected();this.m_sweepComparator.clearIntersectionDetectedFlag();return b}getSegment_(a,b){return vd.st_getSegment(this.m_shape,a,b)}static st_getSegment(a,
b,c){return a.querySegment(b,c,!1,!1)?c.get():null}dbgPrintSweepEdge(a){}dbgPrintSweepStructure(){}dbgSaveSweepStructure(a){}dbgCheckSweepStructure(){}progress_(a){this.m_progressCounter++}crackAWithBMultiPath_(a,b,c){var d=D.constructEmpty();a.queryLooseEnvelope(d);var e=D.constructEmpty();b.queryLooseEnvelope(e);e.inflateCoords(c,c);if(!e.isIntersecting(d))return a;var f=a.getImpl(),g=f.getAccelerators(),h=null;h=null;g&&(h=g.getQuadTree());Dm(a,p.vertexCount(b))&&(h=fd(f,e));f=h?h.getIteratorForQT():
null;g=b.querySegmentIterator();b=a.querySegmentIterator();var k=Array(15);for(e=[];g.nextPath();)for(;g.hasNextSegment();){var m=g.nextSegment();if(h){f.resetIterator(m,c);for(var n=f.next();-1!==n;n=f.next())if(this.progress_(),n=h.getElement(n),b.resetToVertex(n,-1),b.hasNextSegment()){n=b.nextSegment().intersect(m,null,k,null,c);for(var q=0;q<n;q++){var r=k[q];if(0!==r&&1!==r){var t=b.getStartPointIndex();e.push({t:r,index:t})}}}}else if(n=D.constructEmpty(),m.queryLooseEnvelope(n),n.inflateCoords(c,
c),d.isIntersecting(n))for(b.resetToFirstPath();b.nextPath();)for(;b.hasNextSegment();)if(q=b.nextSegment(),r=D.constructEmpty(),q.queryLooseEnvelope(r),r.isIntersecting(n))for(q=q.intersect(m,null,k,null,c),r=0;r<q;r++){t=k[r];if(0===t||1===t)continue;const u=b.getStartPointIndex();e.push({t,index:u})}}if(0===e.length)return a;e.sort((u,v)=>u.index<v.index?-1:u.index>v.index?1:u.t<v.t?-1:u.t>v.t?1:0);c=a.createInstance();c.getGeometryType()===p.GeometryType.enumPolygon&&c.setFillRule(a.getFillRule());
for(b.resetToFirstPath();b.nextPath()&&!b.hasNextSegment(););p.geometryReleaseAssert(b.hasNextSegment());a=b.nextSegment();h=new W;d=-1;for(let u=0,v=e.length;u<v;){g=e[u].index;for(f=u+1;f<v&&e[f].index===g;)++f;for(;b.getStartPointIndex()<g;){this.progress_();k=b.hasNextSegment();m=b.getPathIndex();if(k||!b.isClosingSegment()||b.isCurve())p.geometryReleaseAssert(null!==a),c.addSegment(a,d!==m);d=m;if(!k){for(b.isPathClosed();b.nextPath()&&!b.hasNextSegment(););p.geometryReleaseAssert(b.hasNextSegment())}a=
b.nextSegment()}g=0;for(k=u;k<f;k++)m=e[k].t,m!==g&&(p.geometryReleaseAssert(null!==a),a.queryCut(g,m,h),g=m,m=b.getPathIndex(),c.addSegment(h.get(),d!==m),d=m);if((k=b.hasNextSegment())||!b.isClosingSegment()||b.isCurve())p.geometryReleaseAssert(null!=a),a.queryCut(g,1,h),c.addSegment(h.get(),!1);if(k)a=b.nextSegment();else{for(;b.nextPath()&&!b.hasNextSegment(););a=b.hasNextSegment()?b.nextSegment():null}u=f}null!==a&&(e=b.getPathIndex(),(b.hasNextSegment()||!b.isClosingSegment()||b.isCurve())&&
c.addSegment(a,d!==e),d=e);for(e=b.hasNextSegment();;){if(!e){for(;b.nextPath()&&!(e=b.hasNextSegment()););if(!e)break}a=b.nextSegment();h=b.getPathIndex();((e=b.hasNextSegment())||!b.isClosingSegment()||b.isCurve())&&c.addSegment(a,d!==h);d=h}return c}constructor(a){this.m_progressTracker=this.m_shape=null;this.m_nonSimpleResult=new va;this.m_tolerance=0;this.m_sweepComparator=null;this.m_progressCounter=0;this.m_bNeedsNonSimpleResult=this.m_bTrackChanges=!1;this.m_bAllowCoincident=!0;this.m_sweepStructure=
new R;this.m_progressTracker=a}}vd.s_bForceBruteForce=!0;class qj{constructor(a,b){this.m_monotoneParts=l.makeObjectArray(W,16);this.m_xOrds=l.makePrimitiveArray(16,Number.NaN);this.m_inputPoint=l.Point2D.getNAN();this.m_windnum=this.m_maxy=this.m_miny=0;this.m_bAlternate=a;this.m_tolerance=b;this.m_toleranceSqr=b*b;this.m_bTestBorder=!!b;this.m_bBreak=!1}_DoOne(a){if(!this.m_bTestBorder&&(this.m_bAlternate&&this.m_inputPoint.equals(a.getStartXY())||this.m_inputPoint.equals(a.getEndXY())))this.m_bBreak=
!0;else if(a.getStartY()===this.m_inputPoint.y&&a.getStartY()===a.getEndY()){if(this.m_bAlternate&&!this.m_bTestBorder){var b=Math.min(a.getStartX(),a.getEndX());a=Math.max(a.getStartX(),a.getEndX());this.m_inputPoint.x>b&&this.m_inputPoint.x<a&&(this.m_bBreak=!0)}}else{b=!1;var c=Math.max(a.getStartX(),a.getEndX());this.m_inputPoint.x>c?b=!0:this.m_inputPoint.x>=Math.min(a.getStartX(),a.getEndX())&&(b=a.intersectionOfYMonotonicWithAxisX(this.m_inputPoint.y,c),b=!Number.isNaN(b)&&b<=this.m_inputPoint.x);
if(b){if(this.m_inputPoint.y===a.getStartY()){if(this.m_inputPoint.y<a.getEndY())return}else if(this.m_inputPoint.y===a.getEndY()&&this.m_inputPoint.y<a.getStartY())return;this.m_windnum=this.m_bAlternate?this.m_windnum^1:this.m_windnum+(a.getStartY()>a.getEndY()?1:-1)}}}_Result(){return!!this.m_windnum}testBorder(a){const b=a.getClosestCoordinate(this.m_inputPoint,!1);a=a.getCoord2D(b);return l.Point2D.sqrDistance(a,this.m_inputPoint)<=this.m_toleranceSqr?!0:!1}setInputPoint(a){this.m_inputPoint.setCoordsPoint2D(a);
this.m_miny=a.y-this.m_tolerance;this.m_maxy=a.y+this.m_tolerance}processSegment(a){var b=a.queryInterval(0,1);if(b.vmin>this.m_maxy||b.vmax<this.m_miny)return!1;if(this.m_bTestBorder&&this.testBorder(a))return!0;if(b.vmin>this.m_inputPoint.y||b.vmax<this.m_inputPoint.y)return!1;b=0;a.isCurve()&&(0===this.m_monotoneParts.length&&(this.m_monotoneParts.length=128),b=a.getMonotonicParts(this.m_monotoneParts,!0),p.geometryReleaseAssert(this.m_monotoneParts.length>=b));if(0<b)for(a=0;a<b;a++){const c=
this.m_monotoneParts[a].get(),d=l.Envelope1D.construct(c.getStartY(),c.getEndY());if(!(d.vmin>this.m_inputPoint.y||d.vmax<this.m_inputPoint.y)&&(this._DoOne(c),this.m_bBreak))return!0}else if(this._DoOne(a),this.m_bBreak)return!0;return!1}result(){p.geometryReleaseAssert(0);return 2}}class Ln{getDirection_(a){return this.m_shape.getNextVertex(this.getEnd1(a))===this.getEnd2(a)}getEnd_(a){const b=this.getEnd1(a);a=this.getEnd2(a);return this.m_shape.getNextVertex(b)===a?a:b}constructor(a){this.m_end1Nodes=
[];this.m_end2Nodes=[];this.m_directions=[];this.m_shape=a;this.m_firstFree=-1}getSegment(a){return this.m_shape.getSegment(this.getStart(a))}isBottomUp(a){let b=this.getEnd1(a);a=this.getEnd2(a);this.m_shape.getPrevVertex(b)===a&&(a=l.swap(b,b=a));const c=l.Point2D.getNAN(),d=l.Point2D.getNAN();this.m_shape.queryXY(b,c);this.m_shape.queryXY(a,d);p.geometryReleaseAssert(!c.equals(d));return c.y<d.y}getStart(a){const b=this.getEnd1(a);a=this.getEnd2(a);return this.m_shape.getNextVertex(b)===a?b:a}getEnd1(a){return this.m_end1Nodes[a]}getEnd2(a){return this.m_end2Nodes[a]}freeEdge(a){this.m_end1Nodes[a]=
this.m_firstFree;this.m_firstFree=a}newEdge(a){if(-1!==this.m_firstFree){var b=this.m_firstFree;this.m_firstFree=this.m_end1Nodes[b];this.m_end1Nodes[b]=a;this.m_end2Nodes[b]=this.m_shape.getNextVertex(a);return b}b=this.m_end1Nodes.length;this.m_end1Nodes.push(a);this.m_end2Nodes.push(this.m_shape.getNextVertex(a));return b}getShape(){return this.m_shape}getPath(a){return this.m_shape.getPathFromVertex(this.getEnd1(a))}}let Mn=class extends bd{constructor(a){super();this.m_line1=new Z;this.m_line2=
new Z;this.m_leftElm=-1;this.m_leftx=0;this.m_seg1=null;this.m_helper=a}compare(a,b,c){c=a.getElement(c);const d=this.m_helper.m_edges;let e;this.m_leftElm===b?e=this.m_leftx:((this.m_seg1=d.getSegment(b))?e=this.m_seg1.intersectionOfYMonotonicWithAxisX(this.m_helper.m_yScanline,0):(d.getShape().queryLineConnector(d.getStart(b),this.m_line1,!0),this.m_seg1=this.m_line1,e=this.m_line1.intersectionOfYMonotonicWithAxisX(this.m_helper.m_yScanline,0)),this.m_leftx=e,this.m_leftElm=b);a=d.getSegment(c);
let f;a?f=a.intersectionOfYMonotonicWithAxisX(this.m_helper.m_yScanline,0):(d.getShape().queryLineConnector(d.getStart(c),this.m_line2,!0),a=this.m_line2,f=this.m_line2.intersectionOfYMonotonicWithAxisX(this.m_helper.m_yScanline,0));e===f&&(b=d.isBottomUp(b),c=d.isBottomUp(c),b=b?this.m_seg1.getEndY():this.m_seg1.getStartY(),c=c?a.getEndY():a.getStartY(),c=Math.min(b,c),b=.5*(c+this.m_helper.m_yScanline),b===this.m_helper.m_yScanline&&(b=c),e=this.m_seg1.intersectionOfYMonotonicWithAxisX(b,0),f=a.intersectionOfYMonotonicWithAxisX(b,
0),e===f&&p.throwNonSimpleGeometryException(""));return e<f?-1:e>f?1:0}reset(){this.m_leftElm=-1}};class Nl{constructor(a){this.m_node=-1;this.m_index=0;this.m_sortedVertices=a.m_sortedVertices;this.m_sortedVerticesArray=a.m_sortedVerticesArray;this.m_sortedVertices&&(this.m_node=this.m_sortedVertices.getFirst(this.m_sortedVertices.getFirstList()))}next(){if(this.m_sortedVertices){var a=this.m_node;if(-1===a)return-1;const b=this.m_sortedVertices.getData(a);this.m_node=this.m_sortedVertices.getNext(a);
return b}return this.m_index<this.m_sortedVerticesArray.size()?(a=this.m_sortedVerticesArray.read(this.m_index),this.m_index++,a):-1}}class Ol{constructor(a){this.m_shape=this.m_edges=null;this.m_AET=new R;this.m_yScanline=0;this.m_unknownRingOrientationCount=this.m_geometry=-1;this.m_sortedVerticesArray=this.m_sortedVertices=null;this.m_unknownNodes=[];this.m_pathParentsIndex=this.m_pathParentageIndex=this.m_pathOrientationIndex=this.m_node2UserIndex=this.m_node1UserIndex=-1;this.m_progressCounter=
0;this.m_bFixSelfTangency=!1;this.m_progressTracker=a;this.m_AET.disableBalancing();this.m_sweepComparator=new Mn(this);this.m_AET.setComparator(this.m_sweepComparator)}fixRingOrientation_(){const a=this.fixRingOrientationImplMain_();if(-1===this.m_pathOrientationIndex)return a;this.fixRingOrientationImplSimplify_();return a}fixRingOrientationForMp2sp_(){this.fixRingOrientationImplMain_();return-1===this.m_pathOrientationIndex?-1:this.fixRingOrientationImplMp2sp_()}processBunchForRingOrientationTest_(a){return this.processBunchForRingOrientationTestOddEven_(a)}processBunchForRingOrientationTestOddEven_(a){var b=
!1;this.m_edges||(this.m_edges=new Ln(this.m_shape));this.m_unknownNodes.length=0;this.processBunchForRingOrientationRemoveEdges_(a);if(!this.m_AET.isAutoBalancing()){var c=0;for(let k=0,m=a.length;k<m;k++)-1!==a[k]&&c++;(10<c||4<this.m_AET.getMaxDepthEver())&&this.m_AET.enableBalancing()}for(let k=0,m=a.length;k<m;k++)c=a[k],-1!==c&&this.insertEdge_(c,-1);for(a=0;a<this.m_unknownNodes.length&&0<this.m_unknownRingOrientationCount;a++){c=this.m_unknownNodes[a];var d=this.m_AET.getElement(c),e=this.m_edges.getPath(d);
d=-1;if(0===this.m_shape.getPathUserIndex(e,this.m_pathOrientationIndex)){e=this.m_AET.getPrev(c);for(var f=c,g=!1;e!==R.st_nullNode();){g=this.m_AET.getElement(e);g=this.m_edges.getPath(g);if(0!==this.m_shape.getPathUserIndex(g,this.m_pathOrientationIndex)){d=g;break}f=e;e=this.m_AET.getPrev(e)}e===R.st_nullNode()?(g=!0,e=f):(g=this.m_AET.getElement(e),g=this.m_edges.isBottomUp(g),e=this.m_AET.getNext(e),g=!g);do{var h=this.m_AET.getElement(e);f=this.m_edges.getPath(h);if(0===this.m_shape.getPathUserIndex(f,
this.m_pathOrientationIndex)&&(g!==this.m_edges.isBottomUp(h)&&(b=this.m_shape.getFirstVertex(f),this.m_shape.reverseRingInternal(b),this.m_shape.setLastVertex(f,this.m_shape.getPrevVertex(b)),b=!0),this.m_shape.setPathUserIndex(f,this.m_pathOrientationIndex,g?3:2),g||(h=this.m_shape.getPathUserIndex(d,this.m_pathOrientationIndex),2===h&&(d=this.m_shape.getPathUserIndex(d,this.m_pathParentsIndex),h=this.m_shape.getPathUserIndex(d,this.m_pathOrientationIndex)),p.geometryReleaseAssert(3===h),h=this.m_shape.getPathUserIndex(d,
this.m_pathParentageIndex),this.m_shape.setPathUserIndex(d,this.m_pathParentageIndex,f),this.m_shape.setPathUserIndex(f,this.m_pathParentageIndex,h),this.m_shape.setPathUserIndex(f,this.m_pathParentsIndex,d)),this.m_unknownRingOrientationCount--,!this.m_unknownRingOrientationCount))return b;d=f;f=e;e=this.m_AET.getNext(e);g=!g}while(f!==c)}}return b}processBunchForRingOrientationRemoveEdges_(a){for(let c=0,d=a.length;c<d;c++){const e=a[c],f=this.m_shape.getUserIndex(e,this.m_node1UserIndex),g=this.m_shape.getUserIndex(e,
this.m_node2UserIndex);if(-1!==f){var b=this.m_AET.getElement(f);this.m_edges.freeEdge(b);this.m_shape.setUserIndex(e,this.m_node1UserIndex,-1)}-1!==g&&(b=this.m_AET.getElement(g),this.m_edges.freeEdge(b),this.m_shape.setUserIndex(e,this.m_node2UserIndex,-1));b=-1;-1!==f&&-1!==g?(this.m_AET.deleteNode(f),this.m_AET.deleteNode(g),a[c]=-1):b=-1!==f?f:g;-1!==b&&(this.insertEdge_(e,b)||this.m_AET.deleteNode(b),a[c]=-1)}}dbgVerifyRingOrientation_(){}insertEdge_(a,b){var c=l.Point2D.getNAN();const d=l.Point2D.getNAN();
this.m_shape.queryXY(a,c);var e=this.m_shape.getNextVertex(a);this.m_shape.queryXY(e,d);let f=!1;if(c.y<d.y){f=!0;const h=this.m_edges.newEdge(a);if(-1===b)var g=this.m_AET.addElement(h);else g=b,this.m_AET.setElement(g,h);-1===this.m_shape.getUserIndex(e,this.m_node1UserIndex)?this.m_shape.setUserIndex(e,this.m_node1UserIndex,g):this.m_shape.setUserIndex(e,this.m_node2UserIndex,g);e=this.m_shape.getPathFromVertex(a);0===this.m_shape.getPathUserIndex(e,this.m_pathOrientationIndex)&&this.m_unknownNodes.push(g)}g=
this.m_shape.getPrevVertex(a);this.m_shape.queryXY(g,d);c.y<d.y&&(f=!0,c=this.m_edges.newEdge(g),-1===b?b=this.m_AET.addElement(c):this.m_AET.setElement(b,c),-1===this.m_shape.getUserIndex(g,this.m_node1UserIndex)?this.m_shape.setUserIndex(g,this.m_node1UserIndex,b):this.m_shape.setUserIndex(g,this.m_node2UserIndex,b),a=this.m_shape.getPathFromVertex(a),0===this.m_shape.getPathUserIndex(a,this.m_pathOrientationIndex)&&this.m_unknownNodes.push(b));return f}fixRingSelfTangency_(){const a=[],b=[];let c=
-1,d=-1;var e=new l.Point2D,f=-1,g=-1,h=-1,k=new Nl(this);for(var m=k.next();-1!==m;m=k.next()){var n=new l.Point2D;this.m_shape.queryXY(m,n);const q=this.m_shape.getPathFromVertex(m);e.equals(n)&&g===q?(-1===d&&(c=this.m_shape.createPathUserIndex(),this.m_shape.fillPathUserIndexForGeometry(this.m_geometry,c,-1),d=this.m_shape.createUserIndex(),this.m_shape.fillUserIndexForGeometry(this.m_geometry,d,-1)),-1===h&&(h=b.length,this.m_shape.setUserIndex(f,d,h),b.push(1),-1===this.m_shape.getPathUserIndex(q,
c)&&(this.m_shape.setPathUserIndex(q,c,f),a.push(q))),this.m_shape.setUserIndex(m,d,h),b[b.length-1]++):(h=-1,e.assign(n));f=m;g=q}if(0===a.length)return!1;p.geometryReleaseAssert(-1!==c);for(let q=0,r=a.length;q<r;q++)for(e=this.m_shape.getPathUserIndex(a[q],c),h=this.m_shape.getUserIndex(e,d),f=[],g=[],f.push(e),g.push(h),h=this.m_shape.getNextVertex(e);h!==e;h=this.m_shape.getNextVertex(h))k=h,m=this.m_shape.getUserIndex(k,d),-1!==m&&(0===g.length?(g.push(m),f.push(k)):g.at(-1)===m?(n=f.at(-1),
this.m_shape.peelALoopIntoAPath(n,k),this.m_shape.setUserIndex(h,d,-1),b[m]--,1===b[m]&&(b[m]=0,g.pop(),f.pop()),h=e=n):(f.push(h),g.push(m)));this.m_shape.removePathUserIndex(c);this.m_shape.removeUserIndex(d);this.m_shape.dbgVerifyVertexCounts();return!0}progress_(a){}fixRingOrientationImplMain_(){const a={stack:[],error:void 0,hasError:!1};try{let c=!1;const d=Ka.__addDisposableResource(a,l.makeScopedCall(()=>{this.m_sortedVerticesArray=null}),!1);if(null===this.m_sortedVertices){const g=this.m_shape.getPointCount(this.m_geometry);
var b=new za(0);for(let h=this.m_shape.getFirstPath(this.m_geometry);-1!==h;h=this.m_shape.getNextPath(h)){let k=this.m_shape.getFirstVertex(h);for(let m=0,n=this.m_shape.getPathSize(h);m<n;m++)b.add(k),k=this.m_shape.getNextVertex(k)}this.m_shape.sortVerticesSimpleByY(b,0,g);this.progress_(!0);this.m_sortedVerticesArray=b}else d.bForget=!0;this.m_bFixSelfTangency&&(c=this.fixRingSelfTangency_());if(1===this.m_shape.getPathCount(this.m_geometry)){const g=this.m_shape.getFirstPath(this.m_geometry),
h=this.m_shape.getRingArea(g);this.m_shape.setExterior(g,!0);if(0>h){const k=this.m_shape.getFirstVertex(g);this.m_shape.reverseRingInternal(k);this.m_shape.setLastVertex(g,this.m_shape.getPrevVertex(k));return!0}return!1}this.m_shape.dbgVerifyCurves();this.m_pathOrientationIndex=this.m_shape.createPathUserIndex();this.m_pathParentageIndex=this.m_shape.createPathUserIndex();this.m_pathParentsIndex=this.m_shape.createPathUserIndex();for(let g=this.m_shape.getFirstPath(this.m_geometry);-1!==g;g=this.m_shape.getNextPath(g))this.m_shape.setPathUserIndex(g,
this.m_pathOrientationIndex,0),this.m_shape.setPathUserIndex(g,this.m_pathParentageIndex,-1),this.m_shape.setPathUserIndex(g,this.m_pathParentsIndex,-1);b=[];this.m_yScanline=Number.NaN;const e=l.Point2D.getNAN();this.m_unknownRingOrientationCount=this.m_shape.getPathCount(this.m_geometry);this.m_node1UserIndex=this.m_shape.createUserIndexUninitialized();this.m_shape.fillUserIndexForGeometry(this.m_geometry,this.m_node1UserIndex,-1);this.m_node2UserIndex=this.m_shape.createUserIndexUninitialized();
this.m_shape.fillUserIndexForGeometry(this.m_geometry,this.m_node2UserIndex,-1);const f=new Nl(this);for(let g=f.next();-1!==g&&(this.progress_(),this.m_shape.queryXY(g,e),e.y!==this.m_yScanline&&b.length&&(c=this.processBunchForRingOrientationTest_(b)||c,this.m_sweepComparator.reset(),b.length=0),b.push(g),this.m_yScanline=e.y,0!==this.m_unknownRingOrientationCount);g=f.next());0<this.m_unknownRingOrientationCount&&(c=this.processBunchForRingOrientationTest_(b)||c,b.length=0);this.m_shape.removeUserIndex(this.m_node1UserIndex);
this.m_shape.removeUserIndex(this.m_node2UserIndex);this.dbgVerifyRingOrientation_();return c}catch(c){a.error=c,a.hasError=!0}finally{Ka.__disposeResources(a)}}fixRingOrientationImplSimplify_(){const a=[];for(var b=this.m_shape.getFirstPath(this.m_geometry);-1!==b;)if(this.progress_(),3===this.m_shape.getPathUserIndex(b,this.m_pathOrientationIndex)){this.m_shape.setExterior(b,!0);for(var c=this.m_shape.getPathUserIndex(b,this.m_pathParentageIndex);-1!==c;){var d=this.m_shape.getPathUserIndex(c,this.m_pathParentageIndex);
a.push(c);this.m_shape.setExterior(c,!1);this.m_shape.setPathUserIndex(c,this.m_pathParentageIndex,b);c=d}c=b;d=a.length;for(let e=this.m_shape.getNextPath(b);0<d&&-1!==e;e=this.m_shape.getNextPath(e),--d)if(this.m_shape.getPathUserIndex(e,this.m_pathParentageIndex)===b)c=e;else{c=-1;break}if(0!==d){c=b;for(let e=0,f=a.length;e<f;e++)b=a[e],this.m_shape.setPathUserIndex(b,this.m_pathParentageIndex,-559038737),this.m_shape.movePath(this.m_geometry,this.m_shape.getNextPath(c),b),c=b}a.length=0;b=this.m_shape.getNextPath(c)}else b=
this.m_shape.getNextPath(b);this.m_shape.removePathUserIndex(this.m_pathOrientationIndex);this.m_shape.removePathUserIndex(this.m_pathParentageIndex);this.m_shape.removePathUserIndex(this.m_pathParentsIndex)}fixRingOrientationImplMp2sp_(){const a=this.m_shape.createPathUserIndex();var b=0;const c=[];for(let f=this.m_shape.getFirstPath(this.m_geometry);-1!==f;)if(this.progress_(),3===this.m_shape.getPathUserIndex(f,this.m_pathOrientationIndex)){this.m_shape.setExterior(f,!0);this.m_shape.setPathUserIndex(f,
a,b);b++;for(var d=this.m_shape.getPathUserIndex(f,this.m_pathParentageIndex);-1!==d;){var e=this.m_shape.getPathUserIndex(d,this.m_pathParentageIndex);c.push(d);this.m_shape.setExterior(d,!1);this.m_shape.setPathUserIndex(d,this.m_pathParentageIndex,f);d=e}e=f;let g=c.length;d=b;for(let h=this.m_shape.getNextPath(f);0<g&&-1!==h;h=this.m_shape.getNextPath(h),--g)if(this.m_shape.getPathUserIndex(h,this.m_pathParentageIndex)===f)e=h,this.m_shape.setPathUserIndex(h,a,-d),d++;else{e=-1;break}if(0!==g){e=
f;d=b;for(let h=0,k=c.length;h<k;h++)b=c[h],this.m_shape.setPathUserIndex(b,a,-d),d++,this.m_shape.setPathUserIndex(b,this.m_pathParentageIndex,-559038737);e=f}b=d;c.length=0;f=this.m_shape.getNextPath(e)}else f=this.m_shape.getNextPath(f);this.m_shape.removePathUserIndex(this.m_pathOrientationIndex);this.m_shape.removePathUserIndex(this.m_pathParentageIndex);this.m_shape.removePathUserIndex(this.m_pathParentsIndex);return a}}class Em{constructor(a){this.m_shape=null;this.m_geometry=-1;this.m_sortedVertices=
new ab;this.m_bunchEdgeEndPoints=[];this.m_bunchEdgeCenterPoints=[];this.m_bunchEdgeIndices=[];this.m_firstCoincidentVertex=this.m_nextVertexToProcess=this.m_userIndexSortedAngleIndexToVertex=this.m_userIndexSortedIndexToVertex=this.m_polylineDegeneracies=this.m_sortedVerticesListIndex=this.m_knownSimpleResult=-1;this.m_progressCounter=0;this.m_bHasSegments=this.m_bHasSegmentParentage=this.m_bFixSelfTangency=!1;this.m_progressTracker=a}compareAngles_(a,b){if(this.m_bHasSegments)return this.compareAnglesCurves_(a,
b);var c=this.m_bunchEdgeEndPoints[a],d=new l.Point2D;this.m_shape.queryXY(c,d);c=new l.Point2D;this.m_shape.queryXY(this.m_bunchEdgeEndPoints[b],c);if(d.equals(c))return 0;var e=this.m_bunchEdgeCenterPoints[a];a=new l.Point2D;this.m_shape.queryXY(e,a);e=this.m_bunchEdgeCenterPoints[b];b=new l.Point2D;this.m_shape.queryXY(e,b);e=new l.Point2D;e.setSub(d,a);d=new l.Point2D;d.setSub(c,b);(e.isZero()||d.isZero())&&p.throwNonSimpleGeometryException("");return l.Point2D.compareVectors(e,d)}compareAnglesCurves_(a,
b){var c=this.m_bunchEdgeEndPoints[a];const d=this.m_bunchEdgeEndPoints[b];a=this.m_bunchEdgeCenterPoints[a];b=this.m_bunchEdgeCenterPoints[b];const e=this.m_shape.getNextVertex(a)===c,f=this.m_shape.getNextVertex(b)===d,g=new W,h=new l.Point2D;e?(this.m_shape.querySegment(a,g,!1,!0),h.assign(g.get().getTangent(0))):(this.m_shape.querySegment(c,g,!1,!0),h.assign(g.get().getTangent(1)),h.negateThis());c=new l.Point2D;f?(this.m_shape.querySegment(b,g,!1,!0),c.assign(g.get().getTangent(0))):(this.m_shape.querySegment(d,
g,!1,!0),c.assign(g.get().getTangent(1)),c.negateThis());(h.isZero()||c.isZero())&&p.throwNonSimpleGeometryException("");return l.Point2D.compareVectors(h,c)}beforeRemoveVertex_(a,b){var c=this.m_shape.getUserIndex(a,this.m_userIndexSortedIndexToVertex);this.m_nextVertexToProcess===c&&(this.m_nextVertexToProcess=this.m_sortedVertices.getNext(this.m_nextVertexToProcess));this.m_firstCoincidentVertex===c&&(this.m_firstCoincidentVertex=this.m_sortedVertices.getNext(this.m_firstCoincidentVertex));this.m_sortedVertices.deleteElement(this.m_sortedVerticesListIndex,
c);this.removeAngleSortInfo_(a);if(b&&(b=this.m_shape.getPathFromVertex(a),-1!==b&&this.m_shape.getFirstVertex(b)===a)){c=this.m_shape.getNextVertex(a);if(c!==a){if(this.m_shape.getPathFromVertex(c)===b){this.m_shape.setFirstVertex(b,c);return}c=this.m_shape.getPrevVertex(a);if(c!==a&&this.m_shape.getPathFromVertex(c)===b){this.m_shape.setFirstVertex(b,c);return}}this.m_shape.setFirstVertex(b,-1);this.m_shape.setLastVertex(b,-1)}}processBunch_(){let a=!1;const b=new l.Point2D(0,0);for(;;){this.m_bunchEdgeEndPoints.length=
0;this.m_bunchEdgeCenterPoints.length=0;this.m_bunchEdgeIndices.length=0;var c=this.m_firstCoincidentVertex,d=0;let e=!0;for(;c!==this.m_nextVertexToProcess;){const f=this.m_sortedVertices.getData(c);e&&(this.m_shape.queryXY(f,b),e=!1);const g=this.m_shape.getPrevVertex(f),h=this.m_shape.getNextVertex(f);-559038737!==this.m_shape.getUserIndex(g,this.m_userIndexSortedAngleIndexToVertex)&&(this.m_bunchEdgeEndPoints.push(g),this.m_shape.setUserIndex(g,this.m_userIndexSortedAngleIndexToVertex,-559038737),
this.m_bunchEdgeCenterPoints.push(f),this.m_bunchEdgeIndices.push(d++));-559038737!==this.m_shape.getUserIndex(h,this.m_userIndexSortedAngleIndexToVertex)&&(this.m_bunchEdgeEndPoints.push(h),this.m_shape.setUserIndex(h,this.m_userIndexSortedAngleIndexToVertex,-559038737),this.m_bunchEdgeCenterPoints.push(f),this.m_bunchEdgeIndices.push(d++));c=this.m_sortedVertices.getNext(c)}if(2>this.m_bunchEdgeEndPoints.length){1===this.m_bunchEdgeEndPoints.length&&this.m_shape.setUserIndex(this.m_bunchEdgeEndPoints[0],
this.m_userIndexSortedAngleIndexToVertex,-1);break}this.m_bunchEdgeIndices.sort((f,g)=>this.compareAngles_(f,g));for(let f=0,g=this.m_bunchEdgeIndices.length;f<g;f++)this.m_shape.setUserIndex(this.m_bunchEdgeEndPoints[this.m_bunchEdgeIndices[f]],this.m_userIndexSortedAngleIndexToVertex,f);c=this.processCrossOvers_(b);for(let f=0,g=this.m_bunchEdgeIndices.length;f<g;f++)d=this.m_bunchEdgeIndices[f],-1!==d&&this.m_shape.setUserIndex(this.m_bunchEdgeEndPoints[d],this.m_userIndexSortedAngleIndexToVertex,
-1);if(c)a=!0;else break}return a}processCrossOvers_(a){let b=!1;for(var c=!0;c;){c=!1;var d=0;-1===this.m_bunchEdgeIndices[d]&&(d=this.getNextEdgeIndex_(d));var e=this.getNextEdgeIndex_(d);for(let r=0,t=this.m_bunchEdgeIndices.length;r<t&&-1!==d&&-1!==e&&d!==e;r++){var f=this.m_bunchEdgeEndPoints[this.m_bunchEdgeIndices[d]],g=this.m_bunchEdgeEndPoints[this.m_bunchEdgeIndices[e]],h=this.m_shape.getNextVertex(f),k=!1;this.m_shape.isEqualXYPoint2D(h,a)||(h=this.m_shape.getPrevVertex(f),k=!0);var m=
this.m_shape.getNextVertex(g),n=!1;this.m_shape.isEqualXYPoint2D(m,a)||(m=this.m_shape.getPrevVertex(g),n=!0);var q=k?this.m_shape.getPrevVertex(h):this.m_shape.getNextVertex(h);const u=n?this.m_shape.getPrevVertex(m):this.m_shape.getNextVertex(m);let v=!1;this.removeSpike_(h)?v=!0:this.removeSpike_(m)?v=!0:this.removeSpike_(f)?v=!0:this.removeSpike_(g)?v=!0:this.removeSpike_(q)?v=!0:this.removeSpike_(u)&&(v=!0);h!==m&&(!v&&this.m_shape.isEqualXY(f,g)&&(v=this.resolveOverlap_(k,n,h,f,m,g)),!v&&this.m_shape.isEqualXY(q,
u)&&(v=this.resolveOverlap_(!k,!n,h,q,m,u)),!v&&this.m_shape.isEqualXY(f,u)&&(v=this.resolveOverlap_(k,!n,h,f,m,u)),!v&&this.m_shape.isEqualXY(q,g)&&(v=this.resolveOverlap_(!k,n,h,q,m,g)));v&&(b=!0);c||=v;d=v?this.getNextEdgeIndex_(d):e;e=this.getNextEdgeIndex_(d)}}if(!b){c=0;-1===this.m_bunchEdgeIndices[c]&&(c=this.getNextEdgeIndex_(c));d=this.getNextEdgeIndex_(c);for(let r=0,t=this.m_bunchEdgeIndices.length;r<t&&-1!==c&&-1!==d&&c!==d;r++)e=this.m_bunchEdgeEndPoints[this.m_bunchEdgeIndices[c]],f=
this.m_bunchEdgeEndPoints[this.m_bunchEdgeIndices[d]],g=this.m_shape.getNextVertex(e),this.m_shape.isEqualXYPoint2D(g,a)||(g=this.m_shape.getPrevVertex(e)),h=this.m_shape.getNextVertex(f),this.m_shape.isEqualXYPoint2D(h,a)||(h=this.m_shape.getPrevVertex(f)),k=this.getDirection_(g,e),m=this.getDirection_(h,f),n=k?this.m_shape.getPrevVertex(g):this.m_shape.getNextVertex(g),q=m?this.m_shape.getPrevVertex(h):this.m_shape.getNextVertex(h),e=this.detectAndResolveCrossOver_(k,m,e,g,n,f,h,q),1===e?b=!0:(c=
0===e?this.getNextEdgeIndex_(c):this.getPrevEdgeIndex_(c),d=this.getNextEdgeIndex_(c))}return b}simplify_(){this.m_shape.getGeometryType(this.m_geometry)===p.GeometryType.enumPolygon&&1===this.m_shape.getFillRule(this.m_geometry)&&(new yb(this.m_progressTracker)).planarSimplifyNoCrackingAndCluster(this.m_bFixSelfTangency,this.m_shape,this.m_geometry,0);let a=!1;this.m_userIndexSortedAngleIndexToVertex=this.m_userIndexSortedIndexToVertex=-1;this.m_userIndexSortedAngleIndexToVertex=this.m_shape.createUserIndexUninitialized();
var b=this.m_shape.getPointCount(this.m_geometry),c=new za(0);this.m_shape.dbgVerifyMonotone();for(var d=this.m_shape.getFirstPath(this.m_geometry);-1!==d;d=this.m_shape.getNextPath(d)){var e=this.m_shape.getFirstVertex(d);for(let h=0,k=this.m_shape.getPathSize(d);h<k;h++)this.m_shape.setUserIndex(e,this.m_userIndexSortedAngleIndexToVertex,-1),c.add(e),e=this.m_shape.getNextVertex(e)}this.m_shape.sortVerticesSimpleByY(c,0,b);this.progress_(!0);this.m_userIndexSortedIndexToVertex=this.m_shape.createUserIndexUninitialized();
this.m_sortedVertices.reserveNodes(b);this.m_sortedVerticesListIndex=this.m_sortedVertices.createList(0);for(d=0;d<b;d++){e=c.read(d);var f=this.m_sortedVertices.addElement(this.m_sortedVerticesListIndex,e);this.m_shape.setUserIndex(e,this.m_userIndexSortedIndexToVertex,f)}this.m_nextVertexToProcess=-1;this.cleanupSpikes_()&&(a=!0);b=0;c=!1;do{c=!1;this.m_nextVertexToProcess=-1;this.m_firstCoincidentVertex=this.m_sortedVertices.getFirst(this.m_sortedVerticesListIndex);d=new l.Point2D(0,0);this.m_firstCoincidentVertex!==
ab.st_nullNode()&&this.m_shape.queryXY(this.m_sortedVertices.getData(this.m_firstCoincidentVertex),d);var g=0;for(e=this.m_firstCoincidentVertex;e!==ab.st_nullNode();){e=this.m_sortedVertices.getNext(e);if(e===ab.st_nullNode())break;this.progress_();const h=this.m_sortedVertices.getData(e);f=l.Point2D.getNAN();this.m_shape.queryXY(h,f);d.equals(f)?g++:(0<g&&(this.m_nextVertexToProcess=e,g=this.processBunch_(),e=this.m_nextVertexToProcess,e!==ab.st_nullNode()&&this.m_shape.queryXY(this.m_sortedVertices.getData(e),
f),g&&(c=!0)),d.setCoordsPoint2D(f),this.m_firstCoincidentVertex=e,g=0)}this.m_nextVertexToProcess=-1;0<g&&this.processBunch_()&&(c=!0);10<b++&&p.throwInternalErrorException("");c&&this.fixOrphanVertices_();this.cleanupSpikes_()&&(c=!0);a||=c}while(c);this.m_shape.dbgVerifyMonotone();this.m_shape.dbgVerifyCurves();this.m_shape.removeUserIndex(this.m_userIndexSortedIndexToVertex);this.m_shape.removeUserIndex(this.m_userIndexSortedAngleIndexToVertex);b=this.m_shape;c=this.m_geometry;d=this.m_sortedVertices;
e=this.m_bFixSelfTangency;f=new Ol(this.m_progressTracker);f.m_shape=b;f.m_geometry=c;f.m_sortedVertices=d;f.m_bFixSelfTangency=e;a=f.fixRingOrientation_()||a;this.m_shape.dbgVerifyCurves();return a}getDirection_(a,b){return this.m_shape.getNextVertex(b)===a?!1:!0}detectAndResolveCrossOver_(a,b,c,d,e,f,g,h){if(d===g)return this.removeAngleSortInfo_(c),this.removeAngleSortInfo_(f),-1;var k=this.m_shape.getUserIndex(c,this.m_userIndexSortedAngleIndexToVertex),m=this.m_shape.getUserIndex(e,this.m_userIndexSortedAngleIndexToVertex),
n=this.m_shape.getUserIndex(f,this.m_userIndexSortedAngleIndexToVertex),q=this.m_shape.getUserIndex(h,this.m_userIndexSortedAngleIndexToVertex);c=Array(8);var r=Array(4);c[0]=0;r[0]=k;c[1]=0;r[1]=m;c[2]=1;r[2]=n;c[3]=1;r[3]=q;for(k=1;4>k;k++){m=r[k];n=c[k];for(q=k-1;0<=q&&r[q]>m;)r[q+1]=r[q],c[q+1]=c[q],q--;r[q+1]=m;c[q+1]=n}r=0;c[0]&&(r|=1);c[1]&&(r|=2);c[2]&&(r|=4);c[3]&&(r|=8);if(5!==r&&10!==r)return 0;a!==b&&(h=l.swap(f,f=h));a?(this.m_shape.setNextVertex(h,d),this.m_shape.setPrevVertex(d,h),
this.m_shape.setNextVertex(e,g),this.m_shape.setPrevVertex(g,e),this.m_bHasSegmentParentage&&(this.m_shape.setSegmentParentageBreakVertex(d,!0),this.m_shape.setSegmentParentageBreakVertex(g,!0))):(this.m_shape.setPrevVertex(h,d),this.m_shape.setNextVertex(d,h),this.m_shape.setPrevVertex(e,g),this.m_shape.setNextVertex(g,e),this.m_bHasSegmentParentage&&(a=this.m_shape.getSegmentParentage(d),b=this.m_shape.getSegmentParentage(g),this.m_shape.setSegmentParentageAndBreak(d,b,!0),this.m_shape.setSegmentParentageAndBreak(g,
a,!0)),this.m_bHasSegments&&(d=this.m_shape.getVertexIndex(d),g=this.m_shape.getVertexIndex(g),a=this.m_shape.getSegmentFromIndex(d),this.m_shape.setSegmentToIndex(d,null),b=this.m_shape.getSegmentFromIndex(g),this.m_shape.setSegmentToIndex(g,null),this.m_shape.setSegmentToIndex(d,b),this.m_shape.setSegmentToIndex(g,a)));return 1}resolveOverlap_(a,b,c,d,e,f){return this.resolveOverlapOddEven_(a,b,c,d,e,f)}resolveOverlapOddEven_(a,b,c,d,e,f){if(a!==b){a||(e=l.swap(c,c=e),f=l.swap(d,d=f));var g=this.m_shape.getNextVertex(e),
h=this.m_shape.getNextVertex(c);this.m_shape.setNextVertex(c,g);this.m_shape.setPrevVertex(g,c);this.m_shape.setNextVertex(e,h);this.m_shape.setPrevVertex(h,e);this.m_bHasSegments&&(g=this.m_shape.getVertexIndex(c),h=this.m_shape.getVertexIndex(e),b=this.m_shape.getSegmentFromIndex(g),this.m_shape.setSegmentToIndex(g,null),a=this.m_shape.getSegmentFromIndex(h),this.m_shape.setSegmentToIndex(h,null),this.m_shape.setSegmentToIndex(g,a),this.m_shape.setSegmentToIndex(h,b));this.m_bHasSegmentParentage&&
(g=this.m_shape.getSegmentParentage(c),h=this.m_shape.getSegmentParentage(e),this.m_shape.setSegmentParentageAndBreak(c,h,!0),this.m_shape.setSegmentParentageAndBreak(e,g,!0),this.m_shape.setSegmentParentageBreakVertex(d,!0),this.m_shape.setSegmentParentageBreakVertex(f,!0));this.removeSpike_(e)}else{g=a?c:d;h=b?e:f;c=a?d:c;e=b?f:e;d=null;this.m_bHasSegments&&(f=this.m_shape.getVertexIndex(e),d=this.m_shape.getSegmentFromIndex(f),this.m_shape.setSegmentToIndex(f,null),f=this.m_shape.getVertexIndex(h),
this.m_shape.setSegmentToIndex(f,null),f=this.m_shape.getVertexIndex(g),this.m_shape.setSegmentToIndex(f,null));b=-1;this.m_bHasSegmentParentage&&(b=this.m_shape.getSegmentParentage(e));f=!1;this.m_shape.setNextVertex(g,h);this.m_shape.setNextVertex(h,g);this.m_shape.setPrevVertex(c,e);this.m_shape.setPrevVertex(e,c);for(var k=e;k!==h;){var m=this.m_shape.getPrevVertex(k);a=this.m_shape.getNextVertex(k);this.m_shape.setPrevVertex(k,a);this.m_shape.setNextVertex(k,m);f||=k===g;this.m_bHasSegments&&
k!==g&&(k=this.m_shape.getVertexIndex(a),m=d,d=this.m_shape.getSegmentFromIndex(k),null!==m&&m.reverse(),this.m_shape.setSegmentToIndex(k,m));this.m_bHasSegmentParentage&&(k=this.m_shape.getSegmentParentage(a),this.m_shape.setSegmentParentagePreserveBreak(a,b),b=k);k=a}d=null;f||(b=this.m_shape.getPrevVertex(h),a=this.m_shape.getNextVertex(h),this.m_shape.setPrevVertex(h,a),this.m_shape.setNextVertex(h,b),this.m_bHasSegments&&(b=this.m_shape.getVertexIndex(h),d=this.m_shape.getSegmentFromIndex(b),
this.m_shape.setSegmentToIndex(b,null)));a=b=-1;this.m_bHasSegmentParentage&&(b=f?this.m_shape.getSegmentParentage(g):this.m_shape.getSegmentParentage(h),a=this.m_shape.getSegmentParentage(c));this.transferVertexData_(h,g);this.beforeRemoveVertex_(h,!0);this.m_shape.removeVertexInternal(h,!0);this.removeAngleSortInfo_(g);this.transferVertexData_(e,c);this.beforeRemoveVertex_(e,!0);this.m_shape.removeVertexInternal(e,!0);this.removeAngleSortInfo_(c);this.m_bHasSegmentParentage&&(this.m_shape.setSegmentParentageAndBreak(g,
b,!0),this.m_shape.setSegmentParentageAndBreak(c,a,!0));d&&(g=this.m_shape.getVertexIndex(g),this.m_shape.setSegmentToIndex(g,d))}return!0}cleanupSpikes_(){let a=!1;for(let b=this.m_shape.getFirstPath(this.m_geometry);-1!==b;){const c=this.m_shape.getNextPath(b);let d=this.m_shape.getFirstVertex(b);for(let e=0,f=this.m_shape.getPathSize(b);e<f&&1<f;){this.progress_();const {v:g,bModified:h}=this.checkAndCleanupSpike_(b,d);if(-1===g)break;h?(a=!0,d=g,e=0,f=this.m_shape.getPathSize(b)):(d=g,e++)}b=
c}return a}checkAndCleanupSpike_(a,b){const c={v:-1,bModified:!1};var d=this.m_shape.getPrevVertex(b);let e=this.m_shape.getNextVertex(b),f=-1,g=-1;for(;this.m_shape.isEqualXY(d,e);){f=d;g=e;if(e===b)break;d=this.m_shape.getPrevVertex(d);e=this.m_shape.getNextVertex(e)}if(-1===f)return c.v=e,c;c.bModified=!0;for(d=this.m_shape.getNextVertex(f);this.beforeRemoveVertex_(d,!1),d!==g;d=this.m_shape.getNextVertex(d));if(f!==b)a=this.m_shape.peelALoopIntoAPath(f,g),-1!==this.m_polylineDegeneracies?this.m_shape.movePath(this.m_polylineDegeneracies,
-1,a):this.m_shape.removePath(a);else return-1!==this.m_polylineDegeneracies?this.m_shape.movePath(this.m_polylineDegeneracies,-1,a):this.m_shape.removePath(a),c.v=-1,c;return c.v=f,c}removeSpike_(a){var b=this.m_shape.getPrevVertex(a);let c=this.m_shape.getNextVertex(a),d=-1,e=-1;for(;this.m_shape.isEqualXY(b,c);){d=b;e=c;if(c===a)break;b=this.m_shape.getPrevVertex(b);c=this.m_shape.getNextVertex(c)}if(-1===d)return!1;this.m_shape.peelALoop(d,e);this.m_bHasSegmentParentage&&(this.m_shape.setSegmentParentageBreakVertex(d,
!0),this.m_shape.setSegmentParentageBreakVertex(e,!0));this.removeAngleSortInfo_(d);if(-1===this.m_polylineDegeneracies)for(a=this.m_shape.getNextVertex(e);;){b=this.m_shape.getNextVertex(a);this.removeAngleSortInfo_(a);this.beforeRemoveVertex_(a,!0);this.m_shape.setSegmentToIndex(this.m_shape.getVertexIndex(a),null);this.m_shape.removeVertexInternal(a,!1);if(a===e)break;a=b}else{for(a=e;b=this.m_shape.getNextVertex(a),this.removeAngleSortInfo_(a),this.beforeRemoveVertex_(a,!1),a=b,a!==e;);this.m_shape.insertClosedPath(this.m_polylineDegeneracies,
-1,e,e,[!1])}return!0}fixOrphanVertices_(){var a=0;for(var b=this.m_sortedVertices.getFirst(this.m_sortedVertices.getFirstList());-1!==b;b=this.m_sortedVertices.getNext(b)){var c=this.m_sortedVertices.getData(b);this.m_shape.setPathToVertex(c,-1)}b=0;for(c=this.m_shape.getFirstPath(this.m_geometry);-1!==c;){var d=this.m_shape.getFirstVertex(c);if(-1===d||-1!==this.m_shape.getPathFromVertex(d)){d=c;c=this.m_shape.getNextPath(c);this.m_shape.removePathOnly(d);continue}this.m_shape.setPathToVertex(d,
c);let e=1;for(let f=this.m_shape.getNextVertex(d);f!==d;f=this.m_shape.getNextVertex(f))this.m_shape.setPathToVertex(f,c),e++;this.m_shape.setRingAreaValid(c,!1);this.m_shape.setPathSize(c,e);this.m_shape.setLastVertex(c,this.m_shape.getPrevVertex(d));b+=e;a++;c=this.m_shape.getNextPath(c)}for(c=this.m_sortedVertices.getFirst(this.m_sortedVertices.getFirstList());-1!==c;c=this.m_sortedVertices.getNext(c))d=this.m_sortedVertices.getData(c),-1===this.m_shape.getPathFromVertex(d)&&(d=this.m_shape.insertClosedPath(this.m_geometry,
-1,d,d,[!1]),b+=this.m_shape.getPathSize(d),a++);this.m_shape.setGeometryPathCount(this.m_geometry,a);this.m_shape.setGeometryVertexCount(this.m_geometry,b);a=0;for(b=this.m_shape.getFirstGeometry();-1!==b;b=this.m_shape.getNextGeometry(b))a+=this.m_shape.getPointCount(b);this.m_shape.setTotalPointCount(a)}getNextEdgeIndex_(a){if(-1===a)return-1;for(let b=0,c=this.m_bunchEdgeIndices.length-1;b<c;b++)if(a=(a+1)%this.m_bunchEdgeIndices.length,-1!==this.m_bunchEdgeIndices[a])return a;return-1}getPrevEdgeIndex_(a){if(-1===
a)return-1;for(let b=0,c=this.m_bunchEdgeIndices.length-1;b<c;b++)if(a=(this.m_bunchEdgeIndices.length+a-1)%this.m_bunchEdgeIndices.length,-1!==this.m_bunchEdgeIndices[a])return a;return-1}transferVertexData_(a,b){const c=this.m_shape.getUserIndex(b,this.m_userIndexSortedIndexToVertex),d=this.m_shape.getUserIndex(b,this.m_userIndexSortedAngleIndexToVertex);this.m_shape.transferAllDataToTheVertex(a,b);this.m_shape.setUserIndex(b,this.m_userIndexSortedIndexToVertex,c);this.m_shape.setUserIndex(b,this.m_userIndexSortedAngleIndexToVertex,
d)}removeAngleSortInfo_(a){const b=this.m_shape.getUserIndex(a,this.m_userIndexSortedAngleIndexToVertex);-1!==b&&(this.m_bunchEdgeIndices[b]=-1,this.m_shape.setUserIndex(a,this.m_userIndexSortedAngleIndexToVertex,-1))}progress_(a){}}class $b{nullFunc(){p.geometryReleaseAssert(0);return!1}constructor(){this.m_visitedIndex=this.m_clusterIndexB=this.m_clusterIndexA=-1;this.m_topoGraph=new ec;this.m_matrix=l.makePrimitiveArray(9,0);this.m_maxDim=l.makePrimitiveArray(9,0);this.m_performPredicates=l.makePrimitiveArray(9,
!1);this.m_scl="";this.m_predicateCount=0;this.m_predicatesCluster=this.m_predicatesHalfEdge=this.nullFunc}resetMatrix_(){this.m_matrix.fill(-2);this.m_maxDim.fill(-2)}setPredicates_(a){this.m_scl=a;for(a=0;9>a;a++)"*"!==this.m_scl[a]?(this.m_performPredicates[a]=!0,this.m_predicateCount++):this.m_performPredicates[a]=!1}setRemainingPredicatesToFalse_(){for(let a=0;9>a;a++)this.m_performPredicates[a]&&-2===this.m_matrix[a]&&(this.m_matrix[a]=-1,this.m_performPredicates[a]=!1)}isPredicateKnown_(a){if(-2===
this.m_matrix[a])return!1;if(-1===this.m_matrix[a])return this.m_performPredicates[a]=!1,this.m_predicateCount--,!0;if("T"!==this.m_scl[a]&&"F"!==this.m_scl[a]){if(this.m_matrix[a]<this.m_maxDim[a])return!1;this.m_performPredicates[a]=!1;this.m_predicateCount--;return!0}this.m_performPredicates[a]=!1;this.m_predicateCount--;return!0}setAreaAreaPredicates_(){this.m_predicatesHalfEdge=this.areaAreaPredicates_;this.m_maxDim[0]=2;this.m_maxDim[1]=1;this.m_maxDim[2]=2;this.m_maxDim[3]=1;this.m_maxDim[4]=
1;this.m_maxDim[5]=1;this.m_maxDim[6]=2;this.m_maxDim[7]=1;this.m_maxDim[8]=2;this.m_performPredicates[8]&&(this.m_matrix[8]=2,this.m_performPredicates[8]=!1,this.m_predicateCount--)}setAreaLinePredicates_(){this.m_predicatesHalfEdge=this.areaLinePredicates_;this.m_predicatesCluster=this.areaPointPredicates_;this.m_maxDim[0]=1;this.m_maxDim[1]=0;this.m_maxDim[2]=2;this.m_maxDim[3]=1;this.m_maxDim[4]=0;this.m_maxDim[5]=1;this.m_maxDim[6]=1;this.m_maxDim[7]=0;this.m_maxDim[8]=2;this.m_performPredicates[8]&&
(this.m_matrix[8]=2,this.m_performPredicates[8]=!1,this.m_predicateCount--)}setLineLinePredicates_(){this.m_predicatesHalfEdge=this.lineLinePredicates_;this.m_predicatesCluster=this.linePointPredicates_;this.m_maxDim[0]=1;this.m_maxDim[1]=0;this.m_maxDim[2]=1;this.m_maxDim[3]=0;this.m_maxDim[4]=0;this.m_maxDim[5]=0;this.m_maxDim[6]=1;this.m_maxDim[7]=0;this.m_maxDim[8]=2;this.m_performPredicates[8]&&(this.m_matrix[8]=2,this.m_performPredicates[8]=!1,this.m_predicateCount--)}setAreaPointPredicates_(){this.m_predicatesCluster=
this.areaPointPredicates_;this.m_maxDim[0]=0;this.m_maxDim[1]=-1;this.m_maxDim[2]=2;this.m_maxDim[3]=0;this.m_maxDim[4]=-1;this.m_maxDim[5]=1;this.m_maxDim[6]=0;this.m_maxDim[7]=-1;this.m_maxDim[8]=2;this.m_performPredicates[1]&&(this.m_matrix[1]=-1,this.m_performPredicates[1]=!1,this.m_predicateCount--);this.m_performPredicates[4]&&(this.m_matrix[4]=-1,this.m_performPredicates[4]=!1,this.m_predicateCount--);this.m_performPredicates[7]&&(this.m_matrix[7]=-1,this.m_performPredicates[7]=!1,this.m_predicateCount--);
this.m_performPredicates[8]&&(this.m_matrix[8]=2,this.m_performPredicates[8]=!1,this.m_predicateCount--)}setLinePointPredicates_(){this.m_predicatesCluster=this.linePointPredicates_;this.m_maxDim[0]=0;this.m_maxDim[1]=-1;this.m_maxDim[2]=1;this.m_maxDim[3]=0;this.m_maxDim[4]=-1;this.m_maxDim[5]=0;this.m_maxDim[6]=0;this.m_maxDim[7]=-1;this.m_maxDim[8]=2;this.m_performPredicates[1]&&(this.m_matrix[1]=-1,this.m_performPredicates[1]=!1,this.m_predicateCount--);this.m_performPredicates[4]&&(this.m_matrix[4]=
-1,this.m_performPredicates[4]=!1,this.m_predicateCount--);this.m_performPredicates[7]&&(this.m_matrix[7]=-1,this.m_performPredicates[7]=!1,this.m_predicateCount--);this.m_performPredicates[8]&&(this.m_matrix[8]=2,this.m_performPredicates[8]=!1,this.m_predicateCount--)}setPointPointPredicates_(){this.m_predicatesCluster=this.pointPointPredicates_;this.m_maxDim[0]=0;this.m_maxDim[1]=-1;this.m_maxDim[2]=0;this.m_maxDim[3]=-1;this.m_maxDim[4]=-1;this.m_maxDim[5]=-1;this.m_maxDim[6]=0;this.m_maxDim[7]=
-1;this.m_maxDim[8]=2;this.m_performPredicates[1]&&(this.m_matrix[1]=-1,this.m_performPredicates[1]=!1,this.m_predicateCount--);this.m_performPredicates[3]&&(this.m_matrix[3]=-1,this.m_performPredicates[3]=!1,this.m_predicateCount--);this.m_performPredicates[4]&&(this.m_matrix[4]=-1,this.m_performPredicates[4]=!1,this.m_predicateCount--);this.m_performPredicates[5]&&(this.m_matrix[5]=-1,this.m_performPredicates[5]=!1,this.m_predicateCount--);this.m_performPredicates[7]&&(this.m_matrix[7]=-1,this.m_performPredicates[7]=
!1,this.m_predicateCount--);this.m_performPredicates[8]&&(this.m_matrix[8]=2,this.m_performPredicates[8]=!1,this.m_predicateCount--)}areaAreaDisjointPredicates_(a,b){this.m_matrix[0]=-1;this.m_matrix[1]=-1;this.m_matrix[3]=-1;this.m_matrix[4]=-1;this.areaGeomContainsOrDisjointPredicates_(a,this.m_performPredicates[2]?2:-1,this.m_scl[2],this.m_performPredicates[5]?5:-1,this.m_scl[5]);this.areaGeomContainsOrDisjointPredicates_(b,this.m_performPredicates[6]?6:-1,this.m_scl[6],this.m_performPredicates[7]?
7:-1,this.m_scl[7])}areaGeomContainsOrDisjointPredicates_(a,b,c,d,e){const f=-1!==b,g=-1!==d;if(f||g)("T"!==c&&"F"!==c&&f||"T"!==e&&"F"!==e&&g?0!==a.calculateArea2D():1)?(f&&(this.m_matrix[b]=2),g&&(this.m_matrix[d]=1)):(g&&(this.m_matrix[d]=-1),f&&(c=D.constructEmpty(),a.queryEnvelope(c),this.m_matrix[b]=c.height()||c.width()?1:0))}areaAreaContainsPredicates_(a){p.geometryReleaseAssert(0)}areaAreaWithinPredicates_(a){p.geometryReleaseAssert(0)}areaLineDisjointPredicates_(a,b){this.m_matrix[0]=-1;
this.m_matrix[1]=-1;this.m_matrix[3]=-1;this.m_matrix[4]=-1;if(this.m_performPredicates[6]){var c=this.m_scl[6];c="T"!==c&&"F"!==c?0!==b.calculateLength2D():!0;this.m_matrix[6]=c?1:0}this.m_performPredicates[7]&&(rd(b)?this.m_matrix[7]=0:this.m_matrix[7]=-1);this.areaGeomContainsOrDisjointPredicates_(a,this.m_performPredicates[2]?2:-1,this.m_scl[2],this.m_performPredicates[5]?5:-1,this.m_scl[5])}areaLineContainsPredicates_(a,b){p.geometryReleaseAssert(0)}areaPointDisjointPredicates_(a){this.m_matrix[0]=
-1;this.m_matrix[3]=-1;this.m_matrix[6]=0;this.areaGeomContainsOrDisjointPredicates_(a,this.m_performPredicates[2]?2:-1,this.m_scl[2],this.m_performPredicates[5]?5:-1,this.m_scl[5])}areaPointContainsPredicates_(a){p.geometryReleaseAssert(0)}lineLineDisjointPredicates_(a,b){this.m_matrix[0]=-1;this.m_matrix[1]=-1;this.m_matrix[3]=-1;this.m_matrix[4]=-1;if(this.m_performPredicates[2]){var c=this.m_scl[2];c="T"!==c&&"F"!==c?0!==a.calculateLength2D():!0;this.m_matrix[2]=c?1:0}this.m_performPredicates[5]&&
(rd(a)?this.m_matrix[5]=0:this.m_matrix[5]=-1);this.m_performPredicates[6]&&(a=this.m_scl[6],a="T"!==a&&"F"!==a?0!==b.calculateLength2D():!0,this.m_matrix[6]=a?1:0);this.m_performPredicates[7]&&(rd(b)?this.m_matrix[7]=0:this.m_matrix[7]=-1)}linePointDisjointPredicates_(a){this.m_matrix[0]=-1;this.m_matrix[3]=-1;if(this.m_performPredicates[2]){var b=this.m_scl[2];b="T"!==b&&"F"!==b?0!==a.calculateLength2D():!0;this.m_matrix[2]=b?1:0}this.m_performPredicates[5]&&(a=rd(a),this.m_matrix[5]=a?0:-1);this.m_matrix[6]=
0}pointPointDisjointPredicates_(){this.m_matrix[0]=-1;this.m_matrix[2]=0;this.m_matrix[6]=0}areaAreaPredicates_(a,b,c){let d=!0;if(this.m_performPredicates[0]){this.interiorAreaInteriorArea_(a,b,c);var e=this.isPredicateKnown_(0);d&&=e}this.m_performPredicates[1]&&(this.interiorAreaBoundaryArea_(a,b,1),e=this.isPredicateKnown_(1),d&&=e);this.m_performPredicates[2]&&(this.interiorAreaExteriorArea_(a,b,c,2),e=this.isPredicateKnown_(2),d&&=e);this.m_performPredicates[3]&&(this.interiorAreaBoundaryArea_(a,
c,3),e=this.isPredicateKnown_(3),d&&=e);this.m_performPredicates[4]&&(this.boundaryAreaBoundaryArea_(a,b,c),e=this.isPredicateKnown_(4),d&&=e);this.m_performPredicates[5]&&(this.boundaryAreaExteriorArea_(a,b,c,5),e=this.isPredicateKnown_(5),d&&=e);this.m_performPredicates[6]&&(this.interiorAreaExteriorArea_(a,c,b,6),e=this.isPredicateKnown_(6),d&&=e);this.m_performPredicates[7]&&(this.boundaryAreaExteriorArea_(a,c,b,7),a=this.isPredicateKnown_(7),d&&=a);return d}areaLinePredicates_(a,b,c){let d=!0;
if(this.m_performPredicates[0]){this.interiorAreaInteriorLine_(a,b,c);var e=this.isPredicateKnown_(0);d&&=e}this.m_performPredicates[1]&&(this.interiorAreaBoundaryLine_(a,b,c,this.m_clusterIndexB),e=this.isPredicateKnown_(1),d&&=e);this.m_performPredicates[2]&&(this.interiorAreaExteriorLine_(a,b,c),e=this.isPredicateKnown_(2),d&&=e);this.m_performPredicates[3]&&(this.boundaryAreaInteriorLine_(a,b,c,this.m_clusterIndexB),e=this.isPredicateKnown_(3),d&&=e);this.m_performPredicates[4]&&(this.boundaryAreaBoundaryLine_(a,
b,c,this.m_clusterIndexB),e=this.isPredicateKnown_(4),d&&=e);this.m_performPredicates[5]&&(this.boundaryAreaExteriorLine_(a,b,c),e=this.isPredicateKnown_(5),d&&=e);this.m_performPredicates[6]&&(this.exteriorAreaInteriorLine_(a,b),e=this.isPredicateKnown_(6),d&&=e);this.m_performPredicates[7]&&(this.exteriorAreaBoundaryLine_(a,b,c,this.m_clusterIndexB),a=this.isPredicateKnown_(7),d&&=a);return d}lineLinePredicates_(a,b,c){let d=!0;if(this.m_performPredicates[0]){this.interiorLineInteriorLine_(a,b,
c,this.m_clusterIndexA,this.m_clusterIndexB);var e=this.isPredicateKnown_(0);d&&=e}this.m_performPredicates[1]&&(this.interiorLineBoundaryLine_(a,b,c,this.m_clusterIndexA,this.m_clusterIndexB,1),e=this.isPredicateKnown_(1),d&&=e);this.m_performPredicates[2]&&(this.interiorLineExteriorLine_(a,b,c,2),e=this.isPredicateKnown_(2),d&&=e);this.m_performPredicates[3]&&(this.interiorLineBoundaryLine_(a,c,b,this.m_clusterIndexB,this.m_clusterIndexA,3),e=this.isPredicateKnown_(3),d&&=e);this.m_performPredicates[4]&&
(this.boundaryLineBoundaryLine_(a,b,c,this.m_clusterIndexA,this.m_clusterIndexB),e=this.isPredicateKnown_(4),d&&=e);this.m_performPredicates[5]&&(this.boundaryLineExteriorLine_(a,b,c,this.m_clusterIndexA,5),e=this.isPredicateKnown_(5),d&&=e);this.m_performPredicates[6]&&(this.interiorLineExteriorLine_(a,c,b,6),e=this.isPredicateKnown_(6),d&&=e);this.m_performPredicates[7]&&(this.boundaryLineExteriorLine_(a,c,b,this.m_clusterIndexB,7),a=this.isPredicateKnown_(7),d&&=a);return d}areaPointPredicates_(a,
b,c){let d=!0;if(this.m_performPredicates[0]){this.interiorAreaInteriorPoint_(a,b);var e=this.isPredicateKnown_(0);d&&=e}this.m_performPredicates[2]&&(this.interiorAreaExteriorPoint_(a,b),e=this.isPredicateKnown_(2),d&&=e);this.m_performPredicates[3]&&(this.boundaryAreaInteriorPoint_(a,b,c),c=this.isPredicateKnown_(3),d&&=c);this.m_performPredicates[5]&&(this.boundaryAreaExteriorPoint_(a,b),c=this.isPredicateKnown_(5),d&&=c);this.m_performPredicates[6]&&(this.exteriorAreaInteriorPoint_(a,b),a=this.isPredicateKnown_(6),
d&&=a);return d}linePointPredicates_(a,b,c){let d=!0;if(this.m_performPredicates[0]){this.interiorLineInteriorPoint_(a,b,c,this.m_clusterIndexA);var e=this.isPredicateKnown_(0);d&&=e}this.m_performPredicates[2]&&(this.interiorLineExteriorPoint_(a,b,c,this.m_clusterIndexA),e=this.isPredicateKnown_(2),d&&=e);this.m_performPredicates[3]&&(this.boundaryLineInteriorPoint_(a,b,c,this.m_clusterIndexA),e=this.isPredicateKnown_(3),d&&=e);this.m_performPredicates[5]&&(this.boundaryLineExteriorPoint_(a,b,c,
this.m_clusterIndexA),e=this.isPredicateKnown_(5),d&&=e);this.m_performPredicates[6]&&(this.exteriorLineInteriorPoint_(a,b,c),a=this.isPredicateKnown_(6),d&&=a);return d}pointPointPredicates_(a,b,c){let d=!0;if(this.m_performPredicates[0]){this.interiorPointInteriorPoint_(a,b,c);var e=this.isPredicateKnown_(0);d&&=e}this.m_performPredicates[2]&&(this.interiorPointExteriorPoint_(a,b,c,2),e=this.isPredicateKnown_(2),d&&=e);this.m_performPredicates[6]&&(this.interiorPointExteriorPoint_(a,c,b,6),a=this.isPredicateKnown_(6),
d&&=a);return d}interiorAreaInteriorArea_(a,b,c){2!==this.m_matrix[0]&&(a=this.m_topoGraph.getHalfEdgeFaceParentage(a),0!==(a&b)&&0!==(a&c)&&(this.m_matrix[0]=2))}interiorAreaBoundaryArea_(a,b,c){if(1!==this.m_matrix[c]){var d=this.m_topoGraph.getHalfEdgeFaceParentage(a);a=this.m_topoGraph.getHalfEdgeFaceParentage(this.m_topoGraph.getHalfEdgeTwin(a));0!==(d&b)&&0!==(a&b)&&(this.m_matrix[c]=1)}}interiorAreaExteriorArea_(a,b,c,d){2!==this.m_matrix[d]&&(a=this.m_topoGraph.getHalfEdgeFaceParentage(a),
0!==(a&b)&&0===(a&c)&&(this.m_matrix[d]=2))}boundaryAreaBoundaryArea_(a,b,c){if(1!==this.m_matrix[4]){var d=this.m_topoGraph.getHalfEdgeParentage(a);0!==(d&b)&&0!==(d&c)?this.m_matrix[4]=1:0!==this.m_matrix[4]&&1!==this.m_topoGraph.getHalfEdgeUserIndex(this.m_topoGraph.getHalfEdgePrev(this.m_topoGraph.getHalfEdgeTwin(a)),this.m_visitedIndex)&&(a=this.m_topoGraph.getHalfEdgeTo(a),a=this.m_topoGraph.getClusterParentage(a),0!==(a&b)&&0!==(a&c)&&(this.m_matrix[4]=0))}}boundaryAreaExteriorArea_(a,b,c,
d){1!==this.m_matrix[d]&&(b=this.m_topoGraph.getHalfEdgeFaceParentage(a),a=this.m_topoGraph.getHalfEdgeFaceParentage(this.m_topoGraph.getHalfEdgeTwin(a)),0===(b&c)&&0===(a&c)&&(this.m_matrix[d]=1))}interiorAreaInteriorLine_(a,b,c){1!==this.m_matrix[0]&&(c=this.m_topoGraph.getHalfEdgeFaceParentage(a),a=this.m_topoGraph.getHalfEdgeFaceParentage(this.m_topoGraph.getHalfEdgeTwin(a)),0!==(c&b)&&0!==(a&b)&&(this.m_matrix[0]=1))}interiorAreaBoundaryLine_(a,b,c,d){if(0!==this.m_matrix[1]&&1!==this.m_topoGraph.getHalfEdgeUserIndex(this.m_topoGraph.getHalfEdgePrev(this.m_topoGraph.getHalfEdgeTwin(a)),
this.m_visitedIndex)){const e=this.m_topoGraph.getHalfEdgeTo(a),f=this.m_topoGraph.getClusterParentage(e);0===(f&b)&&0!==(this.m_topoGraph.getHalfEdgeFaceParentage(a)&b)&&(a=this.m_topoGraph.getClusterUserIndex(e,d),0!==(f&c)&&0!==a%2&&(this.m_matrix[1]=0))}}interiorAreaExteriorLine_(a,b,c){2!==this.m_matrix[2]&&0!==(this.m_topoGraph.getHalfEdgeParentage(a)&b)&&(this.m_matrix[2]=2)}boundaryAreaInteriorLine_(a,b,c,d){if(1!==this.m_matrix[3]){var e=this.m_topoGraph.getHalfEdgeParentage(a);0!==(e&b)&&
0!==(e&c)?this.m_matrix[3]=1:0!==this.m_matrix[3]&&1!==this.m_topoGraph.getHalfEdgeUserIndex(this.m_topoGraph.getHalfEdgePrev(this.m_topoGraph.getHalfEdgeTwin(a)),this.m_visitedIndex)&&(e=this.m_topoGraph.getHalfEdgeTo(a),a=this.m_topoGraph.getClusterParentage(e),0!==(a&b)&&(b=this.m_topoGraph.getClusterUserIndex(e,d),0!==(a&c)&&0===b%2&&(this.m_matrix[3]=0)))}}boundaryAreaBoundaryLine_(a,b,c,d){if(0!==this.m_matrix[4]&&1!==this.m_topoGraph.getHalfEdgeUserIndex(this.m_topoGraph.getHalfEdgePrev(this.m_topoGraph.getHalfEdgeTwin(a)),
this.m_visitedIndex)){const e=this.m_topoGraph.getHalfEdgeTo(a);a=this.m_topoGraph.getClusterParentage(e);0!==(a&b)&&(b=this.m_topoGraph.getClusterUserIndex(e,d),0!==(a&c)&&0!==b%2&&(this.m_matrix[4]=0))}}boundaryAreaExteriorLine_(a,b,c){1!==this.m_matrix[5]&&(a=this.m_topoGraph.getHalfEdgeParentage(a),0!==(a&b)&&0===(a&c)&&(this.m_matrix[5]=1))}exteriorAreaInteriorLine_(a,b){if(1!==this.m_matrix[6]){var c=this.m_topoGraph.getHalfEdgeFaceParentage(a);a=this.m_topoGraph.getHalfEdgeFaceParentage(this.m_topoGraph.getHalfEdgeTwin(a));
0===(c&b)&&0===(a&b)&&(this.m_matrix[6]=1)}}exteriorAreaBoundaryLine_(a,b,c,d){if(0!==this.m_matrix[7]&&1!==this.m_topoGraph.getHalfEdgeUserIndex(this.m_topoGraph.getHalfEdgePrev(this.m_topoGraph.getHalfEdgeTwin(a)),this.m_visitedIndex)){const e=this.m_topoGraph.getHalfEdgeTo(a),f=this.m_topoGraph.getClusterParentage(e);0===(f&b)&&0===(this.m_topoGraph.getHalfEdgeFaceParentage(a)&b)&&(a=this.m_topoGraph.getClusterUserIndex(e,d),0!==(f&c)&&0!==a%2&&(this.m_matrix[7]=0))}}interiorLineInteriorLine_(a,
b,c,d,e){if(1!==this.m_matrix[0]){var f=this.m_topoGraph.getHalfEdgeParentage(a);0!==(f&b)&&0!==(f&c)?this.m_matrix[0]=1:0!==this.m_matrix[0]&&1!==this.m_topoGraph.getHalfEdgeUserIndex(this.m_topoGraph.getHalfEdgePrev(this.m_topoGraph.getHalfEdgeTwin(a)),this.m_visitedIndex)&&(a=this.m_topoGraph.getHalfEdgeTo(a),f=this.m_topoGraph.getClusterParentage(a),0!==(f&b)&&0!==(f&c)&&(b=this.m_topoGraph.getClusterUserIndex(a,d),e=this.m_topoGraph.getClusterUserIndex(a,e),0===b%2&&0===e%2&&(this.m_matrix[0]=
0)))}}interiorLineBoundaryLine_(a,b,c,d,e,f){if(0!==this.m_matrix[f]&&1!==this.m_topoGraph.getHalfEdgeUserIndex(this.m_topoGraph.getHalfEdgePrev(this.m_topoGraph.getHalfEdgeTwin(a)),this.m_visitedIndex)){a=this.m_topoGraph.getHalfEdgeTo(a);const g=this.m_topoGraph.getClusterParentage(a);0!==(g&b)&&0!==(g&c)&&(b=this.m_topoGraph.getClusterUserIndex(a,d),e=this.m_topoGraph.getClusterUserIndex(a,e),0===b%2&&0!==e%2&&(this.m_matrix[f]=0))}}interiorLineExteriorLine_(a,b,c,d){1!==this.m_matrix[d]&&(a=this.m_topoGraph.getHalfEdgeParentage(a),
0!==(a&b)&&0===(a&c)&&(this.m_matrix[d]=1))}boundaryLineBoundaryLine_(a,b,c,d,e){if(0!==this.m_matrix[4]&&1!==this.m_topoGraph.getHalfEdgeUserIndex(this.m_topoGraph.getHalfEdgePrev(this.m_topoGraph.getHalfEdgeTwin(a)),this.m_visitedIndex)){a=this.m_topoGraph.getHalfEdgeTo(a);const f=this.m_topoGraph.getClusterParentage(a);0!==(f&b)&&0!==(f&c)&&(b=this.m_topoGraph.getClusterUserIndex(a,d),e=this.m_topoGraph.getClusterUserIndex(a,e),0!==b%2&&0!==e%2&&(this.m_matrix[4]=0))}}boundaryLineExteriorLine_(a,
b,c,d,e){0!==this.m_matrix[e]&&1!==this.m_topoGraph.getHalfEdgeUserIndex(this.m_topoGraph.getHalfEdgePrev(this.m_topoGraph.getHalfEdgeTwin(a)),this.m_visitedIndex)&&(a=this.m_topoGraph.getHalfEdgeTo(a),0===(this.m_topoGraph.getClusterParentage(a)&c)&&0!==this.m_topoGraph.getClusterUserIndex(a,d)%2&&(this.m_matrix[e]=0))}interiorAreaInteriorPoint_(a,b){0!==this.m_matrix[0]&&0===(this.m_topoGraph.getClusterParentage(a)&b)&&(a=this.m_topoGraph.getClusterChain(a),0!==(this.m_topoGraph.getChainParentage(a)&
b)&&(this.m_matrix[0]=0))}interiorAreaExteriorPoint_(a,b){2!==this.m_matrix[2]&&0!==(this.m_topoGraph.getClusterParentage(a)&b)&&(this.m_matrix[2]=2)}boundaryAreaInteriorPoint_(a,b,c){0!==this.m_matrix[3]&&(a=this.m_topoGraph.getClusterParentage(a),0!==(a&b)&&0!==(a&c)&&(this.m_matrix[3]=0))}boundaryAreaExteriorPoint_(a,b){1!==this.m_matrix[5]&&0!==(this.m_topoGraph.getClusterParentage(a)&b)&&(this.m_matrix[5]=1)}exteriorAreaInteriorPoint_(a,b){0!==this.m_matrix[6]&&0===(this.m_topoGraph.getClusterParentage(a)&
b)&&(a=this.m_topoGraph.getClusterChain(a),0===(this.m_topoGraph.getChainParentage(a)&b)&&(this.m_matrix[6]=0))}interiorLineInteriorPoint_(a,b,c,d){if(0!==this.m_matrix[0]){var e=this.m_topoGraph.getClusterParentage(a);0!==(e&b)&&0!==(e&c)&&0===this.m_topoGraph.getClusterUserIndex(a,d)%2&&(this.m_matrix[0]=0)}}interiorLineExteriorPoint_(a,b,c,d){1!==this.m_matrix[2]&&(-1!==this.m_topoGraph.getClusterHalfEdge(a)?this.m_matrix[2]=1:0!==this.m_matrix[2]&&0===(this.m_topoGraph.getClusterParentage(a)&
c)&&(this.m_matrix[2]=0))}boundaryLineInteriorPoint_(a,b,c,d){if(0!==this.m_matrix[3]){var e=this.m_topoGraph.getClusterParentage(a);0!==(e&b)&&0!==(e&c)&&0!==this.m_topoGraph.getClusterUserIndex(a,d)%2&&(this.m_matrix[3]=0)}}boundaryLineExteriorPoint_(a,b,c,d){if(0!==this.m_matrix[5]){var e=this.m_topoGraph.getClusterParentage(a);0!==(e&b)&&0===(e&c)&&0!==this.m_topoGraph.getClusterUserIndex(a,d)%2&&(this.m_matrix[5]=0)}}exteriorLineInteriorPoint_(a,b,c){0!==this.m_matrix[6]&&(a=this.m_topoGraph.getClusterParentage(a),
0===(a&b)&&0!==(a&c)&&(this.m_matrix[6]=0))}interiorPointInteriorPoint_(a,b,c){0!==this.m_matrix[0]&&(a=this.m_topoGraph.getClusterParentage(a),0!==(a&b)&&0!==(a&c)&&(this.m_matrix[0]=0))}interiorPointExteriorPoint_(a,b,c,d){0!==this.m_matrix[d]&&(a=this.m_topoGraph.getClusterParentage(a),0!==(a&b)&&0===(a&c)&&(this.m_matrix[d]=0))}computeMatrixTopoGraphHalfEdges_(a,b){let c=!1;a=this.m_topoGraph.getGeometryID(a);b=this.m_topoGraph.getGeometryID(b);this.m_visitedIndex=this.m_topoGraph.createUserIndexForHalfEdges();
for(let d=this.m_topoGraph.getFirstCluster();-1!==d;d=this.m_topoGraph.getNextCluster(d)){const e=this.m_topoGraph.getClusterHalfEdge(d);if(-1===e){if(null!==this.m_predicatesCluster&&(c=this.m_predicatesCluster(d,a,b)))break;continue}let f=e;do{let g=f;if(1!==this.m_topoGraph.getHalfEdgeUserIndex(g,this.m_visitedIndex)){do{if(c=this.m_predicatesHalfEdge(g,a,b))break;this.m_topoGraph.setHalfEdgeUserIndex(g,this.m_visitedIndex,1);g=this.m_topoGraph.getHalfEdgeNext(g)}while(g!==f&&!c)}if(c)break;f=
this.m_topoGraph.getHalfEdgeNext(this.m_topoGraph.getHalfEdgeTwin(g))}while(f!==e);if(c)break}c||this.setRemainingPredicatesToFalse_();this.m_topoGraph.deleteUserIndexForHalfEdges(this.m_visitedIndex)}computeMatrixTopoGraphClusters_(a,b){let c=!1;a=this.m_topoGraph.getGeometryID(a);b=this.m_topoGraph.getGeometryID(b);for(let d=this.m_topoGraph.getFirstCluster();-1!==d&&!(c=this.m_predicatesCluster(d,a,b));d=this.m_topoGraph.getNextCluster(d));c||this.setRemainingPredicatesToFalse_()}setEditShape_(a,
b){this.m_topoGraph.setEditShape(a,b)}setEditShapeCrackAndCluster_(a,b,c){var d=0;if(a.hasCurves()){const f=new wb;d=a.getEnvelope2D(c);const g=xb(b.total(),d);d=3*g;var e=b.total();Jb(a,g,e,f,null,c);f.clearStitcher(a)}ac(a,b.add(d),c,!1,!1);a.filterClosePoints(0,!0,!0,!1,-1);for(b=a.getFirstGeometry();-1!==b;b=a.getNextGeometry(b))a.getGeometryType(b)===p.GeometryType.enumPolygon&&tc(a,b,-1,!1,-1,c);this.setEditShape_(a,c)}}class vb{nullFunc(){p.geometryReleaseAssert(0);return!1}constructor(a,b,
c,d=!1){this.m_bDone=!1;this.m_tolerance=0;this.m_elementHandle=-1;this.m_query=D.constructEmpty();this.m_envInter=D.constructEmpty();this.m_intersector=this.m_quadTree=null;this.m_function=this.nullFunc;var e=a.getAccelerators();let f=null;null!=e&&(f=d?e.getQuadTreeForPaths():e.getQuadTree());var g=b.getAccelerators();e=null;null!=g&&(e=d?g.getQuadTreeForPaths():g.getQuadTree());if(null===f&&null===e&&!d){g=a.getPointCount();const h=b.getPointCount();if(10<g&&10<h){const k=D.constructEmpty(),m=
D.constructEmpty(),n=D.constructEmpty();a.queryLooseEnvelope(k);b.queryLooseEnvelope(m);k.inflateCoords(c,c);m.inflateCoords(c,c);n.setCoords({env2D:k});n.intersect(m);g>=h?f=p.isMultiPath(a.getGeometryType())?fd(a,n):Mh(a,n):e=p.isMultiPath(b.getGeometryType())?fd(b,n):Mh(b,n)}}this.construct_(a,f,b,e,c,d)}next(){if(this.m_bQuadTree){if(this.m_bDone)return!1;for(;this.m_function(););return this.m_bDone?!1:!0}return this.m_intersector?this.m_intersector.next():!1}getRedElement(){return this.m_bQuadTree?
this.m_bSwapElements?this.m_quadTree.getElement(this.m_elementHandle):p.isMultiPath(this.m_queryType)?this.m_bPaths?this.m_pathIndex:this.m_segIter.getStartPointIndex():this.m_pointIndex:this.m_bSwapElements?this.m_intersector.getBlueElement(this.m_intersector.getHandleB()):this.m_intersector.getRedElement(this.m_intersector.getHandleA())}getBlueElement(){return this.m_bQuadTree?this.m_bSwapElements?p.isMultiPath(this.m_queryType)?this.m_bPaths?this.m_pathIndex:this.m_segIter.getStartPointIndex():
this.m_pointIndex:this.m_quadTree.getElement(this.m_elementHandle):this.m_bSwapElements?this.m_intersector.getRedElement(this.m_intersector.getHandleA()):this.m_intersector.getBlueElement(this.m_intersector.getHandleB())}getRedEnvelope(){this.m_bPaths||p.throwInvalidCallException("");return this.m_bQuadTree?this.m_bSwapElements?this.m_quadTree.getElementExtent(this.m_elementHandle):this.m_query:this.m_bSwapElements?this.m_intersector.getBlueEnvelope(this.m_intersector.getHandleB()):this.m_intersector.getRedEnvelope(this.m_intersector.getHandleA())}getBlueEnvelope(){this.m_bPaths||
p.throwInvalidCallException("");return this.m_bQuadTree?this.m_bSwapElements?this.m_query:this.m_quadTree.getElementExtent(this.m_elementHandle):this.m_bSwapElements?this.m_intersector.getRedEnvelope(this.m_intersector.getHandleA()):this.m_intersector.getBlueEnvelope(this.m_intersector.getHandleB())}construct_(a,b,c,d,e,f){var g=D.constructEmpty(),h=D.constructEmpty();a.queryLooseEnvelope(g);c.queryLooseEnvelope(h);g.inflateCoords(e,e);h.inflateCoords(e,e);this.m_envInter.setCoords({env2D:g});this.m_envInter.intersect(h);
this.m_multiVertexImplA=a;this.m_multiVertexImplB=c;g=a.getGeometryType();h=c.getGeometryType();this.m_bPaths=f;this.m_pointIndex=this.m_pathIndex=-1;this.m_bSwapElements=!1;this.m_queryType=p.GeometryType.enumUnknown;this.m_bQuadTree=!1;null!==b&&(this.m_bDone=!1,this.m_tolerance=e,this.m_quadTree=b,this.m_qtIter=this.m_quadTree.getIteratorForQT(),this.m_bSwapElements=this.m_bQuadTree=!0,p.isMultiPath(h)?(this.m_queryType=h,this.m_function=this.nextPath_,f?this.m_pathIndex=c.getPathCount():this.m_segIter=
c.querySegmentIterator()):(this.m_queryType=h,this.m_function=this.nextPoint_,this.m_pointIndex=c.getPointCount()));this.m_bQuadTree||null===d||(this.m_bDone=!1,this.m_tolerance=e,this.m_quadTree=d,this.m_qtIter=this.m_quadTree.getIteratorForQT(),this.m_bQuadTree=!0,this.m_bSwapElements=!1,p.isMultiPath(g)?(this.m_queryType=g,this.m_function=this.nextPath_,f?this.m_pathIndex=a.getPathCount():this.m_segIter=a.querySegmentIterator()):(this.m_queryType=g,this.m_function=this.nextPoint_,this.m_pointIndex=
a.getPointCount()));if(!this.m_bQuadTree)if(f&&p.isMultiPath(g)&&p.isMultiPath(h)){a.getGeometryType();c.getGeometryType();g=D.constructEmpty();b=D.constructEmpty();a.queryLooseEnvelope(g);c.queryLooseEnvelope(b);g.inflateCoords(e,e);b.inflateCoords(e,e);d=D.constructEmpty();d.setCoords({env2D:g});d.intersect(b);f=new Od;f.setTolerance(e);e=!1;f.startRedConstruction();for(let k=0,m=a.getPathCount();k<m;k++)a.queryLoosePathEnvelope(k,g),g.isIntersecting(d)&&(e=!0,f.addRedEnvelope(k,g));f.endRedConstruction();
if(e){e=!1;f.startBlueConstruction();for(let k=0,m=c.getPathCount();k<m;k++)c.queryLoosePathEnvelope(k,b),b.isIntersecting(d)&&(e=!0,f.addBlueEnvelope(k,b));f.endBlueConstruction();c=e?f:null}else c=null;this.m_intersector=c}else if(p.isMultiPath(g)&&p.isMultiPath(h)){d=D.constructEmpty();f=D.constructEmpty();a.queryLooseEnvelope(d);c.queryLooseEnvelope(f);d.inflateCoords(e,e);f.inflateCoords(e,e);b=D.constructEmpty();b.setCoords({env2D:d});b.intersect(f);a=a.querySegmentIterator();c=c.querySegmentIterator();
g=D.constructEmpty();d=D.constructEmpty();f=new Od;f.setTolerance(e);e=!1;for(f.startRedConstruction();a.nextPath();)for(;a.hasNextSegment();)a.nextSegment().queryLooseEnvelope(g),g.isIntersecting(b)&&(e=!0,f.addRedEnvelope(a.getStartPointIndex(),g));f.endRedConstruction();if(e){e=!1;for(f.startBlueConstruction();c.nextPath();)for(;c.hasNextSegment();)c.nextSegment().queryLooseEnvelope(d),d.isIntersecting(b)&&(e=!0,f.addBlueEnvelope(c.getStartPointIndex(),d));f.endBlueConstruction();c=e?f:null}else c=
null;this.m_intersector=c;this.m_bSwapElements=!1}else if(p.isMultiPath(g)&&!p.isMultiPath(h))this.m_intersector=Lh(a,c,e),this.m_bSwapElements=!1;else if(!p.isMultiPath(g)&&p.isMultiPath(h))this.m_intersector=Lh(c,a,e),this.m_bSwapElements=!0;else{d=D.constructEmpty();f=D.constructEmpty();a.queryEnvelope(d);c.queryEnvelope(f);d.inflateCoords(e,e);f.inflateCoords(e,e);b=D.constructEmpty();b.setCoords({env2D:d});b.intersect(f);d=new Od;d.setTolerance(e);e=!1;d.startRedConstruction();f=new l.Point2D;
for(let k=0,m=a.getPointCount();k<m;k++)a.queryXY(k,f),b.contains(f)&&(e=!0,d.addRedEnvelope(k,D.construct(f.x,f.y,f.x,f.y)));d.endRedConstruction();if(e){e=!1;d.startBlueConstruction();a=new l.Point2D;for(let k=0,m=c.getPointCount();k<m;k++)c.queryXY(k,a),b.contains(a)&&(e=!0,d.addBlueEnvelope(k,D.construct(a.x,a.y,a.x,a.y)));d.endBlueConstruction();c=e?d:null}else c=null;this.m_intersector=c;this.m_bSwapElements=!1}}nextPath_(){if(!this.m_bPaths){if(!this.m_segIter.nextPath())return this.m_bDone=
!0,!1;this.m_function=this.nextSegment_;return!0}if(-1===--this.m_pathIndex)return this.m_bDone=!0,!1;this.m_bSwapElements?this.m_multiVertexImplB.queryPathEnvelope(this.m_pathIndex,this.m_query):this.m_multiVertexImplA.queryPathEnvelope(this.m_pathIndex,this.m_query);this.m_qtIter.resetIterator(this.m_query,this.m_tolerance);this.m_function=this.iterate_;return!0}nextSegment_(){if(!this.m_segIter.hasNextSegment())return this.m_function=this.nextPath_,!0;const a=this.m_segIter.nextSegment(),b=new D;
a.queryLooseEnvelope(b);if(!b.isIntersecting(this.m_envInter))return!0;this.m_qtIter.resetIterator(a,this.m_tolerance);this.m_function=this.iterate_;return!0}nextPoint_(){if(-1===--this.m_pointIndex)return this.m_bDone=!0,!1;const a=new l.Point2D;if(this.m_bSwapElements){var b=this.m_multiVertexImplB.getXY(this.m_pointIndex);a.setCoordsPoint2D(b)}else b=this.m_multiVertexImplA.getXY(this.m_pointIndex),a.setCoordsPoint2D(b);if(!this.m_envInter.contains(a))return!0;this.m_qtIter.resetIterator(D.construct(a.x,
a.y,a.x,a.y),this.m_tolerance);this.m_function=this.iterate_;return!0}iterate_(){this.m_elementHandle=this.m_qtIter.next();return-1===this.m_elementHandle?(p.isMultiPath(this.m_queryType)?this.m_function=this.m_bPaths?this.nextPath_:this.nextSegment_:this.m_function=this.nextPoint_,!0):!1}}class Om{constructor(){this.m_overlapEvents=[]}compareOverlapEvents(a,b){a=this.m_overlapEvents[a];b=this.m_overlapEvents[b];return a.m_ipathA<b.m_ipathA||a.m_ipathA===b.m_ipathA&&(a.m_ivertexA<b.m_ivertexA||a.m_ivertexA===
b.m_ivertexA&&(a.m_scalarA0<b.m_scalarA0||a.m_scalarA0===b.m_scalarA0&&(a.m_scalarA1<b.m_scalarA1||a.m_scalarA1===b.m_scalarA1&&a.m_ivertexB<b.m_ivertexB)))?-1:1}}class Ch{constructor(a,b,c,d,e){this.m_left=a;this.m_tracker=e;this.m_eps=c;this.m_trackerCounter=0;this.m_tolerance=d;this.m_circleCheckCounter=0;this.m_bReversedLeft=!1;this.m_leftArc={ptStart:new l.Point2D,ptEnd:new l.Point2D,center:new S,radius:new l.ECoordinate,fcenter:new ua,fradius2:new l.MPValue,maxError:Number.NaN,isLine:Pm}}closeToCircularArc(a,
b,c,d,e,f){this.m_circleCheckCounter++;f.maxError=0;if(!Ch.checkSweepAngle(a,b))return!1;f.ptStart.setCoordsPoint2D(c);f.ptEnd.setCoordsPoint2D(e);if(a.isCircular())return f.fradius2=l.MPValue.constructDouble(a.getSemiMajorAxis()).mulDouble(a.getSemiMajorAxis()),f.radius.set(a.getSemiMajorAxis()),f.fcenter.assignPoint2D(a.getCenter()),f.center.set(a.getCenter()),!0;c=f.ptEnd.sub(f.ptStart).clone();c.leftPerpendicularThis();c.normalize();if(Math.abs(c.dotProduct(d.sub(f.ptStart)))<=this.m_eps)return this.confirmIsLine(f,
c)?(f.radius.set(Number.NaN),f.center.setCoords(0,0),!0):!1;var g=f.ptEnd.sub(f.ptStart),h=d.sub(f.ptStart);e=g.crossProduct(h);if(0===e)return!1;var k=.5*g.sqrLength(),m=.5*h.sqrLength();c=k*h.y-m*g.y;c/=e;g=g.x*m-h.x*k;g/=e;e=Math.sqrt(c*c+g*g);if(4*Number.EPSILON*e>this.m_eps)return!1;c+=f.ptStart.x;g+=f.ptStart.y;f.radius.set(e);f.center.setCoords(c,g);c=this.maxCircleApproximationError(a,b,f);if(c>this.m_eps)return f.maxError=c,!1;c=(new ua).assignPoint2D(f.ptStart);g=(new ua).assignPoint2D(f.ptEnd).sub(c);
h=(new ua).assignPoint2D(d).sub(c);e=g.crossProduct(h);if(e.isZero())return!1;k=g.sqrLength().mulDouble(.5);m=h.sqrLength().mulDouble(.5);d=k.mul(h.y).sub(m.mul(g.y));g=g.x.mul(m).sub(h.x.mul(k));h=d.mul(d).add(g.mul(g));e=e.clone();e.invertThis();f.fradius2=h.mul(e).mul(e);f.fcenter.setCoords(d.mul(e).add(c.x),g.mul(e).add(c.y));f.center.setWithEps(f.fcenter.asPoint2D());f.radius.setWithEps(Math.sqrt(f.fradius2.toDouble()));d=S.constructPoint2D(f.ptStart).subE(f.center);c=S.constructPoint2D(f.ptEnd).subE(f.center);
if(!d.dotProduct(c).gt(l.s_zero))return!1;a=this.maxCircleApproximationError(a,b,f);f.maxError=a;return a<=this.m_eps?!0:!1}static checkSweepAngle(a,b){if(a.getGeometryType()===p.GeometryType.enumEllipticArc){const c=mc(a,b.vmin);a=mc(a,b.vmax);if(Math.abs(a-c)>.5*l.geometryHalfPi)return!1}return!0}confirmIsLine(a,b){p.geometryReleaseAssert(0);return!1}maxCircleApproximationError(a,b,c){var d=[.25,.75],e=[.1,.25,.75,.9];let f;a.getGeometryType()===p.GeometryType.enumEllipticArc?(f=d,d=d.length):(f=
e,d=e.length);e=0;for(let h=0;h<d;++h){var g=new l.Point2D;a.queryCoord2D(l.lerp(b.vmin,b.vmax,f[h]),g);g=g.sub(c.center.value()).length();g=Math.abs(g-c.radius.value());g>e&&(e=g)}return e}approximateWithCirclesImpl(a,b){let c=1;b&&b.push(0);const d=l.makePrimitiveArray(9,Number.NaN);a?a=this.m_left.getMonotonicPartParams(d.length,d):(d[0]=0,d[1]=1,a=2);const e=[],f=[],g=new l.Point2D(0,0);for(let m=1;m<a;m++){var h=new l.Envelope1D(d[m-1],d[m]);(this.m_bReversedLeft=!Ch.goodOrientation(this.m_left,
h))?(e.push(le(g,h.vmin,0,0)),e.push(le(g,h.vmax,0,0))):(e.push(le(g,h.vmax,0,0)),e.push(le(g,h.vmin,0,0)));e[0].pt=this.m_left.getCoord2D(e[0].t);for(e[1].pt=this.m_left.getCoord2D(e[1].t);1<e.length;){this.progress_();h=e.at(-1);var k=h.checkCount;let n=h.err;const q=h.pt.clone(),r=h.t,t=e[e.length-2].t,u=.5*(r+t),v=this.m_left.getCoord2D(u);if(n<=this.m_eps||5<=k){k=new l.Envelope1D;k.setCoords(r,t);if(this.closeToCircularArc(this.m_left,k,q,v,e[e.length-2].pt,this.m_leftArc)){b&&(this.m_bReversedLeft?
f.push(r):b.push(t));c++;e.pop();continue}k=0;n=this.m_leftArc.maxError}h.t=u;h.pt.setCoordsPoint2D(v);n*=.125;k++;h.err=n;h.checkCount=k;e.push(le(q,r,n,k))}this.m_bReversedLeft&&b&&(b.length+=f.length,l.memcpy(b,f.reverse(),b.length-f.length,0,f.length),f.length=0);e.length=0}return c}approximateWithCirclesImplPolyline(a){p.geometryReleaseAssert(0);return{}}static goodOrientation(a,b){const c=a.getCoord2D(b.vmin);a=a.getCoord2D(b.vmax);return 0>c.compare(a)}progress_(a){}}class wb{constructor(){this.m_impl=
null}stitchCurves(a,b,c,d){this.m_impl&&(this.m_impl.stitchCurves(a,b,c),d&&this.clearStitcher(a))}clearStitcher(a){this.m_impl&&(this.m_impl.clearStitcher(a),this.m_impl=null)}getOriginalVertexIndex(a,b){return this.m_impl.getOriginalVertexIndex(a,b)}getOriginalSegmentTypeInfo(a){return this.m_impl.getOriginalSegmentTypeInfo(a)}}class Sc{constructor(a,b,c){this.m_originalPlanarSegments=[];this.m_nsr=this.m_progressTracker=null;this.m_progressTracker=a;this.m_nsr=c;this.m_tolerance=0;this.m_originalVertexIndex=
-1;this.m_progressCounter=this.m_type=0;this.m_bIsSimple=b}buildSegmentParentage(a,b,c,d,e){p.geometryReleaseAssert(0)}static processCurves(a,b,c,d){p.geometryReleaseAssert(0);return a}buildMonotonicCurveParentage(a,b,c,d){if(a.hasCurves()){p.geometryReleaseAssert(!a.hasSegmentParentage());this.m_type=1;this.m_originalPlanarSegments.length=0;this.m_bIsSimple&&(this.m_originalVertexIndex=a.createUserIndex());this.m_tolerance=c;d=new Y;var e=new W,f=[],g=[],h=[];for(let t=a.getFirstGeometry();-1!==
t;t=a.getNextGeometry(t))for(let u=a.getFirstPath(t);-1!==u;u=a.getNextPath(u)){let v=a.getPathSize(u);var k=a.getFirstVertex(u);let w=0,x=-1;for(let y=0;y<v;y++){let z=a.getNextVertex(k);if(!a.querySegment(k,e,!0,!1)){k=z;continue}if(0===w){x=a.getVertexIndex(k);var m=Sc.regularizeCurve(a,e.get(),k,c);0<=m&&(this.m_nsr&&0===this.m_nsr.m_reason&&this.m_nsr.assign(new va(13,x,-1)),w=m,v=a.getPathSize(u),z=a.getNextVertex(k),m=a.querySegment(k,e,!0,!1),p.geometryReleaseAssert(m))}else w--;var n=a.getVertexIndex(k);
-1!==this.m_originalVertexIndex&&a.setUserIndex(k,this.m_originalVertexIndex,x);a.setSegmentToIndex(n,null);var q=void 0;m=!1;switch(e.get().getGeometryType()){case p.GeometryType.enumEllipticArc:q=td(e.get(),b,c,!1,!0,g,h,f);m=!0;break;case p.GeometryType.enumRationalBezier2:q=td(e.get(),b,c,!1,!0,g,h,f);m=!0;break;default:q=!this.m_bIsSimple||!e.get().isMonotoneQuickAndDirty(),q=We(e.get(),b,c,q,!1,g,f)}const A=this.m_originalPlanarSegments.length;a.setSegmentParentageAndBreak(k,A,!0);g[1].isNAN()||
(k=null,k=m?new lb({points:g,weights:h}):new Gb({cp:g}),k.snapControlPoints(c*c),a.setSegmentToIndex(n,k));k=m?2:3;for(let C=1,B=q,E=k;C<B;++C,E+=k){e.get().queryCoord(f[C],d);n=a.insertVertex(u,z,d);-1!==this.m_originalVertexIndex&&a.setUserIndex(n,this.m_originalVertexIndex,x);if(!g[E+1].isNAN())if(m){var r=new lb({points:g.slice(E),weights:h.slice(E)});r.snapControlPoints(c*c);a.setSegmentToIndex(a.getVertexIndex(n),r)}else r=new Gb({cp:g.slice(E)}),r.snapControlPoints(c*c),a.setSegmentToIndex(a.getVertexIndex(n),
r);a.setSegmentParentageAndBreak(n,A,!1)}1<q&&(y+=q-1,v=a.getPathSize(u));this.m_originalPlanarSegments.push(e.releaseSegment());k=z}}}}stitchCurves(a,b,c){Sc.st_stitchCurvesImpl(this,a,b,c,!1)}clearStitcher(a){this.m_originalPlanarSegments.length=0;-1!==this.m_originalVertexIndex&&(a.removeUserIndex(this.m_originalVertexIndex),this.m_originalVertexIndex=-1);a.deleteSegmentParentage()}static st_verifyParentage(a){Sc.st_stitchCurvesImpl(null,a,-1,0,!0)}getOriginalVertexIndex(a,b){return-1!==this.m_originalVertexIndex?
-1!==b?a.getUserIndex(b,this.m_originalVertexIndex):-1:-1}getOriginalSegmentTypeInfo(a){if(-1!==a)switch(a=this.m_originalPlanarSegments[a],a.getGeometryType()){case p.GeometryType.enumEllipticArc:return 0===a.projectionBehavior()?0:1;case p.GeometryType.enumBezier:return 2;case p.GeometryType.enumBezier2:return 3;case p.GeometryType.enumLine:break;case p.GeometryType.enumRationalBezier2:return 4;default:p.throwNotImplementedException("")}return-1}static st_curveRequiresRegularization(a,b){p.geometryReleaseAssert(0);
return!1}progress_(a){this.m_progressCounter++}processSpan_(a,b,c,d,e,f,g){if(b===c&&0===d)p.geometryReleaseAssert(-1===a.getNextVertex(b)),a.setSegmentToIndex(a.getVertexIndex(b),null),a.setSegmentParentageAndBreak(b,-1);else{var h=a.getNextVertex(b),k=2;for(let m=h;m!==c;m=a.getNextVertex(m))k++;p.geometryReleaseAssert(k===d);if(null===e)for(a.setSegmentToIndex(a.getVertexIndex(b),null),b=h;b!==c;)b=a.removeVertex(b,!0);else{h=a.getXY(b);k=a.getXY(c);if(e.isClosed()){if(h.isEqualPoint2D(k)&&h.isEqualPoint2D(e.getStartXY())&&
(h=this.verifySegmentFitness(a,b,c,d,e,f,g))){d=e.clone();d.dropAllAttributes();0>h&&d.reverse();this.removeSpan(a,b,c);a.setSegmentToIndex(a.getVertexIndex(b),d);return}}else if(h.isEqualPoint2D(e.getStartXY())){if(k.isEqualPoint2D(e.getEndXY())&&(h=e.clone(),h.dropAllAttributes(),this.verifySegmentFitness(a,b,c,d,h,f,g))){this.removeSpan(a,b,c);a.setSegmentToIndex(a.getVertexIndex(b),h);return}}else if(k.isEqualPoint2D(e.getStartXY())&&h.isEqualPoint2D(e.getEndXY())&&(h=e.getReversed(),h.dropAllAttributes(),
this.verifySegmentFitness(a,b,c,d,h,f,g))){this.removeSpan(a,b,c);a.setSegmentToIndex(a.getVertexIndex(b),h);return}this.processSpanSplitSegment(a,b,c,d,e,f,g)}}}processSpanSplitSegment(a,b,c,d,e,f,g){if(!e.isLine()&&!this.fitSegmentToSpan(a,b,c,d,e,f,g)){var h=g*g,k=b,m=a.getXY(b),n=e.getClosestCoordinate(m,!1),q=e.getCoord2D(n),r=!1;q=l.Point2D.sqrDistance(m,q);if(q>h){k=a.getNextVertex(b);this.approximateSpanSection(a,b,e,f,g);if(k===c)return;r=!0;--d}m=c;var t=a.getXY(c);n=e.getClosestCoordinate(t,
!1);var u=e.getCoord2D(n);n=!1;t=l.Point2D.sqrDistance(t,u);if(t>h){h=a.getPrevVertex(c);this.approximateSpanSection(a,h,e,f,g);if(h===k)return;m=h;n=!0;--d}if(!r&&!n||!this.fitSegmentToSpan(a,k,m,d,e,f,g)){h=!1;if(!r&&0<q){k=a.getNextVertex(b);this.approximateSpanSection(a,b,e,f,g);if(k===m)return;h=r=!0;--d}if(!n&&0<t){b=a.getPrevVertex(c);this.approximateSpanSection(a,b,e,f,g);if(b===k)return;m=b;h=n=!0;--d}if(!h||!this.fitSegmentToSpan(a,k,m,d,e,f,g))for(b=k;c=a.getNextVertex(b),this.approximateSpanSection(a,
b,e,f,g),b=c,b!==m;);}}}fitSegmentToSpan(a,b,c,d,e,f,g){var h=0===this.m_type;const k=[];k.push(a.getXY(b));if(h){var m=b;if(32<d){h=BigInt(d-1);var n=BigInt(31),q=n,r=0n;for(var t=1;t<d;t++,q+=n)if(m=a.getNextVertex(m),q>=r+h){r+=h;var u=a.getXY(m);k.push(u)}}else for(h=1;h<d;h++)m=a.getNextVertex(m),n=a.getXY(m),k.push(n);p.geometryReleaseAssert(m===c)}else for(h=b,n=new W;;){a.querySegment(h,n,!1,!0);q=[.1,.25,.4,.5,.6,.75,.9,1];r=0;for(m of q)(2===d||r&1)&&k.push(n.get().getCoord2D(m)),r++;h=
a.getNextVertex(h);if(h===c)break}m=k[0].compare(k.at(-1));if(0===m){const v=new l.KahanSummator(0);m=k.length;h=v;h.reset();if(!(3>m)){n=k[0].clone();q=n.x;r=n.y;t=k[1].clone();u=new l.Point2D;for(let w=2;w<m;w++)u.assign(k[w]),h.pe((u.x-n.x)*(t.y-r)),n.assign(t),t.assign(u);h.pe((q-n.x)*(t.y-r))}m=0<=v.getResult()?-1:1}(m=0<m)&&k.reverse();e=e.clone();e.dropAllAttributes();e.setSegmentFromCoords(k,k.length);m&&e.reverse();e.snapControlPoints(this.m_tolerance*this.m_tolerance);return this.verifySegmentFitness(a,
b,c,d,e,f,g)?(this.removeSpan(a,b,c),b=a.getVertexIndex(b),a.setSegmentToIndex(b,e),!0):!1}approximateSpanSection(a,b,c,d,e){d=new W;if(a.querySegment(b,d,!0,!1)){var f=c.getGeometryType();if(f!==d.get().getGeometryType())if(f===p.GeometryType.enumEllipticArc){if(d.get().getGeometryType()===p.GeometryType.enumRationalBezier2)if(0===c.projectionBehavior()){c=[];f=d.get();var g=c,h=this.m_progressTracker,k=jc(f);(new Ch(f,null,Math.max(4*k,e),Number.NaN,h)).approximateWithCirclesImpl(!1,g);e=a.getNextVertex(b);
f=a.getPathFromVertex(b);g=new Y;for(let n=1,q=c.length;n<q;n++){h=c[n];var m=d.get().getCoord2D(c[n-1]);const r=d.get().getCoord2D(l.lerp(c[n-1],h,.5));d.get().queryCoord(h,g);const t=g.getXY();k=new Hb;k.constructCircularArcThreePoint(m,t,r);m=-1;1>h&&(m=a.insertVertex(f,e,g));a.setSegmentToIndex(a.getVertexIndex(b),k);b=m}}else c=l.makeObjectArray(l.Point2D,3),d.get().queryControlPoints(c),e=[0,0,0],d.get().queryWeights(e),d=Yb(e),e=new Hb,xf(c,d*d,null,!1,e),a.setSegmentToIndex(a.getVertexIndex(b),
e)}else p.throwInternalErrorException("approximate_span_section_")}}verifySegmentFitness(a,b,c,d,e,f,g){return 0===this.m_type?this.verifySegmentFitnessLines(a,b,c,d,e,f,g):this.verifySegmentFitnessCurves(a,b,c,d,e,f,g)}verifySegmentFitnessCurves(a,b,c,d,e,f,g){d=a.getXY(b);f=a.getXY(c);if(!d.isEqualPoint2D(e.getStartXY())||!f.isEqualPoint2D(e.getEndXY()))return 0;f=0;e.isClosed()&&(f=e.getCoord2D(.1).sub(d),f=0<=e.getCoord2D(.7).sub(d).crossProduct(f)?1:-1);const h=Array(ve.s_maxMonotonicPartParams);
let k=e.getMonotonicPartParams(h.length,h);k--;const m=new Z,n=[1,.5,.75,.25];let q=0;var r=b;for(b=d.clone();;){const u=a.getNextVertex(r);let v=a.getSegment(r);null===v&&(a.queryLineConnector(r,m,!0),v=m);for(r=u===c?1:0;r<n.length;r++){var t=v.getCoord2D(n[r]);if(!e.isCloserThanDistance(t,l.Envelope1D.unit(),g))return 0}if(1<k)for(r=1;r<k;)t=e.getCoord2D(h[r]),v.isCloserThanDistance(t,l.Envelope1D.unit(),g)?(h[k-1]=l.swap(h[r],h[r]=h[k-1]),k--):r++;f&&(r=v.getCoord2D(.25),q+=r.sub(d).crossProduct(b.sub(d)),
b.assign(r),r.assign(v.getCoord2D(.75)),q+=r.sub(d).crossProduct(b.sub(d)),b.assign(r));r=u;if(r===c)return 1<k?0:f?0>q?-f:f:1}}verifySegmentFitnessLines(a,b,c,d,e,f,g){p.geometryReleaseAssert(0);return 0}removeSpan(a,b,c){a.setSegmentToIndex(a.getVertexIndex(b),null);b=a.getNextVertex(b);b!==c&&a.removeVertices(b,c)}static st_stitchCurvesImpl(a,b,c,d,e){if(b.hasSegmentParentage())return b.hasCurves()?Sc.st_stitchCurvesFromCurvesImpl(a,b,c,d,e):Sc.st_stitchCurvesFromLinesImpl(a,b,c,d,e)}static st_stitchCurvesFromLinesImpl(a,
b,c,d,e){let f=-1===c?b.getFirstGeometry():c;for(;-1!==f;){for(let h=b.getFirstPath(f);-1!==h;h=b.getNextPath(h)){let k=b.getPathSize(h);b.isClosedPath(h)&&(k+=1);let m=!0,n=!1;const q=b.getFirstVertex(h);var g=q;for(let r=0;r<k&&-1!==g;){let t=b.getSegmentParentage(g);if(-1===t||m){m=!1;r++;g=b.getNextVertex(g);n=!0;continue}let u=0,v;n?(v=b.getPrevVertex(g),p.geometryReleaseAssert(-1!==v),p.geometryReleaseAssert(g!==v),p.geometryReleaseAssert(-1===b.getSegmentParentage(v)||q===v)):(v=g,g=b.getNextVertex(v),
r++,p.geometryReleaseAssert(-1!==g),p.geometryReleaseAssert(g!==v),t=b.getSegmentParentage(g));u=2;n=!1;if(-1===t||b.getSegmentParentageBreakVertex(g))continue;let w=b.getNextVertex(g);for(r++;r<k&&-1!==w;){g=w;u++;const x=b.getSegmentParentage(w);if(-1===x||b.getSegmentParentageBreakVertex(w))break;p.geometryReleaseAssert(x===t);r++;w=b.getNextVertex(w)}e||a.processSpan_(b,v,g,u,a.m_originalPlanarSegments[t],t,d)}}if(-1!==c)break;f=b.getNextGeometry(f)}}static st_stitchCurvesFromCurvesImpl(a,b,c,
d,e){let f=-1===c?b.getFirstGeometry():c;for(;-1!==f;)if(p.isLinear(b.getGeometryType(f))){for(let n=b.getFirstPath(f);-1!==n;n=b.getNextPath(n)){let q=b.getPathSize(n);var g=b.isClosedPath(n);g&&(q+=1);var h=b.getFirstVertex(n);if(g){if(-1!==b.getSegmentParentage(h)){g=h;for(var k=0;!b.getSegmentParentageBreakVertex(g);k++){if(k===q){h=b.getFirstVertex(n);b.setSegmentParentageBreakVertex(g,!0);break}g=b.getPrevVertex(g)}}}else p.geometryReleaseAssert(-1===b.getSegmentParentage(h)||b.getSegmentParentageBreakVertex(h));
var m=h;for(h=0;h<q&&-1!==m;){g=b.getSegmentParentage(m);if(-1===g){h++;m=b.getNextVertex(m);continue}k=0;let r=-1;k=1;let t=b.getNextVertex(m);for(;h<q&&-1!==t;){h++;r=t;k++;const u=b.getSegmentParentage(t);if(-1===u||b.getSegmentParentageBreakVertex(t))break;p.geometryReleaseAssert(u===g);t=b.getNextVertex(t)}if(-1===r)break;e||a.processSpan_(b,m,r,k,a.m_originalPlanarSegments[g],g,d);m=r}}if(-1!==c)break;f=b.getNextGeometry(f)}else f=-1===c?b.getNextGeometry(f):-1}static regularizeCurve(a,b,c,
d){let e=b.snapControlPoints(d*d);if(e){var f=a.getVertexIndex(c);const g=b.clone();a.setSegmentToIndex(f,g)}if(b.getGeometryType()===Gb.type&&(f=[],b=b.calculateSpecialPointsForCracking(d,f),0<b)){a.splitSegment(c,f,b);e=a.snapControlPoints(c,b+1,d*d)||e;for(d=0;d<b;d++)c=a.getNextVertex(c),a.setSegmentParentageBreakVertex(c,!0);return b}return e?0:-1}}class Qg{constructor(a,b,c,d,e){this.m_shape=a;this.m_progressTracker=b;this.m_tolerance=c;this.m_bFilterDegenerateSegments=d;this.m_bTrackChanges=
e;this.m_progressCounter=0}do_(){var a=new jb(this.m_tolerance.tolerance,this.m_tolerance.resolution),b=kb(a),c=Rf(a),d=1.00001*c;c*=1.000001;a=!1;var e=30<this.m_shape.getTotalPointCount()+10?1E3:(this.m_shape.getTotalPointCount()+10)*(this.m_shape.getTotalPointCount()+10),f=this.m_shape.hasPointFeatures();for(var g=0;;g++){this.m_shape.dbgCheckSelection();g>e&&p.throwInternalErrorException("crack_and_cluster_iteration_exceeded");this.m_shape.dbgVerifyMonotone();var h=-1;0===g&&(h=this.firstCrack_(),
a||=0<h);var k=this.cluster_(b);this.m_shape.dbgVerifyMonotone();a||=k;this.m_bFilterDegenerateSegments&&(k=0!==this.m_shape.filterClosePoints(b,!0,!1,this.m_bTrackChanges,-1),a||=k,this.m_shape.dbgVerifyMonotone());k=this.m_shape.snapControlPointsOnSelection(d*d);a||=k;this.m_shape.dbgCheckSelection();k=!1;if(0===g&&-1===h||f||Jg(!0,this.m_shape,c,null,this.m_progressTracker))k=this.crack_(d),a||=k,this.m_shape.dbgVerifyMonotone();if(!k&&!Qg.fixCurveTwoPointLoops(this.m_shape,b,this.m_progressTracker)){this.m_shape.dbgVerifyMonotone();
break}}if(a&&(b=this.m_shape,b.hasSegmentParentage())){c=new za(0);d=b.queryVertexIteratorOnSelection();for(e=d.next();-1!==e;e=d.next())c.add(e);if(0!==c.size()){b.sortVerticesSimpleByY(c,0,c.size());c.add(-1);d=l.Point2D.getNAN();b.queryXY(c.read(0),d);f=0;e=l.Point2D.getNAN();for(let n=1,q=c.size();n<q;n++)if(g=c.read(n),-1!==g?b.queryXY(g,e):e.setNAN(),!e.isEqualPoint2D(d)){g=!1;h=-2;for(k=f;k<n;++k){var m=c.read(k);if(b.getSegmentParentageBreakVertex(m)){g=!0;break}let r=b.getSegmentParentage(m);
m=b.getPrevVertex(m);if(-1!==m&&(m=b.getSegmentParentage(m),-1===r&&(r=m),-1===m&&(m=r),r!==m)){g=!0;break}if(-2!==h&&r!==h){g=!0;break}h=r}if(g)for(;f<n;++f)b.setSegmentParentageBreakVertex(c.read(f),!0);d.setCoordsPoint2D(e);f=n}}}return a}cluster_(a){return lj(this.m_shape,a,-1,this.m_bTrackChanges,this.m_progressTracker)}crack_(a){var b=this.m_shape;var c=this.m_bTrackChanges,d=this.m_progressTracker;pj(b)?(d=new vd(d),d.m_shape=b,d.m_tolerance=a,d.m_bTrackChanges=c,a=!1,a=b.hasCurves()?5:15,
b=a=b.getTotalPointCount()<a?d.crackBruteForce_():d.crackerPlaneSweep_()):b=!1;return b}static fixCurveTwoPointLoops(a,b,c){if(!a.hasCurves())return!1;a.dbgVerifyCurves();c=a.createUserIndexUninitialized();var d=new za(0),e=a.queryVertexIteratorOnSelection();for(var f=e.next();-1!==f;f=e.next())d.add(f),a.setUserIndex(f,c,-1);if(0===d.size())return!1;d.add(-1);a.sortVerticesSimpleByY(d,0,d.size()-1);var g=0;f=a.getXY(d.read(g));var h=new l.Point2D(Number.NaN,Number.NaN);e=[];for(let r=1,t=d.size();r<
t;++r){var k=d.read(r);k=-1!==k?a.getXY(k):h;if(k.equals(f))continue;const u=[];for(;g<r;g++){var m=d.read(g),n=a.getPrevVertex(m);if(-1!==n&&-1===a.getUserIndex(n,c)){var q=Rg(a.getXY(n),a.getSegment(n));0!==l.Point2D.sqrDistance(f,q.otherPt)&&(q.vert=n,q.dir=-1,u.push(q));a.setUserIndex(n,c,1)}n=a.getNextVertex(m);-1!==n&&-1===a.getUserIndex(m,c)&&(n=Rg(a.getXY(n),a.getSegment(m)),0!==l.Point2D.sqrDistance(f,n.otherPt)&&(n.vert=m,n.dir=1,u.push(n)),a.setUserIndex(m,c,1))}if(1<u.length){u.sort((v,
w)=>{{const x=v.otherPt.compare(w.otherPt);0!==x?w=x:null===v.seg||null===w.seg?w=null!==v.seg?-1:null!==w.seg?1:0:(v=v.seg.getGeometryType(),w=w.seg.getGeometryType(),w=v<w?-1:v>w?1:0)}return w});g=Rg(h.clone(),null);u.push(g);g=0;for(let v=1,w=u.length;v<w;v++)if(!u[v].otherPt.equals(u[v-1].otherPt)){if(1<v-g&&null!==u[g].seg){m=!1;n=g;for(q=g+1;q<v;q++)if(!Rm(u[n],u[q])){m=!0;break}if(m)for(;g<v&&null!==u[g].seg;g++)e.push(u[g].vert)}g=v}}g=r;f.setCoordsPoint2D(k)}for(const r of e)d=a.getSegment(r),
p.geometryReleaseAssert(null!==d),f=a.getXY(r),h=a.getXY(a.getNextVertex(r)),l.Point2D.distance(f,h)<3*b?a.setSegmentToIndex(a.getVertexIndex(r),null):(d=d.lengthToT(.5*d.calculateLength2D()),a.splitSegment(r,[d],1));a.removeUserIndex(c);return 0<e.length}firstCrack_(){var a=this.m_shape.getEnvelope2D(this.m_progressTracker),b=Ma(null,a,!0).total();if(4*b<this.m_tolerance.total()){a=!1;var c=this.cluster_(1.1*b);a||=c;c=0;this.m_bFilterDegenerateSegments&&(c=this.m_shape.filterClosePoints(0,!0,!1,
this.m_bTrackChanges,-1));b=this.crack_(b);a||=b;return a?1:c?2:0}return-1}progress_(a=!1){this.m_progressCounter++;if(a||0===(this.m_progressCounter&4095))this.m_progressCounter=0}}var gf=p.isMultiPath,Tm=p.isSegment,If=p.getDimensionFromType;class yb{constructor(a){this.m_topoGraph=null;this.m_maskLookup=[];this.m_dummyPt1=l.Point2D.getNAN();this.m_dummyPt2=l.Point2D.getNAN();this.m_fromEdgeForPolylines=-1;this.m_progressCounter=0;this.m_bOGCOutput=!1;this.m_progressTracker=a}linesToPolygonsImpl(a,
b){var c=0;let d=0,e=null;if(a.hasCurves()){e=new wb;c=a.getEnvelope2D(this.m_progressTracker);d=bc(b.total());var f=xb(b.total(),c);c=3*f+3*d;var g=b.total();Jb(a,f,g,e,null,this.m_progressTracker)}this.setEditShapeCrackAndCluster(a,b.add(c));b=this.m_topoGraph.createUserIndexForChains();c=this.m_topoGraph.getFirstChain();this.m_topoGraph.setChainUserIndex(c,b,1);for(c=this.m_topoGraph.getChainFirstIsland(c);-1!==c;c=this.m_topoGraph.getChainNextInParent(c))this.m_topoGraph.setChainUserIndex(c,b,
1);c=[];for(g=this.m_topoGraph.getFirstChain();-1!==g;g=this.m_topoGraph.getChainNext(g))if(1!==this.m_topoGraph.getChainUserIndex(g,b)){this.m_topoGraph.setChainUserIndex(g,b,1);for(f=this.m_topoGraph.getChainFirstIsland(g);-1!==f;f=this.m_topoGraph.getChainNextInParent(f))this.m_topoGraph.setChainUserIndex(f,b,1);0!==this.m_topoGraph.getChainArea(g)&&(f=this.m_topoGraph.extractPolygonFromChainAndIslands(a,-1,g,-1),null!=e&&e.stitchCurves(a,f,d,!1),f=a.getGeometry(f),c.push(f))}return new bb.SimpleGeometryCursor(c)}autoCompleteImpl(a,
b,c){var d=0;let e=0,f=null;if(a.hasCurves()){f=new wb;d=a.getEnvelope2D(this.m_progressTracker);e=bc(c.total());var g=xb(c.total(),d);d=3*g+3*e;var h=c.total();Jb(a,g,h,f,null,this.m_progressTracker)}this.setEditShapeCrackAndCluster(a,c.add(d));b=this.m_topoGraph.getGeometryID(b);c=this.m_topoGraph.createUserIndexForChains();d=this.m_topoGraph.getFirstChain();this.m_topoGraph.setChainUserIndex(d,c,1);for(d=this.m_topoGraph.getChainFirstIsland(d);-1!==d;d=this.m_topoGraph.getChainNextInParent(d))this.m_topoGraph.setChainUserIndex(d,
c,1);d=[];for(h=this.m_topoGraph.getFirstChain();-1!==h;h=this.m_topoGraph.getChainNext(h)){if(1===this.m_topoGraph.getChainUserIndex(h,c))continue;this.m_topoGraph.setChainUserIndex(h,c,1);for(g=this.m_topoGraph.getChainFirstIsland(h);-1!==g;g=this.m_topoGraph.getChainNextInParent(g))this.m_topoGraph.setChainUserIndex(g,c,1);if(0!==this.m_topoGraph.getChainParentage(h))continue;let k=g=this.m_topoGraph.getChainHalfEdge(h),m=!1;do{const n=this.m_topoGraph.getHalfEdgeTwin(k);if(this.m_topoGraph.getHalfEdgeChain(n)!==
h&&0!==(this.m_topoGraph.getHalfEdgeParentage(k)&b)){m=!0;break}k=this.m_topoGraph.getHalfEdgeNext(k)}while(k!==g);m&&0!==this.m_topoGraph.getChainArea(h)&&(g=this.m_topoGraph.extractPolygonFromChainAndIslands(a,-1,h,-1),null!==f&&f.stitchCurves(a,g,e,!1),g=a.getGeometry(g),d.push(g))}return new bb.SimpleGeometryCursor(d)}setEditShape(a,b=!1){null===this.m_topoGraph&&(this.m_topoGraph=new ec);this.m_topoGraph.setEditShape(a,this.m_progressTracker,!0,b)}setEditShapeCrackAndCluster(a,b){ac(a,b,this.m_progressTracker,
!0,!1);for(b=a.getFirstGeometry();-1!==b;b=a.getNextGeometry(b))a.getGeometryType(b)===p.GeometryType.enumPolygon&&tc(a,b,-1,this.m_bOGCOutput,-1,this.m_progressTracker);this.setEditShape(a)}setHalfEdgeOrientations_(a,b){const c=this.m_topoGraph.getShape();for(let f=c.getFirstGeometry();-1!==f;f=c.getNextGeometry(f))if(f===b)for(let g=c.getFirstPath(f);-1!==g;g=c.getNextPath(g)){var d=c.getFirstVertex(g);if(-1===d)continue;let h=c.getNextVertex(d);for(;-1!==h;){d=this.m_topoGraph.getClusterFromVertex(d);
var e=this.m_topoGraph.getClusterFromVertex(h);d=this.m_topoGraph.getHalfEdgeConnector(d,e);-1!==d&&(e=this.m_topoGraph.getHalfEdgeTwin(d),this.m_topoGraph.setHalfEdgeUserIndex(d,a,1),this.m_topoGraph.setHalfEdgeUserIndex(e,a,2));d=h;h=c.getNextVertex(d)}}}flushVertices_(a,b){const c=this.m_topoGraph.getShape(),d=c.hasSegmentParentage(),e=new W;a=c.insertPath(a,-1);b.push(b[0]);const f=b.length;let g=-1;for(let k=0;k<f;k++){var h=b[k];g=c.addVertex(a,h);if(d&&(h=this.m_topoGraph.getClusterFromVertex(h),
0<k&&this.m_topoGraph.isBreakNode(h)&&c.setSegmentParentageBreakVertex(g,!0),k<f-1)){const m=this.m_topoGraph.getHalfEdgeConnector(h,this.m_topoGraph.getClusterFromVertex(b[k+1])),n=this.m_topoGraph.getSegmentParentage(m);c.setSegmentParentageAndBreak(g,n,0<k||this.m_topoGraph.isBreakNode(h));this.m_topoGraph.isHalfEdgeCurve(m)&&(this.m_topoGraph.querySegmentXY(m,e),c.setSegmentToIndex(c.getVertexIndex(g),e.get().clone()))}}d&&(b=this.m_topoGraph.getClusterFromVertex(b[f-1]),this.m_topoGraph.isBreakNode(b)&&
c.setSegmentParentageBreakVertex(g,!0));c.setClosedPath(a,!0)}processPolygonCuts_(a,b,c,d){c=this.m_topoGraph.getGeometryID(c);d=this.m_topoGraph.getGeometryID(d);const e=[],f=this.m_topoGraph.getShape(),g=this.m_topoGraph.createUserIndexForHalfEdges();for(let m=this.m_topoGraph.getFirstCluster();-1!==m;m=this.m_topoGraph.getNextCluster(m)){const n=this.m_topoGraph.getClusterHalfEdge(m);if(-1===n)continue;let q=n;do{if(1!==this.m_topoGraph.getHalfEdgeUserIndex(q,g)){var h=q;let r=q,t=!1,u=0;do{this.m_topoGraph.setHalfEdgeUserIndex(h,
g,1);t||0===(this.m_topoGraph.getHalfEdgeParentage(h)&d)||0===(this.m_topoGraph.getHalfEdgeFaceParentage(h)&c)||(r=h,t=!0);if(t){var k=this.m_topoGraph.getHalfEdgeOrigin(h);k=this.m_topoGraph.getClusterVertexIterator(k);k=this.m_topoGraph.getVertexFromVertexIterator(k);e.push(k);-1!==a&&0!==(this.m_topoGraph.getHalfEdgeParentage(h)&d)&&(k=this.m_topoGraph.getHalfEdgeUserIndex(h,a),u|=k)}h=this.m_topoGraph.getHalfEdgeNext(h)}while(h!==r);t&&0<this.m_topoGraph.getChainArea(this.m_topoGraph.getHalfEdgeChain(r))&&
(h=f.createGeometry(p.GeometryType.enumPolygon),this.flushVertices_(h,e),-1!==b&&f.setGeometryUserIndex(h,b,u));e.length=0}q=this.m_topoGraph.getHalfEdgeNext(this.m_topoGraph.getHalfEdgeTwin(q))}while(q!==n)}this.m_topoGraph.deleteUserIndexForHalfEdges(g)}cutPolygonPolyline_(a,b,c,d){this.m_topoGraph.removeSpikes_();let e=-1;-1!==a&&(e=this.m_topoGraph.createUserIndexForHalfEdges(),this.setHalfEdgeOrientations_(e,c));this.processPolygonCuts_(e,a,b,c);-1!==e&&(this.m_topoGraph.deleteUserIndexForHalfEdges(e),
e=-1);const f=this.m_topoGraph.getShape();for(a=f.getFirstGeometry();-1!==a;a=f.getNextGeometry(a))a!==b&&a!==c&&d.push(a);d.sort((g,h)=>{g=f.getFirstPath(g);g=f.getRingArea(g);h=f.getFirstPath(h);h=f.getRingArea(h);return g<h?-1:g>h?1:0})}cut(a,b,c,d,e){var f=this.m_topoGraph.getShape().getGeometryType(c),g=this.m_topoGraph.getShape().getGeometryType(d);f=p.getDimensionFromType(f);g=p.getDimensionFromType(g);2===f&&1===g?this.cutPolygonPolyline_(b,c,d,e):1===f&&1===g?(new Nn(this,a,b,c,d,e)).Do():
p.throwInternalErrorException("")}progress_(a){}isGoodParentage(a){return 0<=a&&a<this.m_maskLookup.length?this.m_maskLookup[a]:!1}normalizeInputGeometry(a){var b=a.getGeometryType();if(b===p.GeometryType.enumEnvelope)return b=new ba({vd:a.getDescription()}),a.isEmpty()||b.addEnvelope(a,!1),b;if(b===p.GeometryType.enumPoint)return b=new Oa({vd:a.getDescription()}),a.isEmpty()||b.add(a),b;if(p.isSegment(b))return b=new ma({vd:a.getDescription()}),a.isEmpty()||b.addSegment(a,!0),b;b!==p.GeometryType.enumMultiPoint&&
b!==p.GeometryType.enumPolyline&&b!==p.GeometryType.enumPolygon&&p.throwInvalidArgumentException("Unexpected geometry type");return a}dissolveNonSimplePolygons(a,b,c,d){p.geometryReleaseAssert(0<b);d=new Fa;let e=0,f=-1;for(let g=0,h=b;g<h;g++)2===a[g].getDimension()&&(-1===f&&(f=g),a[g].isEmpty()||(e++,d.addGeometry(a[g])));return 0===e?(p.geometryReleaseAssert(0<=f),this.normalizeInputGeometry(a[f])):this.planarSimplifyPolygons(d,c,!0,!1,-1,!0)}dissolveMultiPaths_(a,b,c,d,e,f,g){p.geometryReleaseAssert(1<=
a&&2>=a);p.geometryReleaseAssert(0<d);const h=0!==(8&f)?1:2;var k=ub.constructEmpty(),m=0,n=-1,q=!0;for(let B=0,E=d;B<E;B++)if(c[B].getDimension()===a&&(-1===n&&(n=B),!c[B].isEmpty())){n=B;m++;var r=ub.constructEmpty();c[B].queryLooseEnvelope(r);k.mergeEnv3D(r);2===a&&q&&c[B].getGeometryType()===p.GeometryType.enumPolygon&&(0===(f&16)?(r=Kh(c[B],0),q&&=r):(r=c[B].getImpl().getIsSimple(0,[0]),r=this.m_bOGCOutput?5===r:4<=r,q&&=r))}if(2>m&&(p.geometryReleaseAssert(0<=n),0===m||0===(f&16)))return this.normalizeInputGeometry(c[n]);
if(!q)return a=Ma(b?null:e,k.getEnvelope2D(),!0),this.dissolveNonSimplePolygons(c,d,a,f);q=c.slice(0,d);c=Ma(e,k.getEnvelope2D(),!0);r=10*kb(c);var t=new jb(0,0);g&&(t=Md(e,k.getEnvelopeZs(),!0));if(1===m&&1===a&&2===h&&!b)return g?(p.geometryReleaseAssert(0),{}):this.m_bOGCOutput?Sg(q[n],c,!1,-1,this.m_progressTracker,h,!1):cf(q[n],c,!1,!1,-1,this.m_progressTracker,h,!1);var u=new Od;u.startConstruction();m=2===a?3:4;var v=0;for(let B=0,E=d;B<E;B++)if(q[B].getDimension()===a&&!q[B].isEmpty()){var w=
q[B].getGeometryType();if(w!==p.GeometryType.enumEnvelope){p.isSegment(w)?(q[B]=this.normalizeInputGeometry(q[B]),w=p.GeometryType.enumPolyline):p.geometryReleaseAssert(p.isMultiPath(w));1===a?(p.geometryReleaseAssert(w===p.GeometryType.enumPolyline),w=-1,g?p.geometryReleaseAssert(0,"3d not implemented yet"):w=q[B].getImpl().getIsSimple(c.total(),[0]),(this.m_bOGCOutput?5===w:4<=w)||(b?m=-1:(g?p.geometryReleaseAssert(0,"3d not implemented yet"):q[B]=this.m_bOGCOutput?Sg(q[B],c,!1,-1,this.m_progressTracker,
h,!1):cf(q[B],c,!1,!1,-1,this.m_progressTracker,h,!1),p.geometryReleaseAssert(4<=q[B].getImpl().getIsSimple(c.total(),[0]))))):(p.geometryReleaseAssert(w===p.GeometryType.enumPolygon),w=q[B].getImpl().getIsSimple(0,[0]),p.geometryReleaseAssert(3<=w));w=q[B].getImpl();for(let G=0,I=w.getPathCount();G<I;G++)n=D.constructEmpty(),w.queryLoosePathEnvelope(G,n),n.inflateCoords(r,r),u.addEnvelope(v,n),v++}else p.geometryReleaseAssert(w===p.GeometryType.enumEnvelope),m=D.constructEmpty(),q[B].queryLooseEnvelope(m),
m.inflateCoords(r,r),u.addEnvelope(v,m),v++,m=-1}u.endConstruction();var x=v;r=l.makePrimitiveArray(x,-2147483647);w=l.makePrimitiveArray(x,-1);var y=0;n=-1;v=0;for(let B=0,E=d;B<E;B++)if(q[B].getDimension()===a&&(-1===n&&(n=B),!q[B].isEmpty())){n=B;y++;var z=q[B].getGeometryType();if(p.isMultiPath(z)){z=q[B];for(let G=0,I=z.getPathCount();G<I;G++)w[v]=B,r[v]=-G-1,v++}else p.geometryReleaseAssert(z===p.GeometryType.enumEnvelope),w[v]=B,r[v]=-1,v++}if(2>y&&2===a)return p.geometryReleaseAssert(0<=n),
this.normalizeInputGeometry(q[n]);for(v=x;u.next()&&0<v;)this.progress_(),y=u.getHandleA(),x=u.getHandleB(),y=u.getElement(y),x=u.getElement(x),w[y]!==w[x]&&(0>r[y]&&(v--,r[y]=-(r[y]+1)),0>r[x]&&(v--,r[x]=-(r[x]+1)));v=new Fa;u=!1;x=0;for(let B=0,E=d;B<E;B++){if(q[B].getDimension()!==a||q[B].isEmpty())continue;z=q[B].getGeometryType();y=x;var A=0,C=0;d=p.isMultiPath(z)?q[B]:null;for(let I=y,H=r.length;I<H&&w[I]===B;I++)0<=r[I]&&(A++,C=d?C+d.getPathSize(r[I]):C+p.vertexCount(q[B])),x++;const G=p.vertexCount(q[B]);
if(C>.95*G)for(v.addGeometry(this.normalizeInputGeometry(q[B])),d=y;d<x;d++)0>r[d]&&(r[d]=-(r[d]+1));else if(0===A)u=!0;else{u=!0;p.geometryReleaseAssert(p.isMultiPath(z));p.geometryReleaseAssert(null!=d);A=new ba({vd:q[B].getDescription()});C=new ma({vd:q[B].getDescription()});for(z=z===p.GeometryType.enumPolygon?A:C;y<x;y++)0<=r[y]&&z.addPath(d,r[y],!0);v.addGeometry(z)}}-1!==v.getFirstGeometry()?(d=2===a,n=b?Ma(null,k.getEnvelope2D(),!0):c,x=new jb(0,0),g&&(x=b?Md(null,k.getEnvelopeZs(),!0):t),
2===a&&0===(f&2)&&(v.collapseAllGeometriesToFirst(),f=0,k=null,v.hasCurves()&&!v.hasSegmentParentage()&&(k=new wb,t=v.getEnvelope2D(this.m_progressTracker),f=bc(n.total()),y=xb(n.total(),t),t=n.total(),Jb(v,y,t,k,null,this.m_progressTracker)),t=v.getFirstGeometry(),y=n.total(),z=this.m_progressTracker,0<y&&lj(v,y,t,!1,z),(new Kn(z)).executeImpl_(v,t),null!==k&&k.stitchCurves(v,-1,f,!0)),g?f=this.planarSimplify3DImpl_(v,n,x,h,!0):2===a?f=this.planarSimplifyPolygons(v,n,d,b,-1,!1):(f=yd(),f.ogcRule=
this.m_bOGCOutput,f.allCrossRoadsImpassable=!0,f.unsplitBehavior=h,f=this.planarSimplifyPolylines(v,n,b,f,-1)),u||(m=f.getImpl().getIsSimple(n.total(),[0]))):(p.geometryReleaseAssert(u),p.geometryReleaseAssert(0<=n),f=2===a?new ba({vd:q[n].getDescription()}):new ma({vd:q[n].getDescription()}));if(u){k=0;for(let B=0,E=r.length;B<E;B++)t=w[B],!(0>t)&&0>r[B]&&(n=q[t].getGeometryType(),k=(t=p.isMultiPath(n)?q[t]:null)?k+t.getPathSize(-(r[B]+1)):k+4);f.reserve(f.getPointCount()+k);for(let B=0,E=r.length;B<
E;B++)k=w[B],!(0>k)&&0>r[B]&&(t=q[k].getGeometryType(),(n=p.isMultiPath(t)?q[k]:null)?f.addPath(n,-(r[B]+1),!0):t===p.GeometryType.enumEnvelope?f.addEnvelope(q[k],!1):(p.geometryReleaseAssert(p.isSegment(t)),f.addSegment(q[k],!0)))}q=0;2===a?-1!==m&&(m=3,q=b?0:c.total()):(p.geometryReleaseAssert(1===a),b||-1===m||(q=c.total()));g||f.getImpl().setIsSimple(m,q);if(!b&&u)if(2===a)if(g)p.geometryReleaseAssert(0,"3d not yet implemented");else return(new nc).execute(f,e,!1,this.m_progressTracker);else 1===
a&&1!==h&&(p.geometryReleaseAssert(0),f={},f.getImpl().setIsSimple(m,q));return f}dissolveTopoGraphCommonEdges_(){const a=this.m_topoGraph.createUserIndexForHalfEdges(),b=[];for(let d=this.m_topoGraph.getFirstCluster();-1!==d;d=this.m_topoGraph.getNextCluster(d)){const e=this.m_topoGraph.getClusterHalfEdge(d);let f=e;if(-1!==e){do{this.progress_();if(1!==this.m_topoGraph.getHalfEdgeUserIndex(f,a)){var c=this.m_topoGraph.getHalfEdgeTwin(f);this.m_topoGraph.setHalfEdgeUserIndex(c,a,1);this.m_topoGraph.setHalfEdgeUserIndex(f,
a,1);const g=this.m_topoGraph.getHalfEdgeFaceParentage(f);this.isGoodParentage(g)&&(c=this.m_topoGraph.getHalfEdgeFaceParentage(c),this.isGoodParentage(c)&&b.push(f))}f=this.m_topoGraph.getHalfEdgeNext(this.m_topoGraph.getHalfEdgeTwin(f))}while(f!==e)}}this.m_topoGraph.deleteUserIndexForHalfEdges(a);this.m_topoGraph.deleteEdgesBreakFaces_(b)}chooseVertexByOrder(a,b,c,d){var e=l.indexTypeMax();let f=-1;for(a=this.m_topoGraph.getClusterVertexIterator(a);-1!==a;a=this.m_topoGraph.incrementVertexIterator(a)){const g=
this.m_topoGraph.getVertexFromVertexIterator(a),h=b.getUserIndex(g,c);0<=h&&h<e&&(e=h,f=g)}p.geometryReleaseAssert(-1!==f);e=b.getUserIndex(f,d);0<e&&(b.setUserIndex(f,d,--e),0===e&&b.setUserIndex(f,c,-1));return f}chooseVertexFromCluster_(a,b){return this.m_topoGraph.getVertexDominantFromCluster(a,b)}chooseVertexFromVertexCluster_(a,b){return this.m_topoGraph.getVertexDominant(a,b)}collectPolygonPathsPreservingFrom_(a,b,c,d,e){const f=this.m_topoGraph.getShape();if(f.getGeometryType(a)===p.GeometryType.enumPolygon){var g=
f.hasSegmentParentage(),h=new W;for(a=f.getFirstPath(a);-1!==a;a=f.getNextPath(a)){var k=f.getFirstVertex(a);this.m_topoGraph.getClusterFromVertex(k);const t=this.m_topoGraph.getHalfEdgeFromVertex(k);if(-1===t)continue;var m=this.m_topoGraph.getHalfEdgeUserIndex(t,c);if(1===m||2===m)continue;m=this.m_topoGraph.getHalfEdgeFaceParentage(t);if(!this.isGoodParentage(m)){this.m_topoGraph.setHalfEdgeUserIndex(t,c,2);continue}this.m_topoGraph.setHalfEdgeUserIndex(t,c,1);m=f.insertPath(b,-1);f.setClosedPath(m,
!0);let u=t;var n=k;let v=this.m_topoGraph.getClusterFromVertex(n);k=1;do{this.progress_();var q=this.chooseVertexFromVertexCluster_(n,e);q=f.addVertex(m,q);this.m_topoGraph.isHalfEdgeCurve(u)&&(this.m_topoGraph.querySegmentXY(u,h),f.setSegmentToIndex(f.getVertexIndex(q),h.get().clone()));if(g){var r=this.m_topoGraph.getSegmentParentage(u);f.setSegmentParentageAndBreak(q,r,this.m_topoGraph.isBreakNode(v))}-1!==d&&this.m_topoGraph.setClusterUserIndex(v,d,1);this.m_topoGraph.setHalfEdgeUserIndex(u,
c,1);u=this.m_topoGraph.getHalfEdgeNext(u);do r=1===k?f.getNextVertex(n):f.getPrevVertex(n),q=-1!==r?this.m_topoGraph.getClusterFromVertex(r):-1;while(q===v);const w=this.m_topoGraph.getHalfEdgeOrigin(u);if(w!==q){do r=1===k?f.getPrevVertex(n):f.getNextVertex(n),q=-1!==r?this.m_topoGraph.getClusterFromVertex(r):-1;while(q===v);w!==q?(q=w,n=this.m_topoGraph.getClusterVertexIterator(q),r=this.m_topoGraph.getVertexFromVertexIterator(n)):k=-k}v=q;n=r}while(u!==t)}}}topoOperationPolygonPolygonHelper_(a,
b,c,d,e,f){this.progress_(!0);-1!==a&&this.collectPolygonPathsPreservingFrom_(a,c,e,f,d);-1!==b&&this.collectPolygonPathsPreservingFrom_(b,c,e,f,d);a=new W;b=this.m_topoGraph.getShape();b.dbgVerifyCurves();const g=b.hasSegmentParentage();for(let n=this.m_topoGraph.getFirstCluster();-1!==n;n=this.m_topoGraph.getNextCluster(n)){const q=this.m_topoGraph.getClusterHalfEdge(n);if(-1===q)continue;let r=q;do{this.progress_();var h=this.m_topoGraph.getHalfEdgeUserIndex(r,e);if(1!==h&&2!==h)if(h=this.m_topoGraph.getHalfEdgeFaceParentage(r),
this.isGoodParentage(h)){h=b.insertPath(c,-1);b.setClosedPath(h,!0);let t=r;do{var k=this.m_topoGraph.getHalfEdgeVertexIterator(t),m=-1;-1!==k?m=this.m_topoGraph.getVertexFromVertexIterator(k):(k=this.m_topoGraph.getHalfEdgeVertexIterator(this.m_topoGraph.getHalfEdgeTwin(t)),m=this.m_topoGraph.getVertexFromVertexIterator(k),m=b.getNextVertex(m));k=this.chooseVertexFromVertexCluster_(m,d);m=b.addVertex(h,k);if(g){const u=this.m_topoGraph.getSegmentParentage(t),v=this.m_topoGraph.getHalfEdgeOrigin(t);
b.setSegmentParentageAndBreak(m,u,this.m_topoGraph.isBreakNode(v))}this.m_topoGraph.isHalfEdgeCurve(t)&&(this.m_topoGraph.querySegmentXY(t,a),b.setSegmentToIndex(b.getVertexIndex(m),a.get().clone()));this.m_topoGraph.setHalfEdgeUserIndex(t,e,1);-1!==f&&(k=this.m_topoGraph.getClusterFromVertex(k),this.m_topoGraph.setClusterUserIndex(k,f,1));t=this.m_topoGraph.getHalfEdgeNext(t)}while(t!==r)}else this.m_topoGraph.setHalfEdgeUserIndex(r,e,2);r=this.m_topoGraph.getHalfEdgeNext(this.m_topoGraph.getHalfEdgeTwin(r))}while(r!==
q)}}topoOperationPolygonPolygon_(a,b,c,d=!1){this.dissolveTopoGraphCommonEdges_();const e=this.m_topoGraph.getShape(),f=e.createGeometry(p.GeometryType.enumPolygon),g=this.m_topoGraph.createUserIndexForHalfEdges();this.topoOperationPolygonPolygonHelper_(a,b,f,c,g,-1);this.m_topoGraph.deleteUserIndexForHalfEdges(g);d||tc(e,f,3,this.m_bOGCOutput,-1,this.m_progressTracker);return f}topoOperationPolyline_(a,b){const c=yd();c.allCrossRoadsImpassable=!1;c.ogcRule=b;c.unsplitBehavior=0;return this.topoOperationPolylineSimplifyOrPolylineTopoHelper_(-1,
a,!1,c).first}topoOperationMultiPoint_(){const a=this.m_topoGraph.getShape(),b=a.createGeometry(p.GeometryType.enumMultiPoint),c=a.insertPath(b,-1);for(let f=this.m_topoGraph.getFirstCluster();-1!==f;f=this.m_topoGraph.getNextCluster(f)){var d=this.m_topoGraph.getClusterParentage(f);if(this.isGoodParentage(d)){d=-1;for(let g=this.m_topoGraph.getClusterVertexIterator(f);-1!==g;g=this.m_topoGraph.incrementVertexIterator(g)){const h=this.m_topoGraph.getVertexFromVertexIterator(g);-1===d&&(d=h);var e=
a.getGeometryFromPath(a.getPathFromVertex(h));e=this.m_topoGraph.getGeometryID(e);if(this.isGoodParentage(e)){d=h;break}}a.addVertex(c,d)}}return b}intersection(a,b){var c=this.m_topoGraph.getShape().getGeometryType(a),d=this.m_topoGraph.getShape().getGeometryType(b);c=p.getDimensionFromType(c);d=p.getDimensionFromType(d);var e=this.m_topoGraph.getGeometryID(a);const f=this.m_topoGraph.getGeometryID(b);p.geometryReleaseAssert(0<=e);p.geometryReleaseAssert(0<=f);this.m_maskLookup.length=0;this.m_maskLookup.length=
(e|f)+1;this.m_maskLookup[e|f]=!0;e=-1;1<this.m_topoGraph.getShape().getVertexDescription().getAttributeCount()&&(e=a);if(2===c&&2===d)return this.topoOperationPolygonPolygon_(a,b,e);if(1===c&&0<d||1===d&&0<c)return this.topoOperationPolyline_(e,this.m_bOGCOutput);if(0===c||0===d)return this.topoOperationMultiPoint_();p.throwInternalErrorException("")}topoOperationPolygonPolygonEx(a,b,c){const d=this.m_topoGraph.getShape(),e=d.createGeometry(p.GeometryType.enumPolygon),f=d.createGeometry(p.GeometryType.enumPolyline),
g=d.createGeometry(p.GeometryType.enumMultiPoint);this.dissolveTopoGraphCommonEdges_();let h=-1;const k=this.m_topoGraph.createUserIndexForHalfEdges(),m=this.m_topoGraph.createUserIndexForClusters();d.dbgVerifyCurves();this.topoOperationPolygonPolygonHelper_(a,b,e,c,k,m);d.dbgVerifyCurves();a=d.hasSegmentParentage();b=new W;for(var n=this.m_topoGraph.getFirstCluster();-1!==n;n=this.m_topoGraph.getNextCluster(n)){const u=this.m_topoGraph.getClusterHalfEdge(n);if(-1===u)continue;let v=u;do{var q=this.m_topoGraph.getHalfEdgeUserIndex(v,
k),r=this.m_topoGraph.getHalfEdgeUserIndex(this.m_topoGraph.getHalfEdgeTwin(v),k);q|=r;if(2===q)if(q=this.m_topoGraph.getHalfEdgeParentage(v),this.isGoodParentage(q)){const w=d.insertPath(f,-1);let x=v;var t=this.chooseVertexFromCluster_(n,c);t=d.addVertex(w,t);a&&(q=this.m_topoGraph.getSegmentParentage(v),r=this.m_topoGraph.getHalfEdgeOrigin(v),d.setSegmentParentageAndBreak(t,q,this.m_topoGraph.isBreakNode(r)));this.m_topoGraph.isHalfEdgeCurve(v)&&(this.m_topoGraph.querySegmentXY(v,b),d.setSegmentToIndex(d.getVertexIndex(t),
b.get().clone()));this.m_topoGraph.setClusterUserIndex(n,m,1);do{this.progress_();q=this.m_topoGraph.getHalfEdgeTo(x);t=this.chooseVertexFromCluster_(q,c);t=d.addVertex(w,t);if(a){r=this.m_topoGraph.getSegmentParentage(v);const y=this.m_topoGraph.getHalfEdgeOrigin(v);d.setSegmentParentageAndBreak(t,r,this.m_topoGraph.isBreakNode(y))}this.m_topoGraph.setHalfEdgeUserIndex(x,k,1);this.m_topoGraph.setHalfEdgeUserIndex(this.m_topoGraph.getHalfEdgeTwin(x),k,1);this.m_topoGraph.setClusterUserIndex(q,m,1);
x=this.m_topoGraph.getHalfEdgeNext(x);q=this.m_topoGraph.getHalfEdgeUserIndex(x,k);r=this.m_topoGraph.getHalfEdgeUserIndex(this.m_topoGraph.getHalfEdgeTwin(x),k);q|=r;if(2!==q)break;q=this.m_topoGraph.getHalfEdgeParentage(x);if(!this.isGoodParentage(q)){this.m_topoGraph.setHalfEdgeUserIndex(x,k,1);this.m_topoGraph.setHalfEdgeUserIndex(this.m_topoGraph.getHalfEdgeTwin(x),k,1);break}this.m_topoGraph.isHalfEdgeCurve(v)&&x!==v&&(this.m_topoGraph.querySegmentXY(v,b),d.setSegmentToIndex(d.getVertexIndex(t),
b.get().clone()))}while(x!==v)}else this.m_topoGraph.setHalfEdgeUserIndex(v,k,1),this.m_topoGraph.setHalfEdgeUserIndex(this.m_topoGraph.getHalfEdgeTwin(v),k,1);v=this.m_topoGraph.getHalfEdgeNext(this.m_topoGraph.getHalfEdgeTwin(v))}while(v!==u)}for(a=this.m_topoGraph.getFirstCluster();-1!==a;a=this.m_topoGraph.getNextCluster(a))this.progress_(),1!==this.m_topoGraph.getClusterUserIndex(a,m)&&(b=this.m_topoGraph.getClusterParentage(a),this.isGoodParentage(b)&&(-1===h&&(h=d.insertPath(g,-1)),b=this.m_topoGraph.getClusterVertexIterator(a),
n=-1,-1!==b&&(n=this.m_topoGraph.getVertexFromVertexIterator(b),b=this.chooseVertexFromVertexCluster_(n,c),d.addVertex(h,b))));this.m_topoGraph.deleteUserIndexForClusters(m);this.m_topoGraph.deleteUserIndexForHalfEdges(k);d.dbgVerifyCurves();tc(d,e,3,this.m_bOGCOutput,-1,this.m_progressTracker);c=[-1,-1,-1];c[0]=g;c[1]=f;c[2]=e;return c}topoOperationPolylinePolylineOrPolygonEx(a,b){const c=yd();c.allCrossRoadsImpassable=!1;c.ogcRule=b;c.unsplitBehavior=0;return this.topoOperationPolylineSimplifyOrPolylineTopoHelper_(-1,
a,!0,c)}topoOperationMultiPoint(){const a=this.m_topoGraph.getShape(),b=a.createGeometry(p.GeometryType.enumMultiPoint),c=a.insertPath(b,-1);for(let f=this.m_topoGraph.getFirstCluster();-1!==f;f=this.m_topoGraph.getNextCluster(f)){var d=this.m_topoGraph.getClusterParentage(f);if(this.isGoodParentage(d)){d=-1;for(let g=this.m_topoGraph.getClusterVertexIterator(f);-1!==g;g=this.m_topoGraph.incrementVertexIterator(g)){const h=this.m_topoGraph.getVertexFromVertexIterator(g);-1===d&&(d=h);var e=a.getGeometryFromPath(a.getPathFromVertex(h));
e=this.m_topoGraph.getGeometryID(e);if(this.isGoodParentage(e)){d=h;break}}a.addVertex(c,d)}}return b}intersectionEx(a,b){var c=this.m_topoGraph.getShape().getGeometryType(a),d=this.m_topoGraph.getShape().getGeometryType(b);c=If(c);d=If(d);var e=this.m_topoGraph.getGeometryID(a);const f=this.m_topoGraph.getGeometryID(b);p.geometryReleaseAssert(0<=e);p.geometryReleaseAssert(0<=f);this.m_maskLookup.length=0;this.m_maskLookup.length=(e|f)+1;this.m_maskLookup[e|f]=!0;e=-1;1<this.m_topoGraph.getShape().getVertexDescription().getAttributeCount()&&
(e=a);if(2===c&&2===d)return this.topoOperationPolygonPolygonEx(a,b,e);if(1===c&&0<d||1===d&&0<c){const {first:g,second:h}=this.topoOperationPolylinePolylineOrPolygonEx(e,this.m_bOGCOutput);return[h,g]}if(0===c||0===d)return a=[],a.push(this.topoOperationMultiPoint()),a;p.throwInternalErrorException("")}getCombinedHalfEdgeParentage(a){return this.m_topoGraph.getHalfEdgeParentage(a)|this.m_topoGraph.getHalfEdgeFaceParentage(a)|this.m_topoGraph.getHalfEdgeFaceParentage(this.m_topoGraph.getHalfEdgeTwin(a))}prevailingDirection(a,
b){const c=this.getCombinedHalfEdgeParentage(b),d=this.m_topoGraph.getHalfEdgeOrigin(b),e=this.m_topoGraph.getHalfEdgeTo(b);let f=0,g=0;for(let n=this.m_topoGraph.getClusterVertexIterator(d);-1!==n;n=this.m_topoGraph.incrementVertexIterator(n)){var h=this.m_topoGraph.getVertexFromVertexIterator(n),k=a.getPathFromVertex(h),m=a.getGeometryFromPath(k);m=this.m_topoGraph.getGeometryID(m);k=a.getFirstVertex(k);(m=0!==(m&c))&&k===h&&(this.m_fromEdgeForPolylines=b);const q=a.getNextVertex(h);-1!==q&&this.m_topoGraph.getClusterFromVertex(q)===
e?(f++,m&&(-1===this.m_fromEdgeForPolylines&&k===q&&(h=this.m_topoGraph.getHalfEdgeNext(b),this.isGoodParentage(this.getCombinedHalfEdgeParentage(h))&&(this.m_fromEdgeForPolylines=h)),g++)):(h=a.getPrevVertex(h),-1!==h&&this.m_topoGraph.getClusterFromVertex(h)===e&&(f--,m&&(-1===this.m_fromEdgeForPolylines&&k===h&&(h=this.m_topoGraph.getHalfEdgeNext(b),this.isGoodParentage(this.getCombinedHalfEdgeParentage(h))&&(this.m_fromEdgeForPolylines=h)),g--)))}this.m_topoGraph.queryXY(d,this.m_dummyPt1);this.m_topoGraph.queryXY(e,
this.m_dummyPt2);a=l.Point2D.distance(this.m_dummyPt1,this.m_dummyPt2);return(0!==g?g:f)*a}tryMoveThroughCrossroadBackwards(a,b){var c=this.m_topoGraph.getHalfEdgePrev(a),d=this.m_topoGraph.getHalfEdgeTwin(c);if(!b){if(this.m_topoGraph.isStrongPathNode(this.m_topoGraph.getHalfEdgeOrigin(a)))return-1;b=this.m_topoGraph.getHalfEdgeTwin(a);b=this.m_topoGraph.getHalfEdgeNext(b);if(d===b)return c}c=d;for(d=-1;c!==a;){b=this.getCombinedHalfEdgeParentage(c);if(this.isGoodParentage(b)){if(-1!==d)return-1;
d=this.m_topoGraph.getHalfEdgeTwin(c)}c=this.m_topoGraph.getHalfEdgeTwin(this.m_topoGraph.getHalfEdgePrev(c))}return d}tryMoveThroughCrossroadForward(a,b){var c=this.m_topoGraph.getHalfEdgeNext(a),d=this.m_topoGraph.getHalfEdgeTwin(c);if(!b){b=this.m_topoGraph.getHalfEdgeTwin(a);if(this.m_topoGraph.isStrongPathNode(this.m_topoGraph.getHalfEdgeOrigin(b)))return-1;b=this.m_topoGraph.getHalfEdgePrev(b);if(d===b)return c}c=d;for(d=-1;c!==a;){b=this.getCombinedHalfEdgeParentage(c);if(this.isGoodParentage(b)){if(-1!==
d)return-1;d=this.m_topoGraph.getHalfEdgeTwin(c)}c=this.m_topoGraph.getHalfEdgeTwin(this.m_topoGraph.getHalfEdgeNext(c))}return d}isOnALoop(a,b){let c=a;const d=2*this.m_topoGraph.getShape().getTotalPointCount()+10;for(let e=0;e<d;e++){if(1===this.m_topoGraph.getHalfEdgeUserIndex(c,b))return!1;const f=this.m_topoGraph.getHalfEdgeNext(c);if(f===this.m_topoGraph.getHalfEdgeTwin(c))return!1;c=f;if(c===a)return!0}p.throwInternalErrorException("is_on_a_loop_")}restorePolylineParts(a,b,c,d,e,f,g,h,k,m){p.geometryReleaseAssert(-1===
e&&0<=f&&0<=g||-1===f&&-1===g);p.geometryReleaseAssert(-1===h&&1!==m.unsplitBehavior||-1!==h&&1===m.unsplitBehavior);var n=m.ogcRule;const q=m.allCrossRoadsImpassable;var r=1===m.unsplitBehavior,t=0===m.unsplitBehavior;m=this.m_topoGraph.getShape();const u=m.hasSegmentParentage();var v=a,w=this.m_topoGraph.getHalfEdgeTwin(v);const x=new W;this.m_fromEdgeForPolylines=-1;var y=this.prevailingDirection(m,v),z=v;let A=-1;var C=!1,B=!1;let E=!1;if(!r){do{var G=this.m_topoGraph.getHalfEdgePrev(v);if(G===
w){E=!0;break}var I=this.m_topoGraph.getHalfEdgeNext(w);if(this.m_topoGraph.isStrongPathNode(this.m_topoGraph.getHalfEdgeOrigin(I))){C=!0;break}if(this.m_topoGraph.getHalfEdgeTwin(G)!==I)if(q){C=!0;break}else if(v=this.tryMoveThroughCrossroadBackwards(v,!0),-1===v){C=!0;break}else w=this.m_topoGraph.getHalfEdgeTwin(v);else v=G,w=I;if(1===this.m_topoGraph.getHalfEdgeUserIndex(v,c)){E=!0;break}if(v===a){A=a;B=!0;break}G=this.getCombinedHalfEdgeParentage(v);if(!this.isGoodParentage(G))break;z=v;y+=this.prevailingDirection(m,
v)}while(1)}if(-1===A){v=a;w=this.m_topoGraph.getHalfEdgeTwin(v);for(A=v;;){B=this.m_topoGraph.getHalfEdgeNext(v);if(G=this.m_topoGraph.isStrongPathNode(this.m_topoGraph.getHalfEdgeOrigin(B))){C=!0;break}if(B===w){E=!0;break}if(-1!==h&&(I=this.m_topoGraph.getHalfEdgeOrigin(w),1===this.m_topoGraph.getClusterUserIndex(I,h))){C=!0;break}I=this.m_topoGraph.getHalfEdgePrev(w);if(this.m_topoGraph.getHalfEdgeTwin(B)!==I)if(G||q){C=!0;break}else if(v=this.tryMoveThroughCrossroadForward(v,!0),-1===v){C=!0;
break}else w=this.m_topoGraph.getHalfEdgeTwin(v);else v=B,w=I;if(1===this.m_topoGraph.getHalfEdgeUserIndex(v,c)){E=!0;break}B=this.getCombinedHalfEdgeParentage(v);if(!this.isGoodParentage(B))break;A=v;y+=this.prevailingDirection(m,v)}v=this.m_topoGraph.getHalfEdgeOrigin(z);B=this.m_topoGraph.getHalfEdgeTo(A)===v}else-1!==this.m_fromEdgeForPolylines&&(z=a,A=this.tryMoveThroughCrossroadBackwards(z,!1),p.geometryReleaseAssert(-1!==A),v=this.m_topoGraph.getHalfEdgeTwin(z),this.m_topoGraph.getHalfEdgeNext(v));
v=B;B||E||!k||(v=this.isOnALoop(a,c))||(v=this.isOnALoop(w,c));y=0<=y;k=!1;if(v&&C)if(B)k=n,y&&(k||r||t)&&z!==a&&(p.geometryReleaseAssert(!r),z=a,k=!1);else if(r||y&&t)z=a;a=0;for(v=z;;){w=this.m_topoGraph.getHalfEdgeTwin(v);this.m_topoGraph.setHalfEdgeUserIndex(v,c,1);this.m_topoGraph.setHalfEdgeUserIndex(w,c,1);a++;if(v===A)break;v=q?this.m_topoGraph.getHalfEdgeNext(v):this.tryMoveThroughCrossroadForward(v,!1)}y||(A=l.swap(z,z=A),A=this.m_topoGraph.getHalfEdgeTwin(A),z=this.m_topoGraph.getHalfEdgeTwin(z));
c=m.insertPath(b,-1);v=z;z=this.m_topoGraph.getHalfEdgeOrigin(z);n=-1!==f?this.chooseVertexByOrder(z,m,f,g):this.chooseVertexFromCluster_(z,e);this.m_topoGraph.isStrongPathNode(z)&&m.setStrongPathStart(c,!0);r=m.addVertex(c,n);-1!==d&&this.m_topoGraph.setClusterUserIndex(z,d,1);z=0;a=k?Math.trunc((a+1)/2):-1;w=-1;n=!0;for(t=-1;;){u&&(t=this.m_topoGraph.getSegmentParentage(v),C=this.m_topoGraph.getHalfEdgeOrigin(v),m.setSegmentParentageAndBreak(r,t,n||this.m_topoGraph.isBreakNode(C)));n=!1;this.m_topoGraph.isHalfEdgeCurve(v)&&
(this.m_topoGraph.querySegmentXY(v,x),m.setSegmentToIndex(m.getVertexIndex(r),x.get().clone()));-1!==w&&-1!==g&&m.addToUserIndex(w,g,-1);C=q?this.m_topoGraph.getHalfEdgeNext(v):this.tryMoveThroughCrossroadForward(v,!1);w=this.m_topoGraph.getHalfEdgeTo(v);y=-1!==f?this.chooseVertexByOrder(w,m,f,g):this.chooseVertexFromCluster_(w,e);r=m.addVertex(c,y);t=w;-1!==d&&this.m_topoGraph.setClusterUserIndex(w,d,1);u&&this.m_topoGraph.isBreakNode(w)&&m.setSegmentParentageBreakVertex(r,!0);w=y;z++;k&&z===a&&
(c=m.insertPath(b,-1),r=m.addVertex(c,y),n=!0,-1!==g&&m.addToUserIndex(y,g,-1),w=-1);if(v===A)break;v=C}-1!==t&&this.m_topoGraph.isStrongPathNode(t)&&m.setStrongPathEnd(c,!0)}topoOperationPolylineSimplify_(a,b){return this.topoOperationPolylineSimplifyOrPolylineTopoHelper_(a,-1,!1,b).first}topoOperationPolylineSimplifyOrPolylineTopoHelper_(a,b,c,d){p.geometryReleaseAssert(-1===b||-1===a);const e=this.m_topoGraph.getShape();var f=w=>w=-1===a?-1===w?e.getFirstGeometry():e.getNextGeometry(w):-1===w?
a:-1;const g=e.createGeometry(p.GeometryType.enumPolyline);let h=-1;c&&(h=this.m_topoGraph.createUserIndexForClusters());const k=this.m_topoGraph.createUserIndexForHalfEdges(),m=-1===b?e.createUserIndex():-1,n=-1===b?e.createUserIndex():-1;var q=-1;if(1===d.unsplitBehavior){q=this.m_topoGraph.createUserIndexForClusters();for(var r=f(-1);-1!==r;r=f(r))for(var t=e.getFirstPath(r);-1!==t;t=e.getNextPath(t)){var u=e.getFirstVertex(t);u=this.m_topoGraph.getClusterFromVertex(u);this.m_topoGraph.setClusterUserIndex(u,
q,1);e.isClosedPath(t)||(u=e.getLastVertex(t),u=this.m_topoGraph.getClusterFromVertex(u),this.m_topoGraph.setClusterUserIndex(u,q,1))}}if(-1===b)for(r=0,t=f(-1);-1!==t;t=f(t))for(u=e.getFirstPath(t);-1!==u;u=e.getNextPath(u))if(e.isClosedPath(u)){var v=e.getFirstVertex(u);for(let w=0,x=e.getPathSize(u);w<x;w++,v=e.getNextVertex(v))e.setUserIndex(v,m,r++),e.setUserIndex(v,n,2)}else{v=e.getFirstVertex(u);e.setUserIndex(v,m,r++);e.setUserIndex(v,n,1);v=e.getNextVertex(v);for(let w=1,x=e.getPathSize(u)-
1;w<x;++w)e.setUserIndex(v,m,r++),e.setUserIndex(v,n,2),v=e.getNextVertex(v);e.setUserIndex(v,m,r++);e.setUserIndex(v,n,1)}for(r=f(-1);-1!==r;r=f(r))for(t=e.getFirstPath(r);-1!==t;t=e.getNextPath(t)){u=e.getFirstVertex(t);for(let w=0,x=e.getPathSize(t);w<x;w++,u=e.getNextVertex(u)){v=this.m_topoGraph.getHalfEdgeFromVertex(u);if(-1===v)continue;if(1===this.m_topoGraph.getHalfEdgeUserIndex(v,k))continue;const y=this.getCombinedHalfEdgeParentage(v);this.isGoodParentage(y)&&this.restorePolylineParts(v,
g,k,h,b,m,n,q,0===w,d)}}d=-1;if(c)for(d=e.createGeometry(p.GeometryType.enumMultiPoint),c=-1,f=this.m_topoGraph.getFirstCluster();-1!==f;f=this.m_topoGraph.getNextCluster(f))this.progress_(),1!==this.m_topoGraph.getClusterUserIndex(f,h)&&(q=this.m_topoGraph.getClusterParentage(f),this.isGoodParentage(q)&&(-1===c&&(c=e.insertPath(d,-1)),q=this.m_topoGraph.getClusterVertexIterator(f),-1!==q&&(this.m_topoGraph.getVertexFromVertexIterator(q),q=-1!==m?this.chooseVertexByOrder(f,e,m,n):this.chooseVertexFromCluster_(f,
b),e.addVertex(c,q))));-1!==n&&e.removeUserIndex(n);-1!==m&&e.removeUserIndex(m);-1!==h&&e.removeUserIndex(h);this.m_topoGraph.deleteUserIndexForHalfEdges(k);return l.makePair(g,d)}difference(a,b){var c=this.m_topoGraph.getShape().getGeometryType(a),d=this.m_topoGraph.getShape().getGeometryType(b);c=p.getDimensionFromType(c);d=p.getDimensionFromType(d);if(c>d)return a;const e=this.m_topoGraph.getGeometryID(a),f=this.m_topoGraph.getGeometryID(b);this.m_maskLookup.length=0;this.m_maskLookup.length=
(e|f)+1;this.m_maskLookup[e]=!0;if(2===c&&2===d)return c=-1,1<this.m_topoGraph.getShape().getVertexDescription().getAttributeCount()&&(c=a),this.topoOperationPolygonPolygon_(a,b,c);if(1===c&&2===d)return b=yd(),b.allCrossRoadsImpassable=!1,b.ogcRule=this.m_bOGCOutput,b.unsplitBehavior=0,this.topoOperationPolylineSimplifyOrPolylineTopoHelper_(a,-1,!1,b).first;if(1===c&&1===d)return b=yd(),b.allCrossRoadsImpassable=!0,b.ogcRule=this.m_bOGCOutput,b.unsplitBehavior=0,this.topoOperationPolylineSimplifyOrPolylineTopoHelper_(a,
-1,!1,b).first;if(0===c)return this.topoOperationMultiPoint_();p.throwInternalErrorException("")}symmetricDifference(a,b){var c=this.m_topoGraph.getShape().getGeometryType(a),d=this.m_topoGraph.getShape().getGeometryType(b);c=If(c);d=If(d);const e=this.m_topoGraph.getGeometryID(a),f=this.m_topoGraph.getGeometryID(b);p.geometryReleaseAssert(0<=e);p.geometryReleaseAssert(0<=f);this.m_maskLookup.length=0;this.m_maskLookup.length=(e|f)+1;this.m_maskLookup[e]=!0;this.m_maskLookup[e]=!0;this.m_maskLookup[f]=
!0;if(2===c&&2===d)return this.topoOperationPolygonPolygon_(a,b,-1);if(1===c&&1===d)return this.topoOperationPolyline_(-1,this.m_bOGCOutput);if(0===c&&0===d)return this.topoOperationMultiPoint();p.throwInternalErrorException("")}planarSimplifyNoCrackingAndCluster(a,b,c,d){p.geometryReleaseAssert(0);return!1}unsplitPolylineExact(a){p.geometryReleaseAssert(0);return new ma}planarSimplifyPolylines(a,b,c,d,e){for(var f=a.getFirstGeometry();-1!==f;f=a.getNextGeometry(f)){var g=a.getGeometryType(f);p.geometryReleaseAssert(g===
p.GeometryType.enumPolyline)}var h=0;f=0;g=null;if(a.hasCurves()&&!a.hasSegmentParentage()){g=new wb;h=a.getEnvelope2D(this.m_progressTracker);f=bc(b.total());const m=xb(b.total(),h);h=3*m+3*f;var k=b.total();Jb(a,m,k,g,null,this.m_progressTracker)}k=kb(b.add(h));a.filterClosePoints(k,!1,!1,!1,-1);this.m_topoGraph=new ec;4!==e&&5!==e?null===g&&c?(e=new Bh(this.m_progressTracker,!1),e.sweepVertical(a,b.total()),e.hadComplications()?(ac(a,b,this.m_progressTracker,!0,!1),c=!1):this.m_topoGraph.setCheckDirtyPlanesweepTolerance(b.total())):
(ac(a,b.add(h),this.m_progressTracker,!0,!1),c=!1):c=!1;a.removeSelection();a.collapseAllGeometriesToFirst();e=a.getFirstGeometry();this.m_topoGraph.setAndSimplifyEditShapeAlternate(a,e,this.m_progressTracker);if(this.m_topoGraph.dirtyCheckFailed())return p.geometryReleaseAssert(c&&null===g),this.m_topoGraph.removeShape(),this.m_topoGraph=null,this.planarSimplifyPolylines(a,b,!1,d,-1);this.m_topoGraph.setCheckDirtyPlanesweepTolerance(Number.NaN);e=this.m_topoGraph.getGeometryID(e);p.geometryReleaseAssert(0<=
e);this.m_maskLookup.length=0;this.m_maskLookup.length=e+1;this.m_maskLookup[e]=!0;d=this.topoOperationPolylineSimplify_(a.getFirstGeometry(),d);null!==g&&g.stitchCurves(a,d,f,!0);a=a.getGeometry(d);c||a.getImpl().setIsSimple(4,b.total());return a}planarSimplifyMultiPoints(a,b,c,d){for(c=a.getFirstGeometry();-1!==c;c=a.getNextGeometry(c)){const e=a.getGeometryType(c);p.geometryReleaseAssert(e===p.GeometryType.enumMultiPoint)}this.m_topoGraph=new ec;4!==d&&5!==d&&ac(a,b,this.m_progressTracker,!0,!1);
c=!1;a.removeSelection();a.collapseAllGeometriesToFirst();d=a.getFirstGeometry();this.m_topoGraph.setAndSimplifyEditShapeAlternate(a,d,this.m_progressTracker);if(this.m_topoGraph.dirtyCheckFailed())return p.geometryReleaseAssert(c),this.m_topoGraph.removeShape(),this.m_topoGraph=null,this.planarSimplifyMultiPoints(a,b,!1,-1);this.m_topoGraph.setCheckDirtyPlanesweepTolerance(Number.NaN);d=this.m_topoGraph.getGeometryID(d);p.geometryReleaseAssert(0<=d);this.m_maskLookup.length=0;this.m_maskLookup.length=
d+1;this.m_maskLookup[d]=!0;d=this.topoOperationMultiPoint();a=a.getGeometry(d);c||a.getImpl().setIsSimple(4,b.total());return a}planarSimplifyPolygons(a,b,c,d,e,f){for(var g=a.getFirstGeometry();-1!==g;g=a.getNextGeometry(g)){var h=a.getGeometryType(g);p.geometryReleaseAssert(h===p.GeometryType.enumPolygon||h===p.GeometryType.enumPolyline&&c)}var k=0;g=0;h=null;if(a.hasCurves()&&!a.hasSegmentParentage()){h=new wb;k=a.getEnvelope2D(this.m_progressTracker);g=bc(b.total());const n=xb(b.total(),k);k=
3*n+3*g;var m=b.total();Jb(a,n,m,h,null,this.m_progressTracker)}if(f)for(ac(a,b.add(k),this.m_progressTracker,!0,!1),m=a.getFirstGeometry();-1!==m;m=a.getNextGeometry(m))a.getGeometryType(m)===p.GeometryType.enumPolygon&&tc(a,m,-1,!1,-1,this.m_progressTracker);this.m_topoGraph=new ec;f||4===e||5===e?d=!1:null===h&&d?(e=new Bh(this.m_progressTracker,!1),e.sweepVertical(a,b.total()),e.hadComplications()?(ac(a,b,this.m_progressTracker,!0,!1),d=!1):this.m_topoGraph.setCheckDirtyPlanesweepTolerance(b.total())):
(ac(a,b.add(k),this.m_progressTracker,!0,!1),d=!1);a.removeSelection();a.collapseAllGeometriesToFirst();e=a.getFirstGeometry();c?this.m_topoGraph.setAndSimplifyEditShapeWinding(a,e,this.m_progressTracker):this.m_topoGraph.setAndSimplifyEditShapeAlternate(a,e,this.m_progressTracker);if(this.m_topoGraph.dirtyCheckFailed())return p.geometryReleaseAssert(d&&null===h),this.m_topoGraph.removeShape(),this.m_topoGraph=null,this.planarSimplifyPolygons(a,b,c,!1,-1,!1);this.m_topoGraph.setCheckDirtyPlanesweepTolerance(Number.NaN);
f=this.m_topoGraph.getGeometryID(e);p.geometryReleaseAssert(0<=f);this.m_maskLookup.length=0;this.m_maskLookup.length=f+1;this.m_maskLookup[f]=!0;a.setFillRule(e,0);c=this.m_bOGCOutput&&c;f=this.topoOperationPolygonPolygon_(e,-1,-1,c);c&&(this.m_topoGraph.removeShape(),this.m_topoGraph=null,a.removeGeometry(e),this.m_topoGraph=new ec,this.m_topoGraph.setAndSimplifyEditShapeAlternate(a,f,this.m_progressTracker),f=this.topoOperationPolygonPolygon_(f,-1,-1,!1));null!==h&&h.stitchCurves(a,f,g,!0);a=a.getGeometry(f);
a.setFillRule(0);d?a.getImpl().setIsSimple(3,0):(a.getImpl().setIsSimple(4,b.total()),a.getImpl().updateOGCFlagsProtected());return a}planarSimplify3DImpl_(a,b,c,d,e){p.geometryReleaseAssert(0);return{}}planarSimplifyImpl_(a,b,c,d,e,f,g,h){if(a.isEmpty())return a.clone();const k=a.getGeometryType();f=new Fa;const m=f.addGeometry(a);3<=e&&k===p.GeometryType.enumPolygon&&(c=!1,f.setFillRule(m,0));h&&(a.hasAttribute(1)&&f.replaceNaNs(1,0),f.removeNaNVertices());if(k===p.GeometryType.enumPolygon||k===
p.GeometryType.enumPolyline&&c)return this.planarSimplifyPolygons(f,b,c,d,e,!1);if(k===ma.type)return a=yd(),a.allCrossRoadsImpassable=!0,a.ogcRule=this.m_bOGCOutput,a.unsplitBehavior=g,this.planarSimplifyPolylines(f,b,d,a,e);if(k===p.GeometryType.enumMultiPoint)return this.planarSimplifyMultiPoints(f,b,d,e);p.throwInternalErrorException("what else?")}}class Nn{constructor(a,b,c,d,e,f){this.m_rParent=a;this.m_rTopoGraph=a.m_topoGraph;this.m_rShape=this.m_rTopoGraph.getShape();this.m_IDCuttee=this.m_rTopoGraph.getGeometryID(d);
this.m_IDCutter=this.m_rTopoGraph.getGeometryID(e);this.m_IDBoth=this.m_IDCuttee|this.m_IDCutter;this.m_bConsiderTouch=b;this.m_sideIndex=c;this.m_cuttee=d;this.m_cutter=e;this.m_rCutHandles=f;this.m_cutteeBreadcrumbsIndex=this.m_rShape.createUserIndexUninitialized();this.m_clusterParentageIndex=this.m_rShape.createUserIndexUninitialized();for(a=this.m_rShape.getFirstPath(this.m_cuttee);-1!==a;a=this.m_rShape.getNextPath(a))for(b=0,c=this.m_rShape.getPathSize(a),d=this.m_rShape.getFirstVertex(a);b<
c;b++,d=this.m_rShape.getNextVertex(d))this.m_rShape.setUserIndex(d,this.m_clusterParentageIndex,this.m_rTopoGraph.getClusterParentage(this.m_rTopoGraph.getClusterFromVertex(d)))}Do(){this.cutPolylinePolyline_();this.m_rShape.removeUserIndex(this.m_cutteeBreadcrumbsIndex);this.m_rShape.removeUserIndex(this.m_clusterParentageIndex)}setTbd(a){return a|8}classifyStandardCut(a,b,c,d){const e=this.m_rShape.getPrevVertex(a),f=this.m_rShape.getNextVertex(a),g=-1===e?-1:this.m_rTopoGraph.getHalfEdgeConnector(b,
this.m_rTopoGraph.getClusterFromVertex(e)),h=-1===f?-1:this.m_rTopoGraph.getHalfEdgeConnector(b,this.m_rTopoGraph.getClusterFromVertex(f)),k=this.m_rTopoGraph.getHalfEdgeConnector(b,this.m_rTopoGraph.getClusterFromVertex(c));c=this.m_rTopoGraph.getHalfEdgeConnector(b,this.m_rTopoGraph.getClusterFromVertex(d));let m=1,n=32,q=32;Ug(this.m_rTopoGraph,b,c,r=>{r===k&&(m=2);r===g&&(n=m);r===h&&(q=m)});if(this.m_bConsiderTouch)32!==n&&this.m_rShape.setUserIndex(e,this.m_cutteeBreadcrumbsIndex,this.m_rShape.getUserIndex(e,
this.m_cutteeBreadcrumbsIndex)|n),32!==q&&this.m_rShape.setUserIndex(a,this.m_cutteeBreadcrumbsIndex,this.m_rShape.getUserIndex(a,this.m_cutteeBreadcrumbsIndex)|q);else{if(32===n||32===q||n===q&&g!==k&&g!==c&&h!==k&&h!==c)return 1;this.m_rShape.setUserIndex(e,this.m_cutteeBreadcrumbsIndex,this.m_rShape.getUserIndex(e,this.m_cutteeBreadcrumbsIndex)|n);this.m_rShape.setUserIndex(a,this.m_cutteeBreadcrumbsIndex,this.m_rShape.getUserIndex(a,this.m_cutteeBreadcrumbsIndex)|q)}return 0}classifyTouchCut(a,
b,c,d){const e=this.m_rShape.getPrevVertex(a),f=this.m_rShape.getNextVertex(a),g=-1===e?-1:this.m_rTopoGraph.getHalfEdgeConnector(b,this.m_rTopoGraph.getClusterFromVertex(e)),h=-1===f?-1:this.m_rTopoGraph.getHalfEdgeConnector(b,this.m_rTopoGraph.getClusterFromVertex(f));c=-1===c?-1:this.m_rTopoGraph.getHalfEdgeConnector(b,this.m_rTopoGraph.getClusterFromVertex(c));d=-1===d?-1:this.m_rTopoGraph.getHalfEdgeConnector(b,this.m_rTopoGraph.getClusterFromVertex(d));if(!this.m_bConsiderTouch)return(b=c===
g||d===g)?this.m_rShape.setUserIndex(a,this.m_cutteeBreadcrumbsIndex,this.setTbd(this.m_rShape.getUserIndex(a,this.m_cutteeBreadcrumbsIndex))):(b=c===h||d===h)&&this.m_rShape.setUserIndex(e,this.m_cutteeBreadcrumbsIndex,this.setTbd(this.m_rShape.getUserIndex(e,this.m_cutteeBreadcrumbsIndex))),b?0:1;if(-1===g)return this.m_rShape.setUserIndex(a,this.m_cutteeBreadcrumbsIndex,this.setTbd(this.m_rShape.getUserIndex(a,this.m_cutteeBreadcrumbsIndex))),0;if(-1===h)return this.m_rShape.setUserIndex(e,this.m_cutteeBreadcrumbsIndex,
this.setTbd(this.m_rShape.getUserIndex(e,this.m_cutteeBreadcrumbsIndex))),0;if(g===h)return this.m_rShape.setUserIndex(e,this.m_cutteeBreadcrumbsIndex,this.setTbd(this.m_rShape.getUserIndex(e,this.m_cutteeBreadcrumbsIndex))),this.m_rShape.setUserIndex(a,this.m_cutteeBreadcrumbsIndex,this.setTbd(this.m_rShape.getUserIndex(a,this.m_cutteeBreadcrumbsIndex))),0;if(-1!==d){if(g===d)return this.m_rShape.setUserIndex(a,this.m_cutteeBreadcrumbsIndex,this.setTbd(this.m_rShape.getUserIndex(a,this.m_cutteeBreadcrumbsIndex))),
0;if(h===d)return this.m_rShape.setUserIndex(e,this.m_cutteeBreadcrumbsIndex,this.setTbd(this.m_rShape.getUserIndex(e,this.m_cutteeBreadcrumbsIndex))),0;let k=1;Ug(this.m_rTopoGraph,b,d,m=>{m===g?(m=this.m_rShape.getUserIndex(e,this.m_cutteeBreadcrumbsIndex)|k,this.m_rShape.setUserIndex(e,this.m_cutteeBreadcrumbsIndex,m),k=2):m===h&&(m=this.m_rShape.getUserIndex(a,this.m_cutteeBreadcrumbsIndex)|k,this.m_rShape.setUserIndex(a,this.m_cutteeBreadcrumbsIndex,m),k=2)})}else{if(g===c)return this.m_rShape.setUserIndex(a,
this.m_cutteeBreadcrumbsIndex,this.setTbd(this.m_rShape.getUserIndex(a,this.m_cutteeBreadcrumbsIndex))),0;if(h===c)return this.m_rShape.setUserIndex(e,this.m_cutteeBreadcrumbsIndex,this.setTbd(this.m_rShape.getUserIndex(e,this.m_cutteeBreadcrumbsIndex))),0;let k=2;Ug(this.m_rTopoGraph,b,c,m=>{m===g?(m=this.m_rShape.getUserIndex(e,this.m_cutteeBreadcrumbsIndex)|k,this.m_rShape.setUserIndex(e,this.m_cutteeBreadcrumbsIndex,m),k=1):m===h&&(m=this.m_rShape.getUserIndex(a,this.m_cutteeBreadcrumbsIndex)|
k,this.m_rShape.setUserIndex(a,this.m_cutteeBreadcrumbsIndex,m),k=1)})}return 0}classifyCutVertex(a,b){let c=0,d=0;for(let f=this.m_rTopoGraph.getClusterVertexIterator(b);-1!==f;f=this.m_rTopoGraph.incrementVertexIterator(f)){var e=this.m_rTopoGraph.getVertexFromVertexIterator(f);if(this.m_rShape.getGeometryFromVertex(e)===this.m_cutter){d++;const g=this.m_rShape.getPrevVertex(e);e=this.m_rShape.getNextVertex(e);c=-1===g||-1===e?c+this.classifyTouchCut(a,b,g,e):c+this.classifyStandardCut(a,b,g,e)}}d&&
c===d&&!this.m_bConsiderTouch&&this.m_rShape.setUserIndex(a,this.m_clusterParentageIndex,this.m_IDCuttee)}cutPolylinePolyline_(){this.m_rShape.getGeometryType(this.m_cuttee);this.m_rShape.getGeometryType(this.m_cutter);this.m_rParent.m_maskLookup.length=0;this.m_rParent.m_maskLookup.length=this.m_IDBoth+1;this.m_rParent.m_maskLookup[this.m_IDBoth]=!0;for(var a=this.m_rShape.getFirstPath(this.m_cuttee);-1!==a;a=this.m_rShape.getNextPath(a)){var b=this.m_rShape.getPathSize(a),c=this.m_rShape.getFirstVertex(a);
for(var d=0;d<b;++d,c=this.m_rShape.getNextVertex(c))this.m_rShape.setUserIndex(c,this.m_cutteeBreadcrumbsIndex,0);c=this.m_rShape.getFirstVertex(a);for(d=0;d<b;++d,c=this.m_rShape.getNextVertex(c)){var e=this.m_rTopoGraph.getClusterFromVertex(c);this.m_rTopoGraph.getClusterParentage(e)===this.m_IDBoth&&this.classifyCutVertex(c,e)}}a=(n,q)=>{let r=this.m_rShape.getUserIndex(n,this.m_cutteeBreadcrumbsIndex);n=this.m_rTopoGraph.getHalfEdgeConnector(this.m_rTopoGraph.getClusterFromVertex(n),this.m_rTopoGraph.getClusterFromVertex(q));
(this.m_rTopoGraph.getHalfEdgeParentage(n)&this.m_IDBoth)===this.m_IDBoth&&(r|=4);return r};for(b=this.m_rShape.getFirstPath(this.m_cuttee);-1!==b;b=this.m_rShape.getNextPath(b)){c=this.m_rShape.getFirstVertex(b);d=this.m_rShape.isClosedPath(b);d=this.m_rShape.getPathSize(b)+(d?1:0);e=1;var f=32;for(var g=this.m_rShape.getNextVertex(c);e<d;++e,c=g,g=this.m_rShape.getNextVertex(g)){var h=a(c,g);this.m_rShape.getUserIndex(c,this.m_clusterParentageIndex)===this.m_IDBoth&&(f=h);32!==f&&this.m_rShape.setUserIndex(c,
this.m_cutteeBreadcrumbsIndex,f|h)}c=this.m_rShape.getLastVertex(b);f=32;e=1;for(g=this.m_rShape.getPrevVertex(c);e<d;++e,c=g,g=this.m_rShape.getPrevVertex(g))h=a(g,c),this.m_rShape.getUserIndex(c,this.m_clusterParentageIndex)===this.m_IDBoth&&(f=h),32!==f&&this.m_rShape.setUserIndex(g,this.m_cutteeBreadcrumbsIndex,f|h)}b=a=-1;c=32;d=this.m_rShape.hasSegmentParentage();e=new W;for(f=this.m_rShape.getFirstPath(this.m_cuttee);-1!==f;f=this.m_rShape.getNextPath(f)){g=this.m_rShape.isClosedPath(f);g=
this.m_rShape.getPathSize(f)+(g?1:0);h=1;var k=this.m_rShape.getFirstVertex(f);let n=-1,q=!0;for(let r=this.m_rShape.getNextVertex(k);h<g;++h,r=this.m_rShape.getNextVertex(r)){var m=this.m_rShape.getUserIndex(k,this.m_cutteeBreadcrumbsIndex);8===m?m=3:(m&=-9,m&4?m=4:3===(m&3)&&(m=3));m!==c?(-1!==a&&(n=this.m_rShape.addVertex(b,k),d&&this.m_rTopoGraph.isBreakNode(this.m_rTopoGraph.getClusterFromVertex(k))&&this.m_rShape.setSegmentParentageBreakVertex(n,!0),this.m_rCutHandles.push(a),this.m_rShape.setGeometryUserIndex(a,
this.m_sideIndex,c)),a=this.m_rShape.createGeometry(p.GeometryType.enumPolyline),b=this.m_rShape.insertPath(a,-1),c=m,q=!0):this.m_rShape.getUserIndex(k,this.m_clusterParentageIndex)===this.m_IDBoth&&4!==m&&(n=this.m_rShape.addVertex(b,k),d&&this.m_rTopoGraph.isBreakNode(this.m_rTopoGraph.getClusterFromVertex(k))&&this.m_rShape.setSegmentParentageBreakVertex(n,!0),b=this.m_rShape.insertPath(a,-1),q=!0);n=this.m_rShape.addVertex(b,k);m=this.m_rTopoGraph.getClusterFromVertex(k);!q&&d&&this.m_rTopoGraph.isBreakNode(m)&&
this.m_rShape.setSegmentParentageBreakVertex(n,!0);k=this.m_rTopoGraph.getHalfEdgeFromVertex(k);if(d){const t=this.m_rTopoGraph.getSegmentParentage(k);this.m_rShape.setSegmentParentageAndBreak(n,t,q||this.m_rTopoGraph.isBreakNode(m))}this.m_rTopoGraph.isHalfEdgeCurve(k)&&(this.m_rTopoGraph.querySegmentXY(k,e),this.m_rShape.setSegmentToIndex(this.m_rShape.getVertexIndex(n),e.get().clone()));k=r;q=!1}n=this.m_rShape.addVertex(b,k);d&&this.m_rTopoGraph.isBreakNode(this.m_rTopoGraph.getClusterFromVertex(k))&&
this.m_rShape.setSegmentParentageBreakVertex(n,!0);this.m_rCutHandles.push(a);this.m_rShape.setGeometryUserIndex(a,this.m_sideIndex,c);b=a=-1;c=32}}}class Pl{constructor(){this.m_segment=null;this.m_pathIndex=this.m_vertexIndex=-1;this.m_flags=0}setReversed(a){this.m_flags&=-2;this.m_flags|=a?1:0}getReversed(){return 0!==(this.m_flags&1)}getRightSide(){return this.getReversed()?0:1}}class On extends bd{constructor(a){super();this.m_helper=a}compare(a,b,c){a=a.getElement(c);b=this.m_helper.m_xy.read(2*
b);a=this.m_helper.m_xy.read(2*a);b-=a;return 0>b?-1:0<b?1:0}}class Pn extends bd{constructor(a){super();this.m_helper=a}compare(a,b,c){a=a.getElement(c);b=this.m_helper.m_edges[b];a=this.m_helper.m_edges[a];const d=b.getReversed();c=a.getReversed();var e=b.m_segment.intersectionOfYMonotonicWithAxisX(this.m_helper.m_yScanline,0);let f=a.m_segment.intersectionOfYMonotonicWithAxisX(this.m_helper.m_yScanline,0);e===f&&(e=d?b.m_segment.getStartY():b.m_segment.getEndY(),c=c?a.m_segment.getStartY():a.m_segment.getEndY(),
e=Math.min(e,c),c=.5*(e-this.m_helper.m_yScanline)+this.m_helper.m_yScanline,c===this.m_helper.m_yScanline&&(c=e),e=b.m_segment.intersectionOfYMonotonicWithAxisX(c,0),f=a.m_segment.intersectionOfYMonotonicWithAxisX(c,0));return e<f?-1:e>f?1:0}}class cc{constructor(a,b,c,d,e){this.m_multiVertexGeom=null;this.m_edges=[];this.m_freeEdges=[];this.m_lineEdgesRecycle=[];this.m_newEdges=[];this.m_recycledSegIter=null;this.m_crossOverHelperList=new ab;this.m_progressTracker=null;this.m_progressCounter=0;
this.m_AET=new R;this.m_xy=this.m_pathParentage=this.m_pathOrientations=this.m_xyToNode2=this.m_xyToNode1=null;this.m_pairs=[];this.m_pairIndices=null;this.m_pathsForOGCTests=[];this.m_multiPathStitcher=this.m_editShape=this.m_curveStitcher=null;this.m_nonSimpleResult=new va;this.m_progressCounter=0;this.m_progressTracker=d;this.m_geometry=a;this.m_knownSimpleResult=c;this.m_sr=b;this.m_toleranceIsSimple=c=ib(b,a,!1);this.m_toleranceIsSimpleClustering=kb(c);this.m_toleranceIsSimpleCracking=Rf(c);
this.m_toleranceSimplify=ib(b,a,!0);this.m_description=this.m_geometry.getDescription();this.m_attributeCount=this.m_description.getAttributeCount();this.m_bPlanarSimplify=this.m_bOGCRestrictions=e;this.m_unknownOrientationPathCount=-1;this.m_progressCounter=this.m_yScanline=0}isSimplePlanarImpl(){this.m_bPlanarSimplify=!0;if(!this.checkStructure())return 0;const a=this.m_geometry.getGeometryType();return p.isMultiPath(a)&&!this.checkDegenerateSegments(!1)||!this._CheckClustering()?0:p.isMultiPath(a)?
this._CheckCracking()?this.m_geometry.getGeometryType()===p.GeometryType.enumPolyline?this.checkSelfIntersectionsPolylinePlanar()?4:0:this._CheckSelfIntersections()?this._CheckValidRingOrientation():0:0:5}isSimplePlanarImpl3D(){p.geometryReleaseAssert(0);return 7}generateSortedPairs(a){var b=null;p.isMultiPath(a.getGeometryType())&&(b=a);const c=(this.m_bPlanarSimplify||this.m_bOGCRestrictions)&&null!==b,d=a.getPointCount();this.m_xy=a.getAttributeStreamRef(0);this.m_pairs.length=0;this.m_pairIndices=
new za(0);c&&(this.m_pathsForOGCTests.length=0);a=0;for(let e=0;e<d;e++)if(this.m_pairs.push(2*e),this.m_pairs.push(2*e+1),this.m_pairIndices.add(2*e),this.m_pairIndices.add(2*e+1),c){for(;e>=b.getPathEnd(a);)a++;this.m_pathsForOGCTests.push(a)}b=new Zb;a={parent:this,workPt:new l.Point2D,userSort(e,f,g){g.sort(e,f,(h,k)=>this.parent.compareVerticesForPlanarClustering(h,k,c))},getValue(e){e=this.parent.m_pairs[e];this.parent.m_xy.queryPoint2D(2*(e>>1),this.workPt);return this.workPt.y+(e&1?this.parent.m_toleranceIsSimpleClustering:
-this.parent.m_toleranceIsSimpleClustering)}};b.sort(this.m_pairIndices,0,2*d,a)}_TestToleranceDistancePlanar(a,b){const c=this.m_xy.read(2*a);a=this.m_xy.read(2*a+1);const d=this.m_xy.read(2*b);b=this.m_xy.read(2*b+1);return Ig(c,a,d,b,this.m_toleranceIsSimpleClustering*this.m_toleranceIsSimpleClustering)?0===this.m_geometry.getDimension()?!1:c===d&&a===b:!0}checkStructure(){var a=this.m_geometry.getGeometryType();if(p.isMultiPath(a)){var b=this.m_geometry.getImpl();const c=this.m_geometry.getGeometryType()===
p.GeometryType.enumPolygon?3:2;for(let d=0,e=b.getPathCount();d<e;d++)if(b.getPathSize(d)<c&&!(b.hasNonLinearSegments()&&b.hasNonLinearSegmentsPath(d)&&0<b.getPathSize(d)))return this.m_nonSimpleResult=new va(1,d,0),!1}if(p.isMultiVertex(a)){a=this.m_geometry.getImpl();b=a.getAttributeStreamRef(0);for(let c=0,d=a.getPointCount();c<d;c++)if(!b.readPoint2D(2*c).isFinite())return this.m_nonSimpleResult=new va(2,c,0),!1;if(this.m_geometry.hasAttribute(1)){b=a.getAttributeStreamRef(1);for(let c=0,d=a.getPointCount();c<
d;c++)if(a=b.read(c),!Number.isFinite(a))return Number.isNaN(a)?this.m_nonSimpleResult=new va(3,c,0):this.m_nonSimpleResult=new va(2,c,0),!1}}return!0}checkDegenerateSegments(a){var b=this.m_geometry.getImpl();const c=b.querySegmentIterator(),d=b.hasAttribute(1),e=d?Jh(this.m_sr,b,!1).total():0;b=b.hasNonLinearSegments();const f=this.m_toleranceIsSimple.total();for(;c.nextPath();)for(;c.hasNextSegment();){var g=c.nextSegment(),h=g.calculateLowerLength2D();if(!(h>f)){if(b&&g.isCurve()&&(h=g.calculateLength2D(),
h>f))continue;if(a&&d&&(h=g.getStartAttributeAsDbl(1,0),g=g.getEndAttributeAsDbl(1,0),Math.abs(g-h)>e))continue;this.m_nonSimpleResult=new va(4,c.getStartPointIndex(),-1);return!1}}return!0}checkDegenerateSegments3D(){p.geometryReleaseAssert(0);return!1}_CheckClustering(){var a=this.m_geometry.getImpl();this.generateSortedPairs(a);a=a.getPointCount();this.m_AET.clear();this.m_AET.setComparator(new On(this));this.m_AET.setCapacity(a);for(let d=0,e=2*a;d<e;d++){this.progress_();a=this.m_pairIndices.read(d);
var b=this.m_pairs[a];a=b>>1;if(0===(b&1)){b=this.m_AET.addElement(a);var c=this.m_AET.getPrev(b);if(c!==R.st_nullNode()&&!this._TestToleranceDistancePlanar(this.m_AET.getElement(c),a))return this.m_nonSimpleResult=new va(5,a,this.m_AET.getElement(c)),!1;b=this.m_AET.getNext(b);if(b!==R.st_nullNode()&&!this._TestToleranceDistancePlanar(this.m_AET.getElement(b),a))return this.m_nonSimpleResult=new va(5,a,this.m_AET.getElement(b)),!1}else if(a=this.m_AET.search(a),b=this.m_AET.getPrev(a),c=this.m_AET.getNext(a),
this.m_AET.deleteNode(a),b!==R.st_nullNode()&&c!==R.st_nullNode()&&!this._TestToleranceDistancePlanar(this.m_AET.getElement(b),this.m_AET.getElement(c)))return this.m_nonSimpleResult=new va(5,this.m_AET.getElement(b),this.m_AET.getElement(c)),!1}return!0}_CheckCracking(){const a=this.m_geometry.getImpl(),b=a.getPointCount();return!a.hasNonLinearSegments()&&10>b?this._CheckCrackingBrute():this._CheckCrackingPlanesweep()}_CheckCrackingPlanesweep(){this.m_editShape=new Fa;this.m_editShape.addGeometry(this.m_geometry);
if(this.m_editShape.hasCurves()){this.m_curveStitcher=new wb;var a=D.constructEmpty();this.m_geometry.queryEnvelope(a);a=xb(this.m_toleranceSimplify.total(),a);const b=new va;ik(this.m_editShape,a,this.m_toleranceSimplify.total(),12E3,b,this.m_curveStitcher,null,this.m_progressTracker);if(0!==b.m_reason)return this.m_editShape=null,this.m_nonSimpleResult.assign(b),!1}a=new va;if(Jg(!1,this.m_editShape,this.m_toleranceIsSimpleCracking,a,this.m_progressTracker))return null!=this.m_curveStitcher?(a.m_vertexIndex1=
this.m_curveStitcher.getOriginalVertexIndex(this.m_editShape,a.m_vertexIndex1),a.m_vertexIndex2=this.m_curveStitcher.getOriginalVertexIndex(this.m_editShape,a.m_vertexIndex2),this.m_curveStitcher=null):(a.m_vertexIndex1=this.m_editShape.getVertexIndex(a.m_vertexIndex1),a.m_vertexIndex2=this.m_editShape.getVertexIndex(a.m_vertexIndex2)),this.m_editShape=null,this.m_nonSimpleResult.assign(a),!1;null==this.m_curveStitcher&&(this.m_editShape=null);return!0}_CheckCrackingBrute(){var a=this.m_geometry.getImpl();
const b=a.querySegmentIterator();for(a=a.querySegmentIterator();b.nextPath();)for(;b.hasNextSegment();){const d=b.nextSegment();if(!b.isLastSegmentInPath()||!b.isLastPath()){a.resetTo(b);do for(;a.hasNextSegment();){var c=a.nextSegment();if(c=Hc(!0,!1,d,c,this.m_toleranceIsSimpleCracking,!0))return this.m_nonSimpleResult=new va(2===c?7:6,b.getStartPointIndex(),a.getStartPointIndex()),!1}while(a.nextPath())}}return!0}_CheckSelfIntersections(){var a=this.m_geometry.getImpl();null!==this.m_curveStitcher&&
(this.m_multiPathStitcher=this.m_editShape.getGeometry(this.m_editShape.getFirstGeometry()),a=this.m_multiPathStitcher.getImpl(),this.generateSortedPairs(a));this.m_edges.length=0;this.m_lineEdgesRecycle.length=0;this.m_recycledSegIter=a.querySegmentIterator();this.m_recycledSegIter.setCirculator(!0);const b=[];var c=a.getPointCount();a=Number.NaN;let d=0;for(let e=0,f=2*c;e<f;e++){this.progress_();c=this.m_pairIndices.read(e);c=this.m_pairs[c];if(c&1)continue;c>>=1;const g=this.m_xy.read(2*c),h=
this.m_xy.read(2*c+1);if(b.length&&(g!==a||h!==d)){if(!this.processBunchForSelfIntersectionTest(b))return!1;b.length=0}b.push(c);a=g;d=h}return this.processBunchForSelfIntersectionTest(b)?!0:!1}checkSelfIntersectionsPolylinePlanar(){const a=this.m_geometry.getImpl(),b=[];for(let m=0,n=a.getPathCount();m<n;m++)b.push(a.isClosedPathInXYPlane(m));const c={x:-1,y:-1,ipath:-1,ivertex:-1,bBoundary:!1,bEndPoint:!1};let d,e;var f=this.m_pairIndices.read(0);var g=this.m_pairs[f]>>1,h=this.m_xy.readPoint2D(2*
g),k=this.m_pathsForOGCTests[g];f=b[k];d=a.getPathStart(k);e=a.getPathEnd(k)-1;c.bEndPoint=g===d||g===e;c.bBoundary=this.m_bOGCRestrictions?!f&&c.bEndPoint:c.bEndPoint;c.ipath=k;c.x=h.x;c.y=h.y;c.ivertex=g;for(let m=1,n=this.m_pairIndices.size();m<n;m++){g=this.m_pairIndices.read(m);g=this.m_pairs[g];if(g&1)continue;g>>=1;h=this.m_xy.readPoint2D(2*g);k=this.m_pathsForOGCTests[g];k!==c.ipath&&(f=b[k],d=a.getPathStart(k),e=a.getPathEnd(k)-1);const q=g===d||g===e;h={x:h.x,y:h.y,ipath:k,ivertex:g,bBoundary:this.m_bOGCRestrictions?
!f&&q:q,bEndPoint:q};if(h.x===c.x&&h.y===c.y)if(this.m_bOGCRestrictions){if(!h.bBoundary||!c.bBoundary)if(h.ipath!==c.ipath||!h.bEndPoint||!c.bEndPoint)return this.m_nonSimpleResult=new va(10,h.ivertex,c.ivertex),!1}else if(!h.bEndPoint||!c.bEndPoint)return this.m_nonSimpleResult=new va(7,h.ivertex,c.ivertex),!1;g=c;g.x=h.x;g.y=h.y;g.ipath=h.ipath;g.ivertex=h.ivertex;g.bBoundary=h.bBoundary;g.bEndPoint=h.bEndPoint}return!0}checkSelfIntersectionsPolylinePlanar3D(a){p.geometryReleaseAssert(0);return!1}checkSelfIntersectionsPolygonsOGC(){var a=
this.m_geometry.getImpl(),b=[],c=-1,d=!1;for(let k=0,m=a.getPathCount();k<m;k++)a.isExteriorRingOGC(k)&&(d=!1,c++,k<m-1&&(a.isExteriorRingOGC(k+1)||(d=!0))),b.push(d?c:-1);c={x:-1,y:-1,ipath:-1,ivertex:-1,ipolygon:-1};a=this.m_pairIndices.read(0);a=this.m_pairs[a]>>1;d=this.m_xy.readPoint2D(2*a);var e=this.m_pathsForOGCTests[a];c.ipath=e;c.x=d.x;c.y=d.y;c.ivertex=a;c.ipolygon=b[e];a=[];for(let k=1,m=this.m_pairIndices.size();k<m;k++)if(d=this.m_pairIndices.read(k),d=this.m_pairs[d],!(d&1)){d>>=1;
e=this.m_xy.readPoint2D(2*d);var f=this.m_pathsForOGCTests[d];d={x:e.x,y:e.y,ipath:f,ivertex:d,ipolygon:b[f]};if(d.x===c.x&&d.y===c.y){if(d.ipath===c.ipath)return this.m_nonSimpleResult=new va(11,d.ivertex,c.ivertex),!1;0<=b[d.ipath]&&b[d.ipath]===b[c.ipath]&&((e=0===a.length)||(e=a.at(-1),e=!(e.x===c.x&&e.y===c.y&&e.ipath===c.ipath&&e.ivertex===c.ivertex&&e.ipolygon===c.ipolygon)),e&&a.push({...c}),a.push(d))}e=c;e.x=d.x;e.y=d.y;e.ipath=d.ipath;e.ivertex=d.ivertex;e.ipolygon=d.ipolygon}if(0===a.length)return!0;
c=new ab(!0);b.fill(-1);d=-1;e=new l.Point2D;for(let k=0,m=a.length;k<m;k++){f=a[k];if(f.x!==e.x||f.y!==e.y)d=c.createList(0),e.x=f.x,e.y=f.y;var g=b[f.ipath];-1===g&&(g=c.createList(2),b[f.ipath]=g);c.addElement(g,d);c.addElement(d,g)}a=[];for(d=c.getFirstList();-1!==d;d=c.getNextList(d))if(e=c.getListData(d),0===(e&1)&&0!==(e&2)){e=-1;a.push(d);for(a.push(-1);a.length;){f=a.at(-1);a.pop();g=a.at(-1);a.pop();var h=c.getListData(g);if(0!==(h&1)){e=0===(h&2)?f:g;break}c.setListData(g,h|1);for(h=c.getFirst(g);-1!==
h;h=c.getNext(h)){const k=c.getData(h);k!==f&&(a.push(k),a.push(g))}}if(-1!==e)return b=b.indexOf(e),this.m_nonSimpleResult=new va(12,b,-1),!1}return!0}_CheckValidRingOrientation(){var a=null!==this.m_multiPathStitcher?this.m_multiPathStitcher.getImpl():this.m_geometry.getImpl();if(0>=a.calculateArea2D())return this.m_nonSimpleResult=new va(8,1===a.getPathCount()?1:-1,-1),0;if(1===a.getPathCount())return this.m_bOGCRestrictions&&!this.checkSelfIntersectionsPolygonsOGC()?0:4;this.m_pathOrientations=
new Db(a.getPathCount(),0);this.m_pathParentage=new za(a.getPathCount(),-1);var b=-1,c=0;for(let d=0,e=a.getPathCount();d<e;d++){const f=a.calculateRingArea2D(d);this.m_pathOrientations.write(d,0>f?0:8);if(0<f)b=d,c=f;else{if(0===f)return this.m_nonSimpleResult=new va(8,d,-1),0;if(0>b||c<Math.abs(f))if(this.m_nonSimpleResult=new va(9,d,-1),this.m_bOGCRestrictions)return 0;this.m_pathParentage.write(d,b)}}this.m_unknownOrientationPathCount=a.getPathCount();this.m_newEdges.length=0;b=a.getPointCount();
this.m_yScanline=Number.NaN;a=[];this.m_xyToNode1=new za(b,R.st_nullNode());this.m_xyToNode2=new za(b,R.st_nullNode());this.m_freeEdges.length=0;this.m_AET.clear();this.m_AET.setComparator(new Pn(this));for(let d=0,e=2*b;0<this.m_unknownOrientationPathCount&&d<e;d++)if(b=this.m_pairIndices.read(d),b=this.m_pairs[b],!(b&1)){b>>=1;c=this.m_xy.read(2*b+1);if(c!==this.m_yScanline&&a.length){if(!this.processBunchForRingOrientationTest(a))return 0;a.length=0}a.push(b);this.m_yScanline=c}return 0<this.m_unknownOrientationPathCount&&
!this.processBunchForRingOrientationTest(a)?0:this.m_bOGCRestrictions?0===this.m_nonSimpleResult.m_reason&&this.checkSelfIntersectionsPolygonsOGC()?5:0:0===this.m_nonSimpleResult.m_reason?4:3}processBunchForSelfIntersectionTest(a){if(1===a.length)return!0;for(let f=0,g=a.length;f<g;f++){var b=a[f];this.m_recycledSegIter.resetToVertex(b,-1);var c=this.m_recycledSegIter.previousSegment();this.m_edges.push(this.createEdge(c,b,this.m_recycledSegIter.getPathIndex(),!0));this.m_recycledSegIter.nextSegment();
c=this.m_recycledSegIter.nextSegment();this.m_edges.push(this.createEdge(c,b,this.m_recycledSegIter.getPathIndex(),!1))}this.m_edges.sort((f,g)=>this.edgeAngleCompare(f,g));b=this.m_crossOverHelperList.getFirstList();-1===b&&(b=this.m_crossOverHelperList.createList(0));this.m_crossOverHelperList.reserveNodes(this.m_edges.length);for(let f=0,g=this.m_edges.length;f<g;f++)this.m_crossOverHelperList.addElement(b,f);c=!0;for(var d=-1,e=-1;c;){c=!1;let f=this.m_crossOverHelperList.getFirst(b);if(-1===
f)break;let g=this.m_crossOverHelperList.getNext(f);for(;-1!==g;){d=this.m_crossOverHelperList.getData(f);e=this.m_crossOverHelperList.getData(g);d=this.m_edges[d].m_vertexIndex;e=this.m_edges[e].m_vertexIndex;if(d===e)if(c=!0,this.m_crossOverHelperList.deleteElement(b,f),f=this.m_crossOverHelperList.getPrev(g),g=this.m_crossOverHelperList.deleteElement(b,g),-1===g||-1===f)break;else continue;f=g;g=this.m_crossOverHelperList.getNext(f)}}c=this.m_crossOverHelperList.getListSize(b);this.m_crossOverHelperList.clear(b);
if(0<c)return this.m_nonSimpleResult=new va(7,d,e),!1;for(let f=0,g=a.length;f<g;f++)this.recycleEdge(this.m_edges[f]);this.m_edges.length=0;return!0}processBunchForRingOrientationTest(a){for(let h=0,k=a.length;h<k;h++){var b=a[h],c=this.m_xyToNode1.read(b);if(c!==R.st_nullNode()){var d=this.m_AET.getElement(c);this.m_freeEdges.push(d);this.m_AET.deleteNode(c);this.recycleEdge(this.m_edges[d]);this.m_edges[d]=null;this.m_xyToNode1.write(b,R.st_nullNode())}c=this.m_xyToNode2.read(b);c!==R.st_nullNode()&&
(d=this.m_AET.getElement(c),this.m_freeEdges.push(d),this.m_AET.deleteNode(c),this.recycleEdge(this.m_edges[d]),this.m_edges[d]=null,this.m_xyToNode2.write(b,R.st_nullNode()))}for(let h=0,k=a.length;h<k;h++){b=a[h];this.m_recycledSegIter.resetToVertex(b,-1);d=this.m_recycledSegIter.previousSegment();if(d.getStartY()>d.getEndY()){c=this.m_recycledSegIter.getStartPointIndex();d=this.createEdge(d,b,this.m_recycledSegIter.getPathIndex(),!0);var e=void 0;0<this.m_freeEdges.length?(e=this.m_freeEdges.at(-1),
this.m_freeEdges.pop(),this.m_edges[e]=d):(e=this.m_edges.length,this.m_edges.push(d));d=this.m_AET.addElement(e);this.m_xyToNode1.read(c)===R.st_nullNode()?this.m_xyToNode1.write(c,d):this.m_xyToNode2.write(c,d);0===(this.m_pathOrientations.read(this.m_recycledSegIter.getPathIndex())&3)&&this.m_newEdges.push(d)}this.m_recycledSegIter.nextSegment();d=this.m_recycledSegIter.nextSegment();d.getStartY()<d.getEndY()&&(c=this.m_recycledSegIter.getEndPointIndex(),b=this.createEdge(d,b,this.m_recycledSegIter.getPathIndex(),
!1),0<this.m_freeEdges.length?(d=this.m_freeEdges.at(-1),this.m_freeEdges.pop(),this.m_edges[d]=b):(d=this.m_edges.length,this.m_edges.push(b)),b=this.m_AET.addElement(d),this.m_xyToNode1.read(c)===R.st_nullNode()?this.m_xyToNode1.write(c,b):this.m_xyToNode2.write(c,b),0===(this.m_pathOrientations.read(this.m_recycledSegIter.getPathIndex())&3)&&this.m_newEdges.push(b))}for(let h=0,k=this.m_newEdges.length;h<k&&0<this.m_unknownOrientationPathCount;h++)if(a=this.m_newEdges[h],b=this.m_AET.getElement(a),
0===(this.m_pathOrientations.read(this.m_edges[b].m_pathIndex)&3)){b=-1;c=this.m_AET.getPrev(a);e=a;d=0;d=-1;d=null;for(var f=-1,g=0;c!==R.st_nullNode();){d=this.m_AET.getElement(c);d=this.m_edges[d];f=d.m_pathIndex;g=this.m_pathOrientations.read(f);if(0!==(g&3))break;e=c;c=this.m_AET.getPrev(c)}c===R.st_nullNode()?(d=1,c=e):(b=1===(g&3)?f:this.m_pathParentage.read(f),d=d.getRightSide()?0:1,c=this.m_AET.getNext(c));do{e=this.m_AET.getElement(c);g=this.m_edges[e];e=g.m_pathIndex;f=this.m_pathOrientations.read(e);
if(0===(f&3)){if(d!==g.getRightSide())return this.m_nonSimpleResult=new va(8,e,-1),!1;g=d&&!g.getReversed()?1:2;f=f&-4|g;this.m_pathOrientations.write(e,f);if(2===g&&0===this.m_nonSimpleResult.m_reason&&(g=this.m_pathParentage.read(e),g!==b&&(this.m_nonSimpleResult=new va(9,e,g),this.m_bOGCRestrictions)))return!1;this.m_unknownOrientationPathCount--;if(!this.m_unknownOrientationPathCount)return!0}b=1===(f&3)?e:this.m_pathParentage.read(e);e=c;c=this.m_AET.getNext(c);d=d?0:1}while(e!==a)}this.m_newEdges.length=
0;return!0}createEdge(a,b,c,d){let e;a.getGeometryType()===p.GeometryType.enumLine?e=this.createEdgeLine(a):(e=new Pl,e.m_segment=a.clone());e.m_vertexIndex=b;e.m_pathIndex=c;e.m_flags=0;e.setReversed(d);return e}createEdgeLine(a){let b;0<this.m_lineEdgesRecycle.length?(b=this.m_lineEdgesRecycle.at(-1),this.m_lineEdgesRecycle.pop(),a.copyTo(b.m_segment)):(b=new Pl,b.m_segment=a.clone());return b}recycleEdge(a){a.m_segment.getGeometryType()===p.GeometryType.enumLine&&this.m_lineEdgesRecycle.push(a)}static isShortSegment(a,
b,c,d){var e=a.calculateLowerLength2D();return e<=c&&(e=!0,a.isCurve()&&(e=a.calculateLength2D(),e=e<=c),e)?b?(b=a.getEndAttributeAsDbl(1,0),Number.isNaN(b)&&(b=0),a=a.getStartAttributeAsDbl(1,0),Number.isNaN(a)&&(a=0),Math.abs(a-b)<=d):!0:!1}static isShortSegmentPoints(a,b,c,d,e){if(c)return a=a.getXYZ(),c=b.getXYZ(),b=a,a=c,d=l.sqr(a.x-b.x)+l.sqr(a.y-b.y)<=d*d?l.isEqualNonIEEETol(b.z,a.z,e):!1,d;e=a.getXY();b=b.getXY();return l.Point2D.sqrDistance(e,b)<=d*d}removeDegenerateSegmentsFromCurvedPath(a,
b,c,d){var e=a.hasAttribute(1),f=a.querySegmentIterator();f.resetToPath(b);p.geometryReleaseAssert(f.nextPath());const g=this.m_toleranceSimplify.total();var h=!1;let k=!0;var m=new Y;const n=new Y,q=new l.Point2D;for(;f.hasNextSegment();){this.progress_();const r=f.nextSegment();if(cc.isShortSegment(r,e,g,c))h?(r.queryEnd(n),cc.isShortSegmentPoints(m,n,e,g,c)||(k&&(d.startPathPoint(m),k=!1),r.queryEnd(m),d.lineToPoint(m),h=!1)):(q.assign(r.getStartXY()),r.queryStart(m),h=!0);else if(h)if(r.isCurve()){const t=
r.clone();t.setCoordsForIntersector(q,r.getEndXY(),!1);t.setStart(m);cc.isShortSegment(t,e,g,c)||(d.addSegment(t,k),h=k=!1)}else r.queryEnd(n),cc.isShortSegmentPoints(m,n,e,g,c)||(k&&(d.startPathPoint(m),k=!1),d.lineToPoint(n),h=!1);else d.addSegment(r,k),k=!1}if(!k&&h){a.isClosedPath(b)?a.getPointByVal(a.getPathStart(b),m):a.getPointByVal(a.getPathEnd(b)-1,m);b=d.querySegmentIterator();b.resetToLastPath();b.resetToLastSegment();f=1<d.getDescription().getAttributeCount();for(p.geometryReleaseAssert(b.previousPath());b.hasPreviousSegment();)if(h=
b.previousSegment(),h.isCurve()){if(a=h.clone(),a.setCoordsForIntersector(h.getStartXY(),m.getXY(),!1),!cc.isShortSegment(a,e,g,c)){f&&a.setEnd(m);m=b.getEndPointIndex();for(c=d.getPointCount()-1;c>=m;c--)d.removePoint(c);d.addSegment(a,!1);return}}else if(h.queryStart(n),!cc.isShortSegmentPoints(n,m,e,g,c)){c=b.getEndPointIndex();for(e=d.getPointCount()-1;e>=c;e--)d.removePoint(e);d.lineToPoint(m);return}d.removePath(d.getPathCount()-1)}}multipointIsSimpleAsFeature(){if(!this.checkStructure())return 0;
var a=this.m_geometry.getImpl();this.m_multiVertexGeom=a;a=a.getPointCount();const b=Array(a);for(var c=0;c<a;c++)b[c]=c;b.sort((d,e)=>this.compareVerticesMultiPoint(d,e));for(c=1;c<a;c++)if(0===this.compareVerticesMultiPoint(b[c-1],b[c]))return this.m_nonSimpleResult=new va(5,b[c-1],b[c]),0;return 1}polylineIsSimpleAsFeature(){return this.checkStructure()?this.checkDegenerateSegments(!0)?1:0:0}polygonIsSimpleAsFeature(){return this.isSimplePlanarImpl()}multipointSimplifyAsFeature(){var a=this.m_geometry.getImpl(),
b=cc.hasNanZs(a),c=this.m_geometry;b&&(c=this.m_geometry.clone(),a=c.getImpl(),c.replaceNaNs(1,K.getDefaultValue(1)));this.m_multiVertexGeom=a;b=a.getPointCount();var d=Array(b);for(var e=0;e<b;e++)d[e]=e;d.sort((h,k)=>this.compareVerticesMultiPoint(h,k));e=Array(b);e.fill(!1);var f=-1;for(var g=0;g<b;g++){const h=d[g];if(a.getXY(h).isFinite()){if(0>f||0!==this.compareVerticesMultiPoint(f,h))e[h]=!0;f=h}}a=this.m_geometry.createInstance();f=d=0;for(g=0;g<b;g++)e[g]?f=g+1:(d<f&&a.addPoints(c,d,f),
d=g+1);d<f&&a.addPoints(c,d,f);a.getImpl().setIsSimple(1,this.m_toleranceSimplify.total());return a}polylineSimplifyAsFeature(){const a=this.m_geometry.getImpl(),b=a.querySegmentIterator(),c=a.querySegmentIterator(),d=this.m_geometry.createInstance(),e=this.m_geometry,f=a.hasAttribute(1),g=f?Jh(this.m_sr,a,!0).total():0,h=[],k=[];let m=null;f&&(m=a.getAttributeStreamRef(1));const n=new Y,q=a.hasNonLinearSegments(),r=this.m_toleranceSimplify.total();for(;b.nextPath();)if(c.nextPath(),!(2>a.getPathSize(b.getPathIndex())))if(q&&
a.hasNonLinearSegmentsPath(b.getPathIndex()))this.removeDegenerateSegmentsFromCurvedPath(a,b.getPathIndex(),g,d);else{c.resetToLastSegment();for(var t=0,u=0,v=!0,w=!0;b.hasNextSegment();){this.progress_();t=b.nextSegment();u=c.previousSegment();var x=b.getStartPointIndex(),y=c.getStartPointIndex();if(x>y)break;v&&(x=b.getStartPointIndex(),a.getXY(x).isNAN()||(v=!1,h.push(x)));w&&(x=c.getEndPointIndex(),a.getXY(x).isNAN()||(k.push(x),w=!1));v||(y=h.at(-1),x=b.getEndPointIndex(),1<x-y?(t=new l.Point2D,
t.setSub(a.getXY(y),a.getXY(x)),t=t.length()):t=t.calculateLength2D(),t>r?(h.push(x),t=0):f&&(t=m.read(y),Number.isNaN(t)&&(t=0),y=m.read(x),Number.isNaN(y)&&(y=0),Math.abs(y-t)>g&&(h.push(x),t=0)));w||(x=k.at(-1),t=c.getStartPointIndex(),1<t-x?(u=new l.Point2D,u.setSub(a.getXY(x),a.getXY(t)),u=u.length()):u=u.calculateLength2D(),u>r?(k.push(t),u=0):f&&(u=m.read(x),Number.isNaN(u)&&(u=0),x=m.read(t),Number.isNaN(x)&&(x=0),Math.abs(x-u)>g&&(k.push(t),u=0)))}0<h.length&&0<k.length&&(h.at(-1)<k.at(-1)?
h.length>k.length?h.pop():k.pop():(h.at(-1)!==k.at(-1)&&k.pop(),k.pop()));if(2<=k.length+h.length){v=!1;for(let z=0,A=h.length;z<A;z++)e.getPointByVal(h[z],n),v?d.lineToPoint(n):(d.startPathPoint(n),v=!0);for(w=k.length-1;0<w;w--)e.getPointByVal(k[w],n),v?d.lineToPoint(n):(d.startPathPoint(n),v=!0);e.isClosedPath(b.getPathIndex())?d.closePathWithLine():0<k.length&&(e.getPointByVal(k[0],n),d.lineToPoint(n))}h.length=0;k.length=0}f&&d.replaceNaNs(1,0);d.getImpl().setIsSimple(1,r);return d}polygonSimplifyAsFeature(){return this.simplifyPlanar()}simplifyPlanar(){if(1===
this.m_geometry.getFillRule()&&!(3<=this.m_knownSimpleResult))return cf(this.m_geometry,this.m_toleranceSimplify,!0,!1,this.m_knownSimpleResult,this.m_progressTracker,0,!0);var a=new Fa;a.addGeometry(this.m_geometry);this.m_geometry.hasAttribute(1)&&a.replaceNaNs(1,0);a.removeNaNVertices();if(0!==a.getTotalPointCount()){let d=null;var b=0;let e=0;if(a.hasCurves()){d=new wb;b=D.constructEmpty();this.m_geometry.queryEnvelope(b);const f=xb(this.m_toleranceSimplify.total(),b);b=bc(this.m_toleranceSimplify.total());
e=3*f+3*b;var c=this.m_toleranceSimplify.total();Jb(a,f,c,d,null,this.m_progressTracker)}3<=this.m_knownSimpleResult||(c=this.m_toleranceSimplify.add(e),ac(a,c,this.m_progressTracker,!0,!1));this.m_geometry.getGeometryType()===p.GeometryType.enumPolygon&&tc(a,a.getFirstGeometry(),this.m_knownSimpleResult,!1,-1,this.m_progressTracker);null!==d&&d.stitchCurves(a,a.getFirstGeometry(),b,!0)}a=a.getGeometry(a.getFirstGeometry());a.getGeometryType()===p.GeometryType.enumPolygon&&(a.getImpl().updateOGCFlagsProtected(),
a.setFillRule(0));a.getImpl().setIsSimple(4,this.m_toleranceSimplify.total());return a}progress_(){}static hasNanZs(a){if(a.hasAttribute(1)){const b=a.getAttributeStreamRef(1);for(let c=0,d=a.getPointCount();c<d;c++)if(a=b.read(c),Number.isNaN(a))return!0}return!1}compareVerticesForPlanarClustering(a,b,c){if(a===b)return 0;var d=this.m_pairs[a];const e=this.m_pairs[b];b=d>>1;a=e>>1;const f=this.m_xy.readPoint2D(2*b);f.y+=d&1?this.m_toleranceIsSimpleClustering:-this.m_toleranceIsSimpleClustering;d=
this.m_xy.readPoint2D(2*a);d.y+=e&1?this.m_toleranceIsSimpleClustering:-this.m_toleranceIsSimpleClustering;d=f.compare(d);return 0===d&&c?l.sign(this.m_pathsForOGCTests[b]-this.m_pathsForOGCTests[a]):d}compareVerticesMultiPoint(a,b){if(a===b)return 0;var c=this.m_multiVertexGeom.getXY(a),d=this.m_multiVertexGeom.getXY(b),e=!c.isFinite(),f=!d.isFinite();if(e||f)return e<f?-1:e>f?1:0;if(c.y<d.y)return-1;if(c.y>d.y)return 1;if(c.x<d.x)return-1;if(c.x>d.x)return 1;for(c=1;c<this.m_attributeCount;c++)for(d=
this.m_description.getSemantics(c),e=K.getComponentCount(d),f=0;f<e;f++){var g=this.m_multiVertexGeom.getAttributeAsDbl(d,a,f);const h=this.m_multiVertexGeom.getAttributeAsDbl(d,b,f);g=l.compareWithNANs(g,h);if(0!==g)return g}return 0}edgeAngleCompare(a,b){if(a===b)return 0;var c=a.m_segment.getTangent(a.getReversed()?1:0);a.getReversed()&&c.negateThis();a=b.m_segment.getTangent(b.getReversed()?1:0);b.getReversed()&&a.negateThis();b=c.getQuarter();const d=a.getQuarter();return d===b?(c=c.crossProduct(a),
0>c?1:0<c?-1:0):b<d?-1:1}}class nc{getOperatorType(){return 10103}accelerateGeometry(a,b,c){return!1}canAccelerateGeometry(a){return!1}supportsCurves(){return!0}isSimpleAsFeature(a,b,c,d,e){b=Vg(a,b,c,d,e);a=a.getGeometryType()===p.GeometryType.enumPolygon?3<=b:1<=b;return a}isSimplePlanarDONOTUSE(a,b,c,d,e){return 4<=Um(a,b,c,d,e)}executeMany(a,b,c,d){return new Qn(a,b,c,d)}execute(a,b,c,d){a=new bb.SimpleGeometryCursor([a]);(b=this.executeMany(a,b,c,d).next())||p.throwInternalErrorException("null geometry");
return b}}class Qn extends bb.GeometryCursor{constructor(a,b,c,d){super();this.m_progressTracker=d;this.m_bForceSimplify=c;this.m_index=-1;this.m_inputGeometryCursor=a;this.m_spatialReference=b}next(){const a=this.m_inputGeometryCursor.next();return a?(this.m_index=this.m_inputGeometryCursor.getGeometryID(),this.simplify(a)):null}getGeometryID(){return this.m_index}tock(){return!1}getRank(){return 1}simplify(a){a||p.throwInvalidArgumentException("");if(a.getGeometryType()===p.GeometryType.enumGeometryCollection){var b=
Rh(a,-1);b=(new nc).executeMany(b,this.m_spatialReference,this.m_bForceSimplify,this.m_progressTracker);a=a.createInstance();for(let c=b.next();null!=c;c=b.next())a.addGeometry(c);return a}return mk(a,this.m_spatialReference,this.m_bForceSimplify,this.m_progressTracker)}}class Tc{getOperatorType(){return 10004}supportsCurves(){return!0}accelerateGeometry(a,b,c){return!1}canAccelerateGeometry(a){return!1}executeMany(a,b,c,d){return new Rn(a,b,c,d)}execute(a,b,c,d){return hj(a,b,c,Number.NaN,0,d)}}
class Rn extends bb.GeometryCursor{constructor(a,b,c,d){super();this.m_progressTracker=d;this.m_index=-1;a||p.throwInvalidArgumentException("");this.m_envelope=b;this.m_inputGeometryCursor=a;this.m_spatialRefImpl=c;this.m_tolerance=Ma(c,b,!1).total()}next(){let a;return(a=this.m_inputGeometryCursor.next())?(p.throwIfMesh(a),this.m_index=this.m_inputGeometryCursor.getGeometryID(),ra(a,this.m_envelope,this.m_tolerance,0,this.m_progressTracker)):null}getGeometryID(){return this.m_index}tock(){return!0}getRank(){return 1}}
class Wc{constructor(a,b,c,d){this.m_sr=this.m_intersectorGeom=null;this.m_dimensionMask=-1;this.m_progressTracker=null;this.m_intersectorGeomType=p.GeometryType.enumUnknown;this.m_geomIntersectorEmptyGeom=null;this.m_intersectorGeom=a;this.m_sr=b;this.m_dimensionMask=c;this.m_progressTracker=d;this.m_intersectorGeomType=a.getGeometryType()}intersect(a){var b=this.tryFastImplementation(a);if(null!==b)return b;b=Ld(this.m_intersectorGeom,a);var c=Ma(this.m_sr,b,!0).total();b=D.constructEmpty();this.m_intersectorGeom.queryEnvelope(b);
var d=D.constructEmpty();a.queryEnvelope(d);b.inflateCoords(2*c,2*c);b.intersect(d);b.inflateCoords(100*c,100*c);c=ra(this.m_intersectorGeom,b,0,0,this.m_progressTracker);b=ra(a,b,0,0,this.m_progressTracker);a.getDimension()>this.m_intersectorGeom.getDimension()&&(c=l.swap(b,b=c));a:{a=b;b=c;d=this.m_sr;c=this.m_progressTracker;var e=D.constructEmpty();a.queryEnvelope(e);var f=D.constructEmpty();b.queryEnvelope(f);var g=D.constructEmpty();g.setCoords({env2D:e});g.mergeEnvelope2D(f);d=Ma(d,g,!0);f=
new D(f);g=kb(d);f.inflateCoords(g,g);if(!e.isIntersecting(f)){if(a.getDimension()<=b.getDimension()){a=Kb(Ta(a.createInstance()),a,b,"\x26");break a}if(a.getDimension()>b.getDimension()){a=Kb(Ta(b.createInstance()),a,b,"\x26");break a}}const k=new yb(c);e=new Fa;const m=e.addGeometry(Ta(a)),n=e.addGeometry(Ta(b));let q=0;f=0;g=null;if(e.hasCurves()){g=new wb;var h=e.getEnvelope2D(c);f=bc(d.total());const r=xb(d.total(),h);q=3*r+3*f;h=d.total();Jb(e,r,h,g,null,c)}k.setEditShapeCrackAndCluster(e,d.add(q));
c=k.intersection(m,n);null!==g&&g.stitchCurves(e,c,f,!0);a=Kb(e.getGeometry(c),a,b,"\x26");gf(a.getGeometryType())&&(a.getImpl().setIsSimple(4,d.total()),a.getGeometryType()===p.GeometryType.enumPolygon&&a.getImpl().updateOGCFlagsProtected())}return a}intersectEx(a){var b=this.tryFastImplementation(a);if(null!==b){var c=[];c.length=3;c[b.getDimension()]=b;return this.prepareVector(a.getDescription(),this.m_dimensionMask,c)}b=Ld(this.m_intersectorGeom,a);var d=Ma(this.m_sr,b,!0).total();b=D.constructEmpty();
this.m_intersectorGeom.queryEnvelope(b);var e=D.constructEmpty();a.queryEnvelope(e);b.inflateCoords(2*d,2*d);b.intersect(e);b.inflateCoords(100*d,100*d);e=ra(this.m_intersectorGeom,b,0,0,this.m_progressTracker);b=ra(a,b,0,0,this.m_progressTracker);a.getDimension()>this.m_intersectorGeom.getDimension()&&(e=l.swap(b,b=e));a:{d=b;var f=this.m_sr,g=this.m_progressTracker;b=Array(3);var h=D.constructEmpty();d.queryEnvelope(h);var k=D.constructEmpty();e.queryEnvelope(k);var m=D.constructEmpty();m.setCoords({env2D:h});
m.mergeEnvelope2D(k);f=Ma(f,m,!0);k=new D(k);m=kb(f);k.inflateCoords(m,m);if(!h.isIntersecting(k)){if(d.getDimension()<=e.getDimension()){c=Kb(Ta(d.createInstance()),d,e,"\x26");b[c.getDimension()]=c;c=b;break a}if(d.getDimension()>e.getDimension()){c=Kb(Ta(e.createInstance()),d,e,"\x26");b[c.getDimension()]=c;c=b;break a}}const q=new yb(g);h=new Fa;const r=h.addGeometry(Ta(d)),t=h.addGeometry(Ta(e));let u=0;k=0;m=null;if(h.hasCurves()){m=new wb;var n=h.getEnvelope2D(g);k=bc(f.total());const v=xb(f.total(),
n);u=3*v+3*k;n=f.total();Jb(h,v,n,m,null,g)}q.setEditShapeCrackAndCluster(h,f.add(u));h.dbgVerifyCurves();g=q.intersectionEx(r,t);for(c of g)null!==m&&m.stitchCurves(h,c,k,!1),g=Kb(h.getGeometry(c),d,e,"\x26"),gf(g.getGeometryType())&&(g.getImpl().setIsSimple(4,f.total()),g.getGeometryType()===p.GeometryType.enumPolygon&&g.getImpl().updateOGCFlagsProtected()),b[g.getDimension()]=g;null!==m&&m.clearStitcher(h);c=b}return this.prepareVector(a.getDescription(),this.m_dimensionMask,c)}init(a,b,c,d){p.geometryReleaseAssert(0)}static intersectPoints(a,
b,c){const d=Ld(a,b);c=Ma(c,d,!0);a.isEmpty()||b.isEmpty()?a=a.createInstance():(c=kb(c),a=Ig(a.getX(),a.getY(),b.getX(),b.getY(),l.sqr(c))?new Y({copy:Qm(a,b)}):a.createInstance());return a}tryFastImplementation(a){var b=a.getGeometryType();if(this.m_intersectorGeomType===p.GeometryType.enumPoint&&b===p.GeometryType.enumPoint)return a=Wc.intersectPoints(a,this.m_intersectorGeom,this.m_sr),-1!==this.m_dimensionMask?(b=new Oa({vd:a.getDescription()}),a.isEmpty()||b.add(a),b):a;if(b===p.GeometryType.enumEnvelope&&
this.m_intersectorGeomType===p.GeometryType.enumEnvelope&&(-1===this.m_dimensionMask||4===this.m_dimensionMask))return b=this.m_intersectorGeom,a=new Ya({copy:a}),a.intersect(b),a;var c=Ld(a,this.m_intersectorGeom);c=Ma(this.m_sr,c,!0);var d=a.isEmpty(),e=this.m_intersectorGeom.isEmpty();e=d||e;if(!e){a:{var f=this.m_intersectorGeom;var g=c.total();var h=new D;f.queryEnvelope(h);const m=new D;a.queryEnvelope(m);const n=new D(m);n.inflate(2*g);if(n.isIntersecting(h)){f=f.getGeometryType();var k=a.getGeometryType();
if(f===p.GeometryType.enumEnvelope&&h.containsEnvelope(n))g=1;else{if(k===p.GeometryType.enumEnvelope&&(h=new D(h),h.inflate(2*g),m.containsEnvelope(h))){g=2;break a}g=0}}else g=4}if(4===g)e=!0;else{if(g&2)return this.m_intersectorGeom;if(g&1)return a}}if(e)return c=p.getDimensionFromType(b),e=p.getDimensionFromType(this.m_intersectorGeomType),c<e?Wc.ReturnEmpty(a,d):c>e?this.ReturnEmptyIntersector():0===c?b===p.GeometryType.enumMultiPoint&&this.m_intersectorGeomType===p.GeometryType.enumPoint?this.ReturnEmptyIntersector():
Wc.ReturnEmpty(a,d):Wc.ReturnEmpty(a,d);if(b===p.GeometryType.enumEnvelope&&0===p.getDimensionFromType(this.m_intersectorGeomType)||this.m_intersectorGeomType===p.GeometryType.enumEnvelope&&0===p.getDimensionFromType(b))return d=b===p.GeometryType.enumEnvelope?a:this.m_intersectorGeom,a=b===p.GeometryType.enumEnvelope?this.m_intersectorGeom:a,b=D.constructEmpty(),d.queryEnvelope(b),ra(a,b,c.total(),0,this.m_progressTracker);if(0===p.getDimensionFromType(b)&&0<p.getDimensionFromType(this.m_intersectorGeomType)||
0<p.getDimensionFromType(b)&&0===p.getDimensionFromType(this.m_intersectorGeomType)){if(b===p.GeometryType.enumMultiPoint)return kk(a,this.m_intersectorGeom,c);if(b===p.GeometryType.enumPoint)return jk(a,this.m_intersectorGeom,c,!0);if(this.m_intersectorGeomType===p.GeometryType.enumMultiPoint)return kk(this.m_intersectorGeom,a,c);if(this.m_intersectorGeomType===p.GeometryType.enumPoint)return jk(this.m_intersectorGeom,a,c,!0);p.throwInternalErrorException("")}return null}tryFastIntersectPolylinePolygon(a,
b){p.geometryReleaseAssert(0);return{}}AnalyseClipSegment(a,b,c){p.geometryReleaseAssert(0);return 0}AnalyseClipSegmenPt(a,b,c){p.geometryReleaseAssert(0);return 0}ReturnEmptyIntersector(){null===this.m_geomIntersectorEmptyGeom&&(this.m_geomIntersectorEmptyGeom=this.m_intersectorGeom.createInstance());return this.m_geomIntersectorEmptyGeom}static ReturnEmpty(a,b){return b?a:a.createInstance()}prepareVector(a,b,c){let d=0;b&1?(c[0]||(c[0]=new Oa({vd:a})),d++):c.shift();b&2?(c[d]||(c[d]=new ma({vd:a})),
d++):c.splice(d,1);b&4?c[d]||(c[d]=new ba({vd:a})):c.splice(d,1);return new bb.SimpleGeometryCursor(c)}}class Sn extends bb.GeometryCursor{constructor(a,b,c,d,e){super();this.m_smallCursor=null;this.m_progressTracker=d;this.m_geomIntersector=b.next();this.m_intersector=new Wc(this.m_geomIntersector,c,e,d);this.m_index=-1;this.m_inputGeoms=a;this.m_dimensionMask=e;-1!==this.m_dimensionMask&&(0>=this.m_dimensionMask||7<this.m_dimensionMask)&&p.throwInvalidArgumentException("bad dimension mask")}next(){if(!this.m_geomIntersector)return null;
let a;if(null!==this.m_smallCursor){if(a=this.m_smallCursor.next())return a;this.m_smallCursor=null}for(;a=this.m_inputGeoms.next();){p.throwIfMesh(a);this.m_index=this.m_inputGeoms.getGeometryID();if(-1===this.m_dimensionMask)return this.m_intersector.intersect(a);this.m_smallCursor=this.m_intersector.intersectEx(a);return this.m_smallCursor.next()}return null}getGeometryID(){p.geometryReleaseAssert(0);return 0}tock(){p.geometryReleaseAssert(0);return!1}getRank(){p.geometryReleaseAssert(0);return 0}}
class Uc{getOperatorType(){return 1E4}accelerateGeometry(a,b,c){if(!this.canAccelerateGeometry(a))return!1;ib(b,a,!0);b=0;a.getGeometryType()!==p.GeometryType.enumPolygon&&a.getGeometryType()!==p.GeometryType.enumPolyline||!Fe(a)||0===c||(b|=a.getImpl().buildQuadTreeAccelerator(c)?1:0);return b?!0:!1}canAccelerateGeometry(a){return Fe(a)}supportsCurves(){return!0}executeMany(a,b,c,d,e=-1){return new Sn(a,b,c,d,e)}execute(a,b,c,d){if(a.getGeometryType()===p.GeometryType.enumPoint&&b.getGeometryType()===
p.GeometryType.enumPoint)return Wc.intersectPoints(a,b,c);a=new bb.SimpleGeometryCursor([a]);b=new bb.SimpleGeometryCursor([b]);(c=this.executeMany(a,b,c,d,-1).next())||p.throwInternalErrorException("null output");return c}}class Tn{constructor(a){this.m_outputPCSHorizonClipOption=this.m_inputPCSHorizonClipOption=0;this.m_bDontHackPolesInGeogToGeog=this.m_bNormalizeOutputGeometry=this.m_bClipOutCurvedPoles=this.m_bDontGeonormalizePolygon=!1;this.m_densificationStepInput=this.m_centralMeridianOfOutputGCS=
0;a||p.throwInvalidArgumentException("");this.m_projTransform=a;this.m_bClipOutCurvedPoles=!1;a=this.m_projTransform.getExtendedParamsImpl();if(this.m_bNormalizeOutputGeometry=a.normalizeResultGeometry)a.legacyHorizonClipping?this.m_bNormalizeOutputGeometry=!1:this.m_projTransform.getOutputSR().isPannable()||(this.m_bNormalizeOutputGeometry=!1);a.clipWithInputHorizon?(this.m_inputPCSHorizonClipOption=0,!a.legacyHorizonClipping&&this.m_projTransform.getInputSR().isPannable()&&(this.m_inputPCSHorizonClipOption=
this.m_bNormalizeOutputGeometry?4:2)):this.m_inputPCSHorizonClipOption=1;a.clipWithOutputHorizon?(this.m_outputPCSHorizonClipOption=0,!a.legacyHorizonClipping&&this.m_projTransform.getOutputSR().isPannable()&&(this.m_outputPCSHorizonClipOption=this.m_bNormalizeOutputGeometry?4:2)):this.m_outputPCSHorizonClipOption=1;this.m_centralMeridianOfOutputGCS=a.centralMeridianOfOutputGCS;this.m_densificationStepInput=a.densificationStep;a=this.m_projTransform.getExtendedParamsInternal();this.m_bDontGeonormalizePolygon=
a.hasFlag(2147483648);this.m_bDontHackPolesInGeogToGeog=a.hasFlag(1073741824);this.m_bClipOutCurvedPoles=a.hasFlag(536870912)}project(a,b){if(this.m_projTransform.isIdentity()||a.isEmpty())return a;const c=a.getGeometryType();if(c===p.GeometryType.enumPoint)return this.projectPoint(a,b);const d=this.m_projTransform.getInputSR().getCoordinateSystemType(),e=this.m_projTransform.getOutputSR().getCoordinateSystemType();this.m_projTransform.getInputSR();this.m_projTransform.getOutputSR();if(0===d&&d===
e)return p.geometryReleaseAssert(0),a=a.clone(),a.applyTransformation({}),a;switch(c){case p.GeometryType.enumPolyline:case p.GeometryType.enumPolygon:return this.projectMultiPath(a,b);case p.GeometryType.enumMultiPoint:return this.projectMultiPoint(a,b);case p.GeometryType.enumEnvelope:return this.projectEnvelope(a,b);case p.GeometryType.enumGeometryCollection:return this.projectGeometryCollection(a,b);default:p.throwInternalErrorException("")}}projectPoint(a,b){b=[a.getXY()];let c=null,d;if(d=a.hasAttribute(1))c=
[a.getZ()];this.transformInPlaceZ(b,c,1,b,c,null);a=a.clone();a.setXY(b[0]);d&&a.setZ(c[0]);return a}projectMultiPoint(a,b){a=new Oa({copy:a});var c=this.m_projTransform.getInputSR();const d=this.m_projTransform.getOutputSR(),e=c.getCoordinateSystemType();var f=d.getCoordinateSystemType();3===e&&p.geometryReleaseAssert(0);a=pf(a,c,this.m_inputPCSHorizonClipOption,b);if(a.isEmpty())return a;2===e&&Nk(c,0,a);Ok(this.m_projTransform,a,!1);c=0;3===f&&p.geometryReleaseAssert(0);(f=2===f)?c=d.getCentralMeridian():
Number.isNaN(this.m_centralMeridianOfOutputGCS)||(c=this.m_centralMeridianOfOutputGCS);f&&0!==this.m_outputPCSHorizonClipOption||(a=Ad(a,wh(d),c,!1,0,b));f&&(a=dh(a,d,this.m_outputPCSHorizonClipOption,b),Kk(d,a,this.m_bNormalizeOutputGeometry),a.isEmpty());return a}projectMultiPath(a,b){const c=a.getGeometryType();if(c===p.GeometryType.enumPolygon)return this.projectPolygon(a,b);if(c===p.GeometryType.enumPolyline)return this.projectPolyline(a,b);p.throwInternalErrorException("project_multi_path_")}projectEnvelope(a,
b){this.m_projTransform.getInputSR();this.m_projTransform.getOutputSR();var c=this.m_projTransform.isVertical()&&a.hasAttribute(1);let d=l.Envelope1D.constructEmpty();c&&(d=a.queryInterval(1,0));return 0<d.width()?(c=a.clone(),c.setInterval(1,0,d.vmin,d.vmin),a=this.projectEnvelopeHelper(c,b),c.setInterval(1,0,d.vmax,d.vmax),b=this.projectEnvelopeHelper(c,b),a.merge(b),a):this.projectEnvelopeHelper(a,b)}projectPolygon(a,b){p.geometryReleaseAssert(a.getGeometryType()===p.GeometryType.enumPolygon);
p.geometryReleaseAssert(!this.m_projTransform.isIdentity());p.geometryReleaseAssert(!a.isEmpty());var c=this.m_projTransform.getInputSR();const d=this.m_projTransform.getOutputSR();var e=c.getCoordinateSystemType(),f=d.getCoordinateSystemType();a=new ba({copy:a});3===e&&p.geometryReleaseAssert(0);3===f&&p.geometryReleaseAssert(0);var g=2===e,h=2===f,k=g?c.getGCS():c,m=h?d.getGCS():d,n=!h&&!this.m_bDontHackPolesInGeogToGeog;f=!1;var q=pf(a,c,this.m_inputPCSHorizonClipOption,b);if(q.isEmpty())return q;
a=this.m_densificationStepInput;(e=!Number.isNaN(a))&&(q=(new Jc).execute(q,a,0,0,b));var r=h?d.getPCSInfo():null,t=Number.NaN;g&&(t=c.getCentralMeridian());var u=null!==d.getGCSSplitLines();if(this.m_bDontGeonormalizePolygon){if(g&&(qf(c,t,q),e)){var v=c.getUnitsPerMillimeter();k=c.getGCS().getUnitsPerMillimeter();a*=k/v}sf(this.m_projTransform,q,n);e&&(c=c.getGCS().getUnitsPerMillimeter(),n=d.getGCS().getUnitsPerMillimeter(),a*=n/c);c=q}else{v=new ma({vd:q.getDescription()});v.addAndExplicitlyOpenAllPaths(q,
!1);if(g&&(qf(c,t,v),e&&(g=c.getUnitsPerMillimeter(),t=c.getGCS().getUnitsPerMillimeter(),a*=t/g),this.m_bClipOutCurvedPoles)){t=c.getPCSInfo();g=t.getSouthPoleGeometry()===Xa.PE_POLE_LINE_CURVED;const w=t.getNorthPoleGeometry()===Xa.PE_POLE_LINE_CURVED;if(g||w)t=D.constructEmpty(),v.queryLooseEnvelope(t),t.inflateCoords(1,1),k=89.9999*k.getOneDegreeGCSUnit(),g&&(t.ymin=-k),w&&(t.ymax=k),k=t,g=new Rb(k,b),t=new D,v.queryLooseEnvelope(t),v=k.containsEnvelope(t)?v:k.isIntersecting(t)?g.clipPolesOut(v,
0):v.createInstance()}sf(this.m_projTransform,v,n);e&&(n=wh(c).getUnitsPerMillimeter(),k=wh(d).getUnitsPerMillimeter(),a*=k/n);g=Number.NaN;h?(r=d.getPCSInfo(),g=d.getCentralMeridian()):Number.isNaN(this.m_centralMeridianOfOutputGCS)||(g=this.m_centralMeridianOfOutputGCS);n=ef(c)|ef(d);t=10*m.getTolerance(0);this.m_bDontHackPolesInGeogToGeog&&(n=3,t=10*m.getTolerance(0));k=this.m_bNormalizeOutputGeometry;c=(new ff(q,null,v,c,m,g,n,t,b)).geoNormalizePolygonGeometry(k);n=0}u&&(p.geometryReleaseAssert(!d.isPannable()),
c=Ek(c,d,b));h&&(f||(h=m.getPannableExtent().width(),c.queryInterval(0,0).width()>=h-10*m.getTolerance(0)&&(m=r.getNorthPoleLocation(),h=r.getSouthPoleLocation(),u=r.getNorthPoleGeometry(),r=r.getSouthPoleGeometry(),q=0,u===Xa.PE_POLE_POINT&&m!==Xa.PE_POLE_OUTSIDE_BOUNDARY&&(q=1),r===Xa.PE_POLE_POINT&&h!==Xa.PE_POLE_OUTSIDE_BOUNDARY&&(q|=2),f||=0!==q)),c=dh(c,d,this.m_outputPCSHorizonClipOption,b),e&&(c=(new Jc).execute(c,a,0,0,b)),Lk(d,c,this.m_bNormalizeOutputGeometry));if(c.isEmpty())return c;
f&&(c=(new nc).execute(c,d,!1,b));return c}projectPolyline(a,b){p.geometryReleaseAssert(a.getGeometryType()===p.GeometryType.enumPolyline);p.geometryReleaseAssert(!this.m_projTransform.isIdentity());p.geometryReleaseAssert(!a.isEmpty());var c=this.m_projTransform.getInputSR();const d=this.m_projTransform.getOutputSR();var e=c.getCoordinateSystemType(),f=d.getCoordinateSystemType();a=new ma({copy:a});3===e&&p.geometryReleaseAssert(0);3===f&&p.geometryReleaseAssert(0);var g=2===e;f=2===f;g?c.getGCS():
c;var h=f?d.getGCS():d,k=!f&&!this.m_bDontHackPolesInGeogToGeog;let m=pf(a,c,this.m_inputPCSHorizonClipOption,b);if(m.isEmpty())return m;var n=Number.NaN;g&&(n=c.getCentralMeridian());a=null!==d.getGCSSplitLines();e=this.m_densificationStepInput;const q=!Number.isNaN(e);q&&(m=(new Jc).execute(m,e,0,0,b));if(this.m_bDontGeonormalizePolygon){if(g&&(qf(c,n,m),q)){h=c.getUnitsPerMillimeter();var r=c.getGCS().getUnitsPerMillimeter();e*=r/h}sf(this.m_projTransform,m,k);q&&(c=c.getGCS().getUnitsPerMillimeter(),
h=d.getGCS().getUnitsPerMillimeter(),e*=h/c);c=m}else{r=new ma({vd:m.getDescription()});r.addAndExplicitlyOpenAllPaths(m,!1);g&&(qf(c,n,r),q&&(g=c.getUnitsPerMillimeter(),n=c.getGCS().getUnitsPerMillimeter(),e*=n/g));sf(this.m_projTransform,r,k);q&&(k=c.getGCS().getUnitsPerMillimeter(),g=d.getGCS().getUnitsPerMillimeter(),e*=g/k);n=Number.NaN;f?n=d.getCentralMeridian():Number.isNaN(this.m_centralMeridianOfOutputGCS)||(n=this.m_centralMeridianOfOutputGCS);k=ef(c)|ef(d);let t=10*h.getTolerance(0);this.m_bDontHackPolesInGeogToGeog&&
(k=3,t=0);g=this.m_bNormalizeOutputGeometry;c=(new ff(m,null,r,c,h,n,k,t,b)).geoNormalizePolylineGeometry(g);k=0}a&&(p.geometryReleaseAssert(!d.isPannable()),c=Ek(c,d,b));f&&(c=dh(c,d,this.m_outputPCSHorizonClipOption,b),q&&(c=(new Jc).execute(c,e,0,0,b)),Lk(d,c,this.m_bNormalizeOutputGeometry));c.isEmpty();return c}projectGeometryCollection(a,b){p.geometryReleaseAssert(0);return{}}tryProjectMultiVertexSimple(a,b){p.geometryReleaseAssert(0);return{}}projectEnvelopeHelper(a,b){var c=(a.height()+a.width())/
400;if(0!==c){var d=(new Jc).execute(a,c,0,0,b),e=this.projectMultiPath(d,b);c=new Ya({vd:a.getDescription()});if(e.isEmpty()){e=Math.min(a.height(),a.width());var f=ib(this.m_projTransform.getInputSR(),a,!0).total();if(e>100*f){var g=D.constructEmpty();g=Ma(this.m_projTransform.getOutputSR(),g,!0).total();const h=this.m_projTransform.getInputSR().getOneMeter()/this.m_projTransform.getOutputSR().getOneMeter();if(e>100*Math.max(f,g*h))return c}e=new ma;e.addAndExplicitlyOpenAllPaths(d,!1);this.projectMultiPath(e,
b).queryEnvelope(c);d=new Oa({vd:a.getDescription()});d.reserve(4);e=new Y;for(f=0;4>f;f++)a.queryCornerByVal(f,e),d.add(e);a=this.projectMultiPoint(d,b);b=new Ya;a.queryEnvelope(b);c.merge(b)}else e.queryEnvelope(c);return c}c=a.getCenterXY();c=new Y(c);c=this.projectPoint(c,b);b=new Ya({vd:a.getDescription()});c.isEmpty()?b.setEmpty():(a.copyTo(b),a=c.getXY(),b.setCoords(a.x,a.y,a.x,a.y));return b}transformInPlace(a,b,c,d){p.geometryReleaseAssert(0);return 0}transformInPlaceZ(a,b,c,d,e,f){if(this.m_projTransform.isIdentity())return a!==
d&&l.assignObjectArray(d,a,c),b!==e&&l.memcpy(e,b,0,0,c),c;var g=this.m_projTransform;const h=g.getInputSR();f=g.getOutputSR();const k=h.getCoordinateSystemType();var m=f.getCoordinateSystemType();if(0===k&&k===m)return e=h.getHorzUnitFactor(),f=f.getHorzUnitFactor(),e/=f,f=new l.Transformation2D,f.setScaleCoords(e,e),f.transformPoints2D(a,c,d),g.isVertical()&&p.geometryReleaseAssert(0),c;3===k&&p.throwNotImplementedException("image: transform_in_place_");3===m&&p.throwNotImplementedException("image: transform_in_place_");
g=this.m_inputPCSHorizonClipOption;var n=h.getCoordinateSystemType();if(2===n)if(0===g)if(d!==a&&l.assignObjectArray(d,a,c),a=h.getPCSHorizon(),a.getGeometryType()===p.GeometryType.enumPolygon)for(g=h.getDefaultPrecisionSR().getTolerance(0),n=0;n<c;n++)1!==ob(a,d[n],g)&&d[n].setNAN();else if(a.getGeometryType()===p.GeometryType.enumEnvelope)for(g=0;g<c;g++)a.contains(d[g])||d[g].setNAN();else p.throwInvalidArgumentException("");else{if(d!==a&&l.assignObjectArray(d,a,c),h.isPannable()){g=h.getTolerance(0);
a=h.getPannableExtent();for(n=0;n<c;n++)d[n].y<a.ymin||d[n].y>a.ymax?d[n].setNAN():d[n].x=Xc(d[n].x,a,g);Hk(d,c,h,0)}}else{p.geometryReleaseAssert(1===n);const u=h.getTolerance(0),v=h.getPannableExtent();for(let w=0;w<c;w++){g=d[w];n=g.assign;var q=a[w],r=v,t=u;const x=new l.Point2D;x.x=Xc(q.x,r,t);x.y=q.y;n.call(g,x)}}e!==b&&l.memcpy(e,b,0,0,c);2===k&&rf(h,0,d,c);Ed(this.m_projTransform,d,e,c,!1);b=0;(m=2===m)?b=f.getCentralMeridian():Number.isNaN(this.m_centralMeridianOfOutputGCS)||(b=this.m_centralMeridianOfOutputGCS);
m&&0!==this.m_outputPCSHorizonClipOption||Hk(d,c,f.getGCS(),b);if(m){if(!eh(d,c,f,this.m_outputPCSHorizonClipOption))for(b=0;b<c;++b)d[b].setNAN();Dd(f,d,c,!1)}f=c;for(b=0;b<c;++b)d[b].isNAN()&&(e&&(e[b]=Number.NaN),f--);return f}}class xc{getOperatorType(){return 10300}supportsCurves(){return!0}accelerateGeometry(a,b,c){return!1}canAccelerateGeometry(a){return!1}executeMany(a,b,c){return!b||b.isIdentity()?a:new Un(a,b,c)}execute(a,b,c){return b.isIdentity()?a:b.m_projector.project(a,c)}transform(a,
b,c,d,e=!0){return e?Vm(a,b,c,d,null):Wg(a,b,c,d,null)}transform3D(a,b,c,d,e){p.geometryReleaseAssert(0);return 0}foldInto360Range(a,b){return df(a,b,null)}foldInto360RangeGeodetic(a,b,c){return Xg(a,b,c,null)}normalizeGeometryEx(a,b,c,d,e=0){return Zm(a,b,c,d,e)}normalizeGeometry(a,b,c){return Wm(a,b,c)}clipToSpatialReference(a,b,c,d=0){return Xm(a,b,c,d)}}class Un extends bb.GeometryCursor{constructor(a,b,c){super();this.m_projTrans=b;this.m_progressTracker=c;this.m_index=-1;a||p.throwInvalidArgumentException("");
this.m_inputGeoms=a}next(){const a=this.m_inputGeoms.next();return null!=a?(p.throwIfCurves(a),p.throwIfMesh(a),this.m_index=this.m_inputGeoms.getGeometryID(),this.m_projTrans.m_projector.project(a,this.m_progressTracker)):null}getGeometryID(){return this.m_index}tock(){p.geometryReleaseAssert(0);return!1}getRank(){p.geometryReleaseAssert(0);return 0}}class Ym{constructor(){this.m_progressTracker=this.m_transform=this.m_gcs=this.m_sr=null;this.m_curveType=this.m_maxDeviation=this.m_maxLength=this.m_radTolerance=
this.m_gcsTolerance=this.m_rpu=this.m_eSquared=this.m_a=0}geodeticDensify(a){const b=a.createInstance(),c=a.querySegmentIterator(),d=[],e=[],f=new W;for(a=1<a.getDescription().getAttributeCount();c.nextPath();){const r=[0];for(;c.hasNextSegment();){const t=c.nextSegment();var g=t.getStartXY(),h=t.getEndXY();g.scale(this.m_rpu);h.scale(this.m_rpu);var k=new l.Point2D;const u=new l.Point2D;var m=0<g.compare(h),n=k,q=u;m?(n.setCoordsPoint2D(h),q.setCoordsPoint2D(g)):(n.setCoordsPoint2D(g),q.setCoordsPoint2D(h));
d.length=0;e.length=0;0<this.m_maxLength?vk(this.m_a,this.m_eSquared,this.m_curveType,k,u,this.m_maxLength,this.m_maxDeviation,this.m_radTolerance,null,null,a?e:null,d,r):p.geometryReleaseAssert(0);m&&ah(null,null,a?e:null,d);d[0].setCoordsPoint2D(t.getStartXY());d.at(-1).setCoordsPoint2D(t.getEndXY());k=1/this.m_rpu;for(let v=1,w=d.length-1;v<w;v++)d[v].scale(k);a?(m=zk(m,t,f),uk(c.isFirstSegmentInPath(),c.isLastSegmentInPath()&&!c.isPathClosed(),t,m,e,d,b)):tk(c.isFirstSegmentInPath(),c.isLastSegmentInPath()&&
!c.isPathClosed(),d,b)}}return b}shapePreservingDensify(a){const b=a.createInstance(),c=a.querySegmentIterator(),d=[],e=[],f=new W;for(a=1<a.getDescription().getAttributeCount();c.nextPath();)for(;c.hasNextSegment();){const H=c.nextSegment();var g=H.getStartXY(),h=H.getEndXY();h=0<g.compare(h);const L=zk(h,H,f);d.length=0;e.length=0;var k=this.m_a,m=this.m_eSquared,n=this.m_rpu,q=L,r=this.m_sr,t=this.m_maxLength,u=this.m_maxDeviation;g=a?e:null;var v=d;const M=q.isCurve();var w=k*Math.sqrt(1-m)*Math.PI*
179/180;let N=t;if(!(0<t)||t>w)N=w;N=gj(k,m,N);w=u;!M||0<w||(w=.001);t=0<w;u=Number.NaN;t&&(u=gj(k,m,w));w=r.getPECoordSys();const Q=1===r.getCoordinateSystemType(),O=r.getTolerance(0);var x=q.getStartXY(),y=q.getEndXY();const P=new l.Point2D,ia=new l.Point2D;if(Q)P.setCoordsPoint2D(x),P.scale(n),ia.setCoordsPoint2D(y);else{var z=[x.x,x.y,y.x,y.y];F.peCSTransformations.projToGeog(w,2,z);P.setCoords(z[0],z[1]);P.scale(n);ia.setCoords(z[2],z[3])}ia.scale(n);let ka=z=0;const Aa=[],J=[],V=[];Aa.push(y.clone());
J.push(ia.clone());V.push(1);v.push(x.clone());null!==g&&g.push(ka);y=r.isPannable();x=x.clone();const ha=[.5,.33333333333333337,.6666666666666666,.16666666666666669,.8333333333333333];let ea=5;M||(t?(ha[0]=.5,ha[1]=.25,ha[2]=.75,ea=3):ea=1);for(;0<J.length;){const da=Aa.at(-1).clone();ia.assign(J.at(-1));const Ga=V.at(-1);let ta=!1,Da=Number.NaN;const qa=$g(k,m,P,ia);let Ca=N>=qa&&Math.abs(P.y-ia.y)<.9*Math.PI;Q&&Ca&&(Ca=Math.abs(P.x-ia.x)<.9*Math.PI);const $a=new l.Point2D,ya=new l.Point2D;var A=
!1;M||t||!Ca||Ca&&(A=!0);q.calculateSubLength(ka,Ga)<=O&&(A=!0);if(!A)for(A=0;A<ea;A++){var C=l.lerp(ka,Ga,ha[A]),B=new l.Point2D;q.queryCoord2D(C,B);var E=new l.Point2D;if(Q)E.setCoords(B.x*n,B.y*n);else{var G=[B.x,B.y];F.peCSTransformations.projToGeog(w,1,G);E.setCoords(G[0]*n,G[1]*n)}if(0===A&&(Da=C,$a.setCoordsPoint2D(B),ya.setCoordsPoint2D(E),!Ca)){ta=!0;break}if(Q&&Math.abs(P.x-E.x)>=Math.PI){ta=!0;break}C=$g(k,m,P,E);if(N<C){ta=!0;break}if(t){C=k;B=m;var I=ia;G=ha[A];const Pa=mb(C,B,P);I=mb(C,
B,I);G=X.lerp(Pa,I,G);C=sd(C,B,G);B=C.clone();Q?(B.x/=n,B.y/=n):(B.x/=n,B.y/=n,Wg(r.getGCSToSRTransform(),[B],1,[B],null));if(B.isNAN()){if(E=mb(k,m,E),C=mb(k,m,P),B=mb(k,m,ia),{second:E}=Dg(k,m,E,C,B,2,null),E>u){ta=!0;break}}else{if(y){E=r.getPannableExtent().width();for(G=l.lerp(q.getStartX(),q.getEndX(),.5);B.x<G-.5*E;)B.x+=E;for(;B.x>=G+.5*E;)B.x-=E}E=q.getClosestCoordinateOnInterval(B,new l.Envelope1D(ka,Ga),-1);E=q.getCoord2D(E);Q||(B=[E.x,E.y],F.peCSTransformations.projToGeog(w,1,B),E.x=B[0],
E.y=B[1]);E.x*=n;E.y*=n;C=$g(k,m,E,C);if(C>u&&(C<4*u&&(E=mb(k,m,E),C=mb(k,m,P),B=mb(k,m,ia),{second:E}=Dg(k,m,E,C,B,2,null),C=E),C>u)){ta=!0;break}}}}ta?(Aa.push($a.clone()),J.push(ya.clone()),V.push(Da)):(Aa.pop(),J.pop(),V.pop(),v.push(da.clone()),z+=qa,null!==g&&g.push(z),x.setCoordsPoint2D(da),P.setCoordsPoint2D(ia),ka=Ga)}if(null!==g)for(k=1/z,m=0;m<g.length;m++)g[m]*=k;h&&ah(null,null,a?e:null,d);a?uk(c.isFirstSegmentInPath(),c.isLastSegmentInPath()&&!c.isPathClosed(),H,L,e,d,b):tk(c.isFirstSegmentInPath(),
c.isLastSegmentInPath()&&!c.isPathClosed(),d,b)}return b}}class Ck{constructor(a,b){this.m_basisX=new X;this.m_basisY=new X;this.m_normal=new X;p.geometryReleaseAssert(1===a.getCoordinateSystemType());this.m_gcs=a;const c=Bd();a.querySpheroidData(c);this.m_a=c.majorSemiAxis;this.m_e2=c.e2;this.m_rpu=a.getUnit().getUnitToBaseFactor();this.m_curvCenterRad=b.mul(this.m_rpu);a=this.m_curvCenterRad.x;b=this.m_curvCenterRad.y;this.m_cartCenter3D=bj(this.m_a,this.m_e2,Math.cos(a),Math.sin(a),Math.cos(b),
Math.sin(b),0);this.m_normal.setCoordsPoint3D(this.m_cartCenter3D);this.m_d=this.m_cartCenter3D.length();this.m_normal.divThis(this.m_d);X.selectRightHandedBasisFromNormal(this.m_normal,this.m_basisX,this.m_basisY);this.m_northPolePcs=this.projectPoint(l.Point2D.construct(0,.5*Math.PI/this.m_rpu));this.m_southPolePcs=this.projectPoint(l.Point2D.construct(0,.5*-Math.PI/this.m_rpu))}project(a){const b=a.getGeometryType();if(p.isMultiVertex(b))return p.throwIfCurves(a),this.projectMultiVertex(a);p.throwInvalidArgumentException("Gnomonic.project")}unproject(a,
b,c){const d=a.getGeometryType();if(p.isMultiVertex(d)){p.throwIfCurves(a);let V=a;const ha=[];if(d===p.GeometryType.enumPolygon){const ea=V.getPathCount();for(let da=0;da<ea;da++){const Ga=V.calculateRingArea2D(da);ha.push(Ga)}}this.unprojectMultiVertex(b,V);if(p.isMultiPath(d)){var e=V;const ea=this.m_gcs.getPannableExtent(),da=l.Point2D.construct(0,0);ea.centerAt(da);const Ga=ea.width(),ta=.5*Ga,Da=new l.Point2D;Da.setNAN();let qa=Number.NaN;for(let aa=0;aa<e.getPathCount();aa++)for(let ca=e.getPathStart(aa);ca<
e.getPathEnd(aa);ca++){const na=e.getXY(ca),la=sa(na.y,ea.ymax)||sa(ea.ymin,na.y);if(ca===e.getPathStart(aa))Da.setNAN(),qa=0;else if(!Da.isNAN()&&!la){var f=na.x,g=Da.x,h=qa;h+f-g>ta?h-=Ga:g-(h+f)>ta&&(h+=Ga);qa=h}na.x+=qa;e.setXY(ca,na);la||Da.setCoordsPoint2D(na)}e.getImpl().notifyModifiedFlags(2001);var k=ha,m=this.m_gcs,n=V;const Ca=n.getGeometryType(),$a=m.getPannableExtent();let ya=n,Pa=!1,La=!1;if(Ca===p.GeometryType.enumPolygon){const aa=new D,ca=l.Point2D.construct(0,0);aa.setCoords({env2D:$a});
aa.centerAt(ca);var q=aa,r=ya;{const fa=new D;r.queryEnvelope(fa);const T=sa(q.ymax,fa.ymax),xa=sa(q.ymin,fa.ymin),oa=T||xa;if(oa){const Ba=new ba,Lb=new D;for(let eb=0;eb<r.getPathCount();eb++){r.queryPathEnvelope(eb,Lb);let Bb=sa(q.ymax,Lb.ymax),Za=sa(q.ymin,Lb.ymin);if(!Bb&&!Za){Ba.addPath(r,eb,!0);continue}Ba.insertPath2D(-1,null,0,0,!0);const Ua=r.getPathStart(eb),Cb=r.getPathEnd(eb),Vb=Cb-Ua;let Mb=-1;for(Mb=Ua;Mb<Cb;Mb++){const Qa=r.getXY(Mb);Bb=sa(q.ymax,Qa.y);Za=sa(q.ymin,Qa.y);if(!Bb&&!Za)break}let Nb=
Mb,Ea=!1,Ra=Number.NaN;do{const Qa=r.getXY(Nb);Bb=sa(q.ymax,Qa.y);Za=sa(q.ymin,Qa.y);const fc=Ua+(Nb+1-Ua)%Vb;if(Bb||Za){let Wb=l.Point2D.construct(Ra,Qa.y);Ba.insertPoint2D(eb,-1,Wb);const gc=r.getXY(fc),Kc=sa(q.ymax,gc.y),hc=sa(q.ymin,gc.y);Kc||hc||(Wb=l.Point2D.construct(gc.x,Qa.y),Ea?Ba.setXY(Ba.getPointCount()-1,Wb):Ba.insertPoint2D(eb,-1,Wb));Ea=!0}else Ba.insertPoint2D(eb,-1,Qa),Ra=Qa.x,Ea=!1;Nb=fc}while(Nb!==Mb)}r.setEmpty();r.add(Ba,!1);var t=oa}else t=!1}const na=t;{const fa=[],T=[],xa=
.5*q.width();for(let oa=0;oa<r.getPathCount();oa++){const Ba=r.getXY(r.getPathStart(oa)),Lb=r.getXY(r.getPathEnd(oa)-1),eb=0>k[oa];if(Math.abs(Ba.x-Lb.x)>xa){let Bb=void 0,Za=void 0;var u=eb,v=m,w=q,x=oa,y=r,z=c;const Ua=new ba,Cb=new ba,Vb=new l.Transformation2D,Mb=y.getXY(y.getPathStart(x)),Nb=y.getXY(y.getPathEnd(x)-1),Ea=w.width(),Ra=.5*Ea,Qa=new D;y.queryEnvelope(Qa);const fc=Math.ceil(Qa.width()/Ea)+1;Mb.x>Nb.x?(Za=-Ea,Bb=u?w.ymin:w.ymax):(Za=Ea,Bb=u?w.ymax:w.ymin);Vb.setShiftCoords(Za,0);Ua.addPath(y,
x,!0);Cb.add(Ua,!1);const Wb=new Y;for(let Ql=0;Ql<fc;Ql++)Cb.applyTransformation(Vb),Cb.getPointByVal(0,Wb),Ua.lineToPoint(Wb),Ua.addSegmentsFromPath(Cb,0,0,Cb.getSegmentCount()-1,!1);const gc=Ua.getXY(0),Kc=Ua.getXY(Ua.getPointCount()-1);gc.y=Bb;Kc.y=Bb;Ua.lineTo(Kc);const hc=new l.Point2D;hc.setCoordsPoint2D(Kc);for(hc.x-=.5*Za;Math.abs(hc.x-gc.x)>Ra;)Ua.lineTo(hc),hc.x-=.5*Za;Ua.lineTo(gc);const Jf=w.getCenter().x,Rl=new D;Ua.queryEnvelope(Rl);let Kf=0;const Lf=Rl.getCenter().x;Lf-Jf>Ra?Kf=-Math.ceil((Lf-
Jf-Ra)/Ea):Jf-Lf>Ra&&(Kf=Math.ceil((Jf-Lf-Ra)/Ea));0!==Kf&&(Vb.setShiftCoords(Kf*Ea,0),Ua.applyTransformation(Vb));const Mf=new Fa,Dh=Mf.addGeometry(Ua);Cd(Mf,Dh,v,0,2,!0,w.xmin);Cd(Mf,Dh,v,0,2,!0,w.xmax);const Sl=Mf.getGeometry(Dh),Tl=Ae(Sl,w);Tl.inflateCoords(0,1);const Vn=Ma(null,Tl,!0);var A=ra(Sl,w,Vn.total(),Number.NaN,z);fa.push(A);T.push(oa)}else if(!eb&&0>r.calculateRingArea2D(oa)){let Bb=void 0;var C=m,B=q,E=oa,G=r,I=c;const Za=B.width(),Ua=.5*Za,Cb=B.getCenter().x,Vb=new D;G.queryPathEnvelope(E,
Vb);let Mb=0,Nb=Vb.getCenter().x;Nb-Cb>Ua?Mb=-Math.ceil((Nb-Cb-Ua)/Za):Cb-Nb>Ua&&(Mb=Math.ceil((Cb-Nb-Ua)/Za));if(0!==Mb){const fc=new l.Transformation2D;fc.setShiftCoords(Mb*Za,0);G.getImpl().applyTransformationToPath(fc,E);G.queryPathEnvelope(E,Vb);Nb=Vb.getCenter().x}const Ea=new D;B.containsExclusiveEnvelope(Vb)?(Bb=!1,Ea.setCoords({env2D:B})):(Bb=!0,Ea.setCoords({env2D:B}),Ea.xmin-=Za,Ea.xmax+=Za);let Ra=G.createInstance();Ra.addPathPoint2D(null,0,!0);const Qa=new l.Point2D;Qa.setCoords(Ea.xmin,
Ea.ymin);Ra.insertPoint2D(0,-1,Qa);Qa.setCoords(Ea.xmin,Ea.ymax);Ra.insertPoint2D(0,-1,Qa);Qa.setCoords(.5*(Ea.xmin+Ea.xmax),Ea.ymax);Ra.insertPoint2D(0,-1,Qa);Qa.setCoords(Ea.xmax,Ea.ymax);Ra.insertPoint2D(0,-1,Qa);Qa.setCoords(Ea.xmax,Ea.ymin);Ra.insertPoint2D(0,-1,Qa);Qa.setCoords(.5*(Ea.xmin+Ea.xmax),Ea.ymin);Ra.insertPoint2D(0,-1,Qa);if(Bb){Ra.addPath(G,E,!0);const fc=new l.Transformation2D;Nb<Cb?fc.setShiftCoords(Za,0):fc.setShiftCoords(-Za,0);G.getImpl().applyTransformationToPath(fc,E);Ra.addPath(G,
E,!0);const Wb=new Fa,gc=Wb.addGeometry(Ra);Cd(Wb,gc,C,0,2,!0,B.xmin);Cd(Wb,gc,C,0,2,!0,B.xmax);Ra=Wb.getGeometry(gc);const Kc=Ae(Ra,B);Kc.inflateCoords(0,1);const hc=Ma(null,Kc,!0).total();Ra=ra(Ra,B,hc,Number.NaN,I)}else Ra.addPath(G,E,!0);fa.push(Ra);T.push(oa)}}if(0===fa.length)var H=!1;else{var L=new ba({vd:r.getDescription()}),M=0,N=T[M];for(let oa=0;oa<r.getPathCount();oa++)oa===N?(L.add(fa[M],!1),M++,M<T.length&&(N=T[M])):L.addPath(r,oa,!0);r.setEmpty();r.add(L,!1);H=!0}}Pa=na||H;{var Q=aa,
O=ya;const fa=new D;O.queryEnvelope(fa);const T=ib(null,O,!0).total();if(Q.xmin-fa.xmin<=T&&fa.xmax-Q.xmax<=T)var P=O;else{var ia=O.createInstance(),ka=O.createInstance(),Aa=new D,J=O.getPathCount();for(let xa=0;xa<J;xa++)O.queryPathEnvelope(xa,Aa),Q.xmin-Aa.xmin<=T&&Aa.xmax-Q.xmax<=T?ia.addPath(O,xa,!0):(ka.setEmpty(),ka.addPath(O,xa,!0),ka=Ak(m,Q,ka,!0,c),ia.add(ka,!0));P=ia}}const la=P;la!==ya&&(La=!0);ya=la}else ya=(new xc).foldInto360RangeGeodetic(ya,m,2);Ca===p.GeometryType.enumPolygon&&(Pa||
La)&&(ya=(new nc).execute(ya,m,!1,c));ya!==n&&(n.setEmpty(),n.add(ya,!1))}else V=Ad(V,this.m_gcs,0,!0,0,c);return V}p.throwInvalidArgumentException("Gnomonic.unproject")}projectPoint(a){a=a.mul(this.m_rpu);a=mb(this.m_a,this.m_e2,a);var b=this.m_normal.dotProduct(a);if(0>=b)return l.Point2D.construct(Number.NaN,Number.NaN);a=a.mul(this.m_d/b).sub(this.m_cartCenter3D);b=new l.Point2D;b.x=this.m_basisX.dotProduct(a);b.y=this.m_basisY.dotProduct(a);return b}unprojectPoint(a){a=this.m_cartCenter3D.add(this.m_basisX.mul(a.x).add(this.m_basisY.mul(a.y)));
return sd(this.m_a,this.m_e2,a).divide(this.m_rpu)}projectMultiVertex(a){a=a.getImpl();let b=!0;const c=new l.Point2D,d=new l.Point2D;for(let e=0,f=a.getPointCount();e<f;e++)a.queryXY(e,c),c.y*this.m_rpu>.5*Math.PI?d.assign(this.m_northPolePcs):c.y*this.m_rpu<.5*-Math.PI?d.assign(this.m_southPolePcs):d.assign(this.projectPoint(c)),a.setXY(e,d),d.isNAN()&&(b=!1);a.notifyModifiedFlags(2001);return b}unprojectMultiVertex(a,b){b=b.getImpl();a*=a;const c=!this.m_northPolePcs.isNAN(),d=!this.m_southPolePcs.isNAN();
for(let e=0,f=b.getPointCount();e<f;e++){const g=b.getXY(e);let h=new l.Point2D;c&&l.Point2D.sqrDistance(g,this.m_northPolePcs)<=a?(h.setCoords(this.m_curvCenterRad.x,.5*Math.PI),h.scale(1/this.m_rpu)):d&&l.Point2D.sqrDistance(g,this.m_southPolePcs)<=a?(h.setCoords(this.m_curvCenterRad.x,.5*-Math.PI),h.scale(1/this.m_rpu)):h=this.unprojectPoint(g);b.setXY(e,h)}b.notifyModifiedFlags(2001)}}class ff{constructor(a,b,c,d,e,f,g,h,k){this.m_bAdjustedAtPoles=0;this.m_inputPoly=c;this.m_progressTracker=k;
this.m_originalGeometry=a;this.m_originalSR=d;this.m_polygonRingFlags=b;this.m_pannableSR=e;this.m_poleSnappingTolerance=h;this.m_poleFlags=g;this.m_bAdjustedAtPoles=0;a=this.m_pannableSR.getPannableExtent();Number.isNaN(f)||a.centerAtCoords(f,0);this.m_pannableExtent=a;this.m_centralLongitude=Number.isNaN(f)?this.m_pannableExtent.getCenterX():f;this.m_width360=this.m_pannableExtent.width();this.m_degree=this.m_width360/360;this.m_GCSLargeDelta=210*this.m_degree;p.geometryReleaseAssert(null===this.m_originalGeometry&&
null===this.m_originalSR||null!==this.m_originalGeometry&&null!==this.m_originalSR)}geonormalizeRing(a,b,c,d,e,f,g){let h=c;c=new ma({vd:this.m_inputPoly.getDescription()});c.addPath(this.m_inputPoly,a,!0);0!==this.m_poleFlags&&(this.m_bAdjustedAtPoles|=Bk(!0,c,this.m_pannableExtent.ymax-this.m_poleSnappingTolerance,this.m_pannableExtent.ymax,this.m_pannableExtent.width(),this.m_poleFlags)?1:0)&&(h=!1);let k=-1;h&&(k=this.m_originalGeometry.getPathStart(a));const m=c.getAttributeStreamRef(0),n=c.getPointCount();
let q=0;var r=m.read(0);let t=0;const u=3*this.m_pannableSR.getTolerance(0);let v=!1;const w=new l.Point2D,x=new l.Point2D;var y=!1;const z=c.hasNonLinearSegments(),A=new l.Point2D;for(let I=1;I<n;++I){m.queryPoint2D(2*I,A);var C=A.x;let H=C+q;var B=H-r;A.x=H;if(Math.abs(B)>this.m_GCSLargeDelta){if(h){var E=k+(I+1<n?I:0),G=f.read(2*(k+I-1));E=(f.read(2*E)-G)*d;Math.abs(B-E)>1*this.m_degree&&(h=!1)}h||(y=l.copySign(this.m_width360,H-r),q-=y,H=C+q,++t,y=0!==q,A.x=H)}else if(!v){a:{B=x;E=A;C=u*u;r=w.sub(B);
B=E.sub(B);E=r.sqrLength();G=B.sqrLength();if(E<=C||G<=C){C=!0;break a}const L=l.sqr(r.crossProduct(B));C=L<=C*E||L<=C*G?0<=r.dotProduct(B):!1}C&&(v=!0)}y&&(z&&p.throwInternalErrorException("error in geonormalize_ring_ for curves"),m.write(2*I,H));r=H;w.setCoordsPoint2D(x);x.setCoordsPoint2D(A)}t&&c.notifyModified();d=c.getXY(0);f=c.getXY(n-1);l.Point2D.distance(d,f)<u?(a=this.finalizeGeoNormalizeClosedRing(c,v,e),g.add(a,!1)):(0>b&&(null!==this.m_originalGeometry?(p.geometryReleaseAssert(null!==
this.m_originalGeometry),b=0<this.m_originalGeometry.calculateRingArea2D(a)?1:0):b=1),a=this.finalizeGeoNormalizeOpenedRing(0<b,c),g.add(a,!1))}geoNormalizePolygonGeometry(a){p.geometryReleaseAssert(this.m_originalSR&&this.m_originalGeometry||!this.m_originalGeometry&&!this.m_originalSR);p.geometryReleaseAssert(this.m_pannableSR.isPannable());var b=null,c=Number.NaN,d=!!this.m_originalSR&&this.m_originalSR.isPannable();d&&(b=this.m_originalGeometry.getAttributeStreamRef(0),c=this.m_width360/this.m_originalSR.getPannableExtent().width());
this.m_bAdjustedAtPoles=0;var e=new ba({vd:this.m_inputPoly.getDescription()});for(let g=0,h=this.m_inputPoly.getPathCount();g<h;++g)this.geonormalizeRing(g,this.m_polygonRingFlags?this.m_polygonRingFlags[g]?1:0:-1,d,c,a,b,e);c=this.m_pannableSR.getTolerance(0);d=this.m_pannableExtent.width()/180;of(e,this.m_pannableExtent,.1*c,!1);b=D.constructEmpty();b.setCoords({env2D:this.m_pannableExtent});if(a){a=!0;for(var f=0;2>f;f++){a=!0;const g=D.constructEmpty();for(let h=0,k=e.getPathCount();h<k;h++)if(e.queryPathEnvelope(h,
g),!(b.xmin<=g.xmin&&b.xmax>=g.xmax||g.xmin>=b.xmax||g.xmax<=b.xmin)){a=!1;break}if(a)break;b.move(.5*this.m_width360,0)}a||b.setCoords({env2D:this.m_pannableExtent})}a=ra(e,b,c,d,this.m_progressTracker);e=e!==a;c=this.m_originalGeometry?this.m_originalGeometry.calculateArea2D():1;f=a.calculateArea2D();d=0;0<f&&0>c?d=1:0>=f&&0<c&&(0===f?this.m_originalSR&&(f=Number.NaN,2===this.m_originalSR.getCoordinateSystemType()?f=this.m_originalSR.getPCSHorizon().calculateArea2D():1===this.m_originalSR.getCoordinateSystemType()&&
(f=this.m_originalSR.getPannableExtent().getArea()),c>.99*f&&(d=-1)):d=-1);0!==d&&(e=a.getDescription(),e=new ba({vd:e}),e.addEnvelope(b,!1),b=b.width()/180,b=e=(new Jc).execute(e,b,0,0,null),b.add(a,!1),e=!0,a=b);e&&(a=(new nc).execute(a,this.m_pannableSR,!1,this.m_progressTracker));return a}geoNormalizePolylineGeometry(a){p.geometryReleaseAssert(this.m_pannableSR.isPannable());var b=null,c=this.m_originalSR&&this.m_originalSR.isPannable();let d=1;c&&(p.geometryReleaseAssert(this.m_originalGeometry),
d=this.m_width360/this.m_originalSR.getPannableExtent().width(),b=this.m_originalGeometry.getAttributeStreamRef(0));const e=this.m_pannableExtent.width(),f=e*l.doubleEps()*4;let g=Number.NaN;const h=l.Envelope1D.constructEmpty();this.m_bAdjustedAtPoles=0;let k=new ma({vd:this.m_inputPoly.getDescription()});for(let w=0,x=this.m_inputPoly.getPathCount();w<x;++w){var m=c,n=new ma({vd:this.m_inputPoly.getDescription()});n.addPath(this.m_inputPoly,w,!0);var q=this.m_inputPoly.isClosedPath(w);0!==this.m_poleFlags&&
(this.m_bAdjustedAtPoles|=Bk(q,n,this.m_pannableExtent.ymax-this.m_poleSnappingTolerance,this.m_pannableExtent.ymax,e,this.m_poleFlags)?1:0)&&(m=!1);q=-1;var r=n.getPointCount();let y=!1;m&&(q=this.m_originalGeometry.getPathStart(w),y=this.m_originalGeometry.isClosedPath(w));const z=n.getAttributeStreamRef(0);let A=0;var t=z.read(0);let C=0;const B=new l.Point2D,E=new l.Point2D;let G=!1;const I=n.hasNonLinearSegments(),H=new l.Point2D;for(let L=1;L<r;++L){z.queryPoint2D(2*L,H);const M=H.x;let N=M+
A;const Q=N-t;H.x=N;if(Math.abs(Q)>this.m_GCSLargeDelta){if(m){var u=q+L-1,v=q;if(!y||L+1<r)v+=L;u=b.read(2*u);v=(b.read(2*v)-u)*d;Math.abs(Q-v)>1*this.m_degree&&(m=!1)}m||(t=l.copySign(this.m_width360,N-t),A-=t,N=M+A,++C,G=0!==A,H.x=N)}G&&(I&&p.throwInternalErrorException("error in geonormalize_ring_ for curves"),z.write(2*L,N));t=N;B.setCoordsPoint2D(E);E.setCoordsPoint2D(H)}C&&n.notifyModified();a?(q=!1,n.isEmpty()||(q=D.constructEmpty(),n.queryEnvelope(q),q.width()>=e||q.ymin<=this.m_pannableExtent.ymin||
q.ymax>=this.m_pannableExtent.ymax?q=!0:(Number.isNaN(g)&&(m=this.m_centralLongitude-.5*e,g=q.xmin,g+=Math.round((m-q.xmin)/e)*e,g>m&&(g-=e),p.geometryReleaseAssert(g<=m),g<m&&(g+=e),p.geometryReleaseAssert(g>=m)),m=Math.round((g-q.xmin)/e)*e,q.xmin+m>g+f&&(m-=e),q.xmin+m<g-f&&(m+=e),h.mergeCoordinate(q.xmin+m),h.mergeCoordinate(q.xmax+m),q=h.width()>=e,q||(r=new l.Transformation2D,r.setShiftCoords(m,0),n.applyTransformation(r)))),k.add(n,!1),q&&(k=(()=>{const L=new ma({vd:k.getDescription()});for(let N=
0,Q=k.getPathCount();N<Q;++N){var M=new ma({vd:k.getDescription()});M.addPath(k,N,!0);M=Ad(M,this.m_pannableSR,this.m_centralLongitude,!0,0,this.m_progressTracker);L.add(M,!1)}return L})(),a=!1)):(n=Ad(n,this.m_pannableSR,this.m_centralLongitude,!0,0,this.m_progressTracker),k.add(n,!1))}if(a)return k;b=this.m_pannableSR.getTolerance(0);c=this.m_pannableExtent.width()/180;of(k,this.m_pannableExtent,.1*b,!1);return ra(k,this.m_pannableExtent,b,c,this.m_progressTracker)}finalizeGeoNormalizeOpenedRing(a,
b){var c=b.getPointCount(),d=b.getXY(0),e=b.getXY(c-1),f=Math.abs(e.x-d.x);p.geometryReleaseAssert(Math.abs(f-Math.round(f/this.m_width360)*this.m_width360)<this.m_pannableSR.getTolerance(0));var g=l.sign(e.x-d.x);f=D.constructEmpty();b.queryLooseEnvelope(f);var h=this.m_pannableExtent.getCenterX(),k=0,m=h-this.m_width360;h+=this.m_width360;if(0<=g){k=Math.ceil((m-f.xmin)/this.m_width360);for(k*=this.m_width360;m>f.xmin+k;)k+=this.m_width360;for(;m<f.xmax+k;)k-=this.m_width360;for(720<f.width()&&
(h=m+360*Math.ceil(f.width()/360));h<f.xmax;)h+=this.m_width360}else{k=Math.ceil((h-f.xmax)/this.m_width360);for(k*=this.m_width360;h<f.xmax+k;)k-=this.m_width360;for(;h>f.xmin+k;)k+=this.m_width360;for(720<f.width()&&(m=h-360*Math.ceil(f.width()/360));m>f.xmin;)m-=this.m_width360}d=Math.round(Math.abs(e.x-d.x)/this.m_width360)*this.m_width360;e=g*d;const n=f.clone();n.move(k,0);const q=new l.Point2D(0,0);f=new l.Transformation2D;f.setShiftCoords(k,0);b.applyTransformation(f);const r=new ma({vd:b.getDescription()});
r.add(b,!1);q.assign(b.getXY(c-1));k=0;let t=r.getXY(0).x;for(;0<g?n.xmax<h:n.xmin>m;)n.move(e,0),f.xd=e,b.applyTransformation(f),t+=e,this.m_pannableExtent.xmin<=t&&this.m_pannableExtent.xmax>=t&&(k=r.getPointCount()-1),b.setXY(0,q),q.assign(b.getXY(c-1)),r.addSegmentsFromPath(b,0,0,c-1,!1);b=new ba({vd:r.getDescription()});b.add(r,!1);c=r.getXY(0);m=r.getXY(r.getPointCount()-1);g=0>g?a:!a;a=b.getPointCount()-1;g?(g=new l.Point2D(m.x,this.m_pannableExtent.ymax),b.lineTo(g),g=new l.Point2D(this.m_pannableExtent.getCenterX(),
this.m_pannableExtent.ymax),b.lineTo(g),g=new l.Point2D(c.x,this.m_pannableExtent.ymax),b.lineTo(g)):(g=new l.Point2D(m.x,this.m_pannableExtent.ymin),b.lineTo(g),g=new l.Point2D(this.m_pannableExtent.getCenterX(),this.m_pannableExtent.ymin),b.lineTo(g),g=new l.Point2D(c.x,this.m_pannableExtent.ymin),b.lineTo(g));b.interpolateAttributesPath(0,a,0);b.getImpl().changeRingStartPoint(k);d>this.m_width360&&(d=new ba({copy:b}),f.setShiftCoords(this.m_width360,0),d.applyTransformation(f),b.add(d,!1));return b}finalizeGeoNormalizeClosedRing(a,
b,c){var d=new ba({vd:a.getDescription()});d.add(a,!1);var e;(e=!d.hasNonLinearSegments())||(e=d.getPointCount()-2,e=d.getSegmentType(e)===p.GeometryType.enumLine);if(e)d.removePointFromPath(0,d.getPointCount()-1);else{e=new W;var f=d.getPointCount()-2;d.getSegmentBuffer(f,e,!1);d.removePointFromPath(0,f+1);d.closeLastPathWithSegment(e.get())}e=D.constructEmpty();d.queryLooseEnvelope(e);f=Math.ceil((this.m_pannableExtent.xmin-e.xmin)/this.m_width360);for(f*=this.m_width360;this.m_pannableExtent.xmin>
e.xmin+f;)f+=this.m_width360;for(;this.m_pannableExtent.xmin<e.xmax+f;)f-=this.m_width360;f+=this.m_width360;if(0!==f){e.move(f,0);const g=new l.Transformation2D;g.setShiftCoords(f,0);d.applyTransformation(g)}if(this.m_pannableExtent.xmin<=e.xmin&&this.m_pannableExtent.xmax>=e.xmax){b&&(b=d.calculateArea2D(),a=(new nc).execute(d,this.m_pannableSR,!0,this.m_progressTracker),a!==d&&(f=a.calculateArea2D(),l.sign(b)!==l.sign(f)&&a.reverseAllPaths(),d.assignMove(a)));b=c?new ba({copy:d}):new ba({move:d});
if(c)for(;e.xmin<this.m_pannableExtent.xmax;)e.move(this.m_width360,0),c=new l.Transformation2D,c.setShiftCoords(this.m_width360,0),d.applyTransformation(c),b.add(d,!1);return b}c=new ba({vd:a.getDescription()});c.add(d,!1);for(b=b||e.width()>this.m_width360-10*this.m_pannableSR.getTolerance(0);e.xmin<this.m_pannableExtent.xmax;)e.move(this.m_width360,0),a=new l.Transformation2D,a.setShiftCoords(this.m_width360,0),d.applyTransformation(a),c.add(d,!1);b&&(d=c.calculateArea2D(),c.setFillRule(1),c=(new nc).execute(c,
this.m_pannableSR,!0,this.m_progressTracker),e=c.calculateArea2D(),l.sign(d)!==l.sign(e)&&c.reverseAllPaths());return c}geonormalize_ring_(a,b,c,d,e,f,g){p.geometryReleaseAssert(0)}}class Eh{supportsCurves(){return!0}accelerateGeometry(a,b,c){return Dk(a,b,c)}canAccelerateGeometry(a){return bh(a)}}class Jk extends Eh{getOperatorType(){return 8}execute(a,b,c,d){return uc(a,b,c,1,d)}}class hf{getOperatorType(){return 10002}supportsCurves(){return!0}accelerateGeometry(a,b,c){return!1}canAccelerateGeometry(a){return!1}executeMany(a,
b,c,d){return new Wn(a,b,c,d)}execute(a,b,c,d){return this.executeMany(new bb.SimpleGeometryCursor([a]),new bb.SimpleGeometryCursor([b]),c,d).next()}}class Wn extends bb.GeometryCursor{constructor(a,b,c,d){super();this.m_progressTracker=d;this.m_index=-1;this.m_inputGeoms=a;this.m_spatialReference=c;this.m_geomSubtractor=(a=b.next())?a:new ba}next(){const a=this.m_inputGeoms.next();return a?(p.throwIfMesh(a),p.throwIfGeometryCollection(a),this.m_index=this.m_inputGeoms.getGeometryID(),$m(a,this.m_geomSubtractor,
this.m_spatialReference,this.m_progressTracker)):null}getGeometryID(){return this.m_index}tock(){p.geometryReleaseAssert(0);return!1}getRank(){p.geometryReleaseAssert(0);return 0}}class nf{getOperatorType(){return 10001}supportsCurves(){return!0}accelerateGeometry(a,b,c){return!1}canAccelerateGeometry(a){return!1}executeMany(a,b,c,d=0){return new Fh(a,b,c,d)}execute(a,b,c,d){a=new bb.SimpleGeometryCursor([a,b]);(c=(new Fh(a,c,d,0)).next())||p.throwInternalErrorException("null output");return c}}class Xn{constructor(){this.binVertexCount=
0;this.geometries=[]}addPair(a){this.binVertexCount+=a.vertexCount;this.geometries.push(a)}sort(){this.geometries.sort((a,b)=>{a=l.Point2D.compareZorder(a.location,b.location)?-1:a.location.equals(b.location)?0:1;return a})}geomCount(){return this.geometries.length}geomPairs(){return this.geometries}clear(){this.binVertexCount=0;this.geometries.length=0}getBinVertexCount(){return this.binVertexCount}}class Fh extends bb.GeometryCursor{constructor(a,b,c,d,e=!1){super();this.m_currentDim=this.m_index=
-1;this.m_bDone=!1;this.m_unionBins=[];this.m_readyGeoms=l.makeNullArray(4);this.m_dimGeomCounts=l.makePrimitiveArray(4,0);this.m_addedGeoms=0;this.m_maxDimension=-1;this.m_bHadGeometry=l.makePrimitiveArray(4,!1);this.m_complexUnionGeoms=l.makeNullArray(4);this.m_totalNonEmptyGeomCounters=l.makePrimitiveArray(4,0);this.m_progressTracker=c;this.m_bUnionAllDimensions=0!==(d&4);this.m_bPreserveAllPathEnds=0!==(d&8);this.m_inputGeoms=a;this.m_spatialReference=b;this.m_options=d;this.m_bIs3D=e}next(){if(this.m_bDone&&
this.m_currentDim===this.m_maxDimension)return null;for(;!this.step_(););if(-1===this.m_maxDimension)return null;if(this.m_bUnionAllDimensions){if(-1===this.m_currentDim)for(var a=0;a<=this.m_maxDimension;a++)if(this.m_bHadGeometry[a]){this.m_complexUnionGeoms[a]=this.getResultGeometry(a);for(let b=a+1;b<=this.m_maxDimension;b++)this.m_complexUnionGeoms[b]=this.getResultGeometry(b),this.m_bHadGeometry[b]&&!this.m_complexUnionGeoms[b].isEmpty()&&(this.m_bIs3D?p.geometryReleaseAssert(0):this.m_complexUnionGeoms[a]=
(new hf).execute(this.m_complexUnionGeoms[a],this.m_complexUnionGeoms[b],this.m_spatialReference,this.m_progressTracker))}for(;this.m_currentDim++,(this.m_currentDim>this.m_maxDimension||0>this.m_currentDim)&&p.throwInternalErrorException(""),!this.m_bHadGeometry[this.m_currentDim];);this.m_index++;return 0===this.m_currentDim&&this.m_complexUnionGeoms[this.m_currentDim].getGeometryType()===p.GeometryType.enumPoint?(a=new Oa({vd:this.m_complexUnionGeoms[this.m_currentDim].getDescription()}),this.m_complexUnionGeoms[this.m_currentDim].isEmpty()||
a.add(this.m_complexUnionGeoms[this.m_currentDim]),a):this.m_complexUnionGeoms[this.m_currentDim]}this.m_index=0;this.m_currentDim=this.m_maxDimension;return this.getResultGeometry(this.m_maxDimension)}getGeometryID(){return this.m_index}getRank(){p.geometryReleaseAssert(0);return-1}tock(){return this.step_()}getResultGeometry(a){return this.m_readyGeoms[a]}finishDim(a,b,c){if(c){if(0!==(this.m_options&1))return b;1===a?0===(this.m_options&8)&&(0!==(this.m_options&16)||1<this.m_totalNonEmptyGeomCounters[a])?
(b=Tg([b],1,this.m_spatialReference,this.m_progressTracker,this.m_options|16,this.m_bIs3D),c=b.getImpl().getIsSimple(0,[0]),p.geometryReleaseAssert(this.m_bIs3D||4<=c)):1===this.m_totalNonEmptyGeomCounters[a]&&(this.m_bIs3D?p.geometryReleaseAssert(0):b=(new nc).execute(b,this.m_spatialReference,!1,this.m_progressTracker)):this.m_bIs3D?p.geometryReleaseAssert(0):b=(new nc).execute(b,this.m_spatialReference,!1,this.m_progressTracker);0===a&&b.getGeometryType()===p.GeometryType.enumPoint&&(a=new Oa({vd:b.getDescription()}),
b.isEmpty()||a.add(b),b=a)}else 0!==(this.m_options&16)&&(b=Tg([b],1,this.m_spatialReference,this.m_progressTracker,this.m_options,this.m_bIs3D));return b}static getLevel(a){a=p.vertexCount(a);a=0<a?(Math.log(a)-Math.log(32))/Math.log(4):0;0>a&&(a=0);return Math.floor(a)}step_(){if(this.m_bDone)return!0;if(this.m_inputGeoms){var a=this.m_inputGeoms.next();null===a?(this.m_bDone=!0,this.m_inputGeoms=null):(this.checkAndThrow(a),a.isEmpty()||this.m_totalNonEmptyGeomCounters[a.getDimension()]++)}else a=
null;if(null!==a){var b=a.getDimension();this.m_bHadGeometry[b]=!0;if(b>=this.m_maxDimension||this.m_bUnionAllDimensions)this.addGeom(b,!1,a),b>this.m_maxDimension&&!this.m_bUnionAllDimensions&&this.removeAllBinsWithLowerDimension(b)}if(0<this.m_addedGeoms)for(a=0;a<=this.m_maxDimension;a++){for(;1<this.m_dimGeomCounts[a];)if(b=this.collectGeometriesToUnion(a),null!==b)b=0===(this.m_options&1)?Sm(b,b.length,this.m_spatialReference,this.m_progressTracker,this.m_options|8,this.m_bIs3D):Tg(b,b.length,
this.m_spatialReference,this.m_progressTracker,this.m_options,this.m_bIs3D),this.addGeom(a,!0,b);else break;if(this.m_bDone&&(p.geometryReleaseAssert(1>=this.m_dimGeomCounts[a]),0!==this.m_dimGeomCounts[a])){var c=this.m_unionBins[a].entries().next().value;b=c[1].geomPairs()[0].geom;c=c[1].geomPairs()[0].bUnioned;this.m_unionBins[a].clear();this.m_readyGeoms[a]=this.finishDim(a,b,c)}}return this.m_bDone}addGeom(a,b,c){const d={geom:null,vertexCount:-1,bUnioned:!1,location:new l.Point2D};d.geom=c;
var e=p.vertexCount(c);d.vertexCount=e;var f=D.constructEmpty();c.queryEnvelope(f);d.location=0<e?f.getCenter():new l.Point2D(0,0);c=Fh.getLevel(c);if(a+1>this.m_unionBins.length)for(;this.m_unionBins.length<Math.max(2,a+1);)this.m_unionBins.push(new Map);e=null;(f=this.m_unionBins[a].get(c))&&(e=f);null===e&&(e=new Xn,this.m_unionBins[a].set(c,e));d.bUnioned=b;e.addPair(d);this.m_dimGeomCounts[a]++;this.m_addedGeoms++;this.m_maxDimension=Math.max(this.m_maxDimension,a)}removeAllBinsWithLowerDimension(a){p.geometryReleaseAssert(0)}collectGeometriesToUnion(a){if(0!==
(this.m_options&1)&&!this.m_bDone)return null;let b=null;const c=[];for(var d of this.m_unionBins[a].keys())c.push(d);l.numericSort(c);for(d=0;d<c.length;d++){if(-1===c[d])continue;const f=this.m_unionBins[a].get(c[d]);var e=5E3<f.getBinVertexCount()&&4<=f.geomCount();if(this.m_bDone||e){for(e=0;e<d;e++){if(-1===c[e])continue;const g=this.m_unionBins[a].get(c[e]);g.sort();this.m_dimGeomCounts[a]-=g.geomCount();this.m_addedGeoms-=g.geomCount();for(const h of g.geomPairs())b||=[],b.push(h.geom);g.clear();
this.m_unionBins[a].delete(c[e]);c[e]=-1}f.sort();this.m_dimGeomCounts[a]-=f.geomCount();this.m_addedGeoms-=f.geomCount();for(const g of f.geomPairs())b||=[],b.push(g.geom);f.clear();this.m_unionBins[a].delete(c[d]);c[d]=-1;if(!this.m_bDone)break}}return b}checkAndThrow(a){this.m_bIs3D&&(1<a.getDimension()&&p.throwInvalidGeometryTypeFor3DOps(),a.hasAttribute(1)||p.throwInvalidArgumentException("Geometry must have Zs"));p.throwIfMesh(a)}}class fh extends Eh{getOperatorType(){return 3}execute(a,b,c,
d=null){return uc(a,b,c,4,d)}}class Ul extends bb.GeometryCursor{constructor(){super();this.m_geometryDeque=[];this.m_index=-1}next(){if(0<this.m_geometryDeque.length){this.m_index++;const a=this.m_geometryDeque[0];this.m_geometryDeque.shift();return a}return null}getGeometryID(){return this.m_index}tick(a){this.m_geometryDeque.push(a)}tock(){return!0}getRank(){return 1}}class lh{constructor(a,b){this.m_GCSSplitLines=this.m_GCSHorizon=this.m_PCSHorizon=null;this.m_bGCSHorisonIsInclusive=!1;this.m_gcsUnitFactor=
this.m_oneDegreeGCS=this.m_oneMeterPCS=0;this.m_northPole=l.Point2D.getNAN();this.m_southPole=l.Point2D.getNAN();this.m_polesUpdated=0;this.m_domain=D.constructEmpty();this.m_primeMeridian=Number.NaN;this.m_geogToProjFactor=1;this.m_centralMeridian=this.m_oneMillimeter=this.m_geogToProjFactorsUpdated=this.m_geogToProjOffset=0;this.m_pPCSInfoNoDomain=null;this.m_oldWKID=-1973;this.m_vcsWKID=-1;this.m_bCached=this.m_bIsPannable=!1;this.m_pannableExtent=D.constructEmpty();this.m_pannableExtentGCS=D.constructEmpty();
this.m_areaOfUse=null;this.m_canonicalWkt="";this.m_peCoordSys=a;this.m_WKID=F.peFactory.getCode(a);0>=this.m_WKID?(this.m_WKID=0,this.m_canonicalWkt=ch(a,0,!0),this.m_hashCode=l.hashString(this.m_canonicalWkt)):this.m_hashCode=l.nextRand(this.m_WKID);var c=this.m_peCoordSys.getType();this.m_csType=c===F.peDefs.PE_TYPE_PROJCS?2:1;p.geometryReleaseAssert(c===F.peDefs.PE_TYPE_PROJCS||c===F.peDefs.PE_TYPE_GEOGCS);c===F.peDefs.PE_TYPE_PROJCS&&(a.loadConstants()||p.throwInvalidArgumentException("PeProjcs.loadConstants failed"));
b=c===F.peDefs.PE_TYPE_GEOGCS?this.m_peCoordSys:this.m_peCoordSys.getGeogcs();c!==F.peDefs.PE_TYPE_GEOGCS&&F.peFactory.getCode(b);const d=wf(null);a.getType()===F.peDefs.PE_TYPE_PROJCS?d.reset(a.getUnit()):a.getType()===F.peDefs.PE_TYPE_GEOGCS?d.reset(a.getUnit()):p.throwInvalidArgumentException("PE_coord_sys");d.get()||p.throwInternalErrorException("cannot create units from coord sys");a=d.get();a.getType()===F.peDefs.PE_TYPE_LINUNIT?a=new ad(a):a.getType()===F.peDefs.PE_TYPE_ANGUNIT?a=new te(a):
(p.throwInvalidArgumentException("peUnit"),a=void 0);this.m_unit=a;this.m_primeMeridian=b.getPrimem().getLongitude();this.m_gcsUnitFactor=a=b.getUnit().getUnitFactor();a=Math.PI/(180*a);1E-10>Math.abs(a-1)&&(a=1);this.m_oneDegreeGCS=a;c===F.peDefs.PE_TYPE_PROJCS?(b=this.m_peCoordSys,c=b.getUnit().getUnitFactor(),this.m_oneMeterPCS=1/c,this.m_oneMillimeter=.001/c,(this.m_pPCSInfoNoDomain=Xa.generate(b,Xa.PE_PCSINFO_OPTION_NONE))||p.throwInternalErrorException("cannot create pcs info"),this.m_bIsPannable=
this.m_pPCSInfoNoDomain.isPannableRectangle(),this.m_centralMeridian=this.m_pPCSInfoNoDomain.getCentralMeridian()):(this.m_bIsPannable=!0,this.m_polesUpdated=1,this.m_oneMeterPCS=0,c=1/b.getUnit().getUnitFactor(),this.m_oneMillimeter=.001/b.getDatum().getSpheroid().getAxis()*c,this.m_centralMeridian=0);this.m_bIsPannable&&(this.updateGCSHorizon(),this.updatePCSHorizon(),this.updatePoles(),this.updateDomain(),this.updatePannableExtent(),this.updatePannableExtentGCS())}[Symbol.dispose](){}getHashCode(){return this.m_hashCode}getPCSHorizonPannable(){return this.m_PCSHorizon}getGCSHorizonPannable(){return this.m_GCSHorizon}getPCSInfo(){p.geometryReleaseAssert(this.m_pPCSInfoNoDomain);
return this.m_pPCSInfoNoDomain}getCentralMeridian(){return this.m_centralMeridian}updateGCSHorizon(){if(this.m_peCoordSys.getType()===F.peDefs.PE_TYPE_PROJCS){var a=!0;a=this.m_peCoordSys;var b=a.getGeogcs(),c=a.horizonGcsGenerate();if(c){p.geometryReleaseAssert(0<c.length);var d=c[0].getNump(),e=c[0].getKind();a=0<c[0].getInclusive();var f=this.getOneDegreeGCSUnit(),g=90*f,h=360*f,k=370*f;var m=180*f*F.peDefs.PE_HORIZON_DELTA/Math.PI;var n=D.constructEmpty(),q=null;if(1<d)for(var r=1;r<d;r++)if(c[r].getKind()===
F.peDefs.PE_HORIZON_LINE){q||=new ma;var t=c[r].getCoord();q.startPathCoords(t[0][0],t[0][1]);q.lineToCoords(t[1][0],t[1][1])}if(e===F.peDefs.PE_HORIZON_RECT)c=c[0].getCoord(),n.setFromPoints([new l.Point2D(c[0][0],c[0][1]),new l.Point2D(c[1][0],c[1][1])],2),Math.abs(n.ymax-g)<1E-7*m&&(n.ymax=g),Math.abs(n.ymin+g)<1E-7*m&&(n.ymin=-g),n.width()>k&&(f*=-400,n.setCoords({xmin:f,ymin:n.ymin,xmax:f+5*h,ymax:n.ymax})),f=new Ya({env2D:n}),this.m_GCSHorizon||(this.m_GCSHorizon=f,this.m_bGCSHorisonIsInclusive=
a);else{r=this.getPCSInfo().isGcsHorizonMultiOverlap();b=nl(b,null,null,1);const x=[];k=new l.Envelope1D;for(n=0;n<d;n++)c[n].getKind()===F.peDefs.PE_HORIZON_POLY&&(m=c[n].getSize(),e=c[n].getCoord(),t=D.constructEmpty(),t.setFromPoints(l.coordinateArrayToPoint2DArray(e),m),x.push(new l.Envelope1D(t.xmin,t.xmax)),t.width(),k.merge(x.at(-1)));n=!1;const y=new l.Envelope1D;k.width()>h&&1<x.length?(y.vmin=this.getCentralMeridian()-h,y.vmax=y.vmin+2*h,r=n=!0):(y.vmin=k.vmin,y.vmax=y.vmin+h);k=z=>{let A=
0;for(;x[z].vmin+A<y.vmin;)A+=h;for(;x[z].vmax+A-h>y.vmin;)A-=h;return A};e=new ba;if(r){e=new Ul;r=(new nf).executeMany(e,b,null);for(t=0;t<d;t++)if(c[t].getKind()===F.peDefs.PE_HORIZON_POLY){m=c[t].getSize();var u=c[t].getCoord();var v=0<c[t].getInclusive();v=new ba;v.addPathPoint2D(l.coordinateArrayToPoint2DArray(u),m-1,!0);if(n){u=k(t);m=x[t].clone();m.move(u);var w=new l.Transformation2D;do{w.setShiftCoords(u,0);const z=v.clone();z.applyTransformation(w);e.tick(z);e.tock();u+=h;m.move(h)}while(m.vmin<
y.vmax)}else e.tick(v),r.tock()}e=r.next()}else for(e=new ba,r=0;r<d;r++)if(c[r].getKind()===F.peDefs.PE_HORIZON_POLY)if(m=c[r].getSize(),u=c[r].getCoord(),v=0<c[r].getInclusive(),p.geometryReleaseAssert(v===a),n){t=new ba;t.addPathPoint2D(l.coordinateArrayToPoint2DArray(u),m-1,!0);v=k(r);m=x[r].clone();m.move(v);u=new l.Transformation2D;do 0!==v?(u.setShiftCoords(v,0),w=new ba({copy:t}),w.applyTransformation(u),e.addPath(w,0,!0)):e.addPath(t,0,!0),v+=h,m.move(h);while(m.vmin<y.vmax)}else e.addPathPoint2D(l.coordinateArrayToPoint2DArray(u),
m-1,!0);n&&(e=(new Tc).execute(e,new D(y.vmin,-g-f,y.vmax,g+f),b,null));a?(new Uc).accelerateGeometry(e,b,1):(new hf).accelerateGeometry(e,b,1);(new fh).accelerateGeometry(e,b,1);null===this.m_GCSHorizon&&(this.m_GCSHorizon=e,this.m_bGCSHorisonIsInclusive=a,this.m_GCSSplitLines=q)}}}}updateAreaOfUse(){return null}updatePCSHorizon(){if(this.m_peCoordSys.getType()===F.peDefs.PE_TYPE_PROJCS){var a=this.m_peCoordSys.horizonPcsGenerate();if(a){this.getPCSInfo();var b=a[0].getKind();a[0].getInclusive();
var c=D.constructEmpty(),d=a[0].getNump(),e=!1;if(b===F.peDefs.PE_HORIZON_RECT)a=a[0].getCoord(),c.setFromPoints(l.coordinateArrayToPoint2DArray(a),2),a=new Ya({env2D:c});else{c=-1;for(e=0;e<d;e++)a[e].getKind()===F.peDefs.PE_HORIZON_POLY&&(c=e);p.geometryReleaseAssert(0<=c);e=a[c].getSize()-1;d=a[c].getCoord();a=c=new ba;c.addPathPoint2D(l.coordinateArrayToPoint2DArray(d),e,!0);e=!0}this.getPCSInfo().isDensificationNeeded()&&(p.geometryReleaseAssert(b!==F.peDefs.PE_HORIZON_RECT),b=1E5*this.getOneMeterPCSUnit(),
a=(new Jc).execute(a,b,0,0,null));e&&(b=new Ya,a.queryEnvelope(b),a.calculateArea2D(),a.calculateLength2D(),a.getExteriorRingCount(),(new Uc).accelerateGeometry(a,null,1));null===this.m_PCSHorizon&&(this.m_PCSHorizon=a)}}}updatePannableExtent(){var a=this.m_peCoordSys.getType();if(a===F.peDefs.PE_TYPE_PROJCS){a=this.m_peCoordSys;var b=this.getPCSInfo().getCentralMeridian(),c=a.getGeogcs();c||p.throwInternalErrorException("");c=1/c.getUnit().getUnitFactor()*Math.PI;b=[b+c,0];F.peCSTransformations.geogToProj(a,
1,b);b=b[0];a=a.getParameters()[F.peDefs.PE_PARM_X0].getValue();const d=this.getPCSHorizon();c=D.constructEmpty();d.queryEnvelope(c);b=Math.abs(b-a);this.m_pannableExtent.setCoords({xmin:-1*b+a,ymin:c.ymin,xmax:b+a,ymax:c.ymax})}else a===F.peDefs.PE_TYPE_GEOGCS?(a=1/this.m_peCoordSys.getUnit().getUnitFactor()*Math.PI,this.m_pannableExtent.setCoords({xmin:-a,ymin:-a/2,xmax:a,ymax:a/2})):p.throwInternalErrorException("")}updatePannableExtentGCS(){var a=this.m_peCoordSys.getType();if(a===F.peDefs.PE_TYPE_PROJCS){a=
this.m_centralMeridian;var b=this.m_peCoordSys.getGeogcs();b||p.throwInternalErrorException("");b=1/b.getUnit().getUnitFactor()*Math.PI;const c=this.getGCSHorizon(),d=D.constructEmpty();c.queryEnvelope(d);this.m_pannableExtentGCS.setCoords({xmin:a-b,ymin:d.ymin,xmax:a+b,ymax:d.ymax})}else a===F.peDefs.PE_TYPE_GEOGCS?(a=1/this.m_peCoordSys.getUnit().getUnitFactor()*Math.PI,this.m_pannableExtentGCS.setCoords({xmin:-a,ymin:-a/2,xmax:a,ymax:a/2})):p.throwInternalErrorException("")}updateDomain(){if(1===
this.m_csType){var a=400*this.getOneDegreeGCSUnit();this.m_domain=D.construct(-a,-a,a,a)}else p.geometryReleaseAssert(2===this.m_csType),(a=Xa.generate(this.m_peCoordSys,Xa.PE_PCSINFO_OPTION_DOMAIN))||p.throwInternalErrorException("generate pcs info failed"),a=new D(a.getDomainMinx(),a.getDomainMiny(),a.getDomainMaxx(),a.getDomainMaxy()),this.m_domain.isEmpty()&&this.m_domain.setCoords({env2D:a})}updatePoles(){if(this.m_peCoordSys.getType()===F.peDefs.PE_TYPE_PROJCS){var a=90*this.getOneDegreeGCSUnit();
a=[[0,a],[0,-a]];F.peCSTransformations.geogToProj(this.m_peCoordSys,2,a);const b=this.getPCSInfo().getNorthPoleLocation()!==Xa.PE_POLE_OUTSIDE_BOUNDARY,c=this.getPCSInfo().getSouthPoleLocation()!==Xa.PE_POLE_OUTSIDE_BOUNDARY;this.m_polesUpdated||(b&&this.m_northPole.setCoords(a[0][0],a[0][1]),c&&this.m_southPole.setCoords(a[1][0],a[1][1]),this.m_polesUpdated=1)}else this.m_polesUpdated=1}updateGeogToProjFactors(){if(this.m_peCoordSys.getType()===F.peDefs.PE_TYPE_PROJCS){var a=this.getOneDegreeGCSUnit(),
b=this.m_pPCSInfoNoDomain.getCentralMeridian(),c=[0,0,0,0];c[0]=b;c[1]=0;c[2]=b+a;c[3]=0;b=F.peCSTransformations.geogToProj(this.m_peCoordSys,2,c);p.geometryReleaseAssert(2===b);a=(c[2]-c[0])/a;c=c[0];0===this.m_geogToProjFactorsUpdated&&(this.m_geogToProjFactor=a,this.m_geogToProjOffset=c,this.m_geogToProjFactorsUpdated=1)}else this.m_geogToProjFactorsUpdated=1}getOneMeterPCSUnit(){return this.m_oneMeterPCS}getOneDegreeGCSUnit(){return this.m_oneDegreeGCS}getGcsUnitFactor(){return this.m_gcsUnitFactor}getUnitsPerMillimeter(){return this.m_oneMillimeter}getGCSSplitLines(){if(this.m_bIsPannable)return null;
if(this.m_GCSHorizon)return this.m_GCSSplitLines;this.updateGCSHorizon();return this.m_GCSSplitLines}getGCSHorizon(){if(this.m_bIsPannable)return this.getGCSHorizonPannable();if(null!==this.m_GCSHorizon)return this.m_GCSHorizon;this.updateGCSHorizon();return this.m_GCSHorizon}getGCSHorisonIsInclusive(){this.m_bIsPannable||this.getGCSHorizon();return this.m_bGCSHorisonIsInclusive}getPCSHorizon(){if(this.m_bIsPannable)return this.getPCSHorizonPannable();if(null!==this.m_PCSHorizon)return this.m_PCSHorizon;
this.updatePCSHorizon();return this.m_PCSHorizon}getPole(a){if(this.m_bIsPannable||0!==this.m_polesUpdated)return a?this.m_southPole:this.m_northPole;this.updatePoles();return a?this.m_southPole:this.m_northPole}getGeogToProjFactors(){0===this.m_geogToProjFactorsUpdated&&this.updateGeogToProjFactors();return l.makePair(this.m_geogToProjFactor,this.m_geogToProjOffset)}getDomainXY(){if(this.m_bIsPannable)return this.m_domain.clone();let a=!1;(a=this.m_domain.isEmpty())&&this.updateDomain();return this.m_domain.clone()}getPrimeMeridian(){return this.m_primeMeridian}getLatestID(){return this.m_WKID}getOldID(){var a=
this.m_oldWKID;if(0>a){a=0;if(0<this.m_WKID){a=[0];this.m_peCoordSys.getType();var b=this.m_WKID;var c=a;0>=b?(c[0]=0,b=!1):(c[0]=b,b=!0);b||p.throwInternalErrorException("query_code_change");a=a[0]}this.m_oldWKID=a}return a}isCustomWkid(){return!1}isPannable(){return this.m_bIsPannable}getPannableExtent(){return this.m_pannableExtent.clone()}getPannableExtentGCS(){return this.m_pannableExtentGCS.clone()}getAreaOfUse(){return null!==this.m_areaOfUse?this.m_areaOfUse:this.updateAreaOfUse()}getVcsCode(){return 0}saveMemory(){}getCSType(){return this.m_csType}getUnit(){return this.m_unit}setCached(){this.m_bCached=
!0}getCached(){return this.m_bCached}static equal(a,b){return!1}static equal_for_projection(a,b){return!1}}class Rk{constructor(a,b,c,d,e,f){this.m_datumTran=null;this.m_bIdentityGeogToGeog=this.m_bIdentity=!0;this.m_bNormalize=this.m_bVertical=!1;b&&c||p.throwInvalidArgumentException("!inputSR || !outputSR");d&&0===d.getType()&&(d.m_bReadOnly=!0);this.m_bNormalize=!1;if(1!==a){a=b.getVCS();var g=c.getVCS();this.m_bVertical=null!=a&&null!=g}this.m_inputSR=b;this.m_outputSR=c;this.m_bIdentityGeogToGeog=
this.m_bIdentity=!1;p.geometryReleaseAssert(!this.m_params);e&&(this.m_params=pe(),this.m_params.m_extendedParams=e);f&&(this.m_params||(this.m_params=pe()),this.m_params.m_extendedParamsInternal=f);f=!1;a=null!=d;g=b.getCoordinateSystemType();const h=c.getCoordinateSystemType();if(c.isPannable()&&0!==g&&e){const m=e.centralMeridianOfOutputGCS;if(!Number.isNaN(m)&&c.isPannable()){var k=c.getPannableExtent();const n=k.getCenterX();n!==m&&(k=Math.ceil(k.width()),m+k!==n+k&&(f=!0))}}e=e&&e.normalizeResultGeometry;
b.equals(c)?(this.m_bIdentity=!f,this.m_bIdentityGeogToGeog=!0):(this.m_bIdentity=!a&&b.equalForProjection(c,this.m_bVertical)&&!f)?this.m_bIdentityGeogToGeog=!0:0!==g&&0!==h&&(e&&this.m_outputSR.isPannable()&&(this.m_bNormalize=e),this.m_datumTran=d?d:null,this.m_bIdentityGeogToGeog=(!this.m_datumTran||0===this.m_datumTran.count())&&this.m_inputSR.getGCS().equalForProjection(this.m_outputSR.getGCS(),this.m_bVertical));this.updateProjector()}getInputSR(){return this.m_inputSR}getOutputSR(){return this.m_outputSR}getDatumTransformation(){return this.m_datumTran}getInverse(){const a=
new Rk(1,this.m_outputSR,this.m_inputSR,this.m_datumTran?.createInverse());a.m_bIdentity=this.m_bIdentity;a.m_bVertical=this.m_bVertical;a.m_bIdentityGeogToGeog=this.m_bIdentityGeogToGeog;a.updateProjector();return a}isIdentity(){return this.m_bIdentity}getExtendedParams(){return this.m_params?this.m_params.m_extendedParams:pe().m_extendedParams}equals(a){p.geometryReleaseAssert(0);return!1}isVertical(){return this.m_bVertical}isMatchingTransformation(a,b){p.geometryReleaseAssert(0);return!1}getGeographicTransformations(){return this.m_datumTran}getExtendedParamsImpl(){return this.m_params?
this.m_params.m_extendedParams:pe().m_extendedParams}getExtendedParamsInternal(){return this.m_params?this.m_params.m_extendedParamsInternal:pe().m_extendedParamsInternal}isIdentityGeogToGeog(){return this.m_bIdentityGeogToGeog}normalizeOutput(){return this.m_bNormalize}updateProjector(){this.m_projector=new Tn(this)}}const mh=new Map,qe=new Map,nh=new Map;let Vl;class ad extends Fl{constructor(a){void 0===a?(super(),this.m_wkid=9001,this.m_peUnit=null):"number"===typeof a?(super(),this.m_factor=
a,this.m_wkid=0):(super(a),a||(this.m_factor=1,this.m_wkid=9001,Vl||=F.peFactory.unit(9001),this.m_peUnit=Vl))}getUnitType(){return 0}convertFromMeters(a){return a/this.getUnitToBaseFactor()}convertToMeters(a){return a*this.getUnitToBaseFactor()}}class gn{constructor(a,b){this.m_arc=a;this.m_sqrChordLength=b}getMaxDerivative(){return 1}getValue(a,b){return 0===a?l.Point2D.sqrDistance(this.m_arc.getCoord2D(b),this.m_arc.getCoord2D(1-b))-this.m_sqrChordLength:0}getError(a){p.geometryReleaseAssert(0);
return 0}}class Yn{constructor(a){this.m_currentSupport=this.m_handleQ=this.m_handleP=-1;this.m_area=0;this.m_bDone=!0;p.geometryReleaseAssert(0);this.m_convexHull=a;this.m_function=this.done_}next(){p.geometryReleaseAssert(0);return!1}get_vertex_handle_p(){p.geometryReleaseAssert(0);return 0}get_vertex_handle_q(){p.geometryReleaseAssert(0);return 0}get_current_support(){p.geometryReleaseAssert(0);return 0}getNext(a){p.geometryReleaseAssert(0);return 0}getPrev(a){p.geometryReleaseAssert(0);return 0}intialize_(){p.geometryReleaseAssert(0);
return!1}increment_(){p.geometryReleaseAssert(0);return!1}increment_q_(){p.geometryReleaseAssert(0);return!1}increment_p_(){p.geometryReleaseAssert(0);return!1}parallel_edge_with_q_support_(){p.geometryReleaseAssert(0);return!1}parallel_edge_with_p_support_(){p.geometryReleaseAssert(0);return!1}done_(){p.geometryReleaseAssert(0);return!1}}class sh{nullGetXY(a){p.throwInternalErrorException("m_getXY is null");return{}}nullDeleteNode(a){p.throwInternalErrorException("m_deleteNode is null")}constructor(a){this.m_treeHull=
new R;this.m_points=this.m_stream=this.m_shape=null;this.m_pathHandle=this.m_geometryHandle=-1;this.m_getXY=this.nullGetXY;this.m_deleteNode=this.nullDeleteNode;a?a.stream?(this.m_treeHull.setCapacity(Math.min(20,a.n)),this.m_stream=a.stream,this.m_getXY=this.getXYStream,this.m_deleteNode=this.deleteNodeStream,this.m_points=null,this.m_pathHandle=this.m_geometryHandle=-1):a.points?(this.m_treeHull.setCapacity(Math.min(20,a.n)),this.m_points=a.points,this.m_getXY=this.getXYPoints,this.m_deleteNode=
this.deleteNodePoints,this.m_stream=null,this.m_pathHandle=this.m_geometryHandle=-1):p.geometryReleaseAssert(0):(this.m_treeHull.setCapacity(20),this.m_shape=new Fa,this.m_geometryHandle=this.m_shape.createGeometry(p.GeometryType.enumMultiPoint),this.m_pathHandle=this.m_shape.insertPath(this.m_geometryHandle,-1),this.m_getXY=this.getXYShape,this.m_deleteNode=this.deleteNodeShape,this.m_points=this.m_stream=null)}getXYShape(a){return this.m_shape.getXY(a)}getXYStream(a){return this.m_stream.readPoint2D(a<<
1)}getXYPoints(a){p.geometryReleaseAssert(0);return new l.Point2D}deleteNodeShape(a){const b=this.m_treeHull.getElement(a);this.m_treeHull.deleteNode(a);this.m_shape.removeVertex(b,!1)}deleteNodeStream(a){this.m_treeHull.deleteNode(a)}deleteNodePoints(a){p.geometryReleaseAssert(0)}addGeometry(a){if(!a.isEmpty()){var b=a.getGeometryType();if(b===p.GeometryType.enumGeometryCollection)for(let c=0,d=a.getGeometryCount();c<d;c++)this.addGeometry(a.getGeometry(c));else p.isMultiVertex(b)?this.addMultiVertexGeometry(a):
p.isSegment(b)?this.addSegment(a):b===p.GeometryType.enumEnvelope?this.addEnvelope(a):b===p.GeometryType.enumPoint?this.addPoint(a):p.throwInvalidArgumentException("Convex_hull: geometry not supported")}}getBoundingGeometry(){const a=new Y;var b=this.m_treeHull.getFirst();const c=new ba({vd:this.m_shape.getVertexDescription()});if(0===this.m_treeHull.size())return c;c.reserve(this.m_treeHull.size());this.m_shape.queryPoint(this.m_treeHull.getElement(b),a);c.startPathPoint(a);for(b=this.m_treeHull.getNext(b);-1!==
b;b=this.m_treeHull.getNext(b))this.m_shape.queryPoint(this.m_treeHull.getElement(b),a),c.lineToPoint(a);return c}getAntipodalPairsIterator(){p.geometryReleaseAssert(0);return new Yn(this)}getXY(a){p.geometryReleaseAssert(0);return new l.Point2D}getXYWithIndex(a){p.geometryReleaseAssert(0);return new l.Point2D}getFirst(){p.geometryReleaseAssert(0);return 0}getLast(){p.geometryReleaseAssert(0);return 0}getNext(a){p.geometryReleaseAssert(0);return 0}getPrev(a){p.geometryReleaseAssert(0);return 0}getVertexIndex(a){p.geometryReleaseAssert(0);
return 0}getPointCount(){p.geometryReleaseAssert(0);return 0}static constructOrientedMinimumBoundingBox(a,b,c,d,e){p.geometryReleaseAssert(0)}addMultiVertexGeometry(a){const b=new Y,c=a.getImpl(),d=new l.Point2D;for(let e=0;e<a.getPointCount();e++){c.queryXY(e,d);const f=this.addPoint2D(d);if(-1!==f){a.getPointByVal(e,b);const g=this.m_shape.addPoint(this.m_pathHandle,b);this.m_treeHull.setElement(f,g)}}}addEnvelope(a){const b=new Y;for(let d=0;4>d;d++){var c=new l.Point2D;a.queryCorner(d,c);c=this.addPoint2D(c);
if(-1!==c){a.queryCornerByVal(d,b);const e=this.m_shape.addPoint(this.m_pathHandle,b);this.m_treeHull.setElement(c,e)}}}addSegment(a){const b=new Y;var c=a.getStartXY();c=this.addPoint2D(c);if(-1!==c){a.queryStart(b);const d=this.m_shape.addPoint(this.m_pathHandle,b);this.m_treeHull.setElement(c,d)}c=a.getEndXY();c=this.addPoint2D(c);-1!==c&&(a.queryEnd(b),a=this.m_shape.addPoint(this.m_pathHandle,b),this.m_treeHull.setElement(c,a))}addPoint(a){var b=a.getXY();b=this.addPoint2D(b);-1!==b&&(a=this.m_shape.addPoint(this.m_pathHandle,
a),this.m_treeHull.setElement(b,a))}addPoint2D(a){let b=-1;if(0===this.m_treeHull.size())return b=this.m_treeHull.addElement(-4);if(1===this.m_treeHull.size()){var c=this.m_treeHull.getElement(this.m_treeHull.getFirst());c=this.m_shape.getXY(c);a.equals(c)||(b=this.m_treeHull.addBiggestElement(-5));return b}return b=this.treeHull(a)}treeHull(a){let b=-1;{const h=this.m_treeHull.getFirst();var c=this.m_treeHull.getLast(),d=this.m_treeHull.getElement(h),e=this.m_treeHull.getElement(c);d=this.m_getXY(d);
e=this.m_getXY(e);var f=l.Point2D.orientationRobust(e,a,d);if(0>f)b=this.m_treeHull.addBiggestElement(-1),c=this.treeHullWalkBackward(a,c,h),c!==h&&this.treeHullWalkForward(a,h,this.m_treeHull.getPrev(c));else if(0<f){e=this.m_treeHull.getRoot();var g=this.m_treeHull.getFirst();let k=this.m_treeHull.getLast(),m=f=-1,n=-1;for(;g!==this.m_treeHull.getPrev(k);)m=this.m_treeHull.getElement(e),f=this.m_getXY(m),0<l.Point2D.orientationRobust(f,a,d)?(k=e,e=this.m_treeHull.getLeft(e)):(g=e,e=this.m_treeHull.getRight(e));
e=k;f=g;m=this.m_treeHull.getElement(e);n=this.m_treeHull.getElement(f);d=this.m_getXY(m);g=this.m_getXY(n);if(f===h||0>l.Point2D.orientationRobust(g,a,d))b=this.m_treeHull.addElementAtPosition(f,e,-2,!0,!1),this.treeHullWalkForward(a,e,c),this.treeHullWalkBackward(a,f,h)}else f=-1,f=e.y===d.y?0:e.x===d.x?1:Math.abs(e.x-d.x)>=Math.abs(e.y-d.y)?0:1,g=-1,d=g=e[f]<d[f]?a[f]<e[f]?-1:d[f]<a[f]?1:0:e[f]<a[f]?-1:a[f]<d[f]?1:0,-1===d?(d=this.m_treeHull.getPrev(c),this.m_treeHull.deleteNode(c),b=this.m_treeHull.addBiggestElement(-3),
this.treeHullWalkBackward(a,d,h)):1===d&&(d=this.m_treeHull.getNext(h),this.m_treeHull.deleteNode(h),b=this.m_treeHull.addElementAtPosition(-1,d,-3,!0,!1),this.treeHullWalkForward(a,d,c))}return b}treeHullWalkForward(a,b,c){if(b===c)return c;var d=this.m_treeHull.getElement(b);let e=this.m_treeHull.getNext(b);const f=this.m_getXY(d);for(;b!==c&&2<this.m_treeHull.size();){d=this.m_treeHull.getElement(e);const g=this.m_getXY(d);if(0>l.Point2D.orientationRobust(g,a,f))break;const h=b;b=e;f.assign(g);
e=this.m_treeHull.getNext(b);this.m_deleteNode(h)}return b}treeHullWalkBackward(a,b,c){if(b===c)return c;var d=this.m_treeHull.getElement(b);let e=this.m_treeHull.getPrev(b);const f=this.m_getXY(d);for(;b!==c&&2<this.m_treeHull.size();){d=this.m_treeHull.getElement(e);const g=this.m_getXY(d);if(0>l.Point2D.orientationRobust(f,a,g))break;const h=b;b=e;f.assign(g);e=this.m_treeHull.getPrev(b);this.m_deleteNode(h)}return b}}class Z extends un{constructor(a){a?super(a):super({XStart:0,YStart:0,XEnd:0,
YEnd:0})}assignMove(a){this!==a&&(this.m_description=a.m_description,a.m_description=null,this.m_attributes=a.m_attributes,a.m_attributes=null,this.m_XStart=a.m_XStart,a.m_XStart=Number.NaN,this.m_YStart=a.m_YStart,this.m_XEnd=a.m_XEnd,a.m_XEnd=Number.NaN,this.m_YEnd=a.m_YEnd);return this}assignCopy(a){this!==a&&a.copyTo(this);return this}calculateLowerLength3D(){p.geometryReleaseAssert(0);return 0}calculateUpperLength3D(){p.geometryReleaseAssert(0);return 0}changeEndPoints3D(a,b){p.geometryReleaseAssert(0)}getClosestCoordinate3D(a,
b,c){p.geometryReleaseAssert(0);return 0}getBoundary(){return Qb(this)}transformAttribute(a,b,c,d,e){p.geometryReleaseAssert(0)}getAttributeAsDbl(a,b,c){if(0===b)return 0===c?l.lerp(this.m_XStart,this.m_XEnd,a):l.lerp(this.m_YStart,this.m_YEnd,a);const d=K.getInterpolation(b),e=this.getStartAttributeAsDbl(b,c);c=this.getEndAttributeAsDbl(b,c);return l.interpolate(d,e,c,a,K.getDefaultValue(b))}constructFromCoords(a,b,c,d){this.dropAllAttributes();this.setStartXYCoords(a,b);this.setEndXYCoords(c,d)}construct(a,
b){this.dropAllAttributes();this.setStartXY(a);this.setEndXY(b)}construct3D(a,b){p.geometryReleaseAssert(0)}constructFromPoints(a,b){p.geometryReleaseAssert(0)}getGeometryType(){return Z.type}queryEnvelope(a){if(a instanceof Ya){a.setEmpty();a.assignVertexDescription(this.m_description);var b=D.constructEmpty();this.queryEnvelope(b);a.setEnvelope(b);for(let c=1,d=this.m_description.getAttributeCount();c<d;c++){b=this.m_description.getSemantics(c);for(let e=0,f=K.getComponentCount(b);c<f;c++){const g=
this.queryInterval(b,e);a.setIntervalEnvelope(b,e,g)}}}else a instanceof D?a.setCoords({xmin:this.m_XStart,ymin:this.m_YStart,xmax:this.m_XEnd,ymax:this.m_YEnd}):a instanceof ub?(a.setEmpty(),a.mergeCoords(this.m_XStart,this.m_YStart,Xb(this,0,1,0)),a.mergeCoords(this.m_XEnd,this.m_YEnd,Xb(this,1,1,0))):p.geometryReleaseAssert(0)}applyTransformation(a){p.geometryReleaseAssert(a instanceof l.Transformation2D);const b=new l.Point2D;b.x=this.m_XStart;b.y=this.m_YStart;a.transformInPlace(b);this.m_XStart=
b.x;this.m_YStart=b.y;b.x=this.m_XEnd;b.y=this.m_YEnd;a.transformInPlace(b);this.m_XEnd=b.x;this.m_YEnd=b.y}createInstance(){p.geometryReleaseAssert(0);return this}calculateLength2D(){return Math.sqrt(Vf(this))}calculateLength3D(a){p.geometryReleaseAssert(0);return 0}changeEndPoints2D(a,b){this.setStartXY(a);this.setEndXY(b);this.normalizeAfterEndpointChange()}queryCoord2D(a,b){return sb(this,a,b)}queryCoord3D(a,b){p.geometryReleaseAssert(0)}getCoordZ(a){p.geometryReleaseAssert(0);return 0}queryCoord2DE(a,
b){Wh(this,a,b)}getCoordX(a){p.geometryReleaseAssert(0);return 0}getCoordY(a){p.geometryReleaseAssert(0);return 0}cut(a,b,c){const d=new W;this.queryCut(a,b,d,c);return d.releaseSegment()}queryCut(a,b,c,d){c=c.createLine();d&&c.assignVertexDescription(this.m_description);var e=l.Point2D.getNAN();sb(this,a,e);c.setStartXYCoords(e.x,e.y);sb(this,b,e);c.setEndXYCoords(e.x,e.y);if(!d)for(let g=1,h=this.m_description.getAttributeCount();g<h;g++){d=this.m_description.getSemantics(g);e=K.getComponentCount(d);
for(let k=0;k<e;k++){var f=this.getAttributeAsDbl(a,d,k);c.setStartAttribute(d,k,f);f=this.getAttributeAsDbl(b,d,k);c.setEndAttribute(d,k,f)}}}queryDerivative(a,b){a=S.constructPoint2D(this.getStartXY());const c=S.constructPoint2D(this.getEndXY());b.setCoordsE(c.x.subE(a.x),c.y.subE(a.y))}getClosestCoordinate(a,b){return l.Point2D.getClosestCoordinate(this.getStartXY(),this.getEndXY(),a,b)}getClosestCoordinateOnInterval(a,b,c){c=new l.Point2D;this.queryCoord2D(b.vmin,c);const d=new l.Point2D;this.queryCoord2D(b.vmax,
d);a=l.Point2D.getClosestCoordinate(c,d,a,!1);return ve.recalculateParentT(b.vmin,b.vmax,a)}intersectionOfYMonotonicWithAxisX(a,b){const c=this.m_YEnd-this.m_YStart;if(!c)return a===this.m_YEnd?b:Number.NaN;a=(a-this.m_YStart)/c;b=l.lerp(this.m_XStart,this.m_XEnd,a);1===a&&(b=this.m_XEnd);return b}isCurve(){return!1}isMonotoneQuickAndDirty(){return!0}isDegenerate(a){const b=this.m_XStart-this.m_XEnd,c=this.m_YStart-this.m_YEnd;return Math.sqrt(b*b+c*c)<=a}isDegenerate3D(a,b){p.geometryReleaseAssert(0);
return!1}queryLooseEnvelope(a){this.queryEnvelope(a)}clone(a){a=new Z;this.copyTo(a);return a}tToLength(a){return a*this.calculateLength2D()}lengthToT(a){const b=this.calculateLength2D();return 0!==b?a/b:0}calculateWeightedAreaCentroid2D(a){p.geometryReleaseAssert(0);return new l.Point2D(0,0)}calculateWeightedCentroid2D(){return this.getCoord2D(.5).mul(this.calculateLength2D())}queryAttributeAsDbl(a,b,c,d){p.geometryReleaseAssert(0)}getTangent(a){a=l.Point2D.getNAN();a.setSub(this.getEndXY(),this.getStartXY());
return a}getDerivative(a){p.geometryReleaseAssert(0);return new l.Point2D(0,0)}getCurvature(a){return 0}isIntersectingPoint(a,b,c){return 0<=gd(this,a,b,c)}isIntersectingPoint3D(a,b,c,d,e){p.geometryReleaseAssert(0);return!1}getYMonotonicParts(a,b){p.geometryReleaseAssert(0);return 0}getMonotonicParts(a,b){return 0}getMonotonicPartParams(a,b){p.geometryReleaseAssert(0);return 0}intersectionWithAxis2D(a,b,c,d){if(a){a=this.m_YEnd-this.m_YStart;if(!a)return b===this.m_YEnd?-1:0;b=(b-this.m_YStart)/
a;if(0>b||1<b)return 0;c&&(c[0]=l.lerp(this.m_XStart,this.m_XEnd,b));d&&(d[0]=b)}else{a=this.m_XEnd-this.m_XStart;if(!a)return b===this.m_XEnd?-1:0;b=(b-this.m_XStart)/a;if(0>b||1<b)return 0;c&&(c[0]=l.lerp(this.m_YStart,this.m_YEnd,b));d&&(d[0]=b)}return 1}calculateUpperLength2D(){return this.calculateLength2D()}calculateLowerLength2D(){return this.calculateLength2D()}normalizeAfterEndpointChange(){return!1}queryLooseEnvelopeOnInterval(a,b){if(b instanceof D){let c=l.snap(a.vmin,0,1);const d=new l.Point2D;
this.queryCoord2D(c,d);b.setCoords({pt:d});c=l.snap(a.vmax,0,1);this.queryCoord2D(c,d);b.mergeNe(d)}else p.geometryReleaseAssert(0)}orientBottomUp(){Xh(this)}isLine(){return!0}isDegenerateToLineHelper(a){p.geometryReleaseAssert(0);return!1}copyIgnoreAttributes(a){p.geometryReleaseAssert(0)}calculateArea2DHelper(){p.geometryReleaseAssert(0);return 0}absNorm(){return this.getStartXY().norm(1)+this.getEndXY().norm(1)}queryEnvelopeW(a,b){b.setCoords(this.getCoord2D(a.vmin));b.mergeNe(this.getCoord2D(a.vmax))}setSegmentFromCoords(a,
b){p.geometryReleaseAssert(0)}writeInBufferStream(a,b){p.geometryReleaseAssert(0);return 0}readFromBufferStream(a,b){p.geometryReleaseAssert(0)}snapControlPoints(a){return!1}needsSnapControlPoints(a){return!1}calculateSpecialPointsForCracking(a,b){p.geometryReleaseAssert(0);return 0}ensureXYMonotone(){return!1}setCoordsForIntersector(a,b,c){this.m_XStart=a.x;this.m_YStart=a.y;this.m_XEnd=b.x;this.m_YEnd=b.y;this.afterCompletedModification()}static isIntersectingLineLine(a,b,c,d){p.geometryReleaseAssert(0);
return 0}static isIntersectingLineLine_(a,b,c,d){p.geometryReleaseAssert(0);return 0}copyToImpl(a){}reverseImpl(){}equalsImpl(a){return!0}equalsImplTol(a,b){return!0}getHashCodeImpl(){p.geometryReleaseAssert(0);return 0}swapImpl(a){p.geometryReleaseAssert(0)}afterCompletedModification(){}endPointModified(){}clearEndPointModified(){}intersect(a,b,c,d,e){return Zc(!1,this,a,b,c,d,e)}intersectPoint(a,b,c){1>b.length&&p.throwOutOfRangeException("");a=gd(this,a,c,!1);return 0<=a?(b&&(b[0]=a),1):0}isIntersecting(a,
b,c){return 0!==Hc(!1,!1,this,a,b,c)}intersect_(a,b,c,d){p.geometryReleaseAssert(0);return 0}}Z.type=p.GeometryType.enumLine;class W{constructor(a){this.m_curves=this.m_seg=null;this.m_lineBuffer=new Z;this.m_active=this.m_mask=0;void 0!==a&&(a.copy?a.copy.copyTo(this,!1):a.move?this.assignMove(a.move):a.segment?this.copyFrom(a.segment,!!a.bIgnoreAttributes):p.geometryReleaseAssert(0))}assignCopy(a){a instanceof W?this!==a&&a.copyTo(this,!1):this.copyFrom(a,!1);return this}assignMove(a){if(a instanceof
W){if(this===a)return this;this.reset();a.m_mask&1&&(this.m_lineBuffer=a.m_lineBuffer,a.m_lineBuffer=null,this.m_mask=1);this.m_curves=a.m_curves;this.m_mask=a.m_mask;this.m_active=a.m_active;a.reset();this.m_seg=this.activeSegment();a.m_seg=null}else{if(this.m_seg===a)return this;this.create(a.getGeometryType());this.m_seg.swap(a)}return this}activeSegment(){switch(this.m_active){case 0:return null;case 1:return this.line();case 2:return this.arc();case 4:return this.bezier3();case 8:return this.bezier2();
case 16:return this.rbezier2();default:p.throwInternalErrorException("")}}get(){return this.m_seg}reset(){this.m_mask&1&&(this.m_lineBuffer=null);1<this.m_mask&&(this.m_curves=null);this.m_active=this.m_mask=0}empty(){return null===this.m_seg}copyTo(a,b){this!==a&&(this.empty()?a.m_seg=null:a.copyFrom(this.m_seg,b))}copyToWithZ(a,b){p.geometryReleaseAssert(0)}createImpl(a){switch(a){case p.GeometryType.enumLine:0===(this.m_mask&1)&&(this.m_lineBuffer=new Z,this.m_mask|=1,this.m_active=1);break;case p.GeometryType.enumEllipticArc:0===
(this.m_mask&2)&&(this.m_curves=new Hb,this.m_mask=this.m_mask&1|2,this.m_active=2);break;case p.GeometryType.enumBezier:0===(this.m_mask&4)&&(this.m_curves=new Gb,this.m_mask=this.m_mask&1|4,this.m_active=4);break;case p.GeometryType.enumBezier2:0===(this.m_mask&8)&&(this.m_curves=new rc,this.m_mask=this.m_mask&1|8,this.m_active=8);break;case p.GeometryType.enumRationalBezier2:0===(this.m_mask&16)&&(this.m_curves=new lb,this.m_mask=this.m_mask&1|16,this.m_active=16);break;default:p.throwInvalidArgumentException("")}}create(a){a===
p.GeometryType.enumLine?this.createLine():a===p.GeometryType.enumEllipticArc?this.createEllipticArc():a===p.GeometryType.enumBezier?this.createCubicBezier():a===p.GeometryType.enumRationalBezier2?this.createQuadraticRationalBezier():a===p.GeometryType.enumBezier2?this.createQuadraticBezier():p.throwInvalidArgumentException("Segment_buffer.create")}copyFrom(a,b){this.m_seg!==a&&(this.create(a.getGeometryType()),b?a.copyIgnoreAttributes(this.m_seg):a.copyTo(this.m_seg))}copyFromWithZ(a,b){p.geometryReleaseAssert(0)}line(){return this.m_lineBuffer}arc(){return this.m_curves}bezier3(){return this.m_curves}bezier2(){return this.m_curves}rbezier2(){return this.m_curves}createLine(){this.createImpl(p.GeometryType.enumLine);
this.m_seg=this.line();return this.line()}createEllipticArc(){this.createImpl(p.GeometryType.enumEllipticArc);this.m_seg=this.arc();return this.arc()}createCubicBezier(){this.createImpl(p.GeometryType.enumBezier);this.m_seg=this.bezier3();return this.bezier3()}createQuadraticRationalBezier(){this.createImpl(p.GeometryType.enumRationalBezier2);this.m_seg=this.rbezier2();return this.rbezier2()}createQuadraticBezier(){this.createImpl(p.GeometryType.enumBezier2);this.m_seg=this.bezier2();return this.bezier2()}releaseSegment(){this.m_seg=
null;0===this.m_active&&p.throwInternalErrorException("releaseSegment");if(this.m_active&1){var a=this.line();--this.m_mask;this.m_active=0;this.m_lineBuffer=null;return a}this.m_active&2?a=this.arc():this.m_active&4?a=this.bezier3():this.m_active&8?a=this.bezier2():this.m_active&16?a=this.rbezier2():p.throwInternalErrorException("releaseSegment");this.m_mask-=this.m_active;this.m_active=0;this.m_curves=null;return a}equals(a){if(a instanceof W)return this===a?!0:this.empty()?a.empty():a.empty()?
!1:this.get().equals(a.get());p.geometryReleaseAssert(0);return!1}}const Zn="0123456789bcdefghjkmnpqrstuvwxyz".split("");let Nf=new Set;var $n;(function(a){a[a.utmDefault=0]="utmDefault";a[a.utmNorthSouth=1]="utmNorthSouth"})($n||={});let xh,ao=0;class Sb{destroy(){var a=this.m_peCoordSysVal;qe.delete(a.m_peCoordSys.getName());nh.delete(ch(a.m_peCoordSys,0,!1));1===this.getCoordinateSystemType()?this.getPECoordSys().destroy():2===this.getCoordinateSystemType()?this.getPECoordSys().destroy():p.throwInternalErrorException("SpatialReference.destroy")}constructor(){this.m_peCoordSysVal=
this.m_vertcs=null;this.m_userWKID=0;this.m_defaultPrecisionSR=this.m_gcsToSr=this.m_srToGcs=this.m_geogSpatialReference=this.m_userWKT=null;this.m_localZToXYFactor=-1;this.m_precisionDescriptor=new zb;this.m_hashCode=0;this.m_bDefaultDescriptor=!1;yh(this.m_precisionDescriptor);Nf&&Nf.add(new WeakRef(this))}attachToPe(){(0<this.m_userWKID?uh(this.m_userWKID):ml(this.m_userWKT)).copyTo(this,!1)}copyTo(a,b=!0){if(b||a.m_bDefaultDescriptor)a.m_bDefaultDescriptor=this.m_bDefaultDescriptor,a.m_precisionDescriptor.assign(this.m_precisionDescriptor);
a.m_defaultPrecisionSR=null;a.m_gcsToSr=this.m_gcsToSr;a.m_geogSpatialReference=this.m_geogSpatialReference;a.m_hashCode=this.m_hashCode;a.m_localZToXYFactor=this.m_localZToXYFactor;a.m_peCoordSysVal=this.m_peCoordSysVal;a.m_srToGcs=this.m_srToGcs;a.m_userWKID=this.m_userWKID;a.m_userWKT=this.m_userWKT;a.m_vertcs=this.m_vertcs;a.m_unit=this.m_unit}getHashCode(){return this.m_hashCode}getHashCodeHorizontal(){let a=0;return a=this.m_peCoordSysVal?this.m_peCoordSysVal.getHashCode():this.m_unit?this.m_unit.getHashCode():
305419891}updateTransform(a){if(1===this.getCoordinateSystemType())return uf(this,this,null);var b=a?this.m_srToGcs:this.m_gcsToSr;if(b)return b;b=this.getGCS();const c=b=a?uf(this,b,null):uf(b,this,null),d=a?this.m_srToGcs:this.m_gcsToSr;if(d)return d;a?this.m_srToGcs=c:this.m_gcsToSr=c;return b}getHashCodeVertical(){return this.m_vertcs?this.m_vertcs.getHashCode():0}calculateHashCode(){let a=this.getHashCodeHorizontal();const b=this.getHashCodeVertical(),c=this.m_precisionDescriptor.getHashCode();
a=l.hashCombine(a,b);this.m_hashCode=l.hashCombine(a,c)}initDbgName(){}setHorzProj_(a){this.m_peCoordSysVal=a;this.m_unit=this.m_peCoordSysVal.getUnit()}getTolerance(a=0){return this.m_precisionDescriptor.getTolerance(a)}getResolution(a=0){return this.m_precisionDescriptor.getResolution(a)}getPECoordSys(){return this.m_peCoordSysVal?this.m_peCoordSysVal.m_peCoordSys:null}getPCSInfo(){this.throwIfNotGCSOrPCS();p.geometryReleaseAssert(this.m_peCoordSysVal);return this.m_peCoordSysVal.getPCSInfo()}getCentralMeridian(){this.throwIfNotGCSOrPCS();
return 1===this.getCoordinateSystemType()?0:this.getPCSInfo().getCentralMeridian()}getCoordinateSystemType(){const a=this.getPECoordSys();if(a)switch(a.getType()){case F.peDefs.PE_TYPE_GEOGCS:return 1;case F.peDefs.PE_TYPE_PROJCS:return 2}else{if((0<this.m_userWKID||this.m_userWKT)&&this.m_unit instanceof ad)return 2;if(this.m_unit instanceof te)return 1}return 0}getID(){return this.m_userWKID}getLatestID(){return this.m_peCoordSysVal?this.m_peCoordSysVal.getLatestID():this.m_userWKID}getOldID(){return this.m_peCoordSysVal?
this.m_peCoordSysVal.getOldID():this.m_userWKID}getVerticalID(){p.throwNotImplementedException("vcs not implemented");return 0}getLatestVerticalID(){return this.m_vertcs?this.m_vertcs.getLatestID():0}getOldVerticalID(){p.throwNotImplementedException("vcs not implemented");return 0}getPEVerticalCoordSys(){return null}getPole(a){this.throwIfNotGCSOrPCS();p.geometryReleaseAssert(this.m_peCoordSysVal);return this.m_peCoordSysVal.getPole(a)}getText(){const a=this.getPECoordSys();return a?Gk(a):this.m_userWKT??
""}getTextExtended(a){const b=this.getPECoordSys();return b?this.getPEVerticalCoordSys()?(this.getPEVerticalCoordSys(),p.geometryReleaseAssert(0),""):Gk(b,a):this.m_userWKT??""}getText2(a=-1){const b=this.getPECoordSys();if(!b)return this.m_userWKT??"";(1<a||-1>a)&&p.throwInvalidArgumentException("verbosity");let c=F.peDefs.PE_STR_FMT_WKT2;-1!==a&&(c|=0===a?F.peDefs.PE_STR_AUTH_TOP:F.peDefs.PE_STR_AUTH_ALL);return b.toString(c)}getUnit(){return this.m_unit}getUnitsPerMillimeter(){if(this.m_peCoordSysVal)return this.m_peCoordSysVal.getUnitsPerMillimeter();
if(this.m_unit instanceof ad)return.001/this.m_unit.getUnitToBaseFactor();if(this.m_unit instanceof te)return.001/(vh(this.m_userWKT??this.m_userWKID).semiMajor*this.m_unit.getUnitToBaseFactor());p.throwInvalidCallException("sr object not in valid state");return 0}getAuthorityName(){return""}getVerticalUnit(){p.throwNotImplementedException("vcs not implemented");return{}}getVCS(){return this.m_vertcs}hasVCS(){return!1}getGCSHorisonIsInclusive(){this.throwIfNotGCSOrPCS();p.geometryReleaseAssert(this.m_peCoordSysVal);
return this.m_peCoordSysVal.getGCSHorisonIsInclusive()}getGCSHorizon(){this.throwIfNotGCSOrPCS();p.geometryReleaseAssert(this.m_peCoordSysVal);return this.m_peCoordSysVal.getGCSHorizon()}getGCS(){var a=this.getCoordinateSystemType();if(0===a)p.throwInvalidCallException("operation is not supported for unknown coordinate systems");else{if(1===a)return this;3===a&&p.throwInvalidCallException("image cs not supported")}if(this.m_geogSpatialReference)return this.m_geogSpatialReference;this===ol()||this===
ql()?a=sl():(p.geometryReleaseAssert(this.m_peCoordSysVal),(a=this.m_peCoordSysVal.m_peCoordSys.getGeogcs())||p.throwInternalErrorException(""),a=nl(a,this.m_vertcs,null,this.m_precisionDescriptor.getPrecision(),this.m_peCoordSysVal.getCached()));this.m_geogSpatialReference?a=this.m_geogSpatialReference:this.m_geogSpatialReference=a;return a}getGCSSplitLines(){this.throwIfNotGCSOrPCS();p.geometryReleaseAssert(this.m_peCoordSysVal);return this.m_peCoordSysVal.getGCSSplitLines()}toGCS(a,b){if(0===a.length)return 0;
a.length>b.length&&p.throwInvalidArgumentException("coordsSrc.size() \x3e coordsDst.size()");var c=this.getCoordinateSystemType();0===c&&p.throwInvalidCallException("operation is not supported for unknown coordinate systems");if(1===c)return l.assignObjectArray(b,a,a.length),a.length;p.geometryReleaseAssert(this.m_peCoordSysVal);c=this.getSRToGCSTransform();return(new xc).transform(c,a,a.length,b)}toMilitaryGrid(a,b,c,d,e){p.geometryReleaseAssert(0);return[]}fromMilitaryGrid(a,b){return[]}toUnitedStatesNationalGrid(a,
b,c,d){return[]}fromUnitedStatesNationalGrid(a){return[]}toUniversalTransverseMercator(a,b,c){return[]}fromUniversalTransverseMercator(a,b){return[]}toWorldGeographicReference(a,b,c){return[]}fromWorldGeographicReference(a){return[]}toGlobalArea(a){return[]}fromGlobalArea(a,b){return[]}toDegreeMinuteSecond(a,b){return[]}fromDegreeMinuteSecond(a){return[]}toDegreeDecimalMinute(a,b){return[]}fromDegreeDecimalMinute(a){return[]}toDecimalDegree(a,b){return[]}fromDecimalDegree(a){return[]}fromGeohashToGCSEnvelope(a){return{}}toGeohash(a,
b=8){var c=a.clone();c.scale(9102===this.getGCS().getUnit().getID()?1:this.getGCS().getUnit().getUnitToBaseFactor()/Math.PI*180);-180>c.x?(c.x=l.fmod(c.x,360),-180>c.x&&(c.x+=360)):180<c.x&&(c.x=l.fmod(c.x,360),180<c.x&&(c.x-=360));90<c.y&&(c.y=90);-90>c.y&&(c.y=-90);var d=5*b;a=new Uint32Array(4);ll(c.x,-180,180,d-1,a);ll(c.y,-90,90,d-2,a);c=l.makePrimitiveArray(b,"R");let e=d=0;for(let f=0;f<b;f++){let g=a[d]>>e&31;e+=5;if(31<e){const h=37-e;g&=(1<<h)-1;e-=32;d++;g|=(a[d]&(1<<e)-1)<<h}c[b-1-f]=
Zn[g]}return c.join("")}calculateContainingGeohash(a){return"1;"}calculateCoveringGeohashes(a,b){return[]}calculateGeohashNeighbours(a){return[]}calculateGeohashNeighbour(a,b,c){return""}isPannable(){const a=this.getCoordinateSystemType();if(0===a||3===a)return!1;p.geometryReleaseAssert(this.m_peCoordSysVal);return this.m_peCoordSysVal.isPannable()}getPannableExtent(){this.isPannable()||p.throwInvalidArgumentException("!is_pannable");p.geometryReleaseAssert(this.m_peCoordSysVal);return this.m_peCoordSysVal.getPannableExtent()}getPannableExtentInGCS(){this.isPannable()||
p.throwInvalidArgumentException("!is_pannable");p.geometryReleaseAssert(this.m_peCoordSysVal);return this.m_peCoordSysVal.getPannableExtentGCS()}throwIfNotGCSOrPCS(){const a=this.getCoordinateSystemType();1!==a&&2!==a&&p.throwInvalidArgumentException("Not a GCS or PCS")}getDomainXY(){this.throwIfNotGCSOrPCS();p.geometryReleaseAssert(this.m_peCoordSysVal);return this.m_peCoordSysVal.getDomainXY()}getFullWorldExtent(){this.throwIfNotGCSOrPCS();return this.isPannable()?this.getPannableExtent():this.getDomainXY()}queryPrecisionDescriptor(a){a.assign(this.m_precisionDescriptor);
if(Number.isNaN(a.m_falseX))if(oe()||p.throwInvalidCallException("projection engine is not loaded"),p.geometryReleaseAssert(null!==this.m_peCoordSysVal),2!==this.m_precisionDescriptor.m_precision){const b=this.m_peCoordSysVal.getDomainXY();a.m_falseX=b.xmin;a.m_falseY=b.ymin}else a.m_falseX=-Number.MAX_VALUE,a.m_falseY=-Number.MAX_VALUE}queryPrecisionDescriptorWithoutFalseXY(a){a.assign(this.m_precisionDescriptor);a.m_falseX=Number.NaN;a.m_falseY=Number.NaN}queryDefaultPrecisionDescriptorWithoutFalseXY(a){if(this.m_bDefaultDescriptor)a.assign(this.m_precisionDescriptor);
else{const b=this.getCoordinateSystemType();0===b?vl(a,this.m_unit,this.m_vertcs,this.m_precisionDescriptor.getPrecision()):3===b?p.throwNotImplementedException("image cs"):Df(a,this.m_peCoordSysVal,this.m_vertcs,this.m_precisionDescriptor.getPrecision())}a.m_falseX=Number.NaN;a.m_falseY=Number.NaN}horizontalEqual(a){var b=this.m_peCoordSysVal;a=a.m_peCoordSysVal;return b===a?!0:null===b||null===a||b.m_csType!==a.m_csType?!1:0===b.m_WKID&&0===a.m_WKID?b.m_hashCode===a.m_hashCode&&b.m_canonicalWkt===
a.m_canonicalWkt:b.m_WKID===a.m_WKID}verticalEqual(a){return null!==this.m_vertcs===(null!==a.m_vertcs)?this.m_vertcs?this.m_vertcs.equals(a.m_vertcs):!0:!1}equals(a){if(this===a)return!0;if(!this.horizontalEqual(a)||!this.verticalEqual(a)||!a.m_peCoordSysVal&&(p.geometryReleaseAssert(!this.m_peCoordSysVal),null!==this.m_unit!==(null!==a.m_unit)||this.m_unit&&!this.m_unit.equals(a.m_unit)||this.m_localZToXYFactor!==a.m_localZToXYFactor))return!1;if(!this.m_bDefaultDescriptor||!a.m_bDefaultDescriptor){if(this.m_peCoordSysVal){if(!this.m_precisionDescriptor.equalsWithoutFalseXY(a.m_precisionDescriptor))return!1;
p.geometryReleaseAssert(a.m_peCoordSysVal);let c=this.m_precisionDescriptor.m_falseX;var b=this.m_precisionDescriptor.m_falseY;Number.isNaN(c)&&(b=this.m_peCoordSysVal.getDomainXY(),c=b.xmin,b=b.ymin);let d=a.m_precisionDescriptor.m_falseX,e=a.m_precisionDescriptor.m_falseY;Number.isNaN(d)&&(a=a.m_peCoordSysVal.getDomainXY(),d=a.xmin,e=a.ymin);return c===d&&b===e}return this.m_precisionDescriptor.equals(a.m_precisionDescriptor)}return!0}equalForProjection(a,b){if(this===a)return!0;var c=this.getCoordinateSystemType(),
d=a.getCoordinateSystemType();if(0===c||0===d)return 0===c&&0===d?b&&this.getZToXYFactor()!==a.getZToXYFactor()?!1:this.getUnit()&&a.getUnit()?this.getUnit().equals(a.getUnit()):!0:3===c||3===d?!1:null===this.getUnit()||null===a.getUnit()?!0:b&&this.getZToXYFactor()!==a.getZToXYFactor()?!1:this.getUnit().equals(a.getUnit());if(c!==d)return!1;if(3===c)return this.equals(a);c=this.m_peCoordSysVal;d=a.m_peCoordSysVal;if(c===d||(null===c||null===d||c.m_csType!==d.m_csType?0:0===c.m_WKID&&0===d.m_WKID?
1===c.m_csType?c.m_peCoordSys.isEqual(d.m_peCoordSys):c.m_peCoordSys===d.m_peCoordSys:c.m_WKID===d.m_WKID)){if(!b)return!0;if(null!==this.m_vertcs===(null!==a.m_vertcs))return this.m_vertcs?this.m_vertcs.equalForProjection(a.m_vertcs):!0}return!1}equalHorizontal(a){return this.horizontalEqual(a)}equalVertical(a){return!1}equalVerticalVCS(a){return!1}convergenceAngle(a){return 0}getPeCoordsysCopy(){if(this.m_peCoordSysVal){const a=this.m_peCoordSysVal.m_peCoordSys;a||p.throwInternalErrorException("cannot clone coord sys");
return a}return null}getPeVertcsCopy(){return 0}throwIfLocal(){0===this.getCoordinateSystemType()&&p.throwInvalidArgumentException("operation is not supported for unknown coordinate systems")}getPrimeMeridian(){this.throwIfLocal();p.geometryReleaseAssert(this.m_peCoordSysVal);return this.m_peCoordSysVal.getPrimeMeridian()}getSRToGCSTransform(){return this.updateTransform(!0)}getGCSToSRTransform(){return this.updateTransform(!1)}getOneMeter(){return 1E3*this.getUnitsPerMillimeter()}getOneMeterPCSUnit(){this.throwIfNotGCSOrPCS();
p.geometryReleaseAssert(this.m_peCoordSysVal);return this.m_peCoordSysVal.getOneMeterPCSUnit()}getDefaultPrecisionSR(){if(this.m_bDefaultDescriptor)return this;if(null===this.m_defaultPrecisionSR){const a=new zb;this.queryDefaultPrecisionDescriptorWithoutFalseXY(a);this.m_defaultPrecisionSR=mn(this,a,!0)}return this.m_defaultPrecisionSR}getPCSHorizon(){this.throwIfNotGCSOrPCS();p.geometryReleaseAssert(this.m_peCoordSysVal);return this.m_peCoordSysVal.getPCSHorizon()}getHorzUnitFactor(){return this.m_unit?
this.m_unit.getUnitToBaseFactor():1}querySpheroidData(a){this.throwIfNotGCSOrPCS();p.geometryReleaseAssert(this.m_peCoordSysVal);var b=this.getGCS().getPECoordSys().getDatum().getSpheroid();const c=b.getFlattening();b=b.getAxis();a.majorSemiAxis=b;a.minorSemiAxis=b*(1-c);a.e2=c*(2-c);a.flattening=c}getAreaOfUse(){0===this.getCoordinateSystemType()&&p.throwInvalidCallException("");p.geometryReleaseAssert(this.m_peCoordSysVal);const a=this.m_peCoordSysVal.getAreaOfUse();return null===a?new Gl:new Gl({geom:a.clone(),
sr:uh(4326)})}getZToXYFactor(){return 1}isCustomWkid(){return!1}getOneDegreeGCSUnit(){this.throwIfNotGCSOrPCS();p.geometryReleaseAssert(this.m_peCoordSysVal);return this.m_peCoordSysVal.getOneDegreeGCSUnit()}getGcsUnitFactor(){this.throwIfNotGCSOrPCS();p.geometryReleaseAssert(this.m_peCoordSysVal);return this.m_peCoordSysVal.getGcsUnitFactor()}snapGeometry(a){if(a.isEmpty()||2===this.m_precisionDescriptor.getPrecision())return!1;var b=a.getGeometryType();if(p.isMultiVertex(b))return this.snapMultiVertex_(a);
if(b===p.GeometryType.enumPoint)return this.snapPoint_(a);if(b===p.GeometryType.enumEnvelope)return this.snapEnvelope_(a);if(p.isSegment(b))return this.snapSegment_(a);if(b===p.GeometryType.enumGeometryCollection){b=!1;for(let c=0,d=a.getGeometryCount();c<d;++c)b=this.snapGeometry(a.getGeometry(c))||b;return b}p.throwInternalErrorException("what else?")}snapMultiVertex_(a){p.geometryReleaseAssert(!a.isEmpty());p.geometryReleaseAssert(2!==this.m_precisionDescriptor.getPrecision());if(p.isMultiPath(a.getGeometryType())&&
a.hasNonLinearSegments())return this.snapGeometryWithCurves_(a);a=a.getImpl();const b=a.getDescription();let c=!1;for(let d=0,e=b.getAttributeCount();d<e;d++){const f=b.getSemantics(d),g=a.getAttributeStreamRef(f);c=this.snapAttributes(f,g,0,a.getPointCount())||c}c&&a.notifyModifiedFlags(2001);return c}snapPoint_(a){return!1}snapEnvelope_(a){return!1}snapSegment_(a){p.geometryReleaseAssert(!a.isEmpty());p.geometryReleaseAssert(2!==this.m_precisionDescriptor.getPrecision());const b=new zb;this.queryPrecisionDescriptor(b);
var c=a.getStartXY(),d=new l.Point2D;d.x=Gd(c.x,b.getFalseX(),b.getGridUnitsXY());d.y=Gd(c.y,b.getFalseY(),b.getGridUnitsXY());c=!d.equals(c);const e=a.getEndXY(),f=new l.Point2D;f.x=Gd(e.x,b.getFalseX(),b.getGridUnitsXY());f.y=Gd(e.y,b.getFalseY(),b.getGridUnitsXY());c||=!f.equals(e);c&&a.changeEndPoints2D(d,f);d=(g,h,k)=>{let m=!1;var n=a.getStartAttributeAsDbl(g,0),q=Gd(n,h,k);n=!l.isEqualNonIEEE(q,n);m||=n;n&&a.setStartAttribute(g,0,q);q=a.getEndAttributeAsDbl(g,0);h=Gd(q,h,k);k=!l.isEqualNonIEEE(h,
q);m||=k;k&&a.setEndAttribute(g,0,h);return m};c=c?1:0;a.hasAttribute(1)&&(c|=d(1,b.getFalseZ(),b.getGridUnitsZ())?1:0);a.hasAttribute(2)&&(c|=d(2,b.getFalseM(),b.getGridUnitsM())?1:0);return!!c}snapGeometryWithCurves_(a){p.geometryReleaseAssert(!a.isEmpty());p.geometryReleaseAssert(2!==this.m_precisionDescriptor.getPrecision());const b=a.createInstance(),c=new W;let d=0;for(let f=0,g=a.getPathCount();f<g;++f){var e=a.getSegmentCountPath(f);if(0===e){b.addPath(a,f,!0);1===b.getPathSize(f)&&(e=new Y,
b.getPointByVal(b.getPointCount()-1,e),d|=this.snapGeometry(e)?1:0,b.setPointByVal(b.getPointCount()-1,e));continue}const h=a.isClosedPath(f);for(let k=0,m=h?e-1:e;k<m;++k)a.getSegmentFromPath(f,k,c,!1),d|=this.snapGeometry(c.get())?1:0,b.addSegment(c.get(),0===k);h&&(a.getSegmentFromPath(f,e-1,c,!1),d|=this.snapGeometry(c.get())?1:0,1===e?b.addPathFromClosedSegment(c.get(),!1):b.closeLastPathWithSegment(c.get()))}d&&b.copyTo(a);return!!d}snapAttributes(a,b,c,d){let e=!1;const f=new zb;this.queryPrecisionDescriptor(f);
if(0===a)for(a=c;a<d;a++){c=b.read(2*a);var g=Sb.s_SnapValue(c,f.getFalseX(),f.getGridUnitsXY());const h=b.read(2*a+1),k=Sb.s_SnapValue(h,f.getFalseY(),f.getGridUnitsXY());if(e=e||g!==c||k!==h)b.write(2*a,g),b.write(2*a+1,k)}else if(1===a)for(a=c;a<d;a++)c=b.read(a),g=Sb.s_SnapValue(c,f.getFalseZ(),f.getGridUnitsZ()),(e=e||!l.isEqualNonIEEE(g,c))&&b.write(a,g);else if(2===a)for(a=c;a<d;a++)c=b.read(a),g=Sb.s_SnapValue(c,f.getFalseM(),f.getGridUnitsM()),(e=e||!l.isEqualNonIEEE(g,c))&&b.write(a,g);
return e}static s_SnapValue(a,b,c){return l.round((a-b)*c)/c+b}}class zb{constructor(){const a=5E-5*Number(9007199254740990n);this.m_precision=1;this.m_falseX=-a;this.m_falseY=-a;this.m_unitsXY=Number(9007199254740990n)/(2*a);this.m_falseM=-1E5;this.m_unitsM=1E4;this.m_falseZ=-1E5;this.m_unitsZ=1E4;this.m_toleranceZ=this.m_toleranceM=this.m_toleranceXY=.001}getHashCode(){let a=7777,b;b=l.hashCombine(7777,this.m_falseM);b=l.hashCombine(b,this.m_unitsM);a=l.hashCombine(a,this.m_unitsXY);b=l.hashCombine(b,
this.m_toleranceXY);a=l.hashCombine(a,this.m_falseZ);b=l.hashCombine(b,this.m_toleranceZ);a=l.hashCombine(a,this.m_unitsZ);b=l.hashCombine(b,this.m_toleranceM);a=l.hashCombine(a,this.m_precision);return l.hashCombine(a,b)}clone(){const a=new zb;a.m_falseX=this.m_falseX;a.m_falseY=this.m_falseY;a.m_unitsXY=this.m_unitsXY;a.m_falseZ=this.m_falseZ;a.m_unitsZ=this.m_unitsZ;a.m_falseM=this.m_falseM;a.m_unitsM=this.m_unitsM;a.m_toleranceXY=this.m_toleranceXY;a.m_toleranceZ=this.m_toleranceZ;a.m_toleranceM=
this.m_toleranceM;a.m_precision=this.m_precision;return a}assign(a){this.m_falseX=a.m_falseX;this.m_falseY=a.m_falseY;this.m_unitsXY=a.m_unitsXY;this.m_falseZ=a.m_falseZ;this.m_unitsZ=a.m_unitsZ;this.m_falseM=a.m_falseM;this.m_unitsM=a.m_unitsM;this.m_toleranceXY=a.m_toleranceXY;this.m_toleranceZ=a.m_toleranceZ;this.m_toleranceM=a.m_toleranceM;this.m_precision=a.m_precision;return this}initialize2D(a,b){}getTolerance(a){switch(a){case 0:return this.m_toleranceXY;case 1:return this.m_toleranceZ;case 2:return this.m_toleranceM;
default:return 0}}getResolution(a){if(2===this.m_precision)return 0;switch(a){case 0:return 1/this.m_unitsXY;case 1:return 1/this.m_unitsZ;case 2:return 1/this.m_unitsM;default:return 0}}getFalseX(){return this.m_falseX}getFalseY(){return this.m_falseY}getFalseZ(){return this.m_falseZ}getFalseM(){return this.m_falseM}getGridUnitsXY(){return this.m_unitsXY}getGridUnitsZ(){return this.m_unitsZ}getGridUnitsM(){return this.m_unitsM}getPrecision(){return this.m_precision}static getLimit32(){return 2147483645}static getLimit64(){return 9007199254740990n}static getLimitFloat(){return 0}getXYGridRange(){const a=
new D;switch(this.m_precision){case 0:var b=zb.getLimit32()/this.getGridUnitsXY();a.setCoords({xmin:this.getFalseX(),ymin:this.getFalseY(),xmax:this.getFalseX()+b,ymax:this.getFalseY()+b});break;case 1:b=Number(zb.getLimit64())/this.getGridUnitsXY();a.setCoords({xmin:this.getFalseX(),ymin:this.getFalseY(),xmax:this.getFalseX()+b,ymax:this.getFalseY()+b});break;case 2:a.setCoords({xmin:-Number.MAX_VALUE,ymin:-Number.MAX_VALUE,xmax:Number.MAX_VALUE,ymax:Number.MAX_VALUE});break;default:a.setEmpty(),
p.throwInternalErrorException("")}return a}getZGridRange(){const a=new l.Envelope1D;switch(this.m_precision){case 0:var b=zb.getLimit32()/this.getGridUnitsZ();a.setCoords(this.getFalseZ(),this.getFalseZ()+b);break;case 1:b=Number(zb.getLimit64())/this.getGridUnitsZ();a.setCoords(this.getFalseZ(),this.getFalseZ()+b);break;case 2:a.setCoords(-Number.MAX_VALUE,Number.MAX_VALUE);break;default:a.setEmpty(),p.throwInternalErrorException("")}return a}getMGridRange(){const a=new l.Envelope1D;switch(this.m_precision){case 0:var b=
zb.getLimit32()/this.getGridUnitsM();a.setCoords(this.getFalseM(),this.getFalseM()+b);break;case 1:b=Number(zb.getLimit64())/this.getGridUnitsM();a.setCoords(this.getFalseM(),this.getFalseM()+b);break;case 2:a.setCoords(-Number.MAX_VALUE,Number.MAX_VALUE);break;default:a.setEmpty(),p.throwInternalErrorException("")}return a}setTolerance(a,b){0>b&&p.throwInvalidArgumentException("tol \x3c 0");Number.isFinite(b)||p.throwInvalidArgumentException("tol is not finite");switch(a){case 0:this.m_toleranceXY=
b;break;case 1:this.m_toleranceZ=b;break;case 2:this.m_toleranceM=b;break;default:p.throwInvalidArgumentException("cannot set tolerance for this attribute")}}setGridParams(a,b,c){Number.isFinite(a)&&Number.isFinite(b)&&Number.isFinite(c)||p.throwInvalidArgumentException("grid params are not finite");1>c&&p.throwInvalidArgumentException("grid units cannot be smaller than 1.0");this.m_falseX=a;this.m_falseY=b;this.m_unitsXY=c}setZParams(a,b){Number.isFinite(a)&&Number.isFinite(b)||p.throwInvalidArgumentException("grid params are not finite");
1>b&&p.throwInvalidArgumentException("grid units cannot be smaller than 1.0");this.m_falseZ=a;this.m_unitsZ=b}setMParams(a,b){Number.isFinite(a)&&Number.isFinite(b)||p.throwInvalidArgumentException("grid params are not finite");1>b&&p.throwInvalidArgumentException("grid units cannot be smaller than 1.0");this.m_falseM=a;this.m_unitsM=b}setPrecision(a){}equals(a){return this===a?!0:l.isEqualNonIEEE(this.m_falseX,a.m_falseX)&&l.isEqualNonIEEE(this.m_falseY,a.m_falseY)&&this.equalsWithoutFalseXY(a)}snapPrecision(){if(2!==
this.m_precision){var a=(c,d,e,f)=>{if(!Number.isFinite(d)||!Number.isFinite(e))return e;if(1>e)return 1;if(!f)return e;f=Number(c)/e;Math.trunc((d+f-d)*e)>c&&(e=c/(d+f-d));return Math.max(1,e)},b=Number(0===this.m_precision?2147483645n:9007199254740990n);this.m_unitsXY=a(b,this.m_falseX,this.m_unitsXY,!0);this.m_unitsXY=a(b,this.m_falseY,this.m_unitsXY,!0);this.m_unitsZ=a(b,this.m_falseZ,this.m_unitsZ,!1);this.m_unitsM=a(b,this.m_falseM,this.m_unitsM,!1)}}verifyPrecision(){if(2===this.m_precision)return!0;
const a=(c,d,e,f)=>1>e||!Number.isFinite(d)||!Number.isFinite(e)?!1:f?BigInt((d+Number(c)/e-d)*e)>c?!1:!0:!0,b=0===this.m_precision?2147483645n:9007199254740990n;return a(b,this.m_falseX,this.m_unitsXY,!0)&&a(b,this.m_falseY,this.m_unitsXY,!0)&&a(b,this.m_falseZ,this.m_unitsZ,!1)&&a(b,this.m_falseM,this.m_unitsM,!1)?!0:!1}fixTolerance(){2!==this.m_precision&&(this.m_toleranceXY=Math.max(2/this.m_unitsXY,this.m_toleranceXY),this.m_toleranceZ=Math.max(2/this.m_unitsZ,this.m_toleranceZ),this.m_toleranceM=
Math.max(2/this.m_unitsM,this.m_toleranceM),Number.isNaN(this.m_falseX)||Number.isNaN(this.m_falseY))&&(this.m_falseX=this.m_falseY=Number.NaN)}equalsWithoutFalseXY(a){return this===a?!0:this.m_unitsXY===a.m_unitsXY&&this.m_falseZ===a.m_falseZ&&this.m_unitsZ===a.m_unitsZ&&this.m_falseM===a.m_falseM&&this.m_unitsM===a.m_unitsM&&this.m_toleranceXY===a.m_toleranceXY&&this.m_toleranceZ===a.m_toleranceZ&&this.m_toleranceM===a.m_toleranceM&&this.m_precision===a.m_precision}setBestXyDomainFromEnvelope(a,
b){}setBestZDomainFromZRange(a,b,c){}setBestMDomainFromMRange(a,b,c){}}let pl,rl,tl,Hd=null;F.PeDoubleClass=void 0;F.peFactory=void 0;F.peDefs=void 0;F.peCSTransformations=void 0;let xl,Xa,yl,zl;F.peLineType=void 0;F.peMath=void 0;let wl,$c=null;const nn=/(?:ELLIPSOID|SPHEROID)\["(?:\w|[-()])+",(\d+\.\d+)/;l.hashInt32(0);l.hashInt32(1);F.AttributeStreamOfInt32=za;F.BucketSort=Zb;F.CombinedTolerance=jb;F.ConvexHull=sh;F.CurveStitcher=wb;F.Densificator$1=Eg;F.EditShape=Fa;F.EllipticArc=Hb;F.Envelope=
Ya;F.Envelope2D=D;F.GeometryCollection=ue;F.Gnomonic=Ck;F.IndexMultiList=wa;F.Line=Z;F.ListeningGeometryCursor=Ul;F.MultiPoint=Oa;F.OperatorClip=Tc;F.OperatorContains=Jk;F.OperatorDensify=Jc;F.OperatorDifference=hf;F.OperatorDisjoint=fh;F.OperatorIntersection=Uc;F.OperatorProject=xc;F.OperatorSimpleRelation=Eh;F.OperatorSimplify=nc;F.OperatorUnion=nf;F.PEGeogToProj=Dd;F.PEGeogToProjSimple=function(a,b){const c=b.getPointCount();if(c){b=b.getImpl();var d=b.getAttributeStreamRef(0);F.peCSTransformations.geogToProj(a,
c,d.getArray());b.notifyModifiedFlags(2001)}};F.PEProjToGeogCenterPoint2D=rf;F.PE_EQ=sa;F.Point=Y;F.Point3D=X;F.Polygon=ba;F.Polyline=ma;F.SegmentBuffer=W;F.SpatialReferencePrecisionDescriptor=zb;F.TopoGraph=ec;F.TopologicalOperations=yb;F.UnorderedBitIterator=Hf;F.VertexDescription=K;F.accelerateGeometry=Dk;F.adjustToleranceForTEClustering=kb;F.areaBetweenParallelsAndMeridiansOfUnitSpheroid=function(a,b,c,d,e){d=l.snap(d,-l.geometryHalfPi,l.geometryHalfPi);e=l.snap(e,-l.geometryHalfPi,l.geometryHalfPi);
const f=l.geometryHalfPi-.03;d=d>f&&e>f||d<-f&&e<-f?ym(a,d,e):fj(a,e)-fj(a,d);return.5*(c-b)*d*(1-a)};F.autoComplete=function(a,b,c,d){return(new yb(d)).autoCompleteImpl(a,b,c)};F.brentMinimization=Ag;F.buildSegmentParentage=function(a,b,c,d,e,f,g){Jb(a,b,c,e,f,g)};F.buildSegmentParentageForIsSimple=ik;F.calculate=Qb;F.calculateLargeRadius=function(a,b){return a/Math.sqrt(1-b)};F.calculateSmallRadius=function(a,b){return(1-b)*a};F.calculateTightRadiusInMeters=function(a,b,c,d){const e={stack:[],error:void 0,
hasError:!1};try{const f=[c.x],g=[c.y-d],h=[c.x],k=[c.y+d];ej(f,g);ej(h,k);const m=Ka.__addDisposableResource(e,new F.PeDoubleClass,!1),n=Ka.__addDisposableResource(e,new F.PeDoubleClass,!1);F.peLineType.greatEllipticDistance(a,b,c.x,c.y,f[0],g[0],m,null,null);F.peLineType.greatEllipticDistance(a,b,c.x,c.y,h[0],k[0],n,null,null);return Math.min(m.val,n.val)}catch(f){e.error=f,e.hasError=!0}finally{Ka.__disposeResources(e)}};F.calculateToleranceFromGeometryForOp=Ma;F.calculateToleranceFromGeometryForOpFromGeom=
ib;F.calculateToleranceFromGeometryForRel=oc;F.canAccelerateGeometry=bh;F.cartToCurv=sd;F.checkEndForPoleTouch=sk;F.checkForWithinPole=Zg;F.checkStartForPoleTouch=rk;F.clip$1=ra;F.clipGeometryFromTopAndBottom=zd;F.closestCoordinate=Dg;F.construct=function(a){if(a.isEmpty())return new ba({vd:a.getDescription()});a=a.getImpl();var b=a.getPointCount();if(2>=b){if(1===b||a.getXY(0).equals(a.getXY(1))){var c=new Y({vd:a.getDescription()});a.getPointByVal(0,c);return c}c=new Y;var d=new ma({vd:a.getDescription()});
a.getPointByVal(0,c);d.startPathPoint(c);a.getPointByVal(1,c);d.lineToPoint(c);return d}d=a.getAttributeStreamRef(0);c=new sh({stream:d,n:b});for(var e=1,f=d.readPoint2D(0),g=new l.Point2D;e<b&&d.queryPoint2D(e<<1,g).equals(f);)e++;c.m_treeHull.addElement(0);if(e<b)for(c.m_treeHull.addBiggestElement(e),b=new l.Point2D,e+=1;e<a.getPointCount();e++)d.queryPoint2D(e<<1,b),f=c.treeHull(b),-1!==f&&c.m_treeHull.setElement(f,e);f=a.getDescription();e=1<f.getAttributeCount();g=c.m_treeHull.size();b=null;
if(2<=g){b=3<=g?new ba({vd:f}):new ma({vd:f});f=b.getImpl();f.reserve(c.m_treeHull.size());f.addPathPoint2D(null,0,!0);g=new l.Point2D;for(let h=c.m_treeHull.getFirst();-1!==h;h=c.m_treeHull.getNext(h))if(e){const k=new Y;a.getPointByVal(c.m_treeHull.getElement(h),k);f.insertPoint(0,-1,k)}else d.queryPoint2D(c.m_treeHull.getElement(h)<<1,g),f.insertPoint2D(0,-1,g)}else e?(d=new Y({vd:f}),a.getPointByVal(c.m_treeHull.getElement(c.m_treeHull.getFirst()),d),b=d):(a=d.readPoint2D(c.m_treeHull.getElement(c.m_treeHull.getFirst())<<
1),b=new Y(a));return b};F.constructOrientedMinimumBoundingBox=function(a,b,c,d,e){c.setNAN();d.setCoords(1,0);e.setCoords(0,0);if(!a.isEmpty())if(a.getGeometryType()===p.GeometryType.enumPoint)c.assign(a.getXY());else{var f=a.getPointCount();if(2===f)d=a.getXY(0),a=a.getXY(1),c.assign(d.add(a).mul(.5)),c=a.sub(d),d=jl(c),e.setCoords(.5*c.length(),0);else{let q=Number.MAX_VALUE;const r=[0,1,0,0],t=new l.SmallMatrix(4,2);t.set(0,0,0);t.set(0,1,1);t.set(1,0,1);for(t.set(1,1,2);r[0]<f;++r[0],th(t,0,
f)){r[1]===r[0]&&(++r[1],th(t,1,f));for(var g=1;;++g){for(;;){var h=a.getXY(t.get(0,0)),k=a.getXY(t.get(0,1)),m=a.getXY(t.get(g,0)),n=a.getXY(t.get(g,1));switch(g^2){case 0:break;case 1:k.rightPerpendicularThis();h.rightPerpendicularThis();break;case 2:k.negateThis();h.negateThis();break;case 3:k.leftPerpendicularThis();h.leftPerpendicularThis();break;default:p.throwInvalidArgumentException("")}h=l.Point2D.orientationRobustEx(h,k,m,n);if(0<h)break;++r[g];th(t,g,f);if(0===h)break}if(3===g)break;r[g+
1]<r[g]&&(r[g+1]=r[g],t.set(g+1,0,t.get(g,0)),t.set(g+1,1,t.get(g,1)))}g=a.getXY(t.get(0,0)).add(a.getXY(t.get(2,0))).mul(.5);h=jl(a.getXY(t.get(0,1)).sub(a.getXY(t.get(0,0))));k=new l.Point2D;k.x=Math.max(0,h.dotProduct(a.getXY(t.get(1,0)).sub(a.getXY(t.get(3,0)))));k.y=Math.max(0,h.crossProduct(a.getXY(t.get(0,0)).sub(a.getXY(t.get(2,0)))));m=b?k.x*k.y:k.y;m<q&&(q=m,m=a.getXY(t.get(1,0)),n=a.getXY(t.get(3,0)),m=m.add(n).mul(.5).sub(g),c.assign(g.add(h.mul(h.dotProduct(m)))),d.assign(h),e.assign(k))}e.mulThis(.5);
e.x<e.y&&(e.y=l.swap(e.x,e.x=e.y),d.leftPerpendicularThis())}0>d.y?d.negateThis():0===d.y&&(d.x=1)}};F.convertToRadians=function(a){return a*jh};F.create$2=uh;F.create$6=function(a){return new ad};F.createEx=uf;F.createFromWKT$2=ml;F.createLocal=function(a,b,c){void 0===b&&(b=1);(0>=b||!Number.isFinite(b))&&p.throwInvalidArgumentException("");a||1===b||p.throwInvalidArgumentException("null Unit has to have z_to_xy_factor equal to 1");const d=new Sb;a=(d.m_unit=a)?a:new ad(9001);void 0===c?(vl(d.m_precisionDescriptor,
a,null,1),d.m_bDefaultDescriptor=!0):(d.m_precisionDescriptor.assign(c),d.m_precisionDescriptor.fixTolerance(),d.m_bDefaultDescriptor=!1);Number.isNaN(d.m_precisionDescriptor.m_falseX)&&p.throwInvalidArgumentException("NAN false X/Y are not allowed here");d.m_localZToXYFactor=b;d.calculateHashCode();d.initDbgName();return d};F.curvToCart=mb;F.defaultRank=1;F.densificationDeviationFromTolerance=xb;F.densify=Yg;F.densify$1=ij;F.ensureXYMonotoneSegment=fe;F.execute=ac;F.execute$1=tc;F.executeMp2sp=function(a,
b,c){c=new Ol(c);c.m_shape=a;c.m_geometry=b;c.m_sortedVertices=null;c.m_bFixSelfTangency=!1;return c.fixRingOrientationForMp2sp_()};F.extraToleranceForCrackingAndClustering=function(a,b){return 3*a+3*b};F.foldGeometry=ne;F.foldInto360NoUnion=Ak;F.generateGeometryCursor=Rh;F.geodeticDensifySegment=function(a,b,c,d,e,f,g,h,k,m,n,q){const r=new l.Point2D,t=new l.Point2D,u=0<d.compare(e);u?(r.setCoordsPoint2D(e),t.setCoordsPoint2D(d)):(r.setCoordsPoint2D(d),t.setCoordsPoint2D(e));a=vk(a,b,c,r,t,f,g,h,
k,m,null,n,q);u&&ah(k,m,null,n);return a};F.getMergedExtent=Ld;F.getMergedExtentEnv2D=Ae;F.getPolynomialCoefs=qg;F.getTempName=function(a=""){let b=`${Fk()}${ao++}`;""!==a&&(b+=`|${a}`);return b};F.groupTransform=function(a,b,c){if(0!==a.length){var d=0,e=0;for(++e;e!==a.length;++e)b(a[d],a[e])||(c(d,e),d=e);c(d,e)}};F.hasPe=oe;F.injectNoPe$1=function(a){$c=a;p.geometryReleaseAssert($c)};F.injectPe$1=function(a){F.peFactory||(on(a),a=Nf,Nf=null,a.forEach(b=>{(b=b.deref())&&b.attachToPe()}))};F.insertGeodeticPointsEditShape=
Cd;F.integrateByRomberg=Nc;F.intersectInfiniteLines=function(a,b){const c={bIntersect:!1,t1:Number.NaN,t2:Number.NaN},d=a.m_XEnd-a.m_XStart,e=a.m_YEnd-a.m_YStart,f=b.m_XEnd-b.m_XStart,g=b.m_YEnd-b.m_YStart;var h=f*e-d*g;if(0===h)return c;const k=b.m_XStart-a.m_XStart;a=b.m_YStart-a.m_YStart;h=1/h;c.t1=(f*a-k*g)*h;c.t2=(d*a-k*e)*h;c.bIntersect=!0;return c};F.isAtLeastPlanarSimple=function(a){return 4<=a};F.isAtLeastWeakSimpleGeom=Kh;F.isPathConvex=function(a,b,c){var d=a.getImpl();a=d.getPathStart(b);
c=d.getPathEnd(b);var e=!d.isClosedPath(b)&&d.isClosedPathInXYPlane(b);b=d.getAttributeStreamRef(0);a*=2;c*=2;e&&(c-=2);if(6>c-a)return!0;e=b.readPoint2D(a);d=b.readPoint2D(a+2);const f=b.readPoint2D(a+4);if(!(0>l.Point2D.orientationRobust(d,f,e)))return!1;const g=d.clone(),h=new l.Point2D;for(a+=6;a<c;a+=2)if(h.assign(d),d.assign(f),b.queryPoint2D(a,f),!(0>l.Point2D.orientationRobust(d,f,e)&&0>l.Point2D.orientationRobust(g,f,e)&&0>l.Point2D.orientationRobust(d,f,h)))return!1;return!0};F.isPoint2DInPolygon2D=
ob;F.isSimpleOGC=lk;F.linesToPolygons=function(a,b,c){return(new yb(c)).linesToPolygonsImpl(a,b)};F.makeSpheroidData=Bd;F.minimumBoundingCircle=function(a,b,c){a.isEmpty()&&p.throwEmptyGeometryException("");p.throwIfCurves(a);a=a.getImpl();c=[];Uk(a.getPointCount(),c);return Vk(en(a),c,a.getPointCount(),b)};F.minimumBoundingCirclePoint2D=Tk;F.needsCrackingAndClustering=function(a,b,c){const d=kb(b);b=Rf(b);const e=new mj(c);e.m_shape=a;e.m_sqrTolerance=d*d;e.m_cellSize=2*d;e.m_invCellSize=1/e.m_cellSize;
e.m_geometry=-1;e.m_bTrackChanges=!1;return e.needsClustering()?!0:Jg(!0,a,b,null,c)};F.normalizeMultiPathGcs=qk;F.normalizeX=kf;F.nthElement=function(a,b,c,d,e){l.sortRange(a,b,d-b,(f,g)=>e(f,g)?-1:1)};F.nullHandle=-1;F.planarSimplify=cf;F.processCurves=function(a,b,c,d){if(!p.isMultiPath(a.getGeometryType()))return a;var e=a.getImpl();if(!e.hasNonLinearSegments())return a;d=a.createInstance();d.getGeometryType()===p.GeometryType.enumPolygon&&d.setFillRule(a.getFillRule());new Fa;const f=new Y,g=
new W,h=[],k=[],m=[];a=1<a.getDescription().getAttributeCount();for(e=e.querySegmentIterator();e.nextPath();){let n=!0;for(;e.hasNextSegment();){const q=e.isClosingSegment(),r=e.nextSegment();if(!r.isCurve()){d.addSegment(r,n,q);n=!1;continue}let t,u=!1;switch(r.getGeometryType()){case p.GeometryType.enumEllipticArc:t=td(r,b,c,!0,!0,k,m,h);u=!0;break;case p.GeometryType.enumRationalBezier2:t=td(r,b,c,!0,!0,k,m,h);u=!0;break;default:t=We(r,b,c,!0,!0,k,h)}const v=u?2:3;k[1].isNAN()?(g.createLine(),
g.get().construct(k[0],k[v])):u?(g.createQuadraticRationalBezier(),g.get().constructArrayWeights(k,m)):(g.createCubicBezier(),g.get().constructPoints(k));a&&n&&(r.queryCoord(h[0],f),g.get().setStart(f));a&&(r.queryCoord(h[1],f),g.get().setEnd(f));d.addSegment(g.get(),n,q&&1===t);n=!1;for(let w=1,x=t,y=v;w<x;++w,y+=v)k[y+1].isNAN()?(g.createLine(),g.get().construct(k[y],k[y+v])):u?(g.createQuadraticRationalBezier(),g.get().constructArrayWeights(k.slice(y),m.slice(y))):(g.createCubicBezier(),g.get().constructPoints(k.slice(y))),
a&&(r.queryCoord(h[w+1],f),g.get().setEnd(f)),d.addSegment(g.get(),!1,q&&w+1===x)}}return d};F.processWithPCSHorizon=pf;F.projectMultiPathVerticesPCSToGCS=function(a,b,c,d){var e=new Oa({vd:b.getDescription()});e.addPoints(b,0,-1);d=(new xc).execute(e,a,d);e=b.getPointCount();c.setEmpty();if(a.getInputSR().isPannable()){if(e!==d.getPointCount())return!1;var f=new D;b.queryEnvelope(f);var g=new D;d.queryEnvelope(g);f=f.width();g=g.width();if(0!==f&&0!==g){if(g/=f,a=a.getOutputSR().getPannableExtent().width()/
a.getInputSR().getPannableExtent().width(),1E-10<Math.abs(g/a-1))return!1}else if(0!==f||0!==g)return!1;c.add(b,!1);for(b=0;b<e;b++)a=d.getXY(b),c.setXY(b,a);return!0}return!1};F.projectPointsToGCS=function(a,b,c,d){a=a.getSRToGCSTransform();return(new xc).transform(a,b,c,d,!1)};F.quadraticRealRoots$2=Ac;F.querySinglePartCount=function(a){if(a.isEmpty())return 0;switch(a.getGeometryType()){case p.GeometryType.enumMultiPoint:return a.getImpl().getPointCount();case p.GeometryType.enumPolyline:return a.getImpl().getPathCount();
case p.GeometryType.enumPolygon:return a.getImpl().getOGCPolygonCount();case p.GeometryType.enumGeometryCollection:return a.getGeometryCount()}return 1};F.relate=uc;F.relate$1=Ib;F.replaceAllCurvesWithBeziers=function(a,b,c,d){Number.isFinite(b)||p.throwInvalidArgumentException("replace_all_curves_with_beziers: max_deviation");d=p.GeometryType.enumBezier;p.geometryReleaseAssert(d===p.GeometryType.enumBezier||d===p.GeometryType.enumEllipticArc||d===p.GeometryType.enumBezier2);const e=a.createInstance();
e.getGeometryType()===p.GeometryType.enumPolygon&&e.setFillRule(a.getFillRule());const f=a.querySegmentIterator();for(let y=0,z=a.getPathCount();y<z;++y){if(!a.hasNonLinearSegmentsPath(y)){e.addPath(a,y,!0);continue}var g=a.getPathStart(y),h=!0;let A=0;f.resetToPath(y);for(p.geometryReleaseAssert(f.nextPath());f.hasNextSegment();){var k=f.nextCurve();if(k){var m=f.getStartPointIndex()-g,n=m-A;0<n&&(e.addSegmentsFromPath(a,y,A,n,h),h=!1);A=m+1;if(d===p.GeometryType.enumBezier){m=e;var q=h;h=[];n=[];
var r=We(k,b,0,c,!1,h,n),t=new Gb,u=k.getDescription();t.assignVertexDescription(u);u=1<u.getAttributeCount();var v=new Y,w=new Z;for(let C=0,B=0;C<r;C++){if(h[B+1].isNAN()){if(u){var x=n[C];k.queryCoord(x,v);w.setStart(v);x=n[C+1];k.queryCoord(x,v);w.setEnd(v)}w.setStartXY(h[B]);w.setEndXY(h[B+3]);m.addSegment(w,q)}else u&&(x=n[C],k.queryCoord(x,v),t.setStart(v),x=n[C+1],k.queryCoord(x,v),t.setEnd(v)),t.setStartXY(h[B]),t.setControlPoint1(h[B+1]),t.setControlPoint2(h[B+2]),t.setEndXY(h[B+3]),m.addSegment(t,
q);B+=3;q=!1}}else if(d===p.GeometryType.enumBezier2){m=e;q=h;h=[];n=[];r=zm(k,b,0,c,!1,h,n);t=new rc;u=k.getDescription();t.assignVertexDescription(u);u=1<u.getAttributeCount();v=new Y;w=new Z;for(let C=0,B=0;C<r;C++)h[B+1].isNAN()?(u&&(x=n[C],k.queryCoord(x,v),w.setStart(v),x=n[C+1],k.queryCoord(x,v),w.setEnd(v)),w.setStartXY(h[B]),w.setEndXY(h[B+2]),m.addSegment(w,q)):(u&&(x=n[C],k.queryCoord(x,v),t.setStart(v),x=n[C+1],k.queryCoord(x,v),t.setEnd(v)),t.setStartXY(h[B]),t.setControlPoint1(h[B+1]),
t.setEndXY(h[B+2]),m.addSegment(t,q)),B+=2,q=!1}else p.throwInternalErrorException("");h=!1}else break}g=a.getSegmentCountPath(y);0!==g-A&&e.addSegmentsFromPath(a,y,A,g-A,h)}return e};F.rotate=function(a,b,c,d){Qh(a,b,c-1);Qh(a,c,d-1);a.reverse()};F.s_IntToPublicCutSide=function(a){switch(a){case 1:return 1;case 2:return 2;case 3:break;case 4:return 4;case 0:return 0;default:p.geometryReleaseAssert(0,"unrecognized cut side")}return 3};F.setWeakSimple=function(a,b){a.getImpl().setIsSimple(3,b)};F.shuffle=
Ph;F.simplifyOGC=nk;F.snapGeometry=function(a,b){return a.snapGeometry(b)};F.solve$1=qc;F.sphericalDistance=Cg;F.sphericalDistancePointToSegment=function(a,b,c,d,e){const f=c.getUnitVector();var g=d.getUnitVector();const h=b.getUnitVector(),k=new X;k.setCrossProductVector(f,g);if(!k.isZero()&&(k.normalizeThis(),b=h.sub(k.mul(k.dotProduct(h))),!b.isZero())){b.normalizeThis();const m=f.add(g).mul(.5);if(m.dotProduct(b)>m.dotProduct(f))return c=Math.abs(k.dotProduct(h)),c=Math.asin(c),e.assign(b.getUnitVector().mul(a)),
c*a}b=Cg(1,f,h);g=Cg(1,g,h);if(b<=g)return e.assign(c),b*a;e.assign(d);return g*a};F.stitchingDensificationDeviationFromTolerance=bc;F.symmetricDifference=function(a,b,c,d){if(a.getDimension()>b.getDimension())return Kb(Ta(a),a,b,"^");if(a.getDimension()<b.getDimension()||a.isEmpty())return Kb(Ta(b),a,b,"^");if(b.isEmpty())return Kb(Ta(a),a,b,"^");var e=new D;a.queryEnvelope(e);var f=new D;b.queryEnvelope(f);var g=new D;g.setCoords({env2D:e});g.mergeEnvelope2D(f);c=Ma(c,g,!0);const h=new yb(d);e=
new Fa;const k=e.addGeometry(Ta(a)),m=e.addGeometry(Ta(b));f=0;g=null;if(e.hasCurves()){g=new wb;var n=e.getEnvelope2D(d);f=bc(c.total());const q=xb(c.total(),n);n=c.total();Jb(e,q,n,g,null,d)}h.setEditShapeCrackAndCluster(e,c);d=h.symmetricDifference(k,m);null!==g&&g.stitchCurves(e,d,f,!0);a=Kb(e.getGeometry(d),a,b,"^");gf(a.getGeometryType())&&(a.getImpl().setIsSimple(4,c.total()),a.getGeometryType()===p.GeometryType.enumPolygon&&a.getImpl().updateOGCFlagsProtected());return a};F.testPointsInArea2D=
Pg;F.transformInPlace=Wg;F.validateSclString=rj});