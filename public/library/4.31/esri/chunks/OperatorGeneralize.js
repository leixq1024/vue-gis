// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.31/esri/copyright.txt for details.
//>>built
define("exports ./tslib.es6 ./SimpleGeometryCursor ./Geometry ./QuadraticBezier ./Transformation2D".split(" "),function(w,u,x,h,n,r){class y{getOperatorType(){return 10204}supportsCurves(){return!0}accelerateGeometry(a,b,c){return!1}canAccelerateGeometry(a){return!1}executeMany(a,b,c,d){return new v(a,b,c,d)}execute(a,b,c,d){a||h.throwInvalidArgumentException("null param is not allowed.");return(new v(null,b,c,d)).generalize(a)}}class v extends x.GeometryCursor{constructor(a,b,c,d){super();this.m_pline=
null;this.m_point=new n.Point;this.m_stack=[];this.m_resultstack=[];this.m_callCount=0;this.m_progressTracker=d;this.m_geoms=a;this.m_maxDeviation=b;this.m_bRemoveDegenerateParts=c}tock(){return!0}getRank(){return 1}next(){const a=this.m_geoms.next();if(null===a)return null;h.throwIfMesh(a);return this.generalize(a)}getGeometryID(){return this.m_geoms.getGeometryID()}generalize(a){var b=a.getGeometryType();if(h.isPoint(b))return a;if(b===h.GeometryType.enumEnvelope)return b=new n.Polygon({vd:a.getDescription()}),
b.addEnvelope(a,!1),this.generalize(b);if(h.isSegment(b))return b=new n.Polyline({vd:a.getDescription()}),b.addSegment(a,!0),this.generalize(b);h.isMultiPath(b)||h.throwNotImplementedException("");if(a.isEmpty()||0>=this.m_maxDeviation)return a;b=(new n.OperatorDensify).execute(a,0,.05*this.m_maxDeviation,0,this.m_progressTracker);a.hasNonLinearSegments()&&(this.m_maxDeviation*=.95);const c=a.createInstance();c.getGeometryType()===h.GeometryType.enumPolygon&&c.setFillRule(a.getFillRule());this.m_xy=
b.getAttributeStreamRef(0);a={stack:[],error:void 0,hasError:!1};try{this.m_pline=new n.Line;u.__addDisposableResource(a,r.makeScopedCall(()=>{this.m_pline=null},!1),!1);for(let d=0,g=b.getPathCount();d<g;d++)this.generalizePath(b.getImpl(),d,c.getImpl())}catch(d){a.error=d,a.hasError=!0}finally{u.__disposeResources(a)}this.m_resultstack.length=0;this.m_stack.length=0;return c}generalizePath(a,b,c){if(!(2>a.getPathSize(b))){this.m_resultstack.length=0;this.m_stack.length=0;var d=a.getPathStart(b),
g=a.getPathEnd(b)-1,e=a.isClosedPath(b),f=a.isClosedPathInXYPlane(b),p=0,m=-1;this.m_stack.push(e?d:g);this.m_stack.push(d);var q=!1;d=!1;!this.m_bRemoveDegenerateParts&&f&&(d=q=!0);for(;1<this.m_stack.length;){f=this.m_stack.at(-1);this.m_stack.pop();var k=this.m_stack.at(-1),l=a.getXY(f);this.m_pline.setStartXY(l);l=a.getXY(k);this.m_pline.setEndXY(l);l=[0];k=this.findGreatestDistance(f,k,g,l);0<=k&&(q?q=!1:(d&&l[0]>p&&(p=l[0],m=k),l[0]<=this.m_maxDeviation&&(k=-1)));0<=k?(this.m_stack.push(k),
this.m_stack.push(f)):this.m_resultstack.push(f)}e||this.m_resultstack.push(this.m_stack[0]);g=this.m_resultstack.length;q=a.getPathSize(b);if(g===q&&g===this.m_stack.length)c.addPath(a,b,!0);else if(0<this.m_resultstack.length&&!(this.m_bRemoveDegenerateParts&&2>=this.m_resultstack.length&&(e||1===this.m_resultstack.length||r.Point2D.distance(a.getXY(this.m_resultstack[0]),a.getXY(this.m_resultstack[1]))<=this.m_maxDeviation))){d&&0<=m&&p<=this.m_maxDeviation&&(b=this.m_resultstack.at(-1)>m,this.m_resultstack.push(m),
b&&(this.m_resultstack[this.m_resultstack.length-2]=r.swap(this.m_resultstack[this.m_resultstack.length-1],this.m_resultstack[this.m_resultstack.length-1]=this.m_resultstack[this.m_resultstack.length-2])));for(let t=0,z=this.m_resultstack.length;t<z;t++)a.getPointByVal(this.m_resultstack[t],this.m_point),0===t?c.startPathPoint(this.m_point):c.lineToPoint(this.m_point);if(e){for(a=this.m_resultstack.length;3>a;a++)c.lineToPoint(this.m_point);c.closePathWithLine()}}}}findGreatestDistance(a,b,c,d){let g=
b-1;b<=a&&(g=c);b=-1;c=0;const e=new r.Point2D;for(a+=1;a<=g;a++){this.m_xy.queryPoint2D(2*a,e);var f=e.x;const p=e.y,m=this.m_pline.getClosestCoordinate(e,!1);e.assign(this.m_pline.getCoord2D(m));e.x-=f;e.y-=p;f=e.length();f>c&&(b=a,c=f);this.m_callCount++}d[0]=c;return b}}w.OperatorGeneralize=y});