// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.31/esri/copyright.txt for details.
//>>built
define(["exports","./SimpleGeometryCursor","./QuadraticBezier","./Geometry"],function(p,q,f,h){function r(a){return a.isEmpty()?1:f.querySinglePartCount(a)}class t{getOperatorType(){return 10700}accelerateGeometry(a,e,c){return!1}canAccelerateGeometry(a){return!1}supportsCurves(){return!0}executeMany(a,e,c,b=1){return new u(a,e,c,b)}}class u extends q.GeometryCursor{constructor(a,e,c,b){super();this.m_progressTracker=c;this.m_inputGeoms=a;this.m_spatialReference=e;this.m_currentGeometry=null;this.m_index=
this.m_polygonStart=this.m_singlePartCount=this.m_singlePartIndex=-1;this.m_options=b}tock(){return!0}getRank(){return 1}next(){if(this.m_singlePartIndex===this.m_singlePartCount){var a=this.m_inputGeoms.next();if(null===a)return null;h.throwIfMesh(a);if(a.getGeometryType()===h.GeometryType.enumPolygon)if(1===this.m_options)this.m_currentGeometry=(new f.OperatorSimplify).execute(a,this.m_spatialReference,!1,this.m_progressTracker);else if(2===this.m_options)if(2>a.getPathCount())this.m_currentGeometry=
a;else{var e=a.getImpl().getIsSimple(0,[0]);if(f.isAtLeastPlanarSimple(e))this.m_currentGeometry=a;else{const g=new f.EditShape;var c=g.addGeometry(a);e=null;if(g.hasCurves()){e=new f.CurveStitcher;var b=new f.Envelope2D;a.queryEnvelope(b);var d=f.calculateToleranceFromGeometryForOpFromGeom(null,a,!0);b=f.densificationDeviationFromTolerance(d.total(),b);f.buildSegmentParentageForIsSimple(g,b,d.total(),12E3,null,e,null,this.m_progressTracker)}e=g.createPathUserIndex();d=0;for(b=g.getFirstPath(c);b!==
f.nullHandle;b=g.getNextPath(b))g.setPathUserIndex(b,e,d++);const m=f.executeMp2sp(g,c,this.m_progressTracker);h.geometryReleaseAssert(0<=m);d=[];for(c=g.getFirstPath(c);c!==f.nullHandle;c=g.getNextPath(c))d.push(c);d.sort((l,n)=>Math.abs(g.getPathUserIndex(l,m))-Math.abs(g.getPathUserIndex(n,m)));c=new f.Polygon({vd:a.getDescription()});c.reserveParts(a.getPointCount(),a.getPathCount());for(let l=0,n=d.length;l<n;l++){var k=d[l];b=g.getPathUserIndex(k,e);const v=0<a.calculateRingArea2D(b);k=0<=g.getPathUserIndex(k,
m);c.addPath(a,b,v===k)}this.m_currentGeometry=c}}else h.throwInvalidArgumentException("");else this.m_currentGeometry=a;this.m_singlePartCount=r(this.m_currentGeometry);this.m_polygonStart=this.m_singlePartIndex=0;this.m_index=this.m_inputGeoms.getGeometryID()}a=this.getSingleGeometry(this.m_singlePartIndex,this.m_singlePartCount,this.m_polygonStart,this.m_currentGeometry);a.getGeometryType()===h.GeometryType.enumPolygon&&(this.m_polygonStart+=a.getPathCount());this.m_singlePartIndex++;return a}getGeometryID(){return this.m_index}getSingleGeometry(a,
e,c,b){let d=null;switch(b.getGeometryType()){case h.GeometryType.enumMultiPoint:d=new f.Point({vd:b.getDescription()});b.isEmpty()||b.getPointByVal(a,d);break;case h.GeometryType.enumPolyline:1===e?d=b:(d=b.createInstance(),d.getImpl().addPath(b.getImpl(),a,!0),a=[0],c=b.getImpl().getIsSimple(0,a),d.getImpl().setIsSimple(c,a[0],!0));break;case h.GeometryType.enumPolygon:if(1===e)d=b;else{d=b.createInstance();a=d.getImpl();b=b.getImpl();e=b.getPathFlagsStreamRef();const k=b.getPathCount();do a.addPath(b,
c,!0),c++;while(c<k&&0===(e.read(c)&8));a.getPathFlagsStreamRef().setBits(0,8);c=[0];b=b.getIsSimple(0,c);a.setIsSimple(b,c[0],!0)}break;default:d=b}return d}}p.OperatorMultiPartToSinglePart=t});