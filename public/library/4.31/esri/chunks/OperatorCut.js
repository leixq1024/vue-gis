// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.31/esri/copyright.txt for details.
//>>built
define(["exports","./SimpleGeometryCursor","./Geometry","./QuadraticBezier"],function(D,E,y,a){function v(k,m){return{m_geometry:k,m_side:m}}var C=a.CurveStitcher;class F{getOperatorType(){return 10005}accelerateGeometry(k,m,p){return!1}canAccelerateGeometry(k){return!1}supportsCurves(){return!0}execute(k,m,p,l,e){return new G(k,m,p,l,e)}}class G extends E.GeometryCursor{constructor(k,m,p,l,e){super();this.m_cutIndex=-1;this.m_cuts=[];this.m_progressTracker=e;this.m_cuttee=m.clone();this.m_cutter=
new a.Polyline({copy:p});this.m_bConsiderTouch=k;k=a.getMergedExtent(m,p);this.m_tolerance=a.calculateToleranceFromGeometryForOp(l,k,!0)}next(){-1===this.m_cutIndex&&this.generateCuts();return++this.m_cutIndex<this.m_cuts.length?this.m_cuts[this.m_cutIndex]:null}getGeometryID(){return 0}tock(){return!0}getRank(){return 1}generateCuts(){switch(this.m_cuttee.getGeometryType()){case y.GeometryType.enumPolyline:this.generatePolylineCuts();break;case y.GeometryType.enumPolygon:this.generatePolygonCuts()}}generatePolylineCuts(){const k=
new a.Polyline,m=new a.Polyline,p=new a.Polyline;this.m_cuts.length=0;this.m_cuts.push(k);this.m_cuts.push(m);const l=[];var e=this.m_bConsiderTouch,f=this.m_cuttee,c=this.m_cutter,g=this.m_tolerance,t=this.m_progressTracker;if(f.isEmpty()){var b=v(f,0);l.push(b)}else if(c.isEmpty())b=v(f,0),l.push(b);else{var z=[];b=new a.EditShape;var h=b.createGeometryUserIndex(),w=b.addGeometry(f),q=b.addGeometry(c),r=new a.TopologicalOperations(t);c=0;f=null;if(b.hasCurves()){f=new C;var n=b.getEnvelope2D(t);
c=a.stitchingDensificationDeviationFromTolerance(g.total());n=a.densificationDeviationFromTolerance(g.total(),n);a.buildSegmentParentage(b,n,g.total(),12E3,f,null,t)}b.dbgVerifyCurves();r.setEditShapeCrackAndCluster(b,g);r.cut(e,h,w,q,z);for(const d of z)null!==f&&f.stitchCurves(b,d,c,!1),e=b.getGeometry(d),e=v(e,a.s_IntToPublicCutSide(b.getGeometryUserIndex(d,h))),l.push(e);null!==f&&f.clearStitcher(b)}for(b=0;b<l.length;b++)h=l[b],1===h.m_side?k.add(h.m_geometry,!1):2===h.m_side||4===h.m_side?m.add(h.m_geometry,
!1):3===h.m_side?this.m_cuts.push(h.m_geometry):0===h.m_side?p.add(h.m_geometry,!1):y.throwInternalErrorException("");p.isEmpty()||k.isEmpty()&&m.isEmpty()&&!(3<=this.m_cuts.length)||this.m_cuts.push(p);k.isEmpty()&&m.isEmpty()&&3>this.m_cuts.length&&(this.m_cuts.length=0)}generatePolygonCuts(){const k=new a.Polygon,m=new a.Polygon,p=new a.Polygon;this.m_cuts.length=0;this.m_cuts.push(k);this.m_cuts.push(m);const l=[];var e=this.m_cuttee,f=this.m_cutter,c=this.m_tolerance,g=this.m_progressTracker;
if(e.isEmpty())c=v(e,0),l.push(c);else if(f.isEmpty())c=v(e,0),l.push(c);else{var t=[],b=new a.EditShape,z=b.createGeometryUserIndex(),h=b.addGeometry(e),w=b.addGeometry(f);f=new a.TopologicalOperations(g);e=0;var q=null;if(b.hasCurves()){q=new C;var r=b.getEnvelope2D(g);e=a.stitchingDensificationDeviationFromTolerance(c.total());r=a.densificationDeviationFromTolerance(c.total(),r);a.buildSegmentParentage(b,r,c.total(),12E3,q,null,g)}b.dbgVerifyCurves();f.setEditShapeCrackAndCluster(b,c);f.cut(!1,
z,h,w,t);null!==q&&q.stitchCurves(b,a.nullHandle,e,!0);var n=b.getGeometry(h);r=new a.Polygon;w=new a.Polygon;h=[];for(let u=0;u<t.length;u++){var d=null;d=new a.EditShape;var x=d.addGeometry(n),A=d.addGeometry(b.getGeometry(t[u]));if(d.hasCurves()){var B=d.getEnvelope2D(g);e=a.stitchingDensificationDeviationFromTolerance(c.total());B=a.densificationDeviationFromTolerance(c.total(),B);a.buildSegmentParentage(d,B,c.total(),12E3,q,null,g)}f.setEditShapeCrackAndCluster(d,c);x=f.intersection(x,A);null!==
q&&q.stitchCurves(d,a.nullHandle,e,!0);d=d.getGeometry(x);d.isEmpty()||(x=b.getGeometryUserIndex(t[u],z),2===x?r.add(d,!1):1===x?w.add(d,!1):h.push(d),d=new a.EditShape,n=d.addGeometry(n),x=d.addGeometry(b.getGeometry(t[u])),d.hasCurves()&&(A=d.getEnvelope2D(g),e=a.stitchingDensificationDeviationFromTolerance(c.total()),A=a.densificationDeviationFromTolerance(c.total(),A),a.buildSegmentParentage(d,A,c.total(),12E3,q,null,g)),f.setEditShapeCrackAndCluster(d,c),n=f.difference(n,x),null!==q&&q.stitchCurves(d,
a.nullHandle,e,!0),n=d.getGeometry(n))}!n.isEmpty()&&0<t.length&&h.push(n);if(!r.isEmpty()||!w.isEmpty()){r.isEmpty()||(c=v(r,1),l.push(c));w.isEmpty()||(c=v(w,2),l.push(c));for(let u=0,H=h.length;u<H;++u)c=v(h[u],3),l.push(c)}}for(c=0;c<l.length;c++)g=l[c],1===g.m_side?k.add(g.m_geometry,!1):2===g.m_side?m.add(g.m_geometry,!1):3===g.m_side?this.m_cuts.push(g.m_geometry):0===g.m_side?p.add(g.m_geometry,!1):y.throwInternalErrorException("");y.geometryReleaseAssert(p.isEmpty()||1===l.length);k.isEmpty()&&
m.isEmpty()&&3>this.m_cuts.length&&(this.m_cuts.length=0)}}D.OperatorCut=F});