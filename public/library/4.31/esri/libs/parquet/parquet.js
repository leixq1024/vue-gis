// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.31/esri/copyright.txt for details.
//>>built
define(["exports","../../assets","../../request"],function(E,da,H){function n(a){const b=f[a];132>a||(f[a]=u,u=a);return b}function h(a){u===f.length&&f.push(f.length+1);const b=u;u=f[b];f[b]=a;return b}function A(){if(null===v||0===v.byteLength)v=new Uint8Array(d.memory.buffer);return v}function r(a,b){a>>>=0;return I.decode(A().subarray(a,a+b))}function ea(a,b,c,e){const g={a,b,cnt:1,dtor:c};a=(...k)=>{g.cnt++;const l=g.a;g.a=0;try{return e(l,g.b,...k)}finally{0===--g.cnt?(d.__wbindgen_export_0.get(g.dtor)(l,
g.b),J.unregister(g)):g.a=l}};a.original=g;J.register(a,g,g);return a}function fa(a,b,c){d._dyn_core__ops__function__FnMut__A____Output___R_as_wasm_bindgen__closure__WasmClosure___describe__invoke__h7be72b1871260ae2(a,b,h(c))}function w(a,b,c){if(void 0===c){c=B.encode(a);var e=b(c.length,1)>>>0;A().subarray(e,e+c.length).set(c);m=c.length;return e}e=a.length;b=b(e,1)>>>0;var g=A();let k=0;for(;k<e;k++){const l=a.charCodeAt(k);if(127<l)break;g[b+k]=l}k!==e&&(0!==k&&(a=a.slice(k)),b=c(b,e,e=k+3*a.length,
1)>>>0,g=A().subarray(b+k,b+e),a=ha(a,g),k+=a.written,b=c(b,e,k,1)>>>0);m=k;return b}function t(){if(null===q||!0===q.buffer.detached||void 0===q.buffer.detached&&q.buffer!==d.memory.buffer)q=new DataView(d.memory.buffer);return q}function p(a,b){try{return a.apply(this,b)}catch(c){d.__wbindgen_exn_store(h(c))}}function K(a,b){b=b(2*a.length,2)>>>0;if(null===x||0===x.byteLength)x=new Uint16Array(d.memory.buffer);x.set(a,b/2);m=a.length;return b}function L(a,b,c){a=w(a,d.__wbindgen_malloc,d.__wbindgen_realloc);
b=d.readMetadata(a,m,h(b),h(c));return n(b)}function M(a,b){if(!(a instanceof b))throw Error(`expected instance of ${b.name}`);return a.ptr}async function ia(a,b){if("function"===typeof Response&&a instanceof Response){if("function"===typeof WebAssembly.instantiateStreaming)try{return await WebAssembly.instantiateStreaming(a,b)}catch(c){if("application/wasm"!=a.headers.get("Content-Type"))console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",
c);else throw c;}a=await a.arrayBuffer();return await WebAssembly.instantiate(a,b)}b=await WebAssembly.instantiate(a,b);return b instanceof WebAssembly.Instance?{instance:b,module:a}:b}function N(){const a={wbg:{}};a.wbg.__wbg_new_abda76e883ba8a5f=function(){return h(Error())};a.wbg.__wbg_stack_658279fe44541cf6=function(b,c){c=w(f[c].stack,d.__wbindgen_malloc,d.__wbindgen_realloc);const e=m;t().setInt32(b+4,e,!0);t().setInt32(b+0,c,!0)};a.wbg.__wbg_error_f851667af71bcfc6=function(b,c){let e,g;try{e=
b,g=c,console.error(r(b,c))}finally{d.__wbindgen_free(e,g,1)}};a.wbg.__wbindgen_object_drop_ref=function(b){n(b)};a.wbg.__wbindgen_is_function=function(b){return"function"===typeof f[b]};a.wbg.__wbg_self_3093d5d1f7bcb682=function(){return p(function(){return h(self.self)},arguments)};a.wbg.__wbg_window_3bcfc4d31bc012f8=function(){return p(function(){return h(window.window)},arguments)};a.wbg.__wbg_globalThis_86b222e13bdf32ed=function(){return p(function(){return h(globalThis.globalThis)},arguments)};
a.wbg.__wbg_global_e5a3fe56f8be9485=function(){return p(function(){return h(global.global)},arguments)};a.wbg.__wbindgen_is_undefined=function(b){return void 0===f[b]};a.wbg.__wbg_newnoargs_76313bd6ff35d0f2=function(b,c){b=new Function(r(b,c));return h(b)};a.wbg.__wbindgen_object_clone_ref=function(b){return h(f[b])};a.wbg.__wbindgen_number_new=function(b){return h(b)};a.wbg.__wbg_new_525245e2b9901204=function(){return h({})};a.wbg.__wbindgen_string_new=function(b,c){b=r(b,c);return h(b)};a.wbg.__wbg_call_1084a111329e68ce=
function(){return p(function(b,c){b=f[b].call(f[c]);return h(b)},arguments)};a.wbg.__wbg_call_89af060b4e1523f2=function(){return p(function(b,c,e){b=f[b].call(f[c],f[e]);return h(b)},arguments)};a.wbg.__wbg_call_7de908392845a9a5=function(){return p(function(b,c,e,g,k){b=f[b].call(f[c],f[e],f[g],f[k]);return h(b)},arguments)};a.wbg.__wbg_valueOf_563b3487b1b116aa=function(b){return f[b].valueOf()};a.wbg.__wbg_set_eacc7d73fefaafdf=function(){return p(function(b,c,e){return Reflect.set(f[b],f[c],f[e])},
arguments)};a.wbg.__wbg_buffer_b7b08af79b0b0974=function(b){return h(f[b].buffer)};a.wbg.__wbg_new_b85e72ed1bfd57f9=function(b,c){try{var e=b;var g=c;const k=new Promise((l,ja)=>{const O=e;e=0;try{d.wasm_bindgen__convert__closures__invoke2_mut__h35729c14da098d24(O,g,h(l),h(ja))}finally{e=O}});return h(k)}finally{e=g=0}};a.wbg.__wbg_resolve_570458cb99d56a43=function(b){b=Promise.resolve(f[b]);return h(b)};a.wbg.__wbg_then_95e6edc0f89b73b1=function(b,c){b=f[b].then(f[c]);return h(b)};a.wbg.__wbg_then_876bb3c633745cc6=
function(b,c,e){b=f[b].then(f[c],f[e]);return h(b)};a.wbg.__wbg_new_ea1883e1e5e86686=function(b){b=new Uint8Array(f[b]);return h(b)};a.wbg.__wbg_length_8339fcf5d8ecd12e=function(b){return f[b].length};a.wbg.__wbg_set_d1e79e2388520f18=function(b,c,e){f[b].set(f[c],e>>>0)};a.wbg.__wbindgen_throw=function(b,c){throw Error(r(b,c));};a.wbg.__wbindgen_memory=function(){return h(d.memory)};a.wbg.__wbg_queueMicrotask_48421b3cc9052b68=function(b){return h(f[b].queueMicrotask)};a.wbg.__wbindgen_cb_drop=function(b){b=
n(b).original;return 1==b.cnt--?(b.a=0,!0):!1};a.wbg.__wbg_queueMicrotask_12a30234db4045d3=function(b){queueMicrotask(f[b])};a.wbg.__wbg_parquetchunk_new=function(b){b=F.__wrap(b);return h(b)};a.wbg.__wbindgen_bigint_from_i64=function(b){return h(b)};a.wbg.__wbg_parquetfile_new=function(b){b=P.__wrap(b);return h(b)};a.wbg.__wbg_filemetadata_new=function(b){b=y.__wrap(b);return h(b)};a.wbg.__wbindgen_closure_wrapper1401=function(b,c,e){b=ea(b,c,74,fa);return h(b)};return a}function Q(a,b){d=a.exports;
R.__wbindgen_wasm_module=b;v=x=q=null;return d}async function R(a){if(void 0!==d)return d;"undefined"!==typeof a&&Object.getPrototypeOf(a)===Object.prototype?{module_or_path:a}=a:console.warn("using deprecated parameters for the initialization function; pass a single object instead");const b=N();if("string"===typeof a||"function"===typeof Request&&a instanceof Request||"function"===typeof URL&&a instanceof URL)a=fetch(a);const {instance:c,module:e}=await ia(await a,b);return Q(c,e)}async function S(){T||=
ka();return T}async function ka(){const a=await Promise.resolve().then(()=>la);await a.default({module_or_path:da.getAssetUrl("esri/libs/parquet/pkg/arcgis_parquet_bg.wasm")});a.enableTracing();return a}let d;const f=Array(128).fill(void 0);f.push(void 0,null,!0,!1);let u=f.length;const I="undefined"!==typeof TextDecoder?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available");}};"undefined"!==typeof TextDecoder&&I.decode();let v=null;const J="undefined"===
typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(a=>{d.__wbindgen_export_0.get(a.dtor)(a.a,a.b)});let m=0;const B="undefined"!==typeof TextEncoder?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available");}},ha="function"===typeof B.encodeInto?function(a,b){return B.encodeInto(a,b)}:function(a,b){const c=B.encode(a);b.set(c);return{read:a.length,written:c.length}};let q=null,x=null;const U="undefined"===typeof FinalizationRegistry?{register:()=>
{},unregister:()=>{}}:new FinalizationRegistry(a=>d.__wbg_fieldmetadata_free(a>>>0,1));class G{static __wrap(a){a>>>=0;const b=Object.create(G.prototype);b.__wbg_ptr=a;U.register(b,b.__wbg_ptr,b);return b}__destroy_into_raw(){const a=this.__wbg_ptr;this.__wbg_ptr=0;U.unregister(this);return a}free(){const a=this.__destroy_into_raw();d.__wbg_fieldmetadata_free(a,0)}get name(){let a,b;try{const g=d.__wbindgen_add_to_stack_pointer(-16);d.fieldmetadata_name(g,this.__wbg_ptr);var c=t().getInt32(g+0,!0),
e=t().getInt32(g+4,!0);a=c;b=e;return r(c,e)}finally{d.__wbindgen_add_to_stack_pointer(16),d.__wbindgen_free(a,b,1)}}get index(){return d.fieldmetadata_index(this.__wbg_ptr)}get type(){return"esriFieldTypeSmallInteger esriFieldTypeInteger esriFieldTypeBigInteger esriFieldTypeSingle esriFieldTypeDouble esriFieldTypeLong esriFieldTypeString esriFieldTypeDate esriFieldTypeOID esriFieldTypeGeometry esriFieldTypeBlob esriFieldTypeRaster esriFieldTypeGUID esriFieldTypeGlobalID esriFieldTypeXML esriFieldTypeDateOnly esriFieldTypeTimeOnly esriFieldTypeTimestampOffset".split(" ")[d.fieldmetadata_esri_type(this.__wbg_ptr)]}}
const V="undefined"===typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(a=>d.__wbg_filemetadata_free(a>>>0,1));class y{static __wrap(a){a>>>=0;const b=Object.create(y.prototype);b.__wbg_ptr=a;V.register(b,b.__wbg_ptr,b);return b}__destroy_into_raw(){const a=this.__wbg_ptr;this.__wbg_ptr=0;V.unregister(this);return a}free(){const a=this.__destroy_into_raw();d.__wbg_filemetadata_free(a,0)}version(){return d.filemetadata_version(this.__wbg_ptr)}numRows(){return d.filemetadata_numRows(this.__wbg_ptr)>>>
0}numFields(){return d.filemetadata_numFields(this.__wbg_ptr)>>>0}keyValueMetadata(a){try{const e=d.__wbindgen_add_to_stack_pointer(-16),g=w(a,d.__wbindgen_malloc,d.__wbindgen_realloc);d.filemetadata_keyValueMetadata(e,this.__wbg_ptr,g,m);var b=t().getInt32(e+0,!0),c=t().getInt32(e+4,!0);let k;0!==b&&(k=r(b,c).slice(),d.__wbindgen_free(b,1*c,1));return k}finally{d.__wbindgen_add_to_stack_pointer(16)}}getFieldIndex(a){a=w(a,d.__wbindgen_malloc,d.__wbindgen_realloc);a=d.filemetadata_getFieldIndex(this.__wbg_ptr,
a,m);return 16777215===a?void 0:a}getFieldByIndex(a){a=d.filemetadata_getFieldByIndex(this.__wbg_ptr,a);return 0===a?void 0:G.__wrap(a)}}const W="undefined"===typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(a=>d.__wbg_geometryinfodescriptor_free(a>>>0,1));class z{static __wrap(a){a>>>=0;const b=Object.create(z.prototype);b.__wbg_ptr=a;W.register(b,b.__wbg_ptr,b);return b}__destroy_into_raw(){const a=this.__wbg_ptr;this.__wbg_ptr=0;W.unregister(this);return a}free(){const a=
this.__destroy_into_raw();d.__wbg_geometryinfodescriptor_free(a,0)}get wkbIndex(){const a=d.__wbg_get_geometryinfodescriptor_wkbIndex(this.__wbg_ptr);return 16777215===a?void 0:a}set wkbIndex(a){d.__wbg_set_geometryinfodescriptor_wkbIndex(this.__wbg_ptr,void 0===a||null===a?16777215:a)}get lngIndex(){const a=d.__wbg_get_geometryinfodescriptor_lngIndex(this.__wbg_ptr);return 16777215===a?void 0:a}set lngIndex(a){d.__wbg_set_geometryinfodescriptor_lngIndex(this.__wbg_ptr,void 0===a||null===a?16777215:
a)}get latIndex(){const a=d.__wbg_get_geometryinfodescriptor_latIndex(this.__wbg_ptr);return 16777215===a?void 0:a}set latIndex(a){d.__wbg_set_geometryinfodescriptor_latIndex(this.__wbg_ptr,void 0===a||null===a?16777215:a)}static new(){const a=d.geometryinfodescriptor_new();return z.__wrap(a)}}const X="undefined"===typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(a=>d.__wbg_parquetchunk_free(a>>>0,1));class F{static __wrap(a){a>>>=0;const b=Object.create(F.prototype);
b.__wbg_ptr=a;X.register(b,b.__wbg_ptr,b);return b}__destroy_into_raw(){const a=this.__wbg_ptr;this.__wbg_ptr=0;X.unregister(this);return a}free(){const a=this.__destroy_into_raw();d.__wbg_parquetchunk_free(a,0)}size(){return d.parquetchunk_size(this.__wbg_ptr)>>>0}hasField(a){return 0!==d.parquetchunk_hasField(this.__wbg_ptr,a)}readX(a){return d.parquetchunk_readX(this.__wbg_ptr,a)}readY(a){return d.parquetchunk_readY(this.__wbg_ptr,a)}readAttributes(a){a=d.parquetchunk_readAttributes(this.__wbg_ptr,
a);return n(a)}readAttribute(a,b){a=d.parquetchunk_readAttribute(this.__wbg_ptr,a,b);return n(a)}}const Y="undefined"===typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(a=>d.__wbg_parquetfile_free(a>>>0,1));let P=class a{static __wrap(b){b>>>=0;const c=Object.create(a.prototype);c.__wbg_ptr=b;Y.register(c,c.__wbg_ptr,c);return c}__destroy_into_raw(){const b=this.__wbg_ptr;this.__wbg_ptr=0;Y.unregister(this);return b}free(){const b=this.__destroy_into_raw();
d.__wbg_parquetfile_free(b,0)}metadata(){const b=d.parquetfile_metadata(this.__wbg_ptr);return y.__wrap(b)}readChunksWithCallback(b,c){b=K(b,d.__wbindgen_malloc);c=d.parquetfile_readChunksWithCallback(this.__wbg_ptr,b,m,h(c));return n(c)}updateChunks(b){b=K(b,d.__wbindgen_malloc);b=d.parquetfile_updateChunks(this.__wbg_ptr,b,m);return n(b)}};const Z="undefined"===typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(a=>d.__wbg_rangeproviderjs_free(a>>>0,1));class C{static __wrap(a){a>>>=
0;const b=Object.create(C.prototype);b.__wbg_ptr=a;Z.register(b,b.__wbg_ptr,b);return b}__destroy_into_raw(){const a=this.__wbg_ptr;this.__wbg_ptr=0;Z.unregister(this);return a}free(){const a=this.__destroy_into_raw();d.__wbg_rangeproviderjs_free(a,0)}static new(a,b){a=d.rangeproviderjs_new(h(a),h(b));return C.__wrap(a)}static withFetch(){const a=d.rangeproviderjs_withFetch();return C.__wrap(a)}}const la=Object.freeze(Object.defineProperty({__proto__:null,FieldMetadata:G,FileMetadata:y,GeometryInfoDescriptor:z,
ParquetChunk:F,ParquetFile:P,RangeProviderJs:C,default:R,enableTracing:function(){d.enableTracing()},initSync:function(a){if(void 0!==d)return d;"undefined"!==typeof a&&Object.getPrototypeOf(a)===Object.prototype?{module:a}=a:console.warn("using deprecated parameters for `initSync()`; pass a single object instead");var b=N();a instanceof WebAssembly.Module||(a=new WebAssembly.Module(a));b=new WebAssembly.Instance(a,b);return Q(b,a)},readFile:function(a,b,c,e,g){a=w(a,d.__wbindgen_malloc,d.__wbindgen_realloc);
const k=m;M(e,y);e=e.__destroy_into_raw();M(g,z);g=g.__destroy_into_raw();b=d.readFile(a,k,h(b),h(c),e,g);return n(b)},readMetadata:L},Symbol.toStringTag,{value:"Module"}));let T=null;const aa=a=>async function(b,c,e){const g=a();({data:b}=await H(b,{responseType:"array-buffer",query:g,headers:{range:`bytes=${c}-${e}`}}));return b},ba=a=>async function(b){const c=a();({data:b}=await H(b,{responseType:"native",method:"head",query:c}));b=b.headers.get("Content-Length");if(null==b)throw Error("Unable to parse content length");
return parseInt(b,10)};class D{static async create(a,b){a=await (await S()).readMetadata(a,aa(b),ba(b));return D.fromFileMetadata(a)}static fromFileMetadata(a){const b=[];for(let c=0;c<a.numFields();c++){const e=a.getFieldByIndex(c);b.push({name:e.name,type:e.type,alias:e.name,index:e.index});e.free()}return new D(a,b)}constructor(a,b){this._inner=a;this.fields=b}destroy(){this._inner.free()}[Symbol.dispose](){this.destroy()}get size(){return this._inner.numRows()}getFieldIndex(a){return this._inner.getFieldIndex(a)}tryReadGeoMetadata(){const a=
this._inner.keyValueMetadata("geo");return null==a?null:JSON.parse(a)}}class ca{static async create(a,b){const c=await S(),e=aa(b.getCustomParameters),g=ba(b.getCustomParameters),k=await L(a,e,g);({geometryInfo:b}=b);const l=z.new();"location"===b.type?(l.latIndex=k.getFieldIndex(b.latitudeFieldName),l.lngIndex=k.getFieldIndex(b.longitudeFieldName)):l.wkbIndex=k.getFieldIndex(b.primaryFieldName);a=await c.readFile(a,e,g,k,l);return new ca(a,D.fromFileMetadata(a.metadata()))}constructor(a,b){this.inner=
a;this.metadata=b}destroy(){this.inner.free();this.metadata.destroy()}[Symbol.dispose](){this.destroy()}}E.ParquetFile=ca;E.ParquetMetadata=D;Object.defineProperty(E,Symbol.toStringTag,{value:"Module"})});