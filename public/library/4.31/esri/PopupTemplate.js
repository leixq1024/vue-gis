// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.31/esri/copyright.txt for details.
//>>built
define("./chunks/tslib.es6 ./core/Clonable ./core/Collection ./core/JSONSupport ./core/lang ./core/Logger ./core/promiseUtils ./core/accessorSupport/decorators/property ./core/accessorSupport/decorators/cast ./core/accessorSupport/decorators/reader ./core/accessorSupport/decorators/subclass ./core/accessorSupport/decorators/writer ./core/accessorSupport/ensureType ./layers/support/fieldUtils ./popup/content ./popup/ExpressionInfo ./popup/FieldInfo ./popup/LayerOptions ./popup/RelatedRecordsInfo ./popup/content/support/mediaInfoTypes ./support/actions/ActionBase ./support/actions/ActionButton ./support/actions/ActionToggle ./popup/content/MediaContent ./popup/content/TextContent ./popup/content/AttachmentsContent ./popup/content/FieldsContent ./popup/content/ExpressionContent ./popup/content/RelationshipContent ./popup/content/UtilityNetworkAssociationsContent ./popup/content/Content ./popup/content/CustomContent".split(" "),
function(h,f,m,F,y,G,H,l,I,J,K,n,L,q,z,M,N,O,A,B,r,P,Q,t,u,v,w,C,x,D,R,S){r=m.ofType({key:"type",defaultKeyValue:"button",base:r,typeMap:{button:P,toggle:Q}});const T={base:R,key:"type",typeMap:{media:t,custom:S,text:u,attachments:v,fields:w,expression:C,relationship:x,utilityNetworkAssociations:D}},E=new Set("attachments fields media text expression relationship".split(" ")),U=new Set([...E,"utility-network-associations"]);f=class extends f.ClonableMixin(F.JSONSupport){constructor(){super(...arguments);
this.actions=null;this.content="";this.layerOptions=this.fieldInfos=this.expressionInfos=null;this.lastEditInfoEnabled=!0;this.outFields=null;this.returnGeometry=this.overwriteActions=!1;this.title=""}castContent(a){if(Array.isArray(a))return a.map(b=>L.ensureOneOfType(T,b));if("string"===typeof a||"function"===typeof a||a instanceof HTMLElement||H.isPromiseLike(a))return a;G.getLogger(this).error("content error","unsupported content value",{value:a});return null}readContent(a,b){({popupElements:a}=
b);return Array.isArray(a)&&0<a.length?this._readPopupInfoElements(b.description,b.mediaInfos,a):this._readPopupInfo(b)}writeWebSceneContent(a,b,c,d){this._writePopupTemplateContent(a,b,d)}writeWebMapContent(a,b,c,d){this._writePopupTemplateContent(a,b,d)}writeFieldInfos(a,b,c,d){({content:c}=this);c=Array.isArray(c)?c:null;if(a){const g=c?c.filter(k=>"fields"===k.type):[],e=g.length&&g.every(k=>k.fieldInfos?.length);b.fieldInfos=a.filter(Boolean).map(k=>{k=k.toJSON(d);e&&(k.visible=!1);return k})}if(c)for(const g of c)"fields"===
g.type&&this._writeFieldsContent(g,b)}writeLayerOptions(a,b,c,d){b[c]=!a||null===a.showNoDataRecords&&null===a.returnTopmostRaster?null:a.toJSON(d)}writeTitle(a,b){b.title=a||""}async collectRequiredFields(a,b){const c=this.expressionInfos||[];await this._collectExpressionInfoFields(a,b,[...c,...this._getContentExpressionInfos(this.content,c)]);q.collectFields(a,b,[...(this.outFields||[]),...this._getActionsFields(this.actions),...this._getTitleFields(this.title),...this._getContentFields(this.content)])}async getRequiredFields(a){const b=
new Set;await this.collectRequiredFields(b,a);return[...b].sort()}_writePopupTemplateContent(a,b,c){"string"===typeof a?b.description=a:Array.isArray(a)&&(b.popupElements=a.filter(d=>"web-scene"===c?.origin?E.has(d.type):U.has(d.type)).map(d=>d?.toJSON(c)),b.popupElements.forEach(d=>{"attachments"===d.type?this._writeAttachmentContent(b):"media"===d.type?this._writeMediaContent(d,b):"text"===d.type?this._writeTextContent(d,b):"relationship"===d.type&&this._writeRelationshipContent(d,b)}))}_writeFieldsContent(a,
b){Array.isArray(a.fieldInfos)&&a.fieldInfos.length&&(a=y.clone(a.fieldInfos),Array.isArray(b.fieldInfos)?a.forEach(c=>{const d=b.fieldInfos.find(g=>g.fieldName?.toLowerCase()===c.fieldName?.toLowerCase());d?d.visible=!0:b.fieldInfos.push(c)}):b.fieldInfos=a)}_writeAttachmentContent(a){a.showAttachments||(a.showAttachments=!0)}_writeRelationshipContent(a,b){var c=a.orderByFields?.map(d=>this._toFieldOrderJSON(d,a.relationshipId))||[];c=[...(b.relatedRecordsInfo?.orderByFields||[]),...c];b.relatedRecordsInfo=
{showRelatedRecords:!0,...(c?.length&&{orderByFields:c})}}_writeTextContent(a,b){!b.description&&a.text&&(b.description=a.text)}_writeMediaContent(a,b){Array.isArray(a.mediaInfos)&&a.mediaInfos.length&&(a=y.clone(a.mediaInfos),Array.isArray(b.mediaInfos)?b.mediaInfos=[...b.mediaInfos,...a]:b.mediaInfos=a)}_readPopupInfoElements(a,b,c){var d=!1,g=!1;return c.map(e=>{if("media"===e.type)return e.mediaInfos||!b||g||(e.mediaInfos=b,g=!0),t.fromJSON(e);if("text"===e.type)return e.text||!a||d||(e.text=
a,d=!0),u.fromJSON(e);if("attachments"===e.type)return v.fromJSON(e);if("fields"===e.type)return w.fromJSON(e);if("expression"===e.type)return C.fromJSON(e);if("relationship"===e.type)return x.fromJSON(e);if("utilityNetworkAssociations"===e.type)return D.fromJSON(e)}).filter(Boolean)}_toRelationshipContent(a){const {field:b,order:c}=a;if(!b?.startsWith("relationships/"))return null;var d=b.replace("relationships/","").split("/");if(2!==d.length)return null;a=parseInt(d[0],10);d=d[1];return"number"===
typeof a&&d?x.fromJSON({relationshipId:a,orderByFields:[{field:d,order:c}]}):null}_toFieldOrderJSON(a,b){const {order:c,field:d}=a;return{field:`${"relationships/"}${b}/${d}`,order:c}}_readPopupInfo({description:a,mediaInfos:b,showAttachments:c,relatedRecordsInfo:d={showRelatedRecords:!1}}){const g=[];a?g.push(new u({text:a})):g.push(new w);Array.isArray(b)&&b.length&&g.push(t.fromJSON({mediaInfos:b}));c&&g.push(v.fromJSON({displayType:"auto"}));const {showRelatedRecords:e,orderByFields:k}=d;e&&k?.length&&
k.forEach(p=>{(p=this._toRelationshipContent(p))&&g.push(p)});return g.length?g:a}_getContentElementFields(a){var b=a?.type;return"attachments"===b?[...this._extractFieldNames(a.title),...this._extractFieldNames(a.description)]:"custom"===b?a.outFields||[]:"fields"===b?[...this._extractFieldNames(a.title),...this._extractFieldNames(a.description),...this._getFieldInfoFields(a.fieldInfos??this.fieldInfos)]:"media"===b?(b=a.mediaInfos||[],[...this._extractFieldNames(a.title),...this._extractFieldNames(a.description),
...b.reduce((c,d)=>[...c,...this._getMediaInfoFields(d)],[])]):"text"===b?this._extractFieldNames(a.text):"relationship"===b||"utility-network-associations"===b?[...this._extractFieldNames(a.title),...this._extractFieldNames(a.description)]:[]}_getMediaInfoFields(a){const {caption:b,title:c,value:d}=a,{fields:g,normalizeField:e,tooltipField:k,sourceURL:p,linkURL:V}=d||{};a=[...this._extractFieldNames(c),...this._extractFieldNames(b),...this._extractFieldNames(p),...this._extractFieldNames(V),...(g??
[])];e&&a.push(e);k&&a.push(k);return a}_getContentExpressionInfos(a,b){return Array.isArray(a)?a.reduce((c,d)=>[...c,...("expression"===d.type&&d.expressionInfo?[d.expressionInfo]:[])],b):[]}_getContentFields(a){return"string"===typeof a?this._extractFieldNames(a):Array.isArray(a)?a.reduce((b,c)=>[...b,...this._getContentElementFields(c)],[]):[]}async _collectExpressionInfoFields(a,b,c){c&&await Promise.all(c.map(d=>q.collectArcadeFieldNames(a,b,d.expression)))}_getFieldInfoFields(a){return a?a.filter(({fieldName:b,
visible:c})=>(void 0===c||!!c)&&!!b&&!b.startsWith("relationships/")&&!b.startsWith("expression/")).map(b=>b.fieldName):[]}_getActionsFields(a){return a?a.toArray().reduce((b,c)=>[...b,...this._getActionFields(c)],[]):[]}_getActionFields(a){const {className:b,title:c,type:d}=a;a="button"===d||"toggle"===d?a.image:"";return[...this._extractFieldNames(c),...this._extractFieldNames(b),...this._extractFieldNames(a)]}_getTitleFields(a){return"string"===typeof a?this._extractFieldNames(a):[]}_extractFieldNames(a){return q.extractSubstitutionTemplatesFromString(a).filter(b=>
!(0===b.indexOf("relationships/")||0===b.indexOf("expression/")))}};h.__decorate([l.property({type:r})],f.prototype,"actions",void 0);h.__decorate([l.property()],f.prototype,"content",void 0);h.__decorate([I.cast("content")],f.prototype,"castContent",null);h.__decorate([J.reader("content","description fieldInfos popupElements mediaInfos showAttachments relatedRecordsInfo".split(" "))],f.prototype,"readContent",null);h.__decorate([n.writer("web-scene","content",{popupElements:{type:m.ofType(z.persistableWebSceneTypes)},
showAttachments:{type:Boolean},mediaInfos:{type:m.ofType(B.types)},description:{type:String},relatedRecordsInfo:{type:A}})],f.prototype,"writeWebSceneContent",null);h.__decorate([n.writer("content",{popupElements:{type:m.ofType(z.persistableTypes)},showAttachments:{type:Boolean},mediaInfos:{type:m.ofType(B.types)},description:{type:String},relatedRecordsInfo:{type:A}})],f.prototype,"writeWebMapContent",null);h.__decorate([l.property({type:[M],json:{write:!0}})],f.prototype,"expressionInfos",void 0);
h.__decorate([l.property({type:[N]})],f.prototype,"fieldInfos",void 0);h.__decorate([n.writer("fieldInfos")],f.prototype,"writeFieldInfos",null);h.__decorate([l.property({type:O})],f.prototype,"layerOptions",void 0);h.__decorate([n.writer("layerOptions")],f.prototype,"writeLayerOptions",null);h.__decorate([l.property({type:Boolean,json:{read:{source:"showLastEditInfo"},write:{target:"showLastEditInfo"},default:!0}})],f.prototype,"lastEditInfoEnabled",void 0);h.__decorate([l.property()],f.prototype,
"outFields",void 0);h.__decorate([l.property()],f.prototype,"overwriteActions",void 0);h.__decorate([l.property()],f.prototype,"returnGeometry",void 0);h.__decorate([l.property({json:{type:String}})],f.prototype,"title",void 0);h.__decorate([n.writer("title")],f.prototype,"writeTitle",null);return f=h.__decorate([K.subclass("esri.PopupTemplate")],f)});