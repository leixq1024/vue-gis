// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.31/esri/copyright.txt for details.
//>>built
define("require ../../../chunks/tslib.es6 ../../../core/events ../../../core/mathUtils ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ../../Widget ../../../chunks/constants ./css ./Label ./LevelItem ../../../chunks/componentsUtils ../../support/globalCss ../../support/widgetUtils ../../support/jsxFactory".split(" "),function(v,e,p,t,k,f,d,C,D,w,x,h,l,y,z,
A,B,E,q){function u(a){return q.tsx("calcite-action",{appearance:"transparent",class:a.className,disabled:a.disabled,icon:a.icon,key:a.className,onclick:a.onClick,scale:"s",text:a.text,textEnabled:!1,title:a.text})}const r={selectLevel:"selectLevel",clearLevel:"clearLevel",nextLevel:"nextLevel",previousLevel:"previousLevel",currentLevel:"{{value}}"};d=class extends x{constructor(a,b){super(a,b);this._levelHandlesKey="levelHandles";this._levelEventHandlesKey="levelEventHandles";this._levelWidgets=
[];this._labelWidget=new y.Label({onClear:()=>this.vm.clear()});this._hoveredLevel=null;this._expandedLevelsHeight=void 0;this._normalizedPointerPosition=0;this._hovering=!1;this._levelsContainer=this._containerPosTop=null;this._onKeyDown=c=>{switch(c.key){case "ArrowDown":case "ArrowLeft":c.preventDefault();c.stopPropagation();this.vm.previous();this._focusCurrentLevel();break;case "ArrowUp":case "ArrowRight":c.preventDefault(),c.stopPropagation(),this.vm.next(),this._focusCurrentLevel()}};this._onFocus=
()=>{this._hoveredLevel=0<this._levels.length?this._levels[0]:null};this._onArrowUpClick=()=>{this.vm.next()};this._onArrowDownClick=()=>{this.vm.previous()};this._onPointerUp=()=>{window.getSelection()?.removeAllRanges();if(null!=this._hoveredLevel){var {vm:c}=this;c.enabled&&this._hoveredLevel===c.value?c.clear():c.select(this._hoveredLevel)}};this._onPointerEnter=()=>{this._hovering||null==this._levelsContainer||(this._hovering=!0,this._containerPosTop=this._levelsContainer.getBoundingClientRect().top??
0)};this._onPointerLeave=()=>{this._hovering&&(this._normalizedPointerPosition=0,this._hoveredLevel=null,this._hovering=!1)};this._onPointerMove=c=>{if(!this._hovering)return!1;window.getSelection()?.removeAllRanges();if(null!=this._containerPosTop){const g=this._levelHeight/2;c=(c.clientY-(this._containerPosTop+h.levelsPadding*h.levelsMarginFactor+this._expandedLevelsMargin+g))/(this._levelsHeight-g);this._normalizedPointerPosition=c+=h.levelsPointerAdjustment}return!1}}loadDependencies(){return A.loadCalciteComponents({action:()=>
new Promise((a,b)=>v(["../../../chunks/calcite-action"],a,b))})}postInitialize(){this.addHandles([k.watch(()=>this._levelsContainer,()=>this._onContainerChange(),k.initial),k.watch(()=>this._levels,()=>this._createLevelWidgets(),k.initial),k.watch(()=>this.messages,()=>{this._labelWidget.messages=this.messages??r},k.initial)])}destroy(){this._levelWidgets.forEach(a=>a.destroy());this._labelWidget.destroy()}get _levels(){return this.vm.allowedValues}get _numLevels(){return this._levels.length}get _levelsHeight(){return Math.round(this._levelHeight*
this._numLevels)}get _expandedLevelsMargin(){return Math.round(((this._expandedLevelsHeight??0)-this._levelsHeight)/2)}get _levelWidth(){const {levelWidthNominator:a,levelWidthConstant:b}=h.constants;return Math.round(t.clamp(a/Math.sqrt(this._numLevels)+b,h.levelWidthMin,h.levelWidthMax))}get _levelHeight(){const a=h.levelHeightDefault;return Math.round(t.clamp(2*a/Math.sqrt(this._numLevels),2,a))}get _gaussianFactor(){const a=this._numLevels;return a/Math.log(h.alphaLevelDependencyFactor*a)*h.alphaSpreadFactor}get _levelClosestToPointer(){if(!this._hovering)return null;
const a=this._numLevels-1,b=this._normalizedPointerPosition;return 0<=a&&null!=b?this._levels[Math.round((1-b)*a)]:null}render(){const a=this._levelWidgets.length,b=1<a?this._levelWidgets.map(n=>n.render()):null;var c=h.levelsPadding*h.levelsMarginFactor;const g=-c/h.levelsMarginFactor,m=this._levelsHeight;c=m+2*c;return q.tsx("div",{class:this.classes(B.globalCss.widget,l.css.container,{[l.css.animateLevel]:!this._hovering,[l.css.noLevel]:2>a}),key:this,onkeydown:this._onKeyDown},this._renderLabelContainer(),
q.tsx("div",{afterCreate:n=>this._levelsContainer=n,class:l.css.levelsContainer,"data-node-ref":"",onfocus:this._onFocus,styles:{height:`${c}px`,marginBlockStart:`${g}px`,marginBlockEnd:`${g}px`}},q.tsx("div",{class:l.css.innerLevelsContainer,styles:{height:`${m}px`,margin:"0",marginBlockStart:`${h.levelsPadding-this._expandedLevelsMargin}px`}},b)))}_renderLabelContainer(){const {hasPrevious:a,hasNext:b}=this.vm,c=this.messages??r,g=c.previousLevel;return q.tsx("div",{class:l.css.labelContainer,tabIndex:0},
u({className:l.css.arrowUp,disabled:!b,icon:"chevron-up",onClick:this._onArrowUpClick,text:c.nextLevel}),this._labelWidget.render(),u({className:l.css.arrowDown,disabled:!a,icon:"chevron-down",onClick:this._onArrowDownClick,text:g}))}_updateComponents(){const a=this.messages??r,b=this.vm.enabled?this.vm.value:null,c=null!=this._hoveredLevel?this._hoveredLevel:b;this._levelWidgets.forEach(g=>{const m=this.vm.getValueLabel(g.level);g.label=null!=m?m:a.currentLevel?.replace("{{level}}",String(g.level));
g.active=g.level===b;g.hovering=g.level===this._hoveredLevel});this._labelWidget.level=c;this._labelWidget.active=c===b;this._labelWidget.hovering=null!=this._hoveredLevel}_createLevelWidgets(){this._levelWidgets.forEach(a=>a.destroy());this._levelWidgets=this._levels.map(a=>new z.LevelItem({level:a,onSelect:()=>this._onLevelToggle(a)}));this.removeHandles(this._levelHandlesKey);this.addHandles([k.watch(()=>{const {vm:a}=this;return[this.messages,a?.value,a?.enabled,this._hoveredLevel,this._hovering]},
()=>this._updateComponents(),k.initial),k.watch(()=>[this._normalizedPointerPosition,this._hovering],()=>this._onPointerPositionChange(),k.initial),k.watch(()=>this._levelWidth,a=>this._levelWidgets.forEach(b=>b.width=a),k.initial)],this._levelHandlesKey)}_onContainerChange(){const a=this._levelsContainer;null!=a&&(this.removeHandles(this._levelEventHandlesKey),this.addHandles([p.on(a,"pointerenter",this._onPointerEnter),p.on(a,"pointerover",this._onPointerEnter),p.on(a,"pointerleave",this._onPointerLeave),
p.on(a,"pointerup",this._onPointerUp),p.on(a,"pointermove",this._onPointerMove)],this._levelEventHandlesKey))}_focusCurrentLevel(){this._levelWidgets.find(a=>a.level===this.vm.value)?.focus()}_onLevelToggle(a){const {vm:b}=this;b.enabled&&b.value===a?b.clear():b.select(a)}_onPointerPositionChange(){let a=0;this._levelWidgets.forEach((c,g)=>{const {width:m,height:n}=this._getLevelWidgetSize(g);c.height=n;c.width=m;a+=n});this._hoveredLevel=this._levelClosestToPointer;const b=this._expandedLevelsHeight;
if(null==b||30<Math.abs(b-a))this._expandedLevelsHeight=a}_getLevelWidgetSize(a){const b={width:this._levelWidth,height:this._levelHeight};this._hovering&&(a=this._getGaussianFactor(a,this._normalizedPointerPosition),b.width+=h.levelHoveredExtraWidth*a,b.height+=h.levelHoveredExtraHeight*a);return b}_getGaussianFactor(a,b){const c=this._numLevels-1;return Math.exp(-((this._gaussianFactor*((c-a)/c-b))**2))}};e.__decorate([f.property()],d.prototype,"vm",void 0);e.__decorate([f.property()],d.prototype,
"messages",void 0);e.__decorate([f.property()],d.prototype,"_levelWidgets",void 0);e.__decorate([f.property()],d.prototype,"_labelWidget",void 0);e.__decorate([f.property()],d.prototype,"_hoveredLevel",void 0);e.__decorate([f.property()],d.prototype,"_levels",null);e.__decorate([f.property()],d.prototype,"_numLevels",null);e.__decorate([f.property({readOnly:!0})],d.prototype,"_levelsHeight",null);e.__decorate([f.property()],d.prototype,"_expandedLevelsHeight",void 0);e.__decorate([f.property({readOnly:!0})],
d.prototype,"_expandedLevelsMargin",null);e.__decorate([f.property({readOnly:!0})],d.prototype,"_levelWidth",null);e.__decorate([f.property({readOnly:!0})],d.prototype,"_levelHeight",null);e.__decorate([f.property({readOnly:!0})],d.prototype,"_gaussianFactor",null);e.__decorate([f.property({readOnly:!0})],d.prototype,"_levelClosestToPointer",null);e.__decorate([f.property({type:Number,range:{min:0,max:1}})],d.prototype,"_normalizedPointerPosition",void 0);e.__decorate([f.property()],d.prototype,"_hovering",
void 0);e.__decorate([f.property()],d.prototype,"_containerPosTop",void 0);e.__decorate([f.property()],d.prototype,"_levelsContainer",void 0);return d=e.__decorate([w.subclass("esri.widgets.BuildingExplorer.BuildingLevelPicker.BuildingLevelPicker")],d)});