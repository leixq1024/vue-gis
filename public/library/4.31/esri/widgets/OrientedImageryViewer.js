// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.31/esri/copyright.txt for details.
//>>built
define("require ../chunks/tslib.es6 ../intl ../core/a11yUtils ../core/deprecate ../core/Logger ../core/mathUtils ../core/reactiveUtils ../core/accessorSupport/decorators/property ../core/has ../core/RandomLCG ../core/accessorSupport/decorators/subclass ../layers/orientedImagery/transformations/utils ../layers/support/rasterDatasets/RasterFactory ./Widget ./OrientedImageryViewer/arcUtils ./OrientedImageryViewer/constants ./OrientedImageryViewer/css ./OrientedImageryViewer/OrientedImageryViewerViewModel ./OrientedImageryViewer/OrientedImageryViewerVisibleElements ./OrientedImageryViewer/components/ImageOverlays ../chunks/componentsUtils ./support/globalCss ./support/widgetUtils ./support/decorators/messageBundle ./support/jsxFactory ../intl/substitute".split(" "),
function(v,k,h,J,F,A,K,q,l,Z,aa,L,B,M,N,O,n,e,G,H,P,Q,R,ba,I,d,S){h=class extends N{constructor(a,c){super(a,c);this.navigationToolActive=this.imageOverlaysOpened=this.imageEnhancementToolActive=this.galleryOpened=!1;this.viewModel=new G;this.messagesCommon=null;this.visibleElements=new H;this._navigationToolExpanded=!1;this._navigationTool=null;this._imageOverlays=new P;this._warningTitleElement=null;this._actionItems=new Map;this._galleryController=new AbortController;this._galleryObserver=new IntersectionObserver(this._lazyLoadImage.bind(this));
this._createAndAddOverlayLayerVisibilityHandle=b=>{this.addHandles(q.watch(()=>b.visible,()=>{this.viewModel.toggleOverlayMapFeatures(b.id,b.visible)}),`${"overlayed"}-${b.id}`)};this._createHandlesForOverlayMapFeatures=()=>{this.viewModel.removeAllOverlayMapFeatures();const {selectedItems:b}=this._imageOverlays.layerList;b.forEach(this._handleOverlayLayerSelect)};this._createOverlayLayersListChangeHandle=()=>{this.addHandles(this._imageOverlays.layerList.selectedItems.on("change",({added:b,removed:f})=>
{b.forEach(this._handleOverlayLayerSelect);f.forEach(this._handleOverlayLayerDeselect)}))};this._handleOverlayLayerDeselect=b=>{b=b.layer;this.viewModel.removeOverlayedGraphicsOnImage(`${b.id}`);this.removeHandles(`${"overlayed"}-${b.id}`)};this._handleOverlayLayerSelect=b=>{b=b.layer;this.viewModel.overlayMapFeatures(b,this._imageOverlays.showMapFeatures);this._createAndAddOverlayLayerVisibilityHandle(b)};this._highlight=b=>{(b=b.target?.dataset.objectid)&&this.viewModel.highlight(b)};this._removeHighlight=
()=>this.viewModel.removeHighlight();this._scaleNavigationTool=()=>{this._navigationToolExpanded=!this._navigationToolExpanded};this._toggleImageAttributes=()=>{this.viewModel.toggleImageAttributes()};this._loadImageFromGallery=this._loadImageFromGallery.bind(this);this._registerGalleryItem=this._registerGalleryItem.bind(this);this._unregisterGalleryItem=this._unregisterGalleryItem.bind(this);this._renderViewerContainer=this._renderViewerContainer.bind(this);this.loadImageFromSource=this.loadImageFromSource.bind(this);
this.updateSuitabilities=this.updateSuitabilities.bind(this)}initialize(){this._createOverlayLayersListChangeHandle();this.addHandles([q.watch(()=>[this.viewModel?.bestFeatureAngle,this._navigationTool],([,a])=>{a&&this._updateNavigationTool(a)},q.initial),q.watch(()=>this.currentCoverageVisible,a=>this._onCurrentCoverageVisibilityChange(a)),q.watch(()=>this.isAdditionalCoverageVisible,a=>this._onAdditionalCoverageVisibilityChange(a)),q.watch(()=>this.isAdditionalPointSourcesVisible,a=>this._onAdditionalCameraLocationsVisibility(a)),
q.watch(()=>this.viewModel,()=>this._imageOverlays.viewModel=this.viewModel,q.syncAndInitial),q.watch(()=>this.messages,()=>this._imageOverlays.messages=this.messages,q.syncAndInitial),q.watch(()=>[this.currentBestFeature,this._imageOverlays.showCameraLocations,this.viewModel.state],([,a,c])=>{"image-loaded"===c&&this.viewModel.overlayCameraLocations(a)},q.syncAndInitial),q.watch(()=>[this.currentBestFeature,this._imageOverlays.showMapFeatures,this.viewModel.state],(a,c)=>{c?.[1]!==a[1]&&this.viewModel.toggleAllOverlayMapFeatures(a[1]);
a[0]&&a[0]!==c?.[0]&&q.whenOnce(()=>"image-loaded"===this.viewModel.state).then(this._createHandlesForOverlayMapFeatures)},q.initial)])}loadDependencies(){return Q.loadCalciteComponents({"action-bar":()=>new Promise((a,c)=>v(["../chunks/calcite-action-bar"],a,c)),"action-group":()=>new Promise((a,c)=>v(["../chunks/calcite-action-group"],a,c)),action:()=>new Promise((a,c)=>v(["../chunks/calcite-action"],a,c)),label:()=>new Promise((a,c)=>v(["../chunks/calcite-label"],a,c)),notice:()=>new Promise((a,
c)=>v(["../chunks/calcite-notice"],a,c)),panel:()=>new Promise((a,c)=>v(["../chunks/calcite-panel"],a,c)),slider:()=>new Promise((a,c)=>v(["../chunks/calcite-slider"],a,c)),tooltip:()=>new Promise((a,c)=>v(["../chunks/calcite-tooltip"],a,c))})}destroy(){this._galleryController.abort();this._galleryObserver.disconnect()}get activeLayer(){F.deprecatedProperty(A.getLogger(this),"activeLayer",{replacement:"layer"});return this.layer}set activeLayer(a){F.deprecatedProperty(A.getLogger(this),"activeLayer",
{replacement:"layer"});this.layer=a}get currentBestFeature(){return this.viewModel.currentBestFeature}set currentBestFeature(a){this.viewModel.currentBestFeature=a}get currentCoverageVisible(){return this.viewModel.currentCoverageVisible}set currentCoverageVisible(a){this.viewModel.currentCoverageVisible=a}get disabled(){return this.viewModel.disabled}set disabled(a){this.viewModel.disabled=a}get displayMessage(){return this.viewModel.displayMessage}get features(){return this.viewModel.features}get imagePointsInView(){return this.viewModel.imagePointsInView}get icon(){return"oriented-imagery-widget"}set icon(a){this._overrideIfSome("icon",
a)}get imageGalleryEnabled(){return this.viewModel.imageGalleryEnabled}get invalidCameraHeading(){return this.viewModel.invalidCameraHeading}get isAdditionalCoverageVisible(){return this.viewModel.isAdditionalCoverageVisible}set isAdditionalCoverageVisible(a){this.viewModel.isAdditionalCoverageVisible=a}get isAdditionalPointSourcesVisible(){return this.viewModel.isAdditionalPointSourcesVisible}set isAdditionalPointSourcesVisible(a){this.viewModel.isAdditionalPointSourcesVisible=a}get mapImageConversionToolState(){return this.viewModel.mapImageConversionToolState}set mapImageConversionToolState(a){this.viewModel.mapImageConversionToolState=
a}get layer(){return this.viewModel.layer}set layer(a){this.viewModel.layer=a}get popupEnabled(){const {popupEnabled:a,state:c}=this.viewModel;return"image-loaded"===c&&a}get referencePoint(){return this.viewModel.referencePoint??null}get view(){return this.viewModel.view}set view(a){this.viewModel.view=a}set determineWorkflowForFeature(a){this.viewModel.determineWorkflowForFeature=a}get determineWorkflowForFeature(){return this.viewModel.determineWorkflowForFeature}set updateFootprint(a){this.viewModel.updateFootprint=
a}get updateFootprint(){return this.viewModel.updateFootprint}async _getThumbnailPixelBlockInternal(a,c){const {level:b,offset:f,size:g}=this._getMaxLevelRasterParameters(a);try{const {pixelBlock:m}=await a.fetchRawPixels(b,f,g,c);return m}catch(m){A.getLogger(this).warn("failed to create canvas with pixel data",m)}return null}_getMaxLevelRasterParameters(a){const {storageInfo:c,width:b,height:f}=a.rasterInfo,{maximumPyramidLevel:g,pyramidScalingFactor:m}=c;a=m??2;return{level:g,offset:{x:0,y:0},
size:{width:Math.ceil(b/a**g),height:Math.ceil(f/a**g)}}}async _getThumbnailPixelBlock(a){const {signal:c}=this._galleryController;try{const {origin:b,pathname:f,searchParams:g}=new URL(a),m=await M.open({ioConfig:{customFetchParameters:Object.fromEntries(g),skipMapInfo:!0},url:`${b}${f}`,signal:c});return m?await this._getThumbnailPixelBlockInternal(m,{signal:c}):null}catch(b){A.getLogger(this).error("failed to create thumbnail",b)}return null}_handleBrightnessChange(a){this.viewModel.brightness=
a.target.value??0}_handleContrastChange(a){this.viewModel.contrast=a.target.value??0}_handleSharpnessChange(a){this.viewModel.sharpness=a.target.value??0}_lazyLoadImage(a,c){a.forEach(async b=>{if(b.isIntersecting){b=b.target;var f=b.getAttribute("data-src"),g=b.getAttribute("data-rotation"),m=g?parseFloat(g)%360:null;if(f){var t=await this._getThumbnailPixelBlock(f);if(t&&(b.width=t.width,b.height=t.height,f=b.getContext("2d"))){g=f.createImageData(b.width,b.height);g.data.set(t.getAsRGBA());if("number"==
typeof m&&0!==m){m=K.deg2rad(m);t=document.createElement("canvas");var r=t.getContext("2d");if(r){t.width=g.width;t.height=g.height;r.putImageData(g,0,0);r=B.rotatePixel(0,0,m);const x=B.rotatePixel(g.width,0,m),y=B.rotatePixel(g.width,g.height,m),z=B.rotatePixel(0,g.height,m);r=Math.min(b.width/(Math.max(r[0],x[0],y[0],z[0])-Math.min(r[0],x[0],y[0],z[0])),b.height/(Math.max(r[1],x[1],y[1],z[1])-Math.min(r[1],x[1],y[1],z[1])));f.save();f.clearRect(0,0,b.width,b.height);f.translate(b.width/2,b.height/
2);f.rotate(m);f.scale(r,r);f.drawImage(t,-g.width/2,-g.height/2,g.width,g.height);f.restore();return c.unobserve(b)}A.getLogger(this).warn("oriented-imagery-viewer:image-gallery","failed to apply rotation on thumbnail")}f.putImageData(g,0,0);c.unobserve(b)}}}})}_loadImageFromGallery(a){({target:a}=a);a&&(a=a.getAttribute("data-objectid"))&&this.viewModel.currentBestFeature?.attributes.objectId!==Number(a)&&this.viewModel.selectBestFeature(a)}_onAdditionalCoverageVisibilityChange(a){this.viewModel.setAdditionalCoverageVisibility(a)}_onAdditionalCameraLocationsVisibility(a){this.viewModel.setAdditionalCameraLocationsVisibility(a)}_onCurrentCoverageVisibilityChange(a){this.viewModel.setCurrentCoverageVisibility(a)}_registerGalleryItem(a){this._galleryObserver.observe(a)}_renderActionTooltips(){return[...this._actionItems].map(([a,
c])=>d.tsx("calcite-tooltip",{key:a,label:a,referenceElement:c},d.tsx("span",null,a)))}_renderBody(){return d.tsx("div",{class:e.css.body},this._renderViewerContainer(),this.invalidCameraHeading?[this._renderWarning(this.messages.invalidCameraHeadingWarningTitle),this._renderWarningTooltip(this.messages.invalidCameraHeadingWarningDescription)]:[this._renderImageGallery(),this._renderNavigation(),this._renderImageOverlays()],this._renderImageEnhancementTools())}_renderImageEnhancementAction(){const {state:a,
mode:c}=this.viewModel;return d.tsx("calcite-action",{active:this.imageEnhancementToolActive,afterCreate:this._storeActionElement,bind:this,disabled:"default"!==c||"image-loaded"!==a,icon:"sliders-horizontal",onclick:this._toggleImageEnhancementToolState,text:this.messages.imageEnhancement})}_renderImageEnhancementTools(){const {imageEnhancementToolActive:a,viewModel:{brightness:c,contrast:b,sharpness:f,state:g}}=this;return a&&"image-loaded"===g?d.tsx("calcite-panel",{bind:this,class:e.css.imageEnhancementWrapper,
closable:!0,closed:!a,heading:this.messages.imageEnhancement,key:this.messages.imageEnhancement,onCalcitePanelClose:this._toggleImageEnhancementToolState},d.tsx("div",{class:e.css.imageEnhancementTools},d.tsx("div",{class:e.css.imageEnhancementToolContainer},d.tsx("calcite-label",null,this.messages.brightness,d.tsx("calcite-slider",{bind:this,labelTicks:!0,max:10,min:-10,ticks:5,value:c,onCalciteSliderInput:this._handleBrightnessChange}))),d.tsx("div",{class:e.css.imageEnhancementToolContainer},d.tsx("calcite-label",
null,this.messages.contrast,d.tsx("calcite-slider",{bind:this,labelTicks:!0,max:10,min:-10,ticks:5,value:b,onCalciteSliderInput:this._handleContrastChange}))),d.tsx("div",{class:e.css.imageEnhancementToolContainer},d.tsx("calcite-label",null,this.messages.sharpness,d.tsx("calcite-slider",{bind:this,labelTicks:!0,max:1,min:0,step:.1,ticks:.5,value:f,onCalciteSliderInput:this._handleSharpnessChange})))),d.tsx("calcite-action",{bind:this,icon:"reset",onclick:this._resetImageTools,slot:"header-actions-end",
text:this.messagesCommon.reset})):null}_renderImageGallery(){const {container:a,galleryOpened:c,imageGalleryEnabled:b,viewModel:{thumbnails:f},invalidCameraHeading:g}=this;return b&&c&&a&&f?d.tsx("calcite-panel",{bind:this,class:e.css.carousel,closable:!0,closed:!c,disabled:g,heading:this.messages.imageGallery,key:this.messages.imageGallery,onCalcitePanelClose:this._toggleImageGallery},d.tsx("div",{class:e.css.carouselContainer},this._renderThumbnails(f))):null}_renderImageOverlaysAction(){const {viewModel:{state:a},
imageOverlaysOpened:c,invalidCameraHeading:b}=this;return d.tsx("calcite-action",{active:c,afterCreate:this._storeActionElement,bind:this,disabled:"image-loaded"!==a||b,icon:"layers",onclick:this._toggleImageOverlays,text:this.messages.imageOverlays})}_renderImageOverlays(){const {imageOverlaysOpened:a,viewModel:{state:c}}=this;if(a&&"image-loaded"===c)return this._imageOverlays.closed&&(this._imageOverlays.closed=!1),q.once(()=>this._imageOverlays.closed).then(()=>this.imageOverlaysOpened=!1),d.tsx("div",
{class:e.css.imageOverlaysContainer,key:this.messages.imageOverlays},this._imageOverlays.render())}_renderWarning(a){const {invalidCameraHeading:c,viewModel:{state:b}}=this;return c&&"image-loaded"===b?[d.tsx("calcite-notice",{class:e.css.alert,closable:!0,icon:"exclamation-mark-triangle-f",iconFlipRtl:!0,kind:"warning",open:!0,scale:"s"},d.tsx("div",{afterCreate:f=>this._storeWarningTitleElement(f),slot:"title"},a))]:null}_renderWarningTooltip(a){const {_warningTitleElement:c}=this;if(a?.length&&
c)return d.tsx("calcite-tooltip",{closeOnClick:!0,referenceElement:c},a)}_renderMapImageConversionTool(){const {mapImageConversionToolState:a,viewModel:{state:c},invalidCameraHeading:b}=this;return d.tsx("calcite-action",{active:a,afterCreate:this._storeActionElement,bind:this,disabled:"image-loaded"!==c||b,icon:"image-pin",onclick:this._toggleMapImageConversionToolState,text:this.messages.mapImageConversionTool})}_renderNavigation(){const {viewModel:{sectorData:a,navigatorCurrentBestFeature:c,currentBestFeature:b,
state:f}}=this;if(!this.container||!b)return null;let g,m,t,r,x;if(c){const {x:p,y:u,direction:w}=c,[C,D,E,T]=n.segmentArcs[w];g=`M ${p} ${u} L ${C} ${D} A ${n.sectorsRadii[2]} ${n.sectorsRadii[2]} 0 0 1 ${E} ${T} Z`;m=p;r=u;t=n.segmentArcs[w][4];x=n.segmentArcs[w][5]}const y=p=>{(p=p.target.dataset?.sector)&&this.viewModel.handleSectorClick(+p)},z=p=>{if(p=p.target.dataset){var {featureIndexInSector:u,sector:w}=p;u&&w&&this.viewModel.handleFeatureClick({sector:w,featureIndexInSector:+u})}},U=p=>
{p.removeEventListener("click",z)},V=b.attributes.objectId,W=a?.map(p=>p?.items).filter(Boolean).flatMap(p=>p?.map(({x:u,y:w,objectID:C,featureIndexInSector:D,sector:E})=>d.tsx("circle",{afterRemoved:U,class:this.classes(e.css.feature,{selected:V===C}),cx:u,cy:w,"data-feature-index-in-sector":D,"data-sector":E,key:`${e.css.feature}-${C}`,onclick:z,r:n.featureCircleRadius}))),X=p=>{p.removeEventListener("click",y)},Y=this.classes({[e.css.navigationWrapper]:!0,[e.css.navigationZoomed]:this._navigationToolExpanded});
return this.navigationToolActive&&"image-loaded"===f?d.tsx("div",{bind:this,class:Y,key:this.messages.navigationTool},d.tsx("svg",{afterCreate:p=>this._storeNavigationToolReference(p),class:J.prefersReducedMotion()?e.navigation:e.css.rotateWithAnimation,focusable:"false",height:n.navigationToolDimensionLength,role:"img",width:n.navigationToolDimensionLength,xmlns:"http://www.w3.org/2000/svg"},d.tsx("defs",null,d.tsx("linearGradient",{gradientUnits:"userSpaceOnUse",id:`${this.id}-coverage-fill`,x1:m,
x2:t,y1:r,y2:x},d.tsx("stop",{class:e.css.navigationPathOffset0,offset:0}),d.tsx("stop",{class:e.css.navigationPathOffset1,offset:1}))),d.tsx("g",null,d.tsx("circle",{class:this.classes(e.css.sector,e.css.outerSector),cx:n.sectorsRadii[3],cy:n.sectorsRadii[3],onclick:this._scaleNavigationTool,r:n.sectorsRadii[3]}),d.tsx("circle",{class:e.css.sector,cx:n.sectorsRadii[3],cy:n.sectorsRadii[3],r:n.sectorsRadii[2]}),d.tsx("circle",{class:e.css.sector,cx:n.sectorsRadii[3],cy:n.sectorsRadii[3],r:n.sectorsRadii[1]}),
d.tsx("circle",{class:e.css.sector,cx:n.sectorsRadii[3],cy:n.sectorsRadii[3],r:n.sectorsRadii[0]}),d.tsx("path",{class:e.css.pointer,d:"M 56.5 6.06217782649107 L 60 0 L 63.5 6.06217782649107 Z",key:`${e.css.pointer}-west`}),d.tsx("path",{class:this.classes(e.css.pointer,e.css.north),d:"M 113.93782217350893 56.5 L 120 60 L 113.93782217350893 63.5 Z",key:`${e.css.pointer}-north`}),d.tsx("path",{class:e.css.pointer,d:"M 56.5 113.93782217350893 L 60 120 L 63.5 113.93782217350893 Z",key:`${e.css.pointer}-east`}),
d.tsx("path",{class:e.css.pointer,d:"M 6.06217782649107 56.5 L 0 60 L 6.06217782649107 63.5 Z",key:`${e.css.pointer}-south`}),d.tsx("path",{class:this.classes(e.css.sector,e.css.sectorSeparator),d:"M 23.937554159486076 23.937554159486076 L 96.06244584051393 96.06244584051393 M 23.937554159486076 96.06244584051393 L 96.06244584051393 23.937554159486076",key:e.css.sectorSeparator}),O.getAllArcPath([n.sectorsRadii[2],n.sectorsRadii[1],n.sectorsRadii[0]],n.sectorsRadii[3],n.sectorsRadii[3]).map((p,u)=>
d.tsx("path",{afterRemoved:X,class:this.classes(e.css.sector,a?.[u]?.length?e.css.sectorEnabled:e.css.sectorDisabled),d:p,"data-sector":`${u}`,key:`${e.css.sector}-${u}`,onclick:y})),d.tsx("path",{class:this.classes(e.css.sector,e.css.sectorCross),d:"M 56.4 56.4 L 63.53 63.53 M 63.53 56.4 L 56.4 63.53",key:e.css.sectorCross}),W,5<=b.attributes.cameraPitch&&g?d.tsx("path",{class:e.css.selectedFeaturePath,d:g,fill:`url(#${this.id}-coverage-fill)`,key:e.css.selectedFeaturePath}):null))):null}_renderNavigationToolAction(){const {state:a}=
this.viewModel;return d.tsx("calcite-action",{active:this.navigationToolActive,afterCreate:this._storeActionElement,bind:this,disabled:"image-loaded"!==a||this.invalidCameraHeading,icon:"explore",onclick:this._toggleNavigationTool,text:this.messages.navigationTool})}_renderMenuBarContainer(){const {currentCoverageVisible:a,isAdditionalCoverageVisible:c,isAdditionalPointSourcesVisible:b,imageGalleryEnabled:f,invalidCameraHeading:g}=this;return d.tsx("calcite-action-bar",{expandDisabled:!0,layout:"horizontal",
slot:"action-bar"},d.tsx("calcite-action-group",{expanded:!0},d.tsx("calcite-action",{active:a,afterCreate:this._storeActionElement,bind:this,class:e.css.currentCoverage,disabled:g,icon:"trapezoid-area",onclick:this._toggleCurrentCoverage,text:this.messages.currentFootprint}),d.tsx("calcite-action",{active:c,afterCreate:this._storeActionElement,bind:this,class:e.css.addCoverage,disabled:g,icon:"trapezoid-area",onclick:this._toggleAdditionalCoverage,text:this.messages.additionalFootprints}),d.tsx("calcite-action",
{active:b,afterCreate:this._storeActionElement,bind:this,class:e.css.addExpPoints,disabled:g,icon:"circle-area",onclick:this._toggleAdditionalCameraLocations,text:this.messages.additionalCameraLocations})),d.tsx("calcite-action-group",{layout:"horizontal"},this.visibleElements.mapImageConversionTool?this._renderMapImageConversionTool():null,this.visibleElements.navigationTool?this._renderNavigationToolAction():null,this.visibleElements.imageEnhancement?this._renderImageEnhancementAction():null),d.tsx("calcite-action-group",
null,d.tsx("calcite-action",{active:this.galleryOpened,afterCreate:this._storeActionElement,bind:this,disabled:!f||g,icon:"images",onclick:this._toggleImageGallery,text:this.messages.imageGallery,textEnabled:!0}),this.visibleElements.imageOverlays?this._renderImageOverlaysAction():null,this.visibleElements.showPopupsAction?this._renderPopupAction():null),this._renderActionTooltips())}_renderMessageBox(){const {messages:a,viewModel:{displayMessage:c}}=this;if(!c)return null;const {data:b,key:f,map:g}=
c,m=`${g?S.substitute(a[f],g):a[f]}`;return d.tsx("span",{class:e.css.messageBox},b?`${m} ${b}`:m)}_renderPopupAction(){return d.tsx("calcite-action",{afterCreate:this._storeActionElement,bind:this,disabled:!this.popupEnabled,icon:"popup",onclick:this._toggleImageAttributes,text:this.messages.showPopups,textEnabled:!0})}_renderThumbnails(a){const {currentBestFeature:c}=this.viewModel;return c?d.tsx("div",{class:e.css.carouselContent},a.items.map(({url:b,objectId:f,rotation:g},m)=>d.tsx("div",{class:`${e.css.carouselItemWrapper}${c.attributes.objectId===
f?"--selected":""}`,key:`${e.css.carouselItemWrapper}-${m}`},d.tsx("canvas",{afterCreate:this._registerGalleryItem,afterRemoved:this._unregisterGalleryItem,alt:`thumbnail-${f}`,class:e.css.carouselItem,"data-objectid":`${f}`,"data-rotation":`${g}`,"data-src":b,onclick:this._loadImageFromGallery,onmouseenter:this._highlight,onmouseleave:this._removeHighlight})))):null}_renderViewerContainer(){return d.tsx("div",{class:e.css.viewerContainer},this._renderImageViewer(),this._renderPanoramicViewer(),this._renderMessageBox())}_renderImageViewer(){const {displayMessage:a,
loadImageViewer:c,mode:b}=this.viewModel;var f=null!=a||"default"!==b;f=this.classes({[e.css.viewer]:!f,[e.css.viewerHidden]:f});return d.tsx("calcite-panel",{afterCreate:c,bind:this,class:f})}_renderPanoramicViewer(){const {displayMessage:a,loadPanoramicViewer:c,mode:b}=this.viewModel;var f=null!=a||"panoramic"!==b;f=this.classes({[e.css.viewer]:!f,[e.css.viewerHidden]:f});return d.tsx("calcite-panel",{afterCreate:c,bind:this,class:f})}_resetImageTools(){this.viewModel.sharpness=this.viewModel.brightness=
this.viewModel.contrast=0}_storeActionElement(a){this._actionItems.set(a.text,a)}_storeNavigationToolReference(a){this._navigationTool=a}_storeWarningTitleElement(a){this._warningTitleElement=a}_toggleAdditionalCameraLocations(){this.isAdditionalPointSourcesVisible=!this.isAdditionalPointSourcesVisible}_toggleAdditionalCoverage(){this.isAdditionalCoverageVisible=!this.isAdditionalCoverageVisible}_toggleCurrentCoverage(){this.currentCoverageVisible=!this.currentCoverageVisible}_toggleImageEnhancementToolState(a){a.stopPropagation();
if(this.imageEnhancementToolActive=!this.imageEnhancementToolActive)this.galleryOpened&&(this.galleryOpened=!1),this.navigationToolActive&&(this.navigationToolActive=!1),this.imageOverlaysOpened&&(this.imageOverlaysOpened=!1)}_toggleImageOverlays(a){a.stopPropagation();if(this.imageOverlaysOpened=!this.imageOverlaysOpened)this.galleryOpened&&(this.galleryOpened=!1),this.navigationToolActive&&(this.navigationToolActive=!1),this.imageEnhancementToolActive&&(this.imageEnhancementToolActive=!1)}_toggleImageGallery(a){a.stopPropagation();
if(this.galleryOpened=this.imageGalleryEnabled?!this.galleryOpened:!1)this.imageEnhancementToolActive&&(this.imageEnhancementToolActive=!1),this.navigationToolActive&&(this.navigationToolActive=!1),this.imageOverlaysOpened&&(this.imageOverlaysOpened=!1)}_toggleNavigationTool(){if(this.navigationToolActive=!this.navigationToolActive)this.galleryOpened&&(this.galleryOpened=!1),this.imageEnhancementToolActive&&(this.imageEnhancementToolActive=!1),this.imageOverlaysOpened&&(this.imageOverlaysOpened=!1)}_toggleMapImageConversionToolState(){this.mapImageConversionToolState=
!this.mapImageConversionToolState}_unregisterGalleryItem(a){this._galleryObserver.unobserve(a)}_updateNavigationTool(a){const {previousFeatureAngle:c,bestFeatureAngle:b}=this.viewModel,f=(b-c+540)%360-180;a.style.setProperty(e.navigationToolRotationFrom,`${c}deg`);a.style.setProperty(e.navigationToolRotationTo,`${c+f}deg`)}async loadBestImage(a){return this.viewModel.loadBestImage(a)}loadImageFromSource(a,c){return this.viewModel.loadImageFromSource(a,c)}async plotMapPoint(a){return this.viewModel.plotMapPoint(a)}plotReferencePointOnGround(a){this.viewModel.plotReferencePointOnGround(a)}plotReferencePointOnImage(a){this.viewModel.plotReferencePointOnImage(a)}resetImage(){this.viewModel.resetImage()}render(){const {viewModel:{state:a}}=
this;return d.tsx("div",{class:this.classes(R.globalCss.widget,e.root)},d.tsx("calcite-panel",{bind:this,heading:this.visibleElements.title?this.messages.title:void 0,loading:"image-loading"===a},this.visibleElements.coverageMenu?this._renderMenuBarContainer():null,this._renderBody()))}updateSuitabilities(a){this.viewModel.updateSuitabilities(a)}};k.__decorate([l.property()],h.prototype,"activeLayer",null);k.__decorate([l.property()],h.prototype,"currentBestFeature",null);k.__decorate([l.property()],
h.prototype,"currentCoverageVisible",null);k.__decorate([l.property()],h.prototype,"disabled",null);k.__decorate([l.property()],h.prototype,"features",null);k.__decorate([l.property()],h.prototype,"imagePointsInView",null);k.__decorate([l.property()],h.prototype,"galleryOpened",void 0);k.__decorate([l.property()],h.prototype,"icon",null);k.__decorate([l.property()],h.prototype,"imageEnhancementToolActive",void 0);k.__decorate([l.property({readOnly:!0})],h.prototype,"imageGalleryEnabled",null);k.__decorate([l.property()],
h.prototype,"imageOverlaysOpened",void 0);k.__decorate([l.property({readOnly:!0})],h.prototype,"invalidCameraHeading",null);k.__decorate([l.property()],h.prototype,"isAdditionalCoverageVisible",null);k.__decorate([l.property()],h.prototype,"isAdditionalPointSourcesVisible",null);k.__decorate([l.property()],h.prototype,"mapImageConversionToolState",null);k.__decorate([l.property()],h.prototype,"layer",null);k.__decorate([l.property()],h.prototype,"navigationToolActive",void 0);k.__decorate([l.property({type:G})],
h.prototype,"viewModel",void 0);k.__decorate([l.property(),I.messageBundle("esri/widgets/OrientedImageryViewer/t9n/OrientedImageryViewer")],h.prototype,"messages",void 0);k.__decorate([l.property(),I.messageBundle("esri/t9n/common")],h.prototype,"messagesCommon",void 0);k.__decorate([l.property({readOnly:!0})],h.prototype,"popupEnabled",null);k.__decorate([l.property()],h.prototype,"referencePoint",null);k.__decorate([l.property()],h.prototype,"view",null);k.__decorate([l.property({type:H,nonNullable:!0})],
h.prototype,"visibleElements",void 0);k.__decorate([l.property()],h.prototype,"determineWorkflowForFeature",null);k.__decorate([l.property()],h.prototype,"updateFootprint",null);k.__decorate([l.property()],h.prototype,"_navigationToolExpanded",void 0);k.__decorate([l.property()],h.prototype,"_navigationTool",void 0);k.__decorate([l.property()],h.prototype,"_imageOverlays",void 0);k.__decorate([l.property()],h.prototype,"_warningTitleElement",void 0);return h=k.__decorate([L.subclass("esri.widgets.OrientedImageryViewer")],
h)});