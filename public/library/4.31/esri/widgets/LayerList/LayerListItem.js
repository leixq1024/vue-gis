// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.31/esri/copyright.txt for details.
//>>built
define("require ../../chunks/tslib.es6 ../../core/accessorSupport/decorators/property ../../core/has ../../core/Logger ../../core/RandomLCG ../../core/accessorSupport/decorators/subclass ../../layers/catalog/catalogUtils ../../support/actions/actionUtils ../Widget ./support/layerListUtils ../../chunks/componentsUtils ../support/jsxFactory ../support/widgetUtils".split(" "),function(u,e,f,d,G,H,A,B,x,C,v,D,h,E){var y;d=y=class extends C{constructor(a){super(a);this.listModeDisabled=this.dragEnabled=
!1;this.viewModel=this.parentTitles=this.parent=null;this._onActionMenuOpen=b=>{this.item.actionsOpen=b.target.open};this._setTooltipReference=b=>{this.onTooltipReferenceChange?.(this.item.layer.uid,b)};this._removeTooltipReference=()=>{this.onTooltipReferenceChange?.(this.item.layer.uid,null)}}loadDependencies(){return D.loadCalciteComponents({"action-group":()=>new Promise((a,b)=>u(["../../chunks/calcite-action-group"],a,b)),"action-menu":()=>new Promise((a,b)=>u(["../../chunks/calcite-action-menu"],
a,b)),action:()=>new Promise((a,b)=>u(["../../chunks/calcite-action"],a,b)),icon:()=>new Promise((a,b)=>u(["../../chunks/calcite-icon"],a,b)),"list-item":()=>new Promise((a,b)=>u(["../../chunks/calcite-list-item"],a,b)),list:()=>new Promise((a,b)=>u(["../../chunks/calcite-list"],a,b)),notice:()=>new Promise((a,b)=>u(["../../chunks/calcite-notice"],a,b))})}render(){const a=this.parentTitles??[],{_title:b,item:c,activeItem:g,selectedDragItemLayerUid:l,selectionMode:n,selectedItems:m,messages:k,parent:q,
css:p}=this,r="visibleAtCurrentTimeExtent"in c&&"layerInvisibleAtTime"in k&&!c.visibleAtCurrentTimeExtent?`${b} (${k.layerInvisibleAtTime})`:"visibleAtCurrentScale"in c&&"layerInvisibleAtScale"in k&&!c.visibleAtCurrentScale?`${b} (${k.layerInvisibleAtScale})`:b,F="parent"in c&&"catalog"===c.parent?.layer?.type,{layer:w}=c,z="visibleAtCurrentScale"in c&&!c.visibleAtCurrentScale||"visibleAtCurrentTimeExtent"in c&&!c.visibleAtCurrentTimeExtent;return h.tsx("calcite-list-item",{afterCreate:t=>this._focusSelectedDragEl(t,
c),afterUpdate:t=>this._focusSelectedDragEl(t,c),class:this.classes(p.item,"itemActive"in p&&{[p.itemActive]:g===c}),"data-item":c,"data-layer-id":w.id,dragDisabled:!c.sortable||F,dragSelected:w.uid===l,id:w.uid,key:`list-item-${w.uid}`,label:b,metadata:{parentTitles:a,_title:b},open:"open"in c&&c.open,selected:"none"!==n?m.includes(c):!1,title:r,unavailable:z,value:w.uid,onCalciteListItemDragHandleChange:t=>this._handleCalciteListItemDragHandleChange(t,c),onCalciteListItemSelect:t=>"visible"in c&&
this._handleCalciteListItemSelect(t,c,q),onCalciteListItemToggle:t=>"open"in c&&this._handleCalciteListItemToggle(t,c)},this._renderedCatalogFootprintIcon,this._renderedCatalogDynamicIcon,h.tsx("div",{class:this.classes(p.itemContent,"itemInvisible"in p&&{[p.itemInvisible]:z}),slot:"content"},b),this._renderedItemStatus,this._renderedItemToggle,this._renderedCatalogSelectNode,this._renderedItemTemporaryIcon,this._renderedChildList,this._renderedItemMessage,this._renderedPanel,this._renderedPanelAction,
this._renderedActions)}get _title(){const {messages:a}=this;return this.item.title||("untitledTable"in a?a.untitledTable:a.untitledLayer)}get _renderedItemStatus(){const {item:a,parent:b,visibleElements:c,css:g}=this;if(!c.statusIndicators)return null;const {publishing:l}=a,n="updating"in a&&a.updating&&!b,m="connectionStatus"in a?a.connectionStatus:void 0,k=!!m;return h.tsx("calcite-icon",{class:this.classes(g.statusIndicator,{[g.publishing]:l},"updating"in g&&{[g.updating]:n},"connectionStatus"in
g&&{[g.connectionStatus]:k},"connectionStatusConnected"in g&&{[g.connectionStatusConnected]:k&&"connected"===m}),icon:v.getStatusIcon({connectionStatus:m,publishing:l}),key:"layer-item-status",scale:"s",slot:"content-end"})}get _renderedItemTemporaryIcon(){const {item:a,visibleElements:b,css:c}=this;var {layer:g}=a;const l="temporaryLayerIndicators"in b&&b.temporaryLayerIndicators,n="temporaryTableIndicators"in b&&b.temporaryTableIndicators;g="persistenceEnabled"in g&&(B.isLayerFromCatalog(g)||!g.persistenceEnabled);
return(l||n)&&g?h.tsx("calcite-icon",{class:c.itemTemporaryIcon,icon:"temporary",key:"temporary-icon",scale:"s",slot:"actions-start",title:this.messages.temporary}):null}get _renderedItemToggle(){const {item:a,parent:b,messages:c,visibilityAppearance:g,css:l}=this;if(!("visible"in a&&"layerVisibility"in c&&"visibleToggle"in l&&g))return null;const {visible:n}=a,m=b?.visibilityMode;if("inherited"===m)return null;const k=v.getVisibilityIcon({visible:n,exclusive:"exclusive"===m,visibilityAppearance:g}),
q="checkbox"===g,p=c.layerVisibility;return h.tsx("calcite-action",{appearance:"transparent",class:l.visibleToggle,icon:q?k:void 0,key:"visibility-toggle",onclick:()=>this._toggleVisibility(a,b),scale:"s",slot:q?"actions-start":"actions-end",text:p,title:p},q?null:h.tsx("calcite-icon",{class:this.classes({[l.visibleIcon]:"exclusive"!==m&&n}),icon:k,scale:"s"}))}get _renderedPanel(){const {panel:a}=this.item;return!a?.open||a.disabled||a.flowEnabled?null:h.tsx("div",{class:this.css.itemContentBottom,
key:`content-panel-${a.uid}`,slot:"content-bottom"},a.render())}get _renderedPanelAction(){const {panel:a}=this.item;if(!a?.visible)return null;const {open:b,title:c,disabled:g}=a;return h.tsx("calcite-action",{active:b,appearance:"transparent",disabled:g,icon:x.getActionIcon(a),key:`action-${a.uid}`,onclick:()=>this._togglePanel(a),scale:"s",slot:"actions-end",text:c??"",title:c??void 0},this._renderFallbackIcon(a))}get _renderedActions(){switch(this._actionsCount){case 0:return null;case 1:return this._singleAction;
default:return this._renderedActionMenu}}get _renderedActionMenu(){const {item:a,messagesCommon:b}=this,c=b.options;return h.tsx("calcite-action-menu",{appearance:"transparent",key:"item-action-menu",label:b.menu,open:a.actionsOpen,overlayPositioning:"fixed",placement:"bottom-end",scale:"s",slot:"actions-end",onCalciteActionMenuOpen:this._onActionMenuOpen},h.tsx("calcite-action",{appearance:"transparent",icon:"ellipsis",scale:"s",slot:"trigger",text:c,title:c}),this._renderedActionMenuContent)}get _renderedActionMenuContent(){return this._filteredSections.toArray().map(a=>
h.tsx("calcite-action-group",{key:`action-section-${a.uid}`},a.toArray().map(b=>this._renderAction({action:b,textEnabled:!0}))))}get _renderedCatalogFootprintIcon(){const {css:a}=this,b="catalog-footprint"===this.item.layer?.type;return"itemCatalogIcon"in a&&b?h.tsx("calcite-icon",{class:a.itemCatalogIcon,icon:"footprint",key:"footprint",scale:"s",slot:"content-start"}):null}get _renderedCatalogDynamicIcon(){const {css:a}=this,b="catalog-dynamic-group"===this.item.layer?.type;return"itemCatalogIcon"in
a&&b?h.tsx("calcite-icon",{class:a.itemCatalogIcon,icon:"catalog-dataset",key:"catalog-dataset",scale:"s",slot:"content-start"}):null}get _renderedCatalogSelectNode(){const {_title:a,item:b,visibleElements:c}=this;if("visible"in b){var {layer:g}=b;return"catalogLayerList"in c&&c.catalogLayerList&&"catalog-dynamic-group"===g?.type?h.tsx("calcite-action",{appearance:"transparent",disabled:!g.visible,icon:"chevron-right",iconFlipRtl:!0,onclick:()=>this._triggerOnCatalogOpen(b),scale:"s",slot:"actions-end",
text:a}):null}}get _renderedChildList(){const {dragEnabled:a,item:b,rootGroupUid:c,listModeDisabled:g,selectionMode:l}=this;if("visible"in b){var n=[...(this.parentTitles??[]),b.title],{children:m,layer:k}=b,q="catalog-dynamic-group"!==k?.type&&v.listItemHasChildren(b),p=g?!1:v.areChildrenHidden(k);return q||!p&&!q&&a&&"group"===k?.type?h.tsx("calcite-list",{canPull:r=>this.canMove?this.canMove(r,"pull"):!1,canPut:r=>this.canMove?this.canMove(r,"put"):!1,"data-item":b,"data-layer-type":c,dragEnabled:a?
b.childrenSortable&&v.canSortSublayers(b):!1,group:`${c}-${k.uid}`,key:`child-list-${k.uid}`,selectionAppearance:"border",selectionMode:l},m?.filter(r=>!r.hidden).toArray().map(r=>this._renderItem(r,b,n)),this._renderedTablesItem):null}}get _hasTables(){const {layerTablesEnabled:a}=this,b=this.item.layer;if(!a||!b)return!1;switch(b.type){case "knowledge-graph":return a.includes(b.type)&&!!b.tables?.length;case "map-image":case "tile":return a.includes(b.type)&&!!b.subtables?.length;default:return!1}}get _renderedTablesItem(){const {item:a,
messages:b,css:c}=this,{layer:g}=a;return"itemTableIcon"in c&&"visible"in a&&"tables"in b&&this._hasTables?h.tsx("calcite-list-item",{class:c.item,"data-layer-id":g.id,dragDisabled:!0,key:`list-item-table-list-tables-${g.uid}`,title:b.tables,onCalciteListItemSelect:()=>this._triggerOnTablesOpen(a)},h.tsx("div",{class:c.itemContent,slot:"content"},b.tables),h.tsx("calcite-icon",{class:c.itemTableIcon,icon:"table",scale:"s",slot:"content-start"}),h.tsx("calcite-icon",{flipRtl:!0,icon:"chevron-right",
scale:"s",slot:"content-end"})):null}get _renderedItemMessage(){const {item:a,messages:b,css:c}=this;return a.error?h.tsx("div",{class:c.itemMessage,key:"esri-layer-list__error",slot:"content-bottom"},h.tsx("calcite-notice",{icon:"exclamation-mark-triangle",kind:"warning",open:!0,scale:"s",width:"full"},h.tsx("div",{slot:"message"},"tableError"in b?b.tableError:b.layerError))):"incompatible"in a&&a.incompatible&&"layerIncompatible"in b?h.tsx("div",{class:c.itemMessage,key:"esri-layer-list__incompatible",
slot:"content-bottom"},h.tsx("calcite-notice",{afterCreate:this._setTooltipReference,afterRemoved:this._removeTooltipReference,bind:this,icon:"exclamation-mark-triangle",kind:"warning",open:!0,scale:"s",tabIndex:0,width:"full"},h.tsx("div",{slot:"message"},b.layerIncompatible))):null}get _singleAction(){return this._renderAction({action:v.getSingleAction(this._filteredSections),textEnabled:!1})}get _filteredSections(){return this.item.actionsSections.map(a=>a.filter(b=>b.visible))}get _actionsCount(){return this.item.actionsSections.reduce((a,
b)=>a+b.length,0)}_renderAction(a){const {item:b}=this,{action:c,textEnabled:g}=a;if(!c)return null;const {active:l,disabled:n,title:m,type:k,indicator:q}=c;return h.tsx("calcite-action",{active:"toggle"===k?c.value:!1,appearance:"transparent",disabled:n,icon:x.getActionIcon(c),indicator:q,key:`action-${c.uid}`,loading:l,onclick:()=>this._triggerAction(b,c),scale:"s",slot:g?void 0:"actions-end",text:m??"",textEnabled:g,title:m??void 0},this._renderFallbackIcon(c))}_renderFallbackIcon(a){const {css:b}=
this,{className:c,icon:g}=a;if(g)return null;a="image"in a?a.image:void 0;const l={[b.itemActionIcon]:!!c,[b.itemActionImage]:!!a};c&&(l[c]=!0);return a||c?h.tsx("span",{"aria-hidden":"true",class:this.classes(b.itemActionIcon,l),key:"icon",styles:x.getActionStyles(a)}):null}_renderItem(a,b,c=[]){return h.tsx(y,{activeItem:this.activeItem,canMove:this.canMove,css:this.css,dragEnabled:this.dragEnabled,item:a,key:`layerListItem-${a.layer.uid}`,layerTablesEnabled:this.layerTablesEnabled,listModeDisabled:this.listModeDisabled,
messages:this.messages,messagesCommon:this.messagesCommon,parent:b,parentTitles:c,rootGroupUid:this.rootGroupUid,selectedDragItemLayerUid:this.selectedDragItemLayerUid,selectedItems:this.selectedItems,selectionMode:this.selectionMode,visibilityAppearance:this.visibilityAppearance,visibleElements:this.visibleElements,onAction:this.onAction,onCatalogOpen:this.onCatalogOpen,onPanelOpen:this.onPanelOpen,onSelectedDragItemLayerUidChange:this.onSelectedDragItemLayerUidChange,onTablesOpen:this.onTablesOpen,
onTooltipReferenceChange:this.onTooltipReferenceChange})}_triggerAction(a,b){b&&a&&("toggle"===b.type&&(b.value=!b.value),this.onAction(b,a))}_triggerOnTablesOpen(a){if(a&&this.onTablesOpen)this.onTablesOpen(a)}_triggerOnCatalogOpen(a){if(a)this.onCatalogOpen?.(a)}_focusSelectedDragEl(a,b){this.selectedDragItemLayerUid===b.layer.uid&&E.setFocus(a)}_handleCalciteListItemToggle(a,b){a.stopPropagation();b.open=a.target.open}_handleCalciteListItemDragHandleChange(a,b){a.stopPropagation();a=a.target.dragSelected;
this.onSelectedDragItemLayerUidChange?.(a?b.layer.uid:null)}_handleCalciteListItemSelect(a,b,c){v.getItem(a.target)===b&&"none"===this.selectionMode&&"inherited"!==c?.visibilityMode&&this._toggleVisibility(b,c)}_togglePanel(a){a.open=!a.open;if(a.open)this.onPanelOpen()}_toggleVisibility(a,b){!a||"exclusive"===b?.visibilityMode&&a.visible||(a.visible=!a.visible)}};d.vnodeSelector="calcite-list-item";e.__decorate([f.property()],d.prototype,"activeItem",void 0);e.__decorate([f.property()],d.prototype,
"canMove",void 0);e.__decorate([f.property()],d.prototype,"css",void 0);e.__decorate([f.property()],d.prototype,"dragEnabled",void 0);e.__decorate([f.property()],d.prototype,"item",void 0);e.__decorate([f.property()],d.prototype,"layerTablesEnabled",void 0);e.__decorate([f.property()],d.prototype,"listModeDisabled",void 0);e.__decorate([f.property()],d.prototype,"messages",void 0);e.__decorate([f.property()],d.prototype,"messagesCommon",void 0);e.__decorate([f.property()],d.prototype,"onAction",void 0);
e.__decorate([f.property()],d.prototype,"onPanelOpen",void 0);e.__decorate([f.property()],d.prototype,"onCatalogOpen",void 0);e.__decorate([f.property()],d.prototype,"onTablesOpen",void 0);e.__decorate([f.property()],d.prototype,"onSelectedDragItemLayerUidChange",void 0);e.__decorate([f.property()],d.prototype,"onTooltipReferenceChange",void 0);e.__decorate([f.property()],d.prototype,"parent",void 0);e.__decorate([f.property()],d.prototype,"parentTitles",void 0);e.__decorate([f.property()],d.prototype,
"rootGroupUid",void 0);e.__decorate([f.property()],d.prototype,"selectionMode",void 0);e.__decorate([f.property()],d.prototype,"selectedItems",void 0);e.__decorate([f.property()],d.prototype,"selectedDragItemLayerUid",void 0);e.__decorate([f.property()],d.prototype,"visibleElements",void 0);e.__decorate([f.property()],d.prototype,"visibilityAppearance",void 0);e.__decorate([f.property()],d.prototype,"_title",null);e.__decorate([f.property()],d.prototype,"_renderedItemStatus",null);e.__decorate([f.property()],
d.prototype,"_renderedItemTemporaryIcon",null);e.__decorate([f.property()],d.prototype,"_renderedItemToggle",null);e.__decorate([f.property()],d.prototype,"_renderedPanel",null);e.__decorate([f.property()],d.prototype,"_renderedPanelAction",null);e.__decorate([f.property()],d.prototype,"_renderedActions",null);e.__decorate([f.property()],d.prototype,"_renderedActionMenu",null);e.__decorate([f.property()],d.prototype,"_renderedActionMenuContent",null);e.__decorate([f.property()],d.prototype,"_renderedCatalogFootprintIcon",
null);e.__decorate([f.property()],d.prototype,"_renderedCatalogDynamicIcon",null);e.__decorate([f.property()],d.prototype,"_renderedCatalogSelectNode",null);e.__decorate([f.property()],d.prototype,"_renderedChildList",null);e.__decorate([f.property()],d.prototype,"_hasTables",null);e.__decorate([f.property()],d.prototype,"_renderedTablesItem",null);e.__decorate([f.property()],d.prototype,"_renderedItemMessage",null);e.__decorate([f.property()],d.prototype,"_singleAction",null);e.__decorate([f.property()],
d.prototype,"_filteredSections",null);e.__decorate([f.property()],d.prototype,"_actionsCount",null);return d=y=e.__decorate([A.subclass("esri.widgets.LayerList.LayerListItem")],d)});