// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.31/esri/copyright.txt for details.
//>>built
define("require ../../chunks/tslib.es6 ../../core/arrayUtils ../../core/asyncUtils ../../core/maybe ../../core/reactiveUtils ../../core/uid ../../core/accessorSupport/decorators/property ../../core/has ../../core/Logger ../../core/accessorSupport/decorators/subclass ../Widget ../../chunks/componentsUtils ./globalCss ./LabeledSwitch ./widgetUtils ./decorators/messageBundle ./jsxFactory ./SnappingControls/SnappingControlsViewModel ./SnappingControls/snappingLayerListUtils ./SnappingControls/VisibleElements".split(" "),
function(m,f,q,x,u,y,z,g,e,H,A,B,C,D,p,E,v,d,F,r,w){e=class extends B{constructor(a,b){super(a,b);this._gridLoadTask=this._layerListFilter=this._defaultViewModel=null;this.layerListOpen=!0;this.gridOptionsOpen=!1;this.snappingManager=this.messagesCommon=this.messages=null;this.visibleElements=new w;this._enableSnappingSwitchChange=l=>{this.snappingOptions.enabled=l};this._featureEnabledSwitchChange=l=>{this.snappingOptions.featureEnabled=l};this._gridEnabledSwitchChange=l=>{(this.snappingOptions.gridEnabled=
l)&&this._startLoadGrid()};this._selfEnabledSwitchChange=l=>{this.snappingOptions.selfEnabled=l};this._onToggleLayersButtonClick=l=>{this.viewModel.toggleSnappingForAllLayers(!this.viewModel.allLayersEnabled);E.setFocus(l.target)};const {snappingOptions:c,view:h,viewModel:k}=a;this.viewModel=k??(this._defaultViewModel=new F({snappingOptions:c,view:h}))}normalizeCtorArgs(a){const {snappingOptions:b,view:c,viewModel:h,...k}=a;return k}destroy(){this.viewModel!==this._defaultViewModel&&(this._defaultViewModel=
u.destroyMaybe(this._defaultViewModel))}loadDependencies(){return Promise.all([C.loadCalciteComponents({block:()=>new Promise((a,b)=>m(["../../chunks/calcite-block"],a,b)),button:()=>new Promise((a,b)=>m(["../../chunks/calcite-button"],a,b)),input:()=>new Promise((a,b)=>m(["../../chunks/calcite-input"],a,b)),list:()=>new Promise((a,b)=>m(["../../chunks/calcite-list"],a,b)),"list-item":()=>new Promise((a,b)=>m(["../../chunks/calcite-list-item"],a,b)),checkbox:()=>new Promise((a,b)=>m(["../../chunks/calcite-checkbox"],
a,b)),loader:()=>new Promise((a,b)=>m(["../../chunks/calcite-loader"],a,b))}),p.loadLabeledSwitchComponents()])}initialize(){this.addHandles(y.watch(()=>"2d"===this.view?.type&&!!this.view.grid,a=>{this.visibleElements.gridControls&&(this.snappingOptions.gridEnabled=a)}))}get _openAndReady(){return this.gridOptionsOpen&&this.snappingOptions.gridEnabled&&this.snappingOptions.enabled}get icon(){return"snap-to-point"}set icon(a){this._overrideIfSome("icon",a)}get label(){return this.messages?.widgetLabel??
""}set label(a){this._overrideIfSome("label",a)}get snappingOptions(){return this.viewModel.snappingOptions}set snappingOptions(a){this.viewModel.snappingOptions=a}get view(){return this.viewModel.view}set view(a){this.viewModel.view=a}set viewModel(a){if(a!==this._get("viewModel")){if(null==this._defaultViewModel||this._defaultViewModel!==a)this._defaultViewModel=u.destroyMaybe(this._defaultViewModel);this._set("viewModel",a)}}render(){const {label:a}=this;return d.tsx("div",{"aria-label":a,class:this.classes("esri-snapping-controls",
D.globalCss.widget)},d.tsx("div",{class:"esri-snapping-controls__container"},this._renderContent()))}_renderContent(){return[this._renderToggles(),this._renderLayerList(),"2d"===this.view?.type&&this.visibleElements.gridControls?this._renderGridOptions():null]}_renderToggles(){const {visibleElements:a,view:b}=this;var c=[a.selfEnabledToggle?this._renderSelfEnabledToggle():null,a.featureEnabledToggle?this._renderFeatureEnabledToggle():null,a.gridEnabledToggle&&"2d"===b?.type?this._renderGridEnabledToggle():
null].filter(q.isSome);c=[a.enabledToggle?this._renderEnabledToggle():null,0<c.length?d.tsx("div",{class:"esri-snapping-controls__nested-container"},c):null].filter(q.isSome);return 0===c.length?null:d.tsx("calcite-block",{class:"esri-snapping-controls__toggle-block",heading:a.header?this.label:"",key:"toggle-block",open:!0},c)}_renderEnabledToggle(){return d.tsx(p.LabeledSwitch,{checked:this.viewModel.snappingOptions.enabled,disabled:this._enabledToggleDisabled,key:`${this.id}__enabled-toggle`,label:this.messages.enableSnapping,
onChange:this._enableSnappingSwitchChange})}_renderSelfEnabledToggle(){return d.tsx(p.LabeledSwitch,{checked:this.viewModel.snappingOptions.selfEnabled,disabled:this._secondaryElementsDisabled,key:`${this.id}__self-enabled-toggle`,label:this.messages.geometryGuides,onChange:this._selfEnabledSwitchChange})}_renderFeatureEnabledToggle(){return d.tsx(p.LabeledSwitch,{checked:this.viewModel.snappingOptions.featureEnabled,disabled:this._secondaryElementsDisabled,key:`${this.id}__feature-enabled-toggle`,
label:this.messages.featureToFeature,onChange:this._featureEnabledSwitchChange})}_renderGridEnabledToggle(){return d.tsx(p.LabeledSwitch,{checked:this.viewModel.snappingOptions.gridEnabled,disabled:this._secondaryElementsDisabled,key:`${this.id}__grid-enabled-toggle`,label:this.messages.grid,onChange:this._gridEnabledSwitchChange})}_renderLayerList(){if(!this.visibleElements.layerList)return null;const {messages:a,viewModel:b}=this;var c=({target:{value:k}})=>{this._layerListFilter=""===k?null:new RegExp(k,
"i")};c=9<b.layerListViewModel.operationalItems.length?d.tsx("calcite-input",{class:"esri-snapping-controls__layer-list__filter",clearable:!0,placeholder:a?.searchLayers,onCalciteInputInput:c}):null;const h=this._secondaryElementsDisabled;return d.tsx("calcite-block",{class:"esri-snapping-controls__layer-list-block",collapsible:!0,disabled:this._secondaryElementsDisabled,heading:a.snappingLayers,key:"list-block",open:this.layerListOpen&&!h,onCalciteBlockToggle:k=>this.layerListOpen=k.target.open},
c,this._renderToggleLayersButton(),d.tsx("calcite-list",{class:"esri-snapping-controls__layer-list",selectionMode:"none"},this._renderLayerListItemCollection(b.layerListViewModel.operationalItems)))}_renderGridOptions(){const {view:a,visibleElements:b,snappingManager:c,snappingOptions:h,_openAndReady:k}=this,{gridEnabled:l,enabled:t}=h;(k||"2d"===a?.type&&a.grid)&&this._startLoadGrid();var n=this._gridLoadTask?.value;n=n&&"2d"===a?.type&&d.tsx(n,{snappingManager:c,snappingOptions:h,view:a,visibleElements:b.gridControlsElements});
return d.tsx("calcite-block",{class:"esri-snapping-controls__layer-list-block",collapsible:!0,disabled:!l||!t,heading:this.messages.gridOptionsHeading,key:"grid-block",open:k,onCalciteBlockClose:()=>this.gridOptionsOpen=!1,onCalciteBlockOpen:()=>this.gridOptionsOpen=!0},n??d.tsx("calcite-loader",{label:this.messagesCommon.loading,scale:"s",text:this.messagesCommon.loading}))}async _startLoadGrid(){!this._gridLoadTask&&this.visibleElements.gridControls&&"2d"===this.view?.type&&(this._gridLoadTask=
x.createTask(async()=>(await new Promise((a,b)=>m(["./GridControls"],c=>a(Object.freeze(Object.defineProperty({__proto__:null,default:c},Symbol.toStringTag,{value:"Module"}))),b))).default))}_renderLayerListItemCollection(a){const b=this._layerListFilter;return a.map(c=>{switch(b?r.itemTitleMatchesFilter(c,b):null){case "children":const h=c.children.filter(k=>!1!==r.itemTitleMatchesFilter(k,b));return this._renderLayerListItemGroup(c,h);case "self":case null:return this._renderLayerListItemOrGroup(c);
case !1:return"self"===r.itemTitleMatchesFilter(c.parent,b)?this._renderLayerListItemOrGroup(c):null}}).toArray().filter(q.isSome)}_renderToggleLayersButton(){if(!this.visibleElements.layerListToggleLayersButton)return null;const {viewModel:{allLayersEnabled:a},messages:b}=this,c=a?b.disableAllLayers:b.enableAllLayers;return d.tsx("calcite-button",{appearance:"transparent",class:"esri-snapping-controls__layer-list__button",label:c,name:"layer-toggle",onclick:this._onToggleLayersButtonClick},c)}_renderLayerListItemOrGroup(a){if(a.children.length)return this._renderLayerListItemGroup(a);
const {messages:{untitledLayer:b}}=this,c=()=>{this.viewModel.toggleSnappingForLayers([a.layer.id],"enabled"!==a.enabled)};return d.tsx("calcite-list-item",{class:"esri-snapping-controls__layer-list__item",key:`${this.id}-list-item-${a.uid}`,label:a.title||b,onCalciteListItemSelect:h=>{h.stopPropagation();c()}},d.tsx("calcite-checkbox",{checked:"enabled"===a.enabled,slot:"actions-start",onCalciteCheckboxChange:c}))}_renderLayerListItemGroup(a,b){const {children:c,title:h}=a,k=h||this.messages.untitledLayer,
l=h&&""!==h?h:z.generateUID(),t=b??c,n=()=>{this.viewModel.toggleSnappingForLayers(a.childLayerIds,"enabled"!==a.enabled)};return d.tsx("calcite-list-item",{class:"esri-snapping-controls__layer-list__group",key:l,label:k,open:!!b?.length,onCalciteListItemSelect:G=>{G.stopPropagation();n()}},d.tsx("calcite-checkbox",{checked:"enabled"===a.enabled,indeterminate:"indeterminate"===a.enabled,slot:"actions-start",onCalciteCheckboxChange:n}),d.tsx("calcite-list",null,this._renderLayerListItemCollection(t)))}get _enabledToggleDisabled(){const a=
this.snappingOptions;return a.enabledToggled||a.forceDisabled}get _secondaryElementsDisabled(){return this._enabledToggleDisabled||!this.snappingOptions.enabled}};f.__decorate([g.property()],e.prototype,"_defaultViewModel",void 0);f.__decorate([g.property()],e.prototype,"_layerListFilter",void 0);f.__decorate([g.property()],e.prototype,"_gridLoadTask",void 0);f.__decorate([g.property()],e.prototype,"_openAndReady",null);f.__decorate([g.property()],e.prototype,"label",null);f.__decorate([g.property({type:Boolean,
nonNullable:!0})],e.prototype,"layerListOpen",void 0);f.__decorate([g.property({type:Boolean,nonNullable:!0})],e.prototype,"gridOptionsOpen",void 0);f.__decorate([g.property(),v.messageBundle("esri/widgets/support/SnappingControls/t9n/SnappingControls")],e.prototype,"messages",void 0);f.__decorate([g.property(),v.messageBundle("esri/t9n/common")],e.prototype,"messagesCommon",void 0);f.__decorate([g.property()],e.prototype,"snappingOptions",null);f.__decorate([g.property()],e.prototype,"snappingManager",
void 0);f.__decorate([g.property()],e.prototype,"view",null);f.__decorate([g.property()],e.prototype,"viewModel",null);f.__decorate([g.property({type:w,nonNullable:!0})],e.prototype,"visibleElements",void 0);f.__decorate([g.property()],e.prototype,"_enabledToggleDisabled",null);f.__decorate([g.property()],e.prototype,"_secondaryElementsDisabled",null);return e=f.__decorate([A.subclass("esri.widgets.support.SnappingControls")],e)});