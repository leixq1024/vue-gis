// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.31/esri/copyright.txt for details.
//>>built
define("../../chunks/tslib.es6 ../../Graphic ../../intl ../../core/Accessor ../../core/Collection ../../core/Error ../../core/Logger ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/has ../../core/RandomLCG ../../core/accessorSupport/decorators/subclass ../../core/support/UpdatingHandles ../../layers/GraphicsLayer ../../symbols/LineSymbolMarker ../../symbols/SimpleLineSymbol ../../views/draw/support/layerUtils ../../intl/locale ../../intl/messages".split(" "),function(e,
u,c,x,y,r,v,n,f,E,F,z,A,B,p,q,w,C,D){c=class extends x{constructor(b){super(b);this._internalGraphicsLayerConnectivity=this._createInternalGraphicsLayer("Connectivity Associations (Internal)");this._internalGraphicsLayerStructuralAttachment=this._createInternalGraphicsLayer("Structural Attachment Associations (Internal)");this._initialValidationsFinished=!1;this._updatingHandles=new A.UpdatingHandles;this.autoRefreshAssociations=!1;this.connectivityAssociationsLineSymbol=new q({style:"short-dash",
width:2,color:[190,159,159,1]});this.executionError="";this.loadErrors=new y;this.maxAllowableAssociations=250;this.showArrowsStructuralAttachment=this.showArrowsConnectivity=this.showAssociationsEnabled=!1;this.structuralAttachmentAssociationsLineSymbol=new q({style:"short-dash",width:2,color:[159,190,159,1]})}initialize(){const b=async()=>{this.messages||(this.messages=await D.fetchMessageBundle("esri/widgets/UtilityNetworkAssociations/t9n/UtilityNetworkAssociations"))};b().then(()=>{this.view||
(this.view=null);this.utilityNetwork||(this.utilityNetwork=null);this.addHandles([n.watch(()=>[this.view,this.utilityNetwork],async()=>{const {loadErrors:a,messages:{info:{noUtilityNetwork:g,noView:h}}}=this;this._initialValidationsFinished=!1;a.removeAll();let k=!1,d=!1;this.removeAssociations();"utility"!==this.utilityNetwork?.type?(this.loadErrors.push(g),v.getLogger(this).error(new r("utilityNetworkAssociations:missing-property",g))):(this.utilityNetwork.loaded||await this.utilityNetwork.load(),
k=!0);"2d"!==this.view?.type?(this.loadErrors.push(h),v.getLogger(this).error(new r("utilityNetworkAssociations:missing-property",h))):(w.addUniqueLayer(this.view,this._internalGraphicsLayerConnectivity),w.addUniqueLayer(this.view,this._internalGraphicsLayerStructuralAttachment),d=!0);k&&d&&this.showAssociationsEnabled&&await this.showAssociations();this._internalGraphicsLayerConnectivity.visible=this.includeConnectivityAssociations;this._internalGraphicsLayerStructuralAttachment.visible=this.includeStructuralAttachmentAssociations;
this._initialValidationsFinished=!0},{initial:!0}),n.watch(()=>[this.view?.stationary,this.showAssociationsEnabled,this.maxAllowableAssociations],async()=>{this.view?.stationary&&this.showAssociationsEnabled&&(this.includeConnectivityAssociations||this.includeStructuralAttachmentAssociations)&&await this.showAssociations()}),n.watch(()=>[this.showArrowsConnectivity],()=>{const a=this.connectivityAssociationsLineSymbol.clone();a.marker=null;this.showArrowsConnectivity&&(a.marker=new p({color:this.connectivityAssociationsLineSymbol.color,
placement:"end",style:"arrow"}));for(const g of this._internalGraphicsLayerConnectivity.graphics)g.symbol=a}),n.watch(()=>[this.showArrowsStructuralAttachment],()=>{const a=this.structuralAttachmentAssociationsLineSymbol.clone();a.marker=null;this.showArrowsStructuralAttachment&&(a.marker=new p({color:this.structuralAttachmentAssociationsLineSymbol.color,placement:"end",style:"arrow"}));for(const g of this._internalGraphicsLayerStructuralAttachment.graphics)g.symbol=a}),n.watch(()=>{const {cap:a,
color:g,style:h,width:k,marker:d}=this.connectivityAssociationsLineSymbol;return[a,g,h,k,d]},()=>{const a=this.connectivityAssociationsLineSymbol.clone();for(const g of this._internalGraphicsLayerConnectivity.graphics)g.symbol=a;this.showArrowsConnectivity=!1;a.marker=null;this.connectivityAssociationsLineSymbol.marker&&(this.showArrowsConnectivity=!0,a.marker=new p({color:this.connectivityAssociationsLineSymbol.color,placement:"end",style:"arrow"}))}),n.watch(()=>{const {cap:a,color:g,style:h,width:k,
marker:d}=this.structuralAttachmentAssociationsLineSymbol;return[a,g,h,k,d]},()=>{const a=this.structuralAttachmentAssociationsLineSymbol.clone();for(const g of this._internalGraphicsLayerStructuralAttachment.graphics)g.symbol=a;this.showArrowsStructuralAttachment=!1;a.marker=null;this.structuralAttachmentAssociationsLineSymbol.marker&&(this.showArrowsStructuralAttachment=!0,a.marker=new p({color:this.structuralAttachmentAssociationsLineSymbol.color,placement:"end",style:"arrow"}))}),C.onLocaleChange(b)])})}destroy(){this._updatingHandles.destroy();
this.view=null;this._removeInternalGraphicsLayers()}set includeConnectivityAssociations(b){this._set("includeConnectivityAssociations",b);this._internalGraphicsLayerConnectivity.visible=b}set includeStructuralAttachmentAssociations(b){this._set("includeStructuralAttachmentAssociations",b);this._internalGraphicsLayerStructuralAttachment.visible=b}get state(){return this.loadErrors.length?"disabled":this._updatingHandles.updating?"executing":""!==this.executionError?"warning":this._initialValidationsFinished?
"ready":"loading"}set utilityNetwork(b){this._get("utilityNetwork")!==b&&this._set("utilityNetwork",b)}set view(b){this._get("view")!==b&&this._set("view",b)}removeAssociations(){this._internalGraphicsLayerConnectivity.removeAll();this._internalGraphicsLayerStructuralAttachment.removeAll()}async showAssociations(){const {messages:{info:{maxAllowableAssociationsExceeded:b,noAssociationsFound:a,noAssociationTypeSpecified:g}},utilityNetwork:h}=this;this._set("executionError","");const k={extent:this.view?.extent,
gdbVersion:this.utilityNetwork?.gdbVersion,maxGeometryCount:this.maxAllowableAssociations,moment:this.utilityNetwork?.historicMoment,outSpatialReference:this.view?.spatialReference.clone(),returnConnectivityAssociations:this.includeConnectivityAssociations,returnAttachmentAssociations:this.includeStructuralAttachmentAssociations};this._updatingHandles.addPromise(h?.synthesizeAssociationGeometries(k).then(d=>{let l=[],t=[];d?.maxGeometryCountExceeded?(this.removeAssociations(),this._set("executionError",
b)):0===d?.associations.length?(this.removeAssociations(),this._set("executionError",a)):d&&(l=d?.associations.filter(({associationType:m})=>"connectivity"===m).map(m=>{this.connectivityAssociationsLineSymbol.marker=null;this.showArrowsConnectivity&&(this.connectivityAssociationsLineSymbol.marker=new p({color:this.connectivityAssociationsLineSymbol.color,placement:"end",style:"arrow"}));return new u({geometry:m.geometry.clone(),symbol:this.connectivityAssociationsLineSymbol})}),t=d.associations.filter(({associationType:m})=>
"attachment"===m).map(m=>{this.structuralAttachmentAssociationsLineSymbol.marker=null;this.showArrowsStructuralAttachment&&(this.structuralAttachmentAssociationsLineSymbol.marker=new p({color:this.structuralAttachmentAssociationsLineSymbol.color,placement:"end",style:"arrow"}));return new u({geometry:m.geometry.clone(),symbol:this.structuralAttachmentAssociationsLineSymbol})}),this._internalGraphicsLayerConnectivity.removeAll(),0<l.length&&this._internalGraphicsLayerConnectivity.addMany(l),this._internalGraphicsLayerStructuralAttachment.removeAll(),
0<t.length&&this._internalGraphicsLayerStructuralAttachment.addMany(t))},d=>{let l="Error: "+d;if(d instanceof r&&d.details?.raw)switch(d.details.raw.extendedCode){case -2147208504:l=g;break;default:l=d.details.message}this._set("executionError",l)}))}_createInternalGraphicsLayer(b){return new B({listMode:"hide",internal:!0,title:b})}_removeInternalGraphicsLayers(){this._internalGraphicsLayerConnectivity&&this._internalGraphicsLayerStructuralAttachment&&this.view?.map&&(this.view.map.remove(this._internalGraphicsLayerConnectivity),
this.view.map.remove(this._internalGraphicsLayerStructuralAttachment))}};e.__decorate([f.property()],c.prototype,"_initialValidationsFinished",void 0);e.__decorate([f.property()],c.prototype,"autoRefreshAssociations",void 0);e.__decorate([f.property({type:q,nonNullable:!0})],c.prototype,"connectivityAssociationsLineSymbol",void 0);e.__decorate([f.property({readOnly:!0})],c.prototype,"executionError",void 0);e.__decorate([f.property({type:Boolean,value:!0})],c.prototype,"includeConnectivityAssociations",
null);e.__decorate([f.property({type:Boolean,value:!0})],c.prototype,"includeStructuralAttachmentAssociations",null);e.__decorate([f.property()],c.prototype,"loadErrors",void 0);e.__decorate([f.property()],c.prototype,"maxAllowableAssociations",void 0);e.__decorate([f.property()],c.prototype,"messages",void 0);e.__decorate([f.property()],c.prototype,"showAssociationsEnabled",void 0);e.__decorate([f.property()],c.prototype,"showArrowsConnectivity",void 0);e.__decorate([f.property()],c.prototype,"showArrowsStructuralAttachment",
void 0);e.__decorate([f.property({readOnly:!0})],c.prototype,"state",null);e.__decorate([f.property({type:q,nonNullable:!0})],c.prototype,"structuralAttachmentAssociationsLineSymbol",void 0);e.__decorate([f.property()],c.prototype,"utilityNetwork",null);e.__decorate([f.property()],c.prototype,"view",null);return c=e.__decorate([z.subclass("esri.widgets.UtilityNetworkAssociations.UtilityNetworkAssociationsViewModel")],c)});