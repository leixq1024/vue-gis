// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.31/esri/copyright.txt for details.
//>>built
define("../../chunks/tslib.es6 ../../core/ReactiveMap ../../core/accessorSupport/decorators/property ../../core/has ../../core/Logger ../../core/RandomLCG ../../core/accessorSupport/decorators/subclass ../Attachments/support/attachmentUtils ./Grid/Column ./Grid/ColumnCSS ../support/widgetUtils".split(" "),function(f,u,g,e,B,C,x,v,y,z,A){e=class extends y{constructor(b){super(b);this._buttonElements=new u;this._thumbnailElements=new u;this.attachmentsViewEnabled=!0;this.cellValueFormatFunction=({root:c,
rowData:a})=>{const {_showAttachmentsViewEnabled:d,formatFunction:k}=this;var h=this.getCellValue(a);if(k&&a){const {index:l,item:{attachments:m,feature:q,relatedRecords:n}}=a;return k({attachments:m,column:this,feature:q,index:l,relatedRecords:n,value:h,virtualIndex:this.getVirtualRowIndex(c)})}if(!a)return h;const {index:r,item:{attachments:t,objectId:p}}=a;c=`(${h})`;if(!this.thumbnailsEnabled&&!d)return h;h=document.createElement("span");h.textContent=h.title=c;c=null;this.thumbnailsEnabled&&
(c=this._createOrSyncThumbnails(p,t??[]));if(this._showAttachmentsViewEnabled)return a=document.createElement("div"),c&&a.appendChild(c),a.appendChild(h),h=this._createOrSyncShowAttachmentsButton(p,r),h.appendChild(a),h;a=document.createElement("div");a.classList.add("esri-attachments-column__content");c&&a.appendChild(c);a.appendChild(h);return a};this.icon="attachment";this.onShowAttachments=this.layer=null;this.sortable=!1;this.store=null;this.textAlign="center";this.thumbnailAppearance="image";
this.thumbnailCount=8;this.thumbnailIconScale="m";this.thumbnailsEnabled=!0}get _showAttachmentsViewEnabled(){return!(!this.attachmentsViewEnabled||!this.onShowAttachments)}get _supportsResize(){return!!this.store?.supportsResizeAttachments}get effectiveLabel(){return A.renderingSanitizer.sanitize(this.label??(this.messages?.attachments||this.fieldName))}getCellValue(b){return b?.item?.attachments?.length??0}_createOrSyncThumbnails(b,c){const a=document.createElement("div"),d=this._thumbnailElements.get(b);
d?.length&&d.length===c.length?d.forEach(k=>a.appendChild(k)):this._thumbnailElements.set(b,this._createThumbnailElements(c,a));return a}_createOrSyncShowAttachmentsButton(b,c){var a=this._buttonElements.get(b);if(a)return a.textContent="",a.onclick=d=>this._onShowAttachmentsClick({index:c,objectId:b,event:d}),a;a=this.createCalciteButton({alignment:"icon-end-space-between",className:`${"esri-attachments-column__button"} ${z.css.contentFull}`,iconEnd:"chevron-right",iconFlipRtl:"both",scale:this.thumbnailIconScale,
textContent:"",title:this.messages?.viewAttachments,width:"full",onclick:d=>this._onShowAttachmentsClick({index:c,objectId:b,event:d})});this._buttonElements.set(b,a);return a}_createThumbnailAnchor({name:b,url:c},a){const d=document.createElement("a");d.href=`${c}`;d.download=b;d.rel="noreferrer";d.target="_blank";d.appendChild(a);return d}_createThumbnailElements(b,c){const {thumbnailAppearance:a,thumbnailCount:d,thumbnailIconScale:k}=this,h=[],r=Math.min(d,b.length),t=!this.onShowAttachments,p=
"image"===a;for(let m=0;m<r;m++){var l=b[m];const {name:q,contentType:n}=l,w=v.isSupportedImage(n)&&p?this._createThumbnailImage(l):this.createCalciteIcon({icon:v.getCalciteIconForAttachment(n),scale:k,textLabel:q});l=t?this._createThumbnailAnchor(l,w):w;c&&c.appendChild(l);h.push(l)}return h}_createThumbnailImage(b){const {name:c,size:a,url:d}=b;b=document.createElement("img");const k=`${d}${d?.includes("?")?"\x26":"?"}${this._supportsResize?"w\x3d24":""}&fs=${a}`;b.alt=this.messages?.attachmentThumbnail??
c;b.src=k;b.title=c;return b}_onShowAttachmentsClick({index:b,objectId:c,event:a}){a.preventDefault();a.stopPropagation();this.onShowAttachments?.({index:b,objectId:c})}};f.__decorate([g.property()],e.prototype,"_showAttachmentsViewEnabled",null);f.__decorate([g.property()],e.prototype,"_buttonElements",void 0);f.__decorate([g.property()],e.prototype,"_supportsResize",null);f.__decorate([g.property()],e.prototype,"_thumbnailElements",void 0);f.__decorate([g.property()],e.prototype,"attachmentsViewEnabled",
void 0);f.__decorate([g.property()],e.prototype,"cellValueFormatFunction",void 0);f.__decorate([g.property()],e.prototype,"effectiveLabel",null);f.__decorate([g.property()],e.prototype,"icon",void 0);f.__decorate([g.property()],e.prototype,"layer",void 0);f.__decorate([g.property()],e.prototype,"onShowAttachments",void 0);f.__decorate([g.property({readOnly:!0})],e.prototype,"sortable",void 0);f.__decorate([g.property()],e.prototype,"store",void 0);f.__decorate([g.property()],e.prototype,"textAlign",
void 0);f.__decorate([g.property()],e.prototype,"thumbnailAppearance",void 0);f.__decorate([g.property()],e.prototype,"thumbnailCount",void 0);f.__decorate([g.property()],e.prototype,"thumbnailIconScale",void 0);f.__decorate([g.property()],e.prototype,"thumbnailsEnabled",void 0);return e=f.__decorate([x.subclass("esri.widgets.FeatureTable.AttachmentsColumn")],e)});