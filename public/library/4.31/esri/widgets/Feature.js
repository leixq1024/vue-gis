// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.31/esri/copyright.txt for details.
//>>built
require({cache:{"esri/widgets/Feature/FeatureAttachments":function(){define("../../chunks/tslib.es6 ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/has ../../core/Logger ../../core/RandomLCG ../../core/accessorSupport/decorators/subclass ../Attachments ../Widget ./FeatureAttachments/FeatureAttachmentsViewModel ./support/FeatureElementInfo ../support/widgetUtils ../support/jsxFactory".split(" "),function(a,k,d,C,H,E,p,F,K,v,q,e,m){C=class extends K{constructor(l,
h){super(l,h);this._featureElementInfo=null;this.attachmentsWidget=new F;this.headingLevel=2;this.viewModel=new v}initialize(){this._featureElementInfo=new q;this.addHandles([k.watch(()=>[this.viewModel?.description,this.viewModel?.title,this.headingLevel],()=>this._setupFeatureElementInfo(),k.initial),k.watch(()=>this.viewModel,l=>this.attachmentsWidget.viewModel=l,k.initial)])}destroy(){this.attachmentsWidget.viewModel=null;this.attachmentsWidget.destroy();this._featureElementInfo?.destroy()}get description(){return this.viewModel.description}set description(l){this.viewModel.description=
l}get displayType(){return this.attachmentsWidget.displayType}set displayType(l){this.attachmentsWidget.displayType=l}get graphic(){return this.viewModel.graphic}set graphic(l){this.viewModel.graphic=l}get title(){return this.viewModel.title}set title(l){this.viewModel.title=l}render(){const {attachmentsWidget:l}=this;return m.tsx("div",{class:"esri-feature-attachments"},this._featureElementInfo?.render(),l?.render())}_setupFeatureElementInfo(){const {description:l,title:h,headingLevel:r}=this;this._featureElementInfo?.set({description:l,
title:h,headingLevel:r})}};a.__decorate([d.property({readOnly:!0})],C.prototype,"attachmentsWidget",void 0);a.__decorate([d.property()],C.prototype,"description",null);a.__decorate([d.property()],C.prototype,"displayType",null);a.__decorate([d.property()],C.prototype,"graphic",null);a.__decorate([d.property()],C.prototype,"headingLevel",void 0);a.__decorate([d.property()],C.prototype,"title",null);a.__decorate([d.property({type:v})],C.prototype,"viewModel",void 0);return C=a.__decorate([p.subclass("esri.widgets.Feature.FeatureAttachments")],
C)})},"esri/widgets/Attachments":function(){define("require ../chunks/tslib.es6 ../core/Error ../core/reactiveUtils ../core/unitFormatUtils ../core/accessorSupport/decorators/property ../core/accessorSupport/decorators/cast ../core/RandomLCG ../core/has ../core/accessorSupport/decorators/subclass ./Widget ./Attachments/AttachmentsViewModel ./Attachments/support/attachmentUtils ../chunks/componentsUtils ./support/globalCss ./support/legacyIcon ./support/widgetUtils ./support/decorators/messageBundle ./support/jsxFactory".split(" "),
function(a,k,d,C,H,E,p,F,K,v,q,e,m,l,h,r,t,z,w){const u={addButton:!0,addSubmitButton:!0,cancelAddButton:!0,cancelUpdateButton:!0,deleteButton:!0,errorMessage:!0,progressBar:!0,updateButton:!0},G=window.CSS;F=class extends q{constructor(f,g){super(f,g);this.displayType="auto";this.selectedFile=this.messagesUnits=this.messages=null;this.submitting=!1;this.viewModel=null;this.visibleElements={...u};this._supportsImageOrientation=G&&G.supports&&G.supports("image-orientation","from-image");this._updateAttachmentForm=
this._addAttachmentForm=null}normalizeCtorArgs(f){f?.viewModel||(f={viewModel:new e,...f});return f}initialize(){this.addHandles([C.on(()=>this.viewModel?.attachmentInfos,"change",()=>this.scheduleRender()),C.on(()=>this.viewModel?.fileInfos,"change",()=>this.scheduleRender()),C.watch(()=>this.viewModel?.mode,()=>this._modeChanged(),C.initial)])}loadDependencies(){return l.loadCalciteComponents({icon:()=>new Promise((f,g)=>a(["../chunks/calcite-icon"],f,g))})}get capabilities(){return this.viewModel.capabilities}set capabilities(f){this.viewModel.capabilities=
f}get effectiveDisplayType(){const {displayType:f}=this;return f&&"auto"!==f?f:this.viewModel.supportsResizeAttachments?"preview":"list"}get graphic(){return this.viewModel.graphic}set graphic(f){this.viewModel.graphic=f}get icon(){return"attachment"}set icon(f){this._overrideIfSome("icon",f)}get label(){return this.messages?.widgetLabel??""}set label(f){this._overrideIfSome("label",f)}castVisibleElements(f){return{...u,...f}}addAttachment(){const {_addAttachmentForm:f,viewModel:g}=this;this._set("submitting",
!0);this._set("error",null);return g.addAttachment(f).then(b=>{this._set("submitting",!1);this._set("error",null);g.mode="view";return b}).catch(b=>{this._set("submitting",!1);this._set("error",new d("attachments:add-attachment",this.messages.addErrorMessage,b));throw b;})}deleteAttachment(f){const {viewModel:g}=this;this._set("submitting",!0);this._set("error",null);return g.deleteAttachment(f).then(b=>{this._set("submitting",!1);this._set("error",null);g.mode="view";return b}).catch(b=>{this._set("submitting",
!1);this._set("error",new d("attachments:delete-attachment",this.messages.deleteErrorMessage,b));throw b;})}updateAttachment(){const {viewModel:f}=this,{_updateAttachmentForm:g}=this;this._set("submitting",!0);this._set("error",null);return f.updateAttachment(g).then(b=>{this._set("submitting",!1);this._set("error",null);f.mode="view";return b}).catch(b=>{this._set("submitting",!1);this._set("error",new d("attachments:update-attachment",this.messages.updateErrorMessage,b));throw b;})}addFile(){const f=
this.viewModel.addFile(this.selectedFile,this._addAttachmentForm);this.viewModel.mode="view";return f}updateFile(){const {viewModel:f}=this,g=f.updateFile(this.selectedFile,this._updateAttachmentForm,f.activeFileInfo);f.mode="view";return g}deleteFile(f){f=this.viewModel.deleteFile(f||this.viewModel.activeFileInfo?.file);this.viewModel.mode="view";return f}render(){const {submitting:f,viewModel:g}=this,{state:b}=g;return w.tsx("div",{class:this.classes("esri-attachments",h.globalCss.widget)},f?this._renderProgressBar():
null,"loading"===b?this._renderLoading():this._renderAttachments(),this._renderErrorMessage())}_renderErrorMessage(){const {error:f,visibleElements:g}=this;return f&&g.errorMessage?w.tsx("div",{class:"esri-attachments__error-message",key:"error-message"},f.message):null}_renderAttachments(){const {activeFileInfo:f,mode:g,activeAttachmentInfo:b}=this.viewModel;return"add"===g?this._renderAddForm():"edit"===g?this._renderDetailsForm(b||f):this._renderAttachmentContainer()}_renderLoading(){return w.tsx("div",
{class:"esri-attachments__loader-container",key:"loader"},w.tsx("div",{class:"esri-attachments__loader"}))}_renderProgressBar(){return this.visibleElements.progressBar?w.tsx("div",{class:"esri-attachments__progress-bar",key:"progress-bar"}):null}_renderAddForm(){const {submitting:f,selectedFile:g}=this;var b=f||!g,c=this.visibleElements.cancelAddButton?w.tsx("button",{bind:this,class:this.classes(h.globalCss.button,h.globalCss.buttonTertiary,h.globalCss.buttonSmall,h.globalCss.buttonHalf,f&&h.globalCss.buttonDisabled),
disabled:f,onclick:this._cancelForm,type:"button"},this.messages.cancel):null;b=this.visibleElements.addSubmitButton?w.tsx("button",{class:this.classes(h.globalCss.button,h.globalCss.buttonSecondary,h.globalCss.buttonSmall,h.globalCss.buttonHalf,{[h.globalCss.buttonDisabled]:b}),disabled:b,type:"submit"},this.messages.add):null;const n=g?w.tsx("span",{class:"esri-attachments__file-name",key:"file-name"},g.name):null;c=w.tsx("form",{afterCreate:t.storeNode,afterRemoved:t.discardNode,bind:this,"data-node-ref":"_addAttachmentForm",
onsubmit:this._submitAddAttachment},w.tsx("fieldset",{class:"esri-attachments__file-fieldset"},n,w.tsx("label",{class:this.classes("esri-attachments__file-label",h.globalCss.button,h.globalCss.buttonSecondary)},g?this.messages.changeFile:this.messages.selectFile,w.tsx("input",{bind:this,class:"esri-attachments__file-input",name:"attachment",onchange:this._handleFileInputChange,type:"file"}))),b,c);return w.tsx("div",{class:"esri-attachments__form-node",key:"add-form-container"},c)}_renderDetailsForm(f){const {visibleElements:g,
viewModel:b,selectedFile:c,submitting:n}=this;var {capabilities:y}=b,D=n||!c;let B;if(c){var J=c.type;B=c.name;var O=c.size}else if(f&&"file"in f)J=f.file.type,B=f.file.name,O=f.file.size;else if(f&&"contentType"in f){J=f.contentType;B=f.name;O=f.size;var S=f.url}var x=y.editing&&y.operations?.delete&&g.deleteButton?w.tsx("button",{bind:this,class:this.classes(h.globalCss.button,h.globalCss.buttonSmall,h.globalCss.buttonTertiary,"esri-attachments__delete-button",{[h.globalCss.buttonDisabled]:n}),
disabled:n,key:"delete-button",onclick:M=>this._submitDeleteAttachment(M,f),type:"button"},this.messages.delete):void 0;D=y.editing&&y.operations?.update&&g.updateButton?w.tsx("button",{class:this.classes(h.globalCss.button,h.globalCss.buttonSmall,h.globalCss.buttonThird,{[h.globalCss.buttonDisabled]:D}),disabled:D,key:"update-button",type:"submit"},this.messages.update):void 0;const I=this.visibleElements.cancelUpdateButton?w.tsx("button",{bind:this,class:this.classes(h.globalCss.button,h.globalCss.buttonSmall,
h.globalCss.buttonTertiary,h.globalCss.buttonThird,{[h.globalCss.buttonDisabled]:n}),disabled:n,key:"cancel-button",onclick:this._cancelForm,type:"button"},this.messages.cancel):void 0;y=y.editing&&y.operations?.update?w.tsx("fieldset",{class:"esri-attachments__file-fieldset",key:"file"},w.tsx("span",{class:"esri-attachments__file-name",key:"file-name"},B),w.tsx("label",{class:this.classes("esri-attachments__file-label",h.globalCss.button,h.globalCss.buttonSecondary)},this.messages.changeFile,w.tsx("input",
{bind:this,class:"esri-attachments__file-input",name:"attachment",onchange:this._handleFileInputChange,type:"file"}))):void 0;O=w.tsx("fieldset",{class:"esri-attachments__metadata-fieldset",key:"size"},w.tsx("label",null,H.formatFileSize(this.messagesUnits,O??0)));J=w.tsx("fieldset",{class:"esri-attachments__metadata-fieldset",key:"content-type"},w.tsx("label",null,J));S=null!=S?w.tsx("a",{class:"esri-attachments__item-link",href:S,rel:"noreferrer",target:"_blank"},this._renderImageMask(f,400),w.tsx("div",
{class:"esri-attachments__item-link-overlay"},w.tsx("span",{class:"esri-attachments__item-link-overlay-icon"},w.tsx("calcite-icon",{icon:"launch"})))):this._renderImageMask(f,400);x=w.tsx("form",{afterCreate:t.storeNode,afterRemoved:t.discardNode,bind:this,"data-node-ref":"_updateAttachmentForm",onsubmit:M=>this._submitUpdateAttachment(M,f)},w.tsx("div",{class:"esri-attachments__metadata"},O,J),y,w.tsx("div",{class:"esri-attachments__actions"},x,I,D));return w.tsx("div",{class:"esri-attachments__form-node",
key:"edit-form-container"},S,x)}_renderImageMask(f,g){return f?"file"in f?this._renderGenericImageMask(f.file.name,f.file.type):this._renderImageMaskForAttachment(f,g):null}_renderGenericImageMask(f,g){var {supportsResizeAttachments:b}=this.viewModel;g=m.getIconPath(g);b={["esri-attachments__image--resizable"]:b};return w.tsx("div",{class:this.classes("esri-attachments__item-mask--icon","esri-attachments__item-mask"),key:g},w.tsx("img",{alt:f,class:this.classes(b,"esri-attachments__image"),src:g,
title:f}))}_renderImageMaskForAttachment(f,g){var {supportsResizeAttachments:b}=this.viewModel;if(!f)return null;const {contentType:c,name:n,url:y}=f;if(!b||!m.isSupportedImage(c))return this._renderGenericImageMask(n,c);f=(f=this._getCSSTransform(f))?{transform:f,"image-orientation":"none"}:{};g=`${y}${y?.includes("?")?"\x26":"?"}w=${g}`;b={["esri-attachments__image--resizable"]:b};return w.tsx("div",{class:this.classes("esri-attachments__item-mask"),key:g},w.tsx("img",{alt:n,class:this.classes(b,
"esri-attachments__image"),src:g,styles:f,title:n}))}_renderFile(f){const {file:g}=f;return w.tsx("li",{class:"esri-attachments__item",key:g},w.tsx("button",{"aria-label":this.messages.attachmentDetails,bind:this,class:"esri-attachments__item-button",key:"details-button",onclick:()=>this._startEditFile(f),title:this.messages.attachmentDetails,type:"button"},this._renderImageMask(f),w.tsx("label",{class:"esri-attachments__label"},w.tsx("span",{class:"esri-attachments__filename"},g.name||this.messages.noTitle),
w.tsx("span",{"aria-hidden":"true",class:this.classes("esri-attachments__item-chevron-icon",t.isRTL(this.container)?r.legacyIcon.left:r.legacyIcon.right)}))))}_renderAttachmentInfo({attachmentInfo:f,displayType:g}){const {viewModel:b,effectiveDisplayType:c}=this,{capabilities:n,supportsResizeAttachments:y}=b,{contentType:D,name:B,url:J}=f;g=this._renderImageMask(f,"list"===g?48:400);var O=n.editing?w.tsx("span",{"aria-hidden":"true",class:this.classes("esri-attachments__item-chevron-icon",t.isRTL(this.container)?
r.legacyIcon.left:r.legacyIcon.right)}):null;O="preview"===c&&y&&m.isSupportedImage(D)?null:w.tsx("label",{class:"esri-attachments__label"},w.tsx("span",{class:"esri-attachments__filename"},B||this.messages.noTitle),O);g=[g,O];g=n.editing?w.tsx("button",{"aria-label":this.messages.attachmentDetails,bind:this,class:"esri-attachments__item-button","data-attachment-info-id":f.id,key:"details-button",onclick:()=>this._startEditAttachment(f),title:this.messages.attachmentDetails,type:"button"},g):w.tsx("a",
{class:"esri-attachments__item-button",href:J??void 0,key:"details-link",rel:"noreferrer",target:"_blank"},g);return w.tsx("li",{class:"esri-attachments__item",key:f},g)}_renderAttachmentContainer(){const {effectiveDisplayType:f,viewModel:g,visibleElements:b}=this,{attachmentInfos:c,capabilities:n,fileInfos:y}=g;var D=!!c?.length;const B=!!y?.length,J={["esri-attachments__container--list"]:"preview"!==f,["esri-attachments__container--preview"]:"preview"===f},O=n.editing&&n.operations?.add&&b.addButton?
w.tsx("button",{bind:this,class:this.classes(h.globalCss.button,h.globalCss.buttonTertiary,"esri-attachments__add-attachment-button"),onclick:()=>this._startAddAttachment(),type:"button"},w.tsx("span",{"aria-hidden":"true",class:this.classes("esri-attachments__item-add-icon",r.legacyIcon.plus)}),this.messages.add):void 0,S=D?w.tsx("ul",{class:"esri-attachments__items",key:"attachments-list"},c.toArray().map(I=>this._renderAttachmentInfo({attachmentInfo:I,displayType:f}))):void 0,x=B?w.tsx("ul",{class:"esri-attachments__items",
key:"file-list"},y.toArray().map(I=>this._renderFile(I))):void 0;D=B||D?void 0:w.tsx("div",{class:h.globalCss.empty},this.messages.noAttachments);return w.tsx("div",{class:this.classes("esri-attachments__container",J),key:"attachments-container"},S,x,D,O)}_modeChanged(){this._set("error",null);this._set("selectedFile",null)}_handleFileInputChange(f){f=f.target.files?.item(0);this._set("selectedFile",f)}_submitDeleteAttachment(f,g){f.preventDefault();g&&("file"in g?this.deleteFile(g.file):g&&this.deleteAttachment(g))}_submitAddAttachment(f){f.preventDefault();
this.viewModel.filesEnabled?this.addFile():this.addAttachment()}_submitUpdateAttachment(f,g){f.preventDefault();g&&"file"in g?this.updateFile():this.updateAttachment()}_startEditAttachment(f){const {viewModel:g}=this;g.activeFileInfo=null;g.activeAttachmentInfo=f;g.mode="edit"}_startEditFile(f){const {viewModel:g}=this;g.activeAttachmentInfo=null;g.activeFileInfo=f;g.mode="edit"}_startAddAttachment(){this.viewModel.mode="add"}_cancelForm(f){f.preventDefault();this.viewModel.mode="view"}_getCSSTransform(f){({orientationInfo:f}=
f);return!this._supportsImageOrientation&&f?[f.rotation?`rotate(${f.rotation}deg)`:"",f.mirrored?"scaleX(-1)":""].join(" "):""}};k.__decorate([E.property()],F.prototype,"capabilities",null);k.__decorate([E.property()],F.prototype,"displayType",void 0);k.__decorate([E.property({readOnly:!0})],F.prototype,"effectiveDisplayType",null);k.__decorate([E.property()],F.prototype,"graphic",null);k.__decorate([E.property()],F.prototype,"icon",null);k.__decorate([E.property()],F.prototype,"label",null);k.__decorate([E.property(),
z.messageBundle("esri/widgets/Attachments/t9n/Attachments")],F.prototype,"messages",void 0);k.__decorate([E.property(),z.messageBundle("esri/core/t9n/Units")],F.prototype,"messagesUnits",void 0);k.__decorate([E.property({readOnly:!0})],F.prototype,"selectedFile",void 0);k.__decorate([E.property({readOnly:!0})],F.prototype,"submitting",void 0);k.__decorate([E.property({readOnly:!0})],F.prototype,"error",void 0);k.__decorate([E.property({type:e})],F.prototype,"viewModel",void 0);k.__decorate([E.property()],
F.prototype,"visibleElements",void 0);k.__decorate([p.cast("visibleElements")],F.prototype,"castVisibleElements",null);return F=k.__decorate([v.subclass("esri.widgets.Attachments")],F)})},"esri/core/unitFormatUtils":function(){define("exports ./ByteSizeUnit ./Cyclical ./mathUtils ./quantityUtils ./string ./unitUtils ../intl/number".split(" "),function(a,k,d,C,H,E,p,F){function K(h,r,t){return h.units[r][t]}function v(h,r,t,z=2,w="abbr"){return`${F.formatNumber(r,{minimumFractionDigits:z,maximumFractionDigits:z,
signDisplay:0<r?"never":"exceptZero"})} ${K(h,t,w)}`}function q(h,r,t,z=2,w="abbr"){return`${F.formatNumber(r,{minimumFractionDigits:z,maximumFractionDigits:z,signDisplay:"exceptZero"})} ${K(h,t,w)}`}function e(h,r){const t=JSON.stringify(r);let z=m.get(t);z||(z=new Intl.NumberFormat("en-US",r),m.set(t,z));return/^[-+]?360\.?0*\u00b0?$/.test(z.format(h))?0:h}const m=new Map,l=["B","kB","MB","GB","TB"];a.formatAngleDegrees=function(h,r,t,z,w,u=d.cyclicalDegrees,G=!0){h=u.normalize(H.convertRotationType(p.convertUnit(h,
r,"degrees"),t,z),0,G);w=w??2;w={style:"unit",unitDisplay:"narrow",unit:"degree",maximumFractionDigits:w,minimumFractionDigits:w,signDisplay:0<h?"never":"exceptZero"};h=e(h,w);return F.formatNumber(h,w)};a.formatDMS=function(h,r,t=2){h=p.convertUnit(h,r,"degrees");r=h-Math.floor(h);h-=r;r*=60;let z=r-Math.floor(r);r-=z;z*=60;return`${h.toFixed()}\u00b0 ${r.toFixed()}' ${z.toFixed(t)}"`};a.formatDecimal=v;a.formatFileSize=function(h,r){r=Math.round(r);let t=0===r?0:Math.floor(Math.log(r)/Math.log(k.ByteSizeUnit.KILOBYTES));
t=C.clamp(t,0,l.length-1);r=F.formatNumber(r/k.ByteSizeUnit.KILOBYTES**t,{maximumFractionDigits:2});return E.replace(h.units.bytes[l[t]],{fileSize:r})};a.formatImperialArea=function(h,r,t,z=2,w="abbr"){const u=p.adaptiveImperialAreaUnit(r,t);return v(h,p.convertUnit(r,t,u),u,z,w)};a.formatImperialLength=function(h,r,t,z=2,w="abbr"){const u=p.adaptiveImperialLengthUnit(r,t);return v(h,p.convertUnit(r,t,u),u,z,w)};a.formatImperialRelativeLength=function(h,r,t,z=2,w="abbr"){const u=p.adaptiveImperialLengthUnit(r,
t);return q(h,p.convertUnit(r,t,u),u,z,w)};a.formatImperialRelativeVerticalLength=function(h,r,t,z=2,w="abbr"){const u=p.adaptiveImperialVerticalLengthUnit(r,t);return q(h,p.convertUnit(r,t,u),u,z,w)};a.formatImperialVerticalLength=function(h,r,t,z=2,w="abbr"){const u=p.adaptiveImperialVerticalLengthUnit(r,t);return v(h,p.convertUnit(r,t,u),u,z,w)};a.formatMetricArea=function(h,r,t,z=2,w="abbr"){const u=p.adaptiveMetricAreaUnit(r,t);return v(h,p.convertUnit(r,t,u),u,z,w)};a.formatMetricLength=function(h,
r,t,z=2,w="abbr"){const u=p.adaptiveMetricLengthUnit(r,t);return v(h,p.convertUnit(r,t,u),u,z,w)};a.formatMetricRelativeLength=function(h,r,t,z=2,w="abbr"){const u=p.adaptiveMetricLengthUnit(r,t);return q(h,p.convertUnit(r,t,u),u,z,w)};a.formatMetricRelativeVerticalLength=function(h,r,t,z=2,w="abbr"){const u=p.adaptiveMetricVerticalLengthUnit(r,t);return q(h,p.convertUnit(r,t,u),u,z,w)};a.formatMetricVerticalLength=function(h,r,t,z=2,w="abbr"){const u=p.adaptiveMetricVerticalLengthUnit(r,t);return v(h,
p.convertUnit(r,t,u),u,z,w)};a.formatRelativeAngleDegrees=function(h,r,t,z,w=2){t!==z&&(h=-h);t={style:"unit",unitDisplay:"narrow",unit:"degree",maximumFractionDigits:w,minimumFractionDigits:w,signDisplay:"exceptZero"};h=p.convertUnit(h,r,"degrees")%360;h=e(h,t);return F.formatNumber(h,t)};a.formatRelativeDecimal=q;a.unitName=K;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/ByteSizeUnit":function(){define(["exports"],function(a){a.ByteSizeUnit=void 0;var k=a.ByteSizeUnit||
(a.ByteSizeUnit={});k[k.KILOBYTES=1024]="KILOBYTES";k[k.MEGABYTES=1048576]="MEGABYTES";k[k.GIGABYTES=1073741824]="GIGABYTES";Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/quantityUtils":function(){define(["exports","./unitUtils"],function(a,k){function d(l,h){return{type:k.unitType(h),value:l,unit:h}}function C(l,h){return{type:k.unitType(h),value:l,unit:h}}function H(l,h){return{type:k.unitType(h),value:l,unit:h}}function E(l,h,r="arithmetic"){return{type:k.unitType(h),
value:l,unit:h,rotationType:r}}function p(l,h){const r=F(l,h);return"angle"===l.type?E(r,h,l.rotationType):d(r,h)}function F(l,h){return k.convertUnit(l.value,l.unit,h)}const K=C(0,"meters"),v=H(0,"square-meters"),q=E(0,"radians"),e=E(0,"degrees"),m=E(0,"degrees","geographic");a.convertRotationType=function(l,h,r){if(h===r)return l;switch(r){case "arithmetic":case "geographic":return-l+90}};a.createAngle=E;a.createArea=H;a.createLength=C;a.createQuantity=d;a.createScalar=function(l){return{value:l}};
a.isBaseUnit=function(l){return k.isBaseUnit(l.unit)};a.max=function(l,h){return null==l?h:null==h?l:l.value>k.convertUnit(h.value,h.unit,l.unit)?l:h};a.min=function(l,h){return null==l?h:null==h?l:l.value<k.convertUnit(h.value,h.unit,l.unit)?l:h};a.scale=function(l,h){return null==l?null:{...l,value:l.value*h}};a.toBaseUnit=function(l){return p(l,k.baseUnitForUnit(l.unit))};a.toUnit=p;a.valueInUnit=F;a.zeroDegrees=e;a.zeroDegreesGeographic=m;a.zeroMeters=K;a.zeroRadians=q;a.zeroSquareMeters=v;Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/widgets/Attachments/AttachmentsViewModel":function(){define("../../chunks/tslib.es6 ../../Graphic ../../core/Accessor ../../core/Collection ../../core/Error ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/accessorSupport/decorators/cast ../../core/RandomLCG ../../core/has ../../core/accessorSupport/decorators/subclass ../../rest/query/support/AttachmentInfo ../../rest/support/AttachmentQuery ../Feature/support/featureUtils".split(" "),
function(a,k,d,C,H,E,p,F,K,v,q,e,m,l){const h={editing:!1,operations:{add:!0,update:!0,delete:!0}},r=C.ofType(e);d=class extends d{constructor(t){super(t);this._attachmentLayer=this._getAttachmentsPromise=null;this.capabilities={...h};this.activeFileInfo=this.activeAttachmentInfo=null;this.attachmentInfos=new r;this.fileInfos=new C;this.graphic=null;this.mode="view";this.filesEnabled=!1;this.addHandles(E.watch(()=>this.graphic,()=>this._graphicChanged(),E.initial))}destroy(){this.graphic=this._attachmentLayer=
null}castCapabilities(t){return{...h,...t}}get state(){return this._getAttachmentsPromise?"loading":this.graphic?"ready":"disabled"}get supportsResizeAttachments(){var {graphic:t}=this;if(!t)return!1;t=t.layer||t.sourceLayer;return t?.loaded&&"capabilities"in t&&t.capabilities&&"operations"in t.capabilities&&"supportsResizeAttachments"in t.capabilities.operations&&t.capabilities.operations.supportsResizeAttachments||!1}async getAttachments(){const {_attachmentLayer:t,attachmentInfos:z}=this;if(!t||
"function"!==typeof t.queryAttachments)throw new H("invalid-layer","getAttachments(): A valid layer is required.");const w=this._getObjectId();if("number"!==typeof w)throw new H("invalid-object-id","getAttachments(): Numeric object id is required");var u=new m({objectIds:[w],returnMetadata:!0});const G=[];this._getAttachmentsPromise=u=t.queryAttachments(u).then(f=>f[w]||G).catch(()=>G);this.notifyChange("state");u=await u;z.destroyAll();u.length&&z.addMany(u);this._getAttachmentsPromise=null;this.notifyChange("state");
return u}async addAttachment(t,z=this.graphic){const {_attachmentLayer:w,attachmentInfos:u,capabilities:G}=this;if(!z)throw new H("invalid-graphic","addAttachment(): A valid graphic is required.",{graphic:z});if(!t)throw new H("invalid-attachment","addAttachment(): An attachment is required.",{attachment:t});if(!G.operations?.add)throw new H("invalid-capabilities","addAttachment(): add capabilities are required.");if(!w||"function"!==typeof w.addAttachment)throw new H("invalid-layer","addAttachment(): A valid layer is required.");
t=await w.addAttachment(z,t).then(f=>this._queryAttachment(f.objectId,z));u.add(t);return t}async deleteAttachment(t){const {_attachmentLayer:z,attachmentInfos:w,graphic:u,capabilities:G}=this;if(!t)throw new H("invalid-attachment-info","deleteAttachment(): An attachmentInfo is required.",{attachmentInfo:t});if(!G.operations?.delete)throw new H("invalid-capabilities","deleteAttachment(): delete capabilities are required.");if(!z||"function"!==typeof z.deleteAttachments)throw new H("invalid-layer",
"deleteAttachment(): A valid layer is required.");if(!u)throw new H("invalid-graphic","deleteAttachment(): A graphic is required.");const f=await z.deleteAttachments(u,[t.id]).then(()=>t);w.remove(f);f.destroy();return f}async updateAttachment(t,z=this.activeAttachmentInfo){const {_attachmentLayer:w,attachmentInfos:u,graphic:G,capabilities:f}=this;if(!t)throw new H("invalid-attachment","updateAttachment(): An attachment is required.",{attachment:t});if(!z)throw new H("invalid-attachment-info","updateAttachment(): An attachmentInfo is required.",
{attachmentInfo:z});if(!f.operations?.update)throw new H("invalid-capabilities","updateAttachment(): Update capabilities are required.");const g=u.indexOf(z);if(!w||"function"!==typeof w.updateAttachment)throw new H("invalid-layer","updateAttachment(): A valid layer is required.");if(!G)throw new H("invalid-graphic","updateAttachment(): A graphic is required.");t=await w.updateAttachment(G,z.id,t).then(b=>this._queryAttachment(b.objectId));u.splice(g,1,t);return t}async commitFiles(){await Promise.all(this.fileInfos.items.map(t=>
this.addAttachment(t.form)));this.fileInfos.removeAll();return this.getAttachments()}addFile(t,z){if(!t||!z)return null;t={file:t,form:z};this.fileInfos.add(t);return t}updateFile(t,z,w=this.activeFileInfo){if(!t||!z||!w)return null;w=this.fileInfos.indexOf(w);-1<w&&this.fileInfos.splice(w,1,{file:t,form:z});return this.fileInfos.items[w]}deleteFile(t){const z=this.fileInfos.find(w=>w.file===t);return z?(this.fileInfos.remove(z),z):null}async _queryAttachment(t,z){const {_attachmentLayer:w}=this;
if(!t||!w?.queryAttachments)throw new H("invalid-attachment-id","Could not query attachment.");const u=this._getObjectId(z);if("number"!==typeof u)throw new H("invalid-object-id","getAttachments(): Numeric object id is required");t=new m({objectIds:[u],attachmentsWhere:`AttachmentId=${t}`,returnMetadata:!0});return w.queryAttachments(t).then(G=>G[u][0])}_getObjectId(t=this.graphic){return t?.getObjectId()??null}_graphicChanged(){this.graphic&&(this._setAttachmentLayer(),this.getAttachments().catch(()=>
this.attachmentInfos.destroyAll()))}_setAttachmentLayer(){var {graphic:t}=this;this._attachmentLayer=(t=l.getSourceLayer(t))?"scene"===t.type&&null!=t.associatedLayer?t.associatedLayer:t:null}};a.__decorate([p.property()],d.prototype,"capabilities",void 0);a.__decorate([F.cast("capabilities")],d.prototype,"castCapabilities",null);a.__decorate([p.property()],d.prototype,"activeAttachmentInfo",void 0);a.__decorate([p.property()],d.prototype,"activeFileInfo",void 0);a.__decorate([p.property({readOnly:!0,
type:r})],d.prototype,"attachmentInfos",void 0);a.__decorate([p.property()],d.prototype,"fileInfos",void 0);a.__decorate([p.property({type:k})],d.prototype,"graphic",void 0);a.__decorate([p.property()],d.prototype,"mode",void 0);a.__decorate([p.property({readOnly:!0})],d.prototype,"state",null);a.__decorate([p.property()],d.prototype,"filesEnabled",void 0);a.__decorate([p.property({readOnly:!0})],d.prototype,"supportsResizeAttachments",null);return d=a.__decorate([q.subclass("esri.widgets.Attachments.AttachmentsViewModel")],
d)})},"esri/rest/query/support/AttachmentInfo":function(){define("../../../chunks/tslib.es6 ../../../core/JSONSupport ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/RandomLCG ../../../core/has ../../../core/accessorSupport/decorators/subclass ../../../layers/support/exifUtils".split(" "),function(a,k,d,C,H,E,p,F){var K;const v={1:{id:1,rotation:0,mirrored:!1},2:{id:2,rotation:0,mirrored:!0},3:{id:3,rotation:180,mirrored:!1},4:{id:4,rotation:180,
mirrored:!0},5:{id:5,rotation:-90,mirrored:!0},6:{id:6,rotation:90,mirrored:!1},7:{id:7,rotation:90,mirrored:!0},8:{id:8,rotation:-90,mirrored:!1}};k=K=class extends k.JSONSupport{constructor(q){super(q);this.url=this.size=this.parentObjectId=this.parentGlobalId=this.name=this.keywords=this.globalId=this.id=this.exifInfo=this.contentType=null}get orientationInfo(){var {exifInfo:q}=this;q=F.getExifValue({exifName:"Exif IFD0",tagName:"Orientation",exifInfo:q});return v[q]||null}clone(){return new K({contentType:this.contentType,
exifInfo:this.exifInfo,id:this.id,globalId:this.globalId,keywords:this.keywords,name:this.name,parentGlobalId:this.parentGlobalId,parentObjectId:this.parentObjectId,size:this.size,url:this.url})}};a.__decorate([d.property({type:String})],k.prototype,"contentType",void 0);a.__decorate([d.property()],k.prototype,"exifInfo",void 0);a.__decorate([d.property({readOnly:!0})],k.prototype,"orientationInfo",null);a.__decorate([d.property({type:C.Integer})],k.prototype,"id",void 0);a.__decorate([d.property({type:String})],
k.prototype,"globalId",void 0);a.__decorate([d.property({type:String})],k.prototype,"keywords",void 0);a.__decorate([d.property({type:String})],k.prototype,"name",void 0);a.__decorate([d.property({json:{read:!1}})],k.prototype,"parentGlobalId",void 0);a.__decorate([d.property({json:{read:!1}})],k.prototype,"parentObjectId",void 0);a.__decorate([d.property({type:C.Integer})],k.prototype,"size",void 0);a.__decorate([d.property({json:{read:!1}})],k.prototype,"url",void 0);return k=K=a.__decorate([p.subclass("esri.rest.query.support.AttachmentInfo")],
k)})},"esri/layers/support/exifUtils":function(){define(["exports"],function(a){function k(d){const {tagName:C,tags:H}=d;return H&&C?H.find(E=>E.name===C)?.value||null:null}a.getExifValue=function(d){const {exifInfo:C,exifName:H,tagName:E}=d;return C&&H&&E?(d=C.find(p=>p.name===H))?k({tagName:E,tags:d.tags}):null:null};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/Feature/support/featureUtils":function(){define("exports ../../../core/has ../../../core/Logger ../../../core/string ../../../intl/date ../../../intl/number ../../../layers/support/fieldUtils ../../../layers/support/layerUtils ../../../smartMapping/support/utils ../../../support/arcadeOnDemand ../../../time/timeZoneUtils".split(" "),
function(a,k,d,C,H,E,p,F,K,v,q){function e(A){return A?aa.test(A):!1}function m(A,L){if(L&&e(L)&&A){var P=L.replace(aa,"").toLowerCase();return A.find(({name:R})=>R.toLowerCase()===P)}}function l(A,L){return(L=h(L,A))?L.name:A}function h(A,L){return A&&"function"===typeof A.getField&&L?A.getField(L)??null:null}function r({formattedAttributes:A,template:L,fieldInfoMap:P}){return`${C.replace(C.replace(L,R=>`{${P.get(R.toLowerCase())?.fieldName||R}}`),A).replaceAll(U,"")}`.trim()}function t(A,L,P=!1){const R=
L[A];"string"===typeof R&&(P=(P?encodeURIComponent(R):R).replaceAll(W,"%27"),L[A]=P)}function z(A,L=!1){const P={...A};Object.keys(P).forEach(R=>t(R,P,L));return P}function w(A,L){return A.replaceAll(Y,(P,R,X)=>(P=h(L,X))?`{${P.name}}`:R)}function u(A,L,P){return(A=w(A,P))?A.replaceAll(fa,(R,X,V)=>{X=`${X||V}`.trim();return C.replace(R,z(L,X&&"{"!==X[0]||!1))}):A}function G(A){return null!=A&&"object"===typeof A&&"fieldsIndex"in A&&"geometryType"in A&&"getField"in A&&"load"in A&&"loaded"in A&&"objectIdField"in
A&&"spatialReference"in A&&"type"in A&&("feature"===A.type||"scene"===A.type||"subtype-sublayer"===A.type||"sublayer"===A.type)&&"when"in A}function f(A){return null!=A&&"object"===typeof A&&"createQuery"in A&&"queryFeatureCount"in A&&"queryObjectIds"in A&&"queryRelatedFeatures"in A&&"queryRelatedFeaturesCount"in A&&"relationships"in A}function g(A){return A&&"object"===typeof A&&"createQuery"in A&&"queryFeatureCount"in A&&"type"in A?"subtype-sublayer"===A.type&&"parent"in A&&A.parent&&"object"===
typeof A.parent?"globalIdField"in A.parent:"globalIdField"in A:!1}function b(A){return G(A)&&f(A)}function c(A,L){const {fieldInfos:P,fieldName:R,preventPlacesFormatting:X,layer:V,timeZone:ba}=L;L=y(P,R);var Z=h(V,R);if(L&&!p.isRasterPixelValueField(R)){Z=Z?.type;const da=L.format?.dateFormat;if("date"===Z||"date-only"===Z||"time-only"===Z||"timestamp-offset"===Z||da)return K.formatAnyDate(A,{format:da,fieldType:Z,timeZoneOptions:{layerTimeZone:V&&"preferredTimeZone"in V?V.preferredTimeZone:null,
viewTimeZone:ba,datesInUnknownTimezone:V&&"datesInUnknownTimezone"in V?!!V.datesInUnknownTimezone:!1}})}L=L?.format;if("string"===typeof A&&p.isRasterPixelValueField(R)&&L)return A=A.trim(),/\d{2}-\d{2}/.test(A)?A:A.includes(",")?n(A,",",", ",L):A.includes(";")?n(A,";","; ",L):A.includes(" ")?n(A," "," ",L):E.formatNumber(Number(A),E.convertNumberFormatToIntlOptions(L));"string"!==typeof A||!L||null!=L.dateFormat||null==L.places&&null==L.digitSeparator||(Z=Number(A),isNaN(Z)||(A=Z));return"string"===
typeof A||null==A||null==L?J(A):X?E.formatNumber(A,{...E.convertNumberFormatToIntlOptions(L),minimumFractionDigits:0,maximumFractionDigits:20}):E.formatNumber(A,E.convertNumberFormatToIntlOptions(L))}function n(A,L,P,R){return A.trim().split(L).map(X=>E.formatNumber(Number(X),E.convertNumberFormatToIntlOptions(R))).join(P)}function y(A,L){if(A?.length&&L)return A.find(P=>P.fieldName?.toLowerCase()===L.toLowerCase())}function D({fieldName:A,graphic:L,layer:P}){if(I(A)||!P||"function"!==typeof P.getFeatureType)return null;
const {typeIdField:R}=P;return R&&A===R?(A=P.getFeatureType(L))?A.name:null:null}function B({fieldName:A,value:L,graphic:P,layer:R}){return I(A)||!R||"function"!==typeof R.getFieldDomain?null:(A=P&&R.getFieldDomain(A,{feature:P,excludeImpliedDomains:k("esri-widget-legacy-field-domain-calculation")}))&&"coded-value"===A.type?A.getName(L):null}function J(A){return"string"===typeof A?A.replaceAll(ca,'\x3cbr class\x3d"esri-text-new-line" /\x3e'):A}function O(A){const {value:L,fieldName:P,fieldInfos:R,
fieldInfoMap:X,layer:V,graphic:ba,timeZone:Z}=A;return null==L?"":(A=B({fieldName:P,value:L,graphic:ba,layer:V}))||(A=D({fieldName:P,graphic:ba,layer:V}))?A:X.get(P.toLowerCase())?c(L,{fieldInfos:R||Array.from(X.values()),fieldName:P,layer:V,timeZone:Z}):(A=V?.fieldsIndex?.get(P))&&(K.isAnyDateField(A)||p.isTimeOnlyField(A))?K.formatAnyDate(L,{fieldType:A.type,timeZoneOptions:{layerTimeZone:V&&"preferredTimeZone"in V?V.preferredTimeZone:null,viewTimeZone:Z,datesInUnknownTimezone:V&&"datesInUnknownTimezone"in
V?!!V.datesInUnknownTimezone:!1}}):J(L)}async function S(A,L){const {layer:P,graphic:R,outFields:X,objectIds:V,returnGeometry:ba,spatialReference:Z}=A;A=V[0];if("number"!==typeof A&&"string"!==typeof A)return L={layer:P,graphic:R,objectId:A,requiredFields:X},d.getLogger("esri.widgets.Feature.support.featureUtils").warn("Could not query required fields for the specified feature. The feature's ID is invalid.",L),null;if(!F.getEffectiveLayerCapabilities(P)?.operations?.supportsQuery)return L={layer:P,
graphic:R,requiredFields:X,returnGeometry:ba},d.getLogger("esri.widgets.Feature.support.featureUtils").warn("The specified layer cannot be queried. The following fields will not be available.",L),null;A=P.createQuery();A.objectIds=V;A.outFields=X?.length?X:[P.objectIdField];A.returnGeometry=!!ba;A.returnZ=!!ba;A.returnM=!!ba;A.outSpatialReference=Z;return(await P.queryFeatures(A,L)).features[0]}async function x(A){if(!A.expressionInfos?.length)return!1;var L=await v.loadArcade();({arcadeUtils:{hasGeometryFunctions:L}}=
L);return L(A)}function I(A=""){return A?A.includes("relationships/"):!1}function M({attributes:A,graphic:L,relatedInfo:P,fieldInfos:R,fieldInfoMap:X,layer:V,timeZone:ba}){A&&L&&P&&Object.keys(L.attributes).forEach(Z=>{var da=(da={layerId:P.relation.id.toString(),fieldName:Z},`${"relationships/"}${da.layerId}/${da.fieldName}`);A[da]=O({fieldName:da,fieldInfos:R,fieldInfoMap:X,layer:V,value:L.attributes[Z],graphic:L,timeZone:ba})})}function N({attributes:A,relatedInfo:L,fieldInfoMap:P,fieldInfos:R,
layer:X,timeZone:V}){A&&L&&(L.relatedFeatures?.forEach(ba=>M({attributes:A,graphic:ba,relatedInfo:L,fieldInfoMap:P,fieldInfos:R,layer:X,timeZone:V})),L.relatedStatsFeatures?.forEach(ba=>M({attributes:A,graphic:ba,relatedInfo:L,fieldInfoMap:P,fieldInfos:R,layer:X,timeZone:V})))}function Q(A,L){return A?.allTables.find(P=>"feature"===P.type&&P.layerId===L.id&&P.url===L.layer?.url)}function T({map:A,relationship:L,relationship:{relatedTableId:P},relatedLayer:R,layers:X}){if(!X)return null;for(const V of X)if("map-image"===
V.type){if(X=T({layers:V.sublayers,map:A,relatedLayer:R,relationship:L})||T({layers:V.subtables,map:A,relatedLayer:R,relationship:L}))return X}else if(b(V))if("sublayer"===R.type){if(V!==R&&V.id===P)return V.isTable?Q(A,V):V}else{X="scene"===R.type&&R.associatedLayer?R.associatedLayer.url:R.url;if(!X)break;if("sublayer"===V.type){if(V!==R&&V.layer?.url===X&&V.id===P)return V.isTable?Q(A,V):V}else if(V!==R&&V.url===X&&V.layerId===P)return V}return null}const U=/href=(""|'')/gi,Y=/(\{([^{\r\n]+)\})/g,
W=/'/g,aa=/^\s*expression\//i,ca=/(\n)/gi,ea=/[\u00A0-\u9999<>&]/gim,fa=/href\s*=\s*(?:"([^"]+)"|'([^']+)')/gi,ha=/^(?:mailto:|tel:)/,ia=H.convertDateFormatToIntlOptions("short-date-short-time"),ja=A=>{if(!A)return!1;A=A.toUpperCase();return A.includes("CURRENT_TIMESTAMP")||A.includes("CURRENT_DATE")||A.includes("CURRENT_TIME")},ka=({layer:A,method:L,query:P,definitionExpression:R})=>{A.capabilities?.query?.supportsCacheHint&&"attachments"!==L&&(A=null!=P.where?P.where:null,L=null!=P.geometry?P.geometry:
null,ja(R)||ja(A)||"extent"===L?.type||"tile"===P.resultType||(P.cacheHint=!0))};a.applyTextFormattingHTML=J;a.createFieldInfoMap=function(A,L){const P=new Map;if(!A)return P;for(const R of A)R.fieldName&&(A=l(R.fieldName,L),R.fieldName=A,P.set(A.toLowerCase(),R));return P};a.findRelatedLayer=function(A,L,P){return A&&L&&P?"sublayer"===L.type?T({layers:L.layer?.sublayers,map:A,relatedLayer:L,relationship:P})||T({layers:L.layer?.subtables,map:A,relatedLayer:L,relationship:P}):T({layers:A.allLayers,
map:A,relatedLayer:L,relationship:P})||T({layers:A.allTables,map:A,relatedLayer:L,relationship:P}):null};a.findUtilityNetwork=function(A,L){return A&&"utilityNetworks"in A&&L?A.utilityNetworks?.find(P=>P.isUtilityLayer(L)):null};a.fixTokens=w;a.formatAttributes=function({fieldInfos:A,attributes:L,layer:P,graphic:R,fieldInfoMap:X,relatedInfos:V,timeZone:ba}){const Z={};V?.forEach(da=>N({attributes:Z,relatedInfo:da,fieldInfoMap:X,fieldInfos:A,layer:P,timeZone:ba}));L&&Object.keys(L).forEach(da=>{Z[da]=
O({fieldName:da,fieldInfos:A,fieldInfoMap:X,layer:P,value:L[da],graphic:R,timeZone:ba})});return Z};a.formatEditInfo=function(A,L,P,R){const {creatorField:X,creationDateField:V,editorField:ba,editDateField:Z}=A;if(L){A=q.getTimeZoneFormattingOptions(R&&"preferredTimeZone"in R?R.preferredTimeZone:null,R&&"datesInUnknownTimezone"in R?!!R.datesInUnknownTimezone:!1,P,ia,"date");A={...ia,...A};P=L[Z];if("number"===typeof P)return L=L[ba],{type:"edit",date:H.formatDate(P,A),user:L};P=L[V];return"number"===
typeof P?(L=L[X],{type:"create",date:H.formatDate(P,A),user:L}):null}};a.formatValueToFieldInfo=c;a.getAllFieldInfos=function(A){const L=[];if(!A)return L;const {fieldInfos:P,content:R}=A;P&&L.push(...P);if(!R||!Array.isArray(R))return L;R.forEach(X=>{"fields"===X.type&&(X=X?.fieldInfos)&&L.push(...X)});return L};a.getFieldInfo=y;a.getFieldInfoLabel=function(A,L){return(L=m(L,A?.fieldName))?L.title||null:A?A.label||A.fieldName:null};a.getFixedFieldName=l;a.getFixedFieldNames=function(A,L){return A&&
A.map(P=>l(P,L))};a.getHighlightKeyForFeature=function(A){const L=A.getObjectId();return null!=L?`oid:${L}`:`uid:${A.uid}`};a.getSourceLayer=function(A){if(null!=A)return(A.sourceLayer||A.layer)??void 0};a.graphicCallback=async function({type:A,value:L,event:P}){try{return"function"===typeof L?L(P):await L}catch(R){d.getLogger("esri.widgets.Feature.support.featureUtils").error("error",`An error occurred when calling the "${A}" function`,{error:R,graphic:P.graphic,value:L})}};a.htmlEntities=function(A){return A.replaceAll(ea,
L=>`&#${L.charCodeAt(0)};`)};a.isAssociatedFeatureSupportedLayer=function(A){return G(A)&&g(A)};a.isAssociatedLayer=g;a.isExpressionField=e;a.isFeatureSupportedLayer=G;a.isGraphicForRelatableFeatureSupportedLayer=function(A){return!!A&&"object"===typeof A&&"sourceLayer"in A&&b(A.sourceLayer)};a.isRelatableFeatureSupportedLayer=b;a.isRelatableLayer=f;a.isRelatedField=I;a.preLayerQueryCallback=({query:A,layer:L,method:P})=>{ka({layer:L,method:P,query:A,definitionExpression:`${L.definitionExpression} ${L.serviceDefinitionExpression??
""}`})};a.preRequestCallback=({queryPayload:A,layer:L,method:P})=>{ka({layer:L,method:P,query:A,definitionExpression:`${L.definitionExpression} ${L.serviceDefinitionExpression??""}`})};a.querySourceLayer=S;a.queryUpdatedFeature=async function({graphic:A,popupTemplate:L,layer:P,spatialReference:R},X){if(P&&L&&("function"===typeof P.load&&await P.load(X),A.attributes)){var V=P.objectIdField,ba=A.attributes[V];if(null!=ba){ba=[ba];var Z=await L.getRequiredFields(P.fieldsIndex),da=p.featureHasFields(Z,
A);V=da?[]:Z.includes(V)?Z:[...Z,V];L=L.returnGeometry||await x(L);if(!da||L)if(P=await S({layer:P,graphic:A,outFields:V,objectIds:ba,returnGeometry:L,spatialReference:R},X))P.geometry&&(A.geometry=P.geometry),P.attributes&&(A.attributes={...A.attributes,...P.attributes})}}};a.shouldOpenInNewTab=function(A=""){if(A)return!ha.test(A.trim().toLowerCase())};a.substituteAttributes=r;a.substituteFieldsInLinksAndAttributes=function({attributes:A,globalAttributes:L,layer:P,text:R,expressionAttributes:X,
fieldInfoMap:V}){return R?r({formattedAttributes:L,template:u(R,{...L,...X,...A},P),fieldInfoMap:V}):""};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/smartMapping/support/utils":function(){define("exports ../../intl/date ../../layers/support/fieldUtils ../../support/arcadeOnDemand ../../support/basemapUtils ../../time/timeZoneUtils".split(" "),function(a,k,d,C,H,E){function p(l){return String(l).padStart(2,"0")}function F(l,h,r){if("date"===h||"number"===h){"number"===h&&
(l=new Date(l));h=r?l.getFullYear():l.getUTCFullYear();const t=p((r?l.getMonth():l.getUTCMonth())+1),z=p(r?l.getDate():l.getUTCDate()),w=p(r?l.getHours():l.getUTCHours()),u=p(r?l.getMinutes():l.getUTCMinutes());l=p(r?l.getSeconds():l.getUTCSeconds());l=`TIMESTAMP'${h}-${t}-${z} ${w}:${u}:${l}'`}return l}function K(l,h){if(h instanceof Date)return"date";if("number"===typeof h)return"number";if("string"===typeof h&&(l=l.getField(h),"\x3cnow\x3e"!==h.toLowerCase()&&d.isDateField(l)))return"field"}const v=
{light:"streets gray topo terrain oceans osm gray-vector streets-vector topo-vector streets-relief-vector streets-navigation-vector topo-3d navigation-3d streets-3d osm-3d gray-3d arcgis-light-gray arcgis-navigation arcgis-streets arcgis-streets-relief arcgis-topographic arcgis-oceans osm-standard osm-standard-relief osm-streets osm-streets-relief osm-light-gray arcgis-terrain arcgis-charted-territory arcgis-community arcgis-colored-pencil arcgis-modern-antique arcgis-midcentury arcgis-newspaper arcgis-hillshade-light".split(" "),
dark:"satellite hybrid dark-gray dark-gray-vector streets-night-vector navigation-dark-3d streets-dark-3d dark-gray-3d arcgis-imagery arcgis-imagery-standard arcgis-dark-gray arcgis-navigation-night arcgis-streets-night osm-dark-gray arcgis-nova arcgis-hillshade-dark".split(" ")},q={years:365,months:30,days:1,hours:1/24,minutes:1/1440,seconds:1/86400,milliseconds:1/864E5},e=new Set(["integer","small-integer"]);let m=null;a.castIntegerFieldToFloat=function(l){return`cast(${l} as float)`};a.dateTypes=
["date","date-only","timestamp-offset"];a.defaultBasemapGroups=v;a.defaultStatisticTypes={exclude:["median"]};a.fieldDelimiter=",";a.formatAnyDate=function(l,h){const {format:r,timeZoneOptions:t,fieldType:z}=h??{};let w;t&&({timeZone:u,timeZoneName:w}=E.getTimeZoneFormattingOptions(t.layerTimeZone,t.datesInUnknownTimezone,t.viewTimeZone,k.convertDateFormatToIntlOptions(r||"short-date-short-time"),z));if("string"===typeof l&&isNaN(Date.parse("time-only"===z?`1970-01-01T${l}Z`:l)))return l;switch(z){case "date-only":var u=
k.convertDateFormatToIntlOptions(r||"short-date");return"string"===typeof l?k.formatDateOnly(l,{...u}):k.formatDate(l,{...u,timeZone:E.utc});case "time-only":return u=k.convertDateFormatToIntlOptions(r||"short-time"),"string"===typeof l?k.formatTimeOnly(l,u):k.formatDate(l,{...u,timeZone:E.utc});case "timestamp-offset":if(!u&&"string"===typeof l&&(new Date(l)).toISOString()!==l)return l;u=(h=r||t?k.convertDateFormatToIntlOptions(r||"short-date-short-time"):void 0)?{...h,timeZone:u,timeZoneName:w}:
void 0;return"string"===typeof l?k.formatTimestamp(l,u):k.formatDate(l,u);default:return h=r||t?k.convertDateFormatToIntlOptions(r||"short-date-short-time"):void 0,k.formatDate("string"===typeof l?new Date(l):l,h?{...h,timeZone:u,timeZoneName:w}:void 0)}};a.getBasemapGroup=function(l,h=v){for(const r in h)if(h[r].includes(l))return r};a.getBasemapId=function(l,h,r=!0){let t=null;l&&("string"===typeof l?h.includes(l)&&(t=l):t=H.getWellKnownBasemapId(l));return r?t||"gray":t};a.getDateDiffSQL=function(l,
h,r,t){const {hasQueryEngine:z}=l;r=F(r,K(l,r),z);l=F(h,K(l,h),z);l=`(${r} - ${l})`;t=q[t];h="/";1>t&&(t=1/t,h="*");return{sqlExpression:1===t?l:`(${l} ${h} ${t})`,sqlWhere:null}};a.getDateType=K;a.getFieldsList=async function(l){const {field:h,field2:r,field3:t,normalizationField:z,valueExpression:w}=l;l=[];w&&(m||({arcadeUtils:l}=await C.loadArcade(),m=l),l=m.extractFieldNames(w));h&&l.push(h);r&&l.push(r);t&&l.push(t);z&&l.push(z);return l};a.getNormalizationType=function(l){let h=l.normalizationType;
h||(l.normalizationField?h="field":null!=l.normalizationTotal&&(h="percent-of-total"));return h??void 0};a.isAnyDateField=function(l){return d.isDateField(l)||d.isDateOnlyField(l)||d.isTimestampOffsetField(l)};a.isIntegerField=function(l,h){l=h&&l.getField(h);return!!l&&e.has(l.type)};a.unitValueInDays=q;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/Attachments/support/attachmentUtils":function(){define(["exports","../../../assets"],function(a,k){a.getCalciteIconForAttachment=
function(d){return d?"text/plain"===d?"file-text":"application/pdf"===d?"file-pdf":"text/csv"===d?"file-csv":"application/gpx+xml"===d?"file-gpx":"application/x-dwf"===d?"file-cad":"application/postscript"===d||"application/json"===d||"text/xml"===d||"model/vrml"===d?"file-code":"application/x-zip-compressed"===d||"application/x-7z-compressed"===d||"application/x-gzip"===d||"application/x-tar"===d||"application/x-gtar"===d||"application/x-bzip2"===d||"application/gzip"===d||"application/x-compress"===
d||"application/x-apple-diskimage"===d||"application/x-rar-compressed"===d||"application/zip"===d?"file-zip":d.includes("image/")?"file-image":d.includes("audio/")?"file-sound":d.includes("video/")?"file-video":d.includes("msexcel")||d.includes("ms-excel")||d.includes("spreadsheetml")?"file-excel":d.includes("msword")||d.includes("ms-word")||d.includes("wordprocessingml")?"file-word":d.includes("powerpoint")||d.includes("presentationml")?"file-ppt":"file":"file"};a.getIconPath=function(d){const C=
k.getAssetUrl("esri/themes/base/images/files/");return d?"text/plain"===d?`${C}text-32.svg`:"application/pdf"===d?`${C}pdf-32.svg`:"text/csv"===d?`${C}csv-32.svg`:"application/gpx+xml"===d?`${C}gpx-32.svg`:"application/x-dwf"===d?`${C}cad-32.svg`:"application/postscript"===d||"application/json"===d||"text/xml"===d||"model/vrml"===d?`${C}code-32.svg`:"application/x-zip-compressed"===d||"application/x-7z-compressed"===d||"application/x-gzip"===d||"application/x-tar"===d||"application/x-gtar"===d||"application/x-bzip2"===
d||"application/gzip"===d||"application/x-compress"===d||"application/x-apple-diskimage"===d||"application/x-rar-compressed"===d||"application/zip"===d?`${C}zip-32.svg`:d.includes("image/")?`${C}image-32.svg`:d.includes("audio/")?`${C}sound-32.svg`:d.includes("video/")?`${C}video-32.svg`:d.includes("msexcel")||d.includes("ms-excel")||d.includes("spreadsheetml")?`${C}excel-32.svg`:d.includes("msword")||d.includes("ms-word")||d.includes("wordprocessingml")?`${C}word-32.svg`:d.includes("powerpoint")||
d.includes("presentationml")?`${C}report-32.svg`:`${C}generic-32.svg`:`${C}generic-32.svg`};a.isSupportedImage=function(d){d=d.toLowerCase();return"image/bmp"===d||"image/emf"===d||"image/exif"===d||"image/gif"===d||"image/x-icon"===d||"image/jpeg"===d||"image/png"===d||"image/tiff"===d||"image/x-wmf"===d};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/support/globalCss":function(){define(["exports"],function(a){a.globalCss={anchor:"esri-widget__anchor",anchorDisabled:"esri-widget__anchor--disabled",
button:"esri-button",buttonDisabled:"esri-button--disabled",buttonHalf:"esri-button--half",buttonSecondary:"esri-button--secondary",buttonSmall:"esri-button--small",buttonTertiary:"esri-button--tertiary",buttonThird:"esri-button--third",disabled:"esri-disabled",empty:"esri-widget__content--empty",emptyIllustration:"esri-widget__content-illustration--empty",heading:"esri-widget__heading",hidden:"esri-hidden",input:"esri-input",interactive:"esri-interactive",loader:"esri-widget__loader",loaderAnimation:"esri-widget__loader-animation",
loaderText:"esri-widget__loader-text",menu:"esri-menu",menuHeader:"esri-menu__header",menuItem:"esri-menu__list-item",menuItemActive:"esri-menu__list-item--active",menuItemFocus:"esri-menu__list-item--focus",menuList:"esri-menu__list",panel:"esri-widget--panel",panelHeightOnly:"esri-widget--panel-height-only",primaryTick:"primary-tick",primaryTickAmPm:"primary-tick__ampm",primaryTickLabel:"primary-tick__label",rotating:"esri-rotating",secondaryTick:"secondary-tick",select:"esri-select",table:"esri-widget__table",
widget:"esri-widget",widgetButton:"esri-widget--button",widgetButtonActive:"esri-widget--button-active",widgetDisabled:"esri-widget--disabled"};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/support/legacyIcon":function(){define(["exports"],function(a){a.legacyIcon={close:"esri-icon-close",collapse:"esri-icon-collapse",down:"esri-icon-down",downArrow:"esri-icon-down-arrow",dragHorizontal:"esri-icon-drag-horizontal",dragVertical:"esri-icon-drag-vertical",duplicate:"esri-icon-duplicate",
expand:"esri-icon-expand",fontFallbackText:"esri-icon-font-fallback-text",forward:"esri-icon-forward",handleVertical:"esri-icon-handle-vertical",icon:"esri-icon",left:"esri-icon-left",locateCircled:"esri-icon-locate-circled",noticeTriangle:"esri-icon-notice-triangle",pause:"esri-icon-pause",play:"esri-icon-play",plus:"esri-icon-plus",radioChecked:"esri-icon-radio-checked",radioUnchecked:"esri-icon-radio-unchecked",refresh:"esri-icon-refresh",reverse:"esri-icon-reverse",right:"esri-icon-right",search:"esri-icon-search",
swap:"esri-icon-swap",table:"esri-icon-table",trash:"esri-icon-trash",up:"esri-icon-up",upArrow:"esri-icon-up-arrow",upDownArrows:"esri-icon-up-down-arrows",urbanModel:"esri-icon-urban-model",zoomInMagnifyingGlass:"esri-icon-zoom-in-magnifying-glass",zoomToObject:"esri-icon-zoom-to-object"};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/Feature/FeatureAttachments/FeatureAttachmentsViewModel":function(){define("../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ../../Attachments/AttachmentsViewModel".split(" "),
function(a,k,d,C,H,E,p){d=class extends p{constructor(F){super(F);this.title=this.description=null}};a.__decorate([k.property()],d.prototype,"description",void 0);a.__decorate([k.property()],d.prototype,"title",void 0);return d=a.__decorate([E.subclass("esri.widgets.Feature.FeatureAttachments.FeatureAttachmentsViewModel")],d)})},"esri/widgets/Feature/support/FeatureElementInfo":function(){define("../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ../../Widget ../../support/Heading ../../support/widgetUtils ../../support/jsxFactory".split(" "),
function(a,k,d,C,H,E,p,F,K,v){d=class extends p{constructor(q,e){super(q,e);this.description=null;this.headingLevel=2;this.title=null}render(){return v.tsx("div",{class:"esri-feature-element-info"},this._renderTitle(),this._renderDescription())}_renderTitle(){const {title:q}=this;return q?v.tsx(F.Heading,{class:"esri-feature-element-info__title",innerHTML:q,level:this.headingLevel}):null}_renderDescription(){const {description:q}=this;return q?v.tsx("div",{class:"esri-feature-element-info__description",
innerHTML:q,key:"description"}):null}};a.__decorate([k.property()],d.prototype,"description",void 0);a.__decorate([k.property()],d.prototype,"headingLevel",void 0);a.__decorate([k.property()],d.prototype,"title",void 0);return d=a.__decorate([E.subclass("esri.widgets.Feature.support.FeatureElementInfo")],d)})},"esri/widgets/support/Heading":function(){define(["exports","../../core/mathUtils","./globalCss","./widgetUtils","./jsxFactory"],function(a,k,d,C,H){a.Heading=function({level:E,class:p,...F},
K){E=k.clamp(Math.ceil(E),1,6);return H.tsx(`h${E}`,{...F,"aria-level":String(E),class:C.classes(d.globalCss.heading,p),role:"heading"},K)};a.incrementHeadingLevel=function(E,p=1){return k.clamp(Math.ceil(E+p),1,6)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/Feature/FeatureContent":function(){define("../../chunks/tslib.es6 ../../core/accessorSupport/decorators/property ../../core/has ../../core/Logger ../../core/RandomLCG ../../core/accessorSupport/decorators/subclass ../Widget ./FeatureContent/FeatureContentViewModel ./support/featureUtils ../support/widget ../support/jsxFactory".split(" "),
function(a,k,d,C,H,E,p,F,K,v,q){d=class extends p{constructor(e,m){super(e,m);this.viewModel=null;this._addTargetToAnchors=l=>{Array.from(l.querySelectorAll("a")).forEach(h=>{K.shouldOpenInNewTab(h.href)&&!h.hasAttribute("target")&&h.setAttribute("target","_blank")})}}get creator(){return this.viewModel?.creator}set creator(e){this.viewModel&&(this.viewModel.creator=e)}get graphic(){return this.viewModel?.graphic}set graphic(e){this.viewModel&&(this.viewModel.graphic=e)}render(){return q.tsx("div",
{class:"esri-feature-content"},"loading"===this.viewModel?.state?this._renderLoading():this._renderCreated())}_renderLoading(){return q.tsx("div",{class:"esri-feature-content__loader-container",key:"loader"},q.tsx("div",{class:"esri-feature-content__loader"}))}_renderCreated(){const e=this.viewModel?.created;return e?e instanceof HTMLElement?q.tsx("div",{afterCreate:this._attachToNode,bind:e,key:e}):v.isWidget(e)?q.tsx("div",{key:e},!e.destroyed&&e.render()):q.tsx("div",{afterCreate:this._addTargetToAnchors,
innerHTML:e,key:e}):null}_attachToNode(e){e.appendChild(this)}};a.__decorate([k.property()],d.prototype,"creator",null);a.__decorate([k.property()],d.prototype,"graphic",null);a.__decorate([k.property({type:F})],d.prototype,"viewModel",void 0);return d=a.__decorate([E.subclass("esri.widgets.Feature.FeatureContent")],d)})},"esri/widgets/Feature/FeatureContent/FeatureContentViewModel":function(){define("../../../chunks/tslib.es6 ../../../Graphic ../../../core/Accessor ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ../support/featureUtils".split(" "),
function(a,k,d,C,H,E,p,F,K,v){d=class extends d{constructor(q){super(q);this.graphic=this.destroyer=this.creator=this.created=this._loadingPromise=null;this.addHandles(C.watch(()=>this.creator,e=>{this._destroyContent();this._createContent(e)},C.initial))}destroy(){this._destroyContent()}get state(){return this._loadingPromise?"loading":"ready"}_destroyContent(){const {created:q,graphic:e,destroyer:m}=this;q&&e&&(v.graphicCallback({type:"content",value:m,event:{graphic:e}}),this._set("created",null))}async _createContent(q){var e=
this.graphic;e&&q&&(this._loadingPromise=q=v.graphicCallback({type:"content",value:q,event:{graphic:e}}),this.notifyChange("state"),e=await q,q===this._loadingPromise&&(this._loadingPromise=null,this.notifyChange("state"),this._set("created",e)))}};a.__decorate([H.property({readOnly:!0})],d.prototype,"created",void 0);a.__decorate([H.property()],d.prototype,"creator",void 0);a.__decorate([H.property()],d.prototype,"destroyer",void 0);a.__decorate([H.property({type:k})],d.prototype,"graphic",void 0);
a.__decorate([H.property({readOnly:!0})],d.prototype,"state",null);return d=a.__decorate([K.subclass("esri.widgets.Feature.FeatureContent.FeatureContentViewModel")],d)})},"esri/widgets/Feature/FeatureExpression":function(){define("require ../../chunks/tslib.es6 ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/has ../../core/Logger ../../core/RandomLCG ../../core/accessorSupport/decorators/subclass ../Widget ./FeatureContent ./FeatureFields ./FeatureMedia ./FeatureExpression/FeatureExpressionViewModel ../../chunks/componentsUtils ../support/widgetUtils ../support/jsxFactory".split(" "),
function(a,k,d,C,H,E,p,F,K,v,q,e,m,l,h,r){H=class extends K{constructor(t,z){super(t,z);this._contentWidget=null;this.viewModel=new m}initialize(){this.addHandles(d.watch(()=>this.viewModel?.contentElementViewModel,()=>this._setupExpressionWidget(),d.initial))}loadDependencies(){return l.loadCalciteComponents({loader:()=>new Promise((t,z)=>a(["../../chunks/calcite-loader"],t,z))})}destroy(){this._destroyContentWidget()}render(){const {state:t}=this.viewModel;return r.tsx("div",{class:"esri-feature-expression"},
"loading"===t?this._renderLoading():"disabled"===t?null:this._contentWidget?.render())}_renderLoading(){return r.tsx("div",{class:"esri-feature__loading-container",key:"loading-container"},r.tsx("calcite-loader",{inline:!0,label:""}))}_destroyContentWidget(){const {_contentWidget:t}=this;t&&(t.viewModel=null,t.destroy());this._contentWidget=null}_setupExpressionWidget(){const {contentElementViewModel:t,contentElement:z}=this.viewModel,w=z?.type;this._destroyContentWidget();this._contentWidget=t?"fields"===
w?new q({viewModel:t}):"media"===w?new e({viewModel:t}):"text"===w?new v({viewModel:t}):null:null;this.scheduleRender()}};k.__decorate([C.property({type:m})],H.prototype,"viewModel",void 0);return H=k.__decorate([F.subclass("esri.widgets.Feature.FeatureExpression")],H)})},"esri/widgets/Feature/FeatureFields":function(){define("../../chunks/tslib.es6 ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/has ../../core/Logger ../../core/RandomLCG ../../core/accessorSupport/decorators/subclass ../Widget ./FeatureFields/FeatureFieldsViewModel ./support/FeatureElementInfo ../support/globalCss ../support/uriUtils ../support/widgetUtils ../support/decorators/messageBundle ../support/jsxFactory".split(" "),
function(a,k,d,C,H,E,p,F,K,v,q,e,m,l,h){C=class extends F{constructor(r,t){super(r,t);this._featureElementInfo=null;this.viewModel=new K;this.messagesURIUtils=this.messages=null}initialize(){this._featureElementInfo=new v;this.addHandles(k.watch(()=>[this.viewModel?.description,this.viewModel?.title],()=>this._setupFeatureElementInfo(),k.initial))}destroy(){this._featureElementInfo?.destroy()}get attributes(){return this.viewModel.attributes}set attributes(r){this.viewModel.attributes=r}get description(){return this.viewModel.description}set description(r){this.viewModel.description=
r}get expressionInfos(){return this.viewModel.expressionInfos}set expressionInfos(r){this.viewModel.expressionInfos=r}get fieldInfos(){return this.viewModel.fieldInfos}set fieldInfos(r){this.viewModel.fieldInfos=r}get title(){return this.viewModel.title}set title(r){this.viewModel.title=r}render(){return h.tsx("div",{class:"esri-feature-fields"},this._featureElementInfo?.render(),this._renderFields())}_renderFieldInfo(r,t){var {attributes:z}=this.viewModel;const w=r.fieldName||"",u=r.label||w;z=z?
null==z[w]?"":z[w]:"";r=!!r.format?.dateFormat;z="number"!==typeof z||r?e.autoLink(this.messagesURIUtils,z):this._forceLTR(z);r={["esri-feature-fields__field-data--date"]:r};return h.tsx("tr",{key:`fields-element-info-row-${w}-${t}`},h.tsx("th",{class:"esri-feature-fields__field-header",innerHTML:u,key:`fields-element-info-row-header-${w}-${t}`}),h.tsx("td",{class:this.classes("esri-feature-fields__field-data",r),innerHTML:z,key:`fields-element-info-row-data-${w}-${t}`}))}_renderFields(){const {formattedFieldInfos:r}=
this.viewModel;return r?.length?h.tsx("table",{class:q.globalCss.table,summary:this.messages.fieldsSummary},h.tsx("tbody",null,r.map((t,z)=>this._renderFieldInfo(t,z)))):null}_setupFeatureElementInfo(){const {description:r,title:t}=this;this._featureElementInfo?.set({description:r,title:t})}_forceLTR(r){return`&lrm;${r}`}};a.__decorate([d.property()],C.prototype,"attributes",null);a.__decorate([d.property()],C.prototype,"description",null);a.__decorate([d.property()],C.prototype,"expressionInfos",
null);a.__decorate([d.property()],C.prototype,"fieldInfos",null);a.__decorate([d.property()],C.prototype,"title",null);a.__decorate([d.property({type:K,nonNullable:!0})],C.prototype,"viewModel",void 0);a.__decorate([d.property(),l.messageBundle("esri/widgets/Feature/t9n/Feature")],C.prototype,"messages",void 0);a.__decorate([d.property(),l.messageBundle("esri/widgets/support/t9n/uriUtils")],C.prototype,"messagesURIUtils",void 0);return C=a.__decorate([p.subclass("esri.widgets.Feature.FeatureFields")],
C)})},"esri/widgets/Feature/FeatureFields/FeatureFieldsViewModel":function(){define("../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ../../../popup/ExpressionInfo ../../../popup/FieldInfo ../support/featureUtils".split(" "),function(a,k,d,C,H,E,p,F,K,v){k=class extends k{constructor(q){super(q);this.title=this.fieldInfos=this.description=
this.expressionInfos=this.attributes=null}get formattedFieldInfos(){const {expressionInfos:q,fieldInfos:e}=this,m=[];e?.forEach(l=>{if(!l.hasOwnProperty("visible")||l.visible)l=l.clone(),l.label=v.getFieldInfoLabel(l,q),m.push(l)});return m}};a.__decorate([d.property()],k.prototype,"attributes",void 0);a.__decorate([d.property({type:[F]})],k.prototype,"expressionInfos",void 0);a.__decorate([d.property()],k.prototype,"description",void 0);a.__decorate([d.property({type:[K]})],k.prototype,"fieldInfos",
void 0);a.__decorate([d.property({readOnly:!0})],k.prototype,"formattedFieldInfos",null);a.__decorate([d.property()],k.prototype,"title",void 0);return k=a.__decorate([p.subclass("esri.widgets.Feature.FeatureFields.FeatureFieldsViewModel")],k)})},"esri/widgets/support/uriUtils":function(){define(["exports","../../core/string"],function(a,k){const d=[{pattern:/^\s*(https?:\/\/([^\s]+))\s*$/i,target:"_blank",label:"{messages.view}"},{pattern:/^\s*(tel:([^\s]+))\s*$/i,label:"{hierPart}"},{pattern:/^\s*(mailto:([^\s]+))\s*$/i,
label:"{hierPart}"},{pattern:/^\s*(arcgis-appstudio-player:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"App Studio Player"},{pattern:/^\s*(arcgis-collector:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Collector"},{pattern:/^\s*(arcgis-explorer:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Explorer"},{pattern:/^\s*(arcgis-navigator:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Navigator"},{pattern:/^\s*(arcgis-survey123:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",
appName:"Survey123"},{pattern:/^\s*(arcgis-trek2there:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Trek2There"},{pattern:/^\s*(arcgis-workforce:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Workforce"},{pattern:/^\s*(iform:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"iForm"},{pattern:/^\s*(flow:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"FlowFinity"},{pattern:/^\s*(lfmobile:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Laserfische"},
{pattern:/^\s*(mspbi:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Microsoft Power Bi"}];a.autoLink=function(C,H){if("string"!==typeof H||!H)return H;const E=d.find(F=>F.pattern.test(H));if(!E)return H;const p=H.match(E.pattern);C=k.replace(k.replace(E.label,{messages:C,hierPart:p?.[2]}),{appName:E.appName});return H.replace(E.pattern,`<a${E.target?` target="${E.target}"`:""} href="$1"${"_blank"===E.target?' rel\x3d"noreferrer"':""}>${C}</a>`)};Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/widgets/Feature/FeatureMedia":function(){define("require ../../chunks/tslib.es6 ../../intl ../../core/a11yUtils ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/has ../../core/Logger ../../core/RandomLCG ../../core/accessorSupport/decorators/subclass ../../renderers/support/utils ../Widget ./FeatureMedia/FeatureMediaViewModel ./support/FeatureElementInfo ./support/featureUtils ../../chunks/componentsUtils ../support/widgetUtils ../support/decorators/messageBundle ../support/jsxFactory ../../support/themeUtils ../../intl/substitute".split(" "),
function(a,k,d,C,H,E,p,F,K,v,q,e,m,l,h,r,t,z,w,u,G){d=class extends e{constructor(f,g){super(f,g);this._featureElementInfo=this._refreshIntervalInfo=this._refreshTimer=null;this._chartRootMap=new WeakMap;this.viewModel=new m;this.messages=null;this._disposeChart=b=>{this._chartRootMap.get(b)?.dispose();this._chartRootMap.delete(b)};this._createChart=async b=>{const {destroyed:c,viewModel:n}=this;if(!c&&n&&b){var {createRoot:y}=await new Promise((D,B)=>a(["../support/chartUtilsAm5"],D,B));y=await y(b);
this._chartRootMap.set(b,y);this._renderChart({mediaInfo:n.activeMediaInfo,root:y})}}}initialize(){this._featureElementInfo=new l;this.addHandles([H.watch(()=>[this.viewModel?.activeMediaInfo,this.viewModel?.activeMediaInfoIndex],()=>this._setupMediaRefreshTimer(),H.initial),H.watch(()=>[this.viewModel?.description,this.viewModel?.title],()=>this._setupFeatureElementInfo(),H.initial)])}loadDependencies(){return r.loadCalciteComponents({icon:()=>new Promise((f,g)=>a(["../../chunks/calcite-icon"],f,
g))})}destroy(){this._clearMediaRefreshTimer();this._featureElementInfo?.destroy()}get attributes(){return this.viewModel.attributes}set attributes(f){this.viewModel.attributes=f}get activeMediaInfoIndex(){return this.viewModel.activeMediaInfoIndex}set activeMediaInfoIndex(f){this.viewModel.activeMediaInfoIndex=f}get description(){return this.viewModel.description}set description(f){this.viewModel.description=f}get fieldInfoMap(){return this.viewModel.fieldInfoMap}set fieldInfoMap(f){this.viewModel.fieldInfoMap=
f}get layer(){return this.viewModel.layer}set layer(f){this.viewModel.layer=f}get mediaInfos(){return this.viewModel.mediaInfos}set mediaInfos(f){this.viewModel.mediaInfos=f}get popupTemplate(){return this.viewModel.popupTemplate}set popupTemplate(f){this.viewModel.popupTemplate=f}get relatedInfos(){return this.viewModel.relatedInfos}set relatedInfos(f){this.viewModel.relatedInfos=f}get title(){return this.viewModel.title}set title(f){this.viewModel.title=f}render(){return w.tsx("div",{bind:this,
class:"esri-feature-media",onkeyup:this._handleMediaKeyup},this._featureElementInfo?.render(),this._renderMedia())}_renderMedia(){const {formattedMediaInfoCount:f,activeMediaInfoIndex:g}=this.viewModel,b=this._renderMediaText();return f?w.tsx("div",{class:"esri-feature-media__container",key:"media-element-container"},this._renderMediaInfo(),w.tsx("div",{class:"esri-feature-media__item-navigation"},b,1<f?w.tsx("div",{class:"esri-feature-media__pagination"},this._renderMediaPageButton("previous"),w.tsx("span",
{class:"esri-feature-media__pagination-text"},G.substitute(this.messages.pageText,{index:g+1,total:f})),this._renderMediaPageButton("next")):null)):null}_renderMediaText(){var {activeMediaInfo:f}=this.viewModel;if(!f)return null;const g=f&&f.title?w.tsx("div",{class:"esri-feature-media__item-title",innerHTML:f.title,key:"media-title"}):null;f=f&&f.caption?w.tsx("div",{class:"esri-feature-media__item-caption",innerHTML:f.caption,key:"media-caption"}):null;return g||f?w.tsx("div",{class:"esri-feature-media__item-text",
key:"media-text"},g,f):null}_renderImageMediaInfo(f){if(!f.value)return null;var {_refreshIntervalInfo:g}=this;const {activeMediaInfoIndex:b,formattedMediaInfoCount:c}=this.viewModel,{value:n,refreshInterval:y,altText:D,title:B,type:J}=f,{sourceURL:O,linkURL:S}=n;f=h.shouldOpenInNewTab(S??void 0)?"_blank":"_self";const x="_blank"===f?"noreferrer":"";g=y?g:null;g=w.tsx("img",{alt:D||B,key:`media-${J}-${b}-${c}-${g?g.timestamp:0}`,src:(g?g.sourceURL:O)??void 0});return(S?w.tsx("a",{href:S,rel:x,target:f,
title:B},g):null)??g}_renderChartMediaInfo(f){const {activeMediaInfoIndex:g,formattedMediaInfoCount:b}=this.viewModel;return w.tsx("div",{afterCreate:this._createChart,afterRemoved:this._disposeChart,bind:this,class:"esri-feature-media__chart",key:`media-${f.type}-${g}-${b}`})}_renderMediaInfoType(){const {activeMediaInfo:f}=this.viewModel;return f?"image"===f.type?this._renderImageMediaInfo(f):f.type.includes("chart")?this._renderChartMediaInfo(f):null:null}_renderMediaInfo(){const {activeMediaInfo:f}=
this.viewModel;return f?w.tsx("div",{class:"esri-feature-media__item-container",key:"media-container"},w.tsx("div",{class:"esri-feature-media__item",key:"media-item-container"},this._renderMediaInfoType())):null}_renderMediaPageButton(f){if(2>this.viewModel.formattedMediaInfoCount)return null;const g=(f="previous"===f)?this.messages.previous:this.messages.next;return w.tsx("button",{"aria-label":g,bind:this,class:"esri-feature-media__pagination-button",key:f?"media-previous":"media-next",onclick:f?
this._previous:this._next,tabIndex:0,title:g,type:"button"},w.tsx("calcite-icon",{class:"esri-feature-media__pagination-icon",icon:f?"chevron-left":"chevron-right",scale:"s"}))}_setupFeatureElementInfo(){const {description:f,title:g}=this;this._featureElementInfo?.set({description:f,title:g})}_next(){this.viewModel.next()}_previous(){this.viewModel.previous()}_getRenderer(){if(this.viewModel){var {isAggregate:f,layer:g}=this.viewModel;return f&&g?.featureReduction&&"renderer"in g.featureReduction?
g.featureReduction.renderer:g?.renderer}}async _getSeriesColors(f){const {colorAm5:g}=await new Promise((c,n)=>a(["./FeatureMedia/chartCommon"],c,n)),b=new Map;f.forEach(c=>{c.color&&b.set(c,g(c.color.toCss(!0)))});return b}async _getRendererColors(){const {colorAm5:f}=await new Promise((n,y)=>a(["./FeatureMedia/chartCommon"],n,y)),g=new Map,b=this._getRenderer();if(!b)return g;const c=await q.getColorsFromRenderer(b);c.delete("default");if(!Array.from(c.values()).every(n=>1===n?.length))return g;
Array.from(c.keys()).forEach(n=>{const y=c.get(n)?.[0]?.toCss(!0);y&&g.set(n,f(y))});return g}_handleMediaKeyup(f){const {key:g}=f;"ArrowLeft"===g&&(f.stopPropagation(),this.viewModel.previous());"ArrowRight"===g&&(f.stopPropagation(),this.viewModel.next())}_canAnimateChart(){return this.viewModel?!!this.viewModel.abilities.chartAnimation&&!C.prefersReducedMotion():!1}_getChartAnimationMS(){return this._canAnimateChart()?250:0}_getChartSeriesAnimationMS(){return this._canAnimateChart()?500:0}async _renderChart(f){const {root:g,
mediaInfo:b}=f,{value:c,type:n}=b,{ResponsiveThemeAm5:y,DarkThemeAm5:D,AnimatedThemeAm5:B,ColorSetAm5:J,ThemeAm5:O,esriChartColorSet:S}=await new Promise((T,U)=>a(["./FeatureMedia/chartCommon"],T,U));var x=O.new(g);x.rule("ColorSet").set("colors",S);x.rule("ColorSet").set("reuse",!0);x=[y.new(g),x];u.isDarkTheme()&&x.push(D.new(g));this._canAnimateChart()&&x.push(B.new(g));g.setThemes(x);const I=await this._getRendererColors(),M=await this._getSeriesColors(c.series),N=J.new(g,{}),Q=(x=M.get(c.series[0]))?
{lineSettings:{stroke:x}}:void 0;x=c.series.map((T,U)=>{U=M.get(T)||I.get(T.fieldName)||N.getIndex(U);return{category:T.tooltip,value:T.value,columnSettings:{fill:U,stroke:U},...Q}}).filter(T=>"pie-chart"===n?null!=T.value&&0<T.value:!0);"pie-chart"===n?this._createPieChart(f,x):this._createXYChart(f,x)}_getDirection(){return t.isRTL(this.container)?"rtl":"ltr"}async _customizeChartTooltip(f,g="horizontal"){const {colorAm5:b}=await new Promise((c,n)=>a(["./FeatureMedia/chartCommon"],c,n));f.setAll({pointerOrientation:g});
f.get("background")?.setAll({stroke:b("rgba(50, 50, 50, 1)")});f.label.setAll({direction:this._getDirection(),oversizedBehavior:"wrap",maxWidth:200})}async _createPieChart(f,g){var {TooltipAm5:b}=await new Promise((J,O)=>a(["./FeatureMedia/chartCommon"],J,O));const {PieChartAm5:c,PieSeriesAm5:n}=await new Promise((J,O)=>a(["./FeatureMedia/pieChart"],J,O)),{mediaInfo:y,root:D}=f;var {title:B}=y;f=D.container.children.push(c.new(D,{ariaLabel:y?.altText||y?.title||"",focusable:!0,paddingBottom:5,paddingTop:5,
paddingLeft:5,paddingRight:5}));b=b.new(D,{labelText:"{category}: {valuePercentTotal.formatNumber('0.00')}%\n ({value})"});B=f.series.push(n.new(D,{name:B,valueField:"value",categoryField:"category",tooltip:b}));B.ticks.template.set("forceHidden",!0);B.labels.template.set("forceHidden",!0);B.slices.template.states.create("active",{shiftRadius:5});this._customizeChartTooltip(b);B.slices.template.setAll({ariaLabel:"{category}: {valuePercentTotal.formatNumber('0.00')}%\n ({value})",focusable:!0,templateField:"columnSettings"});
B.data.setAll(g);B.appear(this._getChartSeriesAnimationMS());f.appear(this._getChartAnimationMS());f.root.dom.classList.toggle("esri-feature-media__chart--rendered",!0)}_getMinSeriesValue(f){let g=0;f.forEach(b=>g=Math.min(b.value,g));return g}async _createColumnChart(f,g,b){const {TooltipAm5:c,ScrollbarAm5:n}=await new Promise((T,U)=>a(["./FeatureMedia/chartCommon"],T,U)),{CategoryAxisAm5:y,AxisRendererXAm5:D,ValueAxisAm5:B,AxisRendererYAm5:J,ColumnSeriesAm5:O}=await new Promise((T,U)=>a(["./FeatureMedia/xyChart"],
T,U)),{mediaInfo:S,root:x}=g,{value:I,title:M}=S;f.setAll({wheelX:"panX",wheelY:"zoomX"});g=f.xAxes.push(y.new(x,{renderer:D.new(x,{inversed:t.isRTL(this.container)}),categoryField:"category"}));g.get("renderer").labels.template.setAll({forceHidden:!0});var N=f.yAxes.push(B.new(x,{renderer:J.new(x,{inside:!1}),min:this._getMinSeriesValue(I.series)}));N.get("renderer").labels.template.setAll({direction:this._getDirection()});const Q=c.new(x,{labelText:"{categoryX}"});N=f.series.push(O.new(x,{name:M,
xAxis:g,yAxis:N,valueYField:"value",categoryXField:"category",tooltip:Q}));this._customizeChartTooltip(Q);N.columns.template.setAll({ariaLabel:"{categoryX}",focusable:!0,templateField:"columnSettings"});15<I.series.length&&f.set("scrollbarX",n.new(x,{orientation:"horizontal"}));g.data.setAll(b);N.data.setAll(b);N.appear(this._getChartSeriesAnimationMS());f.appear(this._getChartAnimationMS())}async _createBarChart(f,g,b){const {TooltipAm5:c,ScrollbarAm5:n}=await new Promise((T,U)=>a(["./FeatureMedia/chartCommon"],
T,U)),{CategoryAxisAm5:y,AxisRendererXAm5:D,ValueAxisAm5:B,AxisRendererYAm5:J,ColumnSeriesAm5:O}=await new Promise((T,U)=>a(["./FeatureMedia/xyChart"],T,U)),{mediaInfo:S,root:x}=g,{value:I,title:M}=S;f.setAll({wheelX:"panY",wheelY:"zoomY"});g=f.yAxes.push(y.new(x,{renderer:J.new(x,{inversed:!0}),categoryField:"category"}));g.get("renderer").labels.template.setAll({forceHidden:!0});var N=f.xAxes.push(B.new(x,{renderer:D.new(x,{inside:!1,inversed:t.isRTL(this.container)}),min:this._getMinSeriesValue(I.series)}));
N.get("renderer").labels.template.setAll({direction:this._getDirection()});const Q=c.new(x,{labelText:"{categoryY}"});N=f.series.push(O.new(x,{name:M,xAxis:N,yAxis:g,valueXField:"value",categoryYField:"category",tooltip:Q}));this._customizeChartTooltip(Q,"vertical");N.columns.template.setAll({ariaLabel:"{categoryY}",focusable:!0,templateField:"columnSettings"});15<I.series.length&&f.set("scrollbarY",n.new(x,{orientation:"vertical"}));g.data.setAll(b);N.data.setAll(b);N.appear(this._getChartSeriesAnimationMS());
f.appear(this._getChartAnimationMS())}async _createLineChart(f,g,b){const {TooltipAm5:c,ScrollbarAm5:n}=await new Promise((U,Y)=>a(["./FeatureMedia/chartCommon"],U,Y)),{CategoryAxisAm5:y,AxisRendererXAm5:D,ValueAxisAm5:B,AxisRendererYAm5:J,LineSeriesAm5:O}=await new Promise((U,Y)=>a(["./FeatureMedia/xyChart"],U,Y)),{root:S,mediaInfo:x}=g,{value:I,title:M}=x;f.setAll({wheelX:"panX",wheelY:"zoomX"});g=f.xAxes.push(y.new(S,{renderer:D.new(S,{inversed:t.isRTL(this.container)}),categoryField:"category"}));
g.get("renderer").labels.template.setAll({forceHidden:!0});var N=f.yAxes.push(B.new(S,{renderer:J.new(S,{inside:!1}),min:this._getMinSeriesValue(I.series)}));N.get("renderer").labels.template.setAll({direction:this._getDirection()});const Q=b[0]?.lineSettings?.stroke,T=c.new(S,{getFillFromSprite:!Q,labelText:"{categoryX}"});Q&&T.get("background")?.setAll({fill:Q});N=f.series.push(O.new(S,{name:M,xAxis:g,yAxis:N,valueYField:"value",categoryXField:"category",tooltip:T}));N.strokes.template.setAll({templateField:"lineSettings"});
this._customizeChartTooltip(T,"vertical");15<I.series.length&&f.set("scrollbarX",n.new(S,{orientation:"horizontal"}));g.data.setAll(b);N.data.setAll(b);N.appear(this._getChartSeriesAnimationMS());f.appear(this._getChartAnimationMS())}async _createXYChart(f,g){const {XYChartAm5:b,XYCursorAm5:c}=await new Promise((J,O)=>a(["./FeatureMedia/xyChart"],J,O)),{root:n,mediaInfo:y}=f,{type:D}=y,B=n.container.children.push(b.new(n,{ariaLabel:y?.altText||y?.title||"",focusable:!0,panX:!0,panY:!0}));B.set("cursor",
c.new(n,{}));"column-chart"===D&&await this._createColumnChart(B,f,g);"bar-chart"===D&&await this._createBarChart(B,f,g);"line-chart"===D&&await this._createLineChart(B,f,g);B.root.dom.classList.toggle("esri-feature-media__chart--rendered",!0)}_clearMediaRefreshTimer(){const {_refreshTimer:f}=this;f&&(clearTimeout(f),this._refreshTimer=null)}_updateMediaInfoTimestamp(f){const g=Date.now();this._refreshIntervalInfo={timestamp:g,sourceURL:f&&this._getImageSource(f,g)}}_setupMediaRefreshTimer(){this._clearMediaRefreshTimer();
const {activeMediaInfo:f}=this.viewModel;"image"===f?.type&&0<f?.refreshInterval&&this._setRefreshTimeout(f)}_setRefreshTimeout(f){const {refreshInterval:g,value:b}=f;f=6E4*g;this._updateMediaInfoTimestamp(b.sourceURL);this._refreshTimer=setInterval(()=>{this._updateMediaInfoTimestamp(b.sourceURL)},f)}_getImageSource(f,g){const b=f.includes("?")?"\x26":"?",[c,n=""]=f.split("#");return`${c}${b}timestamp=${g}${n?"#":""}${n}`}};k.__decorate([E.property()],d.prototype,"_refreshIntervalInfo",void 0);k.__decorate([E.property()],
d.prototype,"attributes",null);k.__decorate([E.property()],d.prototype,"activeMediaInfoIndex",null);k.__decorate([E.property()],d.prototype,"description",null);k.__decorate([E.property()],d.prototype,"fieldInfoMap",null);k.__decorate([E.property()],d.prototype,"layer",null);k.__decorate([E.property()],d.prototype,"mediaInfos",null);k.__decorate([E.property()],d.prototype,"popupTemplate",null);k.__decorate([E.property()],d.prototype,"relatedInfos",null);k.__decorate([E.property()],d.prototype,"title",
null);k.__decorate([E.property({type:m})],d.prototype,"viewModel",void 0);k.__decorate([E.property(),z.messageBundle("esri/widgets/Feature/t9n/Feature")],d.prototype,"messages",void 0);return d=k.__decorate([v.subclass("esri.widgets.Feature.FeatureMedia")],d)})},"esri/renderers/support/utils":function(){define("exports ../../core/arrayUtils ../../core/Logger ../../core/MapUtils ../../intl/date ../../layers/support/fieldUtils ./numberUtils ../visualVariables/support/ColorStop ../../smartMapping/support/utils ../../symbols/support/utils ../../widgets/Legend/support/colorRampUtils ../../widgets/Legend/support/heatmapRampUtils".split(" "),
function(a,k,d,C,H,E,p,F,K,v,q,e){async function m(u,G,f){C.getOrCreateMapValue(u,G,()=>[]).push(...f)}async function l(u,G,f){u=C.getOrCreateMapValue(u,G,()=>new Map);for(const g of f)u.set(g.value,g.color)}function h(u){let G=u.minValue,f=u.maxValue;const g=u.isFirstBreak?"":t.gt+" ";u="percent-of-total"===u.normalizationType?t.pct:"";G=null==G?"":p.format(G);f=null==f?"":p.format(f);return g+G+u+" "+t.ld+" "+f+u}function r(u,G){return"normalizationField"in u&&u.normalizationField?{type:"normalized-field",
field:u.field,normalizationField:u.normalizationField}:"field"in u&&u.field?{type:"field",field:u.field}:"valueExpression"in u&&u.valueExpression?{type:"expression",expression:u.valueExpression,title:u.valueExpressionTitle,returnType:G}:null}const t={lte:"\x3c\x3d",gte:"\x3e\x3d",lt:"\x3c",gt:"\x3e",pct:"%",ld:"\u2013"},z={millisecond:0,second:1,minute:2,hour:3,day:4,month:5,year:6},w=H.convertDateFormatToIntlOptions("short-date");a.calculateDateFormatInterval=function(u){u=u.map(c=>new Date(c));
const G=u.length;let f=Infinity,g=null;for(let c=0;c<G-1;c++){const n=u[c];let y=Infinity,D=null;for(let B=c+1;B<G;B++){var b=u[B];b=n.getFullYear()!==b.getFullYear()&&"year"||n.getMonth()!==b.getMonth()&&"month"||n.getDate()!==b.getDate()&&"day"||n.getHours()!==b.getHours()&&"hour"||n.getMinutes()!==b.getMinutes()&&"minute"||n.getSeconds()!==b.getSeconds()&&"second"||"millisecond";const J=z[b];J<y&&(y=J,D=b)}y<f&&(f=y,g=D)}return g};a.createClassBreakLabel=h;a.createColorStops=function(u){const {values:G,
colors:f,labelIndexes:g,isDate:b}=u;return G.map((c,n)=>{var y=null;if(!g||g.includes(n)){const D=b?H.formatDate(c):p.format(c);D&&(y="",0===n?y=t.lt+" ":n===G.length-1&&(y=t.gt+" "),y+=D)}return new F({value:c,color:f[n],label:y})})};a.createUniqueValueLabel=function(u){const {value:G,domain:f,fieldInfo:g,dateFormatOptions:b}=u;u=String(G);const c=f&&"codedValues"in f&&f.codedValues?f.getName(G):null;c?u=c:null!=G&&g&&(K.isAnyDateField(g)||E.isTimeOnlyField(g))?u=K.formatAnyDate(G,b??{fieldType:g.type}):
"number"===typeof G&&(u=p.format(G));return u};a.dateFormatIntervalOptions={millisecond:"long-month-day-year-long-time",second:"long-month-day-year-long-time",minute:"long-month-day-year-short-time",hour:"long-month-day-year-short-time",day:"long-month-day-year",month:"long-month-day-year",year:"year"};a.getAttribute=r;a.getAttributes=function(u,G){const f=[];if("class-breaks"===u.type||"heatmap"===u.type)f.push(r(u,"number"));else if("unique-value"===u.type){var g=u.authoringInfo;if(g&&"relationship"===
g.type){if(g.field1&&g.field2){var b=g.field2.field;const c=g.field2.normalizationField;f.push(r({field:g.field1.field,normalizationField:g.field1.normalizationField}));f.push(r({field:b,normalizationField:c}))}}else b=u.uniqueValueInfos?.[0],g=null,b?.value&&(b=typeof b.value,"string"===b||"number"===b)&&(g=b),f.push(r(u,g)),[u.field2,u.field3].forEach(c=>c&&f.push({type:"field",field:c}))}else"attributes"in u&&u.attributes?.forEach(c=>f.push(r(c,"number")));(u=G?G(u):"visualVariables"in u?u.visualVariables:
null)&&u.forEach(c=>f.push(r(c,"number")));return k.unique(f.filter(k.isSome),(c,n)=>"field"===c.type&&"field"===n.type?c.field===n.field:"normalized-field"===c.type&&"normalized-field"===n.type?c.field===n.field&&c.normalizationField===n.normalizationField:"expression"===c.type&&"expression"===n.type?c.expression===n.expression:!1)};a.getColorsForRendererValues=async function(u){const G=new Map;if(!u)return G;if("unique-value"!==u.type||u.authoringInfo?.type)if("class-breaks"===u.type){var f=u.classBreakInfos.map(c=>
({value:c.minValue,color:v.getColorFromSymbol(c.symbol,null)})).reverse();const {field:g,valueExpression:b}=u;await l(G,g??b,f)}else"simple"===u.type&&await l(G,"default",[{value:"default",color:v.getColorFromSymbol(u.symbol,null)}]);else{f=(u.uniqueValueInfos??[]).map(B=>({value:B.value,color:v.getColorFromSymbol(B.symbol,null)}));const {field:g,field2:b,field3:c,valueExpression:n,fieldDelimiter:y}=u,D=[g,b,c].filter(Boolean).join(y||"");(D||n)&&await l(G,D||n,f)}"defaultSymbol"in u&&u.defaultSymbol&&
await l(G,"default",[{value:"default",color:v.getColorFromSymbol(u.defaultSymbol,null)}]);if("visualVariables"in u&&u.visualVariables){u=u.visualVariables.filter(g=>"color"===g.type);for(const g of u)u=await q.getRampStops(g)??[],await l(G,g.field||g.valueExpression,u)}return G};a.getColorsFromRenderer=async function(u){const G=new Map;if(!u)return G;if("visualVariables"in u&&u.visualVariables){var f=u.visualVariables.filter(b=>"color"===b.type);for(var g of f)f=(await q.getRampStops(g)??[]).map(b=>
b.color),await m(G,g.field||g.valueExpression,f)}if("heatmap"===u.type)g=e.getHeatmapRampStops(u).map(b=>b.color),await m(G,u.field||u.valueExpression,g);else if("pie-chart"===u.type){for(const b of u.attributes)await m(G,b.field||b.valueExpression,[b.color]);await m(G,"default",[u?.othersCategory?.color,v.getColorFromSymbol(u.backgroundFillSymbol,null)])}else if("dot-density"===u.type){for(const b of u.attributes)await m(G,b.field||b.valueExpression,[b.color]);await m(G,"default",[u.backgroundColor])}else if("unique-value"===
u.type)if("predominance"===u.authoringInfo?.type)for(const b of u.uniqueValueInfos??[])await m(G,b.value.toString(),[v.getColorFromSymbol(b.symbol,null)]);else{g=(u.uniqueValueInfos??[]).map(D=>v.getColorFromSymbol(D.symbol,null));const {field:b,field2:c,field3:n,valueExpression:y}=u;(b||y)&&await m(G,b||y,g);c&&await m(G,c,g);n&&await m(G,n,g)}else if("class-breaks"===u.type){g=u.classBreakInfos.map(n=>v.getColorFromSymbol(n.symbol,null));const {field:b,valueExpression:c}=u;await m(G,b??c,g)}else"simple"===
u.type&&await m(G,"default",[v.getColorFromSymbol(u.symbol,null)]);"defaultSymbol"in u&&u.defaultSymbol&&await m(G,"default",[v.getColorFromSymbol(u.defaultSymbol,null)]);G.forEach((b,c)=>{b=k.unique(b.filter(Boolean),(n,y)=>JSON.stringify(n)===JSON.stringify(y));G.set(c,b)});return G};a.setLabelsForClassBreaks=function(u){const G=u.classBreakInfos,f=u.normalizationType;let g=[];if(G?.length)if("standard-deviation"===u.classificationMethod)d.getLogger("esri.renderers.support.utils").warn("setLabelsForClassBreaks",
"cannot set labels for class breaks generated using 'standard-deviation' method.");else if(u.round){g.push(G[0].minValue);for(const b of G)g.push(b.maxValue);g=p.round(g);G.forEach((b,c)=>{b.label=h({minValue:0===c?g[0]:g[c],maxValue:g[c+1],isFirstBreak:0===c,normalizationType:f})})}else G.forEach((b,c)=>{b.label=h({minValue:b.minValue,maxValue:b.maxValue,isFirstBreak:0===c,normalizationType:f})})};a.timelineDateFormatOptions=w;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/renderers/support/numberUtils":function(){define(["exports",
"../../intl","../../intl/number"],function(a,k,d){function C(q,e){return q-e}function H(q,e){let m;m=Number(q.toFixed(e));m<q?q=m+1/10**e:(q=m,m-=1/10**e);m=Number(m.toFixed(e));q=Number(q.toFixed(e));return[m,q]}function E(q,e,m,l,h){q=F(q,e,m,l);e=null==q.next||q.next<=h;return(null==q.previous||q.previous<=h)&&e||q.previous+q.next<=2*h}function p(q){q=String(q);var e=q.match(K);if(e?.[1])return{integer:e[1].split("").length,fractional:e[3]?e[3].split("").length:0};if(q.toLowerCase().includes("e")&&
(e=q.split("e"),q=e[0],e=e[1],q&&e)){q=Number(q);e=Number(e);const m=0<e;m||(e=Math.abs(e));q=p(q);m?(q.integer+=e,q.fractional=e>q.fractional?0:q.fractional-e):(q.fractional+=e,q.integer=e>q.integer?1:q.integer-e);return q}return{integer:0,fractional:0}}function F(q,e,m,l){const h={previous:null,next:null};if(null!=m){const r=q-m;h.previous=Math.floor(Math.abs(100*(e-m-r)/r))}null!=l&&(q=l-q,h.next=Math.floor(Math.abs(100*(l-e-q)/q)));return h}const K=/^-?(\d+)(\.(\d+))?$/i,v={maximumFractionDigits:20};
a.format=function(q){return d.formatNumber(q,v)};a.numDigits=p;a.percentChange=F;a.round=function(q,e={}){q=q.slice();const {tolerance:m=2,strictBounds:l=!1,indexes:h=q.map((t,z)=>z)}=e;h.sort(C);for(e=0;e<h.length;e++){const t=h[e],z=q[t],w=0===t?null:q[t-1],u=t===q.length-1?null:q[t+1],G=p(z).fractional;if(G){let f=0,g=!1;for(var r=void 0;f<=G&&!g;)r=H(z,f),r=l&&0===e?r[1]:r[0],g=E(z,r,w,u,m),f++;g&&(q[t]=r)}}return q};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/support/utils":function(){define("require exports ../../Color ../../symbols ../../core/asyncUtils ../../core/has ../../core/screenUtils ../../core/libs/gl-matrix-2/factories/vec3f64 ../../layers/effects/jsonUtils ./cimSymbolUtils ./gfxUtils ./Symbol3DMaterial".split(" "),
function(a,k,d,C,H,E,p,F,K,v,q,e){function m(b){b=b.symbolLayers;if(!b)return null;let c=null;b.forEach(n=>{"object"===n.type&&n.resource?.href||(c="water"===n.type?n.color:n.material?n.material.color:null)});return c?new d(c):null}function l(b,c){if(null==c||null==b)return b;b=b.toRgba();b[3]*=c;return new d(b)}function h(b,c,n){if(b=b.symbolLayers){var y=D=>{c=c??D??(null!=n?g:null);return l(c,n)};b.forEach(D=>{if("object"!==D.type||!D.resource?.href||c)if("water"===D.type)D.color=y(D.color);else{const B=
y(null!=D.material?D.material.color:null);null==D.material?D.material=new e.Symbol3DMaterial({color:B}):D.material.color=B;null!=n&&"outline"in D&&null!=D.outline?.color&&(D.outline.color=l(D.outline.color,n))}})}}async function r(b,c){(b=b.symbolLayers)&&await H.forEach(b,async n=>t(n,c))}async function t(b,c){switch(b.type){case "extrude":b.size="number"===typeof c[2]?c[2]:0;break;case "icon":case "line":case "text":c=z(c);null!=c&&(b.size=c);break;case "path":const n=u(c,F.ONES,[b.width,void 0,
b.height]);b.width=f(c[0],b.width,1,n);b.height=f(c[2],b.height,1,n);break;case "object":await w(b,c)}}function z(b){for(const c of b)if("number"===typeof c)return c;return null}async function w(b,c){const {resourceSize:n,symbolSize:y}=await G(b),D=u(c,n,y);b.width=f(c[0],y[0],n[0],D);b.depth=f(c[1],y[1],n[1],D);b.height=f(c[2],y[2],n[2],D)}function u(b,c,n){for(let y=0;3>y;y++){const D=b[y];switch(D){case "symbol-value":return b=n[y],null!=b?b/c[y]:1;case "proportional":break;default:if(D&&c[y])return D/
c[y]}}return 1}async function G(b){var {computeObjectLayerResourceSize:c}=await new Promise((O,S)=>a(["./symbolLayerUtils"],O,S));c=await c(b,10);const {width:n,height:y,depth:D}=b;b=[n,D,y];let B=1;for(var J=0;3>J;J++){const O=b[J];if(null!=O){B=O/c[J];break}}for(J=0;3>J;J++)null==b[J]&&(b[J]=c[J]*B);return{resourceSize:c,symbolSize:b}}function f(b,c,n,y){switch(b){case "proportional":return n*y;case "symbol-value":return null!=c?c:n;default:return b}}const g=new d("white");k.applyColorToSymbol=
function(b,c,n){if(b&&(c||null!=n))if(c&&=new d(c),C.isSymbol3D(b))h(b,c,n);else if(C.isSymbol2D(b)){if(c=c??b.color)b.color=l(c,n);null!=n&&"outline"in b&&b.outline?.color&&(b.outline.color=l(b.outline.color,n))}};k.applyOpacityToColor=l;k.applyRotationToSymbol=function(b,c,n){b&&null!=c&&(C.isSymbol3D(b)?(b=b.symbolLayers)&&b.forEach(y=>{if("object"===y.type)switch(n){case "tilt":y.tilt=(y.tilt??0)+c;break;case "roll":y.roll=(y.roll??0)+c;break;default:y.heading=(y.heading??0)+c}"icon"===y.type&&
(y.angle+=c)}):!C.isSymbol2D(b)||"simple-marker"!==b.type&&"picture-marker"!==b.type&&"text"!==b.type||(b.angle+=c))};k.applySizesToSymbol=async function(b,c){if(b&&c){if(C.isSymbol3D(b))return r(b,c);if(C.isSymbol2D(b)&&(c=z(c),null!=c))switch(b.type){case "simple-marker":b.size=c;break;case "picture-marker":const n=b.width/b.height;1<n?(b.width=c,b.height=c*n):(b.width=c*n,b.height=c);break;case "simple-line":b.width=c;break;case "text":b.font.size=c}}};k.fetchWebStyleSymbol=async function(b,c){const n=
await b.fetchSymbol(c);return n?n:b.fetchCIMSymbol(c)};k.getCSSFilterFromEffectList=function(b){if(!b)return null;b=b.effects.filter(c=>"bloom"!==c.type).map(c=>c.toJSON());return K.effectFunctionsFromJSON(b)};k.getColorFromSymbol=function(b,c){if(!b)return null;let n=null;C.isSymbol3D(b)?n=m(b):C.isSymbol2D(b)&&(n="cim"===b.type?v.getCIMSymbolColor(b):b.color?new d(b.color):null);return n?l(n,c):null};k.getIconHref=function(b){return b.resource?.href??""};k.getSymbolOutlineSize=function(b){return b?
C.isSymbol3D(b)?(b=(b=b.symbolLayers?.at(-1))&&"outline"in b?b?.outline?.size:void 0,null!=b?b:0):p.px2pt(q.getStroke(b)?.width):0};k.isVolumetricSymbol=function(b){if(null==b||!("symbolLayers"in b)||null==b.symbolLayers)return!1;switch(b.type){case "point-3d":return b.symbolLayers.some(c=>"object"===c.type);case "line-3d":return b.symbolLayers.some(c=>"path"===c.type);case "polygon-3d":return b.symbolLayers.some(c=>"object"===c.type||"extrude"===c.type);default:return!1}};k.symbolHasExtrudeSymbolLayer=
function(b){return null!=b&&"polygon-3d"===b.type&&b.symbolLayers.some(c=>"extrude"===c.type)};Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/support/cimSymbolUtils":function(){define(["exports","../../Color","../cim/utils"],function(a,k,d){function C(e){e=d.toCIMSymbolJSON(e);if("CIMTextSymbol"===e?.type)return e.height??0;let m=0;if(e?.symbolLayers)for(const l of e.symbolLayers)d.isCIMMarker(l)&&null!=l.size&&l.size>m?m=l.size:d.isCIMStroke(l)&&null!=l.width&&l.width>
m?m=l.width:d.isCIMFill(l);return m}function H(e,m,l,h){if(e)if("CIMTextSymbol"===e.type)null!=e.height&&(e.height*=m);else{if(l&&e.effects)for(const r of e.effects)F(r,m);if(e.symbolLayers)for(const r of e.symbolLayers)switch(r.type){case "CIMPictureMarker":case "CIMVectorMarker":E(r,m,h);break;case "CIMPictureStroke":case "CIMSolidStroke":!h?.preserveOutlineWidth&&r.width&&(r.width*=m);break;case "CIMPictureFill":r.height&&(r.height*=m);r.offsetX&&(r.offsetX*=m);r.offsetY&&(r.offsetY*=m);break;
case "CIMHatchFill":H(r.lineSymbol,m,!0,{...h,preserveOutlineWidth:!1}),r.offsetX&&(r.offsetX*=m),r.offsetY&&(r.offsetY*=m),r.separation&&(r.separation*=m)}}}function E(e,m,l){if(e&&(e.markerPlacement&&p(e.markerPlacement,m),e.offsetX&&(e.offsetX*=m),e.offsetY&&(e.offsetY*=m),e.anchorPoint&&"Absolute"===e.anchorPointUnits&&(e.anchorPoint={x:e.anchorPoint.x*m,y:e.anchorPoint.y*m}),e.size=null!=e.size?e.size*m:0,"CIMVectorMarker"===e.type&&e.markerGraphics))for(const h of e.markerGraphics)e.scaleSymbolsProportionally||
H(h.symbol,m,!0,l)}function p(e,m){d.isCIMMarkerStrokePlacement(e)&&e.offset&&(e.offset*=m);switch(e.type){case "CIMMarkerPlacementAlongLineRandomSize":case "CIMMarkerPlacementAlongLineSameSize":e.customEndingOffset&&(e.customEndingOffset*=m);e.offsetAlongLine&&(e.offsetAlongLine*=m);if(e.placementTemplate&&e.placementTemplate.length){var l=e.placementTemplate.map(h=>h*m);e.placementTemplate=l}break;case "CIMMarkerPlacementAlongLineVariableSize":e.maxRandomOffset&&(e.maxRandomOffset*=m);e.placementTemplate&&
e.placementTemplate.length&&(l=e.placementTemplate.map(h=>h*m),e.placementTemplate=l);break;case "CIMMarkerPlacementOnLine":e.startPointOffset&&(e.startPointOffset*=m);break;case "CIMMarkerPlacementAtExtremities":e.offsetAlongLine&&(e.offsetAlongLine*=m);break;case "CIMMarkerPlacementAtRatioPositions":e.beginPosition&&(e.beginPosition*=m);e.endPosition&&(e.endPosition*=m);break;case "CIMMarkerPlacementPolygonCenter":e.offsetX&&(e.offsetX*=m);e.offsetY&&(e.offsetY*=m);break;case "CIMMarkerPlacementInsidePolygon":e.offsetX&&
(e.offsetX*=m),e.offsetY&&(e.offsetY*=m),e.stepX&&(e.stepX*=m),e.stepY&&(e.stepY*=m)}}function F(e,m){switch(e.type){case "CIMGeometricEffectArrow":case "CIMGeometricEffectDonut":e.width&&(e.width*=m);break;case "CIMGeometricEffectBuffer":e.size&&(e.size*=m);break;case "CIMGeometricEffectCut":e.beginCut&&(e.beginCut*=m);e.endCut&&(e.endCut*=m);e.middleCut&&(e.middleCut*=m);break;case "CIMGeometricEffectDashes":e.customEndingOffset&&(e.customEndingOffset*=m);e.offsetAlongLine&&(e.offsetAlongLine*=
m);if(e.dashTemplate&&e.dashTemplate.length){const l=e.dashTemplate.map(h=>h*m);e.dashTemplate=l}break;case "CIMGeometricEffectExtension":case "CIMGeometricEffectJog":case "CIMGeometricEffectRadial":e.length&&(e.length*=m);break;case "CIMGeometricEffectMove":e.offsetX&&(e.offsetX*=m);e.offsetY&&(e.offsetY*=m);break;case "CIMGeometricEffectOffset":case "CIMGeometricEffectOffsetTangent":e.offset&&(e.offset*=m);break;case "CIMGeometricEffectRegularPolygon":e.radius&&(e.radius*=m);break;case "CIMGeometricEffectTaperedPolygon":e.fromWidth&&
(e.fromWidth*=m);e.length&&(e.length*=m);e.toWidth&&(e.toWidth*=m);break;case "CIMGeometricEffectWave":e.amplitude&&(e.amplitude*=m),e.period&&(e.period*=m)}}function K(e,m){if(e){var l="CIMTextSymbol"===e.type?e.symbol:e;e="CIMPolygonSymbol"===e.type;if(l?.symbolLayers)for(const h of l.symbolLayers)if(!(h.colorLocked||e&&(d.isCIMStroke(h)||d.isCIMMarker(h)&&h.markerPlacement&&d.isCIMMarkerStrokePlacement(h.markerPlacement))))switch(h.type){case "CIMPictureMarker":case "CIMPictureStroke":case "CIMPictureFill":h.tintColor&&
v(m,h.tintColor);break;case "CIMVectorMarker":h.markerGraphics?.forEach(r=>{K(r.symbol,m)});break;case "CIMSolidStroke":case "CIMSolidFill":v(m,h.color);break;case "CIMHatchFill":K(h.lineSymbol,m)}}}function v(e,m){for(const l of e)if(l.join(".")===m.join("."))return;e.push(m)}function q(e,m,l){if(e){var h="CIMTextSymbol"===e.type?e.symbol:e;e="CIMPolygonSymbol"===h?.type;if(h?.symbolLayers)for(const r of h.symbolLayers)if(!r.colorLocked){if(e)if(l){if({layersToColor:h}=l,(d.isCIMStroke(r)||d.isCIMMarker(r)&&
r.markerPlacement&&d.isCIMMarkerStrokePlacement(r.markerPlacement))&&"fill"===h||d.isCIMFill(r)&&"outline"===h)continue}else if(d.isCIMStroke(r)||d.isCIMMarker(r)&&r.markerPlacement&&d.isCIMMarkerStrokePlacement(r.markerPlacement))continue;h=m.toArray();switch(r.type){case "CIMPictureMarker":case "CIMPictureStroke":case "CIMPictureFill":r.tintColor=h;break;case "CIMVectorMarker":r.markerGraphics?.forEach(t=>{q(t.symbol,m,l)});break;case "CIMSolidStroke":case "CIMSolidFill":r.color=h;break;case "CIMHatchFill":q(r.lineSymbol,
m,l)}}}}a.applyCIMSymbolColor=function(e,m,l){m instanceof k||(m=new k(m));(e=d.toCIMSymbolJSON(e))&&q(e,m,l)};a.applyCIMSymbolRotation=function(e,m,l=!1){e=d.toCIMSymbolJSON(e);l&&(m=360-m);if("CIMTextSymbol"===e?.type)e.angle=m;else if("CIMPointSymbol"===e?.type&&e.symbolLayers){l=m-(e.angle||0);for(const h of e.symbolLayers)if(d.isCIMMarker(h)){let r=h.rotation||0;r=h.rotateClockwise?r-l:r+l;h.rotation=r}e.angle=m}};a.getCIMSymbolColor=function(e){e=d.toCIMSymbolJSON(e);const m=[];K(e,m);return m.length?
new k(d.normalizeAlpha(m[0])):null};a.getCIMSymbolRotation=function(e,m=!1){e=d.toCIMSymbolJSON(e);return"CIMTextSymbol"===e?.type||"CIMPointSymbol"===e?.type?(e=e.angle,null!=e&&m?360-e:e??0):0};a.getCIMSymbolSize=C;a.getCIMSymbolType=function(e){e=d.toCIMSymbolJSON(e);if(!e)return null;switch(e.type){case "CIMPointSymbol":return"CIMPointSymbol";case "CIMLineSymbol":return"CIMLineSymbol";case "CIMPolygonSymbol":return"CIMPolygonSymbol";case "CIMTextSymbol":return"CIMTextSymbol";case "CIMMeshSymbol":return"CIMMeshSymbol";
default:return null}};a.scaleCIMMarker=E;a.scaleCIMSymbol=H;a.scaleCIMSymbolTo=function(e,m,l){if(e){var h=d.toCIMSymbolJSON(e);e=C(e);if(0===e){if(h)if("CIMTextSymbol"===h.type)h.height=m;else if(h.symbolLayers)for(const r of h.symbolLayers)switch(r.type){case "CIMPictureMarker":case "CIMVectorMarker":r.size=m;break;case "CIMPictureStroke":case "CIMSolidStroke":r.width=m}}else H(h,m/e,!1,l)}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/support/gfxUtils":function(){define("exports ../../assets ../../Color ../../request ../../core/LRUCache ../../core/screenUtils ./cimSymbolUtils".split(" "),
function(a,k,d,C,H,E,p){function F(m){if(!m)return null;let l=null;switch(m.type){case "simple-fill":case "picture-fill":case "simple-marker":l=F(m.outline);break;case "simple-line":const h=E.pt2px(m.width);null!=m.style&&"none"!==m.style&&0!==h&&(l={color:m.color,style:e(m.style),width:h,cap:m.cap,join:"miter"===m.join?E.pt2px(m.miterLimit):m.join},l.dashArray=K(l).join(",")||"none");break;default:l=null}return l}function K(m){if(!m?.style)return[];const {dashArray:l,style:h,width:r}=m;if("string"===
typeof l&&"none"!==l)return l.split(",").map(w=>Number(w));const t=r??0,z=v.has(h)?v.get(h).map(w=>w*t):[];if("butt"!==m.cap)for(const [w,u]of z.entries())z[w]=1===w%2?u+t:Math.max(u-t,1);return z}const v=new Map([["dash",[4,3]],["dashdot",[4,3,1,3]],["dot",[1,3]],["longdash",[8,3]],["longdashdot",[8,3,1,3]],["longdashdotdot",[8,3,1,3,1,3]],["shortdash",[4,1]],["shortdashdot",[4,1,1,1]],["shortdashdotdot",[4,1,1,1,1,1]],["shortdot",[1,1]],["solid",[]]]),q=new H.LRUCache(1E3),e=(()=>{const m={};return l=>
{if(m[l])return m[l];const h=l.replaceAll("-","");return m[l]=h}})();d=new d([128,128,128]);a.defaultThematicColor=d;a.dekebabifyLineStyle=e;a.getDashArray=K;a.getFill=function(m){const l=m.style;let h=null;if(m)switch(m.type){case "simple-marker":"cross"!==l&&"x"!==l&&(h=m.color);break;case "simple-fill":l&&"solid"!==l?"none"!==l&&(h={type:"pattern",x:0,y:0,src:k.getAssetUrl(`esri/symbols/patterns/${l}.png`),width:5,height:5}):h=m.color;break;case "picture-fill":h={type:"pattern",src:m.url,width:E.pt2px(m.width)*
m.xscale,height:E.pt2px(m.height)*m.yscale,x:E.pt2px(m.xoffset),y:E.pt2px(m.yoffset)};break;case "text":h=m.color;break;case "cim":h=p.getCIMSymbolColor(m)}return h};a.getPatternUrlWithColor=function(m,l){const h=m+"-"+l;return void 0!==q.get(h)?Promise.resolve(q.get(h)):C(m,{responseType:"image"}).then(r=>{r=r.data;const t=r.naturalWidth,z=r.naturalHeight,w=document.createElement("canvas");w.width=t;w.height=z;const u=w.getContext("2d");u.fillStyle=l;u.fillRect(0,0,t,z);u.globalCompositeOperation=
"destination-in";u.drawImage(r,0,0);r=w.toDataURL();q.put(h,r);return r})};a.getStroke=F;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/Legend/support/colorRampUtils":function(){define(["require","exports","../../../Color","./utils"],function(a,k,d,C){function H(v,q){const e=[],m=v.length-1;5===v.length?e.push(0,2,4):e.push(0,m);return v.map((l,h)=>e.includes(h)?C.createStopLabel(l,h,m,q):null)}async function E(v,q,e){e=new d(e??K);v=(await new Promise((m,l)=>a(["../../../renderers/visualVariables/support/visualVariableUtils"],
m,l))).getOpacity(q,v);null!=v&&(e.a=v);return e}function p(v,q){const {startIndex:e,endIndex:m,weight:l}=F(v,q);if(e===m)return q[e].color;v=d.blendColors(q[e].color,q[m].color,l);return new d(v)}function F(v,q){let e=0,m=q.length-1;q.some((l,h)=>{if(v<l.value)return m=h,!0;e=h;return!1});return{startIndex:e,endIndex:m,weight:(v-q[e].value)/(q[m].value-q[e].value)}}const K=new d([64,64,64]);k.getColorFromPointCloudStops=p;k.getRampStops=async function(v,q,e){let m=!1,l=[],h=[];if(v.stops){var r=
v.stops;l=r.map(z=>z.value);(m=r.some(z=>!!z.label))&&(h=r.map(z=>z.label))}r=l[l.length-1];if(null==l[0]&&null==r)return null;const t=m?null:H(l,e);return(await Promise.all(l.map(async(z,w)=>{const u="opacity"===v.type?await E(z,v,q):(await new Promise((G,f)=>a(["../../../renderers/visualVariables/support/visualVariableUtils"],G,f))).getColor(v,z);return{value:z,color:u,label:m?h[w]:t?.[w]??""}}))).reverse()};k.getRampStopsForPointCloud=function(v){let q=!1,e=[],m=[];e=v.map(r=>r.value);(q=v.some(r=>
!!r.label))&&(m=v.map(r=>r.label??""));const l=e[e.length-1];if(null==e[0]&&null==l)return null;const h=q?null:H(e);return e.map((r,t)=>{const z=p(r,v);return{value:r,color:z,label:q?m[t]:h?.[t]??""}}).reverse()};k.getStretchRampStops=function(v,q){let e=[];if(v&&"multipart"===v.type)v.colorRamps.reverse().forEach((m,l)=>{0===l?e.push({value:q.max,color:new d(m.toColor),label:"high"}):e.push({value:null,color:new d(m.toColor),label:""});l===v.colorRamps.length-1?e.push({value:q.min,color:new d(m.fromColor),
label:"low"}):e.push({value:null,color:new d(m.fromColor),label:""})});else{let m,l;v&&"algorithmic"===v.type?(m=v.fromColor,l=v.toColor):(m=[0,0,0,1],l=[255,255,255,1]);e=[{value:q.max,color:new d(l),label:"high"},{value:q.min,color:new d(m),label:"low"}]}return e};Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/Legend/support/utils":function(){define("require exports ../../../symbols ../../../core/timeUtils ../../../layers/support/fieldUtils ../../../renderers/support/numberUtils ../../../smartMapping/support/utils ../../../symbols/SimpleLineSymbol".split(" "),
function(a,k,d,C,H,E,p,F){async function K(e){if(!("visualVariables"in e&&e.visualVariables))return null;e=e.visualVariables.find(h=>"color"===h.type);if(!e)return null;var m=null,l=null;if(e.stops){if(1===e.stops.length)return e.stops[0].color;m=e.stops[0].value;l=e.stops[e.stops.length-1].value}m=null!=m&&null!=l?m+(l-m)/2:0;({getColor:l}=await new Promise((h,r)=>a(["../../../renderers/visualVariables/support/visualVariableUtils"],h,r)));return l(e,m)??null}function v(e,m){if(!m.field)return null;
if("featureReduction"in e)switch(e.featureReduction?.type){case "cluster":case "binning":const l=e.featureReduction.fields.find(({name:h})=>h.toLowerCase()===m.field.toLowerCase());return l&&"getField"in e?e.getField(l.onStatisticField):null}return"getField"in e?e.getField?.(m.field):null}function q(e,m){e="popupTemplate"in e?e.popupTemplate?.fieldInfos:null;if(e?.length&&m)return e.find(l=>l.fieldName?.toLowerCase()===m.toLowerCase())?.format?.dateFormat}k.createStopLabel=function(e,m,l,h){let r=
"";0===m?r="\x3c ":m===l&&(r="\x3e ");e=h?p.formatAnyDate(e,h):E.format(e);return r+e};k.getDateFormatOptions=function(e,m,l){const h=v(e,m);if(!h||!p.isAnyDateField(h)&&!H.isTimeOnlyField(h))return null;var r=q(e,h.name);if(!r&&"date"===h.type){let t=r=0;m.stops?(r=m.stops?.at(0)?.value??r,t=m.stops?.at(-1)?.value??t):"minDataValue"in m&&"maxDataValue"in m&&(r=m.minDataValue??r,t=m.maxDataValue??t);r=t-r>2*C.millisecondsPerTimeUnit.days?"short-date":"short-date-short-time"}return{fieldType:h.type,
format:r,timeZoneOptions:{layerTimeZone:"preferredTimeZone"in e?e.preferredTimeZone:null,viewTimeZone:l,datesInUnknownTimezone:"datesInUnknownTimezone"in e&&e.datesInUnknownTimezone}}};k.getMedianColor=K;k.getReferenceSizeAuthoringInfoVisualVariable=function(e){if("authoringInfo"in e)return e.authoringInfo?.visualVariables?.find(({theme:m})=>"reference-size"===m)};k.getSymbolForFlowRenderer=async function(e,m){const l=e.trailCap,h=e.trailWidth||1;e=m||await K(e)||e.color;return new F({cap:l,color:e,
width:h})};k.rgbImgSource=["data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAAAAAAAAAHqZRakAAAANUlEQVQ4jWPMy8v7z0BFwMLAwMAwcdIkqhiWn5fHwEQVk5DAqIGjBo4aOGrgqIEQwEjtKgAATl0Hu6JrzFUAAAAASUVORK5CYII\x3d","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAAAAAAAAAHqZRakAAAANUlEQVQ4jWPMy8v7z0BFwMLAwMAwaeIkqhiWl5/HwEQVk5DAqIGjBo4aOGrgqIEQwEjtKgAATl0Hu6sKxboAAAAASUVORK5CYII\x3d","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAAAAAAAAAHqZRakAAAANUlEQVQ4jWPMy8v7z0BFwMLAwMAwadJEqhiWl5fPwEQVk5DAqIGjBo4aOGrgqIEQwEjtKgAATl0Hu75+IUcAAAAASUVORK5CYII\x3d"];
k.specialCharsGreaterThan="\x3e";k.specialCharsLessThan="\x3c";Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/Legend/support/heatmapRampUtils":function(){define(["exports","../../../renderers/support/HeatmapColorStop"],function(a,k){a.getHeatmapRampStops=function(d){if(!d.colorStops)return[];const C=[...d.colorStops].filter(E=>0<E.color?.a);let H=C.length-1;if(C&&C[0]){const E=C[H];E&&1!==E.ratio&&(C.push(new k({ratio:1,color:E.color})),H++)}return C.map((E,p)=>{let F=
"";0===p?F=d.legendOptions?.minLabel||"low":p===H&&(F=d.legendOptions?.maxLabel||"high");return{color:E.color,label:F,ratio:E.ratio}}).reverse()};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/Feature/FeatureMedia/FeatureMediaViewModel":function(){define("../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/arrayUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/decorators/cast ../../../core/has ../../../core/accessorSupport/decorators/subclass ../../../popup/FieldInfo ../../../popup/content/support/ChartMediaInfoValueSeries ../support/featureUtils ../support/relatedFeatureUtils".split(" "),
function(a,k,d,C,H,E,p,F,K,v,q){const e={chartAnimation:!0};k=class extends k{constructor(m){super(m);this.abilities={...e};this.activeMediaInfoIndex=0;this.expressionAttributes=this.formattedAttributes=this.fieldInfoMap=this.description=this.attributes=null;this.isAggregate=!1;this.title=this.relatedInfos=this.popupTemplate=this.mediaInfos=this.layer=null}castAbilities(m){return{...e,...m}}get activeMediaInfo(){return this.formattedMediaInfos[this.activeMediaInfoIndex]||null}get formattedMediaInfos(){return this._formatMediaInfos()||
[]}get formattedMediaInfoCount(){return this.formattedMediaInfos.length}setActiveMedia(m){this._setContentElementMedia(m)}next(){this._pageContentElementMedia(1)}previous(){this._pageContentElementMedia(-1)}_setContentElementMedia(m){const {formattedMediaInfoCount:l}=this;this.activeMediaInfoIndex=(m+l)%l}_pageContentElementMedia(m){const {activeMediaInfoIndex:l}=this;this._setContentElementMedia(l+m)}_formatMediaInfos(){const {mediaInfos:m,layer:l}=this,h=this.attributes??{},r=this.formattedAttributes??
{},t=this.expressionAttributes??{},z=this.fieldInfoMap??new Map;return m?.map(w=>{w=w?.clone();if(!w)return null;w.title=v.substituteFieldsInLinksAndAttributes({attributes:h,fieldInfoMap:z,globalAttributes:r,expressionAttributes:t,layer:l,text:w.title});w.caption=v.substituteFieldsInLinksAndAttributes({attributes:h,fieldInfoMap:z,globalAttributes:r,expressionAttributes:t,layer:l,text:w.caption});w.altText=v.substituteFieldsInLinksAndAttributes({attributes:h,fieldInfoMap:z,globalAttributes:r,expressionAttributes:t,
layer:l,text:w.altText});if("image"===w.type){if(!w.value)return;this._setImageValue({value:w.value,formattedAttributes:r,layer:l});return w.value.sourceURL?w:void 0}if("pie-chart"===w.type||"line-chart"===w.type||"column-chart"===w.type||"bar-chart"===w.type){if(!w.value)return;this._setChartValue({value:w.value,chartType:w.type,attributes:h,formattedAttributes:r,layer:l,expressionAttributes:t});return w}return null}).filter(d.isSome)??[]}_setImageValue(m){const l=this.fieldInfoMap??new Map,{value:h,
formattedAttributes:r,layer:t}=m,{linkURL:z,sourceURL:w}=h;w&&(m=v.fixTokens(w,t),h.sourceURL=v.substituteAttributes({formattedAttributes:r,template:m,fieldInfoMap:l}));z&&(m=v.fixTokens(z,t),h.linkURL=v.substituteAttributes({formattedAttributes:r,template:m,fieldInfoMap:l}))}_setChartValue(m){const {value:l,attributes:h,formattedAttributes:r,chartType:t,layer:z,expressionAttributes:w}=m,{popupTemplate:u,relatedInfos:G}=this,{fields:f,normalizeField:g}=l;l.fields=v.getFixedFieldNames(f,z);g&&(l.normalizeField=
v.getFixedFieldName(g,z));if(f.some(c=>!!(null!=r[c]||v.isRelatedField(c)&&G?.size))){var b=u?.fieldInfos??[];f.forEach((c,n)=>{n=l.colors?.[n];v.isRelatedField(c)?l.series=[...l.series,...this._getRelatedChartInfos({fieldInfos:b,fieldName:c,formattedAttributes:r,chartType:t,value:l,color:n})]:(c=this._getChartOption({value:l,attributes:h,chartType:t,formattedAttributes:r,expressionAttributes:w,fieldName:c,fieldInfos:b,color:n}),l.series.push(c))})}}_getRelatedChartInfos(m){const {fieldInfos:l,fieldName:h,
formattedAttributes:r,chartType:t,value:z,color:w}=m,u=[],G=q.getRelatedFieldInfo(h);m=G&&this.relatedInfos?.get(G.layerId.toString());if(!m)return u;const {relatedFeatures:f,relation:g}=m;if(!g||!f)return u;({cardinality:m}=g);f.forEach(b=>{const {attributes:c}=b;c&&Object.keys(c).forEach(n=>{n===G.fieldName&&u.push(this._getChartOption({value:z,attributes:c,formattedAttributes:r,fieldName:h,chartType:t,relatedFieldName:n,hasMultipleRelatedFeatures:1<f?.length,fieldInfos:l,color:w}))})});return"one-to-many"===
m||"many-to-many"===m?u:[u[0]]}_getTooltip({label:m,value:l,chartType:h}){return"pie-chart"===h?`${m}`:`${m}: ${l}`}_getChartOption(m){const {value:l,attributes:h,formattedAttributes:r,expressionAttributes:t,fieldName:z,relatedFieldName:w,fieldInfos:u,chartType:G,hasMultipleRelatedFeatures:f,color:g}=m;var b=this.layer,c=this.fieldInfoMap??new Map;const {normalizeField:n,tooltipField:y}=l;m=n?v.isRelatedField(n)?h[q.getRelatedFieldInfo(n).fieldName]:h[n]:null;var D=v.isExpressionField(z)&&t&&void 0!==
t[z]?t[z]:w&&void 0!==h[w]?h[w]:void 0!==h[z]?h[z]:r[z];m=new K({fieldName:z,color:g,value:void 0===D?null:D&&m?D/m:D});if(v.isRelatedField(z))return b=c.get(z.toLowerCase()),D=y&&c.get(y.toLowerCase()),c=b?.fieldName??z,D=f&&y?q.getRelatedFieldInfo(y).fieldName:D?.fieldName??y,m.tooltip=this._getTooltip({label:f&&D?h[D]:r[D]??b?.label??b?.fieldName??w,value:f&&w?h[w]:r[c],chartType:G}),m;c=v.getFieldInfo(u,z);b=v.getFixedFieldName(z,b);c=y&&void 0!==r[y]?r[y]:v.getFieldInfoLabel(c||new F({fieldName:b}),
this.popupTemplate?.expressionInfos);m.tooltip=this._getTooltip({label:c,value:r[b],chartType:G});return m}};a.__decorate([C.property()],k.prototype,"abilities",void 0);a.__decorate([H.cast("abilities")],k.prototype,"castAbilities",null);a.__decorate([C.property()],k.prototype,"activeMediaInfoIndex",void 0);a.__decorate([C.property({readOnly:!0})],k.prototype,"activeMediaInfo",null);a.__decorate([C.property()],k.prototype,"attributes",void 0);a.__decorate([C.property()],k.prototype,"description",
void 0);a.__decorate([C.property()],k.prototype,"fieldInfoMap",void 0);a.__decorate([C.property()],k.prototype,"formattedAttributes",void 0);a.__decorate([C.property()],k.prototype,"expressionAttributes",void 0);a.__decorate([C.property({readOnly:!0})],k.prototype,"formattedMediaInfos",null);a.__decorate([C.property()],k.prototype,"isAggregate",void 0);a.__decorate([C.property()],k.prototype,"layer",void 0);a.__decorate([C.property({readOnly:!0})],k.prototype,"formattedMediaInfoCount",null);a.__decorate([C.property()],
k.prototype,"mediaInfos",void 0);a.__decorate([C.property()],k.prototype,"popupTemplate",void 0);a.__decorate([C.property()],k.prototype,"relatedInfos",void 0);a.__decorate([C.property()],k.prototype,"title",void 0);return k=a.__decorate([p.subclass("esri.widgets.Feature.FeatureMedia.FeatureMediaViewModel")],k)})},"esri/widgets/Feature/support/relatedFeatureUtils":function(){define("exports ../../../request ../../../core/arrayUtils ../../../core/Error ../../../core/Logger ../../../core/promiseUtils ../../../layers/support/fieldUtils ../../../rest/query/executeQueryJSON ../../../rest/support/Query ../../../rest/support/RelationshipQuery ../../../rest/support/StatisticDefinition ./featureUtils".split(" "),
function(a,k,d,C,H,E,p,F,K,v,q,e){function m(g,b){if(!b.relationships)return null;let c=null;({relationships:b}=b);b.some(n=>n.id===parseInt(g,10)?(c=n,!0):!1);return c}function l({originRelationship:g,relationships:b,layerId:c}){return b.find(({relatedTableId:n,id:y})=>`${n}`===c&&y===g?.id)??null}function h(g,b){b=b.toLowerCase();for(const c in g)if(c.toLowerCase()===b)return g[c];return null}function r(g,b,c,n){const y=new v;y.outFields=["*"];y.relationshipId="number"===typeof b.id?b.id:parseInt(b.id,
10);y.objectIds=[g.attributes[c.objectIdField]];y.gdbVersion=c.gdbVersion??null;y.historicMoment=c.historicMoment??null;return c.queryRelatedFeatures?.(y,n)??Promise.resolve({})}function t(g,b,c){let n=0;const y=[];for(;n<b.length;)y.push(`${g} IN (${b.slice(n,c+n)})`),n+=c;return y.join(" OR ")}function z(g){return g?d.unique(g):void 0}function w(g){return g?d.unique(g,(b,c)=>JSON.stringify(b.toJSON())===JSON.stringify(c.toJSON())):void 0}async function u(g,b,c,n){var y=c.layerId.toString();const {layerInfo:D,
relation:B,relatedFields:J,outStatistics:O,url:S,sourceSpatialReference:x}=b;b=z(J);const I=w(O);if(!D||!B)return null;const M=l({originRelationship:B,relationships:D.relationships,layerId:y});if(M?.relationshipTableId&&M.keyFieldInRelationshipTable){y=(await r(g,M,c,n))[g.attributes[c.objectIdField]];if(!y)return null;var N=y.features.map(Q=>Q.attributes[D.objectIdField]);if(I?.length&&D.supportsStatistics)return n=new K,n.where=t(D.objectIdField,N,1E3),n.outFields=b,n.outStatistics=I,n.sourceSpatialReference=
x,n={features:Promise.resolve(y),statsFeatures:F.executeQueryJSON(S,n)},E.eachAlways(n)}return(y=M?.keyField)?(N=p.isNumericField(G(D.fields,y)),g=h(g.attributes,B.keyField),g=N?`${y}=${g}`:`${y}='${g}'`,c=F.executeQueryJSON(S,new K({where:g,outFields:b,sourceSpatialReference:x,historicMoment:c.historicMoment,gdbVersion:c.gdbVersion}),n),n=I?.length&&D.supportsStatistics?F.executeQueryJSON(S,new K({where:g,outFields:b,outStatistics:I,sourceSpatialReference:x}),n):null,b={features:c},n&&(b.statsFeatures=
n),E.eachAlways(b)):null}function G(g,b){if(null!=g){b=b.toLowerCase();for(const c of g)if(c&&c.name.toLowerCase()===b)return c}return null}const f=new Map;a.createRelatedInfo=function(g,b){if(g=m(g,b))return{url:`${b.url}/${g.relatedTableId}`,sourceSpatialReference:b.spatialReference,relation:g,relatedFields:[],outStatistics:[]}};a.getDestinationRelation=l;a.getRelatedFieldInfo=function(g){if(!e.isRelatedField(g))return null;const [b,c]=g.split("/").slice(1);return{layerId:b,fieldName:c}};a.getUniqueOutFields=
z;a.getUniqueOutStatistics=w;a.queryLayerInfos=function({relatedInfos:g,layer:b},c){const n={};g.forEach((y,D)=>{({relation:y}=y);if(!y)throw D=new C("relation-required","A relation is required on a layer to retrieve related records."),H.getLogger("esri.widgets.Feature.support.relatedFeatureUtils").error(D),D;({relatedTableId:y}=y);if("number"!==typeof y)throw D=new C("A related table ID is required on a layer to retrieve related records."),H.getLogger("esri.widgets.Feature.support.relatedFeatureUtils").error(D),
D;y=`${b.url}/${y}`;const B=f.get(y),J=B??k(y,{query:{f:"json"},signal:(void 0)?.signal});B||f.set(y,J);n[D]=J});return E.whenOrAbort(E.eachAlways(n),c)};a.queryRelatedFeatures=function({graphic:g,relatedInfos:b,layer:c},n){const y={};b.forEach((D,B)=>{D.layerInfo&&(y[B]=u(g,D,c,n))});return E.eachAlways(y)};a.setRelatedFeatures=function(g,b){if(b&&g){var {features:c,statsFeatures:n}=g;g=c?.value;b.relatedFeatures=g?g.features:[];g=n?.value;b.relatedStatsFeatures=g?g.features:[]}};a.updateRelatedInfo=
function({relatedInfo:g,fieldName:b,fieldInfo:c}){g.relatedFields?.push(b);c.statisticType&&(b=new q({statisticType:c.statisticType,onStatisticField:b,outStatisticFieldName:b}),g.outStatistics?.push(b))};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/Feature/FeatureExpression/FeatureExpressionViewModel":function(){define("../../../chunks/tslib.es6 ../../../geometry ../../../Graphic ../../../core/Accessor ../../../core/reactiveUtils ../../../core/throttle ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ../../../popup/content/AttachmentsContent ../../../popup/content/Content ../../../popup/content/CustomContent ../../../popup/content/ExpressionContent ../../../popup/content/FieldsContent ../../../popup/content/MediaContent ../../../popup/content/RelationshipContent ../../../popup/content/TextContent ../../../popup/content/UtilityNetworkAssociationsContent ../../../popup/ElementExpressionInfo ../FeatureContent/FeatureContentViewModel ../FeatureFields/FeatureFieldsViewModel ../FeatureMedia/FeatureMediaViewModel ../support/arcadeFeatureUtils ../../../geometry/Point".split(" "),
function(a,k,d,C,H,E,p,F,K,v,q,e,m,l,h,r,t,z,w,u,G,f,g,b,c,n){k=class extends C{constructor(y){super(y);this.view=this.location=this.interceptor=this.contentElementViewModel=this.contentElement=this.graphic=this.expressionInfo=this._abortController=null;this._cancelQuery=()=>{const {_abortController:D}=this;D&&D.abort();this._abortController=null};this._createVM=()=>{var D=this.contentElement?.type;this.contentElementViewModel?.destroy();D="fields"===D?new g:"media"===D?new b:"text"===D?new f:null;
this._set("contentElementViewModel",D)};this._compile=async()=>{this._cancelQuery();const D=new AbortController;this._abortController=D;await this._compileExpression();this._abortController===D&&(this._abortController=null)};this._compileThrottled=E.throttle(this._compile,1,this);this._compileExpression=async()=>{const {expressionInfo:D,graphic:B,interceptor:J,spatialReference:O,map:S,location:x,view:I,_abortController:M}=this;if(D&&B){var N=await c.loadArcade();if(M===this._abortController)if((N=
await c.createCompiledExpression({arcade:N,expressionInfo:D,graphic:B,location:x,interceptor:J,map:S,spatialReference:O,view:I}))&&"esri.arcade.Dictionary"===N.declaredClass){N=await N.castAsJsonAsync(M?.signal);var Q=N?.type;N="media"===Q?t.fromJSON(N):"text"===Q?w.fromJSON(N):"fields"===Q?r.fromJSON(N):null;"media"===N.type&&!N.mediaInfos||"fields"===N.type&&!N.fieldInfos||"text"===N.type&&!N.text?this._set("contentElement",null):this._set("contentElement",N)}else this._set("contentElement",null)}else this._set("contentElement",
null)};this.addHandles([H.watch(()=>[this.expressionInfo,this.graphic,this.map,this.spatialReference,this.view],()=>this._compileThrottled(),H.initial),H.watch(()=>[this.contentElement],()=>this._createVM(),H.initial)])}initialize(){this.addHandles(this._compileThrottled)}destroy(){this._cancelQuery();this.contentElementViewModel?.destroy();this._set("contentElementViewModel",null);this._set("contentElement",null)}get spatialReference(){return this.view?.spatialReference??null}set spatialReference(y){this._override("spatialReference",
y)}get state(){const {_abortController:y,contentElement:D,contentElementViewModel:B}=this;return y?"loading":D||B?"ready":"disabled"}get map(){return this.view?.map??null}set map(y){this._override("map",y)}};a.__decorate([p.property()],k.prototype,"_abortController",void 0);a.__decorate([p.property({type:G})],k.prototype,"expressionInfo",void 0);a.__decorate([p.property({type:d})],k.prototype,"graphic",void 0);a.__decorate([p.property({readOnly:!0})],k.prototype,"contentElement",void 0);a.__decorate([p.property({readOnly:!0})],
k.prototype,"contentElementViewModel",void 0);a.__decorate([p.property()],k.prototype,"interceptor",void 0);a.__decorate([p.property({type:n})],k.prototype,"location",void 0);a.__decorate([p.property()],k.prototype,"spatialReference",null);a.__decorate([p.property({readOnly:!0})],k.prototype,"state",null);a.__decorate([p.property()],k.prototype,"map",null);a.__decorate([p.property()],k.prototype,"view",void 0);return k=a.__decorate([q.subclass("esri.widgets.Feature.FeatureExpression.FeatureExpressionViewModel")],
k)})},"esri/core/throttle":function(){define(["exports"],function(a){a.throttle=function(k,d,C,H){let E=null,p=1E3;"number"===typeof d?(p=d,H=C):(E=d??null,p=C);let F=0,K;const v=()=>{F=0;k.apply(H,K)};d=(...q)=>{E&&E.apply(H,q);K=q;p?F||=setTimeout(v,p):v()};d.remove=()=>{F&&(clearTimeout(F),F=0)};d.forceUpdate=()=>{F&&(clearTimeout(F),v())};d.hasPendingUpdates=()=>!!F;return d};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/Feature/support/arcadeFeatureUtils":function(){define("require exports ../../../arcade/featureset/support/shared ../../../core/Logger ../../../core/promiseUtils ../../../layers/FeatureLayer ./featureUtils ../../support/globalCss".split(" "),
function(a,k,d,C,H,E,p,F){function K(h){return`<ul class="esri-widget__list">${h.map(r=>`<li>${"string"===typeof r?p.applyTextFormattingHTML(p.htmlEntities(r)):r}</li>`).join("")}</ul>`}function v(h){const r=h.keys().map(t=>{var z=h.field(t);z="string"===typeof z?p.applyTextFormattingHTML(p.htmlEntities(z)):z;return`<tr><th>${t}</th><td>${z}</td></tr>`}).join("");return`<table class="${F.globalCss.table}">${r}</table>`}function q(){return new Promise((h,r)=>a(["../../../arcade"],h,r))}async function e({graphic:h,
view:r,options:t}){const {isAggregate:z,layer:w}=h;if(!z||!w||"2d"!==r?.type)return[];r=await r.whenLayerView(w);if(!("createQuery"in r&&"queryFeatures"in r))return[];const u=r.createQuery();h=h.getObjectId();u.aggregateIds=null!=h?[h]:[];({features:t}=await r.queryFeatures(u,t));return t}function m({layer:h,aggregatedFeatures:r,interceptor:t}){const {fields:z,objectIdField:w,geometryType:u,spatialReference:G,displayField:f}=h;return new E({fields:z,objectIdField:w,geometryType:u,spatialReference:G,
displayField:f,interceptor:t,...("feature"===h.type?{templates:h.templates,typeIdField:h.typeIdField,types:h.types}:null),source:r})}async function l({expressionInfo:h,arcade:r,interceptor:t,spatialReference:z,map:w,graphic:u,location:G,view:f,options:g}){if(!h?.expression)return null;var {isAggregate:b}=u;const c=(u.sourceLayer||u.layer)??void 0;b=b?"feature-reduction-popup":"popup";const n=r.createArcadeProfile(b);r=r.createArcadeExecutor(h.expression,n).catch(J=>C.getLogger("esri.widgets.Feature.support.arcadeFeatureUtils").error("arcade-executor-error",
{error:J,expressionInfo:h}));const [y,D]=await Promise.all([e({graphic:u,view:f,options:g}),r]);if(!D)return null;const B="feature-reduction-popup"===b?m({layer:c,aggregatedFeatures:y,interceptor:t}):void 0;w={...("feature-reduction-popup"===b?{$aggregatedFeatures:B}:{$datastore:c?.url,$layer:null!=c&&d.isSupportedLayer(c)?c:"scene"===c?.type&&null!=c.associatedLayer?c.associatedLayer:void 0,$map:w,$userInput:G,$graph:"knowledge-graph-sublayer"===c?.type?c?.parentCompositeLayer?.knowledgeGraph:void 0}),
$feature:u};return await D.executeAsync(w,{abortSignal:g?.signal??void 0,interceptor:t??void 0,rawOutput:!0,spatialReference:z??void 0,timeZone:f?.timeZone}).catch(J=>C.getLogger("esri.widgets.Feature.support.arcadeFeatureUtils").error("arcade-execution-error",{error:J,graphic:u,expressionInfo:h})).finally(()=>B?.destroy())}k.createCompiledExpression=l;k.createCompiledExpressions=async function({expressionInfos:h,spatialReference:r,graphic:t,interceptor:z,map:w,view:u,location:G,options:f}){if(!h?.length)return{};
const g=await q(),b={};for(const c of h)b[`expression/${c.name}`]=l({expressionInfo:c,arcade:g,interceptor:z,spatialReference:r,map:w,graphic:t,location:G,view:u,options:f});h=await H.eachAlways(b);r={};for(const c in h)t=h[c].value,t="string"===typeof t?p.applyTextFormattingHTML(p.htmlEntities(t)):Array.isArray(t)?K(t):"esri.arcade.Dictionary"===t?.declaredClass?v(t):t,r[c]=t;return r};k.loadArcade=q;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/arcade/featureset/support/shared":function(){define("exports ../../ArcadeDate ../../../core/sql/DateOnly ../../../core/sql/TimeOnly ../../../geometry/Extent ../../../layers/support/Field ../../../chunks/datetime".split(" "),
function(a,k,d,C,H,E,p){function F(q){return q instanceof Date}function K(q){return q instanceof k.ArcadeDate}function v(q){switch(q.type){case "catalog":case "csv":case "feature":case "geojson":case "oriented-imagery":case "subtype-group":case "wfs":return!0;default:return!1}}a.FeatureServiceDatabaseType=void 0;(function(q){q[q.Standardised=0]="Standardised";q[q.StandardisedNoInterval=1]="StandardisedNoInterval";q[q.SqlServer=2]="SqlServer";q[q.Oracle=3]="Oracle";q[q.Postgres=4]="Postgres";q[q.PGDB=
5]="PGDB";q[q.FILEGDB=6]="FILEGDB";q[q.NotEvaluated=7]="NotEvaluated"})(a.FeatureServiceDatabaseType||(a.FeatureServiceDatabaseType={}));a.IdState=void 0;(function(q){q[q.InFeatureSet=0]="InFeatureSet";q[q.NotInFeatureSet=1]="NotInFeatureSet";q[q.Unknown=2]="Unknown"})(a.IdState||(a.IdState={}));a.callback=function(q,e){return function(){try{q.apply(null,arguments)}catch(m){e.reject(m)}}};a.cloneAttributes=function(q){const e={};for(const m in q)e[m]=q[m];return e};a.cloneField=function(q){return E.fromJSON(q.toJSON())};
a.convertLinearUnitsToCode=function(q){if(null==q)return null;if("number"===typeof q||"number"===typeof q)return q;switch(q.toLowerCase()){case "meters":case "meter":return 9001;case "miles":case "mile":return 9093;case "kilometers":case "kilometer":case "km":return 9036}return null};a.convertSquareUnitsToCode=function(q){if(null==q)return null;if("number"===typeof q)return q;switch(q.toLowerCase()){case "meters":case "meter":return 109404;case "miles":case "mile":return 109439;case "kilometers":case "kilometer":case "km":return 109414}return null};
a.defaultMaxRecords=1E3;a.equalityTest=function(q,e){return q===e?!0:(F(q)||K(q))&&(F(e)||K(e))?q.getTime()===e.getTime():!1};a.errback=function(q){return function(e){q.reject(e)}};a.esriFieldToJson=function(q){return q.toJSON?q.toJSON():q};a.extractServiceUrl=function(q){if(void 0===q)return"";q=q.replace(/\/featureserver\/[0-9]*/i,"/FeatureServer");q=q.replace(/\/mapserver\/[0-9]*/i,"/MapServer");return q=q.split("?")[0]};a.isArcadeDate=K;a.isArcadeDateOnly=function(q){return q instanceof d.DateOnly};
a.isArcadeTime=function(q){return q instanceof C.TimeOnly};a.isArray=function(q){return Array.isArray(q)};a.isBoolean=function(q){return"boolean"===typeof q};a.isDate=F;a.isLuxonDate=function(q){return q instanceof p.DateTime};a.isNumber=function(q){return"number"===typeof q};a.isString=function(q){return"string"===typeof q||q instanceof String};a.isSupportedLayer=function(q){switch(q.type){case "catalog-footprint":case "subtype-sublayer":return!0;default:return v(q)}};a.isSupportedSourceLayer=v;
a.layerFieldEsriConstants={"small-integer":"esriFieldTypeSmallInteger",integer:"esriFieldTypeInteger",long:"esriFieldTypeLong",single:"esriFieldTypeSingle",double:"esriFieldTypeDouble",string:"esriFieldTypeString",date:"esriFieldTypeDate","date-only":"esriFieldTypeDateOnly","time-only":"esriFieldTypeTimeOnly","timestamp-offset":"esriFieldTypeTimestampOffset",oid:"esriFieldTypeOID",geometry:"esriFieldTypeGeometry",blob:"esriFieldTypeBlob",raster:"esriFieldTypeRaster",guid:"esriFieldTypeGUID","global-id":"esriFieldTypeGlobalID",
xml:"esriFieldTypeXML","big-integer":"esriFieldTypeBigInteger",esriFieldTypeSmallInteger:"esriFieldTypeSmallInteger",esriFieldTypeInteger:"esriFieldTypeInteger",esriFieldTypeLong:"esriFieldTypeLong",esriFieldTypeSingle:"esriFieldTypeSingle",esriFieldTypeDouble:"esriFieldTypeDouble",esriFieldTypeString:"esriFieldTypeString",esriFieldTypeDate:"esriFieldTypeDate",esriFieldTypeDateOnly:"esriFieldTypeDateOnly",esriFieldTypeTimeOnly:"esriFieldTypeTimeOnly",esriFieldTypeTimestampOffset:"esriFieldTypeTimestampOffset",
esriFieldTypeOID:"esriFieldTypeOID",esriFieldTypeGeometry:"esriFieldTypeGeometry",esriFieldTypeBlob:"esriFieldTypeBlob",esriFieldTypeRaster:"esriFieldTypeRaster",esriFieldTypeGUID:"esriFieldTypeGUID",esriFieldTypeGlobalID:"esriFieldTypeGlobalID",esriFieldTypeXML:"esriFieldTypeXML",esriFieldTypeBigInteger:"esriFieldTypeBigInteger"};a.layerGeometryEsriConstants={point:"point",polygon:"polygon",polyline:"polyline",multipoint:"multipoint",extent:"extent",esriGeometryPoint:"point",esriGeometryPolygon:"polygon",
esriGeometryPolyline:"polyline",esriGeometryMultipoint:"multipoint",esriGeometryEnvelope:"extent",envelope:"extent"};a.layerGeometryEsriRestConstants={point:"esriGeometryPoint",polygon:"esriGeometryPolygon",polyline:"esriGeometryPolyline",multipoint:"esriGeometryMultipoint",extent:"esriGeometryEnvelope",esriGeometryPoint:"esriGeometryPoint",esriGeometryPolygon:"esriGeometryPolygon",esriGeometryPolyline:"esriGeometryPolyline",esriGeometryMultipoint:"esriGeometryMultipoint",esriGeometryEnvelope:"esriGeometryEnvelope",
envelope:"esriGeometryEnvelope"};a.sameGeomType=function(q,e){return q===e||"point"===q&&"esriGeometryPoint"===e||"polyline"===q&&"esriGeometryPolyline"===e||"polygon"===q&&"esriGeometryPolygon"===e||"extent"===q&&"esriGeometryEnvelope"===e||"multipoint"===q&&"esriGeometryMultipoint"===e||"point"===e&&"esriGeometryPoint"===q||"polyline"===e&&"esriGeometryPolyline"===q||"polygon"===e&&"esriGeometryPolygon"===q||"extent"===e&&"esriGeometryEnvelope"===q||"multipoint"===e&&"esriGeometryMultipoint"===
q?!0:!1};a.shapeExtent=function(q){if(null==q)return null;switch(q.type){case "polygon":case "multipoint":case "polyline":return q.extent;case "point":return new H({xmin:q.x,ymin:q.y,xmax:q.x,ymax:q.y,spatialReference:q.spatialReference});case "extent":return q}return null};a.stableStringify=function(q,e){e||={};"function"===typeof e&&(e={cmp:e});const m="boolean"===typeof e.cycles?e.cycles:!1,l=e.cmp&&function(r){return function(t){return function(z,w){return r({key:z,value:t[z]},{key:w,value:t[w]})}}}(e.cmp),
h=[];return function z(t){t?.toJSON&&"function"===typeof t.toJSON&&(t=t.toJSON());if(void 0!==t){if("number"===typeof t)return isFinite(t)?""+t:"null";if("object"!==typeof t)return JSON.stringify(t);var w;if(Array.isArray(t)){var u="[";for(w=0;w<t.length;w++)w&&(u+=","),u+=z(t[w])||"null";return u+"]"}if(null===t)return"null";if(h.includes(t)){if(m)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON");}var G=h.push(t)-1,f=Object.keys(t).sort(l?.(t));u="";
for(w=0;w<f.length;w++){const g=f[w],b=z(t[g]);b&&(u&&(u+=","),u+=JSON.stringify(g)+":"+b)}h.splice(G,1);return"{"+u+"}"}}(q)};a.toEsriGeometryType=function(q){switch(q){case "point":return"esriGeometryPoint";case "polygon":return"esriGeometryPolygon";case "multipoint":return"esriGeometryMultipoint";case "polyline":return"esriGeometryPolyline";default:return"esriGeometryPoint"}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/arcade/ArcadeDate":function(){define(["exports","../core/string",
"../core/sql/UnknownTimeZone","../chunks/datetime"],function(a,k,d,C){function H(v,q,e){return v<q?v-q:v>e?v-e:0}function E(v,q=!0){if(v instanceof C.Zone)return v;if("system"===v.toLowerCase())return"system";if("utc"===v.toLowerCase())return"UTC";if("unknown"===v.toLowerCase())return d.UnknownTimeZone.instance;if(/^[+-]?[0-9]{1,2}([:][0-9]{2})?$/.test(v)){const e=C.FixedOffsetZone.parseSpecifier("UTC"+(v.startsWith("+")||v.startsWith("-")?"":"+")+v);if(e)return e}v=C.IANAZone.create(v);if(!v.isValid){if(q)throw new F(a.ArcadeDateErrorCodes.TimeZoneNotRecognized);
return null}return v}a.ArcadeDateErrorCodes=void 0;(a.ArcadeDateErrorCodes||(a.ArcadeDateErrorCodes={})).TimeZoneNotRecognized="TimeZoneNotRecognized";const p={[a.ArcadeDateErrorCodes.TimeZoneNotRecognized]:"Timezone identifier has not been recognized."};class F extends Error{constructor(v,q){super(k.replace(p[v],q));this.declaredRootClass="esri.arcade.arcadedate.dateerror";Error.captureStackTrace&&Error.captureStackTrace(this,F)}}class K{constructor(v){this._date=v;this.declaredRootClass="esri.arcade.arcadedate"}static fromParts(v=
0,q=1,e=1,m=0,l=0,h=0,r=0,t){if(isNaN(v)||isNaN(q)||isNaN(e)||isNaN(m)||isNaN(l)||isNaN(h)||isNaN(r))return null;const z=C.DateTime.local(v,q).daysInMonth;v=C.DateTime.fromObject({day:1>e?1:e>z?z:e,year:v,month:1>q?1:12<q?12:q,hour:0>m?0:23<m?23:m,minute:0>l?0:59<l?59:l,second:0>h?0:59<h?59:h,millisecond:0>r?0:999<r?999:r},{zone:E(t)});v=v.plus({months:H(q,1,12),days:H(e,1,z),hours:H(m,0,23),minutes:H(l,0,59),seconds:H(h,0,59),milliseconds:H(r,0,999)});return new K(v)}static get systemTimeZoneCanonicalName(){return Intl.DateTimeFormat().resolvedOptions().timeZone??
"system"}static arcadeDateAndZoneToArcadeDate(v,q){q=E(q);return v.isUnknownTimeZone||q===d.UnknownTimeZone.instance?K.fromParts(v.year,v.monthJS+1,v.day,v.hour,v.minute,v.second,v.millisecond,q):new K(v._date.setZone(q))}static dateJSToArcadeDate(v){return new K(C.DateTime.fromJSDate(v,{zone:"system"}))}static dateJSAndZoneToArcadeDate(v,q="system"){q=E(q);return new K(C.DateTime.fromJSDate(v,{zone:q}))}static unknownEpochToArcadeDate(v){return new K(C.DateTime.fromMillis(v,{zone:d.UnknownTimeZone.instance}))}static unknownDateJSToArcadeDate(v){return new K(C.DateTime.fromMillis(v.getTime(),
{zone:d.UnknownTimeZone.instance}))}static epochToArcadeDate(v,q="system"){q=E(q);return new K(C.DateTime.fromMillis(v,{zone:q}))}static dateTimeToArcadeDate(v){return new K(v)}clone(){return new K(this._date)}changeTimeZone(v){v=E(v);return K.dateTimeToArcadeDate(this._date.setZone(v))}static dateTimeAndZoneToArcadeDate(v,q){q=E(q);return v.zone===d.UnknownTimeZone.instance||q===d.UnknownTimeZone.instance?K.fromParts(v.year,v.month,v.day,v.hour,v.minute,v.second,v.millisecond,q):new K(v.setZone(q))}static nowToArcadeDate(v){v=
E(v);return new K(C.DateTime.fromJSDate(new Date,{zone:v}))}static nowUTCToArcadeDate(){return new K(C.DateTime.utc())}get isSystem(){return"system"===this.timeZone||this.timeZone===K.systemTimeZoneCanonicalName}equals(v){return this.isSystem&&v.isSystem?this.toNumber()===v.toNumber():this.isUnknownTimeZone!==v.isUnknownTimeZone?!1:this._date.equals(v._date)}get isUnknownTimeZone(){return this._date.zone===d.UnknownTimeZone.instance}get isValid(){return this._date.isValid}get hour(){return this._date.hour}get second(){return this._date.second}get day(){return this._date.day}get dayOfWeekISO(){return this._date.weekday}get dayOfWeekJS(){let v=
this._date.weekday;6<v&&(v=0);return v}get millisecond(){return this._date.millisecond}get monthISO(){return this._date.month}get weekISO(){return this._date.weekNumber}get yearISO(){return this._date.weekYear}get monthJS(){return this._date.month-1}get year(){return this._date.year}get minute(){return this._date.minute}get zone(){return this._date.zone}get timeZoneOffset(){return this.isUnknownTimeZone?0:this._date.offset}get timeZone(){if(this.isUnknownTimeZone)return"unknown";if("system"===this._date.zone.type)return"system";
const v=this.zone;return"fixed"===v.type?0===v.fixed?"UTC":v.formatOffset(0,"short"):v.name}stringify(){return JSON.stringify(this.toJSDate())}plus(v){return new K(this._date.plus(v))}diff(v,q="milliseconds"){return this._date.diff(v._date,q)[q]}toISODate(){return this._date.toISODate()}toISOString(v){return v?this._date.toISO({suppressMilliseconds:!0,includeOffset:!this.isUnknownTimeZone}):this._date.toISO({includeOffset:!this.isUnknownTimeZone})}toISOTime(v,q){return this._date.toISOTime({suppressMilliseconds:v,
includeOffset:q&&!this.isUnknownTimeZone})}toFormat(v,q){this.isUnknownTimeZone&&(v=v.replaceAll("Z",""));return this._date.toFormat(v,q)}toJSDate(){return this._date.toJSDate()}toSQLValue(){return this._date.toFormat("yyyy-LL-dd HH:mm:ss")}toSQLWithKeyword(){return`timestamp '${this.toSQLValue()}'`}toDateTime(){return this._date}toNumber(){return this._date.toMillis()}getTime(){return this._date.toMillis()}toUTC(){return new K(this._date.toUTC())}toLocal(){return new K(this._date.toLocal())}toString(){return this.toISOString(!0)}static fromReaderAsTimeStampOffset(v){if(!v)return null;
v=C.DateTime.fromISO(v,{setZone:!0});return new K(v)}}a.ArcadeDate=K;a.ArcadeDateError=F;a.arcadeDateErrorMessages=p;a.createDateTimeZone=E;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/sql/DateOnly":function(){define(["exports","../../arcade/ArcadeDate","../../intl/locale","../../chunks/datetime"],function(a,k,d,C){function H(p){p=p.replaceAll(/LTS|LT|L{1,4}|l{1,4}/g,"[$\x26]");let F="";const K=/(\[[^[]*\])|(\\)?([Hh]mm(ss)?|Mo|M{1,4}|Do|DDDo|D{1,4}|d{2,4}|do?|w[o|w]?|W[o|W]?|Qo?|N{1,5}|YYYYYY|YYYYY|YYYY|YY|y{2,4}|yo?|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|kk?|mm?|ss?|S{1,9}|x|X|zz?|ZZ?|.)/g;
for(const v of p.match(K)||[])switch(v){case "D":F+="d";break;case "DD":F+="dd";break;case "DDD":F+="o";break;case "d":F+="c";break;case "ddd":F+="ccc";break;case "dddd":F+="cccc";break;case "M":F+="L";break;case "MM":F+="LL";break;case "MMM":F+="LLL";break;case "MMMM":F+="LLLL";break;case "YY":F+="yy";break;case "Y":case "YYYY":F+="yyyy";break;case "Q":F+="q";break;case "X":case "x":F+=v;break;default:F=2<=v.length&&"["===v.slice(0,1)&&"]"===v.slice(-1)?F+`'${v.slice(1,-1)}'`:F+`'${v}'`}return F}
class E{constructor(p,F,K){this._year=p;this._month=F;this._day=K;this.declaredRootClass="esri.core.sql.dateonly"}get month(){return this._month}get monthJS(){return this._month-1}get year(){return this._year}get day(){return this._day}get isValid(){return this.toDateTime("unknown").isValid}equals(p){return p instanceof E&&p.day===this.day&&p.month===this.month&&p.year===this.year}clone(){return new E(this._year,this._month,this._day)}toDateTime(p){return C.DateTime.fromObject({day:this.day,month:this.month,
year:this.year},{zone:k.createDateTimeZone(p)})}toDateTimeLuxon(p){return C.DateTime.fromObject({day:this.day,month:this.month,year:this.year},{zone:k.createDateTimeZone(p)})}toString(){return`${this.year.toString().padStart(4,"0")}-${this.month.toString().padStart(2,"0")}-${this.day.toString().padStart(2,"0")}`}toFormat(p=null,F=!0){if(null===p||""===p)return this.toString();F&&(p=H(p));if(!p)return"";F=this.toDateTime("unknown");return k.ArcadeDate.dateTimeToArcadeDate(F).toFormat(p,{locale:d.getLocale(),
numberingSystem:"latn"})}toArcadeDate(){const p=this.toDateTime("unknown");return k.ArcadeDate.dateTimeToArcadeDate(p)}toNumber(){return this.toDateTime("unknown").toMillis()}toJSDate(){return this.toDateTime("unknown").toJSDate()}toStorageFormat(){return this.toFormat("yyyy-LL-dd",!1)}toSQLValue(){return this.toFormat("yyyy-LL-dd",!1)}toSQLWithKeyword(){return"date '"+this.toFormat("yyyy-LL-dd",!1)+"'"}plus(p,F){return E.fromDateTime(this.toUTCDateTime().plus({[p]:F}))}toUTCDateTime(){return C.DateTime.utc(this.year,
this.month,this.day,0,0,0,0)}difference(p,F){switch(F.toLowerCase()){case "days":case "day":case "d":return this.toUTCDateTime().diff(p.toUTCDateTime(),"days").days;case "months":case "month":return this.toUTCDateTime().diff(p.toUTCDateTime(),"months").months;case "minutes":case "minute":case "m":return"M"===F?this.toUTCDateTime().diff(p.toUTCDateTime(),"months").months:this.toUTCDateTime().diff(p.toUTCDateTime(),"minutes").minutes;case "seconds":case "second":case "s":return this.toUTCDateTime().diff(p.toUTCDateTime(),
"seconds").seconds;case "milliseconds":case "millisecond":case "ms":return this.toUTCDateTime().diff(p.toUTCDateTime(),"milliseconds").milliseconds;case "hours":case "hour":case "h":return this.toUTCDateTime().diff(p.toUTCDateTime(),"hours").hours;case "years":case "year":case "y":return this.toUTCDateTime().diff(p.toUTCDateTime(),"years").years;default:return this.toUTCDateTime().diff(p.toUTCDateTime(),"milliseconds").milliseconds}}static fromMilliseconds(p){p=C.DateTime.fromMillis(p,{zone:C.FixedOffsetZone.utcInstance});
return p.isValid?E.fromParts(p.year,p.month,p.day):null}static fromSeconds(p){p=C.DateTime.fromSeconds(p,{zone:C.FixedOffsetZone.utcInstance});return p.isValid?E.fromParts(p.year,p.month,p.day):null}static fromReader(p){if(!p)return null;p=p.split("-");return 3!==p.length?null:new E(parseInt(p[0],10),parseInt(p[1],10),parseInt(p[2],10))}static fromParts(p,F,K){p=new E(p,F,K);return!1===p.isValid?null:p}static fromDateJS(p){return E.fromParts(p.getFullYear(),p.getMonth()+1,p.getDay())}static fromDateTime(p){return E.fromParts(p.year,
p.month,p.day)}static fromSqlTimeStampOffset(p){return this.fromDateTime(p.toDateTime())}static fromString(p,F=null){if(""===p||null===p)return null;var K=[];if(F)(F=H(F))&&K.push(F);else if(null===F||""===F)return p=C.DateTime.fromISO(p,{setZone:!0}),p.isValid?E.fromParts(p.year,p.month,p.day):null;for(const v of K)if(K=C.DateTime.fromFormat(p,F??v),K.isValid)return new E(K.year,K.month,K.day);return null}static fromNow(p="system"){p=C.DateTime.fromJSDate(new Date).setZone(k.createDateTimeZone(p));
return new E(p.year,p.month,p.day)}}a.DateOnly=E;a.standardizeDateOnlyFormat=H;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/sql/TimeOnly":function(){define(["exports","../../arcade/kernel","../../intl/locale","../../chunks/datetime"],function(a,k,d,C){function H(p){if(!p)return"";const F=/(a|A|hh?|HH?|mm?|ss?|SSS|S|.)/g;let K="";for(const v of p.match(F)||[])switch(v){case "SSS":K+=v;break;case "A":case "a":K+="a";break;case "m":case "mm":case "h":case "hh":case "H":case "HH":case "s":case "ss":K+=
v;break;default:K+=`'${v}'`}return K}class E{constructor(p,F,K,v){this._hour=p;this._minute=F;this._second=K;this._millisecond=v;this.declaredRootClass="esri.core.sql.timeonly"}get hour(){return this._hour}get minute(){return this._minute}get second(){return this._second}get millisecond(){return this._millisecond}equals(p){return p instanceof E&&p.hour===this.hour&&p.minute===this.minute&&p.second===this.second&&p.millisecond===this.millisecond}clone(){return new E(this.hour,this.minute,this.second,
this.millisecond)}isValid(){return k.isInteger(this.hour)&&k.isInteger(this.minute)&&k.isInteger(this.second)&&k.isInteger(this.millisecond)&&0<=this.hour&&24>this.hour&&0<=this.minute&&60>this.minute&&0<=this.second&&60>this.second&&0<=this.millisecond&&1E3>this.millisecond}toString(){return`${this.hour.toString().padStart(2,"0")}:${this.minute.toString().padStart(2,"0")}:${this.second.toString().padStart(2,"0")}`+(0<this.millisecond?"."+this.millisecond.toString().padStart(3,"0"):"")}toSQLValue(){return this.toString()}toSQLWithKeyword(){return`time '${this.hour.toString().padStart(2,
"0")}:${this.minute.toString().padStart(2,"0")}:${this.second.toString().padStart(2,"0")}${0<this.millisecond?"."+this.millisecond.toString().padStart(3,"0"):""}'`}toStorageString(){return`${this.hour.toString().padStart(2,"0")}:${this.minute.toString().padStart(2,"0")}:${this.second.toString().padStart(2,"0")}`}toFormat(p=null){return null===p||""===p?this.toString():(p=H(p))?C.DateTime.local(1970,1,1,this._hour,this._minute,this._second,this._millisecond).toFormat(p,{locale:d.getLocale(),numberingSystem:"latn"}):
""}toNumber(){return this.millisecond+1E3*this.second+6E4*this.minute+36E5*this.hour}static fromParts(p,F,K,v){p=new E(p,F,K,v);return p.isValid()?p:null}static fromReader(p){if(!p)return null;p=p.split(":");return 3!==p.length?null:new E(parseInt(p[0],10),parseInt(p[1],10),parseInt(p[2],10),0)}static fromMilliseconds(p){return 864E5<p||0>p?null:new E(Math.floor(p/36E5%24),Math.floor(p/6E4%60),Math.floor(p/1E3%60),Math.floor(p%1E3))}static fromDateJS(p){return new E(p.getHours(),p.getMinutes(),p.getSeconds(),
p.getMilliseconds())}static fromDateTime(p){return new E(p.hour,p.minute,p.second,p.millisecond)}static fromSqlTimeStampOffset(p){return this.fromDateTime(p.toDateTime())}static fromString(p,F=null){if(""===p||null===p)return null;const K=[];if(F)(F=H(F))&&K.push(F);else if(null===F||""===F)K.push("HH:mm:ss"),K.push("HH:mm:ss.SSS"),K.push("hh:mm:ss a"),K.push("hh:mm:ss.SSS a"),K.push("HH:mm"),K.push("hh:mm a"),K.push("H:mm"),K.push("h:mm a"),K.push("H:mm:ss"),K.push("h:mm:ss a"),K.push("H:mm:ss.SSS"),
K.push("h:mm:ss.SSS a");for(const v of K)if(F=C.DateTime.fromFormat(p,v),F.isValid)return new E(F.hour,F.minute,F.second,F.millisecond);return null}plus(p,F){switch(p){case "days":case "years":case "months":return this.clone();case "hours":case "minutes":case "seconds":case "milliseconds":return E.fromDateTime(this.toUTCDateTime().plus({[p]:F}))}return null}toUTCDateTime(){return C.DateTime.utc(1970,1,1,this.hour,this.minute,this.second,this.millisecond)}difference(p,F){switch(F.toLowerCase()){case "days":case "day":case "d":return this.toUTCDateTime().diff(p.toUTCDateTime(),
"days").days;case "months":case "month":return this.toUTCDateTime().diff(p.toUTCDateTime(),"months").months;case "minutes":case "minute":case "m":return"M"===F?this.toUTCDateTime().diff(p.toUTCDateTime(),"months").months:this.toUTCDateTime().diff(p.toUTCDateTime(),"minutes").minutes;case "seconds":case "second":case "s":return this.toUTCDateTime().diff(p.toUTCDateTime(),"seconds").seconds;case "milliseconds":case "millisecond":case "ms":return this.toUTCDateTime().diff(p.toUTCDateTime(),"milliseconds").milliseconds;
case "hours":case "hour":case "h":return this.toUTCDateTime().diff(p.toUTCDateTime(),"hours").hours;case "years":case "year":case "y":return this.toUTCDateTime().diff(p.toUTCDateTime(),"years").years;default:return this.toUTCDateTime().diff(p.toUTCDateTime(),"milliseconds").milliseconds}}}a.TimeOnly=E;a.standardizeTimeFormat=H;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/arcade/kernel":function(){define(["exports","../geometry/Extent"],function(a,k){a.cloneGeometry=function(d){if(null==
d)return null;const C=d.clone();void 0!==d.cache._geVersion&&(C.cache._geVersion=d.cache._geVersion);return C};a.convertLinearUnitsToCode=function(d){if(null==d)return null;if("number"===typeof d)return d;d=d.toLowerCase();d=d.replaceAll(/\s/g,"");d=d.replaceAll("-","");switch(d){case "meters":case "meter":case "m":case "squaremeters":case "squaremeter":return 9001;case "miles":case "mile":case "squaremile":case "squaremiles":return 9093;case "kilometers":case "kilometer":case "squarekilometers":case "squarekilometer":case "km":return 9036;
case "yard":case "yd":case "yards":case "squareyards":case "squareyard":return 9096;case "feet":case "ft":case "foot":case "squarefeet":case "squarefoot":return 9002;case "nmi":case "nauticalmile":case "nauticalmiles":case "squarenauticalmile":case "squarenauticalmiles":return 9030}return null};a.convertSquareUnitsToCode=function(d){if(null==d)return null;if("number"===typeof d)return d;d=d.toLowerCase();d=d.replaceAll(/\s/g,"");d=d.replaceAll("-","");switch(d){case "meters":case "meter":case "m":case "squaremeters":case "squaremeter":return 109404;
case "miles":case "mile":case "squaremile":case "squaremiles":return 109439;case "kilometers":case "kilometer":case "squarekilometers":case "squarekilometer":case "km":return 109414;case "acres":case "acre":case "ac":return 109402;case "hectares":case "hectare":case "ha":return 109401;case "yard":case "yd":case "yards":case "squareyards":case "squareyard":return 109442;case "feet":case "ft":case "foot":case "squarefeet":case "squarefoot":return 109405;case "nmi":case "nauticalmile":case "nauticalmiles":case "squarenauticalmile":case "squarenauticalmiles":return 109409}return null};
a.isInteger=function(d){return"number"===typeof d&&isFinite(d)&&Math.floor(d)===d};a.sameGeomType=function(d,C){return d===C||"point"===d&&"esriGeometryPoint"===C||"polyline"===d&&"esriGeometryPolyline"===C||"polygon"===d&&"esriGeometryPolygon"===C||"extent"===d&&"esriGeometryEnvelope"===C||"multipoint"===d&&"esriGeometryMultipoint"===C||"point"===C&&"esriGeometryPoint"===d||"polyline"===C&&"esriGeometryPolyline"===d||"polygon"===C&&"esriGeometryPolygon"===d||"extent"===C&&"esriGeometryEnvelope"===
d||"multipoint"===C&&"esriGeometryMultipoint"===d?!0:!1};a.shapeExtent=function(d){if(null==d)return null;switch(d.type){case "polygon":case "multipoint":case "polyline":return d.extent;case "point":return new k({xmin:d.x,ymin:d.y,xmax:d.x,ymax:d.y,spatialReference:d.spatialReference});case "extent":return d}return null};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/Feature/FeatureRelationship":function(){define("require ../../chunks/tslib.es6 ../../intl ../../core/maybe ../../core/promiseUtils ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/accessorSupport/decorators/cast ../../core/RandomLCG ../../core/has ../../core/accessorSupport/decorators/subclass ../Widget ./FeatureRelationship/FeatureRelationshipViewModel ./support/FeatureElementInfo ../../chunks/componentsUtils ../support/globalCss ../support/widgetUtils ../support/decorators/messageBundle ../support/jsxFactory ../../intl/substitute".split(" "),
function(a,k,d,C,H,E,p,F,K,v,q,e,m,l,h,r,t,z,w,u){var G;const f={title:!0,description:!0};d=G=class extends e{constructor(g,b){super(g,b);this._relatedFeatureIntersectionObserverNode=this._featureElementInfo=null;this._relatedFeatureIntersectionObserver=new IntersectionObserver(([c])=>{c?.isIntersecting&&this._increaseFeaturePage()},{root:window.document});this.flowItems=null;this.flowType="feature-relationship";this.headingLevel=2;this.viewModel=new m;this.messagesCommon=this.messages=null;this.visibleElements=
{...f};this._increaseFeaturePage=()=>{const {state:c,showAllEnabled:n,relatedFeatures:y,featuresPerPage:D,featurePage:B}=this.viewModel;"ready"===c&&n&&y.length>=D*B&&this.viewModel.featurePage++}}initialize(){this._featureElementInfo=new l;this.addHandles([E.watch(()=>[this.viewModel.description,this.viewModel.title,this.headingLevel],()=>this._setupFeatureElementInfo(),E.initial),E.watch(()=>[this.viewModel.state,this.viewModel.showAllEnabled,this._relatedFeatureIntersectionObserverNode],()=>this._handleRelatedFeatureObserverChange()),
E.on(()=>this.viewModel.relatedFeatureViewModels,"change",()=>this._setupRelatedFeatureViewModels())])}loadDependencies(){return h.loadCalciteComponents({icon:()=>new Promise((g,b)=>a(["../../chunks/calcite-icon"],g,b)),list:()=>new Promise((g,b)=>a(["../../chunks/calcite-list"],g,b)),"list-item":()=>new Promise((g,b)=>a(["../../chunks/calcite-list-item"],g,b)),loader:()=>new Promise((g,b)=>a(["../../chunks/calcite-loader"],g,b)),notice:()=>new Promise((g,b)=>a(["../../chunks/calcite-notice"],g,b))})}destroy(){this._unobserveRelatedFeatureObserver();
this._featureElementInfo=C.destroyMaybe(this._featureElementInfo)}get displayShowAllButton(){const {showAllEnabled:g,featureCount:b,displayCount:c,state:n}=this.viewModel;return!g&&!!b&&"ready"===n&&(b>c||0===c)}get displayListItems(){return this.displayShowAllButton||0<this.viewModel.relatedFeatureViewModels.length}get description(){return this.viewModel.description}set description(g){this.viewModel.description=g}get featureCountDescription(){const {messages:g}=this,{featureCount:b}=this.viewModel;
return u.substitute(g?.numberRecords,{number:b})}get title(){return this.viewModel.title}set title(g){this.viewModel.title=g}castVisibleElements(g){return{...f,...g}}render(){const {state:g}=this.viewModel;return w.tsx("div",{class:this.classes("esri-feature-relationship",r.globalCss.widget)},this._featureElementInfo?.render(),"loading"===g?this._renderLoading():"disabled"===g?this._renderRelationshipNotFound():this._renderRelatedFeatures())}async _selectRecord(g){const {flowItems:b,featureVisibleElements:c}=
this;if(b){g.abilities={relationshipContent:!0};var {default:n}=await new Promise((y,D)=>a(["../Feature"],B=>y(Object.freeze(Object.defineProperty({__proto__:null,default:B},Symbol.toStringTag,{value:"Module"}))),D));b.push(new n({flowItems:b,flowType:this.flowType,viewModel:g,visibleElements:c}))}}_showAllRecords(){const {flowItems:g}=this;if(g){var {viewModel:b,featureVisibleElements:c}=this;b.showAllEnabled=!0;var n=new G({flowItems:g,featureVisibleElements:c,visibleElements:{title:!1,description:!1},
viewModel:b});g.push(n)}}_renderStickyLoading(){return"querying"===this.viewModel.state?w.tsx("div",{class:"esri-feature__sticky-loading-container",key:"sticky-loader"},this._renderLoadingIcon()):null}_renderLoadingIcon(){return w.tsx("calcite-loader",{inline:!0,label:""})}_renderLoading(){return w.tsx("div",{class:"esri-feature__loading-container",key:"loading-container"},this._renderLoadingIcon())}_renderShowAllIconNode(){return w.tsx("calcite-icon",{icon:"list",scale:"s",slot:"content-end"})}_renderChevronIconNode(){const g=
t.isRTL(this.container)?"chevron-left":"chevron-right";return w.tsx("calcite-icon",{icon:g,scale:"s",slot:"content-end"})}_renderRelatedFeature(g){const {itemDescriptionFieldName:b}=this.viewModel,c=g.title;g.description=b&&g.formattedAttributes?.global[b];return w.tsx("calcite-list-item",{class:this.classes("esri-feature-relationship__list-item",{["esri-feature-relationship__list-item--hidden"]:"loading"===g.state}),description:g.description??"",key:g.uid,label:c,onCalciteListItemSelect:()=>this._selectRecord(g)},
this._renderChevronIconNode())}_renderShowAllListItem(){return this.displayShowAllButton?w.tsx("calcite-list-item",{description:this.featureCountDescription,key:"show-all-item",label:this.messages?.showAll,onCalciteListItemSelect:()=>this._showAllRecords()},this._renderShowAllIconNode()):null}_renderNoRelatedFeaturesMessage(){return w.tsx("calcite-notice",{icon:"information",key:"no-related-features-message",kind:"brand",open:!0,scale:"s",width:"full"},w.tsx("div",{slot:"message"},this.messages?.noRelatedFeatures))}_renderFeatureObserver(){return w.tsx("div",
{afterCreate:this._relatedFeatureIntersectionObserverCreated,bind:this,class:"esri-feature__feature-observer",key:"feature-observer"})}_renderList(){const {relatedFeatureViewModels:g}=this.viewModel;return w.tsx("calcite-list",null,g.toArray().map(b=>this._renderRelatedFeature(b)),this._renderShowAllListItem())}_renderRelatedFeatures(){const {displayListItems:g}=this,{state:b}=this.viewModel;return w.tsx("div",{class:this.classes("esri-feature-relationship__list",{["esri-feature-relationship__list--querying"]:"querying"===
b}),key:"list-container"},g?this._renderList():"ready"===b?this._renderNoRelatedFeaturesMessage():null,this._renderStickyLoading(),this._renderFeatureObserver())}_renderRelationshipNotFound(){return w.tsx("calcite-notice",{icon:"exclamation-mark-triangle",key:"relationship-not-found",kind:"danger",open:!0,scale:"s",width:"full"},w.tsx("div",{slot:"message"},this.messages?.relationshipNotFound))}_setupRelatedFeatureViewModels(){const {relatedFeatureViewModels:g}=this.viewModel;this.removeHandles("related-feature-viewmodels");
g?.forEach(b=>{this.addHandles(E.watch(()=>[b.title,b.state],()=>this.scheduleRender(),E.initial),"related-feature-viewmodels")});this.scheduleRender()}_setupFeatureElementInfo(){const {headingLevel:g,visibleElements:b}=this,c=b.description&&this.description,n=b.title&&this.title;this._featureElementInfo?.set({description:c,title:n,headingLevel:g})}async _handleRelatedFeatureObserverChange(){this._unobserveRelatedFeatureObserver();const {state:g,showAllEnabled:b}=this.viewModel;await H.after(0);this._relatedFeatureIntersectionObserverNode&&
"ready"===g&&b&&this._relatedFeatureIntersectionObserver.observe(this._relatedFeatureIntersectionObserverNode)}_relatedFeatureIntersectionObserverCreated(g){this._relatedFeatureIntersectionObserverNode=g}_unobserveRelatedFeatureObserver(){this._relatedFeatureIntersectionObserverNode&&this._relatedFeatureIntersectionObserver.unobserve(this._relatedFeatureIntersectionObserverNode)}};k.__decorate([p.property()],d.prototype,"_relatedFeatureIntersectionObserverNode",void 0);k.__decorate([p.property({readOnly:!0})],
d.prototype,"displayShowAllButton",null);k.__decorate([p.property({readOnly:!0})],d.prototype,"displayListItems",null);k.__decorate([p.property()],d.prototype,"description",null);k.__decorate([p.property({readOnly:!0})],d.prototype,"featureCountDescription",null);k.__decorate([p.property()],d.prototype,"featureVisibleElements",void 0);k.__decorate([p.property()],d.prototype,"flowItems",void 0);k.__decorate([p.property()],d.prototype,"flowType",void 0);k.__decorate([p.property()],d.prototype,"headingLevel",
void 0);k.__decorate([p.property()],d.prototype,"title",null);k.__decorate([p.property({type:m})],d.prototype,"viewModel",void 0);k.__decorate([p.property(),z.messageBundle("esri/widgets/Feature/t9n/Feature")],d.prototype,"messages",void 0);k.__decorate([p.property(),z.messageBundle("esri/t9n/common")],d.prototype,"messagesCommon",void 0);k.__decorate([p.property()],d.prototype,"visibleElements",void 0);k.__decorate([F.cast("visibleElements")],d.prototype,"castVisibleElements",null);return d=G=k.__decorate([q.subclass("esri.widgets.Feature.FeatureRelationship")],
d)})},"esri/widgets/Feature/FeatureRelationship/FeatureRelationshipViewModel":function(){define("../../../chunks/tslib.es6 ../../../Graphic ../../../core/Accessor ../../../core/arrayUtils ../../../core/Clonable ../../../core/Collection ../../../core/Identifiable ../../../core/promiseUtils ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/accessorSupport/decorators/subclass ../../../rest/support/RelationshipQuery ../support/featureUtils ../../FeatureForm/featureFormUtils".split(" "),
function(a,k,d,C,H,E,p,F,K,v,q,e,m,l,h,r){d=class extends H.ClonableMixin(p.IdentifiableMixin(d)){constructor(t){super(t);this._loaded=!1;this._queryFeatureCountAbortController=this._queryPageAbortController=this._queryAbortController=null;this.featuresPerPage=10;this.orderByFields=this.map=this.layer=this.graphic=this.description=null;this.featureCount=0;this.relationshipId=null;this.showAllEnabled=!1;this.title=null;this._cancelQuery=()=>{const {_queryAbortController:z}=this;z&&z.abort();this._queryAbortController=
null};this._cancelQueryFeatureCount=()=>{const {_queryFeatureCountAbortController:z}=this;z&&z.abort();this._queryFeatureCountAbortController=null};this._cancelQueryPage=()=>{const {_queryPageAbortController:z}=this;z&&z.abort();this._queryPageAbortController=null};this._queryController=async()=>{this._cancelQuery();const z=new AbortController;this._queryAbortController=z;await F.ignoreAbortErrors(this._query());this._queryAbortController===z&&(this._queryAbortController=null)};this._queryFeatureCountController=
async()=>{this._loaded=!1;this._cancelQueryFeatureCount();const z=new AbortController;this._queryFeatureCountAbortController=z;await F.ignoreAbortErrors(this._queryFeatureCount());this._queryFeatureCountAbortController===z&&(this._queryFeatureCountAbortController=null);this._loaded=!0};this._queryPageController=async()=>{const z=new AbortController;this._queryPageAbortController=z;await F.ignoreAbortErrors(this._queryPage());this._queryPageAbortController===z&&(this._queryPageAbortController=null)};
this._queryDebounced=F.debounce(this._queryController,100);this._queryFeatureCountDebounced=F.debounce(this._queryFeatureCountController,100);this._queryPageDebounced=F.debounce(this._queryPageController,100);this._query=async()=>{const {_queryAbortController:z,relatedFeatures:w}=this;this.featureCount&&(this._destroyRelatedFeatureViewModels(),this.featurePage=1,w.destroyAll(),this.destroyed||w.addMany(this._sliceFeatures(await this._queryRelatedFeatures({signal:z?.signal}))))};this.addHandles([K.watch(()=>
[this.displayCount,this.graphic,this.layer,this.layer?.loaded,this.map,this.orderByFields,this.relationshipId,this.featuresPerPage,this.showAllEnabled,this.canQuery,this.featureCount],()=>this._queryDebounced(),K.initial),K.watch(()=>[this.featurePage,this.showAllEnabled],()=>this._queryPageDebounced()),K.watch(()=>[this.layer,this.relationshipId,this.objectId,this.canQuery],()=>this._queryFeatureCountDebounced())])}destroy(){this._destroyRelatedFeatureViewModels();this.relatedFeatures.destroyAll();
this._cancelQuery();this._cancelQueryFeatureCount();this._cancelQueryPage()}set featurePage(t){const {featuresPerPage:z,featureCount:w}=this;this._set("featurePage",Math.min(Math.max(t,1),Math.ceil(w/z)||1))}get featurePage(){return this._get("featurePage")}get orderByFieldsFixedCasing(){const {orderByFields:t,relatedLayer:z}=this;return t&&z?.loaded?t.map(w=>{const u=w.clone();u.field=h.getFixedFieldName(w.field,z);return u}):t??[]}get supportsCacheHint(){return!!this.layer?.capabilities?.queryRelated?.supportsCacheHint}get canLoad(){return!!this.map&&
null!=this.relationshipId&&"number"===typeof this.objectId}get canQuery(){const t=this.layer?.capabilities?.queryRelated;return!!this.relatedLayer&&!!this.relationship&&null!=this.relationshipId&&null!=this.objectId&&!!t?.supportsCount&&!!t?.supportsPagination}get itemDescriptionFieldName(){return this.orderByFieldsFixedCasing[0]?.field||null}set displayCount(t){this._set("displayCount",Math.min(Math.max(t,0),10))}get displayCount(){return this._get("displayCount")}get objectId(){return(this.objectIdField&&
this.graphic?.attributes?.[this.objectIdField])??null}get objectIdField(){return this.layer?.objectIdField||null}get relatedFeatures(){return this._get("relatedFeatures")||new E}get relatedLayer(){const {layer:t,map:z,relationship:w}=this;return t?.loaded&&z&&w?h.findRelatedLayer(z,t,w)??null:null}get relationship(){const {relationshipId:t,layer:z}=this;return null!=t?z?.relationships?.find(({id:w})=>w===t)??null:null}get relatedFeatureViewModels(){return this._get("relatedFeatureViewModels")||new E}get state(){const {_queryAbortController:t,
_queryFeatureCountAbortController:z,_queryPageAbortController:w,canQuery:u,_loaded:G,canLoad:f}=this;return z||f&&!G?"loading":t||w?"querying":u?"ready":"disabled"}getRelatedFeatureByObjectId(t){return this.relatedFeatures.find(z=>z.getObjectId()===t)}refresh(){this._queryFeatureCountDebounced()}_destroyRelatedFeatureViewModels(){this.relatedFeatureViewModels?.destroyAll()}async _queryFeatureCount(){const {layer:t,relatedLayer:z,relationshipId:w,objectId:u,_queryFeatureCountAbortController:G,canQuery:f,
supportsCacheHint:g}=this;await t?.load();await z?.load();if(f&&t&&z&&null!=u){var b=z.createQuery(),{historicMoment:c,gdbVersion:n}=t;b=new l({cacheHint:g,gdbVersion:n,historicMoment:c,relationshipId:w,returnGeometry:!1,objectIds:[u],where:b.where??void 0});b=await t.queryRelatedFeaturesCount(b,{signal:G?.signal});this._set("featureCount",b[u]||0)}else this._set("featureCount",0)}_sliceFeatures(t){const {showAllEnabled:z,displayCount:w}=this;return z?t:w?t.slice(0,w):[]}async _queryPage(){const {relatedFeatures:t,
featurePage:z,showAllEnabled:w,_queryPageAbortController:u,featureCount:G}=this;!w||2>z||!G||t.addMany(await this._queryRelatedFeatures({signal:u?.signal}))}async _queryRelatedFeatures(t){const {orderByFieldsFixedCasing:z,showAllEnabled:w,featuresPerPage:u,displayCount:G,layer:f,relationshipId:g,featurePage:b,featureCount:c,relatedLayer:n,supportsCacheHint:y}=this,{canQuery:D,objectId:B}=this;if(!D||!f||!n||null==B)return[];var J=w?((b-1)*u+c)%c:0;const O=w?u:G;var S=n.objectIdField;S=[...z.map(Q=>
Q.field),...r.getFieldsInTitleAndDesc(n),S].filter(C.isSome);const x=z.map(Q=>`${Q.field} ${Q.order}`),I=n.createQuery(),{historicMoment:M,gdbVersion:N}=f;J=new l({orderByFields:x,start:J,num:O,outFields:S,cacheHint:y,historicMoment:M,gdbVersion:N,relationshipId:g,returnGeometry:!1,objectIds:[B],where:I.where??void 0});t=(await f.queryRelatedFeatures(J,{signal:t?.signal}))[B]?.features||[];t.forEach(Q=>{Q.sourceLayer=n;Q.layer=n});return t}};a.__decorate([v.property()],d.prototype,"_loaded",void 0);
a.__decorate([v.property()],d.prototype,"_queryAbortController",void 0);a.__decorate([v.property()],d.prototype,"_queryPageAbortController",void 0);a.__decorate([v.property()],d.prototype,"_queryFeatureCountAbortController",void 0);a.__decorate([v.property({value:1})],d.prototype,"featurePage",null);a.__decorate([v.property()],d.prototype,"featuresPerPage",void 0);a.__decorate([v.property({readOnly:!0})],d.prototype,"orderByFieldsFixedCasing",null);a.__decorate([v.property({readOnly:!0})],d.prototype,
"supportsCacheHint",null);a.__decorate([v.property({readOnly:!0})],d.prototype,"canLoad",null);a.__decorate([v.property({readOnly:!0})],d.prototype,"canQuery",null);a.__decorate([v.property()],d.prototype,"description",void 0);a.__decorate([v.property({readOnly:!0})],d.prototype,"itemDescriptionFieldName",null);a.__decorate([v.property({value:3})],d.prototype,"displayCount",null);a.__decorate([v.property({type:k})],d.prototype,"graphic",void 0);a.__decorate([v.property()],d.prototype,"layer",void 0);
a.__decorate([v.property()],d.prototype,"map",void 0);a.__decorate([v.property({readOnly:!0})],d.prototype,"objectId",null);a.__decorate([v.property({readOnly:!0})],d.prototype,"objectIdField",null);a.__decorate([v.property()],d.prototype,"orderByFields",void 0);a.__decorate([v.property({readOnly:!0})],d.prototype,"relatedFeatures",null);a.__decorate([v.property({readOnly:!0})],d.prototype,"relatedLayer",null);a.__decorate([v.property({readOnly:!0})],d.prototype,"relationship",null);a.__decorate([v.property()],
d.prototype,"featureCount",void 0);a.__decorate([v.property({readOnly:!0})],d.prototype,"relatedFeatureViewModels",null);a.__decorate([v.property()],d.prototype,"relationshipId",void 0);a.__decorate([v.property()],d.prototype,"showAllEnabled",void 0);a.__decorate([v.property()],d.prototype,"state",null);a.__decorate([v.property()],d.prototype,"title",void 0);return d=a.__decorate([m.subclass("esri.widgets.Feature.FeatureRelationship.FeatureRelationshipViewModel")],d)})},"esri/widgets/FeatureForm/featureFormUtils":function(){define("exports ../../intl ../../core/arrayUtils ../../core/compilerUtils ../../core/lang ../../core/Logger ../../core/string ../../form/support/formUtils ../../layers/support/domainUtils ../../layers/support/fieldUtils ../../layers/support/layerUtils ../../smartMapping/support/utils ../support/dateUtils ../../intl/substitute".split(" "),
function(a,k,d,C,H,E,p,F,K,v,q,e,m,l){function h(c){const {fields:n,values:y}=c,D=c.timeZone??void 0;c=n.map((B,J)=>{let O=y[J];B.domain&&"coded-value"===B.domain.type&&(J=B.domain.codedValues.find(S=>S.code===O),J?.name&&(O=J.name));if(e.isAnyDateField(B)||v.isTimeOnlyField(B))O=m.getLabelForDateFieldValue(B,O,{timeZone:D,...m.getIntlOptionsForField(B)});return[B.name,O]});return Object.fromEntries(c)}function r(c,n){return p.replace(p.replace(c,y=>`{${y.toLowerCase()}}`),Object.fromEntries(Object.entries(n).map(([y,
D])=>[y.toLowerCase(),D])))}function t(c){return 1E7<=c||-1E7>=c}function z(c,{validationErrors:n}){return null!=c.max&&null!=c.min?n.outsideRange:null!=c.max?n.outsideRangeMax:n.outsideRangeMin}const w=c=>"field"===c?.type,u=c=>"relationship"===c?.type,G=c=>c.reduce((n,y)=>"group"===y?.type?[...n,...y.inputs]:[...n,y],[]),f=(c,n)=>null!=c&&c.input?.type===n;a.LengthValidationError=void 0;(function(c){c.TOO_SHORT="length-validation-error::too-short";c.TOO_LONG="length-validation-error::too-long"})(a.LengthValidationError||
(a.LengthValidationError={}));const g={type:"number"},b={type:"number",intlOptions:{notation:"scientific"}};a.extractExpressionNameFromString=function(c){const [n,y]=c.split("expression/");return""===n&&y?y:(E.getLogger("esri.widgets.FeatureForm/featureFormUtils").error("extractExpressionNameFromString:invalid-input",`The string ${c} is not a valid expression reference of the form '${"expression/"}/expressionName'`),"")};a.flattenFieldInputs=c=>G(c).filter(w);a.flattenInputs=G;a.flattenRelationshipInputs=
c=>G(c).filter(u);a.formTemplateHasInvalidFields=function(c,n){return(n=n??("formTemplate"in c&&c.formTemplate))?(n.elements?.filter(F.isFieldElement)??[]).some(({fieldName:y})=>!c.fieldsIndex.get(y)):!1};a.getComputedAttributes=h;a.getErrorMessageForFieldInput=(c,n,y)=>{const {dataType:D,error:B,minLength:J,value:O,required:S}=c,x=n?.validationErrors;if(!x||!B)return null;if(S&&null===O)return x.cannotBeNull;if(B===K.DomainValidationError.VALUE_OUT_OF_RANGE||B===v.NumericRangeValidationError.OUT_OF_RANGE){const {field:I,
range:M}=c;c={type:"date",intlOptions:{timeZone:"date"===I.type&&y?y:void 0,...m.getIntlOptionsForField(I)}};n=z(M,n);return l.substitute(n,M,{format:{max:"date"===D?c:null!=M.max&&t(M.max)?b:g,min:"date"===D?c:null!=M.min&&t(M.min)?b:g}})}return B===K.DomainValidationError.INVALID_CODED_VALUE?x.invalidCodedValue:B===v.TypeValidationError.INVALID_TYPE?x.invalidType:B===a.LengthValidationError.TOO_SHORT?l.substitute(x.tooShort,{min:J}):null};a.getFieldsInTitleAndDesc=c=>{const n=[];if(c.formTemplate){const {description:y,
title:D}=c.formTemplate;c.fields?.forEach(B=>{const J=D&&p.templateHasKey(D,B.name),O=y&&p.templateHasKey(y,B.name);(J||O)&&n.push(B.name)})}return n};a.getIconForFeature=c=>{if(c){var n=c.layer;n=n&&"geometryType"in n?n.geometryType:void 0;c=c.geometry?.type;return"polyline"===c||"polyline"===n?"line":"mesh"===c||"mesh"===n||"multipatch"===n?"cube":"multipoint"===c||"multipoint"===n?"point":c||n||"table"}};a.getNormalizedFeatureTypeInfo=c=>{const n={typeFieldName:null,types:[]};if(!c)return n;"subtype-sublayer"===
c.type?(n.typeFieldName=c.parent?.subtypeField,n.types=c.parent?.subtypes??[]):"subtype-group"===c.type||"feature"===c.type&&c.subtypes?.length?(n.typeFieldName=c.subtypeField,n.types=c.subtypes??[]):"types"in c&&c.types&&(n.typeFieldName=c.typeIdField,n.types=c.types.map(({id:y,name:D,domains:B})=>({code:y,name:D,domains:B})));null!=n.typeFieldName&&(n.typeFieldName=c.getField(n.typeFieldName)?.name??n.typeFieldName);return n};a.isExpressionReference=function(c){return c.startsWith("expression/")};
a.isFieldElementWithInputType=f;a.isFieldElementWithShowNoValueOptionInput=c=>null!=c&&(f(c,"combo-box")||f(c,"radio-buttons"));a.isFieldElementWithTextInput=c=>null!=c&&(f(c,"text-box")||f(c,"text-area"));a.isFieldInput=w;a.isGroupInput=c=>"group"===c?.type;a.isInputInGroupInput=c=>"group"!==c?.type&&null!=c.group;a.isLegacyFieldMapsExpressionReference=function(c){return c.startsWith("expr/")};a.isNumberFieldInput=({domain:c,inputType:n="text-box",dataType:y})=>"number"===y&&"text-box"===n&&(!c||
"coded-value"!==c.type);a.isRelationshipInput=u;a.isTextElementInput=c=>"text"===c.type;a.parseFormTemplateString=function(c){const {attributes:n,fieldsIndex:y,label:D,timeZone:B}=c;if(!n||"object"!==typeof n)return D;var J=Object.keys(n).filter(O=>p.templateHasKey(D,O));c=J.map(O=>n[O]);J=J.map(O=>y.get(O)).filter(d.isSome);return r(D,h({values:c,fields:J,timeZone:B}))};a.prependExpressionPrefix=function(c){return`${"expression/"}${c}`};a.prependFieldPrefix=function(c){return`${"field/"}${c}`};a.substituteFieldTemplatesInString=
r;a.subtypeChangeShouldPrompt=function(c,n,y){var D=q.getSubtypesFromLayer(c);c=D?.find(B=>B.code===y);if(!c)return!1;D=D?.find(B=>B.code===n);return H.equalsShallow(c.defaultValues,D?.defaultValues)?!1:Object.values(c.defaultValues).some(B=>null!=B)};a.valueIsInvalidSwitchValue=function(c,n){return null==c||n.onValue!==c&&n.offValue!==c};a.valueIsValidContingentValue=function(c,n){switch(n.objectType){case "any":return!0;case "null":return null==c;case "code":return c===n.codedValue?.code;case "range":return null!=
c&&null!=n.minValue&&null!=n.maxValue&&+c>=n.minValue&&+c<=n.maxValue;default:return C.neverReached(n.objectType),!1}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/Feature/FeatureUtilityNetworkAssociations":function(){define("require ../../chunks/tslib.es6 ../../core/maybe ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/has ../../core/Logger ../../core/RandomLCG ../../core/accessorSupport/decorators/subclass ../Widget ./FeatureUtilityNetworkAssociationType ./FeatureUtilityNetworkAssociations/FeatureUtilityNetworkAssociationsViewModel ./FeatureUtilityNetworkAssociations/VisibleElements ./support/FeatureElementInfo ../../chunks/componentsUtils ../support/globalCss ../support/widgetUtils ../support/decorators/messageBundle ../support/jsxFactory".split(" "),
function(a,k,d,C,H,E,p,F,K,v,q,e,m,l,h,r,t,z,w){E=class extends v{constructor(u,G){super(u,G);this._featureElementInfo=null;this.flowType="feature-utility-network-associations";this.parentFeatureViewModel=this.flowItems=null;this.headingLevel=2;this.viewModel=new e;this.messagesCommon=this.messages=null;this.visibleElements=new m}initialize(){this._featureElementInfo=new l;this.addHandles([C.watch(()=>[this.viewModel.description,this.viewModel.title,this.headingLevel],()=>this._setupFeatureElementInfo(),
C.initial)])}loadDependencies(){return h.loadCalciteComponents({chip:()=>new Promise((u,G)=>a(["../../chunks/calcite-chip"],u,G)),icon:()=>new Promise((u,G)=>a(["../../chunks/calcite-icon"],u,G)),loader:()=>new Promise((u,G)=>a(["../../chunks/calcite-loader"],u,G)),notice:()=>new Promise((u,G)=>a(["../../chunks/calcite-notice"],u,G)),list:()=>new Promise((u,G)=>a(["../../chunks/calcite-list"],u,G)),"list-item":()=>new Promise((u,G)=>a(["../../chunks/calcite-list-item"],u,G))})}destroy(){this._featureElementInfo=
d.destroyMaybe(this._featureElementInfo)}get description(){return this.viewModel.description}set description(u){this.viewModel.description=u}get title(){return this.viewModel.title}set title(u){this.viewModel.title=u}render(){const {state:u}=this.viewModel;return w.tsx("div",{class:this.classes("esri-feature-relationship",r.globalCss.widget)},this._featureElementInfo?.render(),"loading"===u?this._renderLoading():"disabled"===u?this._renderAssociationNotFound():this._renderContent())}_renderStickyLoading(){return"querying"===
this.viewModel.state?w.tsx("div",{class:"esri-feature__sticky-loading-container",key:"sticky-loader"},this._renderLoadingIcon()):null}_renderLoadingIcon(){return w.tsx("calcite-loader",{inline:!0,label:""})}_renderLoading(){return w.tsx("div",{class:"esri-feature__loading-container",key:"loading-container"},this._renderLoadingIcon())}_renderAssociationNotFound(){return w.tsx("calcite-notice",{icon:"exclamation-mark-triangle",key:"association-not-found",kind:"danger",open:!0,scale:"s",width:"full"},
w.tsx("div",{slot:"message"},this.messages?.noAssociations))}_setupFeatureElementInfo(){const {headingLevel:u,visibleElements:G}=this,f=G.description&&this.description,g=G.title&&this.title;this._featureElementInfo?.set({description:f,title:g,headingLevel:u})}_getAssociationTypeTitle(u){const {messages:G}=this;if(u.title)return u.title;switch(u.type){case "attachment":return G.associationsAttachments;case "connectivity":return G.associationsConnectivity;case "structure":return G.associationsStructure;
case "content":return G.associationsContents;case "container":return G.associationsContainer}}_selectAssociationType(u){const {viewModel:G,flowItems:f,parentFeatureViewModel:g}=this;if(f){var {associationTypes:b}=G;b.forEach(c=>{c.open=c.type===u.type?!0:!1});b=new q({viewModel:G,parentFeatureViewModel:g,listType:u,title:this._getAssociationTypeTitle(u),featureVisibleElements:this.featureVisibleElements,description:this.parentFeatureViewModel?.title,flowItems:f});f.push(b)}}_renderAssociationType(u){const G=
this._getAssociationTypeTitle(u);return w.tsx("calcite-list-item",{description:u.description,key:`association-type-${u.type}`,label:G,value:u.type,onCalciteListItemSelect:()=>this._selectAssociationType(u)},w.tsx("calcite-chip",{scale:"s",slot:"content-end",value:u.type},this._getFeatureCount(u.type)),w.tsx("calcite-icon",{flipRtl:!0,icon:"chevron-right",scale:"s",slot:"content-end"}))}_getFeatureCount(u){switch(u){case "attachment":return this.viewModel.attachmentsFeatureCount;case "structure":return this.viewModel.structureFeatureCount;
case "content":return this.viewModel.contentFeatureCount;case "container":return this.viewModel.containerFeatureCount;case "connectivity":return this.viewModel.connectivityFeatureCount}}_renderAssociations(u){return w.tsx("div",null,0<this._getFeatureCount(u.type)?this._renderAssociationType(u):null)}_renderContent(){const {state:u,associationTypes:G}=this.viewModel;return w.tsx("div",{class:this.classes("esri-feature-relationship__list",{["esri-feature-relationship__list--querying"]:"querying"===
u}),key:"list-container"},"ready"===u?w.tsx("calcite-list",null,G.map(f=>this._renderAssociations(f))):null,this._renderStickyLoading())}};k.__decorate([H.property()],E.prototype,"flowType",void 0);k.__decorate([H.property()],E.prototype,"flowItems",void 0);k.__decorate([H.property()],E.prototype,"parentFeatureViewModel",void 0);k.__decorate([H.property()],E.prototype,"featureVisibleElements",void 0);k.__decorate([H.property()],E.prototype,"description",null);k.__decorate([H.property()],E.prototype,
"headingLevel",void 0);k.__decorate([H.property()],E.prototype,"title",null);k.__decorate([H.property({type:e})],E.prototype,"viewModel",void 0);k.__decorate([H.property(),z.messageBundle("esri/widgets/Feature/t9n/Feature")],E.prototype,"messages",void 0);k.__decorate([H.property(),z.messageBundle("esri/t9n/common")],E.prototype,"messagesCommon",void 0);k.__decorate([H.property({type:m,nonNullable:!0})],E.prototype,"visibleElements",void 0);return E=k.__decorate([K.subclass("esri.widgets.Feature.FeatureUtilityNetworkAssociations")],
E)})},"esri/widgets/Feature/FeatureUtilityNetworkAssociationType":function(){define("require ../../chunks/tslib.es6 ../../intl ../../core/promiseUtils ../../core/ReactiveMap ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/has ../../core/Logger ../../core/RandomLCG ../../core/accessorSupport/decorators/subclass ../../intl/number ../../support/popupUtils ../Widget ./FeatureUtilityNetworkAssociations/FeatureUtilityNetworkAssociationsViewModel ./FeatureUtilityNetworkAssociations/VisibleElements ../../chunks/componentsUtils ../support/globalCss ../support/widgetUtils ../support/decorators/messageBundle ../support/jsxFactory ../../intl/substitute".split(" "),
function(a,k,d,C,H,E,p,F,K,v,q,e,m,l,h,r,t,z,w,u,G,f){var g;d=g=class extends l{constructor(b,c){super(b,c);this.flowType="feature-utility-network-association-type";this.description=null;this.headingLevel=2;this.title=null;this.viewModel=new h;this.messagesCommon=this.messages=this.flowItems=this.selectedLayer=this.listType=this.parentFeatureViewModel=null;this.visibleElements=new r;this._featuresPerPage=50;this._maxNumFeatures=1E3;this._currentFeaturePage=1;this._previewDisplayCount=3;this._associatedFeatureIntersectionObserverNode=
null;this._associatedFeatureIntersectionObserver=new IntersectionObserver(([n])=>{n?.isIntersecting&&this._increaseFeaturePage()},{root:window.document});this._tooltipReferenceMap=new H;this._filterText=""}initialize(){this.addHandles([E.watch(()=>[this._associatedFeatureIntersectionObserverNode],()=>this._handleAssociatedFeatureObserverChange())])}loadDependencies(){return t.loadCalciteComponents({chip:()=>new Promise((b,c)=>a(["../../chunks/calcite-chip"],b,c)),icon:()=>new Promise((b,c)=>a(["../../chunks/calcite-icon"],
b,c)),input:()=>new Promise((b,c)=>a(["../../chunks/calcite-input"],b,c)),loader:()=>new Promise((b,c)=>a(["../../chunks/calcite-loader"],b,c)),list:()=>new Promise((b,c)=>a(["../../chunks/calcite-list"],b,c)),"list-item":()=>new Promise((b,c)=>a(["../../chunks/calcite-list-item"],b,c)),tooltip:()=>new Promise((b,c)=>a(["../../chunks/calcite-tooltip"],b,c))})}destroy(){this._tooltipReferenceMap.clear()}get _numAssociatedFeatures(){const b=this.viewModel.associationViewModels;return this.selectedLayer?
b.get(this.selectedLayer).length:0}set currentFeaturePage(b){const {_featuresPerPage:c,_numAssociatedFeatures:n}=this;this._currentFeaturePage=Math.max(Math.min(b,Math.ceil(n/c)||1),1)}get currentFeaturePage(){return this._currentFeaturePage}render(){const b=this.viewModel.associationViewModels,{state:c,showAllEnabled:n}=this.viewModel,{state:y}=this.parentFeatureViewModel??{};return G.tsx("div",{class:this.classes("esri-feature-relationship",z.globalCss.widget)},"loading"===c||"querying"===c||"loading"===
y?this._renderLoading():G.tsx("calcite-list",null,n&&this.selectedLayer?G.tsx(G.tsxFragment,null,this._renderFilter(),this._renderAssociatedFeatureListPage(),this._renderFeatureObserver()):Array.from(b.keys(),D=>this._renderTypeList(D,b.get(D)))))}_renderFilter(){return G.tsx("div",{class:"esri-feature__filter-container",key:"filter"},G.tsx("calcite-input",{icon:"search",placeholder:this.messages.associationFilterPlaceholder,type:"search",onCalciteInputInput:b=>{this._filterText=b.target.value.trim().toLowerCase();
this._currentFeaturePage=1}}))}_showAllAssociations(b){const {flowItems:c,viewModel:n,description:y}=this;c&&b&&(n.showAllEnabled=!0,b=new g({selectedLayer:b,title:b?.title,flowItems:c,parentFeatureViewModel:this.parentFeatureViewModel,featureVisibleElements:this.featureVisibleElements,description:y,visibleElements:{title:!1,description:!1},viewModel:n}),c.push(b))}_renderAssociatedFeatureListPage(){const {currentFeaturePage:b,_featuresPerPage:c,_maxNumFeatures:n,_filterText:y}=this;var D=Math.min(b*
c,n);D=this.viewModel.associationViewModels.get(this.selectedLayer).filter(B=>m.getFeaturePopupTitle(B.featureViewModel).toLowerCase().includes(y)).slice(0,D);return[...this._renderTooltips(D),...this._renderAssociatedFeatureList(D)]}async _handleAssociatedFeatureObserverChange(){this._associatedFeatureIntersectionObserverNode&&this._associatedFeatureIntersectionObserver.unobserve(this._associatedFeatureIntersectionObserverNode);const {state:b,showAllEnabled:c}=this.viewModel;await C.after(0);this._associatedFeatureIntersectionObserverNode&&
"ready"===b&&c&&this._associatedFeatureIntersectionObserver.observe(this._associatedFeatureIntersectionObserverNode)}_associatedFeatureIntersectionObserverCreated(b){this._associatedFeatureIntersectionObserverNode=b}_renderFeatureObserver(){return G.tsx("div",{afterCreate:this._associatedFeatureIntersectionObserverCreated,bind:this,class:"esri-feature__feature-observer",key:"feature-observer"})}_increaseFeaturePage(){this.currentFeaturePage++}_renderLoading(){return G.tsx("div",{class:"esri-feature__loading-container",
key:"loading-container"},this._renderLoadingIcon())}_renderLoadingIcon(){return G.tsx("calcite-loader",{inline:!0,label:""})}isConnectivity(b){return["connectivity","junction-junction-connectivity","junction-edge-from-connectivity","junction-midspan-connectivity","junction-edge-to-connectivity"].includes(b.association.associationType)}_getConnectivityTooltip(b){switch(b){case "connectivity":case "junction-junction-connectivity":return this.messages.associationsJunctionJunction;case "junction-edge-from-connectivity":return this.messages.associationsJunctionEdgeFrom;
case "junction-midspan-connectivity":return this.messages.associationsJunctionEdgeMidspan;case "junction-edge-to-connectivity":return this.messages.associationsJunctionEdgeTo;default:return""}}_renderItemTooltip(b){const {_tooltipReferenceMap:c}=this;return this.isConnectivity(b)?G.tsx("calcite-tooltip",{key:`tooltip-${b.featureViewModel.uid}`,referenceElement:c.get(b.featureViewModel.uid)},this._getConnectivityTooltip(b.association.associationType)):null}_renderConnectivityIcon(b,c){switch(b){case "junction-edge-from-connectivity":b=
"connection-end-left";break;case "junction-edge-to-connectivity":b="connection-end-right";break;case "junction-midspan-connectivity":b="connection-middle";break;default:b="connection-to-connection"}return G.tsx("calcite-icon",{afterCreate:n=>this._tooltipReferenceMap.set(c,n),afterRemoved:()=>this._tooltipReferenceMap.delete(c),icon:b,scale:"s",slot:"content-start"})}_formatPercentAlong(b){return`${e.formatNumber(b.association.percentAlong,{style:"percent",maximumFractionDigits:2})}`}_renderAssociatedFeature(b){const {featureViewModel:c}=
b,n=m.getFeaturePopupTitle(c),y="loading"===c.state,D=this._findFlowItem(c),B=0>D&&this._isParentFeature(c),J=B||0<=D,O=this.isConnectivity(b),S=O&&"junction-midspan-connectivity"===b.association.associationType;return G.tsx("calcite-list-item",{class:this.classes("esri-feature-relationship__list-item",{["esri-feature-relationship__list-item--hidden"]:y}),description:b.terminalName??"",key:`associated-feature-type-${c.uid}`,label:n,onCalciteListItemSelect:()=>this._handleFeatureClick(B,D,c)},O?this._renderConnectivityIcon(b.association.associationType,
b.featureViewModel.uid):null,S?G.tsx("calcite-chip",{scale:"s",slot:"content-end",value:b.association.percentAlong},this._formatPercentAlong(b)):null,this._renderChevronIconNode(J))}async _selectAssociation(b){const {flowItems:c,featureVisibleElements:n}=this;if(c){b.abilities={utilityNetworkAssociationsContent:!0};var {default:y}=await new Promise((D,B)=>a(["../Feature"],J=>D(Object.freeze(Object.defineProperty({__proto__:null,default:J},Symbol.toStringTag,{value:"Module"}))),B));c.push(new y({flowItems:c,
flowType:"feature-association",viewModel:b,visibleElements:n}))}}_handleFeatureClick(b,c,n){if(b)this.flowItems.drain(y=>{"showAllEnabled"in y.viewModel&&(y.viewModel.showAllEnabled=!1);y.viewModel=null;y.destroy()});else if(0>c||!this.flowItems)this._selectAssociation(n);else for(;this.flowItems.length>c+1;)if(b=this.flowItems.pop())"showAllEnabled"in b.viewModel&&(b.viewModel.showAllEnabled=!1),b.viewModel=null,b.destroy()}_featureViewModelMatch(b,c){b=b.graphic;var n=b?.layer,y=null;"subtype-sublayer"===
n?.type&&n.parent?y=n.parent.globalIdField??null:n&&"globalIdField"in n&&(y=n.globalIdField);b=y?b?.attributes[y]:null;c=c.graphic;n=c?.layer;y=null;"subtype-sublayer"===n?.type&&n.parent?y=n.parent.globalIdField??null:n&&"globalIdField"in n&&(y=n.globalIdField);c=y?c?.attributes[y]:null;return b&&c&&b===c}_isParentFeature(b){const c=this.flowItems?.getItemAt(0);return c?this._featureViewModelMatch(c.parentFeatureViewModel,b):!1}_findFlowItem(b){return this.flowItems?.findIndex(c=>"feature"!==c.flowType?
!1:this._featureViewModelMatch(c.viewModel,b))??-1}_renderTooltips(b){return b.toArray().map(c=>this._renderItemTooltip(c))}_renderAssociatedFeatureList(b){return b.toArray().map(c=>this._renderAssociatedFeature(c))}_renderChevronIconNode(b){return G.tsx("calcite-icon",{flipRtl:!0,icon:b?"move-up":"chevron-right",scale:"s",slot:"content-end"})}_renderTypeList(b,c){const {messages:n}=this,y=c.slice(0,this._previewDisplayCount),D=y.length<c.length;return G.tsx("calcite-list-item",{key:"show-all",label:b.title,
open:!0,value:b.id},G.tsx("calcite-chip",{scale:"s",slot:"actions-end",value:b.id},c.length),G.tsx("calcite-list",{group:b.id},[this._renderTooltips(y),this._renderAssociatedFeatureList(y)],D?G.tsx("calcite-list-item",{description:f.substitute(n?.numberRecords,{number:c.length.toString()}),key:"show-all-item",label:n.showAll,onCalciteListItemSelect:()=>this._showAllAssociations(b)},G.tsx("calcite-icon",{icon:"list",scale:"s",slot:"content-end"})):null))}};k.__decorate([p.property()],d.prototype,"flowType",
void 0);k.__decorate([p.property()],d.prototype,"description",void 0);k.__decorate([p.property()],d.prototype,"headingLevel",void 0);k.__decorate([p.property()],d.prototype,"title",void 0);k.__decorate([p.property({type:h})],d.prototype,"viewModel",void 0);k.__decorate([p.property()],d.prototype,"parentFeatureViewModel",void 0);k.__decorate([p.property()],d.prototype,"listType",void 0);k.__decorate([p.property()],d.prototype,"selectedLayer",void 0);k.__decorate([p.property()],d.prototype,"featureVisibleElements",
void 0);k.__decorate([p.property()],d.prototype,"flowItems",void 0);k.__decorate([p.property(),u.messageBundle("esri/widgets/Feature/t9n/Feature")],d.prototype,"messages",void 0);k.__decorate([p.property(),u.messageBundle("esri/t9n/common")],d.prototype,"messagesCommon",void 0);k.__decorate([p.property({type:r,nonNullable:!0})],d.prototype,"visibleElements",void 0);k.__decorate([p.property()],d.prototype,"_featuresPerPage",void 0);k.__decorate([p.property()],d.prototype,"_maxNumFeatures",void 0);
k.__decorate([p.property()],d.prototype,"_numAssociatedFeatures",null);k.__decorate([p.property()],d.prototype,"_currentFeaturePage",void 0);k.__decorate([p.property()],d.prototype,"currentFeaturePage",null);k.__decorate([p.property()],d.prototype,"_previewDisplayCount",void 0);k.__decorate([p.property()],d.prototype,"_associatedFeatureIntersectionObserverNode",void 0);k.__decorate([p.property()],d.prototype,"_tooltipReferenceMap",void 0);k.__decorate([p.property()],d.prototype,"_filterText",void 0);
return d=g=k.__decorate([q.subclass("esri.widgets.Feature.FeatureUtilityNetworkAssociationType")],d)})},"esri/widgets/Feature/FeatureUtilityNetworkAssociations/FeatureUtilityNetworkAssociationsViewModel":function(){define("../../../chunks/tslib.es6 ../../../Graphic ../../../core/Accessor ../../../core/Clonable ../../../core/Collection ../../../core/Identifiable ../../../core/promiseUtils ../../../core/ReactiveMap ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ../../../layers/FeatureLayer ../../../networks/support/typeUtils ../../../rest/networks/support/Association ../../../rest/networks/support/NetworkElement ../../../rest/support/Query ./resources ../support/featureUtils".split(" "),
function(a,k,d,C,H,E,p,F,K,v,q,e,m,l,h,r,t,z,w,u,G){d=class extends C.ClonableMixin(E.IdentifiableMixin(d)){constructor(f){super(f);this._loaded=!1;this._queryFeatureCountAbortController=this._queryPageAbortController=this._queryAbortController=null;this.networkSourceIdsInUse=new Set;this.map=this.layer=this.graphic=this.description=null;this.featureCount=0;this.associationTypes=null;this.showAllEnabled=!1;this.title=null;this.connectivityFeatureCount=this.containerFeatureCount=this.contentFeatureCount=
this.structureFeatureCount=this.attachmentsFeatureCount=0;this._cancelQuery=()=>{const {_queryAbortController:g}=this;g&&g.abort();this._queryAbortController=null};this._cancelQueryFeatureCount=()=>{const {_queryFeatureCountAbortController:g}=this;g&&g.abort();this._queryFeatureCountAbortController=null};this._queryController=async g=>{this._cancelQuery();const b=new AbortController;this._queryAbortController=b;await p.ignoreAbortErrors(this._query(g));this._queryAbortController===b&&(this._queryAbortController=
null)};this._queryFeatureCountController=async()=>{this._loaded=!1;this._cancelQueryFeatureCount();const g=new AbortController;this._queryFeatureCountAbortController=g;await p.ignoreAbortErrors(this._queryFeatureCount());this._queryFeatureCountAbortController===g&&(this._queryFeatureCountAbortController=null);this._loaded=!0};this._queryDebounced=p.debounce(this._queryController,100);this._queryFeatureCountDebounced=p.debounce(this._queryFeatureCountController,100)}initialize(){this.associationTypes?.forEach(f=>
{f.open=!1});this.addHandles([...(this.associationTypes?.map(f=>K.watch(()=>f.open,()=>{f.open&&this._queryDebounced(f)}))??[]),K.watch(()=>[this.graphic,this.layer,this.map,this.associationTypes,this.objectId,this.globalId,this.canQuery],()=>this._queryFeatureCountDebounced(),K.initial)])}destroy(){this._cancelQuery();this._cancelQueryFeatureCount();this._destroyAssociatedFeatureViewModels()}get supportsCacheHint(){return!!this.layer?.capabilities?.query?.supportsCacheHint}get canLoad(){return!!this.map&&
!!this.associationTypes&&"string"===typeof this.globalId}get canQuery(){const f=this.layer?.capabilities?.query;return!!this.associationTypes&&"string"===typeof this.globalId&&!!f?.supportsPagination}get objectId(){return(this.objectIdField&&this.graphic?.attributes?.[this.objectIdField])??null}get objectIdField(){return this.layer?.objectIdField||null}get globalId(){return(this.globalIdField&&this.graphic?.attributes?.[this.globalIdField])??null}get globalIdField(){const {layer:f}=this;return"subtype-sublayer"===
f?.type&&f?.parent?f.parent.globalIdField??null:f?.globalIdField??null}get state(){const {_queryAbortController:f,_queryFeatureCountAbortController:g,_queryPageAbortController:b,canQuery:c,_loaded:n,canLoad:y}=this;return g||y&&!n?"loading":f||b?"querying":c&&0!==this.featureCount?"ready":"disabled"}get utilityNetwork(){const {layer:f,map:g}=this;return f?.loaded&&g?"subtype-sublayer"===f?.type&&f?.parent?G.findUtilityNetwork(g,f.parent)??null:G.findUtilityNetwork(g,f)??null:null}get associationsLayer(){const {utilityNetwork:f}=
this;return f?.loaded?new h({url:f.networkSystemLayers.associationsTableUrl,gdbVersion:f.gdbVersion}):null}get attachmentsAssociations(){return this._get("attachmentsAssociations")||new H}get structureAssociations(){return this._get("structureAssociations")||new H}get contentAssociations(){return this._get("contentAssociations")||new H}get containerAssociations(){return this._get("containerAssociations")||new H}get connectivityAssociations(){return this._get("connectivityAssociations")||new H}get associationFeatures(){return this._get("associationFeatures")||
new F}get associationViewModels(){return this._get("associationViewModels")||new Map}refresh(){this._queryFeatureCountDebounced()}_destroyAssociatedFeatureViewModels(){this.associationViewModels.forEach(f=>f.destroyAll())}_generateGlobalIdWhereClause(f,g){const {globalId:b,networkSourceIdsInUse:c}=this;var {associatedNetworkSourceId:n}=f;const y=g.fieldsIndex.get(u.featureUtilityNetworkFields.fromGlobalId),D=g.fieldsIndex.get(u.featureUtilityNetworkFields.toGlobalId),B=g.fieldsIndex.get(u.featureUtilityNetworkFields.fromNetworkSourceId);
var J=g.fieldsIndex.get(u.featureUtilityNetworkFields.toNetworkSourceId);g=null!=n;const O=`(${Array.from(c.values())})`;J=g?` AND ${J.name} = ${n} AND ${J.name} IN ${O}`:"";n=g?` AND ${B.name} = ${n} AND ${B.name} IN ${O}`:"";switch(f.type){case "connectivity":return`((${y.name} = '${b}'${J}) OR (${D.name} = '${b}'${n}))`;case "attachment":case "content":return`${y.name} = '${b}'${J}`;case "container":case "structure":return`${D.name} = '${b}'${n}`;default:return""}}_generateNetworkSourceIdWhereClause(f){var {networkSourceIdsInUse:g}=
this;g=`(${Array.from(g.values())})`;const b=f.fieldsIndex.get(u.featureUtilityNetworkFields.fromNetworkSourceId);f=f.fieldsIndex.get(u.featureUtilityNetworkFields.toNetworkSourceId);return`(${b.name} IN ${g} AND ${f.name} IN ${g})`}_generateAssociationTypeWhereClause(f,g){g=g.fieldsIndex.get(u.featureUtilityNetworkFields.associationType);switch(f.type){case "attachment":case "structure":return`${g.name} = 3`;case "connectivity":return`${g.name} IN  (1, 4, 5, 6)`;case "container":case "content":return`${g.name} = 2`;
default:return""}}_generateWhereClause(f,g){var b=g.fieldsIndex.get(u.featureUtilityNetworkFields.status),c=`(${r.AssociationOpenStatus.join(",")})`;b=`${b.name} IN ${c}`;c=this._generateGlobalIdWhereClause(f,g);f=this._generateAssociationTypeWhereClause(f,g);return`(${c} AND ${b} AND ${f})`}async _loadUtiltyNetworks(){const f=this.map;if(f){await Promise.allSettled(f.utilityNetworks?.map(async c=>{await c.load()})??[]);var g=c=>{"layerId"in c&&b.isUtilityLayer(c)&&(c=b.getSourceIdByLayerId(c.layerId),
null!==c&&this.networkSourceIdsInUse.add(c))},b=this.utilityNetwork;this._set("networkSourceIdsInUse",new Set);f.allLayers.forEach(g);f.allTables.forEach(g)}}async _findLayersBySourceId(f){const {utilityNetwork:g,map:b}=this;var c=y=>y.url&&y.layerId===n?y.url.replace(/\/\d+$/,"")===g?.featureServiceUrl:!1;await g?.load();const n=g.getLayerIdBySourceId(f);f=b.allLayers.filter(c);c=b.allTables.filter(c);c=f.concat(c).toArray();await Promise.allSettled(c.map(y=>y.load()));return c}_clearAssociations(){this.attachmentsAssociations.removeAll();
this.structureAssociations.removeAll();this.contentAssociations.removeAll();this.containerAssociations.removeAll();this.connectivityAssociations.removeAll()}_clearFeatures(){this.associationFeatures.forEach(f=>f.removeAll());this.associationFeatures.clear()}_getAssociationsByType(f){switch(f){case "attachment":return this.attachmentsAssociations;case "structure":return this.structureAssociations;case "connectivity":return this.connectivityAssociations;case "container":return this.containerAssociations;
case "content":return this.contentAssociations}}_createAssociationFromFeature(f,g){if(!f)return null;const b=r.AssociationTypeDict.get(g.attributes[f.fieldsIndex.get(u.featureUtilityNetworkFields.associationType).name]);return new t({globalId:g.attributes[f.fieldsIndex.get(u.featureUtilityNetworkFields.globalId).name],fromNetworkElement:new z({globalId:g.attributes[f.fieldsIndex.get(u.featureUtilityNetworkFields.fromGlobalId).name],networkSourceId:g.attributes[f.fieldsIndex.get(u.featureUtilityNetworkFields.fromNetworkSourceId).name],
terminalId:g.attributes[f.fieldsIndex.get(u.featureUtilityNetworkFields.fromTerminalId).name]}),toNetworkElement:new z({globalId:g.attributes[f.fieldsIndex.get(u.featureUtilityNetworkFields.toGlobalId).name],networkSourceId:g.attributes[f.fieldsIndex.get(u.featureUtilityNetworkFields.toNetworkSourceId).name],terminalId:g.attributes[f.fieldsIndex.get(u.featureUtilityNetworkFields.toTerminalId).name]}),associationType:b,status:g.attributes[f.fieldsIndex.get(u.featureUtilityNetworkFields.status).name],
isContentVisible:g.attributes[f.fieldsIndex.get(u.featureUtilityNetworkFields.isContentVisible).name],percentAlong:g.attributes[f.fieldsIndex.get(u.featureUtilityNetworkFields.percentAlong).name]})}async _queryLayer(f,g,b,c,n){const y=f.fieldsIndex.get(u.featureUtilityNetworkFields.assetGroup),D=f.fieldsIndex.get(u.featureUtilityNetworkFields.assetType),B=null!=b,J=null!=c;g="("+g.map(O=>`'${O}'`).join(", ")+")";b=new w({outFields:["*"],cacheHint:this.supportsCacheHint,where:`${f.globalIdField} IN ${g}`+
(B?` AND ${y?.name} = ${b}`:"")+(B&&J?` AND ${D?.name} = ${c}`:"")});return await this._queryAll(b,f,{signal:n?.signal})}async _createAssociationFeatureObjects(f,g,b,c,n,y){if(0===f.length)return[];const D=new Map;for(const [J,O]of g){g=await this._findLayersBySourceId(J);for(const S of g)(await this._queryLayer(S,O,c,n,y)).forEach(x=>{if(x.getEffectivePopupTemplate()&&x.layer){const I=D.get(x.attributes[S.globalIdField])??[];I.push(x);D.set(x.attributes[S.globalIdField],I)}})}const B=[];f.toArray().forEach(J=>
{const O=J.fromNetworkElement.globalId===b?J.toNetworkElement:J.fromNetworkElement;(D.get(O.globalId)??[]).forEach(S=>{const x=this.utilityNetwork?.getTerminalById(O?.terminalId)?.name;B.push({association:J,feature:S,terminalName:x})})});return B}_parseFeatureObjects(f,g){f.forEach(b=>{const c=(b?.feature).layer,n=g.get(c)??new H;n.add(b);g.set(c,n)})}async _queryAll(f,g,b){const c=[];let n=0,y=!1;f.num=g.sourceJSON?.maxRecordCount??2E3;do{f.start=n;const D=await g.queryFeatures(f,b);c.push(...D.features);
(y=D.exceededTransferLimit)&&(n+=D.features.length)}while(y);return c}async _queryAssociatedFeatureCount(f){const {layer:g,globalId:b,supportsCacheHint:c,associationTypes:n,associationsLayer:y,utilityNetwork:D,canQuery:B}=this;await Promise.allSettled([g?.load(),D?.load(),y?.load()]);this._clearAssociations();if(B&&g&&n&&y){var J=y.fieldsIndex.get(u.featureUtilityNetworkFields.toGlobalId).name,O=y.fieldsIndex.get(u.featureUtilityNetworkFields.fromGlobalId).name,S=n.map(M=>this._generateWhereClause(M,
y)),x=this._generateNetworkSourceIdWhereClause(y);S=S.join(" OR ");x=new w({outFields:["*"],cacheHint:c,returnGeometry:!1,where:`(${S}) AND (${x})`});x=await this._queryAll(x,y,{signal:f?.signal});var I=new Map;n.forEach(M=>{I.set(M.type,[])});x.forEach(M=>{const N=y.fieldsIndex.get(u.featureUtilityNetworkFields.associationType);switch(M.attributes[N.name]){case 1:case 4:case 5:case 6:M.attributes[O]===b?I.get("connectivity").push(M.attributes[J]):I.get("connectivity").push(M.attributes[O]);this.connectivityAssociations.add(this._createAssociationFromFeature(y,
M));break;case 2:M.attributes[O]===b?(I.get("content").push(M.attributes[J]),this.contentAssociations.add(this._createAssociationFromFeature(y,M))):(I.get("container").push(M.attributes[O]),this.containerAssociations.add(this._createAssociationFromFeature(y,M)));break;case 3:M.attributes[O]===b?(I.get("attachment").push(M.attributes[J]),this.attachmentsAssociations.add(this._createAssociationFromFeature(y,M))):(I.get("structure").push(M.attributes[O]),this.structureAssociations.add(this._createAssociationFromFeature(y,
M)))}});x=n.map(async M=>{const {associatedNetworkSourceId:N,associatedAssetGroup:Q,associatedAssetType:T}=M;var U=I.get(M.type);U=null!=Q?await this._countAssociatedFeatures(N,U,Q,T,f):U.length;switch(M.type){case "attachment":this._set("attachmentsFeatureCount",U);break;case "structure":this._set("structureFeatureCount",U);break;case "content":this._set("contentFeatureCount",U);break;case "container":this._set("containerFeatureCount",U);break;case "connectivity":this._set("connectivityFeatureCount",
U)}});await Promise.allSettled(x)}}async _countAssociatedFeatureCount(f,g,b,c,n){const y=f.fieldsIndex.get(u.featureUtilityNetworkFields.assetGroup),D=f.fieldsIndex.get(u.featureUtilityNetworkFields.assetType),B=null!=c;g="("+g.map(J=>`'${J}'`).join(", ")+")";return f.queryFeatureCount({where:`${f.globalIdField} IN ${g}`+` AND ${y?.name} = ${b}`+(B?` AND ${D?.name} = ${c}`:""),outFields:["*"],returnGeometry:!1},{signal:n?.signal})}async _countAssociatedFeatures(f,g,b,c,n){if(0===g.length)return 0;
f=(await this._findLayersBySourceId(f)).map(async y=>this._countAssociatedFeatureCount(y,g,b,c,n));return(await Promise.all(f)).reduce((y,D)=>y+D,0)}async _queryAssociatedFeatures(f,g){const {layer:b,globalId:c,associationTypes:n,associationsLayer:y,utilityNetwork:D,canQuery:B,associationFeatures:J}=this;await Promise.allSettled([b?.load(),D?.load(),y?.load()]);if(B&&b&&n&&y){var O=this._getAssociationsByType(f.type),{associatedAssetGroup:S,associatedAssetType:x}=f,I=new Map;O.forEach(M=>{const {networkSourceId:N,
elementGlobalId:Q}=M.fromNetworkElement.globalId===c?{networkSourceId:M.toNetworkElement.networkSourceId,elementGlobalId:M.toNetworkElement.globalId}:{networkSourceId:M.fromNetworkElement.networkSourceId,elementGlobalId:M.fromNetworkElement.globalId};M=I.get(N)||[];M.push(Q);I.set(N,M)});f=await this._createAssociationFeatureObjects(O,I,c,S,x,g);this._parseFeatureObjects(f,J)}}async _queryFeatureCount(){await this._loadUtiltyNetworks();const {_queryFeatureCountAbortController:f,canQuery:g}=this;g?
(await this._queryAssociatedFeatureCount(f),this._set("featureCount",this.attachmentsFeatureCount+this.structureFeatureCount+this.contentFeatureCount+this.containerFeatureCount+this.connectivityFeatureCount)):this._set("featureCount",0)}async _query(f){await this._loadUtiltyNetworks();const {_queryAbortController:g}=this;this.featureCount&&(this._destroyAssociatedFeatureViewModels(),this._clearFeatures(),this.destroyed||await this._queryAssociatedFeatures(f,{signal:g?.signal}))}};a.__decorate([v.property()],
d.prototype,"_loaded",void 0);a.__decorate([v.property()],d.prototype,"_queryAbortController",void 0);a.__decorate([v.property()],d.prototype,"_queryPageAbortController",void 0);a.__decorate([v.property()],d.prototype,"_queryFeatureCountAbortController",void 0);a.__decorate([v.property({readOnly:!0})],d.prototype,"supportsCacheHint",null);a.__decorate([v.property({readOnly:!0})],d.prototype,"canLoad",null);a.__decorate([v.property({readOnly:!0})],d.prototype,"canQuery",null);a.__decorate([v.property()],
d.prototype,"networkSourceIdsInUse",void 0);a.__decorate([v.property()],d.prototype,"description",void 0);a.__decorate([v.property({type:k})],d.prototype,"graphic",void 0);a.__decorate([v.property()],d.prototype,"layer",void 0);a.__decorate([v.property()],d.prototype,"map",void 0);a.__decorate([v.property({readOnly:!0})],d.prototype,"objectId",null);a.__decorate([v.property({readOnly:!0})],d.prototype,"objectIdField",null);a.__decorate([v.property({readOnly:!0})],d.prototype,"globalId",null);a.__decorate([v.property({readOnly:!0})],
d.prototype,"globalIdField",null);a.__decorate([v.property()],d.prototype,"featureCount",void 0);a.__decorate([v.property()],d.prototype,"associationTypes",void 0);a.__decorate([v.property()],d.prototype,"showAllEnabled",void 0);a.__decorate([v.property()],d.prototype,"state",null);a.__decorate([v.property()],d.prototype,"title",void 0);a.__decorate([v.property({readOnly:!0})],d.prototype,"utilityNetwork",null);a.__decorate([v.property({readOnly:!0})],d.prototype,"associationsLayer",null);a.__decorate([v.property({readOnly:!0})],
d.prototype,"attachmentsFeatureCount",void 0);a.__decorate([v.property({readOnly:!0})],d.prototype,"structureFeatureCount",void 0);a.__decorate([v.property({readOnly:!0})],d.prototype,"attachmentsAssociations",null);a.__decorate([v.property({readOnly:!0})],d.prototype,"structureAssociations",null);a.__decorate([v.property({readOnly:!0})],d.prototype,"contentFeatureCount",void 0);a.__decorate([v.property({readOnly:!0})],d.prototype,"containerFeatureCount",void 0);a.__decorate([v.property({readOnly:!0})],
d.prototype,"contentAssociations",null);a.__decorate([v.property({readOnly:!0})],d.prototype,"containerAssociations",null);a.__decorate([v.property({readOnly:!0})],d.prototype,"connectivityFeatureCount",void 0);a.__decorate([v.property({readOnly:!0})],d.prototype,"connectivityAssociations",null);a.__decorate([v.property({readOnly:!0})],d.prototype,"associationFeatures",null);a.__decorate([v.property({readOnly:!0})],d.prototype,"associationViewModels",null);return d=a.__decorate([l.subclass("esri.widgets.Feature.FeatureUtilityNetworkAssociations.FeatureUtilityNetworkAssociationsViewModel")],
d)})},"esri/networks/support/typeUtils":function(){define(["exports","../../core/jsonMap"],function(a,k){a.RuleType=void 0;(function(p){p[p.RTJunctionJunctionConnectivity=1]="RTJunctionJunctionConnectivity";p[p.RTAttachment=2]="RTAttachment";p[p.RTContainment=3]="RTContainment";p[p.RTJunctionEdgeConnectivity=4]="RTJunctionEdgeConnectivity";p[p.RTEdgeJunctionEdgeConnectivity=5]="RTEdgeJunctionEdgeConnectivity"})(a.RuleType||(a.RuleType={}));const d=new k.JSONMap({connected:"connected",upstream:"upstream",
downstream:"downstream",shortestPath:"shortest-path",subnetwork:"subnetwork",subnetworkController:"subnetwork-controller",loops:"loops",isolation:"isolation"}),C=new k.JSONMap({junctionJunctionConnectivity:"junction-junction-connectivity",connectivity:"connectivity",attachment:"attachment",containment:"containment",junctionEdgeFromConnectivity:"junction-edge-from-connectivity",junctionMidspanConnectivity:"junction-midspan-connectivity",junctionEdgeToConnectivity:"junction-edge-to-connectivity"}),
H=Array.from({length:33},(p,F)=>2*F),E=new Map([[1,"connectivity"],[2,"containment"],[3,"attachment"],[4,"junction-edge-from-connectivity"],[5,"junction-midspan-connectivity"],[6,"junction-edge-to-connectivity"]]);k=new k.JSONMap({normal:"normal",rebuild:"rebuild",forceRebuild:"force-rebuild"});a.AssociationOpenStatus=H;a.AssociationTypeDict=E;a.AssociationTypeEnum={connectivity:1,"junction-junction-connectivity":1,attachment:2,containment:3,"junction-edge-from-connectivity":4,"junction-midspan-connectivity":5,
"junction-edge-to-connectivity":6};a.associationTypeKebabDict=C;a.traceTypeKebabDict=d;a.validationTypeKebabDict=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/rest/networks/support/Association":function(){define("../../../chunks/tslib.es6 ../../../geometry ../../../core/JSONSupport ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/reader ../../../core/accessorSupport/decorators/subclass ../../../core/accessorSupport/decorators/writer ../../../networks/support/typeUtils ./NetworkElement ../../../geometry/Polyline".split(" "),
function(a,k,d,C,H,E,p,F,K,v,q,e,m){k=class extends d.JSONSupport{constructor(l){super(l);this.status=this.isContentVisible=this.errorCode=this.percentAlong=this.errorMessage=this.geometry=this.toNetworkElement=this.fromNetworkElement=this.associationType=this.globalId=null}readFromNetworkElement(l,h){return new e({globalId:h.fromGlobalId,networkSourceId:h.fromNetworkSourceId,terminalId:h.fromTerminalId})}writeFromNetworkElement(l,h){l&&(h.fromGlobalId=l.globalId,h.fromNetworkSourceId=l.networkSourceId,
h.fromTerminalId=l.terminalId)}readToNetworkElement(l,h){return new e({globalId:h.toGlobalId,networkSourceId:h.toNetworkSourceId,terminalId:h.toTerminalId})}writeToNetworkElement(l,h){l&&(h.toGlobalId=l.globalId,h.toNetworkSourceId=l.networkSourceId,h.toTerminalId=l.terminalId)}};a.__decorate([C.property({type:String,json:{write:!0}})],k.prototype,"globalId",void 0);a.__decorate([C.property({type:q.associationTypeKebabDict.apiValues,json:{type:q.associationTypeKebabDict.jsonValues,read:q.associationTypeKebabDict.read,
write:q.associationTypeKebabDict.write}})],k.prototype,"associationType",void 0);a.__decorate([C.property({type:e,json:{write:{target:{fromGlobalId:{type:String},fromNetworkSourceId:{type:Number},fromTerminalId:{type:Number}}},read:{source:["fromGlobalId","fromNetworkSourceId","fromTerminalId"]}}})],k.prototype,"fromNetworkElement",void 0);a.__decorate([F.reader("fromNetworkElement")],k.prototype,"readFromNetworkElement",null);a.__decorate([v.writer("fromNetworkElement")],k.prototype,"writeFromNetworkElement",
null);a.__decorate([C.property({type:e,json:{write:{target:{toGlobalId:{type:String},toNetworkSourceId:{type:Number},toTerminalId:{type:Number}}},read:{source:["toGlobalId","toNetworkSourceId","toTerminalId"]}}})],k.prototype,"toNetworkElement",void 0);a.__decorate([F.reader("toNetworkElement")],k.prototype,"readToNetworkElement",null);a.__decorate([v.writer("toNetworkElement")],k.prototype,"writeToNetworkElement",null);a.__decorate([C.property({type:m,json:{write:!0}})],k.prototype,"geometry",void 0);
a.__decorate([C.property({type:String,json:{write:!0}})],k.prototype,"errorMessage",void 0);a.__decorate([C.property({type:Number,json:{write:!0}})],k.prototype,"percentAlong",void 0);a.__decorate([C.property({type:Number,json:{write:!0}})],k.prototype,"errorCode",void 0);a.__decorate([C.property({type:Boolean,json:{write:!0}})],k.prototype,"isContentVisible",void 0);a.__decorate([C.property({type:Number,json:{write:!0}})],k.prototype,"status",void 0);return k=a.__decorate([K.subclass("esri.rest.networks.support.Association")],
k)})},"esri/rest/networks/support/NetworkElement":function(){define("../../../chunks/tslib.es6 ../../../core/JSONSupport ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass".split(" "),function(a,k,d,C,H,E,p){k=class extends k.JSONSupport{constructor(F){super(F);this.terminalId=this.positionTo=this.positionFrom=this.objectId=this.networkSourceId=this.globalId=this.assetTypeCode=this.assetGroupCode=
null}};a.__decorate([d.property({type:Number,json:{write:!0}})],k.prototype,"assetGroupCode",void 0);a.__decorate([d.property({type:Number,json:{write:!0}})],k.prototype,"assetTypeCode",void 0);a.__decorate([d.property({type:String,json:{write:!0}})],k.prototype,"globalId",void 0);a.__decorate([d.property({type:Number,json:{write:!0}})],k.prototype,"networkSourceId",void 0);a.__decorate([d.property({type:Number,json:{write:!0}})],k.prototype,"objectId",void 0);a.__decorate([d.property({type:Number,
json:{write:!0}})],k.prototype,"positionFrom",void 0);a.__decorate([d.property({type:Number,json:{write:!0}})],k.prototype,"positionTo",void 0);a.__decorate([d.property({type:Number,json:{write:!0}})],k.prototype,"terminalId",void 0);return k=a.__decorate([p.subclass("esri.rest.networks.support.NetworkElement")],k)})},"esri/widgets/Feature/FeatureUtilityNetworkAssociations/resources":function(){define(["exports"],function(a){a.featureUtilityNetworkFields={fromGlobalId:"fromglobalid",fromNetworkSourceId:"fromnetworksourceid",
fromTerminalId:"fromterminalid",toGlobalId:"toglobalid",toNetworkSourceId:"tonetworksourceid",toTerminalId:"toterminalid",associationType:"associationtype",globalId:"globalid",status:"status",isContentVisible:"iscontentvisible",percentAlong:"percentalong",assetGroup:"assetgroup",assetType:"assettype"};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/Feature/FeatureUtilityNetworkAssociations/VisibleElements":function(){define("../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass".split(" "),
function(a,k,d,C,H,E,p){k=class extends k{constructor(F){super(F);this.description=this.title=!0}};a.__decorate([d.property({type:Boolean,nonNullable:!0})],k.prototype,"title",void 0);a.__decorate([d.property({type:Boolean,nonNullable:!0})],k.prototype,"description",void 0);return k=a.__decorate([p.subclass("esri.widgets.Feature.FeatureUtilityNetworkAssociations.VisibleElements")],k)})},"esri/widgets/Feature/FeatureViewModel":function(){define("../../chunks/tslib.es6 ../../geometry ../../Graphic ../../arcade/featureset/support/FeatureSetQueryInterceptor ../../core/Accessor ../../core/arrayUtils ../../core/Collection ../../core/Identifiable ../../core/Logger ../../core/promiseUtils ../../core/reactiveUtils ../../core/throttle ../../core/accessorSupport/decorators/property ../../core/accessorSupport/decorators/cast ../../core/has ../../core/accessorSupport/decorators/subclass ../../popup/content/TextContent ../../support/popupUtils ../../time/timeZoneUtils ./FeatureAttachments/FeatureAttachmentsViewModel ./FeatureContent/FeatureContentViewModel ./FeatureExpression/FeatureExpressionViewModel ./FeatureFields/FeatureFieldsViewModel ./FeatureMedia/FeatureMediaViewModel ./FeatureRelationship/FeatureRelationshipViewModel ./FeatureUtilityNetworkAssociations/FeatureUtilityNetworkAssociationsViewModel ./support/arcadeFeatureUtils ./support/featureUtils ./support/relatedFeatureUtils ../../geometry/Point".split(" "),
function(a,k,d,C,H,E,p,F,K,v,q,e,m,l,h,r,t,z,w,u,G,f,g,b,c,n,y,D,B,J){var O;const S={attachmentsContent:!0,chartAnimation:!0,customContent:!0,expressionContent:!0,fieldsContent:!0,mediaContent:!0,textContent:!0,relationshipContent:!0,utilityNetworkAssociationsContent:!0};k=O=class extends F.IdentifiableMixin(H){constructor(x){super(x);this._associationVMAbortController=this._featureAbortController=this._error=null;this._graphicChangedThrottled=e.throttle(this._graphicChanged,1,this);this._graphicExpressionAttributes=
this._expressionAttributes=null;this.abilities={...S};this.content=null;this.contentViewModels=[];this.description=null;this.defaultPopupTemplateEnabled=!1;this.location=this.lastEditInfo=this.formattedAttributes=null;this.relatedInfos=new Map;this.title="";this.view=null;this._isAllowedContentType=I=>{const {abilities:M}=this;return"attachments"===I.type&&!!M.attachmentsContent||"custom"===I.type&&!!M.customContent||"fields"===I.type&&!!M.fieldsContent||"media"===I.type&&!!M.mediaContent||"text"===
I.type&&!!M.textContent||"expression"===I.type&&!!M.expressionContent||"relationship"===I.type&&!!M.relationshipContent||"utility-network-associations"===I.type&&!!M.utilityNetworkAssociationsContent};this.addHandles(q.watch(()=>[this.graphic,this._effectivePopupTemplate,this.abilities,this.timeZone],()=>this._graphicChangedThrottled(),q.initial))}initialize(){this.addHandles(this._graphicChangedThrottled)}destroy(){this._clear();this._cancelFeatureQuery();this.graphic=this._error=null;this._destroyContentViewModels();
this.relatedInfos.clear()}get _effectivePopupTemplate(){return null!=this.graphic?this.graphic.getEffectivePopupTemplate(this.defaultPopupTemplateEnabled):null}get _fieldInfoMap(){return D.createFieldInfoMap(D.getAllFieldInfos(this._effectivePopupTemplate),this._sourceLayer)}get _sourceLayer(){return D.getSourceLayer(this.graphic)}castAbilities(x){return{...S,...x}}get isTable(){return this._sourceLayer?.isTable||!1}get state(){return this.graphic?this._error?"error":this.waitingForContent?"loading":
"ready":"disabled"}set graphic(x){this._featureAbortController=new AbortController;this._set("graphic",x?.clone()??null)}get spatialReference(){return this.view?.spatialReference??null}set spatialReference(x){this._override("spatialReference",x)}get timeZone(){return this.view?.timeZone??w.system}set timeZone(x){this._overrideIfSome("timeZone",x)}get map(){return this.view?.map||null}set map(x){this._override("map",x)}get waitingForContent(){return!(!this._featureAbortController&&!this._associationVMAbortController)}setActiveMedia(x,
I){x=this.contentViewModels[x];x instanceof b&&x.setActiveMedia(I)}nextMedia(x){x=this.contentViewModels[x];x instanceof b&&x.next()}previousMedia(x){x=this.contentViewModels[x];x instanceof b&&x.previous()}async updateGeometry(){const {graphic:x,spatialReference:I,_sourceLayer:M}=this;await M?.load();var N=M?.objectIdField;N&&x&&M&&(N=x?.attributes?.[N],null!=N&&(N=[N],!x.geometry&&(N=(await D.querySourceLayer({layer:M,graphic:x,outFields:[],objectIds:N,returnGeometry:!0,spatialReference:I}))?.geometry)))&&
(x.geometry=N)}_clear(){this._set("title","");this._set("content",null);this._set("formattedAttributes",null)}async _graphicChanged(){this._cancelFeatureQuery();this._error=null;this._clear();const {graphic:x}=this;if(x){var I=new AbortController;this._featureAbortController=I;try{await this._queryFeature({signal:I.signal})}catch(M){v.isAbortError(M)||(this._error=M,K.getLogger(this).error("error","The popupTemplate could not be displayed for this feature.",{error:M,graphic:x,popupTemplate:this._effectivePopupTemplate}))}this._featureAbortController===
I&&(this._featureAbortController=null)}}_cancelFeatureQuery(){const {_featureAbortController:x}=this;x&&x.abort();this._featureAbortController=null}_compileContentElement(x,I){if("attachments"===x.type)return this._compileAttachments(x,I);if("custom"===x.type)return this._compileCustom(x,I);if("fields"===x.type)return this._compileFields(x,I);if("media"===x.type)return this._compileMedia(x,I);if("text"===x.type)return this._compileText(x,I);if("expression"===x.type)return this._compileExpression(x,
I);if("relationship"===x.type)return this._compileRelationship(x,I);if("utility-network-associations"===x.type)return this._compileUtilityNetworkAssociation(x,I)}_compileContent(x){this._destroyContentViewModels();if(this.graphic)return Array.isArray(x)?x.filter(this._isAllowedContentType).map((I,M)=>this._compileContentElement(I,M)).filter(E.isSome):"string"===typeof x?this._compileText(new t({text:x}),0).text:x}_destroyContentViewModels(){this.removeHandles("relationship-view-models");this.removeHandles("content-view-models");
this.contentViewModels.forEach(x=>x&&!x.destroyed&&x.destroy());this._set("contentViewModels",[])}_matchesFeature(x,I){x=x?.graphic?.getObjectId();I=I?.getObjectId();return null!=x&&null!=I&&x===I}_setRelatedFeaturesViewModels({relatedFeatureViewModels:x,relatedFeatures:I,map:M}){const {view:N,spatialReference:Q,timeZone:T}=this;I?.filter(Boolean).forEach(U=>{x.some(Y=>this._matchesFeature(Y,U))||x.add(new O({abilities:{relationshipContent:!1},map:M,view:N,spatialReference:Q,timeZone:T,graphic:U}))});
x.forEach(U=>{I?.find(Y=>this._matchesFeature(U,Y))||x.remove(U)})}_setExpressionContentVM(x,I){const M=this.formattedAttributes,{contentElement:N,contentElementViewModel:Q}=x;x=N?.type;Q&&x&&("fields"===x&&(this._createFieldsFormattedAttributes({contentElement:N,contentElementIndex:I,formattedAttributes:M}),Q.set(this._createFieldsVMParams(N,I))),"media"===x&&(this._createMediaFormattedAttributes({contentElement:N,contentElementIndex:I,formattedAttributes:M}),Q.set(this._createMediaVMParams(N,I))),
"text"===x&&Q.set(this._createTextVMParams(N)))}_compileRelationship(x,I){const {displayCount:M,orderByFields:N,relationshipId:Q,title:T,description:U}=x,{_sourceLayer:Y,graphic:W,map:aa}=this;if(D.isRelatableFeatureSupportedLayer(Y)){var ca=new c({displayCount:M,graphic:W,orderByFields:N,relationshipId:Q,layer:Y,map:aa,...this._compileTitleAndDesc({title:T,description:U})});this.contentViewModels[I]=ca;this.addHandles(q.on(()=>ca.relatedFeatures,"change",()=>this._setRelatedFeaturesViewModels(ca)),
"relationship-view-models");return x}}_matchesGlobalFeature(x,I){x=x?.association.globalId;I=I?.association.globalId;return null!=x&&null!=I&&x===I}async _setUpUtilityNetworkAssociationsViewModels(x,I,M){const {view:N,spatialReference:Q,timeZone:T}=this;x.forEach((Y,W)=>{const aa=I.get(W);aa?Y.forEach(ca=>{aa.find(ea=>this._matchesGlobalFeature(ca,ea))||(Y.remove(ca),0===Y.length&&x.delete(W))}):(Y.removeAll(),x.delete(W))});I.forEach((Y,W)=>{const aa=x.get(W)||new p;Y?.filter(Boolean).forEach(ca=>
{aa.some(ea=>this._matchesGlobalFeature(ea,ca))||aa.add({association:ca.association,featureViewModel:new O({abilities:{utilityNetworkAssociationsContent:!1},map:M,view:N,spatialReference:Q,timeZone:T,graphic:ca.feature}),terminalName:ca.terminalName})});x.set(W,aa)});const U=new AbortController;this._associationVMAbortController=U;await this._sortListObjectsByTitle(x,{signal:U.signal});this._associationVMAbortController===U&&(this._associationVMAbortController=null)}async _sortListObjectsByTitle(x,
I){for(const M of x.values())x=M.map(N=>q.whenOnce(()=>"ready"===N.featureViewModel.state,I?.signal)),await Promise.all(x),M.sort(this._compareByFeatureTitle)}_compareByFeatureTitle(x,I){x=z.getFeaturePopupTitle(x.featureViewModel);I=z.getFeaturePopupTitle(I.featureViewModel);return x.localeCompare(I,void 0,{numeric:!0})}_compileUtilityNetworkAssociation(x,I){const {title:M,description:N,associationTypes:Q}=x,{_sourceLayer:T,graphic:U,map:Y}=this;if(D.isAssociatedFeatureSupportedLayer(T)){var W=new n({graphic:U,
associationTypes:Q,layer:T,map:Y,...this._compileTitleAndDesc({title:M,description:N})});this.contentViewModels[I]=W;this.addHandles([q.watch(()=>W.associationFeatures.values(),()=>this._setUpUtilityNetworkAssociationsViewModels(W.associationViewModels,W.associationFeatures,W.map))],"association-view-models");return x}}_compileExpression(x,I){const {expressionInfo:M}=x,{graphic:N,map:Q,spatialReference:T,view:U,location:Y}=this,W=new f({expressionInfo:M,graphic:N,interceptor:O.interceptor,map:Q,spatialReference:T,
view:U,location:Y});this.contentViewModels[I]=W;this.addHandles(q.watch(()=>W.contentElementViewModel,()=>this._setExpressionContentVM(W,I),q.initial),"content-view-models");return x}_compileAttachments(x,I){const {graphic:M}=this,{description:N,title:Q}=x;this.contentViewModels[I]=new u({graphic:M,...this._compileTitleAndDesc({title:Q,description:N})});return x}_compileCustom(x,I){const {graphic:M}=this,{creator:N,destroyer:Q}=x;this.contentViewModels[I]=new G({graphic:M,creator:N,destroyer:Q});
return x}_compileTitleAndDesc({title:x,description:I}){const {_fieldInfoMap:M,_sourceLayer:N,graphic:Q,formattedAttributes:T}=this,U=Q?.attributes,Y=this._expressionAttributes,W=T.global;return{title:D.substituteFieldsInLinksAndAttributes({attributes:U,fieldInfoMap:M,globalAttributes:W,expressionAttributes:Y,layer:N,text:x}),description:D.substituteFieldsInLinksAndAttributes({attributes:U,fieldInfoMap:M,globalAttributes:W,expressionAttributes:Y,layer:N,text:I})}}_createFieldsVMParams(x,I){const M=
this._effectivePopupTemplate,N=this.formattedAttributes,Q={...N?.global,...N?.content[I]};I=(x?.fieldInfos||M?.fieldInfos)?.filter(({fieldName:Y})=>!!Y&&(D.isExpressionField(Y)||D.isRelatedField(Y)||Q.hasOwnProperty(Y)));const {description:T,title:U}=x;return{attributes:Q,expressionInfos:M?.expressionInfos,fieldInfos:I,...this._compileTitleAndDesc({title:U,description:T})}}_compileFields(x,I){const M=x.clone();x=new g(this._createFieldsVMParams(x,I));this.contentViewModels[I]=x;M.fieldInfos=x.formattedFieldInfos.slice();
return M}_createMediaVMParams(x,I){const {abilities:M,graphic:N,_fieldInfoMap:Q,_effectivePopupTemplate:T,relatedInfos:U,_sourceLayer:Y,_expressionAttributes:W}=this,aa=this.formattedAttributes,ca=N?.attributes??{},{description:ea,mediaInfos:fa,title:ha}=x;return{abilities:{chartAnimation:M.chartAnimation},activeMediaInfoIndex:x.activeMediaInfoIndex||0,attributes:ca,isAggregate:N?.isAggregate,layer:Y,fieldInfoMap:Q,formattedAttributes:{...aa?.global,...aa?.content[I]},expressionAttributes:W,mediaInfos:fa,
popupTemplate:T,relatedInfos:U,...this._compileTitleAndDesc({title:ha,description:ea})}}_compileMedia(x,I){const M=x.clone();x=new b(this._createMediaVMParams(x,I));M.mediaInfos=x.formattedMediaInfos.slice();this.contentViewModels[I]=x;return M}_createTextVMParams(x){const {graphic:I,_fieldInfoMap:M,_sourceLayer:N,_expressionAttributes:Q}=this;x&&x.text&&(x.text=D.substituteFieldsInLinksAndAttributes({attributes:I?.attributes??{},fieldInfoMap:M,globalAttributes:this.formattedAttributes?.global??{},
expressionAttributes:Q,layer:N,text:x.text}));return{graphic:I,creator:x.text}}_compileText(x,I){x=x.clone();this.contentViewModels[I]=new G(this._createTextVMParams(x));return x}_compileLastEditInfo(){const {_effectivePopupTemplate:x,_sourceLayer:I,graphic:M,timeZone:N}=this;if(x){var {lastEditInfoEnabled:Q}=x,T=I?.editFieldsInfo;if(Q&&T)return D.formatEditInfo(T,M?.attributes,N,I)}}_compileTitle(x){const {_fieldInfoMap:I,_sourceLayer:M,graphic:N,_expressionAttributes:Q}=this;return D.substituteFieldsInLinksAndAttributes({attributes:N?.attributes??
{},fieldInfoMap:I,globalAttributes:this.formattedAttributes?.global??{},expressionAttributes:Q,layer:M,text:x})}async _getTitle(){const {_effectivePopupTemplate:x,graphic:I}=this;return I?D.graphicCallback({type:"title",value:x?.title,event:{graphic:I}}):null}async _getContent(){const {_effectivePopupTemplate:x,graphic:I}=this;return I?D.graphicCallback({type:"content",value:x?.content,event:{graphic:I}}):null}async _queryFeature(x){const {_featureAbortController:I,_sourceLayer:M,graphic:N,_effectivePopupTemplate:Q}=
this,T=this.map,U=this.view,Y=this.spatialReference,W=this.location;if(I===this._featureAbortController&&N){await D.queryUpdatedFeature({graphic:N,popupTemplate:Q,layer:M,spatialReference:Y},x);var {content:{value:aa},title:{value:ca}}=await v.eachAlways({content:this._getContent(),title:this._getTitle()});({expressionAttributes:{value:x}}=await v.eachAlways({checkForRelatedFeatures:this._checkForRelatedFeatures(x),expressionAttributes:y.createCompiledExpressions({expressionInfos:Q?.expressionInfos,
spatialReference:Y,graphic:N,map:T,interceptor:O.interceptor,view:U,options:x,location:W})}));I===this._featureAbortController&&N&&(this._expressionAttributes=x,this._graphicExpressionAttributes={...N.attributes,...x},this._set("formattedAttributes",this._createFormattedAttributes(aa)),this._set("title",this._compileTitle(ca)),this._set("lastEditInfo",this._compileLastEditInfo()||null),this._set("content",this._compileContent(aa)||null))}}_createMediaFormattedAttributes({contentElement:x,contentElementIndex:I,
formattedAttributes:M}){const {_effectivePopupTemplate:N,graphic:Q,relatedInfos:T,_sourceLayer:U,_fieldInfoMap:Y,_graphicExpressionAttributes:W,timeZone:aa}=this;M.content[I]=D.formatAttributes({fieldInfos:N?.fieldInfos,graphic:Q,attributes:{...W,...x.attributes},layer:U,fieldInfoMap:Y,relatedInfos:T,timeZone:aa})}_createFieldsFormattedAttributes({contentElement:x,contentElementIndex:I,formattedAttributes:M}){if(x.fieldInfos){const {graphic:N,relatedInfos:Q,_sourceLayer:T,_fieldInfoMap:U,_graphicExpressionAttributes:Y,
timeZone:W}=this;M.content[I]=D.formatAttributes({fieldInfos:x.fieldInfos,graphic:N,attributes:{...Y,...x.attributes},layer:T,fieldInfoMap:U,relatedInfos:Q,timeZone:W})}}_createFormattedAttributes(x){const {_effectivePopupTemplate:I,graphic:M,relatedInfos:N,_sourceLayer:Q,_fieldInfoMap:T,_graphicExpressionAttributes:U,timeZone:Y}=this,W={global:D.formatAttributes({fieldInfos:I?.fieldInfos,graphic:M,attributes:U,layer:Q,fieldInfoMap:T,relatedInfos:N,timeZone:Y}),content:[]};Array.isArray(x)&&x.forEach((aa,
ca)=>{"fields"===aa.type&&this._createFieldsFormattedAttributes({contentElement:aa,contentElementIndex:ca,formattedAttributes:W});"media"===aa.type&&this._createMediaFormattedAttributes({contentElement:aa,contentElementIndex:ca,formattedAttributes:W})});return W}_checkForRelatedFeatures(x){const {graphic:I,_effectivePopupTemplate:M}=this;return this._queryRelatedInfos(I,D.getAllFieldInfos(M),x)}async _queryRelatedInfos(x,I,M){const {relatedInfos:N,_sourceLayer:Q}=this;N.clear();const T=null!=Q?.associatedLayer?
await Q?.associatedLayer.load(M):Q;if(T&&x&&I.filter(W=>!!W.fieldName&&D.isRelatedField(W.fieldName))?.length){I.forEach(W=>this._configureRelatedInfo(W,T));var U=await B.queryLayerInfos({relatedInfos:N,layer:T},M);Object.keys(U).forEach(W=>{const aa=N.get(W.toString());W=U[W]?.value;aa&&W&&(aa.layerInfo=W.data)});var Y=await B.queryRelatedFeatures({graphic:x,relatedInfos:N,layer:T},M);Object.keys(Y).forEach(W=>{B.setRelatedFeatures(Y[W]?.value,N.get(W.toString()))})}}_configureRelatedInfo(x,I){const {relatedInfos:M}=
this,N=B.getRelatedFieldInfo(x.fieldName||"");if(N){var {layerId:Q,fieldName:T}=N;Q&&(I=M.get(Q.toString())||B.createRelatedInfo(Q,I))&&(B.updateRelatedInfo({relatedInfo:I,fieldName:T,fieldInfo:x}),this.relatedInfos.set(Q,I))}}};k.interceptor=new C.FeatureSetQueryInterceptor(D.preLayerQueryCallback,D.preRequestCallback);a.__decorate([m.property()],k.prototype,"_error",void 0);a.__decorate([m.property()],k.prototype,"_featureAbortController",void 0);a.__decorate([m.property()],k.prototype,"_associationVMAbortController",
void 0);a.__decorate([m.property({readOnly:!0})],k.prototype,"_effectivePopupTemplate",null);a.__decorate([m.property({readOnly:!0})],k.prototype,"_fieldInfoMap",null);a.__decorate([m.property({readOnly:!0})],k.prototype,"_sourceLayer",null);a.__decorate([m.property()],k.prototype,"abilities",void 0);a.__decorate([l.cast("abilities")],k.prototype,"castAbilities",null);a.__decorate([m.property({readOnly:!0})],k.prototype,"content",void 0);a.__decorate([m.property({readOnly:!0})],k.prototype,"contentViewModels",
void 0);a.__decorate([m.property()],k.prototype,"description",void 0);a.__decorate([m.property({type:Boolean})],k.prototype,"defaultPopupTemplateEnabled",void 0);a.__decorate([m.property({readOnly:!0})],k.prototype,"isTable",null);a.__decorate([m.property({readOnly:!0})],k.prototype,"state",null);a.__decorate([m.property({readOnly:!0})],k.prototype,"formattedAttributes",void 0);a.__decorate([m.property({type:d,value:null})],k.prototype,"graphic",null);a.__decorate([m.property({readOnly:!0})],k.prototype,
"lastEditInfo",void 0);a.__decorate([m.property({type:J})],k.prototype,"location",void 0);a.__decorate([m.property({readOnly:!0})],k.prototype,"relatedInfos",void 0);a.__decorate([m.property()],k.prototype,"spatialReference",null);a.__decorate([m.property()],k.prototype,"timeZone",null);a.__decorate([m.property({readOnly:!0})],k.prototype,"title",void 0);a.__decorate([m.property()],k.prototype,"map",null);a.__decorate([m.property({readOnly:!0})],k.prototype,"waitingForContent",null);a.__decorate([m.property()],
k.prototype,"view",void 0);return k=O=a.__decorate([r.subclass("esri.widgets.Feature.FeatureViewModel")],k)})},"esri/arcade/featureset/support/FeatureSetQueryInterceptor":function(){define(["exports"],function(a){class k{constructor(d,C){this.preLayerQueryCallback=d;this.preRequestCallback=C;this.preLayerQueryCallback||(this.preLayerQueryCallback=H=>{});this.preRequestCallback||(this.preLayerQueryCallback=H=>{})}}a.FeatureSetQueryInterceptor=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/widgets/Feature/resources":function(){define(["exports"],function(a){a.css={base:"esri-feature",container:"esri-feature__size-container",title:"esri-feature__title",main:"esri-feature__main-container",btn:"esri-feature__button",icon:"esri-feature__icon",content:"esri-feature__content",contentNode:"esri-feature__content-node",contentNodeText:"esri-feature__content-node--text",contentElement:"esri-feature__content-element",text:"esri-feature__text",lastEditedInfo:"esri-feature__last-edited-info",
fields:"esri-feature__fields",fieldHeader:"esri-feature__field-header",fieldData:"esri-feature__field-data",fieldDataDate:"esri-feature__field-data--date",loadingSpinnerContainer:"esri-feature__loading-container"};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/Feature/support/FeatureContentMixin":function(){define("exports ../../../chunks/tslib.es6 ../../../core/Logger ../../../core/has ../../../core/RandomLCG ../../../core/Error ../../../core/accessorSupport/decorators/subclass ../resources ../../support/widget ../../support/jsxFactory".split(" "),
function(a,k,d,C,H,E,p,F,K,v){a.FeatureContentMixin=q=>{q=class extends q{constructor(){super(...arguments);this.renderNodeContent=e=>K.isWidget(e)&&!e.destroyed?v.tsx("div",{class:F.css.contentNode,key:e},e.render()):e instanceof HTMLElement?v.tsx("div",{afterCreate:this._attachToNode,bind:e,class:F.css.contentNode,key:e}):K.hasDomNode(e)?v.tsx("div",{afterCreate:this._attachToNode,bind:e.domNode,class:F.css.contentNode,key:e}):null}_attachToNode(e){e.appendChild(this)}};return q=k.__decorate([p.subclass("esri.widgets.Feature.support.FeatureContentMixin")],
q)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"*noref":1}});
define("require ../chunks/tslib.es6 ../intl ../core/reactiveUtils ../core/accessorSupport/decorators/property ../core/accessorSupport/decorators/cast ../core/RandomLCG ../core/has ../core/accessorSupport/decorators/subclass ./Widget ./Feature/FeatureAttachments ./Feature/FeatureContent ./Feature/FeatureExpression ./Feature/FeatureFields ./Feature/FeatureMedia ./Feature/FeatureRelationship ./Feature/FeatureUtilityNetworkAssociations ./Feature/FeatureViewModel ./Feature/resources ./Feature/support/FeatureContentMixin ../chunks/componentsUtils ./support/globalCss ./support/Heading ./support/widgetUtils ./support/decorators/messageBundle ./support/jsxFactory ../intl/substitute".split(" "),function(a,
k,d,C,H,E,p,F,K,v,q,e,m,l,h,r,t,z,w,u,G,f,g,b,c,n,y){const D={title:!0,content:!0,lastEditedInfo:!0};d=class extends u.FeatureContentMixin(v){constructor(B,J){super(B,J);this._contentWidgets=[];this.flowType="feature";this.flowItems=null;this.headingLevel=2;this.messagesCommon=this.messages=null;this.visibleElements={...D};this.viewModel=new z}initialize(){this.addHandles(C.watch(()=>this.viewModel?.contentViewModels,()=>this._setupContentWidgets(),C.initial))}loadDependencies(){return G.loadCalciteComponents({notice:()=>
new Promise((B,J)=>a(["../chunks/calcite-notice"],B,J)),loader:()=>new Promise((B,J)=>a(["../chunks/calcite-loader"],B,J))})}destroy(){this._destroyContentWidgets()}get graphic(){return this.viewModel.graphic}set graphic(B){this.viewModel.graphic=B}get defaultPopupTemplateEnabled(){return this.viewModel.defaultPopupTemplateEnabled}set defaultPopupTemplateEnabled(B){this.viewModel.defaultPopupTemplateEnabled=B}get isTable(){return this.viewModel.isTable}get icon(){return"polygon"}set icon(B){this._overrideIfSome("icon",
B)}get label(){return this.messages?.widgetLabel??""}set label(B){this._overrideIfSome("label",B)}get location(){return this.viewModel.location}set location(B){this.viewModel.location=B}get spatialReference(){return this.viewModel.spatialReference}set spatialReference(B){this.viewModel.spatialReference=B}get timeZone(){return this.viewModel.timeZone}set timeZone(B){this.viewModel.timeZone=B}get title(){return this.viewModel.title}castVisibleElements(B){return{...D,...B}}get map(){return this.viewModel.map}set map(B){this.viewModel.map=
B}get view(){return this.viewModel.view}set view(B){this.viewModel.view=B}setActiveMedia(B,J){return this.viewModel.setActiveMedia(B,J)}nextMedia(B){return this.viewModel.nextMedia(B)}previousMedia(B){return this.viewModel.previousMedia(B)}render(){var {state:B}=this.viewModel;B=n.tsx("div",{class:w.css.container,key:"container"},this._renderTitle(),"error"===B?this._renderError():"loading"===B?this._renderLoading():this._renderContentContainer());return n.tsx("div",{class:this.classes(w.css.base,
f.globalCss.widget)},B)}_renderError(){const {messagesCommon:B,messages:J,visibleElements:O}=this;return n.tsx("calcite-notice",{icon:"exclamation-mark-circle",kind:"danger",open:!0,scale:"s"},O.title?n.tsx("div",{key:"error-title",slot:"title"},B.errorMessage):null,n.tsx("div",{key:"error-message",slot:"message"},J.loadingError))}_renderLoading(){return n.tsx("div",{class:w.css.loadingSpinnerContainer,key:"loading-container"},n.tsx("calcite-loader",{inline:!0,label:""}))}_renderContentContainer(){const {visibleElements:B}=
this;return B.content?n.tsx("div",{class:w.css.main},[this._renderContent(),this._renderLastEditInfo()]):null}_renderTitle(){const {visibleElements:B,title:J}=this;return B.title?n.tsx(g.Heading,{class:w.css.title,innerHTML:J,level:this.headingLevel}):null}_renderContent(){var B=this.viewModel.content;return B?Array.isArray(B)?B.length?n.tsx("div",{class:w.css.contentNode,key:"content-content-elements"},B.map(this._renderContentElement,this)):null:"string"===typeof B?(B=this._contentWidgets[0],!B||
B.destroyed?null:n.tsx("div",{class:this.classes(w.css.contentNode,w.css.contentNodeText),key:"content-content"},B.render())):this.renderNodeContent(B):null}_renderContentElement(B,J){const {visibleElements:O}=this;if("boolean"!==typeof O.content&&!O.content?.[B.type])return null;switch(B.type){case "attachments":return this._renderAttachments(J);case "custom":return this._renderCustom(B,J);case "fields":return this._renderFields(J);case "media":return this._renderMedia(J);case "text":return this._renderText(B,
J);case "expression":return this._renderExpression(J);case "relationship":return this._renderRelationship(J);case "utility-network-associations":return this._renderAssociation(J);default:return null}}_renderAttachments(B){const J=this._contentWidgets[B];if(!J||J.destroyed)return null;const {state:O,attachmentInfos:S}=J.viewModel;return"loading"===O||0<S.length?n.tsx("div",{class:this.classes(w.css.contentElement),key:this._buildKey("attachments-element",B)},J.render()):null}_renderRelationship(B){const J=
this._contentWidgets[B];return J&&!J.destroyed&&this.flowItems?n.tsx("div",{class:w.css.contentElement,key:this._buildKey("relationship-element",B)},J.render()):null}_renderAssociation(B){const J=this._contentWidgets[B];return J&&!J.destroyed&&this.flowItems?n.tsx("div",{class:w.css.contentElement,key:this._buildKey("utility-network-association-element",B)},J.render()):null}_renderExpression(B){const J=this._contentWidgets[B];return J&&!J.destroyed&&J.viewModel.contentElement?n.tsx("div",{class:w.css.contentElement,
key:this._buildKey("expression-element",B)},J.render()):null}_renderCustom(B,J){({creator:B}=B);const O=this._contentWidgets[J];return!O||O.destroyed?null:B?n.tsx("div",{class:w.css.contentElement,key:this._buildKey("custom-element",J)},O.render()):null}_renderFields(B){const J=this._contentWidgets[B];return!J||J.destroyed?null:n.tsx("div",{class:w.css.contentElement,key:this._buildKey("fields-element",B)},J.render())}_renderMedia(B){const J=this._contentWidgets[B];return!J||J.destroyed?null:n.tsx("div",
{class:w.css.contentElement,key:this._buildKey("media-element",B)},J.render())}_renderLastEditInfo(){const {visibleElements:B,messages:J}=this;var {lastEditInfo:O}=this.viewModel;if(!O||!B.lastEditedInfo)return null;const {date:S,user:x}=O;O=y.substitute("edit"===O.type?x?J.lastEditedByUser:J.lastEdited:x?J.lastCreatedByUser:J.lastCreated,{date:S,user:x});return n.tsx("div",{class:this.classes(w.css.lastEditedInfo,w.css.contentElement),key:"edit-info-element"},O)}_renderText(B,J){const O=this._contentWidgets[J];
return!O||O.destroyed?null:B.text?n.tsx("div",{class:this.classes(w.css.contentElement,w.css.text),key:this._buildKey("text-element",J)},O.render()):null}_buildKey(B,...J){const O=this.viewModel?.graphic?.uid||"0";J=J.join("-");return`${B}__${O}-${J}`}_destroyContentWidget(B){B&&(B.viewModel=null,!B.destroyed&&B.destroy())}_destroyContentWidgets(){this._contentWidgets.forEach(B=>this._destroyContentWidget(B));this._contentWidgets=[]}_setupContentWidgets(){this._destroyContentWidgets();const {headingLevel:B,
visibleElements:J,flowItems:O,viewModel:S}=this;var x=S?.content;const {contentViewModels:I}=S;Array.isArray(x)?x.forEach((M,N)=>{"attachments"===M.type&&(this._contentWidgets[N]=new q({displayType:M.displayType,headingLevel:J.title&&6>B?B+1:B,viewModel:I[N]}));"fields"===M.type&&(this._contentWidgets[N]=new l({viewModel:I[N]}));"media"===M.type&&(this._contentWidgets[N]=new h({viewModel:I[N]}));"text"===M.type&&(this._contentWidgets[N]=new e({viewModel:I[N]}));"custom"===M.type&&(this._contentWidgets[N]=
new e({viewModel:I[N]}));"expression"===M.type&&(this._contentWidgets[N]=new m({viewModel:I[N]}));if("relationship"===M.type){const Q=new r({flowItems:O,featureVisibleElements:J,viewModel:I[N]});this._contentWidgets[N]=Q}"utility-network-associations"===M.type&&(M=new t({flowItems:O,parentFeatureViewModel:S,featureVisibleElements:J,viewModel:I[N]}),this._contentWidgets[N]=M)},this):(x=I[0])&&!x.destroyed&&(this._contentWidgets[0]=new e({viewModel:x}));this.scheduleRender()}};k.__decorate([H.property()],
d.prototype,"flowType",void 0);k.__decorate([H.property()],d.prototype,"graphic",null);k.__decorate([H.property()],d.prototype,"defaultPopupTemplateEnabled",null);k.__decorate([H.property()],d.prototype,"flowItems",void 0);k.__decorate([H.property()],d.prototype,"headingLevel",void 0);k.__decorate([H.property({readOnly:!0})],d.prototype,"isTable",null);k.__decorate([H.property()],d.prototype,"icon",null);k.__decorate([H.property()],d.prototype,"label",null);k.__decorate([H.property()],d.prototype,
"location",null);k.__decorate([H.property(),c.messageBundle("esri/widgets/Feature/t9n/Feature")],d.prototype,"messages",void 0);k.__decorate([H.property(),c.messageBundle("esri/t9n/common")],d.prototype,"messagesCommon",void 0);k.__decorate([H.property()],d.prototype,"spatialReference",null);k.__decorate([H.property()],d.prototype,"timeZone",null);k.__decorate([H.property({readOnly:!0})],d.prototype,"title",null);k.__decorate([H.property()],d.prototype,"visibleElements",void 0);k.__decorate([E.cast("visibleElements")],
d.prototype,"castVisibleElements",null);k.__decorate([H.property()],d.prototype,"map",null);k.__decorate([H.property()],d.prototype,"view",null);k.__decorate([H.property({type:z})],d.prototype,"viewModel",void 0);return d=k.__decorate([K.subclass("esri.widgets.Feature")],d)});