// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.31/esri/copyright.txt for details.
//>>built
define("../../chunks/tslib.es6 ../../kernel ../../core/Error ../../core/JSONSupport ../../core/MD5 ../../core/promiseUtils ../../core/accessorSupport/decorators/property ../../core/has ../../core/Logger ../../core/RandomLCG ../../core/accessorSupport/decorators/enumeration ../../core/accessorSupport/decorators/subclass ../../portal/PortalItem ../../rest/support/fileFormat ../../rest/support/layoutTemplate ./utils".split(" "),function(b,k,m,a,n,p,d,A,B,C,q,r,t,u,v,w){a=class extends a.JSONSupport{constructor(f){super(f);
this.format=this.description=null;this.state="not-loaded";this.type=this.layoutTemplateInfo=this.layoutOptions=this.layoutItem=this.layout=this.layoutInfoTaskUrl=this.label=null}get id(){return this.layoutItem?.id??`${this.layout}-${n.createMD5Hash(JSON.stringify(this.toJSON()))}`}get mapSurroundInfoOptions(){const f=this.layoutTemplateInfo?.layoutOptions?.mapSurroundInfos;if(!f)return null;const e={northArrow:[],scaleBar:[],legend:[]};for(const c of f)switch(c.type){case "CIMMarkerNorthArrow":e.northArrow.push(c);
break;case "CIMScaleLine":e.scaleBar.push(c);break;case "CIMGroupElement":c.elements?.some(g=>"CIMScaleLine"===g.type)&&e.scaleBar.push(c);break;case "CIMLegend":e.legend.push(c)}return e}async fetchLayoutItemTemplateInfo(f){const {layoutItem:e}=this;if(e?.id&&!this.layoutTemplateInfo&&"loaded"!==this.state)try{this._set("state","loading");const c=this.layoutInfoTaskUrl;if(!c)throw new m("print:invalid-layout-info-task-url","Can't fetch layout template info",{url:c});"public"!==e.access&&k.id&&await k.id.getCredential(c);
const g={Layout_Item_ID:JSON.stringify({id:e.id})},l=(await w.fetchLayoutTemplateInfos(c,g,f))[0];this._set("layoutTemplateInfo",l);const {hasLegend:x}=l.layoutOptions,y=this.mapSurroundInfoOptions?.northArrow.some(({visible:h})=>h)??!1,z=this.mapSurroundInfoOptions?.scaleBar.some(({visible:h})=>h)??!1;this._set("layoutOptions",{legend:x,northArrow:y,scaleBar:z});this._set("state","loaded")}catch(c){this._set("state",p.isAbortError(c)?"not-loaded":"error")}}setLayoutTemplateInfo(f){this._set("layoutTemplateInfo",
f);this._set("state","loaded")}};b.__decorate([d.property({json:{write:!0}})],a.prototype,"description",void 0);b.__decorate([q.enumeration(u.formatJsonMap)],a.prototype,"format",void 0);b.__decorate([d.property({readOnly:!0})],a.prototype,"id",null);b.__decorate([d.property({readOnly:!0})],a.prototype,"state",void 0);b.__decorate([d.property({json:{write:!0}})],a.prototype,"label",void 0);b.__decorate([d.property()],a.prototype,"layoutInfoTaskUrl",void 0);b.__decorate([d.property({json:{read:v.fromJSON,
write:!0}})],a.prototype,"layout",void 0);b.__decorate([d.property({type:t,json:{write:!0}})],a.prototype,"layoutItem",void 0);b.__decorate([d.property({readOnly:!0,json:{write:!0}})],a.prototype,"layoutOptions",void 0);b.__decorate([d.property({readOnly:!0})],a.prototype,"layoutTemplateInfo",void 0);b.__decorate([d.property({readOnly:!0})],a.prototype,"mapSurroundInfoOptions",null);b.__decorate([d.property()],a.prototype,"type",void 0);return a=b.__decorate([r.subclass("esri.widgets.Print.CustomTemplate")],
a)});