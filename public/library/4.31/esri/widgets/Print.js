// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.31/esri/copyright.txt for details.
//>>built
define("require ../chunks/tslib.es6 ../geometry ../intl ../core/Collection ../core/jsonMap ../core/reactiveUtils ../core/unitFormatUtils ../core/urlUtils ../core/accessorSupport/decorators/property ../core/accessorSupport/ensureType ../core/RandomLCG ../core/has ../core/accessorSupport/decorators/subclass ../geometry/support/spatialReferenceUtils ../portal/support/urlUtils ../rest/utils ../rest/support/fileFormat ./Widget ./Print/FileLink ./Print/PrintViewModel ../chunks/componentsUtils ./support/globalCss ./support/Heading ./support/legacyIcon ./support/widgetUtils ./support/decorators/messageBundle ./support/jsxFactory ../geometry/SpatialReference ../intl/number".split(" "),
function(q,k,h,qa,V,W,C,X,M,m,Y,ra,sa,Z,aa,ba,ca,da,ea,N,O,fa,I,ha,ia,P,J,b,Q,R){function ja(a){const {state:c,extension:e}=a;switch(c){case "pending":return"spinner";case "error":return"exclamation-mark-circle";default:return e?.toLowerCase()?.includes("pdf")?"file-pdf":"file"}}const S=V.ofType(N);var f;(function(a){a.layout="layoutTab";a.mapOnly="mapOnlyTab";a["export"]="exportTab"})(f||={});const ka=new W.JSONMap({inch:"inches",foot:"feet",yard:"yards",mile:"miles","nautical-mile":"nautical-miles",
millimeter:"millimeters",centimeter:"centimeters",decimeter:"decimeters",meter:"meters",kilometer:"kilometers"}),T=new Map([["a3-landscape","a3-landscape"],["a3-portrait","a3-portrait"],["a4-landscape","a4-landscape"],["a4-portrait","a4-portrait"],["letter-ansi-a-landscape","ansi-a-landscape"],["letter-ansi-a-portrait","ansi-a-portrait"],["tabloid-ansi-b-landscape","ansi-b-landscape"],["tabloid-ansi-b-portrait","ansi-b-portrait"]]);h=class extends ea{constructor(a,c){super(a,c);this._awaitingServerResponse=
this._activeTabFocusRequested=!1;this._exportedFileNameMap={};this._selectedTab=f.layout;this._pendingExportScroll=!1;this._selectedTemplate=this._rootNode=null;this._formats=[];this._showTemplates=!1;this._isValidSpatialReference=!0;this.browseTemplateButtonOnClick=this.allowedFormatsForSaving=null;this.exportedLinks=new S;this.headerVisible=!0;this.headingLevel=3;this.messagesUnits=this.messagesCommon=null;this.saveExportEnabled=!1;this.saveExportHidden=!0;this.saveAsButtonCallback=null;this.viewModel=
new O;this._onInput=e=>{this._selectedTab===f.layout?this.templateOptions.title=e.target.value:this._selectedTab===f.mapOnly&&(this.templateOptions.fileName=e.target.value)};this._handleLinkClick=e=>{const d=e.currentTarget["data-item"];if(d&&"ready"===d.state&&d.url){var g=ca.getToken(this.viewModel.effectivePrintServiceUrl),p=d.url,l=document.createElement("a");l.target="_blank";l.href=p;l.rel="noreferrer";l.download=d.formattedName??"";g?(e.preventDefault(),e=new URL(p),e.searchParams.set("token",
g),l.href=e.href,l.click(),l.href=p):(l.click(),e.stopPropagation())}};this._focusOnTabChange=this._focusOnTabChange.bind(this)}initialize(){this.addHandles([C.watch(()=>[this.templateOptions.format,this.viewModel.templatesInfo?.format],()=>{const {templatesInfo:d}=this.viewModel;if(d){if(this._formats.length!==d.format.choiceList.length){const p=da.formatJsonMap.apiValues;this._formats=d.format.choiceList.map(l=>{const n=p.find(t=>(new RegExp(`\\b${t}\\b`,"i")).test(l))??l;return{value:n,label:l===
n?l.toUpperCase():l}}).sort((l,n)=>l.label.localeCompare(n.label))}var g=this._formats.some(({value:p})=>(new RegExp(`\\b${p}\\b`,"i")).test(this.templateOptions.format));d.format.defaultValue&&!g&&(g=this._formats.find(({value:p})=>(new RegExp(`\\b${p}\\b`,"i")).test(d.format.defaultValue))?.value)&&(this.templateOptions.format=g)}}),C.watch(()=>[this.templateOptions.id,this.viewModel.loaded],async()=>{const {layout:d}=this.templateOptions;this._selectedTab="map-only"===d?.toLowerCase()?f.mapOnly:
f.layout;this._selectedTab===f.layout&&this.viewModel.loaded&&(this._selectedTemplate=this.viewModel.getLayoutTemplateById(this.templateOptions.id))}),C.watch(()=>this.templateOptions.dpi,d=>{0>=d&&(this.templateOptions.dpi=1)}),C.watch(()=>this.viewModel.view?.scale,d=>{!d||this.templateOptions.scaleEnabled&&this.templateOptions.scale||(this.templateOptions.scale=d)})]);for(const {name:d,extension:g}of this.exportedLinks)d&&g&&this._updateExportedFileNameMap(`${d}${g}`);const {height:a,width:c}=
this.templateOptions;this.templateOptions.width=c||800;this.templateOptions.height=a||1100;const e=setTimeout(()=>{this._awaitingServerResponse=!0;this.scheduleRender()},500);this.viewModel.load().then(()=>{clearTimeout(e);this._awaitingServerResponse=!1})}loadDependencies(){return fa.loadCalciteComponents({action:()=>new Promise((a,c)=>q(["../chunks/calcite-action"],a,c)),block:()=>new Promise((a,c)=>q(["../chunks/calcite-block"],a,c)),button:()=>new Promise((a,c)=>q(["../chunks/calcite-button"],
a,c)),checkbox:()=>new Promise((a,c)=>q(["../chunks/calcite-checkbox"],a,c)),combobox:()=>new Promise((a,c)=>q(["../chunks/calcite-combobox"],a,c)),"combobox-item":()=>new Promise((a,c)=>q(["../chunks/calcite-combobox-item"],a,c)),flow:()=>new Promise((a,c)=>q(["../chunks/calcite-flow"],a,c)),"flow-item":()=>new Promise((a,c)=>q(["../chunks/calcite-flow-item"],a,c)),icon:()=>new Promise((a,c)=>q(["../chunks/calcite-icon"],a,c)),input:()=>new Promise((a,c)=>q(["../chunks/calcite-input"],a,c)),"input-number":()=>
new Promise((a,c)=>q(["../chunks/calcite-input-number"],a,c)),label:()=>new Promise((a,c)=>q(["../chunks/calcite-label"],a,c)),list:()=>new Promise((a,c)=>q(["../chunks/calcite-list"],a,c)),"list-item":()=>new Promise((a,c)=>q(["../chunks/calcite-list-item"],a,c)),loader:()=>new Promise((a,c)=>q(["../chunks/calcite-loader"],a,c)),switch:()=>new Promise((a,c)=>q(["../chunks/calcite-switch"],a,c)),chip:()=>new Promise((a,c)=>q(["../chunks/calcite-chip"],a,c)),popover:()=>new Promise((a,c)=>q(["../chunks/calcite-popover"],
a,c)),link:()=>new Promise((a,c)=>q(["../chunks/calcite-link"],a,c))})}destroy(){this.viewModel.destroy()}get allowedFormats(){return this.viewModel.allowedFormats}set allowedFormats(a){this.viewModel.allowedFormats=a}get allowedLayouts(){return this.viewModel.allowedLayouts}set allowedLayouts(a){this.viewModel.allowedLayouts=a}get error(){return this.viewModel.error}get extraParameters(){return this.viewModel.extraParameters}set extraParameters(a){this.viewModel.extraParameters=a}get icon(){return"print"}set icon(a){this._overrideIfSome("icon",
a)}get includeDefaultTemplates(){return this.viewModel.includeDefaultTemplates}set includeDefaultTemplates(a){this.viewModel.includeDefaultTemplates=a}get label(){return this.messages?.widgetLabel??""}set label(a){this._overrideIfSome("label",a)}get outSpatialReference(){return this.viewModel.outSpatialReference}set outSpatialReference(a){this.viewModel.outSpatialReference=a}get portal(){return this.viewModel.portal}set portal(a){this.viewModel.portal=a}get showPrintAreaEnabled(){return this.viewModel.showPrintAreaEnabled}set showPrintAreaEnabled(a){this.viewModel.showPrintAreaEnabled=
a}get printServiceUrl(){return this.viewModel.printServiceUrl}set printServiceUrl(a){this.viewModel.printServiceUrl=a}get templateCustomTextElements(){return this.viewModel.templateCustomTextElements}set templateCustomTextElements(a){this.viewModel.templateCustomTextElements=a}get templateOptions(){return this.viewModel.templateOptions}set templateOptions(a){this.viewModel.templateOptions=a}get view(){return this.viewModel.view}set view(a){this.viewModel.view=a}render(){const {messages:a,templateOptions:c,
viewModel:e,view:d}=this,{attributionEnabled:g,author:p,copyright:l,dpi:n,format:t,height:z,layout:A,layoutItem:u,legendEnabled:w,northArrowEnabled:x,scaleBarEnabled:B,scaleEnabled:K,scale:U,width:la}=c;var D="ready"!==e.state||this._awaitingServerResponse||!(A||u),v=this._renderTitleOrFileNameSection(),E=b.tsx("div",{class:"esri-print__form-section-container"},b.tsx("calcite-label",null,a.fileFormatTitle,b.tsx("calcite-combobox",{clearDisabled:!0,label:a.formatDefaultOption,maxItems:6,placeholder:a.formatDefaultOption,
selectionMode:"single-persist",onCalciteComboboxChange:({target:r})=>{this.templateOptions.format=r.selectedItems[0]?.value??"pdf"}},this._formats.map(({value:r,label:ma},na)=>b.tsx("calcite-combobox-item",{key:`file-format-${na}`,selected:r===this.templateOptions.format,textLabel:ma,value:r}))))),F=b.tsx("calcite-label",{layout:"inline"},b.tsx("calcite-switch",{checked:this.showPrintAreaEnabled,onCalciteSwitchChange:r=>{this.showPrintAreaEnabled=!!r.target.checked}}),a.printPreview),L=b.tsx("div",
null,b.tsx("div",{class:"esri-print__form-section-container"},b.tsx("calcite-label",null,a.template,b.tsx("calcite-block",{class:"esri-print__template-select-container",collapsible:!1,description:this._getPageSizeLabel(this._selectedTemplate),heading:this._getTemplateLabel(this._selectedTemplate,!0),key:"template-select-block",loading:"loading"===this._selectedTemplate?.state,onclick:()=>{this._showTemplates=!0}},b.tsx("calcite-icon",{class:"esri-print__template-select-icon",icon:(this._selectedTemplate?.layout?
T.get(this._selectedTemplate.layout):null)||"custom-print",key:"template-select-icon",scale:"l",slot:"content-start"}),"error"===this._selectedTemplate?.state?b.tsx("calcite-icon",{class:"esri-print__template-select-error",icon:"exclamation-mark-circle",key:"template-select-error",scale:"s",slot:"actions-end"}):null,b.tsx("calcite-icon",{class:"esri-print__template-select-arrow",icon:P.isRTL()?"chevron-left":"chevron-right",key:"template-select-arrow",scale:"s",slot:"actions-end"})))),F),y=b.tsx("div",
{class:"esri-print__form-section-container"},b.tsx("calcite-label",null,a.dpi,b.tsx("calcite-input-number",{bind:this,"data-input-name":"dpi",min:1,value:`${n}`,onCalciteInputNumberInput:this._handleDPIChange}))),G=b.tsx("div",{class:"esri-print__form-section-container"},b.tsx("calcite-label",null,b.tsx("div",{class:"esri-print__sr-label"},a.outSpatialReference,b.tsx("calcite-link",{href:"https://developers.arcgis.com/rest/services-reference/enterprise/using-spatial-references/",target:"_blank"},
"(WKID)")),b.tsx("calcite-input-number",{bind:this,"data-input-name":"outSpatialReference",integer:!0,numberButtonType:"none",value:e.outSpatialReference?.wkid?.toString()??"",onCalciteInputNumberInput:({target:r})=>{r=Y.ensureInteger(r.value);e.outSpatialReference=Number.isNaN(r)||null==r?null:new Q({wkid:r});this._isValidSpatialReference=!e.outSpatialReference||aa.isValid(e.outSpatialReference)}}),this._isValidSpatialReference?null:b.tsx("div",{class:"esri-print__invalid-wkid-text",key:`out-sr-${e.outSpatialReference?.wkid}`},
a.invalidWkid))),H=b.tsx("div",{class:this.classes("esri-print__scale-info-container","esri-print__form-section-container")},b.tsx("calcite-label",{layout:"inline"},b.tsx("calcite-checkbox",{bind:this,checked:K,"data-option-name":"scaleEnabled",onCalciteCheckboxChange:this._toggleInputValue}),a.scale),b.tsx("div",{class:"esri-print__scale-input-container"},b.tsx("calcite-input-number",{"aria-label":a.scaleLabel,"aria-valuenow":`${U}`,bind:this,class:"esri-print__scale-input","data-input-name":"scale",
disabled:!K,value:`${U}`,onCalciteInputNumberInput:this._updateNumberInputValue}),b.tsx("calcite-button",{appearance:"outline","aria-label":a.reset,bind:this,disabled:!K,iconStart:"refresh",kind:"neutral",onclick:this._resetToCurrentScale})));const oa=b.tsx("div",{"aria-labelledby":`${this.id}__advancedOptionsForLayout`,class:"esri-print__advanced-options-container",key:"advanced-section-for-layout"},H,this._selectedTemplate?.layoutTemplateInfo?.layoutOptions?.hasAuthorText??!0?b.tsx("div",{class:"esri-print__form-section-container",
key:"author-info"},b.tsx("calcite-label",null,a.author,b.tsx("calcite-input",{bind:this,"data-input-name":"author",value:p??"",onCalciteInputInput:this._updateInputValue}))):null,this._selectedTemplate?.layoutTemplateInfo?.layoutOptions?.hasCopyrightText??!0?b.tsx("div",{class:"esri-print__form-section-container",key:"copyright-text"},b.tsx("calcite-label",null,a.copyright,b.tsx("calcite-input",{bind:this,"data-input-name":"copyright",value:l??"",onCalciteInputInput:this._updateInputValue}))):null,
y,G,this._renderCustomTextElementSection(),this._selectedTemplate?.layoutTemplateInfo?.layoutOptions?.hasLegend??!0?b.tsx("div",{class:"esri-print__form-section-container",key:"legend-info"},b.tsx("calcite-label",{layout:"inline"},b.tsx("calcite-checkbox",{bind:this,checked:w,"data-option-name":"legendEnabled",onCalciteCheckboxChange:this._toggleInputValue}),a.legend)):null,this._selectedTemplate?.mapSurroundInfoOptions?.northArrow.length?b.tsx("div",{class:"esri-print__form-section-container",key:"north-arrow"},
b.tsx("calcite-label",{layout:"inline"},b.tsx("calcite-checkbox",{bind:this,checked:x,"data-option-name":"northArrowEnabled",onCalciteCheckboxChange:this._toggleInputValue}),a.northArrow)):null,this._selectedTemplate?.mapSurroundInfoOptions?.scaleBar.length?b.tsx("div",{class:"esri-print__form-section-container",key:"scale-bar"},b.tsx("calcite-label",{layout:"inline"},b.tsx("calcite-checkbox",{bind:this,checked:B,"data-option-name":"scaleBarEnabled",onCalciteCheckboxChange:this._toggleInputValue}),
a.scaleBar)):null);G=b.tsx("div",{"aria-labelledby":`${this.id}__advancedOptionsForMapOnly`,class:"esri-print__advanced-options-container"},H,y,G,b.tsx("div",{class:"esri-print__form-section-container"},b.tsx("calcite-label",{layout:"inline"},b.tsx("calcite-checkbox",{bind:this,checked:g,"data-option-name":"attributionEnabled",onCalciteCheckboxChange:this._toggleInputValue}),a.attribution)),this._renderCustomTextElementSection());y=this.exportedLinks.toArray();H=this._renderExportedLink(y);const pa=
{["esri-print__export-section--centered"]:!y.length};F=this._selectedTab===f.layout?b.tsx("section",{"aria-labelledby":`${this.id}__layoutTab`,class:"esri-print__layout-section",id:`${this.id}__layoutContent`,key:"esri-print__layoutContent",role:"tabpanel"},b.tsx("div",{class:"esri-print__panel-container"},this._selectedTemplate?.layoutTemplateInfo?.layoutOptions?.hasTitleText??!0?v:null,L,this._selectedTab===f.layout?E:null,b.tsx("calcite-block",{"aria-label":a.advancedOptions,class:this.classes("esri-print__panel-container",
"esri-print__advanced-options-section"),collapsible:!0,disabled:!(A||u?.id),heading:a.advancedOptions,id:"advancedOptionsForLayout",key:"advanced-options-for-layout"},oa))):this._selectedTab===f.mapOnly?b.tsx("section",{"aria-labelledby":`${this.id}__mapOnlyTab`,class:"esri-print__map-only-section",id:`${this.id}__mapOnlyContent`,key:"esri-print__mapOnlyContent",role:"tabpanel"},b.tsx("div",{class:"esri-print__panel-container"},v,E,b.tsx("div",null,b.tsx("div",{class:this.classes("esri-print__size-container",
"esri-print__form-section-container")},b.tsx("calcite-label",null,a.width,b.tsx("calcite-input-number",{bind:this,"data-input-name":"width",value:`${la}`,onCalciteInputNumberInput:this._updateNumberInputValue})),b.tsx("calcite-label",null,a.height,b.tsx("calcite-input-number",{bind:this,"data-input-name":"height",value:`${z}`,onCalciteInputNumberInput:this._updateNumberInputValue})),b.tsx("button",{"aria-label":a.swap,bind:this,class:this.classes(I.globalCss.widgetButton,"esri-print__swap-button",
ia.legacyIcon.swap),onclick:this._switchInput,type:"button"})),F),b.tsx("calcite-block",{"aria-label":a.advancedOptions,class:this.classes("esri-print__panel-container","esri-print__advanced-options-section"),collapsible:!0,heading:a.advancedOptions,id:"advancedOptionsForMapOnly",key:"advanced-options-for-map-only"},G))):b.tsx("section",{"aria-labelledby":`${this.id}__exportTab`,class:this.classes("esri-print__export-section",pa),id:`${this.id}__exportContent`,key:"esri-print__exportContent",role:"tabpanel"},
b.tsx("div",{class:"esri-print__panel-container"},b.tsx("div",{afterUpdate:this._scrollExportIntoView,bind:this,class:"esri-print__export-panel-container"},0===y.length?b.tsx("div",{class:"esri-print__exported-files-empty"},b.tsx("calcite-icon",{icon:"file",scale:"l"}),b.tsx("div",null,b.tsx(ha.Heading,{class:"esri-print__export-title",level:this.headingLevel},a.noExportedFiles),b.tsx("div",null,a.exportHint))):H)));v="2d"!==d?.type;E=b.tsx("div",{class:"esri-print__panel--error"},d?v?a.sceneViewError:
a.serviceError:a.noViewError);L=y.some(({state:r})=>"pending"===r);D=b.tsx("div",{class:"esri-print__content",key:"panel"},b.tsx("div",null,b.tsx("ul",{bind:this,class:"esri-print__layout-tab-list",onclick:this._toggleLayoutPanel,onkeydown:this._handleLayoutPanelKeyDown,role:"tablist"},b.tsx("li",{afterCreate:this._focusOnTabChange,afterUpdate:this._focusOnTabChange,"aria-selected":`${this._selectedTab===f.layout}`,class:"esri-print__layout-tab","data-tab-id":f.layout,id:`${this.id}__layoutTab`,role:"tab",
tabIndex:0},a.layoutTab),b.tsx("li",{afterCreate:this._focusOnTabChange,afterUpdate:this._focusOnTabChange,"aria-selected":`${this._selectedTab===f.mapOnly}`,class:"esri-print__layout-tab","data-tab-id":f.mapOnly,id:`${this.id}__mapOnlyTab`,role:"tab",tabIndex:0},a.mapOnlyTab),b.tsx("li",{afterCreate:this._focusOnTabChange,afterUpdate:this._focusOnTabChange,"aria-selected":`${this._selectedTab===f.export}`,class:"esri-print__layout-tab","data-tab-id":f.export,id:`${this.id}__exportedFilesTab`,role:"tab",
tabIndex:0},L?b.tsx("calcite-loader",{inline:!0,label:"loading",scale:"s"}):null,a.exportsTab)),F),this._selectedTab!==f.export?b.tsx("div",{class:this.classes("esri-print__export-button-section",!this.saveExportHidden&&this.portal?"esri-print__export-button-section--divider":null),key:"export-button-section"},!this.saveExportHidden&&this.portal?b.tsx("calcite-label",{layout:"inline"},b.tsx("calcite-checkbox",{bind:this,checked:this.saveExportEnabled,onCalciteCheckboxChange:r=>{this.saveExportEnabled=
!!r.target.checked}}),a.saveExportToMyContent):null,b.tsx("calcite-button",{"aria-label":a.exportDescription,bind:this,class:this.classes("esri-print__export-button"),disabled:D||!(A||u?.id)&&!t,onclick:this._handlePrintMap,scale:"l",width:"full"},a.export)):null);v=b.tsx("calcite-flow",{key:"root-flow"},b.tsx("calcite-flow-item",{bind:this,key:"root-flow-item"},b.tsx("div",{class:"esri-print__container"},this.headerVisible?b.tsx("header",{class:"esri-print__header-title"},a.export):null,this.error||
v||!d?E:D)),this._renderChooseTemplateFlowItem());v=(D="initializing"===e.state)?this._renderLoader():v;return b.tsx("div",{bind:this,class:this.classes("esri-print",I.globalCss.widget,I.globalCss.panel,{["esri-print__panel-items--centered"]:D})},v)}_getPageSizeLabel(a){if(a&&(a=a.layoutTemplateInfo)){var c=ka.fromJSON(a.pageUnits.toLowerCase());return`${R.formatNumber(a.pageSize[0])} x ${R.formatNumber(a.pageSize[1])} ${X.unitName(this.messagesUnits,c,"abbr")}`}}_getTemplateLabel(a,c=!1){if(!a)return c?
this.messages.selectTemplate:this.messages.untitled;const {label:e,layout:d,layoutItem:g,type:p}=a;return"print-service-template"===p?this.messages[d]:(e??d??g?.id)?.replaceAll("_"," ")??this.messages.untitled}_getPortalTemplates(){const {portalTemplateIds:a}=this.viewModel;return this.includeDefaultTemplates?this.viewModel.defaultTemplates.toArray().filter(({layout:c,layoutItem:e})=>"map-only"!==c?.toLowerCase()&&!!e?.id&&a.includes(e.id)):[]}_getDefaultTemplates(){const {portalTemplateIds:a}=this.viewModel;
return this.includeDefaultTemplates?this.viewModel.defaultTemplates.toArray().filter(({layout:c,layoutItem:e})=>"map-only"!==c?.toLowerCase()&&(!e?.id||!a.includes(e.id))):[]}_getPrintServiceTemplates(){return this.includeDefaultTemplates&&this._getDefaultTemplates().length?[]:this.viewModel.printServiceTemplates.toArray().filter(({layout:a})=>"map-only"!==a?.toLowerCase())}_renderLayoutTemplates(a,c=!1,e=!1){c&&a.sort((d,g)=>(d.label??"")>(g.label??"")?1:-1);return a.map(d=>b.tsx("calcite-list-item",
{description:this._getPageSizeLabel(d),key:`template-${d.id}-${d.id===this.templateOptions.id}`,label:this._getTemplateLabel(d),selected:d.id===this.templateOptions.id,title:d.description??"",value:d},b.tsx("calcite-icon",{icon:(d.layout?T.get(d.layout):null)||"custom-print",slot:"content-start"}),"loading"===d.state?b.tsx("calcite-loader",{inline:!0,key:`template-loader-${d.id}`,label:"loading",scale:"s",slot:"content-end"}):null,"error"===d?.state?b.tsx("calcite-icon",{class:"esri-print__template-select-error",
icon:"exclamation-mark-circle",key:`template-error-${d.id}`,scale:"s",slot:"content-end"}):null,e?b.tsx("calcite-action",{icon:"trash",onclick:()=>this.viewModel.removePortalTemplate(d),slot:"actions-end",text:"delete"}):null))}_renderChooseTemplateFlowItem(){if(!this._showTemplates)return null;const {messages:a}=this,c=ba.reArcGISOnlineDomain.test(this.portal?.url),e=this.viewModel.browseTemplates.toArray(),d=this._getPortalTemplates(),g=this._getDefaultTemplates(),p=this._getPrintServiceTemplates(),
l=15<e.length+d.length+g.length+p.length,n=this.browseTemplateButtonOnClick?b.tsx("calcite-button",{appearance:"outline",class:l?"esri-print__browse-template-button-container-filter":"esri-print__browse-template-button-container",iconStart:"folder",key:"browse-template-button",onclick:this.browseTemplateButtonOnClick,slot:l?"filter-actions-end":"default"},l?null:a.browseTemplates):null;return b.tsx("calcite-flow-item",{bind:this,closable:!1,heading:a.chooseTemplate,key:"template-flow-item",onCalciteFlowItemBack:t=>
{t.preventDefault();this._showTemplates=!1}},b.tsx("div",{class:"esri-print__template-select-flow-item-container"},b.tsx("div",{class:"esri-print__template-select-flow-item-content"},l?null:n,b.tsx("calcite-list",{filterEnabled:l,filterProps:["label"],key:"template-list",selectionMode:"single-persist",onCalciteListChange:({target:t})=>this.viewModel.applyTemplate(t.selectedItems[0]?.value)},l?n:null,e.length?b.tsx("div",{key:"my-templates"},b.tsx("div",{class:"esri-print__template-select-flow-item-list-heading"},
a.myTemplates,b.tsx("calcite-chip",{appearance:"outline",kind:"neutral",scale:"s",value:a.beta},a.beta)),this._renderLayoutTemplates(e,!0,!0)):null,d.length?b.tsx("div",{key:"org-templates"},b.tsx("div",{class:"esri-print__template-select-flow-item-list-heading"},a.organizationTemplates,c?b.tsx("calcite-chip",{appearance:"outline",kind:"neutral",scale:"s",value:a.beta},a.beta):null),this._renderLayoutTemplates(d)):null,e.length||d.length?g.length?b.tsx("div",{key:"default-templates"},b.tsx("div",
{class:"esri-print__template-select-flow-item-list-heading"},a.defaultTemplates),this._renderLayoutTemplates(g,!0)):null:this._renderLayoutTemplates(g,!0),e.length||d.length?p.length?b.tsx("div",{key:"service-templates"},b.tsx("div",{class:"esri-print__template-select-flow-item-list-heading"},a.defaultTemplates),this._renderLayoutTemplates(p)):null:this._renderLayoutTemplates(p))),b.tsx("div",{class:"esri-print__template-button-container"},b.tsx("calcite-button",{class:"esri-print__template-done-button",
onclick:()=>this._showTemplates=!1},this.messagesCommon.done))))}_renderCustomTextElementSection(){const {customTextElements:a}=this.templateOptions;return a?b.tsx("div",{class:"esri-print__form-section-container",key:"custom-text-elements"},a.map((c,e)=>{const [d,g]=Object.entries(c)[0];return"date"===d?null:b.tsx("calcite-label",{key:`custom-text-elements-${d}-${e}`},d,b.tsx("calcite-input",{bind:this,"data-input-custom":!0,"data-input-name":d,value:g??"",onCalciteInputInput:this._updateInputValue}))})):
null}_renderTitleOrFileNameSection(){const {title:a,fileName:c,titlePlaceHolder:e,fileNamePlaceHolder:d}=this.messages,g=this._selectedTab===f.layout?a:c;return b.tsx("div",{class:"esri-print__form-section-container",key:g},b.tsx("calcite-label",null,g,b.tsx("calcite-input",{placeholder:this._selectedTab===f.layout?e:d,value:(this._selectedTab===f.layout?this.templateOptions.title:this.templateOptions.fileName)??"",onCalciteInputInput:this._onInput})))}_focusOnTabChange(a){if(this._activeTabFocusRequested){var c=
a.getAttribute("data-tab-id");if("layoutTab"===c&&this._selectedTab===f.layout||"mapOnlyTab"===c&&this._selectedTab===f.mapOnly||"exportTab"===c&&this._selectedTab===f.export)a.focus(),this._activeTabFocusRequested=!1}}_renderLoader(){return b.tsx("div",{class:this.classes({["esri-print__loader"]:this._awaitingServerResponse}),key:"loader"})}_updateExportedFileNameMap(a){void 0!==this._exportedFileNameMap[a]?this._exportedFileNameMap[a]++:this._exportedFileNameMap[a]=0}_createFileLink(a,c){c=c||this.messages.untitled;
a=a.format.toLowerCase();a=a.includes("png")?"png":a;const e=c+a;this._updateExportedFileNameMap(e);return new N({name:c,extension:a,count:this._exportedFileNameMap[e]})}_resetToCurrentScale(){this.templateOptions.scale=this.viewModel.view?.scale}_updateCustomTextElementValue(a,c,e){a.find(d=>{[d]=Object.entries(d)[0];return d===c})[c]=e}_updateInputValue(a){a=a.target;const c=a.getAttribute("data-input-name"),e=!!a["data-input-custom"],{templateOptions:d}=this;e?this._updateCustomTextElementValue(d.customTextElements,
c,a.value):d[c]=a.value}_updateNumberInputValue(a){a=a.target;const c=a.getAttribute("data-input-name"),{templateOptions:e}=this,d=Number(a.value);!isNaN(d)&&0<d?e[c]=d:a.value=`${e[c]}`}_handleDPIChange(a){const {templateOptions:c}=this,e=c.dpi;this._updateNumberInputValue(a);a=c.dpi;const {height:d,width:g}={width:Math.round(c.width/e*a),height:Math.round(c.height/e*a)};c.height=d;c.width=g}_handlePrintMap(){this._pendingExportScroll=!0;const {templateOptions:a,saveExportEnabled:c}=this,e=this.viewModel.toPrintTemplate(a),
d=this._createFileLink(e,this._selectedTab===f.layout?e.layoutOptions?.titleText:a.fileName);this.exportedLinks.add(d);this.emit("submit",{link:d,saveExportEnabled:c});this._selectedTab=f.export;this.viewModel.print(e).then(g=>{d.set({url:g&&g.url,state:"ready"})}).catch(g=>{d.set({error:g,state:"error"})}).then(()=>{this.emit("complete",{link:d,saveExportEnabled:c});this.scheduleRender()})}_switchInput(){[this.templateOptions.width,this.templateOptions.height]=[this.templateOptions.height,this.templateOptions.width]}_scrollExportIntoView(){if(this._pendingExportScroll){this._pendingExportScroll=
!1;var a=this._rootNode;if(a){var {clientHeight:c,scrollHeight:e}=a,d=e-c;0<d&&(a.scrollTop=d)}}}_toggleInputValue(a){a=a.target;const c=a.getAttribute("data-option-name");this.templateOptions[c]=a.checked;"scaleEnabled"===c&&this._resetToCurrentScale()}_renderExportedLink(a){const c=this.messages,e=a.map(d=>{const {error:g,url:p,state:l}=d,n=d.formattedName??"",t="error"===l,z="pending"===l,A="ready"===l;var u=p||null;u&&=M.addProxy(u);u=M.hasSameOrigin(p,location.href);const w=t?"print-task:cim-symbol-unsupported"===
g?.name?c.exportWebMapCIMError:c.exportWebMapError:"";return b.tsx("calcite-list-item",{"aria-label":z?c.pending:A?c.ready:c.errorMessage,key:n,title:w},b.tsx("div",{class:"esri-print__exported-file","data-item":d,onclick:this._handleLinkClick,slot:"content"},b.tsx("div",null,b.tsx("div",{class:"esri-print__exported-file-link-title"},n),b.tsx("div",{class:"esri-print__exported-file-link-description"},z?c.generatingExport:w||(u?c.ready:c.linkReady))),A?b.tsx("calcite-icon",{"aria-label":`${n}. ${c.linkReady}`,
icon:u?"download-to":"launch",key:`${n}-end-icon`,scale:"s",slot:"content-end"}):null),z?b.tsx("calcite-loader",{class:"esri-print__exported-file--loader",inline:!0,key:`${n}-loader`,label:c.generatingExport,scale:"m",slot:"content-start"}):b.tsx("calcite-icon",{icon:ja(d),key:`${n}-start-icon`,scale:"s",slot:"content-start"}),z?null:this.saveAsButtonCallback&&!t&&this._isFormatAllowedForSaving(d.extension)?b.tsx("calcite-action",{"aria-label":`${w}`,icon:"ellipsis",id:`${n}-popover-button`,key:`${n}-action`,
slot:"actions-end",text:`${w}`},b.tsx("calcite-popover",{autoClose:!0,key:`${n}-popover`,label:"Popover",offsetDistance:1,overlayPositioning:"fixed",pointerDisabled:!0,referenceElement:`${n}-popover-button`,scale:"s"},b.tsx("calcite-list",null,d.portalItem?b.tsx("calcite-list-item",{label:c.openItem,onCalciteListItemSelect:()=>{const x=d.portalItem;if(x&&x.itemPageUrl){var B=document.createElement("a");B.target="_blank";B.href=x.itemPageUrl;B.rel="noreferrer";B.click()}}},b.tsx("calcite-icon",{icon:"launch2",
key:`${n}-launch-icon`,scale:"s",slot:"content-start"})):b.tsx("calcite-list-item",{label:c.saveAs,onCalciteListItemSelect:async()=>{this.saveAsButtonCallback&&(C.whenOnce(()=>d.portalItem).then(x=>{x.itemPageUrl&&this.scheduleRender()}),await this.saveAsButtonCallback(d))}},b.tsx("calcite-icon",{icon:"save",key:`${n}-save-icon`,scale:"s",slot:"content-start"})),b.tsx("calcite-list-item",{label:this.messagesCommon.delete,onCalciteListItemSelect:()=>this.exportedLinks.remove(d)},b.tsx("calcite-icon",
{icon:"trash",key:`${n}-delete-icon`,scale:"s",slot:"content-start"}))))):b.tsx("calcite-action",{"aria-label":`${w}`,icon:"x",key:`${n}-action`,onclick:()=>{this.exportedLinks.remove(d)},slot:"actions-end",text:`${w}`}))});return b.tsx("calcite-list",{filterEnabled:10<a?.length},e)}_isFormatAllowedForSaving(a){return!this.allowedFormatsForSaving||"all"===this.allowedFormatsForSaving||!(!a||!this.allowedFormatsForSaving.includes(a))}_toggleLayoutPanel(a){this._toggleTab(a.target.getAttribute("data-tab-id"))}_toggleTab(a,
c=!0){this._selectedTab=a;this._selectedTab===f.mapOnly?(this.templateOptions.reset(),this.templateOptions.layout="map-only"):this._selectedTab===f.layout&&((a=this._selectedTemplate??this.viewModel.defaultTemplate)?this.viewModel.applyTemplate(a):this.templateOptions.reset());c&&(this._activeTabFocusRequested=!0)}_handleLayoutPanelKeyDown(a){const {key:c}=a,e=a.target.getAttribute("data-tab-id");if(P.isActivationKey(c))this._toggleTab(e),a.preventDefault(),a.stopPropagation();else if("ArrowLeft"===
c||"ArrowRight"===c){switch(e){case f.layout:this._toggleTab("ArrowLeft"===c?f.export:f.mapOnly);break;case f.mapOnly:this._toggleTab("ArrowLeft"===c?f.layout:f.export);break;case f.export:this._toggleTab("ArrowLeft"===c?f.mapOnly:f.layout)}a.preventDefault();a.stopPropagation()}}};k.__decorate([m.property()],h.prototype,"_showTemplates",void 0);k.__decorate([m.property()],h.prototype,"_isValidSpatialReference",void 0);k.__decorate([m.property()],h.prototype,"allowedFormats",null);k.__decorate([m.property()],
h.prototype,"allowedFormatsForSaving",void 0);k.__decorate([m.property()],h.prototype,"allowedLayouts",null);k.__decorate([m.property()],h.prototype,"browseTemplateButtonOnClick",void 0);k.__decorate([m.property()],h.prototype,"error",null);k.__decorate([m.property({type:S})],h.prototype,"exportedLinks",void 0);k.__decorate([m.property()],h.prototype,"extraParameters",null);k.__decorate([m.property()],h.prototype,"headerVisible",void 0);k.__decorate([m.property()],h.prototype,"headingLevel",void 0);
k.__decorate([m.property()],h.prototype,"icon",null);k.__decorate([m.property()],h.prototype,"includeDefaultTemplates",null);k.__decorate([m.property()],h.prototype,"label",null);k.__decorate([m.property(),J.messageBundle("esri/widgets/Print/t9n/Print")],h.prototype,"messages",void 0);k.__decorate([m.property(),J.messageBundle("esri/t9n/common")],h.prototype,"messagesCommon",void 0);k.__decorate([m.property(),J.messageBundle("esri/core/t9n/Units")],h.prototype,"messagesUnits",void 0);k.__decorate([m.property({type:Q})],
h.prototype,"outSpatialReference",null);k.__decorate([m.property()],h.prototype,"portal",null);k.__decorate([m.property()],h.prototype,"saveExportEnabled",void 0);k.__decorate([m.property()],h.prototype,"saveExportHidden",void 0);k.__decorate([m.property()],h.prototype,"showPrintAreaEnabled",null);k.__decorate([m.property()],h.prototype,"printServiceUrl",null);k.__decorate([m.property()],h.prototype,"saveAsButtonCallback",void 0);k.__decorate([m.property()],h.prototype,"templateCustomTextElements",
null);k.__decorate([m.property()],h.prototype,"templateOptions",null);k.__decorate([m.property()],h.prototype,"view",null);k.__decorate([m.property({type:O})],h.prototype,"viewModel",void 0);return h=k.__decorate([Z.subclass("esri.widgets.Print")],h)});