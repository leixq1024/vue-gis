// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.31/esri/copyright.txt for details.
//>>built
define("../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ../../Widget ./ClassicCSS ./support/relationshipUtils ./support/univariateUtils ../support/styleUtils ../../support/globalCss ../../support/Heading ../../support/widgetUtils ../../support/decorators/messageBundle ../../support/jsxFactory".split(" "),function(y,A,w,M,N,E,F,b,G,u,q,H,I,O,J,c){const K=`${b.legend}__`,
D={display:"flex",alignItems:"flex-start"},B={marginLeft:"3px"},x={display:"table-cell",verticalAlign:"middle"};w=class extends F{constructor(a,d){super(a,d);this.activeLayerInfos=null;this.headingLevel=3;this.messages=null;this.type="classic"}render(){const a=this.activeLayerInfos?.toArray().map(d=>this._renderLegendForLayer(d)).filter(d=>!!d);return c.tsx("div",null,a?.length?a:c.tsx("div",{class:b.css.message},this.messages.noLegend))}_renderLegendForLayer(a,d){if(!a.ready)return null;var e=!!a.children.length;
const k=`${a.layer.uid}-version-${a.version}`,f=`${K}${d?`${d}-`:""}${k}`;d=a.title?I.Heading({level:this.headingLevel,class:this.classes(H.globalCss.heading,b.css.label)},a.title):null;if(e)return e=a.children.map(g=>this._renderLegendForLayer(g,k)).toArray(),c.tsx("div",{class:this.classes(b.css.service,b.css.groupLayer),key:f},d,e);if((e=a.legendElements)&&!e.length)return null;e=e.map(g=>this._renderLegendForElement(g,a.layer,a.effectList,f)).filter(g=>!!g);return e.length?c.tsx("div",{class:this.classes(b.css.service,
{[b.css.groupLayerChild]:!!a.parent}),key:f},d,c.tsx("div",{class:b.css.layer},e)):null}_renderLegendForElement(a,d,e,k,f){var g="color-ramp"===a.type,l="opacity-ramp"===a.type;const n="size-ramp"===a.type;let m=null;const p=`${k}-${a.type}`;if("symbol-table"===a.type||n){var h=a.infos.map(z=>this._renderLegendForElementInfo(z,d,e,n,a.legendType,p)).filter(z=>!!z);h.length&&(m=c.tsx("div",{class:b.css.layerBody},h))}else"color-ramp"===a.type||"opacity-ramp"===a.type||"heatmap-ramp"===a.type||"stretch-ramp"===
a.type?m=this._renderLegendForRamp(a,d.opacity,p):"relationship-ramp"===a.type?m=G.renderRelationshipRamp(a,this.id,{opacity:d.opacity,effectList:e,ariaLabel:this.messages.previewRelationshipRampAriaLabel,key:p}):"pie-chart-ramp"===a.type?m=this._renderPieChartRamp(a,p):"univariate-above-and-below-ramp"===a.type?m=this._renderUnivariateAboveAndBelowRamp(a,d.opacity,e,p):"univariate-color-size-ramp"===a.type&&(m=this._renderUnivariateColorSizeRamp(a,d.opacity,e,p));if(!m)return null;h=a.title;var v=
null;"string"===typeof h?v=h:h&&(v=q.getTitle(this.messages,h,g||l),v=q.isRendererTitle(h,g||l)&&h.title?`${h.title} (${v})`:v);g=f?b.css.layerChildTable:b.css.layerTable;l=v?c.tsx("div",{class:b.css.layerCaption},v):null;return c.tsx("div",{class:this.classes(g,{[b.css.layerTableSizeRamp]:n||!f}),key:`${k}-table`},l,m)}_renderPieChartRamp(a,d){return c.tsx("div",{afterCreate:q.attachToNode,bind:a.preview,key:`${d}-preview`})}_renderUnivariateAboveAndBelowRamp(a,d,e,k){const {sizeRampElement:f,colorRampElement:g}=
u.getUnivariateAboveAndBelowRampElements(a,d);if(!f)return null;var l=this.messages?.previewColorRampAriaLabel,n=u.getUnivariateColorRampSize(f,"above",!0);a=u.getUnivariateColorRampSize(f,"below",!0);const m=u.getUnivariateColorRampPreview(g,{width:12,height:n,rampAlignment:"vertical",opacity:d,type:"above",effectList:e,ariaLabel:l});d=u.getUnivariateColorRampPreview(g,{width:12,height:a,rampAlignment:"vertical",opacity:d,type:"below",effectList:e,ariaLabel:l});var p=u.getUnivariateColorRampMargin(f);
const h=f.infos.map(r=>r.label);e=h.map((r,t)=>{const C=2===t;return 0===t?c.tsx("div",{class:r?m?b.css.univariateAboveAndBelowLabel:b.css.rampLabel:void 0,key:`${k}-color-ramp-above-label-${r??t}`},r):C?c.tsx("div",null):null});const v=h.length-1,z=Math.floor(h.length/2);l=h.map((r,t)=>{const C=t===v;return t===z||C?c.tsx("div",{class:r?m?b.css.univariateAboveAndBelowLabel:b.css.rampLabel:void 0,key:`${k}-color-ramp-below-label-${r??t}`},r):null});const L={display:"table-cell",verticalAlign:"middle"};
p={marginTop:`${p}px`};n={height:`${n}px`};a={height:`${a}px`};return c.tsx("div",{key:`${k}-container`,styles:D},c.tsx("div",{class:b.css.layerBody},f.infos.map((r,t)=>c.tsx("div",{class:this.classes(b.css.layerRow,b.css.sizeRamp),key:`${k}-row-${t}`},c.tsx("div",{afterCreate:q.attachToNode,bind:r.preview,class:b.css.symbol,styles:L}),m||0!==t%2?null:c.tsx("div",{class:b.css.layerInfo},h[t])))),m?c.tsx("div",{styles:p},c.tsx("div",{styles:B},c.tsx("div",{styles:x},c.tsx("div",{afterCreate:q.attachToNode,
bind:m,class:b.css.rampContainer})),c.tsx("div",{styles:x},c.tsx("div",{class:b.css.rampLabelsContainer,styles:n},e))),c.tsx("div",{styles:B},c.tsx("div",{styles:x},c.tsx("div",{afterCreate:q.attachToNode,bind:d,class:b.css.rampContainer})),c.tsx("div",{styles:x},c.tsx("div",{class:b.css.rampLabelsContainer,styles:a},l)))):null)}_renderUnivariateColorSizeRamp(a,d,e,k){const {sizeRampElement:f,colorRampElement:g}=u.getUnivariateColorSizeRampElements(a);if(!f)return null;var l=u.getUnivariateColorRampMargin(f);
a=u.getUnivariateColorRampSize(f,"full",!1);d=u.getUnivariateColorRampPreview(g,{width:12,height:a,rampAlignment:"vertical",opacity:d,type:"full",effectList:e,ariaLabel:this.messages?.previewColorRampAriaLabel});const n=f.infos.length-1;e=f.infos.map((p,h)=>0===h||h===n?c.tsx("div",{class:p.label?g?b.css.univariateAboveAndBelowLabel:b.css.rampLabel:void 0,key:`${k}-color-ramp-label-${p.label??h}`},p.label):null);const m={display:"table-cell",verticalAlign:"middle"};l={marginTop:`${l}px`};a={height:`${a}px`};
return c.tsx("div",{key:`${k}-container`,styles:D},c.tsx("div",{class:b.css.layerBody},f.infos.map((p,h)=>c.tsx("div",{class:this.classes(b.css.layerRow,b.css.sizeRamp),key:`${k}-row-${h}`},c.tsx("div",{afterCreate:q.attachToNode,bind:p.preview,class:b.css.symbol,styles:m})))),c.tsx("div",{styles:l},c.tsx("div",{styles:B},c.tsx("div",{styles:x},c.tsx("div",{afterCreate:q.attachToNode,bind:d,class:b.css.rampContainer})),c.tsx("div",{styles:x},c.tsx("div",{class:b.css.rampLabelsContainer,styles:a},
e)))))}_renderLegendForRamp(a,d,e){const k=a.infos,f="heatmap-ramp"===a.type,g="stretch-ramp"===a.type,l=a.preview;l.className=`${b.css.colorRamp} ${"opacity-ramp"===a.type?b.css.opacityRamp:""}`;null!=d&&(l.style.opacity=d.toString());a=k.map((n,m)=>c.tsx("div",{class:n.label?b.css.rampLabel:void 0,key:`${e}-stop-${n.label??m}-label`},f?this.messages[n.label]||n.label:g?q.getStretchStopLabel(n,this.messages):n.label));d={height:l.style.height};return c.tsx("div",{class:b.css.layerRow,key:`${e}-row`},
c.tsx("div",{class:b.css.symbolContainer,styles:{width:"24px"}},c.tsx("div",{afterCreate:q.attachToNode,bind:l,class:b.css.rampContainer})),c.tsx("div",{class:b.css.layerInfo},c.tsx("div",{class:b.css.rampLabelsContainer,styles:d},a)))}_renderLegendForElementInfo(a,d,e,k,f,g){g=`${g}-${a.label}`;if(a.type)return this._renderLegendForElement(a,d,e,g,!0);e=null;f=q.isImageryStretchedLegend(d,f);a.preview?e=c.tsx("div",{afterCreate:q.attachToNode,bind:a.preview,class:b.css.symbol}):a.src&&(e=this._renderImage(a,
d,f));if(!e)return null;d={[b.css.imageryLayerInfoStretched]:f};return c.tsx("div",{class:b.css.layerRow,key:`${g}-row`},c.tsx("div",{class:this.classes(b.css.symbolContainer,{[b.css.imageryLayerInfoStretched]:f,[b.css.sizeRamp]:!f&&k})},e),c.tsx("div",{class:this.classes(b.css.layerInfo,d)},q.getTitle(this.messages,a.label,!1)||""))}_renderImage(a,d,e){const {label:k,src:f,opacity:g}=a;e={[b.css.imageryLayerStretchedImage]:e,[b.css.symbol]:!e};d={opacity:`${null!=g?g:d.opacity}`};return c.tsx("img",
{alt:q.getTitle(this.messages,k,!1),"aria-label":q.getTitle(this.messages,k,!1),border:0,class:this.classes(e),height:a.height,src:f,styles:d,width:a.width})}};y.__decorate([A.property()],w.prototype,"activeLayerInfos",void 0);y.__decorate([A.property()],w.prototype,"headingLevel",void 0);y.__decorate([A.property(),J.messageBundle("esri/widgets/Legend/t9n/Legend")],w.prototype,"messages",void 0);y.__decorate([A.property({readOnly:!0})],w.prototype,"type",void 0);return w=y.__decorate([E.subclass("esri.widgets.Legend.styles.Classic")],
w)});