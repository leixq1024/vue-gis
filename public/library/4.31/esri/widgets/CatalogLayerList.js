// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.31/esri/copyright.txt for details.
//>>built
define("require ../chunks/tslib.es6 ../core/Collection ../core/Identifiable ../core/ReactiveMap ../core/reactiveUtils ../core/accessorSupport/decorators/property ../core/has ../core/Logger ../core/RandomLCG ../core/accessorSupport/decorators/subclass ./Widget ./CatalogLayerList/CatalogLayerListViewModel ./CatalogLayerList/CatalogLayerListVisibleElements ./CatalogLayerList/css ./LayerList/LayerListItem ./LayerList/ListItem ./LayerList/support/layerListUtils ../chunks/componentsUtils ./support/globalCss ./support/listUtils ./support/widgetUtils ./support/decorators/messageBundle ./support/decorators/vmEvent ./support/jsxFactory".split(" "),
function(p,e,r,d,B,C,g,Q,R,S,H,I,D,E,q,J,K,u,L,t,M,v,F,N,h){var w;const O=r.ofType(K);d=w=class extends d.IdentifiableMixin(I){constructor(a,b){super(a,b);this._activeItem=null;this._tooltipReferenceMap=new B;this._focusPanelFlowItem=this._focusRootFlowItem=!1;this._focusLayerFlowItem=null;this._layerListMap=new B;this._rootGroupUid=`operational-${this.uid}`;this.catalogOptions=this.catalogLayerList=this._openedLayersController=null;this.collapsed=!1;this.filterText=this.filterPlaceholder="";this.headingLevel=
2;this.knowledgeGraphOptions=null;this.layerTablesEnabled=new r(["knowledge-graph"]);this.messagesCommon=this.messages=this.mapImageOptions=null;this.minFilterItems=u.minFilterItems;this.openedLayers=new r;this.openedLayerLists=new r;this.selectedItems=new O;this.selectionMode="none";this.tileOptions=this.tableList=null;this.viewModel=new D;this.visibilityAppearance="default";this.visibleElements=new E;this._onTablesOpen=c=>{if(this.onTablesOpen)this.onTablesOpen(c);else this.openedLayers.push(c.layer),
this._focusLayerFlowItem=c.layer.uid};this._onCatalogOpen=c=>{if(this.onCatalogOpen)this.onCatalogOpen(c);else this.openedLayers.push(c.layer.parent),this._focusLayerFlowItem=c.layer.uid};this._onPanelOpen=()=>{this._focusPanelFlowItem=!0};this._onTooltipReferenceChange=(c,f)=>{f?this._tooltipReferenceMap.set(c,f):this._tooltipReferenceMap.delete(c)};this._onTriggerAction=(c,f)=>{this.triggerAction(c,f)};this._clearActiveItem=()=>{this._activeItem=null};this._setActiveItem=c=>{"default"===this.visibilityAppearance&&
(c=Array.from(c.composedPath()).find(f=>f.classList?.contains(q.css.item)),this._activeItem=u.getItem(c))}}initialize(){this.addHandles(C.on(()=>this.openedLayers,"change",()=>this._handleOpenedLayersChange(),C.initial))}loadDependencies(){return L.loadCalciteComponents({button:()=>new Promise((a,b)=>p(["../chunks/calcite-button"],a,b)),flow:()=>new Promise((a,b)=>p(["../chunks/calcite-flow"],a,b)),"flow-item":()=>new Promise((a,b)=>p(["../chunks/calcite-flow-item"],a,b)),list:()=>new Promise((a,
b)=>p(["../chunks/calcite-list"],a,b)),notice:()=>new Promise((a,b)=>p(["../chunks/calcite-notice"],a,b)),tooltip:()=>new Promise((a,b)=>p(["../chunks/calcite-tooltip"],a,b))})}destroy(){this._destroyOpenedLayerLists();this._tooltipReferenceMap.clear()}get _filterEnabled(){return this.viewModel.totalItems>=this.minFilterItems&&this.visibleElements.filter}get _renderedOpenLayerFlowItems(){return this.openedLayers.toArray().map(a=>this._renderLayerFlowItem(a))}get catalogItems(){return this.viewModel.catalogItems}set catalogItems(a){this.viewModel.catalogItems=
a}get catalogLayer(){return this.viewModel.catalogLayer}set catalogLayer(a){this.viewModel.catalogLayer=a}get icon(){return"catalog-dataset"}set icon(a){this._overrideIfSome("icon",a)}get label(){return this.messages?.widgetLabel??""}set label(a){this._overrideIfSome("label",a)}get listItemCreatedFunction(){return this.viewModel.listItemCreatedFunction}set listItemCreatedFunction(a){this.viewModel.listItemCreatedFunction=a}get view(){return this.viewModel.view}set view(a){this.viewModel.view=a}triggerAction(a,
b){return this.viewModel.triggerAction(a,b)}render(){var a=this.viewModel?.state;a={[t.globalCss.hidden]:"loading"===a,[t.globalCss.disabled]:"disabled"===a};const b=this.catalogItems?.filter(c=>!c.hidden&&(this.visibleElements.errors||!c.error));return h.tsx("div",{class:this.classes(q.css.base,t.globalCss.widget,t.globalCss.panel,a)},b?.length?[this._renderItemTooltips(b),this._renderItems(b)]:this._renderNoItems())}async _createFlowList(a,b){const {_layerListMap:c}=this;var f=c.get(a);if(f)return f;
f="catalog"===a.type?await this._createCatalogLayerList(a):await this._createTableList(a);b.aborted||c.set(a,f);return f}async _handleOpenedLayersChange(){const {_layerListMap:a,openedLayers:b,openedLayerLists:c}=this;this._openedLayersController?.abort();var f=new AbortController;const {signal:k}=f;this._openedLayersController=f;a.forEach((m,n)=>{b.includes(n)||(m.destroy(),a.delete(n))});f=await Promise.all(b.map(m=>this._createFlowList(m,k)));k.aborted||(c.removeAll(),c.addMany(f),(f=c.at(-1))?
"catalogLayer"in f?(this._set("catalogLayerList",f),this._set("tableList",null)):(this._set("catalogLayerList",null),this._set("tableList",f)):(this._set("catalogLayerList",null),this._set("tableList",null)))}_destroyOpenedLayerLists(){this.openedLayerLists.destroyAll();this.openedLayers.removeAll();this._layerListMap.clear()}_renderItemTooltip(a){const {_tooltipReferenceMap:b,messages:c}=this;return a?h.tsx("calcite-tooltip",{key:`tooltip-${a.layer.uid}`,referenceElement:b.get(a.layer.uid)},c.layerIncompatibleTooltip):
null}_renderItemTooltipNodes(a){return a.incompatible?this._renderItemTooltip(a):a.children?.filter(b=>!b.hidden).toArray().map(b=>this._renderItemTooltipNodes(b))}_renderItemTooltips(a){return a?.toArray().map(b=>this._renderItemTooltipNodes(b))}_renderNoItemsMessage(){return h.tsx("div",{slot:"message"},this.messages.noItemsToDisplay)}_renderNoItems(){return h.tsx("div",{class:q.css.itemMessage,key:"esri-layer-list__no-items"},h.tsx("calcite-notice",{icon:"information",kind:"info",open:!0,width:"full"},
this._renderNoItemsMessage()))}_renderPanelFlowItems(a){return a?a.flatten(b=>b.children).filter(({hidden:b,panel:c})=>!b&&c?.open&&!c.disabled&&c.flowEnabled).toArray().map(({title:b,panel:c})=>{const f=()=>this._handlePanelFlowItemBack(c);return h.tsx("calcite-flow-item",{afterCreate:this._focusPanelFlowItemNode,afterUpdate:this._focusPanelFlowItemNode,bind:this,description:b,heading:c.title,headingLevel:this.headingLevel,key:`flow-panel-${c.uid}`,onCalciteFlowItemBack:k=>{k.preventDefault();f()}},
c.render(),h.tsx("calcite-button",{appearance:"transparent",onclick:f,slot:"footer-actions",width:"full"},this.messagesCommon.back))}):[]}_handlePanelFlowItemBack(a){a.open=!1;this._focusRootFlowItem=!0}_focusRootFlowItemNode(a){this._focusRootFlowItem&&(this._focusRootFlowItem=!1,v.setFocus(a))}_focusPanelFlowItemNode(a){this._focusPanelFlowItem&&(this._focusPanelFlowItem=!1,v.setFocus(a))}_renderItems(a){const {visible:b,collapsed:c,_filterEnabled:f,_rootGroupUid:k,visibleElements:{closeButton:m,
collapseButton:n,heading:x,flow:y},selectionMode:z,filterText:A,filterPlaceholder:P,messages:G}=this;a=[h.tsx("calcite-flow-item",{afterCreate:this._focusRootFlowItemNode,afterUpdate:this._focusRootFlowItemNode,bind:this,closable:m,closed:!b,collapsed:c,collapsible:n,heading:x?G.widgetLabel:void 0,headingLevel:this.headingLevel,key:"root-flow-item",onCalciteFlowItemClose:()=>this.visible=!1},h.tsx("calcite-list",{afterCreate:l=>{l.addEventListener("focusin",this._setActiveItem);l.addEventListener("focusout",
this._clearActiveItem)},afterRemoved:l=>{l.removeEventListener("focusin",this._setActiveItem);l.removeEventListener("focusout",this._clearActiveItem)},"data-layer-type":k,filterEnabled:f,filterPlaceholder:P,filterProps:M.calciteListFilterProps,filterText:f?A:"",group:k,key:"root-list",label:G.widgetLabel,onmouseleave:this._clearActiveItem,onmouseover:this._setActiveItem,selectionAppearance:"border",selectionMode:z,onCalciteListChange:l=>this._handleCalciteListChange(l),onCalciteListFilter:l=>this.filterText=
l.target?.filterText??""},a?.toArray().map(l=>this._renderItem(l)),a?.length&&f?h.tsx("div",{class:q.css.filterNoResults,slot:"filter-no-results"},h.tsx("calcite-notice",{kind:"info",open:!0,width:"full"},this._renderNoItemsMessage())):null)),this._renderPanelFlowItems(a),this._renderedOpenLayerFlowItems];return b?y?h.tsx("calcite-flow",{key:"root-flow"},a):a:null}_focusLayerFlowItemNode(a){this._focusLayerFlowItem===a.dataset.layerUid&&(this._focusLayerFlowItem=null,v.setFocus(a))}_renderLayerFlowItem(a){const {messages:b,
openedLayers:c}=this;return h.tsx("calcite-flow-item",{afterCreate:this._focusLayerFlowItemNode,afterUpdate:this._focusLayerFlowItemNode,bind:this,"data-layer-uid":a.uid,description:a.title||this.messages.untitledLayer,heading:b["catalog"===a.type?"catalogLayers":"tables"],headingLevel:this.headingLevel,key:`flow-layer-list-${a.uid}`,onCalciteFlowItemBack:f=>{f.preventDefault();c.pop();(f=c.at(-1))?this._focusLayerFlowItem=f.uid:this._focusRootFlowItem=!0}},this._layerListMap.get(a)?.render())}async _createCatalogLayerList(a){const {headingLevel:b,
catalogOptions:c,view:f,filterPlaceholder:k,listItemCreatedFunction:m,minFilterItems:n,selectionMode:x,visibilityAppearance:y,onCatalogOpen:z,onTablesOpen:A}=this;return new w({headingLevel:b,view:f,filterPlaceholder:k,listItemCreatedFunction:m,minFilterItems:n,selectionMode:x,visibilityAppearance:y,...c,catalogLayer:a,onCatalogOpen:z,onTablesOpen:A})}_getTableListParams(a){switch(a.type){case "knowledge-graph":return{...this.knowledgeGraphOptions,tables:a.tables};case "map-image":return{...this.mapImageOptions,
tables:a.subtables};case "tile":return{...this.tileOptions,tables:a.subtables};default:return null}}async _createTableList(a){const {default:b}=await new Promise((k,m)=>p(["./TableList"],n=>k(Object.freeze(Object.defineProperty({__proto__:null,default:n},Symbol.toStringTag,{value:"Module"}))),m)),{headingLevel:c,selectionMode:f}=this;return new b({headingLevel:c,selectionMode:f,...this._getTableListParams(a)})}_renderItem(a,b,c){return h.tsx(J,{activeItem:this._activeItem,css:q.css,dragEnabled:!1,
item:a,key:`layerListItem-${a.layer.uid}`,layerTablesEnabled:this.layerTablesEnabled,listModeDisabled:this.viewModel.listModeDisabled,messages:this.messages,messagesCommon:this.messagesCommon,parent:b,parentTitles:c,rootGroupUid:this._rootGroupUid,selectedDragItemLayerUid:null,selectedItems:this.selectedItems,selectionMode:this.selectionMode,visibilityAppearance:this.visibilityAppearance,visibleElements:this.visibleElements,onAction:this._onTriggerAction,onCatalogOpen:this._onCatalogOpen,onPanelOpen:this._onPanelOpen,
onTablesOpen:this._onTablesOpen,onTooltipReferenceChange:this._onTooltipReferenceChange})}_handleCalciteListChange(a){const {selectionMode:b,selectedItems:c}=this;"none"!==b&&(a=a.target.selectedItems.map(f=>u.getItem(f)).filter(Boolean),c.removeAll(),c.addMany(a))}};e.__decorate([g.property()],d.prototype,"_activeItem",void 0);e.__decorate([g.property()],d.prototype,"_tooltipReferenceMap",void 0);e.__decorate([g.property()],d.prototype,"_focusRootFlowItem",void 0);e.__decorate([g.property()],d.prototype,
"_focusPanelFlowItem",void 0);e.__decorate([g.property()],d.prototype,"_focusLayerFlowItem",void 0);e.__decorate([g.property()],d.prototype,"_layerListMap",void 0);e.__decorate([g.property()],d.prototype,"_filterEnabled",null);e.__decorate([g.property()],d.prototype,"_renderedOpenLayerFlowItems",null);e.__decorate([g.property()],d.prototype,"catalogItems",null);e.__decorate([g.property()],d.prototype,"catalogLayer",null);e.__decorate([g.property({readOnly:!0})],d.prototype,"catalogLayerList",void 0);
e.__decorate([g.property()],d.prototype,"catalogOptions",void 0);e.__decorate([g.property()],d.prototype,"collapsed",void 0);e.__decorate([g.property()],d.prototype,"filterPlaceholder",void 0);e.__decorate([g.property()],d.prototype,"filterText",void 0);e.__decorate([g.property()],d.prototype,"headingLevel",void 0);e.__decorate([g.property()],d.prototype,"icon",null);e.__decorate([g.property()],d.prototype,"knowledgeGraphOptions",void 0);e.__decorate([g.property()],d.prototype,"label",null);e.__decorate([g.property()],
d.prototype,"layerTablesEnabled",void 0);e.__decorate([g.property()],d.prototype,"listItemCreatedFunction",null);e.__decorate([g.property()],d.prototype,"mapImageOptions",void 0);e.__decorate([g.property(),F.messageBundle("esri/widgets/CatalogLayerList/t9n/CatalogLayerList")],d.prototype,"messages",void 0);e.__decorate([g.property(),F.messageBundle("esri/t9n/common")],d.prototype,"messagesCommon",void 0);e.__decorate([g.property()],d.prototype,"minFilterItems",void 0);e.__decorate([g.property({readOnly:!0})],
d.prototype,"openedLayers",void 0);e.__decorate([g.property({readOnly:!0})],d.prototype,"openedLayerLists",void 0);e.__decorate([g.property()],d.prototype,"onCatalogOpen",void 0);e.__decorate([g.property()],d.prototype,"onTablesOpen",void 0);e.__decorate([g.property()],d.prototype,"selectedItems",void 0);e.__decorate([g.property()],d.prototype,"selectionMode",void 0);e.__decorate([g.property({readOnly:!0})],d.prototype,"tableList",void 0);e.__decorate([g.property()],d.prototype,"tileOptions",void 0);
e.__decorate([g.property()],d.prototype,"view",null);e.__decorate([N.vmEvent("trigger-action"),g.property({type:D})],d.prototype,"viewModel",void 0);e.__decorate([g.property()],d.prototype,"visibilityAppearance",void 0);e.__decorate([g.property({type:E,nonNullable:!0})],d.prototype,"visibleElements",void 0);return d=w=e.__decorate([H.subclass("esri.widgets.CatalogLayerList")],d)});