// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.31/esri/copyright.txt for details.
//>>built
define("exports ../../chunks/tslib.es6 ../../core/Accessor ../../core/asyncUtils ../../core/Error ../../core/events ../../core/has ../../core/promiseUtils ../../core/accessorSupport/decorators/property ../../core/Logger ../../core/RandomLCG ../../core/accessorSupport/decorators/subclass ../../geometry/Point ../../geometry/projection ../../geometry/support/spatialReferenceUtils ../../layers/graphics/sources/support/uploadProgressWeights ../../layers/support/infoFor3D ../../support/progressUtils".split(" "),
function(e,h,q,r,t,u,v,l,k,E,F,w,x,n,y,z,A,p){async function B(a){const {resolve:d,promise:b}=l.createResolver(),c=document.createElement("input");c.type="file";c.multiple=!1;c.accept=[...A.getSupportedExtensions(a.infoFor3D),".zip"].join();c.style.display="none";document.body.appendChild(c);const g=u.on(c,"change",()=>d(c.files?Array.from(c.files):[]));m?m(c):c.click();return b.finally(()=>{g.remove();c.remove()})}async function C(a,d){await n.initializeProjection(a.spatialReference,d);if(!a.vertexSpace.origin)return!1;
const [b,c,g]=a.vertexSpace.origin;var f=new x({x:b,y:c,z:g,spatialReference:a.spatialReference});f=n.project(f,d);if(!f)return!1;a.vertexSpace.origin=[f.x,f.y,f.z??0];a.spatialReference=d;return!0}e.Upload=class extends q{constructor(){super({});this.files=[];this.progress=0;this._layer=this._uploadTask=null}destroy(){this.cancel();this.files=[];this._uploadTask=this._layer=null}get state(){const a=this._uploadTask;return a&&0!==this.files.length?a.finished?a.error?"error":"success":"pending":"default"}get result(){return this._uploadTask?.value??
null}get error(){return this._uploadTask?.error??null}uploadTo(a){this.cancel();this.files=[];this._layer=a;this._uploadTask=r.createTask(async d=>{var b=await B(a);l.throwIfAborted(d);this.progress=0;this.files=b;var c=p.makeProgressManager(z.uploadProgressWeights.upload,f=>{this.progress=f},"Upload.uploadTo");if(0===b.length)return null;l.throwIfAborted(d);const g=await a.extractAndFilterFiles(b);l.throwIfAborted(d);0<g.length&&(this.files=g);b=await a.convertMesh(g,{signal:d,onProgress:c.makeOnProgress("createFromFiles")});
l.throwIfAborted(d);if(!b)throw new t("editor:upload","could not upload or convert model");d=g.reduce((f,D)=>f+D.size,0);c=c.simulate("loadMesh",p.estimatedTransferTime(d));try{await b.load()}finally{c.remove()}if(v("enable-feature:georeferenced-uploads")&&b.metadata.georeferenced){if(await y.equalsWithProjectionEngine(a.spatialReference,b.origin?.spatialReference))return{type:"georeferenced",mesh:b};if((a.spatialReference.isWebMercator||a.spatialReference.isWGS84)&&await C(b,a.spatialReference))return{type:"georeferenced-reprojected",
mesh:b}}b.spatialReference=a.spatialReference;b.vertexSpace.origin=[0,0,0];return{type:"non-georeferenced",mesh:b}})}retry(){this._layer&&this.uploadTo(this._layer)}cancel(){this._uploadTask?.abort()}};h.__decorate([k.property()],e.Upload.prototype,"files",void 0);h.__decorate([k.property()],e.Upload.prototype,"progress",void 0);h.__decorate([k.property()],e.Upload.prototype,"state",null);h.__decorate([k.property()],e.Upload.prototype,"result",null);h.__decorate([k.property()],e.Upload.prototype,
"error",null);h.__decorate([k.property()],e.Upload.prototype,"_uploadTask",void 0);h.__decorate([k.property()],e.Upload.prototype,"_layer",void 0);e.Upload=h.__decorate([w.subclass("esri.widgets.Editor.Upload")],e.Upload);let m=null;e.clearPromptForFilesStub=function(){m=null};e.stubFilePickerToSelect=function(a,d){m=b=>{d?.();Promise.resolve().then(()=>a).then(c=>{if(m){var g=new DataTransfer;c.forEach(f=>g.items.add(f));b.files=g.files;b.dispatchEvent(new Event("change"))}})}};Object.defineProperty(e,
Symbol.toStringTag,{value:"Module"})});